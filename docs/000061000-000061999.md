# StackOverflow 问答 000061000-000061999

# directory-structure - 开发目录结构

> ID：61000
> 
> 赞同：6
> 
> 时间：2008-09-14T00:01:15.510
> 
> 标签：directory-structure

我想知道开发项目中常用的目录结构是什么。我的意思是促进构建、部署发布等的想法。

我最近为一个 java 项目使用了[Maven 结构](http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html)，但我不确定它是否是非 Maven 驱动项目的最佳结构。

所以，我有两个问题：当你们开始新项目时，你们使用什么结构？并且：如果您需要将两种不同的语言集成到 PHP 应用程序中，例如 java 类，该怎么办？PHP文件是源文件，web文件，你用的是/src，/classes，webapps/php？在这种情况下你有什么选择。

作为说明：我也想知道您对目录名称的选择是什么。我喜欢 3 个字母的名称（src、lib、bin、web、img、css、xml、cfg），但您对 libraris、sources 或 htdocs/public_html 等描述性名称有何看法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-12-27T16:57:01.597

在使用不同的结构几年后，我最近发现了一个对我来说拥有最多变化的结构：

```
/project_name     (everything goes here)
  /web            (htdocs)
    /img
    /css
  /app            (usually some framework or sensitive code)
  /lib            (externa libs)
    /vendor_1
    /vendor_2
  /tmp
    /cache
  /sql            (sql scripts usually with maybe diagrams)
  /scripts
  /doc            (usually an empty directory) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-14T02:11:50.657

虽然我们不使用 Maven，但我们使用的是 Maven 目录结构。

我们发现它准确地反映了我们需要的概念（例如，将部署代码与测试代码、代码与数据、安装程序与代码分离）。我们还认为，*如果*有一天我们切换到 Maven，我们的大部分流程将保持不变。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T00:03:02.777

我刚刚在 Zend 网站上找到了一个关于目录结构的有趣文档：http:
[//framework.zend.com/wiki/display/ZFDEV/Choosing+Your+Application%27s+Directory+Layout](http://framework.zend.com/wiki/display/ZFDEV/Choosing+Your+Application%27s+Directory+Layout)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-16T16:55:25.070

2011 年更新：http: [//java.sun.com/blueprints/code/projectconventions.html](http://java.sun.com/blueprints/code/projectconventions.html)

# git - 我如何生成自上次拉动以来发生的变化的 git diff？

> ID：61002
> 
> 赞同：82
> 
> 时间：2008-09-14T00:02:41.420
> 
> 标签：git, diff, rake, pull

我想编写脚本，最好是在 rake 中，将以下操作写入单个命令：

1.  获取我本地 git 存储库的版本。
2.  Git 拉取最新代码。
3.  Git diff 从我在第 1 步中提取的版本到现在在我的本地存储库中的版本。

换句话说，我想从中央存储库中获取最新代码，并立即生成自上次拉取以来更改的差异。

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-09-15T12:21:01.310

您可以使用 refspecs 相当简单地做到这一点。

```
git pull origin
git diff @{1}.. 
```

这将为您提供当前分支在拉取之前和之后存在的差异。请注意，如果 pull 实际上并没有更新当前分支，则 diff 会给您错误的结果。另一种选择是显式记录当前版本：

```
current=`git rev-parse HEAD`
git pull origin
git diff $current.. 
```

我个人使用的别名只是以相反的顺序（即最旧到最新）向我显示自上次拉取以来所有提交的无合并日志。每次拉取更新分支时我都会运行它：

```
git config --global alias.lcrev 'log --reverse --no-merges --stat @{1}.. 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-14T17:14:42.093

[格雷格的](https://stackoverflow.com/questions/61002/how-can-i-generate-a-git-diff-of-whats-changed-since-the-last-time-i-pulled#61004)方式应该有效（不是我，其他格雷格：P）。关于您的评论，origin 是当您将中央存储库克隆到本地计算机时由 Git 设置的配置变量。本质上，Git 存储库会记住它的来源。但是，如果您需要使用 git-config，您可以手动设置这些变量。

```
git config remote.origin.url <url> 
```

其中 url 是中央存储库的远程路径。

这是一个应该可以工作的示例批处理文件（我还没有测试过）。

```
@ECHO off

:: Retrieve the changes, but don't merge them.
git fetch

:: Look at the new changes
git diff ...origin

:: Ask if you want to merge the new changes into HEAD
set /p PULL=Do you wish to pull the changes? (Y/N)
IF /I %PULL%==Y git pull 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-14T00:06:15.030

[这与我询问的关于如何在 git 的分支上进行更改](https://stackoverflow.com/questions/53569/how-to-get-the-changes-on-a-branch-in-git)的问题非常相似。请注意，当使用两个点与三个点时，git diff 与 git log 的行为不一致。但是，对于您的应用程序，您可以使用：

```
git fetch
git diff ...origin 
```

之后，a`git pull`会将更改合并到您的 HEAD 中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-05-14T00:31:19.463

如果你把它放到你的 bash 配置文件中，你将能够运行 grin（git 远程传入）和 grout（git 远程传出）来查看 origin master 的传入和传出提交的差异。

```
function parse_git_branch {
  git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1/'
}
function gd2 { 
 echo branch \($1\) has these commits and \($2\) does not 
 git log $2..$1 --no-merges --format='%h | Author:%an | Date:%ad | %s' --date=local
}
function grin {
 git fetch origin master
 gd2 FETCH_HEAD $(parse_git_branch)
}
function grout {
 git fetch origin master
 gd2 $(parse_git_branch) FETCH_HEAD
} 
```

# php - 如何确定 PHP 脚本的权限设置？

> ID：61005
> 
> 赞同：2
> 
> 时间：2008-09-14T00:09:05.727
> 
> 标签：php

PHP 脚本的最佳文件权限设置是什么？关于确定最低所需权限的方法有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-14T00:11:05.940

脚本运行所需的最低权限。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-14T01:30:59.023

WalloWizard 是正确的，您应该只使用脚本运行所需的最低权限。

但是，让我更具体一些，假设您在基于 Unix 的系统上运行，例如 Linux、BSD 或 Mac OSX。你的网络服务器通常以“nobody”之类的非特权用户身份运行，并且你的脚本需要该用户可读，所以最好的权限通常是 644，这意味着你可以读写脚本，其他人只能读取它.

在脚本由运行 Web 服务器的同一用户拥有的罕见情况下，您可以将权限设置为 600，这样您就可以读取和写入脚本，其他人甚至无法读取它。

# sql-server - 优化性能不佳的查询需要哪些步骤？

> ID：61008
> 
> 赞同：10
> 
> 时间：2008-09-14T00:13:07.073
> 
> 标签：sql-server, optimization

我知道这是一个广泛的问题，但我继承了几个表现不佳的人，需要对它们进行严重优化。我想知道优化所涉及的最常见步骤是什么。那么，你们中的一些人在面对同样的情况时会采取什么措施呢？

> 相关问题：
> [可以应用哪些通用技术来优化 SQL 查询？](https://stackoverflow.com/questions/39331/what-generic-techniques-can-be-applied-to-optimize-sql-queries)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-14T00:24:56.030

1.  查看查询分析器中的执行计划
2.  看看哪一步成本最高
3.  优化步骤！
4.  返回步骤 1 [感谢**Vinko** ]

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-14T02:43:37.553

在 SQL Server 中，您可以在查询分析器或 Management Studio 中查看查询计划。这将告诉您在每批语句中花费的时间的粗略百分比。您需要查找以下内容：

*   表扫描；这意味着您完全缺少索引
*   索引扫描；您的查询可能没有使用正确的索引
*   查询中每个步骤之间的箭头粗细告诉您该步骤生成了多少行，非常粗的箭头表示您正在处理很多行，并且可以指示某些连接需要优化。

其他一些一般提示：

*   大量的条件语句，例如多个 if-else 语句，会导致 SQL Server 不断地重建查询计划。您可以使用 Profiler 进行检查。
*   确保不同的查询不会相互阻塞，例如更新语句会阻塞 select 语句。这可以通过在 SQL Server 选择语句中指定 (nolock) 提示来避免。
*   正如其他人所提到的，请尝试 Management Studio 中的性能调整向导。

最后，我强烈建议您创建一组负载测试（使用 Visual Studio 2008 测试版），您可以使用它们来模拟您的应用程序在处理大量请求时的行为。一些 SQL 性能瓶颈仅在这些情况下才会显现出来，并且能够重现它们使得修复起来容易得多。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-14T00:24:33.223

索引可能是一个很好的起点……

**使用SQL Server**索引**调整向导**可以解决这个容易实现的目标。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-14T04:07:29.100

我不确定其他数据库，但对于 SQL Server，我推荐执行计划。它非常清楚（尽管有很多垂直和水平滚动，除非你有一个 400 英寸的显示器！）显示你的查询的哪些步骤正在消耗时间。

如果你有一个步骤需要疯狂的 80%，那么也许可以添加一个索引，然后在调整索引之后，重新运行执行计划以找到你的下一个最大步骤。

经过几次调整后，您可能会发现确实没有任何步骤可以从其他步骤中脱颖而出，即每个步骤都是 1-2%。如果是这种情况，那么您可能需要查看是否有方法可以减少查询中包含的数据量，是否需要将这 400 万个已关闭的销售订单包含在“活动销售订单”查询中? 不，所以排除所有那些 STATUS='C' ... 或类似的东西。

您将从执行计划中看到的另一个改进是书签查找，基本上它在索引中找到匹配项，但是 SQL Server 必须快速遍历表以找到您想要的记录。此操作有时可能比首先扫描表所花费的时间更长，如果是这种情况，您真的需要该索引吗？

对于索引，特别是对于 SQL Server 2005，您应该查看 INCLUDE 子句，这基本上允许您在索引中拥有一列而不真正在索引中，因此如果您查询所需的所有数据都在您的索引中或是一个包含的列，那么 SQL Server 甚至不必查看表，这是一个很大的性能提升。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-14T15:37:02.297

您可以查看几件事来优化查询性能。

1.  确保您只有最少的数据。确保仅选择所需的列。将字段大小减少到最小。

2.  考虑对数据库进行反规范化以减少连接

3.  避免循环（即获取游标），坚持设置操作。

4.  将查询实现为存储过程，因为这是预编译的，并且执行速度更快。

5.  Make sure that you have the correct indexes set up. If your database is used mostly for searching then consider more indexes.

6.  Use the execution plan to see how the processing is done. What you want to avoid is a table scan as this is costly.

7.  Make sure that the Auto Statistics is set to on. SQL needs this to help decide the optimal execution. See Mike Gunderloy's great post for more info. [Basics of Statistics in SQL Server 2005](http://www.developer.com/db/article.php/10920_3622881_1)

8.  Make sure your indexes are not fragmented [Reducing SQL Server Index Fragmentation](http://www.mssqlcity.com/Articles/Adm/index_fragmentation.htm)

9.  Make sure your tables are not fragmented. [How to Detect Table Fragmentation in SQL Server 2000 and 2005](http://www.sql-server-performance.com/articles/per/detect_fragmentation_sql2000_sql2005_p1.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-14T00:38:06.453

查看进行查询的表上的索引。参与 where 子句的特定字段可能需要索引。还要查看查询中连接中使用的字段（如果存在连接）。如果索引已经存在，请查看索引的类型。

失败（因为使用锁定提示有负面影响）查看锁定提示并明确命名要在连接中使用的索引。如果您遇到大量死锁事务，则使用 NOLOCKS 会更加明显。

做 roman 和 Andy S 首先提到的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-14T02:45:22.853

执行计划是一个很好的开始，它将帮助您确定需要处理的查询部分。

一旦你弄清楚了在哪里，就该解决如何以及为什么了。查看您尝试执行的查询类型。不惜一切代价避免循环，因为它们很慢。不惜一切代价避免使用游标，因为它们很慢。尽可能坚持基于集合的查询。

如果您正在使用连接，有一些方法可以为要使用的连接类型提供 sql 提示。不过这里要小心，虽然一个提示可能会加快您的查询一次，但它可能会在下一次根据数据和参数减慢您的查询 10 倍。

最后，确保您的数据库索引良好。一个好的起点是包含在 where 子句中的任何字段可能应该有一个索引。

# php - 如何检查一个值是否已经存在以避免重复？

> ID：61033
> 
> 赞同：32
> 
> 时间：2008-09-14T01:02:10.107
> 
> 标签：php, sql, mysql

我有一个 URL 表，我不想要任何重复的 URL。如何使用 PHP/MySQL 检查给定的 URL 是否已经在表中？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-09-14T01:20:55.240

如果您不想重复，可以执行以下操作：

*   添加唯一性约束
*   使用“ [REPLACE](http://dev.mysql.com/doc/refman/5.0/en/replace.html) ”或“ [INSERT ... ON DUPLICATE KEY UPDATE](http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html) ”语法

如果多个用户可以将数据插入数据库，@Jeremy Ruten 建议的方法可能会**导致错误**：在您执行检查后，有人可以将类似的数据插入表中。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-08-19T23:02:09.990

要回答您最初的问题，检查是否存在重复的最简单方法是针对您要添加的内容运行 SQL 查询！

例如，如果您想检查`http://www.example.com/`表中的 url `links`，那么您的查询将类似于

```
SELECT * FROM links WHERE url = 'http://www.example.com/'; 
```

你的 PHP 代码看起来像

```
$conn = mysql_connect('localhost', 'username', 'password');
if (!$conn)
{
    die('Could not connect to database');
}
if(!mysql_select_db('mydb', $conn))
{
    die('Could not select database mydb');
}

$result = mysql_query("SELECT * FROM links WHERE url = 'http://www.example.com/'", $conn);

if (!$result)
{
    die('There was a problem executing the query');
}

$number_of_rows = mysql_num_rows($result);

if ($number_of_rows > 0)
{
    die('This URL already exists in the database');
} 
```

我已经在这里写了这个，所有连接到数据库等等。很可能你已经有一个到数据库的连接，所以你应该使用它而不是开始一个新的连接（`$conn`在`mysql_query`命令中替换和删除与`mysql_connect`和有关的东西`mysql_select_db`）

当然，还有其他方法可以连接到数据库，例如 PDO，或使用 ORM 或类似方法，因此如果您已经在使用这些方法，则此答案可能不相关（并且可能超出了给出的范围与此相关的答案在这里！）

然而，MySQL 提供了许多方法来防止这种情况发生。

首先，您可以将字段标记为“唯一”。

假设我有一个表，我想在其中存储从我的站点链接到的所有 URL，以及上次访问它们的时间。

我的定义可能看起来像这样：-

```
CREATE TABLE links
(
    url VARCHAR(255) NOT NULL,
    last_visited TIMESTAMP
) 
```

这将允许我一遍又一遍地添加相同的 URL，除非我编写了一些类似于上面的 PHP 代码来阻止这种情况的发生。

但是，如果我的定义更改为

```
CREATE TABLE links
(
  url VARCHAR(255)  NOT NULL,
  last_visited TIMESTAMP,
  PRIMARY KEY (url)
) 
```

然后，当我尝试两次插入相同的值时，这会使 mysql 抛出错误。

PHP中的一个例子是

```
$result = mysql_query("INSERT INTO links (url, last_visited) VALUES ('http://www.example.com/', NOW()", $conn);

if (!$result)
{
    die('Could not Insert Row 1');
}

$result2 = mysql_query("INSERT INTO links (url, last_visited) VALUES ('http://www.example.com/', NOW()", $conn);

if (!$result2)
{
    die('Could not Insert Row 2');
} 
```

如果你运行它，你会发现在第一次尝试时，脚本会随着注释而死`Could not Insert Row 2`。但是，在随后的运行中，它会随着`Could not Insert Row 1`.

这是因为 MySQL 知道 url 是表的*主*键。主键是该行的唯一标识符。大多数情况下，将行的唯一标识符设置为数字很有用。这是因为 MySQL 查找数字比查找文本更快。在 MySQL 中，键（尤其是主键）用于定义两个表之间的关系。例如，如果我们有一个用户表，我们可以将其定义为

```
CREATE TABLE users (
  username VARCHAR(255)  NOT NULL,
  password VARCHAR(40) NOT NULL,
  PRIMARY KEY (username)
) 
```

但是，当我们想要存储有关用户发布的帖子的信息时，我们必须将用户名与该帖子一起存储，以识别该帖子属于该用户。

我已经提到 MySQL 查找数字比查找字符串要快，所以这意味着我们会在不必要的时候花时间查找字符串。

为了解决这个问题，我们可以添加一个额外的列 user_id，并将其作为主键（这样在根据帖子查找用户记录时，我们可以更快地找到它）

```
CREATE TABLE users (
  user_id INT(10)  NOT NULL AUTO_INCREMENT,
  username VARCHAR(255)  NOT NULL,
  password VARCHAR(40)  NOT NULL,
  PRIMARY KEY (`user_id`)
) 
```

你会注意到我在这里还添加了一些新的东西——AUTO_INCREMENT。这基本上允许我们让该领域自己照顾自己。每次插入新行时，它会将前一个数字加 1，并将其存储起来，因此我们不必担心编号，只需让它自己完成即可。

因此，使用上表，我们可以执行类似的操作

```
INSERT INTO users (username, password) VALUES('Mez', 'd3571ce95af4dc281f142add33384abc5e574671'); 
```

进而

```
INSERT INTO users (username, password) VALUES('User', '988881adc9fc3655077dc2d4d757d480b5ea0e11'); 
```

当我们从数据库中选择记录时，我们得到以下信息：-

```
mysql> SELECT * FROM users;
+---------+----------+------------------------------------------+
| user_id | username | password                                 |
+---------+----------+------------------------------------------+
|       1 | Mez      | d3571ce95af4dc281f142add33384abc5e574671 |
|       2 | User     | 988881adc9fc3655077dc2d4d757d480b5ea0e11 |
+---------+----------+------------------------------------------+
2 rows in set (0.00 sec) 
```

但是，在这里 - 我们有一个问题 - 我们仍然可以添加另一个具有相同用户名的用户！显然，这是我们不想做的事情！

```
mysql> SELECT * FROM users;
+---------+----------+------------------------------------------+
| user_id | username | password                                 |
+---------+----------+------------------------------------------+
|       1 | Mez      | d3571ce95af4dc281f142add33384abc5e574671 |
|       2 | User     | 988881adc9fc3655077dc2d4d757d480b5ea0e11 |
|       3 | Mez      | d3571ce95af4dc281f142add33384abc5e574671 |
+---------+----------+------------------------------------------+
3 rows in set (0.00 sec) 
```

让我们改变我们的表定义！

```
CREATE TABLE users (
  user_id INT(10)  NOT NULL AUTO_INCREMENT,
  username VARCHAR(255)  NOT NULL,
  password VARCHAR(40)  NOT NULL,
  PRIMARY KEY (user_id),
  UNIQUE KEY (username)
) 
```

让我们看看当我们现在尝试插入同一个用户两次时会发生什么。

```
mysql> INSERT INTO users (username, password) VALUES('Mez', 'd3571ce95af4dc281f142add33384abc5e574671');
Query OK, 1 row affected (0.00 sec)

mysql> INSERT INTO users (username, password) VALUES('Mez', 'd3571ce95af4dc281f142add33384abc5e574671');
ERROR 1062 (23000): Duplicate entry 'Mez' for key 'username' 
```

哈扎！！当我们第二次尝试插入用户名时，我们现在得到一个错误。使用类似上面的方法，我们可以在 PHP 中检测到这一点。

现在，让我们回到我们的链接表，但有一个新的定义。

```
CREATE TABLE links
(
    link_id INT(10)  NOT NULL AUTO_INCREMENT,
    url VARCHAR(255)  NOT NULL,
    last_visited TIMESTAMP,
    PRIMARY KEY (link_id),
    UNIQUE KEY (url)
) 
```

让我们将“http://www.example.com”插入数据库。

```
INSERT INTO links (url, last_visited) VALUES ('http://www.example.com/', NOW()); 
```

如果我们尝试再次插入它......

```
ERROR 1062 (23000): Duplicate entry 'http://www.example.com/' for key 'url' 
```

但是如果我们想更新上次访问的时间会发生什么？

好吧，我们可以用 PHP 做一些复杂的事情，比如：-

```
$result = mysql_query("SELECT * FROM links WHERE url = 'http://www.example.com/'", $conn);

if (!$result)
{
    die('There was a problem executing the query');
}

$number_of_rows = mysql_num_rows($result);

if ($number_of_rows > 0)
{
    $result = mysql_query("UPDATE links SET last_visited = NOW() WHERE url = 'http://www.example.com/'", $conn);

    if (!$result)
    {
        die('There was a problem updating the links table');
    }
} 
```

或者，甚至获取数据库中行的 id 并使用它来更新它。

$result = mysql_query("SELECT * FROM links WHERE url = 'http://www.example.com/'", $conn);

```
if (!$result)
{
    die('There was a problem executing the query');
}

$number_of_rows = mysql_num_rows($result);

if ($number_of_rows > 0)
{
    $row = mysql_fetch_assoc($result);

    $result = mysql_query('UPDATE links SET last_visited = NOW() WHERE link_id = ' . intval($row['link_id'], $conn);

    if (!$result)
    {
        die('There was a problem updating the links table');
    }
} 
```

但是，MySQL 有一个很好的内置特性，叫做`REPLACE INTO`

让我们看看它是如何工作的。

```
mysql> SELECT * FROM links;
+---------+-------------------------+---------------------+
| link_id | url                     | last_visited        |
+---------+-------------------------+---------------------+
|       1 | http://www.example.com/ | 2011-08-19 23:48:03 |
+---------+-------------------------+---------------------+
1 row in set (0.00 sec)

mysql> INSERT INTO links (url, last_visited) VALUES ('http://www.example.com/', NOW());
ERROR 1062 (23000): Duplicate entry 'http://www.example.com/' for key 'url'
mysql> REPLACE INTO links (url, last_visited) VALUES ('http://www.example.com/', NOW());
Query OK, 2 rows affected (0.00 sec)

mysql> SELECT * FROM links;
+---------+-------------------------+---------------------+
| link_id | url                     | last_visited        |
+---------+-------------------------+---------------------+
|       2 | http://www.example.com/ | 2011-08-19 23:55:55 |
+---------+-------------------------+---------------------+
1 row in set (0.00 sec) 
```

请注意，使用时`REPLACE INTO`，它更新了 last_visited 时间，并没有抛出错误！

这是因为 MySQL 检测到您正在尝试替换行。它知道您想要的行，因为您已将 url 设置为唯一。MySQL 通过使用您传入的应该是唯一的位（在本例中为 url）并为该行更新其他值来确定要替换的行。它还更新了 link_id - 这有点出乎意料！（事实上​​，直到我看到它发生，我才意识到会发生这种情况！）

但是如果你想添加一个新的 URL 怎么办？好吧，`REPLACE INTO`如果找不到匹配的唯一行，它会很高兴地插入一个新行！

```
mysql> REPLACE INTO links (url, last_visited) VALUES ('http://www.stackoverflow.com/', NOW());
Query OK, 1 row affected (0.00 sec)

mysql> SELECT * FROM links;
+---------+-------------------------------+---------------------+
| link_id | url                           | last_visited        |
+---------+-------------------------------+---------------------+
|       2 | http://www.example.com/       | 2011-08-20 00:00:07 |
|       3 | http://www.stackoverflow.com/ | 2011-08-20 00:01:22 |
+---------+-------------------------------+---------------------+
2 rows in set (0.00 sec) 
```

我希望这能回答您的问题，并为您提供有关 MySQL 工作原理的更多信息！

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-14T01:42:47.810

您是否纯粹关心完全相同字符串的 URL .. 如果是这样，其他答案中有很多好的建议。还是您还必须担心封圣？

例如： http: [//google.com](http://google.com)和[http://go%4fgle.com](http://go%4fgle.com)是完全相同的 URL，但任何仅数据库技术都允许重复。如果这是一个问题，您应该预处理要解析的 URL 和字符转义序列。

根据 URL 的来源，您还必须担心参数以及它们在您的应用程序中是否重要。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-08-17T12:56:25.713

**首先，准备数据库**。

*   域名不区分大小写，但您必须假设 URL 的其余部分是。（并非所有 Web 服务器都尊重 URL 中的大小写，但大多数都这样做，而且您不能通过查看轻易分辨。）
*   假设您需要存储多个域名，请使用区分大小写的排序规则。
*   如果您决定将 URL 存储在两列中（一列用于域名，另一列用于资源定位器），请考虑对域名使用不区分大小写的排序规则，对资源定位器使用区分大小写的排序规则。如果我是你，我会同时测试两种方式（一列中的 URL 与两列中的 URL）。
*   在 URL 列上放置一个 UNIQUE 约束。或者在这对列上，如果您将域名和资源定位器存储在单独的列中，如`UNIQUE (url, resource_locator)`.
*   使用 CHECK() 约束将编码的 URL 保留在数据库之外。这个 CHECK() 约束对于防止坏数据通过大容量复制或通过 SQL shell 进入是必不可少的。

**其次，准备网址**。

*   域名不区分大小写。如果您将完整的 URL 存储在一列中，请将所有 URL 上的域名小写。但请注意，有些语言的大写字母没有小写字母。
*   考虑修剪尾随字符。例如，来自 amazon.com 的这两个 URL 指向同一个产品。您可能想要存储第二个版本，而不是第一个。

    [http://www.amazon.com/Systemantics-Systems-Work-Especially-They/dp/070450331X/ref=sr_1_1?ie=UTF8&qid=1313583998&sr=8-1](https://rads.stackoverflow.com/amzn/click/com/070450331X)

    [http://www.amazon.com/Systemantics-Systems-Work-Especially-They/dp/070450331X](https://rads.stackoverflow.com/amzn/click/com/070450331X)

*   解码编码的 URL。（请参阅[php 的 urldecode() 函数](http://php.net/manual/en/function.urldecode.php)。仔细注意它的缺点，如该页面的注释中所述。）就个人而言，我宁愿在数据库中而不是在客户端代码中处理这些类型的转换。这将涉及撤销对表和视图的权限，并只允许通过存储过程进行插入和更新；存储过程处理将 URL 转换为规范形式的所有字符串操作。但是，当您尝试这样做时，请注意性能。CHECK() 约束（见上文）是您的安全网。

**第三**，如果您只插入 URL，**请先不要测试它的存在**。相反，如果值已经存在，请尝试插入并捕获您将得到的错误。对于每个新 URL，测试和插入都会命中数据库两次。插入和陷阱只命中数据库一次。请注意，插入并陷阱与插入并忽略错误不同。只有一个特定错误意味着您违反了唯一约束；其他错误意味着还有其他问题。

另一方面，如果您在同一行中插入 URL 以及其他一些数据，则需要提前决定是否通过以下方式处理重复的 url

*   删除旧行并插入新行（参见 MySQL[对 SQL 的 REPLACE 扩展](http://dev.mysql.com/doc/refman/5.5/en/replace.html)）
*   更新现有值（参见[ON DUPLICATE KEY UPDATE](http://dev.mysql.com/doc/refman/5.5/en/insert-on-duplicate.html)）
*   无视问题
*   要求用户采取进一步行动

REPLACE 消除了捕获重复键错误的需要，但如果存在外键引用，它可能会产生不幸的副作用。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-09-14T01:31:34.810

为了保证唯一性，您需要添加唯一约束。假设您的表名是“urls”并且列名是“url”，您可以使用这个 alter table 命令添加唯一约束：

```
alter table urls add constraint unique_url unique (url); 
```

如果您的表中已经有重复的 url，alter 表可能会失败（谁真正知道 MySQL）。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-08-17T03:26:40.920

简单的 SQL 解决方案需要一个唯一的字段；逻辑解决方案没有。

您应该标准化您的网址以确保没有重复。PHP 中的函数，例如*strtolower()*和*urldecode()*或*rawurldecode()*。

假设：您的表名是“网站”，您的 url 的列名是“url”，与 url 关联的任意数据在“数据”列中。

**逻辑解决方案**

```
SELECT COUNT(*) AS UrlResults FROM websites WHERE url='http://www.domain.com' 
```

在继续执行 INSERT 语句之前，使用 SQL 或 PHP 中的 if 语句测试之前的查询以确保它为 0。

**简单的 SQL 语句**

**场景 1：**您的数据库是先到先得的表，您不希望将来有重复的条目。

```
ALTER TABLE websites ADD UNIQUE (url) 
```

如果该列中已存在 url 值，这将阻止任何条目输入到数据库中。

**场景 2：**您想要每个 url 的最新信息，并且不想重复内容。这种情况有两种解决方案。（这些解决方案还要求 'url' 是唯一的，因此*方案 1*中的解决方案也需要执行。）

```
REPLACE INTO websites (url, data) VALUES ('http://www.domain.com', 'random data') 
```

如果在所有情况下存在一行后跟一个 INSERT，这将触发一个 DELETE 操作，因此请小心使用 ON DELETE 声明。

```
INSERT INTO websites (url, data) VALUES ('http://www.domain.com', 'random data')
ON DUPLICATE KEY UPDATE data='random data' 
```

如果行存在，这将触发 UPDATE 操作，如果不存在则触发 INSERT。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-08-21T11:45:49.007

在考虑解决此问题时，您需要首先定义“重复 URL”对您的项目意味着什么。这将确定如何在将 URL 添加到数据库之前对其进行[规范化。](https://secure.wikimedia.org/wikipedia/en/wiki/Canonicalization)

至少有两个定义：

1.  如果两个 URL 代表相同的资源，则认为它们是重复的，但它们对生成相应内容的相应 Web 服务一无所知。一些考虑因素包括：
    *   URL 的方案和域名部分不区分大小写，因此[HTTP://WWW.STACKOVERFLOW.COM/与](http://HTTP://WWW.STACKOVERFLOW.COM/)[http://www.stackoverflow.com/](http://www.stackoverflow.com/)相同。
    *   如果一个 URL 指定了一个端口，但它是该方案的常规端口，并且它们在其他方面是等效的，那么它们是相同的（[http://www.stackoverflow.com/](http://www.stackoverflow.com/)和[http://www.stackoverflow.com:80 /](http://www.stackoverflow.com:80/)）。
    *   如果查询字符串中的参数是简单的重新排列并且参数名称都不同，那么它们是相同的；例如[http://authority/?a=test&b=test](http://authority/?a=test&b=test)和[http://authority/?b=test&a=test](http://authority/?b=test&a=test)。请注意，[http://authority/?a%5B%5D=test1&a%5B%5D=test2](http://authority/?a%5B%5D=test1&a%5B%5D=test2)是不一样的，根据相同性的第一个定义，如[http://authority/?a%5B%5D=test2&a% 5B%5D=test1](http://authority/?a%5B%5D=test2&a%5B%5D=test1)。
    *   如果方案是 HTTP 或 HTTPS，则可以删除 URL 的哈希部分，因为这部分 URL 不会发送到 Web 服务器。
    *   可以扩展缩短的 IPv6 地址。
    *   *仅*当权限丢失时，才向权限附加尾部正斜杠。
    *   Unicode 规范化改变了引用的资源；例如，您不能断定[http://google.com/?q=%C3%84](http://google.com/?q=%C3%84)（`%C3%84`在 UTF-8 中表示“Ä”）与[http://google.com/?q=A%CC相同%88](http://google.com/?q=A%CC%88)（`%CC%88`代表 U+0308，组合分音符）。
    *   如果方案是 HTTP 或 HTTPS，`www.`如果两个 URL 等价，则不能简单地删除一个 URL 的权限中的“”，因为域名文本作为`Host`HTTP 标头的值发送，并且一些 Web 服务器使用虚拟主机根据此标头发回不同的内容。更一般地说，即使域名解析到相同的 IP 地址，也不能断定引用的资源相同。
2.  应用基本的 URL 规范化（例如小写方案和域名，提供默认端口，按参数名称稳定排序查询参数，在 HTTP 和 HTTPS 的情况下删除哈希部分，...），*并*考虑到知识网络服务。也许您会假设所有 Web 服务都足够智能以规范化 Unicode 输入（例如，维基百科），因此您可以应用[Unicode 规范化形式](https://secure.wikimedia.org/wikipedia/en/wiki/Unicode_equivalence#Normal_forms)规范组合 (NFC)。`www.`您将从所有 Stack Overflow URL 中删除 ' '。您可以使用移植到 PHP 的 PostRank 的[postrank-uri](https://github.com/postrank-labs/postrank-uri)代码来删除各种不必要的 URL（例如`&utm_source=...`）。

定义 1 导致了一个稳定的解决方案（即没有可以执行的进一步规范化并且 URL 的规范化不会改变）。定义 2，我认为这是人类对 URL 规范化的定义，导致规范化例程可以在不同的时间产生不同的结果。

无论您选择哪种定义，我建议您为方案、登录名、主机、端口和路径部分使用单独的列。这将允许您智能地使用索引。scheme 和 host 的列可以使用字符排序规则（所有字符排序规则在 MySQL 中都是不区分大小写的），但是 login 和 path 的列需要使用二进制的、不区分大小写的排序规则。此外，如果您使用定义 2，则需要保留原始方案、权限和路径部分，因为可能会不时添加或删除某些规范化规则。

**编辑：**这里是示例表定义：

```
CREATE TABLE `urls1` (
    `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
    `scheme` VARCHAR(20) NOT NULL,
    `canonical_login` VARCHAR(100) DEFAULT NULL COLLATE 'utf8mb4_bin',
    `canonical_host` VARCHAR(100) NOT NULL COLLATE 'utf8mb4_unicode_ci', /* the "ci" stands for case-insensitive. Also, we want 'utf8mb4_unicode_ci'
rather than 'utf8mb4_general_ci' because 'utf8mb4_general_ci' treats accented characters as equivalent. */
    `port` INT UNSIGNED,
    `canonical_path` VARCHAR(4096) NOT NULL COLLATE 'utf8mb4_bin',

    PRIMARY KEY (`id`),
    INDEX (`canonical_host`(10), `scheme`)
) ENGINE = 'InnoDB';

CREATE TABLE `urls2` (
    `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
    `canonical_scheme` VARCHAR(20) NOT NULL,
    `canonical_login` VARCHAR(100) DEFAULT NULL COLLATE 'utf8mb4_bin',
    `canonical_host` VARCHAR(100) NOT NULL COLLATE 'utf8mb4_unicode_ci',
    `port` INT UNSIGNED,
    `canonical_path` VARCHAR(4096) NOT NULL COLLATE 'utf8mb4_bin',

    `orig_scheme` VARCHAR(20) NOT NULL, 
    `orig_login` VARCHAR(100) DEFAULT NULL COLLATE 'utf8mb4_bin',
    `orig_host` VARCHAR(100) NOT NULL COLLATE 'utf8mb4_unicode_ci',
    `orig_path` VARCHAR(4096) NOT NULL COLLATE 'utf8mb4_bin',

    PRIMARY KEY (`id`),
    INDEX (`canonical_host`(10), `canonical_scheme`),
    INDEX (`orig_host`(10), `orig_scheme`)
) ENGINE = 'InnoDB'; 
```

表 urls1 用于存储根据定义 1 的规范 URL。表 urls2 用于存储根据定义 2 的规范 URL。

不幸的是，您将无法`UNIQUE`对元组（`scheme`/`canonical_scheme`、`canonical_login`、`canonical_host`、`port`、`canonical_path`）指定约束，因为 MySQL 将 InnoDB 键的长度限制为 767 字节。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-14T01:17:53.737

我不知道 MySQL 的语法，但您需要做的就是用 IF 语句包装您的 INSERT，该语句将查询表并查看具有给定 url 的记录是否存在，如果它存在 - 不要插入新记录。

如果是 MSSQL，你可以这样做：

```
IF NOT EXISTS (SELECT 1 FROM YOURTABLE WHERE URL = 'URL')
INSERT INTO YOURTABLE (...) VALUES (...) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-15T12:22:19.917

如果您想将 url 插入表中，但只有那些不存在的，您可以在列上添加一个 UNIQUE 约束，并在您的 INSERT 查询中添加 IGNORE，这样您就不会收到错误。

示例：INSERT IGNORE INTO `urls`SET url = 'url-to-insert'

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-08-20T00:43:07.347

第一件事。如果您还没有创建表，或者您创建了一个表但其中没有数据，那么您需要添加一个唯一约束或唯一索引。有关在索引或约束之间进行选择的更多信息，请参见文章末尾。但它们都完成了同样的事情，强制该列只包含唯一值。

要在此列上创建具有唯一索引的表，您可以使用。

```
CREATE TABLE MyURLTable(
ID INTEGER NOT NULL AUTO_INCREMENT
,URL VARCHAR(512)
,PRIMARY KEY(ID)
,UNIQUE INDEX IDX_URL(URL)
); 
```

如果您只想要一个唯一约束，并且该表上没有索引，您可以使用

```
CREATE TABLE MyURLTable(
ID INTEGER NOT NULL AUTO_INCREMENT
,URL VARCHAR(512)
,PRIMARY KEY(ID)
,CONSTRAINT UNIQUE UNIQUE_URL(URL)
); 
```

现在，如果您已经有一个表，并且其中没有数据，那么您可以使用以下代码之一将索引或约束添加到表中。

```
ALTER TABLE MyURLTable
ADD UNIQUE INDEX IDX_URL(URL);

ALTER TABLE MyURLTable
ADD CONSTRAINT UNIQUE UNIQUE_URL(URL); 
```

现在，您可能已经有了一个包含一些数据的表。在这种情况下，您可能已经有一些重复的数据。您可以尝试创建上面显示的约束或索引，如果您已经有重复数据，它将失败。如果您没有重复数据，很好，如果有，您将不得不删除重复数据。您可以使用以下查询查看大量带有重复的 url。

```
SELECT URL,COUNT(*),MIN(ID) 
FROM MyURLTable
GROUP BY URL
HAVING COUNT(*) > 1; 
```

要删除重复的行并保留一个，请执行以下操作：

```
DELETE RemoveRecords
FROM MyURLTable As RemoveRecords
LEFT JOIN 
(
SELECT MIN(ID) AS ID
FROM MyURLTable
GROUP BY URL
HAVING COUNT(*) > 1
UNION
SELECT ID
FROM MyURLTable
GROUP BY URL
HAVING COUNT(*) = 1
) AS KeepRecords
ON RemoveRecords.ID = KeepRecords.ID
WHERE KeepRecords.ID IS NULL; 
```

现在您已经删除了所有记录，您可以继续创建索引或约束。现在，如果你想在你的数据库中插入一个值，你应该使用类似的东西。

```
INSERT IGNORE INTO MyURLTable(URL)
VALUES('http://www.example.com'); 
```

这将尝试进行插入，如果找到重复项，则不会发生任何事情。现在，假设你有其他列，你可以做这样的事情。

```
INSERT INTO MyURLTable(URL,Visits) 
VALUES('http://www.example.com',1)
ON DUPLICATE KEY UPDATE Visits=Visits+1; 
```

这看起来会尝试插入值，如果找到 URL，那么它将通过增加访问计数器来更新记录。当然，您总是可以做一个普通的旧插入，并在您的 PHP 代码中处理由此产生的错误。现在，至于是否应该使用约束或索引，这取决于很多因素。索引可以加快查找速度，因此随着表变大，您的性能会更好，但是存储索引会占用额外的空间。索引通常也会使插入和更新花费更长的时间，因为它必须更新索引。但是，由于必须以任何一种方式查找该值，以强制执行唯一性，在这种情况下，无论如何只有索引可能会更快。至于任何与性能相关的东西，

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-14T01:25:59.457

如果您只想要一个是或否的答案，则此语法应该为您提供最佳性能。

```
select if(exists (select url from urls where url = 'http://asdf.com'), 1, 0) from dual
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-14T01:30:38.400

如果您只是想确保没有重复项，则向 url 字段添加唯一索引，这样就无需显式检查 url 是否存在，只需正常插入，如果它已经存在，则插入将因重复键错误而失败。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-15T13:30:59.253

答案取决于您是否想知道何时尝试输入具有重复字段的记录。如果您不在乎，请使用“INSERT ... ON DUPLICATE KEY”语法，因为这将使您的尝试悄悄成功而不会创建重复项。

另一方面，如果您想知道此类事件何时发生并阻止它，那么您应该使用唯一键约束，这将导致尝试的插入/更新失败并出现有意义的错误。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-08-16T21:19:59.803

```
$url = "http://www.scroogle.com";

$query  = "SELECT `id` FROM `urls` WHERE  `url` = '$url' ";
$resultdb = mysql_query($query) or die(mysql_error());   
list($idtemp) = mysql_fetch_array($resultdb) ;

if(empty($idtemp)) // if $idtemp is empty the url doesn't exist and we go ahead and insert it into the db.
{ 
   mysql_query("INSERT INTO urls (`url` ) VALUES('$url') ") or die (mysql_error());
}else{
   //do something else if the url already exists in the DB
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-08-19T13:51:10.073

使列成为`primary key`

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-08-19T23:26:35.023

您可以使用自联接定位（和删除）。您的表格有一些 URL 和一些 PK（我们知道 PK*不是*URL，否则不允许您有重复项）

```
SELECT
    *
FROM
    yourTable a
JOIN
    yourTable b -- Join the same table
        ON b.[URL] = a.[URL] -- where the URL's match
        AND b.[PK] <> b.[PK] -- but the PK's are different 
```

这将返回所有具有重复 URL 的行。

但是，假设您只想选择**重复项**并排除原件.... 那么您需要决定什么是原件。为了这个答案的目的，让我们假设最低 PK 是“原始”

您需要做的就是将以下子句添加到上述查询中：

```
WHERE
    a.[PK] NOT IN (
        SELECT 
            TOP 1 c.[PK] -- Only grabbing the original!
        FROM
            yourTable c
        WHERE
            c.[URL] = a.[URL] -- has the same URL
        ORDER BY
            c.[PK] ASC) -- sort it by whatever your criterion is for "original" 
```

现在您有一组所有非原始重复行。你可以很容易地从这个结果集中执行一个`DELETE`或任何你喜欢的。

请注意，这种方法可能效率低下，部分原因是 mySQL 并不总是处理`IN`得很好，但我从 OP 了解到这是对表的一种“清理”，并不总是检查。

如果你想检查`INSERT`一个值是否已经存在，你可以运行这样的东西

```
SELECT 
    1
WHERE
    EXISTS (SELECT * FROM yourTable WHERE [URL] = 'testValue') 
```

如果你得到一个结果，那么你可以断定数据库中已经存在该值至少一次。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-09-14T01:05:21.067

您可以执行以下查询：

```
SELECT url FROM urls WHERE url = 'http://asdf.com' LIMIT 1 
```

然后检查[mysql_num_rows()](http://php.net/mysql_num_rows) == 1 是否存在。

# html - 浏览器是什么时候开始支持每个标签的多个类的？

> ID：61051
> 
> 赞同：4
> 
> 时间：2008-09-14T01:48:50.650
> 
> 标签：html, css, browser

您可以在当前 Web 浏览器的 HTML 标记中使用多个 css 类，例如：

```
<div class="style1 style2 style3">foo bar</div> 
```

这并不总是有效。主要浏览器从哪个版本开始正确支持此功能？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-14T15:37:48.833

@Wayne Kao - IE6 在一个元素上读取多个类名并应用属于每个类的样式没有问题。文章所指的是基于类名组合创建新样式。

```
<div class="bold italic">content</div>

.bold {
  font-weight: 800;
}

.italic {
  font-style: italic;
{ 
```

IE6 会对 div 应用粗体和斜体样式。但是，假设我们希望所有具有粗体和斜体类的元素也为紫色。在 Firefox（或者可能是 IE7，不确定）中，我们可以这样写：

```
.bold.italic {
  color: purple;
} 
```

这在 IE6 中是行不通的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-14T01:57:55.433

我相信 Firefox 一直支持这一点，至少从 v1.5 开始。IE 仅在 v7 中添加了完全支持。IE6 确实部分支持它，但它有很多错误，所以不要指望它正常工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T02:05:47.630

根据[blooberry](http://www.blooberry.com/indexdot/css/syntax/selectors/spechtml.htm)的说法，IE4 和 Netscape 4.x 不支持这一点。[HTML 4.0 规范](http://www.w3.org/TR/1998/REC-html40-19980424/struct/global.html#h-7.5.2)说

> 类 = cdata 列表 [CS]
> 
> 该属性将一个类名或一组类名分配给一个元素。可以为任意数量的元素分配相同的类名或名称。多个类名必须用空格字符分隔。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-14T01:55:27.687

如果您的 CSS 选择器包含多个类名，显然 IE 6 无法正确处理这些问题： [http ://www.ryanbrill.com/archives/multiple-classes-in-ie/](http://www.ryanbrill.com/archives/multiple-classes-in-ie/)

# .net - 您如何从 .Net Installer 类自定义操作中找出 ProductCode

> ID：61052
> 
> 赞同：1
> 
> 时间：2008-09-14T01:53:28.953
> 
> 标签：.net, installation, windows-installer, action

我需要在 Installer.OnCommitted 回调中知道应用程序的 ProductCode。似乎没有一种明显的方法来确定这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-31T17:08:52.893

您可以避免对产品代码进行硬编码，在 CustomActionData 属性中使用 /productCode=[ProductCode]。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-14T12:18:39.967

我最终使用 Visual Studio 中的 CustomActionData 属性将产品代码作为命令行参数传递给我的安装程序类（例如 /productcode={31E1145F-B833-47c6-8C80-A55F306B8A6C}。然后我可以从使用 Context.Parameters StringDictionary 的安装程序类

```
string productCode = (string)Context.Parameters["productcode"]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T02:24:02.000

MSI 函数 MsiGetProperty 可用于获取 ProductCode 属性的名称。我不知道这在这种情况下是否可行，因为我从未创建过 .NET 安装程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-05-04T13:17:00.410

@Chris Tybur 的建议似乎有效

这是我的 C# 代码：

```
 public static string GetProductCode(string fileName)
        {
            IntPtr hInstall = IntPtr.Zero;
            try
            {
                uint num = MsiOpenPackage(fileName, ref hInstall);
                if ((ulong)num != 0)
                {
                    throw new Exception("Cannot open database: " + num);
                }

                int pcchValueBuf = 255;
                StringBuilder szValueBuf = new StringBuilder(pcchValueBuf);
                num = MsiGetProperty(hInstall, "ProductCode", szValueBuf, ref pcchValueBuf);
                if ((ulong)num != 0)
                {
                    throw new Exception("Failed to Get Property ProductCode: " + num);
                }
                return szValueBuf.ToString();
            }
            finally
            {
                if (hInstall != IntPtr.Zero)
                {
                    MsiCloseHandle(hInstall);
                }
            }
        }

        [DllImport("msi.dll", CharSet = CharSet.Unicode, EntryPoint = "MsiGetPropertyW", ExactSpelling = true, SetLastError = true)]
        private static extern uint MsiGetProperty(IntPtr hInstall, string szName, [Out] StringBuilder szValueBuf, ref int pchValueBuf);
        [DllImport("msi.dll", CharSet = CharSet.Unicode, EntryPoint = "MsiOpenPackageW", ExactSpelling = true, SetLastError = true)]
        private static extern uint MsiOpenPackage(string szDatabasePath, ref IntPtr hProduct);
        [DllImport("msi.dll", CharSet = CharSet.Unicode, ExactSpelling = true, SetLastError = true)]
        private static extern int MsiCloseHandle(IntPtr hAny); 
```

FWIW：此 MSDN 站点上有一个可能引起关注的小信息：[https ://docs.microsoft.com/en-us/windows/win32/msi/obtaining-context-information-for-deferred-execution-自定义动作](https://docs.microsoft.com/en-us/windows/win32/msi/obtaining-context-information-for-deferred-execution-custom-actions)

```
Function    Description
MsiGetProperty  Supports a limited set of properties when used with deferred execution custom actions:
                the CustomActionData property, ProductCode property, and UserSID property.Commit custom
                actions cannot use the MsiGetProperty function to obtain the ProductCode property.
                Commit custom actions can use the CustomActionData property to obtain the product code. 
```

注意呼出`cannot use the MsiGetProperty function to obtain the ProductCode property`。所以YMMV。

查看[如何找到已安装 MSI 设置的产品 G​​UID？](https://stackoverflow.com/questions/29937568/how-can-i-find-the-product-guid-of-an-installed-msi-setup)您可以使用 COM API 来收集它（当前版本显示 VBScript），这可能也值得检查。

# security - 从网络加载程序集

> ID：61057
> 
> 赞同：1
> 
> 时间：2008-09-14T02:02:12.990
> 
> 标签：security, .net-3.5, dll, assemblies, networking

这与[这个问题](https://stackoverflow.com/questions/24468/running-partially-trusted-net-assemblies-from-a-network-share)有关，答案可能相同，但无论如何我都会问。

我知道我们可以从 .NET 3.5 SP1 从网络启动托管可执行文件，但是从可执行文件内部加载的程序集呢？是否同样适用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T11:54:33.360

您至少可以从 .NET 2.0 从网络加载程序集。我在以前的项目中使用过这个。唯一需要注意的是程序集的大小以及它正在加载的依赖项的数量和大小。

如果您使用单独的 AppDomain，则需要特别考虑依赖关系。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-14T02:21:46.780

我的理解是肯定的，您正在尝试将不受信任的模块加载到您的本地应用程序域中。

# c++ - 如何反汇编 VC++ 应用程序？

> ID：61071
> 
> 赞同：4
> 
> 时间：2008-09-14T02:29:06.200
> 
> 标签：c++, resources, reverse-engineering

我相信该应用程序有一些面向 .NET 的部分，而另一些则不是。我对查看资源文件特别感兴趣，如果有的话。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-14T02:41:25.097

如果要使用[IDA](http://www.idapro.ru)反汇编本机 x86/64 应用程序，可以使用 Reflector 反汇编 .NET exe/dll。有[大量](http://www.google.ru/search?complete=1&hl=en&newwindow=1&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=v1M&q=extract+resource+from+exe+file&btnG=%D0%9F%D0%BE%D0%B8%D1%81%D0%BA&lr=&aq=f&oq=)的公用事业可以提取资源。你能详细说明你的问题吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-14T05:24:28.247

为了补充 aku 的出色答案，对于说英语的人，IDA Pro 可在[http://www.hex-rays.com/](http://www.hex-rays.com/)上获得。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T03:55:49.580

查看资源文件并不是真正的“反汇编”（不是真的），如果您只想这样做，您可以在 Visual Studio 或类似工具中打开 .exe 或 .dll ，它会给您一个资源视图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T13:14:01.173

不要被价格吓到，免费软件版本（可从 hex-rays.com 获得）完全足以逆转 Win32 x86 代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T23:34:14.600

如果您想查看汇编代码以及二进制文件的编译/链接方式，我强烈推荐 IDA 进行逆向工程。

要简单地查看“内部”二进制文件（exe、dll、sys、...），请尝试 CFF Explorer，它是免费的，而且很棒： [http://www.ntcore.com/exsuite.php](http://www.ntcore.com/exsuite.php)

您可以非常详细地检查二进制文件结构，包括资源。

如果 CFF Explorer 还不够，那么试试 PE Explorer，它会花费一点： [http ://www.heaventools.com/](http://www.heaventools.com/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T17:52:58.857

PE Explorer 绝对是最好的资源查看工具，但您可能想看看它的“仅资源”版本 - [Resource Tuner](http://www.heaventools.com/resource-tuner.htm)。

# visual-studio-2008 - 如何让我的 VS2008 x86 安装程序在 x64 上安装 x64 程序集？

> ID：61073
> 
> 赞同：5
> 
> 时间：2008-09-14T02:31:05.993
> 
> 标签：visual-studio-2008, installation, windows-installer, x86, 64-bit

我正在使用 VS2008 安装程序（加上自定义 Orca 操作）为我的 .NET 产品创建安装程序。

我最近才发现我使用的第三方程序集之一是特定于 x86 的（因为它包含一些本机代码）；因此，x64 客户在启动时遇到了关于程序集不适合他们的平台的错误。

我向这样的客户发送了一份该第三方程序集的 x64 版本的副本，并告诉他只需将其复制到现有的 x86 版本上即可。成功了，甜！所以现在我只需要让安装程序为我做这件事。

这实际上看起来很重要:(。理想情况下，我只希望安装程序（它将是 x86，因为它可以在两个平台上运行）包含此第三方程序集的 x86 和 x64 版本，并安装适当的一个。在换句话说，我想要一个让我的用户生活更轻松的安装程序。

我以为我已经解决了这个问题，使用 MSI 条件语句等等。但显然不是……除非您指定“x86”或“x64”，否则 VS2008 安装项目将无法编译。如果您指定 x86，它会给出一个编译错误，指出它不能包含 x64 程序集。如果指定 x64，则结果无法在 x86 计算机上执行。该死！

以前一定有人遇到过这个问题。不幸的是，谷歌没有帮助，所以我求助于 StackOverflow！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-14T03:29:06.040

当我在一年前研究这个问题时，我得出的结论是这是不可能的。值得注意的是，许多 Microsoft 提供的 MSI 文件都有不同的 x86 和 x64 风格——而且如果可能的话，他们可能只会提供一个文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T20:40:06.177

如果我对您的理解正确，如果您在 x86 上安装，您想要复制一个文件，如果您在 x64 平台上安装，则需要复制不同的文件（同名）。

首先，您不能为 2 个不同的平台创建一个 MSI，因为 x64 MSI 根本不会在 x86 平台上运行，而 x86 MSI 将在 x64 平台上使用 WOW64 安装。

另一方面，您可以创建一个包含 2 个不同版本文件的 x86 MSI，并在安装期间选择性地复制相应的文件。

最简单的方法是使用 WIX (V3) 而不是内置的 VS2008 MSI 生成器。WIX 让您可以更好地控制在客户机器上安装的内容和位置，能够为不同平台生成不同的安装程序，并提供完整的 MSBuild 支持作为额外奖励。（有关更多信息，请参见[http://wix.sourceforge.net](http://wix.sourceforge.net)。）

如果您想知道 WIX 仍处于 Beta 版，生成的 MSI 文件完全没问题，我还没有遇到过错误。（我以开发设置项目为生。）

最后，您可以使用 VersionNT64 属性检查 x86 安装程序是否在 x64 平台上运行。如果该属性存在，则您正在运行 x64，否则您正在运行 x86。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T21:54:47.667

通过使用两个功能来选择性地包含两组文件（当然，在单独的组件中，使用它们的个性化文件标识符！），我取得了一些成功。

安装必须标记为 x32 才能同时安装在 x32 和 x64 上。它将始终安装到 x32 目录，并在很大程度上被视为在 WOW 下运行的 32 位应用程序。

使用 VersionNT64 属性，您可以确定是否存在 Windows 64 安装，并有条件地安装您需要的文件。

我不确定 VS2008 安装项目中有多少此功能可用 - 我正在使用其他一些商业工具以这种方式设置安装程序。当然，你也可以使用 Orca 来做这件事，尽管让它与商业工具一起工作并非易事，而且 Orca 更难。

# xml - 使用 Linq Xml 的空命名空间

> ID：61084
> 
> 赞同：33
> 
> 时间：2008-09-14T03:03:48.800
> 
> 标签：xml, linq

我正在尝试使用 Linq to Xml 创建一个站点地图，但我得到了一个空的命名空间属性，我想摆脱它。例如

```
XNamespace ns = "http://www.sitemaps.org/schemas/sitemap/0.9";

XDocument xdoc = new XDocument(new XDeclaration("1.0", "utf-8", "true"),
    new XElement(ns + "urlset",

    new XElement("url",
        new XElement("loc", "http://www.example.com/page"),
        new XElement("lastmod", "2008-09-14")))); 
```

结果是……

```
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <url xmlns="">
    <loc>http://www.example.com/page</loc>
    <lastmod>2008-09-14</lastmod>
  </url>
</urlset> 
```

我宁愿在 url 元素上没有 xmlns="" 。我可以在最终的 xdoc.ToString() 上使用 Replace 将其删除，但有更正确的方法吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-14T05:00:22.063

“更正确的方法”是：

```
XDocument xdoc = new XDocument(new XDeclaration("1.0", "utf-8", "true"),
new XElement(ns + "urlset",
new XElement(ns + "url",
    new XElement(ns + "loc", "http://www.example.com/page"),
    new XElement(ns + "lastmod", "2008-09-14")))); 
```

与您的代码相同，但在需要位于站点地图命名空间中的每个元素名称之前都有“ns +”。不将任何不必要的命名空间声明放在生成的 XML 中是足够聪明的，因此结果是：

```
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <url>
    <loc>http://www.example.com/page</loc>
    <lastmod>2008-09-14</lastmod>
  </url>
</urlset> 
```

也就是说，如果我没记错的话，你想要什么。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T13:54:52.283

我在处理 VB.NET 中的类似问题时偶然发现了这篇文章。我使用的是 XML 文字，我花了一些时间来弄清楚如何使这个解决方案与 XML 文字构造一起工作，而不仅仅是功能构造。

解决方案是在文件顶部导入 XML 命名空间。

```
Imports <xmlns:ns="x-schema:tsSchema.xml"> 
```

然后在查询表达式中为我所有的 XML 文字加上导入的命名空间的前缀。这将删除我保存输出时出现在元素上的空命名空间。

```
Dim output As XDocument = <?xml version="1.0" encoding="utf-8"?>
                              <XML ID="Microsoft Search Thesaurus">
                                  <thesaurus xmlns="x-schema:tsSchema.xml">
                                      <diacritics_sensitive>0</diacritics_sensitive>
                                      <%= From tg In termGroups _
                                          Select <ns:expansion>
                                                     <%= From t In tg _
                                                         Select <ns:sub><%= t %></ns:sub> %>
                                                 </ns:expansion> %>
                                  </thesaurus>
                              </XML>

    output.Save("C:\thesaurus.xml") 
```

我希望这可以帮助别人。尽管道路上有这样的颠簸，但 Xlinq API 还是非常酷的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T03:40:46.623

如果一个元素使用命名空间，它们都必须使用一个。如果您没有自己定义一个，框架将添加一个空的命名空间，正如您所注意到的。而且，可悲的是，没有开关或类似的东西来抑制这个“功能”。

所以，似乎没有更好的方法来去除它。使用*Replace(" xmlns=\"\"", "")*可能比执行 RegEx 快一点。

# php - SQLite/PHP 只读？

> ID：61085
> 
> 赞同：9
> 
> 时间：2008-09-14T03:04:29.907
> 
> 标签：php, sqlite, permissions, pdo

我一直在尝试将 SQLite 与 PHP 中的 PDO 包装器一起使用，但效果好坏参半。我可以很好地从数据库中读取，但是当我在浏览器中查看页面时，我的更新都没有提交到数据库中。奇怪的是，从我的 shell 运行脚本确实会更新数据库。我怀疑文件权限是罪魁祸首，但即使数据库提供完全访问权限（chmod 777），问题仍然存在。我应该尝试更改文件所有者吗？如果是这样，该怎么办？

顺便说一句，我的机器是标准的 Mac OS X Leopard 安装并激活了 PHP。

@汤姆马丁

感谢你的回复。我刚刚运行了您的代码，看起来 PHP 以用户 _www 运行。然后我尝试将数据库由_www拥有，但这也不起作用。

我还应该注意 PDO 的 errorInfo 函数并不表示发生了错误。这可能是 PDO 的设置以某种方式打开数据库以进行只读吗？我听说 SQLite 对整个文件执行写锁定。数据库是否有可能被阻止写入的其他东西锁定？

我决定包含有问题的代码。这将或多或少将[格兰特的脚本](https://stackoverflow.com/questions/6936/using-what-ive-learned-from-stackoverflow-html-scraper)移植到 PHP。到目前为止，它只是问题部分：

```
<?php

$db = new PDO('sqlite:test.db');

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, "https://stackoverflow.com/users/658/kyle");
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_COOKIE, "shhsecret=1293706652");
$page = curl_exec($ch);

preg_match('/summarycount">.*?([,\d]+)<\/div>.*?Reputation/s', $page, $rep);
$rep = preg_replace("/,/", "", $rep[1]);

preg_match('/iv class="summarycount".{10,60} (\d+)<\/d.{10,140}Badges/s', $page, $badge);
$badge = $badge[1];

$qreg = '/question-summary narrow.*?vote-count-post"><strong.*?>(-?\d*).*?\/questions\/(\d*).*?>(.*?)<\/a>/s';
preg_match_all($qreg, $page, $questions, PREG_SET_ORDER);

$areg = '/(answer-summary"><a href="\/questions\/(\d*).*?votes.*?>(-?\d+).*?href.*?>(.*?)<.a)/s';
preg_match_all($areg, $page, $answers, PREG_SET_ORDER);

echo "<h3>Questions:</h3>\n";
echo "<table cellpadding=\"3\">\n";

foreach ($questions as $q)
{
    $query = 'SELECT count(id), votes FROM Questions WHERE id = '.$q[2].' AND type=0;';
    $dbitem = $db->query($query)->fetch(PDO::FETCH_ASSOC);
    if ($dbitem['count(id)'] > 0)
    {
        $lastQ = $q[1] - $dbitem['votes'];
        if ($lastQ == 0)
        {
            $lastQ = "";
        }
        $query = "UPDATE Questions SET votes = '$q[1]' WHERE id = '$q[2]'";
        $db->exec($query);
    }
    else
    {
        $query = "INSERT INTO Questions VALUES('$q[3]', '$q[1]', 0, '$q[2]')";
        echo "$query\n";
        $db->exec($query);
        $lastQ = "(NEW)";
    }
    echo "<tr><td>$lastQ</td><td align=\"right\">$q[1]</td><td>$q[3]</td></tr>\n";
}

echo "</table>";

?> 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-14T10:04:25.077

Kyle，为了使 PDO/Sqlite 工作，您需要对数据库所在目录的写入权限。

另外，我看到您在循环中执行多项选择。如果您正在构建小型而不是重载的东西，这可能没问题。否则，我建议构建返回多行并在单独的循环中处理它们的单个查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-25T19:14:58.197

[我在PHP 手册](http://www.php.net/manual/en/ref.pdo-sqlite.php#57356)中找到了答案“存放数据库文件的文件夹必须是可写的。”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-14T03:30:45.540

我认为 PHP 通常以用户“nodody”的身份运行。虽然不确定在Mac上。如果 Mac 有 whoami，您可以尝试`echo exec('whoami');`找出答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-12T15:11:55.647

对于那些在 OS X 上遇到 SQLite 只读问题的人：

1）确定用户所属的Apache **httpd用户和组：**

> grep "^User" /private/etc/apache2/httpd.conf
> 组 _www

**2) 在/Library/WebServer/Documents**中为您的数据库创建一个子目录，并将组更改为 httpd 的组：

> sudo chgrp _www /Library/WebServer/Documents/db

**一个不太安全的选项是在/Library/WebServer/Documents**上打开权限：

> sudo chmod a+w /Library/WebServer/Documents

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-29T19:58:26.093

@Tom 取决于托管的设置方式，如果服务器将 PHP 作为 Apache 模块运行，那么它很可能是“无人”（通常是任何用户 apache 设置为）。但是，如果 PHP 设置为 cgi（例如 fast-cgi）并且服务器运行 SuExec，则 php 以拥有文件的同一用户身份运行。

无论哪种方式，包含数据库的文件夹都必须可由脚本写入，要么是同一用户，要么是为 php 用户设置了写入权限。

@Michal 除此之外，可以使用 beginTransaction(); 执行所有需要的操作然后 commit(); 去实际提交它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-12T17:27:51.183

好吧，我现在遇到了同样的问题，但我错误地解决了这个问题：只需将每条插入的 SQL 指令放在`try...catch`它所在的块中。它使您以正确的方式做事，否则将无法正常工作。好吧，它现在可以工作了。祝其他有这个问题的人好运（因为我自己使用这个线程来尝试解决我的问题）。

# javascript - JavaScript 的隐藏特性？

> ID：61088
> 
> 赞同：312
> 
> 时间：2008-09-14T03:12:50.543
> 
> 标签：javascript, hidden-features

**您认为每个程序员都应该知道 JavaScript 的哪些“隐藏特性”？**

在看到以下问题的优秀答案后，我认为是时候询问 JavaScript 了。

*   [HTML的隐藏特性](https://stackoverflow.com/questions/954327/)
*   [CSS 的隐藏特性](https://stackoverflow.com/questions/628407)
*   [PHP的隐藏特性](https://stackoverflow.com/questions/61401/)
*   [ASP.NET 的隐藏特性](https://stackoverflow.com/questions/54929/)
*   [C#的隐藏特性](https://stackoverflow.com/questions/9033/)
*   [Java的隐藏特性](https://stackoverflow.com/questions/15496/)
*   [Python的隐藏特性](https://stackoverflow.com/questions/101268/)

尽管 JavaScript 可以说是目前最重要的客户端语言（问问 Google），但令人惊讶的是，大多数 Web 开发人员很少意识到它的强大功能。

* * *

## 回答 #1

> 赞同：373
> 
> 时间：2008-09-15T17:43:14.827

您不需要为函数定义任何参数。您可以只使用该函数的`arguments`类似数组的对象。

```
function sum() {
    var retval = 0;
    for (var i = 0, len = arguments.length; i < len; ++i) {
        retval += arguments[i];
    }
    return retval;
}

sum(1, 2, 3) // returns 6 
```

* * *

## 回答 #2

> 赞同：204
> 
> 时间：2008-09-14T18:44:34.873

我可以引用 Douglas Crockford 的大部分优秀著作 [JavaScript: The Good Parts](https://rads.stackoverflow.com/amzn/click/com/0596517742)。

但我只给你一个，总是用`===`and`!==`而不是`==`and`!=`

```
alert('' == '0'); //false
alert(0 == ''); // true
alert(0 =='0'); // true 
```

`==`不是传递的。如果您使用`===`它，那么所有这些陈述都会像预期的那样给出错误的结果。

* * *

## 回答 #3

> 赞同：188
> 
> 时间：2008-09-14T03:18:53.773

函数是 JavaScript 中的一等公民：

```
var passFunAndApply = function (fn,x,y,z) { return fn(x,y,z); };

var sum = function(x,y,z) {
  return x+y+z;
};

alert( passFunAndApply(sum,3,4,5) ); // 12 
```

[函数式编程技术可用于编写优雅的 javascript](http://www.ibm.com/developerworks/library/wa-javascript.html)。

特别是，函数可以作为参数传递，例如[Array.filter()](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/filter)接受回调：

```
[1, 2, -1].filter(function(element, index, array) { return element > 0 });
// -> [1,2] 
```

您还可以声明仅存在于特定函数范围内的“私有”函数：

```
function PrintName() {
    var privateFunction = function() { return "Steve"; };
    return privateFunction();
} 
```

* * *

## 回答 #4

> 赞同：162
> 
> 时间：2008-09-15T17:53:54.580

您可以使用**in**运算符检查对象中是否存在键：

```
var x = 1;
var y = 3;
var list = {0:0, 1:0, 2:0};
x in list; //true
y in list; //false
1 in list; //true
y in {3:0, 4:0, 5:0}; //true 
```

如果你发现对象字面量太难看，你可以将它与无参数函数提示结合使用：

```
function list()
 { var x = {};
   for(var i=0; i < arguments.length; ++i) x[arguments[i]] = 0;
   return x
 }

 5 in list(1,2,3,4,5) //true 
```

* * *

## 回答 #5

> 赞同：153
> 
> 时间：2008-09-14T06:07:56.987

**为变量分配默认值**

[`||`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Operators/Logical_Operators)您可以在赋值表达式中使用逻辑或运算符来提供默认值：

```
var a = b || c; 
```

只有当是*假*的（如果是、、、、或）时，该`a`变量才会获得 的值，否则将获得 的值。`c``b`*`null``false``undefined``0``empty string``NaN``a``b`*

 *这在函数中通常很有用，当您想为参数提供默认值以防万一未提供时：

```
function example(arg1) {
  arg1 || (arg1 = 'default value');
} 
```

事件处理程序中的示例 IE 回退：

```
function onClick(e) {
    e || (e = window.event);
} 
```

* * *

以下语言特性已经存在很长时间了，所有 JavaScript 实现都支持它们，但它们直到[ECMAScript 5th Edition](http://www.ecma-international.org/publications/standards/Ecma-262.htm)才成为规范的一部分：

**`debugger`声明_**

描述于：*§ 12.15 调试器语句*

此语句允许您通过以下方式以编程方式在代码中放置*断点：*

```
// ...
debugger;
// ... 
```

如果调试器存在或处于活动状态，它将导致它立即中断，就在该行。

否则，如果调试器不存在或不活动，则此语句没有可观察到的效果。

**多行字符串文字**

描述于：*§ 7.8.4 字符串文字*

```
var str = "This is a \
really, really \
long line!"; 
```

你必须小心，因为旁边的字符`\` *必须*是一个行终止符，如果你有一个空格`\`，例如，代码*看起来*完全一样，但它会引发一个`SyntaxError`。

* * *

## 回答 #6

> 赞同：145
> 
> 时间：2008-09-14T07:02:15.263

[JavaScript 没有块作用域](http://developer.mozilla.org/En/Core_JavaScript_1.5_Guide:Block_Statement)（但它有[闭包](http://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Functions#Function_expressions)，所以我们甚至称它为？）。

```
var x = 1;
{
   var x = 2;
}
alert(x); // outputs 2 
```

* * *

## 回答 #7

> 赞同：144
> 
> 时间：2008-09-14T04:14:40.893

**`[]`您可以使用而不是访问对象属性`.`**

这允许您查找与变量匹配的属性。

```
obj = {a:"test"};
var propname = "a";
var b = obj[propname];  // "test" 
```

您还可以使用它来获取/设置名称不是合法标识符的对象属性。

```
obj["class"] = "test";  // class is a reserved word; obj.class would be illegal.
obj["two words"] = "test2"; // using dot operator not possible with the space. 
```

有些人不知道这一点并最终像这样使用**eval()**，这是一个*非常糟糕的主意*：

```
var propname = "a";
var a = eval("obj." + propname); 
```

这更难阅读，更难找到错误（不能使用 jslint），执行速度更慢，并且可能导致 XSS 漏洞利用。

* * *

## 回答 #8

> 赞同：144
> 
> 时间：2008-10-01T04:55:13.287

如果您在谷歌上搜索给定主题的合适的 JavaScript 参考，请在查询中包含“mdc”关键字，您的第一个结果将来自 Mozilla 开发人员中心。我没有随身携带任何离线参考资料或书籍。我总是使用“mdc”关键字技巧来直接找到我正在寻找的东西。例如：

Google：[javascript 数组排序 mdc](http://www.google.com/search?q=javascript+array+sort+mdc)
（在大多数情况下，您可以省略“javascript”）

**更新：** Mozilla 开发者**中心**已更名为 Mozilla 开发者**网络**。“mdc”关键字技巧仍然有效，但很快我们可能不得不**开始使用“mdn”代替**。

* * *

## 回答 #9

> 赞同：143
> 
> 时间：2008-09-15T22:27:58.730

也许对某些人来说有点明显......

安装[Firebug](http://en.wikipedia.org/wiki/Firebug_(Firefox_extension))并使用 console.log("hello")。比使用随机警报（）要好得多；我记得几年前做了很多。

* * *

## 回答 #10

> 赞同：120
> 
> 时间：2008-09-14T03:22:43.000

**私有方法**

一个对象可以有私有方法。

```
function Person(firstName, lastName) {
    this.firstName = firstName;
    this.lastName = lastName;

    // A private method only visible from within this constructor
    function calcFullName() {
       return firstName + " " + lastName;    
    }

    // A public method available to everyone
    this.sayHello = function () {
        alert(calcFullName());
    }
}

//Usage:
var person1 = new Person("Bob", "Loblaw");
person1.sayHello();

// This fails since the method is not visible from this scope
alert(person1.calcFullName()); 
```

* * *

## 回答 #11

> 赞同：99
> 
> 时间：2008-09-22T23:06:53.280

Crockford 的“Javascript: The Good Parts”中也提到过：

`parseInt()`很危险。如果您将字符串传递给它而不通知它正确的基数，它可能会返回意外的数字。例如`parseInt('010')`返回 8，而不是 10。将基数传递给 parseInt 使其正常工作：

```
parseInt('010') // returns 8! (in FF3)
parseInt('010', 10); // returns 10 because we've informed it which base to work with. 
```

* * *

## 回答 #12

> 赞同：97
> 
> 时间：2008-09-14T10:48:32.443

函数是对象，因此可以具有属性。

```
fn = 函数（x）{
   // ...
}

fn.foo = 1;

fn.next = 函数（y）{
  //
}

```

* * *

## 回答 #13

> 赞同：91
> 
> 时间：2008-09-24T18:17:04.940

我不得不说自动执行功能。

```
(function() { alert("hi there");})(); 
```

因为 Javascript[没有块作用域](https://stackoverflow.com/questions/61088/hidden-features-of-javascript/61173#61173)，如果要定义局部变量，可以使用自执行函数：

```
(function() {
  var myvar = 2;
  alert(myvar);
})(); 
```

在这里，`myvar`is 不会干扰或污染全局作用域，并且会在函数终止时消失。

* * *

## 回答 #14

> 赞同：83
> 
> 时间：2009-09-02T04:22:59.850

***知道一个函数需要多少个参数***

```
function add_nums(num1, num2, num3 ){
    return num1 + num2 + num3;
}
add_nums.length // 3 is the number of parameters expected. 
```

***知道函数接收了多少参数***

```
function add_many_nums(){
    return arguments.length;
}    
add_many_nums(2,1,122,12,21,89); //returns 6 
```

* * *

## 回答 #15

> 赞同：79
> 
> 时间：2008-09-22T22:13:25.373

这里有一些有趣的事情：

*   与`NaN`任何事物（甚至）进行`NaN`比较总是错误的，包括`==`和。`<``>`
*   `NaN`代表 Not a Number 但如果您询问类型，它实际上会返回一个数字。
*   `Array.sort`可以采用比较器功能并由类似快速排序的驱动程序调用（取决于实现）。
*   正则表达式“常量”可以保持状态，就像它们匹配的最后一个东西一样。
*   某些版本的 JavaScript 允许您访问正则表达式中的`$0`, `$1`,`$2`成员。
*   `null`不同于其他任何东西。它既不是对象、布尔值、数字、字符串，也不是`undefined`. 这有点像“替代品” `undefined`。（注`typeof null == "object"`：）
*   在最外层的上下文中，`this`产生其他无法命名的 [Global] 对象。
*   用 声明一个变量`var`，而不是仅仅依赖于变量的自动声明，让运行时真正有机会优化对该变量的访问
*   该`with`构造将破坏此类优化
*   变量名可以包含 Unicode 字符。
*   JavaScript 正则表达式实际上并不是正则的。它们基于 Perl 的正则表达式，并且可以构造带有前瞻的表达式，这需要非常非常长的时间来评估。
*   块可以被标记并用作`break`. 循环可以被标记并用作 的目标`continue`。
*   数组不是稀疏的。设置一个空数组的第 1000 个元素应该用`undefined`. （取决于实施）
*   `if (new Boolean(false)) {...}` 将执行`{...}`块
*   Javascript 的正则表达式引擎是特定于实现的：例如，可以编写“不可移植”的正则表达式。

*[根据好评进行了一些更新；请看评论]*

* * *

## 回答 #16

> 赞同：77
> 
> 时间：2010-02-11T10:02:10.953

我知道我参加聚会迟到了，但我简直不敢相信`+`除了“将任何东西转换为数字”之外还没有提到运算符的用处。也许这就是它隐藏的功能有多好？

```
// Quick hex to dec conversion:
+"0xFF";              // -> 255

// Get a timestamp for now, the equivalent of `new Date().getTime()`:
+new Date();

// Safer parsing than parseFloat()/parseInt()
parseInt("1,000");    // -> 1, not 1000
+"1,000";             // -> NaN, much better for testing user input
parseInt("010");      // -> 8, because of the octal literal prefix
+"010";               // -> 10, `Number()` doesn't parse octal literals 

// A use case for this would be rare, but still useful in cases
// for shortening something like if (someVar === null) someVar = 0;
+null;                // -> 0;

// Boolean to integer
+true;                // -> 1;
+false;               // -> 0;

// Other useful tidbits:
+"1e10";              // -> 10000000000
+"1e-4";              // -> 0.0001
+"-12";               // -> -12 
```

当然，您可以使用`Number()`代替来完成所有这些操作，但是`+`操作符要漂亮得多！

您还可以通过覆盖原型的`valueOf()`方法为对象定义数字返回值。对该对象执行的任何数字转换都不会产生`NaN`，而是方法的返回值`valueOf()`：

```
var rnd = {
    "valueOf": function () { return Math.floor(Math.random()*1000); }
};
+rnd;               // -> 442;
+rnd;               // -> 727;
+rnd;               // -> 718; 
```

* * *

## 回答 #17

> 赞同：74
> 
> 时间：2008-09-14T04:32:49.633

“ [JavaScript 中的扩展方法](http://codebetter.com/blogs/jeremy.miller/archive/2008/09/08/quot-extension-method-quot-in-javascript.aspx)”通过原型属性。

```
Array.prototype.contains = function(value) {  
    for (var i = 0; i < this.length; i++) {  
        if (this[i] == value) return true;  
    }  
    return false;  
} 
```

这将为所有对象添加一个`contains`方法。`Array`您可以使用此语法调用此方法

```
var stringArray = ["foo", "bar", "foobar"];
stringArray.contains("foobar"); 
```

* * *

## 回答 #18

> 赞同：60
> 
> 时间：2008-10-01T01:05:45.957

要从对象中正确删除属性，您应该删除该属性，而不仅仅是将其设置为*undefined*：

```
var obj = { prop1: 42, prop2: 43 };

obj.prop2 = undefined;

for (var key in obj) {
    ... 
```

属性*prop2*仍将是迭代的一部分。如果你想完全摆脱*prop2*，你应该这样做：

```
delete obj.prop2; 
```

当您遍历属性时，属性*prop2*将不再出现。

* * *

## 回答 #19

> 赞同：57
> 
> 时间：2008-09-14T04:04:01.357

**`with`**.

它很少使用，坦率地说，很少有用......但是，在有限的情况下，它确实有它的用途。

例如：对象字面量对于快速设置*新*对象的属性非常方便。但是，如果您需要更改现有对象的*一半属性怎么办？*

```
var user = 
{
   fname: 'Rocket', 
   mname: 'Aloysus',
   lname: 'Squirrel', 
   city: 'Fresno', 
   state: 'California'
};

// ...

with (user)
{
   mname = 'J';
   city = 'Frostbite Falls';
   state = 'Minnesota';
} 
```

Alan Storm 指出这可能有些危险：如果用作上下文的对象没有*被*分配的属性之一，它将在外部范围内解析，可能会创建或覆盖全局变量。如果您习惯于编写代码来处理具有默认值或空值的属性未定义的对象，这尤其危险：

```
var user = 
{
   fname: "John",
// mname definition skipped - no middle name
   lname: "Doe"
};

with (user)
{
   mname = "Q"; // creates / modifies global variable "mname"
} 
```

因此，避免使用该`with`语句进行此类赋值可能是一个好主意。

### 另请参阅：[JavaScript 的“with”语句是否有合法用途？](https://stackoverflow.com/questions/61552/are-there-legitimate-uses-for-javascripts-with-statement)

* * *

## 回答 #20

> 赞同：51
> 
> 时间：2008-09-19T21:02:48.733

方法（或函数）可以在不属于它们设计使用的类型的对象上调用。在自定义对象上调用本机（快速）方法非常棒。

```
var listNodes = document.getElementsByTagName('a');
listNodes.sort(function(a, b){ ... }); 
```

此代码崩溃，因为`listNodes`不是`Array`

```
Array.prototype.sort.apply(listNodes, [function(a, b){ ... }]); 
```

这段代码之所以有效，是因为它`listNodes`定义了足够多的类似数组的属性（长度、[] 运算符）供`sort()`.

* * *

## 回答 #21

> 赞同：43
> 
> 时间：2008-10-26T23:10:00.020

**原型继承**（由 Douglas Crockford 推广）彻底改变了您对 Javascript 中大量事物的思考方式。

```
Object.beget = (function(Function){
    return function(Object){
        Function.prototype = Object;
        return new Function;
    }
})(function(){}); 
```

这是一个杀手！可惜几乎没有人使用它。

它允许您“产生”任何对象的新实例，扩展它们，同时保持到它们的其他属性的（实时）原型继承链接。例子：

```
var A = {
  foo : 'greetings'
};  
var B = Object.beget(A);

alert(B.foo);     // 'greetings'

// changes and additionns to A are reflected in B
A.foo = 'hello';
alert(B.foo);     // 'hello'

A.bar = 'world';
alert(B.bar);     // 'world'

// ...but not the other way around
B.foo = 'wazzap';
alert(A.foo);     // 'hello'

B.bar = 'universe';
alert(A.bar);     // 'world' 
```

* * *

## 回答 #22

> 赞同：42
> 
> 时间：2008-09-22T19:00:33.590

有些人会称之为品味问题，但是：

```
aWizz = wizz || "default";
// same as: if (wizz) { aWizz = wizz; } else { aWizz = "default"; } 
```

三元运算符可以链接成类似于 Scheme 的 (cond ...)：

```
(cond (predicate  (action  ...))
      (predicate2 (action2 ...))
      (#t         default )) 
```

可以写成...

```
predicate  ? action( ... ) :
predicate2 ? action2( ... ) :
             default; 
```

这是非常“实用的”，因为它分支您的代码而没有副作用。所以而不是：

```
if (predicate) {
  foo = "one";
} else if (predicate2) {
  foo = "two";
} else {
  foo = "default";
} 
```

你可以写：

```
foo = predicate  ? "one" :
      predicate2 ? "two" :
                   "default"; 
```

递归也很好用:)

* * *

## 回答 #23

> 赞同：41
> 
> 时间：2008-09-20T20:56:04.390

数字也是对象。所以你可以做一些很酷的事情，比如：

```
// convert to base 2
(5).toString(2) // returns "101"

// provide built in iteration
Number.prototype.times = function(funct){
  if(typeof funct === 'function') {
    for(var i = 0;i < Math.floor(this);i++) {
      funct(i);
    }
  }
  return this;
}

(5).times(function(i){
  string += i+" ";
});
// string now equals "0 1 2 3 4 "

var x = 1000;

x.times(function(i){
  document.body.innerHTML += '<p>paragraph #'+i+'</p>';
});
// adds 1000 parapraphs to the document 
```

* * *

## 回答 #24

> 赞同：33
> 
> 时间：2008-09-14T07:50:26.100

**JavaScript 中的闭包**怎么样（类似于 C# v2.0+ 中的匿名方法）。您可以创建一个创建函数或“表达式”的函数。

**闭包**示例：

```
//Takes a function that filters numbers and calls the function on 
//it to build up a list of numbers that satisfy the function.
function filter(filterFunction, numbers)
{
  var filteredNumbers = [];

  for (var index = 0; index < numbers.length; index++)
  {
    if (filterFunction(numbers[index]) == true)
    {
      filteredNumbers.push(numbers[index]);
    }
  }
  return filteredNumbers;
}

//Creates a function (closure) that will remember the value "lowerBound" 
//that gets passed in and keep a copy of it.
function buildGreaterThanFunction(lowerBound)
{
  return function (numberToCheck) {
    return (numberToCheck > lowerBound) ? true : false;
  };
}

var numbers = [1, 15, 20, 4, 11, 9, 77, 102, 6];

var greaterThan7 = buildGreaterThanFunction(7);
var greaterThan15 = buildGreaterThanFunction(15);

numbers = filter(greaterThan7, numbers);
alert('Greater Than 7: ' + numbers);

numbers = filter(greaterThan15, numbers);
alert('Greater Than 15: ' + numbers); 
```

* * *

## 回答 #25

> 赞同：32
> 
> 时间：2008-09-14T08:16:20.110

您还可以使用提到的原型链**spoon16****扩展（继承）类并覆盖属性/方法。**

 **在下面的示例中，我们创建了一个 Pet 类并定义了一些属性。我们还覆盖了继承自 Object 的 .toString() 方法。

在此之后，我们创建了一个 Dog 类，它**扩展了 Pet 并覆盖了 .toString()**方法，再次改变了它的行为（多态性）。此外，我们向子类添加了一些其他属性。

在此之后，我们检查继承链以显示 Dog 仍然是 Dog 类型、Pet 类型和 Object 类型。

```
// Defines a Pet class constructor 
function Pet(name) 
{
    this.getName = function() { return name; };
    this.setName = function(newName) { name = newName; };
}

// Adds the Pet.toString() function for all Pet objects
Pet.prototype.toString = function() 
{
    return 'This pets name is: ' + this.getName();
};
// end of class Pet

// Define Dog class constructor (Dog : Pet) 
function Dog(name, breed) 
{
    // think Dog : base(name) 
    Pet.call(this, name);
    this.getBreed = function() { return breed; };
}

// this makes Dog.prototype inherit from Pet.prototype
Dog.prototype = new Pet();

// Currently Pet.prototype.constructor
// points to Pet. We want our Dog instances'
// constructor to point to Dog.
Dog.prototype.constructor = Dog;

// Now we override Pet.prototype.toString
Dog.prototype.toString = function() 
{
    return 'This dogs name is: ' + this.getName() + 
        ', and its breed is: ' + this.getBreed();
};
// end of class Dog

var parrotty = new Pet('Parrotty the Parrot');
var dog = new Dog('Buddy', 'Great Dane');
// test the new toString()
alert(parrotty);
alert(dog);

// Testing instanceof (similar to the `is` operator)
alert('Is dog instance of Dog? ' + (dog instanceof Dog)); //true
alert('Is dog instance of Pet? ' + (dog instanceof Pet)); //true
alert('Is dog instance of Object? ' + (dog instanceof Object)); //true 
```

这个问题的两个答案都是[根据 Ray Djajadinata 的一篇很棒的 MSDN 文章修改的代码。](http://msdn.microsoft.com/en-us/magazine/cc163419.aspx)

* * *

## 回答 #26

> 赞同：31
> 
> 时间：2008-09-22T19:37:49.927

Off the top of my head...

**Functions**

arguments.callee refers to the function that hosts the "arguments" variable, so it can be used to recurse anonymous functions:

```
var recurse = function() {
  if (condition) arguments.callee(); //calls recurse() again
} 
```

That's useful if you want to do something like this:

```
//do something to all array items within an array recursively
myArray.forEach(function(item) {
  if (item instanceof Array) item.forEach(arguments.callee)
  else {/*...*/}
}) 
```

**Objects**

An interesting thing about object members: they can have any string as their names:

```
//these are normal object members
var obj = {
  a : function() {},
  b : function() {}
}
//but we can do this too
var rules = {
  ".layout .widget" : function(element) {},
  "a[href]" : function(element) {}
}
/* 
this snippet searches the page for elements that
match the CSS selectors and applies the respective function to them:
*/
for (var item in rules) {
  var elements = document.querySelectorAll(rules[item]);
  for (var e, i = 0; e = elements[i++];) rules[item](e);
} 
```

**Strings**

*String.split* can take regular expressions as parameters:

```
"hello world   with  spaces".split(/\s+/g);
//returns an array: ["hello", "world", "with", "spaces"] 
```

*String.replace* can take a regular expression as a search parameter and a function as a replacement parameter:

```
var i = 1;
"foo bar baz ".replace(/\s+/g, function() {return i++});
//returns "foo1bar2baz3" 
```

* * *

## 回答 #27

> 赞同：31
> 
> 时间：2009-01-29T01:25:56.593

您可以根据类型捕获异常。引用自[MDC](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Statements/try...catch)：

```
try {
   myroutine(); // may throw three exceptions
} catch (e if e instanceof TypeError) {
   // statements to handle TypeError exceptions
} catch (e if e instanceof RangeError) {
   // statements to handle RangeError exceptions
} catch (e if e instanceof EvalError) {
   // statements to handle EvalError exceptions
} catch (e) {
   // statements to handle any unspecified exceptions
   logMyErrors(e); // pass exception object to error handler
} 
```

**注意：**条件 catch 子句是 Netscape（因此是 Mozilla/Firefox）扩展，它不是 ECMAScript 规范的一部分，因此除了特定浏览器之外不能依赖。

* * *

## 回答 #28

> 赞同：29
> 
> 时间：2009-01-29T01:16:05.893

大多数时候，您可以使用对象而不是开关。

```
function getInnerText(o){
    return o === null? null : {
        string: o,
        array: o.map(getInnerText).join(""),
        object:getInnerText(o["childNodes"])
    }[typeis(o)];
} 
```

更新：如果您担心提前评估的案例效率低下（为什么您在程序设计的早期就担心效率？？）那么您可以执行以下操作：

```
function getInnerText(o){
    return o === null? null : {
        string: function() { return o;},
        array: function() { return o.map(getInnerText).join(""); },
        object: function () { return getInnerText(o["childNodes"]; ) }
    }[typeis(o)]();
} 
```

与开关或对象相比，键入（或读取）更繁重，但它保留了使用对象而不是开关的好处，详见下面的评论部分。这种风格也使得一旦它足够大，就可以更直接地将其旋转成一个适当的“类”。

update2: 建议对 ES.next 进行语法扩展，这变成

```
let getInnerText = o -> ({
    string: o -> o,
    array: o -> o.map(getInnerText).join(""),
    object: o -> getInnerText(o["childNodes"])
}[ typeis o ] || (->null) )(o); 
```

* * *

## 回答 #29

> 赞同：25
> 
> 时间：2008-12-07T12:50:03.333

在遍历对象的属性时，请务必使用**hasOwnProperty方法：**

```
for (p in anObject) {
    if (anObject.hasOwnProperty(p)) {
        //Do stuff with p here
    }
} 
```

这样做是为了让您只访问***anObject*****的直接属性***，而不使用原型链下游的属性。*

 ** * *

## 回答 #30

> 赞同：23
> 
> 时间：2008-09-19T18:41:28.903

具有公共接口的私有变量

它使用了一个带有自调用函数定义的巧妙小技巧。返回的对象内部的所有内容都可以在公共接口中使用，而其他所有内容都是私有的。

```
var test = function () {
    //private members
    var x = 1;
    var y = function () {
        return x * 2;
    };
    //public interface
    return {
        setx : function (newx) {
            x = newx;
        },
        gety : function () {
            return y();
        }
    }
}();

assert(undefined == test.x);
assert(undefined == test.y);
assert(2 == test.gety());
test.setx(5);
assert(10 == test.gety()); 
```

* * *

## 回答 #31

> 赞同：21
> 
> 时间：2008-09-16T22:54:28.033

JavaScript 中的时间戳：

```
// Usual Way
var d = new Date();
timestamp = d.getTime();

// Shorter Way
timestamp = (new Date()).getTime();

// Shortest Way
timestamp = +new Date(); 
```

* * *

## 回答 #32

> 赞同：20
> 
> 时间：2009-05-08T18:34:14.173

您可以使用左侧的 [] 分配局部变量。如果你想从一个函数返回多个值而不创建一个不必要的数组，它会派上用场。

```
function fn(){
    var cat = "meow";
    var dog = "woof";
    return [cat,dog];
};

var [cat,dog] = fn();  // Handy!

alert(cat);
alert(dog); 
```

~~它是核心 JS 的一部分，但不知何故，直到今年我才意识到。~~

* * *

## 回答 #33

> 赞同：19
> 
> 时间：2008-09-15T17:47:02.367

Javascript 中的所有对象都实现为哈希表，因此可以通过索引器访问它们的属性，反之亦然。**此外，您可以使用for/in**运算符枚举所有属性：

```
var x = {a: 0};
x["a"]; //returns 0

x["b"] = 1;
x.b; //returns 1

for (p in x) document.write(p+";"); //writes "a;b;" 
```

* * *

## 回答 #34

> 赞同：17
> 
> 时间：2008-09-23T01:06:46.890

此线程中有几个答案显示了如何通过其原型扩展 Array 对象。这是一个坏主意，因为它破坏了`for (i in a)`陈述。

那么，如果您没有碰巧`for (i in a)` 在代码中的任何地方使用它可以吗？好吧，只有当您自己的代码是您正在运行的唯一代码时，这不太可能在浏览器中。恐怕如果人们开始像这样扩展他们的 Array 对象，Stack Overflow 就会开始溢出一堆神秘的 JavaScript 错误。

[在此处](http://web-graphics.com/2006/05/23/on-modifying-prototypes-of-javascript-built-ins/)查看有用的详细信息。

* * *

## 回答 #35

> 赞同：17
> 
> 时间：2008-12-07T13:01:48.067

当您想从数组中删除一个元素时，可以使用***delete***运算符，如下所示：

```
var numbers = [1,2,3,4,5];
delete numbers[3];
//numbers is now [1,2,3,undefined,5] 
```

如您所见，该元素已被删除，但由于该元素被替换为*未定义*的值，因此在数组中留下了一个洞。

因此，要解决这个问题，而不是使用*delete*，使用***拼接***数组方法......这样：

```
var numbers = [1,2,3,4,5];
numbers.splice(3,1);
//numbers is now [1,2,3,5] 
```

***splice***的第一个参数是数组 [index] 中的序数，第二个参数是要删除的元素数。

* * *

## 回答 #36

> 赞同：16
> 
> 时间：2010-04-25T20:11:58.443

在函数中，您可以返回函数本身：

```
function showSomething(a){
   alert(a);
   return arguments.callee;
}

// Alerts: 'a', 'b', 'c'
showSomething('a')('b')('c');

// Or what about this:
(function (a){
   alert(a);
   return arguments.callee;
}​)('a')('b')('c');​​​​ 
```

不知道什么时候有用，反正很奇怪很有趣：

```
var count = function(counter){
   alert(counter);
   if(counter < 10){
      return arguments.callee(counter+1);
   }
   return arguments.callee;
};

count(5)(9); // Will alert 5, 6, 7, 8, 9, 10 and 9, 10 
```

* * *

实际上，Node.js 的[FAB 框架](https://github.com/jed/fab)似乎已经实现了这个功能；例如，请参阅[此主题](https://stackoverflow.com/questions/3799238/javascript-fab-framework-on-node-js)。

* * *

## 回答 #37

> 赞同：15
> 
> 时间：2008-09-15T17:30:41.533

JavaScript 与 Date() 一起工作的方式让我很兴奋！

```
function isLeapYear(year) {
    return (new Date(year, 1, 29, 0, 0).getMonth() != 2);
} 
```

这确实是“隐藏功能”。

编辑：删除“？” 政策正确性评论中建议的条件。是： ... new Date(year, 1, 29, 0, 0).getMonth() != 2 吗？true : false ... 详情请看评论。

* * *

## 回答 #38

> 赞同：13
> 
> 时间：2008-09-23T19:13:06.233

Here's a couple of shortcuts:

```
var a = []; // equivalent to new Array()
var o = {}; // equivalent to new Object() 
```

* * *

## 回答 #39

> 赞同：13
> 
> 时间：2010-01-12T07:31:29.863

**闭包之禅**

其他人提到了关闭。但令人惊讶的是，有多少人知道闭包，使用闭包编写代码，但仍然对闭包的真正含义有错误的认识。有些人将一等函数与闭包混淆。还有一些人将其视为一种静态变量。

对我来说，闭包是一种*“私有”*全局变量。也就是一种变量，一些函数认为是全局变量，而其他函数看不到。现在，我知道这对底层机制的描述是快速而松散的，但这就是它的感觉和行为方式。为了显示：

```
// Say you want three functions to share a single variable:

// Use a self-calling function to create scope:
(function(){

    var counter = 0; // this is the variable we want to share;

    // Declare global functions using function expressions:
    increment = function(){
        return ++counter;
    }
    decrement = function(){
        return --counter;
    }
    value = function(){
        return counter;
    }
})() 
```

现在是三个函数`increment`，`decrement`并且`value`共享变量`counter`而`counter`不是实际的全局变量。这是闭包的真正本质：

```
increment();
increment();
decrement();
alert(value()); // will output 1 
```

以上并不是真正有用的闭包用法。事实上，我会说以这种方式使用它是一种反模式。但它有助于理解闭包的性质。例如，大多数人在尝试执行以下操作时会被抓住：

```
for (var i=1;i<=10;i++) {
    document.getElementById('span'+i).onclick = function () {
        alert('this is span number '+i);
    }
}
// ALL spans will generate alert: this span is span number 10 
```

那是因为他们不了解闭包的本质。他们认为他们将值传递给`i`函数，而实际上函数共享一个变量`i`。就像我之前说的，一种特殊的全局变量。

为了解决这个问题，您需要*分离** 闭包：

```
function makeClickHandler (j) {
    return function () {alert('this is span number '+j)};
}

for (var i=1;i<=10;i++) {
    document.getElementById('span'+i).onclick = makeClickHandler(i);
}
// this works because i is passed by reference 
// (or value in this case, since it is a number)
// instead of being captured by a closure 
```

*注意：我不知道这里的正确术语。

* * *

## 回答 #40

> 赞同：13
> 
> 时间：2009-09-22T19:58:49.643

My favorite trick is using `apply` to perform a callback to an object's method and maintain the correct "this" variable.

```
function MakeCallback(obj, method) {
    return function() {
        method.apply(obj, arguments);
    };
}

var SomeClass = function() { 
     this.a = 1;
};
SomeClass.prototype.addXToA = function(x) {
     this.a = this.a + x;
};

var myObj = new SomeClass();

brokenCallback = myObj.addXToA;
brokenCallback(1); // Won't work, wrong "this" variable
alert(myObj.a); // 1

var myCallback = MakeCallback(myObj, myObj.addXToA);
myCallback(1);  // Works as expected because of apply
alert(myObj.a); // 2 
```

* * *

## 回答 #41

> 赞同：12
> 
> 时间：2009-03-28T07:21:48.400

您永远不必使用`eval()`来组装全局变量名。

也就是说，如果您有多个名为 的全局变量（无论出于何种原因）`spec_grapes, spec_apples`，则不必使用`eval("spec_" + var)`.

所有全局变量都是 的成员`window[]`，所以你可以这样做`window["spec_" + var]`。

* * *

## 回答 #42

> 赞同：11
> 
> 时间：2008-09-30T10:43:20.477

为 Firebug 使用 console.log() 时，防止在 Internet Explorer 中测试时出现恼人的错误：

```
function log(message) {
    (console || { log: function(s) { alert(s); }).log(message);
} 
```

* * *

## 回答 #43

> 赞同：11
> 
> 时间：2008-09-15T18:25:27.080

JavaScript 使用一个简单的对象字面量：

```
var x = { intValue: 5, strValue: "foo" }; 
```

这构造了一个成熟的对象。

JavaScript 使用基于原型的面向对象并提供在运行时扩展类型的能力：

```
String.prototype.doubleLength = function() {
    return this.length * 2;
}

alert("foo".doubleLength()); 
```

一个对象将所有对其不包含自身的属性的访问委托给它的“原型”，即另一个对象。这可以用来实现继承，但实际上更强大（即使更麻烦）：

```
/* "Constructor" */
function foo() {
    this.intValue = 5;
}

/* Create the prototype that includes everything
 * common to all objects created be the foo function.
 */
foo.prototype = {
    method: function() {
        alert(this.intValue);
    }
}

var f = new foo();
f.method(); 
```

* * *

## 回答 #44

> 赞同：10
> 
> 时间：2008-09-16T02:39:06.877

我的最爱之一是构造函数类型检查：

```
function getObjectType( obj ) {  
    return obj.constructor.name;  
}  

window.onload = function() {  
    alert( getObjectType( "Hello World!" ) );  
    function Cat() {  
        // some code here...  
    }  
    alert( getObjectType( new Cat() ) );  
} 
```

因此，您通常可以使用 typeof 关键字来代替旧的 [Object object]，而实际上可以根据构造函数获得真正的对象类型。

另一种是使用可变参数作为“重载”函数的一种方式。您所做的只是使用表达式来检测参数的数量并返回重载输出：

```
function myFunction( message, iteration ) {  
    if ( arguments.length == 2 ) {  
        for ( i = 0; i < iteration; i++ ) {  
            alert( message );  
        }  
    } else {  
        alert( message );  
    }  
}  

window.onload = function() {  
    myFunction( "Hello World!", 3 );  
} 
```

最后，我会说赋值运算符的简写。我从 jQuery 框架的源代码中学到了这一点……老方法：

```
var a, b, c, d;
b = a;
c = b;
d = c; 
```

新的（速记）方式：

```
var a, b, c, d;
d = c = b = a; 
```

好开心 ：）

* * *

## 回答 #45

> 赞同：10
> 
> 时间：2008-09-21T05:40:50.633

如果你用逗号分隔语句，你几乎可以在括号之间做任何事情：

```
var z = ( x = "can you do crazy things with parenthesis", ( y = x.split(" "), [ y[1], y[0] ].concat( y.slice(2) ) ).join(" ") )

alert(x + "\n" + y + "\n" + z) 
```

输出：

```
can you do crazy things with parenthesis
can,you,do,crazy,things,with,parenthesis
you can do crazy things with parenthesis 
```

* * *

## 回答 #46

> 赞同：10
> 
> 时间：2009-06-22T00:28:32.673

JavaScript 中最快的循环是 while(i--) 循环。在所有浏览器中。因此，如果处理循环元素的顺序不是那么重要，则应该使用 while(i--) 形式：

```
var names = new Array(1024), i = names.length;
while(i--)
  names[i] = "John" + i; 
```

此外，如果您必须使用 for() 循环，请记住始终缓存 .length 属性：

```
var birds = new Array(1024); 
for(var i = 0, j = birds.length; i < j; i++)
  birds[i].fly(); 
```

要加入大字符串，请使用数组（它更快）：

```
var largeString = new Array(1024), i = largeString.length;
while(i--) {
  // It's faster than for() loop with largeString.push(), obviously :)
  largeString[i] = i.toString(16);
}

largeString = largeString.join(""); 
```

`largeString += "something"`它比循环内快得多。

* * *

## 回答 #47

> 赞同：9
> 
> 时间：2008-11-19T16:44:38.013

`window.name`的值在页面更改中保持不变，如果在同一域中（如果在 iframe 中，则`document.getElementById("your frame's ID").contentWindow.name`用于访问它）可以由父窗口读取，并且仅受可用内存的限制。

* * *

## 回答 #48

> 赞同：9
> 
> 时间：2008-09-21T21:57:23.827

真值和假值的概念。你不需要做类似的事情

if(someVar === undefined || someVar === null) ...

只需这样做：

如果（！someVar）。

每个值都有对应的布尔表示。

* * *

## 回答 #49

> 赞同：9
> 
> 时间：2009-04-08T19:09:53.937

创建新“对象”时，括号是可选的。

```
function Animal () {

}

var animal = new Animal();
var animal = new Animal; 
```

一样。

* * *

## 回答 #50

> 赞同：9
> 
> 时间：2008-10-22T02:08:05.473

函数语句和函数表达式的处理方式不同。

```
function blarg(a) {return a;} // statement
bleep = function(b) {return b;} //expression 
```

在代码运行之前解析所有函数语句 - JavaScript 文件底部的函数将在第一个语句中可用。另一方面，它将无法利用某些动态上下文，例如周围`with`的语句 -`with`解析函数时尚未执行。

函数表达式在遇到它们的地方内联执行。在此之前它们不可用，但它们可以利用动态上下文。

* * *

## 回答 #51

> 赞同：8
> 
> 时间：2008-10-01T00:37:37.227

`let`.

JavaScript 1.7中[引入了](http://developer.mozilla.org/en/New_in_JavaScript_1.7#Block_scope_with_let)[var 缺乏块作用域的](https://stackoverflow.com/questions/61088/hidden-features-of-javascript#61173)对应物。`let`

> *   let 语句提供了一种将值与块范围内的变量相关联的方法，而不会影响块外同名变量的值。
> *   let 表达式允许您建立仅作用于单个表达式的变量。
> *   let 定义定义了变量，其范围被限制在定义它们的块中。此语法非常类似于用于 var 的语法。
> *   您还可以使用 let 建立仅存在于 for 循环上下文中的变量。

```
 function varTest() {
        var x = 31;
    if (true) {
      var x = 71;  // same variable!
      alert(x);  // 71
    }
    alert(x);  // 71
  }

  function letTest() {
    let x = 31;
    if (true) {
      let x = 71;  // different variable
      alert(x);  // 71
    }
    alert(x);  // 31
  } 
```

自 2008 年起，FireFox 2.0+ 和 Safari 3.x 支持 JavaScript 1.7。

* * *

## 回答 #52

> 赞同：8
> 
> 时间：2008-09-14T19:26:28.410

Javascript 在函数中有静态变量：

```
function someFunction(){
  var Static = arguments.callee;
  Static.someStaticVariable = (Static.someStaticVariable || 0) + 1;
  alert(Static.someStaticVariable);
}
someFunction() //Alerts 1
someFunction() //Alerts 2
someFunction() //Alerts 3 
```

它在对象内部也有静态变量：

```
function Obj(){
  this.Static = arguments.callee;
}
a = new Obj();
a.Static.name = "a";
b = new Obj();
alert(b.Static.name); //Alerts b 
```

* * *

## 回答 #53

> 赞同：8
> 
> 时间：2008-09-27T13:45:14.730

== 运算符有一个非常特殊的属性，它创建了这种令人不安的相等性（是的，我知道在 Perl 等其他动态语言中会出现这种行为，但 JavaScript 通常不会尝试在比较中变得聪明）：

```
>>> 1 == true
true
>>> 0 == false
true
>>> 2 == true
false 
```

* * *

## 回答 #54

> 赞同：8
> 
> 时间：2009-06-21T21:43:33.973

如果您尝试对 javascript 代码进行沙箱处理，并禁用将字符串评估为 javascript 代码的所有可能方式，请注意阻止所有明显的 eval/document.write/new Function/setTimeout/setInterval/innerHTML 和其他 DOM 操作足够的。

给定任何对象 o，`o.constructor.constructor("alert('hi')")()`将弹出一个警告对话框，其中包含单词“hi”。

您可以将其重写为

```
var Z="constructor";
Z[Z][Z]("alert('hi')")(); 
```

好玩的东西。

* * *

## 回答 #55

> 赞同：8
> 
> 时间：2008-10-01T16:20:13.593

如果你盲目地`eval()`对一个 JSON 字符串进行反序列化，你可能会遇到问题：

1.  它不安全。该字符串可能包含恶意函数调用！
2.  如果您不将 JSON 字符串括在括号中，则属性名称可能会被误认为是标签，从而导致意外行为或语法错误：

    ```
    eval("{ \"foo\": 42 }"); // syntax error: invalid label
    eval("({ \"foo\": 42 })"); // OK 
    ```

* * *

## 回答 #56

> 赞同：8
> 
> 时间：2008-09-22T12:54:23.627

您可以在任何对象上执行对象的方法，无论它是否具有该方法。当然，它可能并不总是有效（如果该方法假定对象具有它没有的东西），但它可能非常有用。例如：

```
function(){
    arguments.push('foo') // This errors, arguments is not a proper array and has no push method
    Array.prototype.push.apply(arguments, ['foo']) // Works!
} 
```

* * *

## 回答 #57

> 赞同：8
> 
> 时间：2008-09-15T17:39:23.447

所有函数实际上都是内置**Function**类型的实例，它有一个构造函数，该构造函数接受一个包含函数定义的字符串，因此您实际上可以在运行时通过例如连接字符串来定义函数：

```
//e.g., createAddFunction("a","b") returns function(a,b) { return a+b; }
function createAddFunction(paramName1, paramName2)
 { return new Function( paramName1, paramName2
                       ,"return "+ paramName1 +" + "+ paramName2 +";");
 } 
```

此外，对于用户定义的函数，**Function.toString()**将函数定义作为文字字符串返回。

* * *

## 回答 #58

> 赞同：8
> 
> 时间：2009-01-29T05:12:21.860

您可以将具有整数属性和长度属性的“任何*对象”转换为适当的数组，从而赋予它所有数组方法，例如 push、pop、splice、map、filter、reduce 等。

```
Array.prototype.slice.call({"0":"foo", "1":"bar", 2:"baz", "length":3 }) 
```

// 返回 ["foo", "bar", "baz"]

这适用于来自其他框架的 jQuery 对象、html 集合和 Array 对象（作为整个数组类型事物的一种可能解决方案）。我说，如果它有一个长度属性，你可以把它变成一个数组，没关系。除了参数对象之外，还有许多具有长度属性的非数组对象。

* * *

## 回答 #59

> 赞同：7
> 
> 时间：2008-09-16T23:19:37.800

Function.toString()（隐式）：

```
function x() {
    alert("Hello World");
}
eval ("x = " + (x + "").replace(
    'Hello World',
    'STACK OVERFLOW BWAHAHA"); x("'));
x(); 
```

* * *

## 回答 #60

> 赞同：7
> 
> 时间：2009-01-05T20:59:30.617

微软[给 JavaScript 的礼物](http://en.wikipedia.org/wiki/XMLHttpRequest)：AJAX

```
AJAXCall('http://www.abcd.com/')

function AJAXCall(url) {
 var client = new XMLHttpRequest();
 client.onreadystatechange = handlerFunc;
 client.open("GET", url);
 client.send();
}

function handlerFunc() {
 if(this.readyState == 4 && this.status == 200) {
 if(this.responseXML != null)
   document.write(this.responseXML)
 }
} 
```

* * *

## 回答 #61

> 赞同：7
> 
> 时间：2009-07-31T10:43:10.450

**模块[模式](http://yuiblog.com/blog/2007/06/12/module-pattern/)**

```
<script type="text/javascript">
(function() {

function init() {
  // ...
}

window.onload = init;
})();
</script> 
```

没有声明或在函数外部声明的变量和函数`var`将在全局范围内定义。如果同名的变量/函数已经存在，它将被静默覆盖，这可能导致很难找到错误。一个常见的解决方案是将整个代码体包装成一个匿名函数并立即执行它。这样，所有变量/函数都在匿名函数的范围内定义，并且不会泄漏到全局范围内。

要在全局范围内显式定义变量/函数，它们必须带有前缀`window`：

```
window.GLOBAL_VAR = 12;
window.global_function = function() {}; 
```

* * *

## 回答 #62

> 赞同：7
> 
> 时间：2010-05-27T12:32:30.063

这是 jQuery 的一个隐藏功能，而不是 Javascript，但因为永远不会有“jQuery 的隐藏功能”问题......

`:something`您可以在 jQuery中定义自己的选择器：

```
$.extend($.expr[':'], {
  foo: function(node, index, args, stack) {
    // decide if selectors matches node, return true or false
  }
}); 
```

对于使用 的选择`:foo`，例如，将为与选择器的已处理部分匹配的所有节点调用`$('div.block:foo("bar,baz") span')`该函数。`foo`参数的含义：

*   `node`持有当前节点
*   `index`是节点集中节点的索引
*   `args`如果选择器有一个参数或多个名称，则该数组很有用：
    *   `args[0]`是整个选择器文本（例如`:foo("bar, baz")`）
    *   `args[1]`是选择器名称（例如`foo`）
    *   `args[2]`是用于包装参数的引号字符（例如`"`for `:foo("bar, baz")`），如果没有引号 ( )，则为空字符串；如果`:foo(bar, baz)`没有参数，则为 undefined
    *   `args[3]`是参数，包括任何引号，（例如`"bar, baz"`）或 undefined 如果没有参数
*   `stack`是节点集（包含在该点匹配的所有节点的数组）

`true`如果选择器匹配，则该函数应返回，`false`否则。

例如，以下代码将启用基于全文正则表达式搜索的节点选择：

```
$.extend($.expr[':'], {
  matches: function(node, index, args, stack) {
    if (!args.re) { // args is a good place for caching
      var re = args[3];
      if (args[2]) { // get rid of quotes
        re = re.slice(1,-1);
      }
      var separator = re[0];
      var pos = re.lastIndexOf(separator);
      var modifiers = re.substr(pos+1);
      var code = re.substr(1, pos-1);
      args.re = new RegExp(code, modifiers);
    }
    return $(node).text().match(args.re);
  }
});

// find the answers on this page which contain /**/-style comments
$('.answer .post-text code:matches(!/\\*[\\s\\S]*\\*/!)'); 
```

[您可以使用.filter()](http://api.jquery.com/filter/)的回调版本达到类似的效果，但自定义选择器更加灵活并且通常更具可读性。

* * *

## 回答 #63

> 赞同：6
> 
> 时间：2008-09-15T16:25:36.137

`undefined`未定义。所以你可以这样做：

```
if (obj.field === undefined) /* ... */ 
```

* * *

## 回答 #64

> 赞同：6
> 
> 时间：2008-10-01T00:51:57.940

[生成器和迭代器](http://developer.mozilla.org/en/New_in_JavaScript_1.7#Generators_and_iterators)（仅适用于 Firefox 2+ 和 Safari）。

```
function fib() {
  var i = 0, j = 1;
  while (true) {
    yield i;
    var t = i;
    i = j;
    j += t;
  }
}

var g = fib();
for (var i = 0; i < 10; i++) {
  document.write(g.next() + "<br>\n");
} 
```

> 包含`yield` 关键字的函数是生成器。当你调用它时，它的形式参数绑定到实际参数，但它的主体实际上并没有被评估。相反，会返回一个生成器迭代器。对生成器迭代器方法的每次调用都会 `next()`通过迭代算法执行另一次传递。每个步骤的值是`yield`关键字指定的值。可以将`yield`其视为生成器-迭代器版本的 return，指示算法每次迭代之间的边界。每次调用`next()`时，生成器代码都会从`yield`.
> 
> 在正常使用中，迭代器对象是“不可见的”；您不需要显式地对它们进行操作，而是使用 JavaScript`for...in`和`for each...in`语句自然地循环遍历对象的键和/或值。

```
var objectWithIterator = getObjectSomehow();

for (var i in objectWithIterator)
{
  document.write(objectWithIterator[i] + "<br>\n");
} 
```

* * *

## 回答 #65

> 赞同：6
> 
> 时间：2008-09-22T16:09:12.767

访问：

*   [http://images.google.com/images?q=disco](http://images.google.com/images?q=disco)

将此 JavaScript 代码粘贴到 Web 浏览器的地址栏中：

*   [http://amix.dk/upload/awt/spin.txt](http://amix.dk/upload/awt/spin.txt)
*   [http://amix.dk/upload/awt/disco.txt](http://amix.dk/upload/awt/disco.txt)

享受 JavaScript 迪斯科表演：-p

* * *

## 回答 #66

> 赞同：5
> 
> 时间：2008-09-22T15:41:52.973

All your "hidden" features are right here on the Mozilla wiki: [http://developer.mozilla.org/en/JavaScript](http://developer.mozilla.org/en/JavaScript).

There's [the core JavaScript 1.5 reference](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference), [what's new in JavaScript 1.6](http://developer.mozilla.org/en/New_in_JavaScript_1.6), what's [new in JavaScript 1.7](http://developer.mozilla.org/en/New_in_JavaScript_1.7), and also what's [new in JavaScript 1.8](http://developer.mozilla.org/en/New_in_JavaScript_1.8). Look through all of those for examples that actually work and are *not* wrong.

* * *

## 回答 #67

> 赞同：5
> 
> 时间：2008-09-16T19:09:50.677

这个是超级隐藏的，只是偶尔有用;-)

您可以使用原型链创建一个委托给另一个对象的对象，而无需更改原始对象。

```
var o1 = { foo: 1, bar: 'abc' };
function f() {}
f.prototype = o1;
o2 = new f();
assert( o2.foo === 1 );
assert( o2.bar === 'abc' );
o2.foo = 2;
o2.baz = true;
assert( o2.foo === 2 );
// o1 is unchanged by assignment to o2
assert( o1.foo === 1 );
assert( o2.baz ); 
```

这仅涵盖 o1 上的“简单”值。如果你修改了一个数组或另一个对象，那么原型就不再“保护”原始对象。当您在类定义/原型中有 {} 或 [] 时请注意。

* * *

## 回答 #68

> 赞同：5
> 
> 时间：2009-07-31T10:56:13.777

**[命名空间](http://www.dustindiaz.com/namespace-your-javascript/)**

在较大的 JavaScript 应用程序或框架中，在命名空间中组织代码会很有用。JavaScript 没有内置模块或命名空间概念，但使用 JavaScript 对象很容易模拟。这将创建一个名为的命名空间`ns`并将函数附加`foo`到它。

```
if (!window.ns) {
  window.ns = {};
}

window.ns.foo = function() {}; 
```

在整个项目中使用相同的全局命名空间前缀并为每个 JavaScript 文件使用子命名空间是很常见的。子命名空间的名称通常与文件名匹配。

名为的文件的标题`ns/button.js`可能如下所示：

```
if (!window.ns) {
  window.ns = {};
}
if (!window.ns.button) {
  window.ns.button = {};
}

// attach methods to the ns.button namespace
window.ns.button.create = function() {}; 
```

* * *

## 回答 #69

> 赞同：4
> 
> 时间：2008-09-14T06:42:19.010

令人惊讶的是，有多少人没有意识到它也是面向对象的。

* * *

## 回答 #70

> 赞同：4
> 
> 时间：2009-01-20T11:22:22.033

大循环在 - 条件下和向后更快`while`- 也就是说，如果循环的顺序对您无关紧要。在我大约 50% 的代码中，它通常不会。

IE

```
var i, len = 100000;

for (var i = 0; i < len; i++) {
  // do stuff
} 
```

慢于：

```
i = len;
while (i--) {
  // do stuff
} 
```

* * *

## 回答 #71

> 赞同：4
> 
> 时间：2009-09-12T23:05:35.943

这些并不*总是*一个好主意，但您可以使用简洁的表达式转换大多数内容。这里重要的一点是，并非 JavaScript 中的每个值都是对象，因此这些表达式将在对 null 和 undefined 等非对象的成员访问失败的情况下成功。特别要注意 typeof null == "object"，但不能 null.toString() 或 ("name" in null)。

将任何内容转换为数字：

```
+anything
Number(anything) 
```

将任何内容转换为无符号的四字节整数：

```
anything >>> 0 
```

将任何内容转换为字符串：

```
'' + anything
String(anything) 
```

将任何内容转换为布尔值：

```
!!anything
Boolean(anything) 
```

此外，使用不带“new”的类型名称对于 String、Number 和 Boolean 的行为不同，返回原始数字、字符串或布尔值，但使用“new”这些将返回“装箱”对象类型，这几乎是无用的。

* * *

## 回答 #72

> 赞同：4
> 
> 时间：2008-10-08T12:30:25.690

**jQuery 和 JavaScript：**

变量名可以包含许多奇数字符。我使用 $ 字符来识别包含 jQuery 对象的变量：

```
var $links = $("a");

$links.hide(); 
```

jQuery 的对象链接模式非常好，但是应用这种模式会有点混乱。幸运的是，JavaScript 允许您换行，如下所示：

```
$("a")
.hide()
.fadeIn()
.fadeOut()
.hide(); 
```

**通用 JavaScript：**

我发现使用自执行函数来模拟作用域很有用：

```
function test()
{
    // scope of test()

    (function()
    {
        // scope inside the scope of test()
    }());

    // scope of test()
} 
```

* * *

## 回答 #73

> 赞同：3
> 
> 时间：2009-04-08T18:50:35.060

## 您可以使用“for in”遍历数组

Mark Cidade 指出了“for in”循环的用处：

```
// creating an object (the short way, to use it like a hashmap)
var diner = {
"fruit":"apple"
"veggetable"="bean"
}

// looping over its properties
for (meal_name in diner ) {
    document.write(meal_name+"<br \n>");
} 
```

结果 ：

```
fruit
veggetable 
```

但还有更多。由于您可以使用关联数组之类的对象，因此您可以处理键和值，就像 foreach 循环一样：

```
// looping over its properties and values
for (meal_name in diner ) {
    document.write(meal_name+" : "+diner[meal_name]+"<br \n>");
} 
```

结果 ：

```
fruit : apple
veggetable : bean 
```

而且由于 Array 也是对象，因此您可以以完全相同的方式迭代其他数组：

```
var my_array = ['a', 'b', 'c'];
for (index in my_array ) {
    document.write(index+" : "+my_array[index]+"<br \n>");
} 
```

结果 ：

```
0 : a
1 : b
3 : c 
```

## 您可以轻松地从数组中删除已知元素

```
var arr = ['a', 'b', 'c', 'd'];
var pos = arr.indexOf('c');
pos > -1 && arr.splice( pos, 1 ); 
```

## 您可以轻松地洗牌

~~`arr.sort(function() Math.random() - 0.5);`~~– 不是真正的随机分布，请参阅评论。

* * *

## 回答 #74

> 赞同：3
> 
> 时间：2008-09-22T15:37:02.813

[Joose](http://code.google.com/p/joose-js/) is a nice object system if you would like Class-based OO that feels somewhat like CLOS.

```
// Create a class called Point
Class("Point", {
    has: {
        x: {
            is:   "rw",
            init: 0
        },
        y: {
            is:   "rw",
            init: 0
        }
    },
    methods: {
        clear: function () {
            this.setX(0);
            this.setY(0);
        }
    }
})

// Use the class
var point = new Point();
point.setX(10)
point.setY(20);
point.clear(); 
```

* * *

## 回答 #75

> 赞同：3
> 
> 时间：2009-03-09T09:40:32.873

**语法糖：内联 for 循环闭包**

```
var i;

for (i = 0; i < 10; i++) (function ()
{
    // do something with i
}()); 
```

几乎打破了道格拉斯·克罗克福德的所有代码约定，但我认为它看起来非常好，而且永远不会少:)

* * *

选择：

```
var i;

for (i = 0; i < 10; i++) (function (j)
{
    // do something with j
}(i)); 
```

* * *

## 回答 #76

> 赞同：3
> 
> 时间：2009-03-14T03:59:25.463

存在检查。我经常看到这样的东西

```
var a = [0, 1, 2];

// code that might clear the array.

if (a.length > 0) {
 // do something
} 
```

而不是例如只是这样做：

```
var a = [0, 1, 2];

// code that might clear the array.

if (a.length) { // if length is not equal to 0, this will be true
 // do something
} 
```

你可以做各种各样的存在检查，但这只是一个简单的例子来说明一点

这是有关如何使用默认值的示例。

```
function (someArgument) {
      someArgument || (someArgument = "This is the deault value");
} 
```

那是我的两分钱。还有其他的掘金，但目前仅此而已。

* * *

## 回答 #77

> 赞同：3
> 
> 时间：2009-07-15T14:00:10.690

`typeof`与数组或空值一起使用的JavaScript运算符总是返回`object`值，在某些情况下，这可能不是程序员所期望的。

这是一个函数，它也将为这些项目返回正确的值。数组识别是从 Douglas Crockford 的书“JavaScript: The Good Parts”中复制而来的。

```
function typeOf (value) {
    var type = typeof value;
    if (type === 'object') {
        if (value === null) {
             type = 'null';
        } else if (typeof value.length === 'number' && 
            typeof value.splice === 'function' && 
            !value.propertyIsEnumerable('length')) {
            type = 'array';
        }
    }
    return type;
} 
```

* * *

## 回答 #78

> 赞同：2
> 
> 时间：2009-11-05T19:01:50.220

嗯，虽然对我来说很有趣，但我没有阅读整个主题，但让我捐赠一点：

```
// forget the debug alerts
var alertToFirebugConsole = function() {
    if ( window.console && window.console.log ) {
        window.alert = console.log;
    }
} 
```

* * *

## 回答 #79

> 赞同：2
> 
> 时间：2009-01-25T00:03:01.980

还有一种几乎不为人知的 JavaScript 语法：

```
var a;
a=alert(5),7;
alert(a);    // alerts undefined
a=7,alert(5);
alert(a);    // alerts 7

a=(3,6);
alert(a);    // alerts 6 
```

更多关于[这里](https://stackoverflow.com/questions/476218/javascript-syntax-of-a-object-object)的信息。

* * *

## 回答 #80

> 赞同：2
> 
> 时间：2008-10-07T15:52:38.747

To convert a floating point number to an integer, you can use one of the following cryptic hacks (please don't):

1.  `3.14 >> 0` (via [2.9999999999999999 >> .5?](https://stackoverflow.com/questions/173070/29999999999999999-5))
2.  `3.14 | 0` (via [What is the best method to convert floating point to an integer in JavaScript?](https://stackoverflow.com/questions/131406/what-is-the-best-method-to-convert-to-an-integer-in-javascript))
3.  `3.14 & -1`
4.  `3.14 ^ 0`
5.  `~~3.14`

Basically, applying any binary operation on the float that won't change the final value (i.e. identity function) ends up converting the float to an integer.

* * *

## 回答 #81

> 赞同：2
> 
> 时间：2009-05-14T21:02:33.437

也许是鲜为人知的其中之一：

arguments.callee.caller + Function#toString()

```
function called(){
    alert("Go called by:\n"+arguments.callee.caller.toString());
}

function iDoTheCall(){
    called();
}

iDoTheCall(); 
```

打印出`iDoTheCall`-- 已弃用的源代码，但有时当警报是您唯一的选择时会很有用....

* * *

## 回答 #82

> 赞同：2
> 
> 时间：2009-03-10T02:33:30.613

This seems to only work on Firefox (SpiderMonkey). Inside a function:

*   `arguments[-2]` gives the number of arguments (same as `arguments.length`)
*   `arguments[-3]` gives the function that was called (same as `arguments.callee`)

* * *

## 回答 #83

> 赞同：2
> 
> 时间：2008-09-15T17:27:08.623

正如 Marius 已经指出的那样，您可以在函数中使用公共静态变量。

我通常使用它们来创建只执行一次的函数，或者缓存一些复杂的计算结果。

这是我的旧“单例”方法的示例：

```
var singleton = function(){ 

  if (typeof arguments.callee.__instance__ == 'undefined') { 

    arguments.callee.__instance__ = new function(){

      //this creates a random private variable.
      //this could be a complicated calculation or DOM traversing that takes long
      //or anything that needs to be "cached"
      var rnd = Math.random();

      //just a "public" function showing the private variable value
      this.smth = function(){ alert('it is an object with a rand num=' + rnd); };

   };

  }

  return arguments.callee.__instance__;

};

var a = new singleton;
var b = new singleton;

a.smth(); 
b.smth(); 
```

如您所见，在这两种情况下，构造函数都只运行一次。

例如，我早在 2004 年就使用了这种方法，当时我不得不创建一个覆盖整个页面的灰色背景的模态对话框（类似于[Lightbox](http://en.wikipedia.org/wiki/Lightbox_(JavaScript))）。Internet Explorer 5.5 和 6 的 <select> 或 <iframe> 元素由于其“窗口”性质而具有最高的堆叠上下文；因此，如果页面包含选择元素，覆盖它们的唯一方法是创建一个 iframe 并将其放置在页面的“顶部”。所以整个脚本非常复杂而且有点慢（它使用过滤器：表达式来设置覆盖 iframe 的不透明度）。“shim”脚本只有一个“.show()”方法，它只创建了一次 shim 并将其缓存在静态变量中:)

* * *

## 回答 #84

> 赞同：2
> 
> 时间：2010-01-11T13:24:57.247

JavaScript 被认为非常擅长暴露它的所有对象，所以不管它的窗口对象本身。

因此，如果我想使用 JQuery/YUI div 弹出窗口覆盖浏览器警报，该弹出窗口也接受字符串作为参数，只需使用以下代码段即可完成。

```
 function divPopup(str)
{
    //code to show the divPopup
}
window.alert = divPopup; 

```

通过此更改，所有对 alert() 的调用都将显示基于 div 的良好弹出窗口，而不是浏览器特定的警报。

* * *

## 回答 #85

> 赞同：2
> 
> 时间：2010-02-20T20:44:00.137

## JavaScript 多功能性 - 覆盖默认功能

`window.alert`这是使用 jQuery UI 的[Dialog 小部件](http://jqueryui.com/demos/dialog/) 覆盖该函数的代码。我是作为一个 jQuery 插件来做的。你可以在我的博客上阅读它；[*altAlert，一个用于个性化警报消息的 jQuery 插件*](http://roosteronacid.com/blog/index.php/2010/01/20/jquery-plug-in-personalized-alert-messages/)。

```
jQuery.altAlert = function (options)  
{  
    var defaults = {  
        title: "Alert",  
        buttons: {  
            "Ok": function()  
            {  
                jQuery(this).dialog("close");  
            }  
        }  
    };  

    jQuery.extend(defaults, options);  

    delete defaults.autoOpen;  

    window.alert = function ()  
    {  
        jQuery("<div />", {
            html: arguments[0].replace(/\n/, "<br />")
        }).dialog(defaults);  
    };  
}; 
```

* * *

## 回答 #86

> 赞同：1
> 
> 时间：2009-06-05T13:13:03.503

您可以将 JavaScript 对象绑定为 HTML 元素属性。

```
<div id="jsTest">Klick Me</div>
<script type="text/javascript">
    var someVariable = 'I was klicked';
    var divElement = document.getElementById('jsTest');
    // binding function/object or anything as attribute
    divElement.controller = function() { someVariable += '*'; alert('You can change instance data:\n' + someVariable ); };
    var onclickFunct = new Function( 'this.controller();' ); // Works in Firefox and Internet Explorer.
    divElement.onclick = onclickFunct;
</script> 
```

* * *

## 回答 #87

> 赞同：1
> 
> 时间：2008-09-22T22:03:11.763

您可以即时重新定义大部分运行时环境，例如[修改`Array`构造函数](http://directwebremoting.org/blog/joe/2007/03/05/json_is_not_as_safe_as_people_think_it_is.html)或定义`undefined`. 不是你应该这样做，但它*可能*是一个强大的功能。

一种不太危险的形式是向现有对象添加辅助方法。例如，您可以[使 IE6 “本机”支持数组上](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Array/indexOf#Compatibility)的 indexOf。

* * *

## 回答 #88

> 赞同：1
> 
> 时间：2010-06-24T14:31:58.317

当您编写回调时，您有很多代码，如下所示：

```
callback: function(){
  stuff(arg1,arg2);
} 
```

您可以使用下面的功能，使其更干净一些。

```
callback: _(stuff, arg1, arg2) 
```

它使用 javascript 的 Function 对象的一个​​鲜为人知的函数，apply。

它还显示了另一个可以用作函数名的字符：_。

```
function _(){
        var func;
        var args = new Array();
        for(var i = 0; i < arguments.length; i++){
                if( i == 0){
                        func = arguments[i];
                } else {
                        args.push(arguments[i]);
                }
        }
        return function(){
                return func.apply(func, args);
        }
} 
```

* * *

## 回答 #89

> 赞同：1
> 
> 时间：2009-06-25T12:36:33.590

除了公共成员之外，您还可以使用闭包创建具有私有（在“类”定义之外无法访问）静态和非静态成员的“类”。

请注意，下面的代码中有两种类型的公共成员。可以访问私有*实例*`prototype`成员的特定实例（在构造函数中定义），以及只能访问私有*静态*成员的共享成员（在对象中定义） 。

```
var MyClass = (function () {
    // private static
    var nextId = 1;

    // constructor
    var cls = function () {
        // private
        var id = nextId++;
        var name = 'Unknown';

        // public (this instance only)
        this.get_id = function () { return id; };

        this.get_name = function () { return name; };
        this.set_name = function (value) {
            if (typeof value != 'string')
                throw 'Name must be a string';
            if (value.length < 2 || value.length > 20)
                throw 'Name must be 2-20 characters long.';
            name = value;
        };
    };

    // public static
    cls.get_nextId = function () {
        return nextId;
    };

    // public (shared across instances)
    cls.prototype = {
        announce: function () {
            alert('Hi there! My id is ' + this.get_id() + ' and my name is "' + this.get_name() + '"!\r\n' +
                  'The next fellow\'s id will be ' + MyClass.get_nextId() + '!');
        }
    };

    return cls;
})(); 
```

要测试此代码：

```
var mc1 = new MyClass();
mc1.set_name('Bob');

var mc2 = new MyClass();
mc2.set_name('Anne');

mc1.announce();
mc2.announce(); 
```

如果您有 Firebug，您会发现除了在定义它们的闭包内设置断点外，没有其他方法可以访问私有成员。

在定义需要对值进行严格验证并完全控制状态更改的类时，这种模式非常有用。

要扩展此类，您将`MyClass.call(this);`在扩展类的构造函数的顶部放置。您还需要**复制**`MyClass.prototype`对象（不要重复使用它，因为您也会更改其成员`MyClass`。

如果要替换该`announce`方法，则可以像这样调用`MyClass.announce`它：`MyClass.prototype.announce.call(this);`

* * *

## 回答 #90

> 赞同：1
> 
> 时间：2009-07-21T23:05:36.493

使用**Function.apply**指定函数将作用于的对象：

假设你有课

```
function myClass(){
 this.fun = function(){
   do something;
 };
} 
```

如果以后你这样做：

```
var a = new myClass();
var b = new myClass();

myClass.fun.apply(b); //this will be like b.fun(); 
```

您甚至可以将调用参数数组指定为第二个参数

看看这个：[https ://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function/apply](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function/apply)

* * *

## 回答 #91

> 赞同：1
> 
> 时间：2009-05-09T15:32:09.460

[JavaScript 技巧](http://code.google.com/p/jslibs/wiki/JavascriptTips)或[jslibs 项目](http://code.google.com/p/jslibs/)。

* * *

## 回答 #92

> 赞同：1
> 
> 时间：2009-06-22T07:58:58.430

合并运算符非常酷，并且可以生成一些干净、简洁的代码，尤其是当您将它们链接在一起时：`a || b || c || "default";` 问题在于，由于它通过评估为 bool 而不是 null 来工作，如果评估为 false 的值是有效的，它们通常会次过来看了看。不用担心，在这些情况下，只需恢复到好的 ol' 三元运算符。

我经常看到已经放弃并使用全局变量而不是静态变量的代码，所以这里是如何（在我认为你可以称为通用单例工厂的示例中）：

```
var getInstance = function(objectName) {
  if ( !getInstance.instances ) {
    getInstance.instances = {};
  }

  if ( !getInstance.instances[objectName] ) {
    getInstance.instances[objectName] = new window[objectName];
  }

  return getInstance.instances[objectName];
}; 
```

另外，请注意`new window[objectName];`which 是按名称一般实例化对象的关键。2个月前我才发现。

本着同样的精神，在使用 DOM 时，当我第一次初始化要添加的任何功能时，我经常将功能参数和/或标志埋入 DOM 节点中。如果有人尖叫，我将添加一个示例。

令人惊讶的是，第一页上没有人提到`hasOwnProperty`，这是一种耻辱。使用for 迭代时，在被迭代的容器上使用方法以确保使用的成员名称是您期望的名称`in`，这是一种很好的防御性编程。`hasOwnProperty`

```
var x = [1,2,3];
for ( i in x ) {
    if ( !x.hasOwnProperty(i) )  { continue; }
    console.log(i, x[i]);
} 
```

[阅读此处](http://ajaxian.com/archives/fun-with-browsers-for-in-loop)了解更多信息。

最后，`with`几乎总是一个坏主意。

* * *

## 回答 #93

> 赞同：1
> 
> 时间：2010-05-27T10:17:11.313

闭包：

```
function f() { 
    var a; 
    function closureGet(){ return a; }
    function closureSet(val){ a=val;}
    return [closureGet,closureSet];
}

[closureGet,closureSet]=f(); 
closureSet(5);
alert(closureGet()); // gives 5

closureSet(15);
alert(closureGet()); // gives 15 
```

这里的闭包不是所谓的解构赋值（`[c,d] = [1,3]`相当于`c=1; d=3;`），而是`a`在closureGet和closureSet中出现的仍然指向同一个变量。即使在closureSet 分配`a`了一个新值之后！

* * *

## 回答 #94

> 赞同：1
> 
> 时间：2009-07-24T08:57:34.973

我的第一次提交与其说是一个隐藏的功能，不如说是一个很少使用的属性重新定义功能的应用程序。因为您可以重新定义对象的方法，所以您可以缓存方法调用的结果，这在计算成本高且您想要惰性求值时很有用。这给出了最简单的[记忆](http://en.wikipedia.org/wiki/Memoization)形式。

```
function Circle(r) {
    this.setR(r);
}

Circle.prototype = {
  recalcArea: function() {
        this.area=function() {
            area = this.r * this.r * Math.PI;
            this.area = function() {return area;}
            return area;
        }
    },
  setR: function (r) {
      this.r = r;
      this.invalidateR();
    },
  invalidateR: function() {
        this.recalcArea();
    }
} 
```

将缓存结果的代码重构为一个方法，你会得到：

```
Object.prototype.cacheResult = function(name, _get) {
  this[name] = function() {
    var result = _get.apply(this, arguments);
    this[name] = function() {
      return result;
    }
    return result;
  };
};

function Circle(r) {
    this.setR(r);
}

Circle.prototype = {
  recalcArea: function() {
        this.cacheResult('area', function() { return this.r * this.r * Math.PI; });
    },
  setR: function (r) {
      this.r = r;
      this.invalidateR();
    },
  invalidateR: function() {
        this.recalcArea();
    }
} 
```

如果您想要一个记忆功能，您可以使用它。不涉及属性重新定义。

```
Object.prototype.memoize = function(name, implementation) {
    this[name] = function() {
        var argStr = Array.toString.call(arguments);
        if (typeof(this[name].memo[argStr]) == 'undefined') {
            this[name].memo[argStr] = implementation.apply(this, arguments);
        }
        return this[name].memo[argStr];
    }
}; 
```

请注意，这依赖于标准数组 toString 转换，并且通常无法正常工作。修复它留给读者作为练习。

我的第二个提交是 getter 和 setter。我很惊讶他们还没有被提及。由于官方标准与事实上的标准不同（defineProperty 与**define[GS]etter**）并且 Internet Explorer 几乎不支持官方标准，因此它们通常没有用处。也许这就是他们没有被提及的原因。请注意，您可以很好地结合 getter 和结果缓存：

```
Object.prototype.defineCacher = function(name, _get) {
    this.__defineGetter__(name, function() {
        var result = _get.call(this);
        this.__defineGetter__(name, function() { return result; });
        return result;
    })
};

function Circle(r) {
    this.r = r;
}

Circle.prototype = {
  invalidateR: function() {
        this.recalcArea();
    },
  recalcArea: function() {
        this.defineCacher('area', function() {return this.r * this.r * Math.PI; });
    },
  get r() { return this._r; }
  set r(r) { this._r = r; this.invalidateR(); }
}

var unit = new Circle(1);
unit.area; 
```

有效地组合 getter、setter 和结果缓存有点麻烦，因为您必须防止失效或在 set 上不自动失效，这就是以下示例所做的。如果更改一个属性会使其他多个属性无效（想象这些示例中有一个“直径”属性），这主要是一个问题。

```
Object.prototype.defineRecalcer = function(name, _get) {
  var recalcFunc;
  this[recalcFunc='recalc'+name.toCapitalized()] = function() {
    this.defineCacher(name, _get);
  };
  this[recalcFunc]();
  this.__defineSetter__(name, function(value) {
      _set.call(this, value);
      this.__defineGetter__(name, function() {return value; });
  });
};

function Circle(r) {
    this.defineRecalcer('area',
             function() {return this.r * this.r * Math.PI;},
             function(area) {this._r = Math.sqrt(area / Math.PI);},
    );
    this.r = r;
}

Circle.prototype = {
  invalidateR: function() {
        this.recalcArea();
    },
  get r() { return this._r; }
  set r(r) { this._r = r; this.invalidateR(); }
} 
```

* * *

## 回答 #95

> 赞同：1
> 
> 时间：2009-08-23T08:28:39.643

这是思考“这个”的简单方法。函数内部的“this”将引用函数的未来对象实例，通常使用 operator new 创建。很明显，内部函数的“this”永远不会引用外部函数的实例。

以上应该可以避免麻烦。但是你可以用“这个”做更复杂的事情。

* * *

示例 1：

```
 function DriveIn()
     {
          this.car = 'Honda';
          alert(this.food);  //'food' is the attribute of a future object 
                             //and DriveIn does not define it.
     }

     var A = {food:'chili', q:DriveIn};  //create object A whose q attribute 
                                         //is the function DriveIn;

     alert(A.car); //displays 'undefined' 
     A.q();        //displays 'chili' but also defines this.car.
     alert(A.car); //displays 'Honda' 
```

* * *

这个规则：

每当函数作为对象的属性被调用时，函数内部（但在任何内部函数之外）出现的任何“this”都指的是该对象。

我们需要明确“这个规则”即使在使用 operator new 时也适用。在幕后 new 通过对象的构造函数属性将“this”附加到对象上。

* * *

示例 2：

```
 function Insect ()
      {
           this.bug = "bee";
           this.bugFood = function()
           {
               alert("nectar");
           }
       }

      var B = new Insect();
      alert(B.constructor); //displays "Insect"; By "The Rule of This" any
                            //ocurrence of 'this' inside Insect now refers 
                            //to B. 
```

为了更清楚地说明这一点，我们可以创建一个 Insect 实例而不使用 operator new。

示例 3：

```
 var C = {constructor:Insect};  //Assign the constructor attribute of C, 
                                   //the value Insect.
    C.constructor();               //Call Insect through the attribute. 
                                   //C is now an Insect instance as though it 
                                   //were created with operator new. [*]
    alert(C.bug);                  //Displays "bee." 
    C.bugFood();                   //Displays "nectar." 
```

[*] 我能辨别的唯一实际区别是，在示例 3 中，“构造函数”是一个可枚举属性。当使用 operator new 时，'constructor' 成为属性但不可枚举。如果 for-in 操作“for(var name in object)”返回属性的名称，则属性是可枚举的。

* * *

## 回答 #96

> 赞同：1
> 
> 时间：2009-11-10T23:32:59.430

函数可以有方法。

我使用这种 AJAX 表单提交模式。

```
var fn = (function() {
        var ready = true;
        function fnX() {
            ready = false;
            // AJAX return function
            function Success() {
                ready = true;
            }
            Success();
            return "this is a test";
        }

        fnX.IsReady = function() {
            return ready;
        }
        return fnX;
    })();

    if (fn.IsReady()) {
        fn();
    } 
```

* * *

## 回答 #97

> 赞同：1
> 
> 时间：2010-03-19T16:47:28.223

简单的自包含函数返回值缓存：

```
function isRunningLocally(){
    var runningLocally = ....; // Might be an expensive check, check whatever needs to be checked.

    return (isRunningLocally = function(){
        return runningLocally;
    })();
}, 
```

昂贵的部分只在第一次调用时执行，之后函数所做的就是返回这个值。当然，这只对总是返回相同内容的函数有用。

* * *

## 回答 #98

> 赞同：0
> 
> 时间：2008-10-04T19:38:00.400

> 函数 l(f,n){n&&l(f,n-1,f(n));}
> 
> l（函数（循环）{警报（循环）；}，5）；

警报 5、4、3、2、1

* * *

## 回答 #99

> 赞同：-5
> 
> 时间：2009-09-08T15:28:27.323

好吧，这不是一个很大的功能，但它非常有用：

显示可选择和格式化的警报：

```
alert(prompt('',something.innerHTML )); 
```

# .net - Close and Dispose - 调用哪个？

> ID：61092
> 
> 赞同：173
> 
> 时间：2008-09-14T03:17:31.607
> 
> 标签：.net

阅读了线程[SqlCommand.Dispose 足够了吗？](https://stackoverflow.com/questions/60919/is-sqlcommanddispose-enough)以及[关闭和处理 WCF 服务](https://stackoverflow.com/questions/23867/closing-and-disposing-a-wcf-service)我想知道诸如 SqlConnection 之类的类或从 Stream 类继承的几个类之一，如果我关闭 Dispose 而不是 Close，这有关系吗？

* * *

## 回答 #1

> 赞同：216
> 
> 时间：2008-09-14T06:48:45.157

### 我想澄清这种情况。

根据 Microsoft 指南，`Close`在合适的地方提供方法是一种很好的做法。[这](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/dispose-pattern)是来自[框架设计指南的引用](https://rads.stackoverflow.com/amzn/click/com/0321246756)

> 考虑提供 method `Close()`，除了`Dispose()`, if close 是该地区的标准术语。这样做时，重要的是使`Close`实现与`Dispose`...相同

在大多数情况下`Close`，`Dispose`方法是等价的。和之间的**主要区别**是：`Close``Dispose``SqlConnectionObject`

> 一个应用程序可以调用`Close`多次。不会产生异常。
> 
> 如果你调用了`Dispose`方法 `SqlConnection`对象的状态将被重置。如果您尝试调用已处置`SqlConnection` 对象的任何方法，您将收到异常。

那说：

*   **如果您使用一次连接对象，请使用`Dispose`. 一个`using`块将确保即使在发生异常时也会调用它。**
*   **如果必须重用连接对象，请使用`Close`方法。**

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-14T04:39:28.727

像往常一样，答案是：视情况而定。不同的类`IDisposable`以不同的方式实现，这取决于你做必要的研究。

就目前`SqlClient`而言，推荐的做法是执行以下操作：

```
using (SqlConnection conn = /* Create new instance using your favorite method */)
{
    conn.Open();
    using (SqlCommand command = /* Create new instance using your favorite method */)
    {
        // Do work
    }
    conn.Close(); // Optional
} 
```

您**应该**在连接上调用`Dispose`（或`Close`*）！不要等待垃圾收集**器**清理您的连接，这将占用池中的连接，直到下一个 GC 周期（至少）。如果你打电话`Dispose`，就没有必要打电话`Close`，而且由于`using`构造使它很容易`Dispose`正确处理，所以真的没有理由打电话`Close`。

连接是自动池化的，在连接上调用`Dispose`/`Close`并不会物理关闭连接（正常情况下）。不要尝试实现自己的池化。 `SqlClient`从池中检索连接时对连接执行清理（如恢复数据库上下文和连接选项）。

*如果您正在调用`Close`，请确保以异常安全的方式进行（即在 catch 或 finally 块中）。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-14T03:22:12.690

对于`SqlConnection`，从连接本身的角度来看，它们是等价的。根据 Reflector 的说法，`Dispose()`调用`Close()`以及执行一些额外的内存释放操作——主要是通过将成员设置为 null。

对于 Stream，它们实际上是等价的。 `Stream.Dispose()`只需调用 Close()。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-14T03:44:41.760

**您确实需要调用 Dispose()！**

Dispose()是给开发者调用的，垃圾回收器调用Finalize()。如果您不对对象调用 Dispose()，则在垃圾收集器出现并对它们调用 finalize 之前，它们使用的任何非托管资源都不会被释放（谁知道什么时候会发生）。

这种情况称为非确定性终结，是 .net 开发人员的常见陷阱。如果您正在使用实现 IDisposable 的对象，请对它们调用 Dispose() ！

[http://www.ondotnet.com/pub/a/oreilly/dotnet/news/programmingCsharp_0801.html?page=last](http://www.ondotnet.com/pub/a/oreilly/dotnet/news/programmingCsharp_0801.html?page=last)

虽然可能有很多实例（例如在 SqlConnection 上）在某些对象上调用 Disponse()，而它只是在其连接上调用 Close() 或关闭文件句柄，**但调用 Dispose() 几乎总是最好的选择！除非您计划在不久的将来重用该对象。**

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-14T04:42:56.440

*这个可能很快的建议变成了一个很长的答案。对不起。*

正如泰勒在他的好回答中指出的那样，调用`Dispose()`是一种很好的编程实践。这是因为这种方法应该“聚集在一起”所有需要的资源释放，因此没有不需要的开放资源。例如，如果您将一些文本写入文件，但未能关闭该文件（释放资源），它将保持打开状态，并且在 GC 出现并执行您应该拥有的之前没有其他人可以写入它完毕。

现在，在某些情况下，将会有更具体到您正在处理的类的“最终确定”方法，例如`StreamWriter.Close()`覆盖`TextWriter.Close()`. 实际上，它们通常更适合这种情况：`Close()`例如， StreamWriter`Dispose()`会在对象的 ing 之前刷新流和底层编码器！凉爽的！

但是，浏览 MSDN，您会发现即使是 Microsoft 有时也会被众多的关闭器和处理器所迷惑。[例如，在这个网页](http://msdn.microsoft.com/en-us/library/6ka1wd3w.aspx "如何：将文本写入文件")中，在某些示例`Close()`中，在隐式之前调用`Dispose()`（如果您不明白为什么它是隐式的，请参阅[using 语句](http://msdn.microsoft.com/en-us/library/yh598w02.aspx "using 语句（C# 参考）")），特别是他们不打扰。为什么会这样？我也很困惑。

我认为（而且，我强调，这是[原创研究](http://en.wikipedia.org/wiki/Original_research "原创研究 - 维基百科，免费的百科全书")，如果我错了我肯定会失去声誉）的原因是它**`Close()`可能会失败，在保持资源开放的同时产生异常，同时`Dispose()`肯定会释放它们**。这就是为什么**a`Dispose()`应该始终保护`Close()`通话**（对不起双关语）。

```
MyResource r = new MyResource();

try {
  r.Write(new Whatever());

  r.Close()
finally {
  r.Dispose();
} 
```

是的，我猜微软在那个例子上滑倒了。也许那个时间戳永远不会被刷新到文件中。

我明天要修复我的旧代码。

*编辑：对不起布兰农，我不能评论你的答案，但你确定打电话`Close()`给一个`finally`街区是个好主意吗？我猜一个例外可能会破坏块的其余部分，其中可能包含重要的清理代码。*

*回复 Brannon 的：太好了，只是不要忘记在`Close()`真正需要时调用（例如，在处理流时 - 不太了解 .NET 中的 SQL 连接）。*

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-07-09T22:42:52.453

类型转换为 iDisposable，然后调用 dispose。这将调用配置为实现“iDisposable.Dispose”的任何方法，而不管函数的名称是什么。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-06-19T14:38:50.710

通常我们在 Close()、Abort() 和 Dispose() 中遇到问题，但让我告诉你它们之间的区别。

1）ABORT：-我不建议使用它，因为当调用 abort 时，客户端会在不告诉服务器的情况下删除连接，因此服务器将等待一段时间（大约 1 分钟）。如果您有批量请求，则不能使用 abort() ，因为它可能会导致您有限的连接池超时。

2）关闭：-关闭是关闭连接的好方法，因为关闭连接时它会调用服务器并确认服务器也关闭该端。

在这里，还有一件事要看。在某些情况下，如果产生错误，那么在最后的 connection.close() 中编写代码不是一个好方法，因为那时通信状态将出错。

3) Dispose :- 这是一种关闭类型，但关闭连接后，您无法再次打开它。

所以试试这个方法

```
private void CloseConnection(Client client)
    {
        if (client != null && client.State == CommunicationState.Opened)
        {
            client.Close();
        }
        else
        {
            client.Abort();
        }
    } 
```

# c++ - 与 C++ 相比，哪些语言具有更高的抽象级别并且需要更少的手动内存管理？

> ID：61109
> 
> 赞同：18
> 
> 时间：2008-09-14T03:49:06.727
> 
> 标签：c++, programming-languages

我学习 C++ 已经有一段时间了，我觉得它非常强大。但是，问题是抽象级别不多，我必须自己做内存管理。我可以使用哪些语言使用更高级别的抽象。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-09-14T04:54:32.733

Java、C#、Ruby、Python 和 JavaScript 可能是摆在您面前的重大选择。

[Java](http://en.wikipedia.org/wiki/Java_(programming_language))和[C#](http://en.wikipedia.org/wiki/C_Sharp)并不是完全不同的语言。您会发现与 C++ 的最大区别在于内存管理（即对象在不再被引用时会自动释放）。如果您对桌面风格的应用程序感兴趣或热衷于静态类型，您会选择这些（您可能会根据您对 Microsoft 和 Windows 平台的感觉在它们之间进行选择）。在这两种情况下，您都会发现比您在 C++ 中习惯的要丰富得多的标准库。

[Python](http://en.wikipedia.org/wiki/Python_(programming_language))和[Ruby](http://en.wikipedia.org/wiki/Ruby_(programming_language))从静态类型化迈出了一步，进入了一个可以在任何对象上调用和方法的世界（如果不存在，则在运行时失败）。这既是一种祝福（少得多的样板代码）也是一种诅咒（编译器无法再为您捕获这些错误）。再一次，您会发现它们拥有更丰富的标准库，并且比 Java / C# 更高级别。性能是主要的缺点，据我了解，Python 比 Ruby 快一些。要在它们之间进行选择，如果您对 Ruby on Rails 框架社区的 Web 开发感兴趣，您可能会选择 Ruby，否则选择 Python。

[JavaScript](http://en.wikipedia.org/wiki/JavaScript)与 C++ 的更多不同之处在于它完全取消了类。对象只是从其他对象中克隆出来的，并且可以在运行时向它们添加方法和属性。非常灵活，但也很容易弄得一团糟。如果您对在浏览器中运行应用程序感兴趣，那么 JavaScript 是唯一真正的选择，浏览器实际上已经成为一个平台。如果您不经常使用浏览器，您会发现可用的标准库相当有限，但是有很多好的框架可以填补一些空白。

其他一些有趣的，虽然更多的利基选择是

*   [Smalltalk](http://en.wikipedia.org/wiki/Smalltalk) - 或多或少属于 Ruby 和 Python 阵营，据我所知，速度要快得多。不过要小心 _ 我已经看到很多优秀的工程师学习了 Smalltalk 并且再也没有回来；）
*   [Objective-C](http://en.wikipedia.org/wiki/Objective-C) - 当 C 转向面向对象时，C++ 采用一种方式（静态类型），而 Objective-C 采用另一种方式（动态类型）。如果您在 Mac / iPhone 领域，它非常受 Smalltalk 启发，并且有一个很好的标准库。在内存管理方面，与我列出的所有其他内容不同，它不是垃圾收集（尽管现在这是 Mac OS X 10.5 上的一个选项），但它确实有一个引用计数方案，这使得生活比手动管理内存要简单得多。
*   [Lisp](http://en.wikipedia.org/wiki/Lisp_programming_language) - 我从来没有自己学过它，超出了我对小型 Emacs 黑客的需要。据我了解，图书馆在当时很不错，但尽管语言仍然非常优雅，但它们已经落后于时代了。
*   [Haskel](http://en.wikipedia.org/wiki/Haskell_(programming_language)) - 如果你想完全摆脱对象和类，Haskel 和它的函数式方法是一个有趣的方法（或者上面的 Lisp，或者[F#](http://en.wikipedia.org/wiki/F_Sharp_programming_language)，如果你在 .Net 领域）。基本上，你放弃了循环和变量，转而支持递归地做所有事情。需要一些时间来思考，并且对于大多数现实世界的应用程序可能不实用，但它是一个很好的学习方法。
*   [Eiffel](http://en.wikipedia.org/wiki/Eiffel_(programming_language)) - 我喜欢它 - 非常干净的语法，专为严肃的工程类型系统而设计。像 C# 和 Java 这样的静态类型，以及较弱的标准库，但它会让你真正考虑语言和类库设计。
*   [ActionScript](http://en.wikipedia.org/wiki/ActionScript)和[Flex](http://en.wikipedia.org/wiki/Adobe_Flex) - Flash 的编程接口，它基于似乎是静态类型的 JavaScript 版本。我已经玩过它了，如果您对开发基于媒体的应用程序感兴趣，它会非常巧妙。您还可以使用 Flex 超越浏览器并进入[Air](http://en.wikipedia.org/wiki/Adobe_Integrated_Runtime)平台，以构建真正的桌面应用程序。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-09-14T07:33:15.160

我想说，从你的问题来看，你可能还没有完成对 C++ 的学习。如果你还在做自己的内存管理，那么你还有很长的路要走，我的朋友！

查看 auto_ptr 和 shared_ptr - 查看 Boost 库。

抽象也是如此——你具体抱怨什么？**AFAIK 对于其他强类型语言**中存在的 C++，没有什么不能做的。

我知道这并不能回答你的问题——你想继续前进，但 C++ 是你永远不会真正停止学习的东西之一。如果您觉得无聊，不妨试一试模板和模板元编程……

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-14T08:28:51.937

到目前为止，我看到了很多很棒的建议。但是，我认为缺少一些东西，汇编程序。

**为什么要学习汇编语言？**

*   **这并不像你想象的那么难**。汇编语言的范围比许多现代语言小得多，您需要了解一些技巧才能使其有意义，但并不那么复杂。
*   **它拓宽了你的知识基础。**了解基本原理几乎总是有益的，即使在高水平工作时也是如此。
*   **它在调试时非常有用。**尤其是在没有源代码的情况下调试本机代码，您从学习汇编程序中获得的知识将大大提高您在这些情况下进行调试的能力。
*   **它为您提供了更多选择。**当出现需要汇编代码的罕见情况时，您将不会束手无策。
*   **对你的简历有好处。**它表明你学到的不仅仅是保持当前工作所需的最低限度的知识，它表现出对基础知识的好奇心，它让你进入了一个不同的程序员类别，而且这个类别往往更有经验，更有能力。
*   **这简直太酷了。**

一些汇编语言资源：

*   [Sandpile.org](http://www.sandpile.org/)（汇编语言/处理器架构参考）
*   [Gavin's Guide to 80x86 Assembly](http://burks.brighton.ac.uk/burks/language/asm/asmtut/asm1.htm)（一个不错的在线教程）
*   [基于 Intel 的计算机的汇编语言 (5e)](https://rads.stackoverflow.com/amzn/click/com/0132383101)（一本不错的 x86 汇编教科书）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-14T04:45:44.470

尝试像 Haskell 这样真正陌生的东西会让你以不同的方式思考。它还可以帮助您进行递归思考。C++ 具有递归，但它渗透到函数式语言的更多部分。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-14T04:18:08.030

同上 Lisp，.. 或方案

即使你从不使用它，它也很方便。我是在学习模板编程后才*真正*得到模板编程的。

另一个是序言。它使您处于非顺序的心态。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-14T03:55:28.037

如果您对 C++ 语法和风格感到满意，您可能会发现[D](http://www.digitalmars.com/d/)是一种有趣的语言。或者，如果你想扩展，Python、C#、Java、Ruby 中的任何一个都是很好的选择。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-14T03:55:48.613

如果您在 Microsoft 生态系统中，请使用 C#。

Python 和 Ruby 似乎在 Linux/Unix/etc 领域具有最大的吸引力。

ObjectiveC 在 Macintosh 和 iPhone 上占主导地位。最新的 MacOS 为框架的子集实现了垃圾收集，但要使用其余部分，您必须自己进行资源管理。

您可以学习 Java，因为它也可以进行垃圾收集，但是要成为一名高效的 Java 开发人员，您需要熟悉的框架数量令人望而生畏。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-16T07:20:51.943

我会说这取决于您想尝试的编程类型。如果您想留在 OOP 方面，学习[Python](http://python.org/)或[Ruby](http://www.ruby-lang.org/en/)，这两种语言都提供了一种简单的方法来创建绑定以使用脚本中的 C++ 代码（出于效率原因）。

如果您需要另一种编程方法，请学习像 Lisp 或 Haskell 这样的“函数式”语言。

如果您需要在您的 C++ 应用程序中包含一种快速且小型的脚本语言，请尝试[Lua](http://lua.org)。

最后但同样重要的是，如果您了解 Java 并且讨厌它，您可以尝试[Scala](http://www.scala-lang.org/)，这是一种可以将 Java 类与您的 Scala 代码混合使用的语言，非常有趣。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-16T07:25:53.913

方案。

[小](http://www.ccs.neu.edu/home/matthias/BTLS/)计划者和[计算机程序的结构和解释](http://mitpress.mit.edu/sicp/)将以奇怪而奇妙的方式扩展您的思想。

[DrScheme](http://www.drscheme.org/)对于初学者来说是一个很好的 IDE。[Scheme 编程语言](http://www.scheme.com/tspl3/)是一个很好的免费参考。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-14T04:01:41.347

好吧，如果您正在寻找非常高级别的抽象和内存管理，那么我会说 lisp 将是一个理想的候选人。我现在正在慢慢地[学习](http://gigamonkeys.com/book/)它，这是我用一门新语言获得的最大乐趣。

话虽如此，Python 或 Ruby 可能是表现力和流行度之间更好的折衷方案。如果您正在寻找 Web 应用程序的东西，Python 的 Django 框架是更好的 RAD 框架之一。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-16T16:05:32.557

I suggest learning database design and a query language such as SQL.

You can start with a desktop tool like Microsoft Access or use the free SQL Server Express or Postgre or MySQL.

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-14T05:51:06.310

多尝试 C# :)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-08-27T19:01:34.110

Clojure 非常值得探索，因为它符合您的两个标准：

*   它非常强调具有更高级别抽象的编程。例如看这个视频：[Clojure：抽象的艺术](http://www.infoq.com/presentations/Clojure-The-Art-of-Abstraction)
*   它具有自动内存管理/垃圾收集（通过 JVM，它拥有一些世界上最好的 GC 实现）

[我将仅使用一种抽象来给出一些示例：在 Clojure 中，您可以通过序列抽象](http://clojure.org/sequences)来操作几乎任何数据结构。

```
;; treat a vector as a sequence and reverse it
(reverse [1 2 3 4 5])
=> (5 4 3 2 1)

;; Take 10 items from a infinite sequence
(take 10 (range))
=> (0 1 2 3 4 5 6 7 8 9)

;; Treat a String as a sequence of characters, calculate the frequencies
(frequencies "abracadabra")
=> {\a 5, \b 2, \r 2, \c 1, \d 1}

;; Define an infinite lazy sequence of fibonacci numbers, take the first 10
(def fibs (concat [0 1] (lazy-seq (map + fibs (rest fibs)))))
(take 10 fibs)
=> (0 1 1 2 3 5 8 13 21 34) 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-15T04:34:46.030

如果您想抽象内存管理，Java 会立即出现在我的脑海中。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-23T02:54:39.593

好吧，我认为学习编程语言没有预定义的路线。你可以根据你的工作需求、学术研究、只是为了好玩等来学习你的下一个语言。有很多选择。

如果您对 C++ 感到满意，您可以继续学习一些汇编。这是一门黑暗的艺术，但当你遇到一些困难的调试会话时你会很高兴。

就更抽象而言，Smalltalk 非常有趣，纯 OOP 且 100% 动态（调试是一件令人愉快的事情，这不是静态类型语言）。Dolphin Smalltalk 是 Windows 的一个很好的实现，即使是免费的社区版也足够玩。在多平台 Smalltalk VM 中，选择 Visualworks 或 Squeak。Visualworks 非常稳定，并附带大量文档。

今天，Python 被用于许多领域。除了基本的语法和语义外，我对 Python 一无所知，但今天许多工作都需要它。

Java 它是，Java。有趣的是，Java 从未追上我。不过，您可能会对 Java 感兴趣。在这里询问使用它相对于 C++ 或其他 OOP 语言的优势。

对于 Web 开发，请使用 Javascript，特别是考虑 AJAX 浪潮。那些日子越来越有趣了。我们已经讨论过 Smalltalk，好吧，Seaside 是一个了不起的 Web 开发框架。它有效（至少我试过）Squeak / Visualworks ......它很漂亮。

好吧，还有很多东西可以让您上手：Scheme、LISP、Ruby、Lua、Bash（！）、Perl（呃）、Haskell ......全部尝试一下，玩得开心！

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-02-23T12:43:56.717

[Qt](http://en.wikipedia.org/wiki/Qt_toolkit)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-02-23T12:51:50.380

为什么不学习**Qt**？它是一个伟大的应用程序开发框架，可用于所有平台甚至移动设备！

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-14T04:23:27.737

由于您已经进入 C++，下一步将是通过[托管 C++](http://www.ondotnet.com/pub/a/dotnet/2003/01/13/intromcpp.html)或 C++ 的托管扩展来学习 .Net。这将使您在 .Net 框架的广阔世界中迈出一步。一旦您了解了该框架，它就会变得更轻松学习其他 .Net 语言，如 C#、VB.Net 等。

*MC++ 擅长的领域之一，事实上在 .NET 语言中是独一无二的，它能够获取现有的非托管 (C++) 应用程序，使用 /clr 开关重新编译它，让它生成 MSIL，然后在CLR。这一非凡的壮举被恰当地称为“It Just Works (IJW)！” 有一些限制，但在大多数情况下，应用程序只会运行。C++ 代码可以由老式的 printf 语句、MFC、ATL 甚至模板组成！*

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-14T07:49:44.480

我推荐 python，因为它不仅是一门性感的语言，而且使用非常广泛，并且很容易通过[Boost.Python](http://www.boost.org/doc/libs/1_36_0/libs/python/doc/index.html)与 C++ 集成。

但正如 Thomi 所说，在 C++ 中有很多东西需要探索，并且在 Boost 库的帮助下，它变得非常容易开发。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-16T16:23:33.510

我会说开始使用 Python。它具有更高的抽象级别，它教会您缩进和制作“漂亮”代码的重要性。并不是说“漂亮”很重要，但它会让你的代码的未来维护者更快乐:)

那里有很多示例代码，如果您使用 Linux，那么那里有各种发行版，它们拥有所有（或大部分）基于该语言的工具。如果您喜欢深入了解管理操作系统的工作原理（大多数程序员都会这样做），那么这是一个好的开始。在我发火之前，我说的是管理，而不是你最需要 C 的实际内核内容，你应该把它涵盖在内。

另一方面，深入研究 C 方面的东西，忽略 OO 的东西并学习函数式编程可能会很好。如果您沿着这条路走下去，我还建议您从基本的汇编语言开始，就像上面的一篇文章所建议的那样。也许 HLA（Randall Hyde 的 High-Level Assembly，他写了一本名为 Art of Assembly Language Programming 的好书）是一个好的开始。你要么学会爱内存管理，要么在你的余生中讨厌它。如果您想开始编程生涯，很高兴知道:)

但是，如果您想通过编程找到一份工作，如果您知道自己在做什么，那么 Java 和 J2EE 是一个容易赚钱的工具。恕我直言，它很快就会变得无聊。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-14T10:10:47.807

我建议您选择提供以下 4 个功能的任何一种或多种语言，而不是建议一种特定的语言：

1.  自动内存管理
2.  反思/内省
3.  声明式/函数式构造（例如 lambda 函数）
4.  鸭打字

这里的想法是扩展您的编程视角，以包含 C++ 语言不为您提供开箱即用的概念。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-14T13:00:07.027

这取决于你想做什么。如果您有一些您有兴趣完成的特定任务，请查看最适合这些类型任务的语言。学习一门语言的最好方法是实际使用它。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-06-02T15:35:06.603

如果您还没有，请尝试使用脚本语言。它应该改变你的工作和思考方式。希望以一种好的方式:)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-08-29T17:07:43.780

就个人而言，我一直在使用 Java、Python、C/++ 进行编程，而我最喜欢的必须是 python。尽管 C++ 可以做 Python 可以做的所有事情，甚至更多，但我编写了一个 Python 程序，它有大约 10 行代码，在 C++ 中大约需要 50 行。所以，故事的寓意，使用python。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2010-06-02T15:47:39.553

我必须为 Perl 提供一个单独的答案。虽然 Python 在功能上大致相当，并且被认为更简洁和现代，但 Perl 有它自己的优雅——纯粹实用主义的优雅。它还拥有真正出色的库支持。看看 Perl，以与 Haskel 相反的方向扩展您的大脑 :)（尽管 Perl 爱好者声称它可以用于函数式编程）。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-07-11T10:13:31.043

[锈](https://www.rust-lang.org/)

*   语法类似于 C++
*   专为性能和安全而设计，尤其是安全并发

# c# - 如何保存控制台应用程序的输出

> ID：61110
> 
> 赞同：11
> 
> 时间：2008-09-14T03:50:10.687
> 
> 标签：c#, .net, console, stdout

我需要有关如何让我的 C# 控制台应用程序通过标准输出向用户显示文本同时仍然能够在以后访问它的建议。我想实现的实际功能是在程序执行结束时将整个输出缓冲区转储到文本文件中。

当我没有找到更简洁的方法时，我使用的解决方法是子类化`TextWriter`重写写入方法，这样它们既可以写入文件，又可以调用原始的标准输出编写器。像这样的东西：

```
public class DirtyWorkaround {
  private class DirtyWriter : TextWriter {
    private TextWriter stdoutWriter;
    private StreamWriter fileWriter;

    public DirtyWriter(string path, TextWriter stdoutWriter) {
      this.stdoutWriter = stdoutWriter;
      this.fileWriter = new StreamWriter(path);
    }

    override public void Write(string s) {
      stdoutWriter.Write(s);

      fileWriter.Write(s);
      fileWriter.Flush();
    }

    // Same as above for WriteLine() and WriteLine(string),
    // plus whatever methods I need to override to inherit
    // from TextWriter (Encoding.Get I guess).
  }

  public static void Main(string[] args) {
    using (DirtyWriter dw = new DirtyWriter("path", Console.Out)) {
      Console.SetOut(dw);

      // Teh codez
    }
  }
} 
```

看到它一直在写入和刷新文件。我只想在执行结束时这样做，但我找不到任何访问输出缓冲区的方法。

另外，请原谅上述代码的不准确之处（必须*临时*编写，抱歉；）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-14T04:45:42.800

完美的解决方案是将[log4net](http://logging.apache.org/log4net/)与控制台附加程序和文件附加程序一起使用。还有许多其他可用的附加程序。它还允许您在运行时关闭和打开不同的附加程序。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-14T04:06:46.090

我不认为你的方法有什么问题。

如果您想要可重用的代码，请考虑实现一个名为`MultiWriter`或类似的类，该类将两个（或 N 个？）`TextWriter`流作为输入并将所有命令、刷新等分发到这些流。然后你可以做这个文件/控制台的事情，但是你可以很容易地分割任何输出流。有用！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-14T04:12:43.923

可能不是您想要的，但以防万一……显然，[PowerShell 实现](http://en.wikipedia.org/wiki/Tee_(command)#Windows_PowerShell)`tee`了古老命令的一个版本。这几乎就是为了这个目的。所以......如果你有他们，就抽他们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-14T06:22:47.810

我想说模仿 .NET 本身使用的诊断程序（跟踪和调试）。

创建一个“输出”类，它可以有不同的类来遵守文本输出接口。您向输出类报告，它会自动将给定的输出发送给您添加的类（ConsoleOutput、TextFileOutput、WhateverOutput）。等等。这也让您可以添加其他“输出”类型（例如 xml/ xslt 以获得格式良好的报告？）。

查看[Trace Listeners Collection](http://msdn.microsoft.com/en-us/library/sk36c28t.aspx)以了解我的意思。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-14T06:39:13.200

考虑重构您的应用程序以将用户交互部分与业务逻辑分开。根据我的经验，这种分离对您的程序结构非常有益。

对于您在此处尝试解决的特定问题，用户交互部分可以直接将其行为从文件 I/O 更改`Console.WriteLine`为文件 I/O。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T18:21:02.290

我正在实现一个类似的功能来捕获发送到控制台的输出并将其保存到日志中，同时仍将输出实时传递到普通控制台，这样它就不会破坏应用程序（例如，如果它是一个控制台应用程序！）。

如果您仍在尝试通过保存控制台输出在自己的代码中执行此操作（而不是使用日志系统来仅保存您真正关心的信息），我认为您可以避免每次写入后刷新，只要因为您还覆盖了 Flush() 并确保它刷新`stdoutWriter`您保存的原始文件以及`fileWriter`. 如果应用程序试图将部分行刷新到控制台以立即显示（例如输入提示、进度指示器等），您希望这样做，以覆盖正常的行缓冲。

如果该方法存在控制台输出缓冲时间过长的问题，则可能需要确保 WriteLine() 刷新`stdoutWriter`（但可能不需要刷新，`fileWriter`除非调用 Flush() 覆盖）。但我认为原来的`Console.Out`（实际上是进入控制台）会在换行符上自动刷新它的缓冲区，所以你不应该强迫它。

您可能还想覆盖 Close() 以（刷新和）关闭您的`fileWriter`（可能`stdoutWriter`也是如此），但我不确定这是否真的需要，或者基础 TextWriter 中的 Close() 是否会发出 Flush() （您已经覆盖）并且您可能依赖应用程序退出来关闭您的文件。可以肯定的是，您可能应该测试它是否在退出时被刷新。请注意，异常退出（崩溃）可能不会刷新缓冲输出。如果这是一个问题，`fileWriter`在换行符上刷新可能是可取的，但这是另一个棘手的蠕虫问题。

# c# - 递归 lambda 表达式在 C# 中遍历树

> ID：61143
> 
> 赞同：66
> 
> 时间：2008-09-14T05:17:44.017
> 
> 标签：c#, recursion, lambda

有人可以告诉我如何实现递归 lambda 表达式来遍历 C# 中的树结构。

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2008-09-14T10:44:56.853

好的，我终于找到了一些空闲时间。
开始了：

```
class TreeNode
{
    public string Value { get; set;}
    public List<TreeNode> Nodes { get; set;}

    public TreeNode()
    {
        Nodes = new List<TreeNode>();
    }
}

Action<TreeNode> traverse = null;

traverse = (n) => { Console.WriteLine(n.Value); n.Nodes.ForEach(traverse);};

var root = new TreeNode { Value = "Root" };
root.Nodes.Add(new TreeNode { Value = "ChildA"} );
root.Nodes[0].Nodes.Add(new TreeNode { Value = "ChildA1" });
root.Nodes[0].Nodes.Add(new TreeNode { Value = "ChildA2" });
root.Nodes.Add(new TreeNode { Value = "ChildB"} );
root.Nodes[1].Nodes.Add(new TreeNode { Value = "ChildB1" });
root.Nodes[1].Nodes.Add(new TreeNode { Value = "ChildB2" });

traverse(root); 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-14T08:39:11.087

一个合适的解决方案，实际上是许多函数式编程语言中的惯用解决方案，将是使用[定点组合器](https://en.wikipedia.org/wiki/Fixed-point_combinator)。简而言之：定点组合器回答了“我如何将匿名函数定义为递归的？”的问题。但是解决方案是如此重要，以至于写了整篇文章来解释它们。

一个简单、实用的替代方案是“回到过去”到 C 的滑稽动作：定义之前的声明。尝试以下（“阶乘”函数）：

```
Func<int, int> fact = null;
fact = x => (x == 0) ? 1 : x * fact(x - 1); 
```

奇迹般有效。

或者，对于类对象的预排序树遍历，该类对象适当地`TreeNode`实现`IEnumerable<TreeNode>`以遍历其子对象：

```
Action<TreeNode, Action<TreeNode>> preorderTraverse = null;
preorderTraverse = (node, action) => {
    action(node);
    foreach (var child in node) preorderTraverse(child, action);
}; 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-09-14T10:05:46.150

> 一个简单的替代方案是“回到过去”到 C 和 C++ 的滑稽动作：定义前声明。尝试以下操作：
> 
> ```
> Func<int, int> fact = null;
> fact = x => (x == 0) ? 1 : x * fact(x - 1); 
> ```
> 
> 奇迹般有效。

是的，这确实有效，但有一点需要注意。C# 具有可变引用。因此，请确保您不会意外地执行以下操作：

```
Func<int, int> fact = null;
fact = x => (x == 0) ? 1 : x * fact(x - 1);

// Make a new reference to the factorial function
Func<int, int> myFact = fact;

// Use the new reference to calculate the factorial of 4
myFact(4); // returns 24

// Modify the old reference
fact = x => x;

// Again, use the new reference to calculate
myFact(4); // returns 12 
```

当然，这个例子有点做作，但是在使用可变引用时可能会发生这种情况。如果您使用来自[aku](https://stackoverflow.com/questions/61143/recursive-lambda-expression-to-traverse-a-tree-in-c#61162)链接的组合器，这是不可能的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-14T05:27:42.230

假设一个神话对象 TreeItem，它包含一个 Children 集合来表示您的层次结构。

```
 public void HandleTreeItems(Action<TreeItem> item, TreeItem parent)
    {
        if (parent.Children.Count > 0)
        {
            foreach (TreeItem ti in parent.Children)
            {
                HandleTreeItems(item, ti);
            }
        }

        item(parent);
    } 
```

现在调用它，传入处理一项的 lambda，将其名称打印到控制台。

```
HandleTreeItems(item => { Console.WriteLine(item.Name); }, TreeItemRoot); 
```

# java - 在 Java 中模拟静态块

> ID：61150
> 
> 赞同：47
> 
> 时间：2008-09-14T05:31:57.430
> 
> 标签：java, unit-testing, mocking, jmockit, static-block

我对 Java 的座右铭是“仅仅因为 Java 有静态块，并不意味着你应该使用它们。” 撇开玩笑不谈，Java 中有很多技巧让测试成为一场噩梦。我最讨厌的两个是匿名类和静态块。我们有很多使用静态块的遗留代码，这些是我们推动编写单元测试的恼人点之一。我们的目标是能够以最少的代码更改为依赖此静态初始化的类编写单元测试。

到目前为止，我对同事的建议是将静态块的主体移动到私有静态方法中并调用它`staticInit`。然后可以从静态块中调用此方法。对于依赖于这个类的另一个类的单元测试，可以很容易地`staticInit`用[JMockit](https://jmockit.github.io/)模拟不做任何事情。让我们看看这个例子。

```
public class ClassWithStaticInit {
  static {
    System.out.println("static initializer.");
  }
} 
```

将改为

```
public class ClassWithStaticInit {
  static {
    staticInit();
  }

  private static void staticInit() {
    System.out.println("static initialized.");
  }
} 
```

这样我们就可以在[JUnit](https://junit.org/junit5/)中执行以下操作。

```
public class DependentClassTest {
  public static class MockClassWithStaticInit {
    public static void staticInit() {
    }
  }

  @BeforeClass
  public static void setUpBeforeClass() {
    Mockit.redefineMethods(ClassWithStaticInit.class, MockClassWithStaticInit.class);
  }
} 
```

然而，这种解决方案也有其自身的问题。您不能在同一个 JVM 上运行`DependentClassTest`和运行，`ClassWithStaticInitTest`因为您实际上希望静态块运行`ClassWithStaticInitTest`.

完成这项任务的方法是什么？或者任何更好的、非基于 JMockit 的解决方案，您认为它们会更干净？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-01-28T19:40:02.983

[PowerMock](http://powermock.org)是另一个扩展 EasyMock 和 Mockito 的模拟框架。使用 PowerMock，您可以轻松地从类[中删除不需要的行为](http://code.google.com/p/powermock/wiki/SuppressUnwantedBehavior)，例如静态初始化程序。在您的示例中，您只需将以下注释添加到您的 JUnit 测试用例中：

```
@RunWith(PowerMockRunner.class)
@SuppressStaticInitializationFor("some.package.ClassWithStaticInit") 
```

PowerMock 不使用 Java 代理，因此不需要修改 JVM 启动参数。您只需添加 jar 文件和上述注释即可。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-08-30T11:20:53.420

有时，我会在我的代码所依赖的类中找到静态初始化程序。如果我无法重构代码，我使用[PowerMock](http://code.google.com/p/powermock/)的`@SuppressStaticInitializationFor`注释来抑制静态初始化程序：

```
@RunWith(PowerMockRunner.class)
@SuppressStaticInitializationFor("com.example.ClassWithStaticInit")
public class ClassWithStaticInitTest {

    ClassWithStaticInit tested;

    @Before
    public void setUp() {
        tested = new ClassWithStaticInit();
    }

    @Test
    public void testSuppressStaticInitializer() {
        asserNotNull(tested);
    }

    // more tests...
} 
```

阅读有关[抑制不良行为的](http://code.google.com/p/powermock/wiki/SuppressUnwantedBehavior)更多信息。

免责声明：PowerMock 是我的两个同事开发的开源项目。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-28T00:38:20.323

这将进入更“高级”的 JMockit。事实证明，您可以通过创建`public void $clinit()`方法来重新定义 JMockit 中的静态初始化块。所以，而不是做这个改变

```
public class ClassWithStaticInit {
  static {
    staticInit();
  }

  private static void staticInit() {
    System.out.println("static initialized.");
  }
} 
```

我们不妨保持原样`ClassWithStaticInit`并在以下内容中执行以下操作`MockClassWithStaticInit`：

```
public static class MockClassWithStaticInit {
  public void $clinit() {
  }
} 
```

这实际上将允许我们不对现有类进行任何更改。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-14T05:55:21.417

在我看来，您正在治疗一种症状：依赖于静态初始化的糟糕设计。也许一些重构是真正的解决方案。听起来您已经对`staticInit()`函数进行了一些重构，但也许该函数需要从构造函数调用，而不是从静态初始化程序调用。如果您可以取消静态初始化程序期间，您会过得更好。只有你可以做出这个决定（*我看不到你的代码库*），但一些重构肯定会有所帮助。

至于模拟，我使用 EasyMock，但我遇到了同样的问题。遗留代码中静态初始化器的副作用使测试变得困难。我们的答案是重构静态初始化器。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-14T09:17:33.067

当我遇到这个问题时，我通常会做你描述的同样的事情，除了我将静态方法保护起来，以便我可以手动调用它。最重要的是，我确保可以多次调用该方法而不会出现问题（否则就测试而言，它并不比静态初始化程序好）。

这工作得相当好，我实际上可以测试静态初始化方法是否符合我的期望/希望它做的事情。有时，拥有一些静态初始化代码是最容易的，而构建一个过于复杂的系统来替换它是不值得的。

当我使用这种机制时，我确保记录受保护的方法仅用于测试目的，希望它不会被其他开发人员使用。这当然可能不是一个可行的解决方案，例如，如果类的接口是外部可见的（或者作为其他团队的某种子组件，或者作为公共框架）。不过，这是解决问题的简单方法，并且不需要设置第三方库（我喜欢）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-14T07:42:58.100

您可以在 Groovy 中编写测试代码，并使用元编程轻松模拟静态方法。

```
Math.metaClass.'static'.max = { int a, int b -> 
    a + b
}

Math.max 1, 2 
```

如果你不能使用 Groovy，你真的需要重构代码（也许注入类似初始化器的东西）。

亲切的问候

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-14T07:12:20.810

我想你真的想要某种工厂而不是静态初始化程序。

单例和抽象工厂的一些组合可能能够为您提供与今天相同的功能，并且具有良好的可测试性，但这会添加相当多的样板代码，因此尝试重构可能会更好静态的东西完全消失，或者如果你至少可以摆脱一些不太复杂的解决方案。

不过，如果没有看到您的代码，很难判断它是否可能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-14T14:55:56.250

我对 Mock 框架不是很了解，所以如果我错了请纠正我，但你不能有两个不同的 Mock 对象来涵盖你提到的情况吗？如

```
public static class MockClassWithEmptyStaticInit {
  public static void staticInit() {
  }
} 
```

和

```
public static class MockClassWithStaticInit {
  public static void staticInit() {
    System.out.println("static initialized.");
  }
} 
```

然后您可以在不同的测试用例中使用它们

```
@BeforeClass
public static void setUpBeforeClass() {
  Mockit.redefineMethods(ClassWithStaticInit.class, 
                         MockClassWithEmptyStaticInit.class);
} 
```

和

```
@BeforeClass
public static void setUpBeforeClass() {
  Mockit.redefineMethods(ClassWithStaticInit.class, 
                         MockClassWithStaticInit.class);
} 
```

分别。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-11-16T14:17:15.237

不是真正的答案，只是想知道 - 有没有办法“逆转”对 的调用`Mockit.redefineMethods`？
如果不存在这样的显式方法，不应该以下列方式再次执行它吗？

```
Mockit.redefineMethods(ClassWithStaticInit.class, ClassWithStaticInit.class); 
```

如果存在这样的方法，您可以在类的`@AfterClass`方法中执行它，并`ClassWithStaticInitTest`使用“原始”静态初始化程序块进行测试，就好像没有任何改变一样，来自同一个 JVM。

不过，这只是一种预感，所以我可能会遗漏一些东西。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-10-05T21:36:36.673

您可以使用 PowerMock 执行私有方法调用，例如：

```
ClassWithStaticInit staticInitClass = new ClassWithStaticInit()
Whitebox.invokeMethod(staticInitClass, "staticInit"); 
```

# python - Python 单元测试在哪里？

> ID：61151
> 
> 赞同：541
> 
> 时间：2008-09-14T05:41:11.810
> 
> 标签：python, unit-testing, code-organization

如果您正在编写库或应用程序，那么单元测试文件在哪里？

将测试文件与主应用程序代码分开很好，但将它们放在应用程序根目录内的“测试”子目录中会很尴尬，因为它会使导入您将要测试的模块变得更加困难。

这里有最佳实践吗？

* * *

## 回答 #1

> 赞同：235
> 
> 时间：2008-09-15T12:52:00.500

对于文件`module.py`，通常应该调用单元测试`test_module.py`，遵循 Pythonic 命名约定。

有几个普遍接受的地方可以放置`test_module.py`：

1.  在同一目录中`module.py`。
2.  在`../tests/test_module.py`（与代码目录同级）。
3.  在`tests/test_module.py`（代码目录下一级）。

我更喜欢#1，因为它可以简单地找到测试并导入它们。无论您使用什么构建系统，都可以轻松配置为运行以`test_`. 实际上，[用于测试发现的](https://docs.python.org/library/unittest.html#test-discovery)[默认`unittest``test*.py`](https://docs.python.org/library/unittest.html#test-discovery)模式是.

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2014-04-30T10:58:51.970

# 只有 1 个测试文件

如果只有 1 个测试文件，建议将其放在顶级目录中：

```
module/
    lib/
        __init__.py
        module.py
    test.py 
```

在 CLI 中运行测试

```
python test.py 
```

# 许多测试文件

如果有很多测试文件，把它放在一个`tests`文件夹中：

```
module/
    lib/
        __init__.py
        module.py
    tests/
        test_module.py
        test_module_function.py 
```

```
# test_module.py

import unittest
from lib import module

class TestModule(unittest.TestCase):
    def test_module(self):
        pass

if __name__ == '__main__':
    unittest.main() 
```

在 CLI 中运行测试

```
# In top-level /module/ folder
python -m tests.test_module
python -m tests.test_module_function 
```

## 利用[`unittest discovery`](https://docs.python.org/3/library/unittest.html#test-discovery)

`unittest discovery`将在包文件夹中找到所有测试。

创建一个`__init__.py`in`tests/`文件夹

```
module/
    lib/
        __init__.py
        module.py
    tests/
        __init__.py
        test_module.py
        test_module_function.py 
```

在 CLI 中运行测试

```
# In top-level /module/ folder

# -s, --start-directory (default current directory)
# -p, --pattern (default test*.py)

python -m unittest discover 
```

# 参考

*   [`pytest`](https://pytest.readthedocs.io/en/latest/goodpractices.html)测试布局的[良好实践](https://pytest.readthedocs.io/en/latest/goodpractices.html)
*   [`unittest`](https://docs.python.org/3/library/unittest.html)

# 单元测试框架

*   [鼻子](https://nose.readthedocs.org/en/latest/)
*   [鼻子2](https://docs.nose2.io/en/latest/)
*   [pytest](https://pytest.readthedocs.io/en/latest/contents.html)

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2008-09-14T06:46:14.960

一种常见的做法是将测试目录放在与模块/包相同的父目录中。因此，如果您的模块名为 foo.py，您的目录布局将如下所示：

```
parent_dir/
  foo.py
  tests/ 
```

当然，没有一种方法可以做到这一点。您还可以创建一个测试子目录并使用[absolute import](http://www.python.org/dev/peps/pep-0328/)导入模块。

无论您将测试放在哪里，我都建议您使用[鼻子](http://nose.readthedocs.org/en/latest/)来运行它们。[鼻子](http://nose.readthedocs.org/en/latest/)在您的目录中搜索测试。这样，您就可以在组织上最有意义的地方进行测试。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2009-05-02T17:08:05.437

[我们在编写 Pythoscope ( https://pypi.org/project/pythoscope/](https://pypi.org/project/pythoscope/) )时遇到了同样的问题，它为 Python 程序生成单元测试。在选择目录之前，我们在 python 列表中测试了人们，有很多不同的意见。最后我们选择在与源代码相同的目录下放置一个“tests”目录。在该目录中，我们为父目录中的每个模块生成一个测试文件。

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2008-09-19T16:46:53.827

我也倾向于将我的单元测试放在文件本身中，正如上面提到的 Jeremy Cantrell 所说，虽然我倾向于不将测试功能放在主体中，而是将所有内容放在一个

```
if __name__ == '__main__':
   do tests... 
```

堵塞。这最终将文档作为“示例代码”添加到文件中，以了解如何使用您正在测试的 python 文件。

我应该补充一点，我倾向于编写非常紧凑的模块/类。如果您的模块需要大量测试，您可以将它们放在另一个中，但即便如此，我仍然会添加：

```
if __name__ == '__main__':
   import tests.thisModule
   tests.thisModule.runtests 
```

这让任何阅读您的源代码的人都知道在哪里寻找测试代码。

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2016-09-28T07:31:38.043

每隔一段时间，我就会发现自己检查了测试放置的主题，并且每次大多数人都会在库代码旁边推荐一个单独的文件夹结构，但我发现每次的论点都是相同的，并且没有那么令人信服。我最终把我的测试模块放在核心模块旁边的某个地方。

这样做的主要原因是：**重构**。

当我移动东西时，我确实希望测试模块与代码一起移动；如果它们在单独的树中，很容易丢失测试。老实说，迟早你会得到一个完全不同的文件夹结构，比如[django](https://github.com/django/django)、[flask](https://github.com/pallets/flask)等等。如果你不在乎，这很好。

你应该问自己的主要问题是：

我在写：

*   a) 可重用库或
*   b）构建一个项目而不是将一些半分离的模块捆绑在一起？

如果一个：

单独的文件夹和维护其结构的额外努力可能更适合。没有人会抱怨您的测试被*部署到生产*环境中。

但是，当测试与核心文件夹混合时，也很容易将测试排除在分发之外；[把它放在 setup.py 中](http://setuptools.readthedocs.io/en/latest/setuptools.html?highlight=find_packages#using-find-packages)：

```
find_packages("src", exclude=["*.tests", "*.tests.*", "tests.*", "tests"]) 
```

如果 b：

你可能希望——就像我们每个人一样——编写可重用的库，但大多数时候它们的生命与项目的生命息息相关。能够轻松维护您的项目应该是一个优先事项。

然后，如果您做得很好并且您的模块非常适合另一个项目，那么它可能会被复制（而不是分叉或制作成单独的库）到这个新项目中，并将位于它旁边的测试移动到相同的文件夹结构中与在一个单独的测试文件夹已成为的混乱中钓鱼测试相比，这很容易。（你可能会争辩说它不应该是一团糟，但让我们在这里现实一点）。

所以选择仍然是你的，但我认为通过混合测试你可以获得与使用单独文件夹相同的所有东西，但在保持事物整洁方面的努力更少。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2008-09-14T18:18:58.133

我使用一个`tests/`目录，然后使用相对导入来导入主要的应用程序模块。所以在 MyApp/tests/foo.py 中，可能有：

```
from .. import foo 
```

导入`MyApp.foo`模块。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2008-09-14T06:46:03.837

我不相信有一个既定的“最佳实践”。

我将测试放在应用程序代码之外的另一个目录中。然后，在运行所有测试之前，我将主应用程序目录添加到我的测试运行程序脚本（它还执行一些其他操作）中的 sys.path（允许您从任何地方导入模块）。这样，当我发布它时，我永远不必从主代码中删除测试目录，如果数量很少的话，可以节省我的时间和精力。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2014-03-28T04:22:38.497

根据我在 Python 中开发测试框架的经验，我建议将 python 单元测试放在一个单独的目录中。保持对称的目录结构。这将有助于仅打包核心库而不打包单元测试。下面通过示意图来实现。

```
 <Main Package>
                               /          \
                              /            \
                            lib           tests
                            /                \
             [module1.py, module2.py,  [ut_module1.py, ut_module2.py,
              module3.py  module4.py,   ut_module3.py, ut_module.py]
              __init__.py] 
```

这样，当您使用 rpm 打包这些库时，您可以只打包主库模块（仅）。这有助于可维护性，尤其是在敏捷环境中。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2016-05-09T17:54:13.883

我建议你在 GitHub 上查看一些主要的 Python 项目并获得一些想法。

当您的代码变得更大并且您添加更多库时，最好在您拥有 setup.py 的同一目录中创建一个测试文件夹，并为每种测试类型（单元测试、集成等）镜像您的项目目录结构

例如，如果您的目录结构如下：

```
myPackage/
    myapp/
       moduleA/
          __init__.py
          module_A.py
       moduleB/
          __init__.py
          module_B.py
setup.py 
```

添加测试文件夹后，您将拥有如下目录结构：

```
myPackage/
    myapp/
       moduleA/
          __init__.py
          module_A.py
       moduleB/
          __init__.py
          module_B.py
test/
   unit/
      myapp/
         moduleA/
            module_A_test.py
         moduleB/
            module_B_test.py
   integration/
          myapp/
             moduleA/
                module_A_test.py
             moduleB/
                module_B_test.py
setup.py 
```

许多正确编写的 Python 包使用相同的结构。一个很好的例子是 Boto 包。检查[https://github.com/boto/boto](https://github.com/boto/boto)

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2010-03-02T12:50:51.140

我是怎么做到的...

文件夹结构：

```
project/
    src/
        code.py
    tests/
    setup.py 
```

Setup.py 指向 src/ 作为包含我的项目模块的位置，然后我运行：

```
setup.py develop 
```

它将我的项目添加到站点包中，指向我的工作副本。要运行我的测试，我使用：

```
setup.py tests 
```

使用我配置的任何测试运行器。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-12-19T23:48:07.130

我更喜欢顶级测试目录。这确实意味着进口变得更加困难。为此，我有两个解决方案：

1.  使用设置工具。然后你可以传入`test_suite='tests.runalltests.suite'`，`setup()`并且可以简单地运行测试：`python setup.py test`
2.  运行测试时设置 PYTHONPATH：`PYTHONPATH=. python tests/runalltests.py`

以下是 M2Crypto 中的代码如何支持这些东西：

*   [http://svn.osafoundation.org/m2crypto/trunk/setup.py](http://svn.osafoundation.org/m2crypto/trunk/setup.py)
*   [http://svn.osafoundation.org/m2crypto/trunk/tests/alltests.py](http://svn.osafoundation.org/m2crypto/trunk/tests/alltests.py)

如果你更喜欢用鼻子测试运行测试，你可能需要做一些不同的事情。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2018-12-12T10:10:06.843

我将测试与被测代码 (CUT) 放在同一目录中。在我可以使用我的插件调整 pytest 的项目中，因为`foo.py`我`foo.pt`用于测试，这使得编辑特定模块及其测试变得非常容易：`vi foo.*`.

在我不能这样做的地方，我使用`foo_ut.py`或类似的。你仍然可以使用`vi foo*`它，但它也会捕获`foobar.py`，`foobar_ut.py`如果存在的话。

无论哪种情况，我都会调整测试发现过程以找到这些。

这将测试放在目录列表中的代码旁边，使测试明显存在，并且使打开测试尽可能容易，因为它们位于单独的文件中。（对于从命令行启动的编辑器，如上所述；对于 GUI 系统，单击代码文件和相邻（或非常接近）的测试文件。

正如[其他人所指出的那样](https://stackoverflow.com/a/39740835/107294)，这也使得重构和提取代码以在必要时在其他地方使用变得更加容易。

我真的不喜欢将测试放在完全不同的目录树中的想法。为什么让开发人员在使用 CUT 打开文件时打开测试变得比必要的困难？并不是说绝大多数开发人员都热衷于编写或调整测试，以至于他们会忽略这样做的任何障碍，而不是以障碍为借口。（根据我的经验，恰恰相反；即使你让它尽可能简单，我也知道许多开发人员懒得写测试。）

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-24T17:44:16.050

我们用

```
app/src/code.py
app/testing/code_test.py 
app/docs/.. 
```

在我们插入的每个测试文件`../src/`中`sys.path`. 这不是最好的解决方案，但有效。我认为，如果有人想出类似 java 中的 maven 之类的东西，无论您从事什么项目，它都会为您提供可以正常工作的标准约定，那将是很棒的。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-15T03:09:29.200

在 C# 中，我通常将测试分成单独的程序集。

在 Python 中——到目前为止——我倾向于编写 doctest，其中测试位于函数的 docstring 中，或者将它们放在`if __name__ == "__main__"`模块底部的块中。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-16T21:10:12.917

如果测试很简单，只需将它们放在文档字符串中——大多数 Python 测试框架都可以使用它：

```
>>> import module
>>> module.method('test')
'testresult' 
```

对于其他更复杂的测试，我会将它们放入`../tests/test_module.py`或放入`tests/test_module.py`.

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-15T14:56:35.630

在编写一个名为“foo”的包时，我会将单元测试放入一个单独的包“foo_test”中。然后，模块和子包将与 SUT 包模块具有相同的名称。例如，模块 foo.xy 的测试在 foo_test.xy 每个测试包的 __init__.py 文件中包含一个 AllTests 套件，该套件包括该包的所有测试套件。setuptools 提供了一种方便的方式来指定主要的测试包，所以在“python setup.py develop”之后你可以使用“python setup.py test”或者“python setup.py test -s foo_test.x.SomeTestSuite”只是一个特定的套房。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2008-09-14T18:02:12.340

我最近开始用 Python 编程，所以我还没有机会找到最佳实践。但是，我编写了一个模块，可以找到所有测试并运行它们。

所以我有：

```
应用程序/
 应用文件.py
测试/
 应用文件测试.py

```

随着我进入更大的项目，我将不得不看看它是如何进行的。

# css - 在 CSS 中定位 div 的最佳方式是什么？

> ID：61155
> 
> 赞同：1
> 
> 时间：2008-09-14T06:01:37.050
> 
> 标签：css, layout

我正在尝试将此菜单放在页面的左侧：

```
<div class="left-menu" style="left: 123px; top: 355px">  
    <ul>  
        <li> Categories </li>  
        <li> Weapons </li>  
        <li> Armor </li>  
        <li> Manuals </li>  
        <li> Sustenance </li>  
        <li> Test </li>  
    </ul>  
</div>
```

问题是如果我使用绝对值或固定值，不同的屏幕尺寸会以不同的方式呈现导航栏。我还有一个`div`包含所有主要内容的第二个，这些内容也需要向右移动，到目前为止，我使用的是相对值，无论屏幕大小如何，它似乎都有效。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-14T08:29:26.413

`float`确实是实现这一目标的正确财产。不过bmatthews68给出的例子可以改进。浮动框最重要的一点是它们*必须*指定一个明确的宽度。这可能相当不方便，但这是 CSS 的工作方式。但是，请注意，这`px`是一个在 HTML/CSS 世界中没有位置的度量单位，至少不指定宽度。

始终采用适用于不同字体大小的措施，即使用`em`或`%`. 现在，如果菜单被实现为浮动体，那么这意味着主要内容“围绕”它浮动。如果主要内容高于菜单，这可能不是您想要的：

[float1 http://page.mi.fu-berlin.de/krudolph/stuff/float1.png](http://page.mi.fu-berlin.de/krudolph/stuff/float1.png)

```
<div style="width: 10em; float: left;">Left</div>
<div>Right, spanning<br/> multiple lines</div> 
```

您可以通过为主要内容提供`margin-left`等于菜单宽度的值来纠正此行为：

[float2 http://page.mi.fu-berlin.de/krudolph/stuff/float2.png](http://page.mi.fu-berlin.de/krudolph/stuff/float2.png)

```
<div style="width: 10em; float: left;">Left</div>
<div style="margin-left: 10em;">Right, spanning<br/> multiple lines</div> 
```

在大多数情况下，您还希望为主要内容提供 a `padding-left`，这样它就不会“粘”在菜单上。

顺便说一句，将上面的内容更改为微不足道，使菜单位于右侧而不是左侧：只需将每次出现的单词“left”更改为“right”。

啊，最后一件事。如果菜单的内容高于主要内容，它会因为`float`做了一些奇怪的事情而奇怪地呈现。在这种情况下，您必须清除浮体下方的框，如 bmatthews68 的示例所示。

/编辑：该死的，HTML 不像预览显示的那样工作。好吧，我已经包含了图片。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-14T06:04:48.710

我认为你应该使用**float**属性来定位这样的东西。[你可以在这里读到它。](http://css.maxdesign.com.au/floatutorial/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T16:19:01.027

所有使用浮点数（具有明确宽度）的答案都是正确的。但要回答最初的问题，定位 a 的最佳方法是`<div>`什么？这取决于。

CSS 是高度上下文相关的，页面的流程取决于 HTML 的结构。正常流程是元素及其子元素如何在其包含块（通常是父元素）内从上到下（对于块元素）和从左到右（对于内联元素）进行布局。这就是你的大部分布局应该如何工作的。您将倾向于依赖`width`, `margin`, 并将`padding`元素的间距和布局定义到它周围的其他元素（无论是`<div>`, `<ul>`,`<p>`还是其他元素，此时 HTML 主要是语义化的）。

`float`使用或`absolute`或定位之类的样式`relative`可以帮助您实现非常具体的布局目标，但了解如何使用它们很重要。如前所述，`float`通常用于将块元素彼此相邻放置，并且非常适合多列布局。

我不会在这里详细介绍，但您可能需要查看以下内容：

*   [SitePoint CSS References](http://reference.sitepoint.com/css) - 可能是我在网上找到的最直接、最完整的 CSS 参考资料。
*   [W3C CSS2.1 Visual Formatting Model](http://www.w3.org/TR/CSS21/visuren.html) - 是的，读起来很难，但它确实解释了一切。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-14T06:45:40.233

您应该使用 float 和 clear CSS 属性来获得所需的效果。

首先，我为布局中的两列定义了名为 left 和 right 的样式，以及一个名为 clearer 的样式，用于重置页面流。

```
<style type="text/css">
。剩下 {
    向左飘浮;
    宽度：200px；
}
。对 {
    浮动：对；
    宽度：800 像素；
}
。清除 {
    明确：两者；
    高度：1px；
}
</style>

```

然后我用它们来布局我的页面。

```
<div>
 <div class="左">
   <ul>
    <li>类别</li>
    <li>武器</li>
    <li>盔甲</li>
    <li>手册</li>
    <li>营养</li>
    <li>测试</li>
  </ul>
 </div>
 <div class="对">
   等等等等等等....
 </div>
</div>
<div class="clear" />

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-02T16:33:47.007

你可以使用浮动

```
<div class="left-menu">
<ul>
<li> Categories </li>
<li> Weapons </li>
<li> Armor </li>
<li> Manuals </li>
<li> Sustenance </li>
<li> Test </li>
</ul>
</div> 
```

在 css 文件中

```
.left-menu{float:left;width:200px;} 
```

# networking - Virtualbox 主机-访客网络设置

> ID：61156
> 
> 赞同：40
> 
> 时间：2008-09-14T06:03:20.883
> 
> 标签：networking, windows-vista, virtualbox

如何在 Windows vista 中的主机和来宾操作系统之间建立网络？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2010-01-12T08:39:36.557

给来宾两个网络适配器，一个是 NAT，另一个是 Host-only。NAT 将允许客人看到 Internet，而 Host-only 将允许主机看到客人。

其中之一还允许客人看到主人。我不确定哪个，但我知道它可以工作，因为我已经用它测试了 Web 服务器的东西。您只需选择正确的 IP 地址，10.xxx 或 192.168.xx

此外，您可能必须小心同时在两个适配器上运行文件和打印机共享，因为来宾将看到自己的名称并与自己发生冲突。我在安装过程中遇到了这个问题。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-01-13T03:53:26.313

我有一个比我的第一个更好的答案。

为来宾提供一个仅限主机的网络适配器，并在主机上启用 Internet 连接共享 (ICS)。我已经在带有 Windows XP 来宾的 Windows XP 主机上进行了尝试。

来宾可以连接到 Internet。

来宾可以通过 192.168.0.1（由 ICS 选择）等地址连接到主机。-- 记住允许访客通过主机的防火墙。

主机可以通过 192.168.0.22（由 ICS 提供的 DHCP 服务分配）之类的地址连接到访客。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-10-28T16:05:56.603

您可以在 Linux 主机上执行此操作。[我在这里](http://www.callum-macdonald.com/2009/10/28/virtualbox-host-to-guest-networking/)记录了我在 Ubuntu 9.04 中采取的步骤。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-14T07:35:58.240

我不运行 vista，但 virtualbox 应该为您完成大部分设置 - 您需要做的就是为您的客户操作系统分配一个 IP 地址、子网掩码和（可选）默认网关，它应该可以正常工作。

不要为虚拟机选项中的任何高级网络设置而烦恼——它们在某些情况下很有用，但我从来没有使用过它们，而且我已经使用 virtualbox 好几年了。

如果您发布您遇到的具体问题，也许我可以提供更多帮助。但是你的问题很模糊...

# java - 使用 IMAP 从 GMail 获取邮件到 Java 应用程序

> ID：61176
> 
> 赞同：76
> 
> 时间：2008-09-14T07:11:31.687
> 
> 标签：java, gmail, jakarta-mail, imap

我想使用[JavaMail](http://www.ing.iac.es/~docs/external/java/javamail/javadocs/index.html)和[IMAP](https://en.wikipedia.org/wiki/Internet_Message_Access_Protocol)从 Java 应用程序访问 Gmail 中的邮件。为什么我会收到*[SocketTimeoutException](https://docs.oracle.com/javase/7/docs/api/java/net/SocketTimeoutException.html)*？

这是我的代码：

```
Properties props = System.getProperties();
props.setProperty("mail.imap.host", "imap.gmail.com");
props.setProperty("mail.imap.port", "993");
props.setProperty("mail.imap.connectiontimeout", "5000");
props.setProperty("mail.imap.timeout", "5000");

try {
    Session session = Session.getDefaultInstance(props, new MyAuthenticator());
    URLName urlName = new URLName("imap://MYUSERNAME@gmail.com:MYPASSWORD@imap.gmail.com");
    Store store = session.getStore(urlName);
    if (!store.isConnected()) {
        store.connect();
    }
} catch (NoSuchProviderException e) {
    e.printStackTrace();
    System.exit(1);
} catch (MessagingException e) {
    e.printStackTrace();
    System.exit(2);
} 
```

我已经设置了超时值，这样它就不会“永远”超时。此外，*MyAuthenticator*还具有用户名和密码，这与 URL 似乎是多余的。还有另一种指定协议的方法吗？（我没有在[IMAP](https://en.wikipedia.org/wiki/Internet_Message_Access_Protocol)的 JavaDoc 中看到它。）

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-09-14T17:08:14.060

使用 imaps 是一个很好的建议。提供的答案都没有对我有用，所以我用谷歌搜索了更多，发现了一些有用的东西。这是我的代码现在的样子。

```
Properties props = System.getProperties();
props.setProperty("mail.store.protocol", "imaps");
try {
  Session session = Session.getDefaultInstance(props, null);
  Store store = session.getStore("imaps");
  store.connect("imap.gmail.com", "<username>@gmail.com", "<password>");
  ...
} catch (NoSuchProviderException e) {
  e.printStackTrace();
  System.exit(1);
} catch (MessagingException e) {
  e.printStackTrace();
  System.exit(2);
} 
```

这很好，因为它消除了多余的 Authenticator。我很高兴这能奏效，因为 SSLNOTES.txt 让我头晕目眩。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-03-27T10:50:59.127

您需要为 imap 使用以下属性：

```
props.setProperty("mail.imaps.host", "imap.gmail.com");
props.setProperty("mail.imaps.port", "993");
props.setProperty("mail.imaps.connectiontimeout", "5000");
props.setProperty("mail.imaps.timeout", "5000"); 
```

注意它是“imap”，而不是“imap”，因为您使用的协议是 imaps (IMAP + SSL)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-14T07:30:37.443

在 JavaMail 中，您可以使用`imaps`URL 方案来使用 IMAP over SSL。（有关`SSLNOTES.txt`更多详细信息，请参阅您的 JavaMail 发行版。）例如，`imaps://username%40gmail.com@imap.gmail.com/INBOX`.

同样，用于`smtps`通过 Gmail 发送电子邮件。例如，`smtps://username%40gmail.com@smtp.gmail.com/`。再次阅读`SSLNOTES.txt`以获取更多详细信息。希望能帮助到你！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-14T07:22:52.470

您必须仅使用 SSL 连接到 GMail。设置以下属性将为您强制执行。

```
props.setProperty("mail.imap.socketFactory.class", "javax.net.ssl.SSLSocketFactory");
props.setProperty("mail.imap.socketFactory.fallback", "false");

```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-07-03T21:49:30.450

以下是对我和我的团队有用的方法，给定一个经典帐户nickname@gmail.com 和一个企业帐户employee@business.com：

```
 final Properties properties = new Properties();
            properties.put("mail.imap.ssl.enable", "true");

            imapSession = Session.getInstance(properties, null);
            imapSession.setDebug(false);
            imapStore = imapSession.getStore("imap");

            imapStore.connect("imap.gmail.com", USERNAME, "password"); 
```

在经典案例中使用 USERNAME = "nickname"，在企业帐户案例中使用 USERNAME = "employee@business.com"。

在经典案例中，不要忘记在此处降低帐户安全性：https: [//www.google.com/settings/security/lesssecureapps](https://www.google.com/settings/security/lesssecureapps)

在这两种情况下，如果为帐户启用了IMAP，请检查 GMail*设置 => 转发 POP / IMAP 。*

希望能帮助到你！

更进一步：

*   [http://www.oracle.com/technetwork/java/javamail/faq/index.html#gmail](http://www.oracle.com/technetwork/java/javamail/faq/index.html#gmail)
*   [https://support.google.com/mail/accounts/answer/78754](https://support.google.com/mail/accounts/answer/78754)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-21T21:08:27.877

If you'd like more sample code on using JavaMail with Gmail (e.g. converting Gmail labels to IMAP folder names, or using IMAP IDLE), do check out my program [GmailAssistant](http://gmailassistant.sourceforge.net/) on [SourceForge](http://www.sourceforge.net/).

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T06:09:39.603

检查[http://g4j.sourceforge.net/](http://g4j.sourceforge.net/)。有一个使用此 API 构建的最小 gmail 客户端。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-05T09:27:56.647

我使用以下属性来获取商店并且效果很好。

`"mail.imaps.host" : "imap.gmail.com"
"mail.store.protocol" : "imaps"
"mail.imaps.port" : "993"`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-10-17T07:53:40.990

您需要安装 JSSE 才能在 Java 中使用 SSL

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-04T02:37:14.930

```
URLName server = new URLName("imaps://<gmail-user-name>:<gmail-pass>@imap.gmail.com/INBOX"); 
```

# browser - 桌面应用程序中的 Web：好的 Web 浏览器控件？

> ID：61180
> 
> 赞同：0
> 
> 时间：2008-09-14T07:23:37.897
> 
> 标签：browser, controls, desktop-application

多年来，我一直在基于桌面的应用程序（在我的情况下为 Windows Forms .NET）中使用“Web 浏览器控件”。我主要使用它来创建熟悉的基于流的用户界面，该界面还允许在需要时无缝过渡到互联网。

我真的厌倦了 IE 浏览器控件，因为它在输出时生成的 html 质量很差。另外，我想这实际上只是幕后的 IE7，因此有许多浏览器“问题”。尽管如此，它还是一个非常强大的控件，并提供了与您的桌面应用程序的丰富交互。

那么，除了 IE 浏览器控件之外，还有哪些替代方案呢？一年前我看过一个 Mosaic 等价物，但对未实现的功能数量感到失望，也许这最近有所改善？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-14T07:27:22.037

嗯..有趣的是

1.  [Mozilla](http://www.iol.ie/~locka/mozilla/control.htm)似乎提供了 ActiveX 控件
2.  [K-Melon](http://kmeleon.sourceforge.net/)是另一个基于 Gecko 的浏览器控件

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T16:16:05.040

流行的布局引擎：

1.  Mozilla 壁虎
2.  KHTML
3.  WebKit（基于 KHTML）

虽然我不确定将它们嵌入.Net 应用程序有多么容易。

# java - jTDS - 运行 Maven 构建项目时没有合适的驱动程序异常

> ID：61191
> 
> 赞同：2
> 
> 时间：2008-09-14T07:44:02.823
> 
> 标签：java, linux, maven-2, profiling, jtds

我们有一个简单的 [spring-hibernate] 应用程序（控制台应用程序），其中我们在可执行 JAR 文件的清单文件中设置了类路径。并且应用程序使用 jTDS JDBC 驱动程序连接到数据库，在 Windows 机器和 JDK 1.6 上一切正常，但在 Linux 上，应用程序无法找到驱动程序，我们正在使用 java -jar MainClassName 运行程序。

非常感谢任何关于为什么会发生这种情况的建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T00:40:09.397

出现此问题是因为我们的 jdbc.url 的 url 无效。这是因为 maven 将 jdbc.url 属性视为特殊属性，并且在进行分析时，而不是在 filter.properties 中定义的 url。这就是“没有合适的司机”例外的原因。这个问题应该更清楚。

无论如何要解决这个问题，我们必须将 jdbc.url 属性重命名为 jdbc.url.somename。这解决了我们的 Maven 分析问题。对于名为“server.name”的属性，我们也遇到了类似的 maven 分析问题。这个过滤器属性也让 maven profiling 感到困惑。我们还必须更改该属性的名称。

再次感谢费尔南多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-14T09:23:26.580

老实说，这听起来像是糟糕的 CLASSPATH。我建议开始调试此问题的一件事是将 jtds 包复制到与主包/类相同的路径，看看它是否有效。通过这种方式，您可以确保 Classpath 清单是否存在问题。Spring/Hibernate 依赖于 lib 目录，因此它将始终位于类路径中，因为它是主要结构。也可以使用 lib 目录进行测试。

希望本指南会有所帮助。还发送更多信息，例如路径、类路径和清单文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-07T11:50:57.973

这是一个 Maven 错误 [http://jira.codehaus.org/browse/MNG-3563](http://jira.codehaus.org/browse/MNG-3563)

# .net - 在 .NET 开发团队中创建最大速度的工具

> ID：61211
> 
> 赞同：10
> 
> 时间：2008-09-14T09:04:41.693
> 
> 标签：.net

如果您要为一个软件项目自筹资金，您将使用哪些工具、框架和组件来确保开发团队的最大生产力，并且正在解决“真正的”问题。

我正在寻找的是低摩擦的工具，它可以以最少的麻烦完成工作。我这样描述的工具是 SVN/TortioseSVN、ReSharper、VS 本身。我正在寻找能够解决所有软件项目（如 ORM、日志记录、UI 框架/组件）中固有问题的框架。UI 方面的一个例子是 ASP.NET MVC vs WebForms vs MonoRail。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-14T09:19:42.500

*   **版本控制。** *颠覆*是流行的选择。如果您负担得起，*Team Foundation Server*会提供一些好处。如果您想成为超现代的，请考虑使用分布式版本控制系统，例如*git*、*bazaar*或*Mercurial*。无论您做什么，都不要使用 SourceSafe 或其他基于锁的工具，而应使用基于合并的工具。考虑安装 Windows Explorer 客户端（例如*TortoiseSVN*）以及 Visual Studio 插件（例如*AnkhSVN*或*VisualSVN*）。
*   **问题跟踪。**鉴于 Joel Spolsky 是该网站的工作人员，*FogBugz*值得一提。*Trac*、*Mantis*和*BugZilla*是广泛的开源选择。
*   **持续集成。** *CruiseControl.NET*是一种流行的开源选择。还有*Draco.NET*。
*   **单元测试。** *NUnit*是流行的开源选择。做这项工作。考虑安装*TestDriven.NET* Visual Studio 加载项。

也就是说，您想查看[基本编程工具](https://stackoverflow.com/questions/2187/essential-programming-tools)的答案以及[您最好的“必备”开发工具列表是什么？](https://stackoverflow.com/questions/23490/what-is-your-best-list-of-must-have-development-tools); 虽然不是 .NET 特定的，但它们无论如何都应该适用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-14T09:52:18.647

伟大的工具和框架是必不可少的，但另一个重要的是伟大的项目领导。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-14T09:56:18.920

我会将 Resharper 添加到列表和 Ndepend 中。很可能犀牛也嘲笑。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-14T10:47:45.630

我会在 edg 上面所说的内容中再添加一个。你也需要一些有天赋的人。

[正如Flawfinder](http://www.dwheeler.com/flawfinder/)源代码检查器的作者 David Wheeler所说：

> 有工具的傻子还是傻子

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-14T13:03:32.557

我也推荐[Safari Books Online](http://safari.oreilly.com/)订阅。

哦，还有几加仑的咖啡。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-14T14:13:46.740

我会将[Moq](http://code.google.com/p/moq/)添加到列表中以模拟到列表中。与大多数其他模拟框架相比，语法要少得多。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-14T09:55:36.783

我肯定会推荐 Coderush+Refactor 或 Resharper（Coderush 是我个人最喜欢的），这些工具极大地减少了从头脑中的代码到页面上的代码的时间。

为了快速开发，来自 Telerik/DevExpress/Infragistics 之类的 UI 组件集可能很好，但根据我的经验，当您想要更精确地改进事物时，可能会在项目中进一步造成痛苦。

关于框架等，我认为您需要更具体地了解项目本身才能获得任何有意义的建议。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-14T10:03:27.060

良好的源代码控制可能应该是您的第一要务。我之前提到过它们，但[CVSDude](http://cvsdude.com/)是一个优秀的托管源代码控制提供商。我正在使用 SVN 包，它很棒。省去很多麻烦设置自己的服务器等。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-14T13:30:36.377

Microsoft 的[企业库](http://www.microsoft.com/downloads/details.aspx?familyid=4C557C63-708F-4280-8F0C-637481C31718&displaylang=en)也很有帮助。

> 此版本的企业库包括用于缓存、加密、数据访问、异常处理、日志记录、策略注入、安全性和验证的应用程序块。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-14T14:14:49.047

这是我们为团队使用的：

**问题跟踪：** Redmine - 这是一个很棒的免费问题/项目管理工具。然而，它是一个 ruby​​ on rails 应用程序，因此您需要一个适当的环境来启动和运行它。

**源代码控制：**带有 tortoiseSVN 的 Subversion - subversion 是一个很棒的源代码控制解决方案，并且 Tortoise 与资源管理器很好地集成在一起，不需要命令行的东西。它还支持用户端挂钩脚本，这对我的团队已经派上用场了很多次。

就是这样。我们不使用主框架，而是推出我们自己的库来满足我们对给定项目的需求。但是，我们确实将 jquery 用于 JavaScript 库。

其他一些随机的东西是免费的咖啡，最好的设备钱可以买到。

# git - 如何从当前 Git 工作树中删除本地（未跟踪）文件

> ID：61212
> 
> 赞同：7568
> 
> 时间：2008-09-14T09:06:10.647
> 
> 标签：git, branch, git-branch

如何从当前工作树中删除未跟踪的本地文件？

* * *

## 回答 #1

> 赞同：9364
> 
> 时间：2008-09-15T17:32:55.957

> ## [git-clean](https://git-scm.com/docs/git-clean) - 从工作树中删除未跟踪的文件
> 
> ### 概要
> 
> ```
> git clean [-d] [-f] [-i] [-n] [-q] [-e <pattern>] [-x | -X] [--] <path>…​ 
> ```
> 
> ### 描述
> 
> **从当前目录开始，**通过递归删除不受版本控制的文件来清理工作树。
> 
> 通常，只会删除 Git 未知的文件，但如果`-x`指定了该选项，也会删除忽略的文件。例如，这对于删除所有构建产品很有用。
> 
> 如果给出任何可选`<path>...`参数，则只有那些路径受到影响。

* * *

第 1 步是使用以下`-n`选项显示将要删除的内容：

```
# Print out the list of files and directories which will be removed (dry run)
git clean -n -d 
```

清洁步骤 -**注意：这将删除文件**：

```
# Delete the files from the repository
git clean -f 
```

*   要删除目录，请运行`git clean -f -d`或`git clean -fd`
*   要删除忽略的文件，请运行`git clean -f -X`或`git clean -fX`
*   要删除忽略和未忽略的文件，请运行`git clean -f -x`或`git clean -fx`

**请注意**后两个命令的大小写差异`X`。

如果`clean.requireForce`在您的配置中设置为“true”（默认值），则需要指定，`-f`否则实际上不会发生任何事情。

再次查看[`git-clean`](http://git-scm.com/docs/git-clean)文档以获取更多信息。

* * *

> ### 选项
> 
> **`-f`,`--force`**
> 
> 如果 Git 配置变量 clean.requireForce 没有设置为 false，git clean 将拒绝运行，除非给定`-f`,`-n`或`-i`.
> 
> **`-x`**
> 
> 不要使用从 .gitignore （每个目录）和 读取的标准忽略规则`$GIT_DIR/info/exclude`，但仍然使用`-e`选项给出的忽略规则。这允许删除所有未跟踪的文件，包括构建产品。这可以用来（可能与 git reset 结合使用）来创建一个原始工作目录来测试一个干净的构建。
> 
> **`-X`**
> 
> 仅删除 Git 忽略的文件。这可能有助于从头开始重建所有内容，但保留手动创建的文件。
> 
> **`-n`,`--dry-run`**
> 
> 实际上不要删除任何东西，只是显示将要做什么。
> 
> **`-d`**
> 
> 除了未跟踪的文件之外，还删除未跟踪的目录。如果未跟踪的目录由不同的 Git 存储库管理，则默认情况下不会将其删除。`-f`如果您真的想删除这样的目录，请使用选项两次。

* * *

## 回答 #2

> 赞同：1169
> 
> 时间：2009-05-26T20:59:18.980

用于`git clean -f -d`确保**目录**也被删除。

1.  实际上不要删除任何东西，只是显示将要做什么。

    ```
    git clean -n 
    ```

    或者

    ```
    git clean --dry-run 
    ```

2.  除了未跟踪的文件之外，还删除未跟踪的目录。如果未跟踪的目录由不同的 Git 存储库管理，则默认情况下不会将其删除。`-f`如果您真的想删除这样的目录，请使用该选项两次。

    ```
    git clean -fd 
    ```

然后，您可以检查您的文件是否真的与`git status`.

* * *

## 回答 #3

> 赞同：534
> 
> 时间：2013-12-30T20:12:58.077

我很惊讶之前没有人提到这一点：

```
git clean -i 
```

这代表*交互式*，您将快速了解将要删除的内容，为您提供包含/排除受影响文件的可能性。总体来说，还是比`--dry-run`真正清扫前的强制运行要快。

`-d`如果您还想处理空文件夹，则必须折腾。最后，它形成了一个很好的别名：

```
git iclean 
```

话虽如此，对于有经验的用户来说，额外手持交互式命令可能会很累。这些天我只使用已经提到的`git clean -fd`

* * *

## 回答 #4

> 赞同：412
> 
> 时间：2008-09-14T09:09:25.130

[`git-clean`- 从工作树中删除未跟踪的文件](http://git-scm.com/docs/git-clean)

* * *

## 回答 #5

> 赞同：336
> 
> 时间：2016-06-03T12:16:30.473

## 删除未跟踪文件的简单方法

要删除所有未跟踪的文件，简单的方法是首先**添加所有**文件并**重置 repo**，如下所示

```
git add --all
git reset --hard HEAD 
```

* * *

* * *

## 回答 #6

> 赞同：281
> 
> 时间：2013-01-25T12:24:01.047

如果 untracked 目录是自己的 git 仓库（例如子模块），则需要使用`-f`两次：

`git clean -d -f -f`

* * *

## 回答 #7

> 赞同：153
> 
> 时间：2014-01-11T00:41:36.883

我喜欢`git stash push -u`，因为你可以用`git stash pop`.

编辑：我还找到了一种在存储中显示未跟踪文件的方法（例如`git show stash@{0}^3`）[https://stackoverflow.com/a/12681856/338986](https://stackoverflow.com/a/12681856/338986)

EDIT2:`git stash save`已弃用，取而代之的是`push`. 谢谢@script-wolf。

* * *

## 回答 #8

> 赞同：147
> 
> 时间：2013-11-25T14:16:12.260

这是我一直使用的：

```
git clean -fdx 
```

对于一个非常大的项目，您可能需要运行几次。

* * *

## 回答 #9

> 赞同：103
> 
> 时间：2008-09-14T09:08:00.453

[git-clean](http://www.kernel.org/pub/software/scm/git/docs/git-clean.html)是您正在寻找的。它用于从工作树中删除未跟踪的文件。

* * *

## 回答 #10

> 赞同：95
> 
> 时间：2013-09-24T06:28:30.040

如果需要从特定子目录中删除未跟踪的文件，

```
git clean -f {dir_path} 
```

以及删除未跟踪的目录/文件和忽略文件的组合方式。

```
git clean -fxd {dir_path} 
```

在此之后，您将仅在`git status`.

* * *

## 回答 #11

> 赞同：88
> 
> 时间：2017-02-12T08:33:07.833

**删除此 repo + 子模块中的所有额外文件夹和文件**

这使您处于与新鲜克隆相同的状态。

```
git clean -ffdx 
```

**删除此 repo 中的所有额外文件夹和文件，但不删除其子模块**

```
git clean -fdx 
```

**删除额外的文件夹，但不删除文件（例如 build 或 logs 文件夹）**

```
git clean -fd 
```

**删除多余的文件夹 + 忽略的文件（但不是新添加的文件）**

如果文件未被忽略且尚未签入，则它会保留。注意大写 X。

```
git clean -fdX 
```

**新的交互模式**

```
git clean 
```

* * *

## 回答 #12

> 赞同：66
> 
> 时间：2015-01-22T06:33:30.687

`git clean -fd`删除目录

`git clean -fX`删除被忽略的文件

`git clean -fx`删除忽略和未忽略的文件

可以组合使用上述所有选项

`git clean -fdXx`

查看 git 手册以获得更多帮助

* * *

## 回答 #13

> 赞同：66
> 
> 时间：2017-07-20T16:42:45.237

**好的，**删除**不需要的未跟踪文件和文件夹**很容易`git`在命令行中使用，只需这样做：

```
git clean -fd 
```

**在执行此操作之前请仔细检查**，因为它会删除文件和文件夹而不会产生任何历史记录...

同样在这种情况下，`-f`代表力并`-d`代表目录...

因此，如果您只想删除文件，则只能使用`-f`：

```
git clean -f 
```

如果要**删除**（目录）和文件，则只能删除未跟踪的目录和文件，如下所示：

```
git clean -fd 
```

此外，您可以使用`-x`flag 来包含 git 忽略的文件。如果您想删除所有内容，这将很有帮助。

并添加`-i`标志，使 git 要求您在旅途中一一删除文件的权限。

如果您不确定并想先检查一下，请添加`-n`标志。

`-q`如果您不想在成功删除后看到任何报告，请使用此选项。

我还创建了下面的图像以使其更令人难忘，尤其是我看到很多人`-f`有时会混淆清理文件夹或以某种方式将其混淆！

[![删除不需要的未跟踪文件和文件夹](https://i.stack.imgur.com/3W563.png)](https://i.stack.imgur.com/3W563.png)

* * *

## 回答 #14

> 赞同：53
> 
> 时间：2017-10-21T21:44:58.687

# 运行 `git clean` 命令时要小心。

**始终** `-n`在运行实际命令之前使用，因为它会显示哪些文件将被删除。

```
git clean -n -d 
git clean -f -d 
```

默认情况下，`git clean`只会删除未被忽略的未跟踪文件。任何与 .gitignore 或其他忽略文件中的模式匹配的文件都不会被删除。如果你也想删除这些文件，你可以`-x`在 clean 命令中添加一个。

```
git clean -f -d -x 
```

`-i`clean 命令还提供交互模式

```
git clean -x -i 
```

# 或者

如果您不能 100% 确定删除未提交的工作是否安全，则可以使用 stash

```
git stash --all 
```

使用之前`stash --all`注意：如果使用该`--all`选项，则除了**未跟踪的文件之外，****忽略的文件**也会被隐藏和清理。

 **Stash 也将清除您的目录，但让您可以灵活地随时使用**stash**和**apply**或**pop**检索文件。然后，如果您可以删除隐藏的文件，您可以运行：

```
git stash drop // or clean 
```

要查看有关如何使用存储的完整说明，请参阅[如何在 git 中按名称命名和检索存储？](https://stackoverflow.com/questions/11269256/how-to-name-and-retrieve-a-stash-by-name-in-git)

* * *

## 回答 #15

> 赞同：43
> 
> 时间：2015-04-16T06:49:13.810

更好的方法是使用： git clean

```
git clean -d -x -f 
```

这将删除未跟踪的文件，包括`(-d)`被`git (-x)`.

此外，将`-f`参数替换`-n`为执行 a`dry-run`或`-i`for 交互模式，它会告诉您将删除什么。

* * *

## 回答 #16

> 赞同：31
> 
> 时间：2017-03-02T20:09:06.340

***用户交互方式：***

```
git clean -i -fd

Remove .classpath [y/N]? N
Remove .gitignore [y/N]? N
Remove .project [y/N]? N
Remove .settings/ [y/N]? N
Remove src/com/arsdumpgenerator/inspector/ [y/N]? y
Remove src/com/arsdumpgenerator/manifest/ [y/N]? y
Remove src/com/arsdumpgenerator/s3/ [y/N]? y
Remove tst/com/arsdumpgenerator/manifest/ [y/N]? y
Remove tst/com/arsdumpgenerator/s3/ [y/N]? y 
```

-i 用于交互式
-f 用于强制
-d 用于目录
-x 用于忽略的文件（如果需要，添加）

**注意：** *添加**-n**或**--dry-run**以检查它将做什么。*

* * *

## 回答 #17

> 赞同：25
> 
> 时间：2016-02-21T17:29:08.200

我刚刚发明并尝试过的这种情况的救生窍门（效果很好）：

```
git add .
git reset --hard HEAD 
```

**谨防！**确保**在执行此操作之前****提交任何需要的更改**（即使是在未跟踪的文件中）。

 *** * *

## 回答 #18

> 赞同：23
> 
> 时间：2016-08-16T15:29:20.293

对我来说，只有以下工作：

```
git clean -ffdx 
```

在所有其他情况下，我收到一些子目录的消息*“跳过目录”*。

* * *

## 回答 #19

> 赞同：22
> 
> 时间：2015-12-02T17:57:44.180

`git clean -f -d -x $(git rev-parse --show-cdup)`无论您在存储库目录树中的哪个位置调用它，都适用于根目录。我一直使用它，因为它不会强迫你离开你现在工作的文件夹，并允许你从你所在的地方清理和提交。

确保 flags `-f`, `-d`,`-x`符合您的需求：

```
-d
       Remove untracked directories in addition to untracked files. If an
       untracked directory is managed by a different Git repository, it is
       not removed by default. Use -f option twice if you really want to
       remove such a directory.

-f, --force
       If the Git configuration variable clean.requireForce is not set to
       false, git clean will refuse to delete files or directories unless
       given -f, -n or -i. Git will refuse to delete directories with .git
       sub directory or file unless a second -f is given. This affects
       also git submodules where the storage area of the removed submodule
       under .git/modules/ is not removed until -f is given twice.

-x
       Don't use the standard ignore rules read from .gitignore (per
       directory) and $GIT_DIR/info/exclude, but do still use the ignore
       rules given with -e options. This allows removing all untracked
       files, including build products. This can be used (possibly in
       conjunction with git reset) to create a pristine working directory
       to test a clean build. 
```

还有其他标志可用，只需检查`git clean --help`.

* * *

## 回答 #20

> 赞同：20
> 
> 时间：2020-05-20T16:05:48.853

要删除未跟踪的文件：

```
git add .
git reset --hard HEAD 
```

* * *

## 回答 #21

> 赞同：19
> 
> 时间：2016-03-02T02:09:47.497

如果您只想删除被 'git status' 列为未跟踪的文件

```
git stash save -u
git stash drop "stash@{0}" 
```

我更喜欢它而不是 'git clean' 因为 'git clean' 会删除被 git 忽略的文件，所以你的下一个构建将不得不重建所有内容，你也可能会丢失你的 IDE 设置。

* * *

## 回答 #22

> 赞同：17
> 
> 时间：2016-02-16T08:42:09.953

要在实际删除之前知道将要删除的内容：

`git clean -d -n`

它将输出如下内容：

**将删除 sample.txt**

要删除上一个命令输出中列出的所有内容：

`git clean -d -f`

它将输出如下内容：

**删除 sample.txt**

* * *

## 回答 #23

> 赞同：14
> 
> 时间：2016-10-25T09:09:27.253

要删除未跟踪的文件，您应该首先使用命令查看将受到清理影响的文件

```
git clean -fdn 
```

这将向您显示将被删除的文件列表。现在要实际删除这些文件，请使用以下命令：

```
git clean -fd 
```

* * *

## 回答 #24

> 赞同：13
> 
> 时间：2021-04-14T20:18:35.747

`git add --all`,`git stash`和`git stash drop`, 按此顺序尝试这三个命令，以删除所有未跟踪的文件。通过将所有这些未跟踪的文件添加到 git 并存储它们会将所有这些未跟踪的文件移动到存储列表并删除最上面的文件，即 stash@{0} 将从存储列表中删除隐藏的更改。

* * *

## 回答 #25

> 赞同：12
> 
> 时间：2017-09-01T06:23:29.120

**从 git docs 中删除未跟踪文件的**建议命令是**git clean**

**git clean** - 从工作树中删除未跟踪的文件

**建议的方法：** 使用交互模式，`git clean -i` 这样我们就可以控制它。让我们看看剩余的可用选项。

**可用选项：**

```
git clean 
    -d -f -i -n -q -e -x -X (can use either) 
```

**解释：**

**1\.** **-d**

除了未跟踪的文件之外，还删除未跟踪的目录。如果未跟踪的目录由不同的 Git 存储库管理，则默认情况下不会将其删除。如果您真的想删除这样的目录，请使用两次 -f 选项。

**2.-f，--强制**

如果 Git 配置变量 clean.requireForce 没有设置为 false，除非给定 -f、-n 或 -i，否则 git clean 将拒绝运行。

**3.-i，--交互式**

显示将要做什么并以交互方式清理文件。有关详细信息，请参阅“交互模式”。

**4.-n，--干运行**

实际上不要删除任何东西，只是显示将要做什么。

**5.-q，--安静**

安静，只报告错误，不报告成功删除的文件。

**6\. -e，--排除=**

除了在 .gitignore（每个目录）和 $GIT_DIR/info/exclude 中找到的那些之外，还要考虑这些模式在有效的忽略规则集中。

**7.-x**

不要使用从 .gitignore（每个目录）和 $GIT_DIR/info/exclude 读取的标准忽略规则，但仍然使用 -e 选项给出的忽略规则。这允许删除所有未跟踪的文件，包括构建产品。这可以用来（可能与 git reset 结合使用）来创建一个原始工作目录来测试一个干净的构建。

**8.-X**

仅删除 Git 忽略的文件。这可能有助于从头开始重建所有内容，但保留手动创建的文件。

* * *

## 回答 #26

> 赞同：11
> 
> 时间：2016-10-11T00:14:30.850

普通`git clean`命令不会使用 my 删除未跟踪的文件`git version 2.9.0.windows.1`。

```
$ git clean -fdx     # doesn't remove untracked files
$ git clean -fdx *   # Append star then it works! 
```

* * *

## 回答 #27

> 赞同：11
> 
> 时间：2017-02-16T09:05:32.220

`git clean -f to remove untracked files from working directory.`

我在我的博客[git-intro-basic-commands 中介绍了一些基础知识](https://vaisakh.github.io/2017/02/14/git-intro-basic-commands.html)

* * *

## 回答 #28

> 赞同：9
> 
> 时间：2017-12-04T06:30:46.070

我们可以使用下面的 git 注释轻松地从当前的 git 工作树中删除本地未跟踪的文件。

```
git reset [--soft | --mixed [-N] | --hard | --merge | --keep] [-q] [<commit>] 
```

**例子：**

```
git reset --hard HEAD 
```

**链接：**

1.  [https://git-scm.com/docs/git-reset](https://git-scm.com/docs/git-reset)
2.  [如何使用 'git reset --hard HEAD' 恢复到以前的提交？](https://stackoverflow.com/questions/9529078/how-do-i-use-git-reset-hard-head-to-revert-to-a-previous-commit)
3.  [将本地存储库分支重置为就像远程存储库 HEAD](https://stackoverflow.com/questions/1628088/reset-local-repository-branch-to-be-just-like-remote-repository-head)
4.  [https://jwiegley.github.io/git-from-the-bottom-up/3-Reset/4-doing-a-hard-reset.html](https://jwiegley.github.io/git-from-the-bottom-up/3-Reset/4-doing-a-hard-reset.html)

* * *

## 回答 #29

> 赞同：8
> 
> 时间：2017-09-25T16:25:54.417

> ## **递归清理 git 存储库和所有子模块**
> 
> 以下命令将递归清除当前 git 存储库及其所有子模块：
> 
> ```
> (git clean -d -x -f && git submodule foreach --recursive git clean -d -x -f) 
> ```

* * *

## 回答 #30

> 赞同：7
> 
> 时间：2017-11-02T08:24:54.273

**oh-my-zsh** with **zsh**通过 git 插件提供了这些很棒的别名。它们也可以在 bash 中使用。

`gclean='git clean -fd'`
`gpristine='git reset --hard && git clean -dfx'`

*   `gclean` *除了未跟踪的文件之外，还删除未跟踪的目录*。
*   `gpristine`硬重置本地更改，删除未跟踪的目录，未跟踪的文件，*不要使用从 .gitignore（每个目录）和 $GIT_DIR/info/exclude 读取的标准忽略规则，但仍然使用 -e 选项给出的忽略规则。这允许删除所有未跟踪的文件，包括构建产品。这可以用来（可能与 git reset 结合使用）来创建一个原始工作目录来测试一个干净的构建*。

* * *

## 回答 #31

> 赞同：7
> 
> 时间：2018-05-18T06:04:51.517

```
git clean -f 
```

将从当前 git 中删除未跟踪的文件

```
git clean -fd 
```

当您要删除目录和文件时，这将只删除未跟踪的目录和文件

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2018-11-10T22:23:52.530

我喜欢使用`git stash`命令，稍后您可以获得隐藏的文件和更改。 `git clean`也是一个不错的选择，但完全取决于您的要求。这里是 git stash 和 git clean 的解释，[7.3 Git Tools - Stashing and Cleaning](https://git-scm.com/book/en/v2/Git-Tools-Stashing-and-Cleaning)

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2016-12-16T15:05:48.287

*注意：首先导航到目录并签出要清理的分支。*

`-i`交互模式，它将告诉您将删除的内容，您可以从列表中选择一个操作。

1.  只清理**文件**[文件夹不会被列出也不会被清理]： `$ git clean -i`

2.  清理**文件和文件夹**： `$ git clean -d -i`

`-d`包括目录。

* * *

如果您`c`从列表中选择。将删除未跟踪的文件/文件夹，还将删除您弄乱的文件/文件夹。*

例如：如果您重组远程文件夹中的文件夹并将更改拉到本地计算机。最初由其他人创建的文件/文件夹将位于过去的文件夹和您重组的新文件夹中。

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2018-08-16T09:05:59.093

> 我在这里使用最流行的答案失败了 - git 无论如何都不会从存储库中删除未跟踪的文件。不知道为什么。这是我的超级简化答案，没有特殊的 Git 命令！

任务：从 git 存储库中删除未跟踪的文件：

1.  将文件和文件夹从本地项目文件夹移至其他位置一段时间
2.  删除 .gitignore 中关于提交的这些文件和文件夹的所有行
3.  git 添加 .
4.  Git commit -m “从未跟踪的文件中清理存储库”</li>
5.  git推送

所有文件和文件夹已从存储库中删除。

如果需要，让我们在 localhost 上恢复它们​​：

1.  将您临时移动的所有文件和文件夹再次移回本地项目文件夹
2.  将有关这些文件和文件夹的所有行移回 .gitignore
3.  git 添加 .
4.  git commit -m “检查或文件不再出现在 git 存储库中”</li>
5.  git推送

你完成了！

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2020-11-10T13:23:10.893

要删除完整的更改**git clean -f -d**

```
$ git clean -f -d
Removing client/app/helpers/base64.js
Removing files/
Removing package.json.bak

where 
-f is force 
-d is a directory 
```

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2021-07-27T15:09:59.253

我认为安全和简单的方法是这样的！

```
git add .
git stash 
```

有关更多信息 [https://www.atlassian.com/git/tutorials/saving-changes/git-stash#stashing-your-work](https://www.atlassian.com/git/tutorials/saving-changes/git-stash#stashing-your-work)

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2017-08-08T02:02:34.410

用于`git reset HEAD <file>`取消暂存文件

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2019-04-24T13:18:40.943

如果没有其他工作，只需删除“git status”命令列出的所有更改，可以使用以下组合：

`git add -A && git commit -m temp && git reset --hard HEAD^`

这将首先暂存您的所有更改，然后创建一个临时提交，然后将其丢弃。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2019-12-21T11:23:37.823

这可以使用 shell 脚本来完成，我使用这个脚本来列出将要删除的内容，然后让我确认操作。

这很有用，因为我有时会在擦除所有内容之前检查补丁或其他文件。

```
#!/bin/bash
readarray -t -d '' FILES < <(git ls-files -z --other --directory)
if [ "$FILES" = "" ]; then
    echo  "Nothing to clean!"
    exit 0
fi
echo -e "Dirty files:\n"
printf '  %s\n' "${FILES[@]}"
DO_REMOVE=0
while true; do
    echo ""
    read -p "Remove ${#FILES[@]} files? [y/n]: " choice
    case "$choice" in
        y|Y )
            DO_REMOVE=1
            break ;;
        n|N )
            echo "Exiting!"
            break ;;
        * ) echo "Invalid input, expected [Y/y/N/n]"
            continue ;;
    esac
done

if [ "$DO_REMOVE" -eq 1 ];then
    echo "Removing!"
    for f in "${FILES[@]}"; do
        rm -rfv -- "$f"
    done
fi 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2020-08-26T05:15:11.973

用法：git clean [-d] [-f] [-i] [-n] [-q] [-e ] [-x | -X] [ - ] ...

```
-q, --quiet           do not print names of files removed
-n, --dry-run         dry run
-f, --force           force
-i, --interactive     interactive cleaning
-d                    remove whole directories
-e, --exclude <pattern>
                      add <pattern> to ignore rules
-x                    remove ignored files, too
-X                    remove only ignored files 
```

* * *

## 回答 #41

> 赞同：-6
> 
> 时间：2019-06-10T05:19:47.020

我用这个：

1.  `git status`
2.  复制文件的路径
3.  `rm <path of file>`

我的项目有很多由巨大的 ANT 构建脚本创建的生成文件。使用`git clean`会造成混乱。

# asp.net - 从登录后的页面获取 HTML

> ID：61217
> 
> 赞同：1
> 
> 时间：2008-09-14T09:19:09.257
> 
> 标签：asp.net, html, screen-scraping

[这个问题是我之前](https://stackoverflow.com/questions/56279/export-aspx-to-html)关于从 ASPX 页面获取 HTML 的问题的后续问题。我决定尝试使用 webclient 对象，但问题是我得到了登录页面的 HTML，因为需要登录。我尝试使用 webclient 对象“登录”：

```
WebClient ww = new WebClient();

 ww.DownloadString("Login.aspx?UserName=&Password=");

 string html = ww.DownloadString("Internal.aspx"); 
```

但是我仍然一直得到登录页面。我知道用户名信息没有存储在 cookie 中。我一定是做错了什么或者遗漏了重要的部分。有谁知道它可能是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-14T09:38:36.713

尝试设置 WebClient 对象的凭据属性

```
WebClient ww = new WebClient();
ww.Credentials = CredentialCache.DefaultCredentials;
ww.DownloadString("Login.aspx?UserName=&Password=");
string html = ww.DownloadString("Internal.aspx"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-14T09:23:26.127

那么用“Login.aspx?UserName=&Password=”在浏览器中打开页面正常工作吗？
某些页面可能不允许使用 url 中提供的数据登录，必须在页面上的登录表单中输入，然后提交。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-14T19:59:55.503

我能想到的唯一另一个原因是网页故意阻止它登录。如果您有权访问代码，请查看用于查看是否有任何东西旨在阻止此类登录的登录系统。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T20:09:53.193

只需将有效的登录参数传递给给定的 URI。应该能帮到你。

**如果您没有登录信息，则不应试图规避它。**

```
公共静态字符串 HttpPost（字符串 URI，字符串参数）
      {
         System.Net.WebRequest req = System.Net.WebRequest.Create(URI);
         req.ContentType = "应用程序/x-www-form-urlencoded";
         req.Method = "POST";
         byte[] bytes = System.Text.Encoding.ASCII.GetBytes( 参数 );
         req.ContentLength = bytes.Length;
         System.IO.Stream os = req.GetRequestStream();
         os.Write（字节，0，字节。长度）；
         os.Close();
         System.Net.WebResponse resp = req.GetResponse();
         如果（resp == null）返回null；
         System.IO.StreamReader sr = new System.IO.StreamReader(resp.GetResponseStream());
         返回 sr.ReadToEnd().Trim();
      }

```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T03:29:22.093

使用[Fiddler](http://www.fiddler2.com)查看通过浏览器手动执行时发生的 HTTP 请求和响应。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-14T09:27:23.153

@Fire Lancer：我在测试期间问过自己同样的问题，所以我检查了一下，它确实可以在浏览器中使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T20:03:45.393

由于我试图获取的 aspx 页面位于我自己的项目中，因此我可以使用 Server.Execute 方法。我对原始问题[的回答](https://stackoverflow.com/questions/56279/export-aspx-to-html#66312)中有更多详细信息

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T03:25:07.987

将 Firefox 与[LiveHttpHeaders](http://livehttpheaders.mozdev.org/)插件一起使用。
这将允许您通过实际的浏览器登录，并准确查看发送到服务器的内容。我的第一个问题是验证它不期望表单中的 POST。您正在加载的示例 URL 正在通过查询字符串 GET 发送信息。

# c# - Debug.Assert 与特定抛出的异常

> ID：61219
> 
> 赞同：33
> 
> 时间：2008-09-14T09:19:44.310
> 
> 标签：c#, exception-handling, assert

我刚刚开始浏览 John Robbins 的“调试 MS .Net 2.0 应用程序”，并且对他对 Debug.Assert(...) 的宣传感到困惑。

他指出，良好实现的断言在某种程度上存储了错误条件的状态，例如：

```
Debug.Assert(i > 3, "i > 3", "This means I got a bad parameter"); 
```

现在，就我个人而言，他如此喜欢在没有实际明智的“业务逻辑”评论的情况下重述他的测试，这对我来说似乎很疯狂，也许“由于 florbittyjam widgitification 过程，i <= 3 绝不能发生”。

所以，我认为我将 Asserts 作为一种低级的“让我们保护我的假设”之类的东西......假设人们觉得这是一个只需要在调试中进行的测试 - 即你正在保护自己免受同事的伤害和未来的程序员，并希望他们能真正测试一些东西。

但我不明白的是，他接着说除了正常的错误处理之外，您还应该使用断言；现在我设想的是这样的：

```
Debug.Assert(i > 3, "i must be greater than 3 because of the flibbity widgit status");
if (i <= 3)
{
    throw new ArgumentOutOfRangeException("i", "i must be > 3 because... i=" + i.ToString());
} 
```

错误条件测试的 Debug.Assert 重复我得到了什么？如果我们谈论一个非常重要的计算的仅调试双重检查，我想我会明白的......

```
double interestAmount = loan.GetInterest();
Debug.Assert(debugInterestDoubleCheck(loan) == interestAmount, "Mismatch on interest calc"); 
```

...但我没有得到它用于肯定值得检查的参数测试（在调试和发布版本中）......或者不是。我错过了什么？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-14T09:26:56.133

断言不适用于参数检查。应始终进行参数检查（并准确地根据您的文档和/或规范中指定的先决条件），并`ArgumentOutOfRangeException`根据需要进行抛出。

断言用于测试“不可能”的情况，即你（在你的程序逻辑中）*假设*的事情是真的。这些断言可以告诉您这些假设是否因任何原因而被打破。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-14T10:57:27.680

断言与异常抛出有一个通信方面。

假设我们有一个带有 Name 属性和 ToString 方法的 User 类。

如果 ToString 是这样实现的：

```
public string ToString()
{
     Debug.Assert(Name != null);
     return Name;
} 
```

它说 Name 永远不应该为空，如果是的话， User 类中有一个错误。

如果 ToString 是这样实现的：

```
public string ToString()
{
     if ( Name == null )
     {
          throw new InvalidOperationException("Name is null");
     }

     return Name;
} 
```

它表示如果 Name 为空，则调用者错误地使用 ToString 并且应该在调用之前检查它。

两者的实现

```
public string ToString()
{
     Debug.Assert(Name != null);
     if ( Name == null )
     {
          throw new InvalidOperationException("Name is null");
     }

     return Name;
} 
```

表示如果 Name 为 null，则 User 类中存在错误，但我们还是想处理它。（用户在调用之前不需要检查姓名。）我认为这是 Robbins 推荐的安全类型。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-01-09T16:06:10.720

在针对测试问题提供有关调试与断言的指导时，我已经考虑了这一点。

你应该能够用错误的输入、错误的状态、无效的操作顺序和任何其他可能的错误条件来测试你的类，并且断言**永远不会**出错。无论执行的输入或计算如何， 每个断言都在检查某些东西是否应该**始终为真。**

我得出的良好经验法则：

1.  断言不能替代独立于配置正常运行的健壮代码。它们是互补的。

2.  即使在输入无效值或测试错误条件时，断言也不应该在单元测试运行期间被触发。代码应该在不发生断言的情况下处理这些条件。

3.  如果一个断言发生故障（在单元测试中或在测试期间），则该类被窃听。

对于所有其他错误——通常是环境（网络连接丢失）或误用（调用者传递了一个空值）——使用硬检查和异常会更好也更容易理解。如果发生异常，调用者知道这很可能是他们的错。如果发生断言，调用者就知道断言所在的代码中可能存在错误。

关于重复：我同意。我不明白为什么要使用 Debug.Assert 和异常检查来复制验证。它不仅给代码增加了一些噪音，混淆了谁有过错，而且它是一种重复的形式。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-14T09:55:08.080

我使用显式检查，在*公共*和*受保护*方法上抛出异常，在私有方法上使用断言。

通常，显式检查可以防止私有方法看到不正确的值。所以真的，断言正在检查一个应该不可能的条件。如果断言确实触发，它会告诉我该类的一个公共例程中包含的验证逻辑存在缺陷。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-14T21:59:11.350

可以捕获并吞下异常，使错误对测试不可见。Debug.Assert 不会发生这种情况。

没有人应该有一个捕获所有异常的 catch 处理程序，但人们无论如何都会这样做，有时这是不可避免的。如果您的代码是从 COM 调用的，则互操作层会捕获所有异常并将它们转换为 COM 错误代码，这意味着您不会看到未处理的异常。断言不会因此受到影响。

此外，当异常未处理时，更好的做法是进行小型转储。VB 比 C# 更强大的一个领域是，您可以使用异常过滤器在异常发生时捕捉小型转储，而保持其余异常处理不变。 [Gregg Miskelly 关于异常过滤器注入的博客文章](http://blogs.msdn.com/greggm/archive/2008/04/21/exception-filter-inject.aspx)提供了一种从 c# 执行此操作的有用方法。

关于资产的另一条注释......它们与单元测试代码中的错误条件的交互很差。有一个包装器来关闭单元测试的断言是值得的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-14T09:25:40.647

IMO 这只是开发时间的损失。正确实施的异常可以让您清楚地了解发生了什么。我看到*太多*应用程序显示模糊的“断言失败：i < 10”错误。我认为断言是一种临时解决方案。在我看来，任何断言都不应该出现在程序的最终版本中。在我的实践中，我使用断言进行快速和肮脏的检查。代码的最终版本应考虑到错误情况并做出相应的行为。如果发生不好的事情，你有两个选择：处理它或离开它。如果传入错误的参数，函数应该抛出一个具有有意义描述的异常。我认为验证逻辑的重复没有任何意义。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-05-11T12:31:25.817

良好使用 Assert 的示例：

```
Debug.Assert(flibbles.count() < 1000000, "too many flibbles"); // indicate something is awry
log.warning("flibble count reached " + flibbles.count()); // log in production as early warning 
```

我个人认为只有当你知道某些东西超出了*理想的限制***时才**应该使用 Assert ，但你可以确定继续使用它是相当安全的。在所有其他情况下（请随意指出我没有想到的情况）使用异常来快速失败。

 *对我来说，关键的权衡是您是否想要关闭带有异常的实时/生产系统以避免损坏并使故障排除更容易，或者您是否遇到了在测试/调试版本中不应该被允许继续被忽视但可以被允许继续生产（当然记录警告）。

参看。[http://c2.com/cgi/wiki?FailFast](http://c2.com/cgi/wiki?FailFast) 从 java 问题复制和修改：[Exception Vs Assertion](https://stackoverflow.com/questions/1276308/exception-vs-assertion/5963988#5963988)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-09T15:22:56.597

这是2美分。

我认为最好的方法是同时使用断言和异常。两种方法之间的主要区别，恕我直言，如果可以从应用程序文本中轻松删除 Assert 语句（定义，条件属性......），而抛出的异常（通常）依赖于更难删除的条件代码（带有预处理器条件的多段）。

应正确处理每个应用程序异常，而仅应在算法开发和测试期间满足断言。

如果将空对象引用作为例程参数传递，并且使用此值，则会得到空指针异常。确实：为什么要写断言？在这种情况下，这是浪费时间。但是类例程中使用的私有类成员呢？当这些值设置在某处时，如果设置了空值，最好用断言检查。那只是因为当您使用该成员时，您会得到一个空指针异常，但您不知道该值是如何设置的。这会导致在所有用于设置私有成员的入口点上中断程序的重新启动。

异常更有用，但它们可能（恕我直言）管理起来非常繁重，并且有可能使用太多异常。他们需要额外的检查，可能不希望优化代码。就我个人而言，我仅在代码需要深度捕获控制（捕获语句在调用堆栈中非常低）或函数参数未在代码中硬编码时才使用异常。

# c - C变量和常量值比较不匹配

> ID：61227
> 
> 赞同：8
> 
> 时间：2008-09-14T09:29:39.780
> 
> 标签：c

如果我有：

```
signed char * p; 
```

我做了一个比较：

```
if ( *p == 0xFF )
   break; 
```

它永远不会捕获 0XFF，但如果我用 -1 替换它，它将：

```
if ( *p == (signed char)0xFF )
   break; 
```

这怎么可能发生？是标志标志的东西吗？我虽然那样`0xFF == -1 == 255`。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-14T09:33:39.723

该值`0xFF`是带符号的 int 值。C 将在进行比较时将 提升`*p`为 an ，因此第一个 if 语句等效于：`int`

```
if( -1 == 255 ) break; 
```

这当然是错误的。通过使用`(signed char)0xFF`语句等价于：

```
if( -1 == -1 ) break; 
```

可以按您的预期工作。这里的关键点是比较是用`int`类型而不是`signed char`类型完成的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-14T09:38:51.877

整数文字具有带符号的 int 类型。由于 0xFF 是有符号整数，编译器将 *p 转换为有符号整数，然后进行比较。

当*p 为-1 时，然后从signed char 转换为signed int，它仍然是-1，表示为0xFFFFFFFF，不等于0xFF。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T09:34:08.490

由于 0xFF 仍被视为 int，因此第一次比较时它会转换为 int，这意味着您的 char 是 -128 到 127，但 0xFF 仍然是 255。

在第二种情况下，您告诉它 0xFF 实际上是一个有符号字符，而不是一个 int

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-14T09:42:02.167

0xff 将被视为一个整数常量，其值为 255。您应始终注意这些不同类型之间的比较。如果你想确保编译器会生成正确的代码，你应该使用 typecast：

```
if( *p == (signed char)0xFF ) 中断；

```

无论如何，**请注意**下一个语句**不会**以相同的方式工作：

```
if( (int)*p == 0xFF ) 中断；

```

此外，也许最好避免使用带符号的字符，或者，在这种情况下，您必须使用带符号的字符将它们与带符号的值（例如 -1）进行比较：

```
if( *p == -1 ) 中断；

```

0xff==-1 仅当这些值将分配给某些字符（或无符号字符）变量时：

```
字符 a=0xff;
字符 b=-1;
如果（a==b）中断；

```

# sql-server - 将 XML 数据分解为 SQL Server 数据库列的最佳方法

> ID：61233
> 
> 赞同：28
> 
> 时间：2008-09-14T09:39:29.613
> 
> 标签：sql-server, xml

将 XML 数据分解为各种数据库列的最佳方法是什么？到目前为止，我主要使用节点和值函数，如下所示：

```
INSERT INTO some_table (column1, column2, column3)
SELECT
Rows.n.value('(@column1)[1]', 'varchar(20)'),
Rows.n.value('(@column2)[1]', 'nvarchar(100)'),
Rows.n.value('(@column3)[1]', 'int'),
FROM @xml.nodes('//Rows') Rows(n) 
```

但是，我发现即使是中等大小的 xml 数据，这也会变得非常缓慢。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2011-01-12T16:21:04.707

在遇到非常相似的问题时偶然发现了这个问题，在最终放弃之前，我一直在运行一个处理 7.5MB XML 文件（约 10,000 个节点）的查询大约 3.5~4 小时。

但是，经过更多研究后，我发现使用模式键入 XML 并创建 XML 索引（我将批量插入到表中）相同的查询在大约 0.04 毫秒内完成。

这对性能改进有什么好处！

创建模式的代码：

```
IF EXISTS ( SELECT * FROM sys.xml_schema_collections where [name] = 'MyXmlSchema')
DROP XML SCHEMA COLLECTION [MyXmlSchema]
GO

DECLARE @MySchema XML
SET @MySchema = 
(
    SELECT * FROM OPENROWSET
    (
        BULK 'C:\Path\To\Schema\MySchema.xsd', SINGLE_CLOB 
    ) AS xmlData
)

CREATE XML SCHEMA COLLECTION [MyXmlSchema] AS @MySchema 
GO 
```

使用类型化 XML 列创建表的代码：

```
CREATE TABLE [dbo].[XmlFiles] (
    [Id] [uniqueidentifier] NOT NULL,

    -- Data from CV element 
    [Data] xml(CONTENT dbo.[MyXmlSchema]) NOT NULL,

CONSTRAINT [PK_XmlFiles] PRIMARY KEY NONCLUSTERED 
(
    [Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] 
```

创建索引的代码

```
CREATE PRIMARY XML INDEX PXML_Data
ON [dbo].[XmlFiles] (Data) 
```

不过，有几件事要记住。SQL Server 的 Schema 实现不支持 xsd:include。这意味着，如果您有一个引用其他架构的架构，您必须将所有这些复制到一个架构中并添加它。

我也会得到一个错误：

```
XQuery [dbo.XmlFiles.Data.value()]: Cannot implicitly atomize or apply 'fn:data()' to complex content elements, found type 'xs:anyType' within inferred type 'element({http://www.mynamespace.fake/schemas}:SequenceNumber,xs:anyType) ?'. 
```

如果我试图在我使用节点功能选择的节点上方导航。例如

```
SELECT
    ,C.value('CVElementId[1]', 'INT') AS [CVElementId]
    ,C.value('../SequenceNumber[1]', 'INT') AS [Level]
FROM 
    [dbo].[XmlFiles]
CROSS APPLY
    [Data].nodes('/CVSet/Level/CVElement') AS T(C) 
```

发现处理此问题的最佳方法是使用 OUTER APPLY 对 XML 执行“外部连接”。

```
SELECT
    ,C.value('CVElementId[1]', 'INT') AS [CVElementId]
    ,B.value('SequenceNumber[1]', 'INT') AS [Level]
FROM 
    [dbo].[XmlFiles]
CROSS APPLY
    [Data].nodes('/CVSet/Level') AS T(B)
OUTER APPLY
    B.nodes ('CVElement') AS S(C) 
```

希望这对某人有所帮助，因为那几乎是我的一天。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-08-16T01:04:46.017

就我而言，我正在运行 SQL 2005 SP2 (9.0)。

唯一有帮助的是添加 OPTION ( OPTIMIZE FOR ( @your_xml_var = NULL ) )。解释在下面的链接上。

例子：

```
INSERT INTO @tbl (Tbl_ID, Name, Value, ParamData)
SELECT     1,
    tbl.cols.value('name[1]', 'nvarchar(255)'),
    tbl.cols.value('value[1]', 'nvarchar(255)'),
    tbl.cols.query('./paramdata[1]')
FROM @xml.nodes('//root') as tbl(cols) OPTION ( OPTIMIZE FOR ( @xml = NULL ) ) 
```

[https://connect.microsoft.com/SQLServer/feedback/details/562092/an-insert-statement-using-xml-nodes-is-very-very-very-slow-in-sql2008-sp1](https://connect.microsoft.com/SQLServer/feedback/details/562092/an-insert-statement-using-xml-nodes-is-very-very-very-slow-in-sql2008-sp1)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-14T10:06:04.760

我不确定什么是最好的方法。我使用了 OPENXML 构造：

```
INSERT INTO Test
SELECT Id, Data 
FROM OPENXML (@XmlDocument, '/Root/blah',2)
WITH (Id   int         '@ID',
      Data varchar(10) '@DATA') 
```

为了加快速度，您可以创建 XML 索引。**您可以专门为价值**函数性能优化设置索引。您还可以使用性能更好的类型化 xml 列。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-03-20T20:44:49.877

我们在这里遇到了类似的问题。我们的 DBA（SP，你这个人）查看了我的代码，对语法进行了一些调整，我们得到了我们期待的速度。这很不寻常，因为我从 XML 中选择的速度非常快，但插入速度却很慢。所以试试这个语法：

```
INSERT INTO some_table (column1, column2, column3)
    SELECT 
        Rows.n.value(N'(@column1/text())[1]', 'varchar(20)'), 
        Rows.n.value(N'(@column2/text())[1]', 'nvarchar(100)'), 
        Rows.n.value(N'(@column3/text())[1]', 'int')
    FROM @xml.nodes('//Rows') Rows(n) 
```

因此，指定 text() 参数似乎确实会对性能产生影响。将我们插入的 2K 行从“我一定写错了 - 让我停下来”到大约 3 秒。这比我们通过连接运行的原始插入语句快 2 倍。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-19T21:55:31.343

我不会声称这是“最佳”解决方案，但我已经为此目的编写了一个通用 SQL CLR 过程——它采用“表格”Xml 结构（例如 FOR XML RAW 返回的结构）并输出结果集.

它不需要任何自定义/了解 Xml 中“表”的结构，并且结果非常快速/高效（尽管这不是设计目标）。我刚刚在 20 秒内粉碎了一个 25MB（无类型）的 xml 变量，返回了 25,000 行相当宽的表格。

希望这可以帮助某人： [http ://architectshack.com/ClrXmlShredder.ashx](http://architectshack.com/ClrXmlShredder.ashx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T18:03:19.193

这不是答案，而是对这个问题的补充——我刚刚遇到了同样的问题，我可以按照 edg 在评论中的要求给出数字。

我的测试有 xml 导致插入 244 条记录 - 所以 244 个节点。

我正在重写的代码平均需要 0.4 秒才能运行。（运行 10 次测试，从 0.56 秒到 0.344 秒） 性能不是代码被重写的主要原因，但新代码也需要执行或更好。这段旧代码循环了 xml 节点，每个循环调用一个 sp 插入一次

新代码几乎只是一个 sp；传入xml；切碎它。

使用新代码进行的测试显示新的 sp 平均需要 3.7 秒 - 几乎慢了 10 倍。

我的查询是在这个问题中发布的表格；

```
INSERT INTO some_table (column1, column2, column3)
SELECT
Rows.n.value('(@column1)[1]', 'varchar(20)'),
Rows.n.value('(@column2)[1]', 'nvarchar(100)'),
Rows.n.value('(@column3)[1]', 'int'),
FROM @xml.nodes('//Rows') Rows(n) 
```

执行计划似乎表明，对于每一列，sql server 正在执行一个单独的“表值函数 [XMLReader]”，返回所有 244 行，并使用嵌套循环（内连接）连接所有备份。因此，在我从大约 30 列中切碎/插入到大约 30 列的情况下，这似乎分别发生了 30 次。

我将不得不转储这段代码，我认为任何优化都不会克服这种固有的缓慢方法。我将尝试 sp_xml_preparedocument/OPENXML 方法，看看性能是否更好。如果有人从网络搜索中遇到这个问题（就像我一样），我强烈建议您在 SQL Server 中使用这种类型的粉碎之前进行一些性能测试

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T18:17:54.760

有一个[XML 批量加载](http://msdn.microsoft.com/en-us/library/ms171769.aspx)COM 对象（[.NET 示例](http://msdn.microsoft.com/en-us/library/ms171878.aspx)）

来自[MSDN](http://msdn.microsoft.com/en-us/library/ms171721.aspx)：

> 您可以使用 INSERT 语句和 OPENXML 函数将 XML 数据插入 SQL Server 数据库；但是，当您需要插入大量 XML 数据时，Bulk Load 实用程序可以提供更好的性能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-10T19:19:04.490

我目前针对大型 XML 集（> 500 个节点）的解决方案是使用 SQL Bulk Copy (System.Data.SqlClient.SqlBulkCopy)，方法是使用 DataSet 将 XML 加载到内存中，然后将表传递给 SqlBulkCopy（定义 XML 模式有助于）。

显然有一个陷阱，例如不必要地使用 DataSet 并首先将整个文档加载到内存中。我想在未来走得更远，实现我自己的 IDataReader 以绕过 DataSet 方法，但目前 DataSet 对于这项工作来说“足够好”。

基本上，我从来没有找到解决我最初关于那种 XML 粉碎性能缓慢的问题的解决方案。由于键入的 xml 查询本身很慢，或者与事务和 SQL Server 日志有关，它可能会很慢。我猜想输入的 xml 函数从来都不是为在非平凡节点大小上运行而设计的。

XML Bulk Load：我试过了，速度*很快*，但我无法让 COM dll 在 64 位环境下工作，我通常会尽量避免似乎不再支持的 COM dll。

sp_xml_preparedocument/OPENXML：我从来没有走这条路，所以有兴趣看看它的表现如何。

# html - 是否有一个好的、免费的所见即所得编辑器来使用 Django 模板创建 HTML？

> ID：61240
> 
> 赞同：8
> 
> 时间：2008-09-14T09:57:43.253
> 
> 标签：html, django

我有兴趣获得一个与 Django 模板兼容的免费的所见即所得 HTML 编辑器。有任何想法吗？

> 谢谢LainMH。
> 
> 但我担心 fckeditor 用于网络应用程序，用于编辑 HTML。我想要的是一个允许我编写与 Django 兼容的 HTML 的编辑器。
> 
> 希望这能澄清问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-14T10:12:19.130

[http://www.fckeditor.net/](http://www.fckeditor.net/)？

编辑：刚刚发现：http: [//blog.newt.cz/blog/integration-fckeditor-django/](http://blog.newt.cz/blog/integration-fckeditor-django/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-09T14:19:11.503

vim 有 Django 模板标签的语法高亮，对我有用 ^_^

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T14:54:31.160

我认为任何基于 HTML 的编辑器都不适用于 django 模板，而是模板中的可编辑内容区域。

创建/编辑 Django 模板的过程实际上是首先创建一个标准的 HTML 页面（使用 CSS 和图像等），然后将其制作为基本模板。然后您创建扩展基本模板的其他模板。

通常用于编辑模板的类型或程序是 IDE，尽管我更喜欢使用更轻量级的[Textmate 包](http://code.djangoproject.com/wiki/TextMate)来编辑模板（和 Django python 代码）。如果您有 IDE，只需在 google 上搜索 Django 的 Python 插件。

最有帮助的可能是打开[Django 模板页面](http://docs.djangoproject.com/en/dev/topics/templates/)，或者使用[Django 小抄](http://www.mercurytide.co.uk/whitepapers/django-cheat-sheet/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T12:47:19.763

根据简短的谷歌搜索（没有个人经验），Aptana 现在支持通过 Pydev 进行 Python 开发。Pydev 再次可以配置为与 Django 一起使用。

因此，我希望 Aptana 也可以与 Django 模板一起使用，尽管我没有完整的指南，但这些链接应该会有所帮助：

*   [http://www.aptana.com/python](http://www.aptana.com/python)
*   [http://pydev.blogspot.com/2006/09/configuring-pydev-to-work-with-django.html](http://pydev.blogspot.com/2006/09/configuring-pydev-to-work-with-django.html)

希望这可以帮助。

# css - DIV 与表格或 CSS 与愚蠢

> ID：61250
> 
> 赞同：54
> 
> 时间：2008-09-14T10:24:54.233
> 
> 标签：css, layout

我知道表格是用于表格数据的，但是将它们用于布局非常诱人。我可以处理 DIV 以获得三列布局，但是当你有 4 个嵌套的 DIV 时，它会变得很棘手。

是否有教程/参考可以说服我使用 DIV 进行布局？

我想使用 DIV，但我拒绝花一个小时将我的 DIV/SPAN 放置在我想要的位置。

@GaryF：[蓝图 CSS](http://www.blueprintcss.org/)必须是 CSS 最保守的秘密。

很棒的工具 -[蓝图网格 CSS 生成器](http://kematzy.com/blueprint-generator/)。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-14T11:00:30.747

有可以做各种事情的[Yahoo Grid CSS 。](http://developer.yahoo.com/yui/grids/)

但请记住：**CSS 不是一种宗教**。如果您通过使用表格而不是 css 来节省时间，请这样做。

我永远无法下定决心的极端案例之一是表格。我很想用 css 来做，但它比表格复杂得多。

您甚至可以争辩说表单是表格，因为它们具有标题（标签）和数据（输入字段）。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-14T13:08:22.467

在英国和美国，有一项法律要求支持 CSS 布局而不是表格。第 508 条（美国）和《残疾歧视法》（英国）都涵盖了针对视力有限的用户的无障碍标准。

在英国，立法范围扩大到实际上将商业生产一个妨碍部分视力用户能力的网站视为非法，就像现在拥有一个可以进入但无法进入的商店是非法的一样让轮椅使用者进入 - 诚然，目前还没有关于网站可访问性的起诉。但是我会一直使用 CSS，因为这意味着您的网站设计从长远来看更容易维护。

花时间学习 CSS（我使用过 W3C 学校和 .Net 杂志[http://www.netmag.co.uk](http://www.netmag.co.uk)）会有所回报。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-14T14:43:45.327

[为什么布局表是愚蠢的：定义的问题，提供的解决方案](http://www.hotdesign.com/seybold/)。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-14T12:45:37.280

在我看来，这种偏见应该有利于 CSS 而不是 IE6 - 即除非有非常好的理由（例如，您的网站只针对使用 IE6 的人，这会很*奇怪*），否则最好“疏远”使用 IE6 的人而不是比视力不佳和/或自动化用户代理的人。IE6 的使用正在减少；后一组的人数正在增加。即使您的网站在 IE6 中看起来并不完美，对于那些看不到它的用户来说，阅读它可能比基于表格的布局更容易。

这是一个非常笼统的问题，因此很难具体回答。这两本书是极好的资源：

*   [防弹网页设计](http://simplebits.com/publications/bulletproof/)，丹 Cederholm
*   [CSS 精通](http://www.cssmastery.com/)，安迪·巴德

如果你只需要花一个小时来设计你的整体网站布局，那还不错。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-14T15:28:46.217

CSS 可能不是一种宗教，但它是浏览器解释 HTML 以进行布局的方式。不管你喜不喜欢，所有现代浏览器都使用（某些版本的）W3C 盒子模型。继续依赖表格就是继续依赖一种在设计 Web 渲染技术的人眼中完全错误的方法。

我知道 CSS 有时看起来非常复杂，但我相信这是当今时代的必需品（相信我，你的客户会想要它）。

如果您不愿意花时间真正学习 CSS（因此定位元素需要几秒钟或几分钟......而不是一个小时），那么您需要将布局工作交给真正了解前端的人 -结尾。

是的，当前的 CSS 浏览器实现存在很多问题，但没有什么大到让您觉得需要返回基于表格的布局的问题。只需坐下来花时间学习它，就像学习任何其他语言或框架一样。

我发现的最好的在线参考资源是这个： [http ://reference.sitepoint.com/css](http://reference.sitepoint.com/css)

但是看看像[Designing With Web Standards](http://www.zeldman.com/dwws/)这样的书可能不会有什么坏处，它可以帮助你理解为什么这些东西很重要。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-15T06:05:35.453

在我看到[YAML](http://www.yaml.de/)（Yet Another Multicolumn Layout）之前，我也一直认为 Blueprint 很棒。有一个很棒的[在线构建器工具。](http://builder.yaml.de/)我可以在 5 分钟内得到一个看起来很酷的多列布局。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-12-21T16:40:15.937

过了一会儿，你甚至都不会去想它。使用带有 CSS 的 div 似乎是 imo 更简单的选择。此外，您在使用 jQuery 等框架时拥有更多自由。我无法想象在不使用 css 或 div 的情况下做一些很酷的 jQuery 东西。如果您使用表格进行样式和布局，我觉得您错过了许多新技术并停留在 90 年代。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-14T14:39:28.333

您也许可以在这里找到一些灵感：http: [//blog.html.it/layoutgala/](http://blog.html.it/layoutgala/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-15T14:20:59.087

[A List Apart](http://www.alistapart.com/)是使用语义 HTML 的一个很好的参考，[Holy Grail 文章](http://www.alistapart.com/articles/holygrail/)可能是最好的例子之一。此外，请查看[CSS Zen Garden](http://www.csszengarden.com/)以获取有关该主题的一些灵感，或阅读 Dave Shea 的优秀著作“The Zen of CSS Design”。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-23T01:54:59.193

您使用 CSS 进行布局不仅因为它在语义上正确，而且因为表格有多个缺点。

表格的可访问性很糟糕，因为它们破坏了几乎所有的屏幕阅读器，由于表格的阅读方式，这反过来又给视障人士提供了毫无价值的信息。

它们的渲染速度也比它们的 CSS 对应物慢得多。表格必须绘制两次，一次用于布局，另一次用于内容。这可能意味着，如果您在连接速度较慢的服务器上有一个或两个远程图像，您的整个布局将不会呈现。

当你有一个 hashmap 时，你会使用数组来存储字典吗？不，当有更好的东西时，你不应该使用桌子。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-14T10:30:22.940

这可能没有帮助，但我不明白所有这些与 CSS 相关的问题。如果报纸设计师试图在广告页面中嵌入一部电影，每个人都会同意他有点疯狂。但同样的人仍然在 HTML 中的三列布局之后松了一口气。HTML 目前还不能很好地处理这种布局。此外，多列布局通常不太适合在计算机显示器上阅读。没有足够的可行替代方案吗？

顺便说一句，即使是表格也没有提供实现流畅列布局的好方法，所以这根本没有理由诉诸这种黑客。假设是现代浏览器（即 > MSIE 6），与我所知道的干净的 HTML + CSS 相比，表格没有任何优势。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-14T11:51:39.547

我只会用桌子。

以我的经验，使用表格进行布局在所有浏览器中都可以正常工作，而 CSS 则不会（尤其是在您尝试支持 IE6 时）。如果使用表格可以在 10 分钟内完成，那么花费数小时和数小时的编码来使布局在 CSS 中工作是不值得的。

使用表格的另一个优点是您的布局可以很容易地根据内容动态调整自身大小。试图用 CSS 完成这件事是一场巨大的噩梦。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-14T12:11:04.680

我发现 CSS 有很多限制，这似乎暗示规范设计者不以制作网站为生。

如果您在 CSS 中无法轻松做到这一点，请使用 HTML 表格。

话虽如此，一些框架确实有帮助，如果你能管理它，用 CSS 做总是更好。

# c++ - 如何在 C/C++ 中收到文件/目录更改的通知，最好使用 POSIX

> ID：61253
> 
> 赞同：29
> 
> 时间：2008-09-14T10:37:55.683
> 
> 标签：c++, c, posix

主题说明了一切 - 通常简单且跨平台的方式是智能地进行投票。但是每个操作系统都有一些无需轮询的方式来通知。是否有可能以合理的跨平台方式进行？（我只关心 Windows 和 Linux，但我使用的是 mac，所以我认为 posix 可能会有所帮助？）

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-14T11:32:43.070

Linux 用户可以使用[inotify](http://en.wikipedia.org/wiki/Inotify)

> inotify 是一个提供文件系统事件通知的 Linux 内核子系统。

一些适用于 Windows 研究员的好东西：

*   MSDN 上的[文件更改通知](http://msdn.microsoft.com/en-us/library/bb158663.aspx)
*   “[当文件夹更改](http://www.relisoft.com/win32/watcher.html)”文章
*   [文件系统更改通知](http://techsupt.winbatch.com/TS/T000001048F39.html)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-14T12:27:12.457

Qt 库有一个[QFileSystemWatcher](http://doc.qt.io/qt-5/qfilesystemwatcher.html)类，它在文件更改时提供跨平台通知。即使您不使用 Qt，因为源代码可用，您也可以将其作为您自己实现的示例来查看。Qt 对 Windows、Linux 和 Mac 有单独的实现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T17:20:07.150

Leopard有[文件系统事件 API](https://developer.apple.com/library/archive/documentation/Darwin/Conceptual/FSEvents_ProgGuide/UsingtheFSEventsFramework/UsingtheFSEventsFramework.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-14T10:46:53.087

我不认为 POSIX 本身有这方面的设施。我见过的最接近跨平台的是[FAM](http://oss.sgi.com/projects/fam/)，它似乎适用于 Linux、BSD 和 Irix，但我并不认为将它移植到 Windows 和 MacOS 有多么容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-12-20T08:29:14.873

实际上，我之前已经构建了这个系统以用于商业 C++ 代码库——只要您不需要在阳光下所有奇怪的东西，Windows 和 POSIX 系统就有很多可以抽象的重叠。

POSIX：使用 inotify——它是为这项工作真正构建的整个系统
Windows：使用“更改事件”。您必须自己构建更多的粘合剂和报告（您需要的所有 API 都可用，只是没有一站式购物 inotify 为您提供）。

您可以在“通知线程”中检测到转发事件的常见事情是：
1）基本上任何侵入性操作 boost::filesystem 都支持，但（可能）修改权限除外。这是诸如移动、创建、删除、复制文件夹和文件之类的事情。
2）读取和写入文件（尤其是写入）。请注意，如果您使用异步 I/O，通知可能会乱序显示。
3）当一个新的卷进来时，比如有人连接了一个闪存驱动器。

inotify 尤其为您提供了疯狂的细粒度控制，Windows 则更少。使用 inotify，如果您真的想要，您可以几乎实时地监控文件系统正在执行的所有操作。我知道#3 在没有轮询的情况下都是可能的，但请注意，让它在任何一个系统上正常工作都非常棘手。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-14T11:25:16.070

我相信 OS X 现在有适当的钩子/回调，因为 Spotlight 索引需要它们。

在 linux 上，您会遇到额外的麻烦，即常用的文件系统有多种。如果您只需要有限数量的文件/目录的功能，我会尝试定期主动寻找修改。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-14T18:12:14.997

[libevent](http://monkey.org/~provos/libevent/)或[libev](http://freshmeat.net/projects/libev)似乎是您想要的，尽管我没有使用它们。

# asp.net - IIS 使用代理来处理 Web 服务请求。如何阻止这种情况？

> ID：61256
> 
> 赞同：4
> 
> 时间：2008-09-14T10:42:52.880
> 
> 标签：asp.net, web-services, iis, proxy

我对使用 Amazon Web 服务的一个小 .Net Web 应用程序有疑问。使用集成的 Visual Studio Web 服务器，一切正常。但是在将它部署到同一台计算机上的 IIS 后，我收到以下错误消息：

```
Ein Verbindungsversuch ist fehlgeschlagen, da die Gegenstelle nach
einer bestimmten Zeitspanne nicht ordnungsgemäß reagiert hat, oder
die hergestellte Verbindung war fehlerhaft, da der verbundene Host
nicht reagiert hat 192.168.123.254:8080 
```

大致翻译为“无法连接到 192.168.123.254:8080”

该计算机是 Active Directory 的一部分。AD-Server 安装在使用 192.168.123.254 作为代理的网络上。现在它无法访问，不应使用。

**如何防止 IIS 使用代理？**

我认为这与 Internet Explorer 的策略设置有关。“旧” AD 用户具有此设置，但新创建的用户没有。我检查了所有组策略设置，但没有定义代理。

Web 服务器在本地计算机上的匿名 Internet 用户帐户的上下文中运行。本地用户是否从 AD 获取设置？如果是这样，如果我无法以该用户身份登录，我该如何更改该设置？

我能做什么，我还能在哪里检查？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-14T13:20:22.500

可以在 web.config 中配置代理使用。system.net/defaultProxy 元素将让您指定是默认使用代理还是提供绕过列表。

有关更多信息，请参阅：[http://msdn.microsoft.com/en-us/library/kd3cf2ex.aspx](http://msdn.microsoft.com/en-us/library/kd3cf2ex.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-07T06:36:56.670

一些可能相关的组策略设置：

*根 \ 本地计算机策略 \ 计算机配置 \ 管理模板 \ Windows 组件 \ Internet Explorer \ 为每台计算机设置代理*- 默认情况下禁用，这意味着服务器上的各个用户具有自定义代理设置。

*根\本地计算机策略\用户配置\Windows 设置\Internet Explorer 维护\连接*。在“自动浏览器配置”中，值“自动检测配置设置”——您可以将其设置为关闭以防止进程尝试自动检测代理设置。

也就是说，使用 hwiechers 的答案中显示的 defaultProxy 设置似乎是一种更好的方法，不会影响机器上的其他进程或用户。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T12:12:30.340

IIS 是一个目的地。配置问题在于正在进行的调用（像客户端一样）。如果您使用的是内置的 .Net 通信方法，则需要在...内部进行调整...等等... Internet Explorer。

是的！那个小家伙咬我的次数比我想记得的还要多。当我在内部和外部服务器之间切换时，我曾经每天必须在 IE 中切换 5 或 6 次代理服务器设置。较新版本的 IE 具有更好的“不使用代理服务器”规则集。

-- 澄清 -- 由于 IIS 使用的用户 ID 似乎正在使用此设置，您可能需要在注册表中搜索每个用户 ID 和/或默认值的代理信息存储位置。

# .net - 您如何解决 .Net 命名空间与“使用”关键字的冲突？

> ID：61262
> 
> 赞同：21
> 
> 时间：2008-09-14T10:52:33.807
> 
> 标签：.net, namespaces, using

这是问题所在，您包含多个程序集并在代码文件的顶部添加“使用命名空间X”。
现在您想创建一个类或使用在多个命名空间中定义的符号，例如`System.Windows.Controls.Image`&`System.Drawing.Image`

现在，除非您使用完全限定名称，否则尽管顶部有正确的“使用”声明，但由于歧义，将会出现婴儿床/构建错误。这里的出路是什么？

*（另一个知识库帖子。。我搜索了大约 10 分钟后找到了答案，因为我不知道要搜索的正确关键字）*

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-14T10:55:05.313

使用别名

```
using System.Windows.Controls;
using Drawing = System.Drawing;

...

Image img = ... //System.Windows.Controls.Image
Drawing.Image img2 = ... //System.Drawing.Image 
```

[如何：使用命名空间别名限定符 (C#)](http://msdn.microsoft.com/en-us/library/c3ay4x3d%28VS.80%29.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-14T10:56:15.577

这个页面对命名空间和使用语句有很好的描述：

[http://www.blackwasp.co.uk/Namespaces.aspx](http://www.blackwasp.co.uk/Namespaces.aspx)

您想阅读有关“创建别名”的部分，该部分将允许您为一个或两个名称空间创建一个别名，并像这样引用它们：

```
using ControlImage = System.Windows.Controls.Image;
using System.Drawing.Image;

ControlImage.Image myImage = new ControlImage.Image();
myImage.Width = 200; 
```

# .net - 核心 .NET 运行时中的断点？

> ID：61272
> 
> 赞同：3
> 
> 时间：2008-09-14T11:08:16.780
> 
> 标签：.net, runtime, breakpoints, sqlconnection

我有一个内部构造和使用 SqlConnection 类的第三方库。我可以从这个类继承，但是它有很多重载，到目前为止我一直找不到合适的。我想要为正在使用的连接字符串添加一个参数。

有没有办法让我在 .NET 库核心本身中放置一个断点？特别是在 SqlConnection 类的构造函数中，以便我可以查看堆栈跟踪并查看它实际上是在哪里构造的？

除此之外，还有其他方法可以做到这一点吗？

具体来说，我想做的是添加*应用程序名称*参数，以便在查看连接时更容易在服务器上识别我们的应用程序。

* * *

**编辑**：好吧，看来我需要更多帮助。我想我已经启用了与符号服务器支持相关的所有内容，并且我注意到我配置的目录已经填满了包含 .pdb 文件的目录。尽管如此，我还是无法让 SqlConnection 类的实际源变得可用。

是否有一些明确的指导如何成功地做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-14T11:13:36.533

您可以[下载 .NET 源代码](http://www.wintellect.com/cs/blogs/jrobbins/archive/2008/01/17/additional-net-framework-source-code-debugging-tricks.aspx)并直接在 .NET FW 源代码中设置断点。

您可以使用[NetMassDownloader](http://www.codeplex.com/NetMassDownloader)快速获取 .NET 源。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-14T11:14:28.730

根据这篇文章，您可以下载 .NET 框架的源代码，然后使用 Visual Studio 对其进行调试：

[http://weblogs.asp.net/scottgu/archive/2007/10/03/releasing-the-source-code](http://weblogs.asp.net/scottgu/archive/2007/10/03/releasing-the-source-code-for-the-net-framework-libraries.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-14T11:37:43.713

我差点忘了提到[Deblector——](http://www.codeplex.com/deblector)它是一个 Reflector 插件，它允许你在没有源代码的情况下调试几乎任何 .net 应用程序 :)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-14T22:13:13.733

虽然源代码调试肯定更好，但您不需要 pdbs 或 VS 调试器的源代码来为您想要的函数设置 bp。

确保您转到工具/选项/调试器并关闭名为“仅我的代码”的选项。由于框架不是“你的代码”，调试器无助地阻止你在那里设置断点。

接下来，您需要方法的全名，因为它出现在元数据中。这包括它嵌套的任何命名空间。如果您需要查找名称，我建议您使用 ILDasm 或 Reflector。

在断点窗口的左上角是一个“new bp”菜单按钮。一种选择是在函数名称上设置一个 bp。当对话框出现时，取消选中智能感知检查名称，因为您没有项目。我希望这会有所帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-14T11:23:24.420

如果您无法使用 Microsoft 提供的 .Net 框架源代码进行源代码级调试，您可以尝试使用不同的调试器。像 mdbg 甚至是 windbg。

**编辑**

[这](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)解释了获取 .Net 框架的已发布部分以及如何设置断点的详细信息。NetMassDownloader 将在一次下载中为您提供所有内容（pdb 和源代码）。但并非 .Net 框架的所有源代码都可用。如果您的 SqlConnection 不是，您始终可以使用我提到的 IL 调试器。无论如何不要忘记 Lutz 的 Reflector 给你看一下源代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-14T22:39:51.487

好的，如果你想要权威指南，这里是：

[配置 Visual Studio 以调试 .NET Framework 源代码](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)

如果您需要帮助，请继续告诉使用您执行了哪些步骤？

# c++ - 快速而肮脏的方式来分析你的代码

> ID：61278
> 
> 赞同：14
> 
> 时间：2008-09-14T11:24:31.313
> 
> 标签：c++, performance, profiling, code-snippets

当您想获取有关特定代码路径的性能数据时，您使用什么方法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-14T11:24:57.160

这种方法有几个局限性，但我仍然觉得它非常有用。我会预先列出限制（我知道），让任何想要使用它的人自行承担风险。

1.  我发布的原始版本过度报告了递归调用所花费的时间（如答案的评论中所指出的那样）。
2.  它不是线程安全的，在我添加代码以忽略递归之前它不是线程安全的，现在它的线程安全性更低。
3.  尽管如果多次调用（数百万次）它非常有效，但它会对结果产生可衡量的影响，因此您测量的范围将比您不测量的范围花费更长的时间。

* * *

当手头的问题不能证明分析我的所有代码是合理的，或者我从分析器获取一些我想要验证的数据时，我会使用这个类。基本上，它总结了您在特定块中花费的时间，并在程序结束时将其输出到调试流（可使用[DbgView](http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx)查看），包括执行代码的次数（当然还有平均花费的时间））。

```
#pragma once
#include <tchar.h>
#include <windows.h>
#include <sstream>
#include <boost/noncopyable.hpp>

namespace scope_timer {
    class time_collector : boost::noncopyable {
        __int64 total;
        LARGE_INTEGER start;
        size_t times;
        const TCHAR* name;

        double cpu_frequency()
        { // cache the CPU frequency, which doesn't change.
            static double ret = 0; // store as double so devision later on is floating point and not truncating
            if (ret == 0) {
                LARGE_INTEGER freq;
                QueryPerformanceFrequency(&freq);
                ret = static_cast<double>(freq.QuadPart);
            }
            return ret;
        }
        bool in_use;

    public:
        time_collector(const TCHAR* n)
            : times(0)
            , name(n)
            , total(0)
            , start(LARGE_INTEGER())
            , in_use(false)
        {
        }

        ~time_collector()
        {
            std::basic_ostringstream<TCHAR> msg;
            msg << _T("scope_timer> ") <<  name << _T(" called: ");

            double seconds = total / cpu_frequency();
            double average = seconds / times;

            msg << times << _T(" times total time: ") << seconds << _T(" seconds  ")
                << _T(" (avg ") << average <<_T(")\n");
            OutputDebugString(msg.str().c_str());
        }

        void add_time(__int64 ticks)
        {
            total += ticks;
            ++times;
            in_use = false;
        }

        bool aquire()
        {
            if (in_use)
                return false;
            in_use = true;
            return true;
        }
    };

    class one_time : boost::noncopyable {
        LARGE_INTEGER start;
        time_collector* collector;
    public:
        one_time(time_collector& tc)
        {
            if (tc.aquire()) {
                collector = &tc;
                QueryPerformanceCounter(&start);
            }
            else
                collector = 0;
        }

        ~one_time()
        {
            if (collector) {
                LARGE_INTEGER end;
                QueryPerformanceCounter(&end);
                collector->add_time(end.QuadPart - start.QuadPart);
            }
        }
    };
}

// Usage TIME_THIS_SCOPE(XX); where XX is a C variable name (can begin with a number)
#define TIME_THIS_SCOPE(name) \
    static scope_timer::time_collector st_time_collector_##name(_T(#name)); \
    scope_timer::one_time st_one_time_##name(st_time_collector_##name) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-14T11:26:49.123

好吧，我有两个代码片段。在[伪代码](http://en.wikipedia.org/wiki/Pseudocode)中，它们看起来像（这是一个简化版本，我实际上使用的是[QueryPerformanceFrequency](http://msdn.microsoft.com/en-us/library/windows/desktop/ms644905%28v=vs.85%29.aspx)）：

### 第一个片段：

```
Timer timer = new Timer
timer.Start 
```

### 第二个片段：

```
timer.Stop
show elapsed time 
```

有点热键功夫，我可以说这段代码从我的 CPU 中偷走了多少时间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T12:37:01.450

我通过创建两个类来完成我的个人资料：`cProfile`和`cProfileManager`.

`cProfileManager`将保存由`cProfile`.

`cProfile`具有以下要求：

*   `cProfile`有一个初始化当前时间的构造函数。
*   `cProfile`有一个解构函数，它发送类存活的总时间到`cProfileManager`

要使用这些配置文件类，我首先创建一个`cProfileManager`. 然后，我将要分析的代码块放在花括号内。在花括号内，我创建了一个`cProfile`实例。当代码块结束时，`cProfile`会将代码块完成所用的时间发送到`cProfileManager`.

**示例代码** 这是代码示例（简化）：

```
class cProfile
{
    cProfile()
    {
        TimeStart = GetTime();
    };

    ~cProfile()
    {
        ProfileManager->AddProfile (GetTime() - TimeStart);
    }

    float TimeStart;
} 
```

要使用`cProfile`，我会做这样的事情：

```
int main()
{
    printf("Start test");
    {
        cProfile Profile;
        Calculate();
    }
    ProfileManager->OutputData();
} 
```

或这个：

```
void foobar()
{
    cProfile ProfileFoobar;

    foo();
    {
        cProfile ProfileBarCheck;
        while (bar())
        {
            cProfile ProfileSpam;
            spam();
        }
    }
} 
```

**技术说明**

这段代码实际上滥用了[C++](http://en.wikipedia.org/wiki/C_%28programming_language%29)中作用域、构造函数和解构函数的工作方式。`cProfile`仅存在于块范围内（我们要测试的代码块）。一旦程序离开块范围，`cProfile`记录结果。

**其他增强功能**

*   您可以在构造函数中添加一个字符串参数，这样您就可以执行以下操作： cProfile Profile("Profile for complex calculation");

*   您可以使用宏使代码看起来更干净（注意不要滥用它。与我们对语言的其他滥用不同，宏在使用时可能很危险）。

    例子：

    #define START_PROFILE cProfile Profile(); { #define END_PROFILE }

*   `cProfileManager`可以检查一个代码块被调用了多少次。但是您需要代码块的标识符。第一个增强可以帮助识别块。这在您要分析的代码位于循环内的情况下（如第二个示例 aboe）很有用。您还可以添加代码块所用的平均、最快和最长执行时间。

*   如果您处于调试模式，请不要忘记添加检查以跳过分析。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-23T21:34:24.543

注意，以下都是专门为 Windows 编写的。

我还编写了一个计时器类，用于进行快速而肮脏的分析，它使用 QueryPerformanceCounter() 来获得高精度计时，但略有不同。当 Timer 对象超出范围时，我的计时器类不会转储经过的时间。相反，它将经过的时间累积到一个集合中。我添加了一个静态成员函数 Dump()，它创建了一个经过时间的表，按时间类别排序（在 Timer 的构造函数中指定为字符串）以及一些统计分析，例如平均经过时间、标准偏差、最大值和最小值。我还添加了一个 Clear() 静态成员函数，它可以清除集合并让您重新开始。

**如何使用 Timer 类（伪代码）：**

```
int CInsertBuffer::Read(char* pBuf)
{
       // TIMER NOTES: Avg Execution Time = ~1 ms
       Timer timer("BufferRead");
       :      :
       return -1;
} 
```

**样本输出：**

```
Timer Precision = 418.0095 ps

=== Item               Trials    Ttl Time  Avg Time  Mean Time StdDev    ===
    AddTrade           500       7 ms      14 us     12 us     24 us
    BufferRead         511       1:19.25   0.16 s    621 ns    2.48 s
    BufferWrite        516       511 us    991 ns    482 ns    11 us
    ImportPos Loop     1002      18.62 s   19 ms     77 us     0.51 s
    ImportPosition     2         18.75 s   9.38 s    16.17 s   13.59 s
    Insert             515       4.26 s    8 ms      5 ms      27 ms
    recv               101       18.54 s   0.18 s    2603 ns   1.63 s 
```

**文件 Timer.inl ：**

```
#include <map>
#include "x:\utils\stlext\stringext.h"
#include <iterator>
#include <set>
#include <vector>
#include <numeric>
#include "x:\utils\stlext\algorithmext.h"
#include <math.h>

    class Timer
    {
    public:
        Timer(const char* name)
        {
            label = std::safe_string(name);
            QueryPerformanceCounter(&startTime);
        }

        virtual ~Timer()
        {
            QueryPerformanceCounter(&stopTime);
            __int64 clocks = stopTime.QuadPart-startTime.QuadPart;
            double elapsed = (double)clocks/(double)TimerFreq();
            TimeMap().insert(std::make_pair(label,elapsed));
        };

        static std::string Dump(bool ClipboardAlso=true)
        {
            static const std::string loc = "Timer::Dump";

            if( TimeMap().empty() )
            {
                return "No trials\r\n";
            }

            std::string ret = std::formatstr("\r\n\r\nTimer Precision = %s\r\n\r\n", format_elapsed(1.0/(double)TimerFreq()).c_str());

            // get a list of keys
            typedef std::set<std::string> keyset;
            keyset keys;
            std::transform(TimeMap().begin(), TimeMap().end(), std::inserter(keys, keys.begin()), extract_key());

            size_t maxrows = 0;

            typedef std::vector<std::string> strings;
            strings lines;

            static const size_t tabWidth = 9;

            std::string head = std::formatstr("=== %-*.*s %-*.*s %-*.*s %-*.*s %-*.*s %-*.*s ===", tabWidth*2, tabWidth*2, "Item", tabWidth, tabWidth, "Trials", tabWidth, tabWidth, "Ttl Time", tabWidth, tabWidth, "Avg Time", tabWidth, tabWidth, "Mean Time", tabWidth, tabWidth, "StdDev");
            ret += std::formatstr("\r\n%s\r\n", head.c_str());
            if( ClipboardAlso ) 
                lines.push_back("Item\tTrials\tTtl Time\tAvg Time\tMean Time\tStdDev\r\n");
            // dump the values for each key
            {for( keyset::iterator key = keys.begin(); keys.end() != key; ++key )
            {
                time_type ttl = 0;
                ttl = std::accumulate(TimeMap().begin(), TimeMap().end(), ttl, accum_key(*key));
                size_t num = std::count_if( TimeMap().begin(), TimeMap().end(), match_key(*key));
                if( num > maxrows ) 
                    maxrows = num;
                time_type avg = ttl / num;

                // compute mean
                std::vector<time_type> sortedTimes;
                std::transform_if(TimeMap().begin(), TimeMap().end(), std::inserter(sortedTimes, sortedTimes.begin()), extract_val(), match_key(*key));
                std::sort(sortedTimes.begin(), sortedTimes.end());
                size_t mid = (size_t)floor((double)num/2.0);
                double mean = ( num > 1 && (num % 2) != 0 ) ? (sortedTimes[mid]+sortedTimes[mid+1])/2.0 : sortedTimes[mid];
                // compute variance
                double sum = 0.0;
                if( num > 1 )
                {
                    for( std::vector<time_type>::iterator timeIt = sortedTimes.begin(); sortedTimes.end() != timeIt; ++timeIt )
                        sum += pow(*timeIt-mean,2.0);
                }
                // compute std dev
                double stddev = num > 1 ? sqrt(sum/((double)num-1.0)) : 0.0;

                ret += std::formatstr("    %-*.*s %-*.*s %-*.*s %-*.*s %-*.*s %-*.*s\r\n", tabWidth*2, tabWidth*2, key->c_str(), tabWidth, tabWidth, std::formatstr("%d",num).c_str(), tabWidth, tabWidth, format_elapsed(ttl).c_str(), tabWidth, tabWidth, format_elapsed(avg).c_str(), tabWidth, tabWidth, format_elapsed(mean).c_str(), tabWidth, tabWidth, format_elapsed(stddev).c_str()); 
                if( ClipboardAlso )
                    lines.push_back(std::formatstr("%s\t%s\t%s\t%s\t%s\t%s\r\n", key->c_str(), std::formatstr("%d",num).c_str(), format_elapsed(ttl).c_str(), format_elapsed(avg).c_str(), format_elapsed(mean).c_str(), format_elapsed(stddev).c_str())); 

            }
            }
            ret += std::formatstr("%s\r\n", std::string(head.length(),'=').c_str());

            if( ClipboardAlso )
            {
                // dump header row of data block
                lines.push_back("");
                {
                    std::string s;
                    for( keyset::iterator key = keys.begin(); key != keys.end(); ++key )
                    {
                        if( key != keys.begin() )
                            s.append("\t");
                        s.append(*key);
                    }
                    s.append("\r\n");
                    lines.push_back(s);
                }

                // blow out the flat map of time values to a seperate vector of times for each key
                typedef std::map<std::string, std::vector<time_type> > nodematrix;
                nodematrix nodes;
                for( Times::iterator time = TimeMap().begin(); time != TimeMap().end(); ++time )
                    nodes[time->first].push_back(time->second);

                // dump each data point
                for( size_t row = 0; row < maxrows; ++row )
                {
                    std::string rowDump;
                    for( keyset::iterator key = keys.begin(); key != keys.end(); ++key )
                    {
                        if( key != keys.begin() )
                            rowDump.append("\t");
                        if( nodes[*key].size() > row )
                            rowDump.append(std::formatstr("%f", nodes[*key][row]));
                    }
                    rowDump.append("\r\n");
                    lines.push_back(rowDump);
                }

                // dump to the clipboard
                std::string dump;
                for( strings::iterator s = lines.begin(); s != lines.end(); ++s )
                {
                    dump.append(*s);
                }

                OpenClipboard(0);
                EmptyClipboard();
                HGLOBAL hg = GlobalAlloc(GMEM_MOVEABLE, dump.length()+1);
                if( hg != 0 )
                {
                    char* buf = (char*)GlobalLock(hg);
                    if( buf != 0 )
                    {
                        std::copy(dump.begin(), dump.end(), buf);
                        buf[dump.length()] = 0;
                        GlobalUnlock(hg);
                        SetClipboardData(CF_TEXT, hg);
                    }
                }
                CloseClipboard();
            }

            return ret;
        }

        static void Reset()
        {
            TimeMap().clear();
        }

        static std::string format_elapsed(double d) 
        {
            if( d < 0.00000001 )
            {
                // show in ps with 4 digits
                return std::formatstr("%0.4f ps", d * 1000000000000.0);
            }
            if( d < 0.00001 )
            {
                // show in ns
                return std::formatstr("%0.0f ns", d * 1000000000.0);
            }
            if( d < 0.001 )
            {
                // show in us
                return std::formatstr("%0.0f us", d * 1000000.0);
            }
            if( d < 0.1 )
            {
                // show in ms
                return std::formatstr("%0.0f ms", d * 1000.0);
            }
            if( d <= 60.0 )
            {
                // show in seconds
                return std::formatstr("%0.2f s", d);
            }
            if( d < 3600.0 )
            {
                // show in min:sec
                return std::formatstr("%01.0f:%02.2f", floor(d/60.0), fmod(d,60.0));
            }
            // show in h:min:sec
            return std::formatstr("%01.0f:%02.0f:%02.2f", floor(d/3600.0), floor(fmod(d,3600.0)/60.0), fmod(d,60.0));
        }

    private:
        static __int64 TimerFreq()
        {
            static __int64 freq = 0;
            static bool init = false;
            if( !init )
            {
                LARGE_INTEGER li;
                QueryPerformanceFrequency(&li);
                freq = li.QuadPart;
                init = true;
            }
            return freq;
        }
        LARGE_INTEGER startTime, stopTime;
        std::string label;

        typedef std::string key_type;
        typedef double time_type;
        typedef std::multimap<key_type, time_type> Times;
//      static Times times;
        static Times& TimeMap()
        {
            static Times times_;
            return times_;
        }

        struct extract_key : public std::unary_function<Times::value_type, key_type>
        {
            std::string operator()(Times::value_type const & r) const
            {
                return r.first;
            }
        };

        struct extract_val : public std::unary_function<Times::value_type, time_type>
        {
            time_type operator()(Times::value_type const & r) const
            {
                return r.second;
            }
        };
        struct match_key : public std::unary_function<Times::value_type, bool>
        {
            match_key(key_type const & key_) : key(key_) {};
            bool operator()(Times::value_type const & rhs) const
            {
                return key == rhs.first;
            }
        private:
            match_key& operator=(match_key&) { return * this; }
            const key_type key;
        };

        struct accum_key : public std::binary_function<time_type, Times::value_type, time_type>
        {
            accum_key(key_type const & key_) : key(key_), n(0) {};
            time_type operator()(time_type const & v, Times::value_type const & rhs) const
            {
                if( key == rhs.first )
                {
                    ++n;
                    return rhs.second + v;
                }
                return v;
            }
        private:
            accum_key& operator=(accum_key&) { return * this; }
            const Times::key_type key;
            mutable size_t n;
        };
    }; 
```

**文件 stringext.h（提供 formatstr() 函数）：**

```
namespace std
{
    /*  ---

    Formatted Print

        template<class C>
        int strprintf(basic_string<C>* pString, const C* pFmt, ...);

        template<class C>
        int vstrprintf(basic_string<C>* pString, const C* pFmt, va_list args);

    Returns :

        # characters printed to output

    Effects :

        Writes formatted data to a string.  strprintf() works exactly the same as sprintf(); see your
        documentation for sprintf() for details of peration.  vstrprintf() also works the same as sprintf(), 
        but instead of accepting a variable paramater list it accepts a va_list argument.

    Requires :

        pString is a pointer to a basic_string<>

    --- */

    template<class char_type> int vprintf_generic(char_type* buffer, size_t bufferSize, const char_type* format, va_list argptr);

    template<> inline int vprintf_generic<char>(char* buffer, size_t bufferSize, const char* format, va_list argptr)
    {
#       ifdef SECURE_VSPRINTF
        return _vsnprintf_s(buffer, bufferSize-1, _TRUNCATE, format, argptr);
#       else
        return _vsnprintf(buffer, bufferSize-1, format, argptr);
#       endif
    }

    template<> inline int vprintf_generic<wchar_t>(wchar_t* buffer, size_t bufferSize, const wchar_t* format, va_list argptr)
    {
#       ifdef SECURE_VSPRINTF
        return _vsnwprintf_s(buffer, bufferSize-1, _TRUNCATE, format, argptr);
#       else
        return _vsnwprintf(buffer, bufferSize-1, format, argptr);
#       endif
    }

    template<class Type, class Traits>
    inline int vstringprintf(basic_string<Type,Traits> & outStr, const Type* format, va_list args)
    {
        // prologue
        static const size_t ChunkSize = 1024;
        size_t curBufSize = 0;
        outStr.erase(); 

        if( !format )
        {
            return 0;
        }

        // keep trying to write the string to an ever-increasing buffer until
        // either we get the string written or we run out of memory
        while( bool cont = true )
        {
            // allocate a local buffer
            curBufSize += ChunkSize;
            std::ref_ptr<Type> localBuffer = new Type[curBufSize];
            if( localBuffer.get() == 0 )
            {
                // we ran out of memory -- nice goin'!
                return -1;
            }
            // format output to local buffer
            int i = vprintf_generic(localBuffer.get(), curBufSize * sizeof(Type), format, args);
            if( -1 == i )
            {
                // the buffer wasn't big enough -- try again
                continue;
            }
            else if( i < 0 )
            {
                // something wierd happened -- bail
                return i;
            }
            // if we get to this point the string was written completely -- stop looping
            outStr.assign(localBuffer.get(),i);
            return i;
        }
        // unreachable code
        return -1;
    };

    // provided for backward-compatibility
    template<class Type, class Traits>
    inline int vstrprintf(basic_string<Type,Traits> * outStr, const Type* format, va_list args)
    {
        return vstringprintf(*outStr, format, args);
    }

    template<class Char, class Traits>
    inline int stringprintf(std::basic_string<Char, Traits> & outString, const Char* format, ...)
    {
        va_list args;
        va_start(args, format);
        int retval = vstringprintf(outString, format, args);
        va_end(args);
        return retval;
    }

    // old function provided for backward-compatibility
    template<class Char, class Traits>
    inline int strprintf(std::basic_string<Char, Traits> * outString, const Char* format, ...)
    {
        va_list args;
        va_start(args, format);
        int retval = vstringprintf(*outString, format, args);
        va_end(args);
        return retval;
    }

    /*  ---

    Inline Formatted Print

        string strprintf(const char* Format, ...);

    Returns :

        Formatted string

    Effects :

        Writes formatted data to a string.  formatstr() works the same as sprintf(); see your
        documentation for sprintf() for details of operation.  

    --- */

    template<class Char>
    inline std::basic_string<Char> formatstr(const Char * format, ...)
    {
        std::string outString;

        va_list args;
        va_start(args, format);
        vstringprintf(outString, format, args);
        va_end(args);
        return outString;
    }
}; 
```

**文件 algorithmext.h（提供 transform_if() 函数）：**

```
/*  ---

Transform
25.2.3

    template<class InputIterator, class OutputIterator, class UnaryOperation, class Predicate>
        OutputIterator transform_if(InputIterator first, InputIterator last, OutputIterator result, UnaryOperation op, Predicate pred)

    template<class InputIterator1, class InputIterator2, class OutputIterator, class BinaryOperation, class Predicate>
        OutputIterator transform_if(InputIterator first, InputIterator last, OutputIterator result, BinaryOperation binary_op, Predicate pred)

Requires:   

    T is of type EqualityComparable (20.1.1) 
    op and binary_op have no side effects

Effects :

    Assigns through every iterator i in the range [result, result + (last1-first1)) a new corresponding value equal to one of:
        1:  op( *(first1 + (i - result)) 
        2:  binary_op( *(first1 + (i - result), *(first2 + (i - result))

Returns :

    result + (last1 - first1)

Complexity :

    At most last1 - first1 applications of op or binary_op

--- */

template<class InputIterator, class OutputIterator, class UnaryFunction, class Predicate>
OutputIterator transform_if(InputIterator first, 
                            InputIterator last, 
                            OutputIterator result, 
                            UnaryFunction f, 
                            Predicate pred)
{
    for (; first != last; ++first)
    {
        if( pred(*first) )
            *result++ = f(*first);
    }
    return result; 
}

template<class InputIterator1, class InputIterator2, class OutputIterator, class BinaryOperation, class Predicate>
OutputIterator transform_if(InputIterator1 first1, 
                            InputIterator1 last1, 
                            InputIterator2 first2, 
                            OutputIterator result, 
                            BinaryOperation binary_op, 
                            Predicate pred)
{
    for (; first1 != last1 ; ++first1, ++first2)
    {
        if( pred(*first1) )
            *result++ = binary_op(*first1,*first2);
    }
    return result;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-14T11:27:00.043

*代码分析器和优化*一文包含大量有关 C++ 代码分析的信息，并且还有一个程序/类的免费下载链接，该链接将向您展示不同代码路径/方法的图形演示。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T21:27:21.093

我有一个快速而简单的分析类，即使是最紧凑的内部循环也可以用于分析。重点是极轻的重量和简单的代码。该类分配一个固定大小的二维数组。然后我在各处添加“检查点”调用。在检查点 M 之后立即到达检查点 N 时，我将经过的时间（以微秒为单位）添加到数组项 [M,N]。由于这旨在分析紧密循环，因此我还有“迭代开始”调用来重置“最后一个检查点”变量。在测试结束时，`dumpResults()`调用会生成所有相互跟随的检查点对的列表，以及已计入和未计入的总时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-06-12T00:29:19.120

[为此，我编写了一个名为nanotimer](http://www.plflib.org/nanotimer.htm)的简单跨平台类。目标是尽可能轻量级，以免通过添加太多指令而影响实际代码性能，从而影响指令缓存。它能够在 windows、mac 和 linux（可能还有一些 unix 变体）上获得微秒级的精度。

基本用法：

```
plf::timer t;
timer.start();

// stuff

double elapsed = t.get_elapsed_ns(); // Get nanoseconds 
```

start() 还会在必要时重新启动计时器。“暂停”计时器可以通过存储经过时间来实现，然后在“取消暂停”时重新启动计时器，并在下次检查经过时间时添加到存储的结果中。

# windows - 如何找到 Word 应用程序窗口？

> ID：61307
> 
> 赞同：2
> 
> 时间：2008-09-14T12:48:45.900
> 
> 标签：windows, vb.net, interop, ms-word, ms-office

我有一个 VB.net 测试应用程序，它单击打开 Microsoft Word 应用程序窗口并显示文档的链接。如何找到 Word 应用程序窗口以便从中获取一些文本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-14T12:58:29.153

我在我的博客上发布了一个 SourceSafe 对话框，我做了类似的事情。基本上，我使用 Spy++ 或 Winspector 来找出窗口类名，然后调用 Win32 来处理窗口。我已将来源放在我的博客上：http: [//harriyott.com/2006/07/sourcesafe-cant-leave-well-alone.aspx](http://harriyott.com/2006/07/sourcesafe-cant-leave-well-alone.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-14T12:59:02.317

您是否正在尝试[激活](http://msdn.microsoft.com/en-us/library/dyz95fhy(VS.80).aspx)word 应用程序？如果您想要完全控制，您需要从您的 vb.net 应用程序中自动执行单词。在此处查看一些[示例](http://support.microsoft.com/?kbid=302816)：[1、2](http://support.microsoft.com/?kbid=303294)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-14T16:36:29.520

您可以使用 Word COM 对象打开工作文档，然后对其进行操作。确保首先为 Microsoft Word 添加参考。

```
Imports System.Runtime.InteropServices
Imports Microsoft.Office.Interop.Word

Public Class Form1

Inherits System.Windows.Forms.Form

Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click

Dim strFileName As String
Dim wordapp As New Microsoft.Office.Interop.Word.Application
Dim doc As Microsoft.Office.Interop.Word.Document

Try
    doc = wordapp.Documents.Open("c:\testdoc.doc")
    doc.Activate()

Catch ex As COMException

    MessageBox.Show("Error accessing Word document.")

End Try

End Sub

End Class 
```

doc 对象是您创建的 Word 实例的句柄，您可以使用所有常规选项（保存、打印等）。你可以用 wordapp 做同样的事情。一个技巧是使用 Word 中的宏编辑器来记录您想要执行的操作。然后您可以在宏编辑器中查看它。这为您的 VB 代码提供了一个很好的起点。

此外，请务必在最后处理 Word COM 对象。

# wpf - 先学 Silverlight 还是 WPF？

> ID：61317
> 
> 赞同：23
> 
> 时间：2008-09-14T13:09:44.273
> 
> 标签：wpf, silverlight

Silverlight/WPF 似乎是使用 .NET 进行用户界面开发的长期未来。这很棒，因为我可以看到在客户端和 Web 开发方面重用 XAML 技能的优势。但是看看 WPF/XAML/Silverlight，它们似乎是非常庞大的技术，那么从哪里开始最好呢？

我想听听任何对两者都有很好的了解并可以推荐哪个是更好的起点以及原因的人的意见。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-16T04:47:48.253

您应该先学习 ASP.NET 还是 Winforms？ASP 还是 MFC？HTML 还是 VB？C# 还是 VB？

抛开已经成为高度复杂的相互交织的技术集的逻辑进展的想法，退后一步，问自己一系列问题：

*   你的目标是什么; 你想如何平衡利润和享受
*   你是短期导向的还是长期的
*   你是那种喜欢在某事上做得很好并且经常做的人，还是一旦你完全理解它就会感到无聊？

下一步也是最困难的一步是接受给你的任何建议都是错误的。时间范围越长，错误的可能性就越大。如果建议的时间超过 6 到 12 个月，则建议完全不正确的概率接近 1。

我只能快点告诉你我的故事。2000 年，作为一名顾问，我很高兴在 Windows 应用程序上使用 C++ 工作，并撰写有关 ASP.NET 和 WinForms 的文章。然后我看到了 C#，世界颠倒了。我再也没有回去过。

两年前，我得到了同样的启示，只是更大、更强并且对 Silverlight 更有信心。是的，WPF 非常棒，可能我对此很感兴趣，但我相信 Silverlight 会改变一切。当时毫无疑问，今天毫无疑问，Silverlight 是自 .NET（当然）以及可能自切换到 C++ 以来微软最重要的开发平台。

简而言之，这就是原因。我不明白它的局限性在哪里。对于我做的大多数平台：你可以这样做，但你不能那样做。WPF 就是一个很好的例子，就像 ASP.Net 和 WinForms 一样，以及直到现在的一切。
使用 Silverlight，我还没有看到界限。Silverlight 已经从桌面跳到手机上，我认为没有任何理由让它停在那里。是的，这是真的，它受浏览器的约束，但我认为这与其说是监狱牢房，不如说是作为坦克，Silverlight 将在其中穿越许多地形（一定很晚了，我应该去睡觉了）。

无论如何，就目前而言，学习 Silverlight 很费劲，[Silverlight.net 网站](http://www.silverlight.net/)上有很多资料，而学习 Silverlight 最好的一点是，如果你没有看到你需要的东西，你可以大喊大叫在我这里，我会确保你很快得到它。

享受吧，祝你好运，一个肮脏的小秘密是，无论你选择哪一个，你都会没事的。这一切都只是软件。

-杰西

* * *

杰西·利伯蒂 [《银光极客》](http://jesseliberty.com/)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-14T14:31:56.340

**我会说先使用 Silverlight！**

我以前用 WPF 和 Silverlight 编程过。

但是，由于 Silverlight 是 WPF 的一个*子集*，如果您深入研究并尝试切换到编写 Silverlight 应用程序，那么您将在寻找您在 WPF 中学会喜欢但在 Silverlight 中不可用的“标签”时摸不着头脑。

当您首先掌握 Silverlight 中的基本内容时，WPF 中的额外机制/触发器/任何功能将简单地*添加*到您已经知道的大部分内容中。

WPF 中的 Silverlight 在*功能*级别上有所不同，而不仅仅是缺少一些控件或动画。以 WPF 触发器机制为例，它在 Silverlight 中并不完全可用。

因此，首先学习较小的子集，您可以稍后将这些知识扩展到全套，但如果您从全套开始并沉迷于一些可用的细节，当有人要求您移植时，您将遇到麻烦您设计的使用 WPF 应用程序到 Silverlight。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-15T22:37:13.823

**我会反对说先学习WPF。**

这是我的推理：

*   可用于 WPF 的资源比 Silverlight 多得多，例如书籍、博客和 msdn 文档

    *   [WPF 书籍](https://stackoverflow.com/questions/9591/what-wpf-books-would-you-recommend)
*   您不是在处理 Beta 移动目标

*   您不必只处理异步调用

*   不受缺少合并字典、触发器、TileBrushes 等功能的限制。

*   您不必担心由于 SL 中缺乏功能而重新学习正确地做事

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-14T13:39:30.053

Silverlight 是 WPF 的精简版，因此它内部需要学习的东西应该更少。另一方面，这两个平台有不同的目标（网络和富客户端），所以我想这取决于你要构建的应用程序。
如果您只是想为自己学习（在不久的将来没有应用程序），我会选择 Silverlight，因为它不太容易被同化。尽管如此，Silverlight 仍然是一个移动的目标，比 WPF 多得多，因此您必须不时跟上一些变化（成为早期采用者的乐趣 :)）。
WPF 有更多的东西，你可能会在某个时候想要使用，但我会等待需求首先出现。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-15T20:17:10.650

我在播客、博客和采访中听到的每个行业专家都建议**先学习 Silverlight**，然后逐渐转向 WPF，这是一个巨大的 UI 框架。

Silverlight 很轻，允许您处理较小的控件和功能子集，以便您了解这种新的 UI 构建范例，基于：

1.  模板
2.  数据绑定
3.  风格

**更新：07/2011**

我不想提及这一点，但最近微软通过推出 IE 9 和 IE 10 以及即将推出的 Windows 8 的强大功能，更加关注 HTML5、Javascript 和 CSS。

随着时间的推移，越来越多的开发人员和 CTO 对将 Silverlight 作为 LOB 应用程序平台持怀疑态度，我们怀疑 Silverlight 将仅限于 Windows Phone 和利基领域，例如图形相关应用程序的医疗保健领域，而不是常规的 LOB 应用程序。

就目前而言，截至 2011 年夏天，未来可能看起来支离破碎，纯 Web 技术（HTML5、JS 和 CSS）的机会更多，而不是插件和特定于操作系统的 UI 技术。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-14T13:58:11.410

我将从学习 XAML 开始，阅读一些教程并使用 XAMLPad。这将使您在实际构建应用程序之前对基础知识有所了解。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T15:14:18.287

我将从 WPF 开始并做非常简单的控件熟悉示例。你的目标应该是学习 XAML 和绑定。因此，如果您只是创建一些基本的 WPF 窗口应用程序将引导您的学习速度。然后最终你可以转移到silverlight。是的，正如其他人在这里提到的，Silverlight 是 WPF 的一个子集。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T22:07:16.937

嗯，这取决于你要做什么。如果您正在处理客户端/服务器，那么我会使用 WPF。如果您在可以保证所有机器上都安装了 .Net 的环境中工作，那么我也会使用 WPF，因为您可以使用所谓的 XBAP，它是一个运行通过的 WPF 应用程序浏览器。

这真的取决于你。但是，我会说silverlight 还不是RTM，而WPF 是。WPF 有很多关于这个主题的书籍，而 silverlight 没有。通过阅读其中几本书可能更容易获得 WPF 的全部禅宗，然后深入研究您想玩的任何一本。

请记住，silverlight 具有 WPF 控件的子集，这是一个配对的 .Net 框架，并且不进行同步调用。只要您事先了解这一点，您就可以开始学习整个基础的核心，并在以后根据最适合您的技术调整您的实践经验。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-14T14:30:36.530

[Silverlight 开发入门中的](https://stackoverflow.com/questions/60620/getting-started-with-silverlight-development)一些提示

# svn - 用于 Eclipse、Subclipse 和 Subversive 的 SVN 插件的优缺点是什么？

> ID：61320
> 
> 赞同：638
> 
> 时间：2008-09-14T13:14:58.083
> 
> 标签：svn, eclipse, subclipse, subversive

Eclipse 中的 SVN 分为两个阵营。SVN 开发了一个名为[Subclipse](http://subclipse.tigris.org/)的插件。Eclipse 人有一个名为[Subversive](http://www.eclipse.org/subversive/)的插件。从广义上讲，他们都做同样的事情。各自的优点和缺点是什么？

* * *

## 回答 #1

> 赞同：177
> 
> 时间：2008-09-14T20:34:46.043

两者非常相似，但 Subversive 是“eclipse svn 提供者”。我主要使用 Subversive 是因为有一些方便的功能：

**历史分组**

当我浏览分支的历史记录而不是只查看每个提交的一堆行时，它可以按今天、每周等对提交进行分组。

**树干、分支和标签的映射**

Subversive 采用默认的 svn 布局：trunk、branches、tags（您可以更改），因此无论何时您想要标记或分支，只需单击一下，您就可以提供标记或分支的名称。

就像我说的，这些只是我觉得方便的细微差别。两者都适用于 mylyn，但总体而言，这两个扩展并没有太大的区别。

与 Subversive 合并虽然很痛苦（没有尝试过 Subclipse），但我从未能够成功合并。合并的预览很棒，但它永远不会完成合并，或者需要很长时间。大多数时候，我通过命令行完成合并，没有任何问题。

* * *

## 回答 #2

> 赞同：162
> 
> 时间：2012-11-02T20:42:40.570

我会尽力回答这个问题。我是 Subclipse 的项目负责人，我管理该项目的所有发布等。所以我的偏见很明显。

我不会过多地谈论 Subversive。显然，有些用户使用它并喜欢它。在功能上，这些产品非常相似，因为它们都是成熟的产品。

我确实想评论的一件事是 Subversive 是“官方 Eclipse”插件的概念。这是不正确的，因为没有这样的名称。Eclipse 是一个开源基金会，任何想要遵循其规则、流程和 IP 要求等的项目都可以在该基金会托管他们的项目。这不会使您比任何其他插件更正式或更不正式。

我还要指出，Subversive 自成立以来一直处于“孵化”阶段，在我看来，它永远不会满足毕业要求。正如您在此处看到的，该项目只有一名提交者，提交活动已减少到非常低的水平。

*[颠覆 - SVN 团队提供者](http://www.eclipse.org/projects/project.php?id=technology.subversive)*

那么为什么要使用 Subclipse？我们积极参与 Subversion 本身。我是 Subversion PMC 的成员，帮助维护 Java 语言绑定，以便我们（以及 Subversive 等其他项目）可以使用 API。

我们直接与 Subversion 合作来定义和改进 API，并确保向 Subclipse 等客户端公开必要的功能。我们还与 Visual Studio 集成 ( [AnkhSVN](https://en.wikipedia.org/wiki/AnkhSVN) ) 和 TortoiseSVN 团队密切合作并合作，以确保客户端之间的用户体验相对一致。

Subclipse 仍在积极维护中，我们维护对 Eclipse 版本 3.2 到 4.2 的支持。我们一直在努力听取反馈并整合来自社区的想法。最近的 1.8.x 版本包括内部更改，这些更改极大地提高了 Eclipse 在处理大型项目时的性能（即当您真正看到它时）。

Subclipse 在合并跟踪支持等领域处于领先地位，我们与 Subversion 团队密切合作，首先在 1.5 中添加此功能，然后在后续版本中对其进行改进。我们通常是新 API 的最初消费者，并向项目提供强化该功能所需的反馈。几年前，我们还引入了图形修订图功能，成为第一个将这个长期要求的功能带给 Eclipse 用户的人。

如果人们希望在 Subclipse 中看到 Subversive 中的特定 UI 功能，我鼓励您访问我们的社区并参与我们的讨论论坛。也许其他用户分享您的观点，我们可以一起改进 UI。

论坛*[[Subclipse-users]](http://subclipse.tigris.org/ds/viewForumSummary.do?dsForumId=1047)*。

Eclipse 4.2 是本文发布时的最新版本，但可以肯定的是，Subclipse 将支持所有未来的 Eclipse 版本。

* * *

## 回答 #3

> 赞同：117
> 
> 时间：2010-01-27T14:25:54.487

对于每个新版本的 Eclipse，我都会安装 Subversive，因为它是 Eclipse 提供的标准。每次，它在识别我先前存在的项目时都会遇到问题。

所以我最终卸载了 Subversive 并安装了 Subclipse，效果非常好。我也经常在命令行和 Eclipse 中使用 SVN，Subclipse 对此没有任何问题。

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2009-07-17T16:46:32.970

读完这篇文章后，我改用 Subclipse。
[http://eclipsezone.com/eclipse/forums/t77149.rhtml#92035407](http://eclipsezone.com/eclipse/forums/t77149.rhtml#92035407 "http://eclipsezone.com/eclipse/forums/t77149.rhtml#92035407")

* * *

## 回答 #5

> 赞同：34
> 
> 时间：2009-06-09T15:29:30.693

如果您与 Subversion 进行了很多合并，那么您可能会更喜欢 CollabNet Desktop - Eclipse Edition。您必须在 CollabNet 上注册一个帐户才能下载，但它是免费的。它本质上是具有更好合并 UI 的 Subclipse。

我不隶属于 CollabNet。

CollabNet 已将其改进的合并客户端提供给未注册的 Subclipse 用户。在从更新站点安装 Subclipse 时，您可以通过选择 CollabNet Merge Client 功能来获得它。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-09-14T13:19:30.570

我会说 Subclipse，因为我什至无法让 Subversive 工作；）

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2008-09-14T14:06:57.460

其实我觉得他们俩都很烂。在我看来，使用[TortoiseSVN](http://tortoisesvn.tigris.org/)是一个更好的解决方案。它更加健壮并且往往工作得更好，而且我一直遇到与 Subclipse 和 Subversive 的集成问题。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2008-09-15T00:17:14.247

他们都有非常令人发指的缺点，但我无法让 Subversive 与我从命令行签出的项目一起工作，这对我来说是一个阻碍。

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2009-12-07T00:18:45.350

我[都试过了](http://journals.jevon.org/users/jevon-phd/entry/19739)，Subclipse 和 Subversive 都很糟糕。两者都很难安装。如果您使用 Subversive，*则无法使用外部 SVN 客户端*。

但是，您需要在 Eclipse 中安装一个 SVN 客户端来跟踪更改，并且不破坏您的本地存储库。

我安装了[Subclipse](http://subclipse.tigris.org/)，但使用[TortoiseSVN](http://tortoisesvn.tigris.org/)来实际执行提交/标记/分支/合并。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2008-09-15T00:34:25.360

Subclipse，因为至少它有效。

到目前为止，颠覆性对我来说是一个失败的桶。我用 Subclipse 签出的所有旧项目都不适合它。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2011-03-05T12:56:07.513

当然，这两个 IDE 插件都有自己的问题。但两者都不排除并行使用其他解决方案，如 TortoiseSVN 或命令行。我在工作中使用所有这三个项目。

要记住的重要一点是，您的所有客户端 SVN 软件*都应该*使用相同的 SVN 文件格式——这在 SVN 版本之间有所不同——否则你就是在自找麻烦。

我们发现的另一个问题是当您的客户端软件使用与服务器不同的 SVN 文件格式时。（通过文件格式，我的意思是所有信息在所有那些看似不可见的 .svn 文件中表示的方式，这些文件有效地记录了 SVN 需要了解的有关您的项目文件的内容。）这可能会造成严重破坏。1.5 服务器和 1.6 客户端之间有一个记录在案的错误，但我现在找不到链接。

由于与我们的 SVN 1.5.5 服务器不兼容，我们在运行高级 (IMO) Subclipse 1.6 插件时遇到了问题。所以我们恢复到颠覆性。它工作得很好，虽然速度很慢而且有些错误（但正在改进）。不过，当我们的服务器更新时，我们将切换到 Subclipse。是的，我们使用 TortoiseSVN 检查我们的项目并将它们导入 Eclipse（它更快）。

我们发现，正如其他发帖者所说，如果我们运行更新版本的 TortoiseSVN 以 1.6.x 格式编写文件，它将无法正常工作，但是当我们恢复到 TortoiseSVN 1.5.x 时，它工作得很好。命令行客户端也是如此（我们在[Ant](http://en.wikipedia.org/wiki/Apache_Ant)任务中使用它）。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2011-08-09T14:29:46.147

如果您使用**svn+ssh**作为访问存储库的协议，我强烈建议您选择 Subclipse：Subversive 不够智能，无法正确记住您的凭据，并且每次更新工作副本时都会提示您输入用户名和私钥，并且对于您可能已经设置的每个 svn-external。

“记住凭据”选项在这种情况下被破坏，并且自 Subversive 首次公开发布以来一直存在。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2009-11-30T08:11:21.073

我选择使用 Subclipse，因为它与 Subversion 项目最密切相关，因此更有可能更好地处理核心 SVN 功能。如果它根本无法执行任何功能，那么我有 TortoiseSVN 作为备份。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2010-07-13T21:43:08.750

只是一个更新。我最近正在重新安装 Eclipse，并面临选择 Subclipse 与 Subversive 的问题。我也遇到了让 Subversive 工作的麻烦，所以我选择了 Subclipse。

它完美地安装在我的 Linux 64 位机器上并且运行良好。我将最常见的功能（如更新、提交、..）映射到快捷方式，这真是太棒了。合并也很好，尽管对于更大的合并我仍然求助于 TortoiseSVN。我用 3.5 和 3.6 都试过了，它们都工作得很好。我最终使用了 3.5，因为出于某种原因，键绑定不适用于 3.6。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2012-07-25T21:22:52.467

如果您在公司中使用其中之一，甚至可能希望将它们捆绑在自己的基于 Eclipse 的产品中，那么使用 Subclipse 会更轻松，因为它在商业友好的 Eclipse Public License 下可用。

另一方面，颠覆性需要所谓的连接器才能充分发挥作用。那些有单独和不同的许可证。因此，您最终可能会为 Subversive 功能获得两个或三个不同的许可证，而*所有其他*Eclipse 插件都在那个 EPL 下。这也是这些连接器不在 eclipse.org 上托管的原因。

这就是为什么在 Subversive 安装后动态下载它们的原因（这也意味着简单地镜像 eclipse.org 更新站点并不能在您的公司网络中为您提供可用的 Subversive 离线安装）。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2008-09-17T22:38:28.640

直到大约 2008 年 5 月，我一直在使用 Subclipse，但由于某些项目的问题，我已经切换到 Subversive，并且使用它没有任何问题。如果您正在做一些花哨的事情，比如无头[Buckminster](http://wiki.eclipse.org/Buckminster)构建，那么 Subversive 绝对是您的最佳选择。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2009-11-04T10:33:38.437

如果您使用 TortoiseSVN 并定期更新版本，您可能会发现带有 Subversive 的 Eclipse 会丢失所有 SVN 信息并抛出一些可怕的错误。

原因是新版本的 TortoiseSVN 添加了 Eclipse Subversive 无法理解的新元数据，除非您也保持 Eclipse SVN 连接器是最新的。

我通常使用 SVNKit 连接器，因此 TortoiseSVN 1.5.x 将与 Eclipse SVNKit 连接器 1.5.x 一起使用，而 TortoiseSVN 1.6.x 将与 Eclipse SVNKit 连接器 1.6.x 一起使用。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2011-09-30T22:23:39.970

+1 次剪辑
-1 颠覆性

Subversive 在即使是很小的重构之后也会感到困惑，并且存在上述验证问题。

环境：[STS](https://spring.io/tools) 2.7.2（基于伽利略）

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2013-01-24T07:09:39.167

[Subversive比](http://www.eclipse.org/subversive/)[Subclipse](http://subclipse.tigris.org/)具有更多优势，如下所示。但是只有一个 Subversion 没有的特性对使用分支如此重要。所以我们必须使用**Subclipse**。

**颠覆性**优势：

*   视图和图标提供更多信息
*   刷新提交同步项后，提交的文件将关闭。

**子剪辑**优势

*   比较两个分支的能力

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-09-14T13:19:18.277

对我来说，没有好坏之分，但 Subversive 是 Eclipse Ganymede 平台中的默认 SVN 插件，因此它有可能更好地与 Eclipse 集成。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2008-11-05T16:41:17.283

作为 Brendon 的补充回答：

我们从 1.5.1 版本开始使用 Subversion，并首先使用 Subclipse。但是因为我们非常依赖合并功能，所以我们切换到了更方便的 Subversive，并且在合并对话框中有一个单独的 Reintegrate 选项。

一个可能阻碍合并的错误是，如果您明确选择修订，则不会采用列出的最后一个修订。例如，“101-100”不会合并 r100 和“100”，因此根本不会合并任何东西。（版本 0.7.5）

它使用与 CVS 插件相同的指标。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2010-11-18T13:25:09.340

虽然我都使用 Helios，但我对 Subclipse 有一点偏好，因为它对`bugtraq`属性的出色支持（[详情请点击此处](http://markphip.blogspot.com/2007/01/integrating-subversion-with-your-issue.html)）。

*History*视图显示一个单独的列（标题为，`bugtraq:label`显示`BUGID`s），上下文菜单有一个专门的“打开 Bug URL”操作（链接到`bugtraq:url`）——我不知道如何使用 Subversive 访问这些信息。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2008-09-16T03:32:06.377

我都用过，虽然 Subclipse 对我来说很不稳定，但当我的同事不小心输入了错误的凭据时，Subversive（至少在以前的版本中）锁定了他的帐户（网络登录用于访问 subversion 存储库）。

随着时间的推移，Subclipse 往往会变得杂乱无章。如果 Eclipse 没有定期刷新，Subclipse 似乎会丢失其文件跟踪信息。不过，老实说，因为我有[Easy Explorer Plugin](http://easystruts.sourceforge.net/#easyexplore)，所以我（偶尔）使用 Subversive 来获取历史和更改信息，但我很容易探索和使用 TortoiseSVN 来提交和更新我知道我最近更改过的项目。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2008-09-16T10:56:47.697

自从升级到 Ganymede 后，我一直在使用 Subversive。我在 Linux（Ubuntu 和 Fedora Core）、Windows XP 和 Mac OS X.5 中将它与 Eclipse 一起使用。除了让 Subversion 1.5.1 在 Mac OS 下使用正确的安全库的一些问题之外，我没有遇到任何问题。鉴于它已被用作 Eclipse 技术项目，我倾向于将赌注押在它上面，以期长远。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2010-04-11T09:52:24.323

我还没有真正使用过它，但似乎 Subversive 支持“ [Check Out As](http://www.eclipse.org/subversive/documentation/teamSupport/find_check_wiz.php) ”，就像内置的 CVS 支持一样。

就像，要从 SVN 获取一个项目并能够将其作为 Web 项目运行，也许可以一口气完成。但是为了在 Subclipse 中获得相同的结果，我只需查看源代码并运行：

```
mvn eclipse:eclipse -Dwtpversion=2.0
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2010-12-05T21:13:35.267

我刚刚发现我无法弄清楚如何使用 Subclipse 查看属性差异。在 Subversive 中，您在历史视图中选择两个修订，右键单击并从弹出窗口中选择比较属性。这足以让我坚持使用 Subversive。

尝试切换的原因是 Subversive 在 OS X 上的奇怪行为：在每次 'svn update' 运行后，一些称为 'svn cache update' 的自动操作会以异常水平占用 CPU，总是需要很长时间才能完成。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2011-05-16T21:33:18.273

FWIW，我们使用的是旧版本的 SVN 服务器（1.4 左右），我似乎记得有一次对 Subclipse 的更新破坏了向后兼容性，其要点是“没有人应该使用这么旧的版本无论如何，SVN”。

Subversive 是唯一一个似乎能够处理旧版本的版本。不记得细节了，抱歉。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2011-12-08T15:56:20.873

我们在团队中都尝试过。

由于 Subclipse（来自 Galileo/Helios 的那个）在通过 VAS 验证我们的 SVN 服务器时遇到了一些问题，所以我们在其他地方没有问题，即 TortoiseSVN 客户端、浏览器（Internet Explorer 7 除外）。

所以我们安装`Subversive`了，问题就解决了。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2013-02-12T00:39:08.477

Subclipse 相对于 Subversive 的优势......它确实有效！

很久以前，我在为依赖于 Subclipse 的 Eclipse 开发协作插件时使用了 Subclipse。插件的 Subclipse 部分从来都不是问题，虽然整个[Ant](http://en.wikipedia.org/wiki/Apache_Ant)的东西仍然让我有点困惑，但好的部分是你不必了解 Ant 部分是如何工作的就知道如何使用它。

我今天尝试安装 PDT（这是另一个博客），然后是 Subversive，因为和许多人一样，它被描述为“Eclipse SVN 插件”。我无法一次安装四个连接器，所以我不得不一次安装一个，一次尝试一个，一次一个，它无法通过 SVN 服务器进行身份验证。

我正在尝试 PDT 和 Subversive，因为我想节省时间，而不是将更多时间花在插件的不同问题上。

我卸载了 Subversive，安装了 Subclipse，然后就这样连接了。

节省时间和麻烦，从一开始就使用 Subclipse。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2008-09-18T14:25:20.267

我也两个都用过。我的工作区有大约 150 个项目，当我选择所有插件并说“同步存储库”时，Subversive 会花费很长时间。UI 会冻结很长时间。我发现 Subclipse 更稳定。

无论如何，我结合了很多工具。对于一些任务，比如检查整个分支，我更喜欢命令行。对于其他人，我使用[TortoiseSVN](http://en.wikipedia.org/wiki/TortoiseSVN)。我主要使用 Subclipse 来查看历史记录并直接在工具上运行比较，偶尔进行比较（不过，我更喜欢[Beyond Compare](http://en.wikipedia.org/wiki/Beyond_Compare)）。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2008-11-05T16:46:22.843

我和其他人遇到了同样的问题，甚至让 Subversive 工作，所以我不能说它是否比 Subclipse 更好。

在与 Eclipse 集成标签和分支时，Subclipse 确实缺乏。你可以做到，但它远没有 CVS 那样无缝。

* * *

## 回答 #32

> 赞同：-2
> 
> 时间：2011-12-20T23:24:12.107

如果您使用 Zend Studio 9，Zend 的 Eclipse 实现，我建议使用 Subclipse 而不是 Zend Studio 附带的默认 Subversive。

我在 Zend 论坛上发布了 Subversive 和 Zend Studio 9 的问题以及[我使用 Subclipse 的解决方案](http://forums.zend.com/viewtopic.php?f=59&t=42373&p=98993#p98733)。

# sharepoint - 使用 WSS 对象模型从 SPUser 获取用户照片

> ID：61339
> 
> 赞同：4
> 
> 时间：2008-09-14T13:47:59.517
> 
> 标签：sharepoint, photo, wss

我正在尝试通过 WSS 3.0 对象模型检索 Sharepoint 用户照片上的用户。我一直在网上浏览解决方案，但到目前为止我一直无法找到解决方法。有可能吗，如果可以，怎么办？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-14T17:06:42.707

这是一个可以帮助您完成工作的代码片段。您可能需要进行一些额外的验证以避免任何异常（确保配置文件实际存在，确保图像 URL 实际存在等...）：

```
 //get current profile manager
    UserProfileManager objUserProfileManager = new UserProfileManager(PortalContext.Current);
    //get current users profile
    UserProfile profile = objUserProfileManager.GetUserProfile(true);
    //get user image URL
    string imageUrl = (string)profile[PropertyConstants.PictureUrl];

    //do something here with imageUrl 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T04:17:59.503

如果您严格地谈论 WSS 3.0（而不是 MOSS），那么您实际上并没有全局用户配置文件本身，而是每个站点集中的隐藏用户信息列表。这意味着您无法使用 Microsoft.Office.Server 命名空间中的任何内容。

但是，只要您知道用户图片的 URL，就可以通过编程方式更新用户信息列表。只要您以某种提升的权限运行，您就应该能够像处理任何其他 SharePoint 列表一样[操作此列表。](http://www.sharepointblogs.com/jimyang/archive/2006/12/05/update-wss-3-0-user-profile-programmatically.aspx)请记住，此列表仅适用于网站集的范围，因此用户必须在整个地方进行相同的更新才能真正拥有照片 URL。另外，在有人向他们分配某种权限之前，用户不会进入用户信息列表，因此并非您域中的每个用户都会在那里。

处理这个问题的干净方法绝对是用户配置文件机制是 MOSS，但如果这是一个选项，那么问题应该真正更新以询问 MOSS 与 WSS。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T16:38:24.240

啊，你必须使用 UserProfileManager 类。更多信息在这里：http: [//msdn.microsoft.com/en-us/library/microsoft.office.server.userprofiles.userprofilemanager.aspx](http://msdn.microsoft.com/en-us/library/microsoft.office.server.userprofiles.userprofilemanager.aspx)

示例使用：

```
public override void ItemAdded(SPItemEventProperties properties)
{
    // Get list item on which the event occurred.
    SPListItem item = properties.ListItem;

    // Set the Author Image field to the user's PictureURL if it exists.
    using (SPWeb web = properties.OpenWeb())
    {
        // Author: {C32DB804-FF2D-4656-A38A-B0394BA5C931}
        SPFieldUserValue authorValue = new SPFieldUserValue(properties.OpenWeb(), item[new Guid("{C32DB804-FF2D-4656-A38A-B0394BA5C931}")].ToString());

        UserProfileManager profileManager = new UserProfileManager(ServerContext.GetContext(web.Site));
        UserProfile profile = profileManager.GetUserProfile(authorValue.LookupId);
        UserProfileValueCollection values = profile[PropertyConstants.PictureUrl];

        if (values.Count > 0)
        {
            // Author Image: {37A5CA4C-7621-44d7-BF3B-583F742CE52F}
            SPFieldUrlValue urlValue = new SPFieldUrlValue(values.Value.ToString());
            item[new Guid("{37A5CA4C-7621-44d7-BF3B-583F742CE52F}")] = urlValue.Url;
        }
    }

    item.Update();

    // News Text: {7F55A8F0-4555-46BC-B24C-222240B862AF}
    //

    // Author Image: {37A5CA4C-7621-44d7-BF3B-583F742CE52F}
    // 

    // Publish Date: {45E84B8B-E161-46C6-AD51-27A42E4992B5}
    //
} 
```

# c - 有没有办法将汇编代码插入C？

> ID：61341
> 
> 赞同：76
> 
> 时间：2008-09-14T13:55:31.200
> 
> 标签：c, inline-assembly, assembly

我记得在过去使用旧的 bo​​rland DOS 编译器时，您可以执行以下操作：

```
asm {
 mov ax,ex
 etc etc...
} 
```

现在有半平台独立的方式来做到这一点吗？我需要进行 BIOS 调用，所以如果有办法在没有 asm 代码的情况下做到这一点，那对我同样有用。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-09-14T14:05:30.787

使用[GCC](http://www.ibiblio.org/gferg/ldp/GCC-Inline-Assembly-HOWTO.html)

```
__asm__("movl %edx, %eax\n\t"
        "addl $2, %eax\n\t"); 
```

使用[VC++](http://msdn.microsoft.com/en-us/library/4ks26t93(VS.71).aspx)

```
__asm {
  mov eax, edx
  add eax, 2
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-15T00:10:07.743

在 GCC 中，不仅如此。在指令中，你必须告诉编译器发生了什么变化，这样它的优化器就不会搞砸了。我不是专家，但有时它看起来像这样：

```
 asm ("lock; xaddl %0,%2" : "=r" (result) : "0" (1), "m" (*atom) : "memory"); 
```

用 C 编写一些示例代码，然后让 GCC 生成汇编列表，然后修改该代码是个好主意。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-14T13:57:55.780

一个好的开始是阅读这篇关于 C/C++ 中的内联汇编的文章：

[http://www.codeproject.com/KB/cpp/edujini_inline_asm.aspx](http://www.codeproject.com/KB/cpp/edujini_inline_asm.aspx)

文章中的示例：

```
#include <stdio.h>

int main() {
    /* Add 10 and 20 and store result into register %eax */
    __asm__ ( "movl $10, %eax;"
                "movl $20, %ebx;"
                "addl %ebx, %eax;"
    );

    /* Subtract 20 from 10 and store result into register %eax */
    __asm__ ( "movl $10, %eax;"
                    "movl $20, %ebx;"
                    "subl %ebx, %eax;"
    );

    /* Multiply 10 and 20 and store result into register %eax */
    __asm__ ( "movl $10, %eax;"
                    "movl $20, %ebx;"
                    "imull %ebx, %eax;"
    );

    return 0 ;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T14:55:38.240

对于 Microsoft 编译器，仅 x86 支持*内联汇编。*对于其他目标，您必须在单独的汇编源文件中定义整个函数，将其传递给汇编器并链接生成的目标模块。

您极不可能在受保护模式的操作系统下调用 BIOS，并且应该使用该系统上可用的任何工具。即使您处于内核模式，它也可能不安全 - 如果您这样做，BIOS 可能无法正确同步操作系统状态。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-03-28T15:55:28.110

`asm`or函数的使用`__asm__`（在编译器中有所不同）

你也可以用`fortran`函数编写fortran代码

```
asm("syscall");
fortran("Print *,"J"); 
```

# multithreading - 线程还是异步？

> ID：61342
> 
> 赞同：8
> 
> 时间：2008-09-14T13:56:14.990
> 
> 标签：multithreading, language-agnostic

你如何让你的应用程序多线程？你使用异步函数吗？还是你产生一个新线程？我认为异步函数已经产生了一个线程，所以如果你的工作只是做一些文件读取，那么懒惰并且只是在线程上产生你的工作只会“浪费”资源......那么使用线程时是否有某种设计或异步功能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-14T14:02:59.153

如果您在谈论 .Net，请不要忘记[ThreadPool](http://msdn.microsoft.com/en-us/magazine/cc164139.aspx)。线程池也是异步函数经常使用的。产生大量线程实际上会损害您的性能。线程池旨在生成足够多的线程以最快地完成工作。因此，请使用线程池而不是创建自己的线程，除非线程池不能满足您的需求。

PS：留意微软的[Parallel Extensions](http://www.microsoft.com/downloads/details.aspx?FamilyId=348F73FD-593D-4B3C-B055-694C50D2B0F3&displaylang=en)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-14T14:06:39.223

如果你开始产生大量线程，产生线程只会浪费资源，一两个额外线程不会影响平台性能，事实上系统目前有超过 70 个线程供我使用，而 msn 正在使用 32 个（我真的有不知道信使如何使用这么多线程，特别是当它最小化并且没有真正做任何事情时......）

通常，产生线程的好时机是某些事情需要很长时间，但您需要继续做其他事情。

例如说计算将需要 30 秒。最好的办法是为计算生成一个新线程，以便您可以继续更新屏幕，并处理任何用户输入，因为如果您的应用程序在完成计算之前冻结，用户会讨厌它。

另一方面，创建线程来做几乎可以立即完成的事情几乎没有意义，因为创建（甚至只是使用线程池将工作传递给现有线程）的开销将高于仅在第一名。

有时您可以将您的应用程序分成几个单独的部分，这些部分在各自的线程中运行。例如，在游戏中，更新/物理等可能是一个线程，而图形是另一个线程，声音/音乐是第三个线程，网络是另一个线程。这里的问题是你真的必须考虑这些部分将如何交互，否则你可能会有更糟糕的表现，看似“随机”发生的错误，甚至可能会死锁。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T14:55:09.123

我将支持[Fire Lancer 的](https://stackoverflow.com/questions/61342/threads-or-asynch#61351)回答 - 创建自己的线程是处理大型任务或处理其他同步应用程序“阻塞”的任务的绝佳方式，**但**您必须清楚地了解问题您必须以明确定义线程任务并限制其作用范围的方式来解决和开发。

举一个我最近研究的例子——一个 Java 控制台应用程序定期运行以通过基本上屏幕抓取 url、使用 DOM 解析文档、提取数据并将其存储在数据库中来捕获数据。

正如您所料，作为一个单线程应用程序，它花费了一段时间，对于 50kb 的页面，平均每秒大约 1 个 url。还不错，但是当您扩展到需要批量处理数千个网址时，那就不好了。

分析应用程序显示大部分时间活动线程处于空闲状态 - 它正在等待 I/O 操作 - 打开到远程 URL 的套接字、打开到数据库的连接等。这种情况很容易发生通过多线程改进。重写为多线程并且仅使用 5 个线程而不是 1 个线程，即使在单核 cpu 上，吞吐量也增加了 20 倍以上。

在这个例子中，每个“工作”线程都被明确地限制在它所做的事情上——打开远程一个远程 url，解析数据，将它存储在数据库中。所有“高级”处理——生成要解析的 url 列表、确定下一个、处理错误，都由主线程控制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-14T14:05:05.793

线程的使用使您可以更多地考虑应用程序需要线程的方式，并且从长远来看可以更容易地改进/控制您的性能。
异步方法使用起来更快，但它们有点神奇——很多事情都使它们成为可能——所以很可能在某些时候你需要一些它们不能给你的东西。然后您可以尝试滚动一些自定义线程代码。
这一切都取决于您的需求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T12:04:22.993

答案是“视情况而定”。

这取决于您要达到的目标。我将假设您的目标是提高性能。

最简单的解决方案是找到另一种提高性能的方法。运行分析器。寻找热点。减少不必要的IO。

下一个解决方案是将您的程序分成多个进程，每个进程都可以在自己的地址空间中运行。这是最简单的，因为各个进程不可能相互混淆。

下一个解决方案是使用线程。在这一点上，您正在打开一个主要的蠕虫罐头，所以从小处着手，并且只对代码的关键路径进行多线程处理。

下一个解决方案是使用异步 IO。通常只推荐给编写一些负载很重的服务器的人，即使那样我也宁愿重新使用现有的框架之一，抽象出细节，例如 C++ 框架 ICE，或 java 下的 EJB 服务器。

请注意，这些解决方案中的每一个都有多个子解决方案 - 有不同种类的线程和不同种类的异步 IO，每个都有略微不同的性能特征，但同样，最好让框架为您处理它。

# iphone - iPhone应用程序可以以root身份运行吗？

> ID：61346
> 
> 赞同：4
> 
> 时间：2008-09-14T14:01:07.770
> 
> 标签：iphone, permissions, setuid

我正在考虑我想创建的 iPhone 应用程序的设计。一个可能的问题是此应用程序必须以 root 身份运行（以访问某些网络端口）。在一个典型的 UNIX 应用程序中，我只是让应用程序使用 setuid 运行，但我想知道这是否可以使用 iPhone 应用程序。

我在 Apple 的论坛上读过这个问题，这令人沮丧：

[http://discussions.apple.com/thread.jspa?threadID=1664575](http://discussions.apple.com/thread.jspa?threadID=1664575)

我了解 Apple 想要限制程序的功能，但用户有很多正当的理由以提升的权限运行程序。我不是想在这里创建一个黑客工具。

我确信我可以在越狱的 iPhone 上解决这个问题，但这不是我想要的。有没有办法在完整的 iPhone 上运行具有提升权限的应用程序？

（顺便说一句，没有必要就 NDA 向我发出警告。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-14T14:22:54.487

iPhone SDK 协议第 3.3.4 节建议您不得在沙箱之外工作。

鉴于[Apple 在允许哪些应用程序方面有些武断，因此](http://speirs.org/2008/09/12/app-store-im-out/)在开始开发*之前*，您绝对应该仔细检查它们。

与 2.0.x 相比，[沙盒限制在 2.1 中实际上有所增加](http://daringfireball.net/linked/2008/09/12/iphone-21-security)；您甚至无法再从另一个应用程序的沙箱中读取数据。因此，即使当前*可以*提升您的应用程序的权限，它也很可能不会出现在未来的版本中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-14T14:24:32.957

你唯一的选择是

1.  在 iphone 上以 root 身份运行应用程序

2.  设置应用程序 setuid 位和所有者根。

我看不到他们中的任何一个受到苹果的祝福。

我想这取决于你想用这些特权做什么，如果你幸运的话，可能会有更多细粒度的特权可用，但是你必须选择一个高于 1024 的端口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T19:26:50.390

如果您可以在普通台式计算机上执行此操作，那一点也不重要。iPhone 不是普通的台式电脑。

与台式电脑不同，在 iPhone 上无需越狱即可获取应用程序的*唯一方法是从 App Store 获取。*进入 App Store的*唯一*途径是遵循苹果的规则，而苹果的规则*明确*包括“不提权”、“不逃避沙盒”、“不访问现有提供的 API 之外的网络端口”。

你想做的事是**不可能的**。

# .net - 如何在 Application.ThreadException 事件处理程序中获取整个异常链？

> ID：61354
> 
> 赞同：4
> 
> 时间：2008-09-14T14:08:15.617
> 
> 标签：.net, winforms, exception

我只是在修复 .NET 2.0 应用程序中的异常处理，我偶然发现了[Application.ThreadException](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.threadexception.aspx)的一些奇怪问题。

我想要的是能够从 GUI 元素后面的事件中捕获所有异常（例如 button_Click 等）。然后我想在“致命”上过滤这些异常，例如，对于某些类型的异常，应用程序应该继续运行，而对于其他类型的异常，它应该退出。

在另一个 .NET 2.0 应用程序中，我了解到，默认情况下，只有在调试模式下，异常才会真正留下 Application.Run 或 Application.DoEvents 调用。在发布模式下，这不会发生，并且必须使用 Application.ThreadException 事件“捕获”异常。

然而现在，我注意到**Application.ThreadException 事件的 ThreadExceptionEventArgs 中传递的异常对象始终是异常链中最内层的异常**。出于日志记录/调试/设计目的，我真的想要整个异常链。确定哪个外部系统失败并不容易，例如当您刚刚处理 SocketException 时：当它被包装为例如 NpgsqlException 时，那么至少您知道这是一个数据库问题。

**那么，如何从这个事件中获取整个异常链呢？**甚至有可能还是我需要以另一种方式设计我的异常处理？

请注意，我确实有一个使用[Application.SetUnhandledExceptionMode的](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.setunhandledexceptionmode.aspx)[解决方法](https://stackoverflow.com/questions/61366/rolling-your-own-message-loop-any-pitfalls)，但这远非理想，因为我必须推出自己的消息循环。

编辑：为了防止更多错误，**GetBaseException() 方法不会做我想要**的：它只返回最里面的异常，而我唯一已经拥有的是最里面的异常。我想了解最外面的异常！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-04T17:25:26.963

这个问题在这里更有用地表达和回答：

[为什么内部异常到达 ThreadException 处理程序而不是实际抛出的异常？](https://stackoverflow.com/questions/347502/why-does-the-inner-exception-reach-the-threadexception-handler-and-not-the-actual)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T10:41:35.843

我试图重现这种行为（总是得到最里面的异常），
但我得到了我期望的异常，所有 InnerExceptions 都完好无损。

这是我用来测试的代码：

```
 Private Shared Sub Test1()
      Try
         Test2()
      Catch ex As Exception
         Application.OnThreadException(New ApplicationException("test1", ex))
      End Try
   End Sub

   Private Shared Sub Test2()
      Try
         Test3()
      Catch ex As Exception
         Throw New ApplicationException("test2", ex)
      End Try
   End Sub

   Private Shared Sub Test3()
      Throw New ApplicationException("blabla")
   End Sub

Private Shared Sub HandleAppException(ByVal sender As Object, ByVal e As ThreadExceptionEventArgs)
...
End Sub 
```

Sub HandleAppException 处理 Application.ThreadException。首先调用 Test1() 方法。
这是我在 HandleAppException 中得到的结果（e As ThreadExceptionEventArgs）：

[线程异常 http://mediasensation.be/dump/?download=ThreadException.jpg](http://mediasensation.be/dump/?download=ThreadException.jpg)

如果您只是捕获并（重新）抛出异常，则不会出现 InnerExceptions，但它会附加到异常中。**StackTrace**，像这样：

> 在 Test.vb 中的 SO.Test3() 处：第 166 行
> 在 Test.vb 中的 SO.Test2() 处：第 159 行
> 在 Test.vb 中的 SO.Test1() 处：第 151 行

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T10:58:24.420

通常，如果异常发生在其他线程中，您只会丢失除 Application.ThreadException 异常处理程序中的基本异常之外的整个异常链。

从[MSDN 库](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.threadexception.aspx)：

> **此事件允许您的 Windows 窗体应用程序处理在Windows 窗体**线程中发生的其他未处理的异常 。将您的事件处理程序附加到 ThreadException 事件以处理这些异常，这将使您的应用程序处于未知状态。在可能的情况下，异常应该由结构化的异常处理块来处理。

解决方案：如果您使用线程，请确保所有线程/异步调用都在 try/catch 块中。或者如您所说，您可以使用 Application.SetUnhandledExceptionMode。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-09T02:06:45.873

刚刚发现了一些有趣的东西。不同的 GUI 事件会给你带来不同的结果。从 Form.Shown 事件处理程序引发的异常将导致 Application.ThreadException 捕获最内层的异常，但在 Form.Load 事件中运行的完全相同的代码将导致*最外层的*异常在 Application.ThreadException 中被捕获。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-14T14:18:04.360

您是否尝试过 Exception.GetBaseException 方法？这将返回创建 Application.TreadException 的异常。然后，您可以使用相同的过程来获取所有异常。

[exception.getbaseexception 方法](http://msdn.microsoft.com/en-us/library/system.exception.getbaseexception.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-03-06T01:25:23.153

基于此链中的一些信息，我使用了 UnhandledExceptionMode.ThrowException 而不是 UnhandledExceptionMode.CatchException。然后我在表单的 Run() 之外捕获异常，这给了我整个异常链。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-14T21:03:27.210

根据 MSDN 文档：

*在派生类中重写时，返回作为一个或多个后续异常的根本原因的异常。*

```
 Public Overridable Function GetBaseException() As Exception
        Dim innerException As Exception = Me.InnerException
        Dim exception2 As Exception = Me
        Do While (Not innerException Is Nothing)
            exception2 = innerException
            innerException = innerException.InnerException
        Loop
        Return exception2
    End Function 
```

您可以对此使用变体来解析异常链。

```
Public Sub LogExceptionChain(ByVal CurrentException As Exception)

    Dim innerException As Exception = CurrentException.InnerException
    Dim exception2 As Exception = CurrentException

    Debug.Print(exception2.Message) 'Log the Exception

    Do While (Not innerException Is Nothing)

        exception2 = innerException
        Debug.Print(exception2.Message) 'Log the Exception

        'Move to the next exception
        innerException = innerException.InnerException
    Loop

End Sub 
```

这会让我觉得正是你正在寻找的东西。

# html - 使用 CSS 如何最好地显示名称值对？

> ID：61357
> 
> 赞同：39
> 
> 时间：2008-09-14T14:14:20.640
> 
> 标签：html, css

我还应该使用桌子吗？

我要替换的表格代码是：

```
<table>
    <tr>
        <td>Name</td><td>Value</td>
    </tr>
    ...
</table> 
```

从我一直在阅读的内容来看，我应该有类似的东西

```
<label class="name">Name</label><label class="value">Value</value><br />
... 
```

非常感谢您提供在线示例的想法和链接。我是一个超出我设计深度的开发人员。

编辑：我需要既能够向用户显示数据，又能够以单独（但几乎相同）的形式编辑值。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-09-14T14:17:59.850

我认为定义列表在语义上非常接近名称/值对。

```
<dl>
    <dt>Name</dt>
    <dd>Value</dd>
</dl> 
```

[定义列表 - 被误用或误解？](http://www.maxdesign.com.au/presentation/definition)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2016-09-14T10:17:53.143

水平定义列表工作得很好，即

```
<dl class="dl-horizontal">
  <dt>ID</dt>
  <dd>25</dd>
  <dt>Username</dt>
  <dd>Bob</dd>
</dl> 
```

该类`dl-horizontal`由 Bootstrap CSS 框架提供。

来自 Bootstrap4：

```
<dl class="row">
  <dt class="col">ID</dt>
  <dd class="col">25</dd>
</dl>
<dl class="row">
  <dt class="col">Username</dt>
  <dd class="col">Bob</dd>
</dl> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-14T14:16:58.840

我认为表格最适合用于表格数据，看起来你在那里。

如果您不想使用表格，最好的办法是使用定义列表（`<dl> and <dt>`）。以下是如何将它们设置为看起来像您的旧`<td>`布局。 [http://maxdesign.com.au/articles/definition/](http://maxdesign.com.au/articles/definition/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-14T14:31:51.440

将表格用于似乎是表格数据的数据是完全合理的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-14T14:36:19.790

如果我正在写一个表格，我通常使用这个：

```
<form ... class="editing">
    <div class="field">
        <label>Label</label>
        <span class="edit"><input type="text" value="Value" ... /></span>
        <span class="view">Value</span>
    </div>
    ...
</form> 
```

然后在我的CSS中：

```
.editing .view, .viewing .edit { display: none }
.editing .edit, .editing .view { display: inline } 
```

然后使用一点 JavaScript，我可以将表单的类从编辑切换到查看。

我提到这种方法是因为您想以几乎相同的布局显示和编辑数据，这是一种方法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-15T13:08:48.807

像 macbirdie 一样，我倾向于将这样的数据标记为定义列表，除非现有表的内容可以被判断为实际上*是*表格内容。

我会避免以您建议的方式使用标签标签。看看标签标签的解释@ [https://developer.mozilla.org/en-US/docs/Web/HTML/Element/label](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/label) - 它真的是为了让你专注于它的相关控制。还要避免使用通用 div 和 span，因为从语义的角度来看它们很弱。

如果您在一个屏幕上显示多个名称-值对，但在编辑屏幕上只编辑一个，我会在前一个屏幕上使用一个表格，在后一个屏幕上使用一个定义列表。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-14T14:21:28.173

使用 float: 属性 例如：css:

```
.left {
  float:left;
  padding-right:20px
} 
```

html:

```
<div class="left">
 Name<br/>
 AnotherName
</div>
<div>
 Value<br />
 AnotherValue
</div> 
```

# .net - 滚动你自己的消息循环，有什么陷阱吗？

> ID：61366
> 
> 赞同：2
> 
> 时间：2008-09-14T14:23:15.830
> 
> 标签：.net, winforms

[这个问题与这个关于异常处理](https://stackoverflow.com/questions/61354/how-to-get-entire-chain-of-exceptions-in-applicationthreadexception-event-handl)的问题略有相关。我在那里找到的解决方法包括滚动我自己的消息循环。

所以我的 Main 方法现在看起来基本上是这样的：

```
[STAThread]
static void Main() {
  // this is needed so there'll actually an exception be thrown by
  // Application.Run/Application.DoEvents, instead of the ThreadException
  // event being raised.
  Application.SetUnhandledExceptionMode(UnhandledExceptionMode.ThrowException);

  Application.EnableVisualStyles();
  Application.SetCompatibleTextRenderingDefault(false);

  Form form = new MainForm();
  form.Show();

  // the loop is here to keep app running if non-fatal exception is caught.
  do {
    try {
      Application.DoEvents();
      Thread.Sleep(100);
    }
    catch (Exception ex) {
      ExceptionHandler.ConsumeException(ex);
    }
  }
  while (!form.IsDisposed);
} 
```

不过，我想知道的是，**这是一种替代更典型的“Application.Run(new MainForm());”的安全/体面的方法吗？**，无论是用于异常处理还是其他任何用途，还是我应该始终坚持使用 Application.Run？

在另一个正在测试的应用程序上，加载（启动画面）和异常处理都使用了类似的方法，我认为它没有造成任何麻烦（但是:-)）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T14:51:21.243

如果您想自定义消息处理，请考虑实现 IMessageFilter，然后调用 Application.AddMessageFilter 以告诉标准消息泵调用您的过滤器函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-14T14:59:48.097

陷阱1：

```
Thread.Sleep(100); 
```

绝不。使用 WaitMessage()。

否则，有可能推出您自己的消息循环，但在您的场景中，这似乎有点毫无意义。

您可能还想检查 Application.Run() 代码（例如，使用 .Net Reflector）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T15:42:54.437

是的...我认为某些组件不适用于该代码。他们中的一些人需要生活在一个包含 Application.Run 的线程中才能有效地接收他们的消息。

# javascript - 如何在 onClick 事件中创建循环？

> ID：61372
> 
> 赞同：3
> 
> 时间：2008-09-14T14:26:50.610
> 
> 标签：javascript, ruby-on-rails, ruby, ajax, loops

我想编写一个`onClick`多次提交表单的事件，遍历多选字段中的选定项目，每个提交一次。

**如何编码循环？**

我正在使用 Ruby on Rails 并`remote_function()`用于为 ajax 调用生成 JavaScript。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-14T14:43:44.203

我的快速回答（因为我还没有编写代码）是创建另一个函数，该函数使用 XMLHTTPRequest 和单个调用的特定参数创建一个 POST。然后在你的 onClick() 处理程序中调用该函数，因为你循环通过你选择的项目。

我建议你只使用一个虚拟的 HTML 页面和 javascript 来做一个概念证明，然后尝试弄清楚如何让它在 RoR 中工作。

另外，您为什么要尝试从浏览器进行多次调用，而不是在 RoR 控制器中处理循环条件？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-14T21:06:36.687

您必须手动编写一些 javascript。Rails 的生成器不会为您做如此复杂的事情。

不过，Prototype.js 将为您完成几乎所有繁重的工作。在我的脑海中，代码看起来像这样：（未测试）

```
<%= javascript_include_tag 'prototype' %>

<form id="my-form">
  <input type="text" name="username" />

  <select multiple="true" id="select-box">
    <option value="1">First</option>
    <option value="2">Second</option>
    <option value="3">Third</option>
    <option value="4">Fourth</option>
  </select>
</form>

<script type="text/javascript" language="javascript">
submitFormMultipleTimes = function() {
  $F('select-box').each(function(selectedItemValue){
    new Ajax.Request('/somewhere?val='+selectedItemValue, 
      {method: 'POST', postBody: Form.serialize('my-form')});
  });
}
</script>

<a href="#" onclick="submitFormMultipleTimes(); return false;">Clicky Clicky</a> 
```

笔记：

*   使用 Prototype 的`$F()`方法获取选中项的值。它返回一个用于多选框的数组

*   用于将`Ajax.Request`数据作为`POST`.
    对服务器来说，这看起来和提交一个普通的表单完全一样

*   用于从表单`Form.serialize`中获取数据并将其粘贴到请求的正文中。
    如果您正常提交表单，这与发送的数据完全相同

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T01:39:58.727

除非您正在修改浏览器 DOM，否则我想不出您想要这样做的理由。（但是在不完全了解您要做什么的情况下，在这种情况下我可能是错的=）

您应该能够在一个 POST 中从多个对象（甚至是表单中嵌套的复杂对象）发回数据。

与您想出的任何 javascript 相比，rails 代码可能会更简单、更容易编写（并且更容易调试！）。

如果您需要根据用户选择的内容更新页面的不同部分，您仍然可以通过 RJS 在您的 render :update 块中对 DOM 进行多次更新，所以这应该不是问题。

您还将获得仅一个服务器往返的（大）好处，而不是使用多个 POST 所需的多次旅行。

# ruby-on-rails - Ruby on Rails 有没有好的管理生成器？

> ID：61383
> 
> 赞同：36
> 
> 时间：2008-09-14T14:41:11.557
> 
> 标签：ruby-on-rails, ruby

我目前的项目是在 Rails 中。来自 Symfony (PHP) 和 Django (Python) 背景，他们都有优秀的管理生成器。似乎在 Rails 中缺少这一点。

对于那些不熟悉 Symfony 或 Django 的人，它们都允许您在模型周围指定一些元数据，以自动（动态）生成管理界面来执行常见的 CRUD 操作。只需几个命令或几行代码，您就可以创建一个完整的 Intranet。它们外观漂亮，可扩展性足以满足 99% 的管理员需求。

我一直在为 Rails 寻找类似的东西，但所有项目要么没有活动，要么早就死了。除了脚手架之外，还有什么可以为 Rails 应用程序生成 Intranet/admin 站点吗？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2011-05-16T08:12:44.077

**Active Admin** ( [http://activeadmin.info/](http://activeadmin.info/) ) 于 2011 年 5 月发布，看起来它将成为最好的 Rails 3 选项。

![特征](https://i.stack.imgur.com/mtjrr.png)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2011-01-18T16:34:26.063

[rails_admin](https://github.com/sferik/rails_admin)似乎是截至 2011 年 1 月的最新最好的免费项目。

...最重要的是，存储库中有很多活动。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-14T15:34:17.873

脚手架是创建管理后端的常规方法，但是有一个名为[ActiveScaffold](http://www.activescaffold.com/)的项目可以解决您的问题。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-01-26T08:06:16.343

[以下](http://www.ultrasaurus.com/sarahblog/2009/07/rails-admin-interface-roundup/)是一些选项的汇总，不仅包括 ActiveScaffold。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-02-18T08:44:02.030

ActiveScaffold 适用于 Rails 2.3.x :) 仅适用于一年后像我一样发现此问题的某人的信息 :)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-10-01T18:34:33.873

ActiveScaffold 是一个很好的解决方案，但是如果你想要一个更可配置和更强大的工具，我认为 Typus 是一个很好的解决方案：http: [//github.com/fesplugas/typus](http://github.com/fesplugas/typus)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T12:45:09.707

你主要有两个：

*   [ActiveScaffolding](http://www.activescaffold.com/) : 最流行但[要小心使用 rails 2.1](http://www.concept47.com/austin_web_developer_blog/ruby-on-rails/current-active-scaffold-rails-plugin-111-not-compatible-with-rails-21/)
*   [流线型](http://streamlinedframework.org/)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-16T04:56:32.163

ActiveScaffold 是目前为止最可配置/最容易集成/最自动化的脚手架。它内置了 ajax 支持，近乎无缝的数据库自省，甚至可以很好地与遗留的 Oracle 数据库（这在 Rails 中可能是一个真正的痛苦）配合使用。

试试看：[http ://activescaffold.com/](http://activescaffold.com/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-10-17T10:15:11.877

看看酪蛋白 ( [http://www.caseincms.com/](http://www.caseincms.com/) )，可能就是您要找的东西。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-11-29T03:34:35.873

周末还尝试了 typus、caseincms 和 ActiveScaffold，我对[admin_data 赞不绝口](https://github.com/neerajdotname/admin_data)。这是

*   安装超级快（Rails 3 是 gem，Rails 2.3 是一个插件分支，无需在 github 上挖掘树），
*   非侵入式（所有代码都在 vendor/admin_data 文件夹或它所属的 gem 中），
*   无需设置，可选配置是应用程序中的一个文件中的一个块，
*   正确（！）从您的模型定义（primary_key、foreign_key、关系等）中获取所有模型信息，
*   包括多个数据库，通过 activerecord-sqlserver-adapter 的 SQL Server 连接，甚至[复合主键](http://compositekeys.rubyforge.org/)，因为一切都在 ActiveRecord 之上抽象，如果你的模型工作，admin_data 将工作，
*   出于上述原因，可以很好地处理遗留数据，
*   使用您现有的身份验证解决方案，该解决方案在您的配置文件中被称为最美妙的 DRYness。它可能不如其他解决方案灵活或漂亮，但这个插件做了很多事情来快速设置管理面板。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T12:40:02.247

创建 CRUD 接口最常用的方法是使用 Scaffold。

```
./script/generate scaffold_resource MyModel property:type property2:type2 
```

此命令将为名为 MyModel（单数）的模型生成一个具有两个属性的 CRUD 接口。属性是 DB 术语中的列。所以你可以有 name:string age:integer active:boolean 等。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-06-12T09:36:31.460

我可以建议你`active_admin`这是最好的

[活动管理员主站点](http://activeadmin.info/)

# wpf - 需要知道混合吗？

> ID：61386
> 
> 赞同：9
> 
> 时间：2008-09-14T14:50:10.757
> 
> 标签：wpf, xaml, expression-blend

您希望您的 WPF 开发人员了解表达式混合吗？

有什么好的资源来了解更多关于 Blend 的信息吗？

[更新] 了解混合会让你更有效率吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-15T12:51:34.683

我发现 Blend 是一种轻松融入 XAML 的好方法。您想做的许多常见事情在 Blend 中都很容易，尤其是数据绑定。数据绑定没有智能感知，我发现在 Blend 中做事是发现如何编写数据绑定语法的好方法。

我现在发现自己主要编辑原始 XAML 购买手。

混合非常方便的领域：

*   自定义模板。
*   动画片
*   将 UI 分解为用户控件

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-15T15:24:32.943

作为一名 WPF 开发人员，我肯定看到了解 Expression Blend 对我以前的许多项目的好处。这有助于我非常有效地开始创建用户控件和自定义控件。如果我们以传统的方式从头开始编写 XAML，那么您的开发将花费很长时间。并且还用于创建 DataTemplate、ControlTemplate、Styles 和 ItemsPanelTemplate - 在 Expression blend 中只需单击一下即可。所以**我强烈推荐给 WPF 程序员的 Expression blend**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T18:58:07.313

在进行 WPF 开发时，我通常同时使用 blend 和 Visual Studio (2005)。（虽然，当然，我通常同时进行设计和 C# 编码）。

使用 Blend 的好处是某些任务在那里非常快 - 例如选择颜色/画笔、创建动画和布局修复（例如调整边距/填充）。

另一种用法是在不实际启动应用程序的情况下立即查看您手写的 XAML 的外观。

Blend 有产生一些奇怪的 XAML 的坏习惯，所以之后我总是必须在 VS 文本编辑器中清理它。不过，我仍然发现使用混合是一种净赢。

那么，回答您的问题：是否需要 Blend？不，不是。但它会让你的生活更轻松地完成某些任务，从而提高你的工作效率。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T20:32:04.997

像动画和渐变颜色定义这样的事情真的只能在 Blend 中有效地完成。Blend 对于生成一些重要的自定义视觉元素通常也非常有用，这样您就可以查看生成的 Xaml 并将 CLEANER 版本导入到您的生产代码中。不幸的是，Blend 的点击性质掩盖了这样一个事实，即在后台生成了大量非常混乱的 Xaml，您需要在将其用于生产源之前重构该 Xaml。幸运的是，学习 Blend 并不难。我发现的最好的教程被称为“Fabrikam”教程。可能有可用的更新版本，但该教程的一个版本仍可在下面的链接中找到。

[http://blogs.msdn.com/expression/articles/516589.aspx](http://blogs.msdn.com/expression/articles/516589.aspx)

实际上，很少有开发人员。商店可以接触到合格的“交互式设计师”（这不是公司可以重新分配一名初级 Mar-Com 人员来执行的事情），这意味着，在大多数地方，如果营销，开发人员将需要学习一些 Blend想要添加一种花哨的视觉效果，这些视觉效果首先为使用 WPF 提供了很多理由。

作为一名开发人员，在深入使用 WPF 几个月后，您会发现自己完全可以直接编辑 Xaml，而且与 Windows 窗体不同，您很少依赖 VStudio 设计器中的功能。直接编辑不仅比滚动浏览属性列表快得多，而且 VStudio 不支持您将在生产 WPF 应用程序中使用的许多功能（他们只是想在 SP 中添加“事件”选项卡） #1）。Blend 对许多这些项目有更多的支持（例如，它可以生成一个 DataTemplate），但我通常只跳转到 Blend 来创建快速动画或其他视觉效果，将经过仔细重构的标记版本剪切并粘贴到我的“官方”VStudio 项目源，继续。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-14T14:54:28.030

我认为至少设计师应该开始使用 Expression Suite。开发人员应该稍微熟悉这些工具，但足以使他们能够更好地与设计人员沟通。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-14T14:56:45.920

由于没有那么多好的 WPF 工具，了解 Blend 是一项非常有用的技能。但是我不会将其视为*要求*。WPF 的整个想法是在编码人员和设计人员之间分配工作。IMO 开发人员不需要始终了解 Blend，但需要具备基本技能才能了解设计师的需求。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-14T14:56:13.020

表情融合的视频训练：

*   [总训练表达混合](http://www.totaltraining.com/prod/microsoft/expression.asp?utm_source=msft&utm_medium=inbox_dvd&utm_campaign=expression2)
*   [http://expression.microsoft.com/en-us/cc136536.aspx](http://expression.microsoft.com/en-us/cc136536.aspx)
*   [http://windowsclient.net/learn/videos_wpf.aspx](http://windowsclient.net/learn/videos_wpf.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T21:46:01.717

我（作为开发人员，而不是设计师，soo 不是设计师）尝试通过 Blend 开始学习 WPF。虽然我可以让东西正常工作，但回头看我制作的东西让我不寒而栗。
既然我对 WPF 的使用方式非常了解，我仍然不时使用 Blend 和 Design，但我的工作基于 XAML（请注意，不是 VS 中的设计器视图，而是 XAML）。换句话说，
我现在知道如何清理它了。

我仍然想知道如何让我的 Adob​​e-Flash、-Photoshop、-Illustrator 设计大师在 WPF 中与我一起工作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T12:36:47.207

这完全取决于你想做什么。要回答您的第二个问题，您真的想尝试在 Blend 之外编辑动画故事板吗？如果您正在使用应用程序的实际视觉效果，Blend 最适合于此。如果你想破解数据绑定、验证和其他必须与代码来回交换的事情。显然，在 Visual Studio 中处理 XAML 更有意义。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-25T08:46:13.557

Lynda.com 在线提供了一些很酷的表情混合训练......

Lee Brimelow[的 Expression Blend 入门](http://movielibrary.lynda.com/html/modPage.asp?ID=384)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-14T15:17:01.923

开发人员根本**不需要**了解 Expression。

您**需要**知道的是 XAML，而不是隐藏在某些工具后面，这将是您作为 WPF 开发人员所能做的最糟糕的事情。您选择的工具由您决定。我曾经在 Visual Studio 中使用 XML 编辑器。

唯一**需要**了解 Blend 的人是负责 WPF 应用程序的视觉方面的人。他们必须能够理解如何使用模板为您的应用程序设置皮肤，但除此之外，他们还可以保持独占性。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-14T15:26:37.393

一般来说，我认为让开发人员了解 XAML 更为重要，因为 Blend 只是它之上的一个视图。XAMLPad 在第一个实例中可能对学习 XAML 更有用。

不过，更具体地说，对于这个问题，我认为如果开发人员与使用 Blend 的设计师一起工作，那么至少了解基础知识可能会非常有用。除了允许更好的通信（正如@kokos 所提到的），它还将让开发人员在相同的环境中执行小的编辑（例如对齐等），并且还可以了解该工具在代码生成方面的限制和边界.

从历史上看，设计器工具有一些开发人员必须解决的怪癖，例如在 FrontPage 中重新编码 HTML，或者生成字体标签而不是使用样式或类。我确信 Blend 不会做这样的事情，但它可能会生成开发人员更愿意重组或精简的 XAML，因此了解哪些功能生成哪些样式的代码对开发人员来说非常方便。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-16T15:01:15.113

布伦农威廉姆斯的新书也应该不错！！！

[![替代文字](https://i.stack.imgur.com/SnB4X.jpg)](https://i.stack.imgur.com/SnB4X.jpg)
[（来源：[pearsoned-ema.com](http://images.pearsoned-ema.com/jpeg/large/9780672329319.jpg)）]

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-18T17:43:56.983

您是否要求您的 HTML 开发人员使用 DreamWeaver？

所有优秀的 WPF 编码人员都应该了解 XAML，并且只使用 Blend 之类的工具进行快速模型、制作动画或补间或制作复杂的渐变等。

手工编码 XAML 是优秀 WPF 开发人员的要求 - Blend 是一种工具，而不是了解 XAML 的替代品。

# accessibility - 增强视障者的网络用户体验

> ID：61399
> 
> 赞同：6
> 
> 时间：2008-09-14T15:18:32.373
> 
> 标签：accessibility, section508

我正在听[最近一集 Hanselminutes](http://www.hanselminutes.com/default.aspx?showID=143)，Scott Hanselman 正在讨论 Web 应用程序中的可访问性，这让我想到了我自己的应用程序中的可访问性。

我们都了解语义标记在我们的 Web 应用程序中的重要性，因为它与可访问性有关，但是可以进行其他简单的增强以改善残疾用户的用户体验呢？

在这一集中，有好几次我拍拍我的额头说：“当然！我为什么不这样做？” 特别是，斯科特谈到了一个网站，该网站在网页顶部放置了一个隐藏链接，上面写着“跳到主要内容”。该链接仅对使用屏幕阅读器的人可见，并且允许他们的屏幕阅读器跳过菜单和其他次要内容。这是一个如此明显的改进，但很容易不去想它。

可访问性和整体用户体验不仅仅是简单地创建有效的 XHTML 并称之为一天。

您有哪些简单的技巧可以改善视障者的用户体验？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T14:14:45.560

如果您从未做过，那么创建可访问的页面是一件很难想象的事情。但是，一旦您了解了基本概念，95% 的情况下就很容易做到。我将主要重复其他人所说的话，但是：

1.  仅将表格用于表格数据
2.  确保您使用通过 HTML 提供给您的语义工具。这意味着将 TH 与范围属性一起使用。使用 <em> 代替 <i> 和 <strong> 代替 <b>。使用**首字母缩写词**和**缩写**标签。使用定义列表。如果有人愿意，我可以扩展这些内容。
3.  最重要的事情之一是在输入字段上使用**标签标签。**对于每个输入字段、单选按钮、复选框和文本输入，您应该拥有：

    <label for="username">用户名：</label><input name="username" />

4.  根据大块文本的位置添加“跳过导航”或“跳到导航”。如果您在政府网站上工作，这应该是您创建的所有内容都允许您跳过重复信息的第二天性。

5.  不要使用颜色来强调。

6.  确保所有文本都可以调整大小。这几乎意味着不要在你的 CSS 中使用“px”。

7.  我将再次强调这一点：*创建语义页面。*为您的标题使用**H**标签。使用**ul** / **li**进行导航。

8.  *在所有*图像上使用**alt**属性。如果你有一个间隔 gif ......好吧......不要。否则，请解释图片是什么以及它对相关内容的意义。不要使用“图表”作为您的 alt 标签。使用“YTD 财务图表：第一季度 5,000 美元、第二季度 4,000 美元、第三季度 8,000 美元”或类似内容。

**   为所有音频和视频组件提供隐藏式字幕或成绩单* 

 *这里的关键是为有视觉、听觉和*运动*障碍的人提供与具有标准身体能力的人相同的体验。如果您无法进入某个字段，那么屏幕阅读器也不能。如果您无法单击复选框旁边的文本以将其选中，则屏幕阅读器不知道该文本与复选框相关。

您应该经常查看没有样式表的站点（如果您有 Firefox 和[Web Developer Toolbar](https://addons.mozilla.org/en-US/firefox/addon/60) ，请按 ctrl-shift-s ）来查看页面是否有意义。如果这对视力正常的人来说没有意义，那么对于使用屏幕阅读器的人来说也没有意义。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-19T03:27:36.157

看看[獠牙](http://www.standards-schmandards.com/index.php?show/fangs)

[Fangs](http://www.standards-schmandards.com/index.php?show/fangs)是 Firefox 的浏览器内工具，它模拟屏幕阅读器在访问网页时“看到”的内容。它的功能很简单：在访问网页时输出屏幕阅读器将向用户读出的内容的副本。这是一个有用的工具，可以快速分析您是否有效地构建了内容，以便视力受损的人可以理解和使用它，而不会强迫您学习使用（和购买）屏幕阅读器应用程序，例如 JAWS 或 Windows Eyes。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T19:31:30.063

自从我从事必须遵守第 508 条的工作以来已经有一段时间了，但这是我记得的其他海报没有涉及的内容……

1.  仅将表格用于数据。如果可以避免，请不要使用表格进行布局。
2.  当使用数据表时，你的列标题应该嵌套在 TH 标签中，你应该使用 title 和 scope 属性。您的表格标签应使用摘要属性。
3.  图像都应该具有描述图像中发生的事情的 alt 属性的值，如果图像没有任何用途（它是 shim 图像或类似的东西），则 alt 属性应该设置为空字符串。
4.  尝试使用文本到语音阅读器和/或仅通过键盘导航和/或关闭样式表。我相信您需要购买 JAWS，但我敢肯定那里有免费的屏幕阅读器。您需要通过屏幕阅读器体验网站，才能真正了解在没有屏幕阅读器解释的提示的情况下浏览大多数网页的难度。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-14T15:56:01.130

“视力受损”包括色盲。我曾经和一个不能很好地区分红绿的人一起工作，所以任何使用红绿灯风格界面的应用程序对他来说都很难使用。在我们工作的行业中，行中的警报是用颜色编码的，因此另一种形式的显示对他很有用，例如在行中有一个额外的列，其中包含警报类型的文本（“紧急”、“警告”等）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-14T15:23:41.097

屏幕阅读器的最大问题通常是在页面上放置内容的表格。屏幕阅读器无法真正处理这些。将内容放在 html 中的 div 中，并按合理的顺序排列。然后用css将div放在你的页面上。使用表格来显示应该在表格中的内容。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-14T15:57:26.740

许多网页的代码结构如下：

1.  标题
2.  顶部导航
3.  左侧导航
4.  内容
5.  页脚

以这种方式构建时，“跳到主要内容”的隐藏链接是有益的。但是，使用 CSS 布局，您可以重新排序，以便您拥有：

1.  内容
2.  标题
3.  顶部导航
4.  左侧导航
5.  页脚

然后，您使用 CSS 定位和浮动在屏幕上移动这些不同的元素，使页面看起来像您想要的那样。

以这种方式构建网页的主要优点是，如果浏览器不支持 CSS，则内容首先出现在页面上。除了屏幕阅读器，这对移动设备和搜索引擎蜘蛛也有好处。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-14T16:22:11.423

对于部分视力不佳的人，我们需要确保文本不会过小并且与背景颜色形成显着对比。我们还应该通过使用诸如*em之类的相对大小单位而不是诸如**px*之类的绝对单位来确保文本可调整大小（尽管在我看来，随着浏览器越来越倾向于放大文本大小调整，这已不再是一个问题） .

对于屏幕阅读器的用户来说，了解屏幕阅读器的实际使用方式会很有帮助。以下文章基于对使用屏幕阅读器浏览网页的盲人的观察提出了指导方针；它现在有点过时了，但让您很好地了解什么会帮助屏幕阅读器用户，什么不会：

[http://redish.net/content/papers/interactions.html](http://redish.net/content/papers/interactions.html)

此外，美国盲人基金会在[其网站上有一个部分专门为网络开发人员提供有关如何满足视力受损用户的建议](http://www.afb.org/Section.asp?SectionID=57&TopicID=167)。

除了视力障碍者之外，我们还需要考虑那些阻止他们使用鼠标的残疾人，以及那些有神经障碍的人。如果有人可以提供有关如何满足这些人的建议的资源，那就太好了。

# unit-testing - 什么是好的单元测试？

> ID：61400
> 
> 赞同：97
> 
> 时间：2008-09-14T15:20:44.583
> 
> 标签：unit-testing, language-agnostic, tdd, integration-testing, testing-strategies

我敢肯定，你们中的大多数人都在编写大量自动化测试，并且在单元测试时也遇到了一些常见的陷阱。

我的问题是您是否遵循任何编写测试的行为规则以避免将来出现问题？更具体地说：**好的单元测试的属性是**什么，或者你如何编写测试？

鼓励语言无关的建议。

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2008-09-15T04:50:59.003

让我从插入源代码开始 -[使用 JUnit 在 Java 中进行实用单元测试](http://pragprog.com/titles/utj/pragmatic-unit-testing-in-java-with-junit)（也有一个带有 C#-Nunit 的版本.. 但我有这个.. 它在大多数情况下是不可知的。推荐。）

好的测试应该是**一次**旅行（首字母缩略词不够粘——我在书中有一份备忘单的打印输出，我必须拿出来确保我做对了……）

*   **自动**：调用测试以及检查 PASS/FAIL 的结果应该是自动的
*   **彻底**：覆盖；尽管错误倾向于聚集在代码中的某些区域周围，但请确保测试所有关键路径和场景。如果必须了解未测试区域，请使用工具
*   **可重复**：每次测试都应该产生相同的结果。测试不应依赖于不可控的参数。
*   **独立**：非常重要。
    *   测试应该**一次只测试一件事**。多个断言是可以的，只要它们都在测试一个特性/行为。当测试失败时，它应该查明问题的位置。
    *   测试**不应该相互依赖**——隔离。没有关于测试执行顺序的假设。通过适当地使用 setup/teardown 确保在每次测试之前“清白”
*   **专业**：从长远来看，您将拥有与生产一样多的测试代码（如果不是更多的话），因此对您的测试代码遵循相同的良好设计标准。精心设计的方法类——具有揭示意图的名称、无重复、具有好名称的测试等。

*   好的测试也运行**得很快**。任何需要超过半秒才能运行的测试......需要进行处理。测试套件运行的时间越长……运行的频率就越低。开发人员将尝试在运行之间进行的更改越多..如果有任何问题..找出哪个更改是罪魁祸首将需要更长的时间。

2010-08 更新：

*   **可读性**：这可以被认为是专业的一部分 - 但是它不能被强调得足够多。一个严峻的测试是找到一个不属于你的团队的人，并要求他/她在几分钟内找出被测试的行为。测试需要像生产代码一样维护——所以即使需要更多的努力也要让它易于阅读。测试应该是对称的（遵循一种模式）和简洁的（一次测试一个行为）。使用一致的命名约定（例如 TestDox 风格）。避免因“附带细节”而使测试变得混乱……成为极简主义者。

除了这些之外，大多数其他指南都是减少低收益工作的指南：例如“不要测试您不拥有的代码”（例如第三方 DLL）。不要去测试 getter 和 setter。密切关注成本效益比或缺陷概率。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-09-14T15:36:26.730

1.  **不要编写庞大的测试。**正如“单元测试”中的“单元”所暗示的那样，使每一个都尽可能*原子*和*孤立*。如果必须，请使用模拟对象创建先决条件，而不是手动重新创建过多的典型用户环境。
2.  **不要测试明显有效的东西。**避免测试来自第三方供应商的类，尤其是提供您编码的框架的核心 API 的类。例如，不要测试将项目添加到供应商的 Hashtable 类。
3.  **考虑使用**诸如 NCover 之类的代码覆盖率工具来帮助发现您尚未测试的边缘情况。
4.  ***尝试在实施之前*编写测试。**将测试更多地视为您的实现将遵守的规范。参照。还有行为驱动开发，测试驱动开发的一个更具体的分支。
5.  **始终如一。**如果您只为某些代码编写测试，那么它几乎没有用处。如果您在一个团队中工作，而其他一些人或全部人不编写测试，那么它也不是很有用。让自己和其他人相信测试的重要性（以及*节省时间的*特性），或者不要打扰。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2009-05-06T20:18:37.007

这里的大多数答案似乎都是针对一般的单元测试最佳实践（何时、何地、为什么和什么），而不是实际编写测试本身（如何）。由于这个问题在“如何”部分似乎非常具体，我想我会发布这个，取自我在公司进行的“棕色袋子”演示。

## **Womp 的 5 条写作测试法则：**

* * *

**1\. 使用长的、描述性的测试方法名称。**

```
 - Map_DefaultConstructorShouldCreateEmptyGisMap()
   - ShouldAlwaysDelegateXMLCorrectlyToTheCustomHandlers()
   - Dog_Object_Should_Eat_Homework_Object_When_Hungry() 
```

**[2\. 以Arrange/Act/Assert 风格](http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/07/24/arrange-act-assert-and-bdd-specifications.aspx)编写测试。**

*   虽然这种组织战略已经存在了一段时间并且有很多东西，但最近引入“AAA”首字母缩略词是一种很好的方式来传达这一点。使您的所有测试都符合 AAA 风格，使它们易于阅读和维护。

**3\. 始终在您的断言中提供失败消息。**

```
Assert.That(x == 2 && y == 2, "An incorrect number of begin/end element 
processing events was raised by the XElementSerializer"); 
```

*   一个简单但有益的做法，它可以在您的运行程序应用程序中清楚地显示失败的原因。如果您不提供消息，您通常会在失败输出中得到类似“预期为真，为假”之类的信息，这使您必须实际阅读测试以找出问题所在。

**4\. 评论测试的原因**——业务假设是什么？

```
 /// A layer cannot be constructed with a null gisLayer, as every function 
  /// in the Layer class assumes that a valid gisLayer is present.
  [Test]
  public void ShouldNotAllowConstructionWithANullGisLayer()
  {
  } 
```

*   这可能看起来很明显，但这种做法将保护您的测试的完整性，防止那些一开始不了解测试背后原因的人。我已经看到许多测试被删除或修改，这些测试非常好，仅仅是因为这个人不理解测试正在验证的假设。
*   如果测试是微不足道的或方法名称具有足够的描述性，则可以关闭注释。

**5\. 每个测试都必须总是恢复它接触到的任何资源的状态**

*   尽可能使用模拟来避免处理真实资源。
*   清理必须在测试级别完成。测试不得依赖于执行顺序。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-09-14T15:31:22.937

牢记这些目标（改编自 Meszaros 的《xUnit 测试模式》一书）

*   测试应该降低风险，而不是引入风险。
*   测试应该易于运行。
*   随着系统围绕它们发展，测试应该易于维护

一些使这更容易的事情：

*   测试应该只因为一个原因而失败。
*   测试应该只测试一件事
*   最小化测试依赖（不依赖于数据库、文件、用户界面等）

不要忘记您也可以使用 xUnit 框架进行集成测试，**但将集成测试和单元测试分开**

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-14T16:22:22.703

**优秀单元测试的一些属性：**

*   当测试失败时，问题出在哪里应该立即显而易见。如果您必须使用调试器来跟踪问题，那么您的测试不够精细。每个测试只有一个断言在这里有帮助。

*   重构时，任何测试都不应该失败。

*   测试应该运行得如此之快，以至于您毫不犹豫地运行它们。

*   所有测试都应始终通过；没有不确定的结果。

*   单元测试应该考虑周全，就像您的生产代码一样。

@Alotor：如果您建议库应该只在其外部 API 上进行单元测试，我不同意。我想要对每个类进行单元测试，包括我不向外部调用者公开的类。（但是，[如果我觉得需要为私有方法编写测试，那么我需要重构。](https://stackoverflow.com/questions/34571/whats-the-best-way-of-unit-testing-private-methods#52054)）

* * *

编辑：有一条关于“每个测试一个断言”引起的重复的评论。具体来说，如果您有一些代码来设置场景，然后想要对其进行多个断言，但每个测试只有一个断言，您可能会在多个测试中重复设置。

我不采用这种方法。相反，我使用*每个场景*的测试装置。这是一个粗略的例子：

```
[TestFixture]
public class StackTests
{
    [TestFixture]
    public class EmptyTests
    {
        Stack<int> _stack;

        [TestSetup]
        public void TestSetup()
        {
            _stack = new Stack<int>();
        }

        [TestMethod]
        [ExpectedException (typeof(Exception))]
        public void PopFails()
        {
            _stack.Pop();
        }

        [TestMethod]
        public void IsEmpty()
        {
            Assert(_stack.IsEmpty());
        }
    }

    [TestFixture]
    public class PushedOneTests
    {
        Stack<int> _stack;

        [TestSetup]
        public void TestSetup()
        {
            _stack = new Stack<int>();
            _stack.Push(7);
        }

        // Tests for one item on the stack...
    }
} 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-14T16:51:14.133

测试应该被隔离。一项测试不应依赖于另一项测试。更进一步，测试不应该依赖于外部系统。换句话说，测试*您的*代码，而不是您的代码所依赖的代码。您可以将这些交互作为集成或功能测试的一部分进行测试。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-14T15:37:52.857

你所追求的是描述被测类的行为。

1.  验证预期行为。
2.  验证错误案例。
3.  覆盖类内的所有代码路径。
4.  执行类中的所有成员函数。

基本意图是增加您对班级行为的信心。

这在重构代码时特别有用。Martin Fowler在他的网站上有一篇关于测试的有趣[文章。](http://martinfowler.com/distributedComputing/duckling.pdf)

HTH。

干杯，

抢

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-09-14T15:38:02.327

测试最初应该失败。然后你应该编写使它们通过的代码，否则你会冒着编写一个有错误但总是通过的测试的风险。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-15T11:23:57.903

[我喜欢前面提到的实用单元测试](http://www.pragprog.com/titles/utc2/pragmatic-unit-testing-in-c-with-nunit)书中的 Right BICEP 首字母缩写词：

*   **对：结果**对****吗**？**
***   **B**：所有的**边界**条件都正确吗？*   **我**：我们可以检查**反向**关系吗？*   **C** : 我们可以用其他方式交叉检查结果吗**？***   **E** : 我们可以强制**错误**条件发生吗？*   **P**：性能特征是否在**界限**内？**

 **就我个人而言，我觉得你可以通过检查你得到正确的结果（1+1 应该在加法函数中返回 2），尝试你能想到的所有边界条件（例如使用两个数字的和大于 add 函数中的整数最大值）并强制错误条件，例如网络故障。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-04-24T18:46:27.967

**好的测试需要可维护。**

我还没有完全弄清楚如何在复杂的环境中做到这一点。

当您的代码库开始达到数百或数百万行代码时，所有教科书都开始脱节。

*   团队互动爆炸式增长
*   测试用例数量激增
*   组件之间的交互爆炸。
*   构建所有单元测试的时间成为构建时间的重要组成部分
*   API 更改可能会波及数百个测试用例。即使生产代码更改很容易。
*   将进程排序到正确状态所需的事件数量增加，这反过来又增加了测试执行时间。

好的架构可以控制一些交互爆炸，但随着系统变得越来越复杂，自动化测试系统不可避免地会随之增长。

这是您开始必须权衡取舍的地方：

*   只测试外部 API，否则重构内部会导致大量的测试用例返工。
*   随着封装子系统保留更多状态，每个测试的设置和拆卸变得更加复杂。
*   每晚编译和自动化测试执行会增长到几个小时。
*   增加的编译和执行时间意味着设计人员不会或不会运行所有测试
*   为了减少测试执行时间，您考虑对测试进行排序以减少设置和拆卸

您还需要决定：

您将测试用例存储在代码库的什么位置？

*   你如何记录你的测试用例？
*   测试夹具可以重复使用以节省测试用例维护吗？
*   当夜间测试用例执行失败时会发生什么？谁进行分流？
*   你如何维护模拟对象？如果您有 20 个模块都使用自己风格的模拟日志 API，那么更改 API 会很快产生影响。不仅测试用例发生了变化，而且 20 个模拟对象也发生了变化。这 20 个模块是由许多不同的团队花费数年时间编写的。这是一个经典的重用问题。
*   个人及其团队了解自动化测试的价值，他们只是不喜欢其他团队的做法。:-)

我可以永远继续下去，但我的观点是：

**测试需要可维护。**

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-28T19:35:18.313

不久前，我在[这篇 MSDN 杂志文章](http://msdn.microsoft.com/en-us/magazine/cc163665.aspx)中介绍了这些原则，我认为这对任何开发人员都很重要。

我定义“好”单元测试的方式是它们是否具有以下三个属性：

*   它们是可读的（命名、断言、变量、长度、复杂性..）
*   它们是可维护的（没有逻辑，没有过度指定，基于状态，重构......）
*   他们是值得信赖的（测试正确的东西，隔离，​​而不是集成测试..）

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-14T15:40:17.250

*   单元测试只是测试你单元的外部 API，你不应该测试内部行为。
*   TestCase 的每个测试都应该测试这个 API 中的一个（并且只有一个）方法。
    *   对于失败案例，应该包括额外的测试案例。
*   测试你的测试覆盖率：一旦一个单元被测试，这个单元内的 100% 的行应该已经被执行了。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-15T03:52:27.350

Jay Fields 有[很多](http://blog.jayfields.com/search/label/Testing%20Refactorings)关于编写单元测试的好建议，并且有[一篇文章他总结了最重要的建议](http://blog.jayfields.com/2008/06/developer-testing-and-importance-of.html)。在那里你会读到你应该批判性地思考你的背景并判断这些建议是否对你有价值。您会在这里获得大量惊人的答案，但由您决定哪个最适合您的上下文。试试它们，如果你觉得不好，就重构。

亲切的问候

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-14T15:52:44.787

永远不要假设一个简单的 2 行方法会起作用。编写一个快速的单元测试是防止缺少空测试、放错位置的负号和/或微妙的范围错误咬你的唯一方法，当你处理它的时间比现在更少时，这是不可避免的。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-07T21:44:19.283

我支持“A TRIP”的答案，除了**测试应该相互依赖！！！**

为什么？

DRY - 不要重复自己 - 也适用于测试！测试依赖项可以帮助 1) 节省设置时间，2) 节省夹具资源，以及 3) 查明故障。当然，前提是您的测试框架支持一流的依赖项。否则，我承认，他们很糟糕。

跟进[http://www.iam.unibe.ch/~scg/Research/JExample/](http://www.iam.unibe.ch/~scg/Research/JExample/)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-14T21:04:14.133

单元测试通常基于模拟对象或模拟数据。我喜欢写三种单元测试：

*   “瞬态”单元测试：他们创建自己的模拟对象/数据并用它测试他们的功能，但会破坏一切并且不留下任何痕迹（就像测试数据库中没有数据一样）
*   “持久”单元测试：他们在您的代码中测试创建对象/数据的函数，这些对象/数据稍后将被更高级的函数用于他们自己的单元测试（避免这些高级函数在每次他们自己的一组模拟对象/数据时重新创建）
*   “基于持久的”单元测试：使用持久单元测试已经存在的模拟对象/数据进行单元测试（因为在另一个单元测试会话中创建）。

关键是要避免重播*所有内容*，以便能够测试每个功能。

*   我经常运行第三种，因为所有模拟对象/数据都已经存在。
*   每当我的模型发生变化时，我都会运行第二种。
*   我运行第一个来检查非常基本的功能，检查基本的回归。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-14T21:34:54.667

考虑两种类型的测试并区别对待它们——功能测试和性能测试。

为每个使用不同的输入和指标。您可能需要为每种类型的测试使用不同的软件。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-08-14T17:41:52.867

我使用[Roy Osherove 的单元测试命名标准](http://weblogs.asp.net/rosherove/archive/2005/04/03/TestNamingStandards.aspx)描述的一致的测试命名约定给定测试用例类中的每个方法都具有以下命名样式 MethodUnderTest_Scenario_ExpectedResult。

每个部分使用 Upper Camel Case 并由下划线分隔。

当我运行测试时，我发现这很有用，测试按被测方法的名称分组。并且有一个约定可以让其他开发者理解测试意图。

如果被测方法已重载，我还将参数附加到方法名称。

# php - PHP的隐藏功能？

> ID：61401
> 
> 赞同：174
> 
> 时间：2008-09-14T15:21:11.680
> 
> 标签：php, hidden-features

我知道这听起来像是一个卖淫的问题，但让我解释一下我来自哪里。

大学毕业后，我在一家 PHP 商店找到了一份工作。我在那里工作了一年半，并认为我已经学会了所有关于编程的知识。

然后我在一家大型公司找到了一份单人内部开发商店的工作，所有工作都使用 C#。在我对这个职位的承诺中，我开始阅读大量的博客和书籍，并很快意识到我认为自己无所不知是多么错误。我学习了单元测试、依赖注入和装饰器模式、松散耦合的设计原则、关于继承的组合之争等等——我仍然非常吸收它。不用说我的编程风格在去年完全改变了。

现在，我发现自己在为朋友的初创公司做一些编码工作，我发现自己与使用 C# 编程相比完全受到限制。必须通过附加 '$this->' 来引用类范围内的所有变量，这让我很困扰。令我烦恼的是，我尝试过的所有 IDE 都没有非常好的智能感知，而且我的 SimpleTest 单元测试方法必须以“测试”这个词开头。动态类型使我无法隐式指定方法期望的参数类型，并且您必须编写 switch 语句来执行方法重载，这让我发疯了。我不能忍受你不能有嵌套的命名空间，并且必须使用 :: 运算符来调用基类的构造函数。

现在我无意发起 PHP 与 C# 的辩论，而是我的意思是，我确信有一些 PHP 功能我不知道或知道但无法正确使用。我置身于我的 C# 世界中，在玻璃碗外面看不到东西。

所以我在问，你最喜欢 PHP 的哪些特性？您可以在其中做哪些在 .Net 语言中做不到或更困难的事情？

* * *

## 回答 #1

> 赞同：328
> 
> 时间：2008-09-14T17:32:25.703

**文档**。[文件](http://www.php.net/manual/en/)得到我的投票。我还没有遇到过更全面的编程语言在线文档——我必须从各种网站和手册页拼凑起来的所有其他内容。

* * *

## 回答 #2

> 赞同：179
> 
> 时间：2008-09-15T16:33:28.847

**数组**。从这个问题的答案来看，我认为人们并不完全理解 PHP 中的数组是多么简单和有用。PHP 数组同时充当列表、映射、堆栈和通用数据结构。数组在语言核心中实现，并在所有地方使用，从而产生良好的 CPU 缓存局部性。Perl 和 Python 都对列表和映射使用不同的语言结构，从而导致更多的复制和潜在的混淆转换。

* * *

## 回答 #3

> 赞同：167
> 
> 时间：2008-09-14T17:30:13.430

**流处理程序**允许您使用据我所知在大多数其他语言中很难做到的逻辑来扩展“文件系统”。

例如，使用[MS-Excel 流处理程序](http://www.phpclasses.org/browse/package/1919.html)，您可以通过以下方式创建 MS Excel 文件：

```
$fp = fopen("xlsfile://tmp/test.xls", "wb");
if (!is_resource($fp)) { 
    die("Cannot open excel file");
}

$data= array(
    array("Name" => "Bob Loblaw", "Age" => 50),  
    array("Name" => "Popo Jijo", "Age" => 75),  
    array("Name" => "Tiny Tim", "Age" => 90)
); 

fwrite($fp, serialize($data));
fclose($fp); 
```

* * *

## 回答 #4

> 赞同：131
> 
> 时间：2008-09-14T17:21:29.083

**[魔术方法](http://www.php.net/manual/en/language.oop5.magic.php)**是在您调用不存在的方法或分配或读取不存在的属性时调用的贯穿方法，等等。

```
interface AllMagicMethods {
    // accessing undefined or invisible (e.g. private) properties
    public function __get($fieldName);
    public function __set($fieldName, $value);
    public function __isset($fieldName);
    public function __unset($fieldName);

    // calling undefined or invisible (e.g. private) methods
    public function __call($funcName, $args);
    public static function __callStatic($funcName, $args); // as of PHP 5.3

    // on serialize() / unserialize()
    public function __sleep();
    public function __wakeup();

    // conversion to string (e.g. with (string) $obj, echo $obj, strlen($obj), ...)
    public function __toString();

    // calling the object like a function (e.g. $obj($arg, $arg2))
    public function __invoke($arguments, $...);

    // called on var_export()
    public static function __set_state($array);
} 
```

此处的 C++ 开发人员可能会注意到，PHP 允许重载某些运算符，例如`()`or `(string)`。实际上 PHP 允许重载更多，例如`[]`运算符 ( [ArrayAccess](http://www.php.net/manual/en/class.arrayaccess.php) )、`foreach`语言构造 ( [Iterator](http://www.php.net/manual/en/class.iterator.php)和[IteratorAggregate](http://www.php.net/manual/en/class.iteratoraggregate.php) ) 和`count`函数 ( [Countable](http://www.php.net/manual/en/class.countable.php) )。

* * *

## 回答 #5

> 赞同：95
> 
> 时间：2008-11-01T07:42:37.170

**标准类**是一个整洁的容器。我最近才知道。

而不是使用数组来保存多个属性

```
$person = array();
$person['name'] = 'bob';
$person['age'] = 5; 
```

您可以使用标准类

```
$person = new stdClass();
$person->name = 'bob';
$person->age = 5; 
```

这在访问字符串中的这些变量时特别有用

```
$string = $person['name'] . ' is ' . $person['age'] . ' years old.';
// vs
$string = "$person->name is $person->age years old."; 
```

* * *

## 回答 #6

> 赞同：90
> 
> 时间：2009-08-06T19:59:58.367

**包含文件可以具有**可以分配给变量的返回值。

```
// config.php
return array(
    'db' => array(
        'host' => 'example.org',
        'user' => 'usr',
        // ...
    ),
    // ...
);

// index.php
$config = include 'config.php';
echo $config['db']['host']; // example.org 
```

* * *

## 回答 #7

> 赞同：83
> 
> 时间：2009-02-09T01:51:15.890

您可以利用`or`运算符的优先级低于`=`执行此操作的事实：

```
$page = (int) @$_GET['page'] 
  or $page = 1; 
```

如果第一个赋值的值为`true`，则忽略第二个赋值。另一个例子：

```
$record = get_record($id) 
  or throw new Exception("..."); 
```

* * *

## 回答 #8

> 赞同：80
> 
> 时间：2008-10-02T18:31:32.333

[**`__autoload()`**](http://php.net/manual/de/language.oop5.autoload.php)（类）文件由`set_include_path()`.

在 PHP5 中，现在不需要在执行体面的 OOP 时指定长的“include_once”语句列表。

只需定义一小组目录，其中类库文件结构合理，并设置自动包含路径：

```
set_include_path(get_include_path() . PATH_SEPARATOR . '../libs/');` 
```

现在`__autoload()`例行公事：

```
function __autoload($classname) {
    // every class is stored in a file "libs/classname.class.php"

    // note: temporary alter error_reporting to prevent WARNINGS
    // Do not suppress errors with a @ - syntax errors will fail silently!

    include_once($classname . '.class.php');
} 
```

现在 PHP 将自动按需包含所需的文件，从而节省解析时间和内存。

* * *

## 回答 #9

> 赞同：76
> 
> 时间：2008-09-16T13:39:09.943

**轻松**。最大的特点是新开发人员坐下来编写“工作”脚本并理解代码是多么容易。

最糟糕的功能是新开发人员坐下来编写“工作”脚本并认为他们理解代码是多么容易。

**围绕 PHP的社区**的开放性和大量可用的开源 PHP 项目对于进入开发世界的人来说并不那么令人生畏，并且像您一样，可以成为进入更成熟语言的垫脚石。

我不会像我之前那样讨论技术问题，但是如果您将 PHP 视为一个社区而不是一种 Web 语言，一个在您开始开发时就清楚地拥抱您的社区，其好处不言而喻。

* * *

## 回答 #10

> 赞同：76
> 
> 时间：2008-09-15T12:51:35.870

**变量变量和函数**毫无疑问！

```
$foo = 'bar';
$bar = 'foobar';
echo $$foo;    //This outputs foobar

function bar() {
    echo 'Hello world!';
}

function foobar() {
    echo 'What a wonderful world!';
}
$foo();    //This outputs Hello world!
$$foo();    //This outputs What a wonderful world! 
```

同样的概念适用于对象参数（$some_object->$some_variable）；

非常非常棒。使用循环和模式进行编码非常容易，而且它比 eval 更快、更受控制（感谢 @Ross 和 @Joshi Spawnbrood！）.t

* * *

## 回答 #11

> 赞同：68
> 
> 时间：2009-07-09T12:24:41.120

您可以使用**带有未定义数量参数的函数，**使用`func_get_args()`.

```
<?php

function test() {

    $args = func_get_args();
    echo $args[2]; // will print 'd'
    echo $args[1]; // will print 3
}

test(1,3,'d',4);

?> 
```

* * *

## 回答 #12

> 赞同：67
> 
> 时间：2009-05-20T06:07:15.847

我喜欢[**远程文件**](http://www.php.net/manual/en/features.remote-files.php)。对于 Web 开发，这种功能非常有用。

需要处理网页内容？一个简单的

```
$fp = fopen('http://example.com'); 
```

你已经准备好一个文件句柄，就像任何其他普通文件一样。

或者如何将远程文件或网页直接读取到字符串中？

```
$str = file_get_contents('http://example.com/file'); 
```

这种特殊方法的有用性怎么强调都不为过。

想要分析远程图像？如何通过 FTP 进行操作？

```
$imageInfo = getimagesize('ftp://user:password@ftp.example.com/image/name.jpg'); 
```

几乎所有处理文件的 PHP 函数都可以处理远程文件。您甚至可以`include()`通过`require()`这种方式远程编码文件。

* * *

## 回答 #13

> 赞同：63
> 
> 时间：2009-03-20T09:51:16.810

[**strtr()**](http://au2.php.net/strtr)

它非常快，以至于您会感到惊讶。在内部，它可能使用一些疯狂的 b-tree 类型结构来按照它们的公共前缀排列你的匹配项。我将它与 200 多个查找和替换字符串一起使用，它仍然在不到 100 毫秒的时间内通过 1MB。对于几乎很小的字符串，strtr() 在做完全相同的事情时甚至比 strtolower() 快得多，即使考虑到字符集也是如此。您可能可以使用连续的 strtr 调用编写整个解析器，它会比通常的正则表达式匹配更快，找出标记类型，输出这个或那个，下一个正则表达式类型的东西。

我正在编写一个文本规范器，用于将文本拆分为单词、小写、删除标点符号等，而 strtr 是我的瑞士军刀，它击败了正则表达式甚至 str_replace()。

* * *

## 回答 #14

> 赞同：61
> 
> 时间：2008-09-22T09:39:15.437

PHP 的一个不太为人所知的特性是[**`extract()`**](http://php.net/manual/en/function.extract.php)，一个将关联数组解包到本地命名空间中的函数。这可能存在于自动全局异常中，但对于模板非常有用：

```
function render_template($template_name, $context, $as_string=false)
{
    extract($context);
    if ($as_string)
        ob_start();
    include TEMPLATE_DIR . '/' . $template_name;
    if ($as_string)
        return ob_get_clean();
} 
```

现在您可以使用`render_template('index.html', array('foo' => 'bar'))`并且仅与模板中出现`$foo`的值一起使用。`"bar"`

* * *

## 回答 #15

> 赞同：52
> 
> 时间：2009-06-22T11:52:18.193

**[Range()](http://us.php.net/manual/en/function.range.php)**本身并没有隐藏，但我仍然看到很多人在迭代：

```
for ($i=0; $i < $x; $i++) { 
    // code...
} 
```

他们什么时候可以使用：

```
foreach (range(0, 12) as $number) {
    // ...
} 
```

你可以做一些简单的事情，比如

```
foreach (range(date("Y"), date("Y")+20) as $i)
{
print "\t<option value=\"{$i}\">{$i}</option>\n";
} 
```

* * *

## 回答 #16

> 赞同：44
> 
> 时间：2008-09-14T20:15:51.520

**启用 PHP 的网站空间**通常比使用 (asp).net 的网站便宜。您*可以*称其为功能；-)

* * *

## 回答 #17

> 赞同：42
> 
> 时间：2009-06-21T22:29:09.403

该`static`关键字在 OOP 观点之外很有用。您可以使用以下简单的方法快速轻松地实现“记忆化”或函数缓存：

```
<?php
function foo($arg1)
{
    static $cache;

    if( !isset($cache[md5($arg1)]) )
    {
        // Do the work here
        $cache[md5($arg1)] = $results;
    }

    return $cache[md5($arg1)];
}
?> 
```

该`static`关键字创建一个变量，该变量仅在执行后该函数的范围内持续存在。这种技术非常适用于访问数据库的函数，`get_all_books_by_id(...)`或者`get_all_categories(...)`您在页面加载期间会多次调用的函数。

*警告：*确保找到为哈希创建密钥的最佳方法，在几乎所有情况下，`md5(...)`以上都不是一个好的决定（速度和输出长度问题），我将其用于说明目的。`sprintf('%u', crc32(...))`或者`spl_object_hash(...)`根据上下文可能会更好。

* * *

## 回答 #18

> 赞同：42
> 
> 时间：2009-01-11T07:25:39.237

PHP 的一个不错的特性是**CLI**。它在文档中并没有那么“推广”，但是如果您需要常规脚本/控制台应用程序，使用 cron + php cli 的开发速度真的很快！

* * *

## 回答 #19

> 赞同：39
> 
> 时间：2008-10-06T11:11:23.727

**然后“和打印”技巧**

```
<?php $flag and print "Blah" ?> 
```

如果 $flag 为真，将回显 Blah。不适用于 ECHO。

这在模板中非常方便，可以替换 ? : 这不是很容易阅读。

* * *

## 回答 #20

> 赞同：37
> 
> 时间：2009-05-01T08:20:02.157

您可以**在变量名称中使用减号，**如下所示：

```
class style
{
  ....
  function set_bg_colour($c)
  {
    $this->{'background-color'} = $c;
  }
} 
```

为什么要使用它？不知道：也许是 CSS 模型？或者你需要输出一些奇怪的 JSON。这是一个奇怪的功能:)

* * *

## 回答 #21

> 赞同：34
> 
> 时间：2009-03-20T10:50:23.860

可能没有多少人知道可以将常量“变量”指定为函数参数的默认值：

```
function myFunc($param1, $param2 = MY_CONST)
{
//code...
} 
```

**字符串**可以**像****数组**一样使用：

```
$str = 'hell o World';
echo $str; //outputs: "hell o World"

$str[0] = 'H';
echo $str; //outputs: "Hell o World"

$str[4] = null;
echo $str; //outputs: "Hello World" 
```

* * *

## 回答 #22

> 赞同：34
> 
> 时间：2009-06-22T19:52:46.347

**HEREDOC**语法是我最喜欢的隐藏特性。总是很难找到，因为你不能用谷歌搜索 <<<，但它阻止你不得不转义大块 HTML，并且仍然允许你将变量放入流中。

```
echo <<<EOM
  <div id="someblock">
    <img src="{$file}" />
  </div>
EOM; 
```

* * *

## 回答 #23

> 赞同：33
> 
> 时间：2009-06-21T23:55:02.957

关于 PHP 代码最有用的一点是，如果我不太了解我看到的函数，我可以使用浏览器并键入以下内容来查找它：

> [http://php.net/function](http://php.net/function)

上个月我在一些代码中看到了“范围”函数。这是我设法从未使用过但非常有用的数百个功能之一：

> [http://php.net/range](http://php.net/range)

该网址是[http://us2.php.net/manual/en/function.range.php](http://us2.php.net/manual/en/function.range.php)的别名。**将函数和关键字映射到 urls**的简单想法非常棒。

我希望其他语言、框架、数据库、操作系统也有同样简单的查找文档的机制。

* * *

## 回答 #24

> 赞同：30
> 
> 时间：2009-06-21T02:24:00.870

## 快速块评论

```
/*
    die('You shall not pass!');
//*/

//*
    die('You shall not pass!');
//*/ 
```

这些注释允许您切换代码块是否用一个字符注释。

* * *

## 回答 #25

> 赞同：29
> 
> 时间：2009-06-21T22:43:32.760

我的列表.. 他们中的大多数都属于“隐藏功能”而不是“最喜欢的功能”（我希望！），并不是所有的都是有用的，但是..是的。

```
// swap values. any number of vars works, obviously  
list($a, $b) = array($b, $a);

// nested list() calls "fill" variables from multidim arrays:  
$arr = array(  
  array('aaaa', 'bbb'),  
  array('cc', 'd')  
);  
list(list($a, $b), list($c, $d)) = $arr;  
echo "$a $b $c $d"; // -> aaaa bbb cc d  

// list() values to arrays  
while (list($arr1[], $arr2[], $arr3[]) = mysql_fetch_row($res)) { .. }  
// or get columns from a matrix  
foreach($data as $row) list($col_1[], $col_2[], $col_3[]) = $row;

// abusing the ternary operator to set other variables as a side effect:  
$foo = $condition ? 'Yes' . (($bar = 'right') && false) : 'No' . (($bar = 'left') && false);  
// boolean False cast to string for concatenation becomes an empty string ''.  
// you can also use list() but that's so boring ;-)  
list($foo, $bar) = $condition ? array('Yes', 'right') : array('No', 'left'); 
```

您也可以嵌套三元运算符，有时会派上用场。

```
// the strings' "Complex syntax" allows for *weird* stuff.  
// given $i = 3, if $custom is true, set $foo to $P['size3'], else to $C['size3']:  
$foo = ${$custom?'P':'C'}['size'.$i];  
$foo = $custom?$P['size'.$i]:$C['size'.$i]; // does the same, but it's too long ;-)  
// similarly, splitting an array $all_rows into two arrays $data0 and $data1 based  
// on some field 'active' in the sub-arrays:  
foreach ($all_rows as $row) ${'data'.($row['active']?1:0)}[] = $row;

// slight adaption from another answer here, I had to try out what else you could  
// abuse as variable names.. turns out, way too much...  
$string = 'f.> <!-? o+';  
${$string} = 'asdfasf';  
echo ${$string}; // -> 'asdfasf'  
echo $GLOBALS['f.> <!-? o+']; // -> 'asdfasf'  
// (don't do this. srsly.)

${''} = 456;  
echo ${''}; // -> 456  
echo $GLOBALS['']; // -> 456  
// I have no idea. 
```

好吧，我现在就停下来:-)

* * *

嗯，好久不见了。。

```
// just discovered you can comment the hell out of php:
$q/* snarf */=/* quux */$_GET/* foo */[/* bar */'q'/* bazz */]/* yadda */; 
```

所以，刚刚发现如果你用大括号括起来，你可以将任何字符串作为方法名称传递。唉，您不能将任何字符串定义为方法，但您可以使用 __call() 捕获它们，并根据需要进一步处理它们。嗯……

```
class foo {
  function __call($func, $args) {
    eval ($func);
  }
}

$x = new foo;
$x->{'foreach(range(1, 10) as $i) {echo $i."\n";}'}(); 
```

在 Reddit 评论中发现了这个小宝石：

```
$foo = 'abcde';
$strlen = 'strlen';
echo "$foo is {$strlen($foo)} characters long."; // "abcde is 5 characters long." 
```

您不能像这样直接调用 {} 内的函数，但您*可以*使用 variables-holding-the-function-name 并调用它们！（*并且*您也可以在其上使用可变变量）

* * *

## 回答 #26

> 赞同：26
> 
> 时间：2008-09-22T09:47:02.703

我有点像你，我编写 PHP 代码已经 8 年多了。大约一年前，我必须参加 .NET/C# 课程，我真的很喜欢 C# 语言（讨厌 ASP.NET），但它让我成为了一个更好的 PHP 开发人员。

PHP 作为一门语言很差，但是，我对它的速度非常快，而且 LAMP 堆栈很棒。最终产品远远超过零件的总和。

也就是说，在回答您的问题时：

[http://uk.php.net/SPL](http://uk.php.net/SPL)

我喜欢**SPL**，C# 中的集合类是我一开始就喜欢它的东西。现在我可以吃蛋糕了。

安德鲁

* * *

## 回答 #27

> 赞同：26
> 
> 时间：2008-09-14T17:51:38.870

**数组操作。**
用于处理和操作数组的大量工具。它可能不是 PHP 独有的，但我从来没有使用过一种让它变得如此简单的语言。

* * *

## 回答 #28

> 赞同：24
> 
> 时间：2009-06-22T00:39:06.067

我有点惊讶没有人提到它，但我最喜欢的数组技巧之一是使用加号运算符。它有点像`array_merge()`但更简单。我发现这通常是我想要的。实际上，它获取了 RHS 中的所有条目，并使它们出现在 LHS 的副本中，并在必要时覆盖（即它是不可交换的）。对于从“默认”数组开始并一次性添加一些实际值非常有用，同时为未提供的值保留默认值。

要求的代码示例：

```
// Set the normal defaults.
$control_defaults = array( 'type' => 'text', 'size' => 30 );

// ... many lines later ...

$control_5 = $control_defaults + array( 'name' => 'surname', 'size' => 40 );
// This is the same as:
// $control_5 = array( 'type' => 'text', 'name' => 'surname', 'size' => 40 ); 
```

* * *

## 回答 #29

> 赞同：21
> 
> 时间：2009-02-16T01:19:55.233

**快速和肮脏**是默认设置。
该语言充满了有用的快捷方式，这使得 PHP 成为上市时间短的（小型）项目的理想选择。并不是说干净的 PHP 代码是不可能的，它只是需要一些额外的努力和经验。

但我喜欢 PHP，因为它可以让我表达我想要的东西，而无需写一篇文章。

PHP：

```
if (preg_match("/cat/","one cat")) {
   // do something
} 
```

爪哇：

```
import java.util.regex.*;
Pattern p = Pattern.compile("cat");
Matcher m = p.matcher("one cat")
if (m.find()) {
  // do something
} 
```

是的，这包括不输入**Int**。

* * *

## 回答 #30

> 赞同：21
> 
> 时间：2008-09-14T15:22:38.120

这是一个，我喜欢在未提供的**函数参数上设置默认值更容易：**

```
function MyMethod($VarICareAbout, $VarIDontCareAbout = 'yippie') { } 
```

* * *

## 回答 #31

> 赞同：16
> 
> 时间：2009-06-30T03:51:39.567

**通过 ob_start() 进行的输出缓冲**比大多数人意识到的要有用得多。这里的第一个隐藏特性是 ob_start 接受回调：

```
function twiterize($text) {
    // Replace @somename with the full twitter handle
    return preg_replace("(\s+)@(\w)+(\s+)", "http://www.twitter.com/${2}", $text);
}

ob_start(twiterize); 
```

其次，您可以嵌套输出缓冲区...使用前面的示例：

```
ob_start(parseTemplate);
 // ... 
 ob_start(twiterize);
   // ...
 ob_end_flush();
 // ... 
ob_end_flush(); 
```

帮助内容、文字广告、字典/索引功能、链接化、用于跟踪目的的链接重定向、模板引擎，通过使用这两种东西的不同组合，所有这些东西都非常容易。

* * *

## 回答 #32

> 赞同：16
> 
> 时间：2010-06-24T14:50:03.547

您可以使用退出嵌套循环（以弥补缺少）。例如`break *N*;``goto`

```
for (int i=0; i<100; i++) {
    foreach ($myarr as $item) {
        if ($item['name'] == 'abort')
            break 2;
    }
} 
```

更多信息在这里 - [http://php.net/manual/en/control-structures.break.php](http://php.net/manual/en/control-structures.break.php)

* * *

## 回答 #33

> 赞同：15
> 
> 时间：2008-09-14T19:15:01.167

实际上，您不能指定方法期望的类型并不完全正确，它确实按您期望的那样工作。

```
function foo ( array $param0, stdClass $param1 ); 
```

***注意：****这仅适用于“数组”和对象名称。*

依此类推，您甚至可以将自己的类作为预期参数传入。用其他东西调用方法/函数将导致致命错误。

关于 PHP 中良好智能感知的另一个提示。我们使用 ZendStudio，如果您为您的方法编写好的 PHPDocs，它实际上会更好地工作，它会在提示时查看那些。

* * *

## 回答 #34

> 赞同：13
> 
> 时间：2008-09-16T11:31:36.007

a)**手册**——非常全面、最新并且只是解决问题时灵感的巨大来源——卡住了？浏览/搜索手册，它会来找你

b)**数组**——它们是可塑性的，它们是关联索引的，它们可以很容易地嵌套（！）以组成一些狂野的数据结构，并且有许多函数仅用于数组操作。哦，我是否提到将单独的变量视为值数组？

c) **eval()**和类似的结构（如动态变量和函数名称），它们允许更大的灵活性（并且如果您知道自己在做什么，仍然相对安全） - 没有什么比基本上定义自己的流程的程序更好（甚至是特定的执行）在运行中

d) 最容易忽略的事情：由于 ZEND 引擎中的几乎所有东西都是**zVal**（本质上是指针引用的集合），因此能够将任何东西作为函数返回值返回

另外，我想指出一个很棒的功能，但它与 PHP 源代码的相关性比语言更多（因此 - 单独列出）：

e) 易于编写**C 扩展**（主要是其他对象的接口，如 OpenAL 或 SDL）- 出色的源代码结构和“内部”和“外部”一样多的强大工具 - 如果您需要扩展功能只是一点点。

* * *

## 回答 #35

> 赞同：13
> 
> 时间：2009-03-20T09:56:37.047

**日期函数**。我必须整天处理大量时间信息和日期字符串，所以像[strftime()](http://www.php.net/strftime)和[strtotime()](http://www.php.net/strtotime)这样的函数真是太棒了。

* * *

## 回答 #36

> 赞同：13
> 
> 时间：2009-06-22T15:26:41.130

除了即时访问以开始编写网站所需的任何内容之外？

除了魔术方法和反射之外，一些有趣的功能是：

1.  [`serialize`](http://ca.php.net/serialize)/ [`unserialize`](http://ca.php.net/unserialize)- 通过 sql、cookie、进程、平面文件保存状态。好东西。
2.  [`json_encode`](http://ca.php.net/json_encode)/ [`json_decode`](http://ca.php.net/json_decode)- 即时 AJAX 乐趣
3.  [`get_class`](http://ca.php.net/get_class)- 有助于那些疲惫的松散打字时刻
4.  [`call_user_func_array`](http://ca.php.net/call_user_func_array)- 当您可以将代码作为字符串处理时功能强大（认为是动态的）
5.  [`method_exists`](http://ca.php.net/method_exists)- 反射
6.  [`func_num_arg`s](http://ca.php.net/func_num_args) / [`func_get_arg`](http://ca.php.net/func_get_args)- 未知参数ftw
7.  [`set_error_handler`](http://ca.php.net/set_error_handler)/ [`set_exception_handler`](http://ca.php.net/set_exception_handler)- 非常好的脚本语言调试能力

* * *

## 回答 #37

> 赞同：13
> 
> 时间：2009-07-17T18:16:06.860

**[对于基本字符验证， Ctype 函数](http://us3.php.net/manual/en/ref.ctype.php)比 preg_match() 更快。**

> > ctype_alnum() — 检查字母数字字符
> > ctype_alpha() — 检查字母字符
> > ctype_cntrl() — 检查控制字符
> > ctype_digit() — 检查数字字符
> > ...等等。 .

* * *

## 回答 #38

> 赞同：12
> 
> 时间：2009-06-21T22:12:05.257

几乎不应该使用通过[错误控制运算符 @](http://www.php.net/manual/en/language.operators.errorcontrol.php)进行的错误抑制。它通过简单地忽略错误来促进懒惰和非防御性的编码实践，制造调试噩梦，因为所有类型的错误——甚至是致命错误——都会被抑制，并且在某些情况下，可能会影响性能（尤其是在抑制大错误的数量）。

* * *

## 回答 #39

> 赞同：12
> 
> 时间：2009-07-25T23:06:09.977

[**filter_var**](http://es.php.net/manual/en/function.filter-var.php)函数。不是隐藏的珍珠，而是很新。

* * *

## 回答 #40

> 赞同：10
> 
> 时间：2009-07-01T01:43:24.820

好吧，我最近向付费客户交付了我的第一个 GUI 应用程序 - 用 PHP 编写！它从条形码阅读器或 GUI 按钮、复选框、单选按钮或文本字段收集数据，存储到 SQLite 或远程 MySQL，启动其他 Windows 应用程序，将压缩的 XML 报告作为电子邮件附件发送，加密和解密存储的数据，甚至播放声音完成后。

用[miniPHP](http://www.exvision.net/miniphp.php)和[Winbinder 做到了](http://winbinder.org/)。够隐蔽吗？我想没有多少 PHP 开发人员真正尝试过这一点。

* * *

## 回答 #41

> 赞同：8
> 
> 时间：2009-11-08T19:56:35.190

**正如其他人所提到的，在命令行级别运行 PHP**的能力非常棒。我一直将 PHP 脚本设置为 cron 作业，用于数据清理和备份。只需使用以下行开始文件：

```
#!/usr/bin/php5
<?php
// start coding here 
```

请注意，第一行可能会有所不同，具体取决于您系统上 PHP 的安装位置。

从这里开始，很容易为更复杂的系统级进程实现 PHP，[例如 daemons](http://www.phpclasses.org/browse/file/8958.html)。

* * *

## 回答 #42

> 赞同：8
> 
> 时间：2009-04-27T17:24:03.803

您可以轻松地将元素添加到数组中。

```
$my_array = array();
$my_array[] = 'first element';
$my_array[] = 'second element'; 
```

元素可以是任何东西：对象、数组、标量...

* * *

## 回答 #43

> 赞同：8
> 
> 时间：2010-06-28T23:19:21.113

**速记布尔链**

```
<?php

TRUE AND print 'Hello';
FALSE OR print 'World';

// Prints "Hello World";

// Complex example...
User::logged_in() or die('Not allowed');
User::is_admin() AND print 'Admin Area'; 
```

如果您在 Web 可访问区域中有 PHP 文件，这将非常有用。通过在每个文件的顶部插入这个小花絮，您可以确保没有人可以访问除 index.php 之外的任何文件

```
<?php defined('YOURCONSTANT') or die('Not allowed');

///rest of your code 
```

* * *

## 回答 #44

> 赞同：7
> 
> 时间：2008-09-22T09:52:09.850

内置过滤器，用于根据特定的预定义类型解析变量 - 以及涵盖基础知识（int/float 等），扩展到涵盖电子邮件、url 甚至变量是有效的正则表达式。

[http://ch2.php.net/manual/en/book.filter.php](http://ch2.php.net/manual/en/book.filter.php)

* * *

## 回答 #45

> 赞同：6
> 
> 时间：2008-09-15T14:23:07.443

[](http://us.php.net/manual/en/language.types.type-juggling.php#language.types.typecasting)**类型转换和[**ctype_**](http://us.php.net/manual/en/language.types.type-juggling.php#language.types.typecasting) [*](http://us.php.net/manual/en/book.ctype.php)函数对于确保数据干净变得很重要。最近我大量使用[异常](http://us.php.net/manual/en/language.exceptions.php)，这大大简化了我的错误处理代码。**

 **我不会说这种语言有很多杀手锏。（至少，我没有太多机会去寻找他们。）我喜欢这种语言不引人注目。

* * *

## 回答 #46

> 赞同：6
> 
> 时间：2009-10-10T18:44:28.217

[ReflectionClass](http://us.php.net/manual/en/class.reflectionclass.php)类提供有关给定类的信息。

```
$classInfo = new ReflectionClass ('MyClass');
if ($classInfo->hasMethod($methodName))                                     
{
  $cm = $classInfo->getMethod($name);                                   
  $methodResult = $cm->invoke(null);
} 
```

除其他外，检查方法是否存在并调用它很有用。

* * *

## 回答 #47

> 赞同：6
> 
> 时间：2009-07-17T05:08:03.740

在字符串中使用数组元素或对象属性。

而不是写

```
$newVar = $ar['foo']['bar'];
echo "Array value is $newVar";

$newVar = $obj->foo->bar;
echo "Object value is $newVar"; 
```

你可以写：

```
echo "Array value is {$ar['foo']['bar']}";
echo "Object value is {$obj->foo->bar}"; 
```

* * *

## 回答 #48

> 赞同：5
> 
> 时间：2009-06-21T22:20:56.970

preg_split()、array_intersect() 和 array_intersect_key()。

* * *

## 回答 #49

> 赞同：5
> 
> 时间：2010-06-22T02:06:13.570

几乎任何文件类型都可以`included`，从 .html 到 .jpeg。任何在 PHP 开放标签内找到的字节串都会被执行。是的，goat.se 的图像可以包含您常用的所有实用功能。我猜测的内部行为`include`是将输入文件转换为字符串，并解析任何 php 代码。

* * *

## 回答 #50

> 赞同：4
> 
> 时间：2009-05-10T01:44:51.397

我偏爱其他 PHP 用户。必要时很容易得到答案和方向。

* * *

## 回答 #51

> 赞同：4
> 
> 时间：2009-06-22T21:53:45.213

There's lots of gems hidden in the Standard PHP Library. Array access allows you to build an object that works to an array interface but add your own functionality on top.

Also when you create an ArrayAccess object by setting a flag in the constructor you can read and write an object as either an array or an object. Here's an example:

```
$obj = new ArrayObject(array("name"=>"bob", "email"=>"bob@example.com"),2);
$obj->fullname = "Bob Example";
echo $obj["fullname"];
$obj["fullname"]="Bobby Example";
echo $obj->fullname; 
```

* * *

## 回答 #52

> 赞同：4
> 
> 时间：2008-09-15T13:05:16.693

> 隐式指定方法期望的参数类型

实际上，这部分是可能的（至少在 PHP5 中） - 您可以为函数和方法指定数组和对象参数的类型，尽管在标量类型的情况下您不走运。

```
class Bar
{
    public function __construct(array $Parameters, Bar $AnotherBar){}
} 
```

除了这个和 Alllain 提到的神奇方法之外，我还发现 SPL（标准 PHP 库）提供的接口是必不可少的——你可以在你的类中实现必要的方法，例如，我特别喜欢 ArrayAccess 和 Iterator 接口，它们允许使用关联数组之类的对象或像任何简单数组一样对其进行迭代。

* * *

## 回答 #53

> 赞同：4
> 
> 时间：2009-06-22T19:57:21.720

我也喜欢'和'之间的区别。

```
$foo = 'Bob';
echo 'My name is {$foo}'; // Doesn't swap the variable
echo "My name is {$foo}"; // Swaps the variable 
```

因此，如果您的字符串不需要变量交换，请不要使用“，这是浪费时间。我看到很多人一直用“声明字符串。

注意：我使用 { } 因为它使我的变量更加突出。

* * *

## 回答 #54

> 赞同：4
> 
> 时间：2009-07-07T14:41:18.783

### [控制结构的替代语法](http://www.php.net/manual/en/control-structures.alternative-syntax.php)

很多人不知道这种语法。当我使用纯 PHP 进行模板时，这种语法提供了一种很好且干净的方式来混合简单的控制结构，例如HTML 模板代码`if`，`foreach`通常与`<?= $myVar ?>`打印变量的简短样式相结合。

* * *

## 回答 #55

> 赞同：4
> 
> 时间：2009-08-18T17:29:51.990

我建议使用 PHPUnit 进行单元测试，如果你想有注释来标记你的测试、数据提供者和数据驱动测试等等。更不用说，当涉及到持续集成（巡航控制、竹子、哈德森等）之类的东西时，它似乎得到了所有集成的喜爱。

PHP 5.3，这是一个很大的飞跃，就语言特性而言，它是完全值得的。它的边缘可能很粗糙，但这是一家初创公司，它们将在您启动时修复发布。

就魔术方法而言，单独使用 __invoke() 很重要，但即使如此，它也没有对应的方法，与 array_map、array_reduce 和 array_filter 以及一些包装器配对，您可以进行一些惊人的函数式编程。

__get、__set 和 __call 也很方便，我使用这些和一些接口/类命名约定技巧来实现 5.3 之前的特征，但现在你也有了特征。

还可以查看由 ezComponents 的 derik rethans 和 XDebug 名声编写的附录库，它允许您为 php 5+ 进行注释。这还不错，性能与缓存无关。

对于分析，您可以使用 xdebug + webcachegrind。

最好的 IDE 可能是免费的 eclipse PDT，如果您对参数使用类型提示，并为参数和返回值使用 phpdoc 注释，它可以从中找出问题并为您提供代码补全。那应该给你不错的智能。

顺便说一句，做各种疯狂的字符串连接、变量变量、变量方法调用或变量类创建是很诱人的，在不止一个地方这样做，这没有很好的文档记录，也很容易通过正则表达式搜索，你是拧紧。忘记很难调试，但重构是一个主要的痛苦。这是人们很少认为 php 没有自动重构工具的事情，并且在 php 中重构大型代码库非常困难。

有几件事要提醒你，即使你闻到一点点可能需要处理多字节字符或“异国情调”字符编码，我强烈建议你结束字符串处理。事实上，引入一层薄薄的间接层，允许您在代码和内置程序之间进行填充或充当测试/可注入性的接缝，这将使您的生活更轻松。不是绝对必要的，但除非你有远见，否则很难处理国际化或如此大型的跨领域项目。

自动加载，学习并喜欢它。逃避硬编码的要求/包含，或者更糟糕的是，它们的 *_once 变体，它们在注入方面束缚了你的手，而不是使用自动加载器，最简单的事情是将所有包含在一个数组中，键入类名，并且该值是来自某个根目录的文件路径，它很快。糟糕的是，它使测试变得非常容易，因为你已经实现了一个类加载器，所以你可以用它做一些非常整洁的事情。

PHP 5.3 现在有了名称空间，高兴地跳起来，像疯子一样使用它们。仅此一项就提供了为测试/注射创建接缝（罕见）的机会。

操作码缓存，文件访问很慢，为了避免它们，使用操作码缓存，它不仅仅是文件访问，而是所有的解析，真的。如果您不必解析 PER 请求，它会产生很大的不同。即使为前端控制器/拦截器执行此操作也会给您带来很多好处。

换个思路，如果 PHP 程序员来自 Java/.Net，最麻烦的事情之一是您的应用程序服务器分布在 PHP/Apache 或您正在使用的任何 Web 服务器上。

早期的 Phing/Ant/PHPMaven 似乎很容易将所有内容都塞进去，但是构建脚本在 php 中仍然有用，并且它们有一些很好的支持。

我在方法重载方面遇到了麻烦，但仍然与之抗衡。我想出了一个模式来缓解它的某个方面。我经常有很多可以满足某个参数的东西，所以当你记录它时，@param mixed(int|array|fooObject) 如果有这些可能性，我创建了一个名为 Caster::CastTo($param, $toTypeAsString) 的静态方法这只会通过匹配类型的案例并尝试将其转换为已知类型。然后，该方法的其余部分可以假设一种类型，或者转换失败，并使用它。而且由于我将所有转换都卡在一个类中，它停止了类型映射成为一个横切关注点，而且由于这些函数可以单独测试，我可以测试它们一次，并在其他任何地方依赖它们。

* * *

## 回答 #56

> 赞同：3
> 
> 时间：2009-03-20T16:36:54.417

嗯，**社区**对我来说是第一位的。无论您的问题是什么，您总会找到以前遇到过问题的人，并且几乎每次都有解决方案……有时我会看到完全免费的想法，解决单个问题的方法。

我现在正在努力学习 Python（成长为......嗯......程序员，可以吗？）Python 最有用的就是缩进。我喜欢 PHP 的缩进，变量符号的 $ 标记，循环和循环的花括号，嗯，这些聪明的东西让我的代码很容易理解（即使编写代码的人很少..乱七八糟.. '意大利面条代码'，嗯？）

**PHP 中的数组**非常简单且功能强大。

**数据库**：MySQL、Postrgee、sql；您可以轻松使用几乎所有类型的数据库。

快速：逻辑上取决于代码是如何编写的，但通常 PHP**对于小型/中型应用程序来说非常快**（因为它在更大的应用程序中失去了轮子）。

* * *

## 回答 #57

> 赞同：3
> 
> 时间：2009-07-23T18:21:11.913

我已经开始切换到 python，我喜欢 python 的一件事是现场解释器。直到后来从事一个 php 项目，我才意识到 php 确实有这个选项，只是它并不广为人知。在命令提示符下，键入`php -a`并粘贴您要测试的任何 php 代码，但请记住以`<?php`

* * *

## 回答 #58

> 赞同：3
> 
> 时间：2010-01-09T05:34:06.440

我认为他们对 GOTO 功能的适当尊重是关键。

[http://us2.php.net/goto](http://us2.php.net/goto)

* * *

## 回答 #59

> 赞同：2
> 
> 时间：2009-06-21T20:57:56.247

让我们来看看...

1.  三元运算符。它们为处理表单结果中的复选框创造了奇迹。

    $var = ($_POST['my_checkbox']=='checked') ？真假;

2.  所有精彩的字符串和数组处理函数都值得一读。strtotime()、strlen() 和 strpos() 是我最喜欢的几个。

3.  SimpleXML 类和 json_decode() 函数。使用 file_get_contents() 调用 REST API 或 RSS 提要，使用其中一种工具轻松解析它，然后就完成了。

* * *

## 回答 #60

> 赞同：2
> 
> 时间：2008-09-15T18:21:22.207

查找与 PHP 相关的内容示例、应用程序、类、文档、框架等是多么容易……

在整个网络上，它是突击队（自己）学习时最容易学习的语言，也是对您的时间更有价值的语言。

学完 PHP 可能会把 CMS 和 joomla 放在一起，用 wordpress 写博客等等......

* * *

## 回答 #61

> 赞同：2
> 
> 时间：2010-06-28T21:00:08.370

**Lambda 函数**

示例 - 按多维数组中的字段排序

```
function sort_by_field($field, & $data) {
    $sort_func = create_function('$a,$b', 'if ($a["' . $field . '"] == $b["' . $field . '"]) {return 0;} 
            return ($a["' . $field . '"] < $b["' . $field . '"]) ? -1 : 1;');

    uasort($data, $sort_func);
} 
```

**匿名函数**

匿名函数允许您为变量定义函数。 [http://www.php.net/manual/en/functions.anonymous.php](http://www.php.net/manual/en/functions.anonymous.php)

* * *

## 回答 #62

> 赞同：2
> 
> 时间：2010-01-09T06:23:23.410

预定义接口：

[http://php.net/manual/en/reserved.interfaces.php](http://php.net/manual/en/reserved.interfaces.php)

例如，实现`ArrayAccess`将使您的对象显示为数组或`Iterator`允许在 foreach 语句中使用它。

不幸的是，您不能将“对象数组”与将数组作为参数的本机函数一起使用。

`__call`我还发现重写允许您为对象动态创建属性和方法的函数很有用。

在我的数据库抽象中，我使用它来生成由数据库列名命名的函数。例如，如果有一列“名称”，那么您可以使用 更改其中的值`updateByName("foo")`。

* * *

## 回答 #63

> 赞同：1
> 
> 时间：2010-01-07T17:42:32.287

Lot already said about this.

Just to add that one thing that looked pretty forgotten, if not hidden, is [http://talks.php.net](http://talks.php.net) part of the [http://www.php.net](http://www.php.net). It collects lot of useful presentations, some really old, but some new and extremely valuable.

* * *

## 回答 #64

> 赞同：1
> 
> 时间：2009-09-12T23:32:42.580

多年来，我的启示更多是概念性的，而不是基于语言的。

1：渲染而不是回显。

```
function render_title($title){
     return "<title>$title</title";
} 
```

当您渲染输出而不是使用回声时，重复使用这些部分并将它们传递给模板要容易得多（在这种情况下，您必须依赖输出缓冲）。

2：函数式编程，或者至少尽可能接近它，没有副作用的功能。渲染，不使用全局变量，让你的函数保持在本地范围内，诸如此类。我曾一度认为面向对象编程是使用 php 的方式，但是我从面向对象方法下降到 php 中的函数式编程方法所经历的开销和语法复杂性的降低使得函数式编程成为我的明确选择.

3：模板系统（例如 smarty）。我花了很长时间才意识到你需要一个模板系统，它已经是一种模板脚本语言，但是它为你提供的逻辑与显示的分离是非常必要的。

* * *

## 回答 #65

> 赞同：1
> 
> 时间：2008-09-15T12:54:35.707

**好的：**

*   PHP 在 WebHosting 中的广泛接受。几乎每个网络托管服务都支持 PHP。
*   简单的事情可以用简单的代码来解决。没有类或命名空间是严格要求的。

**坏的：**

*   有很多没有任何命名约定的函数。很难记住所有这些功能以有效地使用它。
*   糟糕的编码习惯，遍布整个网络:(

* * *

## 回答 #66

> 赞同：1
> 
> 时间：2009-08-28T20:17:25.083

在 PHP5.3 中，您可以将 PHAR 档案放在 PHAR 档案中！就像 Java 世界中的 WAR/EJB。

* * *

## 回答 #67

> 赞同：1
> 
> 时间：2009-06-22T14:39:59.133

绝对是魔术和重载方法。Alllain 引用了 __get()、__set()、__call() 和 __toString()，但我也喜欢 __wakeup() 和 __sleep()。

当对象被序列化（睡眠）和反序列化（唤醒）时，就会调用这个神奇的方法。这个特性能够制作像我在应用程序中使用的可序列化数据库包装器这样的东西：

```
Class Connection {
   private $dsn;
   private $connection;
   ...
   public __wakeup() {
      $this->connection = ADONewConnection();
   }
} 
```

通过这种方式，我可以在 $_SESSION 等中“保存”连接。

* * *

## 回答 #68

> 赞同：1
> 
> 时间：2009-06-22T14:54:24.300

php 中的 json_encode/decode 函数非常有用，虽然不是很隐蔽。

* * *

## 回答 #69

> 赞同：1
> 
> 时间：2010-01-29T11:02:34.503

**可堆叠单元文件**

```
<?
// file unit1.php
$this_code='does something.';
?>

<?
// file unit2.php
$this_code='does something else. it could be a PHP class object!';
?>

<?
// file unit3.php
$this_code='does something else. it could be your master include file';
require_once('unit2.php');
include('unit1.php');
?>

<?
// file main.php
include('unit1.php');
require_once('unit2.php');
require_once('unit3.php');
?> 
```

我故意交替使用 include 和 require_once 来展示可以做什么，因为它们的工作方式不同。

有多种方法可以构建代码或将文件添加到代码中。甚至可以将 HTML、AJAX、CSS、JAVASCRIPT、IMAGES 和各种文件动态链接到您的代码中。

我特别喜欢它，因为也没有将包含/要求放在开头、中间或结尾的要求。这允许更大的自由度，具体取决于用途。

* * *

## 回答 #70

> 赞同：0
> 
> 时间：2010-01-25T19:01:10.683

魔术方法**__callStatic**。

制作单例真的很有用，比如这个[PDO 单例类](http://www.php.net/manual/en/book.pdo.php#93178)

* * *

## 回答 #71

> 赞同：0
> 
> 时间：2010-01-25T23:05:00.223

关于原帖的问题：为什么需要一个 switch 语句来重载 PHP 中的方法？也许您所说的“重载”一词与我从 C++ 中学到的不符。

至于 PHP 最喜欢的特性，我喜欢 Exception 对象。我发现拥有一个标准错误容器可以更轻松地将表示逻辑与业务逻辑分离，并且 throw/catch 语法可以更轻松地为每个单独的类编写自动化测试。

* * *

## 回答 #72

> 赞同：0
> 
> 时间：2010-01-22T09:32:32.117

另一个不错的功能是[copy()](http://php.net/manual/en/function.copy.php)。此功能可以从任何地方获取文件（甚至 url 都可以）并将其复制到本地资源。所以抓取文件变得非常容易。

* * *

## 回答 #73

> 赞同：0
> 
> 时间：2009-06-22T01:07:27.570

这很棒：

```
//file page_specific_funcs.inc

function doOtherThing(){

}

class MyClass{

}

//end file

//file.php

function doSomething(){
  include("page_specific_funcs.inc");

  $var = new MyClass(); 

}
//end of file.php 
```

> “page_specific_funcs.inc”文件仅在 doSomething 被调用**时才包含。**方法内部的类、函数等的声明完美地工作。

* * *

## 回答 #74

> 赞同：0
> 
> 时间：2010-02-23T20:39:30.643

使用[cURL](http://us.php.net/manual/en/book.curl.php)设置测试套件来驱动大型、复杂的 Web 表单及其后端应用程序。测试是详尽的——至少在执行可接受输入的每一种组合方面。

* * *

## 回答 #75

> 赞同：-1
> 
> 时间：2009-06-27T15:55:38.733

我喜欢 php 的隐藏功能： 1\. 易于学习（也容易误用它.. 即：不良的编程习惯。就像你可以输入 $something = "1" ; 然后你做了 $something += 3 ; 和突然 $something 变成一个整数 .. 没有错误消息/异常异常，就像 java 中的那些）

2.  很多图书馆。去phpclasses.org，我几乎从那里得到了一切。
3.  很多网站都在使用它。爱它或恨它..这就是事实！:)
4.  简单、小巧、易于维护。您只需在便携式设备上安装 xampplite + vim（我最喜欢的）。
5.  便宜的 ！！！像啤酒一样便宜……例如：托管。与 java 或 .net 主机相比，php 主机非常便宜，您可以从一些网站免费获得一个（尽管他们会在您的网站内放置一些横幅/隐藏的东西）
6.  php 的文档非常好！！这是我坚持使用 php 大约 6 年的主要原因（尽管我使用 Groovy/Grails 做了一些项目）

* * *

## 回答 #76

> 赞同：-2
> 
> 时间：2010-06-28T20:32:44.770

您可以在使用 switch 语句时检查每个选项，这是一个示例：

```
$check = "HELLO";

switch ($check) {
       case (eregi('HI', $check)):
             echo "Write HI!";
       case (eregi('HELLO', $check)):
             echo "Write HELLO!";
       case (eregi('OTHER', $check)):
             echo "Write OTHER!";
} 
```

再见...

* * *

## 回答 #77

> 赞同：-4
> 
> 时间：2009-06-22T05:51:07.807

Boolean casting, which is particularly helpful for redwall_hp's first example, above.

Instead of:

```
$var = ($_POST['my_checkbox']=='checked') ? TRUE : FALSE; 
```

You can type:

```
$var = !!($_POST['my_checkbox']=='checked'); 
```

* * *

## 回答 #78

> 赞同：-5
> 
> 时间：2009-06-22T14:34:54.263

据我所知，您可以在函数调用中隐式参数类型：

```
function getInt(int $v)
{
     echo $v;
}

getInt(5); // will work
getInt('hello'); // will fail 
```

# c++ - C++ 异常代码查找

> ID：61402
> 
> 赞同：1
> 
> 时间：2008-09-14T15:21:34.457
> 
> 标签：c++, exception, visual-c++, crash, memory-dump

了解异常代码后，有没有办法进一步了解引发的实际异常意味着什么？

我有问题的例外：0x64487347

异常地址：0x1

调用堆栈不显示任何信息。

我正在查看崩溃的 .dmp，但实际上并未在 Visual Studio 中进行调试。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T14:29:17.367

从 Microsoft 运行时抛出的真正 C++ 异常将具有 0xe06d7363 (E0 + 'msc') 的 SEH 代码。你还有其他一些例外。

.NET 使用代码 0xe0434f4d (E0 + 'COM') 生成 SEH 异常。

NT 的状态码记录在 ntstatus.h 中，一般从 0x80（警告）或 0xC0（错误）开始。最著名的是0xC0000005，STATUS_ACCESS_VIOLATION。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-14T16:13:31.930

因为您正在查看故障转储，所以我假设它来自客户，您无法通过更多工具轻松重现故障。

除了注意异常代码 0x64487347 是 ASCII“dShG”之外，我没有太多帮助，开发人员在制作这样的幻数时经常使用例程或故障条件的首字母。

稍微用谷歌搜索一下，在适当的上下文中找到了一个 dHsg，这是在 Google 图书搜索“使用 Visual C++ 6”中的函数名称，作者是 Kate Gregory。不幸的是，仅此一项并没有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T15:59:08.157

如果您知道哪个块引发了异常，您可以在 catch 块中放置更多特定的处理程序来尝试以这种方式隔离它吗？

您是否抛出了自己滚动的异常？

编辑：我忘了向你指出[这篇](http://www.codeproject.com/Articles/2126/How-a-C-compiler-implements-exception-handling)关于 Visual C++ 异常的文章，我发现它非常有用。

抢

# qt - 如何使用 Qt 制作子项目？

> ID：61405
> 
> 赞同：15
> 
> 时间：2008-09-14T15:26:19.343
> 
> 标签：qt

我即将开始一个大型 Qt 应用程序，它由较小的组件（一起工作的类组）组成。例如，项目中可能使用了一个对话框，但在集成到项目之前应该自行开发。我可以创建一个专用于该对话框的子文件夹，然后以某种方式将其合并到主项目中，而不是在某个地方的另一个文件夹中处理它然后将其复制到主项目文件夹中吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-15T09:09:49.427

这就是我要做的。假设我想要以下文件夹层次结构：

```
/MyWholeApp 
```

将包含整个应用程序的文件。

```
/MyWholeApp/DummyDlg/ 
```

将包含独立对话框的文件，该对话框最终将成为整个应用程序的一部分。

我会开发独立的对话框和相关的类。我将创建一个包含在内的 Qt 项目文件。它将仅包含最终将成为整个应用程序一部分的表单和文件。

文件 DummyDlg.pri，位于 /MyWholeApp/DummyDlg/ 中：

```
# Input
FORMS += dummydlg.ui
HEADERS += dummydlg.h
SOURCES += dummydlg.cpp 
```

上面的例子很简单。如果需要，您可以添加其他类。

为了开发独立对话框，我将创建一个专用于该对话框的 Qt 项目文件：

文件 DummyDlg.pro，在 /MyWholeApp/DummyDlg/ 中：

```
TEMPLATE = app
DEPENDPATH += .
INCLUDEPATH += .

include(DummyDlg.pri)

# Input
SOURCES += main.cpp 
```

如您所见，此 PRO 文件包括上面创建的 PRI 文件，并添加了一个附加文件 (main.cpp)，其中包含作为独立运行对话框的基本代码：

```
#include <QApplication>
#include "dummydlg.h"

int main(int argc, char* argv[])
{
    QApplication MyApp(argc, argv);

    DummyDlg MyDlg;
    MyDlg.show();
    return MyApp.exec();
} 
```

然后，要将这个对话框包含到整个应用程序中，您需要创建一个 Qt-Project 文件：

文件 WholeApp.pro，在 /MyWholeApp/ ：

```
TEMPLATE = app
DEPENDPATH += . DummyDlg
INCLUDEPATH += . DummyDlg

include(DummyDlg/DummyDlg.pri)

# Input
FORMS += OtherDlg.ui
HEADERS += OtherDlg.h
SOURCES += OtherDlg.cpp WholeApp.cpp 
```

当然，上面的 Qt-Project 文件非常简单，但显示了我是如何包含独立对话框的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-14T15:50:10.987

是的，您可以编辑主项目 (.pro) 文件以包含子项目的项目文件。

[看这里](http://doc.qt.io/qt-4.8/qmake-project-files.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T15:49:06.527

对于 Windows 上的 Qt，您可以为所需的每个子项目创建 DLL。之后从主项目（exe）中使用它们没有问题。您必须处理依赖关系，但这并不是很困难。

# delphi - 如何在 Delphi 中禁用关于“返回值......可能未定义”的警告？

> ID：61418
> 
> 赞同：8
> 
> 时间：2008-09-14T15:40:38.060
> 
> 标签：delphi, warnings, directive

我有一个功能给我以下警告：

> [DCC 警告] filename.pas(6939): W1035 函数“function”的返回值可能未定义

然而，这个函数是干净的、小的，并且确实有一个已知的、预期的返回值。函数中的第一条语句是：

```
Result := ''; 
```

并且也没有调用局部变量或参数`Result`。

是否有任何类似编译指示的指令我可以围绕这个方法来删除这个警告？这是德尔福 2007。

不幸的是，此 Delphi 安装的帮助系统无法正常工作，因此我现在无法弹出该警告的帮助。

任何人都知道我能做什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-14T15:49:57.837

您确定您已尽一切努力解决警告吗？也许您可以发布代码供我们查看？

您可以通过这种方式在本地关闭警告：

```
{$WARN NO_RETVAL OFF}
function func(...): string;
begin
  ...
end;
{$WARN NO_RETVAL ON} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T06:21:32.477

我不确定我是否想查看这个单元的代码……毕竟，错误发生在第 6939 行……可能超出了某些内部编译器表？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-14T15:49:19.147

Delphi中似乎存在某种错误。阅读这篇文章，最后一条评论链接到其他错误报告，这可能是你得到的：

[http://qc.codegear.com/wc/qcmain.aspx?d=8144](http://qc.codegear.com/wc/qcmain.aspx?d=8144)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T03:00:39.470

{$WARN NO_RETVAL OFF} 是您要查找的内容，但通常我喜欢找出发生这种情况的原因。您可能会考虑以不同的方式对其进行格式化，看看是否有帮助。

你有没有像 Exit 这样的流量改变命令？您是否直接引发异常等？您的 case 语句最后是否有一个 else 来设置 Result 的值？

可能会尝试调整这些元素，看看是否也消除了警告。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T21:08:14.910

为了得到一个好的答案，你必须发布代码。通常，如果存在可能导致未定义结果的代码路径，Delphi 编译器将给出此警告。有时该代码路径不太明显。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-25T16:45:57.330

Delphi 编译器至少从 Delphi4 开始就有这样的错误：如果函数参数（包括 Self 和 Result）和局部变量的数量之和超过 31，则会导致问题。例如，它可以写入 W1035 警告（结果可能未定义）。它可能会错过未使用的变量。试试这个项目：

```
program TestCompilerProblems;

procedure Proc;
var
  a01, a02, a03, a04, a05, a06, a07, a08, a09, a10,
  a11, a12, a13, a14, a15, a16, a17, a18, a19, a20,
  a21, a22, a23, a24, a25, a26, a27, a28, a29, a30,
  a31, a32, a33, a34, a35, a36, a37, a38, a39, a40: Integer;
begin
end;

begin
  Proc;
end. 
```

它将导致 31 个提示，而不是 40 个。

# .net - 如何让 ListBox 刷新其项目文本？

> ID：61421
> 
> 赞同：44
> 
> 时间：2008-09-14T15:43:14.280
> 
> 标签：.net, winforms, user-interface

我正在为尚未意识到控件之类的控件`ListBox`不必包含字符串的人举个例子；他一直在存储格式化的字符串并跳过复杂的解析箍以将数据从其中取出，`ListBox`我想向他展示有更好的方法。

我注意到，如果我有一个对象存储在`ListBox`then 更新一个影响 的值，`ToString`则`ListBox`不会更新自身。我试过打电话`Refresh`和`Update`控制，但都不管用。这是我正在使用的示例的代码，它需要您将列表框和按钮拖到表单上：

```
Public Class Form1

    Protected Overrides Sub OnLoad(ByVal e As System.EventArgs)
        MyBase.OnLoad(e)

        For i As Integer = 1 To 3
            Dim tempInfo As New NumberInfo()
            tempInfo.Count = i
            tempInfo.Number = i * 100
            ListBox1.Items.Add(tempInfo)
        Next
    End Sub

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        For Each objItem As Object In ListBox1.Items
            Dim info As NumberInfo = DirectCast(objItem, NumberInfo)
            info.Count += 1
        Next
    End Sub
End Class

Public Class NumberInfo

    Public Count As Integer
    Public Number As Integer

    Public Overrides Function ToString() As String
        Return String.Format("{0}, {1}", Count, Number)
    End Function
End Class
```

我认为问题可能出在使用字段并尝试实现*INotifyPropertyChanged*，但这没有效果。（我使用字段的原因是因为它是一个示例，我不想添加与我正在演示的主题无关的几十行。）

老实说，我以前从未尝试过像这样更新项目；过去我一直在添加/删除项目，而不是编辑它们。所以我从来没有注意到我不知道如何使这项工作。

那么我错过了什么？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-14T23:27:51.993

当我需要一个更新的列表框时，我会使用这个类。

更新列表中的对象，然后调用任一包含的方法，具体取决于您是否有可用的索引。如果要更新列表中包含的对象，但没有索引，则必须调用 RefreshItems 并更新所有项目。

```
public class RefreshingListBox : ListBox
{
    public new void RefreshItem(int index)
    {
        base.RefreshItem(index);
    }

    public new void RefreshItems()
    {
        base.RefreshItems();
    }
} 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2010-11-26T14:06:50.787

```
lstBox.Items[lstBox.SelectedIndex] = lstBox.SelectedItem; 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2010-01-25T20:09:43.900

BindingList 自己处理更新绑定。

```
using System;
using System.ComponentModel;
using System.Windows.Forms;

namespace TestBindingList
{
    public class Employee
    {
        public string Name { get; set; }
        public int Id { get; set; }
    }

    public partial class Form1 : Form
    {
        private BindingList<Employee> _employees;

        private ListBox lstEmployees;
        private TextBox txtId;
        private TextBox txtName;
        private Button btnRemove;

        public Form1()
        {
            InitializeComponent();

            FlowLayoutPanel layout = new FlowLayoutPanel();
            layout.Dock = DockStyle.Fill;
            Controls.Add(layout);

            lstEmployees = new ListBox();
            layout.Controls.Add(lstEmployees);

            txtId = new TextBox();
            layout.Controls.Add(txtId);

            txtName = new TextBox();
            layout.Controls.Add(txtName);

            btnRemove = new Button();
            btnRemove.Click += btnRemove_Click;
            btnRemove.Text = "Remove";
            layout.Controls.Add(btnRemove);

            Load+=new EventHandler(Form1_Load);
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            _employees = new BindingList<Employee>();
            for (int i = 0; i < 10; i++)
            {
                _employees.Add(new Employee() { Id = i, Name = "Employee " + i.ToString() }); 
            }

            lstEmployees.DisplayMember = "Name";
            lstEmployees.DataSource = _employees;

            txtId.DataBindings.Add("Text", _employees, "Id");
            txtName.DataBindings.Add("Text", _employees, "Name");
        }

        private void btnRemove_Click(object sender, EventArgs e)
        {
            Employee selectedEmployee = (Employee)lstEmployees.SelectedItem;
            if (selectedEmployee != null)
            {
                _employees.Remove(selectedEmployee);
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2011-01-08T00:02:04.513

```
typeof(ListBox).InvokeMember("RefreshItems", 
  BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.InvokeMethod,
  null, myListBox, new object[] { }); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-14T15:49:27.040

在数据源和列表框的数据源属性之间使用数据源属性和 BindingSource 对象。然后刷新它。

**更新**添加示例。

像这样：

```
Public Class Form1

    Private datasource As New List(Of NumberInfo)
    Private bindingSource As New BindingSource

    Protected Overrides Sub OnLoad(ByVal e As System.EventArgs)
        MyBase.OnLoad(e)

        For i As Integer = 1 To 3
            Dim tempInfo As New NumberInfo()
            tempInfo.Count = i
            tempInfo.Number = i * 100
            datasource.Add(tempInfo)
        Next
        bindingSource.DataSource = datasource
        ListBox1.DataSource = bindingSource
    End Sub

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        For Each objItem As Object In datasource
            Dim info As NumberInfo = DirectCast(objItem, NumberInfo)
            info.Count += 1
        Next
        bindingSource.ResetBindings(False)
    End Sub
End Class

Public Class NumberInfo

    Public Count As Integer
    Public Number As Integer

    Public Overrides Function ToString() As String
        Return String.Format("{0}, {1}", Count, Number)
    End Function
End Class 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-14T23:05:34.153

如果您从 ListBox 派生，则可以调用 RefreshItem 受保护的方法。只需在您自己的类型中重新公开此方法即可。

```
public class ListBox2 : ListBox {
    public void RefreshItem2(int index) {
        RefreshItem(index);
    }
} 
```

然后更改您的设计器文件以使用您自己的类型（在本例中为 ListBox2）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-30T19:03:43.827

这有点不专业，但它确实有效。我刚刚删除并添加了该项目（也再次选择了它）。该列表是根据“显示和更改”属性排序的，所以对我来说也很好。副作用是引发了额外的事件（索引更改）。

```
if (objLstTypes.SelectedItem != null)
{
 PublisherTypeDescriptor objType = (PublisherTypeDescriptor)objLstTypes.SelectedItem;
 objLstTypes.Items.Remove(objType);
 objLstTypes.Items.Add(objType);
 objLstTypes.SelectedItem = objType;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-03-12T11:05:30.510

如果您使用如下绘制方法：

```
private void listBox1_DrawItem(object sender, DrawItemEventArgs e)
{
    e.DrawBackground();
    e.DrawFocusRectangle();

    Sensor toBeDrawn = (listBox1.Items[e.Index] as Sensor);
    e.Graphics.FillRectangle(new SolidBrush(toBeDrawn.ItemColor), e.Bounds);
    e.Graphics.DrawString(toBeDrawn.sensorName, new Font(FontFamily.GenericSansSerif, 14, FontStyle.Bold), new SolidBrush(Color.White),e.Bounds);
} 
```

传感器是我的课。

因此，如果我在某处更改课程`Color`，您可以简单地将其更新为：

```
int temp = listBoxName.SelectedIndex;
listBoxName.SelectedIndex = -1;
listBoxName.SelectedIndex = temp; 
```

并且`Color`将更新，只是另一种解决方案:)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-14T17:00:12.393

我对 vb.net 了解不多，但在 C# 中你应该使用数据源，然后通过调用绑定它就`listbox.bind()`可以了。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2009-06-14T20:06:26.900

如果 objLstTypes 是您的 ListBox 名称使用 objLstTypes.Items.Refresh(); 希望这有效...

# open-source - BizTalk Server 有哪些可行的替代方案？

> ID：61437
> 
> 赞同：45
> 
> 时间：2008-09-14T16:18:52.820
> 
> 标签：open-source, biztalk

在评估不同的系统集成策略时，我听到了一些鼓励的话，但也遇到了一些对 BizTalk Server 感到沮丧的词。

使用 BizTalk Server 有哪些优点和缺点（无论是从开发人员的角度还是从业务用户的角度），公司是否也应该考虑使用开源替代方案？有哪些可行的替代方案？

编辑：[Jitterbit](http://www.jitterbit.com/)似乎是一个有趣的选择。开源，似乎设计得很好。这里的任何人都有使用它的经验吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-06-05T16:27:31.563

BizTalk Server 的主要优势在于它提供了大量围绕部署、管理、性能和可伸缩性的“管道”。通过 Visual Studio，它还为开发解决方案提供了一个全面的框架，通常只需要很少的代码。

其他人提到的挫折和陡峭的学习曲线通常来自于错误地使用 BizTalk 以及对如何使用 BizTalk 和一般面向消息的系统的误解。学习曲线并不像大多数人所说的那么陡峭——基础学习的基本部分实际上侧重于将思维从程序方法转变为无状态的基于消息的方法。

人们经常提到的一个缺点是成本。标价似乎相当高；但是，与您自己开发和支持功能所花费的金额相比，这很便宜。

在考虑替代方案或什至考虑 BizTalk 服务器之前，您应该考虑组织的集成方法及其长期目标。BizTalk Server 非常适合您想要使用中心辐射模型集成系统的情况，其中 BizTalk 协调许多应用程序的活动。

还有其他集成模型——其中一种更流行的是分布式总线（不要将其与术语“企业服务总线”或 ESB 混淆）。您还可以让 BizTalk 作为分布式总线工作，并且有替代解决方案可以提供更直接的支持。替代解决方案之一是称为 nServiceBus 的开源解决方案。

在考虑是否使用像 BizTalk 这样的商业产品时，除了其他东西（开源或内部开发），还要考虑维护和增强以及市场上必要技能集的可用性。

我写了一些文章，更详细地介绍了我在这里讨论的要点 - 以下是链接：

*   [为什么选择 BizTalk？](https://web.archive.org/web/20110210195911/http://artofbabel.com/specials/50-why-biztalk.html)
*   [十大 BizTalk 错误](https://web.archive.org/web/20100913035417/http://artofbabel.com/columns/top-x/49-top-10-biztalk-server-mistakes.html)
*   [BizTalk Server 中的可扩展性功能](https://web.archive.org/web/20110210194635/http://artofbabel.com/specials/58-extensibilityfeaturesinbiztalkserver.html)
*   [与 nServiceBus 的开源集成](https://web.archive.org/web/20120314180441/http://artofbabel.com/specials/55-open-source-integration-with-nservicebus.html)

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-14T16:40:48.090

我对 BizTalk 的体验基本上是一种令人沮丧的浪费时间。

当您进行 B2B 数据集成（这可能是任何企业应用程序中最难的部分）时，您必须进行很多边缘案例和奇怪的小业务逻辑调整，您只需要推出自己的解决方案。

解析数据文件并将它们转换为不同的格式有多难？没那么难。除非您尝试将 Biztalk 之类的臃肿中间件系统注入其中。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-26T11:00:02.323

作为一名 BizTalk 顾问，我必须至少部分同意 Eric Z Beard 的观点，有很多边缘情况会占用大量时间。但也有不少场景处理得非常顺利，所以这一切都取决于 IMO。但是当你（埃里克）称 BizTalk 臃肿时，我不得不不同意！我们发现它的性能和可靠性非常好，它很灵活，并且配备了许多开箱即用的优质适配器。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-12-09T23:06:27.510

BizTalk 需要正确使用，我是一名 BizTalk 开发人员，我对 BizTalk 的体验非常好。它可靠、高性能、可扩展，包含许多内置架构模式和内置组件，使集成变得简单快捷，您可以获得安全性、重试、二次传输、验证、转换等......以及您没有内置的东西使用 BizTalk，您可以轻松地使用 .NET 代码进行自定义，它基本上是一个来之不易的集成系统，您可以在一个盒子中获得所有这些。但是您需要知道如何正确实施 BizTalk，而不是在我遇到实施且通常架构不正确的解决方案时。

但 BizTalk 的真正好处是您可以实施小型解决方案并扩大规模，而来自大供应商的大多数其他集成系统只会出售整个集成包，而这可能会花费更多。

BizTalk 被认为是微软公司最复杂的服务器。

所以任何说 BizTalk 不好的人都知道 BizTalk 时期。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-09T20:10:48.630

我们评估了我们公司的 BizTalk，并感到非常失望。

我们正在使用 IBM WebSphere Transformation Extender（它也有很多（其他）问题），而 BizTalk 的映射工具与 WTX 相比简直就是个笑话。

图形工具实际上不适用于复杂的映射（我们有数百个重复组中的字段的模式），如果您做的比通常的“连接名字和姓氏”映射更多，您将厌倦图形方法（例如，图形映射器中 functoids 的参数没有标记，并且将字段连接到这些参数的顺序很重要）。

XSLT-Mapper 是可用的，但并不真正令人信服，甚至微软代表也告诉我们使用 XMLSpy 之类的工具进行 XSLT 并将生成的 XSL 文件加载到 BizTalk 中。

第三种映射方法是使用 C#-Code 进行映射，这对于我们来说作为一般方法是不可接受的（我们不想教每个人 C#）。

除了映射工具，我们不喜欢 BizTalk 中的部署。为了部署您的流程，您需要在不同的工具和位置进行大量设置。我们曾希望在 BizTalk 中为 Java Web 应用程序找到一种类似 WAR 文件的机制，以便您可以将您的整个流程解决方案的存档提供给您的管理员，他可以进行部署。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-16T18:38:05.650

我们从 2004 版开始就一直在使用 BizTalk，现在混合使用了 2006 R2 和 2004 版本。我发现学习曲线非常严峻，解决方案的开发时间并不总是很快。这些绝对是缺点。BizTalk 真正擅长的地方在于它的容错性、保证交付和性能。您可以放心，数据不会丢失。重试功能和容错鲁棒性是内置的，所以一般来说，如果系统出现故障，BizTalk 将处理该问题，并且一旦系统重新上线，就会成功交付。所有这些在集成方案中很重要的问题（例如停机时间等）都由 BizTalk 处理。
此外，一般来说，在开发解决方案时，BizTalk 通过将所有内容都作为 xml 处理来抽象本机系统的通信协议和数据格式，因此在开发解决方案时，您通常不必编写特定于这些系统的代码，您可以使用 BizTalk xml框架。

去年，我们为我们的 HL7 路由实现了一个名为[Mirth的 Java 开源引擎。](http://www.mirthproject.org/)我发现对于 HL7 而言，用于 BizTalk 的 HL7 适配器​​是一个挑战。管理层表示我们使用 Mirth 进行 HL7 路由。BizTalk 在学习曲线方面下降的地方，Mirth 弥补了。开发解决方案要容易得多。mirth 的问题在于它实际上并没有任何保证交付。大多数适配器（除了 hl7）都没有重试功能，所以如果你想要，你必须自己编写。其次，如果 Mirth 出现故障，它可能会丢失日期。我认为它非常易于使用（尽管没有文档），但我很难将其称为企业解决方案。我要去看看[jitterbit](http://www.jitterbit.com)这是别人提到的。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-15T20:58:42.203

我们使用了 BizTalk 几年，但为了我们自己的自定义框架而放弃了它，该框架允许更大的灵活性。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-05-08T15:22:07.847

总是有 Sun（现在是 Oracle）的[OpenESB](https://open-esb.dev.java.net/)框架。一般来说，它是 Biztalk 的更小、更轻的版本，但功能大致相同。

不过，您确实可以用它编写更多代码。

它也是开源的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-15T08:02:18.827

在 OSS 领域（尽管我个人从未将它们用作 BizTalk 的替代品 - 这是轶事），您可以使用 Java/J2EE 消息传递引擎之一，例如[OpenMQ](https://mq.dev.java.net/)（它是 Sun 企业的一个重新标记并且没有支持）。如果您需要在此之上进行编排/编排（即 SOA/ESB 部分），您可以查看[Apache Mule之类的东西](http://www.mulesource.org/display/MULE/Home)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-12-14T19:55:19.377

我在 BizTalk 和 B2B 集成方面的经验是，大多数组织并没有真正进行架构优先设计或完全理解 xml 标准。大多数人倾向于编织对象并希望它们具体化为有意义的模式。在企业环境中，这是倒退的。

BizTalk 确实有一个学习曲线，但是一旦你得到它，你就会得到持久性、性能、真正的可伸缩性和可扩展性的回报。就像大多数人所说的那样，最好确保它满足您的需求并将您的需求扭曲到 BizTalk。

过去，我使用 BizTalk 2004 到 2009 年，以及另一个名为 webMethods 的产品。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T08:12:31.517

我没有使用 JitterBit 的直接经验，但我从同事那里听到了很好的消息。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-23T14:04:49.703

我在寻找比 BizTalk 更便宜的解决方案时遇到了 Apatar（无法发布 url，但谷歌找到了）。我还没有尝试过。

我上一家公司在 BizTalk 过于复杂和棱角分明方面遇到了很多问题，但我不禁认为这主要是由于顾问所做的实施。

# c++ - 翻转安全计时器（滴答）比较

> ID：61443
> 
> 赞同：11
> 
> 时间：2008-09-14T16:23:22.810
> 
> 标签：c++, c, timer, rollover, embedded

我有一个硬件计数器，我可以观察到时间考虑。它以毫秒为单位，以 16 位无符号值存储。如何安全地检查计时器值是否已经过了一定时间并安全地处理不可避免的翻转：

```
//this is a bit contrived, but it illustrates what I'm trying to do
const uint16_t print_interval = 5000; // milliseconds
static uint16_t last_print_time;   

if(ms_timer() - last_print_time > print_interval)
{
    printf("Fault!\n");
    last_print_time = ms_timer();
} 
```

当 ms_timer 溢出为 0 时，此代码将失败。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-14T19:14:09.997

你实际上不需要在这里做任何事情。`ms_timer()`假设返回 uint16_t 类型的值，您的问题中列出的原始代码可以正常工作。

（还假设计时器在检查之间不会溢出两次......）

为了说服自己是这种情况，请尝试以下测试：

```
uint16_t t1 = 0xFFF0;
uint16_t t2 = 0x0010;
uint16_t dt = t2 - t1; 
```

`dt`将等于`0x20`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-06-04T18:01:32.313

我使用此代码使用签名比较来说明错误和可能的解决方案。

```
/* ========================================================================== */
/*   timers.c                                                                 */
/*                                                                            */
/*   Description: Demonstrate unsigned vs signed timers                       */
/* ========================================================================== */

#include <stdio.h>
#include <limits.h>

int timer;

int HW_DIGCTL_MICROSECONDS_RD()
{
  printf ("timer %x\n", timer);
  return timer++;
}

// delay up to UINT_MAX
// this fails when start near UINT_MAX
void delay_us (unsigned int us)
{
    unsigned int start = HW_DIGCTL_MICROSECONDS_RD();

    while (start + us > HW_DIGCTL_MICROSECONDS_RD()) 
      ;
}

// works correctly for delay from 0 to INT_MAX
void sdelay_us (int us)
{
    int start = HW_DIGCTL_MICROSECONDS_RD();

    while (HW_DIGCTL_MICROSECONDS_RD() - start < us) 
      ;
}

int main()
{
  printf ("UINT_MAX = %x\n", UINT_MAX);
  printf ("INT_MAX  = %x\n\n", INT_MAX);

  printf ("unsigned, no wrap\n\n");
  timer = 0;
  delay_us (10);

  printf ("\nunsigned, wrap\n\n");
  timer = UINT_MAX - 8;
  delay_us (10);

  printf ("\nsigned, no wrap\n\n");
  timer = 0;
  sdelay_us (10);

  printf ("\nsigned, wrap\n\n");
  timer = INT_MAX - 8;
  sdelay_us (10);

} 
```

样本输出：

```
bob@hedgehog:~/work2/test$ ./timers|more
UINT_MAX = ffffffff
INT_MAX  = 7fffffff

unsigned, no wrap

timer 0
timer 1
timer 2
timer 3
timer 4
timer 5
timer 6
timer 7
timer 8
timer 9
timer a

unsigned, wrap

timer fffffff7
timer fffffff8

signed, no wrap

timer 0
timer 1
timer 2
timer 3
timer 4
timer 5
timer 6
timer 7
timer 8
timer 9
timer a

signed, wrap

timer 7ffffff7
timer 7ffffff8
timer 7ffffff9
timer 7ffffffa
timer 7ffffffb
timer 7ffffffc
timer 7ffffffd
timer 7ffffffe
timer 7fffffff
timer 80000000
timer 80000001
bob@hedgehog:~/work2/test$ 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-08-24T03:21:01.897

我曾经为这种情况编写如下代码。
我用测试用例进行了测试，并确保它 100% 有效。
此外，在下面的代码中使用 32 位计时器滴答声更改为`uint32_t`from`uint16_t`和`0xFFFFFFFF`from 。`0xFFFF`

```
uint16_t get_diff_tick(uint16_t test_tick, uint16_t prev_tick)
{
    if (test_tick < prev_tick)
    {
        // time rollover(overflow)
        return (0xFFFF - prev_tick) + 1 + test_tick;
    }
    else
    {
        return test_tick - prev_tick;
    }
}

/* your code will be.. */
uint16_t cur_tick = ms_timer();
if(get_diff_tick(cur_tick, last_print_time) > print_interval)
{
    printf("Fault!\n");
    last_print_time = cur_tick;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-14T16:25:59.293

只需检查 ms_timer < last_print_time 是否添加 2^16 否？

编辑：如果可以的话，你还需要一个 uint32 。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-14T16:57:21.323

避免该问题的最安全方法可能是使用带符号的 32 位值。要使用您的示例：

```
const int32 print_interval = 5000;
static int32 last_print_time; // I'm assuming this gets initialized elsewhere

int32 delta = ((int32)ms_timer()) - last_print_time; //allow a negative interval
while(delta < 0) delta += 65536; // move the difference back into range
if(delta < print_interval)
{
    printf("Fault!\n");
    last_print_time = ms_timer();
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-14T17:03:39.797

这似乎适用于高达 64k/2 的间隔，适合我：

```
const uint16_t print_interval = 5000; // milliseconds
static uint16_t last_print_time;   

int next_print_time = (last_print_time + print_interval);

if((int16_t) (x - next_print_time) >= 0)
{
    printf("Fault!\n");
    last_print_time = x;
} 
```

利用有符号整数的性质。（[二进制补码](http://en.wikipedia.org/wiki/Twos_complement)）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T19:42:34.173

我发现使用不同的计时器 API 对我来说效果更好。我创建了一个定时器模块，它有两个 API 调用：

```
void timer_milliseconds_reset(unsigned index);
bool timer_milliseconds_elapsed(unsigned index, unsigned long value); 
```

计时器索引也在计时器头文件中定义：

```
#define TIMER_PRINT 0
#define TIMER_LED 1
#define MAX_MILLISECOND_TIMERS 2 
```

我将 unsigned long int 用于我的计时器计数器（32 位），因为这是我的硬件平台上的本机大小的整数，这使我经过的时间从 1 毫秒到大约 49.7 天。您可以拥有 16 位的计时器计数器，它可以为您提供从 1 毫秒到大约 65 秒的经过时间。

定时器计数器是一个数组，由硬件定时器递增（中断、任务或轮询计数器值）。它们可以限制为处理无翻转计时器增量的函数中数据类型的最大值。

```
/* variable counts interrupts */
static volatile unsigned long Millisecond_Counter[MAX_MILLISECOND_TIMERS];
bool timer_milliseconds_elapsed(
    unsigned index,
    unsigned long value)
{
    if (index < MAX_MILLISECOND_TIMERS) {
        return (Millisecond_Counter[index] >= value);
    }
    return false;
}

void timer_milliseconds_reset(
    unsigned index)
{
    if (index < MAX_MILLISECOND_TIMERS) {
        Millisecond_Counter[index] = 0;
    }
} 
```

然后你的代码变成：

```
//this is a bit contrived, but it illustrates what I'm trying to do
const uint16_t print_interval = 5000; // milliseconds

if (timer_milliseconds_elapsed(TIMER_PRINT, print_interval)) 
{
    printf("Fault!\n");
    timer_milliseconds_reset(TIMER_PRINT);
} 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2012-08-11T04:28:07.337

有时我会这样做：

```
#define LIMIT 10   // Any value less then ULONG_MAX
ulong t1 = tick of last event;
ulong t2 = current tick;

// This code needs to execute every tick
if ( t1 > t2 ){
    if ((ULONG_MAX-t1+t2+1)>=LIMIT){
       do something
    }
} else {
if ( t2 - t1 >= LIMT ){
    do something
} 
```

# emacs - Emacs 最好的代码模板工具是什么？

> ID：61446
> 
> 赞同：30
> 
> 时间：2008-09-14T16:27:21.880
> 
> 标签：emacs, template-engine, code-snippets

特别是，那里最好的片段包是什么？

特征：

*   易于定义新的片段（纯文本、带默认值的自定义输入）
*   片段中预定义位置之间的简单导航
*   多次插入相同的自定义输入
*   接受当前选定的文本作为自定义输入
*   *跨平台*（Windows、Linux）
*   用简洁的编程语言（首选 Perl、Python、Ruby）编写的动态评估表达式（嵌入代码）
*   与 Emacs 中的其他包很好地共存

代码模板示例，C 中的一个简单`for`循环：

```
for (int i = 0; i < %N%; ++i) {
  _
} 
```

这种通用代码需要大量输入。我想调用一个代码模板或片段来为我插入该样板代码。此外，它在（我的输入替换它）处停止（在 TAB 或其他击键上），`%N%`光标的最终位置是`_`.

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-14T16:30:24.150

[TextMate 的代码片段](http://manual.macromates.com/en/snippets)是最接近的匹配项，但它不是跨平台解决方案，也不适用于 Emacs。

第二个最接近的是[YASnippet](http://github.com/joaotavora/yasnippet/ "Emacs 的另一个 Snippet 包")（[截屏](http://www.youtube.com/watch?v=vOj7btx3ATg "yasnippet 截屏视频")显示了主要功能）。但它干扰了`hippie-expand`我的设置中的包，并且嵌入的语言是 EmacsLisp，我不习惯在外面`.emacs`。

**编辑**：在这里发布我的答案以允许投票`YASnippet`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T16:04:54.750

就个人而言，我多年来一直在使用 Dmacro ( [ftp://ftp.sgi.com/other/dmacro/dmacro.tar.gz](ftp://ftp.sgi.com/other/dmacro/dmacro.tar.gz) )。

这是对它的评论，其中还提到了一些替代方案：http: [//linuxgazette.net/issue39/marsden.html](http://linuxgazette.net/issue39/marsden.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-16T05:23:21.367

EmacsWiki 有一个[模板引擎页面](http://www.emacswiki.org/cgi-bin/wiki/CategoryTemplates)。

其中，我在（遥远的）过去使用[tempo](http://www.emacswiki.org/cgi-bin/wiki/TempoMode)将表格支持添加到[html-helper-mode](http://www.nongnu.org/baol-hth/)，但不知道它在过去 15 年中进展如何。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-08T23:19:04.540

我会为[速度片段](http://www.emacswiki.org/emacs/TempoSnippets)添加我的投票...易于设置，功能强大（您可以在模板中运行任意 elisp - 这样您就可以小写事物，查找文件名和类，计算事物等），设置缩进，集成带有缩写......我经常使用它;）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-09-16T13:18:05.270

我投票给[http://cedet.sourceforge.net/srecode.shtml](http://cedet.sourceforge.net/srecode.shtml)

它具有非常干净的语法，并且可以通过`Semantic`.

它也是一个受支持的大型`CEDET`发行版的一部分（它内置于 Emacs 的 24.x 版本系列中）。

**UPDATE** [YASnippet](https://github.com/joaotavora/yasnippet)也是一个强大的模板引擎。但它使用丑陋的文件命名模式（您的文件名 === 模板名），因为您不能将多个模板放入一个文件中并且存在国家字符集问题......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-05-03T21:12:21.087

您可以尝试一个轻量级的解决方案[muban.el](https://github.com/jiahaowork/muban.el)

它完全用 Elisp 编写，语法非常简单。

# networking - 如何从客户机访问主机？

> ID：61449
> 
> 赞同：127
> 
> 时间：2008-09-14T16:32:18.063
> 
> 标签：networking, virtual-machine, vmware

我刚刚使用 VMware Fusion 在我的 Mac 上创建了一个新的 Windows XP VM。VM 正在使用 NAT 共享主机的 Internet 连接。

我如何访问一个 Rails 应用程序，它可以在 Mac 本身上使用`http://localhost:3000`？

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2008-09-14T16:40:51.893

在 XP 机器上，通过转到命令提示符并键入来查找您的 IP 地址`ipconfig`。尝试用 1 或 2 替换最后一个数字。例如，如果您的 IP 地址是 192.168.78.128，请使用[http://192.168.78.1:3000](http://192.168.78.1:3000)。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2008-09-14T21:13:12.973

您可以使用主机 Mac（或网络上的任何其他 Mac）的“本地”名称：

[http://macname.local:3000/](http://macname.local:3000/)

其中 macname 是您的主机（或其他所需）Mac 的网络名称。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2010-01-19T16:11:49.550

对于未来的访问者：一旦您确定了 IP 地址，您可以在位于 C:\Windows\system32\drivers\etc\hosts 的 Windows 主机文件中添加一个条目，以将 IP 地址映射到（虚拟）服务器名称。像这样添加一行：

```
192.168.78.1   myrubyapp 
```

现在您可以在 IE 中访问该站点，地址为[http://myrubyapp:3000](http://myrubyapp:3000)

如果您在 Apache 下使用虚拟主机，您将需要它来提供正确的服务器名称。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-07-14T04:51:22.777

由于这个问题很老并且指的是XP，因此这里是新操作系统的替代方案；

* * *

如果您使用**Vista**或**Windows 7**作为来宾操作系统，并且您通过 Apache 在主机中设置了虚拟主机，那么设置方法如下：

在主机操作系统中，您需要确保网络连接是通过 NAT 完成的；

1.  右键单击 VM 窗口中的网络图标（右下角）
2.  选择“NAT”
3.  选择“连接”
4.  等待来宾操作系统重新连接到网络

然后，在来宾操作系统中；

1.  单击开始 > 网络 > 网络和共享中心
2.  点击网络连接旁边的“查看状态”
3.  点击“详情”
4.  找到“IPv4 默认网关”
5.  打开写字板
6.  编辑 C:\Windows\System32\drivers\etc\hosts
7.  在文件中添加一行，例如：

    ```
    [default-gateway-IP] www.example.com
    [default-gateway-IP] example.com 
    ```

8.  节省

9.  尝试打开`http://www.example.com`或`http://example.com`在IE中

[![](https://i.stack.imgur.com/kw8ck.png)](https://i.stack.imgur.com/kw8ck.png)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-10T14:53:54.217

1.  在 XP 机器上，开始 -> 连接到 -> 显示所有连接。
2.  双击本地连接。
3.  单击支持选项卡。
4.  获取默认网关 IP > 并在浏览器中`<gateway-ip`点击 http:// >:3000。`<gateway-ip`

问题：地址中必须有http://，否则IE会提示“网页无法显示”。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-05-31T14:40:45.227

对于 Django，执行以下操作很重要：

./manage.py 运行服务器 [默认网关 IP]:8000

因为

[https://docs.djangoproject.com/en/dev/ref/django-admin/](https://docs.djangoproject.com/en/dev/ref/django-admin/)

请注意，您网络上的其他计算机无法访问默认 IP 地址 127.0.0.1。要使您的开发服务器对网络上的其他机器可见，请使用其自己的 IP 地址（例如 192.168.2.1）或 0.0.0.0 或 ::（启用 IPv6）。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-03-22T18:30:37.697

我只是花了一个小时试图按照 SO 上的步骤让它工作，但我的最终有点不同。

**VMWare 设置**

1.) 将 VMWare 连接设置为 NAT
2.) 运行 > cmd > ipconfig > 复制默认网关值
3.) 编辑主机文件（c:/Windows/System32/drivers/etc/hosts）

*   将此添加到您的主机文件中：

`<gateway-ip> yourserver.local`

**OS X 设置**

1.) 编辑 Apache 配置（例如，sudo vim /etc/apache2/httpd.conf）

*   将此 vhost 条目添加到您的 httpd.conf 文件中：

```
名称VirtualHost 127.0.0.1
<虚拟主机 127.0.0.1>
    DocumentRoot "/path/to/your/project"
    服务器名称 yourserver.local

    <目录“/path/to/your/project”>
        允许覆盖所有
        选项全部
    </目录>
</虚拟主机>

```

*   保存并退出 (:wq)

2.) 编辑你的主机文件 (sudo vim /etc/hosts)

*   将此行添加到您的主机文件

`127.0.0.1 yourserver.local`

3.) 重启 Apache (sudo apachectl restart)

我发现我必须在 VMWare 上切换连接设置才能重新启动连接，然后这些设置才对我有用。我希望这有帮助。

# html - Django 有 HTML 助手吗？

> ID：61451
> 
> 赞同：25
> 
> 时间：2008-09-14T16:37:32.650
> 
> 标签：html, django

Django 是否有任何模板标签来生成常见的 HTML 标记？例如，我知道我可以使用

```
{% url mapper.views.foo %} 
```

但这只会给我 URL 而不是用于创建链接的 HTML 代码。Django 有什么类似于 Rails 的 link_to 助手的吗？我找到了[django-helpers](http://code.google.com/p/django-helpers/)，但由于这是一件常见的事情，我认为 Django 会内置一些东西。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-15T22:22:19.897

不，它没有。

[James Bennett 不久前](http://www.b-list.org/)回答了一个[类似的问题](http://www.b-list.org/weblog/2006/jul/02/django-and-ajax/)，关于 Rails 的内置 JavaScript 助手。

*Django*不太可能内置“助手”功能。如果我理解正确，原因与 Django 保持事物[松散耦合](http://docs.djangoproject.com/en/dev/misc/design-philosophies/#id1)的核心理念有关。内置这种帮助器功能会导致将 Django 与特定的 JavaScript 库或（在您的情况下）html 文档类型相结合。

例如。如果/当 HTML 5 最终实现并且 Django 生成 HTML 4 或 XHTML 标记时会发生什么？

话虽如此，Django 的模板框架非常灵活，[编写自己的标签/过滤器](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/)来满足您的需求并不难。我自己主要是一名设计师，我已经能够将几个自定义标签放在一起，就像一个魅力一样。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-09-19T17:24:21.337

像这里的其他人暗示的那样，帮助程序的目的并不是帮助不知道如何编写 HTML 的开发人员。目的是封装通用功能——因此您无需编写相同的东西一千次——并提供一个单一位置来编辑整个应用程序中使用的通用 HTML。

这与模板和 SSI 有用的原因相同——不是因为人们不知道如何在页眉和页脚中编写 HTML，而是有时您只想编写一次。

> 例如。如果/当 HTML 5 最终实现并且 Django 生成 HTML 4 或 XHTML 标记时会发生什么？

实现 HTML 5 并且您的所有模板都用重复的 HTML 编写时会发生同样的事情，但要容易得多。

The other posts have already answered the question, linking to the docs on [custom template tags](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/); you can use tags and filters to build your own, but no, there aren't any built in.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T16:48:38.833

看起来它们不是内置的，但这里有几个片段。看起来创建这些助手很容易：

[http://www.djangosnippets.org/snippets/441/](http://www.djangosnippets.org/snippets/441/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T23:05:10.263

这是[Django 中内置的所有模板标签和过滤器的列表](http://docs.djangoproject.com/en/dev/ref/templates/builtins/)。Django 核心没有 Rails 那么多的 HTML 帮助器，因为 Django 贡献者假设 Web 开发人员非常了解 HTML。正如 saturdaypalace 所说，将 AJAX 助手添加到 Django 的可能性很小，因为它会导致 Django 与特定的 JavaScript 库耦合。

[在 Django 中编写自己的模板标签](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#howto-custom-template-tags)非常容易（通常只需要定义一个函数，类似于 Rails）。您可以在一两天内重新实现 Django 中的大多数 Rails 助手。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T11:27:31.140

我敢打赌，如果对*常见的 html*有任何同意，也会有 helpers 模块，只是为了完整性（或者因为其他人有它）。;)

除此之外，Django 模板系统主要是为 HTML 人制作的，他们已经知道如何编写和标记`p`，并且不需要任何*帮助*。另一方面，有 Python 开发人员，他们编写代码并不关心他们放在上下文中的变量是被包围还是被包围（*关注点分离*范式的完美示例）。如果您需要将这两个世界加入，您必须自己完成（或查找其他代码）。`img``a`*`div``span`*

 *** * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-16T12:10:40.763

这不会直接回答这个问题，但为什么不在`<a href="{% url mapper.views.foo %}">foo</a>`模板中使用呢？

# c++ - 从 XPCOM 组件访问 Firefox 缓存

> ID：61453
> 
> 赞同：2
> 
> 时间：2008-09-14T16:38:38.267
> 
> 标签：c++, firefox, xpcom, gecko

有人知道如何从组件中获取Firefox 缓存的文件的**本地路径**吗？`URL``XPCOM`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-14T19:29:37.777

要访问缓存项，必须使用*[nsICacheService](http://www.xulplanet.com/references/xpcomref/ifaces/nsICacheService.html)**中提供的createSession*方法创建新的缓存会话。此方法创建*[nsICacheSession](http://www.xulplanet.com/references/xpcomref/ifaces/nsICacheSession.html)* 对象。可以使用会话对象的*openCacheEntry*方法获取有关缓存项的信息（方法返回*[nsICacheEntryDescriptor](http://www.xulplanet.com/references/xpcomref/ifaces/nsICacheEntryDescriptor.html)*）。要读取数据，用户必须使用缓存条目对象的*openInputStream*方法打开输入流。

 **# jquery - MVC.net jQuery 验证

> ID：61456
> 
> 赞同：14
> 
> 时间：2008-09-14T16:43:56.147
> 
> 标签：jquery, asp.net-mvc, validation

在尝试避免使用 JavaScript 多年后，Iv 开始在 MVC asp.net 中使用 Query 进行[验证](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)，因为似乎没有官方的验证方式，我很惊讶 jQuery 有多好。

首先，有没有办法让智能感知适用于 jQuery 及其验证插件，这样我就不必学习 api？

其次，我如何为此创建验证摘要，它当前将错误附加到文本框的右侧。：

```
<script type="text/javascript">
$().ready(function() {
$("#CreateLog").validate({
        rules: {            
            UserName: {
                required: true,
                minLength: 2,

            }
        },
        messages: {

            UserName: {
                required: "Please enter a username",
                minLength: "Your username must consist of at least 2 characters",

            }
        }
    });
});
</script>

<form id="CreateLog" action="Create" method="post" />   
        <label>UserName</label><br />
        <%=Html.TextBox("UserName")%> 
         <br />  
          <div class="error"> </div>
        <input  type=submit value=Save />
       </form> 
```

我尝试将此添加到脚本中：

```
 errorLabelContainer: $("#CreateLog div.error") 
```

这对html：

```
 <div class="error"> </div> 
```

但这没有用。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-15T20:18:55.763

尝试在选项中同时指定包装器和标签容器。我还添加`display:none;`了错误容器的样式，让 jQuery 决定何时显示它。

```
$().ready(function() {
  $("#CreateLog").validate({
    errorLabelContainer: $("ul", $('div.error-container')),
    wrapper: 'li',
    rules: {            
        UserName: {
            required: true,
            minLength: 2,

        }
    },
    messages: {
      UserName: {
        required: "Please enter a username",
        minLength: "Your username must consist of at least 2 characters"
      }
    }
  });
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<div class="error-container">
  <ul></ul>
</div>

<form id="CreateLog" action="Create" method="post" />   
  <label>UserName</label><br />
  <%=Html.TextBox("UserName")%> 
  <br />  
  <input  type=submit value=Save />
</form>
```

那应该行得通。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-02T18:46:42.830

您可能想在[CodeBetter.com](http://codebetter.com)和他的示例[应用程序画布上查看](http://codebetter.com/blogs/karlseguin/archive/2009/04/28/presenting-codebetter-canvas.aspx)[Karl Seguin](http://codebetter.com/blogs/karlseguin/default.aspx)的 ASP.NET MVC 验证方法。

[验证 - 第 1 部分 - 入门](http://codebetter.com/blogs/karlseguin/archive/2009/04/26/validation-part-1-getting-started.aspx)

[验证 - 第 2 部分 - 客户端](http://codebetter.com/blogs/karlseguin/archive/2009/04/27/validation-part-2-client-side.aspx)

[验证 - 第 3 部分 - 服务器端](http://codebetter.com/blogs/karlseguin/archive/2009/04/28/validation-part-3-server-side.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-14T16:54:13.733

[VS2008中有](http://weblogs.asp.net/scottgu/archive/2007/06/21/vs-2008-javascript-intellisense.aspx)[JQuery IntelliSense](http://weblogs.asp.net/bradvincent/archive/2008/04/28/better-jquery-intellisense-in-vs2008.aspx)的Visual Studio 2008 修补程序。这也可能与 SP1 捆绑在一起。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T13:02:48.913

关于 jquery（和其他插件）的智能感知：为了在您自己的脚本文件中也有完整的智能感知，只需在 .js 文件的顶部为您想要智能感知的每个文件包含一次以下行：

```
/// <reference path="[insert path to script file here]" /> 
```

简单，但非常有用 =)

# c# - 如何访问自动实现的属性的支持变量？

> ID：61480
> 
> 赞同：79
> 
> 时间：2008-09-14T17:19:53.533
> 
> 标签：c#, properties

过去我们声明的属性是这样的：

```
public class MyClass
{
    private int _age;

    public int Age
    {
          get{ return _age;  }
          set{ _age = value; }
    }
} 
```

现在我们可以这样做：

```
public class MyClass
{
    public int Age {get; set;} 
} 
```

我的问题是，如何访问使用此表示法自动创建的私有变量？

我宁愿访问私有变量而不是公共访问器'Age'。是否有访问私有变量的默认表示法，或者这是不可能的？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-09-14T17:47:02.157

新的自动属性的目的是减少您需要编写的样板代码量，因为您只有一个简单的属性，不需要在 get 或 set 中使用任何特殊逻辑。

如果您想访问这些属性使用的私有成员，通常有几个原因：

*   您需要的不仅仅是简单的获取/设置 - 在这种情况下，您应该避免使用该成员的自动属性。
*   您想避免通过 get 或 set 对性能造成的影响，而直接使用该成员 - 在这种情况下，如果真的有性能影响，我会感到惊讶。简单的 get/set 成员非常容易内联，并且在我的（诚然有限的）测试中，我没有发现使用自动属性和直接访问成员之间的区别。
*   您只想拥有公共读取访问权限（即只是一个“get”）并且类直接写入成员 - 在这种情况下，您可以在您的自动属性中使用私有集。IE

    ```
    public class MyClass
    {
        public int Age {get; private set;} 
    }
    ```

这通常涵盖了希望直接访问自动属性使用的支持字段的大部分原因。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-14T17:35:10.533

您对自动属性的使用意味着您不需要任何获取/设置属性的逻辑，因此不需要私有支持变量。

如果您的类中有任何复杂的逻辑，请不要使用自动属性。像往常一样去`private int _age`使用普通的 getter/setter。

IMO，自动属性更适合快速实现一次性对象或临时数据胶囊，例如：

```
public class TempMessage {
    public int FromID { get; set; }
    public int ToID { get; set; }
    public string Message { get; set; }
} 
```

不需要太多逻辑的地方。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-14T17:34:00.580

这种语法通常称为“语法糖”，这意味着编译器采用该语法并将其转换为其他内容。在您的示例中，编译器将生成如下所示的代码：

```
[CompilerGenerated]
private int <Age>k_BackingField;

public int Age
{
   [CompilerGenerated]
   get
   {
      return this.<Age>k_BackingField;
   }
   [CompilerGenerated]
   set
   {
      this.<Age>k_BackingField = value;
   } 
```

即使知道所有这些，您也可以**直接**访问支持字段，但这有点违背使用自动属性的目的。我之所以在这里说可能是因为您依赖于在 C# 编译器的未来版本中可能随时更改的实现细节。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-14T17:27:26.090

> 在幕后发生的是注入私有成员变量，前缀为 <>k__AutomaticallyGeneratedPropertyField#

从[C# 3.0 自动属性解释](http://community.bartdesmet.net/blogs/bart/archive/2007/03/03/c-3-0-automatic-properties-explained.aspx)

尽管可以直接使用该私有成员，但它非常笨拙且不必要。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-14T20:39:14.100

你不应该，而且你不太可能需要。如果您需要访问该属性，只需使用公共属性（例如 this.Age）。支持公共财产的私有领域并没有什么特别之处，使用它而不是财产只是迷信。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-14T17:22:56.677

你不能，它是一种语言功能，而不是 IDE 功能。老实说，我更喜欢 IDE 为您添加私有变量。我同意这个类在内部必须使用公共入口点来访问它自己的变量有点奇怪。因此，我自己并没有过多地使用这个新功能。

# jquery - 找出四个div中可见的div

> ID：61486
> 
> 赞同：6
> 
> 时间：2008-09-14T17:27:28.210
> 
> 标签：jquery, dom, css-selectors

我需要使用 jQuery 从四个可能的 div 中找出哪些 div 是可见的。在任何给定时间，只有其中一个 div 是可见的。

到目前为止，这就是我所拥有的：

```
$("#FeatureImage1:visible, #FeatureImage2:visible, #FeatureImage3:visible, #FeatureImage4:visible").attr("id"); 
```

有没有办法重构这个？有没有更简单的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-14T17:44:25.597

然后为每个 div 分配相同的类：

```
$("div.myClass:visible").attr("id"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T16:23:49.557

如果适用，最好使用上下文选择器而不是添加虚假类。例如，如果`<div>`元素是带有 的元素的唯一子元素`id="foo"`，那么 using`$("#foo > div:visible").attr("id")`会更好地反映代码的目的。

# c++ - 制作可移植代码

> ID：61499
> 
> 赞同：3
> 
> 时间：2008-09-14T17:43:47.220
> 
> 标签：c++, c, portability

随着开源项目的大惊小怪，为什么仍然没有一个强大的标准可以让您制作可移植的代码（我的意思是`C/C++`不是`Java`或`C#`）每个人都在做自己的汤。

甚至还有一些第三方库，例如`Apache Portable Runtime`.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-14T19:11:23.890

是的，没有标准，但是当您进行跨平台开发时，像**Qt**和**boost这样的库可以让您的生活变得更加轻松。**

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T13:50:26.197

wxwidgets 是大多数窗口管理器的原生 GUI 小部件上的一个很好的抽象层。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-14T20:39:18.000

[ADAPTIVE Communication Environment (ACE)](http://www.cse.wustl.edu/~schmidt/ACE.html)是一个出色的面向对象框架，它为所有低级操作系统功能（如线程、套接字、互斥锁等）提供跨平台支持。它与大量编译器和操作系统一起运行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T16:47:59.887

C 和 C++ 作为语言是标准语言。如果您在编码时严格遵循他们的规则（这意味着不使用特定于供应商的扩展），那么您的代码应该是可移植的，并且您应该能够在任何操作系统上使用任何现代编译器对其进行编译。

然而，C 和 C++ 没有像 Java 或 C# 那样的 GUI 库，但是有一些免费或商业的 GUI 库可以让您编写可移植的 GUI 应用程序。

我认为最受欢迎的是[Qt](http://trolltech.com/products/qt/)（商业）和[wxWidgets](http://www.wxwidgets.org/)（FOSS）。根据[维基百科](http://en.wikipedia.org/wiki/List_of_widget_toolkits#Based_on_C_or_C.2B.2B_.28including_bindings_to_other_languages.29)，还有更多。

还有 boost，而不是 GUI 库[boost](http://www.boost.org/)是对 C++ 的 STL 的一个非常好的补充。事实上，一些 boost 库将被添加到下一个 C++ 标准中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-14T17:52:13.860

我认为没有任何人同意任何单一库的主要原因是每个人的要求都不同。当您想要包装系统库时，您通常需要对用例的内容做出一些假设，除非您想让包装器变得庞大且无法使用。我认为这可能是没有单一、通用的跨平台运行时的主要原因。

对于 GUI，原因可能是每个平台都有自己的 UI 约定，你不能编写一个适合所有的 GUI，你只会得到一个只适合一个甚至根本不适合的 GUI。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-14T19:20:05.710

有许多库可以让跨平台开发更容易，但是为所有平台制作一个完整的包装器最终要么是小而高度定制的，要么是庞大而完全荒谬的。

得出它的逻辑结论，一个操作系统所有方面的完整包装器成为一个完整的虚拟运行时。您不妨制作自己的编程语言。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T13:47:59.073

如果您确保它可以与 GCC 和 MS VC++ 一起干净地编译，那么移植到其他地方就不需要额外的努力了。

# python - 来自对象字段的 Python 字典

> ID：61517
> 
> 赞同：424
> 
> 时间：2008-09-14T18:00:43.030
> 
> 标签：python, dictionary, attributes, object, metaprogramming

你知道是否有一个内置函数可以从任意对象构建字典吗？我想做这样的事情：

```
>>> class Foo:
...     bar = 'hello'
...     baz = 'world'
...
>>> f = Foo()
>>> props(f)
{ 'bar' : 'hello', 'baz' : 'world' } 
```

**注意：**它不应该包括方法。只有字段。

* * *

## 回答 #1

> 赞同：535
> 
> 时间：2008-09-15T13:08:56.107

请注意，Python 2.7 中的最佳实践是使用*[新型](https://www.python.org/doc/newstyle/)*类（Python 3 不需要），即

```
class Foo(object):
   ... 
```

此外，“对象”和“类”之间存在差异。要从任意*对象*构建字典，使用`__dict__`. 通常，您将在类级别声明您的方法，在实例级别声明您的属性，所以`__dict__`应该没问题。例如：

```
>>> class A(object):
...   def __init__(self):
...     self.b = 1
...     self.c = 2
...   def do_nothing(self):
...     pass
...
>>> a = A()
>>> a.__dict__
{'c': 2, 'b': 1} 
```

更好的方法（[罗伯特](https://stackoverflow.com/users/409638/robert)在评论中建议）是内置[`vars`](https://docs.python.org/3/library/functions.html#vars)函数：

```
>>> vars(a)
{'c': 2, 'b': 1} 
```

或者，根据您想要做什么，从`dict`. 那么你的类*已经*是一本字典，如果你愿意，你可以覆盖`getattr`和/或`setattr`调用并设置字典。例如：

```
class Foo(dict):
    def __init__(self):
        pass
    def __getattr__(self, attr):
        return self[attr]

    # etc... 
```

* * *

## 回答 #2

> 赞同：190
> 
> 时间：2015-08-02T08:57:29.117

而`x.__dict__`不是`vars(x)`.

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2008-09-14T18:07:55.507

`dir`内置函数将为您提供对象的所有属性，包括特殊方法，如，`__str__`以及`__dict__`您可能不想要的一大堆其他方法。但是您可以执行以下操作：

```
>>> class Foo(object):
...     bar = 'hello'
...     baz = 'world'
...
>>> f = Foo()
>>> [name for name in dir(f) if not name.startswith('__')]
[ 'bar', 'baz' ]
>>> dict((name, getattr(f, name)) for name in dir(f) if not name.startswith('__')) 
{ 'bar': 'hello', 'baz': 'world' } 
```

所以可以通过这样定义你的`props`函数来扩展它以只返回数据属性而不是方法：

```
import inspect

def props(obj):
    pr = {}
    for name in dir(obj):
        value = getattr(obj, name)
        if not name.startswith('__') and not inspect.ismethod(value):
            pr[name] = value
    return pr 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-09-14T18:50:52.363

我已经解决了两个答案的组合：

```
dict((key, value) for key, value in f.__dict__.iteritems() 
    if not callable(value) and not key.startswith('__')) 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2015-03-29T18:32:42.797

我想我会花一些时间向您展示如何通过`dict(obj)`.

```
class A(object):
    d = '4'
    e = '5'
    f = '6'

    def __init__(self):
        self.a = '1'
        self.b = '2'
        self.c = '3'

    def __iter__(self):
        # first start by grabbing the Class items
        iters = dict((x,y) for x,y in A.__dict__.items() if x[:2] != '__')

        # then update the class items with the instance items
        iters.update(self.__dict__)

        # now 'yield' through the items
        for x,y in iters.items():
            yield x,y

a = A()
print(dict(a)) 
# prints "{'a': '1', 'c': '3', 'b': '2', 'e': '5', 'd': '4', 'f': '6'}" 
```

这段代码的关键部分是`__iter__`函数。

正如评论所解释的，我们要做的第一件事是抓住 Class 项目并防止任何以“__”开头的东西。

一旦你创建了它`dict`，你就可以使用`update`dict 函数并传入实例`__dict__`。

这些将为您提供完整的类+实例成员字典。现在剩下的就是迭代它们并产生回报。

此外，如果您打算大量使用它，您可以创建一个`@iterable`类装饰器。

```
def iterable(cls):
    def iterfn(self):
        iters = dict((x,y) for x,y in cls.__dict__.items() if x[:2] != '__')
        iters.update(self.__dict__)

        for x,y in iters.items():
            yield x,y

    cls.__iter__ = iterfn
    return cls

@iterable
class B(object):
    d = 'd'
    e = 'e'
    f = 'f'

    def __init__(self):
        self.a = 'a'
        self.b = 'b'
        self.c = 'c'

b = B()
print(dict(b)) 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-09-15T14:56:01.030

> 要从任意*对象*构建字典，使用`__dict__`.

这错过了对象从其类继承的属性。例如，

```
class c(object):
    x = 3
a = c() 
```

hasattr(a, 'x') 为真，但 'x' 没有出现在 a.__dict__ 中

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2018-12-17T22:22:47.200

使用的一个缺点`__dict__`是它很浅。它不会将任何子类转换为字典。

如果您使用的是 Python3.5 或更高版本，则可以使用[`jsons`](https://jsons.readthedocs.io/en/latest/)：

```
>>> import jsons
>>> jsons.dump(f)
{'bar': 'hello', 'baz': 'world'} 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2013-07-04T12:40:05.720

迟到的答案，但提供了完整性和谷歌员工的利益：

```
def props(x):
    return dict((key, getattr(x, key)) for key in dir(x) if key not in dir(x.__class__)) 
```

这不会显示类中定义的方法，但仍会显示字段，包括分配给 lambda 的字段或以双下划线开头的字段。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-05-29T16:02:23.207

我认为最简单的方法是为类创建一个**getitem**属性。如果需要写入对象，可以创建自定义**setattr**。这是**getitem**的示例：

```
class A(object):
    def __init__(self):
        self.b = 1
        self.c = 2
    def __getitem__(self, item):
        return self.__dict__[item]

# Usage: 
a = A()
a.__getitem__('b')  # Outputs 1
a.__dict__  # Outputs {'c': 2, 'b': 1}
vars(a)  # Outputs {'c': 2, 'b': 1} 
```

**dict**将对象属性生成到字典中，字典对象可用于获取您需要的项目。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2020-04-30T19:31:28.910

`vars()`很棒，但不适用于对象的嵌套对象

将对象的嵌套对象转换为 dict：

```
def to_dict(self):
    return json.loads(json.dumps(self, default=lambda o: o.__dict__)) 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2021-03-21T00:09:49.937

在 2021 年，对于嵌套对象/dicts/json，使用 pydantic BaseModel - 将嵌套 dicts 和嵌套 json 对象转换为 python 对象和 JSON，反之亦然：

[https://pydantic-docs.helpmanual.io/usage/models/](https://pydantic-docs.helpmanual.io/usage/models/)

```
>>> class Foo(BaseModel):
...     count: int
...     size: float = None
... 
>>> 
>>> class Bar(BaseModel):
...     apple = 'x'
...     banana = 'y'
... 
>>> 
>>> class Spam(BaseModel):
...     foo: Foo
...     bars: List[Bar]
... 
>>> 
>>> m = Spam(foo={'count': 4}, bars=[{'apple': 'x1'}, {'apple': 'x2'}]) 
```

**对象听写**

```
>>> print(m.dict())
{'foo': {'count': 4, 'size': None}, 'bars': [{'apple': 'x1', 'banana': 'y'}, {'apple': 'x2', 'banana': 'y'}]} 
```

**对象转 JSON**

```
>>> print(m.json())
{"foo": {"count": 4, "size": null}, "bars": [{"apple": "x1", "banana": "y"}, {"apple": "x2", "banana": "y"}]} 
```

**口述反对**

```
>>> spam = Spam.parse_obj({'foo': {'count': 4, 'size': None}, 'bars': [{'apple': 'x1', 'banana': 'y'}, {'apple': 'x2', 'banana': 'y2'}]})
>>> spam
Spam(foo=Foo(count=4, size=None), bars=[Bar(apple='x1', banana='y'), Bar(apple='x2', banana='y2')]) 
```

**JSON 到对象**

```
>>> spam = Spam.parse_raw('{"foo": {"count": 4, "size": null}, "bars": [{"apple": "x1", "banana": "y"}, {"apple": "x2", "banana": "y"}]}')
>>> spam
Spam(foo=Foo(count=4, size=None), bars=[Bar(apple='x1', banana='y'), Bar(apple='x2', banana='y')]) 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2021-09-07T13:11:40.800

**Python3.x**

```
return dict((key, value) for key, value in f.__dict__.items() if not callable(value) and not key.startswith('__')) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-01-07T18:14:45.423

如果要列出部分属性，请覆盖`__dict__`：

```
def __dict__(self):
    d = {
    'attr_1' : self.attr_1,
    ...
    }
    return d

# Call __dict__
d = instance.__dict__() 
```

如果你`instance`得到一些大块数据并且你想像`d`消息队列一样推送到 Redis，这会很有帮助。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-12-27T18:23:45.067

正如[上面的评论之一所述](https://stackoverflow.com/questions/61517/python-dictionary-from-an-objects-fields/65469063#comment102192969_31770231)，`vars`目前还不是通用的，因为它不适用于带有[`__slots__`](https://docs.python.org/3/reference/datamodel.html#slots)而不是 normal的对象`__dict__`。此外，一些对象（例如，像`str`or之类的内置函数`int`）*既没有*a`__dict__` *也没有* `__slots__`。

目前，一个更通用的解决方案可能是这样的：

```
def instance_attributes(obj: Any) -> Dict[str, Any]:
    """Get a name-to-value dictionary of instance attributes of an arbitrary object."""
    try:
        return vars(obj)
    except TypeError:
        pass

    # object doesn't have __dict__, try with __slots__
    try:
        slots = obj.__slots__
    except AttributeError:
        # doesn't have __dict__ nor __slots__, probably a builtin like str or int
        return {}
    # collect all slots attributes (some might not be present)
    attrs = {}
    for name in slots:
        try:
            attrs[name] = getattr(obj, name)
        except AttributeError:
            continue
    return attrs 
```

例子：

```
class Foo:
    class_var = "spam"

class Bar:
    class_var = "eggs"

    __slots__ = ["a", "b"] 
```

```
>>> foo = Foo()
>>> foo.a = 1
>>> foo.b = 2
>>> instance_attributes(foo)
{'a': 1, 'b': 2}

>>> bar = Bar()
>>> bar.a = 3
>>> instance_attributes(bar)
{'a': 3}

>>> instance_attributes("baz") 
{} 
```

* * *

咆哮：

很遗憾，这还没有内置`vars`。Python 中的许多内置函数承诺是解决问题的“最佳”解决方案，但总会有几种特殊情况没有得到处理……而且无论如何最终都不得不手动编写代码。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-02-08T23:38:59.243

## 蟒蛇3：

```
class DateTimeDecoder(json.JSONDecoder):

   def __init__(self, *args, **kargs):
        JSONDecoder.__init__(self, object_hook=self.dict_to_object,
                         *args, **kargs)

   def dict_to_object(self, d):
       if '__type__' not in d:
          return d

       type = d.pop('__type__')
       try:
          dateobj = datetime(**d)
          return dateobj
       except:
          d['__type__'] = type
          return d

def json_default_format(value):
    try:
        if isinstance(value, datetime):
            return {
                '__type__': 'datetime',
                'year': value.year,
                'month': value.month,
                'day': value.day,
                'hour': value.hour,
                'minute': value.minute,
                'second': value.second,
                'microsecond': value.microsecond,
            }
        if isinstance(value, decimal.Decimal):
            return float(value)
        if isinstance(value, Enum):
            return value.name
        else:
            return vars(value)
    except Exception as e:
        raise ValueError 
```

现在您可以在自己的类中使用上面的代码：

```
class Foo():
  def toJSON(self):
        return json.loads(
            json.dumps(self, sort_keys=True, indent=4, separators=(',', ': '), default=json_default_format), cls=DateTimeDecoder)

Foo().toJSON() 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-08-30T09:57:29.003

尝试：

```
from pprint import pformat
a_dict = eval(pformat(an_obj)) 
```

# database - 对象数据库的优缺点是什么？

> ID：61520
> 
> 赞同：10
> 
> 时间：2008-09-14T18:04:57.543
> 
> 标签：database, oop, rdbms, relational, object-oriented-database

有很多关于对象关系映射器以及如何最好地避免阻抗不匹配的信息，如果要使用对象数据库，所有这些似乎都没有实际意义。我的问题是为什么不更频繁地使用它？是因为性能原因还是因为对象数据库导致您的数据成为应用程序的专有，还是由于其他原因？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-14T18:11:49.633

*   **熟悉。**数据库管理员知道关系概念；反对的，不是那么多。
*   **表现。**关系数据库已被证明可以更好地扩展。
*   **到期。**SQL 是一种功能强大、开发已久的语言。
*   **供应商支持。**与 OODBMS 相比，您可以在更多的第一方（SQL 服务器）和第三方（管理接口、映射和其他类型的集成）工具之间进行选择。

自然，面向对象的模型对*开发人员*来说更熟悉，而且，正如您所指出的，它会省去 ORM 的一个。但到目前为止，关系模型已被证明是更可行的选择。

另请参阅最近的问题，[面向对象与关系数据库](https://stackoverflow.com/questions/800/object-orientated-vs-relational-databases)。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-05T07:01:38.350

我一直在使用[db4o](http://www.db4o.com)，它是一个 OODB，它解决了列出的大部分缺点：

*   熟悉度 - 程序员比 SQL 更了解他们的语言（请参阅本机查询）
*   性能 - 这个是非常主观的，但你可以看看[PolePosition](http://polepos.sourceforge.net/)
*   供应商支持和成熟度 - 会随着时间而改变
*   不能被不使用相同框架的程序使用 - 有 OODB 标准，您可以使用[不同的框架](http://developer.db4o.com/forums/thread/51254.aspx)
*   版本控制可能有点麻烦 - 版本控制实际上[更容易](http://developer.db4o.com/forums/thread/22660.aspx)！

我感兴趣的优点是：

*   本机查询 - Db4o 允许您使用静态类型语言编写查询，因此您不必担心错误输入字符串并在运行时发现数据丢失，
*   易用性——在领域层、持久层（映射）和最后的 SQL 数据库中定义业务逻辑肯定违反了 DRY。使用 OODB，您可以定义它所属的域。

我同意 - OODB 有很长的路要走，但他们正在前进。还有一些领域问题可以通过 OODB 更好地解决，

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-14T18:13:44.573

对对象数据库的一个反对意见是它在数据和代码之间创建了紧密耦合。对于某些应用程序，这可能没问题，但对于其他应用程序则不然。关系数据库为您提供的一件好事是可以在数据上放置许多视图。

[Ted Neward](http://blogs.tedneward.com/2007/06/12/The+Relational+Database+Needs+No+Defense.aspx)解释了这一点以及更多关于 OODBMS 的内容，比这更好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-25T20:58:32.513

它与性能无关。也就是说，基本上所有应用程序在使用 OODB 时都会表现得更好。但这也会使许多 DBA 失业/不得不学习新技术。更多的人会因为纠正数据中的错误而失业。这不太可能使 OODB 受到成熟公司的欢迎。加文似乎完全一无所知，更好的链接是[柯克](http://kirk.blog-city.com/gavin_defends_rdbms_and_ted_rebukes.htm)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-14T18:13:09.053

缺点：

*   不能由不使用相同框架来访问数据存储的程序使用，从而使其更难以在整个企业中使用。

*   可用于非基于 SQL 的数据库的在线资源较少

*   跨数据库类型不兼容（不能在不更改所有代码的情况下切换到不同的数据库提供程序）

*   版本控制可能有点麻烦。我猜想向对象添加新属性并不像向表中添加新列那么容易。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T09:34:48.433

索伦

您所说的所有原因都是有效的，但我认为 OODBMS 的问题在于逻辑数据模型。对象模型（或者更确切地说是 70 年代的网络模型）不像关系模型那么简单，因此是次要的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-06T04:21:38.173

jodonnel，我不明白对象数据库的使用如何将应用程序代码与数据结合起来。如果设计得当，您仍然可以通过使用存储库模式从 OODB 中抽象出您的应用程序，并替换为支持 ORM 的 SQL 数据库。

对于 OO 应用程序，OO 数据库将更自然地适合持久化对象。

可能正确的是您将数据与域模型联系起来，但这就是症结所在！

使用以域为中心的视图以单一方式查看数据、业务规则和流程不是很好吗？

因此，一个很大的优点是 OODB 与大多数现代企业级面向对象软件应用程序的设计方式相匹配，不需要额外的努力来使用不同的（关系）设计来设计数据层。构建和维护成本更低，在许多情况下通常性能更高。

缺点，我认为只是普遍缺乏成熟和采用...

# windows - 在软件中测试网络中断

> ID：61524
> 
> 赞同：11
> 
> 时间：2008-09-14T18:09:36.317
> 
> 标签：windows, testing, networking, network-programming

我在 Windows 中有一个网络 C++ 程序，我想在不同时间测试网络断开连接。我有哪些选择？

目前我是：

1.  实际上从我的计算机背面断开网络线
2.  使用 ipconfig /release
3.  使用[cports](http://www.nirsoft.net/utils/cports.html)程序完全关闭套接字

不过，这些方法都不是我的理想选择，我想更轻松地模拟网络问题。

我希望有时连接失败，有时套接字读取失败，有时套接字写入失败。如果有一些实用程序可以用来模拟这些类型的问题，那就太好了。

当这个模拟的坏网络启动时，能够构建一些自动化的单元测试也很好。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-14T20:09:03.703

您可能想要抽象网络层，然后您可以进行单元测试，在适当的点注入有趣的故障事件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-14T18:18:36.450

我能想到的最接近的是用Shunra的[VEDekstop](http://www.shunra.com/vedesktop.aspx)做类似的事情。

[模拟数据库应用程序测试中的高延迟和低带宽](http://sqlblog.com/blogs/john_paul_cook/archive/2008/04/13/simulating-high-latency-and-low-bandwidth-for-database-connectivity-testing.aspx)

*Shunra VE Desktop Standard 是一种基于 Windows 的客户端软件解决方案，可模拟广域网链接，以便您可以直接从您的桌面在各种当前和潜在的网络条件下测试应用程序。*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T01:19:11.353

您可以将用于管理套接字的任何库类子类化（如果您使用的是 MFC，则可能是 CAsyncSocket 或 CSocket），覆盖要测试其失败的方法，并在覆盖中插入适当的测试代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-22T08:16:05.433

There are some methods you can use, it is depend on which level you want to test. For function level, you can use XUNIT testing framework to mock a responce. For software level, you can use a local proxy server to contral connection.

# php - 如何发现给定 URL 的 RSS 提要

> ID：61535
> 
> 赞同：20
> 
> 时间：2008-09-14T18:32:37.837
> 
> 标签：php, rss, feed, atom-feed

我从用户那里得到一个 URL。我需要知道：
a) 该 URL 是有效的 RSS 提要吗？
b) 如果没有，是否存在与该 URL 关联的有效提要

使用 PHP/Javascript 或类似的东西

（例如[http://techcrunch.com](http://techcrunch.com)失败 a），但 b）会返回他们的 RSS 提要）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-14T18:45:06.433

找到了我想要的东西：

Google 的[AJAX Feed API](http://code.google.com/apis/ajaxfeeds/)具有加载 Feed 和查找 Feed 功能（[此处](http://code.google.com/apis/ajaxfeeds/documentation/reference.html#_intro_fonje)的文档）。

a)[加载提要](http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&q=http://www.digg.com/rss/index.xml)以 JSON 格式提供提要（和提要状态）

b)[查找提要](http://ajax.googleapis.com/ajax/services/feed/lookup?v=1.0&q=http://www.techcrunch.com)提供给定 URL 的 RSS 提要

还有一个查找提要功能，可根据关键字搜索 RSS 提要。

计划将此与 JQuery 的 $.getJSON 一起使用

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-15T11:49:58.247

**Zend框架**的[Zend Feed 类](http://framework.zend.com/manual/en/zend.feed.findFeeds.html)可以自动解析网页并列出可用的提要。

 **例子：

```
$feedArray = Zend_Feed::findFeeds('http://www.example.com/news.html'); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-14T18:34:44.290

[此链接](http://feedvalidator.org/)将允许您使用 W3C 规范根据 RSS/Atom 规范验证链接，但确实需要您手动输入 url。

根据您选择的语言，有多种以编程方式执行此操作的方法 - 在 PHP 中，将文件解析[为有效的 XML](http://www.contentwithstyle.co.uk/Blog/132/)是一种很好的开始方式，然后将其与[相关的 DTD](http://www.php.net/manual/en/domdocument.schemavalidate.php)进行比较。

对于b)，如果链接本身不是feed，你可以解析它并在页面的<head>部分查找指定的feed，搜索类型为“application/rss+xml”的链接，例如：

```
<link rel="alternate" title="RSS Feed" 
    href="http://www.example.com/rss-feed.xml" type="application/rss+xml" /> 
```

这种类型的链接是大多数浏览器用来“自动发现”提要的链接（导致 RSS 图标出现在您的地址栏中）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-14T18:34:27.940

a) 检索它并尝试解析它。如果你能解析它，它是有效的。

b) 测试它是否是 HTML 文档（服务器发送`text/html`）MIME 类型。如果是这样，请通过 HTML 解析器运行它并查找`<link>`具有 RSS 提要关系的元素。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-16T12:46:27.277

对于 Perl，有[Feed::Find](http://search.cpan.org/dist/Feed-Find/)，它可以自动从网页中发现联合提要。用法非常简单：

```
use Feed::Find;
my @feeds = Feed::Find->find('http://example.com/'); 
```

它首先尝试`link`标记，然后扫描`a`标记以查找命名的文件`.rss`等。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-14T18:35:59.607

您是使用特定语言执行此操作，还是只想了解有关 RSS 规范的详细信息？

通常，查找 XML 序言：

```
<?xml version="1.0" encoding="UTF-8"?> 
```

后跟一个 <rss> 元素，但您可能希望将其验证为 XML，根据 DTD 对其进行全面验证，或者验证 - 例如，引用的每个 URL 都是有效的，等等。更多详细信息会有所帮助。

**更新**：啊 - PHP。我发现这个库非常有用：[MagpieRSS](http://magpierss.sourceforge.net/)

# javascript - JavaScript 的“with”语句有合法用途吗？

> ID：61552
> 
> 赞同：383
> 
> 时间：2008-09-14T18:54:32.213
> 
> 标签：javascript, language-features, with-statement

[Alan Storm对我关于该](http://www.stackoverflow.com/questions/61088/hidden-features-of-javascript#61118)[`with`声明](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/with)的回答的评论让我思考。我很少找到使用这种特定语言功能的理由，也从未考虑过它会如何造成麻烦。现在，我很好奇如何有效地利用`with`，同时避免它的陷阱。

您在哪里发现该`with`声明有用？

* * *

## 回答 #1

> 赞同：531
> 
> 时间：2008-10-08T23:05:02.273

今天突然想到了另一个用途，于是兴奋地上网搜了一下，发现了一个现有的提法：[Defining Variables inside Block Scope](http://web.archive.org/web/20090111183416/http://www.hedgerwow.com/360/dhtml/js_block_scope.html)。

### 背景

JavaScript，尽管表面上与 C 和 C++ 相似，但并不将变量范围限定在定义它们的块中：

```
var name = "Joe";
if ( true )
{
   var name = "Jack";
}
// name now contains "Jack" 
```

在循环中声明闭包是一项常见任务，这可能会导致错误：

```
for (var i=0; i<3; ++i)
{
   var num = i;
   setTimeout(function() { alert(num); }, 10);
} 
```

因为 for 循环没有引入新的作用域，所以三个函数都将共享相同`num`的值- 值为 。`2`

### 一个新的范围：`let`和`with`

随着[ES6](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let)`let`中语句的引入，在必要时引入新的作用域变得很容易以避免这些问题：

```
// variables introduced in this statement 
// are scoped to each iteration of the loop
for (let i=0; i<3; ++i)
{
   setTimeout(function() { alert(i); }, 10);
} 
```

甚至：

```
for (var i=0; i<3; ++i)
{
   // variables introduced in this statement 
   // are scoped to the block containing it.
   let num = i;
   setTimeout(function() { alert(num); }, 10);
} 
```

在 ES6 普遍可用之前，这种用途仍然仅限于愿意使用转译器的最新浏览器和开发人员。但是，我们可以使用以下方法轻松模拟这种行为`with`：

```
for (var i=0; i<3; ++i)
{
   // object members introduced in this statement 
   // are scoped to the block following it.
   with ({num: i})
   {
      setTimeout(function() { alert(num); }, 10);
   }
} 
```

循环现在按预期工作，创建三个值从 0 到 2 的单独变量。请注意，*在*块中声明的变量没有作用域，这与 C++ 中的块的行为不同（在 C 中，变量必须在开始时声明一个块，所以在某种程度上它是相似的）。这种行为实际上与早期版本的 Mozilla 浏览器中引入的[`let`块语法](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let#let_blocks)非常相似，但在其他地方并未广泛采用。

* * *

## 回答 #2

> 赞同：164
> 
> 时间：2009-09-22T19:27:03.903

我一直在使用 with 语句作为范围导入的简单形式。假设您有某种标记生成器。而不是写：

```
markupbuilder.div(
  markupbuilder.p('Hi! I am a paragraph!',
    markupbuilder.span('I am a span inside a paragraph')
  )
) 
```

你可以改为写：

```
with(markupbuilder){
  div(
    p('Hi! I am a paragraph!',
      span('I am a span inside a paragraph')
    )
  )
} 
```

对于这个用例，我没有做任何分配，所以我没有与此相关的歧义问题。

* * *

## 回答 #3

> 赞同：85
> 
> 时间：2008-09-14T21:56:57.143

*`with`*正如我之前的评论所表明的那样，无论在任何特定情况下多么诱人，我都不认为你可以安全地使用它。由于这里没有直接涉及这个问题，我将重复一遍。考虑以下代码

```
user = {};
someFunctionThatDoesStuffToUser(user);
someOtherFunction(user);

with(user){
    name = 'Bob';
    age  = 20;
} 
```

如果不仔细研究这些函数调用，就无法判断这段代码运行后程序的状态。如果`user.name`已经设置，现在将是`Bob`. 如果未设置，则全局`name`将被初始化或更改为`Bob`，并且`user`对象将保持没有`name`属性。

错误发生。如果你*与*你一起使用，最终会这样做并增加你的程序失败的机会。更糟糕的是，您可能会遇到在 with 块中设置全局的工作代码，无论是故意的还是作者不知道构造的这种怪癖。这很像在切换时遇到故障，您不知道作者是否有意这样做，也无法知道“修复”代码是否会引入回归。

现代编程语言充满了功能。有些功能在使用多年后被发现是不好的，应该避免使用。Javascript*`with`*就是其中之一。

* * *

## 回答 #4

> 赞同：71
> 
> 时间：2010-10-20T10:19:49.437

实际上，我`with`最近发现该声明非常有用。直到我开始我当前的项目——一个用 JavaScript 编写的命令行控制台，我才真正想到了这种技术。我试图模拟 Firebug/WebKit 控制台 API，可以在控制台中输入特殊命令，但它们不会覆盖全局范围内的任何变量。当我试图克服我在[Shog9 的优秀答案](https://stackoverflow.com/questions/61552/are-there-legitimate-uses-for-javascripts-with-statement/185283#185283)的评论中提到的问题时，我想到了这一点。

为了达到这个效果，我使用了两个 with 语句在全局作用域后面“分层”了一个作用域：

```
with (consoleCommands) {
    with (window) {
        eval(expression); 
    }
} 
```

这种技术的伟大之处在于，除了性能上的劣势之外，它不会遭受通常对`with`语句的恐惧，因为无论如何我们都是在全局范围内进行评估 - 不存在我们的伪范围之外的变量存在的危险修改的。

令我惊讶的是，当我设法找到在其他地方使用的相同技术 - [Chromium 源代码](https://chromium.googlesource.com/chromium/blink/+/791be071ca6682c629942f3e19c24cf997582a97/WebCore/inspector/front-end/InjectedScript.js#545)时，我受到启发来发布这个答案！

```
InjectedScript._evaluateOn = function(evalFunction, object, expression) {
    InjectedScript._ensureCommandLineAPIInstalled();
    // Surround the expression in with statements to inject our command line API so that
    // the window object properties still take more precedent than our API functions.
    expression = "with (window._inspectorCommandLineAPI) { with (window) { " + expression + " } }";
    return evalFunction.call(object, expression);
} 
```

**编辑：**刚刚检查了 Firebug 源，他们将[4 与语句链接在一起](http://code.google.com/p/fbug/source/browse/branches/eval/content/firebug/commandLine.js#16)以获得更多层。疯狂的！

```
const evalScript = "with (__win__.__scope__.vars) { with (__win__.__scope__.api) { with (__win__.__scope__.userVars) { with (__win__) {" +
    "try {" +
        "__win__.__scope__.callback(eval(__win__.__scope__.expr));" +
    "} catch (exc) {" +
        "__win__.__scope__.callback(exc, true);" +
    "}" +
"}}}}"; 
```

* * *

## 回答 #5

> 赞同：59
> 
> 时间：2009-06-22T18:18:02.883

是的，是的，是的。有一个非常合法的用途。手表：

```
with (document.getElementById("blah").style) {
    background = "black";
    color = "blue";
    border = "1px solid green";
} 
```

基本上任何其他 DOM 或 CSS 钩子都是 with 的绝妙用途。除非您竭尽全力并决定使其成为可能，否则“CloneNode”不会未定义并返回到全局范围。

Crockford 对速度的抱怨是 with 创建了一个新的上下文。上下文通常很昂贵。我同意。但是如果你刚刚创建了一个 div 并且手头没有一些框架来设置你的 css 并且需要手动设置 15 个左右的 CSS 属性，那么创建一个上下文可能会比创建变量和 15 个取消引用更便宜：

```
var element = document.createElement("div"),
    elementStyle = element.style;

elementStyle.fontWeight = "bold";
elementStyle.fontSize = "1.5em";
elementStyle.color = "#55d";
elementStyle.marginLeft = "2px"; 
```

ETC...

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2008-09-14T19:29:13.223

您可以定义一个小的辅助函数来提供`with`没有歧义的好处：

```
var with_ = function (obj, func) { func (obj); };

with_ (object_name_here, function (_)
{
    _.a = "foo";
    _.b = "bar";
}); 
```

* * *

## 回答 #7

> 赞同：26
> 
> 时间：2008-09-14T23:57:12.627

似乎不值得，因为您可以执行以下操作：

```
var o = incrediblyLongObjectNameThatNoOneWouldUse;
o.name = "Bob";
o.age = "50"; 
```

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2009-09-23T04:20:04.590

我从不使用，看不到理由，也不推荐它。

问题`with`在于它阻止了 ECMAScript 实现可以执行的**大量词法优化。**鉴于基于 JIT 的快速引擎的兴起，这个问题在不久的将来可能会变得更加重要。

它可能看起来`with`允许更简洁的构造（例如，引入一个新的范围而不是一个通用的匿名函数包装器或替换冗长的别名），但它 **真的不值得**。除了性能下降之外，总是存在分配给错误对象的属性的危险（当在注入范围内的对象上找不到属性时）并且可能错误地引入全局变量。IIRC，后一个问题是促使 Crockford 建议避免的问题`with`。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-09-14T19:09:13.130

Visual Basic.NET 也有类似的`With`声明。我使用它的一种更常见的方法是快速设置一些属性。代替：

```
someObject.Foo = ''
someObject.Bar = ''
someObject.Baz = '' 
```

，我可以写：

```
With someObject
    .Foo = ''
    .Bar = ''
    .Baz = ''
End With 
```

这不仅仅是懒惰的问题。它还使代码更具可读性。与 JavaScript 不同的是，它不会有歧义，因为您必须在受语句影响的所有内容前面加上一个`.`（点）。因此，以下两个明显不同：

```
With someObject
    .Foo = ''
End With 
```

对比

```
With someObject
    Foo = ''
End With 
```

前者是`someObject.Foo`；后者`Foo`在范围*之外* `someObject`。

我发现 JavaScript 缺乏区别使得它远不如 Visual Basic 的变体有用，因为模棱两可的风险太高了。除此之外，`with`它仍然是一个强大的想法，可以提高可读性。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2010-09-03T16:19:29.047

您可以使用`with`将对象的内容作为局部变量引入块，就像使用这个[小型模板引擎](http://ejohn.org/blog/javascript-micro-templating/)所做的那样。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-09-14T19:18:31.157

我认为明显的用途是作为捷径。例如，如果您正在初始化一个对象，您只需键入大量“ObjectName”即可。有点像 lisp 的“with-slots”，它可以让你写

```
(with-slots (foo bar) objectname
   "some code that accesses foo and bar" 
```

这和写作一样

```
"some code that accesses (slot-value objectname 'foo) and (slot-value objectname 'bar)"" 
```

当您的语言允许“Objectname.foo”但仍然如此时，为什么这是一个快捷方式更明显。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2010-06-26T03:21:15.660

使用“with”可以让你的代码更加枯燥。

考虑以下代码：

```
var photo = document.getElementById('photo');
photo.style.position = 'absolute';
photo.style.left = '10px';
photo.style.top = '10px'; 
```

您可以将其干燥至以下状态：

```
with(document.getElementById('photo').style) {
  position = 'absolute';
  left = '10px';
  top = '10px';
} 
```

我想这取决于您是否偏爱易读性或表现力。

第一个示例更清晰易读，可能推荐用于大多数代码。但无论如何，大多数代码都很温和。第二个有点模糊，但使用语言的表达性来减少代码大小和多余的变量。

我想喜欢 Java 或 C# 的人会选择第一种方式（object.member），而喜欢 Ruby 或 Python 的人会选择后者。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2008-09-14T19:24:29.270

有使用 Delphi 的经验，我会说使用*with*应该是最后的大小优化，可能由某种 javascript 最小化算法执行，可以访问静态代码分析以验证其安全性。

自由使用*with*语句可能遇到的范围界定问题可能是 a** 中的一大痛苦，我不希望任何人经历调试会话来弄清楚他..在你的代码中发生了什么，只是发现它捕获了一个对象成员或错误的局部变量，而不是您想要的全局或外部范围变量。

VB*的 with*语句更好，因为它需要点来消除范围的歧义，但 Delphi *with*语句是一把带有扳机的上膛枪，在我看来，就好像 javascript 足够相似，足以保证相同的警告。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2012-10-24T15:15:52.480

不推荐使用 with，并且在 ECMAScript 5 严格模式下被禁止。推荐的替代方法是将要访问其属性的对象分配给临时变量。

[资料来源：Mozilla.org](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Statements/with)

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2010-02-05T13:08:37.857

with 语句可用于减少代码大小或用于私有类成员，例如：

```
// demo class framework
var Class= function(name, o) {
   var c=function(){};
   if( o.hasOwnProperty("constructor") ) {
       c= o.constructor;
   }
   delete o["constructor"];
   delete o["prototype"];
   c.prototype= {};
   for( var k in o ) c.prototype[k]= o[k];
   c.scope= Class.scope;
   c.scope.Class= c;
   c.Name= name;
   return c;
}
Class.newScope= function() {
    Class.scope= {};
    Class.scope.Scope= Class.scope;
    return Class.scope;
}

// create a new class
with( Class.newScope() ) {
   window.Foo= Class("Foo",{
      test: function() {
          alert( Class.Name );
      }
   });
}
(new Foo()).test(); 
```

如果要修改范围，with 语句非常有用，这是拥有自己的全局范围所必需的，您可以在运行时对其进行操作。您可以在其上放置常量或某些常用的辅助函数，例如“toUpper”、“toLower”或“isNumber”、“clipNumber”等。

关于我经常读到的糟糕性能：限定函数不会对性能产生任何影响，事实上，在我的 FF 中，作​​用域函数比无作用域运行得更快：

```
var o={x: 5},r, fnRAW= function(a,b){ return a*b; }, fnScoped, s, e, i;
with( o ) {
    fnScoped= function(a,b){ return a*b; };
}

s= Date.now();
r= 0;
for( i=0; i < 1000000; i++ ) {
    r+= fnRAW(i,i);
}
e= Date.now();
console.log( (e-s)+"ms" );

s= Date.now();
r= 0;
for( i=0; i < 1000000; i++ ) {
    r+= fnScoped(i,i);
}
e= Date.now();
console.log( (e-s)+"ms" ); 
```

所以在上面提到的方式中使用 with 语句对性能没有负面影响，但是一个很好的，因为它减少了代码大小，什么影响了移动设备上的内存使用。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2010-04-08T17:50:18.730

我认为对象文字的使用很有趣，就像使用闭包的直接替代品

```
for(var i = nodes.length; i--;)
{
       // info is namespaced in a closure the click handler can access!
       (function(info)
       {           
            nodes[i].onclick = function(){ showStuff(info) };
       })(data[i]);
} 
```

或与闭包等效的 with 语句

```
for(var i = nodes.length; i--;)
{
       // info is namespaced in a closure the click handler can access!
       with({info: data[i]})
       {           
            nodes[i].onclick = function(){ showStuff(info) };
       }        
} 
```

我认为真正的风险是意外地减少了不属于 with 语句的变量，这就是为什么我喜欢将对象字面量传递给 with 的原因，您可以在代码中添加的上下文中准确地看到它将是什么。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-09-14T20:05:11.780

使用 with 还会使您的代码在许多实现中变慢，因为现在所有内容都包含在额外的查找范围中。在 JavaScript 中使用 with 没有正当理由。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2010-08-12T19:24:19.257

我创建了一个“合并”函数，它消除了`with`语句中的一些歧义：

```
if (typeof Object.merge !== 'function') {
    Object.merge = function (o1, o2) { // Function to merge all of the properties from one object into another
        for(var i in o2) { o1[i] = o2[i]; }
        return o1;
    };
} 
```

我可以像使用它一样使用它`with`，但我知道它不会影响我不打算影响的任何范围。

用法：

```
var eDiv = document.createElement("div");
var eHeader = Object.merge(eDiv.cloneNode(false), {className: "header", onclick: function(){ alert("Click!"); }});
function NewObj() {
    Object.merge(this, {size: 4096, initDate: new Date()});
} 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-09-15T10:27:25.997

我认为 with 语句在将模板语言转换为 JavaScript 时会派上用场。例如[base2中的](http://code.google.com/p/base2/)[JST](http://code.google.com/p/base2/source/browse/trunk/src/base2/JST/Interpreter.js)，但我经常看到它。

我同意可以在没有 with 语句的情况下对此进行编程。但是因为它没有给出任何问题，所以它是合法的用途。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2012-04-09T17:47:45.780

对于一些短代码片段，我想在度数模式下使用三角函数等`sin`，`cos`而不是在辐射模式下。为此，我使用了一个`AngularDegree`对象：

```
AngularDegree = new function() {
this.CONV = Math.PI / 180;
this.sin = function(x) { return Math.sin( x * this.CONV ) };
this.cos = function(x) { return Math.cos( x * this.CONV ) };
this.tan = function(x) { return Math.tan( x * this.CONV ) };
this.asin = function(x) { return Math.asin( x ) / this.CONV };
this.acos = function(x) { return Math.acos( x ) / this.CONV };
this.atan = function(x) { return Math.atan( x ) / this.CONV };
this.atan2 = function(x,y) { return Math.atan2(x,y) / this.CONV };
}; 
```

然后我可以在度数模式下使用三角函数，而不会在`with`块中产生进一步的语言噪音：

```
function getAzimut(pol,pos) {
  ...
  var d = pos.lon - pol.lon;
  with(AngularDegree) {
    var z = atan2( sin(d), cos(pol.lat)*tan(pos.lat) - sin(pol.lat)*cos(d) );
    return z;
    }
  } 
```

这意味着：我使用一个对象作为函数的集合，我在有限的代码区域中启用这些函数以进行直接访问。我觉得这很有用。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2010-04-04T04:19:04.843

将在相对复杂的环境中运行的代码放入容器中很有用：我使用它为“窗口”创建本地绑定，以便运行用于 Web 浏览器的代码。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2008-09-14T19:43:43.810

我真的不明白使用 with 比键入 object.member 更具可读性。我不认为它的可读性降低了，但我也不认为它的可读性更高。

就像 lassevk 所说，我绝对可以看到使用 with 比使用非常明确的“object.member”语法更容易出错。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2008-10-06T22:08:50.517

我认为 的有用性`with`可能取决于您的代码编写得如何。例如，如果您正在编写如下所示的代码：

```
var sHeader = object.data.header.toString();
var sContent = object.data.content.toString();
var sFooter = object.data.footer.toString(); 
```

那么你可以争辩说这样`with`做会提高代码的可读性：

```
var sHeader = null, sContent = null, sFooter = null;
with(object.data) {
    sHeader = header.toString();
    sContent = content.toString();
    sFooter = content.toString();
} 
```

相反，可以说你违反[了得墨忒耳法则](http://en.wikipedia.org/wiki/Law_of_Demeter)，但话又说回来，也许不是。我离题了=）。

最重要的是，要知道 Douglas Crockford 建议**不要**使用`with`. [我敦促您在此处](http://yuiblog.com/blog/2006/04/11/with-statement-considered-harmful/)查看他的博客文章`with`及其替代方案。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2011-06-15T16:13:31.060

CoffeeScript 的[Coco](http://github.com/satyr/coco) fork 有一个`with`关键字，但它只是将`this`（`@`在 CoffeeScript/Coco 中也可写）设置为块内的目标对象。这消除了歧义并实现了 ES5 严格模式合规性：

```
with long.object.reference
  @a = 'foo'
  bar = @b 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2010-09-08T09:20:24.093

[您必须在 W3schools http://www.w3schools.com/js/js_form_validation.asp](http://www.w3schools.com/js/js_form_validation.asp)上查看 javascript 表单的验证，其中“扫描”对象表单以查找名称为“电子邮件”的输入

但是我已经修改它以从任何表单中获取所有字段验证为非空，无论表单中字段的名称或数量如何。好吧，我只测试了文本字段。

但是 with() 使事情变得更简单。这是代码：

```
function validate_required(field)
{
with (field)
  {
  if (value==null||value=="")
    {
    alert('All fields are mandtory');return false;
    }
  else
    {
    return true;
    }
  }
}

function validate_form(thisform)
{
with (thisform)
  {
    for(fiie in elements){
        if (validate_required(elements[fiie])==false){
            elements[fiie].focus();
            elements[fiie].style.border='1px solid red';
            return false;
        } else {elements[fiie].style.border='1px solid #7F9DB9';}
    }

  }
  return false;
} 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2020-11-30T16:54:58.820

**对代理对象使用“with”语句**

我最近想为[babel](https://babeljs.io/)编写一个启用宏的插件。我想有一个单独的变量命名空间来保存我的宏变量，我可以在那个空间中运行我的宏代码。另外，我想检测宏代码中定义的新变量（因为它们是新宏）。

首先，我选择了[vm](https://nodejs.org/api/vm.html)模块，但我发现 vm 模块中的 Array、Object 等全局变量与主程序不同，我无法实现`module`并且`require`与该全局对象完全兼容（因为我无法重构核心模块）。最后，我找到了“with”语句。

```
const runInContext = function(code, context) {
    context.global = context;
    const proxyOfContext = new Proxy(context, { has: () => true });
    let run = new Function(
        "proxyOfContext",
        `
            with(proxyOfContext){
                with(global){
                        ${code}
                }
            }
        `
    );
    return run(proxyOfContext);
}; 
```

这个代理对象捕获所有变量的搜索并说：“是的，我有那个变量。” 如果代理对象实际上没有该变量，则将其值显示为`undefined`.

这样，如果在宏`code`中用`var`语句定义了任何变量，我可以在上下文对象中找到它（如 vm 模块）。但是在那个时间定义`let`或`const`仅可用并且不会保存在上下文对象中的变量（vm模块保存它们但不公开它们）。

**性能**：此方法的性能优于`vm.runInContext`。

**安全**：如果你想在沙箱中运行代码，这无论如何都不安全，你必须使用 vm 模块。它只提供一个新的命名空间。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2016-06-05T09:48:49.440

我的

```
switch(e.type) {
    case gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED: blah
    case gapi.drive.realtime.ErrorType.CLIENT_ERROR: blah
    case gapi.drive.realtime.ErrorType.NOT_FOUND: blah
} 
```

归结为

```
with(gapi.drive.realtime.ErrorType) {switch(e.type) {
    case TOKEN_REFRESH_REQUIRED: blah
    case CLIENT_ERROR: blah
    case NOT_FOUND: blah
}} 
```

你能相信这么低质量的代码吗？不，我们看到它变得完全不可读。这个例子无可否认地证明，如果我正确地理解了可读性，就不需要 with-statement ;)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2014-04-25T06:26:42.500

正如 Andy E 在 Shog9's answer 的评论中指出的那样，这种潜在的意外行为在`with`与对象文字一起使用时会发生：

```
for (var i = 0; i < 3; i++) {
  function toString() {
    return 'a';
  }
  with ({num: i}) {
    setTimeout(function() { console.log(num); }, 10);
    console.log(toString()); // prints "[object Object]"
  }
} 
```

并不是说意外行为*还不*是`with`.

如果你真的还想使用这种技术，至少使用一个带有空原型的对象。

```
function scope(o) {
  var ret = Object.create(null);
  if (typeof o !== 'object') return ret;
  Object.keys(o).forEach(function (key) {
    ret[key] = o[key];
  });
  return ret;
}

for (var i = 0; i < 3; i++) {
  function toString() {
    return 'a';
  }
  with (scope({num: i})) {
    setTimeout(function() { console.log(num); }, 10);
    console.log(toString()); // prints "a"
  }
} 
```

但这仅适用于 ES5+。也不要使用`with`.

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2013-09-25T18:38:34.123

`with`使用 require.js 时，您可以避免显式管理arity：

```
var modules = requirejs.declare([{
    'App' : 'app/app'
}]);

require(modules.paths(), function() { with (modules.resolve(arguments)) {
    App.run();
}}); 
```

requirejs.declare 的实现：

```
requirejs.declare = function(dependencyPairs) {
    var pair;
    var dependencyKeys = [];
    var dependencyValues = [];

    for (var i=0, n=dependencyPairs.length; i<n; i++) {
        pair = dependencyPairs[i];
        for (var key in dependencyPairs[i]) {
            dependencyKeys.push(key);
            dependencyValues.push(pair[key]);
            break;
        }
    };

    return {
        paths : function() {
            return dependencyValues;
        },

        resolve : function(args) {
            var modules = {};
            for (var i=0, n=args.length; i<n; i++) {
                modules[dependencyKeys[i]] = args[i];
            }
            return modules;
        }
    }   
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2014-11-03T04:22:28.903

我正在开发一个允许用户上传代码以修改应用程序部分行为的项目。在这种情况下，我一直在使用一个`with`子句来防止他们的代码修改我希望他们搞砸的范围之外的任何内容。我用来执行此操作的代码的（简化）部分是：

```
// this code is only executed once
var localScope = {
    build: undefined,

    // this is where all of the values I want to hide go; the list is rather long
    window: undefined,
    console: undefined,
    ...
};
with(localScope) {
    build = function(userCode) {
        eval('var builtFunction = function(options) {' + userCode + '}');
        return builtFunction;
    }
}
var build = localScope.build;
delete localScope.build;

// this is how I use the build method
var userCode = 'return "Hello, World!";';
var userFunction = build(userCode); 
```

此代码确保（在某种程度上）用户定义的代码既不能访问任何全局范围的对象，例如`window`也不能通过闭包访问我的任何局部变量。

就像对聪明人说的那样，我仍然必须对用户提交的代码执行静态代码检查，以确保他们没有使用其他偷偷摸摸的方式来访问全局范围。例如，以下用户定义的代码可以直接访问`window`：

```
test = function() {
     return this.window
};
return test(); 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2013-01-20T19:06:35.103

这是一个很好的用途`with`：根据存储在该对象中的值向对象文字添加新元素。这是我今天刚刚使用的一个示例：

我有一组可以使用的可能的牌（开口朝上、下、左或右），我想要一种快速的方法来添加一个总是在游戏开始时放置和锁定的牌列表. 我不想继续`types.tbr`为列表中的每种类型输入，所以我只使用了`with`.

```
Tile.types = (function(t,l,b,r) {
  function j(a) { return a.join(' '); }
  // all possible types
  var types = { 
    br:  j(  [b,r]),
    lbr: j([l,b,r]),
    lb:  j([l,b]  ),  
    tbr: j([t,b,r]),
    tbl: j([t,b,l]),
    tlr: j([t,l,r]),
    tr:  j([t,r]  ),  
    tl:  j([t,l]  ),  
    locked: []
  };  
  // store starting (base/locked) tiles in types.locked
  with( types ) { locked = [ 
    br,  lbr, lbr, lb, 
    tbr, tbr, lbr, tbl,
    tbr, tlr, tbl, tbl,
    tr,  tlr, tlr, tl
  ] } 
  return types;
})("top","left","bottom","right"); 
```

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2015-04-17T04:28:44.030

只是想补充一下，您可以通过漂亮的语法获得“with()”功能，并且使用您自己的聪明方法没有歧义......

```
 //utility function
  function _with(context){
           var ctx=context;
           this.set=function(obj){
             for(x in obj){
                //should add hasOwnProperty(x) here
                ctx[x]=obj[x];
             }
       } 

       return this.set;          
 }

 //how calling it would look in code...

  _with(Hemisphere.Continent.Nation.Language.Dialect.Alphabet)({

      a:"letter a",
      b:"letter b",
      c:"letter c",
      d:"letter a",
      e:"letter b",
      f:"letter c",
     // continue through whole alphabet...

  });//look how readable I am!!!! 
```

..或者如果你*真的*想使用“with()”，没有歧义并且没有自定义方法，将它包装在一个匿名函数中并使用 .call

```
//imagine a deeply nested object 
//Hemisphere.Continent.Nation.Language.Dialect.Alphabet
(function(){
     with(Hemisphere.Continent.Nation.Language.Dialect.Alphabet){ 
         this.a="letter a";
         this.b="letter b";
         this.c="letter c";
         this.d="letter a";
         this.e="letter b";
         this.f="letter c";
         // continue through whole alphabet...
     }
}).call(Hemisphere.Continent.Nation.Language.Dialect.Alphabet) 
```

然而，正如其他人所指出的那样，它有点毫无意义，因为你可以这样做......

```
 //imagine a deeply nested object Hemisphere.Continent.Nation.Language.Dialect.Alphabet
     var ltr=Hemisphere.Continent.Nation.Language.Dialect.Alphabet 
     ltr.a="letter a";
     ltr.b="letter b";
     ltr.c="letter c";
     ltr.d="letter a";
     ltr.e="letter b";
     ltr.f="letter c";
     // continue through whole alphabet... 
```

# spell-checking - 使用 mod_python 的 python 拼写检查服务

> ID：61556
> 
> 赞同：0
> 
> 时间：2008-09-14T18:58:51.003
> 
> 标签：spell-checking, mod-python, aspell

`aspell_python`开发与 apache一起使用的拼写检查引擎（例如 with ）的最佳可用方法是什么`mod_python`？

`apache 2.0.59+RHEL4+mod_python+aspell_python`似乎崩溃了。

有没有其他选择`aspell_python`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-14T19:11:45.213

看起来 RHEL4 是罪魁祸首。在 Fedore 7 上运行良好（apache 版本较新且没有崩溃）

# java - .NET/Mono 或 Java 是跨平台开发的更好选择吗？

> ID：61559
> 
> 赞同：108
> 
> 时间：2008-09-14T19:00:24.460
> 
> 标签：java, .net, linux, mono, cross-platform

Mono 的库比 Java 少多少？

我缺乏对这两种选择的概述，但我对我的下一个项目有很大的选择自由。我正在寻找以下领域的硬技术事实

*   性能（例如，有人告诉我 Java 对线程很有好处，而且我听说运行时代码优化最近对 .NET 变得非常好）
*   *现实世界*的便携性（它都意味着便携，每个 Catch-22 是什么？）
*   工具可用性（[CI](http://en.wikipedia.org/wiki/Continuous_integration)、构建自动化、调试、IDE）

我特别在寻找您在自己的工作中实际体验到的东西，而不是我可以用谷歌搜索的东西。我的应用程序将是一个处理大量时间序列数据的后端服务。

我的主要目标平台是 Linux。

**编辑：** *为了更充分地表达我的问题，我对整个软件包（第三方库等）感兴趣，而不仅仅是语言。对于库，这可能归结为“Mono 的库比 Java 少多少”这个问题？*

* * *

仅供参考，此后我为这个项目选择了 Java，因为它在可移植性方面似乎更加经久不衰，而且它在旧系统上也已经存在了一段时间。我有点难过，因为我对 C# 很好奇，我很想在里面做一些大项目，但也许下次吧。感谢所有的建议。

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2012-01-28T22:01:03.830

Mono 在定位我想要支持的平台方面做得更好。除此之外，一切都是主观的。

我在以下平台上共享 C# 代码： - iOS (iPhone/iPad) - Android - Web (HTML5) - Mac (OS X) - Linux - Windows

我可以在更多地方分享它： - Windows Phone 7 - Wii - XBox - PS3 - 等等。

最重要的是 iOS，因为[MonoTouch](http://xamarin.com/monotouch)工作得非常好。我不知道使用 Java 来定位 iOS 的任何好方法。你不能用 Java 来定位 Windows Phone 7，所以我想说 Java 更适合移动设备的日子已经过去了。

不过，对我来说最大的因素是个人生产力（和幸福感）。恕我直言，C# 作为一种语言比 Java 早了好几年，而 .NET 框架使用起来很有趣。Java 7 和 Java 8 中添加的大部分内容多年来一直在 C# 中。不过 Scala 和 Clojure 等 JVM 语言（两者都在 CLR 上可用）非常好。

我认为 Mono 本身就是一个平台（一个很棒的平台），并将 .NET 视为 Microsoft 在 Windows 上的 Mono 实现。这意味着我首先在 Mono 上进行开发和测试。这非常有效。

如果 Java 和 .NET（比如说 Mono）都是没有任何公司支持的开源项目，那么我每次都会选择 Mono 而不是 Java。我相信这只是一个更好的平台。

.NET/Mono 和 JVM 都是不错的选择，尽管我个人会在 JVM 上使用 Java 以外的其他语言。

# 我对其他一些评论的看法：

**问题：性能。**

**答案：JVM 和 CLR 的性能都比批评者说的要好。我会说 JVM 性能更好。Mono 通常比 .NET 慢（尽管并非总是如此）。

无论是作为开发人员还是最终用户，我个人都会在任何一天都使用 ASP.NET MVC 而不是 J2EE。对[Google Native Client](http://www.mono-project.com/Release_Notes_Mono_2.10#Google_Native_Client_Support)的支持也很酷。另外，我知道桌面 Java 应用程序较差的 GUI 性能应该已经成为过去，但我一直发现速度很慢。再说一次，我可以对 WPF 说同样的话。GTK# 虽然速度很快，但没有理由让它们变慢。

**问题：Java 有一个更大的可用库生态系统。**

**答：可能是真的，但在实践中这不是问题。**

[由于IKVM.NET](http://www.ikvm.net/)，几乎每个 Java 库（包括 JDK）都可以在 .NET/Mono 上运行。这项技术是一个真正的奇迹。整合是惊人的；您可以像使用原生 Java 库一样使用它。不过，我只需要在一个 .NET 应用程序中使用 Java 库。.NET/Mono 生态系统通常提供比我需要的更多的东西。

**问题：Java 有更好（更广泛）的工具支持**

**答：不在 Windows 上。否则我同意。MonoDevelop 还是不错的。**

我想向[MonoDevelop](http://monodevelop.com/)大喊一声；它是一颗宝石。MonoDevelop 集成了我想要使用的大多数工具，包括代码完成（智能感知）、Git/Subversion 集成、对单元测试的支持、SQL 集成、调试、轻松重构以及通过动态反编译进行程序集浏览。对从服务器端 Web 到移动应用程序的所有内容使用相同的环境真是太好了。

**问题：跨平台的兼容性。**

**答：Mono 是跨所有平台（包括 Windows）的单一代码库。**

如果您愿意，首先为 Mono 开发并部署到 Windows 上的 .NET。如果您将 .NET 从 MS 与 Java 进行比较，那么 Java 在跨平台的一致性方面具有优势。看下一个答案...

**问题：Mono 滞后于 .NET。**

**回答：不，它没有。**恕我直言，这是一个经常陈述但不正确的陈述。

Xamarin 的 Mono 发行版附带 C#、VB.NET、F#、IronPython、IronRuby，我认为 Boo 可能是开箱即用的。Mono C# 编译器与 MS 完全同步。Mono VB.NET 编译器确实落后于 MS 版本。其他编译器在两个平台上都是相同的（其他 .NET 语言如 Nemerle、Boo 和 Phalanger (PHP) 也是如此）。

Mono 附带了许多实际的 Microsoft 编写代码，包括动态语言运行时 (DLR)、托管可扩展性框架 (MEF)、F# 和 ASP.NET MVC。因为 Razor 不是开源的，Mono 目前与 MVC2 一起提供，但 MVC3 在 Mono 上工作得很好。

核心 Mono 平台与 .NET 或多年保持同步，兼容性令人印象深刻。您现在可以使用完整的 C# 4.0 语言，甚至某些 C# 5.0 功能。事实上，Mono 经常在很多方面领先于 .NET。

Mono 实现了部分 CLR 规范，甚至 Microsoft 也不支持（如 64 位数组）。.NET 世界中最令人兴奋的新技术之一是[Rosylyn](http://en.wikipedia.org/wiki/Microsoft_Roslyn)。Mono 多年来一直将 C# 编译器作为服务提供。Rosylyn 提供的一些东西也可以通过[NRefractory](http://wiki.sharpdevelop.net/NRefactory.ashx)获得。Mono 仍然领先的一个例子是用于加速游戏性能的 SIMD 指令。

Microsoft 确实提供了许多基于 .NET 的产品，这些产品在 Mono 中不可用，这是对 Mono 滞后的误解的来源。Windows Presentation Foundation (WPF)、Entity Framework (EF)、WCF (Windows Communication Foundation) 是在 Mono 上无法运行或支持不佳的产品示例。显而易见的解决方案是使用 GTK#、NHibernate 和 ServiceStack 等跨平台替代方案。

**问题：微软是邪恶的。**

**答：没错。所以呢。**

许多人提出以下理由来避免使用 Mono：

1) 你不应该使用 Mono，因为应该避免使用 Microsoft 技术

2) Mono 很烂，因为它不允许你使用微软提供的所有技术

对我来说，很明显这些陈述是不相容的。我拒绝第一个陈述，但将在此处跳过该论点。第二个陈述适用于所有 .NET 替代方案。

JVM 是一个很棒的平台，JVM 语言的爆炸式增长令人惊叹。使用让你快乐的东西。目前，这对我来说通常是 .NET/Mono。

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2008-09-14T19:05:57.647

嗯....Java 实际上更便携。Mono 并没有在任何地方实现，而且它大大落后于 Microsoft 的实现。Java SDK 似乎可以更好地跨平台保持同步（并且可以在更多平台上运行）。

我还要说 Java 在所有这些平台上都有更多的工具可用性，尽管在 Windows 平台上有很多可用于 .NET 的工具。

**2014 年更新**

我在 2014 年仍然持有这种观点。但是，我会说我现在才开始关注 Mono 在很长一段时间没有真正关心之后，所以我可能会在 Mono 运行时（或生态系统）中有所改进。 ) 我没有被告知。AFAIK，仍然不支持 WIF、WCF、WF、WIF。Mono 可以在 iOS 上运行，但据我所知，Java 运行时仍然可以在比 Mono 更多的平台上运行。此外，Mono 开始看到一些改进的工具（Xamarin），微软似乎有更多跨平台的态度和愿意与合作伙伴合作，使他们成为互补，而不是竞争（例如，Mono 将即将到来的 OWIN/Helios ASP.NET 领域的一个非常重要的部分）。我怀疑在未来几年，便携性的差异会迅速缩小，

**2018 年更新**

我对此的看法开始转向另一种方式。我认为广泛的 .NET，尤其是 .NET Core，已经开始实现与 Java 的“可移植性平等”。正在努力将 WPF 引入某些平台的 .NET Core，而 .NET Core 本身现在可以在许多平台上运行。Mono（由 Xamarin 所有，现在归 Microsoft 所有）是比以往任何时候都更加成熟和完善的产品，编写可在多个平台上运行的应用程序不再是 .NET 黑客的深入了解领域，而是一项相对简单的工作. 当然，有一些库、服务和应用程序仅适用于 Windows 或只能针对特定平台 - 但 Java（广义上）也可以这样说。

如果此时我站在 OP 的立场上，我想不出语言或技术堆栈本身固有的任何原因会阻止我从这一点开始为任何应用程序选择 .NET。

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2008-09-14T19:13:08.720

我实际上是在 .NET 中开发的，首先在 Mono 上运行我的所有测试，然后在 Windows 上运行。这样我就知道我的应用程序是跨平台的。我在 ASP.NET 和 Winforms 应用程序上都非常成功地做到了这一点。

我不太确定有些人从哪里得到 Mono 如此可怕的印象，但它确实在我的案例和观点中完成了它的工作。确实，对于 .NET 中最新和最伟大的发明，你会有些滞后世界，但到目前为止，Windows 和 Linux 上的 .NET 2.0 对我来说非常可靠。

请记住，这显然有很多怪癖，但其中大部分来自确保您正在编写可移植代码。虽然框架在抽象出您正在运行的操作系统方面做得很好，但像 Linux 在路径和文件名中区分大小写这样的小事情需要一些时间来适应，就像权限这样的事情。

根据我迄今为止的经验，由于 Mono，.NET 绝对是非常跨平台的。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-09-14T19:10:14.907

Java 实际上正如大家所说的那样是跨平台的。几乎所有主流操作系统都有一个 JVM 实现（最后甚至是 Mac OS X），而且它们都运行得非常好。并且有大量的开源工具可以跨平台。

唯一的问题是，如果不编写一些 DLL 或 SO，您将无法在 Java 中执行某些本机操作。这些在实践中很少出现。不过，在所有这些情况下，我都能够通过生成本机进程和屏幕抓取结果来绕过它。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-09-14T19:02:46.530

我认为这个问题的措辞不正确。就跨平台使用而言，C# 与 Java 相比 (a) 您需要支持哪些平台，以及 (b) 考虑核心库和可用的第三方库，它的意义要小得多。语言几乎是决策过程中最不重要的部分。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2009-01-15T22:45:25.990

Java 是跨平台开发的更好选择。

*   表现。由于虚拟机，Java 和 .Net 具有相似的性能水平，但 JVM 通常具有更好的性能，因为经过多年的优化。

*   图书馆。尽管这取决于您的任务，但 Java 有更多可用的开源或第三方库。对于服务器 App，J2EE，Spring，Struts 等。对于 GUI，虽然 .Net 提供了 Win32 层 API，但这会导致兼容性问题。Java 有 Swing、SWT、AWT 等。它在大多数情况下都可以工作。

*   兼容性。这是开发跨平台程序时需要考虑的关键问题。两个问题：第一，平台兼容性。Java 仍然获胜，因为 JDK 由单一的原始公司 Sun 很好地维护。Mono 不由 MS 维护，因此您无法保证更新兼容性。2\. 向后兼容。Sun 在向后兼容性方面保持着良好的声誉，尽管有时这似乎过于死板并减慢了步伐。

*   工具。Java 有很好的跨平台 IDE。Netbeans、Eclipse 等。其中大部分是免费的。VS Studio 很好，但只在 Windows 上，而且不贵。它们都提供了良好的单元测试、调试、配置文件等。

因此，我建议 Java 是一个更好的选择。举个例子，Java 开发的一些著名的桌面跨平台应用程序：Vuze、Limewire、BlogBridge、CrossFTP，更不用说那些 IDE。至于 .Net，我对此类成功应用的了解有限。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-15T04:19:35.990

我一直在问同样的问题，恕我直言，.NET/Mono 似乎是一个更好的选择，仅仅是因为[Mono 在跨平台桌面应用程序](http://www.mono-project.com/Companies_Using_Mono)（而不是 Java）方面有着良好的记录，当然，[Mono 是](http://tirania.org/blog/)这些天[来突飞猛进的进步。](http://tirania.org/blog/)

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-14T23:39:06.693

我也会说Java。如果从成熟度的角度来看，Sun（和其他公司）已经花费了更多的时间和精力来让 JVM 在非 Windows 平台上工作。

相比之下，Mono 绝对是 .NET 生态系统中的二等公民。

根据您的目标客户是谁，您可能还会发现反对使用 Mono 的真正阻力 - Novell 是否为 Mono 提供与 Windows 上的 Java 或 .NET 相同的供应商支持？

如果您的主要目标是在 Windows 上托管您的服务，那么考虑这个选择是有意义的，但由于您主要针对 Linux，这对我来说似乎是一种不费吹灰之力。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-09-14T20:16:53.857

Java 被设计为跨平台的；C#/.Net 不是。如有疑问，请使用专为您的目的设计的工具。

编辑：公平地说，.NET 设计用于嵌入式/PC/服务器环境，所以这是跨平台的排序。但它不是为 Linux 设计的。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-15T04:48:55.687

我认为答案是“视情况而定”。Java 几乎可以在任何东西上运行，但 .NET/Mono 是（恕我直言）更好的桌面框架。所以我想答案真的取决于你计划定位的平台。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-09-15T03:41:32.727

再多说一点，如果你落后一个版本，Java 就更便携了——Java 5 仍然有许多优秀的特性，所以你可以等待 Java 6 并且在语言和库方面仍有很多范围要开发和。Mac 是主要平台，可能需要一些时间才能赶上最新的 Java 版本。

Java 还拥有一个优秀的[标准机构](http://www.jcp.org)，可以根据来自许多不同公司的输入智能地扩展平台。这是一个经常被忽视的特性，但它甚至使新特性在多个平台上都能很好地工作，并为一些深奥的东西（作为可选扩展）提供了广泛的库支持。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-09-15T03:03:34.177

我会投票支持 Java 比 C# 更便携。Java 肯定也有一套非常丰富的标准库。还有一组广泛的开源 3rd 方库，例如由 Jakarta 项目 ( [http://jakarta.apache.org/](http://jakarta.apache.org/) ) 提供的库。

CI、单元测试等也存在所有常见的嫌疑人。Eclipse、Netbeans、IntelliJ IDEA 等跨平台 IDE 支持也非常好。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-15T02:48:54.570

还有其他语言选择。我已经非常喜欢 Python，它在 Windows、Linux 和 Mac 上运行良好，并且具有丰富的库集。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-11-05T12:27:29.653

虽然 Mono 有[一些问题](https://stackoverflow.com/questions/18450/is-mono-ready-for-prime-time#264959)，但我认为它具有更好的跨平台兼容性故事，尤其是如果您依赖本机平台调用。

Stack Overflow 上没有足够的文字来强调在 .NET/Mono 中（至少在我的经验 3...）多个平台上与等效的 Java 工作相比，在 .NET/Mono 中调用和执行本机程序有多顺畅。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2011-11-21T12:24:29.553

**Gatorhall**你有数据支持吗？

> *表现。由于虚拟机，Java 和 .Net 具有相似的性能水平，但 JVM 通常具有更好的性能，因为经过多年的优化。*

背景：我从 Windows 3.1 开始就是一名 Windows 用户，目前是一名 Linux 用户（仍在为 Visual Studio 2010 和其他工具运行的虚拟机上运行 Windows 7、出色的操作系统）。

重点：我和我认识的很多用户（windows、linux 等）可能不同意你的看法。即使在 linux 桌面应用程序上，Java 的执行速度也往往较慢，而 ASP.NET 的执行速度通常比 Java 服务器页面要快很多。有些人可能会同意，即使是未编译的 PHP 在几种情况下也能表现得更好。

Java更跨平台？我对此毫无疑问（历史可以追溯到这一点），但更快（不是说 .NET 是）不是那么确定，我希望看到一些真正的基准。

# html - 使 DHTMLEd 控件用弯引号替换直引号的代码

> ID：61598
> 
> 赞同：10
> 
> 时间：2008-09-14T19:51:48.613
> 
> 标签：html, dom, vb6

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-15T08:57:53.247

这是VB6版本：

```
Private Sub DHTMLEdit1_onkeypress()
    Dim e As Object
    Set e = DHTMLEdit1.DOM.parentWindow.event
    'Perform smart-quote replacement'
    Select Case e.keyCode
    Case 34: 'Double-Quote'
        e.keyCode = 0
        If IsAtWordEnd Then
            InsertDoubleUndo ChrW$(8221), ChrW$(34)
        Else
            InsertDoubleUndo ChrW$(8220), ChrW$(34)
        End If
    Case 39: 'Single-Quote'
        e.keyCode = 0
        If IsAtWordEnd Then
            InsertDoubleUndo ChrW$(8217), ChrW$(39)
        Else
            InsertDoubleUndo ChrW$(8216), ChrW$(39)
        End If
    End Select
End Sub

Private Function IsLetter(ByVal character As String) As Boolean
    IsLetter = UCase$(character) <> LCase$(character)
End Function

Private Sub InsertDoubleUndo(VisibleText As String, HiddenText As String)
    Dim selection As Object
    Set selection = DHTMLEdit1.DOM.selection.createRange()
    selection.Text = HiddenText
    selection.moveStart "character", -Len(HiddenText)
    selection.Text = VisibleText
End Sub

Private Function IsAtWordEnd() As Boolean

    Dim ch As String
    ch = PreviousChar
    IsAtWordEnd = (ch <> " ") And (ch <> "")

End Function

Private Function PreviousChar() As String

    Dim selection As Object
    Set selection = m_dom.selection.createRange()
    selection.moveStart "character", -1
    PreviousChar = selection.Text

End Function 
```

注意：此解决方案在撤消链中插入了一个附加级别。例如，键入“这是一个测试”会给出一个“这是一个测试”->“这是一个测试”-> **“这是一个测试**->“->”的链（额外的粗体级别）。要删除这个额外的级别，您必须实施某种`PostMessage+subclassing`不涉及取消本机按键的解决方案

编辑：如果您的目标是 Windows Vista，请不要忘记包含可[再发行的 DHTML 编辑控件。](http://www.microsoft.com/downloads/details.aspx?familyid=b769a4b8-48ed-41a1-8095-5a086d1937cb&displaylang=en)

# language-agnostic - api 文档和“价值限制”：它们匹配吗？

> ID：61604
> 
> 赞同：6
> 
> 时间：2008-09-14T20:13:51.227
> 
> 标签：language-agnostic, documentation, comments, design-by-contract

您是否经常在 API 文档（例如“公共函数的 javadoc”）中看到“值限制”的描述以及经典文档？

**注意：**我不是在谈论[代码中的注释](https://stackoverflow.com/questions/20922/do-you-comment-your-code)

通过“价值限制”，我的意思是：

*   参数是否可以支持空值（或空字符串，或...）？
*   '返回值'可以为空还是保证永远不会为空（或者可以是“空”，或者......）？

**样本：**

我经常看到的（无法访问源代码）是：

```
/**
 * Get all readers name for this current Report. <br />
 * <b>Warning</b>The Report must have been published first.
 * @param aReaderNameRegexp filter in order to return only reader matching the regexp
 * @return array of reader names
 */
 String[] getReaderNames(final String aReaderNameRegexp); 
```

我*希望看到*的是：

```
/**
 * Get all readers name for this current Report. <br />
 * <b>Warning</b>The Report must have been published first.
 * @param aReaderNameRegexp filter in order to return only reader matching the regexp 
 * (can be null or empty)
 * @return array of reader names 
 * (null if Report has not yet been published, 
 *  empty array if no reader match criteria, 
 *  reader names array matching regexp, or all readers if regexp is null or empty)
 */
 String[] getReaderNames(final String aReaderNameRegexp); 
```

**我的观点是：**

当我使用带有 getReaderNames() 函数的库时，我通常甚至不需要阅读 API 文档来猜测它的作用。但我需要确定*如何使用它*。

当我想使用这个函数时，我唯一关心的是：在参数和返回值方面我应该期待什么？这就是我安全设置参数和安全测试返回值所需要知道的全部内容，但我几乎从未在 API 文档中看到此类信息......

**编辑：**

这可能会影响已*[检查或未检查异常](https://stackoverflow.com/questions/27578#73355)*的使用或不使用。

你怎么看 ？值限制和 API，它们是否属于一起？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-14T20:21:57.417

我认为他们**可以**属于一起，但不一定**必须**属于一起。在您的场景中，似乎有必要将限制记录在生成的 API 文档和智能感知中（如果语言/IDE 支持它）。

我认为这也取决于语言。例如，Ada 有一个本地数据类型，它是一个“受限整数”，您可以在其中定义一个整数变量并明确指出它只会（并且总是）在某个数字范围内。在这种情况下，数据类型本身表明了限制。它仍然应该通过 API 文档和智能感知可见和可发现，但开发人员不必在评论中指定。

然而，像 Java 和 C# 这样的语言没有这种类型的受限整数，因此如果它是应该成为公共文档一部分的信息，开发人员必须在注释中指定它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-14T20:19:06.613

我认为这些边界条件绝对属于 API。但是，我会（并且经常这样做）更进一步，并指出这些空值的含义。要么我表明它会抛出异常，要么我解释传入边界值时的预期结果。

很难记住总是这样做，但这对您班级的用户来说是件好事。如果方法呈现的合同发生变化（例如将空值更改为不允许），也很难维护它......当您更改方法的语义时，您还必须努力更新文档。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-06-14T20:46:09.043

**问题 1**

> 您是否经常在 API 文档（例如“公共函数的 javadoc”）中看到“值限制”的描述以及经典文档？

几乎从不。

**问题2**

> 当我想使用这个函数时，我唯一关心的是：在参数和返回值方面我应该期待什么？这就是我安全设置参数和安全测试返回值所需要知道的全部内容，但我几乎从未在 API 文档中看到此类信息......

如果我不正确地使用了一个函数，我会期望`RuntimeException`该方法或程序的`RuntimeException`另一个（有时很远）部分抛出一个。

在我看来，像这样的评论是一种在[Javadoc](http://en.wikipedia.org/wiki/Javadoc)中以人类语言`@param aReaderNameRegexp filter in order to ... (can be null or empty)`实现**[按合同设计](http://en.wikipedia.org/wiki/Design_by_contract)**的方法。

使用 Javadoc 来执行按合同设计`iContract`，现在已重新使用[`JcontractS`](http://jcontracts.sourceforge.net/addingContracts.html)，它允许您以比人类语言更正式的方式指定*不变量、前置条件、后置条件。*

**问题 3**

> 这可能会影响已检查或未检查异常的使用或不使用。你怎么看 ？值限制和 API，它们是否属于一起？

Java 语言没有按合同设计的特性，因此您可能会很想使用`Execption`，但我同意您的观点，即您必须了解[何时选择已检查和未检查的异常](https://stackoverflow.com/questions/27578/when-to-choose-checked-and-unchecked-exceptions#73355)。可能您可能会使用 unchecked `IllegalArgumentException`, `IllegalStateException`，或者您可能会使用单元测试，但主要问题是如何与其他程序员沟通此类代码是关于按合同设计的，并且在更改它之前应该将其视为合同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-14T20:18:26.567

我认为他们这样做，并且总是在头文件（c++）中放置注释。

除了有效的输入/输出/返回注释之外，我还注意到函数可能会抛出哪些异常（因为我经常想将返回值用于......以及返回一个值，我更喜欢异常而不是错误代码）

```
//File:
// Should be a path to the teexture file to load, if it is not a full path (eg "c:\example.png") it will attempt to find the file usign the paths provided by the DataSearchPath list
//Return: The pointer to a Texture instance is returned, in the event of an error, an exception is thrown. When you are finished with the texture you chould call the Free() method.
//Exceptions:
//except::FileNotFound
//except::InvalidFile
//except::InvalidParams
//except::CreationFailed
Texture *GetTexture(const std::string &File); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-14T20:43:42.780

@Fire Lancer：对！我忘记了异常，但我希望看到它们被提及，尤其是这个公共方法可能抛出的未经检查的“运行时”异常

@迈克·斯通：

> 当您更改方法的语义时，您还必须努力更新文档。

嗯，我当然希望*公共 API 文档*至少在发生更改（影响函数合同）时进行更新。如果没有，这些 API 文档可能会被完全删除。

为了给你的想法添加食物（和@Scott Dorman一起去），我偶然[发现了java7注释的未来](http://today.java.net/pub/a/today/2008/09/11/jsr-305-annotations.html)

那是什么意思？某些“边界条件”，而不是在文档中，应该在 API 本身中更好，并在编译时自动使用适当的“断言”生成代码。

这样，如果 API 中有一个“@CheckForNull”，那么函数的编写者可能会侥幸逃脱，甚至不记录它！如果语义发生变化，它的 API 将反映这种变化（例如“不再有 @CheckForNull”）

这种方法表明，对于“边界条件”，记录是一种额外的奖励，而不是强制性的做法。

但是，这不包括函数返回对象的特殊值。为此，仍然需要*完整的文档。*

# python - 函数返回多个值是pythonic吗？

> ID：61605
> 
> 赞同：85
> 
> 时间：2008-09-14T20:15:19.977
> 
> 标签：python, function, return-value, multiple-return-values

在python中，你可以让一个函数返回多个值。这是一个人为的例子：

```
def divide(x, y):
    quotient = x/y
    remainder = x % y
    return quotient, remainder  

(q, r) = divide(22, 7) 
```

这看起来非常有用，但看起来它也可以被滥用（“嗯..函数 X 已经计算出我们需要的中间值。让我们也让 X 返回那个值”）。

什么时候应该画线并定义不同的方法？

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-09-14T20:54:14.190

绝对（对于您提供的示例）。

### 元组是 Python 中的一等公民

有一个内置函数[`divmod()`](https://docs.python.org/3/library/functions.html#divmod)可以做到这一点。

```
q, r = divmod(x, y) # ((x - x%y)/y, x%y) Invariant: div*y + mod == x 
```

还有其他例子：`zip`, `enumerate`, `dict.items`。

```
for i, e in enumerate([1, 3, 3]):
    print "index=%d, element=%s" % (i, e)

# reverse keys and values in a dictionary
d = dict((v, k) for k, v in adict.items()) # or 
d = dict(zip(adict.values(), adict.keys())) 
```

顺便说一句，大多数时候括号不是必需的。来自[Python 库参考](https://docs.python.org/3/library/stdtypes.html?highlight=type%20seq#tuple)的引用：

> 元组可以通过多种方式构建：
> 
> *   使用一对括号来表示空元组：()
> *   对单例元组使用尾随逗号：a 或 (a,)
> *   用逗号分隔项目：a, b, c 或 (a, b, c)
> *   使用 tuple() 内置： tuple() 或 tuple(iterable)

### 功能应该服务于单一目的

因此他们应该返回一个对象。在您的情况下，此对象是一个元组。将元组视为一种特殊的复合数据结构。有些语言几乎每个函数都返回多个值（Lisp 中的列表）。

有时 return`(x, y)`而不是`Point(x, y)`.

### 命名元组

随着 Python 2.6 中命名元组的引入，在许多情况下，最好返回命名元组而不是普通元组。

```
>>> import collections
>>> Point = collections.namedtuple('Point', 'x y')
>>> x, y = Point(0, 1)
>>> p = Point(x, y)
>>> x, y, p
(0, 1, Point(x=0, y=1))
>>> p.x, p.y, p[0], p[1]
(0, 1, 0, 1)
>>> for i in p:
...   print(i)
...
0
1 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-14T20:42:01.270

首先，请注意 Python 允许以下内容（不需要括号）：

```
q, r = divide(22, 7) 
```

关于您的问题，无论哪种方式都没有硬性规定。对于简单（通常是人为的）示例，给定函数似乎总是有可能具有单一目的，从而产生单一值。但是，在将 Python 用于实际应用程序时，您很快就会遇到许多需要返回多个值的情况，这会导致代码更简洁。

所以，我想说做任何有意义的事，不要试图遵守人为的约定。Python 支持多个返回值，因此请在适当的时候使用它。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-14T20:55:28.647

您给出的示例实际上是一个 python 内置函数，称为`divmod`. 因此，在某个时间点，有人认为它足以包含在核心功能中。

对我来说，如果它使代码更干净，那就是 Pythonic。比较这两个代码块：

```
seconds = 1234
minutes, seconds = divmod(seconds, 60)
hours, minutes = divmod(minutes, 60)

seconds = 1234
minutes = seconds / 60
seconds = seconds % 60
hours = minutes / 60
minutes = minutes % 60 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T15:47:23.777

是的，返回多个值（即一个元组）绝对是 Pythonic。正如其他人所指出的，Python 标准库以及备受推崇的 Python 项目中有很多示例。两个额外的评论：

1.  返回多个值有时非常非常有用。举个例子，一个方法可以选择性地处理一个事件（在这样做时返回一些值）并且还返回成功或失败。这可能出现在责任链模式中。在其他情况下，您希望返回多个紧密链接的数据——如给出的示例所示。在此设置中，返回多个值类似于返回具有多个成员变量的匿名类的单个实例。
2.  Python 对方法参数的处理需要能够直接返回多个值。例如，在 C++ 中，方法参数可以通过引用传递，因此除了正式的返回值之外，您还可以为它们分配输出值。在 Python 中，参数是“通过引用”传递的（但在 Java 的意义上，不是 C++）。您不能为方法参数分配新值并将其反映在方法范围之外。例如：

    ```
    // C++
    void test(int& arg)
    {
        arg = 1;
    }

    int foo = 0;
    test(foo); // foo is now 1! 
    ```

    与之比较：

    ```
    # Python
    def test(arg):
        arg = 1

    foo = 0
    test(foo) # foo is still 0 
    ```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-15T14:46:06.810

这绝对是pythonic。事实上，您可以从一个函数返回多个值，就像 C 语言中的样板文件一样，您需要为在某处返回的每种类型组合定义一个结构。

然而，如果你从一个函数返回一些疯狂的值，比如 10 个值，你应该认真考虑将它们捆绑在一个类中，因为那时它会变得笨拙。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T15:14:04.357

返回一个元组很酷。另请注意在 python 2.6 中添加的新命名元组，这可能会让您更喜欢：http: [//docs.python.org/dev/library/collections.html#collections.namedtuple](http://docs.python.org/dev/library/collections.html#collections.namedtuple)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-12T21:48:42.540

OT：RSRE 的 Algol68 有一个奇怪的“/:=”运算符。例如。

```
INT quotient:=355, remainder;
remainder := (quotient /:= 113); 
```

商为 3，余数为 16。

注意：通常“(x/:=y)”的值被丢弃，因为商“x”是通过引用分配的，但在 RSRE 的情况下，返回的值是余数。

cf[整数算术 - Algol68](http://rosettacode.org/wiki/Basic_integer_arithmetic#ALGOL_68)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T14:43:01.343

对于简单的函数（例如`divmod`. 如果它使代码可读，那就是 Pythonic。

如果返回值开始变得混乱，请检查函数是否做的太多，如果是则拆分它。如果像对象一样使用大元组，则将其设为对象。另外，考虑使用[命名元组](http://code.activestate.com/recipes/500261/)，它将成为 Python 2.6 中标准库的一部分。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T21:05:57.757

我对 Python 还很陌生，但是元组技术对我来说似乎很 Python。但是，我有另一个可以提高可读性的想法。使用字典允许通过名称而不是位置访问不同的值。例如：

```
def divide(x, y):
    return {'quotient': x/y, 'remainder':x%y }

answer = divide(22, 7)
print answer['quotient']
print answer['remainder'] 
```

# c# - 您应该在 Java/C# 中使用国际标识符吗？

> ID：61615
> 
> 赞同：26
> 
> 时间：2008-09-14T20:28:43.050
> 
> 标签：c#, java, coding-style

C# 和 Java 几乎允许在类名、方法名、局部变量等中使用任何字符。使用非 ASCII 字符是不是不好的做法，测试糟糕的编辑器和分析工具的边界，让某些人难以阅读，还是美国的傲慢是唯一反对的论据？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-14T20:38:19.530

我会坚持使用英语，只是因为您通常不知道谁在处理该代码，并且因为构建/测试/错误跟踪过程中使用的一些第三方工具可能存在问题。在非德语键盘上键入 äöüß 简直就是 PITA，我只是相信任何参与软件开发的人都应该说英语，但这也许只是我作为非英语母语者的傲慢。

你所说的“美国傲慢”不是你的程序是否使用国际变量名，而是你的程序认为“Währung”和“Wahrung”是同一个词。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-14T20:31:55.850

我想说这完全取决于谁在编写代码库。

如果您有一小群共享共同语言的开发人员，并且您不打算需要任何不会说该语言的人来处理代码，那么请继续使用您想要的任何字符。

如果您需要让不同文化和语言的人来编写代码，那么最好坚持使用英语，因为它是世界上几乎每个人的共同点。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-16T06:25:21.250

如果您的企业不会说英语，并且您认为领域驱动设计与它有关，那么还有另一个方面：作为开发人员，我们如何在没有任何翻译开销的情况下使用与我们的企业相同的领域语言？

这不仅意味着语言之间的翻译，比如英语和挪威语，还意味着不同单词之间的翻译。对于实体类和服务，我们应该使用与业务完全相同的词。

我发现放弃并使用我的母语更容易。现在我的代码使用了相同的词，与我的领域专家进行对话变得更加容易。一段时间后你就会习惯它，就像你习惯于没有匈牙利符号的编码一样。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-14T20:55:59.380

我曾经在一个开发团队工作，他们很乐意用任何命名（以及任何其他编码）约定来擦屁股。信不信由你，不得不处理代码中的 ä 和 ö 是我辞职的一个促成因素。虽然我是芬兰人，但我更喜欢使用美式键盘设置编写代码，因为花括号和方括号在芬兰键盘上写起来很痛苦（尝试使用右 alt 和 7 和 0 来表示大括号）。

所以我说坚持使用ASCII字符。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-09-11T23:54:49.553

这是我使用非 ASCII 标识符[的示例，因为我发现它比用英文名称替换希腊字母更具可读性。](https://stackoverflow.com/questions/523531/fast-transcendent-trigonometric-functions-for-java/523601#523601)即使我的键盘上没有 θ 或 φ（我依赖于复制和粘贴。）

然而，这些都是局部变量。我会将非 ASCII 标识符保留在公共接口之外。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-14T20:34:56.183

这取决于：

*   您的团队是否符合要求您使用 ASCII 的任何现有标准？
*   你的代码是否会被不会说你母语的人重用或阅读？
*   您是否设想过需要在线寻求帮助并因此无法按原样复制粘贴代码示例的场景？
*   您确定您的整套工具都支持代码编码吗？

如果您对以上任何一项回答“是”，请仅保留 ASCII。如果没有，请自行承担风险。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-14T20:34:48.620

部分问题在于 Java/C# 语言及其库基于英语单词，如`if`和`toString()`. 我个人不想在阅读代码时在非英语和英语之间切换。

但是，如果您的数据库、UI、业务逻辑（包括隐喻）已经使用某种非英语语言，则无需将每个方法名称和变量都翻译成英语。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-14T20:42:34.530

如果您通过[了其他先决条件](https://stackoverflow.com/questions/61615/should-you-use-international-identifiers-in-javac#61620)，那么您还有一个额外的（恕我直言，更重要的是）一个 - 输入符号有多难。

在我的常规 en-us 键盘上，我知道输入字母 ç 的唯一方法是按住 alt，然后在数字小键盘上按 0227，或者复制和粘贴。

这将是快速打字的巨大障碍。如果你不是被迫的话，你不想用这样的琐碎事情来减慢你的编码速度。国际键盘可能会缓解这种情况，但是如果您必须在没有国际键盘等的笔记本电脑上编码会发生什么？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-07-06T10:10:53.463

我会坚持使用 ASCII 字符，因为如果您的开发团队中的任何人使用仅支持 ASCII 的 SDK，或者您想让您的代码开源，那么可能会出现很多问题。就个人而言，即使您不打算让不会说该语言的任何人参与该项目，我也不会这样做，因为您正在经营一家企业，而在我看来，经营一家企业的人希望他的业务扩大，这在当今时代意味着超越国界。我的观点是英语是该领域的语言，即使您用不同的语言命名变量，在您的编程中使用任何非 ASCII 字符也几乎没有意义。如果您处理的是 UTF8 数据，则由语言来处理它：我的 iPhone 程序（涉及到手机和服务器之间的大量用户数据）完全支持 UTF8，但源代码中没有 UTF8。它似乎只是打开这么大的蠕虫罐几乎没有任何好处。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-08-28T22:49:19.333

使用非 ASCII 字符还有另一个危险，尽管它可能只会在晦涩难懂的情况下咬人。允许的字符是根据[Character.isJavaIdentifierStart(int)](http://docs.oracle.com/javase/7/docs/api/java/lang/Character.html#isJavaIdentifierStart%28int%29)和[Character.isJavaIdentifierPart(int)方法](http://docs.oracle.com/javase/7/docs/api/java/lang/Character.html#isJavaIdentifierPart%28int%29)[定义](http://docs.oracle.com/javase/specs/jls/se7/html/jls-3.html#jls-3.8)的，它们是根据 Unicode 定义的。但是，使用的 Unicode 的确切版本取决于 Java 平台的版本，如[java.lang.Character](http://docs.oracle.com/javase/7/docs/api/java/lang/Character.html)的文档中所指定。

由于字符属性从一个 Unicode 版本到下一个版本略有变化，因此您有可能（但可能非常不可能）拥有在一个 Java 版本中有效但在下一个版本中无效的标识符。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-01-29T16:55:25.333

正如已经指出的，除非方法名称大部分与语言匹配，否则在阅读时不断切换语言有点奇怪。

对于我可以说的斯堪的纳维亚语言和德语，我至少会建议使用标准替换，即。

ä/æ -> ae, ö/ø -> oe, å -> aa, ü -> ue

等等，以防其他人可能会发现在不更改键盘/键盘映射的情况下很难键入原始字母。想想如果你突然不得不使用开发人员使用第三种语言（例如包括法语ç）并且没有这样做的代码库。根据我的经验，在两个以上的键盘映射之间切换以有效地打字会很痛苦。

# security - NHibernate 和共享网络托管

> ID：61622
> 
> 赞同：4
> 
> 时间：2008-09-14T20:37:13.217
> 
> 标签：security, nhibernate, web-hosting

有没有人能够在共享网络主机上启动并运行基于 NHibernate 的项目？

NHibernate 在幕后用反射做了很多花哨的东西，但我目前使用的主机只允许应用程序以中等信任度运行，这限制了你可以用反射做的事情，而且它抛出了各种安全性权限错误。即使我只在映射文件中使用公共属性，情况也是如此，尽管我确实将一些类定义为代理。

哪些公司提供体面（且价格合理）的网络托管服务，让 NHibernate 可以毫无怨言地运行？

**更新：**从这些答案看来（以及我的实验——对不起 Ayende，但即使在阅读了您链接到的文章之后，我仍然无法让它在我的网络主机上运行）是明智地选择您的托管服务提供商并货比三家. 看来 WebHost4Life 在这方面做得还不错。但是，有没有人尝试过 NHibernate 与 1and1 的 Windows 共享主机？我已经拥有他们的 Linux 帐户，并且在这方面我相当满意，如果我能让 NHibernate 与 Windows 无缝协作，我可能会坚持使用它们。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-14T21:18:57.263

我在 WebHost4Life 上运行基于 NHibernate 的应用程序没有任何问题，尽管我不喜欢它们。

让 NHibernate 在中等信任下运行是可能的。有关如何完成此操作的完整说明，请参见此处：

[http://blechie.com/WPierce/archive/2008/02/17/Lazy-Loading-with-nHibernate-Under-Medium-Trust.aspx](http://blechie.com/WPierce/archive/2008/02/17/Lazy-Loading-with-nHibernate-Under-Medium-Trust.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-11T22:23:18.510

我在dailyrazor.com 上运行了我自己的极客站点N2（使用NHibernate 和Windsor Castle）和4 个宠物NHibernate/Fluent 项目[一段](http://www.dailyrazor.com)时间。

You get a good deal for $5 a month, including unlimited SQL Server databases and subdomains and it runs off Plesk with FTP and remote SQL Server Management Studio access.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T21:04:28.297

我正在使用一个名为[Nebula](http://www.nebula.fi)的芬兰主机，它可以愉快地运行我的 NHibernate 利用应用程序。我曾经遇到过信任级别的问题；主机上的 machine.config 配置为拒绝反射，但我在 web.config 中成功覆盖了它。

# c++ - 不使用资源文件的 Windows API 对话框

> ID：61634
> 
> 赞同：24
> 
> 时间：2008-09-14T20:46:20.400
> 
> 标签：c++, winapi, dialog

我正在尝试使用 C++ 和 windows API 创建一个对话框，但我不希望在资源文件中定义该对话框。我在网上找不到任何好的东西，而且我读过的例子似乎都没有以编程方式定义对话框。

我怎样才能做到这一点？

一个简单的例子就可以了。我还没有做任何复杂的事情。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-14T21:44:46.453

Raymond Chen 写了几篇关于对话管理器的帖子：

*   [对话管理器，第 1 部分：热身](https://devblogs.microsoft.com/oldnewthing/20050329-00/?p=36043)
*   [对话框管理器，第 2 部分：创建框架窗口](https://devblogs.microsoft.com/oldnewthing/20050330-00/?p=36023)
*   [对话框管理器，第 3 部分：创建控件](https://devblogs.microsoft.com/oldnewthing/20050331-00/?p=36003)
*   [对话管理器，第 4 部分：对话循环](https://devblogs.microsoft.com/oldnewthing/20050401-00/?p=35993)
*   [对话框管理器，第 5 部分：将非模态对话框转换为模态对话框](https://devblogs.microsoft.com/oldnewthing/20050404-48/?p=35983)
*   [对话管理器，第 6 部分：消息循环中的微妙之处](https://devblogs.microsoft.com/oldnewthing/20050405-46/?p=35973)
*   [对话管理器，第 7 部分：消息循环中的更多细节](https://devblogs.microsoft.com/oldnewthing/20050406-57/?p=35963)
*   [对话框管理器，第 8 部分：对话框中的自定义导航](https://devblogs.microsoft.com/oldnewthing/20050407-00/?p=35953)
*   [对话框管理器，第 9 部分：对话框中的自定义加速器](https://devblogs.microsoft.com/oldnewthing/20050408-41/?p=35943)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2017-12-28T15:11:36.683

如果您只想显示一个带有控件的窗口，则可以在不使用资源 (.rc) 文件/脚本的情况下创建一个窗口。

这与对话框不同，但它可能比以编程方式创建对话框更容易。

## 首先，关于如何完成的一些注意事项：

*   `CreateWindow`您可以手动使用(或`CreateWindowEx`) 创建主窗口的子窗口，而不是在 rc 文件中设计对话框。（对于 .NET [Windows Forms](http://en.wikipedia.org/wiki/Windows_Forms)程序员来说，这些窗口就像`Control`s）。

*   这个过程根本不是图形化的（您需要手动输入每个窗口的位置和大小），但我认为这是了解如何在后台创建对话框的好方法。

*   不使用真正的对话框有一些缺点，即在控件之间切换时该选项卡将不起作用。

* * *

## 关于示例：

*   此示例具有一个带有两个按钮的对话框、一个编辑框（.NET Windows 窗体程序员将其视为`TextBox`）和一个复选框。

[![窗口截图](https://i.stack.imgur.com/lb3fh.png)](https://i.stack.imgur.com/lb3fh.png)

它已经在以下条件下进行了测试：

*   x86 构建
*   x64 构建
*   Unicode 构建（`UNICODE`和`_UNICODE`定义）
*   非 Unicode 构建（`UNICODE`且未`_UNICODE`定义）
*   使用 Visual Studio 的 C 编译器构建
*   使用 Visual Studio 的 C++ 编译器构建
*   操作系统：Windows 10 64 位

### 注：UNICODE

*   截至撰写本文时，UTF-8 仍处于 Windows 10 测试版中
    *   如果您没有启用此设置，您应该假设 any`char*`是 ACP，而不是 UTF-8，这也适用于标准库函数
    *   即使在 Linux 中，相同的标准库函数也是 UTF-8。
    *   遗憾的是，某些 C++ 标准库功能仅适用于`char*`（例如，异常消息）。
    *   您仍然可以在没有设置选项的情况下在 Windows 中使用 UTF-8，您只需在调用 winapi 函数之前将其编码回 UTF-16。
    *   这是一个[reddit 线程](https://www.reddit.com/r/cpp/comments/g7tkd7/state_of_utf8_support_on_windows/)，上面有一个声称在 Windows 上使用 UTF-8 工作的人的回复，它有一些很好的信息。
*   Windows 中的 UNICODE 表示“UTF-16”，而不是“UTF-8”。
*   **强烈建议**对任何不是[很旧](https://en.wikipedia.org/wiki/Unicode_in_Microsoft_Windows)的 Windows 版本使用某种 Unicode 。
    *   请注意，如果您不使用 Unicode，您的程序可能完全无法打开包含 Unicode 字符的文件名、处理具有非 ACP 字符的目录（例如，用户名）等。
    *   使用 ACP 函数（`SendMessageA`等）而不以某种方式验证 UTF-8 已启用（默认情况下禁用）可能是一个错误。
    *   为了最大的可移植性/灵活性，我建议使用 UTF-16 和所有 API 函数的 W 版本，[在最后一分钟从 UTF-8 转换为 UTF-16](https://docs.microsoft.com/en-us/windows/win32/api/stringapiset/nf-stringapiset-multibytetowidechar)。非常仔细地阅读此页面。

* * *

## 现在看代码：

请注意，已添加大量注释以尝试记录 windows 功能，我建议将其复制/粘贴到文本编辑器中，以获得最佳效果。

```
// This sample will work either with or without UNICODE, it looks like
// it's recommended now to use UNICODE for all new code, but I left
// the ANSI option in there just to get the absolute maximum amount
// of compatibility.
//
// Note that UNICODE and _UNICODE go together, unfortunately part
// of the Windows API uses _UNICODE, and part of it uses UNICODE.
//
// tchar.h, for example, makes heavy use of _UNICODE, and windows.h
// makes heavy use of UNICODE.
#define UNICODE
#define _UNICODE
//#undef UNICODE
//#undef _UNICODE

#include <windows.h>
#include <tchar.h>

// I made this struct to more conveniently store the
// positions / size of each window in the dialog
typedef struct SizeAndPos_s
{
    int x, y, width, height;
} SizeAndPos_t;

// Typically these would be #defines, but there
// is no reason to not make them constants
const WORD ID_btnHELLO = 1;
const WORD ID_btnQUIT = 2;
const WORD ID_CheckBox = 3;
const WORD ID_txtEdit = 4;
const WORD ID_btnShow = 5;

//                                    x,      y,      width,  height
const SizeAndPos_t mainWindow   =   { 150,    150,    300,    300 };

const SizeAndPos_t btnHello     =   { 20,     50,     80,     25 };
const SizeAndPos_t btnQuit      =   { 120,    50,     80,     25 };
const SizeAndPos_t chkCheck     =   { 20,     90,     185,    35 };

const SizeAndPos_t txtEdit      =   { 20,     150,    150,    20 };
const SizeAndPos_t btnShow      =   { 180,    150,    80,     25 };

HWND txtEditHandle = NULL;

// hwnd:    All window processes are passed the handle of the window
//         that they belong to in hwnd.
// msg:     Current message (e.g., WM_*) from the OS.
// wParam:  First message parameter, note that these are more or less
//          integers, but they are really just "data chunks" that
//          you are expected to memcpy as raw data to float, etc.
// lParam:  Second message parameter, same deal as above.
LRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
{

    switch (msg)
    {

    case WM_CREATE:
        // Create the buttons
        //------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        // Note that the "parent window" is the dialog itself. Since we are
        // in the dialog's WndProc, the dialog's handle is passed into hwnd.
        //
        //CreateWindow( lpClassName,        lpWindowName,       dwStyle,                                x,          y,          nWidth,         nHeight,            hWndParent,     hMenu,              hInstance,      lpParam
        //CreateWindow( windowClassName,    initial text,       style (flags),                          xPos,       yPos,       width,          height,             parentHandle,   menuHandle,         instanceHandle, param);
        CreateWindow(   TEXT("Button"),     TEXT("Hello"),      WS_VISIBLE | WS_CHILD,                  btnHello.x, btnHello.y, btnHello.width, btnHello.height,    hwnd,           (HMENU)ID_btnHELLO, NULL,           NULL);

        CreateWindow(   TEXT("Button"),     TEXT("Quit"),       WS_VISIBLE | WS_CHILD,                  btnQuit.x,  btnQuit.y,  btnQuit.width,  btnQuit.height,     hwnd,           (HMENU)ID_btnQUIT,  NULL,           NULL);

        // Create a checkbox
        //------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        CreateWindow(  TEXT("button"),      TEXT("CheckBox"),   WS_VISIBLE | WS_CHILD | BS_CHECKBOX,    chkCheck.x, chkCheck.y, chkCheck.width, chkCheck.height,    hwnd,           (HMENU)ID_CheckBox, NULL,           NULL);

        // Create an edit box (single line text editing), and a button to show the text
        //------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //Handle        = CreateWindow(windowClassName,    windowName,           style,                              xPos,       yPos,       width,          height,             parentHandle,   menuHandle,         instanceHandle, param);
        txtEditHandle   = CreateWindow(TEXT("Edit"),       TEXT("Initial Text"), WS_CHILD | WS_VISIBLE | WS_BORDER,  txtEdit.x,  txtEdit.y,  txtEdit.width,  txtEdit.height,     hwnd,           (HMENU)ID_txtEdit,  NULL,           NULL);

        //CreateWindow( windowClassName,    windowName,         style,                                  xPos,      yPos,      width,          height,           parentHandle,   menuHandle,         instanceHandle, param);
        CreateWindow(   TEXT("Button"),     TEXT("Show"),       WS_VISIBLE | WS_CHILD,                  btnShow.x, btnShow.y, btnShow.width, btnShow.height,    hwnd,           (HMENU)ID_btnShow,  NULL,           NULL);

        // Create an Updown control. Note that this control will allow you to type in non-number characters, but it will not affect the state of the control

        break;

    // For more information about WM_COMMAND, see
    // https://msdn.microsoft.com/en-us/library/windows/desktop/ms647591(v=vs.85).aspx
    case WM_COMMAND:

        // The LOWORD of wParam identifies which control sent
        // the WM_COMMAND message. The WM_COMMAND message is
        // sent when the button has been clicked.
        if (LOWORD(wParam) == ID_btnHELLO)
        {
            MessageBox(hwnd, TEXT("Hello!"), TEXT("Hello"), MB_OK);
        }
        else if (LOWORD(wParam) == ID_btnQUIT)
        {
            PostQuitMessage(0);
        }
        else if (LOWORD(wParam) == ID_CheckBox)
        {
            UINT checked = IsDlgButtonChecked(hwnd, ID_CheckBox);

            if (checked)
            {
                CheckDlgButton(hwnd, ID_CheckBox, BST_UNCHECKED);
                MessageBox(hwnd, TEXT("The checkbox has been unchecked."), TEXT("CheckBox Event"), MB_OK);
            }
            else
            {
                CheckDlgButton(hwnd, ID_CheckBox, BST_CHECKED);
                MessageBox(hwnd, TEXT("The checkbox has been checked."), TEXT("CheckBox Event"), MB_OK);
            }
        }
        else if (LOWORD(wParam) == ID_btnShow)
        {
               int textLength_WithNUL = GetWindowTextLength(txtEditHandle) + 1;
               // WARNING: If you are compiling this for C, please remember to remove the (TCHAR*) cast.
               TCHAR* textBoxText = (TCHAR*) malloc(sizeof(TCHAR) * textLength_WithNUL);

               GetWindowText(txtEditHandle, textBoxText, textLength_WithNUL);

               MessageBox(hwnd, textBoxText, TEXT("Here's what you typed"), MB_OK);

               free(textBoxText);
        }
        break;

    case WM_DESTROY:

        PostQuitMessage(0);
        break;
    }

    return DefWindowProc(hwnd, msg, wParam, lParam);
}

// hInstance: This handle refers to the running executable
// hPrevInstance: Not used. See https://blogs.msdn.microsoft.com/oldnewthing/20040615-00/?p=38873
// lpCmdLine: Command line arguments.
// nCmdShow: a flag that says whether the main application window
//           will be minimized, maximized, or shown normally.
//
// Note that it's necessary to use _tWinMain to make it
// so that command line arguments will work, both
// with and without UNICODE / _UNICODE defined.
int APIENTRY _tWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPTSTR lpCmdLine, int nCmdShow)
{
    MSG  msg;
    WNDCLASS mainWindowClass = { 0 };

    // You can set the main window name to anything, but
    // typically you should prefix custom window classes
    // with something that makes it unique.
    mainWindowClass.lpszClassName = TEXT("JRH.MainWindow");

    mainWindowClass.hInstance = hInstance;
    mainWindowClass.hbrBackground = GetSysColorBrush(COLOR_3DFACE);
    mainWindowClass.lpfnWndProc = WndProc;
    mainWindowClass.hCursor = LoadCursor(0, IDC_ARROW);

    RegisterClass(&mainWindowClass);

    // Notes:
    // - The classname identifies the TYPE of the window. Not a C type.
    //   This is a (TCHAR*) ID that Windows uses internally.
    // - The window name is really just the window text, this is
    //   commonly used for captions, including the title
    //   bar of the window itself.
    // - parentHandle is considered the "owner" of this
    //   window. MessageBoxes can use HWND_MESSAGE to
    //   free them of any window.
    // - menuHandle: hMenu specifies the child-window identifier,
    //               an integer value used by a dialog box
    //               control to notify its parent about events.
    //               The application determines the child-window
    //               identifier; it must be unique for all
    //               child windows with the same parent window.

    //CreateWindow( windowClassName,                windowName,             style,                            xPos,         yPos,       width,              height,            parentHandle,   menuHandle,  instanceHandle, param);
    CreateWindow(   mainWindowClass.lpszClassName,  TEXT("Main Window"),    WS_OVERLAPPEDWINDOW | WS_VISIBLE, mainWindow.x, mainWindow.y, mainWindow.width, mainWindow.height, NULL,           0,           hInstance,      NULL);

    while (GetMessage(&msg, NULL, 0, 0))
    {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }

    return (int)msg.wParam;
}

// This code is based roughly on tutorial code present at  http://zetcode.com/gui/winapi/ 
```

* * *

## 进一步阅读

内置的窗口类集相当有限，因此您可能对如何`Control`使用 Windows API 定义自己的窗口类（“s”）感到好奇，请参阅以下文章：

*   [Win32 API 中的自定义控件：基础知识（代码项目）](https://www.codeproject.com/Articles/559385/Custom-Controls-in-Win-API-The-Basics)
*   [WINE 模拟器源代码](https://www.winehq.org/)是如何实现 Windows API 以及如何创建自己的窗口类来模仿内置类行为的一个很好的例子。
*   [Zetcode.com 的教程](http://zetcode.com/gui/winapi/)

> 注意：我最初打算在这篇文章中介绍以编程方式创建对话框。由于我的错误，我没有意识到您不能只是将窗口“显示”为对话框。不幸的是，我无法让 Raymond Chen 提到的设置正常工作。即使查看 WINE 的来源，也不是很清楚。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-14T21:08:54.077

看看[这个工具包](http://www.codeproject.com/KB/wtl/resourcelessdialogtoolkit.aspx)，它描述了如何在没有资源文件的情况下创建对话框。

它在 WTL 中。但是，我相信您可以直接使用 Win32 API 来分离内部结构以实现相同的目标。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-08-09T16:25:17.117

在这里，您可以找到如何在不使用资源文件的情况下使用 Windows API 对话框。

Windows API（只有 C Win32 API，没有[MFC](http://en.wikipedia.org/wiki/Microsoft_Foundation_Class_Library)）教程：

*[Windows API 教程](http://zetcode.com/gui/winapi/)*

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T13:26:23.117

尝试在[MSDN](http://msdn.microsoft.com)中搜索“内存中的对话框模板”。

例如，请参见：*[对话框](https://docs.microsoft.com/en-us/windows/win32/dlgbox/dialog-boxes)*

# macos - “美化” OS X 磁盘映像

> ID：61635
> 
> 赞同：17
> 
> 时间：2008-09-14T20:52:39.683
> 
> 标签：macos, icons, skype, diskimage

当我下载 Skype 时，我注意到，在正常的“磁盘图像”图标的位置，有一个自定义图标，当我双击该图标时，窗口使用彩色图像作为背景，提示我拖动Skype 图标到应用程序文件夹中。

如何使用我的应用程序做到这一点？

谢谢，杰森

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-14T21:18:30.293

让我添加到其他答案[jwz](http://www.jwz.org/blog/2006/03/setting-view-options-on-dmg-files/)关于在 .dmg 文件上设置视图选项的方法。这是我可以毫无问题地工作的最简单的一个。

此外，要更改默认 .dmg 图标的图标：

*   在 Finder 中，为要使用其图标的文件打开一个检查器窗口 (^I)，单击顶部的图标（它将获得蓝色边框）并将其复制到剪贴板 (^C)。

*   然后为您的 .dmg 打开另一个检查器，单击图标并按 ^V 粘贴

（您可以像这样更改任何文件的图标）。

对于这种事情，你总是可以查看开源程序，看看他们做了什么来获得类似的结果。例如，这里是用于构建漂亮 dmg 文件的相关源文件：

*   [亚丁](http://trac.adiumx.com/browser/trunk/Release)
*   [米罗](https://develop.participatoryculture.org/trac/democracy/browser/trunk/tv/platform/osx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T17:44:54.657

如果您对商业解决方案感兴趣，可以使用许多 DMG 设计器应用程序，包括我从[MacUpdate 搜索](http://www.macupdate.com/search.php?starget=google&keywords=dmg)中收集到的以下应用程序：

*   [DMG 包装器](http://freespace.virgin.net/jeremy.dronfield/skoobysoft/utilities/dmgp.html)
*   [DMG 建筑师](http://sourcebits.com/dmg/)
*   [DMG 帆布](http://www.araelium.com/dmgcanvas/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-25T15:53:21.560

对于零麻烦的自定义背景，这是一个很棒的免费软件解决方案：

[http://sourceforge.net/projects/dmgcreator/](http://sourceforge.net/projects/dmgcreator/)

# asp.net - ASP.net 的日期时间实用程序

> ID：61638
> 
> 赞同：1
> 
> 时间：2008-09-14T20:55:37.943
> 
> 标签：asp.net, date

我想知道是否有人可以建议一个实用程序库，它具有在 ASP.NET 中处理日期的有用功能，可以轻松地消除您在处理日期时通常必须做的一些腿部工作？

亚音速糖有一些非常好的功能：

[http://subsonichelp.com/html/1413bafa-b5aa-99aa-0478-10875abe82ec.htm](http://subsonichelp.com/html/1413bafa-b5aa-99aa-0478-10875abe82ec.htm) [http://subsonicproject.googlecode.com/svn/trunk/SubSonic/Sugar/](http://subsonicproject.googlecode.com/svn/trunk/SubSonic/Sugar/)

那里有更好的吗？

我想算出过去 5 周的开始（星期一）和结束（星期日）日期。

我在想这样的事情：

```
 DateTime Now = DateTime.Now;

    while(Now.DayOfWeek != DayOfWeek.Monday)
    {
        Now.AddDays(-1);
    }

    for(int i=0; i<5;i++)
    {
        AddToDatesList(Now, Now.AddDays(7));
        Now.AddDays(-7);
    } 
```

但这似乎很糟糕？另外，这不是我想要的，因为我需要该开始日期`00:00:00`的时间和结束日期的时间`23:59:59`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-14T21:02:18.960

您是否正在尝试处理日期的特定问题？如果 .NET 中现有的日期 API 可以干净地处理您的问题，我认为没有理由考虑使用 3rd 方库来做这件事。当我在 .NET 中时，我们不得不处理相当多的日期，而标准库为我们提供了相当多的功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T10:12:27.653

CSLA 有一个有用的帮助类，称为 SmartDate，它解决了在实际应用程序中使用日期时的很多问题。据我所知，它与框架的其余部分耦合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T22:38:50.147

您到底想做什么 System.DateTime 和 System.Timespan 无法处理？

# javascript - 是否有任何 JavaScript 实时语法荧光笔？

> ID：61655
> 
> 赞同：12
> 
> 时间：2008-09-14T21:11:34.507
> 
> 标签：javascript, syntax-highlighting, wysiwyg

我找到了突出显示预先存在的代码的语法荧光笔，但我想在您使用 WYSIWYG 风格的编辑器键入时这样做。我不需要自动完成的功能，只需要突出显示。

作为一个后续问题，stackoverflow 使用的 WYSIWYG 编辑器是什么？

编辑：感谢下面的答案，我发现两个看起来可能适合我的需要： [EditArea](http://www.cdolivet.net/editarea/)和[CodePress](http://codepress.sourceforge.net/)

编辑：另见这个问题：
[https ://stackoverflow.com/questions/379185/free-syntax-highlighting-editor-control-in-javascript](https://stackoverflow.com/questions/379185/free-syntax-highlighting-editor-control-in-javascript)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-15T13:36:43.967

问题可能更好地表述为“您建议使用哪种语法高亮编辑器来替换我的 Web 应用程序中的 html 文本区域？” （这里的其他一些答案涉及桌面应用程序或纯语法荧光笔，而不是客户端编辑器）

我还推荐[CodeMirror](http://marijn.haverbeke.nl/codemirror/)，它是用 Javascript 编写的，支持很多浏览器。它使用真正的解析器（而不是正则表达式），因此它可以处理复杂的问题，例如正确突出显示转义的字符串。开发人员对[讨论组](http://groups.google.com/group/codemirror)的反应也非常积极。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-14T21:29:48.767

这是一篇关于如何编写的非常有趣的文章：（更好的是，他提供了 JavaScript 格式化程序和着色器的完整源代码。）

[在 JavaScript 中实现语法高亮的 JavaScript 编辑器](http://marijn.haverbeke.nl/codemirror/story.html) 或 DOM 树黑暗面的残酷冒险

> 如何进行体面的语法突出显示？一个非常简单的扫描就可以分辨出字符串、注释、关键字和其他代码之间的区别。但这一次我想真正能够识别正则表达式，这样我就不再有任何明显的错误行为了。

重要的是，它正确处理正则表达式。同样令人感兴趣的是，他使用了延续传递风格的词法分析器/解析器，而不是您将在野外看到的更典型的基于 lex（或正则表达式）的词法分析器。

作为奖励，他讨论了您在浏览器中使用 JavaScript 时会遇到的许多现实问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-14T21:13:28.573

请参阅[Google 代码美化](http://code.google.com/p/google-code-prettify/)。

[有关stackoverflow](https://stackoverflow.com/questions/51808/edit-control-on-stack-overflow)使用的编辑控件，请参阅此问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-17T12:58:59.040

很抱歉把它拖回来，但我在 CodeMirror [http://codemirror.net/中找到了最好的](http://codemirror.net/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-14T21:53:42.983

我没有编写很多 javascript，但 JSEclipse 过去对我很有帮助。它以 Eclipse 插件的形式提供。

我多年来一直免费使用它

[http://www.interaktonline.com/products/eclipse/jseclipse/overview/](http://www.interaktonline.com/products/eclipse/jseclipse/overview/)

每当我处理 Javascript 时，我也非常依赖 FireBug for Firefox

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T12:40:22.120

您也可以尝试[http://softwaremaniacs.org/soft/highlight/en/](http://softwaremaniacs.org/soft/highlight/en/) - 它速度很快，它不仅支持 javascript，还支持许多其他语言。如果您需要实时预览突出显示的工作方式，您可以使用 setInterval 运行突出显示并将其显示在单独的框中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T12:46:16.193

尽管学习曲线陡峭，但[Vim](http://www.vim.org "维姆")是最好的编辑器，适用于任何语言。它有一个 GUI 版本，但在终端编辑方面确实很出色。任何花在学习如何使用这个编辑器上的时间都不会浪费。它具有您正在寻找的语法突出显示，以及数千个（字面意思）其他功能和插件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-07-29T04:09:26.330

必须选择 Mozilla 的[Bespin](http://mozillalabs.com/bespin/)。它是使用 HTML5 功能构建的（因此它既快速又快速，但不支持旧版浏览器），但使用起来绝对令人惊叹，并且击败了我遇到的所有东西 - 可能是因为 Mozilla 支持它，而且他们开发了 Firefox，是的。 .. 还有一个[jQuery 插件，其中包含一个扩展，使它](http://www.balupton.com/sandbox/jquery-sparkle/demo/#bespin)更容易与 jQuery 一起使用。

# c++ - 在 Visual Studio 2008 PRO 中进行分析

> ID：61669
> 
> 赞同：19
> 
> 时间：2008-09-14T21:41:54.060
> 
> 标签：c++, visual-studio, visual-studio-2008, profiling

如何在 Visual Studio 2008 中使用探查器？

我知道 Config Properties -> Linker -> Advanced -> Profile (/PROFILE) 中有一个构建选项，但是我找不到任何关于实际使用它的信息，只有我能找到的文章似乎只适用于旧版本Visual Studio（例如，大多数人说转到 Build->Profile 以调出配置文件对话框，但在 2008 年没有这样的菜单项）。

这是因为 Visual Studio 2008 不包含探查器，如果它包含探查器，它在哪里以及它的文档在哪里？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2010-02-06T05:21:18.317

[微软在这里](http://www.microsoft.com/downloads/details.aspx?familyid=fd02c7d6-5306-41f2-a1be-b7dcb74c9c0b&displaylang=en)发布了 VS 2008 的独立 Profiler

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-14T22:08:12.293

该分析器仅在 Visual Studio 2008 的 Team System 版本中可用。我使用的最后一个包含分析器的版本是 Visual C++ 6.0。

对于 Visual Studio 2005，您可以尝试[Compuware DevPartner Performance Analysis Community Edition](http://www.compuware.com/media.asp?cid=701000000004ej0)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T03:41:44.787

[在What Are Some Good .NET Profilers](https://stackoverflow.com/questions/3927/what-are-some-good-net-profilers)问题中还有一个 .NET 分析器列表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-26T10:18:26.690

正如我从阅读一些网站中了解到的，当您使用 VS 2008 独立分析器创建`.vsp`文件时，您将需要 VS2008 Premium 或 Ultimate 来查看`.vsp`文件。

顺便说一句，我安装了 VS2012 Release Candidate，它是免费的（试用版？），我可以使用它的分析引擎。

# ruby - 在 get() 中从 Ruby 中损坏的 TCP 套接字中恢复

> ID：61675
> 
> 赞同：7
> 
> 时间：2008-09-14T21:53:57.040
> 
> 标签：ruby, sockets, tcp, gets

我正在读取 TCP 套接字上的输入行，类似于：

```
class Bla  
  def getcmd
    @sock.gets unless @sock.closed?
  end

  def start     
    srv = TCPServer.new(5000)
    @sock = srv.accept
    while ! @sock.closed?
      ans = getcmd
    end
  end
end 
```

如果端点在 getline() 运行时终止连接，则 gets() 挂起。

我该如何解决这个问题？是否有必要进行非阻塞或定时 I/O？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T16:13:31.390

您可以使用 select 查看是否可以安全地从套接字获取，请参阅使用此技术的 TCPServer 的以下实现。

```
require 'socket'

host, port = 'localhost', 7000

TCPServer.open(host, port) do |server|
  while client = server.accept
    readfds = true
    got = nil
    begin
      readfds, writefds, exceptfds = select([client], nil, nil, 0.1)
      p :r => readfds, :w => writefds, :e => exceptfds

      if readfds
        got = client.gets 
        p got
      end
    end while got
  end
end 
```

这里有一个试图破坏服务器的客户端：

```
require 'socket'

host, port = 'localhost', 7000

TCPSocket.open(host, port) do |socket|
  socket.puts "Hey there"
  socket.write 'he'
  socket.flush
  socket.close
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T12:54:45.773

IO#关闭？当读取器和写入器都关闭时返回 true。在您的情况下，@sock.gets 返回 nil，然后您再次调用 getcmd，这将在一个永无止境的循环中运行。您可以使用 select，也可以在 get 返回 nil 时关闭套接字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-15T00:56:04.103

我建议使用 readpartial 从您的套接字中读取数据并捕获对等重置：

```
while true
    sockets_ready = select(@sockets, nil, nil, nil)
    if sockets_ready != nil
      sockets_ready[0].each do |socket|
        begin
          if (socket == @server_socket)
            # puts "Connection accepted!"
            @sockets << @server_socket.accept
          else
            # Received something on a client socket
            if socket.eof?
              # puts "Disconnect!"
              socket.close
              @sockets.delete(socket)
            else
              data = ""
              recv_length = 256
              while (tmp = socket.readpartial(recv_length))
                data += tmp
                break if (!socket.ready?)
              end
              listen socket, data
            end
          end
        rescue Exception => exception
          case exception
            when Errno::ECONNRESET,Errno::ECONNABORTED,Errno::ETIMEDOUT
              # puts "Socket: #{exception.class}"
              @sockets.delete(socket)
            else
              raise exception
          end
        end
      end
    end
  end 
```

这段代码大量借鉴了 M. Tim Jones 的一些[不错的 IBM 代码](https://www6.software.ibm.com/developerworks/education/l-rubysocks/l-rubysocks-a4.pdf)。请注意，@server_socket 由以下方式初始化：

```
@server_socket = TCPServer.open(port) 
```

@sockets 只是一个套接字数组。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-03-18T04:55:03.977

我只是 pgrep "ruby" 来查找 pid，然后杀死 -9 pid 并重新启动。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-14T23:51:04.357

如果您相信 ruby​​ 套接字的[rdoc](http://www.ruby-doc.org/stdlib/libdoc/socket/rdoc/index.html)，它们不会实现`gets`. 这让我相信 get 是由更高级别的抽象（可能是 IO 库？）提供的，并且可能不知道特定于套接字的事情，例如“连接关闭”。

尝试使用[`recvfrom`](http://www.ruby-doc.org/stdlib/libdoc/socket/rdoc/classes/Socket.html#M004238)而不是`gets`

# events - 向我的 COM 对象的 VBScript 用户公开事件处理程序

> ID：61677
> 
> 赞同：9
> 
> 时间：2008-09-14T21:57:32.727
> 
> 标签：events, com, vbscript, c++builder

假设我有一个 COM 对象，用户可以通过如下调用访问它：

```
Set s = CreateObject("Server") 
```

我想做的是允许用户为对象指定一个事件处理程序，如下所示：

```
Function ServerEvent

   MsgBox "Event handled"

End Function

s.OnDoSomething = ServerEvent 
```

这是否可能，如果可以，我如何在 C++（特别是 BCB 2007）的类型库中公开它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T00:40:02.383

这就是我最近的做法。将实现 IDispatch 的接口和该接口的 coclass 添加到 IDL：

```
[
    object,
    uuid(6EDA5438-0915-4183-841D-D3F0AEDFA466),
    nonextensible,
    oleautomation,
    pointer_default(unique)
]
interface IServerEvents : IDispatch
{
    [id(1)]
    HRESULT OnServerEvent();
}

//...

[
    uuid(FA8F24B3-1751-4D44-8258-D649B6529494),
]
coclass ServerEvents
{
    [default] interface IServerEvents;
    [default, source] dispinterface IServerEvents;
}; 
```

这是 CServerEvents 类的声明：

```
class ATL_NO_VTABLE CServerEvents :
    public CComObjectRootEx<CComSingleThreadModel>,
    public CComCoClass<CServerEvents, &CLSID_ServerEvents>,
    public IDispatchImpl<IServerEvents, &IID_IServerEvents , &LIBID_YourLibrary, -1, -1>,
    public IConnectionPointContainerImpl<CServerEvents>,
    public IConnectionPointImpl<CServerEvents,&__uuidof(IServerEvents)>
{
public:
    CServerEvents()
    {
    }

    // ...

BEGIN_COM_MAP(CServerEvents)
    COM_INTERFACE_ENTRY(IServerEvents)
    COM_INTERFACE_ENTRY(IDispatch)
    COM_INTERFACE_ENTRY(IConnectionPointContainer)
END_COM_MAP()

BEGIN_CONNECTION_POINT_MAP(CServerEvents)
    CONNECTION_POINT_ENTRY(__uuidof(IServerEvents))
END_CONNECTION_POINT_MAP()

    // ..

    // IServerEvents
    STDMETHOD(OnServerEvent)();

private:
    CRITICAL_SECTION m_csLock;        
}; 
```

这里的关键是 IConnectionPointImpl 和 IConnectionPointContainerImpl 接口和连接点映射的实现。OnServerEvent 方法的定义如下所示：

```
STDMETHODIMP CServerEvents::OnServerEvent()
{
    ::EnterCriticalSection( &m_csLock );

    IUnknown* pUnknown;

    for ( unsigned i = 0; ( pUnknown = m_vec.GetAt( i ) ) != NULL; ++i )
    {       
        CComPtr<IDispatch> spDisp;
        pUnknown->QueryInterface( &spDisp );

        if ( spDisp )
        {
            spDisp.Invoke0( CComBSTR( L"OnServerEvent" ) );
        }
    }

    ::LeaveCriticalSection( &m_csLock );

    return S_OK;
} 
```

您需要为您的客户提供一种方法来为您的事件指定他们的处理程序。您可以使用“SetHandler”之类的专用方法来执行此操作，但我更喜欢将处理程序作为异步调用方法的参数。这样，用户只需调用一个方法：

```
STDMETHOD(DoSomethingAsynchronous)( IServerEvents *pCallback ); 
```

存储指向 IServerEvents 的指针，然后当您想要触发事件时，只需调用该方法：

```
m_pCallback->OnServerEvent(); 
```

至于 VB 代码，处理事件的语法与您建议的略有不同：

```
Private m_server As Server
Private WithEvents m_serverEvents As ServerEvents

Private Sub MainMethod()
    Set s = CreateObject("Server")
    Set m_serverEvents = New ServerEvents

    Call m_searchService.DoSomethingAsynchronous(m_serverEvents)
End Sub

Private Sub m_serverEvents_OnServerEvent()
    MsgBox "Event handled"
End Sub 
```

我希望这有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-14T23:37:55.950

我对细节有点模糊，但也许下面的链接可能会有所帮助：

[http://msdn.microsoft.com/en-us/library/ms974564.aspx](http://msdn.microsoft.com/en-us/library/ms974564.aspx)

看起来您的服务器对象需要实现`IProvideClassInfo`，然后您调用`ConnectObject`您的 VBScript 代码。也可以看看：

[http://blogs.msdn.com/ericlippert/archive/2005/02/15/373330.aspx](http://blogs.msdn.com/ericlippert/archive/2005/02/15/373330.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T22:07:17.297

我最终遵循了[这里](http://www.mp3car.com/vbulletin/digitalmods-scripts-api/81425-how-create-c-com-object-streetdeck.html)描述的技术。

# c++ - 如何在 C++ 中处理非常大的二维数组

> ID：61680
> 
> 赞同：10
> 
> 时间：2008-09-14T22:08:02.280
> 
> 标签：c++, arrays, graphics, 2d, zbuffer

我需要创建一个大小为 800x800 的 2D int 数组。但是这样做会造成堆栈溢出（哈哈）。

我是 C++ 新手，所以我应该做类似向量向量的事情吗？只是将二维数组封装到一个类中？

具体来说，这个数组是我在图形程序中的 zbuffer。我需要为屏幕上的每个像素存储 az 值（因此是 800x800 的大尺寸）。

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-14T22:13:48.443

你需要大约 2.5 兆，所以只使用堆就可以了。除非您需要调整它的大小，否则您不需要矢量。有关使用“2D”堆数组的示例，请参阅[C++ FAQ Lite 。](https://isocpp.org/wiki/faq/freestore-mgmt#multidim-arrays)

```
int *array = new int[800*800]; 
```

（完成后不要忘记`delete[]`它。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-15T06:32:49.103

到目前为止，每篇文章都将内存管理留给程序员。这可以而且应该避免。ReaperUnreal 与我所做的非常接近，除了我会使用向量而不是数组，还会制作维度模板参数并更改访问函数——哦，只是 IMNSHO 清理一下：

```
template <class T, size_t W, size_t H>
class Array2D
{
public:
    const int width = W;
    const int height = H;
    typedef typename T type;

    Array2D()
        : buffer(width*height)
    {
    }

    inline type& at(unsigned int x, unsigned int y)
    {
        return buffer[y*width + x];
    }

    inline const type& at(unsigned int x, unsigned int y) const
    {
        return buffer[y*width + x];
    }

private:
    std::vector<T> buffer;
}; 
```

现在您可以在堆栈上分配这个二维数组了：

```
void foo()
{
    Array2D<int, 800, 800> zbuffer;

    // Do something with zbuffer...
} 
```

我希望这有帮助！

编辑：从`Array2D::buffer`. 感谢安德烈亚斯抓住了这一点！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T07:08:30.437

然而，凯文的例子很好：

> ```
> std::vector<T> buffer[width * height]; 
> ```

应该

```
std::vector<T> buffer; 
```

稍微扩展一下，您当然可以添加运算符重载而不是 at() 函数：

```
const T &operator()(int x, int y) const
{
  return buffer[y * width + x];
} 
```

和

```
T &operator()(int x, int y)
{
  return buffer[y * width + x];
} 
```

例子：

```
int main()
{
  Array2D<int, 800, 800> a;
  a(10, 10) = 50;
  std::cout << "A(10, 10)=" << a(10, 10) << std::endl;
  return 0;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-14T22:14:57.940

你可以做一个向量的向量，但这会产生一些开销。对于 z 缓冲区，更典型的方法是创建一个大小为 800*800=640000 的数组。

```
const int width = 800;
const int height = 800;
unsigned int* z_buffer = new unsigned int[width*height]; 
```

然后按如下方式访问像素：

```
unsigned int z = z_buffer[y*width+x]; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-14T22:17:58.417

我可能会创建一个 800*800 的单维数组。使用这样的单个分配可能更有效，而不是分配 800 个单独的向量。

```
int *ary=new int[800*800]; 
```

然后，可能将其封装在一个类似于二维数组的类中。

```
class _2DArray
{
  public:
  int *operator[](const size_t &idx)
  {
    return &ary[idx*800];
  }
  const int *operator[](const size_t &idx) const
  {
    return &ary[idx*800];
  }
}; 
```

这里显示的抽象有很多漏洞，例如，如果您访问超出“行”的末尾会发生什么？《Effective C++》一书对用 C++ 编写好的多维数组进行了很好的讨论。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-14T22:21:46.507

有类似 C 的做法：

```
const int xwidth = 800;
const int ywidth = 800;
int* array = (int*) new int[xwidth * ywidth];
// Check array is not NULL here and handle the allocation error if it is
// Then do stuff with the array, such as zero initialize it
for(int x = 0; x < xwidth; ++x)
{
    for(int y = 0; y < ywidth; ++y)
    {
         array[y * xwidth + x] = 0;
    }
}
// Just use array[y * xwidth + x] when you want to access your class.

// When you're done with it, free the memory you allocated with
delete[] array; 
```

您可以使用简单的 get 和 set 方法封装`y * xwidth + x`类内部（`[]`如果您想开始使用更高级的 C++，可能会重载运算符）。如果你刚开始使用 C++ 并且没有开始为 n 维数组创建可重用的完全类模板，我建议你慢慢来，这只会让你在开始时感到困惑。

一旦您开始从事图形工作，您可能会发现额外调用类的开销可能会减慢您的代码速度。但是，在您的应用程序不够快之前不要担心这一点，并且您可以对其进行分析以显示时间损失的地方，而不是在一开始就使其更难使用，并可能带来不必要的复杂性。

我发现 C++ lite FAQ 非常适合此类信息。特别是您的问题由以下人员回答：

[http://www.parashift.com/c++-faq-lite/freestore-mgmt.html#faq-16.16](http://www.parashift.com/c++-faq-lite/freestore-mgmt.html#faq-16.16)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T06:53:40.317

您可以做的一件事是使用 VC 更改堆栈大小（如果您真的想要堆栈上的数组），这样做的标志是 [ [/F]（http://msdn.microsoft.com/en-us/library/ tdkhxaks(VS.80).aspx)](http://msdn.microsoft.com/en-us/library/tdkhxaks(VS.80).aspx))。

但是您可能想要的解决方案是将内存放在堆中而不是堆栈中，因为您应该使用 a `vector`of `vectors`.

以下行声明了 a `vector`of 800 个元素，每个元素是 a `vector`of 800 `int`s，并且使您免于手动管理内存。

```
std::vector<std::vector<int> > arr(800, std::vector<int>(800)); 
```

注意两个右尖括号 ( ) 之间的空格，这是为了消除右移运算符的歧义（在[C++0x](http://en.wikipedia.org/wiki/C_0x#Angle_bracket)`> >`中不再需要）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T07:37:57.730

或者您可以尝试以下方法：

```
boost::shared_array<int> zbuffer(new int[width*height]); 
```

您仍然应该可以这样做：

```
++zbuffer[0]; 
```

无需再担心管理内存，无需处理自定义类，而且很容易扔掉。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-15T13:01:38.747

如果您只需要一个实例，您可以在静态存储上分配数组（在文件范围内，或`static`在函数范围内添加限定符）。

```
int array[800][800];

void fn()
{
    static int array[800][800];
} 
```

这样它就不会进入堆栈，并且您不必处理动态内存。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-14T22:29:03.430

好吧，在 Niall Ryan 开始的基础上，如果性能是一个问题，您可以通过优化数学并将其封装到一个类中来更进一步。

所以我们将从一些数学开始。回想一下，800 可以用 2 的幂写为：

```
800 = 512 + 256 + 32 = 2^5 + 2^8 + 2^9 
```

所以我们可以把寻址函数写成：

```
int index = y << 9 + y << 8 + y << 5 + x; 
```

因此，如果我们将所有内容封装到一个不错的类中，我们会得到：

```
class ZBuffer
{
public:
    const int width = 800;
    const int height = 800;

    ZBuffer()
    {
        for(unsigned int i = 0, *pBuff = zbuff; i < width * height; i++, pBuff++)
            *pBuff = 0;
    }

    inline unsigned int getZAt(unsigned int x, unsigned int y)
    {
        return *(zbuff + y << 9 + y << 8 + y << 5 + x);
    }

    inline unsigned int setZAt(unsigned int x, unsigned int y, unsigned int z)
    {
        *(zbuff + y << 9 + y << 8 + y << 5 + x) = z;
    }
private:
    unsigned int zbuff[width * height];
}; 
```

# javascript - 防止 Web 应用程序中页面之间的击键丢失

> ID：61688
> 
> 赞同：4
> 
> 时间：2008-09-14T22:16:05.147
> 
> 标签：javascript, user-input

我当前的项目是编写一个与现有桌面应用程序等效的 Web 应用程序。

在桌面应用程序的工作流程中的某些点，用户可能会单击一个按钮，然后显示一个要填写的表单。即使应用程序显示表单需要一点时间，专家用户也知道该表单将是什么并且会开始打字，知道应用程序会“赶上他们”。

在 Web 应用程序中不会发生这种情况：当用户单击链接时，他们的击键将丢失，直到显示下一页上的表单。有没有人有任何防止这种情况的技巧？我是否必须放弃使用单独的页面并使用 AJAX 将表单嵌入到页面中，使用[GWT](http://code.google.com/webtoolkit/)之类的东西，或者仍然会有丢失击键的问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-14T22:43:40.790

在页面加载、javascript 被处理并且文本字段被聚焦之前，击键不会有效果。

基本上你真正要问的是；**如何加快 Web 应用程序以增加响应时间？**您的答案是 AJAX！

仔细考虑应用程序中最常见的操作，并使用 AJAX 最大限度地减少网页的重新加载。记住，不要过度使用 AJAX。使用过多的 javascript 会阻碍可用性，就像它可以提高可用性一样。

相关阅读材料：

*   [响应时间：三个重要限制](http://www.useit.com/papers/responsetime.html)- 来自可用性之王 Jacon Neilson 的精彩文章。
*   [Ajax 可用性错误](http://ajaxian.com/archives/ajax-usability-mistakes)
*   [AJAX 可用性检查表](http://experiencedynamics.blogs.com/site_search_usability/2007/12/ajax-usability.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T13:46:27.180

Perhaps I am under-thinking the problem but I'll throw this out there... You could just put your form inside a hidden div or similar container that you show (perhaps give it a modal look/behavior?) on the click event of the link. That way the form is already loaded as part of the page. It should appear almost instantly.

You can find modal div tutorials all over the place, shouldn't be too tricky. If you're using ASP.NET there's even one included in Microsoft's AJAX library.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T22:36:50.073

AJAX 或插件是您唯一的机会。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-14T22:54:13.027

我认为做你想做的事情会很困难。我认为真正的问题是新页面加载时间过长。您应该考虑缓存页面或对静态组件（例如图片等）进行部分缓存，以改善加载时间或预加载页面并使其不可见。（有关一些想法，请参阅[更多可用表单的简单技巧）](https://web.archive.org/web/20080925024942/http://www.sitepoint.com/print/1273/?PHPSESSID=850e8f554020735a2e213dd825cb9e3d)

对于编码选项，您可以使用 javascript 来捕获击键（请参阅[检测各种击键](https://web.archive.org/web/20090130113945/http://lists.evolt.org:80/archive/Week-of-Mon-20021230/131136.html)）

```
<html><head>
<script language=javascript>
IE=document.all;
NN=document.layers;
kys="";
if (NN){document.captureEvents(Event.KEYPRESS)}
document.onkeypress=katch
function katch(e){
if (NN){kys+=e.which}
if (IE){kys+=event.keyCode}
document.forms[0].elements[0].value=kys
}
</script>
</head>
<body>
<form><input></form>
</body>
</html> 
```

您需要保存它们，然后在控制从当前页面传递后将它们转移到新页面。（请参阅[在关闭浏览器或退出页面时保存更改](http://www.codeproject.com/KB/aspnet/Save_on_Close_of_Browser.aspx)）

有关在各种浏览器中检测击键问题的一些一般信息，请查看[Javascript-Detecting keystrokes](http://www.quirksmode.org/js/keys.html)。

# .net - 如何在 .NET 安装项目中添加卸载选项？

> ID：61691
> 
> 赞同：8
> 
> 时间：2008-09-14T22:25:46.247
> 
> 标签：.net, installation, uninstallation

.NET 安装项目似乎有很多选项，但我没有看到“卸载”选项。

我希望人们可以从标准的“开始菜单”文件夹中“卸载”而不是将他们发送到控制面板来卸载我的应用程序，所以有人可以告诉我该怎么做吗？

此外，我知道具有此功能的非 Microsoft 安装程序，但如果可能的话，我想继续使用 Microsoft 工具包。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-14T22:38:33.347

您可以创建快捷方式：

```
msiexec /uninstall [path to msi or product code] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-11T21:43:01.690

安装项目有一个“RemovePreviousVersons”功能，它可能涵盖了最引人注目的卸载用例，但它关闭了“产品代码”。请参阅[MSDN 文档](http://msdn.microsoft.com/en-us/library/y63fxdw6.aspx)。这个“产品代码”似乎没有很好地命名，因为每次更新版本号时都需要更改它。事实上，VS2010 会提示你这样做。不幸的是，产品代码和版本号都没有出现在生成的 .msi 文件的文件属性中。

该解决方案在可维护性方面存在与先前建议类似的限制，即在硬编码快捷方式中包含相同的难以理解的产品代码。

实际上，这里似乎没有任何非常有吸引力的选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-04-03T20:31:17.597

如果您使用 Installshield Add-on，Visual Studio 2013 允许您在快捷方式设计页面中创建卸载快捷方式。

# java - 如何让我的 Java 应用程序在 Windows 中正常关闭？

> ID：61692
> 
> 赞同：6
> 
> 时间：2008-09-14T22:28:03.340
> 
> 标签：java, windows, shutdown

我有一个 Java 应用程序，当用户选择 Start->Shutdown 时，我想“很好地”关闭它。我尝试通过 Runtime.addShutdownHook(...) 使用 JVM 关闭侦听器，但这不起作用，因为我无法使用其中的任何 UI 元素。

我也尝试在我的主应用程序 UI 窗口上使用退出处理程序，但据我所知，它无法暂停或停止关机。我怎样才能很好地处理关机？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-14T22:34:01.140

据我所知，您需要开始使用 JNI 为 Windows [WM_QUERYENDSESSION](http://msdn.microsoft.com/en-us/library/aa376890.aspx)消息设置消息处理程序。

为此（如果您像我一样不熟悉 Windows 编程），您需要创建一个具有新消息处理函数的新窗口类（如此[处](http://www.angelcode.com/dev/window/window.asp)所述）并处理来自消息处理程序的 WM_QUERYENDSESSION。

注意：您需要在消息处理线程上使用 JNIEnv::GetJavaVM(...) 和 JavaVM::AttachCurrentThread(...)，然后才能从本机消息处理代码调用任何 Java 方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T13:18:51.210

前面提到的 JNI 方法可能会起作用。

您可以使用 JNA，它基本上是 JNI 的包装器，以使其更易于使用。一个额外的好处是它（至少在我看来）通常比原始 JNI 更快且更易于维护。[您可以在https://jna.dev.java.net/](https://jna.dev.java.net/)找到 JNA

如果您只是在开始菜单中启动应用程序，因为您想让它像 Windows 中的服务一样运行，您可以使用此处找到的 java 服务包装器： [http ://wrapper.tanukisoftware.org/doc /english/download.jsp](http://wrapper.tanukisoftware.org/doc/english/download.jsp)

# .net - 从 Inno Setup 向 GAC 添加程序集

> ID：61699
> 
> 赞同：4
> 
> 时间：2008-09-14T22:39:04.950
> 
> 标签：.net, installation, gac, inno-setup

直到最近我们还在使用 Inno Setup 进行安装，我想继续这样做，除非我们可以[在开始菜单中获得卸载选项](https://stackoverflow.com/questions/61691/how-to-add-uninstall-option-in-net-setup-project)（感谢 Giovanni Galbo），但是我们现在需要 GAC 一些外部库，我怀疑是仅通过 .NET 安装项目可行（或至少仅受支持）。

是否可以从另一个设置应用程序调用 GAC 库？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-09-25T11:28:48.273

根据[http://jrsoftware.org/files/is5-whatsnew.htm](http://jrsoftware.org/files/is5-whatsnew.htm)您应该可以使用 v5.3 及更高版本进行操作

> 添加了 .NET 支持（如果在没有 .NET Framework 的系统上使用这些会导致内部错误）：
> 
> ```
> * Added new [Files] section flag: gacinstall.
> * Added new [Files] section parameter: StrongAssemblyName.
> * Added new constants: {regasmexe}, {regasmexe32}, {regasmexe64}. 
> ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-14T22:41:44.540

不确定库，但您可以调用[gacutil.exe](http://msdn.microsoft.com/en-us/library/ex0ss12c%28VS.80%29.aspx)来安装/卸载程序集。

# eclipse - 在 Eclipse 中使用键盘切换编辑器，而不是切换 Design/Source

> ID：61704
> 
> 赞同：3
> 
> 时间：2008-09-14T22:46:13.700
> 
> 标签：eclipse

在 Eclipse 中，我可以使用控制页面向上/向下切换打开的编辑器。这很好用，除了像 XML 或 JavaScript 这样的编辑器，那里有设计和源选项卡。对于那些编辑器，它只是在不同的选项卡之间切换。有没有办法让 Eclipse 忽略它们？我知道“下一个编辑器”的 alt-F6，但它不使用与显示编辑器选项卡相同的顺序，所以它很混乱。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-14T23:07:15.740

使用`Ctrl`-`E`您可以通过键入名称的开头直接跳转到任何编辑器。当您打开很多编辑器时非常方便。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-14T23:40:48.250

你是对的——看起来 Eclipse 已经承认它是一个[错误](https://bugs.eclipse.org/bugs/show_bug.cgi?id=199499)。它已在 3.5 中修复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-14T23:02:20.993

一开始我在想`Alt`——`←</kbd> and `Alt`-`→</kbd> might do what you want, but that's more for going forward and backwards in history of tabs you've viewed. Which might sort of get you what you want, but is probably just as confusing as `Alt`-`F6`.``

我认为这听起来更像是 Eclipse 中的一个错误，可能值得去 eclipse.org 看看是否有一个预先存在的错误。

# xna - XNA 游戏中的高分在哪里保存？

> ID：61705
> 
> 赞同：6
> 
> 时间：2008-09-14T22:46:58.130
> 
> 标签：xna, data-storage, xbox

我正在 XNA 中制作一个简单的 2 人游戏，并开始研究保存玩家的高分。

我希望游戏可以在 Xbox 360 和 Windows 上运行，所以我必须使用框架来保存数据。

似乎您将数据保存到特定用户的玩家标签 - 所以我的问题是，如何处理高分？

*   将用户自己的分数保存在他们的个人资料中？（因此，只有您是唯一登录的人才能看到自己的分数）
*   尝试在所有配置文件中保存其他玩家的分数？（尝试保持同步似乎很痛苦）
*   在线存储分数
    *   360似乎有一个标准的方法来显示朋友的高分。这可以从 XNA 中访问，还是仅对已发布的游戏可用？
    *   滚我自己的。（对于这么小的个人项目来说似乎太过分了。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-14T23:40:05.820

这是一种已经完成的方法，看起来非常简单且易于实现。

[http://xnaessentials.com/tutorials/highscores.aspx](http://xnaessentials.com/tutorials/highscores.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T17:27:25.550

XNA Live API 不允许您访问排行榜……所以您真正唯一的选择是在本地存储分数。如果您希望用户看到彼此的分数……您可以使用两个不同的商店。玩家存储自己的存档数据……然后标题存储存储分数。

当然，如果360有多个存储设备，他们将不得不选择它两次......但你只能让他们选择得分设备，如果他们进入高分部分。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-17T16:33:39.480

您可能想阅读[http://www.enchantedage.com/highscores](http://www.enchantedage.com/highscores)。它使用 XNA 网络会话与玩同一游戏的其他 Xbox 共享高分。

# java - 如何在 Java 中捕获崩溃日志

> ID：61714
> 
> 赞同：2
> 
> 时间：2008-09-14T23:09:25.160
> 
> 标签：java, error-handling, crash

我正在使用 Java 开发一个跨平台应用程序，该应用程序目前在 Windows、Linux 和 MacOS X 上运行良好。我正在尝试找出一种很好的方法来检测（和处理）“崩溃”。是否有一种简单的跨平台方法来检测 Java 中的“崩溃”并采取相应措施？

我猜“崩溃”是指未捕获的异常。然而，代码确实使用了一些 JNI，因此能够从错误的 JNI 代码中捕获崩溃会很好，但我感觉这是 JVM 特定的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T02:38:16.013

对于简单的包罗万象的处理，您可以在[Thread](http://java.sun.com/javase/6/docs/api/java/lang/Thread.html)中使用以下静态方法。来自 Javadoc：

> static void [**setDefaultUncaughtExceptionHandler**](http://java.sun.com/javase/6/docs/api/java/lang/Thread.html#setDefaultUncaughtExceptionHandler(java.lang.Thread.UncaughtExceptionHandler)) ( [Thread.UncaughtExceptionHandler](http://java.sun.com/javase/6/docs/api/java/lang/Thread.UncaughtExceptionHandler.html) eh)
>           设置当线程由于未捕获的异常而突然终止时调用的默认处理程序，并且没有为该线程定义其他处理程序。

这是处理可能无法在其他任何地方捕获的错误或未经检查的异常的一种非常广泛的方法。

**旁注：**如果代码可以捕获、记录和/或从更接近问题根源的异常中恢复，那就更好了。[我会为完全不可恢复的情况（即java.lang.Error](http://java.sun.com/javase/6/docs/api/java/lang/Error.html)的子类）保留这种通用的崩溃处理。尽量避免[RuntimeException](http://java.sun.com/javase/6/docs/api/java/lang/RuntimeException.html)完全未被捕获的可能性，因为软件有可能——而且更可取——在这种情况下幸存下来。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-14T23:12:13.310

为了处理未捕获的异常，您可以提供一个新的 ThreadGroup，它提供了 ThreadGroup.uncaughtException(...) 的实现。然后，您可以捕获任何未捕获的异常并适当地处理它们（例如，将崩溃日志发送回家）。

我无法在 JNI 方面为您提供帮助，可能有一种方法可以在调用 JVM 之前使用本机包装器可执行文件，但是该可执行文件需要知道它可能调用的所有可能的 JVM 以及指示崩溃的方式和位置放置崩溃日志等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-14T23:18:10.177

不确定这是否是您所需要的，但您也可以从本机代码中检测是否发生异常。有关更多信息，请参见[http://java.sun.com/javase/6/docs/technotes/guides/jni/spec/functions.html#wp5234](http://java.sun.com/javase/6/docs/technotes/guides/jni/spec/functions.html#wp5234)。

# tdd - 数据库集成测试

> ID：61718
> 
> 赞同：10
> 
> 时间：2008-09-14T23:25:02.267
> 
> 标签：tdd, integration-testing, database-testing

当您仅使用数据访问层或大多数应用程序堆栈进行集成测试时。如果多个测试在同一个数据库上运行，那么防止多个测试相互冲突的最佳方法是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-14T23:33:14.260

交易。

ruby on rails 单元测试框架的作用是：

```
Load all fixture data.

For each test:

  BEGIN TRANSACTION

    # Yield control to user code

  ROLLBACK TRANSACTION

End for each 
```

这意味着

1.  您的测试对数据库所做的任何更改都不会影响正在进行的其他线程
2.  下一个测试的数据没有被之前的测试污染
3.  这比为每个测试手动重新加载数据快了大约数十亿倍。

我个人认为这很酷

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-14T23:30:17.293

对于简单的数据库应用程序，我发现使用[SQLite](http://www.sqlite.org/)非常宝贵。它允许您为每个测试拥有一个独特且独立的数据库。

但是，它仅在您使用简单的通用 SQL 功能或可以轻松地将 SQLite 和您的生产数据库系统之间的细微差别隐藏在一个类后面时才有效，但我一直发现在我的 SQL 应用程序中相当容易发达。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T14:58:45.710

只是为了添加到 Free Wildebeest 的答案，我还使用[HSQLDB](http://hsqldb.org/)进行了类似的类型测试，其中每个测试都获得了一个干净的数据库实例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-14T23:37:27.150

我想同时接受 Free Wildebeest 和 Orion Edwards 的答案，但它不会让我接受。我想这样做的原因是我得出的结论是，这是两种主要的方法，但选择哪一种取决于具体情况（主要是数据库的大小）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T00:44:47.660

还要在不同的时间运行测试，这样它们就不会影响彼此的性能或有效性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T18:26:40.547

虽然在此处的其他答案中不如 Rails 单元测试框架聪明，但为每个测试或测试组创建不同的数据是另一种方法。这种解决方案的乏味程度取决于您拥有的测试用例的数量以及它们之间的依赖程度。如果每个测试或一组依赖测试都有一个数据库，那么乏味将保持不变。

运行测试套件时，您在开始时加载数据，运行测试套件，卸载/比较结果以确保实际结果符合预期结果。如果没有，请再次执行此循环。加载、运行套件、卸载/比较。

# c# - C# Casting 与 Parse

> ID：61733
> 
> 赞同：15
> 
> 时间：2008-09-14T23:52:35.117
> 
> 标签：c#, datetime, parsing, string, casting

以下哪个是 C# 中更好的代码，为什么？

```
((DateTime)g[0]["MyUntypedDateField"]).ToShortDateString() 
```

或者

```
DateTime.Parse(g[0]["MyUntypedDateField"].ToString()).ToShortDateString() 
```

最终，是强制转换还是解析更好？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-15T00:00:12.493

如果 g[0]["MyUntypedDateField"] 确实是一个 DateTime 对象，那么强制转换是更好的选择。如果它不是真正的 DateTime，那么您别无选择，只能使用 Parse（如果您尝试使用强制转换，您将收到 InvalidCastException）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T06:19:56.763

铸造是**唯一**好的答案。

您必须记住，ToString 和 Parse 结果并不总是准确的 - 在某些情况下，您无法在这两个函数之间安全地往返。

ToString 的文档说，它使用当前的线程文化设置。Parse 的文档说，它还使用当前的线程文化设置（到目前为止很好 - 它们使用相同的文化），但有一个明确的评论，即：

> 格式设置受当前 DateTimeFormatInfo 对象的属性影响，默认情况下，这些属性派生自控制面板中的区域和语言选项项。**Parse 方法可能意外抛出 FormatException 的原因之一是当前 DateTimeFormatInfo.DateSeparator 和 DateTimeFormatInfo.TimeSeparator 属性是否设置为相同的值。**

因此，根据用户设置，ToString/Parse 代码可能并且将会意外失败......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T13:02:58.417

您的代码表明该变量可能是日期或看起来像日期的字符串。您可以通过强制转换简单地返回日期，但必须解析字符串。解析有两个注意事项；

1.  如果您不确定是否可以解析此字符串，请使用`DateTime.TryParse()`.

2.  始终包含对您要解析为的文化的引用。`ToShortDateString()`在不同的地方返回不同的输出。您几乎肯定会希望使用相同的文化进行解析。我建议这个函数处理这两种情况；

    ```
    private DateTime ParseDateTime(object data)
    {
        if (data is DateTime)
        {
            // already a date-time.
            return (DateTime)data;
        }
        else if (data is string)
        {
            // it's a local-format string.
            string dateString = (string)data;
            DateTime parseResult;
            if (DateTime.TryParse(dateString, CultureInfo.CurrentCulture,
                                  DateTimeStyles.AssumeLocal, out parseResult))
            {
                return parseResult;
            }
            else
            {
                throw new ArgumentOutOfRangeException("data", 
                                   "could not parse this datetime:" + data);
            }
        }
        else
        {
            // it's neither a DateTime or a string; that's a problem.
            throw new ArgumentOutOfRangeException("data", 
                                  "could not understand data of this type");
        }
    } 
    ```

然后像这样调用；

```
ParseDateTime(g[0]["MyUntypedDateField").ToShortDateString(); 
```

请注意，不良数据会引发异常，因此您需要捕获它。

还; 'as' 运算符不适用于 DateTime 数据类型，因为它仅适用于引用类型，而 DateTime 是一种值类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T00:06:13.493

正如@Brian R. Bondy 指出的那样，它取决于**g[0]["MyUntypedDateField"]**的实现。安全的做法是使用**DateTime.TryParse**和**as**运算符。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T00:50:58.830

Parse 需要一个字符串作为输入，强制转换需要一个对象，因此在您上面提供的第二个示例中，您需要执行两次强制转换：一次从对象到字符串，然后从字符串到 DateTime。第一个没有。

但是，如果在执行强制转换时存在异常风险，那么您可能希望采用第二条路线，以便可以 TryParse 并避免抛出代价高昂的异常。否则，走最有效的路线，只转换一次（从对象到 DateTime）而不是两次（从对象到字符串到 DateTime）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T00:54:57.213

[在http://blogs.msdn.com/bclteam/archive/2005/02/11/371436.aspx](http://blogs.msdn.com/bclteam/archive/2005/02/11/371436.aspx)有不同技术的比较。

# drupal - 在 Drupal 6 中包含特定节点的 CSS 或 Javascript 文件

> ID：61735
> 
> 赞同：23
> 
> 时间：2008-09-14T23:54:58.403
> 
> 标签：drupal, preprocessor

在 Drupal 6 中包含特定节点的 CSS 或 Javascript 文件的最佳方法是什么？

我想在我的网站上创建一个运行了一个小 javascript 应用程序的页面，因此 CSS 和 javascript 是特定于该页面的，根本不希望包含在其他页面加载中。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-15T23:21:37.383

我建议不要使用`hook_nodeapi`它。添加 CSS 和 Javascript 与布局有关，所以`hook_nodeapi`不适合它：使用主题。这样，当您要开发新主题时，您*可以覆盖这些文件。*使用 nodeapi 方法执行此操作会有点困难（您必须在 js/css 列表中搜索文件，删除它们并用您自己的替换它们）。

无论如何：您需要做的是添加一个节点预处理功能，为您添加这些文件。您可以在模块或自定义主题中执行此操作。对于一个模块，这将是：

```
function mymodule_preprocess_node(&$variables) {
  $node = $variables['node'];
  if (!empty($node) && $node->nid == $the_specific_node_id) {
    drupal_add_js(drupal_get_path('module', 'mymodule') . "/file.js", "module");
    drupal_add_css(drupal_get_path('module', 'mymodule') . "/file.css", "module");
  }
} 
```

或主题：

```
function mytheme_preprocess_node(&$variables) {
  $node = $variables['node'];
  if (!empty($node) && $node->nid == $the_specific_node_id) {
    drupal_add_js(path_to_theme() . "/file.js", "theme");
    drupal_add_css(path_to_theme(). "/file.css", "theme");
  }
} 
```

首先不要忘记清除缓存。

这些函数在节点主题化之前被调用。在那里指定 js/css 允许级联方法：您可以在模块中拥有通用/基本的东西，并在主题中提供增强或特定的功能。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T02:17:53.413

我使用预处理函数，但这有一些问题。`$variables['styles']`通常在调用节点预处理函数*之前设置。*换句话说`drupal_get_css`，已经调用了这使您调用`drupal_add_css`无用。也是如此`drupal_add_js`。`$variables['styles']`我通过重置值来解决这个问题。

```
function mytheme_preprocess_node(&$variables) {
  $node = $variables['node'];
  if (!empty($node) && $node->nid == $the_specific_node_id) {
    drupal_add_js(path_to_theme() . "/file.js", "theme");
    drupal_add_css(path_to_theme(). "/file.css", "theme");
    $variables['styles'] = drupal_get_css();
    $variables['script'] = drupal_get_js();
  }
} 
```

这似乎适用于大多数情况。

PS 几乎不需要创建一个模块来解决主题问题。

干杯。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-06-10T11:40:04.860

这似乎是一个很好的解决方案：

[http://drupal.org/project/js_injector](http://drupal.org/project/js_injector) 和 [http://drupal.org/project/css_injector](http://drupal.org/project/css_injector)

当您想将内联代码插入到技术上不是节点的东西中时，它可以工作，因此没有节点 ID 并且没有可用的 PHP 输入选项。就像我用它在几个管理页面中注入小的 jQuery 调整一样。它通过路径而不是节点 ID 工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T00:00:15.100

到目前为止，我想出的最佳解决方案是启用 PHP 输入模式，然后在节点主体开头的 PHP 块中酌情调用[drupal_add_css](http://api.drupal.org/api/function/drupal_add_css)和[drupal_add_js 。](http://api.drupal.org/api/function/drupal_add_js)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T02:09:30.157

这应该可以解决问题 - 一个快速模块，它在查看节点时使用[hook_nodeapi](http://api.drupal.org/api/function/hook_nodeapi/6)插入 JS/CSS。

```
function mymodule_nodeapi(&$node, $op, $a3 = NULL, $a4 = NULL) {
  // the node ID of the node you want to modify
  $node_to_modify = 6;

  // do it!
  if($op == 'view' && $node->nid == $node_to_modify) {
    drupal_add_js(drupal_get_path('module', 'mymodule') . '/mymodule.js');
    drupal_add_css(drupal_get_path('module', 'mymodule') . '/mymodule.css');
  }
} 
```

这避免了启用 PHP 输入过滤器的安全问题，并且不需要单独的节点模板文件，如果您更新了主节点模板并忘记了您的自定义模板，该文件可能会变得过时。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T00:07:33.507

您可以为调用 javascript 的该节点 (node-needsjs.tpl.php) 提供自定义模板。这比在节点主体中直接使用 PHP 更简洁，并且使将来对内容的更改更容易。

**编辑：**我认为我在上面不是很清楚。您想将模板文件命名为 node-(nodeid).tpl.php。所以如果是节点 1，调用文件 node-1.tpl.php

# windows - 如何确定 Windows 单选按钮的按钮部分的大小

> ID：61739
> 
> 赞同：8
> 
> 时间：2008-09-14T23:59:04.697
> 
> 标签：windows, user-interface, winapi, gdi

我正在使用 DrawFrameControl 自己绘制旧学校（非主题 - 主题收音机是另一个问题）单选按钮：

```
DrawFrameControl(dc, &rectRadio, DFC_BUTTON, isChecked() ? DFCS_BUTTONRADIO | DFCS_CHECKED : DFCS_BUTTONRADIO); 
```

我从来没有想出一个可靠的方法来弄清楚 RECT 应该传递什么。我一直在使用 12x12 矩形，但我希望 Windows 告诉我单选按钮的大小。

DrawFrameControl 似乎缩放单选按钮以适合我通过的矩形，因此我必须接近收音机的“正确”尺寸，使其与屏幕上的其他（非所有者绘制的）收音机相隔。

有人知道怎么做吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T00:44:33.287

此页面显示了一些控件的尺寸指南。请注意，大小以 DLU（对话框单位）和像素为单位给出，具体取决于您是否将控件放在对话框上：

[http://msdn.microsoft.com/en-us/library/aa511279.aspx#controlsizing](http://msdn.microsoft.com/en-us/library/aa511279.aspx#controlsizing)

我以为`GetSystemMetrics`API 可能会返回一些常用控件的标准大小，但我没有找到任何东西。可能有一个通用的特定于控件的 API 来确定大小。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T00:29:17.893

自从我从事这项工作以来已经有一段时间了，所以我所描述的是我所做的，而不一定是对这个问题的直接回答。

我碰巧使用的是 13 x 13 而不是 12 x 12 的位图。复选框的位图部分似乎是在 WM_DRAWITEM 中传递的。但是，我还设置了 WM_MEASUREITEM 并为其提供了相同的值，所以我的答案很可能是正确的哲学意义上的“乞求问题”。

```
        案例 WM_MEASUREITEM：
            lpmis = (LPMEASUREITEMSTRUCT) lParam;

            lpmis->itemHeight = 13；
            lpmis->itemWidth = 13;

            休息;

        案例 WM_DRAWITEM：
            lpdis = (LPDRAWITEMSTRUCT) lParam;
            hdcMem = CreateCompatibleDC(lpdis->hDC);  

            if (lpdis->itemState & ODS_CHECKED) // 如果选择
                {
                SelectObject(hdcMem, hbmChecked);
                }
            别的
                {
                if (lpdis->itemState & ODS_GRAYED)
                    {
                    SelectObject(hdcMem, hbmDefault);
                    }
                别的
                    {
                    SelectObject(hdcMem, hbmUnChecked);
                    }
                }
            拉伸Blt（
                lpdis->hDC, // 目标 DC
                lpdis->rcItem.left, // x 左上角
                lpdis->rcItem.top, // y 左上角

                // 接下来的两行指定宽度和
                // 高度。
                lpdis->rcItem.right - lpdis->rcItem.left,
                lpdis->rcItem.bottom - lpdis->rcItem.top,
                hdcMem, // 源设备上下文
                0, 0, // x 和 y 左上角
                13, // 源位图宽度
                13, // 源位图高度
                SRCCOPY); // 光栅操作

            删除DC(hdcMem);
            返回真；

```

这似乎适用于 Win2000 和 XP，尽管我不知道 Vista 可能会做什么。

看看省略 WM_MEASUREITEM 的作用可能值得做一个实验，尽管我通常会发现旧代码我通常有充分的理由去做一些看起来多余的事情。

# eclipse - 在 Mac 上为 PostgreSQL 安装 PDO 驱动程序（使用 Zend for eclipse）

> ID：61747
> 
> 赞同：10
> 
> 时间：2008-09-15T00:14:10.353
> 
> 标签：eclipse, macos, postgresql, pdo

如何让 PDO 在我的 mac (os x 10.5) 上工作？我在 Zend/Eclipse 中使用内置的 php 和 php。似乎根本找不到有用的驱动程序。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-08-17T04:28:56.280

我最近不得不在 Leopard 上安装 PDO_PGSQL 驱动程序，并且遇到了许多问题。在寻找答案的过程中，我偶然发现了这个问题。现在我已经成功安装了它，所以，即使这个问题已经很老了，我希望我的发现可以帮助其他人（比如我自己），他们无疑会遇到类似的问题。

您需要做的第一件事是[安装 PEAR](http://pear.php.net/manual/en/installation.getting.php)（如果您还没有安装的话），因为默认情况下它不会安装在 Leopard 上。

完成后，使用 PECL 安装程序下载 PDO_PGSQL 包：

```
$ pecl download pdo_pgsql
$ tar xzf PDO_PGSQL-1.0.2.tgz 
```

（注意：您可能必须以`pecl`超级用户身份运行，即`sudo pecl`。）

之后，由于 PECL 安装程序无法直接安装扩展，您需要自己构建和安装：

```
$ cd PDO_PGSQL-1.0.2
$ phpize
$ ./configure --with-pdo-pgsql=/path/to/your/PostgreSQL/installation
$ make && sudo make install 
```

如果一切顺利，你应该有一个名为“ `pdo_pgsql.so`”的文件位于一个看起来像“ `/usr/lib/php/extensions/no-debug-non-zts-20060613/`”的目录中（PECL 安装应该输出了它安装扩展的目录）。

要完成安装，您需要编辑`php.ini`文件。找到标有“动态扩展”的部分，然后在（可能已注释掉的）扩展列表下方，添加以下行：

```
extension=pdo_pgsql.so 
```

现在，假设这是您第一次安装 PHP 扩展，您需要采取两个额外的步骤才能使其正常工作。首先，在 中`php.ini`，找到`extension_dir`指令（在“路径和目录”下），并将其更改`pdo_pgsql.so`为安装文件的目录。例如，我的`extension_dir`指令如下所示：

```
extension_dir = "/usr/lib/php/extensions/no-debug-non-zts-20060613" 
```

第二步，如果您使用的是 64 位 Intel Mac，则需要让 Apache 在 32 位模式下运行。（如果有更好的策略，我想知道，但目前，这是我能找到的最好的。）为了做到这一点，编辑位于`/System/Library/LaunchDaemons/org.apache.httpd.plist`. 找到这两行：

```
<key>ProgramArguments</key>
<array> 
```

在它们下面，添加以下三行：

```
<string>arch</string>
<string>-arch</string>
<string>i386</string> 
```

现在，只需重新启动 Apache，PDO_PGSQL 就会启动并运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T02:25:05.470

看看这个 PECL 包：[PDO_PGSQL](http://pecl.php.net/package/PDO_PGSQL)

我自己没有尝试过，但我一直对使用 Postgres 作为 MySQL 的替代品感兴趣。如果我有机会很快尝试一下，我会把我的结果放在这里以防万一。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T02:10:48.547

我不确定这对 PDO 驱动程序是否有帮助，但您可能会查看[BitNami 的 MAPPStack](http://bitnami.org/stack/mappstack)。

我在 Mac 上使用 Postgres、PHP 和 Apache 时遇到了很多麻烦，其中一些与其中一些或全部的 64 位和 32 位版本有关。到目前为止，BitNami MAPPStack 安装总体上运行良好。也许它也会帮助您解决 PDO 问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-04-30T06:38:52.873

通过 brew 安装新的 php 版本并重新启动服务器，以及 php -v，所有问题都被删除。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-03-08T17:47:54.193

这对我有用

```
brew install php55-pdo-pgsql 
```

这将安装 PHP 5.5.32 和 PostgreSQL 9.5。我已经安装了 PostgreSQL 9.4，所以我卸载了自制版本：

```
brew uninstall postgres 
```

然后您必须更新 /etc/apache2/httpd.conf 以指向正确的 PHP 版本并重新启动 Apache：

```
LoadModule php5_module /usr/local/Cellar/php55/5.5.32/libexec/apache2/libphp5.so 
```

我的 OSX 版本是 Yosemite。

# database - 如何实现数据库引擎独立分页？

> ID：61750
> 
> 赞同：7
> 
> 时间：2008-09-15T00:22:47.010
> 
> 标签：database, paging

任务：实现适合不同RDBMS的数据库记录分页。方法应该适用于主流引擎 - MSSQL2000+、Oracle、MySql 等。

请不要发布 RDBMS 特定的解决方案，我知道如何为大多数现代数据库引擎实现这一点。我正在寻找通用解决方案。目前我只想到基于临时表的解决方案。

**编辑：**
我正在寻找 SQL 解决方案，而不是第 3 方库。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T10:53:47.080

如果 SQL 规范将分页作为标准包括在内，那么就会有一个通用的解决方案。将任何 RDBMS 语言称为 RDBMS 语言的要求也不包括分页支持。

许多数据库产品支持对标准语言进行专有扩展的 SQL。其中一些支持分页，例如带有限制子句的 MySQL，带有 Oracle 的 Rowid；每个处理不同。其他 DBMS 将需要添加一个名为 rowid 或类似的字段。

我不认为你可以有一个通用的解决方案（任何人都可以在这里证明我错了；可以辩论），除非它内置在数据库系统本身中，或者除非有一家公司说 ABC 使用 Oracle、MySQL、SQL Server 和他们决定让所有不同的数据库系统由他们的数据库开发人员提供他们自己的分页实现，为使用它的代码提供一个通用接口。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T06:36:59.887

进行分页最自然、最有效的方法是使用 LIMIT/OFFSET（Sybase 世界中的 TOP）构造。DBindependent 方式必须知道它在哪个引擎上运行并应用正确的 SQL 构造。

至少，这是我在 DB 独立库的代码中看到的方式。一旦使用特定查询从引擎获取数据，您就可以抽象出分页逻辑。

如果你真的在寻找一个单一的、一个 SQL 语句的解决方案，你能说出你的想法吗？就像临时表解决方案的 SQL 一样。这可能会给你更多相关的建议。

编辑：

我想看看你在想什么，因为我看不到使用临时表而不使用引擎特定构造的方法。您在示例中使用了特定的构造。我仍然看不到仅使用（已实现的）标准 SQL 在数据库中实现分页的方法。您可以在应用程序中使用标准 SQL 和页面中的整个表，但这显然是愚蠢的。

所以现在的问题更像是“有没有一种方法可以在不使用 LIMIT/OFFSET 或等效项的情况下实现分页？” 我猜答案是“理智地，不”。您可以尝试使用游标，但您也会在那里成为数据库特定句子/行为的牺牲品。

我刚刚想到的一个古怪（读傻）的想法是在表中添加一个页面列，比如创建表测试（id int，name varchar，phone varchar，page int），然后您可以使用 select * 获取第 1 页from table where page = 1。但这意味着必须添加代码来维护该列，而这又只能通过引入整个数据库或使用数据库特定的结构来完成。除了必须为每个可能的排序和许多其他缺陷添加不同的列之外。

我无法提供证据，但我真的认为你不能理智地做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T07:05:03.550

照常进行：
首先按照标准实施。然后处理极端情况，即不执行标准的 DBMS。如何处理极端情况取决于您的开发环境。

您正在寻找一种“通用”的方法。最通用的分页方式是使用游标，但基于游标的分页不太适合 Web 应用程序等无状态环境。

我在这里写过标准和实现（包括游标）：http: [//troels.arvin.dk/db/rdbms/#select-limit-offset](http://troels.arvin.dk/db/rdbms/#select-limit-offset)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T00:26:58.653

如果您可以容忍开源，SubSonic 可以为您执行此操作... [http://subsonicproject.com/querying/webcast-using-paging/](http://subsonicproject.com/querying/webcast-using-paging/)

除此之外，我知道 NHib 也是如此

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T00:31:06.350

JPA 允许您使用 Query 类来做到这一点：

```
Query q = ...;
q.setFirstResult (0);
q.setMaxResults (10); 
```

为您提供结果集中的前 10 个结果。

如果你想要一个独立于 DBMS 的原始 SQL 解决方案，恐怕你不走运。所有供应商的做法都不同。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T07:49:41.990

@Vinko Vrsalovic，

正如我所写的那样，我知道如何在大多数数据库中做到这一点。我要找到通用解决方案或获得它不存在的证据。

这是一种基于临时表的愚蠢解决方案。这显然很糟糕，所以没有必要评论它。

```
N - upper bound
M - lower bound

create #temp (Id int identity, originalId int)

insert into #temp(originalId)
select top N KeyColumn from MyTable
where ...

select MyTable.* from MyTable
join #temp t on t.originalId = MyTable.KeyColumn
where Id between M and M
order by Id asc

drop #temp 
```

# asp.net - 浏览器所见即所得最佳实践

> ID：61760
> 
> 赞同：2
> 
> 时间：2008-09-15T00:36:50.940
> 
> 标签：asp.net, javascript, wysiwyg

我在网页上使用富文本编辑器。.NET 具有阻止发布 HTML 标记的功能，因此我添加了一个 JavaScript 片段以在发布之前将尖括号更改为一对字符和别名。别名在服务器上用必要的尖括号替换，然后存储在数据库中。除了 XSS，解决这个问题的常用方法是什么。（即有更好的方法吗？）

如果您对 XSS（跨站点脚本）有意见，我相信这会对某人有所帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T01:25:32.570

实际上有一种方法可以关闭该“功能”。这将允许用户发布他们想要的任何字符，并且无需使用 Javascript 将字符转换为别名。请参阅本文以[禁用请求验证](http://mdid.org/mdidwiki/index.php?title=Disabling_Request_Validation)。这意味着您必须自己进行验证，但是从您的帖子的声音来看，这似乎就是您想要做的事情。[您也可以按照此处的说明在](http://www.asp.net/learn/whitepapers/request-validation/)每页禁用它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T01:28:50.707

我认为最安全的方法是不允许用户使用您的 WISYWIG 创建标签。也许使用类似本网站或[此处提供的降价编辑器之类的东西。](http://wmd-editor.com/)将是另一种方法。

还要保留 Page 指令 ValidateRequest=true ，它应该停止在请求中发送标记，当它出现时你当然需要处理这个错误。人们将始终能够使用诸如[Tamper data](https://addons.mozilla.org/en-US/firefox/addon/966)之类的 firefox 扩展将标签注入到请求中，但 ValidateRequest=true 至少应该阻止 ASP.NET 接受它们。

Jeff 最近在这里发表了一篇关于 XSS 攻击的直截了当的帖子。它还涉及使您的 cookie 为 HttpOnly，这是对 cookie 盗窃的半防御。祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T00:59:14.800

我的第一条评论是避免使用 JavaScript 来更改尖括号。绕过这个就像在浏览器中禁用 JavaScript 一样简单。几乎所有服务器端语言都有一些实用方法可以将一些 HTML 字符转换为对应的实体。例如，PHP 使用 htmlentities()，我确信 .NET 有一个等效的实用程序方法。至少，您可以对尖括号、括号和双引号进行正则表达式替换，这将使您朝着安全的解决方案迈进一大步。

# vmware - 用 VMWare Fusion/Server 替换 Virtual PC/Server 用于开发环境

> ID：61775
> 
> 赞同：2
> 
> 时间：2008-09-15T01:14:22.300
> 
> 标签：vmware, virtualization, virtual-pc

我专门在虚拟机上开发。我目前在 MacBook Pro 上运行 Boot Camp，并在一系列适用于许多不同环境的 Virtual PC VM 上进行所有开发。[Andrew Connell](http://www.andrewconnell.com/blog/articles/UseVirtualPCsDifferencingDisksToYourAdvantage.aspx)的这篇文章彻底改变了我的工作方式。

我正在考虑切换到 Fusion 并在 OS X 中运行所有内容，但我无法回答以下有关 VM Fusion/Workstation/Server 的问题。**我需要知道 Virtual PC/Server 的以下功能是否存在于他们的 VMWare 对应部件中。**

1.  差异磁盘（创建基础虚拟机和配置新虚拟机的能力，只需在基础上添加增量[节省大量磁盘空间，并且可以轻松启动具有基本功能集的新虚拟机]）。*（Fusion 不可用，需要工作站 [$189]）*
2.  撤消磁盘（能够在会话中回滚对 VM 的所有更改）。*（适用于 Workstation 和 Fusion [分别为 189 美元/79.99 美元]）*
3.  轻松 NAT 出一个不同的子网供 VM 坐下。*（在 Fusion/Workstation 中）。*
4.  在 VM Player 和 VM Server 之间共享 VM。我想在本地（在 OS X/Fusion 上）构建一个 VM，然后将其移动到某个服务器（Win2k3/Win2k8 和 VM Server）并在那里托管它，但使用 VM Server。*（在 Fusion/Workstation 中）。*
5.  相当于 Hyper-V。*（Fusion 和 Workstation 都为 64x VM 使用了类型 2 管理程序 a，对于 32 位 VM 也没有。VMWare 声称它们并不慢，因为一些[基准测试证实了这一说法](http://www.thehypervisor.com/?p=57)）。*
6.  能够在多个 VM 之间共享磁盘。如果我在虚拟磁盘上有一堆数据库并希望它们出现在多个 VM 上，我应该能够附加它们。*（在 Fusion 和 Workstation 中均可用）*
7.  （很高兴拥有）支持分配给 VM 的多个处理器*（在 Fusion 和 Workstation 中均可用）。*

**是否有一位 VMWare 大师肯定知道上述功能在另一端可用？**

**另外上面的都是免费的（只要你有 Windows 机器的许可证），除了购买 Fusion 还有其他费用吗？**

**我研究的最终结果，非常感谢！** *您只能在 VMWare Workstation（而非 Fusion）中创建链接克隆和完整克隆（靠近差异磁盘）。除了其他难以列举的功能外，Workstation 还具有更好的快照管理功能。话虽如此，Workstation 售价 189 美元（而不是 79 美元），并且在 OS X 上不可用。此外，Fusion 1.1（当前版本）在 OS X 10.5（在 10.4 上运行良好）上有一堆显示错误。这些将在当前位于 (RC1) 中的 Fusion 2.0 中得到解决。我可能会等到 v2.0 发布，然后使用 Workstation/Fusion 在 OS X 上配置和使用这些虚拟机。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T02:49:38.687

至少它没有#1。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T03:03:40.150

我没用过Fusion，只用过工作站和服务器

1) 是的，您可以从当前 vm 状态或 VMware Workstation 中的已保存状态（快照）创建链接克隆

2) 是的，恢复为快照

3) 有许多不同的网络设置，NAT 就是其中之一

4）使用VMware Fusion创建的VMware虚拟机与VMware最新产品完全兼容。

5) ?

6）您可以将预先存在的磁盘添加到其他虚拟机

7) 是的，你创建了多 CPU 虚拟机

工作站成本，但 VMWare 服务器是免费的

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T03:05:25.920

VMWare 服务器是免费的，但只允许一个快照，这是一个严重的缺陷。VMWare Workstation 允许多个快照并且可以执行大部分相同的功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T03:59:16.163

VMWare 有一个 Hypervisior，相当于 Virtual PC 中的 Hyper-V。

您无法将在 Fusion 中创建的 VM 与 Windows VMWare Server（免费版）共享，您需要付费版本才能在两者之间共享。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T19:21:46.517

我还想看看 Sun 的 xVM VirtualBox for Mac。它可以在我的 Mac 上快速运行 Windows XP 和 Vista。

1 和 2）VirtualBox 具有从基础 VM 分支出来的快照，就像一棵树。您可以恢复到任何以前的快照并为其命名。

3) 支持 NAT 和桥接网络，如 VMWare 和 Microsoft 产品。

4) VirtualBox 没有服务器版本，但我知道它与 Qemu 共享一个引擎，因此可以在 Qemu 上托管您的 VBox 图像。

5) 如果您的 Mac 启用了 VT-x，VirtualBox 确实有一个管理程序。

6) 当然，您可以将现有磁盘添加到其他虚拟机。但是你不能同时在多个虚拟机中运行同一个磁盘。（不过，这不是对所有虚拟化主机的限制吗？）

7) 不会。VirtualBox 会给每个图像一个 CPU 并将它们分散开来。

# navision - Microsoft Navison 使用/以何种技术和语言实现？

> ID：61779
> 
> 赞同：2
> 
> 时间：2008-09-15T01:34:04.500
> 
> 标签：navision

Navision 也称为 Microsoft Dynamics NAV。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T18:03:27.617

Navision 的应用程序逻辑是使用一种称为 C/AL 的专有语言编写的，该语言松散地基于 Pascal。它目前提供本地数据库选项以及 MS SQL Server。

下一个版本（NAV 2009）将使用通过 IIS 提供服务的 .NET 程序集。C/AL 逻辑将被转换为 C# 代码并部署到服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T10:19:36.070

NAV 2009 确实使用生成的 .Net 程序集，但它是基于 WCF 的。不需要使用 IIS。除了（Web）服务之外，NAV 2009 不支持与其服务器代码的接口。

NAV 2009 包括使用服务层的新角色定制客户端和直接访问 NAV 数据库服务器的旧经典客户端。

# python - IIS上的python cgi

> ID：61781
> 
> 赞同：0
> 
> 时间：2008-09-15T01:41:31.347
> 
> 标签：python, iis, asp-classic, vbscript, cgi

如何设置 IIS 以便可以从 asp 页面调用 python 脚本？

好的，所以我在这里找到了该问题的答案：[http://support.microsoft.com/kb/276494](http://support.microsoft.com/kb/276494)

继续我的下一个问题：如何从经典的 asp (vb) 代码中调用 cgi 脚本？特别是不在网络根目录中的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T03:58:29.083

你也可以这样[做](http://www.4guysfromrolla.com/webtech/082201-1.shtml)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T20:09:09.530

我不相信 IIS 托管的 VBScript 有任何执行外部进程的方式。如果您使用 python 作为 AXscripting 引擎，那么您可以只使用 sys 模块。如果您调用的脚本实际上是一个 cgi 脚本，您将不得不模仿 cgi 使用的所有环境变量。另一种方法是将脚本放在 python 路径上，导入它并希望它足够模块化，以便您可以调用所需的部分并绕过 cgi 处理代码。

# php - 有没有人试图让 PHP 的系统功能更加面向对象？

> ID：61784
> 
> 赞同：9
> 
> 时间：2008-09-15T01:56:25.630
> 
> 标签：php, oop, wrapper

我只是好奇是否存在任何项目试图将所有（或大部分）PHP 的内置函数组合成一个更加面向对象的类层次结构。例如，将所有字符串函数分组到一个字符串类中，等等。

我意识到这实际上不会解决任何问题（除非修改发生在 PHP 源代码级别），因为所有内置函数仍然可以在全局命名空间中访问，但它肯定会使可用性更容易。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-15T02:06:57.137

次数太多了。一旦有人发现 PHP 具有 OO 特性，他们就想将所有内容都包装在类中。

PHP 中的 OO 内容的重点是，您可以以任何您想要的方式构建您的解决方案。但是将现有函数包装在 Objects 中并没有带来太多回报。

话虽如此，PHP 的核心已经相当面向对象了。看看[SPL](http://www.php.net/~helly/php/ext/spl/)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-15T02:04:00.137

我认为这样的事情对于 PHP 向前发展是不可或缺的。作为一个主要的.Net 程序员，我发现 PHP 使用它的 100 万个和 1 个全局函数很痛苦。PHP 5.3 有命名空间很好，但是当他们自己的库甚至不是面向对象的时候，它并没有多大帮助，更不用说使用命名空间了。我不太介意 PHP 作为一门语言，但他们的 API 非常混乱，可能需要彻底检修。有点像 VB 在成为 VB.Net 时所经历的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T03:21:17.533

要回答您的问题，是的，有几个库完全符合您的要求。至于你想使用哪一个是一个完全不同的问题。PHPClasses 和 pear.org 是开始寻找此类库的好地方。

更新：正如其他人所建议的那样，SPL 是一个很好的库，并且包含了许多内置的 php 函数。但是仍然有很多它没有包装的 php 函数。让我们仍然没有银弹。

在使用诸如 Cakephp 和 Zend（也包括其他框架）之类的框架时，我注意到他们试图通过包含自己的库并在框架中构建数据库连接等基础知识来解决其中的一些问题。所以框架可能是另一种解决方案

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T16:45:16.120

我不同意。面向对象编程本质上并不比过程编程好。我相信你不应该使用 OO，除非你需要多态行为（继承、覆盖方法等）。使用对象作为代码的简单容器是不值得的。*字符串尤其*如此，因为它们被大量使用（例如作为数组键）。每个应用程序通常都可以从一些多态特性中受益，但通常是在高水平上。你会想要扩展一个 String 类吗？

此外，了解 PHP 的奇怪函数命名需要一点历史。PHP 以标准 C 库和 POSIX 标准为基础，并使用许多相同的函数名称（strstr、getcwd、ldap_open 等）。这实际上是一件好事，因为它最大限度地减少了语言绑定代码的数量，确保了一套经过深思熟虑的功能（几乎可以在 C 中做的任何事情都可以在 PHP 中做）并且这些系统库是高度优化的（例如strchr 通常是内联的，这使它快了大约 10 倍）。

# java - IBM JVM 1.4.2 (WebSphere 6.0.2) 的 Java 分析器

> ID：61795
> 
> 赞同：2
> 
> 时间：2008-09-15T02:07:18.383
> 
> 标签：java, websphere, profiler

我正在寻找与 WebSphere 6.0.2 (IBM JVM 1.4.2) 附带的 JVM 配合使用的 Java 分析器。我使用 yourkit 来满足我通常的分析需求，但它特别拒绝使用这个旧的 jvm（我相信作者有他们的理由......）。

任何人都可以指出一个可以完成这项工作的体面的分析器吗？对概要分析器的通用列表不感兴趣，顺便说一句，我已经看过另一个stackoverflow，但我不想一个一个地尝试它们。

如果可能的话，我更喜欢免费版本，因为这是一次性需求（我希望！），我宁愿不为此付费购买另一个分析器。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-11-18T01:28:15.573

旧帖子，但这可能对某人有所帮助。您可以使用免费的[IBM Health Center](http://www.ibm.com/developerworks/java/jdk/tools/healthcenter/)。它可以单独下载，也可以作为[IBM Support Assistant](http://www-01.ibm.com/software/support/isa/)的一部分下载。我建议下载 ISA，因为它有很多其他有用的工具，例如[Garbage Collection and Memory Visualizer](http://www.ibm.com/developerworks/java/jdk/tools/gcmv/)和[Memory Analyzer](https://www-304.ibm.com/support/docview.wss?uid=swg21394814)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T07:46:06.790

你想描述什么？它是 JVM 还是 App Server 中的东西？如果是后者，WAS 6 GUI 中有很多东西可以帮助解决这个问题。假设您真的想查看堆等内容，那么 IBM [HeapAnalyzer](http://alphaworks.ibm.com/tech/heapanalyzer)可能会有所帮助。本页底部还列出了其他工具。

我学到的其他东西，理想情况下，您将能够将 IDE 的分析器连接到正在运行的 JVM。有些允许您对远程服务器以及正在开发的本地服务器执行此操作。您希望实时或远程分析的 JVM？如果是这样，您可能不得不强制转储并将它们从现场环境中取出以查看您的休闲。否则，请在本地设置一些东西并以这种方式从中获取信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T16:21:56.233

更新：我发现[JProfiler](http://www.ej-technologies.com/products/jprofiler/overview.html)与 WAS 6.0.2 (IBM JDK 1.4) 顺利集成。

# java - Struts2 的 Tiles 是否支持 UTF-8 编码的模板？

> ID：61796
> 
> 赞同：0
> 
> 时间：2008-09-15T02:08:06.227
> 
> 标签：java, internationalization, tiles

如果是这样，为磁贴启用 UTF-8 需要哪些配置元素？

我发现我的图块结果发送为：

```
Content-Type    text/html; 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-15T02:57:37.340

如果你把它放在顶部呢？

```
<%@ page contentType="text/html;charset=UTF-8" pageEncoding="UTF-8" language="java" %> 
```

# asp.net-mvc - ASP.NET MVC ViewData（使用索引）

> ID：61805
> 
> 赞同：1
> 
> 时间：2008-09-15T02:25:56.230
> 
> 标签：asp.net-mvc

我有一个使用 ASP.NET MVC Preview 3（从 Preview 2 解决方案升级）的工作解决方案，它使用无类型的 ViewMasterPage，如下所示：

```
public partial class Home : ViewMasterPage 
```

在 Home.Master 上有这样的显示语句：

```
<%= ((GenericViewData)ViewData["Generic"]).Skin %> 
```

但是，团队中的一位开发人员刚刚将程序集引用更改为 Preview 4。

在此之后，代码将不再像上面那样使用索引值填充 ViewData。

相反， ViewData["Generic"] 为空。

根据[这个问题](https://stackoverflow.com/questions/18787/aspnet-mvc-user-control-viewdata)， ViewData.Eval("Generic") 有效，并且 ViewData.Model 也正确填充。

然而，这个解决方案不使用打字页面等的原因是因为它是一种遗留解决方案。因此，通过这个相当大的解决方案并更新所有 .aspx 页面是不切实际的（特别是因为编译器没有检测到这种东西）。

我尝试通过删除引用然后在项目的“bin”文件夹中添加对 Preview 3 程序集的引用来还原程序集。这并没有改变什么。我什至尝试将项目文件恢复到早期版本，但这似乎仍然无法解决问题。

我有其他使用相同技术的解决方案可以继续工作。

关于为什么突然停止工作以及我如何修复它（任何正确方向的提示将不胜感激），您有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T16:04:29.547

We made that change because we wanted a bit of symmetry with the [] indexer. The Eval() method uses reflection and looks into the model to retrieve values. The indexer only looks at items directly added to the dictionary.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T02:45:26.637

我决定用 ViewData.Eval("blah") 替换 ViewData["blah"] 的所有实例。但是，如果可能的话，我想知道这种变化的原因，因为：

1.  如果它发生在我的其他项目中，能够修复它会很好。
2.  保留已部署的工作代码而不用这些更改覆盖会很好。
3.  很高兴知道没有其他我没有注意到的变化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T03:45:53.717

你是如何设置视图数据的？这对我有用：

控制器：

```
ViewData["CategoryName"] = a.Name; 
```

看法：

```
<%= ViewData["CategoryName"] %> 
```

顺便说一句，我现在在 Preview 5 上。但这已经在 3 和 4 上起作用了......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T04:02:04.627

回复：瑞奇

当我从控制器调用 View() 方法时，我只是传递了一个对象。

我还注意到，在未更新任何内容的部署服务器上， ViewData.Eval 失败并且 ViewData["index"] 有效。

On my development server ViewData["index"] fails and ViewData.Eval works...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T14:16:48.067

Yeah, so whatever you pass into the View is accessible in the View as ViewData.Model. But that will be just a good old object if you don't do the strongly typed Views...

# asp.net - ASP.NET 中获取当前域的最佳方法是什么？

> ID：61817
> 
> 赞同：104
> 
> 时间：2008-09-15T03:04:09.447
> 
> 标签：asp.net, asp.net-mvc, domain-name

我想知道在 ASP.NET 中获取当前域的最佳方法是什么？

例如：

[http://www.domainname.com/subdir/](http://www.domainname.com/subdir/)应该产生[http://www.domainname.com](http://www.domainname.com) [http://www.sub.domainname.com/subdir/](http://www.sub.domainname.com/subdir/)应该产生[http://sub.domainname.com](http://sub.domainname.com)

作为指导，我应该能够直接在 URL 上添加一个类似“/Folder/Content/filename.html”的 URL（比如由 ASP.NET MVC 中的 Url.RouteUrl() 生成），它应该可以工作。

* * *

## 回答 #1

> 赞同：189
> 
> 时间：2010-05-20T22:34:17.400

与 MattMitchell 的答案相同，但有一些修改。这将检查默认端口。

> 编辑：更新语法并`Request.Url.Authority`按照建议使用

```
$"{Request.Url.Scheme}{System.Uri.SchemeDelimiter}{Request.Url.Authority}" 
```

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-09-15T03:06:03.513

根据[此链接](http://www.velocityreviews.com/forums/t89365-get-hostdomain-name.html)，一个很好的起点是：

```
Request.Url.Scheme + System.Uri.SchemeDelimiter + Request.Url.Host 
```

但是，如果域是[http://www.domainname.com:500](http://www.domainname.com:500) ，这将失败。

像下面这样的东西很容易解决这个问题：

```
int defaultPort = Request.IsSecureConnection ? 443 : 80;
Request.Url.Scheme + System.Uri.SchemeDelimiter + Request.Url.Host 
  + (Request.Url.Port != defaultPort ? ":" + Request.Url.Port : ""); 
```

但是，端口 80 和 443 将取决于配置。

因此，您应该使用上面来自 Carlos Muñoz`IsDefaultPort`的已[接受答案。](https://stackoverflow.com/a/2878350/364)

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2011-12-31T05:30:03.880

```
Request.Url.GetLeftPart(UriPartial.Authority) 
```

这是包含的方案。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2011-04-30T23:27:49.337

**警告！**对于使用**Current.Request** .Url.Host 的任何人。了解您正在根据当前请求工作，并且当前请求不会始终与您的服务器一起使用，有时可能与其他服务器一起使用。

因此，如果您在 Global.asax 中的 Application_BeginRequest() 之类的地方使用它，那么 99.9% 的情况下它会很好，但 0.1% 的情况下您可能会得到除您自己的服务器主机名之外的其他内容。

我不久前发现的一个很好的例子。我的服务器不时会访问[http://proxyjudge1.proxyfire.net/fastenv 。](http://proxyjudge1.proxyfire.net/fastenv)Application_BeginRequest() 很乐意处理此请求，因此如果您在发出此请求时调用 Request.Url.Host，您将返回 proxyjudge1.proxyfire.net。你们中的一些人可能会想“不，”但值得注意，因为这是一个很难注意到的错误，因为它只发生了 0.1% 的时间：P

这个错误迫使我将我的域名主机作为字符串插入到配置文件中。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2011-07-17T23:38:24.273

为什么不使用

`Request.Url.Authority`

它返回整个域和端口。

您仍然需要计算 http 或 https

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-08-20T02:36:56.183

**简单**而**简短**的方法（它支持模式、域和端口）：

## **采用`Request.GetFullDomain()`**

```
// Add this class to your project
public static class HttpRequestExtensions{
    public static string GetFullDomain(this HttpRequestBase request)
    {
        var uri= request?.UrlReferrer;
        if (uri== null)
            return string.Empty;
        return uri.Scheme + Uri.SchemeDelimiter + uri.Authority;
    }
}

// Now Use it like this:
Request.GetFullDomain();
// Example output:    https://example.com:5031
// Example output:    http://example.com:5031 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T15:40:13.513

怎么样：

```
NameValueCollection vars = HttpContext.Current.Request.ServerVariables;
string protocol = vars["SERVER_PORT_SECURE"] == "1" ? "https://" : "http://";
string domain = vars["SERVER_NAME"];
string port = vars["SERVER_PORT"]; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-02-24T15:00:37.317

其他方式：

```
 string domain;
Uri url = HttpContext.Current.Request.Url;
domain= url.AbsoluteUri.Replace(url.PathAndQuery, string.Empty); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-09-20T06:25:33.927

在**Asp.Net Core 3.1**中，如果您想获得完整的域，您需要执行以下操作：

第 1 步：定义变量

```
private readonly IHttpContextAccessor _contextAccessor; 
```

第 2 步：DI 进入构造函数

```
public SomeClass(IHttpContextAccessor contextAccessor)
{
    _contextAccessor = contextAccessor;
} 
```

第 3 步：在您的类中添加此方法：

```
private string GenerateFullDomain()
{
    string domain = _contextAccessor.HttpContext.Request.Host.Value;
    string scheme = _contextAccessor.HttpContext.Request.Scheme;
    string delimiter = System.Uri.SchemeDelimiter;
    string fullDomainToUse = scheme + delimiter + domain;
    return fullDomainToUse;
}
//Examples of usage GenerateFullDomain() method:
//https://example.com:5031
//http://example.com:5031 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-04-01T07:28:13.543

使用 UriBuilder：

```
 var relativePath = ""; // or whatever-path-you-want
    var uriBuilder = new UriBuilder
    {
        Host = Request.Url.Host,
        Path = relativePath,
        Scheme = Request.Url.Scheme
    };

    if (!Request.Url.IsDefaultPort)
        uriBuilder.Port = Request.Url.Port;

    var fullPathToUse = uriBuilder.ToString(); 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-15T03:14:04.697

怎么样：

```
String domain = "http://" + Request.Url.Host 
```

# iphone - 我需要释放xib资源吗？

> ID：61838
> 
> 赞同：37
> 
> 时间：2008-09-15T03:51:30.660
> 
> 标签：iphone, objective-c, cocoa-touch

如果我有类似 UILabel 链接到 xib 文件的东西，我是否需要在视图的 dealloc 上释放它？我问的原因是因为我不分配它，这让我觉得我也不需要释放它？例如（在标题中）：

```
IBOutlet UILabel *lblExample; 
```

在实施中：

```
....
[lblExample setText:@"whatever"];
....

-(void)dealloc{
    [lblExample release];//?????????
} 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-10T15:41:00.363

如果您遵循现在被认为是最佳实践的方法，您*应该*释放出口属性，因为您应该将它们保留在 set 访问器中：

```
@interface MyController : MySuperclass {
    Control *uiElement;
}
@property (nonatomic, retain) IBOutlet Control *uiElement;
@end

@implementation MyController

@synthesize uiElement;

- (void)dealloc {
    [uiElement release];
    [super dealloc];
}
@end 
```

这种方法的优点是它使内存管理语义明确而清晰，*并且它可以在所有平台上对所有 nib 文件一致地工作*。

注意：以下注释仅适用于 3.0 之前的 iOS。在 3.0 及更高版本中，您应该简单地将 viewDidUnload 中的属性值归零。

但是，这里的一个考虑因素是，您的控制器可能会处理其用户界面并根据需要动态重新加载它（例如，如果您有一个视图控制器从 nib 文件加载视图，但应请求 - 比如说在内存压力下-- 释放它，期望在再次需要视图时可以重新加载它）。在这种情况下，您要确保当主视图被处置时，您也放弃任何其他出口的所有权，以便它们也可以被解除分配。对于 UIViewController，您可以通过以下方式覆盖来处理此问题`setView:`：

```
- (void)setView:(UIView *)newView {
    if (newView == nil) {
        self.uiElement = nil;
    }
    [super setView:aView];
} 
```

不幸的是，这引发了另一个问题。因为 UIViewController 当前`dealloc`使用`setView:`访问器方法实现其方法（而不是简单地直接释放变量），`self.anOutlet = nil`将被调用`dealloc`以及响应内存警告......这将导致`dealloc`.

补救措施是确保出口变量也设置为`nil`in `dealloc`：

```
- (void)dealloc {
    // release outlets and set variables to nil
    [anOutlet release], anOutlet = nil;
    [super dealloc];
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T06:47:20.910

我在 Apple 文档中找到了我想要的东西。简而言之，您可以将对象设置为您释放和保留的属性（或只是@property、@synthesize），但您不必为 UILabel 之类的东西：

[http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/LoadingResources/CocoaNibs/chapter_3_section_4.html#//apple_ref/doc/uid/10000051i-CH4-SW18](http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/LoadingResources/CocoaNibs/chapter_3_section_4.html#//apple_ref/doc/uid/10000051i-CH4-SW18)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T01:26:52.467

这

```
[anOutlet release], anOutlet = nil; 
```

如果您正确编写了 setView: 部分，则完全是多余的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-19T11:05:49.990

如果你不在 dealloc 上释放它，它会增加内存占用。

[使用仪器 ObjectAlloc 图在此处查看更多详细信息](http://amanpages.com/iphone-app-development-core-sdk-cocoa/iphone-iboutlet-should-be-released-manually/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T03:58:02.033

相关：[使用 Cocoa / Objective C 理解引用计数](https://stackoverflow.com/questions/6578/understanding-reference-counting-with-cocoa-objective-c)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T04:49:13.640

在某种意义上，您通过在 IB 中创建标签来分配标签。

IB 所做的是查看您的 IBOutlets 以及它们是如何定义的。如果您有一个类变量，IB 要为某个对象分配引用，IB 将为您向该对象发送一条保留消息。

如果您使用属性，IB 将使用您必须设置值的属性，而不是显式保留该值。因此，您通常会将 IBOutlet 属性标记为保留：

```
@property (nonatomic, retain) UILabel *lblExample; 
```

因此在以太情况下（使用或不使用属性）你应该在你的dealloc中调用release。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T13:44:15.273

作为 Nib 主视图的子视图的任何 IBOutlet 都不需要释放，因为它们将在对象创建时发送自动释放消息。您需要在 dealloc 中释放的唯一 IBOutlet 是顶级对象，如控制器或其他 NSObject。这在上面链接的 Apple 文档中都提到了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-04-13T04:28:13.523

If you dont set the IBOutlet as a property but simply as a instance variable, you still must release it. This is because upon initWithNib, memory will be allocated for all IBOutlets. So this is one of the special cases you must release even though you haven't retained or alloc'd any memory in code.

# c# - 有没有办法异步过滤 IList？

> ID：61850
> 
> 赞同：3
> 
> 时间：2008-09-15T04:07:11.370
> 
> 标签：c#, javascript, ajax, .net-3.5, repeater

好的，所以必须有办法做到这一点......不是吗？如果不是，我会喜欢一些想法。

我在更新面板中有两个中继器和一个图像，以及一些带有左侧链接按钮的 AJAX 下拉列表。我想尽快更新更新面板中的数据，因为从下拉列表中选择了值。

您认为更新数据的最佳方式是什么？转发器由对象填充，所以如果我可以通过一些属性过滤对象，我最终可以得到正确的数据。不需要来自服务器的新数据。

有人有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T04:25:18.970

据我所知，在客户端获取数据和数据绑定转发器并不容易。但是，您可能想[检查一下](http://dotnetslackers.com/articles/ajax/ASPNETRepeater.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T17:05:01.377

仅使用您自己的更新面板包装您想要重新绑定的中继器。执行此操作时传输的唯一视图状态是更新面板内的部分。您可能必须使用面板的触发器和更新模式才能使所有内容都能正常播放。

另一种选择是不使用中继器，而是将您的对象序列化为 XML，然后编写一个页面方法，该方法使用 xsl 返回转换后的数据的 html 字符串。然后客户端调用您的路径方法并根据需要更新 DOM。

第三种选择是使用服务引用/页面方法来返回 JSON 对象并手动更新 DOM。

[http://www.asp.net/AJAX/Documentation/Live/tutorials/ASPNETAJAXWebServicesTutorials.aspx](http://www.asp.net/AJAX/Documentation/Live/tutorials/ASPNETAJAXWebServicesTutorials.aspx)

祝你好运！3个我都做了

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-08T05:31:05.327

If your data is already rendered to the screen, you can access the dom and manipulate the dom and hide/remove the ones you want. I've done this with jquery, but the same should be possible with ASP.NET Ajax library.

# .net - 有人将 WPF 用于真正的 LOB 应用程序吗？

> ID：61853
> 
> 赞同：13
> 
> 时间：2008-09-15T04:24:55.713
> 
> 标签：.net, wpf

有人将 WPF 用于真正的 LOB 应用程序吗？

我们都看过 WPF 的巧妙演示，展示了映射到 3D 元素的视频。这些看起来很棒，但是构成大多数开发人员工作的业务线应用程序的真实世界呢？WPF 只是为了好看吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-15T04:34:25.643

在我们讨论它时，聪明人正在构建令人惊叹的应用程序：

[Lawson Smart Office 为企业带来 WPF 的好处](http://channel9.msdn.com/shows/Continuum/LawsonSmartOffice/)

[IGT 的下一代 UI 与 WPF](http://windowsclient.net/learn/video.aspx?v=48556)

[Billy Hollis 谈如何使用 WPF 变得更聪明](http://www.dnrtv.com/default.aspx?showNum=115)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-15T21:10:49.630

只需将 WPF LOB 应用程序推广到大约 400 个市政地点。在视觉上不重，但对数据绑定非常重。
WPF 是为 LOB 定制的！最近在 SP1 中修复了许多缺点（即没有重构），但是委婉地说，工具仍然存在缺陷。
看到 XAML 是为了简化工具而发明的，我觉得很讽刺。
要使用 WPF，您确实需要了解 WPF 对象模型中的一些基础知识，而且我认为设计人员/开发人员工作流程不会很快发生。
学习曲线非常陡峭，但值得。
过去巨大的任务现在变得微不足道，相反，过去非常简单的任务几乎是不可能的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T05:37:07.613

我在[这个设置](http://www.avt-inc.com/workflow.asp?cid=2)中研究了 Helios 产品。WPF 在许多其他东西之上，包括 C++。

如果您在 .NET 中进行开发并想要一个具有高度自定义 UI 的智能客户端应用程序，我会推荐 WPF。如果您正在考虑使用简单的 Windows 用户界面，请使用 Windows 窗体。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T04:37:52.437

我是一个丹麦架构组的成员，其中许多成员只专注于构建 WinForms 应用程序（我自己就是一个网络人）。在我们的会议期间，在 Winforms 与 WPF 中构建 Windows 应用程序的主题已经出现了很多次，每次经过多次讨论后得出的结论是 WPF 确实允许您构建一些非常漂亮的应用程序，因为它们适用于 WinForms在这一点上失去太多的生产力。

坚持使用 Winforms 的主要原因是工具。不过他们正在改进。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-19T03:30:34.140

IMO WPF 刚刚开始成为真正的软件公司的可行路径。必须维护现有安装基础的公司现在才在他们的下一代项目中轻松进入 .net 3.5，并且正在考虑作为 WPF 的一部分。

我认为真正的问题是 WPF 不适用于 Web 应用程序，它不适用于分布式应用程序，因此将其推向市场需要更长的时间。.net 3.5 可能用于许多托管的 Web 应用程序，但它刚刚开始出现在分布式应用程序中，以及 WCF、WPF 等。

我会争辩说，在接下来的 2 年内，您会看到许多 WPF 应用程序弹出......我们现在正在开发 WPF 应用程序以用于后端银行处理 - 所以是的，它是可行的并且被用于真正的应用程序 - 它们可能还没有推出;)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T04:34:20.230

我觉得眼睛糖果演示主要针对设计师。话虽如此，使用 WPF 在提高 LOB 应用程序的可用性方面存在巨大潜力。[查看这篇关于 Silverlight 潜力的文章](http://www.ddj.com/windows/210300284)。

*业务线应用程序以只做生意而没有乐趣而臭名昭著。事实上，在开发业务线 (LOB) 应用程序时，“用户体验”从未真正成为最关心的问题。虽然许多 LOB 风格的应用程序越来越重视可用性，但它们往往缺乏吸引力。用户体验实际上是可用性和吸引力的结合。*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T04:36:33.453

我们已经开始在主应用程序的外围设备中使用它，有点像 POC 和学习机会。

看起来不错，但我们这里只有 1 位图形艺术家过度劳累，没有他，WPF 应用程序在图形上仍然看起来像开发人员设计的应用程序。

除了我们的编码人员不是图形化的之外，我们在很大程度上仍在 WPF 中构建表单应用程序，而不是充分利用 WPF 的强大功能。我相信我们可以用更多的资源和更多的经验创造奇迹，我期待着这样做。

我们也在考虑使用 Silverlight 来安抚老板的信念，即在表单应用程序中没有什么是不能在 Web 上完成的。这是一条危险的路线，因为他可能开始相信他是对的，而我们都只是在抱怨什么（实际上，他已经这样做了:)）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T04:37:20.957

我的一个朋友使用 WPF 进行了一些非常酷的树（如在树视图中）渲染，它比显示简单的滑动视图要好一点。我也许可以说服他把它放到公共领域或其他东西上。

# c# - Web 控件属性

> ID：61861
> 
> 赞同：1
> 
> 时间：2008-09-15T04:38:47.427
> 
> 标签：c#, asp.net

我想让我的 web 控件在设计模式下更具可读性，基本上我希望标签声明看起来像：

```
<cc1:Ctrl ID="Value1" runat="server">        
     <Values>string value 1</Value>
     <Values>string value 2</Value>
</cc1:Ctrl> 
```

假设我在后面的代码中有一个私有变量：

```
List<string> values = new List<string>(); 
```

那么如何让我的用户控件使用标记中声明的值填充私有变量呢？

* * *

对不起，我应该更明确。基本上我喜欢 ITemplate 提供的功能（[http://msdn.microsoft.com/en-us/library/aa719834.aspx](http://msdn.microsoft.com/en-us/library/aa719834.aspx)）

但是在这种情况下，您需要在运行时知道可以实例化多少模板，即

```
void Page_Init() {
if (messageTemplate != null) {
    for (int i=0; i<5; i++) {
        MessageContainer container = new MessageContainer(i);
        messageTemplate.InstantiateIn(container);
        msgholder.Controls.Add(container);
    }
} 
```

}

在给定的示例中，标记如下所示：

```
<acme:test runat=server>
   <MessageTemplate>
    Hello #<%# Container.Index %>.<br>
   </MessageTemplate>
</acme:test> 
```

它既漂亮又干净，它没有任何标签前缀等。我真的想要漂亮干净的标签。

我希望标记干净可能很愚蠢，我只是想知道是否有一些简单的东西我遗漏了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T12:59:31.233

我认为您正在搜索的是属性：

```
[PersistenceMode(PersistenceMode.InnerProperty)] 
```

[持久模式](http://msdn.microsoft.com/en-us/library/system.web.ui.persistencemode.aspx)

请记住，您必须使用以下命令注册名称空间和前缀：

```
<%@ Register Namespace="MyNamespace" TagPrefix="Pref" %> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T06:02:08.520

我看到两个选项，但都取决于您的 Web 控件为您的值实现某种集合。第一个选项是只使用控件的集合而不是您的私有变量。另一种选择是在运行时将控件的集合复制到您的私有变量中（例如，可能在 Page_Load 事件处理程序中）。

假设您有实现项目集合的 Web 控件，例如列表框。标签在源代码视图中如下所示：

```
 <asp:ListBox ID="ListBox1" runat="server">
        <asp:ListItem>String 1</asp:ListItem>
        <asp:ListItem>String 2</asp:ListItem>
        <asp:ListItem>String 3</asp:ListItem>
    </asp:ListBox><br /> 
```

然后你可以使用这样的代码来加载你的私有变量：

```
 List<String> values = new List<String>();

        foreach (ListItem item in ListBox1.Items)
        {
            values.Add(item.Value.ToString());
        } 
```

如果您在 Page_Load 中执行此操作，您可能只想在初始加载时执行（即不在回发时）。另一方面，根据您的使用方式，您可以只使用 ListBox1.Items 集合，而不是声明和初始化 values 变量。

我想不出以声明方式执行此操作的方法（因为无论如何您的列表直到运行时才会被实例化）。

# linq - 集合中的项目总和

> ID：61870
> 
> 赞同：72
> 
> 时间：2008-09-15T04:53:37.827
> 
> 标签：linq, sum

使用 LINQ to SQL，我有一个带有 OrderDetails 集合的 Order 类。Order Details 有一个名为 LineTotal 的属性，它获取 Qnty x ItemPrice。

我知道如何对数据库进行新的 LINQ 查询以查找订单总额，但是由于我已经从数据库中收集了 OrderDetails，是否有一种简单的方法可以直接从集合中返回 LineTotal 的总和？

我想将订单总额添加为我的 Order 类的属性。我想我可以遍历集合并为每个 Order.OrderDetail 计算总和，但我猜有更好的方法。

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2008-09-15T05:02:40.037

您可以执行 LINQ to Objects 并使用 LINQ 计算总数：

```
decimal sumLineTotal = (from od in orderdetailscollection
select od.LineTotal).Sum(); 
```

您也可以使用 lambda 表达式来执行此操作，这有点“干净”。

```
decimal sumLineTotal = orderdetailscollection.Sum(od => od.LineTotal); 
```

然后，如果需要，您可以像这样将其连接到您的 Order 类：

```
Public Partial Class Order {
  ...
  Public Decimal LineTotal {
    get {
      return orderdetailscollection.Sum(od => od.LineTotal);
    }
  }
} 
```

# unix - 如何仅在错误输出上使用寻呼机（更多/更少）

> ID：61871
> 
> 赞同：3
> 
> 时间：2008-09-15T04:55:08.633
> 
> 标签：unix

我有一个同时吐出标准错误和标准输出的程序，我想在标准错误上少运行我的寻呼机，但*忽略*标准输出。我怎么做？

更新：

就是这样......我不想失去标准输出......只是让它远离寻呼机

```
program 2>&1 >log | less 
```

然后稍后

```
less log 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T04:56:32.283

您可以尝试将标准输出重定向到 /dev/null，但将标准错误重定向到标准输出过去的位置。

ksh/bash 中的示例：

```
program 2>&1 >/dev/null | less 
```

这里的重定向 2>&1 将文件描述符 2 (stderr) 设置为指向与文件描述符 1 (stdout) 相同的流，在重定向 >/dev/null**之前**进行评估，它将文件描述符 1 设置为指向 /dev /空值。效果是您写入 stderr 的内容被发送到 stdout，而您写入 stdout 的内容被丢弃。

# sql-server - 使用浮点数或小数记账应用美元金额？

> ID：61872
> 
> 赞同：76
> 
> 时间：2008-09-15T04:55:25.717
> 
> 标签：sql-server, vb.net, database-design, currency, accounting

我们正在用 VB.NET 和 SQL Server 重写我们的旧[会计系统](https://en.wikipedia.org/wiki/Accounting_information_system)。我们引入了一个新的 .NET/SQL 程序员团队来进行重写。大多数系统已经使用浮点数完成了美元金额。我编程的遗留系统语言没有浮点数，所以我可能会使用小数。

你的建议是什么？

是否应该将浮点数或小数数据类型用于美元金额？

两者都有哪些优点和缺点？

[在我们的每日例会](https://en.wikipedia.org/wiki/Scrum_%28software_development%29#Daily_scrum)*中*提到的一个缺点是，当您计算返回超过两位小数的结果的金额时，您必须小心。听起来您必须将金额四舍五入到小数点后两位。

另一个*缺点*是所有显示和打印的金额都必须有一个*格式声明*，显示两位小数。我注意到有几次没有这样做，而且金额看起来不正确。（即 10.2 或 10.2546）

*专业人士*是仅浮点方法在磁盘上占用 8 个字节，而十进制将占用 9 个字节（十进制 12,2）。

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2008-09-15T20:35:25.350

> 是否应该将浮点数或小数数据类型用于美元金额？

答案很简单。从不漂浮。*从来没有*！

浮点数始终根据[IEEE 754](http://ieeexplore.ieee.org/xpl/mostRecentIssue.jsp?punumber=4610933)二进制，只有新标准[IEEE 754R](http://www.intel.com/technology/itj/2007/v11i1/s2-decimal/1-sidebar.htm)定义的十进制格式。许多小数二进制部分永远不能等于精确的十进制表示。

任何二进制数都可以写成`m/2^n`( `m`,`n`正整数)，任何十进制数都可以写成`m/(2^n*5^n)`。由于二进制缺少素数`factor 5`，所有二进制数都可以用小数精确表示，反之则不行。

```
0.3 = 3/(2^1 * 5^1) = 0.3

0.3 = [0.25/0.5] [0.25/0.375] [0.25/3.125] [0.2825/3.125]

          1/4         1/8         1/16          1/32 
```

因此，您最终会得到一个高于或低于给定十进制数的数字。总是。

为什么这很重要？四舍五入。

正常舍入意味着向下 0..4，向上 5..9。所以结果是……还是……你可能知道这意味着 5 美分，但计算机不知道这一点，然后四舍五入*……*向下（错误）和……向上（正确）。`0.049999999999``0.0500000000``0.4999``0.5000`

鉴于浮点计算的结果总是包含小的误差项，这个决定纯属运气。如果你想用二进制数进行十进制四舍五入处理，那就没有希望了。

不服气？您坚持认为在您的帐户系统中一切正常吗？资产和负债相等吗？好的，然后获取每个条目的每个给定的格式化数字，解析它们并用独立的十进制系统对它们求和！

将其与格式化的总和进行比较。哎呀，有点不对劲，不是吗？

> 对于该计算，需要极高的准确性和保真度（我们使用了 Oracle 的 FLOAT），以便我们可以记录“十亿分之一便士”的计算结果。

它无助于解决此错误。因为所有人都会自动假设计算机的总结是正确的，几乎没有人独立检查。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2010-10-23T00:04:15.977

这张照片回答：

![照片1,CO](https://i.stack.imgur.com/RqaoR.jpg)

这是另一种情况：[*来自北安普顿的男子收到一封信，说如果他不支付零美元和零美分，他的家就会被没收！*](http://web.archive.org/web/20120731044947/http://www.wwlp.com/dpp/news/i_team/I-Team:Man-gets-a-$0-foreclosure-notice)

![照片2,CO](https://i.stack.imgur.com/ssMtJ.jpg)

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-15T08:04:29.070

首先，您应该阅读*[每个计算机科学家应该了解的关于浮点运算](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.6768 "每个计算机科学家都应该知道的关于浮点运算的知识")*的知识。那么你真的应该考虑使用某种类型的[定点/任意精度数字](http://en.wikipedia.org/wiki/Arbitrary-precision_arithmetic)包（例如，Java BigNum 或 Python 十进制模块）。否则，你将进入一个受伤的世界。然后弄清楚使用原生 SQL 十进制类型是否足够。

浮点数和双精度数的存在 (ed) 以公开现在几乎已经过时的快速[x87 浮点协处理器。](https://en.wikipedia.org/wiki/Intel_8087)如果您关心计算的准确性和/或不完全弥补它们的局限性，请不要使用它们。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-15T13:21:45.983

作为附加警告，SQL Server 和 .NET 框架使用不同的默认算法进行舍入。确保检查 Math.Round() 中的 MidPointRounding 参数。.NET 框架默认使用[银行家的舍入](https://en.wikipedia.org/wiki/Rounding#Round_half_to_even)，SQL Server 使用对称算法舍入。[在此处](http://en.wikipedia.org/wiki/Rounding)查看 Wikipedia 文章。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-15T05:22:12.970

问问你的会计师！他们会因为你使用浮动而对你皱眉。就像[大卫辛格说的那样，](https://stackoverflow.com/questions/61872/use-float-or-decimal-for-accounting-application-dollar-amount/61878#61878)*只有*在你不关心准确性的情况下才使用浮点数。尽管在金钱方面我总是反对它。

在会计软件中是*不可接受*的浮点数。使用带四个小数点的小数。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-15T09:59:38.997

浮点数有意想不到的无理数。

例如，您不能将 1/3 存储为小数，它将是 0.3333333333...（等等）

浮点数实际上存储为二进制值和 2 指数的幂。

所以 1.5 存储为 3 x 2 到 -1（或 3/2）

使用这些以 2 为底的指数会创建一些奇数的无理数，例如：

将 1.1 转换为浮点数，然后再次将其转换回来，您的结果将类似于：1.0999999999989

这是因为 1.1 的二进制表示实际上是 154811237190861 x 2^-47，超过了 double 可以处理的范围。

有关此问题的更多信息，请参阅[我的博客](http://bizvprog.blogspot.com/2008/05/floating-point-numbers-more-inaccurate.html)，但基本上，对于存储，您最好使用小数。

在 Microsoft SQL 服务器上，您有`money`数据类型 - 这通常最适合金融存储。精确到小数点后 4 位。

对于计算，您会遇到更多问题 - 不准确性只是很小的一部分，但将其放入幂函数中，它很快就会变得很重要。

然而，小数对于任何类型的数学都不是很好——例如，没有对小数幂的原生支持。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-09T16:42:15.453

这里有一点背景......

没有数字系统可以准确地处理所有实数。所有这些都有其局限性，这包括标准的 IEEE 浮点数和有符号十进制数。IEEE 浮点数每使用一位更准确，但这并不重要。

财务数字基于几个世纪以来的纸笔实践以及相关的惯例。它们相当准确，但更重要的是，它们是可重现的。使用不同数字和费率的两位会计师应该得出相同的数字。任何差异的空间都是欺诈的空间。

因此，对于财务计算，正确的答案是给出与擅长算术的注册会计师相同的答案。这是十进制算术，而不是 IEEE 浮点数。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-11-03T01:00:38.323

使用 SQL Server 的**小数**类型。

不要使用*金钱*或*浮动*。

*money*使用四位小数并且比使用小数更快，***但是***在舍入方面存在一些明显和不那么明显的问题（[请参阅此连接问题](http://groups.google.com/group/microsoft.public.sqlserver.server/browse_thread/thread/e19bf068e208dd5b/f79e614829931537?hl=en&lnk=st&q=author%3Akass+money+accuracy&pli=1)）。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-11-03T01:08:31.567

我建议使用 64 位整数，以美分存储整个事物。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-15T04:58:44.367

浮点数不是精确的表示，可能存在精度问题，例如在添加非常大和非常小的值时。这就是为什么建议将小数类型用于货币，即使精度问题可能非常罕见。

澄清一下，十进制 12,2 类型将准确存储这 14 位数字，而浮点数不会，因为它在内部使用二进制表示。例如，0.01 不能用浮点数精确表示 - 最接近的表示实际上是 0.0099999998

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-15T05:00:04.067

使用 Float 赚钱的唯一原因是如果您不关心准确的答案。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-15T10:42:26.897

对于我帮助开发的银行系统，我负责系统的“应计利息”部分。每天，我的代码都会计算当天余额中累积（赚取）的利息。

对于该计算，需要极高的准确性和保真度（我们使用了 Oracle 的 FLOAT），因此我们可以记录应计的“十亿分之一”。

当涉及“资本化”利息（即，将利息支付回您的账户）时，金额被四舍五入到美分。帐户余额的数据类型为小数点后两位。（事实上​​它更复杂，因为它是一个多币种系统，可以在许多小数位上工作——但我们总是四舍五入到该货币的“便士”）。是的-那里有损失和收益的“分数”，但是当计算机数字被实现（支付或支付的钱）时，它总是真实的货币价值。

这让会计师、审计师和测试人员感到满意。

因此，请与您的客户核实。他们会告诉你他们的银行/会计规则和惯例。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-16T09:58:31.783

比使用小数更好的是只使用普通的旧整数（或者可能是某种 bigint）。这样，您始终可以获得尽可能高的精度，但可以指定精度。例如，数字`100`可能意味着`1.00`，其格式如下：

```
int cents = num % 100;
int dollars = (num - cents) / 100;
printf("%d.%02d", dollars, cents); 
```

如果您想获得更高的精度，可以将 100 更改为更大的值，例如：10 ^ n，其中 n 是小数位数。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-02-09T16:55:22.927

在会计系统中您应该注意的另一件事是，任何人都不应直接访问表。这意味着对会计系统的所有访问都必须通过[存储过程](https://en.wikipedia.org/wiki/Stored_procedure)。

这是为了防止欺诈，而不仅仅是[SQL 注入](https://en.wikipedia.org/wiki/SQL_injection)攻击。想要进行欺诈的内部用户永远不应该直接更改数据库表中的数据。这是您系统的关键内部控制。

你真的想让一些心怀不满的员工去你的数据库后端，让它开始给他们写支票吗？或者当他们没有批准权限时隐藏他们批准了未经授权的供应商的费用？整个组织中只有两个人应该能够直接访问您的财务数据库中的数据，即您的数据库管理员 (DBA) 和他的备份。如果您有许多 DBA，则只有其中两个应该具有此访问权限。

我提到这一点是因为如果你的程序员在会计系统中使用浮点数，他们可能完全不熟悉内部控制的概念，并且在他们的编程工作中没有考虑到它们。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-21T06:12:24.020

您总是可以为 .NET 编写类似 Money 类型的东西。

看看这篇文章：[CLR 的 Money 类型](http://www.codeproject.com/KB/recipes/MoneyTypeForCLR.aspx)。在我看来，作者的工作非常出色。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-02-09T14:09:47.690

我一直在使用 SQL 的货币类型来存储货币值。最近，我不得不使用许多在线支付系统，并注意到其中一些使用整数来存储货币值。在我当前和新的项目中，我已经开始使用整数，我对这个解决方案非常满意。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2010-10-21T20:19:27.063

在 n/100 的 100 个分数中，其中 n 是一个自然数，使得 0 <= n 且 n < 100，只有四个可以表示为浮点数。看看这个 C 程序的输出：

```
#include <stdio.h>

int main()
{
    printf("Mapping 100 numbers between 0 and 1 ");
    printf("to their hexadecimal exponential form (HEF).\n");
    printf("Most of them do not equal their HEFs. That means ");
    printf("that their representations as floats ");
    printf("differ from their actual values.\n");
    double f = 0.01;
    int i;
    for (i = 0; i < 100; i++) {
        printf("%1.2f -> %a\n",f*i,f*i);
    }
    printf("Printing 128 'float-compatible' numbers ");
    printf("together with their HEFs for comparison.\n");
    f = 0x1p-7; // ==0.0071825
    for (i = 0; i < 0x80; i++) {
        printf("%1.7f -> %a\n",f*i,f*i);
    }
    return 0;
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-15T04:59:07.877

您是否考虑过使用货币数据类型来存储美元金额？

关于十进制多占用一个字节的缺点，我想说不要关心它。在 100 万行中，您只会多使用 1 MB，而且现在存储非常便宜。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-15T04:59:18.640

无论您做什么，都需要注意舍入错误。使用比您显示的精度更高的精度进行计算。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-15T13:19:10.670

您可能希望对货币值使用某种形式的定点表示。您还需要调查[庄家的四舍五入](https://en.wikipedia.org/wiki/Rounding#Round_half_to_even)（也称为“四舍五入”）。它避免了通常的“四舍五入”方法中存在的偏差。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-15T12:48:31.413

你的会计师会想要控制你如何四舍五入。使用 float 意味着您将不断舍入，通常使用`FORMAT()`类型语句，这不是您想要的方式（使用`floor`/`ceiling`代替）。

您有货币数据类型 ( `money`, `smallmoney`)，应该使用它而不是浮点数或实数。存储小数 (12,2) 将消除您的四舍五入，但也会在中间步骤中消除它们 - 这在金融应用程序中根本不是您想要的。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-15T12:50:46.510

始终使用十进制。由于舍入问题，浮点数会给你不准确的值。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-15T12:55:35.377

浮点数*只能*表示为底数的负倍数之和的数字 - 对于二进制浮点，当然是二。

二进制浮点中只有四个可以精确表示的小数：0、0.25、0.5 和 0.75。其他一切都是近似值，就像 0.3333... 是十进制算术中 1/3 的近似值一样。

对于结果的规模很重要的计算，浮点是一个不错的选择。如果您试图精确到小数位数，这是一个糟糕的选择。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2010-10-23T01:58:43.530

这是一篇很好的文章，描述了[何时使用 float 和 decimal](http://sqlblog.com/blogs/hugo_kornelis/archive/2007/10/17/so-called-exact-numerics-are-not-at-all-exact.aspx)。Float 存储一个近似值，decimal 存储一个精确值。

总之，像金钱这样的精确值应该使用小数，而像科学测量这样的近似值应该使用浮点数。

这是一个有趣的例子，它表明 float 和 decimal 都能够丢失精度。当添加一个不是整数的数字然后减去相同的数字时，浮点数会导致精度丢失，而小数则不会：

```
 DECLARE @Float1 float, @Float2 float, @Float3 float, @Float4 float; 
    SET @Float1 = 54; 
    SET @Float2 = 3.1; 
    SET @Float3 = 0 + @Float1 + @Float2; 
    SELECT @Float3 - @Float1 - @Float2 AS "Should be 0";

Should be 0 
---------------------- 
1.13797860024079E-15 
```

当乘以一个非整数并除以相同的数字时，小数会失去精度，而浮点数不会。

```
DECLARE @Fixed1 decimal(8,4), @Fixed2 decimal(8,4), @Fixed3 decimal(8,4); 
SET @Fixed1 = 54; 
SET @Fixed2 = 0.03; 
SET @Fixed3 = 1 * @Fixed1 / @Fixed2; 
SELECT @Fixed3 / @Fixed1 * @Fixed2 AS "Should be 1";

Should be 1 
--------------------------------------- 
0.99999999999999900 
```

# power-management - 高能效软件编码

> ID：61882
> 
> 赞同：42
> 
> 时间：2008-09-15T05:06:05.567
> 
> 标签：power-management, embedded

在典型的手持/便携式嵌入式系统设备中，电池寿命是硬件、软件和设备可以支持的功能设计中的一个主要问题。从软件编程的角度来看，人们知道 MIPS、内存（数据和程序）优化代码。我知道 H/W 深度睡眠模式、待机模式，它们用于以较低的周期为硬件提供时钟，或者将时钟完全转到一些未使用的 circutis 以节省电力，但我正在从这个角度寻找一些想法：

在我的代码正在运行并且需要继续执行的情况下，鉴于此，我如何才能有效地编写代码“电源”以消耗最少的功率？

是否有任何特殊的编程结构、数据结构、控制结构，我应该查看它们以实现给定功能的最低功耗。

在代码结构设计时或在低级设计期间是否应牢记任何软件高级设计注意事项以使代码尽可能节能（最低功耗）？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-15T05:42:28.320

*   就像`1800 INFORMATION`说的那样，避免轮询；订阅事件并等待它们发生
*   仅在必要时更新窗口内容 - 让系统决定何时重绘它
*   更新窗口内容时，确保您的代码尽可能少地重新创建无效区域
*   使用快速代码，CPU 可以更快地返回深度睡眠模式，并且此类代码更有可能保留在 L1 缓存中
*   一次对小数据进行操作，因此数据也保留在缓存中
*   确保您的应用程序在后台时不会执行任何不必要的操作
*   让您的软件不仅节能，而且具有电源意识 - 在使用电池时减少更新图形、禁用动画、减少硬盘抖动

并阅读其他一些[指南](https://software.intel.com/en-us/articles/partner-energy-efficient-software-guidelines)。;)

最近，英特尔软件博客上开始出现一系列名为[“为电源优化软件应用程序”的帖子。](http://software.intel.com/en-us/search/site/field_tags/software-17970/field_tags/acpi-18789/language/en/type/blog?query=Optimizing%20Software%20Applications%20for%20Power)可能对 x86 开发人员有一些用处。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-15T05:37:13.370

Zeroith，使用完全静态的机器，可以在空闲时停止。您无法击败零赫兹。

首先，切换到无滴答操作系统调度程序。每毫秒左右醒来都会浪费电力。如果不能，请考虑减慢调度程序中断。

其次，确保您的空闲线程是省电的，等待下一个中断指令。您可以在大多数小型设备拥有的那种监管不足的“用户空间”中执行此操作。

第三，如果您必须轮询或执行用户信心活动，例如更新 UI，请睡觉，执行此操作，然后重新睡觉。

不要相信那些你没有检查过“sleep and spin”类型代码的 GUI 框架。尤其是您可能很想用于#2 的事件计时器。

在读取时阻塞线程，而不是使用 select()/epoll()/WaitForMultipleObjects() 进行轮询。给线程调度器（和你的大脑）带来压力，但这些设备通常都可以。这最终会稍微改变您的高级设计；它变得更整洁！一个轮询你可能做的所有事情的主循环最终会在 CPU 上变得缓慢和浪费，但确实保证了性能。（保证慢）

缓存结果，懒惰地创造东西。用户希望设备运行缓慢，所以不要让他们失望。少跑步更好。尽可能少地逃跑。当您不再需要单独的线程时，它们可以被杀死。

尝试获得比您需要的更多的内存，然后您可以插入多个哈希表并节省搜索。如果内存是 DRAM，这是一个直接的权衡。

查看一个比您认为可能需要的实时系统。以后可以节省时间（原文如此）。他们也能更好地处理线程。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-15T07:23:54.393

在我使用智能手机的工作中，我发现保持电池寿命的最佳方法是确保禁用程序在该特定点运行所需的一切。

例如，仅在需要时打开蓝牙，类似手机功能，在不需要时调低屏幕亮度，调低音量等。

这些函数使用的功能通常会远远超过您的代码使用的功能。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-15T05:17:39.983

不要投票。使用事件和其他操作系统原语来等待可通知的事件。轮询可确保 CPU 保持活动状态并延长电池寿命。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-21T19:37:35.293

避免轮询是一个很好的建议。

微处理器的功耗大致与其时钟频率和电源电压的平方成正比。如果您有可能通过软件调整这些，则可以节省一些电量。此外，关闭不需要的处理器部分（例如浮点单元）可能会有所帮助，但这在很大程度上取决于您的平台。在任何情况下，您都需要一种方法来测量处理器的实际功耗，以便找出哪些有效，哪些无效。就像速度优化一样，功率优化也需要仔细分析。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T10:02:31.813

查看您的编译器生成的内容，特别是对于热门代码区域。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T10:29:07.413

如果你有低优先级的间歇性操作，不要使用特定的定时器唤醒来处理它们，而是在处理其他事件时处理。

使用逻辑来避免愚蠢的场景，即您的应用可能会进入睡眠状态 10 毫秒，然后必须再次唤醒以等待下一个事件。对于提到的那种平台，两个事件是否同时处理并不重要。拥有自己的计时器和回调机制**可能**适合这种决策。权衡是代码复杂性和维护与可能的节能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-15T05:29:12.687

考虑尽可能少地使用网络接口。您可能希望收集信息并将其发送出去，而不是不断发送。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-06-14T15:31:07.913

相当及时，今天在 Hackaday 上关于测量各种命令的功耗的文章： [Hackaday: the-effect-of-code-on-power-consumption](http://hackaday.com/2012/06/14/the-effect-of-code-on-power-consumption/)

除此之外：
- 中断是你的朋友
- 轮询 / wait() 不是你的朋友
- 尽可能少做
- 使你的代码尽可能小/高效
- 关闭尽可能多的模块、引脚、外围设备微型
- 尽可能慢地运行
- 如果微型有引脚驱动强度、压摆率等设置。检查并配置它们，默认值通常是全功率/最大速度。
- 回到上面的文章，回去测量功率，看看你是否可以通过改变东西来放弃它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T13:19:55.500

简而言之，尽可能少做。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-21T22:59:21.080

好吧，如果您的代码可以完全在处理器缓存中执行，那么您将有更少的总线活动并节省电力。只要您的程序足够小以将代码+数据完全放入缓存中，您就可以“免费”获得这种好处。OTOH，如果您的程序太大，并且您可以将程序划分为或多或少独立于另一个的模块，则可以通过将其划分为单独的程序来节省一些电力。（我想也可以制作一个工具链，将相关的代码和数据包分散到缓存大小的块中......）

我想，从理论上讲，您可以通过减少指针取消引用的数量以及重构您的跳转以便首先进行最有可能的跳转来节省一些不必要的工作——但这​​对于程序员来说是不现实的。

Transmeta 的想法是让机器在运行中进行一些指令优化以节省电力......但这似乎没有足够的帮助......[看看他们从哪里得到的。](http://arstechnica.com/news.ars/post/20080925-transmeta-puts-itself-longrun-technology-up-for-sale.html)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-18T01:54:22.317

将未使用的内存或闪存设置为 0xFF 而不是 0x00。对于 flash 和 eeprom 来说当然是这样，对于 s 或 d ram 不确定。对于舞会，存在反转，因此 0 存储为 1 并消耗更多能量，1 存储为零并消耗更少。这就是你在擦除一个块后读取 0xFFs 的原因。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-06-15T12:47:27.433

不要投票，睡觉

尽可能避免使用芯片的耗电区域。例如，乘数很耗电，如果你可以移位和加法，你可以节省一些焦耳（只要你不做太多移位和加法，实际上乘数就是赢了！）

如果你真的很认真，我会得到一个功耗感知调试器，它可以将功耗与你的源代码相关联。 [像这样](http://www.iar.com/en/Products/IAR-Embedded-Workbench/Power-debugging/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-12-10T20:41:24.900

在 Linux 上，安装 powertop 以查看哪个软件唤醒 CPU 的频率。并遵循 powertop 站点链接的各种提示，其中一些可能也适用于非 Linux。

[http://www.lesswatts.org/projects/powertop/](http://www.lesswatts.org/projects/powertop/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-30T13:39:19.790

同样重要的事情是降低数学运算的精度，选择可用的最小数据集，如果您的开发环境可用，则打包数据和聚合操作。

knuth 书籍可以为您提供节省内存或 CPU 所需的特定算法的所有变体，或者降低精度以最小化舍入误差

此外，花一些时间检查所有嵌入式设备 api - 例如，大多数 symbian 手机可以通过专门的硬件进行音频编码

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-08-29T08:50:41.133

选择快速且具有小基本块和最少内存访问的高效算法。

了解处理器的缓存大小和功能单元。

不要访问内存。如果它们将您的工作代码或数据集扩展到可用缓存之外，请不要使用对象或垃圾收集或任何其他高级构造。如果您知道缓存大小和关联性，请在低功耗模式下布置您需要的整个工作数据集并将其全部放入 dcache（忘记一些将数据分散在单独对象或数据中的“正确”编码实践）结构，如果这会导致缓存垃圾）。与所有子程序相同。如有必要，将您的工作代码集全部放在一个模块中，以便在 icache 中将其全部条带化。如果处理器具有多级高速缓存，请尽量适应最低级别的指令或数据高速缓存。大学教师'

等等

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-09-23T08:03:30.707

尽快完成工作，然后进入空闲状态等待中断（或事件）发生。尝试用尽可能少的外部内存流量使代码用尽缓存。

# svn - Using Subversion for general purpose backup

> ID：61888
> 
> 赞同：15
> 
> 时间：2008-09-15T05:16:15.247
> 
> 标签：svn, backup

Is it possible to use [Apache Subversion](http://subversion.apache.org/) (SVN) as general purpose backup tool? (As a kind of [rsync](http://en.wikipedia.org/wiki/Rsync) alternative.)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-15T05:21:52.020

I found this article to be a pretty cool description of using svn to backup your home directory, and more:

> I use Subversion to backup my Linux boxes. With some minor creativity, it easily covers:
> 
> *   Daily snapshots and offsite backup.
> *   Easy addition and removal of files and folders.
> *   Detailed tracking of file versions.
> 
> It also allows for a few bonus features:
> 
> *   Regular log emails to keep track of filesystem activity via Subversion's event hooks.
> *   Users may request a checkout of their home folders from any respository revision.
> *   New or replacement servers can be setup with a few svn checkout commands.

Source: [http://www.mythago.net/svn_for_backup.html](http://web.archive.org/web/20080824094836/http://www.mythago.net/svn_for_backup.html)

Also found [this article](http://www.onlamp.com/pub/a/onlamp/2005/01/06/svn_homedir.html) which shows an example of versioning your home directory. This allows you to bring your environment with you by checking out your home directory into a new machine. I used to do something similar and found it very useful.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T05:19:59.323

One thing to bear in mind when using SVN as a backup for binary files is that SVN will double the size of your files, because it keeps a local copy of each file (in the .svn/text-base) file.

Apart from that I use SVN for a backup as well. Simply add all files then commit via script.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-15T19:34:43.577

As a "general purpose" backup, I'd say it's probably not the greatest idea, mainly for the reasons given by others (lots of excess folders and wasted disk space). If you want to just keep backups, again I'd say there's probably better options, depending on your needs, eg: do you need to keep every single version of every single file, or would certain snapshots of your data be sufficient?

However, at my office, we have a small team of 6 who work with shared files (eg: policies and procedures manuals, registration forms, etc). A lot of the time, team members will be working remotely (from home or while travelling), and often offline. Rather than using a central shared-folder setup, we use SVN to give each person an entire working copy of the folder which they can work on and refer to and synchronise whenever possible. This kills two birds with one stone: everyone can access and edit the files even while offline, plus it gives us really great redundancy in our backups. If my laptop [catches on fire](http://www.youtube.com/watch?v=4XHaz5EM9jc), it's no hassle because I can just check out another copy (obviously on another computer). If the server catches on fire, we'll have the backups of the repository to restore. If the server AND all the repo backups catch on fire, then all that you've lost are old versions of files. The only way that you'll lose any current data is if the server, your repo backups and every single computer which has a checkout all mysteriously catch on fire.

As some people have said though, SVN will never remove information from the repository, meaning that if you only want to keep backups for 60 days, then, well, you can't. This isn't exactly true. Through use of [export](http://svnbook.red-bean.com/en/1.0/re10.html), [dump](http://svnbook.red-bean.com/en/1.1/re31.html) and [import](http://svnbook.red-bean.com/en/1.0/re12.html) you could effectively wipe out older versions of files. It's not pretty, but it's possible.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-15T06:58:34.657

One thing, that would annoy me a lot, are the '.svn' folders, that svn puts into every folder it tracks.

They look annoying, when you copy a folder, you should remember to not copy them (or your sandbox might be irritated) and it is a lot harder to grep through a bunch of folders, since there are often a lot of hits in the .svn resource folders.

I like the idea of using a source-control, to control your environment. But I personally would not choose svn for this job. I would go for something like git. But that is probably just me...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-06T12:58:04.883

I do use SVN to backup my computer, and also to synchronize my laptop and my desktop. But it does have the problems mentioned in earlier answers, mainly the doubling of the disk usage. I also feel that the excess of files and the SVN process constantly checking my HD for changes makes my machine slower.

I would like to highlight, however, that SVN is great for synching different machines, and you also get the bonus of being able to check out a file anywhere if you need to -- I even do it in my browser through the web interface, sometimes.

In summary, I have mixed feelings about using SVN for general purpose backup. But if you do, I recommend ***not*** to store libraries such as movies, photos and music, because they tend to be large (suffering hugely from the doubled space usage) and immutable -- you don't need a versioning system for that, because in the rare occasions when you change a file, you generally don't need the old versions (and SVN isn't good at making/storing diffs of binary files, it saves the entire new version of the file). So, unless SVN can be adapted (a long-time project intention of mine) for these cases, I suggest using an alternative method for backing up these kinds of files.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-03-21T13:21:04.353

To use SVN as backup on Linux do the following:

1.  Create an empty repo.
2.  Checkout the empty repository into the folder tree you want to backup.
3.  Use the following code snippet (svnauto). You have to replace "myuser" and "mypassword" with valid credentials for your repository:

```
    #!/bin/sh
    svn status --depth=infinity --username=myuser --password=mypassword > /tmp/svnauto_tmp.list
    cat /tmp/svnauto_tmp.list | grep '^?' | sed -e 's/^?       /svn add --depth=infinity --force --username=myuser --password=mypassword "/g' -e 's/$/@"/g' | sh
    cat /tmp/svnauto_tmp.list | grep '^!' | sed -e 's/^!       /svn delete --username=myuser --password=mypassword "/g' -e 's/$/@"/g' | sh
    rm -f /tmp/svnauto_tmp.list
    svn update . --username=myuser --password=mypassword
    svn commit --username=myuser --password=mypassword --message "Automatic backup"

```

The script above will add/remove and update any files and subdirectories within the current dir. To use it simply `cd` to the folder you want to backup (which must be a working copy of course), and run `svnauto`. Notice that you need to have grep and sed installed on your system, and it creates a temporary file in /tmp. It can be used from a cron job for nightly commit, using the following cron script:

```
#!/bin/sh
export LANG=en_US.UTF-8 && cd /my/directory && echo Starting backup $(date) > /root/backup_log.txt && /root/svnauto >> /root/backup_log.txt 2>&1 && echo Finished backup. >> /root/backup_log.txt && cat /root/backup_log.txt 
```

This cron script assumes that `/my/directory` is the folder you want to backup (replace as needed). It also assumes you put the `svnauto` script in `/root`. It creates a log and displays it at the end. One more detail: the first `export` is needed for svn to find the proper language. You may have to adjust this line to your own local language to make it work.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-03-26T16:35:05.980

You could also consider [bup](https://github.com/bup/bup) - *Highly efficient file backup system based on the git packfile format.* It's based on git's in the way it stores data, which is very efficient for storing files and their differences.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T05:18:37.783

I've used CVS as a substitute for ghost so I don't see why not.

I'ts nice as you can tag a baseline: you can change manage machines.

This works better on unixes than windows, obviously.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T05:19:50.243

The thing that would put me off that idea, is that for general use any binary data would get copied over anytime it changed, whereas the text content SCM systems are based around can easily be updated in the form of diffs.

So you could do it, just be aware you may not want to use it to manage things like photo repositories if you do much editing.

The nice thing about more general purpose backup solutions (say, Time Machine) is that they can roll up multiple binary changes after a while to conserve space. I'm not sure how easy that would be to do in SVN or git or mercurial.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T14:48:54.277

Using SVN for backups can work. However, over time it can be difficult to delete old revisions that are not needed. Say you only wanted to keep 30 or 60 days of backups. SVN does not provide an easy way to remove any history older than X days. If you don't have a way to purge old history you will eventually run your backup drive out of space.

Here is a quote from the [SVN Book on the svndumpfilter](http://svnbook.red-bean.com/en/1.0/ch05s03.html#svn-ch-5-sect-3.1.3) command:

> Since Subversion stores everything in an opaque database system, attempting manual tweaks is unwise, if not quite difficult. And once data has been stored in your repository, Subversion generally doesn't provide an easy way to remove that data. [13]
> 
> > [13] That, by the way, is a feature, not a bug.

I found [unison](http://www.cis.upenn.edu/~bcpierce/unison/) to be a better option than svn for a rsync alternative.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T15:00:47.807

Backing up /etc with source code control can be a big help when you want to revert a change that hosed your system, experiment with changes, or carry changes from one server to another.

But subversion's multitude of .svn directories can get in the way for that, not just when searching but in some cases, like *.d folders, poorly designed systems might interpret the .svn folders themselves as containing configuration data.

I now prefer using Mercurial for backing up /etc since it puts a single .hg folder under /etc. For real backup and not just version control you need to copy that .hg folder elsewhere.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-11-15T14:14:22.520

This statement by JoaoPSF is incorrect:

> (and SVN isn't good at making/storing diffs of binary files, it saves the entire new version of the file)

See this quote from [How does Subversion handle binary files](http://help.collab.net/index.jsp?topic=/faq/svnbinary.html):

> Note that whether or not a file is binary does not affect the amount of repository space used to store changes to that file, nor does it affect the amount of traffic between client and server. For storage and transmission purposes, Subversion uses a diffing method that works equally well on binary and text files; this is completely unrelated to the diffing method used by the svn diff command.

# c - 来自 copy_to_user 的“错误地址”错误

> ID：61893
> 
> 赞同：4
> 
> 时间：2008-09-15T05:20:04.083
> 
> 标签：c, linux, kernel

我正在尝试将自定义结构从内核空间复制到用户空间。在用户空间 errno 内部返回“错误地址”。错误地址错误的常见原因是什么？

```
if(copy_to_user(info, &kernel_info, sizeof(struct prinfo))) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T06:56:33.490

Bad Address 错误意味着您提供的地址位置无效。对于上面的情况，我猜这是因为您传递的是副本`info`而不是指向`info`内存位置的指针。

查看文档，`copy_to_user`定义为

```
copy_to_user(void __user * to, const void * from, unsigned long n); 
```

因此，除非您的`info`变量是指针，否则我会将您的代码更新为：

```
if(copy_to_user(&info, &kernel_info, sizeof(struct prinfo)) ) {
    //some stuff here i guess
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T16:18:53.913

假设 info 是一个指针类型并且 info 指向一个有效的位置，那么 info 仍然有可能指向一个不在用户空间中的地址，这是函数所需的。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2015-04-21T13:44:46.220

我在编写一个小字符驱动程序时遇到了同样的问题。我做错的只是函数copy_to_user在失败时返回非零，所以你必须这样做..

```
if(copy_to_user(void *userbuf, void *kernelbuf, long len))
    return -EFAULT;

// Continue with code.. 
```

# python - 在 Google App Engine 中查找相对路径的好方法是什么？

> ID：61894
> 
> 赞同：5
> 
> 时间：2008-09-15T05:21:47.760
> 
> 标签：python, google-app-engine

所以我用 GAE 完成了琐碎的“热身”应用程序。现在我想用更复杂的目录结构构建一些东西。类似于以下内容：

```
siteroot/
    models/
    controllers/
        controller1/
        controller2/
        ...
    templates/
        template1/
        template2/
        ... 
```

..ETC。控制器将是处理请求的 Python 模块。然后他们需要在相关文件夹中找到（Django 风格的）模板。我见过的大多数演示应用程序都解析这样的模板路径：

```
path = os.path.join(os.path.dirname(__file__), 'myPage.html') 
```

... __ 文件 __ 属性解析为当前正在执行的脚本。因此，在我上面的示例中，如果 Python 脚本在 controllers/controller1/ 中运行，那么“myPage.html”将解析到同一个目录——controllers/controller1/myPage.html——我宁愿干净地分开我的Python 代码和模板。

我一起破解的解决方案感觉...... hacky：

```
base_paths = os.path.split(os.path.dirname(__file__))
template_dir = os.path.join(base_paths[0], "templates") 
```

所以，我只是剪掉当前运行脚本的路径的最后一个元素，并将模板目录附加到新路径。我见过的用于解析 Python 路径的其他（非 GAE 特定）解决方案似乎相当重量级（例如将路径拆分为列表并进行相应的操作）。Django 似乎对此有答案，但我宁愿坚持使用 GAE API，而不是创建一个完整的 Django 应用程序并为 GAE 修改它。

我假设任何硬编码都不会启动，因为这些应用程序存在于 Google 的无限服务器场中。那么有什么更好的方法呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T15:02:56.883

正如 Toni 建议的那样，您不能使用相对路径，因为您无法保证从工作目录到应用程序目录的路径将保持不变。

正确的解决方案是按原样使用 os.path.split，或者使用类似的东西：

```
path = os.path.join(os.path.dirname(__file__), '..', 'templates', 'myPage.html') 
```

我常用的方法是使用上述方法生成模板目录的路径，并将其存储为我的控制器对象的成员，并提供一个“getTemplatePath”方法，该方法采用提供的文件名并将其与基名连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T10:37:02.760

该`dirname`函数返回一个绝对路径，使用相对路径。查看执行控制器时的当前目录是什么，`os.path.abspath(os.path.curdir)`并构建相对于该位置的模板路径（`os.path.abspath`当然没有部分）。

这仅在当前目录位于*siteroot*内的某个位置时才有效，否则您可以执行以下操作：

```
template_dir = os.path.join(os.path.dirname(__file__), os.path.pardir, "templates") 
```

# javascript - 没有包装器的 iframe 维基百科文章

> ID：61902
> 
> 赞同：3
> 
> 时间：2008-09-15T05:28:22.503
> 
> 标签：javascript, iframe, wikipedia

我想将维基百科文章嵌入到页面中，但我不希望文章周围的所有包装器（导航等）。我在这里看到它：[http](http://www.dayah.com/periodic/) ://www.dayah.com/periodic/ 。单击一个元素，将显示 iframe 并仅链接到文章（无包装）。那么他们是怎么做到的呢？似乎 JavaScript 处理显示 iframe 并构建 href 但在浏览页面 javascript ( [http://www.dayah.com/periodic/Script/interactivity.js](http://www.dayah.com/periodic/Script/interactivity.js) ) 之后，我仍然无法弄清楚 url 是如何构建的。谢谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-15T05:58:34.847

周期表示例将 wiki 文章的打印机友好版本加载到 iframe 中。[http://en.wikipedia.org/wiki/Potasium](http://en.wikipedia.org/wiki/Potasium)？**可打印=是**

它在*函数 click_wiki(e)*中完成（第 534 行，interactivity.js）

> ```
> var article = el.childNodes[0].childNodes[n_name].innerHTML;
> ...
> window.frames["WikiFrame"].location.replace("http://" + 语言 + ".wikipedia.org/w/index.php?title=" + encodeURIComponent(article) + "&printable=yes");
> 
> ```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T09:31:04.010

@VolkerK 是对的，他们使用的是可打印版本。

这是一个简单的方法来确定您何时知道该站点在 iframe 中显示该页面。

在 Firefox 中，右键单击 iframe 内的任意位置，从上下文菜单中选择“This Frame”，然后选择“View frame info”

您将获得所需的信息，包括地址：

> 地址：[http ://en.wikipedia.org/w/index.php?title=Chromium&printable=yes](http://en.wikipedia.org/w/index.php?title=Chromium&printable=yes)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T13:09:01.397

jQuery 库允许您使用类似 CSS 的语法指定要通过 Ajax 调用检索的页面部分：http: [//docs.jquery.com/Ajax/load](http://docs.jquery.com/Ajax/load)

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-09-15T05:34:25.840

您可以随时下载该网站并将其废弃。我认为里面的一切`<div id="bodyContent">`都是文章的内容——没有导航、页眉、页脚等。

不要忘记信用。;)

# java - 延迟加载属性和session.get问题

> ID：61906
> 
> 赞同：2
> 
> 时间：2008-09-15T05:33:09.153
> 
> 标签：java, hibernate, lazy-loading

在 Hibernate 中，我们有两个类，其中包含以下具有 JPA 映射的类：

```
package com.example.hibernate

import javax.persistence.Entity;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.ManyToOne;

@Entity
public class Foo {
  private long id;
  private Bar bar;

  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  public long getId() {
    return id;
  }

  public void setId(long id) {
    this.id = id;
  }

  @ManyToOne(fetch = FetchType.LAZY)
  public Bar getBar() {
    return bar;
  }

  public void setBar(Bar bar) {
    this.bar = bar;
  }
}

package com.example.hibernate

import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

public class Bar {
  private long id;
  private String title;

  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  public long getId() {
    return id;
  }

  public void setId(long id) {
    this.id = id;
  }

  public String getTitle() {
    return title;
  }

  public void setTitle(String title) {
    this.title = title;
  } 
} 
```

现在，当我们使用会话从数据库加载类 Foo 的对象时，例如：

Foo foo = (Foo)session.get(Foo.class, 1 /* or some other id that exists in the DB*/); foo 的 Bar 成员是一个代理对象（在我们的例子中是 javassist 代理，但它可以是 cglib 之一，具体取决于您使用的字节码提供程序），它没有被初始化。如果您随后使用 session.get 获取 Bar 对象，它是刚刚加载的 Foo 类的成员（我们在同一个会话中），Hibernate 不会发出另一个 DB 查询并从会话（第一级）缓存中获取对象. 问题是这是未初始化的 Bar 类的代理，尝试调用此对象 getId() 将返回 0，而 getTitle() 将返回 null。我们当前的解决方案非常难看，它检查从 get 返回的对象是否是代理这里是代码（形成一个通用的 DAO 实现）：

```
@SuppressWarnings("unchecked")
@Override
@Transactional(readOnly = true)
public <T extends IEntity> T get(Class<T> clazz, Serializable primaryKey) throws DataAccessException {
  T entity = (T) currentSession().get(clazz, primaryKey);
  if (entity != null) {
    if (LOG.isWarnEnabled()) {
      LOG.warn("Object not found for class " + clazz.getName() + " with primary key " + primaryKey);
    }
  } else if (entity instanceof HibernateProxy){ // TODO: force initialization due to Hibernate bug
    HibernateProxy proxy = (HibernateProxy)entity;
    if (!Hibernate.isInitialized(proxy)) {
      Hibernate.initialize(proxy);
    }
    entity = (T)proxy.getHibernateLazyInitializer().getImplementation();
  }
  return entity;
} 
```

有没有更好的方法来做到这一点，在 Hibernate 论坛中找不到解决方案，在 Hibernate 的 JIRA 中也没有找到问题。

注意：我们不能只使用 foo.getBar() （它将正确初始化代理）来获取 Bar 类对象，因为获取 Bar 对象的 session.get 操作不知道（或不关心）Bar class 也是刚刚获取的 Foo 对象的惰性成员。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T10:32:27.297

我有一个类似的问题：

*   我做了 Session.save(nastyItem) 将对象保存到会话中。但是，我没有填写映射为 update="false" insert="false" 的购房者（当您有一个组合主键时，这种情况经常发生，然后您将多对一映射为 insert="假”更新=“假”）
*   我是一个加载项目列表的查询，而我刚刚保存的项目恰好是结果集的一部分
*   现在出了什么问题？Hibernate 看到该项目已经在缓存中，并且 Hibernate 不会用新加载的值替换它（可能不会破坏我之前的引用 nastyItem），而是使用我自己放入 Session 缓存中的 MY nastyItem。更糟糕的是，现在买家的延迟加载被破坏了：它包含 null。

为了避免这些会话问题，我总是在保存、合并、更新或删除后进行刷新和清除。必须解决这些讨厌的问题占用了我太多时间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T07:59:34.853

我无法重现您所看到的行为。这是我的代码：

```
@Entity
public class Foo {
    private Long id; private String name; private Bar bar;

    public Foo() { }
    public Foo(String name) { this.name = name; }

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }

    @Basic
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    @ManyToOne(fetch = FetchType.LAZY)
    public Bar getBar() { return bar; }
    public void setBar(Bar bar) { this.bar = bar; }
}

@Entity
public class Bar {
    private Long id; private String name;

    public Bar() { }
    public Bar(String name) { this.name = name; }

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }

    @Basic
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
}

    public void testGets() {
        SessionFactory sf = new AnnotationConfiguration()
            .addPackage("hibtest")
                .addAnnotatedClass(Foo.class)
                .addAnnotatedClass(Bar.class)
            .configure().buildSessionFactory();
        Session session = null;
        Transaction txn = null;

        // Create needed data
        try {
            session = sf.openSession();
            txn = session.beginTransaction();

            // Create a Bar
            Bar bar = new Bar("Test Bar");
            session.save(bar);

            // Create a Foo
            Foo foo = new Foo("Test Foo");
            session.save(foo);

            foo.setBar(bar);

            txn.commit();
        } catch (HibernateException ex) {
            if (txn != null) txn.rollback();
            throw ex;
        } finally {
            if (session != null) session.close();
        }

        // Try the fetch
        try {
            session = sf.openSession();
            Foo foo = (Foo) session.get(Foo.class, 1L);
            Bar bar = (Bar) session.get(Bar.class, 1L);
            System.out.println(bar.getName());
        } finally {
            if (session != null) session.close();
        }
    } 
```

正如人们所期望的那样，这一切都很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T11:55:41.540

你真的需要做延迟加载吗？
您不能将 FetchType 设置为 EAGER 并始终使用连接（正确）加载它吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T14:55:55.663

你做错了什么。我没有测试你的代码，但你永远不需要强制初始化代理，属性访问器会为你做这件事。如果您明确使用 Hibernate，请不要介意使用 JPA，因为您已经失去了可移植性。

Hibernate 应该在需要获取或写入数据库时​​自动检测。如果您从代理发出 getProperty()，hibernate 或任何其他 jpa 提供程序应该从数据库中获取对应的行。

我不确定 hibernate 是否足够*聪明*的唯一情况是，如果您发出 save() 然后发出带有已保存对象 id 的 get()，如果 save() 没有刷新可能会出现问题反对分贝。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T06:30:23.820

没有真正看到这个问题，虽然我们确实遇到了间歇性延迟加载错误 - 所以也许我们有同样的问题，无论如何，是否可以选择使用不同的会话来加载 Bar 对象 - 应该从头开始加载它，我会期待...

# c# - VS 2005 Toolbox 类控件 .NET

> ID：61914
> 
> 赞同：1
> 
> 时间：2008-09-15T05:47:37.340
> 
> 标签：c#, c++, .net, vb.net, visual-studio-2005

我正在寻找 Visual Studio“工具箱”菜单使用的控件。它可以对接并且可以缩回（销钉）。

你知道我在哪里可以找到我可以使用的控件或 COM 看起来像这样吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T11:50:44.907

我会推荐 Weifen Luo 的[DockPanel Suite](http://sourceforge.net/projects/dockpanelsuite)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T05:53:23.160

我认为您只需要使用普通表单（将表单类型设置为工具）并使用停靠属性停靠到左侧或右侧。您可以根据需要设置宽度，并使用 resize 事件来阻止用户将其设置得太大或太小。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T09:17:49.417

你没有提到你想使用什么语言。对于 C++，使用功能包。

# visual-studio - VS Code Snippets 自动同步器？

> ID：61927
> 
> 赞同：2
> 
> 时间：2008-09-15T06:07:05.687
> 
> 标签：visual-studio, code-snippets

我在VS 2008中使用多台机器进行开发。是否有工具可以自动同步机器之间的片段？同步浏览器书签的相同概念。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T06:13:23.360

如果您安装了 Vista 和 LiveMesh 客户端，请尝试[此建议](http://weblogs.asp.net/lduveau/archive/2008/06/30/sync-your-visual-studio-settings-with-live-mesh.aspx)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T06:23:57.110

假设您已经知道您需要/想要同步哪些文件，那么 Mesh 的一些额外选项将是工具。也许看看 SyncToy 或 SyncBack 以保持这些文件集中集中 - 然后让您的所有机器从中央数据存储中提取。

还有可以在 Internet 上运行的[Live Sync](https://sync.live.com/)（以前的 FolderShare）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T07:21:15.413

这些机器位于不同的位置、家庭和工作场所，因此 SyncToy 之类的软件无法运行。我不知道 SyncBack。从他们的网站上不清楚是否可以通过网络完成。我在 MS 的网站上找不到 Live Mesh 的客户端软件。

我会在这里检查想法：http: [//lifehacker.com/372175/free-ways-to-synchronize-folders-between-computers](http://lifehacker.com/372175/free-ways-to-synchronize-folders-between-computers)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T02:47:16.500

尝试其中之一：

1) [http://www.getdropbox.com](http://www.getdropbox.com)

2) [https://www.foldershare.com/welcome.aspx](https://www.foldershare.com/welcome.aspx)

3) 微软办公室槽

我个人使用SVN。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T04:17:58.903

我尝试了文件夹共享并完成了所有设置，但它没有同步。此外，当我选择按需同步类型而不是自动同步时，我希望看到手动触发同步的选项，但我找不到它。我不喜欢这个软件。

环顾四周，发现同步性，它工作正常。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-02T18:05:19.283

[Syncplicity.com](http://Syncplicity.com)

# database - Firebird 数据库复制

> ID：61929
> 
> 赞同：5
> 
> 时间：2008-09-15T06:16:50.810
> 
> 标签：database, replication, firebird

我已经到了决定用其他人构建的系统替换我定制的复制系统的地步，主要是出于可靠性目的。任何人都可以推荐任何值得的复制系统吗？[纤维](http://fibre.sourceforge.net)好不好？

不过，我需要的可能有点远离通用系统。我有五个部门，每个部门都有自己的数据库副本，并且主服务器位于远程位置。各个部门都有零星的网络连接，主人总是在线。数据必须从主服务器来回流动，这意味着所有部门都需要与主服务器相同（当互联网连接可用时），并上传在网络中断期间所做的更改，然后由主服务器分发给其他部门。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T13:54:02.647

我使用 CopyCat 创建了一个复制项目。它允许您使用 CodeGear Delphi 创建自己的复制客户端/服务器配置。这使您可以完全灵活地决定您希望您的复制如何工作。

如果您不使用 Delphi，或者需要预制解决方案，CopyTiger 会执行已配置的相同操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T03:36:17.137

我发现 IBPhoenix 的 IBReplicator 是最完整的，但这里列出了更多（带有简短描述）：

[http://www.firebirdfaq.org/faq249/](http://www.firebirdfaq.org/faq249/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T13:35:58.960

Ibphoenix 站点列表复制工具

[IbPhoenix 复制工具](http://www.ibphoenix.com/download/tools/replication)

# c# - 如何将 Enum 绑定到 ASP.NET 中的 DropDownList 控件？

> ID：61953
> 
> 赞同：131
> 
> 时间：2008-09-15T07:03:32.243
> 
> 标签：c#, .net, asp.net

假设我有以下简单的枚举：

```
enum Response
{
    Yes = 1,
    No = 2,
    Maybe = 3
} 
```

如何将此枚举绑定到 DropDownList 控件，以便在列表中显示描述以及在选择选项后检索关联的数值 (1,2,3)？

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2008-09-15T07:10:22.833

我可能不会**绑定**数据，因为它是一个枚举，并且在编译后它不会改变（除非我有一个*愚蠢*的时刻）。

最好只遍历枚举：

```
Dim itemValues As Array = System.Enum.GetValues(GetType(Response))
Dim itemNames As Array = System.Enum.GetNames(GetType(Response))

For i As Integer = 0 To itemNames.Length - 1
    Dim item As New ListItem(itemNames(i), itemValues(i))
    dropdownlist.Items.Add(item)
Next 
```

或在 C# 中相同

```
Array itemValues = System.Enum.GetValues(typeof(Response));
Array itemNames = System.Enum.GetNames(typeof(Response));

for (int i = 0; i <= itemNames.Length - 1 ; i++) {
    ListItem item = new ListItem(itemNames[i], itemValues[i]);
    dropdownlist.Items.Add(item);
} 
```

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2008-09-15T09:31:50.280

使用以下实用程序类从**Enumeration**`Enumeration`获取`IDictionary<int,string>`（枚举值和名称对）；然后将**IDictionary**绑定到可绑定控件。

 ****```
public static class Enumeration
{
    public static IDictionary<int, string> GetAll<TEnum>() where TEnum: struct
    {
        var enumerationType = typeof (TEnum);

        if (!enumerationType.IsEnum)
            throw new ArgumentException("Enumeration type is expected.");

        var dictionary = new Dictionary<int, string>();

        foreach (int value in Enum.GetValues(enumerationType))
        {
            var name = Enum.GetName(enumerationType, value);
            dictionary.Add(value, name);
        }

        return dictionary;
    }
} 
```

**示例：**使用实用程序类将枚举数据绑定到控件

```
ddlResponse.DataSource = Enumeration.GetAll<Response>();
ddlResponse.DataTextField = "Value";
ddlResponse.DataValueField = "Key";
ddlResponse.DataBind(); 
```

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2010-03-10T11:58:01.670

我将它用于**ASP.NET MVC**：

```
Html.DropDownListFor(o => o.EnumProperty, Enum.GetValues(typeof(enumtype)).Cast<enumtype>().Select(x => new SelectListItem { Text = x.ToString(), Value = ((int)x).ToString() })) 
```

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2008-09-25T20:27:19.173

我的版本只是上述的压缩形式：

```
foreach (Response r in Enum.GetValues(typeof(Response)))
{
    ListItem item = new ListItem(Enum.GetName(typeof(Response), r), r.ToString());
    DropDownList1.Items.Add(item);
} 
```

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2008-11-14T15:24:22.953

```
public enum Color
{
    RED,
    GREEN,
    BLUE
} 
```

每个 Enum 类型都派生自 System.Enum。有两种静态方法可帮助将数据绑定到下拉列表控件（并检索值）。它们是 Enum.GetNames 和 Enum.Parse。使用 GetNames，您可以绑定到下拉列表控件，如下所示：

```
protected System.Web.UI.WebControls.DropDownList ddColor;

private void Page_Load(object sender, System.EventArgs e)
{
     if(!IsPostBack)
     {
        ddColor.DataSource = Enum.GetNames(typeof(Color));
        ddColor.DataBind();
     }
} 
```

现在，如果您想要 Enum 值 Back on Selection ....

```
 private void ddColor_SelectedIndexChanged(object sender, System.EventArgs e)
  {
    Color selectedColor = (Color)Enum.Parse(typeof(Color),ddColor.SelectedValue
  } 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2014-07-15T23:19:45.043

在阅读了所有帖子后，我想出了一个全面的解决方案，以支持在下拉列表中显示枚举描述以及在编辑模式下显示时从下拉列表中的模型中选择适当的值：

枚举：

```
using System.ComponentModel;
public enum CompanyType
{
    [Description("")]
    Null = 1,

    [Description("Supplier")]
    Supplier = 2,

    [Description("Customer")]
    Customer = 3
} 
```

枚举扩展类：

```
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Web.Mvc;

public static class EnumExtension
{
    public static string ToDescription(this System.Enum value)
    {
        var attributes = (DescriptionAttribute[])value.GetType().GetField(value.ToString()).GetCustomAttributes(typeof(DescriptionAttribute), false);
        return attributes.Length > 0 ? attributes[0].Description : value.ToString();
    }

    public static IEnumerable<SelectListItem> ToSelectList<T>(this System.Enum enumValue)
    {
        return
            System.Enum.GetValues(enumValue.GetType()).Cast<T>()
                  .Select(
                      x =>
                      new SelectListItem
                          {
                              Text = ((System.Enum)(object) x).ToDescription(),
                              Value = x.ToString(),
                              Selected = (enumValue.Equals(x))
                          });
    }
} 
```

型号类：

```
public class Company
{
    public string CompanyName { get; set; }
    public CompanyType Type { get; set; }
} 
```

和查看：

```
@Html.DropDownListFor(m => m.Type,
@Model.Type.ToSelectList<CompanyType>()) 
```

如果您在没有绑定到模型的情况下使用该下拉列表，则可以使用它：

```
@Html.DropDownList("type",                  
Enum.GetValues(typeof(CompanyType)).Cast<CompanyType>()
.Select(x => new SelectListItem {Text = x.ToDescription(), Value = x.ToString()})) 
```

因此，通过这样做，您可以期望您的下拉列表显示描述而不是枚举值。此外，当涉及到编辑时，您的模型将在发布页面后通过下拉选择的值进行更新。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-09-15T11:58:22.097

正如其他人已经说过的那样 - 不要将数据绑定到枚举，除非您需要根据情况绑定到不同的枚举。有几种方法可以做到这一点，下面是几个例子。

**对象数据源**

使用 ObjectDataSource 的声明方式。首先，创建一个 BusinessObject 类，该类将返回 List 以将 DropDownList 绑定到：

```
public class DropDownData
{
    enum Responses { Yes = 1, No = 2, Maybe = 3 }

    public String Text { get; set; }
    public int Value { get; set; }

    public List<DropDownData> GetList()
    {
        var items = new List<DropDownData>();
        foreach (int value in Enum.GetValues(typeof(Responses)))
        {
            items.Add(new DropDownData
                          {
                              Text = Enum.GetName(typeof (Responses), value),
                              Value = value
                          });
        }
        return items;
    }
} 
```

然后在 ASPX 页面中添加一些 HTML 标记以指向这个 BO 类：

```
<asp:DropDownList ID="DropDownList1" runat="server" 
    DataSourceID="ObjectDataSource1" DataTextField="Text" DataValueField="Value">
</asp:DropDownList>
<asp:ObjectDataSource ID="ObjectDataSource1" runat="server" 
    SelectMethod="GetList" TypeName="DropDownData"></asp:ObjectDataSource> 
```

此选项不需要后面的代码。

**数据绑定背后的代码**

要最小化 ASPX 页面中的 HTML 并在 Code Behind 中进行绑定：

```
enum Responses { Yes = 1, No = 2, Maybe = 3 }

protected void Page_Load(object sender, EventArgs e)
{
    if (!IsPostBack)
    {
        foreach (int value in Enum.GetValues(typeof(Responses)))
        {
            DropDownList1.Items.Add(new ListItem(Enum.GetName(typeof(Responses), value), value.ToString()));
        }
    }
} 
```

无论如何，诀窍是让 GetValues、GetNames 等 Enum 类型的方法为您工作。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-09-15T07:16:24.397

我不确定如何在 ASP.NET 中执行此操作，但请查看[这篇](https://stackoverflow.com/questions/58743/databinding-an-enum-property-to-a-combobox-in-wpf#58819)文章……它可能会有所帮助吗？

```
Enum.GetValues(typeof(Response)); 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2015-11-17T21:48:26.243

你可以使用 linq：

```
var responseTypes= Enum.GetNames(typeof(Response)).Select(x => new { text = x, value = (int)Enum.Parse(typeof(Response), x) });
    DropDownList.DataSource = responseTypes;
    DropDownList.DataTextField = "text";
    DropDownList.DataValueField = "value";
    DropDownList.DataBind(); 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-02-12T10:29:06.360

```
Array itemValues = Enum.GetValues(typeof(TaskStatus));
Array itemNames = Enum.GetNames(typeof(TaskStatus));

for (int i = 0; i <= itemNames.Length; i++)
{
    ListItem item = new ListItem(itemNames.GetValue(i).ToString(),
    itemValues.GetValue(i).ToString());
    ddlStatus.Items.Add(item);
} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-06-29T08:36:49.187

```
public enum Color
{
    RED,
    GREEN,
    BLUE
}

ddColor.DataSource = Enum.GetNames(typeof(Color));
ddColor.DataBind(); 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2010-01-17T08:13:39.580

使用答案六的通用代码。

```
public static void BindControlToEnum(DataBoundControl ControlToBind, Type type)
{
    //ListControl

    if (type == null)
        throw new ArgumentNullException("type");
    else if (ControlToBind==null )
        throw new ArgumentNullException("ControlToBind");
    if (!type.IsEnum)
        throw new ArgumentException("Only enumeration type is expected.");

    Dictionary<int, string> pairs = new Dictionary<int, string>();

    foreach (int i in Enum.GetValues(type))
    {
        pairs.Add(i, Enum.GetName(type, i));
    }
    ControlToBind.DataSource = pairs;
    ListControl lstControl = ControlToBind as ListControl;
    if (lstControl != null)
    {
        lstControl.DataTextField = "Value";
        lstControl.DataValueField = "Key";
    }
    ControlToBind.DataBind();

} 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2010-03-24T22:24:50.850

找到这个答案后，我想出了我认为更好（至少更优雅）的方法，我想我会回来在这里分享。

页面加载：

```
DropDownList1.DataSource = Enum.GetValues(typeof(Response));
DropDownList1.DataBind(); 
```

加载值：

```
Response rIn = Response.Maybe;
DropDownList1.Text = rIn.ToString(); 
```

保存值：

```
Response rOut = (Response) Enum.Parse(typeof(Response), DropDownList1.Text); 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2017-02-24T21:08:40.150

这可能是一个老问题..但这就是我的做法。

模型：

```
public class YourEntity
{
   public int ID { get; set; }
   public string Name{ get; set; }
   public string Description { get; set; }
   public OptionType Types { get; set; }
}

public enum OptionType
{
    Unknown,
    Option1, 
    Option2,
    Option3
} 
```

然后在视图中：这里是如何使用填充下拉列表。

```
@Html.EnumDropDownListFor(model => model.Types, htmlAttributes: new { @class = "form-control" }) 
```

这应该填充枚举列表中的所有内容。希望这可以帮助..

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-15T07:11:28.043

这不是您要寻找的，但可能会有所帮助：

[http://blog.jeffhandley.com/archive/2008/01/27/enum-list-dropdown-control.aspx](http://blog.jeffhandley.com/archive/2008/01/27/enum-list-dropdown-control.aspx)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-12-02T10:02:31.243

为什么不使用这样的方式来传递每个 listControle ：

```
 public static void BindToEnum(Type enumType, ListControl lc)
        {
            // get the names from the enumeration
            string[] names = Enum.GetNames(enumType);
            // get the values from the enumeration
            Array values = Enum.GetValues(enumType);
            // turn it into a hash table
            Hashtable ht = new Hashtable();
            for (int i = 0; i < names.Length; i++)
                // note the cast to integer here is important
                // otherwise we'll just get the enum string back again
                ht.Add(names[i], (int)values.GetValue(i));
            // return the dictionary to be bound to
            lc.DataSource = ht;
            lc.DataTextField = "Key";
            lc.DataValueField = "Value";
            lc.DataBind();
        } 
```

使用很简单：

```
 BindToEnum(typeof(NewsType), DropDownList1);
BindToEnum(typeof(NewsType), CheckBoxList1);
BindToEnum(typeof(NewsType), RadoBuuttonList1); 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-11-18T17:10:37.920

ASP.NET 已经更新了一些更多的功能，您现在可以使用内置的枚举来下拉。

如果要绑定 Enum 本身，请使用以下命令：

```
@Html.DropDownList("response", EnumHelper.GetSelectList(typeof(Response))) 
```

如果您要绑定 Response 的实例，请使用以下命令：

```
// Assuming Model.Response is an instance of Response
@Html.EnumDropDownListFor(m => m.Response) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-02-25T18:12:47.923

这是我使用 LINQ 将枚举和数据绑定（文本和值）订购到下拉列表的解决方案

```
var mylist = Enum.GetValues(typeof(MyEnum)).Cast<MyEnum>().ToList<MyEnum>().OrderBy(l => l.ToString());
foreach (MyEnum item in mylist)
    ddlDivisao.Items.Add(new ListItem(item.ToString(), ((int)item).ToString())); 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-04-09T22:08:37.423

带有组合框和下拉列表的 asp.net 和 winforms 教程： [How to use Enum with Combobox in C# WinForms and Asp.Net](http://www.docstorus.com/viewer.aspx?code=833d27e2-5e3b-4ec0-b950-02c8fc2ec572&title=How%20to%20use%20Enum%20with%20Combobox%20in%20C#%20WinForms%20and%20Asp.Net)

希望有帮助

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2011-08-15T22:10:23.747

查看我关于创建自定义帮助程序“ASP.NET MVC - 为枚举创建 DropDownList 帮助程序”的帖子：http: [//blogs.msdn.com/b/stuartleeks/archive/2010/05/21/asp-net-mvc -creating-a-dropdownlist-helper-for-enums.aspx](http://blogs.msdn.com/b/stuartleeks/archive/2010/05/21/asp-net-mvc-creating-a-dropdownlist-helper-for-enums.aspx)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2011-10-13T07:19:45.117

如果您想在组合框（或其他控件）中有更用户友好的描述，您可以使用具有以下功能的 Description 属性：

```
 public static object GetEnumDescriptions(Type enumType)
    {
        var list = new List<KeyValuePair<Enum, string>>();
        foreach (Enum value in Enum.GetValues(enumType))
        {
            string description = value.ToString();
            FieldInfo fieldInfo = value.GetType().GetField(description);
            var attribute = fieldInfo.GetCustomAttributes(typeof(DescriptionAttribute), false).First();
            if (attribute != null)
            {
                description = (attribute as DescriptionAttribute).Description;
            }
            list.Add(new KeyValuePair<Enum, string>(value, description));
        }
        return list;
    } 
```

以下是应用了描述属性的枚举示例：

```
 enum SampleEnum
    {
        NormalNoSpaces,
        [Description("Description With Spaces")]
        DescriptionWithSpaces,
        [Description("50%")]
        Percent_50,
    } 
```

然后像这样绑定到控制...

```
 m_Combo_Sample.DataSource = GetEnumDescriptions(typeof(SampleEnum));
        m_Combo_Sample.DisplayMember = "Value";
        m_Combo_Sample.ValueMember = "Key"; 
```

这样，您可以在下拉列表中放置您想要的任何文本，而不必看起来像变量名

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2012-03-28T01:32:44.740

您还可以使用扩展方法。对于那些不熟悉扩展的人，我建议查看[VB](http://msdn.microsoft.com/en-us/library/bb384936.aspx)和[C#](http://msdn.microsoft.com/en-us/library/bb383977.aspx)文档。

* * *

VB 扩展：

```
Namespace CustomExtensions
    Public Module ListItemCollectionExtension

        <Runtime.CompilerServices.Extension()> _
        Public Sub AddEnum(Of TEnum As Structure)(items As System.Web.UI.WebControls.ListItemCollection)
            Dim enumerationType As System.Type = GetType(TEnum)
            Dim enumUnderType As System.Type = System.Enum.GetUnderlyingType(enumType)

            If Not enumerationType.IsEnum Then Throw New ArgumentException("Enumeration type is expected.")

            Dim enumTypeNames() As String = System.Enum.GetNames(enumerationType)
            Dim enumTypeValues() As TEnum = System.Enum.GetValues(enumerationType)

            For i = 0 To enumTypeNames.Length - 1
                items.Add(New System.Web.UI.WebControls.ListItem(saveResponseTypeNames(i), TryCast(enumTypeValues(i), System.Enum).ToString("d")))
            Next
        End Sub
    End Module
End Namespace 
```

要使用扩展：

```
Imports <projectName>.CustomExtensions.ListItemCollectionExtension

...

yourDropDownList.Items.AddEnum(Of EnumType)() 
```

* * *

C# 扩展：

```
namespace CustomExtensions
{
    public static class ListItemCollectionExtension
    {
        public static void AddEnum<TEnum>(this System.Web.UI.WebControls.ListItemCollection items) where TEnum : struct
        {
            System.Type enumType = typeof(TEnum);
            System.Type enumUnderType = System.Enum.GetUnderlyingType(enumType);

            if (!enumType.IsEnum) throw new Exception("Enumeration type is expected.");

            string[] enumTypeNames = System.Enum.GetNames(enumType);
            TEnum[] enumTypeValues = (TEnum[])System.Enum.GetValues(enumType);

            for (int i = 0; i < enumTypeValues.Length; i++)
            {
                items.add(new System.Web.UI.WebControls.ListItem(enumTypeNames[i], (enumTypeValues[i] as System.Enum).ToString("d")));
            }
        }
    }
} 
```

要使用扩展：

```
using CustomExtensions.ListItemCollectionExtension;

...

yourDropDownList.Items.AddEnum<EnumType>() 
```

* * *

如果要同时设置选中的项目替换

```
items.Add(New System.Web.UI.WebControls.ListItem(saveResponseTypeNames(i), saveResponseTypeValues(i).ToString("d"))) 
```

和

```
Dim newListItem As System.Web.UI.WebControls.ListItem
newListItem = New System.Web.UI.WebControls.ListItem(enumTypeNames(i), Convert.ChangeType(enumTypeValues(i), enumUnderType).ToString())
newListItem.Selected = If(EqualityComparer(Of TEnum).Default.Equals(selected, saveResponseTypeValues(i)), True, False)
items.Add(newListItem) 
```

通过转换为 System.Enum 而不是 int 大小和输出问题可以避免。例如，0xFFFF0000 作为 uint 将是 4294901760，但作为 int 将是 -65536。

TryCast 和 as System.Enum 比 Convert.ChangeType(enumTypeValues[i], enumUnderType).ToString() 稍快（在我的速度测试中为 12:13）。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2017-01-09T17:15:39.707

接受的解决方案不起作用，但下面的代码将帮助其他人寻找最短的解决方案。

```
 foreach (string value in Enum.GetNames(typeof(Response)))
                    ddlResponse.Items.Add(new ListItem()
                    {
                        Text = value,
                        Value = ((int)Enum.Parse(typeof(Response), value)).ToString()
                    }); 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-12-18T15:07:16.490

您可以更短地执行此操作

```
public enum Test
    {
        Test1 = 1,
        Test2 = 2,
        Test3 = 3
    }
    class Program
    {
        static void Main(string[] args)
        {

            var items = Enum.GetValues(typeof(Test));

            foreach (var item in items)
            {
                //Gives you the names
                Console.WriteLine(item);
            }

            foreach(var item in (Test[])items)
            {
                // Gives you the numbers
                Console.WriteLine((int)item);
            }
        }
    } 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-11-03T18:55:18.610

对于我们这些想要一个适用于任何 drop 和 enum 的有效 C# 解决方案的人......

```
private void LoadConsciousnessDrop()
{
    string sel_val = this.drp_Consciousness.SelectedValue;
    this.drp_Consciousness.Items.Clear();
    string[] names = Enum.GetNames(typeof(Consciousness));

    for (int i = 0; i < names.Length; i++)
        this.drp_Consciousness.Items.Add(new ListItem(names[i], ((int)((Consciousness)Enum.Parse(typeof(Consciousness), names[i]))).ToString()));

    this.drp_Consciousness.SelectedValue = String.IsNullOrWhiteSpace(sel_val) ? null : sel_val;
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-02-28T02:31:19.357

我意识到这篇文章较旧且适用于 Asp.net，但我想提供一个我最近用于 ac# Windows Forms Project 的解决方案。这个想法是建立一个字典，其中键是枚举元素的名称，值是枚举值。然后将字典绑定到组合框。请参阅将 ComboBox 和 Enum 类型作为参数的通用函数。

```
 private void BuildComboBoxFromEnum(ComboBox box, Type enumType) {
        var dict = new Dictionary<string, int>();
        foreach (var foo in Enum.GetValues(enumType)) {
            dict.Add(foo.ToString(), (int)foo);
        }
        box.DropDownStyle = ComboBoxStyle.DropDownList; // Forces comboBox to ReadOnly
        box.DataSource = new BindingSource(dict, null);
        box.DisplayMember = "Key";
        box.ValueMember = "Value";
        // Register a callback that prints the Name and Value of the 
        // selected enum. This should be removed after initial testing.
        box.SelectedIndexChanged += (o, e) => {
            Console.WriteLine("{0} {1}", box.Text, box.SelectedValue);
        };
    } 
```

该功能可以按如下方式使用：

```
BuildComboBoxFromEnum(comboBox1,typeof(Response)); 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-06-25T19:38:39.460

在 ASP.NET Core 中，您可以使用以下 Html 帮助程序（来自 Microsoft.AspNetCore.Mvc.Rendering）：

```
<select asp-items="Html.GetEnumSelectList<GridReportingStatusFilters>()">
     <option value=""></option>
</select> 
```

# svn - TFS 与开源替代方案？

> ID：61959
> 
> 赞同：7
> 
> 时间：2008-09-15T07:07:47.490
> 
> 标签：svn, open-source, tfs, cruisecontrol.net

我们目前正在为 .NET 开发设置源代码控制/构建/和更多服务器，我们正在考虑使用 Team Foundation Server（花费大量资金）或结合几个开源选项，如 SourceForge Enterprise/GForge 和 Subversion 和 CruiseControl.net 等。有没有人走过完整的 OSS 道路，或者只有当你想把它做好并尽快开始工作时才使用 TFS？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T07:33:03.840

我的工作目前主要使用以巡航控制为引擎的 OSS 构建过程，它很棒。我建议，如果您不知道为什么需要 TFS，那么这可能不值得。

对于 OSS，您必须牢记的是，该软件要么已被 Java 团队使用多年，要么该软件是类似 Java 代码的移植。它坚固耐用，适合用途。

微软不能发布 OSS 代码，这就是为什么他们必须重新实现很多开源的东西。所以，不，没有必要，并且已经有数百万个项目在该堆栈上交付。另一方面，您可以通过 TFS 获得许多通过 OSS 堆栈无法（轻松）获得的不错的功能，例如与您的错误/功能跟踪软件的集成。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T08:18:29.440

我一直走 OSS 的方式，从来没有遇到过问题。我还强烈推荐 TeamCity 用于您的 CI 解决方案。有一个免费许可证，我认为它使 CC.NET 脱颖而出，便于配置和反馈。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T09:52:44.160

大约 1.5 年以来，我一直是 TFS 的日常用户。

*   源代码控制稳定
*   你不能轻易断网工作。文件签出到服务器。
*   自动合并效果很好，但有时它会损坏源文件（编码问题）。
*   TFS有一种呆滞的感觉！？尤其是测试经理。托管代码？
*   测试部分有各种愚蠢的错误，没什么关键的。
*   测试运行需要很长时间才能开始（待定）。
*   我偶尔会遇到 SQL 死锁！？
*   问题跟踪很烂恕我直言。您被迫在缓慢的集成对话框中工作，网页仅显示。我建议将其与其他问题跟踪系统（如[JIRA ）进行比较](http://www.atlassian.com/software/jira/)
*   构建工作正常。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T12:16:25.360

如果您使用的是 TFS，请确保安装 VSTS2008SP1。我见过的绝大多数发布投诉的人都在使用 2005 版。2005年是典型的“微软1.0”综合症。后来的两个“版本”已经解决了很多问题。

2008 年的 Service Pack 不仅仅是一个错误修复 - 而是添加了许多新功能。

至于选择与 OSS - 有很多讨论（这里和其他地方）。它不是一个便宜的产品——但它是很多场景的最佳选择（对其他场景来说也是最糟糕的选择）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T14:56:08.783

我们查看了 TFS，但最终选择了 Subversion + Trac + VisualSVN。我们现在不做 CI，但我认为 Cruisecontrol 将是我们会使用的。

我开始在许多开源项目中使用 Trac，它很棒。它实际上只是 TFS 功能的一部分，因此您必须在那里做出决定——如果您使用所有东西，TFS 可能会更好地将它们结合在一起。Trac 是一个 wiki/bug 跟踪器/源浏览器。一切都是链接的——当您输入 WikiPage 的名称或在提交消息中说“Fix bug #1234”时，只要您在 Trac 中看到该消息，链接就会转到正确的位置。它是一种工具，可以帮助您完成工作，但通常不会妨碍您。

VisualSVN 是 TortoiseSVN（一个 Subversion 客户端）和 VisualStudio 之间的桥梁，极大地提高了生产力。他们有一个免费试用版，之后它不是很贵（50 美元/用户），但非常值得。

Trac 的一个可能缺点是在 Windows 世界中，在 IIS 上工作很痛苦。我已经安装了很多次 Trac，但很快就因为试图让它正常工作而感到沮丧。我最终在不同的 IP 上安装了 Apache（也可以使用不同的端口），然后它是无缝的。

除了我团队中的一个人（他有一点经验），以前没有人使用过颠覆。一对夫妇使用过 VSS，仅此而已。每个人都很怀疑，但我会说几天之内他们都皈依了。在完全学习了 Trac 并习惯了一切（再过几天）之后，每个人都完全被卖掉了并且喜欢它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T07:32:59.830

我们公司使用 CruiseControl/SVN/nAnt/JIRA 组合取得了巨大成功。

TFS 的交易破坏者是它只对大公司值得。对于拥有 30 名或更少开发人员的小公司来说，这将是非常昂贵的，它们已经从上述开源组合中受益匪浅。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T10:31:22.960

Subversion + Cruisecontol.Net 是一个不错的选择。SVN 功能丰富、稳定且灵活。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T15:48:44.560

与一组单独的 OS 工具相比，使用 TFS 的真正好处是集成了各种可用的信息流。

* 创建一个需求并插入到 TFS
* 创建一组将它们链接到需求的任务并将它们分配给各个开发人员
* 每个开发人员处理他的任务并签入，将任务分配给签入的变更集
* 一个错误修复进来，同样在这种情况下，更改集将与错误修复请求协调，您还可以将错误修复映射到原始需求

一旦完成，所有信息都可以用于跟踪项目并评估工作，例如一个 bug 修复导致了多少更改，即产生了更多 bug 或更改请求的需求等等。

所有这些信息在大中型组织中都非常有用，而且据我现在所见，不可能（或非常难以）跟踪集成不同的操作系统工具。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-29T10:01:05.033

TFS 堆栈不仅仅是源代码控制和 CI/夜间构建设置。想想项目管理、错误报告，所有这些加起来不仅仅是 CruiseControl、SVN 和 NAnt。仅报告本身就值得投资。还要记住，如果您是 MSDN 订阅者/ISV 金牌合作伙伴/等。您可能会免费获得其中的一些...

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-03-31T21:53:56.980

我最近才开始每天使用 TFS，并且来自以前的开源堆栈，我发现它非常缺乏。

虽然所有错误和任务跟踪的集成是一个非常棒的功能，但负面因素超过了它。

我个人使用以下堆栈，它为我提供了我们需要做的一切，从持续集成到企业规模的自动化部署，成本只是其中的一小部分：

*   [颠覆](http://subversion.tigris.org/)
*   [哈德逊](http://hudson-ci.org/)
*   [封面](http://www.ncover.com/)
*   [依赖](http://www.ndepend.com/)
*   [四面](http://www.harukizaemon.com/simian/)
*   [吉拉](http://www.google.com.au/url?sa=t&source=web&cd=1&ved=0CCwQFjAA&url=http://www.atlassian.com/software/jira/&rct=j&q=jira&ei=nPeUTe2KNoLBcauk9JwH&usg=AFQjCNGx2m653qgbdvjNB8XxITgsQAI6eg&cad=rja)
*   [Jira 和 Subversion 集成](https://studio.plugins.atlassian.com/wiki/display/SVN/Subversion+JIRA+plugin)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T07:33:52.997

我已经看到了这两种情况（尽管我是一名 Java 开发人员）。选择和混合方法的好处是您可以为所有内容选择最好的位（例如，我会查看 Hudson 的 CI - 它非常适合 Java，也适用于 .Net，并且具有*大量*插件，并且使用起来非常简单）。缺点是您必须自己完成所有集成。然而，这在 Java 世界中变得容易*多了。*另外，不要让人们告诉您受支持的产品更好。在这个领域的许多 OSS 产品上，质量非常好，您可以从社区获得*更好*的支持，而不是等待供应商支持合同的答复（IBM，我在看你）

希望这可以帮助。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-15T08:04:06.933

我强烈同意只有在您确切知道自己需要什么的情况下才值得使用 TFS 的观点。Visual SVN 和 TestDriven.Net 等基于 OSS 的廉价或免费插件非常好，以至于与 VS 的集成已经是无缝的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-15T10:12:21.320

我想我会提出一个新的观点，因为我还没有尝试过，但我计划在即将到来的项目中使用[Bitten进行 CI。](http://bitten.edgewall.org/)这在 Trac+SVN 上运行，这两个都是我成功用于许多项目的好工具。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-15T14:27:07.950

我们在这里逐渐建立了一个开发堆栈，我们目前正在使用：

*   颠覆
*   巡航控制
*   RedMine（将错误跟踪与源代码控制集成在一起，包括 wiki、基本项目管理等）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-29T19:59:42.987

我认为 TFS 对于上述帖子中提到的所有额外功能都是值得的。虽然它的连续构建功能严重缺乏，所以我们使用 CruiseControl.NET 来增强该部分，这很棒。如果我们现在就选择 TFS，我们选择反对 TFS 的唯一原因是我们正在转向跨平台开发我们的产品。因此，如果您甚至考虑过这一点，请考虑 OSS。Subversion/Trac 将是我最喜欢的组合，CruiseCONtrol.NET 仍然是主干。使用 mono 的 CC.NET 在 Linux 和 Mac 上运行良好。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-05-24T10:12:27.873

TFS2010 有一个 TFS Basic，它不需要任何费用（除了您的 msdn 订阅/visual studio 许可证之外）。每个 VS 许可证限制为 1 个，但您只需要为非 VS 用户提供额外的许可证

仅 VS2010 中的 UI 自动化就使 TFS 胜过拼凑开源解决方案

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-09-12T17:13:07.210

值得一提的是，广泛的 TFS 功能的最佳替代品不一定是 OSS，而是低预算的商业，例如用于代码质量和架构探索的[NDepend](http://www.ndepend.com/) ，用于代码覆盖的[NCover](http://www.ncover.com/) ，用于测试嵌套在 IDE 中的[TestDriven.NET ……](http://www.testdriven.net/)

# oracle - 如何在不同的表空间中导入 oracle 转储

> ID：61963
> 
> 赞同：38
> 
> 时间：2008-09-15T07:15:53.803
> 
> 标签：oracle, oracle-dump

我想将 oracle 转储导入不同的表空间。

我有一个用户 A 使用的表空间 A。我已经撤销了该用户的 DBA 并给了他授权连接和资源。然后我用命令转储了所有东西

> exp a/*** 所有者=a 文件=oracledump.DMP 日志=log.log 压缩=y

现在我想将转储导入用户 B 使用的表空间 B。所以我给了他连接和资源的授权（没有 DBA）。然后我执行了以下导入：

> imp b/*** 文件=oracledump.DMP 日志=import.log fromuser=a touser=b

结果是一个有很多错误的日志：

> IMP-00017：以下语句失败并出现 ORACLE 错误 20001：“BEGIN DBMS_STATS.SET_TABLE_STATS IMP-00003：遇到 ORACLE 错误 20001 ORA-20001：输入值无效或不一致

之后，我尝试了相同的导入命令，但使用了选项 statistics=none。这导致了以下错误：

> ORA-00959: 表空间 'A_TBLSPACE' 不存在

这应该怎么做？

注意：很多列都是 CLOB 类型的。看起来问题与此有关。

注意 2：oracle 版本是 9.2、10.1 和 10.1 XE 的混合版本。但我认为这与版本无关。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-16T12:47:33.950

你这里有几个问题。

**首先**，您使用的不同版本的 Oracle 是导致表统计错误的原因 - 当我们的一些 Oracle 10g 数据库升级到第 2 版时，我遇到了同样的问题，有些还在第 1 版上，我正在交换。它们之间的 DMP 文件。

对我有用的解决方案是使用相同版本的`exp`和`imp`工具在不同的数据库实例上进行导出和导入。通过使用同一台 PC（或 Oracle 服务器）发出所有导出和导入命令，这是最容易做到的。

**其次**，我怀疑您`ORA-00959: tablespace 'A_TBLSPACE' does not exist`正在尝试将 .DMP 文件从成熟的 Oracle 数据库导入到 10g 快捷版 (XE) 数据库中，该数据库默认情况下会创建一个`USERS`名为你。

如果是这种情况，那么您需要执行以下操作..

1.  使用您的 .DMP 文件，创建一个包含结构（表）的 SQL 文件：

    `imp <xe_username>/<password>@XE file=<filename.dmp> indexfile=index.sql full=y`

2.  在可以查找和替换整个文件的文本编辑器中打开索引文件 (index.sql)，然后按顺序发出以下查找和替换语句（忽略单引号..'）：

    `Find: 'REM<space>' Replace: <nothing>`

    `Find: '"<source_tablespace>"' Replace: '"USERS"'`

    `Find: '...' Replace: 'REM ...'`

    `Find: 'CONNECT' Replace: 'REM CONNECT'`

3.  保存索引文件，然后针对您的 Oracle Express Edition 帐户运行它（我发现最好创建一个新的空白 XE 用户帐户 - 如果我正在刷新，则删除并重新创建）：

    `sqlplus <xe_username>/<password>@XE @index.sql`

4.  最后，针对同一帐户运行您创建索引文件的相同 .DMP 文件，以导入数据、存储过程、视图等：

    `imp <xe_username>/<password>@XE file=<filename.dmp> fromuser=<original_username> touser=<xe_username> ignore=y`

当您尝试创建某些对象（例如数据库作业）时，您可能会收到几页 Oracle 错误，因为 Oracle 将尝试使用相同的数据库标识符，当您使用不同的数据库时，这很可能会失败。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-15T15:15:42.543

如果您使用的是 Oracle 10g 和数据泵，则可以使用 REMAP_TABLESPACE 子句。例子：

```
REMAP_TABLESPACE=A_TBLSPACE:NEW_TABLESPACE_GOES_HERE 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-07-20T11:05:33.240

对我来说，这项工作没问题（Oracle 数据库 10g 快捷版 10.2.0.1.0 版）：

```
impdp B/B full=Y dumpfile=DUMP.dmp REMAP_TABLESPACE=OLD_TABLESPACE:USERS 
```

但是对于新的还原，您需要新的表空间

PS也许有用[http://www.oracle-base.com/articles/10g/OracleDataPump10g.php](http://www.oracle-base.com/articles/10g/OracleDataPump10g.php)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-15T13:36:29.287

您使用的是什么版本的 Oracle？如果它是 10g 或更大，您应该考虑使用数据泵而不是导入/导出。我不是 100% 确定它是否可以处理这种情况，但我希望它可以。

[Data Pump](http://www.oracle.com/technology/products/database/utilities/index.html)是 10g 及以上的 exp/imp 的替代品。它的工作方式与 exp/imp 非常相似，除了它（据说，我不使用它，因为我被困在 9i 土地上）更好。

[这是数据泵文档](http://download.oracle.com/docs/cd/B19306_01/server.102/b14215/part_dp.htm#CEGJCCHC)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T09:53:47.840

问题与 CLOB 列有关。似乎 imp 工具无法重写 create 语句以使用另一个表空间。

来源：[http ://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:66890284723848](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:66890284723848)

解决方案是：在正确的表空间中手动创建模式。如果您没有创建架构的脚本，您可以使用 imp 工具的 indexfile= 创建它。

您必须自己禁用所有约束，oracle imp 工具不会禁用它们。

之后，您可以使用以下命令导入数据：

> imp b/*** 文件=oracledump.dmp 日志=import.log fromuser=a touser=b 统计=none 忽略=y

注意：由于其他错误，我仍然需要统计信息=无。

***有关数据泵的额外信息***

从 Oracle 10 开始，导入/导出得到了改进：数据泵工具 ([ [http://www.oracle-base.com/articles/10g/OracleDataPump10g.php][1]](http://www.oracle-base.com/articles/10g/OracleDataPump10g.php][1]) )

使用它将数据重新导入新表空间：

1.  首先为临时转储创建一个目录：

    > 创建或替换目录 tempdump 为 '/temp/tempdump/';
    > 将目录临时转储授予读取、写入到 a；

2.  出口：

    > expdp a/* schemas=a 目录=tempdump dumpfile=adump.dmp logfile=adump.log

3.  进口：

    > impdp b/* 目录=tempdump 转储文件=adump.dmp 日志文件=bdump.log REMAP_SCHEMA=a:b

注意：转储文件是从服务器磁盘存储和读取的，而不是从本地（客户端）磁盘

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-03-08T14:53:35.277

我的解决方案是使用 GSAR 实用程序替换 DUMP 文件中的表空间名称。当您执行 replce 时，请确保通过添加空格来保持转储文件的大小不变。例如

```
gsar -f -s"TSDAT_OV101" -r"USERS      " rm_schema.dump rm_schema.n.dump
gsar -f -s"TABLESPACE """USERS      """ ENABLE STORAGE IN ROW CHUNK 8192 RETENTION" -r"                                                                   " rm_schema.n1.dump rm_schema.n.dump
gsar -f -s"TABLESPACE """USERS      """ LOGGING" -r"                                  " rm_schema.n1.dump rm_schema.n.dump
gsar -f -s"TABLESPACE """USERS      """ " -r"                             " rm_schema.n.dump rm_schema.n1.dump 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-11-22T14:28:48.963

我想为不同服务器（数据库）上不同表空间中的两个用户改进

**1.首先为两台服务器（数据库）的临时转储创建一个目录：**

*服务器＃1：*

```
CREATE OR REPLACE DIRECTORY tempdump AS '/temp/old_datapump/';
GRANT READ, WRITE ON DIRECTORY tempdump TO old_user; 
```

*服务器＃2：*

```
CREATE OR REPLACE DIRECTORY tempdump AS '/temp/new_datapump/';
GRANT READ, WRITE ON DIRECTORY tempdump TO new_user; 
```

**2\. 导出（服务器 #1）：**

```
expdp tables=old_user.table directory=tempdump dumpfile=adump.dmp logfile=adump.log 
```

**3\. 导入（服务器#2）：**

```
impdp directory=tempdump dumpfile=adump_table.dmp logfile=bdump_table.log
REMAP_TABLESPACE=old_tablespace:new_tablespace REMAP_SCHEMA=old_user:new_user 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-03T13:07:09.353

答案很困难，但可行：

情况是：用户**A**和表空间**X**

1.  将您的转储文件导入不同的数据库（仅当您需要保留原始文件的副本时才需要这样做）
2.  重命名表空间

    将表空间**X**重命名为**Y**

3.  为 expdp 命令创建目录 en 授予权限

4.  使用 expdp 创建转储
5.  删除旧用户和旧表空间 ( **Y** )
6.  创建新表空间 ( **Y** )
7.  创建新用户（使用新名称） - 在本例中为**B** - 并授予权限（也授予使用第 3 步创建的目录）
8.  使用 impdp 导入转储

    impdp B/B 目录=DIR 转储文件=DUMPFILE.dmp 日志文件=LOGFILE.log REMAP_SCHEMA= **A** : **B**

就是这样……

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-02-01T18:07:46.937

因为我想对`imp`（到 Oracle 12.1|2）一个`exp`从本地开发数据库（18c xe）中提取的转储进行 ort，并且我知道我的所有目标数据库都将有一个名为 的可访问表空间`DATABASE_TABLESPACE`，所以我刚刚创建了我的模式/用户使用该名称的新表空间而不是默认表空间`USERS`（我无法访问目标数据库）：

```
-- don't care about the details
CREATE TABLESPACE DATABASE_TABLESPACE
  DATAFILE 'DATABASE_TABLESPACE.dat' 
    SIZE 10M
    REUSE
    AUTOEXTEND ON NEXT 10M MAXSIZE 200M;

ALTER DATABASE DEFAULT TABLESPACE DATABASE_TABLESPACE;

CREATE USER username
  IDENTIFIED BY userpassword
  CONTAINER=all;

GRANT create session TO username;
GRANT create table TO username;
GRANT create view TO username;
GRANT create any trigger TO username;
GRANT create any procedure TO username;
GRANT create sequence TO username;
GRANT create synonym TO username;
GRANT create synonym TO username;
GRANT UNLIMITED TABLESPACE TO username; 
```

`exp`由此创建的一个让`imp`我的目标感到高兴。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2013-11-18T20:36:40.790

---创建新表空间：

CREATE TABLESPACE TABLESPACENAME DATAFILE 'D:\ORACL\ORADATA\XE\TABLESPACEFILENAME.DBF' SIZE 350M AUTOEXTEND ON NEXT 2500M MAXSIZE UNLIMITED LOGGING PERMANENT EXTENT MANAGEMENT LOCAL AUTOALLOCATE BLOCKSIZE 8K SEGMENT SPACE MANAGEMENT MANUAL FLASHBACK ON；

---然后使用以下命令导入

CREATE USER BVUSER IDENTIFIED by VALUES 'bvuser' DEFAULT TABLESPACE TABLESPACENAME

-- 其中 D:\ORACL 是 oracle 安装路径

# sql-server - 有没有办法在不使用游标的情况下循环遍历 TSQL 中的表变量？

> ID：61967
> 
> 赞同：281
> 
> 时间：2008-09-15T07:18:51.347
> 
> 标签：sql-server, tsql, loops

假设我有以下简单的表变量：

```
declare @databases table
(
    DatabaseID    int,
    Name        varchar(15),   
    Server      varchar(15)
)
-- insert a bunch rows into @databases 
```

如果我想遍历行，声明和使用游标是我唯一的选择吗？还有其他方法吗？

* * *

## 回答 #1

> 赞同：416
> 
> 时间：2008-09-15T10:42:15.260

首先，你应该绝对确定你需要遍历每一行——基于集合的操作在我能想到的每一种情况下都会执行得更快，并且通常会使用更简单的代码。

根据您的数据，可能只使用`SELECT`如下所示的语句进行循环：

```
Declare @Id int

While (Select Count(*) From ATable Where Processed = 0) > 0
Begin
    Select Top 1 @Id = Id From ATable Where Processed = 0

    --Do some processing here

    Update ATable Set Processed = 1 Where Id = @Id 

End 
```

另一种选择是使用临时表：

```
Select *
Into   #Temp
From   ATable

Declare @Id int

While (Select Count(*) From #Temp) > 0
Begin

    Select Top 1 @Id = Id From #Temp

    --Do some processing here

    Delete #Temp Where Id = @Id

End 
```

您应该选择的选项实际上取决于数据的结构和数量。

**注意：**如果您使用的是 SQL Server，则最好使用：

```
WHILE EXISTS(SELECT * FROM #Temp) 
```

使用`COUNT`必须触摸表格中的每一行，`EXISTS`只需要触摸第一行（见下面[约瑟夫的回答](https://stackoverflow.com/a/65294/963542)）。

* * *

## 回答 #2

> 赞同：145
> 
> 时间：2008-09-15T18:12:36.767

只是一个简短的说明，如果您使用的是 SQL Server（2008 及更高版本），则具有以下示例：

```
While (Select Count(*) From #Temp) > 0 
```

会更好地服务

```
While EXISTS(SELECT * From #Temp) 
```

Count 必须触摸表格中的每一行，`EXISTS`只需要触摸第一行。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2010-01-18T08:38:42.713

我就是这样做的：

```
declare @RowNum int, @CustId nchar(5), @Name1 nchar(25)

select @CustId=MAX(USERID) FROM UserIDs     --start with the highest ID
Select @RowNum = Count(*) From UserIDs      --get total number of records
WHILE @RowNum > 0                          --loop until no more records
BEGIN   
    select @Name1 = username1 from UserIDs where USERID= @CustID    --get other info from that row
    print cast(@RowNum as char(12)) + ' ' + @CustId + ' ' + @Name1  --do whatever

    select top 1 @CustId=USERID from UserIDs where USERID < @CustID order by USERID desc--get the next one
    set @RowNum = @RowNum - 1                               --decrease count
END 
```

没有游标，没有临时表，没有额外的列。与大多数主键一样，USERID 列必须是唯一的整数。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-09-16T21:55:07.350

像这样定义您的临时表 -

```
declare @databases table
(
    RowID int not null identity(1,1) primary key,
    DatabaseID    int,
    Name        varchar(15),   
    Server      varchar(15)
)

-- insert a bunch rows into @databases 
```

然后这样做 -

```
declare @i int
select @i = min(RowID) from @databases
declare @max int
select @max = max(RowID) from @databases

while @i <= @max begin
    select DatabaseID, Name, Server from @database where RowID = @i --do some stuff
    set @i = @i + 1
end 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-09-15T13:48:28.697

这是我的做法：

```
Select Identity(int, 1,1) AS PK, DatabaseID
Into   #T
From   @databases

Declare @maxPK int;Select @maxPK = MAX(PK) From #T
Declare @pk int;Set @pk = 1

While @pk <= @maxPK
Begin

    -- Get one record
    Select DatabaseID, Name, Server
    From @databases
    Where DatabaseID = (Select DatabaseID From #T Where PK = @pk)

    --Do some processing here
    -- 

    Select @pk = @pk + 1
End 
```

* * *

[编辑] 因为我第一次阅读问题时可能跳过了“变量”这个词，所以这里有一个更新的回复......

* * *

```
declare @databases table
(
    PK            int IDENTITY(1,1), 
    DatabaseID    int,
    Name        varchar(15),   
    Server      varchar(15)
)
-- insert a bunch rows into @databases
--/*
INSERT INTO @databases (DatabaseID, Name, Server) SELECT 1,'MainDB', 'MyServer'
INSERT INTO @databases (DatabaseID, Name, Server) SELECT 1,'MyDB',   'MyServer2'
--*/

Declare @maxPK int;Select @maxPK = MAX(PK) From @databases
Declare @pk int;Set @pk = 1

While @pk <= @maxPK
Begin

    /* Get one record (you can read the values into some variables) */
    Select DatabaseID, Name, Server
    From @databases
    Where PK = @pk

    /* Do some processing here */
    /* ... */ 

    Select @pk = @pk + 1
End 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-16T21:03:25.133

如果您别无选择，只能逐行创建 FAST_FORWARD 游标。它将与建立一个while循环一样快，并且更容易长期维护。

FAST_FORWARD 指定启用了性能优化的 FORWARD_ONLY、READ_ONLY 游标。如果同时指定了 SCROLL 或 FOR_UPDATE，则无法指定 FAST_FORWARD。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-05-02T15:59:53.023

这将适用于 SQL SERVER 2012 版本。

```
declare @Rowcount int 
select @Rowcount=count(*) from AddressTable;

while( @Rowcount>0)
  begin 
 select @Rowcount=@Rowcount-1;
 SELECT * FROM AddressTable order by AddressId desc OFFSET @Rowcount ROWS FETCH NEXT 1 ROWS ONLY;
end 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-15T07:38:40.100

您可以使用 while 循环：

```
While (Select Count(*) From #TempTable) > 0
Begin
    Insert Into @Databases...

    Delete From #TempTable Where x = x
End 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-07-18T03:05:21.613

另一种无需更改架构或使用临时表的方法：

```
DECLARE @rowCount int = 0
  ,@currentRow int = 1
  ,@databaseID int
  ,@name varchar(15)
  ,@server varchar(15);

SELECT @rowCount = COUNT(*)
FROM @databases;

WHILE (@currentRow <= @rowCount)
BEGIN
  SELECT TOP 1
     @databaseID = rt.[DatabaseID]
    ,@name = rt.[Name]
    ,@server = rt.[Server]
  FROM (
    SELECT ROW_NUMBER() OVER (
        ORDER BY t.[DatabaseID], t.[Name], t.[Server]
       ) AS [RowNumber]
      ,t.[DatabaseID]
      ,t.[Name]
      ,t.[Server]
    FROM @databases t
  ) rt
  WHERE rt.[RowNumber] = @currentRow;

  EXEC [your_stored_procedure] @databaseID, @name, @server;

  SET @currentRow = @currentRow + 1;
END 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2016-05-04T18:26:06.603

轻量级，无需制作额外的表格，如果你`ID`的桌子上有一个整数

```
Declare @id int = 0, @anything nvarchar(max)
WHILE(1=1) BEGIN
  Select Top 1 @anything=[Anything],@id=@id+1 FROM Table WHERE ID>@id
  if(@@ROWCOUNT=0) break;

  --Process @anything

END 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-25T04:58:21.170

我真的不明白为什么您需要使用 dreaded `cursor`。但如果您使用的是 SQL Server 版本 2005/2008
使用**递归，这里还有一个选项**

```
declare @databases table
(
    DatabaseID    int,
    Name        varchar(15),   
    Server      varchar(15)
)

--; Insert records into @databases...

--; Recurse through @databases
;with DBs as (
    select * from @databases where DatabaseID = 1
    union all
    select A.* from @databases A 
        inner join DBs B on A.DatabaseID = B.DatabaseID + 1
)
select * from DBs 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2012-04-29T11:10:38.087

```
-- [PO_RollBackOnReject]  'FININV10532'
alter procedure PO_RollBackOnReject
@CaseID nvarchar(100)

AS
Begin
SELECT  *
INTO    #tmpTable
FROM   PO_InvoiceItems where CaseID = @CaseID

Declare @Id int
Declare @PO_No int
Declare @Current_Balance Money

While (Select ROW_NUMBER() OVER(ORDER BY PO_LineNo DESC) From #tmpTable) > 0
Begin
        Select Top 1 @Id = PO_LineNo, @Current_Balance = Current_Balance,
        @PO_No = PO_No
        From #Temp
        update PO_Details
        Set  Current_Balance = Current_Balance + @Current_Balance,
            Previous_App_Amount= Previous_App_Amount + @Current_Balance,
            Is_Processed = 0
        Where PO_LineNumber = @Id
        AND PO_No = @PO_No
        update PO_InvoiceItems
        Set IsVisible = 0,
        Is_Processed= 0
        ,Is_InProgress = 0 , 
        Is_Active = 0
        Where PO_LineNo = @Id
        AND PO_No = @PO_No
End
End 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-03-13T09:44:21.560

可以使用游标来执行此操作：

创建函数 [dbo].f_teste_loop 返回 @tabela 表 ( cod int, nome varchar(10) ) 作为开始

```
insert into @tabela values (1, 'verde');
insert into @tabela values (2, 'amarelo');
insert into @tabela values (3, 'azul');
insert into @tabela values (4, 'branco');

return; 
```

结尾

创建过程 [dbo].[sp_teste_loop] 作为开始

```
DECLARE @cod int, @nome varchar(10);

DECLARE curLoop CURSOR STATIC LOCAL 
FOR
SELECT  
    cod
   ,nome
FROM 
    dbo.f_teste_loop();

OPEN curLoop;

FETCH NEXT FROM curLoop
           INTO @cod, @nome;

WHILE (@@FETCH_STATUS = 0)
BEGIN
    PRINT @nome;

    FETCH NEXT FROM curLoop
           INTO @cod, @nome;
END

CLOSE curLoop;
DEALLOCATE curLoop; 
```

结尾

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-01-25T19:32:32.833

我将提供基于集合的解决方案。

```
insert  @databases (DatabaseID, Name, Server)
select DatabaseID, Name, Server 
From ... (Use whatever query you would have used in the loop or cursor) 
```

这比任何循环技术都要快得多，并且更容易编写和维护。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-10-18T13:36:00.180

如果您有唯一的 ID，我更喜欢使用 Offset Fetch，您可以通过以下方式对表格进行排序：

```
DECLARE @TableVariable (ID int, Name varchar(50));
DECLARE @RecordCount int;
SELECT @RecordCount = COUNT(*) FROM @TableVariable;

WHILE @RecordCount > 0
BEGIN
SELECT ID, Name FROM @TableVariable ORDER BY ID OFFSET @RecordCount - 1 FETCH NEXT 1 ROW;
SET @RecordCount = @RecordCount - 1;
END 
```

这样我就不需要向表中添加字段或使用窗口函数。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-15T14:33:01.257

我同意上一篇文章，即基于集合的操作通常会执行得更好，但是如果您确实需要遍历这些行，我会采用以下方法：

1.  向表变量添加一个新字段（数据类型位，默认 0）
2.  插入您的数据
3.  选择 fUsed = 0 的 Top 1 Row *（注意：fUsed 是步骤 1 中的字段名称）*
4.  执行您需要做的任何处理
5.  通过为记录设置 fUsed = 1 来更新表变量中的记录
6.  从表中选择下一个未使用的记录并重复该过程

    ```
    DECLARE @databases TABLE  
    (  
        DatabaseID  int,  
        Name        varchar(15),     
        Server      varchar(15),   
        fUsed       BIT DEFAULT 0  
    ) 

    -- insert a bunch rows into @databases

    DECLARE @DBID INT

    SELECT TOP 1 @DBID = DatabaseID from @databases where fUsed = 0 

    WHILE @@ROWCOUNT <> 0 and @DBID IS NOT NULL  
    BEGIN  
        -- Perform your processing here  

        --Update the record to "used" 

        UPDATE @databases SET fUsed = 1 WHERE DatabaseID = @DBID  

        --Get the next record  
        SELECT TOP 1 @DBID = DatabaseID from @databases where fUsed = 0   
    END 
    ```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-09-02T08:09:02.773

Step1：下面的select语句为每条记录创建一个具有唯一行号的临时表。

```
select eno,ename,eaddress,mobno int,row_number() over(order by eno desc) as rno into #tmp_sri from emp 
```

Step2：声明需要的变量

```
DECLARE @ROWNUMBER INT
DECLARE @ename varchar(100) 
```

Step3：从临时表中获取总行数

```
SELECT @ROWNUMBER = COUNT(*) FROM #tmp_sri
declare @rno int 
```

Step4：根据在temp中创建的唯一行号循环临时表

```
while @rownumber>0
begin
  set @rno=@rownumber
  select @ename=ename from #tmp_sri where rno=@rno  **// You can take columns data from here as many as you want**
  set @rownumber=@rownumber-1
  print @ename **// instead of printing, you can write insert, update, delete statements**
end 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2016-06-16T18:41:38.850

这种方法只需要一个变量，并且不会从@databases 中删除任何行。我知道这里有很多答案，但我没有看到使用 MIN 来获取你的下一个 ID 的答案。

```
DECLARE @databases TABLE
(
    DatabaseID    int,
    Name        varchar(15),   
    Server      varchar(15)
)

-- insert a bunch rows into @databases

DECLARE @CurrID INT

SELECT @CurrID = MIN(DatabaseID)
FROM @databases

WHILE @CurrID IS NOT NULL
BEGIN

    -- Do stuff for @CurrID

    SELECT @CurrID = MIN(DatabaseID)
    FROM @databases
    WHERE DatabaseID > @CurrID

END 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-03-27T17:33:17.740

这是我的解决方案，它利用了无限循环、`BREAK`语句和`@@ROWCOUNT`函数。不需要游标或临时表，我只需要编写一个查询即可获取`@databases`表中的下一行：

```
declare @databases table
(
    DatabaseID    int,
    [Name]        varchar(15),   
    [Server]      varchar(15)
);

-- Populate the [@databases] table with test data.
insert into @databases (DatabaseID, [Name], [Server])
select X.DatabaseID, X.[Name], X.[Server]
from (values 
    (1, 'Roger', 'ServerA'),
    (5, 'Suzy', 'ServerB'),
    (8675309, 'Jenny', 'TommyTutone')
) X (DatabaseID, [Name], [Server])

-- Create an infinite loop & ensure that a break condition is reached in the loop code.
declare @databaseId int;

while (1=1)
begin
    -- Get the next database ID.
    select top(1) @databaseId = DatabaseId 
    from @databases 
    where DatabaseId > isnull(@databaseId, 0);

    -- If no rows were found by the preceding SQL query, you're done; exit the WHILE loop.
    if (@@ROWCOUNT = 0) break;

    -- Otherwise, do whatever you need to do with the current [@databases] table row here.
    print 'Processing @databaseId #' + cast(@databaseId as varchar(50));
end 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-05-07T17:45:53.207

这是我使用 2008 R2 的代码。我正在使用的这段代码是在所有故事中的关键字段（SSNO 和 EMPR_NO）上建立索引

```
if object_ID('tempdb..#a')is not NULL drop table #a

select 'IF EXISTS (SELECT name FROM sysindexes WHERE name ='+CHAR(39)+''+'IDX_'+COLUMN_NAME+'_'+SUBSTRING(table_name,5,len(table_name)-3)+char(39)+')' 
+' begin DROP INDEX [IDX_'+COLUMN_NAME+'_'+SUBSTRING(table_name,5,len(table_name)-3)+'] ON '+table_schema+'.'+table_name+' END Create index IDX_'+COLUMN_NAME+'_'+SUBSTRING(table_name,5,len(table_name)-3)+ ' on '+ table_schema+'.'+table_name+' ('+COLUMN_NAME+') '   'Field'
,ROW_NUMBER() over (order by table_NAMe) as  'ROWNMBR'
into #a
from INFORMATION_SCHEMA.COLUMNS
where (COLUMN_NAME like '%_SSNO_%' or COLUMN_NAME like'%_EMPR_NO_')
    and TABLE_SCHEMA='dbo'

declare @loopcntr int
declare @ROW int
declare @String nvarchar(1000)
set @loopcntr=(select count(*)  from #a)
set @ROW=1  

while (@ROW <= @loopcntr)
    begin
        select top 1 @String=a.Field 
        from #A a
        where a.ROWNMBR = @ROW
        execute sp_executesql @String
        set @ROW = @ROW + 1
    end 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-05-20T19:50:21.947

```
SELECT @pk = @pk + 1 
```

会更好：

```
SET @pk += @pk 
```

如果您不引用表只是分配值，请避免使用 SELECT。

# javascript - JavaScript sqlite

> ID：61972
> 
> 赞同：45
> 
> 时间：2008-09-15T07:28:56.910
> 
> 标签：javascript, sqlite

从 JavaScript 访问和操作 sqlite 数据库的最佳建议。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2012-06-19T22:55:38.197

有一个名为[`sql.js`](https://github.com/kripken/sql.js)JavaScript 的 SQLite 端口的项目。

> sql.js 是 SQLite 到 JavaScript 的一个端口，通过使用 Emscripten 编译 SQLite C 代码。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2014-05-26T23:17:48.743

# javascript SQLite解决方案全景图

## 在浏览器中

如果您想从 Web 浏览器中访问 SQLite 数据库，那么您没有很多解决方案。

### sql.js

SQLite C 库已使用[emscripten](https://github.com/kripken/emscripten)**移植到 javascript**。该端口是由 Alon Zakai（也是 emscripten 的作者）的名义启动的。我是这个库的当前维护者。[`sql.js`](https://github.com/kripken/sql.js)

API 如下所示：

```
<script src='js/sql.js'></script>
<script>
    //Create the database
    var db = new SQL.Database();
    // Run a query without reading the results
    db.run("CREATE TABLE test (col1, col2);");
    // Insert two rows: (1,111) and (2,222)
    db.run("INSERT INTO test VALUES (?,?), (?,?)", [1,111,2,222]);

    // Prepare a statement
    var stmt = db.prepare("SELECT * FROM test WHERE a BETWEEN $start AND $end");
    stmt.getAsObject({$start:1, $end:1}); // {col1:1, col2:111}

    // Bind new values
    stmt.bind({$start:1, $end:2});
    while(stmt.step()) { //
        var row = stmt.getAsObject();
        // [...] do something with the row of result
    }
</script> 
```

### 网络 SQL

W3C 已经开始研究用于在浏览器中执行 SQL 的原生 API，称为**web sql**。该 API 的使用示例：

```
var db = openDatabase('mydb', '1.0', 'my first database', 2 * 1024 * 1024);
db.transaction(function (tx) {
  tx.executeSql('CREATE TABLE IF NOT EXISTS foo (id unique, text)');
  tx.executeSql('INSERT INTO foo (id, text) VALUES (1, "synergies")');
}); 
```

然而，该项目已被**放弃**。因此它没有得到广泛的支持。见：[http ://caniuse.com/sql-storage](http://caniuse.com/sql-storage)

## 在节点

如果您在 node 中编写客户端 javascript，则您有更多选择。请参阅：[https](https://www.npmjs.org/search?q=sqlite) ://www.npmjs.org/search?q=sqlite 。

### 节点-sqlite3

如果您有一个编译工具链，并且不关心必须为不同平台（或仅针对一个平台）编译您的应用程序，我建议您使用[`node-sqlite3`](https://www.npmjs.org/package/sqlite3). 它速度快（比 快得多`sql.js`），具有完整的 API 和良好的文档。API 示例如下：

```
var sqlite3 = require('sqlite3').verbose();
var db = new sqlite3.Database(':memory:');

db.serialize(function() {
  db.run("CREATE TABLE lorem (info TEXT)");

  var stmt = db.prepare("INSERT INTO lorem VALUES (?)");
  for (var i = 0; i < 10; i++) {
      stmt.run("Ipsum " + i);
  }
  stmt.finalize();

  db.each("SELECT rowid AS id, info FROM lorem", function(err, row) {
      console.log(row.id + ": " + row.info);
  });
});

db.close(); 
```

### sql.js

是的，再次。[`sql.js`](https://github.com/lovasoa/sql.js)可以从节点使用。如果您想要一个纯 JavaScript 应用程序，这就是解决方案。但是，它会比以前的解决方案慢。

以下是如何`sql.js`从节点使用的示例：

```
var fs = require('fs');
var SQL = require('sql.js');
var filebuffer = fs.readFileSync('test.sqlite');

db.run("INSERT INTO test VALUES (?,?,?)", [1, 'hello', true]);  -- corrected INT to INTO

var data = db.export();
var buffer = new Buffer(data);
fs.writeFileSync("filename.sqlite", buffer); 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-15T07:54:33.960

好吧，如果您正在使用客户端 JavaScript，我认为您将不走运……浏览器倾向于将 JavaScript 环境沙箱化，因此您无法以任何一般能力访问机器，例如访问数据库。

如果您正在谈论从客户端访问的服务器端上的 SQLite DB，您可以设置一个 AJAX 解决方案，调用一些服务器端代码来访问它。

如果您在谈论 Rhino 或其他一些服务器端 JavaScript，您应该查看宿主语言的 API 访问 SQLite（例如 Rhino 的 JDBC）。

也许更澄清你的问题......？

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-15T08:02:02.600

[Google Gears](http://gears.google.com/)有一个内置的 sqlite 数据库——但如果你打算依赖它，你需要确保人们已经安装了它。

根据您的情况，您可能可以强制安装，否则您应该将其视为一个不错的选择，但要进行优雅的降级，以便该站点在未安装的情况下仍然可以工作。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-15T14:51:10.310

如果您希望在浏览器（即客户端）上访问 SQLite 数据库，则需要您的浏览器来支持它。您可以使用 SpiderApe [http://spiderape.sourceforge.net/plugins/sqlite/](http://spiderape.sourceforge.net/plugins/sqlite/)来实现，它假定浏览器是基于 Mozilla 的（即支持 SQLite）。您仍然需要允许访问底层库（[http://www.mozilla.org/projects/security/components/signed-scripts.html](http://www.mozilla.org/projects/security/components/signed-scripts.html)）

如果您正在寻找从 Javascript 程序到 SQLite 数据库的服务器端访问，有几种选择： JSDB 是一种[http://www.jsdb.org/](http://www.jsdb.org/)；JSEXT 另一个[http://jsext.sourceforge.net/](http://jsext.sourceforge.net/)；和 jslibs 另一个[http://code.google.com/p/jslibs/](http://code.google.com/p/jslibs/)

-- MV

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-10-31T09:56:27.297

sql.js库将使您能够在客户端调用 SQL 查询[。](https://github.com/kripken/sql.js)使用该库，您可以通过调用 .open(data) 和 .exportData() 轻松地在服务器和客户端之间传输整个数据。这非常方便。

另外 HTML5 有[存储能力](http://diveintohtml5.info/storage.html)，但是作为新技术标准，你不能假设所有的客户端都会支持。

[如果您不使用 SQL， Lawnchair](http://brian.io/lawnchair/)是一个非常好的选择，因为它提供了一种易于使用的键/值方法。这两个库为在客户端使用 sql 数据库提供了完整的解决方案。

另一个好的存储库是[jStorage](http://www.jstorage.info/)。它可用于保存客户端上“sql.js”中的数据。它支持多种浏览器（包括移动浏览器，以及 IE7 和 IE7 ！），甚至可以在浏览器崩溃中幸存下来。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-15T14:01:30.863

如果您在 Windows 中运行特权脚本（在 HTA 或 WSH 中），则可以使用“ADODB.Recordset”ActiveXObject 访问 ODBC 数据源。

如果您在网页上谈论客户端，那么上面的帖子回复：Google Gears 是您最好的选择。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-08-01T04:58:20.810

您可以在 mozilla firefox 堆栈上使用 XUL API 执行它。这是一些关于它的教程： [http ://www.arashkarimzadeh.com/articles/10-xul/25-sqlite-api-for-xul-application-using-javascript.html](http://www.arashkarimzadeh.com/articles/10-xul/25-sqlite-api-for-xul-application-using-javascript.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-01T07:38:49.400

在 Mac 上？看看 Gus Meuller 的 JSTalk，它利用了 Scripting Bridge 和 Patrick Geiller 的 JSCocoa。

Gus 在这里专门讨论了 Sqlite 支持：http: [//gusmueller.com/blog/archives/2009/03/jstalk_extras.html](http://gusmueller.com/blog/archives/2009/03/jstalk_extras.html) ...效果很好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-05-15T06:23:51.160

[JayData](http://jaydata.org)还提供了一个使用 JavaScript 与 sqLite/webSql 一起工作的工具包。你需要一个浏览器、Rhine 或 Nodejs 来运行这个东西。

# xslt - 根据当前节点值有条件地匹配

> ID：61995
> 
> 赞同：8
> 
> 时间：2008-09-15T08:06:59.377
> 
> 标签：xslt, xpath, xmlnode

给定以下 XML：

```
<current>
  <login_name>jd</login_name>
</current>
<people>
  <person>
    <first>John</first>
    <last>Doe</last>
    <login_name>jd</login_name>
  </preson>
  <person>
    <first>Pierre</first>
    <last>Spring</last>
    <login_name>ps</login_name>
  </preson>
</people> 
```

如何从当前/登录匹配器中获取“John Doe”？

我尝试了以下方法：

```
<xsl:template match="current/login_name">
  <xsl:value-of select="../people/first[login_name = .]"/>
  <xsl:text> </xsl:text>
  <xsl:value-of select="../people/last[login_name = .]"/>
</xsl:template> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-15T12:42:47.997

我会定义一个键来索引人员：

```
<xsl:key name="people" match="person" use="login_name" /> 
```

在这里使用键只会保持代码的整洁，但如果您经常需要`<person>`根据`<login_name>`子元素检索元素，您可能会发现它有助于提高效率。

我有一个模板，它返回给定的格式化名称`<person>`：

```
<xsl:template match="person" mode="name">
  <xsl:value-of select="concat(first, ' ', last)" />
</xsl:template> 
```

然后我会做：

```
<xsl:template match="current/login_name">
  <xsl:apply-templates select="key('people', .)" mode="name" />
</xsl:template> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-15T09:14:22.613

你想要的[`current()`](http://www.w3.org/TR/xslt#function-current)功能

```
<xsl:template match="current/login_name">
  <xsl:value-of select="../../people/person[login_name = current()]/first"/>
  <xsl:text> </xsl:text>
  <xsl:value-of select="../../people/person[login_name = current()]/last"/>
</xsl:template> 
```

或更干净一点：

```
<xsl:template match="current/login_name">
  <xsl:for-each select="../../people/person[login_name = current()]">
    <xsl:value-of select="first"/>
    <xsl:text> </xsl:text>
    <xsl:value-of select="last"/>
  </xsl:for-each>
</xsl:template> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T22:18:31.583

如果您需要访问多个用户，那么[JeniT 的`<xsl:key />`方法](https://stackoverflow.com/questions/61995/xslt-and-xpath-match-conditionally-upon-current-node-value#62429)是理想的。

这是我的替代方案：

```
<xsl:template match="current/login_name">
    <xsl:variable name="person" select="//people/person[login_name = .]" />
    <xsl:value-of select="concat($person/first, ' ', $person/last)" />
</xsl:template> 
```

我们将所选`<person>`节点分配给一个变量，然后我们使用该`concat()`函数输出名字/姓氏。

您的示例 XML 中也存在错误。`<person>`节点错误地以( `</preson>`typo)结尾

如果我们知道 XML 文档的整体结构（包括根节点等），可以给出更好的解决方案

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T09:14:22.507

我认为他真正想要的是匹配中“当前”节点的替换，而不是人员节点中的匹配：

```
<xsl:variable name="login" select="//current/login_name/text()"/>

<xsl:template match="current/login_name">
<xsl:value-of select='concat(../../people/person[login_name=$login]/first," ", ../../people/person[login_name=$login]/last)'/>

</xsl:template> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T10:09:50.313

只是为了将我的想法添加到堆栈中

```
<xsl:template match="login_name[parent::current]">
 <xsl:variable name="login" select="text()"/>
 <xsl:value-of select='concat(ancestor::people/child::person[login_name=$login]/child::first/text()," ",ancestor::people/child::person[login_name=$login]/child::last/text())'/>
</xsl:template> 
```

我总是更喜欢在我的 XPath 中明确使用轴，更详细但更清晰的恕我直言。

根据其余 XML 文档的外观（假设这只是一个片段），您可能需要限制对“ancestor::people”的引用，例如使用“ancestor::people[1]”来限制第一个人祖先。************************