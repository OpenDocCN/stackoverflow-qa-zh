# StackOverflow 问答 000608000-000608999

# .net - 您是否必须在发布时使用编译来部署 .pdb 文件？

> ID：608002
> 
> 赞同：52
> 
> 时间：2009-03-03T20:23:35.407
> 
> 标签：.net, deployment, release-management

您是否必须在发布时使用编译来部署 .pdb 文件？

无论如何，当您进行发布构建时，为什么它甚至会编译 .pdb？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-03T20:26:39.673

不，您不需要部署它们。

至于为什么它们甚至内置于发布中。PDB 文件确实有几个用途，但主要用途（至少对我而言）是

1.  调试
2.  剖析

这两项任务都在发布二进制文件上有效完成，这就是发布版本包含 PDB 的原因。事实上，当调试 Watson 转储时，它 100% 的时间都是针对发布版本的。如果没有 PDB，我将不得不通过拆机查看:(

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-03T20:36:18.370

您不必随二进制文件一起部署和分发 PDB 文件。

但是，我建议您保留它们（并最终索引它们），以便能够分析客户、QA 和支持人员发送给您的任何转储文件。这样，您将能够获得可理解的堆栈跟踪和符号信息。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-03T20:25:07.680

如果需要，还可以在编译选项中关闭 PDB 文件生成。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-03T20:29:34.440

PDB 文件包含有关函数名称的信息。您需要它才能获得堆栈跟踪。它还可以包含有关将其映射到源的信息。有时您可能想要发布您的发布版本，但仍需要分析客户端发生的崩溃。为此，需要 PDB。理论上，为发布而编译时的 PDB 应该比为调试而编译时具有更少的信息。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-03T20:29:34.457

*PDB 文件包含调试符号，即使在发布模式下*也允许您调试二进制文件。您不必（并且可能不应该部署它们），因为它们可能被用来对您的应用程序进行逆向工程。不过，请务必将它们存档在某个地方，因为当您想要调试故障转储时，它们会非常方便。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-03T20:27:34.693

没有。您不需要分发它们。它有助于调试（或者我应该说它可以*让*理智的人进行调试）。

您还可以关闭或调整 Visual Studio 中生成的符号的“级别”——只需转到项目属性/“构建”选项卡/“高级”——并对“调试信息”字段进行调整。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-03T20:38:15.463

正如该线程上的大多数人所说：不，您不必发送 PDB 文件；但如果你打算将代码发布到野外，你真的应该这样做。

这实际上是关于能够支持您的应用程序。如果没有 PDB，当您的应用程序崩溃时，您的用户只能告诉您应用程序崩溃的原始内存地址；但是使用 PDB 文件，您会收到一个错误，您实际上可以做一些事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-03T20:26:38.487

不，您不发送 .pdb 文件。生成它们是因为有时能够调试发布版本会很有帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-03T20:27:49.000

一些工具，如 AVICode 的 InterceptStudio 使用 pdb 文件从工具中查看特定异常/堆栈跟踪/本地的源，而不必打开源并转到特定行。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-03T20:36:16.467

您不需要它们运行。

即使构建是在发布配置上，pdb 文件也可用于调试。

* * *

## 回答 #11

> 赞同：-5
> 
> 时间：2009-03-03T20:25:58.910

不，您不必部署 .pdb 文件。

引用[MSDN](http://msdn.microsoft.com/en-us/library/ms241903.aspx)的话说，“使用 /debug (Visual Basic/C#) 构建时会创建 PDB 文件。”，因此在编译发布时不应创建调试数据库。

# jquery - 从 jquery 调用 ASMX Web 方法我哪里出错了？

> ID：608006
> 
> 赞同：0
> 
> 时间：2009-03-03T20:25:01.707
> 
> 标签：jquery, ajax, asmx

我在 asp.net 2.0 应用程序上有一个简单的 webmethod（使用 1.0 扩展而不是 3.5 ajax 扩展）。我正在尝试从 jQuery 调用该方法，当我按照 Internet 和 SO 上的无数示例执行此操作时，我收到返回的内部服务器错误消息。

这是我当前的代码：

```
[WebMethod]
[ScriptMethod(ResponseFormat=ResponseFormat.Json)]
public string Select(string login)
{
    UserProfile profile = UserProfile.GetUserProfile(login);

    return "{ FirstName: '" + profile.FirstName + "', " +
             "LastName: '" + profile.LastName + "', " +
             "EmailAddress: '" + profile.EmailAddress + "', " +
             "PhoneNumber: '" + profile.PhoneNumber + "' }";
 } 
```

现在是jQuery：

```
$.ajax({
    type: "POST",
    url: "Services/ProfileService.asmx/Select",
    dataType: "json",
    data: "{'login':'DOMAIN%5CUSER1'}",
    contentType: "application/json; charset=utf-8",
    success: function(msg){ alert(msg); },
    error: function(xhr){ alert(xhr.statusText);}     
}); 
```

`[ScriptService]`Web 服务也使用该属性进行装饰。如果我注释掉 contentType，将 dataType 更改为 text，并将 data 更改为查询字符串 (name=value)，我会正确返回 XML。

我哪里错了？

更新：我正在使用 jQuery v1.3.1 并在 IE6 和 Firefox 3 中进行测试。我得到了一致的结果。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T21:03:45.107

这对我来说是一个愚蠢的错误。问题已解决。虽然我包含了对 AJAX 扩展的引用，但我忘记了将 ASMX 服务的 httphandler 重写为 ScriptHandlerFactory 类。

添加这个解决了这个问题。

由于我收到了一些电子邮件询问示例或我如何解决问题，因此我写了一篇关于如何为坚果做这道汤的博客文章。

[http://randomactsofcoding.blogspot.com/2009/03/jquery-json-and-asmx-20-services.html](http://randomactsofcoding.blogspot.com/2009/03/jquery-json-and-asmx-20-services.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T20:28:13.587

是的。您应该为 WCF 放弃 ASMX。来自微软自己的推荐。我想它不会帮助您解决问题，但是您最好考虑 WCF 或至少开始研究该技术。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-07T05:54:09.227

我遇到了同样的问题，但是当我将以下内容添加到代码文件中时它已修复

[System.Web.Script.Services.ScriptService]

# php - 无法在多服务器环境中为 iis6 上的 php 添加 .php 映射

> ID：608023
> 
> 赞同：0
> 
> 时间：2009-03-03T20:27:04.087
> 
> 标签：php, configuration, iis-6

我有一个多服务器环境（所有 Windows 2003）。

我在应用服务器上手动安装了 php 5。
我还计划在 appserver 上安装 mySQL。

在 DMZ 的网络服务器上，我在 iis6 > Web 服务扩展下添加了 php5isapi.dll 扩展。

我可以通过在 appserver \\local ip address of appserver\c$\php\php5isapi.dll上提供 isapi dll 的 unc 路径来做到这一点

当尝试在
**webserver >> iis6 >> 默认网站 > 属性 > 主目录 > 配置 > 添加映射**
上添加“.php”扩展映射时， Windows 说我不能使用 UNC 路径
\\local ip address of appserver\c $\php\php5isapi.dll 访问不同服务器上的 .dll 文件。

所以我很困惑。我认为我正在以正确的方式解决这个问题 - 通过设置我的应用服务器（后端）来执行所有 php 处理并告诉网络服务器将 php 作业发送到哪里。

我错过了什么或者我应该做些什么不同的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T22:43:07.473

即使这样有效，也不会使 php 在应用服务器上运行 - 它会将 dll 从应用服务器加载到网络服务器的内存中并在那里运行代码。您只需要在要执行 php 的机器上设置文件关联

# php - 如何让 wordpress 覆盖以前的帖子查询？

> ID：608025
> 
> 赞同：1
> 
> 时间：2009-03-03T20:27:20.047
> 
> 标签：php, wordpress

我有一个页面，顶部有一个类别列表，通常应该在它下面列出帖子。类别列表是使用以下方法创建的：

```
<?php $display_categories = array( 4, 7, 8, 9, 21, 1); $i = 1;
    foreach ( $display_categories as $category ) { ?>
        <div>
            <?php single_cat_title(); ?> //etc
        </div>
    <?php } 
?> 
```

但是，这似乎使帖子循环按类别排序帖子。我希望它忽略类别排序和按日期降序排序。我创建了一个新的 WP_Query 因为根据文档你不能使用 query_posts() 两次，所以以防万一。

```
<?php $q = new WP_Query( "cat=-1&showposts=15&orderby=date&order=DESC" );
    if ( $q->have_posts() ) : 
        while ( $q->have_posts() ) : $q->the_post(); ?>
            the_title(); // etc
        endwhile; 
    endif; 
?> 
```

但是，这似乎**仍然**是按类别（与上面的列表相同的顺序）然后按日期排序，而不是仅按日期排序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T00:18:34.687

我以前也遇到过这个问题。

试试这个：

```
<?php
    global $post;
    $myposts = get_posts( 'numberposts=5' );
    foreach( $myposts as $post ) : setup_postdata( $post ); ?>
        <div <?php post_class(); ?>>
            <div class="title">
                <h2>
                    <a href="<?php the_permalink(); ?>"><?php the_title(); ?></a>
                </h2>
                <p class="small"><?php the_time( 'F j, Y' ); ?> by <?php the_author(); ?></p>
             </div>
             <?php the_excerpt(); ?>
         </div>
     <?php endforeach; 
 ?> 
```

重要的线是`global $post;`.

那应该重置您的全局查询。该`setup_postdata($post)`方法是必要的，以使您可以访问类似`the_author()`或的功能`the_content()`。

-克里斯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T20:55:50.960

query_posts 有时很挑剔。尝试这样的事情，看看它是否有效：

```
query_posts(array('category__not_in'=>array(1),
                  'showposts'=>15,
                  'orderby'=>date,
                  'order'=>DESC)); 
```

由于这不是问题，请尝试将 update_post_caches($posts) 添加到第二个循环，如下所示：

```
<?php $q = new WP_Query("cat=-1&showposts=15&orderby=date&order=DESC");
if ( $q->have_posts() ) : while ( $q->have_posts() ) : $q->the_post(); update_post_caches($posts); ?>
the_title(); // etc
endwhile; endif; ?> 
```

据说这[解决了一些插件问题](http://codex.wordpress.org/The_Loop#Multiple_Loops_Example_3_-_Plugins)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T21:10:02.750

我对wordpress没有任何经验，但有几种可能性：

1.  您在调用的字符串中定义了两次“order”参数`query_posts()`，我不知道这是否会导致问题。
2.  同样，“show”不是有效参数，您可能一直在寻找“showposts”。

此处描述了参数及其影响：[http://codex.wordpress.org/Template_Tags/query_posts#Parameters](http://codex.wordpress.org/Template_Tags/query_posts#Parameters)

# .net - .net - 如何从 Visual Studio 的 IntelliSense 隐藏我的类库 (dll) 的方法/属性？

> ID：608028
> 
> 赞同：7
> 
> 时间：2009-03-03T20:27:48.127
> 
> 标签：.net, vb.net

我正在用 VB.NET 编写我的第一个类库。我的想法是分发这个库，以便其他人可以在他们的应用程序中使用它。

但是，也许由于我缺乏编写和构建库及其类的经验，我注意到方法/属性都显示在 Visual Studio 的 IntelliSense 中。

问题是它们中的许多只在库本身中使用，当他们将我的库合并到他们的应用程序中时，开发人员不应该使用它们（可能会造成灾难）——只有少数应该是可见的，即那些需要的开发商。

因此，我的问题是：有没有办法从 Visual Studio 的 IntelliSense 隐藏我的库的某些方法/属性？也许类似于 REM 的东西？

提前致谢。

编辑：如前所述 - 这是我的第一个图书馆，我现在明白我的问题可以用两种方式解释：

1) 如何从 IntelliSense 中隐藏某些内容

2）如何防止开发人员使用和调用某些方法/属性

当然，我想要的最终结果是开发人员无法访问所有某些方法/属性，即上面的 2 号。

非常感谢。我今天刚刚学到了一些新东西，现在我将学习访问级别...

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-03T20:30:50.270

只应声明您希望可见的类型/方法/属性`Public`。其余部分应声明为`Private`,或。`Protected``Friend``Protected Friend`

[您可以在MSDN 网页上为他们](http://msdn.microsoft.com/en-us/library/76453kax.aspx)阅读有关这些访问级别的更多信息。一般来说，您通常应该只将事情公开，因为它们确实需要公开。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-03T20:30:08.917

您需要将其访问修饰符更改为 Public 以外的其他内容。如果它们只是在给定的类中使用，请将它们设为 Private Sub XYZ()。如果它们需要被同一程序集中的其他类访问，请将它们设为 Friend Sub XYZ() 等。

[http://msdn.microsoft.com/en-us/library/76453kax.aspx](http://msdn.microsoft.com/en-us/library/76453kax.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-03T20:30:50.660

供参考：[http ://www.fmsinc.com/free/NewTips/NET/NETtip23.asp](http://www.fmsinc.com/free/NewTips/NET/NETtip23.asp)

```
[System.ComponentModel.EditorBrowsable(System.ComponentModel.EditorBrowsableState.Never)]
public void myHiddenMethod() {
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-03T20:33:06.770

如果要隐藏它们，请在函数的 XML 注释中添加一个 filterpriority 标记，值为 3

```
''' <summary>
''' </summary>
''' <filterpriority>3</filterpriority>
''' <remarks></remarks>
Sub DontShowMe()

End Sub 
```

默认情况下，这将在智能感知中隐藏它。您还可以分别使用值 1/2 控制 Common/All 选项卡中的位置。

关于该主题的博客文章：[http ://www.lostechies.com/blogs/sdorman/archive/2009/01/10/xml-comments-filterpriority.aspx](http://www.lostechies.com/blogs/sdorman/archive/2009/01/10/xml-comments-filterpriority.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T20:31:04.903

您可以将一个属性应用于您的代码，元数据将鼓励 Visual Studio 隐藏代码。仍然可以调用此代码，我建议不要使用它，但如果您真的需要它，只需添加：

```
What Andrew Hare said... 
```

...到您的代码。

# sharepoint - 显示 SharePoint 自定义字段类型的自定义属性值时出现问题

> ID：608031
> 
> 赞同：1
> 
> 时间：2009-03-03T20:28:16.393
> 
> 标签：sharepoint, wss, custom-field-type

我正在尝试在 SharePoint (WSS 3.0) 中创建具有自定义属性的自定义字段类型。我已经根据 SDK 文档和[这篇博客文章](http://claytonj.wordpress.com/2007/05/15/regular-expression-validation-custom-field-type/)创建了我的 fldtypes*.xml 文件，它似乎渲染得很好，我可以在我的代码中检索自定义属性值。我的问题是，在初始字段创建之后，如果我返回列表设置页面并单击我新添加的字段，表单会显示我的自定义属性以及我没有提供的一些值。例如，如果我的自定义属性的显示名称是“我的自定义道具”，那么其文本框中的值将是“我的自定义道具字段值”。

我的问题是：如何在这些文本框中正确显示自定义属性类型的实际字符串值？

这是我的 fldtypes*.xml 文件：

```
<?xml version="1.0" encoding="utf-8"?>
<FieldTypes>
  <FieldType>
    <Field Name="TypeName">MyCustomField</Field>
    <Field Name="TypeDisplayName">My Custom Field</Field>
    <Field Name="TypeShortDescription">MyCustomField</Field>
    <Field Name="ParentType">Text</Field>
    <Field Name="UserCreatable">TRUE</Field>
    <Field Name="FieldTypeClass">MyCustomField.CustomFields.MyCustomField, MyCustomField, Version=1.0.0.0, Culture=neutral, PublicKeyToken=d772gbab82fe6996</Field>
    <PropertySchema>
      <Fields>
        <Field Name="MyCustomProp" DisplayName="My Custom Prop" Type="Text" MaxLength="50" DisplaySize="30" />
      </Fields>
    </PropertySchema>
  </FieldType>
</FieldTypes> 
```

这是我的字段类型类的代码：

```
public class MyCustomField : SPFieldText
{
    private string propval;

    public MyCustomField(SPFieldCollection fields, string fieldName)
        : base(fields, fieldName)
    {
    }

    public MyCustomField(SPFieldCollection fields, string typeName, string displayName)
        : base(fields, typeName, displayName)
    {           
    }

    public override void Update()
    {
        // I can see any updated value here
        propval = GetCustomProperty("MyCustomProp") as string;
        base.Update();
    }

    public override Type FieldValueType
    {
        get { return typeof (string); }
    }

} 
```

如何在我的 SharePoint 应用程序的“更改列”页面 (FldEditEx.aspx) 中查看正确的自定义属性值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T04:42:04.397

在自定义字段类型上[保存和检索自定义属性](http://social.msdn.microsoft.com/forums/en-US/sharepointdevelopment/thread/fb1cb936-3abb-48c2-8d19-49007688dc34/)存在一个众所周知的问题。这是[解决](http://www.sharepointblogs.com/aaronrh/archive/2007/05/25/the-solution-to-saving-properties-in-custom-field-types.aspx)方法的直接链接。

顺便说一句，帖子上的一些评论声称同样的问题。

# javascript - 包含 javascript 的附加 HTML 无法运行，如何使其运行？

> ID：608034
> 
> 赞同：8
> 
> 时间：2009-03-03T20:28:59.013
> 
> 标签：javascript, html, dom, dom-manipulation

我正在附加一些包含 javascript 的 HTML。

```
<td onclick="toggleDay('+data+',this,\'tue\');">T</td> 
```

和

```
<img src="img/cross.png" onclick="deleteAlarm('+data+');"> 
```

这两段代码在我附加的大量 HTML 中。

如果它们在页面加载时已经存在但在我追加时不存在，它们可以正常工作。

你建议我怎么做？是否需要对 DOM 进行某种排序请求以在追加后重新解释 JavaScript？

编辑：

只是更多信息，我遇到了这个问题，因为我正在向数据库添加一些带有 AJAX 的东西，并且成功后我将 html 附加到它需要的位置。有点像 SO 对评论的处理方式。

编辑2：

即使有所有关于它的讨论，感谢您的回答，让它工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-03T20:38:37.133

我会这样做：

首先将 id 属性添加到您的 html 中：

```
<td id="toggleDayCell">T</td>

<img src="img/cross.png" id="crossImg"> 
```

然后让 Javascript 在页面的 onload 事件上运行并附加到您感兴趣的事件。

在[PrototypeJS](http://www.prototypejs.org)中，它可能看起来像这样：

```
Event.observe(window, 'load', function(){
  if( $('toggleDayCell') ) {
    Event.observe( $('toggleDayCell'), 'click', function(event){
      //do stuff here
    }
  }

  if( $('crossImg') ) {
    Event.observe( $('crossImg'), 'click', function(event) {
       //do stuff here
    }
  }
}); 
```

使用 Prototype（或 jQuery）之类的东西很好，因为它处理了跨浏览器的兼容性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T20:38:06.620

您是否通过 AJAX 附加 HTML？如果是这样，您将不得不手动 eval() 您返回的 JavaScript。您可以将响应包装在 div 中并执行以下操作：

```
wrapper.getElementsByTagName("script")
// for script in wrapper...
eval(script.innerHTML) 
```

如果您使用的是原型之类的库，它会简单得多，因为您可以将响应传递给 evalScripts() 方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T20:31:49.257

将 HTML 附加到文档，然后以编程方式将 onclick 事件添加到对象。

这不是我的想法，但是......我认为你可以这样做：

IE：

```
Object.onclick = someFuntion 
```

法郎：

```
Object.addEventListener('click', someFunction); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T20:37:31.067

您*应该*使用`addEventListener('click', /*...*/)`而不是在 innerHTML 或其他任何内容中设置 onclick。

IE`addEventListener`完全调用了其他东西，因此您也必须对此进行补偿。

（编辑：IE 称之为`attachEvent()`。希望这有一些用处。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T20:48:33.223

AJAX 有一些怪癖......尤其是 IE。示例：您不能使用 innerHTML 属性在表格元素中插入/更新任何内容（在 IE 中）。最好使用 DOM 函数来插入/更新/删除元素节点（或添加事件处理程序）。您可以使用提到的 eval() 函数来运行动态加载的 javascript，该 javascript 使用 DOM 对象修改文档。

# .net - .Net：日期时间字符串格式

> ID：608057
> 
> 赞同：0
> 
> 时间：2009-03-03T20:32:54.387
> 
> 标签：.net

我正在尝试向文件添加时间戳。然而，`DateTime`格式`ToString()`对我来说看起来很奇怪。

这是我的代码：

```
Dim _timeStamp As String = Date.Now.ToString("dd_mm_yyyy") 
```

但值如下所示：

> `_timeStamp = "03_24_2009"`

我检查了我的电脑，当前日期是正确的。值不应该是这样的：`03_03_2009`？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-03T20:33:56.443

对于 2 位数的月份编号，使用 MM 而不是 mm。大写 M 表示月份，小写 m 表示分钟。

此外，John Sheehan 对这些事情有一个[很好的备忘单](http://john-sheehan.com/blog/net-cheat-sheets/)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-03T20:38:56.430

正如其他人所说，“mm”表示分钟，“MM”表示月份。

我发现这些 MSDN 页面很有用：

*   [自定义日期和时间格式字符串](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx)
*   [标准日期和时间格式字符串](http://msdn.microsoft.com/en-us/library/az4se3k1.aspx)
*   [自定义数字格式字符串](http://msdn.microsoft.com/en-us/library/0c899ak8.aspx)
*   [标准数字格式字符串](http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx)

网上也有各种备忘单。我知道我见过其中的一些，但我只记得我自己的[DZone 引用卡](http://refcardz.dzone.com/refcardz/coredotnet?oid=hom7545)，其中包括它（[也在 Scribd 上](http://www.scribd.com/doc/7407143/Refcardz-18-Core-NET)）。

编辑：正如评论中提到的，[John Sheehan 也有一个](http://john-sheehan.com/blog/net-cheat-sheets/)。鉴于它们都是免费的，为什么不下载所有你能找到的东西并保留你认为最有用的东西呢？:)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-03T20:34:02.993

尝试使用 MM 一个月。.ToString 区分大小写，小写表示分钟。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-03T20:34:07.457

使用 MM，mm 表示分钟

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-03T20:34:28.670

mm 是分钟。你想要MM几个月。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-03T20:41:25.067

多亏了我的助记符，我总是能做到这一点：

> 月大于分钟，“MM”大于“mm”

# sql - 如何在递归表（SQL）中为 2 行获取最低的公共父级

> ID：608076
> 
> 赞同：3
> 
> 时间：2009-03-03T20:39:13.963
> 
> 标签：sql, sql-server-2005, tsql, recursion

假设我们有一个具有经典“经理 ID”递归关系的表：

用户 user_id int manager_id int（指user_id）

如果您在表中随机选择 2 行或 2 个节点，您如何找到最低级别的共同祖先？我的平台是 SQL Server 2005 (Transact-SQL) 但任何符合 ANSI 的 SQL 也可以工作...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T21:56:33.653

对 Quassnoi 的答案进行了一些小的修改，它可以工作：

```
WITH
    hier1 (id, parent) AS (
    SELECT      id, parent
    FROM        table
    WHERE       id = @user1
    UNION ALL
    SELECT      id, parent
    FROM        table l, hier1 h
    WHERE       l.id = h.parent
    ),
    hier2 (id, parent) AS (
    SELECT      id, parent
    FROM        table
    WHERE       id = @user2
    UNION ALL
    SELECT      id, parent
    FROM        table l, hier1 h
    WHERE       l.id = h.parent
    )
SELECT  TOP 1 hier1.id
FROM    hier1, hier2
WHERE   hier1.id = hier2.id 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T20:59:41.107

```
WITH
    hier1 (id, parent) AS (
    SELECT  id, parent
    FROM    table l
    WHERE   id = @user1
    UNION ALL
    SELECT  id, parent
    FROM    table l, hier1 h
    WHERE   l.id = parent
    ),
    hier2 (id, parent) AS (
    SELECT  id, parent
    FROM    table l
    WHERE   id = @user2
    UNION ALL
    SELECT  id, parent
    FROM    table l, hier1 h
    WHERE   l.id = parent
    ),
SELECT  TOP 1 hier1.id
FROM    hier1, hier2
WHERE   hier1.id = hier2.id 
```

# vb.net - 是否可以在 LINQ 查询的结果中将 & 更改为 & ？

> ID：608077
> 
> 赞同：0
> 
> 时间：2009-03-03T20:39:17.897
> 
> 标签：vb.net, linq

我有以下代码：

```
Dim db As New linqclassesDataContext
Dim categories = (From c In db.faq_cats)
NewFaqDropDownCategory.DataSource = categories
NewFaqDropDownCategory.DataTextField = "category"
NewFaqDropDownCategory.DataValueField = "category_id"
If Not Page.IsPostBack Then
    NewFaqDropDownCategory.DataBind()
End If
Unset(categories)
Unset(db) 
```

“类别”列下的项目`&amp;`之一在标题中，并显示在下拉列表中。有没有办法让列表显示“&”？

### 一种解决方案

我想我可以使用 .Replace() 函数来做到这一点，但我不小心发现了如何：

```
For Each c In categories
    If c.category.Contains("&amp;") Then
        c.category = c.category.Replace("&amp;", "&")
    End If  
Next 
```

我可以在将来扩展它以处理其他值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T20:47:30.637

如果那里还有其他 HTML 编码字符，您可以使用`HttpUtility.HtmlDecode(c.category)`. 这将阻止您替换并确保正确解码任何字符。

我不知道这是否是确切的 VB linq 匿名对象语法，但我试过了。

```
Dim datasource = From categories In db.faq_cats _
                 Select New With { .category = HttpUtility.HtmlDecode(categories.category), .category_id = categores.category_id } 
```

然后将您的 DDL 绑定到该数据源。

如果您只需要，您也可以使用 .Replace`&amp;`

```
Dim datasource = From categories In db.faq_cats _
                 Select New With { .category = categories.category.Replace("&amp;", "&"), .category_id = categores.category_id } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T20:56:17.107

> “类别”列下的一项具有 & 在标题中

如果那& *真的*应该是“&”，我建议您的数据库需要清理才能使其成为一个。通常，您总是希望数据库中有纯文本；HTML 转义不应该在最后的输出到页面阶段发生。

将数据存储在不同的编码阶段是令人困惑的，并且存在潜在的危险；在另一个方向上获得错误的编码级别，您就会受到跨站点脚本攻击。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T20:43:19.477

我建议你做 .ToList()，然后有一个 Select 抓住它做 .Replace()

做 ToList 的原因是把它放在内存上，从那时起你就不再局限于 sql 上存在的结构。我不知道 vb.net 语法，但在 c# 中，选择看起来像：

```
new {
     category = c.category.Replace("&amp;", "&"),
     c.category_id
} 
```

# c++ - 将字符串/双精度向量转换为数组

> ID：608082
> 
> 赞同：1
> 
> 时间：2009-03-03T20:40:17.707
> 
> 标签：c++, algorithm

我正在使用数学库。它的函数采用 c 风格的参数，例如：

```
 #include<matheval.h>

    char * evaluator_evaluate(void * evaluator, int count, char **names, double *values); 
```

就我而言，我想将名称的 std::vector 和值的 std::vector 转换为 char ** 和 double *

此外，每个名称都对应一个唯一值，并且可能存在重复。根据数据结构优雅地排列名称和值的最佳方法是什么？现在，我使用向量，并且两者都包含重复。

**编辑** 请记住，名称和值的顺序很重要并且应该匹配。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T20:44:12.330

在内部，该标准要求 a`vector<>`等价于一个数组。您可以获取的地址，`vector[0]`结果指针将指向存储数据的连续内存区域，与向量的顺序相同。该指针在调整大小之前或除非`vector<>`调整大小是有效的。

但是，对于`std::string`值（或任何其他对象，就此而言），您只会得到一个`string`对象数组。

# apache-flex - Flex/Actionscript 白色到透明

> ID：608087
> 
> 赞同：3
> 
> 时间：2009-03-03T20:41:29.870
> 
> 标签：apache-flex, actionscript-3, colors

我正在尝试在我的 Flex 3 应用程序中使用将拍摄图像的动作脚本编写一些东西，当用户单击按钮时，它将去除所有白色（ish）像素并将它们转换为透明，我说白色（ish）是因为我试过完全白色，但我在边缘得到了很多伪影。使用以下代码，我已经有点接近了：

```
targetBitmapData.threshold(sourceBitmapData, sourceBitmapData.rect, new Point(0,0), ">=", 0xFFf7f0f2, 0x00FFFFFF, 0xFFFFFFFF, true); 
```

但是，它也会使红色或黄色消失。为什么要这样做？我不完全确定如何使这项工作。还有其他更适合我需要的功能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T21:09:31.177

不久前，我和一个朋友尝试为一个项目执行此操作，并发现在 ActionScript 中编写一个执行此操作的内联方法非常慢。您必须扫描每个像素并对其进行计算，但事实证明，使用 PixelBender 执行此操作非常快（如果您可以使用 Flash 10，否则您会遇到慢速 AS）。

像素弯曲器代码如下所示：

```
input image4 src;
output float4 dst;

// How close of a match you want
parameter float threshold
<
  minValue:     0.0;
  maxValue:     1.0;
  defaultValue: 0.4;
>;

// Color you are matching against.
parameter float3 color
<
  defaultValue: float3(1.0, 1.0, 1.0);
>;

void evaluatePixel()
{
  float4 current = sampleNearest(src, outCoord());
  dst = float4((distance(current.rgb, color) < threshold) ? 0.0 : current);
} 
```

如果您需要在 AS 中执行此操作，您可以使用以下内容：

```
function threshold(source:BitmapData, dest:BitmapData, color:uint, threshold:Number) {
  dest.lock();

  var x:uint, y:uint;
  for (y = 0; y < source.height; y++) {
    for (x = 0; x < source.width; x++) {
      var c1:uint = source.getPixel(x, y);
      var c2:uint = color;
      var rx:uint = Math.abs(((c1 & 0xff0000) >> 16) - ((c2 & 0xff0000) >> 16));
      var gx:uint = Math.abs(((c1 & 0xff00) >> 8) - ((c2 & 0xff00) >> 8));
      var bx:uint = Math.abs((c1 & 0xff) - (c2 & 0xff));

      var dist = Math.sqrt(rx*rx + gx*gx + bx*bx);

      if (dist <= threshold)
        dest.setPixel(x, y, 0x00ffffff);
      else
        dest.setPixel(x, y, c1);
    }
  }
  dest.unlock();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T22:35:07.260

[由于内置的​​阈值功能](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/BitmapData.html#threshold())，您实际上可以在**没有**像素弯曲和实时的情况下做到这一点：

```
// Creates a new transparent BitmapData (in case the source is opaque)
var dest:BitmapData = new BitmapData(source.width,source.height,true,0x00000000);

// Copies the source pixels onto it
dest.draw(source);

// Replaces all the pixels greater than 0xf1f1f1 by transparent pixels
dest.threshold(source, source.rect, new Point(), ">", 0xfff1f1f1,0x00000000);

// And here you go ...  
addChild(new Bitmap(dest)); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T21:25:26.210

看起来上面的代码会使一系列颜色变得透明。

伪代码：
    对于 targetBitmapData 中的每个像素，
        如果像素的颜色 >= #FFF7F0F2
            将颜色更改为 #00FFFFFF

像这样的东西永远不会完美，因为你会失去任何浅色我会找到一个在线颜色选择器，你可以使用它来准确查看哪些颜色会被改变

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T09:11:40.520

像素弯曲代码1中的答案：

dst = float4((distance(current.rgb, color) < threshold) ? 0.0 : current);

应该：

dst =（距离（current.rgb，颜色）<阈值）？float4(0.0) : 当前;

或者

如果（距离（当前.rgb，颜色）<阈值）dst = float4（0.0）；否则 dst = float4(current);

# graphics - 图形算法联合、相交、减法

> ID：608088
> 
> 赞同：4
> 
> 时间：2009-03-03T20:41:41.383
> 
> 标签：graphics

我需要一个很好的资源来阅读如何创建一个算法来获取两条折线（一条由多条线组成的路径）并在它们之间执行并集、减法或交集。这与自定义 API 相关，因此我需要了解底层算法。

另外，VB 方言中的任何资源都会有双重帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-03T21:08:09.963

这里给你几个套路。希望你觉得它们有用:-)

```
// routine to calculate the square of either the shortest distance or largest distance
// from the CPoint to the intersection point of a ray fired at an angle flAngle 
// radians at an array of line segments
// this routine returns TRUE if an intersection has been found in which case flD
// is valid and holds the square of the distance.
// and returns FALSE if no valid intersection was found
// If an intersection was found, then intersectionPoint is set to the point found
bool CalcIntersection(const CPoint &cPoint, 
                      const float flAngle,
                      const int nVertexTotal,
                      const CPoint *pVertexList,
                      const BOOL bMin,
                      float &flD,
                      CPoint &intersectionPoint)

{
    float d, dsx, dsy, dx, dy, lambda, mu, px, py;
    int p0x, p0y, p1x, p1y;

    // get source position 
    const float flSx = (float)cPoint.x;
    const float flSy = -(float)cPoint.y;

    // calc trig functions
    const float flTan = tanf(flAngle);
    const float flSin = sinf(flAngle);
    const float flCos = cosf(flAngle);
    const bool bUseSin = fabsf(flSin) > fabsf(flCos);

    // initialise distance
    flD = (bMin ? FLT_MAX : 0.0f);

    // for each line segment in protective feature
    for(int i = 0; i < nVertexTotal; i++) 
    {
        // get coordinates of line (negate the y value so the y-axis is upwards)
        p0x = pVertexList[i].x;
        p0y = -pVertexList[i].y;
        p1x = pVertexList[i + 1].x;
        p1y = -pVertexList[i + 1].y;

        // calc. deltas
        dsx = (float)(cPoint.x - p0x);
        dsy = (float)(-cPoint.y - p0y);
        dx = (float)(p1x - p0x);
        dy = (float)(p1y - p0y);

        // calc. denominator
        d = dy * flTan - dx;

        // if line & ray are parallel
        if(fabsf(d) < 1.0e-7f)
            continue;

        // calc. intersection point parameter
        lambda = (dsy * flTan - dsx) / d;

        // if intersection is not valid
        if((lambda <= 0.0f) || (lambda > 1.0f))
            continue;

        // if sine is bigger than cosine
        if(bUseSin){
            mu = ((float)p0x + lambda * dx - flSx) / flSin;
        } else {
            mu = ((float)p0y + lambda * dy - flSy) / flCos;
        }

        // if intersection is valid
        if(mu >= 0.0f){

            // calc. intersection point
            px = (float)p0x + lambda * dx;
            py = (float)p0y + lambda * dy;

            // calc. distance between intersection point & source point
            dx = px - flSx;
            dy = py - flSy;
            d = dx * dx + dy * dy;

            // compare with relevant value
            if(bMin){
                if(d < flD)
                {
                    flD = d;
                    intersectionPoint.x = RoundValue(px);
                    intersectionPoint.y = -RoundValue(py);
                }
            } else {
                if(d > flD)
                {
                    flD = d;
                    intersectionPoint.x = RoundValue(px);
                    intersectionPoint.y = -RoundValue(py);
                }
            }
        }
    }

    // return 
    return(bMin ? (flD != FLT_MAX) : (flD != 0.0f));
}

// Routine to calculate the square of the distance from the CPoint to the
// intersection point of a ray fired at an angle flAngle radians at a line.
// This routine returns TRUE if an intersection has been found in which case flD
// is valid and holds the square of the distance.
// Returns FALSE if no valid intersection was found.
// If an intersection was found, then intersectionPoint is set to the point found.
bool CalcIntersection(const CPoint &cPoint, 
                      const float flAngle,
                      const CPoint &PointA,
                      const CPoint &PointB,
                      const bool bExtendLine,
                      float &flD,
                      CPoint &intersectionPoint)
{
    // get source position 
    const float flSx = (float)cPoint.x;
    const float flSy = -(float)cPoint.y;

    // calc trig functions
    float flTan = tanf(flAngle);
    float flSin = sinf(flAngle);
    float flCos = cosf(flAngle);
    const bool bUseSin = fabsf(flSin) > fabsf(flCos);

    // get coordinates of line (negate the y value so the y-axis is upwards)
    const int p0x = PointA.x;
    const int p0y = -PointA.y;
    const int p1x = PointB.x;
    const int p1y = -PointB.y;

    // calc. deltas
    const float dsx = (float)(cPoint.x - p0x);
    const float dsy = (float)(-cPoint.y - p0y);
    float dx = (float)(p1x - p0x);
    float dy = (float)(p1y - p0y);

    // Calc. denominator
    const float d = dy * flTan - dx;

    // If line & ray are parallel
    if(fabsf(d) < 1.0e-7f)
        return false;

    // calc. intersection point parameter
    const float lambda = (dsy * flTan - dsx) / d;

    // If extending line to meet point, don't check for ray missing line
    if(!bExtendLine)
    {
        // If intersection is not valid
        if((lambda <= 0.0f) || (lambda > 1.0f))
            return false;   // Ray missed line
    }

    // If sine is bigger than cosine
    float mu;
    if(bUseSin){
        mu = ((float)p0x + lambda * dx - flSx) / flSin;
    } else {
        mu = ((float)p0y + lambda * dy - flSy) / flCos;
    }

    // if intersection is valid
    if(mu >= 0.0f)
    {
        // calc. intersection point
        const float px = (float)p0x + lambda * dx;
        const float py = (float)p0y + lambda * dy;

        // calc. distance between intersection point & source point
        dx = px - flSx;
        dy = py - flSy;
        flD = (dx * dx) + (dy * dy);

        intersectionPoint.x = RoundValue(px);
        intersectionPoint.y = -RoundValue(py);
        return true;
    }

    return false;
}

// Fillet (with a radius of 0) two lines. From point source fired at angle (radians) to line Line1A, Line1B.
// Modifies line end point Line1B. If the ray does not intersect line, then it is rotates every 90 degrees
// and tried again until fillet is complete.
void Fillet(const CPoint &source, const float fThetaRadians, const CPoint &Line1A, CPoint &Line1B)
{
    if(Line1A == Line1B)
        return; // No line

    float dist;

    if(CalcIntersection(source, fThetaRadians, Line1A, Line1B, true, dist, Line1B))
        return;
    if(CalcIntersection(source, CalcBaseFloat(TWO_PI, fThetaRadians + PI * 0.5f), Line1A, Line1B, true, dist, Line1B))
        return;
    if(CalcIntersection(source, CalcBaseFloat(TWO_PI, fThetaRadians + PI), Line1A, Line1B, true, dist, Line1B))
        return;
    if(!CalcIntersection(source, CalcBaseFloat(TWO_PI, fThetaRadians + PI * 1.5f), Line1A, Line1B, true, dist, Line1B))
        ASSERT(FALSE);  // Could not find intersection?
}

// routine to determine if an array of line segments cross gridSquare
// x and y give the float coordinates of the corners
BOOL CrossGridSquare(int nV, const CPoint *pV, 
                     const CRect &extent, const CRect  &gridSquare)
{
    // test extents
    if( (extent.right   < gridSquare.left) ||
        (extent.left    > gridSquare.right) ||  
        (extent.top     > gridSquare.bottom) ||
        (extent.bottom  < gridSquare.top))
    {
        return FALSE;
    }

    float a, b, c, dx, dy, s, x[4], y[4];
    int max_x, max_y, min_x, min_y, p0x, p0y, p1x, p1y, sign, sign_old;

    // construct array of vertices for grid square
    x[0] = (float)gridSquare.left;
    y[0] = (float)gridSquare.top;
    x[1] = (float)(gridSquare.right);
    y[1] = y[0];
    x[2] = x[1];
    y[2] = (float)(gridSquare.bottom);
    x[3] = x[0];
    y[3] = y[2];

    // for each line segment
    for(int i = 0; i < nV; i++) 
    {
        // get end-points
        p0x = pV[i].x;
        p0y = pV[i].y;
        p1x = pV[i + 1].x;
        p1y = pV[i + 1].y;

        // determine line extent
        if(p0x > p1x){
            min_x = p1x;
            max_x = p0x;
        } else {
            min_x = p0x;
            max_x = p1x;
        }

        if(p0y > p1y){
            min_y = p1y;
            max_y = p0y;
        } else {
            min_y = p0y;
            max_y = p1y;
        }

        // test to see if grid square is outside of line segment extent
        if( (max_x < gridSquare.left)  ||
            (min_x > gridSquare.right) ||  
            (max_y < gridSquare.top)   ||
            (min_y > gridSquare.bottom))
        {
            continue;
        }

        // calc. line equation
        dx = (float)(p1x - p0x);
        dy = (float)(p1y - p0y);
        a = dy;
        b = -dx;
        c = -dy * (float)p0x + dx * (float)p0y;

        // evaluate line eqn. at first grid square vertex
        s = a * x[0] + b * y[0] + c;
        if(s < 0.0f){
            sign_old = -1;
        } else if(s > 1.0f){
            sign_old = 1;
        } else {
            sign_old = 0;
        }

        // evaluate line eqn. at other grid square vertices
        for (int j = 1; j < 4; j++) 
        {
            s = a * x[j] + b * y[j] + c;
            if(s < 0.0f){
                sign = -1;
            } else if(s > 1.0f){
                sign = 1;
            } else {
                sign = 0;
            }

            // if there has been a chnage in sign
            if(sign != sign_old)
                return TRUE;
        }
    }

    return FALSE;
}

// calculate the square of the shortest distance from point s
// and the line segment between p0 and p1
// t is the point on the line from which the minimum distance
// is measured
float CalcShortestDistanceSqr(const CPoint &s,
                              const CPoint &p0,
                              const CPoint &p1,
                              CPoint &t)
{
    // if point is at a vertex
    if((s == p0) || (s == p1))
        return(0.0F);

    // calc. deltas
    int dx = p1.x - p0.x;
    int dy = p1.y - p0.y;
    int dsx = s.x - p0.x;
    int dsy = s.y - p0.y;

    // if both deltas are zero 
    if((dx == 0) && (dy == 0))
    {
        // shortest distance is distance is to either vertex
        float l = (float)(dsx * dsx + dsy * dsy);
        t = p0;
        return(l);
    }

    // calc. point, p, on line that is closest to sourcePosition
    // p = p0 + l * (p1 - p0)
    float l = (float)(dsx * dx + dsy * dy) / (float)(dx * dx + dy * dy);

    // if intersection is beyond p0
    if(l <= 0.0F){

        // shortest distance is to p0
        l = (float)(dsx * dsx + dsy * dsy);
        t = p0;

    // else if intersection is beyond p1
    } else if(l >= 1.0F){

        // shortest distance is to p1
        dsx = s.x - p1.x;
        dsy = s.y - p1.y;
        l = (float)(dsx * dsx + dsy * dsy);
        t = p1;

    // if intersection is between line end points
    } else {
        // calc. perpendicular distance
        float ldx = (float)dsx - l * (float)dx;
        float ldy = (float)dsy - l * (float)dy;
        t.x = p0.x + RoundValue(l * (float)dx);
        t.y = p0.y + RoundValue(l * (float)dy);
        l = ldx * ldx + ldy * ldy;
    }

    return(l);
}

// Calculates the bounding rectangle around a set of points
// Returns TRUE if the rectangle is not empty (has area), FALSE otherwise
// Opposite of CreateRectPoints()
BOOL CalcBoundingRectangle(const CPoint *pVertexList, const int nVertexTotal, CRect &rect)
{
    rect.SetRectEmpty();
    if(nVertexTotal < 2)
    {
        ASSERT(FALSE);  // Must have at least 2 points
        return FALSE;
    }

    // First point, set rectangle (no area at this point)
    rect.left = rect.right = pVertexList[0].x;
    rect.top = rect.bottom = pVertexList[0].y;

    // Increst rectangle by looking at other points
    for(int n = 1; n < nVertexTotal; n++)
    {
        if(rect.left > pVertexList[n].x)    // Take minimum
            rect.left = pVertexList[n].x;

        if(rect.right < pVertexList[n].x)   // Take maximum
            rect.right = pVertexList[n].x;

        if(rect.top > pVertexList[n].y)     // Take minimum
            rect.top = pVertexList[n].y;

        if(rect.bottom < pVertexList[n].y)  // Take maximum
            rect.bottom = pVertexList[n].y;
    }

    rect.NormalizeRect();   // Normalise rectangle
    return !(rect.IsRectEmpty());
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-13T07:54:09.933

这个来自[Stony Brook Algorithm Repository](http://www.cs.sunysb.edu/~algorith)的交叉算法实现[目录](http://www.cs.sunysb.edu/~algorith/files/intersection-detection.shtml)可能很有用。该存储库由 Steven Skiena 管理，他是一本非常受人尊敬的算法书籍的作者：[算法设计手册](https://rads.stackoverflow.com/amzn/click/com/1848000693)。

顺便说一句，这是他自己的亚马逊执行链接:)

# ruby - Ruby => 运算符

> ID：608095
> 
> 赞同：12
> 
> 时间：2009-03-03T20:44:24.047
> 
> 标签：ruby, syntax

我在哪里可以找到有关`=>`运算符在 Ruby 中的含义的解释？

例如，

```
class Acct < ActiveRecord::Base
  validates_confirmation_of :password, :email_address, :on => :create
end 
```

`=>`在这种情况下，操作员在做什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-03T21:47:57.450

符号“=>”不是运算符。它只是一种语法手段，表示其他两个元素之间存在“键值”关系。它用于定义散列（或关联数组，因为它们在某些其他语言中被称为，例如 PHP）。从这个意义上说，因为“=>”它不是一个运算符，所以它什么都不做（所以符号“[”和“]”在用于定义数组时什么都不做）。如果您仍然感到困惑，请查看 Hash Ruby 类并将其与 Array 类进行比较。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-12-06T03:10:43.490

### “*哈希火箭*”语法

该符号不是运算符，只是用于定义文字 Hash 对象的语法的一部分。它通常被称为*哈希火箭*。

通常，文字哈希对象会被定义为：

```
a = { :x => 1, :y => 2 } # same thing as: a = Hash.new; a[:x] = 1; a[:y] = 2 
```

当然，它可以传递给一个方法：

```
def f(x); end; f({:x => 1, :y => 2}) 
```

碰巧的是，当散列作为最后一个参数传递给方法时，`{}`可以删除对象字面量的一部分：

```
f(:x => 1, :y => 2) 
```

括号也是可选的，所以我们得到如下内容：

```
f :x => 1:, :y => 2 # and of course...
validates_confirmation_of :password, :email_address, :on => :create 
```

最后（仅在现代 Ruby 中）对于哈希键是符号的特定情况，您可以编写*key* **:** *value*，因此：

```
f x: 1, y: 2 # not to mention...
validates_confirmation_of :password, :email_address, on: :create 
```

请注意，可以在类定义中进行方法调用。它们像任何其他方法调用一样被执行，但在定义时执行。它们对于像 Rails 这样进行大量元编程以扩展其应用程序域的语言和库对象的包特别有用。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-03T21:59:45.080

为了扩展接受的答案（它不是运算符），基本上以与逗号相同的方式考虑它。

```
{ "foo" => "bar", "a" => "b" } 
```

逗号分隔散列中的每一对，分隔对内`=>`的键和值。

# c# - 冗长的代码行与可读性

> ID：608096
> 
> 赞同：3
> 
> 时间：2009-03-03T20:44:46.620
> 
> 标签：c#, .net, webrequest, streamreader, responsestream

这是非常好的 C# 代码，并且在提供正确的 URL 时可以正常工作。但是通过降低代码的可读性，一切都只是在一行中完成。

这是代码：

```
 return new StreamReader(WebRequest.Create(urlName).GetResponse().GetResponseStream()).ReadToEnd(); 
```

我只是想知道开发人员对这种写代码的捷径有什么看法

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-03T20:50:07.743

将其推入一个有名的方法中，并可能将其拆分，以便单个语句延伸到几行。我也可能会使用 WebClient：

```
return new WebClient().DownloadString(urlName); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-03T21:16:55.857

不，这不是非常完美的 C# 代码。您应该处置 StreamReader，因此至少有一个`using`声明：

```
using (StreamReader reader = new StreamReader(WebRequest.Create(urlName).GetResponse().GetResponseStream()) {
   return reader.ReadToEnd();
} 
```

通过将其分成更多行，该代码可能会获得一点可读性，但不是很多。

通常我更喜欢可读代码而不是紧凑代码。每行有一个语句使代码更易于阅读和理解。例如：

```
if (i <= 4) i = 4 - i; 
```

将 if 语句放在一行中，将其中的代码放在单独的行上，这变得更具可读性，if 语句始终带有括号：

```
if (i <= 4) {
   i = 4 - i;
} 
```

当然，即使是紧凑形式，这段代码也具有相当的可读性，但代码越复杂，将每个语句放在单独的行中获得的收益就越多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T20:51:41.453

...哎呀。

有时我会将一些东西合并成一行，通常是在我将东西倾倒到流中时，但从来没有这么多。

如果定义只使用一次，大多数编译器（至少是 c++ 编译器）通常会内联变量定义，因此如果您一次性使用，请丢弃变量。您的 C# 编译器可能只是将其名称替换为其定义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T20:52:14.730

除了可读性问题之外，您还应该处置您正在使用的任何 IDisposble 对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-07-01T07:30:53.230

一条语句！= 一行，您可以通过改进代码格式来提高可读性。当然，您不应该假设其他人使用高分辨率显示器。

# c++ - C++ - 具有下限/上限的圆形数组？

> ID：608097
> 
> 赞同：5
> 
> 时间：2009-03-03T20:45:08.583
> 
> 标签：c++, c, math

我想创建类似于双链表（但使用数组）的东西，它适用于下限/上限。

一个典型的圆形数组可能看起来像：

```
next = (current + 1) % count;
previous = (current - 1) % count; 
```

但是将下限/上限正确纳入其中的数学算术是什么？

*   0（下限项目 1）
*   1
*   2（上限项目 1）
*   3（下限项目 2）
*   4（上限项目 2）

以便：

-> 项目 1 的索引 2 上的下一个返回 0

-> 项目 1 的索引 0 上的前一个返回 2

-> 项目 2 的索引 4 上的下一个返回 3

-> 索引 3 上第 2 项的上一个返回 4

谢谢 ！

**注意：不能使用外部库。**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-03T20:53:39.873

在一般数学术语中：

```
next === current + 1 (mod count)
prev === current - 1 (mod count) 
```

其中 === 是“全等”运算符。将其转换为模运算符，它将是：

```
count = upper - lower
next = ((current + 1 - (lower%count) + count) % count) + lower
prev = ((current - 1 - (lower%count) + count) % count) + lower 
```

找出每个项目的上限和下限由您决定。您可以将其存储在二叉树中以便快速检索。也许我不明白你的问题。

（请注意，这假设 lower < upper, and lower > 0）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-03T20:59:11.327

```
 +=======+        +=======+        +=======+
          |  Obj  | --->   |  Obj  |  --->  |  Obj  |
buffer    |   1   | <---   |   2   |  <---  |   3   |
          +=======+        +=======+        +=======+  

index       0                  1                2        /* our first run */

index       3                  4                5        /* second run */

and so on ... 
```

因此，您看到对于 3 个成员列表，第一项由`0, 3, 6,`等索引。类似地，第二项由`1, 4 (1 + 3), 7 (4 + 3), ...`

一般规则是：`next <- (next + 1) % size`, 其中`size = upper - lower + 1`

使用这个公式，我们得到：

```
 curr |      next  
-------+-----------------
   0   | (0 + 1) % 3 = 1
-------+-----------------
   1   | (1 + 1) % 3 = 2
-------+-----------------
   2   | (2 + 1) % 3 = 0
-------+----------------- 
```

希望有帮助

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-03T21:38:36.100

几年前我写了这篇关于循环 STL 迭代器的文章。

[http://noveltheory.com/Iterators/Iterator_N0.htm](http://noveltheory.com/Iterators/Iterator_N0.htm)

It will work on any STL collection (vectors & boost:array, etc)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-03T20:47:02.387

Boost 有一个[Circular 容器](http://www.boost.org/doc/libs/1_38_0/libs/circular_buffer/doc/circular_buffer.html)，我相信你也可以设置它的界限。

事实上，该页面上的示例看起来与您在此处所说的非常相似。

但无论如何，您可以使用模数轻松完成数学部分：

所以说你的最大值是3：

```
int MAX = 3;
someArray[ 0 % MAX ]; // This would return element 0
someArray[ 1 % MAX ]; // This would return element 1
someArray[ 3 % MAX ]; // This would return element 0
someArray[ 4 % MAX ]; // This would return element 1 
```

# python - 切换数据库 API 会失去或得到什么？（从 pywin32 和 pysqlite 到 QSql）

> ID：608098
> 
> 赞同：1
> 
> 时间：2009-03-03T20:45:14.980
> 
> 标签：python, qt, sqlite, pyqt4, pywin32

我正在编写一个 Python (2.5) GUI 应用程序，它执行以下操作：

*   从 Access 导入到 Sqlite 数据库
*   将 ui 表单设置保存到 Sqlite 数据库

目前我使用 pywin32 读取 Access，使用 pysqlite2/dbapi2 读取/写入 Sqlite。

但是，某些 Qt 对象在更新 Sqlite 数据库时不会自动转换为 Python 或 Sqlite 等效项。例如，QDate、QDateTime、QString 等会引发错误。目前我正在维护转换功能。

我使用 QSql 进行了调查，这似乎克服了强制转换问题。此外，它能够连接到 Access 和 Sqlite。这两个好处*似乎*允许我重构我的代码以使用更少的模块而不是维护我自己的转换函数。

**我正在寻找的是任何 SO 社区因切换到 QSql 而经历的重要副作用、性能增益/损失、功能增益/损失的列表。**

到目前为止，我遇到的一个功能损失是无法使用 QODBC 驱动程序使用 Access 函数（例如，'SELECT LCASE(fieldname) from tablename' 失败，'SELECT FORMAT(fieldname, "General Number") from tablename'）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T21:22:54.110

在处理数据库和 PyQt UI 时，我将使用类似于模型-视图-控制器模型的东西来帮助组织和简化代码。

**查看模块**

*   使用/持有 UI 所需的任何 QObjects
*   包含用于更新 QTGui 对象以及从 GUI 对象中提取输入的简单函数/方法

**控制器模块**

*   将执行所有数据库交互
*   更复杂的代码在这里

通过使用 MVC，您将无需过多地依赖 QT 库，并且在将 QT 与 Python 链接时遇到的问题也更少。

所以我想**我的建议是继续使用 pysqlite**（因为这是你习惯的），但是稍微重构你的设计，所以唯一处理 QT 库的就是 UI。从您的 GUI 的描述来看，它应该是相当简单的。

# c# - Winforms .Net 简单数据绑定不起作用

> ID：608102
> 
> 赞同：2
> 
> 时间：2009-03-03T20:45:45.197
> 
> 标签：c#, .net, winforms, data-binding

我有一个带有非常基本前提的 Winform：修改传递给它的对象的 2 个字符串属性，然后在表单关闭时将其保存到磁盘。我正在尝试使用数据绑定将表单上 2 个文本框的 Text 属性绑定到对象的 2 个字符串属性。

但它不起作用。文本框从不显示我在构造函数中分配给对象属性的值。当我在文本框中输入内容时，对象属性没有得到更新。我究竟做错了什么？

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.IO;
using System.Xml;
using System.Xml.Serialization;
namespace Eds_Viewer
{
    public partial class EdsConfigForm : Form
    {
        public EdsConfigForm(EdsConfig myconfig)
        {
            InitializeComponent();
            EdsConfig = myconfig;
            if (EdsConfig.VFPConnectionString == null) //set a default value
            {
                EdsConfig.VFPConnectionString = "Provider=vfpoledb;Data Source=g:\\eds\\";
            }
            if (EdsConfig.VFPFileName == null) //set a default value
            {
                EdsConfig.VFPFileName = "InvoiceDB";
            }
            this.VFPConnectionStringTextbox.DataBindings.Add("Text", EdsConfig, "VFPConnectionString");
            this.VFPFileNameTextbox.DataBindings.Add("Text", EdsConfig, "VFPFileName");
        }
        EdsConfig EdsConfig;
        private void SaveConfigToDisk(EdsConfig myconfig)
        {
            XmlSerializer x = new XmlSerializer(typeof(EdsConfig));
            TextWriter tw = new StreamWriter("EdsConfig.xml");
            x.Serialize(tw, myconfig);
            tw.Close();
        }
        private void EdsConfigForm_FormClosing(object sender, FormClosingEventArgs e)
        {
            this.SaveConfigToDisk(this.EdsConfig);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-03T20:55:31.477

**EdsConfig**类是否实现了INotifyPropertyChanged[接口](http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanged.propertychanged(VS.80).aspx)？
这是用作数据绑定源的对象的要求，因为从属性的设置器引发的**PropertyChanged**事件用于在修改属性时更新绑定。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T21:02:24.377

将“DataBindings.Add(..)”中的 DataSource 参数设置为“bs”（BindingSource 类型）

```
 BindingSource bs = new BindingSource(EdsConfig, "VFPConnectionString");
    this.VFPConnectionStringTextbox.DataBindings.Add("Text", bs, "VFPConnectionString");
    this.VFPFileNameTextbox.DataBindings.Add("Text", bs, "VFPFileName"); 
```

# coldfusion - Coldfusion - cfquery 没有返回正确的数据

> ID：608104
> 
> 赞同：1
> 
> 时间：2009-03-03T20:46:26.380
> 
> 标签：coldfusion

我很难弄清楚为什么当 cfquery 在我的代码中运行时它只返回一行，而它应该返回三行。

在几乎所有情况下，这个 cfquery 都会返回正确的数据。对于一两个用户，cfquery 只返回 1 行（共 3 行）。我从 Coldfusion 吐出的调试信息中获取输出并在 toad 中运行该查询，并显示正确的结果。

什么可能导致 cfquery 和 toad 结果不同？我要返回的列之一是用户定义的，也许该列中有一些特殊字符导致结果不返回？我真的很难过，这里没有人知道任何冷融合甚至可以帮助我思考这个问题。所以我转向SO。

我们说话的时候，我正在网上搜索。

添加：

```
<cfquery name="getInfo" datasource="#DSN#">
    SELECT
        u.user_no, u.username, u.description
    FROM
        user_info u
    WHERE
        u.parent = #session.user_no#
    ORDER BY 
        u.username ASC
</cfquery> 
```

同样，一个少数用户返回三行中的一行，其余的似乎返回所有正确的结果。

**** 更新 **** 没有人关心，但就在今天，这个问题得到了解决！如果你想知道那是什么，我会告诉你。

原来正在测试这段代码的测试人员（声称她正在清除她的缓存！）没有清除她的缓存！在我告诉她这可能是问题之后，当她给我喂一些 BS 时，她让我跑来跑去试图修复它。哦，好吧，我没有花太多时间在上面。感谢所有人提供有关 cfqueryparam 的答案，从现在开始，我将在我的冷融合编码中使用这些答案。

干杯!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T21:41:22.910

**始终`cfqueryparam`在查询中使用周围变量！**

对，现在已经不碍事了，该代码中没有任何内容会导致仅返回三行之一。

因此，您的问题要么与数据相关，要么与代码中的其他地方有关。

如果您在该查询后*立即执行以下操作：*

```
<cfdump var="#getInfo#"/><cfabort/> 
```

你得到一排还是三排？

*   如果是一行，则表明存在数据问题——我怀疑非 ascii 的“特殊”字符会导致这种情况，但尝试只返回一个整数来测试——或者甚至`SELECT 1 ...`——如果有三行，你会得到三个 1。

*   如果那里有三行，那么一定是一些后来的代码导致了问题，所以我们需要知道接下来发生了什么才能提供帮助。

有道理？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T11:22:09.163

我会使用 cfqueryparam 来定义您在查询中输入的变量类型。

对数据库查询过于具体从来没有什么坏处，而且我之前遇到过整数被评估为字符串并因此返回不正确的结果集的问题。

（添加（主要）奖励 - cfqueryparam 总是有利于增加对 SQL 注入攻击的保护）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T16:35:15.120

我想错误出在数据或您的输入中（会话超时/无效？）。

实际上，我*从未*见过`<cfquery>`与数据库服务器在控制台上告诉您的结果不同的结果。这太不可能了，我不认为这是一种可能性。

我建议以下测试场景：

```
<cfquery name="AllUsers" datasource="#DSN#>
  SELECT 
    p.user_no,
    COUNT(u.user_no) ChildCount
  FROM
    user_info p
    LEFT JOIN user_info u ON p.user_no = u.parent
  GROUP BY
    p.user_no
  ORDER BY
    COUNT(u.user_no)
</cfquery>

<cfdump var="#AllUsers#"> 
```

在那里，您将确切地看到每个用户有多少个孩子。

如果它让你感觉更安全，你可以运行一个循环并单独检查结果：

```
<cfloop query="AllUsers">
  <cfquery name="SingleUser" datasource="#DSN#">
    SELECT
      u.user_no, u.username, u.description
    FROM
      user_info u
    WHERE
      u.parent = #AllUsers.user_no#
  </cfquery>

  <cfif SingleUser.RecordCount neq AllUsers.ChildCount>
    <cfabort showerror="space-time rupture found for user #AllUsers.user_no#">
  </cfif>
</cfloop> 
```

我敢打赌，`<cfabort>`它永远不会被击中，这将证明它`<cfquery>`的功能完美无缺，你必须寻找其他地方。

# c# - 是否可以将 XML 反序列化为 List ?

> ID：608110
> 
> 赞同：161
> 
> 时间：2009-03-03T20:47:45.690
> 
> 标签：c#, serialization, xml-serialization, xml-deserialization

给定以下 XML：

```
<?xml version="1.0"?>
<user_list>
   <user>
      <id>1</id>
      <name>Joe</name>
   </user>
   <user>
      <id>2</id>
      <name>John</name>
   </user>
</user_list> 
```

以及以下课程：

```
public class User {
   [XmlElement("id")]
   public Int32 Id { get; set; }

   [XmlElement("name")]
   public String Name { get; set; }
} 
```

是否可以使用`XmlSerializer`将 xml 反序列化为`List<User>`? 如果是这样，我需要使用什么类型的附加属性，或者我需要使用什么附加参数来构造`XmlSerializer`实例？

`User[]`如果不太可取，数组 ( ) 是可以接受的。

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2009-03-03T21:05:23.167

您可以简单地*封装*列表：

```
using System;
using System.Collections.Generic;
using System.Xml.Serialization;

[XmlRoot("user_list")]
public class UserList
{
    public UserList() {Items = new List<User>();}
    [XmlElement("user")]
    public List<User> Items {get;set;}
}
public class User
{
    [XmlElement("id")]
    public Int32 Id { get; set; }

    [XmlElement("name")]
    public String Name { get; set; }
}

static class Program
{
    static void Main()
    {
        XmlSerializer ser= new XmlSerializer(typeof(UserList));
        UserList list = new UserList();
        list.Items.Add(new User { Id = 1, Name = "abc"});
        list.Items.Add(new User { Id = 2, Name = "def"});
        list.Items.Add(new User { Id = 3, Name = "ghi"});
        ser.Serialize(Console.Out, list);
    }
} 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2014-02-14T11:23:51.200

如果你用 装饰`User`类`XmlType`以匹配所需的大小写：

```
[XmlType("user")]
public class User
{
   ...
} 
```

然后ctor`XmlRootAttribute`上的`XmlSerializer`可以提供所需的根并允许直接读入 List<>：

```
 // e.g. my test to create a file
    using (var writer = new FileStream("users.xml", FileMode.Create))
    {
        XmlSerializer ser = new XmlSerializer(typeof(List<User>),  
            new XmlRootAttribute("user_list"));
        List<User> list = new List<User>();
        list.Add(new User { Id = 1, Name = "Joe" });
        list.Add(new User { Id = 2, Name = "John" });
        list.Add(new User { Id = 3, Name = "June" });
        ser.Serialize(writer, list);
    } 
```

...

```
 // read file
    List<User> users;
    using (var reader = new StreamReader("users.xml"))
    {
        XmlSerializer deserializer = new XmlSerializer(typeof(List<User>),  
            new XmlRootAttribute("user_list"));
        users = (List<User>)deserializer.Deserialize(reader);
    } 
```

学分：基于[YK1](https://stackoverflow.com/users/1529246/yk1)的[回答](https://stackoverflow.com/a/21775195/451944)。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-03-03T21:05:00.300

是的，它将序列化和反序列化 List<>。如果有疑问，请确保使用 [XmlArray] 属性。

```
[Serializable]
public class A
{
    [XmlArray]
    public List<string> strings;
} 
```

这适用于 Serialize() 和 Deserialize()。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2011-02-01T07:54:21.607

我想我找到了更好的方法。您不必将属性放入您的类中。我制作了两种以通用列表作为参数的序列化和反序列化方法。

看看（它对我有用）：

```
private void SerializeParams<T>(XDocument doc, List<T> paramList)
    {
        System.Xml.Serialization.XmlSerializer serializer = new System.Xml.Serialization.XmlSerializer(paramList.GetType());

        System.Xml.XmlWriter writer = doc.CreateWriter();

        serializer.Serialize(writer, paramList);

        writer.Close();           
    }

private List<T> DeserializeParams<T>(XDocument doc)
    {
        System.Xml.Serialization.XmlSerializer serializer = new System.Xml.Serialization.XmlSerializer(typeof(List<T>));

        System.Xml.XmlReader reader = doc.CreateReader();

        List<T> result = (List<T>)serializer.Deserialize(reader);
        reader.Close();

        return result;
    } 
```

所以你可以序列化你想要的任何列表！您不需要每次都指定列表类型。

```
 List<AssemblyBO> list = new List<AssemblyBO>();
        list.Add(new AssemblyBO());
        list.Add(new AssemblyBO() { DisplayName = "Try", Identifier = "243242" });
        XDocument doc = new XDocument();
        SerializeParams<T>(doc, list);
        List<AssemblyBO> newList = DeserializeParams<AssemblyBO>(doc); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-10-22T15:33:59.613

是的，它确实反序列化为 List<>。无需将其保存在数组中并将其包装/封装在列表中。

```
public class UserHolder
{
    private List<User> users = null;

    public UserHolder()
    {
    }

    [XmlElement("user")]
    public List<User> Users
    {
        get { return users; }
        set { users = value; }
    }
} 
```

反序列化代码，

```
XmlSerializer xs = new XmlSerializer(typeof(UserHolder));
UserHolder uh = (UserHolder)xs.Deserialize(new StringReader(str)); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-03T20:51:00.643

不确定 List<T> 但数组肯定是可行的。一点点魔法让再次进入列表变得非常容易。

```
public class UserHolder {
   [XmlElement("list")]
   public User[] Users { get; set; }

   [XmlIgnore]
   public List<User> UserList { get { return new List<User>(Users); } }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-02-17T15:55:57.387

怎么样

```
XmlSerializer xs = new XmlSerializer(typeof(user[]));
using (Stream ins = File.Open(@"c:\some.xml", FileMode.Open))
foreach (user o in (user[])xs.Deserialize(ins))
   userList.Add(o); 
```

不是特别花哨，但它应该可以工作。

# security - 如何防止直接浏览到 Web 目录中的图像？

> ID：608111
> 
> 赞同：2
> 
> 时间：2009-03-03T20:47:50.263
> 
> 标签：security, permissions

我正在创建一个您必须登录才能访问的图片库网站。该站点将使用会话来跟踪用户名和密码。登录的用户将能够搜索图像并查看结果。据推测，这意味着我将把图像放在网络目录中。如何防止未登录的人直接浏览此目录中的图像？

这是基于 PHP 的，带有 MySQL。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T20:51:59.177

检查引荐来源标头，并要求它来自您的站点。您还可以检查 cookie 是否已发送给您（他们已登录）。

你最好的选择是让 PHP 从你的 web 目录之外的位置获取图像。

另外，查看注释字符串：使用 mod_rewrite 可以直接从 apache 完成所有这些操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T20:52:06.587

将图像放在无法通过直接 URL 访问的文件夹中，并让程序直接提供图像

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T20:52:16.053

不要将图像放在可浏览的目录中。更好的是，将它们存储在您的 webroot 之外。在用户经过验证和验证后，放置某种自定义处理程序将加载请求的图像并将其发送回用户。这也将防止图像的热链接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-03T20:56:35.390

将图像放在网站外部的文件夹中，并使用代理页面将图像发送到浏览器。在 img 标签中创建一个用作 url 的页面，例如：

getimage.php?id=8783475

在页面中，您检查用户是否已登录，并根据参数确定要发送的图像。将页面的内容类型设置为与图片匹配的类型，例如“image/jpeg”，读取图片文件直接发送到响应流。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-19T16:40:09.260

如果您的图像不是太大，有一种非常聪明的方法可以保护它们免受未经授权的访问。您可以使用 base64 编码，与 Outlook Express 附件编码相同，并将代码放在使用 SESSION 对象的 ASP 页面中。有关此主题的更多信息，请参阅 ASP 教程。当用户访问该页面时，asp 代码会检查用户是否已通过身份验证。如果他不是，脚本会中断页面​​代码，而不是可视化图像。如果用户通过身份验证，则脚本会加载整个页面，并将 base64 重建为可见图像。这里的诀窍是你没有一个包含纯图像的目录，但图像是在页面 html 中编码的，所以它是由脚本动态重建的。由于目录中没有图像，因此没有人可以尝试将浏览器直接指向它们，因为他们根本不存在。您可以使用此站点对图像进行编码：

[http://www.motobit.com/util/base64-decoder-encoder.asp](http://www.motobit.com/util/base64-decoder-encoder.asp)

然后你必须使用这个标签在 html 代码中“调用”图像：

img src="data:image/gif;base64, ...................... ............（这里放置从上面网站获得的代码）......

你完成了！如果用户未登录，则无法访问您的图像。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-03T20:52:37.067

不要让人们直接访问您的图像目录。

让您的图库软件将图像转发给用户。检查所需的凭据。

# php - 保护 PHP 文件管理器免受其用户的侵害

> ID：608112
> 
> 赞同：1
> 
> 时间：2009-03-03T20:48:22.740
> 
> 标签：php, ajax, security, file, codeigniter

[大家好，我正在使用CodeIgniter PHP 框架](http://www.codeigniter.com/)开发一个照片分享网站。这个想法是人们可以上传他们的照片，管理它们（通过某种文件浏览器，允许他们创建子文件夹，拖动文件等）和编辑它们（一些基本的东西，比如调整大小，旋转和裁剪开始，和稍后，我将添加一些高级功能）。

我已经为 CI 实现了第三方身份验证解决方案（[Redux Authentication 2 Beta](http://code.google.com/p/reduxauth/)），我现在正在集成一个 JS/PHP 文件管理器（[AjaxExplorer](http://sourceforge.net/projects/ajax-explorer/)），但问题是用于管理文件的 PHP 后端（移动、复制、等）过于信任来自 ajax 调用的用户输入。例如，它正在做这样的事情（为了清楚起见进行了简化）：

```
move_uploaded_file($_FILES['upload']['tmp_name'], $root.$username.$_POST['destination_dir']); 
```

如您所见，存在明显的安全问题，因为它盲目地接受用户输入的任何路径！我已经看到有人发送类似“../AnotherUser/”的东西作为 $_POST['destination_dir'] 值。

我的问题是：**“沙箱”用户的最佳方式是什么，以便只允许他管理自己的数据？**我是否只是验证+过滤输入，希望捕捉到每一次入侵尝试？是否有专门用于解决此特定问题的库/包？

我认为这个问题必须在任何（足够成熟的）项目中以某种方式解决，它赋予用户通过网络浏览器管理文件的能力，所以我希望找到一些明确的指导方针（因为有很多关于 SQL 注入、XSS、CSRF 等），但我想我没有使用正确的关键字。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-03T21:08:53.347

> “沙盒”用户的最佳方式是什么，以便只允许他管理自己的数据？

允许用户想要的任何文件名/目录名，但不要在服务器端文件系统上使用它们。相反，将路径名写入带有主键的数据库，并将主键用作平面存储目录中的文件名，如“34256.dat”（如果您愿意，甚至可以作为数据库中的 BLOB）。然后通过下载脚本或 URL 重写提供服务，以使所需的文件名出现在 URL 中。

清理传入的文件名**很难**。检测“..”只是开始。文件名过长；文件名太短；前导点和尾随点的组合；前导和尾随空格的组合；不同平台的不同目录分隔符；在某些平台上无效的字符；控制字符；Unicode 字符和特定环境的寻址方式；ADS；对您的网络服务器来说可能是“特殊”的文件名（'.htaccess'）或扩展名（'.php'、'.cgi'）；Windows 的保留文件名...

您可以花费一生的时间来追踪各种平台上有趣的文件路径规则的小怪癖，或者您可以忘记它并使用数据库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T20:56:11.707

我不确定你的`destination_dir`样子，但我想到的是分配目录键，然后根据该键获取目录。例如：

```
//$_POST['destination_dir'] = '4hg43h5g453j45b3';
*_query('SELECT dir FROM destinations WHERE key = ? LIMIT 1'); //etc. 
```

但是，您必须事先预定义键。另一种选择可能相反：md5/sha1 输入并将其用作destination_dir，然后将该键与相关标签一起存储在数据库中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T20:58:45.087

我所知道的没有图书馆。
但是，在您的特定示例中，从字符串中删除所有（反）斜杠和点，然后在其末尾附加一个斜杠，这样用户就无法更改文件夹。

```
$destdir = str_replace(array('.', '/', '\\'), '', $_POST['destination_dir']); 
$destdir .= "/"; 
```

# php - 通过 odbc 和 php 连接到 quickbooks 数据库？

> ID：608117
> 
> 赞同：4
> 
> 时间：2009-03-03T20:50:48.103
> 
> 标签：php, mysql, odbc, quickbooks

**[编辑]**
我们正在网络表单上收集用户的信用申请数据。

我没有将我的网络表单直接绑定到 QB。

我不知道这个数据集合的 QB 表结构是什么 - 也不知道它如何向用户显示它，因为我从未真正直接使用过 QB。然而，我办公室的其他人也这样做。

* * *

我仍然会很感激有关开源/免费选项的任何信息。

* * *

我将通过删除第一个所需选项来简化问题。

让我们只讨论将平面文件导入快速书。

我没有可以玩的快速书副本，所以我不知道存在哪些快速书本机的选项，但我在网上看到一些关于 QB 期望导入 .ini 文件的讨论。（还不知道它期望的格式，但我稍后会解决）

如果您设法将一个平面文件从 mySQL 导入到快速手册中，或者知道提供洞察力的链接（我现在找不到太多），请分享您的故事。
**[结束编辑]**

我意识到这种情况可能并不常见，但我需要以两种方式之一连接到现有的 quickbooks 数据库。

1) 直接从在我们网站上运行的 php 脚本——将用户提供的数据直接从网络插入到快速手册中。

或者

2）将用户的数据直接放入mySQL数据库，然后将数据从mySQL导出到quickbooks。

如果第一个选项可行，我将不胜感激您对建立与 quickbooks 数据库的 odbc 连接的想法。

我可以这样做吗：

```
try {
  $conn = @odbc_connect("DSNName", "", "", "SQL_CUR_USE_ODBC");
  // un and pw parameters are passed as empty strings since the DSN 
  // has knowledge of the password already.
  // 4th parameter is optional

  $exec = @odbc_exec($conn, $insert) or die ("exec error");
  echo "success!";
}
catch (Exception $e) {
  echo $e->getMessage();
} // end try catch 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T17:04:13.887

第三个选项可能对您有用。

**选项 1 - QODBC：**如果您正在寻找简单性，上面提到的 Qodbc 是主要的产品，它确实需要花钱。

**选项 2 - Quickbooks SDK：**如果您可以使用 SDK 并使用它们的 XML 结构，您可以在开发人员网络上找到一些很棒的资源。SDK 的帐户是免费的，您可以相当轻松地完成它。

这归结为一件事，如果您想免费获得它，您可能无法按照自己的方式获得它。我上次检查时，QODBC 的价格合理。

使用任何一种方法都需要注意的重要一点——确保您希望在 Quickbooks 中写入数据的表对于 SDK 和 QODBC 可用。

随着 Quickbooks 变老，对某些表格的访问已经消失。例如，无法直接写入工资扣除表，因为它与 Intuit 的工资服务竞争。

**选项 3 - 直接 SQL 操作：** Intuit 在其 SQL 数据中加密其数据，使其无法直接访问。

**编辑：选项 4 - Quickbooks Web 连接器** SOAP 包装器，它位于具有 Quickbooks 的计算机上并为您与之交互。也是免费的。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T16:28:00.287

如果您想要 ODBC 访问，QODBC 是您唯一的选择。

较新版本的 QuickBooks Enterprise Edition 使用 SQL 数据库后端，但它*不允许*您直接访问 SQL 表。他们锁定数据库，因此您实际上无法查询任何数据。

AccessBooks 是另一种选择，它将 QuickBooks 中的数据镜像到 MySQL，然后也可以将数据推送回 QuickBooks。我听说它可能有点片状。

您可以使用 QuickBooks SDK 并使其执行您在 QuickBooks GUI 中可以执行的几乎所有操作，但需要做更多的工作。如果您将 Web 应用程序与 QuickBooks 集成，您将需要使用 Web 连接器。我是 QuickBooks/PHP 框架的开发人员，该框架非常稳定且流行，可能会对您有所帮助：

[https://idnforums.intuit.com/messageview.aspx?catid=56&threadid=9164](https://idnforums.intuit.com/messageview.aspx?catid=56&threadid=9164)

我正在添加对将整个 QB 模式镜像到数据库的支持，使其保持同步，然后允许将更改推送回 QuickBooks。不过，这项工作还没有接近完成。它目前从 QuickBooks 中提取数据并保持同步非常好。

您还可以将 IIF 文件导入 QuickBooks，但它现在是 Intuit 不支持和弃用的格式。他们强烈建议您不要使用它，以下是一些原因： [http ://wiki.consolibyte.com/wiki/doku.php/quickbooks_integration_methods](http://wiki.consolibyte.com/wiki/doku.php/quickbooks_integration_methods)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T23:57:48.463

您可能已经看过这个，但如果您还没有看过，您可能会想看一下，因为它似乎为您的第一个场景提供了要求、设置说明和示例代码。

[http://www.qodbc.com/QODBCweb.htm](http://www.qodbc.com/QODBCweb.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T16:43:59.910

不确定导入到底要完成什么：您将哪种交易推送到快速手册中？

我在使用 QuickBooks SDK 将数据推送到 quickbooks 方面取得了巨大成功，尤其是交易数据，这样对账、过帐等事情就由 quickbooks 本身处理。您可以选择此选项吗？

您可以在此处获得[有关 SDK](http://developer.intuit.com/)的大量信息

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-23T03:20:50.913

使用 QuickBooks Enterprise 2011，这发生了变化，您可以拥有真正的 ODBC 访问权限（尽管权限有限并且只能访问有限数量的表），然后使用 SQL 工具通过 ODBC 访问进行映射。

# c# - 跨子域的表单身份验证

> ID：608120
> 
> 赞同：26
> 
> 时间：2009-03-03T20:51:15.603
> 
> 标签：c#, asp.net, forms-authentication

当身份验证发生在子域而不是父域时，是否可以跨子域对用户进行身份验证？

例如：

用户登录到site1.parent.com，然后我们需要将他们发送到reporting.parent.com。

即使登录发生在子域中，我是否可以向报告站点验证它们？

到目前为止，我所做的所有研究都是让用户先登录到父域，然后每个子域都可以访问身份验证 cookie。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-03T21:06:22.137

在对用户进行认证时，将认证cookie的域设置为二级域，即parent.com。每个子域都会根据请求接收父域的 cookie，因此可以对每个子域进行身份验证，因为您将有一个共享的身份验证 cookie 可供使用。

验证码：

```
System.Web.HttpCookie authcookie = System.Web.Security.FormsAuthentication.GetAuthCookie(UserName, False);
authcookie.Domain = "parent.com";
HttpResponse.AppendCookie(authcookie);
HttpResponse.Redirect(System.Web.Security.FormsAuthentication.GetRedirectUrl(UserName, 
                                                                       False)); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-03T21:02:55.030

您可以在身份验证时将 cookie 设置为父域，但您必须明确设置它，它将默认为您所在的完整域。

一旦 auth cookie 正确设置为父域，那么所有子域都应该能够读取它。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-07-02T09:55:08.350

附带说明一下，我发现在使用 jro 的方法效果很好 +1 后，FormsAuthenication.SignOut() 方法在从 www/ 以外的子域调用时不起作用。（我猜是因为 .Domain 属性不匹配） - 为了解决这个问题，我使用了：

```
if (Request.Cookies[FormsAuthentication.FormsCookieName] != null)
            {
                HttpCookie myCookie = new HttpCookie(FormsAuthentication.FormsCookieName);
                myCookie.Domain = "parent.com";
                myCookie.Expires = DateTime.Now.AddDays(-1d);
                Response.Cookies.Add(myCookie);
            } 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-06-24T04:37:16.790

除了给父域设置一个cookie外，还需要确保所有站点（应用程序）具有相同的validationKey和decryptionKey()，以便它们都能识别彼此的身份验证票和cookie。很好的文章在这里[http://www.codeproject.com/KB/aspnet/SingleSignon.aspx](http://www.codeproject.com/KB/aspnet/SingleSignon.aspx)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-06-19T09:05:18.290

Jro 的回答很好。但请务必更新 webconfig forms authentication `setting "domain"` ，否则 forms authentication signout 将无法正常工作。[这](https://stackoverflow.com/questions/30932064/currentprincipal-identity-isauthenticated-is-true-even-after-signout-when-formsa#)是我遇到的注销问题。这里的诀窍是有一个'。作为域的前缀为 cookie 设置为“.parent.com”（使用 cookie 检查器）。

```
<authentication mode="Forms">          
      <forms cookieless="UseCookies" defaultUrl="~/Default" loginUrl="~/user/signin" domain=".parent.com"  name="FormAuthentication" path="/"/>
    </authentication> 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-03T20:57:52.453

是的，当然。您可能需要在某些阶段自行推出，但这应该是可行的。

一个想法：当你将他们重定向到边界时，给他们一个一次性的通行证，然后告诉接收子域期待他们（这个用户，来自这个 IP，有这个令牌）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-10-03T03:07:39.683

要做的2件事：

1.  所有 web.config 中的 MachineKey 应该相同（主域和子域）
2.  AuthenticationCookie 域名应该相同。

请按照[以下](http://www.codeproject.com/Articles/27576/Single-Sign-on-in-ASP-NET-and-Other-Platforms)文章进行更深入的了解。

# javascript - IE 失败，从外部 javascript 调用函数时？

> ID：608133
> 
> 赞同：2
> 
> 时间：2009-03-03T20:53:53.413
> 
> 标签：javascript, internet-explorer

我有一段代码可以简化为：

```
var s='' ; 

s += "<"+"script type=\"text/javascript\" src=\"http://somehost.com/scripts/FooFunctions.js\">\n";
s += "<"+"/script>" ;
s += "<"+"script type=\"text/javascript\">\n";
s += "FooFunction(42, 'i love cats');\n";
s += "<"+"/script>" ;

document.write(s) ; 
```

在除 IE 之外的所有浏览器中，它都会按预期执行 - somehost.com/scripts/FooFunctions.js 中的函数按预期工作。

在 Internet Explorer 中，这会失败。

谷歌搜索这似乎很困难。我发现偶尔的帖子有同样的问题，但没有解决方案。

（有一个正当的理由需要以这种方式***从 javascript***中包含外部文件，并且 pgae 不能在其中`<script src="http://somehost.com/scripts/FooFunctions.js">`插入。）

需要明确的是，问题是：如何使上述代码在 Internet Explorer 中的功能与在 FireFox 中的功能相同？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T21:04:02.157

试试这个，它在IE中工作

```
 function addJsFile(jsFileLocation){
    var script=document.createElement('script');
    script.type='text/javascript'; 
    script.src=jsFileLocation; 
    document.getElementsByTagName("head")[0].appendChild(script);
}
addJsFile("http://code.jquery.com/jquery-latest.pack.js");
setTimeout(function(){alert(jQuery);},1000); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T22:14:38.010

看起来 IE`FooFunction`在加载脚本之前正在调用。您可以通过`setTimeout("FooFunction(42, 'i love cats')", 1000);`假设一秒钟足以加载脚本来测试这一点，此调用将成功。

如果你不能使用像 jQuery 这样的框架来加载脚本，它会在脚本加载时为你提供一个回调，你可以用 hack 自己的`setInterval`，检查`FooFunction`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T14:01:16.860

一旦 document.write 调用完成，它将运行第二个脚本标签中的函数。不管外部脚本是否已经加载。这不应该只是一个 IE 问题，而是应该影响所有浏览器。您确定它不会影响其他浏览器，因为它们缓存了外部脚本吗？当您清除缓存并在另一个浏览器中重试时会发生什么？

无论如何，在一个理想的世界里，你应该能够在脚本标签上使用 .onload 但我 99% 确定在 IE6 中 onload 没有触发脚本标签存在问题，所以我们需要在窗口上使用 onload而是元素。在下载所有脚本（包括上述外部 js 文件）之前，该事件不会触发。

# iphone - 在 Webview 中设置 iPhone 的 MoviePlayer 的方向

> ID：608136
> 
> 赞同：1
> 
> 时间：2009-03-03T20:54:48.047
> 
> 标签：iphone

有没有办法设置在 Webview 中打开的电影的方向？我可以通过应用程序以编程方式执行此操作，或者我可以将参数添加到 HTML 中加载的 Quicktime。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-14T16:51:57.603

我已经尝试了所有参数，但我认为方向是任意的。

工作原理：海报图像的尺寸决定了您的视频是以横向还是纵向模式打开的。因此，宽于高的海报图像将打开横向，高于宽的海报图像将以纵向模式打开电影。

例子：

对象宽度=“300”高度=“200”....：横向

对象宽度=“200”高度=“300”....：纵向

# reporting-services - 您如何对 SRSS 报告进行同行评审？

> ID：608137
> 
> 赞同：1
> 
> 时间：2009-03-03T20:54:51.820
> 
> 标签：reporting-services

我是代码同行评审的忠实拥护者，但是当涉及到报告时，似乎并不是审查它们的好方法。显示差异只会让您获得不太可读的 XML，打开报告并不会让您获得更多可见性。是否有任何应用程序可以使这更容易，或者大多数人只是在输出端查看报告？您如何对报告进行同行评审？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:42:20.907

我们倾向于将报告拆分为 SQL，由其他开发人员直接进行同行评审；和报告本身，我们有一个简短的最佳实践/风格指南清单，我们通常会自己核对。

我们尝试让用户尽早参与测试，尤其是在复杂的报告中，甚至到让他们坐在我们身边实际布置报告的地步——这节省了正式验收测试和重新开发的大量时间稍后的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T06:02:57.213

您不是在审查网页或应用程序背后的内部代码：您是在审查一种控制用户所见内容的标记语言

因此，我确保用户参与开发和测试。他们实际上是同龄人。

我觉得报告对用户来说是主观的（正确的词？），这是 IT 人员认为不同的一个领域。尤其是因为没有高超的技术、模式或方法......

# c# - 如何用C#实现视频直播？

> ID：608141
> 
> 赞同：6
> 
> 时间：2009-03-03T20:55:38.807
> 
> 标签：c#, silverlight, broadcasting

我想将实时视频广播设施插入网站。我打算使用 silverlight 和 C#，但我是这个主题的新手。

做这个的最好方式是什么？

提前致谢。

更新：

我有一个相机。我希望它捕获并显示在我的网站上。居住。但我不知道我必须在里面做什么。告诉我有关捕获、流、api、dll 的所有信息，以及我需要知道的任何其他信息。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T13:46:49.500

如果您使用的是 Windows，您可能需要考虑免费的 Windows Media Encoder 9 SDK ( [http://www.microsoft.com/windows/windowsmedia/forpros/encoder/features.aspx](http://www.microsoft.com/windows/windowsmedia/forpros/encoder/features.aspx) )。这个想法是，Windows Media Encoder 允许您将任何设备用作媒体源（例如，视频采集卡或支持流式传输的摄像机）并将其作为 ASF 流推出，甚至通过 Windows 多播/广播它媒体服务。

WME SDK 只是 WME 的一个编程 (COM) 接口。原则上，您可以自动化编码器并指示它使用您的相机作为源，并将其推送到指定的 UDP 端口或发布点（对于后者，您需要安装了 Windows Media Services 的 Windows Server 2003/2008）。

较新的替代方案是 Microsoft Expression Encoder SDK ( [http://www.microsoft.com/downloads/details.aspx?FamilyId=9A077A3D-58CE-454C-B486-153F0578BE4A&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=9A077A3D-58CE-454C-B486-153F0578BE4A&displaylang=en) )，它与 ​​Expression Encoder “对话”并允许您流式传输到 Silverlight 客户端（以及其他），但这里需要注意的是 EE 不是免费的（WME 是）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T21:55:09.057

你有直播吗？或者那是你需要的部分？如果您已经有一个带有 URI 的实时流，那么您可以使用 Silverlight 来显示它，因为您只需要一个播放器和一个 URI（您可以在任何地方获得一个播放器，这里有一个[http://sl2videoplayer.codeplex.com](http://sl2videoplayer.codeplex.com)）。

如果您没有流，那么您将需要一些机制来捕获视频并将其流式传输。您可以使用 Windows Media Server 进行流式传输。

你能澄清一下你有什么和你需要什么吗？

# javascript - 困惑——我的 XMLHttpRequest 的 readyState 为 0，状态为 200

> ID：608148
> 
> 赞同：3
> 
> 时间：2009-03-03T20:56:36.823
> 
> 标签：javascript, jquery, ajax, xmlhttprequest

我在 firebug 中设置了一个断点，并正在检查我的 xhr 对象。它的readyState为0，它的状态为200。我的理解是，如果状态为200，则请求至少应该已经开始，而readystate应该至少为1。谁能解释这是怎么回事？

我正在使用 jquery 的 $.ajax 来创建 xhr 对象，但我认为这不会影响 xhr 的就绪状态和状态。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-03T21:13:37.250

w3c将其[定义](http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060405/)`readyState`为 xmlhttprequest 进度的渐进式指示。它按从 0->4 的顺序转换（未初始化、打开、发送、接收、加载），并且只有在加载时才准备好读取内容。这是属性的重点，也是您监视`onreadystatechange`事件的原因，而不是作为响应标头的状态。

通过相同的规范`status`应该在不可用时引发异常（在接收或加载时），但我想这是为了易于使用而被实现所蔑视。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T21:02:53.923

当 readyState 为 4 时请求完成，而不是状态为 200 时。

# ajax - N2 CMS 评级用户控制

> ID：608149
> 
> 赞同：1
> 
> 时间：2009-03-03T20:56:39.273
> 
> 标签：ajax, rating, n2

我目前正在 N2 CMS 框架中构建一个站点。我想做的一件事是能够让用户使用相当标准的星级式用户控件或类似的东西对网站的各种元素进行评分。

有没有人特别在 N2 中实现了与此类似的东西？只是寻找一些关于在 N2 中实现这一目标的最佳方法的指示。

另外，不要认为它应该有所作为，但我目前正在 N2 中使用 ASP MVC 实现所有这些。

提前致谢

保罗

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T21:17:21.937

查看 BlogSvc 的[源代码](http://blogsvc.codeplex.com/SourceControl/changeset/view/31927#398218)（即将被称为 AtomServer）

源/WebCore/Plugins/Rater/RaterService.cs

这是一个片段：

```
public RaterModel Rate(Id entryId, float rating, User user, string ip)
{
  LogService.Info("RateEntry: {0}, {1}, {2}", entryId, rating, ip);

  if (!AuthorizeService.IsAuthorized(user, entryId, AuthAction.RateEntryOrMedia))
    throw new UserNotAuthorizedException(user.Name, AuthAction.RateEntryOrMedia.ToString());

  if (rating < 1 || rating > 5) throw new ArgumentOutOfRangeException("Rating value must be 1 thru 5.");

  AtomEntry entry = AtomEntryRepository.GetEntry(entryId);
  if (entry.Raters.Contains(ip)) throw new UserAlreadyRatedEntryException(ip, entry.Id.ToString());

  entry.RatingCount++;
  entry.RatingSum += (int)Math.Round(rating); //temporarily force int ratings
  entry.Edited = DateTimeOffset.UtcNow;
  List<string> raters = entry.Raters.ToList();
  raters.Add(ip);
  entry.Raters = raters;
  entry = AtomEntryRepository.UpdateEntry(entry);
  return new RaterModel()
  {
    PostHref = RouteService.RouteUrl("RaterRateEntry", entryId),
    Rating = entry.Rating,
    CanRate = false,
    RatingCount = entry.RatingCount
  };
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-13T15:42:15.297

这就是我在我的网站上用于对内容进行评级的内容 - 1 到 5 星

N2CMS - EditableEnum 非常适合这项工作

```
 [EditableEnum("RatingValue", 2, typeof(Rating))]
    public virtual string RatingValue
    {
        get { return (string)(GetDetail("RatingValue")); }
        set { SetDetail("RatingValue", value); }
    }

    /// <summary>
    /// Enum for the Vehicle Review Ratings
    /// </summary>
    public enum Rating
    {
        one = 1,
        two = 2,
        three = 3,
        four = 4,
        five = 5
    } 
```

# c# - 如何在没有加载项的情况下从 .NET 启动 MS Office Word？

> ID：608152
> 
> 赞同：6
> 
> 时间：2009-03-03T20:58:26.070
> 
> 标签：c#, ms-office

我正在使用 MS Office 2003 PIA 从 c# 创建一个 MS Word 文档。

```
ApplicationClass officeApplication = new ApplicationClass(); 
```

有什么方法可以指定我不希望使用此方法加载任何 Office 加载项？

编辑：

我知道可以通过命令行执行此操作，因此我很确定必须有一种方法可以从代码中执行此操作：

```
"C:\Program Files\Microsoft Office\Office11\Winword.exe" /a 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-03T21:11:53.510

此代码卸载加载项

```
officeApplication.AddIns.Unload(false); 
```

编辑：

当您需要混合进程启动和使用办公室“应用程序”界面的可能性时，您需要**Marshal.GetActiveObject**命令。
**例子 ：**

```
 //startup without plugins
        System.Diagnostics.Process.Start(
            @"Winword.exe",
            @"/a");
        //give a time for startup
        Thread.Sleep(2000);
        //attach to office
        Application officeApplication = (Application)Marshal.GetActiveObject("Word.Application"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T21:08:54.283

试试这个

```
System.Diagnostics.Process.Start(
  @"C:\Program Files\Microsoft Office\Office11\Winword.exe", 
  @"/a"); 
```

# wcf - 二进制引用 VS WCF 的优缺点

> ID：608160
> 
> 赞同：0
> 
> 时间：2009-03-03T21:01:51.943
> 
> 标签：wcf

我正在对现有 Web 应用程序 (A) 实施增强功能。新的解决方案将为应用程序 A 提供功能（图表/图像/数据）。新的增强功能将是一个新项目，并将生成新的程序集。我正在尝试确定阅读此信息的最优雅的方式。1）做一个二进制引用并直接读取数据。新程序集与您的应用程序一起使用并结合在一起 2) 编写 WCF 调用并获取数据。这将有助于解耦应用程序。

新申请将涉及我购买一些昂贵的许可证。因此，如果我选择第二个选项，我可以将许可费限制为单个服务器或最多 2-3 个。我当前的应用程序在 8 个服务器的网络农场下运行。

请分享两种方法的优缺点。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T02:19:06.177

如果将这两个部分充分分离，您还将允许使用运行 .NET 以外的其他东西的客户端。使用第一个选项，您只能支持 .NET 客户端。这可能很重要，即使今天您绝对确定只有 .NET 将被使用 - 明天，您的公司可能会被另一家 Java 或 PHP 商店收购。

即使您从不需要支持非 .NET 客户端，与程序集的耦合也将要求您保持客户端和服务器之间的版本兼容性。如果这不是必需的，则使用选项#2。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T07:16:15.540

使用 WCF（解耦方法）的好处是，如果它在处理或存储方面对机器的影响太大，您可以获得一个部署选项，将其带到机器之外。

缺点是与直接链接相比，您可能会付出一些性能损失。

我相信您可以进行一些动态链接，因此您不必部署到所有 8 台服务器。

# iphone - 在 UITabBarController 选项卡选择之前添加“正在加载”？

> ID：608162
> 
> 赞同：1
> 
> 时间：2009-03-03T21:01:57.437
> 
> 标签：iphone, cocoa-touch

我的 UITabBarController 的选项卡之一需要一些时间才能显示出来。

在视图控制器完成其工作之前显示“正在加载”的最佳方式是什么？

我尝试在选项卡的 viewController 的 viewDidLoad 方法中设置“正在加载”视图，然后我在 viewDidAppear 中完成工作，设置一个标志，以便下次通过 viewDidAppear 不再执行该工作。

但是，我从来没有看到“正在加载”视图......必须完成一些优化——在 TabBarControllerDelegate didSelectViewController 之前调用 viewcontroller 的 viewDidAppear。

是否存在允许在显示视图控制器之前显示占位符视图的 UITabBarController 机制？

有任何想法吗？

谢谢你-马特

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T21:07:18.873

我可能是错的，但也许您的问题是，通过在 viewDidAppear 中执行耗时的工作，您阻塞了主事件线程，因此视图在工作完成之前不会更新。即，您在 viewWillAppear 中设置了“正在加载”，但您从未看到它，因为当 viewDidAppear 完成时，它已经完成了繁重的工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T03:37:00.763

NSObject 的 performSelector:withObject:afterDelay: 方法在这里很有用。显示您的“请稍候”警报或视图或其他任何内容，然后使用 performSelector:withObject:afterDelay: 开始实际工作。您的加载将延迟到下一次执行事件循环之后，此时用户界面将被重绘。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T21:26:25.817

这里使用的技术是这样的：

1.  `viewWillAppear:`在您的控制器或 `viewDidLoad:`方法中放置一个“加载视图”
2.  然后，生成一个新线程来执行实际加载（或您正在执行的任何耗时过程）
3.  完成后，向控制器发送一条消息（例如，使用委托模式）“加载”已完成
4.  最后，移除 Loading 视图并让用户继续

这样做可以使您的应用程序界面仍然可用，即使特定的视图控制器很忙。

没有内置方法可以做到这一点，您必须自己编写代码。

# perl - 如何在角色中使用 MooseX::ClassAttribute？

> ID：608168
> 
> 赞同：4
> 
> 时间：2009-03-03T21:02:41.787
> 
> 标签：perl, moose

我想在角色中使用 [MooseX::ClassAttribute](http://search.cpan.org/dist/MooseX-ClassAttribute)。即，做类似的事情

```
package Cachable;

use Moose::Role;
use MooseX::ClassAttribute;

class_has Cache => ( is => 'rw' );

1; 
```

不幸的是，上面的代码不起作用，因为 MooseX::ClassAttribute 的深层魔法期望从 Moose 对象而不是 Moose::Role 中调用。
有没有办法解决这个问题，或者这是一个已知的限制？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T01:44:31.890

你给我发了一个补丁，使这个工作。这当然是可行的，尽管由于角色处理属性的方式，Moose 内部结构使它变得比它需要的更难。

# c# - 如何在 PDF 文件末尾生成索引？

> ID：608169
> 
> 赞同：1
> 
> 时间：2009-03-03T21:02:50.583
> 
> 标签：c#, pdf

给定一个现有的 PDF 文档，我想在文件末尾添加一个索引，以显示出现关键词的页面。如果我不必提供要查找的单词列表并且自动生成单词列表，那将是最好的。但是，如果必须给出单词列表，我可以使用它。我希望通过 C# 库或命令行工具来执行此操作。它需要作为另一个命令行应用程序的一部分运行。

有什么东西可以做到这一点吗？

这个“PDF Index Everthing”（[http://www.pdfstore.com/details.asp?ProdID=799](http://www.pdfstore.com/details.asp?ProdID=799)）似乎在正确的轨道上，但需要通过其 GUI 进行交互。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T07:19:49.650

*我实际上没有 c# 解决方案，但希望这仍然会有所帮助......*

**[pdflib](http://pdflib.com/)**是一个优秀的 pdf 开发库。它是可用的更好的库之一。据我所知，它没有 C# 绑定。PDF 是一种基于随机访问对象的文件格式，尽管有许多库允许创建 pdf，但大多数免费提供的库不支持向现有 pdf 添加页面。**pdflib**确实支持使用其 pdi 选项添加页面，因此可能值得一试。

**更新信息：**

签出 - [iText# 库](http://sourceforge.net/projects/itextsharp/)和

[将 pdf 文件与 C# 和 iText 合并](http://alex.buayacorp.com/merge-pdf-files-with-itext-and-net.html)

# html - 显示中的块级元素：inline-block

> ID：608172
> 
> 赞同：13
> 
> 时间：2009-03-03T21:03:08.477
> 
> 标签：html, css, cross-browser

我正在尝试将一些（垂直堆叠的） display:block 元素放在 display:inline-block 元素中。根据 CSS 规范，inline-block 元素应该是一个包含块，因此它可以在其中包含 display:block 元素，并且这些元素不应影响布局的其余部分。

但是， display:inline-block 元素中的 display:block 元素会破坏页面的其余部分；在内联块中什么都没有，甚至像段落这样的基本元素也是如此；只有简单的文本才能避免页面其余部分的中断（中断是指将其他 div 向下移动，例如在这种情况下，左侧的红色块向下移动一行并在其上方有一个空白区域）。我正在使用 Firefox 3.0.6。

```
<html><head><style type="text/css">
#left {
  display: inline-block;
  background: red;
  width: 20%;
  height: 100%;
}
#right {
  display: inline-block;
  background: green;
  width: 80%;
  height: 100%;
}
</style></head><body>
  <div id="left">Left</div><div id="right">Right</div>
</body></html> 
```

如预期的那样，上面显示为两个窗格，左红色，右绿色。如果我将“正确”更改为

```
<p>Right</p> 
```

或者完全删除它，或者（正如我想做的那样）用几个 div 替换它，我得到了错误的格式。

这是一个 Firefox 错误，还是我做错了什么，还是我的期望不正确？（FWIW，IE 7 平等地破坏它们，好像它不理解 inline-block；没关系，这是一个内部应用程序。我只使用 Firefox）。我也许可以使用浮动/边距获得我想要的布局，但我不想这样做。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-03T21:13:36.970

Well display: inline-block 跨浏览器可能有点棘手。它至少需要一些技巧，对于 Firefox 2，可能还需要一个额外的元素。

**CSS**

```
.inlineBlock { display: -moz-inline-stack; display: inline-block; zoom: 1; *display: inline; } 
```

*display: -moz-inline-stack*用于 Firefox 2。所有直接子级都需要具有*display: block*或其他块级元素。请注意，如果您需要 inline-block 元素来收缩包装，我认为您可以使用*display: -moz-inline-box*代替。

*zoom: 1*将 hasLayout 赋予元素（对于 IE 7 及更低版本）。IE7 及以下兼容性所需的 hack 的第 1 部分。

**display: inline* 是 IE7 及以下兼容性所需的 hack 的第二部分。

我偶尔需要添加 overflow: hidden 以实现 IE 兼容性。

对于您的具体情况，我认为您需要的是：

```
<html><head><style type="text/css">
#left {
  display: inline-block;
  background: red;
  width: 20%;
  height: 100%;
  vertical-align: top;
}
#right {
  display: inline-block;
  background: green;
  width: 80%;
  height: 100%;
  vertical-align: top;
}
</style></head><body>
  <div id="left">Left</div><div id="right"><p>Right</p><p>Right 2</p></div>
</body></html> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T21:59:49.013

> 我得到了错误的格式。

你被[margin collapsing](http://www.w3.org/TR/CSS21/box.html#collapsing-margins)所困扰，这是一种 CSS 的“聪明”，它既是一种痛苦，也是一种恩惠。<p> 的边距向外折叠成为内联块的顶部边距；然后，这就像“内联”元素上的边距一样，将文本行的垂直对齐推出。

您可以通过从“p”元素中删除边距并改用填充来阻止它的发生。或者在块的顶部放置一个没有上边距的非空元素，在底部放置一个没有下边距的元素。

> 这是一个 Firefox 错误吗

根据规范，我认为可能是的：

> 内联块元素的边距不会折叠（即使它们的流入子元素也不折叠）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-12-06T03:02:11.750

inline-block 此值使元素生成内联级块容器。内联块的内部被格式化为块框，元素本身被格式化为原子内联级框。 [视觉渲染模型](http://www.w3.org/TR/CSS2/visuren.html)

# .net - Session.Timeout 和 Server.ScriptTimeout 有什么区别？

> ID：608174
> 
> 赞同：2
> 
> 时间：2009-03-03T21:03:56.853
> 
> 标签：.net, asp.net, timeout

我们有一个 ASP.net Web 应用程序，其中有几个页面在页面加载时偶尔会超时（通常，这些都是管理类型的页面，它们会进行错误上传/下载并进行处理。）

解决方案之一是将 Session.Timeout 和 Server.ScriptTimeout 提高到非常大的数字 - 这很好。但是，这里有很多关于何时适用每种设置的讨论。说得委婉些，MSDN 页面可以解释。

谁能给我读者的摘要版本有什么区别，或者指向我们找不到的 MSDN 页面？

谢谢大家。

（II6 上的 .net 2.0，如果重要的话。）

作为一个额外的后续问题，在给定页面的 on_load() 函数中更改这些设置是否会更改整个应用程序或仅该页面的设置？

编辑：哎呀！我的意思是“Session.Timeout”而不是“Server.Timeout”。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-03T21:45:39.110

脚本超时控制代码可以运行多长时间来处理请求，因此您可以更改它以允许长时间运行的代码。IIS 管理器中的设置用于每个请求，Server.ScriptTimeout 属性用于当前请求，因此如果可能，您应该在代码中设置它，以便所有常规页面使用正常的脚本超时。

会话超时是用户最后一次发出请求后服务器上的会话对象存活的时间。IIS 管理器中的会话超时设置是创建的任何新会话的默认设置，您从代码访问的 Session.Timeout 属性是该特定会话的超时。默认会话超时为 20 分钟，您可以将其调高一点而不会带来太大风险，但您仍应将其保持在一个合理的值内，以免会话对象在内存中持续数天。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-03T21:31:57.020

ScriptTimeout 是 ASP.NET 运行时等待来自 ASPX 页结果的秒数。

Session.Timeout 是 ASP.NET 等待*你*的分钟数。

# c++ - 这个错误是什么意思：“错误：'type_name'之前的预期说明符限定符列表”？

> ID：608175
> 
> 赞同：51
> 
> 时间：2009-03-03T21:04:00.177
> 
> 标签：c++, c, pointers, struct

我一直在研究 Cell 处理器，我正在尝试创建一个包含 的结构，该结构将`spe_context_ptr_t`在线程中用于启动 spe 上下文，并且还将保存指向将传递给其他内容的指针来自线程内的 spu 上下文（目前我试图将其设为通用指针，但实际上它将是指向我已定义的另一个结构的指针）。当我尝试编译时，出现以下错误：

```
spu/../common.h:38: error: expected specifier-qualifier-list before 'spe_context_ptr_t'

// here is the offending line(s)

typedef struct _PTHREAD_BLOCK {
    spe_context_ptr_t * context; // Error happens here
    uintptr32_t  args; 
 } PTHREAD_BLOCK; 
```

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-03-03T21:07:06.080

编译器不知道 spe_context_ptr_t 是一种类型。编译此代码时，检查适当的 typedef 是否在范围内。您可能忘记包含适当的头文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-12-16T15:14:47.080

我有相同的错误消息，但解决方案不同。

编译器从上到下解析文件。

确保在将结构用于另一个结构之前定义它：

```
typedef struct
{
    char name[50];
    wheel_t wheels[4]; //wrong, wheel_t is not defined yet
} car_t;

typedef struct
{
    int weight;
} wheel_t; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-17T14:56:09.723

对于 iPhone 可可触控项目：

我遇到了这个问题，感谢 Eric Farraro 的评论，我得以解决。我在我的许多其他类中导入了一个类 WSHelper.h。但我也在我的 WSHelper.h 中导入了一些相同的类（如 Eric 所说的圆形）。所以，为了解决这个问题，我将导入从我的 WSHelper.h 文件移到了我的 WSHelper.m 文件中，因为它们在 .h 文件中并不是真正需要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-08T15:53:43.600

你必须这样命名你的结构：

```
typedef struct car_t {

   char

   wheel_t

} car_t; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-20T10:02:32.753

我通过导入循环得到了它：

```
---FILE B.h
#import "A.h"
@interface B{
  A *a;
}
@end

---FILE A.h
#import "B.h"
@interface A{      
}
@end 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-08-28T15:21:52.980

我能够使用 Gorgando 的修复解决这个问题，但我没有将导入移开，而是单独注释掉每个，构建应用程序，然后进行相应的编辑，直到我摆脱它们。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-09-14T06:53:20.060

当您在使用对象之前使用它时，基本上会出现此错误。

# flash - Flash 视频 - 创建虚拟视频剪辑

> ID：608182
> 
> 赞同：1
> 
> 时间：2009-03-03T21:05:27.443
> 
> 标签：flash, video

我需要在 Flash 中仅播放较大视频文件的一部分，我想知道这是否可以以动态方式进行。我们希望避免将较大的视频剪辑成较小的片段，这些片段将出现在网站的不同位置。

谢谢迈克尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T06:22:10.333

您可以使用[NetStream.seek()](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/net/NetStream.html#seek())并以秒为单位传递偏移量（即视频开始）。使用[NetStream类的](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/net/NetStream.html)*时间*属性来检索播放头位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T20:05:33.577

这取决于:) 如果您使用标准 http 传输并且只想播放较大剪辑的一部分，但不介意下载整个剪辑（或至少从剪辑开头到您想要的部分的部分播放），然后，正如其他答案所述，您可以使用 NetStream 或 fl.video.VideoPlayer 加载剪辑，寻找您要播放的部分的开头，然后调用 play()。

如果您使用 Flash Media Server 并使用 RTMP 进行流式传输，那么您应该能够从剪辑中的任何位置下载/播放。

切片方法也不错（尽管在转码端有更多工作）。值得一提的是，虽然我很犹豫，因为我并不是说这是推销——我在 Ooyala 的视频播放器团队工作。我们的 Flash 播放器允许您寻找/播放视频的任意部分（以 10-15 秒为粒度）。我们通过将视频分割成许多更小的块来做到这一点，然后播放器可以独立下载这些块。这种方法非常可行，但如果您想以任何规模进行，则需要转码基础设施来执行此操作。如果您认为这可能对您有意义，可能值得来与我们交谈。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T23:47:02.157

这可能有点粗糙，但是使用某些屏幕捕获程序（例如[Jing](http://www.jingproject.com/)甚至[Screen Toaster](http://www.screentoaster.com/)）可以满足您的需求。我想这取决于您正在寻找的质量和自动化程度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T23:52:01.457

对于一部分，我假设您的意思是时间部分（不是几何部分）；这可以通过使用提示点轻松完成。FLVPlayback 组件有足够的魔力来优雅地做到这一点。

# php - foreach 循环内的动态行和列

> ID：608195
> 
> 赞同：0
> 
> 时间：2009-03-03T21:09:04.673
> 
> 标签：php, simplepie

我正在尝试，但我坚持逻辑......所以，我有这个：

```
$max_items=10;

echo '<table>';
echo '<tr>';

foreach ($feed->get_items(0, $max_items) as $item): 

echo '<td>';
echo $some_value; 
echo '</td>';

endforeach; 

echo '</tr>';
echo '</table>'; 
```

我想显示这样的结果：

```
[1][2]
[3][4]
[5][6]
[7][8]
[9][10] 
```

我必须使用while语句？一个for循环？在 foreach 代码内部还是外部？

我真的不明白...

感谢您的任何帮助

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T21:22:48.027

看看这个[在非 WordPress 页面上显示最近的帖子的](http://w-shadow.com/blog/2008/11/15/displaying-recent-posts-on-a-non-wordpress-page)链接。我认为您可能正在寻找一种循环对象获取方法的方法。为此，您将需要一个嵌套循环和某种反射。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T21:24:14.527

我最近刚刚在[Cogenuity](http://simplepie.org/)的 2 月版本中与[SimplePie 合作](http://www.dynamicalsoftware.com/cogenuity)，所以这在我的脑海中仍然很新鲜。

*   您的`$some_value`变量永远不会被初始化。
*   $item 对象将具有这样的方法`get_permalink(), get_title(), get_description()`，和`get_date()`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T21:24:51.373

这是一个*非常简单*的示例，说明如何进行这种 HTML 构建。

```
<?php

$data = range( 'a', 'z' );
$numCols = 2;

echo "<table>\n";
echo "\t<tr>\n";

foreach( $data as $i => $item )
{
    if ( $i != 0 && $i++ % $numCols == 0 )
    {
        echo "\t</tr>\n\t<tr>\n";
    }
    echo "\t\t<td>$item</td>\n";
}

echo "\t</tr>\n";
echo '</table>'; 
```

这样，您可以将 $numCols 更改为 3 或 4（或任何数字）并始终在输出中看到该列数，并且*无需*使用嵌套循环即可。

# sql - 为什么我应该将我的 SQL 关键字大写？

> ID：608196
> 
> 赞同：134
> 
> 时间：2009-03-03T21:09:17.900
> 
> 标签：sql, formatting, readability

> **可能重复：**
> [是否有充分的理由为 T-SQL 关键字使用大写？](https://stackoverflow.com/questions/292026/is-there-a-good-reason-to-use-upper-case-for-t-sql-keywords)

简单的问题。我个人发现一串小写字符比一串大写字符更具可读性。一些旧的/流行的 SQL 是否区分大小写？

以供参考：

```
select
    this.Column1,
    case when this.Column2 is null then 0 else this.Column2 end
from dbo.SomeTable this
    inner join dbo.AnotherTable another on this.id = another.id
where
    this.Price > 100 
```

对比

```
SELECT
    this.Column1,
    CASE WHEN this.Column2 IS NULL THEN 0 ELSE this.Column2 END
FROM dbo.SomeTable this
    INNER JOIN dbo.AnotherTable another ON this.id = another.id
WHERE
    this.Price > 100 
```

前者对我来说似乎更具可读性，但我更经常看到后者。

* * *

## 回答 #1

> 赞同：195
> 
> 时间：2009-03-03T21:15:09.150

我同意你的看法——对我来说，大写只是在喊。

我让我的 IDE 通过语法高亮处理使关键字脱颖而出。

我不知道它的历史原因，但现在它只是一种主观偏好。

**编辑以进一步阐明我的推理：**

你会用任何其他现代语言大写你的关键字吗？编造的例子：

```
USING (EditForm form = NEW EditForm()) {
    IF (form.ShowDialog() == DialogResult.OK) {
       IF ( form.EditedThing == null ) {
          THROW NEW Exception("No thing!");
       }
       RETURN form.EditedThing;
    } ELSE {
       RETURN null;
    }
} 
```

啊!

无论如何，从投票中可以清楚地看出哪种风格更受欢迎，但我想我们都同意这只是个人喜好。

* * *

## 回答 #2

> 赞同：127
> 
> 时间：2009-03-03T21:11:12.780

我认为后者更具可读性。您可以轻松地将关键字与表名和列名等分开。

* * *

## 回答 #3

> 赞同：77
> 
> 时间：2011-07-30T00:06:43.340

我要补充一件事，我还没有看到有人提出：

如果您在编程语言中使用 ad hoc SQL，您将在字符串中包含大量 SQL。例如：

```
insertStatement = "INSERT INTO Customers (FirstName, LastName) VALUES ('Jane','Smith')" 
```

在这种情况下，语法着色可能不起作用，因此大写可能有助于提高可读性。

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2010-07-19T09:37:39.510

来自 Joe Celko 的“SQL 编程风格”（ISBN 978-0120887972）：

> 规则：
> 
> 大写保留字。
> 
> 理由：
> 
> 大写单词被视为一个单元，而不是被视为一系列音节或字母。眼睛被他们吸引，他们采取行动宣布声明或条款。这就是标题和警告标志起作用的原因。
> 
> 排版师使用术语*bouma*来表示单词的形状。该术语出现在 Paul Saenger 的书中（1975 年）。想象一张长方形卡片上的每个字母正好适合它，这样你就可以看到上升字母、下降字母和基线字母是各种“乐高积木”，它们拼在一起组成一个单词。
> 
> 大写单词的*bouma始终是一个简单的、密集的矩形，并且很容易从小写单词的字段中挑选出来。*

我觉得引人注目的是，这是唯一一本关于 SQL 启发式的书，由一位著名的 SQL 作品作者撰写。那么这是绝对真理吗？谁知道。这听起来很合理，我至少可以向团队成员指出规则并告诉他们遵守它（如果他们想责怪任何人，我会给他们 Celko 的电子邮件地址 :)

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2009-03-04T03:33:02.627

代码具有 SQL 语句所缺少的标点符号。有圆点、括号和分号来帮助你把事情分开。代码也有行。尽管您可以在多条物理行上编写 SQL 语句，但它是一条语句，一条“代码行”。

如果我要编写没有任何正常标点符号的英文文本，如果我将新子句的开头大写，这可能会更容易，这样它会更容易分辨一个结束和下一个开始的地方，否则这么长的一段文本可能会非常难以阅读 不是 id 建议它现在很容易阅读，但我认为至少你可以遵循它

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2009-03-03T21:13:35.940

主要是传统。为了便于阅读，我们喜欢将关键字和我们的命名空间名称分开，并且由于在许多 DBMS 中表和列名称是区分大小写的，我们不能将它们大写，所以我们将关键字大写。

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2009-03-03T21:29:42.157

我更喜欢小写关键字。Management Studio 对关键字进行颜色编码，因此将它们与标识符区分开来没有问题。

大写关键字感觉如此......好吧......基本......;）

-“八十年代的 BASIC、COBOL 和 FORTRAN 打电话，他们想要他们的大写关键字回来。” ;)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2011-02-24T10:55:59.310

更糟糕的是，由于我办公室的大多数开发人员都相信 sql 关键字的大写字母，所以我不得不改成大写字母。多数规则。

我相信小写更容易阅读，并且无论如何 sql 关键字都以蓝色突出显示。

在辉煌的日子里，关键字是大写的，因为我们是在绿屏上开发的！

问题是：如果我们不把c#关键字写成大写，那为什么我必须把sql关键字写成大写呢？

就像别人说的那样——首都在喊！

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-03-04T02:57:52.087

我喜欢在 SQL 关键字上使用大写字母。我想我的思绪会跳过它们，因为它们真的很笨拙，而是专注于重要的事情。当您像这样布局时，块状单词会分割重要的部分：

```
SELECT
  s.name,
  m.eyes,
  m.foo
FROM
  muppets m,
  muppet_shows ms,
  shows s
WHERE
  m.name = 'Gonzo' AND
  m.muppetId = ms.muppetId AND
  ms.showId = s.showId 
```

（缺少 ANSI 连接是另一个问题的问题。）

有一项心理学研究表明，由于单词的轮廓更加独特，小写字母比大写字母更容易阅读。但是，这种效果可能会随着大量阅读大写字母的练习而消失。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-04T06:29:56.227

早在 80 年代，我习惯将数据库名称大写，并将 sql 关键字保留为小写。大多数作者的做法正好相反，将 SQL 关键字大写。最终，我开始跟着人群走。

顺便提一下，在大多数已发布的 C、C++ 或 Java 代码片段中，语言关键字总是小写，一些解析器甚至可能无法识别大写关键字。我看不出在 SQL 中使用与您在编程语言中使用的相反约定的充分理由，即使 SQL 嵌入在源代码中也是如此。

而且我并不是在为数据库名称使用全部大写进行辩护。它实际上看起来有点像“喊”。还有更好的约定，比如在数据库名称中使用几个大写字母。（我所说的“数据库名称”是指模式的名称、表等模式对象以及其他一些东西。）仅仅因为我在 80 年代这样做并不意味着我今天必须捍卫它。

最后，“De gustibus non disputandum est”。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-03T21:14:05.753

这只是可读性的问题。帮助您快速区分 SQL 关键字。

顺便说一句，这个问题已经回答了： [SQL 语法是否区分大小写？](https://stackoverflow.com/questions/153944/is-sql-syntax-case-sensitive)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-03-03T21:14:23.553

我更喜欢对 SQL 中的关键字使用大写字母。

是的，小写字母更具可读性，但对我来说，在大多数情况下必须花额外的时间来扫描查询对你有好处。一旦它完成并经过测试，你应该很少再看到它（DAL、存储过程或任何会隐藏它的东西）。

如果您是第一次阅读它，大写的 WHERE AND JOIN 会像他们应该的那样直接跳到您身上。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-03-04T03:22:59.437

它只是一个可读性的问题。对 SQL 关键字使用 UPPERCASE 有助于使脚本更易于理解。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-07-30T00:25:34.663

我将 SQL 大写以使其与宿主语言（现在主要是 C#）更加“对比”。

这只是一个偏好和/或传统的问题，真的......

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-03T21:33:15.393

可能没什么，但我更喜欢在[small caps](http://en.wikipedia.org/wiki/Small_caps)`SQL`中排版关键字。这样一来，它们对大多数读者来说看起来都是大写的，但它们与丑陋的 ALL CAPS 风格不同。

另一个优点是我可以保留代码原样并以传统样式打印。（我使用`listings`包中`LaTeX`的漂亮打印代码。）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-02-24T11:27:03.907

这里的一些 SQL 开发人员喜欢这样布局：

```
SELECT s.name, m.eyes, m.foo
FROM muppets m, muppet_shows ms, shows s 
WHERE m.name = 'Gonzo' AND m.muppetId = ms.muppetId AND ms.showId = s.showId 
```

他们声称这与我自己使用的每行一个字段的方法不同，更容易阅读。

# sql - 如何完全删除身份

> ID：608198
> 
> 赞同：3
> 
> 时间：2009-03-03T21:09:35.670
> 
> 标签：sql, sql-server, tsql, sql-server-2008

我目前正在对我们的数据模型进行一些更改，其中包括更改列（恰好是主键的一部分），使其不再是身份。有没有办法在实际删除和重新创建整个列或表的情况下做到这一点？SSMS 自动生成的代码就是这样做的，但我想知道是否有更简单的解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-03T21:43:57.037

您不能删除列的 Identity 属性而不删除它。

可能的解决步骤是：

(a) 添加新列

(b) 使用标识列值更新列

(c) 删除标识列。

```
Alter Table Tablename Add newColumnname int

Update Table set newColumnname =IdentityColumn

Alter Table TableName Drop IdentityColumnName 
```

注意：如果您正在谈论暂时关闭身份属性，请检查 Set IDENTITY_INSERT TableName ON Command

有道理？

干杯，约翰

# c++ - 从向量返回底层数组

> ID：608206
> 
> 赞同：3
> 
> 时间：2009-03-03T21:12:00.500
> 
> 标签：c++, stl

数组是否会被释放，如果是，有什么解决方法？

```
double * GetArrayFromVector( std::map<std::string, double> m, char ** names, int count )
{ 
    if(!names) return 0;

    std::vector<double> vec(m.size());
    for (int i=0; i<count; ++i)
    { 
       if(!names[i]) return 0;
       std::map<std::string, double>::iterator iter=m.find(name[i]);
       if(iter!=m.end())
          vec.push_back(iter->second);
       else
         return 0;   
    }

    return &vec[0]; 
} 
```

非常感谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-03T21:18:50.110

是的 - 一旦你从函数返回，它就会被释放，因为`vec`它是在堆栈上声明的。`std::vector`析构函数负责释放内存。由于您要返回已释放数组的地址，因此您将开始处理已释放的内存，这是一个很大的禁忌。充其量，你会立即崩溃。在最坏的情况下，你会悄悄地通过一个巨大的安全漏洞取得成功。

有两种方法可以解决这个问题：（1）按值返回整个向量，这会复制整个向量，或者（2）通过引用参数返回向量。

解决方案1：

```
std::vector<double> GetArrayFromVector(...)
{
    ...
    return vec;  // make copy of entire vec, probably not a good idea
} 
```

解决方案2：

```
void GetArrayFromVector(..., std::vector<double> & vec)
{
    // compute result, store it in vec
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-03T21:22:48.353

将您的功能分为两部分。让你的函数只做一个动作：
1\. 从地图中填充矢量。
2\. 从向量创建数组。
不要忘记通过 const 引用传递 map。

主要说明：GetArrayFromVector 的调用者负责内存释放。

```
void FillVector( const std::map<std::string, double>& m, 
                  std::vector< double >& v, 
                  char ** names, 
                  int count )
 {
       .......
 }

 double* createArray( const std::vector< double >& v )
 {
     double* result = new double [v.size()];

     memcpy( result, &v.front(), v.size() * sizeof( double ) );

     return result; 
 }  

 // and finally your function

 double* GetArrayFromVector( const std::map<std::string, double>& m,  
                             char ** names, 
                             int count )
 {
      std::vector< double > v;
      FillVector( m, v, names, count );

      return CreateArray( v );
 } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-03T21:16:45.857

是的，数组将被释放。

将函数更改为：

```
double * GetArrayFromVector( std::map<std::string, double> m, vector<double> &vec, char ** names, int count )
{ 
     vec.clear();
     vec.reserve(m.size());

     for (int i=0; i<count; ++i)
     { 
         if(!names[i]) return 0;

         std::map<std::string, double>::iterator iter=m.find(name[i]);
         if(iter!=m.end())
            vec.push_back(iter->second);
         else
           return 0;   
     }

    return &vec[0]; 
} 
```

或者使用[`boost::shared_array`](http://www.boost.org/doc/libs/1_36_0/libs/smart_ptr/shared_array.htm)（也，看[`boost::scoped_array`](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/scoped_array.htm)）

```
boost::shared_array<double> GetArrayFromVector( std::map<std::string, double> m, char ** names, int count )
{ 
     boost::shared_array<double> vec(new double[m.size()]);

     for (int i=0; i<count; ++i)
     { 
         if(!names[i]) return boost::shared_array<double>();

         std::map<std::string, double>::iterator iter=m.find(name[i]);
         if(iter!=m.end())
            vec[i] = iter->second;
         else
           return boost::shared_array<double>();   
     }

    return vec; 
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-03T21:19:36.287

`vec`是一个局部变量。它的范围仅限于`GetArrayFromVector()`功能。永远不要返回局部变量的地址。按值返回数组：

```
std::vector<double> GetArrayFromVector( std::map<std::string, double> m,
                         char ** names, int count ) 
```

或者，将向量的引用作为输出参数传递：

```
void GetArrayFromVector( std::map<std::string, double> m,
                         char ** names, int count, 
                         std::vector<double>& vec) 
```

或者，传递一个输出迭代器：

```
void GetArrayFromVector( std::map<std::string, double> m,
                         char ** names, int count, 
                         std::vector<double>::iterator vecIter) 
```

最后两个将需要对函数定义和调用进行一些仔细的实现。

此外，如果您想玩更多冒险游戏，请尝试以下操作：

```
// you'd need to change the value to use when an element is not
// found in the map to something that suits your needs
double pred(std::map<char*, double> haystick, char* const needle) {
    std::map<char*, double>::iterator i = haystick.find(needle);
    return i != haystick.end() ? i->second : 0; 
}

int main(int argc, char* argv[])
{

   std::map<char *, double> m;
   std::vector<char *> names;
   std::vector<double> dv;

   m[ "Sasha" ] = 729.0;
   m[ "josh" ] = 8154.0;

   names.push_back("Sasha");
   names.push_back("JonSkeet");
   names.push_back("josh");

   // transform is part of STL's <algorithm> header
   // it takes a container (actually a range -- [begin(), end()) 
   //                  note it is a half-open range -----------^
   // as is customary for all STL algorithms, applies the function
   // or functor specified as the last parameter to each element of
   // the sequence and writes the result back to another container
   // specified via the output iterator -- the third argument
   //
   // since I have not reserved enough elements for the vector dv
   // i cannot blindly use it -- i need a back_inserter to coax
   // transform to push_back() instead of do an insert operation
   // of course, for vectors, this is costly since reallocations 
   // may happen, but let's leave the performance aside for a while!
   //
   // ok, so what about the last parameter, you ask? it has to be an
   // unary_operation. well, mostly so. but what is it that we want?
   // we want to take an iterator from the original char* (string) 
   // array and see if there's an entry in the map. if there is one
   // we retrieve the associated double value and put it in dv; else,
   // we set a default value of 0 -- change it to whatever pleases you
   // maybe a std::numeric_limit<double> if it works for you.
   // 
   // you can create a functor inheriting std::unary_function and pass
   // it on. that's the easy way out. but what if you already have a
   // comparator, a C-style find() function? will it work? yes, it will.
   // but we have to wrap it using the function adaptor std::ptr_fun
   // to make the compiler happy (after all it wants a unary_function, right?)
   // 
   // this simple scheme of things works very well, save for a last little
   // glitch. the comparator actually takes two parameters -- a what to search
   // and a where to search. and guess what -- the where to search is always 
   // fixed. so that gives us a good oppertunity to fix the first parameter to
   // our map<char*, double> which is exactly what std::bind1st() does. 
   // surprisingly, now that you've fixed one function, you no longer have a
   // binary function (one taking two arguments) but an unary one -- which is
   // just what you'd pass to transform. voila!
   std::transform(names.begin(), names.end(), std::back_inserter(dv), 
       std::bind1st(std::ptr_fun(pred), m));

   std::copy(dv.begin(), dv.end(), 
       std::ostream_iterator<double>(std::cout, "\n"));

    return 0;
} 
```

一些有趣的链接：

*   [`transform`](http://www.sgi.com/tech/stl/transform.html)【其实有两种口味】
*   `bind1st`或者[`binder1st`](http://www.sgi.com/tech/stl/binder1st.html)[还有一个`binder2nd`！]
*   [`back_inserter`](http://www.sgi.com/tech/stl/back_inserter.html)
*   [`ptr_fun`](http://www.sgi.com/tech/stl/ptr_fun.html)[也请查看`mem_fun`]
*   [`unary_function`](http://www.sgi.com/tech/stl/UnaryFunction.html)[还有`binary_function`]

另请查看 Boost。他们做了一些魔术`bind()`！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T21:17:37.007

您可以通过引用或新建/删除它来传递它，但正如发布的那样，您的向量将在函数返回后被破坏。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-03T21:18:28.957

是的，当函数结束时，向量（及其保存的数据存储）将被释放。

为什么要创建矢量？如果你想要一个数组，只需创建并填充其中一个..

```
double * GetArrayFromVector( std::map<std::string, double> m, char * names[], int count )
{ 
    if(!names) return 0;

    double* vec = new double[m.size()];
    int j = 0;
    for (int i=0; i<count; ++i)
    { 
       if(!names[i]) return 0;
       std::map<std::string, double>::iterator iter=m.find(name[i]);
       if(iter!=m.end())
          vec[j++] =iter->second;
       else
         return 0;   
    }

    return vec;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-03T21:19:24.977

是的，当函数退出时（并且“vec”变量超出范围），向量将被释放。因此，您返回的指针将无效。

另一种方法是在堆上分配数组（使用“new”运算符）并返回该指针，但调用者有责任“删除”指针，这通常是不受欢迎的。

更好的选择是将[shared_ptr](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/shared_ptr.htm)返回到您的数组。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-03T21:21:18.980

由于您事先知道`count`，因此使用 stl 向量没有任何好处。你可以简单地这样做：

```
double* GetArrayFromVector(std::map<char*, double> m, char** names, int count)
{
    double* result = new double[count];
    for (int i = 0; i < count; ++i)
    { 
        if(!names[i])
        {
            delete[] result;
            return 0;
        }
        map<std::string, double>::iterator iter = m.find(name[i]);
        if(iter != m.end())
        {
            result[i] = iter->second;
        }
        else
        {
            delete[] result;
            return 0;
        }
    }
    return result;
} 
```

请注意，您将分配数组的所有权传递给调用者。[就个人而言，我会尝试以遵循RAII 原则](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)的方式编写代码；要么传入要填充的向量，要么使用托管/共享指针等（其他答案中已经建议了这两个选项）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-04T03:43:35.397

有一个称为[移动构造函数](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fen.wikibooks.org%2Fwiki%2FMore_C%252B%252B_Idioms%2FMove_Constructor&ei=XvatSeLAK4TFnQe0k43ABg&usg=AFQjCNHgzN2EZBwGE9BSyDMAB4LG5FPLJA&sig2=OVe34nh3DJWWNpupi0Yokg)的概念，它允许您将（基于堆栈的）对象持有的资源的所有权转移到新对象。我听说 STLport 有一个 move_source 模板来完成这个

这将出现在[C++0x](http://en.wikipedia.org/wiki/C%2B%2B0x#Rvalue_reference_and_move_semantics)中。

在这种情况下，您将返回`std::vector<double>`而不是`double*`.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T11:33:25.220

您可以使用 std::auto_ptr 智能指针（但将矢量引用传递给您的函数是更好的解决方案）。

std::auto_ptr 示例：

```
 std::auto_ptr< std::vector<int> > getArray(int& count){  
       std::auto_ptr< std::vector<int> > vec(new std::vector<int>());  
          vec->push_back(10);  
          vec->push_back(12);  
          vec->push_back(14);  
          vec->push_back(16);  

          count = vec->size();  
          return vec;  
       }  

    int main(){  
       int size = 0;  
       std::auto_ptr< std::vector<int> > autoPtrVec = getArray(size);  
       int* ptr = &(*autoPtrVec)[0];  

       std::cout << "Size: " << size << std::endl;  
       for(int i=0; i<size; i++){  
          std::cout << "[" << i << "]=" << ptr[i] <<     std::endl;  
        }  

       return 0;  
    } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-04T12:37:43.100

有点惊讶没有人提到[vector::swap](http://www.cplusplus.com/reference/stl/vector/swap.html)。让调用者传入对向量的引用，该向量的内容将被函数替换：

```
void GetArrayFromVector( std::vector<double>& output, ... )
{ 
    std::vector<double> vec(m.size());

    // construct vec here...

    output.swap(vec); 
} 
```

顺便说一句：“GetArrayFromVector”，你传入一张地图？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-05-19T20:12:13.337

C++ 向量有一个`data()` [方法](http://www.cplusplus.com/reference/vector/vector/data/)可以返回一个指向底层数组的指针。

```
// vector::data
#include <iostream>
#include <vector>

int main ()
{
  std::vector<int> myvector (5);

  int* p = myvector.data();

  *p = 10;
  ++p;
  *p = 20;
  p[2] = 100;

  std::cout << "myvector contains:";
  for (unsigned i=0; i<myvector.size(); ++i)
    std::cout << ' ' << myvector[i];
  std::cout << '\n';

  return 0;
} 
```

哪个输出

```
myvector contains: 10 20 0 100 0 
```

# javascript - iphone web page transitions

> ID：608214
> 
> 赞同：3
> 
> 时间：2009-03-03T21:14:27.607
> 
> 标签：javascript, iphone

I am developing a web page for iPhones and iPod Touch's. I am using the Universal iPhone UI framework. I need to have silding page transitions, but can't seem to get it working. Is there a good javascript framework I could use that would make this easier? I've done a lot of normal web dev with jquery, but it doesn't seem to like the iPhone.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T21:19:09.547

Try [http://code.google.com/p/iui/](http://code.google.com/p/iui/)

It's a nice little JS framework, among other things, that will help you with the transition aspect. Have a flick through the documentation too, as it'll give you quite a few additional options as well.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T21:32:04.460

Regardless of what framework you're using, the WebKit CSS trasitions are extensions of CSS and were developed with the iPhone and iPhone web-based apps in mind. You can do some very clever, complex animations with no JavaScript and only a few lines of CSS.

Here's [what Google finds](http://www.google.com/search?client=safari&rls=en-us&q=webkit+css+transitions&ie=UTF-8&oe=UTF-8) on the subject.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-04-12T07:49:47.703

Try the following frameworks.

*   [Jo](http://joapp.com/)
*   [Sencha Touch](http://www.sencha.com/products/touch/)
*   [jQuery Mobile](http://jquerymobile.com/)

These are for serving Web based mobile sites, they can then in turn be made into Apps for Android or iOS using [PhoneGap](http://www.phonegap.com/)

Of the 3, Sencha is the more mature project and has the most things out of the box. Jo looks very promising and would probably directly compete with Sencha. jQuery mobile is very interesting but just far to early to do any production code with it, too rough around the edges. jQuery mobile takes a different approach to the others as it is html based and it interperates the attributes on tags to turn things into tableviews or menus.

jQuery mobile is quicker to hack together and get your head around, where the other two take a little bit more thinking. But once you figure them out its easy enough.

If you don't want to serve the site via a url at all and want to just build an app then [Appcelerator](http://www.appcelerator.com/) is the way to go. You write code in JS and it makes native Android or iOS apps for you. You will get access to pretty much the full Android/iOS api.

I have coded with appcelerator, however I am no longer going to use it and use one of the above frameworks, probably Sencha for just now. I can get access to the device native apis via PhoneGap and for simpler apps give a great experience cross device via a url.

[Reference](https://stackoverflow.com/a/3968492/3857636)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-03T22:20:21.973

Apple's [Dashcode IDE](http://developer.apple.com/tools/dashcode/) has an extensive set of page transition templates for the iPhone. You should be able to fire up a quick project, get the look you want, then export the resulting HTML/CSS/Javascript into your favorite IDE.

The only catch is that it's OSX only.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-13T23:49:31.360

I've been deep into an iPhone web app project lately. We evaluated iUI, but decided against it for various reasons. Consequently, I've developed most of the same functionality from scratch. While I can't share the code from the actual product (as I'm under NDA), I have been documenting many of the techniques I've used to do certain things. Check out the links below:

*   [http://segdeha.com/e/css-transitions/](http://segdeha.com/e/css-transitions/)
*   [http://segdeha.com/blog/2009/07/19/stupid-webkit-tricks](http://segdeha.com/blog/2009/07/19/stupid-webkit-tricks)

# .net - .NET 中的 GetComputerObjectName 类比来获取自己的 ID？

> ID：608216
> 
> 赞同：0
> 
> 时间：2009-03-03T21:14:55.580
> 
> 标签：.net, active-directory

我曾经调用 GetComputerObjectName(NameUniqueId, ...) 来获取本地机器的 Active Directory ID。尝试在 .NET 中获得相同的功能，它是否存在，或者 p-invoke 是实现此目标的最佳方式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T21:27:57.903

System.Environment.MachineName?

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T21:46:38.047

不得不P-Invoke...

```
 [DllImport("secur32.dll", SetLastError = true, CharSet = CharSet.Auto)]
    static extern bool GetComputerObjectName(int nameFormat, StringBuilder lpNameBuffer, ref int lpnSize);

    public static string GetComputerObjectName()
    {
        const int NameUniqueId = 6;
        var lpBuffer = new StringBuilder(260);
        var bufferLength = lpBuffer.Capacity;

        if (!GetComputerObjectName(NameUniqueId, lpBuffer, ref bufferLength))
        {
            throw new Win32Exception(Marshal.GetLastWin32Error());
        }

        return lpBuffer.ToString();
    } 
```

# user-controls - 具有数据类型属性问题的自定义控件

> ID：608221
> 
> 赞同：0
> 
> 时间：2009-03-03T21:15:39.073
> 
> 标签：user-controls, c#-3.0, properties, types, numeric

我正在构建一个自定义用户控件。属性之一必须允许最终用户选择数字数据类型，例如 int、short、long、double....

我在弄清楚将什么用作内部属性类型时遇到问题，因此当用户在属性框中选择 DataType 选项时，它将为他们提供所有数字类型的下拉列表。

我尝试了一些变化......下面的这个，编译时将 DataType 属性显示为灰色。它不允许我选择或输入值。

```
 private System.ValueType _DataType;
   public System.ValueType DataType
   {

       get { return _DataType; }
       set
       {

           _DataType = value;
       }
   } 
```

任何帮助表示赞赏。谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T21:33:36.017

属性编辑器不知道如何编辑类型。修复它的最简单方法是使用它知道如何编辑的类型，例如字符串或枚举。Enum 可能最适合您要完成的工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T13:51:16.837

我最终使用了一个枚举 - 我认为他们应该是比这更好的答案。在设计器中设计数据集时会发现相同的功能。当您选择数据类型时，您可以选择 int 和其他。

# html - 锚标签的“名称”属性是否已过时？

> ID：608222
> 
> 赞同：13
> 
> 时间：2009-03-03T21:15:47.027
> 
> 标签：html, visual-studio, tags, xhtml

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-03T21:19:34.320

您应该改用该`id`属性。工作方式相同，您不需要人工`<a name=...>`，只需

```
<h2 id="one">Section One</h2> 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-03T21:18:52.807

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-03T21:18:56.007

我相信现代方法是使用`id`属性，它将被评估为锚。例如，如果您更改了

```
<h2><a name="one">Section One</a></h2> 
```

到

```
<h2><a id="one">Section One</a></h2> 
```

您仍然可以将其称为`page.html#one`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-03T21:22:27.183

您还可以链接部分标题：

# 目录

```
<P>
    <A href="#section1">Introduction</A><BR>
    <A href="#section2">Some background</A><BR>
    <A href="#section2.1">On a more personal note</A><BR>
    ...the rest of the table of contents...
    ...the document body...

    <H2 id="section1">Introduction</H2>
    ...section 1...

    <H2 id="section2">Some background</H2>
    ...section 2...

    <H3 id="section2.1">On a more personal note</H3>
    ...section 2.1...

[...]
</P> 
```

资料来源：[http ://www.w3.org/TR/REC-html40/struct/links.html](http://www.w3.org/TR/REC-html40/struct/links.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-03T21:18:37.317

我相信正确的方法是 <a id="one">

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-03T21:21:24.893

是的，它已经过时了。您应该替换为“id”属性。

引用 w3schools 页面：

> " *id 属性替换了 name 属性 HTML 4.01 为元素 a、applet、frame、iframe、img 和 map 定义了 name 属性。在 XHTML 中，不推荐使用 name 属性。改用 id。* "

[http://www.w3schools.com/Xhtml/xhtml_syntax.asp](http://www.w3schools.com/Xhtml/xhtml_syntax.asp)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-03T21:27:03.227

name= 属性用于标记表单中的元素，并且只能用于 <form> 元素（输入、文本区域、选择等）。对于其他所有内容，使用 ID=。究竟为什么 W3C 人员认为需要两种不同的元素命名方式（具有不同的允许字符集），目前尚不清楚。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-09-24T12:43:43.410

但是在这里[http://www.w3.org/TR/html4/struct/links.html#h-12.2.3](http://www.w3.org/TR/html4/struct/links.html#h-12.2.3)我读到这个：“一些旧的用户代理不支持使用 id 属性创建的锚点。” 所以？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-21T16:59:22.517

直到`<a name="..."></a>`不再支持您正在使用的 (X)HTML 标准——而不仅仅是弃用——在链接到同一页面的一部分的锚点上同时使用`name`和使用可能是最安全的。`id`来自[W3C 的 XHTML 1 规范](http://www.w3.org/TR/xhtml1/#C_8)：

> 在 XML 中，以形式的片段标识符结尾的URI 引用[RFC2396](http://www.w3.org/TR/xhtml1/#ref-rfc2396)`"#foo"`不引用具有属性的元素`name="foo"`；相反，它们指的是具有定义为 ID 类型的属性的元素，例如`id`HTML 4 中的属性。许多现有的 HTML 客户端不支持以这种方式使用 ID 类型的属性，因此可以为这两个属性以确保最大的向前和向后兼容性（例如，`<a id="foo" name="foo">...</a>)`.

# c# - 货币，日历更改为所选语言，但asp.net中没有标签？

> ID：608226
> 
> 赞同：1
> 
> 时间：2009-03-03T21:16:52.580
> 
> 标签：c#, asp.net, globalization

我有一个带有日历的网页，一个保存货币值的标签和一个打招呼的标签。当我从下拉列表中选择一种语言时，它会更改货币标签、日历，但 hello 不会更改。这是 aspx 页面和 cs 文件的精简代码：

ASPX：

```
<asp:Label ID="lblLanguageSelection" runat="server" 
           Text="Select a language: "></asp:Label>
    <asp:DropDownList ID="ddlLanguages" runat="server" AutoPostBack="true">
    <asp:ListItem Value="auto">Auto</asp:ListItem>
    <asp:ListItem Value="en-US">English (US)</asp:ListItem>
    <asp:ListItem Value="en-GB">English (GB)</asp:ListItem>
    <asp:ListItem Value="de">German</asp:ListItem>
    <asp:ListItem Value="fr">French</asp:ListItem>
    <asp:ListItem Value="fr-CA">French (Canada)</asp:ListItem>
    <asp:ListItem Value="hi">Hindi</asp:ListItem>
    <asp:ListItem Value="th">Thai</asp:ListItem>
    </asp:DropDownList>
    <br /><br />
    <asp:Calendar ID="Calendar1" runat="server"></asp:Calendar>
    <br /><br />
    <asp:Label ID="lblCurrency" runat="server"></asp:Label>
    <br /><br />
    <asp:Label ID="lblHello" runat="server"></asp:Label> 
```

CS：

```
protected void Page_Load(object sender, EventArgs e)
{
    decimal currency = 65542.43M;
    string hello = "Hello";

    lblCurrency.Text = string.Format("{0:c}", currency);
    lblHello.Text = string.Format("{0}",hello);
}

protected override void InitializeCulture()
{
    string language = Request["ddlLanguages"];

    if (language != null)
    {
        Thread.CurrentThread.CurrentUICulture = new CultureInfo(language);
        Thread.CurrentThread.CurrentCulture = 
                             CultureInfo.CreateSpecificCulture(language);  
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T21:27:51.977

呃……你到底希望发生什么？货币和日期具有基于区域设置的内置格式。你想让 ASP.NET 为你做语言翻译？！？对不起，你在那个方面不走运。:) 我错过了你的意图吗？

一些进一步的建议......避免这样的代码：

```
string language = Request["ddlLanguages"]; 
```

这不好...这仅作为 Request 对象功能的副作用，并且一旦您将此代码放入命名容器（例如内容页面）中就会迅速中断。改为这样做：

```
string language = ddlLanguages.SelectedValue; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T12:22:28.517

如果您希望标签本地化，您需要考虑使用本地化的资源文件来处理字符串（这是整个“不使用字符串文字”最佳实践的来源。

您需要手动翻译您希望本地化的文本，并将这些字符串编译成特定语言的资源文件，然后可以通过[System.Resources中](http://msdn.microsoft.com/en-us/library/system.resources.aspx)[ResourceManager](http://msdn.microsoft.com/en-us/library/system.resources.resourcemanager.aspx)对象的[GetString](http://msdn.microsoft.com/en-us/library/system.resources.resourcemanager.getstring.aspx)方法访问该文件。

```
// Create a resource manager to retrieve resources.
ResourceManager rm = new ResourceManager("items", 
        Assembly.GetExecutingAssembly());

// Retrieve the value of the string resource named "hello".
// The resource manager will retrieve the value of the  
// localized resource using the caller's current culture setting.
String hello = rm.GetString("hello");
lblHello.Text = hello; 
```

# c++ - VC++ 6.0 向量访问冲突崩溃。已知错误？

> ID：608228
> 
> 赞同：1
> 
> 时间：2009-03-03T21:17:11.923
> 
> 标签：c++, visual-c++-6

我正在尝试使用 std::vector<>::const_iterator 并且出现“访问冲突”崩溃。看起来 std::vector 代码在使用自己的内部`First_`和`Last_`指针时崩溃了。大概这是一个已知的错误。我希望有人可以指出我正确的解决方法。从外部库调用崩溃函数可能相关吗？

```
const Thing const*  AClass::findThing (const std::string& label) const
{
    //ThingList_.begin() blows up at run time.  Compiles fine.
    for (std::vector<Thing*>::const_iterator it = ThingList_.begin(); it != ThingList_.end(); ++it) {
        //Irrelevant.
    }
    return 0;
} 
```

简单地调用`ThingList_.size()`也会崩溃。

这是 sp6，如果重要的话。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-03T21:20:12.010

如果跨外部库边界传递 C++ 对象，则必须确保所有库都使用相同的运行时库（特别是相同的堆分配器）。实际上，这意味着所有库都必须链接到 MSVCRT 的 DLL 版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T21:20:31.103

这几乎可以肯定是您的代码中的错误，而不是 std::vector。这个代码被太多的项目使用了，以至于没有这么容易重现的错误。

可能发生的情况是 ThnigList_ 变量已以某种方式损坏。是否直接访问和/或修改了底层数组？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T21:30:56.897

我同意 Jared 的观点，它可能在你的代码中，而且永远不会少，你应该确保你的 stl 库是最新的。

dinkumware[站点](http://www.dinkumware.com/vc_fixes.html)有你需要的补丁文件。

为了安全起见，您应该更新

# html - 加快 HTML 表单开发

> ID：608236
> 
> 赞同：4
> 
> 时间：2009-03-03T21:18:45.633
> 
> 标签：html, forms, ide, wufoo

我必须构建一个包含大量表单的 Web 应用程序。有没有人喜欢的工具来加速这个开发？这并不复杂，但手写它们会花费我很多时间......

我过去使用过[wufoo](http://wufoo.com)并且喜欢界面，所以没有任何其他建议我可能会接受

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T21:25:00.953

与 Wufoo 类似的工具是[Form Assembly](http://www3.formassembly.com/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T21:40:53.207

我正在开发基于[JSON 的表单生成器](http://jameslab.moveable.com/JSONForm/)，但它还处于早期阶段。没有所见即所得，而是一个易于遵循的数据结构。

# regex - 替换网址

> ID：608240
> 
> 赞同：1
> 
> 时间：2009-03-03T21:19:06.473
> 
> 标签：regex, url, text

我有一个巨大的 txt 文件和 Editpad Pro 的 url 列表，根文件夹上有图像。

```
http://www.othersite.com/image01.jpg
http://www.mysite.com/image01.jpg
http://www.mysite.com/category/image01.jpg 
```

如何使用正则表达式仅更改在根目录上有图像的那些？

```
http://www.othersite.com/image01.jpg
http://www.NEW_WEBSITE.com/image01.jpg
http://www.mysite.com/category/image01.jpg 
```

我正在使用[RegExr 在线应用程序](http://gskinner.com/RegExr/)。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T21:25:16.897

**搜索和替换**（不区分大小写，正则表达式）：

```
http://www\.mysite\.com/([^/]*\.(?:jpg|gif|png)) 
```

和：

```
http://www\.NEW_WEBSITE\.com/\1 
```

* * *

**编辑**

`http://www.mysite.com/.jpg`是的，如果存在任何此类文件或目录，这还将重新建立文件，例如。如果有人不喜欢这个，那么只需替换`*`为`+`-- 或者`{X,}`如果您的假设恰好是*图像文件至少需要一个 X 字符名称 s*等等 -- 但**实际上**，这可能完全超出了`lab72`试图实现什么（即**不是**图像文件名验证。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T21:32:37.563

```
url1.replace(/((https?:\/\/www.?)(\w*?)(.com\/image\d*?\.(png|gif|jpg))/, 
             "$1newName$3"); 
```

像上面这样的东西应该可以工作。代码在 AS 中（虽然 :P 未编译）请注意 $2 与我们替换为的站点名称匹配`yoursite`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T21:29:56.167

代替

```
http://www\.mysite\.com/image(.*) 
```

和

```
http://www.newsite.com/image$1 
```

话虽如此，您可能还对一个体面的[文本编辑器](https://stackoverflow.com/questions/34215/what-are-the-best-alternatives-to-notepad)感兴趣。那个Flash小程序真的很恶心。您仍然可以使用相同的正则表达式，尽管您必须`$`用反斜杠替换美元符号`\`。

# perl - 为什么我在比较 Perl 中输入的行时遇到问题？

> ID：608254
> 
> 赞同：2
> 
> 时间：2009-03-03T21:21:54.627
> 
> 标签：perl, validation, user-input

我不知道这个简单的交易可能做错了什么，但它不起作用：

```
print "OK? (y or n)\n";
$ans = <>;
print "\n";
if($ans eq "y"){print $ans;} 
```

我基本上想知道如何测试用户输入。这一点代码对我不起作用。我只是想打印用户`$ans`输入`y`的内容。

有什么建议么？

编辑： - 我也尝试过单引号

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-03T21:28:51.847

你做错了几件事。

(1) 在需要 <STDIN> 时不要使用菱形运算符 (<>)。菱形运算符还将从 @ARGV 读取文件，您可能不想要这些文件。

(2) $ans 永远不会等于“y”，除非你先把它剁碎。最后会有一个换行符。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T03:21:43.123

神秘内容变量的万灵药：

```
use Data::Dumper;
$Data::Dumper::Useqq = 1; # show newlines, tabs, etc in visible form
$Data::Dumper::Terse = 1;
print '$ans is really: ', Dumper($ans); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T01:09:09.290

尽管您的直接问题已得到解答，但您可能希望查看诸如[Term::Readline 之类的替代方案](http://search.cpan.org/dist/Term-Readline)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-03T21:27:00.713

你有没有尝试过：

```
if($ans eq 'y'){print $ans;} 
```

?

# c++ - 如何在 OSX 上的 Carbon 文本字段中设置文本？

> ID：608255
> 
> 赞同：0
> 
> 时间：2009-03-03T21:22:13.097
> 
> 标签：c++, macos, macos-carbon

我正在尝试使用 Carbon API 设置文本字段的文本，如下所示：

```
ControlID editId = {'EDIT', 3};
ControlRef ctrl;
GetControlByID(GetWindowRef(), &editId, &ctrl);
CFStringRef title = CFSTR("Test");      
OSErr er = SetControlData(ctrl, kControlEntireControl, kControlEditTextTextTag, CFStringGetLength(title), title);
CFRelease(title); 
```

我使用的是 XCode 的 C++ 代码模板，因此 GetWindowRef() 是对预定义 TWindow 类的调用。OSErr 返回值给了我 noErr，但我的文本字段只包含垃圾。我是否将文本字段的属性设置为 Unicode 并不重要。

任何想法这里有什么问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T21:59:09.933

`GetControlID`(...) 返回什么？是`noErr`吗？

由于 a`ControlRef`也是 a `HIViewRef`，您还可以使用以下功能：

`HIViewSetText`设置文本。这被记录为与接受的函数一起使用`kControlEditTextCFStringTag`。

顺便说一句，你写的那行：

```
CFRelease(title); 
```

会引起问题。应该只发布使用 API 名称中包含 Create 或 Copy 的函数制作的对象。您需要阅读：“Core Foundation 内存管理编程指南简介”——在 Xcode 文档中搜索。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T22:08:28.213

最后这成功了：

```
SetControlData(ctrl, kControlEditTextPart, kControlStaticTextCFStringTag, sizeof(title), &title); 
```

由于这似乎是非常旧的 API，更好的方法似乎是：

```
HIViewSetText(ctrl, title); 
```

感谢 Lyndsey 的提示。

# html - 如果不推荐使用名称属性，如何专门选择单选按钮？

> ID：608264
> 
> 赞同：1
> 
> 时间：2009-03-03T21:23:33.157
> 
> 标签：html

我了解到该`name`属性已被弃用。但这就是我在表单上执行单选按钮的独占选择的方式。我现在如何在不使用 JavaScript 的情况下做到这一点？

```
<input type="radio" name="gender" value="male">Male</input>
<input type="radio" name="gender" value="female">Female</input> 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-03T21:31:12.280

撤销您认为 name 属性已被弃用的信念。

[在 a、applet、frame、iframe、img 和 map 上不推荐使用名称，但在 input 上不推荐使用名称](http://www.w3.org/TR/xhtml1/#h-4.10)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T21:40:53.240

据我所知，该`name`属性一般不会被弃用，仅适用于某些元素，[即`a, applet, form, frame, iframe, img,`and`map`](http://www.w3.org/TR/xhtml1/#h-4.10)。对于那些，您应该改用该`id`属性。对于输入元素，使用`name`仍然是正确的。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-03T21:31:39.440

我只是使用 jQuery 并为同一组中的所有单选元素提供一些类。这样我就可以使用 $("input.classname") 选择元素。

# apache-flex - flex 预加载器不能在 url 中使用 # （深度链接）

> ID：608269
> 
> 赞同：1
> 
> 时间：2009-03-03T21:24:14.963
> 
> 标签：apache-flex, actionscript, flash, swfaddress

***当我的页面的 url 中有#***时，我无法让 flash 预加载器工作（即使没有任何深度链接库或逻辑）。我正在使用 flex 3.3。Flash 插件 9 和 10，所有浏览器。

url 中有一个关于***#***的错误，阻止预加载器工作： [http ://bugs.adobe.com/jira/browse/SDK-14162](http://bugs.adobe.com/jira/browse/SDK-14162)

然而，不知何故，某个地方的某个人有办法解决这个问题。以下是一些可行的示例*（请记住清除缓存以确保您看到预加载器很棒）*：

*   [http://www.adobecards.com/index.html#wtf](http://www.adobecards.com/index.html#wtf)
*   [http://www.escriba.es/base_en.html#wtf](http://www.escriba.es/base_en.html#wtf)
*   [http://www.sonypictures.com/movies/onceuponatimeinmexico/site/mexico.html#wtf](http://www.sonypictures.com/movies/onceuponatimeinmexico/site/mexico.html#wtf)
*   [http://instinct.ru/flash.html#wtf](http://instinct.ru/flash.html#wtf)
*   [http://www.alternativedesign.tv/plant5.html#wtf](http://www.alternativedesign.tv/plant5.html#wtf)

但是，这些不起作用（根本没有预加载器或暂时卡在 100% 上）：

*   [http://www.flashmagazine.com/articlefiles/preloader_finished.html#wtf](http://www.flashmagazine.com/articlefiles/preloader_finished.html#wtf)
*   [http://www.mariaclaudiacortes.com/colors/Colors.html#wtf](http://www.mariaclaudiacortes.com/colors/Colors.html#wtf)
*   [http://whoswestudios.com/flashsite.html#wtf](http://whoswestudios.com/flashsite.html#wtf)
*   [http://www.iotashan.com/examples/NotSoCustomPreloader/index.html#wtf](http://www.iotashan.com/examples/NotSoCustomPreloader/index.html#wtf)

那么，这里发生了什么？我怀疑 flex 框架。

有人知道在哪里查看弹性代码吗？还是这个错误比除了 adobe 可以修复的任何人都更深？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T19:03:27.133

这里发生的事情很少。

(1) 看起来我的#wtf 示例中最快的预加载器来自 Adob​​e。他们加载一个非常小的 container.swf，然后加载他们的 3mb 主 swf（以及其他大件）。

(2) 其他一些“预加载器”并不是真正的预加载器。他们的开场动画在整个加载时播放。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T00:46:58.103

我相信您遇到的问题是您将资产加载到与预加载器资产和代码相同的框架中。Flash 在完全加载之前不会显示帧，导致在加载期间看不到您的预加载器，然后在之后被新资源覆盖。

作为一个 flex 开发者，你没有时间线，所以这就是为什么使用你称之为的小型“容器”或作为加载器电影很重要的原因。这部电影将有一个很小的脚印，以便尽快可用。加载完成后，容器可以调用主电影，使用 ProgressEvent 跟踪传入的数据。

从你所说的很难确切地知道问题是什么，但这是一个普遍的问题。字体和任何其他嵌入项目要么需要嵌入到第 2 帧或更高版本，我相信您只能使用 flash IDE 来完成，或者您需要额外的加载器 swf，轻量级且加载速度快！

我已经成功地将以下内容与预加载器
[http://www.madagascargame.com](http://www.madagascargame.com)
[http://www.kungfupandagame.com](http://www.kungfupandagame.com)

# oracle - 如何在没有自定义类型或游标的情况下从 Oracle 函数返回表？

> ID：608271
> 
> 赞同：3
> 
> 时间：2009-03-03T21:24:22.017
> 
> 标签：oracle, function, types, cursor

我正在寻找从 Oracle 函数返回结果表。使用游标是最简单的，但我必须将其用于的应用程序不会接受游标作为返回值。另一种方法是创建一个类型（可能包装在一个包中）来配合这个函数。但是，创建几种类型（我有 4 个以上的函数要编写）似乎有点多余，以便我可以返回表结果。有没有我想念的替代方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T21:37:47.897

**更新：**请参阅没有大小限制的 TABLE 解决方案的第一条评论。

返回**VARRAY**或使用**PIPELINED**函数从它们中查询。

*   对于**VARRAY**，请参阅[本文](http://www.oracle.com/technology/sample_code/tech/java/codesnippet/jdbc/varray/index.html)了解详细信息。那里的代码示例：

    ```
    CREATE OR REPLACE TYPE EMPARRAY is VARRAY(20) OF VARCHAR2(30)
    /

    CREATE OR REPLACE FUNCTION getEmpArray RETURN EMPARRAY
    AS
      l_data EmpArray := EmpArray();
      CURSOR c_emp IS SELECT ename FROM EMP;
    BEGIN
      FOR emp_rec IN c_emp LOOP
        l_data.extend;
        l_data(l_data.count) := emp_rec.ename;
      END LOOP;
    RETURN l_data; 
    ```

    结尾;

*   对于**PiPELINED**功能，请[在此处查看](http://www.oracle.com/technology/sample_code/tech/pl_sql/htdocs/x/Table_Functions_Cursor_Expressions/Pipelined_Table_Functions.htm)。代码示例：

    ```
    create or replace function Lookups_Fn return lookups_tab
      pipelined
    is
      v_row lookup_row;
    begin
      for j in 1..10
      loop
        v_row :=
          case j
            when 1 then lookup_row ( 1, 'one' )
            --...
            when 7 then lookup_row ( 7, 'seven' )
            else        lookup_row ( j, 'other' )
          end;
        pipe row ( v_row );
      end loop;
      return;
    end Lookups_Fn;
    /

    select * from table ( Lookups_Fn ); 
    ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T19:59:43.213

如果适合应用程序开发人员，您总是可以从您的函数返回 XML。

在 Oracle 中可以通过多种方式生成 XML，具体取决于您安装的内容和使用的版本。

XMLTYPE 在某些上下文中非常有用，可以使用 XMLElement、XMLAttributes、XMLAgg 等内置函数从 SQL 生成。如果客户端不支持 XMLTYPE，它可以很容易地转换为 CLOB 值。

也许最简单但不是最好的 (IMO) 选项是使用 dbms_xmlgen 包：

```
SQL> set serveroutput on size 1000;
SQL> exec dbms_output.put_line( dbms_xmlgen.getXML( 'select * from dual' ) ); 
```

输出：

```
<?xml version="1.0"?>
<ROWSET>
 <ROW>
  <DUMMY>X</DUMMY>
 </ROW>
</ROWSET> 
```

这为您提供了单个 CLOB 值的“表”结果。

# c# - 在 HtmlAgility HtmlDocument 中查找匹配原始 Html 的节点

> ID：608274
> 
> 赞同：0
> 
> 时间：2009-03-03T21:24:53.653
> 
> 标签：c#, html-agility-pack

我目前有一个程序，可以根据查找具有匹配 id 的标签来查找和编辑 HTML 文件。

我想扩展它以找到一个匹配 InnerHtml 的标签（忽略大小写和空格）

使用 Html Agility 执行此操作的好方法是什么？我想使用 Html Agility 来完成它，因为程序的其余部分正在使用它。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T21:34:17.793

在这里粗略地拍摄它，但你应该能够做这样的事情：

```
 HtmlNodeCollection nodes = doc.DocumentNode.SelectNodes("YOUR_TAG_SELECTOR");

            if (nodes != null)
            {
                foreach (HtmlNode node in nodes)
                {
                    if (node.InnerHtml.ToLower().Trim() == "YOUR_MATCH")
                    {
                        //success routine
                        break;
                    }
                }
            } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T21:44:23.357

我们已经使用正则表达式完成了这项工作。像这样的东西对我们有用：

```
private static List<HtmlNode> GetMatchingNodes(string xPath, string pattern, HtmlDocument htmlDocument)
{
    List<HtmlNode> matchingNodes = new List<HtmlNode>();
    foreach (HtmlNode node in htmlDocument.DocumentNode.SelectNodes(xPath))
    {
        if (Regex.IsMatch(node.InnerHtml, pattern))
        {
            matchingNodes.Add(node);
        }
    }
    return matchingNodes;
} 
```

希望这可以帮助。:)

# ruby - 如何在红宝石中做 TOS/DSCP？

> ID：608286
> 
> 赞同：1
> 
> 时间：2009-03-03T21:27:11.027
> 
> 标签：ruby, tcp, udp, stream, qos

如何在 UDP/TCP 流上设置 Ruby 中的[TOS 标志](http://en.wikipedia.org/wiki/Type_of_Service)/ [DSCP 标志](https://www.rfc-editor.org/rfc/rfc2474)（最好使用 Ruby/Sockets 库）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T18:59:04.820

[您可以使用Socket.setsockopt](http://www.ruby-doc.org/stdlib-1.9.3/libdoc/socket/rdoc/BasicSocket.html#method-i-setsockopt)`IPPROTO_IP`作为级别、`IP_TOS`选项名称和您想要的值传递来设置 TOS 标志：

```
require 'socket'
s = TCPSocket.new('example.com', 80)
s.setsockopt(Socket::IPPROTO_IP, Socket::IP_TOS, YOUR_TOS_VAL) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T21:37:02.437

试试 Socket#setsockoption()。它记录在镐书的附录 A 中，或者您可以浏览源代码以获取接口详细信息。

——马库斯

# hibernate - Hibernate HQL：两级连接

> ID：608287
> 
> 赞同：0
> 
> 时间：2009-03-03T21:27:18.607
> 
> 标签：hibernate, grails, hql

我是 HQL 的新手，并且有以下表格关系：

*   `Term`有很多`Definitions`
*   `Definition`有很多`DefinitionProducts`
*   `DefinitionProducts`有一个`Product`

我想获取`Terms`至少有一个`Definition`至少有一个`DefinitionProduct`具有特定的列表`Product`

这是我最好的尝试（在 Grails 中）：

```
Term.findAll("from Term t, Definition d inner join t.definitions def,  
def.definitionProducts dp where ? = some elements (dp.product)",
Product.get(1)) 
```

有了上面，我得到一个“def.definitionProducts is not mapped”异常。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T19:53:11.103

***select t*** from Term t join t.definitions def join def.definitionProducts dp where dp.product=?

# php - 重定向到另一个页面

> ID：608291
> 
> 赞同：1
> 
> 时间：2009-03-03T21:28:20.447
> 
> 标签：php, javascript

< type="button" value="PRINT" onClick="window.open('print.php?id=&sec=&subj=&type=viewrec2&Year=&faci= ','mywindow','width=800,height=800,左=0,上=100,screenX=0,screenY=100')">

当我单击此按钮时，我被重定向到一个新窗口。问题是，在此按钮所在的主页上，我希望它也将其重定向到同一个窗口上的上一页，我如何使用 php 和 javascript 做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-03T21:30:46.040

```
<input type="button" value="PRINT" onClick="window.open('print.php?id=&sec=&subj=&type=viewrec2&Year=&faci= ','mywindow','width=800,height=800,left=0,top=100,screenX=0,screenY=100');history.back()"> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T21:31:55.490

只需添加

```
history.go(-1); 
```

将代码更改为：

```
<input type="button" value="PRINT" onClick="window.open('print.php?id=&sec=&subj=&type=viewrec2&Year=&faci= ','mywindow','width=800,height=800,left=0,top=100,screenX=0,screenY=100');history.go(-1)"> 
```

# url - Example.com 替代方案

> ID：608293
> 
> 赞同：7
> 
> 时间：2009-03-03T21:29:05.937
> 
> 标签：url, documentation, dns

假设您想在某处的文档中提供示例 url。正确的做法是 use `example.com`，因为这是此类事物的定义位置，您想出的任何其他内容都可能实际注册在某​​个地方，并为您的读者提供知道什么的人。

我的问题是，如果你需要提供 2 个对比鲜明的例子，你会怎么做？我见过的最好的是 site1.example.com 和 site2.example.com，但这并不总是能做到这一点。还有其他想法吗？

**更新：**
接受@Yuval 的回答，因为它是技术上最正确的回答。然而，由于我无法控制的力量，我实际上选择了 Jekke's (tempuri.com)。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-03T21:30:59.550

使用**example.net**和**example.org**。

根据[RFC 2606](http://www.rfc-editor.org/rfc/rfc2606.txt)，它们都是保留的（[维基百科摘要](http://en.wikipedia.org/wiki/Example.com)）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T11:47:08.907

RFC 2606 还保留了 TLD（顶级域）“.example”，因此您可以使用“foobar.example”、“something.example”、“stackoverflow.example”等。

不幸的是，所有这些名称都包含字符串“example”，因此在文档中无法区分。我希望有一天会有 RFC 2606 的更新，有更多的名字。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-02-15T20:21:01.630

如前所述[`example.com`](https://www.icann.org/en/about/agreements/registries/com/appendix-06-01dec12-en.htm)，[`example.net`](https://www.icann.org/en/tlds/agreements/net/appendix-6-01jul11-en.htm)和[`example.org`](https://www.icann.org/en/about/agreements/registries/org/org-appx-06-html-22aug13-en.htm)由 IETF 正式保留用于文档目的。此外，ICANN 还保留了`example.edu`.

一些 ccTLD 和较新的 gTLD`example`保留了等效的域。很可能，ICANN 管理的所有 gTLD 对保留名称都有相同的限制。在下面，我列出了一些我能够确认为保留的内容。

在某些情况下，我需要一个长度超过 8 个字符的示例域名（不包括 TLD 本身），它是否无效并不重要——我只是希望它*无法*解析。`example_domain.com`因此，在这些情况下（例如或`your_domain.com`），在域名中使用下划线是一种可接受的解决方案。

另一个替代 TLD，虽然不是官方保留的，但将是`.tld`(!)。我查看了 ICANN 的新 gTLD 当前申请状态列表，`.tld`但没有出现。因此，任何域都可以在此 TLD 下使用（例如`example.tld`或`yourdomain.tld`）。但是，我建议谨慎使用它，因为它当前未分配的事实并不意味着没有人会申请它。作为旁注，请注意亚马逊欧盟和查尔斯顿道路登记处都已申请`.dev`.

保留的通用`example`TLD（不包括最新扩展）：

*   [`example.aero`](https://www.icann.org/en/about/agreements/registries/aero/aero-appendix-6-11jun09-en.htm)
*   [`example.asia`](https://www.icann.org/en/about/agreements/registries/asia/appendix-6-29feb12-en.htm)
*   [`example.biz`](https://www.icann.org/en/about/agreements/registries/biz/biz-appx-06-html-22aug13-en.htm)
*   [`example.cat`](https://www.icann.org/en/about/agreements/registries/cat/cat-appendix6-22mar06-en.htm)
*   [`example.coop`](https://www.icann.org/en/about/agreements/registries/coop/appendix-6-11nov08-en.htm)
*   [`example.info`](https://www.icann.org/en/about/agreements/registries/info/info-appx-06-html-22aug13-en.htm)
*   [`example.jobs`](https://www.icann.org/en/about/agreements/registries/jobs/appendix-6-05may05-en.htm)
*   [`example.mobi`](https://www.icann.org/en/about/agreements/registries/mobi/mobi-appendix6-14nov08-en.htm)
*   [`example.museum`](https://www.icann.org/en/about/agreements/registries/museum/appendix-06-03nov07-en.htm)
*   [`example.name`](https://www.icann.org/en/about/agreements/registries/name/appendix-06-01dec12-en.htm)
*   [`example.post`](https://www.icann.org/en/about/agreements/registries/post/post-appendix-6-11dec09-en.htm)
*   [`example.pro`](https://www.icann.org/en/about/agreements/registries/pro/pro-appendix-6-22apr10-en.htm)
*   [`example.tel`](https://www.icann.org/en/about/agreements/registries/tel/appendix-6-02feb11-en.htm)
*   [`example.travel`](https://www.icann.org/en/about/agreements/registries/travel/travel-appendix-6-23aug10-en.htm)
*   [`example.xxx`](https://www.icann.org/en/about/agreements/registries/xxx/appendix-6-31mar11-en.htm)

保留的国家代码`example`TLD（不是完整列表）：

*   `example.ae`（.aeDA 保留的域）
*   `example.at`（由 NIC.AT GmbH 注册。管理员：NIC.AT 角色）
*   `example.bg`（注册状态：禁止）
*   `example.ca`（限制：不可注册）
*   `example.co`（域在限制和保留名称列表中）
*   `example.hk`（域名目前无法注册）
*   `example.jp`（保留）
    包括`co.jp` `ne.jp` `or.jp`子域
*   `example.la`（禁止）
*   `example.nl`（由 Stichting Internet Domeinregistratie Nederland 注册）
*   `example.pt`（禁止注册。第 9 条第 1 点）
    包括`com.pt` `net.pt` `org.pt` `edu.pt` `int.pt` `nome.pt` `publ.pt`子域
*   `example.se`（注册被阻止。示例和测试域。）
*   `example.su`（停止列表：无法注册域。）
*   `example.sx`（不可用）

参考：

*   [维基百科-example.com](http://en.wikipedia.org/wiki/Example.com)
*   [RFC 2606](https://www.rfc-editor.org/rfc/rfc2606)
*   [RFC 608](https://www.rfc-editor.org/rfc/rfc608)
*   ICANN[注册管理机构协议](https://www.icann.org/en/about/agreements/registries)：对于每个 TLD，查找标题为*“保留 TLD 字符串列表”*或*“保留名称附表*”的文档。
*   [新 gTLD 当前申请状态](https://gtldresult.icann.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T21:30:14.577

您也可以使用 tempuri.org，就像在许多基于 XML 的示例中使用的一样。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T21:32:00.810

还有`example.net`和`example.org`。如果您需要另一个，我认为使用您已经控制的域没有问题。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-03T21:31:46.770

我想知道您是否可以在 URL 中挤入一些字符，如果剪切并粘贴到浏览器中会使其无效。有点像电影中的 555-XXXX 数字。

# silverlight - Silverlight Video - 播放虚拟视频剪辑

> ID：608304
> 
> 赞同：1
> 
> 时间：2009-03-03T21:31:25.633
> 
> 标签：silverlight, video

我需要在 Silverlight 中只播放较大视频文件的一部分，我想知道这是否可以以动态方式进行。我们希望避免将较大的视频剪辑成较小的片段，这些片段将出现在网站的不同位置。

谢谢迈克尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T21:56:39.583

理论上你可以是的，你可以让 MediaElement 开始一个特定的位置，然后监视播放并在媒体到达另一个位置时停止它。通过在媒体中提供标记并只监听标记事件，然后根据需要启动/停止，您可以更容易地做到这一点（比监控时间）。

# jruby - 在 JRuby 中使用整洁

> ID：608306
> 
> 赞同：2
> 
> 时间：2009-03-03T21:31:39.690
> 
> 标签：jruby

在使用 Ruby 调试器几个小时后，我终于了解到我需要清理一些格式错误的 HTML 页面，然后才能将它们提供给 Hpricot。到目前为止，我发现的最佳解决方案是[Tidy Ruby 界面](http://tidy.rubyforge.org/)。

[Tidy](http://tidy.sourceforge.net/)在命令行中运行良好，Ruby 界面也运行良好。但是，它需要[dl/import](http://www.jbrowse.com/text/rdl_en.html)，但无法在 JRuby 中加载：

```
$ jirb
irb(main):001:0> require 'rubygems'
=> true
irb(main):002:0> require 'tidy'
LoadError: no such file to load -- dl/import 
```

这个库可用于 JRuby 吗？网络搜索显示[它去年不可用](http://markmail.org/message/gxyakwziya5yrggk)。

或者，有人可以建议其他方法来清理 JRuby 中格式错误的 HTML 吗？

## 更新

按照 Markus 的建议，我现在通过 popen 而不是 libtidy 使用 Tidy。我发布了通过 tidy 管道传输文档数据的代码，以供将来参考。希望这是健壮和便携的。

```
def clean(data)
    cleaned = nil
    tidy = IO.popen('tidy -f "log/tidy.log" --force-output yes -wrap 0 -utf8', 'w+')
    begin
        tidy.write(data)
        tidy.close_write
        cleaned = tidy.read
        tidy.close_read
    rescue Errno::EPIPE
        $stderr.print "Running 'tidy' failed: " + $!
        tidy.close
    end        
    return cleaned if cleaned and cleaned != ""
    return data
end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T21:48:17.807

[您可以在JRuby](http://jruby.codehaus.org/)中通过命令行使用它，并使用`%x{...}`反引号或反引号。您可能还需要考虑`popen`（并通过它进行管道传输）。

也许不优雅，但比试图弄乱不受支持的库更有可能让您轻松进行。

# python - python中是否有COMMIT模拟用于写入文件？

> ID：608316
> 
> 赞同：8
> 
> 时间：2009-03-03T21:33:02.447
> 
> 标签：python, file-io, commit, buffering

我打开了一个文件以供写入，并且一个进程运行了几天——在相对随机的时刻将某些内容写入文件。我的理解是——在我执行 file.close() 之前——有可能没有任何东西真正保存到磁盘上。真的吗？

如果主进程还没有完成，系统崩溃了怎么办？有没有一种方法可以每隔......比如说——10分钟（我自己称之为提交——不需要运行计时器）进行一次提交？file.close() 和 open(file,'a') 是唯一的方法，还是有更好的选择？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-03T21:34:57.467

您应该可以使用它`file.flush()`来执行此操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T21:51:08.753

如果您不想杀死当前要添加的进程`f.flush()`（听起来它已经运行了好几天了？），您应该没问题。如果您看到要写入的文件变大，则不会丢失该数据...

来自 Python 文档：

> **write(str)** 将字符串写入文件。没有返回值。由于缓冲，在调用 flush() 或 close() 方法之前，字符串可能不会真正显示在文件中。

听起来 Python 的缓冲系统会自动刷新文件对象，但不能保证何时会发生这种情况。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-03T22:34:33.140

要确保您的数据已写入磁盘，请使用`file.flush()`后跟`os.fsync(file.fileno())`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T06:41:06.653

如前所述，使用 .flush() 方法强制写入缓冲区，但避免使用大量调用来刷新，因为这实际上会减慢您的写入速度（如果应用程序依赖于快速写入），因为您将迫使您的文件系统写入小于其缓冲区大小的更改，这可能会让您屈服。:)

# .net - 正则表达式替换，但仅在两种模式之间

> ID：608319
> 
> 赞同：4
> 
> 时间：2009-03-03T21:33:59.403
> 
> 标签：.net, regex, replace

好的，我有一个多行字符串，我正在尝试对其进行一些清理。

每行可能是也可能不是一大块引用文本的一部分。例子：

```
This line is not quoted.
This part of the line is not quoted “but this is.”
This one is not quoted either.
“This entire line is quoted”
Not quoted.
“This line is quoted
and so is this one
and so is this one.”
This is not quoted “but this is
and so is this.” 
```

我需要一个正则表达式替换，它将解开硬包装的引号行，即用空格替换“\r\n”，但只能在大引号之间。

以下是更换后的外观：

```
This line is not quoted.
This part of the line is not quoted “but this is.”
This one is not quoted either.
“This entire line is quoted”
Not quoted.
“This line is quoted and so is this one and so is this one.”
This is not quoted “but this is and so is this.” 
```

（注意最后两行是输入文本中的多行。）

**约束**

*   理想情况下需要一个正则表达式替换调用
*   使用 .NET RegEx 库
*   引号*始终*是开始/结束的大引号，而不是普通的双引号 (")，这应该会使这更容易一些。

**重要约束**

这不是直接的 .NET 代码，我正在填充一个“searchfor/replacewith”字符串表，然后通过 RegEx.Replace 调用这些字符串。我无法添加自定义代码，如匹配评估器、循环捕获的组等。

到目前为止，当前的答案大致如下：

```
r.Replace("(?<=“)\r\n(?=”)", " ") 
```

显然，我什至还没有接近。

相同的逻辑可以应用于编程代码中块注释的颜色编码——块注释内的任何内容都不会与注释外的内容相同。（代码有点棘手，因为开始/结束块注释分隔符也可以合法地存在于文字字符串中，我不必在这里处理这个问题。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T01:24:49.300

Assuming all curly quotes are properly balanced, this regex should do what you want:

```
@"[\r\n]+(?=[^“”]*”)" 
```

The `[\r\n]+` will match one or more line separators of any type--Unix (\n), DOS (\r\n) or older Mac (\r). Then the lookahead asserts that there's a close-quote ahead and that there's no open-quote between here and there. Then your replacement text can be a simple space character.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T23:46:03.827

NB: For testing regexes I use [http://gskinner.com/RegExr/](http://gskinner.com/RegExr/) which is very useful.

I don't think you can write a single expression that will replace an undefined number of newlines. However, you can write an expression to replace one or several, and either repeatedly run it or write it to deal with the max number of newlines you'll have within one quoted section.

First, you want single-line mode so that your expression matches the whole input string instead of line by line. Put this at the start of your expression to turn it on:

```
(?s) 
```

Then, you want a look-behind expression to match the start quote:

```
(?<=“) 
```

And a look-ahead to match the end quote:

```
(?=”) 
```

Now an expression to match some text, then a newline, then some text:

```
([^”\r]*)\r?([^”\r]*) 
```

Note that there are two capturing groups for the bits of text around the newline, so you can include that text in your replace expression. This will match text that has just one newline within the quotes. To extend this to two newlines, just add another optional newline and optional following text:

```
(?s)(?<=“)([^”\r]*)\r?([^”\r]*)\r?([^”\r]*)(?=”) 
```

You could extend this to match as many newlines as you think might occur. Not perfect, but perhaps sufficient. Or if you can repeatedly run the expression on your text then just replace a single one at a time.

Leaving your expression something like this:

```
r.Replace("(?s)(?<=“)([^”\r]*)\r?([^”\r]*)", "$1 $2") 
```

(This isn't quite correct as it'll add a space after text even if group two doesn't match... but it's a start)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T21:43:56.930

所以要做的是找到一个以开引号开头的字符串，后跟一个*不*包含右引号或任何 \r \n 字符的字符串，然后是一系列一个或多个 \r \n 字符，捕获除终端 \r \n 字符之外的所有内容，并将整个匹配替换为捕获的部分。

——马库斯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T22:21:12.423

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T23:41:45.163

You can not do what you want within the limits you have described.

Proof:

*   Your fixed table of replacements will execute a fixed number of calls to replace (call this n)
*   Each replace will only be able to eliminate a fixed number of line breaks (call this number m).

Therefore

*   A quoted block with m*n+1 line breaks will not be properly dealt with.

You either need to increase the power of your setup (e.g. by allowing more complex replacement, recursive replacements, an indefinite repetition flag, or...?) or accept the fact that this task can't be done by your engine.

-- MarkusQ

# apache-flex - 我可以为 ComboBox 提示使用可绑定字符串吗？

> ID：608328
> 
> 赞同：0
> 
> 时间：2009-03-03T21:37:58.580
> 
> 标签：apache-flex, actionscript-3, string, data-binding, combobox

以下显示带有文本“Select One”的 ComboBox：

**这是伪代码*

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
    <mx:ComboBox prompt="Select One">
        <mx:dataProvider>
            <mx:Array>
                <mx:Object label="Obj 1" />
                <mx:Object label="Obj 2" />
                <mx:Object label="Obj 3" />
            </mx:Array>
        </mx:dataProvider>
    </mx:ComboBox>
</mx:Application> 
```

但是，下面显示了一个带有文本“Obj 1”（第一项的标签）的 ComboBox：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
    <mx:Script>
        <![CDATA[
            [Bindable]
            private var promptText:String = "Select One";
        ]]>
    </mx:Script>

    <mx:ComboBox prompt="{promptText}">
        <mx:dataProvider>
            <mx:Array>
                <mx:Object label="Obj 1" />
                <mx:Object label="Obj 2" />
                <mx:Object label="Obj 3" />
            </mx:Array>
        </mx:dataProvider>
    </mx:ComboBox>
</mx:Application> 
```

为什么我不能为提示使用可绑定字符串？？？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T22:31:11.027

这有效：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
    <mx:Script>
        <![CDATA[
            [Bindable]
            private var promptText:String = "Select One";
        ]]>
    </mx:Script>

    <mx:ComboBox selectedIndex="-1" prompt="{promptText}">
        <mx:dataProvider>
            <mx:Array>
                <mx:Object label="Obj 1" />
                <mx:Object label="Obj 2" />
                <mx:Object label="Obj 3" />
            </mx:Array>
        </mx:dataProvider>
    </mx:ComboBox>
</mx:Application> 
```

我不知道为什么我必须将 selectedIndex 显式设置为 -1，但是，它有效！

# c++ - 需要提升 adjacency_list 帮助

> ID：608329
> 
> 赞同：2
> 
> 时间：2009-03-03T21:38:34.197
> 
> 标签：c++, boost, adjacency-list

我正在尝试使用 Boost 的 adjacency_list 类型，但我无法理解[文档](http://www.boost.org/doc/libs/1_38_0/libs/graph/doc/using_adjacency_list.html)。

假设我定义了一个名为 State 的类，并为美国的每个州实例化一个实例：

```
class State { ... };
State california, oregon, nevada, arizona, hawaii, ... 
```

我想将这些输入到 boost::adjacency_list 中，顶点是状态，边缘是边界。对于我上面列出的状态，我认为图表将包含以下数据：

```
california : oregon, nevada, arizona
hawaii :
oregon : california, nevada
nevada : oregon, california, arizona
arizona : california, nevada 
```

我了解如何将整数放入图中，我考虑只是制作一个状态数组并将它们的数组索引插入到图中，但似乎我应该只能说：

```
add_edge(california, oregon, graph); 
```

但这当然行不通。请帮忙！

**编辑：**
[这是](http://www.boost.org/doc/libs/1_38_0/libs/graph/doc/bundles.html)一个几乎正是我需要的例子。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T22:06:39.230

阅读 boost::adjacency_list ，看来您应该使用顶点的属性而不是类之类的东西：

```
struct VertexProperties {
    std::string stateName;
};

typedef adjacency_list<listS, listS, bidirectionalS, VertexProperties> Graph;
Graph adjacentStates(50);

property_map<Graph, std::string VertexProperties::*>::type
    stateName = get(&VertexProperties::stateName, adjacentStates);

add_edge(vertex("california", adjacentStates), vertex("oregon", adjacentStates), adjacentStates); 
```

（差）改编自[boost 中的一个例子](http://www.google.com/codesearch/p?hl=en#f_oXlvyBouA/boost_1_32_0/libs/graph/example/adjacency_list.cpp&q=adjacency_list)。

# javascript - 处理仅适用于某些内容的 Javascript 事件

> ID：608331
> 
> 赞同：1
> 
> 时间：2009-03-03T21:38:46.380
> 
> 标签：javascript, dom-events, yui

在尝试制作我的第一个大型 Javascript Web 应用程序时，我无法从概念上理解我应该做什么。

根据用户选择的选项卡，我在容器内显示不同的内容。内容不仅仅是文本，还使用不同的 Javascript 函数和事件。我正在使用雅虎！UI 库的“TabView”实现，但处理此问题的方式可能适用于其他 Tab 方法。

我想做的基本上是以下几点：

为每个选项卡（例如`MYAPP.modules.tabCalendar`和`MYAPP.modules.tabJourna`l）创建单独的模块。当用户单击不同的选项卡（或使用浏览器按钮导航到以前的选项卡状态）时，我可以调用`MYAPP.modules[oldModule].disable()`and `MYAPP.modules[newModules].enable()`。这些函数将订阅或取消订阅它们的自定义事件（例如，附加到容器的一般点击处理程序）。

处理事件的另一种方法可能是使用单个全局单击处理程序。如果单击在容器内，则确定当前选择了哪个选项卡并将单击事件发送到`MYAPP.modules[currentTab].onClick()`.

或者，全局点击处理程序可以触发自页面加载以来模块已订阅的自定义事件，并且每个模块的`onClick`事件将运行并确定它们是否应该做任何事情。

似乎有很多选择，但我一直在寻找资源来谈论做这样的事情的最佳方法。我在正确的道路上吗？我该如何处理？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T22:59:29.353

我对这个问题有点模糊。

1.  是的，你应该模块化你的代码。
2.  让每个模块在其各自容器中的元素上设置事件处理程序。

就是这样。YUI TabView 处理选项卡切换，因此您无需启用/禁用任何内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T04:58:40.253

使用已经内置到 TabView 中的事件来排队你的 JS 做事。

[http://developer.yahoo.com/yui/tabview/#handlingevents](http://developer.yahoo.com/yui/tabview/#handlingevents)

对于选项卡更改，您会被告知选择了上一个/下一个选项卡，这样的选项应该足以让您的 JS 弄清楚它应该做什么。如果你想编写一个翻译层来查看事件并根据它做一些事情，这很好，但不是绝对必要的。

# .net - 从 .NET 中的字符串获取 Type 对象的最佳方法

> ID：608332
> 
> 赞同：7
> 
> 时间：2009-03-03T21:39:02.900
> 
> 标签：.net, reflection, system.reflection

在 .NET 中将字符串转换为 Type 对象的最佳方法是什么？

需要考虑的问题：

*   该类型可能在不同的程序集中。
*   该类型的程序集可能尚未加载。

这是我的尝试，但它没有解决第二个问题

```
Public Function FindType(ByVal name As String) As Type
    Dim base As Type

    base = Reflection.Assembly.GetEntryAssembly.GetType(name, False, True)
    If base IsNot Nothing Then Return base

    base = Reflection.Assembly.GetExecutingAssembly.GetType(name, False, True)
    If base IsNot Nothing Then Return base

    For Each assembly As Reflection.Assembly In _
      AppDomain.CurrentDomain.GetAssemblies
        base = assembly.GetType(name, False, True)
        If base IsNot Nothing Then Return base
    Next
    Return Nothing
End Function 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-03T21:41:40.990

您可以使用[Type.GetType(string)](http://msdn.microsoft.com/en-us/library/w3f99sx1.aspx)来执行此操作。类型名称必须是程序集限定的，但该方法将根据需要加载程序集。如果类型为 mscorlid 或执行 GetType 调用的程序集，则无需程序集限定。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T21:48:09.273

您可能需要为第二个调用 GetReferencedAssemblies() 方法。

```
namespace reflectme
{
    using System;
    public class hello
    {
        public hello()
        {
            Console.WriteLine("hello");
            Console.ReadLine();
        }
        static void Main(string[] args)
        {
            Type t = System.Reflection.Assembly.GetExecutingAssembly().GetType("reflectme.hello");
            t.GetConstructor(System.Type.EmptyTypes).Invoke(null);
        }
    }
} 
```

# sharepoint - IFilter dll 适用于 Windows 桌面搜索，但不适用于 SharePoint 2007

> ID：608334
> 
> 赞同：3
> 
> 时间：2009-03-03T21:39:07.737
> 
> 标签：sharepoint, search, ifilter

我编写了一个 IFilter dll，它从我的应用程序文件格式返回文本。我在本地系统上注册了它，Windows Search 正确地返回了结果。我在我的 SharePoint 2007 服务器上注册了它，重新启动后，它似乎在文件中找不到任何内容。文档说，我要做的就是以与为其他索引服务器实现（例如 Windows 桌面搜索）注册 IFilter 相同的方式注册它......并且 SharePoint 将把它作为搜索过滤器的辅助来源. 当这不起作用时，我尝试在 SharePoint 用于 IFilters 的第一个源中设置它（根据[http://support.microsoft.com/kb/925765](http://support.microsoft.com/kb/925765)中的说明对其进行建模）。再次重新启动，并将 SharePoint 设置为爬网，但它仍然没有

我已经为抓取定义了我的文件类型，如[http://technet.microsoft.com/en-us/library/cc261843.aspx](http://technet.microsoft.com/en-us/library/cc261843.aspx)中所述。

我查看了事件日志，并查看了 C:\Program Files\Common Files\Microsoft Shared\web server extensions\12\LOGS （具有共享点搜索消息）中的详细日志...

编辑：我有它的工作。SharePoint 有 2 种风格：WSS 和 MOSS。有人告诉我，我正在使用 MOSS 安装，并且为此存在注册表项，因此我正在那里进行修改。我改为修改了 WSS 注册表区域，它起作用了。

我仍然需要找出原因，与文档相反，只是注册 DLL 并瞄准其 HKCR。通过它的 PersistentHandler for IFilter 链接到它不起作用。

我还需要更好地理解 MOSS 和 WSS 在搜索方面的关系。我想，当它由 SharePoint 管理员安装时，我可以安装到两个注册表部分（如果它们都在那里）（搜索 WSS 条目和搜索 WSS 条目）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-06-12T00:39:02.557

为了帮助其他人解决这个问题，答案如下：

“我改为修改了 WSS 注册表区域，它起作用了。”

换句话说，您必须调整分配给 WSS 版本而不是 MOSS 版本的注册表位。

# jsp - 码头中的 Jasper 在 getOutputStream 上抛出 IllegalStateException 但在 Tomcat 上没有

> ID：608352
> 
> 赞同：3
> 
> 时间：2009-03-03T21:45:32.493
> 
> 标签：jsp, tomcat, jetty

我有一个当前在 Tomcat 5.5.25 下运行的 Web 应用程序。我正在尝试将它移植到 Jetty 6，以利用 jsp 和 UI 更改的快速刷新时间。

由于我的 JSP 文件与 JSP 2.0 兼容，因此我正在使用 maven jetty 插件网站上建议的配置在 maven 下运行 jetty。此配置加载 apache 的 jasper JSP 编译器版本 5.5.15。（在 maven 存储库中也可以使用 5.5.23，但结果相同。）

在码头下，我的主页使用瓷砖配置，在 ServletResponseWrapperInclude.getOutputStream() 中出现 IllegalStateException。显然在Tomcat下它不会这样做。

我正在努力理解我们的瓷砖是什么，并且包括会导致 jasper 在码头而不是在 Tomcat 中抱怨的内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T22:39:51.423

这可能不是一个很好的答案，但我们发现当 Tiles 包含一个空的 tile 时会发生此错误。

通过检查我们的主图块 JSP 并删除对空图块的引用，我们解决了这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-15T17:29:38.873

哇——很好的发现！我刚刚偶然发现的另一个解决方案是将磁贴包含定义为空字符串，而不是空/空定义。

换句话说，如果我按如下方式定义了一个图块，我会遇到您描述的 IllegalStateException：

```
<definition name="login" extends="main.layout">
    <put name="title" value="Login" type="definition" />
    <put name="headinclude" value="" type="definition" />
    <put name="body" value="/WEB-INF/tiles/login.jsp" type="page" />
</definition> 
```

另一方面，如果我按如下方式定义图块，则异常消失：

```
<definition name="login" extends="main.layout">
    <put name="title" value="Login" type="definition" />
    <put name="headinclude" value="" type="string" />
    <put name="body" value="/WEB-INF/tiles/login.jsp" type="page" />
</definition> 
```

奇怪的错误，奇怪的解决方案，但它对我有用！

# sql - 检索大量字段时如何在sql server中获得正确的计数？

> ID：608355
> 
> 赞同：2
> 
> 时间：2009-03-03T21:46:15.550
> 
> 标签：sql, sql-server, tsql

这是我的场景，

我有返回很多字段的查询。其中一个字段称为 ID，我想按 ID 分组并按降序显示计数。但是，由于我要带回更多字段，因此显示真实计数变得更加困难，因为我必须按其他字段进行分组。这是我正在尝试做的一个例子。如果我只有 2 个字段（ID、颜色）并按颜色分组，我可能会得到如下结果：

ID 颜色计数

== ===== =====

2红10

3 蓝色 5

4绿24

假设我添加了另一个实际上是同一个人的字段，但是他们的名字拼写不同，这会导致计数失败，所以我可能会有这样的事情：

ID 颜色 名称 计数

== ===== ====== =====

2 红吉姆 5

2 红吉米 5

3 红鲍勃 3

3 红罗伯特 2

4 红约翰尼 12

4红约翰12

我希望能够带回 ID、颜色、名称和计数，但要显示第一个表中的计数。有没有办法使用ID来做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T21:52:45.817

如果您想要一个结果集，则必须省略名称，就像在您的第一篇文章中一样

```
SELECT Id, Color, COUNT(*)
FROM YourTable
GROUP By Id, Color 
```

现在，您可以使用子查询获得您想要的功能，虽然不优雅

```
SELECT Id, Color Name, (SELECT COUNT(*) 
                        FROM YourTable 
                        Where Id = O.Id 
                            AND Color = O.Color
                       ) AS "Count"
FROM YourTable O
GROUP BY Id, Color, Name 
```

这应该可以按您的意愿工作

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T22:00:14.130

试试这个：-

```
 SELECT DISTINCT a.ID, a.Color, a.Name, b.Count
 FROM yourTable
 INNER JOIN (
     SELECT ID, Color, Count(1) [Count] FROM yourTable
     GROUP BY ID, Color
 ) b ON a.ID = b.ID, a.Color = b.Color
 ORDER BY [Count] DESC 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T21:50:39.003

尝试进行子查询以获取计数。

——马库斯

# asp.net - 高级 ASP.NET Gridview 布局

> ID：608356
> 
> 赞同：0
> 
> 时间：2009-03-03T21:46:28.857
> 
> 标签：asp.net, jquery, gridview

所以我有一个功能请求，将字段添加到 GridView 上的单个数据行的第二个表行。起初，我考虑扩展 GridView 的功能，但很快意识到这将是一项艰巨的任务，因为我认为这个请求是一个更大的未来功能的垫片，所以决定反对它。还想在不久的将来迁移到 MVC，这将被丢弃代码。

因此，我创建了一个小 jquery 脚本来将单元格移动到表中的下一行。

```
$(document).ready(function() {
    $(".fieldAttributesNextRow").each(function() {
        var parent = $(this).parent();
        var newRow = $("<tr></tr>");
        newRow.attr("class", $(parent).attr("class"));

        var headerRow = $(parent).parent().find(":first");
        var cellCount = headerRow.children().length - headerRow.children().find(".hide").length;

        newRow.append($(this).attr("colspan", cellCount));
        $(parent).after(newRow);
    })
}); 
```

你觉得这怎么样？这是一个糟糕的设计决定吗？实际上，我对这个解决方案的易用性感到非常满意。请提供您的想法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T12:31:13.443

这是客户端代码，只要加载后用户不玩gridview，应该没问题。但是，如果您想对回发做任何事情，这可能需要一些重构。

你想用gridview实现什么？请记住，您可以挂钩到 Row 绑定事件并根据需要修改当前行。

# html - HTML Strict & CSS：如何缩小差距？

> ID：608357
> 
> 赞同：4
> 
> 时间：2009-03-03T21:46:51.493
> 
> 标签：html, css

在下面的网页中，图像和 div 之间有几个像素的间隙。（我在 Firefox 3 和 Safari 4 中测试过。）

我怎样才能缩小差距？

```
body {
  background-color: black;
}

img {
  width: 250px;
  height: 70px;
  border: 0;
  margin: 0;
  padding: 0;
}

div {
  background-color: white;
  border: 0;
  margin: 0;
  padding: 0;
}
```

```
<html>

<head>
  <title>Test Page</title>

</head>

<body>

  <img alt="Stack Overflow Logo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAccAAABvCAMAAACuGvu3AAAAw1BMVEX///8iJCb0gCS8u7sAAAAfISP19fURFBccHiDJyMi3trYJDRFOUFEZGx30fRwWGBuVlpft7e3++vfX2Nimp6j2mluJiov0hinAwMAAAQnk5OQmKCljZGZzc3Q0NjcABwzzdwD0exMtLzHR0dJaW1xrbG3c3Nw6PD6trq5/gIH+9e45Ozz+8eednZ5FRkdSU1T3q3f5w5/1ijn71L395NH6yav1kET828j96Nj4tIf5wJr3qXH2lU/2n2b4soP1iTXzbwCyXU06AAAQuklEQVR4nO1caXuiOhQWBRJERKq1ilVE3Fttp/s2M/f//6qb5CQh4FLbOrXtk/dLJSThkDc5W0ILBQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ2Nn4SbQwugsQccPf93f2gZND6Mm79xsTg/tBQaH8SvarVYjH8fHVoOjQ/hT79I0X86tCAaH8I18FisahP5vfEIRFZPtIn83nipApG/Dy2IxofwAIq12L89tCQaH8ItN5GxTgd8bwgTeadN5LfDXOFszk1krE3kd8P85UUh8iHmmlWbyG+G5zj++5BeChPZf9jcROPr4Q9ZgFV19V3G2kR+P/DlFz/KEmkiLw8olsbbcNMXIeOlTI/fVLWJ/G6YHwsi45dzUShMZPV8W1ONL4VH7qAWq0WZH3/mJvLkkIJpvA23Ra5Hq1WhSI+uuIn8c1DJNN6Em5OqMJJP3EjeiILrw4qm8Rac/xW6tf/MifzFTeSJNpHfCZfS2xHECRN5p095fCc85b2d+d/PjSLHSb1uf86jXsHYKU8JiDD1Bv0xbR1aorfguprzdm7izzSR9sQ0zfpnPOkVtIaeGbluZIWFQsN0CczhoWV6E26K0tsBL1UGJJ9hIu0KtowvwOPM9CyDwBpQHl360zs9tFBbcfmSW2hqSoClVn9zE/nyCSbyi/A4igzAt+FxHlfju+sMQ0ePksgreh7g/C1RpNNoND7Aw9fgsdw2vhuPT2yb4+X2KFsojOQJXaz3Md9T3mFBzkzXXLxfnK/B4xJzFj2/8z14POJ89f/+UklKvZ34F7l86tMqv3bpsIkM97vzGJpAIxqMRt3gW/Ao4nxCU/ykODIPV5mUwEscn+y2n/wTeJwy3gx/yq+/Po/zK+GcUr1Z/JNydXQsiIyPzwvnJ8877ib/BB4XjDcs44yvz+PR7V2sMnlymTL5RxJ5d1M439VX/Qk81hBbjl1x/fV5JExeZ5nsP8sjq4rO3T101DweDPfHfYXJal8GlDecYeWwx6v4HB7DxGm10mp2AFCr8KI0xzdutVpOpkpBaWaTDh3e4648EilKrfE2KXLX6+TcJ26e41hhUgaU5y+0OH7e3NIOwjBQ86HreAzG9Xp9HK7vgN5JO1jl0abINBk3ewb2EcKD0xKUTN0OBVYeMUWsyORFSXdgIYR8Y1JLB77AmhkkREy6BunQx4MmrQ884goJhRcNewOP9e6ASWENRg6UNNgjjU4qfs2n3acPbHpMqGjtSOwFD5fFDJMvEIbMn2Pi52xycYJpt7LsTZaVUU3KTnhENUIuBVRqnE46GBuDs4tuK5cBDxujpeF1epVuid9Z4bG2rFSWU6XAnnWQBTkzy4uGCXuGb1FEygS68GiJt2QXySnyeRvsdppSCpPWwYNxDSPeIxqUBI8GdkV+dZXHoGtJKXw0YlQliEnhlmWtJRUiSqU/w7SC/08V9MOfqsokCSgZfY/9TVuPdrPT9jGRDGPfbQ+59IRHA5kMTXo97bU9+sJ0wHxzUlZ7WBiRT2ijd9o9WFp5HpsRxmZNaRNWIstI4XtslLo+G+k0kx1A6OCyuy3kK00styIUG6RtBkOlS8+0BY9b8jn1HspI4bMlObCy+rjOmPYupFDQr5sZhP1j/hQrLk81jh8pg7cbPtUJPdcyPBRFroswff8lG/4mHwO+OGYmNizkRqYZIY9McSAX3qrSJq/pkZuuR8gEtnI8ziLDyKSHwoFKCXtOgxS3WORuGVKFlV1gIWA3rWwbtOQrkqffcHoLo3rhdR6TCGc6JNJTImesnYVEtQWfTEFWqM56C7NHHP26U12eOL7cGPwHE8/A0XBRLk0Xs0rkE4UlecSIkEOHl9BIRs1qLsqJU66duuTtTTEZgyVhBPmntWmpMfLI7/askOeR0dhQH0ueykfOkkNIVavPLl1Zd8Tq+SPys+5CVcvzfT78iFMi06iSxg7tTPDIlO4aHsOeoDGVwiD1HGgn9914NVcoVpjjWK7Pf4h5LqAsbto+7iIDLx1h1cZdv+MIWfFwsaiBmnQsjLpy+jmU+wmfnaeIqiB+bzxCFqIkZHhsRmRyZ5wmGFFquowB4qPN9BYfoiWvZ0O9iG79nsIKRpPRrLvknHLVlqbDkYvILMMGewnOY6fX6w0ma3iccSk84ie5XD+gLp3bmdkk0nveiLfjtz/gzq/FfO1iO7p+UZjclFQddywDJUpBizttzM9Ji52MVkyIBTFhdpbIGLaVe00oV3mkqzFSbWOh0AEa/LPSeJzMOJEmYSuBderzeQEbFnhJ5ozDlduMzh+71MEK4YJHf9BMkunSjeAlgEdvFHBnLcdjCHbQQBet8djpQv8WJlKPGKnCQIpJZ0Qw3QPg1dt3eHz7X3z8eL2GTBJQcpenerXBVyU0pPZcBeWxqVzX83f5cEywgWbqLZgUCo+jvG2kswIGkE/wBewS+jPoT1Fh4PewB5x68idFCA4KYoc0OI/eEAZ6xufiK/HjNOIzAy756nTJjCuBmR5Ad0NhAyJY/ZC2xRf7PrbyGFNnplp8ebx/yNH1cAkBZbzpf6/UNoX7eR6zSEyyFOh7EEbwZE2FlMeRm7eNMrATqpnTxZYd+BTcYw1gxVBDFbIlbHVkH1OFJM4jCtY9ZiOPwA8+E7fP5BIPOvK5qVqVPc1gcm0enffh6FjuTcUnd7+f7s9VMh8uT+Itxx03pm228xi0DYuxQNs31lQQPNpUXaH8E8B7SftvMSIsGuON+RAGaTmukBnTcnODB0bMMujvtpEljOMVHg1Y0TJ6aICbakgBXWYMFkKtcrfZhl1NMynsF/OT1J8pVqtxv/py+esmzYc/PBb7GxNyREfsplezIBGU1Qs5XeM1FTiPdpfoLr+2epONhCMLQMOx+Q/601XCSTbRgBPXSXuBiibVCsBjVMo9ZzuP4EMpXjXYZgunHtEofQ5Dmz4hZMJavX2r1Yd+MQeyMPv9uz+3gsz548b8eII2xLOv8OgDjyHx6JfrXogTfErHw8rP3KAHa046wDZ4gG1q7MC1YUPI/Ua2NrkSbCQC9SFMBjqLgEfk5J6zncdQCU1BLFAFfiJcGfGK9MEL2heLf6AXf1bYM5761WqeSSAzjq8ub2+2bzgOyZR3T50wT8Z6Hm2O0IOXHJsbtg8ojx1nyO1g7mYA4ZqXmrMLxgnLfMFoWjgQuhTyKD3u4SIJKGDq7V081oHHM/nmNlhj1g1ojCjhjYjPS7Uwe2fQue384v8wbh5/31X78Toui1TLXh1vzgKQBUmzID7qLSsXw9GsloixXeExKM8uKksOslDYOxE3R0ZVGVDV2ZmQOeJ3jEwAw7oCBWakPA4VZQphCOWUe6tMXVi5XI4AU87v4jEBHpVJNkhdYLb82AhcUNHcEjDrtgoBN4//4pD1+cP15d1JdT2XxerWo8fJgM5sC2PseT4yJzUQMM9j44wmYQXE3GxtCluYCbSoq0AHz8xmsALGj9VZ4ZF5TBCU0NE2rLSa/494VJVFL+WR36yAn0zflTUmijXxUyXxQTgM+TB0fnP7fNInC3OFzSpbjzY0W3Gz7CYyXYQ8DIYgmjAiczyOTGx4rinBeSxF23gko1xjWS0ve4Sb87hhPcLSswYhpMf4roK1olcB/2g9CiECFizSJmO2S4B5J2ud9DfCLpcIynmpGY7uny7v8mTC56t2iWHd1w31aW02uphYJs2c+ixHkuVxFhlWNJzWQ47E22U9QtyYkKWUDSADI28fK6l9FMMflfhfeE+ee5nVcmi+28/Zah+5dkcJs9zMAWNzDTnMvbKsdU76GwE8ltbySHE0vyYmM5Yms3oMzVobeYT7dhA2aNK7TYczw6PjEvWmNhT+6jY/R2YgyZBYA/W9ub/aTv3Vs9RfJQMMrulwyfTDEtgGT8hanwv7iL/aW+evily5P/NkHXB4ugMm3LLwcbzGI8M8NZk8mfMaj/AuxKwz7zrDYzefLZBxB9qQ9qc8irgxJLShUe6mkYkfIdQWGwzgSYAmFULA+nDXS/8uHnn8mE6NBB4LpxECmFo47QF4h62PvSRzduKR4fyemkz+r+Z34pFaDbYEMjySgc3mvEQeIJhg9ndVRjVBMDWZx5cin88B18byeE8N8VWGwi3s+flrneP38chNbho9TzmxcKWG/+V8ibuPZM7uPDIc3UMEuRuPZPEwNaLySOJxa5Lxs0mcDPzNfNhUWpExs/9ITIulOuoivyqKYISECpUbEYaSja6DTW0rAxjI32/jkWfT+WxKHVZQq0JllpTNMFtpDnX2EXXkeDx6DaLZzjxOcjyGZ3kenTbnsdxebyCzPI7bRmZXhO93yI0h2LhKUyQjeVggVeegbHG6+usVueG2I49lnlHj02WabnBQNLOXYUdMJtFBkCbM95LMyfJ4/3L8Cn5DVm49j7kzbEyv0jWwcNORt1f0apPr1YLtWdxRF4B6+XMdZETbyjAbfOdvWB7b9S6PDU3ZT7oWTPlYvhq8s0ZAM0pBreNhvue9K491vl3WrbOje4Ipt1sKbWfE9x+lvRwJNSo1b0UcH2jv5ZPmLI/X/eor+LuNx2EubCAqjvFHIgq2zyAKMwETHQFuFwnfVqQouxZc5Hi0BzijjIQF9CISi/LFp0TkgVCsXiUtg20lw3LNXqUyMGn2AlswCDvyGIjtaxM+lhbnAXwiRZtLkR6Ck/sc0iIIxapGvh9Anse1SRwFV1t4HLroTHl9m57SYClLun8kN/HLxBxaaTa9ZWFD8FjoUdsntJ89MzGbvvnzciVCnKs4eZXcMSsjuxEkTnmpKXxHqjWLJZQY99BoRx6F6hTLzp6knovsWupteZwjPc/DH7s+ZH4z9shjzbQM7FVqSRiE4bg865E3j0CdkliDuASNKf2a1V4SsnClPCaoT4eeheV6LNQH5B5aLurkVmNCt0+oH7FyfpWYPAunTI17uSG0Mgs+gTFUU3dkgeTPy5Fnjdha2ZXHwEsPVlHhEnFgK5VCGR7+9aTiaYsS9Rzu+7FHHu0ZPeuIUTSYTAYoIobKck9BjYQDegrSddk5xoRpsYge0HUjz/IrPcljIaHkY5c0dmk6yD1lm615HsekB0+JnlmrFBhn95pBiebCjBrycqPeBVl35bFQwp7KY6HlZXr0jPJKc3ZikoMrVnMvavWtPFa36dVCi54vZkcDWfbETQ9EjSOX6hHwGBPGEa1mWL7ZDWh0It4vHJoii03vsaFd/S6gRsagraw5tZXXHuQCMjBOUY4ZZynbkEdFlniXnXksJBPTZ4fBuTtTX6qyVzLZNocZcdUdHxuQYirsBTke45NXcLeNRzJHRz7NkyPkts3JQv0apVahJ8qBWHtxZrJ/YGJ2uk4hIDe8dJ62ugjuoS7ng/3flSw32Mz9KxanOyCtiI+BTleEClk2/mwlTHNmZ/QsdNs0jW66dnjyPt9LE4qzcVGpu+zRjzMEZa0RBim8bj64h+ZqAuOClezpwONb40ceQG6OH+36tFarLRqtID9u6sc1duBMp9My/Hej/Ec3dlIm9xI703JNX9kyOyxPy6t72BtqixuhU24lGVHt9bXtbeXK5bg8LSVrpFhtvVGq9+CN+RzZbKc8gManQfP4M6B5/BnQPP4MaB5/BjSPPwOcx1L5jdh8PkfjEBA8vg+ax68CzePPgObxZ0Dz+DOgefwhcD6EQ0uvoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhofGd8T8UlHs1bs9urgAAAABJRU5ErkJggg==">
  <div>text</div>

</body>

</html>
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-03T21:50:52.357

图像是一个内联元素，所以它被放置在文本行的基线上。间隙是基线和文本行底部之间的距离（即基线下方用于悬挂“g”和“j”等字符所需的空间）。

使图像成为块元素，间隙消失：

```
 display: block; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-03T21:49:25.637

删除图像标签和 div 标签之间的换行符。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-03T21:51:42.357

添加`display: block`到您`<img>`的 CSS 或样式属性中。

**编辑**Guffa 在上面击败了我。

在这种情况下，您也可以`<img>`使用`<div>`which 从技术上讲，无论如何您都应该这样做。`<body>`如果我没记错 HTML 规范，那么只有块级元素可以是其后代。然后，您可以灵活地在该 div 中添加更多图像（只要在`<img>`和的结尾之间没有空格，`</div>`您就可以开始使用了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-03T21:49:47.257

删除 HTML 中行与行之间的`<img>`换行符`<div>`。

为什么是的，HTML 将换行符视为空格很烦人。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-03T21:50:37.193

改变：

```
<img alt="Stack Overflow Logo" src="http://is.gd/lEfE">
<div>text</div> 
```

到：

```
<img alt="Stack Overflow Logo" src="http://is.gd/lEfE"><div>text</div> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-03T13:35:20.247

显示块对我不起作用，但确实如此。给它一个负边距值 - 有效的 CSS

```
img {
width : 250px;
height : 70px;
border : 0;
margin-top : -11px;
margin-left : -22px;
padding : 0;
} 
```

根据需要进行调整。

# opcode - 未处理的侏儒表达式

> ID：608361
> 
> 赞同：13
> 
> 时间：2009-03-03T21:48:18.993
> 
> 标签：opcode

谁能告诉我以下分段错误到底是什么意思？

```
Unhandled dwarf expression opcode 0x93 
```

它在solaris 10 i386上。

任何建议表示赞赏。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-07-24T10:07:57.463

如果您的 GDB 版本太旧（比生成代码的编译器旧），则可能会出现这种错误消息（“未处理的 dwarf 表达式”）。尝试安装最新版本的 gdb 并运行它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T21:55:17.883

这可能不会立即有帮助，但“dwarf”可能指的是[DWARF 调试标准](http://dwarfstd.org/)。

[DWARF 的维基百科条目](http://en.wikipedia.org/wiki/DWARF)表明该文件格式包含“用于简单、专用有限状态机的字节编码指令”。这可能意味着您有某种损坏的调试信息文件，但如果没有更多信息，我将无法进一步猜测。

# linq - 如何查询两个数据库并使用 LINQ 组合结果？

> ID：608363
> 
> 赞同：1
> 
> 时间：2009-03-03T21:49:18.273
> 
> 标签：linq

我需要从两个不同的数据库中提取相似表中的值，将它们组合起来，然后将输出写入 CSV 文件。我可以在属性文件中创建第二个连接字符串并显式地将第二个连接字符串传递给 DataContext 以用于其他 LINQ 查询吗？还是我需要做其他事情？除了用于某些条件的 ID 之外，这些表几乎相同。

我以前从未使用过 LINQ，但它似乎是处理这种不得不手工编写 SQL 的更简单的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T21:58:45.457

如果架构与两个数据库都匹配，那么您应该能够只创建第二个 DataContext 实例（将第二个连接字符串作为参数提供给它）。LINQ to SQL 不会以任何方式检查您是否使用“正确的”数据库 - 如果它具有正确的列和表，它将起作用。

但是，LINQ 不会以任何“智能”方式自动处理多个数据库，因此在执行任何涉及多个数据源的操作之前，它需要将内容下载到内存中。您仍然可以使用单个 LINQ 查询来执行此操作 - 但您必须注意它的哪一部分正在使用内存数据运行。（顺便说一句，您可以使用诸如“ToList”之类的扩展方法来明确地说-此时从数据库中获取数据）。

您还提到除了某些情况下的 ID 之外，这些表几乎相同 - 这是否意味着主键/外键不同？在这种情况下，某些自动生成的关系可能不起作用。如果这意味着存在不同的列名，那么您可以手动编辑生成的模式以包含两列，然后仅使用正确的列。但是，这感觉有点奇怪 - 除非您计划对架构进行一些手动编辑，否则您也可以只生成两个非常相似的架构。

# c++ - C++ 字符串内存管理

> ID：608370
> 
> 赞同：13
> 
> 时间：2009-03-03T21:50:44.213
> 
> 标签：c++, mfc, memory-management

上周，我用 C# 编写了几行代码，将一个大文本文件（300,000 行）写入字典。写了十分钟，不到一秒就执行完毕。

现在我将那段代码转换成 C++（因为我需要它在一个旧的 C++ COM 对象中）。到目前为止，我已经花了两天时间。:-( 虽然生产力差异本身就令人震惊，但我需要一些建议。

加载需要 7 秒，甚至更糟：之后释放所有 CStringW 所需的时间正好是那么多。这是不可接受的，我必须想办法提高性能。

有没有机会我可以分配这么多字符串而不会看到这种可怕的性能下降？

我现在的猜测是，我必须将所有文本填充到一个大数组中，然后让我的哈希表指向该数组中每个字符串的开头并删除 CStringW 内容。

但在此之前，你们 C++ 专家有什么建议吗？

**编辑**：我对自己的回答如下。我意识到这对我来说是最快的路线，并且也朝着*我*认为*正确的方向迈进*——朝着更多托管代码的方向前进。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-03T22:22:40.690

这听起来很像 Raymond Chen 与 Rico Mariani 的 C++ 与 C# 中/英词典的表现。Raymond 经过多次迭代才击败 C#。

也许那里有一些想法会有所帮助。

[http://blogs.msdn.com/ricom/archive/2005/05/10/performance-quiz-6-chinese-english-dictionary-reader.aspx](http://blogs.msdn.com/ricom/archive/2005/05/10/performance-quiz-6-chinese-english-dictionary-reader.aspx)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-03T22:23:22.777

你正在穿上 Raymond Chen 的鞋子。他做了同样的事情，用非托管 C++ 编写了一本中文字典。Rico Mariani 也这样做了，它是用 C# 编写的。Mariani 先生制作了一个版本。陈先生写了6个版本，试图匹配Mariani版本的性能。他几乎重写了 C/C++ 运行时库的重要部分来实现这一目标。

在那之后，托管代码得到了更多的尊重。GC 分配器是不可能被击败的。检查[此博客](https://docs.microsoft.com/en-us/archive/blogs/ricom/performance-quiz-6-chineseenglish-dictionary-reader)文章以获取链接。您可能也会对这篇[博](http://www.voidnish.com/Articles/ShowArticle.aspx?code=StlClrBclComparison)文感兴趣，了解 STL 值语义如何成为问题的一部分。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-03T21:55:42.283

哎呀。摆脱 CStrings...

也试试探查器。你确定你不只是在运行调试代码吗？

改用 std::string 。

编辑：

我只是对 ctor 和 dtor 比较做了一个简单的测试。

CStringW 似乎需要 2 到 3 倍的时间来执行新/删除。

迭代 1000000 次，为每种类型执行新/删除。没有别的了——在每个循环之前和之后都有一个 GetTickCount() 调用。CStringW 始终获得两倍的时间。

尽管我怀疑，但这并不能解决您的整个问题。

编辑：我也不认为使用字符串或 CStringW 是真正的问题 - 还有其他事情正在导致您的问题。

（但看在上帝的份上，无论如何都要使用 stl ！）

您需要对其进行概要分析。那是一场灾难。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-03T22:09:31.330

如果它是只读字典，那么以下内容应该适合您。

```
Use fseek/ftell functionality, to find the size of the text file.

Allocate a chunk of memory of that size + 1 to hold it.

fread the entire text file, into your memory chunk.

Iterate though the chunk.

    push_back into a vector<const char *> the starting address of each line.

    search for the line terminator using strchr.

    when you find it, deposit a NUL, which turns it into a string.
    the next character is the start of the next line

until you do not find a line terminator.

Insert a final NUL character. 
```

您现在可以使用向量来获取指针，这将让您访问相应的值。

完成字典后，释放内存，让向量在超出范围时死亡。

[编辑] 这在 dos 平台上可能会稍微复杂一些，因为行终止符是 CRLF。

在这种情况下，使用 strstr 来查找它，并增加 2 以查找下一行的开头。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-03T21:55:05.700

您将字符串存储在哪种容器中？如果它是`std::vector`of`CStringW`并且如果您事先没有`reserve`-ed 足够的内存，那么您一定会受到打击。A`vector`通常会在达到其限制（不是很高）后调整大小，然后将整个复制到新的内存位置，这会给您带来很大的影响。随着您的`vector`指数增长（即，如果初始大小为 1，则下一次分配 2，下一次分配 4，命中变得越来越不频繁）。

它还有助于了解各个字符串的长度。（有时 ：）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-04T12:24:49.417

感谢大家富有洞察力的评论。为你点赞！:-)

我必须承认我根本没有为此做好准备——C# 会以这种方式击败优秀的旧 C++。请不要将其解读为对 C++ 的冒犯，而是 .NET Framework 中的一个非常出色的内存管理器。

我决定退后一步，转而在 InterOp 舞台上进行这场战斗！也就是说，我将保留我的 C# 代码，并让我的旧 C++ 代码通过 COM 接口与 C# 代码对话。

有人问了很多关于我的代码的问题，我将尝试回答其中的一些问题：

*   编译器是 Visual Studio 2008，不，我没有运行调试版本。

*   该文件是使用 UTF8 文件阅读器读取的，我从一名微软员工那里下载了该文件，该员工在他们的网站上发布了该文件。它返回了 CStringW，大约 30% 的时间实际上都花在了读取文件上。

*   我存储字符串的容器只是一个固定大小的指向 CStringW 的指针向量，它从未调整大小。

编辑：我相信我得到的建议确实有效，如果我投入足够的时间，我可能会击败 C# 代码。另一方面，这样做根本不会提供任何客户价值，而坚持下去的唯一理由就是证明它可以做到……

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-09T17:05:22.620

问题不在于 CString，而在于您分配了很多小对象 - 默认内存分配器并未为此优化。

编写自己的分配器 - 分配一大块内存，然后在分配时只在其中推进一个指针。这实际上是 .NET 分配器所做的。当你准备好删除整个缓冲区。

我认为有在（更多）有效 C++ 中编写自定义新/删除运算符的示例

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-03T22:58:57.577

将字符串加载到单个缓冲区，解析文本以使用字符串终止符 ('\0') 替换换行符，并使用指向该缓冲区的指针添加到集合中。

或者 - 例如，如果您必须在加载期间进行 ANSI/UNICODE 转换 - 使用块分配器，这会牺牲删除单个元素。

```
class ChunkAlloc
{
   std::vector<BYTE> m_data;
   size_t m_fill;
   public:
     ChunkAlloc(size_t chunkSize) : m_data(size), m_fill(0) {}
     void * Alloc(size_t size)
     {
       if (m_data.size() - m_fill < size)
       {
          // normally, you'd reserve a new chunk here
          return 0;
       }
       void * result = &(m_data[m_fill]);
       m_fill += size;
       return m_fill;
     }
}
// all allocations from chuunk are freed when chung is destroyed. 
```

不会在 10 分钟内破解，但 30 分钟和一些测试听起来不错:)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-03T21:57:37.503

在使用字符串类时，您应该始终查看不必要的操作，例如，不要经常使用构造函数、连接和此类操作，尤其是避免在循环中使用它们。我想你使用 CStringW 有一些字符编码的原因，所以你可能不能使用不同的东西，这将是另一种优化代码的方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-12-29T20:34:56.723

难怪 CLR 的内存管理比 MFC 所基于的一堆陈旧而肮脏的技巧要好：它至少比 MFC 本身年轻两倍，而且它是基于池的。当我不得不使用字符串数组和 WinAPI/MFC 处理类似的项目时，我只是使用了用 WinAPI 的 TCHAR 实例化的 std::basic_string 和我自己的基于 Loki::SmallObjAllocator 的分配器。在这种情况下，您还可以查看 boost::pool （如果您希望它具有“标准感觉”或必须使用 7.1 之前的 VC++ 编译器版本）。

# ruby-on-rails - 我只需要 ActiveRecord 和 ActiveMailer，我应该使用 Rails/Merb 吗？

> ID：608377
> 
> 赞同：1
> 
> 时间：2009-03-03T21:54:33.830
> 
> 标签：ruby-on-rails, sinatra, merb

我有一个小型 Web 应用程序，目前正在[Sinatra](http://www.sinatrarb.com/)上运行。它只有两页，所以我真的不需要控制器或很多视图。我已经包括 ActiveRecord 与数据库交互和 ActiveMailer 发送和接收邮件。

在这么小的项目上使用 Rails 或 Merb 是否值得？我发现自己添加了 Rails 中包含的功能。我之前没有任何使用 Merb 的经验，所以我真的不知道这是否是一个合适的选择。但据我所知，Merb 可能是进行只需要几个组件的项目的方式。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T22:02:04.280

如果您已经在 Sinatra 上运行一个小型项目，则无需切换到 Rails。您可以在 Rails 之外使用 ActiveRecord 和 ActiveMailer。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T22:23:21.390

Merb 正在与 Rails for Rails 3.0 版合并。作为这个过程的一部分，核心 Rails 架构将被“merbified”，以便更容易配置为仅使用您需要的特定组件。

随着您的应用程序的增长，您可能会发现自己正在重新发明已经存在的功能，在这种情况下，我会考虑切换框架。

就个人而言，即使是非常小的项目，我也会使用 Rails。这意味着我为我所做的一切工作都有一个单一的框架和部署环境。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T22:26:53.223

我经常将 Sinatra 用于比您描述的要大得多的东西。您发现需要添加 Rails 的哪些功能？如果它只是诸如此类的`5.hours.ago`东西，您总是可以：a）将那部分代码从activesupport中拉出来并将其粘贴到项目中的“通用”/类似文件中，或者b）只需要activesupport并使用它的功能。

# security - 已签名的小程序可以连接到它们所源自的不同主机吗？

> ID：608387
> 
> 赞同：4
> 
> 时间：2009-03-03T21:56:33.623
> 
> 标签：security, sockets, applet, host

我需要一个小程序来打开一个套接字并与侦听小程序下载到的本地主机（最终用户机器）上的服务器通信。

与我所读到的关于小程序安全性的内容相反，似乎即使签名的小程序也无法打开连接到下载它们的不同主机的套接字（在同一台机器上它工作得很好）

我已经使用 -selfcert 对小程序进行了认证，使用 jarsigner 对其进行了签名，并且仍然，每当它尝试打开到不同主机的套接字时，我得到：

`Java.lang.Exception: java.security.AccessControlException: access denied (java.net.SocketPermission 127.0.0.1:9999 connect,resolve)`

我什至尝试更改 Java 策略文件，尽管使用签名的小程序不需要这样做：

`grant codeBase "http://applethost:8080/socket" { permission java.security.AllPermission; permission java.lang.RuntimePermission "usePolicy"; };`

sigend 小程序有什么问题，它们可以连接到不同的主机吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T22:32:23.397

是的，当您加载您的小程序时，如果您选择接受它的证书并信任它，它就会被授予 AllPermission，其中包括 SocketPermission。在连接到加载它的主机之外的主机之前，我已经编写了一个签名的小程序。您可以尝试暂时将您的 java 策略文件更改为

```
grant {
  permission java.security.AllPermission;
}; 
```

*   查看您的策略文件以查看它是否定义了任何其他 policy.url 位置，也许它们正在干扰。
*   检查您的浏览器设置是否有 javascript 可能。
*   确保您接受了小程序的证书，并且它已安装到您的站点证书列表中。
*   确保您拥有的授权 codeBase 行与您的小程序清单中的代码库相同。
*   在尝试连接之前，您可以尝试打印出您的小程序拥有的权限列表。
*   您可以尝试从小程序中以编程方式授予 AllPermission。

# c# - 长寿命对象的结构与类

> ID：608392
> 
> 赞同：16
> 
> 时间：2009-03-03T21:57:55.693
> 
> 标签：c#, .net, class, struct

当您需要非常小的对象时，比如说包含 2 个 float 属性，并且您将拥有数百万不会立即“销毁”的对象，是结构体还是类更好的选择？

就像在 xna 作为一个库一样，有 point3s 等作为结构，但是如果你需要长时间保持这些值，它会不会对性能造成威胁？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-03T22:14:24.657

与大多数关于结构的问题相反，这实际上似乎是结构的一个很好的用途。如果它包含的数据是值类型，并且您将使用其中的很多，那么结构会很好地工作。

一些技巧：

:: struct 不应大于 16 字节，否则您将失去性能优势。

:: 使结构不可变。这使得使用更加清晰。

例子：

```
public struct Point3D {

   public float X { get; private set; }
   public float Y { get; private set; }
   public float Z { get; private set; }

   public Point3D(float x, float y, float z) {
      X = x;
      Y = y;
      Z = z;
   }

   public Point3D Invert() {
      return new Point3D(-X, -Y, -Z);
   }

} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-03T22:14:26.793

答案取决于最终将存储对象/值的位置。如果要将它们存储在像 ArrayList 这样的无类型集合中，那么您最终将它们装箱。装箱为结构创建对象包装器，占用空间与类对象相同。另一方面，如果您使用 T[] 或 List 之类的类型化数组，那么使用结构将仅存储每个元素的实际数据，并且仅存储整个集合而不是其元素的足迹。

因此，在 T[] 数组中使用结构更有效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-03T22:08:38.163

最大的问题是内存是分配在堆栈还是堆上。默认情况下，结构体进入堆栈，并且堆栈通常在空间方面受到更多限制。所以像这样创建一大堆结构可能是个问题。

不过，在实践中，我真的不认为这有什么大不了的。如果你有那么多它们，它们很可能是某个类实例（在堆上）的一部分。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-03T22:10:16.647

Struct 似乎适合这个应用程序。

请记住，“需要保留这些值”意味着它们存储在堆上的某个地方，可能是类实例的数组字段。

需要注意的一件事是，这会导致在大对象堆上进行分配。目前尚不清楚该堆如何进行碎片整理（如果有的话），但是对于寿命很长的对象来说，这可能不是问题。

对数以百万计的这些数据类型使用类可能会因为取消引用的剪切量而代价高昂，这可能会发生在这种类型的操作上。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-04T03:06:22.363

通常，相同类型的大型非别名（即非共享）数据数组最好存储在结构中以提高性能，因为您减少了间接次数。（另请参见[when-are-structs-the-answer](https://stackoverflow.com/questions/597259/when-are-structs-the-answer/598182#598182)）。class 和 struct 之间的确切性能差异取决于您的使用情况。（例如，在操作中，您是否只访问结构的一部分？您是否进行了大量临时复制？如果结构很小，使用它可能总是更好，但如果它很大，创建临时副本可能会减慢您的速度。如果您使其不可变，您将必须始终复制整个内容以更改值。）

如有疑问，请测量。

由于您对此类测量可能不明显的可能的长期影响感兴趣，因此请注意此类数组可能存储在大对象堆上，应该重复使用而不是销毁和重新分配。（请参阅[CRL 由内而外：发现大型对象堆](http://msdn.microsoft.com/en-us/magazine/cc534993.aspx)。）

在调用中传递较大尺寸的结构时，您可能希望使用 ref 参数传递它们以避免复制。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-03T22:09:15.963

值类型（结构）适用于不经常在堆上分配的类型，也就是说，它们大多包含在另一个引用或值类型中。

您提供的 Vector3 示例是一个完美的示例。您很少会在堆中悬挂 Vector3，它们大多数时候将包含在本身在堆中的类型中，或者用作局部变量，在这种情况下，它将被分配在堆栈上。

# c# - 从非 WPF 代码访问 WPF XAML 资源

> ID：608397
> 
> 赞同：7
> 
> 时间：2009-03-03T21:59:32.647
> 
> 标签：c#, wpf, embedded-resource

我目前正在构建一个由多个组件组成的应用程序，每个组件本质上都是一个 WPF 用户控件，周围有一些 C# 代码，以便插件系统工作（使用 MEF）。

我遇到的问题是每个组件都应该包含一个图标，出于美观的目的，我将其定义为一个`System.Windows.Media.Brush`，所以我可以在`DrawingBrush`那里使用从 Design 导出的内容。现在我需要从非 WPF C# 访问那段 XAML，我目前有一个可怕的解决方法是实例化用户控件并询问它的资源：

```
private Brush CachedIcon = null;

public override Brush Icon
{
    get
    {
        if (CachedIcon == null)
        {
            CachedIcon = (Brush)(new BlahControl().TryFindResource("Icon"));
        }
        return CachedIcon;
    }
} 
```

我找不到`ResourceDictionary`从“普通”C# 类中读取该资源（这是一个 .xaml 文件，并在自定义控件中的 a 中引用）的方法。任何属于 WPF 的东西都有那个很好的`TryFindResource`方法，但不然怎么做呢？我不想让带有未嵌入图标的 XAML 文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T23:52:49.860

在您的 XAML 代码中，确保图标资源的构建选项设置为“资源”，然后引用该资源以使其成为 xaml 静态资源

```
<UserControl.Resources>
    <BitmapImage x:Key="icon1" UriSource="Resources/Icon1.ico" />
</UserControl.Resources> 
```

然后在您的 .Net 2.0 代码中，您将在“{xamlName}.g.resource”流中找到资源

将 xaml dll 中的所有图标加载到字典中的示例代码：

```
using System.IO;
using System.Reflection;
using System.Collections;
using System.Resources;

...

var icons = new Dictionary<String, Bitmap>();
var externalBaml = Assembly.LoadFile(Path.Combine(Environment.CurrentDirectory, "MyXaml.dll"));
Stream resourceStream = externalBaml.GetManifestResourceStream(externalBaml.GetName().Name + ".g.resources");
using (ResourceReader resourceReader = new ResourceReader(resourceStream)) {
    foreach (DictionaryEntry resourceEntry in resourceReader) {
        if (resourceEntry.Key.ToString().ToUpper().EndsWith(".ICO")) {
            icons.Add(resourceEntry.Key.ToString(), Image.FromStream(resourceEntry.Value as Stream) as Bitmap);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T09:24:58.720

我的建议是：

*   提供有关在何处可以找到图标的控件的元数据。您可以使用自己的自定义属性来执行此操作（请参见下面的示例 1）。此元数据将允许您在不创建控件实例的情况下加载图标。

*   由于您使用的是 MEF，因此您可以在导出中使用元数据来实现与上述相同的效果。详情[在这里](http://mef.codeplex.com/Wiki/View.aspx?title=Exports%20and%20Metadata&referringTitle=Guide)。请参见下面的示例 2。

*   将您的图标视为一个`ImageSource`而不是一个`Brush`. 您可以使用 WPF 的`Image`控件来显示您的`ImageSource`，也可以使用`ImageBrush`.

*   使用 TFD 提供的技术读取元数据中指定名称的资源。不幸的是，WPF 似乎没有提供类似 a 的任何东西`BamlReader`，这将使从非 WPF 上下文加载 WPF 资源变得更加清晰。

示例 1：

```
[Icon("MyIconResourceName")]
public class BlahControl : Control
{
    ...
} 
```

示例 2：

```
[Export(typeof(IApplicationComponent))]
[ExportMetadata("IconResource", "MyIconResourceName")]
public class BlahControl : Control
{
    ...
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T22:04:26.083

您可以从程序集中读取资源作为流。

此处的示例代码：http: [//www.wpftutorial.net/ReadWPFResourcesFromWinForms.html](http://www.wpftutorial.net/ReadWPFResourcesFromWinForms.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T17:19:33.153

在 app.xaml 或主资源字典 xaml 文件中定义应用级别而不是控件中的图标。然后您可以使用相同的 TryFindResource 方法，但无需创建控件的实例。

# perl - Perl中的矩阵矩阵

> ID：608406
> 
> 赞同：9
> 
> 时间：2009-03-03T22:02:44.280
> 
> 标签：perl, matrix

在我正在处理的 Perl 脚本中，我需要用其他几个矩阵构建一个矩阵。我查看了 CPAN 中的几个模块（[Math::Matrix](http://search.cpan.org/search?mode=module&query=Math%3A%3AMatrix)、[PDL::Matrix](http://search.cpan.org/search?mode=module&query=PDL%3A%3AMatrix)、[Math::Cephes::Matrix](http://search.cpan.org/search?mode=module&query=Math%3A%3ACephes%3A%3AMatrix)），但这些似乎都不支持这一点。

在 Octave 中，这很容易。这是一个类似于我正在尝试做的事情的例子：

```
octave:1> A = [ 1, 2; 3, 4 ]
A =    
   1   2
   3   4

octave:2> B = [ 5, 6; 7, 8 ]
B =    
   5   6
   7   8

octave:3> C = [ 9, 10; 11, 12 ]
C =    
    9   10
   11   12

octave:4> D = [ 13, 14; 15, 16 ]
D =    
   13   14
   15   16

octave:5> E = [ A, B; C, D ]
E =    
    1    2    5    6
    3    4    7    8
    9   10   13   14
   11   12   15   16 
```

似乎自己尝试这样做会很快变得混乱，这可能是这些模块不支持它的原因......那里有其他人需要这个吗？你解决了吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-03T22:43:13.057

自己滚动并不太痛苦。

```
use List::Util qw(max);

@A = ([1, 2], [3, 4]);
@B = ([5, 6], [7, 8]);
@C = ([9, 10], [11, 12]);
@D = ([13, 14], [15, 16]);

sub hmerge(\@\@;\@\@\@\@\@\@) {
    my @ret;
    for my $i (0 .. max map $#$_, @_) {
        push @ret, [map @{$$_[$i]}, @_];
    }
    @ret;
}

@E = (hmerge(@A, @B), hmerge(@C, @D)); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-24T20:01:56.610

[Perl 数据语言](http://pdl.perl.org)`pdl`(PDL) 版本 2.4.10在使用字符串参数时支持构造函数的MATLAB 样式便捷输入，并且可以使用`append`and例程将子数组粘贴在一起，如本次会议所示：`glue``pdl2`

```
pdl> $A = pdl q[ 1, 2 ; 3, 4 ];       # pdl constructor with string argument

pdl> $B = pdl q[ 5, 6 ; 7, 8 ];       # pdl constructor with string argument

pdl> $C = pdl q[ 9, 10 ; 11, 12 ];    # pdl constructor with string argument

pdl> $D = pdl q[ 13, 14 ; 15, 16];    # pdl constructor with string argument

pdl> ?vars
PDL variables in package main::

Name         Type   Dimension       Flow  State          Mem
----------------------------------------------------------------
$A           Double D [2,2]                P            0.03KB 
$B           Double D [2,2]                P            0.03KB 
$C           Double D [2,2]                P            0.03KB 
$D           Double D [2,2]                P            0.03KB 

pdl> p $A, $B, $C, $D;

[
 [1 2]
 [3 4]
]

[
 [5 6]
 [7 8]
]

[
 [ 9 10]
 [11 12]
]

[
 [13 14]
 [15 16]
]

pdl> p $AB = $A->append($B);          # concatenate horizontally (actually on dim(0))

[
 [1 2 5 6]
 [3 4 7 8]
]

pdl> p $CD = $C->append($D);          # concatenate horizontally (actually on dim(0))

[
 [ 9 10 13 14]
 [11 12 15 16]
]

pdl> p $E = $AB->glue(1,$CD);         # glue vertically (actually on dim(1))
[
 [ 1  2  5  6]
 [ 3  4  7  8]
 [ 9 10 13 14]
 [11 12 15 16]
] 
```

[PDL 书籍](http://pdl.perl.org/content/pdl-book-toc.html)和[PDL 邮件列表](http://pdl.perl.org/?page=mailing-lists)是有关PDL 的更多信息的重要来源。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-04T16:13:17.310

**编辑**

我误解了 OP，认为他们想遍历几个矩阵的所有可能排列（这就是 Iterator::Array::Jagged 所做的）。

* * *

看看[Iterator::Array::Jagged](http://search.cpan.org/perldoc?Iterator::Array::Jagged)

以下是概要中的一个示例：

```
use Iterator::Array::Jagged;

# Build up a set of data:
my @data = (
  [qw/ a b /],
  [qw/ c d /],
  [qw/ e f g /]
);

# Iterator is a subref:
my $itersub = Iterator::Array::Jagged->get_iterator( @data );
while( my @set = $itersub->() )
{
  print "Next set: '" . join("&", @set) . "'\n";
}# end while() 
```

上面代码中的示例打印以下内容：

```
Next set: 'a&c&e'
Next set: 'b&c&e'
Next set: 'a&d&e'
Next set: 'b&d&e'
Next set: 'a&c&f'
Next set: 'b&c&f'
Next set: 'a&d&f'
Next set: 'b&d&f'
Next set: 'a&c&g'
Next set: 'b&c&g'
Next set: 'a&d&g'
Next set: 'b&d&g' 
```

# css - 如何从 TextInput 中删除阴影？

> ID：608408
> 
> 赞同：1
> 
> 时间：2009-03-03T22:04:31.437
> 
> 标签：css, apache-flex, actionscript-3, textinput, drop-shadow

我的 Flex 应用程序中有一个样式表，引用为：

```
<mx:Style source="/assets/stylesheets/default.css" /> 
```

在这个样式表中，我将 dropShadowEnabled 设置为 true gloablly：

```
global {
    fontSize: 11pt;
    dropShadowEnabled: true;
    verticalAlign: "middle";
} 
```

这为许多组件（包括所有 TextInputs）提供了阴影。

但是，我有一个显示可编辑组合框的标题窗口组件，并且我不希望该文本输入具有投影。但是我不能让它消失。我尝试了以下方法：

创建 CSS 类选择器...

```
<mx:ComboBox editable="true" dataProvider="{nameOptions}" textInputStyleName="noDropShadow" /> 
```

...在默认 CSS 中：

```
.noDropShadow {
    dropShadowEnabled: false;
} 
```

...在标题窗口中：

```
<mx:Style>
    .noDropShadow {
        dropShadowEnabled: false;
    }
</mx:Style> 
```

...还：

```
<mx:Style>
    TextInput.noDropShadow {
        dropShadowEnabled: false;
    }
</mx:Style> 
```

这些都没有删除阴影。我在这里想念什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T22:09:16.430

一种解决方案是删除“dropShadowEnabled：true；” 从全局样式中，并将其仅放在您特别想要阴影的项目上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T21:01:55.167

给你的组合框一个 id 属性，然后：

combo_box_id.setStyle("dropShadowEnabled", false);

在你的`<mx:Script/>`街区。

# c++ - 在 C++ 中在运行时选择模板参数

> ID：608409
> 
> 赞同：9
> 
> 时间：2009-03-03T22:04:41.090
> 
> 标签：c++, templates, runtime, arguments

假设我有一组函数和类，它们被模板化为使用单 ( `float`) 或`double`精度。当然，我可以只写两段引导代码，或者乱用宏。但是我可以在运行时切换模板参数吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-03T22:10:09.893

不，您不能在运行时切换模板参数，因为模板是由编译器在编译时实例化的。您*可以*做的是让两个模板都从一个公共基类派生，始终在代码中使用基类，然后决定在运行时使用哪个派生类：

```
class Base
{
   ...
};

template <typename T>
class Foo : public Base
{
    ...
};

Base *newBase()
{
    if(some condition)
        return new Foo<float>();
    else
        return new Foo<double>();
} 
```

宏与模板有同样的问题，因为它们在编译时被扩展。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T22:07:06.997

模板是一种编译时机制。顺便说一句，宏也是如此（严格来说 - 一种预处理机制 - 甚至在编译之前就出现了）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-03T22:11:40.967

模板纯粹是编译时构造，编译器将扩​​展模板并使用指定的参数创建您的类/函数，并将其直接转换为代码。

如果您试图在运行时`foo<float>`和`foo<double>`运行时之间切换，您要么需要使用一些元编程技巧，要么只为每个使用单独的代码路径。

# jquery - 使用 jQuery 查找元素的类型

> ID：608410
> 
> 赞同：346
> 
> 时间：2009-03-03T22:04:45.087
> 
> 标签：jquery

在 jQuery 中，如果我有一个元素的引用，我如何确定它是什么类型的元素，例如，输入或下拉列表？有什么办法可以查到吗？

复制：

[如何确定 jQuery 中匹配元素的元素类型？](https://stackoverflow.com/questions/341900/how-can-i-determine-the-element-type-of-a-matched-element-in-jquery)

* * *

## 回答 #1

> 赞同：617
> 
> 时间：2009-03-03T22:06:56.407

如果元素是输入，则以下内容将返回 true：

```
$("#elementId").is("input") 
```

或者您可以使用以下内容获取标签的名称：

```
$("#elementId").get(0).tagName 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2015-01-27T06:17:05.050

您可以使用.prop **[()](http://api.jquery.com/prop/)**`tagName`作为要获取的属性的名称：

```
$("#elementId").prop('tagName'); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-04-29T14:14:04.200

值得注意的是，@Marius 的第二个答案可以用作纯 Javascript 解决方案。

```
document.getElementById('elementId').tagName 
```

# javascript - 如何在 JavaScript 中确定系统的 Olson zoneinfo？

> ID：608423
> 
> 赞同：4
> 
> 时间：2009-03-03T22:09:32.390
> 
> 标签：javascript, timezone, zoneinfo

我有兴趣检索用户当前在 JavaScript 中为其操作系统设置的当前 zoneinfo 字符串（“America/Los Angeles”、“Europe/London”等）。我找到了如何以秒为单位获取当前偏移量、特定日期的偏移量以及不太精确的时区（PST 等），但不是 Olson zoneinfo。这可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-08-21T19:08:24.247

几个月前我研究了这个问题，结果是：[http](http://site.pageloom.com/automatic-timezone-detection-with-javascript) ://site.pageloom.com/automatic-timezone-detection-with-javascript 。该脚本不会为您提供最精确的结果。例如，无论您在中欧时区的哪个位置，它都会返回 Europe/Berlin。

基本上，它会检查夏令时转换发生时的已知日期。

希望它会有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T22:22:36.900

请参阅[flegix.js 的 date.Date 插件](http://js.fleegix.org/plugins/date/date)。您可能可以只破解[您需要的部分](http://github.com/mde/fleegix-js-javascript-toolkit/blob/master/plugins/date/date.js?raw=true)：

```
 function getRegionForTimezone(tz) {
    var exc = regionExceptions[tz];
    if (exc) {
      return exc;
    }
    else {
      reg = tz.split('/')[0];
      return regionMap[reg];
    }
  } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T22:20:40.163

没有。对不起！您也许可以使用 TimeZone 通过 Java 小程序获得它，但从 JavaScript 中您所拥有的只是与 UTC 的偏移量。（从时区名称猜测是不可靠的，因为名称取决于语言环境。您可以通过匹配 UTC 偏移量来检测一些常见情况，但这可能需要大量工作。）

通常，如果您想将时区支持到像 Olson 一样细粒度的级别，您会为用户提供明确的可选择时区控制。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-01T23:18:07.007

我使用 Jon Nylander 的超棒检测器（基于 Josh Fraser 的脚本，[http:](http://www.onlineaspect.com) //www.onlineaspect.com）的一些想法制作了一个更简单的脚本。Nylander 的脚本（以及它在[https://github.com/scottwater/jquery.detect_timezone](https://github.com/scottwater/jquery.detect_timezone)中的 jQuery 对应）使用歧义列表，并且 DST 开始时间与当地时间相同。我的脚本只有一个列表，所有日期都采用 UTC，以便在需要时轻松添加或修改时区。

用法：
- 另存为 .js 并包含在 html 标题部分中
- 调用 get_timezone_id() 并返回用户的时区，例如。“欧洲/赫尔辛基”

此脚本可以检测 90 个时区，但如果您需要更多时区，则必须使用 GeoLocation API 或一些服务器端库 (geoIP)。根据目的，还可以考虑添加用户可选择的时区列表。

另请注意，由于我们不知道未来的浏览器和系统如何保存 2011 年的过渡数据，因此可能需要在未来的某一天进行一些调整。（我测试了 1970-80 的日期，结果在同一系统中的不同浏览器之间差异很大（！））但幸运的是 2011 年已经过去，世界上几乎所有的系统都希望更新他们的 tz-databases，检测应该是现在还不错。

```
/*
This script (Javascript Timezone Detection) detects Olson timezone  
ID of user's system's timezone using getTimezoneOffset(). Detection
is tested and passed 100% in the following conditions:

* Windows 7,Opera 11.00
* Windows 7,Firefox 3.6.13
* Windows 7,Safari 5.0.3
* Windows 7,Google Chrome 8.0.552.237
* Windows 7,Internet Explorer 8.0.7600.16385

* Mac OS X,Google Chrome 8.0.552.237
* Mac OS X,Firefox 3.6.13
* Mac OS X,Opera 11.01
* Mac OS X,Safari Version 5.0.3

* Centos 5,Firefox 3.6.13
* Centos 5,Safari
* Centos 5,Opera 11.00

The script has ability to detect 90 timezones.

Every row in zones-array consist of
0: Olson timezone ID,
1-6: Transition start time in UTC (usually summer time start and sometimes winter time start) 
7: Utc offset in minutes
8: 1 = has transition,0 = has not transition

Timezones are listed in zones-array this way:  
- first comes section of timezones, that have transitions and then section of timezones that have no transitions  
- Both sections are then ordered by offset  
- Finally the has transitions section is ordered by the transition start time.    
If you add more timezones or replaces some, please be sure to maintain this order, otherwise the detection fails in some cases.

Minified size: about 4.46KB  
*/    
var zones = new Array(
// FIRST DST TIMEZONES
    [ 'Pacific/Apia',                    2011,3,3,11,0,0,      -660, 1 ]/* For Opera Linux. Unexpectedly winter-offset. */,

    [ 'Pacific/Apia',                    2010,8,26,11,0,0,     -600, 1 ]/* STD: -660 */,

    [ 'America/Adak',                    2011,2,13,12,0,0,     -540, 1 ]/* STD: -600 */,

    [ 'America/Anchorage',               2011,2,13,11,0,0,     -480, 1 ]/* STD: -540 */,

    [ 'America/Los_Angeles',             2011,2,13,10,0,0,     -420, 1 ]/* STD: -480 */,
    [ 'America/Santa_Isabel',            2011,3,3,10,0,0,      -420, 1 ]/* STD: -480 */,

    [ 'America/Denver',                  2011,2,13,9,0,0,      -360, 1 ]/* STD: -420 */,
    [ 'America/Mazatlan',                2011,3,3,9,0,0,       -360, 1 ]/* STD: -420 */,

    [ 'America/Chicago',                 2011,2,13,8,0,0,      -300, 1 ]/* STD: -360 */,
    [ 'America/Mexico_City',             2011,3,3,8,0,0,       -300, 1 ]/* STD: -360 */,
    [ 'Pacific/Easter',                  2011,9,9,4,0,0,       -300, 1 ]/* STD: -360 */,

    [ 'America/Havana',                  2011,2,13,5,0,0,      -240, 1 ]/* STD: -300 */,
    [ 'America/New_York',                2011,2,13,7,0,0,      -240, 1 ]/* STD: -300 */,

    [ 'America/Goose_Bay',               2011,2,13,4,1,0,      -180, 1 ]/* STD: -240 */,
    [ 'America/Halifax',                 2011,2,13,6,0,0,      -180, 1 ]/* STD: -240 */,
    [ 'Atlantic/Stanley',                2011,8,4,6,0,0,       -180, 1 ]/* STD: -240 */,
    [ 'America/Asuncion',                2011,9,2,4,0,0,       -180, 1 ]/* STD: -240 */,
    [ 'America/Santiago',                2011,9,9,4,0,0,       -180, 1 ]/* STD: -240 */,
    [ 'America/Campo_Grande',            2011,9,16,4,0,0,      -180, 1 ]/* STD: -240 */,

    [ 'America/St_Johns',                2011,2,13,3,31,0,     -150, 1 ]/* STD: -210 */,

    [ 'America/Miquelon',                2011,2,13,5,0,0,      -120, 1 ]/* STD: -180 */,
    [ 'America/Godthab',                 2011,2,27,1,0,0,      -120, 1 ]/* STD: -180 */,
    [ 'America/Montevideo',              2011,9,2,5,0,0,       -120, 1 ]/* STD: -180 */,
    [ 'America/Sao_Paulo',               2011,9,16,3,0,0,      -120, 1 ]/* STD: -180 */,

    [ 'Atlantic/Azores',                 2011,2,27,1,0,0,      0, 1 ]/* STD: -60 */,
    [ 'Atlantic/Azores',                 2010,2,28,3,0,0,      0, 1 ], /* Windows fix */

    [ 'Europe/London',                   2011,2,27,1,0,0,      60, 1 ]/* STD: 0 */,

    [ 'Europe/Berlin',                   2011,2,27,1,0,0,      120, 1 ]/* STD: 60 */,
    [ 'Africa/Windhoek',                 2011,8,4,1,0,0,       120, 1 ]/* STD: 60 */,

    [ 'Asia/Gaza',                       2011,2,25,22,1,0,     180, 1 ]/* STD: 120 */,
    [ 'Asia/Beirut',                     2011,2,26,22,0,0,     180, 1 ]/* STD: 120 */,
    [ 'Europe/Minsk',                    2011,2,27,0,0,0,      180, 1 ]/* STD: 120 */,
// Istanbul and Helsinki are the same, please select which one to use
//  [ 'Europe/Istanbul',                 2011,2,27,1,0,0,      180, 1 ]/* STD: 120 */,
    [ 'Europe/Helsinki',                 2011,2,27,1,0,0,      180, 1 ]/* STD: 120 */,
    [ 'Asia/Jerusalem',                  2011,3,1,0,0,0,       180, 1 ]/* STD: 120 */,
    [ 'Africa/Cairo',                    2011,3,28,22,0,0,     180, 1 ]/* STD: 120 */,
    [ 'Asia/Damascus',                   2011,9,27,21,0,0,     120, 1 ]/* Unexpectedly here winter-offset */,
    [ 'Asia/Amman',                      2011,9,27,22,0,0,     120, 1 ]/* Unexpectedly here winter-offset */,

    [ 'Europe/Moscow',                   2011,2,26,23,0,0,     240, 1 ]/* STD: 180 */,

    [ 'Asia/Tehran',                     2009,2,21,20,30,0,    270, 1 ]/* STD: 210 */,

    [ 'Asia/Yerevan',                    2011,2,26,22,0,0,     300, 1 ]/* STD: 240 */,
    [ 'Asia/Baku',                       2011,2,27,0,0,0,      300, 1 ]/* STD: 240 */,

    [ 'Asia/Yekaterinburg',              2011,2,26,21,0,0,     360, 1 ]/* STD: 300 */,

    [ 'Asia/Omsk',                       2011,2,26,20,0,0,     420, 1 ]/* STD: 360 */,

    [ 'Asia/Krasnoyarsk',                2011,2,26,19,0,0,     480, 1 ]/* STD: 420 */,

    [ 'Asia/Irkutsk',                    2011,2,26,18,0,0,     540, 1 ]/* STD: 480 */,

    [ 'Asia/Yakutsk',                    2011,2,26,17,0,0,     600, 1 ]/* STD: 540 */,

    [ 'Australia/Adelaide',              2011,9,1,16,30,0,     630, 1 ]/* STD: 570 */,

    [ 'Asia/Vladivostok',                2011,2,26,16,0,0,     660, 1 ]/* STD: 600 */,
    [ 'Australia/Lord_Howe',             2011,9,1,15,30,0,     660, 1 ]/* STD: 630 */,
    [ 'Australia/Sydney',                2011,9,1,16,0,0,      660, 1 ]/* STD: 600 */,

    [ 'Pacific/Fiji',                    2011,2,5,14,0,0,      720, 1 ]/* STD: 660 */,
    [ 'Pacific/Fiji',                    2011,2,26,14,0,0,     720, 1 ]/* STD: 660 */,
    [ 'Asia/Kamchatka',                  2011,2,26,15,0,0,     720, 1 ]/* STD: 660 */,

    [ 'Pacific/Auckland',                2011,8,24,14,0,0,     780, 1 ]/* STD: 720 */,

    [ 'Pacific/Chatham',                 2011,8,24,14,0,0,     825, 1 ]/* STD: 765 */,

// AND THEN NON-DST TIMEZONES: 

    [ 'Etc/GMT+12',                      2011,0,1,0,0,0,       -720, 0 ]/* STD: -720 */,

    [ 'Pacific/Pago_Pago',               2011,0,1,0,0,0,       -660, 0 ]/* STD: -660 */,

    [ 'Pacific/Kiritimati',              2010,0,1,0,0,0,        840, 0, '(LINT)' ], /* To prevent Firefox detecting Pacific/Kiritimati as Pacific Honolulu */
    [ 'Pacific/Honolulu',                2011,0,1,0,0,0,       -600, 0 ]/* STD: -600 */,

    [ 'Pacific/Marquesas',               2011,0,1,0,0,0,       -570, 0 ]/* STD: -570 */,

    [ 'Pacific/Gambier',                 2011,0,1,0,0,0,       -540, 0 ]/* STD: -540 */,

    [ 'Pacific/Pitcairn',                2011,0,1,0,0,0,       -480, 0 ]/* STD: -480 */,

    [ 'America/Phoenix',                 2011,0,1,0,0,0,       -420, 0 ]/* STD: -420 */,

    [ 'America/Guatemala',               2011,0,1,0,0,0,       -360, 0 ]/* STD: -360 */,

    [ 'America/Bogota',                  2011,0,1,0,0,0,       -300, 0 ]/* STD: -300 */,

    [ 'America/Caracas',                 2011,0,1,0,0,0,       -270, 0 ]/* STD: -270 */,

    [ 'America/Santo_Domingo',           2011,0,1,0,0,0,       -240, 0 ]/* STD: -240 */,

    [ 'America/Argentina/Buenos_Aires',  2011,0,1,0,0,0,       -180, 0 ]/* STD: -180 */,

    [ 'America/Noronha',                 2011,0,1,0,0,0,       -120, 0 ]/* STD: -120 */,

    [ 'Atlantic/Cape_Verde',             2011,0,1,0,0,0,       -60, 0 ]/* STD: -60 */,

    [ 'Africa/Casablanca',               2011,0,1,0,0,0,       0, 0 ]/* STD: 0 */,

    [ 'Africa/Lagos',                    2011,0,1,0,0,0,       60, 0 ]/* STD: 60 */,

    [ 'Africa/Johannesburg',             2011,0,1,0,0,0,       120, 0 ]/* STD: 120 */,

    [ 'Asia/Baghdad',                    2011,0,1,0,0,0,       180, 0 ]/* STD: 180 */,

    [ 'Asia/Dubai',                      2011,0,1,0,0,0,       240, 0 ]/* STD: 240 */,

    [ 'Asia/Kabul',                      2011,0,1,0,0,0,       270, 0 ]/* STD: 270 */,

    [ 'Asia/Karachi',                    2011,0,1,0,0,0,       300, 0 ]/* STD: 300 */,

    [ 'Asia/Kolkata',                    2011,0,1,0,0,0,       330, 0 ]/* STD: 330 */,

    [ 'Asia/Kathmandu',                  2011,0,1,0,0,0,       345, 0 ]/* STD: 345 */,

    [ 'Asia/Dhaka',                      2011,0,1,0,0,0,       360, 0 ]/* STD: 360 */,

    [ 'Asia/Rangoon',                    2011,0,1,0,0,0,       390, 0 ]/* STD: 390 */,

    [ 'Asia/Jakarta',                    2011,0,1,0,0,0,       420, 0 ]/* STD: 420 */,

    [ 'Asia/Shanghai',                   2011,0,1,0,0,0,       480, 0 ]/* STD: 480 */,

    [ 'Australia/Eucla',                 2011,0,1,0,0,0,       525, 0 ]/* STD: 525 */,

    [ 'Asia/Tokyo',                      2011,0,1,0,0,0,       540, 0 ]/* STD: 540 */,

    [ 'Australia/Darwin',                2011,0,1,0,0,0,       570, 0 ]/* STD: 570 */,

    [ 'Australia/Brisbane',              2011,0,1,0,0,0,       600, 0 ]/* STD: 600 */,

    [ 'Pacific/Noumea',                  2011,0,1,0,0,0,       660, 0 ]/* STD: 660 */,

    [ 'Pacific/Norfolk',                 2011,0,1,0,0,0,       690, 0 ]/* STD: 690 */,

    [ 'Pacific/Tarawa',                  2011,0,1,0,0,0,       720, 0 ]/* STD: 720 */,

    [ 'Pacific/Tongatapu',               2011,0,1,0,0,0,       780, 0 ]/* STD: 780 */,

    [ 'Pacific/Kiritimati',              2011,0,1,0,0,0,       840, 0 ]/* STD: 840 */
)

function get_timezone_id()
{
    var tz="";
    for (var i in zones)
    {
        olson_name = zones[i][0];
        has_transitions = zones[i][8];

        date_1 = new Date(Date.UTC(zones[i][1],zones[i][2],zones[i][3],zones[i][4],zones[i][5],zones[i][6]));
        date_1_offset_data = zones[i][7];
        date_1_offset_user = -date_1.getTimezoneOffset();

        date_2 = new Date(Date.UTC(zones[i][1],zones[i][2],zones[i][3],zones[i][4],zones[i][5],zones[i][6]) - 1000);
        date_2_offset_user = -date_2.getTimezoneOffset();

        var patt1=/\([^)]+\)/g;
        if (zones[i][9] != undefined) var abbr = zones[i][9]; // To determine Pacific/Kiritimati in Firefox
        else var abbr = "";

        if
        (   
            abbr == date_1.toString().match(patt1)
            // Detect timezones that has transitions
            || (has_transitions &&  date_1_offset_user == date_1_offset_data && date_2_offset_user != date_1_offset_data)
            // Detect timezones that has not transitions
            || (!has_transitions && date_1_offset_data == date_1_offset_user)
        )
        {
            tz = olson_name;
            return tz;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T22:18:44.177

您必须在 Javascript 中设置 zoneinfo 数据的数组或散列，并根据您获取的时间确定名称。

# c# - 在当前控制器动作执行完成后调用另一个控制器动作

> ID：608430
> 
> 赞同：1
> 
> 时间：2009-03-03T22:11:17.083
> 
> 标签：c#, asp.net-mvc, viewengine

我想要达到的目标：

1.  在**每个**视图完成执行后，我想对外部合作伙伴进行单独的 http 调用。

2.  我需要将视图的内容之一作为该 http 调用的正文传递。

到目前为止我所拥有的：

我有一个基本控制器，我的所有控制器都从该控制器继承。

我发现我可以覆盖基本控制器的 onActionExecuted() 方法并在那里编写我的伙伴 http 调用代码，以便在每个操作之后执行它。

[在阅读了Send asp.net mvc action result inside email](https://stackoverflow.com/questions/520863/send-asp-net-mvc-action-result-inside-email)的文章后，我写了一个自定义结果。这使我能够获取视图的内容。（它是另一个控制器的一部分，它也继承自基本控制器）。

我无法弄清楚：

1.  如何调用控制器操作（将为 http 调用主体呈现内容的操作）以获取基本控制器 onActionExecuted() 方法中的内容？

阿尼尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-12T01:54:53.153

这将从同一个控制器中的第一个控制器动作中调用第二个控制器动作：

```
 public ActionResult FirstAction()
    {
        // Do FirstAction stuff here.
        return this.SecondAction(ArgumentsIfAny);
    }

    public ActionResult SecondAction()
    {
        // Do SecondAction stuff here.
        return View();
    } 
```

不需要太复杂。:-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T22:24:56.393

大多数 MVC 框架的想法是让事情变得更简单。一切都分解为对具有某些输入和某些返回值的方法的调用。在某种程度上，您可以通过执行以下操作来完成您想要的：

```
class MyController {
  public ActionResult Action1() {
    // Do stuff 1
  }

  public ActionResult Action2() {
    // Do stuff 2
  }
} 
```

然后你可以重构一下：

```
class MyController {
  public ActionResult Action1() {
    // Pull stuff out of ViewData

    DoStuff1(param1, param2, ...);
  }

  public ActionResult Action2() {
    DoStuff2(param1, param2, ...);
  }

  public void DoStuff1(/* parameters */) {
    // Do stuff 1
  }

  public void DoStuff2(/* parameters */) {
    // Do stuff 2
  }
} 
```

现在您可以直接调用 DoStuff1() 和 DoStuff2() 因为它们只是方法。如果可能，您可以将它们设为静态。不要忘记您可能需要对错误检查和返回类型做一些事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T00:46:51.443

```
 protected override void OnActionExecuted(ActionExecutedContext filterContext)
    {
        base.OnActionExecuted(filterContext);

            this.ViewData.Model = GLB_MODEL;
            Stream filter = null;
            ViewPage viewPage = new ViewPage();
            viewPage.ViewContext = new ViewContext(filterContext.Controller.ControllerContext, new WebFormView("~/Views/Customer/EmailView.aspx", ""), this.ViewData, this.TempData);
            var response = viewPage.ViewContext.HttpContext.Response;
            response.Clear();
            var oldFilter = response.Filter;

            try
            {
                filter = new MemoryStream();
                response.Filter = filter;

                viewPage.ViewContext.View.Render(viewPage.ViewContext, viewPage.ViewContext.HttpContext.Response.Output);
                response.Flush();

                filter.Position = 0;
                var reader = new StreamReader(filter, response.ContentEncoding);
                string html = reader.ReadToEnd();
            }
            finally
            {
                if (filter != null)
                {
                    filter.Dispose();
                }
                response.Filter = oldFilter;
            }

    } 
```

这是[Render a view as a string](https://stackoverflow.com/questions/483091/render-a-view-as-a-string)中代码的修改版本。我不想将视图的结果呈现给 httpcontext 响应流。

# sql-server - 为 SqlServer Express 使用自己的实例？

> ID：608433
> 
> 赞同：0
> 
> 时间：2009-03-03T22:13:15.750
> 
> 标签：sql-server, sql-server-2005, sql-server-express

我目前正在开发一个需要将数据存储在数据库中的应用程序，我目前正在使用*带有高级服务的 SQL Server Express 2005*（因为我们需要全文搜索功能）。

当地公司的传说说，几年前，当两个产品使用带有默认实例的 MS SQL Server 时，出现了各种奇怪的问题，他们有有趣的时间清理一切，使每个应用程序都使用一个命名实例。

因为我不记得他们遇到的确切问题......对于必须以稳定方式运行而不受其他应用程序干扰的应用程序将其数据库放在自己的命名实例中是否可取？如果是这样，为什么？与将数据库附加到默认实例（甚至使用 watchacallit - 用户实例？ - 您在连接字符串中指定 mdb 文件位置的位置）相比，这给了我什么额外的隔离。

***更新：***

我主要关心的不是性能/CPU——我说的是一个管理大型组织前台人员/客人的应用程序，例如酒店。我认为即使是 SQLite 也可以轻松处理我需要的数据量（忽略全文搜索等一些功能）。

我主要关心的是客户安装的东西会干扰。从 Mitchell 的回答和 John 的评论来看，我认为最好留在一个命名的实例中 - 但如果你有更多的理由，请说出他们的意见。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T22:18:16.817

一些东西。

1.  使用附加数据库（用户实例数据库）是管理员管理的皇家 PITA，因为它们必须附加才能从 SSMS 等访问。

2.  将单个应用程序放在它们自己命名的 SQL Server 实例上将为每个应用程序创建单独的进程，从而为每个应用程序隔离资源和内存空间。

每个应用程序真的有必要拥有自己的 SQL Server 实例吗？不，我会说通常不是，除非它真的是 100% 关键任务，但是，如果它是如此关键，如果它正在运行 SQL Express，我会感到惊讶。

I would recommend though from a maint. perspective that you use a standard database, rather than a user instance.

# http - HTTP 压缩问题？

> ID：608445
> 
> 赞同：2
> 
> 时间：2009-03-03T22:15:48.570
> 
> 标签：http, jboss, compression

我们正在研究在 JBoss 提供的应用程序上使用 HTTP 压缩。在 Tomcat SAR 中进行设置更改后，我们看到大约 80% 的压缩 - 这显然很棒，但是我想谨慎... 在实施这个系统范围之前，有没有人遇到过使用 HTTP 压缩的问题？

我的情况需要注意几点。

*   我们完全控制浏览器 - 所以整个公司都使用 IE6/7
*   该应用程序仅供内部使用
*   在负载测试期间，我们的应用服务器的负载相对较小——数据库是我们的瓶颈
*   我们可以控制客户端机器，它们都得到了规格检查（体面的处理器/2GB RAM）

任何与此相关的经验将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T01:51:33.963

压缩不被认为是异国情调或前沿，（fwiw）我没有听说过或遇到任何问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T01:54:21.430

动态压缩会增加服务器上的 CPU 负载。如果可能的话，预压缩静态资源和缓存压缩的动态响应可以解决这个问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T02:08:41.207

这只是一个非常好的主意。它会给您的服务器增加轻微的 CPU 负载，但这通常不是您的瓶颈。它将使您的页面加载速度更快，并且您将使用更少的带宽。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T01:57:20.907

只要您`Accept-Encoding`正确尊重客户端的标头（即不要将压缩文件提供给无法解压缩它们的客户端），您就不会有问题。

哦，记住[deflate 比 gzip 快](http://www.codinghorror.com/blog/archives/001178.html)。

# asp.net - 为什么我的制表符转换为 cookie 中的空格？

> ID：608449
> 
> 赞同：0
> 
> 时间：2009-03-03T22:16:51.157
> 
> 标签：asp.net, cookies

我正在使用 Context.Request.Cookies 对象来读取/写入 cookie。

我只是在写一行由制表符 ('\t') 分隔的文本。当我通过 Visual Studio 2008 调试器读回 cookie 时，cookie 对象立即包含字符串值，但所有制表符都转换为空格。

当我发布到生产环境时，它似乎没有转换标签。什么会在VS中导致这种情况？这会发生在生产中的某些机器上吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T02:07:35.687

尝试使用 URL 编码来查看是否保留选项卡。

# php - 使用 scandir() 在目录中查找文件夹 (PHP)

> ID：608450
> 
> 赞同：32
> 
> 时间：2009-03-03T22:17:01.983
> 
> 标签：php, directory

我正在使用这段代码：

```
$target = 'extracted/' . $name[0];  
$scan = scandir($target); 
```

扫描用于 zip 上传的文件夹的目录。我希望能够找到我`$target`文件夹中的所有文件夹，以便删除它们及其内容，只留下目录中的`$target`文件。

返回文件夹的内容后，我不知道如何区分文件夹和文件以删除文件夹。

另外，我被告知该`rmdir()`功能无法删除其中包含内容的文件夹，有什么办法解决这个问题吗？

谢谢，本。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-03-03T22:31:34.053

要确定您是否有文件夹或文件，请使用函数`is_dir()`和`is_file()`

例如：

```
$path = '提取/' 。$名称[0]；
$results = scandir($path);

foreach ($results 作为 $result) {
    if ($result === '.' 或 $result === '..') 继续；

    if (is_dir($path . '/' . $result)) {
        //使用if目录的代码
    }
}

```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2011-03-11T13:11:27.717

最好使用[DirectoryIterator](http://www.php.net/manual/en/class.directoryiterator.php)

```
$path = 'extracted'; // '.' for current
foreach (new DirectoryIterator($path) as $file) {
    if ($file->isDot()) continue;

    if ($file->isDir()) {
        print $file->getFilename() . '<br />';
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-03T22:24:03.603

首先，rmdir() 无法删除包含内容的文件夹。如果安全模式被禁用，您可以使用以下内容。

```
exec("rm -rf folder/"); 
```

另请查看 is_dir()/is_file() 甚至更好的[PHP SPL](http://www.php.net/~helly/php/ext/spl/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-07-14T13:28:33.700

```
$directories = scandir('images');
foreach($directories as $directory){
    if($directory=='.' or $directory=='..' ){
        echo 'dot';
    }else{
            if(is_dir($directory)){
                  echo $directory .'<br />';
            }
    }
} 
```

一个更简单，也许更快的版本

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-06-20T14:02:00.043

**获取所有子、子文件夹中的所有文件**

```
function myfunction($dir){

foreach ($dir as $dirname => $file) {

if(is_dir($file) &&  $file != '.' &&  $file != '..' ) { 

     // echo $file;
      $newDir = scandir($file);
      myfunction($newDir);

    }elseif($file !='.' && $file != '..'){

        echo "<br>File name is ---";
        echo  $file;
    }

} // end foreach

}  //function ends 

$dirpass = scandir($mypath3); // set directory
echo myfunction($dirpass); //     pass directory 
```

我们将得到如下结果（请忽略文件名）

```
File name is ----->index.PHP
File name is -----> 100000045   Invoices   Sales   Magento Admin.png
File name is -----> 100000142   Orders   Sales   Magento Admin(1).png
File name is -----> 100000142   Orders   Sales   Magento Admin.png
File name is ----->hrc-siberian-tiger-2-jpg_21253111.jpg
File name is ----->images (3rd copy).jpeg
File name is ----->images (4th copy).jpeg
File name is ----->images (5th copy).jpeg
File name is ----->images (another copy).jpeg
File name is ----->images (copy).jpeg
File name is ----->images.jpeg
File name is ----->JPEG_example_JPG_RIP_100.jpg
File name is ----->preload
File name is ----->Stonehenge (3rd copy).jpg
File name is ----->Stonehenge (4th copy).jpg
File name is ----->Stonehenge (5th copy).jpg
File name is ----->Stonehenge (another copy).jpg
File name is ----->Stonehenge (copy).jpg
File name is ----->Stonehenge.jpg 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-10-07T13:32:33.383

scandir 会扫描整个目录，可以手动过滤。

但如果你像我一样懒惰，那就用 glob

```
$scan = glob($target."/*",GLOB_ONLYDIR); 
```

它将输出一个包含目标所有目录的数组。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-01-27T04:14:15.787

快速而肮脏的方式：

```
$folders = glob("<path>/*", GLOB_ONLYDIR); 
```

一个更通用和面向对象的解决方案，灵感来自使用 DirectoryIterator 的早期答案，但更简洁和通用：

```
 $path = '<path>';
    $folders = [];

    foreach (new \DirectoryIterator($path) as $file)
    {
        if (!$file->isDot() && $file->isDir())
        {
            $folders[] = $file;
        }
    } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-10-08T07:21:03.790

如果项目位于该目录中，您还想删除它们。rmdir 不允许您删除包含文件的目录。但是有一个简单的解决方案。

```
array_map('unlink', glob($target.'/*/*'));
array_map('rmdir',glob($target."/*",GLOB_ONLYDIR)); 
```

首先，它将取消链接所有子目录中的所有文件。
其次，它将删除所有目录，因为它们不包含文件。

如果您有子子目录，那么您应该添加另外 2 行，如下所示：

```
array_map('unlink', glob($target.'/*/*/*')); //remove sub-sub-files
array_map('rmdir',glob($target."/*/*",GLOB_ONLYDIR)); //remove sub-sub-directories

array_map('unlink', glob($target.'/*/*')); //remove sub-files
array_map('rmdir',glob($target."/*",GLOB_ONLYDIR)); //remove sub-directories 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-03-06T11:39:52.460

这是我主要用来解析档案和目录的一个函数

```
function scan_full_dir($dir,$child=false){
    $dir_content_list = scandir($dir);
    foreach($dir_content_list as $value) 
    { 
        if($value === '.' || $value === '..') {continue;} 
        // check if we have file 
         if(is_file($dir.'/'.$value)) {
            echo '<br> File Name --> '.$value;
            continue; 
         }
        // check if we have directory
        if (is_dir($dir.'/'.$value)) {
            if(!$child){ 
                echo '<br> parent --> '.$value;
            }else{
                echo '<br> child of '.$child.' --> '.$value;    
            }
            scan_full_dir($dir.'/'.$value,$value);
        }       
    }   
} 
```

输出样本

```
parent --> fonts
File Name --> standard
parent --> steps
child of steps --> pcb
File Name --> .attrlist.sum
File Name --> .profile.sum
File Name --> .stephdr.sum
File Name --> attrlist
child of pcb --> netlists
child of netlists --> cadnet
File Name --> .netlist.sum
File Name --> netlist
File Name --> profile
File Name --> stephdr 
```

// 扫描目录

```
scan_full_dir('path/of/myfolder'); 
```

// 无需打开即可扫描存档，支持的格式：gz、zip、tar 和 bz 文件。

```
scan_full_dir('phar://uploads/youarchive.zip); 
```

# sql - 从可能产生多条记录的连接表中获取单条记录

> ID：608451
> 
> 赞同：2
> 
> 时间：2009-03-03T22:17:20.623
> 
> 标签：sql, select, grouping, user-defined-functions, group-by

我有一个学生表和一个招生表；一个学生可以有多个注册记录，这些记录可以是活动的，也可以是非活动的。

我想得到一个选择，它有一个学生记录和一个关于该学生是否有活跃注册的指标。

我曾考虑在一个内联 UDF 中执行此操作，该 UDF 使用学生 ID 连接到注册表，但我想知道是否有更好的方法在单个 select 语句中执行此操作。

UDF 调用可能类似于：

```
Select Student_Name,Student_Email,isEnrolled(Student_ID) from Student 
```

替代方案（使用一条 SQL 语句）可能是什么样的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T22:38:14.427

```
select  Student_Name,
        Student_Email,
        (select count(*) 
         from Enrollment e 
         where e.student_id = s.student_id
        ) Number_Of_Enrollments 
 from Student e 
```

将获得注册人数，这应该会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T22:47:03.517

为什么不加入辅助选择？与其他解决方案不同，这不是为返回的每一行触发子查询，而是一次为每个人收集注册数据。语法可能不太正确，但你应该明白了。

```
SELECT
    s.student_name,
    s.student_email,
    IsNull( e.enrollment_count, 0 )
FROM
    Students s
LEFT OUTER JOIN (
        SELECT
            student_id,
            count(*) as enrollment_count
        FROM
            enrollments
        WHERE
            active = 1
        GROUP BY
            student_id
    ) e
ON s.student_id = e.student_id 
```

从注册中选择也可以作为一个函数重做，它返回一个表供您加入。

```
CREATE FUNCTION getAllEnrollmentsGroupedByStudent()
RETURNS @enrollments TABLE
(
    student_id       int,
    enrollment_count int
) AS BEGIN
    INSERT INTO
        @enrollments
    (
        student_id,
        enrollment_count
    ) SELECT
        student_id,
        count(*) as enrollment_count
    FROM
        enrollments
    WHERE
        active = 1
    GROUP BY
        student_id

    RETURN
END

SELECT
    s.student_name,
    s.student_email,
    e.enrollment_count
FROM
    Students s
JOIN 
    dbo.getAllEnrollmentsGroupedByStudent() e
ON  s.student_id = e.student_id 
```

**编辑：**
Renze de Waal 纠正了我的错误 SQL！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T22:21:04.547

尝试这样的事情：

```
SELECT Student_Name, Student_Email, CAST((SELECT TOP 1 1 FROM Enrollments e WHERE e.student_id=s.student_id) as bit) as enrolled FROM Student s 
```

我认为您也可以在 select 中使用 exists 语句但不是肯定的

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T22:50:49.717

尽量避免使用 udf 或子查询，它们是性能杀手。banjolity 似乎有一个很好的解决方案，因为它使用派生表而不是 UDF 或子选择。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T23:43:33.583

```
 select students.name, 
decode(count(1), 0, "no enrollments", "has enrollments")
     from students, enrollments 
     where 
       students.id = enrollments.sutdent_id and 
       enrollments.is_active = 1 group by students.name 
```

当然，将 decode 替换为您的数据库使用的函数（或 case 语句）。

# c# - C# URLDecode 将 %5C 变成 \\\\ 而不是 \

> ID：608453
> 
> 赞同：0
> 
> 时间：2009-03-03T22:18:02.463
> 
> 标签：c#, javascript, encoding

我有一个将网络登录（字符串）作为参数的 Web 服务方法。登录是从 JavaScript 编码的 URL，因此 DOMAIN\USERNAME 被编码为 DOMAIN%5CUSERNAME。当我在字符串上使用 HttpUtility.URLDecode 时，它​​会转义反斜杠并给我 DOMAIN\\USERNAME。我试图将其传递给配置文件提供程序（它只需要一个反斜杠）并且什么也没得到。

我试图做 string.Replace() 以及 RegEx.Replace() 并且似乎无法摆脱第二个反斜杠。

有谁知道解决这个问题的方法？目前，这只是一个概念证明，因为我不喜欢将网络用户名作为参数发布；但是，我仍然很想知道解决这个问题的方法。如果我不能从 C# 解决这个问题，我可以/应该在 JavaScript 端使用不同的编码方案吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-03T22:20:50.523

它实际上并没有把它变成`\\`. 这就是它在调试器下的样子。如果您想将其放入代码中，调试器会向您显示必须使用的字符串文字。如果您将字符串打印到控制台，您会发现它很好。

```
using System;
using System.Web;

class Test
{
    static void Main()
    {
        string url = "DOMAIN%5CUSERNAME";
        string decoded = HttpUtility.UrlDecode(url);

        Console.WriteLine(decoded);
    }
} 
```

输出：

```
DOMAIN\USERNAME 
```

# c# - 带有 XML 文件的实体框架

> ID：608477
> 
> 赞同：49
> 
> 时间：2009-03-03T22:22:29.177
> 
> 标签：c#, .net, xml, entity-framework

有人可以指出一个很好的教程来解释使用 XML 文件而不是数据库的实体框架吗？我看过一些关于 SQL 数据库的好教程，但我无法跳转到 XML 文件。

谢谢！

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-03-03T22:32:32.210

Entity Framework 本身是基于提供者的，*旨在*通过关系数据库进行操作。如果您真的想要，您可以编写自己的 EF 提供程序来读取/写入 xml 文件，但这将是*大量*工作。

我希望你真的应该看以下之一：

*   LINQ 到 XML
*   XML（反）序列化
*   XPath/XQuery
*   XSLT

实体框架不*适合*这种情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T23:24:39.730

Linq to XML 实际上并没有那么多。我会使用可序列化的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-21T01:02:43.737

我喜欢 LINQ to XSD： http: [//linqtoxsd.codeplex.com/](http://linqtoxsd.codeplex.com/)

它基本上是 LINQ to XML，带有一些从 XSD 派生的类，以确保它适合架构......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T22:28:18.273

我不认为这真的可能。

来自[MSDN](http://msdn.microsoft.com/en-us/library/bb399572.aspx)（重点是我的）：

> ADO.NET 实体框架旨在使开发人员能够通过针对概念应用程序模型进行编程而不是直接针对*关系存储架构*进行编程来创建数据访问应用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-31T21:09:29.070

您可以将 oledb 连接与 FORXML 命令一起使用...但您不会拥有其他提供程序提供的所有功能...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-08-26T20:11:08.143

*   问题是您需要基于文件的数据存储吗？如果是这样，您可以使用 SimpleDB 数据提供程序。如果您需要一个文件中的关系数据库，SimpleDB 非常棒。MS Access 也非常适合这一点。

*   XML 是为通信而设计的。如果用于存储，则效率极低。最好将这两个任务分开并将数据存储在关系数据库中，然后从数据中生成 XML。

# asp.net - 在 ASP.NET 中流式传输文件的最佳方式

> ID：608480
> 
> 赞同：35
> 
> 时间：2009-03-03T22:22:43.483
> 
> 标签：asp.net, flash, streaming, video-streaming

使用 ASP.NET 流式传输文件的最佳方式是什么？

似乎有多种方法可以解决这个问题，我目前在 http 处理程序中使用[Response.TransmitFile()](http://msdn.microsoft.com/en-us/library/12s31dhy(v=vs.110).aspx)方法，该方法将文件直接发送到浏览器。这用于各种事情，包括将 FLV 从 webroot 外部发送到嵌入式 Flash 视频播放器。

但是，这似乎不是一个可靠的方法。特别是*Internet Explorer (7)*有一个奇怪的问题，浏览器在观看一两个视频后就挂起。点击任何链接等都没有任何效果，让网站再次正常工作的唯一方法是关闭浏览器并重新打开它。

这也发生在其他浏览器中，但频率要低得多。基于一些基本测试，我怀疑这与文件流式传输的方式有关......也许连接没有正确关闭，或者类似的东西。

在尝试了一些不同的事情之后，我发现以下方法对我有用：

```
Response.WriteFile(path);
Response.Flush();
Response.Close();
Response.End(); 
```

这解决了上述问题，并且观看视频不再导致 Internet Explorer 挂起。

但是，我的理解是[Response.WriteFile()](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.writefile(v=vs.110).aspx)首先将文件加载到内存中，并且鉴于某些正在流式传输的文件可能非常大，这似乎不是一个理想的解决方案。

我有兴趣了解其他开发人员如何在 ASP.NET 中流式传输大文件，尤其是流式传输 FLV 视频文件。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-03-04T03:45:59.070

我会把东西放在“aspx”管道之外。特别是，我会编写一个运行的处理程序（ashx，或通过配置映射），它做*最少*的工作，并简单地以块的形式写入响应。处理程序将正常接受来自查询字符串/表单的输入，定位要流式传输的对象，并流式传输数据（在循环中使用中等大小的本地缓冲区）。一个简单（不完整）的示例如下所示：

```
public void ProcessRequest(HttpContext context) {
    // read input etx
    context.Response.Buffer = false;
    context.Response.ContentType = "text/plain";
    string path = @"c:\somefile.txt";
    FileInfo file = new FileInfo(path);
    int len = (int)file.Length, bytes;
    context.Response.AppendHeader("content-length", len.ToString());
    byte[] buffer = new byte[1024];
    Stream outStream = context.Response.OutputStream;
    using(Stream stream = File.OpenRead(path)) {
        while (len > 0 && (bytes =
            stream.Read(buffer, 0, buffer.Length)) > 0)
        {
            outStream.Write(buffer, 0, bytes);
            len -= bytes;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-04T04:08:52.637

看看下面的文章[在 ASP.NET 中跟踪和恢复大文件下载](http://www.devx.com/dotnet/Article/22533/1954?pf=true)，它将为您提供更深入的内容，而不仅仅是打开一个流并删除所有位。

http 协议支持范围字节请求和可恢复下载，许多流媒体客户端（如视频播放器或 Adob​​e pdf）可以并且将尝试将它们分块，从而节省带宽并为您的用户提供更好的体验。

不是微不足道的，但它的时间花得很好。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-03T22:29:59.720

尝试将文件作为流打开，然后使用 Response.OutputStream.Write()。例如：

**编辑：**我的错，我忘记了 Write 需要一个字节缓冲区。固定的

```
byte [] buffer = new byte[1<<16] // 64kb
int bytesRead = 0;
using(var file = File.OpenRead(path))
{
   while((bytesRead = file.Read(buffer, 0, buffer.Length)) != 0)
   {
        Response.OutputStream.Write(buffer, 0, bytesRead);
   }
}
Response.Flush();
Response.Close();
Response.End(); 
```

**编辑2：**你试过这个吗？它应该工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T05:26:42.237

在尝试了许多不同的组合（包括各种答案中发布的代码）之后，似乎在调用 TransmitFile 之前设置 Response.Buffer = true 就可以了，并且 Web 应用程序现在在 Internet Explorer 中的响应速度更快。

在这种特殊情况下，SWF 扩展也映射到 ASP.NET，我们在 Web 应用程序中使用自定义处理程序从磁盘读取文件，然后使用 Response.TransmitFile() 将它们发送到浏览器。我们有一个基于 Flash 的视频播放器来播放也是 SWF 的视频文件，我认为让所有这些活动都通过处理程序而不进行缓冲可能会导致 IE 中发生奇怪的事情。

# git - 哪些文档应该存储在版本控制中，它们应该如何存储？

> ID：608482
> 
> 赞同：27
> 
> 时间：2009-03-03T22:23:02.297
> 
> 标签：git, version-control, documentation, wiki, diagram

我发现了一些类似的问题（[此处](https://stackoverflow.com/questions/502716/how-to-best-version-design-documents)、[此处](https://stackoverflow.com/questions/36820/version-control-for-word-documents)和[此处](https://stackoverflow.com/questions/29810/is-version-control-ie-subversion-applicable-in-document-tracking)）询问有关将文档存储到版本控制中的问题。我有更具体的要求和一般性问题。具体要求是我要使用Git。更普遍的问题是，文档（用于项目的设计、测试、一般实践、技巧等）应该如何存储在 Git 中？更广泛地说，应该存储哪些文件？

我可以想到几个方法：

1.  Word / 打开 Office 文档。新的 Office Word 具有 docx 格式，可以压缩文档，但它也具有解压缩的 XML 格式，可用于在 Git 中有效地存储差异。diff 功能仍然被破坏，因为 XML 被压缩在一行上。这并不比将二进制文件存储到 Git 中更好。
2.  维基。那里有哪些分布式维基？这就像某种 Latex 的东西，其中文档被编写和编译/查看为 wiki。
3.  乳胶 - 但从将它用于文件我发现它非常不适合文件。是否有等效的文档？（手册页是如何编写的？）
4.  纯文本格式，但由于缺乏图表，这相当缺乏，这带来了另一点。

视觉应该如何存储？他们首先应该由什么组成？我正在 Linux 环境中开发，但该项目的其他一些参与者在 Windows 上。有什么类似于 Visio 的跨平台解决方案？当然，它不应该创建二进制文件来存储到 Git 中。那么这将如何与文档联系起来呢？（例如，类似于 Latex 在编译时如何引用其他图表。）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T09:03:54.970

在决定选择哪种文档格式时，您应该确保团队成员（或者您是否独自工作？）对格式本身感到满意。

1.  存储与其说是问题，不如说是能够看到版本和合并之间的差异。以我的经验，没有什么比可以在任何文本编辑器中自由编辑的文本格式更好的了。这不包括 HTML 和任何基于 XML 的格式。DocBook 是一个几乎无法使用的例外。

2.  [IkiWiki](http://ikiwiki.info/)是一个可以使用任何流行的版本控制系统并以分布式方式设置的好的 wiki 。使用 IkiWiki，标记解析是在插件中完成的，因此您可以根据每个文档选择输入格式。“默认”，[Markdown](http://daringfireball.net/projects/markdown/)非常接近纯文本格式。

3.  如果您对使用 LaTeX 不满意，请不要使用它。我认为它不适合快速记笔记。手册页是用 nroff 编写的，但许多人使用其他格式，例如[POD](http://perldoc.perl.org/perlpod.html)。

一些努力成为 Visio 替代品的项目是 Kivio (KDE) 和 Dia (Gtk/Gnome)。我没有使用 Visio 本身，所以我无法评论他们的功能集。这可能取决于您要创建什么样的视觉效果/图表。UML？流程图？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T02:55:33.810

我的公司将 Word 文档存储在 SVN 中，并通过 TortoiseSVN 访问它们。

Tortoise 使用 Word 的内置更改跟踪功能向您显示两个修订的“差异”。

这非常有效，但需要 Windows 和 Word。

**编辑：**

您可能也可以使用 git 来实现这一点。如果你安装 TortoiseSVN，然后查看`%PROGRAMFILES%\TortoiseSVN\Diff-Scripts\`，你会看到 Tortoise 在做什么。

如果您使用的是 git，我假设您的 1337 足以破解它为您工作:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-03T22:31:33.507

对于 Word 文档，请尝试使用 RTF（富文本格式），它基本上是文本。另一种可能性是 HTML。它们是文本，因此您应该能够对它们进行比较。

大多数 Wiki 都是为协作而设计的。我认为您实际上是在询问是否有托管解决方案，或者您是否必须管理它们。看看[http://www.atlassian.com/](http://www.atlassian.com/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-03T22:31:03.010

Git 可以像处理文本文件一样处理二进制文件。Git 不是显式存储差异，而是将文件的*整个*先前版本存储在存储库中。然后压缩存储库对象以节省空间。每当您要求差异时，都会即时重建差异。

因此，仅考虑磁盘空间，在 Git 中存储未压缩的 XML Office 文档与存储同一文档的压缩版本之间几乎没有区别。唯一的区别是 Zip 与 Git 选择使用的任何压缩的相对性能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T00:32:25.387

大多数文档格式在源代码控制方面表现不佳。您列出的几乎所有内容要么是有效的二进制格式，要么是难以区分的复杂标记。只要您只想要文档版本而不关心差异，就可以使用您喜欢的任何格式。我更喜欢 Microsoft Word 文档，因为您可以使用内置的更改跟踪和评论系统来跟踪文档之间的差异。

至于要存储哪些文件，我建议存储您以后使用的任何文件。如果您离开，某人可以使用哪些文件来继续该项目？哪些文件有助于让新人快速上手？这意味着规范，而不是燃尽图之类的文档。

要回答您问题的 wiki 部分，请查看[DokuWiki](http://www.dokuwiki.org/dokuwiki)。它将所有内容存储在文本文件中，因此很容易将它们添加到源代码控制系统中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T02:44:34.867

我刚刚接受了这样一个事实，即我无法通过版本控制系统跟踪对二进制文件格式的更改，但我还是使用它，因为它很有用。请注意，通常这些类型的文件中的大多数都是将发布的工作产品（用户指南、文档等）

对于需求和初始设计等早期项目工件，我倾向于使用文本文档——不是因为我可以跟踪更改，而是因为我喜欢使用我的 IDE。

我从来没有真正被版本控制中的更改无法“区分”这一事实“咬伤”。围绕更改重要二进制文档的提交注释和其他文档指南通常弥补了缺乏可见性 - 如果您寻找它，还有另一条线索。

我同意这并不理想，但我认为这真的不值得担心。

也许我刚刚习惯了一组文件的想法，我可以随心所欲地跟踪。

我在版本控制方面做了很多工作，但也对一些具有临时生命周期的东西使用缺陷跟踪。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-08T06:35:54.047

对于OOo，word文档等二进制文件，你应该看看pro-git [http://git-scm.com/book/ch7-2.html](http://git-scm.com/book/ch7-2.html)

# xaml - XAML 标记列表参考

> ID：608487
> 
> 赞同：11
> 
> 时间：2009-03-03T22:24:08.797
> 
> 标签：xaml

正如问题所暗示的，我只是在寻找 XAML 标记列表参考。我已经在 Google/SO 中敲打了明显的查询，但还没有找到我要找的东西。欢迎任何有用的链接。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-03T22:41:29.707

没有 xaml 标记列表之类的东西。

XAML 只是实例化 .Net 类的一种声明方式。类名是 XAML 中的元素，类的属性是使用点表示法的属性或属性元素。

XAML 中的标记仅反映绑定到特定 XAML 命名空间的一个或多个程序集中的类型。

然而，有一组特定的元素特定于 XAML 本身并且与任何特定的 .Net 程序集无关，这些元素通常位于 x: 命名空间中，更多信息请参见：[XAML 命名空间 (x:)](http://msdn.microsoft.com/en-us/library/ms753327.aspx)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-03T22:54:01.393

有一个[WPF 绑定备忘](http://www.nbdtech.com/blog/archive/2009/02/02/wpf-xaml-data-binding-cheat-sheet.aspx)单和另一个[用于 WPF 备忘单的 XAML](http://blog.blueboxes.co.uk/2009/02/03/xaml-for-wpf-cheatsheet/)可能会有所帮助，但实际上 XAML 中的“标签”只是类的属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T09:18:29.863

由于 XAML 是一个开放系统，因此没有 XAML 标记列表**之**类的东西。

但是，有标准的词汇表。[Rob Relyea 的博客](http://blogs.windowsclient.net/rob_relyea)是跟踪这些词汇表标准化的好地方。例如，[这](http://blogs.windowsclient.net/rob_relyea/archive/2008/10/14/ms-slxv-silverlight-xaml-vocabulary-2008-specification-v0-9-published.aspx)是 Silverlight XAML 词汇表的条目。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-03T22:31:17.313

使用 WPF，XAML 元素映射到[StackPanel](http://msdn.microsoft.com/en-us/library/system.windows.controls.stackpanel.aspx)等类。MSDN 似乎为许多控件提供了 XAML 示例。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-03T22:31:40.917

关于表示复杂属性和绑定等内容，存在特定于 XAML 的约定。但是，没有明确的 XAML 标记列表。XAML 标记实际上映射到 WPF 对象。例如，`<Button>`它只是类的 XAML 表示，标签上`System.Windows.Controls.Button`允许的属性是类的公共属性。`<Button>``Button`

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-04-27T21:17:10.410

应该很快就会在[http://www.devsheets.com](http://www.devsheets.com)上提供几个 WPF 备忘单（自 2011 年 9 月左右开始）......您可以在那里下载它，也可以购买包含更详细信息的印刷版本（并非所有内容都适合公开可用的 pdf，因为如果在没有高质量打印的纸上打印 pdf 将无法阅读......这就是为什么我们还决定在免费版本之外销售高质量的层压备忘单打印）

# nhibernate - 休眠代理生成器

> ID：608492
> 
> 赞同：0
> 
> 时间：2009-03-03T22:26:45.780
> 
> 标签：nhibernate, medium-trust

我试图让 nhibernate 在中等信任下工作。我发现说我需要使用代理生成器。我从[nhibernate 的网站上](http://nhforge.org/media/)拉了一个。当我尝试使用它时，我收到一个错误，它无法加载程序集“DynamicProxyGenAssembly2”。有什么我遗漏的东西，还是有一个可以在某处工作的东西。我宁愿不使用生成器，但 nhibernate 似乎别无选择。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T22:38:23.913

据我所知，中等信任度的问题是反射的使用被削弱了一些（尽管我可能完全不在这里）。

似乎您在物理上预先构建代理对象的方法似乎是建议的方法，并且[此链接](http://blechie.com/WPierce/archive/2008/02/17/Lazy-Loading-with-nHibernate-Under-Medium-Trust.aspx) *可能会*有所帮助。

老实说，我在共享托管方面遇到了类似的问题，并决定选择使用提供虚拟服务器的托管服务提供商。这显然消除了中等信任问题，因为它就像拥有一个便宜且令人讨厌的专用服务器供您使用。

我知道这个答案可能不是最好的，但我确实感受到了你的痛苦并想稍微调侃一下。此外，值得一提的是，解答 NHibernate 相关问题的最佳地点是他们的论坛 ( [http://forum.hibernate.org](http://forum.hibernate.org) )。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-09-26T08:00:49.460

我知道这个问题很老了，但我只是想告诉你和其他有这个问题的人，一旦你知道该怎么做，在中等信任环境中运行 NHibernate 真的很容易。您所要做的就是执行以下操作：

1.  从源代码重建城堡并从中获取 dll
2.  使用上一步中的 dll 从源代码重建 NHibernate 并获取 dll
3.  将 dll 添加到您的项目中。

您需要注意 Castle 和 NHibernate 的版本以确保它们可以一起工作，但您不必禁用延迟加载或执行其他任何操作。这是一篇关于它的博客文章，概述了如何在中等信任环境中轻松设置项目： [如何在中等信任环境中运行 NHibernate](http://iamdotnetcrazy.blogspot.com/2010/09/how-to-get-fluent-nhibernate-nhibernate.html)

# c++ - Wine 链接器错误：尝试创建 .lnk

> ID：608507
> 
> 赞同：3
> 
> 时间：2009-03-03T22:31:15.130
> 
> 标签：c++, c, windows, wine, lnk

我正在尝试以编程方式创建一个 .lnk 文件。我更喜欢使用 C，但 C++ 很好（并且是所有 MSDN 的内容）。

相关的代码示例是：

```
#include <windows.h>
#include <shobjidl.h>
#include <shlguid.h>

HRESULT CreateLink(LPCSTR lpszPathObj, LPCSTR lpszPathLink, LPCSTR lpszDesc) {
  HRESULT hres;
  IShellLink* psl;

  /* Get a pointer to the IShellLink interface. */
  hres = CoCreateInstance(CLSID_ShellLink, NULL, CLSCTX_INPROC_SERVER,
                          IID_IShellLink, (LPVOID*)&psl);
  return hres;
} 
```

我正在尝试使用以下方法完成 wineg++：

```
wineg++ -mno-cygwin -o t t2.cpp 
```

我收到以下错误：

```
t2-Tw9YPp.o：在函数“CreateLink(char const*, char const*, char const*)”中：
t2.cpp:(.text+0x34): 对‘IID_IShellLinkA’的未定义引用
/usr/bin/ld: t2-Tw9YPp.o: 重定位 R_386_GOTOFF 针对未定义的隐藏符号 `IID_IShellLinkA' 在制作共享对象时不能使用
/usr/bin/ld：最终链接失败：错误值
collect2: ld 返回 1 个退出状态
winegcc：i486-linux-gnu-g++ 失败

```

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T14:51:28.940

解决方案似乎是将包含部分更改为：

```
#define INITGUID
#include <windows.h>
#include <shobjidl.h>
#include <shlguid.h>
#include <initguid.h> 
```

即，`#define INITGUID`在所有内容之前添加并包括`#include <initguid.h>`

我不知道为什么会这样。

我还必须添加 -lole32 来修复引用的错误解决后出现的错误。

代码编译......现在看看我是否可以让它做我需要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T23:40:17.353

链接器抱怨它不知道在哪里`IID_IShellLinkA`定义。您在标头中有声明，但您可能缺少一个库。我认为它是在*libuuid*中定义的，所以在你的链接命令中包含它`-luuid`。链接器可能被配置为自动包含一组特定的库，包括 kernel32 和 user32，但 uuid 可能不在该列表中。

# c - 初始化指向指针的指针数组

> ID：608511
> 
> 赞同：4
> 
> 时间：2009-03-03T22:31:37.877
> 
> 标签：c, arrays, pointers

这个例子工作正常：

```
static char *daytab[] = {
    "hello",
    "world"
}; 
```

这不会：

```
static char *daytab[] = {
    {0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31},
    {0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}
}; 
```

我看到的方式是，第一个示例创建了一个数组，其中填充了指向两个字符串文字（它们本身就是数组）的指针。第二个例子，IMO，应该是相同的——创建一个数组并用指向两个 char 数组的指针填充它。

有人可以向我解释为什么第二个例子是错误的吗？

PS你可能会这样写（没有测试过）：

```
static char a[] = {0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};
static char b[] = {0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};
static char *daytab[] = {
    a,
    b
}; 
```

但这看起来工作太多了:)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-03T22:49:24.243

这：

```
{0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31} 
```

只是一个数组初始化器。它本身并不创建数组。第一个示例，当您将字符串文字分配给指针时，DID 在静态存储中创建这些字符串（对您隐藏），然后将指针分配给它们。

所以基本上，没有办法用数组初始化器初始化你的 char* 。您需要创建一个实际的数组，并将这些数字分配给它。您必须执行以下操作：

```
char a[][] = { {32, 30, 0}, {34, 32, 33, 0} }; // illegal 
```

但这是非法的。

您需要单独构建数组并将它们分配到一个数组中，就像上一个示例一样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T22:34:59.740

尝试：

```
static char daytab[][13] = {
    {0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31},
    {0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}
}; 
```

那些不是 char* 的。它们也不是炭。你可能想要：

```
static int daytab[][13] ... 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-10T13:59:55.897

好吧，这个线程已经有点老了，但是我正在处理同样的问题并找到了一种方法来初始化指向数组的指针数组，如下所示：

```
#include <iostream>
using namespace std;

int *a[] = {
  (int[]) { 0 } ,
  (int[]) { 1 , 2 } ,
  (int[]) { 3 , 4 , 5 } ,
  (int[]) { 6 , 7 , 8 , 9 }
};

main()
{
  cout
  << a[0][0] << endl
  << a[1][0] << " " << a[1][1] << endl
  << a[2][0] << " " << a[2][1] << " " << a[2][2] << endl
  << a[3][0] << " " << a[3][1] << " " << a[3][2] << " " << a[3][3] << endl;
} 
```

我得到了输出，用 gnu g++ 编译

```
0
1 2
3 4 5
6 7 8 9 
```

并用 intel icpc 编译

```
0
1 1
40896 32767 -961756724
0 32767 4198878 0 
```

因此，语法似乎原则上是正确的，只是英特尔编译器不正确地支持它，可能是由于缺乏这种风格的共同使用。

* * *

- - 编辑 - -

这也是一个 C 版本（根据需要）：

```
#include <stdio.h>

int *a[] = { 
  (int[]) { 0 } , 
  (int[]) { 1 , 2 } , 
  (int[]) { 3 , 4 , 5 } , 
  (int[]) { 6 , 7 , 8 , 9 } 
};

int main()
{
  printf( "%d\n" , a[0][0] );
  printf( "%d %d\n" , a[1][0] , a[1][1] );
  printf( "%d %d %d\n" , a[2][0] , a[2][1] , a[2][2] );
  printf( "%d %d %d %d\n" , a[3][0] , a[3][1] , a[3][2] , a[3][3] );
} 
```

我用 gcc 和 clang 对其进行了测试，它打印出正确的结果。顺便提一句。英特尔编译器的错误输出是编译器错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-02-07T16:16:06.800

```
static char **daytab;
daytab=(char**)malloc(2*sizeof(char*));
daytab[0]=(char*)(char[]){0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};
daytab[1]=(char*)(char[]){0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T23:24:19.607

第二个示例的语法是多维数组文字的语法。

多维数组不是指向数组的指针数组。

如果一件事的语法也是另一件事的语法，这将是令人惊讶的，这取决于它被声明为的类型。

在第一个示例中，因为字符串文字被评估为指针而不是数组值，所以该值被评估为指针数组。因为数组字面量被计算为数组值而不是指针，所以第二个示例是多维数组 - 其元素是数组值的数组，而不是元素是指向数组值的指针的数组。

下面的代码演示了多维数组、数组指针、指针数组和指针指针的组合。在这三个中，只有指针数组和指向指针的指针相互兼容：

```
void multi_array (int x[][4], size_t len) // multidimensional array
{
    for (size_t i = 0; i < len; ++i)
        for (size_t j = 0; j < 4; ++j)
            putchar( 'a' + x[i][j] );
    putchar('\n');
}

void ptr_array (int (*x)[4], size_t len) // pointer to an array
{ ... as multi_array  }

void array_ptr (int *x[], size_t len) // array of pointers
{ ... as multi_array  }

void ptr_ptr (int **x, size_t len) // pointer to pointer
{ ... as multi_array  }

int main() {
    int a[][4] = { { 1,2,3,4 } };
    int b[] = { 1,2,3,4 };
    int* c[] = { b };

    multi_array( a, 1 );
    multi_array( (int[][4]) { { 1,2,3,4} }, 1 ); // literal syntax as value
    ptr_array( &b, 1 );
    array_ptr( c, 1 );
    ptr_ptr( c, 1 ); // only last two are the same

    return 0;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T02:03:02.813

请注意，您的第一个示例也不起作用。它需要是：

```
static const char *daytab[] = {
    "hello",
    "world"
}; 
```

注意*const*。

编辑：“不起作用”，我的意思是不好的做法，容易出错，这可以说是更糟。

# f# - F# 中 Bigint 的平方根

> ID：608514
> 
> 赞同：5
> 
> 时间：2009-03-03T22:32:19.357
> 
> 标签：f#, biginteger

有没有办法得到一个大整数的平方根？我正在处理对于 int64 来说太大而无法处理的数字，所以 bigint 是必须的。

我正在考虑使用巴比伦方法自己实现它的想法，但首先想知道是否有任何内置函数。

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T22:35:44.167

您可以在任何标量上使用牛顿法。

[http://en.wikipedia.org/wiki/Newton%27s_method](http://en.wikipedia.org/wiki/Newton%27s_method)

——马库斯

PS另见[http://en.wikipedia.org/wiki/Methods_of_computing_square_roots](http://en.wikipedia.org/wiki/Methods_of_computing_square_roots)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T23:19:27.357

[祝你平方根日快乐](http://www.sciam.com/blog/60-second-science/post.cfm?id=square-root-day-3309-is-upon-us-2009-03-03):)。

我认为 bigint 中没有内置

# windows - Why are executable files not included in 'Extract All' on one machine, but not another?

> ID：608525
> 
> 赞同：1
> 
> 时间：2009-03-03T22:36:50.267
> 
> 标签：windows, zip, executable, sharpziplib

We're providing a zip file of our application for testing and the same zip file on two separate machines is extracted differently. One will extract all files, the other will extract all but the executables (.exe and .msi specifically).

We're going to have to tell our customers something other than 'use WinZip' (or 7zip, or whatever)

When I look at what is happening using ProcessMonitor, I see that the explorer.exe process is creating each file, then deleting it. WTF?

The two systems are Windows Server 2003 with SP2\. Surely there is a setting that we can point to that explains why this happens.

**UPDATE 1**** I enabled/disabled virus scanning with no noticeable effect.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T22:38:37.220

My guess is it's a virus scanner or other "anti-malware" bit of kit - possibly something to do with group policy?

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-01T12:35:40.177

There was a security patch/setting that one machine had that the other didn't. The zip file needed to be 'unlocked' by looking at the properties.

Until then, no executables/dlls would be extracted from the file.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T12:44:46.390

IIRC, ProcessMonitor has the option to show the stack for the delete event. You would need Windows symbols (or a configured symbol server), but the function names should give you an hint why the executables are deleted.

# c# - 编码指南：如何拆分大型源文件？

> ID：608530
> 
> 赞同：8
> 
> 时间：2009-03-03T22:38:30.993
> 
> 标签：c#, visual-studio, oop, class-design, coding-style

我正在处理的项目刚刚在主 C# 文件中达到 4200 行，这导致 IntelliSense 需要几秒钟（有时长达 6 秒左右）来响应，在此期间 Visual Studio 锁定。我想知道其他人如何拆分他们的文件以及是否有共识。

我试图寻找一些指南并找到了[Google 的 C++ 指南](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml)，但我看不到任何关于语义的信息，例如函数大小和文件大小；也许它就在那里——我有一段时间没看它了。

那么如何拆分文件呢？你是否按照它们所服务的功能对你的方法进行分组？按类型（事件处理程序、私有/公共）？您拆分功能的大小限制是多少？

澄清一下，有问题的应用程序处理数据——所以它的界面是一个大网格，一切都围绕着网格。它有一些用于管理的对话框，但都是关于数据的。它如此之大的原因是有很多错误检查、事件处理以及将网格设置为主从网格，每行多三个网格（但是这些在主行上的负载扩展了）。我希望这有助于澄清我在说什么。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-03T22:42:34.620

我认为您的问题可以用您使用的术语来概括：“主 C# 文件”。

除非您的意思是 main（如在方法 main() 中），否则该概念没有位置。

如果您有一个包罗万象的实用程序类或其他常用方法，您应该将它们分解为类似的功能部分。

通常我的文件只是类的一对一映射。

有时非常相关的类在同一个文件中。

如果您的文件太大，则表明您的课程太大且太笼统。

我尽量将我的方法控制在半屏或更少。（当它是我从头开始编写的代码时，它通常是 12 行或更少，但最近我一直在使用其他开发人员的现有代码并且不得不重构 100 行函数......）

有时它是一个屏幕，但它变得非常大。

编辑：

为了解决您关于函数的大小限制问题 - 对我来说，它与大小无关（尽管这是一个很好的问题指标），而更多的是关于只做一件事并保持每件事简单。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-07T17:29:54.260

在经典著作《[结构化编程](https://rads.stackoverflow.com/amzn/click/com/0122005503)》中，Dijkstra 曾写过一段题为：“论我们无能为力”。他的观点很简单。人类不是很聪明。我们不能同时在脑海中处理多个概念。

保持你的类和方法很小是非常重要的。当一个方法超过十几行时，它应该被分解。当一个类超过几百行时，它应该被分解。这是保持代码良好组织和可管理性的唯一方法。我已经编程了将近 40 年，随着时间的流逝，我意识到“小”这个词在编写软件时的重要性。

至于*如何*做到这一点，这是一个非常大的话题，已经写了很多次。总的来说，这都是关于依赖管理、信息隐藏和面向对象设计的。这是一个阅读清单。

*   [清洁代码](https://rads.stackoverflow.com/amzn/click/com/0132350882)
*   [坚硬的](http://ArticleS.UncleBob.PrinciplesOfOod)
*   [C# 中的敏捷原则、模式和实践](https://rads.stackoverflow.com/amzn/click/com/0131857258)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-03T22:41:46.213

在很自然的地方拆分你的类型——但要注意那些做得太多的类型。大约 500 行（Java 或 C#）我很担心。在大约 1000 行时，我开始努力研究是否应该拆分类型......但有时它不能/不应该。

至于方法：当我一次在屏幕上看不到整个方法时，我不喜欢它。显然，这取决于显示器的大小等，但这是一个合理的经验法则。不过我更喜欢它们更短。同样，也有例外——一些逻辑真的很难解开，特别是如果有很多局部变量自然不想被封装在一起。

*有时，单一类型有很多*方法是有意义的——例如[`System.Linq.Enumerable`](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.aspx)，如果您可以将类型分解为逻辑组（在这种情况下`Enumerable`，通过聚合/集合操作/过滤进行分组），部分类在这种情况下会有所帮助等看起来很自然）。不过，根据我的经验，这种情况很少见。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-03T22:50:07.097

我认为Martin Fowler 的书[Refactoring](http://martinfowler.com/books.html#refactoring)为您提供了一个很好的起点。它指导如何识别“代码异味”以及如何重构代码以修复这些“异味”。自然的结果（尽管它不是主要目标）是您最终得到更小更易于维护的类。

**编辑**

根据您的编辑，我一直坚持后端代码的良好编码实践在表示层中是相同的。一些非常有用的 UI 重构模式是命令、策略、规范和状态。

简而言之，您的视图中应该只包含处理事件和分配值的代码。所有逻辑都应该分离到另一个类中。一旦你这样做了，你会发现你可以重构的地方变得更加明显。网格使这*变得*更加困难，因为它们使得在表示逻辑和视图之间分割表示状态变得太容易了，但是通过一些工作，您可以间接地减少由此造成的痛苦。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-03T22:44:24.350

不要按程序编写代码，您最终不会在一个文件中包含 4,200 行。

在 C# 中，遵循一些[SOLID](https://en.wikipedia.org/wiki/SOLID_%28object-oriented_design%29)面向对象的设计原则是一个好主意。每个班级都应该有一个而且只有一个改变的理由。main 方法应该简单地启动应用程序的起点（并配置您的依赖注入容器，如果您使用的是 StructureMap 之类的东西）。

我通常没有超过 200 行代码的文件，如果它们少于 100 行，我更喜欢它们。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-03T22:57:57.237

没有硬性规定，但普遍认为更多、更短的函数比单个大函数更好，更多更小的类优于 1 个大类。

大于 40 行左右的函数应该让你考虑如何分解它。尤其是嵌套循环，它令人困惑，而且通常很容易转换为具有良好描述性名称的函数调用。

当我觉得他们做的事情不止一件事时，我会分班，比如混合演示和逻辑。一个大类比一个大方法的问题要少，只要这个类做一件事。

我看到的风格指南中的共识是按访问权限对方法进行分组，构造函数和公共方法在顶部。任何一致的东西都很棒。

您应该阅读 C# 样式和重构以真正理解您正在解决的问题。

[Refactoring](http://books.google.com/books?id=1MsETFPD3I0C&dq=refactoring&printsec=frontcover&source=bn&hl=en&ei=DrOtScrnKpO5twfNh4GDBg&sa=X&oi=book_result&resnum=4&ct=result)是一本优秀的书，其中包含重写代码的技巧，以便保留行为，但代码更清晰，更易于使用。

[Elements of C# Style](http://books.google.com/books?id=UbJa11wLcqYC&dq=elements+of+C%23+style&printsec=frontcover&source=bn&hl=en&ei=q7OtSd7tMNW5twfi8OSHBg&sa=X&oi=book_result&resnum=4&ct=result)是一本很好的死树 C# 风格指南，这篇[博](http://blogs.msdn.com/ericgu/archive/2004/01/19/60315.aspx)文有许多指向优秀在线风格指南的链接。

最后，考虑使用[FxCop](http://msdn.microsoft.com/en-us/library/bb429476(VS.80).aspx)和[StyleCop](http://code.msdn.microsoft.com/sourceanalysis)。这些对您提出的问题没有帮助，但可以检测您的代码的其他风格问题。既然你已经把脚趾浸入水中，你不妨跳进去。

这很多，但开发品味、风格和清晰度是优秀开发人员和坏开发人员之间的主要区别。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-03T23:25:43.347

每个班级都应该做一件小事，并且把它做好。你的班级是表格吗？那么它不应该有任何业务逻辑。

它是否代表一个单一的概念，例如用户或状态？然后它不应该有任何绘图，加载/保存等......

每个程序员都会经历阶段和级别。你意识到你当前的水平存在问题，你已经准备好接近下一个水平。

从您所说的情况来看，您当前的水平听起来像是“解决问题”，很可能使用程序代码，您需要开始更多地寻找新的方法来解决它。

我建议研究如何真正进行 OO 设计。您可能听说过许多没有意义的理论。它们不适用的原因是它们不适用于您当前的编程方式。

让我找到一个好帖子...看看这些开始：

[我如何打破我的程序编码习惯](https://stackoverflow.com/questions/559786/how-do-i-break-my-procedural-coding-habits)

[是否有任何规则](https://stackoverflow.com/questions/399656/are-there-any-rules-for-oop)

[面向对象的最佳实践-继承-v-composition-v-interfaces](https://stackoverflow.com/questions/216523/object-oriented-best-practices-inheritance-v-composition-v-interfaces)

还有一些帖子会向您推荐好的 OO 设计书籍。“重构”一书可能是您可以开始的最佳起点之一。

你现在处于一个好点，但你不会相信你必须走多远。我希望您对此感到兴奋，因为在您不久的将来，其中一些东西是您将拥有的最好的编程“学习体验”。

祝你好运。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-03T22:48:30.253

好吧，恐怕你手头的问题可能比加载时间慢。您将遇到紧密耦合的代码和可维护性/可读性问题。

有很好的理由将类文件拆分成更小的文件（同样有充分的理由将文件移动到不同的项目/程序集）。

想想你的班级应该达到什么目的。每个文件实际上应该只有一个目的。如果它的目标过于笼统，例如“包含购物篮逻辑”，那么你就走错了路。

此外，如前所述，您使用的术语：“主要 C# 文件”只是让人觉得您有一种非常程序化的心态。我的建议是停下来，退后一步，快速阅读以下一些主题：

*   通用 OOP 原则
*   领域驱动设计
*   单元测试
*   [国际奥委会](http://en.wikipedia.org/wiki/Inversion_of_control)容器

祝您搜索顺利。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-04T01:07:01.170

你可以寻找一些小的东西来改变，随着时间的推移慢慢改变。

*   是否只在该类中使用了所有方法？寻找可以移出到 helper/util 类中的支持方法，例如验证、字符串操作。

*   您是否使用任何#region 部分？#region 中相关方法的逻辑分组通常有助于将它们拆分为单独的类。

*   类是一种形式吗？考虑将用户控件用于表单控件或表单控件组。

有时，由于许多开发人员在不考虑整体设计的情况下进行快速修复/新功能，大型类会随着时间的推移而发展。重新访问其他人在此处提供的一些设计理论链接，并考虑持续支持以执行这些链接，例如代码审查和团队研讨会以审查设计。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-03T22:41:27.977

使用部分类。您基本上可以将单个类分解为多个文件。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-03T23:23:09.280

如果您在一个类中有代码区域，一个简单的方法是使用`partial`关键字并将该类的定义拆分到该文件中。我通常为大班这样做。

我使用的约定是使用 ClassName_RegionName.cs。例如，如果我想拆分一个管理数据库连接模式的类，并且我调用了类 DatabaseConnection，我将为主类创建一个名为 DatabaseConnection.cs 的文件，然后为模式功能创建一个名为 DatabaseConnection_Schema.cs 的文件。

有些班级必须很大。这不是糟糕的设计。它们只是执行繁重。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-04T02:46:06.173

也许 OP 可以回应：您的项目是否使用面向对象编程？您使用“文件”一词的事实表明它不是。

在您了解面向对象之前，没有希望以任何重要的方式改进您的代码。你最好根本不拆分文件，等到它变得非常缓慢和错误，然后不再忍受它，去学习 OO。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-04T02:55:49.237

Visual Studio 2008 中的 Intellisense 解析器似乎比 2005 中的解析器快得多（我知道他们专门在这方面做了很多工作），所以尽管您绝对应该像其他人提到的那样考虑在某个时候拆分文件， Visual Studio 2008 可能会立即解决您的性能问题。我用它打开了一个 100K+ 行的 Linq to SQL 文件，没有太多问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-07T18:07:50.410

拆分代码，以便每个类/文件/函数/等。只做一件事™。[单一职责原则](http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod)是将功能拆分为类的良好指南。

现在，我写的最大的类大约有 200 行，方法大多是 1-10 行。

# shell - SSH 到 debian 服务器立即注销

> ID：608533
> 
> 赞同：2
> 
> 时间：2009-03-03T22:39:18.573
> 
> 标签：shell, ssh, debian, plesk

我正在尝试帮助某人使用他们的 Debian 服务器。

他们有 Plesk。我让自己成为了 Plesk 的用户并启用了 SSH 访问。

我*可以*登录……但只能登录一秒钟。我看到了 MOTD，看到了 Debian 免责声明，然后我再次注销。“连接关闭”。

我唯一能想到的尝试是更改 shell 设置，Plesk 在“允许 ssh 使用：”选项旁边有一个 bash、csh、tcsh 等下拉列表。但它们都不起作用。

任何想法都非常感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-11-30T13:56:15.970

不幸的是，我解决此问题的方法是手动更改`/etc/passwd`我想要授予 shell 访问权限的用户的最后一个参数。它`/bin/bash`不是`/bin/false`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T15:26:28.937

Plesk 有时会变得有点古怪......

该行为类似于用户帐户在 Plesk 配置中选择了“nologin”外壳时所获得的行为。我会做一些事情：

*   使用 ssh 连接并激活详细选项 ( `ssh -v user@host`)，这样您可以获得更多详细信息。

*   检查 /etc/passwd 文件，查找您的用户并检查该行的最后一个字段是否指向有效的 shell（类似于`/bin/bash`代替`/bin/nologin`or `/bin/false`）。

*   还要检查该用户的主目录（在 shell 之前的字段上配置）是否有效、存在并且具有适当的权限和所有者

*   最后，检查您的日志（在`/var/log`; 我想我会检查`syslog`,`messages`和`user`），所以也许您可以获得任何有意义的消息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T00:00:15.807

当用户登录时，shell 会将他们带到他们的用户目录并可能运行“启动”脚本。

1.  用户目录是否在本地机器上？它是否必须从文件共享中安装（这不止一次发生在我身上）？如果该文件共享未安装，您将断开连接。
2.  看看这些 shell 的启动脚本。Bash[根据情况使用各种启动脚本](http://en.wikipedia.org/wiki/Bash#Startup_scripts)，包括 /etc/profile 和 ~/.bashrc。这些脚本有时会做一些古怪的事情，这些事情可能会因多种原因使您断开连接。

# c# - 用于控制某些项目的 LINQ 查询

> ID：608535
> 
> 赞同：0
> 
> 时间：2009-03-03T22:40:32.097
> 
> 标签：c#, linq, linq-to-sql

我在 C# 中有一个 Windows 窗体项目。我的表单上有 2 个文本框。名称的第一个文本框和第二个是姓氏的文本框。

每当用户按下 TAB 按钮**时，我想从数据库中检查是否有像我的第一个 textbox's.text 这样的名称**。如果有，那么它将移动到下一个控件。如果不是，那么我的程序会要求使用 LINQ to SQL 将此名称保存到 DB 中？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T22:43:06.740

您想附加到控件上的验证事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-05T02:17:20.633

在`ExitFocus`第一个文本框的事件（不确定事件名称）上，从数据库中选择文本框中的文本。

如果您的计数为 0，则向用户显示一个消息框，提示他检查是否要保存用户名或获取姓氏并将其填充到第二个文本框中

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-09-07T10:13:59.140

首先，您需要定义并附加`Leave`第一个文本框的事件（假设它的 id 是`textBox1`），如下所示：

```
 this.textBox1.Leave += new System.EventHandler(this.textBox1_Leave); 
```

然后在其相应的离开事件处理程序中，您可以编写适当的逻辑来检查用户输入的名称是否已使用 LINQ to SQL 存在于数据库中。根据调查结果，您可以使用`if`如下所示的语句做出适当的决定：

```
 private void textBox1_Leave(object sender, EventArgs e)
        {
            DataClasses1DataContext linqToSqlDataContext = new DataClasses1DataContext();
            if (linqToSqlDataContext.employees.Any(x => x.Name == textBox1.Text))
            {
                //move focus to surname text box control as the name already exists in DB
                textBox2.Focus();
            }
            else
            {
                //add a new entity into database for the name entered by the user
                linqToSqlDataContext.employees.Attach(new employee { Name = textBox1.Text });
                linqToSqlDataContext.SubmitChanges();

            }
        } 
```

# xaml - Silverlight 2 样式中的继承

> ID：608541
> 
> 赞同：2
> 
> 时间：2009-03-03T22:41:50.627
> 
> 标签：xaml, silverlight-2.0, code-reuse, styling

我想在 XAML 中建立样式，例如

```
<UserControl.Resources>
    <Style x:Key="MyStyle" TargetType="TextBlock">
        <Setter Property="Margin" Value="2,2,2,2" />
        <Setter Property="Foreground" Value="DarkRed" />
    </Style>
    <Style x:Key="MyBoldStyle" TargetType="TextBlock">
        <Setter Property="Style" Value="{StaticResource MyStyle}" />
        <Setter Property="FontWeight" Value="Bold" />
    </Style>
</UserControl.Resources> 
```

但这不起作用。（在 Silverlight 2 中）如何让一个继承另一个？

* * *

**2010 年 6 月更新：** [Silverlight 3 中的样式继承](http://www.devcurry.com/2010/02/inheriting-style-in-silverlight-3.html)，请使用`BasedOn="{StaticResource MyStyle}`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T21:24:16.140

没关系。我在 C# 2008的 MacDonald's [Pro Silverlight 2 中找到](https://web.archive.org/web/20110112083558/http://apress.com/book/view/9781590599495)[了答案](https://books.google.nl/books?id=mY2YWBC_M-8C&pg=PA334&lpg=PA334&dq=silverlight%20style%20inherit%20%22like%20css%22&source=bl&ots=T1C9YFvo4o&sig=MVSAsJBCOs3HjmnNrM8uGvgtc_w&hl=en&ei=muyuSeToKMe_tgfUqdCABg&sa=X&oi=book_result&ct=result&redir_esc=y)：

[![替代文字](https://i.stack.imgur.com/evV0o.gif)](https://i.stack.imgur.com/evV0o.gif)
[（来源：[apress.com](http://www.apress.com/resource/bookcover/9781590599495?size=medium)）]

> “如果您在 WPF 中使用过样式，您会发现 Silverlight 样式显着缩减……[例如，您不能] 创建从其他样式继承的样式。”

太糟糕了。也许在 Silverlight 3 中。

# c# - 结构的不变性

> ID：608542
> 
> 赞同：29
> 
> 时间：2009-03-03T22:42:02.360
> 
> 标签：c#, .net, struct, immutability

> **可能重复：**
> [为什么可变结构是邪恶的？](https://stackoverflow.com/questions/441309/why-are-mutable-structs-evil)

我在很多地方都读过它，包括这里，最好将结构设为不可变。

这背后的原因是什么？我看到许多 Microsoft 创建的可变结构，例如 xna 中的结构。BCL 中可能还有更多。

不遵守本指南的利弊是什么？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-03-03T22:46:22.940

结构应该代表**值**。值不会改变。数字 12 是永恒的。

但是，请考虑：

```
Foo foo = new Foo(); // a mutable struct
foo.Bar = 27;
Foo foo2 = foo;
foo2.Bar = 55; 
```

现在 foo.Bar 和 foo2.Bar 是不同的，这常常是出乎意料的。特别是在属性等场景中（幸运的是编译器检测到了这一点）。还有收藏品等；你如何明智地改变它们？

可变结构的数据丢失太容易了。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-03T22:47:29.570

最大的缺点是事情的表现并不像您期望的那样 - 特别是如果可变性来自直接值和其中的引用类型的混合。

老实说，当人们使用可变结构时，我不记得我看到人们在新闻组中提出的所有奇怪问题 - 但这些原因肯定存在。*可变结构会导致问题。*远离。

编辑：我刚刚找到了一封我不久前写的关于这个主题的电子邮件。它详细说明了一点：

*   这在哲学上是错误的：结构应该代表某种基本价值。这些基本上是不可变的。您无法更改数字 5。您可以将变量的值从 5 更改为 6，但逻辑上您不会更改值本身。

*   这实际上是一个问题：它创造了很多奇怪的情况。如果它通过接口是可变的，那就特别糟糕了。然后您可以开始更改装箱值。伊克。我看过很多新闻组帖子，这些帖子是由于人们试图使用可变结构并遇到问题。例如，我看到了一个非常奇怪的 LINQ 示例，它失败`List<T>.Enumerator`了，因为它是一个结构。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-02-16T13:18:12.543

我经常在我的（性能关键的）项目中使用可变结构 - 我没有遇到问题，因为我了解复制语义的含义。据我所知，人们提倡不可变结构的主要原因是让不了解其含义的人*不会*陷入困境。

这并不是一件可怕的事情——但我们现在面临着它成为“福音真理”的危险，而事实上，有时它是使结构可变的最佳选择。与所有事物一样，规则也有例外。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-03T22:52:19.027

没有什么比可变结构更便宜的了，这就是为什么你经常在高性能代码中看到它，比如图形处理例程。

不幸的是，可变结构不能很好地处理对象和属性，修改结构的副本而不是结构本身太容易了。因此它们不适用于您的大多数代码。

PS 为了避免复制可变结构的成本，它们通常以数组的形式存储和传递。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-03T23:08:00.237

技术原因是可变结构*似乎*能够做他们实际上不做的事情。由于设计时语义与引用类型相同，这让开发人员感到困惑。这段代码：

```
public void DoSomething(MySomething something)
{
    something.Property = 10;
} 
```

行为完全不同，具体取决于`MySomething`是 a`struct`还是 a `class`。对我来说，这是一个令人信服的理由，但不是最令人信服的理由。如果您查看[DDD](http://domaindrivendesign.org/)的[Value Object](http://dddstepbystep.com/wikis/ddd/value-object.aspx)，您可以看到与应该如何处理结构的联系。DDD 中的值对象可以最好地表示为 .Net 中的值类型（因此是结构）。因为没有身份，所以无法改变。

根据您的地址来考虑这一点。您可以“更改”您的地址，但地址本身并没有改变。事实上，您已经分配了一个新地址。从概念上讲，这是可行的，因为如果你真的*改变了*你的地址，你的室友也必须搬家。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-01-24T23:21:14.530

*您已经询问了不*遵循结构应该是不可变的准则的利弊。

**缺点：**现有答案中很好地涵盖了缺点，并且描述的大多数问题都是由于相同的原因 -**由于结构的值语义导致的意外行为**。

**优点：**使用可变结构的主要优点是**性能**。显然，这个建议带有关于优化的所有常见警告：确保您的部分代码*需要*优化，并确保任何更改确实通过分析优化了代码的性能。

有关讨论何时可能需要使用可变结构的优秀文章，请参阅 Rico Mariani 的[基于值编程的性能测验](http://blogs.msdn.com/b/ricom/archive/2006/08/31/733887.aspx)（或更具体地说，[答案](http://blogs.msdn.com/b/ricom/archive/2006/09/07/performance-quiz-11-ten-questions-on-value-based-programming-solution.aspx)）。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-03T22:50:37.517

一个结构通常应该代表某种单一的统一体。因此，更改值的属性之一没有多大意义，如果您想要一个以某种方式不同的值，则创建一个全新的值更有意义。

使用不可变结构时，语义会变得更简单，并且可以避免这样的陷阱：

```
// a struct
struct Interval {
   int From { get; set; }
   int To { get; set; }
}

// create a list of structs
List<Interval> intervals = new List<Interval>();

// add a struct to the list
intervals.Add(new Interval());

// try to set the values of the struct
intervals[0].From = 10;
intervals[0].To = 20; 
```

结果是列表中的结构根本没有改变。表达式 Interval[0] 从列表中复制结构的值，然后更改临时值的属性，但该值永远不会放回列表中。

编辑：将示例更改为使用列表而不是数组。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-03T22:46:33.470

当您复制周围的结构时，您会复制它们的内容，因此如果您修改复制的版本，“原始”将不会被更新。

这是错误的来源，因为即使您知道自己陷入了复制结构（只需将其传递给方法）并修改副本的陷阱。

上周*又*发生在我身上，让我花了一个小时寻找错误。

保持结构不可变可以防止...

除此之外，您首先需要确保有充分的理由使用结构 - “优化”或“我想要在堆栈上快速分配的东西”不算作答案。编组或依赖于布局的东西 - 好的，但通常不应该将这些结构保留很长时间，它们是值而不是对象。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-03T22:46:50.147

您应该使结构不可变的原因是它们是[ValueTypes](http://msdn.microsoft.com/en-us/library/system.valuetype.aspx)，这意味着每次将它们传递给方法时都会复制它们。

因此，例如，如果您有一个返回结构的属性，那么修改该结构上字段的值将毫无价值，因为 getter 将返回该结构的**副本**，而不是对该结构的引用。我已经在代码中看到了这一点，而且通常很难捕捉到。

如果您为不变性设计结构，您可以帮助程序员避免这些错误。

# c# - 跨 dll 的 C# 调试

> ID：608553
> 
> 赞同：2
> 
> 时间：2009-03-03T22:44:07.423
> 
> 标签：c#, debugging, dll

我有一个项目，它的调用结构类似于：

*   主要项目/应用
*   我的图书馆代码
*   别人的图书馆代码
*   我的图书馆代码

一切都是用 C# 编写的，我可以访问“别人的库代码”。他们的代码不包含在我的项目中，因为它是开源的，而不是我的代码。我可以制作所有库的调试版本，而且我已经这样做了。

那'别人的库代码（SELC，我猜？）正在以一种海森错误的方式抛出异常，我正试图追踪它，并可能向项目维护者提交一个错误修复。问题是，我的调试堆栈在我的库代码处停止，并将 SELC 列为“外部”，我无法对其进行调试。我已将 pdb 文件以及库的调试版本复制到我的应用程序的调试目录中，但仍然没有运气；我似乎无法调试他们的代码，我根本无法介入。

曾几何时，在 vs6 天，我可以做到这一点——在两个不同的环境中同时打开两个不同的项目，并让调试器跨 dll 边界从一个项目跟踪到另一个项目。我认为功能仍然存在，因为它非常有用。

有什么建议么？

我一直在寻找这个答案，但没有找到，所以如果这是一个骗子，请告诉我去哪里找。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-03T22:46:02.770

您是否在 Visual Studio 的调试选项中打开了“仅我的代码”？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T22:52:10.837

如果您有源代码（正如我从您那里读到的），您可以使用他们的源代码创建一个**项目**，然后将该项目添加到您的**解决方案中**。
在 Visual Studio 中，.csproj 文件中的项目和 .sln 文件中的解决方案。

# filter - Biztalk 发送端口组和过滤

> ID：608556
> 
> 赞同：2
> 
> 时间：2009-03-03T22:45:19.403
> 
> 标签：filter, biztalk, send-port

所以我的解决方案需要的模型如下：

我需要轮询数据库并根据结果创建对数据库的请求以获取更多数据，获取响应并将其传递给一组端口，基于提升的属性，只有一个端口会起作用。

它看起来像这样：

[![](https://i.stack.imgur.com/XUZt2.jpg)](https://i.stack.imgur.com/XUZt2.jpg)

但是，如果您将“Temp Out”分配给发送端口组，则消息将发送到组中的所有端口，而与每个端口上设置的过滤器无关。据我了解，这是预期的行为（阅读[此处](http://www.biztalkgurus.com/forums/t/2236.aspx)）。

所以我探索了其他选项，例如在 SDK 中使用基于内容的路由（CBR 示例）。你可以[在这里查看](http://msdn.microsoft.com/en-us/library/ms948408.aspx)。

我尝试了这个并完全删除了编排（它真的不需要）。但是，存在重大的路由/订阅错误，经过进一步研究，如果您有请求响应端口，您似乎无法做到这一点。[这里](http://www.tech-archive.net/Archive/BizTalk/microsoft.public.biztalk.general/2006-02/msg00178.html)有一些关于此的文章。我几乎有[这个](http://www.biztalkgurus.com/forums/t/5016.aspx)用户的相同问题。

最后，我是否使用编排对我来说并不重要。但是，我需要一种解决方案，在该解决方案中，我可以将消息传递到多个发送端口，并且我只能让一个实际使用消息并发送。这是必要的，这样我就可以轻松地编辑和添加端口，而无需在编排中修改任何其他内容或硬代码决策。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T13:27:04.087

您可以在编排的发送端口上使用[直接绑定](http://geekswithblogs.net/cyoung/articles/19546.aspx)将消息注入回消息框数据库。使用多个端口组，每个端口组可以直接订阅所需的消息类型并过滤提升的属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T12:47:04.040

我发现 CBR 示例模型确实有效。路由的问题在于订阅。如果我要将发送端口订阅到请求响应端口，我必须设置 BTS.SPName（发送端口名称）过滤器而不是 BTS.ReceivePort 过滤器。通过这样做，消息被正确过滤。你的答案也可以，但它需要使用我试图避免的编排。

# python - Python 端口绑定

> ID：608558
> 
> 赞同：7
> 
> 时间：2009-03-03T22:46:08.027
> 
> 标签：python

我最近一直在学习 python，我刚开始使用 python 的`socket`库玩网络。直到最近我的脚本在没有关闭连接的情况下终止时，一切都进展顺利。下次我运行脚本时，我得到了：

```
File "./alert_server.py", line 9, in <module>
  s.bind((HOST, PORT))
File "<string>", line 1, in bind
socket.error: (98, 'Address already in use') 
```

所以似乎有些东西仍然绑定到端口，即使 python 脚本没有运行（我已经使用`$px aux`. 验证了这一点。奇怪的是，大约一分钟后，我可以在同一个端口上再次运行脚本会没事的。有什么方法可以防止/取消绑定端口以防将来发生这种情况？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-03T22:55:10.690

你想做的是在`bind`, 之前做：

```
s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) 
```

您看到您的行为的原因是操作系统在最后一个连接终止后保留该特定端口一段时间。这样它就可以正确丢弃应用程序终止后可能进入的任何进一步的杂散数据包。

通过设置`SO_REUSEADDR`socket 选项，你告诉操作系统你知道你在做什么并且你仍然想绑定到同一个端口。

# tsql - 将列表传递给 TSQL 2008 存储过程

> ID：608562
> 
> 赞同：2
> 
> 时间：2009-03-03T22:47:01.007
> 
> 标签：tsql, sql-server-2008, stored-procedures

在 MSSQL Server **2008**中，有一种方法可以将流构建为存储过程，其中 ... 作为参数传入。并且**不必**具有拆分 csv 并返回表的“分离”存储过程或函数？

```
select *
from 
    atable
where 
    atable.id in (...) 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-03T22:54:10.100

使用[表值参数](http://msdn.microsoft.com/en-us/library/bb510489.aspx)。[以下是从 ADO.NET 使用它们的方法](http://msdn.microsoft.com/en-us/library/bb675163.aspx)。

# sql - 在 VB.NET 中嵌入 SQL 的最佳方法是什么

> ID：608571
> 
> 赞同：2
> 
> 时间：2009-03-03T22:49:58.550
> 
> 标签：sql, vb.net

我正在寻找有关使用嵌入在 VB.NET 或 C# 中的 SQL 的软件的最佳实践或项目布局的信息。该软件将连接到完整的 SQL 数据库。该软件是用 VB6 编写并移植到 VB.NET，我们希望对其进行更新以使用 .NET 功能，但我不知道从哪里开始我的研究。我们使用的是 Visual Studio 2005。所有的数据库操作都是从 VB 完成的。

更新：澄清。我们目前正在使用SqlConnection、SqlDataAdapter、SqlDataReader 来连接数据库。我所说的嵌入是指 SQL 存储过程在我们的 VB 代码中编写脚本，然后在 db 上运行。我们所有的表、存储过程、视图等都在 VB 代码中进行操作。我们的代码布局非常混乱。我正在寻找一种更好的架构或模式来组织我们的代码。

你能推荐任何我可以用谷歌搜索的书籍、网页、主题等，以帮助我更好地了解我们做到这一点的最佳方式。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T00:07:02.297

> 我正在寻找一种更好的架构或模式来组织我们的代码......
> 
> 我可以用谷歌搜索的主题

看一下数据库事务的 DAL（数据访问层）这是一个指向面临类似情况的人发布的 StackOverflow 问题的链接

[在 VB.NET 中创建类库](https://stackoverflow.com/questions/600962/creating-a-class-library-in-vb-net/601227#601227)

当您搜索[“如何创建 DAL”](http://tinyurl.com/ama3to)时，您将看到如何创建 DAL 的列表以及 DAL 是什么。这是一篇很好的文章，展示了 DAL 如何融入 N 层架构

*   [什么是 n 层架构？](http://www.developerfusion.com/article/3058/boosting-your-net-application-performance/2/)
*   [Webopedia: N-Tier Application Architecture](http://www.webopedia.com/quick_ref/app.arch.asp) - 展示了一个很好的图形表示

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T23:26:06.387

听起来您正在寻找一本针对一个非常具体的案例而编写的宏大理论书，即管理我们当前的意大利面条 SQL 代码框架的最佳实践是什么，我不知道我是否看过一本书或描述该内容的文件。

话虽如此，几年前我们将几个应用程序从 VB6 转换为 C#，并且在同一个地方。除了拆分某些模块以便它们的组织在整体上更具逻辑意义之外，我们的应用程序基本上与它们相同，只是用 C# 重写。我个人不喜欢将 SQL 代码与其编写的函数分开的想法（这听起来像是你正在尝试做的事情）；一般来说，如果我们有一个需要访问数据库的函数，我们会创建一个 SqlCommand 和一个可选的 SqlDataReader，将 CommandType 设置为 StoredProcedure 并添加参数，然后执行调用并使用结果，不管它做什么功能被编程去做。

我不知道这是最好的方法，但它对我们有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T23:02:01.390

是否可以将其转换为使用[LINQ](http://en.wikipedia.org/wiki/Language_Integrated_Query)？它比将其转换为使用常规的旧嵌入式 SQL 语句更安全。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T20:44:36.877

除了 Sung Meister 所说的，您还应该考虑将 SQL 从 VB.NET 代码移动到存储过程中，然后从 VB.NET 代码（数据访问层）调用 SP。它提供了许多优点。

# ssis - SSIS 执行 SQL 任务输出参数 -1 未正确显示

> ID：608578
> 
> 赞同：1
> 
> 时间：2009-03-03T22:52:28.277
> 
> 标签：ssis

这是我一整天看到的最愚蠢的事情。

在 SSIS 2005 中，我有一个执行 SQL 任务，它运行一个 SQL 2005 存储过程，它接受两个 IN 参数和一个 OUTPUT 参数。IN 参数是静态的，因此在命令字符串中是硬编码的。OUTPUT 参数被拉入 Int32 类型的包变量中（尽管在 Parameter Mapping 页面上的 Execute SQL Task 中它告诉我数据类型是 LONG）。

当我运行 SQL 任务并且输出参数返回值 > 0（如 2）时，变量填充为 2。当我运行 SQL 任务并且输出参数返回 -1 时，包变量填充了一些像 66682316 这样的值。我可以在 SSMS 中运行 proc，如果该值预先填充了 -1，它会返回 -1 给我。

```
DECLARE @out int

SET @out = -1

EXECUTE MyProc 'param1', 'param2', @out OUTPUT

SELECT @out    -- returns -1 
```

有谁知道为什么它会返回这个值而不是-1？我确定我的变量是 Int32 而不是 UInt32。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-04T15:28:54.477

如果你像你一样设置你的 sql 命令，你应该从结果集中而不是从参数设置你的变量。

将结果集设置为单行，然后在结果集选项卡上将 0（如果您使用 OLEDB）作为结果名称，将变量（即 User::OutputVariable）作为变量名称。

如果你想使用参数，你可以像这样设置你的 sql：

```
EXECUTE MyProc 'param1', 'param2', ? OUTPUT 
```

然后您将转到参数映射选项卡并按如下方式设置参数：
变量名称 -> 用户::输出变量
方向 -> 输出
数据类型 -> 长
参数名称 -> 0
参数大小 -> -1

**注意 这适用于使用 OLEDB 作为常规选项卡上的连接类型。参数的命名方式因使用的连接类型而异。**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-03T16:55:09.317

你应该说

选择 ？= @输出

# django - django/文件上传权限

> ID：608579
> 
> 赞同：42
> 
> 时间：2009-03-03T22:52:47.247
> 
> 标签：django, file-upload, permissions, django-uploads

我写了一个 django 应用程序，但是我对从 web 表单上传文件的文件权限有一点问题。

基本上我可以上传一个 .mp3 文件，但它始终保持 chmod 600。

容器文件夹有 chmod 775，umask 设置为 022。

我在共享托管服务中。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-03-03T23:59:50.987

如果您使用 Python 2，请在您的 settings.py 中尝试此操作：

```
FILE_UPLOAD_PERMISSIONS = 0644 
```

在 Python 3 中，八进制数必须以 0o 开头，因此该行将是：

```
FILE_UPLOAD_PERMISSIONS = 0o644 
```

有关更多详细信息[，请参阅文档](https://docs.djangoproject.com/en/dev/ref/settings/#std:setting-FILE_UPLOAD_PERMISSIONS)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-11-10T13:33:30.993

希望这是有用的。可以使用下面的方法。除了解决权限错误之外，这还有 2 个其他优点。

*   文件权限没有问题
*   更多更快
*   对于超过 2.5 MB 的文件（也节省空间），该文件不会复制到 /tmp/ 文件夹。

* * *

```
with open(file_name, 'wb+') as temp_file:
    for chunk in up_file.chunks():
        temp_file.write(chunk) 
```

# html - 非常简单的网页不会在 IE 上显示，但会在其他所有页面上显示

> ID：608580
> 
> 赞同：0
> 
> 时间：2009-03-03T22:52:50.930
> 
> 标签：html

我刚刚开始制作网页，但在这个非常简单的网页上遇到了很多麻烦。我无法在 IE 上显示任何内容，但在其他所有浏览器上都可以正常工作。我会冒昧地将所有代码放在我的问题中，因为它真的很短。如果有人可以帮助我，那就太好了！

html是：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
xmlns="http://www.w3.org/1999/xhtml">
<head> <title>Rhaya<title>
        <link rel='stylesheet' media="screen" type="text/css"
href='rhaya.css'/>

</head>
<body>

<div id="masthead"> Rhaya </div>

<div id="content"> Aca va todo el
contenido </div>

<div id="footer"> ©2009 Rhaya | Teresa
Siu | Pía Fabry </div>

</body>
</html> 
```

而CSS是：

```
ul,ol,li {list-style:none}
body {  margin:0 auto; padding:0;font-family: Tahoma;font-size:13px; background: #fff; line-height:15px; color:#000;}
a {color: #000;text-decoration:none}
a:hover {text-decoration:none;color:#000;cursos:default;}

/* Masthead */
#masthead {
    margin:10px 0 10px 0;
    height: 50px;
    font-weight: bold;
    padding:10px;
    border:1px solid #a2ebf4;
    background-color:#e1f2f9;
    background-image: url(img/header.png);
}

/* Content */
#content {
    margin-left:0px;
    margin-bottom:10px;
    padding:10px;
    border:1px solid #000;
    min-width: 300px;
    min-height: 300px;
    font-family: Tahoma;
    font-size:13px;
}

/* Footer */
#footer {
    clear:both;
    padding:10px;
    border:1px solid #a2ebf4;
    background-color:#e1f2f9;
    text-align:center;
}

 #wrapper{
    width:1002px;
    clear:both;
    height:auto;
    margin:0px auto;
    background:#fff;
} 
```

我真的很抱歉这么明目张胆地问，但我真的很难过。

谢谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-03T23:01:22.483

供将来参考： http: [//validator.w3.org/#validate_by_input](http://validator.w3.org/#validate_by_input) 使用它来解决 html 问题。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-03T22:57:51.370

你的 html 头有一个错误：

```
<title>Rhaya<title> 
```

应该

```
<title>Rhaya</title> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T23:02:41.327

哇，它实际上根本没有出现在 IE 中。

原因是您在页面标题中有整个页面。改变这个：

```
<title>Rhaya<title> 
```

到：

```
<title>Rhaya</title> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T23:00:51.503

我建议将以下内容添加到您的 css 中：

```
div { position: relative; } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T23:02:58.237

```
<html 
```

标签未正确关闭

标题标签未正确关闭。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-03T23:28:41.233

我已经尝试和测试过。这是你的标题问题。附上它的标题/标题肯定会起作用。

# c++ - 可以捕获写入地址（x86 - linux）

> ID：608584
> 
> 赞同：8
> 
> 时间：2009-03-03T22:54:12.720
> 
> 标签：c++, c, linux, x86

我希望能够检测何时发生对内存地址的写入 - 例如通过设置附加到中断的回调。有谁知道怎么做？

我希望能够在运行时执行此操作（可能 gdb 具有此功能，但我的特定应用程序导致 gdb 崩溃）。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-03T23:02:10.627

如果您想拦截对一系列地址的写入，您可以使用[`mprotect()`](http://linux.die.net/man/2/mprotect)将有问题的内存标记为不可写，并安装一个信号处理程序[`sigaction()`](http://linux.die.net/man/2/sigaction)来捕获生成的 SIGSEGV，执行您的日志记录或其他操作并将页面再次标记为可写.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-03T22:57:44.460

您需要的是访问 X86 调试寄存器：[http ://en.wikipedia.org/wiki/Debug_register](http://en.wikipedia.org/wiki/Debug_register)

您需要在 DR0 到 DR3 之一中设置断点地址，然后在 DR7 中设置条件（数据写入）。将发生中断，您可以运行调试代码来读取 DR6 并找出导致断点的原因。

如果 GDB 不起作用，您可以尝试使用更简单/更小的调试器，例如[http://sourceforge.net/projects/minibug/](http://sourceforge.net/projects/minibug/) - 如果这不起作用，您至少可以浏览代码并了解如何使用自己调试处理器上的硬件。

此外，还有一个关于掌握 linux 调试技术的优秀 IBM 开发人员资源，它应该提供一些额外的选项：

[http://www.ibm.com/developerworks/linux/library/l-debug/](http://www.ibm.com/developerworks/linux/library/l-debug/)

关于这样做的一篇相当不错的文章是 windows 在这里（我知道你在 linux 上运行，但其他人可能会提出这个问题，希望在 windows 中执行此操作）：

[http://www.codeproject.com/KB/debug/hardwarebreakpoint.aspx](http://www.codeproject.com/KB/debug/hardwarebreakpoint.aspx)

-亚当

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T06:35:27.277

GDB 确实有这个特性：它被称为硬件观察点，它在 Linux/x86 上得到了很好的支持：

```
(gdb) watch *(int *)0x12345678 
```

如果您的应用程序崩溃 GDB，请从[CVS Head](http://savannah.gnu.org/cvs/?group=gdb)构建当前 GDB 。

如果该 GDB 仍然失败，请提交 GDB[错误](http://sourceware.org/bugzilla/)。

我们修复 GDB 的速度可能比您破解 SIGSEGV 处理程序（提供了一个好的测试用例）更快，并且对 GDB 的修复也可以帮助您解决未来的问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-09-07T08:24:50.703

mprotect 确实有一个缺点：您的内存必须是页边界对齐的。我在堆栈上有问题的内存，无法使用 mprotect()。

正如亚当所说，你想要的是操纵调试寄存器。在 Windows 上，我使用了这个： [http](http://www.morearty.com/code/breakpoint/) ://www.morearty.com/code/breakpoint/ ，效果很好。我还将它移植到 Mach-O (Mac OS X) 上，它也很好用。这也很容易，因为 Mach-O 有 thread_set_state()，它等价于 SetThreadContext()。

linux 的问题在于它没有这样的等价物。我找到了ptrace，但我想，这不可能，一定有更简单的东西。但是没有。然而。我认为他们正在为内核和用户空间开发 hw_breakpoint API。（见[http://lwn.net/Articles/317153/](http://lwn.net/Articles/317153/)）

但是当我发现这个： http: [//blogs.oracle.com/nike/entry/memory_debugger_for_linux](http://blogs.oracle.com/nike/entry/memory_debugger_for_linux)我试了一下，还不错。ptrace 方法由一些充当“调试器”的“外部进程”工作，附加到您的程序，为调试寄存器注入新值，并终止您的程序继续设置新的硬件断点。问题是，您可以使用 fork() 自己创建这个“外部进程”（我没有成功使用 pthread），并在代码中内联执行这些简单的步骤。

addwatchpoint 代码必须适用于 64 位 linux，但这只是将 USER_DR7 等更改为 offsetof(struct user, u_debugreg[7])。另一件事是，在 PTRACE_ATTACH 之后，您必须等待被调试者真正停止。但是，不要在繁忙的循环中重试 POKEUSER，正确的做法是在您的 pid 上使用 waitpid()。

ptrace 方法的唯一问题是您的程序一次只能连接一个“调试器”。因此，如果您的程序已经在 gdb 控制下运行，则 ptrace 附加将失败。但就像示例代码一样，您可以为 SIGTRAP 注册一个信号处理程序，在没有 gdb 的情况下运行，当您捕获到信号时，进入一个忙循环等待 gdb 附加。从那里你可以看到谁试图写下你的记忆。

# c# - 有人可以解释 Microsoft Unity 吗？

> ID：608585
> 
> 赞同：161
> 
> 时间：2009-03-03T22:54:15.793
> 
> 标签：c#, dependency-injection, inversion-of-control, unity-container

我一直在阅读 MSDN 上有关 Unity（依赖注入、控制反转）的文章，但我认为我需要用简单的术语（或简单的示例）来解释它。我熟悉 MVPC 模式（我们在这里使用它），但我还不能真正掌握 Unity 的东西，我认为这是我们应用程序设计的下一步。

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2009-03-03T23:02:55.740

Unity 只是一个 IoC“容器”。谷歌 StructureMap 并尝试一下。我认为，当 IoC 对你来说是新的东西时，更容易理解。

基本上，如果您了解 IoC，那么您就会明白您所做的是在创建对象时反转控件。

没有 IoC：

```
public class MyClass
{
   IMyService _myService; 

   public MyClass()
   {
      _myService = new SomeConcreteService();    
   }
} 
```

使用 IoC 容器：

```
public class MyClass
{
   IMyService _myService; 

   public MyClass(IMyService myService)
   {
      _myService = myService;    
   }
} 
```

如果没有 IoC，则依赖于 IMyService 的类必须更新要使用的服务的具体版本。这很糟糕，原因有很多（你已经将你的类耦合到 IMyService 的特定具体版本，你不能轻易地对其进行单元测试，你不能轻易地改变它等等）

使用 IoC 容器，您可以“配置”容器来为您解决这些依赖关系。因此，使用基于构造函数的注入方案，您只需将 IMyService 依赖项的接口传递给构造函数即可。当您使用容器创建 MyClass 时，您的容器将为您解析 IMyService 依赖项。

使用 StructureMap，配置容器如下所示：

```
StructureMapConfiguration.ForRequestedType<MyClass>().TheDefaultIsConcreteType<MyClass>();
StructureMapConfiguration.ForRequestedType<IMyService>().TheDefaultIsConcreteType<SomeConcreteService>(); 
```

所以你所做的就是告诉容器，“当有人请求 IMyService 时，给他们一份 SomeConcreteService 的副本。” 而且您还指定当有人请求 MyClass 时，他们会得到一个具体的 MyClass。

这就是 IoC 容器的全部功能。他们可以做得更多，但这就是它的主旨——他们为您解决依赖关系，因此您不必这样做（而且您不必在整个代码中使用“new”关键字）。

最后一步：当你创建你的 MyClass 时，你会这样做：

```
var myClass = ObjectFactory.GetInstance<MyClass>(); 
```

希望有帮助。随时给我发电子邮件。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-05-26T00:52:29.200

我刚刚观看了 David Hayden 的 30 分钟 Unity Dependency Injection IoC Screencast，并觉得这是一个很好的示例解释。以下是节目说明的片段：

截屏视频展示了 Unity IoC 的几种常见用法，例如：

*   创建不在容器中的类型
*   注册和解析类型映射
*   注册和解析命名类型映射
*   单例、LifetimeManager 和 ContainerControlledLifetimeManager
*   注册现有实例
*   将依赖项注入现有实例
*   通过 App.config / Web.config 填充 UnityContainer
*   通过注入 API 指定依赖项，而不是依赖项属性
*   使用嵌套（父子）容器

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-03-03T23:05:14.707

Unity 是一个与许多其他库一样的库，它允许您获取所请求类型的实例，而无需自己创建它。所以给的。

```
public interface ICalculator
{
    void Add(int a, int b);
}

public class Calculator : ICalculator
{
    public void Add(int a, int b)
    {
        return a + b;
    }
} 
```

您将使用 Unity 之类的库来注册 Calculator，以便在请求 ICalculator 类型时返回，即 IoC（控制反转）（此示例是理论上的，在技术上不正确）。

```
IoCLlibrary.Register<ICalculator>.Return<Calculator>(); 
```

所以现在当你想要一个 ICalculator 的实例时，你只需......

```
Calculator calc = IoCLibrary.Resolve<ICalculator>(); 
```

IoC 库通常可以配置为在每次解析类型时保存单例或创建新实例。

现在假设你有一个依赖于 ICalculator 的类，你可以拥有..

```
public class BankingSystem
{
    public BankingSystem(ICalculator calc)
    {
        _calc = calc;
    }

    private ICalculator _calc;
} 
```

您可以设置库以在创建对象时将对象注入构造函数。

因此 DI 或依赖注入意味着注入另一个可能需要的任何对象。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-03-04T00:33:51.530

Unity 是一个 IoC。IoC 的重点是在类型本身之外抽象类型之间的依赖关系。这有几个优点。首先，它是集中完成的，这意味着当依赖关系发生变化时您不必更改大量代码（单元测试可能就是这种情况）。

此外，如果使用配置数据而不是代码完成连接，您实际上可以在部署后重新连接依赖关系，从而在不更改代码的情况下更改应用程序的行为。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-02-11T20:24:29.610

MSDN 有一个[Developer's Guide to Dependency Injection Using Unity](http://msdn.microsoft.com/en-us/library/dn223671.aspx)，它可能很有用。

开发人员指南首先介绍了依赖注入的基础知识，然后是如何使用 Unity 进行依赖注入的示例。截至 2014 年 2 月，开发人员指南涵盖了 2013 年 4 月发布的 Unity 3.0。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-06-30T20:27:57.197

我将介绍 ASP.NET Web API 2 中的大多数依赖注入示例

```
public interface IShape
{
    string Name { get; set; }
}

public class NoShape : IShape
{
    public string Name { get; set; } = "I have No Shape";
}

public class Circle : IShape
{
    public string Name { get; set; } = "Circle";
}

public class Rectangle : IShape
{
    public Rectangle(string name)
    {
        this.Name = name;
    }

    public string Name { get; set; } = "Rectangle";
} 
```

在 DIAutoV2Controller.cs 中使用了自动注入机制

```
[RoutePrefix("api/v2/DIAutoExample")]
public class DIAutoV2Controller : ApiController
{
    private string ConstructorInjected;
    private string MethodInjected1;
    private string MethodInjected2;
    private string MethodInjected3;

    [Dependency]
    public IShape NoShape { get; set; }

    [Dependency("Circle")]
    public IShape ShapeCircle { get; set; }

    [Dependency("Rectangle")]
    public IShape ShapeRectangle { get; set; }

    [Dependency("PiValueExample1")]
    public double PiValue { get; set; }

    [InjectionConstructor]
    public DIAutoV2Controller([Dependency("Circle")]IShape shape1, [Dependency("Rectangle")]IShape shape2, IShape shape3)
    {
        this.ConstructorInjected = shape1.Name + " & " + shape2.Name + " & " + shape3.Name;
    }

    [NonAction]
    [InjectionMethod]
    public void Initialize()
    {
        this.MethodInjected1 = "Default Initialize done";
    }

    [NonAction]
    [InjectionMethod]
    public void Initialize2([Dependency("Circle")]IShape shape1)
    {
        this.MethodInjected2 = shape1.Name;
    }

    [NonAction]
    [InjectionMethod]
    public void Initialize3(IShape shape1)
    {
        this.MethodInjected3 = shape1.Name;
    }

    [HttpGet]
    [Route("constructorinjection")]
    public string constructorinjection()
    {
        return "Constructor Injected: " + this.ConstructorInjected;
    }

    [HttpGet]
    [Route("GetNoShape")]
    public string GetNoShape()
    {
        return "Property Injected: " + this.NoShape.Name;
    }

    [HttpGet]
    [Route("GetShapeCircle")]
    public string GetShapeCircle()
    {
        return "Property Injected: " + this.ShapeCircle.Name;
    }

    [HttpGet]
    [Route("GetShapeRectangle")]
    public string GetShapeRectangle()
    {
        return "Property Injected: " + this.ShapeRectangle.Name;
    }

    [HttpGet]
    [Route("GetPiValue")]
    public string GetPiValue()
    {
        return "Property Injected: " + this.PiValue;
    }

    [HttpGet]
    [Route("MethodInjected1")]
    public string InjectionMethod1()
    {
        return "Method Injected: " + this.MethodInjected1;
    }

    [HttpGet]
    [Route("MethodInjected2")]
    public string InjectionMethod2()
    {
        return "Method Injected: " + this.MethodInjected2;
    }

    [HttpGet]
    [Route("MethodInjected3")]
    public string InjectionMethod3()
    {
        return "Method Injected: " + this.MethodInjected3;
    }
} 
```

在 DIV2Controller.cs 中，所有内容都将从 Dependency Configuration Resolver 类中注入

```
[RoutePrefix("api/v2/DIExample")]
public class DIV2Controller : ApiController
{
    private string ConstructorInjected;
    private string MethodInjected1;
    private string MethodInjected2;
    public string MyPropertyName { get; set; }
    public double PiValue1 { get; set; }
    public double PiValue2 { get; set; }
    public IShape Shape { get; set; }

    // MethodInjected
    [NonAction]
    public void Initialize()
    {
        this.MethodInjected1 = "Default Initialize done";
    }

    // MethodInjected
    [NonAction]
    public void Initialize2(string myproperty1, IShape shape1, string myproperty2, IShape shape2)
    {
        this.MethodInjected2 = myproperty1 + " & " + shape1.Name + " & " + myproperty2 + " & " + shape2.Name;
    }

    public DIV2Controller(string myproperty1, IShape shape1, string myproperty2, IShape shape2)
    {
        this.ConstructorInjected = myproperty1 + " & " + shape1.Name + " & " + myproperty2 + " & " + shape2.Name;
    }

    [HttpGet]
    [Route("constructorinjection")]
    public string constructorinjection()
    {
        return "Constructor Injected: " + this.ConstructorInjected;
    }

    [HttpGet]
    [Route("PropertyInjected")]
    public string InjectionProperty()
    {
        return "Property Injected: " + this.MyPropertyName;
    }

    [HttpGet]
    [Route("GetPiValue1")]
    public string GetPiValue1()
    {
        return "Property Injected: " + this.PiValue1;
    }

    [HttpGet]
    [Route("GetPiValue2")]
    public string GetPiValue2()
    {
        return "Property Injected: " + this.PiValue2;
    }

    [HttpGet]
    [Route("GetShape")]
    public string GetShape()
    {
        return "Property Injected: " + this.Shape.Name;
    }

    [HttpGet]
    [Route("MethodInjected1")]
    public string InjectionMethod1()
    {
        return "Method Injected: " + this.MethodInjected1;
    }

    [HttpGet]
    [Route("MethodInjected2")]
    public string InjectionMethod2()
    {
        return "Method Injected: " + this.MethodInjected2;
    }
} 
```

配置依赖解析器

```
public static void Register(HttpConfiguration config)
{
    var container = new UnityContainer();
    RegisterInterfaces(container);
    config.DependencyResolver = new UnityResolver(container);

    // Other Web API configuration not shown.
}

private static void RegisterInterfaces(UnityContainer container)
{
    var dbContext = new SchoolDbContext();
    // Registration with constructor injection
    container.RegisterType<IStudentRepository, StudentRepository>(new InjectionConstructor(dbContext));
    container.RegisterType<ICourseRepository, CourseRepository>(new InjectionConstructor(dbContext));

    // Set constant/default value of Pi = 3.141 
    container.RegisterInstance<double>("PiValueExample1", 3.141);
    container.RegisterInstance<double>("PiValueExample2", 3.14);

    // without a name
    container.RegisterInstance<IShape>(new NoShape());

    // with circle name
    container.RegisterType<IShape, Circle>("Circle", new InjectionProperty("Name", "I am Circle"));

    // with rectangle name
    container.RegisterType<IShape, Rectangle>("Rectangle", new InjectionConstructor("I am Rectangle"));

    // Complex type like Constructor, Property and method injection
    container.RegisterType<DIV2Controller, DIV2Controller>(
        new InjectionConstructor("Constructor Value1", container.Resolve<IShape>("Circle"), "Constructor Value2", container.Resolve<IShape>()),
        new InjectionMethod("Initialize"),
        new InjectionMethod("Initialize2", "Value1", container.Resolve<IShape>("Circle"), "Value2", container.Resolve<IShape>()),
        new InjectionProperty("MyPropertyName", "Property Value"),
        new InjectionProperty("PiValue1", container.Resolve<double>("PiValueExample1")),
        new InjectionProperty("Shape", container.Resolve<IShape>("Rectangle")),
        new InjectionProperty("PiValue2", container.Resolve<double>("PiValueExample2")));
} 
```

# sql - 删除非唯一 ID 行

> ID：608602
> 
> 赞同：5
> 
> 时间：2009-03-03T22:58:41.883
> 
> 标签：sql, sql-server, unique

从数据库备份中，我有没有唯一 ID 的记录。

一些记录具有唯一的 ID。一些具有重复 ID 的记录包含不同的 DateCreated 值。一些具有重复 ID 的记录包含相同的 DateCreated 值。

我正在尝试获取 MSSql 2005 查询将只留下具有最​​新 DateCreated 值的唯一 ID 值。

从

```
ID|    DateCreated  
1 |    1/1/09
2 |    1/2/09
2 |    2/2/09
3 |    1/3/09
3 |    1/3/09 
```

到

```
ID|    DateCreated  
1 |    1/1/09
2 |    2/2/09
3 |    1/3/09 
```

帮助

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-03T23:05:24.457

```
DELETE FROM myTable AS t1 
WHERE EXISTS (
    SELECT 1 FROM myTable AS t2 
    WHERE t1.ID=t2.ID AND t1.DateCreated<t2.DateCreated) 
```

即，删除任何有另一行具有相同 id 和较晚创建日期的行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T23:12:52.363

```
create table #t ( id int, date datetime )

insert #t 
values(1, getdate())

insert #t 
values(1, getdate()+1)

insert #t 
values(1, getdate()-1)

insert #t 
values(2, getdate())

insert #t 
values(2, getdate()+1)

delete t 
from #t t
left join (select id, min(date) as date from #t group by id) as t1 
    on t.id = t1.id and t1.date = t.date
where t1.date is null 
```

# windows - 对 USB 传输电缆进行编程/与 USB 设备驱动程序通话

> ID：608607
> 
> 赞同：6
> 
> 时间：2009-03-03T22:59:22.113
> 
> 标签：windows, usb, device-driver

如何以编程方式从 Windows访问 USB 传输电缆（例如 Belkin 的[Easy Transfer Cable ）？](http://www.belkin.com/easytransfercable/)

我对[libusb-win32](http://libusb-win32.sourceforge.net/)很熟悉，但据我所知，将它与较新的设备和 Windows Vista 一起使用似乎不太确定。

我知道[Windows Easy Transfer](http://www.microsoft.com/windows/windows-vista/get/easy-transfer.aspx)可以做到这一点。如何编写与 Windows 轻松传送功能相同的代码？

如果没有关于如何做到这一点的罐头文档，我愿意做一些挖掘，但我不知道从哪里开始。如何查看 Windows Easy Transfer 的操作以了解它是如何操作的？我看到 Windows 甚至在设备管理器“传输电缆设备”中为传输电缆提供了自己的类别。我如何与这些驱动程序之一进行低级通信？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T20:51:14.923

我发现微软现在提供[WinUSB](http://msdn.microsoft.com/en-us/library/aa476426.aspx)用于与 USB 设备进行简单的用户模式通信。（必须首先为设备安装 WinUSB 设备驱动程序；这有点类似于 libusb-win32 设备驱动程序。） WinUSB 可在 XP（SP2 及更高版本）和 Vista 上运行。

[Easy Transfer Cable 使用 WinUSB 作为其设备驱动程序，因此我可以按照 Microsoft 的WinUSB howto](http://www.microsoft.com/whdc/connect/usb/winusb_howto.mspx)文档中的示例代码与它进行通信。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T00:35:17.330

您将需要使用低级别的 win32 API 来执行此操作。微软在这里有一些关于访问人机接口设备的好例子。传输电缆不像鼠标或键盘那样明确是 HID，但它符合 HID 规范。

例如，要获取您要调用的 USB 设备的名称

```
HidD_GetProductString(...) 
```

[http://msdn.microsoft.com/en-us/library/ms790920.aspx](http://msdn.microsoft.com/en-us/library/ms790920.aspx)

那里还有更多内容，您绝对应该查看适用于从 2000 到 Vista 的所有 Windows 版本的示例 c 应用程序。

[http://msdn.microsoft.com/en-us/library/dd163258.aspx](http://msdn.microsoft.com/en-us/library/dd163258.aspx)

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-11T07:23:51.737

您需要有支持 API 或 SDK 的 USB 数据传输线（也称为 USB 数据连接线），然后使用以下代码：

```
void CU2uDlg::OnOK() 
{
BYTE        buf[65530];
LPU2URET    pU2uRet;
BOOL        bRet;
int         ret;
CString     msgstr;

ret = u2u_open();
if (ret == -1){
    AfxMessageBox("Open U2U device Success.");
}else{
    msgstr.Format("Open U2U device fail，return：%d", ret);
    AfxMessageBox(msgstr);
    return;
}

//send data
bRet = u2u_SendData(buf, 65530, ret);
if(!bRet)
{
    msgstr.Format("Send data error，return：%d", ret);
    AfxMessageBox(msgstr);
    return;
}

//receive data
while (1){
    bRet = u2u_RecvData(recvData, dataLen, ret);
    if( !bRet )
    {
        msgstr.Format("Receive data error，return：%d", ret);
        AfxMessageBox(msgstr);
        u2u_close();
        return;
    }else{
        break;
    }
}
u2u_close();

} 
```

See: [Reference1](http://www.cnblogs.com/LiuKaiFa/p/USB_data_link_cable_API.html), [Reference2](http://blog.csdn.net/zzkjliu/article/details/12838383)

# iphone - 为什么 Cocoa 偶尔会返回一个空字符串？

> ID：608608
> 
> 赞同：5
> 
> 时间：2009-03-03T22:59:28.933
> 
> 标签：iphone, objective-c, cocoa, memory-management

我的应用程序中有一些代码如下所示：

```
char *hash = (char*) sqlite3_column_text(get_bookmark, 0);
NSString* postHash = [NSString stringWithUTF8String:hash]; 
```

这对我每次都有效；我从来没有见过它*不起作用*。我的大多数用户都没有遇到问题（据我所知）。但是我发现有时对于某些用户来说这`postHash`是一个空字符串 ( )。`@""`

谁能解释为什么？

更多背景/推测：

这似乎只发生在越狱手机上。他们有什么不同吗？我收集到通常可用的内存较少。还有什么可以在这里做出贡献的吗？

`postHash`在表格单元格中使用，并且偶尔会看到正确填充，因此我有理由相信数据库调用*应该可以*工作。事实上，如果数据库也有一个空字符串，那是因为一段非常相似的代码，所以问题仍然存在。

`hash`肯定会返回一个非 NULL 值。如果我在此处强制为 NULL，则应用程序崩溃。同样，`postHash`这也不`nil`会使应用程序崩溃（出于相同的原因）。

我认为这可能与记忆有关。如果该方法在被调用之前尝试分配太多内存，`-didReceiveMemoryWarning`会发生什么？我知道，在某些时候，Springboard 会弹出应用程序。但是 Cocoa 是否有可能在这里返回一个空字符串而不是预期值？我听说过一些报告，据我所知，这些报告只能是由一个空字符串引起的，而该字符串应该存在更长的时间。

欢迎任何其他猜测、理论或想法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-03T23:04:13.100

> 但是我发现有时对于某些用户来说这`postHash`是一个空字符串 ( )。`@""`
> 
> 谁能解释为什么？

因为`hash`是一个空字符串 ( `hash[0] == '\0'`)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-21T18:21:35.610

我终于找到了解决方案。我会给彼得一个公认的答案，因为他是对的，但我得到一个空字符串的原因是......有趣。

数据库*已*正确填充。查询也是正确的。我的手机和我的用户之间的区别在于他们有越狱的手机。显然，越狱的 iPhone 有时使用的 SQLite 版本与 iPhone OS 的出货版本不同。

版本更改暴露了我的代码中的一个错误，导致其中一个参数设置不正确并`sqlite3_column_text`返回一个空字符串。

# html - 没有提交按钮的 HTML 表单提交

> ID：608622
> 
> 赞同：3
> 
> 时间：2009-03-03T23:04:38.623
> 
> 标签：html, xhtml, standards

我有这样的表格：

```
<html> 
    <body> 
        <form onSubmit="alert('Just got submitted');">
            <p>
            Hello: <input class="field" type="text"/><br/>
            Goodbye: <input class="field" type="text"/><br/>
            </p>
        </form>
    </body> 
</html> 
```

在一个浏览器中，当用户从其中一个字段按下回车键时，它会愉快地提交，而在另一个浏览器中，则不会。奇怪的是，如果我删除第二个字段，它在这两个字段中都有效。

我的问题是真的 - 可以有一个没有明确提交元素的表单吗？我真的很喜欢这种行为。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-03T23:10:08.923

没有明确提交是糟糕的用户体验。在过去十年中，您的典型最终用户已经学习了一组网站表单交互原则。即，您可以在字段之间进行选项卡，您可以选择许多复选框，并且您可以单击一个按钮来实际提交您的数据。

我过去曾尝试开发使用 JavaScript 自动更新的表单，但我收到了无数用户的抱怨。他们想要一个按钮，或者他们不相信它正在工作。所以在这种特殊情况下，我保持表单原样工作，但添加了一个实际上没有做任何事情的提交按钮。他们很高兴。

这些天我只是用普通的提交按钮来构建我的表单。不仅用户期望它，而且它允许在不支持 JS 的浏览器之间进行更清晰的渐进增强。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T23:11:21.947

没有提交元素的表单当然是不可能的，特别是如果您使用 JavaScript 事件来提交表单。我强烈建议您使用 onkeypress 事件来检测按下的“enter”键，而不是依赖浏览器在您制作没有提交的表单时只接受“enter”键，以使其跨浏览器兼容。

但是，我认为省略某种提交按钮是一种不好的形式。（它不一定是“提交”类型的输入，可以是“按钮”或您单击的图像。）人们通过按钮填写提交的表单只是一个标准，而您正在接受那个，这可能会使许多习惯于按钮的用户感到困惑。通过呈现规范的替代形式，它绝对违反了[Don't Make Me Think的原则。](https://rads.stackoverflow.com/amzn/click/com/0789723107)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T23:10:53.490

这不是一个好主意。您自己指出原因 - 它不适用于所有浏览器。此外，这不是人们所期望的，因此可能会使人们感到困惑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T04:15:35.017

[使用 jQuery 在“Enter”上提交表单？](https://stackoverflow.com/questions/699065/submitting-a-form-on-enter-with-jquery)

此外，我会将按钮保留在表单中，但使用 javascript ($('#submit').hide()) 将其隐藏。这意味着如果用户禁用了脚本或 f.ex。使用其他设备，他会看到提交表单的默认方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T23:33:14.873

这取决于您对“确定”的含义。

如果您的意思是有效的 (x)html，那完全没有问题，但在用户方面，这是一个可用性问题。但这也取决于您网站的目标受众。如果它适合精通技术的人，那没关系。

您可以像这样创建一个输入按钮：

```
<input type="button" onclick("doSomething()") /> 
```

doSomething() 将是 Javascript 中的一个函数，它将您的表单数据发送到服务器端脚本。这样你就不会有提交行为。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-03T23:33:52.453

如果您希望有两个按钮在提交时产生两种不同的行为。你可以这样做是这样的：

或者您可以将表单提交放在 function1() 或 function2()

# unit-testing - Team Foundation Server 和 MbUnit 测试

> ID：608629
> 
> 赞同：1
> 
> 时间：2009-03-03T23:06:15.047
> 
> 标签：unit-testing, tfs, mbunit

我对 TFS Server 和 MbUnit 真的很陌生。

您需要执行哪些步骤才能使 TFS 上的构建运行您的 MbUnit 测试？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T04:45:04.700

您需要自定义构建任务，或者只需执行传入适当参数的 MbUnit 可执行文件。

此 nUnit 示例中采取的步骤适用于 MbUnit 实现： [NUnit 示例](http://morten.lyhr.dk/2008/05/using-nunit-and-ncover-with-tfs-build.html)

# mysql - 在博客文章中将 MySQL 表显示为 ASCII

> ID：608630
> 
> 赞同：0
> 
> 时间：2009-03-03T23:06:34.453
> 
> 标签：mysql, wordpress, recordset

我想在博客文章中快速显示 MySQL 记录集，使用与 mysql.com 在其帮助页面中使用的相似的 ASCII 布局。我正在使用 wordpress v2.7。有任何想法吗？我还应该补充一点，我正在使用 wp-syntax 进行语法突出显示，所以它实际上只是生成我感兴趣的 ASCII。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T00:02:47.923

如果你的意思是像

```
+----+------+
| 编号 | 姓名 |
+----+------+
| 1 | 鲍勃 |
| 2 | 玛丽 |
| 3 | 简 |
| 4 | 丽莎 |
+----+------+

```

那么只需从 MySQL 命令行运行查询就足够了，因为在命令行上以交互模式运行查询时，结果会被格式化。`<pre>`然后，您可以将它们复制并粘贴到您的博客文章中，并在必要时将它们包围或类似。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T00:03:58.480

您所说的 ASCII 是 MySQL 命令行客户端显示其结果的方式。

```
mysql> select task_nextrun,task_name from pref_task;
+--------------+-----------------+
| task_nextrun | task_name       |
+--------------+-----------------+
|   1235999760 | datacache_clean |
|   1236002760 | process_stats   |
+--------------+-----------------+
2 rows in set (0.00 sec)

mysql> 
```

您只需将命令发送到 MySQL 命令行客户端。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T00:14:14.463

如果您想在不调用命令行客户端的情况下执行此操作，这是 PHP 中的一种方法。请注意，这是非常粗略的代码，我还没有测试过，我主要是想解释这个过程。它还将左对齐所有内容，我相信 mysql 客户端右对齐数字，模拟这将需要更多的工作，但没有什么困难。

假设您已经`$resultset`使用类似 mysqli_result 的`fetch_all()`函数将记录提取到名为 的仅关联数组中：

```
// determine maximum value lengths for each column
foreach ($resultset as $result)
{
    foreach ($result as $col => $val)
    {
        if (strlen($val) > $max_length[$col])
        {
            $max_length[$col] = strlen($val);
        }
    }
}

// construct border lines
foreach ($max_length as $col_length)
{
    $border_line .= '+'.str_repeat('-', $col_length+2);
}
$border_line .= "+";

// print header
print $border_line."<br />\n";
foreach ($max_length as $col_name => $col_length)
{
    print '| '.str_pad($col_name, $col_length, ' ').' |';
}
print "<br />\n";
print $border_line."<br />\n";

// print data
foreach ($resultset as $result)
{
    foreach ($result as $col => $val)
    {
        print '| '.str_pad($val, $max_length[$col], ' ').' |';
    }
    print "<br />\n";
}
print $border_line."<br />\n"; 
```

# c++ - 每个 C 或 C++ 文件都应该有一个关联的头文件吗？

> ID：608631
> 
> 赞同：16
> 
> 时间：2009-03-03T23:06:34.750
> 
> 标签：c++, c, header-files

每个 .C 或 .cpp 文件都应该有一个头 (.h) 文件吗？

假设有以下 C 文件：

1.  主.C

2.  功能1.C

3.  函数2.C

4.  函数3.C

在`main()`Main.C 文件中的位置。应该有四个头文件

1.  主文件

2.  函数1.h

3.  函数2.h

4.  函数3.h

或者所有 .C 文件应该只有一个头文件？

什么是更好的方法？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-03T23:23:28.610

首先，拥有 a 是不寻常的，`main.h`因为在编译时通常不需要向其他编译单元公开任何内容。`main()`函数*本身*需要为链接器或启动代码公开，但它们不使用头文件。

每个 C 文件可以有一个头文件，或者在我看来，更可能的是一*组*相关C 文件的头文件。

一个例子是，如果您有一个 BTree 实现，并且您已将添加、删除、搜索等放在它们自己的 C 文件中，以最大限度地减少代码更改时的重新编译。

在这种情况下，每个 C 文件都有单独的头文件是没有意义的，因为头文件是 API。换句话说，它是用户看到的图书馆的视图。使用您的代码的人通常很少关心您如何构建源代码，他们只是希望能够编写尽可能少的代码来使用它。

强迫他们包含多个不同的头文件，以便他们可以创建、插入、删除和搜索一棵树，这可能会让他们质疑你的理智:-)

最好使用*一个* `btree.h`文件和一个`btree.lib`包含所有从单个 C 文件构建的 BTree 目标文件的文件。

* * *

另一个例子可以在标准 C 头文件中找到。

我们不确定是否所有`stdio.h`函数都有多个 C 文件（我会这样做，但这不是唯一的方法），但即使有，它们也被视为一个单元API。

您不必包含`stdio_printf.h`，`stdio_fgets.h`等等 - `stdio.h`C 运行时库的标准 I/O 部分有一个。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-03T23:42:52.277

1.  头文件不是强制性的。

2.  `#include`只需复制/粘贴包含的任何文件（包括 .c 源文件）

3.  实际项目中常用的是全局头文件`config.h`，`constants.h`其中包含常用信息，例如编译时标志和项目范围的常量。

4.  一个好的库 API 设计是使用一组头文件公开一个官方接口，并使用一组内部头文件来实现所有细节。这为 C 库添加了一个很好的额外抽象层，而不会增加不必要的膨胀。

5.  使用常识。C/C++ 真的不适合没有它的人。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-04T22:37:15.967

我曾经遵循“视情况而定”的趋势，直到我意识到一致性、统一性和简单性比节省创建文件的工作量更重要，并且“标准即使不好也是好的”。

我的意思是：一对 .cpp/.h 文件几乎是所有“模块”最终的结果。使这两个需求都存在可以避免很多混乱和糟糕的工程设计。

例如，当我在头文件中看到某些东西的接口时，我确切地知道在哪里搜索/放置它的实现。相反，如果我需要公开以前隐藏在 .cpp 文件中的某些东西的接口（例如，静态函数变成全局的），我知道该把它放在哪里。

我见过太多*不*遵守这条简单规则的不良后果。不必要的内联函数、违反任何关于封装的规则、接口和实现的（非）分离、错误放置的代码等等——这一切都是因为从未添加过适当的同级头文件或 cpp 文件。

所以：始终定义 .h 和 .c 文件。让它成为一个标准，遵循它，并安全地*依赖*它。这样生活就简单多了，简单*是*软件中最重要的事情。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-03T23:09:25.070

通常，最好为每个 .c 文件创建一个头文件，其中包含要公开的 .c 文件中的函数等声明。这样，另一个 .c 文件可以包含 .h 文件以获得它需要的功能，并且如果它不包含的头文件发生更改，则不需要重新编译。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-03T23:08:53.323

通常每个 .c/.cpp 文件都有一个 .h 文件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-03T23:20:41.143

这取决于。通常，您拥有单独的 .c 文件的原因将决定您是否需要单独的 .h 文件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-04T13:18:52.673

我喜欢将接口放入头文件并在 cpp 文件中实现。我不喜欢编写 C++，我需要将成员变量和原型添加到标头，然后在 C++ 中再次添加方法。我更喜欢这样的东西：

模块.h

```
struct IModuleInterface : public IUnknown
{
    virtual void SomeMethod () = 0;
} 
```

模块.cpp

```
class ModuleImpl : public IModuleInterface,
                   public CObject // a common object to do the reference
                                              // counting stuff for IUnknown (so we
                                              // can stick this object in a smart 
                                              // pointer).
{
    ModuleImpl () : m_MemberVariable (0)
    {
    }

    int m_MemberVariable;

    void SomeInternalMethod ()
    {
        // some internal code that doesn't need to be in the interface
    }

    void SomeMethod ()
    {
        // implementation for the method in the interface
    }

    // whatever else we need
}; 
```

我发现这是一种分离实现和接口的非常干净的方法。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-03-14T03:02:09.927

Bjarne Stroustrup 在他的《C++ 编程语言》一书中很好地解释了它......

当程序很小并且其部分不打算单独使用时，物理分区的单头样式最有用。当使用命名空间时，程序的逻辑结构仍然可以在单个头文件中解释。

对于较大的程序，单个头文件方法在传统的基于文件的开发环境中是行不通的。对公共头文件的更改会强制重新编译整个程序，并且几个程序员对单个头文件的更新很容易出错。除非非常重视严重依赖命名空间和类的编程风格，否则逻辑结构会随着程序的增长而恶化。

另一种物理组织让每个逻辑模块都有自己的标题来定义它提供的设施。然后每个 .c 文件都有一个对应的 h。文件指定它提供什么（它的接口）。每个 .c 模块都包含自己的 .h 文件，通常还包含其他 .h 文件，这些文件指定了它需要其他模块提供的内容，以实现在其接口​​中公布的服务。这种物理组织对应于模块的逻辑组织。多头方法可以很容易地确定依赖关系。单头方法迫使我们查看任何模块使用的每个声明并确定其是否相关。一个简单的事实是，代码的维护总是使用不完整的信息并从本地角度进行。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-03T23:24:48.387

没有更好的方法，只有常见和不太常见的情况。

更常见的情况是当你有一个类/函数接口来声明/定义时。最好只有一个带有定义的 .cpp/.c 和一个用于声明的标头。给它们起相同的名字可以很容易地理解它们是直接相关的。

但这不是“规则”，这是几乎所有情况下最常见且最有效的方式。

现在在某些情况下（比如模板类或一些微小的结构定义）你不需要任何 .c/.cpp 文件，只需要标题。例如，我们经常只在头文件中定义一些虚拟类接口，只有虚拟纯函数或普通函数。

而在其他极少数情况下（如假设的 main.c/.cpp 文件），并不总是需要允许来自外部编译单元的代码调用给定编译单元的函数。main 函数是一个示例（不需要标头/声明），但还有其他的，主要是当它是“将所有其他部分连接在一起”并且不被应用程序的其他部分调用的代码时。这是非常罕见的，但在这种情况下，标题没有意义。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-04T13:50:39.693

这完全是关于哪些代码需要知道哪些其他代码。您希望将其他文件知道的数量减少到最低限度，以便他们完成工作。

他们需要知道一个函数是否存在，他们需要传递什么类型，以及它将返回什么类型，但不知道它在内部做什么。请注意，从程序员的角度来看，了解这些类型的实际含义也很重要。（例如，哪个 int 是行，哪个是列）但代码本身并不关心。这就是为什么明智地命名函数和参数是值得的。

正如其他人所说，如果 cpp 文件中没有任何内容值得暴露给代码的其他部分，就像 main.c 一样，那么就不需要头文件。

有时值得将您想要公开的所有内容放在一个头文件中（例如，Func1and2and3.h），以便了解 Func1 的任何人也了解 Func2，但我个人并不热衷于此，因为这意味着您往往会加载大量垃圾以及您真正想要的东西。

**总结：** 想象一下，你相信有人会写代码，并且他们的算法、设计等都很好。您想使用他们编写的代码。所有你需要知道的是给他们什么来让事情发生，你应该给什么，你会得到什么。这就是头文件中需要包含的内容。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-04T13:53:17.083

如果您的文件公开了一个接口——也就是说，如果它具有将从其他文件调用的函数——那么它应该有一个头文件。否则，它不应该。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-03T23:25:45.217

如前所述，通常每个源文件（.c 或 .cpp）都有一个头文件 (.h)。

但是，您应该查看文件的内聚性。如果各种源文件提供单独的、可单独重用的功能集——一个理想的组织——那么每个文件当然应该有一个头文件。但是，如果这三个源文件提供了一组复合函数（太大而无法放入一个文件中），那么您将使用更复杂的组织结构。主程序使用的外部服务将有一个标头 - 其他需要相同服务的程序将使用该标头。合作的源文件还将使用第二个标头，该标头提供这些文件共享的“内部”定义。

（Pax 也指出）：主程序通常不需要自己的头文件——其他源代码不应使用它提供的服务；它使用其他文件提供的服务。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-03T23:30:05.067

如果您希望从另一个编译单元使用您的编译代码，您将需要头文件。在某些情况下，您现在确实需要/想要拥有标题。

第一种情况是 main.c/cpp 文件。这个类并不意味着包含在内，因此不需要头文件。

在某些情况下，您可以拥有一个头文件，该文件定义一组不同实现的行为，这些实现通过在运行时加载的 dll 加载。将有一组不同的 .c/.cpp 文件实现相同标头的变体。这在插件系统中很常见。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-03T23:44:44.220

通常 cpp/c 文件用于实现，而 h/hpp（hpp 不经常使用）文件用于头文件（仅原型和声明）。Cpp 文件并不总是必须有一个与之关联的头文件，但它通常会这样做，因为头文件充当 cpp 文件之间的桥梁，因此每个 cpp 文件都可以使用来自另一个 cpp 文件的代码。

应该强烈执行的一件事是在头文件中不使用代码！由于重新定义，头文件在任何大小的项目中都会中断编译的次数太多了。这只是当您将头文件包含在 2 个不同的 cpp 文件中时。头文件也应始终设计为包含多次。永远不应包含 Cpp 文件。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-04T00:13:22.733

一般来说，我认为 .h 和 .c 文件之间没有任何明确的关系。在许多情况下（可能是大多数情况下），一个代码单元是具有公共接口 (.h) 和不透明实现 (.c) 的功能库。有时需要一些符号，比如枚举或宏，而你得到一个没有对应 .c 的 .h，在少数情况下，你会得到一堆没有公共接口和对应 .h 的代码

特别是，有很多时候，为了可读性，头文件或实现（很少两者）太大而多毛，以至于为了程序员的理智，它们最终被分成许多较小的文件。

# ruby-on-rails - 在没有网络连接的情况下进行本地开发有哪些提示和技巧？

> ID：608632
> 
> 赞同：1
> 
> 时间：2009-03-03T23:07:26.603
> 
> 标签：ruby-on-rails, development-environment

大家偶尔，我在没有网络连接的咖啡店。在这些场合，我喜欢在我的笔记本电脑上使用本地的所有代码和工具。我在本地签出代码，在本地运行 mysql，然后下载所有[API 文档](http://whatcodecraves.com/articles/2009/02/28/rails_and_gems_documentation_anywhere/index.html)。当您没有网络时，您会使用哪些工具和技巧？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-03T23:15:25.353

1.  [吉特](http://git-scm.com/)。
2.  一些备忘单（以前的 www.ILoveJackDaniels.com [）](http://www.addedbytes.com/)
3.  ...
4.  利润？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T04:14:02.787

用于测试服务器和虚拟服务器的 DNS 技巧（实际上没有启动 DNS 的网络路径）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T23:40:38.757

[我是SVK](http://svk.bestpractical.com/view/HomePage)离线开发的忠实粉丝。它本质上是一个围绕 svn 的包装器，允许您创建本地分支，您可以在没有连接的情况下使用这些分支。您可以根据需要随时提交到该本地分支，当您回到连接范围内时，让所有内容再次同步是一件简单的事情。

[这里](http://www.bieberlabs.com/svk-tutorials/)有一些介绍性教程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T07:43:11.637

我将问题转过来：当网络连接可用时，有哪些开发技巧和窍门？我想到的一个重要答案是——谷歌。

我是认真的。好吧，也许这还不是全部（更频繁的集成可能是我在线时做的另一件事）。但至少就我而言，当我离开互联网时，我的工作系统并没有真正改变太多。我需要和使用的所有东西都在我的笔记本电脑上（git 是最重要的东西之一）。

我的小费呢？

试着接受你没有联系的事实。没有互联网，就没有 Twitter、Facebook、Feed 阅读器和所有那些让人分心的东西，这意味着——你实际上可以做你的工作。:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-03T23:16:04.057

不太确定你在做什么......我假设你已经在你的机器上安装了 Rails？

当我在本地开发时，我喜欢使用 MAMP Pro，但如果您只是使用 Rails 应用程序，即使这有点无关紧要。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-03T23:22:53.760

为什么我需要网络连接？在这台笔记本电脑上，这是我的主要开发机器，我有：

*   三个 C++ 编译器和 IDE
*   一个 Pascal 编译器和 IDE
*   两个 smalltalk 实现
*   爪哇
*   php
*   perl
*   Python
*   红宝石
*   tcl/tk
*   三个不同的网络服务器
*   四个不同的 SQL 数据库服务器
*   颠覆、git 和 CVS 客户端
*   颠覆服务器（也是 CVS 服务器，但我不使用它）
*   开发办公室
*   各种 OpenDoc 工具
*   赛格温
*   emacs
*   vim

加上以上所有文件。我还需要什么？

**编辑：**这一切都在一个 9 岁的索尼笔记本 900Mhz CPU 上，在 256Mb 的 RAM 中运行 W2K。显然，我不会一次运行所有东西，但我可以毫无问题地运行 Apache 与 PHP、SQL Server 和几个 C++ IDE。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-03T23:27:18.163

我最好的离线资源是一个聪明的同事。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-03T23:34:54.353

我想我会建议尝试跟踪您定期使用的可能需要网络的工具（虚拟机、源代码控制、错误跟踪）和资源（文档、网站、博客）。

然后，自动从这些资源中检索您需要的内容（想到使用 RSS 提要），以便可以无缝地离线使用它们。至于源代码控制，可以使用分布式系统（例如[Git](http://en.wikipedia.org/wiki/Git_(software))或[Mercurial](http://en.wikipedia.org/wiki/Mercurial_(software))）。

在任何情况下，简单地了解一个人定期使用什么都是一个好主意。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-04T03:00:19.523

*   依赖控制：提前了解网络和环境中的东西，一般来说，你的应用程序依赖于什么。最小化这些依赖关系，将它们记录在案。应该已经是这样了，这是好的设计和好的开发实践；能够在咖啡店工作只是一个副作用。
*   缓存：缓存读取 - 提前确保您需要的 Internet 子集（文档、工具、数据等）在您的笔记本电脑上。写入缓存 - 我想是由 Git 之类的东西提供的。
*   虚拟化：这些方法通过模拟它所依赖的环境来呈现应用程序。我还不确定它的泛化有多有用，或者“虚拟化”是否是最好的词。我想存根、模拟器和模拟对象都属于这一类。属于该类别的一个技巧是使用 /etc/hosts 条目来解决应用程序停止问题，因为有人在其中硬编码了外部服务器名称。

# iphone - UIViewController 内存泄漏问题

> ID：608634
> 
> 赞同：9
> 
> 时间：2009-03-03T23:08:26.617
> 
> 标签：iphone, memory-management, camera

与有关创建和销毁 UIImagePickerController 实例的已知内存泄漏问题类似，我发现有关 UIViewController 类实例的类似问题。使用 UIImagePickerController 的推荐方法是创建一次实例并在应用程序的生命周期内保留它，尽管这会占用您在其他地方可能需要的内存。

我正在处理的情况涉及 UIViewController 类的 2 个实例。在启动时，创建第一个实例并将其视图添加到另一个“主”UIViewController 类，该类是 MainWindow.xib 的一部分。在第一个实例上是一个“信息”按钮，当点击该按钮时，将切换到 UIViewController 类的新实例（如果尚未创建）。“主” UIViewController 使用通常的翻转动画来管理这种切换。基本设置可以在 Dave Mark 的“Beginning iPhone Development: Exploring the iPhone SDK”一书中看到。

出现的问题是，一旦第一次点击“信息”按钮，内存就会分配给新的第二个 UIViewController 实例，并且直到应用程序结束才释放。由于此信息视图上的元素数量，它在实例化后使用大约 1MB 的内存，并且它的视图被添加到超级视图中。任何持续销毁和重新创建此实例的尝试都会导致内存泄漏，类似于您尝试对 UIImagePickerController 类的实例执行相同操作时存在的内存泄漏。我怀疑两个类之间的根本原因是相同的。

我的问题的症结在于在允许用户使用相机拍照之前需要释放尽可能多的内存。然而，一旦用户拍照并且他们第一次看到生成的图像，他们就可以点击第一个 UIViewController 实例上的“信息”按钮。一旦被点击，“主” UIViewController 将删除现有 UIViewController 的视图并将其替换为信息屏幕的视图。信息屏幕有一个“返回”按钮来切换视图。但是，一旦用户离开信息屏幕并选择用相机拍摄另一张照片，分配给信息屏幕的内存仍在内存中。

UIImagePickerController 类在释放其内部引用和调用“imagePickerController:didFinishPickingImage”委托之前处理 2 兆像素图像时临时使用了近 15-18MB。一旦通过信息按钮创建了第二个 UIViewController 实例，然后用户选择拍摄另一张照片，我就会遇到内存不足的警报。

在我的情况下，无论您是否一遍又一遍地点击信息按钮，内存在技术上都不会泄漏，但是由于您无法控制的有关 iPhone（Safari 等）上后台进程的其他问题，您必须释放在使用相机之类的东西时尽可能多地使用内存。

关于如何干净地创建和销毁 UIViewController 类的实例以使内存不泄漏的任何建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T02:17:32.300

您是否从 NIB 加载第二个视图控制器？如果是这样，您将需要检查您是否正确释放了关联的内存。

这是我的项目中典型的基于 NIB 的视图控制器的样子。

### SomeViewController.h

```
@interface SomeViewController : UIViewController {
    UILabel *someLabel;
}

@property (nonatomic, retain) IBOutlet UILabel *someLabel;

@end 
```

### SomeViewController.m

```
@implementation SomeViewController

@synthesize someLabel;

- (void)dealloc {
    // Release our retained IBOutlets
    self.someLabel = nil;
    [super dealloc];
}

@end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T04:45:21.057

减少内存使用的一种方法是将图像调整为您想要的任何大小（当然，除非您想要 320x480 图像）。这对我来说很有帮助。

您正在谈论的第二个视图控制器是否发生了变化？如果不是，那么最好将其设为单例并使用相同的实例。您可以随时更改视图控制器使用的值。[本文](http://cocoawithlove.com/2008/11/singletons-appdelegates-and-top-level.html)解释了如何创建单例对象（附代码）

[此处的另一篇文章](http://kosmaczewski.net/projects/iphone-image-cache/)展示了单例类的使用（虽然与您的用例不同，但它将阐明如何使用单例）

我建议也为 UIImagePickerController 创建一个单例对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T20:45:29.813

您的所有权链中有任何循环吗？就像是：

```
@interface FirstViewController: UIViewController {
  SecondViewController *secondViewController;
}
@end

@interface SecondViewController: UIViewController {
  FirstViewController *firstViewController;
}
@end 
```

如果你在丢弃这些视图控制器时没有明确打破这个循环，它们就会泄漏。

另外，我相信您有责任在不再需要时释放从 nib 文件加载的所有顶级对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-23T20:28:39.110

也许您可以在转换到信息视图之前保存图像。保存后，释放图像，然后过渡到信息视图。如果用户返回，则从文件夹中加载图像。

# java - Java中的序列化是什么？

> ID：608647
> 
> 赞同：22
> 
> 时间：2009-03-03T23:13:23.157
> 
> 标签：java

> **可能重复：**
> [什么是对象序列化？](https://stackoverflow.com/questions/447898/what-is-object-serialization)

我使用 Swing 制作了一个小型 RSS 阅读器应用程序，Eclipse 一直告诉我“可序列化类 MochaRSSView 没有声明 long 类型的静态最终 serialVersionUID 字段”

什么是序列化，它有什么好处？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-03T23:17:04.943

Serializable 是一个标记接口，它告诉 JVM 它可以将对象的状态写出到某个流（基本上读取所有成员，并将它们的状态写到一个流，或者磁盘或其他东西）。默认机制是二进制格式。您还可以使用它来克隆事物，或在调用之间保持状态，通过网络发送对象等。

您可以让 eclipse 为您生成一个（基本上只是一个长的随机但唯一的 ID）。这意味着您可以控制何时认为某个类与序列化版本兼容。

（注意：所有非瞬态成员变量必须是可序列化的类，否则您将收到错误 - 因为 JVM 将通过结构递归写出每个对象的状态，直至将原语写入 ObjectOutputStream 的级别） .

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2012-01-19T13:07:58.597

**Java序列化-----你见过序列化对象里面是什么吗？我将向您解释什么是 java 序列化，然后为您提供序列化的示例。最后最重要的是，让我们探索序列化对象内部的内容及其含义。那是java序列化的内部结构以及它是如何工作的。如果你想拥有自己的java序列化实现，本文将为你提供一个很好的启动平台。**

什么是 Java 序列化？java 序列化的主要目的是将对象写入流中，以便它可以通过网络传输，并且可以再次重建该对象。当涉及到两个不同的参与方时，您需要一个协议来再次重建完全相同的对象。Java 序列化 API 只是为您提供了这一点。您可以利用序列化功能的其他方法是，您可以使用它来执行深层复制。

为什么我在上面的定义中使用“主要目的”是，有时人们使用 java 序列化作为数据库的替代品。只是一个占位符，您可以在其中跨会话保留对象。这不是 java 序列化的主要目的。有时，当我采访 Java 的候选人时，我听到他们说 Java 序列化用于存储（保存状态）对象和检索它。他们将其与数据库同义使用。这是对序列化的错误认识。

你如何序列化？当您想要序列化一个对象时，相应的类应该实现可序列化的标记接口。它只是通知编译器这个 java 类可以被序列化。您可以标记不应序列化为瞬态的属性。您打开一个流并将对象写入其中。Java API 负责序列化协议，并将 java 对象保存在符合协议的文件中。反序列化是将对象从文件中恢复为原始形式的过程。

这里的协议意味着，序列化人和反序列化人之间的理解。包含序列化对象的文件的内容是什么？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-03T23:16:24.883

序列化是将对象写入可读的形式，并允许在不同的时间重新创建对象。因此，如果我在计算机 A 上的一个 JVM 下创建了一个小部件，对其进行序列化并保存并将其发送到运行不同的计算机 B，则另一个 JVM 将能够对其进行反序列化并使用相同的值和结构重新创建它

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-03T23:31:15.830

Java 序列化是一种持久化对象结构的方法。

`serialVersionUID`将可序列化类声明为`private static final long`编译时常量是最佳实践。这用于检查对象数据和类代码是否声称是兼容的。

那么为什么 Eclipse 会告诉你这个呢？可能，您正在扩展的类（或您正在实现的潜在接口）实现了`java.io.Serializable`. 这意味着所有子类型，包括您的子类型都是可序列化的。几乎可以肯定你不在乎。您应该能够通过应用`@SuppressWarnings("serial")`类或包（在 中`package-info.java`）来清除警告。如果您想强制阻止您的类的实例被序列化，请添加（从内存中）：

```
private static final java.io.ObjectStreamField[] serialPersistentFields = {
    null
};
private void writeObject(
    java.io.ObjectOutputStream ou
) throws java.io.IOException {
    throw new java.io.NotSerializableException();
}
private void readObject(
    java.io.ObjectInputStream in
) throws java.io.IOException, java.lang.ClassNotFoundException {
    throw new java.io.NotSerializableException();
}
private void readObjectNoData(
) throws java.io.ObjectStreamException {
    throw new java.io.NotSerializableException();
} 
```

它可能不是世界上经过深思熟虑的系统（尽管它比许多人认为的要好得多）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-03T23:17:29.590

[序列化](http://en.wikipedia.org/wiki/Serialization)是将对象转换为磁盘存储格式的过程，以便稍后重新加载它。检查链接以获取更多信息！

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-03T23:17:47.390

序列化是一种获取对象（类的实例）并将其设置为传输的方法——通过网络、到磁盘等。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-03T23:19:29.493

序列化是将对象实例的表示写入流（或字节序列）的过程。看看 Sun 怎么说：http: [//java.sun.com/developer/technicalArticles/Programming/serialization/](http://java.sun.com/developer/technicalArticles/Programming/serialization/)

# c# - 实体框架/WCF 连接顺序

> ID：608652
> 
> 赞同：0
> 
> 时间：2009-03-03T23:16:09.360
> 
> 标签：c#, wcf, entity-framework

在系统中出现一些奇怪的行为。这是怎么回事：

我有一个 main 在打开读/写通道之前使用 WCF 设置服务器端点。

我还有一个基于实体框架的数据库抽象层。当我实例化我的数据库类时，我连接到数据库。

我的一个端点包含这个 DB 抽象类。在向 WCF 注册端点后，我实例化了数据库对象。

如果我按以下顺序执行：
将服务添加到 WCF
连接到 DB
打开 WCF 端点以进行读/写

我在传输上出错。

如果我按此顺序执行此操作：
打开 WCF 端点以进行读/写
将服务添加到 WCF
连接到数据库

一切正常。

诚然，我对为什么会发生这种情况感到相当迷茫，任何想法都将不胜感激，如果您愿意告诉我您需要的更多信息，我将很乐意发布。谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T17:31:01.973

设法解决了这个问题，以防有人对此感到疑惑。

当 WCF 层启动时，我们有一种方法可以将已知类型添加到我们的序列化系统中。

WCF 不想序列化抽象或泛型类型，但 OR 框架广泛使用它们。当我们在进行这种类型收集之前连接数据库时，WCF 会在反序列化阶段遍历泛型类型时打嗝。

添加检查以确保类型在添加到该集合之前不是抽象或通用的，从而解决了问题。

# c# - C# 货币转字符串

> ID：608667
> 
> 赞同：13
> 
> 时间：2009-03-03T23:24:26.487
> 
> 标签：c#

我正在查询一个返回货币值的数据库字段，我将其分配给一个字符串，但它最后添加了额外的 00。

例如查询返回`30.00`

我将它分配给一个字符串 ( `string value = Convert.ToString(ReturnValue);`) 但是当我输出它时，它显示为`30.0000`

你能告诉我哪里出了问题以及解决这个问题的最佳方法吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-03T23:58:40.380

马格里夫，

我最好的建议是使用 SqlMoney 类型将其转换为双精度。从那里，您可以随心所欲地输出它！

这是一个例子：

```
System.Data.SqlTypes.SqlMoney ReturnValue;

//Set your returnValue with your SQL statement
ReturnValue = ExecuteMySqlStatement();

//Get the format you want

//$30.00
string currencyFormat = ReturnValue.ToDouble().ToString("c");

//30.00
string otherFormat = ReturnValue.ToDouble().ToString("0.00"); 
```

有关更多格式选项，请查看 MSDN：

[http://msdn.microsoft.com/en-us/library/system.double.tostring.aspx](http://msdn.microsoft.com/en-us/library/system.double.tostring.aspx)

祝你好运，我希望这会有所帮助。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-03T23:25:22.363

您可以在 ToString 调用中使用[字符串格式代码](http://msdn.microsoft.com/en-us/library/0c899ak8.aspx)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-03T23:33:50.020

您希望使用货币字符格式化您的字符串吗？

如果是这样的话...

```
decimal m = 3.4;

string s = string.Format("{0:c}", m);

// s will be £3.40, $3.40, etc depending on your locale settings 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-03T23:32:50.117

我会使用类似的东西

```
string value = ReturnValue.ToString("0.00"); 
```

这使用接受格式字符串的 ToString 重载。上述格式字符串“0.00”指定两位小数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-06-08T01:38:58.993

我目前正在开发一个boatdock web 系统，使用 VS 2013 社区版。我试图弄清楚如何将货币值输出到文本框中。

我使用的方法是

fieldName.Text = decimalValue.ToString("c");

它完美地工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-03T23:32:28.383

试试这个：

```
yourValueHere.ToString("0.00") 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-08-11T07:03:40.953

我的建议是首先将其转换为十进制。我会使用这样的东西：

```
string value = (Convert.ToDecimal(ReturnValue)).ToString("0,0.00"); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-03T23:34:36.397

在 SQLServer 中，money 数据类型相当于具有 4 个小数位精度的小数。我会假设这是在小数转换为字符串时保留的精度。最好的选择是在进行转换时始终使用格式字符串，例如“#,##0.00”。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-03T23:43:46.923

Money 数据类型的精度为小数点后 4 位。您需要在 ToString() 参数中指定格式，或者您可以在转换为字符串之前对值进行四舍五入。

如果你使用 .ToString() 据我所知，你没有得到任何舍入。我认为你只是失去了数字。

如果你四舍五入，你不只是砍掉数字。这是舍入示例（未经测试的代码）：

```
string value = Math.Round(ReturnValue, 2).ToString(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-02-03T17:59:49.017

```
string value = (Convert.ToDecimal(ReturnValue)).ToString("c"); 
```

c 是货币 p 的百分比。您可以使用[其他字母列表。](https://docs.microsoft.com/en-us/dotnet/standard/base-types/standard-numeric-format-strings)

# architecture - 对于需要相互通信的多个游戏服务器来说，最好的架构是什么？

> ID：608674
> 
> 赞同：1
> 
> 时间：2009-03-03T23:26:22.877
> 
> 标签：architecture, cloud, distributed-computing

该游戏是一款低图形（SVG）战略游戏。每个服务器代表一个游戏域及其玩家。所有服务器都应该能够相互交谈，因为玩家可以（在游戏中）从一个域移动到另一个域/发送“外交信使”等。

我们选择了这个想法，因为它使我们能够无休止地扩大世界地图，它使第二方能够将他们的游戏服务器连接到我们，并且让他们更加扩大世界。如果一台服务器（及其备份）出现故障，游戏仍将继续运行（真正的分布式环境）。

我们才刚刚开始。我们应该关注哪些平台，这将有助于我们开发这样一个世界？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-03T23:29:50.030

XMPP，以前称为 Jabber，可能是一个不错的起点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T09:02:23.147

这在很大程度上取决于您希望在服务器之间共享多少数据。您希望每台服务器处理它自己的域，但是帐户数据库、关于谁拥有什么信息的数据、域的拓扑、这些数据将是集中的和/或分布式的，以及如何使它们保持同步。因此，除了游戏的运作之外，还有另一组元数据，服务器需要与之通信。至于游戏数据，您可能会传递事件、数据对象以及有关数据所有权和控制权的信息。除此之外，还必须有一些游戏内时钟元数据来保持域时间同步。

我可能会为元数据、请求和响应消息使用具有不同优先级的异步队列系统。交换消息之上的 XMPP 等协议可以为您带来存在信息、身份验证、加密和其他优势。但一开始，传递协议本身并不像消息的结构和数据的交换那么重要。本质上，交付协议是可互换的。

**示例**：*一名玩家将游戏单元 X 从域 A 发送到域 B。域 A 服务器将带有事件的消息发送到域 B 服务器。在处理事件队列时，B 接收消息并向 A 上的请求队列发送请求，以获取有关单元 X 的数据以及控制/修改单元 X 数据的权限。请求队列具有更高的优先级，将在域 A 上的其他事件之前处理. 域 A 将请求的数据和控制令牌发送到具有最高优先级的域 B 响应队列。同时域 B 服务器已经处理了 3 个其他事件，没有在会话中等待。*

*   注意：*此时 A 应废弃、版本化或删除有关单元 X 的数据。如果请求来自域 C 的数据，它应该从现在开始将此请求转发到服务器 B。*
*   注意：*上面的例子可以优化为直接用相应的事件发送关于单元 X 的数据，但我想用一个简单的例子来说明。*

重要的是您必须设计数据封装协议，可能是一些 XML 模式。事件处理协议。事件列表、允许的响应、错误消息、恢复。这些都是特定于游戏的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T23:35:14.477

我会认真考虑 Erlang 和 CouchDB，或者在 Google AppEngine 下实现它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T01:05:52.840

如果它真的是分布式的，那么我猜没有中央服务器的计划。这意味着您真正需要的是各种服务器之间的通信机制。REST 和 XML-RPC 都是非常简单的机制，使服务器能够相互通信以传达用户需要从一个移动到另一个的通信。

正如丹尼尔所说，你也可以使用像 XMPP 这样的东西，但这意味着你必须将另一组服务器软件与运行游戏本身的任何东西挂钩（我从你的描述中猜测可能是一个网络）某种应用服务器）。

从开发的角度来看，任何强大的开发 Web 应用程序的语言/框架都应该可以工作。Ruby on Rails、Python on Django、众多框架加上 Java，甚至是带有 PHP (ick) 的 Cake 都可以用于开发工作。

我过去曾考虑过类似的事情，但审查各种服务器的问题（即，您如何处理损坏或恶意的服务器，并让玩家同时将同一块移动到两个或三个其他服务器上），处理退出服务器（最后存在的玩家会发生什么）等似乎非常具有挑战性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-11T17:44:54.393

我认为首先要回答的问题是游戏是实时的还是事件驱动的，以及客户端是否是浏览器。听起来它是事件驱动的，但请记住，服务器无法有效地将结果推送到纯 HTML 客户端，只能推送到 Java 小程序、嵌入式 Flash 电影等。如果您有自定义客户端，则无需使用 HTTP服务器上的-style系统，意味着服务器->服务器和服务器->客户端通信可以以相同的方式完成。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-05-29T22:07:48.717

你应该看看关于 p2p 游戏的“兴趣管理”论文，你会遇到非常有趣的方法。Google Schoolar 将为您呈现非常好的论文。

但请注意，开发分布式应用程序比简单的单服务器方法要复杂得多。

# c# - 规划并行性

> ID：608680
> 
> 赞同：0
> 
> 时间：2009-03-03T23:29:52.667
> 
> 标签：c#, .net, parallel-processing

如果您计划编写一个计算量非常大的并行应用程序，您将使用哪些准则来设计您的对象（无论是类还是结构，或其他任何东西），以最大限度地发挥并行性的潜力。

我正在考虑一个应用程序，它解释/编译需要创建东西的树状对象图，将其传递给另一个要处理的对象，依此类推，具有树状结构。

从早期设计过程中应该考虑什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-03T23:32:17.043

如果您可以避免使用大量不可变的数据结构，那将为您节省大量时间、打字和头痛。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T23:41:25.057

如果您正在创建内容然后将其传递以进行处理，那么几乎可以肯定您可以设计您的应用程序以利用[消息传递](http://en.wikipedia.org/wiki/Message_passing)和**对象隔离。**

第一步将是确定责任，即确定谁将处理什么。每个人都被一个盒子包围。

第二步将定义你的盒子之间的信息流，也就是说，如果 A 产生 X……谁来消费它？

在这两个步骤之后，您将获得一个**简单的图表，其中叶子代表工人，箭头代表消息。**每个箭头代表一个**依赖顺序**（也就是说，如果一个箭头从 A 指向 B，那么 A 需要在 B 之前执行）。

有了这个，您将能够以易于查看、易于显示的图形轻松查看可以并行执行哪些操作以及哪些操作确实是顺序的。

然后只需实现一个[管道](http://www.stackframe.net/en/content/06-2008/data-types-pipe)结构，让您**在工作人员之间传递消息，**以便每个工作人员都有一个工作管道。

最后一点：一旦原始设计完成，重构它以进行改进相对容易。例如，进行相同工作的节点可以共享工作 PIPES，以便 8 个语法分析器从“词法令牌”管道中消费，或者更改它以便工作人员可以从其他工作人员管道中“窃取”工作等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-07T23:28:33.953

Jorge Córdoba 上面描述的模式只是一种方法。以下内容绝对值得一读：

[http://www.amazon.com/Patterns-Parallel-Programming-Software/dp/0321228111](https://rads.stackoverflow.com/amzn/click/com/0321228111)

这在很大程度上取决于您的数据之间的依赖关系，以及分解问题的最佳方法。例如，Master-Worker 和单程序多数据 (SPMD) 等模式往往是非常简单的方法，如果您的问题适合于 sunch 和方法。

# c# - Word 自动化找出书签是否在表格中

> ID：608684
> 
> 赞同：2
> 
> 时间：2009-03-03T23:30:46.843
> 
> 标签：c#, vbscript, automation, word

我正在使用 Word Automation 来操作一些文档（yuk！）。我正在使用此命令在文档中获取书签。

```
Object oBookmark = "MyBookmarkName";
Range oRngoBookmark = wordDocument.Bookmarks.get_Item(ref oBookmark).Range; 
```

我想知道的是该书签是否在文档的表格中。有没有简单的方法可以做到这一点？

我在 .NET 应用程序中从 C# 调用此代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T01:08:46.033

我不确定这将如何与 .net 一起使用，但这里有一个展示这个想法的宏。对象模型往往是相同的，所以我认为从 VBA 转换为 C# 并不难。

```
Sub BookmarksInTables()
    Dim aTable As Table
    Dim aBookmark As Bookmark

    For Each aBookmark In ActiveDocument.Bookmarks
        For Each aTable In ActiveDocument.Tables
            'If start of book mark is inside the table range or
            ' the end of a book mark is inside the table range then YES!
            If (aBookmark.Range.Start >= aTable.Range.Start _
                And aBookmark.Range.Start <= aTable.Range.End) _
            Or (aBookmark.Range.End >= aTable.Range.Start _
                And aBookmark.Range.End <= aTable.Range.End) Then
                MsgBox aBookmark.Name + " is inside a table"
            Else
                MsgBox aBookmark.Name + " is not inside a table"
            End If
        Next
    Next
End Sub 
```

它通过检查书签的开始或结束是否在每个表的范围内（在整个文档中）来工作。如果书签的任何部分在表格内，它将起作用。

或者，如果您需要确定书签是否*仅*在表格内，您需要检查书签的开始是否大于或等于表格的开始***以及***书签的结束是否小于或等于表格的结束.

——克里斯

# c# - 如何使用 C# 中的键对 NameValueCollection 进行排序？

> ID：608703
> 
> 赞同：5
> 
> 时间：2009-03-03T23:37:43.443
> 
> 标签：c#, sorting, collections

我已经编写了以下代码并且它也可以工作 - 但我想知道他们是否比这更好：

```
 NameValueCollection optionInfoList = ..... ;
 if (aSorting)
            {
                optionInfoListSorted = new nameValueCollection();        
                String[] sortedKeys = optionInfoList.AllKeys; 
                Array.Sort(sortedKeys);
                foreach (String key in sortedKeys)
                    optionInfoListSorted.Add(key, optionInfoList[key]);

                return optionInfoListSorted;
            } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T00:05:11.443

请改用[SortedDictionary](http://msdn.microsoft.com/en-us/library/f7fta44c.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T23:51:57.747

也许您可以使用另一种支持直接排序的列表？

```
List<KeyValuePair<string, string>> optionInfoList = ...;
if (sorting) {
   optionInfoList.Sort((x,y) => String.Compare(x.Key, y.Key));
}
return optionInfoList; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T00:12:45.497

如果您*必须*使用`NameValueCollection`并且您的集合中没有很多项目，那很好。如果它完成了工作，就不需要比这更花哨了。

如果这是性能瓶颈，请重新审视。

# java - 为什么我的简单比较器坏了？

> ID：608704
> 
> 赞同：17
> 
> 时间：2009-03-03T23:37:54.457
> 
> 标签：java, sorting, puzzle

我有一堂课，我已经简化为：

```
final class Thing {
    private final int value;
    public Thing(int value) {
        this.value = value;
    }
    public int getValue() {
        return value;
    }
    @Override public String toString() {
        return Integer.toString(value);
    }
} 
```

我想对这个东西的数组进行排序。所以我创建了一个简单的 copmarator：

```
private static final Comparator<Thing> reverse = new Comparator<Thing>() {
    public int compare(Thing a, Thing b) {
        return a.getValue() - b.getValue();
    }
}; 
```

然后我使用`Arrays.sort`.

这适用于我的测试用例，但有时数组以奇怪但可重复的顺序结束时会出错。怎么会这样？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-03T23:44:44.610

整数溢出……或者更准确地说，下溢。

相反，做一个明确的比较：

```
private static final Comparator<Thing> reverse = new Comparator<Thing>() {
    public int compare(Thing a, Thing b) {
      int av = a.getValue(), bv = b.getValue();
      return (av == bv) ? 0 : ((av < bv) ? -1 : +1);
    }
}; 
```

如果您确定差异不会“环绕”，则可以使用减法。例如，当所讨论的值被限制为非负时。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-03T23:43:45.907

您不能使用减号来创建比较。当绝对差超过 时，您将溢出`Integer.MAX_VALUE`。

相反，请使用此算法：

```
int compareInts( int x, int y ) {
  if ( x < y ) return -1;
  if ( x > y ) return 1;
  return 0;
} 
```

为此，我喜欢在库中使用此功能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-04T07:08:01.940

尝试

```
System.out.println(Integer.MAX_Value - Integer.MIN_VALUE); 
```

这需要返回一个正数作为 MAX_VALUE > MIN_VALUE 而是打印 -1

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-04T07:59:44.110

在比较 Java 原语时，建议将它们转换为对应的 Object 并依赖它们的`compareTo()`方法。

在这种情况下，您可以这样做：

```
return Integer.valueOf(a.getValue()).compareTo(b.getValue()) 
```

如有疑问，请使用经过良好测试的库。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-03T23:44:33.130

你在那里输入什么样的数字？如果您的数字足够大，您可以将整数的 MIN/MAX 值换行并最终陷入混乱。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-03T23:47:28.037

如果 a 的值非常负而 b 的值非常正，那么您的答案将是非常错误的。

IIRC，Int 溢出在 JVM 中静默环绕

——马库斯

# python - 监控用户空闲时间

> ID：608710
> 
> 赞同：3
> 
> 时间：2009-03-03T23:41:47.037
> 
> 标签：python, cocoa, macos, idle-processing

开发一个 mac 应用程序，我如何判断用户当前是否在他们的计算机上？或者他们上一次按键或移动鼠标是多久以前的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T01:40:48.810

原来答案就在这里

[http://osdir.com/ml/python.pyobjc.devel/2006-09/msg00013.html](http://osdir.com/ml/python.pyobjc.devel/2006-09/msg00013.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T00:36:22.990

您可以使用 Quartz 事件点击和 NSTimer。每当您的一个事件水龙头亮起时，通过设置其触发日期来推迟计时器。当计时器触发时，用户处于空闲状态。

不过，我不确定 Quartz 事件点击是否暴露给 Python。绘图 API 是，但我不确定事件点击。

# ruby-on-rails - Ruby Object#id 警告和 Active Record

> ID：608713
> 
> 赞同：9
> 
> 时间：2009-03-03T23:42:58.157
> 
> 标签：ruby-on-rails, rspec, warnings, rails-activerecord

当我们运行我们的规范时，我们不断看到如下警告：

> Object#id 将被弃用；使用对象#object_id

有问题的代码正在访问 ActiveRecord 模型的 id（显然，这是表上的一个属性，而不是 Ruby VM 中的对象实例 ID）。

有谁知道如何关闭这些特定警告或以某种方式避免它们？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-04T03:27:58.663

尝试使用`[:id]`而不是`.id`

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-04T00:04:14.237

当一个对象从 继承时`ActiveRecord::Base`，对 AR::B 的调用将`id`转到 AR::B 的`id`方法，而不是在 上不推荐使用的方法`Object`。

该警告通常意味着我的一个对象不是我认为的那样。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-05T09:11:11.903

我假设您正在模拟/存根（因为您提到了规格）。

就我而言，当我存根 ActiveRecord 对象并访问其 ID 属性时，我遇到了这些警告。

如果您希望访问 ActiveRecord 对象的 ID，我建议您执行以下操作：

```
 mock("MyActiveRecordObject", :id => 1001) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-04T01:09:30.477

您的对象实际上不是 AR 对象，通常表示某些数据检索失败（`Table.find_by_name('nonexistent name')`将返回`nil`）。如果您只想关闭可见的警告，则可以`whiny_nils`在配置中关闭，否则`is_a?`在尝试访问对象的属性并优雅地处理故障情况之前进行测试。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-04T00:13:37.083

object#id 警告仅发生在 NilClass 等常规 ruby​​ 类上。ActiveRecord::Base 覆盖 object#id

# java - double a = a + int b 和 int a += double b 有什么区别？

> ID：608721
> 
> 赞同：30
> 
> 时间：2009-03-03T23:45:55.483
> 
> 标签：java, types, type-conversion, operators, implicit-conversion

为什么：

```
public class Addition { 
  public static void main() { 
    int a = 0; 
    double b = 1.0; 
    a = a + b;
    System.out.println(a); 
  }
} 
```

不编译但是：

```
public class Addition { 
  public static void main() { 
    int a = 0; 
    double b = 1.0; 
    a += b; 
    System.out.println(a); 
  }
} 
```

编译。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-03-03T23:49:30.077

在 Java 中，+= 运算符隐式转换为左侧类型。这适用于所有组合运算符。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-03T23:49:03.400

int = int + double 本质上是

整数 = 双 + 双

如果没有铸造，你就无法做到这一点......

int += double 将结果强制为 int，而另一个则需要强制转换。

所以 a = (int)(a + b);

应该编译。

编辑：根据评论中的要求...这里是更多阅读的链接（不是最简单的阅读，而是最正确的信息）：[http ://docs.oracle.com/javase/specs/jls/se7/html/ jls-15.html#jls-15.26.2](http://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.26.2)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T00:26:08.460

double + int 返回 double，因此 double = double + int 是合法的，另一方面，请参见 JLS 5.1.2 Widening Primitive Conversion int = double + int 是“Narrowing Primitive Conversion”并且需要显式转换

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-27T12:15:12.540

正如大家已经说过的那样， += 有一个隐式转换。为了帮助说明这一点，我将使用我不久前编写的一个非常适合这类问题的应用程序。这是一个在线反汇编程序，因此您可以查看正在生成的实际字节码：http: [//javabytes.herokuapp.com/](http://javabytes.herokuapp.com/)

以及它们的含义表： [http ://en.wikipedia.org/wiki/Java_bytecode_instruction_listings](http://en.wikipedia.org/wiki/Java_bytecode_instruction_listings)

那么让我们来看看一些简单的Java代码的字节码：

```
int i = 5;
long j = 8;
i += j; 
```

反汇编代码。我的评论前面会有一个//。

```
 Code:
        0: iconst_5  //load int 5 onto stack
        1: istore_0  //store int value into variable 0 (we called it i)
        2: ldc2_w #2; //long 8l
                     //load long 8 value onto stack.  Note the long 8l above
                     //is not my comment but how the disassembled code displays 
                     //the value long 8 being used with the ldc2_w instruction
        5: lstore_1  //store long value into variable 1 (we called it j)
        6: iload_0   //load int value from variable 0
        7: i2l       //convert int into a long.  At this point we have 5 long
        8: lload_1   //load value from variable 1
        9: ladd      //add the two values together.  We are adding two longs
                     //so it's no problem
        10: l2i      //THIS IS THE MAGIC.  This converts the sum back to an int
       11: istore_0  //store in variable 0 (we called it i) 
```

# pdf-generation - 优化 ABCpdf 文件大小

> ID：608724
> 
> 赞同：2
> 
> 时间：2009-03-03T23:46:56.120
> 
> 标签：pdf-generation, filesize, abcpdf

我们有一个使用 ABCpdf 生成动态 pdf 文件的网络系统。虽然它有效......好吧，文件大小有点大。

例如，今天早上作为测试，我生成了一个 140 多页的文件，其中包含许多小图形（实际上，相同的六个小图像一遍又一遍地重复。）总文件大小为 12 兆，并且不断变化。

获取该文件，在 Acrobat Pro 中打开它并通过默认优化设置运行它，我得到了一个 600k 的文件。

有没有人有任何建议让原始文件更接近第二个数字？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T22:43:49.477

这几乎可以保证是图像压缩问题。

[PixMap](http://abcupload.com/helppdf7net/source/6-abcpdf6.objects/pixmap/1-methods/compressjpeg.htm)提供底层图像的 JPEG 压缩。实际上可以让软件解压缩您插入的 JPEG 并将其存储为位图，这很容易使大小膨胀。

还要确保你的尺寸是正确的——不要包含 1600x1200 的图像，而是让它显示在一个 2 英寸的小框架中——在这种情况下你可以调整它的大小/缩小它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T07:23:25.723

您是否尝试过最新版本的 ABCpdf？您应该会发现这个特定问题已得到修复；-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T23:46:26.377

听起来 ABCpdf 可能会重复图像，而不是将它们中的每一个插入 PDF 并引用它们。你可以试试[CosEdit](http://www.pdftron.com/cosedit/index.html)看看是不是这样。如果是这样，您将获得大量流对象，而优化的输出将具有对相同少数流对象的大量引用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T22:07:21.247

ABCpdf 似乎有很多嵌入图像的选项。你用的是哪个？你的图片尺寸是多少？什么格式？每页有多少？

您可能有一些运气可以使您的图像更小，更低的分辨率或更好的压缩格式（即JPEG）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-28T09:25:06.110

如果您无法正确设置 abcPdf 设置，您也可以尝试在新文件的顶部运行 pdf 压缩。

有关如何在 c# 中执行此操作，请参阅[pdftk 压缩选项。](https://stackoverflow.com/questions/5296667/pdftk-compression-option)

# monitoring - 监视 Sun App Server 上连接池中的连接

> ID：608726
> 
> 赞同：0
> 
> 时间：2009-03-03T23:47:16.650
> 
> 标签：monitoring, oracle-application-server

在 Sun（现在的 Oracle）应用服务器上，如何按计划的频率监控连接池中的连接？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T01:35:52.910

使用[监控命令](http://docs.sun.com/app/docs/doc/819-3675/monitor-1?a=view)。

你会使用：

> - 类型
> 
> 连接器池

和

> --interval 捕获监控属性之前的间隔（秒）。如果间隔必须大于 0。监视属性显示在标准输出上，直到您键入 ctrl-c 或 q。默认值为 30。

# javascript - 如何使用 jQuery 的 form.serialize 但排除空字段

> ID：608730
> 
> 赞同：111
> 
> 时间：2009-03-03T23:50:07.407
> 
> 标签：javascript, jquery, forms, serialization, input

我有一个搜索表单，其中包含许多文本输入和通过 GET 提交的下拉列表。我希望通过在执行搜索时从查询字符串中删除空字段来获得更清晰的搜索 url。

```
var form = $("form");  
var serializedFormStr = form.serialize();  
// I'd like to remove inputs where value is '' or '.' here
window.location.href = '/search?' + serializedFormStr 
```

知道如何使用 jQuery 来做到这一点吗？

* * *

## 回答 #1

> 赞同：176
> 
> 时间：2009-03-04T14:29:48.103

我一直在查看[jQuery 文档，我认为我们可以使用](http://docs.jquery.com/)[选择器](http://docs.jquery.com/Selectors)在一行中做到这一点：

```
$("#myForm :input[value!='']").serialize() // does the job! 
```

显然 #myForm 获取 id 为“myForm”的元素，但起初对我来说不太明显的是 #myForm 和 :input 之间需要**空格字符，因为它是**[后代](http://docs.jquery.com/Selectors/descendant)运算符。

[**:input**](http://docs.jquery.com/Selectors/input)匹配所有输入、文本区域、选择和按钮元素。

[**[value!='']**](http://docs.jquery.com/Selectors/attributeNotEqual)是一个属性不等于过滤器。奇怪（且有用）的事情是**所有 :input**元素类型都具有值属性，甚至选择和复选框等。

最后还要删除值为“。”的输入。（如问题中所述）：

```
$("#myForm :input[value!=''][value!='.']").serialize() 
```

在这种情况下，并列，[即将两个属性选择器彼此相邻放置](http://docs.jquery.com/Selectors/attributeMultiple)，意味着 AND。[使用逗号](http://docs.jquery.com/Selectors/multiple)意味着 OR。对不起，如果这对 CSS 人来说是显而易见的！

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2015-02-13T15:50:32.417

我无法让 Tom 的解决方案正常工作（？），但我能够使用`.filter()`一个简短的函数来识别空字段。我正在使用 jQuery 2.1.1。

```
var formData = $("#formid :input")
    .filter(function(index, element) {
        return $(element).val() != '';
    })
    .serialize(); 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-04T07:55:36.630

你可以用正则表达式来做......

```
var orig = $('#myForm').serialize();
var withoutEmpties = orig.replace(/[^&]+=\.?(?:&|$)/g, '') 
```

测试用例：

```
orig = "a=&b=.&c=&d=.&e=";
new => ""

orig = "a=&b=bbb&c=.&d=ddd&e=";
new => "b=bbb&d=ddd&"  // dunno if that trailing & is a problem or not 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-05-12T12:39:58.127

这对我有用：

```
data = $( "#my_form input").filter(function () {
        return !!this.value;
    }).serialize(); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-02-15T06:34:33.593

我已经使用了上述解决方案，但对我来说那些没有用。所以我使用了以下代码

```
$('#searchform').submit(function(){

            var serializedData = $(this).serializeArray();
            var query_str = '';

            $.each(serializedData, function(i,data){
                if($.trim(data['value'])){
                    query_str += (query_str == '') ? '?' + data['name'] + '=' + data['value'] : '&' + data['name'] + '=' + data['value'];
                }
            });
            console.log(query_str);
            return false;
        }); 
```

可能对某人有用

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-10-30T19:35:40.313

[Rich 解决方案](https://stackoverflow.com/questions/608730/how-do-i-use-jquerys-form-serialize-but-exclude-empty-fields#answer-28503408)的替代方案：

```
$('#form').submit(function (e) {
  e.preventDefault();

  var query = $(this).serializeArray().filter(function (i) {
    return i.value;
  });

   window.location.href = $(this).attr('action') + (query ? '?' + $.param(query) : '');
}); 
```

说明：

*   `.submit()`挂钩到表单的`submit`事件
*   `e.preventDefault()`阻止表单提交
*   `.serializeArray()`为我们提供了将要发送的查询字符串的数组表示。
*   `.filter()`删除该数组中的虚假（包括空）值。
*   `$.param(query)`为我们更新的数组创建一个序列化且符合 URL 的表示
*   设置一个值以`window.location.href`发送请求

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-04T00:00:40.487

我会查看 jQuery 的源代码。在最新版本第 3287 行。

我可能会添加一个“serialize2”和“serializeArray2”函数。当然给他们起个有意义的名字。

或者更好的方法是编写一些东西来将未使用的变量从 serializedFormStr 中提取出来。一些正则表达式在中间字符串中查找 =& 或以 = 结尾的任何正则表达式向导？

*更新：* 我更喜欢 rogeriopvl 的回答（+1）......特别是因为我现在找不到任何好的正则表达式工具。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-07-28T06:47:51.697

在咖啡脚本中，执行以下操作：

```
serialized_form = $(_.filter($(context).find("form.params input"), (x) -> $(x).val() != '')).serialize() 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-04T00:07:34.057

您可能想查看 .each() jquery 函数，它允许您遍历选择器的每个元素，因此您可以检查每个输入字段并查看它是否为空，然后将其从表单中删除使用 element.remove()。之后，您可以序列化表单。

# c# - 在 asp.net C# 中验证日期的最简单方法是什么？

> ID：608732
> 
> 赞同：1
> 
> 时间：2009-03-03T23:50:19.043
> 
> 标签：c#, asp.net

我正在使用 DateTime.ParseExact 从输入中解析字符串。确保日期符合一个月内最大天数或没有 0\. 月等规则的最简单方法是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-03T23:52:08.900

您可以使用...进行额外验证

```
DateTime.TryParse(); 
```

[http://msdn.microsoft.com/en-us/library/9h21f14e.aspx](http://msdn.microsoft.com/en-us/library/9h21f14e.aspx)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T23:56:59.807

正如 BoltBait 所说，或者**DateTime.TryParseExact()**如果您知道字符串的确切格式。

[http://msdn.microsoft.com/en-us/library/system.datetime.tryparseexact.aspx](http://msdn.microsoft.com/en-us/library/system.datetime.tryparseexact.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T04:12:55.450

如果您在后面的代码中执行此检查，则执行 DateTime.TryParse() 的答案非常好，但是如果您在 UI 上捕获这些数据，那么我强烈建议在回发代码之前验证输入后面发生。

```
<strong>Date:</strong>
<asp:textbox ID="txtEnterDate" runat="server"></asp:textbox>
<asp:CompareValidator ID="cvEnterDate" runat="server" ControlToValidate="txtEnterDate"
    ErrorMessage="Must Be Valid Date" Operator="DataTypeCheck" 
    SetFocusOnError="True" Type="Date"></asp:CompareValidator> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-06-30T03:34:23.177

```
 protected void txtTo_TextChanged(object sender, EventArgs e)
    {
        TextBox tbTo = (TextBox)sender;
        DateTime wsToOUT;
        if (DateTime.TryParse(tbTo.Text, out wsToOUT))
        {
            //do something with valid date in tbTo
        }
        else
        {
            //show a nice error message
            tbTo.Focus();
        }
    } 
```

# sql-server - Microsoft SQL Server - 谁创建了存储过程？

> ID：608733
> 
> 赞同：8
> 
> 时间：2009-03-03T23:50:24.207
> 
> 标签：sql-server, sql-server-2005, metadata

有没有一种好方法可以告诉谁在 SQL Server 2005 中创建了存储过程（在 2008 年也可以）？在 SQL Management Studio 中，我可以在 proc 上右键鼠标/属性以获取创建的日期/时间，但如何发现创建者？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T00:36:31.990

现在对您来说可能为时已晚，但您可以跟踪 DDL 活动。

我们的管理数据库中有一个表，其中包含所有活动。它使用 2005 年新增的 DDL 触发器。这些脚本在您的管理数据库中创建一个表（对我来说是 SQL_DBA），在模型数据库上创建触发器，在现有数据库上创建触发器。我还在最后创建了一个 sp_msforeachDB 语句来禁用所有这些。

**一个警告**- 您的数据库需要处于 90 的兼容模式（在每个 db 的选项中），否则您可能会开始出错。语句的 EXECUTE AS 部分中的帐户也需要访问权限才能插入到您的管理表中。

```
USE [SQL_DBA]
GO
/****** Object:  Table [dbo].[DDL_Login_Log]    Script Date: 03/03/2009 17:28:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DDL_Login_Log](
    [DDL_Id] [int] IDENTITY(1,1) NOT NULL,
    [PostTime] [datetime] NOT NULL,
    [DB_User] [nvarchar](100) NULL,
    [DBName] [nvarchar](100) NULL,
    [Event] [nvarchar](100) NULL,
    [TSQL] [nvarchar](2000) NULL,
    [Object] [nvarchar](1000) NULL,
 CONSTRAINT [PK_DDL_Login_Log] PRIMARY KEY CLUSTERED 
(
    [DDL_Id] ASC,
    [PostTime] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--This creates the trigger on the model database so all new DBs get it
USE [model]
GO
/****** Object:  DdlTrigger [ddl_DB_User]    Script Date: 03/03/2009 17:26:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TRIGGER [ddl_DB_User] 
ON DATABASE
FOR DDL_DATABASE_SECURITY_EVENTS
AS 

DECLARE @data XML
declare @user nvarchar(100)

SET @data = EVENTDATA()
select @user = convert(nvarchar(100), SYSTEM_USER)

execute as login='domain\sqlagent'
INSERT sql_dba.dbo.DDL_Login_Log 
   (PostTime, DB_User, DBName, Event, TSQL,Object) 
   VALUES 
   (@data.value('(/EVENT_INSTANCE/PostTime)[1]', 'nvarchar(100)'), 
   @user,
    db_name(),
    @data.value('(/EVENT_INSTANCE/EventType)[1]', 'nvarchar(100)'), 
   @data.value('(/EVENT_INSTANCE/TSQLCommand/CommandText)[1]','nvarchar(max)'),
    @data.value('(/EVENT_INSTANCE/ObjectName)[1]', 'nvarchar(1000)')
)

GO
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--CREATE TRIGGER IN ALL NON SYSTEM DATABASES

DECLARE @dataname varchar(255),
@dataname_header varchar(255),
@command VARCHAR(MAX),
@usecommand VARCHAR(100)
SET @command = '';
DECLARE datanames_cursor CURSOR FOR SELECT name FROM sys.databases 
WHERE name not in ('master', 'pubs', 'tempdb', 'model','msdb')
OPEN datanames_cursor
FETCH NEXT FROM datanames_cursor INTO @dataname
WHILE (@@fetch_status = 0)
BEGIN

PRINT '----------BEGIN---------'

PRINT 'DATANAME variable: ' + @dataname;

EXEC ('USE ' + @dataname);

PRINT 'CURRENT db: ' + db_name();

SELECT @command = 'CREATE TRIGGER DBA_Audit ON DATABASE
FOR DDL_DATABASE_LEVEL_EVENTS
AS
DECLARE @data XML
DECLARE @cmd NVARCHAR(1000)
DECLARE @posttime NVARCHAR(24)
DECLARE @spid NVARCHAR(6)
DECLARE @loginname NVARCHAR(100)
DECLARE @hostname NVARCHAR(100)
SET @data = EVENTDATA()
SET @cmd = @data.value(''(/EVENT_INSTANCE/TSQLCommand/CommandText)[1]'', ''NVARCHAR(1000)'')
SET @cmd = LTRIM(RTRIM(REPLACE(@cmd,'''','''')))
SET @posttime = @data.value(''(/EVENT_INSTANCE/PostTime)[1]'', ''DATETIME'')
SET @spid = @data.value(''(/EVENT_INSTANCE/SPID)[1]'', ''nvarchar(6)'')
SET @loginname = @data.value(''(/EVENT_INSTANCE/LoginName)[1]'',
    ''NVARCHAR(100)'')
SET @hostname = HOST_NAME()
INSERT INTO [DBA_AUDIT].dbo.AuditLog(Command, PostTime,HostName,LoginName)
 VALUES(@cmd, @posttime, @hostname, @loginname);'

 EXEC (@command);
 FETCH NEXT FROM datanames_cursor INTO @dataname;
PRINT '----------END---------'
END
CLOSE datanames_cursor
DEALLOCATE datanames_cursor

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

----Disable all triggers when things go haywire
sp_msforeachdb @command1='use [?]; IF  EXISTS (SELECT * FROM sys.triggers WHERE name = N''ddl_DB_User'' AND parent_class=0)disable TRIGGER [ddl_DB_User] ON DATABASE' 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T00:11:02.847

如果它不是很久以前创建的，试试这个：

```
DECLARE @path varchar(256)

SELECT @path = path
FROM sys.traces
where id = 1

SELECT *
FROM fn_trace_gettable(@path, 1) 
```

它选择当前（开箱即用）默认跟踪。如果它是最近创建的（并且服务器最近没有重新启动），那么存储过程对象名称和创建它的登录名将在跟踪数据中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T00:10:21.320

我相信这在 SQL 2005 中不可用。当然它在 SQL Management Studio 的属性中不可用，并且在 sys.objects 表或我能看到的任何其他表中不可用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-31T04:49:03.093

按照与 Sam 相同的想法，您可以使用 DDL 触发器来捕获所需的信息，然后将该数据发送到 SQL 服务代理队列，该队列可以将其转发到 Admin 数据库（如果需要，可以在另一台服务器上），这将然后保留所有 DDL 更改。

这将消除权限问题，因为 DDL 触发器会将数据加载到本地数据库的 Service Broker 队列中，而 SQL 会处理将消息移动到其他数据库的过程。

使用此方法会进行更多设置，但是一旦设置，无论谁更改对象，它都会起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-19T08:55:17.320

如何在事后（尤其是几年后）获得这条信息很可能是不可能的。

但是，您可以使用 SQL Server Profiler 来跟踪 DDL 操作。在事件选择中，检查以下事件：

对象/对象：更改

对象/对象：已创建

对象/对象：已删除

还有很多自定义选项：您可以将输出保存到文件或表中，还可以根据任何列等过滤输出等。

# wcf - WCF 服务部署 - 应用程序文件保存在哪里？

> ID：608735
> 
> 赞同：1
> 
> 时间：2009-03-03T23:51:53.143
> 
> 标签：wcf, http, tcp, deployment

我有一个 WCF 服务，它通过 BL 调用数据层，最终调用 SQL Server 后端。我的服务公开了各种方法/操作以从数据库中获取数据。我还为它构建了一个用于测试的主机，以及一个 Windows 服务主机，这就是我计划部署它的方式。

昨天，当我进行测试部署时，服务开始正常，但我没有机会查看数据是否正确提取。事情是这样的：我的部署测试环境（MS Server 2003）与我自己的（笔记本电脑）本地测试环境完全不同。我通过将 Windows 服务项目的 bin\debug 内容复制到服务器上并在使用 InstallUtil.exe 时在服务器上引用 .exe 来进行部署。但是 DL 的数据连接应该采用不同的连接字符串，显然，因为它应该连接到服务器上的数据库，而不是我的笔记本电脑。然而，我在部署到的目录中看到的唯一 app.config 是服务主机的那个。其他项目，如 DL 和 BL，也以 DLL 的形式存在，但两者都没有 app.config。那么如何更换应用程序。为 DL 配置正确的环境？我确定这是一个简单的问题，我只是不知道。

一个相关的问题：如果我们稍后决定要使用 HTTP 主机来代替 - 或除了 - TCP，我可以运行第二台主机来驱动相同的服务吗？我只需要使用 IIS 部署主机并将服务节点添加到 app.configs 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T06:25:28.140

部署项目时，您将获得的唯一 app.config/web.config 是可执行项目（website/console app/windows service/windows forms app/etc.项目）中的那个。DLL 项目的任何 app.configs 都不会复制到 bin 目录中。

您需要将配置部分从您的 DLL 项目中复制出来，并将它们放入您的服务项目 app.config 中。

对于第二个问题，您可以在同一 ServiceHost 中为同一服务托管不同的端点。您可以在 Windows 服务/控制台应用程序中托管 HTTP 端点。如果您在 IIS 之外托管 HTTP，则可能需要授予用户权限以允许其打开 HTTP 端口。（参见[http://msdn.microsoft.com/en-us/library/ms733768.aspx](http://msdn.microsoft.com/en-us/library/ms733768.aspx)）。对于 HTTP，在 IIS 中托管可能更容易，但它确实可以在普通的 ServiceHost 中工作。

```
<system.serviceModel>
    <services>
        <service name="MyServiceTypes.MyService">
            <endpoint address="http://localhost:44444/MyService"
                      binding="basicHttpBinding"
                      contract="MyServiceTypes.IMyService" />

            <endpoint address="net.tcp://localhost:55555/MyService"
                      binding="netTcpBinding"
                      contract="MyServiceTypes.IMyService" />
        </service>
    </services>
</system.serviceModel> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T07:09:10.643

托管环境的 App.config（在本例中为托管 Windows 服务）包含所有模块的配置。同样，如果您在 IIS 上托管 Web.config，则它包含所有配置。

# nlp - 在 NLP 中识别专有名词的策略

> ID：608743
> 
> 赞同：14
> 
> 时间：2009-03-03T23:56:45.487
> 
> 标签：nlp, named-entity-recognition, part-of-speech

我有兴趣了解有关[自然语言处理](http://en.wikipedia.org/wiki/Natural_language_processing)(NLP) 的更多信息，并且很好奇目前是否有任何策略可以识别文本中不基于字典识别的专有名词？另外，任何人都可以解释或链接到解释当前基于字典的方法的资源吗？谁是 NLP 的权威专家，或者该主题的权威资源是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-04T10:10:13.000

为文本中的单词确定正确的词性的任务称为[词性标记](http://en.wikipedia.org/wiki/POS_tagging)。例如，[Brill 标注器](http://en.wikipedia.org/wiki/Brill_tagger)混合使用了字典（词汇）单词和上下文规则。我相信这个任务的一些重要的初始字典单词是停用词。一旦你的词有了（大部分是正确的）词性，你就可以开始构建更大的结构了。[这本面向行业的书](http://books.google.com/books?id=jkkoj7U5g4kC&dq=Natural+Language+Processing+for+Online+Applications:+Text+Retrieval,+Extraction+and+Categorization&printsec=frontcover&source=bn&hl=en&ei=GVGuSdebCJDRjAf16p2kBg&sa=X&oi=book_result&resnum=7&ct=result#PPP1,M1)区分了识别名词短语 (NP) 和识别命名实体。关于教科书：[Allen 的《自然语言理解》](https://rads.stackoverflow.com/amzn/click/com/0805303340)是一本不错但有点过时的书。[Foundations of Statistical Natural Language Processing](https://rads.stackoverflow.com/amzn/click/com/0262133601)是对统计 NLP 的一个很好的介绍。[语音和语言处理](https://rads.stackoverflow.com/amzn/click/com/0131873210)更严格一些，也许更权威。[计算语言学协会是计算语言学](http://www.aclweb.org/)的领先科学社区。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T00:08:04.557

除了基于字典的方法之外，我还想到了另外两个方法：

*   基于模式的方法（以简单的形式：任何大写的都是专有名词）
*   机器学习方法（在训练语料库中标记专有名词并训练分类器）

该领域主要被称为*命名实体提取，通常被认为是**信息提取*的一个子领域。NLP 不同领域的一个很好的起点通常是[牛津计算语言学手册中](http://ukcatalogue.oup.com/product/9780198238829.do)的相应章节：

[![牛津计算语言学手册](https://i.stack.imgur.com/x4OW1.jpg)](https://i.stack.imgur.com/x4OW1.jpg)
[（来源：[oup.com](http://ukcatalogue.oup.com/images/en_US/covers/medium/9780198238829_140.jpg)）]

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-16T05:53:35.497

尝试搜索“命名实体识别”——这是 NLP 文献中用于此类事物的术语。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T00:21:36.300

这取决于您所说的基于字典的含义。

例如，一种策略是使用字典*中没有*的东西，并尝试假设它们是专有名词。如果这导致合理的解析，请考虑临时验证的假设并继续进行，否则得出结论它们不是。

其他想法：

*   在主题位置上，任何没有限定词的简单主题都是不错的候选者。
*   介词短语中的同上
*   在任何位置，所有格限定词的基础（例如“鲍勃的姐姐”中的鲍勃）是一个很好的候选者

——马库斯

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-18T18:00:29.677

一些工具包建议： 1\. Opennlp：你的任务有一个命名实体识别组件 2\. LingPipe：也是它的 NER 组件 3\. 斯坦福 NLP 包：用于学术用途的优秀包，可能对商业不友好。4\. nltk：一个 Python NLP 包

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-08-29T03:45:58.207

如果您有诸如“谁是比尔·盖茨”之类的句子并且如果您对其应用词性标注器。它会给出答案

“谁/WP 是/VBZ 比尔/NN 盖茨/NNS ？/。”

[你可以在http://cst.dk/online/pos_tagger/uk/](http://cst.dk/online/pos_tagger/uk/)上在线尝试

所以你得到了这句话中的所有名词。现在您可以使用一些算法轻松提取这些名词。如果您使用自然语言处理，我建议使用 python。它有 NLTK（自然语言工具包），您可以使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-10-11T11:27:52.183

如果您对自然语言处理的实现感兴趣并且 Python 是您的编程语言，那么这可能是一个非常有用的资源：[http ://www.youtube.com/watch?v=kKe4M4iSclc](http://www.youtube.com/watch?v=kKe4M4iSclc)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-01-18T18:16:01.253

虽然这是针对孟加拉语的，但它可以画出一个通用的程序来识别专有名词。所以我希望这对你有帮助。请查看以下链接： [http ://www.mecs-press.org/ijmecs/ijmecs-v6-n8/v6n8-1.html](http://www.mecs-press.org/ijmecs/ijmecs-v6-n8/v6n8-1.html)

# ant - 如何使用 WLS Ant Tasks 构建包含策略文件的 EAR？

> ID：608745
> 
> 赞同：1
> 
> 时间：2009-03-03T23:57:16.547
> 
> 标签：ant, weblogic, jax-ws, ws-security, ear

我一直在使用带有 Weblogic Server 的 JAX-WS，使用他们的 Ant 任务来构建可以部署在服务器上的 EAR 文件。我已经获得了使用 JAX-WS 的基本 SOAP 调用，但现在我正在尝试通过 WS-Security 添加一些消息级安全性。

根据[文档](http://edocs.bea.com/wls/docs103/webserv_sec/message.html)，有两种方法可以向 Web 服务添加安全策略。一种是在 Java 源代码本身上使用注释，但这意味着策略是永久设置的。第二种方法是将策略文件添加到 EAR 文件中，然后允许管理员在部署后设置 Web 服务的策略。

虽然文档提到[了必须将策略文件放在哪里，但它没有解释](http://edocs.bea.com/wls/docs103/webserv_sec/message.html#wp242208)[在使用 Ant 进行构建](http://edocs.bea.com/wls/docs103/webserv_ref/anttasks.html)时如何自动添加这些策略文件。每次构建/重新部署 EAR 时手动添加策略文件的测试完全太费力了。这是我现在用来构建 EAR 文件的 Ant 代码：

```
<target name="build-service">
    <jwsc source" srcdir="java" destdir="${ear-dir}">
        <jws file="SoapService.java" type="JAXWS"/>
    </jwsc>
</target> 
```

如何将带有策略文件的 EAR 自动构建到正确的位置？我最感兴趣的是将它构建到 Java WAR 文件中的 WEB-INF/policies 中。您可以假设我手头有策略文件，并且可以在构建之前参考它们。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T20:25:57.693

作为记录，答案是将 <module> 与 <zipfileset> 结合使用：

```
<target name="build-service">
    <jwsc srcdir="java" destdir="${ear-dir}">
        <module>
            <jws file="SoapService.java" type="JAXWS"/>
            <zipfileset dir="." prefix="WEB-INF/policies">
                <include name="mypolicy.xml"/>
            </zipfileset>
        </module>
    </jwsc>
</target> 
```

# iphone - 如何使用 Core Graphics 渲染动画或效果

> ID：608747
> 
> 赞同：0
> 
> 时间：2009-03-03T23:58:00.803
> 
> 标签：iphone, graphics

我想画一个炮弹的移动和爆炸效果（只是简单的碎片飞来飞去）。我应该如何使用 Core Graphics（在 iPhone 上）来解决这个问题？

我正在使用 NSTimer 调用渲染方法并更新动画弹丸或爆炸效果，我可以毫无问题地绘制每个单独的片段（例如填充的记录或线条），但我发现 drawRect 总是擦除以前的内容并且只渲染新的东西。

你会如何处理这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-09T23:35:31.183

找到解决方案，使用 setNeedsDisplayInRect 而不是 setNeedsDisplay 并限制我正在绘制的小区域（感谢 Erica）。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-03-04T02:45:27.890

Pragmatic Programmers 网站上有[关于这方面的很好的书。](http://www.pragprog.com/titles/bdcora/core-animation-for-mac-os-x-and-the-iphone)

# estimation - 如何避免软件开发中的 80/20 法则

> ID：608748
> 
> 赞同：19
> 
> 时间：2009-03-03T23:58:06.107
> 
> 标签：estimation

似乎无论我的项目是什么，我都能很快完成 80% 的工作。用户和管理人员兴奋地认为事情比计划提前了很多，但剩下的 20% 令人讨厌的工作似乎需要之前 80% 的 4 倍。当我们对项目进行定期检查或站立时，我觉得自己就像一个破纪录的人说：“是的，到目前为止一切都很好，但还有很多事情要做……”

在大多数情况下，我的估计是相当准确的，但我是人。让用户相信最后 20% 的工作确实需要 80% 的时间的最佳方法是什么？似乎越来越多的用户和管理人员相信 IT 很简单，神奇的事情发生在弹指之间……

一般来说，我们确实在我认为相当低的水平上跟踪任务。不一定在创建标签或文本框中，但我们非常详细......我们还跟踪我们对所有任务的估计完成情况，我觉得当您处于项目中间时，这个数字比原始估计更重要.

我认为这归结为用户和管理层的看法。即使他们可能知道要完成的估算，他们仍然会沉浸在对所见事物的情绪和看法中，而估算数字则处于次要地位。这就是我试图弄清楚如何控制或管理期望的原因。

* * *

***编辑***
变成一个社区维基，因为这是相当主观的。从一开始就应该是这样。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-04T00:04:45.407

不要在完成后立即向他们展示前 80%。滴灌他们。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-04T00:01:26.210

> 即使考虑到霍夫施塔特定律，它也总是比你预期的要花更长的时间

但我离题了。

最好的做法是可悲的经验。[SCRUM 方法](http://en.wikipedia.org/wiki/Scrum_(development))对某些类型的软件开发非常有帮助，因为它们会不断将发布日期更新为更准确的日期。[（关于 scrum 的快速视频）](http://www.youtube.com/watch?v=Q5k7a9YEoUI)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-04T00:04:12.847

也许您需要将您正在处理的任务/功能分解为更小的单元，以便安排工作和签到/报告。例如，我的日程表中几乎没有任何单独的项目持续时间超过两天。

然后，不要在 Scrum 中每天都说“我正在为我们的新布偶制作者工作”两周，而是可以说“我目前正在为布偶制作者制作眼睛选择器”。

如果你按照时间表工作，而且你的时间表是准确的（这意味着它们占了 80% 和 20%），那么管理真的不应该有问题。如果他们暗示他们可以减少分配的时间，因为您“几乎完成”，那么请向他们展示尚未实施的规范部分。

我假设您从某种形式的功能规范中工作，该规范详细说明了应该做什么、应该如何表现以及它必须处理的边缘情况。如果是这种情况，那么担心管理层的情绪和看法对我来说似乎很奇怪，他们应该很有能力将规范与您的工作进行比较，或者阅读您的日程安排以查看剩下的内容。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-04T00:09:03.943

你如何估计工作量？您说“令人讨厌的剩余 20% 的工作似乎比之前的 80% 花费了 4 倍”，但是您是如何得出“剩余 20%”的工作和“80%”是完毕？显然估计是错误的——实际上只完成了 20% 的工作，还剩下 80%。

在软件开发中，很难提前很长时间给出准确的估计。唯一的方法是将工作分成易于管理的小部分（每个部分可能少于 10 小时）。您只能准确估计接下来的步骤。

在 Scrum 中可以找到一些有助于估计进度的实践。在下一个 sprint（一个月或更短）期间将完成的工作范围在 sprint 开始时确定，并对每项工作进行粗略估计。然后在 sprint 之后，团队可以反思完成了多少进展，还缺少多少，估计有多准确，以及是什么让团队放慢了速度。在 Scrum 和其他敏捷方法中，重要的一点是获得关于已完成的工作以及我们在项目中的进展程度的快速反馈。我建议阅读更多关于它们的信息。Ólafur Waage 在[他的消息中链接的](https://stackoverflow.com/questions/608748/how-to-avoid-the-80-20-rule-in-software-development/608756#608756)[有关 Scrum 的视频](http://www.youtube.com/watch?v=Q5k7a9YEoUI)提供了一个很好且快速的介绍。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-04T00:23:34.440

当涉及到时间估计时，这是我的经验：

1.  如果您不能肯定地说一项任务将花费不到 4 小时，您就无法准确估计它。将其分解成更小的部分并递归地重复。

2.  做出这样的时间估计不是野餐，这需要时间，您基本上必须以可管理的部分来解决整个项目，这意味着对需求的任何更改都会导致时间计划的更改（令人惊讶，不是吗？ )

3.  最大的问题是我们不可能预见到所有的细节（也许，比如说 20% 吧？剩下的 80% 没有估计……） - 正如其他人已经指出的那样，请参阅 SCRUM。

4.  管理层很少“接受”如此详细的时间估算，因为实施起来“需要太长时间”。

然而，由于管理层有兴趣赚取利润，他们也有兴趣偷工减料。因此，您应该根据所涉及的现实生活场景确定可以削减的角落并做出复杂的妥协。在管理层的支持下，你可以通过无所事事来完成最后 20% 的大部分工作（我猜这有点悲哀，但仍然如此）。

因为代表最终产品最后 20% 的最后 80% 工作实际上是在打磨和消除错误并适应变化的需求等。可能有一些有限的第一个版本等，等等，要有创意.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-04T00:18:33.297

阅读史蒂夫·麦康奈尔 (Steve McConnell) 的优秀著作《[快速开发](http://www.stevemcconnell.com/index.htm)》，该书对 80/20 问题和其他变幻莫测的软件估计有很多话要说。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-04T04:16:29.480

我认为我不能比[Joel](https://stackoverflow.com/users/4/joel-spolsky)对[Painless Software Schedules](http://www.joelonsoftware.com/articles/fog0000000245.html)说得更好。

> 如果您的经理让您减少估算，请按照以下步骤操作。在日程表中创建一个名为 Rick's Estimate 的新列（当然，假设您的名字是 Rick。）将您的估计值放在那里。让您的经理随心所欲地使用 Curr Est 列。忽略你的经理的估计。项目完成后，看看谁更接近现实。我发现仅仅威胁要这样做会产生奇迹，尤其是当你的经理意识到他们刚刚参加了一场比赛，看看你的工作速度有多慢！

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-04T00:09:06.317

有人说，项目前 90% 的时间用于 90% 的工作，剩下的 90% 的项目时间用于剩下的 10% 或工作。;)

在项目开始时取得很大进展是很自然的，因为您只需先完成最简单的部分。此外，如果前 80% 的代码有任何问题，它们通常不会很明显，直到它们全部结合在一起并且您可以实际测试所有代码。

也许作为经验，您应该让人们尝试完成 90% 的应用程序，以便他们看到最后 10% 的不同之处......

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-04T00:14:44.337

我发现了一些对时间估算有很大帮助的东西

1.  熟悉代码库。当你可以听规范并认为“我需要接触 A、B 和 C 类——不多不少”，那么你就可以非常准确了。我发现这比知道需要编写哪些特定函数更好，因为这样您就知道*不需要*编写什么。
2.  记住包括测试、错误修复、部署和最后一分钟的请求。很容易忘记您需要迁移一堆记录。
3.  在一定程度上，熟悉语言。如果你知道你需要哪些库，那么知道你*不需要做*什么就变得更容易了。

我也非常成功地使用它来近似同事的速度，它只需要一些经验观察来了解他们可以多快开发一个功能以及在实际测试*之前它会有多好。*

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-04T05:00:08.067

80/20 现象的根本原因之一是任何困难的——有时甚至是微不足道的——任务总是会发生意想不到的事情。例如：由于一些过分热心的流程经理，您的软件设计流程要求的文档突然获得了新的模板格式。突然之间，为新版本更新文档不仅仅是一件简单的事情——您现在必须重新构建每个文档，而所有这些文档都需要更多的时间。

我听到的处理此类现象的最佳建议之一是始终将缓冲区子任务构建到项目计划中 - 由[Richard Whitehead](http://search.barnesandnoble.com/Leading-a-Software-Development-Team/Richard-Whitehead/e/9780201675269/?itm=9)推荐。每项主要任务都会增加 20% 的时间（或大约在某个地方），并将其标记为该任务的子任务。每个的目的是为该任务“出现问题”时发生的情况提供一些衡量标准。作者承认（我也发现这是真的）管理层通常会尝试删除这些缓冲任务——你唯一的办法是要么坚持自己的立场，要么像 Joel 倡导者那样采取行动（正如@Casey 已经提到的那样）。在实践中，我发现大量的缓冲区子任务通常确实存在，并且在紧张的日程安排中提供了几次帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-04T00:01:38.533

我发现最好的方法是使计划保持最新，每个任务的完成百分比。这样一来，进展就很明显了。与管理层沟通，他们应该随时了解您的位置。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-04T00:04:35.233

我认为，如果您正在对一项将 80% 和 20% 捆绑在一起的任务进行估算，那么您的开端就很弱。打破你的估计。把 80% 和 20% 做两个明确的任务；简单的一点和困难的一点，如果你必须的话。

然后，您可以预先为整个工作提供更现实的时间估计，并使生产更容易跟踪细节。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-04T00:04:54.530

计划时，请考虑到这一点。在估计完成一个子任务所需的时间时，给出“完成”而不是“基本完成”的估计（根据经验估计“完成”需要多长时间。抵制拒绝集成、文档、整理的诱惑，测试，测试后的错误修复，部署等作为将被吸收到其他任务中的小任务。

你最终会得到一个可怕的大估计。但是问问自己这是否与之前项目所花费的实际时间不一致。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-04T00:05:02.223

尽量提供最准确的估算，并尽可能提高项目的透明度。如果您始终接近您的估计，那应该足以让您的经理满意。[请记住，衡量生产力](http://www.martinfowler.com/bliki/CannotMeasureProductivity.html)是非常非常困难的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-04T00:12:44.730

> 我认为这归结为用户和管理层的看法。即使他们可能知道要完成的估算，他们仍然会沉浸在对所见事物的情绪和看法中，而估算数字则处于次要地位。这就是我试图弄清楚如何控制或管理期望的原因。

先写算法……然后是 UI。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-04T00:21:28.017

保持你的时间范围很短。估计接下来几周你会做什么比接下来几个月更容易。考虑将您的项目分解为较短的里程碑。一个月或几个月取决于您要做什么。这基本上就是 Scrum 所做的。然后只最准确地估计你在当前里程碑中要做的工作。当你到达那里并有更多数据可以作为估计的基础时，重新估计下一个里程碑。最后 20% 花费这么长时间的部分原因是，当您知道得不够多时，您可能会提前做出估计。

另外，尝试[宽带 Delphi](http://en.wikipedia.org/wiki/Wideband_delphi)估计技术。这将梳理出更多您可能没有考虑的隐藏成本。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-04T00:25:12.050

说“是的，到目前为止一切顺利，但还有很多事情要做……”可能不是表达你观点的最佳方式。在听到经理或客户可能会想“是的，还有很多事情要做，但他做这部分的速度如此之快，剩下的肯定是微不足道的”。

相反，请确保确定剩余的工作并安排它们。这样你就可以在剩下的 20% 的项目中显示你应该在哪里。如果花费的时间太长，您的日程安排将显示一个项目落后于日程安排，这应该会提高一些紧迫感。

每周更新您的任务（或多久定期更新一次状态报告）。确定有落后危险的领域，特别是如果其他领域依赖于它们。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-10T16:10:00.807

我认为最好是承诺不足和过度交付。

如果你的估计是正确的，那么你就占了那讨厌的 20%。你显然没有，这就是为什么它是一个问题。

也许你正试图给他们他们想要的一切，这是不切实际的。也许你没有充分考虑墨菲定律，或者没有给测试、发现错误、然后再次测试等足够的时间。

看起来你应该做更多的风险管理......

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-05-23T21:16:23.683

如果您始终发现最后 20% 的工作花费的时间是前 80% 的 4 倍，那么可能是时候与自己（或可信赖的同行）诚实讨论您是否让技术债务累积在最初的 80% 中上升，最后它会咬你。

这可能与您可以考虑改变的工作实践有关。

我所知道的减少技术债务的两个最佳实践是编写良好的测试（最好在编写代码之前，但也可以使用后记），以及在每个任务之后进行重构。把重构想象成每顿饭后打扫厨房，而不是月底。

# dependency-injection - 使类遵循 OCP - 将函数分解为对象

> ID：608755
> 
> 赞同：0
> 
> 时间：2009-03-04T00:01:02.077
> 
> 标签：dependency-injection, single-responsibility-principle, open-closed-principle

我有一门课，我一直在添加。

```
public class OrderRepository{
    public void Add(IEnumerable<Order> orders){}
    public void Update(IEnumerable<Order> orders){}
    public void Remove(IEnumerable<Order> orders){}
    public void Expedite(IEnumerable<Order> orders){}
    public void GetOrderData(Order order, DateTime start, DateTime end)
    etc...
} 
```

我突然想到这个类不是 Open-Closed，因为所有这些新特性都被添加了。所以我考虑通过将这些函数封装到 Request 对象中来关闭这个类以防止这种变化。我最终得到类似的东西：

```
public abstract class RequestBase{}

public class AddRequest : RequestBase{}

etc...

public class OrderRepository{
    public void ProcessRequest(RequestBase request){}
} 
```

这使得 OrderRepository 对扩展开放，对修改关闭。但是，我很快遇到了一些问题：

1.) 请求需要操作的数据是用户提供的（运行时）和依赖注入提供的。我显然不能同时满足一个构造函数。我不能这样做：

```
public class AddRequest{
    public AddRequest(IEnumerable<Order> orders, int UserSuppliedContextArg1, DependencyInjectionArg1, DependencyInjectionArg2);
} 
```

并称之为。我想要一种方法让 DI 框架为我“部分地”构造一个对象，然后让我做剩下的事情。但是，我看不到任何这样做的方法。我看到一个博客把这个概念称为“变量构造函数注入”。

2.) 我想到的下一件事是将它分成 2 个单独的类。用户将创建并填充一个 RequestContext，然后将其传递到存储库中，这将创建一个 RequestProcessor（想不出更好的名称）。我想过这样做：

```
public abstract class RequestContextBase<T> where T : RequestProcessorBase{}

public class AddRequestContext : RequestContextBase<AddRequestProcessor>

public class OrderRepository{
    public void ProcessRequest<T>(RequestBase<T> request){
        var requestProcessor = IoC.Create<T>();
    }
} 
```

这是一个很好的第一步。但是，请求处理器需要它存储的上下文的确切类型，而我在这里没有。我可以将类型字典用于类型，但这违背了 Open-Closed 的目的。所以我最终不得不做类似的事情：

```
public class RequestProcessorBase<TRequestContext, TRequestProcessorBase> where TRequestContext : RequestContextBase<TRequestProcessorBase> 
```

这很奇怪，我通常不喜欢[奇怪重复出现的模板模式](http://www.c2.com/cgi/wiki?CuriouslyRecurringTemplate)。此外，用户填写上下文并要求我提出请求的想法似乎很奇怪，尽管这可能只是一个命名问题。

3.）我想摆脱以上所有，只拥有：

```
public AddRequest{
    public AddRequest(DependencyInjectionArg1, DependencyInjectionArg2, ...){}

    public void PackArgs(UserSuppliedContextArg1, UserSuppliedContextArg2, UserSuppliedContextArg3, ...){}
} 
```

这还不错，但是 API 很丑。现在，这个对象的客户需要“构造”两次，就像以前一样。如果他们忘记调用 PackArgs，我必须抛出某种异常。

我可以继续，但这些是我目前遇到的最令人困惑的问题。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T04:28:43.603

存储库是您的域的一部分。使其通用化，虽然很诱人，但却违背了它作为无处不在的语言运营之家的目的。如果您可以对存储库做*任何事情*，那么您已经混淆了它的意图。

如果一个类遵循 SRP，则“不断添加”它违反了定义。这表明您正在引入的操作可能由服务更好地解决，或者应该与存储库分离。

**编辑以回应评论**

您希望将无处不在的语言保持在公开状态，同时确保班级承担最低限度的责任。

从存储库中分离出操作将是第一步。你可以这样做：

```
public interface IOrderExpeditionService
{
    void Expedite(IEnumerable<Order> orders);
}

public interface IOrderDataService
{
    void GetOrderData(Order order, DateTime start, DateTime end);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T02:22:26.977

Ayende 有[几个](http://ayende.com/Blog/archive/2006/12/07/ComplexSearchingQueryingWithNHibernate.aspx)关于[这个主题](http://ayende.com/Blog/archive/2007/03/12/Querying-Is-A-Business-Concern-Sample.aspx)的帖子。

基本上你想要做的是将你的查询从你的存储库中分离出来，然后把你的查询变成你**编写**的东西。使用由组合构造的查询，您可以轻松扩展它以添加新的查询方法，而无需向您的存储库添加新方法。你可以得到这样的结果：

```
public class Repository<T>
{
   T Find(IQueryCriteria queryCriteria);
} 
```

实际上，我还没有在 NHibernate 中完成此操作，但我们使用 LLBLGenPro 完成了此操作，并且效果非常好。我们为查询对象使用了一个流畅的接口，因此我们可以编写如下查询条件：

```
var query = new EmployeeQuery()
   .WithLastName("Holmes")
   .And()
   .InDepartment("Information Systems");

var employee = repository.Find(query); 
```

扩展存储库的功能就相当于简单地在查询对象上添加新方法。

# c++ - 嵌套 QDockWidgets

> ID：608784
> 
> 赞同：0
> 
> 时间：2009-03-04T00:13:33.840
> 
> 标签：c++, qt, qdockwidget

现在`QDockWidgets`，我的应用程序左侧有四个自定义项。当您启动应用程序时，每一个都是可见的，但由于每一个都是可见的，所以非常小。

我希望其中三个`QDockWidgets`嵌套在一个主要的后面，以赋予该一个优先级和屏幕的整个左侧。

有谁知道`QDockWidgets`在创建它们时如何告诉嵌套？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-17T19:39:48.007

这可以通过以下方式完成`QMainWindow.tabifyDockWidget`：

[http://doc.qt.io/archives/4.6/qmainwindow.html#tabifyDockWidget](http://doc.qt.io/archives/4.6/qmainwindow.html#tabifyDockWidget)

这将自动创建选项卡，您可以根据需要选择每个停靠小部件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-27T10:41:40.293

如果您不想使用 brianz 的解决方案来标记您的 QDockWidgets，只需交替使用 removeDockWidget 和 addDockWidget 来设置可见的停靠小部件。

例如，如果您有 dock1 和 dock2：

启动时：

```
g_Main->addDockWidget(Qt::LeftDockWidgetArea, dock1); 
```

在某些菜单操作上：

```
void MainWnd::ShowDock2(){
    g_Main->removeDockWidget(dock1);
    g_Main->addDockWidget(Qt::LeftDockWidgetArea, dock2);
    dock2->show();
} 
```

在另一个菜单操作上：

```
void MainWnd::ShowDock1(){
    g_Main->removeDockWidget(dock2);
    g_Main->addDockWidget(Qt::LeftDockWidgetArea, dock1);
    dock1->show();
} 
```

如果您从 QMainWindow 派生并通过使用停靠小部件的父类来在一个被添加到停靠时自动发送信号以从中删除其他小部件，则可以简化

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T00:44:28.290

这可能是不可能的，因为 QDockWidgets 与 QMainWindow 高度集成。
幕后发生的事情是 QMainWidow 有一个主布局，其中包含所有 QDocksWidgets、QToolbars 和主小部件。

有可能以某种方式使一个 QDockWidget 替换其他 QDockWidget 或被绘制在它们之上。您需要深入研究 QMainWindow 代码以确切了解如何执行此操作，并且可能从 QDockWidget 继承，这是您通常不应该做的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T14:14:15.113

不确定你到底在追求什么。也许您可以在停靠小部件中使用 QStackedWidget 之类的东西，并使用拖放事件来创建新的 QDockWidget 或将 QDockWidget 的内容移动到新的 QStackedWidget 中？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-21T02:58:33.083

尝试：

> QMainWindow::setDockNestingEnabled(true);

# javascript - CSS 悬停与 JavaScript 鼠标悬停

> ID：608788
> 
> 赞同：86
> 
> 时间：2009-03-04T00:15:39.373
> 
> 标签：javascript, css

有时我可以选择使用 CSS element:hover 或 JavaScript onmouseover 来控制页面上 html 元素的外观。考虑以下 div 包装输入的场景

```
<div>
<input id="input">
</div> 
```

当鼠标光标悬停在 div 上时，我希望输入更改背景颜色。CSS方法是

```
<style>
  input {background-color:White;}
  div:hover input {background-color:Blue;}
</style>

<div><input></div> 
```

JavaScript 方法是

```
<div onmouseover="document.getElementById('input').style.backgroundColor='Blue';">
  <input id="input">
</div> 
```

每种方法的优点和缺点是什么？CSS 方法是否适用于大多数 Web 浏览器？JavaScript 比 CSS 慢吗？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-03-04T00:18:18.337

:hover 的问题在于 IE6 仅在链接上支持它。这些天我使用 jQuery 来做这种事情：

```
$("div input").hover(function() {
  $(this).addClass("blue");
}, function() {
  $(this).removeClass("blue");
}); 
```

使事情变得容易得多。这适用于 IE6、FF、Chrome 和 Safari。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-03-04T00:17:46.030

CSS 更易于维护和阅读。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-04-27T20:20:08.390

在 javascript 中执行此操作的另一个好处是您可以在不同的时间点添加/删除悬停效果 - 例如，悬停在表格行上会改变颜色，单击禁用悬停效果并开始在原地模式下编辑。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-07-18T15:42:38.227

为什么不兼得？使用 jQuery 作为动画效果和 CSS 作为后备。这为您提供了 jQuery 的好处以及[优雅的降级](http://en.wikipedia.org/wiki/Graceful_degradation)。

CSS：

```
a {color: blue;}
a:hover {color: red;} 
```

jQuery（使用[jQueryUI](http://jqueryui.com/)动画颜色）：

```
$('a').hover( 
  function() {
    $(this)
      .css('color','blue')
      .animate({'color': 'red'}, 400);
  },
  function() {
    $(this)
      .animate({'color': 'blue'}, 400);
  }
); 
```

[演示](http://jsbin.com/aqocuy/2/edit)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-04T00:19:11.657

编辑：这个答案不再适用。CSS 得到了很好的支持，并且现在几乎所有 Web 体验都需要 Javascript（阅读：JScript），而且很少有人禁用 javascript。

最初的答案，正如我在 2009 年的看法。

在我的头顶上：

使用 CSS，您可能会遇到浏览器支持问题。

使用 JScript，人们可以禁用 jscript（这就是我所做的）。

我相信首选的方法是在 HTML 中做内容，用 CSS 布局，以及在 JScript 中动态的任何东西。因此，在这种情况下，您可能希望采用 CSS 方法。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-02-11T22:08:02.447

两者之间还有另一个区别要记住。使用 CSS时，当鼠标离开元素时，`:hover`状态*总是被取消激活。*但是，对于 JavaScript，`onmouseout`当鼠标从元素上移到浏览器 chrome 上而不是移到页面的其余部分时，不会触发该事件。

这种情况发生的频率比您想象的要多，尤其是当您在页面顶部使用自定义悬停状态创建导航栏时。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-06-16T02:32:30.690

一个很大的区别是当鼠标移出元素时，":hover" 状态会自动失效。因此，在悬停时应用的任何样式都会自动反转。另一方面，使用 javascript 方法，您必须同时定义“onmouseover”和“onmouseout”事件。如果您只定义“onmouseover”，则应用“onmouseover”的样式即使在您将鼠标移出后仍将保留，除非您已明确定义“onmouseout”。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-03-03T12:50:15.467

在 Internet Explorer 中，必须为 :hover 选择器声明一个 <!DOCTYPE> 才能作用于 <a> 元素以外的其他元素。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-04T00:18:06.200

使用 CSS，它可以更轻松地管理样式本身。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-04T01:14:04.897

在[使用 jQuery 进行悬停](https://stackoverflow.com/questions/608788/css-hover-vs-javascript-mouseover/608793#608793)时，我总是使用插件[HoverIntent](http://cherne.net/brian/resources/jquery.hoverIntent.html)因为它不会触发事件，直到你在一个元素上暂停一小段时间......如果你不小心运行，这会停止触发大量的鼠标悬停事件将鼠标悬停在它们上方或只是在选择选项时。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-04T00:58:27.727

如果您不需要 100% 支持禁用 javascript 的 IE6，您可以使用带有 IE 条件注释[的 ie7-js 之类的东西。](http://code.google.com/p/ie7-js/)然后您只需使用 css 规则来应用悬停效果。我不确切知道它是如何工作的，但它使用 javascript 来制作许多在 IE7 和 8 中通常不会正常工作的 css 规则。

# python - django-从管理员运行脚本

> ID：608789
> 
> 赞同：4
> 
> 时间：2009-03-04T00:17:13.237
> 
> 标签：python, django

我想编写一个不是由某个 URL 激活的脚本，而是通过单击管理界面中的链接来激活的。我该怎么做呢？谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-04T00:31:24.157

但是链接必须指向一个 URL，所以我认为您的意思是您想要一个仅在管理界面中可见的视图功能，并且该视图功能运行脚本？

`admin/base_site.html`如果是这样，用这样简单的东西覆盖模板：

```
{% extends "admin/base.html" %}
{% block nav-global %}
  <p><a href="{% url your-named-url %}">Do Something</a></p>
{% endblock %} 
```

这（应该）将链接放在管理界面的顶部。

将带有命名模式的 url 添加到 urls.py

然后只需制作一个普通的 django 视图并在视图顶部检查以确保用户是这样的超级用户：

```
if not request.user.is_staff:
    return Http404 
```

这将防止未经授权的人访问此视图。

接下来，在您查看上述代码之后，只需运行该脚本即可。

使用 Python 的 subprocess 模块执行此操作，例如：

```
from subprocess import call
retcode = call(["/full/path/myscript.py", "arg1"]) 
```

# objective-c - BOOL 在 Objective-C 中改变值？

> ID：608796
> 
> 赞同：2
> 
> 时间：2009-03-04T00:18:42.797
> 
> 标签：objective-c, boolean

我在`BOOL`物业方面遇到了麻烦，我无法弄清楚。

我的 .h 文件中有以下设置：

```
BOOL myVar;

@property BOOL myVar; 
```

然后在我的 .m 文件中，我合成`myVar`并拥有一个设置`myVar = YES;`并启动计时器的方法。然后计时器调用另一个方法来尝试读取 myVar 的值。

为了测试 myVar 的值，我有：

```
NSLog(@"The value of the bool is %@\n", (myVar ? @"YES" : @"NO")); 
```

通过控制台的第一个循环显示`myVar = YES`然后它说 NO。

我如何保持它的价值`YES`？是不是已经`YES`但是我的 NSLog 错了？我需要在该方法中测试是/否，因为所采取的操作将根据它们的值而有所不同。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-15T01:18:44.837

它失败的原因是因为我在比较 (myVar = YES) 而不是 (myVar == YES。)

是的——我是新来的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T00:35:05.863

设置一个观察点，`myVar`看看它是否真的发生了变化，没有看到更多的源代码，我们无法告诉你发生了什么:)

# flash - Flash：.as 与 .fla - loaderInfo.loader

> ID：608799
> 
> 赞同：0
> 
> 时间：2009-03-04T00:19:56.493
> 
> 标签：flash, actionscript-3, events

我有这个代码可以从 .as 文件中使用

```
if (loaderInfo.loader)
    loaderInfo.loader.dispatchEvent(new Event("pageFinish", true)); 
```

然后我把上面的代码放到一个 .fla 文件（另一个现有的 Flash 文件）中，但是（loaderInfo.loader）总是返回 false，即使它是从另一个 swf 加载的。因此，该事件永远不会被分派。

编辑：我会尝试更多地解释它。

这有效：
container.swf --(loads)--> page1.swf (page1.fla + page1.as)
page1.swf 确实将事件发送到 container.swf

这不起作用：
container.swf --(loads)--> page2.swf (page2.fla)
page2.swf 确实发送了事件，因为 loaderInfo.loader 在此处返回 false

在这两种情况下，container.swf 没有变化，只是将 xml 文件更改为指向 page1.swf 或 page2.swf

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T00:51:21.737

无法对此进行测试，但只是从头开始：

确保加载的 swf 有权访问加载程序（`LoaderContext`、`ApplicationDomain`等）。

您可以通过在加载的剪辑中编写它来测试它：

```
trace(loaderInfo.childAllowsParent);
trace(loaderInfo.ParentAllowsChild);
trace(loaderInfo.sameDomain); 
```

如果这些跟踪之一返回错误，请告诉我们...

当您尝试访问其加载器时，请确保您的文档已完全构建。

```
loaderInfo.addEventListener(Event.INIT, eventComplete);
loaderInfo.addEventListener(Event.COMPLETE, eventComplete);

function eventComplete(event:Event):void
{
    trace(event.target.loader);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T00:40:55.350

如果通过 Loader 对象加载 swf，则使用 loaderInfo。如果编译的 fla swf 是通过 Loader 加载的，那么 loaderInfo.loader 将不会返回 false

# unit-testing - 犀牛模拟和一般模拟

> ID：608808
> 
> 赞同：3
> 
> 时间：2009-03-04T00:24:11.490
> 
> 标签：unit-testing, rhino-mocks

是否有任何地方或任何人可以用简单的英语而不是“***根据自己定义术语***”来解释这是如何工作的？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-04T00:30:11.990

所以，你有一个依赖于其他东西的类。

让我们打个比方：汽车需要引擎。

汽车依赖于发动机。测试汽车和发动机是否一起工作很容易，但是如果测试没有发动机的汽车，或者汽车正确地“调用”发动机呢？我们能做的就是用一些东西（模拟）代替发动机，然后按下油门（打电话），并验证假（模拟）发动机是否收到了正确的节气门体输入。您没有验证整个系统，而是通过使用模拟对象进行测量，单独测试了您想要的东西。

它在实践中变得更加复杂和强大，但是......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T00:35:01.323

如果你为你的类编写单元测试，在某些时候你会遇到你的测试执行代码调用外部资源的情况。大多数情况下，这是一个数据库，但其他数据库也是可能的。我通常使用信用卡计费服务提供商作为示例，因为在这种情况下，您显然不想在每次运行测试时实际调用该服务。

在这种情况下，通常将服务对象替换为一种不使用任何资源的虚假服务。这称为存根或模拟对象。存根和模拟之间的区别似乎是一些讨论的主题，但本质上它们是相同的。

作为 Rhino Mock 的 Mocking 框架可帮助您创建模拟对象，这些对象会按照您对实际服务的期望进行响应。您可以将其与每次执行测试时可以重播的服务调用的实际响应记录进行比较。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-11-20T14:58:48.823

要真正理解 Mocks，首先必须掌握四个概念

什么是交互测试

什么是隔离框架（如 rhino mocks）

什么是假货

什么是存根

最后什么是模拟

交互测试是关于检查特定方法（您正在测试的方法）是否使用它应该使用的参数调用另一个类（外部依赖项）中的另一个方法。想象一下，您在某个类中有一个方法，每次使用无效参数调用它时都会记录下来。为了阐明存根和模拟之间的区别，我添加了 2 个外部依赖项（IStringAnalyzer 和 ILoger）：

```
class SomeClass
{
    IStringAnalyzer stringAnalizer;
    ILogger logger;

    public SomeClass(IStringAnalyzer stringAnalyzer, ILogger logger)
    {   
        this.logger = logger;
        this.stringAnalyzer = stringAnalyzer;
    }

    public void SomeMethod(string someParameter)
    {
        if (stringAnalyzer.IsValid(someParameter))
        {
            logger.Log("Invalid string");
        }else
        {
            //do something with someParameter
        }
    }
} 
```

在此示例中，您要测试对 SomeClass 的 SomeMethod 的方法调用是否使用无效参数调用 ILogger 中使用字符串参数“Invalid string”的 log 方法。您*不想*使用 IStringAnalyzer 和 ILogger 的“真实”实现，因为它们可能有错误，并且因为这是*单元*测试，您只想一次测试一件事，如果您测试如何一次测试几件事情真正做的是集成测试。一次只测试一件事的原因是，如果您的测试失败，您会立即知道它失败了，因为您正在测试的只有那件事。

您需要提供两种替代实现，一种用于 IStringAnalyzer，另一种用于 ILogger，以便您可以正确执行此测试。这些替代实现在他们需要做什么方面会有所不同。对于 IStringAnalyzer，您只希望它在被调用时返回 false，以便被测方法将通过您要测试的代码路径。你真的不关心参数的值（someParameter）。

对于 ILogger 的 log 方法，您想知道它是否被调用，并且它是用“无效字符串”调用的，以便您可以在测试中断言它。

IStringAnalyzer 和 ILogger 的这两种替代实现都被称为“假货”（因为它们伪造了外部依赖项），但一种是存根（IStringAnalyzer），另一种是模拟（ILogger）。存根只是为了让您到达您需要进行测试的地方（在这种情况下，IStringAnalyzer 的 IsValid 方法返回 false）。模拟可以让您检查与外部依赖项的交互是否正确完成（在本例中为 ILogger）。有些人将模拟（或此类模拟）称为测试间谍（我认为这是一个更好的名字）。是的，还有其他类型的模拟（虽然我从未使用过它们）。一个很好的来源是使用 Michael Feathers 和 Roy Osherove 的 The art of unit testing 的遗留代码。

您可以“手动”创建存根和模拟，例如：

```
class StringAnalyzerStub : IStringAnalyzer 
{   
    public bool whatToReturn;

    public StubStringAnalyzerStub(bool whatToReturn)
    {
        this.whatToReturn = whatToReturn;
    }

    public bool IsValid(string parameter)
    {
        return whatToReturn;
    }
}

class LoggerMock : ILogger
{
    public string WhatWasPassedIn;

    public void Log(string message)
    {
        WhatWasPassedIn = message;
    }
} 
```

这是测试：

```
[Test]
public void SomeMethod_InvalidParameter_CallsLogger
{
    IStringAnalyzer s = new StringAnalyzerStub(false); //will always return false when IsValid is called
    ILogger l = new LoggerMock();
    SomeClass someClass = new SomeClass(s, l);

    someClass.SomeMethod("What you put here doesnt really matter because the stub will always return false");

    Assert.AreEqual(l.WhatWasPassedIn, "Invalid string");
} 
```

手动执行此操作的问题是容易出错且难以维护，因此需要像 Rhino Mocks 这样的隔离框架。它们允许您动态创建这些模拟和存根，这是使用 Rhino Mocks 进行相同测试的样子（使用排列、行为、断言语法）：

```
[Test]
public void SomeMethod_InvalidParameter_CallsLogger
{
    Rhino.Mocks.MockRepository mockRepository = new Rhino.Mocks.MockRepository();
    IStringAnalyzer s = mockRepository.Stub<IStringRepository>();
    s.Expect(s => s.IsValid("something, doesnt matter").IgnoreParameters().Return(false);
    ILogger l = mockRepository.DynamicMock<ILogger>();
    l.Log("Invalid string");
    SomeClass someClass = new SomeClass(s, l);
    mockRepository.ReplayAll();

    someClass.SomeMethod("What you put here doesnt really matter because the stub will always return false");

    l.AssertWasCalled(l => l.Log("Invalid string"));
} 
```

没有根据自己定义的术语:)

免责声明：我在文本编辑器中编写了所有这些，因此代码中可能存在一些语法错误......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T00:28:12.620

模拟是您可以指示以某种方式表现的代理。这对于测试您希望通过使用模拟对象切换实际实例来消除依赖关系的位置很有用。

与存根模拟不同的是，模拟跟踪实际使用情况，因此您的测试可能会验证模拟是否按预期使用。

更多信息请参阅 Fowler 的[文章](http://martinfowler.com/articles/mocksArentStubs.html)。

# python - 获取活动窗口的名称

> ID：608809
> 
> 赞同：11
> 
> 时间：2009-03-04T00:24:57.337
> 
> 标签：python, windows

我想在 Windows 上编写一个 python 脚本来保存用户在给定时间使用的程序的标题，例如[http://www.rescuetime.com](http://www.rescuetime.com)。出于隐私考虑，我不想使用救援时间，而是编写一个脚本，我自己做类似的事情来捕获有关我使用计算机的数据。

是否有一些简单的命令可以用来读取这些信息？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-04T00:27:40.140

[来自 daniweb](http://www.daniweb.com/forums/thread134111.html)

```
 import win32gui
  w=win32gui
  w.GetWindowText (w.GetForegroundWindow()) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2022-03-04T22:12:41.343

可能已经为时已晚，但以下是在大多数操作系统上应该工作的内容：

```
import pyautogui
window_title = pyautogui.getActiveWindowTitle() 
```

（我不确定它是否适用于 Ubuntu，但通常支持 Mac Os、Linux 和 Windows）

# php - 在 CakePHP 驱动的站点中我应该把这个方法放在哪里？

> ID：608812
> 
> 赞同：0
> 
> 时间：2009-03-04T00:26:34.247
> 
> 标签：php, cakephp

我正在使用 CakePHP 编写一个应用程序，但我不确定应该将我的`generateMapUrl`函数放在哪里。

```
function generateMapUrl($id = null) {
    if ( !$id ) {
        $this->Session->setFlash('Invalid Property Id');
    } 
    $this->read(null, $id);
    $url = "http://maps.google.com/maps?oi=map&amp;q=";
    $url .= $this->data['street_num'] . '+';
    $url .= $this->data['street'] . '+';
    $url .= $this->data['city'] . '+';
    $url .= $this->data['province'] . '+';
    $url .= $this->data['country'] . '+';
    $url .= $this->data['postal_code'];

    return $url;
} 
```

我有以下结构：

> 预订（模型和控制器）
> 属性（模型和控制器）
> 地址（模型和控制器）

预订`hasOne`物业和物业`hasOne`地址。我希望能够要求`generateMapUrl`任何地址。我不确定将方法放在哪里......地址控制器？地址模型？（注意：我从 Bookings 控制器调用此方法）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T00:27:45.663

在 Controller 中，它有会话数据。模型不应该知道任何会话状态。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T00:36:29.103

我可能会考虑创建一个 AddressMapUrlGenerator 类并使用它来创建 URL。你可以给它一个地址。这样一来，您就不会因为担心 url 或地图而混淆模型，并且您将来也不会担心将相同的功能分布在多个控制器中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T01:01:59.497

在模型中构建一个 GoogleAddress 类。然后在控制器中使用 GoogleAddress。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T09:53:50.527

generateMapUrl() 方法应该是您的 Address 模型中的一个方法，因为它正在处理获取和格式化 Address 数据，但应该返回 false 并且不包含会话调用：

```
function generateMapUrl($id = null) {
  $this->recursive = -1;
  if (!$this->read(null, $id)) {
    return false;
  } 
  $url = "http://maps.google.com/maps?oi=map&amp;q=";
  $url .= $this->data['street_num'] . '+';
  $url .= $this->data['street'] . '+';
  $url .= $this->data['city'] . '+';
  $url .= $this->data['province'] . '+';
  $url .= $this->data['country'] . '+';
  $url .= $this->data['postal_code'];  
  return $url;
} 
```

然后，您可以从任何控制器调用它并在那里使用会话调用：

```
function x() {
  if (!$mapUrl = ClassRegistry::init('Address')->generateMapUrl($addressId)) {
    $this->Session->setFlash('Invalid Property Id');
  }
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-04T01:03:11.193

至少，发生了三件事：

1) 创建 URL 2) 错误处理 3) 虽然不明确，但实际调用。

URL 的创建应该由一个专门的帮助类来处理。最好在控制器上执行检查，实际的检查代码将驻留在其他地方。错误处理应该在控制器上，因为它必须为用户所在的特定位置执行任何特殊操作。最后，调用本身当然应该在控制器上进行。

# svn - 有没有办法从 SVN 更新中排除大文件或某些文件类型？

> ID：608830
> 
> 赞同：2
> 
> 时间：2009-03-04T00:35:02.667
> 
> 标签：svn, version-control

只是想知道是否可以从 SVN 更新中排除大文件或某些文件类型？

我问是因为我正在家里结帐，但我们在主干中有几个大的 .flv 文件，我现在不需要这些文件，我想节省带宽。

我正在使用乌龟 SVN。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T00:39:22.747

在您的客户端上使用 Subversion 1.5 并使用[Sparse Checkouts](http://subversion.tigris.org/svn_1.5_releasenotes.html#sparse-checkouts)。仅当您可以确保所有大文件都在同一个位置时，这才有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T00:39:58.177

另一种选择可能是将 .flv 文件移出主干，以便您的更新保持简单。

# .net - 我必须在新类中覆盖 GetHashCode 和 Equals 吗？

> ID：608839
> 
> 赞同：4
> 
> 时间：2009-03-04T00:38:58.817
> 
> 标签：.net

好的，所以如果我重写 Equals，我需要重写 GetHashCode，反之亦然。

但我只是想知道：我是否应该在任何课程中始终覆盖这两个？特别是如果我知道我会在字典或类似的集合中使用它们？虽然这是[相当简单](https://stackoverflow.com/questions/263400/what-is-the-best-algorithm-for-an-overridden-system-object-gethashcode/263416#263416)的，但它仍然是每个班级的额外工作。

System.Object 实现是否足以担心这个问题？

编辑：你能详细说明什么是价值和参考平等吗？因此，如果我有两个字符串（s1 和 s2）都是“测试”，它们的值相等，但由于它们是两个不同的字符串，它们不是引用相等的？好的，对于字符串来说这很简单，但是您希望引用或值相等的常见情况是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T00:43:09.243

据我所知，如果您需要值相等语义，您只需要覆盖它们。System.Object 实现并不“坏”，它只是做一个引用检查（这是该级别的所有实现都可以做的）。

简而言之：如果您需要某种基于值的相等性（基于类属性的相等性），那么是的，覆盖掉。否则，它应该已经很好了。

**编辑：** 您只**需要**在上述情况下覆盖它们。如果你覆盖一个，你确实需要覆盖两者，原因很明显（它们需要保持一致等）。您*可以*出于其他答案中指出的其他原因在每个类上覆盖它们（例如使用哈希值的算法的性能，即`Dictionary`键等），但您不需要，默认`System.Object`实现将正常工作。

**编辑2：** 要求提供更多信息，所以这里。考虑以下伪类：

```
public class User {
    private int _id;
    private string _username;
    public string Username { get {return _username;}};
    // [snip] Whatever other properties we might like to have.

    public User(string username) {
        // Initialise our user from a database, or whatever.
    }
} 
```

就目前而言，以下代码可能看起来很直观：

```
User foo = new User("me");
User bar = new User("me");
User baz = foo;

if (foo.Equals(bar)) {
    Console.WriteLine("1: Success!");
}
if (foo.Equals(baz)) {
    Console.WriteLine("2: Success!");
} 
```

但它只会打印出来：

> 2：成功

为什么？`foo`并且`bar`是该类的两个单独的实例，并且具有单独的引用。引用就像 C/C++ 中的指针。foo 和 baz 是相同的引用，因为一个是从另一个分配的。但是，它们都具有相同的*值*，用户称为“我”。基于值的实现的示例实现`.Equals`可能是：

```
partial class User {
    public override bool Equals(object b) {
        if (b == null) return false;
        if (b.GetType() != this.GetType()) return false;

        // Now the heavy lifting
        User other = (User)b;
        if (other._id == this._id) return true;
        else return false;
    }
} 
```

看看它是如何检查类的部分属性以确定相等性的吗？这就是工作中的价值平等。引用相等只是一个简单的`this == b`检查。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T00:46:33.730

这两种方法应该是*一致*的。换句话说，如果两个对象*相等*，那么每个对象都应该返回相同的*哈希码*。这在散列集合中尤为重要。为了在散列容器中找到与对象 X 匹配的对象，容器将只测试那些与 X 具有相同散列码的项目是否相等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T00:43:54.767

仅当您需要 Value 语义时。来自[MSDN](http://msdn.microsoft.com/en-us/library/336aedhh(VS.71).aspx)：

> 对于某些类型的对象，最好让 Equals 测试值相等而不是引用相等。如果两个对象具有相同的值，即使它们不是同一个实例，Equals 的此类实现也会返回 true。构成对象值的定义取决于类型的实现者，但它通常是存储在对象实例变量中的部分或全部数据。例如，字符串的值是基于字符串的字符；String 类的 Equals 方法对于包含以相同顺序完全相同的字符的字符串的任意两个实例返回 true。

# sharepoint - Sharepoint 2007/WSS 3.0 在 WebFrontend 上发生了什么，在 Application Server 上发生了什么？

> ID：608851
> 
> 赞同：3
> 
> 时间：2009-03-04T00:47:10.453
> 
> 标签：sharepoint, deployment, moss, wss

在 Sharepoint 解决方案中，我可以将部署的 DeploymentServerType 指定为 ApplicationServer 或 WebFrontEnd。不幸的是，这方面的文档相当有限。

我只是想知道：我什么时候会使用哪个选项？如果我的解决方案同时包含计时器作业（应该在应用服务器上运行？）和 Web 部件（需要转到每个 Web 前端）怎么办？如果我仍然指定服务器，这实际上会如何影响部署？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T02:13:17.917

DeploymentServerType 参数是可选的 ( [MSDN](http://msdn.microsoft.com/en-us/library/ms412929.aspx) )，如果指定它会限制您的解决方案部署到场中的哪些服务器。如果您同时拥有 App Server 和 Web Frontend 组件，那么只需将参数保留在外，以便将其部署到所有服务器。

请参阅以下博客文章中的“解决方案元素”部分：

[http://blogit.create.pt/blogs/andrevala/archive/2008/02/17/sharepoint-2007-deployment_3a00_-creating-solutions.aspx](http://blogit.create.pt/blogs/andrevala/archive/2008/02/17/sharepoint-2007-deployment_3a00_-creating-solutions.aspx)

> “DeploymentServerType - 指示部署此解决方案的目标服务器类型。可以是 ApplicationServer 或 WebFrontEnd。此属性是可选的（如果不使用，则将解决方案部署到场中的所有服务器）”

编辑：因此从逻辑上讲，如果您的解决方案仅包含 WFE 内容（Web 部件、页面、图像等），那么您可以使用 WebFrontEnd 参数。如果它包含 AppServer 内容（计时器作业或部署到管理中心的任何内容 - 例如额外的管理页面），则使用 ApplicationServer 参数。一般来说，我发现大多数解决方案都会部署到 WebFrontEnd。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T05:00:33.120

如果您正在谈论如何设置场，则有很多关于在 technet 上[规划](http://technet.microsoft.com/en-us/library/cc261834.aspx)和[部署](http://technet.microsoft.com/en-us/library/cc303424.aspx) [SharePoint的文档。](http://technet.microsoft.com/en-us/office/sharepointserver/default.aspx)

如果您正在谈论以编程方式为 SharePoint 创建解决方案文件 (wsp)，您能否更具体一点？您是在谈论 manifest.xml 文件中的属性吗？

# sql - 启用这种多读卡器解决方案的适当隔离级别是多少？

> ID：608852
> 
> 赞同：3
> 
> 时间：2009-03-04T00:47:13.150
> 
> 标签：sql, sql-server, database

我有一个数据库表，其中包含多个读者同时处理的工作项队列，具有以下要求：

*   每个项目只能由一个读者处理。
*   如果读取器因任何原因失败，则应将项目返回队列以供其他读取器处理。

这是可能解决方案的伪代码，每个读者都会执行以下操作：

* * *

1）从队列中读取下一个项目并将其存储在本地某处。

2) 开始交易

3）删除该项目，以防止其他读者看到它。如果删除失败，则意味着另一个工作人员已经提取了该项目，因此请返回步骤 1。

4) 处理项目（在步骤 1 中本地存储）。这可能会持续很长时间。

5) COMMIT TRANSACTION : item 删除已提交，进入 step 1 处理下一个 item

或者

6）ROLLBACK TRANSACTION（显式回滚或读取器故障）：删除项目被回滚并返回队列等待另一个读取器

* * *

我的问题是：我需要的最低隔离级别是多少，以确保在第 3 步（项目删除）之后，其他读者看不到它？最低，我的意思是我想在保持完整性的同时最大化并发性。

注意我使用的是 SQL Server 2005，如果重要的话（我认为这应该与产品无关，对吧？）

欢迎对这种方法提供任何其他反馈。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T00:53:33.010

我使用的另一种处理方法是：

1.  每个工作项都有一个用于 State 的列和一个用于 ReaderID 的列。状态可以是“新”、“活动”或“完成”。（我也使用“错误”。）

2.  每个读者都有自己的 ID。

3.  Reader 的第一个操作是使用一条 SQL 语句更新第一个状态为“N”的排队项，该语句将状态设置为“A”并为其自身设置 ReaderID。

4.  然后阅读器处理工作项，完成后将状态设置为“C”。

出于您的目的，您可以通过在一个语句中执行结帐操作来避免隔离问题。

SQL 将类似于：

更新队列
SET State = 'A', ReaderID = @myWorkerID
WHERE queueid = (SELECT MIN(queueid) FROM queue WHERE state = 'N')

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T00:54:36.893

如果从“队列”机制中删除项目后，没有进程可以访问它，则在实际处理项目时不需要保持事务打开。

[可重复读](http://msdn.microsoft.com/en-us/library/ms173763.aspx)隔离级别：

> 指定语句不能读取已被其他事务修改但尚未提交的数据，并且在当前事务完成之前没有其他事务可以修改当前事务已读取的数据。
> 
> 共享锁被放置在事务中每个语句读取的所有数据上，并一直保持到事务完成。这可以防止其他事务修改当前事务已读取的任何行。其他事务可以插入与当前事务发出的语句的搜索条件匹配的新行。如果当前事务然后重试该语句，它将检索新行，从而导致幻读。因为共享锁被持有到事务结束而不是在每个语句结束时被释放，所以并发性低于默认的 READ COMMITTED 隔离级别。仅在必要时使用此选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T01:05:11.750

如果在查询中使用行级锁定和 readpast 语句，则可以只选择那些未锁定的行。

看起来像这样。

SELECT queue FROM queue with (rowlock, xlock, readpast) WHERE state = 'N'

我建议您阅读 SQL Server 中的锁定提示，这将对您有很大帮助。

# python - python PIL安装在共享主机上

> ID：608854
> 
> 赞同：2
> 
> 时间：2009-03-04T00:50:22.677
> 
> 标签：python, compilation, python-imaging-library

我将在共享主机提供商上部署一个 django 应用程序。我在家里安装了自己的python，它工作正常。我的问题来自于 PIL 的安装，编译过程后我不支持 JPEG。

我知道编译器找不到“libjpeg”，所以我尝试在家里安装它，我下载了 tar.gz 并用

```
./configure -prefix=$HOME/lib
 make
 make install 
```

在我将路径放入 my.bashrc 文件之后。

毕竟我重新编译 PIL 仍然没有 jpeg 支持。

可以将库安装在共享托管环境中吗？我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T01:56:50.503

机器上是否真的有 libjpeg 可用？

查找 /usr/lib/libjpeg.so 和 /usr/include/jpeglib.h；它们可能位于不同的库和包含目录中。如果找不到它们，您还必须下载并将 libjpeg 编译到您的家中（通常前缀为 ~/.local）。

然后，您需要在 PIL 的 setup.py 中将 'lib' 路径添加到 'library_dirs' 变量，并将 'include' 添加到 'include_dirs' （例如，就在“# add standard directory”下），以引起注意libjpeg 的可用性。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-05T09:21:23.860

不知道你的问题出在哪里

你可以在不编译任何东西的情况下使用 PIL！只需将文件夹放在 PYTHONPATH 中的一个位置，就可以了。

# python - 从 setuptools 包中排除顶级目录

> ID：608855
> 
> 赞同：42
> 
> 时间：2009-03-04T00:50:23.517
> 
> 标签：python, setuptools

我正在尝试使用 setuptools 将 Python 项目放入 tarball。问题是 setuptools 似乎不喜欢最初设置源树的方式（不是我，我必须添加）。我真正想要分发的所有内容都在顶级目录中，而不是像 setuptools 文档所说的那样在子目录中。

树有一个目录，`tests`，我不想在发布的包中拥有它。但是，使用`exclude_package_data`似乎并没有真正做任何排除，我想弄清楚我做错了什么。

我`setup.py`看起来像这样，在相关部分：

```
setup(
  name="project",
  packages=[''],
  include_package_data=True,
  exclude_package_data={'': ['tests']},
  test_suite='nose.collector',
) 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2012-03-19T11:59:20.953

我们使用以下约定从包中排除“测试”。

```
setup(
   name="project",
   packages=find_packages(exclude=("tests",)),
   include_package_data=True, 
   test_suite='nose.collector',
) 
```

我们还使用 MANIFEST.in 来更好地控制做什么`include_package_data=True`。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2020-01-10T17:21:34.203

我在同一个问题上浪费了几个小时，试图排除一个模块，我终于发现我必须删除`*.egg-info`and`build`目录，这以某种方式保留了必须包含模块的想法。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2015-09-22T20:38:46.450

这是我在[setuptools 手册](https://pythonhosted.org/setuptools/setuptools.html#using-find-packages)中找到的：

```
from setuptools import setup, find_packages
...
packages = find_packages(exclude=["*.tests", "*.tests.*", "tests.*", "tests"]), 
```

在我的情况下，以下内容足以排除顶级测试目录：

```
packages = find_packages(exclude=["tests.*", "tests"]), 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2015-02-01T20:11:07.853

我在我的`setup.py`...

```
setup(name='pyfoo',
      version="1.0.2",
      description='Example for stack overflow',
      url='http://stackoverflow.com/',
      author='David Michael Pennington',
      author_email='mike /|at|\ pennington.net',
      license='GPL',
      platforms='any',
      keywords='Stack Overflow Example',
      entry_points = "",
      long_description=read('README.rst'),
      include_package_data=True,  # Checks MANIFEST.in for explicit rules
      #                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      packages=find_packages(),
      use_2to3=True,
      zip_safe=False,
      setup_requires=["setuptools_hg"], 
```

我有一个`doc/`目录，由于其中包含的图像数量而变得庞大；这意味着我的大小`sdist`正在增长超过 500kB。原来我有这个在我的`MANIFEST.in`...

```
include LICENSE CHANGES README.rst requirements.txt
recursive-exclude * __pycache__
recursive-exclude * *.pyc
recursive-exclude * *.pyo
recursive-exclude * *.orig 
```

为了排除我的 doc 目录，我唯一要做的就是`MANIFEST.in`...底部的这一行

```
prune doc* 
```

使用`prune doc*`突然`doc/`从压缩包中删除了我的所有目录`sdist`。所以，看起来你只需要在`MANIFEST.in`文件中使用它......

```
prune tests* 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-04T02:41:14.563

呃，setuptools 让这变得非常棘手:(

我不知道这是否是您想要的，但我从事的一个项目结合了两件事：

```
from setuptools import setup, find_packages
...
packages = find_packages(exclude=['tests']),
data_files = os.walk(path_to_files), 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-09-16T13:17:56.733

在我的情况下有效的附加解决方案。显然：packages=setuptools.find_packages(exclude=["tests.*", "tests"]),

没用，但是：

```
packages=setuptools.find_packages(exclude=["*tests.*", "*tests"]), 
```

在单词的开头添加星号就可以了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-16T10:33:39.850

为了类似的目的，我的同事写了 setuptools-dummy 包：http: [//github.com/ella/setuptools-dummy/tree/master](http://github.com/ella/setuptools-dummy/tree/master)

看看 setuptools_dummy，根据您的需要修改排除项，它应该可以工作。如果没有，请打开一个问题；）

# language-agnostic - 幻数与命名常量

> ID：608856
> 
> 赞同：15
> 
> 时间：2009-03-04T00:51:15.480
> 
> 标签：language-agnostic

在编写代码时，尤其是在处理日期和时间时，您必须使用很多特定的数字，例如：60 秒一分钟，3600 = 秒一小时。

有些人坚持对其中的许多使用原始值，而另一些人则将它们放入常量中以增加可读性。

例如：

```
$x = time() + 3600;
$y = time() + 86400;
$z = time() + 604800;

// vs

define('MINUTE', 60);
define('HOUR',   60 * MINUTE);   // 3600
define('DAY',    24 * HOUR);     // 86400
define('WEEK',    7 * DAY);      // 604800

$x = time() + HOUR;
$y = time() + DAY;
$z = time() + WEEK; 
```

当然，第二个更容易阅读，但是对于一些较低的值来说有点 OTT，那么**你到底在哪里画线呢？**就个人而言，我认为 86400 的可读性没有问题（在我的脑海中，我自动将其读作“24 小时”），但会在 WEEK 常数处画线。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-04T01:06:24.633

86400 不行，因为您很容易将其误输入为 84600、88400 等

输入错误的常量将是编译错误

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-04T00:54:59.153

我的一位教授曾经告诉我们，除了 1、-1 和 0 之外，不要在我们的代码中添加任何幻数。这有点极端，但它在我脑海中萦绕不去，仍然指导着我，尽管我并不完全遵守它。

在您的示例中，我希望在所有情况下都使用符号名称。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-04T00:56:21.023

我`15.minutes`几乎会到处使用常量（或一些可爱的衍生物，如 Rails 的约定）。对我来说，这是关于简化这一切的“打字”；如果我在一行中的某处看到“10 * MINUTES”，我知道我正在处理时间（或者有人准备踢屁股）。如果我看到 10 * 60 或 600，那么我完全有可能不明白我们处理时间如此容易。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-04T00:59:45.303

有一个相对好的论点，那么除了零或一以外的任何数字都应该是一个命名常数。即使在您断言您对 86400 的可读性没有问题的示例中，您的度量单位仍然存在一些歧义。

如果我在维护您的代码，我希望看到命名常量，例如：

```
const int secondsInDay = 86400; 
```

..那里没有太多歧义。:) 取决于是否有人（包括你自己……我的意思是，我很难记住我上周写的东西，更不用说去年了！）在某个阶段需要维护你的代码。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-04T00:55:09.730

我的方法是不使用命名常量，而是像这样保持单元分开：

```
long twelvePM = 12 * 60 * 60 * 1000L;
long timeout = 60 * 1000L; 
```

这样很明显，这是以毫秒为单位的，并且它们很容易调整，以防我以后想更改值。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-04T01:02:14.660

我告诉我的学生：

> 如果您可以阅读没有注释的代码，那么就不需要常量。如果您必须解释代码，那么它需要注释。

我也告诉他们：

> 思维不好。如果你编写的代码让人们不得不挖掘它来理解它，那不是一件好事。

因此，如果您可以向同事展示这些线条并且他们可以在没有常量的情况下理解它，那么没有它们您（可能）会很好。您可能需要常量。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-04T01:18:48.537

就我个人而言，我会使用 SECS_PER_MIN、SECS_PER_HOUR 等。我什至知道有时会使用 NANOS_PER_SEC。如果一种语言缺乏整数文字的科学记数法，我总是会这样做。

确切地说，这与可读性无关。使用 SECS_PER_DAY 而不是 86400 的原因不仅仅与我们期望读者的一般知识有关。这是关于自我记录的代码，这意味着明确地展示你的工作。

当然，每个人都知道一分钟有 60 秒。但他们也知道一小时有 60 分钟。如果您使用文字 60，那么您的代码的用途可能很明显。但为什么要冒险呢？

如果您使用 SECS_PER_MIN，那么很明显您将以分钟为单位的时间（在您的示例中仅为 1 分钟）转换为以秒为单位的时间。例如，您不是在以分钟为单位的时间上增加一小时，或者在以分钟为单位的角度上增加一度。您不会在以英寸为单位的长度上增加 5 英尺。

命名常量为周围的代码提供了更多的上下文。对于您添加时间的示例，我们只需查看一行就知道 $x 需要以秒为单位的时间。常量的名称重申了 $x 不是以毫秒、时钟滴答或微两周为单位的时间。这使每个人都更容易检查和维护单位的正确性：他们可以通过查看您打算做的事情来判断您实际上做了什么。他们甚至不必接受您打算将 60 毫秒添加到以毫秒为单位的时间的概念，但因为 $x 实际上以秒为单位，所以他们弄错了。

命名常量也有助于避免拼写错误。当然，每个人都知道一天有 86400 秒。这并不一定意味着他们不会将其拼写为 84600，或者如果其他人有错误，他们会立即发现错误。假设你有完整的测试，所以这样的错误永远不会进入现场，但修复它的最有效方法是防止错误的代码使其首先被测试。所以我会定义这样的常量（或任何语法）：

```
SECS_PER_MIN := 60; 
SECS_PER_HOUR := 60 * SECS_PER_MIN;
SECS_PER_DAY := 24 * SECS_PER_HOUR;
SECS_PER_WEEK := 7 * SECS_PER_DAY; 
```

或者，如果无论如何都需要其他常量（在时间的情况下，他们可能不需要，因为您在第一时间将所有内容标准化为秒以减少混淆的机会）：

```
SECS_PER_MIN := 60;
MINS_PER_HOUR := 60;
HOURS_PER_DAY := 24;
DAYS_PER_WEEK := 7;

SECS_PER_HOUR := SECS_PER_MIN * MINS_PER_HOUR;
etc. 
```

请注意 RHS 上的顺序：分钟明显“取消”，使工作更加清晰。时间上没什么大不了的，但是尽早建立一个一致的方案是很好的，这样当以后事情变得糟糕时（CLOCKS_PER_SEC，PLANCK_LENGTHS_PER_PARSEC），您可以使用熟悉的技术来正确处理它。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-04T01:20:26.690

为了在这样的单位中使用，一个好的技巧是命名*所有*单位（甚至是基数），这样您的代码就会像正确指定的测量值一样读取：

```
// The base unit of time is the second
const double second = 1.0;
const double ns = 1e-9 * second;
const double micros = 1e-6 * second;
const double ms = 1e-3 * second;
const double minute = 60.0 * second;
const double hour = 60 * minute;
const double day = 24 * hour;
const double week = 7 * day;
const double year = 365.24 * day; 
```

然后*始终*在代码中使用适当的单元

```
// Set up a 90 second timeout
timeout(90*second); 
```

或者

```
elapsedDays = floor(elapsedtime / day); 
```

您会不时在各种科学软件包（例如[Geant4 ）中看到此公式。](http://www.geant4.org/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-04T00:58:21.970

我倾向于几乎完全使用常量而不是幻数。我认为它增加了可读性，并在程序中为您提供一个点来修复任何错误。有几个神奇的 60 年代，例如：一分钟 60 秒，一小时 60 分钟。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-04T01:03:28.587

我保持简单；变量的名称和注释（如果需要非常神奇的数字）将足以通过代码审查。

```
int someDelay = 1232323; // in milliseconds. 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-09T20:44:17.023

我在教学时的经验法则（因此，比现实生活中更硬核的规则）是除 -1、0、1 或 2 以外的任何数字，并且多次使用需要成为常数。如果你只使用一次，你可以评论它，如果你喜欢...

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-04T00:54:08.703

我会根据项目的大小画线。项目越大，抽象和常量就越多……就这么简单。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-04T00:58:56.913

一天总是有 24 小时，而一个小时总是有 60 分钟。

我认为将它们命名为描述性常量的关键在于：a）数值不清楚（604800？）b）值可能有一天会改变

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-04T01:04:09.007

就个人而言，我喜欢使用命名常量，以防我必须更改常量的值，然后我只需要在一个地方进行。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-04T01:11:48.693

我肯定会使用常量，虽然你可以查看*86400*和 24 小时，但未来进行维护的程序员可能不会那么聪明，并且会为这个数字的确切含义而摸不着头脑。如果有一天你回来忘记了 86400 是什么意思，你也是这种情况。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-04T01:18:04.713

> ```
> $x = time() + HOUR;
> $y = time() + DAY;
> $z = time() + WEEK; 
> ```

魔法弦呢？我倾向于做这样的事情：

```
 $x = strtotime('now + 1 hour');
  $y = strtotime('now + 1 day');
  $z = strtotime('now + 1 week'); 
```

是的，它的运行速度可能会慢一些。但在更大的计划中，*这真的重要吗？*

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-04T01:40:28.890

我可能在这里要求投反对票，但我相信你的例子都不是神奇的数字。它们是定义明确的通用常量，您永远不必用其他东西代替。

我的方法是以前的一些答案的混合：

```
// properly named variables
int daysBeforeFriday = 4;

// expanded math expressions
int minutesBeforeFriday = 4 * 24 * 60;

// 4 days in seconds (clarification comments)
int secondsBeforeFriday = 4 * 24 * 60 * 60;

// etc.. 
```

但是，如果所涉及的值不明显或优化和/或可重复性受到关注（例如，浮点值及其舍入误差），我会在常量内预先计算某些表达式。

请原谅我使用 C 作为最后一种情况的示例，但请看[这里](http://www.google.com/codesearch/p?hl=en#XctARFle764/glibc-1.09.1/math/math.h&q=#define%20M_PI&l=276)以理解我的意思。;)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-04T02:28:13.813

我使用命名常量

*   如果该号码将出现在多个地方
*   如果数字可能会改变（新配置，新项目）

有时我会嵌入数字，作为可读性提示。

```
#define LPP57   57     // Lines per page 
```

等等

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-04T04:13:39.083

常量包含度量单位对可读性很重要。除此以外

$x = 时间（） + 小时；

几乎没有更好的。我们怎么知道 $x、time() 函数和常数 HOUR 都是以秒为单位的数字？好吧，我们不能重命名 time() 函数，但我们至少可以写

$x_seconds = time() + SECONDS_PER_HOUR;

现在很清楚，无需评论。

就此而言，我们如何知道您没有进行字符串连接，即附加后缀“am”或“pm”。你可能会说“好吧，没有一个头脑正常的人会称之为 HOUR”，但我不太确定。

为此，有些人提倡使用匈牙利符号。我不喜欢用底层类型（int、handle 等）装饰名称的匈牙利语形式，但我喜欢用语义类型（秒）装饰。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-03-05T13:49:00.253

这有点取决于语言，但我会创建一个类型。这样，您将能够阅读代码的意图，并让类型检查系统在编译时和/或运行时验证其中的一些意图。

常量隐藏在相关命名的方法中，并且不会重复（如果您愿意，可以对类型/常量进行单元测试）。

当然，在某些情况下，这种方法可能存在一些优化/性能问题。但根据我的经验，它们很少有关系。

例如，为了说明，例如：

```
class Time
{
   private long time;

   Time(long hours, long minutes, long seconds, long milliseconds) { ... }
   Time(long milliseconds) { ... }

   Time addMilliseconds(long increment)
   {
      return new Time(time + increment));
   }

   Time addSeconds(long increment)
   {
      return addMilliseconds(increment * 1000);
   }

   Time addMinutes(long increment)
   {
      addSeconds(increment * 60);
   }       

   Time addHours(long increment)
   {
      addMinutes(increment * 60);
   }

   [...]

   long getTimeInMilliseconds() { ... };
   long getTimeInSeconds() { ... };
   long getTimeInMinutes() { ... };

   [.. maybe some static factory methods ...]
} 
```

可以这样使用：

```
Time oneHourAhead = new Time(now()).addHours(1);
Time tenMinutesAgo = new Time(now()).addMinutes(-10);
Time oneHourTenMinutesAhead = new Time(now()).addHours(1).addMinutes(10); 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2009-03-04T00:53:45.943

我会说 HOUR、MINUTE 和 DAY 都可以。更细化似乎并没有提供更多的可读性。

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2009-03-05T04:08:12.427

在可用的最高抽象级别上工作。

Ruby ActiveSupport 示例

```
3.months.ago
1.year.from_now 
```

同样的原则也可以应用于其他不太灵活的语言，Java 将允许您执行以下操作：

```
TimeHelper.months().ago(3); 
```

如果您的语言中没有对象，您可以这样做：

```
$x = strtotime('now + 1 hour');
$y = strtotime('now + 1 day');
$z = strtotime('now + 1 week'); 
```

误解的空间要小得多。如果不需要，为什么要摆弄问题域以下的东西？

# vba - 从多个 Excel 文档中导出 VBA 代码以放入版本控制中

> ID：608872
> 
> 赞同：18
> 
> 时间：2009-03-04T01:00:35.257
> 
> 标签：vba, excel, version-control

有谁知道从许多 Excel 文档中导出 VBA 代码的方法，以便可以将代码添加到 subversion 存储库中？无需手动打开每个文档并导出代码。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-04T01:13:42.353

你会在这里找到一个工具：

[http://www.pretentiousname.com/excel_extractvba/index.html](http://www.pretentiousname.com/excel_extractvba/index.html)

这是一个自动化excel的VBS脚本。您可以根据需要对其进行修改 - 请注意它并不完美（请阅读网页以获取警告）。

```
option explicit

Const vbext_ct_ClassModule = 2
Const vbext_ct_Document = 100
Const vbext_ct_MSForm = 3
Const vbext_ct_StdModule = 1

Main

Sub Main
    Dim xl
    Dim fs
    Dim WBook
    Dim VBComp
    Dim Sfx
    Dim ExportFolder

    If Wscript.Arguments.Count <> 1 Then
        MsgBox "As the only argument, give the FULL path to an XLS file to extract all the VBA from it."
    Else

        Set xl = CreateObject("Excel.Application")
        Set fs = CreateObject("Scripting.FileSystemObject")

        xl.Visible = true

        Set WBook = xl.Workbooks.Open(Trim(wScript.Arguments(0)))

        ExportFolder = WBook.Path & "\" & fs.GetBaseName(WBook.Name)

        fs.CreateFolder(ExportFolder)

        For Each VBComp In WBook.VBProject.VBComponents
            Select Case VBComp.Type
                Case vbext_ct_ClassModule, vbext_ct_Document
                    Sfx = ".cls"
                Case vbext_ct_MSForm
                    Sfx = ".frm"
                Case vbext_ct_StdModule
                    Sfx = ".bas"
                Case Else
                    Sfx = ""
            End Select
            If Sfx <> "" Then
                On Error Resume Next
                Err.Clear
                VBComp.Export ExportFolder & "\" & VBComp.Name & Sfx
                If Err.Number <> 0 Then
                    MsgBox "Failed to export " & ExportFolder & "\" & VBComp.Name & Sfx
                End If
                On Error Goto 0
            End If
        Next

        xl.Quit
    End If
End Sub 
```

-亚当

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-09-21T11:01:47.967

在过去的几年里，我已经成功地使用它来导出我的代码并保存它。我可以确认它适用于 Office 2003、2007。我认为它也适用于 2000 年。

[http://www.codeproject.com/KB/office/SourceTools.aspx](http://www.codeproject.com/KB/office/SourceTools.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T07:21:21.767

当我进行大量 Excel VBA 开发时，我养成了每次进行更改（从上下文菜单）时将每个文件（模块等）导出为文本格式的习惯。我将这些文件与 XLA 二进制文件一起保存在源代码控制中。这对我来说效果很好，不需要任何外部工具。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-10T07:52:32.793

SourceTools 一旦启动并运行起来就很好，但如果您需要从大量 Excel 工作簿中导出，打开每一个并导出它可能有点乏味。

VbaDiff（免责声明：我的产品）有一个 API，可以读取多个 Excel 文件并提取 VBA 代码。[这里](http://www.technicana.com/index.php?option=com_content&view=article&id=149)有一个例子——它可以很容易地适应将代码导出到一个文件，准备签入。如果你对 SharpSvn 很熟悉，你可以随时将代码添加到存储库中！

# c# - 我必须学习哪些与 XML 相关的技术？（以 C# 为中心）

> ID：608873
> 
> 赞同：1
> 
> 时间：2009-03-04T01:01:58.997
> 
> 标签：c#, xml, xaml, xslt, xsd

在我作为开发人员的工作中，我使用 C# 编写和解析大量 XML。我在 Wikipedia 上阅读的关于 XAML、XSLT 和 XML 模式的内容很少，我不知道它们是否会使我的 XML 驱动编码更容易。我应该学习这些技术吗？他们中的哪一个？任何其他？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T01:13:12.793

他们都是不同的。

*   *XAML 是存储在*xml中的数据示例（与 xhtml 等相同），用于 WCF/WPF/Silverlight 等
*   XSLT 是一种声明式转换语言
*   XML 模式 (XSD)*定义*有效的 xml

每个都有不同的用例，并且都适用于不同的场景。XSD 值得了解，例如，它允许您创作有效的 xml 文档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T01:13:46.270

它们都很有用，这取决于您使用的应用程序，但对我来说，[XML Schema](http://en.wikipedia.org/wiki/Xml_schema)至关重要。与 DTD 相比，它允许您定义 XML 文档应该是什么样子的结构。您可以对元素和属性可以具有的值定义更详细的限制，并且可以轻松地根据 Schema 验证 XML 文档。Schema 的另一个关键是它拥有的所有语言绑定。您可以分别使用 JAXB 或 CodeSynthesis 将您的 Schema 编译成 Java 或 C++。这使您不必自己处理任何 XML 标记，只需处理数据结构。

# iphone - 在 iphone 上查找 OpenGL 应用程序的瓶颈

> ID：608881
> 
> 赞同：4
> 
> 时间：2009-03-04T01:05:11.047
> 
> 标签：iphone, performance

我正在尝试找出我正在编写的 iPhone OpenGL 游戏的瓶颈。游戏本身是 2d 的，包含几百个纹理精灵，每个 alpha 混合。

在纹理方面，我只使用绑定一次的单个 512x512 图集，所以我不认为这是带宽问题（至少不是来自纹理的上传）。

我使用工具来跟踪 CPU 使用情况、内存使用情况和 OpenGL ES 使用情况。在游戏的重要时刻，我看到了以下内容：

FPS：20 CPU：60% Real Mem：17Mb Tiler 利用率：21% 渲染利用率：45%

我有点困惑，可能是什么瓶颈？在成为瓶颈之前，CPU 使用率可以达到多高（我知道有其他应用程序同时运行）？60%听起来对吗？

或者可能是图形的数量？我猜瓷砖器 + 渲染器的利用率不会那么低。但我必须承认我不是阅读这些结果的专家。

任何关于我可能的瓶颈是什么，或者在哪里寻找的任何指示都将不胜感激！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T01:14:43.100

CPU听起来有点高，你是不是用了很多三角函数比如sin/cos？有时这些使用不当，即用于粒子系统。尝试将它们保持在最低限度，或者如果可能，请使用查找表。

[这](http://www.devmaster.net/forums/showpost.php?p=32370&postcount=1)是一个关于近似值的很好的讨论

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T01:56:50.800

如果您还没有，请阅读[Optimizing OpenGL ES for iPhone OS](http://developer.apple.com/iphone/library/technotes/tn2008/tn2230.html)，它有很多关于如何在 iPhone 上编写快速 OpenGL 应用程序的有用花絮。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T01:24:25.230

您是否检查过哪些代码行大部分时间都在运行？我很确定 Instruments 中有一个工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T01:51:16.040

虽然您的“渲染”利用率很低，但我假设这是 OpenGL 调用的 CPU 端。你可以认为这部分是为 GPU 在 glFlush/glFinish 时要执行的操作建立一个列表。一旦您调用其中之一，GPU 实际上必须执行您设置的操作。

虽然我没有在 iPhone 上工作过，但听起来你受 GPU 限制。所以这里是我要检查的事情列表（没有直接在 iPhone 上工作），按照他们需要多长时间进行调查：

1.  你打电话给glFinish吗？如果是这样，请尝试在 GPU 执行其操作时使用 glFlush - glFinish 块。

2.  如果你禁用 alpha 混合，你会看到明显的加速吗？我认为这个可能性不大，但应该很快检查。

3.  您是在对对象进行任何类型的剔除，还是在每帧渲染所有对象？

iPhone 有任何类型的 GPU 分析器吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-23T17:58:00.877

你是如何实现你的 2D 游戏的？每个单独的精灵都渲染到自己的三角形配对多边形上吗？还是将每个精灵渲染到 512x512 纹理表面上？

对于后一种方法，更改每一帧的纹理会导致很大的性能损失，因此文档中不建议这样做；这真的有点痛苦，glDrawTex 可能会提供一种解决方法，但我还没有测试过这个，我不相信它会起作用。

# objective-c - 如何计算 Objective-C/Cocoa 中字符串的边界矩形？

> ID：608895
> 
> 赞同：8
> 
> 时间：2009-03-04T01:11:56.257
> 
> 标签：objective-c, cocoa

使用 Objective-C/Cocoa 如何计算基于特定字体绘制字符串所需的宽度和高度？在 C#/.Net 中，您可以这样做：

```
SizeF textSize = graphics.MeasureString(someString, someFont); 
```

Objective-C/Cocoa 中有类似的东西吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-04T18:53:16.050

这是一个基于 danielpunkass 和 Peter Hosey 给出的答案的具体示例：

```
NSDictionary *attributes = [NSDictionary dictionaryWithObjectsAndKeys:[NSFont fontWithName:@"Helvetica" size:12], NSFontAttributeName, nil];
NSAttributedString *text = [[NSAttributedString alloc] initWithString:@"Hello" attributes: attributes];
NSSize textSize = [text size]; 
```

对于像我这样刚接触 Objective-C/Cocoa 的人来说，一个例子真的有很长的路要走。如果您来自 C++/Java/C# 或任何可能看起来非常陌生的 Objective-C 语法，并且由于 Apple 在其 Cocoa 文档中没有嵌入太多示例代码（如果有的话），学习这些东西有点困难。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-04T04:23:49.603

以下代码类似于我用于跨平台文本 CALayer 的代码：

```
#if defined(TARGET_IPHONE_SIMULATOR) || defined(TARGET_OS_IPHONE)
    UIFont *theFont = [UIFont fontWithName:fontName size:fontSize];
    CGSize textSize = [text sizeWithFont:theFont];
#else
    NSFont *theFont = [NSFont fontWithName:fontName size:fontSize];
    CGSize textSize = NSSizeToCGSize([text sizeWithAttributes:[NSDictionary dictionaryWithObject:theFont forKey: NSFontAttributeName]]);
#endif 
```

这为您提供了一个名为 text 的 NSString 的 CGSize，字体名称为 fontName，大小为 fontSize。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-04T01:49:38.773

一种方法是[`sizeWithAttributes:`](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSString_AppKitAdditions/Reference/Reference.html#//apple_ref/occ/instm/NSString/sizeWithAttributes:)，正如 danielpunkass 所说。另一种方法是创建一个 NSAttributedString 并询问它的[`size`](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSAttributedString_AppKitAdditions/Reference/Reference.html#//apple_ref/occ/instm/NSAttributedString/size). 唯一的区别是，一种方法为您提供了一个包含文本和属性的对象（属性字符串），而另一种方法将它们分开。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-04T01:18:58.550

您使用`NSString`'[`sizeWithAttributes:`](https://developer.apple.com/library/mac/documentation/Cocoa/Reference/ApplicationKit/Classes/NSString_AppKitAdditions/Reference/Reference.html#//apple_ref/occ/instm/NSString/sizeWithAttributes:)方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-21T11:23:08.243

如果您使用演示者，例如`UILabel`/ `NSLabel`（而不是要求字符串自行绘制）。然后你应该问这个对象正确的大小。

有关详细分析，请参阅[Mike Weller 关于标签的博客。](http://doing-it-wrong.mikeweller.com/2012/07/youre-doing-it-wrong-2-sizing-labels.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-14T11:51:05.280

哦，在iOS6下你可以通过这种方式获得正确的Size：

```
CGSize textSize = [theString sizeWithFont:theFont
                             forWidth:160.0f
                        lineBreakMode:NSLineBreakByWordWrapping]; 
```

# gwt - GWT 框架

> ID：608898
> 
> 赞同：1
> 
> 时间：2009-03-04T01:13:30.670
> 
> 标签：gwt, frameworks

随着我越来越多地使用 GWT 框架，我需要为一些基本的 GUI 任务创建自定义代码，例如屏幕转换、代码组织和小部件之间的数据传输。一些 GUI 框架，如 Swing 的 JSR-292，解决了特定平台的这些问题。是否存在任何类似的 GWT 框架？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-08T03:20:08.290

[您可以在http://code.google.com/events/io/sessions/GoogleWebToolkitBestPractices.html](http://code.google.com/events/io/sessions/GoogleWebToolkitBestPractices.html)上找到关于 GWT 应用程序架构最佳实践的非常好的演示文稿

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-19T16:59:38.077

GWT Portlets 框架旨在解决您提到的问题：

[http://code.google.com/p/gwtportlets/](http://code.google.com/p/gwtportlets/)

它定义了一个非常简单但功能强大的编程模型，定义了 XML 文件中“页面”的布局，具有用于组件之间通信的事件广播机制等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T02:18:18.597

JSR 292：在 JavaTM 平台上支持动态类型语言？你在那个问题上失去了我。

您的问题是关于如何在小部件之间进行通信或构建框架和组织代码？如果您谈论组织代码，那么您不需要框架，您可以将其组织成逻辑区域，就像在任何 Swing 应用程序中一样。

就小部件间的通信而言，这些小部件是同一页面上的不同 GWT 项目，还是一个 GWT 项目的所有部分？如果它们是一个项目，那么总是有 Observer/Observable。它在 Swing 中运行良好，在 GWT 中也一样。如果它们是同一页面上的不同 GWT 项目（模块），那么您可以很容易地使用 JSNI 将它们连接起来。您仍然可以使用观察者/可观察事物，或者让它们直接相互调用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-16T11:33:00.793

我认为他的意思是 jsr296，也就是 java swing 框架，它是为 java 7 编写的，然后被删除了。

# c++ - 奇怪的 Ogre 错误和不存在的文件

> ID：608903
> 
> 赞同：0
> 
> 时间：2009-03-04T01:14:33.163
> 
> 标签：c++, windows, visual-studio-2008, ogre3d

我收到此错误，我不知道在哪里：

> OGRE EXCEPTION(2:InvalidParametersException)：标头块与任一端都不匹配：流损坏？在 Serializer::determineEdianness 在 f:\codingextra\ogre\shoggoth_vc9\ogre\ogremain\src\ogreserializer.cpp （第 90 行）

我正在使用 Visual Studio 2008。我试图 gvim 提到的 f: 驱动器上的文件，但显然它不存在？我也试图 cd 到目录，它说它不存在。有什么见解吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T01:30:18.553

您正在使用 Ogre 的预编译版本。如果你想调试它，你可能想下载 Ogre 源代码并安装它们。不过，很明显，Serializer 类正在读取您提供给它的一些数据，这些数据期望采用某种格式。具体来说，它在标头中寻找标记数据是小端还是大端的标志。（最低或最高有效字节优先。）

您也可以尝试在代码调用 Ogre 的任何地方捕获异常，这将帮助您缩小问题代码的范围。

# wpf - WPF/Silverlight 中的标记扩展

> ID：608906
> 
> 赞同：7
> 
> 时间：2009-03-04T01:16:53.983
> 
> 标签：wpf, silverlight, markup-extensions

有没有人在 WPF 或 Silverlight 中创建过自定义标记扩展？您什么时候想要或需要这样做？关于如何做到这一点的任何提示或来源？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-04T08:58:50.490

一个例子是[本地化](http://www.wpftutorial.net/LocalizeMarkupExtension.html)：

> 本地化应用程序资源的一种简单而有效的方法是编写一个*提供本地化值*的自定义 MarkupExtension 。该扩展采用一个唯一资源键的参数... [然后] 从通用资源提供程序中查找值。

注意：您不能在 silverlight 中编写自定义标记扩展。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T01:37:56.587

是的，它很方便，我自己创建了一个。我创建了一个名为*EvalBinding*的标记扩展，它将一组绑定作为子项和一个 C# 评估字符串。它评估 C# 以处理来自子绑定的值，因此我不需要创建许多简单的*TypeConverter*类。

例如我可以这样做......

```
<EvalBinding Eval="(this[0] > this[1] ? 'GT' : 'LTE')">
    <Binding ElementName="element1" Path="Size"/>
    <Binding ElementName="element2" Path="Size"/>
<EvalBinding> 
```

*这*是对子绑定结果数组的引用。

有关实现 MarkupExtension 的资源...

[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.markup.markupextension.aspx)

[乔什·史密斯博客条目](http://joshsmithonwpf.wordpress.com/2007/05/25/a-review-of-markup-extensions/)

[Rob Relyea 博客条目](http://www.windows-now.com/blogs/rrelyea/archive/2006/02/03/MarkupExtensionAsAnObjectElement.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-10T21:57:53.280

Hooray!!

This is implemented in Silverlight 5!!

And furthermore, now it's a generic interface instead of a class!!

[Check it out](http://msdn.microsoft.com/en-us/library/gg712747%28VS.96%29.aspx "IMarkupExtension(T) Interface").

Read [this](http://blogs.msdn.com/b/eternalcoding/archive/2011/04/28/markup-extensions-in-silverlight-5.aspx "Markup extensions in Silverlight 5") for an example.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-18T10:11:04.397

我使用标记扩展来标准化我的验证绑定。所以这里的好处很小，我不必再设置 4 个默认值，如果我以后想更改它们，我只在此处进行。

```
using System;
using System.Windows.Data;
using System.Windows.Markup;

namespace ITIS 
{
    /// <summary>
    /// Creates a normal Binding but defaults NotifyOnValidationError to True,
    /// ValidatesOnExceptions to True, Mode to TwoWay and 
    /// UpdateSourceTrigger to LostFocus.
    /// </summary>
    public sealed class ValidatedBinding : MarkupExtension
    {
        public ValidatedBinding(string path)
        {
            Mode = BindingMode.TwoWay;

            UpdateSourceTrigger = UpdateSourceTrigger.LostFocus;

            Path = path;
        }

        public override object ProvideValue(IServiceProvider serviceProvider)
        {
            return new Binding(Path) {
                Converter = this.Converter,
                ConverterParameter = this.ConverterParameter,
                ElementName = this.ElementName,
                FallbackValue = this.FallbackValue,
                Mode = this.Mode,
                NotifyOnValidationError = true,
                StringFormat = this.StringFormat,
                ValidatesOnExceptions = true,
                UpdateSourceTrigger = this.UpdateSourceTrigger
            };
        }

        public IValueConverter Converter { get; set; }

        public object ConverterParameter { get; set; }

        public string ElementName { get; set; }

        public object FallbackValue { get; set; }

        public BindingMode Mode { get; set; }

        public string Path { get; set; }

        public string StringFormat { get; set; }

        public UpdateSourceTrigger UpdateSourceTrigger { get; set; }
    }
} 
```

# java - 需要帮助确定扑克手（一对）

> ID：608915
> 
> 赞同：1
> 
> 时间：2009-03-04T01:21:14.113
> 
> 标签：java, poker

这只是代码的一部分，所以如果您看不到数组或其他任何东西，请不要介意。这个想法是我有 5 张牌，我想确定哪些是对子。有人明白我的意思吗？

```
boolean IsOnePair=true;

int [] cont = new int [6];

for (int i=0;i<Game.length;i++)
{
    cont[Game[i].getValue()] ++;
}

for (int i=0;i<cont.length;i++)
{
    if (cont[Game[i].getValue()]==2)
    {
        IsOnePair=false;
        System.out.println(Game+" : "+cont[i]+" times");
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T01:30:32.063

一方面，你的数组可能应该只有 5 个元素，如果你希望它成为真正的扑克手，则不是 6 个元素。

至于确定是否有对子，我只需将每张牌与右边的每张牌核对一下。这将以 O(n^2) 运行，但只要手的大小保持在 5 左右，这是可以接受的。

这里有一些代码可以做到这一点：

```
for(i=0; i<5; i++)
{
  for(j=i+1; j<5; j++)
  {
    if(hand[i] == hand[j])
      return true;
  }
 } 
```

此外，您的代码不起作用的原因是因为您试图访问等于卡值的索引，而不是卡的编号。您也许可以使用字典来执行此操作，但上面的代码编程要简单得多，而且对于如此小的问题规模，它是可以接受的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T03:55:11.513

如果您需要快速，您可能需要考虑重新评估您的方法。或者，考虑使用现有的扑克手检测库，或者至少研究其中至少一个的源以获得一些“灵感”。Cactus Kev 对他相当好的[5 张牌手检测算法](http://www.suffecool.net/poker/evaluator.html)有很好的描述：

您可能还想阅读[http://www.codingthewheel.com/archives/how-i-built-a-working-online-poker-bot-8](http://www.codingthewheel.com/archives/how-i-built-a-working-online-poker-bot-8)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T04:05:29.227

你是如何处理甲板上的西装的？如果您将卡片表示为简单的整数，那么我假设卡片的有效值为 0 - 51。如果是这种情况，那么我猜卡片 0 - 12 都是一个花色，13 - 25 是另一个花色，依此类推. 花色的分配可以是任意的，直到你需要考虑到它的得分手。

通过这种安排，您可以像[samoz](https://stackoverflow.com/questions/608915/need-help-determining-poker-hand-one-pair/608929#608929)所写的那样检测一对，并修改您的比较操作。您需要确保这些卡与模 13 一致。只需更改行

```
if(hand[i] == hand[j]) 
```

至

```
if( (hand[i] % 13) == (hand[j] % 13) ) 
```

模运算符 (%) 返回除法后的余数，因此

```
 0 % 13 = 0
 1 % 13 = 1
 2 % 13 = 2
    ...
12 % 13 = 12
13 % 13 = 0
14 % 14 = 1 
```

等等...它允许您判断一个序列何时环绕某个值，即模数，在本例中为 13，因为四套花色中的每一套都有 13 张不同的牌。

假设，例如，在你的 52 张牌中，编号为 0 - 51，牌 0 - 12 代表从 A 到梅花 K，牌 13 - 25 代表红心，26 - 38 代表黑桃，39 - 51 代表钻石。

现在你拿到了这手牌：0, 12, 32, 21, 47

通过取每张卡的余数模数 13，您剩下 0、12、6、8、8

您可以看到最后两张牌是一对，红桃 9 和方块 9（请记住编号从 0 开始，因此减一）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T01:43:24.093

我假设您正在寻找与三种或四种不同的一对。在这种情况下，您最好的选择是遍历每张牌，并存储有多少 A、多少 2、多少 3，等等。该解决方案将为您提供对数，以及是否有三/四类或满堂。在寻找同花或顺子时，您当然必须进行不同的检查。

```
Card[] hand = new Card[numberOfCards];
int[] frequencies = new int[13]; // there are 13 card values
...
for (int i = 0; i < hand.Count; i++)
{
    frequencies[hand[i].CardNumber] += 1; // assume Ace = 0, King = 12
}
// Now look through the frequencies:
int numberOfPairs = 0;
bool hasTriple = false;
bool hasFour = false;
for (int f = 0; j < frequencies.Count; j++)
{
    switch (frequencies[f])
    {
         case 2:
             numberOfPairs++;
             break;
         case 3:
             hasTriple = true;
             break;
         case 4:
             hasFour = true;
             break;
         default:
             break;
    }
}
// Now you know how many pairs you have, and whether you have a triple or four-of-a-kind
if (numberOfPairs == 1 && hasTriple)
{
    // It's a full house
} 
```

**编辑：** 修改它以记录构成对的数字（一对 A 或 Q 等）也是微不足道的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T05:55:01.007

非常规，但简洁：

```
import fj.P;
import fj.data.Stream;
import static fj.P2.untuple;
import static fj.pre.Equal.intEqual;

public Stream<Integer> pairs(Stream<Integer> hand) {
  return hand.apply(hand.map(P.<Integer, Integer>p2()))
             .filter(untuple(intEqual.eq()))
             .map(P1.<Integer>__1());
} 
```

[在此处获取导入的库](http://functionaljava.org/download)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T04:07:18.223

如果你对手进行排序，然后从左到右阅读，计算手的力量应该相对容易。

如果你的目标是简单，你可以尝试这样的事情（伪代码）：

```
def handStrength(hand):
    sort(hand) //sorts hand in ascending order
    if hasPair(hand):
        if isTwoPair(hand):
            return "two pair"
        else if isTrips(hand):
            return "three of a kind"
        else if isBoat(hand):
            return "full house"
        else if isQuads(hand):
            return "four of a kind"
        else:
            return "pair"
    else:
        straightFlag = isStraight(hand)
        flushFlag = isFlush(hand)
        if straightFlag:
            if flushFlag:
                return "straight flush"
            else:
                return "straight"
        else if flushFlag:
            return "flush"
        else:
            return "high card"

def hasPair(hand): //requires sorted hand
    for i = 1 to 4:
        if hand[i].rank == hand[i-1].rank:
            return True
    return False

def isTwoPair(hand): //requires sorted hand
    return (hand[0].rank == hand[1].rank and hand[2].rank == hand[3].rank and hand[0].rank != hand[2].rank) or
           (hand[1].rank == hand[2].rank and hand[3].rank == hand[4].rank and hand[1].rank != hand[3].rank)

def isTrips(hand): //requires sorted hand
    return (hand[0].rank == hand[2].rank and hand[0].rank != hand[3].rank and hand[3].rank != hand[4].rank) or
           (hand[1].rank == hand[3].rank and hand[0].rank != hand[1].rank and hand[0].rank != hand[4]) or
           (hand[2].rank == hand[4].rank and hand[1].rank != hand[2].rank and hand[1].rank != hand[0].rank)

def isBoat(hand): //requires sorted hand
    return (hand[0].rank == hand[1].rank and hand[2].rank == hand[3].rank == hand[4].rank) or
           (hand[0].rank == hand[1].rank == hand[2].rank and hand[3].rank == hand[4].rank)

def isQuads(hand): //requires sorted hand
    return hand[1].rank == hand[2].rank == hand[3].rank and (hand[0].rank == hand[1].rank or hand[4].rank == hand[1].rank)

def isStraight(hand): //requires sorted hand with no pair
    return (hand[0].rank == hand[4].rank - 4) or (isAce(hand[0]) and hand[4].rank == 5)

def isFlush(hand):
    return hand[0].suit == hand[1].suit == hand[2].suit == hand[3].suit == hand[4].suit 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T04:34:09.690

检查一对并返回一个布尔值几乎没有用。您需要检查从最高到最低的手牌（同花顺、4 种、满屋、同花、顺子等），并创建一种方法来排列您的手牌，以便确定获胜者。在我看来，这不是微不足道的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-13T09:40:20.180

Complete source code for Texas hold'em poker game evaluator can be found here:

[http://www.advancedmcode.org/poker-predictor.html](http://www.advancedmcode.org/poker-predictor.html)

It is built for matlab, the GUI id m-coded but the computational engine is c++.

It allows for odds and probability calculation. It can deal, on my 2.4Ghz laptop, with a 100000 10 players game computation in 0,3 seconds.

An accurate real time computer:-)

# c - 忽略 ctrl-c

> ID：608916
> 
> 赞同：3
> 
> 时间：2009-03-04T01:21:30.930
> 
> 标签：c, signals, copy-paste, sigint

我正在尝试编写一个 shell，而我正处于我想忽略的地步`Ctrl``C`。

我目前有我的程序忽略 SIGINT 并在信号到来时打印一个新行，但我怎样才能防止`^C`被打印？

按下 时`Ctrl``C`，我得到的是：

```
myshell>^C
myshell>^C
myshell>^C 
```

但我想要：

```
myshell>
myshell>
myshell> 
```

这是我的相关代码`Ctrl``C`：

```
extern "C" void disp( int sig )
{
    printf("\n");
}

main()
{
    sigset( SIGINT, disp );
    while(1)
    {
        Command::_currentCommand.prompt();
        yyparse();
    }
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-04T01:39:35.380

确实是终端回应了那件事。你必须告诉它停止这样做。我的手册页`stty`说

```
* [-]ctlecho
       echo control characters in hat notation (`^c') 
```

跑步`strace stty ctlecho`节目

```
ioctl(0, SNDCTL_TMR_TIMEBASE or TCGETS, {B38400 opost isig icanon echo ...}) = 0
ioctl(0, SNDCTL_TMR_STOP or TCSETSW, {B38400 opost isig icanon echo ...}) = 0
ioctl(0, SNDCTL_TMR_TIMEBASE or TCGETS, {B38400 opost isig icanon echo ...}) = 0 
```

因此，使用正确的参数运行 ioctl 可以关闭该控制回声。寻找`man termios`一个方便的接口。使用它们很容易

```
#include <termios.h>
#include <unistd.h>
#include <stdio.h>

void setup_term(void) {
    struct termios t;
    tcgetattr(0, &t);
    t.c_lflag &= ~ECHOCTL;
    tcsetattr(0, TCSANOW, &t);
}

int main() {
    setup_term();
    getchar();
} 
```

或者，您可以考虑使用`GNU readline`来读取一行输入。据我所知，它可以选择阻止终端执行此类操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T01:33:35.253

尝试打印退格字符，又名 \b ？

# artificial-intelligence - RDBMS中模糊集的去模糊化过程

> ID：608917
> 
> 赞同：1
> 
> 时间：2009-03-04T01:21:33.943
> 
> 标签：artificial-intelligence, rdbms, paradox, fuzzy-logic

我有一个存储所有值的表......例如 x1、x2、x3 确定模糊集。使用低、中、高的数学函数为每个成员分配隶属度。

我的规则 1 指出，如果 x1 高且 x2 中等，则输出概率为 z。然后我用 min{x1,x2} 来评估规则。规则 2 规定如果 x2 为高或 x3 为中，则输出为 max{x2,x3}。

现在为了去模糊化，我对规则结果进行聚合以找出 2 个规则的输出。我为每个规则定义了 x1 x2 x3 的所有成员级别（0 到 1）。

如何去模糊化？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T02:42:21.923

好的，首先，您使用的是概率逻辑还是模糊逻辑。虽然相似，但它们并不相同。如果您真的在这里建模概率，那么您需要通过贝叶斯定理将其视为条件概率。

如果这些真的是*模糊*的真值，那么你需要有一个我们需要知道的集合成员模型。

# c# - 匹配 html 中的正则表达式，忽略空格和引号

> ID：608919
> 
> 赞同：1
> 
> 时间：2009-03-04T01:23:48.913
> 
> 标签：c#, regex

我需要从一组 HTML 文件中找到某个块并将其全部删除。这些文件实际上是被 HTML 破解的，所以我不想像以前那样用 HtmlAgility 包解析它，而是想使用一个简单的正则表达式。

html 部分将始终如下所示：

```
<CENTER>some constant text <img src=image.jpg> more constant text: 
 variable section of text</CENTER> 
```

以上都可以是大小写任意组合，注意是img src=image.jpg 而不是img src="image.jpg"... 中间可以有任意数量的空白字符常量字符。

这里有些例子：

```
 <CENTER>This page has been visited 
<IMG SRC=http://place.com/image.gif ALT="alt text">times since 10th July 2007
</CENTER> 
```

或者

```
 <center>This page has been visited 
<IMG src="http://place.com/image.gif" Alt="Alt Text"> 
times since 1st October 2005</center> 
```

你认为匹配这种模式的好方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T01:32:41.217

需要多少文本才能唯一标识目标？我会先试试这个：

```
@"(?is)<center>\s*This\s+page\s+has\s+been\s+visited.*?</center>" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T02:04:44.087

这实际上取决于您制作正则表达式并匹配所需元素的简单程度。

```
<center>[^<]+<img[^>]+>[^>]+</center> 
```

也使用不区分大小写的标志（我不知道 C# 使用什么）。如果您需要更发达的东西，因为您会遇到 img 标签位于中心标签内且不匹配的情况，那么您可以像其他答案一样开始硬编码短语。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T02:43:45.977

在 C# 中，您可以简单地使用它，假设它`originalHTML`包含您的整个 HTML 文件。

```
string result = null;
result = Regex.Replace(originalHtml,
                       @"(\s*<center>[^<]*<img src=[^""].*?>.*?</center>\s*)", 
                       "", 
                       RegexOptions.Singleline | RegexOptions.IgnoreCase); 
```

正则表达式将删除原始 HTML 中任何出现的模式并返回修改后的版本。

# java - Hibernate：有没有办法以编程方式创建类似于现有表的新表？

> ID：608923
> 
> 赞同：3
> 
> 时间：2009-03-04T01:26:09.530
> 
> 标签：java, database, hibernate, database-permissions, datahistory

我有一个有很多表的网络应用程序（每个表代表一个 POJO）。我为每个类编写了映射文件，然后使用 Hibernate`SchemaExport`在我的数据库中生成表。现在我想为每个已创建的现有表创建 2 个附加表：

*   **用户权限表**- 存储用户对 POJO 的权限，特定于每个字段
    ，每一列代表 POJO 中的一个字段，每一行代表一个用户，每个单元格将有一个值“读取”、“写入”等，代表用户对 POJO 的权限场地

*   **数据历史表**- 使用版本号存储所有数据历史记录，
    该表将包含 POJO 表具有的所有列，并带有 4 个附加字段：数据对象版本、事务 GUID（主键）、数据戳和执行此事务的用户。

我希望能够在创建这些表后通过 Hibernate 访问它们。这样我就可以轻松地在其中添加/删除/更新条目。

* * *

# 我的问题

附加表上的大多数列将与 POJO 表相同。所以我认为以*某种方式*引用 POJO 表而不是创建全新的表可能会更好。这样，如果 POJO 表中添加了新字段，这些表将自动进行更改。但我似乎不知道该怎么做。我想也许有一些方法：

*   创建以某种方式引用 POJO 表的休眠映射文件，
    例如在我的新 POJOPermission.hbm.xml 文件中，*以某种方式*指定，使用与 POJO 表相同的字段，并添加这些新字段。
*   编写 Java 代码以在 Hibernate 中创建表，
    例如我可以使用 java.lang.Class 返回 POJO 中所有字段的列表，然后遍历这些字段，*以某种方式*将它们设置为我的新表的列标题，并*以某种方式*调用Hibernate 在运行时创建这些表

有人可以告诉我**如何**执行上述任一操作，或者解决此问题吗？我有一种感觉，我可能以错误的方式思考这个问题......

谢谢！！！

# [编辑 - 解决方案]

我最终使用 XSLT 将原始 hbm.xml 文件转换为新文件，更改字段类型等。并指定 hibernate.cfg.xml 文件以包含新生成的文件。最后只需运行 schemaexport 即可生成所有 java 文件...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T04:58:27.243

CREATE TABLE 语法是特定于实现的。DB2 有 CREATE TABLE LIKE ，但是您需要解析目录表以检索键，外国和国内，然后生成 ALTER TABLE... 来实现相同的。其他数据库可能也有类似的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T05:18:57.240

使用“select into”可以创建基本表结构的副本。它只复制列和数据类型，而不是约束或索引。如果您只想要没有数据的结构，只需指定一个不返回任何记录的 where 子句。

```
select * into targettable from sourcetable where 1=0 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T14:16:57.633

如果您想通过 Hibernate 访问用户权限和数据历史记录，那么我认为您需要通过考虑如何将这些表示为 POJO 来解决问题。然后，您可以生成映射以将它们存储在数据库中。

# c# - 覆盖 Equals() 但不检查所有字段 - 会发生什么？

> ID：608924
> 
> 赞同：6
> 
> 时间：2009-03-04T01:27:08.407
> 
> 标签：c#, .net

如果我覆盖 Equals 和 GetHashCode，我如何决定要比较哪些字段？如果我有两个对象，每个对象有两个字段，但 Equals 只检查一个字段，会发生什么？

换句话说，假设我有这个类：

```
class EqualsTestClass
{
    public string MyDescription { get; set; }
    public int MyId { get; set; }

    public override bool Equals(object obj)
    {
        EqualsTestClass eq = obj as EqualsTestClass;
        if(eq == null) {
            return false;
        } else {
            return MyId.Equals(eq.MyId);
        }
    }

    public override int GetHashCode()
    {
        int hashcode = 23;
        return (hashcode * 17) + MyId.GetHashCode();
    }
} 
```

如果两个对象具有相同的 MyId，我认为它们相等。因此，如果 Id 相等但描述不同，它们仍然被认为是相等的。

我只是想知道这种方法的陷阱是什么？当然，像这样的构造将按预期运行：

```
 List<EqualsTestClass> test = new List<EqualsTestClass>();

        EqualsTestClass eq1 = new EqualsTestClass();
        eq1.MyId = 1;
        eq1.MyDescription = "Des1";

        EqualsTestClass eq2 = new EqualsTestClass();
        eq2.MyId = 1;
        eq2.MyDescription = "Des2";

        test.Add(eq1);
        if (!test.Contains(eq2))
        {
            // Will not be executed, as test.Contains is true
            test.Add(eq2);
        } 
```

由于 eq2 与 eq1 值相等，因此不会添加。但那是我控制的代码，但我想知道框架中是否存在可能导致意外问题的代码？

那么，我是否应该总是在我的 Equals() 比较中添加所有公共字段，或者有哪些指导方针可以避免由于一些完全出乎意料的糟糕 Framework-Mojo 而导致令人讨厌的意外？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-04T01:30:12.003

覆盖的原因`Equals()`是您定义了两个实例相等的含义。在某些情况下，这意味着所有字段必须相等，但并非必须如此。你决定。

有关更多信息，请参阅[文档](http://msdn.microsoft.com/en-us/library/336aedhh.aspx)和这篇[文章](http://blogs.msdn.com/jaredpar/archive/2009/01/15/if-you-implement-iequatable-t-you-still-must-override-object-s-equals-and-gethashcode.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T01:31:10.690

在这种情况下，我认为您无需担心框架。如果您作为类设计者认为该类的两个实例共享相同的 MyId 时它们是相等的，那么您只需要在覆盖的 Equals() 和 GetHashCode() 方法中测试 MyId。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T01:32:19.017

您只需要检查需要匹配的字段，如果需要匹配的只是 ID，那么就使用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T01:33:21.650

> 一个问题：如果我覆盖 Equals 和 GetHashCode，我如何决定比较哪些字段？

这取决于您要完成的工作。如果您想查看对象是否完全相同，您应该比较所有对象。如果您有一些“键”并且您只想知道它们是否是相同的“对象”，即使其他数据不同，也只需检查“键”值。

> 如果我有两个对象，每个对象有两个字段，但 Equals 只检查一个字段，会发生什么？

然后，您将拥有一个相等方法，该方法仅检查“键”是否相同，并且可能有多个具有内部差异的“相等”对象。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T02:23:41.857

其他人说这是完全有效和预期的，这正是 Equals 应该如何运作的。所以作为一个类没有问题。

作为一个API，我会非常小心。如果这不是预期的，请原谅我：在这种情况下，这只是对其他人的警告。

潜在的问题是 API 的用户自然会期望相等的对象“相同”。这不是平等契约的一部分，但它是这个词的常识意义的一部分。该类看起来有点像二进制元组，但不是一个，所以这应该是出于合理的原因。

这种合理原因的一个示例是，一个字段是“可见的实现细节”，例如基于哈希表的容器上的最大负载因子。一个有风险（虽然很诱人）的例子是“因为我后来添加了描述并且不想更改 Equals 方法以防它破坏某些东西”。

因此，做一些违反直觉的事情是完全有效的，特别是如果你清楚地记录了这种行为可能会令人惊讶。必须支持这样的 Equals 方法，因为在字段明显不相关的情况下禁止它们会很疯狂。但是应该清楚为什么创建两个具有相同 ID 和不同描述的 ID-描述对是有意义的，但是将它们都添加到使用 Equals/HashCode 来防止重复的容器（如 HashSet）中是没有意义的条目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T07:14:28.353

您的示例是检查列表（EqualsTestClass）是否包含具有相同属性值的相同类型的对象。在不覆盖 equals（以及对 equals 的传统理解）的情况下完成此任务的另一种方法是使用自定义比较器。它看起来像这样（在 VB 中）：

```
Public Class EqualsTestComparer
Implements IEqualityComparer(Of EqualsTestClass)
Public Function Equals1(ByVal x As EqualsTestClass, ByVal y As EqualsTestClass) As Boolean Implements System.Collections.Generic.IEqualityComparer(Of EqualsTestClass).Equals
    If x.MyId  = y.MyId and x.MyDescription = y.MyDescription  Then
        Return True
    Else
        Return False
    End If
End Function

Public Function GetHashCode1(ByVal obj As EqualsTestClass) As Integer Implements System.Collections.Generic.IEqualityComparer(Of EqualsTestClass).GetHashCode
    Return obj.ToString.ToLower.GetHashCode
End Function    
End Class 
```

然后在您的例程中，您只需使用自定义比较器：

```
If Not test.Contains(eq2, New EqualsTestComparer) Then
    //Do Stuff
End if 
```

# php - 使用命名空间对项目进行分区是不好的做法吗？

> ID：608925
> 
> 赞同：1
> 
> 时间：2009-03-04T01:28:08.637
> 
> 标签：php

我最近了解了 PHP 中的命名空间，并且想知道，这样做会不会是不好的做法？

```
<?php

namespace String; // string helper functions

    function match($string1, $string2)
    {

        $string1 = trim($string1);
        $string2 = trim($string2);

        if (strcasecmp($string1, $string2) == 0) // are equal 
        {
            return true;
        } else {
            return false;
        }
    }

?> 
```

在我将它作为 String 类的静态方法之前，但这对我来说似乎总是*错误*的......哪个是更好的选择？我想对我的辅助函数进行分类，并想知道哪种方法更好。

**编辑** 那么，如果我在命名空间中声明了 match 函数，我该如何访问它呢？如何*停止*命名空间声明，比如说如果我在它下面包含一个声明新命名空间的文件，它会自动停止对第一个命名空间的引用吗？我该如何返回全局命名空间？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T01:35:32.567

我会把它放在一个命名空间中。类是 php 中描述的类型，尽管您可能对具有相似名称的类型进行操作，但严格来说，它不是同一类型。命名空间只是一种对事物进行逻辑分组的方式，这就是您使用类来做的事情。您唯一失去的是可扩展性，但正如您所说，它只是静态方法的集合。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T01:50:44.527

如果它们都是与字符串相关的函数，那么将它们设为静态方法并没有错。

如果您有一堆全局函数和/或变量，您不想弄乱全局范围，但在类中没有意义，那么命名空间将是更好的选择。（我在自己的代码中有一个更适合命名空间的类）。

如果您的代码有可能在其他地方重用，最好将所有内容都放在某种容器中，这样您就不会在其他人的全局变量上乱涂乱画......

至于您在那里的编辑：

*   命名空间与它们在 IIRC 中定义的文件相关联。不确定这会如何影响包含的文件，但我猜它们不是继承的。
*   您可以通过说来调用全局范围`::trim()`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T01:41:37.747

因为命名空间对 php 来说是如此的新事物，所以人们长期以来一直在做您所做的事情——创建一个类，添加静态方法，并像使用命名空间一样使用该类。在我看来，你好像在正确地考虑它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T01:35:25.470

您将使用类对某个数据上的某种功能进行分类。比如说你有一个 Student 类，它将保存学生信息、学生年龄和学生 ID 号；还有一些返回和设置这些数据的方法。

此外，您将使用命名空间对课程进行分类；假设现在您有另一个课程来处理这些学生的大学注册，而其他课程则用于管理课程。就个人而言，我会将所有这些类放在一个名为大学的类别（即命名空间）下。

因此，这甚至不是一个不好的做法，它还为您的代码提供了更多的可读性。如果你在一个团队中工作，这对于其他程序员来说会更容易理解。

所以我个人强烈建议你在你认为合适的地方使用它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T19:06:48.963

Ideally, it would be best to put functions in a namespace. If you depend on autoloading though, which only works for classes, you need to put them in one or more classes.

# php - 构建大型表格，需要建议

> ID：608940
> 
> 赞同：0
> 
> 时间：2009-03-04T01:35:04.160
> 
> 标签：php, javascript

我必须建立一个大表格供用户填写，以便申请我工作的大学的研究生学习。会有大量的信息需要收集（多个地址、个人信息、商业信息、过去的学校信息、经历等……），我想知道处理这一切的最佳方式。我将使用 PHP 和 Javascript。

是否有任何帮助程序或框架可用于帮助构建/验证表单，我可以将其放入现有项目中？

还希望获得任何建议，以跟踪大型表格和生成的数据。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T01:42:12.613

您需要使用多个页面，并且您需要包含一种机制，用户可以离开，稍后再回来填写表单的其余部分（或者如果他们意外断开连接）。否则你会遇到各种各样的用户问题，不是因为你的服务，而是因为他们使用的是不稳定的计算机和互联网连接等。

调查软件可能是您正在做的事情的合理近似，并且大多数 PHP CMS 都有调查包。您是从头开始构建它，还是下面有一个现有的 CMS？

-亚当

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T02:04:26.350

在不了解表单的所有细节的情况下，一些提示：

不要一次向用户显示所有内容 - 这可以通过多个页面来完成，或者通过在用户浏览表单时选择性地显示/隐藏表单上的元素来完成。提供显示“您正在执行第 3 步（共 10 步）”的上下文导航，以便用户了解他们在表单中的位置以及完成它需要付出多少努力。

提供一种保存和稍后返回的机制是一个绝妙的主意。如果可能，请提供指向他们选择的电子邮件帐户的链接 - 您希望使此组件尽可能易于使用，并且要求他们填写额外的用户名/密码来检索他们的数据只是完成的另一个障碍。

只问你绝对需要的东西。是的，你将不得不在这里打一些政治斗争——每个人都想要尽可能多的东西。解决这个问题的一种方法（当你有来自多个团队的压力时特别有效）是构建一些原型：1 包含所有东西，1 减少或删除几个部分。让每个组的利益相关者都填写它们并衡量他们的完成时间或滚动吞吐量产量。当您获得完成数据时，他们会意识到其他每个小组（除了他们的小组）都要求多少，他们更容易合作。**简而言之，尽可能多地删除 - 如果他们愿意，让用户稍后返回以提供更多详细信息。**

在索引卡上写下你所有的输入，看看它们在逻辑上是如何组合在一起的。通常，您会发现更有效的分组或排序。你很有可能会想出更多有用的想法。这在将纸质表格转换为在线表格时**非常重要。**Usability.gov 有一个关于这个主题[的精彩案例研究。](http://www.hhs.gov/usability/lessons/form.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T01:49:31.923

A List Apart 有一篇[关于构建合理表单](http://www.alistapart.com/articles/sensibleforms)的文章，值得一读

为什么表格一开始就需要很大？您不能将其缩减为帐户的基本要素，并为他们提供一种稍后回来充实其余细节的方法吗？

对于表单验证，请看一下 jQuery 验证插件[Validation](http://docs.jquery.com/Plugins/Validation/Methods)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T02:06:52.303

好吧，我同意亚当的观点，但我有一些建议给你。

如果我是你，我会创建一些虚拟隐藏选项卡，而不是带有下一步按钮的多个表单。您可以创建一些可以通过 javascript 控制的内容。首先显示第一个将收集个人信息，如姓名、生日、电子邮件等...。一旦用户填写并单击下一步按钮，将其隐藏并显示另一个将询问其他信息，如地址等。

整个潜水完成后，在最后一个 div 放置一个提交按钮，该按钮将立即将整个信息提交到服务器。

凭什么这样做？

1.  用户不会感到震惊，因为每次都不会看到很长的表格，并且会与患者一起填写。

2.  你一次访问服务器；通常大学和学院的服务器太忙，你最好设计一个访问服务器最少的表单。这可以算作性能提示。

3.  由于您将一次性提交全部数据，因此您不必担心用户是否会继续填写其他页面的问题，因此您将使用更少的会话，这仍然会算作性能提示。

4.  这种方式使您的表单更有趣，您可以称您执行了类似 Ajax 的操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T02:40:39.103

您可以添加 Javascript 表单验证以使其更加用户友好，但您永远不应该忽略的一件事是服务器端验证……这在 PHP 中一直很糟糕。

[过滤器库](http://php.net/filter)可以让您的生活轻松一百万倍，特别是`filter_input_array()`因为您可以以编程方式构建输入验证，而不必复制和粘贴大量检查。这需要一些时间来适应，但它比旧的做事方式要好得多。

# hibernate - 休眠：session.get 和 session.load 之间的区别

> ID：608947
> 
> 赞同：88
> 
> 时间：2009-03-04T01:36:57.867
> 
> 标签：hibernate, proxy, hibernate-session

从 API 中，我可以看到它与代理有关。但是我找不到很多关于代理的信息，也不明白调用`session.get`和之间的区别`session.load`。有人可以解释或指导我到参考页面吗？

谢谢！！

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2009-03-04T01:51:35.180

从[休眠论坛](http://forum.hibernate.org/viewtopic.php?p=2387456)：

> 这来自《休眠在行动》一书中。很好读这个..

* * *

按标识符检索对象 以下 Hibernate 代码片段从数据库中检索用户对象：

```
User user = (User) session.get(User.class, userID); 
```

get() 方法很特殊，因为标识符唯一地标识了一个类的单个实例。因此，应用程序通常使用标识符作为持久对象的方便句柄。按标识符检索可以在检索对象时使用缓存，如果对象已被缓存，则避免数据库命中。Hibernate 还提供了一个 load() 方法：

```
User user = (User) session.load(User.class, userID); 
```

load() 方法较旧；由于用户请求，get() 被添加到 Hibernate 的 API 中。区别是微不足道的：

如果 load() 在缓存或数据库中找不到对象，则会引发异常。load() 方法永远不会返回 null。如果找不到对象，get() 方法将返回 null。

load() 方法可能返回一个代理而不是一个真正的持久实例。代理是第一次访问时触发加载真实对象的占位符；另一方面， get() 从不返回代理。在 get() 和 load() 之间进行选择很容易：如果您确定持久对象存在，并且不存在将被视为异常，那么 load() 是一个不错的选择。如果您不确定是否存在具有给定标识符的持久实例，请使用 get() 并测试返回值以查看它是否为空。使用 load() 有进一步的含义：应用程序可以检索到持久实例的有效引用（代理），而无需访问数据库来检索其持久状态。因此 load() 在缓存或数据库中找不到持久对象时可能不会抛出异常；当访问代理时，稍后将引发异常。当然，通过标识符检索对象不如使用任意查询灵活。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-04T02:01:28.307

好吧，至少在 nhibernate 中， session.Get(id) 将从数据库中加载对象，而 session.Load(id) 仅在不离开服务器的情况下为其创建代理对象。就像您的 POCO（或 POJO :) 中的所有其他延迟加载属性一样工作。然后，您可以使用此代理作为对对象本身的引用来创建关系等。

把它想象成有一个只保留 Id 的对象，如果你需要它会加载其余的。如果您只是传递它来创建关系（如 FK），那么 id 就是您所需要的。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-06-21T02:18:26.530

session.load() 将始终返回“代理”（Hibernate 术语）而不会访问数据库。在 Hibernate 中，代理是一个具有给定标识符值的对象，它的属性还没有初始化，它只是看起来像一个临时的假对象。如果未找到任何行，则会抛出 ObjectNotFoundException。

session.get() 总是命中数据库并返回真实对象，一个代表数据库行的对象，而不是代理。如果没有找到行，则返回 null。

这些方法的性能也会产生差异。两...

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-09-03T20:50:07.610

还有一个额外的点::

如果在缓存和数据库中都没有找到对象，则 Hibernate Session 类的 get 方法返回 null。while load() 方法抛出 ObjectNotFoundException 如果在缓存和数据库上都没有找到对象，但从不返回 null。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-09-18T17:40:39.727

使用“load”而不是“get”的一个间接后果是，使用版本属性的乐观锁定可能不会像您期望的那样工作。如果加载只是创建一个代理而不从数据库中读取，则不会加载版本属性。只有当/如果您稍后引用对象上的属性，触发选择时，才会加载该版本。同时，另一个会话可以更新该对象，并且您的会话将没有执行乐观锁检查所需的原始版本 - 因此您的会话的更新将覆盖另一个会话的更新而不会发出警告。

下面尝试通过两个会话处理具有相同标识符的对象来勾勒此场景。DB 中对象的初始版本是 10。

```
Session 1                  Session 2
---------                  ---------
Load object
Wait a while..   
                           Load object
                           Modify object property
                           [triggers db 'select' -
                            version read as 10]
                           Commit
                           [triggers db update,
                            version modified to 11]
Modify object property
  [triggers db 'select' -
  version read as 11]
Commit
  [triggers db update,
  version modified to 12] 
```

我们实际上希望会话 1 的提交失败并出现乐观锁异常，但在这里它会成功。

使用“get”而不是“load”可以解决这个问题，因为 get 将立即发出一个选择，并且版本号将在正确的时间加载以进行乐观锁检查。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-07-23T06:21:37.490

此外，在使用 load 时我们必须小心，因为如果对象不存在，它将引发异常。只有当我们确定该对象存在时，我们才必须使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-09-18T08:45:41.017

[在http://www.mkyong.com/hibernate/differ-between-session-get-and-session-load](http://www.mkyong.com/hibernate/different-between-session-get-and-session-load)
session.load()找到了一个很好的解释：
它总是会返回一个“代理”（Hibernate 术语）而不击中数据库。
在 Hibernate 中，代理是一个具有给定标识符值的对象，它的属性还没有初始化，它只是看起来像一个临时的假对象。
它将始终返回具有给定标识值的代理对象，即使该标识值在数据库中不存在。但是，当您尝试通过从数据库中检索代理的属性来初始化代理时，它将使用 select 语句访问数据库。如果没有找到行，将抛出 ObjectNotFoundException。
session.get() ：
它总是命中数据库（如果在缓存中没有找到）并返回真实对象，一个代表数据库行的对象，而不是代理。
如果没有找到行，则返回 null。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-06T06:04:54.520

load() 无法从缓存或数据库中找到对象，抛出异常并且 load() 方法永远不会返回 null。

如果找不到对象，get() 方法返回 null。load() 方法可能返回一个代理而不是一个真正的持久实例 get() 永远不会返回一个代理。

# python - 在 Ruby 和 Python 中使用 yield 创建列表

> ID：608951
> 
> 赞同：3
> 
> 时间：2009-03-04T01:39:33.993
> 
> 标签：python, ruby, list, yield

我试图想出一种优雅的方法来从一个在 Python 和 Ruby 中产生值的函数创建一个列表。

在 Python 中：

```
def foo(x):
    for i in range(x):
        if bar(i): yield i 
result = list(foo(100)) 
```

在红宝石中：

```
def foo(x)
  x.times {|i| yield i if bar(i)}
end
result = []
foo(100) {|x| result << x} 
```

虽然我喜欢同时使用这两种语言，但我一直对 Ruby 版本必须初始化列表然后填充它感到有些困扰。Python 的`yield`结果是简单的迭代，这很棒。Ruby`yield`调用一个块，这也很棒，但是当我只想填写一个列表时，感觉有点笨拙。

有没有更优雅的 Ruby 方式？

**更新**重做示例以显示从函数产生的值的数量不一定等于 x。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-04T02:34:45.233

因此，对于您的新示例，请尝试以下操作：

```
def foo(x)
  (0..x).select { |i| bar(i) }
end 
```

基本上，除非您正在编写自己的迭代器，否则您在 Ruby 中并不`yield`经常需要。如果您停止尝试使用 Ruby 语法编写 Python 习语，您可能会做得更好。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-04T02:53:40.007

对于 Python 版本，我会使用如下生成器表达式：

```
(i for i in range(x) if bar(i)) 
```

或者对于这种过滤值的特定情况，甚至更简单

```
itertools.ifilter(bar,range(x)) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-09-23T17:58:46.580

您的 Python 代码（使用 Ruby 生成器）的完全等价物是：

```
def foo(x)
    Enumerator.new do |yielder|
        (0..x).each { |v| yielder.yield(v) if bar(v) }
    end
end

result = Array(foo(100)) 
```

在上面，列表是延迟生成的（就像在 Python 示例中一样）；看：

```
def bar(v); v % 2 == 0; end

f = foo(100)
f.next #=> 0
f.next #=> 2 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T01:46:43.553

我知道这不是您要寻找的东西，但是用 ruby​​ 表达您的示例的更优雅的方式是：

```
result = Array.new(100) {|x| x*x} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T01:47:00.510

```
def squares(x)
  (0..x).map { |i| i * i }
end 
```

任何涉及值范围的事情都最好使用范围而不是`times`数组生成来处理。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T14:21:07.327

对于 stbuton 发布的 Python 列表理解版本，如果您需要生成器，请使用[xrange而不是 range。](http://docs.python.org/library/functions.html#xrange)range 将在内存中创建整个列表。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-04T14:34:17.890

`yield`意味着不同的东西红宝石和蟒蛇。在 ruby​​ 中，如果我没记错的话，你必须指定一个回调块，而 python 中的生成器可以传递给任何持有它们的人。

# javascript - Javascript 文件在 ASP.NET MVC 中没有正确映射？

> ID：608962
> 
> 赞同：3
> 
> 时间：2009-03-04T01:45:39.673
> 
> 标签：javascript, asp.net-mvc

我的母版页中的 javascript 文件有问题......我有以下内容：

```
<script src="Scripts/jquery-1.2.6.min.js" type="text/javascript"></script>

<script src="Scripts/Plugins/jquery-corners.js" type="text/javascript"></script> 
```

这有效...直到我开始深入研究路线...例如，`http://localhost/mywebsite`有效，但`http://localhost/mywebsite/action`无效-我丢失了所有 javascript 导入。

我已经为我的图像使用了 Url.Content ... 但看起来我无法为我的 javascript 做任何事情。不可能那么难……我一定是错过了什么！任何帮助，将不胜感激！

**更新**

[我在带有 ASP.NET MVC 的母版页中](https://stackoverflow.com/questions/347528/using-scripts-in-a-master-page-with-asp-net-mvc)找到了以下Using scripts ...但如果我将它放在标签之间...我需要它的地方，我无法让它工作。如果我尝试把它放在那里，我会收到以下错误：

> 无法修改 Controls 集合，因为该控件包含代码块（即 <% ... %>）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T02:44:48.640

在stackoverflow上的其他帖子的帮助下弄清楚了。这是最终奏效的方法：

```
<script src="<%= Url.Content("~/Scripts/CreativeLogic.js") %>" type="text/javascript"></script>
<script src="<%= Url.Content("~/Scripts/jquery-1.2.6.min.js") %>" type="text/javascript"></script>
<script src="<%= Url.Content("~/Scripts/Plugins/jquery-corners.js") %>" type="text/javascript"></script>

<script type="text/javascript"> 
    $(document).ready(function()
    {
        $('.part').corner("15px");
    });
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T02:19:48.297

查看 UrlHelper.Content（找不到 MSDN 文档，抱歉）

# cocoa - 注册为 Cocoa 的登录项？

> ID：608963
> 
> 赞同：25
> 
> 时间：2009-03-04T01:46:11.107
> 
> 标签：cocoa

谷歌给了我：http: [//developer.apple.com/samplecode/LoginItemsAE/index.html](http://developer.apple.com/samplecode/LoginItemsAE/index.html)

而且我认为肯定有比使用 AppleScript Events 更好的方法。

所以我下载了咆哮源。他们使用苹果开发者文章中的确切来源。

有没有更好的办法？

（我指的是系统偏好设置中帐户中的登录项，即在用户登录时以编程方式启动我的程序）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-04T02:15:40.927

Leopard 中有一个名为 LSSharedFileList 的新 API。它允许您做的一件事是查看和编辑登录项列表（在该 API 中称为会话登录项）。

顺便说一句，我是 Growl 的首席开发人员。我们还没有放弃 AE，因为我们仍然需要 Tiger，但我正在考虑在 1.2 中放弃它（还没有与其他开发人员讨论过）。当我们删除 Tiger 时，我们也将删除 LoginItemsAE，并切换到共享文件列表 API。

* * *

**2012 年的编辑**：自 2009 年以来，当我最初写这个答案时，Growl 已经切换到 LSSharedFileList 并且我已经离开了这个项目。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-01-25T09:40:28.593

我偶然发现了 Ben Clark-Robinson 的[LaunchAtLoginController](https://github.com/Mozketo/LaunchAtLoginController)。一个非常常见的问题的非常优雅的解决方案。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-11-30T07:15:40.473

这适用于 xcode 5。

```
- (BOOL)isLaunchAtStartup {
    // See if the app is currently in LoginItems.
    LSSharedFileListItemRef itemRef = [self itemRefInLoginItems];
    // Store away that boolean.
    BOOL isInList = itemRef != nil;
    // Release the reference if it exists.
    if (itemRef != nil) CFRelease(itemRef);

    return isInList;
}

- (void)toggleLaunchAtStartup {
    // Toggle the state.
    BOOL shouldBeToggled = ![self isLaunchAtStartup];
    // Get the LoginItems list.
    LSSharedFileListRef loginItemsRef = LSSharedFileListCreate(NULL, kLSSharedFileListSessionLoginItems, NULL);
    if (loginItemsRef == nil) return;
    if (shouldBeToggled) {
        // Add the app to the LoginItems list.
        CFURLRef appUrl = (__bridge CFURLRef)[NSURL fileURLWithPath:[[NSBundle mainBundle] bundlePath]];
        LSSharedFileListItemRef itemRef = LSSharedFileListInsertItemURL(loginItemsRef, kLSSharedFileListItemLast, NULL, NULL, appUrl, NULL, NULL);
        if (itemRef) CFRelease(itemRef);
    }
    else {
        // Remove the app from the LoginItems list.
        LSSharedFileListItemRef itemRef = [self itemRefInLoginItems];
        LSSharedFileListItemRemove(loginItemsRef,itemRef);
        if (itemRef != nil) CFRelease(itemRef);
    }
    CFRelease(loginItemsRef);
}

- (LSSharedFileListItemRef)itemRefInLoginItems {
    LSSharedFileListItemRef res = nil;

    // Get the app's URL.
    NSURL *bundleURL = [NSURL fileURLWithPath:[[NSBundle mainBundle] bundlePath]];
    // Get the LoginItems list.
    LSSharedFileListRef loginItemsRef = LSSharedFileListCreate(NULL, kLSSharedFileListSessionLoginItems, NULL);
    if (loginItemsRef == nil) return nil;
    // Iterate over the LoginItems.
    NSArray *loginItems = (__bridge NSArray *)LSSharedFileListCopySnapshot(loginItemsRef, nil);
    for (id item in loginItems) {
        LSSharedFileListItemRef itemRef = (__bridge LSSharedFileListItemRef)(item);
        CFURLRef itemURLRef;
        if (LSSharedFileListItemResolve(itemRef, 0, &itemURLRef, NULL) == noErr) {
            // Again, use toll-free bridging.
            NSURL *itemURL = (__bridge NSURL *)itemURLRef;
            if ([itemURL isEqual:bundleURL]) {
                res = itemRef;
                break;
            }
        }
    }
    // Retain the LoginItem reference.
    if (res != nil) CFRetain(res);
    CFRelease(loginItemsRef);
    CFRelease((__bridge CFTypeRef)(loginItems));

    return res;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-04T02:11:10.220

我在[我正在编写的应用程序](http://github.com/xpaulbettsx/zapped/tree/66619b4215eb05dbef152f41acebf0bb162832ca/osx)中执行此操作：

查看 UKLoginItemRegistry 以获得实用的简单方法。Afaik，如果没有 Apple Events，Tiger 就无法做到这一点；在 Leopard 中有更好的方法，但如果你使用 UKLoginItemRegistry 确实没问题。这是实现“登录时打开”菜单项的完整代码

```
+ (bool)isAppSetToRunAtLogon {
  int ret = [UKLoginItemRegistry indexForLoginItemWithPath:[[NSBundle mainBundle] bundlePath]];
  NSLog(@"login item index = %i", ret);
  return (ret >= 0);
}

- (IBAction)toggleOpenAtLogon:(id)sender {
  if ([PopupController isAppSetToRunAtLogon]) {
    [UKLoginItemRegistry removeLoginItemWithPath:[[NSBundle mainBundle] bundlePath]];
  } else {
    [UKLoginItemRegistry addLoginItemWithPath:[[NSBundle mainBundle] bundlePath] hideIt: NO];
  }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-09-15T11:55:00.707

我在这里重构了一些答案，以提供一个`NSApplication`提供`launchAtLogin`属性的类别。

[https://gist.github.com/joerick/73670eba228c177bceb3](https://gist.github.com/joerick/73670eba228c177bceb3)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-07-03T10:22:16.697

[SMLoginItemSetEnabled](https://developer.apple.com/documentation/servicemanagement/1501557-smloginitemsetenabled?language=objc "SMLoginItemSetEnabled")是另一个现代选项，请参阅Cory Bohon 撰写的[Modern Login Items](http://martiancraft.com/blog/2015/01/login-items/ "现代登录项")文章，他解释说您必须创建一个帮助应用程序，其唯一目的是启动主应用程序。[SMLoginItemSetEnabled - Start at Login with App Sandboxed](https://stackoverflow.com/questions/30587446/smloginitemsetenabled-start-at-login-with-app-sandboxed-xcode-6-3-illustrat/30587447#30587447) on Stack Overflow中也有完整的分步说明。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2012-12-05T21:26:43.210

在这里查看一个开源示例：[https](https://github.com/invariant/rhpnotifier) ://github.com/invariant/rhpnotifier (LoginItem.m, LoginItem.h)

# sql - 如何在 LINQ 中为结果集创建返回类型

> ID：608967
> 
> 赞同：2
> 
> 时间：2009-03-04T01:47:19.917
> 
> 标签：sql, linq, linq-to-sql, stored-procedures

我在确定 c# 和 LINQ 如何解决处理不一定返回表结构而是返回结果集的数据结构的常见问题时遇到问题。

我有一个有效的存储过程，并将其包含在我的 DBML 中

```
[Function(Name="dbo.p_GetObject")]
public int p_GetObject([Parameter(Name="ObjectType", DbType="NVarChar(200)")] string objectType, [Parameter(Name="ItemState", DbType="Bit")] System.Nullable<bool> itemState, [Parameter(Name="IsPublished", DbType="Bit")] System.Nullable<bool> isPublished)
{
    IExecuteResult result = this.ExecuteMethodCall(this, ((MethodInfo)(MethodInfo.GetCurrentMethod())), objectType, itemState, isPublished);
    return ((int)(result.ReturnValue));
} 
```

dbml 说返回类型是 (None)，这可能是关键问题。但是我没有与结果集匹配的 DBML 对象。

SP 采用三个参数，并返回一个包含多行的三列（ID、名称、值）的结果集。我可以为此创建一个数据对象，并将其称为 resultSet

当我为此编写函数调用时，我被卡住了：

```
public List<resultset> GetObject(string objectType, bool itemState, bool isPublished)
{
    MyDataContext.p_GetObject(objectType, itemState, isPublished);
} 
```

我的问题是：

如何让对存储过程的数据上下文调用填充我的 resultSet 对象？有更好的方法吗？返回类型应该是什么？SQL 视图？寻找好的建议...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T01:53:29.013

如果它根本不了解您的 SP，那可能是 SET FMT_ONLY 问题...尝试从 SP 的简化版本生成数据？

通常，不与现有实体 1:1 映射的 SP / UDF 会在生成的类型中暴露自己。您可以在 DBML 文件中重命名它（而不是在设计器中），但我个人不会；我倾向于将 SP 标记为私有，并编写自己的方法，将其投射到我自己的 POCO 类型（为存储库定义）：

```
var typed = from row in cxt.SomeFunction(123)
            select new MyType {Id = row.Id, Name = row.Name, ...} 
```

这样做的原因部分是为了存储库的纯度，部分是为了防止设计人员以意想不到的方式重写 DBML 的习惯；-p 请参阅[此处](https://stackoverflow.com/questions/496195/)了解更多信息。

# version-control - 使用数据驱动的 Web 应用程序和许多开发人员进行版本控制的最佳实践是什么？

> ID：608973
> 
> 赞同：1
> 
> 时间：2009-03-04T01:50:08.350
> 
> 标签：version-control

我已经阅读了许多类似问题的答案，但仍然没有得到我正在寻找的答案。

我们有一组大约 12 名开发人员和业务分析师在开发一个应用程序。这是一个巨大的应用程序，我猜大约有 1000 多个页面混合了 ASP 和 ASP.NET。

我想知道的是专业人士如何管理像这样的大型应用程序的版本控制？尤其是如何管理部署、数据库更改和源代码控制。他们是否以可以随时将应用程序回滚到稳定点的方式构建源代码控制程序？数据库如何适应这种情况？所有数据库架构更改和过程等是否都存储在源代码管理中？

我认为我在这里的理想解决方案是能够将整个应用程序从头开始重新水合到特定版本，包括数据。这是矫枉过正吗？

更新：我对应用程序大小的第一次猜测是遥遥无期。我做了一个实际的计数并想出了一个更大的数字。这些页面中有 90% 被冻结用于开发或未使用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T04:14:57.223

虽然您肯定会问一个涉及很多领域的问题，但您需要具备 3 个主要部分：

1.  使用版本控制系统。[Subversion](http://subversion.tigris.org/)或[GIT](http://git-scm.com/)之类的东西会自动让您将应用程序的代码回滚到任何时间点，或者回滚到您“标记”源代码的任何点。只要每个人只提交能够成功构建和运行的代码，每次提交都将是您可以回滚更改的有效点。您的版本控制系统将通过分支为您管理多行代码。处理分支的策略有[很多](http://www.javaworld.com/javaworld/jw-01-2008/jw-01-svnmerging.html)，找到最适合您的流程的策略。

2.  使用构建服务器。[像Cruise control](http://cruisecontrol.sourceforge.net/)、[Hudson](http://hudson-ci.org/)或[TeamCity](http://www.jetbrains.com/teamcity/)这样的构建服务器将自动确保每个提交都是一个“好的”提交，可以编译并且可以成功运行（假设你有适当的测试）

3.  将您的数据库架构和静态数据库数据与您的代码一起包含在版本控制中。有像[LiquiBase这样的工具](http://www.liquibase.org)它允许您管理您的数据库结构，并且旨在与同时工作的多个开发人员一起工作，甚至跨多个分支。如果没有相应的数据库结构，您的代码就不行，因此您需要确保两者保持同步。将数据库更改存储在源代码存储库中是最简单的方法。话虽如此，您不能将完整的数据库存储在存储库中。它太大了，而且对于源代码管理的 diff/merge 支持来说变化太大。根据您的行业，由于政府法规，它也可能不合法。如果您发现由于发布错误而需要回滚生产数据库，则需要通过查看存储的更新脚本来确定哪些 SQL 语句最能撤销应用的更改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T02:04:37.537

Perforce 有一个很棒的[白皮书](http://perforce.com/perforce/wcm.html)来解决你提出的一些问题。从他们关于网页的白皮书中，您可以将概念扩展到存储过程和脚本以生成/修改表。

至于能否从头开始补充水分，这实际上取决于您的灾难恢复计划，以及您如何设置和配置您的开发和集成测试环境；以及您愿意接受多少停机时间。我不是每天都在处理这些问题，所以也许有更多现实世界经验的人，特别是运营方面的人可以传授他们的智慧。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T02:07:06.750

120页是“巨大的”？哇...

像这样对应用程序进行版本控制非常简单。您有一个生产推出过程，包括在版本控制系统中的每个版本发布之前对其进行标记，并且只安装标记的版本。您在升级时备份数据库，然后更改架构，并将其存储在具有描述性名称的位置，以便您链接代码和数据库备份。如果需要回滚，只需安装旧代码并恢复备份即可。

如果您需要回滚，但使用当前数据，那么这是一个更难的问题，并且更多的是关于您的数据库的结构以及它的结构是如何演变的，但是 Rails 迁移是一个有趣的研究如何完成它。

除此之外，您的问题非常庞大，涉及很多领域。最好与以前处理过所有这些事情的人签约，让你走上正确的道路。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T02:26:18.967

这确实是一个非常正常且中等大小的应用程序。您只需要遵循良好的源代码控制流程、使用适当的单元测试、持续集成等。许多开发组织已经解决了这个问题。

恕我直言，您认为 120 页是巨大的这一事实，以及您觉得这很重要的事实都向我表明，您应该考虑立即停止开发，并改进您的开发过程。

我担心如果你现在不这样做，你以后会知道为什么你应该这样做。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T03:27:41.987

对于这么小的事情，而不是担心能够及时回滚，您真正想要的是能够将最新版本回滚到上一个版本。这样，如果您中断构建，您可以回滚到之前的构建。如何？

1) 您的网络服务器从 /www/working 读取 2) 将您的更改推送到 /www/new 3) 将 /www/current 移动到 /www/old 4) 将 /www/new 移动到 /www/current

如果 /www/current 发生故障，只需将 /www/old 移回原位即可。

唯一的问题是回滚数据库模式不是其中的一部分。回滚架构更改很困难，如果不是不可能的话。您真正能做的就是从备份中恢复旧版本，并放松活动数据库与备份内容之间的任何活动。如果您考虑一下，这是有道理的——如果您添加三个新表并以某种方式将另一个表重构为更好的模式，那么之后如何回滚模式更改？你不能——你只需要丢失所有的新数据。道德？认真对待您的数据库更改——DBA 有时被认为是混蛋是有原因的。他们必须是——他们不能像回滚错误代码那样回滚数据库中的错误。

# network-programming - 如何对应用程序的协议进行逆向工程？

> ID：608987
> 
> 赞同：4
> 
> 时间：2009-03-04T01:56:28.087
> 
> 标签：network-programming, protocols, network-protocols

我正在使用一个不太流行的应用程序（即时通讯程序）。我试图找到它使用的协议。我知道它正在使用 TCP/IP，但我想找出它发送到服务器并从服务器接收的所有命令。

我尝试了几个嗅探器，但它们无法通过名称识别此应用程序，而且我得到的只是一些不相关的十六进制代码。

有什么想法可以找到应用程序的规格吗？

（请注意：我用谷歌搜索了它，一无所获，也没有作者的文档。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T02:06:18.500

逆向工程通常有两种方法，例如：

您可以尝试使用 IDA PRO 之类的工具对其进行拆卸。

您可以尝试使用 Wireshark 之类的工具来嗅探其流量

无论哪种方式，这可能是很多工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T01:59:59.280

Wireshark 会告诉你协议。您无法在线路上以明文形式阅读消息这一事实是一件好事，不是吗？

# sql - 查询 250k 行需要 53 秒

> ID：608992
> 
> 赞同：14
> 
> 时间：2009-03-04T01:59:42.773
> 
> 标签：sql, linq-to-sql, query-optimization

运行此查询的机器是在数据中心中运行的专用服务器。

AMD Opteron 1354 四核 2.20GHz 2GB RAM Windows Server 2008 x64（是的，我知道我只有 2GB 的 RAM，当项目上线时我将升级到 8GB）。

因此，我在一个表中创建了 250,000 个虚拟行，以对 LINQ to SQL 生成的一些查询进行真正的压力测试，并确保它们不会太糟糕，我注意到其中一个花费了荒谬的时间。

我用索引将这个查询缩短到 17 秒，但为了从头到尾回答这个问题，我删除了它们。只有索引是主键。

```
Stories table --
[ID] [int] IDENTITY(1,1) NOT NULL,
[UserID] [int] NOT NULL,
[CategoryID] [int] NOT NULL,
[VoteCount] [int] NOT NULL,
[CommentCount] [int] NOT NULL,
[Title] [nvarchar](96) NOT NULL,
[Description] [nvarchar](1024) NOT NULL,
[CreatedAt] [datetime] NOT NULL,
[UniqueName] [nvarchar](96) NOT NULL,
[Url] [nvarchar](512) NOT NULL,
[LastActivityAt] [datetime] NOT NULL,

Categories table --
[ID] [int] IDENTITY(1,1) NOT NULL,
[ShortName] [nvarchar](8) NOT NULL,
[Name] [nvarchar](64) NOT NULL,

Users table --
[ID] [int] IDENTITY(1,1) NOT NULL,
[Username] [nvarchar](32) NOT NULL,
[Password] [nvarchar](64) NOT NULL,
[Email] [nvarchar](320) NOT NULL,
[CreatedAt] [datetime] NOT NULL,
[LastActivityAt] [datetime] NOT NULL, 
```

目前在数据库中有 1 个用户、1 个类别和 250,000 个故事，我尝试运行此查询。

```
SELECT TOP(10) *
FROM Stories
INNER JOIN Categories ON Categories.ID = Stories.CategoryID
INNER JOIN Users ON Users.ID = Stories.UserID
ORDER BY Stories.LastActivityAt 
```

查询需要 52 秒运行，CPU 使用率徘徊在 2-3%，成员为 1.1GB，900MB 可用但磁盘使用似乎失控。它是@ 100MB/秒，其中 2/3 写入 tempdb.mdf，其余从 tempdb.mdf 读取。

现在是有趣的部分......

```
SELECT TOP(10) *
FROM Stories
INNER JOIN Categories ON Categories.ID = Stories.CategoryID
INNER JOIN Users ON Users.ID = Stories.UserID

SELECT TOP(10) *
FROM Stories
INNER JOIN Users ON Users.ID = Stories.UserID
ORDER BY Stories.LastActivityAt

SELECT TOP(10) *
FROM Stories
INNER JOIN Categories ON Categories.ID = Stories.CategoryID
ORDER BY Stories.LastActivityAt 
```

所有这 3 个查询几乎都是即时的。

执行第一个查询的计划。
[http://i43.tinypic.com/xp6gi1.png](http://i43.tinypic.com/xp6gi1.png)

执行其他 3 个查询的计划（按顺序）。
[http://i43.tinypic.com/30124bp.png](http://i43.tinypic.com/30124bp.png)
[http://i44.tinypic.com/13yjml1.png](http://i44.tinypic.com/13yjml1.png)
[http://i43.tinypic.com/33ue7fb.png](http://i43.tinypic.com/33ue7fb.png)

任何帮助将非常感激。

添加索引后执行计划（再次下降到 17 秒）。
[http://i39.tinypic.com/2008ytx.png](http://i39.tinypic.com/2008ytx.png)

我从每个人那里得到了很多有用的反馈，我感谢你们，我在这方面尝试了一个新的角度。我查询我需要的故事，然后在单独的查询中获取类别和用户，并且通过 3 个查询只花了 250 毫秒...我不明白这个问题，但如果它有效并且暂时不低于 250 毫秒，我会坚持下去。这是我用来测试的代码。

```
DBDataContext db = new DBDataContext();
Console.ReadLine();

Stopwatch sw = Stopwatch.StartNew();

var stories = db.Stories.OrderBy(s => s.LastActivityAt).Take(10).ToList();
var storyIDs = stories.Select(c => c.ID);
var categories = db.Categories.Where(c => storyIDs.Contains(c.ID)).ToList();
var users = db.Users.Where(u => storyIDs.Contains(u.ID)).ToList();

sw.Stop();
Console.WriteLine(sw.ElapsedMilliseconds); 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-04T02:32:58.717

尝试在 Stories.LastActivityAt 上添加索引。我认为执行计划中的聚集索引扫描可能是由于排序。

编辑：由于我的查询立即返回，行只有几个字节长，但已经运行了 5 分钟，并且在我添加了 2K varchar 之后仍在继续，我认为 Mitch 有一点。正是这些数据的数量被无端打乱了，但这可以在查询中修复。

尝试将 join、sort 和 top(10) 放在视图或嵌套查询中，然后根据故事表连接回来，以获取您需要的 10 行的其余数据。

像这样：

```
select * from 
(
    SELECT TOP(10) id, categoryID, userID
    FROM Stories
    ORDER BY Stories.LastActivityAt
) s
INNER JOIN Stories ON Stories.ID = s.id
INNER JOIN Categories ON Categories.ID = s.CategoryID
INNER JOIN Users ON Users.ID = s.UserID 
```

如果您在 LastActivityAt 上有一个索引，它应该运行得非常快。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T02:24:56.240

因此，如果我正确阅读了第一部分，它会在 17 秒内响应索引。想出 10 条记录还需要一段时间。我在想时间是按子句排序的。我想要一个关于 LastActivityAt、UserID、CategoryID 的索引。只是为了好玩，删除 order by 看看它是否快速返回 10 条记录。如果是这样，那么您就知道它不在与其他表的连接中。此外，将 * 替换为所需的列也会很有帮助，因为在排序时所有 3 个表列都在 tempdb 中 - 正如 Neil 提到的那样。

查看执行计划，您会注意到额外的排序 - 我相信这是需要一些时间的顺序。我假设你有一个 3 的索引，它是 17 秒......所以你可能想要一个索引用于连接条件（用户 ID、类别 ID）和另一个用于 lastactivityat - 看看它是否表现更好。此外，最好通过索引调整向导运行查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T02:06:52.867

我的第一个建议是删除 *，并将其替换为您需要的最少列。

第二，是否有触发因素？会更新 LastActivityAt 字段的东西？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T02:17:30.283

根据您的问题查询，尝试在表上添加组合索引`Stories`（CategoryID、UserID、LastActivityAt）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T03:09:19.720

您正在最大化硬件设置中的磁盘。

鉴于您对 Data/Log/tempDB 文件位置的评论，我认为任何数量的调整都将成为创可贴。

250,000 行很小。想象一下，如果有 1000 万行，您的问题会有多糟糕。

我建议你将 tempDB 移到它自己的物理驱动器上（最好是 RAID 0）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T04:24:25.250

好的，所以我的测试机并不快。实际上它真的很慢。它 1.6 ghz，n 1 gb 的内存，没有多个磁盘，只有一个（读取速度慢）磁盘用于 sql server、操作系统和其他功能。

我创建了定义了主键和外键的表。插入了 2 个类别，500 个随机用户和 250000 个随机故事。

运行上面的第一个查询需要 16 秒（也没有计划缓存）。如果我索引 LastActivityAt 列，我会在一秒钟内得到结果（这里也没有计划缓存）。

这是我用来执行所有这些操作的脚本。

```
 --Categories table --
Create table Categories (
[ID] [int] IDENTITY(1,1) primary key NOT NULL,
[ShortName] [nvarchar](8) NOT NULL,
[Name] [nvarchar](64) NOT NULL)

--Users table --
Create table Users(
[ID] [int] IDENTITY(1,1) primary key NOT NULL,
[Username] [nvarchar](32) NOT NULL,
[Password] [nvarchar](64) NOT NULL,
[Email] [nvarchar](320) NOT NULL,
[CreatedAt] [datetime] NOT NULL,
[LastActivityAt] [datetime] NOT NULL
)
go

-- Stories table --
Create table Stories(
[ID] [int] IDENTITY(1,1) primary key NOT NULL,
[UserID] [int] NOT NULL references Users ,
[CategoryID] [int] NOT NULL references Categories,
[VoteCount] [int] NOT NULL,
[CommentCount] [int] NOT NULL,
[Title] [nvarchar](96) NOT NULL,
[Description] [nvarchar](1024) NOT NULL,
[CreatedAt] [datetime] NOT NULL,
[UniqueName] [nvarchar](96) NOT NULL,
[Url] [nvarchar](512) NOT NULL,
[LastActivityAt] [datetime] NOT NULL)

Insert into Categories (ShortName, Name) 
Values ('cat1', 'Test Category One')

Insert into Categories (ShortName, Name) 
Values ('cat2', 'Test Category Two')

--Dummy Users
Insert into Users
Select top 500
UserName=left(SO.name+SC.name, 32)
, Password=left(reverse(SC.name+SO.name), 64)
, Email=Left(SO.name, 128)+'@'+left(SC.name, 123)+'.com'
, CreatedAt='1899-12-31'
, LastActivityAt=GETDATE()
from sysobjects SO 
Inner Join syscolumns SC on SO.id=SC.id
go

--dummy stories!
-- A Count is given every 10000 record inserts (could be faster)
-- RBAR method!
set nocount on
Declare @count as bigint
Set @count = 0
begin transaction
while @count<=250000
begin
Insert into Stories
Select
  USERID=floor(((500 + 1) - 1) * RAND() + 1)
, CategoryID=floor(((2 + 1) - 1) * RAND() + 1)
, votecount=floor(((10 + 1) - 1) * RAND() + 1)
, commentcount=floor(((8 + 1) - 1) * RAND() + 1)
, Title=Cast(NEWID() as VARCHAR(36))+Cast(NEWID() as VARCHAR(36))
, Description=Cast(NEWID() as VARCHAR(36))+Cast(NEWID() as VARCHAR(36))+Cast(NEWID() as VARCHAR(36))
, CreatedAt='1899-12-31'
, UniqueName=Cast(NEWID() as VARCHAR(36))+Cast(NEWID() as VARCHAR(36)) 
, Url=Cast(NEWID() as VARCHAR(36))+Cast(NEWID() as VARCHAR(36))
, LastActivityAt=Dateadd(day, -floor(((600 + 1) - 1) * RAND() + 1), GETDATE())
If @count % 10000=0
Begin
Print @count
Commit
begin transaction
End
Set @count=@count+1
end 
set nocount off
go

--returns in 16 seconds
DBCC DROPCLEANBUFFERS
SELECT TOP(10) *
FROM Stories
INNER JOIN Categories ON Categories.ID = Stories.CategoryID
INNER JOIN Users ON Users.ID = Stories.UserID
ORDER BY Stories.LastActivityAt
go

--Now create an index
Create index IX_LastADate on Stories (LastActivityAt asc)
go
--With an index returns in less than a second
DBCC DROPCLEANBUFFERS
SELECT TOP(10) *
FROM Stories
INNER JOIN Categories ON Categories.ID = Stories.CategoryID
INNER JOIN Users ON Users.ID = Stories.UserID
ORDER BY Stories.LastActivityAt
go 
```

排序绝对是您减速的地方。排序主要在 tempdb 中完成，大表将导致添加 LOTS。在此列上有一个索引肯定会提高 order by 的性能。

此外，定义主键和外键可以极大地帮助 SQL Server

您的代码中列出的方法很优雅，并且基本上与 cdonner 编写的响应相同，除了在 c# 中而不是 sql 中。调整数据库可能会产生更好的结果！

——克里斯

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T02:50:07.270

您是否在运行每个查询之前清除了 SQL Server 缓存？

在 SQL 2000 中，它类似于 DBCC DROPCLEANBUFFERS。谷歌命令以获取更多信息。

查看查询，我会有一个索引

Categories.ID Stories.CategoryID Users.ID Stories.UserID

可能还有 Stories.LastActivityAt

但是，是的，听起来结果可能是缓存的虚假“cos”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-04T04:35:24.070

当您使用 SQL Server 一段时间后，您会发现即使是对查询的最小更改也会导致完全不同的响应时间。根据我在最初的问题中所读到的内容，并查看查询计划，我怀疑优化器已决定最好的方法是形成部分结果，然后将其作为单独的步骤进行排序。部分结果是用户和故事表的组合。这是在 tempdb 中形成的。所以过多的磁盘访问是由于这个临时表的形成然后排序。

我同意解决方案应该是在 Stories.LastActivityAt、Stories.UserId、Stories.CategoryId 上创建复合索引。顺序非常重要，LastActivityAt 字段必须是第一个。

# html - 跟踪和显示 html 中的更改

> ID：608995
> 
> 赞同：2
> 
> 时间：2009-03-04T02:02:12.440
> 
> 标签：html

我正在寻找一种工具来显示/跟踪文本的变化，有点像在编辑问题时在 stackoverflow 上完成的。有人知道实现这一目标的工具吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T02:13:13.397

您可能想为此使用**diff**。

如果您可以在您的服务器上使用 PHP，那么有一个方便的 pear 包来执行您需要的任务。这是一个例子：

[https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-6174867.html](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-6174867.html)

实际上也有一个实际的 Javascript 实现，虽然没有经过测试：

[http://ejohn.org/projects/javascript-diff-algorithm/](http://ejohn.org/projects/javascript-diff-algorithm/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T02:08:13.067

[http://aignes.net/](http://aignes.net/)

虽然是商业工具。我不知道 F/OSS 的替代方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-20T09:02:24.900

我自己的答案的副本来自[这里](https://stackoverflow.com/questions/31722/anyone-have-a-diff-algorithm-for-rendered-html/1593296#1593296)。

* * *

[DaisyDiff](http://code.google.com/p/daisydiff/)怎么样（[Java](http://code.google.com/p/daisydiff/)和[PHP](http://www.mediawiki.org/wiki/Visual_Diff)版本可用）。

以下功能非常好：

*   适用于可以“在野外”找到的格式错误的 HTML。
*   差异在 HTML 中比 XML 树的差异更专业。更改部分文本节点不会导致更改整个节点。
*   除了默认的视觉差异之外，HTML 源代码可以连贯地进行差异。
*   提供易于理解的更改说明。
*   默认 GUI 允许通过键盘快捷键和链接轻松浏览修改。