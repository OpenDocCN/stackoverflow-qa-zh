# StackOverflow 问答 000266000-000266999

# javascript - Reading the value of an input using XPath, then using in Greasemonkey

> ID：266002
> 
> 赞同：10
> 
> 时间：2008-11-05T17:42:00.500
> 
> 标签：javascript, xpath, greasemonkey

I'm using this XPath to get the value of a field:

```
//input[@type="hidden"][@name="val"]/@value 
```

I get several results, but I only want the first. Using

```
//input[@type="hidden"][@name="val"]/@value[1] 
```

Doesn't work. Once I have this, how do I pick up the value in Greasemonkey? I am trying things like:

```
alert("val " + val.snapshotItem); 
```

But I think that's for the node, rather than the string.

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-05T18:08:45.843

For the XPath, try:

```
//input[@type="hidden" and @name="val" and position() = 1]/@value

```

For use in a GreaseMonkey script, do something like this:

```
var result = document.evaluate(
  "//input[@type='hidden' and @name='var' and position()=1]/@value",
  document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null
);

var hiddenval = result.snapshotItem(0);

if (hiddenval)
  alert("Found: " + hiddenval.nodeValue);  
else
  alert("Not found."); 
```

Strictly speaking: Using `"position()=1"` in the XPath filter is not absolutely necessary, because only the first returned result is going to be used anyway (via `snapshotItem(0)`). But why build a larger result set than you really need.

EDIT: Using an XPath result of the `ORDERED_NODE_SNAPSHOT_TYPE` type makes sure you get the nodes in *document order*. That means the first node of the result will also be the first node in the document.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-05T19:42:59.897

Tomalak 的想法是正确的，但我会做一些不同的事情。

```
var result = document.evaluate(
  "//input[@type='hidden' and @name='var']",
  document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null);

var input = result.iterateNext();

if (input)
  alert("Found: " + input.value);  
else
  alert("Not found."); 
```

这样，您将指定只希望返回一个项目（在本例中为文档中的第一个项目）作为*结果集的一部分。*此外，您在这里获取 DOM 节点，然后读取其`value`属性以获取值。我发现这比通过 XPath 获取字符串值更可靠（尽管您的里程可能会有所不同）。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-04T06:08:07.327

一种可能性是在您的脚本中包含 jQuery。这将为访问元素提供更简单的语法。

```
// ==UserScript==
// @name           MyScript
// @namespace      http://example.com
// @description    Example
// @include        *
//
// @require     http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js
// ==/UserScript==

var input = $("input[type='hidden'][name='var']");

if (input) {
  alert("Found: " + input.val());  
} else {
  alert("Not found.");
} 
```

# asp.net - 如何通过 Ektron CMS400.NET Web 服务 API 创建新的会员用户？

> ID：266006
> 
> 赞同：0
> 
> 时间：2008-11-05T17:42:32.310
> 
> 标签：asp.net, web-services, ektron

我正在尝试通过从远程站点调用用户 Web 服务 API 在基于 Ektron CMS400.NET 的网站中创建新的会员用户。我打算使用的方法之一，[AddMembershipUser](http://www.ektron.com/manuals/cms400/v70/API_Help/frames.html?frmname=topic&frmfile=Ektron_Services_User_AddMembershipUser@UserData.html)在文档中有一条注释指出“必须登录具有管理员权限的用户才能执行此操作。”。我已经通过 AuthenticationHeaderValue 对象提供了远程调用 Web 服务所需的凭据。我还打电话给[LogInUser](http://www.ektron.com/manuals/cms400/v70/API_Help/frames.html?frmname=topic&frmfile=Ektron_Services_User_LogInUser@string@string@string@string@string.html)方法，登录我的一个管理员用户，这似乎是有效的。我被卡住的地方是弄清楚如何以我刚刚登录的管理员用户身份执行对 AddMembershipUser 的调用。我已向 Ektron 支持提出请求，并且一直在搜索论坛和文档，但还没有找到任何答案。

有没有人有从远程服务器以编程方式登录的用户调用 Web 服务 API 方法的示例？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T03:18:37.610

我已经使用 Ektron 6.13、6.15、6.18、7.03 和 7.04 完成了这项工作，在每个版本中，它们都以许多不同且有趣的方式从根本上改变/破坏了 API。我可以为每个版本给你一个答案，但我的建议是在页面上放置一个成员控制并使用它来创建一个用户，同时记录使用 SQL 探查器发生的 SQL（以及你可以使用的任何其他日志记录/检查技术）考虑到）。然后尝试 API 方法，看看 API 是如何做的，然后比较两者，我体验过的版本通常存在巨大差异。对于我必须处理的大多数情况，我不得不让 API 完成其部分工作，然后直接进入数据库以正确更新记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T18:48:08.293

根据我对他们的文档的了解，只要您通过 AuthenicationheaderValue 对象路径登录凭据，您就应该能够拨打电话。您可能还需要先调用登录，他们可能正在以某种方式跟踪会话。

# css - 如何将 CSS 浮动保持在一行中？

> ID：266015
> 
> 赞同：216
> 
> 时间：2008-11-05T17:45:41.240
> 
> 标签：css, css-float, css-tables, stretching

我想在同一行上有两个项目，`float: left`用于左侧的项目。

我独自实现这一点没有问题。*问题是，即使您将浏览器的大小调整得很小*，我也希望这两个项目**保持**在同一行。你知道......就像桌子一样。

 *目的是使右侧的项目*无论如何都不会*被包裹。

如何使用 CSS 告诉浏览器我宁愿**拉伸包含`div`**而不是包装它，这样`float: right;`div 就在`float: left;` `div`?

我想要的是：

```
 \
 +---------------+  +------------------------/
 | float: left;  |  | float: right;          \
 |               |  |                        /
 |               |  |content stretching      \   Screen Edge
 |               |  |the div off the screen  /  <---
 +---------------+  +------------------------\
                                             / 
```

* * *

## 回答 #1

> 赞同：132
> 
> 时间：2012-04-02T14:26:44.120

另一种选择是将空白属性 nowrap 设置为父 div，而不是浮动：

```
.parent {
     white-space: nowrap;
} 
```

并重置空白并使用内联块显示，以便 div 保持在同一行，但您仍然可以给它一个宽度。

```
.child {
    display:inline-block;
    width:300px;
    white-space: normal;
} 
```

这是一个 JSFiddle：[https ://jsfiddle.net/9g8ud31o/](https://jsfiddle.net/9g8ud31o/)

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2008-11-05T17:50:24.273

将您的浮动`<div>`s 包装在`<div>`使用此跨浏览器最小宽度 hack 的容器中：

```
.minwidth { min-width:100px; width: auto !important; width: 100px; } 
```

您*可能*还需要设置“溢出”，但可能不需要。

这有效，因为：

*   `!important`声明，结合使所有内容`min-width`在 IE7+ 中保持在同一行
*   IE6 没有实现`min-width`，但是它有一个错误，例如`width: 100px`覆盖`!important`声明，导致容器宽度为 100px。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-04-05T05:10:09.490

将您的漂浮物包裹在一个最小宽度大于漂浮物的组合宽度+边距的 div 中。

无需 hack 或 HTML 表格。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-11-08T07:21:16.137

解决方案1：

显示：表格单元（未广泛支持）

解决方案2：

表

（我讨厌黑客。）

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-05T23:15:28.253

另一种选择：不要浮动你的右栏；只需给它一个左边距以将其移动到浮动之外。您需要一两次破解来修复 IE6，但这是基本思想。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-05T17:54:47.870

您确定浮动块级元素是解决此问题的最佳方法吗？

在我的经验中经常遇到 CSS 困难，事实证明我看不到做我想做的事情的原因是我陷入了关于我的标记的隧道视野（思考“我怎样才能制作*这些*元素这样做*？* ”），而不是回头看看我需要实现的究竟是什么，也许稍微修改我的 html 以促进这一点。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-07-26T16:03:39.153

我建议使用表格来解决这个问题。我遇到了类似的问题，只要表格只是用于显示一些数据而不是用于主页布局就可以了。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-03-30T10:18:58.487

将此行添加到浮动元素选择器

```
.floated {
    float: left;
    ...
    box-sizing: border-box;
} 
```

它将防止填充和边框添加到宽度，因此元素始终保持在行中，即使您有例如。宽度为 33.33333% 的三个元素

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-05-25T04:56:27.540

当用户水平减小窗口大小并导致浮动垂直堆叠时，删除浮动并在第二个 div（这是一个浮动）上使用 margin-top: -123px （你的值）和 margin-left: 444px （你的值）定位 div，因为它们与浮动一起出现。这样做时，当窗口变窄时，右侧的 div 会保持原位，当页面太窄而无法包含它时会消失。...当用户缩小浏览器窗口时，这（对我来说）比让右侧 div“跳”到左侧 div 下方要好。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2013-05-18T20:38:33.473

我解决这个问题的方法是使用一些 jQuery。我这样做的原因是因为 A 和 B 是百分比宽度。

HTML：

```
<div class="floatNoWrap">
    <div id="A" style="float: left;">
        Content A
    </div>
    <div id="B" style="float: left;">
        Content B
    </div>
    <div style="clear: both;"></div>
</div> 
```

CSS：

```
.floatNoWrap
{
    width: 100%;
    height: 100%;
} 
```

jQuery：

```
$("[class~='floatNoWrap']").each(function () {
    $(this).css("width", $(this).outerWidth());
}); 
```

# .net - IIS API - 创建虚拟目录？

> ID：266026
> 
> 赞同：6
> 
> 时间：2008-11-05T17:50:34.117
> 
> 标签：.net, asp.net, iis, api, virtual-directory

只是在寻找相关文档。示例不是必需的，但将不胜感激。

我们有一种情况，我们必须手动创建 100 多个虚拟目录，似乎自动化这将是目前提高流程效率的好方法。

也许明年我们可以重新设计服务器环境以允许更理智的事情，例如 URL 重写（不幸的是，这在 Web 应用程序的当前周期中似乎不可行）。继承垃圾代码不是很好吗？

~ 威廉·莱利-兰德

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-05T18:02:30.163

[使用vbscript](http://techtasks.com/code/viewbookcode/696)也更容易做到这一点..

```
' This code creates a virtual directory in the default Web Site
' ---------------------------------------------------------------
' From the book "Windows Server Cookbook" by Robbie Allen
' ISBN: 0-596-00633-0
' ---------------------------------------------------------------

' ------ SCRIPT CONFIGURATION ------
strComputer = "rallen-w2k3"
strVdirName = "<VdirName>"  'e.g. employees
strVdirPath = "<Path>"      'e.g. D:\resumes
' ------ END CONFIGURATION ---------
set objIIS = GetObject("IIS://" & strComputer & "/W3SVC/1")
set objWebSite = objIIS.GetObject("IISWebVirtualDir","Root")
set objVdir = objWebSite.Create("IISWebVirtualDir",strVdirName)
objVdir.AccessRead = True
objVdir.Path = strVdirPath
objVdir.SetInfo
WScript.Echo "Successfully created virtual directory: " & objVdir.Name 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-05T18:03:43.140

显然，您也可以通过 PowerShell 脚本执行此操作：

```
$objIIS = new-object System.DirectoryServices.DirectoryEntry("IIS://localhost/W3SVC/1/Root")
$children = $objIIS.psbase.children
$vDir = $children.add("NewFolder",$objIIS.psbase.SchemaClassName)
$vDir.psbase.CommitChanges()
$vDir.Path = "C:\Documents and Settings\blah\Desktop\new"
$vDir.defaultdoc = "Default.htm"
$vDir.psbase.CommitChanges() 
```

这是文档：[MSDN - 使用 IIS 编程管理](http://msdn.microsoft.com/en-us/library/ms524732.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T17:59:15.567

未测试（来自旧代码库，由我的前承包商编写）

```
using System;
using System.Collections.Generic;
using System.Text;
using System.DirectoryServices;
using System.IO;

namespace Common.DirectoryServices
{
    public class IISManager
    {

        private string _webSiteID;

        public string WebSiteID
        {
            get { return _webSiteID; }
            set { _webSiteID = value; }
        }

        private string _strServerName;
        public string ServerName
        {
            get
            {
                return _strServerName;
            }
            set
            {
                _strServerName = value;
            }
        }

        private string _strVDirName;
        public string VDirName
        {
            get
            {
                return _strVDirName;
            }
            set
            {
                _strVDirName = value;
            }
        }

        private string _strPhysicalPath;
        public string PhysicalPath
        {
            get
            {
                return _strPhysicalPath;
            }
            set
            {
                _strPhysicalPath = value;
            }
        }

        private VDirectoryType _directoryType;
        public VDirectoryType DirectoryType
        {
            get
            {
                return _directoryType;
            }
            set
            {
                _directoryType = value;
            }
        }

        public enum VDirectoryType
        {
            FTP_DIR, WEB_IIS_DIR
        };

        public string CreateVDir()
        {
            System.DirectoryServices.DirectoryEntry oDE;
            System.DirectoryServices.DirectoryEntries oDC;
            System.DirectoryServices.DirectoryEntry oVirDir;
            //try
           // {
                //check whether to create FTP or Web IIS Virtual Directory
                if (this.DirectoryType == VDirectoryType.WEB_IIS_DIR)
                {
                    oDE = new DirectoryEntry("IIS://" +
                          this._strServerName + "/W3SVC/" + _webSiteID + "/Root");
                }
                else
                {
                    oDE = new DirectoryEntry("IIS://" +
                          this._strServerName + "/MSFTPSVC/1/Root");
                }

                //Get Default Web Site
                oDC = oDE.Children;

                //Add row
                oVirDir = oDC.Add(this._strVDirName,
                          oDE.SchemaClassName.ToString());

                //Commit changes for Schema class File
                oVirDir.CommitChanges();

                //Create physical path if it does not exists
                if (!Directory.Exists(this._strPhysicalPath))
                {
                    Directory.CreateDirectory(this._strPhysicalPath);
                }

                //Set virtual directory to physical path
                oVirDir.Properties["Path"].Value = this._strPhysicalPath;

                //Set read access
                oVirDir.Properties["AccessRead"][0] = true;

                //Create Application for IIS Application (as for ASP.NET)
                if (this.DirectoryType == VDirectoryType.WEB_IIS_DIR)
                {
                    oVirDir.Invoke("AppCreate", true);
                    oVirDir.Properties["AppFriendlyName"][0] = this._strVDirName;
                }

                //Save all the changes
                oVirDir.CommitChanges();

                return null;

           // }
            //catch (Exception exc)
            //{
             //   return exc.Message.ToString();
            //}
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-05T18:43:19.753

WIX 安装程序工具创建了一种管理方式 - 您可以将它们定义为安装构建说明的一部分。配置所有项目需要一些工作，但在此之后维护应该是轻而易举的......这是关于创建虚拟目录条目的教程的摘录......

## 6.3 网页目录

> WiX 工具集具有其他库，允许安装程序执行其他任务，例如在 IIS 中创建 Web 目录。要使用这些扩展，您所要做的就是链接到适当的 WiX 库。链接器会自动将必要的帮助程序 DLL 包含到安装包中。
> 
> 首先，我们必须使用属于它的文件创建网站：
> 
> <Directory Id='TARGETDIR' Name='SourceDir'>
>   <Directory Id='ProgramFilesFolder' Name='PFiles'>
>     <Directory Id='InstallDir' Name='Acme'>
>       <Component Id='default.phpComponent' Guid= 'YOURGUID-5314-4689-83CA-9DB5C04D5742'>
>         <文件 ID='default.htmFile' Name='default.htm' LongName='default.htm' KeyPath='yes' DiskId='1' Source='default. htm' />
>       </Component>
>     </Directory>
>   </Directory>
> 
> 下一步是创建虚拟目录：
> 
>       <Component Id='TestWebVirtualDirComponent' Guid='YOURGUID-6304-410E-A808-E3585379EADB'>
>         <WebVirtualDir Id='TestWebVirtualDir' Alias='Test' Directory='InstallDir' WebSite='DefaultWebSite'>
>           <WebApplication Id='TestWebApplication' Name='Test' />
>         </WebVirtualDir>
>       </Component>
>     </Directory>
> 
> Finally, create an entry to reference the web site:
> 
>   <WebSite Id='DefaultWebSite' Description='Default Web Site'>
>    <WebAddress Id='AllUnassigned' Port='80' />
>   </WebSite>

# c# - 如何为 Visual Studio 项目的自定义“平台”开关添加和编译？

> ID：266028
> 
> 赞同：2
> 
> 时间：2008-11-05T17:51:10.933
> 
> 标签：c#, visual-studio, visual-studio-2008

我们希望**在 Visual Studio 中**为我们的项目提供两个**自定义平台开关**（配置管理器中的**平台下拉菜单**） 。

 **例如，一个用于“桌面”，一个用于“Web”。然后目标构建任务基于平台切换以自定义方式编译代码。我们不想添加到 Debug Release 开关，因为每个桌面和 Web 平台都需要这些开关。

我们找到了一种尝试方法，即修改 .csproj 文件以添加类似这样的内容

```
<Platform Condition=" '$(Platform)' == '' ">Desktop</Platform> 
```

并添加属性组，例如，

```
 <PropertyGroup Condition=" '$(Platform)' == 'Web' ">
        <DefineConstants>/define Web</DefineConstants>
        <PlatformTarget>Web</PlatformTarget>
      </PropertyGroup>
      <PropertyGroup Condition=" '$(Platform)' == 'Desktop' ">
        <DefineConstants>/define Desktop</DefineConstants>
        <PlatformTarget>Desktop</PlatformTarget>
      </PropertyGroup> 
```

但这仍然不起作用，编译器会抛出错误

*/platform 的“桌面”选项无效；必须是 anycpu、x86、Itanium 或 x64*

那么它是否必须是这些选项之一，我们不能添加我们的自定义平台吗？

有没有人能够做到这一点？任何指针都会有所帮助。

更新：使用 DebugDesktop 和 ReleaseDesktop 会使用户更加复杂。因为“桌面”和“网络”实际上是平台，并且可以在下拉列表中添加新平台（即），我相信“平台”开关应该用于完全相同的目的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-06-24T04:13:30.707

可能三年后这个主题对某人来说会很有趣。我在配置构建平台时遇到了类似的困难并解决了它们。

抛出您给出的错误是因为 PlatformTarget 属性是使用 Desctop 设置的，而不是因为 Platform 属性。这两个属性的含义略有不同。第一个真正最终指示构建过程的所有参与者应该使用哪个流程架构，而第二个允许在 IDE 中自定义构建环境。

在 Visual Studio 中创建项目时，ProcessTarget 属性可能会默认设置为带有条件限制的 PropertyGroups 下的 AnyCPU，例如“ **'...|$(Platform)' == '...|AnyCPU'** ”。但它并不强制你做同样的事情。ProcessTarget 属性可以使用 AnyCPU 轻松设置，因为 Platform 属性具有其他值。

考虑到上述情况，您的示例可能如下所示：

```
<PropertyGroup Condition=" '$(Platform)' == 'Web' ">
    <DefineConstants>Web</DefineConstants>
    <PlatformTarget>AnyCPU</PlatformTarget>
</PropertyGroup>
<PropertyGroup Condition=" '$(Platform)' == 'Desktop' ">
    <DefineConstants>Desktop</DefineConstants>
    <PlatformTarget>AnyCPU</PlatformTarget>
</PropertyGroup> 
```

它必须工作。

希望它对你有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T18:38:47.873

您应该能够使用配置管理器对话框来创建新平台。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-08T18:11:28.423

我最近问过同样的问题，看来使用 Visual Studio 2010，您可以定义自己的项目平台。（参见[http://blogs.msdn.com/b/vcblog/archive/2008/11/20/printf-hello-msbuild-n.aspx](http://blogs.msdn.com/b/vcblog/archive/2008/11/20/printf-hello-msbuild-n.aspx)）。不幸的是，我们仍在使用 2008。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-08-06T15:01:07.283

也在寻找这个......但根据[https://msdn.microsoft.com/en-us/library/bb629394.aspx](https://msdn.microsoft.com/en-us/library/bb629394.aspx)，MSBuild 引擎的唯一有效值是“Any CPU”、“x86”和“x64” ”。真的支持这种自定义吗？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-05T18:26:38.007

将“Debug”和“Release”重命名为“Debug Desktop”和“Release Desktop”，并将它们复制到名称“Debug Web”和“Release Web”中。然后以这种方式设置常量。

# java - How to set a timeout during remote ejb lookup?

> ID：266030
> 
> 赞同：3
> 
> 时间：2008-11-05T17:51:24.880
> 
> 标签：java, jakarta-ee, jndi

I'm trying to access a remote ejb which is not available yet. But the lookup takes 5 min before I get the NameNotFoundException. Is there a way I can set the lookup timeout to a lesser value so that the client application doesn't hang for 5 mins? Thanks in advance...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T18:00:45.487

Do the lookup in another thread, so that the client GUI does not hang. You can use plain Runnable to do this, or try a better option like [swingworker](https://swingworker.dev.java.net/).

To customize the JNDI lookup timeout, I am afraid, you will have to hack the internals of an open source app server, if that is an option.

# ruby-on-rails - 如何使用 ThinkingSphinx 对多个模型进行地理搜索？

> ID：266048
> 
> 赞同：1
> 
> 时间：2008-11-05T18:00:48.903
> 
> 标签：ruby-on-rails, ruby, sphinx, thinking-sphinx

我有两个模型索引用于搜索（用户和项目）。我正在尝试跨模型进行地理搜索：

`ThinkingSphinx::Search.search('keywords', :geo => [ degrees_to_radians(params[:lat].to_f), degrees_to_radians(params[:lon].to_f) ], )`

但我只得到一个错误：

`Sphinx Error: index item_core,item_delta,user_core,user_delta: unknown latitude attribute ''`

单独搜索每个模型都可以正常工作......但我不知道这里的问题是什么。以下是索引：

用户索引：

```
define_index do
    indexes [:first_name, :last_name], :as => :name
    indexes login
    indexes email
    indexes headline
    indexes description
    indexes business.name, :as => :business_name
    indexes [addresses.street_1, addresses.street_2, addresses.city, addresses.postal_code], :as => :address

    has created_at, :sortable => true
    has addresses.latitude, :as => :latitude, :type => :float
    has addresses.longitude, :as => :longitude, :type => :float    

    set_property :delta => true
  end 
```

项目索引：

```
define_index do
    indexes title, :sortable => true
    indexes description
    indexes [address.street_1, address.street_2, address.city, address.postal_code], :as => :address
    indexes images.title, :as => :image_titles
    indexes images.description, :as => :image_descriptions
    indexes categories(:name), :as => :category_names    

    has price, :sortable => true
    has created_at, :sortable => true
    has address.latitude, :as => :latitude, :type => :float
    has address.longitude, :as => :longitude, :type => :float    
    has categories(:id), :as => :category_ids

    where "`items`.`state` = 'for_sale'"

    set_property :delta => true    
  end 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T12:17:07.150

这是一个迟到的回应，但总比没有好，希望：

当您不在特定模型上搜索时，Thinking Sphinx 没有参考点来了解可用的属性，因此您需要明确告诉它要使用的 lat 和 long 属性：

```
ThinkingSphinx::Search.search('keywords',
  :geo => [
    degrees_to_radians(params[:lat].to_f),
    degrees_to_radians(params[:lon].to_f)
  ],
  :latitude_attr  => "latitude",
  :longitude_attr => "longitude"
) 
```

# document-management - How to integrate simple data entry app with document management system?

> ID：266063
> 
> 赞同：3
> 
> 时间：2008-11-05T18:04:38.240
> 
> 标签：document-management

We have simple web-based data entry internal business app. Now business wants to be able to attach a document to a row in the database that represents business entity. Document can be Word, Excel, PDF.

How can we do that?

I think creating yet another home grown document management system is not a good idea. Instead we can try to use an third party document management system and integrate tightly form our app. Ideally all user interface will stay within application, without going to an external system. Is sharepoint or documentum capable of doing it? What other options are there?

The application platform is Java/Websphere. We ave both Windows and Unix infrastructure available.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T18:09:44.047

我认为任何文档管理系统都可以满足您的要求。有一次，我们对 Sharepoint 做了类似的事情。系统公开了一个 API，允许您查询存储的文档。集成的具体方式取决于您寻求的解决方案。

选择时需要考虑当前系统构建的平台，因为不同的解决方案支持不同的集成技术。例如，如果您当前的系统使用 .NET，那么 Sharepoint 将很容易集成。

许多文档管理系统使用像 SQL 服务器这样的后端数据库，并且集成可以像从应用程序中查询后端数据库一样简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T18:45:22.277

这一切都取决于规模，文档管理系统通常本身就是野兽，需要自己的应用服务器和数据库，拥有大量复杂的 API，并且真的应该在专用机器上运行。

它们实际上是关于管理文档的生命周期（即工​​作流程）、角色和围绕这些文档的访问，以及按照明确定义的时间表处理文档。

如果您打算处理一些针对用户表单的单个文档，我建议您使用以下形式的表格

long : id long : form_id

与

斑点：形式

或者

Varchar(2) : form_path

与您的表格并行。除非您准备好接管您的项目，否则我会远离“文档管理系统”。我能提供的最好的缓解方法是添加一个

随便：document_id

到您的餐桌上，并使用开箱即用的文档管理系统安装

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T20:39:16.943

我同意其他评论者的观点，EDRMS 系统往往是怪物。

我已经将一个内部系统与一个主要的 EDRMS 产品集成在一起，如果我再次这样做，我会寻找以下内容：

1.  很好（并且准确地！）记录了 API，最好带有一些代码示例。
2.  相当大的用户群，最好也有一个体面的社区
3.  积极的支持——要么是一个非常活跃的开源项目，要么更可能是一家忠诚的公司。不要购买用户少或接近 EOL 的东西！

顺便说一句，这些东西让你进入了“企业”领域；有时你付出的越多，你得到的就越糟糕。

编辑：这里还有一个[类似的问题](https://stackoverflow.com/questions/211954/simple-document-repository)：Subversion 是一个流行的答案。

# c# - 如何判断我的应用程序是作为 32 位还是 64 位应用程序运行的？

> ID：266082
> 
> 赞同：70
> 
> 时间：2008-11-05T18:08:27.687
> 
> 标签：c#, 64-bit, 32-bit

如何判断我的应用程序（在 Visual Studio 2008 中编译为*Any CPU*）是作为 32 位还是 64 位应用程序运行的？

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2010-08-11T18:25:33.047

如果您使用的是[.NET](http://en.wikipedia.org/wiki/.NET_Framework) 4.0，那么它是当前流程的单线：

```
Environment.Is64BitProcess 
```

参考：*[Environment.Is64BitProcess 属性](http://msdn.microsoft.com/en-us/library/system.environment.is64bitprocess.aspx)*(MSDN)

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2008-12-29T13:09:51.077

```
if (IntPtr.Size == 8) 
{
    // 64 bit machine
} 
else if (IntPtr.Size == 4) 
{
    // 32 bit machine
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-05T18:09:05.593

[我从Martijn Boven](http://bytes.com/forum/thread525905.html)那里找到了这段代码，它可以解决问题：

```
public static bool Is64BitMode() {
    return System.Runtime.InteropServices.Marshal.SizeOf(typeof(IntPtr)) == 8;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-09-04T02:47:40.857

Microsoft All-In-One Code Framework 中的此代码示例可以回答您的问题：

[在C#中检测进程运行平台（CSPlatformDetector）](http://code.msdn.microsoft.com/CSPlatformDetector-e7a99806)

> CSPlatformDetector 代码示例演示了与平台检测相关的以下任务：
> 
> 1.  检测当前操作系统的名称。 *（例如“Microsoft Windows 7 Enterprise”）*
> 2.  检测当前操作系统的版本。 *（例如“Microsoft Windows NT 6.1.7600.0”）*
> 3.  判断当前操作系统是否为 64 位操作系统。
> 4.  判断当前进程是否为64位进程。
> 5.  确定系统上运行的任意进程是否为 64 位。

如果只想确定当前运行的进程是否为 64 位进程，可以使用 .NET Framework 4 中新增的[Environment.Is64BitProcess](http://msdn.microsoft.com/en-us/library/system.environment.is64bitprocess.aspx)属性。

而如果要检测系统上运行的任意应用程序是否为64位进程，则需要确定OS位数，如果是64位，`IsWow64Process()`则使用目标进程句柄调用：

```
static bool Is64BitProcess(IntPtr hProcess)
{
    bool flag = false;

    if (Environment.Is64BitOperatingSystem)
    {
        // On 64-bit OS, if a process is not running under Wow64 mode, 
        // the process must be a 64-bit process.
        flag = !(NativeMethods.IsWow64Process(hProcess, out flag) && flag);
    }

    return flag;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-08-10T15:00:29.253

在 .Net Standard 中，您可以使用`System.Runtime.InteropServices.RuntimeInformation.OSArchitecture`

# sql - SQL 2005 Analysis Services 安装问题

> ID：266091
> 
> 赞同：0
> 
> 时间：2008-11-05T18:11:20.410
> 
> 标签：sql, ssas, failed-installation

我在安装 SQL 2005 分析服务时收到此错误消息。

此安装所需的压缩文件“sql.cab”已损坏，无法使用。这可能表示网络错误、从 CD-ROM 读取错误或此软件包有问题。

我从 MSDN 下载的 ISO 文件安装。怎么可能少了些什么呢？搜索 .ISO 文件时，我注意到文件 SQL.cab 不存在。

以前有人解决过这个问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T11:36:27.733

是 64 位与 32 位的问题吗？我唯一能想到的。这个链接有一些关于不使用挂载的 ISO 映像作为虚拟 DVD [http://forums.microsoft.com/msdn/showpost.aspx?postid=351235&siteid=1的建议](http://forums.microsoft.com/msdn/showpost.aspx?postid=351235&siteid=1)

# asp.net-mvc - 为什么 ASP.NET MVC 上的控制器是基于名称的？

> ID：266106
> 
> 赞同：7
> 
> 时间：2008-11-05T18:17:05.920
> 
> 标签：asp.net-mvc, code-organization

在 ASP.NET MVC 中，我们需要为所有控制器使用后缀“Controller”。这似乎是不必要的限制 - 是否有技术原因？

我主要只是好奇，但可以看到更灵活的命名规则可以改善代码组织的情况。使用反射来搜索`Controller`派生类难道不能很容易地发现可能的控制器类吗？或者要求控制器类标有`ControllerAttribute`?

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-05T18:24:06.563

MVC 社区深受[Ruby on Rails](http://www.rubyonrails.org/)的影响，它重视“[约定优于配置](http://en.wikipedia.org/wiki/Convention_over_Configuration)”。通过一致地命名事物，应用程序可以以零配置运行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-06T00:55:10.953

这种约定的好处之一是 URL 段、控制器和模型类都具有相同的名称是很常见的。

URL：/product/ 控制器：产品：控制器型号：产品

这将导致命名冲突。所以我们约定了控制器名称后缀为“Controller”以避免这种冲突。但是，您可以通过我们的可扩展性 API 覆盖此行为。

# .net - HowTo：检测 .Net 配置节实例而不加载到内存中？

> ID：266108
> 
> 赞同：0
> 
> 时间：2008-11-05T18:17:20.383
> 
> 标签：.net, configuration, system.configuration

有谁知道如何检测.net 配置文件中是否存在配置部分的实例，而无需实际将配置部分加载到内存中，也不必手动解析 xml 文件 - 即使用 System.Configuration 命名空间。

我曾尝试使用 System.Configuration.ConfigurationManager.GetSection(...) 但这似乎返回了配置部分的“默认”实例，即使它在配置文件中不存在。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T09:28:08.303

如果您使用的是本地配置文件（而不是特定于机器），那么您可以使用 XML（例如 linq to xml）通过从反射中获取 exe 代码库来检查配置文件（例如 Assembly.GetExecutingAssembly().CodeBase）

# python - 在 OS X 上设置 Python Web 开发环境

> ID：266114
> 
> 赞同：2
> 
> 时间：2008-11-05T18:19:44.027
> 
> 标签：python, mysql, apache, macos

我正在运行[Mac OS X Leopard](http://en.wikipedia.org/wiki/Mac_OS_X_Leopard)，想知道在我的机器上设置 Web 开发环境以使用 Python、MySQL、Apache 的简单方法是什么，这将允许我在我的 Mac 上进行开发，然后轻松地将其移动到主机未来。

我一直在尝试安装 mod_wsgi 并将其配置为与 Django 一起使用，但现在很头疼。除了 Google 之外，目前有没有使用 mod_wsgi 的网络主机，所以我可以在那里开发？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T21:18:42.247

FWIW，我们发现 virtualenv [ [http://pypi.python.org/pypi/virtualenv]](http://pypi.python.org/pypi/virtualenv])是我们开发设置中非常宝贵的一部分。我们通常在使用不同版本的 Python 库等的多个项目上工作。如果没有像 virtualenv 那样提供本地化、定制的 Python 环境的方法，很难在一台机器上做到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T19:00:06.600

大多数 Python 应用程序正在远离 mod_python。它可能因框架或提供者而异，但大多数开发工作都在 mod_wsgi 上。

使用[WSGI](https://en.wikipedia.org/wiki/Web_Server_Gateway_Interface)标准将使您的 Python 应用程序服务器不可知，并允许其他不错的添加，如 WSGI 中间件。其他提供商可能只提供[CGI](http://en.wikipedia.org/wiki/Common_Gateway_Interface)（在性能方面无法很好地扩展）或[FastCGI](http://en.wikipedia.org/wiki/FastCGI)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T20:23:53.433

我只使用脚本中包含的服务器与[Django](http://en.wikipedia.org/wiki/Django_%28web_framework%29)`manager.py`合作，并且在迁移到生产环境时没有遇到任何问题。

如果您将应用程序放在为您进行环境配置的主机中（例如[WebFaction](https://www.webfaction.com/)），您应该不会遇到从开发到生产的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-09T03:54:34.150

我在我的 Mac 笔记本电脑上运行 Linux 虚拟机。这使我能够使我的开发环境和生产环境完美同步（并制作快照以便于实验/回滚）。我发现[VMWare Fusion](http://www.vmware.com/download/fusion/)效果最好，但如果您只是想了解一下，也有免费的开源替代品，例如[VirtualBox 。](http://www.virtualbox.org/wiki/Downloads)

我在我的 Mac 上共享来自来宾 Linux 操作系统的源文件夹，并使用我选择的 Mac 源代码编辑器对其进行编辑（我使用[Eclipse](http://en.wikipedia.org/wiki/Eclipse_%28software%29) / [PyDev](https://en.wikipedia.org/wiki/PyDev)，因为原本优秀的[TextMate](http://en.wikipedia.org/wiki/TextMate)还不能很好地处理中文文本）。[我在这里](http://wiki.slicehost.com/doku.php?id=dream_geodjango_server)记录了客户 Linux 操作系统的软件设置；它针对服务多个[Django](http://en.wikipedia.org/wiki/Django_%28web_framework%29)应用程序（包括 geodjango）进行了优化。

为了获得更多乐趣，您可以编辑 Mac 的 /etc/hosts 文件，使 yourdomainname.com 解析为您的来宾 Linux 机器内部 IP 地址，并以简单的方式在线或离线处理/测试多个 Web 项目，而无需太多麻烦。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T18:24:26.187

您正在寻找的是 Mod_Python。它是一个基于 Apache 的 Python 解释器。在这里查看：

[http://www.modpython.org/](http://www.modpython.org/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-05T19:35:59.227

[Google App Engine](http://code.google.com/appengine/)已经为您完成了。有一些限制，但效果很好，它为您提供了免费托管的途径。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-06T02:51:18.223

您可能想查看[web2py](http://www.web2py.com)。它包括一个通过浏览器开发的管理界面。一个包中所需的一切，包括[Python](http://en.wikipedia.org/wiki/Python_%28programming_language%29)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-09T00:13:13.410

看看[WebFaction——](http://www.webfaction.com)尽管我不使用它们（我也没有以任何方式与他们的业务相关/从他们的业务中获利）。我一遍又一遍地阅读他们的服务有多棒，尤其是他们对[Django](http://en.wikipedia.org/wiki/Django_%28web_framework%29)的友好程度。[在他们的论坛中](http://forum.webfaction.com/viewtopic.php?id=1119)有一篇关于如何使用 Django 和`mod_wsgi`.

和我之前在这个线程中的其他人一样，我强烈建议使用 Ian Bicking 的[virtualenv](http://pypi.python.org/pypi/virtualenv)来隔离您的开发环境；[文档](http://code.google.com/p/modwsgi/wiki/VirtualEnvironments)中有[专门的页面来`mod_wsgi`](http://code.google.com/p/modwsgi/wiki/VirtualEnvironments)进行这种设置。

我还敦促您查看[pip](http://pip.openplans.org/)，它基本上是一个更智能的 easy_install ，它了解 virtualenv。Pip 为 virtualenv 风格的开发做了两件非常好的事情：

*   知道如何从源代码控制安装（[SVN](http://en.wikipedia.org/wiki/Apache_Subversion)、[Git](http://en.wikipedia.org/wiki/Git_%28software%29)等...）
*   知道如何“冻结”现有开发环境的需求，以便您可以在其他地方创建该环境——非常适合多个开发人员或部署。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-09T01:48:17.347

`mod_wsgi`真的，真的很简单。

[Pyerweb](http://github.com/dbr/pyerweb/blob/070e354c1837e7d22a8bd5160d7f0897391bf382/pyerweb.py#L64)是我编写的一个非常简单的（约 90 行，包括注释/空格）符合 WSGI 的路由框架。基本上，WSGI API 只是一个被传递的函数`environ`，和`wsgi_start_response`，它返回一个字符串。

`envrion`是带有请求信息的字典，例如`environ['PATH_INFO']`是请求 URI）

`wsgi_start_response`这是一个可调用函数，您可以执行该函数来设置标题：

```
wsgi_start_response(output_response, output_headers) 
```

`output_response`是包含您希望发送的 HTTP 状态（`200 OK`等）的字符串，并且`output_headers`是包含您的标头的元组列表（例如，`[("Content-type", "text/html")]`将设置内容类型）

然后该函数返回一个包含您的输出的字符串。这就是它的全部内容！

要运行它，[`spawning`](http://pypi.python.org/pypi/Spawning/0.7)你可以使用它，`spawn scriptname.my_wsgi_function_nae`它会开始监听端口 8080。

要通过 mod_wsgi 使用它，它的文档很好，[http://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide](http://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide)并且有一个[django 特定部分](http://code.google.com/p/modwsgi/wiki/IntegrationWithDjango)

使用 mod_wsgi 的好处是它是为 Python Web 应用程序提供服务的标准。我最近决定使用 Google App Engine，当 Pyerweb（我在这个答案的开头链接到）*完美地*工作时，我感到很惊讶，完全是无意的。当我注意到 Django 应用程序也在其上运行时，我印象更深刻。标准化是一件好事！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-05T20:50:52.443

当然，Mac OS X，在最近的版本中，带有 Python 和 Apache。但是，您可能希望在您使用的版本中有更大的灵活性，或者您可能不喜欢 Apple 对它们的配置方式所做的调整。获得更通用的工具集（包括 MySQL）的一个好方法是重新安装它们。这将帮助您解决可移植性问题。使用这些开源包提供程序之一可以相对轻松地安装这些框架。

*   [芬克](http://www.finkproject.org/)
*   [MacPorts](http://www.macports.org/)
*   [MAMP](http://sourceforge.net/projects/mamp)

# c# - 将实例化的 System.Type 作为泛型类的类型参数传递

> ID：266115
> 
> 赞同：205
> 
> 时间：2008-11-05T18:19:51.687
> 
> 标签：c#, .net, generics

标题有点晦涩。我想知道的是这是否可能：

```
string typeName = <read type name from somwhere>;
Type myType = Type.GetType(typeName);

MyGenericClass<myType> myGenericClass = new MyGenericClass<myType>(); 
```

显然，MyGenericClass 被描述为：

```
public class MyGenericClass<T> 
```

现在，编译器抱怨“找不到类型或命名空间‘myType’。”必须有办法做到这一点。

* * *

## 回答 #1

> 赞同：240
> 
> 时间：2008-11-05T19:30:52.807

没有反思就无法做到这一点。但是，您*可以*通过反射来做到这一点。这是一个完整的例子：

```
using System;
using System.Reflection;

public class Generic<T>
{
    public Generic()
    {
        Console.WriteLine("T={0}", typeof(T));
    }
}

class Test
{
    static void Main()
    {
        string typeName = "System.String";
        Type typeArgument = Type.GetType(typeName);

        Type genericClass = typeof(Generic<>);
        // MakeGenericType is badly named
        Type constructedClass = genericClass.MakeGenericType(typeArgument);

        object created = Activator.CreateInstance(constructedClass);
    }
} 
```

注意：如果您的泛型类接受多种类型，则在省略类型名称时必须包含逗号，例如：

```
Type genericClass = typeof(IReadOnlyDictionary<,>);
Type constructedClass = genericClass.MakeGenericType(typeArgument1, typeArgument2); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-05T18:23:27.390

不幸的是，没有。泛型参数必须在编译时可解析为 1) 有效类型或 2) 另一个泛型参数。如果没有使用反射的大锤子，就无法根据运行时值创建通用实例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-10-14T19:10:30.730

一些额外的如何使用剪刀代码运行。假设你有一个类似于

```
public class Encoder() {
public void Markdown(IEnumerable<FooContent> contents) { do magic }
public void Markdown(IEnumerable<BarContent> contents) { do magic2 }
} 
```

假设在运行时你有一个**FooContent**

*如果*您能够在编译时绑定，您会想要

```
var fooContents = new List<FooContent>(fooContent)
new Encoder().Markdown(fooContents) 
```

*但是*，您不能在运行时执行此操作。要在运行时执行此操作，您可以执行以下操作：

```
var listType = typeof(List<>).MakeGenericType(myType);
var dynamicList = Activator.CreateInstance(listType);
((IList)dynamicList).Add(fooContent); 
```

动态调用`Markdown(IEnumerable<FooContent> contents)`

```
new Encoder().Markdown( (dynamic) dynamicList) 
```

注意`dynamic`方法调用中的用法。在运行时`dynamicList`将是`List<FooContent>`（另外也是`IEnumerable<FooContent>`），因为即使动态的使用仍然植根于强类型语言，运行时绑定器将选择适当的`Markdown`方法。如果没有精确的类型匹配，它将查找对象参数方法，如果两者都不匹配，则会引发运行时绑定程序异常，提醒没有方法匹配。

这种方法的明显缺点是编译时类型安全性的巨大损失。然而，沿着这些行的代码将让您在非常动态的意义上进行操作，在运行时仍然是完全类型化的，就像您期望的那样。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-06-13T00:48:38.297

我的要求略有不同，但希望能对某人有所帮助。我需要从配置中读取类型并动态实例化泛型类型。

```
namespace GenericTest
{
    public class Item
    {
    }
}

namespace GenericTest
{
    public class GenericClass<T>
    {
    }
} 
```

最后，这是你如何称呼它的。[用反引号定义类型](https://msdn.microsoft.com/en-us/library/w3f99sx1(v=vs.110).aspx)。

```
var t = Type.GetType("GenericTest.GenericClass`1[[GenericTest.Item, GenericTest]], GenericTest");
var a = Activator.CreateInstance(t); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-12-28T16:55:48.450

如果您知道将传递哪些类型，则无需反射即可执行此操作。switch 语句将起作用。显然，这只适用于有限数量的情况，但它会比反射快得多。

```
public class Type1 { }

public class Type2 { }

public class Generic<T> { }

public class Program
{
    public static void Main()
    {
        var typeName = nameof(Type1);

        switch (typeName)
        {
            case nameof(Type1):
                var type1 = new Generic<Type1>();
                // do something
                break;
            case nameof(Type2):
                var type2 = new Generic<Type2>();
                // do something
                break;
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-06-13T19:47:31.473

在这个片段中，我想展示如何创建和使用动态创建的列表。例如，我在这里添加到动态列表。

```
void AddValue<T>(object targetList, T valueToAdd)
{
    var addMethod = targetList.GetType().GetMethod("Add");
    addMethod.Invoke(targetList, new[] { valueToAdd } as object[]);
}

var listType = typeof(List<>).MakeGenericType(new[] { dynamicType }); // dynamicType is the type you want
var list = Activator.CreateInstance(listType);

AddValue(list, 5); 
```

同样，您可以调用列表中的任何其他方法。

# c# - 如何以编程方式获取 .Net WinForms 控件的屏幕截图？

> ID：266116
> 
> 赞同：32
> 
> 时间：2008-11-05T18:20:10.300
> 
> 标签：c#, .net, image, winforms, capture

您如何以编程方式获取 .Net 控件的图片？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-11-05T18:27:34.777

每个控件都有一个名为[DrawToBitmap](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.drawtobitmap.aspx)的方法。您不需要 p/invoke 来执行此操作。

```
Control c = new TextBox();
System.Drawing.Bitmap bmp = new System.Drawing.Bitmap(c.Width, c.Height);
c.DrawToBitmap(bmp, c.ClientRectangle); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-05T18:29:54.070

您可以使用从 .NET 2.0 开始的 Control 类的***DrawToBitmap方法以编程方式轻松获取 .NET 控件的图片***

这是VB中的示例

```
 Dim formImage As New Bitmap("C:\File.bmp")
    Me.DrawToBitmap(formImage, Me.Bounds) 
```

这是在 C# 中：

```
 Bitmap formImage = New Bitmap("C:\File.bmp")
 this.DrawToBitmap(formImage, this.Bounds) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-05T18:39:58.403

[Control.DrawToBitmap](https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.control.drawtobitmap)将让您将大多数控件绘制到位图。这不适用于 RichTextBox 和其他一些。

如果要捕获这些或具有其中之一的控件，则需要像此 CodeProject 文章中所述执行 PInvoke：[图像捕获](http://www.codeproject.com/KB/graphics/imagecapture.aspx)

请注意，其中一些方法将捕获屏幕上的任何内容，因此如果您有另一个窗口覆盖您的控件，您将得到它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-05T18:28:09.907

对于支持它的 WinForms 控件，System.Windows.Forms.Control 类中有一个方法：

```
public void DrawToBitmap(Bitmap bitmap, Rectangle targetBounds); 
```

但是，这不适用于所有控件。第三方组件供应商有更全面的解决方案。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-05-06T23:25:39.720

这是对整个客户端进行操作的方法`Form`，而不仅仅是客户端区域（没有标题栏和其他修饰）

```
 Rectangle r = this.Bounds;
        r.Offset(-r.X,-r.Y);
        Bitmap bitmap = new Bitmap(r.Width,r.Height);
        this.DrawToBitmap(bitmap, r);
        Clipboard.SetImage(bitmap); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-05T18:36:28.940

如果它不在您要执行的控件上，您通常可以将其转换为基本 Control 类并在那里调用 DrawToBitmap 方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-06-09T13:37:44.690

```
Panel1.Dock = DockStyle.None ' If Panel Dockstyle is in Fill mode
Panel1.Width = 5000  ' Original Size without scrollbar
Panel1.Height = 5000 ' Original Size without scrollbar

Dim bmp As New Bitmap(Me.Panel1.Width, Me.Panel1.Height)
Me.Panel1.DrawToBitmap(bmp, New Rectangle(0, 0, Me.Panel1.Width, Me.Panel1.Height))
'Me.Panel1.DrawToBitmap(bmp, Panel1.ClientRectangle)
bmp.Save("C:\panel.jpg", System.Drawing.Imaging.ImageFormat.Jpeg)

Panel1.Dock = DockStyle.Fill 
```

**注意：**它工作正常

# c - 是否有可以同时处理 C 和 Perl 的 Windows IDE？

> ID：266121
> 
> 赞同：7
> 
> 时间：2008-11-05T18:21:34.743
> 
> 标签：c, windows, perl, svn, ide

我正在使用包含 MinGW 的 GCC 的 Strawberry Perl，我还使用了 GNU 调试器 GDB 和 Subversion。我怎样才能有一个适合这个的单一开发环境（除了 UltraEdit、命令 shell 和 IE），我怎样才能进一步增强它的功能？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-05T18:32:46.543

如果我是你，我会好好看看[Eclipse](http://www.eclipse.org/)！然后看看[EPIC](http://www.epic-ide.org/) IDE 插件。

[Subversion 通过Tortoise SVN](http://tortoisesvn.tigris.org/)很好地与该 IDE 集成，甚至更好，正如 Davide Gualano 在[Subversive](http://www.polarion.org/index.php?page=overview&project=subversive)的评论之一中提到的那样。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-05T18:23:28.733

我个人使用 ActiveState 的 Komodo IDE。Komodo Edit 可能适合您的需求，是它的免费替代品。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-05T18:41:33.203

您可以在 Windows 上使用 emacs。

[http://www.gnu.org/software/emacs/windows/ntemacs.html](http://www.gnu.org/software/emacs/windows/ntemacs.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-05T18:37:56.910

msvc 6 会很好地完成这项工作。

我的 perl 安装在 c:\perl\bin 所以...

在自定义菜单下，创建一个新工具。

命令**c:\perl\bin\perl.exe**
参数 **-w $(FileName)$(FileExt)**
初始目录**$(FileDir)**

检查使用输出窗口。

在工具栏上创建一个按钮以运行该工具。perl 输出将出现在输出窗口中。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-06T17:31:07.293

你试过记事本++吗？它主要是一个“全力以赴”的文本编辑器，为您能想到的每种语言提供代码突出显示。但是，它确实有一个非常了不起的宏/外部命令/扩展的东西，所以将它连接到编译器是很容易的。

我目前将它用于 C、Inform、Python、Perl、HTML 和 VB.Net，在换档时几乎没有问题。

还有，自由源码软件。

（而且，我刚刚发现它也有代码完成功能。太棒了！）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-06T06:11:39.630

我绝对不是 Windows 开发人员或 IDE 用户，但是当我必须在 Windows 上工作时，Cygwin（适用于所有方便的 Unix 工具和更好的 shell）和 emacs 的组合可以完成这项工作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-05T19:33:45.610

就个人而言，我很高兴在 Windows 上使用[SciTE](http://www.scintilla.org/SciTE.html)进行 C、C++、Perl 和 Python 开发。使用单一工具对我来说有很多好处——成为它的专家可以提高我在所有语言中的工作效率。SciTE 有一个内置的脚本语言，也很容易将它与外部脚本结合起来，因此它的扩展性超乎想象——而且使用相当标准的工具。

# apache-flex - Flex - 有没有办法指定 ComboBox 打开的方向？

> ID：266123
> 
> 赞同：0
> 
> 时间：2008-11-05T18:22:03.993
> 
> 标签：apache-flex, actionscript-3, combobox

也许我应该进一步限定这一点 - 有没有办法指定 ComboBox 将打开哪个方向而不复制和粘贴整个 ComboBox 类并撕掉它确定它将在哪个方向打开的代码......

我是我的具体情况——我需要它向上打开——总是。

更新：你不能通过继承它来解决这个问题，因为处理开口方向的函数是：

```
private function displayDropdown(show:Boolean, trigger:Event = null):void 
```

那个坏男孩使用了大量我的子类无法访问的私有变量......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-06T14:42:14.357

如果您自己构建 Menu 对象，您可以通过简单地设置菜单对象的 x,y 坐标将菜单放置在您想要的任何位置。您需要计算这些坐标，但您可能无需子类化 ComboBox 即可轻松完成此操作。

我正在用 PopUpButton 做类似的事情；您可能会发现使用 PopUpButton 更容易。这是基于我当前项目的真实代码：

```
private function initMenu(): void {
    var m:Menu = new Menu();
    m.dataProvider = theMenuData;
    m.addEventListener(MenuEvent.ITEM_CLICK, menuClick);
    m.showRoot = false;
    // m.x = ... <-- probably don't need to tweak this.
    // m.y = ... <-- this is really the interesting one :-)
    theMenu.popUp = m;
}
<mx:PopUpButton id="theMenu" creationComplete="initMenu()" ... /> 
```

顺便说一句，为了让 PopUpButton 的行为更像我想要的那样（总是弹出，无论在哪里点击），在 MXML 中设置 openAlways=true 就像一个魅力。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T18:51:30.780

我对此表示怀疑-您需要对控件进行子类化（这没什么*大不了*的。）

也许你可以把房地产弄乱，所以它被放置在这样一种时尚（例如挤在右下角），自然会强制向上？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T19:29:14.870

我建议查看[这篇文章](http://www.typeoneerror.com/forcing-combobox-component-open-direction-in-flex/)。是的，您确实必须获取 ComboBox 代码并对其进行修改，但至少现在您知道需要修改的地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T13:51:50.870

你可以设置 MaxDropDownHeight，如果你设置的足够大，Windows 会自动设置向上的方向。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-02T20:33:21.020

这让我恼火不已。我上传了一个解决方案，它是一个简单的类，它扩展了 PopUpButton 并删除了舞台边界检测的逻辑，因为无论如何它有 50% 的时间都失败了。我的代码只允许您简单地指定是要向上还是向下打开菜单：

[http://gist.github.com/505255](http://gist.github.com/505255)

# uml - 用例与参与者的关系

> ID：266166
> 
> 赞同：1
> 
> 时间：2008-11-05T18:36:56.957
> 
> 标签：uml, actor, use-case

如果 A 是扩展用例（不是基本用例），A 可以直接被参与者引用吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-09T20:23:01.987

YES 用户可以如上所述，但不间接引用/使用它，必须显式建模。

驱动卡车扩展了基于驱动转向的车辆。Actor 可以引用其中任何一个是有道理的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T19:52:47.430

您可以证明有两种用例：

*   抽象——不是演员直接体验的，而是扩展（“子类”）。

*   具体——演员所经历的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-06T02:51:30.750

是的; A 扩展了其他一些用例的事实并没有对参与者“隐藏”它

# c++ - C++中线程的简单示例

> ID：266168
> 
> 赞同：390
> 
> 时间：2008-11-05T18:37:15.507
> 
> 标签：c++, multithreading

有人可以发布一个在 C++ 中启动两个（面向对象）线程的简单示例。

我正在寻找实际的 C++ 线程对象，我可以在其上扩展运行方法（或类似的东西），而不是调用 C 风格的线程库。

我省略了任何特定于操作系统的请求，希望回复的人会回复跨平台库以供使用。我现在只是明确表示。

* * *

## 回答 #1

> 赞同：650
> 
> 时间：2012-06-27T15:31:22.487

创建一个您希望线程执行的函数，例如：

```
void task1(std::string msg)
{
    std::cout << "task1 says: " << msg;
} 
```

现在创建`thread`最终将调用上述函数的对象，如下所示：

```
std::thread t1(task1, "Hello"); 
```

（您需要`#include <thread>`访问该`std::thread`课程）

构造函数的参数是线程将执行的函数，然后是函数的参数。线程在构造时自动启动。

如果稍后您想等待线程完成执行该函数，请调用：

```
t1.join(); 
```

（加入意味着调用新线程的线程将等待新线程完成执行，然后再继续自己的执行）。

* * *

## 编码

```
#include <string>
#include <iostream>
#include <thread>

using namespace std;

// The function we want to execute on the new thread.
void task1(string msg)
{
    cout << "task1 says: " << msg;
}

int main()
{
    // Constructs the new thread and runs it. Does not block execution.
    thread t1(task1, "Hello");

    // Do other things...

    // Makes the main thread wait for the new thread to finish execution, therefore blocks its own execution.
    t1.join();
} 
```

[有关 std::thread 的更多信息在这里](http://en.cppreference.com/w/cpp/thread/thread)

*   *在 GCC 上，使用`-std=c++0x -pthread`.*
*   *这应该适用于任何操作系统，前提是您的编译器支持此 (C++11) 功能。*

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2008-11-05T18:55:26.890

好吧，从技术上讲，任何此类对象最终都将在 C 风格的线程库上构建，因为 C++ 仅[`std::thread`](http://en.cppreference.com/w/cpp/thread/thread)在 c++0x 中指定了一个库存模型，该模型刚刚确定并且尚未实现。这个问题在某种程度上是系统性的，从技术上讲，现有的 c++ 内存模型不够严格，无法为所有“发生在之前”的情况下定义明确的语义。Hans Boehm 不久前写了一篇关于该主题的论文，并在制定有关该主题的 c++0x 标准方面发挥了重要作用。

[http://www.hpl.hp.com/techreports/2004/HPL-2004-209.html](http://www.hpl.hp.com/techreports/2004/HPL-2004-209.html)

也就是说，有几个跨平台线程 C++ 库在实践中工作得很好。英特尔线程构建块包含一个非常接近 c++0x 标准的 tbb::thread 对象，而 Boost 有一个执行相同操作的 boost::thread 库。

[http://www.threadingbuildingblocks.org/](http://www.threadingbuildingblocks.org/)

[http://www.boost.org/doc/libs/1_37_0/doc/html/thread.html](http://www.boost.org/doc/libs/1_37_0/doc/html/thread.html)

使用 boost::thread 你会得到类似的东西：

```
#include <boost/thread.hpp>

void task1() { 
    // do stuff
}

void task2() { 
    // do stuff
}

int main (int argc, char ** argv) {
    using namespace boost; 
    thread thread_1 = thread(task1);
    thread thread_2 = thread(task2);

    // do other stuff
    thread_2.join();
    thread_1.join();
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2017-06-09T07:59:06.763

```
#include <thread>
#include <iostream>
#include <vector>
using namespace std;

void doSomething(int id) {
    cout << id << "\n";
}

/**
 * Spawns n threads
 */
void spawnThreads(int n)
{
    std::vector<thread> threads(n);
    // spawn n threads:
    for (int i = 0; i < n; i++) {
        threads[i] = thread(doSomething, i + 1);
    }

    for (auto& th : threads) {
        th.join();
    }
}

int main()
{
    spawnThreads(10);
} 
```

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2013-04-18T19:07:27.397

还有一个用于 POSIX 操作系统的 POSIX 库。 [检查](http://en.wikipedia.org/wiki/POSIX)兼容性

```
#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <iostream>

void *task(void *argument){
      char* msg;
      msg = (char*)argument;
      std::cout<<msg<<std::endl;
}

int main(){
    pthread_t thread1, thread2;
    int i1,i2;
    i1 = pthread_create( &thread1, NULL, task, (void*) "thread 1");
    i2 = pthread_create( &thread2, NULL, task, (void*) "thread 2");

    pthread_join(thread1,NULL);
    pthread_join(thread2,NULL);
    return 0;

} 
```

使用 -lpthread 编译

[http://en.wikipedia.org/wiki/POSIX_Threads](http://en.wikipedia.org/wiki/POSIX_Threads)

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2017-09-18T18:51:17.033

在搜索在新线程中调用其自己的实例方法之一的 C++ 类的示例时，会出现这个问题，但我们无法以这种方式使用这些答案中的任何一个。这是一个这样做的例子：

类.h

```
class DataManager
{
public:
    bool hasData;
    void getData();
    bool dataAvailable();
}; 
```

类.cpp

```
#include "DataManager.h"

void DataManager::getData()
{
    // perform background data munging
    hasData = true;
    // be sure to notify on the main thread
}

bool DataManager::dataAvailable()
{
    if (hasData)
    {
        return true;
    }
    else
    {
        std::thread t(&DataManager::getData, this);
        t.detach(); // as opposed to .join, which runs on the current thread
    }
} 
```

请注意，此示例不涉及互斥锁或锁定。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2017-11-08T04:26:49.183

除非想要在全局命名空间中使用单独的函数，否则我们可以使用 lambda 函数来创建线程。

使用 lambda 创建线程的主要优点之一是我们不需要将本地参数作为参数列表传递。我们可以使用捕获列表，而 lambda 的闭包属性将负责生命周期。

这是一个示例代码

```
int main() {
    int localVariable = 100;

    thread th { [=](){
        cout<<"The Value of local variable => "<<localVariable<<endl;
    }};

    th.join();

    return 0;
} 
```

到目前为止，我发现 C++ lambdas 是创建线程的最佳方式，尤其是对于更简单的线程函数

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-11-05T18:42:42.563

这在很大程度上取决于您决定使用的库。例如，如果您使用 wxWidgets 库，线程的创建将如下所示：

```
class RThread : public wxThread {

public:
    RThread()
        : wxThread(wxTHREAD_JOINABLE){
    }
private:
    RThread(const RThread &copy);

public:
    void *Entry(void){
        //Do...

        return 0;
    }

};

wxThread *CreateThread() {
    //Create thread
    wxThread *_hThread = new RThread();

    //Start thread
    _hThread->Create();
    _hThread->Run();

    return _hThread;
} 
```

如果您的主线程调用 CreateThread 方法，您将创建一个新线程，该线程将开始执行“Entry”方法中的代码。在大多数情况下，您必须保留对线程的引用才能加入或停止它。更多信息：[wxThread 文档](http://docs.wxwidgets.org/stable/wx_wxthread.html#wxthread)

# web-services - 哪些 Web 服务规范 (WS-*) 真正有意义？

> ID：266172
> 
> 赞同：1
> 
> 时间：2008-11-05T18:38:56.890
> 
> 标签：web-services, architecture, standards, soa

我正在一家大公司实施 SOA，但我不确定实施哪些 Web 服务规范 (WS-*) 真正有意义。至少，我正在研究 WS-Addressing、WS-Security、WS-Eventing 和 WS-ReliableMessaging。但是，还有[其他几个](http://www-128.ibm.com/developerworks/webservices/standards/)看起来很有趣的标准，但我不知道哪些标准被广泛采用。如果标准不成熟或没有必要，我不想实施标准（并强迫所有开发人员遵循它们）。

编辑：

我问这个问题不是针对特定情况，而是总体而言。有相当多的 WS-* 标准似乎没有太多实际用途（至少对我而言），所以我真的很好奇哪些标准被广泛使用。

谢谢你的帮助！

K A

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T19:50:55.967

WS-Adressing 被广泛使用，而且非常有用。对于 WS-Security，请考虑您需要的一组机制（基于您的使用场景）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-06T17:25:43.963

只有 SOAP 被广泛采用。如果您关心覆盖范围，那么超越 WS-Security 和 WS-Addressing 就是自找麻烦（甚至 WS-Security 对很多人来说都很难）。如果您正在为一家大公司的内部使用创建服务，那么我不会那么担心。WCF 之类的东西将允许您为各种消费者提供具有不同绑定的端点，而无需编写任何额外的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T20:26:32.260

有两种类型的 Web 服务：REST 和 SOAP。它们代表了通过 Internet 发送数据的不同协议。

SOA 是面向服务架构的首字母缩写词。这是一种使用多个层（应用程序）在另一个之上构建系统的方法。Web 服务，主要是基于soap 的用于实现这种架构，但它们不是唯一的方式。

# flash - MovieClip.getChildByName() 的 AS2 版本？

> ID：266184
> 
> 赞同：0
> 
> 时间：2008-11-05T18:43:26.460
> 
> 标签：flash, actionscript, actionscript-2

我试图在这个小 Flash 8/AS2 项目中对我的“DOM”引用负责。

越来越令人沮丧的是获得对其他影片剪辑和对象的引用。例如，目前我访问表单提交按钮的代码看起来像这样

```
var b:Button = _level0.instance4.submitBtn; 
```

我希望 AS2 有一种类似于 AS3`MovieClip.getChildByName()`甚至 Javascript 的实例检索方法`document.getElementById()`。因为硬编码这些匿名实例的名称（就像`instance4`上面一样）感觉真的很脏。

[但是，我在这个 AS2 Reference](http://flash-reference.icod.de/)中找不到任何类似的东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T20:49:08.297

如果在 Flash IDE 中将 MovieClip 放置在舞台上，您可以在属性面板中为其指定适当的实例名称。

如果它是动态添加的，你也可以给它一个名字，并额外存储一个引用：

```
var my_MC=createEmptyMovieClip("instanceName", depth); 
```

在任何一种情况下，您都可以使用`_parentClip.instanceName`或`my_MC.`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T04:20:32.927

有几种方法可以做到这一点。最简单的方法是使用数组表示法。您之前的示例，如下所示：

```
var b:Button = _root.instance4.submitBtn; 
```

在数组表示法中看起来像这样：

```
var b:Button = _root["instance4"].submitBtn; 
```

因此，如果您想遍历已创建的 100 个按钮并将 alpha 设置为 0：

```
for( var i:Number = 0; i < 101; i++)
{
     var button:Button = _root["instance"+i].submitBtn;
     button._alpha = 0;
} 
```

您也可以使用 eval("instance4") 来做同样的事情，但我对所涉及的范围界定问题有点模糊。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T22:08:27.997

您可以自己编写（代码未经测试，但您明白了）：

```
MovieClip.prototype.getElementByName = function(name : String) : Object
{
    var s : String;
    var mc : Movieclip = null;

    for( s in this )
    {
        if( this[s] instanceof MovieClip )
        {
            if( s == name )
            {
                mc = this[ s ];
                break;
            }

            mc = this[s].getElementByName( name );
        }
    }

    return( mc );
} 
```

# security - 成员角色授权的 Web.config 编辑

> ID：266188
> 
> 赞同：3
> 
> 时间：2008-11-05T18:44:38.423
> 
> 标签：security, asp.net-membership, web-config, roles

我想通过 web.config 文件中的授权部分来使用基于角色的安全性。

使用 Membership，我的应用程序将允许创建新角色，因此，他们可以访问的页面需要动态设置。

我可以以编程方式更改 web.config 中的这一部分来管理它吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T22:31:35.347

```
using System.Configuration;
using System.Web.Configuration;

Configuration config = WebConfigurationManager.OpenWebConfiguration(Request.ApplicationPath);
AuthorizationSection section = (AuthorizationSection)config.GetSection("system.web/authorization");

AuthorizationRule rule = new AuthorizationRule(AuthorizationRuleAction.Allow);
rule.Roles.Add("admins");
section.Rules.Add(rule);

config.Save(); 
```

```
Imports System.Configuration
Imports System.Web.Configuration

Dim config As Configuration = WebConfigurationManager.OpenWebConfiguration(Request.ApplicationPath)
Dim section As AuthorizationSection = CType(config.GetSection("system.web/authorization"), AuthorizationSection)

Dim rule As New AuthorizationRule(AuthorizationRuleAction.Allow)
rule.Roles.Add("admins")
section.Rules.Add(rule)

config.Save() 
```

ASP.NET 需要 web.config 写入权限才能工作，所以要小心。

# .net - .NET - 用户和不同的数据库

> ID：266196
> 
> 赞同：3
> 
> 时间：2008-11-05T18:53:08.190
> 
> 标签：.net, asp.net, database, configuration

我正在考虑让某些用户访问一个数据库，而其他用户根据他们所属的公司访问另一个数据库。处理连接字符串并确保用户在登录时连接到正确的数据库的最佳方法是什么？

感谢您的任何想法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-05T19:07:53.383

在 Web.Config 或 App.Config 中

```
<connectionStrings>
  <add name="ConnectionForDudes" providerName="System.Data.SqlClient"
      connectionString="Data Source=___MALECONNECTIONHERE___"/>
  <add name="ConnectionForChicks" providerName="System.Data.SqlClient"
      connectionString="Data Source=___FEMALECONNECTIONHERE___"/>
</connectionStrings> 
```

当需要打开数据库时，您可以通过以下方式获取连接字符串：

```
bool UserIsMale = true;
string ConnectionStringName = "ConnectionFor" + UserIsMale ? "Dudes" : "Chicks";
string ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings[ConnectionStringName].ConnectionString; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-05T19:00:51.933

我会使用动态连接字符串生成器和将用户帐户映射到其他数据库的主数据库。

我不会存储所有这些连接字符串，而是使用我的连接字符串构建器方法根据来自主服务器的信息根据需要创建连接。我还会使用 Windows 身份验证，以避免在数据库中存储密码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-05T19:00:00.670

有一个存储每个用户的连接信息的数据库表。也许像[提供者模型](http://msdn.microsoft.com/en-us/library/aa479030.aspx)这样的东西会有用？

# javascript - 原型点击，鼠标悬停和鼠标悬停不能一起工作？

> ID：266199
> 
> 赞同：5
> 
> 时间：2008-11-05T18:55:36.500
> 
> 标签：javascript, prototypejs, mouseevent

我正在尝试做一个非常简单的按钮，它可以根据鼠标悬停、鼠标悬停和单击更改颜色，我在原型中这样做，奇怪的是如果我使用鼠标悬停和鼠标悬停，在我单击按钮后，按钮会'不变成白色，似乎是因为鼠标悬停，这是我的代码

```
$("izzy").observe('mouseover', function() {
     $('izzy').setStyle({ color: '#FFFFFF' });
});

$("izzy").observe('mouseout', function() {
     $('izzy').setStyle({ color: '#666666' });
});

$("izzy").observe('click', function() {
     $('izzy').setStyle({ color: '#FFFFFF' });
}); 
```

我该如何解决？谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-05T19:08:13.167

除非在鼠标上下移动时发生其他事情，否则为什么不使用 css 呢？

```
#izzy:hover { color: '#FFFFFF'; } 
```

但是，我对您到底想要发生什么感到有些困惑。假设您希望按钮被单击或鼠标悬停在其上方时为白色。我会让 click 事件处理程序添加一个 clicked 类，如下所示：

```
$("izzy").observe('click', function() {
    $('izzy').addClass('selected');
}); 
```

和CSS一样

```
#izzy { color: '#666666'; }
#izzy:hover, #izzy.selected { color: '#FFFFFF'; } 
```

这具有将状态（单击/未单击和鼠标悬停/未悬停）与样式（黑色或灰色）分开的优点。现在它们都混在一起了，造成混乱并让自己面对错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T19:06:56.727

您的意思是您希望鼠标单击会导致样式发生永久性变化，而不会被 mouseout 取代？如果是这样，请尝试使用标志，如下所示：

```
var wasClicked = false;

$("izzy").observe('mouseover', function() {
    if (!wasClicked) $('izzy').setStyle({ color: '#FFFFFF' });
});

$("izzy").observe('mouseout', function() {
    if (!wasClicked) $('izzy').setStyle({ color: '#666666' });
});

$("izzy").observe('click', function() {
    $('izzy').setStyle({ color: '#FFFFFF' });
    wasClicked = true;
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T19:01:20.560

如果单击后将光标从按钮上移开，则最后一个事件是 mouseout，因此无论是否单击都会发生。

如果您想在单击时避免 mouseout 效果，请尝试在单击时设置一个标志，如果设置了该标志，则中止 mouseout 事件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T19:07:59.203

设置状态以防止其他事件：

```
var clicked = false
$("izzy").observe('mouseover', function() {
     if(!clicked) {
        $('izzy').setStyle({ color: '#FFFFFF' });
     }
});

$("izzy").observe('mouseout', function() {
     if(!clicked) {
        $('izzy').setStyle({ color: '#666666' });
     }
});

$("izzy").observe('click', function() {
    clicked = true
    $('izzy').setStyle({ color: '#cccccc' });
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-04T20:48:51.840

使用 CSS 进行悬停和选定的类为元素着色可能是最佳选择。但是，如果您只是想快速修复已有的代码，您可以在单击 mouseout 事件后停止观察它。

```
$("izzy").observe('click', function(e) {
     e.element().setStyle({ color: '#FFFFFF' });
     e.element().stopObserving('mouseout');
}); 
```

# iis-6 - 如何以编程方式在 iis 6 中禁用 Etags

> ID：266201
> 
> 赞同：6
> 
> 时间：2008-11-05T18:56:36.373
> 
> 标签：iis-6, metadata, static-files

我正在尝试在 iis 6 上关闭 Etags，因为我正在对多个服务器进行负载平衡，我不希望 etag 成为问题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-05T19:08:02.760

我不认为您实际上将它们关闭，但您可以设置该值。转到默认网站属性，HTTP 标头选项卡。然后添加一个名为“Etag”且值为“”（两个双引号）的自定义 HTTP 标头。

那么你的 Yslow 分数就会提高。=)

我相信在您的情况下要做的事情是将场中的所有服务器设置为使用相同的 Etag 值。这将允许在场中的所有服务器上正确识别内容。

# build-automation - 如何使用 nmake 组织 C++ 项目的项目树？

> ID：266202
> 
> 赞同：17
> 
> 时间：2008-11-05T18:56:59.490
> 
> 标签：build-automation, project-organization, nmake

## 组织项目文件似乎有两个主要约定，然后是许多变体。

**约定一：高级类型目录、项目子目录**

例如，[wxWidgets](http://svn.wxwidgets.org/svn/wx/wxWidgets/trunk/)项目使用这种风格：

```
/solution
   /bin
      /prj1
      /prj2
   /include
      /prj1
      /prj2
   /lib
      /prj1
      /prj2
   /src
      /prj1
      /prj2
   /test
      /prj1
      /prj2 
```

**优点：**

*   如果存在项目依赖项，则可以从单个文件进行管理
*   平面构建文件结构

**缺点：**

*   由于 test 有自己的头文件和 cpp 文件，当您为 EXE 文件而不是库生成单元测试应用程序时，它们需要包含您正在测试的应用程序中的[目标文件](https://en.wikipedia.org/wiki/Object_file)。这需要您创建推理规则并扩展所有源文件的相对路径。
*   在另一个解决方案中重用任何项目需要您从树结构中提取正确的文件并修改任何构建脚本

**约定2：高级项目目录，类型子目录**

例如，[Wireshark](http://anonsvn.wireshark.org/wireshark/trunk/)项目使用这种风格

```
/solution
   /prj1
      /bin
      /include
      /lib
      /src
      /test
   /prj2
      /bin
      /include
      /lib
      /src
      /test 
```

**优点：**

*   项目本身在其文件夹中是独立的，使它们更易于移动和重用
*   允许在构建工具中使用更短的推理规则
*   促进分层构建脚本

**缺点：**

*   如果项目之间存在依赖关系，则需要在项目目录之上额外增加一层构建脚本来管理构建顺序

我们目前在我们的项目中使用约定 1，到目前为止它运行良好。现在，我正在添加单元测试（通过 CxxTest）并促进使用[nmake](https://en.wikipedia.org/wiki/Make_%28software%29#Modern_versions)迁移到持续集成，约定 1 在创建正确的 nmake 文件时引起了一些严重的麻烦。

## 我的主要要求/目标是：

*   减少维护整个解决方案的构建脚本的工作量。

*   将解决方案中的项目及其构建步骤与其他项目分离。

*   通过使用用于签出的构建脚本来促进持续集成，以发布每次提交的媒体生成（显然也利用其他工具，例如 CruiseControl）。

*   使添加或删除其他项目或源文件对开发人员来说尽可能容易且不易出错。

## 所以我问：

*   这两种方法还有其他优点和缺点吗？
*   是否有明确的规定只支持其中一种约定？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-06T07:53:28.317

[部分答案。]

在“约定 2：高级项目目录，键入子目录”中，您的单一骗局是

> 如果项目之间存在依赖关系，则需要在项目目录之上额外增加一层构建脚本来管理构建顺序

在许多项目中，这也可以被视为专业人士。

如果您有很多重复的通用定义，可能需要一个包含文件用于构建脚本，其中可以定义解决方案范围的常量和参数。所以“额外的构建脚本层”无论如何都会经常发生，即使没有（直接）依赖关系。

这是一个优点，因为在构建中仍有更多模块化方法的空间。另一方面，如果您想在另一个不相关的解决方案中重用项目，则需要编写不同的定义文件。（另一方面，如果整个解决方案只有一个构建文件，如公约 1 中所示，您将需要不同的构建脚本。）至于您的维护要求，这（IMO）非常依赖于项目。

我的感觉倾向于第 2 号公约，但这远非明显的胜利。事实上，直到最近还运行良好的第 1 号公约的经验可能是最大的优点：在某个组织有经验的人组成的团队是一项宝贵的资产。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-06T12:23:18.117

考虑使用[NTFS 连接点](http://support.microsoft.com/kb/205524)，这样您就可以同时拥有两个组织。快速定义：“连接点是 Microsoft 对符号链接的实现，但它仅适用于目录。”

对“真实”布局使用约定 2，因为它使项目易于移动。然后制作一个 Convention 1 视图：

```
mkdir /solution/test
linkd /solution/test/prj1 /solution/prj1/test
linkd /solution/test/prj2 /solution/prj2/test 
```

现在你有...

```
/solution
  /test
    /prj1
    /prj2 
```

...这是预期的结果。

如果您发现 /src 或其他目录有益，您可以对它执行相同的操作。受益于约定 1 视图的测试脚本位于 /solution/test 中。

# asp.net-mvc - 有没有办法可以在 godaddy.com 共享虚拟主机上运行 ASP.NET MVC 项目？

> ID：266205
> 
> 赞同：76
> 
> 时间：2008-11-05T18:58:41.860
> 
> 标签：asp.net-mvc

有没有办法可以在 godaddy.com 共享虚拟主机上运行 ASP.NET MVC 项目？

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2008-11-18T16:50:30.797

作为在 GoDaddy 的 ASP.NET 共享主机上部署了 MVC 项目的开发人员，我可以肯定地告诉您，您可以做到这一点，而且非常简单。

1.  首先，确保您获得了 GoDaddy Windows 托管计划（他们同时销售 Linux 和 Windows 计划）。
2.  接下来，确保您已将[托管帐户设置为使用 ASP 2.0/3.0/3.5](http://help.godaddy.com/article/687)（默认情况下启用 AFAIK - 但如果您过去更改过它，则需要确保将其设置为此）。您可以通过单击“管理帐户”/内容/IIS 设置来进行设置。
3.  接下来，确保您的 MVC 项目设置为将 MVC .dll 复制到您的 bin 目录。 [ASP.NET MVC（从测试版开始）现在默认将这些程序集放在 GAC 中](http://weblogs.asp.net/scottgu/archive/2008/10/16/asp-net-mvc-beta-released.aspx#eleven)。您需要为您的项目更改此设置。 [有关如何执行此操作的信息，请访问 Phil Haack 的网站，点击此处](http://haacked.com/archive/2008/11/03/bin-deploy-aspnetmvc.aspx)。
4.  最后，只需发布​​您的网站并上传。

真的应该这么简单。如果您有任何问题，请发表评论。

# c++ - C ++中的简单哈希图实现

> ID：266206
> 
> 赞同：31
> 
> 时间：2008-11-05T18:59:13.560
> 
> 标签：c++, hashmap, hashtable

我对 C++ 比较陌生。在 Java 中，我很容易实例化和使用 hashmap。我想知道如何在 C++ 中以简单的方式做到这一点，因为我看到了许多不同的实现，但对我来说它们都不简单。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-05T19:10:50.273

大多数编译器应该`std::hash_map`为你定义；在即将到来的`C++0x`标准中，它将成为标准库的一部分，作为[`std::unordered_map`](http://en.cppreference.com/w/cpp/container/unordered_map). 它上面的[STL 页面](http://www.sgi.com/tech/stl/hash_map.html)是相当标准的。如果您使用 Visual Studio，[Microsoft](http://msdn.microsoft.com/en-us/library/6x7w9f6z(VS.71).aspx)上有一个页面。

如果你想使用你的类作为值，而不是作为键，那么你不需要做任何特别的事情。所有原始类型（例如`int`,甚至`char`）都应该“正常工作”作为 a 中的键。但是，对于其他任何事情，您都必须定义自己的散列和相等函数，然后编写将它们包装在类中的“函子”。`bool``char *``hash_map`

假设你的类被调用`MyClass`并且你已经定义了：

```
size_t MyClass::HashValue() const { /* something */ }
bool MyClass::Equals(const MyClass& other) const { /* something */ } 
```

您将需要定义两个仿函数来将这些方法包装在对象中。

```
struct MyClassHash {
  size_t operator()(const MyClass& p) const {
    return p.HashValue();
  }
};

struct MyClassEqual {
  bool operator()(const MyClass& c1, const MyClass& c2) const {
    return c1.Equals(c2);
  }
}; 
```

`hash_map`并将您的/实例`hash_set`化为：

```
hash_map<MyClass, DataType, MyClassHash, MyClassEqual> my_hash_map;
hash_set<MyClass, MyClassHash, MyClassEqual> my_hash_set; 
```

之后一切都应该按预期工作。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-05T20:09:33.057

在 C++ 中使用哈希图很容易！这就像使用标准 C++ 映射。您可以使用您的编译器/库实现`unordered_map`或使用[boost](http://www.boost.org/doc/libs/1_37_0/doc/html/unordered.html)或其他供应商提供的一个。这是一个快速示例。如果您按照提供的链接进行操作，您会发现更多信息。

```
#include <unordered_map>
#include <string>
#include <iostream>

int main()
{
    typedef std::tr1::unordered_map< std::string, int > hashmap;
    hashmap numbers;

    numbers["one"] = 1;
    numbers["two"] = 2;
    numbers["three"] = 3;

    std::tr1::hash< std::string > hashfunc = numbers.hash_function();
    for( hashmap::const_iterator i = numbers.begin(), e = numbers.end() ; i != e ; ++i ) {
        std::cout << i->first << " -> " << i->second << " (hash = " << hashfunc( i->first ) << ")" << std::endl;
    }
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-05T19:11:26.373

看看[boost.unordered](http://www.boost.org/doc/libs/1_37_0/doc/html/unordered.html)及其[数据结构](http://www.boost.org/doc/libs/1_37_0/doc/html/unordered/buckets.html)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-05T19:09:40.870

试试 boost 的[无序](http://www.boost.org/doc/libs/1_37_0/doc/html/unordered.html)类。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-05-19T13:32:00.653

查看[C++ 中的简单哈希映射（哈希表）实现，](https://goo.gl/mgfyZ3)了解具有通用类型键值对和单独链接策略的基本哈希表。

# javascript - 如何检测 URL 是否指向 SWF

> ID：266213
> 
> 赞同：2
> 
> 时间：2008-11-05T19:01:50.230
> 
> 标签：javascript, flash, detect, file-type

有没有办法（最好使用 JavaScript）来确定 URL 是指向 SWF 还是 JPG？

显而易见的答案是嗅探“.jpg”或“.swf”的文件名，但我正在处理由服务器动态决定的横幅，通常有很多参数，通常不包含扩展名。

所以我想知道我是否可以先加载文件，然后以某种方式读取它以确定它是 SWF 还是 JPG，然后放置它，因为我需要显示 JPG 和 SWF 的 JavaScript 代码非常不同。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-05T19:26:55.093

我会通过说：

对 url 的 HTTP HEAD 请求可用于检查资源的 mime 类型。您不需要以这种方式下载文件的其余部分。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T19:27:23.470

您可以使用 javascript 通过创建动态 img-tag 来检测它是否是图像。

```
function isImage(url, callback) {
    var img = document.createElement('img');
    img.onload = function() {
        callback(url);
    }
    img.src = url;
} 
```

然后调用它：

```
isImage('http://animals.nationalgeographic.com/staticfiles/NGS/Shared/StaticFiles/animals/images/primary/bald-eagle-head.jpg', function(url) { alert(url + ' is a image'); }); 
```

**更新** 此版本将始终使用布尔值执行回调。

```
 function isImage(url) {
        var img = document.createElement('img');
        img.onload = function() {
            isImageCallback(url, true);
        }
        img.onerror = function() {
            isImageCallback(url, false);
        }
        img.src = url;
    }

    function isImageCallback(url, result) {
        if (result)
            alert(url + ' is an image');
        else
            alert(url + ' is not an image');
    } 
```

将您的逻辑放在 isImageCallback 函数中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-05T19:46:44.257

完全未经测试，基本上只是一个想法：

```
function isImage(url)
{
    var http = getHTTPObject();
    http.onreadystatechange = function ()
    {
        if (http.readyState == 4)
        {
            var contentType = http.getResponseHeader("Content Type");
            if (contentType == "image/gif" || contentType == "image/jpeg")
                return true;
            else
                return false;
        }
    }

    http.open("HEAD",url,true);
    http.send(null);
}

function getHTTPObject() 
{
    if (window.XMLHttpRequest)
    {
        return new XMLHttpRequest();
    }
    else 
    {
        if (window.ActiveXObject)
        {
            return new ActiveXObject("Microsoft.XMLHTTP"); 
        }
    }
    return false;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-05T19:14:04.293

我不确定您拥有的确切设置，但您可以使用 HTTP 响应并检查 mime 类型来确定图像与闪存吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T19:26:36.123

如果 URL 没有扩展名，那么如果不从服务器请求文件，就无法判断。

# compression - 哪些压缩/存档格式支持文件间压缩？

> ID：266214
> 
> 赞同：4
> 
> 时间：2008-11-05T19:01:53.647
> 
> 标签：compression, archive

[这个关于归档 PDF 的问题](https://stackoverflow.com/questions/227727/should-i-dynamically-recreate-a-pdf-rather-than-store-it-in-either-the-database#227758)让我想知道——如果我想压缩（出于归档目的）大量文件，这些文件本质上是在主模板（信笺抬头）之上所做的小改动，似乎可以通过文件间压缩。

是否有任何标准压缩/归档格式支持这一点？AFAIK，所有流行的格式都专注于压缩每个文件。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-05T20:17:12.700

几种格式进行文件间压缩。

最古老的例子是 .tar.gz；.tar 没有压缩，而是将所有文件连接在一起，每个文件前面都有标题，而 .gz 只能压缩一个文件。两者都是按顺序应用的，它是 Unix 世界的传统格式。.tar.bz2 是一样的，只是用 bzip2 代替 gzip。

最近的示例是具有可选“实体”压缩的格式（例如，RAR 和 7-Zip），如果通过命令行标志或 GUI 选项启用，它们可以在压缩之前在内部连接所有文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T19:07:52.107

看看 google 的 open-vcdiff。

[http://code.google.com/p/open-vcdiff/](http://code.google.com/p/open-vcdiff/)

它设计用于计算小的压缩增量并实现 RFC 3284。

[http://www.ietf.org/rfc/rfc3284.txt](http://www.ietf.org/rfc/rfc3284.txt)

微软有一个 API 可以做类似的事情，没有任何标准。

一般来说，您正在寻找的算法是基于 Bentley/McIlroy 的算法：

[http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.11.8470](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.11.8470)

特别是如果模板的大小大于 gzip 使用的窗口大小（~32k）或 bzip2 使用的块大小（100-900k），这些算法将是一个胜利。

Google 在其 BIGTABLE 实现内部使用它们来存储压缩网页，原因与您寻找它们的原因大致相同。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T19:06:55.337

由于 LZW 压缩（它们几乎都使用）涉及构建一个重复字符表，例如您想要的模式将限制您必须一次解压缩整个存档。

如果这在您的情况下是可以接受的，那么实现一种在压缩之前将文件合并到一个大文件中的方法可能会更简单。

# functional-programming - 函数式更新

> ID：266219
> 
> 赞同：4
> 
> 时间：2008-11-05T19:04:32.173
> 
> 标签：functional-programming, crud

这可能是矛盾的，但是如何以函数式编程风格更新数据实体？从我读过的所有内容来看，函数式编程使用转换来返回不可变实体的输出。我唯一能想到的就是完全替换原始实体，但这似乎与经典更新方法几乎相同。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-05T19:15:50.077

您是在谈论磁盘数据库实体还是内存中的数据结构。

对于后者，函数式语言使用持久化的数据结构，其实现使得新版本和旧版本在更新后都可用，但它们共享公共部分（因此它是高效的）。因此，您似乎正在返回一个全新的数据结构，但实际上，它与正在修改的数据结构共享其大部分实现。

在 clojure 源代码（用 Java 编写）中有一些非常好的实现可供查看——我在我的博客上将其中两个分开

[http://www.loufranco.com/blog/files/20-Days-of-Clojure-Day-7.html](http://www.loufranco.com/blog/files/20-Days-of-Clojure-Day-7.html)

[http://www.loufranco.com/blog/files/20-Days-of-Clojure-Day-8.html](http://www.loufranco.com/blog/files/20-Days-of-Clojure-Day-8.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T19:10:21.943

简短的回答是，在函数式风格中，每个数据实体都是不可变的，因此更新实际上是具有更新值的新数据实体，有点像字符串在 .NET 中的工作方式。

真正有趣的挑战是在处理 IO 时出现，以纯粹的函数方式对 I/O 建模变得很困难，这会导致像[Monads](http://en.wikipedia.org/wiki/Monads_in_functional_programming)这样的变通方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T19:22:53.963

卢佛朗哥有。功能语言中的数据结构被实现为修改它们，您“完全替换”原始实体。在幕后，他们仍然使用大部分旧的：他们只是替换更改的位。旧版本也仍然存在，但只要没有人引用它，垃圾回收最终就会将其销毁。

# git - git：如何将来自远程的提交合并到不同的路径？

> ID：266245
> 
> 赞同：6
> 
> 时间：2008-11-05T19:16:35.053
> 
> 标签：git, merge, version-control

我有一个带有远程 foo 的 git 存储库。

foo 是一个网络应用程序，它直接在其根目录中包含一些文件和目录：

```
Rakefile
app
...
public
script 
```

我的主要 git 存储库是一个更大的系统，其中包含这个 Web 应用程序。我想从 foo 中提取提交，但我需要将文件驻留在`web`目录中。所以它们应该变成`web/app`,`web/public`等等。

我不想使用 foo 作为子模块。我想将 foo 合并到主存储库中，然后摆脱它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T19:42:45.983

这回答了我的问题：

[http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html](http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-03T07:32:29.927

**子树合并**的最新资源有：

*   [Git Book第6.7章](http://git-scm.com/book/en/Git-Tools-Subtree-Merging)
*   [如何使用子树合并策略](http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html)
*   GitHub 文章“[使用子树合并](https://help.github.com/articles/working-with-subtree-merge)”

引用[如何使用子树合并策略](http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html)：

> 在此示例中，假设您的存储库位于`/path/to/B`（但如果您愿意，它也可以是 URL）。您希望将该存储库的主分支合并到`dir-B`当前分支中的子目录。
> 
> 这是您需要的命令序列：

```
$ git remote add -f Bproject /path/to/B
$ git merge -s ours --no-commit Bproject/master
$ git read-tree --prefix=dir-B/ -u Bproject/master
$ git commit -m "Merge B project as our subdirectory"

$ git pull -s subtree Bproject master 
```

另见文章“[子树合并和你](http://nuclearsquid.com/writings/subtree-merging-and-you/)”的评论。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T03:41:12.663

如果您愿意接受它作为答案，这里是您的答案的社区 wiki 版本。

* * *

这回答了我的问题：

[http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html](http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html)

# windows - 我们可以查看 PowerShell cmdlet 的源代码吗？

> ID：266250
> 
> 赞同：40
> 
> 时间：2008-11-05T19:21:05.247
> 
> 标签：windows, powershell, cmdlets

我正在学习一些 PowerShell。[是否可以查看像Get-ChildItem](http://technet.microsoft.com/en-us/library/hh849800.aspx)这样的内置 cmdlet 的源代码？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2016-08-20T20:11:56.330

[Powershell 的源代码现已在 Github 上提供。](https://github.com/PowerShell/PowerShell)可以在[这里](https://github.com/PowerShell/PowerShell/blob/c1faf1e6e10fc1ce45e84ef6f49ae7136c67a111/src/Microsoft.PowerShell.Commands.Management/commands/management/GetChildrenCommand.cs)
找到 源代码。`Get-ChildItem`

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-11-06T04:00:13.340

实际上，最好的办法是去看看[PowerShell Community Extensions](https://github.com/Pscx/Pscx)。这个开源软件社区项目“旨在提供一组广泛有用的附加 cmdlet……”。该项目的开发人员是 PowerShell MVP 并且知道他们的东西。

至于在现有 PowerShell cmdlet 上使用反射，PowerShell MVP Oisin Grehan 制作了一个名为“ [Reflect-Cmdlet](https://web.archive.org/web/20190521090145/https://www.nivot.org/post/2008/10/30/ATrickToJumpDirectlyToACmdletsImplementationInReflector) ”的方便函数。我不会窃取他的代码并将其放在这里，但基本上你要做的是：

```
Get-Command Get-ChildItem | Reflect-Cmdlet 
```

然后[.NET Reflector](https://en.wikipedia.org/wiki/.NET_Reflector)弹出并打开并展开正确的程序集以及所有内容。这真的很酷。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-12-10T01:45:40.903

我想如果你刚开始使用 PowerShell，这就是你要找的：

```
$metadata = New-Object system.management.automation.commandmetadata (Get-Command Get-Process)
[System.management.automation.proxycommand]::Create($MetaData) | out-file C:\powershell\get-process.ps1 
```

这将创建一个脚本，显示[Get-Process](http://technet.microsoft.com/en-us/library/hh849832.aspx)如何运行。放入任何要替换 Get-Process 的 cmdlet。如果您想在 Google 上搜索更多信息，这就是您创建代理功能的方式。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2015-08-24T18:44:03.267

对于已**编译**的 Cmdlet，您可以获得以下路径`.dll`：

```
(Get-Command Get-ChildItem).DLL 
```

（替换`Get-ChildItem`为您感兴趣的 cmdlet）

一旦知道 .NET 的路径`.dll`，就可以使用 .NET 反汇编程序（如[dotPeek）](https://www.jetbrains.com/decompiler/)打开它：

```
& dotPeek64.exe (Get-Command Get-ChildItem).DLL 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-09T00:00:39.473

您可能还想查看 CodePlex 上的[Windows Installer PowerShell 管理单元](http://psmsi.codeplex.com/)。这是一个比社区扩展更小的项目，因此更容易了解正在发生的事情。

查看*Professional Windows PowerShell Programming: Snapins, Cmdlet, Hosts and Providers* (Wrox Professional Guides), ISBN: 0470173939 - 这是我发现的用于编写 cmdlet 和提供程序的最有用的书籍之一。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-05T19:32:16.377

您应该能够使用[.NET Reflector](http://en.wikipedia.org/wiki/.NET_Reflector)来“查看”源代码。您需要了解程序集，但也应该使用 GetType 方法或类似方法访问它。

这个[PowerShellLanguage .NET Reflector Add-In](http://www.codeplex.com/reflectoraddins/Wiki/View.aspx?title=PowerShellLanguage&referringTitle=Home)可能很有用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-14T16:42:41.247

PowerShell cmdlet 的程序集位于 GAC 中。您可以在以下位置找到“Get-ChildItem”cmdlet：

**Microsoft.PowerShell.Commands.Management 程序集，Microsoft.PowerShell.Commands.GetChildItemCommand**类。

我使用了 ILSpy .NET 反编译器并通过“powershell”字符串过滤了 GAC 程序集。据我了解，**Microsoft.PowerShell.Commands.***程序集包含内置 cmdlet。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-05T19:24:12.197

我不相信 PowerShell 的源代码曾经发布过。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-08-12T16:00:47.700

可以在参考资源站点上找到一些代码： [http ://referencesource.microsoft.com/#System.Management.Automation/System/Management/Automation/ChildItemCmdletProviderIntrinsics.cs,c6eed9f6a5417c19](http://referencesource.microsoft.com/#System.Management.Automation/System/Management/Automation/ChildItemCmdletProviderIntrinsics.cs,c6eed9f6a5417c19)

不过，这只给出了大纲；不是代码的详细信息。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-04-07T20:43:51.730

对于某些安装`Install-Module`并包含源代码而非二进制文件的 cmdlet（例如 PSnmap）：

```
Install-Module -Name PSnmap 
```

...您可以通过查看以下`Definition`属性来查看他们的代码：

```
Get-Command Invoke-PSnmap | Format-List 
```

如果没有，很可能您需要反编译一些二进制文件（例如，在`DLL`属性中指定的文件）。

# assembly - 是否有“低于”汇编的编程语言？

> ID：266253
> 
> 赞同：47
> 
> 时间：2008-11-05T19:22:13.917
> 
> 标签：assembly, machine-code, microcoding

是否有“低于”汇编的编程语言？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-11-05T19:26:21.820

实际上，在机器代码下面有一层代码，称为[Microcode](http://en.wikipedia.org/wiki/Microcode)。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-11-05T19:23:24.930

[机器码](http://en.wikipedia.org/wiki/Machine_code)。时间是程序员用二进制的 1 和 0 编码的。Hex 被认为是在这方面的进步。那是在汇编之前，它使用代码的名称并将指令的各个部分分成其部分。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-11-05T19:32:30.543

汇编是机器码的文本表示。它有一条语句，表示 CPU 本身内的一条指令。例如，“MOV X, Y”是一条通过 CPU 并将值 X 移动到位置 Y 的单个指令。要获取机器代码，CPU 将有一个表示“MOV”的数字，以及一个表示'X'（如果它还不是一个数字）和一个代表 Y 的数字。这些原始 HEX 二进制值是机器代码。正是这些数字导致 CPU 通过晶体管引导电压/电流以使其发挥作用。

机器代码是一个较低的级别，但它非常接近于汇编。它是如此接近，由于能够读取指令“MOV” = move 的优势，没有人会打扰使用它。变量名称也变得可读，而不是堆栈或堆中的原始地址。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-11-05T19:46:35.740

甚至更低，（不是“语言”这个词适用于“机器”语言或更低的物理层），但在机器语言之下是用于实际实现每个二进制操作码的许多门和开关的配置所涉及的特定硬件（CPU）......查尔斯·佩佐德（Charles Petzold）写的一本好书，涵盖了这个甚至更低的级别，称为“[代码](https://rads.stackoverflow.com/amzn/click/com/0735611319)”

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-11-05T19:28:02.393

如果低于，你的意思是更低的水平，那么是的。有机器语言。汇编在运行之前被转换为机器语言。在许多现代流程中，机器语言是在微码中模拟的。有关微码的更多详细信息，请参见[此处](http://en.wikipedia.org/wiki/Microcode)。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-05T19:24:17.127

机器码

[http://en.wikipedia.org/wiki/Low-level_programming_language](http://en.wikipedia.org/wiki/Low-level_programming_language)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-10-18T12:42:51.857

我认为你能得到的最低值是所谓的物理或 TRW（现实世界）。这就是芯片设计人员和制造商用来创建 CPU 和其他处理器的方法，这些处理器可以将计算机语言的输出转化为有价值的东西。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-05T21:22:17.607

汇编程序由汇编程序翻译成机器代码。您可以使用二进制编辑器编写它。（哎哟！）CISC 计算机可以有微码，对芯片的各个部分进行排序（ALU、内存提取等）。通常，除了芯片制造商之外，没有人编写微代码。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-05T22:33:09.867

嗯，正如其他人所提到的，有机器语言。机器语言通常是您在汇编中编写的内容的一对一翻译，因此它与汇编代码处于同一抽象级别——只是手工编写要困难得多。

这也有例外，例如MIPS 汇编语言提供的[伪指令。](http://en.wikipedia.org/wiki/MIPS_architecture#Pseudo_instructions)

有，或者我应该说甚至低于汇编/机器语言的级别：*微*[码](http://en.wikipedia.org/wiki/Microcode)。现代逻辑晶体管预算就是这样，我怀疑微码正在失去其相关性。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-11-05T21:02:21.437

第一台计算机 (ENIAC) 使用硬接线，因此一个计算的输出可以作为输入提供给另一个计算。要运行另一个程序，您必须拔下一些电缆并以不同的方式重新接线。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-11-05T19:32:07.797

取决于你问的原因。在汇编中没有什么是你不能通过其他方法做的。机器码只是完全相同数据的另一种表示。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-25T07:18:33.117

汇编语言是编程语言构建的较低层，因为机器代码不是一种语言，因为它不涉及任何要遵循的语法规则。机器码可能是执行微处理器操作的唯一数据格式：CPU从内存中取出数据并根据取出的机器码直接执行指令。

但是，在最近的一些设计中，例如 Intel Pentium 4 及更高版本，机器代码是较低级别的 RISC 执行单元操作的表达，称为 uops 或微操作。因此，这些设计的解码逻辑是将 CISC 类型的指令转换为小微指令，这些指令通常针对更简单的加载/存储单元，类似 RISC。在这方面，我们可以说（尽管这在技术上可能不准确）机器代码描述了架构的“高级”复杂指令，而不是由 CPU 的底层执行逻辑原子地执行的“真实”操作.

所以我们有一个架构指令集，或架构机器代码，以及一个对外部世界隐藏的内部级别的“微指令”集。Intel 处理器的跟踪缓存被设计用来存储这些操作以优化处理器的超标量性能（因为 CPU 执行的是 uop，而不是可供程序执行的体系结构指令集）。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-05T19:38:36.707

即使在机器代码之下，也可以说是 VHDL - 芯片设计。您甚至不需要设计芯片来执行代码，只需立即将输入转换为输出。

（并不是说我是专家——我使用的是 C++）

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-11-05T19:23:51.903

好吧，你总是可以用二进制（或十六进制，或其他一些表示）编写代码。然后，您必须在脑海中计算跳跃偏移等。不建议。;)

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-11-05T19:25:52.803

有点。机器不读取汇编，它们读取“机器语言”，这是汇编转换成的。机器语言有“操作码”而不是汇编的助记符，而这些操作码通常只是二进制数据。机器代码通常不被认为是人类可读的。

在 RISC 系统上，机器代码通常是汇编的直接翻译，但在 x86 系统上，尤其是两者完全不同。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-11-05T19:26:28.713

当然：“机器代码”，维基百科在关于汇编语言的文章（[http://en.wikipedia.org/wiki/Assembly_language](http://en.wikipedia.org/wiki/Assembly_language)）中说：“实现数字机器代码和其他所需常量的符号表示对特定的 CPU 架构进行编程。”

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2012-07-25T04:18:41.023

您可以将电流发送到 CPU 并告诉它在哪里放置像素。（几乎是二进制，但你不用电脑写。）

# .net - 带有 SPSite 构造函数的 FileNotFoundException

> ID：266255
> 
> 赞同：22
> 
> 时间：2008-11-05T19:22:50.407
> 
> 标签：.net, security, sharepoint, sharepoint-2007, sharepoint-2010

我尝试在自定义进程（MyApp.exe）中实例化`SPSite`场服务器上的一个实例，并将其作为参数提供整个 URI（[http://mysite:80/](http://mysite:80/)）。我还确保正在运行的帐户`MyApp.exe`是`Site Collection Administrator`.

但是，我无法举例说明`SPSite`我正在尝试做的任何事情。它总是抛出一个`FileNotFoundException`.

有人有想法吗？

堆栈跟踪：

> 在 Microsoft.SharePoint.SPSite..ctor(String requestUrl) 在 Microsoft.SharePoint.SPSite..ctor(SPFarm 场，Uri requestUri，Boolean contextSite，SPUserToken userToken)
> 在 C 中的 MyCompanyName.Service.HelperClass.GetItemStateInSharePoint(SharePointItem item)： \Workspaces\MyCompanyName\Development\Main\MyCompanyName.SharePoint\Service\HelperClass.cs:555 行

另一个旁注......我有一个 Web 应用程序 + 网站集，我可以通过浏览器毫无问题地访问它。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-05T19:42:44.843

当 SharePoint 无法在 SharePoint 配置数据库中找到请求的网站集时，会引发 FileNotFoundException。我的猜测是您尚未在 URL [http://mysite:80](http://mysite:80)上创建网站集。如果我尝试使用不存在的网站集的 URL 实例化一个新的 SPSite 对象，我会看到以下堆栈跟踪：

```
System.IO.FileNotFoundException : The site http://server/sites/bah could not be found in the Web application SPWebApplication 
Name=SharePoint - 80 Parent=SPWebService.
at Microsoft.SharePoint.SPSite..ctor(SPFarm farm, Uri requestUri, Boolean contextSite, SPUserToken userToken)
at Microsoft.SharePoint.SPSite..ctor(String requestUrl) 
```

指定网站集的正确 URL 或打开管理中心并创建新的网站集。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-10-05T20:02:03.893

将构建属性中的平台目标更改为 x64 为我在 SharePoint 2010 上解决了这个问题。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-10-07T07:29:02.283

阅读此站点[http://community.bamboosolutions.com/forums/t/8179.aspx](http://community.bamboosolutions.com/forums/t/8179.aspx)如果您正在运行您的 OS x64 位并使用 MSTest（32 位），它将失败，使用 nunit 工作！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-12-03T22:13:52.087

这个问题更多的是用户权限问题给予以下权限

用户权限 **SharePoint 站点** --- 最低读取权限

**Sharepoint 服务器** --- 添加到 WSS_ADMIN_WPG 组

**数据库** --- Sharepoint Content DB（站点集合数据库）- db_owner 权限 Sharepoint Config DB（sharepoint 安装的配置 DB）- - db_owner 权限

在我的博客中阅读更多内容

[http://sharepointinstallation.blogspot.com/2010/12/minimal-permission-required-to-execute.html](http://sharepointinstallation.blogspot.com/2010/12/minimal-permission-required-to-execute.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-01-28T05:17:44.347

如果它是访问 SharePoint 2010 的控制台应用程序，请确保项目的构建目标是 x64 并且 .NET Framework 是 3.5。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-05T19:44:47.913

对象模型也可能不喜欢您提供的 URL。如果您未向其提供创建网站集的确切 URL，或者未在备用访问映射中配置列出的确切 URL，它将引发可能不一定有意义的异常。在您的情况下，您可以尝试`http://mysite`或`http://machinename`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-05T19:27:25.357

异常的堆栈跟踪会很有帮助。

我认为您可以通过在工具->选项->调试中禁用“只是我的代码”并在调试器显示时查看异常调用堆栈中的文件名参数来了解它是什么文件以及正在发生的事情（当然，如果您可以调试它），或者该名称可能会显示在异常消息中。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-05T19:27:58.790

检查您的 web.config 并查看是否存在缺少文件的配置。

在你的 12 个蜂巢中寻找日志。如果您的日志设置正确，您将丢失该文件。

编辑：还要检查您的所有 DLL 是否都在 GAC 中。检查您的 web.config 文件是否包含所有信息：namespace,Classname, NameSpace, Version=version_number, Culture-your_culture, PublicKeyToken=your_signed_token

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-20T11:56:03.933

我最近发现构造函数的这个问题可能是由构造函数的严重行为引起的。
我正在讨论 MOSS 2007。当您将完整的站点 URL 传递给构造函数时，它似乎确实只考虑 URL 的站点部分，选择“当前选择”的 Web 应用程序Web 应用程序选择器控件。
因此，例如，[当](http://weabapp:22345)您 在[调用](http://webapp/sites/site)

```
SPSite site = new SPSite("http://webapp/sites/site") 
```

它试图为“ [http://webapp:22345/sites/site](http://webapp:22345/sites/site) ”实际创建一个站点对象，但失败了。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-02-03T13:09:41.640

我遇到过同样的问题。我想用我的用户 ID 运行控制台应用程序。我是 Web 应用程序所有者 + Farm 管理员。仍然无法运行该应用程序。

问题已解决

1.  将构建属性中的平台目标更改为 x64

2.  在站点设置 --> 用户和权限 --> 网站集管理员中有两个名称。删除其他名称并开始工作。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-11-03T02:08:28.607

您可以将项目编译目标设置为“任何 CPU”。重要的是配置 MSTest 主机进程以 64 位运行。打开您的 .testsettings 文件，转到主机选项卡并设置“以 64 位运行测试...”

如果在此之后，当您运行测试时 VS 告诉您没有，请再次删除并添加您的测试项目（我不知道更好的解决方法）

希望能帮助到你！

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-01-21T21:14:57.177

我们有同样的问题，但我熟悉不同的原因，这里是一个总结：

1.  您可能输入错误或以其他方式输入了错误的地址
2.  运行该进程的用户帐户没有所需的权限，这些权限是：SharePoint 网站的读取权限，以及 SharePoint Config db 和 Content db 的 dbo。
3.  在 64 位服务器上构建时，该进程必须是 64 位进程（默认为 64 位“任何 CPU”）。
4.  该过程必须针对 .NET 3.5

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-05T19:34:18.247

几周前我被这个困扰。最终我发现找不到的文件是 SharePoint 程序集本身。运行时无法通过后期绑定加载附属程序集。

我的问题的解决方案是在 GAC 中注册 SharePoint 12.0.0.0 程序集。这听起来不像你的问题，但仅供参考。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-15T21:24:42.133

几天前我们遇到了同样的问题，解决方案是设置应用程序，即尝试创建 de SPSite 对象，使用与 Sharepoint 的 Web 应用程序相同的 AppPool。

希望能帮助到你。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-11-03T18:34:12.240

x64 问题上的 MSTest 对我来说是这个问题的原因。在控制台应用程序中工作。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-12-02T21:37:56.627

我有类似的问题。

在我的场景中，我能够从控制台应用程序创建 SPSite 实例，但是当另一个团队成员尝试这样做时，应用程序抛出了与上述相同的异常。

解决方案：我在 Content Db 服务器框上添加了另一个队友作为管理员（这可能不是每个人都可以），代码工作正常且没有错误

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-01-30T16:08:24.077

SharePoint 2010 上的同样问题。但是问题出在我们的 Web 服务上，它正在访问 SharePoint 对象模型。此服务应在其下运行的应用程序池应该是场管理员。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-05-19T21:10:54.513

切换到 NUnit 可能不是每个人的选择。
就我而言，问题是我在 64 位服务器上，我检查了任何 CPU（所以它选择了正确的版本）但我的测试设置设置为“强制测试在 32 位进程中运行”（GAH！ )

在 MSTest 中，转到 TEst->Edit Test Settings->Trace and Test Impact。
选择主机。
确保您运行的是正确的版本。 ![这是你应该选择的](https://i.stack.imgur.com/UEAdd.png)

这是我的 VS2010 SP1，MSTest 清单。

*   您需要 SP1，以便您可以针对 .NET 3.5 进行测试。它不适用于 .NET 4.0
*   确保站点加载-我直接从 VS2010 编辑器启动站点，因为它是一个超链接
*   验证构建设置。如果服务器是 64 位，则选择 64 位。
*   就我而言，我有一个 64 位服务器，但选择 x64 会失败！那是我的第一个线索。
*   验证测试设置是否支持正确的位。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-11-25T11:51:14.437

我在尝试访问 Sharepoint 2010 时遇到了同样的问题。

我通过将目标框架更改为 .NET 3.5 来修复它。- 这是 Sharepoint 2010 支持的版本。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-04-10T02:54:36.703

就我而言，这绝对是我登录 Windows 的帐户的权限问题。

在以管理员身份运行的 SharePoint 命令行管理程序中尝试此命令：

获取 SPSite ' [http://yoursite/yourcollection](http://yoursite/yourcollection) '

如果您收到错误，请以应用程序池用户或用于安装 SharePoint 的帐户身份登录到 SharePoint 服务器，然后再次尝试上述命令。

如果它有效，那么您知道您以前的帐户存在权限问题。要解决此问题，请在同一 shell 窗口中运行此命令并提供您要在 VS 中使用的帐户：

添加-SPShellAdmin -用户名域\用户

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-01-19T13:33:30.137

我遇到了同样的问题，我进行了以下更改并开始工作。

1.  将 Visual Studio 中的平台目标更改为 x64
2.  确保您在“管理员”模式下运行 Visual Studio。

# wcf - Web 服务超时的最佳实践

> ID：266281
> 
> 赞同：18
> 
> 时间：2008-11-05T19:30:39.563
> 
> 标签：wcf, web-services, timeout, scalability

是否有任何文章/书籍定义了 WS 超时的上限设计限制？你是在服务器超时还是推荐客户端特定的超时？

是否有一个常见的最佳实践，例如“永远不要设计可能需要超过 60 秒的 WS，使用异步令牌模式”

我也有兴趣了解您的工作或您的意见。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-07T00:13:46.997

IMO，大约 30 秒以上的超时是荒谬的建议。您的超时时间应约为 3 秒。是的。三。两个之后和四个之前的数字。如果您正在构建基于 SOA 的应用程序，那么肯定需要 3 秒*或更短的时间*。

想一想……您的应用程序的用户期望总响应时间约为 5 秒或更短（最好约为 3 秒）。如果每个单独的服务呼叫都需要超过几毫秒* 才能返回，那么您就完蛋了。等待一项服务返回 30 多秒是永恒的。用户永远不会等待那么久。另外，如果您知道它们应该在不到一秒的范围内返回，那么再等待*30*秒或更长时间以发出错误信号的意义何在？它不会在 28 秒前没有的地方神奇地工作。如果您的应用程序的平均响应时间从不到 1 秒到超过 30 秒出现剧烈波动，则说明设计不正确。您可能会考虑一些缓存或其他东西。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-06T02:29:54.693

这个问题以及与它的答案相关的问题可能会有所帮助： [对于不可接受的 webapp 响应时间是否有一些行业标准？](https://stackoverflow.com/questions/184814/is-there-some-industry-standard-for-unacceptable-webapp-response-time)

与您的问题有些相切（没有时间间隔，抱歉），但我怀疑对您的工作很有用：超时的一种常见方法是用“退避”计时器来平衡它们。
它是这样的：第一次服务超时，不用担心。连续第二次服务超时，不要费心调用它 N 秒。连续第三次服务超时，N+1秒不要调用。然后是 N+2、N+3、N+5、N+8 等，直到达到某个最大极限 M。

当您获得有效响应时，超时计数器会重置。

我在这里使用斐波那契数列来增加“退避”时间段，但当然您可以使用任何其他合适的功能——关键是，如果您尝试的服务不断为您计时，您“相信”它变得越来越小，因此您花费更少的资源试图到达它，并且更少地敲门。这可能有助于另一端的服务，它可能只是超载和重新请求只会让事情变得更糟，并且它会增加您的响应时间，因为您不会等待不太可能回答的服务。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T21:33:48.147

获取您通过 Web 服务传输的数据量，看看该过程需要多长时间。

将 60 秒添加到该数字并进行测试。

如果你可以让它在良好的连接上超时，那么再增加 30 秒。

冲洗并重复。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-07T00:03:48.933

我们通常采用该 Web 服务的预期响应时间（如我们的接口规范中所述）并增加 30 秒。

然后我们在 UAT 期间监视日志以查看是否有任何模式（例如，特定的 DB 调用需要很长时间）并酌情进行更改。

# activemq - 使用 mina 设置 tcp 套接字的 ActiveMQ

> ID：266283
> 
> 赞同：1
> 
> 时间：2008-11-05T19:31:44.773
> 
> 标签：activemq, apache-camel, apache-mina

我正在尝试设置一个简单的 activemq 和 mina 演示。我在 activemq.xml 文件中编辑了 camelContext 以包含两个 mina tcp 套接字、两个队列和路由，如下所示：

listenerA -> qA -> listenerB
listenerB -> qB -> listenerA

目的是在两个 telnet 会话之间有两种方式通过。稍后，我将在每个侦听器上添加更多花哨的功能，例如过滤、路由到主题和我自己的编解码器。

这是我的骆驼上下文：

```
 <!-- You can use a <package> element for each root package to search for Java routes --> 
    <package>com.myco.codec</package> 

    <endpoint id="listener_A" uri="mina:tcp://localhost:42000?textline=true"/> 
    <endpoint id="listener_B" uri="mina:tcp://localhost:42001?textline=true"/> 

            <!-- You can use Spring XML syntax to define the routes here using the <route> element --> 
    <route> 
        <from ref="listener_A"/> 
        <to uri="activemq:qA"/> 
    </route> 
    <route> 
        <from uri="activemq:qB"/> 
        <to ref="listener_A"/> 
    </route> 
    <route> 
        <from ref="listener_B"/> 
        <to uri="activemq:qB"/> 
    </route> 
    <route> 
        <from uri="activemq:qA"/> 
        <to ref="listener_B"/> 
    </route> 
</camelContext> 
```

当我启动 activemq 时，我得到一个异常：

org.apache.camel.NoSuchEndpointException：找不到端点：mina:tcp://localhost:42000?textline=true

我是否明确需要添加一个 mina bean？如果是这样，在哪里以及如何？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-06T07:46:59.123

你在类路径上有camel-mina.jar 和mina jars 吗？

根据[这里的线程，](http://www.nabble.com/Usage-of-Mina-in-camelContext-for-TCP-loop.-td20348095s22882.html)它似乎已经修复了它。

# c# - 具有 1:1 键/值映射的 C# 集合数据结构

> ID：266292
> 
> 赞同：5
> 
> 时间：2008-11-05T19:33:39.603
> 
> 标签：c#, .net, data-structures, hashtable

是否有任何内置的 C# 数据结构，类似于哈希表，但要求键和值彼此唯一？我基本上想要一种通过唯一值在表中查找我的 Key 对象的方法，反之亦然。除了维护两个哈希表或迭代哈希表中的每个键（这很慢）之外，我想不出更好的方法来实现它。

我什至有这个请求的事实是否表明我在我的代码中设计了错误的东西？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-05T19:36:19.583

这不一定是设计缺陷，但框架中没有内置任何内容。幸运的是，最近有一个非常相似的问题，我[写了一个答案，应该对你有好处](https://stackoverflow.com/questions/255341/getting-key-of-value-of-a-generic-dictionary#255630)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T19:36:25.683

Google Collections 将此称为[BiMap](http://code.google.com/p/google-collections/source/browse/trunk/src/com/google/common/collect/HashBiMap.java#thiscanbeleftoutbutwasaddedtoovercomethecharacterlimit)。也许你可以把它移植到 C#？

# visual-studio-2008 - 2008 MFC 和线程？

> ID：266300
> 
> 赞同：1
> 
> 时间：2008-11-05T19:36:18.040
> 
> 标签：visual-studio-2008, multithreading, visual-c++, mfc

我正在阅读此线程/帖子：[https ://stackoverflow.com/questions/262298/windows-c-ui-technology](https://stackoverflow.com/questions/262298/windows-c-ui-technology)

我还想知道一个非 .NET UI 框架。具体来说——在.NET 支持串行端口之前（我不敢相信他们在.NET 的第一个版本中忽略了它），我被迫将MFC 用于应用程序。我不是一名 GUI 开发人员，但由于 MFC 严重缺乏与我的应用程序中的其他线程配合使用的能力，我很快就发现自己要抓狂了——例如，调用 UI 控制方法来更新数据或从另一个线程执行其他操作. 大多数挑战都得到了解决，但应用程序代码过于复杂，包含消息传递等，只是为了处理 MFC 的缺点。

所以 - 我的问题：“新的和改进的”mfc 是否支持线程 - 即，如果我从另一个线程为 gui 对象调用一些 mfc 控件，它会像旧的 mfc 一样崩溃/呕吐，还是可以在现实世界中播放?

编辑

澄清一下——我理解在单独的线程中处理 GUI 的担忧，但我希望的是，不是程序员创建自定义消息并从工作线程发送它们——GUI 框架将为我完成所有这些工作我可以从其他线程调用对象方法。也许这太过分了——特别是如果线程还不是语言规范的一部分。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T19:42:41.193

这不是 MFC 的限制 - 这是 Windows 的设计。您不能开始从随机的其他线程向任意控件发送消息。（嗯，有时可以，但您需要知道自己在做什么。）在 .NET 世界中同样如此——一旦控件可见，您需要使用委托来更新它，以便更新操作发生在正确的线程上。

更一般地说，根据经验，您几乎总是最好让一个线程在应用程序中处理 GUI，而让其余线程纯粹是工作线程。让多个线程与 GUI 交互会导致疯狂地试图跟踪正在发生的事情。

编辑

恐怕对原始问题的简短回答是“不”：没有对线程、MFC 和 Windows 的交互方式进行根本性的改造。在这一点上，由于 MFC 几乎不是 Microsoft 的优先事项，我预计这不会改变。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T20:36:48.463

MFC 的基本架构在新版本中并没有真正改变。如果您以前对线程支持不满意，那么可以肯定地说您仍然不会。我同意 DavidK 的说法——这是所有框架都必须处理的固有问题。MFC 没有为多线程提供太多帮助的主要原因几乎可以肯定是因为它最初是在 1992 年为 16 位 Windows 引入的。此时 Windows 不支持多任务，实际上是单线程的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T19:50:19.680

您可以做的一件事是向自己发布一条自定义消息，Windows 消息泵将获取该消息并在主线程上处理它，因此您的所有代码都可以正常工作。显然，您需要设置自己以异步方式使用您的窗口，但这就是 Windows 窗口的整个设计。

您可以使用工作线程来提供帮助，但让您的 GUI 在主线程上工作。

您会发现大多数窗口工具包也是单线程的（因为往往只有一个用户使用它们:)），那些并不比它们的价值更复杂。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-08T02:18:57.853

使用 .NET gui 和线程，MFC dll 中的主要应用程序代码。

通过 c# 委托调用它

# visual-studio - 在没有 Visual Studio 的情况下编译 .vbproj 或 .csproj 项目文件

> ID：266308
> 
> 赞同：26
> 
> 时间：2008-11-05T19:37:03.683
> 
> 标签：visual-studio, compilation, csproj, vb.net

有没有办法像 Visual Studio 一样直接编译 .vbproj 或 .csproj 项目文件？

在 Visual Studio 中编译时，“输出”窗口会显示对编译器的实际调用，通常如下所示：

vbc.exe [一堆选项] [looooong .vb 文件列表]

我想以编程方式调用“某事”，它将获取 .vbproj 文件并执行 Visual Studio 所做的任何事情来生成这个长命令行。我知道我*可以*自己解析 .vbproj 并生成该命令行，但我宁愿为自己节省所有的逆向工程和反复试验......

有没有工具可以做到这一点？我宁愿能够在没有安装 Visual Studio 的机器上完成它。但是，如果有一种方法可以使用一些参数调用 Visual Studio 来执行此操作，那也可以。

我简要地查看了 MSBuild，它看起来像是我必须特别制作的 .proj 项目文件，并且每次我将文件添加到 .vbproj 文件时都需要更新。（我确实*简要地*看了它，所以很可能我错过了一些重要的东西）

任何帮助将不胜感激

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-11-05T19:39:43.837

MSBuild 是最简单的方法。例如：

```
msbuild /property:Configuration=Release MyFile.vbproj 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-05T19:39:33.633

MSBuild 还可以获取您的解决方案文件并使用它来进行编译。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T19:42:46.373

您可以使用 MSBUILD 或 CSC。正如您所提到的，MSBuild 确实使用您的项目和解决方案文件。CSC 将编译特定文件，或特定目录树中的所有文件。

您还应该考虑使用 NAnt 和/或 CruiseControl.net 自动化您的构建。

此外，这里是一个关于如何在没有 Visual Studio 的情况下使用 CSC 编译代码的示例。 [http://blog.slickedit.com/?p=163](http://blog.slickedit.com/?p=163)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-22T04:48:50.210

只是让您知道 .vbproj 和 .csproj 文件是 MSBuild。因此，您阅读的所有内容都可以直接应用于这些文件。

赛义德·易卜拉欣·哈希米

我的书：[Microsoft Build Engine 内部：使用 MSBuild 和 Team Foundation Build](https://rads.stackoverflow.com/amzn/click/com/0735626286)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-09-10T14:29:48.013

在项目解决方案文件夹中：

```
msbuild wpfapp1.sln /p:BuildProjectReferences=true 
```

MSbuild 通常位于：

```
C:\Windows\Microsoft.NET\Framework64\v4.0.30319 
```

（或类似的东西，取决于版本）

csc.exe 编译文件，msbuild 编译项目和解决方案

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-09-16T04:13:01.397

.vbproj 文件的顶部是一个 . 将此行添加到属性组以抑制 VB 运行时：

```
<NoVBRuntimeReference>On</NoVBRuntimeReference> 
```

MSBuild 完成其余的工作。如果您有 IDE，则无需使用命令行。

# css - 使用 CSS 构建盒子阴影的最有效方法

> ID：266321
> 
> 赞同：2
> 
> 时间：2008-11-05T19:40:11.243
> 
> 标签：css

我很想知道用 css 创建盒子阴影的哪种方法最有效。但我的意思是：易于实施、灵活性和跨浏览器兼容性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T19:45:46.630

洋葱皮是我个人的最爱。

可以在此[alistpart 文章](http://www.alistapart.com/articles/onionskin/)中找到一个示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-05-17T18:27:28.270

这现在很容易实现：

```
box-shadow: 3px 3px 3px rgba(0,0,0,0.33); 
```

第一个值是水平偏移。第二个值是垂直偏移。第三个值是模糊效果的扩散。第四个值是颜色。

此外，您可以添加另一个值`inset`，这将使阴影出现在块元素的内部：

```
box-shadow: 3px 3px 3px rgba(0,0,0,0.33) inset; 
```

这现在得到了很好的支持：[https ://caniuse.com/#feat=css-boxshadow](https://caniuse.com/#feat=css-boxshadow)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-05T19:46:54.977

我认为目前最有效的方法是：

需要的 CSS 规则：

```
    。阴影{
      位置：相对；
      显示：块；
      背景颜色：#bbb;
      边框：1px纯黑色；
    }

    .shadowed_item{
        位置：相对；
        边框：1px纯黑色；
        背景颜色：白色；
        顶部：-5px；
        左：-5px；
    }

```

应用 CSS 的 HTML 代码：

```
<div 类='影子'>
    <div class='shadowed_item'>我有影子。</div>
</div>

```

我发现它实现起来非常简单、灵活，并且在 FF 3、IE 6 和 7 上的工作方式相同。

# limit - GET 请求的长度是否有限制？

> ID：266322
> 
> 赞同：151
> 
> 时间：2008-11-05T19:40:34.550
> 
> 标签：limit, http-get

GET 请求的长度是否有限制？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-11-05T19:43:56.480

不在[RFC](http://www.faqs.org/rfcs/rfc2068.html)中，不，但有实际限制。

*HTTP 协议对 URI 的长度没有任何先验限制。服务器必须能够处理它们所服务的任何资源的 URI，并且如果它们提供可以生成此类 URI 的基于 GET 的表单，则应该能够处理无限长度的 URI。如果 URI 比服务器可以处理的长（参见第 10.4.15 节），服务器应该返回 414（Request-URI Too Long）状态。*

*注意：服务器应谨慎依赖 URI 长度超过 255 字节，因为一些较旧的客户端或代理实现可能无法正确支持这些长度。*

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2008-11-05T19:44:53.637

[这篇文章](https://web.archive.org/web/20090221071427/http://www.boutell.com/newfaq/misc/urllength.html)总结的很好

摘要：它依赖于实现，因为 RFC 中没有指定限制。最多使用 2000 个字符（IE 的限制）是安全的。如果您接近这个长度，您应该确保您确实需要这么长的 URI，也许另一种设计可以解决这个问题。

URI 应该是可读的，即使在用于发送数据时也是如此。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2013-07-14T01:38:17.523

应用户 Erickson 的要求，我发表我的评论作为答案：

我在服务器端对 IE8、IE9、FF14、Opera11、Chrome20 和 Tomcat 6.0.32（全新安装）、Jersey 1.13 进行了更多测试。我使用了 jQuery 函数 $.getJson 和 JSONP。结果：所有浏览器最多允许大约 5400 个字符。FF 和 IE9 最多处理了大约 6200 个字符。以上所有内容都返回“400 Bad request”。我没有进一步调查 400 的原因。我发现的最大值很好，因为我需要大约 2000 个字符。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-11-05T19:46:29.610

该规范不限制 HTTP Get 请求的长度，但不同的浏览器实现了自己的限制。例如，Internet Explorer 实施了 2083 个字符的限制。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-12-09T16:59:48.027

W3C 明确否认这是一个神话

[http://www.w3.org/2001/tag/doc/get7#myths](http://www.w3.org/2001/tag/doc/get7#myths)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-01-05T16:41:25.313

带有 contentLength 参数的 setFixedLengthStreamingMode(int) 可以设置 HTTP 请求正文的固定长度。

# c++ - 如何将 bool 转换为 BOOL？

> ID：266326
> 
> 赞同：4
> 
> 时间：2008-11-05T19:41:31.117
> 
> 标签：c++, winapi, casting, boolean

通过此构造将 C++ bool 转换为 Windows API BOOL 是否安全

```
bool mybool = true;
BOOL apiboolean = mybool ? TRUE : FALSE; 
```

我认为这是肯定的，因为我没有看到任何明显的问题，但我想花点时间问一下，因为这可能比看起来更微妙。

*感谢 Dima（温和地）以我最初提出问题的方式指出我的粗心。*

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-05T19:43:26.527

你的意思是

```
 bool b;
...
BOOL apiboolean = b ? TRUE : FALSE; 
```

如果是这样，那么是的，这将起作用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T20:12:54.907

是的，这会起作用，但是

```
bool b;
...
BOOL apiboolean = (BOOL) b; 
```

应该也能正常工作，反之亦然：

```
bool bb = (bool) apiboolean; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-31T16:39:31.907

Visual Studio 2005 将简单地接受：

```
bool b = true;
BOOL apiboolean = b; 
```

*无需铸造*。

请注意，相反的 BOOL->bool 并不是像这样简单地工作。

# javascript - 用 JS 函数替换链接的最佳方法是什么？

> ID：266327
> 
> 赞同：13
> 
> 时间：2008-11-05T19:42:03.987
> 
> 标签：javascript

在我正在工作的一个网络应用程序中开始大量出现的一种模式是以前只是常规 a-tag 链接的链接，现在需要一个弹出框询问“你确定吗？” 在链接消失之前。（如果用户点击取消，什么都不会发生。）

我们有一个可行的解决方案，但不知何故，我们是一个没有 Javascript 专家的网络应用商店，所以我留下了这种爬行的感觉，好像有更好的方法来完成工作。

那么，JS 专家们，什么是最符合标准、跨浏览器的方式来完成这项工作？

（为了记录，这已经是一个需要 JS 的站点，所以不需要有“非 JS”版本。但是，它确实需要在任何和所有相当现代的浏览器中工作。）

（此外，对于奖励积分，如果关闭 JS 的人没有链接工作，而不是绕过确认框，那将是很好的。）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-05T20:06:17.650

**不显眼的 Javascript**

最佳做法是将事件处理程序方法添加到链接。

*confirm()*函数生成您描述的对话框，并根据用户的选择返回 true 或 false。

链接上的事件处理方法有一个特殊的行为，如果它们返回 false，它们会终止链接操作。

```
var link = document.getElementById('confirmToFollow');

link.onclick = function () {
    return confirm("Are you sure?");
}; 
```

如果您希望链接**需要 javascript**，则必须编辑 HTML。删除href：

```
<a href="#" id="confirmToFollow"... 
```

您可以在事件处理程序中显式设置链接目标：

```
var link = document.getElementById('confirmToFollow');

link.onclick = function () {
    if( confirm("Are you sure?") ) {
        window.location = "http://www.stackoverflow.com/";
    }
    return false;
}; 
```

如果您想在多个链接上调用相同的方法，您可以获取所需链接的 nodeList，并在循环通过 nodeList 时将该方法应用于每个链接：

```
var allLinks = document.getElementsByTagName('a');
for (var i=0; i < allLinks.length; i++) {
    allLinks[i].onclick = function () {
        return confirm("Are you sure?");
    };
} 
```

这里还有相同想法的进一步排列，例如使用类名来确定哪些链接将侦听该方法，并根据其他一些标准将唯一位置传递给每个链接。他们是六个之一，六个另一个。

**替代方法（不鼓励的做法）：**

一种**不鼓励的做法**是通过**onclick 属性**附加方法：

```
<a href="mypage.html" onclick="... 
```

另一个**不鼓励的做法**是将**href 属性**设置为函数调用：

```
<a href="javascript: confirmLink() ... 
```

请注意，这些不鼓励的做法都是可行的解决方案。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-05T19:45:07.553

以下是我们的做法：

```
<a href="#" onClick="goThere(); return false;">Go to new page</a>`

function goThere() 
{ 
   if( confirm("Are you sure?") ) 
    { 
       window.location.href="newPage.aspx"; 
    } 
} 
```

（编辑：代码重新格式化以避免水平滚动）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-05T19:45:19.923

```
<a href="http://..." onclick="return confirm('are you sure?')">text</a> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-05T20:06:59.070

如果你使用 jQuery，你会这样做：

```
jQuery(document).ready(
    jQuery("a").click(){
        //you'd place here your extra logic
        document.location.href = this.href;
    }
); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-05T20:04:01.603

在 jquery 中是这样的：

```
$("a").click(function() {if(confirm('yadda yadda')) event.stopPropagation();}); 
```

如果我理解 jgreep 提到的内容，如果您只希望确认出现在几个链接上，您可以将点击处理程序仅绑定到具有正确类的链接。您只能对锚点或任何具有该类的 html 元素执行此操作。

```
$(".conf").click(function() {if(confirm('yadda yadda')) event.stopPropagation();}); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-05T20:03:36.487

类绑定版本（不需要内联 onclick 属性）：在所有可确认控件之后链接此外部 <脚本>：

```
// dangerous - warnings on potentially harmful actions
// usage: add class="dangerous" to <a>, <input> or <button>
// Optionally add custom confirmation message to title attribute

function dangerous_bind() {
    var lists= [
        document.getElementsByTagName('input'),
        document.getElementsByTagName('button'),
        document.getElementsByTagName('a')
    ];
    for (var listi= lists.length; listi-->0;) { var els= lists[listi];
        for (var eli= els.length; eli-->0;) { var el= els[eli];
            if (array_contains(el.className.split(' '), 'dangerous'))
                el.onclick= dangerous_click;
        }
    }
}

function array_contains(a, x) {
    for (var i= a.length; i-->0;)
        if (a[i]==x) return true;
    return false;
}

function dangerous_click() {
    return confirm(this.title || 'Are you sure?');
}

dangerous_bind(); 
```

由于提交/按钮上的绑定也起作用，这有点冗长。通常，尽管拥有“危险”选项是有意义的，但您希望在按钮而不是链接上进行确认。由链接触发的 GET 请求不应真正产生任何积极影响。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-05T20:04:58.217

```
var links = document.getElementsByTagName('A');

for (var i = 0; i < links.length; i++)
{ 
    links[i].onclick = function ()
    {       
       return Confirm("Are you sure?");
    }
} 
```

这会将消息应用于所有链接，但是在没有 javascript 的情况下使链接无法自动工作有点困难（实际上是不可能的）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-05T20:11:45.940

看看[打开新浏览器窗口的最佳方式是什么](https://stackoverflow.com/questions/233467/whats-the-best-way-to-open-new-browser-window)。您可以做类似的事情，但在打开新窗口之前抛出确认。

# c# - 将非托管 directX 嵌入到 C# 表单中

> ID：266328
> 
> 赞同：2
> 
> 时间：2008-11-05T19:42:17.170
> 
> 标签：c#, c++, directx, rendering

我有一个关于在托管环境中运行 directX 应用程序 (C++) 的快速问题。我正在尝试编写一个 MDI 工具（在 C# 中），其中父窗口的背景将是 directX（C++）的嵌入式渲染窗口。

我已经阅读了将 C++ 写入本机 dll 的方法，但是最好能够将 C++ 项目包含在解决方案中（我什至不知道这是否可能）。不管怎样，如果您知道一些有用的步骤、提示，或者这通常是个坏主意，请告诉我。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-05T20:26:17.300

最简单的方法是将 C++/CLI 项目添加到您的解决方案中。这将使您能够直接使用 DirectX COM 接口并创建一个易于从您的 C# 代码调用的托管包装器。我已经多次采用这种方法，这是迄今为止我尝试过的最简单的混合 DirectX 和 .Net 的方法。托管 DirectX 曾经是一个选项，但它不再受支持，而且无论如何它只是完整 COM API 的一个相当小的子集。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T20:23:08.507

首先，在不同的 dll 文件中编写 C++ 部分并不意味着它不能与 C# 项目采用相同的解决方案。

为了使用本机 DX 在托管窗口上呈现，您需要将 HWND 窗口 ID（使用 form.WindowId.ToInt32）传递给 C++ D3Ddevice c'tor。之后，每次您使用该设备进行渲染时，它都会在 .NET 窗口上渲染。

为此，您可能需要两个单独的项目——一个 C++ dll 和 .NET 项目。使用 COM 包装器或 p-invoke 将 HWND 传递给 C++ dll。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T06:07:59.060

如果你不想花太多时间为 DirectX 编写 C++ 代码，你可以考虑使用 [SlimDX](http://slimdx.mdxinfo.com/)，因为托管 DirectX 1.0 是不可能的，因为 2.0 永远不会离开测试版，后来用 XNA 替换它有很大的不同来自 DirectX 本身，并要求您安装 XNA Game Studio

[SlimDX](http://slimdx.mdxinfo.com/)是托管 Directx 的开源版本，API 和内部结构略有不同，但易于使用。最近发布的版本非常稳定。我目前正在使用它来编写生产应用程序。

[SlimDX](http://slimdx.mdxinfo.com/)

[托管 DirectX](http://en.wikipedia.org/wiki/Managed_DirectX)

# ms-access - 在数据表对象中使用 ColumnHidden 属性

> ID：266332
> 
> 赞同：4
> 
> 时间：2008-11-05T19:42:41.210
> 
> 标签：ms-access, subform, datasheet

我有一个带有**数据表**子表单的**MS Access表单。** 使用代码，我更改了它的各个列的**ColumnHidden属性。**但是，当我关闭表单时，系统会询问我是否保存数据表表格的表格布局。

 *****   如何阻止表单不断要求用户使用相同的表格布局？
*   我是否别无选择，只能将数据表更改为常规子表单？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T20:21:40.693

如果您总是隐藏相同的列 - 创建一个仅包含您想要显示的列的查询，并将其用作子表单的来源。

如果您仍然需要一些隐藏字段（子键等），则必须创建一个常规表单。还不错：

*   把它放在你的桌子上，
*   将列拖到表单上（格式和位置无关紧要）
*   将其设置为数据表视图
*   编辑标签（这些成为列标题）
*   更改标签顺序（这控制了列的显示顺序）
*   查看数据表并隐藏所需的列
*   保存表格
*   将此表单作为子表单添加到主表单

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T04:43:56.530

我不确定是否有一种简单的方法可以做到这一点，因为 Access 使用表单保存了很多属性。如果您没有使用数据表视图，您可以隐藏表单上的 CLOSE 按钮并将其替换为命令按钮以使用以下代码关闭表单：

```
 DoCmd.Close acForm, Me.Name, acSaveNo 
```

但是因为它是一个数据表，所以你不能这样做。

您可以尝试将数据表作为子表单嵌入到未绑定的父表单中，但我不知道在父表单上的命令按钮后面使用上面的代码是否会将列宽保存到嵌入的子表单。

一种解决方案是在数据表的 OnLoad 事件中重新初始化列宽。然后，您可以使用 acHidden 打开表单，并在 OnLoad 事件中，将列宽设置为正确的值（您需要将英寸乘以 1440 以获取缇值以分配给列宽属性），然后在在 OnLoad 结束时，将 Me.Hidden 设置为 False。

但这确实是一件让人头疼的事情。

恐怕这是使用数据表的缺点之一，因为无法定义不会保存最终用户 UI 数据的关闭命令按钮。

# c - 在 C 中标记字符串

> ID：266357
> 
> 赞同：25
> 
> 时间：2008-11-05T19:46:47.923
> 
> 标签：c, string, tokenize

我一直在尝试使用 SPACE 作为分隔符来标记字符串，但它不起作用。有没有人建议它为什么不起作用？

编辑：使用标记化：

```
strtok(string, " "); 
```

代码如下

```
pch = strtok (str," ");
while (pch != NULL)
{
  printf ("%s\n",pch);
  pch = strtok (NULL, " ");
} 
```

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-05T19:57:39.180

像这样做：

```
char s[256];
strcpy(s, "one two three");
char* token = strtok(s, " ");
while (token) {
    printf("token: %s\n", token);
    token = strtok(NULL, " ");
} 
```

注意：`strtok`修改字符串的标记，所以它不能是`const char*`.

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-11-05T19:57:53.673

这是一个`strtok`使用示例，请记住它*会*`strtok`破坏其输入字符串（因此不能用于字符串常量

 *```
char *p = strtok(str, " ");
while(p != NULL) {
    printf("%s\n", p);
    p = strtok(NULL, " ");
} 
```

基本上要注意的是，传递 a`NULL`作为第一个参数`strtok`告诉它从之前标记的字符串中获取下一个标记。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-05T20:14:22.160

strtok 可能非常危险。它不是线程安全的。它的预期用途是在循环中一遍又一遍地调用，传入前一个调用的输出。strtok 函数有一个内部变量，用于存储 strtok 调用的状态。这种状态不是每个线程独有的——它是全局的。如果任何其他代码在另一个线程中使用 strtok，就会出现问题。也不是您要追踪的问题！

我建议寻找一个正则表达式实现，或者使用 sscanf 来分离字符串。

尝试这个：

```
char strprint[256];
char text[256];
strcpy(text, "My string to test");
while ( sscanf( text, "%s %s", strprint, text) > 0 ) {
   printf("token: %s\n", strprint);
} 
```

注意：'text' 字符串在分离时被破坏。这可能不是首选行为 =)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-05T20:02:26.270

您可以通过引入一个额外的变量来简化代码。

```
#include <string.h>
#include <stdio.h>

int main()
{
    char str[100], *s = str, *t = NULL;

    strcpy(str, "a space delimited string");
    while ((t = strtok(s, " ")) != NULL) {
        s = NULL;
        printf(":%s:\n", t);
    }
    return 0;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-09-02T20:00:06.397

我制作了一些字符串函数来拆分值，尽可能使用更少的指针，因为此代码旨在在 PIC18F 处理器上运行。当可用的可用 RAM 很少时，这些处理器不能很好地处理指针：

```
#include <stdio.h>
#include <string.h>

char POSTREQ[255] = "pwd=123456&apply=Apply&d1=88&d2=100&pwr=1&mpx=Internal&stmo=Stereo&proc=Processor&cmp=Compressor&ip1=192&ip2=168&ip3=10&ip4=131&gw1=192&gw2=168&gw3=10&gw4=192&pt=80&lic=&A=A";

int findchar(char *string, int Start, char C) {
    while((string[Start] != 0)) { Start++; if(string[Start] == C) return Start; }
    return -1;
}

int findcharn(char *string, int Times, char C) {
   int i = 0, pos = 0, fnd = 0;

    while(i < Times) {
       fnd = findchar(string, pos, C);
        if(fnd < 0) return -1;
        if(fnd > 0) pos = fnd;
       i++;
   }
   return fnd;
}

void mid(char *in, char *out, int start, int end) {
    int i = 0;
    int size = end - start;

    for(i = 0; i < size; i++){
        out[i] = in[start + i + 1];
    }
    out[size] = 0;
}

void getvalue(char *out, int index) {
    mid(POSTREQ, out, findcharn(POSTREQ, index, '='), (findcharn(POSTREQ, index, '&') - 1));
}

void main() {
   char n_pwd[7];
   char n_d1[7];

   getvalue(n_d1, 1);

   printf("Value: %s\n", n_d1);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-05T19:51:27.197

在阅读 strtok 文档时，我看到您需要在第一次“初始化”调用之后传入一个 NULL 指针。也许你没有那样做。当然只是猜测。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-02-18T22:44:24.957

这是另一个`strtok()`实现，它能够识别连续的分隔符（标准库`strtok()`没有这个）

该函数是 BSD 许可字符串库的一部分，称为[zString](https://github.com/fnoyanisi/zString)。非常欢迎您贡献:)

[https://github.com/fnoyanisi/zString](https://github.com/fnoyanisi/zString)

```
char *zstring_strtok(char *str, const char *delim) {
    static char *static_str=0;      /* var to store last address */
    int index=0, strlength=0;       /* integers for indexes */
    int found = 0;                  /* check if delim is found */

    /* delimiter cannot be NULL
    * if no more char left, return NULL as well
    */
    if (delim==0 || (str == 0 && static_str == 0))
        return 0;

    if (str == 0)
        str = static_str;

    /* get length of string */
    while(str[strlength])
        strlength++;

    /* find the first occurance of delim */
    for (index=0;index<strlength;index++)
        if (str[index]==delim[0]) {
            found=1;
            break;
        }

    /* if delim is not contained in str, return str */
    if (!found) {
        static_str = 0;
        return str;
    }

    /* check for consecutive delimiters
    *if first char is delim, return delim
    */
    if (str[0]==delim[0]) {
        static_str = (str + 1);
        return (char *)delim;
    }

    /* terminate the string
    * this assignmetn requires char[], so str has to
    * be char[] rather than *char
    */
    str[index] = '\0';

    /* save the rest of the string */
    if ((str + index + 1)!=0)
        static_str = (str + index + 1);
    else
        static_str = 0;

        return str;
} 
```

正如在之前的文章中提到的，因为`strtok()`，或者我上面实现的那个，依赖于一个`static *char`变量来保存连续调用之间最后一个分隔符的位置，所以在处理多线程应用程序时应该格外小心。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-11-01T05:12:32.197

```
int not_in_delimiter(char c, char *delim){

    while(*delim != '\0'){
            if(c == *delim) return 0;
            delim++;
    }
    return 1;
}

char *token_separater(char *source, char *delimiter, char **last){

char *begin, *next_token;
char *sbegin;

/*Get the start of the token */
if(source)
  begin = source;
else
  begin = *last;

sbegin = begin;

/*Scan through the string till we find character in delimiter. */
while(*begin != '\0' && not_in_delimiter(*begin, delimiter)){
       begin++;
}

/* Check if we have reached at of the string */
if(*begin == '\0') {
/* We dont need to come further, hence return NULL*/
   *last = NULL;
    return sbegin;
}
/* Scan the string till we find a character which is not in delimiter */
 next_token  = begin;
 while(next_token != '\0' && !not_in_delimiter(*next_token, delimiter))    {
    next_token++;
 }
 /* If we have not reached at the end of the string */
 if(*next_token != '\0'){
  *last = next_token--;
  *next_token = '\0';
   return sbegin;
}
}

 void main(){

    char string[10] = "abcb_dccc";
    char delim[10] = "_";
    char *token = NULL;
    char *last = "" ;
    token  = token_separater(string, delim, &last);
    printf("%s\n", token);
    while(last){
            token  = token_separater(NULL, delim, &last);
            printf("%s\n", token);
    } 
```

}

您可以在我的个人资料中提到的博客上阅读详细分析:)

# sql - SQL 性能和 MD5 字符串

> ID：266364
> 
> 赞同：1
> 
> 时间：2008-11-05T19:47:47.813
> 
> 标签：sql, md5

我有一个数据库表，我们在其中存储了很多 MD5 哈希（是的，我知道它们不是 100% 唯一的......）我们有很多针对这些字符串的比较查询。该表可能会变得非常大，行数超过 5M。

我的问题是：将数据保存为十六进制字符串是否明智，或者我应该将十六进制转换为二进制或十进制以便更好地查询？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T19:54:21.903

二进制可能更快，因为对于文本，您使用 8 位（一个完整字符）来编码 4 位数据。但是我怀疑您是否真的会注意到很多差异。

我在哪里，我们有一张非常相似的桌子。它将医生的听写文本保存在文本列中以用于计费目的（仍在 sql server 2000 上）。我们正在接近 400 万条记录，我们需要能够检查重复项，其中医生出于验证和合规目的两次口述完全相同的内容。一个听写可以运行多个页面，因此我们还有一个在插入时通过触发器填充的哈希列。该列是 char(32) 类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T20:47:24.200

二进制数据很难手动处理，或者如果您必须将数据转储到文本文件或其他文件中。

只需在哈希列上放一个索引就可以了。

# java - 如何在 java 中对 jdbc 代码进行单元测试？

> ID：266370
> 
> 赞同：47
> 
> 时间：2008-11-05T19:48:42.087
> 
> 标签：java, database, unit-testing, jdbc, junit

我想为连接到数据库的一些代码编写一些单元测试，运行一个或多个查询，然后处理结果。（没有实际使用数据库）

这里的另一位开发人员编写了我们自己的 DataSource、Connection、Statement、PreparedStatement 和 ResultSet 实现，它们将根据 xml 配置文件返回相应的对象。（我们可以使用伪造的数据源并针对它返回的结果集运行测试）。

我们在这里重新发明轮子吗？单元测试是否已经存在类似的东西？还有其他/更好的方法来测试 jdbc 代码吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-22T09:20:59.587

你有几个选择：

*   使用 Mock 库模拟数据库，例如[JMock](http://www.jmock.org/)。这样做的巨大缺点是您的查询和数据很可能根本没有经过测试。
*   使用轻量级数据库进行测试，例如[HSQLDB](http://hsqldb.org/)。如果您的查询很简单，这可能是最简单的方法。
*   专门用于测试的数据库。[DBUnit](http://dbunit.sourceforge.net/)是一个不错的选择，或者如果您使用 Maven，您也可以使用[sql-maven-plugin](http://www.mojohaus.org/sql-maven-plugin/)正确设置和拆除数据库（注意测试之间的依赖关系）。我推荐这个选项，因为它会给你最大的信心，让你的查询与你的数据库供应商一起正常工作。

有时使这些测试可配置是必要且有用的，以便仅在数据库可用时执行这些测试。这可以通过例如构建属性来完成。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-05T19:56:03.693

例如，您可以将[DBUnit](http://dbunit.sourceforge.net/)与[HSQLDB](http://hsqldb.org/)一起使用，后者可以从 CSV 文件中读取其初始数据。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-01-03T20:16:26.433

我喜欢使用以下组合：

*   [数据库单元](http://dbunit.sourceforge.net/)
*   [数据库](http://hsqldb.org/)
*   [Unitils](http://unitils.org)（特别是[数据库测试](http://unitils.org/tutorial-database.html)和[维护模块](http://unitils.org/tutorial-dbmaintain.html)）

仅使用 DBUnit 和 HSQLDB 就可以走得更远。Unitils 提供了最后一英里的代码来管理和重置数据库状态。它还提供了一种管理数据库模式更改的好方法，并且可以轻松使用特定的 RBDMS（Oracle、DB2、SQL Server 等）。最后，Unitils 围绕 DBUnit 提供了一些很好的包装器，它使 API 现代化并使 DBUnit 更易于使用。

如果您还没有检查过 Unitils，那么您绝对应该检查过。Unitils 经常被忽视和低估。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-05T19:59:20.363

这就是为什么您有[derby](http://db.apache.org/derby/)（现在称为 JavaDB）或[sqlite](http://www.zentus.com/sqlitejdbc/)的原因——它们是小型、简单的数据库，您可以相对快速而简单地创建、加载、测试和销毁它们。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-07T08:17:49.983

我会说 HSQL 是您的单元测试期间要走的路。您的测试重点是测试您的 jdbc 代码并确保其正常工作。添加自定义类或模拟 jdbc 调用可以轻松隐藏错误。

我主要使用 mysql，当测试运行驱动程序类时，url 更改为 org.hsqldb.jdbcDriver 和 jdbc:hsqldb:mem:test。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-12-01T13:06:25.560

我更喜欢使用[EasyMock](http://easymock.org/)来测试*不太容易测试的代码*。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-01-03T10:22:42.003

如果您想做单元测试，而不是集成测试，那么您可以使用非常基本且简单的方法，仅使用 Mockito，如下所示：

```
public class JDBCLowLevelTest {

    private TestedClass tested;
    private Connection connection;
    private static Driver driver;

    @BeforeClass
    public static void setUpClass() throws Exception {
        // (Optional) Print DriverManager logs to system out
        DriverManager.setLogWriter(new PrintWriter((System.out)));

        // (Optional) Sometimes you need to get rid of a driver (e.g JDBC-ODBC Bridge)
        Driver configuredDriver = DriverManager.getDriver("jdbc:odbc:url");

        System.out.println("De-registering the configured driver: " + configuredDriver);
        DriverManager.deregisterDriver(configuredDriver);

        // Register the mocked driver
        driver = mock(Driver.class);
        System.out.println("Registering the mock driver: " + driver);
        DriverManager.registerDriver(driver);
    }

    @AfterClass
    public static void tearDown() throws Exception {
        // Let's cleanup the global state
        System.out.println("De-registering the mock driver: " + driver);
        DriverManager.deregisterDriver(driver);
    }

    @Before
    public void setUp() throws Exception {
        // given
        tested = new TestedClass();

        connection = mock(Connection.class);

        given(driver.acceptsURL(anyString())).willReturn(true);
        given(driver.connect(anyString(), Matchers.<Properties>any()))
                .willReturn(connection);

        given(connection.prepareCall(anyString())).willReturn(statement);        
    }
} 
```

你可以测试各种场景，就像在任何其他 Mockito 测试中一样

```
@Test
public void shouldHandleDoubleException() throws Exception {
    // given
    SomeData someData = new SomeData();

    given(connection.prepareCall(anyString()))
            .willThrow(new SQLException("Prepare call"));
    willThrow(new SQLException("Close exception")).given(connection).close();

    // when
    SomeResponse response = testClass.someMethod(someData);

    // then
    assertThat(response, is(SOME_ERROR));
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-05T19:51:20.317

有[DBUnit](http://www.dbunit.org/)。它不允许您在没有数据库的情况下测试 jdbc 代码，但您似乎可以通过模拟数据库来引入一组不同的购买。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-08T14:09:08.463

虽然在您的应用程序中模拟 jdbc 的方式当然取决于您如何实现实际的 jdbc 事务。

如果您按原样使用 jdbc，我假设您已经为自己编写了一个实用程序类来执行`DBUtils.getMetadataFor(String tablename)`. 这意味着您必须创建该类的模拟，而这可能就是您所需要的。这对您来说是一个相当简单的解决方案，因为您显然已经有一系列可用的 jdbc 相关模拟对象。请注意，我假设您的 jdbc 代码没有在应用程序周围爆炸——如果是，请重构！！！

但是，如果您使用任何数据库处理框架（例如 Spring Framework 的 JDBC 模板类），您可以并且应该使用 EasyMock 或其他等效物来模拟接口类。这样，您就可以拥有轻松模拟连接所需的所有功能。

最后，如果没有其他方法，您可以执行其他人已经说过的操作并使用 DBUnit 和/或 derby。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-09-14T15:40:50.893

我们使用 Mockrunner。[http://mockrunner.sourceforge.net/](http://mockrunner.sourceforge.net/) 它内置了模拟连接和数据源，因此无需您自己实现它们。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-12-31T08:47:03.617

Acolyte 驱动程序可用于模拟 JDBC 连接，在测试期间对其进行管理并将数据作为结果集返回（使用其类型安全的行列表 API）：[https ://github.com/cchantep/acolyte](https://github.com/cchantep/acolyte)

注意：我是 Acolyte 的作者。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-02-24T20:20:04.523

看看 JDBDT：http: [//jdbdt.org](http://jdbdt.org)

您可以将它用于数据库设置和断言，作为 DBUnit 的替代品。

注意：我是 JDBDT 的作者。

# vim - 在 VIM 命令行模式下，当前行的特殊字符/符号是什么？

> ID：266371
> 
> 赞同：13
> 
> 时间：2008-11-05T19:49:00.917
> 
> 标签：vim

在命令行模式下的 VIM 中，“%”表示当前文件，“cword”表示光标下的当前单词。我想创建一个需要当前行号的快捷方式。表示这个的符号是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-05T19:52:41.610

. （点）代表当前行。

澄清一下：这适用于`:1,.s/foo/bar/g`将 every 转换`foo`为`bar`从文件开头到当前行的内容。

我不知道有一种方法可以为 shell 命令扩展当前行号，这就是你想要做的事情`:!echo .`

`%`您可以了解`#`在`:he cmdline-special`.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-07T21:23:03.143

如果你想将当前行号传递给 shell 命令，你可以这样做

```
:exe "!echo " . line(".") 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-06T07:38:11.950

要在屏幕底部返回当前行的行号，请使用：

```
:.= 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-06T07:07:36.397

vim 中的命令适用于当前行，因此：

```
:s/foo/bar/g 
```

将转换您当前所在行的*bar中的每个**foo 。*

 *# database - 是否可以在当前数据库以外的数据库上查询@@DBTS？

> ID：266372
> 
> 赞同：1
> 
> 时间：2008-11-05T19:49:08.217
> 
> 标签：database, sql-server-2005, tsql, timestamp

对于源数据库状态的严格标记，我想在存储过程中捕获外部数据库的@@DBTS。是的，我想我可以发出

> `USE ExternalDB
> GO
> 
> SELECT @myVarbinary8 = @@DBTS
> GO
> 
> USE OriginalDB
> GO`

但是，即使我可以，它看起来也很丑。

现在，我在源数据库中嵌入了一个标量值函数来调用

设置@Result = 选择@@DBTS

在我忘记要求 DBA 为新用户授予适当的权限之前，它工作得很好，这导致了一个进程崩溃。

类似于

> `SELECT ExternalServer.dbo.@@DBTS`
> 
> （我知道那行不通）。

请参阅   [MSDN @@DBTS 文档](http://msdn.microsoft.com/en-us/library/ms187366(SQL.90).aspx)

> @@DBTS (Transact-SQL)
> 返回当前数据库的当前时间戳数据类型的值。
> 此时间戳保证在数据库中是唯一的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T20:08:36.570

一种方法是将该标量函数放在主数据库中并将其标记为系统对象。这样它会在当前数据库的上下文中被调用，更多信息请参见此处： [http ://weblogs.sqlteam.com/mladenp/archive/2007/01/18/58287.aspx](http://weblogs.sqlteam.com/mladenp/archive/2007/01/18/58287.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-06T10:21:21.777

*在“其他”*数据库中创建存储过程：

```
CREATE PROCEDURE dbo.GetDatabaseTimestamp AS
   SET NOCOUNT ON;
   SELECT @@DBTS AS CurrentRowversion, MIN_ACTIVE_ROWVERSION() AS ActiveRowversion 
```

然后从您当前的数据库中，您可以调用：

```
EXECUTE ExternalDB.dbo.GetDatabaseTimestamp; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-06T01:27:00.560

感谢您提供信息，Mladen，很高兴知道这个提示:)

但是，虽然这有助于我从当前数据库上下文“ContextCurrent”中调用驻留在 master 中的函数，但我真正想要的是能够从源数据库“ContextSource”的上下文中调用标量值函数。

虽然总的来说，我对动态 sql 有所保留，但我最终在这里使用它如下。

 `DECLARE @sourceDbName nvarchar(128)
SET     @sourceDbName = N'sbaportia1'

DECLARE @strQuery nvarchar(max)
DECLARE @parmDefn nvarchar(max)
DECLARE @DbtsCapture varbinary(8)
SET    @strQuery =
   '
          N' ' + N'USE' + N' ' + @sourceDbName + N' '
        + N' ' + N'SELECT @dbtsCapture = min_active_rowversion()'
   '

SET @parmDefn =
   N'
        @dbName varchar(128),
        @dbtsCapture varbinary(8) OUTPUT
   '

EXEC sp_executesql  @strQuery
                   ,@parmDefn
                   ,@dbName = 'autobahn'
                   ,@dbtsCapture = @dbtsCapture OUTPUT

SELECT @dbtsCapture`

此外，由于 sp_executesql 在单独的线程中运行，以下脚本中的数据库上下文将在 sp_executesql 退出时与 sp_executesql 进入时自动相同。（我在 2000 年代初期对 sp_executesql 了解得太多了。）

# performance - 可以使用分析器，但为什么不直接停止程序呢？

> ID：266373
> 
> 赞同：45
> 
> 时间：2008-11-05T19:49:24.033
> 
> 标签：performance, optimization, profiling

如果某件事使单线程程序占用了 10 倍的时间，那么您可以在其上运行分析器。您也可以使用“暂停”按钮停止它，您将确切地看到它在做什么。

即使它只比应有的慢 10%，如果你停止它更多次，不久你就会看到它反复做不必要的事情。通常问题是堆栈中间某处的函数调用并不是真正需要的。这不能衡量问题，但确实可以找到问题。

编辑：反对意见主要假设您只取 1 个样本。如果您是认真的，请取 10。平均而言，任何导致某些百分比浪费（例如 40%）的代码行都会出现在该部分样本的堆栈上。瓶颈（在单线程代码中）无法隐藏。

编辑：为了说明我的意思，许多反对意见的形式是“没有足够的样本，所以你看到的可能完全是虚假的”——关于机会的模糊想法。但是，如果*任何可识别的描述*（不仅仅是在例程中或例程处于活动状态）在 30% 的时间内有效，那么在任何给定样本上看到它的概率是 30%。

然后假设只取了 10 个样本。问题在 10 个样本中出现的次数服从[二项分布](http://en.wikipedia.org/wiki/Binomial_distribution)，出现 0 次的概率为 0.028。看到它 1 次的概率是 0.121。2 次，概率为 0.233，3 次为 0.267，之后下降。由于看到它少于两次的概率是 0.028 + .121 = .139，这意味着看到它两次或更多次的概率是 1 - .139 = .861。一般规则是，如果您看到可以在两个或更多样本上修复的内容，则值得修复。

在这种情况下，在 10 个样本中看到它的机会是 86%。如果你是那 14% 的人没有看到它，那就多采集一些样本，直到你看到为止。（如果样本数量增加到20个，看到两次或更多次的机会增加到99％以上。）所以它没有被精确测量，但它已经被精确地找到了，理解这一点很重要它很容易成为分析器实际上无法找到的东西，例如涉及数据状态的东西，而不是程序计数器。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-11-25T12:23:13.517

`Ctrl`在 Java 服务器上，`Breaks`连续执行 2-3 次快速操作并获得所有正在运行的线程的 2-3 次线程转储始终是一个巧妙的技巧。只需查看所有线程“在哪里”，就可以非常快速地确定性能问题所在。

与我所知道的任何其他技术相比，这种技术可以在 2 分钟内揭示更多的性能问题。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-11-05T19:52:34.607

因为有时它有效，有时它会给你完全错误的答案。分析器在找到正确答案方面的记录要好得多，而且通常可以更快地到达那里。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-11-05T19:51:56.930

手动执行此操作并不能真正称为“快速”或“有效”，但有几种分析工具可以自动执行此操作；也称为[统计分析](http://en.wikipedia.org/wiki/Code_profiling#Statistical_profilers)。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2011-11-28T00:46:14.527

调用堆栈采样是一种非常有用的分析技术，尤其是在查看可能在任意数量的地方花费时间的大型复杂代码库时。它具有通过挂钟时间测量 CPU 使用率的优势，这对交互性很重要，并且获取每个样本的调用堆栈可以让您了解调用函数的*原因。*我经常使用它，但我使用自动化工具，例如[Luke Stackwalker](http://lukestackwalker.sourceforge.net/)和[OProfile](http://oprofile.sourceforge.net/news/)以及各种硬件供应商提供的东西。

对于我所做的工作，我更喜欢自动化工具而不是手动采样的原因是[统计能力](http://en.wikipedia.org/wiki/Statistical_power)。当你有一个函数占用 40% 的运行时间时，手动抓取 10 个样本是很好的，因为平均而言你会在其中得到 4 个样本，而且总是至少有一个。但是当你有一个扁平的配置文件时，你需要更多的样本，有数百个叶函数，没有一个占用超过 1.5% 的运行时间。

假设你有一个湖泊，里面有许多不同种类的鱼。如果湖中 40% 的鱼是鲑鱼（以及 60% 的“其他”），那么你只需要钓到 10 条鱼就知道湖里有很多鲑鱼。但是如果你有数百种不同种类的鱼，而且每个种类的数量不超过 1%，那么你需要钓到十多条鱼才能说“这个湖有 0.8% 的鲑鱼和 0.6% 的鳟鱼” 。”

同样，在我开发的游戏中，有几个主要系统，每个系统都调用数百个不同实体中的数十个函数，所有这些都每秒发生 60 次。其中一些函数的时间集中到常见操作（如`malloc`）中，但大多数都没有，而且在任何情况下，没有一个叶子每帧占用超过 1000 μs。

我可以查看*主干*函数并看到“我们将 10% 的时间用于碰撞”，但这并不是很有帮助：我需要确切地知道*碰撞*的位置，所以我知道要挤压哪些函数。只是“减少碰撞”只能让你走这么远，尤其是当它意味着放弃功能时。我宁愿知道“我们在[八叉树](http://slantsixgames.com/~slantsix/uploads//documents/Collision%20Detection%20%20An%20Overview.pdf)的狭窄阶段平均花费 600 微秒/帧来处理缓存未命中，因为魔法导弹移动得如此之快并且触及了很多单元格”，因为这样我就可以找到确切的修复方法：要么是更好的树，要么是更慢的导弹。

如果有 20% 的大块，手动采样会很好`stricmp`，但是对于我们的配置文件，情况并非如此。相反，我需要从帧的 0.6% 到帧的 0.4% 获取数百个函数。我需要每 50 μs 的函数减少 10 μs，即每秒调用 300 次。为了获得这种精度，我需要更多的样本。

但本质上，Luke Stackwalker 所做的就是您所描述的：每毫秒左右，它会暂停程序并记录调用堆栈（包括[IP](http://en.wikipedia.org/wiki/Program_counter)的精确指令和行号）。有些程序只需要数万个样本就可以进行有用的分析。

（当然，我们之前已经讨论过这个问题，但我认为这是总结辩论的好地方。）

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-11-05T20:09:39.343

程序员实际做的事情和他们推荐别人做的事情是有区别的。

我知道很多程序员（包括我自己）实际使用这种方法。它只会真正有助于发现最明显的性能问题，但它又快又脏，而且很有效。

但我不会真的告诉其他程序员这样做，因为我要花很长时间来解释所有警告。根据这种方法很容易得出不准确的结论，而且有很多地方根本行不通。（例如，该方法不会显示任何由用户输入触发的代码）。

因此，就像在法庭上使用测谎仪或“goto”声明一样，我们只是不建议您这样做，即使它们都有其用途。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-10-28T07:13:11.103

我对双方的宗教语气感到惊讶。

剖析很棒，而且当你可以做到时，它肯定会更加精致和精确。有时你不能，有一个值得信赖的备份很好。暂停技术就像您在电动工具太远或电池耗尽时使用的手动螺丝刀。

这是一个简短的真实故事。一个应用程序（一种批处理任务）在生产环境中运行了六个月，突然间运营商打电话给开发人员，因为它“太慢了”。他们不会让我们在生产中附加采样分析器！您必须使用已安装的工具。在不停止生产过程的情况下，只需使用 [Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)（操作员已经安装在机器上），我们就可以看到线程堆栈的快照。您可以浏览堆栈的顶部，使用回车键将其关闭，然后再次单击鼠标获取另一个快照。您可以每秒钟左右轻松获得一个样本。

很快就可以看到栈顶最常出现在数据库客户端库 DLL（等待数据库）中，还是在另一个系统 DLL（等待系统操作）中，或者实际上在某个方法中应用程序本身。在这种情况下，如果我没记错的话，我们很快注意到应用程序在 10 次中有 8 次在系统 DLL 文件调用中读取或写入网络文件。果然，最近的“升级”改变了文件共享的性能特征。如果没有一种快速而肮脏的（系统管理员认可的）方法来查看应用程序*在生产*中做了什么，我们将花费更多的时间来尝试衡量问题，而不是纠正问题。

另一方面，当性能要求超出“足够好”而真正突破极限时，分析器就变得必不可少，这样您就可以尝试从所有密切相关的前 10 或 20 个热点中缩短周期。即使您只是想在项目期间保持适度的性能要求，当您可以获得正确的工具来帮助您测量和测试，甚至将它们集成到您的自动化测试过程中时，它也会非常有帮助。

但是当电源没电（可以这么说）并且电池没电时，很高兴知道如何使用手动螺丝刀。

所以直接的答案是：知道你可以从停止程序中学到什么，但也不要害怕精密工具。最重要的是知道哪些工作需要哪些工具。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-11-06T14:16:04.660

如果我们提出“为什么不为人所知？”这个问题。那么答案将是主观的。据推测，它之所以不为人所知的原因是因为分析提供了一个长期的解决方案，而不是当前的问题解决方案。它对多线程应用程序无效，并且对于花费大量时间渲染的游戏等应用程序无效。

此外，在单线程应用程序中，如果您有一个希望消耗最多运行时间的方法，并且您希望减少所有其他方法的运行时间，那么确定哪些次要方法将更加难以集中精力首先。

您的分析过程是一种可接受的方法，可以而且确实有效，但分析可以为您提供更多信息，并有利于向您展示更详细的性能改进和回归。

如果您有良好检测的代码，那么您可以检查的不仅仅是特定方法的持续时间；你可以看到所有的方法。

使用分析：

*   然后，您可以在每次更改后重新运行您的方案，以确定性能改进/退化的程度。

*   您可以在不同的硬件配置上分析代码，以确定您的生产硬件是否足够。

*   您可以在负载和压力测试场景下分析代码，以确定信息量如何影响性能

*   您可以让初级开发人员更轻松地可视化他们对您的代码所做的更改的影响，因为他们可以在您离开海滩或酒吧或两者兼而有之时在六个月内重新分析代码。海滩酒吧，英尺。

剖析被赋予了更多的权重，因为企业代码应该**始终**具有某种程度的剖析，因为它为组织提供了较长时间的好处。代码越重要，您进行的分析和测试就越多。

您的方法是有效的，另一个项目是开发人员的工具箱。它只是被分析所压倒。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-11-23T02:55:08.157

在“调试”模式下执行程序期间点击暂停按钮可能无法提供正确的数据来执行任何性能优化。坦率地说，这是一种粗略的剖析形式。

如果你必须避免使用分析器，更好的选择是使用记录器，然后应用减速因子来“猜测”真正的问题在哪里。然而，探查器是更好的猜测工具。

在调试模式下点击暂停按钮可能无法真实反映应用程序行为的原因是因为调试器引入了额外的可执行代码，可能会减慢应用程序的某些部分。关于调试环境中应用程序速度变慢的可能原因，可以参考[Mike Stall 的博客文章。](http://blogs.msdn.com/jmstall/archive/2006/10/23/debugger_5F00_slowdown.aspx)该帖子阐明了某些原因，例如断点过多、创建异常对象、未优化代码等。关于未优化代码的部分很重要 - “调试”模式将导致大量优化（通常是代码内联和重新ordering) 被抛出窗口，以使调试主机（运行代码的进程）和 IDE 同步代码执行。因此，在“调试”模式下反复点击暂停可能不是一个好主意。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-07-27T21:42:01.577

采样分析器仅在以下情况下有用

1.  您正在监视具有少量线程的运行时。最好是一个。
2.  每个线程的调用堆栈深度相对较小（以减少收集样本时令人难以置信的开销）。
3.  您只关心挂钟时间，而不关心其他仪表或资源瓶颈。
4.  您没有为管理和监视目的检测代码（因此堆栈转储请求）
5.  您错误地认为删除堆栈帧是一种有效的性能改进策略，无论固有成本（不包括被调用者）实际上是否为零
6.  您不必费心去学习如何在日常工作中应用软件性能工程
7.  ……

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-11-06T14:16:38.713

这些必须是您正在使用的一些琐碎示例，以便通过您的方法获得有用的结果。我想不出一个分析有用的项目（通过任何方法），用你的“快速有效”的方法会得到不错的结果。启动和停止某些应用程序所花费的时间已经使您的“快速”断言受到质疑。

同样，对于非平凡的程序，您提倡的方法是无用的。

编辑：关于“为什么不为人所知”？

根据我的经验，代码审查会避免劣质代码和算法，并且分析也会发现这些。如果您希望继续使用您的方法，那就太好了 - 但我认为对于大多数专业社区来说，这在尝试的事情清单上太远了，它永远不会得到积极的强化，因为它不能很好地利用时间。

对于小样本集，它似乎非常不准确，并且获得大样本集将花费大量时间，而这些时间本来可以更好地用于其他有用的活动。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2009-10-17T09:21:10.667

堆栈跟踪快照仅允许您查看应用程序的频闪 X 射线。您可能需要更多积累的知识，而探查器可能会为您提供这些知识。

诀窍是充分了解您的工具并选择最适合手头工作的工具。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-11-05T19:53:34.137

如果该程序正在**生产**中并被付费客户或同事同时使用怎么办？剖析器允许您在不干扰的情况下进行观察（同样多，因为根据[海森堡原理](http://en.wikipedia.org/wiki/Uncertainty_principle)，它当然也会受到一点影响）。

分析还可以为您提供更丰富、更详细的准确报告。从长远来看，这将更快。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-11-05T20:00:11.657

编辑 2008/11/25：好的，Vineet 的回应终于让我明白了这里的问题所在。迟到总比不到好。

不知何故，通过测量性能发现性能问题的想法在这片土地上变得松散了。那是混淆手段和目的。不知何故，我很久以前就通过单步执行整个程序来避免这种情况。我并没有责备自己把它放慢到人类的速度。我试图看看它是否做错了或不必要的事情。这就是如何使软件快速 - 查找并删除不必要的操作。

这些天没有人有耐心单步执行，但下一个最好的事情是随机选择多个周期并询问他们的原因是什么。（这就是调用堆栈通常可以告诉您的。）如果其中很大一部分没有充分的理由，您可以采取一些措施。

这些天来，线程和异步变得更加困难，但这就是**我**调整软件的方式——通过寻找不必要的周期。不是看它有多快——我最后这样做了。

* * *

这就是为什么对调用堆栈进行采样不能给出错误的答案，以及为什么不需要很多样本。

在感兴趣的时间间隔内，当程序花费的时间超出您的预期时，调用堆栈会持续存在，即使您没有对其进行采样。

*   如果一条指令 I 在调用堆栈上的部分时间为 P(I)，如果可以的话，将其从程序中删除将节省那么多。如果这不明显，请考虑一下。

如果指令出现在 M = 2 个或更多样本上，在 N 中，它的 P(I) 大约为 M/N，并且绝对是显着的。

您看不到指令的唯一方法是当指令不在调用堆栈上时神奇地计时所有样本。它只存在一小部分时间的简单事实就是将它暴露给您的探测器。

因此，性能调优的过程是一个简单的问题，即通过打开调用堆栈的多个样本来挑选指令（主要是函数调用指令）。*那是森林里的大树。*

请注意，我们不必关心调用图、函数需要多长时间、调用次数或递归。

我反对混淆，而不是反对分析器。他们给了你很多统计数据，但大多数没有给出 P(I)，而且大多数用户没有意识到这很重要。

您可以谈论森林和树木，但是对于您可以通过修改代码来解决的任何性能问题，您需要修改指令，特别是具有高 P(I) 的指令。所以你需要知道那些在哪里，最好不要扮演福尔摩斯。堆栈采样会告诉您它们的确切位置。

这种技术很难在多线程、事件驱动或生产系统中使用。这就是分析器（如果他们报告 P(I)）可以真正提供帮助的地方。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-11-05T20:38:30.673

单步执行代码非常适合查看细节和故障排除算法。这就像真正近距离观察一棵树，并分别追踪每根树皮和树枝。

通过剖析，您可以看到全局，并快速识别故障点——例如后退一步，查看整个森林并注意最高的树木。通过按执行时间长度对函数调用进行排序，您可以快速识别出问题点所在的区域。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-11-06T23:05:27.057

多年前，我将这种方法用于[Commodore 64 BASIC 。](http://en.wikipedia.org/wiki/Commodore_64#BASIC)令人惊讶的是它的效果如何。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-11-06T14:51:04.120

我通常在超出时间片的实时程序上使用它。您不能手动停止和重新启动必须每秒运行 60 次的代码。

我还用它来追踪我编写的编译器中的瓶颈。您不想尝试手动破坏这样的程序，因为您真的无法知道您是在瓶颈所在的位置中断，还是在允许操作系统重新进入的瓶颈之后的位置中断停下来。此外，如果主要瓶颈是您无能为力的事情，但您想摆脱系统中所有其他较大的瓶颈怎么办？*当您没有关于它们都*在哪里以及它们各自的相对影响是什么的良好数据时，您如何确定首先要攻击哪些瓶颈？

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-11-23T00:45:37.577

程序越大，分析器就越有用。如果您需要优化包含数千个条件分支的程序，分析器可能是必不可少的。输入最大的测试数据样本，完成后将分析数据导入 Excel。然后根据实际数据检查您对可能热点的假设。总有惊喜。

# windows - 在远程计算机上重新启动服务的最简单方法

> ID：266389
> 
> 赞同：56
> 
> 时间：2008-11-05T19:53:37.567
> 
> 标签：windows, windows-services

在远程 Windows 系统上重新启动服务的最简单的编程方法是什么？只要不需要人机交互，语言或方法就无关紧要。

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-11-05T20:01:48.830

从 Windows XP 开始，您可以使用`sc.exe`它与本地和远程服务进行交互。安排一个任务来运行一个类似于这样的批处理文件：

```
sc \\服务器停止服务
sc \\server 启动服务

```

确保任务在目标服务器上具有特权的用户帐户下运行。

`psservice.exe`来自[Sysinternals 的 PSTools](http://technet.microsoft.com/en-us/sysinternals/bb896649.aspx)也可以完成这项工作：

```
psservice \\服务器重启服务

```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-05T20:04:45.097

描述：SC 是一个命令行程序，用于与 NT 服务控制器和服务进行通信。用法：sc [命令] [服务名称] ...

```
 The option <server> has the form "\\ServerName"
    Further help on commands can be obtained by typing: "sc [command]"
    Commands:
      query-----------Queries the status for a service, or
                      enumerates the status for types of services.
      queryex---------Queries the extended status for a service, or
                      enumerates the status for types of services.
      start-----------Starts a service.
      pause-----------Sends a PAUSE control request to a service.
      interrogate-----Sends an INTERROGATE control request to a service.
      continue--------Sends a CONTINUE control request to a service.
      stop------------Sends a STOP request to a service.
      config----------Changes the configuration of a service (persistant).
      description-----Changes the description of a service.
      failure---------Changes the actions taken by a service upon failure.
      qc--------------Queries the configuration information for a service.
      qdescription----Queries the description for a service.
      qfailure--------Queries the actions taken by a service upon failure.
      delete----------Deletes a service (from the registry).
      create----------Creates a service. (adds it to the registry).
      control---------Sends a control to a service.
      sdshow----------Displays a service's security descriptor.
      sdset-----------Sets a service's security descriptor.
      GetDisplayName--Gets the DisplayName for a service.
      GetKeyName------Gets the ServiceKeyName for a service.
      EnumDepend------Enumerates Service Dependencies.

    The following commands don't require a service name:
    sc <server> <command> <option>
      boot------------(ok | bad) Indicates whether the last boot should
                      be saved as the last-known-good boot configuration
      Lock------------Locks the Service Database
      QueryLock-------Queries the LockStatus for the SCManager Database 
```

示例：sc 启动 MyService

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-05T20:13:21.333

如果它不需要人工交互，这意味着不会有 UI 调用此操作，我假设它会在某个设定的时间间隔重新启动？如果您可以访问机器，您可以设置一个计划任务以使用旧的 NET STOP 和 NET START 执行批处理文件

```
net stop "DNS Client"
net start "DNS client" 
```

或者如果你想更复杂一点，你可以试试[Powershell](http://thepowershellguy.com/blogs/posh/archive/2007/01/03/powershell-using-net-to-manage-remote-services.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-06-15T14:18:24.513

服务将进入“停止挂起”的情况很多。操作系统会抱怨它“无法停止服务 xyz”。如果您想绝对确保服务已重新启动，您应该终止该进程。您可以通过在 bat 文件中执行以下操作来做到这一点

```
taskkill /F /IM processname.exe
timeout 20
sc start servicename 
```

要找出与您的服务相关联的进程，请转到任务管理器-> 服务选项卡-> 右键单击​​您的服务-> 转到进程。

请注意，在您弄清楚为什么必须首先重新启动服务之前，这应该是一种解决方法。您应该寻找内存泄漏、无限循环和其他此类情况，以使您的服务变得无响应。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-09-11T11:35:00.090

从 Powershell v3 开始，PSsessions 允许在远程计算机上运行任何本机 cmdlet

```
$session = New-PSsession -Computername "YourServerName"
Invoke-Command -Session $Session -ScriptBlock {Restart-Service "YourServiceName"}
Remove-PSSession $Session 
```

请参阅[此处](https://technet.microsoft.com/en-us/library/hh849717.aspx)了解更多信息

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-05T20:00:43.590

查看[sysinternals](http://technet.microsoft.com/en-us/sysinternals/bb897542.aspx)以获取各种工具来帮助您实现该目标。例如 psService 将重新启动远程机器上的服务。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-05T20:11:58.437

我推荐doofledorfer给出的方法。

如果您真的想通过直接 API 调用来实现，请查看[OpenSCManager 函数](http://msdn.microsoft.com/en-us/library/ms684323(VS.85).aspx)。以下是获取机器名称和服务并停止或启动它们的示例函数。

```
function ServiceStart(sMachine, sService : string) : boolean;  //start service, return TRUE if successful
var schm, schs : SC_Handle;
    ss         : TServiceStatus;
    psTemp     : PChar;
    dwChkP     : DWord;
begin
  ss.dwCurrentState := 0;
  schm := OpenSCManager(PChar(sMachine),Nil,SC_MANAGER_CONNECT);  //connect to the service control manager

  if(schm > 0)then begin // if successful...
    schs := OpenService( schm,PChar(sService),SERVICE_START or SERVICE_QUERY_STATUS);    // open service handle, start and query status
    if(schs > 0)then begin     // if successful...
      psTemp := nil;
      if (StartService(schs,0,psTemp)) and (QueryServiceStatus(schs,ss)) then
        while(SERVICE_RUNNING <> ss.dwCurrentState)do begin
          dwChkP := ss.dwCheckPoint;  //dwCheckPoint contains a value incremented periodically to report progress of a long operation.  Store it.
          Sleep(ss.dwWaitHint);  //Sleep for recommended time before checking status again
          if(not QueryServiceStatus(schs,ss))then
            break;  //couldn't check status
          if(ss.dwCheckPoint < dwChkP)then
            Break;  //if QueryServiceStatus didn't work for some reason, avoid infinite loop
        end;  //while not running
      CloseServiceHandle(schs);
    end;  //if able to get service handle
    CloseServiceHandle(schm);
  end;  //if able to get svc mgr handle
  Result := SERVICE_RUNNING = ss.dwCurrentState;  //if we were able to start it, return true
end;

function ServiceStop(sMachine, sService : string) : boolean;  //stop service, return TRUE if successful
var schm, schs : SC_Handle;
    ss         : TServiceStatus;
    dwChkP     : DWord;
begin
  schm := OpenSCManager(PChar(sMachine),nil,SC_MANAGER_CONNECT);

  if(schm > 0)then begin
    schs := OpenService(schm,PChar(sService),SERVICE_STOP or SERVICE_QUERY_STATUS);
    if(schs > 0)then begin
      if (ControlService(schs,SERVICE_CONTROL_STOP,ss)) and (QueryServiceStatus(schs,ss)) then
        while(SERVICE_STOPPED <> ss.dwCurrentState) do begin
          dwChkP := ss.dwCheckPoint;
          Sleep(ss.dwWaitHint);
          if(not QueryServiceStatus(schs,ss))then
            Break;

          if(ss.dwCheckPoint < dwChkP)then
            Break;
        end;  //while
      CloseServiceHandle(schs);
    end;  //if able to get svc handle
    CloseServiceHandle(schm);
  end;  //if able to get svc mgr handle
  Result := SERVICE_STOPPED = ss.dwCurrentState;
end; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-01T08:47:10.690

1.  使用 openscmanager 打开服务控制管理器数据库
2.  使用 EnumDependService() 获取依赖服务
3.  使用 ChangeConfig() 停止所有相关服务，如果它们已启动，则向该函数发送 STOP 信号
4.  停止实际服务
5.  获取服务的所有服务依赖项
6.  如果它们停止，则使用 StartService() 启动所有服务依赖项
7.  开始实际服务

因此，您的服务将重新启动，注意所有依赖项。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-07-12T23:35:42.727

我相信 PowerShell 现在在简单性方面胜过“sc”命令：

```
Restart-Service "servicename" 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-12-07T13:32:53.933

这就是我使用不同帐户远程重新启动服务时所做的事情

使用不同的登录名打开 CMD

```
runas /noprofile /user:DOMAIN\USERNAME cmd 
```

使用 SC 停止和启动

```
sc \\SERVERNAME query Tomcat8
sc \\SERVERNAME stop Tomcat8
sc \\SERVERNAME start Tomcat8 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-10-08T19:54:59.683

**如果您尝试在不同域**的服务器上执行此操作，则需要比迄今为止大多数答案所建议的多一点，这就是我用来完成此操作的方法：

```
#Configuration
$servername = "ABC",
$serviceAccountUsername = "XYZ",
$serviceAccountPassword = "XXX"

#Establish connection
try {
    if (-not ([System.IO.Directory]::Exists('\\' + $servername))) {
        net use \\$servername /user:$serviceAccountUsername $serviceAccountPassword
    }
}
catch {
    #May already exists, if so just continue
    Write-Output $_.Exception.Message
}

#Restart Service
sc.exe \\$servername stop "ServiceNameHere"
sc.exe \\$servername start "ServiceNameHere" 
```

# delphi - Delphi：在数据感知控件中显示数据集的子集

> ID：266391
> 
> 赞同：2
> 
> 时间：2008-11-05T19:54:08.503
> 
> 标签：delphi, dataset

我有一个包含多个字段的内存数据集，其中一个是另一个数据集作为外键引用的主键。问题是，主数据集可以有对详细数据集的多个引用。（这是对包含其他对象的动态数组的对象进行建模。）

如果每个子对象只有一个，我可以与主数据集中引用字段的 KeyFields 和 LookupKeyFields 属性进行正确关联，但这只是为了返回一个结果。我想加载主键与正确 ID 键匹配的*所有记录，并将它们显示在列表框中。*

我认为 TDBListBox 会对此有所帮助，但事实证明这不是他们所做的。那么我将如何使用多重匹配检查的结果集填充列表框或类似控件以进行进一步编辑？我想要类似于这样的 SQL 查询结果的东西：

```
select field1, field2, field3
from client_dataset
where client_dataset.primary_key = master_dataset.id 
```

唯一的问题是，这完全是使用内存数据集完成的。这里没有使用真正的数据库。有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-05T20:00:09.177

数据集有一个过滤器属性，可以使用条件进行设置。您还必须将过滤标志设置为 true。通过他的数据控件，您可以选择哪些字段是可见的。

所以：

```
var
  c : TColumn;
begin
  clientdataset.Filter := Format('primary_key = %d', [master_dataset.id]);
  clientdataset.Filtered := True;

  c := DBGrid1.Columns.Add;
  c.FieldName := 'field1';
  c := DBGrid1.Columns.Add;
  c.FieldName := 'field2';
  c := DBGrid1.Columns.Add;
  c.FieldName := 'field3';
end; 
```

应该做的伎俩。

# git - git-svn：如何通过 git 创建一个新的 svn 分支？

> ID：266395
> 
> 赞同：197
> 
> 时间：2008-11-05T19:54:48.267
> 
> 标签：git, version-control, git-svn

我有一个跟踪 svn 存储库的 git 存储库。我使用`--stdlayout`.

我通过创建了一个新的本地分支`git checkout -b foobar`

现在我希望这个分支最终在`…/branches/foobar`svn 存储库中。

我该怎么做？

（剪掉了很多调查性文字。如果你在乎，请查看问题历史）

* * *

## 回答 #1

> 赞同：285
> 
> 时间：2009-12-15T23:00:22.247

我知道这个问题已经回答了一段时间，但是在阅读它之后，我可能会帮助添加特定 git svn branch 命令的示例并将其与典型的工作流程相关联。

就像 kch 回答的那样，使用`git svn branch`. 这是一个完整的例子，（注意`-n`试运行测试）：

```
git svn branch -n  -m "Branch for authentication bug" auth_bug 
```

如果一切顺利，服务器会回复如下答案：

> 将r8914 处的[https://scm-server.com/svn/portal/trunk](https://scm-server.com/svn/portal/branches/auth_bug)复制到[https://scm-server.com/svn/portal/branches/auth_bug](https://scm-server.com/svn/portal/trunk) ...

如果没有`-n`开关，服务器可能会添加如下内容：

> 找到可能的分支点：[https](https://scm-server.com/svn/portal/trunk) : //scm-server.com/svn/portal/trunk => [https://scm-server.com/portal/branches/auth_bug，8914](https://scm-server.com/portal/branches/auth_bug)
> 
> 找到分支父级：（refs/remotes/auth_bug）
> 
> d731b1fa028d30d685fe260f5bb912cbf59e1971
> 
> 跟随父母与 do_switch
> 
> 成功跟随父 r8915 = 6ed10c57afcec62e9077fbeed74a326eaa4863b8
> 
> （参考/遥控器/auth_bug）

最好的部分是，现在您可以根据远程分支创建本地分支，如下所示：

```
git checkout -b local/auth_bug auth_bug 
```

这意味着“签出并创建名为的本地分支`auth_bug`并使其遵循远程分支（最后一个参数）`auth_bug`

使用`dcommit`with `--dry-run`( `-n`) 测试您的本地分支是否在该远程分支上工作：

```
git svn dcommit -n 
```

SVN 服务器应该回复新的分支名称：

> 致力于[https://scm-server.com/svn/portal/branches/auth_bug](https://scm-server.com/svn/portal/branches/auth_bug) ...

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2008-11-05T20:36:59.710

从 git v1.6.1 开始，`git svn branch`可用。

来自 git 文档：

```
    分支
        在 SVN 存储库中创建一个分支。

        -m，--消息
            允许指定提交消息。

        -t，--标签
            使用 tags_subdir 而不是 branches_subdir 创建标签
            在 git svn init 期间指定。

```

以前版本的 git 不提供创建 svn 分支的方法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-08T01:05:34.347

@kch 我刚刚（2008 年 12 月 7 日）编译了 git 的 v1.6.1-rc1 标签，它确实包含 git svn branch 命令和它的文档。所以 git 的 v1.6.1 版本应该（希望）包含这个命令。

# wpf - WPF 找到一个控件

> ID：266402
> 
> 赞同：6
> 
> 时间：2008-11-05T19:56:40.633
> 
> 标签：wpf

我在我的 WPF 页面上用程序代码创建了一个网格。现在我想引用那个网格。

```
Grid grid = (Grid)This.FindName("myGridName") 
```

不起作用。想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-05T20:53:57.103

在代码中创建元素时，还需要调用 RegisterName 方法以允许 FindName 工作。

# java - 如何更新预先存在的 Jar 文件

> ID：266409
> 
> 赞同：0
> 
> 时间：2008-11-05T19:58:49.350
> 
> 标签：java, jar

我有一个需要添加两个文件的 WAR 文件。目前，我正在这样做：

```
File war = new File(DIRECTORY, "server.war");
JarOutputStream zos = new JarOutputStream(new BufferedOutputStream(new FileOutputStream(war)));

//Add file 1
File file = new File(DIRECTORY, "file1.jar");
InputStream is = new BufferedInputStream(new FileInputStream(file));
ZipEntry e = new ZipEntry("file1.jar");
zos.putNextEntry(e);
byte[] buf = new byte[1024];
int len;
while ((len = is.read(buf, 0, buf.length)) != -1) {
    zos.write(buf, 0, len);
}
is.close();
zos.closeEntry();

//repeat for file 2

zos.close(); 
```

结果是先前的内容被破坏了：WAR 中只有我刚刚添加的 2 个文件。是否有某种我没有使用的附加模式或什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-05T20:12:56.983

[是的， FileOutputStream 构造函数](http://java.sun.com/j2se/1.4.2/docs/api/java/io/FileOutputStream.html#FileOutputStream(java.io.File,%20boolean))有一个额外的布尔参数，可让您强制它附加到文件而不是覆盖它。将您的代码更改为

```
JarOutputStream zos = new JarOutputStream(new BufferedOutputStream(new FileOutputStream(war, True))); 
```

它应该按照你想要的方式工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-06T18:34:09.833

这似乎是做不到的。我以为是有一段时间了，但似乎并没有达到我想要的效果。这样做相当于将两个单独的 jar 文件连接在一起。奇怪的是，这些工具能理解它。JAR 找到了第一个原始的 jar 文件并读给我看。Glassfish 的类加载器正在寻找后来的新部分，导致它只加载添加的文件，就好像它们是整个应用程序一样。奇怪的。

所以我决定创建一个新的战争，添加旧的内容，添加新的文件，关闭，并在旧的上复制新的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-20T23:11:05.477

I have the same problem; I'm looking for an easy way to update a file in an existing jar file. If it's so easy to do a "jar uf foo.jar ..." command, how come there isn't a way to use Java API's to do the same?

Anyway, here is the RFE to add this functionality to Java; it also suggests some work-arounds:

[http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4129445](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4129445)

And here is a library that purports to make this a lot easier, by treating JARs/ZIPs like virtual directories:

https:// truezip.dev.java.net

I haven't figured out yet which approach I'm going to use for my current problem.

# windows - 有没有办法检查 MS 安全中心的病毒防护状态？

> ID：266417
> 
> 赞同：2
> 
> 时间：2008-11-05T20:00:29.753
> 
> 标签：windows, vbscript

我们处于 Windows 环境中，并希望为非公司机器自动执行此过程。如果供应商来到现场，我们希望能够让他/她访问一个可以对工作站执行快速扫描的网站，以确定他们是否有正确的 MS KB 补丁以及他们的病毒扫描程序数据是否达到日期。

我可以相对容易地扫描 KB 更新，我很难找到一种检查病毒 dat 状态的方法，并且由于那里有很多不同的引擎，使用（内置于XP 至少）专有的 MS 安全中心的东西。

最终，我们希望我们的路由器将非公司机器重定向到将强制验证的网站，但在那之前，这将是一个手动过程。

有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-25T07:38:26.040

在 Windows Vista 中，有一些新的 API 可以与安全中心组件状态交互：http: [//msdn2.microsoft.com/en-us/library/bb963845 (VS.85).aspx](http://msdn2.microsoft.com/en-us/library/bb963845(VS.85).aspx)

[通过 WMI，这是我在http://social.msdn.microsoft.com/forums/en-US/windowssecurity/thread/bd97d9e6-75c1-4f58-9573-9009df5de19b/](http://social.msdn.microsoft.com/forums/en-US/windowssecurity/thread/bd97d9e6-75c1-4f58-9573-9009df5de19b/)上查看的 VBS 代码片段，用于转储防病毒产品信息：

```
 Set oWMI = GetObject
("winmgmts:{impersonationLevel=impersonate}!\\.\root\SecurityCenter")    
    Set colItems = oWMI.ExecQuery("Select * from AntiVirusProduct")    

    For Each objAntiVirusProduct In colItems    
    msg = msg & "companyName: " & objAntiVirusProduct.companyName & vbCrLf    
    msg = msg & "displayName: " & objAntiVirusProduct.displayName & vbCrLf    
    msg = msg & "instanceGuid: " & objAntiVirusProduct.instanceGuid & vbCrLf    
    msg = msg & "onAccessScanningEnabled: "
 & objAntiVirusProduct.onAccessScanningEnabled & vbCrLf    
    msg = msg & "productUptoDate: " & objAntiVirusProduct.productUptoDate & vbCrLf    
    msg = msg & "versionNumber: " & objAntiVirusProduct.versionNumber & vbCrLf    
    msg = msg & vbCrLf  

    Next

    WScript.Echo msg 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-04T16:39:11.710

For AVs that don’t report to WMI or for AVs which WMI retains state info after the AV is uninstalled (there are instances of both cases) you may wish to consider the OPSWAT library. You will need to write and deploy a light client from your website to utilize the library to machines to be interrogated. The library utilizes WMI for security apps that correctly support WMI and proprietary methods to detect AVs and their dat status for those that don’t.

# deployment - n 层架构的管理和部署

> ID：266422
> 
> 赞同：2
> 
> 时间：2008-11-05T20:01:43.493
> 
> 标签：deployment, n-tier-architecture, application-management

您如何管理由多个网站、桌面应用程序、Web 服务和混合了依赖项的数据库组成的 n 层系统的开发和部署？

假设您有一个具有源代码控制和自动构建的持续集成环境。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T20:42:25.283

这是你很难实现的。但是，我们要做的一件事是确保系统的每个不同部分都进行适当的健全性检查，例如，您的数据访问层将执行以下操作：

```
public void OnStart(){
    if(database.SchemaVersion != this.RequiredDatabaseSchemaVersion)
        throw new DependencyException("The database was not the required version");
} 
```

这个例子完全是微不足道的，但你应该明白了。

您可以做的另一件事是确保在打包应用程序时将其打包为一个单元。所以有人可以做类似的事情：

```
MyApplication_v1234.msi /install web_app
MyApplication_v1234.msi /install web_services 
```

显然，这取决于您计划如何分发您的应用程序。

希望这能给你一些思考。

# php - MySQL中非空列中的空字符串？

> ID：266431
> 
> 赞同：15
> 
> 时间：2008-11-05T20:03:48.327
> 
> 标签：php, mysql, mysqli, nullable, prepared-statement

我曾经使用标准的 mysql_connect()、mysql_query() 等语句从 PHP 中处理 MySQL 的内容。最近我一直在转而使用美妙的 MDB2 类。除此之外，我还使用准备好的语句，因此我不必担心逃避输入和 SQL 注入攻击。

但是，我遇到了一个问题。我有一个包含几个 VARCHAR 列的表，这些列被指定为非空（即，不允许 NULL 值）。使用旧的 MySQL PHP 命令，我可以毫无问题地做这样的事情：

```
INSERT INTO mytable SET somevarchar = ''; 
```

但是，现在，如果我有这样的查询：

```
INSERT INTO mytable SET somevarchar = ?; 
```

然后在 PHP 中我有：

```
$value = "";
$prepared = $db->prepare($query, array('text'));
$result = $prepared->execute($value); 
```

这将抛出错误“ `null value violates not-null constraint`”

作为临时解决方法，我检查是否`$value`为空，并将其更改为`" "`（单个空格），但这是一个可怕的 hack，可能会导致其他问题。

我应该如何使用准备好的语句插入空字符串，而不是尝试插入 NULL？

**编辑：**这个项目太大了，无法遍历我的整个代码库，找到使用空字符串“”的任何地方并将其更改为使用 NULL。我需要知道的是为什么标准 MySQL 查询将“”和 NULL 视为两个独立的事物（我认为是正确的），但准备好的语句将“”转换为 NULL。

请注意，“”和 NULL**不是**一回事。例如，`SELECT NULL = "";`返回`NULL`而不是`1`您所期望的。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-05T20:33:36.193

Thanks to some of the answers, I realized that the problem may be in the MDB2 API, and not in the PHP or MYSQL commands themselves. Sure enough, I found this in the MDB2 FAQ:

> *   Why do empty strings end up as NULL in the database? Why do I get an NULL not allowed in NOT NULL text fields eventhough the default value is ""?
>     *   The problem is that for some RDBMS (most noteably Oracle) an empty string is NULL. Therefore MDB2 provides a portability option to enforce the same behaviour on all RDBMS.
>     *   Since all portability options are enabled by default you will have to disable the feature if you dont want to have this behaviour: $mdb2->setOption('portability', MDB2_PORTABILITY_ALL ^ MDB2_PORTABILITY_EMPTY_TO_NULL);

Thanks to everyone who provided thoughtful answers.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-05T20:26:58.123

This sounds like a problem with the MDB2 API fumbling PHP's duck typing semantics. Because the empty string in PHP is equivalent to NULL, MDB2 is probably mis-treating it as such. The ideal solution would be to find a workaround for it within it's API, but I'm not overly familiar with it.

One thing that you should consider, though, is that an empty string in SQL is not a NULL value. You can insert them into rows declared 'NOT NULL' just fine:

```
mysql> CREATE TABLE tbl( row CHAR(128) NOT NULL );
Query OK, 0 rows affected (0.05 sec)

mysql> INSERT INTO tbl VALUES( 'not empty' ), ( '' );
Query OK, 2 rows affected (0.02 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql> SELECT row, row IS NULL FROM tbl;
+-----------+-------------+
| row       | row IS NULL |
+-----------+-------------+
| not empty |           0 | 
|           |           0 | 
+-----------+-------------+
2 rows in set (0.00 sec)

mysql> INSERT INTO tbl VALUES( NULL );
ERROR 1048 (23000): Column 'row' cannot be null 
```

If you're unable to find (or implement) a workaround in the MDB2 API, one hackish solution (though slightly better than the one you're currently using) might be to define a [user variable](http://dev.mysql.com/doc/refman/5.0/en/user-variables.html) for the empty string --

```
SET @EMPTY_STRING = "";
UPDATE tbl SET row=@EMPTY_STRING; 
```

Finally, if you need to use the empty string in an INSERT statement but find yourself unable to, the default value for string types in MySQL is an empty string. So you could simply omit the column from INSERT statement and it would automatically get set to the empty string (provided the column has a NOT NULL constraint).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T01:32:42.957

I realize this question is pretty much answered and retired, but I found it while looking for answers to a similar situation and I can't resist throwing my hat in the ring.

Without knowing what the NULL/"" column relates to, I can't know how the true significance of an empty string. Does empty string mean something unto itself (like, if I convinced a judge to let me change my name to simply nothing, I would be really irritated if my name showed up on my Driver's License as NULL. My name would be !

However, the empty string (or blank, or the nothingness that is SOMETHING, not simply the lack of anything (like NULL)) could also simply just mean "NOT NULL" or "Nothing, but still not Null". You could even go the other direction and suggest that the absence of the value NULL makes it even LESS something than Null, cuz at least Null has a name you can say aloud!

My point is, that if the empty string is a direct representation of some data (like a name, or what I prefer be inserted between the numbers in my phone number, etc), then your options are either to argue until you're sore for the legitimate use of empty string or to use something that represents an empty string that isn't NULL (Like an ASCII control character or some unicode equivalent, a regex value of some kind, or, even worse, an arbitrary yet totally unused token, like: ◘</p>

If the empty cell really just means NOT NULL, then you could think of some other way of expressing it. One silly and obvious way is the phrase "Not NULL". But I have a hunch that NULL means something like "Not part of this group at all" while the empty string means something like "this guy is cool, he just hasn't gotten his gang tattoos yet". In which case I would come up with a term/name/idea for this situation, like "default" or "rookie" or "Pending".

Now, if by some crazy chance you actually want empty string to represent that which is not even worthy of NULL, again, come up with a more significant symbol for that, such as "-1" or "SUPERNULL" or "UGLIES".

In the Indian Caste System, the lowest Caste are Shudra: Farmers and Laborers. Beneath this caste are the Dalit: "The Untouchables". They are not considered a lower caste, because setting them as the lowest caste would be considered a contamination of the entire system.

So don't call me crazy for thinking empty strings may be WORSE than NULL!

'Til next time.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-19T07:05:11.580

I found the solution!

MDB2 converts empty strings to NULL because portability option MDB2_PORTABILITY_EMPTY_TO_NULL is on by default (thanks to Oracle which considers empty strings to be null).

Switch this options off when you connect to the database:

```
$options = array(
    'portability' => MDB2_PORTABILITY_ALL ^ MDB2_PORTABILITY_EMPTY_TO_NULL
);
$res= & MDB2::connect("mysql://user:password@server/dbase", $options); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-31T21:00:46.203

While 0 and empty strings are variables NULL is the absence of data. And trust me, it's a lot easier to write a query to

`SELECT * from table where mything IS NULL` than to try to query for empty strings :/

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-05T20:12:08.310

Doesn't an empty set of quotes, `""` do that?

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-05T20:25:41.137

I'm confused. It looks like you're using mysqli OO (from the tags and style), but the syntax is different than the [manual](http://us.php.net/manual/en/mysqli.prepare.php) on php.net, which says to do this instead:

```
$query = "INSERT INTO mytable SET somevarchar = ?";
$value = "";
$prepared = $db->prepare($query);
$prepared->bind_param("s", $value);
$result = $prepared->execute(); 
```

# c# - 默认/相对路径解析在 .NET 中如何工作？

> ID：266433
> 
> 赞同：9
> 
> 时间：2008-11-05T20:04:44.067
> 
> 标签：c#, visual-studio, file-io, .net-2.0

所以...我曾经认为，当您访问一个文件但指定没有路径的名称（在我的情况下为 CAISLog.csv）时，.NET 会期望该文件与正在运行的 .exe 位于同一路径。

这在我逐步执行解决方案（C# .NET2.* VS2K5）时有效，但是当我以正常模式运行应用程序（由 Websphere MQ 触发器监视器启动并在后台作为网络服务运行）而不是访问文件时在 C:\WINDOWS\system32 中查找 .exe 的路径。如果它很重要父任务的 .exe 与我的应用程序在几乎相同的文件夹结构/路径中

我得到一个匹配的错误：“ *System.UnauthorizedAccessException：访问路径 'C:\WINDOWS\system32\CAISLog.csv' 被拒绝。* ”

我的解决方法是完全限定我的文件的位置。但是，我想了解的是**“在 IO 期间仅指定文件名时，管理如何解析路径的 .NET 规则是什么？”** 我觉得我错过了一些基本概念，这让我很烦恼。

编辑 - 我不确定它本身是否是 .NET 规则，但 Schmuli 似乎更清楚地解释了这个概念。我一定会在未来尝试 Rob Prouse 的建议，所以也对此 +1。

如果有人有一些重新措辞的建议，强调我并不*真正*关心找到我的 .exe 的路径 - 而只是不明白相对路径解析发生了什么（而且我可能仍然把我的术语搞砸了） ...

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-05T21:55:21.910

当应用程序 (WinForms) 启动时，其中`Environment.CurrentDirectory`包含应用程序文件夹的路径（即包含 .exe 程序集的文件夹）。使用任何文件对话框，例如。`OpenFileDialog`,`SaveFileDialog`等将导致当前目录更改（如果选择了不同的文件夹）。

运行 Windows 服务时，其包含文件夹是 C:\Windows\System32，因为它是系统文件夹，它是实际运行 Windows 服务的系统（即操作系统）。

请注意，在大多数`System.IO`对象中指定相对路径将回退到使用该`Environment.CurrentDirectory`属性。

如前所述，有几种方法可以获取服务可执行文件的路径，使用`Assembly.GetEntryAssembly()`或`Assembly.GetExecutingAssembly()`然后使用`Location`属性或`CodeBase`属性（请注意，这是可执行文件的文件路径，而不是目录）。

另一种选择是使用：

```
`System.IO.Directory.SetCurrentDirectory( System.AppDomain.CurrentDomain.BaseDirectory );` 
```

在服务的`OnStart`方法中进行调用，将其应用于整个应用程序。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-05T20:13:37.713

它基于当前工作目录，该目录可能与您的应用程序所在的位置相同，也可能不同，尤其是从不同的程序或具有不同工作目录的快捷方式启动时。

与其硬编码路径，不如获取程序的路径并使用它。你可以用这样的东西来做到这一点

```
Assembly ass = Assembly.GetEntryAssembly();
string dir = Path.GetDirectoryName(ass.Location);
string filename = Path.Combine( dir, "CAISLog.csv" ); 
```

这假定条目程序集是您的文件所在的位置。如果没有，您可以将程序集更改为类似的东西；

```
Assembly ass = Assembly.GetAssembly( typeof( AClassInYourAssembly ) ); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-05T20:10:12.213

相对路径解析*永远不会*对启动可执行文件的路径起作用。它总是对进程的当前目录起作用，你不能真的期望它总是设置为 .exe 所在的目录。

如果您需要这种行为，请注意自己找出正确的路径，并为文件操作提供完全限定的路径。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-11-05T20:27:58.387

您可以使用它来指定与您的 exe @"..\CAISLog.csv" 相同的路径。请注意，双点指的是 .exe 所在位置的父目录。

温迪

# windows-server-2008 - 将 Windows Web Server 2008 升级到“标准”版？

> ID：266436
> 
> 赞同：0
> 
> 时间：2008-11-05T20:04:59.213
> 
> 标签：windows-server-2008

我有一个 Windows Web Server 2008 实例。您知道是否可以将其升级到“Windows Standard Server 2008”？（我的意思是没有完全重新安装并考虑到我有这样做的许可证）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-12T17:07:57.317

如果您的服务器是 x64 则有可能： [https ://serverfault.com/questions/10299/upgrading-windows-server-2008](https://serverfault.com/questions/10299/upgrading-windows-server-2008)

并且对于 vista 不是完全重新安装，[Windows Anytime Upgrade](http://en.wikipedia.org/wiki/Windows_Anytime_Upgrade)怎么样？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T20:12:42.350

如果确实如此，我会感到非常惊讶。即使是版本之间的 Vista 升级也几乎是完全重新安装。

# asp.net - 将 RSS pubDate 格式化为 .NET DateTime

> ID：266448
> 
> 赞同：7
> 
> 时间：2008-11-05T20:07:24.873
> 
> 标签：asp.net, datetime, rss

如何将标准 RSS pubDate 字符串格式化为更接近 ASP.NET 的 DateTime？

所以，从这里：

2008 年 10 月 29 日，星期三 14:14:48 +0000

对此：

2008 年 10 月 29 日下午 2:14

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-12T22:07:18.530

我有一个 RSS 822 DateTime 格式的实现，作为对“[如何解析 DateTime 并将其转换为](https://stackoverflow.com/questions/284775/how-do-i-parse-and-convert-datetimes-to-the-rfc-822-date-time-format)应该可以解决您的问题的 RFC-822 日期时间格式”的问题的答案。

这是 C# 中如何解析 DateTime 并将其转换为 RFC-822 表示形式的实现。它的唯一限制是 DateTime 采用协调世界时 (UTC)。

```
/// <summary>
/// Provides methods for converting <see cref="DateTime"/> structures 
/// to and from the equivalent <a href="http://www.w3.org/Protocols/rfc822/#z28">RFC 822</a> 
/// string representation.
/// </summary>
public class Rfc822DateTime
{
    //============================================================
    //  Private members
    //============================================================
    #region Private Members
    /// <summary>
    /// Private member to hold array of formats that RFC 822 date-time representations conform to.
    /// </summary>
    private static string[] formats = new string[0];
    /// <summary>
    /// Private member to hold the DateTime format string for representing a DateTime in the RFC 822 format.
    /// </summary>
    private const string format     = "ddd, dd MMM yyyy HH:mm:ss K";
    #endregion

    //============================================================
    //  Public Properties
    //============================================================
    #region Rfc822DateTimeFormat
    /// <summary>
    /// Gets the custom format specifier that may be used to represent a <see cref="DateTime"/> in the RFC 822 format.
    /// </summary>
    /// <value>A <i>DateTime format string</i> that may be used to represent a <see cref="DateTime"/> in the RFC 822 format.</value>
    /// <remarks>
    /// <para>
    /// This method returns a string representation of a <see cref="DateTime"/> that utilizes the time zone 
    /// offset (local differential) to represent the offset from Greenwich mean time in hours and minutes. 
    /// The <see cref="Rfc822DateTimeFormat"/> is a valid date-time format string for use 
    /// in the <see cref="DateTime.ToString(String, IFormatProvider)"/> method.
    /// </para>
    /// <para>
    /// The <a href="http://www.w3.org/Protocols/rfc822/#z28">RFC 822</a> Date and Time specification 
    /// specifies that the year will be represented as a two-digit value, but the 
    /// <a href="http://www.rssboard.org/rss-profile#data-types-datetime">RSS Profile</a> recommends that 
    /// all date-time values should use a four-digit year. The <see cref="Rfc822DateTime"/> class 
    /// follows the RSS Profile recommendation when converting a <see cref="DateTime"/> to the equivalent 
    /// RFC 822 string representation.
    /// </para>
    /// </remarks>
    public static string Rfc822DateTimeFormat
    {
        get
        {
            return format;
        }
    }
    #endregion

    #region Rfc822DateTimePatterns
    /// <summary>
    /// Gets an array of the expected formats for RFC 822 date-time string representations.
    /// </summary>
    /// <value>
    /// An array of the expected formats for RFC 822 date-time string representations 
    /// that may used in the <see cref="DateTime.TryParseExact(String, string[], IFormatProvider, DateTimeStyles, out DateTime)"/> method.
    /// </value>
    /// <remarks>
    /// The array of the expected formats that is returned assumes that the RFC 822 time zone 
    /// is represented as or converted to a local differential representation.
    /// </remarks>
    /// <seealso cref="ConvertZoneToLocalDifferential(String)"/>
    public static string[] Rfc822DateTimePatterns
    {
        get
        {
            if (formats.Length > 0)
            {
                return formats;
            }
            else
            {
                formats = new string[35];

                // two-digit day, four-digit year patterns
                formats[0]  = "ddd',' dd MMM yyyy HH':'mm':'ss'.'fffffff zzzz";
                formats[1]  = "ddd',' dd MMM yyyy HH':'mm':'ss'.'ffffff zzzz";
                formats[2]  = "ddd',' dd MMM yyyy HH':'mm':'ss'.'fffff zzzz";
                formats[3]  = "ddd',' dd MMM yyyy HH':'mm':'ss'.'ffff zzzz";
                formats[4]  = "ddd',' dd MMM yyyy HH':'mm':'ss'.'fff zzzz";
                formats[5]  = "ddd',' dd MMM yyyy HH':'mm':'ss'.'ff zzzz";
                formats[6]  = "ddd',' dd MMM yyyy HH':'mm':'ss'.'f zzzz";
                formats[7]  = "ddd',' dd MMM yyyy HH':'mm':'ss zzzz";

                // two-digit day, two-digit year patterns
                formats[8]  = "ddd',' dd MMM yy HH':'mm':'ss'.'fffffff zzzz";
                formats[9]  = "ddd',' dd MMM yy HH':'mm':'ss'.'ffffff zzzz";
                formats[10] = "ddd',' dd MMM yy HH':'mm':'ss'.'fffff zzzz";
                formats[11] = "ddd',' dd MMM yy HH':'mm':'ss'.'ffff zzzz";
                formats[12] = "ddd',' dd MMM yy HH':'mm':'ss'.'fff zzzz";
                formats[13] = "ddd',' dd MMM yy HH':'mm':'ss'.'ff zzzz";
                formats[14] = "ddd',' dd MMM yy HH':'mm':'ss'.'f zzzz";
                formats[15] = "ddd',' dd MMM yy HH':'mm':'ss zzzz";

                // one-digit day, four-digit year patterns
                formats[16] = "ddd',' d MMM yyyy HH':'mm':'ss'.'fffffff zzzz";
                formats[17] = "ddd',' d MMM yyyy HH':'mm':'ss'.'ffffff zzzz";
                formats[18] = "ddd',' d MMM yyyy HH':'mm':'ss'.'fffff zzzz";
                formats[19] = "ddd',' d MMM yyyy HH':'mm':'ss'.'ffff zzzz";
                formats[20] = "ddd',' d MMM yyyy HH':'mm':'ss'.'fff zzzz";
                formats[21] = "ddd',' d MMM yyyy HH':'mm':'ss'.'ff zzzz";
                formats[22] = "ddd',' d MMM yyyy HH':'mm':'ss'.'f zzzz";
                formats[23] = "ddd',' d MMM yyyy HH':'mm':'ss zzzz";

                // two-digit day, two-digit year patterns
                formats[24] = "ddd',' d MMM yy HH':'mm':'ss'.'fffffff zzzz";
                formats[25] = "ddd',' d MMM yy HH':'mm':'ss'.'ffffff zzzz";
                formats[26] = "ddd',' d MMM yy HH':'mm':'ss'.'fffff zzzz";
                formats[27] = "ddd',' d MMM yy HH':'mm':'ss'.'ffff zzzz";
                formats[28] = "ddd',' d MMM yy HH':'mm':'ss'.'fff zzzz";
                formats[29] = "ddd',' d MMM yy HH':'mm':'ss'.'ff zzzz";
                formats[30] = "ddd',' d MMM yy HH':'mm':'ss'.'f zzzz";
                formats[31] = "ddd',' d MMM yy HH':'mm':'ss zzzz";

                // Fall back patterns
                formats[32] = "yyyy'-'MM'-'dd'T'HH':'mm':'ss'.'fffffffK"; // RoundtripDateTimePattern
                formats[33] = DateTimeFormatInfo.InvariantInfo.UniversalSortableDateTimePattern;
                formats[34] = DateTimeFormatInfo.InvariantInfo.SortableDateTimePattern;

                return formats;
            }
        }
    }
    #endregion

    //============================================================
    //  Public Methods
    //============================================================
    #region Parse(string s)
    /// <summary>
    /// Converts the specified string representation of a date and time to its <see cref="DateTime"/> equivalent.
    /// </summary>
    /// <param name="s">A string containing a date and time to convert.</param>
    /// <returns>
    /// A <see cref="DateTime"/> equivalent to the date and time contained in <paramref name="s"/>, 
    /// expressed as <i>Coordinated Universal Time (UTC)</i>.
    /// </returns>
    /// <remarks>
    /// The string <paramref name="s"/> is parsed using formatting information in the <see cref="DateTimeFormatInfo.InvariantInfo"/> object.
    /// </remarks>
    /// <exception cref="ArgumentNullException"><paramref name="s"/> is a <b>null</b> reference (Nothing in Visual Basic).</exception>
    /// <exception cref="ArgumentNullException"><paramref name="s"/> is an empty string.</exception>
    /// <exception cref="FormatException"><paramref name="s"/> does not contain a valid RFC 822 string representation of a date and time.</exception>
    public static DateTime Parse(string s)
    {
        //------------------------------------------------------------
        //  Validate parameter
        //------------------------------------------------------------
        Guard.ArgumentNotNullOrEmptyString(s, "s");

        DateTime result;
        if (Rfc822DateTime.TryParse(s, out result))
        {
            return result;
        }
        else
        {
            throw new FormatException(String.Format(null, "{0} is not a valid RFC 822 string representation of a date and time.", s));
        }
    }
    #endregion

    #region ConvertZoneToLocalDifferential(string s)
    /// <summary>
    /// Converts the time zone component of an RFC 822 date and time string representation to its local differential (time zone offset).
    /// </summary>
    /// <param name="s">A string containing an RFC 822 date and time to convert.</param>
    /// <returns>A date and time string that uses local differential to describe the time zone equivalent to the date and time contained in <paramref name="s"/>.</returns>
    /// <exception cref="ArgumentNullException"><paramref name="s"/> is a <b>null</b> reference (Nothing in Visual Basic).</exception>
    /// <exception cref="ArgumentNullException"><paramref name="s"/> is an empty string.</exception>
    public static string ConvertZoneToLocalDifferential(string s)
    {
        string zoneRepresentedAsLocalDifferential   = String.Empty;

        //------------------------------------------------------------
        //  Validate parameter
        //------------------------------------------------------------
        Guard.ArgumentNotNullOrEmptyString(s, "s");

        if(s.EndsWith(" UT", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" UT") + 1) ), "+00:00");
        }
        else if (s.EndsWith(" GMT", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" GMT") + 1 ) ), "+00:00");
        }
        else if (s.EndsWith(" EST", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" EST") + 1)), "-05:00");
        }
        else if (s.EndsWith(" EDT", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" EDT") + 1)), "-04:00");
        }
        else if (s.EndsWith(" CST", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" CST") + 1)), "-06:00");
        }
        else if (s.EndsWith(" CDT", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" CDT") + 1)), "-05:00");
        }
        else if (s.EndsWith(" MST", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" MST") + 1)), "-07:00");
        }
        else if (s.EndsWith(" MDT", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" MDT") + 1)), "-06:00");
        }
        else if (s.EndsWith(" PST", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" PST") + 1)), "-08:00");
        }
        else if (s.EndsWith(" PDT", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" PDT") + 1)), "-07:00");
        }
        else if (s.EndsWith(" Z", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" Z") + 1)), "+00:00");
        }
        else if (s.EndsWith(" A", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" A") + 1)), "-01:00");
        }
        else if (s.EndsWith(" M", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" M") + 1)), "-12:00");
        }
        else if (s.EndsWith(" N", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" N") + 1)), "+01:00");
        }
        else if (s.EndsWith(" Y", StringComparison.OrdinalIgnoreCase))
        {
            zoneRepresentedAsLocalDifferential  = String.Concat(s.Substring(0, (s.LastIndexOf(" Y") + 1)), "+12:00");
        }
        else
        {
            zoneRepresentedAsLocalDifferential  = s;
        }

        return zoneRepresentedAsLocalDifferential;
    }
    #endregion

    #region ToString(DateTime utcDateTime)
    /// <summary>
    /// Converts the value of the specified <see cref="DateTime"/> object to its equivalent string representation.
    /// </summary>
    /// <param name="utcDateTime">The Coordinated Universal Time (UTC) <see cref="DateTime"/> to convert.</param>
    /// <returns>A RFC 822 string representation of the value of the <paramref name="utcDateTime"/>.</returns>
    /// <exception cref="ArgumentException">The specified <paramref name="utcDateTime"/> object does not represent a <see cref="DateTimeKind.Utc">Coordinated Universal Time (UTC)</see> value.</exception>
    public static string ToString(DateTime utcDateTime)
    {
        if (utcDateTime.Kind != DateTimeKind.Utc)
        {
            throw new ArgumentException("utcDateTime");
        }

        return utcDateTime.ToString(Rfc822DateTime.Rfc822DateTimeFormat, DateTimeFormatInfo.InvariantInfo);
    }
    #endregion

    #region TryParse(string s, out DateTime result)
    /// <summary>
    /// Converts the specified string representation of a date and time to its <see cref="DateTime"/> equivalent.
    /// </summary>
    /// <param name="s">A string containing a date and time to convert.</param>
    /// <param name="result">
    /// When this method returns, contains the <see cref="DateTime"/> value equivalent to the date and time 
    /// contained in <paramref name="s"/>, expressed as <i>Coordinated Universal Time (UTC)</i>, 
    /// if the conversion succeeded, or <see cref="DateTime.MinValue">MinValue</see> if the conversion failed. 
    /// The conversion fails if the s parameter is a <b>null</b> reference (Nothing in Visual Basic), 
    /// or does not contain a valid string representation of a date and time. 
    /// This parameter is passed uninitialized.
    /// </param>
    /// <returns><b>true</b> if the <paramref name="s"/> parameter was converted successfully; otherwise, <b>false</b>.</returns>
    /// <remarks>
    /// The string <paramref name="s"/> is parsed using formatting information in the <see cref="DateTimeFormatInfo.InvariantInfo"/> object. 
    /// </remarks>
    public static bool TryParse(string s, out DateTime result)
    {
        //------------------------------------------------------------
        //  Attempt to convert string representation
        //------------------------------------------------------------
        bool wasConverted   = false;
        result              = DateTime.MinValue;

        if (!String.IsNullOrEmpty(s))
        {
            DateTime parseResult;
            if (DateTime.TryParseExact(Rfc822DateTime.ConvertZoneToLocalDifferential(s), Rfc822DateTime.Rfc822DateTimePatterns, DateTimeFormatInfo.InvariantInfo, DateTimeStyles.AdjustToUniversal, out parseResult))
            {
                result          = DateTime.SpecifyKind(parseResult, DateTimeKind.Utc);
                wasConverted    = true;
            }
        }

        return wasConverted;
    }
    #endregion 
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-07-06T12:26:33.463

最好改用 DateTime.Now.Tostring("r")

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-05T20:13:08.277

接近这个的东西应该可以工作：

```
string orig = "Wed, 29 Oct 2008 14:14:48 +0000";
string newstring = String.Format("{0:MM/dd/yyyy hh:mm tt}", DateTime.Parse(orig.Remove(orig.IndexOf(" +")))); 
```

取自[http://blog.stevex.net/index.php/string-formatting-in-csharp/](http://blog.stevex.net/index.php/string-formatting-in-csharp/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-05T20:23:38.507

我认为将其放入 DateTime 将与此一起使用：

```
string d = "Wed, 29 Oct 2008 14:14:48 +0000";

string RFC822 = "ddd, dd MMM yyyy HH:mm:ss zzz";
DateTime dt = DateTime.ParseExact( d, RFC822,
                                   DateTimeFormatInfo.InvariantInfo,
                                   DateTimeStyles.None); 
```

您可能需要修改 RFC822 格式字符串末尾的时区信息 (zzz)。

# filter - MDX过滤器问题

> ID：266455
> 
> 赞同：3
> 
> 时间：2008-11-05T20:10:04.553
> 
> 标签：filter, mdx, hyperion, essbase

我对整个 MDX 很陌生，但以下内容让我很生气。`FILTER`我正在使用的一个陈述是……奇怪。代码示例，后跟描述：

```
SELECT
    {
        FILTER(
            MEMBERS([Time].[5-4-4 Week Year]),
            [Measures].[Ship Gross Units] > 0
        )
    }
    ON COLUMNS,
    {
        FILTER(
            MEMBERS([Group].[Alternate Hierarchies]),
            [Measures].[Ship Gross Units] > 0
        )
    }
    ON ROWS
FROM SBD.SBD
WHERE
    (
        [FiscalYear].[FY09],
        [Scenario].[Actuals Total],
        [Measures].[Ship Gross Units],
        [Channel].[FOS]
    ) 
```

我正在尝试按财政年度的一周（有些列被稍微混淆）来提取特定销售渠道的总单位。所有这些过滤器都已到位，因为我经常需要在 SKU 级别分解这些过滤器，并且在我的机器上处理截断的数据集更简单（我说让数据库来完成工作！）。

**问题是**，此查询返回 FOS 渠道中的 0 销售额。这看起来很奇怪，所以我删除了行过滤器：

```
SELECT
    {
        FILTER(
            MEMBERS([Time].[5-4-4 Week Year]),
            [Measures].[Ship Gross Units] > 0
        )
    }
    ON COLUMNS,
    MEMBERS([Group].[Alternate Hierarchies])
    ON ROWS
FROM SBD.SBD
WHERE
    (
        [FiscalYear].[FY09],
        [Scenario].[Actuals Total],
        [Measures].[Ship Gross Units],
        [Channel].[FOS]
    ) 
```

突然之间，FOS 渠道中出现了销售。这让我大吃一惊；以前，我假设我正在过滤以仅接收显示销售的行，但我没有得到。现在我正在显示所有内容，并且有销售行。用 Perl 或其他什么来解决这个问题很容易，但我宁愿“正确”地解决它。

我有理由确定我只是误解了一些琐碎的细节，但我已经厌倦了把头撞在桌子上。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T02:29:29.280

我通常使用 Microsoft Analysis Services，但 MDX 通常与 Essbase 中使用的非常相似。

该轴将被独立评估，因此 Group 上的过滤器语句将仅查看 where 子句中的成员。那么，您的总单位是否有可能有一些负数并且在 09 财年小于或等于 0？或者您的单位数量是否足够大，以至于它们可能会溢出数据类型并环绕为负数？

如果您只是在寻找非空单元格，一种可能的解决方法是在轴上使用 NON EMPTY 关键字。例如。

```
SELECT    
   NON EMPTY MEMBERS([Time].[5-4-4 Week Year]),
     ON COLUMNS,
   NON EMPTY  MEMBERS([Group].[Alternate Hierarchies])
     ON ROWS
FROM SBD.SBD
WHERE
    (
        [FiscalYear].[FY09],
        [Scenario].[Actuals Total],
        [Measures].[Ship Gross Units],
        [Channel].[FOS]
    ) 
```

# asp.net - How would I serialize a LINQ-to-SQL lazy list

> ID：266457
> 
> 赞同：6
> 
> 时间：2008-11-05T20:10:28.657
> 
> 标签：asp.net, asp.net-mvc, linq-to-sql, serialization

I have a linq query and I am trying to put that in to a serializable object for a distributed caching (Velocity) but its failing due to a LINQ-to-SQL lazy list

like so

```
 return from b in _datacontext.MemberBlogs
                   let cats = GetBlogCategories(b.MemberBlogID)
                   select new MemberBlogs
                   {
                       MemberBlogID = b.MemberBlogID,
                       MemberID = b.MemberID,
                       BlogTitle = b.BlogTitle,
                       BlogURL = b.BlogURL,
                       BlogUsername = b.BlogUsername,
                       BlogPassword = b.BlogPassword,
                       Categories = new LazyList<MemberBlogCategories>(cats)
                   }; 
```

LazyList is the same class Rob Conery uses in his MVC storefront...

all three classes are marked serializable (MemberBlogs,MemberBlogCategories,LazyList... any ideas?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-05T20:32:52.370

If you are putting it in a distributed cache you will need to avoid the LazyList altogether. You can then call .ToList() around the whole LINQ statement as in:

```
(from x select new MemberBlogs).ToList() 
```

This should then be cachable because it forces the queries to be evaluated.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T20:33:37.300

I'm just guessing, but I'd say the problem is that it is serializing the query instead of the results; I don't know what the implementation of the LazyList looks like, but you can probably add an OnSerializing method that actually executes the query prior to serializing it; Something like:

```
[OnSerializing]
private void ExecuteLinqQuery(StreamingContext context)
{
    if (!SomethingThatIndicatesThisLinqQueryHasNotBeenExecuted)
        LinqVariable.ToList()
} 
```

This way you get to keep the Lazy Load (for anything that doesn't go into your cache), but then also if it does hit the cache, it'll execute the linq query and cache the results.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T20:31:33.933

If you're caching it why are you using a lazy list? Don't use a lazy list, use caching, and the problem goes away.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-07T20:22:14.313

I know this is an old post but I had the same issue as I wanted to execute my LazyList and put them into the AppFabric Cache. I ended up putting some custom serialization logic into the LazyList type.

The first part now looks like this:

```
 public class LazyList<T> : IList<T>, ISerializable
{

    public LazyList()
    {
        this.query = new List<T>().AsQueryable();
    }

    public LazyList(SerializationInfo info, StreamingContext context)
    {
        try {
            this.inner = (List<T>)info.GetValue("InnerList", typeof(List<T>));
        }
        catch (Exception ex)
        {
            this.inner = null;
        }
    }

    public void GetObjectData(SerializationInfo info, StreamingContext context)
    {
        if (this.inner != null)
            info.AddValue("InnerList", this.inner.ToList());
    }

    public LazyList(IQueryable<T> query)
    {
        this.query = query;
    }

    public LazyList(List<T> l)
    {
        inner = l;
    }
} 
```

# java - 在 java 中，如何将 java.awt.image.BufferedImage 写入 8 位 png 文件？

> ID：266486
> 
> 赞同：8
> 
> 时间：2008-11-05T20:17:22.793
> 
> 标签：java, image, io, awt

我正在尝试从 java.awt.image.BufferedImage 中写出一个 png 文件。一切正常，但生成的 png 是 32 位文件。

有没有办法让 png 文件变成 8 位？图像是灰度的，但我确实需要透明度，因为这是叠加图像。我正在使用 java 6，并且我希望返回一个 OutputStream，以便我可以让调用类处理将文件写入磁盘/db。

这是代码的相关部分：

```
 public static ByteArrayOutputStream createImage(InputStream originalStream)
            throws IOException {

        ByteArrayOutputStream oStream = null;

        java.awt.Image newImg = javax.imageio.ImageIO.read(originalStream);
        int imgWidth = newImg.getWidth(null);
        int imgHeight = newImg.getHeight(null);
        java.awt.image.BufferedImage bim = new java.awt.image.BufferedImage(imgWidth,
                imgHeight, java.awt.image.BufferedImage.TYPE_INT_ARGB);

        Color bckgrndColor = new Color(0x80, 0x80, 0x80);

        Graphics2D gf = (Graphics2D)bim.getGraphics();

        // set transparency for fill image
        gf.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER, 0.3f));
        gf.setColor(bckgrndColor);
        gf.fillRect(0, 0, imgWidth, imgHeight);

        oStream = new ByteArrayOutputStream();
        javax.imageio.ImageIO.write(bim, "png", oStream);
        oStream.close();

        return oStream;
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-06T18:23:35.440

内置的 imageio png writer 将在我使用过的所有平台上写入 32 位 png 文件，无论源图像是什么。您还应该知道，许多人抱怨生成的压缩比使用 png 格式的压缩要低得多。有几个独立的[png 库](http://www.catcode.com/pngencoder/)可让您指定确切的格式，但我实际上对其中任何一个都没有任何经验。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-06T00:44:14.157

这是一个有趣的问题……时间不早了，我明天做实验。我将首先尝试使用 BufferedImage.TYPE_BYTE_INDEXED（可能在绘制之后）来查看 Java 是否足够智能以生成 8 位 PNG。
或者也许某些图像库可以允许这样做。

[编辑]几年后...实际上，我当时编写了代码，但忘记更新此线程...我使用[了 Kat 指出的代码](http://gman.eichberger.de/2007/07/transparent-gifs-in-java.html)，对透明度的处理进行了一些改进，并保存在PNG 格式而不是 Gif 格式。它适用于制作具有全有或全无透明度的 8 位 PNG 文件。

您可以使用我的[ImageUtil](http://bazaar.launchpad.net/~philho/+junk/Java/view/head:/Utilities/src/org/philhosoft/util/ImageUtil.java)类在[http://bazaar.launchpad.net/~philho/+junk/Java/view/head:/Tests/src/org/philhosoft/tests/image/AddTransparency.java](http://bazaar.launchpad.net/~philho/+junk/Java/view/head:/Tests/src/org/philhosoft/tests/image/AddTransparency.java)找到一个工作测试文件.

由于代码不是那么大，为了后代，我把它贴在这里，没有 JavaDoc 来节省一些行。

```
public class ImageUtil
{
  public static int ALPHA_BIT_MASK = 0xFF000000;

  public static BufferedImage imageToBufferedImage(Image image, int width, int height)
  {
    return imageToBufferedImage(image, width, height, BufferedImage.TYPE_INT_ARGB);
  }

  public static BufferedImage imageToBufferedImage(Image image, int width, int height, int type)
  {
    BufferedImage dest = new BufferedImage(width, height, type);
    Graphics2D g2 = dest.createGraphics();
    g2.drawImage(image, 0, 0, null);
    g2.dispose();
    return dest;
  }

  public static BufferedImage convertRGBAToIndexed(BufferedImage srcImage)
  {
    // Create a non-transparent palletized image
    Image flattenedImage = transformTransparencyToMagenta(srcImage);
    BufferedImage flatImage = imageToBufferedImage(flattenedImage,
        srcImage.getWidth(), srcImage.getHeight(), BufferedImage.TYPE_BYTE_INDEXED);
    BufferedImage destImage = makeColorTransparent(flatImage, 0, 0);
    return destImage;
  }

  private static Image transformTransparencyToMagenta(BufferedImage image)
  {
    ImageFilter filter = new RGBImageFilter()
    {
      @Override
      public final int filterRGB(int x, int y, int rgb)
      {
        int pixelValue = 0;
        int opacity = (rgb & ALPHA_BIT_MASK) >>> 24;
        if (opacity < 128)
        {
          // Quite transparent: replace color with transparent magenta
          // (traditional color for binary transparency)
          pixelValue = 0x00FF00FF;
        }
        else
        {
          // Quite opaque: get pure color
          pixelValue = (rgb & 0xFFFFFF) | ALPHA_BIT_MASK;
        }
        return pixelValue;
      }
    };

    ImageProducer ip = new FilteredImageSource(image.getSource(), filter);
      return Toolkit.getDefaultToolkit().createImage(ip);
  }

  public static BufferedImage makeColorTransparent(BufferedImage image, int x, int y)
  {
    ColorModel cm = image.getColorModel();
    if (!(cm instanceof IndexColorModel))
      return image; // No transparency added as we don't have an indexed image

    IndexColorModel originalICM = (IndexColorModel) cm;
    WritableRaster raster = image.getRaster();
    int colorIndex = raster.getSample(x, y, 0); // colorIndex is an offset in the palette of the ICM'
    // Number of indexed colors
    int size = originalICM.getMapSize();
    byte[] reds = new byte[size];
    byte[] greens = new byte[size];
    byte[] blues = new byte[size];
    originalICM.getReds(reds);
    originalICM.getGreens(greens);
    originalICM.getBlues(blues);
    IndexColorModel newICM = new IndexColorModel(8, size, reds, greens, blues, colorIndex);
    return new BufferedImage(newICM, raster, image.isAlphaPremultiplied(), null);
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T21:26:34.243

我在这里找到了如何将 RGBA 转换为索引的答案：[http ://www.eichberger.de/2007/07/transparent-gifs-in-java.html](http://www.eichberger.de/2007/07/transparent-gifs-in-java.html)

但是，生成的 8 位 png 文件只有 100% 或 0% 的透明度。您可能可以调整 IndexColorModel 数组，但我们决定将生成的文件（覆盖蒙版）制作为底层 jpg 并使用静态基础作为透明覆盖。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-06T20:10:30.700

感谢您的回复，我打算尝试`TYPE_BYTE_INDEXED`使用 IndexColorModel 并且可能仍然存在，但如果 ImageIO 写出 32 位，无论看起来我可能在那里浪费时间。

我试图写出的图像可能非常大（最大 8000x4000），但只是下面图像的一个简单蒙版，因此只有约 30% 的透明灰色和 100% 的透明切口。我会使用 GIF，但 IE6 似乎无法显示那么大的 GIF。

它只在内部设置类型屏幕中生成一次，因此性能也不是问题，但它必须在 java 代码中完成，而不是通过离线实用程序完成。

您指定的库可能用于在编写时对其进行转换……我要去看看。

如果有人有更好的方法，请告诉我！！

谢谢！

# javascript - 缩短 Prototype 中许多按钮的代码

> ID：266491
> 
> 赞同：0
> 
> 时间：2008-11-05T20:18:14.320
> 
> 标签：javascript, button, prototypejs, mouseevent

我有很多按钮，通过单击不同的按钮，会出现不同的图像和文本。我可以实现我想要的，但是代码太长了，而且看起来很重复。例如：

```
 var aaClick = false;
    $("aa").observe('click', function() {
        unclick();
        $('characterPic').writeAttribute('src',"aa.jpg");
        $('characterBio').update("aatext");
        $('aa').setStyle({ color: '#FFFFFF' });
        aaClick = true;
    });

    $("aa").observe('mouseover', function() {
        if (!aaClick) $('aa').setStyle({ color: '#FFFFFF' });
    });

    $("aa").observe('mouseout', function() {
        if (!aaClick) $('aa').setStyle({ color: '#666666' });
    });

    function unclick() {
         aaClick = false;
         $('aa').setStyle({ color: '#666666' });
    } 
```

与 bb、cc 等相同，每次添加新按钮时，我都需要将其添加到 unclick 功能中。这很烦人，我试图用谷歌搜索它，我只发现观察点击所有列出的项目，所以我仍然无法弄清楚，因为当点击其他按钮时我想要的涉及按钮向上。

有没有办法让一个通用函数接受不同的 id 但做完全相同的事情？因为从我看到的情况来看，如果我可以将aa替换为其他id，我可以减少很多代码。谢谢！！！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T20:30:30.520

将其全部构建到一个函数中，您可以在其中简单地将要注册的 DIV 的名称传递给它。只要您与您的 .jpg 名称一致，它应该可以工作。

```
var clicks = []
function regEvents(divName) {
    $(divName).observe('click', function() {
        unclick(divName);
        $('characterPic').writeAttribute('src',divName+".jpg");
        $('characterBio').update(divName"text");
        $(divName).setStyle({ color: '#FFFFFF' });
        clicks[divName] = true

    });

    $(divName).observe('mouseover', function() {
        if (!clicks[divName]) $(divName).setStyle({ color: '#FFFFFF' });
    });

    $(divName).observe('mouseout', function() {
        if (!clicks[divName]) $(divName).setStyle({ color: '#666666' });
    });
}
function unclick(divName) {
     clicks[divName] = false;
     $(clicks[divName]).setStyle({ color: '#666666' });
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T20:36:05.970

事件委托。给你所有的按钮一个类（例如`yourButtonClass`），然后......

```
var clicks = [];
$$('.yourButtonClass').each(function(button) {
    clicks.push(button.id);
});
$(document).observe('click', function(e) {
    // If your click registered on an element contained by the button, this comes in handy...
    var clicked = e.element().up('.yourButtonClass') || e.element();

    if(clicked.hasClassName('.yourButtonClass')) {
        unclick();
        $('characterPic').writeAttribute('src', clicked.id + '.jpg');
        $('characterBio').update(clicked.id + 'text');
        $(clicked).setStyle({ color: '#FFFFFF' });
        clicks[clicked.id] = true;
    }
}); 
```

等等...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T20:26:18.687

按钮是否共享一个公共容器？然后下面的代码工作：

```
$(container).childElements().each(function(element) {
    $(element).observe('click', function () { … });
    …
}); 
```

或者，您也可以这样做：

```
["aa", "bb", "cc"].each(function(element) { … same code … }); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T20:33:56.427

事件处理程序可以有一个将设置为事件目标的参数。然后您可以重用相同的功能：

```
var clickedHandler = function(element) { 
  $(element).addClass("selected");
};
$("aa").observe('click', clickedHandler);
$("bb").observe('click', clickedHandler); 
```

您还迫切需要 CSS 样式。请参阅我对您上一个问题的[回答](https://stackoverflow.com/questions/266199/prototype-click-mouseover-and-mouseout-cant-work-together#266228)，但您可以将模式重用于其他事件。

# c# - MSHTML：如何清除 MSHTML 的撤消/重做缓冲区

> ID：266497
> 
> 赞同：1
> 
> 时间：2008-11-05T20:21:47.980
> 
> 标签：c#, .net, webbrowser-control, mshtml

我正在使用类似于包含 COM/非托管 MSHTML 控件的 WebBrowser 控件的 C# 包装器控件。我在编辑模式下使用此控件，它允许应用程序的用户以所见即所得的方式编辑 HTML 文档。

该控件管理它自己的撤消/重做堆栈。

如何重置/清除它，以便用户无法重做/撤消对文档内容的更改，而只能编辑它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-06T15:25:18.420

要清除 MSHTML 控件的撤消堆栈，您可以使用撤消管理器服务。
启用和禁用 undo 服务时，undo 堆栈被清除。要从 MSHTML 的 Document 对象中提取撤消管理器，您需要使用 IServiceProvider。

解决方案是这样的：

```
 //Extract undo manager
    if (m_undoManager == null) 
    {
      IServiceProvider serviceProvider = Document as IServiceProvider;

      Guid undoManagerGuid = typeof(IOleUndoManager).GUID;
      Guid undoManagerGuid2 = typeof(IOleUndoManager).GUID;
      IntPtr undoManagerPtr = ComSupport.NullIntPtr;

      int hr = serviceProvider.QueryService(ref undoManagerGuid2, ref undoManagerGuid, out undoManagerPtr);
      if ((hr == HRESULT.S_OK) && (undoManagerPtr != ComSupport.NullIntPtr))
      {
        m_undoManager = (IOleUndoManager)Marshal.GetObjectForIUnknown(undoManagerPtr);
        Marshal.Release(undoManagerPtr);
      }
    }

    //And to clear the stack 
    m_undoManager.Enable(true);
    Application.DoEvents(); 
```

更详细的实现和更多信息可以在以下位置看到：

[http://postxing.net:8080/PostXING/tags/v1.1/PostXING.HtmlComponent/Html/](http://postxing.net:8080/PostXING/tags/v1.1/PostXING.HtmlComponent/Html/)

[http://msdn.microsoft.com/en-us/library/ms678623(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms678623(VS.85).aspx)

# c++ - 包含#include 指令的宏定义

> ID：266501
> 
> 赞同：39
> 
> 时间：2008-11-05T20:22:47.773
> 
> 标签：c++, c, macros, c-preprocessor

有没有办法定义一个`#include` 在其主体中包含指令的宏？

如果我只是把“ `#include`”，它给出了错误

```
C2162: "expected macro formal parameter" 
```

因为在这里我不用`#`来连接字符串。
如果我使用“ `\# include`”，则会收到以下两个错误：

```
error C2017: illegal escape sequence
error C2121: '#' : invalid character : possibly the result of a macro expansion 
```

有什么帮助吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2015-01-07T23:04:15.497

所以就像其他人说的那样，不，你不能在宏中包含#include 语句，因为预处理器只执行一次。但是，您可以使用我最近发现自己使用的一个技巧，让预处理器基本上做同样的事情。

意识到预处理器指令不会在宏中做任何事情，但是它们会在文件中做一些事情。因此，您可以将要变异的代码块粘贴到文件中，将其视为宏定义（可以由其他宏更改的部分），然后在各个位置#include 这个伪宏文件（make确保它没有包括警卫！）。它的行为与宏不完全一样，但它可以实现一些非常类似于宏的结果，因为#include 基本上只是将一个文件的内容转储到另一个文件中。

例如，考虑包含许多成组出现的类似名称的标头。将它们全部写出来很乏味，或者甚至它们是自动生成的。您可以通过执行以下操作部分自动化它们的包含：

辅助宏标头：

```
/* tools.hpp */

#ifndef __TOOLS_HPP__
#def __TOOLS_HPP__

// Macro for adding quotes
#define STRINGIFY(X) STRINGIFY2(X)    
#define STRINGIFY2(X) #X

// Macros for concatenating tokens
#define CAT(X,Y) CAT2(X,Y)
#define CAT2(X,Y) X##Y
#define CAT_2 CAT
#define CAT_3(X,Y,Z) CAT(X,CAT(Y,Z))
#define CAT_4(A,X,Y,Z) CAT(A,CAT_3(X,Y,Z))
// etc...

#endif 
```

伪宏文件

```
/* pseudomacro.hpp */

#include "tools.hpp"
// NO INCLUDE GUARD ON PURPOSE
// Note especially FOO, which we can #define before #include-ing this file,
// in order to alter which files it will in turn #include.
// FOO fulfils the role of "parameter" in this pseudo-macro.

#define INCLUDE_FILE(HEAD,TAIL) STRINGIFY( CAT_3(HEAD,FOO,TAIL) )

#include INCLUDE_FILE(head1,tail1.hpp) // expands to #head1FOOtail1.hpp
#include INCLUDE_FILE(head2,tail2.hpp)
#include INCLUDE_FILE(head3,tail3.hpp)
#include INCLUDE_FILE(head4,tail4.hpp)
// etc..

#undef INCLUDE_FILE 
```

源文件

```
/* mainfile.cpp */

// Here we automate the including of groups of similarly named files

#define FOO _groupA_
#include "pseudomacro.hpp"
// "expands" to: 
// #include "head1_groupA_tail1.hpp"
// #include "head2_groupA_tail2.hpp"
// #include "head3_groupA_tail3.hpp"
// #include "head4_groupA_tail4.hpp"
#undef FOO

#define FOO _groupB_
#include "pseudomacro.hpp"
// "expands" to: 
// #include "head1_groupB_tail1.hpp"
// #include "head2_groupB_tail2.hpp"
// #include "head3_groupB_tail3.hpp"
// #include "head4_groupB_tail4.hpp"
#undef FOO

#define FOO _groupC_
#include "pseudomacro.hpp"
#undef FOO

// etc. 
```

这些包含甚至可能位于您想要重复的代码块中间（更改 FOO），正如 Bing Jian 要求的答案：[包含 #include 指令的宏定义](https://stackoverflow.com/questions/266501/macro-definition-containing-include-directive/266647#266647)

我没有广泛使用这个技巧，但它可以完成我的工作。它显然可以根据需要扩展为具有尽可能多的“参数”，并且您可以在其中运行您喜欢的任何预处理器命令，并生成实际代码。您不能将它创建的内容用作另一个宏的输入，就像使用普通宏一样，因为您不能将包含内容粘贴在宏中。但它可以进入另一个伪宏:)。

其他人可能会对其他限制有一些评论，以及可能出什么问题:)。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-05T21:10:05.680

我不会争论它的优点，但是 freetype (www.freetype.org) 做了以下事情：

```
#include FT_FREETYPE_H 
```

他们在其他地方定义 FT_FREETYPE_H

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-08-31T21:23:33.887

C 和 C++ 语言明确禁止作为宏扩展的结果形成预处理器指令。这意味着您不能将预处理器指令包含到宏替换列表中。如果你试图通过串联（以及类似的技巧）“构建”一个新的预处理器指令来欺骗预处理器，那么行为是未定义的。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-05T20:30:43.500

我相信 C/C++ 预处理器只对代码进行一次传递，所以我认为这行不通。您可能可以通过宏将“#include”放入代码中，但编译器会阻塞它，因为它不知道如何处理它。对于您尝试执行的操作，预处理器必须对文件进行第二次遍历才能获取#include。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-08-31T21:16:16.107

我也想这样做，原因如下：

如果您使用 C 或 C++ 进行编译，某些头文件（尤其是 OpenMPI 中的 mpi.h）的工作方式会有所不同。我正在从我的 C++ 程序链接到 C MPI 代码。要包含标题，我通常会这样做：

```
extern "C" {
#include "blah.h"
} 
```

但这不起作用，因为`__cplusplus`即使在 C 链接中仍然定义。这意味着 blah.h 包含的 mpi.h 开始定义模板并且编译器死了，说您不能使用带有 C 链接的模板。

因此，我在 blah.h 中要做的就是替换

```
#include <mpi.h> 
```

和

```
#ifdef __cplusplus
#undef __cplusplus
#include <mpi.h>
#define __cplusplus
#else
#include <mpi.h>
#endif 
```

值得注意的是，不只是 mpi.h 会做这种病态的事情。因此，我想定义一个`INCLUDE_AS_C`对指定文件执行上述操作的宏。但我想这行不通。

如果有人能想出另一种方法来实现这一点，请告诉我。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-05T21:00:17.450

我认为你没问题，因为我也从中得到了这项任务似乎是不可能的

[http://groups.google.com/group/comp.lang.c++/browse_thread/thread/03d20d234539a85c#](http://groups.google.com/group/comp.lang.c++/browse_thread/thread/03d20d234539a85c#)

> 不，C++（和 C）中的预处理器指令不是反射性的。
> 
> 帕维尔·齐帕克

无论如何，这种尝试背后的原因是我试图将以下重复使用的代码片段作为宏：

```
void foo(AbstractClass object)
{
    switch (object.data_type())
    {
    case AbstractClass::TYPE_UCHAR :
        {
        typedef unsigned char PixelType;
        #include "snippets/foo.cpp"
        }
        break;
    case AbstractClass::TYPE_UINT:
        {
        typedef unsigned int PixelType;
        #include "snippets/foo.cpp"
        }
        break;
    default:
        break;
    }
} 
```

对于另一项任务，我需要有类似的功能

```
void bar(AbstractClass object) 
```

我将放置在哪里

```
#include "snippets/bar.cpp" 
```

当然，特定于任务的代码是在“snippets/foo.cpp”和“snippets/bar.cpp”中编写的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-05T21:16:59.257

我不知道您实际上要做什么，但看起来您可能想要的是模板化函数。

这样 PixelType 只是代码块的模板参数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-05T20:29:32.423

为什么宏需要有一个#include？如果您要#include'ing 宏所在的任何文件，您可以将#include 与所有其余的#include 语句一起放在宏上方，并且一切都应该很好。

我认为没有理由让宏包含不能仅包含在文件中的任何内容。

* * *

## 回答 #9

> 赞同：-8
> 
> 时间：2008-11-05T20:41:49.217

传染性是正确的——如果你正在做：

我的文件.c：

```
#include "standardAppDefs.h"
#myStandardIncludeMacro 
```

标准AppDefs.h：

```
#define myStandardIncludeMacro #include <foo.h> 
```

为什么不直接说：

我的文件.c：

```
#include "standardAppDefs.h" 
```

标准AppDefs.h：

```
#include <foo.h> 
```

忘记宏？

# asp.net - 默认为 ListView 中的最后一页

> ID：266506
> 
> 赞同：3
> 
> 时间：2008-11-05T20:23:18.473
> 
> 标签：asp.net, listview, pagination

使用具有 LinqDataSource 和启用分页（使用 DataPager）的标准 ASP.NET ListView，默认显示最后一页结果的最佳方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-06T04:05:51.503

我从来没有这样做过，但是有几个地方我会查看是否可以进行您想要的更改：数据源的 OnSelecting 处理程序、ListView 的 OnPreRender 或 OnDataBinding 以及 DataPager 的 OnPreRender。本质上，您希望以`!IsPostBack`一种特殊的方式处理这种情况。我可能会先查看 DataPager，看看您是否可以找出有多少页并将其设置为最后一页。将页面设置为所需的页面后，您可能需要重新绑定数据源。之后，我会考虑为 ListView 添加一个 OnDataBinding 处理程序，看看你可以在那里做什么。我怀疑 PreRender 发生得太晚，ListView 没有任何效果，而 OnSelecting 虽然很适合通过基于表的函数进行过滤，但在这种情况下可能不会有多大好处。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T20:26:30.340

将当前页索引设置为页数 - 1。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T20:41:19.500

您需要知道总记录数和页面上显示的记录数。

[这篇](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2157164&SiteID=1)有用的帖子向您展示了如何获取记录数：

```
private LinqDataSourceSelectEventArgs args;
protected void LinqDataSource1_Selecting(object sender, LinqDataSourceSelectEventArgs e)
{
     args = e;           
     e.Result = new Database().Table.Whatever...                      
}

protected void LinqDataSource1_Selected(object sender, LinqDataSourceStatusEventArgs e)
{
     this.label1.Text = args.Arguments.TotalRowCount + " records";
} 
```

那里进一步讨论了与您的情况相似的情况。

# infragistics - 如何在不使用数据集中相关表的情况下在 ultragrid 中获取子波段？

> ID：266507
> 
> 赞同：5
> 
> 时间：2008-11-05T20:23:33.200
> 
> 标签：infragistics, ultrawingrid

我正在使用 linq 拉回一个对象（即客户），该对象可能具有其他对象（customer.orders）的集合。如果我可以将此客户列表传递给 ultragrid，并在数据绑定上显示客户和他们的订单的分层视图，我会很好。当我尝试这个时，我只是得到客户。任何人都知道如何让它与非数据集对象一起使用？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T15:28:31.037

弄清楚了。IList 集合有效，如果它是一个`IList<T>`. 只要确保`DisplayLayout.ViewStyle = ViewStyle.MultiBand`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-16T17:10:41.773

我尝试了以下方法，但没有奏效：

```
DisplayLayout.ViewStyle = ViewStyle.MultiBand 
```

我从[这个博客](http://puzzlefun.spaces.live.com/blog/cns!B8D1279D8C4B76E5!186.entry)中读到它必须是`List`而不是`IList`为了工作，它确实如此。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-12T15:23:57.143

我们使用自己的自定义网格数据源，因此我们首先创建一个带状结构，然后我们初始化数据 OnDemand，处理事件 InitializeDataRow InitializeRowsCollection CellDataRequested

我们使用标签在结构中导航。

# c++ - C++ 中模板和 STL 的缺点

> ID：266523
> 
> 赞同：7
> 
> 时间：2008-11-05T20:28:14.127
> 
> 标签：c++, templates, stl

使用 STL 或模板是否有任何缺点。有没有不适合的情况。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-05T20:29:39.477

首先，如果它们可以帮助您解决问题，您应该使用可能使用它们。模板是 C++ 中非常重要的一部分，并且多年来一直是标准的一部分。STL 在运行时非常强大和快速，所有体面的编译器都应该支持它，但当然也存在一些问题。

*   如果您有一个非常旧的编译器，则可能不完全支持 STL。
*   STL 实现的线程安全性可能适用于您的应用程序
*   模板可能会导致编译时间变慢，并且可能会导致更大的可执行文件，尤其是对于较旧的编译器。
*   编译器经常在使用模板的代码上产生难以理解的错误消息。

仅举几例，但不使用它们的缺点可能要大得多。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-05T20:32:36.770

明显的缺点：

*   语法可能很糟糕 - C++ 中的一些模板语法确实在推动理智的极限，并与语言的其他部分重叠（例如 >>）

*   很多人不太了解 STL，因此您可能会限制您的受众。

*   错误消息往往非常复杂。

*   STL 集合的设计往往会导致大量的对象复制。最初的“智能指针”（std::auto_ptr）不适合在大多数集合中使用。最近这方面的情况有所改善（TR1）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-05T20:47:19.237

有几个潜在的好处和缺点

*   模板扩大了生成代码的大小。
*   模板代码在编译时扩展和处理，这可能会使编译时间更长。（另一方面，可执行代码可能更有效）。
*   误用 STL 元素会导致代码变慢
*   STL 实际上使代码更具可读性（我的观点与 Will 不同）。像任何语言或库一样，您必须理解它才能适当地使用它……这对于不了解它的人来说是一个*缺点*。
*   如果您在元编程意义上使用模板（不要与使用 STL 混淆），代码看起来像是一种与 C++ 完全不同的语言。解析代码实际在做什么可能更难。（OTOH，做得对 - 元编程让您专注于架构和设计；它还为编译时间和运行时带来更多错误。当您拥有关键功能并且您可以捕获错误编码的部分时，这是一个巨大的胜利在编译时而不是让客户在运行期间捕获它！）

话虽如此，我们使用 C++ 和模板（在某些领域还使用元编程技术）来造福于我们的整体代码库。代码比没有模板时的代码略大，但性能和可维护性的权衡大于大小。我们确实有熟练/经验丰富的 C++ 程序员致力于开发和维护代码。

如果您使用缺点来决定是否使用 C++ 功能/库 - 请确保您同样权衡语言的好处以及您的项目/产品/公司愿意权衡的好处。希望这可以帮助。

编辑：我忘了提到的另一个主要缺点 - 便携性。如果您需要编写可移植的代码，模板可能不是正确的方法。当今大多数流行的编译器都支持 STL，但大多数并不是全部。元编程技术可能是可移植性的真正杀手，因此这是确定其使用适当性的明确考虑因素。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-05T21:43:44.520

1.  严重的模板滥用（特别是模板元编程和 Boost 成瘾）可能导致编译和链接时间过长。

2.  您还会得到具有相当大（未剥离）二进制文件的可执行文件，但通常这不是一个可怕的问题。

3.  设计不佳的模板还会增加代码重复，进一步加剧可执行文件大小问题。

4.  对于具有大型实现的类模板，还需要考虑这样一个事实，即为它们使用模板意味着将整个类主体移动到某个地方的标题中。如果模板在多个地方使用，这会给链接器带来更多的负载。

5.  来自大量模板化代码的错误消息可能会让初学者望而却步，而且很少能像从非模板化代码中得到的错误消息那样清晰。

也就是说，对于大多数应用程序来说，模板是代码重用的绝佳工具，有助于提升从重新实现到重用代码的讨论水平；这些问题很少胜过好处。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-05T20:55:36.663

用于嵌入式设备编程（在我的例子中——智能手机）。由于担心生成的代码大小（少量 RAM 和磁盘空间），不鼓励使用模板。此外，编译器非常古老，可能无法处理一些与模板相关的构造。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-05T21:22:53.660

套用现代 C++ 设计名声的 Andrei Alexandrescu 的话。[模板是多重继承的正交结构](http://www.informit.com/content/images/0201704315/samplechapter/alexandrescuch1.pdf)。它们都有互补的权衡和好处。模板具有丰富的机制，但模板的专业化无法扩展。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-06T01:39:20.053

模板的目标是以最小的性能损失提供抽象。在大多数情况下，利大于弊。模板的大部分问题来自编译器和调试器的支持。

我对模板的不满：由于标头依赖性，它击败了智能构建系统。与开发纯面向对象的系统相比，开发模板代码往往会导致更多未修改代码的重新编译，尤其是如果后者很好地使用了 DIP（依赖倒置原则）。这加剧了慢编译问题。OTOH，如今更快的开发硬件使事情比以前更容易忍受。

至于 STL（以及 Boost），他们的目标是提供可移植且合理高效的数据结构和算法。对于某些性能关键的应用程序，它们不一定是最佳选择。例如：虽然`hash_map`（`tr1/unordered_map`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-05T20:34:48.607

有很多支持和反对 C++ 模板的哲学（充其量）论据，但我倾向于接受最多的是在编译时实例化它们的机制会产生大量代码膨胀。

虽然这通常不是什么大问题，但当您为嵌入式系统编写代码时，对二进制大小的限制非常有限，它会产生重大影响。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-05T20:35:13.317

在 MSVC 实现中，std::string 每个字符串有 26 个字节的开销，即使字符串为空。如果您只使用 char*，则每个字符串将是 4 个字节。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-05T20:59:25.390

复杂的 STL 容器（以及任何复杂的 C++ 类）使调试变得更加困难。

除了前面提到的不可读的错误消息外，当前的调试器通常很少支持处理 STL 结构。例如，在运行时检查原生 C 数组比 vector<> 容器容易得多。

希望情况会随着时间而改变。除此之外，模板很棒。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-05T20:45:11.050

一种可能是它们很难翻译成其他不支持模板的面向对象语言，例如 C# 和 Java，因此如果您有来自这些语言的开发人员组，他们将面临更陡峭的学习曲线。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-05T20:53:21.113

模板实例化的方式要求您在跨翻译单元共享模板时注意如何声明和定义模板。“C++ 模板：完整指南”一书是有关如何处理此问题的良好信息来源。

模板的编译器和链接器错误消息往往非常非常冗长。你必须习惯这一点，我认为有一些脚本/工具可以使它们更具可读性，但我对它们没有任何经验。

但除此之外，模板很棒！

* * *

## 回答 #13

> 赞同：-6
> 
> 时间：2008-11-05T21:31:24.110

请参阅[C++ FQA [原文如此] 的](http://yosefk.com/c++fqa/)[模板部分](http://yosefk.com/c++fqa/templates.html)，了解许多不使用模板的充分理由。

# sql - 为什么在使用嵌套查询时不能引用用户定义的类型字段？

> ID：266546
> 
> 赞同：1
> 
> 时间：2008-11-05T20:33:36.863
> 
> 标签：sql, oracle, types, ora-00904

所以我的 oracle 数据库中有以下用户定义的类型：

```
CREATE OR REPLACE TYPE METRIC_IMPERIAL_DISTANCE AS OBJECT
(
  METERS_FEET INTEGER,
  CENTIMETERS_INCHES INTEGER,
  FRACTION NUMBER
) 
```

我可以执行以下操作：

```
SELECT t_id, get_distance_breakdown (h.height, h.unit_of_measure_id) height_breakdown
        FROM   heights h 
```

乃至

```
SELECT t_id, get_distance_breakdown (h.height, h.unit_of_measure_id).meters_feet height_meters_feet
        FROM   heights h 
```

但以下失败并出现 ORA-00904: "HEIGHT_BREAKDOWN"."METERS_FEET": invalid identifier 错误：

```
SELECT t_id, height_breakdown.meters_feet
FROM   (SELECT t_id, get_distance_breakdown (h.height, h.unit_of_measure_id) height_breakdown
        FROM   heights h); 
```

是什么赋予了？如果对此没有一些简单而明显的解决方法，那么这将大量减少对 oracle 的用户定义类型有用的东西。我觉得我一定是错过了什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-05T20:45:23.580

我相信 Oracle 需要为内联视图提供别名：

```
SELECT v.t_id, v.height_breakdown.meters_feet
FROM   (SELECT t_id, get_distance_breakdown (h.height, h.unit_of_measure_id) height_breakdown
        FROM   heights h) v; 
```

# visual-studio - 创建 Visual Studio Web 测试以上传具有随机文件名的文件

> ID：266548
> 
> 赞同：3
> 
> 时间：2008-11-05T20:33:49.297
> 
> 标签：visual-studio, sharepoint, load-testing, webtest

我有（经过相当多的工作）一个 Web 测试，它将使用包含在测试中的文件和识别该文件的 DeploymentItem 将文件上传到我的 SharePoint 文档库，以便可以在文件上传后参数中使用它。

这很好用，现在暂时忽略 SharePoint 因素，我想将 webtest 作为负载测试的一部分运行的图像。这意味着文件上传测试需要运行相当多次。如果我一直将同一个文件上传到同一个文件名，那就不是很好了。

我想要做的是在目标上创建一个随机文件，使用相同的文件数据。例如，我希望上传的文件具有文件名“image1”+ Guid.NewGuid.ToString() +“.jpg”。

除了在光盘上创建一个具有该名称的新文件并添加一个部署项或其他东西来每次定位该文件之外，我不知道如何执行此操作。这尤其是一个问题，因为 Web 测试将通过测试代理在我无法在其上创建那么多代码的机器上运行。

最坏的情况是我会在上传文件后删除文件。

关于如何做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T20:24:51.137

给定一个场景，其中文件 image1.jpg 被设置为部署项并被复制到构建目标，以下代码创建一个可用于以所需方式上传的文件

```
string image1Location = "image1" + Guid.NewGuid().ToString() + ".jpg"
 System.IO.File.Copy("image1.jpg", image1Location); 
```

文件被使用后

```
System.IO.File.Delete(image1Location) 
```

# c# - MEF，在请求分支时创建导入树

> ID：266549
> 
> 赞同：1
> 
> 时间：2008-11-05T20:33:54.600
> 
> 标签：c#, .net, mvp, mef

使用 MEF 我想做以下事情。

我有一个 WPF 外壳。我想从另一个 DLL 导入一个 UserControl 到 shell，它也是我的 MVP 三元组的一个视图。MVP 三元组的工作方式是，在演示者中，我有一个构造函数，它同时接受 IModel 和 IView 并将它们连接起来。因此，为了使其正常工作，我需要 MEF 执行以下操作：

1.  创建 IView 实现
2.  创建 IModel 实现
3.  创建 Presenter 并将 IModel 和 IView 传递给它的构造函数
4.  显示时将 IView 实现导入我的 shell

相反，它的作用是只创建类型 Exporting IView 并将其传递给 shell，基本上跳过步骤 2 和 3。当您考虑它时，它非常合乎逻辑，但是我如何告诉 MEF 也创建整个三元组我要一个IView。我不需要在我的 Shell .dll 中的其他任何地方引用 Presenter 或模型，因此将其作为 Import 也不是一种选择（无论如何它都会非常难看:)。

我正在使用最新的 MEF（Preview 2 Refresh）。任何人？

**==更新==**

我找到了一个解决方案，并在这里写了一篇博客：
[Krzysztof Koźmic's blog - Creating tree of dependencies with MEF](http://kozmic.pl/archive/2008/11/06/creating-tree-of-dependencies-with-mef/ "这里")

但是，如果有人提出更好的解决方案，我会非常高兴。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-12T23:08:57.373

在这里检查我的答案。

[http://codebetter.com/blogs/glenn.block/archive/2008/11/12/mvp-with-mef.aspx](http://codebetter.com/blogs/glenn.block/archive/2008/11/12/mvp-with-mef.aspx)

编辑：（*从链接中添加，以防止不被标记为低质量/ LOA*）

```
 1: using System.ComponentModel.Composition;
   2: using System.Reflection;
   3: using Microsoft.VisualStudio.TestTools.UnitTesting;
   4:  
   5: namespace MVPwithMEF
   6: {
   7:     /// <summary>
   8:     /// Summary description for MVPTriadFixture
   9:     /// </summary>
  10:     [TestClass]
  11:     public class MVPTriadFixture
  12:     {
  13:         [TestMethod]
  14:         public void MVPTriadShouldBeProperlyBuilt()
  15:         {
  16:             var catalog = new AttributedAssemblyPartCatalog(Assembly.GetExecutingAssembly());
  17:             var container = new CompositionContainer(catalog.CreateResolver());
  18:             var shell = container.GetExportedObject<Shell>();
  19:             Assert.IsNotNull(shell);
  20:             Assert.IsNotNull(shell.Presenter);
  21:             Assert.IsNotNull(shell.Presenter.View);
  22:             Assert.IsNotNull(shell.Presenter.Model);
  23:         }
  24:     }
  25:  
  26:     [Export]
  27:     public class Shell
  28:     {
  29:         private IPresenter _presenter = null;
  30:         
  31:         public IPresenter Presenter
  32:         {
  33:             get { return _presenter; }
  34:         }
  35:  
  36:         [ImportingConstructor]
  37:         public Shell(IPresenter presenter)
  38:         {
  39:             _presenter = presenter;
  40:         }
  41:     }
  42:  
  43:     public interface IModel
  44:     {
  45:     }
  46:  
  47:     [Export(typeof(IModel))]
  48:     public class Model : IModel
  49:     {
  50:         
  51:     }
  52:  
  53:     public interface IView
  54:     {
  55:     }
  56:  
  57:     [Export(typeof(IView))]
  58:     public class View : IView
  59:     {
  60:     }
  61:  
  62:     public interface IPresenter
  63:     {
  64:         IView View { get;}
  65:         IModel Model { get; }
  66:     }
  67:  
  68:     [Export(typeof(IPresenter))]
  69:     public class Presenter : IPresenter
  70:     {
  71:  
  72:         private IView _view;
  73:         private IModel _model;
  74:  
  75:         [ImportingConstructor]
  76:         public Presenter(IView view, IModel model)
  77:         {
  78:             _view = view;
  79:             _model = model;
  80:         }
  81:  
  82:         public IView View
  83:         {
  84:             get { return _view; }
  85:         }
  86:  
  87:         public IModel Model
  88:         {
  89:             get { return _model; }
  90:         }
  91:  
  92:     }
  93: } 
```

那么这里发生了什么？

Shell 被注入 Presenter。Presenter 被注入视图和模型。这里的一切都是单例，但不一定是。

我们两个示例之间的区别在于，Presenter 被注入到 shell 而不是 View 中。如果演示者正在创建视图，那么您不能只是先获取视图（就像他所做的那样），否则演示者将不会被创建。好吧，你可以做到，但你最终会把它砍成碎片。Cleaner 就是注入 Presenter 并让它暴露一个 IView。我们在 Prism 中做到了这一点，并且效果很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T22:01:55.090

您在博文中概述的方式是使用 MEF 的完全有效的方式。这是嵌套组合，在设计时始终牢记 Container 是决定者，因此作为插件/扩展器供应商，您将专注于“导出”的服务，重要的是，您应该不要担心您需要服务或“导入”什么（这一点在最后一滴中存在一些问题，但我听到的情况足够乐观）。

因此，在嵌套组合中，您可能需要一些外部服务，但同时您也可以提供一些。当您进行撰写时，它会将所有内容连接在一起。

我有一篇博文，其中包含 2 个说明这种思维方式的示例：

[http://www.sidarok.com/web/blog/content/2008/09/26/what-is-this-managed-extensibility-framework-thing-all-about.html](http://www.sidarok.com/web/blog/content/2008/09/26/what-is-this-managed-extensibility-framework-thing-all-about.html)

此外，要删除 dll 并查看其中的类型，您可以使用 DirectoryPartCatalog 来查看该文件夹。

您还需要注意同一合约有多个导出的场景，并从提供的元数据中确定正确的导出。

# iphone - iPhone 应用程序名称限制是什么？（他们在哪里记录？！）

> ID：266554
> 
> 赞同：3
> 
> 时间：2008-11-05T20:34:30.993
> 
> 标签：iphone, distribution, adhoc

我花了 2 天时间（以及大量的头/墙撞击）最终发现临时分发对我不起作用的原因是因为我的应用程序名称包含 UTF-8 字符。我仍然对像 Apple iPhone 这样广泛的国际平台如何禁止这一点感到困惑。

*即*，如果我的应用程序是中国围棋游戏，我不能称它为“围棋！（围棋）”？！

无论如何，我想知道...

*   这是实际的限制，还是临时流程中的错误？
*   对应用程序名称是否有其他限制（可能与 unix 不兼容的字符，如？、*、！、& 等）
*   任何地方都记录了这些吗？（如果是这样，在哪里:)
*   谁能指出应用商店中名称中带有 UTF-8 字符（尤其是日文/中文）的应用程序示例？

谢谢！

（我知道：看起来像几个问题，但它们确实都是相关的！）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-06T03:17:13.897

事实证明（根据 DTS），这是 iTunes 处理临时分发的方式中的一个错误。这个问题是特定于 ad-hoc 的——我的开发人员分发工作正常，我被告知应用商店也会很好地处理它——这只是 ad-hoc 分发（beta 测试等事情的常见机制。 )

在某种程度上，DTS 的回应是：

“我已经能够重现它。我还确认它似乎只是 Ad Hoc 分发的问题，所以我倾向于认为这是 iTunes 中的一个错误（我在 8.0.1 中进行了测试，最新） .

我正在等待 iPhone OS 工程部门对此作出裁决，但我建议您在测试用例应用程序中提交错误。”

（嘿，我可以自己投票吗？那是作弊吗？：D）

（答案：不，你不能。所以我想它会是；）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T20:37:28.523

OSX 通常原生支持 UTF8，从 Cocoa 到文件系统。

日本语中的一个例子： [http ://phobos.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=294753911&mt=8](http://phobos.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=294753911&mt=8)

如果我不得不猜测，您可能必须用 ASCII 命名您的应用程序，但您可以将应用程序标题设为 UTF8。不过不确定。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T00:06:54.997

您是否尝试过 Info.plist 中的 CFBundleDisplayName 键？

# xml - 如何将 XML 列重新加入到其来源的记录中？

> ID：266556
> 
> 赞同：2
> 
> 时间：2008-11-05T20:34:53.350
> 
> 标签：xml, sql-server-2005, tsql

我在 SQL Server 2005 的数据库中有一个表“Blah”，其中包含一个 PK 列 BlahID 和一个 XML 列 BlahItems。

该表有如下记录...

```
BlahID BlahItems
------ -------------------------------------------- ----------
1 <root><item name="Fred" /><item name="Wilma" /></root>
2 <root><item name="Lisa" /><item name="Bart" /></root>

```

如何查询该表以生成以下内容....

```
BlahID BlahItem
------ --------
1 弗雷德
1 威尔玛
2丽莎
2巴特

```

我设法得到的最接近的是在每条记录 FUNCTION 上，它执行以下操作......

```
CREATE FUNCTION dbo.Blahs(@id int)
RETURNS @list TABLE (BlahID int, BlahItem nvarchar(max))
BEGIN
    DECLARE @xml AS xml
    SELECT @xml = BlahItems FROM dbo.Blah AS b WHERE b.BlahID = @id

    INSERT INTO @list
    SELECT @id, tbl.col.value('@name','nvarchar(max)')
    FROM @xml.nodes('/root/item') tbl(col)
    RETURN
END

SELECT * FROM dbo.Blahs(1) 
```

```
BlahID BlahItem
------ --------
1 弗雷德
1 威尔玛

```

我的最终目标是创建“扩展”数据的视图，然后针对该视图进行查询。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T21:08:32.767

你可以试试这个查询：

```
SELECT BlahID, XmlItems.BlahItem.value('@name', 'nvarchar(100)') AS BlahItem
FROM Blah CROSS APPLY BlahItems.nodes('/root/item') AS XmlItems(BlahItem) 
```

有关更多信息，请查看Alex Homer 的这篇由[三部分组成的文章。](http://www.15seconds.com/issue/050803.htm)

# html - HTML DTD - 有什么意义？

> ID：266562
> 
> 赞同：5
> 
> 时间：2008-11-05T20:37:27.417
> 
> 标签：html, dtd, doctype

> **可能重复：**
> [html中有哪些不同的文档类型，它们是什么意思？](https://stackoverflow.com/questions/255470/what-are-the-different-doctypes-in-html-and-what-do-they-mean)

由于对 web 开发的某些方面相当缺乏经验（我总是更关注后端而不是前端），谁能给我他们的想法，我是否应该担心网页开头的 DOCTYPE 声明？

是最常见的 HTML 4.01，我应该构建我的网络应用程序以符合这个标准吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T20:39:23.700

John Resig (jQuery)在这件事[上有发言权。](http://ejohn.org/blog/html5-doctype/)此外，DocType 有助于使 MSIE6[使用正确的框模型](http://msdn.microsoft.com/en-us/library/bb250395.aspx#cssenhancements_topic2)，并且还减轻了验证站点的痛苦（这对开发来说是一件**好事**；将其视为调试）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T20:44:46.700

您绝对应该在页面中包含 DOCTYPE 作为第一条语句，因为它会将 Web 浏览器切换到标准模式。这意味着他们至少会尝试使用 W3C 和 IETF 标准来呈现您的页面，而不是遵循称为 quirks 模式的向后兼容模型。

根据我自己的观察，现在更多地使用[XHTML 1.0 Transitional](http://www.w3.org/TR/xhtml1/#a_dtd_XHTML-1.0-Transitional)而不是 HTML 4.01。XHTML 1.0 Transitional 是一种折中方案，它为您提供了 XHTML 的一些好处，但又不会太繁琐。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T23:20:23.063

DTD 用于验证和实体定义。它们*粗略*地指定了某种标记语言和版本的语法要求。

可以使用验证器对 DTD 进行验证。或者，它可能由用户代理在解析期间完成（就像某些*验证*HTML/XML 解析器的情况一样）。如果用户代理支持，DTD 中定义的实体可能可用。

DOCTYPE 声明是标记语言（至少在 HTML 和 XML 中）引用文档中的内联/外部 DTD 的方式。

现在，就浏览器的 HTML(text/html) 解析器而言，DOCTYPE 声明只是控制渲染模式（DOCTYPE 切换）。根据引用的 HTML 版本以及是否指定 DTD URI，模式将是标准、几乎标准或怪癖。不使用实际的 dtd。

例如，带有 DTD URI 的 XHTML 1.0 过渡文档类型可能只会将浏览器置于几乎标准模式，而带有 DTD URI 的 XHTML 1.0 严格文档类型应该将浏览器置于标准模式。此外，HTML5 的文档类型 <!DOCTYPE html> 会将所有浏览器置于标准模式，并将 IE8+ 置于超级标准模式（因此在呈现时它的行为更像现代浏览器）。但一般来说，doctype 对 Javascript 和 DOM 支持影响不大（但也有例外，尤其是 IE8）。

对于浏览器，由于您几乎总是想要完全标准模式，因此您真正需要的是 <!DOCTYPE html>。更多的东西不会帮助浏览器。但是，该文档类型适用于 HTML5。如果您想符合 HTML 4.01 DTD 或 XHTML 1.0 DTD，则必须使用 HTML 4.01 strict 或 XHTML 1.0 strict 和正确的 DTD URI 来获得完全标准模式。

如果你想符合 HTML5，你可以在[http://validator.nu/](http://validator.nu/)测试你的语法。它不针对 DTD 进行验证，并且比 DTD 验证更先进。它还比 DTD 更好地反映了 HTML 5，并且由于 HTML5 更好地反映了浏览器真正支持的内容，因此它的语法检查与浏览器世界更加兼容。

如果您想符合 HTML 4.01 或 XHTML 1.0 *DTD*，请使用 W3C 验证器。请注意，这些 DTD 并不反映浏览器支持的内容，而只是粗略地反映了它们所适用的规范。这些 DTD 更多地用于捕获粗略的语法错误以及充分利用它们的非浏览器用户代理。他们也不知道浏览器在 text/html 和 application/xhtml+xml 之间的行为有何不同。

要阅读有关*浏览器*Doctype 切换的信息：

[http://www.mozilla.org/docs/web-developer/quirks/doctypes.html](http://www.mozilla.org/docs/web-developer/quirks/doctypes.html)

[http://www.opera.com/docs/specs/doctype/](http://www.opera.com/docs/specs/doctype/)

[http://hsivonen.iki.fi/doctype/](http://hsivonen.iki.fi/doctype/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T22:02:26.183

抛开所有好的做法不谈，人们使用诸如 XHTML 1.0 Transitional 之类的 DOCTYPE 的最大原因是将 IE 中的 CSS 框模型切换为与其他浏览器相同。这避免了对 CSS 布局的很多挫败感。这里有更详细的解释： http: [//css.maxdesign.com.au/listamatic/about-boxmodel.htm](http://css.maxdesign.com.au/listamatic/about-boxmodel.htm)

# java - 原始数组的现代 for 循环

> ID：266570
> 
> 赞同：13
> 
> 时间：2008-11-05T20:38:24.590
> 
> 标签：java, performance, arrays, iteration

原始数组上的 for 循环之间是否存在性能差异？

认为：

```
double[] doubleArray = new double[300000];

for (double var: doubleArray) 
   someComplexCalculation(var); 
```

或者 ：

```
for ( int i = 0, y = doubleArray.length; i < y; i++)
   someComplexCalculation(doubleArray[i]); 
```

**测试结果**

我实际上分析了它：

```
Total timeused for modern loop= 13269ms
Total timeused for old loop   = 15370ms 
```

所以现代循环实际上运行得更快，至少在我的 Mac OSX JVM 1.5 上是这样。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T21:05:34.223

我的观点是你不知道也不应该猜测。这些天试图超越编译器是徒劳的。

有时人们学习“模式”似乎可以优化某些操作，但在 Java 的下一个版本中，这些模式实际上更慢。

始终尽可能清楚地编写它，并且不要担心优化，直到您确实掌握了一些用户规范并且未能满足某些要求，即使如此，在测试之前和之后也要非常小心地运行以确保您的“修复”实际上对其进行了足够的改进以使该要求通过。

编译器可以做一些令人惊叹的事情，这些事情真的会让你大吃一惊，即使你做了一些迭代某个大范围的测试，如果你有一个更小的范围或改变循环内发生的事情，它的执行可能会完全不同。

即时编译意味着它有时可以胜过 C，并且在某些情况下它没有理由不能胜过静态汇编语言（汇编无法事先确定不需要调用，Java 有时可以做到这一点。

总而言之：您可以在代码中投入的最大价值就是将其编写为可读性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-05T21:17:25.620

您手写的“旧”表单执行的指令更少，并且可能更快，尽管您必须在给定的 JIT 编译器下对其进行分析才能确定。“新”形式肯定**不会**更快。

如果您查看反汇编代码（由 Sun 的 JDK 1.5 编译），您会看到“新”形式等价于以下代码：

```
1: double[] tmp = doubleArray;
2: for (int i = 0, y = tmp.length; i < y; i++) {
3:   double var = tmp[i];
4:   someComplexCalculation(var);
5: } 
```

因此，您可以看到使用了更多的局部变量。`doubleArray`第 1 行对to的分配`tmp`是“额外的”，但它不会出现在循环中，并且可能无法测量。第 3 行的分配`var`也是额外的。如果在性能上有差异，这将是负责的。

第 1 行似乎没有必要，但如果数组是在进入循环之前通过方法计算的，则缓存结果是样板文件。

也就是说，我会使用新形式，除非你需要对索引变量做一些事情。JIT 编译器可能会在运行时优化掉任何性能差异，并且新形式更加清晰。如果您继续“手动”执行此操作，您可能会错过未来的优化。一般来说，一个好的编译器可以很好地优化“愚蠢”的代码，但会偶然发现“聪明”的代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T20:39:07.383

为什么不自己测量呢？

这听起来有点刺耳，但是这类问题很容易验证自己。

只需创建数组并执行每个循环 1000 次或更多次，然后测量时间量。重复几次以消除故障。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-05T20:45:17.370

没有区别。Java 会将增强的 for 转换为普通的 for 循环。增强的 for 只是一个“语法糖”。两个循环生成的字节码是相同的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-06T16:20:37.357

即使在我之前的回答之后，我也对你的问题感到非常好奇。所以我决定自己也检查一下。我写了一小段代码（请忽略有关检查数字是否为素数的数学正确性；-)）：

```
public class TestEnhancedFor {

    public static void main(String args[]){
        new TestEnhancedFor();
    }

    public TestEnhancedFor(){
        int numberOfItems = 100000;
        double[] items = getArrayOfItems(numberOfItems);
        int repetitions = 0;
        long start, end;

        do {
            start = System.currentTimeMillis();
            doNormalFor(items);
            end = System.currentTimeMillis();
            System.out.printf("Normal For. Repetition %d: %d\n", 
                    repetitions, end-start);

            start = System.currentTimeMillis();
            doEnhancedFor(items);
            end = System.currentTimeMillis();
            System.out.printf("Enhanced For. Repetition %d: %d\n\n", 
                    repetitions, end-start);

        } while (++repetitions < 5);
    }

    private double[] getArrayOfItems(int numberOfItems){
        double[] items = new double[numberOfItems];
        for (int i=0; i < numberOfItems; i++)
            items[i] = i;
        return items;
    }

    private void doSomeComplexCalculation(double item){
        // check if item is prime number
        for (int i = 3; i < item / 2; i+=2){
            if ((item / i) == (int) (item / i)) break;
        }
    }

    private void doNormalFor(double[] items){
        for (int i = 0; i < items.length; i++)
            doSomeComplexCalculation(items[i]);
    }

    private void doEnhancedFor(double[] items){
        for (double item : items)
            doSomeComplexCalculation(item);
    }

} 
```

运行该应用程序为我提供了以下结果：

> 正常的。重复 0：5594 增强。重复0：5594
> 
> 正常的。重复1：5531增强。重复1：5547
> 
> 正常的。重复 2：5532 增强。重复2：5578
> 
> 正常的。重复 3：5531 增强。重复3：5531
> 
> 正常的。重复 4：5547 增强。重复4：5532

我们可以看到，结果之间的差异非常小，有时正常循环运行得更快，有时增强循环更快。由于我的电脑中打开了其他应用程序，我觉得这很正常。此外，只有第一次执行比其他执行慢——我相信这与 JIT 优化有关。

正常循环的平均时间（不包括第一次重复）为 5535,25 毫秒，增强循环为 5547 毫秒。但是我们可以看到两个循环的最佳运行时间是相同的（5531ms），所以我认为我们可以得出结论，两个循环具有相同的性能——并且经过时间的变化是由于其他应用程序（甚至机器的操作系统）。

# sql-server - 在 SQL Server 代理作业中，我应该在哪里存储敏感的加密密码？

> ID：266575
> 
> 赞同：5
> 
> 时间：2008-11-05T20:40:51.917
> 
> 标签：sql-server, ssis, sql-server-agent

我更喜欢将我们的 SSIS 包保存在服务器上的解决方案中，而不是 sql 中。默认情况下，敏感数据使用用户密钥加密。由于 sql server 代理使用服务帐户来运行作业，因此我们必须将此加密方法更改为其他方式。我喜欢用密码加密。

问题是每当我在一个步骤中设置作业时，都没有地方输入此密码。当我单击配置选项卡时，我会弹出一个密码对话框。这样可以使其正确存储，但这真的是放置它的正确位置。这似乎真的很不寻常，如果我进行某些更改，我会不断遇到问题，它似乎会自行重置。

有谁知道输入这个密码的更好的地方更稳定？

谢谢，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T21:45:46.763

如果您可以使用 Windows 身份验证并避免 SQL Server 身份验证，并确保您的服务帐户可以使用执行包所需的权限，那么您根本不需要在包中设置密码。

除此之外，您应该已经使用包配置使用配置文件覆盖连接字符串，以便您的包是可移植的，然后密码不需要在 dtsx 中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-17T19:55:52.810

您在本地项目解决方案中部署包和存储包的方式可能会有所不同。您可以在本地保存包时使用密码保存敏感数据，并在部署包时“依靠服务器存储和角色进行访问控制”。尽管数据不会以加密格式存储在 msdb 数据库中，但您可以通过管理预先存在的数据库角色来限制对密码信息的访问。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-26T17:31:29.627

您需要在您的工作上设置密码。

转到作业的属性 > 在步骤上单击两次 > 在“常规”选项卡中输入您的登录名和密码，然后在“配置”选项卡中输入您的密码（您在 SSIS 中输入的密码）

# apache-flex - 最小化 Flex 应用程序大小的一般技巧和技巧

> ID：266578
> 
> 赞同：4
> 
> 时间：2008-11-05T20:41:29.203
> 
> 标签：apache-flex, actionscript-3, user-experience

我真的很喜欢 Flex 框架，但是我经常处理大约 500KB 的 SWF 文件。

我不知道什么时候一个文件被认为“太大”而不能在互联网上提供，但我认为仅仅为了使用 Web 应用程序而下载 500KB 肯定会惹恼一些用户。

是否有任何减少已编译 SWFS 大小的提示或技术？

作为旁注，500KB SWF 文件真的不是那么大的应用程序......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-06T00:06:06.090

这可能对您有所帮助： [http ://www.onflex.org/ted/2008/01/flex-3-framework-caching.php](http://www.onflex.org/ted/2008/01/flex-3-framework-caching.php)

用户可能之前已经遇到过打包的框架，所以它会被缓存。至少他们不必再次从您的站点加载它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-06T03:42:22.973

我可以想到两件事来尝试。

首先不要嵌入图像、字体和其他 SWF 文件。这将导致它们在运行时加载，因此这可能会影响页面加载时的性能，但 SWF 会更小。

还可以尝试将应用程序拆分为多个模块。我知道这提高了初始加载时间的性能，但我不知道它是否会减少顶级 SWF 的大小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T20:50:47.547

这个答案比您可能正在寻找的更笼统（它适用于所有网络应用程序，无论是基于 Flash/Flex 还是基于 HTML/CSS/JS 或其他），但是......

这在很大程度上取决于您的应用程序的用例。它是一个将整天加载并在必要时提取更新的应用程序（如 Gmail），还是将启动、使用然后关闭的应用程序？

如果是前者，除了减少资源大小之外，你在这里可能没问题。一次完成所有下载比期望用户每次都容忍延迟更有意义。

如果是后者，你应该尽可能地延迟加载。换句话说，例如，不是将应用程序的所有图形都嵌入到 SWF 中，而是在`URLRequest`需要时使用 s 或任何必要的方法加载它们。更快的启动将“感觉”更快，并且足以弥补短时间内增加的 HTTP 请求。

# javascript - 为什么 ASP.NET 在 IE7 中会导致“操作中止”错误？

> ID：266585
> 
> 赞同：5
> 
> 时间：2008-11-05T20:42:49.700
> 
> 标签：javascript, asp.net, internet-explorer

我一直在阅读许多博客文章，这些文章提供了 IE 中“操作中止”错误的原因和解决方案。我最近构建了一个应用程序，有时它会为其他一些用户收到此错误。

让我详细解释一下。

该应用程序是在 VS 2008 中构建的 .NET 2.0、ASP .NET 和 C# Web 应用程序。它使用 ComponentOne Web 控件和标准 Visual Studio 控件。

在其中一个网页中，我让用户在一组 ComponentOne Web 输入控件中输入输入，然后将这些控件添加到集合中。集合绑定到转发器，每次在集合中创建新条目时，转发器就会被反弹。如果用户从转发器中删除条目（使用命令按钮），则集合会更新并反弹到转发器。

当应用程序提交给最终用户进行测试时，他们中的一些人抱怨他们在查看或在此页面上工作时收到“操作中止”错误。它有时会在用户尝试加载页面时发生，有时会在他们向集合中添加/删除项目时发生。

这些用户拥有 IE7，除了 Adob​​e PDF 和 Google Toolbar 之外没有第三方加载项。该错误不会在 FireFox 或 Google Chrome 中发生。它也不会出现在 IE8 Beta 2 中。

当我或我的开发人员尝试在我们的机器上使用 IE7 复制错误时，我们就是做不到。无论我们尝试什么，我们都不会得到那个错误。

我也试过 IE6 并没有得到错误。

IE7版本全都一样。

不知道如何解决这个问题。所有的博客文章、论坛文章都在谈论 JavaScript 和更改正文元素，但不确定这对我有什么影响，即使有，为什么两个 IE7 浏览器的行为不同？

欢迎任何建议/帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-05T20:49:13.947

您的集合和绑定的复杂性引入了**竞争条件**。

**Operation Aborted**错误是一个不起眼的IE 错误，在页面完成加载之前附加 DOM 时发生。

**操作中止错误**

请参阅此问题： [Internet Explorer 中的 Operation Aborted 错误是什么？](https://stackoverflow.com/questions/267160/what-is-the-operation-aborted-error-in-internet-explorer)

这本质上不是 asp.net 问题，但在您的情况下，由于您编写数据绑定的方式，asp.net 无法控制执行顺序。换句话说，取决于资源加载和执行的顺序（哪个电流不受控制），条件存在。

顺便说一句，如果您将其中一些资源**缓存**在前端，或者如果它们加载速度更快（在**本地网络上可用），那么在您的开发环境****中重现这种情况可能会更难**，这可以解释为什么您有麻烦看到错误。

 ***** * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T21:17:16.527

我明白为什么会发生错误。但是，我不认为自己会做那样的事情。我的转发器没有启用视图状态，我只是在使用集合重新绑定。

转发器数据绑定如何与动态附加内容相对应？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T21:03:36.803

在此处查看错误报告：

[http://webbugtrack.blogspot.com/2008/08/bug-404-operation-aborted-in-ie.html](http://webbugtrack.blogspot.com/2008/08/bug-404-operation-aborted-in-ie.html)

简而言之：

1.  正在解析 HTML 文件

2.  脚本正在执行

3.  执行脚本尝试（添加或删除）标记树中未闭合祖先的元素（不包括脚本元素的直接父元素）

好消息是这在 IE8 中已**部分**修复。

# sql - ColdFusion 在字符串中构造数据库查询时添加额外的引号

> ID：266586
> 
> 赞同：11
> 
> 时间：2008-11-05T20:43:13.147
> 
> 标签：sql, string, coldfusion, railo, cfml

我在 ColdFusion 中编码，但试图留在 cfscript 中，所以我有一个函数允许我传入查询以运行它 `<cfquery blah > #query# </cfquery>`

但是，不知何故，当我构造查询`sql = "SELECT * FROM a WHERE b='#c#'"` 并将其传入时，ColdFusion 已将单引号替换为 2 个单引号。所以它成为 `WHERE b=''c''`最终查询。

我尝试了很多不同的方法来创建字符串，但我不能让它只留下一个引号。即使进行字符串替换也没有效果。

知道为什么会这样吗？在这个项目期间，它破坏了我在 cfscript 中生活的希望

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-05T21:10:25.370

根据设计，ColdFusion 在`<cfquery>`标签内插入变量时会转义单引号。

要做你想做的事，你需要使用这个[`PreserveSingleQuotes()`](http://livedocs.adobe.com/coldfusion/8/htmldocs/functions_m-r_14.html)功能。

```
<cfquery ...>#PreserveSingleQuotes(query)#</cfquery> 
```

但是，这并没有解决您所面临的 SQL 注入的危险。

Using[`<cfqueryparam>`](http://livedocs.adobe.com/coldfusion/8/htmldocs/Tags_p-q_18.html)还允许您的数据库缓存查询，这在大多数情况下会提高性能。

[阅读旧的 Ben Forta 专栏](http://www.adobe.com/devnet/coldfusion/articles/ben_forta_faster.html)和[Brad Wood 最近发表的一篇文章](http://www.codersrevolution.com/index.cfm/2008/7/26/cfqueryparam-its-not-just-for-security-also-when-NOT-to-use-it)可能会有所帮助，以了解有关使用`<cfqueryparam>`.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-05T23:09:04.460

正如其他人所说，您的问题的答案是使用`preserveSingleQuotes(...)`

但是，您真正想要的*解决方案**不是*以这种方式动态构建查询。很糟糕很糟糕。

将您的 SQL 放入 cfquery 标记中，并根据需要使用任何 ifs/switches/etc，并确保**所有**CF 变量都使用该`cfqueryparam`标记。

（注意，如果您在 ORDER BY 子句中使用变量，则需要手动转义任何变量；cfqueryparam 不能在 ORDER BY 子句中使用）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-05T21:32:58.367

`<cfquery>`当您使用以下语法时，ColdFusion 会自动转义标签中的单引号：

```
SELECT * FROM TABLE WHERE Foo='#Foo#' 
```

如果您想保留单引号，则`#Foo#`必须调用`#PreserveSingleQuotes(Foo)#`.

请注意，自动转义仅适用于变量值，不适用于函数结果。

```
SELECT * FROM TABLE WHERE Foo='#LCase(Foo)#' /* Single quotes are retained! */ 
```

鉴于此，该函数`PreserveSingleQuotes()`（请参阅[Adob​​e LiveDocs](http://livedocs.adobe.com/coldfusion/6.1/htmldocs/functa53.htm)）只不过是对值的“空操作”——将其转换为函数结果以绕过自动转义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-05T00:11:24.550

我投票赞成戴夫的回答，因为我认为他做得很好。

然而，我想补充一点，还有几个为 ColdFusion 设计的不同工具，可以简化您可能执行的许多常见 SQL 任务。[有一个由 Steve Bryant 编写的名为DataMgr](http://datamgr.riaforge.org/)的非常轻量级的工具，以及来自 Mark Mandel的[Transfer ，](http://www.transfer-orm.com) [Reactor](http://www.reactorframework.com)最初由 Doug Hughes 创建，我开发了一个名为[DataFaucet](http://www.datafaucet.com)的工具。这些都有自己的长处和短处。就我个人而言，我认为您倾向于认为 DataFaucet 可以让您在 cfscript 中保持最佳状态，并使用多种语法来构建不同类型的查询。

这里有一些例子：

```
qry = datasource.select_avg_price_as_avgprice_from_products(); //(requires CF8)

qry = datasource.select("avg(price) as avgprice","products"); 

qry = datasource.getSelect("avg(price) as  avgprice","products").filter("categoryid",url.categoryid).execute();

qry = datasource.getSelect(table="products",orderby="productname").filter("categoryid",url.categoryid).execute(); 
```

该框架确保 cfqueryparam 始终与这些过滤语句一起使用，以防止 sql 注入攻击，并且插入、更新和删除语句的语法类似。（有一些[简单的规则可以避免 sql-injection](http://datafaucet.wikispaces.com/SQL+Injection)。）

# hibernate - 弹簧配置错误

> ID：266601
> 
> 赞同：4
> 
> 时间：2008-11-05T20:47:49.063
> 
> 标签：hibernate, spring

我的 spring-context 文件如下所示。

```
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:jee="http://www.springframework.org/schema/jee"
    xmlns:jms="http://www.springframework.org/schema/jms"
    xmlns:lang="http://www.springframework.org/schema/lang"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xmlns:util="http://www.springframework.org/schema/util"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee.xsd
        http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms.xsd
        http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

    <bean id="cfaBeanFactory" class="org.springframework.context.support.ClassPathXmlApplicationContext">
        <constructor-arg value="classpath:cfa-spring-core.xml" />
    </bean>
</beans> 
```

当我尝试运行我的应用程序时，我收到以下错误：

```
Caused by: org.springframework.beans.factory.access.BootstrapException: Unable to initialize group definition. Group resource name [classpath*:cfa-spring-context.xml], factory key [cfaBeanFactory]; nested exception is org.springframework.beans.factory.BeanDefinitionStoreException: Line 16 in XML document from URL [file:/C:/.../cfa-spring-context.xml] is invalid; nested exception is org.xml.sax.SAXParseException: Document root element "beans", must match DOCTYPE root "null".
    at org.springframework.beans.factory.access.SingletonBeanFactoryLocator.useBeanFactory(SingletonBeanFactoryLocator.java:389)
    ... 56 more
Caused by: org.springframework.beans.factory.BeanDefinitionStoreException: Line 16 in XML document from URL [file:/C:/.../cfa-spring-context.xml] is invalid; nested exception is org.xml.sax.SAXParseException: Document root element "beans", must match DOCTYPE root "null".
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:169)
    ... 59 more
Caused by: org.xml.sax.SAXParseException: Document root element "beans", must match DOCTYPE root "null".
    at org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException(Unknown Source)
    at org.apache.xerces.util.ErrorHandlerWrapper.error(Unknown Source) 
```

有人可以告诉我我做错了什么吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T21:09:10.240

原来这是因为我将 Hibernate 3 与 Spring 1.x 一起使用，这意味着 DTD 是错误的。更新了项目中的 Spring JAR 文件并解决了问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-30T20:57:12.967

您可能正在使用旧版本的 spring.jar。我得到了这个，当我使用最新的 spring.jar 时它得到了解决

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-03T09:29:58.417

用最新版本更新你的 spring.jar

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T20:54:08.180

你没有关闭`<beans>`标签。添加`</beans>`到配置文件的末尾。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T20:54:40.267

查看您的堆栈跟踪：

```
    来自 URL [file:/C:/.../cfa-spring-context.xml]的 XML 文档中的第 16 行无效；
    嵌套异常是 org.xml.sax.SAXParseException: Document root element "beans",
    必须匹配 DOCTYPE 根“null”。

```

您似乎在**cfa-spring-core.xml**文件中有错误，而不是您在帖子中包含的 spring 文件。

# security - 是否可以在 Tomcat 中进行 TLS 握手事件？

> ID：266606
> 
> 赞同：7
> 
> 时间：2008-11-05T20:49:16.863
> 
> 标签：security, tomcat, ssl, ws-security

我在启用 TLS 的 Tomcat 中运行应用程序（Web 服务）（客户端和服务器都有证书）。

我希望我的应用程序能够在 TLS 握手失败时发送审核消息（日志记录）。例如，我想在以下时间记录：

*   客户端证书已过期，
*   客户端证书未知（不在服务器信任库中）
*   任何其他握手失败

为了做到这一点，我可以捕捉和处理任何事件吗？

我的应用程序是基于 Web 服务的，并且在 tomcat 中运行。Tomcat 正在处理所有网络和 TLS 层，而应用程序并没有意识到这一点。

由于我自己没有打开任何套接字，我应该在哪里捕获这个异常？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2017-11-16T23:11:01.467

我不知道您可以添加到 Tomcat 中的任何内容。

将 Apache HTTPD 放在前面并使用单独的已配置 SSL 日志。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-05T21:00:54.437

由于我在过去一周调试了 Tomcat 的 SSL 配置，因此我很确定捕获`javax.net.ssl.SSLHandshakeException`您的代码并记录它应该可以解决所有这三个错误。

当您在应用程序中实例化新的 Web 服务连接时，就会发生异常。

# java - 使用 jaxb 解组生成的轴（包含多引用）soap 响应

> ID：266621
> 
> 赞同：2
> 
> 时间：2008-11-05T20:52:17.747
> 
> 标签：java, web-services, jaxb, axis

我正在使用一个轴 1.4 Web 服务，它返回我想使用 jaxb 注释解组到我的域对象中的肥皂响应。在某些返回的消息包含 multiRef 元素之前，我的初始测试运行良好。使用 multiRef 编组的对象在我的客户端注释模型对象中显示为 null。

我的问题是 JAXB 是否支持使用 multiRef 元素解组肥皂响应？如果是这样，怎么做？如果没有，是否有人知道将轴 1.4 肥皂响应解组到我在 java 中的域模型中的更好方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T10:05:09.830

在 Web 服务的情况下，JAXB 不是单独出现的，而是作为 ws 客户端框架的数据绑定部分。所以我假设您的问题是如何在轴 1.4 中使用 JAXB 作为数据绑定。一般来说，我认为没有简单的方法可以实现这一点，请查看轴用户邮件列表中的以下线程：[Specify JAXB generated complex types to Axis web service](http://www.nabble.com/Specify-JAXB-generated-complex-types-to-Axis-web-service-td9786803.html)。

如果您可以升级以使用axis2 使用Web 服务，那么它应该会容易得多，因为axis2 带有可插入的数据绑定架构，包括集成的jaxb 实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T20:42:07.440

如果 Web 服务的 Axis 端也在您的控制之下，那么也许您可以将该属性设置`org.apache.axis.AxisEngine.PROP_DOMULTIREFS`为 false。在这种情况下，Axis 不应创建 multiRef 元素。我已经在客户端 Axis 上使用了这个属性，希望它在服务器端也能以同样的方式工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-10T20:31:28.690

如果您正在处理 MultiREFs ，那么您可能正在使用 RPC 服务。JAXB 适用于文档样式的 web 服务。

为了使用 RPC 风格的服务，不要使用任何外部绑定，如 JAXB、JIBX 或

使用普通的 JAX-RPC ， wsdl2java Ant 任务可用于生成存根，并指定 nobinding 选项。

# ajax - Flash（或 AJAX）的浏览器历史记录

> ID：266639
> 
> 赞同：1
> 
> 时间：2008-11-05T20:57:36.347
> 
> 标签：ajax, apache-flex, flash, actionscript-3, browser-history

为 Flash（或 AJAX）网站启用浏览器历史记录的最佳工具/实践是什么？我想既定的做法是设置和读取对 URL 的哈希添加，例如

```
http://example.com/#id=1 
```

我知道 Flex History Manager，但想知道是否有任何好的替代方案可供考虑。也会对通用 AJAX 解决方案或最佳实践感兴趣。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-06T14:58:20.113

[SWFAddress](http://www.asual.com/swfaddress/)已被广泛使用和测试。它使得在 Flash 中处理深度链接几乎是微不足道的（假设您提前计划）。它提供了一个 JS 和 AS 库一起工作，使整个过程非常简单。你会想看看像 RSH for AJAX 这样的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T21:02:18.957

对于 AJAX，像[真正简单的历史](http://code.google.com/p/reallysimplehistory/)这样的东西很棒。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T21:20:33.553

我用[swfadress](http://www.asual.com/swfaddress/)做一些小东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-06T00:53:49.847

这似乎有点迂回，但我目前正在使用 dojo 框架。当我的 UI 主要是 JS/HTML 时，有一个 dojo.back 非常有用。现在我已经使用 flex 来获得更多功能、流畅的动画和浏览器稳定性，我唯一需要继续使用的就是返回 URL。

FlexBuilder 似乎在默认项目中拥有自己的浏览器历史记录。

此外，Flex 3 Cookbook 还提供了使用 mx.managers.HistoryManager 创建您自己的自定义历史管理的秘诀。我计划有一天尝试一下，以消除我们对 dojo.back 的依赖，但还没有时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-01T23:51:23.373

我推出了自己的解决方案，这些解决方案非常简单，如下所示：

```
(function() {
  var oldHash, newHash;

  function checkHash() {
    // Grab the hash
    newHash = document.location.hash;

    // Check to see if it changed
    if (oldHash != newHash) {

      // Trigger a custom event if it changed,
      // passing the old and new values as
      // metadata on the event.
      $(document).trigger('hash.changed', {
        old: oldHash,
        new: newHash
      });

      // Update the oldHash for the next check
      oldHash = newHash;
    }
  }

  // Poll the hash every 10 milliseconds.
  // You might need to alter this time based
  // on performance
  window.setInterval(checkHash, 10);

})(jQuery); 
```

然后，您只需要让“hash.changed”事件的事件处理程序根据新值做出相应的响应。该方法适用于超级简单的情况。

# python - Python：检查上传的文件是否为jpg

> ID：266648
> 
> 赞同：15
> 
> 时间：2008-11-05T21:00:36.077
> 
> 标签：python, google-app-engine, image, image-processing, mime

如何检查用户上传的文件是否是 Python（Google App Engine）中的真实 jpg 文件？

这是我现在走了多远：

脚本通过 HTML Form Post 接收图像并由以下代码处理

```
...
incomming_image = self.request.get("img")
image = db.Blob(incomming_image)
... 
```

我找到了 mimetypes.guess_type，但它对我不起作用。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-05T21:17:54.463

如果您需要的不仅仅是查看扩展名，一种方法是读取 JPEG 标头，并检查它是否与有效数据匹配。其格式为：

```
Start Marker  | JFIF Marker | Header Length | Identifier
0xff, 0xd8    | 0xff, 0xe0  |    2-bytes    | "JFIF\0" 
```

所以一个快速的识别器将是：

```
def is_jpg(filename):
    data = open(filename,'rb').read(11)
    if data[:4] != '\xff\xd8\xff\xe0': return False
    if data[6:] != 'JFIF\0': return False
    return True 
```

但是，这不会捕获正文中的任何不良数据。如果您想要更可靠的检查，可以尝试使用[PIL](http://www.pythonware.com/products/pil/)加载它。例如：

```
from PIL import Image
def is_jpg(filename):
    try:
        i=Image.open(filename)
        return i.format =='JPEG'
    except IOError:
        return False 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-06-24T18:18:02.787

无需为此使用和安装 PIL 库，imghdr 标准模块完全适合这种用途。

见[http://docs.python.org/library/imghdr.html](http://docs.python.org/library/imghdr.html)

```
import imghdr

image_type = imghdr.what(filename)
if not image_type:
    print "error"
else:
    print image_type 
```

当您有来自流的图像时，您可能会像这样使用流选项：

```
image_type = imghdr.what(filename, incomming_image) 
```

* * *

实际上，这在 Pylons 中对我有用（即使我还没有完成所有事情）：在 Mako 模板中：

```
${h.form(h.url_for(action="save_image"), multipart=True)}
Upload file: ${h.file("upload_file")} <br />
${h.submit("Submit", "Submit")}
${h.end_form()} 
```

在上传控制器中：

```
def save_image(self):
    upload_file = request.POST["upload_file"]
    image_type = imghdr.what(upload_file.filename, upload_file.value)
    if not image_type:
        return "error"
    else:
        return image_type 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-19T13:34:07.593

更通用的解决方案是使用 Python 绑定到 Unix“文件”命令。为此，请安装包 python-magic。例子：

```
import magic

ms = magic.open(magic.MAGIC_NONE)
ms.load()
type =  ms.file("/path/to/some/file")
print type

f = file("/path/to/some/file", "r")
buffer = f.read(4096)
f.close()

type = ms.buffer(buffer)
print type

ms.close() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T21:29:10.637

使用[PIL](http://www.pythonware.com/products/pil/)。如果它可以打开文件，那就是图像。

从教程...

```
>>> import Image
>>> im = Image.open("lena.ppm")
>>> print im.format, im.size, im.mode 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-03-06T20:39:54.610

JPEG 文件规范的最后一个字节似乎不仅仅是 e0。捕获前三个是启发式签名的“足够好”，可以可靠地识别文件是否为 jpeg。请参阅以下修改后的提案：

```
def is_jpg(filename):
    data = open("uploads/" + filename,'rb').read(11)
    if (data[:3] == "\xff\xd8\xff"):
        return True
    elif (data[6:] == 'JFIF\0'): 
        return True
    else:
        return False 
```

# windows - 如何在 Crystal Reports 中将控制字符发送到 Windows 打印机？

> ID：266652
> 
> 赞同：0
> 
> 时间：2008-11-05T21:01:33.263
> 
> 标签：windows, crystal-reports, printing

我们正在尝试构建一个 Crystal Report，它将控制字符直接发送到打印机，而无需通过该打印机的（有缺陷的）Windows 驱动程序。有谁知道从水晶报表中做到这一点的方法？

我们试图发送的特定控制字符是 CHR(2)。但是，当我们将其放入 Crystal Report 并打印到 Generic Text Only 打印机时，它会将字符转换为输出时的句点。该字符在 Crystal 的预览中显示为一个框，所以我怀疑是 Windows 驱动程序，而不是 Crystal，这是问题所在。

该设备是 Datamax 打印机。我们确实有驱动程序，但遇到了各种问题 - 基础设施组比我更了解这些问题，我觉得我没有足够的信息来尝试询问具体问题。它结合了 Crystal Reports、Citrix、我们的市场特定 ERP 软件包以及在报告运行时根据用户自动选择适合标签尺寸的标签打印机。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-05T22:12:40.687

通常，您不能将转义字符从 Crystal Reports 直接发送到打印机。

如果您只需要报告开头或结尾的特殊字符（如 POS 打印机的剪纸或抽屉打开），那么您可以使用通用打印机驱动程序设备选项并描述开始或结束作业序列。

我个人总是为任何打印机找到一些工作（或兼容）的驱动程序（你的打印机型号是什么，顺便说一句？）。对于 POS 打印机驱动程序通常包含特定的“字体”，允许直接发送转义序列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-06T00:14:51.377

简短的回答是你不能。最后，这是因为像 Crystal 这样的应用程序只在 GDI 级别说话，并将这些数据交给打印机驱动程序，然后转换为 PCL/PS 等并传递给打印机。

这是什么类型的设备？你想达到什么目的？

如果有一个驱动程序可以工作但不是设备的特定驱动程序，您可以使用它。另一个有点“hacky”的选择是使用迷你驱动程序开发工具包并自己构建。我们已经为客户完成了这项工作，我们在其中插入了我们自己的代码，例如自定义纸张尺寸，其中指定了字母大小以解决不支持自定义纸张尺寸或具有我们需要访问的某些特殊字体的应用程序. 此外，有些打印机允许您将转义字符更改为其他字符，具体取决于您的设备可能工作或构建一个后处理，您打印到文件，文件被拾取，您通过查找修改打印文件您输入的一些特殊语法并将文件传递给...很痛苦，但可以解决问题。

# windows - 如何监控 Windows 上的 memcached 统计信息？

> ID：266664
> 
> 赞同：7
> 
> 时间：2008-11-05T21:06:30.183
> 
> 标签：windows, memcached, statistics

人们发现在 Windows 上监控 memcached 的最简单方法是什么？我尝试过的一种方法效果很好：

telnet 进入 memcached 端口 (11211) 并输入“stats”命令。你会得到一个这样的列表：

```
stats
STAT pid 2816
STAT uptime 791
STAT time 1225918895
STAT version 1.2.1
STAT pointer_size 32
STAT curr_items 10
STAT total_items 10
STAT bytes 122931
STAT curr_connections 1
STAT total_connections 5
STAT connection_structures 4
STAT cmd_get 20
STAT cmd_set 10
STAT get_hits 0
STAT get_misses 20
STAT bytes_read 122986
STAT bytes_written 187
STAT limit_maxbytes 1073741824 
```

有没有更简单的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-05T21:16:51.970

PHP Memcached 模块还包括[一个脚本](http://svn.php.net/viewvc/pecl/apc/trunk/apc.php?view=markup)，该脚本将以摘要的形式显示统计信息，还以图表形式显示，并且能够查看单个缓存项。如果您已经在 Windows 上使用 PHP 和 memcache，那么它几乎是一种即插即用的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-23T18:05:45.357

Checkout [Evident Software 的](http://www.evidentsoftware.com/)ClearStone for [memcached](http://support.evidentsoftware.com/entries/444446-monotoring-memcached-using-clearstone-s-rest-based-open-data-interface)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-05T04:01:41.860

[phpmemcacheadmin](http://code.google.com/p/phpmemcacheadmin/)是另一个免费的 PHP 应用程序，用于监控您的 memcached 集群，我发现它比 PHP 扩展附带的脚本好得多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T21:09:38.037

我在 Windows 上使用过 memcached，发现这是主要缺点之一。令人惊讶的是，没有出现更好的工具，但我想这是一个不问钟声为谁而鸣的情况......

# c++ - C++中的无限循环

> ID：266665
> 
> 赞同：6
> 
> 时间：2008-11-05T21:06:52.007
> 
> 标签：c++, stream, infinite-loop, biginteger, largenumber

我正在学习 C++ 并编写一些小程序。以下是一个这样的程序：

```
// This program is intended to take any integer and convert to the
// corresponding signed char.

#include <iostream>

int main()
{
  signed char sch = 0;
  int n = 0;
  while(true){
    std::cin >> n;
    sch = n;
    std::cout << n << " --> " << sch << std::endl;
  }
} 
```

当我运行这个程序并将输入保持在相当小的绝对值时，它的行为符合预期。但是当我输入更大的输入时，例如 10000000000，程序会重复输出相同的输出。某些输入组合会导致行为不稳定。例如：

```
#: ./int2ch
10
10 --> 

10000000000
10 -->

10 -->

10 -->

10 --> 
```

该程序吐出“10 -->”直到它被杀死。（使用这个特定的输入序列，程序的输出速度会发生不规律的变化。）我还注意到，大值的输出取决于先前的合法输入以及当前非法输入的值。

这是怎么回事？（我不关心修复程序，这很容易。我想了解它。）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-05T21:14:33.690

基本上，您的`cin`流处于失败状态，因此当您尝试读取它时会立即返回。像这样重写你的例子：

```
#include <iostream>

int main()
{
  signed char sch = 0;
  int n = 0;
  while(std::cin >> n){
    sch = n;
    std::cout << n << " --> " << sch << std::endl;
  }
} 
```

`cin >> n`将返回对 的引用`cin`，您可以在条件中测试“善良”。所以基本上“ `while(std::cin >> n)`”是说“虽然我仍然可以成功地从标准输入中读取，但请执行以下操作”

编辑：它重复输出输入的最后一个好值的原因是因为那是在 n 中成功读取的最后一个值，失败的读取不会改变 n 的值

编辑：如评论中所述，您可以清除错误状态并再次尝试这样的事情可能会起作用，而忽略错误的数字：

```
#include <iostream>
#include <climits>

int main() {
    signed char sch = 0;
    int n = 0;
    while(true) {
        if(std::cin >> n) {
            sch = n;
            std::cout << n << " --> " << sch << std::endl;
        } else {
            std::cin.clear(); // clear error state
            std::cin.ignore(INT_MAX, '\n'); // ignore this line we couldn't read it
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-05T22:29:58.047

是的，Evan Teran 已经指出了大多数事情。我想补充的一件事（因为我还不能评论他的评论:)）是你必须在调用 istream::ignore*之前调用 istream::clear。*原因是如果流仍处于失败状态， istream::ignore 同样将拒绝执行任何操作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-05T21:14:05.160

鉴于您使用的是 32 位机器，10000000000 是一个太大的数字，无法用 int 表示。此外，根据编译器，将 int 转换为 char 只会为您提供 0..255 或 -128..127 的值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T21:15:50.273

这里的一个问题是 a`char`的大小为一个字节，因此只能容纳 -127 到 128 之间的数字。`int`另一方面，an 通常是 4 个字节，并且可以采用更大的值。第二个问题是您输入的值对于`int`.

# gwt - 如何在 GWT 中实现激活参数？

> ID：266668
> 
> 赞同：0
> 
> 时间：2008-11-05T21:07:19.633
> 
> 标签：gwt

我正在 GWT 中编写编辑器，如何从页面传递用户/传递？例如，用户提交了一个简单的 html 表单，然后 GWT 应用程序显示在下一页中，我怎样才能将表单提交信息很好地输入 GWT？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-10T17:52:42.507

1）创建一个可序列化的bean来封装要发布的数据。

2) 在您要发布到的 servlet/JSP 中，从发布的参数填充 bean，并将其放置在会话中。

3) 创建一个 RPC 服务，从会话中读取 bean 并返回它。

4) 从您的 GWT 应用程序调用服务。

您可以通过一些方法从 JSP 预先调用服务方法并将结果序列化到页面上的 JS 变量中，然后从 GWT 中反序列化，但除非您的页面流量非常大，否则我不会打扰它。

所有这一切都比仅仅将发布的数据作为 GWT 字典嵌入到 JS 块中要困难一些，但是 Dictionary 方法使得只需右键单击并查看数据变得更加容易。由于您提到这可能包含用户名/密码，我认为这可能是不可接受的。

# c# - return 语句应该在锁的内部还是外部？

> ID：266681
> 
> 赞同：153
> 
> 时间：2008-11-05T21:10:25.760
> 
> 标签：c#, .net, multithreading, mutex

我刚刚意识到，在我的代码中的某个地方，我在锁内有 return 语句，有时在外面。哪一个是最好的？

1)

```
void example()
{
    lock (mutex)
    {
    //...
    }
    return myData;
} 
```

2)

```
void example()
{
    lock (mutex)
    {
    //...
    return myData;
    }

} 
```

我应该使用哪一个？

* * *

## 回答 #1

> 赞同：205
> 
> 时间：2008-11-05T21:16:25.310

从本质上讲，无论哪种方式都使代码更简单。单点退出是一个不错的理想，但我不会为了实现它而将代码变形......如果替代方案是声明一个局部变量（在锁外），初始化它（在锁内）和然后将其返回（在锁外），然后我会说锁内的简单“返回 foo”要简单得多。

为了显示 IL 中的差异，让我们编写代码：

```
static class Program
{
    static void Main() { }

    static readonly object sync = new object();

    static int GetValue() { return 5; }

    static int ReturnInside()
    {
        lock (sync)
        {
            return GetValue();
        }
    }

    static int ReturnOutside()
    {
        int val;
        lock (sync)
        {
            val = GetValue();
        }
        return val;
    }
} 
```

（请注意，我很乐意认为这`ReturnInside`是 C# 的一个更简单/更干净的位）

并查看 IL（发布模式等）：

```
.method private hidebysig static int32 ReturnInside() cil managed
{
    .maxstack 2
    .locals init (
        [0] int32 CS$1$0000,
        [1] object CS$2$0001)
    L_0000: ldsfld object Program::sync
    L_0005: dup 
    L_0006: stloc.1 
    L_0007: call void [mscorlib]System.Threading.Monitor::Enter(object)
    L_000c: call int32 Program::GetValue()
    L_0011: stloc.0 
    L_0012: leave.s L_001b
    L_0014: ldloc.1 
    L_0015: call void [mscorlib]System.Threading.Monitor::Exit(object)
    L_001a: endfinally 
    L_001b: ldloc.0 
    L_001c: ret 
    .try L_000c to L_0014 finally handler L_0014 to L_001b
} 

method private hidebysig static int32 ReturnOutside() cil managed
{
    .maxstack 2
    .locals init (
        [0] int32 val,
        [1] object CS$2$0000)
    L_0000: ldsfld object Program::sync
    L_0005: dup 
    L_0006: stloc.1 
    L_0007: call void [mscorlib]System.Threading.Monitor::Enter(object)
    L_000c: call int32 Program::GetValue()
    L_0011: stloc.0 
    L_0012: leave.s L_001b
    L_0014: ldloc.1 
    L_0015: call void [mscorlib]System.Threading.Monitor::Exit(object)
    L_001a: endfinally 
    L_001b: ldloc.0 
    L_001c: ret 
    .try L_000c to L_0014 finally handler L_0014 to L_001b
} 
```

因此，在 IL 级别，它们 [给出或取一些名称] 相同（我学到了一些东西 ;-p）。因此，唯一合理的比较是本地编码风格的（高度主观的）法则......我更喜欢`ReturnInside`简单，但我不会对此感到兴奋。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-11-05T21:11:45.460

它没有任何区别；它们都被编译器翻译成同一个东西。

为了澄清，任何一个都被有效地翻译成具有以下语义的东西：

```
T myData;
Monitor.Enter(mutex)
try
{
    myData= // something
}
finally
{
    Monitor.Exit(mutex);
}

return myData; 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-11-07T17:59:43.943

我肯定会把退货放在锁里。否则，您可能会冒另一个线程进入锁并在 return 语句之前修改您的变量的风险，从而使原始调用者收到与预期不同的值。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-05T21:15:26.513

如果认为外面的锁看起来更好，但如果您最终将代码更改为：

```
return f(...) 
```

如果 f() 需要在持有锁的情况下调用，那么它显然需要在锁内，因为这样将返回值保持在锁内以保持一致性是有意义的。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-05T21:25:50.533

这取决于，

我要在这里反对谷物。我通常会回到锁内。

通常变量 mydata 是一个局部变量。我喜欢在初始化局部变量时声明它们。我很少有数据在我的锁之外初始化我的返回值。

所以你的比较实际上是有缺陷的。虽然理想情况下这两个选项之间的差异会像您所写的那样，这似乎是对案例 1 的认可，但实际上它有点丑陋。

```
void example() { 
    int myData;
    lock (foo) { 
        myData = ...;
    }
    return myData
} 
```

对比

```
void example() { 
    lock (foo) {
        return ...;
    }
} 
```

我发现案例 2 更容易阅读，也更难搞砸，尤其是对于短片段。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-06-24T19:55:34.437

值得一提的是[，MSDN 上的文档](http://msdn.microsoft.com/en-us/library/c5kehkcz%28v=vs.100%29.aspx)有一个从锁内部返回的示例。从这里的其他答案来看，它确实与 IL 非常相似，但对我来说，从锁内部返回似乎更安全，因为这样你就不会冒返回变量被另一个线程覆盖的风险。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-05T21:14:24.423

为了让其他开发人员更容易阅读代码，我建议第一个替代方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-12-27T16:19:14.603

`lock() return <expression>`陈述总是：

1）进入锁

2) 为指定类型的值进行本地（线程安全）存储，

3) 用返回的值填充存储`<expression>`，

4) 退出锁

5) 退货。

这意味着从 lock 语句返回的值在返回之前总是“煮熟”。

不要担心`lock() return`，不要在这里听任何人））

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2020-05-26T18:18:16.357

^(注意：我相信这个答案实际上是正确的，我希望它也有帮助，但我总是很乐意根据具体的反馈来改进它。)

总结和补充现有答案：

*   接受的[答案](https://stackoverflow.com/a/266718/45375)表明，无论您在*C#*代码中选择哪种语法形式，在 IL 代码中 - 因此在运行时 -直到锁被释放*后*`return`才会发生。

     **   因此，即使将块放在块`return` *内部*`lock`，严格来说，也歪曲了控制流^([1])，但它在语法上*很方便*，因为它不需要将返回值存储在 aux 中。局部变量（在块外声明，以便可以与`return`块外的 a 一起使用） - 请参阅[Edward KMETT 的回答](https://stackoverflow.com/a/266766/45375)。* 
**   另外-这方面是问题的*附带*因素，但可能仍然令人感兴趣（[里卡多·维拉米尔的回答](https://stackoverflow.com/a/272974/45375)试图解决它，但我认为是错误的）-将`lock`语句与语句结合起来-即，在受保护的块中`return`获取价值`return`并发访问 - 只有在*调用者*的范围内*实际上不需要保护*时才有意义地“保护”返回值，这适用于以下场景：

    *   如果返回值是集合中的一个元素，它只需要在*添加和删除*元素方面进行保护，而不是在*元素本身*的修改和/或...

    *   ...如果返回的值是*值类型*或*字符串*的实例。

        *   请注意，在这种情况下，调用者会收到该值的*快照*（副本）^([2]) - 到调用者检查时，它可能不再是原始数据结构中的当前值。
    *   在任何其他情况下，锁定必须由*调用者*执行，而不是（仅）在方法内部执行。* 

 ** * *

^([1] [Theodor Zoulias](https://stackoverflow.com/users/11178549/theodor-zoulias)指出，从技术上讲，这对于放置`return`在`try`, `catch`, `using`, `if`, `while`, `for`, ... 语句中也是正确的；但是，该`lock`声明的特定目的可能会引起对真正控制流的审查，这一点已被提出并受到了很多关注，就证明了这一点。)

^([2] 访问一个值类型实例总是会创建一个线程本地的、堆栈上的副本；尽管字符串在技术上是引用类型实例，但它们实际上表现得像值类型实例。)

# php - 您如何知道在 PHP require_once() 语句中使用的正确路径

> ID：266688
> 
> 赞同：12
> 
> 时间：2008-11-05T21:12:12.697
> 
> 标签：php

和许多人一样，我在 Web 应用程序的根目录中有一个 config.php 文件，我想将它包含在几乎所有其他 php 文件中。所以他们中的大多数人都有这样的一行：

```
require_once("config.php"); 
```

或者有时

```
require_once("../config.php"); 
```

甚至

```
require_once("../../config.php"); 
```

但我从来没有第一次做对。在读取这些文件之一时，我无法弄清楚 php 将考虑作为当前工作目录。它显然不是包含 require_once() 调用的文件所在的目录，因为我可以在同一个目录中有两个文件，它们对 config.php 有不同的路径。

我如何遇到这样一种情况：刷新页面的路径是正确的，但更新页面部分的 ajax 可以在 require_once() 语句中需要不同的 config.php 路径；

秘诀是什么？从哪里评估该路径？

拍摄，我担心这不会是一个常见问题 - 这发生在 apache 2.2.8 和 PHP 5.2.6 在 Windows 上运行。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-05T21:29:21.057

PHP 的当前工作目录是被调用脚本文件所在的目录。如果您的文件如下所示：

```
/A
   foo.php
   tar.php
   B/
       bar.php 
```

如果您调用 foo.php（例如：[http](http://example.com/foo.php) ://example.com/foo.php ），工作目录将是 /A/。如果您调用 bar.php（例如：[http](http://example.com/B/bar.php) ://example.com/B/bar.php ），工作目录将是 /A/B/。

这就是棘手的地方。让我们说 foo.php 是这样的：

```
<?php
require_once( 'B/bar.php' );
?> 
```

bar.php 是：

```
<?php
require_once( 'tar.php');
?> 
```

如果我们调用 foo.php，那么 bar.php 将成功调用 tar.php，因为 tar.php 和 foo.php 在同一个目录中，恰好是工作目录。如果您改为调用 bar.php，它将失败。

通常，您会在所有文件中看到：

```
require_once( realpath( dirname( __FILE__ ) ).'/../../path/to/file.php' ); 
```

或使用配置文件：

```
// config file
define( "APP_ROOT", realpath( dirname( __FILE__ ) ).'/' ); 
```

其余文件使用：

```
require_once( APP_ROOT.'../../path/to/file.php' ); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-05T21:17:52.017

我喜欢这样做：

```
require_once(dirname(__FILE__)."/../_include/header.inc"); 
```

这样，您的路径始终可以相对于当前文件位置。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-05T21:22:25.767

我大部分时间都使用 像[bobwienholt](https://stackoverflow.com/questions/266688/how-do-you-know-the-correct-path-to-use-in-a-php-requireonce-statement#266730)这样的东西，但它可以做的是有一个基本入口点来加载所有其他代码，这些代码定义了一个指向项目根目录的常量，即`dirname(`__FILE__`)`

```
define("ROOT",dirname(__FILE__).'/' ); 
```

然后你需要知道的是路径相对于根的位置，即：

```
require(ROOT . "/lib/tool/error.php"); 
```

### 笔记，

你*真的*应该避免在它们的开头带有“../”的路径，它们与文件无关，而是相对于你所在的位置**，**这会创建坏代码。

```
 cd foo
 php bar/baz.php 
 -> some error saying it cant find the file
 cd bar 
 php baz.php 
 -> suddenly working. 
```

### 重要的

如果您使用“../”符号，则**完全**不知道PHP 包含路径，并且**只**考虑运行它的人在哪里。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-05T22:50:42.653

我在每一页的顶部都包含了这段代码：

```
//get basic page variables
$self=$_SERVER['PHP_SELF']; 
$thispath=dirname($_SERVER['PHP_SELF']);
$sitebasepath=$_SERVER['DOCUMENT_ROOT'];

//include the global settings, variables and includes

include_once("$sitebasepath/globals/global.include.php"); 
```

Include 和 require 都采用相对路径或完整的根路径。我更喜欢使用完整路径，并像上面的 inlcude 语句一样进行所有引用。这使我可以输入一个通用变量 $sitebasepath 来处理可能因机器而异的帐户特定信息，然后只需键入来自 webroot 的路径，即。/globals/whatever_file.php

我还在可能调用自身来处理数据输入的表单中使用 $self 变量。

希望有帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-05T21:24:38.633

由于 require 和 require_once 与 include 和 include_once 非常相似，所有文档都发布在 php.net 上的“include”函数文档区域下 从[该页面](http://us.php.net/manual/en/function.include.php)

> 首先在相对于当前工作目录的每个 include_path 条目中查找包含文件，然后在当前脚本的目录中查找。例如，如果您的 include_path 是库，当前工作目录是 /www/，您包含 include/a.php 并且该文件中有包含“b.php”，b.php 首先在 /www/libraries/ 中查找，然后在/www/包括/。如果文件名以 ./ 或 ../ 开头，则仅在当前工作目录中查找。

此外，您可以通过从命令行执行“php -i”来找到所有当前包含路径。您可以编辑 php.ini 文件中的包含路径，也可以通过 ini_set()。如果 CLI 不方便，您还可以在页面中运行 php_info() 函数来打印环境变量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-05T21:26:55.617

如果您有足够的访问权限，请尝试修改`include_path`整个站点的 PHP 设置。如果你不能这样做，你要么必须通过相同的 PHP 脚本（例如，使用 Apache mod_rewrite）路由每个请求，要么必须使用设置 include_path 的“初始化”脚本：

```
$includeDir = realpath(dirname(__FILE__) . '/include'); 
ini_set('include_path', $includeDir . PATH_SEPARATOR . ini_get('include_path')); 
```

包含该文件后，使用相对于包含目录的路径：

```
require_once '../init.php'; // The init-script
require_once 'MyFile.php'; // Includes /include/MyFile.php 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-05T21:15:29.353

我看到评估路径的唯一地方是您当前正在编辑的文件。我从来没有遇到过任何问题，但如果您有问题，您可能需要提供更多信息（PHP 版本、操作系统等）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-05T21:31:07.153

原始 GET 或 POST 中请求的 PHP 文件的路径本质上是该脚本的“工作目录”。任何“包含”或“必需”脚本也将继承它作为它们的工作目录。

我将在 require 语句中使用绝对路径或修改 PHP 的 include_path 以在我的应用程序中包含我可能想要用来节省额外输入的任何路径。您会在 php.ini 中找到它。

include_path = ".:/list/of/paths/:/another/path/:/and/another/one"

我不知道它是否会在这个特定的实例中帮助你，但是如果你需要知道特定文件运行的路径，像**FILE**和**DIR**这样的神奇常量可以派上用场。

[http://us2.php.net/manual/en/language.constants.predefined.php](http://us2.php.net/manual/en/language.constants.predefined.php)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-11-05T21:25:21.627

看一下函数getcwd。[http://us2.php.net/getcwd](http://us2.php.net/getcwd "获取cwd")

# java - 使用带有静态 compareObject 方法的泛型参数

> ID：266693
> 
> 赞同：2
> 
> 时间：2008-11-05T21:12:54.990
> 
> 标签：java, generics

我想从这个通用实用程序方法（具有许多类似方法的较大类的一部分）中删除所有“未检查”警告。在紧要关头，我可以使用 @SuppressWarnings("unchecked") 但我想知道是否可以正确使用泛型来避免警告。

该方法旨在允许调用者通过传递给 compareTo 来比较两个对象，但如果对象是字符串，则它以不区分大小写的方式进行。

```
public static int compareObject(Comparable o1, Comparable o2)
{
    if ((o1 instanceof String) && (o2 instanceof String))
        return ((String) o1).toUpperCase().compareTo(((String) o2).toUpperCase());
    else
        return o1.compareTo(o2);
} 
```

这是我第一次（不正确）尝试解决方案。参数工作正常，但 o1.compareTo(o2) 行有一个编译错误“Comparable 类型中的方法 compareTo(capture#15-of ?) 不适用于参数 (Comparable”。

```
public static int compareObject(Comparable<?> o1, Comparable<?> o2)
{
    if ((o1 instanceof String) && (o2 instanceof String))
        return ((String) o1).toUpperCase().compareTo(((String) o2).toUpperCase());
    else
        return o1.compareTo(o2);
} 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T21:32:57.303

我刚试过这个：

```
public static <T extends Comparable> int compareObject(T o1, T o2) {
    if ((o1 instanceof String) && (o2 instanceof String))
        return ((String) o1).toUpperCase().compareTo(((String) o2).toUpperCase());
    else
        return o1.compareTo(o2);
} 
```

它编译，但在 compareTo() 调用上给出未经检查的强制转换警告。
我尝试将其更改为

```
public static <T extends Comparable<T>> int compareObject(T o1, T o2) { 
```

并且字符串检查无法编译（“不可转换类型：找到：T，必需：字符串”）。不过，我认为这一定很接近。

* * *

编辑：正如评论中指出的，这是[javac 中的一个错误](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6548436)。第二种形式确实是正确的，但目前不会编译。尽管看起来很疯狂，但这是没有警告的代码：

```
public static <T extends Comparable<T>> int compareObject(T o1, T o2) {
    if (((Object) o1 instanceof String) && ((Object) o2 instanceof String))
        return ((String) (Object)o1).toUpperCase().compareTo(((String) (Object)o2).toUpperCase());
    else
        return o1.compareTo(o2);
} 
```

如您所见，唯一的区别是所有多余的强制转换为`Object`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T21:33:16.197

这是您要查找的内容：

```
public static <T extends Comparable<T>> int compareObject(T o1, T o2) {
    if ((o1 instanceof String) && (o2 instanceof String))
        return ((String) o1).toUpperCase().compareTo(((String) o2).toUpperCase());
    else
        return o1.compareTo(o2);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T08:09:05.290

我希望你知道这里的许多方法确实改变了方法的语义。使用原始方法，如果它们允许，您可以比较不同类型的对象，但是使用

```
public static <T extends Comparable<T>> int compareObject(T o1, T o2) 
```

你不能再做这个比较了。允许这样做的变体是

```
 public static int compareObject2(Comparable<Object> o1, Comparable<Object> o2) {
    if (((Object) o1 instanceof String) && ((Object) o2 instanceof String))
        return ((String) (Object)o1).toUpperCase().compareTo(((String) (Object)o2).toUpperCase());
    else
        return o1.compareTo(o2);
} 
```

（我为提到的 javac 错误插入了解决方法。）但这并不能增强类型安全或任何东西，所以在这种情况下，最好使用更易于理解的非泛型方法并使用`@SuppressWarnings("unchecked")`. 存在过度使用泛型这样的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T16:33:03.070

以下情况如何：

```
 public static <T extends Comparable<T>> int compareObjects(T o1, T o2)
  {
    return o1.compareTo(o2);
  }

  public static int compareObjects(String o1, String o2)
  {
    return o1.compareToIgnoreCase(o2);
  } 
```

缺点是当调用`compareObjects()`碰巧是字符串的对象时，编译器会将您的调用绑定到第一个函数，您最终会得到区分大小写的比较。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-05T21:20:33.133

您是否测试了以下内容？

```
public static <T> int compareObject(Comparable<T> o1, Comparable<T> o2)
{
    if ((o1 instanceof String) && (o2 instanceof String))
        return ((String) o1).toUpperCase().compareTo(((String) o2).toUpperCase());
    else
        return o1.compareTo(o2);
} 
```

我认为它应该可以正常工作。

# c# - 将 DataTable 传递给非托管环境（visual c# 2005）

> ID：266694
> 
> 赞同：2
> 
> 时间：2008-11-05T21:12:59.233
> 
> 标签：c#, c++, ado.net, interop, managed-c++

将数据表数据传递到非托管环境的最佳方法是什么？(c++)

提供

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T21:20:56.050

我认为这里没有一个最佳答案。

一种选择是将数据库导出为 XML 并让您的非托管代码使用它。这种方法的主要好处是它在托管方面更便宜（开发方面）并且在非托管方面提供了灵活性。

否则，您将需要提供自己的数据编组。最好使用可以处理数据集并将其转换为非托管代码可以理解的数据结构的 C++/CLI 代码。

我们过去做过类似的事情，它可以工作，但需要相当多的代码来涵盖一般情况。

# sql - SQL 性能方面，哪个更好：IF...ELSE 子句或 WHERE LIKE 子句？

> ID：266697
> 
> 赞同：6
> 
> 时间：2008-11-05T21:13:16.237
> 
> 标签：sql, sql-server-2005, tsql

我有一个具有可选参数的存储过程，`@UserID VARCHAR(50)`. 问题是，有两种方法可以使用它：

1.  给它一个默认值`NULL`，即 have 一个`IF...ELSE`子句，它执行两个不同的`SELECT`查询，一个有`'WHERE UserID = @UserID'`和没有 where。
2.  给它一个默认值，`'%'`然后只使用 where 子句`'WHERE UserID LIKE @UserID'`。在调用代码中，不会使用“%”，因此只会找到完全匹配的内容。

问题是：哪个选项更快？随着表的增长，哪个选项提供更好的性能？请注意，该`UserID`列是外键并且没有索引。

**编辑：**根据一些答案，我想添加一些内容：`@UserID`参数不是（必然）传递的唯一**可选参数。**在某些情况下，有多达 4 或 5 个可选参数。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-05T21:16:24.967

我通常做的是

```
WHERE ( @UserID IS NULL OR UserID = @UserID ) 
```

为什么它没有被索引？索引 FK 通常是一种很好的形式，因为您经常加入它们......

如果您担心查询计划存储，只需执行以下操作：CREATE PROCEDURE ... WITH RECOMPILE

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T21:17:34.217

唯一可以确定的方法是同时实施和衡量。作为参考，还有第三种实现方式，这是我倾向于使用的：

```
WHERE (@UserID IS NULL OR UserId = @UserId) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-05T22:26:26.557

SQL Server 2005 及后续版本具有称为“语句级重新编译”的功能。查看 [http://www.microsoft.com/technet/prodtechnol/sql/2005/recomp.mspx](http://www.microsoft.com/technet/prodtechnol/sql/2005/recomp.mspx)

基本上，查询处理器执行的每条语句都有自己的优化计划，然后存储在“计划缓存”中（这就是他们将名称从“过程缓存”更改为的原因）

因此，将您的 T-SQL 分支到单独的语句中会更好......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-05T22:16:55.063

只有一个存储过程的问题在上面已经很好地提到过，SQL 为该过程存储了一个编译计划，一个 null 的计划与一个有值的计划完全不同。

但是，在存储过程中创建 if 语句将导致存储过程在运行时重新编译。这也可能会增加性能问题。

如其他地方所述，这适用于测试和查看方法，考虑到 if 语句，@UserID 为 null 和两个单独的过程。

不幸的是，这些方法的速度将根据数据量和参数为空的调用频率与参数不为空的调用的频率有很大差异。同样，参数的数量也会影响需要重写程序的方法的功效。

如果您使用的是 SQL 2005，您可能会从查询[计划提示选项](http://www.microsoft.com/technet/prodtechnol/sql/2005/frcqupln.mspx)中获得一些帮助。

**更正：** Sql 2005 和此后具有“语句级重新编译”，它为过程中的每个语句在缓存中存储单独的计划......因此，2005 年前不将多个逻辑分支语句放入单个存储过程的旧策略不再真的...... – Charles Bretana（我认为这很重要，可以从评论中提升）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-05T21:17:46.523

为什么不使用：

```
where @UserID is null or UserID=@UserID 
```

+ 关于可维护性和性能

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-05T21:26:33.947

`UserID`首先，如果您以这种方式将其用作搜索条件，您应该创建一个索引。

其次，比较`UserID LIKE @UserID`不能使用索引，因为优化器不知道你是否会给出一个`@UserID`以通配符开头的参数值。这样的值不能使用索引，因此优化器必须假设它不能使用该索引创建执行计划。

所以我推荐：

1.  创建索引`UserID`
2.  使用第一个选项 ，`WHERE UserID = @UserID`应该优化它以使用索引。

**编辑：**马克布雷迪提醒我我忘了解决这个`NULL`案子。我同意马克的回答，执行`IF`并执行两个查询之一。我给马克的答案+1。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-05T21:22:42.177

我坚决选择第一个，因为虽然它不那么“聪明”，但更容易理解发生了什么，因此更容易维护。

使用特殊含义的默认值可能会在以后因一些意想不到的副作用而绊倒您（有关您为什么使用该默认值的文档以及它的使用可能会被任何维护者遗漏）

至于效率 - 除非您正在查看 1,000 个或更多用户，否则它不太可能足以成为覆盖可维护性的问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-05T22:29:13.727

用两个替换单个存储过程。查询优化器有很大的空间开始对你造成意想不到的后果。更改客户端代码以检测调用哪一个。

我敢打赌，如果你这样做了，我们就不需要这个对话了。

并在用户ID上放置一个索引。索引在那里是有原因的，就是这样。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-05T22:00:09.793

我会选择选项 1，但实际上有两个存储过程。一个会得到所有用户，一个会得到一个特定的用户。我认为这比传入 NULL 更清楚。在这种情况下，您确实需要两条不同的 SQL 语句，因为您要求不同的东西（所有行与一行）。

# javascript - 是否可以在 JavaScript 中创建“弱引用”？

> ID：266704
> 
> 赞同：103
> 
> 时间：2008-11-05T21:15:08.697
> 
> 标签：javascript, weak-references

JavaScript 中是否有任何方法可以创建对另一个对象的“弱引用”？[这是描述什么是弱引用的 wiki 页面。](http://en.wikipedia.org/wiki/Weak_reference) [这是另一篇用 Java 描述它们的文章。](https://community.oracle.com/blogs/enicholas/2006/05/04/understanding-weak-references)谁能想到在 JavaScript 中实现这种行为的方法？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-11-05T21:59:43.163

**更新：自 2020 年 7 月以来，一些实现（Chrome、Edge、Firefox 和 Node.js）已支持[WeakRefs 提案](https://tc39.es/proposal-weakrefs/#sec-weak-ref-objects)[`WeakRef`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakRef)中定义的 s，该提案是截至 2020 年 12 月 16 日的“第 3 阶段草案”。**

JavaScript 中没有对弱引用的语言支持。您可以使用手动引用计数自己滚动，但不是特别顺利。您不能创建代理包装对象，因为在 JavaScript 中，对象永远不知道它们何时将被垃圾收集。

因此，您的“弱引用”成为简单查找中的键（例如整数），具有添加引用和删除引用方法，并且当不再有手动跟踪的引用时，可以删除条目，留下未来的查找该键返回null。

这并不是真正的弱引用，但它可以解决一些相同的问题。当 DOM 节点或事件处理程序与与其关联的对象（例如闭包）之间存在引用循环时，通常在复杂的 Web 应用程序中执行此操作，以防止浏览器（通常是 IE，尤其是旧版本）发生内存泄漏。在这些情况下，甚至可能不需要完整的引用计数方案。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-08-11T02:02:58.847

在 NodeJS 上运行 JS 时，可以考虑[https://github.com/TooTallNate/node-weak](https://github.com/TooTallNate/node-weak)。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2019-09-19T10:43:18.447

# 更新：2019 年 9 月

目前还不可能使用弱引用，但很可能很快就会有可能，因为JavaScript 中的**WeakRefs**正在进行中。详情如下。

## 提议

提案现在处于**第 3 阶段**，这意味着它具有完整的[规范](https://github.com/tc39/proposal-weakrefs/blob/master/history/spec.md)，并且进一步细化将需要实现和用户的反馈。

WeakRef**提案**包含两个主要的新功能：

*   **使用Wea​​kRef 类**创建对对象的弱引用
***   在对象被垃圾回收后运行用户定义的终结器，使用**FinalizationGroup 类****

 **# 用例

弱引用的**主要用途**是实现包含大对象的缓存或映射，其中不希望大对象仅仅因为它出现在缓存或映射中而保持活动状态。

**终结**是在程序执行无法访问的对象之后执行代码以进行清理。用户定义的终结器启用了几个新的用例，并且可以在管理垃圾收集器不知道的资源时帮助防止内存泄漏。

## 来源和进一步阅读

[https://github.com/tc39/proposal-weakrefs](https://github.com/tc39/proposal-weakrefs)
[https://v8.dev/features/weak-references](https://v8.dev/features/weak-references)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2021-01-03T16:38:26.980

**2021 更新**

`WeakRef`现在已在 Chrome、Edge 和 Firefox 中实现。仍在等待 Safari 和其他一些坚持。

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakRef](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakRef)

**2021 年 5 月更新** 它现在可以在 Safari 上使用，因此可以在所有主要浏览器上使用。往上看。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-03-23T18:12:18.917

仅供参考；JavaScript 没有，但 ActionScript 3（也是 ECMAScript）有。查看[Dictionary 的构造函数参数](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/utils/Dictionary.html#Dictionary())。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-07-10T08:30:54.477

他们终于来了。尚未在浏览器中实现，但很快就会实现。

[https://v8.dev/features/weak-references](https://v8.dev/features/weak-references)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-09-03T07:58:26.910

真正的弱引用，不，还没有（但浏览器制造商正在研究这个主题）。但这里有一个关于如何模拟弱引用的想法。

您可以构建一个缓存来驱动您的对象。存储对象时，缓存会预测该对象将占用多少内存。对于某些项目，例如存储图像，这很容易解决。对于其他人来说，这将更加困难。

当你需要一个对象时，你就向缓存请求它。如果缓存有对象，则返回。如果不存在，则生成、存储并返回项目。

当预测的内存总量达到一定水平时，通过缓存删除项来模拟弱引用。它将根据检索的频率预测哪些物品使用最少，并根据它们被取出的时间加权。如果创建项目的代码作为闭包传递到缓存中，则还可以添加“计算”成本。这将允许缓存保留构建或生成非常昂贵的项目。

删除算法是关键，因为如果你弄错了，那么你最终可能会删除最受欢迎的项目。这将导致糟糕的表现。

只要缓存是唯一对存储的对象具有*永久*引用的对象，那么上述系统应该可以很好地替代真正的弱引用。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-02-08T17:16:36.693

[正如上面](https://stackoverflow.com/a/7291894/1826075)[JL235](https://stackoverflow.com/users/664175/jl235)建议的那样，使用缓存机制来模拟弱引用是合理的。如果弱引用本来就存在，你会观察到这样的行为：

```
this.val = {};
this.ref = new WeakReference(this.val);
...
this.ref.get(); // always returns val
...
this.val = null; // no more references
...
this.ref.get(); // may still return val, depending on already gc'd or not 
```

而使用缓存，您会观察到：

```
this.val = {};
this.key = cache.put(this.val);
...
cache.get(this.key); // returns val, until evicted by other cache puts
...
this.val = null; // no more references
...
cache.get(this.key); // returns val, until evicted by other cache puts 
```

作为引用的持有者，你不应该对它何时引用一个值做出任何假设，这与使用缓存没有什么不同

* * *

## 回答 #9

> 赞同：-5
> 
> 时间：2015-02-17T17:37:17.310

EcmaScript 6 (ES Harmony) 有一个[WeakMap](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/WeakMap)对象。现代浏览器中的浏览器支持[非常好](http://kangax.github.io/compat-table/es6/)（最近 3 个版本的 Firefox、chrome 甚至即将推出的 IE 版本都支持它）。

* * *

## 回答 #10

> 赞同：-6
> 
> 时间：2008-11-05T21:28:26.953

[http://www.jibbering.com/faq/faq_notes/closures.html](http://www.jibbering.com/faq/faq_notes/closures.html)

ECMAScript 使用自动垃圾回收。规范没有定义细节，将其留给实现者进行整理，并且已知一些实现对其垃圾收集操作给予非常低的优先级。但是一般的想法是，如果一个对象变得不可引用（通过没有剩余的对它的引用可供执行代码访问），它就可以用于垃圾收集，并且在将来的某个时候将被销毁，并且它正在消耗的任何资源都被释放并返回到系统重复使用。

退出执行上下文时通常会出现这种情况。作用域链结构、Activation/Variable 对象和在执行上下文中创建的任何对象（包括函数对象）将不再可访问，因此可用于垃圾回收。

这意味着没有弱者，只有那些不再可用的。

# database-design - 估计数据库大小

> ID：266709
> 
> 赞同：1
> 
> 时间：2008-11-05T21:15:44.657
> 
> 标签：database-design

我试图预测我的数据库会有多大。假设我只有一张桌子：

CREATE TABLE 用户（
**id** INT UNSIGNED NOT NULL AUTO_INCREMENT，
**email** VARCHAR(50)，
**pass** CHAR(40)，
**url** VARCHAR(1000)，
PRIMARY KEY(id)）；

加起来：4 + 51 + 40 + 1001 = 1096 个字节在一条记录中。
如果我有 100 万条记录：1,000,000 x 1096 字节 = 1,045 Mb！

所以，这是一张小桌子，我正在寻找**1 个演出来存储它**。我的估计是否正确？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T21:41:18.443

加载一些具有与生产相同的平均字段长度的测试数据，然后测量它需要多少空间。这就是我们所做的。

不要费心加载 100 行，只需加载 1M 行，或者从一开始就加载 10M。将更多行加载到非生产系统中很容易——只需要更长的时间。

拥有大量测试数据真的很方便——这样您就可以准确地测量数据库架构更改对磁盘空间的影响（和停机时间的影响），例如特别是添加索引。

确保您的测试数据至少与生产数据一样大，最好更大。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T21:42:03.153

除了 varchar 问题之外，您还需要注意大多数数据库将记录存储在分配的存储块中（有时称为范围 - 尽管准确的术语取决于 rdbms），其中包含一定量的可用空间。这样做的目的是允许更新，同时最大限度地减少表和索引碎片。当然，即使其中没​​有实际数据，分配的可用空间也会增加数据库文件的大小。

这些开销通常可以在使用 rdbms 特定子句创建表时指定和控制，如果它是只读快照，甚至几乎可以消除。OTOH，如果您的桌子将看到大量 IUD 活动，您可能希望使此填充比平时更大。

一个好的经验法则是像您一样计算您的预期表大小 - 尽管如其他帖子中讨论的那样猜测 varchar 大小（或对样本数据进行更好的运行分析）然后添加 20% - 一个常见的默认可用空间分配。实际上在实践中，空闲空间分配引起问题是不寻常的，特别是如果您部署了一个合理的维护例程（所以大多数人从来没有考虑过），但是未能预测并在异常高 IUD 活动命中的表上进行适当的分配可能导致难以追踪的性能问题。

老实说，在 600Gb 磁盘司空见惯的日子里，我已经很长时间没有认真地调整数据库的大小了，除了快速猜测之外的任何级别。

*编辑回复评论-“什么是宫内节育器，维护是什么意思？删除旧记录？-sneg”

IUD = 插入更新删除活动。为了说明维护问题，让我们考虑如果我们创建一个没有可用空间的数据库并加载一个像您建议的表一样的表，其中包含包含 varchar 数据的记录。所有记录将首尾相连地放置在我们的数据库文件中，它们之间没有空格。

如果用户随后更新了记录的 varchar 部分，则有三种可能性。如果字段长度相同，则没有结构变化。如果它更短，我们会覆盖旧字段，并且字段末尾有一些备用字节 - 没什么大不了的。但是，如果它更长，那么我们就会遇到问题 - 记录将不再适合。在这种情况下，一种解决方案是将整个修改后的记录复制到新位置并更新索引（在某些管理方案中，将指针放在旧记录所在的位置）。现在的问题是数据的顺序读取——这不是不常见的操作——现在将不得不跳过数据库文件而不是直接读取——典型的碎片场景——并且性能将逐渐受到影响。

通过为表分配可用空间，然后当我们更新时，我们有一定数量的肘部空间，允许我们更改记录长度而无需从页面中移动记录。当然，随着时间的推移，如果表看到大量活动，它仍然会碎片化（因为我们只分配足够的可用空间来覆盖一定百分比的记录更改），这就是维护的用武之地。

在这种情况下，维护本质上是一个碎片整理过程，用于移动记录，以便重新定位它们并分配可用空间，以便再次有效地分布它们。在某些（大多数）RDBM 中，您可以只指定一个维护计划并安排一个作业在 q 安静时间执行此操作（例如 SQL Server），但在其他情况下您可能必须手动执行 - 例如在旧版本的 Oracle 中，推荐方法是导出数据，删除表并重新创建，然后从备份中再次重新导入 - 导出/重新加载过程将根据任何新加载清理数据。

索引结构也有类似的问题。

我当然在这里掩饰了很多，但是在文件中存储可变长度随机访问数据记录的基本问题仍然存在，无论您在其上堆放了多少抽象层。好消息是这类问题很容易理解，而且大多数时候你不需要担心——直到你问一个明显简单的问题，比如“这张桌子需要多少空间”:-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T21:24:06.137

正如前面的答案所建议的那样， varchar 字段使事情变得更加困难，因为它只为每行中包含的字符串使用足够的存储空间。输入一些示例数据后，诸如 MySQL 之类的数据库（我假设其他人也这样做）将能够告诉您每行的平均大小。

此外，您需要记住您创建的任何索引都会占用额外的空间。同样，使用一系列样本数据应该给出一个粗略的指示来推断规模估计。

编辑：这里的许多答案都建议使用示例数据，请参阅我的答案以及与此相关的旧问题：[PHP Script to populate MySQL tables](https://stackoverflow.com/questions/19162/php-script-to-populate-mysql-tables)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-05T21:25:01.843

实际上，[MySQL 的 VARCHAR 类型](http://dev.mysql.com/doc/refman/5.0/en/char.html)的空间使用量是可变的，取决于放入其中的数据。CHAR 类型具有恒定的空间使用率。除此之外，您的计算看起来是正确的：AFAIK，MySQL 表没有存储在压缩的磁盘上，[尽管您可以](http://dev.mysql.com/doc/refman/5.0/en/compressed-format.html)以使它们只读为代价显式压缩它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T21:19:01.903

实际上，一个 varchar 字段代表多个 char 字段。这也适用于其他数据类型。

一种简单的方法是添加 100 条带有随机测试数据的记录，然后查看文件系统中的数据库文件有多大。然后再添加一百，看看它增长了多少。

# asp.net - 在 ASP.NET 中的 Web 服务器上填写 Excel 电子表格比互操作更好的方法？

> ID：266714
> 
> 赞同：3
> 
> 时间：2008-11-05T21:16:05.980
> 
> 标签：asp.net, excel, web-applications

有没有比使用互操作更好的方法可以在 Web 服务器（使用 asp.net）上填写电子表格？

编辑：我不太清楚我需要什么：

我有一个必须使用的模板，该模板由我们的客户提供。模板中有一些受密码保护的宏，我无权访问，因此无法生成 excel 文件。我被困在更新 2003 excel 文件中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T21:23:21.473

Office 2007 文档（Word、PowerPoint 和 Excel）基于 OpenXML 格式。它们只是包含一堆 XML 和二进制部分（想想文件）的 zip 文件。您可以使用 Packaging API（WindowsBase.dll 中的 System.IO.Packaging）打开它们，并使用框架中的任何 XML 类来操作它们。

查看 OpenXMLDeveloper.org 了解详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-06T00:34:04.927

查看[SpreadsheetGear](http://www.spreadsheetgear.com)。该组件将允许您从 ADO.Net 操作 Excel 2007 电子表格、执行宏和更新电子表格。它不需要在互操作的服务器上安装 Excel。

该站点有很好的示例代码供您阅读。我们用它在内部部署了一个应用程序，它运行良好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T21:23:32.503

是的。

如果您有一个现有的电子表格，并且您想根据用户输入向其中添加数据，其中每个用户共享一个工作表，甚至一个用户定期更新他自己的工作表，那么您就走错了路。Excel 无法处理 Web 情况下的并发或互操作负载。唯一需要互操作的地方是当您必须打开无法控制的现有电子表格时。

取而代之的是，将用户输入保存到一个真实的数据库中，并且只根据需要生成一个 Excel 文档。有关生成 excel 文档的帮助，请参阅下面链接的问题：有几个选项根本不需要互操作，包括 html 表、xml、openxml csv 或 3rd 方组件，其中大多数支持格式、公式等
[。 ASP.NET 中的 Excel 文件](https://stackoverflow.com/questions/150339/generating-an-excel-file-in-aspnet)

**更新**
如果您需要执行宏，那么您可能需要 excel 互操作。但是，这在网站中*效果不佳。*我建议您回到客户那里，并要求他们对您的工作表要求更加开放。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-06T00:24:59.453

也许您可以将操作分成两部分。

1.  从网站收集信息。

将结果存储在数据库中以供以后工作。

2.  更新 Excel 电子表格。

运行更新电子表格的进程。

但是，如果网站必须返回电子表格的结果，这将不起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-06T00:30:07.230

您可以使用 Excel XML 规范。

我的博客上有一个演示如何在 C# 3.0 中执行此操作，还链接到 VB 9 上的示例。它使用 LINQ to XML。

这个概念可以很容易地修改为 .NET 2.0。

[http://www.aaron-powell.com/blog/september-2008/linq-to-xml-to-excel.aspx](http://www.aaron-powell.com/blog/september-2008/linq-to-xml-to-excel.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T19:05:27.713

这是我最终采用的解决方案。我将模板保存为 xls 文件，每次需要创建工作表时，我都会将其复制到目录并为其命名。然后我使用 OleDb 和 UPDATE 语句来填充我需要添加数据的单元格。

# visual-studio - 在 Visual Studio 2008 中调试时只执行一个单元测试

> ID：266716
> 
> 赞同：30
> 
> 时间：2008-11-05T21:16:18.227
> 
> 标签：visual-studio, visual-studio-2008, unit-testing

有没有办法在调试时选择要在 Visual Studio 2008 单元测试项目中执行的测试方法？我想调试一个特定的测试，而无需在每个调试会话期间执行我的其他 TestMethod。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-11-05T21:25:40.703

单击测试方法名称，然后按 Ctrl+R、Ctrl+T。（或转到当前上下文中的测试/调试/测试。）

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-01-04T15:15:07.307

`CTRL`- `R`+ `T`= 在上下文中运行测试。这很容易在测试中触发。
`CTRL`- `R`+ `A`= 运行所有测试
`CTRL`- `R`+ `C`= 运行类中的所有测试
`CTRL`- `R`+ `N`= 运行命名空间中的所有测试
`CTRL`- `R`+ `F`= 运行所有已检查的测试（适用于重新运行所有失败的测试）

`CTRL`- `R`+ `CTRL`- `T`= 在上下文中调试测试，即。它还附加调试器
这也适用于所有其他组合。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-05T21:23:40.397

可能还有其他方法，但我安装了[TestDriven.NET](http://testdriven.net/)。它允许您右键单击测试方法（MSTest、NUnit、MbUnit 等）并选择在调试器中运行。我强烈推荐它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-05T21:30:47.107

运行测试时有两种选择。查看您的测试工具工具栏。有四个按钮：在当前上下文中运行测试、在当前上下文中调试测试、运行所有测试和调试解决方案中的所有测试。

当您要调试单个测试时，可以将光标放在测试主体中，然后单击“当前上下文”测试运行按钮之一。要运行一个类中的所有测试，请将光标放在测试类名称上，然后单击其中一个按钮。

或者，您可以创建一个测试列表（Test->Create New Test List），并使用它来选择您要运行的测试。您还可以使用 theis 禁用和删除测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-04T11:56:57.140

如果您想在 ASP.NET 解决方案下运行测试时进行调试，请查看 MSDN 文章“如何：在 ASP.NET 解决方案中运行测试时进行调试”，网址为[http://msdn.microsoft.com/en-我们/图书馆/ms243172.aspx](http://msdn.microsoft.com/en-us/library/ms243172.aspx)。

我今晚必须这样做，并部分遵循“在 ASP.NET 开发服务器上运行时调试”的说明，在 web.config 和方法开始处的 System.Diagnostics.Debugger.Break() 语句中设置。但是，我使用“调试检查测试”命令（Ctrl+R、Ctrl+T）执行，该命令产生了一个即时调试器提示并运行了一个新的 Visual Studio 实例（我使用的是 VS2010 Beta2）。它运作良好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-04T13:16:54.740

就像[Will](https://stackoverflow.com/questions/266716/execute-only-one-unit-test-while-debugging-in-visual-studio-2008/266779#266779)提到的那样，您可以将测试列表用于各种“测试群”场景，因为解决方案中的每个单元测试都可以是零个或多个测试列表的成员，您可以在`Test`->中创建测试列表树`Windows`-> `Test List Editor`。

# url - URL 路由：在创建友好 URL 时处理空格和非法字符

> ID：266719
> 
> 赞同：8
> 
> 时间：2008-11-05T21:16:33.953
> 
> 标签：url, routing, character

我看过很多关于 URL 路由的讨论，以及很多很棒的建议……但在现实世界中，我没有看到讨论过的一件事是：

1.  **创建带有空格和非法字符**的友好 URL
***   查询数据库**

 **假设您正在构建一个 Medical 站点，其中包含带有**Category**和可选**Subcategory的****文章**。（1对许多）。（**可以用任何例子，但医学领域有很多长词**）

 ******* * *

## **示例类别/子/文章结构：**

1.  **您的一般健康状况（类别）**
    *   *自然健康**（子类别）***
        1.  您身体的免疫系统及其需要帮助的原因。**（文章）**
        2.  植物和草药真的是解决方案吗？
        3.  我应该吃强化食品吗？
    *   顺势疗法
        1.  什么是顺势疗法药物？
    *   *健康饮食*
        1.  你应该每天喝10杯咖啡吗？
        2.  有机蔬菜值得吗？
        3.  汉堡王® 是邪恶的吗？
        4.  “法式咖啡”还是美式咖啡更健康？
2.  **疾病和状况（类别）**
    *   *自身免疫性疾病**（子类别）***
        1.  人类的第一大杀手是某种疾病
        2.  如何获得帮助
    *   *遗传条件*
        1.  怀孕前预防脊柱裂。
        2.  你有长寿的倾向吗？
3.  **FooBar博士的个人建议（分类）**
    1.  我对草药和自然疗法的看法**（文章 - 无子类别）**
    2.  为什么要关心自己的健康？
    3.  有可能吃得好并有良好的饮食习惯。
    4.  无血手术已经成熟了吗？

* * *

在这样的结构中，如果你去的话，你将有一些**LOOONG URL**：/{Category}/{subcategory}/{Article Title}

此外，还有许多**非法字符**，如#! ? 'é”等。

## **所以，问题是：**

1.  您将如何处理非法字符和空格？（优点和缺点？）
2.  你会处理从数据库中获取这个吗
    *   换句话说，您会**相信数据库找到**项目、传递标题，**还是提取所有标题**并在代码中找到密钥以获取传递给数据库的密钥（对数据库的两次调用）？

*注意：我总是看到漂亮漂亮的例子，比如 /products/beverages/Short-Product-Name/ 如何处理一些丑陋的例子 ^_^*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T21:34:58.783

我的最后一种方法是：

1.  将所有“奇怪的字母”转换为“普通字母”-> à 转换为 a，ñ 转换为 n，等等。
2.  将所有非单词字符转换为_（即不是a-zA-Z0-9）
3.  用单个下划线替换下划线组
4.  删除所有拖尾和前导下划线

至于存储，我认为友好的 URL 应该进入数据库，并且是不可变的，毕竟[酷 URI 不会改变](http://www.w3.org/Provider/Style/URI)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-05T22:02:43.437

`_`如果您要删除空格，出于可读性原因，我自己更喜欢 _ （您在其上加上下划线并且's 实际上是 go_away ）。

您可能想尝试在可能的情况下将扩展字符（即 ü ）转换为 close-ascii 等效项，即：

ü -> 你

但是，根据我的经验，*实际*SEO 相关问题的最大问题不是 URL 包含所有可爱的文本，而是当人们*更改*链接中的文本时，您的所有 SEO 工作都会变成废话，因为您现在有*DEADLINKS*在索引。

为此，我建议stackoverflow做什么，并有一个引用常量实体的数字部分，并完全忽略文本的其余部分（和/或在错误时更新它）

此外，严重的hericichial性质只会使人类的可用性变差。人类*讨厌*长网址。复制粘贴它们很糟糕，而且它们更容易破裂。如果您可以将其细分为较低的teir，即

```
/article/1/Some_Article_Title_Here
/article/1/Section/5/Section_Title_Here
/section/19023/Section_Title_here  ( == above link ) 
```

这样，你唯一需要做巫术魔法的时候是当编号的文章实际上*已经*被删除时，你使用文本部分作为搜索字符串来尝试找到真正的文章或类似的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T21:45:20.150

解决方案2是那些典型的方法......一些改进是可能的，例如。为了可读性，将撇号变成空而不是破折号。通常，您会希望将 munged-for-URL-validity 版本的标题以及“真实”标题存储在数据库中，因此您可以使用索引的 SELECT WHERE 选择项目。

然而。只要您对它进行适当编码，URL 路径部分中就没有实际的非法字符。例如，空格、哈希或斜杠可以编码为 %20、%23 或 %2F。通过这种方式，可以将*任何*字符串编码为 URL 部分，因此您可以通过实际的、未更改的标题将其从数据库中选择出来。

不过，这取决于您的 Web 框架，但存在一些潜在问题。例如，任何基于 CGI 的东西都无法区分编码的 %2F 和真正的 /，并且某些框架/部署可能难以处理 Unicode 字符。

或者，一个简单而安全的解决方案是在 URL 中包含主键，使用标题部分纯粹是为了使地址更好。例如。：

```
http://www.example.com/x/category-name/subcat-name/article-name/348254863 
```

这就是例如。亚马逊做到了。它确实具有您可以更改数据库中的标题并将具有旧标题的 URL 自动重定向到新标题的优点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T09:00:22.517

万一有人感兴趣。这是我要走的路线（哦……双关语）：

```
Route r = new Route("{country}/{lang}/Article/{id}/{title}/", new NFRouteHandler("OneArticle"));
Route r2 = new Route("{country}/{lang}/Section/{id}-{subid}/{title}/", new NFRouteHandler("ArticlesInSubcategory"));
Route r3 = new Route("{country}/{lang}/Section/{id}/{title}/", new NFRouteHandler("ArticlesByCategory")); 
```

这使我能够像这样执行网址：

*   site.com/ca/en/Article/123/my-life-and-health
*   site.com/ca/en/Section/12-3/Health-Issues
*   site.com/ca/en/Section/12/

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T21:53:34.753

清理 URL 时，这是我用来替换重音字符的方法：

```
private static string anglicized(this string urlpart) {
        string before = "àÀâÂäÄáÁéÉèÈêÊëËìÌîÎïÏòÒôÔöÖùÙûÛüÜçÇ’ñ";
        string  after = "aAaAaAaAeEeEeEeEiIiIiIoOoOoOuUuUuUcC'n";

        string cleaned = urlpart;

        for (int i = 0; i < avantConversion.Length; i++ ) {

            cleaned = Regex.Replace(urlpart, before[i].ToString(), after[i].ToString());
        }

        return cleaned;

        // Here's some for Spanish : ÁÉÍÑÓÚÜ¡¿áéíñóúü"

} 
```

不知道它是否是最有效的正则表达式，但它肯定是有效的。这是一个扩展方法，所以调用它你只需将方法放在静态类中并执行以下操作：

```
string articleTitle = "My Article about café and the letters àâäá";
string cleaned = articleTitle.anglicized();

// replace spaces with dashes
cleaned = Regex.Replace( cleaned, "[^A-Za-z0-9- ]", "");

// strip all illegal characters like punctuation
cleaned = Regex.Replace( cleaned, " +", "-").ToLower();

// returns "my-article-about-cafe-and-the-letters-aaaa" 
```

当然，您可以将其组合成一种名为“CleanUrl”或其他方法的方法，但这取决于您。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-05T21:17:10.270

作为后续。我确实有一些想法。因此，请随时评论这些想法或对问题给出您自己的答案：

解决方案 #1：用破折号替换所有非法字符：

*   **www.mysite.com/diseases---conditions/Auto-immune-disorders/the--1-killer-of-people-is-some-disease/**

这对我来说有点难看...

解决方案 #2：去除非法字符并用单破折号替换空格：

*   **www.mysite.com/diseases-conditions/Auto-immune-disorders/the-1-killer-of-people-is-some-disease/**

解决方案 #3 应用一些规则将某些字符替换为单词：

*   **www.mysite.com/diseases-and-conditions/Auto-immune-disorders/the-number1-killer-of-people-is-some-disease/**

解决方案 #4 去除所有空格并使用大写

*   **www.mysite.com/DiseasesAndConditions/AutoImmuneDisorders/TheNumber1KillerOfPeopleIsSomeDisease/**

（在区分大小写的服务器上可能无法正常工作并且难以阅读）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-05T21:25:48.223

解决方案 2 将是我的建议。我不是世界上最大的 SEO 专家，但我相信这几乎是获得良好排名的“标准”方式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-05T21:27:10.233

我通常做的是只允许合法字符并保持友好的 URL 尽可能短。同样重要的是，友好的 URL 通常是由人插入的，我从不从标题或内容生成友好的 URL，然后使用该 URL 来查询数据库。我会使用表中的列，例如friendly_url，以便网站管理员可以插入友好的URL。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-05T21:35:38.533

我通过在数据库中添加一个额外的列（例如：在标题列旁边的 UrlTitle）并保存一个去除了所有非法字符的标题，并将“&”符号替换为“and”，并将空格替换为下划线，从而解决了这个问题。然后您可以通过 UrlTitle 查找并在页面标题或任何地方使用真实的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-05T21:49:51.873

我建议做 wordpress 所做的事情 - 去掉小词并用破折号（最多 1 个破折号）替换非法字符，然后让用户根据需要更正 URL。SEO 最好使 URL 可配置。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-30T09:31:45.637

作为客户端用户，而不是网页设计师，我发现 Firefox 在尝试用可用字符替换“非法”字符时有时会破坏 URL。例如，FF 将 ~ 替换为 %7E。这对我来说永远不会加载。我不明白为什么 HTML 编辑器和浏览器不简单地同意不接受 AZ 和 0-9 以外的字符。如果某些脚本需要 %、? 等，请更改脚本应用程序，以便它们可以使用字母数字。

# sql - 从 LINQ 访问动态创建的存储过程

> ID：266761
> 
> 赞同：1
> 
> 时间：2008-11-05T21:24:41.300
> 
> 标签：sql, linq, stored-procedures, pivot

我在 MS SQL 存储过程中旋转数据。旋转的列是使用存储过程参数（例如：“location1,location2,location3”）动态创建的，因此将生成的列数是未知的。输出应如下所示（位置取自存储过程参数）：

> 订购时间 | 位置1 | 位置2 | 位置3

这有可能在 LINQ to SQL 中使用吗？当我将此过程拖到 dbml 文件时，它显示此过程返回 int 类型。

我从`log_sales`表中使用的列是：

*   位置（我正在旋转的各个位置），
*   费用（金额）
*   订购时间

存储过程：

```
CREATE PROCEDURE [dbo].[proc_StatsDay] @columns NVARCHAR(64) AS

DECLARE @SQL_PVT1 NVARCHAR(512), @SQL_PVT2 NVARCHAR(512), @SQL_FULL NVARCHAR(4000);

SET @SQL_PVT1 =  'SELECT OrderTime, ' + LEFT(@columns,LEN(@columns)-1) +'
FROM (SELECT ES.Location, CONVERT(varchar(10), ES.OrderTime, 120),ES.Charge
        FROM dbo.log_sales ES
        ) AS D (Location,OrderTime,Charge)
        PIVOT (SUM (D.Charge) FOR D.Location IN
            (';
SET @SQL_PVT2 = ') )AS PVT
ORDER BY OrderTime DESC';

SET @SQL_FULL = @SQL_PVT1 + LEFT(@columns,LEN(@columns)-1) + 
@SQL_PVT2;       

EXEC sp_executesql @SQL_FULL, N'@columns NVARCHAR(64)',@columns = @columns 
```

在 dbml`designer.cs`文件中，我的存储过程部分代码：

```
[Function(Name="dbo.proc_StatsDay")]
public int proc_EasyDay([Parameter(DbType="NVarChar(64)")] string columns)
{
    IExecuteResult result = this.ExecuteMethodCall(this,((MethodInfo)MethodInfo.GetCurrentMethod())), columns);
    return ((int)(result.ReturnValue));
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T22:13:30.703

假设真正可怕的动态需求，您可以使用[DataContext.ExecuteQuery](http://msdn.microsoft.com/en-us/library/bb361109.aspx)

只需创建一个覆盖结果空间的类型（属性名称必须与查询中的列名称匹配）：

```
public class DynamicResult
{
  public DateTime OrderDate {get;set;}
  public decimal? Location1 {get;set;}
  public decimal? Location2 {get;set;}
//..
  public decimal? Location100 {get;set;}
} 
```

然后打电话

```
IEnumerable<DynamicResult> result =
  myDataContext.ExecuteQuery<DynamicResult>(commandString, param1); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T21:40:56.930

您可以在返回数据集后创建 linq 对象以供访问。

但这真的有用吗。Linq 对于类型安全调用而不是动态结果很有用。您将不知道要查找什么编译时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T21:52:43.707

你会运行你的选择语句

```
SELECT ES.Location, DateAdd(dd, DateDiff(dd, 0, ES.OrderTime), 0),ES.Charge
FROM dbo.log_sales ES 
```

并将结果捕获为这样的类型

```
public class LogSale
{
  public string Location {get;set;}
  public DateTime OrderDate {get;set;}
  public decimal Charge {get;set;}
} 
```

然后在内存中“旋转”/组织它

```
List<LogSale> source = LoadData();
var pivot = source
  .GroupBy(ls => ls.OrderDate)
  .OrderBy(g => g.Key)
  .Select(g => new {
     Date = g.Key,
     Details = g
       .GroupBy(ls => ls.Location)
       .Select(loc => new {
          Location = loc.Key,
          Amount = loc.Sum(ls => ls.Charge)
       })
     }); 
```

这是第二个关键的 Linq，它将数据推送到 XML 而不是匿名类型。

```
var pivot = source
  .GroupBy(ls => ls.OrderDate)
  .OrderBy(g => g.Key)
  .Select(g => new XElement("Date",
    new XAttribute("Value", g.key),
    g.GroupBy(ls => ls.Location)
     .Select(loc => new XElement("Detail",
       new XAttribute("Location", loc.Key),
       new XAttribute("Amount", loc.Sum(ls => ls.Charge))
     ))
  )); 
```

# perforce - 检测 Perforce 未打开的修改文件

> ID：266771
> 
> 赞同：28
> 
> 时间：2008-11-05T21:27:45.520
> 
> 标签：perforce

我正在尝试找出一种方法来检测未打开进行编辑但已在本地修改的文件。`p4 fstat`返回`headModTime`任何给定文件的值，但这是软件仓库中的更改时间，不应等于文件系统的`stat`上次修改时间。

我希望存在比备份原始文件、强制同步文件、然后运行差异更轻量级的操作。想法？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-05T21:41:56.960

来自：[http ://answers.perforce.com/articles/KB/3481/?q=disconnected&l=en_US&fs=Search&pn=1](http://answers.perforce.com/articles/KB/3481/?q=disconnected&l=en_US&fs=Search&pn=1)

具体见第2步：

* * *

2\. 接下来，打开以“编辑”任何已更改的文件：

```
p4 diff -se //myclient/... | p4 -x - edit 
```

p4 diff -se 返回相应客户端文件与客户端#have 修订版有任何不同的仓库文件的名称。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-06-18T16:06:13.647

[这个 SO question](https://stackoverflow.com/questions/9272/finding-untracked-files-in-a-perforce-tree)提供了一种在 P4V GUI 中执行此操作的方法：

> 在 2009 年 1 月版的 P4V 中，您可以右键单击工作区树中的任何文件夹，然后单击“协调脱机工作...”
> 
> 这将进行一些处理，然后显示未签出但与软件仓库版本不同或根本未签入的文件的拆分树视图。它甚至可能带来一些其他类别。
> 
> 您可以右键单击此视图中的文件并检出、添加甚至还原它们。

后来编辑：

在“协调...”窗口中，您可以单击“高级协调”并显示一个两窗格的文件夹层次结构差异窗口，该窗口对于查找您需要添加的文件特别有用。

优点：整个 P4V 功能比命令行版本更加用户友好（因为它允许最大粒度地选择要协调的内容）

缺点：它急需一个类似 subversion/git/hg`.ignore`的列表，以免您手动跳过项目中的所有 dll 和其他杂物。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-10-29T18:25:07.737

从 Perforce 版本 2012.1 开始，使用命令行命令`p4 status`和`p4 reconcile`

[http://www.perforce.com/perforce/r12.2/manuals/cmdref/status.html](http://www.perforce.com/perforce/r12.2/manuals/cmdref/status.html)

> 该`p4 status`命令在客户端的工作空间中查找未打开的文件，并检测您的工作空间和软件仓库之间的以下三种类型的不一致：
> 
> 1.  存在于仓库中的文件，存在于您的拥有列表中，但从您的工作区中丢失。默认情况下，这些文件随后会打开以进行删除。
> 2.  文件存在于您的工作区中，但在软件仓库中丢失。默认情况下，打开这些文件进行添加。
> 3.  在您的工作区中修改但未打开以供编辑的文件。默认情况下，打开这些文件进行编辑。

[http://www.perforce.com/perforce/r12.1/manuals/cmdref/reconcile.html](http://www.perforce.com/perforce/r12.1/manuals/cmdref/reconcile.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T06:34:23.673

从工作断开连接的文章中，使用 p4win 您还可以选择有问题的文件夹/文件，然后选择“文件菜单->更多->检查一致性”，这基本上可以执行“p4 diff -se”和“p4 diff -sd”，并且提示用户解决不一致的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-09T19:20:16.110

这是一个对我来说效果很好的 unix 解决方案。

[如何在 Perforce 树中查找未跟踪的文件？（模拟svn状态）](https://stackoverflow.com/questions/9272/finding-untracked-files-in-a-perforce-tree/100126#100126)

# .net - .NET 中的模拟文件方法（如 File.Copy("1.txt", "2.txt")）

> ID：266776
> 
> 赞同：14
> 
> 时间：2008-11-05T21:29:26.563
> 
> 标签：.net, unit-testing, mocking

我们有一些方法调用 File.Copy、File.Delete、File.Exists 等。我们如何在不实际访问文件系统的情况下测试这些方法？

我认为自己是一个单元测试 n00b，所以任何建议都值得赞赏。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-05T21:37:50.570

```
public interface IFile {
    void Copy(string source, string dest);
    void Delete(string fn);
    bool Exists(string fn);
}

public class FileImpl : IFile {
    public virtual void Copy(string source, string dest) { File.Copy(source, dest); }
    public virtual void Delete(string fn) { File.Delete(fn); }
    public virtual bool Exists(string fn) { return File.Exists(fn); }
}

[Test]
public void TestMySystemCalls() {
    var filesystem = new Moq.Mock<IFile>();
    var obj = new ClassUnderTest(filesystem);
    filesystem.Expect(fs => fs.Exists("MyFile.txt")).Return(true);
    obj.CheckIfFileExists(); // doesn't hit the underlying filesystem!!!
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T21:31:57.477

如果您绝对必须这样做，[Typemock Isolator](http://www.typemock.com/)是您的朋友。

我不能说我自己使用过它，我会尝试围绕它设计自己的方式，但据我所知，它会完成这项工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T21:32:58.910

我会为此[使用起订量](http://code.google.com/p/moq/)。您必须创建一个接口和一个代理到真实事物的类，这样您就可以让 Moq 创建您的代理实例（一个模拟实例），但它是测试这类事物的最佳方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T21:34:33.883

您可以为此使用模拟框架，它将创建 File 对象的假副本，您可以将文件注入到被测系统中。

我会推荐Rhino Mock。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T21:56:58.473

我倾向于在我的大多数项目中创建一个名为 IFileController 的接口，其中包含所有文件操作。这可以包含基本的方法，以及 .NET 框架未提供的处理文件的任何方法。

使用依赖注入框架，您可以获得 IFileController 的实例，而无需确切知道它是什么类型，并使用它而不需要弄乱模拟框架类型。这使得一切都更加可测试，并且作为奖励，您可以更改文件存储机制，而无需更改您的代码。

不利的一面是，需要告知任何新开发人员有关此接口的信息，否则他们将直接使用 .NET 方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-07T21:27:50.013

我在 CodePlex 上维护[Jolt.NET](http://jolt.codeplex.com)项目，其中包含一个库，可以为您生成此类接口及其实现。有关更多信息，请参阅[Jolt.Testing](http://jolt.codeplex.com/Wiki/View.aspx?title=Jolt.Testing)库。

# javascript - Javascript 和可访问性

> ID：266777
> 
> 赞同：21
> 
> 时间：2008-11-05T21:30:02.803
> 
> 标签：javascript, jquery, ajax, accessibility, screen-readers

作为一名 Web 开发人员，我从事的许多项目都属于政府的保护伞，因此受[508 无障碍](http://www.section508.gov/)法律的约束，有时还受[W3C 无障碍](http://www.w3.org/TR/WCAG/)指南的约束。在满足这些要求的同时，JavaScript 可以在多大程度上使用？

沿着这些思路，JavaScript，特别是 AJAX 和使用 jQuery 之类的包来做诸如显示模式对话、弹出窗口等的事情在多大程度上得到了现代可访问性软件（如 JAWS、Orca 等）的支持？过去，该规则类似于“如果它在 Lynx 中不起作用，它对屏幕阅读器不起作用”。这仍然是真的，还是在这些领域取得了更大的进展？

编辑：共识似乎是只要有非 javascript 后备，javascript 就可以了，但是屏幕阅读器软件中对 AJAX 的支持似乎仍然不确定。如果有人对此有具体经验，那将是最有帮助的。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-05T21:53:59.570

如果可访问性是您最关心的问题，请始终使用符合标准（选择文档类型定义并坚持使用）HTML 来启动网站。如果它是 Web 应用程序（表单提交等），请确保表单仅使用 HTTP GET 和 POST 即可工作。一旦你有一个完整的网站/应用程序，你可以添加一些 CSS 和 JavaScript，只要该网站仍然可以运行，其中一个或两个都关闭。

这里最重要的概念是[渐进增强](http://en.wikipedia.org/wiki/Progressive_enhancement)。您正在使用 CSS/JavaScript 添加额外的花里胡哨，但**没有**任何一种，您的网站/应用程序也能正常运行。

测试[508](http://www.section508.gov/)、[WAI](http://www.w3.org/WAI/)、 CSS off 、 JavaScript off 的好工具尝试使用 Firefox 的[Web Developer](https://addons.mozilla.org/en-US/firefox/addon/60)插件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T21:44:38.933

我认为答案实际上在于您如何构建事物。JQuery 具有不显眼的能力，因此可以访问。诀窍是在你的 AJAX 调用周围有冗余，这样没有 JavaScript 的浏览器仍然可以使用你的服务。换句话说，无论你有 JavaScript 响应、对话框等，你都需要一个降级的等价物。

如果您考虑到可访问性并且您正在对两个用例（JavaScript 与非 JavaScript）进行适当的测试，那么您应该能够编写同时满足这两种受众的应用程序。

示例 ($(document).ready 为清晰和简洁省略了调用：

```
<script>
  $("#hello").click(function(){
    alert("Hi");
  });
</script>
<a href="/say_hello.htm" id="hello">Say Hello</a> 
```

一个简单的例子，但基本上这只会在支持 JavaScript 的情况下评估 click JavaScript 事件。否则，它将像正常链接一样执行并转到 say_hello.htm - 作为开发人员，您的工作是确保正确处理这两个结果。

希望有帮助！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-06T00:19:29.653

渐进式增强当然是一种途径，但不引人注目并不是 JavaScript 可访问性的全部和终结，因为屏幕阅读器倾向于使用浏览器作为其工作的基础。由于这些浏览器支持 JavaScript，因此您页面上的脚本仍将运行。这是 AJAX 的一个特殊问题，因为单击页面的一部分可能会更改屏幕阅读器不知道的页面的另一部分。

然而，随着 AJAX 的成熟，使其可访问的方法正在出现。查看[WAI-ARIA](http://www.w3.org/WAI/intro/aria)以了解使 AJAX 可访问的现代方法，以及[Google 的 AxsJAX](http://code.google.com/p/google-axsjax/)以了解实现它的好方法。

* * *

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-25T20:59:21.227

看

*   [http://juicystudio.com/article/making-ajax-work-with-screen-readers.php](http://juicystudio.com/article/making-ajax-work-with-screen-readers.php)
*   [http://juicystudio.com/article/improving-ajax-applications-for-jaws-users.php](http://juicystudio.com/article/improving-ajax-applications-for-jaws-users.php)
*   [http://www.paciellogroup.com/blog/?p=15](http://www.paciellogroup.com/blog/?p=15)
*   [http://www-03.ibm.com/able/resources/ajaxaccessibility.html](http://www-03.ibm.com/able/resources/ajaxaccessibility.html)

您也可以看看 FlashAid，尽管它远非完美的解决方案。（但是，如果您使用渐进增强并且仅在 Flash 存在且用户未使用辅助功能 API 时使用 AJAX，您可能有一个合理的解决方案……适用于 Windows。）

从长远来看，WAI-ARIA 是解决方案。它在 JAWS 10（测试版）和 Firevox 中得到了一定程度的支持，但对于今天的所有用户来说肯定是不够的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-08T18:32:20.460

> JQuery 具有不显眼的能力，因此可以访问。诀窍是在你的 AJAX 调用周围有冗余，这样没有 JavaScript 的浏览器仍然可以使用你的服务。换句话说，无论你有 JavaScript 响应、对话框等，你都需要一个降级的等价物。

重用代码的一种方法是让“简单”页面调用可以自行调用的“函数”（或用于服务器端逻辑的任何内容），返回 JSON 或 XML。

例如：/static/myform.asp（在服务器端，“包含”与 /ajax/myform.asp 相同的逻辑），这样您就可以将 asp 用作 django 的模板。

当然，使用功能齐全的 bell and whistles 框架，您可以使这变得更容易（想想在 django 中为同一个视图提供一个 html 和一个 xml '模板'），但同样的想法也适用。

完成此操作后，使用 jQuery 遍历准备好的文档上的所有锚点，并使用锚点自己的链接添加 onclick 事件，替换 /static/ajax/ 可以让您的生活更轻松。

任何人都可以认为这是太多负担的原因吗？想知道这个“设计理念”是否存在严重缺陷。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-08-10T10:05:19.097

我认为接受的答案虽然在当时还不错，但现在已经过时了。（在写这个答案的时候已经有十年了。WCAG 2.1 是在几周前完成的......）

[W3C WAI-Authoring Design Patterns Practices](https://www.w3.org/TR/wai-aria-practices-1.1/)文档包括各种常见小部件的示例，这些小部件需要**javaScript**才能将正确的语义、状态和角色传达给辅助技术。

AJAX 可以访问，只要您在用户激活它之前小心地为屏幕阅读器提供有关页面内更新将是什么的相关语义线索。您可能还需要通知屏幕阅读器之后实际发生的变化，例如 aria-live 区域可能会宣布“已加载 20 个新项目”或其他任何内容。这是通过 javaScript 实现的。

如果您的可访问性知识停留在“渐进式增强”，并且您将上面接受的答案视为该职位的理由，那么您很可能需要更新。这些天事情进展得很快。

# javascript - Javascript 表单提交：对象不支持此属性或方法 (IE7)

> ID：266794
> 
> 赞同：5
> 
> 时间：2008-11-05T21:34:17.927
> 
> 标签：javascript, internet-explorer

我正在尝试使用 javascript 提交表单。Firefox 工作正常，但 IE 在此函数的提交行上抱怨“对象不支持此属性或方法”：

```
function submitPGV(formName, action)
{
    var gvString = "";

    pgVisibilities.each(function(pair) {
        gvString += pair.key + ":" + pair.value + ",";
    });

    $('pgv_input').value = gvString;

    var form = $(formName);
    form.action = action;
    form.submit();
} 
```

在这里调用：

```
<a href="javascript:submitPGV('ProductGroupVisibility','config/productgroupvis/save')"> 
```

这是表格：

```
<form id="ProductGroupVisibility" action="save" method="post">
    <input type="hidden" name="ows_gv..PGV" id="pgv_input" value=""/>
</form> 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-05T22:10:23.953

`name`你有什么`<input type="submit">`？

如果您将其称为“提交”，则您已经覆盖了该`form.submit()`函数，这与名为“foo”的输入生成`form.foo`属性的方式非常相似。这可以解释这种行为。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-05T21:53:49.337

尝试检查 IE 选择的元素的类型：

```
// For getting element with id you must use # 
alert( typeof( $( '#ProductGroupVisibility' ))); 
```

页面上可能还有其他内容，IE 在表单之前选择了该 ID。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-04-18T15:25:03.917

当心 name='submit' 表单中的任何输入，它们会破坏 javascript .submit() 功能！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-05T21:58:22.887

您使用的是什么 javascript 框架？如果是 jQuery，我认为您需要将 # 添加到您的 id：

```
$('#ProductGroupVisibility').submit(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T21:43:07.923

你确定你的 JavaScript 库已经加载了吗？（jQuery 或原型）

它在 IE7 中使用 Prototype 对我有用。

尝试：

```
alert($('ProductGroupVisibility').id) 
```

看看你有没有报错。

# f# - System.Collections.Generic 列表和 F#

> ID：266800
> 
> 赞同：2
> 
> 时间：2008-11-05T21:36:16.283
> 
> 标签：f#

我有一个 C# 类返回一个列表，使用 System.Collections.Generic Lists 而不是 F# List

我想遍历列表以查找对象或找不到对象。这是我在 C# 中的做法。我将如何在 F# 中完成类似的事情

```
foreach (AperioCaseObj caseObj in CaseList)
{
     if (caseObj.CaseId == "")
     {    
     }
     else
     { 
     }
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-06T02:03:06.557

```
match Seq.tryfind ((=) "") caseList with
      None -> print_string "didn't find it"
    | Some s -> printfn "found it: %s" s 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T04:34:28.203

AC# 列表在 F# 中称为 ResizeArray。要在 ResizeArray 中查找元素，您可以使用“tryfind”或“find”。TryFind 返回一个选项类型（Option），这意味着如果未找到该元素，您将获得 None。另一方面，如果找不到您要查找的元素，则 Find 会引发异常

* * *

```
let foo() = 
   match CaseList |> ResizeArray.tryfind (fun x -> x.caseObj = "imlookingforyou") with
   |None -> print-string ""notfound
   |Some(case ) -> printfn "found %s" case 
```

或者

```
let foo()
   try
      let case = ResizeArray.find (fun x -> x.caseObj = "imlookingforyou") 
      printfn "found %s" case 

   with
   | _ -> print_string "not found" 
```

* * *

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-05T22:54:10.307

请参阅此示例以迭代整数通用列表：

```
#light
open System.Collections.Generic

let genList = new List<int>()

genList.Add(1)
genList.Add(2)
genList.Add(3)

for x in genList do
  printf "%d" x 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-06T01:52:00.543

这种列表也是一个 IEnumerable，所以你仍然可以使用 F# 的`for elt in list do`符号：

```
for caseObj in CaseList do
  if caseObj.CaseId = "" then
    ...
  else
    ... 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-06T11:08:47.983

使用 tryfind 匹配记录中的字段：

```
type foo = {
    id : int;
    value : string;
}

let foos = [{id=1; value="one"}; {id=2; value="two"}; {id=3; value="three"} ]

// This will return Some foo
List.tryfind (fun f -> f.id = 2) foos

// This will return None
List.tryfind (fun f -> f.id = 4) foos 
```

# sql-server-2005 - 模块化应用数据库结构

> ID：266802
> 
> 赞同：5
> 
> 时间：2008-11-05T21:37:33.863
> 
> 标签：sql-server-2005, database-design, modularity

我正在构建一个模块化应用程序。通过配置，您可以打开和关闭这些应用程序模块。我正在尝试确定应该为包含每个模块的数据的表使用什么数据库结构 (mssql2005)。我想到的两个选项是：

1.  将所有表放入一个大数据库中，并根据模块为表添加前缀。
2.  将每个模块的表分离到不同的数据库中。

我确实有所有模块共有的数据，所以如果我使用解决方案 2，我不确定如何管理这些公共数据（例如用户）。

--

为了澄清一件事，这些模块可能会单独出售，并且配置设置不受客户端控制。这就是为什么我什至考虑将它们分成单独的表格。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T23:48:45.457

对于您提出的建议，我的替代建议是 SQL Server 2005 中可用的架构功能。

请阅读此链接以获取更多信息...

[http://searchsqlserver.techtarget.com/tip/0,289483,sid87_gci1184503,00.html](http://searchsqlserver.techtarget.com/tip/0,289483,sid87_gci1184503,00.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T22:03:45.497

如果是我，我会先完全规范化应用程序。我将开发一种结构，将所有公共数据放在共享表中，并且只将每个模块唯一的数据保留在特定模块表中。

如果共享表中的数据对所有模块确实是通用的，并且没有您试图集中到这些“通用”表中的极端情况，那么打开或关闭一个模块应该不会影响任何其他模块的功能，并且你现在很少（如果有的话）重复数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T00:10:48.110

我会有一个数据库。这极大地简化了解决方案的管理。

然后我会标准化我的数据。这简化了数据完整性问题。

然后我会根据需要将每个模块的表添加到基础数据库中。我会分发这个基础数据库，但我不会分发未使用模块的数据。每个模块在安装时都会分发它自己的数据（可能由其安装程序而不是内置到模块本身中）。

表前缀并不重要，共享数据库的好处是您可以从任何模块访问每个表并拥有共享的配置文件等...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T21:40:39.300

如果您需要跨表查询，我建议将它们放入一个数据库中，否则不会有任何区别。但是，拥有一个数据库会更容易维护。

除非您需要多个数据库，否则我建议您只使用一个。

# php - 使用静态工厂模式时包含 PHP 库的最佳方式是什么？

> ID：266803
> 
> 赞同：7
> 
> 时间：2008-11-05T21:37:50.227
> 
> 标签：php, include, polymorphism, require, require-once

我的 PHP 库中有几个静态工厂模式。但是，内存占用正在失控，我们希望减少执行期间所需的文件数量。这是我们今天所处位置的一个示例：

```
require_once('Car.php');
require_once('Truck.php');

abstract class Auto
{
    // ... some stuff ...

    public static function Create($type)
    {
        switch ($type) {
            case 'Truck':
                return new Truck();
                break;
            case 'Car':
            default:
                return new Car();
                break;
        }
    }
} 
```

这是不可取的，因为需要包含 Car.php 和 Truck.php，即使可能只需要其中一个。据我所知， require/include 及其 ..._once 变体包括与调用范围相同的库。这是真的？

如果是这样，我相信这会导致内存泄漏：

```
 abstract class Auto
    {
        // ... some stuff ...

        public static function Create($type)
        {
            switch ($type) {
                case 'Truck':
                    require_once('Truck.php');
                    return new Truck();
                    break;
                case 'Car':
                default:
                    require_once('Car.php');
                    return new Car();
                    break;
            }
        }
    } 
```

在我看来，在第二个示例中，即使使用了 require_once 风格，对 Create() 的多次调用也会因为调用的范围而导致多次请求。

这是真的？在诸如此类的示例中，在 php 中动态包含库的最佳方法是什么？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-05T21:42:46.990

Autoload 工具通常被视为 Evil，但它在这些任务中工作得非常好。

如果您可以获得良好的文件系统 <-> 类名映射，那么您可以在给定要提供的类时找到它，那么它将节省您的开销并且仅在需要时加载类。

它也适用于静态类，因此一旦静态类在范围内，它甚至不需要调用一次 require 的“是否包含文件”测试，因为该类已经在符号表中。

然后你可以创建

```
require("autoloader.php"); 
$x = new Car();  
$x = new Bike(); 
```

它只会在需要时将它们带入。

有关详细信息，请参阅[Php.net/__autoload](http://nz2.php.net/__autoload)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T21:44:18.373

我建议使用[自动加载器](http://php.net/autoload)。

也就是说，不要使用`require_once()`require 任何一个子类，而是允许自动加载器调用一个函数，该函数可以在您调用`new Truck()`或时加载引用的类`new Car()`。

至于内存泄漏的问题，不，`require_once`不受代码块的限制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T21:43:56.127

看看[__autoload() 函数](http://it2.php.net/autoload)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T22:11:03.407

require_once 函数的要点是，无论范围如何，您都不会包含两次文件并重新定义导致 PHP 错误的类。所以不用担心内存泄漏，如果 require_once 被命中，类 def 只会进入全局符号表一次。

但除此之外，是的，使用自动加载器。

# ssis - 如何消除 SSIS 作业中的“未使用的输出列”警告？

> ID：266805
> 
> 赞同：3
> 
> 时间：2008-11-05T21:38:39.477
> 
> 标签：ssis, logging

我正在尝试消除我的 SSIS 进度日志中的一些虚假警告。我收到一堆关于使用原始 SQL 完成工作的任务中未使用列的警告。我有一个数据流负责在加载新数据之前将数据存档在临时表中。数据流如下所示：

```
+--------------------+
| OLEDB Source task: |
| read staging table |
+--------------------+
          |
          |
+---------------------------+
| OLEDB Command task:       |
| upsert into history table |
+---------------------------+
          |
          |
+---------------------------+
| OLEDB Command task:       |
| delete from staging table |
+---------------------------+ 
```

我的“upsert”任务类似于：

```
--------------------------------------
-- update existing rows first...
update history
set    field1 = s.field1
    ...
from   history h
inner  join staging s
on     h.id = s.id
where  h.last_edit_date <> s.last_edit_date -- only update changed records

-- ... then insert new rows
insert into history
select s.*
from   staging s
join   history h
on     h.id = s.id
where  h.id is null
-------------------------------------- 
```

清理任务也是一条 SQL 命令：

```
--------------------------------------
delete from staging
-------------------------------------- 
```

由于 upsert 任务没有任何输出列定义，我在日志中收到一堆警告：

```
[DTS.Pipeline] Warning: The output column "product_id" (693) on output 
"OLE DB Source Output" (692) and component "read Piv_product staging table" (681) 
is not subsequently used in the Data Flow task. Removing this unused output column 
can increase Data Flow task performance. 
```

如何消除对这些列的引用？我尝试了一些不同的任务，但似乎没有一个能让我“吞下”输入列并从任务的输出中抑制它们。我想保持我的日志干净，所以我只看到真正的问题。有任何想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T21:42:10.517

联合所有 - 仅选择您要通过的列 - 删除任何其他列。

我认为他们将在 2008 版本中解决这个问题，以允许从管道中修剪/抑制列。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-06T00:57:05.240

好的，我在[MSDN 论坛](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=4090954&SiteID=1)上找到了解决方法：

在任务 1 和 2 之间使用脚本组件转换；选择所有输入列；将脚本主体留空。

这会消耗列，作业处理正确，并且不会记录任何警告。

仍然不清楚为什么我需要 OLEDB 源，因为任务 2 中的 SQL 连接到源表并完成所有工作，但是当我删除 OLEDB 源时，数据流运行但不处理任何行，所以暂存表永远不会被清空，然后将更改的行放入临时表的下游进程由于 PK 违规而失败。但这是另一天的问题。这有点笨拙，但我的日志很干净。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T07:17:51.917

管道中的警告是由在数据源中选择的列未在任何后续任务中使用引起的。

解决此问题的简单方法是双击您的数据源。在您的情况下（OLEDB 源任务：| | 阅读暂存表）然后单击列并取消选择您在将来的任何任务项中不需要的任何列。

这将从您的进度日志中删除这些警告。

但是，阅读您上面的项目并如其他答案所解释的那样，您没有在后续项目中使用源任务中的列，因此可以简单地将其删除。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-04-13T22:38:08.007

我也有同样的问题。我收到了很好的答复。你可以在[这里](https://stackoverflow.com/questions/42680747/how-can-i-delete-the-columns-in-dataflow-task-in-ssis)找到它。

正如“ [Mark Wojciechowicz](https://stackoverflow.com/users/2568521/mark-wojciechowicz) ”所说：

以下是一些降低复杂性的建议，这反过来又会提高性能：

*   **在源头减少列。** 如果您选择的列随后不会以任何方式使用，请从查询中删除它们或从源组件中取消选中它们。以这种方式删除列会将它们从缓冲区中删除，这将占用更少的内存。
*   **减少数据流中的组件数量**。很长的数据流很容易创建，测试起来很痛苦，甚至更难维护。数据流需要一个*工作单元*，即从这里到那里的数据流，中间有一些东西。这就是数据流大放异彩的地方，事实上，它们通过内存限制和最大线程数来保护自己免受复杂性的影响。最好将工作划分为单独的数据流或存储过程。例如，您可以将数据暂存到一个表中并读取两次，而不是使用多播。
*   **使用数据库。** SSIS 既是一种编排工具，也是一种数据移动工具。我经常发现，使用简单*的数据流来暂存数据*，然后调用存储过程来*处理数据*，总是胜过一体化数据流。
*   **增加写入数据的次数**。这完全违反直觉，但如果您在较小的操作集中处理数据，则运行速度更快且更易于测试。给定一个干净的状态，我通常会设计一个 ETL 来将数据从源写入临时表，执行从临时表到另一个表的清理步骤，可选地，添加一个一致的步骤以将来自不同源的数据组合到另一个表和，最后，加载目标表的最后一步。请注意，每个源都被推送到其自己的目标表，然后利用数据库进行组合。第一步和最后一步设置为快速运行并避免两端锁定或阻塞。
*   **批量加载**。当您确保正在进行批量加载时，上一步确实做得很好。这可能是一件棘手的事情，但通常您可以通过在 OLEDB 目标中使用“快速加载”*而不*使用 oledb 命令来实现。删除索引并重新添加它们比就地加载要快（很少有例外）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T22:08:40.963

再次查看您的问题，我认为您正在“违背原则”使用 SSIS。我并没有真正关注您从临时表中读取的内容，因为您的 upsert 似乎不依赖于特定行中的任何内容，清理也不依赖于任何内容。

在我看来，清理会为每一行运行一次，但这并没有真正的意义。

DataFlows 通常不用于对管道中的每一行执行批量操作。如果您使用的是管道 UPSERT，则使用 Lookup（或第三方 TableDifference）组件处理，然后管道中的 spli 到 OLEDB 目标（BULK INSERT）和 OLEDB 命令（每次更新一次）或另一个 OLDEB 目标“更新临时表”。

通常，我会使用 DataFlow 来加载暂存表而不进行任何拆分，然后在控制流中执行单个 Execute SQL 任务，通过调用 SP 以直接 SQL UPSERT（就像您拥有的那样）执行所有其他操作。

如果您不想拥有临时表，而是读取平面文件并希望使用 Lookup 组件或其他东西执行 UPDATE 或 INSERT，则 OLEDBCommand 很有用。但是它将为管道中的每一行调用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T18:41:08.903

你`DataFlow Task`应该以“upsert”结束。然后回到控制流中，为从暂存中删除创建一个`Execute SQL Task`。将您链接`DataFlow Task`到您的 exec sql。

我没有为我的 upserts 使用 3rd 方工具，而是按照 Cade 的建议进行操作，即将您的数据流拆分为仅指向 a `OLE DB Destination`（或类似）的新记录，并更新可以转到您的 oledb 命令进行更新的记录. 您可以使用合并连接或查找来拆分流。

# java - 在 Java 中声明方法参数 final 是否有任何性能原因？

> ID：266806
> 
> 赞同：117
> 
> 时间：2008-11-05T21:38:58.557
> 
> 标签：java, performance, final

在 Java 中声明方法参数 final 是否有任何性能原因？

如：

```
public void foo(int bar) { ... } 
```

相对：

```
public void foo(final int bar) { ... } 
```

假设`bar`在`foo()`.

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-11-05T22:31:17.297

final 关键字不会出现在局部变量和参数的类文件中，因此它不会影响运行时性能。它的唯一用途是澄清编码人员不更改变量的意图（许多人认为其使用的可疑原因），并处理匿名内部类。

关于方法本身的 final 修饰符是否有任何性能提升存在很多争论，因为无论如何优化编译器都会在运行时内联这些方法，而不管修饰符如何。在这种情况下，它也应该只用于限制方法的覆盖。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-05T21:58:00.607

final 参数的唯一好处是它可以在匿名嵌套类中使用。如果一个参数从不改变，即使没有 final 修饰符，编译器也会将其检测为正常操作的一部分。错误是由意外分配的参数引起的，这是非常罕见的——如果你的方法足够大，需要这个级别的工程，那就让它们更小——你调用的方法不能改变你的参数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-04-30T21:15:22.527

再强调一点，使用在方法中声明的非最终局部变量——内部类实例的寿命可能比堆栈帧长，因此局部变量可能会在内部对象仍然存在时消失

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-05T21:44:30.480

在类加载之后运行的编译器（例如 JIT 编译器）可以利用 final 方法。因此，声明为 final 的方法可能具有一些性能优势。

[http://www.javaperformancetuning.com/tips/final.shtml](http://www.javaperformancetuning.com/tips/final.shtml)

哦，还有另一个好资源

[http://mindprod.com/jgloss/final.html](http://mindprod.com/jgloss/final.html)

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2012-05-18T08:23:31.360

我假设编译器可能会删除所有具有原始类型（例如 int）的私有静态最终变量，并将它们直接内联到代码中，就像使用 C++ 宏一样。

但是，我不知道这是否在实践中完成，但可以这样做以节省一些内存。

# java - 从 Java/Swing 应用程序使用 Mac OS X 服务菜单

> ID：266809
> 
> 赞同：3
> 
> 时间：2008-11-05T21:40:48.710
> 
> 标签：java, macos, swing

我想让我的 Java/Swing 应用程序与 Mac OS X 上可用的服务菜单兼容。例如，以便用户可以在 JTextArea 中选择一些文本并通过**服务 -> 语音 -> 开始说话将其转换为语音文本**。有没有一种简单的方法可以实现这一目标？（应用程序应该仍然能够在 Mac OS X 以外的平台上运行。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-06T18:52:47.783

查看用于 java 开发的苹果[OSXAdapter 包](https://developer.apple.com/samplecode/OSXAdapter/index.html)（链接需要免费的苹果开发者登录）。包中包含的示例向您展示了如何以仅在您的应用程序在 OS X 下运行时激活的方式很好地集成到 OS X 应用程序菜单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T23:47:49.933

我倾向于说不。如果我没记错的话，服务只对 Cocoa 应用程序可用，而 Java 应用程序不是 Cocoa 应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-26T19:36:37.977

这似乎在 Mac OS X Leopard 上工作，对原始应用程序没有任何改变。所以我对答案（如何使它在老虎身上起作用）失去了兴趣。不过，感谢您的贡献。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-26T17:54:51.650

如果您想要的只是将文本转换为语音的最终结果，您可以尝试使用 ProcessBuilder调用“ **say ”命令，如下所示：**

```
String stuffYouWantToSay = "StackOverflow Rocks!";
Process p = null;
try {
    ProcessBuilder pb = new ProcessBuilder("/usr/bin/say", stuffYouWantToSay);
    p = pb.start();
} catch (Exception e) {
    // handle the error
    return;
} 
```

这不会将其添加到服务菜单中，但您仍然可以获得相同的效果。

请务必查看“say”的手册页，因为您可以更改声音。

# iis - 从 IIS 5 (Windows 2000 Server) 虚拟目录中删除 Interdev 并替换为 FTP

> ID：266817
> 
> 赞同：1
> 
> 时间：2008-11-05T21:42:15.710
> 
> 标签：iis, ftp, iis-5, windows-server-2000

我有几个网站`Windows 2000 box`仍在使用`Interdev/HTTP`更新。我想将它们转换为仅 FTP 并删除 Interdev 更新功能。如何以最小的干扰转换这些？IE 我如何`remove Interdev`从这些网站中获取信息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T16:04:00.543

Interdev 使用 FrontPage 服务器扩展。如果您从应该切断 Interdev 访问的虚拟目录中删除它们。

# java - 将Java字符串与数组匹配的问题

> ID：266818
> 
> 赞同：0
> 
> 时间：2008-11-05T21:42:27.083
> 
> 标签：java, arrays, string

我需要查看字符串值是否与对象值匹配，但为什么这不起作用？

```
public int countPacks(String flavour) {
    int counter = 0;
    for(int index = 0; index < packets.size(); index++) {            
        if (packets.equals(flavour)) {
           counter ++;
        }
        else {
           System.out.println("You have not entered a correct flavour");
        }
    } 
    return counter; 
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-05T21:44:34.957

什么是“包”？它不会是一个字符串 - 那么它如何等于一个字符串？

我怀疑你的意思是你的测试是：

```
if (packets.get(index).equals(flavour)) 
```

但是，即使有一个具有正确风味的包，您仍然会为每包“错误”风味打印出“您没有输入正确的风味”！

我怀疑您想将错误报告移到方法的末尾，在循环之后，并且仅在以下情况下执行`counter == 0`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T21:44:09.920

你可能的意思是

```
if (packets.get(index).equals(flavour)) {
   ... 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-06T16:34:15.427

A problem with methods declared in Object is that there is a lack of static type checking in their use. The same applies to synchronized, where it is common to lock the wrong object.

In this case Object.equals(Object) works with any two objects. You have used the collection, packets, instead of getting an element from it. The important question is not how did this particular bug come about, but how can we prevent it from occurring in the first place.

First of all, use generics and get assign each element for the iteration to a statically typed local:

```
public int countPacks(String flavour) {
    // [ The field represents a count. ]
    int count = 0;
    for(int index=0; index<packets.size(); ++index) {
        String packet = packets.get(index);
        if (packet.equals(flavour)) {
           ++count;
        }
    } 
    // [The error mesage was printed for each non-match.
    //  Even this is probably wrong,
    //    as it should be valid to have no packs of a valid flavour.
    //  Having the message in this method is actually a bit confused.]
    if (count == 0) {
        System.out.println("You have not entered a correct flavour");
    }
    return count; 
} 
```

We can further tidy this up using the enhanced for loop.

```
public int countPacks(String flavour) {
    int count = 0;
    for(String packet : packets) {
        if (packet.equals(flavour)) {
           ++count;
        }
    } 
    if (count == 0) {
        System.out.println("You have not entered a correct flavour");
    }
    return count; 
} 
```

That looks clearer, but a good programmer knows his/her libraries.

```
public int countPacks(String flavour) {
    int count = Collections.frequency(packets, flavour);
    if (count == 0) {
        System.out.println("You have not entered a correct flavour");
    }
    return count; 
} 
```

You might also consider a `Map<String,Integer>` instead of the collection.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-05T22:32:13.677

假设数据包是一个集合（并且您使用的是 JDK 1.5 或更高版本），您也可以只使用该方法：

```
public int countPacks(String flavor) {
   int numOccurrences = java.util.Collections.frequency(packets, flavor);
   if(numOccurrences == 0) {
      System.out.println("You have not entered a correct flavor");
   }
   return numOccurrences;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T21:55:32.983

您应该这样做以确保您确实以最简单的方式比较字符串。

我还修复了你的循环

```
public int countPacks(String flavour, List packets)
    {
        int counter = 0;
        for (Iterator iter = packets.iterator(); iter.hasNext();) {
            Map packet = (Map) iter.next();

            if (packet.get("flavour").toString().equalsIgnoreCase(flavour)) {
                counter ++;
            }
          else {
            System.out.println("You have not entered a correct flavour");
            }
        } 
        return counter; 
    } 
```

# ruby-on-rails - 在 Rails 中向 Integer 类添加方法的最佳位置在哪里？

> ID：266819
> 
> 赞同：5
> 
> 时间：2008-11-05T21:42:41.280
> 
> 标签：ruby-on-rails, ruby, monkeypatching

在 Rails 中向整数类添加方法的最佳位置在哪里？我想添加一个`to_meters`和`to_miles`方法。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-07T09:32:18.443

如果您一心想使用 Numeric（或整数等）类来进行单位转换，那么至少要在逻辑上进行并具有一些实际价值。

首先，创建一个 Unit 类来存储单位类型（米、英尺、肘等）和创建时的值。然后向 Numeric 添加一堆方法，这些方法对应于 unit 可以具有的有效值：这些方法将返回一个 Unit 对象，其类型记录为方法名称。Unit 类将支持一堆 to_* 方法，这些方法将转换为具有相应单位值的另一种单位类型。这样，您可以执行以下命令：

```
>> x = 47.feet.to_meters
=> 14.3256
>> x.inspect
=> #<Unit 0xb795efb8 @value=14.3256, @type=:meter> 
```

处理它的最佳方法可能是 Unit 类中的转换类型和表达式的矩阵，然后使用 method_missing 检查给定类型是否可以转换为另一种类型。在 numeric 类中，使用 method_missing 询问 Unit 是否支持给定的方法作为单元类型，如果支持，则返回使用 numeric 作为其值的请求类型的单元对象。然后，您可以通过向 Unit 添加一个扩展转换矩阵的 register_type 和 register_conversion 类方法来支持在运行时添加单位和转换，并且 Numeric 将“自动”获取该功能。

至于放在哪里，创建一个 lib/units.rb 文件，该文件还包含 Numeric 的 monkey_patch，然后在需要 lib/units.rb 文件的 config/environment.rb 中初始化它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T21:47:13.923

通常（并且在逻辑上），整数不能转换为英里或米。听起来您可能想要创建一个新类，如“英尺”或“英寸”，用整数初始化，然后包含 size_in_miles 或 size_in_meters 等方法。为方便起见，这些方法可以返回十进制或浮点类型，但您可能还想编写英里类或米类。

作为替代方法，您可能希望在新类中创建一个具有如下签名的静态方法：

`Float feetToMiles(integer I)`

你会打电话给

`miles = Feet.feetToMiles(5280);`

并得到`miles = 1.0`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T21:48:47.490

创建您自己的模块/库，当您需要它来执行此任务时将其包含在范围内。

如“requre 'unitCoversions'”

如果你足够努力的话，很有可能已经有人这样做了:)

但是*不要*尝试修改本机核心类，这只会以苦难告终。

（此外，您要扩展的类是 'numeric' ，这将适用于整数和浮点数:)）

> 不完全清楚为什么我不应该这样做……Rails 对字符串类这样做并取得了巨大的成功。

因为它*可以*做并不意味着它*应该*做。众所周知，“猴子修补”可能会产生各种奇怪的副作用，如果做错了，它们可能会成为史诗般的失败。

当没有好的选择时就去做。

因为如果你真的想做一些愚蠢的事情，你可以构建一个完整的框架，它*所做*的只是对核心类进行猴子补丁。

例如，翻转数据库。

```
5.getArtist(); 
10.getEvent(); 
100.getTrack(); 
```

等等等等。有多少不好的方法可以做到这一点是没有限制的。

```
"Bob".createUser(); 
```

杯中的苦难。

如果你想做一些实际的事情，有一个 Convert 类或函数，

```
convert( 3 , { :from=>:miles, :to=>:meters }); 
```

至少您不会以这种方式污染全局命名空间和核心功能，而且它更具有连贯性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-06T00:50:26.377

为什么不只是：

```
class Feet
  def self.in_miles(feet)
    feet/5280
  end
end 
```

用法：

```
Feet.in_miles 2313 
```

或者换个角度看：

```
class Miles
  def self.from_feet(feet)
    feet/5280
  end
end

Miles.from_feet 2313 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-06T20:25:51.823

我同意猴子补丁应该小心使用，但有时它只是有意义的。我真的很喜欢允许你输入 5.days.ago 的助手，它们是 active_support 库的一部分

因此，在这种情况下，其他一些答案可能会更好，但是如果您要扩展 ruby​​ 类，我们会将所有扩展保留在 lib/extensions/class_name.rb

这样，在处理项目时，可以快速轻松地找到和查看标准类可能不寻常的任何内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-07T11:06:12.873

意识到这个问题很老，但我认为最清楚的方法是创建一个具有两个属性的距离类`@length`和`@unit`.

您只需要一个转换哈希，可能作为距离的类变量：

```
class Distance

  @@conversion_rates = {
    meters: {
      feet: 3.28084,
      meters: 1.0
    }
  }

  def to(new_unit)
    new_length = @length * @@conversion_rates[@unit][new_unit]
    Distance.new( new_length, new_unit ) 
  end

end 
```

它看起来有点像：

```
Distance.new(3, :meters).to(:feet) 
```

老实说，我认为这看起来比

```
3.meters.to_feet 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-05T21:53:49.430

如果你打算这样做，你不应该这样做，那么你将把你的代码放入：

```
config/initializers/add_methods_that_are_naughty_to_numeric.rb 
```

Rails 会自动为您运行这些。

# c# - DropDownList 没有显示足够的行

> ID：266823
> 
> 赞同：4
> 
> 时间：2008-11-05T21:43:11.200
> 
> 标签：c#, asp.net, vb.net, drop-down-menu

在 ASP.NET 中，a`ListBox`有一个 Rows 属性，我可以设置它来说明要显示多少行。A `DropDownList`，但是，没有。有什么办法可以设置`DropDownList`应该显示的最大行数？代码？标记？CSS？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T19:51:30.780

如果您想要这种级别的控制，您需要在 javascript 中重新实现下拉列表。有点烂

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-18T05:11:06.510

下拉列表在浏览器中呈现为 html select... html select 不支持您提出的要求...

您将需要编写一个自定义控件来设置最大行数的限制。

您必须为此编写自定义控件或使用客户端加载项...

下面[的帖子](https://stackoverflow.com/questions/6427801/dropdownlist-number-of-display-element)也回答了你的问题。

# java - 如何在java中格式化持续时间？（例如格式 H:MM:SS）

> ID：266825
> 
> 赞同：199
> 
> 时间：2008-11-05T21:43:54.163
> 
> 标签：java, date-formatting, duration

我想使用 H:MM:SS 之类的模式以秒为单位格式化持续时间。Java 中的当前实用程序旨在格式化时间而不是持续时间。

* * *

## 回答 #1

> 赞同：217
> 
> 时间：2008-11-05T22:28:52.183

如果您不想拖入库，则使用格式化程序或相关快捷方式（例如）很简单。给定整数秒数：

```
 String.format("%d:%02d:%02d", s / 3600, (s % 3600) / 60, (s % 60)); 
```

* * *

## 回答 #2

> 赞同：164
> 
> 时间：2013-09-05T10:08:20.523

我像这样使用 Apache common 的[DurationFormatUtils](http://commons.apache.org/proper/commons-lang/javadocs/api-3.0/org/apache/commons/lang3/time/DurationFormatUtils.html)：

```
DurationFormatUtils.formatDuration(millis, "**H:mm:ss**", true); 
```

* * *

## 回答 #3

> 赞同：93
> 
> 时间：2008-11-05T21:49:32.030

如果您使用的是 Java 8 之前的版本...您可以使用[Joda Time](http://joda-time.sourceforge.net/)和[`PeriodFormatter`](http://joda-time.sourceforge.net/api-release/org/joda/time/format/PeriodFormatter.html). 如果您确实有一个持续时间（即经过的时间，不参考日历系统），那么您可能应该`Duration`在大多数情况下使用 - 然后您可以调用`toPeriod`（指定`PeriodType`您想要反映 25 小时是否变为1 天 1 小时或不等）来获得一个`Period`可以格式化的文件。

如果您使用的是 Java 8 或更高版本：我通常建议使用`java.time.Duration`来表示持续时间。然后，如果需要，您可以根据 bobince 的回答调用`getSeconds()`或类似方法来获取标准字符串格式的整数 - 尽管您应该小心持续时间为负数的情况，因为您可能希望输出字符串中有*一个*负号. 所以像：

```
public static String formatDuration(Duration duration) {
    long seconds = duration.getSeconds();
    long absSeconds = Math.abs(seconds);
    String positive = String.format(
        "%d:%02d:%02d",
        absSeconds / 3600,
        (absSeconds % 3600) / 60,
        absSeconds % 60);
    return seconds < 0 ? "-" + positive : positive;
} 
```

以这种方式格式化*相当*简单，如果手动的话。对于*解析*它通常变得更难......当然，如果你愿意，即使使用 Java 8，你仍然可以使用 Joda Time。

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2017-06-03T12:00:52.500

从 Java 9 开始这更容易。 A`Duration`仍然不可格式化，但添加了获取小时、分钟和秒的方法，这使得任务更加简单：

```
 LocalDateTime start = LocalDateTime.of(2019, Month.JANUARY, 17, 15, 24, 12);
    LocalDateTime end = LocalDateTime.of(2019, Month.JANUARY, 18, 15, 43, 33);
    Duration diff = Duration.between(start, end);
    String hms = String.format("%d:%02d:%02d", 
                                diff.toHours(), 
                                diff.toMinutesPart(), 
                                diff.toSecondsPart());
    System.out.println(hms); 
```

此代码段的输出是：

> 24:19:21

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2011-05-22T19:22:35.100

```
long duration = 4 * 60 * 60 * 1000;
SimpleDateFormat sdf = new SimpleDateFormat("HH:mm:ss.SSS", Locale.getDefault());
log.info("Duration: " + sdf.format(new Date(duration - TimeZone.getDefault().getRawOffset()))); 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2019-02-20T19:36:22.513

有一个相当简单和（IMO）优雅的方法，至少持续时间少于 24 小时：

`DateTimeFormatter.ISO_LOCAL_TIME.format(value.addTo(LocalTime.of(0, 0)))`

格式化程序需要一个时间对象来格式化，因此您可以通过将持续时间添加到 00:00（即午夜）的 LocalTime 来创建一个。这将为您提供一个 LocalTime 表示从午夜到该时间的持续时间，然后很容易以标准 HH:mm:ss 表示法格式化。这样做的好处是不需要外部库，使用 java.time 库进行计算，而不是手动计算时分秒。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2018-06-28T21:42:34.250

此答案仅使用`Duration`方法并适用于 Java 8 ：

```
public static String format(Duration d) {
    long days = d.toDays();
    d = d.minusDays(days);
    long hours = d.toHours();
    d = d.minusHours(hours);
    long minutes = d.toMinutes();
    d = d.minusMinutes(minutes);
    long seconds = d.getSeconds() ;
    return 
            (days ==  0?"":days+" jours,")+ 
            (hours == 0?"":hours+" heures,")+ 
            (minutes ==  0?"":minutes+" minutes,")+ 
            (seconds == 0?"":seconds+" secondes,");
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2020-09-02T18:35:30.943

我不确定这是你想要的，但请检查这个 Android 帮助程序类

```
import android.text.format.DateUtils 
```

例如：`DateUtils.formatElapsedTime()`

[android](/questions/tagged/android "显示标记为“android”的问题") [日期](/questions/tagged/date "显示标记为“日期”的问题") [持续时间](/questions/tagged/duration "显示标记为“持续时间”的问题") [经过时间](/questions/tagged/elapsedtime "显示标记为“已用时间”的问题")

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2015-01-25T00:31:06.620

这可能有点 hacky，但如果一个人一心想使用 Java 8 来实现这一点，这是一个很好的解决方案`java.time`：

```
import java.time.Duration;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeFormatterBuilder;
import java.time.temporal.ChronoField;
import java.time.temporal.Temporal;
import java.time.temporal.TemporalAccessor;
import java.time.temporal.TemporalField;
import java.time.temporal.UnsupportedTemporalTypeException;

public class TemporalDuration implements TemporalAccessor {
    private static final Temporal BASE_TEMPORAL = LocalDateTime.of(0, 1, 1, 0, 0);

    private final Duration duration;
    private final Temporal temporal;

    public TemporalDuration(Duration duration) {
        this.duration = duration;
        this.temporal = duration.addTo(BASE_TEMPORAL);
    }

    @Override
    public boolean isSupported(TemporalField field) {
        if(!temporal.isSupported(field)) return false;
        long value = temporal.getLong(field)-BASE_TEMPORAL.getLong(field);
        return value!=0L;
    }

    @Override
    public long getLong(TemporalField field) {
        if(!isSupported(field)) throw new UnsupportedTemporalTypeException(new StringBuilder().append(field.toString()).toString());
        return temporal.getLong(field)-BASE_TEMPORAL.getLong(field);
    }

    public Duration getDuration() {
        return duration;
    }

    @Override
    public String toString() {
        return dtf.format(this);
    }

    private static final DateTimeFormatter dtf = new DateTimeFormatterBuilder()
            .optionalStart()//second
            .optionalStart()//minute
            .optionalStart()//hour
            .optionalStart()//day
            .optionalStart()//month
            .optionalStart()//year
            .appendValue(ChronoField.YEAR).appendLiteral(" Years ").optionalEnd()
            .appendValue(ChronoField.MONTH_OF_YEAR).appendLiteral(" Months ").optionalEnd()
            .appendValue(ChronoField.DAY_OF_MONTH).appendLiteral(" Days ").optionalEnd()
            .appendValue(ChronoField.HOUR_OF_DAY).appendLiteral(" Hours ").optionalEnd()
            .appendValue(ChronoField.MINUTE_OF_HOUR).appendLiteral(" Minutes ").optionalEnd()
            .appendValue(ChronoField.SECOND_OF_MINUTE).appendLiteral(" Seconds").optionalEnd()
            .toFormatter();

} 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2016-09-06T09:00:35.000

这是另一个如何格式化持续时间的示例。请注意，此示例将正持续时间和负持续时间都显示为正持续时间。

```
import static java.time.temporal.ChronoUnit.DAYS;
import static java.time.temporal.ChronoUnit.HOURS;
import static java.time.temporal.ChronoUnit.MINUTES;
import static java.time.temporal.ChronoUnit.SECONDS;

import java.time.Duration;

public class DurationSample {
    public static void main(String[] args) {
        //Let's say duration of 2days 3hours 12minutes and 46seconds
        Duration d = Duration.ZERO.plus(2, DAYS).plus(3, HOURS).plus(12, MINUTES).plus(46, SECONDS);

        //in case of negative duration
        if(d.isNegative()) d = d.negated();

        //format DAYS HOURS MINUTES SECONDS 
        System.out.printf("Total duration is %sdays %shrs %smin %ssec.\n", d.toDays(), d.toHours() % 24, d.toMinutes() % 60, d.getSeconds() % 60);

        //or format HOURS MINUTES SECONDS 
        System.out.printf("Or total duration is %shrs %smin %sec.\n", d.toHours(), d.toMinutes() % 60, d.getSeconds() % 60);

        //or format MINUTES SECONDS 
        System.out.printf("Or total duration is %smin %ssec.\n", d.toMinutes(), d.getSeconds() % 60);

        //or format SECONDS only 
        System.out.printf("Or total duration is %ssec.\n", d.getSeconds());
    }
} 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2017-06-28T08:13:44.017

下面的函数怎么样，它返回 +H:MM:SS 或 +H:MM:SS.sss

```
public static String formatInterval(final long interval, boolean millisecs )
{
    final long hr = TimeUnit.MILLISECONDS.toHours(interval);
    final long min = TimeUnit.MILLISECONDS.toMinutes(interval) %60;
    final long sec = TimeUnit.MILLISECONDS.toSeconds(interval) %60;
    final long ms = TimeUnit.MILLISECONDS.toMillis(interval) %1000;
    if( millisecs ) {
        return String.format("%02d:%02d:%02d.%03d", hr, min, sec, ms);
    } else {
        return String.format("%02d:%02d:%02d", hr, min, sec );
    }
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-04-01T03:02:32.440

这是一个可行的选择。

```
public static String showDuration(LocalTime otherTime){          
    DateTimeFormatter df = DateTimeFormatter.ISO_LOCAL_TIME;
    LocalTime now = LocalTime.now();
    System.out.println("now: " + now);
    System.out.println("otherTime: " + otherTime);
    System.out.println("otherTime: " + otherTime.format(df));

    Duration span = Duration.between(otherTime, now);
    LocalTime fTime = LocalTime.ofNanoOfDay(span.toNanos());
    String output = fTime.format(df);

    System.out.println(output);
    return output;
} 
```

调用方法

```
System.out.println(showDuration(LocalTime.of(9, 30, 0, 0))); 
```

产生类似的东西：

```
otherTime: 09:30
otherTime: 09:30:00
11:31:27.463
11:31:27.463 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2020-12-30T01:51:46.620

您可以使用[`java.time.Duration`](https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html)它以[ISO-8601 标准](https://en.wikipedia.org/wiki/ISO_8601)为模型，并作为[JSR-310 实现](https://jcp.org/aboutJava/communityprocess/pfd/jsr310/JSR-310-guide.html)的一部分与*Java-8*一起引入。*Java-9*引入了一些更方便的方法。

 ***演示：**

```
import java.time.Duration;
import java.time.LocalDateTime;
import java.time.Month;

public class Main {
    public static void main(String[] args) {
        LocalDateTime startDateTime = LocalDateTime.of(2020, Month.DECEMBER, 10, 15, 20, 25);
        LocalDateTime endDateTime = LocalDateTime.of(2020, Month.DECEMBER, 10, 18, 24, 30);

        Duration duration = Duration.between(startDateTime, endDateTime);
        // Default format
        System.out.println(duration);

        // Custom format
        // ####################################Java-8####################################
        String formattedElapsedTime = String.format("%02d:%02d:%02d", duration.toHours() % 24,
                duration.toMinutes() % 60, duration.toSeconds() % 60);
        System.out.println(formattedElapsedTime);
        // ##############################################################################

        // ####################################Java-9####################################
        formattedElapsedTime = String.format("%02d:%02d:%02d", duration.toHoursPart(), duration.toMinutesPart(),
                duration.toSecondsPart());
        System.out.println(formattedElapsedTime);
        // ##############################################################################
    }
} 
```

**输出：**

```
PT3H4M5S
03:04:05
03:04:05 
```

**[从Trail: Date Time](https://docs.oracle.com/javase/tutorial/datetime/index.html)**了解现代日期时间 API 。

*   出于任何原因，如果您必须坚持使用 Java 6 或 Java 7，您可以使用[***ThreeTen-Backport，***](http://www.threeten.org/threetenbp/)它将大部分*java.time*功能向后移植到 Java 6 和 7。
*   如果您正在为一个 Android 项目工作并且您的 Android API 级别仍然不符合 Java-8，请通过 desugaring和[How to use ThreeTenABP in Android Project检查](https://stackoverflow.com/questions/38922754/how-to-use-threetenabp-in-android-project)[Java 8+ APIs available](https://developer.android.com/studio/write/java8-support-table)。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2021-01-05T21:13:30.977

还有另一种方法可以使其适用于 java8。但如果持续时间不超过 24 小时，它会起作用

```
public String formatDuration(Duration duration) {
    DateTimeFormatter formatter = DateTimeFormatter.ofPattern("h:mm.SSS");
    return LocalTime.ofNanoOfDay(duration.toNanos()).format(formatter);
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-04-24T01:55:54.760

```
String duration(Temporal from, Temporal to) {
    final StringBuilder builder = new StringBuilder();
    for (ChronoUnit unit : new ChronoUnit[]{YEARS, MONTHS, WEEKS, DAYS, HOURS, MINUTES, SECONDS}) {
        long amount = unit.between(from, to);
        if (amount == 0) {
            continue;
        }
        builder.append(' ')
                .append(amount)
                .append(' ')
                .append(unit.name().toLowerCase());
        from = from.plus(amount, unit);
    }
    return builder.toString().trim();
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-07-02T18:38:11.477

使用这个函数

```
private static String strDuration(long duration) {
    int ms, s, m, h, d;
    double dec;
    double time = duration * 1.0;

    time = (time / 1000.0);
    dec = time % 1;
    time = time - dec;
    ms = (int)(dec * 1000);

    time = (time / 60.0);
    dec = time % 1;
    time = time - dec;
    s = (int)(dec * 60);

    time = (time / 60.0);
    dec = time % 1;
    time = time - dec;
    m = (int)(dec * 60);

    time = (time / 24.0);
    dec = time % 1;
    time = time - dec;
    h = (int)(dec * 24);

    d = (int)time;

    return (String.format("%d d - %02d:%02d:%02d.%03d", d, h, m, s, ms));
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-11-14T17:59:02.513

我的库[Time4J](https://github.com/MenoData/Time4J)提供了一个基于模式的解决方案（类似于`Apache DurationFormatUtils`，但更灵活）：

```
Duration<ClockUnit> duration =
    Duration.of(-573421, ClockUnit.SECONDS) // input in seconds only
    .with(Duration.STD_CLOCK_PERIOD); // performs normalization to h:mm:ss-structure
String fs = Duration.formatter(ClockUnit.class, "+##h:mm:ss").format(duration);
System.out.println(fs); // output => -159:17:01 
```

此代码演示了处理小时溢出和符号处理的功能，另请参见[基于模式](http://time4j.net/javadoc-en/net/time4j/Duration.Formatter.html#ofPattern-java.lang.Class-java.lang.String-)的 duration-formatter API 。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-10-26T04:58:42.250

这是`java.time.Duration`在 Kotlin 中将 a 转换为漂亮字符串的单行代码：

```
duration.run {
   "%d:%02d:%02d.%03d".format(toHours(), toMinutesPart(), toSecondsPart(), toMillisPart())
} 
```

示例输出： `120:56:03.004`

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2020-06-19T09:04:52.040

在 scala 中（我看到了一些其他的尝试，并没有留下深刻的印象）：

```
def formatDuration(duration: Duration): String = {
  import duration._ // get access to all the members ;)
  f"$toDaysPart $toHoursPart%02d:$toMinutesPart%02d:$toSecondsPart%02d:$toMillisPart%03d"
} 
```

看起来很可怕是吗？这就是为什么我们使用 IDE 来编写这些东西，以便方法调用（`$toHoursPart`等）是不同的颜色。

`f"..."`是`printf`/样式的`String.format`字符串插值器（这是允许`$`代码注入工作的原因）给定输出`1 14:06:32.583`，`f`插值字符串将等效于`String.format("1 %02d:%02d:%02d.%03d", 14, 6, 32, 583)`

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2021-02-05T15:54:39.243

查看所有这些计算，大多数单位（小时、分钟等）都有一个`.toFooPart()`方便的方法可能会有所帮助。

例如

```
Duration.ofMinutes(110L).toMinutesPart() == 50 
```

读取：到父单位（小时）的下一个值所经过的分钟数。

* * *

## 回答 #21

> 赞同：-3
> 
> 时间：2018-10-25T14:52:06.970

在 Scala 中，建立在 YourBestBet 的解决方案之上，但简化了：

```
def prettyDuration(seconds: Long): List[String] = seconds match {
  case t if t < 60      => List(s"${t} seconds")
  case t if t < 3600    => s"${t / 60} minutes" :: prettyDuration(t % 60)
  case t if t < 3600*24 => s"${t / 3600} hours" :: prettyDuration(t % 3600)
  case t                => s"${t / (3600*24)} days" :: prettyDuration(t % (3600*24))
}

val dur = prettyDuration(12345).mkString(", ") // => 3 hours, 25 minutes, 45 seconds 
```

* * *

## 回答 #22

> 赞同：-4
> 
> 时间：2018-04-03T11:11:54.590

在 scala 中，不需要库：

```
def prettyDuration(str:List[String],seconds:Long):List[String]={
  seconds match {
    case t if t < 60 => str:::List(s"${t} seconds")
    case t if (t >= 60 && t< 3600 ) => List(s"${t / 60} minutes"):::prettyDuration(str, t%60)
    case t if (t >= 3600 && t< 3600*24 ) => List(s"${t / 3600} hours"):::prettyDuration(str, t%3600)
    case t if (t>= 3600*24 ) => List(s"${t / (3600*24)} days"):::prettyDuration(str, t%(3600*24))
  }
}
val dur = prettyDuration(List.empty[String], 12345).mkString("") 
```

# python - 在 Tor 中使用 Python 的 smtplib

> ID：266849
> 
> 赞同：2
> 
> 时间：2008-11-05T21:50:04.180
> 
> 标签：python, smtp, tor

我正在进行有关垃圾邮件的实验。其中一项实验需要通过 Tor 发送邮件。由于我使用 Python 和 smtplib 进行实验，因此我正在寻找一种使用 Tor 代理（或其他方法）来执行邮件发送的方法。想法如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-08T20:37:17.777

由于垃圾邮件发送者的滥用，许多 Tor 出口节点拒绝发送端口 25 (SMTP) 流量，因此您可能会遇到问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-13T13:37:47.323

[http://bent.latency.net/smtpprox/](http://bent.latency.net/smtpprox/)我之前发现了这个，但还没有尝试过

# php - MySQL 服务器大量休眠连接的可能原因？

> ID：266850
> 
> 赞同：2
> 
> 时间：2008-11-05T21:50:19.923
> 
> 标签：php, mysql, codeigniter, connection

与 MySQL 服务器的大量睡眠连接的可能原因是什么？我正在使用禁用持久连接的 CodeIgniter。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T21:53:22.177

即使应用程序不会保持连接打开，操作系统也会让它闲逛。见[http://www.mysqlperformanceblog.com/2006/11/12/are-php-persistent-connections-evil/](http://www.mysqlperformanceblog.com/2006/11/12/are-php-persistent-connections-evil/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T21:53:17.530

可能是超时问题

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T21:53:18.607

默认情况下，代码点火器不使用连接池吗？如果是这样，它会抓住一堆并抓住它们直到需要它们。

# c++ - 为什么有时在类中定义 C++ 方法？

> ID：266854
> 
> 赞同：10
> 
> 时间：2008-11-05T21:51:28.670
> 
> 标签：c++, optimization, compiler-construction, inline-functions

我经常在 C++ 中遇到大型的非模板类，其中简单方法直接在头文件的类主体中定义，而不是在实现文件中单独定义。例如：

```
class Foo {
  int getBar() const { return bar; }
  ...
}; 
```

为什么要这样做？好像有缺点。实现没有应有的隐藏，代码可读性较差，如果类的头文件包含在许多不同的地方，也会增加编译器的负担。

我的猜测是人们打算将这些函数内联到其他模块中，这可以显着提高性能。但是，我听说较新的编译器可以在跨模块的链接时进行内联（和其他过程间优化）。对这种链接时优化的支持有多广泛，它实际上是否使这些定义变得不必要？这些定义还有其他充分的理由吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-05T21:53:49.633

C++ 标准规定在类定义中定义的方法是`inline`默认的。这会为 getter 和 setter 等简单函数带来明显的性能提升。链接时跨模块优化更难，尽管一些编译器可以做到。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-05T21:59:30.090

通常没有其他原因，只是更容易并节省时间。它还在实现文件中节省了一点混乱，同时在头文件中占用了相同数量的行。如果它仅限于 getter 和 setter 之类的东西，那么可读性就会降低。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T21:52:32.197

您回答了自己的问题，它们确实是内联方法。

使用它们的原因是性能。

# ruby-on-rails - 如何在 Rails 插件中测试视图？

> ID：266857
> 
> 赞同：5
> 
> 时间：2008-11-05T21:52:13.863
> 
> 标签：ruby-on-rails, ruby, testing, plugins, actionview

我正在编写一个包含一些部分的 Rails 插件。我想测试部分，但我很难设置一个可以渲染它们的测试。没有关联的控制器，所以我只是假装一个：

```
require 'action_controller'
require 'active_support'
require 'action_pack'
require 'action_view'

class MyTest < Test::Unit::TestCase
  def setup
    @renderer = ActionController::Base.new
    @renderer.append_view_path File.expand_path(File.join(File.dirname(__FILE__), '..', 'views'))
  end

  def test_renders_link
    result = @renderer.render(:partial => '/something')
    assert ...
  end
end 
```

但是这个`:render`电话总是会爆炸。我尝试过使用 an`ActionView::Base`而不是 an `ActionController::Base`，但效果更差。

有没有人成功过？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T21:55:51.050

结帐 ActionView::TestCase - [http://api.rubyonrails.org/classes/ActionView/TestCase.html](http://api.rubyonrails.org/classes/ActionView/TestCase.html)

您还可以使用这些来测试助手，我发现这非常有帮助。

RSpec 还有一种测试视图的方法：[http ://rspec.info/documentation/rails/writing/views.html](http://rspec.info/documentation/rails/writing/views.html)

希望有帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T23:21:51.250

最终答案：

```
require 'action_controller'
require 'active_support'
require 'action_pack'
require 'action_view'
require 'action_controller/test_case'

class StubController < ActionController::Base
  helper MyHelper
  append_view_path '...'
  attr_accessor :thing
  def my_partial
    render :partial => '/my_partial', :locals => { :thing => thing }
  end
  def rescue_action(e) raise e end;
end

class MyTestCase < ActionController::TestCase
  self.controller_class = StubController
  def setup
    @controller.thing = ...
    get :my_partial
    assert ...
  end
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T22:57:41.877

我得到的最接近的是

```
require 'action_controller'
require 'active_support'
require 'action_pack'
require 'action_view'
require 'action_controller/test_case'

class StubController < ActionController::Base
  append_view_path '...'
  def _renderizer;  render params[:args];  end
  def rescue_action(e) raise e end;
end

class MyTest < ActionController::TestCase
  self.controller_class = StubController
  def render(args);  get :_renderizer, :args => args;  end 
  def test_xxx
    render :partial => ...
  end
end 
```

但我现在收到一个路由错误：`ActionController::RoutingError: No route matches {:action=>"_renderizer", :controller=>"", :args=>{:locals=>{:...}, :partial=>"/my_partial"}}`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-06T02:35:32.203

我建议您查看[resource_controller 插件](http://github.com/giraffesoft/resource_controller)的代码。我还在其他一些插件中看到了这种方法。

答案很简单，在**test**目录中，您创建一个使用您的插件的应用程序。从那里，您只需使用常用工具来测试 Rails 视图。

如果您的插件没有很多不同的用例，则测试应用程序可以非常简单。对于更复杂的插件，例如 resource_controller，您可能需要创建很多不同的控制器等等。

要欺骗您的测试应用程序加载您的插件，最简单的方法是在测试应用程序的插件目录中创建一个指向 r_c 目录根目录的链接。这不适用于 Windows，仅适用于 POSIX 操作系统。

# c++ - 为什么 c++ 中 char 和 bool 的大小相同？

> ID：266870
> 
> 赞同：33
> 
> 时间：2008-11-05T21:54:31.100
> 
> 标签：c++, boolean

我正在阅读*C++ 编程语言。*Stroustrup 在其中指出`sizeof(char) == 1`和`1 <= sizeof(bool)`。具体取决于实施。为什么像布尔值这样简单的值会占用与字符相同的空间？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-11-05T22:00:12.087

在现代计算机体系结构中，字节是内存的最小可寻址单元。要将多个位打包到一个字节中，需要应用额外的位移操作。在编译器级别，这是内存与速度要求的权衡（在高性能软件中，那些额外的位移操作可能会不必要地增加和减慢应用程序的速度）。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-11-05T22:02:22.707

因为在 C++ 中，您可以获取布尔值的地址，而大多数机器无法寻址单个位。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-05T21:56:20.440

它占用相同的空间，因为您可以在内存中写入的最小空间量是单个字节。两个值都存储在一个字节中。尽管理论上您只需要 1 位来表示布尔值，但您仍然必须有一个完整的字节来存储该值。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-05T21:56:45.073

从理论上讲，布尔值只需要一个位，但是处理少于 1 个字节的数据是很麻烦的。你需要更多的指令来完成任何事情，而你并没有真正受益。

如果要将多个布尔值打包到一个字节中，可以使用[位域结构](http://en.wikipedia.org/wiki/Bit_field)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-06T11:17:24.987

字节是内存的最小可寻址单元。

考虑以下代码：

```
 bool b[9];
    bool *pb0 = &b[0];
    bool *pb1 = &b[1];

    for (int counter=0; counter<9; ++counter)
    {
         // some code here to fill b with values
         b[counter] = true;

    } 
```

如果 bool 存储为 1 位，则 pb0 将等于 pb1，因为两者具有相同的地址。这显然是不可取的！

此外，循环中的赋值将导致非平凡的汇编代码。它将在循环的每次迭代中涉及不同的位移。在高性能软件中，那些额外的位移操作会不必要地减慢应用程序的速度。

STL 库在空间确实很重要的情况下提供了一种解决方法。使用 std::vector<bool> 会将 bool 存储为 1 位。上面例子的悖论不适用，因为

*   operator[] 的重载隐藏了位移操作的严格性
*   使用迭代器代替指针为实现提供了额外的灵活性

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-05T22:04:01.313

实际上，在我所知道的大多数实现中，sizeof(bool) == sizeof(int)。“int”旨在成为 CPU 使用效率最高的数据大小。因此，没有特定大小的事物（如“char”）与 int 大小相同。如果每个对象有大量它们，您可能希望实现一种打包它们以进行存储的方法，但在正常计算期间，它应该保留其原始大小。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-05T22:09:03.487

C++中有一个叫做vector的东西，它试图利用理论上你可以在一个字符中存储8个布尔值的事实，但它被C++标准委员会广泛认为是一个错误。“有效的stl”这本书实际上说“不要使用它”。这应该让你知道它是多么棘手。

顺便说一句：Knuth 有一[本书](http://www-cs-faculty.stanford.edu/~knuth/fasc1a.ps.gz)专门介绍按位运算。Boost 还有一个专门用于以更高效的内存方式处理大量位的[库。](http://www.boost.org/doc/libs/1_37_0/libs/dynamic_bitset/dynamic_bitset.html)

# c# - 线程池导致 GUI 冻结（？）

> ID：266872
> 
> 赞同：0
> 
> 时间：2008-11-05T21:55:29.677
> 
> 标签：c#, .net, threadpool

我注意到，如果我的 IO 密集型应用程序的 ThreadPool 最大线程数设置得太低 (16)，那么我的 GUI 将冻结。但是如果我将它设置得更高（250），它就可以了。

谁能解释这种现象？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-05T21:57:16.320

哇！除非您知道自己在做什么，否则不要弄乱 ThreadPool 计数 - 许多基本的 .NET 服务可能正在使用它，并且依赖它不会饱和。您几乎可以肯定通过饱和使一些基本 IO 代码陷入僵局。

我想在这种特殊情况下是 IO 完成端口让你绊倒......

Joe Duffy（他比我更了解线程）在[这里](http://www.bluebytesoftware.com/blog/PermaLink,guid,ca22a5a8-a3c9-4ee8-9b41-667dbd7d2108.aspx)对此有一些想法。

重新如何通过饱和来死锁——这在思想实验中很容易重现；假设你有一些工作代码需要做 2 件事……我们将其中 1 件推送到 ThreadPool 上，然后自己做一件；在完成我们自己的工作之后，我们将 Join() [或等效的 ThreadPool] 第二个任务，以便我们知道两者都已完成。

现在想象我们在最后一个可用的 ThreadPool 线程上启动这个工作代码：我们做我们自己的工作，然后等待第二个任务已经完成的信号——但是没有可用的线程来做它！我们不能释放我们自己的，因为我们还在等待。

您可以对 IO 完成端口执行相同操作。

# configuration - Vim 文件资源管理器配置

> ID：266874
> 
> 赞同：2
> 
> 时间：2008-11-05T21:55:38.367
> 
> 标签：configuration, plugins, vim

我在我的 vimrc 中设置以下变量来控制当我为 vim 调出文件资源管理器插件时如何拆分窗口。但似乎这些变量没有被读取，因为它们对文件资源管理器窗口的显示方式没有影响。我是 vim 的新手。我知道正在读取 vimrc 文件，因为我可以进行其他设置更改并且它们被拾取但这些不起作用。我错过了什么？

`let g:explWinSize=10`

`let g:explSplitBelow=1`

`let g:explDetailedHelp=0`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-06T19:27:08.743

无论您从哪里获得这些设置都是过时的。它们在 vim 6.x 中有效，但在 7.x 中无效。

对于 7.x，请改用以下设置：

```
let g:netrw_winsize=10
let g:netrw_alto=1 
```

我无法找到禁用“详细帮助”的选项，但是 netrw 在 v6 和 v7 中提供的帮助无论如何都是完全不同的。阅读 :h netrw 了解更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T22:04:18.693

在您的 vimrc 文件旁边创建一个 gvimrc 并在其中添加这些设置。

# css - 在基于 Gecko 的浏览器中消失的 CSS 表格单元格边框

> ID：266877
> 
> 赞同：8
> 
> 时间：2008-11-05T21:55:51.953
> 
> 标签：css, firefox, html-table, border, gecko

我有一个非常具体的 html 表格结构，似乎揭示了 Gecko 错误。

这是问题的提炼版本。在基于 gecko 的浏览器（例如 FF）中观察下表：（您必须将其复制并粘贴到新文件中）

```
<style>
table.example{
    border-collapse:collapse;
}
table.example td {
    border:1px solid red;
}
</style>
<table class="example">
    <thead>
        <tr>
            <th>1</th>
            <th>2</th>
            <th>3</th>          
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>2</td>
            <td rowspan="3">3</td>

        </tr>
        <tr>
            <td>1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>1</td>
            <td rowspan="2">2</td>      
        </tr>
        <tr>
            <td>1</td>
            <td>3</td>
        </tr>
    </tbody>
</table> 
```

右下角单元格中的“3”上缺少一行 - 在任何其他浏览器中查看它，该行将按预期显示。有趣的是，放弃表格的 thead 部分，看看我们得到了什么：

```
<style>
table.example{
    border-collapse:collapse;
}
table.example td {
    border:1px solid red;
}
</style>
<table class="example">
    <tbody>
        <tr>
            <td>1</td>
            <td>2</td>
            <td rowspan="3">3</td>

        </tr>
        <tr>
            <td>1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>1</td>
            <td rowspan="2">2</td>      
        </tr>
        <tr>
            <td>1</td>
            <td>3</td>
        </tr>
    </tbody>
</table> 
```

这样做可以使它起作用。有人见过这个吗？我想我现在将摆脱我的 thead 部分作为一种解决方法，尽管它使表格不太容易访问。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T22:05:35.570

奇怪……绝对是画虫。如果您右键单击以使上下文菜单出现在该行的*部分*位置上，那么当您关闭上下文菜单时，该行已在下方重新绘制。

编辑：解决方法 - 如果你穿上你可以让边框`style="border-color: ...;"`出现`<td rowspan="3">`，但它必须是*不同*的颜色 - 只需使用尽可能接近其他颜色的颜色。例如，如果表是#ff0000，则使用#ff0001

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-25T13:54:18.010

我也发现了这个错误，但它不在我的电脑上，而是在另一个电脑上。如果我在某个分辨率后调整浏览器窗口的大小，这些线条将消失。一旦我最大化窗口，所有弹出。你可以通过设置border-collapse:separate来永久修复这个问题；这使每个单元的每个边框都有自己的宽度。这不是我想做的，但它有效。

它也可能是由使用border-collapse:collapse引起的；然后将对齐边框设置为 1px，然后设置为 0px。因为它折叠了边框，所以它似乎优先考虑 0px 超过 1px 宽度。

无论哪种方式，它都只是 Firefox，这是远离它的另一个原因。

# codeigniter - 是否值得升级到最新版本的 CodeIgniter？

> ID：266878
> 
> 赞同：0
> 
> 时间：2008-11-05T21:56:02.047
> 
> 标签：codeigniter, upgrade

我落后了大约 2 个小修改。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-10T06:41:01.583

我是那些总是升级东西的人之一。但是请查看官方[更新日志](http://codeigniter.com/user_guide/changelog.html)，看看许多错误修复和新功能是否对您来说足够有趣。

我注意到 1.7.0 已经发布，我肯定会升级。但我需要在升级后测试我的应用程序，因为更改*可能会*破坏现有代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T12:03:39.437

如果有一些新功能你会觉得有用，或者它修复了一些一直困扰你的错误，绝对是。如果您只是落后于次要版本，则可能没有太多升级的理由。

检查[changelog](http://codeigniter.com/user_guide/changelog.html)，如果有你感兴趣的东西，然后升级。

我想“如果它没有坏，就不要修复它”的说法仍然适用，但如果它是一个小的个人项目，为什么不玩一下新的更闪亮的版本呢？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T18:34:23.503

我升级了，有一些很酷的新功能，比如表单验证类，你不再有 2 行用于规则和字段。

以下是 Validation 类中的一些更改，例如：

### 第一个是您加载验证库的任何地方。

旧的/不推荐使用的方法： $this->load->library('validation');

新方法：$this->load->library('form_validation');

### 您还需要更改字段和规则声明：

旧的/不推荐使用的方法： $rules['name'] = “trim|required|max_length[100]”; $fields['name'] = “你的名字”;

新方法：$this->form_validation->set_rules('name', 'your name', 'trim|required|max_length[100]');

### 最后，更改条件检查：

旧的/不推荐使用的方法： if ($this->validation->run() == TRUE) {}

新方法：if ($this->form_validation->run() == TRUE) {}

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T11:13:15.670

我总是留意最新版本，尤其是我的一个宠物项目。我升级到 1.7.0 时出现了一个问题，它破坏了我使用 CI 会话的身份验证过程。

我最终使用本机会话构建了自己的 Auth 库。

# msbuild - MSBuild 将另一个项目的输出复制到当前项目的输出中

> ID：266888
> 
> 赞同：9
> 
> 时间：2008-11-05T21:58:15.367
> 
> 标签：msbuild, msbuild-task

我有一种情况，我想使用 MSBuild 将输出程序集从一个项目复制到目标应用程序的输出目录中，而在我的 MSBuild Copy 任务中没有硬编码路径。这是场景：

*   项目 A - Web 应用程序项目
*   项目 B - Dal 接口项目
*   项目 C - Dal 实施项目

还有一个业务层，但与我要解决的 MSBuild 问题无关。

我的业务层引用了我的 Dal.Interface 项目。我的 Web 项目引用了业务层，就目前而言，进行构建会将业务层和 Dal.Interface 项目拉入输出。到现在为止还挺好。现在，为了让 Web 应用程序运行，它需要 Dal 实现。我不希望在任何地方引用实现，因为我想强制对接口进行编码并且没有引用意味着它不会出现在智能感知等中。

所以我想我可以通过 MSBuild 复制操作作为 AfterBuild 任务来处理这个问题（我有 Dal 实现设置要在 Web 项目构建时构建，只是没有被引用）。我不想在 MSBuild 参数中硬编码路径或其他任何内容，因此我试图弄清楚如何从 Web 应用程序项目的 MSBuild 文件中引用 Dal 项目的输出。

所以基于上面提到的项目，这是我希望看到的：

1.  Web 应用程序构建开始
2.  所有必需的项目构建（已经配置，所以完成）
3.  MSBuild“AfterBuild”任务启动，项目 C（Dal 实现）的输出被复制到项目 A（Web 应用程序）的 Bin 目录

第 3 部分是我卡住的地方。

我确信这是可以做到的，我只是没有找到一个很好的参考来帮助。提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-05T22:24:11.787

我已经完成了这项工作，尽管我很想找到一个更简洁的解决方案，利用 MSBuild 中的内置参数（如 $(TargetDir) 等，但指向我想要获取输出的项目）。无论如何，这是我所做的：

```
<Target Name="AfterBuild">
<Copy SourceFiles="$(SolutionDir)MyProject.Dal.Linq\bin\$(Configuration)\MyProject.Dal.Linq.dll" DestinationFolder="$(TargetDir)"/>
</Target> 
```

我很想看到一个更清洁的解决方案，但现在应该这样做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-01-27T09:52:01.880

所以，你想有一个参考，但在 VS 中看不到它。因此，您希望在需要时构建它，并像任何其他`Content`文件一样复制到输出。以下是你的做法：

```
<Target Name="IncludeDALImplementation" BeforeTargets="AfterBuild">
  <MSBuild Projects="..\DalImplementation\DAL.csproj" BuildInParallel="$(BuildInParallel)" Targets="Build">
    <Output TaskParameter="TargetOutputs" ItemName="DalImplementationOutput" />
  </MSBuild>

  <ItemGroup>
    <Content Include="@(DalImplementationOutput)" />
  </ItemGroup>
</Target> 
```

# c# - 通过继承改变返回签名——多态性

> ID：266901
> 
> 赞同：1
> 
> 时间：2008-11-05T22:03:57.693
> 
> 标签：c#, .net, polymorphism

只是想知道是否有任何方法可以执行以下操作：

```
public Interface IDataField 
{
    object GetValue();
}

public Interface IComplexDataField : IDataField
{
    object GetDefaultValue();
}

public class MyBase
{
    private IDataField _DataField;

    public MyBase()
    {
        this._DataField = this.CreateDataField();
    }

    public virtual IDataField CreateDataField()
    {
        return new DataField(); //Implements IDataField 
    }

    **public virtual IDataField GetDataField()**
    {
        return this._DataField;
    }

    public void SomeMethod()
    {
        this.GetDataField().GetValue();
    }
}

public class MyComplexBase : MyBase
{
    public override IDataField CreateDataField()
    {
        return new ComplexDataField(); //Implements IComplexDataField which Implements IDataField 
    }

    **public override IComplexDataField GetDataField()**
    {
        return (IComplexDataField)base.GetDataField();
    }

    public void SomeComplexSpecificMethod()
    {
        this.GetDataField().GetValue();
        this.GetDataField().GetDefaultValue();
    }
} 
```

干杯安东尼

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T22:07:55.847

你想要的是*返回类型的协方差*。这在 C# 中不存在。

你能不能`MyBase`通用：

```
public class MyBase<T> where T : IDataField
{
    public virtual T CreateDataField()
    {
        ... etc ...
    }
} 
```

或者，您可以使用“new”重新声明该方法并隐藏基类方法。两者都不是特别吸引人...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T22:09:00.790

在 C# 3.0 中最接近的方法是拥有一个单独的`virtual`方法（如您的`CreateDataField`方法），它可以完成实际工作并且可以被覆盖，然后用于`new`重新声明公共方法。即在基地：

```
public IDataField GetDataField()
{
    return GetDataFieldImpl();
}
protected virtual IDataField GetDataFieldImpl()
{
    // return a basic version
} 
```

在子类中：

```
protected override IDataField GetDataFieldImpl()
{
    // do something more fun
}
public new IComplexDataField GetDataField()
{
    return (IComplexDataField)GetDataFieldImpl();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T22:17:51.893

您尝试做的是称为协变返回类型。它们在当前版本的 C# 中不存在，但有传言说它将在下一个版本中引入。

您最好的方法在这里解释：[协变返回类型](http://srtsolutions.com/blogs/billwagner/archive/2005/06/17/covaraint-return-types-in-c.aspx)

```
public class MyBase<T> where T : IDataField, new()
{
    public virtual T CreateDataField()
    {
        return new T();
    }

    public virtual T GetDataField()
    {
        return this._DataField;
    }

}

public class MyComplexBase : MyBase<ComplexDataField>
{
   ...
} 
```

# java - 在 Java 中创建具有默认值的 Annotation 实例

> ID：266903
> 
> 赞同：37
> 
> 时间：2008-11-05T22:04:06.463
> 
> 标签：java, annotations, instantiation

如何创建以下注释的实例（所有字段都设置为默认值）。

```
 @Retention( RetentionPolicy.RUNTIME )
    public @interface Settings {
            String a() default "AAA";
            String b() default "BBB";
            String c() default "CCC";
    } 
```

我试过`new Settings()`了，但这似乎不起作用......

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2011-08-15T16:40:37.850

要创建一个实例，您需要创建一个实现：

*   [`java.lang.annotation.Annotation`](https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Annotation.html)
*   以及您要“模拟”的注释

例如： `public class MySettings implements Annotation, Settings`

但是你需要特别注意**正确**的实现`equals`和`hashCode`根据`Annotation`接口。 [http://download.oracle.com/javase/1.5.0/docs/api/java/lang/annotation/Annotation.html](http://download.oracle.com/javase/1.5.0/docs/api/java/lang/annotation/Annotation.html)

如果您不想一次又一次地实现这一点，请查看[javax.enterprise.util.AnnotationLiteral](http://docs.jboss.org/cdi/api/1.0/javax/enterprise/util/AnnotationLiteral.html)类。这是 CDI（上下文依赖注入）-API 的一部分。 [（@见代码）](http://grepcode.com/file/repo1.maven.org/maven2/javax.enterprise/cdi-api/1.0/javax/enterprise/util/AnnotationLiteral.java)

要获取默认值，您可以使用 akuhn（以前称为：Adrian）描述的方式。 `Settings.class.getMethod("a").getDefaultValue()`

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-03-05T03:18:33.153

您无法创建实例，但至少获取默认值

```
Settings.class.getMethod("a").getDefaultValue()
Settings.class.getMethod("b").getDefaultValue()
Settings.class.getMethod("c").getDefaultValue() 
```

然后，可以使用动态代理返回默认值。也就是说，据我所知，Java 本身也处理注释的方式。

```
class Defaults implements InvocationHandler {
  public static <A extends Annotation> A of(Class<A> annotation) {
    return (A) Proxy.newProxyInstance(annotation.getClassLoader(),
        new Class[] {annotation}, new Defaults());
  }
  public Object invoke(Object proxy, Method method, Object[] args)
      throws Throwable {
    return method.getDefaultValue();
  }
}

Settings s = Defaults.of(Settings.class);
System.out.printf("%s\n%s\n%s\n", s.a(), s.b(), s.c()); 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2010-05-26T03:41:53.903

我在下面编译并运行，结果令人满意。

```
class GetSettings {
    public static void main (String[] args){
      @Settings final class c { }
      Settings settings = c.class.getAnnotation(Settings.class);
      System.out.println(settings.aaa());
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-06-13T13:50:43.567

有同样的问题，我解决了如下。

```
public static FieldGroup getDefaultFieldGroup() {
    @FieldGroup
    class settring {
    }
    return settring.class.getAnnotation(FieldGroup.class);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-05T22:20:24.587

如果与方法一起使用：

```
@Settings
public void myMethod() {
} 
```

现在您的注释已使用默认值初始化。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-07-11T16:18:37.393

如果您有能力更改`Settings`课程主体，还有其他解决方案：

```
@Retention( RetentionPolicy.RUNTIME )
public @interface Settings {
        String DEFAULT_A = "AAA";
        String DEFAULT_B = "BBB";
        String DEFAULT_C = "CCC";

        String a() default DEFAULT_A;
        String b() default DEFAULT_B;
        String c() default DEFAULT_C;
} 
```

然后您可以简单地引用`Settings.DEFAULT_A`（是的，更好的名称会有所帮助！）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-17T08:36:22.243

这适用于 Sun/Oracle Java 5、6、7、8：（但由于涉及的 sun 类，可能会与 Java 9 中断）。//edit 刚刚验证这仍然适用于 OpenJDK 9b59。

```
package demo;

import sun.reflect.annotation.AnnotationParser;

import java.lang.annotation.*;
import java.lang.reflect.Method;
import java.util.Collections;
import java.util.HashMap;
import java.util.Map;

public class AnnotationProxyExample
{

    public static void main(String[] args)
    {

        System.out.printf("Custom annotation creation: %s%n", 
                createAnnotationInstance(Collections.singletonMap("value", "required"), Example.class));

        System.out.printf("Traditional annotation creation: %s%n", 
                X.class.getAnnotation(Example.class));
    }

    private static <A extends Annotation> A createAnnotationInstance(Map<String, Object> customValues, Class<A> annotationType)
    {

        Map<String, Object> values = new HashMap<>();

        //Extract default values from annotation
        for (Method method : annotationType.getDeclaredMethods())
        {
            values.put(method.getName(), method.getDefaultValue());
        }

        //Populate required values
        values.putAll(customValues);

        return (A) AnnotationParser.annotationForMap(annotationType, values);
    }

    @Example("required")
    static class X
    {
    }

    @Retention(RetentionPolicy.RUNTIME)
    @Target(ElementType.TYPE)
    @interface Example
    {
        String value();
        int foo() default 42;
        boolean bar() default true;
    }
} 
```

输出：

```
Custom annotation creation: @demo.AnnotationProxyExample$Example(bar=true, foo=42, value=required)
Traditional annotation creation: @demo.AnnotationProxyExample$Example(bar=true, foo=42, value=required) 
```

# java - 在 Windows 上从 Java 到 C++ 的高效数据传输

> ID：266913
> 
> 赞同：7
> 
> 时间：2008-11-05T22:08:50.680
> 
> 标签：java, c++, pipe, fifo

我希望将大量数据（高达 ~1 Gbit）从 Java 流式传输到 C++ 应用程序（都在同一台机器上）。我目前在 Linux 上使用 FIFO，但也需要 Windows 解决方案。

最跨平台的方法似乎是本地套接字，但是：a）我不会从 TCP 校验和和从内核空间复制到 & 中获得巨大的开销，并且 b）普通用户的防火墙不会尝试检查和也许阻止连接？

似乎更安全的解决方案可能是使用 JNI 和命名管道 API (\.\pipe\blah)，使连接双方的平台特定混乱不堪。

这些真的是我的两个最佳选择吗（人们会推荐哪一个？）谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-05T23:12:48.727

你应该看看Google 的[Protocol Buffers](http://code.google.com/apis/protocolbuffers/docs/tutorials.html)，它支持 C++ 和 Java。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-05T22:16:26.173

命名管道会比 TCP 更有效，但是只使用**共享内存**块怎么样？

我不知道 Java 端存在哪些与共享内存接口的原语，但从 C++ 端来看，访问共享内存中的数据比从套接字或命名管道中读取数据更有效。您必须实现自己的流量控制和阻塞原语，但这些可能相当简单。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-05T22:18:50.020

我会使用本地套接字，正如您所说，这是最跨平台的方法。

内核用户空间副本不应该成为问题，因为您可以选择的任何其他方法都需要这种副本，除了共享内存。它在每个 Unix 系统上都可用，Windows 也有它的[方法](http://msdn.microsoft.com/en-us/library/aa366551(VS.85).aspx)

要在 Java 中使用共享内存，唯一的方法是通过您自己的 .DLL/.SO 和 JNI 来实现它来访问它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-18T04:57:25.980

您最快的解决方案将是内存映射共享内存段，并且它们实现环形缓冲区或其他消息传递机制。在 C++ 中这是直截了当的，而在 Java 中，您可以使用[FileChannel.map](http://java.sun.com/j2se/1.4.2/docs/api/java/nio/channels/FileChannel.html#map(java.nio.channels.FileChannel.MapMode,%20long,%20long))方法使其成为可能。

下一个替代方法是使用两个进程的标准输入/标准输出。如果一个可以执行另一个，这可能会非常快。

最后，正如您所指出的，您可以进行套接字 IO。对于流式视频，这不是一个很好的选择，但如果您传递 XML，与其他处理相比，开销将是最小的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-24T14:01:03.323

如果它是“一个”函数调用中的一大块数据，我会推荐 JNI。

看看这个：[通过 jni 接口共享输出流](http://codeforfun.wordpress.com/2010/04/22/sharing-output-streams-through-a-jni-interface/)

文章中的片段，它将数据从 c++ 传输到 java，相反也很容易做到：

总之，从 C 语言与 Java 共享二进制数据（A/V 文件、图像等）的一般策略需要字节数组。在 C 中创建一个 Java 字节数组，如下所示：

```
const char[] rawData = {0,1,2,3,4,5,6,7,8,9}; //Or get some raw data from somewhere
int dataSize = sizeof(rawData);
printf("Building raw data array copy\n");
jbyteArray rawDataCopy = env->NewByteArray(dataSize);
env->SetByteArrayRegion(rawDataCopy, 0, dataSize, rawData); 
```

并像这样将它传递给Java：

```
printf("Finding callback method\n");
//Assumes obj is the Java instance that will receive the raw data via callback
jmethodID aMethodId = env->GetMethodID(env->GetObjectClass(obj),"handleData","([B)V");
if(0==aMethodId) throw MyRuntimeException("Method not found error");
printf("Invoking the callback\n");
env->CallVoidMethod(obj,aMethodId, &rawDataCopy); 
```

你会有一个看起来像这样的 Java 对象：

```
public class MyDataHandler {
  OutputStream dataStream;
  public MyDataHandler(OutputStream writeTo) { dataStream = writeTo;}
  public void handleData(byte[] incomingData) { dataStream.write(incomingData); }
} 
```

该处理程序将通过本机方法传递给 C，如下所示：

```
public class NativeIntegration {
  public native void generateBinaryWithHandler(MyDataHandler handler);

  //Here we assume response is something like a network stream
  public void doCallNativeFunction(ResponseStream response) {
    MyDataHandler handler = new MyDataHandler(response);
    generateBinaryWithHandler(handler);
  }
} 
```

此外，您可以使用其他技术：CORBA、ASN.1（[ASN.1 工具](http://www.obj-sys.com/asn1-compiler.shtml?gclid=CPTMn7-j0qMCFYp_5QoddCXxtQ)）、UDP 或 TCP

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T10:56:20.850

如果您对编写 JNI 感到满意，请考虑[Boost.Interprocess](http://www.boost.org/doc/libs/1_37_0/doc/html/interprocess.html)。这将为您提供 Linux 和 Windows 上的可移植共享内存。请记住，没有用于读取/写入共享内存的内核往返。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-05T22:59:52.357

如果 TCP 的比特率太高，我会使用带有否定确认 UDP 的本地套接字（尽管我会先尝试 TCP 并确认这是一个问题）。如果您在同一台机器上进行流式传输，应该有最少的数据包丢失（如果有的话），但是添加否定确认层将为您解决这种情况。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-05T23:04:48.570

使用 System.out 和 System.in 怎么样？

如果这不合适，那么 Sockets 是您最好的选择。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-05T23:23:38.563

如果您的 C++ 进程启动 Java 进程，它可能会受益于[继承](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/channels/spi/SelectorProvider.html#inheritedChannel())的Channel 。此外，如果 Java 进程正在使用文件，我建议探索[transferTo](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/channels/FileChannel.html#transferTo(long,%20long,%20java.nio.channels.WritableByteChannel))和[transferFrom](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/channels/FileChannel.html#transferFrom(java.nio.channels.ReadableByteChannel,%20long,%20long))方法。在进行文件到文件 IO 时，这些避免了用户和内核空间之间不必要的来回切换；如果您使用特殊的套接字通道，可能会启动相同的优化。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-06T01:24:51.703

我推荐一个 UDP“连接”，它确认接收到的每 N 个数据包都没有错误，并请求重新传输它将丢失的几个数据包。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2008-11-05T22:30:22.260

我建议不要使用 JNI，因为它很难调试。如果 C++ 代码出现段错误或抛出未捕获的异常，您的 JVM 将崩溃，您将不知道原因。

# javascript - Flash 电影可以将鼠标事件传递给包含页面吗？

> ID：266921
> 
> 赞同：4
> 
> 时间：2008-11-05T22:10:54.623
> 
> 标签：javascript, css, flash, actionscript-3, mouse

我们的一个较新产品是一个walk-on 视频系统，其中一个角色出现在一个绝对定位的DIV 中并给出一个小演示。我们使用的是 Flash 9、AS3。不幸的是，为了让他出现在网站内容的前面，我们需要将他的 Z-index 设置为高于页面内容的值。

在某些网站和浏览器大小上，他会屏蔽部分网站界面。如果我们在其中有 walkon 视频，这会使某些网站基本上无法使用。有没有办法将 Flash 电影捕获的鼠标悬停和单击事件传递给包含页面，以便仍然可以访问下面的导航？

我正在考虑编写一个巨大的丑陋 Javascript 模块，它将遍历所有页面元素并调用它们的 onClick，如果它们在 Flash 电影中的鼠标位置下......但这样的方法将不一致并且非常笨拙。帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-06T14:37:36.847

这是一个在 flash 和 javascript 之间拖放的[演示。](http://enobrev.info/drag/ "拖放演示")也许你可以使用类似的东西（这里是[源代码](http://enobrev.info/drag/src/ "源代码")）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T22:15:24.863

您可能还会有其他乐趣，例如您的透明区域在某些 linux 安装（几乎所有我使用过的）上不会是透明的，尤其是在 64 位下（Adobe 完全错在这里）。

此外，在这些系统上，不可能在 flash 中执行 javascript。

像我这样的人 /loathe/ flash 并简单地阻止它运行是有原因的。

以上都是你需要考虑的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T22:28:22.327

在这里跳出框框思考...

你能设置你的角色，让它在鼠标移过它时重新定位吗？这样，当用户想要单击它时，它将远离它所覆盖的任何控件。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-06T15:48:16.267

如果动画妨碍他们（或者如果他们认为这很烦人），您还可以让用户选择隐藏动画。

当然，如果动画提供了关键信息，则您需要一个非动画替代方案，但如果您想支持移动用户，则需要它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-06T08:06:25.437

我的第一个想法是最小化动画占用的区域，使闪光灯尽可能小。我怀疑用户会意识到他们无法点击动画本身，如果您将边界框保持在最低限度，这将在一定程度上解决问题。我假设你需要这个人走动一下，也许你可以通过使用javascript在页面周围移动实际的flash“窗口”来解决这个问题。

最简单的选择是在鼠标悬停时简单地隐藏动画，让点击通过这种方式。

# c# - 使用 StringBuilder Remove 方法是否比在循环中创建新的 StringBuilder 更节省内存？

> ID：266923
> 
> 赞同：8
> 
> 时间：2008-11-05T22:11:04.827
> 
> 标签：c#, memory-leaks, garbage-collection, stringbuilder

在 C# 中哪个内存效率更高：选项 #1 或选项 #2？

```
public void TestStringBuilder()
{
    //potentially a collection with several hundred items:
    string[] outputStrings = new string[] { "test1", "test2", "test3" };

    //Option #1
    StringBuilder formattedOutput = new StringBuilder();
    foreach (string outputString in outputStrings)
    {
        formattedOutput.Append("prefix ");
        formattedOutput.Append(outputString);
        formattedOutput.Append(" postfix");

        string output = formattedOutput.ToString();
        ExistingOutputMethodThatOnlyTakesAString(output);

        //Clear existing string to make ready for next iteration:
        formattedOutput.Remove(0, output.Length);
    }

    //Option #2
    foreach (string outputString in outputStrings)
    {
        StringBuilder formattedOutputInsideALoop = new StringBuilder();

        formattedOutputInsideALoop.Append("prefix ");
        formattedOutputInsideALoop.Append(outputString);
        formattedOutputInsideALoop.Append(" postfix");

        ExistingOutputMethodThatOnlyTakesAString(
           formattedOutputInsideALoop.ToString());
    }
}

private void ExistingOutputMethodThatOnlyTakesAString(string output)
{
    //This method actually writes out to a file.
    System.Console.WriteLine(output);
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T21:48:21.627

一些答案温和地建议我摆脱困境并自己弄清楚，所以下面是我的结果。我认为这种情绪通常与本网站的宗旨背道而驰，但如果你想把事情做好，你不妨这样做...... :)

我修改了选项 #1 以利用 @Ty 建议使用 StringBuilder.Length = 0 而不是 Remove 方法。这使得两个选项的代码更加相似。两个区别现在是 StringBuilder 的构造函数是在循环内还是在循环外，而选项 #1 现在使用 Length 方法来清除 StringBuilder。这两个选项都设置为在具有 100,000 个元素的 outputStrings 数组上运行，以使垃圾收集器完成一些工作。

几个答案提供了查看各种 PerfMon 计数器等的提示，并使用结果来选择一个选项。我做了一些研究，最终使用了我在工作中使用的 Visual Studio Team Systems Developer 版本的内置性能资源管理器。我找到了一个多部分系列的第二个博客条目，它解释了如何在[此处](http://blogs.msdn.com/ianhu/archive/2005/02/11/371418.aspx)进行设置。基本上，你连接一个单元测试来指向你想要分析的代码；通过向导和一些配置；并启动单元测试分析。我启用了 .NET 对象分配和生命周期指标。分析的结果很难为这个答案格式化，所以我把它们放在最后。如果您将文本复制并粘贴到 Excel 中并稍微修改它们，它们将是可读的。

选项#1 的内存效率最高，因为它使垃圾收集器做的工作少了一点，并且与选项#2 相比，它为StringBuilder 对象分配了一半的内存和实例。对于日常编码，选择选项 #2 非常好。

如果您仍在阅读，我问了这个问题，因为选项 #2 将使经验丰富的 C/C++ 开发人员的内存泄漏检测器变得弹道。如果 StringBuilder 实例在重新分配之前没有释放，将会发生巨大的内存泄漏。当然，我们 C# 开发人员并不担心这些事情（直到他们跳起来咬我们）。谢谢大家！！

* * *

```
ClassName   Instances   TotalBytesAllocated Gen0_InstancesCollected Gen0BytesCollected  Gen1InstancesCollected  Gen1BytesCollected
=======Option #1                    
System.Text.StringBuilder   100,001 2,000,020   100,016 2,000,320   2   40
System.String   301,020 32,587,168  201,147 11,165,268  3   246
System.Char[]   200,000 8,977,780   200,022 8,979,678   2   90
System.String[] 1   400,016 26  1,512   0   0
System.Int32    100,000 1,200,000   100,061 1,200,732   2   24
System.Object[] 100,000 2,000,000   100,070 2,004,092   2   40
======Option #2                 
System.Text.StringBuilder   200,000 4,000,000   200,011 4,000,220   4   80
System.String   401,018 37,587,036  301,127 16,164,318  3   214
System.Char[]   200,000 9,377,780   200,024 9,379,768   0   0
System.String[] 1   400,016 20  1,208   0   0
System.Int32    100,000 1,200,000   100,051 1,200,612   1   12
System.Object[] 100,000 2,000,000   100,058 2,003,004   1   20 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-05T22:16:09.153

选项 2 应该（我相信）实际上优于选项 1。调用`Remove`“强制”StringBuilder 获取它已经返回的字符串的副本的行为。字符串在 StringBuilder 中实际上是可变的，除非需要，否则 StringBuilder 不会复制。使用选项 1，它在基本上清除阵列之前复制 - 使用选项 2 不需要复制。

选项 2 的唯一缺点是，如果字符串最终很长，则在追加时将生成多个副本 - 而选项 1 保持缓冲区的原始大小。但是，如果是这种情况，请指定初始容量以避免额外的复制。（在您的示例代码中，字符串最终将大于默认的 16 个字符 - 将其初始化为 32 的容量将减少所需的额外字符串。）

然而，除了性能之外，选项 2 更简洁。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-05T23:49:55.780

在进行分析时，您也可以尝试在进入循环时将 StringBuilder 的长度设置为零。

```
formattedOutput.Length = 0; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-05T23:41:56.593

由于您只关心内存，我建议：

```
foreach (string outputString in outputStrings)
    {    
        string output = "prefix " + outputString + " postfix";
        ExistingOutputMethodThatOnlyTakesAString(output)  
    } 
```

名为 output 的变量在您的原始实现中具有相同的大小，但不需要其他对象。StringBuilder 在内部使用字符串和其他对象，您将创建许多需要 GC 的对象。

选项 1 中的两条线：

```
string output = formattedOutput.ToString(); 
```

选项 2 中的行：

```
ExistingOutputMethodThatOnlyTakesAString(
           formattedOutputInsideALoop.ToString()); 
```

将使用前缀 + outputString + 后缀的值创建一个*不可变对象。*无论您如何创建此字符串，它的大小都是相同的。您真正要问的是哪个内存效率更高：

```
 StringBuilder formattedOutput = new StringBuilder(); 
    // create new string builder 
```

或者

```
 formattedOutput.Remove(0, output.Length); 
    // reuse existing string builder 
```

完全跳过 StringBuilder 将比上述任何一个都更节省内存。

如果您真的需要知道两者中哪一个在您的应用程序中更有效（这可能会根据您的列表、前缀和输出字符串的大小而有所不同）我会推荐 red-gate ANTS Profiler [http://www.red- gate.com/products/ants_profiler/index.htm](http://www.red-gate.com/products/ants_profiler/index.htm "http://www.red-gate.com/products/ants_profiler/index.htm")

杰森

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-05T22:19:28.613

讨厌这么说，但只是测试它怎么样？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-05T22:27:52.140

这些东西很容易自己找出来。运行 Perfmon.exe 并为 .NET Memory + Gen 0 Collections 添加一个计数器。运行测试代码一百万次。您会看到选项 #1 需要的集合数量是选项 #2 所需的一半。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-05T22:34:23.390

我们[之前用 Java 讨论过这个](https://stackoverflow.com/questions/242438/java-performance-of-stringbuilder-in-a-loop)，这里是 C# 版本的 [Release] 结果：

```
Option #1 (10000000 iterations): 11264ms
Option #2 (10000000 iterations): 12779ms 
```

更新：在我的非科学分析中，允许这两种方法在监视 perfmon 中的所有内存性能计数器的同时执行并不会导致任何一种方法的明显差异（除了只有在任一测试执行时才会出现一些计数器尖峰）。

这是我曾经测试过的：

```
class Program
{
    const int __iterations = 10000000;

    static void Main(string[] args)
    {
        TestStringBuilder();
        Console.ReadLine();
    }

    public static void TestStringBuilder()
    {
        //potentially a collection with several hundred items:
        var outputStrings = new [] { "test1", "test2", "test3" };

        var stopWatch = new Stopwatch();

        //Option #1
        stopWatch.Start();
        var formattedOutput = new StringBuilder();

        for (var i = 0; i < __iterations; i++)
        {
            foreach (var outputString in outputStrings)
            {
                formattedOutput.Append("prefix ");
                formattedOutput.Append(outputString);
                formattedOutput.Append(" postfix");

                var output = formattedOutput.ToString();
                ExistingOutputMethodThatOnlyTakesAString(output);

                //Clear existing string to make ready for next iteration:
                formattedOutput.Remove(0, output.Length);
            }
        }
        stopWatch.Stop();

        Console.WriteLine("Option #1 ({1} iterations): {0}ms", stopWatch.ElapsedMilliseconds, __iterations);
            Console.ReadLine();
        stopWatch.Reset();

        //Option #2
        stopWatch.Start();
        for (var i = 0; i < __iterations; i++)
        {
            foreach (var outputString in outputStrings)
            {
                StringBuilder formattedOutputInsideALoop = new StringBuilder();

                formattedOutputInsideALoop.Append("prefix ");
                formattedOutputInsideALoop.Append(outputString);
                formattedOutputInsideALoop.Append(" postfix");

                ExistingOutputMethodThatOnlyTakesAString(
                   formattedOutputInsideALoop.ToString());
            }
        }
        stopWatch.Stop();

        Console.WriteLine("Option #2 ({1} iterations): {0}ms", stopWatch.ElapsedMilliseconds, __iterations);
    }

    private static void ExistingOutputMethodThatOnlyTakesAString(string s)
    {
        // do nothing
    }
} 
```

尽管选项 2 更易于阅读和维护，但此方案中的选项 1 稍微快一些。除非您碰巧连续数百万次执行此操作，否则我会坚持使用选项 2，因为我怀疑选项 1 和 2 在单次迭代中运行时大致相同。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-05T22:13:46.473

如果肯定更直接，我会说选项＃2。就性能而言，听起来像是您只需要测试和查看的东西。我猜想选择不太直接的选项并没有足够的区别。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-05T22:31:32.867

我认为选项 1 会稍微提高**内存**效率，因为不是每次都创建一个新对象。话虽如此，GC 在清理资源方面做得非常好，就像在选项 2 中一样。

我认为您可能陷入过早优化的陷阱（[万恶之源--Knuth](http://en.wikipedia.org/wiki/Code_optimization#Quotes)）。您的 IO 将比字符串生成器占用更多的资源。

我倾向于使用更清晰/更清洁的选项，在这种情况下是选项 2。

抢

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-06T15:55:16.503

1.  测量它
2.  预分配尽可能接近您认为需要的内存量
3.  如果速度是您的偏好，那么考虑一个相当直接的多线程从前到中、中到端的并发方法（根据需要扩展分工）
4.  再次测量

什么对你更重要？

1.  记忆

2.  速度

3.  明晰

# sql - 使用 T-SQL 从日月和年创建日期

> ID：266924
> 
> 赞同：274
> 
> 时间：2008-11-05T22:12:00.487
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我正在尝试将具有单个部分（例如 12、1、2007）的日期转换为 SQL Server 2005 中的日期时间。我尝试了以下方法：

```
CAST(DATEPART(year, DATE)+'-'+ DATEPART(month, DATE) +'-'+ DATEPART(day, DATE) AS DATETIME) 
```

但这会导致错误的日期。将三个日期值转换为正确的日期时间格式的正确方法是什么。

* * *

## 回答 #1

> 赞同：345
> 
> 时间：2008-11-05T22:45:04.413

试试这个：

```
Declare @DayOfMonth TinyInt Set @DayOfMonth = 13
Declare @Month TinyInt Set @Month = 6
Declare @Year Integer Set @Year = 2006
-- ------------------------------------
Select DateAdd(day, @DayOfMonth - 1, 
          DateAdd(month, @Month - 1, 
              DateAdd(Year, @Year-1900, 0))) 
```

它也工作得很好，增加了不进行任何字符串转换的好处，所以它是纯算术处理（非常快）并且它不依赖于任何日期格式这利用了 SQL Server 对 datetime 和 smalldatetime 值的内部表示是两个部分值，第一部分是一个整数，表示自 1900 年 1 月 1 日以来的天数，第二部分是小数部分，表示一天的小数部分（时间）--- 所以整数值 0（零) 总是直接翻译成 1900 年 1 月 1 日午夜的早晨...

或者，感谢@brinary 的建议，

```
Select DateAdd(yy, @Year-1900,  
       DateAdd(m,  @Month - 1, @DayOfMonth - 1)) 
```

2014 年 10 月编辑。正如 @cade Roux 所指出的，SQL 2012 现在有一个内置函数：
`DATEFROMPARTS(year, month, day)`
做同样的事情。

2016 年 10 月 3 日编辑，（感谢 @bambams 注意到这一点，并感谢 @brinary 修复它），最后一个解决方案，由 @brinary 提出。除非首先执行年份加法，否则似乎不适用于闰年

```
select dateadd(month, @Month - 1, 
     dateadd(year, @Year-1900, @DayOfMonth - 1)); 
```

* * *

## 回答 #2

> 赞同：258
> 
> 时间：2012-04-13T14:42:54.163

SQL Server 2012 有一个美妙且期待已久的新 DATEFROMPARTS 函数（如果日期无效，它将引发错误 - 我主要反对基于 DATEADD 的解决方案来解决此问题）：

[http://msdn.microsoft.com/en-us/library/hh213228.aspx](http://msdn.microsoft.com/en-us/library/hh213228.aspx)

```
DATEFROMPARTS(ycolumn, mcolumn, dcolumn) 
```

或者

```
DATEFROMPARTS(@y, @m, @d) 
```

* * *

## 回答 #3

> 赞同：180
> 
> 时间：2008-11-05T22:17:30.117

假设`y, m, d`都是`int`，怎么样：

```
CAST(CAST(y AS varchar) + '-' + CAST(m AS varchar) + '-' + CAST(d AS varchar) AS DATETIME) 
```

请参阅我对 SQL Server 2012 及更高版本[的其他答案](https://stackoverflow.com/a/10142966/18255)

* * *

## 回答 #4

> 赞同：119
> 
> 时间：2011-03-04T04:48:04.947

或者只使用一个 dateadd 函数：

```
DECLARE @day int, @month int, @year int
SELECT @day = 4, @month = 3, @year = 2011

SELECT dateadd(mm, (@year - 1900) * 12 + @month - 1 , @day - 1) 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2013-10-04T22:56:37.803

Sql Server 2012 有一个函数可以根据部件 ( [DATEFROMPARTS](http://technet.microsoft.com/en-us/library/hh213228.aspx) ) 创建日期。对于我们其他人来说，这是我创建的一个数据库函数，它将确定零件的日期（感谢@Charles）...

```
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[func_DateFromParts]'))
    DROP FUNCTION [dbo].[func_DateFromParts]
GO

CREATE FUNCTION [dbo].[func_DateFromParts]
(
    @Year INT,
    @Month INT,
    @DayOfMonth INT,
    @Hour INT = 0,  -- based on 24 hour clock (add 12 for PM :)
    @Min INT = 0,
    @Sec INT = 0
)
RETURNS DATETIME
AS
BEGIN

    RETURN DATEADD(second, @Sec, 
            DATEADD(minute, @Min, 
            DATEADD(hour, @Hour,
            DATEADD(day, @DayOfMonth - 1, 
            DATEADD(month, @Month - 1, 
            DATEADD(Year, @Year-1900, 0))))))

END

GO 
```

你可以这样称呼它...

```
SELECT dbo.func_DateFromParts(2013, 10, 4, 15, 50, DEFAULT) 
```

返回...

```
2013-10-04 15:50:00.000 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-11-05T22:15:38.810

尝试 CONVERT 而不是 CAST。

CONVERT 允许使用第三个参数来指示日期格式。

格式列表在这里：http: [//msdn.microsoft.com/en-us/library/ms187928.aspx](http://msdn.microsoft.com/en-us/library/ms187928.aspx)

在另一个答案被选为“正确”答案后更新：

我真的不明白为什么选择的答案显然取决于您服务器上的 NLS 设置，但没有说明此限制。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2016-05-06T03:24:17.423

你也可以使用

```
select DATEFROMPARTS(year, month, day) as ColDate, Col2, Col3 
From MyTable Where DATEFROMPARTS(year, month, day) Between @DateIni and @DateEnd 
```

自 2012 版起在 SQL 和 AzureSQL 中工作

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2012-06-25T10:19:56.643

使用显式起点 '19000101' 更安全、更整洁

```
create function dbo.fnDateTime2FromParts(@Year int, @Month int, @Day int, @Hour int, @Minute int, @Second int, @Nanosecond int)
returns datetime2
as
begin
    -- Note! SQL Server 2012 includes datetime2fromparts() function
    declare @output datetime2 = '19000101'
    set @output = dateadd(year      , @Year - 1900  , @output)
    set @output = dateadd(month     , @Month - 1    , @output)
    set @output = dateadd(day       , @Day - 1      , @output)
    set @output = dateadd(hour      , @Hour         , @output)
    set @output = dateadd(minute    , @Minute       , @output)
    set @output = dateadd(second    , @Second       , @output)
    set @output = dateadd(ns        , @Nanosecond   , @output)
    return @output
end 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-11-05T22:23:42.303

如果您不想将字符串排除在外，这也可以（将其放入函数中）：

```
DECLARE @Day int, @Month int, @Year int
SELECT @Day = 1, @Month = 2, @Year = 2008

SELECT DateAdd(dd, @Day-1, DateAdd(mm, @Month -1, DateAdd(yy, @Year - 2000, '20000101'))) 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-01-31T14:21:06.167

**如果您需要日期和时间部分**的日期时间，我会添加一个单行解决方案：

```
select dateadd(month, (@Year -1900)*12 + @Month -1, @DayOfMonth -1) + dateadd(ss, @Hour*3600 + @Minute*60 + @Second, 0) + dateadd(ms, @Millisecond, 0) 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-10-24T14:33:07.017

尝试

```
CAST(STR(DATEPART(year, DATE))+'-'+ STR(DATEPART(month, DATE)) +'-'+ STR(DATEPART(day, DATE)) AS DATETIME) 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-12-08T09:46:59.587

对于低于 12 的 SQL Server 版本，我可以推荐`CAST`结合使用`SET DATEFORMAT`

```
-- 26 February 2015
SET DATEFORMAT dmy
SELECT CAST('26-2-2015' AS DATE)

SET DATEFORMAT ymd
SELECT CAST('2015-2-26' AS DATE) 
```

如何创建这些字符串取决于您

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-06-26T18:41:51.953

我知道 OP 要求 SQL 2005 的答案，但这个问题已经很老了，所以如果你运行的是 SQL 2012 或更高版本，你可以使用以下命令：

```
SELECT DATEADD(DAY, 1, EOMONTH(@somedate, -1)) 
```

参考： [https ://docs.microsoft.com/en-us/sql/t-sql/functions/eomonth-transact-sql?view=sql-server-2017&viewFallbackFrom=sql-server-previousversions](https://docs.microsoft.com/en-us/sql/t-sql/functions/eomonth-transact-sql?view=sql-server-2017&viewFallbackFrom=sql-server-previousversions)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-03-08T04:46:55.587

试试这个查询：

```
 SELECT SUBSTRING(CONVERT(VARCHAR,JOINGDATE,103),7,4)AS
    YEAR,SUBSTRING(CONVERT(VARCHAR,JOINGDATE,100),1,2)AS
MONTH,SUBSTRING(CONVERT(VARCHAR,JOINGDATE,100),4,3)AS DATE FROM EMPLOYEE1 
```

结果：

```
2014    Ja    1
2015    Ja    1
2014    Ja    1
2015    Ja    1
2012    Ja    1
2010    Ja    1
2015    Ja    1 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-04-29T12:03:06.100

我个人更喜欢子字符串，因为它提供了清理选项和根据需要拆分字符串的能力。假设数据的格式为“dd, mm, yyyy”。

```
--2012 and above
SELECT CONCAT (
        RIGHT(REPLACE(@date, ' ', ''), 4)
        ,'-'
        ,RIGHT(CONCAT('00',SUBSTRING(REPLACE(@date, ' ', ''), CHARINDEX(',', REPLACE(@date, ' ', '')) + 1, LEN(REPLACE(@date, ' ', '')) - CHARINDEX(',', REPLACE(@date, ' ', '')) - 5)),2)
        ,'-'
        ,RIGHT(CONCAT('00',SUBSTRING(REPLACE(@date, ' ', ''), 1, CHARINDEX(',', REPLACE(@date, ' ', '')) - 1)),2)
        )

--2008 and below
SELECT   RIGHT(REPLACE(@date, ' ', ''), 4)
        +'-'
        +RIGHT('00'+SUBSTRING(REPLACE(@date, ' ', ''), CHARINDEX(',', REPLACE(@date, ' ', '')) + 1, LEN(REPLACE(@date, ' ', '')) - CHARINDEX(',', REPLACE(@date, ' ', '')) - 5),2)
        +'-'
        +RIGHT('00'+SUBSTRING(REPLACE(@date, ' ', ''), 1, CHARINDEX(',', REPLACE(@date, ' ', '')) - 1),2) 
```

这是一个演示，如果数据存储在列中，它如何被起诉。不用说，在应用于列之前检查结果集是理想的

```
DECLARE @Table TABLE (ID INT IDENTITY(1000,1), DateString VARCHAR(50), DateColumn DATE)

INSERT INTO @Table
SELECT'12, 1, 2007',NULL
UNION
SELECT'15,3, 2007',NULL
UNION
SELECT'18, 11 , 2007',NULL
UNION
SELECT'22 , 11, 2007',NULL
UNION
SELECT'30, 12, 2007  ',NULL

UPDATE @Table
SET DateColumn = CONCAT (
        RIGHT(REPLACE(DateString, ' ', ''), 4)
        ,'-'
        ,RIGHT(CONCAT('00',SUBSTRING(REPLACE(DateString, ' ', ''), CHARINDEX(',', REPLACE(DateString, ' ', '')) + 1, LEN(REPLACE(DateString, ' ', '')) - CHARINDEX(',', REPLACE(DateString, ' ', '')) - 5)),2)
        ,'-'
        ,RIGHT(CONCAT('00',SUBSTRING(REPLACE(DateString, ' ', ''), 1, CHARINDEX(',', REPLACE(DateString, ' ', '')) - 1)),2)
        ) 

SELECT ID,DateString,DateColumn
FROM @Table 
```

# entity-framework - 属性设置器为内部时 ADO.NET 数据服务实体框架请求错误

> ID：266927
> 
> 赞同：2
> 
> 时间：2008-11-05T22:13:22.217
> 
> 标签：entity-framework, service, ado.net

使用实体框架数据模型公开 ADO.NET 数据服务时，我收到一条错误消息，该模型包含一个实体（称为“Case”），该实体在属性上具有内部设置器。如果我将设置器修改为公开的（使用实体设计器），则数据服务可以正常工作。

我不需要数据服务中公开的实体“Case”，因此我尝试使用 SetEntitySetAccessRule 限制公开哪些实体。这不起作用，服务端点失败并出现同样的错误。

```
public static void InitializeService(IDataServiceConfiguration config)
{
    config.SetEntitySetAccessRule("User", EntitySetRights.AllRead);
} 
```

调用 .svc 终结点时在浏览器中报告错误消息。它非常通用，显示为“请求错误。服务器在处理请求时遇到错误。有关更多详细信息，请参阅服务器日志。” 不幸的是，系统和应用程序事件日志中没有条目。

我发现了这个[stackoverflow 问题](https://stackoverflow.com/questions/54380/problem-rolling-out-adonet-data-service-application-to-iis)，它显示了如何在服务上配置跟踪。这样做之后，跟踪日志中报告了以下 NullReferenceExceptoin 错误。

有谁知道在包含具有内部设置器的实体时如何避免此异常？

```
<E2ETraceEvent xmlns="http://schemas.microsoft.com/2004/06/E2ETraceEvent">
<System xmlns="http://schemas.microsoft.com/2004/06/windows/eventlog/system">
<EventID>131076</EventID>
<Type>3</Type>
<SubType Name="Error">0</SubType>
<Level>2</Level>
<TimeCreated SystemTime="2008-11-05T22:30:44.1523578Z" />
<Source Name="System.ServiceModel" />
<Correlation ActivityID="{da77ee97-960f-4275-a5e7-a181c0b024b1}" />
<Execution ProcessName="WebDev.WebServer" ProcessID="6388" ThreadID="8" />
<Channel />
<Computer>MOTOJIM</Computer>
</System>
<ApplicationData>
<TraceData>
<DataItem>
<TraceRecord xmlns="http://schemas.microsoft.com/2004/10/E2ETraceEvent/TraceRecord" Severity="Error">
<TraceIdentifier>http://msdn.microsoft.com/en-US/library/System.ServiceModel.Diagnostics.TraceHandledException.aspx</TraceIdentifier>
<Description>Handling an exception.</Description>
<AppDomain>685a2910-19-128703978432492675</AppDomain>
<Exception>
<ExceptionType>System.NullReferenceException, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</ExceptionType>
<Message>Object reference not set to an instance of an object.</Message>
<StackTrace>
at System.Data.Services.Providers.ObjectContextServiceProvider.PopulateMemberMetadata(ResourceType resourceType, MetadataWorkspace workspace, IDictionary`2 entitySets, IDictionary`2 knownTypes)
at System.Data.Services.Providers.ObjectContextServiceProvider.PopulateMetadata(IDictionary`2 knownTypes, IDictionary`2 entitySets)
at System.Data.Services.Providers.BaseServiceProvider.PopulateMetadata()
at System.Data.Services.DataService`1.CreateProvider(Type dataServiceType, Object dataSourceInstance, DataServiceConfiguration&amp; configuration)
at System.Data.Services.DataService`1.EnsureProviderAndConfigForRequest()
at System.Data.Services.DataService`1.ProcessRequestForMessage(Stream messageBody)
at SyncInvokeProcessRequestForMessage(Object , Object[] , Object[] )
at System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object instance, Object[] inputs, Object[]&amp; outputs)
at System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp; rpc)
at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc&amp; rpc)
at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc&amp; rpc)
at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc&amp; rpc)
at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc&amp; rpc)
at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc&amp; rpc)
at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean isOperationContextSet)
</StackTrace>
<ExceptionString>System.NullReferenceException: Object reference not set to an instance of an object.
   at System.Data.Services.Providers.ObjectContextServiceProvider.PopulateMemberMetadata(ResourceType resourceType, MetadataWorkspace workspace, IDictionary`2 entitySets, IDictionary`2 knownTypes)
   at System.Data.Services.Providers.ObjectContextServiceProvider.PopulateMetadata(IDictionary`2 knownTypes, IDictionary`2 entitySets)
   at System.Data.Services.Providers.BaseServiceProvider.PopulateMetadata()
   at System.Data.Services.DataService`1.CreateProvider(Type dataServiceType, Object dataSourceInstance, DataServiceConfiguration&amp; configuration)
   at System.Data.Services.DataService`1.EnsureProviderAndConfigForRequest()
   at System.Data.Services.DataService`1.ProcessRequestForMessage(Stream messageBody)
   at SyncInvokeProcessRequestForMessage(Object , Object[] , Object[] )
   at System.ServiceModel.Dispatcher.SyncMethodInvoker.Invoke(Object instance, Object[] inputs, Object[]&amp; outputs)
   at System.ServiceModel.Dispatcher.DispatchOperationRuntime.InvokeBegin(MessageRpc&amp; rpc)
   at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage5(MessageRpc&amp; rpc)
   at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage4(MessageRpc&amp; rpc)
   at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage3(MessageRpc&amp; rpc)
   at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage2(MessageRpc&amp; rpc)
   at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.ProcessMessage1(MessageRpc&amp; rpc)
   at System.ServiceModel.Dispatcher.MessageRpc.Process(Boolean isOperationContextSet)</ExceptionString>
</Exception>
</TraceRecord>
</DataItem>
</TraceData>
</ApplicationData>
</E2ETraceEvent> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-06-22T04:51:37.723

我最近遇到了类似的问题，我的解决方法是将 EntitySetAccessRule 的名称更改为“*”，如下所示：

```
public static void InitializeService(DataServiceConfiguration config)
{
  config.SetEntitySetAccessRule("*", EntitySetRights.All);
  config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-07T18:39:32.007

我有一个类似的问题，它是由错误的类传递给 DataService 引起的。您需要传递数据模型的数据实体类。

```
public class WebDataService : DataService< DataModel.DataEntities > 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-02-19T04:04:10.580

我遇到过由 EF6 引起的类似问题。

根据[这篇文章](http://blogs.msdn.com/b/odatateam/archive/2013/10/02/using-wcf-data-services-5-6-0-with-entity-framework-6.aspx)改变

```
public class WebDataService : DataService< DataModel.DataEntities > 
```

至

```
public class WebDataService : EntityFrameworkDataService< DataModel.DataEntities > 
```

应该有帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-16T14:28:25.043

我也遇到了同样的问题，结果发现解决方案非常简单：虽然我的表名和生成的实体对象是单数的“Order”，但在这种情况下我需要将其称为“Orders”。仍然让我头疼。只是EDM标准。

```
config.SetEntitySetAccessRule("Orders", EntitySetRights.All); 
```

希望这可以帮助。

# nginx - 如何配置 nginx 以使用 Jetty6 网络服务器？

> ID：266931
> 
> 赞同：14
> 
> 时间：2008-11-05T22:15:13.723
> 
> 标签：nginx, jetty

似乎nginx与php、ruby和python一起使用。

任何人都有一个如何设置 nginx 以在后端使用 jetty/tomcat 的示例？

谢谢。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-05T23:03:15.470

对。我想我有资格成为自学者，不是吗。

只需在 nginx.conf 文件的 http { } 范围内添加这些行：

```
server {
        listen          80;
        server_name     mydomain.com www.mydomain.com;
        access_log      /var/log/nginx_67_log main;
        location / {
                proxy_pass      http://127.0.0.1:8080;
                proxy_redirect  off;
                proxy_set_header        Host            $host;
                proxy_set_header        X-Real-IP       $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        }
} 
```

我现在必须尝试 gzip、SSL 和 dojo cometd，看看是否可以升级到 nginx。欢迎提供任何线索。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-05T23:02:40.773

nginx 可以通过 HTTP 协议转发，因此只需将其指向正确的端口即可：

```
server {
    location /anything {
        proxy_pass http://localhost:8080/whatever;
    }
} 
```

# eclipse-plugin - 部署新开发的 Eclipse 插件

> ID：266935
> 
> 赞同：24
> 
> 时间：2008-11-05T22:16:06.343
> 
> 标签：eclipse-plugin, eclipse-pde

我编写了一个 Eclpise 插件（CDT 的错误解析器），它在 eclipse 的调试器版本中工作得很好。但是，我终其一生都无法弄清楚如何将插件安装到 Eclipse 中。我可以将插件导出为 jar 文件，并且似乎导出没有错误。我将插件 jar 文件放入 eclipse\dropins 中，eclipse 没有加载它。如果我将它添加到插件目录，那就没有运气了。features 目录似乎也忽略了我的插件。

所以我想，好吧，我会尝试通过 GUI 安装它。所以我浏览到插件存档的位置并将其添加为本地更新站点，但 eclipse 抱怨那里没有插件。

我很沮丧。请帮忙。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-01-14T16:03:40.857

将插件放入 eclipse/plugins 文件夹应该可以。如果没有，这通常意味着 Eclipse 出于性能原因缓存了插件配置。您可以通过使用**-clean**命令行参数启动 Eclipse 来强制 Eclipse 重新扫描插件目录以进行更改。

Eclipse 的典型部署机制是使用特性。一项功能包括插件（在您的情况下，可能只有一个），并且可以通过 Eclipse 更新管理器安装。要使用功能部署插件，您将执行以下操作：

1.  创建一个功能项目，并使用功能编辑器将您的插件添加到功能中。
2.  创建一个更新站点项目，并使用更新站点编辑器将您的功能添加到更新站点。
3.  构建更新站点。这将创建一个 site.xml 文件、一个 features 文件夹和一个 plugins 文件夹。

然后，您应该能够将 Eclipse 更新管理器指向包含 site.xml 的文件夹或 URL，并以这种方式安装您的插件。这种方法的优点是您可以将文件上传到网站并进行远程部署。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T23:50:26.823

不知道我做了什么来搞砸我的 Eclipse 安装。但是重新安装 eclipse 并将插件放入 dropins 工作得很好！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-10T07:58:29.847

目录 C:\eclipse\plugin 下有一个文件夹，只需复制该 .jar 文件并将其粘贴到此文件夹中，然后关闭 eclipse IDE 并在完成后再次打开检查插件效果

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-01T23:06:00.227

Here is more information: To use your plug-ins in your standard Eclipse installation you can either export it locally as plug-in and place it into your Eclipse installation or you export it as feature and use the Eclipse update manager to install it.... [http://www.vogella.de/articles/EclipsePlugIn/article.html#deployplugin](http://www.vogella.de/articles/EclipsePlugIn/article.html#deployplugin)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-10-13T17:32:33.513

The reason why my plugin was not being loaded was that my plugin had features of CDT and CDT Development SDK was not installed in eclipse.

Once I installed the CDT Development SDK tools, my plugin was loaded automatically.

# c# - 在 C# Windows 窗体中通过 IE 浏览器传递 AD 身份验证凭据

> ID：266966
> 
> 赞同：3
> 
> 时间：2008-11-05T22:27:55.057
> 
> 标签：c#, .net, winforms, internet-explorer, windows-authentication

我们有一个托管 IE 浏览器控件的 Windows 窗体应用程序。我们的用户运行应用程序并打开存储在 MOSS 中的文档的链接。我们正在尝试将应用程序设置为传递服务帐户的凭据，这样我们就可以避免让所有用户访问 MOSS 站点。如果用户当前未登录到我们的域，我们使用[了此处](http://groups.google.com/group/microsoft.public.windows.inetexplorer.ie5.programming.components.webbrowser_ctl/browse_thread/thread/8a7f5038432f328e)找到的代码似乎可以正常工作。但是，该应用程序似乎不会为已通过域身份验证的任何用户传递服务帐户身份验证。在这种情况下，它似乎只是使用经过身份验证的用户凭据。

我们怎样才能使这项工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T15:54:59.157

您指向的网站在哪个 Internet Zone 下运行？即使您使用自己的浏览器控件，它仍然会在某个区域中。通过使用普通浏览器转到相关站点来确定它是什么区域，并确定它在哪个区域。
[替代文本 http://img219.imageshack.us/img219/7162/internetzonenp8.jpg](http://img219.imageshack.us/img219/7162/internetzonenp8.jpg)

如果该特定区域具有自动登录功能，它将采用您的登录凭据。但是，如果您没有以有效的域用户身份登录，那么这些本地 Windows 凭据将不被接受，并且它似乎依赖于您的代码提供的凭据。 [替代文字 http://img230.imageshack.us/img230/407/settingskm3.jpg](http://img230.imageshack.us/img230/407/settingskm3.jpg)

如果安全性不是一个大问题，那么在应用程序池下运行现有网页可能是有意义的，在服务帐户凭据下运行。请记住将服务帐户添加到工作进程组，并关闭集成身份验证功能。

我从过去的经验中了解到，通过将全局组添加到本地组中，并且可能在服务器上授予该本地组权限，通常更健壮且可维护。但现实世界有时是混乱的，这当然并不总是实用或最佳解决方案。

我希望这能回答你的一些问题，但我认为它不会回答所有问题。如果有特定领域您想了解更多信息，如果我能回答，我很乐意提供帮助。

最好的问候 Rihan

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-06T18:11:08.413

模仿在这里没有帮助吗？您可以以您正在谈论的服务帐户用户的名义运行那段代码（表单），然后浏览器控件应该在相同的上下文中运行。

以下链接可能会有所帮助；

[http://msdn.microsoft.com/en-us/library/b80a7e92.aspx](http://msdn.microsoft.com/en-us/library/b80a7e92.aspx)

[http://www.buro9.com/blog/2006/10/06/impersonating-a-user-in-c/](http://www.buro9.com/blog/2006/10/06/impersonating-a-user-in-c/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T17:45:42.633

我的理解是，您的应用程序中的 IE 控件将根据 Windows 会话中的凭据自动登录到 MOSS 站点。您希望它始终使用您指定的帐户并编码到应用程序中？

IE 使用一种 Kerberos 身份验证（Windows 集成身份验证）自动登录到域站点

三个建议；

*   不要使用 MOSS 站点的 WINS 名称，而是使用 IP 地址（也可以使用 DNS 名称，例如不是[http://moss-server](http://moss-server)而是[http://moss-server.domain.com](http://moss-server.domain.com)）。这应该会导致 IE 无法自动登录到该站点。
*   将 Web 服务器上的身份验证模型更改为仅使用 Basic（安全警告 - 明文密码交换）
*   在 Web 浏览器中禁用“启用集成 Windows 身份验证”选项。这将使访问域中的任何站点变得痛苦......

我的推荐是第一个。使用不同的地址使 IE 认为它没有访问受信任的站点，因此不使用集成身份验证。

所有这些都可以在应用程序之外使用 IE 进行测试。只需启动 IE 并输入您正在使用的 MOSS 站点的地址。如果你被要求输入密码，你有你的解决方案。

# windows - 远程桌面用户名@IP 与 IP@用户名随机性

> ID：266968
> 
> 赞同：1
> 
> 时间：2008-11-05T22:28:28.050
> 
> 标签：windows, remote-desktop, rdp, mstsc

是否有其他人发现，当他们在远程桌面中打开已保存的连接时，有时会将登录设置为 Username@IpAddress，而其他时候（似乎是随机的）将其设置为 IpAddress@Username？

有谁知道这两者背后的逻辑是什么/为什么会发生这种情况？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-05T04:16:31.170

我经常使用远程桌面，但我使用的是 Domain\Username 语法而不是 Username@Domain 语法，而且我从未见过它因此而感到困惑。

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2008-11-05T22:35:15.993

如果你 rdp 很多，尤其是几台机器，那么我强烈建议你看看免费的[版税](http://www.code4ward.net/main/)工具。我发现提供上下文非常好，如果不违反您的规则，它可以记住密码。易于查询还有谁在远程盒子上。

我已经用了几年了，只是印象深刻。它可能需要更新您的终端服务，但只需要一个毫秒。

# c# - 禁用 DataGridView 系统上下文菜单

> ID：266971
> 
> 赞同：3
> 
> 时间：2008-11-05T22:28:53.730
> 
> 标签：c#, .net, winforms, datagridview

有谁知道当用户右键单击 DataGridViewTextBoxCell 时如何禁用系统上下文菜单？我试图在 DataGridView 级别覆盖 WndProc（因为在 Cell 级别上没有要覆盖的 WndProc），但似乎没有任何效果。任何帮助将不胜感激。

以下是我在常规 TextBox 中用来实现此目的的方法，但是，我需要为 DataGridViewCell 以相同的方式工作吗？

```
public  class NoContextTextBox : TextBox {
    private static readonly int WM_CONTEXTMENU = 123;
    protected override void WndProc(ref Message m) {
        if (m.Msg != WM_CONTEXTMENU) {
            base.WndProc(ref m);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-05T23:56:58.420

这对我有用：

```
 private void dataGridView1_EditingControlShowing(object sender, DataGridViewEditingControlShowingEventArgs e)
    {
        e.Control.ContextMenu = new ContextMenu();
    } 
```

只需在 DataGridView 的 EditingControlShowing 事件中将 ContextMenu 属性设置为新的（空）ContextMenu。

# c# - 在派生自 Control 的 ASP.NET 自定义控件中呈现自关闭标记

> ID：266988
> 
> 赞同：4
> 
> 时间：2008-11-05T22:32:53.300
> 
> 标签：c#, asp.net, facebook, custom-server-controls

我正在开发一个 Facebook FBML 控件库，并希望创建我的 FBML 控件，其模式有点类似于 ASP.NET WebControls 库。我有一个默认处理渲染的基类；这是我的渲染方法：

```
 protected override void Render(HtmlTextWriter writer)
        {
            AddAttributesToRender(writer);

            if (UseXfbmlSemantics)
            {
                writer.RenderBeginTag(ElementName);
                writer.EndRender();
                writer.RenderEndTag();
            }
            else
            {
                writer.RenderBeginTag(ElementName);
                writer.RenderEndTag();
            }
        } 
```

我想要的是基于 UseXfbmlSemantics 修改渲染 - 如果它是真的，它应该渲染，例如：

```
<fb:name uid="10300399458"></fb:name>
```

当它为 false 时，它​​应该使用自关闭标签呈现：

```
<fb:name uid="10300399458" />
```

我可以让“真”条件几乎正常工作，但自闭合标签似乎与 Renderset 方法不兼容。不幸的是，如果是这种情况，这也意味着 AddAttributesToRender 模式也不起作用。它实际产生的是这样的：

```
 <fb:name uid="10300399458">

        </fb:name> 
```

如何获取 HtmlTextWriter（或我需要使用哪个 HtmlTextWriter）以使其呈现自闭合标签？或者，至少，我怎样才能让它不渲染那个中间空间（这样开始和结束标签就紧挨着）？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2014-09-12T17:22:34.577

由于这是搜索“HtmlTextWriter 自我结束标记”时出现的最重要的 SO 问题，因此适用于任何来到这里想知道如何操作的人：

```
writer.WriteBeginTag("tag");
writer.WriteAttribute("attribute", "attribute value");
// ... add other attributes here ...
writer.Write(HtmlTextWriter.SelfClosingTagEnd); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-06T21:44:33.130

这应该会让你继续前进 - 它将呈现为`<fb:name uid="00101010101"/>`. 您还可以覆盖 RenderBeginTag、RenderContents、RenderEndTag。根据您正在做的事情，您可能需要在 RenderControl 中进行其他一些操作。您也可以考虑使用 ControlAdapter，这可以让您更好地分离控制功能 VS 控制 html 编写。

```
public  class FbName:System.Web.UI.WebControls.WebControl
{

    protected override string TagName
    {
        get
        {
            return "fb:name";
        }
    }

    public override void RenderControl(HtmlTextWriter writer)
    {  
        RenderBeginTag(writer);// render only the begin tag.
        //base.RenderContents(writer);
        //base.RenderEndTag(writer);
    }

    public override void RenderBeginTag(HtmlTextWriter writer)
    {
        writer.Write("<" + this.TagName);
        writer.WriteAttribute("uid", "00101010101");
        writer.Write("/>");

    }
} 
```

-杰森

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-08-29T12:41:26.440

我建议使用 HtmlTextWriter 常量：

```
 protected override void Render(HtmlTextWriter writer)
    {
        AddAttributesToRender(writer);
        writer.Write(HtmlTextWriter.TagLeftChar); // '<'
        writer.Write(this.TagName);
        writer.Write(HtmlTextWriter.SpaceChar); // ' '
        writer.WriteAttribute("uid", "00101010101");
        writer.Write(HtmlTextWriter.SpaceChar); // ' '
        writer.Write(HtmlTextWriter.SelfClosingTagEnd); // "/>"
    } 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2015-02-26T08:37:28.620

如果您使用 Visual Studio，请按以下步骤操作：

> Tools ---> Options ---> Text Editor ---> HTML ----> Formatting ---> remove Auto insert close tag

# windows - 可以从批处理文件触发资源管理器右键单击菜单项吗？

> ID：266989
> 
> 赞同：0
> 
> 时间：2008-11-05T22:32:57.463
> 
> 标签：windows, automation, batch-file

对象说了这一切，但他的背景：

我想从批处理文件中触发一些 TortoiseSVN 操作？我怀疑我可以通过使用正确的 args 调用正确的 exe 来做到这一点，但我宁愿找到一种方法来解决执行任意操作的更普遍问题。

**编辑：**我不直接使用 svn 的原因是 TortoiseSVN 不包含命令行 SVN 客户端（我的计算机上根本没有 svn.exe）。此外，它会转储它输出标准输出，我想要 GUI 输出。

关于右键菜单，除了直接触发右键单击项的方法外，获取任意右键单击项并（或多或少自动地）找出要调用的命令行的方法也足够了。然而，一个相当于“只是找出它的作用”的解决方案并不是我已经知道如何去那里。

我没有任何具体理由相信可以做到这一点，所以如果有人*知道*不可能，那也是一个有效的答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T15:13:39.817

使用 TortoiseProc.exe /command：参见 TortoiseSVN 指南的附录 E

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T22:47:05.830

现在这有点多余。=) Tortoise 包装了 svn 命令行，你想自动化乌龟 UI 动作......

有什么理由你不会只写一个批处理文件说，哦：

```
svn update 
```

如需 svn 的帮助，只需键入：

```
svn help 
```

或者

```
svn help <command> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T22:42:16.230

在我看来，好像你自己回答了这个问题。要触发任意动作仍然需要了解有关动作的一些信息。我不确定您是否会从触发右键单击菜单而不是首先使用 args 调用 exe 中获得任何好处。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T22:54:55.097

如果您知道如何选择文件，则可以使用 WSH 的 SendKeys 方法（Alt+F）打开文件菜单，其中所有上下文菜单项都加倍。您可以使用相同的方法来选择正确的项目。

不幸的是，WSH 无法模拟鼠标。

# ruby - 当前面有特定字符串时，如何找到所有出现的字符序列？

> ID：266997
> 
> 赞同：3
> 
> 时间：2008-11-05T22:36:50.327
> 
> 标签：ruby, regex

我正在尝试从 EBML 定义中提取所有匹配项，如下所示：

```
| + A track
|  + Track number: 3
|  + Track UID: 724222477
|  + Track type: subtitles
...
|  + Language: eng
...
| + A track
|  + Track number: 4
|  + Track UID: 745646561
|  + Track type: subtitles
...
|  + Language: jpn
... 
```

我想要所有出现的“语言：???” 当前面有“曲目类型：字幕”时。我尝试了几种变体：

```
Track type: subtitles.*Language: (\w\w\w) 
```

我在 Ruby 中使用多行修饰符，因此它匹配换行符（就像其他语言中的 's' 修饰符）。

这可以获取**最后一次**出现，在上面的示例中，将是“jpn”，例如：

```
string.scan(/Track type: subtitles.*Language: (\w\w\w)/m)
=> [["jpn"]] 
```

我想要的结果：

```
=> [["eng"], ["jpn"]] 
```

什么是正确的正则表达式来完成这个？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-05T22:41:40.160

你需要通过改变这个来使你的正则表达式不贪心：

```
.* 
```

对此：

```
.*? 
```

您的正则表达式从第一次出现`Track type: subtitles`到`Language: (\w\w\w)`. 使其不贪婪会起作用，因为它匹配尽可能少的字符。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T22:40:53.347

您需要使用惰性量词而不是`.*`. 试试这个：

```
/Track type: subtitles.*?Language: (\w\w\w)/m 
```

这应该让您`Language: ???`在每个“”之后第一次出现“ `Track type: subtitles:`”。但是，如果某些轨道（类型为`subtitles`）会丢失该`Language`字段，则会感到困惑。

* * *

另一种方法是：

```
/^\| \+ (?:(?!^\| \+).)*?\+  Track type: subtitles$(?:(?!^\| \+).)*?^\|  \+ Language: (\w+)$/m 
```

看起来有些凌乱，但应该注意前一个的问题。

* * *

一种更简洁的方法是对字符串进行标记：

```
/^\| \+ ([^\r\n]+)|^\|  \+ Track type: (subtitles)|^\|  \+ Language: (\w+)/m 
```

*（注意空格数）*

对于每个匹配项，您检查定义了哪些捕获组。对于任何单个匹配，只有一个组具有任何值。

*   如果是**第一**组，则开始新的轨道。丢弃有关上一曲目的任何存储信息。
*   如果是**第二**组，则当前曲目的类型为`subtitles`。
*   如果是**第三**组，则找到该轨道的语言。
*   每当您知道曲目的语言并且它是 type`subtitles`时，请报告它。*************************