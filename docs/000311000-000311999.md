# StackOverflow 问答 000311000-000311999

# dojo - 某些键不适用于 Dojo 小部件

> ID：311000
> 
> 赞同：1
> 
> 时间：2008-11-22T07:20:03.660
> 
> 标签：dojo

我尝试按照[mindtrove 博客的小部件示例](http://mindtrove.info/articles/creating-an-accessible-internationalized-dojo-rating-widget/)。这是[示例演示页面](http://mindtrove.info/html/rating-tutorial.html)。

这个小部件有一些问题：左右箭头键，以及 home 和 end 键在 Firefox 中不起作用（我使用的是 Mac），如果我在 Safari 中加载示例页面，任何键都不起作用。我不确定这只是我的 Mac 的问题还是根本无法在 Mac 上运行。

以下是小部件 Rating.js 中的一些代码：

```
_onKeyDown: function(event) {
    switch(event.keyCode) {
    case dojo.keys.UP_ARROW:
    case dojo.keys.RIGHT_ARROW:
        this.currentValue += 1
        this.currentValue = Math.min(this.currentValue, this.maximumValue);
        dojo.stopEvent(event);
        break;
    case dojo.keys.DOWN_ARROW:
    case dojo.keys.LEFT_ARROW:
        this.currentValue -= 1
        this.currentValue = Math.max(this.currentValue, this.minimumValue);
        dojo.stopEvent(event);
        break;
    case dojo.keys.HOME:
        this.currentValue = this.minimumValue;
        dojo.stopEvent(event);
        break;
    case dojo.keys.END:
        this.currentValue = this.maximumValue;
        dojo.stopEvent(event);
        break;
    }
    // refresh the display
    this._update();
} 
```

据我所知，这个函数事件中的所有键都应该起作用。我不确定为什么有些不起作用。顺便说一句，我发现一件有趣的事情：对于 Firefox 中的那些键（左、右、home 和 end）键，如果我按住 shift 键，它们就会起作用。

我不确定问题是小部件代码中的错误还是 Mac 的 Dojo 错误？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-22T17:02:28.010

实际上，我发现所有的键都在 Firefox(Mac) 中工作。我正在使用 Vimperator 来标记一些键。当我在“直通”模式下获得它时，这意味着 Vimerator 插件不会捕获任何键，聚焦的评级控件小部件将获得左、右、上、下、主页和结束的关键事件。

至少在 Firefox 的情况下，该小部件正在工作。根据我的经验，小部件在获得焦点时为控件提供了一些事件功能。但是，如果有任何附加组件或浏览器配置导致事件无法通过或它们响应事件，那么您将遇到“问题”。换句话说，如果它在浏览器情况下真的很复杂。我可以想象，如果某些附加组件可以禁用鼠标单击事件，则该小部件将不再起作用。

我仍然无法弄清楚让小部件在我的 Safari 中工作。据我所知，小部件控件根本没有任何焦点。小部件被分配给测试页面中的 span 标签。我不确定 span 标签是否可以在 Safari 中获得焦点。我会看看我是否可以将小部件放到另一个可聚焦的标签上，然后试一试。

得到一些工作和探索真的很有意义。

# sql-server - 查询计划优化器是否适用于连接/过滤的表值函数？

> ID：311026
> 
> 赞同：2
> 
> 时间：2008-11-22T07:30:41.893
> 
> 标签：sql-server, sql-server-2005, tsql, query-optimization, user-defined-functions

在 SQLSERVER 2005 中，我使用表值函数作为对大表中的子集数据执行任意聚合的便捷方式（传递日期范围或此类参数）。

我在更大的查询中使用这些作为联合计算，我想知道查询计划优化器是否在每种情况下都能很好地与它们一起工作，或者我是否最好在更大的查询中取消嵌套这样的计算。

1.  如果有意义，查询计划优化器是否会取消嵌套表值函数？
2.  如果没有，您建议如何避免通过手动取消嵌套而发生的代码重复？
3.  如果是这样，你如何从执行计划中识别出来？

代码示例：

```
create table dbo.customers (
    [key] uniqueidentifier
    , constraint pk_dbo_customers
        primary key ([key])
)
go

/* assume large amount of data */
create table dbo.point_of_sales (
    [key] uniqueidentifier
    , customer_key uniqueidentifier
    , constraint pk_dbo_point_of_sales
        primary key ([key])
)
go

create table dbo.product_ranges (
    [key] uniqueidentifier
    , constraint pk_dbo_product_ranges
        primary key ([key])
)
go

create table dbo.products (
    [key] uniqueidentifier
    , product_range_key uniqueidentifier
    , release_date datetime
    , constraint pk_dbo_products 
        primary key ([key])
    , constraint fk_dbo_products_product_range_key 
        foreign key (product_range_key) 
        references dbo.product_ranges ([key])
)
go 
```

.

```
/* assume large amount of data */
create table dbo.sales_history (
    [key] uniqueidentifier
    , product_key uniqueidentifier
    , point_of_sale_key uniqueidentifier
    , accounting_date datetime
    , amount money
    , quantity int
    , constraint pk_dbo_sales_history
        primary key ([key])
    , constraint fk_dbo_sales_history_product_key
        foreign key (product_key)
        references dbo.products ([key])
    , constraint fk_dbo_sales_history_point_of_sale_key
        foreign key (point_of_sale_key)
        references dbo.point_of_sales ([key])
)
go

create function dbo.f_sales_history_..snip.._date_range
(
    @accountingdatelowerbound datetime,
         @accountingdateupperbound datetime
)
returns table as
return (
    select
                  pos.customer_key
        , sh.product_key
        , sum(sh.amount) amount
        , sum(sh.quantity) quantity
    from 
        dbo.point_of_sales pos
        inner join dbo.sales_history sh 
            on sh.point_of_sale_key = pos.[key]
    where
                  sh.accounting_date between 
                      @accountingdatelowerbound and 
                      @accountingdateupperbound
    group by
                  pos.customer_key
                  , sh.product_key
)
go

-- TODO: insert some data

-- this is a table containing a selection of product ranges
declare @selectedproductranges table([key] uniqueidentifier)

-- this is a table containing a selection of customers
declare @selectedcustomers table([key] uniqueidentifier)

declare @low datetime
    , @up datetime

-- TODO: set top query parameters 
```

.

```
select
         saleshistory.customer_key
         , saleshistory.product_key
         , saleshistory.amount
         , saleshistory.quantity
from
         dbo.products p
         inner join @selectedproductranges productrangeselection 
             on p.product_range_key = productrangeselection.[key]
         inner join @selectedcustomers customerselection on 1 = 1
         inner join 
         dbo.f_sales_history_..snip.._date_range(@low, @up) saleshistory
             on saleshistory.product_key = p.[key]
             and saleshistory.customer_key = customerselection.[key] 
```

我希望样本有意义。

非常感谢您的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T10:02:04.800

在这种情况下，它是一个“内联表值函数”，如果它有用（或视图），优化器会简单地扩展（取消嵌套）它。

如果函数被外部​​查询视为“黑匣子”，最快的方法是比较 SSMS 中显示的 IO 与分析器中的 IO。Profler 捕获 SSMS 没有的“黑盒”IO。

[Adam Mechanic 的博客文章](http://dataeducation.com/scalar-functions-inlining-and-performance-an-entertaining-title-for-a-boring-post/)（他的书在我工作的抽屉里）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T14:14:40.237

1）是的，使用您的语法，它确实如此。如果您碰巧使用了返回包含条件逻辑的表的 UDF，但它不会。

3) 优化器不会指出它正在优化查询的哪一部分，因为它可能认为适合将计划的块与您的函数结合起来，或者优化一些位。

# sql-server - 如何在不排序的情况下选择表中的前 10 行？

> ID：311043
> 
> 赞同：0
> 
> 时间：2008-11-22T07:53:34.047
> 
> 标签：sql-server

> **可能重复：**
> [如何选择表中的最后 5 行而不进行排序？](https://stackoverflow.com/questions/311054/how-do-i-select-last-5-rows-in-a-table-without-sorting)

我想从 SQL Server 中的表中选择前 10 条记录，而不按升序或降序排列表。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-22T08:01:16.137

如果需要随机顺序，你可以试试

```
select top 10 * from [tablename] order by newid() 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-22T08:01:58.023

这个问题没有意义。在 SQL 中，表没有隐式排序。从语义上讲，它们也可以按随机顺序返回。

将结果限制为返回的前 10 行取决于服务器的 SQL 方言。在 MS-SQL 服务器中，您使用 TOP 关键字，而在 MySQL 中您使用 LIMIT，在 Oracle 中您必须使用 ROWNUM 等。

请提供有关您要完成的工作的更多详细信息。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-22T08:04:00.607

从 <TheTableNameHere> 中选择前 10 个 <requiredfieldListHere>

如果您有聚集索引，这将返回表中的前 10 条记录。但是请注意，这将是不好的形式。不应将关系表视为具有任何特定顺序。如果您没有聚集索引，它可能会返回前 10 条记录，但可以轻松地返回一个随机集。

除非您乐于从表中返回任何 10 条记录，否则您应该对查询应用 ORDER BY。即使您有聚集索引也是如此，因为将来可能会删除或更改它。

# wordpress - XML-RPC API 的深入文档

> ID：311045
> 
> 赞同：1
> 
> 时间：2008-11-22T07:54:52.093
> 
> 标签：wordpress, xml-rpc

我想知道是否有一个带有“参数列表”的 API 文档以及所有博客 API（如 Blogger API、mt、metaweblog 和 wp）的所有返回值的详细描述（和结构定义）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T13:30:33.443

据我所知，WordPress 没有自己的 API，它只是支持其他 API。WordPress Codex 有[一节](http://codex.wordpress.org/XML-RPC_Support)介绍其 XML-RPC 支持。它在那里说他们支持[Blogger API](http://www.blogger.com/developers/api/)、[metaWeblog API](http://www.xmlrpc.com/metaWeblogApi)和[Movable Type API](http://www.sixapart.com/developers/xmlrpc/movable_type_api/)。

# css - 在 asp.net 2.0 中动态应用 CSS

> ID：311050
> 
> 赞同：-1
> 
> 时间：2008-11-22T07:57:00.450
> 
> 标签：css, asp.net-2.0, dynamic-css

我有一个带有三个链接按钮和三个不同 div 的滚动 div。单击按钮后，我需要将 CSS 应用于活动链接按钮。我使用的代码是：

```
protected void btnNetwork_Click(object sender, EventArgs e)
    {
        this.btnForecast.CssClass = "li_1";
        this.btnBlog.CssClass = "li_2";
        this.btnNetwork.CssClass = "li_3_active";
        this.btnNetwork.ForeColor = System.Drawing.Color.White;
        lblMsg.Visible = false;
        BindGW("-----------------------------------");
        Forecast.Visible = false;
        Blog.Visible = false;
        Network.Visible = true;
    } 
```

感谢和问候，

库什

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T11:27:16.330

而不是使用服务器端事件，而是使用客户端 javascript 事件。尝试：

```
$get('btnId').setAttribute("class", "some_class_name"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-24T03:25:04.897

您将无法通过使用刷新页面的回发来动态更改元素的 CSS 属性。如果您想立即进行更改，则必须使用 Javascript。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-02T16:56:44.487

简单的例子：

*   拿一个按钮和一个标签
*   创建一个样式表并将类 style1 添加为：

```
body 
{   
}

.style1
{
  color: #000080;
} 
```

*   在按钮单击事件中编写这个简单的代码

```
protected void Button1_Click(object sender, EventArgs e)
{
  this.Label1.CssClass = "style1";
} 
```

# flash - From AS2 to AS3 loading external images

> ID：311051
> 
> 赞同：1
> 
> 时间：2008-11-22T07:57:01.120
> 
> 标签：flash, actionscript-3, image, migration, actionscript-2

I'm converting some Actionscript code from AS2 tp AS3, and I've eventually managed to get most of it to work again (it's allmost a totally different language, sharing just a little syntax similarity). One of the last things that still doesn't work, is the code for loading an external image.

Perhaps this has changed in AS3 but I really thought it was strange that to load an image you use `loadVideo`, why not loadImage? (on the other hand a flash application is constantly called a flash *video* even when it's not used for animation at all). This doesn't work anymore, and what I've found is a pretty complex code that is said to replace this oneliner `imageholder.loadVideo(url);` is this:

```
var urlreq:URLRequest = new URLRequest(url);
var theloader:Loader = new URLLoader();
theloader.load(urlreq);
theloader.addEventListener(Event.COMPLETE, function(event:Event):void {
        imageholder.addChild(theloader);
    }
); 
```

But this doesn't work.. What I am doing wrong, and is there a more suited function to load images in AS3?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T05:11:40.390

One of most common problems people have with loaders is what they listen to for events. You need to make sure you're listening to the loader.contentLoaderInfo for most events, not the loader itself. That was the main problem in the example you provided.

```
//this is WRONG
loader.addEventListener(Event.COMPLETE, onLoad);

//this is RIGHT
loader.contentLoaderInfo.addEventListener(Event.COMPLETE, onLoad); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T20:10:20.283

I think you're making things a little too complicated - here's what you need to load a single image:

```
import flash.display.Loader;
import flash.event.Event;
import flash.net.URLRequest;

var imageLoader:Loader = new Loader();
imageLoader.contentLoaderInfo.addEventListener(Event.COMPLETE, function(e:Event){
 // e.target.content is the newly-loaded image, feel free to addChild it where ever it needs to go...
});
imageLoader.load(new URLRequest('yourImage.jpg')); 
```

... can you extrapolate from there to loading a list of images? Run that code in for-loop, each time assign a different variable (place in an array, perhaps, or property of an object) to your newly loaded e.target.content so you can access it outside of that 'onComplete'-type function.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T09:52:22.543

I discovered a soulution, myself.

Initializing or unloading a list of images (actually instances of MovieClip):

```
for (i = 0; i<imgHolders.length; i++) {
    var loader:Loader = imgHolders[i].getChildByName("imgloader"+i);
    if (loader) {
        loader.unload();
    } else {
        loader = new Loader();
        loader.name = "imgloader" + i;
        // Does't seem to work, commented out.
        //loader.addEventListener(Event.COMPLETE, centerimage);
        imgHolders[i].addChild(loader);
    }
} 
```

when I need to change the image:

```
var loader:Loader = imgHolders[index].getChildByName("imgloader"+index);
loader.load(new URLRequest(newurl); 
```

I tried to add a listner too to center the image, but it doesn't seem to get called? The first thing the centerimage function does is `trace("centerImage");` wich doesn't appear at all...

# javascript - 从 JavaScript 设置 CSS 伪类规则

> ID：311052
> 
> 赞同：141
> 
> 时间：2008-11-22T07:58:09.637
> 
> 标签：javascript, css, pseudo-class, css-in-js

我正在寻找一种方法来从 JavaScript 更改伪类选择器（例如 :link、:hover 等）的 CSS 规则。

所以类似于 CSS 代码：`a:hover { color: red }`在 JS 中。

我在其他任何地方都找不到答案；如果有人知道这是浏览器不支持的东西，那也将是一个有用的结果。

* * *

## 回答 #1

> 赞同：204
> 
> 时间：2008-11-22T15:40:39.360

您不能单独在特定元素上设置伪类的样式，就像您不能在内联 style="..." 属性中使用伪类一样（因为没有选择器）。

您可以通过更改样式表来做到这一点，例如通过添加规则：

```
#elid:hover { background: red; } 
```

假设您要影响的每个元素都有一个唯一的 ID 以允许选择它。

理论上，您想要的文档是[http://www.w3.org/TR/DOM-Level-2-Style/Overview.html](http://www.w3.org/TR/DOM-Level-2-Style/Overview.html)，这意味着您可以（给定预先存在的嵌入或链接样式表）使用如下语法：

```
document.styleSheets[0].insertRule('#elid:hover { background-color: red; }', 0);
document.styleSheets[0].cssRules[0].style.backgroundColor= 'red'; 
```

当然，IE 需要自己的语法：

```
document.styleSheets[0].addRule('#elid:hover', 'background-color: red', 0);
document.styleSheets[0].rules[0].style.backgroundColor= 'red'; 
```

较旧和较小的浏览器可能不支持这两种语法。很少进行动态样式表摆弄，因为正确处理非常烦人，很少需要，而且历史上很麻烦。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2011-02-22T11:56:17.523

我为此拼凑了一个[小型库，](https://github.com/Box9/jss)因为我确实认为在 JS 中操作样式表有有效的用例。原因是：

*   设置必须计算或检索的样式 - 例如从 cookie 设置用户的首选字体大小。
*   设置行为（非美学）样式，尤其是对于 UI 小部件/插件开发人员。选项卡、轮播等通常需要一些基本的 CSS 才能正常运行——不应*要求*核心功能的样式表。
*   比内联样式更好，因为 CSS 规则适用于所有当前和未来的元素，并且在 Firebug / 开发人员工具中查看时不会弄乱 HTML。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-06-19T07:06:23.343

处理跨浏览器内容的功能：

```
addCssRule = function(/* string */ selector, /* string */ rule) {
  if (document.styleSheets) {
    if (!document.styleSheets.length) {
      var head = document.getElementsByTagName('head')[0];
      head.appendChild(bc.createEl('style'));
    }

    var i = document.styleSheets.length-1;
    var ss = document.styleSheets[i];

    var l=0;
    if (ss.cssRules) {
      l = ss.cssRules.length;
    } else if (ss.rules) {
      // IE
      l = ss.rules.length;
    }

    if (ss.insertRule) {
      ss.insertRule(selector + ' {' + rule + '}', l);
    } else if (ss.addRule) {
      // IE
      ss.addRule(selector, rule, l);
    }
  }
}; 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2018-05-28T17:48:27.507

只需将 css 放在模板字符串中即可。

```
const cssTemplateString = `.foo:[psuedoSelector]{prop: value}`; 
```

然后创建一个样式元素并将字符串放在样式标签中并将其附加到文档中。

```
const styleTag = document.createElement("style");
styleTag.innerHTML = cssTemplateString;
document.head.insertAdjacentElement('beforeend', styleTag); 
```

特异性将负责其余部分。然后您可以动态删除和添加样式标签。这是库的一个简单替代方案，并且会弄乱 DOM 中的样式表数组。快乐编码！

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-12-31T23:56:42.553

我的技巧是使用属性选择器。属性更容易通过 javascript 设置。

**css**

```
.class{ /*normal css... */}
.class[special]:after{ content: 'what you want'} 
```

**javascript**

```
 function setSpecial(id){ document.getElementById(id).setAttribute('special', '1'); } 
```

**html**

```
<element id='x' onclick="setSpecial(this.id)"> ... 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-06-03T00:36:53.970

还有另一种选择。与其直接操作伪类，不如创建模拟相同事物的真实类，例如“悬停”类或“已访问”类。使用通常的“。”为类设置样式。语法，然后您可以使用 JavaScript 在适当的事件触发时从元素中添加或删除类。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-03-12T11:48:17.717

您可以在不同的 CSS 文件中设置不同的规则，然后使用 Javascript 关闭一个样式表并打开另一个样式表，而不是直接使用 javascript 设置伪类规则。[A List Apart](http://www.alistapart.com/articles/alternate)中描述了一种方法（更多详细信息）。

将 CSS 文件设置为，

```
<link rel="stylesheet" href="always_on.css">
<link rel="stylesheet" title="usual" href="preferred.css"> <!-- on by default -->
<link rel="alternate stylesheet" title="strange" href="alternate.css"> <!-- off by default --> 
```

然后使用javascript在它们之间切换：

```
function setActiveStyleSheet(title) {
   var i, a, main;
   for(i=0; (a = document.getElementsByTagName("link")<i>); i++) {
     if(a.getAttribute("rel").indexOf("style") != -1
        && a.getAttribute("title")) {
       a.disabled = true;
       if(a.getAttribute("title") == title) a.disabled = false;
     }
   }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2020-11-06T01:54:16.547

您可以考虑的一种选择是使用 CSS 变量。这个想法是您将要更改的属性设置为 CSS 变量。然后，在您的 JS 中，更改该变量的值。

请参阅下面的示例

```
function changeColor(newColor) {
  document.documentElement.style.setProperty("--anchor-hover-color", newColor);
  // ^^^^^^^^^^^-- select the root 
}
```

```
:root {
  --anchor-hover-color: red;
}

a:hover { 
  color: var(--anchor-hover-color); 
}
```

```
<a href="#">Hover over me</a>

<button onclick="changeColor('lime')">Change to lime</button>
<button onclick="changeColor('red')">Change to red</button>
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-26T21:34:48.737

如前所述，这不是浏览器支持的。

如果您没有动态地提出样式（即从数据库中提取它们或其他东西），您应该能够通过向页面主体添加一个类来解决这个问题。

CSS看起来像：

```
a:hover { background: red; }
.theme1 a:hover { background: blue; } 
```

改变这种情况的 javascript 将类似于：

```
// Look up some good add/remove className code if you want to do this
// This is really simplified

document.body.className += " theme1"; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-08-10T07:54:26.167

切换样式表是一种方法。这是一个动态构建样式表的库，因此您可以动态设置样式：

[http://www.4pmp.com/2009/11/dynamic-css-pseudo-class-styles-with-jquery/](http://www.4pmp.com/2009/11/dynamic-css-pseudo-class-styles-with-jquery/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-04-21T11:47:51.027

在 jquery 中，您可以轻松设置悬停伪类。

```
$("p").hover(function(){
$(this).css("background-color", "yellow");
}, function(){
$(this).css("background-color", "pink");
}); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-03-22T01:49:00.113

这是一个包含两个功能的解决方案： addCSSclass 向文档添加一个新的 css 类，toggleClass 将其打开

该示例显示将自定义滚动条添加到 div

```
// If newState is provided add/remove theClass accordingly, otherwise toggle theClass
function toggleClass(elem, theClass, newState) {
  var matchRegExp = new RegExp('(?:^|\\s)' + theClass + '(?!\\S)', 'g');
  var add = (arguments.length > 2 ? newState : (elem.className.match(matchRegExp) === null));

  elem.className = elem.className.replace(matchRegExp, ''); // clear all
  if (add) elem.className += ' ' + theClass;
}

function addCSSclass(rules) {
  var style = document.createElement("style");
  style.appendChild(document.createTextNode("")); // WebKit hack :(
  document.head.appendChild(style);
  var sheet = style.sheet;

  rules.forEach((rule, index) => {
    try {
      if ("insertRule" in sheet) {
        sheet.insertRule(rule.selector + "{" + rule.rule + "}", index);
      } else if ("addRule" in sheet) {
        sheet.addRule(rule.selector, rule.rule, index);
      }
    } catch (e) {
      // firefox can break here          
    }

  })
}

let div = document.getElementById('mydiv');
addCSSclass([{
    selector: '.narrowScrollbar::-webkit-scrollbar',
    rule: 'width: 5px'
  },
  {
    selector: '.narrowScrollbar::-webkit-scrollbar-thumb',
    rule: 'background-color:#808080;border-radius:100px'
  }
]);
toggleClass(div, 'narrowScrollbar', true);
```

```
<div id="mydiv" style="height:300px;width:300px;border:solid;overflow-y:scroll">
  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed a eros metus. Nunc dui felis, accumsan nec aliquam quis, fringilla quis tellus. Nulla cursus mauris nibh, at faucibus justo tincidunt eget. Sed sodales eget erat consectetur consectetur. Vivamus
  a diam volutpat, ullamcorper justo eu, dignissim ante. Aenean turpis tortor, fringilla quis efficitur eleifend, iaculis id quam. Quisque non turpis in lacus finibus auctor. Morbi ullamcorper felis ut nulla venenatis fringilla. Praesent imperdiet velit
  nec sodales sodales. Etiam eget dui sollicitudin, tempus tortor non, porta nibh. Quisque eu efficitur velit. Nulla facilisi. Sed varius a erat ac volutpat. Sed accumsan maximus feugiat. Mauris id malesuada dui. Lorem ipsum dolor sit amet, consectetur
  adipiscing elit. Sed a eros metus. Nunc dui felis, accumsan nec aliquam quis, fringilla quis tellus. Nulla cursus mauris nibh, at faucibus justo tincidunt eget. Sed sodales eget erat consectetur consectetur. Vivamus a diam volutpat, ullamcorper justo
  eu, dignissim ante. Aenean turpis tortor, fringilla quis efficitur eleifend, iaculis id quam. Quisque non turpis in lacus finibus auctor. Morbi ullamcorper felis ut nulla venenatis fringilla. Praesent imperdiet velit nec sodales sodales. Etiam eget
  dui sollicitudin, tempus tortor non, porta nibh. Quisque eu efficitur velit. Nulla facilisi. Sed varius a erat ac volutpat. Sed accumsan maximus feugiat. Mauris id malesuada dui.
</div>
```

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2016-09-07T16:51:25.960

如果你使用 REACT，有一种东西叫做**[镭](https://github.com/formidablelabs/radium)**。它在这里非常有用：

> *   如果指定了交互样式，则将处理程序添加到道具，例如 onMouseEnter 用于：悬停，必要时包装现有处理程序
>     
>     
> *   如果任何处理程序被触发，例如通过悬停，Radium 调用 setState 来更新组件状态对象上的 Radium 特定字段
>     
>     
> *   在重新渲染时，通过在 Radium 特定状态中查找元素的键或引用来解析任何适用的交互样式，例如：hover

# algorithm - Best way to test performance of various languages & frameworks

> ID：311053
> 
> 赞同：0
> 
> 时间：2008-11-22T07:58:23.677
> 
> 标签：algorithm, performance-testing

I want to perform some empirical trade-off's to assess the performance of applications written in a number of different languages on a Linux platform. Are there standard algorithms that typically used for this purpose?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-22T08:08:41.287

[Some people](http://shootout.alioth.debian.org/gp4/) say there are, although I would argue about the "rightness" of the code in some of the tests on that site.

# sql-server - 如何在不排序的情况下选择表中的最后 5 行？

> ID：311054
> 
> 赞同：30
> 
> 时间：2008-11-22T08:00:33.003
> 
> 标签：sql-server, tsql

我想从 SQL Server 中的表中选择最后 5 条记录，而不按升序或降序排列表。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-22T08:09:22.780

这几乎是我写过的最奇怪的查询，但我很确定它从表中获取“最后 5”行而无需排序：

```
select * 
from issues
where issueid not in (
    select top (
        (select count(*) from issues) - 5
    ) issueid
    from issues
) 
```

请注意，这利用了 SQL Server 2005 将值传递到“top”子句的能力——它在 SQL Server 2000 上不起作用。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-03-19T08:27:04.050

假设您在 id 上有一个索引，这将是闪电般的速度：

```
SELECT * FROM [MyTable] WHERE [id] > (SELECT MAX([id]) - 5 FROM [MyTable]) 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-23T05:54:26.827

您的问题的措辞方式听起来像是您认为您必须对表中的数据进行物理处理，以便按照您想要的顺序将其取回。如果是这样，则不是这种情况，ORDER BY 子句就是为此目的而存在的。使用 ORDER BY 时，存储记录的物理顺序保持不变。记录在返回之前在内存（或临时磁盘空间）中排序。

请注意，如果不使用 ORDER BY 子句，则无法保证返回记录的顺序。因此，尽管此处的任何建议都可能有效，但没有理由认为它们会继续有效，您也不能证明它们在所有情况下都适用于您当前的数据库。这是设计使然 - 我假设它是为数据库引擎提供与记录一样的自由，以便在没有明确指定顺序的情况下获得最佳性能。

假设您希望按字段名称按升序排序的最后 5 条记录，您可以执行以下操作，这应该适用于 SQL 2000 或 2005：

```
select Name 
from (
    select top 5 Name 
    from MyTable 
    order by Name desc
) a 
order by Name asc 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-10-14T15:20:50.567

1.  您需要计算表内的行数（比如我们有 12 行）
2.  然后从中减去 5 行（我们现在是 7 行）
3.  选择 * where index_column > 7

    ```
    select * from users
    where user_id > 
    ( (select COUNT(*) from users) - 5) 
    ```

    您可以订购它们 ASC 或 DESC

    但是当使用这段代码时

    ```
    select TOP 5 from users order by user_id DESC 
    ```

    它不会轻易订购。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-07-25T14:52:08.030

```
select * from table limit 5 offset (select count(*) from table) - 5; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-22T08:02:14.667

没有命令，这是不可能的。什么定义了“底部”？下面将根据它们在数据库中的存储方式选择 5 行。

`SELECT TOP 5 * FROM [TableName]`

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-22T08:16:04.110

好吧，“最后五行”实际上是最后五行，具体取决于您的聚集索引。根据定义，您的聚集索引是对行进行排序的方式。因此，如果没有某种顺序，您真的无法获得“最后五行”。但是，您可以获取与聚集索引相关的最后五行。

```
SELECT TOP 5 * FROM MyTable
ORDER BY MyCLusteredIndexColumn1, MyCLusteredIndexColumnq, ..., MyCLusteredIndexColumnN DESC 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-02-27T01:23:29.263

从您可以使用的最后一条记录中搜索 5 条记录，

```
SELECT *
FROM   Table Name
WHERE  ID <= IDENT_CURRENT('Table Name')
AND ID >= IDENT_CURRENT('Table Name') - 5 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-23T06:38:48.423

如果您知道总共有多少行，您可以使用 ROW_NUMBER() 函数。这是 MSDN 的一个示例（[http://msdn.microsoft.com/en-us/library/ms186734.aspx](http://msdn.microsoft.com/en-us/library/ms186734.aspx)）

```
USE AdventureWorks;
GO
WITH OrderedOrders AS
(
    SELECT SalesOrderID, OrderDate,
    ROW_NUMBER() OVER (ORDER BY OrderDate) AS 'RowNumber'
    FROM Sales.SalesOrderHeader 
) 
SELECT * 
FROM OrderedOrders 
WHERE RowNumber BETWEEN 50 AND 60; 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-09-16T04:01:28.667

在 SQL Server 2012 中，您可以这样做：

```
Declare @Count1 int ;

Select @Count1 = Count(*)
FROM    [Log] AS L

SELECT  
   *
FROM    [Log] AS L
ORDER BY L.id
OFFSET @Count - 5 ROWS
FETCH NEXT 5 ROWS ONLY; 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-04-05T12:43:27.433

试试这个，如果你没有主键或相同的列：

```
select [Stu_Id],[Student_Name] ,[City] ,[Registered], 
       RowNum = row_number() OVER (ORDER BY (SELECT 0))    
from student
ORDER BY RowNum desc 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-22T08:05:22.213

您可以从内存中检索它们。
因此，首先您获取 DataSet 中的行，然后从 DataSet 中获取最后 5 行。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-03-22T07:19:53.843

```
select * 
from table 
order by empno(primary key) desc 
fetch first 5 rows only 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-11-22T08:28:57.907

在某些数据库中，有一个方便的技巧可以按数据库顺序进行排序，

SELECT * FROM TableName ORDER BY true

显然，这可以与此处发布的任何其他建议结合使用，以将结果保留为“从数据库中出来的顺序”，在某些数据库中，这是它们最后修改的顺序。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-09-02T07:18:20.657

在mysql中检索最后5行

* * *

此查询完美运行

```
SELECT * FROM (SELECT * FROM recharge ORDER BY sno DESC LIMIT 5)sub ORDER BY sno ASC 
```

或者

```
select sno from(select sno from recharge order by sno desc limit 5) as t where t.sno order by t.sno asc 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-12-28T08:01:29.030

当表中的行数小于 5 时，Matt Hamilton 和 msuvajac 的答案不正确。因为 TOP N 行计数值可能不是负数。
一个很好的例子可以在[这里](http://www.sqlservercurry.com/2009/02/retrieve-last-n-rows-based-on-condition.html)找到。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-03-08T07:46:08.243

我正在使用此代码：

```
select * from tweets where placeID = '$placeID' and id > (
    (select count(*) from tweets where placeID = '$placeID')-2) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-10-19T11:39:58.057

```
DECLARE @MYVAR  NVARCHAR(100)
DECLARE @step  int
SET @step = 0;

DECLARE MYTESTCURSOR CURSOR
DYNAMIC 
FOR
SELECT col FROM [dbo].[table]
OPEN MYTESTCURSOR
FETCH LAST FROM MYTESTCURSOR INTO @MYVAR
print @MYVAR;

WHILE @step < 10
BEGIN   
    FETCH PRIOR FROM MYTESTCURSOR INTO @MYVAR
        print @MYVAR;
        SET @step = @step + 1;
END   
CLOSE MYTESTCURSOR
DEALLOCATE MYTESTCURSOR 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-03-30T06:12:58.447

在 SQL Server 中，在查询中不使用排序似乎是不可能的。这是我用过的。

```
SELECT *
FROM
(
    SELECT TOP 5 *
    FROM [MyTable]
    ORDER BY Id DESC /*Primary Key*/
) AS T
ORDER BY T.Id ASC; /*Primary Key*/ 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-06-14T09:06:39.773

感谢[*@Apps Tawale*](https://stackoverflow.com/a/36426724/1042705)，根据[他的回答](https://stackoverflow.com/a/36426724/1042705)，这是另一个（我的）版本，

要选择没有标识列的最后 5 条记录，

```
select top 5 *, 
   RowNum = row_number() OVER (ORDER BY (SELECT 0))    
from  [dbo].[ViewEmployeeMaster]
ORDER BY RowNum desc 
```

尽管如此，它有一个订单，但在 RowNum :)

**注意（1）**：上面的查询将反转我们在运行主选择查询时得到的顺序。

所以为了维持秩序，我们可以稍微像这样：

```
select *, RowNum2 = row_number() OVER (ORDER BY (SELECT 0))    
from ( 
        select top 5 *, RowNum = row_number() OVER (ORDER BY (SELECT 0))    
        from  [dbo].[ViewEmployeeMaster]
        ORDER BY RowNum desc
     ) as t1
order by RowNum2 desc 
```

**注（2）：**如果没有标识列，在大数据的情况下查询会花费一些时间

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2012-04-16T07:28:54.830

获取该表的计数

```
select count(*) from TABLE
select top count * from TABLE where 'primary key row' NOT IN (select top (count-5) 'primary key row' from TABLE) 
```

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2020-05-07T09:40:13.287

如果您不想按升序或降序排列表格。用这个。

```
select * from table limit 5 offset (select count(*) from table) - 5; 
```

# javascript - 缓存 JavaScript 文件

> ID：311062
> 
> 赞同：55
> 
> 时间：2008-11-22T08:05:37.563
> 
> 标签：javascript, http, caching

使浏览器使用缓存版本的 js 文件（来自服务器端）的最佳方法是什么？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-23T16:42:04.663

看看雅虎！提示：[https](https://developer.yahoo.com/performance/rules.html#expires) ://developer.yahoo.com/performance/rules.html#expires 。

谷歌也有提示：[https ://developers.google.com/speed/docs/insights/LeverageBrowserCaching](https://developers.google.com/speed/docs/insights/LeverageBrowserCaching)

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-11-22T08:28:04.227

或在 .htaccess 文件中

```
AddOutputFilter DEFLATE css js
ExpiresActive On
ExpiresByType application/x-javascript A2592000 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2015-03-08T14:36:04.403

我刚刚完成了我的周末项目**cached-webpgr.js** ，它使用 localStorage / web 存储来缓存 JavaScript 文件。这种方法非常快。我的小测试显示

*   从 CDN 加载 jQuery：Chrome **268ms**，FireFox：**200ms**
*   从 localStorage 加载 jQuery：Chrome **47ms**，FireFox **14ms**

实现这一点的代码很小，你可以在我的 Github 项目中查看它[https://github.com/webpgr/cached-webpgr.js](https://github.com/webpgr/cached-webpgr.js)

这是如何使用它的完整示例。

完整的库：

```
function _cacheScript(c,d,e){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&(200==a.status?localStorage.setItem(c,JSON.stringify({content:a.responseText,version:d})):console.warn("error loading "+e))};a.open("GET",e,!0);a.send()}function _loadScript(c,d,e,a){var b=document.createElement("script");b.readyState?b.onreadystatechange=function(){if("loaded"==b.readyState||"complete"==b.readyState)b.onreadystatechange=null,_cacheScript(d,e,c),a&&a()}:b.onload=function(){_cacheScript(d,e,c);a&&a()};b.setAttribute("src",c);document.getElementsByTagName("head")[0].appendChild(b)}function _injectScript(c,d,e,a){var b=document.createElement("script");b.type="text/javascript";c=JSON.parse(c);var f=document.createTextNode(c.content);b.appendChild(f);document.getElementsByTagName("head")[0].appendChild(b);c.version!=e&&localStorage.removeItem(d);a&&a()}function requireScript(c,d,e,a){var b=localStorage.getItem(c);null==b?_loadScript(e,c,d,a):_injectScript(b,c,d,a)}; 
```

调用图书馆

```
requireScript('jquery', '1.11.2', 'http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js', function(){
    requireScript('examplejs', '0.0.3', 'example.js');
}); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-22T08:14:37.670

来自 PHP：

```
function OutputJs($Content) 
{   
    ob_start();
    echo $Content;
    $expires = DAY_IN_S; // 60 * 60 * 24 ... defined elsewhere
    header("Content-type: x-javascript");
    header('Content-Length: ' . ob_get_length());
    header('Cache-Control: max-age='.$expires.', must-revalidate');
    header('Pragma: public');
    header('Expires: '. gmdate('D, d M Y H:i:s', time()+$expires).'GMT');
    ob_end_flush();
    return; 
} 
```

为我工作。

作为开发人员，您可能很快就会遇到*不*希望缓存文件的情况，在这种情况下，请参阅[“激进 JavaScript 缓存帮助”](https://stackoverflow.com/questions/54475/help-with-aggressive-javascript-caching)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-22T08:32:47.260

在您的 Apache .htaccess 文件中：

```
#Create filter to match files you want to cache 
<Files *.js>
Header add "Cache-Control" "max-age=604800"
</Files> 
```

我也在这里写过：

[http://betterexplained.com/articles/how-to-optimize-your-site-with-http-caching/](http://betterexplained.com/articles/how-to-optimize-your-site-with-http-caching/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-22T08:32:30.567

我很想把它作为一个副本关闭；这个问题似乎在整个网站上以许多不同的方式得到了回答：

*   [html的脚本标签中带有扩展名php的脚本会被缓存吗？](https://stackoverflow.com/questions/301284/will-a-script-in-htmls-script-tag-with-extension-php-be-cached)
*   [浏览器何时自动清除外部 JavaScript 文件的缓存？](https://stackoverflow.com/questions/206783/when-does-browser-automatically-clear-javascript-cache)
*   [帮助积极的 JavaScript 缓存](https://stackoverflow.com/questions/54475/help-with-aggressive-javascript-caching)
*   [如何在所有浏览器中控制网页缓存？](https://stackoverflow.com/questions/49547/making-sure-a-web-page-is-not-cached-across-all-browsers)
*   [如何让浏览器看到 CSS 和 Javascript 更改？](https://stackoverflow.com/questions/3224/how-can-i-make-the-browser-see-css-and-javascript-changes)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-26T17:05:25.130

最好的（也是唯一的）方法是设置正确的 HTTP 标头，特别是这些标头：“Expires”、“Last-Modified”和“Cache-Control”。如何执行取决于您使用的服务器软件。

在[提高性能...中](http://lazutkin.com/blog/2007/feb/1/improving-performance/)查找“服务器端优化”以获取一般注意事项和相关链接，并查找“客户端缓存”以获取特定于 Apache 的建议。

如果你像我一样是[nginx](http://sysoev.ru/nginx/)（或[纯英文的 nginx）的粉丝，你也可以轻松配置它：](http://nginx.net/)

```
location /images {
  ...
  expires 4h;
} 
```

在上面的示例中，来自 /images/ 的任何文件都将在客户端缓存 4 小时。

现在，当您知道要查找的正确词（HTTP 标头“Expires”、“Last-Modified”和“Cache-Control”）时，只需仔细阅读您使用的 Web 服务器的文档即可。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-09-17T21:06:11.140

我有一个纯 JavaScript 的简单系统。它检查从不缓存的简单文本文件中的更改。当您上传新版本时，此文件会更改。只需将以下JS放在页面顶部即可。

```
 (function(url, storageName) {
            var fromStorage = localStorage.getItem(storageName);
            var fullUrl = url + "?rand=" + (Math.floor(Math.random() * 100000000));
            getUrl(function(fromUrl) {
//                   first load
                if (!fromStorage) {
                    localStorage.setItem(storageName, fromUrl);
                    return;
                }
//                    old file
                if (fromStorage === fromUrl) {
                    return;
                }
                // files updated
                localStorage.setItem(storageName, fromUrl);
                location.reload(true);
            });
            function getUrl(fn) {
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.open("GET", fullUrl, true);
                xmlhttp.send();
                xmlhttp.onreadystatechange = function() {
                    if (xmlhttp.readyState === XMLHttpRequest.DONE) {
                        if (xmlhttp.status === 200 || xmlhttp.status === 2) {
                            fn(xmlhttp.responseText);
                        }
                        else if (xmlhttp.status === 400) {
                            throw 'unable to load file for cache check ' +  url;
                        }
                        else {
                           throw 'unable to load file for cache check ' +  url;
                        }
                    }
                };
            }
            ;
        })("version.txt", "version");
```

只需将“version.txt”替换为始终运行的文件，将“version”替换为您要用于本地存储的名称。

# cryptography - 是否存在可证明 NP 难以击败的公钥加密算法？

> ID：311064
> 
> 赞同：24
> 
> 时间：2008-11-22T08:06:20.480
> 
> 标签：cryptography, complexity-theory, quantum-computing

如果实用的量子计算成为现实，我想知道是否有任何基于 NP 完全问题的公钥密码算法，而不是整数分解或离散对数。

编辑：

请查看 [关于量子计算机的 wiki 文章的“计算复杂性理论中的量子计算”部分。](http://en.wikipedia.org/wiki/Quantum_computer) 它指出，量子计算机可以回答的问题类别（BQP）被认为比 NP-完全更容易。

编辑2：

“基于 NP 完全”是表达我感兴趣的东西的不好方式。

我想问的是一种公钥加密算法，其属性是任何破解加密的方法也可以用来破解潜在的NP完全问题。这意味着破解加密证明 P=NP。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2010-09-06T23:44:40.827

我正在回复这个旧帖子，因为这是一个非常常见且重要的问题，这里的所有答案都是不准确的。

对原始问题的简短回答是明确的“不”。没有已知的基于 NP 完全问题的加密方案（更不用说公钥方案了）（因此所有这些方案都在多项式时间缩减下）。不过，有些人比其他人“更接近”，所以让我详细说明一下。

这里有很多要澄清的地方，所以让我们从“基于 NP 完全问题”的含义开始。对此普遍同意的解释是：“可以在特定的形式模型中证明是安全的，假设不存在针对 NP 完全问题的多项式时间算法”。更准确地说，我们假设不存在*总能*解决 NP 完全问题的算法。这是一个非常安全的假设，因为这对于算法来说是一件非常困难的事情 - 想出一个以高概率解决问题的随机实例的算法似乎要容易得多。

但是，没有加密方案有这样的证明。如果您查看文献，除了极少数例外（见下文），安全定理如下所示：

> *定理：*假设不存在用于 **解决某些问题 X 的随机实例的**多项式时间算法，该加密方案可证明是安全的。

注意“随机实例”部分。对于一个具体的例子，我们可以假设不存在多项式时间算法来分解两个随机 n 位素数的乘积，具有一定的良好概率。这与假设不存在多项式时间算法来*总是*分解两个随机 n 位素数的*所有乘积非常不同（不太安全）。*

“随机实例”与“最坏情况实例”的问题是上面几个响应者的问题。McEliece 类型的加密方案基于解码线性码的非常特殊的随机版本 - 而不是基于 NP 完全的实际最坏情况版本。

超越这个“随机实例”问题需要对理论计算机科学进行一些深入而美丽的研究。从 Miklós Ajtai 的工作开始，我们发现密码算法的安全假设是“最坏情况”（更安全）的假设，而不是随机情况假设。不幸的是，最坏的情况假设是针对未知的 NP 完全问题，并且一些理论证据表明我们不能将它们调整为使用 NP 完全问题。感兴趣的可以查看“基于格的密码学”。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-11T00:56:34.987

一些基于 NP-hard 问题的密码系统已经被提出（如基于子集和问题的[Merkle-Hellman密码系统，以及基于背包问题的](http://en.wikipedia.org/wiki/Merkle-Hellman)[Naccache-Stern 背包密码系统](http://en.wikipedia.org/wiki/Naccache-Stern_knapsack_cryptosystem)），但都被破解了。为什么是这样？Scott Aaronson[在理论计算机科学中的伟大思想](http://stellar.mit.edu/S/course/6/sp08/6.080/materials.html)的第 16 讲对此进行了说明，我认为您应该将其视为权威。它说的是以下内容：

> 理想情况下，我们希望构建一个 [密码伪随机生成器] 或密码系统，其安全性基于 NP 完全问题。不幸的是，NP完全问题总是最坏的情况。在密码学中，这将转化为“*存在*难以解码的消息”这样的陈述，这对密码系统来说并不是一个很好的保证！消息应该难以以压倒性的概率解密。尽管进行了数十年的努力，但仍未发现将最坏情况与 NP 完全问题的平均情况联系起来的方法。这就是为什么如果我们想要计算安全的密码系统，我们需要做出比 P≠NP 更强的假设。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-22T10:09:46.487

这是 1998 年的一个悬而未决的问题：

[关于基于 P != NP 假设的密码学的可能性 作者：](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.21.5836) Oded Goldreich、Rehovot Israel、Shafi Goldwasser

从摘要中：“我们的结论是问题仍然存在”。

——我想知道这在过去十年中是否发生了变化？

编辑：

据我所知，这个问题仍然悬而未决，最近在回答不存在这样的算法方面取得了进展。

Adi Akavia、Oded Goldreich、Shafi Goldwasser 和 Dana Moshkovitz 于 2006[年在 ACM 上发表了这篇论文：基于 NP 硬度的单向函数](http://portal.acm.org/citation.cfm?doid=1132516.1132614)“我们的主要发现是以下两个负面结果”

斯坦福网站[Complexity Zoo](http://qwiki.stanford.edu/wiki/Complexity_Zoo)有助于描述这两个负面结果的含义。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-22T08:28:36.893

虽然许多形式已被破坏，但请查看[Merkle-Hellman](http://en.wikipedia.org/wiki/Merkle-Hellman)，它基于 NP 完全“背包问题”的一种形式。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-10T20:52:51.873

格密码学提供了（过度）广义的带回家的信息，确实可以设计密码系统，其中打破平均情况与解决特定的 NP 难题（通常是最短向量问题或最近向量问题）一样难。

[我可以推荐阅读http://eprint.iacr.org/2008/521](http://eprint.iacr.org/2008/521)的介绍部分，然后寻找对密码系统的引用。

[此外，请参阅http://www.cs.ucsd.edu/~daniele/CSE207C/](http://www.cs.ucsd.edu/~daniele/CSE207C/)上的讲义，如果需要，还可以寻找一本书的链接。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-22T09:34:09.147

谷歌搜索 NP 完全和公钥加密会发现误报......实际上是不安全的。这个[卡通 pdf](http://www.cs.waikato.ac.nz/Teaching/COMP103A/ian.witten/concept_lectures/10_public_key_encrypt.pdf)似乎显示了基于[最小支配集问题](http://en.wikipedia.org/wiki/Minimum_dominating_set)的公钥加密算法。进一步阅读它然后承认撒谎该算法是安全的......根本问题是NP-Complete，但它在PK算法中的使用并没有保留难度。

另一个误报 Google 发现：[来自 Crypto '97 的 Goldreich-Goldwasser-Halevi 密码系统的密码分析](http://cat.inist.fr/?aModele=afficheN&cpsidt=1825219)。从摘要：

在 Crypto '97 上，Goldreich、Goldwasser 和 Halevi 提出了一种公钥密码系统，该系统基于点阵中的最接近向量问题，已知该问题是 NP 难的。我们表明，该方案的设计存在一个重大缺陷，它有两个含义：任何密文都会泄露明文上的信息，并且解密密文的问题可以简化为一个特殊的最接近向量问题，这比一般问题要容易得多.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-09-15T14:27:13.013

有一个网站可能与您的兴趣相关：[后量子密码学](http://pqcrypto.org/)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-13T03:12:06.630

这是我的推理。如我错了请纠正我。

(i) “破解”密码系统在 NP 和 co-NP 中必然是一个问题。（破解密码系统涉及反转加密函数，该函数是一对一且可在多项式时间内计算的。因此，给定密文，明文是可以在多项式时间内验证的证书。因此，根据密文在 NP 和 co-NP 中。）

(ii) 如果 NP 和 co-NP 中存在 NP-hard 问题，则 NP = co-NP。（这个问题将是 NP 完全的并且在 co-NP 中。由于任何 NP 语言都可以简化为这种 co-NP 语言，NP 是 co-NP 的子集。现在使用对称性：co-NP 中的任何语言 L 都有 -L （它的恭维）在 NP 中，其中 -L 在 co-NP 中——即 L = --L 在 NP 中。）

(iii) 我*认为*人们普遍认为 NP != co-NP，否则有多项式大小的证明证明布尔公式是不可满足的。

结论：复杂性理论猜想暗示 NP-hard 密码系统不存在。

（否则，您在 NP 和 co-NP 中有一个 NP-hard 问题，因此 NP = co-NP---这被认为是错误的。）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-22T08:28:33.117

虽然 RSA 和其他广泛使用的密码算法基于整数分解的难度（不知道是 NP 完全问题），但也有一些基于 NP 完全问题的公钥密码算法。谷歌搜索“公钥”和“np-complete”将显示其中一些。

（我之前错误地说过量子计算机会加速 NP 完全问题，但事实并非如此。我是正确的。）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-04T05:53:42.457

正如许多其他海报所指出的，可以将密码学建立在 NP-hard 或 NP-complete 问题上。

然而，密码学的常用方法将基于困难的数学（即难以破解）。事实是，将数字序列化为传统键比创建解决 NP 难题的标准化字符串更容易。因此，实际的加密基于尚未证明是 NP-hard 或 NP-complete 的数学问题（因此可以想象其中一些问题在 P 中）。

在 ElGamal 或 RSA 加密中，破解它需要破解离散对数，所以请查看这篇[维基百科](http://en.wikipedia.org/wiki/Discrete_logarithm)文章。

> 没有已知的用于计算一般离散对数 logbg 的有效算法。朴素的算法是将 b 提高到越来越高的 k 次方，直到找到所需的 g；这有时称为试乘法。该算法需要与组 G 的大小成线性关系的运行时间，因此在组大小中的位数是指数的。[然而，由于 Peter Shor ( http://arxiv.org/abs/quant-ph/9508027](http://arxiv.org/abs/quant-ph/9508027) ) ，存在一种有效的量子算法。
> 
> 计算离散对数显然很困难。不仅没有已知的最坏情况的有效算法，而且平均情况复杂度可以证明至少与使用随机自约简的最坏情况一样难。
> 
> 同时，离散取幂的逆问题不是（例如，可以使用平方取幂有效地计算它）。这种不对称类似于整数分解和整数乘法之间的不对称。这两种不对称性都在密码系统的构建中得到了利用。

人们普遍认为这些是 NP 完全的，但可能无法证明是这样。请注意，量子计算机可能会有效地破解密码！

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-11-15T18:04:46.220

由于没有人真正回答这个问题，我必须给你提示：“McEliece”。对其进行一些搜索。它是一种经过验证的 NP-Hard 加密算法。它需要 O(n^2) 的加密和解密时间。它也有一个大小为 O(n^2) 的公钥，这很糟糕。但是有一些改进降低了所有这些界限。

# language-agnostic - 进行分页时的偏移量与页码

> ID：311068
> 
> 赞同：9
> 
> 时间：2008-11-22T08:09:28.117
> 
> 标签：language-agnostic, pagination

这是非常微不足道的，但我注意到他们使用页码而不是偏移量。我知道差异很小（将页码乘以页面上的行数或将偏移量除以页面上的行数），但我想知道是否推荐一个而不是另一个。

某些网站，例如 Google，当然会使用更复杂的系统，因为它们需要跟踪您的实际搜索。但我正在考虑一个简单的网站，这无关紧要。

推荐的技术是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-22T08:33:34.387

使用偏移量。如果您选择允许每页的结果数量可变（或用户定义），则编码很容易。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-28T07:26:24.973

当您分页的结果集非常大时，偏移量对于优化也很有用。

这是因为在某些情况下，它允许您执行

```
WHERE my_sortorder >= (some offset)
LIMIT 10 
```

而不是一个

```
LIMIT 10 OFFSET 880 
```

效率较低。索引可以让您直接找到与 my_sortoder >= *some offset*匹配的所有行，但是当您将 OFFSET 与 LIMIT 一起使用时，它需要首先查找并扫描所有 880 个前面的行。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2017-08-21T01:22:58.003

最好使用`limit`和的组合，`offset`因为如果您更改限制，它不需要任何进一步的数学计算来计算新的页码。

例如，每页有 20 个对象，假设第 1 页返回索引为 0-19 的对象，如果您在第 2 页，那么您应该查看索引为 20-39 的对象。如果我现在决定将限制更改为在 10 中，最常见的行为是显示索引为 20 - 29 的对象。

完成上述行为需要您使用新限制重新计算您应该在哪个页面上。上面，如果您要将限制更改为 10，但将页码保持为 2，那么您将显示索引为 10 - 19 的对象。您需要重新计算页码为 3，以便对象 20 - 显示了 29 个。

我的意见，当然。

# linq - DataGridView 过滤 OnClick 事件（C# WinForm）

> ID：311070
> 
> 赞同：0
> 
> 时间：2008-11-22T08:11:11.467
> 
> 标签：linq, datagridview

如何通过单击事件上的 label.text 的值过滤我的 datagridview？该值来自我的 linq 查询：

```
dataSet.Tables[0].AsEnumerable().Where(c => c.Field<int>("ageColumn") > 3 &&
     c.Field<int>("ageColumn") < 5).Count(); 
```

假设上面的查询给了我 12 (label.text = 12)，现在当我点击“12”时，我希望我的 datagridview 只显示符合我上面查询的那 12 行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T09:43:50.873

你需要它是动态的吗？也许将查询本身作为 lambda 存储在标签的 Tag 属性中：

```
Predicate<DataColumn> clause = c => c.Field<int>("ageColumn") > 3 
    && c.Field<int>("ageColumn") < 5;
label1.Tag = clause; 
```

...然后在单击标签时重新评估您的查询：

```
var clause = (sender as Label).Tag as Predicate<DataColumn>; 
myDataSource = dataSet.Tables[0].AsEnumerable().Where(clause); 
```

我不知道这是否可行，但至少它可以让你在各种标签上“附加”一个 where 子句。

我还建议您查看[Bindable LINQ](http://www.codeplex.com/bindablelinq)，以便可以绑定查询结果。很酷的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T09:29:58.063

现在我不使用 LINQ，但逻辑会建议表达式返回的任何内容

```
dataSet.Tables[0].AsEnumerable().Where(c => c.Field<int>("ageColumn") > 3 &&
 c.Field<int>("ageColumn") < 5) 
```

包含您要查找的数据？那里没有枚举数据的属性吗？

# database - 三个客户地址在一张表中还是在不同的表中？

> ID：311074
> 
> 赞同：13
> 
> 时间：2008-11-22T08:15:59.227
> 
> 标签：database, language-agnostic, database-design, oop

在我的应用程序中，我有一个`Customer`班级和一个`Address`班级。该类`Customer`具有该类的三个实例`Address`：`customerAddress`、`deliveryAddress`、`invoiceAddress`。

**在数据库中反映这种结构的最佳方式是什么？**

*   直接的方法是一个客户表和一个单独的地址表。
*   一种更非规范化的方式将只是一个包含每个地址列的客户表（“street”示例：customer_street、delivery_street、invoice_street）

你对此有什么经验？这些方法有什么优点和缺点吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-22T08:34:16.007

如果您 100% 确定客户只会拥有您描述的 3 个地址，那么这没关系：

```
CREATE TABLE Customer
(
    ID int not null IDENTITY(1,1) PRIMARY KEY,
    Name varchar(60) not null,
    customerAddress int not null
        CONSTRAINT FK_Address1_AddressID FOREIGN KEY References Address(ID),
    deliveryAddress int null
            CONSTRAINT FK_Address2_AddressID FOREIGN KEY References Address(ID),
    invoiceAddress int null
            CONSTRAINT FK_Address3_AddressID FOREIGN KEY References Address(ID),
    -- etc
)

CREATE TABLE Address
(
    ID int not null IDENTITY(1,1) PRIMARY KEY,
    Street varchar(120) not null
    -- etc
) 
```

否则我会这样建模：

```
CREATE TABLE Customer
(
    ID int not null IDENTITY(1,1) PRIMARY KEY,
    Name varchar(60) not null
    -- etc
)

CREATE TABLE Address
(
    ID int not null IDENTITY(1,1) PRIMARY KEY,
    CustomerID int not null
        CONSTRAINT FK_Customer_CustomerID FOREIGN KEY References Customer(ID),
    Street varchar(120) not null,
    AddressType int not null 
    -- etc
) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-22T08:24:57.070

我会去（如数据库理论所教导的）两个单独的表：客户和地址。

正如您所说，在 Customer 表中放置三个字段的想法很糟糕，因为它会违反规范化规则（并且当地址超过三个时会失败）。

**编辑**：另外，我将地址表记录拆分为几个字段，一个用于地形前缀，一个用于街道等，并在这些字段上放置一个唯一键。否则，您将以一个充满重复的数据库结束。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-22T08:28:41.010

我会去规范化。这更容易。

如果您对其进行规范化，地址表将要求您从客户表中删除重复记录并重新链接记录。如果我有相同的交货地址和发票地址，它似乎应该链接到相同的记录。如果我换一个，你需要：

1.  创建一个新的地址记录。
2.  重新链接客户记录。

如果我把它改回来，你需要检查：

1.  是否已经存在类似的地址条目。
2.  重新链接客户记录。

这种编程开销似乎抵消了规范化似乎提供的更少空间的优势。正如您所指出的，非规范化解决方案将提供更快的查询和更容易的维护（编程方面）。这似乎是我的决定因素。

如上所述，标准化解决方案将允许您稍后添加更多地址。但是无论如何您都必须为外键添加一个字段，除非您计划在没有从客户到地址表的链接的情况下组织表。

标准化的优点

*   更小的空间。
*   有点内置的重复逻辑（尽管它们*实际上*可能不是重复的？）
*   支持添加新的地址字段（有点）。

非规范化的优点

*   更快的查询。
*   少编程。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-22T08:44:53.817

使用 2 个表，客户，地址。

在地址表中创建地址后，通常不允许对其进行修改（可能是用于纠正拼写错误的特定工具）。IOW 使地址的 ID 与地址本身具有幂等性。

您现在可以在任何地方引用这些地址表条目。例如，当订单发送给客户时，Order 表引用的地址 ID 可以与客户表中 DeliveryAddressID 字段中的地址 ID 相同。

如果客户希望将当前存档的递送地址更改为新的，则创建新的地址记录。历史交付数据不受此影响，但新订单会自动使用新地址。

请注意，这在缓存 Addresss 对象时也很有帮助（它们是不可变的并且对于长期缓存是安全的），它们可以被分发并且更容易测试相等性（通过 ID 属性）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-22T09:39:01.447

我在 Zen Cart（可能还有 osCommerce）的订单表中有这个，我想知道他们为什么要这样，因为他们有一个地址表。
我看到的唯一有效的原因是出于记录目的：即使客户更改了地址，订单信息也不能更改，它反映了订单时的数据。

现在，这有点浪费，如果同一个客户做了很多订单，那就更浪费了。一种可能的解决方案是保留地址历史记录并在订单中引用它们。
我想知道这些不可变地址（或者如果它们还没有相关订单，则可变）是否应该保存在常规地址簿或单独的历史记录表中，仅在下订单时填写（如果同一客户保留，则避免重复）当然，相同的地址）。
前者的优点是避免有两个结构非常相似的表和重复信息，但随着历史的增长，可能会阻碍性能（？）。尽管人们很少改变这些信息，但在实践中。
后者具有分离角色的优点（一个是不可变的，而不是另一个），很少使用历史。

总的来说，如果您的应用程序不需要保留历史记录，只需使用两个单独的表。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-24T15:44:34.313

在这种情况下，将每个地址字段放在不同的行中不是标准化。这只是表分区。任何具有更多表的模式都“更加规范化”的假设是错误的。

假设我们在数据库中有这两种替代模式：1）用户：user_id、用户名、密码

2) 用户：user_id、password_id 密码：password_id、password

（2）是否比（1）“更规范化”？**不**！

在这个 OP 的情况下，只要：1）我们将地址视为原子值，2）应用程序只需要这三种类型的地址。

然后将每个地址存储在不同的列中同样有效。第二种解决方案不会将地址分解为其组成部分（国家、城镇、街道等）。因此它并不比第一个“更规范化”！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-22T08:37:50.773

我的两分钱是，如果你有令人信服的理由，你描述的方式去规范化是*可以的。*有时，这个原因可能很简单，因为您永远不需要标准化形式的高度自信。正如 Stefan Mai 暗示的那样，如果您只需要使用您指定的三种类型的地址，那么检索和更新单个表会容易得多。另一方面，如果三个地址的要​​求有任何改变的可能性，那么它可能会改变，并且早期是正常化的更好时间。

# winforms - 我应该如何将对象的引用传递给 MVC 中的控制器？

> ID：311079
> 
> 赞同：0
> 
> 时间：2008-11-22T08:21:07.437
> 
> 标签：winforms, model-view-controller, mvp

我正在尝试在我的 WinForm 应用程序中更好地使用 MVC/MVP 样式模式，并且我正在努力解决一些问题，也许这里有更多经验的人可以帮助我。

以下是我的基本项目布局：
![替代文字](https://i.stack.imgur.com/BNawq.png)

该类`G2.cs`处理各种线程的运行，并包括启动/停止和与这些线程相关的其他各种方法。我想这是我的“主要”课程。它还包含我的应用程序的主循环。

到目前为止，我的 GUI 由 3 个表单和一个关联的控制器组成。具有`MainForm`开始/停止按钮，需要调用我的`G2`类上的方法以及可能的未来形式。

**将我的 G2 类的引用传递给所有需要它的视图控制器的正确方法是什么？** 我是否需要`G2`在创建表单时传递对表单的引用，然后表单又将其传递给我的控制器，或者......这不是处理事情的好方法吗？

另外，我是否正确，因为 Views 有责任创建它的控制器的实例并且它“拥有”控制器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T21:53:43.180

如果 G2 是主程序类，并且只存在于一个实例中，我会在这个类上使用单例模式——不需要传递引用。

# django - 您在 Django 中使用哪种 RDBMS，为什么？

> ID：311080
> 
> 赞同：7
> 
> 时间：2008-11-22T08:23:27.700
> 
> 标签：django, rdbms

我最近将一个项目从 MySQL InnoDB 切换到 PostgreSQL，在使用 ajax 插入和更新数据时，我感觉滞后更大。这可能是主观的。我知道 Django 开发人员推荐 postgres，而且我知道 psycopg2 应该比 MysqlDB 更快。就我个人而言，我喜欢 postgres 强制数据库完整性的方式，但我最担心这个项目的性能。想听听其他人对此的看法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T08:36:25.473

你为什么不测量？这是确定性能的唯一方法。在没有硬数据的情况下挥手说明事情有多慢就像试图用手抓水一样。

使用带有 MySQL 后端和 PostgreSQL 的 Web 服务器压力工具（如 The Grinder（可以在 Jython 中编写脚本））测量每秒事务数甚至更好，每秒请求数，然后看看这是否有所不同。如果是这样，请在此处询问，或者更具体地说，在 pgsql-general 或 pgsql-performance 邮件列表中询问。那里有很多专家，甚至是主要的开发人员，都对它了如指掌。PostgreSQL 配置上有很多与性能相关的旋钮。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T08:38:29.977

可能是索引使用不正确。简单地确保您拥有正确的索引，并确保定期分析和清理表应该会产生相当不错的结果。

即使 Postgres 的速度慢了一点，在某些情况下，我个人认为它提供的功能大大超过了轻微的性能损失。

Postgres 确实是一个漂亮的数据库，每当我使用其他任何东西时，我都希望我使用的是 Postgres。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-22T08:41:06.227

我在上一个项目的开发阶段第一次使用 SQLite。它易于设置，便于从一个开发系统携带到另一个开发系统，等等。我必须补充一点，当我最终将项目转移到 MySQL 上的生产时，MySQL 出现了一些不存在的微妙问题完全使用 SQLite。没什么大不了的，但是从现在开始，如果我必须在 MySQL 上部署一个项目，我也更愿意在开发阶段使用 MySQL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T08:31:30.193

SQLite。没有后端服务器。非常适合开发人员

# cocoa - 在 Cocoa 应用程序中调试异常

> ID：311092
> 
> 赞同：4
> 
> 时间：2008-11-22T08:34:28.783
> 
> 标签：cocoa, debugging

我正在开发一个带有 NSTextView 的应用程序。当我将随机字节粘贴到其中时（例如，来自已编译的 C 程序），它应该显示乱码。但是，当我 -setShowsControlCharacters:YES 时，同样会导致崩溃并多次给出以下错误：

`2008-11-22 00:27:22.671 MyAppName[6119:10b] *** -[NSBigMutableString _getBlockStart:end:contentsEnd:forRange:stopAtLineSeparators:]: Range or index out of bounds`

我创建了一个新项目，只有一个具有相同属性的 NSTextView，它没有这个问题。

我的问题是，如何调试我的应用程序以找到错误原因？我不知道错误的来源。我不熟悉 Xcode 内置的调试器。如果有人能在如何追踪此类错误方面为我指明正确的方向，我将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-23T06:18:30.883

当调试 Cocoa 应用程序是`objc_exception_throw`和`-[NSException raise]`. 在 10.5 中，所有异常都会通过，`objc_exception_throw`但如果您的目标是 Tiger，您应该在两者上都设置断点。

[在http://www.cocoadev.com/index.pl?DebuggingTechniques](http://www.cocoadev.com/index.pl?DebuggingTechniques)有更多的调试技术。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-22T09:13:27.753

目前还不清楚你知道多少，所以我将尝试一个非常基本的方法，请不要被冒犯。

我假设 NSTextView 位于外部 nib/xib 中，并且不是以编程方式创建的。
如果是这样，请在 Interface builder 中打开您的 nib/xib，然后单击有问题的 NSTextView 元素。

然后点击**Cmd-5**或**Tools->Connections Inspector**

从这里您可以看到要在实际源代码中查找哪些**Outlets/Action 。**

您最有可能遇到的问题是对“ **Reference Outlet** ”对象或“ **Sent Action** ”函数的操作。

一旦您知道需要观察哪些方法/变量，您就可以在 Xcode 中打开这些部分的源代码。然后，您可以通过单击编辑器窗口左侧的行号在任何行设置断点。

单击**运行->调试器**。应该会弹出一个新窗口，单击该窗口工具栏中的“**运行并**开始”。您的应用程序应该正常运行，直到它到达您在源代码中设置的断点。当断点被击中时，您可以将鼠标悬停在调试器窗口下半部分代码中的变量上。变量的当前值应该弹出以便于检查。

通常，您可以通过使用调试器的右上角面板检查变量表来获得相同的信息。

完成该断点后，单击调试器窗口顶部的“**继续**”，您的程序将执行直到完成或下一个断点。

这应该让您开始在 Xcode 下进行调试。它们是断点的不同种类/用途以及您可以在 Xcode 中执行的各种其他花哨的东西。有关更多信息，请查看这个很棒[的 CocoaHeads 视频](http://vodpod.com/watch/1074573-cocoaheads-april-17-2008-debugging-with-xcode)。

祝你好运，

布莱恩·G。

# language-agnostic - 生成必须遵循某些规则的唯一编号的最佳方法是什么？

> ID：311094
> 
> 赞同：0
> 
> 时间：2008-11-22T08:36:40.573
> 
> 标签：language-agnostic

一些背景：在德国（至少）发票号码必须遵循某些规则：

1.  必须订购
2.  它们必须是连续的（可能没有间隙）

几个月以来，它们被允许包含字符。一些客户想要使用这种可能性，但客户不知道或害怕，他们坚持使用仅限数字的发票号码。

此外，客户不想从零开始。

我是否可以想出很多方法来生成这样一个我想知道的数字：最好的方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T08:55:22.440

为了避免从 0 开始 - 只需从 10000 开始。忘记零填充。

您必须考虑何时分配号码。

如果您在第一次打开发票进行编辑时分配编号，例如分配编号 10014，而用户取消了发票，那么您有一个差距，因为您必须记住其他人可能已经开始创建ID 为 10015 的发票，因此您不能只回滚该号码。

如果您在发票已完全写入并正在保存时分配编号，那么您将避免这种情况，并且您将避免出现空白，但在保存之前您将不知道发票将具有哪个发票编号.

此外，您需要确保它是线程安全的，这样两个用户就不能创建相同的发票编号。

```
static object _invoiceNumberLock = new object();
public static string GetInvoiceNumber()
{
    lock(_invoiceNumberLock)
    {
        //Connect to database and get MAX(invoicenumber)+1
        //Increase the invoicenumber in SQL database by one
        //Perhaps also add characters
    }
} 
```

还可以考虑通过在 SQL 数据库中的 invoicenumber 列上使用 UNIQUE INDEX 来备份唯一性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T08:43:16.457

我的两个想法：

1.  （不带字符）：一个序列，从 1 开始，用零填充（或以另一个数字开头并用零填充） - 示例：**1000002554**
2.  （带字符）：以十六进制为基数的序列，用零填充（最终带有前缀） - 例如：**AF00CAFE01**

**有十六进制**的发票号码会很酷:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T10:25:39.107

对于我的发票，它们总是包含年份的最后一位数字，后跟从 4096 开始的 4 位数发票编号，因此您会得到一个像 85021 这样的值。这是为了轻松处理我（最多）15 个客户的帐单月。

现在这无关紧要，因为我一年只开出大约 6 张发票（我是永久的，现在只做少量工作，主要是出于投资目的离开公司），但这个计划一直对我有用。

它阻止了客户感觉他们正在由一家小公司完成工作（没有发票编号 1 甚至 80001）。

就顺序而言，发票只是简单地存储在文件中，文件名中带有发票编号，因此很容易创建下一张。不需要数据库——这真的取决于你的商店有多大。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T12:51:54.880

还有一些想法：

选择任意位序列作为数字的顶部。这将作为“魔术键”使用，因此您可以断章取义地识别该数字。例如，Newegg 产品 ID 似乎以“N82E”开头，UPS 追踪号码似乎以“1Z”开头。

如果您可以改变“连续”规则，请将最后一位设为奇偶校验位，以进行错误检查。

# winforms - 任何可以将 .NET 1.1 WinForm 代码升级到 .NET 2.0“风格”的工具？

> ID：311100
> 
> 赞同：1
> 
> 时间：2008-11-22T08:43:43.290
> 
> 标签：winforms, upgrade

我的意思是一个可以从旧的 .NET 1.1 WinForm 代码中提取某些内容并将其放入 .designer 文件的工具（使其看起来像 .net 2.0 WinForm 代码）。这还涉及对项目文件 (.csproj/.vbproj) 的更新。

如果还没有现成的工具，关于如何通过编程来做到这一点的任何提示或指针？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T12:06:37.013

可以使用宏来做，看看[这篇文章](http://www.dotnetjunkies.com/WebLog/jamesnies/archive/2006/11/27/VS2005DesignerClassMacroForCSharp.aspx)的宏代码。

如果其他人想要为 VB.net 做这个（就像我一样），我能找到的唯一例子是 c# 中的这个，但它给了我一个基础，我们让它与一个 vb 项目一起工作。

# c++ - 安全地检查变量的类型

> ID：311102
> 
> 赞同：1
> 
> 时间：2008-11-22T08:47:23.250
> 
> 标签：c++, dynamic-cast

对于一个系统，我需要将指针转换为 long 然后将 long 转换回指针类型。你可以猜到这是非常不安全的。我想做的是使用 dynamic_cast 进行转换，所以如果我混合它们，我会得到一个空指针。这个页面说[http://publib.boulder.ibm.com/infocenter/lnxpcomp/v7v91/index.jsp?topic=/com.ibm.vacpp7l.doc/language/ref/clrc05keyword_dynamic_cast.htm](http://publib.boulder.ibm.com/infocenter/lnxpcomp/v7v91/index.jsp?topic=/com.ibm.vacpp7l.doc/language/ref/clrc05keyword_dynamic_cast.htm)

> dynamic_cast 运算符在运行时执行类型转换。dynamic_cast 运算符保证将指向基类的指针转换为指向派生类的指针，或将引用基类的左值转换为对派生类的引用。因此，程序可以安全地使用类层次结构。此运算符和 typeid 运算符在 C++ 中提供运行时类型信息 (RTTI) 支持。

如果它为空，我想得到一个错误，所以我编写了自己的动态演员表

```
template<class T, class T2> T mydynamic_cast(T2 p)
{
    assert(dynamic_cast<T>(p));
    return reinterpret_cast<T>(p);
} 
```

使用 MSVC，我收到错误“错误 C2681：'long'：dynamic_cast 的无效表达式类型”。事实证明，这只适用于具有虚函数的类...... WTF！我知道动态转换的重点是针对向上/向下转换继承问题，但我也认为它是为了动态解决类型转换问题。我知道我可以使用 reinterpret_cast 但这并不能保证相同类型的安全性。

我应该用什么来检查我的类型转换是否是同一类型？我可以比较这两个 typeid，但是当我想将派生的类型转换为它的基时会遇到问题。那么我该如何解决呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T08:53:46.170

`dynamic_cast`只能在通过继承相关的类之间使用。要将指针转换为 long 或反之，您可以使用`reinterpret_cast`. 要检查指针是否为空，您可以`assert(ptr != 0)`. 但是，通常不建议使用`reinterpret_cast`. 为什么需要将指针转换为long？

另一种选择是使用联合：

```
union  U { 
int* i_ptr_;
long l;
} 
```

同样，也很少需要联合。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T13:14:28.017

请记住，在 Windows 64 中，指针将是 64 位数量，但`long`仍将是 32 位数量，并且您的代码已损坏。至少，您需要根据平台选择整数类型。我不知道 MSVC 是否支持`uintptr_t`C99 中提供的用于保存指针的类型；如果可用，那将是最好的类型。

至于其余的，其他人已经充分解决了`dynamic_cast`vs的原因和原因`reinterpret_cast`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T22:20:19.677

在以仅支持 C 接口的语言编写的应用程序中加载 C++ DLL 时，我不得不做类似的事情。这是一个解决方案，如果传入了意外的对象类型，它将立即为您提供错误。当出现问题时，这可以使诊断变得更加容易。

诀窍是作为句柄传递的每个类都必须继承自一个公共基类。

```
#include <stdexcept>
#include <typeinfo>
#include <string>
#include <iostream>
using namespace std;

// Any class that needs to be passed out as a handle must inherit from this class.
// Use virtual inheritance if needed in multiple inheritance situations.
class Base
{

public:
    virtual ~Base() {} // Ensure a v-table exists for RTTI/dynamic_cast to work
};

class ClassA : public Base
{

};

class ClassB : public Base
{

};

class ClassC
{
public:
    virtual ~ClassC() {}
};

// Convert a pointer to a long handle.  Always use this function
// to pass handles to outside code.  It ensures that T does derive
// from Base, and that things work properly in a multiple inheritance
// situation.
template <typename T>
long pointer_to_handle_cast(T ptr)
{
    return reinterpret_cast<long>(static_cast<Base*>(ptr));
}

// Convert a long handle back to a pointer.  This makes sure at
// compile time that T does derive from Base.  Throws an exception
// if handle is NULL, or a pointer to a non-rtti object, or a pointer
// to a class not convertable to T.
template <typename T>
T safe_handle_cast(long handle)
{
    if (handle == NULL)
        throw invalid_argument(string("Error casting null pointer to ") + (typeid(T).name()));

    Base *base = static_cast<T>(NULL); // Check at compile time that T converts to a Base *
    base = reinterpret_cast<Base *>(handle);
    T result = NULL;

    try
    {
        result = dynamic_cast<T>(base);
    }
    catch(__non_rtti_object &)
    {
        throw invalid_argument(string("Error casting non-rtti object to ") + (typeid(T).name()));
    }

    if (!result)
        throw invalid_argument(string("Error casting pointer to ") + typeid(*base).name() + " to " + (typeid(T).name()));

    return result;
}

int main()
{
    ClassA *a = new ClassA();
    ClassB *b = new ClassB();
    ClassC *c = new ClassC();
    long d = 0; 

    long ahandle = pointer_to_handle_cast(a);
    long bhandle = pointer_to_handle_cast(b);
    // long chandle = pointer_to_handle_cast(c); //Won't compile
    long chandle = reinterpret_cast<long>(c);
    // long dhandle = pointer_to_handle_cast(&d); Won't compile
    long dhandle = reinterpret_cast<long>(&d);

    // send handle to library
    //...
    // get handle back
    try
    {
        a = safe_handle_cast<ClassA *>(ahandle);
        //a = safe_handle_cast<ClassA *>(bhandle); // fails at runtime
        //a = safe_handle_cast<ClassA *>(chandle); // fails at runtime
        //a = safe_handle_cast<ClassA *>(dhandle); // fails at runtime
        //a = safe_handle_cast<ClassA *>(NULL); // fails at runtime
        //c = safe_handle_cast<ClassC *>(chandle); // Won't compile
    }
    catch (invalid_argument &ex)
    {
        cout << ex.what() << endl;
    }

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T08:56:32.530

`dynamic_cast<>`是一个旨在仅用于*可转换*类型（在多态意义上）的强制转换。强制将 a 强制`pointer`转换为 a `long`（litb 正确建议 static_assert 以确保大小的兼容性）有关**指针类型的**所有信息都将丢失。没有办法实现 a`safe_reinterpret_cast<>`来获取返回的指针：值和类型。

为了澄清我的意思：

```
struct a_kind {}; 
struct b_kind {}; 

void function(long ptr) 
{} 

int 
main(int argc, char *argv[]) 
{ 
    a_kind * ptr1 = new a_kind; 
    b_kind * ptr2 = new b_kind;

    function( (long)ptr1 );
    function( (long)ptr2 );

    return 0;
} 
```

没有办法`function()`确定传递的指针类型并将其“向下”转换为正确的类型，除非：

*   long 被一个带有一些类型信息的对象包装。
*   类型本身被编码在引用的对象中。

这两种解决方案都很丑陋，应该避免，因为是 RTTI 代理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-22T10:32:41.713

您可以使用`reinterpret_cast`转换为整数类型并返回到指针类型。**如果**整数类型足够大以存储指针值，则该转换不会更改指针值。

正如其他人已经说过的那样，在非多态类上使用 dynamic_cast 不是定义的行为（除非你进行向上转换，这无论如何都是隐式的，在这里被忽略），它也只适用于指针或引用。不适用于整数类型。

你最好使用`::intptr_t`在各种 posix 系统上找到的。您可以使用该类型作为您转换为的中间类型。

关于您检查转换是否成功，您可以使用 sizeof：

```
BOOST_STATIC_ASSERT(sizeof(T1) >= sizeof(T2)); 
```

如果无法完成转换，将在编译时失败。或者继续在该条件下使用断言，它将改为在运行时断言。

**警告：**这不会阻止您使用 U 转换`T*`回`intptr_t`除`U*`T 以外的其他类型。因此，这只保证您在从`T*`to`intptr_t`和 back to转换时不会更改指针的值`T*`。（感谢 Nicola 指出您可能会期待另一种保护）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-22T12:26:31.763

reinterpret_cast 是在这里使用的正确演员表。

这几乎是它*唯一*可以安全地做的事情。

reinterpret_cast 从指针类型到类型 T 并返回到原始指针类型会产生原始指针。（假设 T 是至少与原始指针类型一样大的指针或整数类型）

请注意，从指向 T 的指针类型的 reinterpret_cast 是未指定的。没有关于 T 类型的值的保证，*除了*如果你然后 reinterpret_cast 它回​​到原来的类型，你会得到原来的值。因此，假设您不尝试对您的情况下的中间 long 值做任何事情， reinterpret_cast 是完全安全且可移植的。

编辑：当然，如果您在第二次演员表中不知道原始类型是什么，这将无济于事。在这种情况下，你就完蛋了。long 不可能以任何方式携带关于它是从哪个指针转换而来的类型信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-22T20:48:46.757

你想做的事情听起来像是一个非常糟糕和危险的想法，但如果你必须这样做（即你在遗留系统或你知道永远不会改变的硬件上工作），那么我建议将指针包装在一些一种包含两个成员的简单结构：1) 指向您的对象实例的 void 指针和一个字符串、枚举或其他类型的唯一标识符，它们将告诉您将原始 void* 转换为什么。这是我的意思的一个例子（注意：我没有费心测试这个，所以它可能存在语法错误）：

```
struct PtrWrapper {
  void* m_theRealPointer;
  std::string m_type;
};

void YourDangerousMethod( long argument ) {

   if ( !argument ) 
     return;

   PtrWrapper& pw = *(PtrWrapper*)argument;

   assert( !pw.m_type.empty() );

   if ( pw.m_type == "ClassA" ) {
     ClassA* a = (ClassA*)pw.m_theRealPointer;
     a->DoSomething();
   } else if (...) { ... }

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-28T14:01:22.317

另外，最好使用 size_t 而不是 long - 我认为这种类型可以确保与地址空间的大小兼容。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-11-22T17:38:43.460

一旦您决定将指针投射到 long 上，您就将类型安全抛在了脑后。

dynamic_cast 用于向上和向下转换派生树。即，从基类指针到派生类指针。如果你有：

```
class Base
{
};

class Foo : public  Base
{
};

class Bar : public Base
{
}; 
```

您可以通过这种方式使用 dynamic_cast ...

```
Base* obj = new Bar;

Bar* bar = dynamic_cast<Bar*>(obj); // this returns a pointer to the derived type because obj actually is a 'Bar' object
assert( bar != 0 );

Foo* foo = dynamic_cast<Foo*>(obj);  // this returns NULL because obj isn't a Foo
assert( foo == 0 ); 
```

...但是您不能使用动态强制转换来转换派生树。为此，您需要 reinterpret_cast 或 C 风格的演员表。

# java - Map 的任何实现 ，即两个键？

> ID：311103
> 
> 赞同：7
> 
> 时间：2008-11-22T08:49:51.593
> 
> 标签：java, generics, maps

我需要一个有两个键的地图，例如

```
Map2<String /*ssn*/, String /*empId*/, Employee> _employees; 
```

这样我就可以

```
_employees.put(e.ssn(), e.empId(), e) 
```

然后

```
_employees.get1(someSsn);
_employees.get2(someImpId); 
```

甚至

```
_employees.remove1(someImpId); 
```

我不知道为什么我想停在两个，为什么不更多，可能是因为我现在需要的就是这种情况:-) 但是类型需要处理固定数量的键以保证类型安全——类型参数不能可变参数:-)

感谢任何关于为什么这是一个坏主意的指示或建议。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-22T11:50:58.233

我想*主*键是`empId`，所以我会用它作为键来构建一个`Map`，即`empId`---> `Employee`。所有其他唯一属性（例如`ssn`）将被视为*次要*属性，并将使用单独`Map`的 s 作为`empId`（例如`ssn`---> `empId`）的查找表。

此实现使添加/删除员工变得容易，因为您只需要更改一个`Map`，即`empId`---> `Employee`；其他`Map`的只能在需要的时候重建。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-22T08:56:54.480

我的第一个想法是：我认为最简单的方法是两张地图。

```
Map< String, Map< String,Employee> > _employees; 
```

但从外观上看，您只想能够通过 SSN 或 ID 查找员工。那么是什么阻止你制作两张地图，或者最坏的情况是一个包含两张地图的类？

澄清一下，您是在寻找*复合键*，因为员工由其 SSN 和 ID 的组合唯一标识，但不是单独标识，还是您正在寻找两种不同的方式来引用员工？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T17:57:48.147

[Spiffy 框架](http://spiffyframework.sourceforge.net/)似乎提供了您正在寻找的东西。来自 Javadocs：

> 二维哈希映射是一种哈希映射，它使您能够通过两个键而不是一个键来引用值

相关类是[TwoDHashMap](http://spiffyframework.sourceforge.net/javadoc/index.html)。它还提供了[ThreeDHashMap](http://spiffyframework.sourceforge.net/javadoc/spiffy/core/util/ThreeDHashMap.html)。

# c# - 我应该更喜欢购买商业框架还是创建自己的相同功能版本？（经典“创造与购买”）

> ID：311109
> 
> 赞同：3
> 
> 时间：2008-11-22T08:56:53.670
> 
> 标签：c#

我对商业类库有不同的看法。我最好使用商业类库还是从头开始？如果购买库是 C# 开发人员的前进方向，哪一个？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T09:02:27.527

为你的时间设定一个价值，比如每小时 30 美元。估计编写库需要多长时间，然后添加两倍用于调试和测试。减去学习如何使用给定文档的商业库所需的时间。乘以您的每小时费率。相比。

编写库可能会很有趣且有益，但“不是在这里发明”综合症使许多公司无法创造任何有用的东西，因为他们被困在重新发明轮子以增加成本。确保它是可扩展的（如果您无法访问源代码）并且拥有您需要的东西。买它。

作为一个个人项目，可能值得至少从头开始编写一次，看看你能学到什么，但在公司的一角钱上，你需要有生产力和效率。

或者从头开始编写并开源发布；）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-22T09:17:13.660

我真的认为你错过了最重要的策略：

*   使用开源并将更改回馈给社区。

我已经看到很多商业软件集成都失败了，通常是因为商业产品无法满足现实生活中的需求，其中很多是你直到你深深地投入时才发现的（哦，所以你希望搜索没有1000 个响应的上限？不，我们不能这样做...）

如果这些事情发生在开源身上，你至少总是可以选择分叉。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T12:33:49.707

尽可能始终使用高质量的库 - 但前提是您可以拥有源代码。经验告诉我不要使用任何我无法获得来源的东西。

此外 - 根据库的具体情况，有时在其之上放置一层是明智的，这样您可以减少依赖关系，从而使将来更换库更容易。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-09T12:00:00.500

这取决于你的目标。如果您想试验和了解某个框架功能，尝试实现它是有意义的。

然而，如果你想通过你的软件赚钱（或名声或其他），你应该问问自己如何最好地利用你的时间。通过实现另一个链接列表，您为应用程序增加了多少价值？可能不是很多，所以使用任何可用的好的实现。另一方面，您可以通过实现一个非常具体的图形控件来为您的应用程序增加价值（尽管市场上有很多）。所以从投资回报的角度来看。

# c# - 用于描述 3D 位置的 .NET 类型？

> ID：311117
> 
> 赞同：1
> 
> 时间：2008-11-22T09:06:48.390
> 
> 标签：c#, .net

我需要一种可以包含对象在 3D 环境中的位置的类型——我的房子。

我需要知道它所在的楼层，以及该楼层的 x 和 Y 坐标。

System.Windows.Point(int, int) 只表示二维空间，但.NET 是否有用于三维空间的类型？

我意识到我可以做类似的事情

```
List<int, Point<int, int>> 
```

但我只想有一个简单的类型。就像是：

```
3DPoint<int, int, int> 
```

.NET 框架有这个吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T09:21:01.607

在托管 Direct3D 中有一个 vector3 类型，用于描述空间中的一个点。自己实现一个是微不足道的。

```
public struct Vector3
{
  public float x;
  public float y;
  public float z;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T09:19:11.003

我不认为有这样的内置功能。

但是请查看这篇 CodeProject 文章[3D Geometry Library (Basic Classes) and 3D Drawing using VB.Net](http://www.codeproject.com/KB/vb/3D_Graphics_-_Net.aspx)

# iphone - 是否有任何 Windows 模拟器可用于测试 iPhone 应用程序？

> ID：311119
> 
> 赞同：6
> 
> 时间：2008-11-22T09:07:18.123
> 
> 标签：iphone, windows, ios-simulator

是否有任何可用的 Windows 模拟器可供我在 Windows XP 上测试（仅测试）我的 iPhone 应用程序？

感谢和问候，

库什

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-23T07:13:50.413

不可以。iPhone 模拟器作为 iPhone SDK 的一部分提供，该 SDK 仅适用于基于 Intel 的 Mac 上的 Mac OS X Leopard。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-09-28T15:40:22.187

如果您有物理 iOS 设备，则可以使用[SeeTest](http://experitest.com/automation/)在 Windows 上测试您的应用程序。

您将您的设备连接到您的 Windows 机器，然后您可以执行 Web/Native 测试、记录并再次播放。

# algorithmic-trading - 算法交易 API

> ID：311126
> 
> 赞同：7
> 
> 时间：2008-11-22T09:18:02.143
> 
> 标签：algorithmic-trading

有人有算法交易（如股票）的经验吗？有什么好的服务可以用来获取报价和进行交易吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T10:39:58.343

我有一个使用[Interactive Brokers](http://www.interactivebrokers.com/)的自由项目，它提供了专有 API 和基于 FIX 的 API。专有 API 使用起来有些痛苦（为了兼容性，他们可能无法对其进行太多更改），但您可以轻松编写“翻译层”以使其更加愉快。我还没有尝试过基于 FIX 的 API，所以没有评论。

是的，我重新提出了这个问题。我碰巧认为这是一个公平的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T12:52:40.183

我知道[TradeStation](http://www.tradestation.com/default_2.shtm)很受欢迎。

# wpf - 在运行时添加 WPF 控件

> ID：311131
> 
> 赞同：30
> 
> 时间：2008-11-22T09:24:08.090
> 
> 标签：wpf

我编写了一个 WPF UserControl，并希望在运行时单击一个按钮时将其中的一个或多个添加到我的窗口中。我怎样才能做到这一点？

编辑：进一步规范我想将用户控件添加到画布，并放在绝对位置。画布是我房子里的地板图，每个用户控件都有属性来指示它在房子里的位置。所以我希望所有控件都位于画布上的正确位置。

我在想这样的事情

```
var light = new LightUserControl(2);
HouseCanvas.Children.Add(light); // this should be positioned in a specific place 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-11-22T21:46:39.043

将控件添加到 Canvas 后，您需要使用 Canvas.Top 和 Canvas.Left 附加属性指定顶部和左侧坐标，如下所示。

```
var light = new LightUserControl(2);
HouseCanvas.Children.Add(light);
Canvas.SetLeft(light, 20);
Canvas.SetTop(light, 20); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-01T09:22:17.267

如果您想将控件添加到 Grid 而不是 Canvas，您可以通过 Grid 静态类指定所有 Grid 属性，如下所示：

```
Label newLabel = new Label();
newLabel.Content = "The New Element";
Main.Children.Add(newLabel);
Grid.SetColumn(newLabel, 0);
Grid.SetRow(newLabel, 0); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T09:27:46.913

在窗口中添加一个 StackPanel 并在每个按钮上单击，

```
 _stackPanel.Children.Add(new YourControl()); 
```

您可以通过多种方式做到这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-03-11T11:04:52.053

我的解决方案：

```
for (i = 1; i <= buttoncount; i++)
{
    Button mybutton = new Button();
    Grid1.Children.Add(mybutton);
    mybutton.Height = 100;
    mybutton.Width = 100;
    mybutton.Name = "button" + i;
    mybutton.Content = mybutton.Name;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-09-06T21:44:26.553

```
 public static void AddChild(this Visual parent, UIElement child)
    {
        if (InternalAddChild(parent, child))
        {
            return;
        }
        throw new NotSupportedException();
    }
    private static bool InternalAddChild(Visual parent, UIElement child)
    {
        Panel panel = parent as Panel;
        if (panel != null)
        {
            panel.Children.Add(child);
            return true;
        }
        for (int i = VisualTreeHelper.GetChildrenCount(parent) - 1; i != -1; i--)
        {
            Visual target = VisualTreeHelper.GetChild(parent, i) as Visual;
            if (target != null && InternalAddChild(target, child))
            {
                return true;
            }
        }
        return false;
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-04-24T19:24:21.157

只是补充答案：

```
for (i = 1; i <= buttoncount; i++)
{
    Button mybutton = new Button();
    Grid1.Children.Add(mybutton);
    mybutton.Height = 100;
    mybutton.Width = 100;
    mybutton.Name = "button" + i;
    mybutton.Content = mybutton.Name;
    mybutton.Click += button_Click;
}

private void button_Click(object sender, RoutedEventArgs e)
{
    // do something
} 
```

# flash - 不使用 Flash 创作工具打开 .fla 文件

> ID：311154
> 
> 赞同：13
> 
> 时间：2008-11-22T09:50:06.120
> 
> 标签：flash

我有一个 .fla 文件，其中包含一些我想要获取的文本。有没有一个免费的应用程序可以用来打开 .fla 文件，或者只是一个转储字符串和图片的工具？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-22T10:08:13.523

带着这样的问题，我只是实验......

我去了 deviantART，去了[Flash .FLA 文件](http://browse.deviantart.com/resources/applications/flash/ "闪存 .FLA 文件")库并随机下载了一个。
我有一个大约 1MB 的 .fla 文件。

我去了 Sysinternals 的网站以获取最新版本的[Strings](http://technet.microsoft.com/en-us/sysinternals/bb897439.aspx "字符串")，这是一个从二进制文件中提取纯文本字符串的命令行工具。
冉：

```
strings -n 10 "D:\Archives\scrolling flash gallery with preloader.fla" > str 
```

得到包含大量数据的文本文件，你必须自己排序......

还有一些其他类似的免费软件实用程序，有些带有 GUI，但这个命令行版本很方便。适用于（或其中一个）Unicode 和 Ansi 字符串。

哦，显然它适用于 Windows。您忘记指定是否针对特定平台。

PS.：对于它的价值，我相信 Adob​​e 网站上的 Flash SDK 是免费的。您只是没有 Flash IDE，只有编译器等用于 AS 开发。也许它包括一个查看 .fla 文件的工具（尚未尝试过该工具包）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-02-01T10:48:02.080

FLA 是一种专有的 Adob​​e 格式，它没有公开记录。

我认为只有容器细节是已知的。FLA 容器在 CS4 之前是[Microsoft 结构化存储](http://en.wikipedia.org/wiki/Compound_File_Binary_Format)（如 MS Word 文档），从 CS5 开始只是 ZIP。CS4 版本可以使用例如[FAR Manager](http://www.farmanager.com/download.php?l=en)或[OpenMCDF 打开](http://sourceforge.net/projects/openmcdf/)。CS5+ 版本可以用例如[7zip](http://www.7-zip.org/download.html)打开。

您将看到二进制内容和其他对象。AS3 代码可以在 Unicode 明文中看到。但其他元素并不那么容易提取。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-07T03:57:30.643

也有一些免费的库可以提供额外的 SWF 文件内容（即[sswf](http://www.m2osw.com/sswf.html)）。但是，由于 .fla 文件的格式是专有的，因此来自 .fla 文件的情况要少得多。

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2016-04-26T19:50:30.890

您只需将 .FLA 文件更改为 .ZIP 即可访问 .FLA 文件，并将其作为目录浏览。至于进行更改，我会安装免费试用版“Animator”。您可以尝试替换 .fla（现在是 .zip）中的文件，但我认为它不会真正起作用。再一次，它是闪光的，所以..

祝你好运。

# .net - 为什么在将 x64 程序集标记为 x86 时 corflags 实用程序不发出警告？

> ID：311158
> 
> 赞同：2
> 
> 时间：2008-11-22T09:52:55.817
> 
> 标签：.net, x86, 64-bit, corflags

如果我将 MyApp.exe 的平台标志设置为 x64，我仍然可以像这样运行 corflags 实用程序：
corflags /32bit+ MyApp.exe
corflags 很乐意将 32bit 标志设置为 1。当然，当我尝试运行应用程序时我会收到一个错误：0xC000007B =`STATUS_INVALID_IMAGE_FORMAT`

我的问题是：有没有一种方法可以使构建到 x64 的程序集可以作为 x86 运行，或者只是 corflags 实用程序不“关心”？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T19:46:19.723

通过将“平台类型”设置为 x64 来编译二进制文件也会更改图像 PE 标头，使其仅为 64 位。例如，您可以使用[Dependency Walker](http://www.dependencywalker.com/)看到这一点。

具有 64 位 PE 标头似乎优先于仅 32 位的标志。.NET 的 win32 引导程序似乎看到 PE 标头与当前系统不兼容（32 位系统上的 64 位）。这会阻止加载本机图像，顺便也阻止加载图像的 .NET 程序集部分。

不过，我不知道有任何工具能够以这种方式更新 PE 标头。这似乎不仅仅是更改标志以将图像设置为 32 位的问题。（见[这篇博文](http://blogs.msdn.com/kstanton/archive/2004/03/31/105060.aspx)）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T18:07:36.520

因为如果您不加载本机 DLL，则没有理由*不能将*其标记为 32 位。如果它是纯粹的 MSIL，那么这个决定就没有那么重要了。

# c# - 如何将字节数组转换为十六进制字符串，反之亦然？

> ID：311165
> 
> 赞同：1528
> 
> 时间：2008-11-22T10:03:13.003
> 
> 标签：c#, arrays, hex

如何将字节数组转换为十六进制字符串，反之亦然？

* * *

## 回答 #1

> 赞同：1563
> 
> 时间：2008-11-22T10:19:28.480

您可以[`Convert.ToHexString`](https://docs.microsoft.com/en-us/dotnet/api/system.convert.tohexstring)从 .NET 5 开始使用。
还有一种反向操作的方法：[`Convert.FromHexString`](https://docs.microsoft.com/en-us/dotnet/api/system.convert.fromhexstring).

* * *

对于旧版本的 .NET，您可以使用：

```
public static string ByteArrayToString(byte[] ba)
{
  StringBuilder hex = new StringBuilder(ba.Length * 2);
  foreach (byte b in ba)
    hex.AppendFormat("{0:x2}", b);
  return hex.ToString();
} 
```

或者：

```
public static string ByteArrayToString(byte[] ba)
{
  return BitConverter.ToString(ba).Replace("-","");
} 
```

还有更多的变体，例如[这里](https://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/3928b8cb-3703-4672-8ccd-33718148d1e3/)。

反向转换将是这样的：

```
public static byte[] StringToByteArray(String hex)
{
  int NumberChars = hex.Length;
  byte[] bytes = new byte[NumberChars / 2];
  for (int i = 0; i < NumberChars; i += 2)
    bytes[i / 2] = Convert.ToByte(hex.Substring(i, 2), 16);
  return bytes;
} 
```

* * *

结合使用`Substring`是最好的选择`Convert.ToByte`。有关更多信息，请参阅[此答案](https://stackoverflow.com/a/26304129)。如果你需要更好的性能，你必须避免`Convert.ToByte`在你可以丢弃之前`SubString`。

* * *

## 回答 #2

> 赞同：527
> 
> 时间：2009-03-08T21:56:41.770

## 性能分析

*注：新领导人截至 2015-08-20。*

我通过一些粗略的性能测试运行了各种转换方法`Stopwatch`，运行随机句子（n = 61，1000 次迭代）和运行 Project Gutenburg 文本（n = 1,238,957，150 次迭代）。以下是结果，大致从最快到最慢。所有测量都以滴答声（[10,000 滴答声 = 1 ms](https://msdn.microsoft.com/en-us/library/system.timespan.tickspermillisecond.aspx)）为单位，并且所有相关注释都与 [最慢]`StringBuilder`实现进行比较。对于使用的代码，请参见下文或[测试框架存储库](https://github.com/patridge/PerformanceStubs)，我现在在其中维护用于运行它的代码。

## 免责声明

*警告：不要依赖这些统计数据来做任何具体的事情；它们只是样本数据的样本运行。如果您确实需要一流的性能，请在代表您的生产需求的环境中使用代表您将使用的数据的数据来测试这些方法。*

## 结果

*   [按字节查找`unsafe`（通过 CodesInChaos） （由](https://stackoverflow.com/a/24343727/48700)[airbreather](https://github.com/airbreather)添加到测试仓库）
    *   文本：4,727.85 (105.2X)
    *   句子：0.28 (99.7X)
*   [按字节查找（通过 CodesInChaos）](https://stackoverflow.com/a/24343727/48700)
    *   文本：10,853.96（快 45.8 倍）
    *   句子：0.65（快 42.7 倍）
*   [字节操作 2（通过 CodesInChaos）](https://stackoverflow.com/a/14333437/48700)
    *   文本：12,967.69（快 38.4 倍）
    *   句子：0.73（快 37.9 倍）
*   [字节操作（通过 Waleed Eissa）](https://stackoverflow.com/a/632920/48700)
    *   文本：16,856.64（快 29.5 倍）
    *   句子：0.70（快 39.5 倍）
*   [查找/移位（通过 Nathan Moinvaziri）](https://stackoverflow.com/a/5919521/48700)
    *   文本：23,201.23（快 21.4 倍）
    *   句子：1.24（快 22.3 倍）
*   [通过 nibble 查找（通过 Brian Lambert）](https://blogs.msdn.microsoft.com/blambert/2009/02/22/blambertcodesnip-fast-byte-array-to-hex-string-conversion/)
    *   文本：23,879.41（快 20.8 倍）
    *   句子：1.15（快 23.9 倍）
*   [`BitConverter`（通过托马拉克）](https://stackoverflow.com/a/311179/48700)
    *   文本：113,269.34（快 4.4 倍）
    *   句子：9.98（快 2.8 倍）
*   [`{SoapHexBinary}.ToString`（通过迈克罗夫特）](https://stackoverflow.com/a/2556329/48700)
    *   文本：178,601.39（快 2.8 倍）
    *   句子：10.68（快 2.6 倍）
*   [`{byte}.ToString("X2")`（使用`foreach`）（来自 Will Dean 的回答）](https://stackoverflow.com/a/311382/48700)
    *   文本：308,805.38（快 2.4 倍）
    *   句子：16.89（快 2.4 倍）
*   [`{byte}.ToString("X2")`（使用`{IEnumerable}.Aggregate`，需要 System.Linq）（通过 Mark）](https://stackoverflow.com/a/3824807/48700)
    *   文本：352,828.20（快 2.1 倍）
    *   句子：16.87（快 2.4 倍）
*   [`Array.ConvertAll`（使用`string.Join`）（通过 Will Dean）](https://stackoverflow.com/a/311382/48700)
    *   文本：675,451.57（快 1.1 倍）
    *   句子：17.95（快 2.2 倍）
*   [`Array.ConvertAll`（使用`string.Concat`，需要 .NET 4.0）（来自 Will Dean）](https://stackoverflow.com/a/311382/48700)
    *   文本：752,078.70（快 1.0 倍）
    *   句子：18.28（快 2.2 倍）
*   [`{StringBuilder}.AppendFormat`（使用`foreach`）（通过 Tomalak）](https://stackoverflow.com/a/311179/48700)
    *   文本：672,115.77（快 1.1 倍）
    *   句子：36.82（快 1.1 倍）
*   [`{StringBuilder}.AppendFormat`（使用`{IEnumerable}.Aggregate`，需要 System.Linq）（来自 Tomalak 的回答）](https://stackoverflow.com/a/311179/48700)
    *   文本：718,380.63（快 1.0 倍）
    *   句子：39.71（快 1.0 倍）

查找表已经领先于字节操作。基本上，有某种形式的预计算任何给定的半字节或字节将以十六进制表示。然后，当您翻阅数据时，您只需查找下一部分以查看它将是什么十六进制字符串。然后以某种方式将该值添加到结果字符串输出中。长期以来，一些开发人员可能难以阅读的字节操作是性能最佳的方法。

您最好的选择仍然是找到一些有代表性的数据并在类似生产的环境中进行尝试。如果您有不同的内存限制，您可能更喜欢分配较少的方法，而不是更快但消耗更多内存的方法。

## 测试代码

随意使用我使用的测试代码。此处包含一个版本，但您可以随意克隆[repo](https://github.com/patridge/PerformanceStubs)并添加您自己的方法。如果您发现任何有趣的东西或想帮助改进它使用的测试框架，请提交拉取请求。

1.  将新的静态方法 ( `Func<byte[], string>`) 添加到 /Tests/ConvertByteArrayToHexString/Test.cs。
2.  将该方法的名称添加到`TestCandidates`同一类的返回值中。
3.  `GenerateTestInput`通过切换同一类中的注释，确保您正在运行所需的输入版本、句子或文本。
4.  点击`F5`并等待输出（在 /bin 文件夹中还会生成一个 HTML 转储）。

```
static string ByteArrayToHexStringViaStringJoinArrayConvertAll(byte[] bytes) {
    return string.Join(string.Empty, Array.ConvertAll(bytes, b => b.ToString("X2")));
}
static string ByteArrayToHexStringViaStringConcatArrayConvertAll(byte[] bytes) {
    return string.Concat(Array.ConvertAll(bytes, b => b.ToString("X2")));
}
static string ByteArrayToHexStringViaBitConverter(byte[] bytes) {
    string hex = BitConverter.ToString(bytes);
    return hex.Replace("-", "");
}
static string ByteArrayToHexStringViaStringBuilderAggregateByteToString(byte[] bytes) {
    return bytes.Aggregate(new StringBuilder(bytes.Length * 2), (sb, b) => sb.Append(b.ToString("X2"))).ToString();
}
static string ByteArrayToHexStringViaStringBuilderForEachByteToString(byte[] bytes) {
    StringBuilder hex = new StringBuilder(bytes.Length * 2);
    foreach (byte b in bytes)
        hex.Append(b.ToString("X2"));
    return hex.ToString();
}
static string ByteArrayToHexStringViaStringBuilderAggregateAppendFormat(byte[] bytes) {
    return bytes.Aggregate(new StringBuilder(bytes.Length * 2), (sb, b) => sb.AppendFormat("{0:X2}", b)).ToString();
}
static string ByteArrayToHexStringViaStringBuilderForEachAppendFormat(byte[] bytes) {
    StringBuilder hex = new StringBuilder(bytes.Length * 2);
    foreach (byte b in bytes)
        hex.AppendFormat("{0:X2}", b);
    return hex.ToString();
}
static string ByteArrayToHexViaByteManipulation(byte[] bytes) {
    char[] c = new char[bytes.Length * 2];
    byte b;
    for (int i = 0; i < bytes.Length; i++) {
        b = ((byte)(bytes[i] >> 4));
        c[i * 2] = (char)(b > 9 ? b + 0x37 : b + 0x30);
        b = ((byte)(bytes[i] & 0xF));
        c[i * 2 + 1] = (char)(b > 9 ? b + 0x37 : b + 0x30);
    }
    return new string(c);
}
static string ByteArrayToHexViaByteManipulation2(byte[] bytes) {
    char[] c = new char[bytes.Length * 2];
    int b;
    for (int i = 0; i < bytes.Length; i++) {
        b = bytes[i] >> 4;
        c[i * 2] = (char)(55 + b + (((b - 10) >> 31) & -7));
        b = bytes[i] & 0xF;
        c[i * 2 + 1] = (char)(55 + b + (((b - 10) >> 31) & -7));
    }
    return new string(c);
}
static string ByteArrayToHexViaSoapHexBinary(byte[] bytes) {
    SoapHexBinary soapHexBinary = new SoapHexBinary(bytes);
    return soapHexBinary.ToString();
}
static string ByteArrayToHexViaLookupAndShift(byte[] bytes) {
    StringBuilder result = new StringBuilder(bytes.Length * 2);
    string hexAlphabet = "0123456789ABCDEF";
    foreach (byte b in bytes) {
        result.Append(hexAlphabet[(int)(b >> 4)]);
        result.Append(hexAlphabet[(int)(b & 0xF)]);
    }
    return result.ToString();
}
static readonly uint* _lookup32UnsafeP = (uint*)GCHandle.Alloc(_Lookup32, GCHandleType.Pinned).AddrOfPinnedObject();
static string ByteArrayToHexViaLookup32UnsafeDirect(byte[] bytes) {
    var lookupP = _lookup32UnsafeP;
    var result = new string((char)0, bytes.Length * 2);
    fixed (byte* bytesP = bytes)
    fixed (char* resultP = result) {
        uint* resultP2 = (uint*)resultP;
        for (int i = 0; i < bytes.Length; i++) {
            resultP2[i] = lookupP[bytesP[i]];
        }
    }
    return result;
}
static uint[] _Lookup32 = Enumerable.Range(0, 255).Select(i => {
    string s = i.ToString("X2");
    return ((uint)s[0]) + ((uint)s[1] << 16);
}).ToArray();
static string ByteArrayToHexViaLookupPerByte(byte[] bytes) {
    var result = new char[bytes.Length * 2];
    for (int i = 0; i < bytes.Length; i++)
    {
        var val = _Lookup32[bytes[i]];
        result[2*i] = (char)val;
        result[2*i + 1] = (char) (val >> 16);
    }
    return new string(result);
}
static string ByteArrayToHexViaLookup(byte[] bytes) {
    string[] hexStringTable = new string[] {
        "00", "01", "02", "03", "04", "05", "06", "07", "08", "09", "0A", "0B", "0C", "0D", "0E", "0F",
        "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "1A", "1B", "1C", "1D", "1E", "1F",
        "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "2A", "2B", "2C", "2D", "2E", "2F",
        "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "3A", "3B", "3C", "3D", "3E", "3F",
        "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "4A", "4B", "4C", "4D", "4E", "4F",
        "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "5A", "5B", "5C", "5D", "5E", "5F",
        "60", "61", "62", "63", "64", "65", "66", "67", "68", "69", "6A", "6B", "6C", "6D", "6E", "6F",
        "70", "71", "72", "73", "74", "75", "76", "77", "78", "79", "7A", "7B", "7C", "7D", "7E", "7F",
        "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "8A", "8B", "8C", "8D", "8E", "8F",
        "90", "91", "92", "93", "94", "95", "96", "97", "98", "99", "9A", "9B", "9C", "9D", "9E", "9F",
        "A0", "A1", "A2", "A3", "A4", "A5", "A6", "A7", "A8", "A9", "AA", "AB", "AC", "AD", "AE", "AF",
        "B0", "B1", "B2", "B3", "B4", "B5", "B6", "B7", "B8", "B9", "BA", "BB", "BC", "BD", "BE", "BF",
        "C0", "C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "CA", "CB", "CC", "CD", "CE", "CF",
        "D0", "D1", "D2", "D3", "D4", "D5", "D6", "D7", "D8", "D9", "DA", "DB", "DC", "DD", "DE", "DF",
        "E0", "E1", "E2", "E3", "E4", "E5", "E6", "E7", "E8", "E9", "EA", "EB", "EC", "ED", "EE", "EF",
        "F0", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "FA", "FB", "FC", "FD", "FE", "FF",
    };
    StringBuilder result = new StringBuilder(bytes.Length * 2);
    foreach (byte b in bytes) {
        result.Append(hexStringTable[b]);
    }
    return result.ToString();
} 
```

### 更新 (2010-01-13)

添加了 Waleed 对分析的回答。蛮快。

### 更新 (2011-10-05)

为完整性添加`string.Concat` `Array.ConvertAll`了变体（需要 .NET 4.0）。`string.Join`与版本相提并论。

### 更新 (2012-02-05)

测试存储库包括更多变体，例如`StringBuilder.Append(b.ToString("X2"))`. 没有人扰乱结果。例如，`foreach`比 快，但仍然获胜。`{IEnumerable}.Aggregate``BitConverter`

### 更新 (2012-04-03)

添加了 Mykroft 的`SoapHexBinary`分析答案，该答案占据了第三位。

### 更新 (2013-01-15)

添加了 CodesInChaos 的字节操作答案，它占据了第一名（在大文本块上占很大比例）。

### 更新 (2013-05-23)

添加了 Nathan Moinvaziri 的查找答案和来自 Brian Lambert 博客的变体。两者都相当快，但在我使用的测试机器（AMD Phenom 9750）上没有领先。

### 更新 (2014-07-31)

添加了@CodesInChaos 的新的基于字节的查找答案。它似乎在句子测试和全文测试中都处于领先地位。

### 更新 (2015-08-20)

[在这个答案的 repo](https://github.com/patridge/PerformanceStubs)中添加了[空气呼吸器的](https://github.com/airbreather)优化和`unsafe`变体。如果您想在不安全的游戏中玩，您可以在短字符串和大文本方面获得比之前任何顶级赢家的巨大性能提升。

* * *

## 回答 #3

> 赞同：255
> 
> 时间：2010-03-31T20:42:47.303

有一个名为[SoapHexBinary](https://msdn.microsoft.com/en-us/library/system.runtime.remoting.metadata.w3cxsd2001.soaphexbinary.aspx)的类可以完全满足您的需求。

```
using System.Runtime.Remoting.Metadata.W3cXsd2001;

public static byte[] GetStringToBytes(string value)
{
    SoapHexBinary shb = SoapHexBinary.Parse(value);
    return shb.Value;
}

public static string GetBytesToString(byte[] value)
{
    SoapHexBinary shb = new SoapHexBinary(value);
    return shb.ToString();
} 
```

* * *

## 回答 #4

> 赞同：152
> 
> 时间：2013-01-15T08:04:48.533

在编写加密代码时，通常会避免依赖数据的分支和表查找，以确保运行时不依赖于数据，因为依赖于数据的时序会导致边信道攻击。

它也非常快。

```
static string ByteToHexBitFiddle(byte[] bytes)
{
    char[] c = new char[bytes.Length * 2];
    int b;
    for (int i = 0; i < bytes.Length; i++) {
        b = bytes[i] >> 4;
        c[i * 2] = (char)(55 + b + (((b-10)>>31)&-7));
        b = bytes[i] & 0xF;
        c[i * 2 + 1] = (char)(55 + b + (((b-10)>>31)&-7));
    }
    return new string(c);
} 
```

[Ph'nlui mglw'nafh 克苏鲁 R'lyeh wgah'nagl fhtagn]

* * *

> 放弃所有希望，你们进入这里

对奇怪的摆弄的解释：

1.  `bytes[i] >> 4`提取一个字节的高半字节
    `bytes[i] & 0xF`提取一个字节的低半字节
2.  `b - 10`
    用于`< 0`值`b < 10`，将变为十进制数字
    用于`>= 0`值`b > 10`，将变为从`A`to的字母`F`。
3.  `i >> 31`由于符号扩展，使用带符号的 32 位整数提取符号。这将是`-1`for`i < 0`和`0`for `i >= 0`。
4.  结合 2) 和 3)，表明`(b-10)>>31`将`0`用于字母和`-1`数字。
5.  查看字母的大小写，最后一个和变为`0`，并且`b`在 10 到 15 的范围内。我们希望将其映射到`A`(65) 到`F`(70)，这意味着添加 55 ( `'A'-10`)。
6.  看看数字的情况，我们想要调整最后一个加数，使其`b`从 0 到 9 映射到`0`(48) 到`9`(57) 的范围。这意味着它需要变为 -7 ( `'0' - 55`)。
    现在我们可以乘以 7。但由于 -1 表示所有位为 1，我们可以改为使用`& -7`since`(0 & -7) == 0`和`(-1 & -7) == -7`。

一些进一步的考虑：

*   我没有使用第二个循环变量来索引`c`，因为测量表明计算它`i`更便宜。
*   完全使用`i < bytes.Length`循环的上限允许 JITter 消除对 的边界检查`bytes[i]`，因此我选择了该变体。
*   制作`b`一个 int 允许不必要的从和到字节的转换。

* * *

## 回答 #5

> 赞同：111
> 
> 时间：2008-11-22T14:29:19.300

如果您想要比 更多的灵活性`BitConverter`，但又不想要那些笨重的 1990 年代风格的显式循环，那么您可以这样做：

```
String.Join(String.Empty, Array.ConvertAll(bytes, x => x.ToString("X2"))); 
```

或者，如果您使用的是 .NET 4.0：

```
String.Concat(Array.ConvertAll(bytes, x => x.ToString("X2"))); 
```

（后者来自对原始帖子的评论。）

* * *

## 回答 #6

> 赞同：79
> 
> 时间：2014-06-21T16:44:25.230

另一种基于查找表的方法。这个对每个字节只使用一个查找表，而不是每个半字节的查找表。

```
private static readonly uint[] _lookup32 = CreateLookup32();

private static uint[] CreateLookup32()
{
    var result = new uint[256];
    for (int i = 0; i < 256; i++)
    {
        string s=i.ToString("X2");
        result[i] = ((uint)s[0]) + ((uint)s[1] << 16);
    }
    return result;
}

private static string ByteArrayToHexViaLookup32(byte[] bytes)
{
    var lookup32 = _lookup32;
    var result = new char[bytes.Length * 2];
    for (int i = 0; i < bytes.Length; i++)
    {
        var val = lookup32[bytes[i]];
        result[2*i] = (char)val;
        result[2*i + 1] = (char) (val >> 16);
    }
    return new string(result);
} 
```

我还在查找表中使用`ushort`,测试了它的变体。`struct{char X1, X2}``struct{byte X1, X2}`

根据编译目标（x86、X64），它们要么具有大致相同的性能，要么比此变体稍慢。

* * *

为了获得更高的性能，它的`unsafe`兄弟：

```
private static readonly uint[] _lookup32Unsafe = CreateLookup32Unsafe();
private static readonly uint* _lookup32UnsafeP = (uint*)GCHandle.Alloc(_lookup32Unsafe,GCHandleType.Pinned).AddrOfPinnedObject();

private static uint[] CreateLookup32Unsafe()
{
    var result = new uint[256];
    for (int i = 0; i < 256; i++)
    {
        string s=i.ToString("X2");
        if(BitConverter.IsLittleEndian)
            result[i] = ((uint)s[0]) + ((uint)s[1] << 16);
        else
            result[i] = ((uint)s[1]) + ((uint)s[0] << 16);
    }
    return result;
}

public static string ByteArrayToHexViaLookup32Unsafe(byte[] bytes)
{
    var lookupP = _lookup32UnsafeP;
    var result = new char[bytes.Length * 2];
    fixed(byte* bytesP = bytes)
    fixed (char* resultP = result)
    {
        uint* resultP2 = (uint*)resultP;
        for (int i = 0; i < bytes.Length; i++)
        {
            resultP2[i] = lookupP[bytesP[i]];
        }
    }
    return new string(result);
} 
```

或者，如果您认为可以直接写入字符串：

```
public static string ByteArrayToHexViaLookup32UnsafeDirect(byte[] bytes)
{
    var lookupP = _lookup32UnsafeP;
    var result = new string((char)0, bytes.Length * 2);
    fixed (byte* bytesP = bytes)
    fixed (char* resultP = result)
    {
        uint* resultP2 = (uint*)resultP;
        for (int i = 0; i < bytes.Length; i++)
        {
            resultP2[i] = lookupP[bytesP[i]];
        }
    }
    return result;
} 
```

* * *

## 回答 #7

> 赞同：68
> 
> 时间：2008-11-22T14:23:26.957

您可以使用 BitConverter.ToString 方法：

```
byte[] bytes = {0, 1, 2, 4, 8, 16, 32, 64, 128, 256}
Console.WriteLine( BitConverter.ToString(bytes)); 
```

输出：

> 00-01-02-04-08-10-20-40-80-FF

更多信息：*[BitConverter.ToString 方法 (Byte[])](https://msdn.microsoft.com/en-us/library/3a733s97.aspx)*

* * *

## 回答 #8

> 赞同：57
> 
> 时间：2009-03-11T00:51:09.213

我今天刚遇到同样的问题，我遇到了这段代码：

```
private static string ByteArrayToHex(byte[] barray)
{
    char[] c = new char[barray.Length * 2];
    byte b;
    for (int i = 0; i < barray.Length; ++i)
    {
        b = ((byte)(barray[i] >> 4));
        c[i * 2] = (char)(b > 9 ? b + 0x37 : b + 0x30);
        b = ((byte)(barray[i] & 0xF));
        c[i * 2 + 1] = (char)(b > 9 ? b + 0x37 : b + 0x30);
    }
    return new string(c);
} 
```

来源：论坛帖子*[byte[] Array to Hex String](http://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/3928b8cb-3703-4672-8ccd-33718148d1e3/)*（参见 PZahra 的帖子）。我稍微修改了代码以删除 0x 前缀。

我对代码进行了一些性能测试，它几乎比使用 BitConverter.ToString() 快八倍（根据 patridge 的帖子最快）。

* * *

## 回答 #9

> 赞同：24
> 
> 时间：2020-10-22T21:25:39.980

从 .NET 5 RC2 开始，您可以使用：

*   [`Convert.ToHexString(byte[] inArray)`](https://docs.microsoft.com/en-us/dotnet/api/system.convert.tohexstring)它返回一个`string`和
*   [`Convert.FromHexString(string s)`](https://docs.microsoft.com/en-us/dotnet/api/system.convert.fromhexstring)它返回一个`byte[]`.

可以使用带跨度参数的重载。

* * *

## 回答 #10

> 赞同：22
> 
> 时间：2014-10-10T16:39:28.987

这是对[Tomalak 非常受欢迎的答案](https://stackoverflow.com/a/311179)（以及随后的编辑）的[修订版 4的答案。](https://stackoverflow.com/revisions/311179/4)

我会证明这个编辑是错误的，并解释为什么它可以被还原。在此过程中，您可能会学到一两件关于一些内部结构的知识，并看到另一个例子，说明什么是过早优化以及它如何影响您。

**tl;dr：**如果您很着急，只需使用`Convert.ToByte`and `String.Substring`（下面的“原始代码”），如果您不想重新实现，这是最好的组合`Convert.ToByte`。`Convert.ToByte`如果您*需要*性能，请使用不使用的更高级的东西（请参阅其他答案） 。除了与 结合使用之外，不要使用其他任何东西**，**除非有人在这个答案的评论中有有趣的事情要说。`String.Substring``Convert.ToByte`

**警告：***如果*`Convert.ToByte(char[], Int32)`在框架中实现了重载，此答案可能会过时。这不太可能很快发生。

*作为一般规则，我不太喜欢说“不要过早优化”，因为没有人知道“过早”是什么时候。在决定是否进行优化时，您唯一必须考虑的是：“我是否有时间和资源来正确研究优化方法？”。如果你不这样做，那就太早了，等到你的项目更成熟或者直到你需要性能（如果真的需要，那么你会**抓紧**时间）。与此同时，做最简单的事情可能会起作用。*

原始代码：

```
 public static byte[] HexadecimalStringToByteArray_Original(string input)
    {
        var outputLength = input.Length / 2;
        var output = new byte[outputLength];
        for (var i = 0; i < outputLength; i++)
            output[i] = Convert.ToByte(input.Substring(i * 2, 2), 16);
        return output;
    } 
```

修订版 4：

```
 public static byte[] HexadecimalStringToByteArray_Rev4(string input)
    {
        var outputLength = input.Length / 2;
        var output = new byte[outputLength];
        using (var sr = new StringReader(input))
        {
            for (var i = 0; i < outputLength; i++)
                output[i] = Convert.ToByte(new string(new char[2] { (char)sr.Read(), (char)sr.Read() }), 16);
        }
        return output;
    } 
```

修订版避免`String.Substring`使用 a`StringReader`代替。给出的原因是：

> 编辑：您可以通过使用单遍解析器来提高长字符串的性能，如下所示：

好吧，看看 的[参考代码`String.Substring`](https://referencesource.microsoft.com/#mscorlib/system/string.cs,115953b3f767ea7d)，它显然已经是“单程”了；为什么不应该呢？它在字节级别上运行，而不是在代理对上运行。

但是，它确实分配了一个新字符串，但是无论如何您都需要分配一个传递给它`Convert.ToByte`。此外，修订版中提供的解决方案在每次迭代时分配另一个对象（两个字符数组）；您可以安全地将该分配放在循环之外并重用数组以避免这种情况。

```
 public static byte[] HexadecimalStringToByteArray(string input)
    {
        var outputLength = input.Length / 2;
        var output = new byte[outputLength];
        var numeral = new char[2];
        using (var sr = new StringReader(input))
        {
            for (var i = 0; i < outputLength; i++)
            {
                numeral[0] = (char)sr.Read();
                numeral[1] = (char)sr.Read();
                output[i] = Convert.ToByte(new string(numeral), 16);
            }
        }
        return output;
    } 
```

*每个十六进制`numeral`表示使用两个数字（符号）的单个八位组。*

但是，为什么要打`StringReader.Read`两次电话？只需调用它的第二个重载并要求它一次读取双字符数组中的两个字符；并减少两个呼叫量。

```
 public static byte[] HexadecimalStringToByteArray(string input)
    {
        var outputLength = input.Length / 2;
        var output = new byte[outputLength];
        var numeral = new char[2];
        using (var sr = new StringReader(input))
        {
            for (var i = 0; i < outputLength; i++)
            {
                var read = sr.Read(numeral, 0, 2);
                Debug.Assert(read == 2);
                output[i] = Convert.ToByte(new string(numeral), 16);
            }
        }
        return output;
    } 
```

您剩下的是一个字符串阅读器，其唯一添加的“值”是`_pos`您可以声明自己的并行索引（内部）（`j`例如）、冗余长度变量（内部`_length`）和对输入的冗余引用字符串（内部`_s`）。换句话说，它是无用的。

如果您想知道如何`Read`“读取”，只需查看[代码](https://referencesource.microsoft.com/#mscorlib/system/io/stringreader.cs,2db106106e966794)，它所做的只是调用`String.CopyTo`输入字符串。其余的只是记账开销，以维护我们不需要的值。

所以，已经删除了字符串阅读器，然后打电话给`CopyTo`你自己；它更简单、更清晰、更高效。

```
 public static byte[] HexadecimalStringToByteArray(string input)
    {
        var outputLength = input.Length / 2;
        var output = new byte[outputLength];
        var numeral = new char[2];
        for (int i = 0, j = 0; i < outputLength; i++, j += 2)
        {
            input.CopyTo(j, numeral, 0, 2);
            output[i] = Convert.ToByte(new string(numeral), 16);
        }
        return output;
    } 
```

你真的需要一个`j`以两个平行的步骤递增的索引`i`吗？当然不是，只需乘以`i`2（编译器应该能够优化到加法）。

```
 public static byte[] HexadecimalStringToByteArray_BestEffort(string input)
    {
        var outputLength = input.Length / 2;
        var output = new byte[outputLength];
        var numeral = new char[2];
        for (int i = 0; i < outputLength; i++)
        {
            input.CopyTo(i * 2, numeral, 0, 2);
            output[i] = Convert.ToByte(new string(numeral), 16);
        }
        return output;
    } 
```

现在的解决方案是什么样的？就像一开始一样，只是不是使用`String.Substring`分配字符串并将数据复制到其中，而是使用一个中间数组，将十六进制数字复制到其中，然后自己分配字符串并*再次*复制数据数组并进入字符串（当你在字符串构造函数中传递它时）。如果字符串已经在实习池中，则第二个副本可能会被优化，但`String.Substring`在这些情况下也可以避免它。

事实上，如果你`String.Substring`再看一遍，你会发现它使用了一些关于如何构造字符串的底层内部知识来比通常更快地分配字符串，并且它内联了`CopyTo`直接使用的相同代码以避免通话开销。

`String.Substring`

*   最坏情况：一次快速分配，一次快速复制。
*   最佳情况：不分配，不复制。

手动方式

*   最坏情况：两次正常分配，一份正常拷贝，一份快速拷贝。
*   最佳情况：一份正常分配，一份正常复制。

结论？**如果您想使用`Convert.ToByte(String, Int32)`**（因为您不想自己重新实现该功能），似乎没有办法击败`String.Substring`；你所做的只是循环往复，重新发明轮子（仅使用次优材料）。

请注意，如果您不需要极高的性能，使用`Convert.ToByte`and是一个完全有效的选择。`String.Substring`请记住：只有在您有时间和资源来调查它如何正常工作时才选择替代方案。

如果有`Convert.ToByte(char[], Int32)`，事情当然会有所不同（可以做我上面描述的事情并完全避免`String`）。

我怀疑那些通过“避免`String.Substring`”来报告更好性能的人也会避免`Convert.ToByte(String, Int32)`，如果你仍然需要性能，你应该这样做。查看无数其他答案，以发现所有不同的方法来做到这一点。

免责声明：我没有反编译最新版本的框架来验证参考源是否是最新的，我假设它是最新的。

现在，这一切听起来都很好，也很合乎逻辑，如果你能做到这一点，希望甚至是显而易见的。但这是真的吗？

```
Intel(R) Core(TM) i7-3720QM CPU @ 2.60GHz
    Cores: 8
    Current Clock Speed: 2600
    Max Clock Speed: 2600
--------------------
Parsing hexadecimal string into an array of bytes
--------------------
HexadecimalStringToByteArray_Original: 7,777.09 average ticks (over 10000 runs), 1.2X
HexadecimalStringToByteArray_BestEffort: 8,550.82 average ticks (over 10000 runs), 1.1X
HexadecimalStringToByteArray_Rev4: 9,218.03 average ticks (over 10000 runs), 1.0X 
```

是的！

*用于工作台框架的 Partridge 的道具，很容易破解。使用的输入是重复 5000 次以生成 100,000 字节长的字符串的以下 SHA-1 哈希。*

```
209113288F93A9AB8E474EA78D899AFDBB874355 
```

玩得开心！（但要适度优化。）

* * *

## 回答 #11

> 赞同：19
> 
> 时间：2011-06-08T06:01:42.040

这个问题也可以使用查找表来解决。这将需要用于编码器和解码器的少量静态存储器。但是，此方法将很快：

*   编码器表 512 字节或 1024 字节（如果需要大小写则为两倍大小）
*   解码器表 256 字节或 64 KiB（单字符查找或双字符查找）

我的解决方案使用 1024 字节作为编码表，使用 256 字节进行解码。

## 解码

```
private static readonly byte[] LookupTable = new byte[] {
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
};

private static byte Lookup(char c)
{
  var b = LookupTable[c];
  if (b == 255)
    throw new IOException("Expected a hex character, got " + c);
  return b;
}

public static byte ToByte(char[] chars, int offset)
{
  return (byte)(Lookup(chars[offset]) << 4 | Lookup(chars[offset + 1]));
} 
```

## 编码

```
private static readonly char[][] LookupTableUpper;
private static readonly char[][] LookupTableLower;

static Hex()
{
  LookupTableLower = new char[256][];
  LookupTableUpper = new char[256][];
  for (var i = 0; i < 256; i++)
  {
    LookupTableLower[i] = i.ToString("x2").ToCharArray();
    LookupTableUpper[i] = i.ToString("X2").ToCharArray();
  }
}

public static char[] ToCharLower(byte[] b, int bOffset)
{
  return LookupTableLower[b[bOffset]];
}

public static char[] ToCharUpper(byte[] b, int bOffset)
{
  return LookupTableUpper[b[bOffset]];
} 
```

## 比较

```
StringBuilderToStringFromBytes:   106148
BitConverterToStringFromBytes:     15783
ArrayConvertAllToStringFromBytes:  54290
ByteManipulationToCharArray:        8444
TableBasedToCharArray:              5651 * 
```

* 这个解决方案

## 笔记

在解码期间，可能会发生 IOException 和 IndexOutOfRangeException（如果字符的值太高 > 256）。应该实现对流或数组进行解码/编码的方法，这只是一个概念证明。

* * *

## 回答 #12

> 赞同：19
> 
> 时间：2013-07-29T12:23:25.170

由@CodesInChaos 补充回答（反向方法）

```
public static byte[] HexToByteUsingByteManipulation(string s)
{
    byte[] bytes = new byte[s.Length / 2];
    for (int i = 0; i < bytes.Length; i++)
    {
        int hi = s[i*2] - 65;
        hi = hi + 10 + ((hi >> 31) & 7);

        int lo = s[i*2 + 1] - 65;
        lo = lo + 10 + ((lo >> 31) & 7) & 0x0f;

        bytes[i] = (byte) (lo | hi << 4);
    }
    return bytes;
} 
```

解释：

`& 0x0f`也是支持小写字母

`hi = hi + 10 + ((hi >> 31) & 7);`是相同的：

`hi = ch-65 + 10 + (((ch-65) >> 31) & 7);`

对于 '0'..'9' 它与`hi = ch - 65 + 10 + 7;`which is相同`hi = ch - 48`（这是因为`0xffffffff & 7`）。

对于 'A'..'F' 它是`hi = ch - 65 + 10;`（这是因为`0x00000000 & 7`）。

对于'a'..'f'，我们必须使用大数字，因此我们必须`0`通过使用`& 0x0f`..

65是代码`'A'`

48 是代码`'0'`

7 是ASCII 表 ( )之间`'9'`和之间的字母数。`'A'``...456789:;<=>?@ABCD...`

* * *

## 回答 #13

> 赞同：14
> 
> 时间：2021-07-30T19:56:52.283

# 点网 5 更新

## 要将`byte[]`(byte array) 转换为 hexadecimal `string`，请使用：

### `System.Convert.ToHexString`

```
var myBytes = new byte[100];
var myString = System.Convert.ToHexString(myBytes); 
```

## 要将十六进制转换`string`为`byte[]`，请使用：

### `System.Convert.FromHexString`

```
var myString  = "E10B116E8530A340BCC7B3EAC208487B";
var myBytes = System.Convert.FromHexString(myString); 
```

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2010-10-20T00:55:42.277

为什么要复杂？这在 Visual Studio 2008 中很简单：

C＃：

```
string hex = BitConverter.ToString(YourByteArray).Replace("-", ""); 
```

VB：

```
Dim hex As String = BitConverter.ToString(YourByteArray).Replace("-", "") 
```

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2010-01-12T16:51:38.193

这是一个很棒的帖子。我喜欢 Waleed 的解决方案。我还没有通过 patridge 的测试运行它，但它似乎相当快。我还需要逆向过程，将十六进制字符串转换为字节数组，因此我将其编写为对 Waleed 解决方案的反转。不确定它是否比 Tomalak 的原始解决方案更快。同样，我也没有通过 patridge 的测试运行相反的过程。

```
private byte[] HexStringToByteArray(string hexString)
{
    int hexStringLength = hexString.Length;
    byte[] b = new byte[hexStringLength / 2];
    for (int i = 0; i < hexStringLength; i += 2)
    {
        int topChar = (hexString[i] > 0x40 ? hexString[i] - 0x37 : hexString[i] - 0x30) << 4;
        int bottomChar = hexString[i + 1] > 0x40 ? hexString[i + 1] - 0x37 : hexString[i + 1] - 0x30;
        b[i / 2] = Convert.ToByte(topChar + bottomChar);
    }
    return b;
} 
```

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2012-05-22T16:50:58.560

不要在这里堆砌许多答案，但我发现了一个相当优化的（比接受的要好约 4.5 倍），直接实现十六进制字符串解析器。首先，我的测试输出（第一批是我的实现）：

```
Give me that string:
04c63f7842740c77e545bb0b2ade90b384f119f6ab57b680b7aa575a2f40939f

Time to parse 100,000 times: 50.4192 ms
Result as base64: BMY/eEJ0DHflRbsLKt6Qs4TxGfarV7aAt6pXWi9Ak58=
BitConverter'd: 04-C6-3F-78-42-74-0C-77-E5-45-BB-0B-2A-DE-90-B3-84-F1-19-F6-AB-5
7-B6-80-B7-AA-57-5A-2F-40-93-9F

Accepted answer: (StringToByteArray)
Time to parse 100000 times: 233.1264ms
Result as base64: BMY/eEJ0DHflRbsLKt6Qs4TxGfarV7aAt6pXWi9Ak58=
BitConverter'd: 04-C6-3F-78-42-74-0C-77-E5-45-BB-0B-2A-DE-90-B3-84-F1-19-F6-AB-5
7-B6-80-B7-AA-57-5A-2F-40-93-9F

With Mono's implementation:
Time to parse 100000 times: 777.2544ms
Result as base64: BMY/eEJ0DHflRbsLKt6Qs4TxGfarV7aAt6pXWi9Ak58=
BitConverter'd: 04-C6-3F-78-42-74-0C-77-E5-45-BB-0B-2A-DE-90-B3-84-F1-19-F6-AB-5
7-B6-80-B7-AA-57-5A-2F-40-93-9F

With SoapHexBinary:
Time to parse 100000 times: 845.1456ms
Result as base64: BMY/eEJ0DHflRbsLKt6Qs4TxGfarV7aAt6pXWi9Ak58=
BitConverter'd: 04-C6-3F-78-42-74-0C-77-E5-45-BB-0B-2A-DE-90-B3-84-F1-19-F6-AB-5
7-B6-80-B7-AA-57-5A-2F-40-93-9F 
```

base64 和 'BitConverter'd' 行用于测试正确性。请注意，它们是相等的。

实施：

```
public static byte[] ToByteArrayFromHex(string hexString)
{
  if (hexString.Length % 2 != 0) throw new ArgumentException("String must have an even length");
  var array = new byte[hexString.Length / 2];
  for (int i = 0; i < hexString.Length; i += 2)
  {
    array[i/2] = ByteFromTwoChars(hexString[i], hexString[i + 1]);
  }
  return array;
}

private static byte ByteFromTwoChars(char p, char p_2)
{
  byte ret;
  if (p <= '9' && p >= '0')
  {
    ret = (byte) ((p - '0') << 4);
  }
  else if (p <= 'f' && p >= 'a')
  {
    ret = (byte) ((p - 'a' + 10) << 4);
  }
  else if (p <= 'F' && p >= 'A')
  {
    ret = (byte) ((p - 'A' + 10) << 4);
  } else throw new ArgumentException("Char is not a hex digit: " + p,"p");

  if (p_2 <= '9' && p_2 >= '0')
  {
    ret |= (byte) ((p_2 - '0'));
  }
  else if (p_2 <= 'f' && p_2 >= 'a')
  {
    ret |= (byte) ((p_2 - 'a' + 10));
  }
  else if (p_2 <= 'F' && p_2 >= 'A')
  {
    ret |= (byte) ((p_2 - 'A' + 10));
  } else throw new ArgumentException("Char is not a hex digit: " + p_2, "p_2");

  return ret;
} 
```

我尝试了一些东西`unsafe`并将（显然是多余的）字符到半字节`if`序列移动到另一种方法，但这是最快的。

（我承认这回答了一半的问题。我觉得 string->byte[] 转换的代表性不足，而 byte[]->string 角度似乎得到了很好的覆盖。因此，这个答案。）

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2010-09-29T18:41:29.303

来自 Microsoft 的开发人员，一个不错的简单转换：

```
public static string ByteArrayToString(byte[] ba) 
{
    // Concatenate the bytes into one long string
    return ba.Aggregate(new StringBuilder(32),
                            (sb, b) => sb.Append(b.ToString("X2"))
                            ).ToString();
} 
```

虽然上述内容简洁紧凑，但性能迷会使用枚举器对其进行尖叫。[您可以通过改进版的Tomalak 原始答案](https://stackoverflow.com/a/311179/3258851)获得最佳性能：

```
public static string ByteArrayToString(byte[] ba)   
{   
   StringBuilder hex = new StringBuilder(ba.Length * 2);   

   for(int i=0; i < ba.Length; i++)       // <-- Use for loop is faster than foreach   
       hex.Append(ba[i].ToString("X2"));   // <-- ToString is faster than AppendFormat   

   return hex.ToString();   
} 
```

这是迄今为止我在这里看到的所有例程中最快的。不要只相信我的话...性能测试每个例程并亲自检查其 CIL 代码。

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2013-12-20T03:45:25.273

**安全版本：**

```
public static class HexHelper
{
    [System.Diagnostics.Contracts.Pure]
    public static string ToHex(this byte[] value)
    {
        if (value == null)
            throw new ArgumentNullException("value");

        const string hexAlphabet = @"0123456789ABCDEF";

        var chars = new char[checked(value.Length * 2)];
        unchecked
        {
            for (int i = 0; i < value.Length; i++)
            {
                chars[i * 2] = hexAlphabet[value[i] >> 4];
                chars[i * 2 + 1] = hexAlphabet[value[i] & 0xF];
            }
        }
        return new string(chars);
    }

    [System.Diagnostics.Contracts.Pure]
    public static byte[] FromHex(this string value)
    {
        if (value == null)
            throw new ArgumentNullException("value");
        if (value.Length % 2 != 0)
            throw new ArgumentException("Hexadecimal value length must be even.", "value");

        unchecked
        {
            byte[] result = new byte[value.Length / 2];
            for (int i = 0; i < result.Length; i++)
            {
                // 0(48) - 9(57) -> 0 - 9
                // A(65) - F(70) -> 10 - 15
                int b = value[i * 2]; // High 4 bits.
                int val = ((b - '0') + ((('9' - b) >> 31) & -7)) << 4;
                b = value[i * 2 + 1]; // Low 4 bits.
                val += (b - '0') + ((('9' - b) >> 31) & -7);
                result[i] = checked((byte)val);
            }
            return result;
        }
    }
} 
```

**不安全的版本**适合那些喜欢性能并且不怕不安全的人。ToHex 快 35%，FromHex 快 10%。

```
public static class HexUnsafeHelper
{
    [System.Diagnostics.Contracts.Pure]
    public static unsafe string ToHex(this byte[] value)
    {
        if (value == null)
            throw new ArgumentNullException("value");

        const string alphabet = @"0123456789ABCDEF";

        string result = new string(' ', checked(value.Length * 2));
        fixed (char* alphabetPtr = alphabet)
        fixed (char* resultPtr = result)
        {
            char* ptr = resultPtr;
            unchecked
            {
                for (int i = 0; i < value.Length; i++)
                {
                    *ptr++ = *(alphabetPtr + (value[i] >> 4));
                    *ptr++ = *(alphabetPtr + (value[i] & 0xF));
                }
            }
        }
        return result;
    }

    [System.Diagnostics.Contracts.Pure]
    public static unsafe byte[] FromHex(this string value)
    {
        if (value == null)
            throw new ArgumentNullException("value");
        if (value.Length % 2 != 0)
            throw new ArgumentException("Hexadecimal value length must be even.", "value");

        unchecked
        {
            byte[] result = new byte[value.Length / 2];
            fixed (char* valuePtr = value)
            {
                char* valPtr = valuePtr;
                for (int i = 0; i < result.Length; i++)
                {
                    // 0(48) - 9(57) -> 0 - 9
                    // A(65) - F(70) -> 10 - 15
                    int b = *valPtr++; // High 4 bits.
                    int val = ((b - '0') + ((('9' - b) >> 31) & -7)) << 4;
                    b = *valPtr++; // Low 4 bits.
                    val += (b - '0') + ((('9' - b) >> 31) & -7);
                    result[i] = checked((byte)val);
                }
            }
            return result;
        }
    }
} 
```

**顺便说一句** ，对于每次调用转换函数错误时初始化字母表的基准测试，字母表必须是 const（对于字符串）或静态只读（对于 char[]）。然后 byte[] 到字符串的基于字母的转换变得与字节操作版本一样快。

当然，测试必须在 Release 中编译（带优化），并且关闭调试选项“Suppress JIT optimization”（如果代码必须是可调试的，则与“Enable Just My Code”相同）。

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2015-12-17T11:15:19.587

Waleed Eissa 代码的反函数（十六进制字符串到字节数组）：

```
 public static byte[] HexToBytes(this string hexString)        
    {
        byte[] b = new byte[hexString.Length / 2];            
        char c;
        for (int i = 0; i < hexString.Length / 2; i++)
        {
            c = hexString[i * 2];
            b[i] = (byte)((c < 0x40 ? c - 0x30 : (c < 0x47 ? c - 0x37 : c - 0x57)) << 4);
            c = hexString[i * 2 + 1];
            b[i] += (byte)(c < 0x40 ? c - 0x30 : (c < 0x47 ? c - 0x37 : c - 0x57));
        }

        return b;
    } 
```

支持小写的 Waleed Eissa 函数：

```
 public static string BytesToHex(this byte[] barray, bool toLowerCase = true)
    {
        byte addByte = 0x37;
        if (toLowerCase) addByte = 0x57;
        char[] c = new char[barray.Length * 2];
        byte b;
        for (int i = 0; i < barray.Length; ++i)
        {
            b = ((byte)(barray[i] >> 4));
            c[i * 2] = (char)(b > 9 ? b + addByte : b + 0x30);
            b = ((byte)(barray[i] & 0xF));
            c[i * 2 + 1] = (char)(b > 9 ? b + addByte : b + 0x30);
        }

        return new string(c);
    } 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2008-11-22T13:27:49.347

*扩展方法*（免责声明：完全未经测试的代码，顺便说一句......）：

```
public static class ByteExtensions
{
    public static string ToHexString(this byte[] ba)
    {
        StringBuilder hex = new StringBuilder(ba.Length * 2);

        foreach (byte b in ba)
        {
            hex.AppendFormat("{0:x2}", b);
        }
        return hex.ToString();
    }
} 
```

等等。使用[Tomalak 的三个解决方案](https://stackoverflow.com/questions/311165/how-do-you-convert-a-byte-array-to-a-hexadecimal-string-and-vice-versa/311179#311179)中的任何一个（最后一个是字符串上的扩展方法）。

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2020-10-23T10:58:33.440

老派人士的最快方法……想念你的指点

```
 static public byte[] HexStrToByteArray(string str)
    {
        byte[] res = new byte[(str.Length % 2 != 0 ? 0 : str.Length / 2)]; //check and allocate memory
        for (int i = 0, j = 0; j < res.Length; i += 2, j++) //convert loop
            res[j] = (byte)((str[i] % 32 + 9) % 25 * 16 + (str[i + 1] % 32 + 9) % 25);
        return res;
    } 
```

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2021-03-02T09:58:08.157

.NET 5 添加了[Convert.ToHexString](https://docs.microsoft.com/en-us/dotnet/api/system.convert.tohexstring?view=net-5.0)方法。

对于使用旧版本 .NET 的用户

```
internal static class ByteArrayExtensions
{

    public static string ToHexString(this byte[] bytes, Casing casing = Casing.Upper)
    {
        Span<char> result = stackalloc char[0];
        if (bytes.Length > 16)
        {
            var array = new char[bytes.Length * 2];
            result = array.AsSpan();
        }
        else
        {
            result = stackalloc char[bytes.Length * 2];
        }

        int pos = 0;
        foreach (byte b in bytes)
        {
            ToCharsBuffer(b, result, pos, casing);
            pos += 2;
        }

        return result.ToString();
    }

    private static void ToCharsBuffer(byte value, Span<char> buffer, int startingIndex = 0, Casing casing = Casing.Upper)
    {
        uint difference = (((uint)value & 0xF0U) << 4) + ((uint)value & 0x0FU) - 0x8989U;
        uint packedResult = ((((uint)(-(int)difference) & 0x7070U) >> 4) + difference + 0xB9B9U) | (uint)casing;

        buffer[startingIndex + 1] = (char)(packedResult & 0xFF);
        buffer[startingIndex] = (char)(packedResult >> 8);
    }
}

public enum Casing : uint
{
    // Output [ '0' .. '9' ] and [ 'A' .. 'F' ].
    Upper = 0,

    // Output [ '0' .. '9' ] and [ 'a' .. 'f' ].
    Lower = 0x2020U,
} 
```

改编自 .NET 存储库 [https://github.com/dotnet/runtime/blob/v5.0.3/src/libraries/System.Private.CoreLib/src/System/Convert.cs](https://github.com/dotnet/runtime/blob/v5.0.3/src/libraries/System.Private.CoreLib/src/System/Convert.cs) [https://github.com/dotnet /runtime/blob/v5.0.3/src/libraries/Common/src/System/HexConverter.cs](https://github.com/dotnet/runtime/blob/v5.0.3/src/libraries/Common/src/System/HexConverter.cs)

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2009-09-14T21:13:35.893

并用于插入 SQL 字符串（如果您不使用命令参数）：

```
public static String ByteArrayToSQLHexString(byte[] Source)
{
    return = "0x" + BitConverter.ToString(Source).Replace("-", "");
} 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2010-05-22T22:20:18.190

我没有得到你建议的代码，Olipro。`hex[i] + hex[i+1]`显然返回了一个`int`.

我确实做到了，但是通过从 Waleeds 代码中获取一些提示并将其组合在一起，我取得了一些成功。它丑得要命，但根据我的测试（使用 patridges 测试机制），与其他人相比，它似乎工作和执行的时间只有 1/3。取决于输入大小。切换 ?:s 以首先分离 0-9 可能会产生稍快的结果，因为数字多于字母。

```
public static byte[] StringToByteArray2(string hex)
{
    byte[] bytes = new byte[hex.Length/2];
    int bl = bytes.Length;
    for (int i = 0; i < bl; ++i)
    {
        bytes[i] = (byte)((hex[2 * i] > 'F' ? hex[2 * i] - 0x57 : hex[2 * i] > '9' ? hex[2 * i] - 0x37 : hex[2 * i] - 0x30) << 4);
        bytes[i] |= (byte)(hex[2 * i + 1] > 'F' ? hex[2 * i + 1] - 0x57 : hex[2 * i + 1] > '9' ? hex[2 * i + 1] - 0x37 : hex[2 * i + 1] - 0x30);
    }
    return bytes;
} 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2010-06-01T08:19:33.490

就速度而言，这似乎比这里的任何东西都要好：

```
 public static string ToHexString(byte[] data) {
    byte b;
    int i, j, k;
    int l = data.Length;
    char[] r = new char[l * 2];
    for (i = 0, j = 0; i < l; ++i) {
      b = data[i];
      k = b >> 4;
      r[j++] = (char)(k > 9 ? k + 0x37 : k + 0x30);
      k = b & 15;
      r[j++] = (char)(k > 9 ? k + 0x37 : k + 0x30);
    }
    return new string(r);
  } 
```

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2011-06-08T07:09:15.000

对于性能，我会选择 drphrozens 解决方案。解码器的一个微小优化可能是为任一字符使用一个表来摆脱“<< 4”。

显然，这两种方法调用代价高昂。如果对输入或输出数据（可能是 CRC、校验和或其他）进行某种检查，则`if (b == 255)...`可以跳过该方法，从而完全调用该方法。

使用`offset++`and`offset`而不是`offset`and`offset + 1`可能会带来一些理论上的好处，但我怀疑编译器比我处理得更好。

```
private static readonly byte[] LookupTableLow = new byte[] {
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
};

private static readonly byte[] LookupTableHigh = new byte[] {
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0x00, 0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80, 0x90, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xA0, 0xB0, 0xC0, 0xD0, 0xE0, 0xF0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xA0, 0xB0, 0xC0, 0xD0, 0xE0, 0xF0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
};

private static byte LookupLow(char c)
{
  var b = LookupTableLow[c];
  if (b == 255)
    throw new IOException("Expected a hex character, got " + c);
  return b;
}

private static byte LookupHigh(char c)
{
  var b = LookupTableHigh[c];
  if (b == 255)
    throw new IOException("Expected a hex character, got " + c);
  return b;
}

public static byte ToByte(char[] chars, int offset)
{
  return (byte)(LookupHigh(chars[offset++]) | LookupLow(chars[offset]));
} 
```

这只是我的想法，尚未经过测试或基准测试。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2013-08-23T07:07:38.153

这个版本的 ByteArrayToHexViaByteManipulation 可能会更快。

从我的报告中：

*   ByteArrayToHexViaByteManipulation3：1,68 个平均刻度（超过 1000 次运行），17,5X
*   ByteArrayToHexViaByteManipulation2：1,73 平均滴答声（超过 1000 次运行），16,9X
*   ByteArrayToHexViaByteManipulation：2,90 平均刻度（超过 1000 次运行），10,1X
*   ByteArrayToHexViaLookupAndShift：3,22 平均刻度（超过 1000 次运行），9,1X
*   ...

    ```
    static private readonly char[] hexAlphabet = new char[]
        {'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'};
    static string ByteArrayToHexViaByteManipulation3(byte[] bytes)
    {
        char[] c = new char[bytes.Length * 2];
        byte b;
        for (int i = 0; i < bytes.Length; i++)
        {
            b = ((byte)(bytes[i] >> 4));
            c[i * 2] = hexAlphabet[b];
            b = ((byte)(bytes[i] & 0xF));
            c[i * 2 + 1] = hexAlphabet[b];
        }
        return new string(c);
    } 
    ```

我认为这是一种优化：

```
 static private readonly char[] hexAlphabet = new char[]
        {'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'};
    static string ByteArrayToHexViaByteManipulation4(byte[] bytes)
    {
        char[] c = new char[bytes.Length * 2];
        for (int i = 0, ptr = 0; i < bytes.Length; i++, ptr += 2)
        {
            byte b = bytes[i];
            c[ptr] = hexAlphabet[b >> 4];
            c[ptr + 1] = hexAlphabet[b & 0xF];
        }
        return new string(c);
    } 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2014-01-20T23:38:28.110

我将参加这个位摆弄比赛，因为我有一个答案也使用位摆弄来*解码*十六进制。请注意，使用字符数组可能会更快，因为调用`StringBuilder`方法也需要时间。

```
public static String ToHex (byte[] data)
{
    int dataLength = data.Length;
    // pre-create the stringbuilder using the length of the data * 2, precisely enough
    StringBuilder sb = new StringBuilder (dataLength * 2);
    for (int i = 0; i < dataLength; i++) {
        int b = data [i];

        // check using calculation over bits to see if first tuple is a letter
        // isLetter is zero if it is a digit, 1 if it is a letter
        int isLetter = (b >> 7) & ((b >> 6) | (b >> 5)) & 1;

        // calculate the code using a multiplication to make up the difference between
        // a digit character and an alphanumerical character
        int code = '0' + ((b >> 4) & 0xF) + isLetter * ('A' - '9' - 1);
        // now append the result, after casting the code point to a character
        sb.Append ((Char)code);

        // do the same with the lower (less significant) tuple
        isLetter = (b >> 3) & ((b >> 2) | (b >> 1)) & 1;
        code = '0' + (b & 0xF) + isLetter * ('A' - '9' - 1);
        sb.Append ((Char)code);
    }
    return sb.ToString ();
}

public static byte[] FromHex (String hex)
{

    // pre-create the array
    int resultLength = hex.Length / 2;
    byte[] result = new byte[resultLength];
    // set validity = 0 (0 = valid, anything else is not valid)
    int validity = 0;
    int c, isLetter, value, validDigitStruct, validDigit, validLetterStruct, validLetter;
    for (int i = 0, hexOffset = 0; i < resultLength; i++, hexOffset += 2) {
        c = hex [hexOffset];

        // check using calculation over bits to see if first char is a letter
        // isLetter is zero if it is a digit, 1 if it is a letter (upper & lowercase)
        isLetter = (c >> 6) & 1;

        // calculate the tuple value using a multiplication to make up the difference between
        // a digit character and an alphanumerical character
        // minus 1 for the fact that the letters are not zero based
        value = ((c & 0xF) + isLetter * (-1 + 10)) << 4;

        // check validity of all the other bits
        validity |= c >> 7; // changed to >>, maybe not OK, use UInt?

        validDigitStruct = (c & 0x30) ^ 0x30;
        validDigit = ((c & 0x8) >> 3) * (c & 0x6);
        validity |= (isLetter ^ 1) * (validDigitStruct | validDigit);

        validLetterStruct = c & 0x18;
        validLetter = (((c - 1) & 0x4) >> 2) * ((c - 1) & 0x2);
        validity |= isLetter * (validLetterStruct | validLetter);

        // do the same with the lower (less significant) tuple
        c = hex [hexOffset + 1];
        isLetter = (c >> 6) & 1;
        value ^= (c & 0xF) + isLetter * (-1 + 10);
        result [i] = (byte)value;

        // check validity of all the other bits
        validity |= c >> 7; // changed to >>, maybe not OK, use UInt?

        validDigitStruct = (c & 0x30) ^ 0x30;
        validDigit = ((c & 0x8) >> 3) * (c & 0x6);
        validity |= (isLetter ^ 1) * (validDigitStruct | validDigit);

        validLetterStruct = c & 0x18;
        validLetter = (((c - 1) & 0x4) >> 2) * ((c - 1) & 0x2);
        validity |= isLetter * (validLetterStruct | validLetter);
    }

    if (validity != 0) {
        throw new ArgumentException ("Hexadecimal encoding incorrect for input " + hex);
    }

    return result;
} 
```

从 Java 代码转换而来。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2011-06-16T20:33:53.093

多样性的另一种变化：

```
public static byte[] FromHexString(string src)
{
    if (String.IsNullOrEmpty(src))
        return null;

    int index = src.Length;
    int sz = index / 2;
    if (sz <= 0)
        return null;

    byte[] rc = new byte[sz];

    while (--sz >= 0)
    {
        char lo = src[--index];
        char hi = src[--index];

        rc[sz] = (byte)(
            (
                (hi >= '0' && hi <= '9') ? hi - '0' :
                (hi >= 'a' && hi <= 'f') ? hi - 'a' + 10 :
                (hi >= 'A' && hi <= 'F') ? hi - 'A' + 10 :
                0
            )
            << 4 | 
            (
                (lo >= '0' && lo <= '9') ? lo - '0' :
                (lo >= 'a' && lo <= 'f') ? lo - 'a' + 10 :
                (lo >= 'A' && lo <= 'F') ? lo - 'A' + 10 :
                0
            )
        );
    }

    return rc;          
} 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2013-05-15T13:09:00.830

两个混搭，将两个半字节操作合二为一。

可能非常有效的版本：

```
public static string ByteArrayToString2(byte[] ba)
{
    char[] c = new char[ba.Length * 2];
    for( int i = 0; i < ba.Length * 2; ++i)
    {
        byte b = (byte)((ba[i>>1] >> 4*((i&1)^1)) & 0xF);
        c[i] = (char)(55 + b + (((b-10)>>31)&-7));
    }
    return new string( c );
} 
```

颓废的 linq-with-bit-hacking 版本：

```
public static string ByteArrayToString(byte[] ba)
{
    return string.Concat( ba.SelectMany( b => new int[] { b >> 4, b & 0xF }).Select( b => (char)(55 + b + (((b-10)>>31)&-7))) );
} 
```

反过来：

```
public static byte[] HexStringToByteArray( string s )
{
    byte[] ab = new byte[s.Length>>1];
    for( int i = 0; i < s.Length; i++ )
    {
        int b = s[i];
        b = (b - '0') + ((('9' - b)>>31)&-7);
        ab[i>>1] |= (byte)(b << 4*((i&1)^1));
    }
    return ab;
} 
```

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2013-06-03T23:24:36.470

这是我的镜头。我创建了一对扩展类来扩展字符串和字节。在大文件测试上，性能与 Byte Manipulation 2 相当。

下面的 ToHexString 代码是查找和移位算法的优化实现。它与 Behrooz 的几乎相同，但结果证明使用 a`foreach`进行迭代并且计数器比显式索引更快`for`。

它在我的机器上排在 Byte Manipulation 2 之后的第二位，并且是非常易读的代码。以下测试结果也很有趣：

ToHexStringCharArrayWithCharArrayLookup：41,589.69 平均滴答（超过 1000 次运行），1.5X ToHexStringCharArrayWithStringLookup：50,764.06 平均滴答（超过 1000 次运行），1.2X ToHexStringStringBuilderWithCharArrayLookup：62,812.87 平均滴答（超过 1000 次运行），1.0X

基于上述结果，似乎可以得出以下结论：

1.  在大文件测试中，索引到字符串以执行查找与 char 数组的惩罚是显着的。
2.  使用已知容量的 StringBuilder 与使用已知大小的 char 数组来创建字符串的惩罚更加严重。

这是代码：

```
using System;

namespace ConversionExtensions
{
    public static class ByteArrayExtensions
    {
        private readonly static char[] digits = new char[] { '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F' };

        public static string ToHexString(this byte[] bytes)
        {
            char[] hex = new char[bytes.Length * 2];
            int index = 0;

            foreach (byte b in bytes)
            {
                hex[index++] = digits[b >> 4];
                hex[index++] = digits[b & 0x0F];
            }

            return new string(hex);
        }
    }
}

using System;
using System.IO;

namespace ConversionExtensions
{
    public static class StringExtensions
    {
        public static byte[] ToBytes(this string hexString)
        {
            if (!string.IsNullOrEmpty(hexString) && hexString.Length % 2 != 0)
            {
                throw new FormatException("Hexadecimal string must not be empty and must contain an even number of digits to be valid.");
            }

            hexString = hexString.ToUpperInvariant();
            byte[] data = new byte[hexString.Length / 2];

            for (int index = 0; index < hexString.Length; index += 2)
            {
                int highDigitValue = hexString[index] <= '9' ? hexString[index] - '0' : hexString[index] - 'A' + 10;
                int lowDigitValue = hexString[index + 1] <= '9' ? hexString[index + 1] - '0' : hexString[index + 1] - 'A' + 10;

                if (highDigitValue < 0 || lowDigitValue < 0 || highDigitValue > 15 || lowDigitValue > 15)
                {
                    throw new FormatException("An invalid digit was encountered. Valid hexadecimal digits are 0-9 and A-F.");
                }
                else
                {
                    byte value = (byte)((highDigitValue << 4) | (lowDigitValue & 0x0F));
                    data[index / 2] = value;
                }
            }

            return data;
        }
    }
} 
```

以下是我将代码放入机器上@patridge 的测试项目时得到的测试结果。我还添加了一个从十六进制转换为字节数组的测试。运行我的代码的测试运行是 ByteArrayToHexViaOptimizedLookupAndShift 和 HexToByteArrayViaByteManipulation。HexToByteArrayViaConvertToByte 取自 XXXX。HexToByteArrayViaSoapHexBinary 是来自@Mykroft 的答案。

> 英特尔奔腾 III 至强处理器
> 
> ```
>  Cores: 4 <br/>
>     Current Clock Speed: 1576 <br/>
>     Max Clock Speed: 3092 <br/> 
> ```
> 
> * * *
> 
> 将字节数组转换为十六进制字符串表示
> 
> * * *
> 
> ByteArrayToHexViaByteManipulation2：39,366.64 平均滴答（超过 1000 次运行），22.4X
> 
> ByteArrayToHexViaOptimizedLookupAndShift：平均 41,588.64 个刻度（超过 1000 次运行），21.2X
> 
> ByteArrayToHexViaLookup：55,509.56 个平均刻度（超过 1000 次运行），15.9X
> 
> ByteArrayToHexViaByteManipulation：65,349.12 平均滴答数（超过 1000 次运行），13.5X
> 
> ByteArrayToHexViaLookupAndShift：平均 86,926.87 个刻度（超过 1000 次运行），10.2X
> 
> ByteArrayToHexStringViaBitConverter：139,353.73 平均滴答数（超过 1000 次运行），6.3X
> 
> ByteArrayToHexViaSoapHexBinary：314,598.77 平均滴答数（超过 1000 次运行），2.8X
> 
> ByteArrayToHexStringViaStringBuilderForEachByteToString：344,264.63 平均滴答数（超过 1000 次运行），2.6X
> 
> ByteArrayToHexStringViaStringBuilderAggregateByteToString：382,623.44 平均滴答数（超过 1000 次运行），2.3X
> 
> ByteArrayToHexStringViaStringBuilderForEachAppendFormat：818,111.95 平均滴答数（超过 1000 次运行），1.1X
> 
> ByteArrayToHexStringViaStringConcatArrayConvertAll：839,244.84 平均滴答数（超过 1000 次运行），1.1X
> 
> ByteArrayToHexStringViaStringBuilderAggregateAppendFormat：867,303.98 个平均刻度（超过 1000 次运行），1.0X
> 
> ByteArrayToHexStringViaStringJoinArrayConvertAll：882,710.28 个平均刻度（超过 1000 次运行），1.0X
> 
> * * *

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2013-08-30T23:53:04.533

没有针对速度进行优化，但比大多数答案（.NET 4.0）更多 LINQy：

```
<Extension()>
Public Function FromHexToByteArray(hex As String) As Byte()
    hex = If(hex, String.Empty)
    If hex.Length Mod 2 = 1 Then hex = "0" & hex
    Return Enumerable.Range(0, hex.Length \ 2).Select(Function(i) Convert.ToByte(hex.Substring(i * 2, 2), 16)).ToArray
End Function

<Extension()>
Public Function ToHexString(bytes As IEnumerable(Of Byte)) As String
    Return String.Concat(bytes.Select(Function(b) b.ToString("X2")))
End Function 
```

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2013-09-22T00:35:57.800

另一个快速功能...

```
private static readonly byte[] HexNibble = new byte[] {
    0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7,
    0x8, 0x9, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0xA, 0xB, 0xC, 0xD, 0xE, 0xF, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
    0x0, 0xA, 0xB, 0xC, 0xD, 0xE, 0xF
};

public static byte[] HexStringToByteArray( string str )
{
    int byteCount = str.Length >> 1;
    byte[] result = new byte[byteCount + (str.Length & 1)];
    for( int i = 0; i < byteCount; i++ )
        result[i] = (byte) (HexNibble[str[i << 1] - 48] << 4 | HexNibble[str[(i << 1) + 1] - 48]);
    if( (str.Length & 1) != 0 )
        result[byteCount] = (byte) HexNibble[str[str.Length - 1] - 48];
    return result;
} 
```

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2016-05-20T16:23:25.693

另一种方法是通过使用`stackalloc`来降低 GC 内存压力：

```
static string ByteToHexBitFiddle(byte[] bytes)
{
        var c = stackalloc char[bytes.Length * 2 + 1];
        int b; 
        for (int i = 0; i < bytes.Length; ++i)
        {
            b = bytes[i] >> 4;
            c[i * 2] = (char)(55 + b + (((b - 10) >> 31) & -7));
            b = bytes[i] & 0xF;
            c[i * 2 + 1] = (char)(55 + b + (((b - 10) >> 31) & -7));
        }
        c[bytes.Length * 2 ] = '\0';
        return new string(c);
} 
```

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2019-11-21T13:04:16.493

支持的最短路径和 .net 核心：

```
 public static string BytesToString(byte[] ba) =>
        ba.Aggregate(new StringBuilder(32), (sb, b) => sb.Append(b.ToString("X2"))).ToString(); 
```

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2020-03-10T21:23:22.687

有一个尚未提到的简单单行解决方案将十六进制字符串转换为字节数组（我们不关心这里的否定解释，因为它无关紧要）：

```
BigInteger.Parse(str, System.Globalization.NumberStyles.HexNumber).ToByteArray().Reverse().ToArray(); 
```

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2021-06-21T10:17:37.313

## 测试：十六进制字符串到字节数组

我注意到大多数测试都是在将字节数组转换为十六进制字符串的函数上执行的。因此，在这篇文章中，我将关注另一面：将十六进制字符串转换为字节数组的函数。如果你只对结果感兴趣，你可以跳到**总结**部分。测试代码文件在文章末尾提供。

## 标签

我想从接受的答案（由 Tomalak）StringToByteArrayV1 中命名该函数，或者将它的快捷方式命名为 V1。其余函数将以相同的方式命名：V2、V3、V4、...等。

## 参与职能索引

*   [Tomalak 的 StringToByteArrayV1](https://stackoverflow.com/a/311179/13817556)（已接受的答案）
*   [Mykroft 的 StringToByteArrayV2](https://stackoverflow.com/a/2556329/13817556)（使用 SoapHexBinary）
*   [Drphrozen](https://stackoverflow.com/a/6274772/13817556)的 StringToByteArrayV3（查找表）
*   [CoperNick 的 StringToByteArrayV4](https://stackoverflow.com/a/17923942/13817556)（字节操作）
*   [Chris F 的 StringToByteArrayV5_1](https://stackoverflow.com/a/2050653/13817556)（字节操作）
*   [Chris F 的 StringToByteArrayV5_2](https://stackoverflow.com/a/2050653/13817556)（V5_1 + 根据 Amir Rezaei 的评论对其进行了增强）
*   [Chris F 的 StringToByteArrayV5_3](https://stackoverflow.com/a/2050653/13817556)（V5_2 + 根据 Ben Voigt 的评论对其进行了增强）（您可以在这篇发布的测试代码中看到它的最终形状）
*   [Ben Mosher 的 StringToByteArrayV6](https://stackoverflow.com/a/10706477/13817556)（字节操作）
*   [Maratius](https://stackoverflow.com/a/20695932/13817556)的 StringToByteArrayV7（字节操作 - 安全版本）
*   [Maratius 的 StringToByteArrayV8](https://stackoverflow.com/a/20695932/13817556)（字节操作 - 不安全的版本）
*   [地理的 StringToByteArrayV9](https://stackoverflow.com/a/34333212/13817556)
*   [AlejandroAlis 的 StringToByteArrayV10](https://stackoverflow.com/a/64498722/13817556)
*   [Fredrik Hu 的 StringToByteArrayV11](https://stackoverflow.com/a/2889978/13817556)
*   [Maarten Bodewes 的 StringToByteArrayV12](https://stackoverflow.com/a/21246369/13817556)
*   [克劳斯安德森的 StringToByteArrayV13](https://stackoverflow.com/a/6275329/13817556)
*   [Stas Makutin 的 StringToByteArrayV14](https://stackoverflow.com/a/6378247/13817556)
*   [JJJ 的 StringToByteArrayV15](https://stackoverflow.com/a/16565896/13817556)
*   [JamieSee 的 StringToByteArrayV16](https://stackoverflow.com/a/16907438/13817556)
*   [Spacepille 的 StringToByteArrayV17](https://stackoverflow.com/a/18939148/13817556)
*   [Gregory Morse 的 StringToByteArrayV18](https://stackoverflow.com/a/60626134/13817556)
*   [Rick 的 StringToByteArrayV19](https://stackoverflow.com/a/10758999/13817556)
*   [SandRock 的 StringToByteArrayV20](https://stackoverflow.com/a/56378760/13817556)
*   [Paul 的 StringToByteArrayV21](https://stackoverflow.com/a/63864709/13817556)

## 正确性测试

我通过传递 1 个字节的所有 256 个可能值来测试正确性，然后检查输出是否正确。结果：

*   V18 存在以“00”开头的字符串的问题（请参阅 Roger Stewart 对此的评论）。除此之外，它通过了所有测试。
*   如果十六进制字符串字母为大写：所有函数成功通过
*   如果十六进制字符串字母为小写，则以下函数失败：V5_1、V5_2、v7、V8、V15、V19

注意：V5_3 解决了这个问题（V5_1 和 V5_2）

## 性能测试

我已经使用 Stopwatch 类进行了性能测试。

*   长字符串的性能

```
input length: 10,000,000 bytes
runs: 100
average elapsed time per run:
V1 = 136.4ms
V2 = 104.5ms
V3 = 22.0ms
V4 = 9.9ms
V5_1 = 10.2ms
V5_2 = 9.0ms
V5_3 = 9.3ms
V6 = 18.3ms
V7 = 9.8ms
V8 = 8.8ms
V9 = 10.2ms
V10 = 19.0ms
V11 = 12.2ms
V12 = 27.4ms
V13 = 21.8ms
V14 = 12.0ms
V15 = 14.9ms
V16 = 15.3ms
V17 = 9.5ms
V18 got excluded from this test, because it was very slow when using very long string
V19 = 222.8ms
V20 = 66.0ms
V21 = 15.4ms

V1 average ticks per run: 1363529.4
V2 is more fast than V1 by: 1.3 times (ticks ratio)
V3 is more fast than V1 by: 6.2 times (ticks ratio)
V4 is more fast than V1 by: 13.8 times (ticks ratio)
V5_1 is more fast than V1 by: 13.3 times (ticks ratio)
V5_2 is more fast than V1 by: 15.2 times (ticks ratio)
V5_3 is more fast than V1 by: 14.8 times (ticks ratio)
V6 is more fast than V1 by: 7.4 times (ticks ratio)
V7 is more fast than V1 by: 13.9 times (ticks ratio)
V8 is more fast than V1 by: 15.4 times (ticks ratio)
V9 is more fast than V1 by: 13.4 times (ticks ratio)
V10 is more fast than V1 by: 7.2 times (ticks ratio)
V11 is more fast than V1 by: 11.1 times (ticks ratio)
V12 is more fast than V1 by: 5.0 times (ticks ratio)
V13 is more fast than V1 by: 6.3 times (ticks ratio)
V14 is more fast than V1 by: 11.4 times (ticks ratio)
V15 is more fast than V1 by: 9.2 times (ticks ratio)
V16 is more fast than V1 by: 8.9 times (ticks ratio)
V17 is more fast than V1 by: 14.4 times (ticks ratio)
V19 is more SLOW than V1 by: 1.6 times (ticks ratio)
V20 is more fast than V1 by: 2.1 times (ticks ratio)
V21 is more fast than V1 by: 8.9 times (ticks ratio) 
```

*   长弦V18的性能

```
V18 took long time at the previous test, 
so let's decrease length for it:  
input length: 1,000,000 bytes
runs: 100
average elapsed time per run: V1 = 14.1ms , V18 = 146.7ms
V1 average ticks per run: 140630.3
V18 is more SLOW than V1 by: 10.4 times (ticks ratio) 
```

*   短字符串的性能

```
input length: 100 byte
runs: 1,000,000
V1 average ticks per run: 14.6
V2 is more fast than V1 by: 1.4 times (ticks ratio)
V3 is more fast than V1 by: 5.9 times (ticks ratio)
V4 is more fast than V1 by: 15.7 times (ticks ratio)
V5_1 is more fast than V1 by: 15.1 times (ticks ratio)
V5_2 is more fast than V1 by: 18.4 times (ticks ratio)
V5_3 is more fast than V1 by: 16.3 times (ticks ratio)
V6 is more fast than V1 by: 5.3 times (ticks ratio)
V7 is more fast than V1 by: 15.7 times (ticks ratio)
V8 is more fast than V1 by: 18.0 times (ticks ratio)
V9 is more fast than V1 by: 15.5 times (ticks ratio)
V10 is more fast than V1 by: 7.8 times (ticks ratio)
V11 is more fast than V1 by: 12.4 times (ticks ratio)
V12 is more fast than V1 by: 5.3 times (ticks ratio)
V13 is more fast than V1 by: 5.2 times (ticks ratio)
V14 is more fast than V1 by: 13.4 times (ticks ratio)
V15 is more fast than V1 by: 9.9 times (ticks ratio)
V16 is more fast than V1 by: 9.2 times (ticks ratio)
V17 is more fast than V1 by: 16.2 times (ticks ratio)
V18 is more fast than V1 by: 1.1 times (ticks ratio)
V19 is more SLOW than V1 by: 1.6 times (ticks ratio)
V20 is more fast than V1 by: 1.9 times (ticks ratio)
V21 is more fast than V1 by: 11.4 times (ticks ratio) 
```

## 测试代码

在使用以下代码 [https://github.com/Ghosticcollis/performance-tests/blob/main/MTestPerformance.cs之前，最好先阅读本文中的免责声明部分](https://github.com/Ghosticollis/performance-tests/blob/main/MTestPerformance.cs)

## 概括

我推荐使用以下函数之一，因为它具有良好的性能，并且支持大小写：

*   [CoperNick 的 StringToByteArrayV4](https://stackoverflow.com/a/17923942/13817556)
*   [地理的 StringToByteArrayV9](https://stackoverflow.com/a/34333212/13817556)
*   [Spacepille 的 StringToByteArrayV17](https://stackoverflow.com/a/18939148/13817556)
*   [StringToByteArrayV5_3 基本上由 Chris F](https://stackoverflow.com/a/2050653/13817556)编写（它基于 V5_1，但我根据 Amir Rezaei 和 Ben Voigt 的评论对其进行了增强）。

这是 V5_3 的最终形状：

```
static byte[] HexStringToByteArrayV5_3(string hexString) {
    int hexStringLength = hexString.Length;
    byte[] b = new byte[hexStringLength / 2];
    for (int i = 0; i < hexStringLength; i += 2) {
        int topChar = hexString[i];
        topChar = (topChar > 0x40 ? (topChar & ~0x20) - 0x37 : topChar - 0x30) << 4;
        int bottomChar = hexString[i + 1];
        bottomChar = bottomChar > 0x40 ? (bottomChar & ~0x20) - 0x37 : bottomChar - 0x30;
        b[i / 2] = (byte)(topChar + bottomChar);
    }
    return b;
} 
```

## 免责声明

警告：我没有适当的测试知识。这些原始测试的主要目的是快速概述所有已发布功能的优点。如果您需要准确的结果，请使用适当的测试工具。

最后，我想说我是新来的 stackoverflow，如果缺少我的帖子，我很抱歉。评论以增强这篇文章将不胜感激。

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2011-04-10T00:56:25.790

如果性能很重要，这里有一个优化的解决方案：

```
 static readonly char[] _hexDigits = "0123456789abcdef".ToCharArray();
    public static string ToHexString(this byte[] bytes)
    {
        char[] digits = new char[bytes.Length * 2];
        for (int i = 0; i < bytes.Length; i++)
        {
            int d1, d2;
            d1 = Math.DivRem(bytes[i], 16, out d2);
            digits[2 * i] = _hexDigits[d1];
            digits[2 * i + 1] = _hexDigits[d2];
        }
        return new string(digits);
    } 
```

它大约快 2.5 倍`BitConverter.ToString`，大约快 7 倍`BitConverter.ToString`+ 删除“-”字符。

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2012-05-25T17:38:38.010

这适用于从字符串到字节数组......

```
public static byte[] StrToByteArray(string str)
    {
        Dictionary<string, byte> hexindex = new Dictionary<string, byte>();
        for (byte i = 0; i < 255; i++)
            hexindex.Add(i.ToString("X2"), i);

        List<byte> hexres = new List<byte>();
        for (int i = 0; i < str.Length; i += 2)
            hexres.Add(hexindex[str.Substring(i, 2)]);

        return hexres.ToArray();
    } 
```

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2012-12-16T20:40:59.690

我猜它的速度值得多出 16 个字节。

```
 static char[] hexes = new char[]{'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'};
    public static string ToHexadecimal (this byte[] Bytes)
    {
        char[] Result = new char[Bytes.Length << 1];
        int Offset = 0;
        for (int i = 0; i != Bytes.Length; i++) {
            Result[Offset++] = hexes[Bytes[i] >> 4];
            Result[Offset++] = hexes[Bytes[i] & 0x0F];
        }
        return new string(Result);
    } 
```

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2013-10-24T09:53:28.783

还有`XmlWriter.WriteBinHex`（参见 MSDN[页面](https://msdn.microsoft.com/en-us/library/system.xml.xmlwriter.writebinhex(v=vs.110).aspx)）。如果您需要将十六进制字符串放入 XML 流中，这将非常有用。

这是一个独立的方法来看看它是如何工作的：

```
 public static string ToBinHex(byte[] bytes)
    {
        XmlWriterSettings xmlWriterSettings = new XmlWriterSettings();
        xmlWriterSettings.ConformanceLevel = ConformanceLevel.Fragment;
        xmlWriterSettings.CheckCharacters = false;
        xmlWriterSettings.Encoding = ASCIIEncoding.ASCII;
        MemoryStream memoryStream = new MemoryStream();
        using (XmlWriter xmlWriter = XmlWriter.Create(memoryStream, xmlWriterSettings))
        {
            xmlWriter.WriteBinHex(bytes, 0, bytes.Length);
        }
        return Encoding.ASCII.GetString(memoryStream.ToArray());
    } 
```

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2015-10-20T22:51:39.553

下面通过允许本地小写选项以及处理 null 或空输入并使其成为扩展方法来扩展[此处的出色答案。](https://stackoverflow.com/a/14333437/264031)

```
 /// <summary>
    /// Converts the byte array to a hex string very fast. Excellent job
    /// with code lightly adapted from 'community wiki' here: https://stackoverflow.com/a/14333437/264031
    /// (the function was originally named: ByteToHexBitFiddle). Now allows a native lowerCase option
    /// to be input and allows null or empty inputs (null returns null, empty returns empty).
    /// </summary>
    public static string ToHexString(this byte[] bytes, bool lowerCase = false)
    {
        if (bytes == null)
            return null;
        else if (bytes.Length == 0)
            return "";

        char[] c = new char[bytes.Length * 2];

        int b;
        int xAddToAlpha = lowerCase ? 87 : 55;
        int xAddToDigit = lowerCase ? -39 : -7;

        for (int i = 0; i < bytes.Length; i++) {

            b = bytes[i] >> 4;
            c[i * 2] = (char)(xAddToAlpha + b + (((b - 10) >> 31) & xAddToDigit));

            b = bytes[i] & 0xF;
            c[i * 2 + 1] = (char)(xAddToAlpha + b + (((b - 10) >> 31) & xAddToDigit));
        }

        string val = new string(c);
        return val;
    }

    public static string ToHexString(this IEnumerable<byte> bytes, bool lowerCase = false)
    {
        if (bytes == null)
            return null;
        byte[] arr = bytes.ToArray();
        return arr.ToHexString(lowerCase);
    } 
```

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2017-05-02T11:12:09.570

```
static string ByteArrayToHexViaLookupPerByte2(byte[] bytes)
{                
        var result3 = new uint[bytes.Length];
        for (int i = 0; i < bytes.Length; i++)
                result3[i] = _Lookup32[bytes[i]];
        var handle = GCHandle.Alloc(result3, GCHandleType.Pinned);
        try
        {
                var result = Marshal.PtrToStringUni(handle.AddrOfPinnedObject(), bytes.Length * 2);
                return result;
        }
        finally
        {
                handle.Free();
        }
} 
```

在我的测试中，这个函数始终是 unsafe 实现之后的第二个条目。

不幸的是，测试台不是那么可靠......如果你多次运行它，列表就会被洗牌太多，谁知道在不安全之后这真的是最快的！它没有考虑预热、jit 编译时间和 GC 性能命中。我想重写它以获得更多信息，但我真的没有时间。

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2019-05-30T12:55:50.510

我想出了一个不同的[代码，它可以容忍额外的字符（空格，破折号......）](https://gist.github.com/sandrock/f38cf1b56a16e4d684398ac2117069ce)。它的灵感主要来自这里一些可以接受的快速答案。它允许解析以下“文件”

```
00-aa-84-fb
12 32 FF CD
12 00
12_32_FF_CD
1200d5e68a 
```

```
/// <summary>Reads a hex string into bytes</summary>
public static IEnumerable<byte> HexadecimalStringToBytes(string hex) {
    if (hex == null)
        throw new ArgumentNullException(nameof(hex));

    char c, c1 = default(char);
    bool hasc1 = false;
    unchecked   {
        for (int i = 0; i < hex.Length; i++) {
            c = hex[i];
            bool isValid = 'A' <= c && c <= 'f' || 'a' <= c && c <= 'f' || '0' <= c && c <= '9';
            if (!hasc1) {
                if (isValid) {
                    hasc1 = true;
                }
            } else {
                hasc1 = false;
                if (isValid) {
                    yield return (byte)((GetHexVal(c1) << 4) + GetHexVal(c));
                }
            }

            c1 = c;
        } 
    }
}

/// <summary>Reads a hex string into a byte array</summary>
public static byte[] HexadecimalStringToByteArray(string hex)
{
    if (hex == null)
        throw new ArgumentNullException(nameof(hex));

    var bytes = new List<byte>(hex.Length / 2);
    foreach (var item in HexadecimalStringToBytes(hex)) {
        bytes.Add(item);
    }

    return bytes.ToArray();
}

private static byte GetHexVal(char val)
{
    return (byte)(val - (val < 0x3A ? 0x30 : val < 0x5B ? 0x37 : 0x57));
    //                   ^^^^^^^^^^^^^^^^^   ^^^^^^^^^^^^^^^^^   ^^^^
    //                       digits 0-9       upper char A-Z     a-z
} 
```

复制时请参考[完整代码。](https://gist.github.com/sandrock/f38cf1b56a16e4d684398ac2117069ce)包括单元测试。

有人可能会说它对额外的字符太宽容了。所以不要依赖此代码来执行验证（或更改它）。

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2019-11-01T23:30:35.193

```
 // a safe version of the lookup solution:       

    public static string ByteArrayToHexViaLookup32Safe(byte[] bytes, bool withZeroX)
    {
        if (bytes.Length == 0)
        {
            return withZeroX ? "0x" : "";
        }

        int length = bytes.Length * 2 + (withZeroX ? 2 : 0);
        StateSmall stateToPass = new StateSmall(bytes, withZeroX);
        return string.Create(length, stateToPass, (chars, state) =>
        {
            int offset0x = 0;
            if (state.WithZeroX)
            {
                chars[0] = '0';
                chars[1] = 'x';
                offset0x += 2;
            }

            Span<uint> charsAsInts = MemoryMarshal.Cast<char, uint>(chars.Slice(offset0x));
            int targetLength = state.Bytes.Length;
            for (int i = 0; i < targetLength; i += 1)
            {
                uint val = Lookup32[state.Bytes[i]];
                charsAsInts[i] = val;
            }
        });
    }

    private struct StateSmall
    {
        public StateSmall(byte[] bytes, bool withZeroX)
        {
            Bytes = bytes;
            WithZeroX = withZeroX;
        }

        public byte[] Bytes;
        public bool WithZeroX;
    } 
```

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2020-09-12T20:33:33.540

将一些答案合并到一个类中，以方便我以后复制和粘贴：

```
/// <summary>
/// Extension methods to quickly convert byte array to string and back.
/// </summary>
public static class HexConverter
{
    /// <summary>
    /// Map values to hex digits
    /// </summary>
    private static readonly char[] HexDigits =
        {
            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F'
        };

    /// <summary>
    /// Map 56 characters between ['0', 'F'] to their hex equivalents, and set invalid characters
    /// such that they will overflow byte to fail conversion.
    /// </summary>
    private static readonly ushort[] HexValues =
        {
            0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007, 0x0008, 0x0009, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100,
            0x000A, 0x000B, 0x000C, 0x000D, 0x000E, 0x000F, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100,
            0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x0100, 0x000A, 0x000B,
            0x000C, 0x000D, 0x000E, 0x000F
        };

    /// <summary>
    /// Empty byte array 
    /// </summary>
    private static readonly byte[] Empty = new byte[0];

    /// <summary>
    /// Convert a byte array to a hexadecimal string.
    /// </summary>
    /// <param name="bytes">
    /// The input byte array.
    /// </param>
    /// <returns>
    /// A string of hexadecimal digits.
    /// </returns>
    public static string ToHexString(this byte[] bytes)
    {
        var c = new char[bytes.Length * 2];
        for (int i = 0, j = 0; i < bytes.Length; i++)
        {
            c[j++] = HexDigits[bytes[i] >> 4];
            c[j++] = HexDigits[bytes[i] & 0x0F];
        }

        return new string(c);
    }

    /// <summary>
    /// Parse a string of hexadecimal digits into a byte array.
    /// </summary>
    /// <param name="hexadecimalString">
    /// The hexadecimal string.
    /// </param>
    /// <returns>
    /// The parsed <see cref="byte[]"/> array.
    /// </returns>
    /// <exception cref="ArgumentException">
    /// The input string either contained invalid characters, or was of an odd length.
    /// </exception>
    public static byte[] ToByteArray(string hexadecimalString)
    {
        if (!TryParse(hexadecimalString, out var value))
        {
            throw new ArgumentException("Invalid hexadecimal string", nameof(hexadecimalString));
        }

        return value;
    }

    /// <summary>
    /// Parse a hexadecimal string to bytes
    /// </summary>
    /// <param name="hexadecimalString">
    /// The hexadecimal string, which must be an even number of characters.
    /// </param>
    /// <param name="value">
    /// The parsed value if successful.
    /// </param>
    /// <returns>
    /// True if successful.
    /// </returns>
    public static bool TryParse(string hexadecimalString, out byte[] value)
    {
        if (hexadecimalString.Length == 0)
        {
            value = Empty;
            return true;
        }

        if (hexadecimalString.Length % 2 != 0)
        {
            value = Empty;
            return false;
        }

        try
        {

            value = new byte[hexadecimalString.Length / 2];
            for (int i = 0, j = 0; j < hexadecimalString.Length; i++)
            {
                value[i] = (byte)((HexValues[hexadecimalString[j++] - '0'] << 4)
                                  | HexValues[hexadecimalString[j++] - '0']);
            }

            return true;
        }
        catch (OverflowException)
        {
            value = Empty;
            return false;
        }
    }
} 
```

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2010-01-02T22:28:07.087

如果您想获得 wcoenen 报告的“4 倍速度提升”，那么如果它不明显：替换`hex.Substring(i, 2)`为`hex[i]+hex[i+1]`

你也可以更进一步，`i+=2`通过`i++`在两个地方使用来摆脱它。

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2018-05-14T12:53:59.247

具有扩展支持的基本解决方案

```
public static class Utils
{
    public static byte[] ToBin(this string hex)
    {
        int NumberChars = hex.Length;
        byte[] bytes = new byte[NumberChars / 2];
        for (int i = 0; i < NumberChars; i += 2)
            bytes[i / 2] = Convert.ToByte(hex.Substring(i, 2), 16);
        return bytes;
    }
    public static string ToHex(this byte[] ba)
    {
        return  BitConverter.ToString(ba).Replace("-", "");
    }
} 
```

并像下面这样使用这个类

```
 byte[] arr1 = new byte[] { 1, 2, 3 };
    string hex1 = arr1.ToHex();
    byte[] arr2 = hex1.ToBin(); 
```

* * *

## 回答 #49

> 赞同：-2
> 
> 时间：2020-04-29T01:10:40.093

在 Java 8 中，我们可以使用`Byte.toUnsignedInt`

```
public static String convertBytesToHex(byte[] bytes) {
    StringBuilder result = new StringBuilder();
    for (byte byt : bytes) {
        int decimal = Byte.toUnsignedInt(byt);
        String hex = Integer.toHexString(decimal);
        result.append(hex);
    }
    return result.toString();
} 
```

* * *

## 回答 #50

> 赞同：-3
> 
> 时间：2011-10-27T03:01:08.480

我怀疑它的速度会让大多数其他测试都大吃一惊……

```
Public Function BufToHex(ByVal buf() As Byte) As String
    Dim sB As New System.Text.StringBuilder
    For i As Integer = 0 To buf.Length - 1
        sB.Append(buf(i).ToString("x2"))
    Next i
    Return sB.ToString
End Function 
```

# c++ - std::auto_ptr 或 boost::shared_ptr 用于 pImpl 成语？

> ID：311166
> 
> 赞同：16
> 
> 时间：2008-11-22T10:03:34.860
> 
> 标签：c++, boost, stl, shared-ptr, auto-ptr

当使用[pImpl 成语](http://en.wikipedia.org/wiki/Pimpl_idiom)时，最好使用 a`boost:shared_ptr`而不是 a `std::auto_ptr`？我确定我曾经读过boost版本对异常更友好？

```
class Foo
{
public:
    Foo();
private:
    struct impl;
    std::auto_ptr<impl> impl_;
};

class Foo
{
public:
    Foo();
private:
    struct impl;
    boost::shared_ptr<impl> impl_;
}; 
```

[编辑] 使用 std::auto_ptr<> 是否总是安全的，或者是否存在需要替代提升智能指针的情况？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-22T11:57:06.457

你不应该真的为此使用 std::auto_ptr 。在您声明 std::auto_ptr 时，析构函数将不可见，因此可能无法正确调用它。这是假设您正在向前声明您的 pImpl 类，并在另一个文件的构造函数中创建实例。

如果您使用[boost::scoped_ptr](http://www.boost.org/doc/libs/1_37_0/libs/smart_ptr/scoped_ptr.htm)（此处不需要 shared_ptr，您将不会与任何其他对象共享 pimpl，这是由 scoped_ptr 是[noncopyable](http://www.boost.org/doc/libs/1_37_0/libs/utility/utility.htm#Class_noncopyable)强制执行的），您只需要 pimpl 析构函数在您调用时可见scoped_ptr 构造函数。

例如

```
// in MyClass.h

class Pimpl;

class MyClass 
{ 
private:
    std::auto_ptr<Pimpl> pimpl;

public: 
    MyClass();
};

// Body of these functions in MyClass.cpp 
```

在这里，编译器会生成 MyClass 的析构函数。其中必须调用 auto_ptr 的析构函数。在 auto_ptr 析构函数被实例化的地方，Pimpl 是一个不完整的类型。所以在 auto_ptr 析构函数中，当它删除 Pimpl 对象时，它不知道如何调用 Pimpl 析构函数。

boost::scoped_ptr（和shared_ptr）没有这个问题，因为当你调用scoped_ptr（或reset方法）的构造函数时，它也会使用一个等效的函数指针，而不是调用delete。这里的关键是当 Pimpl 不是不完整类型时，它会实例化释放函数。附带说明一下，shared_ptr 允许您指定[自定义解除分配](http://hafizpariabi.blogspot.com/2008/01/using-custom-deallocator-in.html)函数，因此您可以将其用于 GDI 句柄或您可能想要的任何其他内容 - 但这对于您的需求来说太过分了。

如果您真的想使用 std::auto_ptr，那么您需要格外小心，确保在完全定义 Pimpl 时在 MyClass.cpp 中定义您的 MyClass 析构函数。

```
// in MyClass.h

class Pimpl;

class MyClass 
{ 
private:
    std::auto_ptr<Pimpl> pimpl;

public: 
    MyClass();
    ~MyClass();
}; 
```

和

```
// in MyClass.cpp

#include "Pimpl.h"

MyClass::MyClass() : pimpl(new Pimpl(blah))
{
}

MyClass::~MyClass() 
{
    // this needs to be here, even when empty
} 
```

编译器将生成代码，在空析构函数中有效地破坏所有 MyClass 成员。所以在 auto_ptr 析构函数被实例化时，Pimpl 不再不完整，编译器现在知道如何调用析构函数。

就个人而言，我认为确保一切都正确是不值得的。还有一个风险是，稍后有人会通过删除看似多余的析构函数来整理代码。因此，对于这种事情，使用 boost::scoped_ptr 会更安全。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-22T10:24:05.177

我倾向于使用`auto_ptr`. 确保您的类不可复制（声明私有副本 ctor & operator=，否则继承`boost::noncopyable`）。如果你使用`auto_ptr`，一个问题是你需要定义一个非内联析构函数，即使主体是空的。（这是因为如果让编译器生成默认析构函数，在生成调用`impl`时将是一个不完整的类型`delete impl_`，调用未定义的行为）。

`auto_ptr`升压指针之间几乎没有选择余地。如果可以使用标准库替代方案，我倾向于不出于文体原因使用 boost。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-22T10:25:36.797

的升压替代品`std::auto_ptr`是`boost::scoped_ptr`. 的主要区别`auto_ptr`在于`boost::scoped_ptr`不可复制。

有关详细信息，请参阅[此页面。](http://www.boost.org/doc/libs/1_37_0/libs/smart_ptr/scoped_ptr.htm)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-26T19:14:06.977

boost::shared_ptr 是专门为 pimpl idiom 量身定做的。主要优点之一是它允许不为持有 pimpl 的类定义析构函数。共享所有权政策可能既有优点也有缺点。但在以后的情况下，您可以正确定义复制构造函数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-22T11:12:26.220

如果您真的很迂腐，则无法绝对保证使用`auto_ptr`成员不需要在使用`auto_ptr`它的位置完整定义 的模板参数。话虽如此，我从未见过这不起作用。

一种变体是使用`const auto_ptr`. 只要您可以在初始化器列表中使用新表达式构造您的“pimpl”并保证编译器*无法*生成默认的复制构造函数和赋值方法，它就可以工作。仍然需要提供封闭类的非内联析构函数。

在其他条件相同的情况下，我更倾向于只使用标准库的实现，因为它使事情更便携。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-08-10T15:02:33.153

如果你想要一个可复制的类， use `scoped_ptr`，它禁止复制，因此默认情况下使你的类很难使用错误（与 using 相比`shared_ptr`，编译器不会自行发出复制工具；如果是`shared_ptr`，如果你不知道你在做什么[即使对于巫师来说也经常如此]，当突然一个东西的副本也修改了那个东西时，会出现奇怪的行为），然后定义一个复制构造函数和复制赋值：

```
class CopyableFoo {
public:
    ...
    CopyableFoo (const CopyableFoo&);
    CopyableFoo& operator= (const CopyableFoo&);
private:
    scoped_ptr<Impl> impl_;
};

...
CopyableFoo (const CopyableFoo& rhs)
    : impl_(new Impl (*rhs.impl_))
{} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-09T17:07:04.903

对于 pImpl，shared_ptr 比 auto_ptr 更可取，因为当你复制它时，你的外部类可能会突然丢失它的指针。

使用 shared_ptr 您可以使用前向声明的类型，这样就可以了。auto_ptr 不允许前向声明的类型。scoped_ptr 也没有，如果你的外部类无论如何都是不可复制的并且只有一个指针，它也可能是一个普通的。

在 pImpl 中使用侵入式引用计数并让外部类调用其副本并在其实现中分配语义有很多话要说。假设这是一个真正的供应商（提供类）模型，供应商最好不要强迫用户使用 shared_ptr，或者使用相同版本的 shared_ptr（boost 或 std）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-21T22:27:00.067

[我对Vladimir Batov [修改] 的 impl_ptr](http://www.codeproject.com/Articles/11903/Two-thirds-of-a-pimpl-and-a-grin?msg=2690869#xx2690869xx)感到非常高兴。它使创建 pImpl 变得非常容易，而无需显式地创建复制构造函数和赋值运算符。

我已经修改了原始代码，所以它现在类似于一个 shared_ptr，所以它可以在 Epilog 代码中使用，并且保持快速。

* * *

## 回答 #9

> 赞同：-8
> 
> 时间：2008-11-22T10:20:04.220

不要那么努力地打自己的脚，在 C++ 中你有很多机会 :) 没有真正需要使用任何自动指针，因为你完全知道你的对象应该何时进入和退出生命（在你的构造函数和析构函数）。

把事情简单化。

# flash - 如何使用 Action 脚本录制音频然后将其上传到服务器？

> ID：311167
> 
> 赞同：2
> 
> 时间：2008-11-22T10:05:50.083
> 
> 标签：flash, actionscript-3, audio

首先，有什么技术可以使用动作脚本从麦克风录制声音吗？如是。如何？然后他记录的一个我会把它上传到服务器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T02:49:58.947

`flash.media.Microphone`是您要查找的课程。

静态函数`Microphone.getMicrophone()`返回对`Microphone`用于捕获音频的对象的引用。要开始捕获音频，您必须将`Microphone`对象附加到`NetStream`对象（请参阅 参考资料`NetStream.attachAudio()`）。

[LiveDocs](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/)中至少有一个示例。开始于`flash.media.Microphone`。

# java - JXTable - 过滤表后的荧光笔

> ID：311175
> 
> 赞同：4
> 
> 时间：2008-11-22T10:10:16.110
> 
> 标签：java, swingx, jxtable, swingx-highlighter

信息 - 为了更好的格式，我在整个发布过程中使用了代码格式。

```
Hi,

I have a highlighted JXTable. Rows are highlighted, depending on the value 
of a specific column (c2). Everytime the value of column c2 changes, the color 
is switched from white to grey or from grey to white.

Example    
    c0  c1    c2   c3
    1 | aaa | ab | dd
    2 | aaa | ab | ee
    3 | aaa | cd | ff
    4 | aaa | cd | gg
    5 | bbb | ef | dd

Colors are like this:
1,2 -> white
3,4 -> grey
5   -> white

If I now filter for 'dd', my table looks like this

    c0  c1    c2   c3
    1 | aaa | ab | dd
    5 | bbb | ef | dd

And the colors are like this:
1 -> white
5 -> white

But I want the table to change the color of row 5, because the previous 
value in c2 was different.
See my Problem? How can I apply the highlighter again, on my JXTAble, 
after filtering? Or in other words, how can I highlight only the filtered 
values? 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T10:46:00.047

你能加第二个荧光笔吗？

```
jxTable.getHighlighters().addHighlighter() 
```

一种仅在有效过滤 JXtable 时才应用的方法。

如果这是不可能的，因为一旦突出显示了一行，可能不会调用其他突出显示，您可以**定义一个控制器**：

a) 对表有一个 propertyChangeListner，监听过滤状态

b）具有带有行集和荧光笔的特殊谓词

c）在 propertyChange 检查行，在 NEVER 和您的自定义之间切换荧光笔的谓词。荧光笔的属性改变会触发重绘

强制重绘基本上是 test.org.jdesktop.swingx.renderer 包中的 HighlighterClientVisualCheck 示例的作用。

# air - 在 AIR 中拖放的示例

> ID：311177
> 
> 赞同：1
> 
> 时间：2008-11-22T10:12:34.983
> 
> 标签：air

我正在寻找一个在网页中拖放的简单示例（比如将图像拖动到表格单元格），在 AIR 中（使用 AIR api）谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T13:45:00.403

您可能会[在此处](http://help.adobe.com/en_US/AIR/1.1/devappshtml/WS6717AA0A-2B7D-4728-86DC-7D60F919E6B4.html)、[此处](https://admin.adobe.acrobat.com/_a227210/p48882098/)或最重要的是[保加利亚 Flex Group](http://groups.google.com/group/flexbulgaria/browse_thread/thread/0910170142c91c08)中找到一些内容，其中条目以“我想展示一种从您的 Air 应用程序中的文件系统拖放文件的简单方法”开头。

嗯......再次阅读您的请求，我意识到这不是您所要求的。我希望文件的 DND 至少为您指明了正确的方向。

# .net - .Net 的开源代理库

> ID：311181
> 
> 赞同：10
> 
> 时间：2008-11-22T10:20:31.767
> 
> 标签：.net, proxy

我正在寻找一个开源的.Net HTTP 代理库。基本上我想开发像 Fiddler 这样的东西（功能更少，更轻）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-20T16:55:49.537

Mentalis 不能很好地处理非 ASCII。Fiddler 的核心代理引擎称为“FiddlerCore”，现在作为 .NET 类库提供：[http ://www.fiddler2.com/fiddler/Core/](http://www.fiddler2.com/fiddler/Core/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-22T11:37:05.170

我在工作中使用了 Mentalis 代理： [http ://www.mentalis.org/soft/projects/proxy/](http://www.mentalis.org/soft/projects/proxy/)

好久没动了，可能有一些bug。

许可证详情在这里：[http ://www.mentalis.org/site/license.qpx](http://www.mentalis.org/site/license.qpx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T10:48:51.757

[URLRewriter.NET](http://urlrewriter.sourceforge.net/)是一个免费的 IIS/ASP.NET 开源组件。

顾名思义，它是一个 URL 重写组件，但它也具有**代理功能**。在配置文件中像这样简单的一行

```
RewriteRule ^(.*) http://www.testsiteXY.com$1 [P] 
```

您可以轻松地将其用作代理。

# oracle - PL/SQL 中 CASE 语句中的堆栈条件

> ID：311184
> 
> 赞同：13
> 
> 时间：2008-11-22T10:24:45.830
> 
> 标签：oracle, plsql

我正在使用 Oracle 10g，我试图在 CASE 语句中“堆叠”条件，就像我在 C++ 中所做的那样：

```
case 1:
case 2:
    // instructions
    break; 
```

即为两个不同的成功条件执行相同的代码块。

我试过了 ：

```
WHEN 1, 2 THEN
WHEN 1 OR 2 THEN 
```

......没有运气。甚至可能吗？

**编辑**- 完整片段

```
CASE v_n
  WHEN (1 OR 2) THEN
    dbms_output.put_line('Case 1 or 2');
  WHEN 3 THEN
    dbms_output.put_line('Case 3'); 
END CASE; 
```

生成**表达式类型**错误

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-22T11:04:48.013

您需要使用这种格式：

```
CASE
  WHEN v_n = 1 OR v_n = 2 THEN
    dbms_output.put_line('Case 1 or 2');
  WHEN v_n = 3 THEN
    dbms_output.put_line('Case 3'); 
END CASE; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-06-02T22:14:03.963

可以像在 SQL 中一样使用 IN：

```
BEGIN
  CASE 
    WHEN EXTRACT(YEAR FROM SYSDATE) IN (2015, 2016, 2017) THEN
      dbms_output.put_line('Yes');
    ELSE
      dbms_output.put_line('No');
  END CASE;
END;
/ 
```

# python - 如何在 Django 中编辑和删除数据？

> ID：311188
> 
> 赞同：12
> 
> 时间：2008-11-22T10:28:56.650
> 
> 标签：python, django, editing

我正在使用 django 1.0，并且使用 Django 书中的示例创建了我的模型。我能够执行添加数据的基本功能；现在我需要一种检索该数据的方法，将其加载到表单中（change_form？！或其他东西），对其进行**编辑**并将其保存回数据库。其次，我如何**删除**数据库中的数据？即搜索，选择然后删除！

请给我看一个我需要编写的代码示例`view.py`并`urls.py`执行此任务。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-11-22T10:36:04.280

假设您有一个模范员工。要使用主键 emp_id 编辑条目，请执行以下操作：

```
emp = Employee.objects.get(pk = emp_id)
emp.name = 'Somename'
emp.save() 
```

删除它只是做：

```
emp.delete() 
```

所以一个完整的观点是：

```
def update(request, id):
   emp = Employee.objects.get(pk = id)
   #you can do this for as many fields as you like
   #here I asume you had a form with input like <input type="text" name="name"/>
   #so it's basically like that for all form fields
   emp.name = request.POST.get('name')
   emp.save()
   return HttpResponse('updated')

def delete(request, id):
   emp = Employee.objects.get(pk = id)
   emp.delete()
   return HttpResponse('deleted') 
```

在 urls.py 你需要两个这样的条目：

```
(r'^delete/(\d+)/$','myproject.myapp.views.delete'),
(r'^update/(\d+)/$','myproject.myapp.views.update'), 
```

我建议你看看[文档](http://docs.djangoproject.com/en/dev/ref/models/instances/?from=olddocs)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-07-29T22:01:30.627

要执行其中任何一项，您需要使用称为查询的东西。

检查下面的链接以获得非常好的文档！（[https://docs.djangoproject.com/en/2.2/topics/db/queries/](https://docs.djangoproject.com/en/2.2/topics/db/queries/)）

删除数据：

```
b = ModelName.objects.get(id = 1)
b.delete() 
```

这将删除 ID 为 1 的模型对象

要编辑数据：

```
b = ModelName.objects.get(id = 1)
b.name = 'Henry'
b.save() 
```

这会将 ID 为 1 的模型对象的名称更改为 Henry

* * *

## 回答 #3

> 赞同：-9
> 
> 时间：2008-11-22T13:32:44.657

阅读以下内容：[Django 管理站点](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#ref-contrib-admin)。然后用具体细节修改你的问题。

# c# - CollectionBase 与泛型

> ID：311193
> 
> 赞同：17
> 
> 时间：2008-11-22T10:38:08.253
> 
> 标签：c#, .net, generics

我正在将应用程序从 .NET 1.1 迁移到 .NET 2.0。我应该删除 CollectionBase 的所有用途吗？如果是这样，迁移的最佳策略是什么？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-22T10:41:25.097

是的，最好看的类在 System.Collections.Generic 中。
我通常使用列表。

您可以使用两种方法：

**一种**

```
public class MyClass
{
  public List<MyItem> Items;
} 
```

**乙**

```
public class MyItemCollection : List<MyItem>
{
}

public class MyClass
{
  public MyItemCollection Items;
} 
```

这两种方法只有非常细微的差别，如果您打算扩展 List 的功能，您只需要使用方法 (B)。

这是一个包含更多信息的链接：http:
[//msdn.microsoft.com/en-us/library/6sh2ey19 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/6sh2ey19(VS.80).aspx)

对于您已经实现的类，您可以删除 IList 接口中指定的所有功能。例如

```
public int Add(InstrumentTradeDataRow instTrade) { return List.Add(instTrade); } 
```

这可以删除，因为 List 已经为您实现了类型安全的 Add 函数。

有关详细信息，请参阅此链接：http:
[//msdn.microsoft.com/en-us/library/3wcytfd1 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/3wcytfd1(VS.80).aspx)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-23T13:18:46.603

通常，`List<T>`可以完成您通常想要的大部分工作。如果你想自定义行为，你应该继承自`Collection<T>`- 这有`virtual`方法，所以你可以在添加/删除/更新等时调整行为。你不能这样做，`List<T>`因为没有（有用的）`virtual`方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T11:22:46.900

我更喜欢 Mark Ingrams A) 方法，可能使用您自己编写的基类。

迁移到泛型还有另一个问题。转换倾向于产生一定的病毒效应。你可能会发现在你完成之前不可能停下来。如果你认为你要花几个小时来做​​一些泛型，你会经常发现自己花了几天时间来做所有的泛型。

您可以/应该通过将新类运算符重载到列表中来避免这种情况

```
public static implicit operator MyClass(List m) 
{
   // code to convert from m to MyClass
}

public static explicit operator List(MyClass m) 
{
    // code to convert from MyClass list
} 
```

这些真的只是权宜之计。您可以在以后的任何阶段对这些使用“查找用法”来确定哪些地方尚未完全转换。删除所有用法后，您可以删除演员表。

我通常更喜欢使从 MyClass 到 List 的演员表显式（这是你不想走的方式）和其他隐式。

最好的方法通常是从您的层的顶部开始，靠近表示层并向下工作。（这与您的想法相反。如果您从 MyClass 到 List 的强制转换是隐式的，那么您从哪一端开始并不重要）

# python - Python 中的现代、高性能布隆过滤器？

> ID：311202
> 
> 赞同：57
> 
> 时间：2008-11-22T10:53:57.770
> 
> 标签：python, jython, bloom-filter

我正在寻找一个生产质量的 Python 布隆过滤器实现来处理相当多的项目（比如 100M 到 1B 个项目，误报率为 0.01%）。

[Pybloom](http://www.imperialviolet.org/pybloom.html)是一种选择，但它似乎正在显示它的年龄，因为它定期在 Python 2.5 上引发 DeprecationWarning 错误。Joe Gregorio 也有[一个实现](http://bitworking.org/news/380/bloom-filter-resources)。

要求是快速查找性能和稳定性。我也愿意为特别好的 c/c++ 实现创建 Python 接口，如果有一个好的 Java 实现，甚至可以创建 Jython。

缺乏这一点，关于可以处理 ~16E9 位的位数组/位向量表示的任何建议？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-22T23:35:59.620

我最近也走上了这条路；虽然听起来我的应用程序略有不同。我对在大量字符串上近似集合操作很感兴趣。

您确实做出了需要**快速**位向量的关键观察。根据您想要放入布隆过滤器的内容，您可能还需要考虑所使用的散列算法的速度。你可能会发现这个[库](http://www.partow.net/programming/hashfunctions/index.html)很有用。您可能还想修改下面使用的随机数技术，该技术仅对您的密钥进行一次散列。

在非 Java 位数组实现方面：

*   Boost有[dynamic_bitset](http://www.boost.org/doc/libs/1_37_0/libs/dynamic_bitset/dynamic_bitset.html)
*   Java 有内置的[BitSet](http://java.sun.com/javase/6/docs/api/java/util/BitSet.html)

我使用[BitVector](http://cobweb.ecn.purdue.edu/~kak/dist/)构建了我的布隆过滤器。我花了一些时间分析和优化库，并将我的补丁回馈给 Avi。转到该 BitVector 链接并向下滚动到 v1.5 中的致谢以查看详细信息。最后，我意识到性能不是这个项目的目标，并决定不使用它。

这是我躺在身边的一些代码。我可以把它放在 python-bloom 的谷歌代码上。欢迎提出建议。

```
from BitVector import BitVector
from random import Random
# get hashes from http://www.partow.net/programming/hashfunctions/index.html
from hashes import RSHash, JSHash, PJWHash, ELFHash, DJBHash

#
# ryan.a.cox@gmail.com / www.asciiarmor.com
#
# copyright (c) 2008, ryan cox
# all rights reserved 
# BSD license: http://www.opensource.org/licenses/bsd-license.php
#

class BloomFilter(object):
    def __init__(self, n=None, m=None, k=None, p=None, bits=None ):
        self.m = m
        if k > 4 or k < 1:
            raise Exception('Must specify value of k between 1 and 4')
        self.k = k
        if bits:
            self.bits = bits
        else:
            self.bits = BitVector( size=m )
        self.rand = Random()
        self.hashes = []
        self.hashes.append(RSHash)
        self.hashes.append(JSHash)
        self.hashes.append(PJWHash)
        self.hashes.append(DJBHash)

        # switch between hashing techniques
        self._indexes = self._rand_indexes
        #self._indexes = self._hash_indexes

    def __contains__(self, key):
        for i in self._indexes(key): 
            if not self.bits[i]:
                return False    
        return True 

    def add(self, key):
        dupe = True 
        bits = []
        for i in self._indexes(key): 
            if dupe and not self.bits[i]:
                dupe = False
            self.bits[i] = 1
            bits.append(i)
        return dupe

    def __and__(self, filter):
        if (self.k != filter.k) or (self.m != filter.m): 
            raise Exception('Must use bloom filters created with equal k / m paramters for bitwise AND')
        return BloomFilter(m=self.m,k=self.k,bits=(self.bits & filter.bits))

    def __or__(self, filter):
        if (self.k != filter.k) or (self.m != filter.m): 
            raise Exception('Must use bloom filters created with equal k / m paramters for bitwise OR')
        return BloomFilter(m=self.m,k=self.k,bits=(self.bits | filter.bits))

    def _hash_indexes(self,key):
        ret = []
        for i in range(self.k):
            ret.append(self.hashes[i](key) % self.m)
        return ret

    def _rand_indexes(self,key):
        self.rand.seed(hash(key))
        ret = []
        for i in range(self.k):
            ret.append(self.rand.randint(0,self.m-1))
        return ret

if __name__ == '__main__':
    e = BloomFilter(m=100, k=4)
    e.add('one')
    e.add('two')
    e.add('three')
    e.add('four')
    e.add('five')        

    f = BloomFilter(m=100, k=4)
    f.add('three')
    f.add('four')
    f.add('five')
    f.add('six')
    f.add('seven')
    f.add('eight')
    f.add('nine')
    f.add("ten")        

    # test check for dupe on add
    assert not f.add('eleven') 
    assert f.add('eleven') 

    # test membership operations
    assert 'ten' in f 
    assert 'one' in e 
    assert 'ten' not in e 
    assert 'one' not in f         

    # test set based operations
    union = f | e
    intersection = f & e

    assert 'ten' in union
    assert 'one' in union 
    assert 'three' in intersection
    assert 'ten' not in intersection
    assert 'one' not in intersection 
```

此外，就我而言，我发现为 BitVector 提供更快的 count_bits 函数很有用。将此代码放入 BitVector 1.5，它应该为您提供更高效的位计数方法：

```
def fast_count_bits( self, v ):
    bits = (
            0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4,
            1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
            1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
            2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
            1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
            2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
            2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
            3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
            1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
            2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
            2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
            3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
            2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
            3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
            3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
            4, 5, 5, 6, 5, 6, 6, 7, 5, 6, 6, 7, 6, 7, 7, 8 )

    return bits[v & 0xff] + bits[(v >> 8) & 0xff] + bits[(v >> 16) & 0xff] + bits[v >> 24] 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2010-11-08T15:10:21.320

作为对 Parand 的回应，他说“常见的做法似乎是使用 SHA1 之类的东西并将位拆分以形成多个哈希”，虽然从某种意义上说这是常见的做法（PyBloom 也使用它），这可能是正确的，但它仍然没有不是说这是正确的做法；-)

对于布隆过滤器，散列函数的唯一要求是它的输出空间必须在给定预期输入的情况下均匀分布。虽然加密哈希当然可以满足这一要求，但它也有点像用火箭筒射击苍蝇。

而是尝试使用每个输入字节仅使用一个 XOR 和一个乘法的[FNV Hash](http://www.isthe.com/chongo/tech/comp/fnv/)，我估计它比 SHA1 快几百倍:)

FNV 哈希在密码学上不是安全的，但您不需要它。它有稍微[不完美的雪崩行为](https://web.archive.org/web/20130617200738/http://bretm.home.comcast.net/~bretm/hash/6.html)，但你也没有将它用于完整性检查。

关于一致性，请注意第二个链接仅对 32 位 FNV 散列进行卡方检验。最好使用更多位和 FNV-1 变体，它交换 XOR 和 MUL 步骤以获得更好的位分散。对于布隆过滤器，还有一些捕获，例如将输出统一映射到位数组的索引范围。如果可能的话，我会说将位数组的大小四舍五入到最接近的 2 次幂并相应地调整*k*。这样您可以获得更好的准确性，并且可以使用简单的 XOR 折叠来映射范围。

Additionally, here's a reference explaining why you don't want SHA1 (or any cryptographic hash) when you need [a general purpose hash](https://web.archive.org/web/20120722074824/http://bretm.home.comcast.net/~bretm/hash/9.html).

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2010-08-02T17:00:09.387

最终我找到[了 pybloomfiltermap](http://github.com/axiak/pybloomfiltermmap)。我没用过，但看起来很合算。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-22T13:51:25.087

查看[阵列](http://www.python.org/doc/2.5.2/lib/module-array.html)模块。

```
class Bit( object ):
    def __init__( self, size ):
        self.bits= array.array('B',[0 for i in range((size+7)//8)] )
    def set( self, bit ):
        b= self.bits[bit//8]
        self.bits[bit//8] = b | 1 << (bit % 8)
    def get( self, bit ):
        b= self.bits[bit//8]
        return (b >> (bit % 8)) & 1 
```

FWIW，所有`//8`and`% 8`操作都可以替换为`>>3`and `&0x07`。这*可能会*导致稍微更好的速度，但有一些晦涩的风险。

此外，在大多数硬件上更改和`'B'`更改`8`应该更快。[在某些硬件上更改为16 可能会更快，但这值得怀疑。]`'L'``32``'H'`

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-12-05T12:00:28.257

It's almost a decade since the most recent answers on here. And times do change.

看起来 2019 年末最受欢迎的*维护*布隆过滤器包现在是这个：[https](https://github.com/joseph-fox/python-bloomfilter) ://github.com/joseph-fox/python-bloomfilter ，在 PyPi 上作为 pybloom_live 提供：[https ://pypi.org/project/pybloom_live /](https://pypi.org/project/pybloom_live/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-08-21T18:27:47.210

I've put up a python bloom filter implementation at [http://stromberg.dnsalias.org/~strombrg/drs-bloom-filter/](http://stromberg.dnsalias.org/~strombrg/drs-bloom-filter/)

It's in pure python, has good hash functions, good automated tests, a selection of backends (disk, array, mmap, more) and more intuitive arguments to the `__init__` method, so you can specify an ideal number of elements and desired maximum error rate, instead of somewhat ethereal, datastructure-specific tunables.

# matlab - 在 MATLAB 中将两个 2 向量相乘时出现数值类型错误

> ID：311206
> 
> 赞同：7
> 
> 时间：2008-11-22T10:57:31.443
> 
> 标签：matlab, vector, math

我有这两个向量：

```
alpha =
     1    1    1    1    1    1    1    1    1

f_uv =
   193  193  194  192  193  193  190  189  191 
```

当我这样做时：

```
alphaf_uv = alpha * f_uv' 
```

我收到错误消息：

```
"??? Error using ==> mtimes
Integers can only be combined with integers of the same class, or scalar doubles." 
```

有趣的是，如果我在控制台中定义相同的向量并在那里尝试乘法，则不会出现此错误。

`alpha`由我定义，`f_uv`是从 PNG 图像中的某些像素中获得的。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-22T11:05:32.723

假设它们都是整数矩阵，`f_uv'`可能不是。

尝试：

```
alphaf_uv = double(alpha) * double(f_uv') 
```

并让我们知道它是否仍然发生。

之后您可能需要`alphaf_uv`转回整数类型，具体取决于您的需要。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-15T20:51:05.217

这里的大线索是：

> alpha is defined by me and f_uv is obtained from some pixels in a png image.

This heavily implies that the *f_uv* data is coming in as uint8\. The WHOS command will verify. When you define this at the command line, the vectors will be Double by default. That is why you are seeing the difference in behavior between "identical" matrices.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T11:09:45.647

也许 f_uv 是一个由 .toString() 方法返回的具有“控制台值”的对象。在这种情况下，您可能需要将 f_uv 设置为 (int)。

# c# - 在哪里放置您的代表。.

> ID：311213
> 
> 赞同：3
> 
> 时间：2008-11-22T11:08:18.800
> 
> 标签：c#, delegates, directory-structure

我正在尝试确定我的应用程序的最佳目录结构

我有：

UI
数据
接口

但我不知道把代表放在哪里..

是否应该有一个单独的 Delegates 文件夹，或者我应该将代表存储在使用它们的相同类中。.

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T11:17:03.730

如果您的代表有共同用途，则应将它们存储在一个共同的地方，但如果您只在您的班级中使用它，则将其放在同一个班级中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T14:24:04.960

您没有 Classes、Structs 和 Enums 文件夹。为什么有一个代表文件夹？

此外，如果您使用的是 C# 3.0，则通常应该使用通用委托 - System.Action 和 System.Func - 而不是命名委托。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T22:44:19.647

我认为这是个坏主意。您应该按照与 Microsoft 相同的方式按功能对代码进行排序。

至于代表，你不再需要他们了。现在我们有了通用的 Func 和 Action 委托，没有理由创建您自己的委托。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T11:19:32.087

委托本质上是引用类型的方法容器。在我看来，您应该将代表存储在使用它们的相同类中。无需创建单独的委托文件夹。

# emacs - 在 Emacs 中教初学者什么？

> ID：311221
> 
> 赞同：26
> 
> 时间：2008-11-22T11:13:26.530
> 
> 标签：emacs

如果你有一个 10 分钟的实践课程来教某人 Emacs，你会向他们展示什么？

```
启动emacs：emacs
 ...
退出emacs：Cx Cc

```

当你站在他们身后时，你还会让他们在启动和退出 Emacs 之间做什么？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-11-22T19:18:22.120

如果我只有 10 分钟，我根本不会教他们任何捷径。所有常用的快捷键都在菜单中相应的命令旁边；用户可以自己发现的。

要教的最重要的东西是那些使用户能够自己发现/学习的东西：

*   可以使用`C-x C-c`或 File->Quit 退出 Emacs。当卡住时，应该输入`C-g`，如果这不起作用，`ESC ESC ESC`。[这可能是防止对 Emacs 完全失望的最有用的建议，相信我。]

*   教程：帮助->Emacs 教程，或`C-h t`. [这不是一个非常有用的*记住*快捷方式；考虑到一个人在一生中读过多少次教程……]

*   Emacs 中的每个按键都绑定到一个函数的概念，而 Emacs 所做的只是一个接一个地执行函数。有比可能绑定到键更多的功能，并且可以使用 调用没有击键的功能`M-x function-name`。

*   这可以发现特定键调用的功能`C-h k [keystroke]`。让用户浏览其中的一些内容（包括有趣的事实，即键入字母并不特殊，只是调用`self-insert-command`，所以如果需要，可以绑定字母“z”来发送电子邮件：D）

*   `C-h a`可以使用（或）搜索可能有用的功能`M-x apropos-command`，例如`C-h a paragraph`显示与段落有关的所有命令，包括哪些快捷方式将带一个到段落的结尾/开头。这`C-h w command-name`将告诉您该命令是否绑定到某个击键。[让他们通过这个来发现**撤消**的关键是什么——通常他们会尝试 Cz 并且它会做一些令人讨厌的事情:)]

*   您可以阅读有关函数如何使用`M-x describe-function`( `C-h f`) 的详细文档。Emacs 对大多数事情都有很好的文档；和`M-x apropos-documentation`( `C-h d`) 是发现东西的好方法。

*   那个人的设置存储在 .emacs 中，即使不了解 Emacs Lisp，也可以通过查看该文件来收集一些东西。

*   通常可以通过在其后键入来找到“完成”一组特定键的所有击键`C-h`，例如，“Cx Ch”将显示所有以 Cx 开头的快捷键；`C-h C-h`特别有用；`C-c C-h`对于特定于模式的命令很有用，例如在 java-mode 或 c++-mode 或 LaTeX-mode 等时。（嗯，“modes”...）

*   当卡住时，可以搜索[http://www.emacswiki.org/](http://www.emacswiki.org/)。（或者在 Freenode 的 #emacs IRC 频道中提问，或者发帖到[gnu.emacs.help](http://groups.google.com/group/gnu.emacs.help/topics)。）

这应该适合 10 分钟，我认为这是最重要的东西。我不会因为太多要记住的快捷方式而过载；无论如何，这毫无意义——如果用户知道如何发现快捷方式，他们就会找到他们最常使用的任何东西的快捷方式。不过，请他们写下这些命令的名称，以及关于 Emacswiki 等的名称。

重要的是向他们展示 Emacs 的强大功能以及它的模型的通用性（所有关于它是操作系统的笑话都不仅仅是笑话）。如果您只是显示一堆神秘的快捷方式来完成他们已经在其他编辑器中可以完成的事情，那么 Emacs 似乎不值得这么麻烦。*本着同样的精神，我也完全支持 Anton Nazarov 的回答，即向他们展示 Emacs 可以为他们的*特定目的做什么（如果他们使用 LaTeX，则为 AucTeX 等） 。然后他们可以自己判断 Emacs 是否值得学习，并使用以上所有内容进行学习。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-22T11:15:55.730

向他们展示如何开始本教程：Ch t

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-22T12:52:27.733

[Cx Mc M-蝴蝶](http://xkcd.com/378/)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-22T23:09:55.443

我会展示对新手用户模式最重要的内容。例如，当我向物理学院的朋友展示 Emacs 时，我向他们展示了[AucTeX](http://www.emacswiki.org/emacs/AUCTeX)和 preview-latex 和 RefTeX。iMaxima也[很棒](http://members3.jcom.home.ne.jp/imaxima/Site/Welcome.html)。如果我必须向软件开发人员展示 Emacs，我会向他们展示 JDEE 或带有 Ropemacs 的 Python 模式。俄罗斯方块、流浪汉和 w3m 可以用来表明 Emacs 可以做任何事情 :) 然后我将展示如何开始教程并提供[EmacsWiki.org的链接](http://emacswiki.org)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-22T11:16:54.213

我想你告诉他如何

*   打开和保存文件
*   杀死/切换缓冲区
*   切换/杀死/拆分窗口
*   选择一个范围。

并告诉他有关 Mx 的信息。告诉他他在某处写下这些步骤。我认为可以使用箭头键完成基本导航。现在这就是他所需要的。

如果他知道`M-x`，他可以很容易地找到搜索、替换和其他东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-23T17:30:07.017

在给出 emacs 示例时，仅给出键绑定是远远不够的，因为它可以而且确实会有所不同。Cx Mc 在我的系统上未定义。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-22T11:37:31.643

当我启动 XEmacas 时，直到我按下一个键，它才会在两个屏幕之间交替。其中之一具有以下特性：

```
XEmacs 21.4 (patch 21) "Educational Television" (cygwin, Mule) of Tue Dec  4 2007 on vzell-de 

`C-' means the control key,`M-' means the meta key 

Information, on-line help: 

XEmacs comes with plenty of documentation... 

M-? F: read the XEmacs FAQ (a capital F!) 
M-? t: read the XEmacs tutorial (also available through the Help menu) 
f1: get help on using XEmacs (also available through the Help menu) 
M-? i: read the on-line documentation 

M-x describe-project: read about the GNU project 
M-x about-xemacs: see who's developing XEmacs 
```

我会请别人大声念出来，确保他们明白上面的意思，然后给他们我的手机号码和急救箱，以备不时之需。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-22T11:47:36.147

我将展示最常见操作的快捷方式，例如：

*   保存：ctrl-xs
*   另存为：ctrl-xw
*   打开/查找文件：Ctrl-f
*   撤消： ctrl-_
*   终止缓冲区： ctrl-xk
*   切换到缓冲区：ctrl-b
*   填段：mq

并复制/剪切和粘贴：

*   设置标记：ctrl-space
*   剪切： ctrl-w
*   复制：MW
*   剪切线：ctrl-k
*   粘贴：ctrl-y

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-22T12:23:37.917

*   打开一个文件，
*   保存文件，
*   基本导航，
*   设置标记、复制、剪切和粘贴，
*   显示撤消和杀死环，
*   显示CG，
*   显示搜索和替换，
*   拆分窗口并移动到其他窗口，
*   切换到其他缓冲区，
*   显示教程，
*   解释信息，
*   显示指向：
    *   打开一些文件，
    *   运行命令以压缩另一个文件，
    *   打开、编辑和保存压缩文件，
    *   在远程主机上打开一个目录，
    *   在远程主机上打开并保存一些文件，
    *   从远程主机复制一些文件。
*   打开一个 shell 并运行一些长输出命令并在缓冲区中导航。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-12-03T00:50:40.613

1.  学习使用帮助`C-h C-h`
2.  做教程练习。
3.  杀死一个东西，另一个东西，第三个，然后`C-y`拉它，然后`M-y`循环杀戮环。大“哇”的因素，又快又便宜。然后告诉他们**它在他们的日常 shell**中有效。
4.  [在带有标记 ring](http://www.gnu.org/s/libtool/manual/emacs/Mark-Ring.html)的缓冲区中导航。`C-u C-SPC`（空格）将您带到*您之前所在*的位置，并重复循环最后 16 个位置，而不管编辑状态如何。

你知道什么时候你羞怯地撤消事情只是为了得到“你以前的位置”吗？你去吧。

这是一个杀手级的 emacs 忍者技巧。每个人都应该尽快知道。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-12-18T21:45:23.443

我认为在尝试教他们一些东西之前首先要问的是“他们想从学习 Emacs 中得到什么？” 并且，您是想向他们推销学习 Emacs 的想法，还是他们已经承诺。

如果他们是程序员并且正在寻找新的开发环境，请向他们展示 ECB、标签如何工作等？如果他们正在寻找通用文本编辑器，请向他们展示`M-x re-builder`。如果他们希望快速编写文档并最终发布它们，请`org-mode`使用 HTML 和 LaTeX 导出来展示它们。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-12-19T10:46:31.967

除了已经提到的内容之外，我还会`M-x global-set-key`在展示完`M-x`一般性和`M-x apropos`.

我会告诉他们，Emacs 的意义在于它是无限可定制的，并且应该对其进行个性化以适合自己的喜好。我会告诉他们先试用标准键绑定，然后在 Bash、OS X 等中显示它们的优势。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-03-12T10:32:45.117

*   CG
*   复制粘贴
*   拆分窗口
*   MX
*   恰到好处
*   描述键
*   描述命令
*   打开文件
*   开关缓冲器
*   特定于语言的开发环境，包括调试器和 REPL。

# apache-flex - Flex 构建的推荐项目结构

> ID：311241
> 
> 赞同：1
> 
> 时间：2008-11-22T11:43:07.123
> 
> 标签：apache-flex, build-process, flexbuilder

我正在开始一个使用 Flex3 的新项目，该项目具有相当复杂的 UI，可从一组 RESTful Web 服务中获取数据。我想知道其他人在构建一个中等复杂的 Flex 项目时有什么经验。我正在考虑的问题包括：

*   我想使用我们的 FlexBuilder 许可证在 Eclipse 上对布局进行可视化编辑和调试代码
*   自动构建脚本，以便我们可以使用 CI 服务器
*   测试策略，尤其是自动化单元测试
*   跨平台的 Linux 和 Windows 开发环境（是的，我知道 Linux 版本的 FlexBuilder 不进行可视化编辑，但其他一切都应该在理想情况下跨平台运行）
*   至少对 Java 代码进行依赖管理（是否有用于 Flex 的库依赖管理器？）

我刚刚花了一天时间试图让 maven2/flex/jetty 构建设置顺利运行（基于[Jeff Maury 的教程](http://riadiscuss.jeffmaury.com/2008/09/maven-and-flex-builder-tutorial-part-i.html)）。在我们前进的过程中，我并不反对使用 Maven，但我确信一定有一条不那么痛苦的路线。我遇到的主要问题（除了 maven 文档不完整）是 maven 的“每个构建单个工件”规则意味着您必须通过复杂的构建跳过很多圈，而且我还不够 maven 启动不是绊倒在我的脸上！

Ant 和 Ivy 会比 maven2 更好吗？还有哪些其他选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T15:28:04.627

我不知道 Flex 开发，但我知道 CI，所以我会在这方面发表评论。

我在[CruiseControl](http://cruisecontrol.sourceforge.net/)上工作，所以这就是我使用的（当没有获得报酬来设置其他东西时）。还有一些博客文章描述了在 CC 下为[Windows](http://www.eyefodder.com/blog/2006/05/continuous_integration_with_fl_5.shtml)和[Linux](http://weblogs.macromedia.com/pmartin/archives/2007/01/continous_integ.html)设置 Flex 项目。CC 已经存在了很长时间，因此有一个庞大的用户社区和许多与之配合使用的[第三方工具。](http://confluence.public.thoughtworks.org/display/CC/3rdPartyCCStuff)

但是其他人可能会推荐[Hudson](http://hudson-ci.org/)，而且很难反对他们。Hudson 很容易启动和运行，并且有一个很好的基于 Web 的 UI。这个项目非常活跃，有很多粉丝和很多嗡嗡声，并且已经非常迅速地成熟。我对此没有什么不好说的。此博客条目描述了[在 Hudson 下运行验收测试](http://www.blackpepper.co.uk/black-pepper-blog/Adding-Selenium-Flex-tests-to-a-Hudson-job.html)。

我对 Maven 的了解还不够，无法在那里提供建议，但我现在正在与 Ivy 一起在客户那里工作，我真的很喜欢它。我们拥有 Java 和 C++ 代码的组合，我们能够让 Ivy 做我们需要的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:30:45.953

好吧，我们正在使用 Maven。在许多不同网站的帮助下，我有一个使用 maven 构建的企业应用程序。

通过 adobe 撰写的这篇文章确实有很大帮助。
[http://www.adobe.com/devnet/flex/articles/fullstack_pt1.html](http://www.adobe.com/devnet/flex/articles/fullstack_pt1.html)
[http://www.adobe.com/devnet/flex/articles/fullstack_pt2.html](http://www.adobe.com/devnet/flex/articles/fullstack_pt2.html)
[http://www.adobe.com/devnet/弹性/文章/fullstack_pt3.html](http://www.adobe.com/devnet/flex/articles/fullstack_pt3.html)

您确实需要一个在 flex 和 java 之间共享的通用配置项目，可能还有您的 c++ 代码。本文解释了如何设置所有这些。

不利的一面是，如果您对 Maven 不了解，那么学习曲线会很慢。

# php - PHP用POST数据打开另一个网页

> ID：311242
> 
> 赞同：10
> 
> 时间：2008-11-22T11:45:12.173
> 
> 标签：php, post, redirect, header

我是 PHP 新手，我正在尝试做一些可能是不好的做法并且很可能是不可能的事情。我基本上只是在拼凑一些东西来测试我的知识，看看 PHP 能做什么。

我有一个带有收集数据的表单的网页。这被提交给一个 PHP 脚本，该脚本执行一堆处理 - 但实际上并不显示任何重要的东西。我想要的是，一旦处理完成，脚本就会告诉浏览器打开另一个页面，显示结果。

我知道我可以使用*header('Location: page.php');* 但我不知道如何提供 POST 数据。我怎样才能做到这一点？或者，是否有另一种方法告诉浏览器打开另一个页面？

编辑：我从回复中得到的是，*可以*使用各种黑客来做到这一点，但我最好将处理和显示代码放在一个文件中。我对此很满意；这比什么都重要。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-22T12:16:12.737

您可以将该数据存储在会话中，例如在处理帖子的第一个文件中

```
session_start();
$_SESSION['formdata'] = $_POST; //or whatever 
```

然后你可以在下一页阅读它

```
session_start();
print_r($_SESSION['formdata']); 
```

或者您可以通过 GET 传递它：（但根据评论，这是一个坏主意）

```
header('Location: page.php?' . http_build_query($_POST)); 
```

如果这样做，请确保在 page.php 上进行额外的处理/验证，因为恶意用户可能会更改变量。您也可能不需要将整个帖子传输到下一页

**编辑**

我应该明确指出，我认为第二种选择可能更糟，因为您受到可以通过 get 发送的数据大小的限制，并且它可能不太安全，因为用户可以更明显地操纵数据。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-24T07:58:34.283

处理完成后是否真的需要调用另一个页面？我可能会做以下事情：

```
<form method="post" action="display.php">
...
</form> 
```

显示.php：

```
if ($_POST) {
    require_once(process.php);
    process($_POST);
    display_results;
} 
```

使用 process.php 包含处理发布请求所需的代码。

或者，您可以使用 cURL 库之类的东西将处理结果传递给您自己指定的页面。不知道这是否真的是你所追求的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-22T13:38:11.883

您可以使用 JavaScript 作为一种肮脏的解决方法：

```
<form id="redirect_form" method="post" action="http://someserver.com/somepage.php">
    <input type="hidden" name="field_1" value="<?php echo htmlentities($value_1); ?>">
    <input type="hidden" name="field_2" value="<?php echo htmlentities($value_2); ?>">
    <input type="hidden" name="field_3" value="<?php echo htmlentities($value_3); ?>">
</form>
<script type="text/javascript">
    document.getElementById('redirect_form').submit();
</script> 
```

（脚本应在表格下方）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T12:24:23.983

无法将用户的浏览器重定向到任意页面并发送 POST 请求。这会带来一点安全风险，任何链接都可能导致您向任意站点提交任何表单，而您对将要发生的事情一无所知。

简而言之，这是不可能的

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-22T12:58:56.037

AFAIK 这通常分两步完成：

1.  在 form.php 上，将数据发布到脚本 process.php
2.  process.php 脚本处理数据但从不输出任何内容，它总是调用 header("Location: asdasd") 重定向到 success.php 或 failure.php 页面（如果适用）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-24T08:07:06.733

在一个脚本中完成所有操作，并为结果输出不同的 HTML。

```
<?php  if($doingForm)  {   ?>

html for form here

<?php } else { ?>

html for results

<? } ?> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T09:42:51.727

这个问题困扰了我一段时间。我的自定义 CMS 做了一些相当复杂的处理、上传和操作，所以有时会输出很长的错误和信息消息，不适合转换为 GET 数据，我一直想避免数据 INSERT 的重新加载问题，但是还没有找到合适的解决方案。

我相信解决这个问题的正确方法是为每个可能的状态创建消息数组 - 您可能想要显示的每个消息或错误，然后您只需要发送比 long 更容易处理的错误/消息编号数据字符串，但这是我个人一直回避的东西，因为我觉得它有点乏味和麻烦。坦率地说，这可能只是我的懒惰。

我非常喜欢 SESSION 变量存储解决方案，但这提出了一个问题，即如何确保正确销毁 SESSION 数据？只要您确保您只发送信息（消息/错误）而不是应该/可以存储的数据（因此可能是敏感的），这应该是一个可以避免的问题。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-11-22T12:12:18.127

我希望你的问题是正确的。你可以试试这个：

1.  调整你的表格看起来像这样：

表单方法=“POST”操作=“process_data.php”

2\. 然后你创建文件 process_data.php，它出人意料地处理数据。
在此文件中，您使用标题：
例如：

$head = sprintf("page.php?data1=%d?data2=%d",$data1,$data2);
标头（$头）；

我希望我能帮上忙。

# java - 如何为各种 Java 类授予不同的权限？

> ID：311243
> 
> 赞同：6
> 
> 时间：2008-11-22T11:45:24.873
> 
> 标签：java, security, classpath, sandbox

我有一个 Java 应用程序，我想让它可扩展。为了创建扩展，我们公司的开发人员将编写一个实现特定接口的 Java 类。他们可能还希望编写相关的辅助类。我想将这些扩展加载到应用程序中而不会中断。

我想将此类可以执行的操作限制为以下内容：

1.  调用应用程序 API 中的方法（这将是构造函数的参数）
2.  在同一个包中创建其他对象的实例（因此扩展类的作者可以使用其他类来完成工作）。

当调用该类时，传入的 API 对象已经定义了一个“客户”并将其存储为成员变量。它将使用它来限制通过 API 访问该客户的数据。

我不希望这些类做一些事情，比如访问数据库、写入磁盘或做其他事情等。这主要是依赖管理和封装的努力，因为同一个开发团队将有权编写扩展和核心系统。

有这种模式吗？我在正确的轨道上吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-23T01:46:00.357

你不需要寻找任何异国情调的东西。处理这种情况是 Java 安全体系结构的一个基本特征。

每个类都有一个“代码库”，即加载它的位置。因此，如果您将每个扩展打包在单独的 JAR 中（或在单独的目录中展开），您将能够定制授予该代码库的权限。

在你的情况下，这听起来更简单。如果我理解正确，所有扩展都将具有相同的权限，这些权限低于父应用程序的权限。因此，它们都可以共享一个代码库。

以下是策略文件的示例：

```
grant codeBase "file:/path/to/app/lib/*" {
  permission java.io.FilePermission "/path/to/app/-", "read";
  permission java.io.FilePermission "/path/to/app/data/-", "read,write,delete";
};

grant codeBase "file:/path/to/app/ext/*" {
  permission java.util.PropertyPermission "java.io.tmpdir", "read";
  permission java.io.FilePermission "${java.io.tmpdir}/myapp/-", "read,write,delete";
}; 
```

这个简单的示例应该适用于[任何版本的 Java](http://java.sun.com/j2se/1.3/docs/guide/security/permissions.html)。较新的版本具有[扩展的策略语法](http://java.sun.com/javase/6/docs/technotes/guides/security/permissions.html)，以向 JAAS 认证的主题授予权限。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T12:12:39.577

[我不知道实现细节，但您的想法似乎与Apache Tomcat](http://tomcat.apache.org/)服务器已经做的很接近。Tomcat 中的各个 web 应用程序通过不同的单独类加载器保持分离。也许值得看看那里的代码。

# c++ - 使用插件更改 C++ 应用程序中的默认行为

> ID：311247
> 
> 赞同：3
> 
> 时间：2008-11-22T11:49:34.007
> 
> 标签：c++, plugins, factory

简而言之：设计和实现工厂+插件机制的最佳方式是什么，以便插件可以替换主应用程序中的对象。

我们有一个代码库，用于构建我们的应用程序。代码库适用于 70-95% 的应用程序，这意味着在每个新应用程序中，我们需要更改 5-30% 的默认行为（添加新功能、更改默认逻辑、添加 GUI 等）。

该实现是基于插件的：代码库内置在 EXE 和 DLL 中，当主 EXE 运行时，我们加载一个添加所需功能的 DLL。

目前每个插件都公开了以下功能：

```
PluginInterface* PluginInit()
{
    return new MyCustomizedPluginInterface();
} 
```

其中 PluginInterface 定义为：

```
class PluginInterface {
public:
    virtual SomeClass1* customizedSomeClass1() = 0;
    virtual SomeClass2* customizedSomeClass2() = 0;
}; 
```

SomeClass1/SomeClass2 有一些默认行为，但可以被插件覆盖和更改。

当前的实现使得添加新的自定义类变得困难。我们想用插件替换主应用程序中的每个类，所以使用对象工厂是有意义的。

我知道的一个 SDK 使用以下技术：

```
PluginInterface* PluginInit(GodObject* godObject)
{
    FactoryForSomeClasses* factoryForSomeClasses = 
        godObject->factoryForSomeClasses();
    factoryForSomeClasses->setSomeClass1Creator( MyCustomizedSomeClass1::create); // create is a static creator function.
    factoryForSomeClasses->setSomeClass2Creator( MyCustomizedSomeClass2::create);
} 
```

我想知道这种方法是否有任何替代方法。

你会如何推荐像我刚才描述的那样设计和实现一个插件系统/工厂？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T17:37:08.563

不久前在 Dobb 医生那里有一篇文章讨论了这个确切的问题。这是相关文章[的链接](http://www.ddj.com/cpp/204202899)。

顺便说一句，您可能希望为项目的插件使用直接的 C 接口。这样，您可以轻松地将几乎任何语言编写的代码链接到您的框架中。虽然 C++ 很好，但能够利用比 C++ 中更多的东西，比如 Java 和 Python 领域中存在的令人难以置信的框架，从长远来看可能是有益的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T14:16:44.850

您是否查看过插件框架的 CodeProject 示例？ [https://secure.codeproject.com/KB/DLL/plugin.aspx](https://secure.codeproject.com/KB/DLL/plugin.aspx) [http://www.codeproject.com/KB/library/dynobj.aspx](http://www.codeproject.com/KB/library/dynobj.aspx)

# java - Maven2的隐藏特性是什么？

> ID：311249
> 
> 赞同：5
> 
> 时间：2008-11-22T11:52:56.777
> 
> 标签：java, apache, maven-2, dependency-management

Maven2的隐藏特性是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T12:24:40.660

您可以使用 settings.xml 强制在本地计算机上运行的所有 maven 构建也使用本地安装的 maven 代理。节省自己和网络时间。

```
<settings xmlns="http://maven.apache.org/POM/4.0.0"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                  http://maven.apache.org/xsd/settings-1.0.0.xsd">
    <profile>
        <id>localcacheproxies</id>

        <activation>
            <activeByDefault>true</activeByDefault>
        </activation>

        <repositories>
            <repository>
                <id>localCacheProxy</id>
                <url>http://my-local-proxy.com/maven-proxy</url>
            </repository>
        </repositories>
    </profile>
</profiles> 
```

请注意，与此处发布的其他示例相反，此 settings.xml 中的命名空间标题也提供了不错的智能感知。（在 windows、linux 和 mac 以及所有操作系统上的主目录中创建 .m2 文件夹）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-11T00:00:51.150

看看dependency:analyze。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T01:54:14.123

有时您的文件需要包含一些只能在构建时发现的值。也许您有一个 Java 类来检查评估期是否已到，并且您将该期定义为“编译此构建后的 30 天”。您需要一种将当前日期或其他属性直接注入构建的方法。

Maven 有一个很酷的隐藏功能，称为过滤（[此处的文档](http://maven.apache.org/guides/getting-started/index.html#How_do_I_filter_resource_files)）。通过过滤，您可以要求 Maven 在某些源文件中查找模式并将其替换为某个值，并且它很容易激活，如下所示：

```
 <build>
    <resources>
      <resource>
        <directory>src/main/resources</directory>
        <filtering>true</filtering>
      </resource>
    </resources>
  </build> 
```

什么东西可以塞进过滤器？任何环境变量，pom 文件中的大部分值，以及有关 java 编译器的信息。现在，如果您在 Maven 中更改您的版本号，您不必去查找您的whatever.properties 文件并在那里更新您的版本。你可以在 Maven 中修改它，你就完成了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-22T11:58:50.993

使用 maven-dependency-plugin 可以解决依赖冲突和循环依赖问题。

添加到您的 pom.xml：

```
<plugin>
   <groupId>org.apache.maven.plugins</groupId>
   <artifactId>maven-dependency-plugin</artifactId>
</plugin> 
```

然后运行**​​mvn dependency:resolve**或**mvn dependency:build-classpath**来测试它。

更多关于依赖插件： [http ://maven.apache.org/plugins/maven-dependency-plugin/howto.html](http://maven.apache.org/plugins/maven-dependency-plugin/howto.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T01:39:47.577

1.  项目继承
2.  项目聚合
3.  组装：组装
4.  报告（findbugs、checkstyle、clover、pmd 等）

# c# - DropDownList.SelectedValue 更改（作为 FormView 中的子控件）没有坚持

> ID：311250
> 
> 赞同：2
> 
> 时间：2008-11-22T11:54:44.543
> 
> 标签：c#, asp.net, data-binding, drop-down-menu, formview

好的，我在 InsertItemTemplate 中有一个带有几个子控件的 FormView。其中之一是 DropDownList，称为 DdlAssigned。我在页面的 OnLoad 方法中引用它，如下所示：

```
protected void Page_Load(object sender, EventArgs e)
{
    ((DropDownList)FrmAdd.FindControl("DdlAssigned")).SelectedValue =
          ((Guid)Membership.GetUser().ProviderUserKey).ToString();
} 
```

基本上我只是将 DropDownList 的默认值设置为当前登录的用户。

无论如何，当页面完成加载时，SelectedValue 更改不会反映在页面上。我逐步浏览了 OnLoad，我可以看到我的观察列表中反映的变化，但是当一切都说完了，页面上没有什么不同。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T06:10:10.603

我想到了。我仍然不知道为什么它不能仅在 FormLoad 上工作，但是在 FormView 的 DataBound 事件中执行更改就可以了。

```
protected void FrmAdd_DataBound(object sender, EventArgs e)
{
    // This is the same code as before, but done in the FormView's DataBound event.
    ((DropDownList)FrmAdd.Row.FindControl("DdlAssigned")).SelectedValue =
        ((Guid)Membership.GetUser().ProviderUserKey).ToString();
} 
```

所以，我想一般的经验法则是，如果在使用数据绑定时对控件进行更改时遇到问题，请尝试在绑定后立即进行更改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T06:15:42.697

我在使用下拉列表时遇到问题，使第一个值说“请选择一个值...”，但没有使其成为实际的可选项目，也没有显示在下拉列表中。我在 page_load 中绑定了 ddl，我必须确保在绑定数据之后设置下拉列表的文本。通过将它添加到数据绑定部分，您已经完成了同样的事情。

# .net - GAC 中程序集的配置文件

> ID：311253
> 
> 赞同：10
> 
> 时间：2008-11-22T11:57:53.833
> 
> 标签：.net, configuration, gac

我有一个 .NET dll 需要从它的配置文件中读取它的配置设置。通常，配置文件与 DLL 放在同一目录中。但是如果 DLL 是 GAC 的，我如何读取配置文件，因为我只能将 DLL 放在 GAC 中，而不是配置文件。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-22T13:30:00.967

用户是否需要配置DLL？如果是这样，那么 DLL 应该使用 app.config 文件中的配置设置，而不是它自己的配置。app.config 文件应存储在与应用程序相同的目录中。如果没有，那么您可以采用几种不同的方式。您可以对 machine.config 文件进行更改，以便您的 Dll 可以在那里找到它们。我不会这样做。或者，您可以将配置存储在设置类中。这些可以通过配置覆盖，但您的默认值将通过属性在设置类的生成代码中设置，因此当需要默认值时，没有配置文件不会影响您的 Dll。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-22T15:26:32.180

我同意 tvanfosson 的 Gac'ed dll 将从应用程序的路径中读取。但是您也可以通过这种方式通知 dll 哪个是路径：

```
System.Configuration.ExeConfigurationFileMap fileMap = new System.Configuration.ExeConfigurationFileMap();
fileMap.ExeConfigFilename = "THE PATH TO THE CONFIG";
System.Configuration.Configuration cfg =
System.Configuration.ConfigurationManager.OpenMappedExeConfiguration(fileMap, System.Configuration.ConfigurationUserLevel.None);

string thevalue=cfg.AppSettings.Settings[variable].Value; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-12-02T11:42:54.243

您可以使用，`AppDomain.CurrentDomain.BaseDirectory`因为DLL库不会自行执行您只需要获取调用他的可执行文件目录

就像是：

```
var appDomain = AppDomain.CurrentDomain.BaseDirectory;
string sFileName = appDomain.Replace("\\bin\\Debug", "");
sFileName = sFileName + "Config\\config.xml"; 
```

在这里，我的可执行文件位于文件夹中`bin\Debug`，并且在文件夹内我有一个名为的文件夹 `Config`，其中我有 xml 配置文件`config.xml`。因此，`sFileName`将为您提供配置文件的相对路径`\bin\Debug\Config\config.xml`

# c# - 在项目的根目录中有代码可以吗？

> ID：311257
> 
> 赞同：5
> 
> 时间：2008-11-22T12:06:13.660
> 
> 标签：c#, directory, structure

我正在尝试提出有关项目目录结构的最佳实践。

我最新的想法是项目的根目录中不应该有类。所有类必须位于以下目录之一

*   用户界面
*   业务对象
*   商业逻辑
*   数据访问

我想听听其他人是否有将事物放在根级别或查找不适合的类的用例

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T12:58:55.567

如果您在谈论 C#，那么我会将您的 DAL、BLL、GUI 分成不同的项目而不是一个项目。并有一个解决方案。这将强制每个代码文件位于其中一个项目中。

我添加了一个示例：

*   解决方案：项目名称
    *   项目：DAL（命名空间：ProjectName.DAL）
        *   文件夹：存储库（命名空间：ProjectName.DAL.Repositories）
        *   文件夹：合同（命名空间：ProjectName.DAL.Contracts）
        *   文件：您的实体映射配置
    *   项目：BLL（命名空间：ProjectName.BLL）
        *   文件夹：服务（命名空间：Project.BLL.Services）
        *   文件夹：实体（命名空间：Project.BLL.Entities）
        *   文件：IoC 配置类/通用业务逻辑
    *   项目：共享（命名空间：ProjectName.Shared）
        *   文件：整个应用程序的通用共享逻辑（例如 InvalidIdentifier 常量）
        *   此项目不应引用解决方案中的其他项目..
    *   项目：网站（命名空间：ProjectName.Website）
        *   你的 asp.net 网站用户界面
    *   项目：Winforms（命名空间：ProjectName.Winforms）
        *   你的 winform 用户界面

如果可能，您应该为网站和 winforms 项目指定一个与您的应用程序相关的名称。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T12:13:24.693

这个[博客](http://www.hanselman.com/blog/howdoyouorganizeyourcode.aspx)应该为您提供一些有趣的阅读，尽管它已经三岁了。它可能会为您提供除了目录结构之外的想法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T12:16:37.603

我放入根文件夹的唯一文件是**Program.cs**和**Program.ico**（如果它是可执行应用程序）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T13:45:39.170

我不这样做，但它与目录结构无关（对我而言）。我希望我的所有代码都在有意义的命名空间中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T15:46:12.813

我总是将我的项目异常的基类放在根目录中。

# dll - 监视对 DLL 的应用程序调用

> ID：311268
> 
> 赞同：44
> 
> 时间：2008-11-22T12:13:37.610
> 
> 标签：dll, monitoring, hook, monitor

简而言之：我想监视从应用程序到 DLL 的选定调用。

我们有一个旧的 VB6 应用程序，我们丢失了它的源代码（当时公司没有使用源代码控制......）。此应用程序使用第 3 方 DLL。

我想在一个新的 C++ 应用程序中使用这个 DLL。不幸的是，DLL API 只是部分记录，所以我不知道如何调用一些函数。我确实有函数签名。

由于 VB6 应用程序使用了这个 DLL，我想看看它是如何调用几个函数的。到目前为止，我已经尝试或看过 -

1.  [APIHijack](http://www.codeproject.com/KB/DLL/apihijack.aspx) - 要求我为每个函数编写 C++ 代码。由于我只需要记录这些值，这似乎是一种矫枉过正。
2.  [EasyHook](http://www.codeplex.com/easyhook) - 与 1 相同，但允许使用 .NET 语言编写代码。
3.  [OllyDbg](http://www.ollydbg.de/)和[uHooker](http://oss.coresecurity.com/uhooker/doc/index.html) - 我仍然需要为每个函数编写代码，这次是在 Python 中。此外，我必须使用该`struct`模块在 Python 中进行许多转换，因为大多数函数使用指针传递值。

因为我只需要记录函数参数，我想要一个简单的解决方案。是否有任何自动化工具，我可以告诉我要监控哪些功能及其签名，然后获取详细的日志文件？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-22T12:18:55.617

一个“静态”解决方案（在某种意义上它可以按需捕获堆栈跟踪）将是[**Process Monitor**](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)。

![进程监视器](https://i.stack.imgur.com/PwXMa.gif)

更动态的解决方案是[ApiMonitor](http://www.rohitab.com/apimonitor/)，但它可能太旧而无法与要监视的应用程序兼容。不过值得一试。

[![http://www.rohitab.com/gallery/api-monitor-2-0/main-window.png](https://i.stack.imgur.com/dxuil.png)](https://i.stack.imgur.com/dxuil.png)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-22T13:39:54.753

更多谷歌搜索找到了我正在寻找的内容：[WinAPIOverride32](http://jacquelin.potier.free.fr/winapioverride32/)。它允许编写文本文件，例如：

```
CustomApi.dll|void NameOfFunction(long param1, double& param2); 
```

稍后，可以在程序内部使用这些文件来记录所有对`NameOfFunction`. 现在我只需要弄清楚如何记录数组和结构参数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-04-27T11:06:43.710

[此处的](https://marketplace.visualstudio.com/items?itemName=SergeyVlasov.RuntimeFlow-realtimeNETfunctioncallsandparametersm)Visual Studio 插件**运行时流程** ：

> Runtime Flow 实时监控和记录正在运行的 .NET 应用程序中的函数调用和函数参数，并显示堆栈跟踪树。监控不需要仪器或源代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-01-14T08:44:00.977

如果您只想查看 DLL 的功能接口，可以尝试“Dependecies”（[https://lucasg.github.io/Dependencies/](https://lucasg.github.io/Dependencies/)）。这是作为开源的 DependencyWalker 的一个很好的翻版。

这仅允许您查看 DLL 的依赖关系，以及相应的函数名称（但是，不是调用结构）。不幸的是，我不相信它会告诉您调用 DLL/EXE 正在使用 DLL 中的哪些特定函数。

# c# - 泛型和接口枚举

> ID：311274
> 
> 赞同：1
> 
> 时间：2008-11-22T12:20:42.743
> 
> 标签：c#, .net, generics, interface, ienumerable

如果有一组类都实现了一个接口。

```
interface IMyinterface<T>
{
    int foo(T Bar);
} 
```

我想把它们全部塞进一个列表中并列举它们。

```
 List<IMyinterface> list
 foreach(IMyinterface in list)
 // etc... 
```

但编译器想知道 T 是什么。我可以这样做吗？我该如何克服这个问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-22T12:30:57.667

没有 IMyinterface 类型，只有 IMyinterface`1 类型需要类型参数。您可以创建一个 IMyinterface 类型：-

```
interface IMyinterface { ... } 
```

然后继承它

```
interface IMyinterface<T> : IMyinterface { ... } 
```

您需要将要在 foreach 循环中使用的任何成员移动到 IMyinterface 定义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T12:32:50.660

如果您计划调用签名中带有 T 的方法，答案是您不能。否则，您可以按照 anthonywjones 的建议进行操作

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T13:13:58.173

您仍然需要在某个时候告诉编译器 T 是什么，但是您可以按照您的要求完成：

```
 interface IMyinterface
{
    int foo<T>(T Bar);
}

List<IMyinterface> list = new List<IMyinterface>();
foreach(IMyinterface a in list){} 
```

# java - 使用 [^a-zA-Z] 正则表达式替换单词时出现问题

> ID：311276
> 
> 赞同：2
> 
> 时间：2008-11-22T12:21:13.913
> 
> 标签：java, regex, replace

只是无法得到这个，谷歌搜索也没有多大帮助..

首先我知道：给定一个字符串和一个正则表达式，如何用替换字符串替换所有匹配这个正则表达式的字符串？使用 String 类中的[replaceAll()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#replaceAll(java.lang.String,%20java.lang.String))方法。

现在我无法做到的事情。我现在在我的代码中使用的正则表达式是 [^a-zA-Z] 我确信这个正则表达式肯定会有一个范围。只有更多的字符可能会添加到列表中。我*需要*在下面的代码中作为输出的是**Worksheet+blah**但我使用 replaceAll() 得到的是**Worksheet++++blah**

> ```
> String homeworkTitle = "Worksheet%#5_blah";
> String unwantedCharactersRegex = "[^a-zA-Z]";
> String replacementString = "+";
> homeworkTitle = homeworkTitle.replaceAll(unwantedCharactersRegex,replacementString);
> System.out.println(homeworkTitle); 
> ```

实现我想要的输出的方法是什么？我在这里缺少任何 Java 方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T12:30:12.707

```
[^a-zA-Z]+ 
```

会做得很好。

您只需要一个[贪婪的量词](http://www.regular-expressions.info/repeat.html)即可匹配尽可能多的非字母字符，并将所有匹配替换为一个“+”（a - 默认情况下 - 贪婪量词）

注意：`[^a-zA-Z]+?`会使 '+' 量词变得懒惰，并且会给你与 相同的结果`[^a-zA-Z]`，因为它一次只匹配一个非字母字符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T12:31:52.673

```
String unwantedCharactersRegex = "[^a-zA-Z]" 
```

这匹配单个非字母。因此，每个非字母都被替换为 +。你需要说“一个或多个”，所以试试

```
String unwantedCharactersRegex = "[^a-zA-Z]+" 
```

# c++ - 用于在稀疏域中设置位和迭代（C++）的快速容器？

> ID：311297
> 
> 赞同：5
> 
> 时间：2008-11-22T12:39:42.703
> 
> 标签：c++, containers

我需要一个只有两个操作的快速容器。从一个非常稀疏的域（所有 32 位整数，并且在给定时间设置大约 100 个）插入键，并迭代插入的键。它应该处理*许多*命中相同条目的插入（例如，500k，但只有 100 个不同的条目）。

目前，我正在使用 std::set （仅插入和迭代接口），这很不错，但仍然不够快。std::unordered_set 慢了一倍，与 Google Hash Maps 相同。我想知道针对这种情况优化了哪些数据结构？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T18:22:07.663

根据输入的分布，您可能能够在不改变结构的情况下获得一些改进。

如果您倾向于获得大量单个值的运行，那么您可以通过记录您插入的最后一个值来加速插入，并且如果匹配则不要打扰插入。每个输入都需要进行额外的比较，但在第一个之后的运行中节省了对每个元素的查找。因此，无论您使用什么数据结构，它都可以改善事情，这取决于重复的频率以及比较与插入的相对成本。

如果您没有运行，但您往往会发现值分布不均，那么展开树可以降低访问最常用元素的成本。它通过使用靠近顶部的频繁元素创建一个故意不平衡的树来工作，就像霍夫曼代码一样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T14:51:37.773

我不确定我是否理解“许多插入相同条目的内容”。你的意思是只有 100 个值是成员，但是 500k 大部分重复操作插入了这 100 个值之一？

如果是这样，那么我猜最快的容器是在这 100 个值上生成一个无冲突的哈希，然后根据你的架构上最快的结果来维护一个标志数组（或向量）（int 或 bit） ）。

我将生成散列作为一个练习留给读者，因为我知道它是作为一种技术存在的，但我自己从未研究过它。关键是要在尽可能小的范围内获得快速散列，这样对于 100 个值中的每个 n、m，hash(n) != hash(m)。

所以插入看起来像`array[hash(value)] = 1;`，删除看起来像`array[hash(value)] = 0;`（虽然你不需要那个），并且枚举你在数组上运行，并且对于索引 n 处的每个设置值， inverse_hash(n) 在你的集合中。对于一个小范围，您可以轻松地维护一个查找表来执行反向哈希，或者您可以运行超过 100 个潜在的值，依次检查每个值，而不是扫描整个数组以查找设置标志。

对不起，如果我误解了这种情况，这对你没用。老实说，它并没有比普通的哈希表快多少，因为实际上对于 100 个值，您可以轻松地调整表的大小，从而很少或没有冲突，而不会使用太多内存来破坏缓存。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T12:58:40.060

对于预期如此小的在用集，非分桶哈希表可能没问题。如果您可以忍受偶尔的扩展操作，那么如果它的容量超过 70%，则以 2 的幂进行增长。 [Cuckoo hashing](http://en.wikipedia.org/wiki/Cuckoo_hashing)之前已经[在 Stackoverflow 上讨论过，](https://stackoverflow.com/questions/231438/cuckoo-hashing-in-c)对于这么小的集合也可能是一个好方法。如果您真的需要优化速度，您可以在汇编器中实现散列函数和查找 - 在线性数据结构上这将非常简单，因此汇编器实现的编码和维护工作不应该过于难以维护。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-22T14:08:02.433

您可能需要考虑在每个级别使用以 10 为底的哈希函数而不是二进制哈希函数来实现[HashTree 。](http://en.wikipedia.org/wiki/Hash_tree)您可以将其设为非分桶，在这种情况下您的性能将是确定性的（log10），或者根据您的预期分布调整您的存储桶大小，以便您只有几个键/存储桶。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-22T17:51:30.377

随机数据结构可能非常适合您的工作。看一下[跳过列表](http://en.wikipedia.org/wiki/Skip_list)——尽管我不知道它的任何 C++ 实现。我打算向 Boost 提交一个，但一直没有时间去做。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-22T12:54:54.967

可能是一个以[b 树](http://en.wikipedia.org/wiki/B-tree)（而不是二叉树）作为内部数据结构的集合。我在实现这一点的 codeproject 上找到[了这篇](http://www.codeproject.com/KB/cpp/stree.aspx)文章。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-22T17:47:59.180

请注意，虽然插入哈希表很快，但迭代它并不是特别快，因为您需要迭代整个数组。

哪个操作对你来说很慢？你做更多的插入还是更多的迭代？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-22T17:55:08.450

你有多少内存？32 位“仅”占用 4GB/8 字节，即 512MB，对于高端服务器来说并不多。这将使您的插入 O(1)。但这可能会使迭代变慢。尽管跳过所有只有零的单词会优化大多数迭代。如果您的 100 个数字在相对较小的范围内，您可以通过保持最小值和最大值来进一步优化。

我知道这只是蛮力，但有时蛮力就足够了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-22T20:44:17.780

由于没有人明确提到它，您是否考虑过内存局部性？具有导致页面错误的插入算法的真正出色的数据结构对您没有好处。实际上，带有仅导致缓存未命中的插入的数据结构可能对性能非常不利。

当插入碰撞太慢时，您是否确保将一组天真的无序元素打包在一个固定数组中，并通过简单的交换到前面？这是一个简单的实验，可能表明您存在内存局部性问题而不是算法问题。

# c# - 将 asp.net 表单中的多个字段提取到准备处理的 C# 列表或数组中的最佳方法是什么？

> ID：311299
> 
> 赞同：0
> 
> 时间：2008-11-22T12:43:28.140
> 
> 标签：c#, asp.net

我需要从 asp.net 表单中提取多个文本/下拉列表字段并适当地准备好通过电子邮件发送给收件人的格式。

阅读这些字段的最佳方法是什么，而不必对每个项目进行硬编码，例如：

```
item1 = InputField1.Text; 
item2 = InputField2.Text; 
```

我将在同一个输入表单上包含大约 10 或 20 个项目。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T13:00:55.673

@Chris 给了你基本的想法——从 Request.Form 集合中复制出来。我建议为使其更容易，您可以提供可以从页面上的其他字段中轻松检测到的输入名称，其中一些可能由框架为您放置在那里。也许使用像“Email.FirstName”、“Email.LastName”、“Email.Address”这样的命名方案，那么你可以这样做：

```
 foreach (string key in Request.Form.Keys)
   {
        if (key.StartsWith("Email."))
        {
           ...Process this key...
        }
   } 
```

注意：如果页面使用 MasterPage，您的检查将需要考虑框架对名称的修改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T12:53:56.593

不知道你为什么要这样做 - 如果没有更多信息，你似乎正在采取一种次优的方法，但我离题了。表单字段值也可以通过 Request.Form 集合访问，如果我记得，这是一个 NameValueCollection。您可以像这样访问它：

```
foreach (string key in Request.Form.Keys) {
    string value = Request.Form[key];
    // format and use value here
} 
```

如果您需要根据字段和数据类型格式化特定字段，您可以像这样复制到字典：

```
Dictionary<string, object> values = new Dictionary<string, object>();

foreach (string key in Request.Form.Keys) {
    if (key.Equals("SpecialFieldName")) {
        // for example, parse an int
        values.Add(key, int.parse(Request.Form[key]));
    } else {
        // no special formatting required
        values.Add(key, Request.Form[key]);
    }
} 
```

# python - 多表子类模型的管理通用内联损坏 --- 任何替代方案？

> ID：311300
> 
> 赞同：2
> 
> 时间：2008-11-22T12:43:53.850
> 
> 标签：python, django, django-models, django-admin

这就是我正在尝试做的事情，但失败了......

我有一个与其他对象具有通用关系的文件模型：

```
class File(models.Model):
    content_type = models.ForeignKey(ContentType)
    object_id = models.PositiveIntegerField()
    content_object = generic.GenericForeignKey()
    file = models.FileField(upload_to='files/%Y/%m/%d')
    # etc.... 
```

我还希望有一个 File 的子类来处理要在页面中显示而不是下载的图像的特定情况：

```
class Image(File):
    file = models.ImageField(upload_to='files/%Y/%m/%d') 
```

以上所有内容都可以正常工作，包括 File 模型的通用内联，直到我想使用 Image 模型的通用内联 --- 保存过程无法创建基类实例，因此引发错误，指出 Image .file_ptr（基类的“秘密”外键）不能为无。

因此，基本上，通用内联目前不能正确支持多表继承。

很可能我让这变得比它需要的更复杂，所以任何人都可以建议解决这个问题，或者更好的方法来达到同样的目的吗？

如果您需要进一步说明，请告诉我。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-22T13:30:28.187

继承可以在关系模型中以两种方式实现。

子类可以是一个新表，其中包含与超类重复的所有相同列。当您有一个覆盖超类的抽象超类或子类功能时，这很有效。

子类可以只是连接到超类表的唯一列。当你有一个具体的超类时，这很有效。

在你的情况下，看起来你可能有以下情况。

```
class FileFacts( models.Model ):
    content_type = models.ForeignKey(ContentType)
    object_id = models.PositiveIntegerField()
    content_object = generic.GenericForeignKey()

class DownloadFile( models.Model ):
    facts = models.ForeignKey( FileFacts )
    file = models.FileField(upload_to='files/%Y/%m/%d')

class InlineImage( models.Model ):
    facts = models.ForeignKey( FileFacts )
    file = models.ImageField(upload_to='files/%Y/%m/%d') 
```

这是我对处理子类模型的偏好。

# javascript - Firefox 和 Safari 的 history.go(-1) 替代方案

> ID：311307
> 
> 赞同：2
> 
> 时间：2008-11-22T12:50:08.143
> 
> 标签：javascript

对于 FireFox 和 Safari，history.go(-1) 是否有替代方案。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T12:53:27.233

您可以使用`history.back()`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T12:58:30.607

```
<a href="javascript:history.go(-1)">Link</a> 
```

不过应该可以。

因为，事实上，以下内容在 Firefox 中不起作用：

```
<a href="#" onclick="Javascript:goback();">some Text</a>

function goback() {
   history.go(-1);
} 
```

那是你在做什么？

# .net - 单独程序集中子类时的NHibernate继承映射

> ID：311318
> 
> 赞同：2
> 
> 时间：2008-11-22T12:58:14.977
> 
> 标签：.net, nhibernate-mapping, subclass

假设核心项目有一个基础实体，每个插件都可能扩展基础实体。

解决方案结构：

```
Application.Core.BaseClass
Application.Module.SubClass (it's a plug in, maybe not available) 
```

有什么方法可以使用 NHibernate 子类来实现这个映射？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-22T17:47:29.760

您可以像这样添加映射：

```
<?xml version="1.0" encoding="utf-16"?>
<hibernate-mapping xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"" xmlns=""urn:nhibernate-mapping-2.2">
    <subclass name="SubClass" extends="BaseClass" discriminator-value="SubClass"/>
</hibernate-mapping> 
```

进而

```
cfg.AddXml(xml); 
```

您可以查看具有类似目标的[项目中的代码。](http://code.google.com/p/n2cms/source/browse/trunk/src/N2/Persistence/NH/ConfigurationBuilder.cs)

还有直接调用类模型的选项。

# optimization - 在尾调用优化 (TCO) 之后测量性能

> ID：311332
> 
> 赞同：0
> 
> 时间：2008-11-22T13:13:45.333
> 
> 标签：optimization

我知道它是什么。我的问题是：-

1.）如果我编写适合尾调用优化的代码（函数[递归函数]中的最后一条语句仅是函数调用，没有其他操作）那么我是否需要设置任何优化级别以便编译器执行 TCO . 编译器将以何种优化模式执行 TCO、空间或时间优化器。

2.) 我如何找出所有编译器（MSVC、gcc、ARM-RVCT）都支持 TCO

3.) 假设某个编译器有 TCO，那么我们启用它，有什么方法可以发现编译器实际上已经完成了 TCO？代码大小，告诉它或执行它的周期会告诉它还是两者兼而有之？

-广告

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T13:29:03.073

大多数编译器都支持 TCO，这是一种相对古老的技术。至于如何使用特定的编译器启用它，请查看编译器的文档。gcc 将在除 -O1 之外的每个优化级别启用优化，我认为具体的选项是`-foptimize-sibling-calls`. 至于如何判断编译器如何/是否在执行 TCO，请查看汇编器输出（`gcc -S`例如）或反汇编目标代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T13:29:41.607

1.  优化是编译器特定的。请查阅文档以了解它们的各种优化标志
2.  您也可以在编译器文档中找到它。如果你很好奇，你可以编写一个尾递归函数并传递一个大参数，然后寻找堆栈溢出。（如果您了解生成的代码，检查生成的汇编程序可能是更好的选择。）
3.  您只需使用调试器，并查看函数参数/局部变量的地址。如果它们在调试器显示的每个逻辑帧上增加/减少（或者如果它实际上只显示一帧，即使您进行了多次调用），您就会知道 TCO 是否已完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T13:28:32.513

如果您希望编译器进行尾调用优化，只需检查

a）编译器的文档将在哪个优化级别执行或

b）检查asm，如果函数会调用自己（你甚至不需要很大的asm知识来再次发现函数的符号）

如果你真的想要尾递归，我的问题是：

你为什么不自己执行尾调用删除？它只意味着删除递归，如果它是可移动的，那么它不仅可以由编译器在低级别而且在算法级别由你来实现，你可以将它直接编程到你的代码中（这意味着没有别的意思了循环而不是给自己打电话）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T22:50:07.557

确定是否发生尾调用的一种方法是查看是否可以强制堆栈溢出。以下程序在使用 VC++ 2005 Express Edition 时不会产生堆栈溢出，即使它的结果很快超过了 long double 的容量，您也可以看出在 TCO 发生时正在处理所有迭代：

```
 /* FibTail.c 0.00               UTF-8                    dh:2008-11-23
    * --|----1----|----2----|----3----|----4----|----5----|----6----|----*
    *
    * Demonstrate Fibonacci computation by tail call to see whether it is 
    * is eliminated through compiler optimization.
    */

    #include <stdio.h>

    long double fibcycle(long double f0, long double f1, unsigned i)
    {  /* accumulate successive fib(n-i) values by tail calls */

       if (i == 0) return f1;
       return fibcycle(f1, f0+f1, --i);
       }

    long double fib(unsigned n)
    {  /* the basic fib(n) setup and return. */
       return fibcycle(1.0, 0.0, n);
       }

    int main(int argc, char* argv[ ])
    {  /* compute some fibs until something breaks */

       int i;

       printf("\n           i                         fib(i)\n\n");

       for (i = 1; i > 0; i+=i)
       {  /* Do for powers of 2 until i flips negative 
             or stack overflow, whichever comes first */
          printf("%12d %30.20LG \n", i, fib((unsigned) i) );
          }

      printf("\n\n");
      return 0;
      } 
```

但是请注意，在 fibcycle 中进行纯尾调用的简化等同于找出根本不进行尾调用的交互式版本（并且在编译器中使用或不使用 TCO 都可以。

进行试验可能会很有趣，以了解 TCO 能在多大程度上找到尚未接近最优且容易被迭代替换的优化。

# vb.net - 使用 Sub Main 或表单启动对象启动 VB.NET GUI 应用程序？

> ID：311346
> 
> 赞同：14
> 
> 时间：2008-11-22T13:36:10.780
> 
> 标签：vb.net, winforms

是否有任何理由在模块的 Sub Main 中而不是直接在表单中启动用 VB.NET 编写的 GUI 程序（Windows 应用程序）？

编辑：该程序不会采用任何命令行参数，它将始终作为 GUI 程序执行。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-22T15:03:02.820

在 VB .NET 1.x 中使用 Main() 的主要原因是添加在加载任何表单之前需要运行的代码。例如，您可能想要检测您的 Windows 窗体应用程序的实例是否已加载。或者您可能想要拦截 AppDomain 的任何未处理的异常：

```
AddHandler AppDomain.CurrentDomain.UnhandledException, AddressOf MyExceptionFilter 
```

但是下一版本的 VB 和 Visual Studio 2005 引入了一个新的[应用程序模型](https://docs.microsoft.com/en-us/dotnet/visual-basic/developing-apps/development-with-my/overview-of-the-visual-basic-application-model)，这使得 Main() 在大多数情况下都是不必要的。您现在可以拦截[My.Application.Startup 事件](https://docs.microsoft.com/en-us/dotnet/api/system.windows.application.startup)以添加需要在加载任何表单之前运行的代码。

请注意，**启动**事件处理程序的代码存储在 ApplicationEvents.vb 文件中，默认情况下该文件是隐藏的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-22T15:21:49.820

您可以采用任何一种方式，但您实际上应该只将代码保留在与该表单上的操作和用户界面元素直接相关的*表单*中。应用程序启动代码与 UI 无关，通常与启动屏幕、检查网络连接、仅验证单个实例、设置用户配置设置等有关。

完成上述项目（或您的应用程序的适当初始化代码）后，Sub Main 可以创建主窗体的实例，然后显示它以便用户可以开始与您的应用程序交互。

这会将启动代码与表单代码分开。稍后，当您维护应用程序时，您会很高兴将两者分开。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T13:40:46.823

是的，我已经做过几次了。

一个原因是，如果您的应用程序是 COM EXE（现在从 VB6 的角度讲），那么您希望能够检测在什么上下文中调用了 EXE（正在启动或与其他应用程序对话）。

例如：

```
Sub Main()
    If App.StartMode = vbSModeAutomation Then
        ...
    Else
        ...
    End If
End Sub 
```

另一个是如果您希望您的应用程序能够处理任何命令行参数。

例如：

```
Sub Main()
    If App.PrevInstance Then End
    If InStr(Command, "/s") > 0 Then
        Form1.Show
    ElseIf InStr(Command, "/p") > 0 Then
        LoadPicture ("c:\windows\Zapotec.bmp")
    End If
End Sub 
```

（来自我制作屏幕保护程序的尝试之一）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T13:40:39.260

不，如果您总是想显示该表格。
是的，如果您有时想在没有 GUI 的情况下使用您的应用程序，只需使用命令行即​​可。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-08-24T07:05:37.110

是的，如果我想根据某些参数（在文件中、在远程服务器上等）显示不同的表单。

# web-applications - 常用快捷键有哪些？

> ID：311358
> 
> 赞同：2
> 
> 时间：2008-11-22T13:50:12.330
> 
> 标签：web-applications, keyboard-shortcuts

要发送消息，我通常按`ctrl`+ `enter`。您认为在您的 Web 应用程序中实现哪些其他快捷方式很重要？

编辑：您认为哪些按钮很有趣，因为它们不被浏览器使用？

我没想到`ctrl`+ `z`fe 因为浏览器使用那些可能`shift`+`[key]`是有道理的。

还是`space`+`[key]`有趣？

顺便说一句，`ctrl`+ `enter`在这里不起作用:(

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-22T14:18:17.793

Web 应用程序中的快捷方式对于您的高级用户来说是一个好主意，但它们的一致性不如桌面应用程序快捷方式。对于桌面应用程序，ctrl 键标准基本上是通用的：

*   z（撤销）
*   y（重做）
*   s（保存）
*   一个（全选）
*   x (切)
*   c（副本）
*   v（粘贴）
*   p（打印）
*   o（打开）
*   n（新项目）

`Ctrl`-`q`退出和`ctrl`-`w`关闭窗口也几乎是通用的；对于邮件客户端，`ctrl`-`r`和`ctrl`-`f`对于回复和转发非常通用，并且`ctrl`-`enter`是发送；对于浏览器，`ctrl`-`r`普遍重新加载。还有一些非常常见的 F 键 -`F1` 用于帮助、`F2`重命名和`F5`刷新。

然而，对于 webapps，有一些问题。一个是您所在的浏览器外壳有自己的`ctrl`快捷方式，并且焦点并不总是您所期望的，因此使用浏览器期望的 ctrl-key（如`ctrl`- `r`）可能会也可能不会通过键盘命令到 webapp 的 javascript（例如，取决于您在使用 Microsoft Outlook Web Access 时的焦点位置，`ctrl`-`r`将回复您正在查看的消息，或重新加载整个页面）。这就是为什么许多 web 应用程序使用单键快捷方式（当然，当您输入文本时这些快捷方式不可用）。

该领域的最佳实践（在我看来）似乎来自 Google，他们在 gmail 和 reader 中的快捷方式既直观又全面。如果您想要一个事实上的 Web 应用程序快捷键标准，那么这可能是一个不错的起点。您可以按 调出阅读器中的[快捷键列表](http://www.google.com/support/reader/bin/answer.py?answer=69973&src=top5&lev=index)`?`。你可以做的比镜像其中一些（尤其`j`是下一个项目和`k`上一个项目）更糟糕，因为它们已经开始广为人知了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T14:14:38.193

请参阅 Jon Galloway 的博[文 Mouseless Computing](http://weblogs.asp.net/jgalloway/archive/2006/06/14/Mouseless-Computing.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T14:00:40.793

撤消和重做 ( `ctrl`-`Z`如果适用和`ctrl`- ）。`Y`

请注意，这假设了一个编辑上下文。所以这真的取决于上下文是什么，什么捷径是合适的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T15:41:51.183

大量使用 accesskey HTML 属性。尽量不要覆盖浏览器键绑定的默认行为。

# .net - .NET xml 文档 - 继承文档

> ID：311363
> 
> 赞同：37
> 
> 时间：2008-11-22T13:53:14.070
> 
> 标签：.net, documentation, ndoc

NDoc 有一个 XML 元素**inheritdoc**，它允许您从父类（或实现的接口）继承成员的文档。然而，Visual Studio（即 C# 编译器）不理解这个标签并抱怨文档不存在或不完整。StyleCop 和其他一些工具也是如此。有替代方法吗？您如何在不重复 XML 描述的情况下保持文档的完整性？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-07-03T18:33:10.403

*我有一个更好的答案：**FiXml**。*

使用 GhostDoc 克隆评论当然是可行的方法，但它有很大的缺点，例如：

*   当原始注释被更改时（在开发过程中经常发生），它的克隆不会。
*   你正在产生大量的重复。如果您使用任何源代码分析工具（例如 Team City 中的 Duplicate Finder），它将主要找到您的评论。

FiXml 的简短描述：它是由 C#\Visual Basic .Net 生成的 XML 文档的后处理器。它是作为 MSBuild 任务实现的，因此很容易将其集成到任何项目中。它解决了一些与用这些语言编写 XML 文档相关的烦人案例：

*   **不支持从基类或接口继承文档。**即任何被覆盖的成员的文档都应该从头开始编写，尽管通常至少继承它的一部分是非常可取的。
*   **不支持插入常用的文档模板**，例如“这种类型是单例的 - 使用它的`<see cref="Instance" />`属性来获取它的唯一实例。”，甚至“初始化一个新的`<CurrentType>`类实例”。</li>

为了解决上述问题，提供了以下附加 XML 标记：

*   `<inheritdoc />, <inherited />`标签
*   `<see cref="..." copy="..." />``<see/>`标签中的属性。

这是[它的网页](http://wiki.dataobjects.net/index.php?title=FiXml)和[下载页面](http://www.x-tensive.com/Downloads/?Path=Freeware%5CXtensive.MSBuildTasks)（断开的链接）。

*[最后， Sandcastle](https://github.com/EWSoftware/SHFB)中有`<inheritdoc>`标签*——使用它肯定比复制 XML 注释要好，但与 FiXml 相比它几乎没有缺点：

*   Sandcastle 生成已编译的 HTML 帮助文件 - 它不会修改`.xml`包含提取的 XML 注释的文件。但这些文件被许多工具使用，包括 .NET Reflector 和 Visual Studio .NET 中的类浏览器\IntelliSense。因此，如果您只使用 Sandcastle，您将看不到继承的文档。
*   Sandcastle 的实现没有那么强大。例如，不是 `<see ... copy="true" />`。

有关详细信息，请参阅[Sandcastle 的`<inheritdoc>`描述](http://www.ewoodruff.us/shfbdocs/html/79897974-ffc9-4b84-91a5-e50c66a0221d.htm)。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-22T20:08:36.497

一种替代方法是使用[GhostDoc](http://www.roland-weigelt.de/ghostdoc/) - Visual Studio 的一个插件，它会自动为您生成评论。这当然复制了 XML 描述，这是您试图避免的一部分 - 但至少它会自动为您完成。

如果您只为被继承的方法或覆盖接口方法而完全放弃文档会发生什么？我怀疑这取决于您如何配置 NDoc，但肯定在 MSDN 文档中似乎只是自然地继承了文档 - 并且快速检查*表明*，当您不为继承的方法提供文档时，VS 不会抱怨。值得一试，当然。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-12-20T23:50:03.017

我构建了一个命令行工具来对 XML 文档文件进行后处理，以添加对 <inheritdoc/> 标记的支持。

它对源代码中的 Intellisense 没有帮助，但它确实允许将修改后的 XML 文档文件包含在 NuGet 包中，因此可以在引用的 NuGet 包中与 Intellisense 一起使用。

有关详细信息，请参见[www.inheritdoc.io](https://www.inheritdoc.io/)（提供免费版本）。

# http - 为什么我不能在对称通道上获得相等的上传和下载速度？

> ID：311365
> 
> 赞同：4
> 
> 时间：2008-11-22T13:58:19.737
> 
> 标签：http, sockets, ftp, networking, tcp

我被分配到一个项目，我的代码应该在同一 FTP 或 HTTP 服务器上同时执行一些文件的上传和下载。对速度进行了测量，并由此得出了一些结论。

现在，问题在于，在高速连接上，我们在吞吐量方面获得了几乎预期的结果，但在慢速连接（想想*理想*的 CDMA 1xRTT 链接）上，无论下载还是上传都会以相反的方向为代价获胜。我有一个“更高的身体”，他确信 CDMA 1xRTT 连接是对称的，因此我们应该能够在此链路上以相同的速度（每个方向约 100 kbps）执行数据传输。

我的测量结果表明，如果不对缓冲区大小和数据链路节流方面的代码进行大量调整，就不可能在上述条件下具有相同的速度。我尝试了我的多线程代码，还创建了一个简单的批处理文件，它可以自动执行 Windows 的 ftp.exe 以执行数据传输——结果相同。

所以，问题是：真的有可能在一条慢速对称链路上以同等速度执行数据传输吗？“更高的身体”是否符合他们的期望？如果是，您对我应该如何处理我的代码以实现这样的吞吐量有什么建议吗？

PS。我完全重写了这个问题，所以很明显它属于这个网站。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T17:05:43.027

CDMA 1x 包含多达 15 个 9.6kbps 流量的信道。这导致总吞吐量为 144kbps。

两个通道用于命令和控制信号（与基站通话、关联/解除关联、SMS 流量、振铃信号等）。

这样一来，您就可以获得高达 124.8kbps 的速度。

--> 每个通道都是一种方式。<--

它们根据需要动态切换和分配。

通常，您将获得比上传更多的下载，因为这是典型的手机调制解调器使用。但是你永远不会得到超过 120kbps 的总总带宽。

在实践中，由于 1xRTT 编码、纠错、重新发送等开销，即使您拥有所有可能的通道，您通常也会体验到 60kbps 到 90kbps 之间的速度。

这意味着您可能只能同时获得 30kbps-60kbps 的上传和下载。

此外，由于动态切换频道（以及基站比调制解调器控制更多这一事实 - 他们需要仔细管理基站频道以保持频道免费进行语音通话），您在切换频道时会浪费时间 - 这是不是一个瞬间的过程。

所以 - 理论上，1xRTT 可以为您提供 124kbps 的一种方式，但由于开销、切换时间、基站容量或电话公司出于其他原因简单地限制此类连接，您不能依赖对称链路。

笔记：

这将在一定程度上根据提供商和调制解调器而有所不同。例如，有些调制解调器有 16 个通道，有些供应商支持 16 个通道。在某些情况下，这些调制解调器和提供商可以很好地协同工作，可以为应用程序提供完整的 144kbps 聚合原始带宽，只有一个专用通道（必须非常努力地工作）来处理控制、切换和其他问题。尽管如此，尽管如此，随着调制解调器通信的开销，然后是 PPP 的开销，然后是 IP 的开销，然后是 TCP 的开销，你仍然看到可能 100-120kbps 的总带宽，无论是上行还是下行。

最后，还没有提供商支持 IP 流量的透明传输。换句话说，如果您的调制解调器正在移动，调制解调器将切换到一个新的基站，但您将完全放弃 PPP 会话并必须重新启动它，以及所有 TCP 会话等。您通常不会获得相同的 IP 地址，因此您的 TCP 会话将无法正常恢复。

这种转折的“有趣”方面是即使你不移动也可能发生这种情况。如果一个基站负载下降，如果您离得足够近，您可能会被转移到另一个基站 - 即使您不移动，还有其他一些事情可能会使您的调制解调器转移。因此，请务必考虑到这一点，因为您似乎热衷于保持全双工、对称通道的开放。很难写出能够优雅地恢复的东西，没关系预测它并快速完成。您最好与调制解调器制造商（如京瓷）密切合作，否则您将无法获得有关如何在所需的低级别控制调制解调器芯片组的文档。

-亚当

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T17:42:35.277

我认为在两个方向上都具有高速等速的整个戏剧是因为我的较高的身体认为他们在上行链路上有 144 kbps 并且在下行链路上有 144 kbps（== 两个管道）。而实际上我们有 144 kbps 的 ONE 管道，当我传输文件时它正在切换方向。

如果我对或错，请评论我。

# html - 密码自动完成不适用于我的 web 应用程序（在 Firefox 中）

> ID：311389
> 
> 赞同：4
> 
> 时间：2008-11-22T14:40:09.327
> 
> 标签：html, autocomplete, passwords

我在 HTML 中创建了一个登录提交表单，但由于某种原因，自动完成功能在 Firefox 中不起作用。

这就是在 Firefox 中发生的事情： - 我提供用户名和密码，然后单击登录按钮 - Firefox 会提示我是否要记住密码。我按“记住”并登录工作。- 我退出并返回登录页面。我希望预先填写用户名和密码字段，但事实并非如此。请注意，我不（想）使用 cookie。

这是此页面的代码：

```
<form name="login_form" id="login_form" autocomplete="ON" onsubmit="javascript:xajax_action_login(document.getElementById('user_name').value, document.getElementById('password').value); return false;">
    <div class="login_line">
        <div class="login_line_left">name</div>
        <div id="user_name_id" class="login_line_right"><input size="16" maxlength="16" name="user_name" id="user_name" type="text"></div>
    </div> <!-- login_line -->
    <div class="login_line">
        <div class="login_line_left">password</div>
        <div id="password_id" class="login_line_right"><input size="16" maxlength="16" name="password" id="password" type="password"></div>
    </div> <!-- login_line -->
    <div class="login_line">
        <div class="login_line_left">&nbsp;</div>
        <div class="login_line_right"><input class="button" value="login" type="submit"></div>
    </div> <!-- login_line -->
</form> <!-- login_form --> 
```

我的代码有什么问题？如何使用我的代码自动完成以在 FF 中工作？

自动补全确实适用于例如 gmail。每次我访问 gmail 的登录页面时，电子邮件和密码字段都已正确预填。我不使用“在这台计算机上记住我”复选框，因此不使用 cookie。

**更新**我正在使用 php 和 FF3

谢谢，贾斯珀

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T17:14:14.147

您的登录 URL 是否包含每次都会更改的会话 ID？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T02:46:23.230

> 如果我想记住密码，Firefox 会提示我。我按“记住”并登录工作。- 我退出并返回登录页面。我希望预先填写用户名和密码字段

这不是 Firefox 的工作方式。您必须输入用户名，它会记住该*用户名*的密码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T18:00:45.910

您是否检查过您保存的密码列表，看看您是否已经告诉 Firefox**永远不要记住**您网站的凭据？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T16:50:53.273

我发现了为什么它不起作用。我使用 ajax 将示例 html 粘贴到容器 div 中。显然firefox对此非常敏感，因为（如前所述）我的代码确实可以在IE中运行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T00:22:47.867

我将您的 HTML 粘贴到一个空的 HTML 文档中，删除了`onsubmit=""`javascript 代码，输入了用户名和密码并点击提交，系统提示您保存密码，下次我点击重新加载时 - FF3 自动填充了这两个字段。

为我工作（tm）。

我想知道删除`onsubmit=""`代码是否对您有任何改变...？

此外，运行示例的链接也会有所帮助。

# mysql - MySQL A Search、A Select of multiple rows、Joining 和 all in one query

> ID：311390
> 
> 赞同：0
> 
> 时间：2008-11-22T14:41:53.473
> 
> 标签：mysql

我首先对表标签进行搜索，结果是所有行连同来自表链接的附加数据一起返回（我在其上进行连接）。表格标签的工作方式是，对于自动 _id 可以有多行（每行 1 个标签，因此多个标签是多行）。

我想要做的是，而不是仅仅获得与自动 _id 和查询匹配的多行。我想为在 1 行中找到的每个 auto_id 取回每个标签（某种形式的不同但将所有标签逗号分隔在 1 个字段中），因此 group_concat （这显然目前不起作用 - 我'已将其添加为伪）。

```
SELECT ta.auto_id, li.address, li.title, GROUP_CONCAT(SELECT tag FROM tags WHERE auto_id = ta.auto_id)
FROM `tags` AS ta
JOIN
links AS li
ON ta.auto_id = li.auto_id
GROUP BY ta.tag
WHERE ta.user_id = 1
AND (ta.tag LIKE '%query%') 
```

我希望我已经说明了我的情况。

非常感谢，

冰

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T14:56:13.817

如果我明白你在问什么，这样的事情应该可以解决问题：

```
SELECT ta.auto_id, li.address, li.title, GROUP_CONCAT(ta.tag) -- Get a comma separated list of all the tags
FROM tags AS ta
INNER JOIN links AS li ON ta.auto_id = li.auto_id
WHERE ta.user_id = 1
AND ta.tag LIKE '%query%'
GROUP BY li.id -- Group by links id, so you get one row for each link, which contians a list of tags 
```

# c# - 确定最大化按钮是否可用

> ID：311399
> 
> 赞同：2
> 
> 时间：2008-11-22T14:57:35.407
> 
> 标签：c#, winapi

有谁知道我在哪里可以找到如何确定窗口上的最大化和/或最小化按钮是否可用和/或禁用的示例？

该窗口将与我的应用程序不在同一进程中。我有 hWnd，我尝试过使用 GetMenuItemInfo，但我找不到任何好的示例来说明如何执行此操作。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T15:23:43.997

```
bool has_maximize_btn = (GetWindowLong(hWnd, GWL_STYLE) & WS_MAXIMIZEBOX) != 0;
bool has_minimize_btn = (GetWindowLong(hWnd, GWL_STYLE) & WS_MINIMIZEBOX) != 0; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-22T15:17:48.673

Win32 API 提供了[**GetTitleBarInfo**函数](http://msdn.microsoft.com/en-us/library/ms633513(VS.85).aspx)，它返回一个[**TITLEBARINFO**结构](http://msdn.microsoft.com/en-us/library/ms632608(VS.85).aspx)：

```
typedef struct {
    DWORD cbSize;
    RECT rcTitleBar;
    DWORD rgstate[CCHILDREN_TITLEBAR+1];
} TITLEBARINFO, *PTITLEBARINFO, *LPTITLEBARINFO; 
```

因此，您可以检查`rgstate`: 指向接收标题栏每个元素的 DWORD 值的数组的指针。以下是该数组表示的标题栏元素。

```
Index Title Bar Element
----- --------------------
0     The title bar itself
1     Reserved.
2     Minimize button
3     Maximize button    <--------------
4     Help button
5     Close button 
```

每个数组元素是以下一个或多个值的组合。

```
Value                    Meaning
-----                    -------------------------------------------
STATE_SYSTEM_FOCUSABLE   The element can accept the focus.
STATE_SYSTEM_INVISIBLE   The element is invisible.
STATE_SYSTEM_OFFSCREEN   The element has no visible representation.
STATE_SYSTEM_UNAVAILABLE The element is unavailable.  
STATE_SYSTEM_PRESSED     The element is in the pressed state.rgstate 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T15:17:12.810

使用[GetWindowInfo](http://msdn.microsoft.com/en-us/library/ms633516(VS.85).aspx)函数。

测试[WINDOWINFO](http://msdn.microsoft.com/en-us/library/ms632610(VS.85).aspx)结构的 dwStyle 字段并查看 WS_MAXIMIZEBOX 位是否打开。

```
WINDOWINFO.dwStyle & WS_MAXIMIZEBOX != 0 
```

# java - 关闭休眠日志控制台输出

> ID：311408
> 
> 赞同：89
> 
> 时间：2008-11-22T15:16:07.380
> 
> 标签：java, hibernate, logging

我正在使用休眠 3，并希望阻止它将所有启动消息转储到控制台。我尝试在 log4j.properties 中注释掉标准输出行，但没有运气。我在下面粘贴了我的日志文件。此外，我正在使用具有标准项目结构的 eclipse，并且在项目文件夹的根目录和 bin 文件夹中都有 log4j.properties 的副本。

```
### 将日志消息直接记录到标准输出###
#log4j.appender.stdout=org.apache.log4j.ConsoleAppender
#log4j.appender.stdout.Target=System.out
#log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
#log4j.appender.stdout.layout.ConversionPattern=%d{ABSOLUTE} %5p %c{1}:%L - %m%n

### 将消息直接发送到文件 hibernate.log ###
log4j.appender.file=org.apache.log4j.FileAppender
log4j.appender.file.File=hibernate.log
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=%d{ABSOLUTE} %5p %c{1}:%L - %m%n

### 设置日志级别 - 更详细的日志记录将“信息”更改为“调试”###

log4j.rootLogger=警告，标准输出

#log4j.logger.org.hibernate=信息
log4j.logger.org.hibernate=调试

### 记录 HQL 查询解析器活动
#log4j.logger.org.hibernate.hql.ast.AST=debug

### 只记录 SQL
#log4j.logger.org.hibernate.SQL=debug

### 记录 JDBC 绑定参数 ###
log4j.logger.org.hibernate.type=info
#log4j.logger.org.hibernate.type=debug

### 日志模式导出/更新###
log4j.logger.org.hibernate.tool.hbm2ddl=debug

### 记录 HQL 解析树
#log4j.logger.org.hibernate.hql=debug

### 日志缓存活动###
#log4j.logger.org.hibernate.cache=debug

### 记录事务活动
#log4j.logger.org.hibernate.transaction=debug

### 记录JDBC资源获取
#log4j.logger.org.hibernate.jdbc=debug

### 如果要跟踪连接，请启用以下行###
### 使用 DriverManagerConnectionProvider 时泄漏###
#log4j.logger.org.hibernate.connection.DriverManagerConnectionProvider=trac5
```

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2014-04-10T02:38:58.690

重要通知：属性（休眠配置的一部分，不是日志框架配置的一部分！）

```
hibernate.show_sql 
```

绕过任何日志框架（您可以通过缺少的消息输出格式识别）*直接*控制到 STDOUT 的日志记录。如果您使用 log4j 之类的日志框架，**则应*始终*将该属性设置为 false**，因为它根本没有给您带来任何好处。

这种情况激怒了我很长一段时间，因为在我尝试编写一些有关 Hibernate 的基准之前，我从来没有真正关心过它。

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2008-11-22T15:48:24.400

尝试设置更合理的日志记录级别。将日志记录级别设置为`info`意味着仅记录处于`info`或更高级别 (`warn`和`error`)`fatal`的日志事件，即`debug`忽略日志事件。

```
log4j.logger.org.hibernate=info 
```

或在log4j 配置文件的[XML 版本中：](http://wiki.apache.org/logging-log4j/Log4jXmlFormat)

```
<logger name="org.hibernate">
  <level value="info"/> 
</logger> 
```

另请参阅[log4j 手册](http://logging.apache.org/log4j/1.2/manual.html)。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2013-08-19T22:05:07.273

执行：

```
java.util.logging.Logger.getLogger("org.hibernate").setLevel(Level.OFF); 
```

在休眠的初始化对我有用之前。

**注意：**上面的行将关闭*每次*注销 ( `Level.OFF`)。如果你想不那么严格，你可以使用

```
java.util.logging.Logger.getLogger("org.hibernate").setLevel(Level.SEVERE); 
```

这已经足够沉默了。（或查看`java.util.logging.Level`更多级别的课程）。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-11-28T13:08:09.340

您可以禁用休眠的许多输出，将休眠（hb 配置）的这个道具设置为 false：

```
hibernate.show_sql
hibernate.generate_statistics
hibernate.use_sql_comments 
```

但是，如果您想禁用所有控制台信息，则必须将记录器级别设置为 NONE of FATAL 类，`org.hibernate`如 Juha 所说。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-05-10T15:54:26.933

我终于想通了，这是因为 Hibernate 现在正在使用 slf4j 日志门面，要桥接到 log4j，您需要将 log4j 和 slf4j-log4j12 jar 放到您的 lib 中，然后 log4j 属性将控制 Hibernate 日志。

我的 pom.xml 设置如下所示：

```
 <dependency>
        <groupId>log4j</groupId>
        <artifactId>log4j</artifactId>
        <version>1.2.16</version>
    </dependency>

    <dependency>
        <groupId>org.slf4j</groupId>
        <artifactId>slf4j-log4j12</artifactId>
        <version>1.6.4</version>
    </dependency> 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-05-03T11:02:30.980

要禁用`Hibernate:select`日志中的消息，可以将属性设置为`HibernateJpaVendorAdapter`：

```
<bean id="jpaVendorAdapter"
    class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
    <property name="showSql" value="false"/>
</bean> 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-09-10T14:42:53.323

对于那些不想要优雅解决方案的人，只是一种快速而肮脏的方式来阻止这些消息，这里有一个对我有用的解决方案（我使用 Hibernate 4.3.6 和 Eclipse，上面没有提供答案（或在互联网上找到）工作；既不是 log4j 配置文件，也不是以编程方式设置日志记录级别）

```
public static void main(String[] args) {
    //magical - do not touch
    @SuppressWarnings("unused")
    org.jboss.logging.Logger logger = org.jboss.logging.Logger.getLogger("org.hibernate");
    java.util.logging.Logger.getLogger("org.hibernate").setLevel(java.util.logging.Level.WARNING); //or whatever level you need

    ...
} 
```

[我在从这个网站](http://www.journaldev.com/2882/hibernate-tutorial-for-beginners-using-xml-annotations-and-property-configurations)下载的教程程序中使用了它

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-08-16T15:33:19.213

首先要做的是弄清楚实际使用的是哪个日志框架。

上面的其他作者已经涵盖了许多框架。如果您使用的是 Logback，您可以通过将此*logback.xml*添加到您的类路径来解决问题：

```
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <logger name="org.hibernate" level="WARN"/>
</configuration> 
```

更多信息：[Logback 手动配置](https://logback.qos.ch/manual/configuration.html)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2021-05-14T08:04:07.577

**要禁用在日志中打印休眠查询，只需将其添加到您的`application.properties`**

```
spring.jpa.show-sql=false 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-06-18T20:55:59.383

我将“调试”更改为“信息”并且它起作用了。这是我所做的：

前：

```
log4j.rootLogger=debug, stdout, R 
```

后：

```
log4j.rootLogger=info, stdout, R 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-01-10T17:12:21.873

您可以根据 hibernate 包的 logger 层次结构来控制 hibernate 日志记录的几个部分（更多关于 logger 层次结构的[信息](https://www.journaldev.com/7128/log4j2-example-tutorial-configuration-levels-appenders)）。

```
 <!-- Log everything in hibernate -->
    <Logger name="org.hibernate" level="info" additivity="false">
      <AppenderRef ref="Console" />
    </Logger>

    <!-- Log SQL statements -->
    <Logger name="org.hibernate.SQL" level="debug" additivity="false">
      <AppenderRef ref="Console" />
      <AppenderRef ref="File" />
    </Logger>

    <!-- Log JDBC bind parameters -->
    <Logger name="org.hibernate.type.descriptor.sql" level="trace" additivity="false">
      <AppenderRef ref="Console" />
      <AppenderRef ref="File" />
    </Logger> 
```

以上取自[这里](https://www.boraji.com/hibernate-5-log4j-2-configuration-example)。

此外，您可以`show-sql:true`在配置文件中拥有该属性，因为它取代了日志框架设置。更多关于[这里](https://stackoverflow.com/questions/6012333/turn-off-hibernate-logging-to-console/59685881#59685881)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-01-13T03:26:09.993

我设法通过添加这两行来停止

```
log4j.logger.org.hibernate.orm.deprecation=error

log4j.logger.org.hibernate=error 
```

Bellow 是我的*log4j.properties*的样子，我只留下一些注释行来解释日志级别

```
# Root logger option
#Level/rules TRACE < DEBUG < INFO < WARN < ERROR < FATAL.
#FATAL: shows messages at a FATAL level only
#ERROR: Shows messages classified as ERROR and FATAL
#WARNING: Shows messages classified as WARNING, ERROR, and FATAL
#INFO: Shows messages classified as INFO, WARNING, ERROR, and FATAL
#DEBUG: Shows messages classified as DEBUG, INFO, WARNING, ERROR, and FATAL
#TRACE : Shows messages classified as TRACE,DEBUG, INFO, WARNING, ERROR, and FATAL
#ALL : Shows messages classified as TRACE,DEBUG, INFO, WARNING, ERROR, and FATAL
#OFF : No log messages display

log4j.rootLogger=INFO, file, console

log4j.logger.main=DEBUG
log4j.logger.org.hibernate.orm.deprecation=error
log4j.logger.org.hibernate=error

#######################################
# Direct log messages to a log file
log4j.appender.file.Threshold=ALL
log4j.appender.file.file=logs/MyProgram.log
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %c{1} - %m%n

# set file size limit
log4j.appender.file=org.apache.log4j.RollingFileAppender
log4j.appender.file.MaxFileSize=5MB
log4j.appender.file.MaxBackupIndex=50

#############################################
# Direct log messages to System Out
log4j.appender.console.Threshold=INFO
log4j.appender.console.Target=System.out
log4j.appender.console=org.apache.log4j.ConsoleAppender
log4j.appender.console.layout=org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern=%d{HH:mm:ss} %-5p %c{1} - %m%n 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-09-23T04:09:19.757

将 slf4j-jdk14-xxx.jar 替换为 slf4j-log4j12-xxx.jar。如果两者都有，请删除 slf4j-jdk14-xxx.jar。[在https://forum.hibernate.org/viewtopic.php?f=1&t=999623](https://forum.hibernate.org/viewtopic.php?f=1&t=999623)找到了这个解决方案

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-12-11T06:42:32.000

要摆脱控制台中的记录器输出，请尝试此操作。

```
ch.qos.logback.classic.LoggerContext.LoggerContext loggerContext = (LoggerContext) org.slf4j.LoggerFactory.LoggerFactory.getILoggerFactory();

loggerContext.stop(); 
```

这些语句禁用了记录器的所有控制台输出。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-08-17T19:22:45.510

就我而言，我添加了依赖项

```
 <dependency>
        <groupId>org.hibernate</groupId>
        <artifactId>hibernate-entitymanager</artifactId>
        <version>5.5.6.Final</version>
    </dependency> 
```

这是不必要的。我删除了它，一切正常

# bluetooth - 使用蓝牙的“会议”类型操作？

> ID：311418
> 
> 赞同：2
> 
> 时间：2008-11-22T15:23:32.640
> 
> 标签：bluetooth

是否可以实现蓝牙设备提供会议而不是一对一的操作。是否有任何开发工具包可以让我以这种方式配置 BT 设备，或者可以对 BT 堆栈或附加协议进行修改。我需要配置多个蓝牙适配器以同时相互通信。我认为 BT 最多允许 10 个“微微网”，但我需要专门的建议。我欢迎任何资源链接或蓝牙专家的回复。感谢期待。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T17:11:26.230

我听说过类似的东西，称为[piconet](http://en.wikipedia.org/wiki/Piconet)。谷歌搜索“蓝牙微微网”应该为您指明正确的方向。

一个主设备可以通过这种方式与多达 255 个从设备联网，但任何时候只能有 7 个处于活动状态。这更像是一对多的通信而不是多对多的通信，但可以通过让主设备充当网络交换机来进行近似。

**更新：**我刚刚读到一个微微网中的从属可以作为主或从属参与另一个微微网，形成一个“[分散网](http://en.wikipedia.org/wiki/Scatternet)”。

# sql - 在使用视图的查询中使用 WITH NOLOCK 表提示 - 它是否在视图内传播？

> ID：311429
> 
> 赞同：66
> 
> 时间：2008-11-22T15:35:55.830
> 
> 标签：sql, sql-server, locking

如果在 SQL Server 中的视图上使用“WITH NOLOCK”查询提示，它是否将该提示传播到视图定义本身，即使视图定义中的原始表不使用 NOLOCK？需要这样做的原因是，有时支持人员想要执行大量耗时的查询，但宁愿不使用应用程序本身的视图强制锁定所有查询。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2008-11-22T17:20:27.553

是的，NOLOCK 将传播到视图定义使用的表（至少在 SQL Server 2005 中）。

请参阅MSDN 中的[表提示：](http://msdn.microsoft.com/en-us/library/ms187373(SQL.90).aspx)

> 在 SQL Server 2005 中，所有锁定提示都传播到视图中引用的所有表和视图。此外，SQL Server 执行相应的锁一致性检查。

然而，

> 如果一个表包含计算列，并且计算列是由访问其他表中的列的表达式或函数计算的，则表提示不会在这些表上使用。这意味着不会传播表提示。例如，在查询中的表上指定了 NOLOCK 表提示。此表具有计算列，这些计算列是通过访问另一个表中的列的表达式和函数的组合计算得出的。表达式和函数引用的表在访问时不使用 NOLOCK 表提示。

如果您正在使用索引视图，您可能需要阅读更多内容，因为那里也有一些特殊情况。

另请参阅[查看分辨率](http://msdn.microsoft.com/en-us/library/ms190237(SQL.90).aspx)以获取更多信息。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-03T01:46:02.720

只是为了补充罗里的出色答案。

他写道：“是的，NOLOCK 将传播到视图定义使用的表***（至少在 SQL Server 2005 中）***。”

事实上，这也适用于 SQL 2000。 [来自 BOL：](http://msdn.microsoft.com/en-us/library/aa258253(SQL.80).aspx)

> 因为 select_statement 使用 SELECT 语句，所以使用 FROM 子句中指定的提示是有效的。有关详细信息，请参阅[FROM](http://msdn.microsoft.com/en-us/library/aa258869(SQL.80).aspx)和[SELECT](http://msdn.microsoft.com/en-us/library/aa259187(SQL.80).aspx)。

# design-patterns - 内容交付网络算法、示例、代码

> ID：311430
> 
> 赞同：7
> 
> 时间：2008-11-22T15:36:41.740
> 
> 标签：design-patterns, open-source, cdn

在为内容分发系统编写软件时必须考虑哪些设计考虑，例如管理数据的同步和分发、将下载重定向到最近的服务器等等？

我也在寻找开源 CDN（内容交付网络）软件的示例。我能想到两个项目，[CoralCDN](http://www.coralcdn.org/)和[OpenCDN](http://labtel.ing.uniroma1.it/opencdn/)

请注意，CDN 不仅仅是硬件带宽。CDN 是软件*和*硬件的组合。

我想要的是流媒体和静态资产的软件。我无法弄清楚如何在服务器之间正确同步流媒体（因为文件访问可能相当随机），而静态资产似乎更容易一些，因为它是一次性请求。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-22T15:58:57.403

您是否意识到内容交付网络的价值纯粹在于他们拥有的服务器数量以及服务器与最终用户的接近程度？

你确定你走的是正确的道路吗？

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-22T17:35:05.587

虽然我不知道任何开源项目，但也许值得总结一下 CDN 实际上是什么？毕竟，仅仅使用一堆 Web 服务器并不能带你到任何地方。

CDN软件要解决的关键问题：

*   同步。因此，您在美国、欧洲和亚洲拥有所有整洁的农场，但是您如何确保它们都具有您要提供的文件的相同版本？如果其中一个农场没有当前版本，你如何告诉负载均衡器使用哪个农场？
*   记录。在 CDN 中，您通常希望向客户计费，因此您需要衡量流量和文件访问量。但是对于多个场和每个场中的多个 Web 服务器，您需要以某种方式集中日志记录
*   验证。毕竟，CDN 不仅仅是向所有人提供 HTTP 内容的 Web 服务器。如果您有一个用于视频流的 CDN，实际上只限制了某些用户的访问权限，该怎么办？
*   负载均衡。虽然这通常是单独完成的，但这也链接到同步部分。所以我是来自韩国的用户，试图访问这些内容。负载均衡器发现首尔的农场是最近的 - 但不幸的是，首尔的农场还没有内容。所以 CDN 和负载均衡器需要弄清楚最近的有内容的 Farm 是什么。让我们看看......法国巴黎和美国洛杉矶都有内容。应该服务哪一个？

每个问题本身都不是 CDN 独有的问题，但 CDN 软件本质上是这些技术的组合。还有其他我忘记了吗？

从评论：

*   确定哪些文件需要复制到哪里。日语 Windows 更新可能在日本和其他一些亚洲国家/地区非常受欢迎，但欧洲和美国可能对它的请求较少，因此此文件可能不需要在 CDN 中的每个场中复制。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-22T16:09:27.977

CDN 不是软件。请至少谷歌或在维基上寻找东西。 [http://en.wikipedia.org/wiki/Content_Delivery_Network](http://en.wikipedia.org/wiki/Content_Delivery_Network)

# c# - 既然我们有泛型，是否需要 EventArg 类

> ID：311432
> 
> 赞同：19
> 
> 时间：2008-11-22T15:36:53.050
> 
> 标签：c#, generics, eventargs

使用泛型，是否有理由创建特定的派生 EventArg 类

现在似乎您可以通过通用实现简单地使用它们。

我是否应该仔细阅读所有示例并删除我的 eventArg 类（StringEventArgs、MyFooEventArgs 等。）

```
public class EventArgs<T> : EventArgs
{
    public EventArgs(T value)
    {
        m_value = value;
    }

    private T m_value;

    public T Value
    {
        get { return m_value; }
    }
} 
```

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-22T18:25:50.493

您所描述的本质上是[tuples](http://en.wikipedia.org/wiki/Tuple)，用于特定目的的分组值。它们在[函数式编程](http://en.wikipedia.org/wiki/Functional_programming)中是一个有用的构造，并且很好地支持了这种风格。

缺点是它们的值没有命名，并且需要理解上下文。`EventArgs`就其本质而言，它们通常在远离其相关背景的地方被消耗。因此，元组式`EventArgs`可能会让消费者感到非常困惑。

假设我们有一个事件表明某个除法已经完成，它带有分子、分母和结果：

```
public event EventHandler<EventArgs<double, double, double>> Divided; 
```

事件处理程序有一些歧义：

```
private void OnDivided(object sender, EventArgs<double, double, double> e)
{
    // I have to just "know" this - it is a convention

    var numerator = e.Value1;
    var denominator = e.Value2;
    var result = e.Value3;
} 
```

`EventArgs`使用代表事件会更清楚：

```
private void OnDivided(object sender, DividedEventArgs e)
{
    var numerator = e.Numerator;
    var denominator = e.Denominator;
    var result = e.Result;
} 
```

通用的可重用`EventArgs`类以表达意图为代价简化了机制的开发。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T17:00:19.183

查看[Matthew Cochran](http://www.c-sharpcorner.com/Authors/AuthorDetails.aspx?AuthorID=rmcochran)撰写的[Custom Generic EventArgs](http://www.c-sharpcorner.com/UploadFile/rmcochran/customgenericeventargs05132007100456AM/customgenericeventargs.aspx)文章，在那篇文章中他描述了如何使用两个和三个成员进一步扩展它。

使用泛型 EventArgs 有其用途，当然也有其误用，因为在此过程中会丢失类型信息。

```
public class City {...}

public delegate void FireNuclearMissile(object sender, EventArgs<City> args);
public event FireNuclearMissile FireNuclearMissileEvent;

public delegate void QueryPopulation(object sender, EventArgs<City> args);
public event QueryPopulation QueryPopulationEvent; 
```

在下面的示例中，它是类型安全的，但更多的是 LOC：

```
class City {...}

public class FireNuclearMissileEventArgs : EventArgs
{
    public FireNuclearMissileEventArgs(City city)
    {
        this.city = city;
    }

    private City city;

    public City City
    {
        get { return this.city; }
    }
}

public delegate void FireNuclearMissile(object sender, FireNuclearMissileEventArgs args);
public event FireNuclearMissile FireNuclearMissileEvent;

public class QueryPopulationEventArgs : EventArgs
{
    public QueryPopulationEventArgs(City city)
    {
        this.city = city;
    }

    private City city;

    public City City
    {
        get { return this.city; }
    }
}

public delegate void QueryPopulation(object sender, QueryPopulationEventArgs args);
public event QueryPopulation QueryPopulationEvent; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-01T18:58:10.887

我认为元组样式的 EventArgs 很有用。就像 Tuple 的一样，它们可能会被误用，但似乎我的懒惰比我的谨慎感强。我实现了以下内容：

```
public static class TupleEventArgs
{
    static public TupleEventArgs<T1> Create<T1>(T1 item1)
    {
        return new TupleEventArgs<T1>(item1);
    }

    static public TupleEventArgs<T1, T2> Create<T1, T2>(T1 item1, T2 item2)
    {
        return new TupleEventArgs<T1, T2>(item1, item2);
    }

    static public TupleEventArgs<T1, T2, T3> Create<T1, T2, T3>(T1 item1, T2 item2, T3 item3)
    {
        return new TupleEventArgs<T1, T2, T3>(item1, item2, item3);
    }
}

public class TupleEventArgs<T1> : EventArgs
{
    public T1 Item1;

    public TupleEventArgs(T1 item1)
    {
        Item1 = item1;
    }
}

public class TupleEventArgs<T1, T2> : EventArgs
{
    public T1 Item1;
    public T2 Item2;

    public TupleEventArgs(T1 item1, T2 item2)
    {
        Item1 = item1;
        Item2 = item2;
    }
}

public class TupleEventArgs<T1, T2, T3> : EventArgs
{
    public T1 Item1;
    public T2 Item2;
    public T3 Item3;

    public TupleEventArgs(T1 item1, T2 item2, T3 item3)
    {
        Item1 = item1;
        Item2 = item2;
        Item3 = item3;
    }
} 
```

可以按如下方式使用（与[事件引发器扩展](https://stackoverflow.com/a/786473)一起使用时）

```
public event EventHandler<TupleEventArgs<string,string,string>> NewEvent;

NewEvent.Raise(this, TupleEventArgs.Create("1", "2", "3")); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T15:43:46.623

正如 TcKs 已经说过的：`EventArgs<T>`如果您只需要传递一个值，则使用，否则从`EventArgs`（或`EventArgs<T>`，任何您想要的）派生。

# html - Embedding text/html in an Object (instead of an iframe)

> ID：311433
> 
> 赞同：9
> 
> 时间：2008-11-22T15:36:57.700
> 
> 标签：html, internet-explorer, iframe, cross-browser, cross-domain

```
<iframe data="/localfile.html" type="text/html" width="200" height="200"></iframe>
<iframe data="http://example.com/remotefile.html" type="text/html" width="200" height="200"></iframe>
<object data="/localfile.html" type="text/html" width="200" height="200"></object>
<object data="http://example.com/remotefile.html" type="text/html" width="200" height="200"></object> 
```

Under every browser except IE, all 4 of these tests work. Under IE 6 and 7, the last one fails and shows an empty frame. Is there a workaround that allows IE to load the external html in an object?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T15:53:41.410

Review the following for more information about how to use Object with IE: [http://aplus.rs/web-dev/insert-html-page-into-another-html-page/](http://aplus.rs/web-dev/insert-html-page-into-another-html-page/)

It boils down to a difference in what IE expects versus other browsers. For IE, you have to use the classid attribute instead of the type attribute. For example (from the above referenced site):

```
<!--[if IE]>
<object classid="clsid:25336920-03F9-11CF-8FD0-00AA00686F13" data="some.html">
    <p>backup content</p>
</object>
<![endif]-->

<!--[if !IE]> <-->
<object type="text/html" data="some.html">
    <p>backup content</p>
</object>
<!--> <![endif]--> 
```

Note that the classid is specific to the content type that you are trying to server.

# java - 初始化 Java Web 应用程序

> ID：311438
> 
> 赞同：3
> 
> 时间：2008-11-22T15:40:45.927
> 
> 标签：java, servlets, initialization, web-applications

我有一个简单的 web 应用程序，带有一些 jsp 页面、servlet 和 pojo。我想在发出任何请求之前初始化连接池。做这个的最好方式是什么？可以在首次部署应用程序时完成，还是必须等到第一个请求进来？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-22T16:23:39.897

使用 ServletContextListener 并在 web.xml 中正确声明它。这种方式比启动 servlet 更可取。它更有条理，你的意图很明显。它也保证在任何请求之前运行。它还为您提供了一个关闭挂钩来清除池。

这是我的 web.xml 中的一个片段，例如：

```
<listener>
  <listener-class>
    com...ApplicationListener
  </listener-class>
</listener> 
```

这是类本身的代码片段。确保您捕获异常，以便它们不会传播到您的服务器应用程序，并提供有用的日志消息 - 这些将在您跟踪应用程序时为您提供帮助。

```
public class ApplicationListener implements ServletContextListener {

  private ServletContext sc = null;

  private Logger log = Logger
    .getLogger(ApplicationListener.class);

  public void contextInitialized(ServletContextEvent arg0) {
    this.sc = arg0.getServletContext();
    try {
      // initialization code
    } catch (Exception e) {
      log.error("oops", e);
    }
    log.info("webapp started");
  }

  public void contextDestroyed(ServletContextEvent arg0) {
    try {
      // shutdown code
    } catch (Exception e) {
      log.error("oops", e);
    }
    this.sc = null;
    log.info("webapp stopped");
  }

} 
```

[请参阅此处](http://www.google.com/search?hl=en&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=WwF&q=ServletContextListener&btnG=Search&aq=f&oq=)的 api和[此处](http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletContextListener.html)的示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T15:59:48.480

用于初始化连接池的基本启动 servlet 怎么样？

# c# - C#，在设计基本颜色类时正确使用static关键字

> ID：311439
> 
> 赞同：3
> 
> 时间：2008-11-22T15:41:03.150
> 
> 标签：c#, static

我正在制作一个 Color 类，并提供一个标准构造函数，例如

```
Color(int red, int green, int blue) 
```

然后我想提供一种简单的方法来获取最常见的颜色，例如 Color.Blue、Color.Red。我看到两种可能的选择：

```
public static readonly Color Red = new Color(255, 0, 0);

public static Color Red { get { return new Color(255, 0, 0); } } 
```

我不完全理解的是，是否有一个优势，以及 static 关键字的工作原理。我的想法是：第一个创建一个实例，然后该实例在程序的整个过程中都保留在内存中，每次调用 Red 时，都会使用这个实例。后者仅在第一次使用时创建一些东西，但每次都会创建一个新实例。如果这是正确的，那么我会争辩说，如果我提供了很多预定义的颜色，那么第一个会使用很多不必要的内存吗？因此，每次我猜测时，它都是内存使用与实例化对象的运行时开销。

我的推理正确吗？在设计类和使用 static 关键字时，任何关于最佳实践的建议都会很棒。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T16:40:55.807

我猜你可能已经知道框架提供了一个`Color`结构。我猜你正在创建一个`Color`只是为了练习的课程。

`static`尽管您使用正确，但您对关键字的含义表示不确定。当`static`应用于类或结构的成员时，意味着该成员作为一个整体属于该类，而不适用于单个实例。静态数据成员（字段）只创建一次；实例没有自己的副本。静态函数（方法和属性）在没有实例引用的情况下被调用。

就内存使用而言，在您的情况下我不会太担心。您的`Color`类在每个实例中使用的字节数不应超过几个字节（例如，框架的`Color`结构将红色、绿色、蓝色和 alpha 存储在一个 32 位的`int`.）中。如果你`Color`真的是 a`class`而不是 a `struct`，那么你会有更多的字节开销（每个实例都有一个额外的 32 位 v-table/typeinfo 指针，每个引用都是一个额外的 32 位），但是即便如此，您说的是每个实例大约 12 个字节。如果您预定义了 100 种不同的颜色，您将使用 <= 1200 字节。真的没什么大不了的。

不过，延迟实例化是有原因的。有些类*确实会*使用大量内存，有些类会占用有限的系统资源，有些类需要很长时间才能构建自己，等等。对于这些类，有时最好使用如下模式：

```
class Heavy{
    static Heavy first;
    static Heavy second;

    public static Heavy First{
        get{
            if(first == null)
                first = new Heavy();
            return first;
        }
    }
    public static Heavy Second{
        get{
            if(second == null)
                second = new Heavy();
            return second;
        }
    }
} 
```

另一个考虑因素是可变性。你的`Color`类是可变的还是不可变的？换句话说，您的类的实例是否可以更改其值，或者它们是否总是在创建后代表相同的值？

如果您`Color`是可变的，那么拥有静态“红色”访问器的唯一正确方法是您的第二个示例，每次访问都创建一个新访问器。这样，某人就不能做类似的事情：

```
Color.Red.G = 255; 
```

并使单个共享的 Color.Red 实例实际上代表黄色。

但也要记住，在以下情况下：

```
for(int y = 0; y < bmp.Height; y++)
for(int x = 0; x < bmp.Width; x++)
    if(bmp.GetPixel(x, y) == Color.Red))
        MessageBox.Show("Found a red pixel!"); 
```

您的类的**许多**实例`Color`将被创建。当然，它们稍后会被垃圾收集，但这仍然是您上面的第一个构造的案例参数（或我给出的“重”示例）。

现在，如果您`Color`实际上是一个结构，那么这是一个略有不同的故事。当你是一个结构时没有堆分配`new`，也没有 v-table 或引用指针，所以真正的考虑是你的构造函数需要多长时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T15:59:12.787

您对权衡的推理和识别似乎是合理的。如果您查看 System.Drawing.Color 结构，您会发现它使用了第二种技术。初始化新结构的开销很小，因此这可能比预先创建大量已知颜色要好。

我希望 Color 是一个不可变的结构。但是，如果您打算创建一个类，那么如果您决定使用第一种技术，则需要确保它是不可变的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T16:07:58.040

关于使用静态，我要补充的一点是，您应该确保不要滥用它来执行诸如存储全局数据之类的事情。

如果您确实需要至少在 WPF 中的全局数据，模式是拥有一个引用其自身的非静态实例的静态属性。例如`Application.Current`。这是我为我的应用程序复制的模式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T16:30:21.833

正如您所说，第一个将只创建一个颜色实例：

```
public static readonly Color RED = new Color(255, 0, 0); 
```

在幕后，我相信在运行时它只会在第一次被调用时被实例化。但是我还没有在调试器中自己检查过。

正如您所说的静态 getter 替代方案，您提供的实现将在您调用它时不必要地填满堆。原因是每次调用都会创建一个**新**对象。

如果您真的想选择 getter 替代方案但不想填满堆，那么至少也要使 Color 类的创建成为静态的。像这样：

```
private static readonly Color RED = new Color(255, 0, 0);
    // RED is created once when it is invoked for the first time.

public static Color Red { 
    get { 
        return RED; 
            // Will return a created RED object or create one 
            // for the first time.
    } 
} 
```

# formatting - 您将如何格式化/缩进这段代码？

> ID：311454
> 
> 赞同：0
> 
> 时间：2008-11-22T15:59:52.737
> 
> 标签：formatting, indentation, code-formatting

您将如何格式化/缩进这段代码？

```
int ID = Blahs.Add( new Blah( -1, -2, -3) ); 
```

或者

```
int ID = Blahs.Add( new Blah(
1,2,3,55
)          
); 
```

* * *

### 编辑：

我的班级实际上有很多参数，所以这可能会影响你的反应。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-22T16:54:22.737

我同意 Patrick McElhaney 的观点；没有必要嵌套它....

```
Blah aBlah = new Blah( 1, 2, 3, 55 );
int ID = Blahas.Add( aBlah ); 
```

这里有几个小优势：

1.  您可以在第二行设置断点并检查“aBlah”。
2.  您的差异将更清晰（变化更明显），无需嵌套语句，例如创建新的 Blah 是在将其添加到列表中的独立语句中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-22T16:07:13.520

我会选择单线。如果真正的参数使一行太长，我会用一个变量将它分解。

```
Blah blah = new Blah(1,2,3,55);
int ID = Blahs.Add( blah ); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-22T16:32:45.887

```
int ID = Blahs.Add
( 
    new Blah
    (
        1,    /* When the answer is within this percentage, accept it. */ 
        2,    /* Initial seed for algorithm                            */ 
        3,    /* Maximum threads for calculation                       */ 
        55    /* Limit on number of hours, a thread may iterate        */ 
    )          
); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-22T16:45:44.767

所有数字都被添加到结果中。无需单独评论每个数字。一条评论“这些数字加在一起”就可以了。我要这样做：

```
int result = Blahs.Add( new Blah(1, 2, 3, 55) ); 
```

但如果这些数字本身具有某种意义，则每个数字都可能代表完全不同的东西，例如，如果`Blah`表示库存项目的类型。我会去

```
int ID = Blahs.Add( new Blah(
    1, /* wtf is this */ 
    2, /* wtf is this */
    3, /* wtf is this */
    55 /* and huh */
)); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-22T16:02:39.643

或者

```
int ID = Blahs.Add( 
            new Blah( 1, 2, 3, 55 )          
         ); 
```

不过，我必须承认，在 77 次中，我有 76 次做你第一次做的事情。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-22T16:05:23.880

第一种方式，因为无论如何你都要内联它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-22T16:47:51.127

我将使用与您的第一个示例类似的格式，但在括号分隔符之前和之后没有多余的空格分隔符：

```
int id = BLahs.Add(new Blah(-1, -2, -3)); 
```

请注意，在这种情况下，我也不会使用全大写的变量名，这通常意味着一些特殊的东西，比如常量。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-22T17:03:06.743

要么把它分成两行：

```
new_Blah = new Blah(-1, -2, -3)
int ID = BLahs.Add(new_Blah); 
```

或者缩进 new Blah(); 称呼：

```
int ID = BLahs.Add(
    new Blah(-1, -2, -3)
); 
```

除非争论很长，否则我可能会做类似的事情。

```
int ID = BLahs.Add(new Blah(
    (-1 * 24) + 9,
    -2,
    -3
)); 
```

作为一个更实际的示例，在 Python 中，我通常会执行以下任一操作：

```
myArray.append(
    someFunction(-1, -2, -3)
)

myArray.append(someFunction(
    otherFunction("An Arg"),
    (x**2) + 4,
    something = True
)) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-23T16:35:28.343

无论 Eclipse 的自动格式化程序给了我什么，所以当下一个开发人员在提交之前处理该代码和格式时，差异不会出现奇怪的问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-22T16:13:48.187

一行，除非有很多数据。我会在大约十个项目或总共六十、七十列上划线，无论先出现什么。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-22T17:52:00.047

int ID = Blahs.Add(new Blah(1,2,3,55)); // 数字 n 使得 n 的基数为 4 位的集合等于 n 的基数为 6 的位的集合。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-22T17:54:23.520

问题与

```
Blah aBlah = new Blah( 1, 2, 3, 55 );
int ID = Blahas.Add( aBlah ); 
```

是它与您的名称空间混淆。如果您不需要对 Blah 的引用，则不应创建它。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-22T18:46:19.487

我要么把它作为一个单行来做，要么把它分配`new Blah`给一个变量，这取决于我是否需要`Blah`再次直接引用它。

至于几个答案通过将每个参数放在单独的行上并带有注释来解决的可读性问题，我将通过使用命名参数来解决这个问题。（但不幸的是，并非所有语言都支持命名参数。）

```
int ID = BLahs.Add(new Blah( foo => -1, bar => -2, baz => -3 )); 
```

# php - PHP读取CSV文件的问题

> ID：311460
> 
> 赞同：3
> 
> 时间：2008-11-22T16:02:51.860
> 
> 标签：php, file-io, csv

我正在尝试从 .csv 文件中读取数据以将其作为文本输出到网页上。

这是我第一次这样做，我遇到了一个讨厌的小问题。

我的 .csv 文件（默认情况下由 Excel 打开）有多行，我将整个内容作为一个长字符串读取。

像这样：

```
$contents = file_get_contents("files/data.csv"); 
```

在我制作的这个示例文件中，有 2 行。

> Paul Blueberryroad 85 us 手电筒，包 2008 年 11 月 20 日，下午 4:39
> 
> Hellen Blueberryroad 85 us lens13mm,手电筒,包包,ExtraBatteries 2008-11-20 16:41:32

但是 PHP 读取的字符串是这样的：

Paul；Blueberryroad 85；我们；手电筒，包；2008 年 11 月 20 日，下午 4:39Hellen；Blueberryroad 85；我们；lens13mm，手电筒，包，额外电池；2008 年 11 月 20 日，16:41:32

我将其拆分为：

```
list($name[], $street[], $country[], $accessories[], $orderdate[]) = split(";",$contents); 
```

我想要的是 $name[] 包含“Paul”和“Hellen”作为其内容。其他数组接收它们各自列的值。

相反，我只得到 Paul 并且 $orderdate[] 的内容是

> 2008 年 11 月 20 日下午 4:39 海伦

所以所有的行都被连接起来。有人可以告诉我如何实现我所需要的吗？

编辑：找到解决方案，只剩下一件奇怪的事情：

我现在通过使用这段代码解决了它：

```
$fo = fopen("files/users.csv", "rb+");
while(!feof($fo)) {
  $contents[] = fgetcsv($fo,0,';');
}
fclose($fo); 
```

出于某种原因，尽管我的 CSV 文件只有 2 行，但它返回 2 个数组和 1 个布尔值。前 2 个是我的数据数组，布尔值为 0。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-22T16:07:46.403

您最好使用[fgetcsv()](http://www.php.net/fgetcsv)，它知道 CSV 文件结构并指定了处理 CSV 文件的选项。或者，您可以对文件的内容使用[str_getcsv() 。](http://www.php.net/manual/en/function.str-getcsv.php)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T16:06:55.657

[file()](http://it.php.net/file)函数读取数组中的文件，每一行都是数组的一个条目。

因此，您可以执行以下操作：

```
$rows = array();
$name = array();
$street = array();
$country = array();

$rows = file("file.csv");
foreach($rows as $r) {
    $data = explode(";", $r);
    $name[] = $data[0];
    $street[] = $data[1];
    $country[] = $data[2];
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T16:28:38.157

我现在通过使用这段代码解决了它：

```
$fo = fopen("files/users.csv", "rb+");
while(!feof($fo)) {
  $contents[] = fgetcsv($fo,0,';');
}
fclose($fo); 
```

出于某种原因，尽管我的 CSV 文件只有 2 行，但它返回 2 个数组和 1 个布尔值。前 2 个是我的数据数组，布尔值为 0。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T16:16:56.823

关于 fgetcsv 的评论是正确的。

出于教育目的，我仍然会回答您的问题。首先，我不明白您的数据（带逗号）和“PHP 读取的字符串”之间的区别（它用分号代替了一些空格，但不是全部？）。PS.：我查看了您消息的源代码，它看起来像是 TSV（选项卡）和 CSV（昏迷）的奇怪组合。

此外，如果你想这样做，你需要先将文件拆分成行，然后再拆分字段中的行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-22T16:49:50.953

正如指出的那样，最好的方法当然是 fgetcsv() 。

```
$f = fopen ('test.csv', 'r');
while (false !== $data = fgetcsv($f, 0, ';'))
    $arr[] = $data;
fclose($f); 
```

但是如果你有一个变量中的内容并且想要拆分它，并且 str_getcsv 不可用，你可以使用这个：

```
function str_split_csv($text, $seperator = ';') {
    $regex = '#' . preg_quote($seperator) . '|\v#';
    preg_match('|^.*$|m', $text, $firstline);
    $chunks = substr_count($firstline[0], $seperator) + 1;
    $split = array_chunk(preg_split($regex, $text), $chunks);
    $c = count($split) - 1;
    if (isset($split[$c]) && ((count($split[$c]) < $chunks) || (($chunks == 1) && ($split[$c][0] == ''))))
        unset($split[$c]);
    return $split;
} 
```

# java-me - 在 RMS 中存储大量数据

> ID：311461
> 
> 赞同：1
> 
> 时间：2008-11-22T16:04:02.013
> 
> 标签：java-me, midp, rms

我需要通过 J2ME 使用 RMS API 存储大量数据。

我如何存储多列数据，因为它们必须是硬编码的，所以我需要存储这些多列和多行数据。

我该如何做到这一点，我应该使用`struct`s 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T01:12:22.640

请参阅[我](https://stackoverflow.com/questions/19011/best-practice-for-storing-large-amounts-of-data-with-j2me)关于完全相同主题的问题。最后，我们购买了一个商业 BTree 实现并将其扩展到多个唱片商店。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-24T13:45:36.347

好吧，RMS 只允许您存储字节数组的记录。您必须自己决定如何存储记录，以及是否要将数据存储在单个或多个记录中。如果您使用 DataInputStream 和 DataOutputStream 类，您将能够读取/写入字符串、布尔值、整数等。API[文档包含一个不错的示例](http://java.sun.com/javame/reference/apis/jsr118/javax/microedition/rms/package-summary.html)，说明如何执行此操作。

如果您有复杂的数据要存储，或者有很多不同的对象，您可能想要为 RMS I/O 创建一个简单的库，它允许您将实现例如“可存储”的对象传递给一个库类，该库类将您的对象写入有效值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T18:04:53.890

Jeroen 是否说过 RMS 非常基础。您只能存储字节数组。但是，虽然它是基本的，但很容易实现一个更复杂的内存结构，其中索引存储在记录存储中并寻址包含数据的其他记录存储。

看看这个页面： [了解记录管理系统](http://developers.sun.com/mobility/midp/articles/databaserms/)

# iphone - iPhone WiTap 示例上的 Bonjour Networking 帮助

> ID：311463
> 
> 赞同：0
> 
> 时间：2008-11-22T16:04:20.153
> 
> 标签：iphone, cocoa-touch, bit-manipulation, bonjour

我可以关注 Apple 的大部分 WiTap 示例，但在发送方法中的这一点上有点难过：

```
- (void) send:(const uint8_t)message
{
if (_outStream && [_outStream hasSpaceAvailable])
    if([_outStream write:(const uint8_t *)&message maxLength:sizeof(const uint8_t)] == -1)
        [self _showAlert:@"Failed sending data to peer"];
 }

 - (void) activateView:(TapView*)view
{
    NSLog(@"ACTIVATE TAG: %d", [view tag]); 
    //[self send:[view tag] | 0x80];
    [self send:[view tag]];
 }

 - (void) deactivateView:(TapView*)view
 {
    NSLog(@"DEACTIVATE TAG: %d", [view tag]); 
    //[self send:[view tag] & 0x7f];
    [self send:[view tag]];

 } 
```

请注意，我已将 send: 参数更改为仅视图的标记，编号为 1-9。最初代码具有按位与和或调整。

为什么？

我知道 send 方法需要 a 的事实`uint8_t`，但这就是为什么存在按位的东西吗？将 NSInteger 变成 unint8_t？

该代码不适用于我上面的更改。它将很好地记录并且视觉上客户端将正常运行，但是消息没有从客户端正确地发送/接收到客户端。

有人可以用简短的话解释一下按位的东西在做什么吗？还是我是正确的？

谢谢！这是我对 SO 的第一个问题，所以请善待。

* * *

感谢您的回复。我还是有点疑惑。得到它？

基本上，为什么？

这只是传递标识符的一种极客方式吗？这些视图中的每一个都有一个标签#，为什么不直接传递它，并从视图类切换状态（上/下）？

这只是“这就是编写它的人是如何做到的”的一个例子，还是我错过了一个关键的难题，因为这也是我应该如何构建我的代码的方式。

我只想传递一个标签#，然后让该标签决定在一个清晰可读的函数中做什么，比如`toggleUpOrDownState`什么。

我猜，这种按位计算的东西总是让我觉得自己很愚蠢，除非有必要等等。然后我觉得自己很愚蠢，但无论如何还是设法蒙混过关。:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T16:29:03.193

基本上，`[view tag] | 0x80`在该值中设置高位（因此 00010011 将变为 10010011）并`[view tag] & 0x7f`正在删除它（10010011 -> 00010011）。

看看`[AppController stream:handleEvent:]`方法。你会看到这段代码：

```
 //We received a remote tap update, forward it to the appropriate view
    if(b & 0x80)
        [(TapView*)[_window viewWithTag:b & 0x7f] touchDown:YES];
    else
        [(TapView*)[_window viewWithTag:b] touchUp:YES]; 
```

所以，流的接收者正在检查那个高位。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-02T05:28:11.997

我相信原因是高位是从一个对等方传递到另一个对等方的另一段数据。它指定消息是针对敲击的“开始”还是敲击的“结束”。

基于该位，接收器要么激活点击视图，要么停用它。

因此，从本质上讲，他们将两条信息放入该单个无符号整数中 - 哪个正方形被轻敲（低位），以及触摸是开始还是结束（高位）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T06:36:03.037

我认为消息可能会被丢弃，或者以不同的顺序到达。因此，如果您不说是轻按还是轻按，则切换可能会被取消。

# c# - LINQ To SQL 不保存到数据库

> ID：311476
> 
> 赞同：3
> 
> 时间：2008-11-22T16:15:26.153
> 
> 标签：c#, sql-server, sql-server-2005, linq-to-sql

我有一个非常简单的表，我可以使用 LINQ To SQL 愉快地查询它，但是当我进行任何保存/更新时，我的 datacontext 上的 GetChangeSet 方法始终为空。

我的代码非常简单（来自各种类的串联代码）：

```
 public static EntitiesDataContext EntitiesContext
    {
        get { return new EntitiesDataContext("Data Source=ANTSLAPTOP\\sqlexpress;Initial Catalog=nmncouk_d000;Integrated Security=True"); }
    }

    public static void Save(Price price)
    {
        EntitiesContext.Prices.InsertOnSubmit(price);
        EntitiesContext.SubmitChanges();
    }

    [Test]
    public void SavePrice()
    {
        Price price = new Price();
        price.Lower = 1;
        price.Upper = 2;
        price.PricePerDay = 10;
        Price.Save(price);
        Assert.AreNotEqual(price.PriceId, 0);
    } 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T16:25:04.573

问题在于您的 EntitiesDataContext 方法。尽管它是静态的，但它在每次调用时都会返回一个新的 DataContext。因此，您正在针对不同的上下文调用 insertonsubmit 和 submitchanges。

调整您的保存方法以使用相同的上下文，一切都应该很好。

# mysql - MySQL - 这个复杂查询的更快方法？

> ID：311479
> 
> 赞同：0
> 
> 时间：2008-11-22T16:19:08.800
> 
> 标签：mysql

是否有一种资源密集度较低/速度更快的方式来执行此查询（部分基于：[这个 StackOverflow 问题](https://stackoverflow.com/questions/311390/mysql-a-search-a-select-of-multiple-rows-joining-and-all-in-one-query)）。目前，每张表只搜索十几行就需要 0.008 秒。

```
SELECT DISTINCT *
FROM (
(

SELECT DISTINCT ta.auto_id, li.address, li.title, GROUP_CONCAT( ta.tag ) , li.description, li.keyword, li.rating, li.timestamp
FROM tags AS ta
INNER JOIN links AS li ON ta.auto_id = li.auto_id
WHERE ta.user_id =1
AND (
ta.tag LIKE '%query%'
)
OR (
li.keyword LIKE '%query%'
)
GROUP BY li.auto_id
)
UNION DISTINCT (

SELECT DISTINCT auto_id, address, title, '', description, keyword, rating, `timestamp`
FROM links
WHERE user_id =1
AND (
keyword LIKE '%query%'
)
)
) AS total
GROUP BY total.auto_id 
```

非常感谢，

冰

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T16:46:33.267

我希望查询优化器会为您执行此操作，但您可能希望在执行连接之前尝试按 user_id 对标签进行选择，以防万一出现第一个子查询。这可能会减少您可能必须连接的行数。您可能还希望在 auto_id 和 user_ID 上有索引。

```
SELECT DISTINCT *
FROM (
   (SELECT ta.auto_id, li.address, li.title, GROUP_CONCAT( ta.tag ),
           li.description, li.keyword, li.rating, li.timestamp
    FROM (SELECT auto_id, tag FROM tags WHERE user_id = 1) AS ta
         INNER JOIN links AS li ON ta.auto_id = li.auto_id
         WHERE (ta.tag LIKE '%query%') OR (li.keyword LIKE '%query%')
    GROUP BY li.auto_id
   )
   UNION (
       SELECT auto_id, address, title, '', description, keyword, rating, `timestamp`
       FROM links
       WHERE user_id = 1 AND (keyword LIKE '%query%')
   )
) AS total
GROUP BY total.auto_id 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T17:05:01.313

如果可以使用 MyISAM 表格式，请尝试使用[全文索引并](http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html)在 ta.tag 和 li.keyword 上进行搜索。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T17:50:41.533

在有几十行的表上测试它不一定会告诉你是否存在性能问题。DBMS 可能会根据表的大小使用不同的策略。

在大型数据集上尝试此操作，以更好地评估是否存在问题以及问题的严重程度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T13:20:19.830

% 通配符可能会阻止您的查询使用索引，尤其是领先的索引 - 搜索 'cat%' 仍然可以使用索引，但 '%cat%' 不能。除非您的数据集很小，否则这可能是致命的。

我还会检查 OR 逻辑是否给您带来麻烦 - 我不确定优化器是否能够分别优化关键字和标签标准。如果它不能，它会放弃并蛮力它。

重申其他一些评论：

*   使用更大的数据集进行测试
*   在尝试将它们全部连接在一起之前，首先尝试此查询的组件（其中大约有三个单独的查询）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-22T18:12:23.733

没有表定义很难确定，但您可以将查询改写为从 LINKS 到 TAGS 的更简单的左连接：

```
select li.auto_id, 
       address, 
       title, 
       group_concat(ta.tag), 
       description,  
       keyword, 
       rating,  
       timestamp 
from links li  
left join tags ta ON ta.auto_id = li.auto_id  
where li.user_id = 1 and ( keyword like '%query%' or ta.tag like '%query%' ) 
group by li.auto_id; 
```

逻辑可能需要加强以处理关键字或 ta.tag 中的空值 - 取决于表定义。

# php - 如何测试 PHPUnit 模拟对象中的第二个参数

> ID：311485
> 
> 赞同：69
> 
> 时间：2008-11-22T16:27:51.060
> 
> 标签：php, phpunit

这就是我所拥有的：

```
$observer = $this->getMock('SomeObserverClass', array('method'));
$observer->expects($this->once())
         ->method('method')
         ->with($this->equalTo($arg1)); 
```

但是该方法应该采用两个参数。我只是在测试第一个参数是否正确传递（如 $arg1）。

如何测试第二个参数？

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2008-12-08T21:16:05.213

我相信这样做的方法是：

```
$observer->expects($this->once())
     ->method('method')
     ->with($this->equalTo($arg1),$this->equalTo($arg2)); 
```

或者

```
$observer->expects($this->once())
     ->method('method')
     ->with($arg1, $arg2); 
```

如果您需要在第二个参数上执行不同类型的断言，您也可以这样做：

```
$observer->expects($this->once())
     ->method('method')
     ->with($this->equalTo($arg1),$this->stringContains('some_string')); 
```

如果您需要确保某个参数传递多个断言，请使用logicalAnd()

```
$observer->expects($this->once())
     ->method('method')
     ->with($this->logicalAnd($this->stringContains('a'), $this->stringContains('b'))); 
```

# windows - 如何在 Windows XP 中添加开始->运行快捷方式？

> ID：311496
> 
> 赞同：16
> 
> 时间：2008-11-22T16:39:12.160
> 
> 标签：windows, windows-xp, shortcut

有谁知道您如何设置新命令以从“开始”->“运行”框中启动应用程序？

IE。您可以在运行框中键入“firefox”、“winword”或“excel”，这些应用程序将打开，即使它们不在系统路径中，但其他应用程序不会。例如，对于 Firefox，在我的任何系统路径目录中都没有名为 firefox.* 的文件：

```
Path=C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\Program Files\Subversion\bin;c:\Program Files\Microsoft
SQL Server\90\Tools\binn\ 
```

所以必须有某种方法将应用程序与此路径链接以创建快捷命令，也许在注册表中？

例如，我希望能够从运行命令启动 Google Talk，但键入可执行文件的名称“googletalk.exe”不会执行任何操作，这是有道理的，因为它不在系统路径中，但 firefox.exe 也不在，然后键入“firefox”即可。

有没有人有任何想法？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-22T16:43:46.253

从[http://commandwindows.com/runline.htm](http://commandwindows.com/runline.htm)：

> **将应用程序添加到路径**
> 
> 或者，可以编辑注册表以明确包含所需可执行文件的路径。涉及的注册表项是HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\App Paths
> 
> 1.  使用您希望添加到路径的可执行文件的名称创建一个新的子键。例如，HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\App Paths\somefile.exe
> 2.  在这个新键中，添加一个名为“Path”的字符串变量，其中包含新可执行文件的路径值，例如 C:\Program files\newprogramfolder\
> 3.  新键已经有一个空变量（默认）。编辑它以获得新程序可执行文件的整个地址的字符串值，例如 C:\Program files\newprogramfolder\somefile.exe

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-15T12:03:03.090

3个步骤。

1.  创建要运行的 foo.exe 的快捷方式 (foo.lnk)

2.  将 foo.lnk 复制到 C:\windows 目录。

3.  只需在运行对话框中键入“foo”即可运行 foo.exe。（cmd提示符下的“start foo”也可以）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T12:19:09.407

您还可以使用[Launchy](http://www.launchy.net/)、[Slickrun](http://bayden.com/SlickRun/)或[Executor](http://executor.dk/)等应用程序启动器。这样你就不必弄乱注册表了。我使用 Executor，我可以选择“发送到 -> executor”来为任何应用程序（或文件夹或其他）创建快捷方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T16:41:58.317

Run 适用于搜索路径，其中包括 Path 环境变量和其他一些。MSDN中可能有更多信息，请稍等，我会查找它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-15T11:55:47.083

我在“c:\windows”文件夹中放了一个指向我想要启动的应用程序的链接，我一直都在使用它。当然，您也可以重命名链接文件以加快速度：例如，我键入 w、x 或 pp 来启动 Word、eXcel 或 PowerPoint。

# c# - 为什么 Math.Atan(Math.Tan(x)) != x？

> ID：311501
> 
> 赞同：3
> 
> 时间：2008-11-22T16:43:16.440
> 
> 标签：c#, math

如果 tan(x) = y 和 atan(y) = x 为什么 Math.Atan(Math.Tan(x)) != x？

我正在尝试以如下方式计算 x：

```
tan(2/x +3) = 5 
```

所以

```
atan(tan(2/x + 3) = atan(5) 
```

等等......但我试过这个：

```
double d = Math.Atan(Math.Tan(10)); 
```

d != 10。为什么？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-22T16:50:48.313

1.  正切函数是周期为 pi 的周期性函数，并且*仅*当将其限制在其单射域的子集时才可逆。通常此类集合的选择是开区间]-pi/2, pi/2[，因此 arctan 函数将始终返回该区间中的一个点。在您的情况下，10 = 3*pi + 0.57522... 因此，10 的切线的反正切将返回 0.57522...
2.  请注意，如上定义的 arctan 函数*是*单射的并在所有实数上定义，因此与您的问题相反

    ```
    math.tan(math.atan(x)) == x 
    ```

    确实适用于每个 x（数字错误除外）。
3.  为了处理数值错误，您永远不应该使用 == 或 != 对浮点计算的结果进行比较。利用

    ```
    abs(number1 - number2) <  epsilon   // ==
    abs(number1 - number2) >= epsilon   // != 
    ```

    相反，其中 epsilon 是一个小的正常数。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-22T17:57:34.327

图表可能有助于解释为什么您没有得到预期的结果。

[![替代文字](https://i.stack.imgur.com/ROgTg.gif)](https://i.stack.imgur.com/ROgTg.gif)
[（来源：[wolfram.com](http://mathworld.wolfram.com/images/eps-gif/Tangent_701.gif)）]

[http://mathworld.wolfram.com/Tangent.html](http://mathworld.wolfram.com/Tangent.html)

这显示了 Tan 的图形，但是如果您想象读取给定 y 的 x 值（例如 y = 0），那么根据您读取的 Tan 的“链”，您将得到不同的答案（-pi， 0，皮...）。这就是 Arctan(x) 具有多个解决方案的意义所在。

如果 arctan 仅限于其中之一，例如 -pi/2 < x < pi/2 那么 Arctan(tan(x)) 将返回 x，前提是您已经考虑了浮点错误。

编辑：但是，根据[http://msdn.microsoft.com/en-us/library/system.math.atan.aspx](http://msdn.microsoft.com/en-us/library/system.math.atan.aspx)，如果您输入 atan 方法已经返回 -pi/2 < x < pi/2 或 NaN未定义。所以问题必须归结为浮点舍入。

编辑（FR）：添加图

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-22T16:48:46.227

我不知道任何 C#，但数学上说 tan 是不可逆的，只能在一个小区间内。

例如 tan(pi) = 0 和 tan(0) = 0。当要求 atan(0) 时，它可能是 0 或 pi（或 pi 的每个倍数），因此结果在 -pi/2 的范围内。 π/2。

即使你从可逆范围内的 x 开始，我也不必工作，因为浮点数的舍入误差（它没有无限的精度）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-22T17:56:31.847

tan ^(-1) (tan(x)) == x 对于 (-PI/2, PI/2) 中的所有 x。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-21T16:05:51.090

1.  因为正切函数是周期性的，我们需要对输入角度进行归一化。[Math.Atan](http://msdn.microsoft.com/en-us/library/system.math.atan.aspx)返回一个角度*θ*，以弧度测量，使得*-π/2 ≤ θ ≤ π/2*，因此归一化到该范围是有意义的（因为它显然不会在该范围内有任何东西）：

    ```
    double normalizedAngle = (angle + Math.PI / 2) % Math.PI - Math.PI / 2; 
    ```

2.  双打应该与一些误差幅度进行比较。但实际上对于这种情况[`Double.Epsilon`](http://msdn.microsoft.com/en-us/library/system.double.epsilon.aspx)来说太小了，“如果你创建一个自定义算法来确定两个浮点数是否可以被认为相等，你必须使用一个大于**Epsilon**常数的值来建立可接受的绝对差值两个值被视为相等。（通常，差异幅度比**Epsilon**大很多倍。）“例如，`Math.Atan(Math.Tan(-0.49999632679501449)) + 0.49999632679501449`将大于`Double.Epsilon`for`1.1235582092889474E+307`倍。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-06T10:41:09.133

双 d = Math.Atan(1) * (180 / Math.PI); 所以 d 将是 45 度

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-22T17:03:45.027

通常，当您处理浮点数时，您正在处理近似值。有些数字无法精确表示，tan 和 arctan 运算本身只是近似值。

如果你想比较浮点数，你需要询问它们是否几乎相等，或者等价，如果差异小于某个小值，并仔细考虑你在做什么。

以下是一些常见问题解答（对于 c++，但想法是相同的），其中谈到了浮点数的一些奇怪之处：

[常见问题 29.16](http://www.parashift.com/c++-faq-lite/newbie.html#faq-29.16)
[常见问题 29.17](http://www.parashift.com/c++-faq-lite/newbie.html#faq-29.17)
[常见问题 29.18](http://www.parashift.com/c++-faq-lite/newbie.html#faq-29.18)

编辑：查看其他答案，我意识到主要问题可能是 tan 不可逆，但每当您测试浮点数是否相等时，近似问题也值得考虑。

查看[Math.Atan](http://msdn.microsoft.com/en-us/library/system.math.atan.aspx)的 .net 文档，atan 产生一个介于 -π/2 和 ≤ π/2 之间的值，其中不包括 10。我认为这是 arctan 的通常范围。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-22T17:12:32.357

如果您发布了您想要完成的内容，这可能会有所帮助。例如，当我尝试使用角度时，如果输入对我来说位于哪个象限，我会发现处理该问题的三角函数。

# css - 出现滚动条时，FireFox 中的长页面偏移

> ID：311504
> 
> 赞同：12
> 
> 时间：2008-11-22T16:45:17.967
> 
> 标签：css, firefox

在 Firefox 和 Safari 中，当页面足够长以显示滚动条时，居中的页面会移动几个像素。如果您浏览具有长页面和短页面的站点，页面似乎会“跳跃”。

IE7 倾向于让滚动条一直可见，但在页面不够长时将其禁用。由于 HTML 窗口的宽度永远不会改变，因此页面的中心不会改变。

是否有解决方法或方法来设置页面样式，使其不会在 Firefox 和 Safari 中跳转？

谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-22T16:51:15.567

您可以简单地始终启用滚动条：

```
html{
 overflow: scroll;
} 
```

但这也会给你水平滚动条，这更好：

```
html{
   overflow-y:scroll;
   overflow-x:auto;
} 
```

这只会在需要时为您提供垂直滚动和水平滚动。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-06-20T10:23:20.020

这个站点包含一个 javascript 来解决这个问题，这是一个比当前更好的解决方案 IMO（永久滚动条）：

[http://www.johnpezzetti.com/2011/01/31/removing-vertical-scrollbar-jump-shift-problem-a-javascript-fix-for-all-browsers](http://www.johnpezzetti.com/2011/01/31/removing-vertical-scrollbar-jump-shift-problem-a-javascript-fix-for-all-browsers)

该脚本一直等到 DOM 加载完毕，然后检查滚动条是否处于活动状态。如果是，**它会计算滚动条的宽度并将主体的 marginLeft 设置为等于该宽度。**这抵消了这种转变，并且由于它在 DOM 负载上运行，因此会立即生效。

# language-agnostic - 是否有人使用虚拟化来创建更快的开发环境灾难恢复？

> ID：311507
> 
> 赞同：3
> 
> 时间：2008-11-22T16:47:10.397
> 
> 标签：language-agnostic, backup, development-environment, virtualization, backup-strategies

我已经厌倦了我的开发盒死机，然后我最终不得不重新安装我在开发中使用的工具清单。

这次我想我将在 Virtual Box VM 上设置开发环境并将其保存到外部 HDD，这样我可以在修复真实计算机后快速恢复开发环境。

这似乎是一种进行“与硬件无关的备份”并能够在灾难后快速恢复速度的好方法。

有人试过这个吗？效果如何？它节省了您的时间吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T16:52:45.220

我曾经使用 VirtualBox 虚拟化我所有的开发环境。

基本上，我有一个印在 DVD 上的 Debian vbox 映像文件。当我有一个新项目时，我将其复制到我的一个外部硬盘驱动器中并将其自定义为我的项目。

一旦我的项目交付，然后我将图像从外部硬盘复制到空白 DVD 并归档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T16:49:41.827

我已经成功地做到了这一点，我们甚至在我们的 QA 环境中也使用了 Undo 磁盘，因此如果我们想测试例如 Microsoft 补丁，我们可以将盒子回滚到之前的状态。

如果您进行大量磁盘活动，我们遇到的唯一问题是 SQL Server 的特殊情况。我们有两个虚拟机的复制数据 btw 彼此托管在同一个物理盒子上。磁盘跟不上；然而，对于所有其他层来说，它的工作就像轻而易举。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T17:04:35.290

我刚刚看到的一个很酷的想法是使用 VirtualBox，并让您的主机使用带有 ZFS 的 OpenSolaris。这使得拍摄图像快照变得容易，并在出现问题时回滚到快照，或者当您想要恢复到已知状态以进行 QA 时。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T02:13:11.377

我在虚拟机上进行所有开发。在多开发人员商店中，如果有人破坏他们的 VM（通过服务包或其他方式），则可以快速部署新的开发环境，并允许新开发人员几乎立即加入项目。

ķ

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T06:37:27.910

我读这个问题的方式与你们其他人大不相同。我把它读作 OP 询问有关将全新安装的映像保留为 VM 的问题，然后，当需要重新部署服务器时，您可以从 VM 的备份中恢复。

在这种情况下，VM 只不过是一种维护操作系统安装映像的不同方式，如果它有效，IMO 也不是个坏主意。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T12:47:12.933

在与我合作的公司中，我鼓励使用可网络安装的操作系统。通过正确的前期工作，您可以在办公室网络上配置引导服务器，该服务器将安装您的基本操作系统、硬件所需的所有驱动程序以及您将使用的所有软件。这不仅可以在您丢失机器的灾难情况下为您提供帮助，而且还可以使为新员工部署硬件变得微不足道。

Linux 比 Windows 或 Mac 更容易，但后两者也可以以这种方式工作。

我也使用相同的网络安装方法在实时环境中部署服务器。

虚拟化方法对同一问题来说并不是一个糟糕的答案，但对我来说它似乎并不那么干净。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-23T02:41:19.200

那不是要走的路。在开发时，您希望拥有许多工具，其中一些需要大量计算能力。请记住（IIRC，我在 VBox 网站上找不到它）仅模拟 PIV。目前只有一个虚拟机模拟双核 CPU，这是非常新的。这很重要，因为只有在多个 CPU 机器上才能看到竞争条件，因此您希望在多个 CPU/内核下测试您的代码。

我认为更简单和更好的做法是制作系统和配置分区的磁盘映像，每月恢复一次以保持系统清洁，并在系统出现混乱时恢复它。

现在简要介绍一下 Windows，因为我在其他系统上做过这件事没有问题。您映像的分区不应在两者之间更改。对于其他操作系统来说这不是问题，但是一些聪明的人决定将 Windows 上的配置文件放在系统文件中。我只是强调不要在我的个人资料中（或在我的个人资料中的桌面上）放置我不愿意丢失的任何内容。

# apache-flex - Flex 帮助：在 Accordian 控件中不重复的中继器

> ID：311530
> 
> 赞同：1
> 
> 时间：2008-11-22T17:08:22.537
> 
> 标签：apache-flex, actionscript-3

我在手风琴控件中遇到数据绑定子中继器的问题，希望您能提供帮助...

我在 ViewStack 中有一个手风琴（其中，那个 ViewStack 也在另一个顶级 ViewStack 中）。我在手风琴控件的每个孩子中都有一个中继器。该组件如下所示：

```
 <mx:Box 
    xmlns:mx="http://www.adobe.com/2006/mxml"
    creationComplete="init()"
>
<mx:ViewStack>
...
<mx:Accordion creationComplete="accordianInit()">
    <mx:Box label="Groups" width="100%">
        <mx:Repeater id="rpGroups" width="100%">
            <mx:CheckBox id="chkGroups" 
                label="{rpGroups.currentItem.name}" />
        </mx:Repeater>
    </mx:Box>
    <mx:Box label="Contacts">
        <mx:Repeater id="rpContacts">
            <mx:CheckBox id="chkContacts" 
                label=quot;{rpContacts.currentItem.full_name}" />
        </mx:Repeater>
    </mx:Box>
</mx:Accordion>
...
</mx:ViewStack>

<mx:Box> 

```

问题是，如果我在**init**函数中绑定 2 个中继器，那么两个中继器都不会显示任何数据。如果我在**accordianInit**函数中绑定中继器，那么只有第一个中继器（rpGroups）得到数据绑定......

我应该在哪里对转发器进行数据绑定，以便两个转发器都能正确重复？

希望这是有道理的，如果不是我可以详细说明，任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T21:39:30.307

将转发器的 dataProvider 绑定到 MXML 本身中的源：

```
<mx:Repeater dataProvider="{the_data}" ... /> 
```

您之所以看到您的行为，是因为 Accordion（和 ViewStack）不会立即创建它的所有子项。它只创建可见的子项（因此，最初是第一个 Box 和第一个 ViewStack 子项）。

由于这种行为，当您尝试在第一个 init() 事件处理程序中将数据分配给中继器时，中继器没有实例化容器可以将子级重复到其中。当您在accordionInit() 中将数据分配给中继器时，仅创建了第一个 Box，这就是只有第一个中继器工作的原因。

如果您不想通过 Repeater 标记的 dataProvider 属性绑定到数据（如上所示），那么您可以使用 Accordion 上的更改处理程序在用户更改窗格时设置中继器数据（因为当用户单击窗格时，它们由 Flex 框架创建）。

所有这些都来自*creationPolicy*属性： http: [//livedocs.adobe.com/flex/3/html/layoutperformance_05.html](http://livedocs.adobe.com/flex/3/html/layoutperformance_05.html)

# asp.net - 页面加载后从数据库中填充数据网格列

> ID：311532
> 
> 赞同：1
> 
> 时间：2008-11-22T17:10:38.493
> 
> 标签：asp.net, ajax, .net-2.0

我有一个网页，它通过[SQL](http://en.wikipedia.org/wiki/SQL)查询将一些数据加载到数据网格中。我被要求添加一个新列。在测试期间，我发现从数据库中提取这一额外的数据列会大大降低查询速度。以前亚秒级的查询现在大约需要 3-4 秒。我已经检查了数据库并且所有适当的索引都已到位，并且在这里更改数据库是不切实际的。

无论如何，页面加载速度的放缓确实会影响生产力。

如果可行且可行，这就是我想做的。我想像以前一样使用原始查询呈现数据网格，但将额外的列留空。然后在页面呈现后使用[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)返回服务器并获取剩余列的数据并填充它。这样，那些不需要额外列来完成工作的用户不必等待页面呈现这么长时间，而需要它的用户只需等待几秒钟，数据就会在那里。

问题是，我一点也不知道如何把它放在一起。有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-23T03:08:50.610

让用户选择是否显示额外的列。然后有两个可以绑定到 GridView 的查询，一个返回额外的列，一个不返回。然后由用户决定他们想要哪个“视图”。这样他们就不必在每次打开或刷新页面时都做出决定，您可以坚持他们的选择。

# email - 收到电子邮件时触发事件

> ID：311536
> 
> 赞同：8
> 
> 时间：2008-11-22T17:12:03.857
> 
> 标签：email, imap

我正在尝试编写将消息内容放入队列的内容，以便稍后完成工作。我一直在使用 IMAP IDLE 并取得了不同程度的成功。

我想知道是否有人知道让邮件服务器接收电子邮件的方法，然后执行诸如将电子邮件内容发布到 URL 端点的操作。

有任何想法吗？谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-22T18:23:37.767

尝试[fetchmail](http://www.catb.org/~esr/fetchmail/)和[procmail](http://www.procmail.org/)。您定期轮询邮件服务器（必要时每分钟）并使用 fetchmail 从 IMAP 服务器下载。设置 procmail 规则以在符合您的选择标准的电子邮件上运行您的通知应用程序。

任何脚本语言（perl、python、tcl/tk 等）都具有良好、成熟且易于使用的电子邮件处理程序库（事实上，对于大多数语言，您都可以获得这种东西），因此编写起来应该非常简单其中之一的处理程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T17:22:43.290

配置 SMTP（邮件传输）服务器以将邮件传递到执行所需操作的应用程序。如果可以避免，请不要在 IMAP（邮箱客户端）级别上执行此操作。

# console - 控制台应用程序

> ID：311543
> 
> 赞同：1
> 
> 时间：2008-11-22T17:20:04.697
> 
> 标签：console

编辑：

我不知道这个用户最初想要什么，希望他们会编辑他们的问题让我们知道，但除此之外，让我们用这个问题来回答（或提供链接）以下常见的控制台窗口问题：

*   如何在程序中捕获控制台应用程序的输出（例如，运行构建过程并在 IDE 中获取输出）？
*   当您在 IDE 中点击“运行”时，如何让控制台应用程序停留足够长的时间以查看输出？（即，用于 C 的 getch，一些 IDE 可以设置选项，您使用什么常见/流行的暂停和等待按键例程来保持控制台窗口打开足够长的时间以查看输出？这适用于许多语言 - 列出您的方法)

原始问题：

> 如何查看控制台应用程序输出屏幕（黑屏）。请详细说明。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T17:33:20.333

以符合标准的方式（不是特定于平台）为 C++ 保持控制台窗口打开：

```
#include <iostream>
#include <limits>

int main() {

  // Rest of the code    

  //Clean the stream and ask for input
  std::cin.ignore ( std::numeric_limits<std::streamsize>::max(), '\n' );
  std::cin.get();
  return 0;
} 
```

[资源。](http://www.dreamincode.net/forums/showtopic30581.htm)

-亚当

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T17:22:49.200

如果它是碰巧将消息写入标准输出的图形应用程序，请打开您最喜欢的终端应用程序并在此处输入命令。如果其输出超出终端的输出缓冲区，请通过“更多”或“更少”进行管道传输。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T17:37:21.527

在 C 中保持控制台窗口打开：

```
/* Example waits for a character input */
#include <stdio.h>

int main()
{
  /* Put your code here */
  getchar();
  return 0;
} 
```

getchar 符合标准，而 getch（一种常见用法）是特定于平台的。

-亚当

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T18:11:06.763

在 c# 中，我只是在代码末尾放置一个断点以保持控制台窗口打开。我曾经使用 Console.Read(); 但是懒得打字了……

编辑：顺便说一句，我只是将其用于调试目的。如果它需要成为一个特性，那么 Console.Read();

# c# - 在 C# 中解析日期范围 - ASP.NET

> ID：311576
> 
> 赞同：1
> 
> 时间：2008-11-22T17:56:27.667
> 
> 标签：c#, parsing

假设 11/13/2008 - 12/11/2008 作为返回到 TextBox 中的值，使用 C# 解析开始和结束日期的最佳方法是什么？

我知道我可以使用：

```
DateTime startDate = Convert.ToDateTime(TextBoxDateRange.Text.Substring(0, 10));
DateTime endDate = Convert.ToDateTime(TextBoxDateRange.Text.Substring(13, 10)); 
```

有没有更好的办法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T18:00:46.923

```
var dates = TextBoxDateRange.Text.Split(new char[] { '-' }, StringSplitOptions.RemoveEmptyEntries);

var startDate = DateTime.Parse(dates[0], CultureInfo.CurrentCulture);
var endDate = DateTime.Parse(dates[1], CultureInfo.CurrentCulture); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T18:07:31.780

代替 Convert.ToDateTime，使用 DateTime.Parse 并明确地放入您想要的文化可能是值得的。如果我用任何欧洲文化尝试这个例子，我会得到一个错误，因为 2008 年 11 月 13 日指向 2008 年第 13 个月的第 11 天......

```
 CultureInfo ci = new CultureInfo("en-us");
        var startDate = DateTime.Parse(components[0], ci); 
```

# jquery - 如何根据单击的提交按钮选择父表单？

> ID：311579
> 
> 赞同：130
> 
> 时间：2008-11-22T17:57:46.633
> 
> 标签：jquery, forms

我有一个网页，上面有 3 个表格。没有嵌套，只是一个接一个（它们几乎相同，只是一个隐藏变量不同）。一个用户只会填写一张表格，我想验证/等所有表格只用一个 JS 脚本。

那么，当用户点击form#1 的提交按钮时，如何让我的js 脚本只处理form1 中的字段呢？我认为它与 $(this).parents 有关，但我不确定如何处理它。

我的验证脚本（我在其他地方使用过，只有一个表单）看起来像这样：

```
 $(document).ready(function(){
    $("#submit").click(function(){
        $(".error").hide();
        var hasError = false;

        var nameVal = $("#name").val();
        if(nameVal == '') {
            $("#name").after('Please enter your name.');
            hasError = true;
        }

        if(hasError == false) {blah blah do all the processing stuff} 

```

那么我需要用 $(this).parents('form').name.val() 替换像 $("#name").val() 这样的东西吗？还是有更好的方法来解决这个问题？

谢谢！

* * *

## 回答 #1

> 赞同：201
> 
> 时间：2008-11-22T18:09:02.103

您可以像这样选择表格：

```
$("#submit").click(function(){
    var form = $(this).parents('form:first');
    ...
}); 
```

但是，通常最好将事件附加到表单本身的提交事件，因为即使在通过从以下字段之一按 enter 键提交时也会触发：

```
$('form#myform1').submit(function(e){
     e.preventDefault(); //Prevent the normal submission action
     var form = this;
     // ... Handle form submission
}); 
```

要选择表单内的字段，请使用表单上下文。例如：

```
$("input[name='somename']",form).val(); 
```

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2011-04-12T14:08:15.713

我在搜索如何查找输入元素的形式时找到了这个答案。我想添加一个注释，因为现在有比使用更好的方法：

```
var form = $(this).parents('form:first'); 
```

我不确定它是什么时候添加到 jQuery 中的，但是最接近的（）方法确实比使用 parents() 更干净。最接近的代码可以更改为：

```
var form = $(this).closest('form'); 
```

它向上遍历并找到与您正在查找的内容匹配的第一个元素并停在那里，因此无需指定：first。

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2008-11-22T22:22:30.627

要获得提交在里面的表单，为什么不只是

```
this.form 
```

获得结果的最简单和最快的路径。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-05-17T11:19:26.940

我使用了以下方法，对我来说效果很好

```
$('#mybutton').click(function(){
        clearForm($('#mybutton').closest("form"));
    }); 
```

`$('#mybutton').closest("form")`为我做了伎俩。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-08T02:18:37.870

艾琳：不，不是`var nameVal = form.inputname.val();`。它应该是...

在 jQuery 中：

```
// you can use IDs (easier)

var nameVal =  $(form).find('#id').val();

// or use the [name=Fieldname] to search for the field

var nameVal =  $(form).find('[name=Fieldname]').val(); 
```

或者在 JavaScript 中：

```
var nameVal = this.form.FieldName.value; 
```

或组合：

```
var nameVal = $(this.form.FieldName).val(); 
```

使用 jQuery，您甚至可以遍历表单中的所有输入：

```
$(form).find('input, select, textarea').each(function(){

  var name = this.name;
  // OR
  var name = $(this).attr('name');

  var value = this.value;
  // OR
  var value = $(this).val();
  ....
  }); 
```

# python - 如何缩进 Python 列表理解？

> ID：311588
> 
> 赞同：75
> 
> 时间：2008-11-22T18:08:18.610
> 
> 标签：python, coding-style

列表推导在某些情况下可能很有用，但它们读起来也很糟糕。作为一个稍微夸张的例子，您将如何缩进以下内容？

```
allUuids = [x.id for x in self.db.query(schema.allPostsUuid).execute(timeout = 20) if x.type == "post" and x.deleted is not False] 
```

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-11-22T18:19:41.723

这取决于他们有多长时间。我倾向于像这样构造它们：

```
[x.id for x
 in self.db.query(schema.allPostsUuid).execute(timeout=20)
 if x.type == 'post' 
    and x.deleted is not False
    and ...
    and ...] 
```

这样，每个表达式都有自己的行。

如果任何一行变得太大，我喜欢在 lambda 或表达式中提取它：

```
transform = lambda x: x.id
results = self.db.query(schema.allPostsUuid).execute(timeout=20)
condition = lambda x: x.deleted is not False and ... and ...
[transform(x) for x in results if condition(x)] 
```

然后，如果 lambda 变得太长，它就会被提升为函数。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-11-22T19:29:24.547

在我工作的地方，我们的编码指南会让我们做这样的事情：

```
all_posts_uuid_query = self.db.query(schema.allPostsUuid)
all_posts_uuid_list = all_posts_uuid_query.execute(timeout=20)
all_uuid_list = [
    x.id 
    for x in all_posts_uuid_list 
    if (
        x.type == "post" 
        and 
        not x.deleted  # <-- if you don't care about NULLs / None
    )
] 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-22T19:32:12.467

```
allUuids = [x.id 
            for x in self.db.query(schema.allPostsUuid).execute(timeout = 20) 
            if x.type == "post" and x.deleted is not False] 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-22T18:15:40.983

对我来说这太过分了。也许这只是一个可怕的例子，因为“type”和“deleted”显然是数据库查询的一部分。

我倾向于认为，如果列表理解跨越多行，它可能不应该是列表理解。话虽如此，我通常只是像其他人一样将事情拆分为“如果”，并将在这里回答。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-22T19:36:18.917

**您不应该为此使用列表推导**。

列表推导是一个很棒的功能，但它们是快捷方式，而不是常规代码。

对于这么长的片段，您应该使用普通的 blocs ：

```
allUuids = []
for x in self.db.query(schema.allPostsUuid).execute(timeout = 20) :
    if x.type == "post" and x.deleted is not False :
        allUuids.append(x.id) 
```

完全相同的行为，更具可读性。Guido 会为你感到骄傲 :-)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-12-16T14:18:51.383

如果你的理解是[orestis 的答案](https://stackoverflow.com/a/311604/1887870)是好的。

对于更复杂的理解，我建议使用生成器`yield`：

```
allUuids = list(self.get_all_uuids())

def get_all_uuids(self):
    for x in self.db.query(schema.allPostsUuid).execute(timeout = 20):
        if x.type == "post" and x.deleted is not False:
            yield x.id 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-22T18:10:33.223

怎么样：

```
allUuids = [x.id for x in self.db.query(schema.allPostsUuid).execute(timeout = 20) 
                   if (x.type == "post" and x.deleted is not False)] 
```

通常，可以通过将子表达式预先计算到变量中来避免长行，这可能会增加很小的性能成本：

```
query_ids = self.db.query(schema.allPostsUuid).execute(timeout = 20)
allUuids = [x.id for x in query_ids
                   if (x.type == "post" and x.deleted is not False)] 
```

顺便说一句，' `is not False`'是不是有点多余？您是否担心区分 None 和 False ？因为否则，只需将条件保留为：i`f (x.type == "post" and x.deleted)`

# asp.net - 陷阱：从单台服务器升级到网络场

> ID：311596
> 
> 赞同：4
> 
> 时间：2008-11-22T18:13:25.807
> 
> 标签：asp.net, windows-server-2003, web-farm

我们公司目前运行两台 Windows 2003 服务器（一台 Web 服务器和一台 MSSQL 8 数据库服务器）。我们计划在网络场设置中添加另外几个服务器以实现冗余/可用性目的。我们的网站主要是 ASP.NET，我们确实有一些 PHP 网站，但这些网站主要是静态的，没有数据库。

经历过这个过程的人是否有任何我应该注意的问题或其他要点？并且使用 Windows Server 2008 会为这种情况提供任何额外的优势（这样我就可以说服我的老板升级 :) 吗？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T03:07:28.430

另一件需要注意的事情是您的部署计划。可悲的是，部署计划似乎被忽视和/或低估了。请记住，您正在部署到多个节点，并且您希望考虑如何以逻辑方式进行部署和测试。

例如，假设您的场中有四个节点。您是否将两个从集群中拉出并更新和测试，然后换出另外两个重复？确定您当前的部署过程是否符合您提供的答案。仅仅因为您拥有 X 倍的服务器数量并不意味着您想要或需要做 X 倍的工作量。

只是重新审视一下对话的缓存部分。您绝对应该看看分布式缓存解决方案。如果您正在预缓存数据并使用带有缓存删除的回调，如果您不小心，您真的可以对数据库造成冲击。此外，许多分布式缓存解决方案也提供了某种程度的会话状态管理。我一直非常喜欢微软的 Velocity 项目，尽管它只是第二个 CTP 版本，还没有准备好投入生产。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-22T18:19:24.313

如果您有动态负载平衡（即我的第一个请求发送到服务器 X，但我的下一个请求可能发送到服务器 Y 或 Z），您会发现 In-Proc Sessions 不起作用。因此，您要么需要粘性会话（您的负载平衡器将始终将我（=我的会话）发送到服务器 X）或进程外会话（即存储在 SQL Server 中）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-22T18:26:23.410

就像迈克尔说的那样，你需要照顾好你的会话。理想情况下，使其精益并存储在流程之外。根据您使用缓存的方式，您将面临类似的缓存挑战，并且如果您只使用 asp 缓存，您可能会对寻找更强大的缓存技术感兴趣。

不要忘记 web.config 中的机器密钥和验证等内容。machineKeys 需要在您的服务器中保持一致。

阅读 IIS7，你应该能够挑选出几个很好的例子来向你的老板炫耀。

网络场可以为您带来不容忽视的部署机遇和挑战。

对上述设置没有具体经验，但对这种一般动作没有经验。我建议分阶段采用这种方法。也就是说，先迁移到 Windows 2008，然后再进行农场。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T10:45:30.220

我们使用 ASP.NET 状态服务器来处理会话。Windows Server 2003/2008 免费提供。

然后我们必须确保机器密钥相同（您的 web.config 文件中的设置）。

然后，我手动使每个站点脱机（使用 app.offline 或任何调用的魔术文件）。或者，您可以使用 IIS 并关闭站点并“打开”离线站点。

就是这样。您可能会担心分布式缓存，但这是非常核心的东西。您可以从使用 ASP.NET 的默认输出缓存中获得很多好处。如果您要进行分布式缓存，我将从那里开始，然后再深入研究复杂性（以及某些产品的成本）。

哦，我们正在使用不执行粘性会话的 F5 负载平衡器，因此我们需要维护我们的会话……这就是我们使用 ASP.NET 状态服务器的原因。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T11:20:16.733

除了其他海报描述的会话问题之外，另一个问题是应用程序是否正在写入本地文件系统。如果应用程序假定文件位于本地 PC 上，则扩展到网络场会破坏应用程序。例如，上传的文件可能可用或不可用，具体取决于命中的服务器。将路径更改为指向共享驱动器应该可以解决此问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-22T19:51:26.640

除了其他人所说的之外，您可能还需要考虑研究 Richard Campbell 的（.NET Rocks！）产品：

[http://www.strangeloopnetworks.com/](http://www.strangeloopnetworks.com/)

# java - 如何在混合 Java 版本的世界中使用泛型？

> ID：311599
> 
> 赞同：4
> 
> 时间：2008-11-22T18:17:55.207
> 
> 标签：java, generics, jvm, portability

我非常喜欢泛型，并尽可能使用它们。时不时地，我需要在另一个项目中使用我的一个类，该项目必须在旧 JVM（5.0 之前）上运行，需要在 JavaME（也不允许泛型）或 Microsoft J#（非常差）上运行支持泛型）。

目前，我手动删除了所有泛型，这意味着也插入了许多强制转换。

由于泛型被认为是仅编译时的，并且每段泛型代码都可能自动转换为非泛型代码，我想知道是否有任何工具可以为我做到这一点。

如果没有这样的工具，我还能如何解决这个问题？我应该完全停止使用泛型吗？

已经有与*字节码兼容性*相关的答案。如果我出于某种原因需要*源代码兼容性怎么办？*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T20:07:57.573

你需要使用像[Retroweaver](http://retroweaver.sourceforge.net/)这样的东西来实现这种事情。这个问题的其他答案有点误导。泛型是一种与以前版本兼容的字节码，但并不完全兼容（看看`java.lang.reflect.Type`你是否不相信我）。此外，字节码版本属性存在问题，这将阻止针对 1.5 编译的类在以前的版本上运行。Retroweaver 解决了这两个问题，同时还启用了其他 Java 5 特性，如注解和枚举。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T18:31:28.783

在 Netbeans（我不确定您使用的是什么 IDE）中，您可以将源代码兼容性设置为一组 java 版本 - 只需将其设置为支持泛型的版本。正如已经发布的那样，泛型是与旧 JVM / JRE 版本兼容的字节码，因此它应该可以开箱即用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T20:07:10.353

据我所知，Java 5 的字节码与 Java 1.4*不兼容。*也就是说，您不能将 Java 5 编译的类与早期的 VM 一起使用。

你可以检查逆向编织。这在引入泛型时被提到了很多。我个人没有这方面的经验。

你问谷歌了吗？我的搜索出现了[http://www.publicobject.com/glazedlists/documentation/Generics_and_Java_1.4_with_one_codebase.pdf](http://www.publicobject.com/glazedlists/documentation/Generics_and_Java_1.4_with_one_codebase.pdf)，这似乎是一个非常有趣的方法。

* * *

## 回答 #4

> 赞同：-5
> 
> 时间：2008-11-22T18:27:50.473

它的字节码兼容，它应该可以使用旧的解释器开箱即用。

# python - python 作为“批处理”脚本（即从 python 运行命令）

> ID：311601
> 
> 赞同：14
> 
> 时间：2008-11-22T18:18:58.760
> 
> 标签：python, scripting, batch-file

我在 Windows 环境中工作（我的笔记本电脑！），我需要一些运行其他程序的脚本，就像 Windows 批处理文件一样。

如何从 python 运行命令，以便程序在运行时替换脚本？该程序是交互式的（例如，统一），并且一直打印行并要求用户输入。

所以，仅仅运行一个程序并打印输出是不够的。该程序必须接管脚本的输入/输出，就像从 .bat 文件运行命令一样。

我试过 os.execl 但它一直告诉我“无效参数”，而且它没有找到程序名称（不搜索 PATH 变量）；我必须给它完整的路径..？！

基本上，我可以在批处理脚本中编写： unison profile

我怎样才能在python中达到同样的效果？

编辑：

我发现它可以完成，`os.system( ... )`因为我不能接受自己的答案，所以我要结束这个问题。

* * *

编辑：这应该是一个评论，但是当我发布它时，我没有太多的观点。

谢谢克劳迪乌，这几乎就是我想要的，除了一点点：我希望函数在程序退出时结束，但是当我统一尝试时，它不会将控制权返回给 python 脚本，而是返回给 windows命令行环境

```
>>> os.execlp("unison")

C:\>Usage: unison [options]
    or unison root1 root2 [options]
    or unison profilename [options]

For a list of options, type "unison -help".
For a tutorial on basic usage, type "unison -doc tutorial".
For other documentation, type "unison -doc topics".

C:\>
C:\>
C:\> 
```

如何解决这个问题？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-22T18:25:47.263

[您应该使用subprocess 模块](http://www.python.org/doc/2.5.2/lib/module-subprocess.html)创建一个新进程。

我不熟悉 Windows 进程，但它的 Popen 功能是跨平台的，应该优先使用操作系统特定的解决方案。

编辑：我认为您应该更喜欢 Subprocess 模块而不是 os.* OS 特定功能，它是跨平台的并且更 Pythonic（只需谷歌它）。*您可以轻松、干净地*等待结果：

```
import os
import subprocess
unison = os.path.join(os.path.curdir, "unison")
p = subprocess.Popen(unison)
p.wait() 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-22T18:57:17.747

我发现 os.system 做了我想要的，

感谢所有试图提供帮助的人。

```
os.system("dir") 
```

就像从批处理文件运行命令一样运行命令

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-22T18:31:57.313

```
import subprocess

proc = subprocess.Popen(['unison', 'profile'], stderr=subprocess.PIPE,      
                        stdout=subprocess.PIPE, stdin=subprocess.PIPE)

proc.stdin.write('user input')
print proc.stdout.read() 
```

这应该可以帮助您入门。如果您想要更详细的答案，请使用更多信息编辑您的问题！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-22T18:26:42.520

`os.execlp`应该管用。这将在您的路径中搜索命令。如果没有必要，不要给它任何参数：

```
>>> import os
>>> os.execlp("cmd")

D:\Documents and Settings\Claudiu>Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

D:\Documents and Settings\Claudiu> 
```

# xml - 将 XML 作为（只读）人类可读数据源用于调查问题

> ID：311602
> 
> 赞同：1
> 
> 时间：2008-11-22T18:19:06.623
> 
> 标签：xml, database, survey

科学或市场调查问卷主要由以下形式的问题组成：

*简介：*表明您对以下陈述的同意程度...

*选项：*非常 - 相当 - 一般 - 而不是 - 一点也不

*第 1项*：我喜欢可口可乐

...

项目 n: ...

让我们称整个事情为*SCALE*。一个量表由几个项目组成，有一个介绍，有一定数量的选项。该数据库具有表'intro'、'option'、'items'和'scale'以及必要的外键。通过适当的查询，我选择此信息并将它们注入表单视图以显示我的问卷规模。

只要没有非技术第三方必须编辑这些音阶，就可以了。最近我想到了一种替代方法。**我认为可以将 XML 文件用于比例尺**，其中包含所有前面提到的数据，包括翻译。

我知道 XML 是一种传输方式而不是数据存储，我知道查询 XML 并不像使用 SQL 对数据库那么容易……但是第三方呢？我是否应该为他们开发一个后端，他们可以在其中编辑问题？你对此有何看法？您是否知道另一种存储调查问题（量表）的方法？

**迄今为止的总结**：好的，似乎编辑界面是更好的解决方案。任何人都可以写一些关于XML**速度问题的东西......**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T20:51:38.547

最好的方法是为非技术第三方构建简单的后端。

非技术用户在编辑 XML 文件时可能会遇到问题，在他们编辑文件后如何检查文件格式是否正确？您的软件必须检查输入并吐出有意义的错误消息，这意味着无论如何您都将编写一个基本的后端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T18:24:16.970

您是否已经看过 MS InfoPath？这正是他们正在做的事情，而且效果很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T13:09:15.047

就表示而言，XSLT（用于转换的 XML 样式表）可以将文档转换为“可表示的”界面。但是，您仍然需要一种机制来捕获和存储结果。但是，如果它是 XML 格式的，那么即使不使用 XSL，您也可以在其前面放置几乎任何可以想象的接口。

与关系数据库相比，XML 方法的一个优点是您可以提供内置的可变性。我已经建立了一些这样的系统，想出一个健全的数据库结构，也可以处理调查结构和数据的可变性是很困难的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T08:29:15.067

通过后端（这是正确的术语吗？）比每次更改时解析配置文件（基本上是您的 xml 文件）更简单。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T09:32:59.100

如果您希望它使用 XML，那么我建议您查看 Interactive Schema Interpreter ( [http://sourceforge.net/projects/interactive/](http://sourceforge.net/projects/interactive/) )。

# javascript - 如何确定该函数是其方法的对象？

> ID：311605
> 
> 赞同：1
> 
> 时间：2008-11-22T18:19:55.310
> 
> 标签：javascript

```
var A = {
    x : function () { }
};

var b = function (method) {
    //want to know method's "parent" here
};

b(A.x); 
```

我想知道当我调用 b(Ax) 时 x 是在 A 中定义的。这可能吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-22T18:26:56.247

没有很好的内置方法可以做到这一点，因为实际上 Javascript 中没有方法。它们是独立的 Function 对象，恰好被分配到某个地方。

如果您每次都创建新的函数实例（例如闭包）*[感谢 Matthew Crumley 指出]*，那么您可以修改函数对象以将其与其父对象显式关联：

```
x.parent = A; 
```

然后你可以像调用方法一样正确调用它：

```
x.call(x.parent); 
```

否则，您将必须同时传递函数及其父对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T06:34:45.360

即使添加父属性也不是在所有情况下都有效，因为如果函数在对象的原型中，则函数对象只有一个副本，因此无法判断它来自哪个实例。这是一个显示问题的示例：

```
function MyClass() {
    // Create a MyClass object
}
MyClass.prototype.x = function() { return 42; };

var a = new MyClass();
a.x.parent = a; // Set the parent to a

var b = new MyClass();
b.x.parent = b; // b.x and a.x both reference the same function from MyClass.prototype 
```

现在，`a.x.parent`和`b.x.parent`都设置为 b。

只要每个对象都有自己的函数副本，@porneL 的方法就可以工作。

**修改函数以获取父对象和方法可能会更好，这样它就可以与任何函数一起使用。**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T19:23:58.537

从语言的角度来看，这个问题没有什么意义，因为许多对象上可能存在一个函数。

```
var a = { name : 'a' },
    b = { name : 'b' },
    c = { name : 'c' }; 
a.x = function () { alert( this.name ); };
c.x = b.x = a.x;  // a, b, and c all reference the same function 
```

`x`您可以使用所需的任何上下文调用该函数：

```
a.x(); // alerts "a" because "this" is object a 
b.x(); // alerts "b" because "this" is object b 
a.x.call( b ); // alerts "b" because "this" is object b (via parameter) 
```

您可以操纵此行为为您工作：

```
var b = function ( method ) {
  // parent = this;
};
b.call( A, A.x ); 
```

然而，没有任何方法可以从函数内部知道它被分配给了什么对象，因为这不一定是一个地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T18:32:24.257

[JavaScript 中的每个函数实际上都是一个 Function 对象。](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function)

```
<html>
<body>
<script>
var A = {
    x: function (a_a, a_b) { alert(a_a + a_b);  }
};

var b = function (a_method) {
    alert(a_method.toString());
    a_method.call(this, 1, 2);
};

b(A.x);
</script> 
```

# class-design - 什么构成 POJO/POCO 中的富域模型？

> ID：311608
> 
> 赞同：4
> 
> 时间：2008-11-22T18:22:16.227
> 
> 标签：class-design, poco, modeling, pojo

和有什么区别

*   一个简单*的fields-accessors-mutators*类
*   丰富的模型类

什么构成业务领域类中的丰富建模？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T19:56:00.513

这里使用的“丰富”意味着“丰富的行为”（与状态相反）。

有技术行为和领域行为。*访问*器和*突变器*是技术性的；他们缺乏定义商业利益的“为什么”。

领域对象代表“为什么”并封装“如何”。实际上，所有对象都这样做。领域对象专门为商业价值而做。

假设您作为员工域对象，必须请假一天。您有 2 个选项：

1.  告诉你的经理，他会标记时间表。
2.  向您的经理询问时间表并标记它。

模型 1 很丰富。“为什么”（休假时间）封装了“如何”（标记日程）。

模型 2 将管理器降级为一个简单的属性包，并泄露了调度抽象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T18:24:41.743

当您的业务逻辑封装在您的业务对象中时。换句话说，您有一个业务对象（域模型）层，而不需要单独的业务逻辑层。

# python - 意外覆盖 OSX Python 系统框架

> ID：311621
> 
> 赞同：2
> 
> 时间：2008-11-22T18:30:35.883
> 
> 标签：python, macos, frameworks, osx-leopard

我领先一步，在我的 OSX 10.5.5 Intel Mac 上从 www.python.org/download/ 下载并安装了 OSX Python 2.6 包，并安装了完整的包内容。只有在此之后，我才遇到[http://wiki.python.org/moin/MacPython/Leopard](http://wiki.python.org/moin/MacPython/Leopard)指出您应该对软件包进行部分安装以避免干扰系统安装。

恐怕我已经通过该安装程序覆盖了系统框架，我记得在发现这一点后在某处阅读过，我会丢失 OSX 系统安装中包含的某些元素，而不是 Python 发行版。

有什么办法可以扭转这种情况或恢复我可能丢失的任何东西吗？我到底失去了什么，这会是个问题吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T19:37:33.470

您可能已经覆盖了系统框架，但更有可能您只是覆盖了符号链接`/usr/bin`以指向新版本。试着去`/usr/bin`看看（用类似的东西`ls -alsh`）`python`符号链接指向的地方。它可能是`python2.6`or `3.0`，这又是一个 ln`/System/Library/Frameworks/Python.framework/Versions ...`等。首先尝试将 python 符号链接重置为稳定或预期的版本，即`sudo ln -s /usr/bin/python2.5 python`（来自`/usr/bin`目录。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-07T16:28:31.273

我自己也遇到了同样的事情。我确实发现 MacPython 安装程序修改了我的搜索 $PATH 并添加了“/Library/Frameworks/Python.framework/Versions/Current/bin”，这导致在“/usr/bin”中的可执行文件之前找到了 python 可执行文件。

希望这对其他人有帮助！

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-22T18:52:07.600

从最近的 Time Machine 备份或以某种方式从 DVD 恢复？

# c# - 如何使用存储库设计模式更新创建和修改的字段？

> ID：311625
> 
> 赞同：1
> 
> 时间：2008-11-22T18:34:16.217
> 
> 标签：c#, asp.net-mvc, repository-design

我目前正在开发我的**第一个**asp.net mvc 应用程序。我正在尝试从我看到的所有示例项目中汲取灵感，并尝试使用**存储库设计模式**。

我有一个名为 IUserRepository 的接口，如下所示：

```
public interface IUserRepository
{
    IUser Add(IUser user);
    IQueryable<IUser> Fetch();
    IUser Update(IUser obj);
    void Delete(IUser obj);
} 
```

我的 IUser 界面有一堆属性和 CreatedBy、CreatedDate、ModifiedBy 和 ModifiedDate 的属性。

我的 UserRepository 如下所示：

```
public class UserRepository : IUserRepository
{
    private GimliDataContext db = null;

    public UserRepository()
    {
        db = new GimliDataContext();
    }

    public UserRepository(string connection)
    {
        db = new GimliDataContext(connection);
    }

    public IUser Add(IUser obj)
    {
        db.Users.InsertOnSubmit((User)obj);
        db.SubmitChanges();
        return obj;
    }

    public IQueryable<IUser> Fetch()
    {
        return db.Users.Select(b => b as IUser);
    }

    public IUser Update(IUser obj)
    {
        var user = db.Users.Where(u => u.UserId == obj.UserId).Single();
        user.Name = obj.Name;
        user.Password = obj.Password;
        user.Email = obj.Email;
        user.IsLocked = obj.IsLocked;
        user.IsDisabled = obj.IsDisabled;
        db.SubmitChanges();
        return user;
    }

    public void Delete(IUser obj)
    {
        var user = db.Users.Where(u => u.UserId == obj.UserId).Single();
        db.Users.DeleteOnSubmit(user);
        db.SubmitChanges();
    }
} 
```

在我当前的 Web 应用程序中，当我的用户登录时，我将我的客户业务主体存储在当前线程上，当我的业务对象更新时，我只使用当前业务主体的 Identity 属性上的 Name 属性，它工作得很好。

那么我的问题是什么？我应该在我的存储库的 Add 或 Update 方法中做同样的事情，还是实际上将 IUser 引用传递给当前 User 并从那里获取 UserId 会更好？

感谢任何输入！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T19:44:34.000

首先，我建议使您的存储库接口通用。而不是你的 IUserRepository 试试这个：

```
public interface IRepository<T>
{
    T Add(T entity);
    IQueryable<T> Fetch();
    T Update(T entity);
    void Delete(T entity);
} 
```

这样您就可以将此接口用于您的任何域模型。

就您的问题而言（CreadedBy 和 ModifiedBy 道具），就个人而言，这听起来像是业务逻辑，并且更适合在 Service 类中使用。但我会像你第一次说的那样做。获取当前已认证用户的用户 id 并将其放入其中，而不是传入另一个 IUser 来获取其 ID。但是，如果它在服务中，您就可以模拟不同的服务进行单元测试，而无需实际登录系统（让模拟的服务提供模拟 IUser）。

我自己对此有点陌生，所以如果有更好的建议，我也想了解一下。

# refactoring - Duck 类型作为反射的语法糖：好主意还是坏主意？

> ID：311626
> 
> 赞同：2
> 
> 时间：2008-11-22T18:34:53.410
> 
> 标签：refactoring, language-design, syntactic-sugar, duck-typing

我最近一直在想，在 Java 和 C# 等语言中，将“鸭子”类型作为方法参数类型包含在内是否是一种很好的语法糖形式？这将如下所示：

```
void myFunction(duck foo) {
   foo.doStuff();
} 
```

这可能是通过反射调用 doStuff() 的语法糖，或者它可以以不同的方式实现。Foo 可以是任何类型。如果 foo 没有 doStuff() 方法，这将引发运行时异常。关键是，当您需要时，即大多数时候，您将获得更严格的预先指定的接口范例（性能、错误检查）的好处。同时，您将拥有一个简单、干净的后门来避免打字，这将允许您干净地进行初始设计中未预见到的更改，而无需进行大量重构。此外，它可能会 100% 向后兼容，并与现有的语言结构完美结合。我认为这可能有助于减少过度设计的以防万一的编程风格，这种风格会导致混乱、混乱的 API。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T18:41:26.140

该`dynamic`关键字支持这些确切的语义并将在 C# 4.0 中。

不过，这不仅仅是为了反思。它是[动态调度](http://en.wikipedia.org/wiki/Dynamic_dispatch)的一种实现，只有在没有其他机制可用时才使用反射。

[这个问题](https://stackoverflow.com/questions/244302/what-do-you-think-of-the-new-c-40-dynamic-keyword)也有很多很好的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T18:41:56.967

实际上，这非常类似于将成为 C#4 一部分的“动态”类型。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T18:58:13.907

我的简短回答是“是的，Duck Typing 在 OO 语言中将是一个有用的工具。C# 团队同意，并将其放入 C# 4.0”

长答案：

Duck Typing 有其优点和缺点......有很多人完全发誓，但我会告诉你：有一些非常令人信服的理由将 Duck Typing 用于无法很好解决的事情任何其他情况。

请参阅我在使用 Dictionary 而不是 IDictionary 的界面上发布的帖子，Duck Typing 可以节省一天的时间：

[http://www.houseofbilz.com/archive/2008/09/22/why-you-really-need-to-think-about-your-interfaces.aspx](http://www.houseofbilz.com/archive/2008/09/22/why-you-really-need-to-think-about-your-interfaces.aspx)

C# 从 1.0 开始就内置了一些鸭子类型！以 foreach 关键字为例。一个常见的误解是，您的类型需要是 IEnumerable 才能在 foreach 循环中使用对象。事实证明，事实并非如此。您只需要实现 GetEnumerator() 并且不需要实现接口（尽管它是很好的形式）。这是鸭子打字。

# python - 如何以常规格式打印日期？

> ID：311627
> 
> 赞同：768
> 
> 时间：2008-11-22T18:37:07.927
> 
> 标签：python, datetime, date

这是我的代码：

```
import datetime
today = datetime.date.today()
print(today) 
```

这打印：`2008-11-22`这正是我想要的。

但是，我有一个要附加的列表，然后突然间一切都变得“古怪”。这是代码：

```
import datetime
mylist = []
today = datetime.date.today()
mylist.append(today)
print(mylist) 
```

这将打印以下内容：

```
[datetime.date(2008, 11, 22)] 
```

我怎样才能得到一个简单的日期`2008-11-22`？

* * *

## 回答 #1

> 赞同：1047
> 
> 时间：2008-11-22T19:07:07.570

## 为什么：日期是对象

在 Python 中，日期是对象。因此，当您操作它们时，您操作的是对象，而不是字符串或时间戳。

Python 中的任何对象都有两种字符串表示形式：

*   使用的正则表示`print`可以使用该`str()`函数获得。大多数情况下，它是最常见的人类可读格式，用于简化显示。所以`str(datetime.datetime(2008, 11, 22, 19, 53, 42))`给你`'2008-11-22 19:53:42'`。

*   用于表示对象性质（作为数据）的替代表示。它可以使用该`repr()`功能获得，并且可以方便地了解您在开发或调试时操作的数据类型。`repr(datetime.datetime(2008, 11, 22, 19, 53, 42))`给你`'datetime.datetime(2008, 11, 22, 19, 53, 42)'`。

发生的事情是，当您使用 打印日期时`print`，它使用了，`str()`因此您可以看到一个不错的日期字符串。但是当您打印 时`mylist`，您已经打印了一个对象列表，Python 尝试使用 来表示数据集`repr()`。

## The How：你想用它做什么？

好吧，当您操作日期时，请一直使用日期对象。他们获得了数千种有用的方法，并且大多数 Python API 都期望日期是对象。

当您想要显示它们时，只需使用`str()`. 在 Python 中，好的做法是显式转换所有内容。因此，就在需要打印的时候，使用`str(date)`.

最后一件事。当您尝试打印日期时，您打印了`mylist`. 如果要打印日期，则必须打印日期对象，而不是它们的容器（列表）。

例如，您想打印列表中的所有日期：

```
for date in mylist :
    print str(date) 
```

请注意，***在这种特定情况下***，您甚至可以省略`str()`，因为 print 会为您使用它。但这不应该成为一种习惯:-)

## 实际案例，使用您的代码

```
import datetime
mylist = []
today = datetime.date.today()
mylist.append(today)
print mylist[0] # print the date object, not the container ;-)
2008-11-22

# It's better to always use str() because :

print "This is a new day : ", mylist[0] # will work
>>> This is a new day : 2008-11-22

print "This is a new day : " + mylist[0] # will crash
>>> cannot concatenate 'str' and 'datetime.date' objects

print "This is a new day : " + str(mylist[0]) 
>>> This is a new day : 2008-11-22 
```

## 高级日期格式

日期具有默认表示，但您可能希望以特定格式打印它们。`strftime()`在这种情况下，您可以使用该方法获取自定义字符串表示。

`strftime()`需要一个字符串模式来解释您希望如何格式化您的日期。

例如：

```
print today.strftime('We are the %d, %b %Y')
>>> 'We are the 22, Nov 2008' 
```

a 后面的所有字母都`"%"`代表某种格式：

*   `%d`是天数（2 位数字，必要时以前导零为前缀）
*   `%m`是月份编号（2 位数字，必要时以前导零为前缀）
*   `%b`是月份的缩写（3 个字母）
*   `%B`是完整的月份名称（字母）
*   `%y`是年份数字的缩写（最后 2 位数字）
*   `%Y`是完整的年份编号（4 位数字）

等等

[看看官方文档](http://docs.python.org/2/library/datetime.html#strftime-and-strptime-behavior)，或者[McCutchen 的快速参考](http://strftime.org)，你不可能全部都知道。

从[PEP3101 开始](http://www.python.org/dev/peps/pep-3101/)，每个对象都可以有自己的格式，由任何字符串的方法格式自动使用。对于日期时间，格式与 strftime 中使用的格式相同。所以你可以像上面一样做：

```
print "We are the {:%d, %b %Y}".format(today)
>>> 'We are the 22, Nov 2008' 
```

这种形式的优点是还可以同时转换其他对象。
随着[格式化字符串文字](https://docs.python.org/3/reference/lexical_analysis.html#formatted-string-literals)的引入（自 Python 3.6，2016-12-23 起），这可以写成

```
import datetime
f"{datetime.datetime.now():%Y-%m-%d}"
>>> '2017-06-15' 
```

## 本土化

如果您以正确的方式使用日期，日期可以自动适应当地的语言和文化，但这有点复杂。也许关于SO（堆栈溢出）的另一个问题;-)

* * *

## 回答 #2

> 赞同：394
> 
> 时间：2013-01-14T14:46:28.873

```
import datetime
print datetime.datetime.now().strftime("%Y-%m-%d %H:%M") 
```

**编辑：**

在[Cees 的建议](https://stackoverflow.com/a/20066760/7487335)之后，我也开始使用时间：

```
import time
print time.strftime("%Y-%m-%d %H:%M") 
```

* * *

## 回答 #3

> 赞同：190
> 
> 时间：2013-09-22T14:26:14.217

、和对象都支持一种方法`date`，在显式格式字符串的控制下创建表示时间的字符串。`datetime``time``strftime(format)`

这是格式代码及其指令和含义的列表。

```
%a  Locale’s abbreviated weekday name.
%A  Locale’s full weekday name.      
%b  Locale’s abbreviated month name.     
%B  Locale’s full month name.
%c  Locale’s appropriate date and time representation.   
%d  Day of the month as a decimal number [01,31].    
%f  Microsecond as a decimal number [0,999999], zero-padded on the left
%H  Hour (24-hour clock) as a decimal number [00,23].    
%I  Hour (12-hour clock) as a decimal number [01,12].    
%j  Day of the year as a decimal number [001,366].   
%m  Month as a decimal number [01,12].   
%M  Minute as a decimal number [00,59].      
%p  Locale’s equivalent of either AM or PM.
%S  Second as a decimal number [00,61].
%U  Week number of the year (Sunday as the first day of the week)
%w  Weekday as a decimal number [0(Sunday),6].   
%W  Week number of the year (Monday as the first day of the week)
%x  Locale’s appropriate date representation.    
%X  Locale’s appropriate time representation.    
%y  Year without century as a decimal number [00,99].    
%Y  Year with century as a decimal number.   
%z  UTC offset in the form +HHMM or -HHMM.
%Z  Time zone name (empty string if the object is naive).    
%%  A literal '%' character. 
```

这就是我们可以用 Python 中的 datetime 和 time 模块做的事情

```
import time
import datetime

print "Time in seconds since the epoch: %s" %time.time()
print "Current date and time: ", datetime.datetime.now()
print "Or like this: ", datetime.datetime.now().strftime("%y-%m-%d-%H-%M")

print "Current year: ", datetime.date.today().strftime("%Y")
print "Month of year: ", datetime.date.today().strftime("%B")
print "Week number of the year: ", datetime.date.today().strftime("%W")
print "Weekday of the week: ", datetime.date.today().strftime("%w")
print "Day of year: ", datetime.date.today().strftime("%j")
print "Day of the month : ", datetime.date.today().strftime("%d")
print "Day of week: ", datetime.date.today().strftime("%A") 
```

这将打印出如下内容：

```
Time in seconds since the epoch:    1349271346.46
Current date and time:              2012-10-03 15:35:46.461491
Or like this:                       12-10-03-15-35
Current year:                       2012
Month of year:                      October
Week number of the year:            40
Weekday of the week:                3
Day of year:                        277
Day of the month :                  03
Day of week:                        Wednesday 
```

* * *

## 回答 #4

> 赞同：76
> 
> 时间：2008-11-22T18:56:08.013

使用 date.strftime。格式参数[在文档中描述](https://docs.python.org/2/library/time.html#time.strftime)。

这就是你想要的：

```
some_date.strftime('%Y-%m-%d') 
```

这个考虑了语言环境。（做这个）

```
some_date.strftime('%c') 
```

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2013-11-19T08:39:04.913

这更短：

```
>>> import time
>>> time.strftime("%Y-%m-%d %H:%M")
'2013-11-19 09:38' 
```

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2016-10-06T08:24:34.090

```
# convert date time to regular format.

d_date = datetime.datetime.now()
reg_format_date = d_date.strftime("%Y-%m-%d %I:%M:%S %p")
print(reg_format_date)

# some other date formats.
reg_format_date = d_date.strftime("%d %B %Y %I:%M:%S %p")
print(reg_format_date)
reg_format_date = d_date.strftime("%Y-%m-%d %H:%M:%S")
print(reg_format_date) 
```

> 输出

```
2016-10-06 01:21:34 PM
06 October 2016 01:21:34 PM
2016-10-06 13:21:34 
```

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2013-12-25T21:37:07.100

甚至

```
from datetime import datetime, date

"{:%d.%m.%Y}".format(datetime.now()) 
```

出：'25.12.2013

或者

```
"{} - {:%d.%m.%Y}".format("Today", datetime.now()) 
```

出：“今天 - 2013 年 12 月 25 日”

```
"{:%A}".format(date.today()) 
```

出：“星期三”

```
'{}__{:%Y.%m.%d__%H-%M}.log'.format(__name__, datetime.now()) 
```

出：'__main____2014.06.09__16-56.log'

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2015-02-01T13:23:22.740

简单的回答——

```
datetime.date.today().isoformat() 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2017-06-15T13:07:26.460

[在格式化字符串文字](https://docs.python.org/3/reference/lexical_analysis.html#formatted-string-literals)中使用特定于类型的[`datetime`](https://docs.python.org/3/library/datetime.html)字符串格式化（使用.参见[nk9 的答案](https://stackoverflow.com/a/20776958/1619432)） （自 Python 3.6，2016-12-23 起）：[`str.format()`](https://docs.python.org/3/library/stdtypes.html#str.format)

```
>>> import datetime
>>> f"{datetime.datetime.now():%Y-%m-%d}"
'2017-06-15' 
```

日期/时间格式指令没有记录为[格式字符串语法](https://docs.python.org/3/library/string.html#formatstrings)的一部分，而是记录在`date`、`datetime`和`time`的[`strftime()`](https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior)文档中。它们基于 1989 C 标准，但包括自 Python 3.6 以来的一些 ISO 8601 指令。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-11-22T18:45:00.673

您需要将`datetime`对象转换为`str`.

以下代码对我有用：

```
import datetime

collection = []
dateTimeString = str(datetime.date.today())
collection.append(dateTimeString)

print(collection) 
```

如果您需要更多帮助，请告诉我。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2015-04-13T07:47:02.830

我讨厌为了方便而导入太多模块的想法。我宁愿使用可用的模块，在这种情况下，`datetime`而不是调用一个新的模块`time`。

```
>>> a = datetime.datetime(2015, 04, 01, 11, 23, 22)
>>> a.strftime('%Y-%m-%d %H:%M')
'2015-04-01 11:23' 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-11-22T18:46:05.617

你可以做：

```
mylist.append(str(today)) 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2018-09-03T14:10:43.847

考虑到您要求做一些简单的事情来做您想做的事情，您可以：

```
import datetime
str(datetime.date.today()) 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2019-07-11T18:13:23.473

对于那些想要**基于区域设置的**日期而不包括时间的人，请使用：

```
>>> some_date.strftime('%x')
07/11/2019 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-11-22T18:45:26.663

您可能想将其附加为字符串？

```
import datetime

mylist = []
today = str(datetime.date.today())
mylist.append(today)

print(mylist) 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2014-11-18T08:17:00.577

由于`print today`返回你想要的，这意味着今天对象的`__str__`函数返回你正在寻找的字符串。

所以你也可以这样做`mylist.append(today.__str__())`。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2018-06-23T06:37:32.980

```
from datetime import date

def today_in_str_format():
    return str(date.today())

print (today_in_str_format()) 
```

`2018-06-23`如果这是您想要的，这将打印出来:)

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2021-11-29T09:56:59.113

在 Python 中，您可以使用模块中的,和类中的`strftime()`方法来格式化日期时间。`date``time``datetime``datetime`

在您的特定情况下，您正在使用`date`来自`datetime`. 您可以使用以下代码段将`today` 变量格式化为格式为的字符串`yyyy-MM-dd`：

```
import datetime

today = datetime.date.today()
print("formatted datetime: %s" % today.strftime("%Y-%m-%d")) 
```

下面是一个更完整的例子：

```
import datetime
today = datetime.date.today()

# datetime in d/m/Y H:M:S format
date_time = today.strftime("%d/%m/%Y, %H:%M:%S")
print("datetime: %s" % date_time)

# datetime in Y-m-d H:M:S format
date_time = today.strftime("%Y-%m-%d, %H:%M:%S")
print("datetime: %s" % date_time)

# format date
date = today.strftime("%d/%m/%Y")
print("date: %s" % time)

# format time
time = today.strftime("%H:%M:%S")
print("time: %s" % time)

# day
day = today.strftime("%d")
print("day: %s" % day)

# month
month = today.strftime("%m")
print("month: %s" % month)

# year
year = today.strftime("%Y")
print("year: %s" % year) 
```

更多指令：

[![来自 1989 C 标准的 Python strftime 指令](https://i.stack.imgur.com/bOPCe.jpg)](https://i.stack.imgur.com/bOPCe.jpg)

资料来源：

*   [在 Python 中格式化日期时间](https://www.polynique.com/coding/format-datetime-in-python/)
*   [时间](https://docs.python.org/3/library/datetime.html?highlight=strftime#datetime.datetime.strftime)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-03-21T04:21:22.870

我的答案的快速免责声明 - 我只学习 Python 大约 2 周，所以我绝不是专家；因此，我的解释可能不是最好的，我可能会使用不正确的术语。无论如何，它来了。

我在您的代码中注意到，当您声明变量时，`today = datetime.date.today()`您选择使用内置函数的名称来命名变量。

当您的下一行代码`mylist.append(today)`附加您的列表时，它附加了整个 string `datetime.date.today()`，您之前将其设置为`today`变量的值，而不仅仅是附加`today()`.

一个简单的解决方案（尽管可能不是大多数编码人员在使用 datetime 模块时会使用的）是更改变量的名称。

这是我尝试过的：

```
import datetime
mylist = []
present = datetime.date.today()
mylist.append(present)
print present 
```

它打印出来`yyyy-mm-dd`。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-05-10T05:32:55.987

您可以使用[easy_date](https://github.com/ralphavalon/easy_date)来简化：

```
import date_converter
my_date = date_converter.date_to_string(today, '%Y-%m-%d') 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2016-06-18T23:19:40.940

以下是将日期显示为（年/月/日）的方法：

```
from datetime import datetime
now = datetime.now()

print '%s/%s/%s' % (now.year, now.month, now.day) 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-06-22T05:26:45.913

```
import datetime
import time

months = ["Unknown","January","Febuary","Marchh","April","May","June","July","August","September","October","November","December"]
datetimeWrite = (time.strftime("%d-%m-%Y "))
date = time.strftime("%d")
month= time.strftime("%m")
choices = {'01': 'Jan', '02':'Feb','03':'Mar','04':'Apr','05':'May','06': 'Jun','07':'Jul','08':'Aug','09':'Sep','10':'Oct','11':'Nov','12':'Dec'}
result = choices.get(month, 'default')
year = time.strftime("%Y")
Date = date+"-"+result+"-"+year
print Date 
```

通过这种方式，您可以获得像以下示例一样格式化的日期：22-Jun-2017

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2022-02-28T09:57:51.747

对于[pandas.Timestamp](https://pandas.pydata.org/docs/reference/api/pandas.Timestamp.html)，可以使用[strftime()例如：](https://pandas.pydata.org/docs/reference/api/pandas.Timestamp.strftime.html#pandas.Timestamp.strftime)

```
utc_now = datetime.now() 
```

对于等格式：

```
utc_now.isoformat() 
```

[对于任何格式，](https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior)例如：

```
utc_now.strftime("%m/%d/%Y, %H:%M:%S") 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2018-10-07T06:17:50.103

我不完全理解，但可以`pandas`用于以正确的格式获取时间：

```
>>> import pandas as pd
>>> pd.to_datetime('now')
Timestamp('2018-10-07 06:03:30')
>>> print(pd.to_datetime('now'))
2018-10-07 06:03:47
>>> pd.to_datetime('now').date()
datetime.date(2018, 10, 7)
>>> print(pd.to_datetime('now').date())
2018-10-07
>>> 
```

和：

```
>>> l=[]
>>> l.append(pd.to_datetime('now').date())
>>> l
[datetime.date(2018, 10, 7)]
>>> map(str,l)
<map object at 0x0000005F67CCDF98>
>>> list(map(str,l))
['2018-10-07'] 
```

但它存储字符串但易于转换：

```
>>> l=list(map(str,l))
>>> list(map(pd.to_datetime,l))
[Timestamp('2018-10-07 00:00:00')] 
```

# nhibernate - 如何在我的 API 中处理多对多关系

> ID：311630
> 
> 赞同：2
> 
> 时间：2008-11-22T18:39:57.300
> 
> 标签：nhibernate, api, many-to-many, entity, entity-relationship

我有两个实体 Foo 和 Bar，它们之间存在多对多关系。

假设对于为什么 Foo 可能对多对多关系“负责”没有语义论据，但是我们任意决定 Foo 负责该关系（即，在 NHibernate 中，我们将 Bar 标记为 Inverse）

从数据库的角度来看，这一切都很好，但是我的实体 API 揭示了一个问题。

```
 // Responsible for the relation
    public class Foo
    {
        List<Bar> Bars = new List<Bar>();

        public void AddBar(Bar bar)
        {
            Bars.Add(bar);
            bar.AddFoo(this);
        }
    }

    public class Bar
    {
        List<Foo> Foos = new List<Foo>();

        // This shouldn't exist.
        public void AddFoo(Foo foo)
        {
            Foos.Add(foo);
            foo.AddBar(this); // Inf Recursion
        }
    } 
```

如果我们决定 Foo 负责这种关系，我如何在不创建甚至不应该存在的公共 Bar.AddFoo() 方法的情况下更新 Bar 中的关联集合？

我觉得我应该能够保持我的域模型的完整性，而不必在这样的操作之后从数据库中重新加载这些实体。

更新：受评论者启发的代码调整。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T19:49:10.107

您可能在那里遗漏了一个域概念。您是否尝试过创建第三个实体：FooBarRelationship？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T19:38:27.600

请参阅Hibernate 文档中的[工作双向链接](http://www.hibernate.org/hib_docs/v3/reference/en-US/html/tutorial-associations.html#tutorial-associations-bidirectional)。

> 许多开发人员进行防御性编程并创建链接管理方法以正确设置双方，例如在 Person 中：

```
protected Set getEvents() {
    return events;
}

protected void setEvents(Set events) {
    this.events = events;
}

public void addToEvent(Event event) {
    this.getEvents().add(event);
    event.getParticipants().add(this);
}

public void removeFromEvent(Event event) {
    this.getEvents().remove(event);
    event.getParticipants().remove(this);
} 
```

我个人认为持有相关对象列表的实体对象太聪明了，你应该让 DAL 命中数据库。

```
DALFactory.FooAdapter.getBars(foo); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T19:56:02.323

你说一方将“拥有”这种关系。将此方法公开。其他关联（或添加方法）可以在内部进行，以避免消费者直接与其交互。

```
public class Foo
{  
   private IList<Bar> Bars {get;set;}

   public void AddBar(Bar bar)
   {
      Bars.Add(bar);
      bar.Foos.Add(this);
   }
}

public class Bar
{
   internal IList<Foo> Foos {get;set;}
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-22T19:35:03.223

你可以让它静态

```
public class Foo
{
    List<Bar> Bars = new List<Bar>();

    public void AddBar(Bar bar)
    {
        Bars.Add(bar);
        Bar.AddFoo(bar,this);
    }
}

public class Bar
{
    List<Foo> Foos = new List<Foo>();

    // This shouldn't exist.
    public static void AddFoo(Bar bar, Foo foo)
    {
        bar.Foos.Add(foo);
        //foo.AddBar(this); inf recurtion
    }
} 
```

不是很理想，但它确实从对象自身中获取了功能

# jquery - JQuery - 在.load-ed html中用一个字符串替换另一个字符串？

> ID：311644
> 
> 赞同：0
> 
> 时间：2008-11-22T18:55:15.677
> 
> 标签：jquery

我正在使用加载一个 html 片段

```
$("#TemplateDump").load("Themes/default.template", function() { processTemplate() }) 
```

我正在加载的 html 包含

```
<div>
`hello ##name##, your age is ##age##. 
your page is <a href="##website##">here</a>
</div> 
```

我需要用“joe”、“112”和“www.whatever.com”替换## 占位符。有没有更多的 jquery 方式来做到这一点，而不是使用直接的 javascript .replace？周围有没有占位符替换插件？在 url 占位符上使用 .replace 在 IE 中也不起作用。不知道为什么。顺便说一句，模板不能更改。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T19:14:44.513

尝试[jTemplates](http://jtemplates.tpython.com/) 或[更简单的插件](http://plugins.jquery.com/project/jquerytemplate)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-24T01:53:50.010

在 vanilla javascript 中做一个简单的模板系统并不难。

```
var myValues = {
    name : 'Joe',
    age : '112',
    website: 'http://www.whatever.com'
};
var myString = "hello ##name## ..."; // etc

for (var key in myValues) {
    myString.replace(new RegExp("##" + key + "##", g), myValues[key]);
} 
```

只需确保在将其插入文档之前在 HTML 上运行此脚本。您可能想要使用不同的 AJAX 函数`load()`，也许`get()`？

```
$.get(
    'themes/default.template',
    {},
    function (data) {
        data = processTemplate(data);
        $('#templateDump').html(data);
    }
); 
```

# python - 用于测试soap客户端的公共免费网络服务

> ID：311654
> 
> 赞同：99
> 
> 时间：2008-11-22T19:06:39.477
> 
> 标签：python, web-services, soap, soappy, zsi

是否有任何公开可用的符合[SOAP 1.2](http://en.wikipedia.org/wiki/SOAP_(protocol)) / [WSDL 2.0](http://en.wikipedia.org/wiki/Web_Services_Description_Language)的免费 Web 服务用于测试基于 Python 的肥皂客户端库（例如[Zolera SOAP Infrastructure](http://pywebsvcs.sourceforge.net/)）？

到目前为止，在我看来，[Google Web API](http://www.google.com/apis/)可能是唯一的选择。

否则，如何测试符合[SOAP 1.2的客户端库？](http://en.wikipedia.org/wiki/SOAP_(protocol))

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-11-22T19:17:04.883

这里有一堆：

[http://www.webservicex.net/WS/wscatlist.aspx](http://www.webservicex.net/WS/wscatlist.aspx)

只需在谷歌上搜索“Free WebService”或“Open WebService”，您就会发现大量开放的 SOAP 端点。

请记住，您可以通过将 ?WSDL 添加到 url 从任何 ASMX 端点获取 WSDL。

# unix - 如何使用 Unix CLI 有效地学习工作

> ID：311656
> 
> 赞同：6
> 
> 时间：2008-11-22T19:08:24.933
> 
> 标签：unix, shell

你知道有什么资源可以教你养成在 UNIX 命令行中工作的好习惯吗？

编辑：我不是指关于 shell 或手册页的一般书籍。我的意思是你只能看到专业人士使用命令行工作的东西。例如，在两个目录之间频繁切换时，他们使用“pushd”命令，在重复命令时，他们使用“history”。我可以阅读这些命令，但我想养成有效使用它们的习惯。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-22T19:45:32.987

我说的是我自己的经验，所以它可能不适用于你；

提高效率的最佳方法实际上是每天使用它，而不是使用图形工具，即使它们看起来很简单。然后你会意识到你关心的最常见的任务，而不是试图立即去理解它，你会得到一个很好的起点来开始学习。手册页是首先要查看的内容，但是无论如何您都需要搜索一些不明显的技巧。知道你到底想要什么，会无限增加找到它的可能性。

例如，您可以在“查找”的手册页中找到如何搜索所有 mp3 文件比如何处理一般文件更容易（从哪里开始？）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-22T22:08:27.953

一些常见的 bash 命令行操作，不按顺序排列：

*   命令行编辑：你会想要擅长使用 emacs 或 vi 并将其应用于编辑你的命令。
*   完成：使用 TAB 扩展文件名和路径。
    *   注意：有大量的文件、命令和历史完成功能，并且是可配置的。大话题。
*   "cd -" : 返回上一个目录
*   ~ = 主目录（或 ~user 用户主目录）
*   “ESC键 。” : 从上一个命令扩展为最后一个 arg
*   "!string" : 执行最后一个以字符串开头的命令
*   学习查找、grep、sed、管道“|” 和重定向“>”。你会经常结合这些来做有用的事情。
*   来自 shell 提示的循环，例如“for”循环 - 执行重复操作
*   学习你的正则表达式！常用于匹配文件。
    *   示例： ls x[0-5]*.{zip,tar} = 列出以 x 开头的文件，后跟数字 0 到 5，后跟任何以 .zip 或 .tar 结尾的字符串

如果可能，请向其他人询问他们最喜欢的技巧，阅读手册并练习。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-22T19:26:14.770

对于更高级的东西[这](http://tldp.org/LDP/abs/abs-guide.pdf)似乎相当全面

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-22T19:54:24.247

这是一个很好的资源：“Rute User's Tutorial and Exposition”（[http://rute.2038bug.com/index.html.gz](http://rute.2038bug.com/index.html.gz)）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-22T19:15:04.653

stackoverflow.com 特别是 [`bash`](https://stackoverflow.com/questions/tagged/bash)标签 ;-) （当然还有bash[手册页](http://linux.die.net/man/1/bash)）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-22T20:42:57.690

如果您想要“只能看到使用命令行工作的专业人士”的东西，那么您已经回答了自己的问题：观察专业人士使用命令行工作。我个人认为这不是很有用，除非对方多次做同样的事情；一次会议后很难拿起东西，因为很难同时观看屏幕和键盘。

我认为关键是不要试图马上成为专家。只需经常使用命令行，并注意您可能没有尽可能地使用它，但无论如何不要让这阻止您使用它。

浏览 shell 的手册页和提示列表，目的不是为了记住其中的所有内容，而只是挑选一些东西来尝试。浏览一下，直到有什么东西引起你的注意，让你想，“哎呀，这听起来很有用。” 然后尝试一下。并非所有东西都会立即有用。您可能需要等待一段时间才能遇到*可以*尝试的情况。也许你可以在办公桌旁的便利贴上写下一些东西来提醒你某些壮举是可能的，所以当你遇到一个更晦涩的功能可能会派上用场的情况时，你更有可能记得尝试它.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-22T22:50:45.857

坦率地说，在真空中学习这些东西是不可能的。你需要有问题需要解决。

虽然熟悉可用的工具（其中有无数）当然会有所帮助，但“学习”它需要应用它。而应用它需要“真正的”问题来解决。

例如，系统管理员的技能组合可能与使用数据库的人不同，因为他们的角色不同。

我将它们用于数据处理，主要使用一次性文件。/tmp/x.sh 和 /tmp/xx 在目录文件夹中是裸露的。

我的锤子倾向于：ls、find、sort、sed、vi、awk、grep 和 comm。结合简单的 shell 脚本，例如： for i in `cat /tmp/list`; 做..做

但是我做的 ETL 工作很多，脚本文件很少，这就是为什么我的 shell 脚本编写能力如此薄弱的原因。

但是，我确实依赖一个脚本：

```
#!/bin/sh
# latest -- show latest files
ls -lt $@ | head 
```

因为 95% 的时间我正在处理的文件都在前 10 个最新文件中。而“最新的* .txt”适用于桃子。

所以，归根结底，你需要解决问题。你需要学习'man'命令，man -k 很适合找东西。您还需要利用大多数手册页底部的“另请参阅”。那是“我不知道你能做到”的宝库。

然后，开始解决问题。开始弄清楚“拥有什么会很好”，然后看看它是否存在（很可能）。如果没有，awk、perl 或 python 可以凭空制造这些“物有所值”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-23T14:13:29.643

加入一个 LUG。那是我早期学到最多东西的地方。请组织者举办“Bash Tips and Tricks Night”。

Deft shell 用户喜欢炫耀。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T00:40:23.350

apropos 是处理这类事情的一个非常好的工具。每当您发现自己不确定做某事的最佳方法时，或者希望您不要重复自己时，只需使用带有一两个关键字的 apropos 来查找其他可以提供帮助的命令。在像 debian 这样的发行版中，您还可以安装基于 Web 的帮助工具来搜索系统上所有可用的手册：texinfo、手册页、html 和 pdf 等。

除此之外，是的，至少通读一遍你的 shell 手册 --- 最好在你了解更多、达到极限并希望提高效率时反复阅读它。

加入 LUG 的想法也不错；你肯定会从别人的演示中学习。

# mysql - MySQL——你如何找到精确到毫秒的时间？

> ID：311657
> 
> 赞同：2
> 
> 时间：2008-11-22T19:09:02.480
> 
> 标签：mysql

有什么方法可以将 MySQL 中的时间缩短到毫秒？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T19:18:39.780

MySQL 不支持任何时间/日期列中的毫秒数，或者`NOW()`不幸地返回它，不。

如果您有一个日期/时间+微秒格式的字符串，您可以使用它`SELECT MICROSECOND('1997-12-31 23:59:59.000010');`来提取微秒。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-10-14T10:54:17.853

只是想分享它，因为我最近也需要一个 MySQL 项目的毫秒数。

您可以编写一个 UDF -[用户定义函数](http://dev.mysql.com/doc/refman/5.5/en/adding-udf.html)- 让您将系统时间缩短到相当小的几分之一秒：

![在此处输入图像描述](https://i.stack.imgur.com/bqIKP.png)

[您可以在 github 上](https://github.com/CarnotInteractive/MySQL-udf-microtime)获取源代码以及预编译的二进制文件。

# c# - C# 解决 XmlSerializer.Deserialize 陷阱？

> ID：311662
> 
> 赞同：0
> 
> 时间：2008-11-22T19:17:20.483
> 
> 标签：c#, xml, serialization

我只是想知道使用 XmlSerializer.Deserialize() 反序列化私有字段/属性是否有任何好的解决方法？

目前，我将我的 XML 反序列化为具有所有公共属性的简单一次性类型，然后加载具有如下私有属性的复杂类型：

```
ComplexType complex = new ComplexType(SimpleType); 
```

ComplexType 的构造函数如下所示：

```
public ComplexType(SimpleType simpleType){
    this.Property1 = simpleType.Property1;
    this.Property2 = simpleType.Property2;
    .....

} 
```

有人有更好的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T13:16:47.310

请注意，另一个选项是使用`DataContractSerializer`(.NET 3.0) - 这支持私有成员（属性或字段）的序列化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T19:28:42.007

您可以让 ComplexType 实现 IXmlSerializable 接口。这暴露了序列化和反序列化的方法，因此您可以在这些方法中填充 complextype 的私有成员。

在此处查看 MSDN：http: [//msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.aspx](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.aspx)以获取显示序列化私有字段的 IXmlSerializable 接口的实现的示例。

# unix - Windows Mobile：哪个图标是应用程序图标？

> ID：311666
> 
> 赞同：2
> 
> 时间：2008-11-22T19:20:59.663
> 
> 标签：unix, icons

我正在尝试编写一个 unix 命令行实用程序，该实用程序将从 Windows Mobile 可执行文件中提取“应用程序”图标。当我从 icoutils 包中查看带有[wrestool](http://www.nongnu.org/icoutils/)的 .exe 时，我看到了多个图标和 group_icon 资源。我试图弄清楚 Windows Mobile 程序视图会选择向最终用户显示哪个图标。

起初，我认为它应该是名称为 32512 (IDI_APPLICATION) 的图标，但后来我发现几个 Windows Mobile 二进制文件缺少此图标资源，但在 Programs 视图中果然有可见图标。

有没有简单但正确的算法？像最低的资源ID？.exe 中是否还有其他资源可以告诉我应用程序图标是什么？我有什么明显的遗漏吗？

任何见解将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T20:04:24.570

它是`RT_GROUP_ICON`可执行文件中的第一个资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-27T13:24:50.830

让我们一步一步来展示。首先，您需要查看 EXE 中的内容：

```
wrestool -l file.exe 
```

通常情况下，最好的图标是第一个 GROUP_ICON，但是当 GROUP_ICON 名称是单词而不是数字时，然后是最大尺寸的 GROUP_ICON（如果第一个 GROUP_ICON 为空白，则需要提取第二大尺寸）。

```
wrestool -x -t14 -n(GROUP_ICON name) file.exe > file.ico 
```

如果你想创建一个完美的代码，你可能也应该包含 GROUP_ICON 语言（有时 exe 没有语言（16 位应用程序），所以你需要把两个代码都放好）：

```
wrestool -x -t14 -n(GROUP_ICON name) -l(GROUP_ICON language) file.exe > file.ico 
```

在某些应用程序中，GROUP_ICON 提取将失败。那是因为一些新的应用程序（比如新游戏）使用 GROUP_ICON 作为链接，并在 ICON 中插入真实的图标。然后，您将需要使用该代码提取最大的 ICON：

```
wrestool -x -R -t3 -n(ICON name) -o. file.exe > file.ico 
```

但是会有一个大问题。这将提取 ICON，但文件的一小部分将丢失，这对于以 .ico 格式打开此文件至关重要。您需要在十六进制编辑器中打开该文件，并在文件中插入一点 HEX 代码，然后再插入其他所有内容。

```
00 00 01 00 01 00 80 80 00 00 01 00 18 00 28 C8 00 00 16 00 00 00 
```

也许，现在你认为这就是结束了。不。更糟糕的部分来了：从 ICO 中提取正确的图片。首先，您不仅需要 wrestool，还需要 icotool。然后，使用该代码：

```
icotool -l file.ico 
```

然后，您将需要提取具有最大宽度、高度和位深度的文件。

```
icotool -x -o. -w(Width) -h(Height) -b(Bit-depth) file.ico 
```

结果将是一个带有完美图标的 PNG 文件。有时，该代码可能会失败（例如：程序“Robust Motion Deblurring”），然后您需要第二个转换器才能从 ICO 更改为 PNG，但该转换器在某些情况下可能会失败（例如：游戏“质量效应”） ，因此您的代码中可能需要两者。

我曾经在一个 Objective-C 程序中使用过这个逻辑，所以我知道它是有效的（直到现在，99.9% 的成功率）。

# windows - 如何在 Windows XP 中禁用外部 USB 硬盘驱动器上的自动睡眠

> ID：311672
> 
> 赞同：-1
> 
> 时间：2008-11-22T19:27:39.043
> 
> 标签：windows

我在这个网站上看到了一个关于 Linux 系统的相关问题。我在 Windows XP 操作系统上也有同样的问题。我买了一个温彻斯特USB外置硬盘，从技术支持那里得知，休眠功能在固件中，无法关闭。我正在寻找一个应用程序，它会定期自动读取/写入该驱动器以保持该计时器重置（每 5 分钟一次？）。有人知道 Windows XP 的小型应用程序可以做到这一点吗？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-07-22T00:12:35.443

我已经尝试了几乎所有方法来解决包含我的电影的外部共享的这个问题。没有任何工作。我有一个 WD Mybook，我认为睡眠发生在驱动器内部。

我有一个适合我的解决方案，也应该适用于其他任何人。关键是要让 USB 驱动器做一些事情。不是很多，而是一些简单的事情，会导致驱动器发生某种类型的变化。

Windows XP 没有 SLEEP 命令，但您可以下载一个并将其添加到 SYSTEM32 文件夹中。然后，您需要做的就是制作一个简单的批处理文件，并将其放在您的启动文件夹中，以便在您登录时执行。

确保您对驱动器具有写入权限。将驱动器号更改为您的驱动器号...

制作一个批处理文件。

```
:start
@echo off
@cls
@echo Keeping USB Drive Awake.  Do not close this window!
@sleep 60
@dir E: /S /B >E:\keepawake.txt
@echo Drive Accessed %date% at %time% >keepawake.txt
goto start 
```

这会将完整的目录结构写入 E: 驱动器上名为 keepawake.txt 的文件中。然后它将用包含日期和时间的简单注释覆盖它。这将永远不同。它将每 60 秒执行一次。

问题解决了...

-Krehator

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T18:11:57.860

你可以试试 NoSleepHD。

[http://nosleephd.codeplex.com/](http://nosleephd.codeplex.com/)

它每隔几分钟（您可以选择分钟）将一个空文本文件写入您选择的驱动器，以停止驱动器进入自动睡眠模式。

谷歌：nosleephd

灰烬

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T20:51:34.647

制作批处理 (.BAT) 文件，如下所示：

```
@echo off
:start
copy c:\windows\notepad.exe g:\  (Or whatever your external drive is)
choice /N /D Y /T 120            (The 120 is the delay in seconds)
goto :start 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-19T13:40:21.883

我正在使用免费/开源的 Windows 程序 KeepAliveHD ( [http://keepalivehd.codeplex.com/](http://keepalivehd.codeplex.com/) ) 来完成这项工作。效果很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-22T20:30:55.920

任何具有自动保存功能的文本编辑器都可以做到。您还可以编写一个批处理文件来获取目录列表，并让它在设定的时间段后递归地执行（调用自身）。或者使用 windows scheduler 来执行它。

# ruby-on-rails - 如何在 Rails.cache 中放置（部分）大型对象图？

> ID：311674
> 
> 赞同：0
> 
> 时间：2008-11-22T19:28:43.597
> 
> 标签：ruby-on-rails, ruby, caching

我有一个类，其中查找实例很昂贵，因此缓存了实例：

```
class Foo
  def self.find(id)
    Rails.cache.fetch("Foo.#{id}") do
      // some expensive lookup, like an HTTParty request, or a long SQL query
      ...
    end
  end
end 
```

这工作正常，直到`Foo`s 有相关`Foo`的 s：

```
class Foo
  def children
    @child_foo_ids.map { |id| Foo.find(id) }
  end
end 
```

我想使用`||=`缓存来保存重复的行程：

```
class Foo
  def children
    @children ||= @child_foo_ids.map { |id| Foo.find(id) }
  end
end 
```

但是`Rails.cache`会冻结找到`Foo`的 s，所以在创建和缓存对象后无法设置实例变量。（即这种方法引发了一个`TypeError`。）

一种解决方案是在我第一次进行昂贵的查找时预取`parent`，但是当我只需要一个或两个实例时，最终可能会加载一个**巨大**的对象图。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T19:31:02.717

您*可以*使用`||=`缓存；你只需要使用一点间接：

```
class Foo
  def initialize
    @related_objects = {}
  end
  def children
    @related_objects[:children] ||= @child_foo_ids.map { |id| Foo.find(id) }
  end
end 
```

`Rails.cache`不会冻结 each 的实例变量`Foo`，所以`Hash`可以修改！

PS：是的，我确实只是在基本上同时发布了这个问题和答案。我认为社区可以从我的斗争中受益。

# c# - SecurityManager.IsGranted() 行为

> ID：311677
> 
> 赞同：3
> 
> 时间：2008-11-22T19:31:28.927
> 
> 标签：c#, cas, securitymanager, principalpermission

任何人都可以解释以下 c# 行为吗？我编写了一个小型控制台应用程序只是为了了解 CAS，但我似乎无法理解为什么以下代码行会像它们那样工作：

```
string[] myRoles = new string[] { "role1", "role2", "role3" };
GenericIdentity myIdentity = new GenericIdentity("myUsername", "customAuthType");
GenericPrincipal myPrincipal = new GenericPrincipal(myIdentity, myRoles);

System.Threading.Thread.CurrentPrincipal = myPrincipal;

Console.WriteLine(SecurityManager.IsGranted(new PrincipalPermission(null, "role1")));
Console.WriteLine(SecurityManager.IsGranted(new PrincipalPermission(null, "roleX"))); 
```

两个 SecurityManager.IsGranted() 调用的输出都是“真”。

如果我再添加以下几行：

```
 new PrincipalPermission(null, "role1").Demand();
 new PrincipalPermission(null, "roleX").Demand(); 
```

第一个需求调用通过，但第二个（如预期的那样）导致 SecurityException。

为什么 SecurityManager.IsGranted() 调用不为“roleX”权限返回 false？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-06-13T08:11:04.447

在 .NET 4.0 中，SecurityManager.IsGranted 已过时。

原来是这样，如果您在 .NET 4.0 兼容性中编译，它会报错。

```
bool isGranted = SecurityManager.IsGranted(new SecurityPermission(SecurityPermissionFlag.Infrastructure)) 
```

要解决这个问题：

```
var permissionSet = new PermissionSet(PermissionState.None);
permissionSet.AddPermission(new SecurityPermission(SecurityPermissionFlag.UnmanagedCode));
bool isGranted = permissionSet.IsSubsetOf(AppDomain.CurrentDomain.PermissionSet); 
```

参考： http:
[//www.stringbuilder.net/post/2009/07/31/In-NET-40-SecurityManagerIsGranted-is-obsolete.aspx](http://www.stringbuilder.net/post/2009/07/31/In-NET-40-SecurityManagerIsGranted-is-obsolete.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T00:37:40.210

[从此处](http://bytes.com/groups/net-c/261089-custom-permission-securitymanager-isgranted)类似问题的答案看来， IsGranted() 仅适用于 CAS 权限，而不适用于非 CAS 权限。

文章引用：

> SecurityManager.IsGranted() 通过检查管理员授予的 CAS 权限来确定是否授予权限。由于 WorkingTimePermission 是非 CAS 权限，这意味着管理员设置的安全策略对该权限没有影响。换句话说，管理员无法授予或撤销 [非 CAS 权限]。因此 SecurityManager.IsGranted() 对于 [非 CAS 权限] 将始终返回 false。

和

> 我花了一段时间来习惯 CAS 与非 CAS 权限，并意识到像“安全策略”和“策略”这样的关键短语只适用于 CAS 权限。一旦我对此感到满意，破译像 SecurityManager.IsGranted 的备注部分这样看似无辜的帮助条目就变得容易多了：
> 
> “权限的授予由政策决定……”
> 
> 这意味着 - 但没有明确声明 - 该方法仅适用于 CAS 权限，因为它正在检查当前的安全策略。这需要一些时间来适应。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T13:15:38.340

我认为`SecurityManager.IsGranted`主要是查看代码需求（程序集等）-而不是特定要求，例如主要权限。

做你想做的事：

```
 static bool HasAccess(string role)
    {
        IPrincipal principal = System.Threading.Thread.CurrentPrincipal;
        return principal == null ? false : principal.IsInRole(role);
    } 
```

# sql - 将 SQLite3 转储导入数据库

> ID：311691
> 
> 赞同：47
> 
> 时间：2008-11-22T19:48:41.543
> 
> 标签：sql, database, sqlite, import

我觉得这是一个愚蠢的问题，因为这似乎是常识。. . 但是我可以放在一起的谷歌搜索似乎无法给我答案！

我知道如何使用 .dump 命令从 sqlite3 数据库中获取数据。但是现在我有了这个名为 export.sqlite3.sql 的 ASCII 文件。. . 我似乎无法将它恢复到我想要的数据库中。

我的目标是将我在一个 Rails 应用程序中的数据传输到另一个应用程序，这样我就不必再花各种时间创建虚拟数据了。. . 所以我从我的第一个应用程序中转储了数据，摆脱了所有 CREATE TABLE 语句，并确保我的第二个应用程序上的模式匹配。. . 现在我只需要把它放进去。

有人介意帮助我吗？当你找到方法时，你能告诉我你在谷歌上插入了什么吗，因为我现在正用勺子敲打我的头，因为我认为这很容易找到。

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-11-22T20:08:46.230

```
cat dumpfile.sql | sqlite3 my_database.sqlite 
```

[这是从 sqlite3 入门指南修改的。](http://www.sqlite.org/sqlite.html)

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-01-30T06:12:11.750

您没有指定您的操作系统，而

```
sqlite3 my_database.sqlite < export.sqlite3.sql 
```

适用于 unix 风格，不适用于 windows。

.dump 命令的反面是 .read 命令。语法是

```
sqlite3> .read export.sqlite3.sql 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-05T17:55:49.460

这也应该有效：

```
echo '.read export.sqlite3.sql' | sqlite3 my_database.sqlite3 
```

与“”相比，一个可能的优势`sqlite3 my_database.sqlite3 < export.sqlite3.sql`是 SQLite 的`.read`命令可能（现在或将来）比“读入所有文本并执行它”更先进。它可能会进行批处理，这将减少大型转储的内存使用量。不过，我承认这是一个非常模糊且不太可能的优势。很可能，`.read`只需从输入中读取每一行并执行它，就像重定向和管道运算符一样。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2013-10-23T12:24:52.850

将此用于 unix 风格。

按 Ctrl+alt+T 并写入

```
sqlite3 /home/ubuntu/output.sqlite < /home/ubuntu/input.sql 
```

它从输入文件恢复您的数据库。

# .net - 为什么.NET 默认使用银行家的四舍五入？

> ID：311696
> 
> 赞同：283
> 
> 时间：2008-11-22T19:51:53.737
> 
> 标签：.net, rounding

根据文档，该[`decimal.Round`](http://msdn.microsoft.com/en-us/library/zy06z30k.aspx)方法使用对大多数应用程序不常见的取整算法。所以我总是最终编写一个自定义函数来执行更自然的四舍五入算法：

```
public static decimal RoundHalfUp(this decimal d, int decimals)
{
    if (decimals < 0)
    {
        throw new ArgumentException("The decimals must be non-negative", 
            "decimals");
    }

    decimal multiplier = (decimal)Math.Pow(10, decimals);
    decimal number = d * multiplier;

    if (decimal.Truncate(number) < number)
    {
        number += 0.5m;
    }
    return decimal.Round(number) / multiplier;
} 
```

有人知道这个框架设计决定背后的原因吗？

框架中是否有任何内置的半舍入算法实现？或者也许是一些非托管的 Windows API？

`decimal.Round(2.5m, 0)`对于只写期望 3 结果却得到 2的初学者来说，这可能会产生误导。

* * *

## 回答 #1

> 赞同：447
> 
> 时间：2011-07-03T09:09:41.327

其他解释为什么银行家的算法（又名[四舍五入到偶数](http://en.wikipedia.org/wiki/Rounding#Round_half_to_even)）是一个不错的选择的原因是非常正确的。在最合理的分布上，它不会像[零差一半](http://en.wikipedia.org/wiki/Rounding#Round_half_away_from_zero)方法那样受到负偏或正偏的影响。

但问题是 .NET 为什么默认使用 Banker 的实际舍入 - 答案是 Microsoft 遵循[IEEE 754](https://en.wikipedia.org/wiki/IEEE_754#Roundings_to_nearest)标准。这也在[MSDN for Math.Round](http://msdn.microsoft.com/en-us/library/system.math.round.aspx)的备注下提到。

另请注意，.NET 通过提供`MidpointRounding`枚举来支持 IEEE 指定的替代方法。他们当然可以提供[更多](http://en.wikipedia.org/wiki/Rounding#Tie-breaking)解决关系的替代方案，但他们选择只满足 IEEE 标准。

* * *

## 回答 #2

> 赞同：206
> 
> 时间：2008-11-22T19:57:14.757

可能是因为它是一个更好的算法。在执行多次舍入的过程中，您将平均得出所有 0.5 的最终舍入均等。例如，如果您要添加一堆四舍五入的数字，这可以更好地估计实际结果。我会说，即使这不是某些人所期望的，但这可能是更正确的做法。

* * *

## 回答 #3

> 赞同：89
> 
> 时间：2008-11-22T19:59:54.330

虽然我无法回答“为什么微软的设计师选择这个作为默认设置？”的问题，但我只想指出一个额外的功能是不必要的。

[`Math.Round`](http://msdn.microsoft.com/en-us/library/system.math.round.aspx)允许您指定[`MidpointRounding`](http://msdn.microsoft.com/en-us/library/system.midpointrounding.aspx)：

*   ToEven - 当一个数字在其他两个数字之间时，它会向最接近的偶数四舍五入。
*   AwayFromZero - 当一个数字介于其他两个数字之间时，它会朝离零最近的数字四舍五入。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2010-01-22T12:58:04.503

小数多用于**金钱**；在处理**金钱**时，银行家的四舍五入很常见。或者你可以说。

> 需要十进制类型的主要是银行家；因此它会进行“银行家四舍五入”</p>

银行家四舍五入的优势在于，如果您平均而言，您将获得相同的结果：

*   在将它们相加之前将一组“发票行”四舍五入，
*   或将它们相加然后四舍五入

在计算机出现之前的日子里，加起来之前的四舍五入节省了很多工作。

（在英国，当我们采用十进制时，银行不会处理半便士，但多年来仍然存在半便士硬币，而商店的价格通常以半便士结尾——所以很多四舍五入）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-03-26T14:44:22.177

使用 Round 函数的另一个重载，如下所示：

```
decimal.Round(2.5m, 0,MidpointRounding.AwayFromZero) 
```

它将输出**3**。如果你使用

```
decimal.Round(2.5m, 0,MidpointRounding.ToEven) 
```

你会得到银行家的四舍五入。

# file-io - Scripting.FileSystemObject.FileExists 总是返回 false

> ID：311702
> 
> 赞同：0
> 
> 时间：2008-11-22T19:56:54.820
> 
> 标签：file-io, asp-classic

我试图在将文件包含在经典 ASP 中的 Server.Execute 之前检查文件是否存在。当 FileExists() 返回 False 时，Server.Execute 成功地执行了文件。两个调用都使用完全相同的文件路径。

为什么会发生这种情况，我该如何解决？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T21:20:00.017

我怀疑您正在传递相对路径（例如，“/Subfolder/Page.asp”）。您需要[Server.MapPath](http://msdn.microsoft.com/en-us/library/ms524632.aspx)来调用 FileExists - 它需要一个绝对路径（例如，“C:\inetpub\wwwroot\Subfolder\Page.asp”）。

```
<%
Dim path : path = "/Admin/default.asp"
Dim fso : Set fso = CreateObject("Scripting.FileSystemObject")

If fso.FileExists(Server.MapPath(path)) Then
   Server.Execute(path)
Else
   Response.Write "The path " & path & " does not exist."
End If

Set fso = Nothing
%> 
```

# algorithm - 无需替换的采样算法？

> ID：311703
> 
> 赞同：15
> 
> 时间：2008-11-22T19:56:55.660
> 
> 标签：algorithm, statistics, pseudocode

我正在尝试测试偶然发生特定数据聚类的可能性。一种稳健的方法是蒙特卡罗模拟，其中数据和组之间的关联被随机重新分配大量次（例如 10,000 次），并且使用聚类度量来比较实际数据与模拟以确定 ap价值。

我已经完成了大部分工作，将分组映射到数据元素的指针，所以我计划随机重新分配指向数据的指针。问题：什么是无需替换的快速采样方法，以便在复制数据集中随机重新分配每个指针？

例如（这些数据只是一个简化的例子）：

> 数据（n=12 个值） - A 组：0.1、0.2、0.4 / B 组：0.5、0.6、0.8 / C 组：0.4、0.5 / D 组：0.2、0.2、0.3、0.5

对于每个复制数据集，我将拥有相同的集群大小（A=3、B=3、C=2、D=4）和数据值，但会将这些值重新分配给集群。

为此，我可以生成 1-12 范围内的随机数，分配 A 组的第一个元素，然后生成 1-11 范围内的随机数并分配 A 组的第二个元素，依此类推。指针重新分配很快，并且我将预先分配所有数据结构，但是没有替换的采样似乎是一个以前可能已经解决过很多次的问题。

逻辑或伪代码优先。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-22T20:08:14.093

这是一些基于 Knuth 的书 Seminumeric Algorithms 的算法 3.4.2S 的无替换采样代码。

```
void SampleWithoutReplacement
(
    int populationSize,    // size of set sampling from
    int sampleSize,        // size of each sample
    vector<int> & samples  // output, zero-offset indicies to selected items
)
{
    // Use Knuth's variable names
    int& n = sampleSize;
    int& N = populationSize;

    int t = 0; // total input records dealt with
    int m = 0; // number of items selected so far
    double u;

    while (m < n)
    {
        u = GetUniform(); // call a uniform(0,1) random number generator

        if ( (N - t)*u >= n - m )
        {
            t++;
        }
        else
        {
            samples[m] = t;
            t++; m++;
        }
    }
} 
```

Jeffrey Scott Vitter 在“An Efficient Algorithm for Sequential Random Sampling”中提出了一种更有效但更复杂的方法，ACM Transactions on Mathematical Software, 13(1), March 1987, 58-67。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2014-08-07T10:15:47.283

基于[John D. Cook 回答的](https://stackoverflow.com/a/311716/15485)C++ 工作代码。

```
#include <random>
#include <vector>

// John D. Cook, https://stackoverflow.com/a/311716/15485
void SampleWithoutReplacement
(
    int populationSize,    // size of set sampling from
    int sampleSize,        // size of each sample
    std::vector<int> & samples  // output, zero-offset indicies to selected items
)
{
    // Use Knuth's variable names
    int& n = sampleSize;
    int& N = populationSize;

    int t = 0; // total input records dealt with
    int m = 0; // number of items selected so far

    std::default_random_engine re;
    std::uniform_real_distribution<double> dist(0,1);

    while (m < n)
    {
        double u = dist(re); // call a uniform(0,1) random number generator

        if ( (N - t)*u >= n - m )
        {
            t++;
        }
        else
        {
            samples[m] = t;
            t++; m++;
        }
    }
}

#include <iostream>
int main(int,char**)
{
  const size_t sz = 10;
  std::vector< int > samples(sz);
  SampleWithoutReplacement(10*sz,sz,samples);
  for (size_t i = 0; i < sz; i++ ) {
    std::cout << samples[i] << "\t";
  }

  return 0;
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-22T20:00:24.267

请参阅我对这个问题的回答[O(1) 中的唯一（非重复）随机数？](https://stackoverflow.com/questions/196017/unique-random-numbers-in-o1#196065). 相同的逻辑应该完成您想要做的事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-05-13T11:51:42.877

受[@John D. Cook 的回答](https://stackoverflow.com/a/311716/1804173)启发，我在 Nim 中编写了一个实现。起初我很难理解它是如何工作的，所以我进行了广泛的评论，还包括一个例子。也许它有助于理解这个想法。另外，我稍微更改了变量名称。

```
iterator uniqueRandomValuesBelow*(N, M: int) =
  ## Returns a total of M unique random values i with 0 <= i < N
  ## These indices can be used to construct e.g. a random sample without replacement
  assert(M <= N)

  var t = 0 # total input records dealt with
  var m = 0 # number of items selected so far

  while (m < M):
    let u = random(1.0) # call a uniform(0,1) random number generator

    # meaning of the following terms:
    # (N - t) is the total number of remaining draws left (initially just N)
    # (M - m) is the number how many of these remaining draw must be positive (initially just M)
    # => Probability for next draw = (M-m) / (N-t)
    #    i.e.: (required positive draws left) / (total draw left)
    #
    # This is implemented by the inequality expression below:
    # - the larger (M-m), the larger the probability of a positive draw
    # - for (N-t) == (M-m), the term on the left is always smaller => we will draw 100%
    # - for (N-t) >> (M-m), we must get a very small u
    #
    # example: (N-t) = 7, (M-m) = 5
    # => we draw the next with prob 5/7
    #    lets assume the draw fails
    # => t += 1 => (N-t) = 6
    # => we draw the next with prob 5/6
    #    lets assume the draw succeeds
    # => t += 1, m += 1 => (N-t) = 5, (M-m) = 4
    # => we draw the next with prob 4/5
    #    lets assume the draw fails
    # => t += 1 => (N-t) = 4
    # => we draw the next with prob 4/4, i.e.,
    #    we will draw with certainty from now on
    #    (in the next steps we get prob 3/3, 2/2, ...)
    if (N - t)*u >= (M - m).toFloat: # this is essentially a draw with P = (M-m) / (N-t)
      # no draw -- happens mainly for (N-t) >> (M-m) and/or high u
      t += 1
    else:
      # draw t -- happens when (M-m) gets large and/or low u
      yield t # this is where we output an index, can be used to sample
      t += 1
      m += 1

# example use
for i in uniqueRandomValuesBelow(100, 5):
  echo i 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-10-18T09:38:13.223

当总体规模远大于样本规模时，上述算法变得低效，因为它们的复杂度为*O* ( *n* )，*n*是总体规模。

当我还是学生的时候，我写了一些无需替换的均匀采样算法，它们的平均复杂度为*O* ( *s* log *s* )，其中*s*是样本大小。这是二叉树算法的代码，平均复杂度为*O* ( *s* log *s* )，在 R 中：

```
# The Tree growing algorithm for uniform sampling without replacement
# by Pavel Ruzankin 
quicksample = function (n,size)
# n - the number of items to choose from
# size - the sample size
{
  s=as.integer(size)
  if (s>n) {
    stop("Sample size is greater than the number of items to choose from")
  }
  # upv=integer(s) #level up edge is pointing to
  leftv=integer(s) #left edge is poiting to; must be filled with zeros
  rightv=integer(s) #right edge is pointig to; must be filled with zeros
  samp=integer(s) #the sample
  ordn=integer(s) #relative ordinal number

  ordn[1L]=1L #initial value for the root vertex
  samp[1L]=sample(n,1L) 
  if (s > 1L) for (j in 2L:s) {
    curn=sample(n-j+1L,1L) #current number sampled
    curordn=0L #currend ordinal number
    v=1L #current vertice
    from=1L #how have come here: 0 - by left edge, 1 - by right edge
    repeat {
      curordn=curordn+ordn[v]
      if (curn+curordn>samp[v]) { #going down by the right edge
        if (from == 0L) {
          ordn[v]=ordn[v]-1L
        }
        if (rightv[v]!=0L) {
          v=rightv[v]
          from=1L
        } else { #creating a new vertex
          samp[j]=curn+curordn
          ordn[j]=1L
          # upv[j]=v
          rightv[v]=j
          break
        }
      } else { #going down by the left edge
        if (from==1L) {
          ordn[v]=ordn[v]+1L
        }
        if (leftv[v]!=0L) {
          v=leftv[v]
          from=0L
        } else { #creating a new vertex
          samp[j]=curn+curordn-1L
          ordn[j]=-1L
          # upv[j]=v
          leftv[v]=j
          break
        }
      }
    }
  }
  return(samp)  
} 
```

该算法的复杂性在：Rouzankin, PS；Voytishek, AV 关于随机选择算法的成本。蒙特卡罗方法应用程序。5 (1999), 没有。1，39-54。 [http://dx.doi.org/10.1515/mcma.1999.5.1.39](http://dx.doi.org/10.1515/mcma.1999.5.1.39)

如果您发现该算法有用，请提供参考。

另见：P. Gupta，GP Bhattacharjee。(1984) 一种有效的无替换随机抽样算法。国际计算机数学杂志 16:4，第 201-209 页。DOI: 10.1080/00207168408803438

Teuhola, J. 和 Nevalainen, O. 1982。两种有效的无替换随机抽样算法。/IJCM/, 11(2): 127–140。DOI: 10.1080/00207168208803304

在上一篇论文中，作者使用哈希表并声称他们的算法具有*O* ( *s* ) 复杂度。还有一种更快的哈希表算法，很快就会在 pqR（pretty quick R）中实现： [https ://stat.ethz.ch/pipermail/r-devel/2017-October/075012.html](https://stat.ethz.ch/pipermail/r-devel/2017-October/075012.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-16T12:42:22.280

[此处](http://rosettacode.org/wiki/Knuth%27s_algorithm_S)描述了另一种无需替换的采样算法。

它类似于 John D. Cook 在他的回答和 Knuth 中描述的那个，但它有不同的假设：人口规模未知，但样本可以适合记忆。这称为“Knuth 算法 S”。

引用 Rosettacode 文章：

> 1.  在可用时选择前 n 个项目作为样本；
> 2.  对于 i > n 的第 i 个项目，有 n/i 个随机机会保留它。如果没有这个机会，样品将保持不变。如果没有，让它随机 (1/n) 替换先前选择的 n 个样本项目之一。
> 3.  对任何后续项目重复 #2。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-06-05T14:10:04.753

我写了一份[关于无放回抽样算法的调查](https://github.com/ciphergoth/sansreplace)。我可能有偏见，但我推荐我自己的算法，在下面用 C++ 实现，为许多 k、n 值提供最佳性能，并为其他值提供可接受的性能。`randbelow(i)`假定返回一个公平选择的小于 的随机非负整数`i`。

```
void cardchoose(uint32_t n, uint32_t k, uint32_t* result) {
    auto t = n - k + 1;
    for (uint32_t i = 0; i < k; i++) {
        uint32_t r = randbelow(t + i);
        if (r < t) {
            result[i] = r;
        } else {
            result[i] = result[r - t];
        }
    }
    std::sort(result, result + k);
    for (uint32_t i = 0; i < k; i++) {
        result[i] += i;
    }
} 
```

# performance - 高度互动网站的性能优化

> ID：311706
> 
> 赞同：2
> 
> 时间：2008-11-22T19:58:44.863
> 
> 标签：performance, caching

我最近完成了一个中等流量（？）网站的开发（峰值 6 万次点击/小时），但是，该网站只需要每分钟更新一次 - 实现所需的性能可以用一个词来概括：“缓存”。

对于像 SO 这样的网站，提供给网站的数据*一直在变化*，我想需要一种不同的方法。

页面缓存时间可能需要很短或不存在，并且需要非常快速地在所有网络服务器上传播更新，以使所有用户保持最新状态。

我的猜测是，您需要一个分布式缓存来控制数据和页面的服务，这些数据和页面会在几秒钟内更新，也许在数据库上方有一个分布式缓存来调解写入？

那些更有经验的人能否概述他们采用的一些关键架构/设计原则，以确保像 SO 这样的高度交互的网站具有高性能？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T20:09:24.433

您可能会对[这篇](http://highscalability.com/wikimedia-architecture)描述 wikimedia 服务器结构的文章感兴趣。很有启发性！

文章链接到[这个 pdf](http://www.nedworks.org/~mark/presentations/san/Wikimedia%20architecture.pdf) - 一定不要错过它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T20:32:22.297

绝大多数网站的读取次数多于写入次数。每次写入都有数千甚至数百万次读取并不少见。

因此，任何缩放解决方案都依赖于将读取的缩放与写入的缩放分开。通常，扩展读取非常便宜且容易，扩展写入则复杂且昂贵。

扩展读取最直接的方法是一次缓存整个页面并在一定秒数后使它们过期。如果您查看流行的网站 Slashdot。您可以看到这是他们扩展网站的方式。不幸的是，这种缓存策略可能会导致最终用户出现违反直觉的行为。

我从您的问题中假设您不想要这种原始类型的缓存。就像您提到的那样，您需要就地更新缓存。

这并不像听起来那么可怕。要实现的关键是从*服务器的*角度来看。Stackoverflow 不会一直更新。它很少更新。也许每秒一次或两次。对于一台计算机来说，一秒钟几乎是永恒。

此外，更新往往发生在缓存中不相互依赖的项目上。以堆栈溢出为例。我想每个问题页面都是单独缓存的。大多数问题可能在前十五分钟平均每分钟更新一次，之后可能每小时更新一次。

因此，在大多数应用程序中，您几乎不需要扩展写入。它们是如此之少，以至于您可以让一台服务器进行写入；就地更新缓存实际上是一个完全可行的解决方案。除非您有极高的流量，否则您将很少同时获得对同一缓存项的并发更新。

那么如何设置呢？我首选的解决方案是将每个页面单独缓存到磁盘，然后让许多 web-heads 从一些可相互访问的空间传递这些静态页面。

当需要完成写入时，它只从一台服务器完成，这会更新该特定缓存的 html 页面。每台服务器都拥有自己的缓存子集，因此不会出现单点故障。更新过程经过精心设计，以便事务确保没有两个请求不会同时写入文件。

我发现这个设计已经满足了我们迄今为止所要求的所有扩展要求。但这取决于站点的性质和负载的性质，这是否适合您的项目。

# c# - 如何对数组列表<>求和

> ID：311710
> 
> 赞同：13
> 
> 时间：2008-11-22T20:03:53.527
> 
> 标签：c#, linq

我有一个 List< int[] > myList，我知道所有 int[] 数组的长度都相同——为了论证，假设我有 500 个数组，每个数组有 2048 个元素长。我想对所有 500 个数组求和，给我一个 2048 个元素长的数组，其中每个元素是所有其他数组中所有相同位置的总和。

显然，这在命令式代码中是微不足道的：

```
int[] sums = new int[myList[0].Length];
foreach(int[] array in myList)
{
    for(int i = 0; i < sums.Length; i++)
    {
        sums[i] += array[i];
    }
} 
```

但我想知道是否有很好的 Linq 或 Enumerable.xxx 技术？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-22T20:25:54.963

编辑：哎哟......当我不看的时候，这变得有点难了。不断变化的需求可能是一个真正的 PITA。

好的，所以取数组中的每个位置，然后求和：

```
var sums = Enumerable.Range(0, myList[0].Length)
           .Select(i => myList.Select(
                     nums => nums[i]
                  ).Sum()
           ); 
```

这有点丑……但我认为声明版本会更糟。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-22T20:09:44.963

编辑：为了感兴趣，我把它留在这里，但接受的答案要好得多。

编辑：好的，我之前的尝试（见编辑历史）基本上是完全错误的......

你*可以*用一行 LINQ 做到这一点，但这太可怕了：

```
var results = myList.SelectMany(array => array.Select(
                                               (value, index) => new { value, index })
                    .Aggregate(new int[myList[0].Length],
                               (result, item) => { result[item.index] += value; return result; }); 
```

我还没有测试过，但我认为它应该可以工作。我不会推荐它。SelectMany 将所有数据展平为一系列对 - 每对都是值，以及它在其原始数组中的索引。

Aggregate 步骤完全不是纯的 - 它通过在正确的点添加正确的值来修改其累加器。

除非有人能想到一种基本旋转原始数据的方法（此时我之前的答案就是您想要的），否则我怀疑您最好以非 LINQ 方式执行此操作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T22:41:16.343

这适用于任何 2 个序列，而不仅仅是数组：

```
var myList = new List<int[]>
{
    new int[] { 1, 2, 3, 4, 5, 6, 7, 8, 9 },
    new int[] { 10, 20, 30, 40, 50, 60, 70, 80, 90 }
};

var sums =
    from array in myList
    from valueIndex in array.Select((value, index) => new { Value = value, Index = index })
    group valueIndex by valueIndex.Index into indexGroups
    select indexGroups.Select(indexGroup => indexGroup.Value).Sum()

foreach(var sum in sums)
{
    Console.WriteLine(sum);
}

// Prints:
//
// 11
// 22
// 33
// 44
// 55
// 66
// 77
// 88
// 99 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-22T21:42:51.330

好的，假设我们可以假设数组列表中每个位置的整数之和本身将适合一个整数（这是一个狡猾的假设，但无论如何我都会让它变得更容易）：

```
int[] sums = 
    Enumerable.Range(0, listOfArrays[0].Length-1).
        Select(sumTotal => 
            Enumerable.Range(0, listOfArrays.Count-1).
                Aggregate((total, listIndex) => 
                    total += listOfArrays[listIndex][sumTotal])).ToArray(); 
```

编辑 - 哦。出于某种原因，.Select 最初避开了我。这样好一点。这是一个小技巧，因为 sumTotal 既作为输入（在 Aggregate 调用中使用的数组中的位置）又作为结果 IEnumerable 中的输出总和，这是违反直觉的。

坦率地说，这比用老式方法做的要可怕得多:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-22T23:10:18.813

这是一个用性能换取 Linq 语句简单性的方法。

```
var colSums = 
   from col in array.Pivot()
   select col.Sum(); 
```

* * *

```
 public static class LinqExtensions {
    public static IEnumerable<IEnumerable<T>> Pivot<T>( this IList<T[]> array ) {
        for( int c = 0; c < array[ 0 ].Length; c++ )
            yield return PivotColumn( array, c );
    }
    private static IEnumerable<T> PivotColumn<T>( IList<T[]> array, int c ) {
        for( int r = 0; r < array.Count; r++ )
            yield return array[ r ][ c ];
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-22T21:57:03.297

我会这样做……但这个解决方案实际上可能非常慢，因此您可能希望在将其部署到性能关键部分之前运行基准测试。

```
var result = xs.Aggregate(
    (a, b) => Enumerable.Range(0, a.Length).Select(i => a[i] + b[i]).ToArray()
); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-06-30T21:52:48.750

它可以用 Zip 和 Aggregate 来完成。这个问题太老了，以至于当时 Zip 可能并不存在。无论如何，这是我的版本，希望对某人有所帮助。

```
List<int[]> myListOfIntArrays = PopulateListOfArraysOf100Ints();
int[] totals = new int[100];
int[] allArraysSum = myListOfIntArrays.Aggregate(
    totals,
    (arrCumul, arrItem) => arrCumul.Zip(arrItem, (a, b) => a + b))
    .ToArray(); 
```

# c# - 减少耦合的简单技巧

> ID：311714
> 
> 赞同：4
> 
> 时间：2008-11-22T20:07:18.683
> 
> 标签：c#

我有一个大型 .NET Web 应用程序。该系统具有用于不同目的的项目（例如 CMS、论坛、电子商务），我注意到调用另一个项目的类的（天真）模式。例如，电子商务模块需要为产品动态生成文件的功能，我调用并引用 CMS 中的一个方法来执行此操作，因为文件处理实际上是 CMS 的工作。

显然（我知道为什么），这是糟糕的设计和高耦合的情况。

我知道一些处理高耦合的方法，比如重组项目（虽然我并不认为这是一个强大的解决方案），但是我还能做些什么来减少高耦合呢？有什么简单的小窍门吗？此外，最好知道它们为什么/如何减少耦合。我使用 .NET 3.5 和 Sql Server 2005，因此 JMS（我在搜索有关此设计问题的提示时不断遇到）之类的东西不适用。

谢谢

* * *

顺便提一句，

我提出这个问题的原因之一是我已经阅读了与此类似的先前问题，但通常如果再次提出之前提出的问题，则可以通过不同的人回复帖子来学习不同的技巧。

我知道依赖注入/IOC，但我对可以减少耦合的小事情很感兴趣。

*在决定如何*减少耦合时，如何在使用静态类、接口派生类或 IOC 方法之间进行选择？此外，我可以开发一个可以调用静态类的 Web 服务——在我的解决方案中混合这些方法。

有趣的是，在我的应用程序中，我不希望它脱节。所以我只有一个论坛、电子商务系统和任何其他所需的模块，但一切都必须整合到一个站点中，因此每个模块（在我的 Visual Studio 解决方案中表示为一个专用项目）需要了解所有其他模块和工作用它。例如，我可能有一个处理用户配置文件的模块（使用 ASP.NET 成员资格、角色等），但这将与论坛模块一起使用，因为论坛上的用户将是网站上的注册用户（一个全程登录），他或她的个人资料将来自用户个人资料模块。这与我遇到的其他网站上看到的单独配置文件相反）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-22T20:16:40.740

您应该在其他项目需要的项目中公开 Web 服务。这是 SOA 背后的基本理念。因此，我将创建 Web 服务并使用它们，这将使您与现在拥有它的方式脱钩。希望这可以帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-22T20:19:38.517

我会考虑首先对紧密耦合的部分进行“提取接口”重构。例如，如果使用 CMS 作为后备存储，创建一个可以存储东西的接口，然后创建一个了解 CMS 的中介器或适配器类，但将了解存储机制细节的逻辑隔离到该类。

然后，为了进行测试，您可以轻松地替换不依赖于 CMS 启动的内存存储或本地文件系统存储。

如果简单的工厂不能为您提供所需的灵活性，请考虑使用依赖注入等技术（请参阅 StructureMap、Spring.Net、NInject）来简化实例化。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-22T20:48:41.267

听起来你有分层问题。您的程序集应该有一个依赖循环——从最不稳定到最稳定。这使您可以明智地进行版本控制。通常，该循环类似于 UI（最不稳定）-> 域核心（稳定）-> 数据访问（最稳定）。您可以在此过程中加入实用程序或一些基础设施程序集，但同样 - 它们应该被认为比依赖它们的程序集更稳定。

我猜你的 App.ECommerce 和 App.Cms 程序集是兄弟而不是层 - 所以你不希望它们相互依赖，但这并不意味着你不能重用功能。对于您的特定场景，您需要将所需的功能下推到电子商务和 Cms 都可以依赖的核心或实用程序程序集。如果它是 ECommerce 提供的特定实现，那么您可以将接口或抽象基类推送到核心 - 并让更高层（可能是 IoC 容器）将具体的 Cms.FileCreator 类连接到 ECommerce.IFileCreator 依赖项。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-22T20:57:20.377

1.  按照其他人的描述（接口等）进行适当的抽象。针对抽象而不是具体的程序。
2.  如您所描述的，在设计类时要考虑依赖注入。
3.  使用[反转控制容器](http://martinfowler.com/articles/injection.html)作为砖块之间的砂浆。

来自[Patterns & Practices](http://msdn.microsoft.com/en-us/practices/default.aspx)团队的[Unity补充了 Enterprise Library。](http://www.codeplex.com/unity)

Scott Hanselman 有一个很好[的 .NET Inversion of Control Containers 列表](http://www.hanselman.com/blog/ListOfNETDependencyInjectionContainersIOC.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-22T20:19:05.710

好吧，我对 .NET 一无所知，但是如何将通用代码重构为一个单独的底层项目/层呢？Web 应用程序中的大量内容可以通用地完成以适应 CMS、论坛和电子商务，写入文件就是一个很好的例子。

另一种方法是将论坛和电子商务视为 CMS 中的模块，这也是有意义的。然后他们可以安全地使用 CMS 的指定 API:s。

# sql - SQL查询返回按键排序的行加上缺少键的空行

> ID：311725
> 
> 赞同：3
> 
> 时间：2008-11-22T20:13:16.127
> 
> 标签：sql

我有一个表，它本质上是这样的结构：

```
核心价值
 ------ ------
 2 值 1
 3 值 2
 5 值 3
```

键是从 1 到（当前）100 万的连续整数，每天增加几千。删除记录时会出现键中的间隙。

我正在寻找返回以下内容的 SQL 查询：

```
核心价值
 ------ ------
 1
 2 值 1
 3 值 2
 4
 5 值 3
```

我可以看到如何通过加入具有完整键列表的第二个表来执行此操作。但是，我更喜欢使用标准 SQL 的解决方案（没有存储过程或第二个键表），无论键的上限值是多少，它都可以工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T20:34:33.900

SQL 查询没有循环机制。过程语言有循环，但查询本身只能“循环”它们在表（或派生表）中找到的数据。

我动态生成数字列表的方法是在数字 0 到 9 的小表格上进行交叉连接：

```
CREATE TABLE n (d NUMERIC);
INSERT INTO n VALUES (0), (1), (2), (3), (4), (5), (6), (7), (8), (9); 
```

然后生成 00..99：

```
SELECT n1.d + n2.d*10 AS d
FROM n AS n1 CROSS JOIN n AS n10; 
```

如果你只想要 00..57：

```
SELECT n1.d + n2.d*10 AS d
FROM n AS n1 CROSS JOIN n AS n2
WHERE n1.d + n2.d*10 <= 57; 
```

您当然可以为 100 的位置、1000 的位置等加入表。请注意，您不能在 WHERE 子句中使用列别名，因此您必须重复完整的表达式。

现在您可以将其用作`FROM`子句中的派生表并将其连接到您的数据表。

```
SELECT n0.d, mytable.value
FROM
   (SELECT n1.d + n2.d*10 + n2.d*100 + n3.d*1000 
      + n4.d*10000 + n5.d*100000 AS d
    FROM n AS n1 CROSS JOIN n AS n2 CROSS JOIN n AS n3 
      CROSS JOIN n AS n4 CROSS JOIN n AS n5) AS n0
  LEFT OUTER JOIN mytable ON (n0.d = mytable.key)
WHERE n0.d <= (SELECT MAX(key) FROM mytable); 
```

`CROSS JOIN`每次您的表超过一个数量级时，您确实需要添加另一个。例如，当它增长到超过 100 万时，为`n6`.

另请注意，我们现在可以在外部查询的 WHERE 子句中使用列别名。

诚然，仅在 SQL 中执行此操作可能是一个非常昂贵的查询。您可能会发现通过编写一些应用程序代码来“填补空白”既简单又快捷。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T21:46:03.490

另一种方法是创建一个包含数百万个数字的结果集，并将其用作连接的基础。这可能会为您完成这项工作。（从[ASKTOMs](http://asktom.oracle.com/pls/asktom) [博客](http://tkyte.blogspot.com/2005/12/asktom-redux.html)偷来的）

```
select  level
from    dual
connect by level <= 1000000 
```

产生这样的东西

```
WITH 
upper_limit AS
(
    select 1000000 limit from dual
),
fake_table AS
(
    select  level key
    from    dual
    connect by level <= (select limit from upper_limit)
)
select key, value
from table, fake_table
where fake_table.key = table.key(+) 
```

我不在工作，所以我无法测试这个。你的旅费可能会改变。我在工作中使用 Oracle。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T20:54:02.333

在 MySQL 中，您可以通过使用正负偏移量对自身执行左连接来找到间隙的边缘。

例如：

```
create table seq ( i int primary key, v varchar(10) );

insert into seq values( 2, 'val1' ), (3, 'val2' ), (5, 'val3' );

select s.i-1 from seq s left join seq m on m.i = (s.i -1) where m.i is null;

+-------+
| s.i-1 |
+-------+
|     1 |
|     4 |
+-------+

select s.i+1 from seq s left join seq m on m.i = (s.i +1) where m.i is null;
+-------+
| s.i+1 |
+-------+
|     4 |
|     6 |
+-------+ 
```

这并不能完全满足您的需求，但可以提供足够的信息来确定丢失的行是什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T20:57:41.967

```
WITH range (num) AS (
SELECT 1 -- use your own lowerbound
UNION ALL
SELECT 1 + num FROM range
WHERE num < 10 -- use your own upper bound
)
SELECT r.num, y.* FROM range r left join yourtable y
on r.num = y.id 
```

# scripting - 人们会推荐什么语言作为可用作在 Cygwin 上运行的脚本的输入的简单 GUI？

> ID：311730
> 
> 赞同：0
> 
> 时间：2008-11-22T20:18:58.020
> 
> 标签：scripting, cygwin, gui-designer

我需要一个简单的窗口，其中包含三个输入框和三个标签（登录名、密码和服务器节点）以及一个执行脚本的按钮。我不想要任何需要在 Windows 上安装的第三方程序。如果它可以安装在 Cygwin 上，那就太好了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T20:54:43.297

您可能想查看 Tcl/Tk 以及 starkits 和 starpacks 的概念。使用后者，您可以创建一个单文件 Windows 可执行文件，这样您的最终用户就不必安装除此程序之外的任何东西。

通过使用 tk 8.5，您还将获得本机 Windows 小部件的好处，因此 GUI 看起来非常专业。

代码看起来像这样：

```
package require Tk 8.5
proc main {} {
    ttk::frame .f
    ttk::label .l1 -text "Username:" -anchor e
    ttk::label .l2 -text "Password:" -anchor e
    ttk::label .l3 -text "Server:" -anchor e
    ttk::entry .e1 -textvariable data(username)
    ttk::entry .e2 -textvariable data(password) -show *
    ttk::entry .e3 -textvariable data(server)
    ttk::button .b1 -text "Submit" -command run

    grid .l1 .e1 -sticky ew -in .f -padx 4
    grid .l2 .e2 -sticky ew -in .f -padx 4
    grid .l3 .e3 -sticky ew -in .f -padx 4
    grid x   .b1 -sticky e -row 4 -in .f -padx 4 -pady 4

    grid rowconfigure .f 3 -weight 1
    grid columnconfigure .f 1 -weight 1

    pack .f -side top -fill both -expand true

    focus .e1
}

proc run {} {
    global data
    puts "username: $data(username)"
    puts "password: $data(password)"
    puts "server: $data(server)"
}

main 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T20:43:12.073

很多人曾经使用 TCL/TK 来做这种事情（在 cygwin 中）。

如果它仅适用于 Windows，那么任何使用 Winforms 的 .NET 语言都将很容易使用（除非您有较旧的盒子，否则不需要分发 .NET）。

# wpf - Wpf 自定义控件模板 - 相对字体大小

> ID：311734
> 
> 赞同：6
> 
> 时间：2008-11-22T20:19:49.907
> 
> 标签：wpf, templates, custom-controls

我正在创建一个自定义 WPF 控件，为了简单起见，它有一个带有“标题”TextBlock 的垂直堆栈面板，后跟一个 ContentPresenter。我希望“标题”的字体大小比内容中使用的大小大 5 磅，内容由用户放置此控件的任何容器继承。

如何在控件模板中使用相对值为标题元素指定字体大小，而不向用户公开诸如“TitleFontSize”之类的属性？我想做“加5”。

我尝试在标题文本块上使用 ScaleTransform 并产生混合结果（文本块缩放很好，但方向已修改 - 我让文本右对齐，并且在缩放时它“离开了控制”区域）。另外，我不确定缩放变换在这里是否合适。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-02-03T03:18:35.920

更通用的方法

**值转换器**

```
public class MathConverter : IValueConverter
{
    public object Convert( object value, Type targetType, object parameter, CultureInfo culture )
    {
        return (double)value + double.Parse( parameter.ToString() );
    }

    public object ConvertBack( object value, Type targetType, object parameter, CultureInfo culture )
    {
        return null;
    }
} 
```

**转换器资源**

```
<my:MathConverter x:Key="MathConverter" /> 
```

**XAML**

```
<TextBlock FontSize="{Binding
                     RelativeSource={RelativeSource AncestorType={x:Type Window}},
                     Path=FontSize,
                     Converter={StaticResource MathConverter},
                     ConverterParameter=2}" /> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-22T20:56:17.087

我使用 IValueConverter 进行了如下操作：

创建了一个派生自 IValueConverter 的类 FontSizeConverter。Convert 方法将值加 10，ConvertBack 方法减 10。

```
public class FontSizeConverter : IValueConverter
{

    #region IValueConverter Members

    public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        return (double)value + 12.0;
    }

    public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        return (double)value - 12.0;
    }

    #endregion
} 
```

接下来，我在控件的 XAML 模板中声明了此类的一个实例：

```
<Style.Resources>
        <local:FontSizeConverter x:Key="fontSizeConverter"/>
</Style.Resources> 
```

最后，FontSize 绑定使用此转换器应用于继承的 FontSize 属性：

```
<TextBlock FontSize="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=FontSize, Converter={StaticResource fontSizeConverter}}" 
                                   Grid.Row="0" Text="{Binding RelativeSource={RelativeSource TemplatedParent}, 
                                   Path=Date.Day}" HorizontalAlignment="Right" VerticalAlignment="Top" Padding="2" Margin="2" >
 </TextBlock> 
```

这行得通。但我仍然不知道这是否是正确的答案。让我知道是否有更好的方法，或者这是否合适。

# c++ - 检查 X 是否通过 typeid 从 Y 派生

> ID：311735
> 
> 赞同：0
> 
> 时间：2008-11-22T20:20:49.577
> 
> 标签：c++, casting, typeid

我需要将指针转换为 long (SendMessage())，并且我想安全地检查另一侧的变量是否正确。所以我正在考虑做 dynamic_cast 但这不适用于非虚拟的类。然后我想到了做 typeid 但这将工作，直到我将派生的 var 作为它的基础。

有什么方法可以检查指针是否是我在运行时所期望的？有没有办法我可以使用 typeid 来查看指针是否是从特定基派生的类型？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T22:17:29.760

您提到的`SendMessage()`使我听起来像 MS Windows 是您的平台，然后建议阅读[使用指针的规则 (Windows) 。](http://msdn.microsoft.com/en-us/library/aa384242(VS.85).aspx)它详细介绍了Microsoft 在此类情况下为您提供的功能和其他内容`PtrToLong`。`PtrToUlong`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T20:51:16.333

如果你只有一个`long`，那么你真的无能为力。没有通用的方法来确定任意数字是否代表有效的内存地址。即使你知道它是一个有效的内存地址，也没有办法确定指针指向的东西的类型。如果在它的地址被转换为之前你不能确定事物的真实类型`long`，那么你就不能确定将它转换为`long`你计划转换为的任何类型是安全的。

您只需要相信消息的发件人已向您发送了一个有效值。您能做的最好的事情是采取一些预防措施，以减少您自己的程序收到虚假值时的后果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T22:00:57.690

您不能使用 typeid。如果您得到垃圾而不是有效指针，它将导致访问冲突，因此您的检查是无意义的。

您应该做的是将您的 SendMessage 和处理消息的代码包装到一个类型安全的接口中。这样，您将无法将意外的东西传递给 SendMessage，并且不需要对接收方进行任何检查。

C++ 类型系统在编译时工作。一旦将指针转换为 long，就会丢失所有类型信息。long 只是内存中的很多位。您无法确定它指向一个对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T20:37:03.117

PTLib ( [http://sourceforge.net/projects/opalvoip/](http://sourceforge.net/projects/opalvoip/) ) 使用 PCLASSINFO 宏来定义类之间的关系。这提供了 IsDescendant 和 GetClass 等函数。

您可能可以实现类似的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-22T20:37:33.350

dynamic_cast 通过检查虚拟方法表的签名来工作。如果你没有虚拟方法，你就没有 VMT，所以正如你所说的 dynamic_cast 将不起作用。但是，如果您没有 VMT，则您绝对不知道所指向的对象。

您最好的选择是要求指针指向具有至少一个虚拟方法的类，即使它是一个虚拟方法。动态转换将起作用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-22T20:46:09.243

我还不明白你的问题是关于什么的。

*   如果您是否可以确定转换为 long 和 back 将产生相同的值，请查看[Safely checks the type of a variable](https://stackoverflow.com/questions/311102/safely-checking-the-type-of-a-variable#311189)
    给定“使用指针的规则”MS-Site 链接到的另一个应答器，正确要转换为的类型是`UINT_PTR`。因此，您确实`UINT_PTR v = reinterpret_cast<UINT_PTR>(ptr);`要转换为整数类型，然后执行相反的操作以再次将其转换回指针。C++ 标准保证恢复原始值。（有关我对此的解释，请参见我上面给出的链接）。顺便说一下，那个微软网站还说 WPARAM 和 LPARAM 会根据平台改变它们的大小。所以你可以只使用那个变量`v`和`SendMessage`它。
*   如果这是您如何在另一边检查指针（转换为某种指针类型）是否指向某个对象的方式，那么答案是**您不能**。由于您显然不确定用于发送它的指针类型，因此您无法在接收端检查指针指向的动态类型是什么。如果您知道指针在发送方的类型，则首先不需要您的检查。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-24T18:53:33.510

在 Windows 中，MFC 提供了一种方法来检查给定的指针是否指向有效的内存位置（这是通过捕获 segfault 来完成的）。我不记得函数名，但它在那里。尽管如此，它并不能确保指向的内存内容是有效的。它可能仍然有无效的 VMT 并使您的代码崩溃。当然，您可以自己捕获段错误（[请参阅 MS 知识库](http://msdn.microsoft.com/en-us/library/s58ftw19(VS.80).aspx)）

至于检查某物是否属于一种类型，您必须从一个基类开始。如果将基类的析构函数设为“虚拟”，则所有派生类都将具有 VMT。

如果您必须不惜一切代价避免 VMT，则必须有某种标识符来告诉您正在处理的内容，例如 MS Windows 事件中的事件类型。

# python - 在 Python 中通过正则表达式解析 GPS 接收器输出

> ID：311763
> 
> 赞同：13
> 
> 时间：2008-11-22T20:50:33.743
> 
> 标签：python, regex, parsing, gps, nmea

我有一个朋友正在完成他的航空航天工程硕士学位。对于他的最后一个项目，他在一个小团队中负责编写一个跟踪气象气球、火箭和卫星的程序。该程序接收来自 GPS 设备的输入，对数据进行计算，并使用这些计算的结果来控制一系列电机，这些电机旨在定位定向通信天线，因此气球、火箭或卫星始终保持焦点。

虽然我自己有点（永恒的）初学者，但我比我的朋友有更多的编程经验。因此，当他向我征求意见时，我说服他用我选择的语言 Python 编写程序。

在项目的这一点上，我们正在处理解析来自 GPS 设备的输入的代码。这是一些示例输入，我们需要提取的数据以粗体显示：

$GPRMC,092204.999, **4250.5589,S,14718.5084,E** ,1,12,24.4, **89.6** ,M,,,0000*1F $GPRMC,093345.679, **4234.7899,N,11344.2567,** **W** , 3,02,24.5,0.1 ,,,0000*1F $GPRMC,044584.936, **1276.5539,N,88734.1543,E** ,2,04,33.5, **600.323** ,M,,,*00 $GPRMC,199304.973, **3248.7780,N,11355.7832,W** ,1, 02.2, **25722.5** ,M,,,*00 $GPRMC,066487.954, **4572.0089,S,45572.3345,W** ,3,09,15.0, **35000.00** ,M,,,*1F

以下是对数据的进一步解释：

> “我看起来每行都需要五件东西。请记住，这些区域中的任何一个都可能是空的。这意味着彼此旁边只有两个逗号。例如',,'是两个随时可能满员的领域。他们中的一些人可能只有两个或三个选项，但我认为我不应该指望这一点。

两天前，我的朋友能够从用于跟踪最近气象气球发射的 GPS 接收器获取完整日志。数据很长，所以我把它都放在了[这个 pastebin](http://pastebin.com/f5f5cf9ab)中。

我自己对正则表达式还是很陌生，所以我正在寻求一些帮助。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-22T21:00:01.883

拆分应该可以解决问题。这也是提取数据的好方法：

```
>>> line = "$GPRMC,199304.973,3248.7780,N,11355.7832,W,1,06,02.2,25722.5,M,,,*00"
>>> line = line.split(",")
>>> neededData = (float(line[2]), line[3], float(line[4]), line[5], float(line[9]))
>>> print neededData
(3248.7779999999998, 'N', 11355.7832, 'W', 25722.5) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-22T20:54:18.277

使用 split 比使用正则表达式更简单。

```
>>> line="$GPRMC,092204.999,4250.5589,S,14718.5084,E,1,12,24.4,89.6,M,,,0000*1F "
>>> line.split(',')
['$GPRMC', '092204.999', '4250.5589', 'S', '14718.5084', 'E', '1', '12', '24.4', '89.6', 'M', '', '', '0000*1F ']
>>> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2014-05-30T06:11:12.547

您可以使用[pynmea2](https://github.com/Knio/pynmea2)之类的库来解析 NMEA 日志。

```
>>> import pynmea2
>>> msg = pynmea2.parse('$GPGGA,142927.829,2831.4705,N,08041.0067,W,1,07,1.0,7.9,M,-31.2,M,0.0,0000*4F')
>>> msg.timestamp, msg.latitude, msg.longitude, msg.altitude
(datetime.time(14, 29, 27), 28.524508333333333, -80.683445, 7.9) 
```

免责声明：我是pynmea2的作者

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-24T04:49:39.190

这些是逗号分隔值，因此使用 csv 库是最简单的解决方案。

我将您拥有的样本数据放入 /var/tmp/sampledata，然后我这样做了：

```
>>> import csv
>>> for line in csv.reader(open('/var/tmp/sampledata')):
...   print line
['$GPRMC', '092204.999', '**4250.5589', 'S', '14718.5084', 'E**', '1', '12', '24.4', '**89.6**', 'M', '', '', '0000\\*1F']
['$GPRMC', '093345.679', '**4234.7899', 'N', '11344.2567', 'W**', '3', '02', '24.5', '**1000.23**', 'M', '', '', '0000\\*1F']
['$GPRMC', '044584.936', '**1276.5539', 'N', '88734.1543', 'E**', '2', '04', '33.5', '**600.323**', 'M', '', '', '\\*00']
['$GPRMC', '199304.973', '**3248.7780', 'N', '11355.7832', 'W**', '1', '06', '02.2', '**25722.5**', 'M', '', '', '\\*00']
['$GPRMC', '066487.954', '**4572.0089', 'S', '45572.3345', 'W**', '3', '09', '15.0', '**35000.00**', 'M', '', '', '\\*1F'] 
```

然后，您可以随心所欲地处理数据。在某些值的开头和结尾处的 '**' 看起来有点奇怪，你可能想去掉这些东西，你可以这样做：

```
>> eastwest = 'E**'
>> eastwest = eastwest.strip('*')
>> print eastwest
E 
```

您将不得不将一些值转换为浮点数。例如，样本数据第一行的第三个值是：

```
>> data = '**4250.5589'
>> print float(data.strip('*'))
4250.5589 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-22T23:09:34.040

您还应该首先检查数据的校验和。它是通过对 $ 和 * 之间的字符（不包括它们）进行异或运算并将其与末尾的十六进制值进行比较来计算的。

您的 pastebin 看起来里面有一些损坏的行。这是一个简单的检查，它假设该行以 $ 开头并且末尾没有 CR/LF。要构建更健壮的解析器，您需要搜索“$”并遍历字符串，直到找到“*”。

```
def check_nmea0183(s):
    """
    Check a string to see if it is a valid NMEA 0183 sentence
    """
    if s[0] != '$':
        return False
    if s[-3] != '*':
        return False

    checksum = 0
    for c in s[1:-3]:
        checksum ^= ord(c)

    if int(s[-2:],16) != checksum:
        return False

    return True 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-05T10:04:34.883

如果您需要对 GPS 数据流进行更广泛的分析，这里有一个 pyparsing 解决方案，可将您的数据分解为命名数据字段。我将您的 pastebin'ned 数据提取到文件 gpsstream.txt 中，并使用以下内容对其进行解析：

```
"""
 Parse NMEA 0183 codes for GPS data
 http://en.wikipedia.org/wiki/NMEA_0183

 (data formats from http://www.gpsinformation.org/dale/nmea.htm)
"""
from pyparsing import *

lead = "$"
code = Word(alphas.upper(),exact=5)
end = "*"
COMMA = Suppress(',')
cksum = Word(hexnums,exact=2).setParseAction(lambda t:int(t[0],16))

# define basic data value forms, and attach conversion actions
word = Word(alphanums)
N,S,E,W = map(Keyword,"NSEW")
integer = Regex(r"-?\d+").setParseAction(lambda t:int(t[0]))
real = Regex(r"-?\d+\.\d*").setParseAction(lambda t:float(t[0]))
timestamp = Regex(r"\d{2}\d{2}\d{2}\.\d+")
timestamp.setParseAction(lambda t: t[0][:2]+':'+t[0][2:4]+':'+t[0][4:])
def lonlatConversion(t):
    t["deg"] = int(t.deg)
    t["min"] = float(t.min)
    t["value"] = ((t.deg + t.min/60.0) 
                    * {'N':1,'S':-1,'':1}[t.ns] 
                    * {'E':1,'W':-1,'':1}[t.ew])
lat = Regex(r"(?P<deg>\d{2})(?P<min>\d{2}\.\d+),(?P<ns>[NS])").setParseAction(lonlatConversion)
lon = Regex(r"(?P<deg>\d{3})(?P<min>\d{2}\.\d+),(?P<ew>[EW])").setParseAction(lonlatConversion)

# define expression for a complete data record
value = timestamp | Group(lon) | Group(lat) | real | integer | N | S | E | W | word
item = lead + code("code") + COMMA + delimitedList(Optional(value,None))("datafields") + end + cksum("cksum")

def parseGGA(tokens):
    keys = "time lat lon qual numsats horiz_dilut alt _ geoid_ht _ last_update_secs stnid".split()
    for k,v in zip(keys, tokens.datafields):
        if k != '_':
            tokens[k] = v
    #~ print tokens.dump()

def parseGSA(tokens):
    keys = "auto_manual _3dfix prn prn prn prn prn prn prn prn prn prn prn prn pdop hdop vdop".split()
    tokens["prn"] = []
    for k,v in zip(keys, tokens.datafields):
        if k != 'prn':
            tokens[k] = v
        else:
            if v is not None:
                tokens[k].append(v)
    #~ print tokens.dump()

def parseRMC(tokens):
    keys = "time active_void lat lon speed track_angle date mag_var _ signal_integrity".split()
    for k,v in zip(keys, tokens.datafields):
        if k != '_':
            if k == 'date' and v is not None:
                v = "%06d" % v
                tokens[k] = '20%s/%s/%s' % (v[4:],v[2:4],v[:2])
            else:
                tokens[k] = v
    #~ print tokens.dump()

# process sample data
data = open("gpsstream.txt").read().expandtabs()

count = 0
for i,s,e in item.scanString(data):
    # use checksum to validate input 
    linebody = data[s+1:e-3]
    checksum = reduce(lambda a,b:a^b, map(ord, linebody))
    if i.cksum != checksum:
        continue
    count += 1

    # parse out specific data fields, depending on code field
    fn = {'GPGGA' : parseGGA, 
          'GPGSA' : parseGSA,
          'GPRMC' : parseRMC,}[i.code]
    fn(i)

    # print out time/position/speed values
    if i.code == 'GPRMC':
        print "%s %8.3f %8.3f %4d" % (i.time, i.lat.value, i.lon.value, i.speed or 0) 

print count 
```

您的 pastebin 中的 $GPRMC 记录似乎与您在帖子中包含的记录不太匹配，但您应该能够根据需要调整此示例。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-08-27T13:28:45.853

我建议在您的代码中进行一个小修复，因为如果用于解析上个世纪的数据，则日期看起来像是将来的某个时间（例如 2094 年而不是 1994 年）

我的修正并不完全准确，但我认为在 70 年代之前不存在 GPS 数据。

在 RMC 语句的 def 解析函数中，只需将格式行替换为：

```
p = int(v[4:])
print "p = ", p
if p > 70:
    tokens[k] = '19%s/%s/%s' % (v[4:],v[2:4],v[:2])
else:
    tokens[k] = '20%s/%s/%s' % (v[4:],v[2:4],v[:2]) 
```

这将查看年份的两位 yy 数字，并假设过去 70 年我们正在处理上个世纪的句子。通过与今天的日期进行比较并假设将来每次处理一些数据时，它们实际上是上个世纪的数据，可以做得更好

感谢您在上面提供的所有代码......我对此感到很开心。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-02-20T20:56:12.167

这是一个[GPRMC](http://aprs.gids.nl/nmea/#rmc)字符串。拆分字符串后，需要解析纬度和经度值。

```
line = "$GPRMC,199304.973,3248.7780,N,11355.7832,W,1,06,02.2,25722.5,M,,,*00"
line = line.split(",") 
```

经纬度部分（`[..., '3248.7780', 'N', '11355.7832, 'W', ...]`）：

*   第一个数字不是纯数字，它是一个像字符串一样连接的数字。我的意思是，`3248.7780`指`32`度数，`48.7780`分钟（纬度）
*   第二个数字（`11355.7832`）指`113`度、`55.7832`分（经度）

它们不能按原样在公式中使用。它们必须转换为十进制度。

```
def toDD(s):
    d = float(s[:-7])
    m = float(s[-7:]) / 60
    return d + m

lat_lon = (toDD(line[2]), line[3], toDD(line[4]), line[5])
print(lat_lon)

# (32.81296666666667, 'N', 113.92972, 'W') 
```

# sql - 从表中选择，然后在存储过程中形成一个空格分隔的字符串

> ID：311768
> 
> 赞同：1
> 
> 时间：2008-11-22T20:54:11.880
> 
> 标签：sql, sql-server

我想从一个表中选择大约 4-5 行，然后形成一个空格分隔的字符串。

所有这些都将在存储过程（SQL server 2005）中完成。

这可能吗？

然后，我将使用这个以空格分隔的字符串并将其保存到另一个表中。

**更新**

```
SELECT *
FROM Users
WHERE userID < 10 
```

输出：

```
john
jake
blah
sam 
```

所以，把它放在一个空格分隔的字符串中：

'约翰杰克布拉萨姆'

并将该字符串保存到表中的另一行。

所有这些都必须在存储过程中完成（如果可能）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T21:14:28.173

```
DECLARE @firstnames varchar(max)

SELECT 
    @firstnames = COALESCE(@firstnames + ' ', '') + FirstName 
FROM 
    Users 
WHERE 
    UserId < 10

INSERT INTO OtherTable (OtherColumn) VALUES (@firstNames) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T21:02:31.363

我认为这样的事情会起作用：

```
DECLARE @whatever varchar(max)  -- or varchar(1000) or whatever size
SET @whatever = ''

SELECT @whatever = @whatever + MyColumn + ' ' FROM MyTable 
```

# python - 在 Python 中创建具有初始容量的列表

> ID：311775
> 
> 赞同：213
> 
> 时间：2008-11-22T20:56:41.313
> 
> 标签：python, list, dictionary, initialization

这样的代码经常发生：

```
l = []
while foo:
    # baz
    l.append(bar)
    # qux 
```

如果您要将数千个元素附加到列表中，这真的很慢，因为必须不断调整列表的大小以适应新元素。

在 Java 中，您可以创建一个具有初始容量的 ArrayList。如果您知道您的列表有多大，这将更有效率。

我知道这样的代码通常可以重构为列表理解。但是，如果*for* / *while*循环非常复杂，这是不可行的。我们的 Python 程序员有没有等价物？

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2008-11-22T22:02:34.847

## 警告：这个答案是有争议的。看评论。

```
def doAppend( size=10000 ):
    result = []
    for i in range(size):
        message= "some unique object %d" % ( i, )
        result.append(message)
    return result

def doAllocate( size=10000 ):
    result=size*[None]
    for i in range(size):
        message= "some unique object %d" % ( i, )
        result[i]= message
    return result 
```

**结果**。（评估每个功能 144 次并平均持续时间）

```
simple append 0.0102
pre-allocate  0.0098 
```

**结论**。这几乎不重要。

过早的优化是万恶之源。

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2008-11-22T21:07:18.873

Python 列表没有内置的预分配。如果你真的需要制作一个列表，并且需要避免附加的开销（并且你应该验证你这样做），你可以这样做：

```
l = [None] * 1000 # Make a list of 1000 None's
for i in xrange(1000):
    # baz
    l[i] = bar
    # qux 
```

也许您可以通过使用生成器来避免列表：

```
def my_things():
    while foo:
        #baz
        yield bar
        #qux

for thing in my_things():
    # do something with thing 
```

这样，列表根本不会全部存储在内存中，只是根据需要生成。

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2011-04-04T00:48:00.617

短版：使用

```
pre_allocated_list = [None] * size 
```

预先分配一个列表（也就是说，能够处理列表的“大小”元素，而不是通过附加来逐渐形成列表）。此操作*非常*快，即使在大列表上也是如此。分配稍后将分配给列表元素的新对象将花费*更长的*时间，并且在性能方面将成为您程序*的*瓶颈。

长版：

我认为应该考虑初始化时间。

由于在 Python 中一切都是引用，因此无论您将每个元素设置为*None*还是某个字符串都无关紧要——无论哪种方式，它都只是一个引用。如果您想为每个要引用的元素创建一个新对象，则需要更长的时间。

对于 Python 3.2：

```
import time
import copy

def print_timing (func):
  def wrapper (*arg):
    t1 = time.time()
    res = func (*arg)
    t2 = time.time ()
    print ("{} took {} ms".format (func.__name__, (t2 - t1) * 1000.0))
    return res

  return wrapper

@print_timing
def prealloc_array (size, init = None, cp = True, cpmethod = copy.deepcopy, cpargs = (), use_num = False):
  result = [None] * size
  if init is not None:
    if cp:
      for i in range (size):
          result[i] = init
    else:
      if use_num:
        for i in range (size):
            result[i] = cpmethod (i)
      else:
        for i in range (size):
            result[i] = cpmethod (cpargs)
  return result

@print_timing
def prealloc_array_by_appending (size):
  result = []
  for i in range (size):
    result.append (None)
  return result

@print_timing
def prealloc_array_by_extending (size):
  result = []
  none_list = [None]
  for i in range (size):
    result.extend (none_list)
  return result

def main ():
  n = 1000000
  x = prealloc_array_by_appending(n)
  y = prealloc_array_by_extending(n)
  a = prealloc_array(n, None)
  b = prealloc_array(n, "content", True)
  c = prealloc_array(n, "content", False, "some object {}".format, ("blah"), False)
  d = prealloc_array(n, "content", False, "some object {}".format, None, True)
  e = prealloc_array(n, "content", False, copy.deepcopy, "a", False)
  f = prealloc_array(n, "content", False, copy.deepcopy, (), False)
  g = prealloc_array(n, "content", False, copy.deepcopy, [], False)

  print ("x[5] = {}".format (x[5]))
  print ("y[5] = {}".format (y[5]))
  print ("a[5] = {}".format (a[5]))
  print ("b[5] = {}".format (b[5]))
  print ("c[5] = {}".format (c[5]))
  print ("d[5] = {}".format (d[5]))
  print ("e[5] = {}".format (e[5]))
  print ("f[5] = {}".format (f[5]))
  print ("g[5] = {}".format (g[5]))

if __name__ == '__main__':
  main() 
```

评估：

```
prealloc_array_by_appending took 118.00003051757812 ms
prealloc_array_by_extending took 102.99992561340332 ms
prealloc_array took 3.000020980834961 ms
prealloc_array took 49.00002479553223 ms
prealloc_array took 316.9999122619629 ms
prealloc_array took 473.00004959106445 ms
prealloc_array took 1677.9999732971191 ms
prealloc_array took 2729.999780654907 ms
prealloc_array took 3001.999855041504 ms
x[5] = None
y[5] = None
a[5] = None
b[5] = content
c[5] = some object blah
d[5] = some object 5
e[5] = a
f[5] = []
g[5] = () 
```

正如你所看到的，仅仅对同一个*None*对象创建一个大的引用列表只需要很少的时间。

前置或扩展需要更长的时间（我没有平均任何东西，但是在运行几次之后，我可以告诉你扩展和附加大约需要相同的时间）。

为每个元素分配新对象——这是最耗时的。S.Lott[的回答](https://stackoverflow.com/questions/311775/create-a-list-with-initial-capacity-in-python/311833#311833)就是这样做的——每次都格式化一个新字符串。这不是严格要求的 - 如果您想预先分配一些空间，只需制作一个 None 列表，然后随意将数据分配给列表元素。无论哪种方式，生成数据都比追加/扩展列表花费更多的时间，无论是在创建列表时生成它，还是之后生成它。但是，如果您想要一个人口稀少的列表，那么从*None*列表开始肯定会更快。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2014-06-11T22:21:01.730

Pythonic 的方法是：

```
x = [None] * numElements 
```

或者您希望预填充的任何默认值，例如

```
bottles = [Beer()] * 99
sea = [Fish()] * many
vegetarianPizzas = [None] * peopleOrderingPizzaNotQuiche 
```

（*警告 Emptor*：`[Beer()] * 99`语法创建*一个* `Beer`，然后用 99 个对同一单个实例的引用填充一个数组）

Python 的默认方法可能非常有效，尽管随着元素数量的增加效率会下降。

比较

```
import time

class Timer(object):
    def __enter__(self):
        self.start = time.time()
        return self

    def __exit__(self, *args):
        end = time.time()
        secs = end - self.start
        msecs = secs * 1000  # Millisecs
        print('%fms' % msecs)

Elements   = 100000
Iterations = 144

print('Elements: %d, Iterations: %d' % (Elements, Iterations))

def doAppend():
    result = []
    i = 0
    while i < Elements:
        result.append(i)
        i += 1

def doAllocate():
    result = [None] * Elements
    i = 0
    while i < Elements:
        result[i] = i
        i += 1

def doGenerator():
    return list(i for i in range(Elements))

def test(name, fn):
    print("%s: " % name, end="")
    with Timer() as t:
        x = 0
        while x < Iterations:
            fn()
            x += 1

test('doAppend', doAppend)
test('doAllocate', doAllocate)
test('doGenerator', doGenerator) 
```

和

```
#include <vector>
typedef std::vector<unsigned int> Vec;

static const unsigned int Elements = 100000;
static const unsigned int Iterations = 144;

void doAppend()
{
    Vec v;
    for (unsigned int i = 0; i < Elements; ++i) {
        v.push_back(i);
    }
}

void doReserve()
{
    Vec v;
    v.reserve(Elements);
    for (unsigned int i = 0; i < Elements; ++i) {
        v.push_back(i);
    }
}

void doAllocate()
{
    Vec v;
    v.resize(Elements);
    for (unsigned int i = 0; i < Elements; ++i) {
        v[i] = i;
    }
}

#include <iostream>
#include <chrono>
using namespace std;

void test(const char* name, void(*fn)(void))
{
    cout << name << ": ";

    auto start = chrono::high_resolution_clock::now();
    for (unsigned int i = 0; i < Iterations; ++i) {
        fn();
    }
    auto end = chrono::high_resolution_clock::now();

    auto elapsed = end - start;
    cout << chrono::duration<double, milli>(elapsed).count() << "ms\n";
}

int main()
{
    cout << "Elements: " << Elements << ", Iterations: " << Iterations << '\n';

    test("doAppend", doAppend);
    test("doReserve", doReserve);
    test("doAllocate", doAllocate);
} 
```

在我的 Windows 7 [Core i7](https://en.wikipedia.org/wiki/Intel_Core#Core_i7)上，64 位 Python 提供

```
Elements: 100000, Iterations: 144
doAppend: 3587.204933ms
doAllocate: 2701.154947ms
doGenerator: 1721.098185ms 
```

虽然 C++ 提供（使用[Microsoft Visual C++](https://en.wikipedia.org/wiki/Microsoft_Visual_C%2B%2B)构建，64 位，已启用优化）

```
Elements: 100000, Iterations: 144
doAppend: 74.0042ms
doReserve: 27.0015ms
doAllocate: 5.0003ms 
```

C++ 调试版本产生：

```
Elements: 100000, Iterations: 144
doAppend: 2166.12ms
doReserve: 2082.12ms
doAllocate: 273.016ms 
```

这里的重点是，使用 Python，您可以实现 7-8% 的性能提升，如果您认为自己正在编写高性能应用程序（或者如果您正在编写用于 Web 服务或其他东西的东西），那么这不是被嗤之以鼻的，但你可能需要重新考虑你的语言选择。

此外，这里的 Python 代码并不是真正的 Python 代码。在这里切换到真正的 Pythonesque 代码可以提供更好的性能：

```
import time

class Timer(object):
    def __enter__(self):
        self.start = time.time()
        return self

    def __exit__(self, *args):
        end = time.time()
        secs = end - self.start
        msecs = secs * 1000  # millisecs
        print('%fms' % msecs)

Elements   = 100000
Iterations = 144

print('Elements: %d, Iterations: %d' % (Elements, Iterations))

def doAppend():
    for x in range(Iterations):
        result = []
        for i in range(Elements):
            result.append(i)

def doAllocate():
    for x in range(Iterations):
        result = [None] * Elements
        for i in range(Elements):
            result[i] = i

def doGenerator():
    for x in range(Iterations):
        result = list(i for i in range(Elements))

def test(name, fn):
    print("%s: " % name, end="")
    with Timer() as t:
        fn()

test('doAppend', doAppend)
test('doAllocate', doAllocate)
test('doGenerator', doGenerator) 
```

这使

```
Elements: 100000, Iterations: 144
doAppend: 2153.122902ms
doAllocate: 1346.076965ms
doGenerator: 1614.092112ms 
```

（在 32 位中，doGenerator 比 doAllocate 做得更好）。

这里 doAppend 和 doAllocate 之间的差距要大得多。

显然，这里的差异真的只适用于你这样做的次数超过几次，或者如果你在一个负载很重的系统上这样做，这些数字将被扩大几个数量级，或者你正在处理相当大的列表。

这里的重点：使用 Pythonic 方式来获得最佳性能。

但是，如果您担心一般的高级性能，那么 Python 是错误的语言。最根本的问题是，由于 Python 的装饰器等特性（*[PythonSpeed/PerformanceTips、Data Aggregation](https://wiki.python.org/moin/PythonSpeed/PerformanceTips#Data_Aggregation)*），传统上 Python 函数调用比其他语言慢 300 倍。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2017-01-12T18:20:35.773

正如其他人所提到的，预置列表的最简单方法是使用`NoneType`对象。

话虽如此，在决定是否有必要之前，您应该了解 Python 列表的实际工作方式。

在列表的[CPython](https://en.wikipedia.org/wiki/CPython)实现中，底层数组总是在创建时有额外的空间，大小逐渐变大`( 4, 8, 16, 25, 35, 46, 58, 72, 88, 106, 126, 148, 173, 201, 233, 269, 309, 354, 405, 462, 526, 598, 679, 771, 874, 990, 1120, etc)`，因此调整列表大小几乎不会经常发生。

Because of this behavior, *most* `list.append()` functions are `O(1)` complexity for appends, only having increased complexity when crossing one of these boundaries, at which point the complexity will be `O(n)`. This behavior is what leads to the minimal increase in execution time in [S.Lott's answer](https://stackoverflow.com/questions/311775/create-a-list-with-initial-capacity-in-python/311833#311833).

Source: *[Python list implementation](http://www.laurentluce.com/posts/python-list-implementation/)*

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-10-21T19:09:38.817

我运行了[S.Lott 的代码](https://stackoverflow.com/questions/311775/create-a-list-with-initial-capacity-in-python/311833#311833)并通过预分配产生了同样 10% 的性能提升。[我使用生成器](https://stackoverflow.com/questions/311775/create-a-list-with-initial-capacity-in-python/311783#311783)尝试了 Ned Batchelder 的想法，并且能够看到生成器的性能优于 doAllocate。对于我的项目来说，10% 的改进很重要，所以感谢大家，因为这对很多人都有帮助。

```
def doAppend(size=10000):
    result = []
    for i in range(size):
        message = "some unique object %d" % ( i, )
        result.append(message)
    return result

def doAllocate(size=10000):
    result = size*[None]
    for i in range(size):
        message = "some unique object %d" % ( i, )
        result[i] = message
    return result

def doGen(size=10000):
    return list("some unique object %d" % ( i, ) for i in xrange(size))

size = 1000
@print_timing
def testAppend():
    for i in xrange(size):
        doAppend()

@print_timing
def testAlloc():
    for i in xrange(size):
        doAllocate()

@print_timing
def testGen():
    for i in xrange(size):
        doGen()

testAppend()
testAlloc()
testGen() 
```

### 输出

```
testAppend took 14440.000ms
testAlloc took 13580.000ms
testGen took 13430.000ms 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-07-30T02:22:33.290

[如果您使用NumPy](https://en.wikipedia.org/wiki/NumPy)会出现有关 Python 中预分配的担忧，因为 NumPy 具有更多类似 C 的数组。在这种情况下，预分配问题与数据的形状和默认值有关。

如果您正在对海量列表进行数值计算并希望获得性能，请考虑使用 NumPy。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-10-27T16:33:12.733

对于某些应用程序，您可能需要字典。例如，在 find_totient 方法中，我发现使用字典更方便，因为我没有零索引。

```
def totient(n):
    totient = 0

    if n == 1:
        totient = 1
    else:
        for i in range(1, n):
            if math.gcd(i, n) == 1:
                totient += 1
    return totient

def find_totients(max):
    totients = dict()
    for i in range(1,max+1):
        totients[i] = totient(i)

    print('Totients:')
    for i in range(1,max+1):
        print(i,totients[i]) 
```

这个问题也可以通过预先分配的列表来解决：

```
def find_totients(max):
    totients = None*(max+1)
    for i in range(1,max+1):
        totients[i] = totient(i)

    print('Totients:')
    for i in range(1,max+1):
        print(i,totients[i]) 
```

我觉得这不是那么优雅并且容易出现错误，因为我正在存储 None 如果我不小心使用错误可能会引发异常，并且因为我需要考虑地图让我避免的边缘情况。

确实，字典不会那么高效，但正如其他人所评论的那样，速度上的**微小**差异并不总是值得**重大**的维护风险。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2008-11-22T21:07:56.767

据我了解，Python 列表已经与 ArrayLists 非常相似。但是如果你想调整那些参数，我在互联网上发现了这篇可能很有趣的帖子（基本上，只需创建你自己的`ScalableList`扩展）：

[http://mail.python.org/pipermail/python-list/2000-May/035082.html](http://mail.python.org/pipermail/python-list/2000-May/035082.html)

# msbuild - MSBuild ITaskItem 数组已过期

> ID：311781
> 
> 赞同：2
> 
> 时间：2008-11-22T21:02:57.133
> 
> 标签：msbuild, msbuild-task, itaskitem

我正在为 MSBuild 创建一个自定义 ITask，它会上传我的构建的输出文件。我正在使用 Web 部署项目来发布我的应用程序并连接到 AfterBuild 目标以完成我的自定义工作。

如果我将文件添加到我的 Web 应用程序，那么在我第一次进行构建时，我的自定义任务无法识别最近添加的文件。为了使该文件显示在我的 ITaskItems 数组中，我必须首先在删除“AfterBuild”目标的情况下进行构建，然后使用“AfterBuild”目标重新开始构建。

这是我的构建文件的样子：

```
<ItemGroup>
    <PublishContent Include="$(OutputPath)\**" />
</ItemGroup>

<Target Name="AfterBuild">
    <UploadTask FilesToPublish="@(PublishContent)" />
</Target> 
```

@(PublishContent) 中的列表似乎是在构建开始时初始化的，而不是反映构建过程本身可能发生的任何更改。

有任何想法吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T21:40:07.200

您的 ItemGroup 将在项目文件首次加载时进行评估（当您首次打开 Visual Studio 或在解决方案资源管理器中“卸载”和“重新加载”项目时）。

您可能需要在“AfterBuild”目标中创建一个 ItemGroup 作为任务。例子：

```
<CreateItem Include="$(OutputPath)\**">
      <Output TaskParameter="Include" ItemName="OutputFiles"/>
</CreateItem> 
```

其次是：

```
<Target Name="AfterBuild">
    <UploadTask FilesToPublish="@(OutputFiles)" />
</Target> 
```

# .net - Microsoft .NET 配置文件的架构 (XSD)

> ID：311782
> 
> 赞同：5
> 
> 时间：2008-11-22T21:04:18.863
> 
> 标签：.net, configuration-files, msdn

我正在 XSD（XML 架构）中搜索 Microsoft .NET 应用程序配置文件。到目前为止，我只发现了这个：[.NET Framework 的配置文件架构，](http://msdn.microsoft.com/en-us/library/1fk1t1t0.aspx)但我对 XSD 更感兴趣。

或者 - 一般问 - 我一般还会在 XSD 中搜索[此处列出](http://msdn.microsoft.com/en-us/library/1xtk877y.aspx)的 .NET 配置文件。

我有 Visual Studio 2008 并没有看到第一个答案中的此类文件...

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-22T22:05:41.597

[DotNetConfig.xsd](https://gist.github.com/eed3si9n/5dd7dd98ad2b3f668928b23477de35a3)由[Peter Ritchie](https://web.archive.org/web/20090421154432/http://peterritchie.com/Hamlet/Downloads/74.aspx)基于`C:\Program Files\Microsoft Visual Studio 8\Xml\Schemas\DotNetConfig.xsd`. 请参阅[架构缓存](http://msdn.microsoft.com/en-us/library/ms255821.aspx)。

# c# - AS400 C#.net 插入新记录问题

> ID：311789
> 
> 赞同：4
> 
> 时间：2008-11-22T21:10:34.483
> 
> 标签：c#, .net, ibm-midrange

我正在尝试构建一个像 AS400 上的 RPG 子文件一样工作的 C#.net 程序。

让一般子文件部分正常工作。我可以显示然后编辑和更新现有记录。

在我试图插入新记录的代码中炸毁了。炸毁

cmd.ExecuteNonQuery();

如果你想看看在没有插入的情况下它是如何工作的，请访问

[http://144.162.90.78/thomas/](http://144.162.90.78/thomas/)

看网站1a

这是代码。

```
using IBM.Data.DB2.iSeries;
using System;
using System.Data;
using System.Configuration;
using System.Collections;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

public partial class WebForm3 : System.Web.UI.Page
{
     protected void btnBack_Click(object sender, EventArgs e)
    {
        Server.Transfer("WebForm1a.aspx");
    }
    protected void btnUpdate_Click(object sender, EventArgs e)
    {
        ConnectionStringSettingsCollection cssc =
            ConfigurationManager.ConnectionStrings;

        String connString = cssc["FTWAS400"].ToString();

        iDB2Connection conn = new iDB2Connection(connString);

        conn.Open();

        iDB2Command cmd = new iDB2Command(
                   "insert into tburrows.qcustcdt (cusnum, init, lstnam, street, city, state, zipcod, cdtlmt, chgcod, baldue, cdtdue) values (@cusnum, @init, @lstnam, @street, @city, @state, @zipcod, @cdtlmt, @chgcod, @baldue, @cdtdue)", conn);

        cmd.DeriveParameters();

        cmd.Parameters["@cusnum"].Value = Request["txtCUSNUM"];
        cmd.Parameters["@init"  ].Value = Request["txtINIT"];
        cmd.Parameters["@lstnam"].Value = Request["txtLSTNAM"];
        cmd.Parameters["@street"].Value = Request["txtSTREET"];
        cmd.Parameters["@city"].Value   = Request["txtCITY"];
        cmd.Parameters["@state"].Value  = Request["txtSTATE"];
        cmd.Parameters["@zipcod"].Value = Request["txtZIPCOD"];
        cmd.Parameters["@cdtlmt"].Value = Request["txtCDTLMT"];
        cmd.Parameters["@chgcod"].Value = Request["txtCHGCOD"];
        cmd.Parameters["@baldue"].Value = Request["txtBALDUE"];
        cmd.Parameters["@cdtdue"].Value = Request["txtCDTDUE"];

        cmd.ExecuteNonQuery();

        cmd.Dispose();
        conn.Close();

        btnBack_Click(sender, e);
    }
} 
```

任何帮助将不胜感激。

托马斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-24T03:19:28.357

内还有另一个选项

```
cmd.Parameters["@cusnum"].Value = field; 
```

指定字段类型。利用

```
cmd.Parameters.Add("@cusnum", iDB2DbType.iDB2Decimal).Value = Convert.ToDecimal(field); 
```

反而。这应该正确转换您的数据类型。如果不是十进制，您需要将 iDB2Decimal 更改为正确的字段类型。

# iphone - Exit Edit Mode

> ID：311800
> 
> 赞同：5
> 
> 时间：2008-11-22T21:25:46.653
> 
> 标签：iphone, cocoa-touch, uitableview

I have an array of objects which populate a UITableView. When a user removes the last object from the array, I automatically create a new "default" object. However, in the TableView, when the user gets there, the list is still in "Edit" mode. Is there a way for me to programatically set the TableView back to "normal" mode again?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-22T22:18:17.933

Set the table's `editing` property to `NO`. [UITableView Reference](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UITableView_Class/Reference/Reference.html#//apple_ref/doc/uid/TP40006943-CH3-SW59)

# php - url 编码的正斜杠破坏了我的 codeigniter 应用程序

> ID：311801
> 
> 赞同：13
> 
> 时间：2008-11-22T21:30:50.637
> 
> 标签：php, url, codeigniter, uri, urlencode

我正在尝试创建一个像这样工作的 url 字符串：

```
/app/process/example.com/index.html 
```

换句话说，

```
/app/process/$URL 
```

然后我检索网址

```
$this->uri->segment(3); 
```

URL 中的正斜杠当然会成为访问 uri 段的问题，所以我将继续对 URL 部分进行 url 编码：

```
/app/process/example.com%2Findex.html 
```

..但现在我只得到一个 404 说...

```
Not Found

The requested URL /app/process/example.com/index.html was not found on this server. 
```

看来我的正斜杠 url 编码破坏了 CI 的 URI 解析器。

我能做些什么来解决这个问题？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-22T23:06:19.197

我认为您收到的错误消息不是来自 codeigniter，而是来自您的网络服务器。

我使用 Apache2 复制了这个，甚至没有使用 CodeIgniter：我创建了一个文件 index.php，然后访问`index.php/a/b/c`- 它工作正常。如果我然后尝试访问`index.php/a/b/c%2F`，我会从 Apache 获得 404。

我通过添加到我的 Apache 配置来解决它：

`AllowEncodedSlashes On`

有关更多信息，请参阅[文档](http://httpd.apache.org/docs/2.2/mod/core.html#allowencodedslashes)

`$config['permitted_uri_chars']`完成此操作后，如果它仍然无法正常工作，您可能需要在 codeigniter 中摆弄- 您可能会发现斜杠被过滤掉了

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T12:05:18.040

解决这个问题的一种方法是用不会破坏 CodeIgniter URI 解析器的东西替换你在 URI 段中传递的 URL 变量中的任何正斜杠。例如：

```
 $uri = 'example.com/index.html';
$pattern = '"/"';
$new_uri = preg_replace($pattern, '_', $uri); 
```

这将用下划线替换所有正斜杠。我敢肯定它类似于您对正斜杠进行编码的操作。然后在其他页面上检索值时，只需使用以下内容：

```
 $pattern = '/_/';
$old_uri = preg_replace($pattern, '/', $new_uri); 
```

它将用正斜杠替换所有下划线，以恢复您的旧 URI。当然，您需要确保您使用的任何字符（在这种情况下为下划线）不会出现在您将传递的任何可能的 URI 中（因此您可能根本不想使用下划线）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T21:40:10.790

使用 CodeIgniter，URL 的路径对应一个控制器，控制器中的一个函数，以及函数的参数。

您的 URL /app/process/example.com/index.html 将对应于 app.php 控制器、内部的 process 函数以及两个参数 example.com 和 index.html：

```
<?php
class App extends Controller {
    function process($a, $b) {
       // at this point $a is "example.com" and $b is "index.html"
    }
}
?> 
```

**编辑：**在重新阅读您的问题时，您似乎想将部分 URL 解释为另一个 URL。为此，您需要编写函数以获取可变数量的参数。为此，您可以使用函数 func_num_args 和 func_get_arg，如下所示：

```
<?php
class App extends Controller {
    function process() {
        $url = "";
        for ($i = 0; $i < func_num_args(); $i++) {
            $url .= func_get_arg($i) . "/";
        }

        // $url is now the url in the address
    }
}
?> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-23T17:00:40.210

在配置文件中更改您的 allowed_uri_chars 索引

```
$config['permitted_uri_chars'] = 'a-z 0-9~%.:_\-'; 
```

# flash - W3C 参与 Flash 和 Silverlight

> ID：311802
> 
> 赞同：-2
> 
> 时间：2008-11-22T21:35:04.200
> 
> 标签：flash, silverlight, w3c

在我看来，Flash/Silverlight 的关键 USP 是能够提供对客户端图形子系统的访问（尽管是间接的），从而实现视频、平滑过渡和“花哨”视觉效果。

这听起来是个好主意，也是 HTML 的自然演变/扩展。但如果像 W3C 这样的人控制这样的技术肯定会更好，而不是微软或 Adob​​e 将用户锁定在他们的“平台”中。

W3C 是否在这些技术的开发中发挥了作用，如果没有，为什么？

澄清：我想我的问题的重点是 - 为什么 W3C 没有在 Flash/Silverlight“方向”上扩展/发展 HTML（或创建另一种技术），而这似乎很明显（至少对 Adob​​e 和 MS 而言），并且是开放的标准平台会更好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T23:45:53.250

W3C 确实创造了另一种技术。

SVG 是一个相当不错的矢量图形标准，它与脚本相结合，可以做很多 Flash 可以做的事情，但都是纯 XML 和 JavaScript，而不是一堆二进制文件。将其称为 Flash 替代品是很棘手的，因为它的工作方式非常不同，但它肯定会遇到一些作为一流浏览器对象实现的相同点。

其中没有视频，但 HTML5 正在攻击这一点（与 HTML5 的大部分其他部分不同，一些浏览器实际上正在实现它）。

当然，如果没有 IE，这些在现实世界中的适用性总是有限的。

[注意：无论如何，Silverlight 和 Flash 都没有真正完全关闭。参见例如。[http://www.adobe.com/devnet/swf/](http://www.adobe.com/devnet/swf/) ]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T23:45:40.753

[使用Canvas HTML 元素](http://en.wikipedia.org/wiki/Canvas_(HTML_element))、[SVG](http://www.w3.org/TR/SVG/)以及HTML5 中的新[音频](http://www.w3.org/html/wg/html5/#audio)和[视频](http://www.w3.org/html/wg/html5/#video)元素，您可以并且将来将能够越来越多地使用 Flash 和 Silverlight 的功能。

请参阅此[3D Canvas](http://lbi.lostboys.nl/blog/artikelen/canvas-in-full-3d/)示例了解当前可能的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T22:28:01.473

W3C 没有真正的权力在专有技术的开发中“发挥作用”。只有拥有该技术的公司决定将其提供给他们，他们才能**获得**这样的角色，而到目前为止，Adobe 和微软都没有这样做。

# c++ - 从 windows ce 设备访问桌面发布目录

> ID：311805
> 
> 赞同：0
> 
> 时间：2008-11-22T21:37:40.857
> 
> 标签：c++, mobile, windows-ce, platform-builder

我正在编写一个测试程序，将设备上的应用程序数据文件夹中的一些文件复制到桌面上的发布目录。

我不确定如何访问桌面上的发布目录？

有没有任何shell命令可以做到这一点？

基本上我想编写将在设备上运行以完成此任务的 c++ 程序。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-22T23:23:01.050

本文介绍了如何使用 RAPI 将文件从 WinCE 设备复制到您的 PC：

[http://www.codeguru.com/cpp/wp/ce/article.php/c3521](http://www.codeguru.com/cpp/w-p/ce/article.php/c3521)

但是，RAPI 是只能在 PC 上运行的东西，因此它不适合您的目的。

有几种方法可以像您想要的那样处理设备发起的通信。在我的世界 (.NET/C#) 中，很容易设置一个在 PC 上运行的简单 ASP.NET Web 服务并让设备与之对话（上传文件，设备会将文件作为字节数组发送，并且然后 Web 服务会将其保存到桌面）。

由于您没有使用 .NET，因此**您最好的解决方案可能是**来自设备的 FTP。这是一篇文章，展示了如何做到这一点：

[http://msdn.microsoft.com/en-us/library/ms901267.aspx](http://msdn.microsoft.com/en-us/library/ms901267.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T01:11:46.913

我找到了解决方案

有一个名为 CoyFile 的 API，可以复制到发布目录。

CopyFile(Src 文件,Dest 文件,FALSE);

目标文件可以给出为

ce::wstring = L"\release\foo.txt";

# c# - 使用返回随机结果的函数进行单元测试

> ID：311807
> 
> 赞同：72
> 
> 时间：2008-11-22T21:40:17.467
> 
> 标签：c#, .net, unit-testing, xunit.net

我不认为这是特定于语言或框架的，但我使用的是 xUnit.net 和 C#。

我有一个函数可以返回一定范围内的随机日期。我传入一个日期，返回日期总是在给定日期之前 1 到 40 年的范围内。

现在我只是想知道是否有一个好的方法来对此进行单元测试。最好的方法似乎是创建一个循环并让函数运行 100 次，并断言这 100 个结果中的每一个都在所需的范围内，这是我目前的方法。

我也意识到，除非我能够控制我的随机生成器，否则不会有完美的解决方案（毕竟，结果是随机的），但我想知道当你必须测试返回随机结果的功能时你会采取什么方法一定范围？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-11-22T21:54:58.467

模拟或伪造随机数生成器

做这样的事情......我没有编译它，所以可能会有一些语法错误。

```
public interface IRandomGenerator
{
    double Generate(double max);
}

public class SomethingThatUsesRandom
{
    private readonly IRandomGenerator _generator;

    private class DefaultRandom : IRandomGenerator
    {
        public double Generate(double max)
        {
            return (new Random()).Next(max);
        }
    }

    public SomethingThatUsesRandom(IRandomGenerator generator)
    {
        _generator = generator;
    }

    public SomethingThatUsesRandom() : this(new DefaultRandom())
    {}

    public double MethodThatUsesRandom()
    {
        return _generator.Generate(40.0);
    }
} 
```

在您的测试中，只需伪造或模拟 IRandomGenerator 以返回罐头。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-11-22T21:48:01.647

除了测试该函数是否返回所需范围内的日期外，您还希望确保结果分布良好。您描述的测试将通过一个简单地返回您发送日期的函数！

因此，除了多次调用该函数并测试结果是否保持在所需范围内之外，我还会尝试评估分布，也许通过将结果放入存储桶并检查存储桶是否具有大致相等数量的结果。完毕。您可能需要超过 100 次调用才能获得稳定的结果，但这听起来不像是一个昂贵的（运行时明智的）函数，因此您可以轻松地运行它几 K 次迭代。

我之前遇到过不统一的“随机”函数的问题。它们可能真的很痛苦，值得尽早测试。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-23T01:41:54.420

我认为您要测试这个问题的三个不同方面。

第一个：我的算法是正确的吗？也就是说，给定一个正常运行的随机数生成器，它会生成随机分布在该范围内的日期吗？

第二个：算法是否正确处理边缘情况？也就是说，当随机数生成器产生最高或最低允许值时，是否有任何中断？

第三个：我的算法实现是否有效？也就是说，给定一个已知的伪随机输入列表，它是否会产生预期的伪随机日期列表？

前两件事不是我要构建到单元测试套件中的东西。在设计系统时，我会证明它们。正如 daniel.rikowski 建议的那样，我可能会通过编写一个生成无数日期并执行卡方检验的测试工具来做到这一点。我还要确保这个测试工具在它处理两种边缘情况之前不会终止（假设我的随机数范围足够小，我可以摆脱这个）。我会记录下来，以便任何前来尝试改进算法的人都知道这是一个突破性的变化。

最后一个*是*我要进行单元测试的东西。我需要知道代码中没有任何东西会破坏该算法的实现。发生这种情况时，我得到的第一个迹象是测试将失败。然后我会回到代码并发现其他人认为他们正在修复某些东西并破坏了它。如果有人*确实*修复了算法，那么他们也必须修复这个测试。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-22T21:45:21.043

您无需控制系统即可使结果具有确定性。您采用了正确的方法：确定函数输出的重要内容并对其进行测试。在这种情况下，重要的是结果在 40 天的范围内，并且您正在对此进行测试。同样重要的是它并不总是返回相同的结果，因此也要对此进行测试。如果你想变得更漂亮，你可以测试结果是否通过了某种随机性测试。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-22T21:43:18.520

通常我完全使用您建议的方法：控制随机生成器。使用默认种子初始化它以进行测试（或用适合我的测试用例的代理返回数字替换他），因此我具有确定性/可测试的行为。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-22T21:52:33.633

如果您想检查随机数的质量（在独立性方面），有几种方法可以做到这一点。一种好方法是[卡方检验](http://en.wikipedia.org/wiki/Chi-square_test)。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-01-29T17:51:23.917

当然，使用固定的种子随机数生成器可以正常工作，但即便如此，您也只是在尝试测试您无法预测的内容。没关系。这相当于有一堆固定的测试。但是，请记住——测试什么是重要的，但不要尝试测试所有内容。我相信随机测试是一种尝试测试所有内容的方法，它效率不高（或速度不快）。在遇到错误之前，您可能必须运行大量随机测试。

我想在这里说明的是，您应该简单地为您在系统中发现的每个错误编写一个测试。您测试边缘情况以确保您的功能即使在极端条件下也能运行，但实际上这是您可以做的最好的事情，而不需要花费太多时间或使单元测试运行缓慢，或者只是浪费处理器周期。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-23T01:50:30.953

根据您的函数创建随机日期的方式，您可能还需要检查非法日期：不可能的闰年，或 30 天月份的第 31 天。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-11-11T12:37:53.637

没有表现出**确定性行为**的方法无法正确进行单元测试，因为结果会因执行而异。解决此问题的一种方法是为[随机](http://en.wikipedia.org/wiki/Random_seed)数生成器植入单元测试的固定值。您还可以提取日期生成类的随机性（从而应用[单一责任原则](http://www.objectmentor.com/resources/articles/srp.pdf)），并为单元测试注入已知值。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-02-02T01:01:10.137

我建议覆盖随机函数。我在 PHP 中进行单元测试，所以我编写了以下代码：

```
// If we are unit testing, then...
if (defined('UNIT_TESTING') && UNIT_TESTING)
{
   // ...make our my_rand() function deterministic to aid testing.
   function my_rand($min, $max)
   {
      return $GLOBALS['random_table'][$min][$max];
   }
}
else
{
   // ...else make our my_rand() function truly random.
   function my_rand($min = 0, $max = PHP_INT_MAX)
   {
      if ($max === PHP_INT_MAX)
      {
         $max = getrandmax();
      }
      return rand($min, $max);
   }
} 
```

然后我根据每次测试的需要设置 random_table。

测试随机函数的真实随机性完全是一个单独的测试。我会避免在单元测试中测试随机性，而是会进行单独的测试，并在您使用的编程语言中搜索随机函数的真正随机性。非确定性测试（如果有的话）应该被排除在单元测试之外。也许有一个单独的套件用于这些测试，这需要人工输入或更长的运行时间，以最大限度地减少失败的可能性，而这实际上是通过。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-05-11T14:16:00.640

我不认为单元测试是为此而生的。您可以对返回随机值但使用固定种子的函数使用单元测试，在这种情况下它们不是随机的，可以这么说，对于随机种子，我认为单元测试不是您想要的，例如对于 RNG，您的意思是进行系统测试，在其中您多次运行 RNG 并查看它的分布或时刻。

# netbeans - 如何在 NetBeans 6.5 IDE 中将“.js.php”与 JavaScript 语法相关联？

> ID：311816
> 
> 赞同：1
> 
> 时间：2008-11-22T21:46:43.507
> 
> 标签：netbeans

当我使用 PHP 生成 CSS 或 JavaScript 文件时，我喜欢使用 .js.php 或 .css.php 文件扩展名。这样我就知道发生了什么。

有没有办法将这些“复合”文件扩展名与它们各自的语言相关联？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-17T16:13:48.660

我不使用 NetBeans 或 PHP，但以下技巧在类似的设置中帮助了我：

```
<?php if(0) { ?><script><?php } ?>
# code goes here
<?php if(0) { ?></script><?php } ?> 
```

只需将 js 代码用`<script>`或未`<style>`呈现的标签包围即可。无需配置任何特殊关联，假设编辑器对 HTML 足够聪明。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T22:15:24.383

我通常做的是将这些“复合”扩展压缩成一个，遵循将.tar.gz 压缩成.tgz 的传统。

# c - 最大化 SDL 窗口

> ID：311818
> 
> 赞同：11
> 
> 时间：2008-11-22T21:48:53.033
> 
> 标签：c, window, sdl, portability

我应该如何告诉 SDL 最大化应用程序窗口？

我正在使用这些标志创建窗口：SDL_OPENGL | SDL_HWSURFACE | SDL_DOUBLEBUF | SDL_RESIZABLE。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2017-09-04T13:56:09.053

所有答案似乎都过时了，现在只需指定`SDL_WINDOW_MAXIMIZED`为`SDL_CreateWindow`.

```
window = SDL_CreateWindow(
    "Foobar",
    SDL_WINDOWPOS_CENTERED, SDL_WINDOWPOS_CENTERED, 1280, 720,
    SDL_WINDOW_OPENGL | SDL_WINDOW_RESIZABLE | SDL_WINDOW_MAXIMIZED
); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2014-05-14T21:08:52.913

在 SDL2.0 中

```
sdl_window = SDL_CreateWindow("title", 10, 30, window_width, window_height, SDL_WINDOW_OPENGL | SDL_WINDOW_RESIZABLE);
SDL_MaximizeWindow(sdl_window);
SDL_GetWindowSize(sdl_window, &window_width, &window_height);
sdl_gl_context = SDL_GL_CreateContext(sdl_window);
SDL_GL_MakeCurrent(sdl_window, sdl_gl_context); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-24T19:51:01.990

当您使用 SDL_RESIZABLE 标志时，此功能由窗口管理器控制。要使用 SDL 模拟最大化窗口，您首先需要确定最大化时窗口将占据的大小。然后在使用[SDL_VIDEO_WINDOW_POS 环境变量](http://libsdl.org/cgi/docwiki.cgi/SDL_envvars)放置窗口后，您将使用此大小调用[SDL_SetVideoMode](http://libsdl.org/cgi/docwiki.cgi/SDL_SetVideoMode)。

如果您确实需要像单击最大化按钮一样最大化窗口，那么您将不得不直接访问底层窗口管理器（即 SDL 不会帮助您）。

例如，[ShowWindow](http://msdn.microsoft.com/en-us/library/ms633548(VS.85).aspx)函数可用于使用 Win32 API 最大化窗口。要获得由 SDL 创建的窗口的句柄，请使用[SDL_GetWMInfo](http://www.libsdl.org/cgi/docwiki.cgi/SDL_GetWMInfo)函数。生成的[SDL_SysWMinfo](http://www.libsdl.org/cgi/docwiki.cgi/SDL_SysWMInfo)结构包含 HWND 类型的*窗口*字段。这必须与 SW_MAXIMIZE 标志一起传递给 ShowWindow 函数。

```
SDL_SysWMinfo info;
SDL_VERSION(&info.version);
SDL_GetWMInfo(&info);
ShowWindow(info.window, SW_MAXIMIZE); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T04:46:25.233

可以设置其他环境变量来控制显示窗口。不幸的是，sdl 文档目前已关闭，因此我无法查找您需要的内容。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-23T06:31:49.607

SDL_FULLSCREEN 是您正在寻找的选项：

```
flags |= SDL_FULLSCREEN;
screen = SDL_SetVideoMode(..., flags); 
```

# linux - 在 Linux 中跟踪本地函数调用的工具

> ID：311840
> 
> 赞同：65
> 
> 时间：2008-11-22T22:12:14.110
> 
> 标签：linux, debugging, trace

我正在寻找像[ltrace](http://linux.die.net/man/1/ltrace)或[strace](http://linux.die.net/man/1/strace)这样可以跟踪可执行文件中本地定义的函数的工具。ltrace 只跟踪动态库调用，strace 只跟踪系统调用。例如，给定以下 C 程序：

```
#include <stdio.h>

int triple ( int x )
{
  return 3 * x;
}

int main (void)
{
  printf("%d\n", triple(10));
  return 0;
} 
```

运行程序`ltrace`将显示调用，`printf`因为这是一个标准库函数（这是我系统上的动态库），`strace`并将显示来自启动代码的所有系统调用、用于实现 printf 的系统调用和关闭代码，但我想要一些能告诉我该函数`triple`已被调用的东西。假设本地函数没有被优化编译器内联并且二进制文件没有被剥离（符号被删除），有没有工具可以做到这一点？

**编辑**

一些澄清：

*   如果该工具还为非本地函数提供跟踪信息，那也没关系。
*   我不想重新编译支持特定工具的程序，可执行文件中的符号信息应该足够了。
*   如果我可以像使用 ltrace/strace 一样使用该工具附加到现有进程，我会非常好。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-11-22T23:44:06.560

假设您只想收到特定功能的通知，您可以这样做：

用调试信息编译（因为你已经有符号信息，你可能也有足够的调试）

给定

```
#include <iostream>

int fac(int n) {
    if(n == 0)
        return 1;
    return n * fac(n-1);
}

int main()
{
    for(int i=0;i<4;i++)
        std::cout << fac(i) << std::endl;
} 
```

使用 gdb 进行跟踪：

```
[js@HOST2 cpp]$ g++ -g3 test.cpp
[js@HOST2 cpp]$ gdb ./a.out
(gdb) b fac
Breakpoint 1 at 0x804866a: file test.cpp, line 4.
(gdb) commands 1
Type commands for when breakpoint 1 is hit, one per line.
End with a line saying just "end".
>silent
>bt 1
>c
>end
(gdb) run
Starting program: /home/js/cpp/a.out
#0  fac (n=0) at test.cpp:4
1
#0  fac (n=1) at test.cpp:4
#0  fac (n=0) at test.cpp:4
1
#0  fac (n=2) at test.cpp:4
#0  fac (n=1) at test.cpp:4
#0  fac (n=0) at test.cpp:4
2
#0  fac (n=3) at test.cpp:4
#0  fac (n=2) at test.cpp:4
#0  fac (n=1) at test.cpp:4
#0  fac (n=0) at test.cpp:4
6

Program exited normally.
(gdb) 
```

这是我收集所有函数地址的方法：

```
tmp=$(mktemp)
readelf -s ./a.out | gawk '
{ 
  if($4 == "FUNC" && $2 != 0) { 
    print "# code for " $NF; 
    print "b *0x" $2; 
    print "commands"; 
    print "silent"; 
    print "bt 1"; 
    print "c"; 
    print "end"; 
    print ""; 
  } 
}' > $tmp; 
gdb --command=$tmp ./a.out; 
rm -f $tmp 
```

请注意，除了打印当前帧（`bt 1`）之外，您还可以做任何您喜欢的事情，打印一些全局的值，执行一些 shell 命令或在遇到`fatal_bomb_exploded`函数时发送一些东西:) 可悲的是，gcc 输出一些“当前语言已更改”之间的消息。但这很容易被发现。没什么大不了的。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-11-27T21:54:57.853

**System Tap**可用于现代 Linux 机器（Fedora 10、RHEL 5 等）。

首先下载[para-callgraph.stp](http://sourceware.org/systemtap/examples/general/para-callgraph.stp)脚本。

然后运行：

```
$ sudo stap para-callgraph.stp 'process("/bin/ls").function("*")' -c /bin/ls
0    ls(12631):->main argc=0x1 argv=0x7fff1ec3b038
276  ls(12631): ->human_options spec=0x0 opts=0x61a28c block_size=0x61a290
365  ls(12631): <-human_options return=0x0
496  ls(12631): ->clone_quoting_options o=0x0
657  ls(12631):  ->xmemdup p=0x61a600 s=0x28
815  ls(12631):   ->xmalloc n=0x28
908  ls(12631):   <-xmalloc return=0x1efe540
950  ls(12631):  <-xmemdup return=0x1efe540
990  ls(12631): <-clone_quoting_options return=0x1efe540
1030 ls(12631): ->get_quoting_style o=0x1efe540 
```

另请参阅：[观察、systemtap 和 oprofile 更新](http://gnu.wildebeest.org/diary/2008/11/27/observe-systemtap-and-oprofile-updates/)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-09-12T13:51:49.177

## 使用[Uprobes](http://www.brendangregg.com/blog/2015-06-28/linux-ftrace-uprobe.html)（自 Linux 3.5 起）

假设您想在`~/Desktop/datalog-2.2/datalog`使用参数调用它时跟踪所有函数`-l ~/Desktop/datalog-2.2/add.lua ~/Desktop/datalog-2.2/test.dl`

1.  `cd /usr/src/linux-`uname -r`/tools/perf`
2.  `for i in `./perf probe -F -x ~/Desktop/datalog-2.2/datalog`; do sudo ./perf probe -x ~/Desktop/datalog-2.2/datalog $i; done`
3.  `sudo ./perf record -agR $(for j in $(sudo ./perf probe -l | cut -d' ' -f3); do echo "-e $j"; done) ~/Desktop/datalog-2.2/datalog -l ~/Desktop/datalog-2.2/add.lua ~/Desktop/datalog-2.2/test.dl`
4.  `sudo ./perf report -G`

![datalog 二进制文件中的函数列表](https://i.stack.imgur.com/TvWnA.png) ![选择 dl_pushlstring 时的调用树，显示 main 调用 loadfile 调用 dl_load 调用程序调用 rule 调用literal 依次调用其他函数最终调用 dl_pushlstring，scan（父级：程序，即从顶部开始的第三个扫描）调用dl_pushstring 等等](https://i.stack.imgur.com/SQ9aR.png)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-23T14:42:37.450

假设您可以使用 gcc 选项重新编译（无需更改源代码）要跟踪的代码`-finstrument-functions`，您可以使用[etrace](https://github.com/creechley/etrace)获取函数调用图。

这是输出的样子：

```
\-- main
|   \-- Crumble_make_apple_crumble
|   |   \-- Crumble_buy_stuff
|   |   |   \-- Crumble_buy
|   |   |   \-- Crumble_buy
|   |   |   \-- Crumble_buy
|   |   |   \-- Crumble_buy
|   |   |   \-- Crumble_buy
|   |   \-- Crumble_prepare_apples
|   |   |   \-- Crumble_skin_and_dice
|   |   \-- Crumble_mix
|   |   \-- Crumble_finalize
|   |   |   \-- Crumble_put
|   |   |   \-- Crumble_put
|   |   \-- Crumble_cook
|   |   |   \-- Crumble_put
|   |   |   \-- Crumble_bake 
```

在 Solaris 上，truss（strace 等效项）能够过滤要跟踪的库。当我发现 strace 没有这样的能力时，我感到很惊讶。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-23T02:56:49.527

```
$ sudo yum install frysk
$ ftrace -sym:'*' -- ./a.out 
```

更多：[ftrace.1](http://sourceware.org/frysk/manpages/ftrace.1.html)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-08-04T16:25:35.520

**KcacheGrind**

[https://kcachegrind.github.io/html/Home.html](https://kcachegrind.github.io/html/Home.html)

测试程序：

```
int f2(int i) { return i + 2; }
int f1(int i) { return f2(2) + i + 1; }
int f0(int i) { return f1(1) + f2(2); }
int pointed(int i) { return i; }
int not_called(int i) { return 0; }

int main(int argc, char **argv) {
    int (*f)(int);
    f0(1);
    f1(1);
    f = pointed;
    if (argc == 1)
        f(1);
    if (argc == 2)
        not_called(1);
    return 0;
} 
```

用法：

```
sudo apt-get install -y kcachegrind valgrind

# Compile the program as usual, no special flags.
gcc -ggdb3 -O0 -o main -std=c99 main.c

# Generate a callgrind.out.<PID> file.
valgrind --tool=callgrind ./main

# Open a GUI tool to visualize callgrind data.
kcachegrind callgrind.out.1234 
```

您现在被留在了一个很棒的 GUI 程序中，其中包含许多有趣的性能数据。

在右下角，选择“调用图”选项卡。这显示了一个交互式调用图，当您单击函数时，该图与其他窗口中的性能指标相关。

要导出图表，请右键单击它并选择“导出图表”。导出的 PNG 如下所示：

[![](https://i.stack.imgur.com/s7dYK.png)](https://i.stack.imgur.com/s7dYK.png)

从中我们可以看出：

*   根节点是`_start`，它是实际的 ELF 入口点，包含 glibc 初始化样板
*   `f0`,`f1`并按`f2`预期相互调用
*   `pointed`也显示了，即使我们用函数指针调用它。如果我们传递了命令行参数，它可能不会被调用。
*   `not_called`没有显示，因为它没有在运行中被调用，因为我们没有传递额外的命令行参数。

很酷的`valgrind`是它不需要任何特殊的编译选项。

因此，即使您没有源代码，只有可执行文件，您也可以使用它。

`valgrind`设法通过轻量级“虚拟机”运行您的代码来做到这一点。

在 Ubuntu 18.04 上测试。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-22T23:44:36.747

如果您将该函数外部化到外部库中，您还应该能够看到它被调用（使用 ltrace ）。

之所以可行，是因为 ltrace 将自己置于您的应用程序和库之间，并且当所有代码都使用一个文件内部化时，它无法拦截调用。

即：ltrace xterm

从 X 库中吐出东西，而 X 几乎不是系统。

除此之外，唯一真正的方法是通过 prof 标志或调试符号进行编译时拦截。

我刚刚跑过这个应用程序，它看起来很有趣：

[http://www.gnu.org/software/cflow/](http://www.gnu.org/software/cflow/)

但我不认为那是你想要的。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-28T03:15:34.057

如果函数没有内联，你甚至可能会幸运地使用`objdump -d <program>`.

举个例子，让我们在 GCC 4.3.2 的`main`例程开始时掠夺一下：

```
$ objdump `which gcc` -d | grep '\(call\|main\)' 

08053270 <main>:
8053270:    8d 4c 24 04             lea    0x4(%esp),%ecx
--
8053299:    89 1c 24                mov    %ebx,(%esp)
805329c:    e8 8f 60 ff ff          call   8049330 <strlen@plt>
80532a1:    8d 04 03                lea    (%ebx,%eax,1),%eax
--
80532cf:    89 04 24                mov    %eax,(%esp)
80532d2:    e8 b9 c9 00 00          call   805fc90 <xmalloc_set_program_name>
80532d7:    8b 5d 9c                mov    0xffffff9c(%ebp),%ebx
--
80532e4:    89 04 24                mov    %eax,(%esp)
80532e7:    e8 b4 a7 00 00          call   805daa0 <expandargv>
80532ec:    8b 55 9c                mov    0xffffff9c(%ebp),%edx
--
8053302:    89 0c 24                mov    %ecx,(%esp)
8053305:    e8 d6 2a 00 00          call   8055de0 <prune_options>
805330a:    e8 71 ac 00 00          call   805df80 <unlock_std_streams>
805330f:    e8 4c 2f 00 00          call   8056260 <gcc_init_libintl>
8053314:    c7 44 24 04 01 00 00    movl   $0x1,0x4(%esp)
--
805331c:    c7 04 24 02 00 00 00    movl   $0x2,(%esp)
8053323:    e8 78 5e ff ff          call   80491a0 <signal@plt>
8053328:    83 e8 01                sub    $0x1,%eax 
```

遍历所有的汇编器需要一些努力，但是您可以看到来自给定函数的所有可能调用。`gprof`它不像提到的其他一些实用程序那样容易使用，但它有几个明显的优点：

*   您通常不需要重新编译应用程序即可使用它
*   它显示了所有可能的函数调用，而类似的东西`gprof`只会显示执行的函数调用。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-12-30T15:37:13.157

有一个用于使用 gdb 自动跟踪函数调用的 shell 脚本。但它不能附加到正在运行的进程。

blog.superadditive.com/2007/12/01/call-graphs-using-the-gnu-project-debugger/

页面副本 - [http://web.archive.org/web/20090317091725/http://blog.superadditive.com/2007/12/01/call-graphs-using-the-gnu-project-debugger/](http://web.archive.org/web/20090317091725/http://blog.superadditive.com/2007/12/01/call-graphs-using-the-gnu-project-debugger/)

工具的副本 - callgraph.tar.gz

[http://web.archive.org/web/20090317091725/http://superadditive.com/software/callgraph.tar.gz](http://web.archive.org/web/20090317091725/http://superadditive.com/software/callgraph.tar.gz)

它从程序中转储所有函数，并在每个函数上生成一个带有断点的 gdb 命令文件。在每个断点处，都会执行“backtrace 2”和“continue”。

这个脚本在大型项目（〜数千个函数）上相当慢，所以我在函数列表上添加了一个过滤器（通过 egrep）。这很容易，我几乎每天都使用这个脚本。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-22T22:27:05.233

[Gprof](http://www.cs.utah.edu/dept/old/texinfo/as/gprof_toc.html)可能是你想要的

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-04-13T18:46:56.833

请参阅 traces，一个用于 Linux C/C++ 应用程序的跟踪框架： [https ://github.com/baruch/traces#readme](https://github.com/baruch/traces#readme)

它需要使用其工具重新编译您的代码，但会提供所有函数、它们的参数和返回值的列表。有一个交互式功能可以轻松导航大型数据样本。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-22T22:20:32.517

希望[Valgrind的](http://valgrind.org/)[callgrind 或 cachegrind 工具](http://valgrind.org/info/tools.html)能为您提供所需的信息。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-03-13T20:06:44.687

注意：这不是基于 linux 内核的 ftrace，而是我最近设计的用于完成本地函数跟踪和控制流的工具。公开支持 Linux ELF x86_64/x86_32。

[https://github.com/leviathansecurity/ftrace](https://github.com/leviathansecurity/ftrace)

# c# - 在 C# 中为接口自动创建存根属性？

> ID：311856
> 
> 赞同：6
> 
> 时间：2008-11-22T22:27:28.057
> 
> 标签：c#, vb.net, code-generation

几个月前，我从 VB.NET 切换到了 C#，虽然 C# 中有很多我**非常**喜欢的特性，不管你信不信，我**真的很**怀念 VB.NET 的一些特性。

其中一项功能是每当我在 VB.NET 中实现接口时，都会自动为我添加存根属性和方法。

有没有办法在 C# 中做到这一点？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-22T22:31:00.500

右键单击实现它的类中的接口名称，单击“实现接口”，然后单击以下两个之一：

实现接口：为您实现存根道具和方法。

显式实现接口：为您实现存根道具和方法，但也显式命名存根所针对的接口。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-22T23:43:12.460

您也可以使用快捷键++`CTRL`然后点击. 或者你使用+ :-)`ALT``F10``ENTER``CTRL``>`

# visual-studio - 如何以编程方式取消嵌入式 MsBuild 构建

> ID：311857
> 
> 赞同：0
> 
> 时间：2008-11-22T22:27:48.057
> 
> 标签：visual-studio, msbuild

我将 MSBuild 直接嵌入到更复杂的构建工具中。相关代码大致如下：

```
// assume 'using Microsoft.Build.BuildEngine;'
Engine e = Engine();
BuildPropertyGroup props = new BuildPropertyGroup();
props.SetProperty( "Configuration", Config.BuildConfig );
e.BuildProjectFile( projectFile, new string[] { "Build" }, props ) 
```

我的问题是如何在启动后取消此构建，而无需执行诸如终止线程之类的激烈操作。此外，如果正在构建的项目是 C++ 项目，则构建将涉及至少一个子进程，因此取消线程甚至不会真正取消构建。

我在 Engine 类上看不到任何取消方法 - 有人知道方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T13:13:53.320

这个问题在 MSDN 板上已经出现过几次，不幸的是，除了终止线程之外，我还没有看到任何其他方法。可悲的是，在这种情况下，终止线程并不是很激烈，因为它是唯一真正的选择。

顺便说一句，我不确定你在多大程度上使用 MSBuild 和你目前正在做的事情。如果您定期使用 MSBuild，只是想建议您查看 Codeplex 上的[MSBuild 扩展包。](http://www.codeplex.com/MSBuildExtensionPack)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T23:32:37.987

我通过从命令运行 msbuild 做了类似的事情。这将启动一个您可以终止的进程。

根据我的经验，使用 xml 工具操作项目文件然后执行 msbuild 比按照您描述的方式以编程方式配置项目要容易和灵活得多。它也更易于管理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T22:04:48.007

似乎没有官方的方法可以做到这一点。

对于 C# 构建，这并不是什么大问题，因为它们通常非常快。我为 C++ 构建提出的最佳解决方法是找到由 VC 构建过程创建的子进程并终止它们，从而停止 MSBuild 构建。这可以使用 Toolhelp32 快照来完成，如下所示（省略 P/Invoke 垃圾）：

```
CreateToolhelp32Snapshot( ToolHelp.SnapshotFlags.Process, 0 ); 
```

从这里您可以确定进程之间的父/子关系，并找到由调用 MSBuild 的应用程序生成的进程。

# mysql - 如何使用常量优化 MySQL 的查询？

> ID：311873
> 
> 赞同：1
> 
> 时间：2008-11-22T22:55:59.217
> 
> 标签：mysql, optimization, sql-execution-plan

**注意：原始问题没有实际意义，但请扫描到底部以查找相关内容。**

我有一个要优化的查询，看起来像这样：

```
select cols from tbl where col = "some run time value" limit 1; 
```

我想知道正在使用什么键，但无论我通过什么来解释，它都能够将 where 子句优化为无（“不可能 WHERE 注意到......”），因为我给它提供了一个常数。

*   有没有办法告诉mysql不要在解释中进行持续优化？
*   我错过了什么吗？
*   有没有更好的方法来获取我需要的信息？

编辑：`EXPLAIN`似乎给了我由常量值产生的查询计划。由于查询是存储过程的一部分（并且 spocs 中的 IIRC 查询计划是在调用它们之前生成的），这对我没有好处，因为值不是恒定的。我想要的是找出优化器在不知道实际值是什么时会生成什么查询计划。

我错过了什么吗？

Edit2：在别处询问，似乎 MySQL 总是重新生成查询计划，除非你不遗余力地让它重新使用它们。即使在存储过程中。由此看来，我的问题似乎没有实际意义。

**但是，这并没有使我真正想知道的事情变得毫无意义：** *您如何优化包含在任何特定查询中恒定的值的查询，但是我，程序员，事先不知道将使用什么值？*-- 例如，假设我的客户端代码正在生成一个在其`where`子句中带有数字的查询。有时该数字会导致*不可能的 where 子句，*有时则不会。我如何使用解释来检查查询的优化程度？

我立即看到的最佳方法是`EXPLAIN`针对存在/不存在案例的完整矩阵运行它。确实，这不是一个很好的解决方案，因为手工操作既困难又容易出错。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T23:44:30.227

您收到“不可能在哪里注意到”，因为您指定的值不在列中，而不仅仅是因为它是一个常量。您可以 1) 使用列中存在的值，或者 2) 只说`col = col`：

```
explain select cols from tbl where col = col; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-04T20:23:18.900

> 例如，假设我的客户端代码正在生成一个在其 where 子句中带有数字的查询。
> 
> 有时该数字会导致不可能的 where 子句，有时则不会。
> 
> 我如何使用解释来检查查询的优化程度？

`MySQL`为不同的绑定参数值构建不同的查询计划。

在[**本文中**](http://s.petrunia.net/blog/?p=16)，您可以阅读`MySQL`优化器何时执行的列表：

```
    行动时

    查询解析准备
    否定消除准备
    子查询重写 PREPARE

    嵌套 JOIN 简化首先执行
    OUTER->INNER JOIN 转换首先执行

    分区修剪每次执行
    COUNT/MIN/MAX 消除 每次执行
    常量子表达式删除每个 EXECUTE
    平等传播每次执行
    常数表检测 每次执行
    ref 访问分析 每个 EXECUTE
    range/index_merge 分析和优化 每个 EXECUTE
    加入优化每次执行

```

此列表中还缺少一件事。

`MySQL`*可以在每次`JOIN`迭代*时重建查询计划：一个这样的称为`range checking for each record`.

如果表上有复合索引：

```
CREATE INDEX ix_table2_col1_col2 ON table2 (col1, col2) 
```

和这样的查询：

```
SELECT  *
FROM    table1 t1
JOIN    table2 t2
ON      t2.col1 = t1.value1
        AND t2.col2 BETWEEN t1.value2_lowerbound AND t2.value2_upperbound 
```

,`MySQL`不会使用从to的索引`RANGE`访问。相反，它将使用索引访问并过滤掉错误的值。`(t1.value1, t1.value2_lowerbound)``(t1.value1, t1.value2_upperbound)``REF``(t1.value)`

但是如果你像这样重写查询：

```
SELECT  *
FROM    table1 t1
JOIN    table2 t2
ON      t2.col1 <= t1.value1
        AND t2.col1 >= t2.value1
        AND t2.col2 BETWEEN t1.value2_lowerbound AND t2.value2_upperbound 
```

，然后将重新检查*每个记录的*`MySQL`索引`RANGE`访问权限，并决定是否即时使用访问权限。*`table1`*`RANGE`

您可以在我的博客中的这些文章中了解它：

*   [**为时区选择时间戳**](http://explainextended.com/2009/04/25/selecting-timestamps-for-a-time-zone/)- 如何使用粗过滤来过滤掉没有时区的时间戳
*   [**模拟 SKIP SCAN**](http://explainextended.com/2009/04/02/emulating-skip-scan/) - 如何模拟`SKIP SCAN`访问方法`MySQL`
*   [**解析函数：优化 LAG、LEAD、FIRST_VALUE、LAST_VALUE**](http://explainextended.com/2009/03/12/analytic-functions-optimizing-lag-lead-first_value-last_value/) - 如何模拟 Oracle 的解析函数`MySQL`
*   [**高级行抽样**](http://explainextended.com/2009/03/06/advanced-row-sampling/)- 如何`N`从每个组中选择记录`MySQL`

所有这些东西都使用`RANGE CHECKING FOR EACH RECORD`

**回到你的问题：**没有办法知道哪个计划将`MySQL`用于每个给定的常量，因为在给定常量之前没有计划。

不幸的是，没有办法强制`MySQL`对绑定参数的每个值使用一个查询计划。

您可以使用and子句控制选择的`JOIN`顺序和'es ，但它们不会强制索引上的某个访问路径或禁止.`INDEX``STRAIGHT_JOIN``FORCE INDEX``IMPOSSIBLE WHERE`

另一方面，对于所有`JOIN`的，`MySQL`仅雇用`NESTED LOOPS`. 这意味着如果您构建正确的`JOIN`顺序或选择正确的索引，`MySQL`可能会从 all `IMPOSSIBLE WHERE`'s 中受益。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T07:42:51.287

> 您如何使用仅对查询恒定的值来优化查询，但我，程序员，事先不知道将使用什么值？

通过在特定列上使用索引（如果您总是一起查询给定列，甚至在列组合上）。如果您有索引，查询规划器可能会使用它们。

关于“不可能”值：查询计划器可以从多个来源得出结论，给定值不在表中：

*   如果特定列上有索引，它可以观察到特定值大于或小于索引中的任何值（最小/最大值需要恒定时间从索引中提取）
*   如果您传入了错误的类型（如果您要求数字列与文本相等）

PS。通常，查询计划的创建并不昂贵，并且重新创建比重新使用它们更好，因为条件可能在查询计划生成后发生了变化，并且可能存在更好的查询计划。

# java - JButton 扩展以占据整个框架/容器

> ID：311876
> 
> 赞同：8
> 
> 时间：2008-11-22T23:00:50.563
> 
> 标签：java, user-interface, swing, jframe, jbutton

嘿大家。我正在尝试制作一个带有按钮和标签的摇摆 GUI。我使用边框布局，标签（在北场）显示得很好，但按钮占据了框架的其余部分（它在中心场）。知道如何解决这个问题吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-22T23:05:57.590

您必须将按钮添加到另一个面板，然后将该面板添加到框架中。

事实证明 BorderLayout 扩展了中间的组件

您的代码现在应该如下所示：

前

```
public static void main( String [] args ) {
    JLabel label = new JLabel("Some info");
    JButton button = new JButton("Ok");

    JFrame frame = ... 

    frame.add( label, BorderLayout.NORTH );
    frame.add( button , BorderLayout.CENTER );
    ....

} 
```

把它改成这样：

```
public static void main( String [] args ) {
    JLabel label = new JLabel("Some info");
    JButton button = new JButton("Ok");
    JPanel panel = new JPanel();
     panel.add( button );

    JFrame frame = ... 

    frame.add( label, BorderLayout.NORTH );
    frame.add( panel , BorderLayout.CENTER);
    ....

} 
```

之前/之后

[之前 http://img372.imageshack.us/img372/2860/beforedl1.png](http://img372.imageshack.us/img372/2860/beforedl1.png) [之后 http://img508.imageshack.us/img508/341/aftergq7.png](http://img508.imageshack.us/img508/341/aftergq7.png)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-03-12T21:37:31.927

或者只使用绝对布局。它在布局托盘上。

或启用它：

```
frame = new JFrame();
... //your code here

// to set absolute layout.
frame.getContentPane().setLayout(null); 
```

这样，您可以自由地将控件放置在您喜欢的任何位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T15:16:31.607

再次 ：）

```
 import javax.swing.*;

    public class TestFrame extends JFrame {
        public TestFrame() {
            JLabel label = new JLabel("Some info");
            JButton button = new JButton("Ok");
            Box b = new Box(BoxLayout.Y_AXIS);
            b.add(label);
            b.add(button);
            getContentPane().add(b);

        }
        public static void main(String[] args) {
            JFrame f = new TestFrame();
            f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
            f.setLocationRelativeTo(null);
            f.setVisible(true);

        }
    } 
```

# c# - “静态链接”和“动态链接”是什么意思？

> ID：311882
> 
> 赞同：269
> 
> 时间：2008-11-22T23:09:57.050
> 
> 标签：c#, c++, linker, static-linking, dynamic-linking

[我经常听到术语“静态链接”和“动态链接”，通常是指用C](http://en.wikipedia.org/wiki/C_%28programming_language%29)、[C++](https://en.wikipedia.org/wiki/C++)或[C#](http://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29)编写的代码。它们是什么，它们到底在说什么，它们在连接什么？

* * *

## 回答 #1

> 赞同：490
> 
> 时间：2008-11-22T23:14:26.090

从源代码（你写的）到可执行代码（你运行的）有两个阶段（在大多数情况下，不考虑解释代码）。

第一个是将源代码转换为目标模块的编译。

第二个，链接，是将对象模块组合在一起以形成可执行文件。

区别在于，除其他外，允许第​​三方库包含在您的可执行文件中，而您无需查看其源代码（例如用于数据库访问、网络通信和图形用户界面的库），或用于编译不同语言的代码（例如 C 和汇编代码），然后将它们链接在一起。

当您将文件*静态*链接到可执行文件时，该文件的内容将包含在链接时。换句话说，文件的内容被物理插入到您将运行的可执行文件中。

当您*动态*链接时，指向正在链接的文件的指针（例如文件的文件名）包含在可执行文件中，并且在链接时不包含所述文件的内容。只有当您稍后*运行*可执行文件时，才会购买这些动态链接的文件，并且它们只被购买到可执行文件的内存副本中，而不是磁盘上的那个。

它基本上是一种延迟链接的方法。还有一种*更*延迟的方法（在某些系统上称为后期绑定），在您实际尝试调用其中的函数之前，它不会引入动态链接文件。

静态链接的文件在链接时被“锁定”到可执行文件，因此它们永远不会改变。可执行文件引用的动态链接文件只需替换磁盘上的文件即可更改。

这允许更新功能而无需重新链接代码；每次运行时加载程序都会重新链接。

这有好有坏 - 一方面，它允许更轻松的更新和错误修复，另一方面，如果更新不兼容，它可能导致程序停止工作 - 这有时是某些人可怕的“DLL地狱”的原因提到如果您将动态链接库替换为不兼容的库，则应用程序可能会被破坏（顺便说一句，这样做的开发人员应该期望受到追捕和严厉惩罚）。

* * *

作为一个*例子*，让我们看看用户编译他们的`main.c`文件以进行静态和动态链接的情况。

```
Phase     Static                    Dynamic
--------  ----------------------    ------------------------
          +---------+               +---------+
          | main.c  |               | main.c  |
          +---------+               +---------+
Compile........|.........................|...................
          +---------+ +---------+   +---------+ +--------+
          | main.o  | | crtlib  |   | main.o  | | crtimp |
          +---------+ +---------+   +---------+ +--------+
Link...........|..........|..............|...........|.......
               |          |              +-----------+
               |          |              |
          +---------+     |         +---------+ +--------+
          |  main   |-----+         |  main   | | crtdll |
          +---------+               +---------+ +--------+
Load/Run.......|.........................|..........|........
          +---------+               +---------+     |
          | main in |               | main in |-----+
          | memory  |               | memory  |
          +---------+               +---------+ 
```

您可以在静态情况下看到主程序和 C 运行时库在链接时（由开发人员）链接在一起。由于用户通常无法重新链接可执行文件，因此他们被库的行为所困扰。

在动态情况下，主程序与 C 运行时导入库链接（它声明了动态库中的内容，但实际上并未*定义*它）。即使缺少实际代码，这也允许链接器进行链接。

然后，在运行时，操作系统加载程序将主程序与 C 运行时 DLL（动态链接库或共享库或其他命名法）进行后期链接。

C 运行时的所有者可以随时插入新的 DLL 以提供更新或错误修复。如前所述，这既有优点也有缺点。

* * *

## 回答 #2

> 赞同：233
> 
> 时间：2008-11-23T00:02:19.410

我认为这个问题的一个很好的答案应该解释什么是*链接*。

当您编译一些 C 代码（例如）时，它会被翻译成机器语言。只是一个字节序列，在运行时会导致处理器加、减、比较、“转到”、读取内存、写入内存等等。这些东西存储在对象 (.o) 文件中。

现在，很久以前，计算机科学家发明了这种“子程序”的东西。在此处执行此代码块并返回。不久之后，他们意识到最有用的子程序可以存储在一个特殊的地方，供任何需要它们的程序使用。

现在，在早期，程序员必须输入这些子程序所在的内存地址。类似的东西`CALL 0x5A62`。如果需要更改这些内存地址，这将是乏味且有问题的。

因此，该过程是自动化的。您编写了一个调用 的程序`printf()`，而编译器不知道`printf`. 所以编译器只是写，并在目标文件中添加一个注释，说“必须用**printf**`CALL 0x0000`的内存位置替换这个 0x0000 ”。

 **静态链接意味着链接器程序（GNU 程序称为[ld](https://en.wikipedia.org/wiki/GNU_linker)）将`printf`的机器代码直接添加到您的可执行文件中，并将 0x0000 更改为`printf`. 创建可执行文件时会发生这种情况。

动态链接意味着上述步骤不会发生。可执行文件*仍然*有一个注释，上面写着“必须将 0x000 替换为 printf 的内存位置”。*每次程序运行时*，操作系统的加载程序都需要找到 printf 代码，将其加载到内存中，并更正 CALL 地址。

程序通常会调用一些静态链接的函数（标准库函数`printf`通常是静态链接的）和其他动态链接的函数。当可执行文件运行时，静态的“成为”可执行文件的一部分，而动态的“加入”。

两种方法各有利弊，操作系统之间也存在差异。不过既然你没问，那我就到此结束吧。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-11-22T23:13:41.410

静态链接库在编译时链接。动态链接库在运行时加载。静态链接将库位烘焙到您的可执行文件中。动态链接仅包含对库的引用；动态库的位存在于其他地方，以后可以换掉。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2015-10-06T03:30:39.480

因为上述帖子都没有*真正展示如何*静态链接某些东西并看到你做对了，所以我将解决这个问题：

一个简单的C程序

```
#include <stdio.h>

int main(void)
{
    printf("This is a string\n");
    return 0;
} 
```

动态链接C程序

```
gcc simpleprog.c -o simpleprog 
```

并`file`在二进制文件上运行：

```
file simpleprog 
```

这将表明它是动态链接的，如下所示：

"simpleprog: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.26, BuildID[sha1]=0xf715572611a8b04f686809d90d1c0d75c6028f0f, not stripped"

Instead let us statically link the program this time:

```
gcc simpleprog.c -static -o simpleprog 
```

Running file on this statically linked binary will show:

```
file simpleprog 
```

"simpleprog: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, for GNU/Linux 2.6.26, BuildID[sha1]=0x8c0b12250801c5a7c7434647b7dc65a644d6132b, not stripped"

And you can see it is happily statically linked. Sadly however not all libraries are simple to statically link this way and may require extended effort using `libtool` or linking the object code and C libraries by hand.

幸运的是，许多嵌入式 C 库`musl`都为几乎所有（*如果不是全部*）库提供静态链接选项。

现在`strace`您已经创建了二进制文件，您可以看到在程序开始之前没有访问任何库：

```
strace ./simpleprog 
```

现在与`strace`动态链接程序的输出进行比较，您会发现静态链接版本的 strace 要短得多！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-22T23:49:15.443

（我不知道 C#，但有一个 VM 语言的静态链接概念很有趣）

动态链接涉及知道如何找到您仅从程序中引用的所需功能。您的语言运行时或操作系统在文件系统、网络或编译代码缓存上搜索一段代码，匹配引用，然后采取多种措施将其集成到内存中的程序映像中，例如重定位。它们都是在运行时完成的。它可以手动完成，也可以由编译器完成。有能力进行更新，但有搞砸的风险（即 DLL 地狱）。

静态链接在编译时完成，您告诉编译器所有功能部分在哪里并指示它集成它们。没有搜索，没有歧义，没有重新编译就无法更新。您的所有依赖项在物理上与您的程序映像是一体的。

# gwt - JSNI中的Java Hashmap和多维数组类型sig？

> ID：311883
> 
> 赞同：2
> 
> 时间：2008-11-22T23:10:01.777
> 
> 标签：gwt, types, signature, jsni

我有一个方法 JSNI，它调用一个以 Hasmap 作为输入的 Java 方法。我试过了

```
handler.@com.mypackage::myMethod(Ljava/util/Hashmap;)(myHashMap);
handler.@com.mypackage::myMethod(Ljava/util/Hashmap<Ljava/lang/String,Ljava/lang/String>;)(myHashMap); 
```

我似乎无法定义正确的类型签名以包含字符串或查找是否允许这种用法。

由于我在 gwt 中执行此操作，虽然它可能是 hashmap 的实现，但我使用 String[][] 数组作为输入的替代方法

我希望有类似的东西

handler.@com.mypackage::myMethod([[Ljava/lang/String;)(myArray);

但是，我遇到了另一个问题，即为数组的第二维找到正确的 JNSI sntax

一维数组，即。`[Ljava/lang/String;`很好，但我需要二维。

任何帮助/想法或链接到好的 jnsi 文档表示赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T20:49:56.940

I think you're running into type erasure. Every generic object parameter is really just java.lang.Object at runtime. I don't believe generics are exposed to JNI.

I've written JNI code but never attempted to use generic types from native code so I'm not certain. Googling has turned up no specific references or examples.

See [Java VM Type Signatures](http://java.sun.com/j2se/1.5.0/docs/guide/jni/spec/types.html#wp276) for a reference to the type signatures used in JNI (and JSNI)

However, you may not need to pass a Java HashMap to Javascript anyway. Instead, consider using JSONObject and passing a native JavaScript object to your javascript code. It looks like this:

```
 public void callFoo() {
    JSONObject obj = new JSONObject();
    obj.put("propertyName", new JSONString("properyValue"));
    JavaScriptObject jsObj = obj.getJavaScriptObject();

    nativeFoo(jsObj);
  }

  public native void nativeFoo(JavaScriptObject obj) /*-{
    $wnd.alert(obj['propertyName']);
  }-*/; 
```

This gets compiled to roughly:

```
var obj = {'propertyName': 'propertyValue'};
$wnd.alert(obj['propertyName']); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T12:47:30.817

你能发布你得到的错误，以及你试图作为哈希图传递的 javascript 对象类型。我假设您遇到编译时错误？

这是 JSNI 文档的良好开端：

[GWT JSNI 文档](http://code.google.com/docreader/#p=google-web-toolkit-doc-1-5&s=google-web-toolkit-doc-1-5&t=DevGuideJavaFromJavaScript)

[GWT 关于 JSNI 的博客文章](http://googlewebtoolkit.blogspot.com/2008/07/getting-to-really-know-gwt-part-1-jsni.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T21:15:47.467

好的，看完之后...

我找不到任何提供多维字符串数组的文档或安排。设法使用 HashMap 完成此操作，使用：

```
handler.@com.mypackage::myMethod(Ljava/util/Hashmap;)(myHashMap); 
```

如果我在不定义类型的情况下定义输入，则可以工作。如：

```
HashMap myHashMap = new HashMap(); 
```

这为 JSNI 提供了一个 HashMap 类型`<Object, Object>`。

然后我通过将哈希图的内容转换为字符串来处理另一端的对象。

感谢生锈的链接：

[GWT JSNI doc](http://code.google.com/docreader/#p=google-web-toolkit-doc-1-5&s=google-web-toolkit-doc-1-5&t=DevGuideJavaFromJavaScript) - 这有利于获得正确的原语格式

[GWT Blog post on JSNI](http://googlewebtoolkit.blogspot.com/2008/07/getting-to-really-know-gwt-part-1-jsni.html) - Hadn't seen this blog before

# apache-flex - 什么是最好的（最高效的）FLEX IDE？

> ID：311887
> 
> 赞同：12
> 
> 时间：2008-11-22T23:13:56.387
> 
> 标签：apache-flex, flash

一些要求：

*   逐步调试和断点
*   调试时查看变量值
*   IntelliSense（自动完成）。理想情况下使用“智能”完成，因此它只向您显示语法上有效的选项来完成某事。例如，文本框。将触发该类的成员（.Text、.BackColor）等。然后 Textbox.BackColor= 将触发有效颜色列表。
*   拖放式 GUI 设计。

我不关心成本（好吧，超过 1000 美元看起来有点贵:-)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-20T18:16:31.840

使用变量视图（通常使用堆栈或全局变量等其他视图）逐步调试在某些 IDE 中有效。**FlexBuilder**、**FDT3 Enterprise**（只有企业版允许调试）、**FlashDevelop**（带额外插件）。您还可以尝试（免费！）Visual Studio 插件*Tofino* ( [Ensemble](http://www.ensemble.com/) )，这样您就可以在 Visual Studio 中进行调试。

但是我在基于 Eclipse 的 IDE 中找到了最好的调试实现。我对 FDT3 印象不深，所以我推荐使用 FlexBuilder 进行调试（+分析），当然还有 AS 的编码，最后是 MXML 的（视觉）设计。

您可以使用 FDB 插件尝试 FlashDevelop。由于良好的代码辅助（恕我直言，这是所有已知 IDE 中最好的），许多人更喜欢这个免费的 IDE 进行编码。调试正在使用这个插件，但我不会说这是“最高效的”。但是试一试，它是免费的！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-22T23:18:34.367

我知道的只有2个：

[弹性生成器](http://www.adobe.com/products/flex/)

[智能理念](http://www.jetbrains.com/idea/features/javascript_editor.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-10T16:35:57.397

我对上面关于调试的评论很感兴趣。我是 Visual Studio 的 Amethyst Flex/AIR IDE 的开发人员之一。我们非常渴望有最好的 Flex 调试可用，所以我很感激任何反馈来帮助我们实现这一目标。

当前的 Amethyst 测试版在调试窗口或代码编辑器中的悬停调试提示中具有断点、监视变量、本地变量、调用堆栈、步入/步出/步过以及向下钻取扩展。这里有一部小电影展示了 Amethyst 的一些调试功能：

[http://www.sapphiresteel.com/Debugging-Adobe-Flex-Applications](http://www.sapphiresteel.com/Debugging-Adobe-Flex-Applications)

不久我们将添加更多功能（例如跟踪点和条件断点）。但是，如果我们错过了任何功能，现在是告诉我们的好时机；-)

最良好的祝愿

休·科林伯恩

蓝宝石钢软件

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-01T21:30:50.957

我已经全部使用过了，我可以毫无疑问地说 IntelliJ 是其中最强大的。 [http://www.jetbrains.com/idea/features/flex_ide.html](http://www.jetbrains.com/idea/features/flex_ide.html)

它也是最好的 JS IDE，除非您在后端使用 .NET，否则它可能是您的后端语言的最佳 IDE。这些家伙真的有事。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-23T00:59:50.620

FlashDevelop.org 的[FlashDevelop](http://flashdevelop.org)是另一个似乎正在获得动力的免费编辑器。它仅适用于 Windows，但似乎功能非常丰富。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-02T03:51:10.440

1.  Netbeans 还有一个名为[FlexBean](http://sourceforge.net/projects/flexbean)的插件。不过现在还不够强大。
2.  [SapphireSteel 紫水晶个人版](http://www.sapphiresteel.com/Flex-IDE-For-Free-and-Ruby-too)怎么样？它基于VS。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-26T05:19:59.877

不少杰出的 Flex+Flash 开发人员都对[FDT发誓](http://fdt.powerflasher.com/ "FDT")

它是一个 Eclipse 插件，它可能是目前最昂贵的 Flex 开发工具，但它非常好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-26T05:26:53.183

弹性生成器。如果你是*老师*或学生，你可以免费获得它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-01T20:46:59.357

根据上面的讨论，下面是带有调试支持的 Flex IDE 列表

*   Powerflasher FDT
*   紫晶
*   Adobe Flash 生成器
*   IntelliJ IDEA（终极版）
*   闪存开发

# regex - 在 VB.Net 源代码中获取注释的正则表达式

> ID：311888
> 
> 赞同：3
> 
> 时间：2008-11-22T23:14:22.300
> 
> 标签：regex, vb.net

我在 vb.net 中有一个语法高亮功能。例如，我使用正则表达式来匹配“！IF”，然后将其着色为蓝色。在我试图弄清楚如何发表评论之前，这很完美。

我写这篇评论的语言可以是如果该行以单引号 ' 开头，或者如果该行中的任何地方有两个单引号

```
'this line is a comment
!if StackOverflow = "AWESOME" ''this is also a comment 
```

现在我知道如何查看它是否以单行 ^' 开头，但我需要将字符串一直返回到行尾，这样我就可以将整个评论涂成绿色，而不仅仅是单引号。

您不需要该代码，但这里有一个片段，以防万一。

```
 For Each pass In frmColors.lbRegExps.Items
        RegExp = System.Text.RegularExpressions.Regex.Matches(LCase(rtbMain.Text), LCase(pass))
        For Each RegExpMatch In RegExp
            rtbMain.Select(RegExpMatch.Index, RegExpMatch.Length)
            rtbMain.SelectionColor = ColorTranslator.FromHtml(frmColors.lbHexColors.Items(PassNumber))
        Next
        PassNumber += 1
    Next 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T23:19:39.527

类似于以下内容：

```
^(\'[^\r\n]+)$|(''[^\r\n]+)$ 
```

应该给你第 n° 1 组中的注释行（部分行）

实际上，您甚至不需要组

```
^\'[^\r\n]+$|''[^\r\n]+$ 
```

如果它发现了什么，它就是一个评论。

```
"(^'|'').*$" 
```

如果仅逐行应用（可能是您的情况），Boaz 提到的将起作用。
对于多行检测，您必须确保避免使用“Dotall”模式，其中“.” 也代表 \r 和 \n 字符。否则，该模式将完全匹配您的两条线。

这就是为什么我通常更喜欢`[^\r\n]`'.'：它避免了对模式模式的任何依赖。即使在“Dotall”模式下，它仍然可以工作，并且避免在下一行尝试任何匹配。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T23:36:07.013

虽然上述方法可行，但您可以简化它：

```
"(^'|'').*$" 
```

正如 VonC 所提到的 - 这只有在您一次输入正则表达式时才有效。对于多线模式使用：

```
"(^'|'').*?$" 
```

这 ？使 * 运算符不贪婪，强制正则表达式匹配单行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-06-29T01:44:13.253

使用正则表达式模式： REM((\t| ).*$|$)|^\'[^\r\n]+$|''[^\r\n]+$

查看更多[https://code.msdn.microsoft.com/How-to-find-code-comments-9d1f7a29/](https://code.msdn.microsoft.com/How-to-find-code-comments-9d1f7a29/)

# ruby-on-rails - 对 Rails Web 应用程序进行压力测试的最佳方法？

> ID：311925
> 
> 赞同：25
> 
> 时间：2008-11-22T23:54:30.753
> 
> 标签：ruby-on-rails, performance, web-applications, production, stress-testing

那里有什么好的（最好是免费的）工具吗？

当应用程序上线时，他们能否给出反映生产结果的准确估计？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2012-01-06T04:53:31.163

我会亲自去 Apache Bench [http://httpd.apache.org/docs/2.0/programs/ab.html](http://httpd.apache.org/docs/2.0/programs/ab.html)

它是免费的、直接使用和轻量级的。

如果您正在寻找更强大的东西，那么我认为 Apache JMeter 可能值得一看。[http://jmeter.apache.org/](http://jmeter.apache.org/)。再说一次，它是免费的，有点学习曲线，而且 GUI 有点重。

您可能还想看看这个 Q/A [Performing a Stress Test on Web Application？](https://stackoverflow.com/questions/7492/how-do-you-stress-test-a-web-application)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-22T23:59:44.173

WebLoad 是开源的：

[http://www.webload.org/](http://www.webload.org/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-23T01:04:15.963

[这里](http://www.load-testing-tools.com/)有一个很好的工具总结。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-23T01:09:09.087

这绝对不是一个免费的解决方案，但[webmetrics](http://www.webmetrics.com/)将完成这项工作。（以及一般的任何网站监控公司）。它们提供关于您网站性能的详尽报告，当您安排负载测试时，您可以指定要模拟多少负载（例如一次模拟 2000 个用户使用我的网站）。

我认为它不会将其分解并告诉您您的 CPU 使用率等，因为他们会从他们的服务器中对您的网站施加压力。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-06-29T00:33:37.653

Rails 内置了性能测试：http: [//guides.rubyonrails.org/performance_testing.html](http://guides.rubyonrails.org/performance_testing.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-12-22T05:41:43.740

你可以试试Trample，这里是负载模拟[工具](http://github.com/giraffesoft/trample/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-12-20T07:55:19.070

如果你想可视化性能而不是只看数字，你可以试试 Engulf。它是开源软件、分布式和高性能。[http://engulf-project.org/#usage](http://engulf-project.org/#usage)免责声明：这是我从事的一个项目。

# c# - Resharper 更新项目中所有文件的命名空间

> ID：311930
> 
> 赞同：3
> 
> 时间：2008-11-23T00:01:42.890
> 
> 标签：c#

我知道我可以更新我当前的文件命名空间以匹配目录结构。我可以一次对项目中的所有文件执行此操作吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-24T16:06:01.897

AFAIK，没有办法做到这一点。

但是，您可以通过“类视图”窗口相当快地更新它们。打开类视图窗口，单击要重命名的命名空间，按 CTRL + R + R 然后重命名。

[这篇博文很好地概述了它](http://rickardnilsson.net/post/2008/08/26/ReSharper-User-tip-2-Refactor-rename-namespace.aspx)

# visual-studio-2008 - ViewState、FormView 和控件

> ID：311931
> 
> 赞同：1
> 
> 时间：2008-11-23T00:02:17.087
> 
> 标签：visual-studio-2008, asp.net-2.0, viewstate

您如何（在 Visual Studio 中）比较 formview 中不同模板中的控件，以便跟踪 ViewState 错误？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-25T20:12:50.930

我知道您可以在 Asp:DetailsView 控件上使用 ChangeMode 方法来设置模式以及在客户端使用哪个模板。

我认为你可以对 FormView 做同样的事情。

您可以在客户端显式设置模式，也可以将其设置为服务器端操作的结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T18:53:03.280

我最终将每个控件的副本放在所有三个模板中。如果我不使用该模板中的控件，我只需将其放在 PlaceHolder 控件中，并将其可见性设置为 FALSE。这些未使用的控件只有所需的属性，没有任何绑定。

# javascript - Javascript 时序

> ID：311933
> 
> 赞同：1
> 
> 时间：2008-11-23T00:02:30.627
> 
> 标签：javascript, timing

我正在尝试使用 javascript 创建倒计时。我从[这里](http://w3schools.com/js/js_timimg.asp)得到了一些代码并稍微修改了它。

```
<script type="text/javascript">
var c=10, t;

function timedCount() {
  document.getElementById('txt').value=c;
  c=c-1;
  t=setInterval("timedCount()",1000);
}

function stopCount() {
  clearInterval(t);
}
</script> 
```

我需要反复调用倒计时，直到用户点击链接。它应该每秒从 10 倒计时（10,9,8,7,6...0），直到点击链接，但它没有。有谁能够帮助我？

编辑：有谁知道一旦倒计时达到 0 时如何重新开始？

先感谢您。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T00:10:01.127

```
<script type="text/javascript">
var c=10;
var t;
function timedCount()
{
    document.getElementById('txt').value=c;
    c=c-1;
}
function startCount()
{
    if (!t) t=setInterval("timedCount()",1000);
}
function stopCount()
{
    clearInterval(t);
    t=null;
}
</script> 
```

`startCount()`当您希望计数器启动时调用onload （或其他）。请注意，我的 startCount 和 stopCount 不会创建多个间隔计时器。

此外，带有 id=txt 的元素需要是一个`<input>`或`<textarea>`框，您的代码才能正常工作。如果它是一个跨度，你应该使用`document.getElementById('txt').innerHTML=c;`

最后，如果 c 低于零，您可能希望 timedCount() 到 stopCount()。这很容易：

```
if (c <= 0) stopCount(); 
```

# math - 平等和等价有什么区别？

> ID：311936
> 
> 赞同：36
> 
> 时间：2008-11-23T00:09:33.607
> 
> 标签：math, computer-science, symbols

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-23T00:17:53.607

[Wikipedia: Equivalence relation](http://en.wikipedia.org/wiki/Equivalence_relation):

> In mathematics, an equivalence relation is a binary relation between two elements of a set which groups them together as being "equivalent" in some way. Let a, b, and c be arbitrary elements of some set X. Then "a ~ b" or "a ≡ b" denotes that a is equivalent to b.
> 
> An equivalence relation "~" is reflexive, symmetric, and transitive.

In other words, = is just an instance of equivalence relation.

**Edit**: This seemingly simple criteria of being reflexive, symmetric, and transitive are not always trivial. See Bloch's Effective Java 2nd ed p. 35 for example,

```
public final class CaseInsensitiveString {
...
    // broken
    @Override public boolean equals(Object o) {
        if (o instance of CaseInsensitiveString)
            return s.equalsIgnoreCase(
                ((CaseInsensitiveString) o).s);
        if (o instanceof String) // One-way interoperability!
            return s.equalsIgnoreCase((String) o);
        return false;
    }
... 

} 
```

The above equals implementation breaks the symmetry because `CaseInsensitiveString` knows about `String` class, but the `String` class doesn't know about `CaseInsensitiveString`.

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-02T05:39:26.060

I take your question to be about math notation rather than programming. The triple equal sign you refer to can be written `&equiv;` in HTML or `\equiv` in LaTeX.

a ≡ b most commonly means "a is defined to be b" or "let a be equal to b".

So 2+2=4 but φ ≡ (1+sqrt(5))/2.

Here's a handy equivalence table:

```
Mathematicians      Computer scientists
--------------      -------------------
      =                      ==
      ≡                      = 
```

(The other answers about equivalence relations are correct too but I don't think those are as common. There's also a ≡ b (mod m) which is pronounced "a is congruent to b, mod m" and in programmer parlance would be expressed as mod(a,m) == mod(b,m). In other words, a and b are equal after mod'ing by m.)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-23T00:29:22.430

A lot of languages distinguish between equality of the objects and equality of the values of those objects.

Ruby for example has 3 different ways to test equality. The first, equal?, compares two variables to see if they point to the same instance. This is equivalent in a C-style language of doing a check to see if 2 pointers refer to the same address. The second method, ==, tests value equality. So 3 == 3.0 would be true in this case. The third, eql?, compares both value and class type.

Lisp also has different concepts of equality depending on what you're trying to test.

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-23T00:17:16.353

In languages that I have seen that differentiate between equality and equivalence, equality usually means the type **and** value are the same while equivalence means that just the values are the same. For example:

```
int i = 3;
double d = 3.0; 
```

i and d would be have an equivalence relationship since they represent the same value but not equality since they have different types. Other languages may have different ideas of equivalence (such as whether two variables represent the same object).

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-08-01T09:10:42.527

The answers above are right / partially right but they don't explain what the difference is exactly. In theoretical computer science (and probably in other branches of maths) it has to do with quantification over free variables of the logical equation (that is when we use the two notations at once).

For me the best ways to understand the difference is:

1.  By definition
    A ≡ B
    means
    For all possible values of free variables in A and B, A = B

    or

    A ≡ B <=> [A = B]

2.  By example
    x=2x
    iff (in fact iff is the same as ≡)
    x=0

    x ≡ 2x
    iff (because it is not the case that x = 2x for all possible values of x)
    False

I hope it helps

**Edit:**

Another thing that came to my head is the definitions of the two.

A = B is defined as A <= B and A >= B, where <= (smaller equal, not implies) can be any ordering relation

A ≡ B is defined as A <=> B (iff, if and only if, implies both sides), worth noting that implication is also an ordering relation and so it is possible (but less precise and often confusing) to use = instead of ≡.

I guess the conclusion is that when you see =, then you have to figure out the authors intention based on the context.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-23T00:28:26.597

Take it outside the realm of programming.

*   (31) equal -- (having the same quantity, value, or measure as another; "on equal terms"; "all men are equal before the law")

*   equivalent, tantamount -- (being essentially equal to something; "it was as good as gold"; "a wish that was equivalent to a command"; "his statement was tantamount to an admission of guilt"

At least in my dictionary, 'equivelance' means its a good-enough subsitute for the original, but not necessarily identical, and likewise 'equality' conveys complete identical.

```
null == 0   # true , null is equivelant to 0 ( in php ) 
null === 0  # false, null is not equal to 0 ( in php ) 
```

( Some people use ≈ to represent nonidentical values instead )

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-23T01:30:44.503

The difference resides above all in the level at which the two concepts are introduced. '≡' is a symbol of formal logic where, given two *propositions* a and b, a ≡ b means (a => b AND b => a).

'=' is instead the typical example of an equivalence relation on a *set*, and presumes at least a theory of sets. When one *defines* a particular set, usually he provides it with a suitable notion of equality, which comes in the form of an equivalence relation and uses the symbol '='. For example, when you *define* the set Q of the rational numbers, you *define* equality a/b = c/d (where a/b and c/d are rational) if and only if ad = bc (where ad and bc are integers, the notion of equality for integers having already been defined elsewhere).

Sometimes you will find the informal notation f(x) ≡ g(x), where f and g are functions: It means that f and g have the same domain and that f(x) = g(x) for each x in such domain (this is again an equivalence relation). Finally, sometimes you find ≡ (or ~) as a generic symbol to denote an equivalence relation.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-23T00:22:16.123

You could have two statements that have the same truth value (equivalent) or two statements that are the same (equality). As well the "equal sign with three bars" can also mean "is defined as."

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-23T01:41:27.103

Equality really is a special kind of equivalence relation, in fact. Consider what it means to say:

```
0.9999999999999999... = 1 
```

That suggests that equality is just an equivalence relation on "string numbers" (which are defined more formally as functions from Z -> {0,...,9}). And we can see from this case, the equivalence classes are not even singletons.

# apache - Apache 重定向规则总是在每个请求上触发

> ID：311939
> 
> 赞同：0
> 
> 时间：2008-11-23T00:13:47.890
> 
> 标签：apache, mod-rewrite, apache2

因此，以下重写规则似乎总是会触发。这会隐藏我在服务器上托管的另一个域吗？

我似乎无法弄清楚出了什么问题，是时候请来专家了：

```
RewriteEngine on
RewriteCond %{HTTP_HOST} ^danielhonig.com
RewriteRule ^(.*)$ http://www.danielhonig.com/$1 [R=permanent,L]

RedirectMatch ^/$ http://www.danielhonig.com/gravl
Options None 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T00:24:08.743

将重写规则放在您的`<VirtualHost>`指令中，那么它不会影响您的其他域。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T01:34:33.717

您是否尝试使用`%{SERVER_NAME}`而不是`%{HTTP_HOST}`？我发现`%{SERVER_NAME}`子域也很好玩。

# c - 使 GDB 在调用函数时打印控制流

> ID：311948
> 
> 赞同：18
> 
> 时间：2008-11-23T00:25:36.837
> 
> 标签：c, debugging, dynamic, gdb, call-graph

如何在调用 gdb 时打印感兴趣的函数，并根据它们在堆栈中的深度进行缩进？

我希望能够说类似（编造）的话：

```
(gdb) trace Foo* Bar* printf 
```

并让 gdb 打印所有以 Foo 或 Bar 开头的函数，因为它们被称为。有点像 gnu cflow，除了使用调试符号并且只打印实际调用的函数，而不是所有可能的调用流。

无济于事的工具包括 cachegrind、callgrind 和 oprofile，它们对最常调用函数的结果进行排序。我需要保留调用顺序。

通配符（或等价物）是必不可少的，因为有很多 Foo 和 Bar 函数。虽然我会满足于记录每个功能。或者，也许告诉 gdb 记录特定库中的所有函数。

一些 GDB 向导必须有一个脚本来完成这个常见的工作！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-09-30T20:22:04.463

在您的情况下，我会求助于`define`gdb 中的命令，它允许您定义一个函数，该函数最多可以接受 10 个参数。

您可以将函数名称作为参数传递给您定义的函数以“跟踪”，或者将它们全部记录在函数本身中。我会做类似以下的事情

```
define functiontrace
if $arg0
    break $arg0
    commands
        where
        continue
        end
    end

if $arg1
... 
```

gdb 中用户定义函数的参数引用为 $arg0-$arg9。或者，您可以只在函数中记录您想要跟踪的每个函数，而不是使用 $arg0-9。

注意：这不会缩进堆栈跟踪中的深度，但会在每次调用函数时打印堆栈跟踪。我发现这种方法比 strace 等更有用......因为它会记录您想要的*任何*功能，系统，库，本地或其他。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-01-30T05:04:27.933

有`rbreak`cmd 接受正则表达式来设置断点。您可以使用：

```
(gdb) rbreak Foo.*
(gdb) rbreak Bar.*
(gdb) break printf 
```

[有关断点的详细信息，请参阅this](http://sourceware.org/gdb/current/onlinedocs/gdb/Set-Breaks.html#Set-Breaks)。

然后用于`commands`打印调用的每个函数。例如让 α = 最后一个断点的编号（*如果您错过了**可以检查它`i br`*） ，然后执行：

```
(gdb) commands 1-α
Type commands for breakpoint(s) 1-α, one per line.
End with a line saying just "end".
>silent
>bt 1
>c
>end
(gdb) 
```

一些详细说明：`silent`抑制不必要的信息性消息，`bt 1`打印回溯的最后一帧*（即它是当前函数）*，`c`是`continue`, 继续执行的快捷方式，并且`end`只是命令列表的分隔符。

**注意**：如果您跟踪库函数，您可能需要等待 lib 加载。例如设置中断`main`或任何功能，运行应用程序直到该点，然后才设置你想要的断点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-14T02:59:38.617

为工作使用正确的工具；）

[如何在 GDB 中自动打印下 N 个执行的行？](https://stackoverflow.com/questions/764382/automate-tracing-in-gdb/1123188#1123188)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-23T01:29:20.607

[您是否在这里](https://stackoverflow.com/questions/311840/tool-to-trace-local-function-calls-in-linux#311912)看到了 litb 对类似帖子的出色回答？

他使用 readelf 来获取有趣的符号，使用 gdb 命令来获取跟踪，并使用 awk 来粘合所有这些。

基本上你必须改变的是修改他的 gdb 命令脚本以从回溯中删除 1 深度以查看堆栈和过滤特定功能，并使用 awk/python/(...) 脚本重新格式化输出以将其呈现为树。（我承认我现在懒得做......）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T07:53:11.503

您可以`gdb`在批处理模式下调用（使用`-x`选项），在需要的地方中断并请求回溯（`bt`），然后使用`grep`或过滤结果`egrep`。

缩进更难，但是`bt`输出是有序的，因此您在跟踪的顶部和`main`最底部都有当前函数。

所以你用命令创建文件：

```
br <function name where to break>
run
bt
kill
quit 
```

然后运行`gdb <program> -x<command file>`

过滤以 - 开头的字符串，`#<digit>`您将获得堆栈跟踪。

# c++ - 单元测试析构函数？

> ID：311949
> 
> 赞同：19
> 
> 时间：2008-11-23T00:28:04.927
> 
> 标签：c++, unit-testing, destructor, cppunit

有什么好的方法来单元测试析构函数吗？就像说我有一个像这样（人为）的例子：

```
class X
{
private:
    int *x;

public:
    X()
    {
         x = new int;
    }

    ~X()
    {
         delete x;
    }

    int *getX() {return x;}
    const int *getX() const {return x;}
}; 
```

有什么好的方法可以对此进行单元测试，以确保 x 被删除，而不会用#ifdef TESTs 弄乱我的 hpp 文件或破坏封装？我看到的主要问题是很难判断 x 是否真的被删除了，特别是因为在调用析构函数时对象超出了范围。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-23T02:40:05.473

对于依赖注入可能有一些话要说。不是在其构造函数中创建对象（在本例中为 int，但在非人为的情况下更可能是用户定义的类型），而是将对象作为参数传递给构造函数。如果稍后创建对象，则将工厂传递给 X 的构造函数。

然后，当您进行单元测试时，您传入一个模拟对象（或创建模拟对象的模拟工厂），析构函数记录它已被调用的事实。如果不是，则测试失败。

当然，您不能模拟（或以其他方式替换）内置类型，因此在这种特殊情况下它不好，但是如果您使用接口定义对象/工厂，那么您可以。

正如其他人所说，检查单元测试中的内存泄漏通常可以在更高级别完成。但这仅检查是否调用*了*析构函数，并不能证明调用了*正确*的析构函数。因此，它不会例如在 x 成员类型的析构函数上捕获丢失的“虚拟”声明（同样，如果它只是一个 int，则不相关）。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-23T02:41:15.987

我认为您的问题是您当前的示例不可测试。由于您想知道是否`x`已删除，因此您确实需要能够`x`用模拟替换。对于 int 来说，这可能有点 OTT，但我想在您的真实示例中，您还有其他类。为了使其可测试，`X`构造函数需要请求实现`int`接口的对象：

```
template<class T>
class X
{
  T *x;
  public:
  X(T* inx)
    : x(inx)
  {
  }

  // etc
}; 
```

现在模拟 for 的值变得很简单`x`，并且模拟可以处理检查是否正确销毁。

请不要注意那些说你应该打破封装或诉诸可怕的黑客以产生可测试代码的人。虽然经过测试的代码确实比未经测试的代码更好，但可测试的代码是最好的，它总是会产生更清晰的代码，更少的黑客攻击和更低的耦合。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-23T01:16:19.743

我倾向于采用“以任何必要的方式”进行测试。如果它需要测试，我愿意泄露抽象、破坏封装和破解……因为经过测试的代码比漂亮的代码更好。我经常将打破这种情况的方法命名为 VaildateForTesting 或 OverrideForTesting，以明确违反封装仅用于测试。

除了将析构函数调用到单例中以注册它已被销毁之外，我不知道在 C++ 中执行此操作的任何其他方法。我想出了一种在 C# 中使用弱引用做类似事情的方法（我不违反这种方法的封装或抽象）。我没有足够的创造力来提出与 C++ 的类比，但你可能是。如果有帮助，那就太好了，如果没有，对不起。

[http://houseofbilz.com/archive/2008/11/11/writing-tests-to-catch-memory-leaks-in-.net.aspx](http://houseofbilz.com/archive/2008/11/11/writing-tests-to-catch-memory-leaks-in-.net.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-23T01:21:39.250

在示例中，定义和检测您自己的全局 new 和 delete。

为了避免#ifdefs，我交了测试班的朋友。您可以根据需要设置/保存/获取状态以验证调用结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-27T12:12:41.003

它与提出问题的人无关，但可能对阅读此问题的其他人有所帮助。我在一次工作面试中被问到类似的问题。

假设内存有限，可以试试这个方法：

1.  分配内存直到分配失败并显示内存不足消息（在对析构函数运行任何相关测试之前）并在运行测试之前保存可用内存的大小。
2.  运行测试（调用构造函数并根据需要对新实例执行一些操作）。
3.  运行析构函数。
4.  再次运行分配部分（如步骤 1 所示），如果您可以分配与在运行测试之前设法分配的内存完全相同的内存，则析构函数可以正常工作。

当您的内存有限时，这种方法（合理地）有效，否则它似乎不合理，至少在我看来。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-23T01:13:08.440

一些编译器会在调试模式下使用已知模式覆盖已删除的内存，以帮助检测对悬空指针的访问。我知道 Visual C++ 曾经使用 0xDD，但我已经有一段时间没有使用它了。

在您的测试用例中，您可以存储 x 的副本，让它超出范围并确保 *x == 0xDDDDDDDD：

```
void testDestructor()
{
    int *my_x;
    {
        X object;
        my_x = object.getX();
    }
    CPPUNIT_ASSERT( *my_x == 0xDDDDDDDD );
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-23T01:21:09.470

不是与平台无关的建议，但过去我在单元测试期间调用了 CRT 的堆检查函数，以验证在测试（或者可能是整个测试集）结束时分配的内存是否比开始。您可能还可以对平台的仪器执行类似的操作，以检查句柄计数等。

# c++ - 将 cout 重定向到 Windows 中的控制台

> ID：311955
> 
> 赞同：40
> 
> 时间：2008-11-23T00:36:42.413
> 
> 标签：c++, winapi

我有一个相对较旧的应用程序。通过一些小的更改，它几乎可以完美地与 Visual C++ 2008 一起构建。我注意到的一件事是我的“调试控制台”工作不正常。基本上在过去，我曾经`AllocConsole()`为我的调试输出创建一个控制台。然后我会使用`freopen`重定向`stdout`到它。这与 C 和 C++ 风格的 IO 完美配合。

现在，它似乎只适用于 C 风格的 IO。`cout`将诸如分配给控制台之类的东西重定向到的正确方法是什么`AllocConsole()`？

这是曾经工作的代码：

```
if(AllocConsole()) {
    freopen("CONOUT$", "wt", stdout);
    SetConsoleTitle("Debug Console");
    SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED);
} 
```

**编辑**：我想到的一件事是我可以制作一个自定义 streambuf，其溢出方法使用 C 样式 IO 写入，并`std::cout`用它替换默认的流缓冲区。但这似乎是一种逃避。2008年有没有合适的方法来做到这一点？或者这可能是 MS 忽略的东西？

**EDIT2**：好的，所以我已经实现了我上面阐述的想法。基本上它看起来像这样：

```
class outbuf : public std::streambuf {
public:
    outbuf() {
        setp(0, 0);
    }

    virtual int_type overflow(int_type c = traits_type::eof()) {
        return fputc(c, stdout) == EOF ? traits_type::eof() : c;
    }
};

int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPTSTR lpCmdLine, int nCmdShow) {
    // create the console
    if(AllocConsole()) {
        freopen("CONOUT$", "w", stdout);
        SetConsoleTitle("Debug Console");
        SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED);  
    }

    // set std::cout to use my custom streambuf
    outbuf ob;
    std::streambuf *sb = std::cout.rdbuf(&ob);

    // do some work here

    // make sure to restore the original so we don't get a crash on close!
    std::cout.rdbuf(sb);
    return 0;
} 
```

有没有人有比仅仅强迫`std::cout`自己成为美化更好/更清洁的解决方案`fputc`？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2014-09-19T05:40:17.367

## 2018 年 2 月更新：

这是修复此问题的函数的最新版本：

```
void BindCrtHandlesToStdHandles(bool bindStdIn, bool bindStdOut, bool bindStdErr)
{
    // Re-initialize the C runtime "FILE" handles with clean handles bound to "nul". We do this because it has been
    // observed that the file number of our standard handle file objects can be assigned internally to a value of -2
    // when not bound to a valid target, which represents some kind of unknown internal invalid state. In this state our
    // call to "_dup2" fails, as it specifically tests to ensure that the target file number isn't equal to this value
    // before allowing the operation to continue. We can resolve this issue by first "re-opening" the target files to
    // use the "nul" device, which will place them into a valid state, after which we can redirect them to our target
    // using the "_dup2" function.
    if (bindStdIn)
    {
        FILE* dummyFile;
        freopen_s(&dummyFile, "nul", "r", stdin);
    }
    if (bindStdOut)
    {
        FILE* dummyFile;
        freopen_s(&dummyFile, "nul", "w", stdout);
    }
    if (bindStdErr)
    {
        FILE* dummyFile;
        freopen_s(&dummyFile, "nul", "w", stderr);
    }

    // Redirect unbuffered stdin from the current standard input handle
    if (bindStdIn)
    {
        HANDLE stdHandle = GetStdHandle(STD_INPUT_HANDLE);
        if(stdHandle != INVALID_HANDLE_VALUE)
        {
            int fileDescriptor = _open_osfhandle((intptr_t)stdHandle, _O_TEXT);
            if(fileDescriptor != -1)
            {
                FILE* file = _fdopen(fileDescriptor, "r");
                if(file != NULL)
                {
                    int dup2Result = _dup2(_fileno(file), _fileno(stdin));
                    if (dup2Result == 0)
                    {
                        setvbuf(stdin, NULL, _IONBF, 0);
                    }
                }
            }
        }
    }

    // Redirect unbuffered stdout to the current standard output handle
    if (bindStdOut)
    {
        HANDLE stdHandle = GetStdHandle(STD_OUTPUT_HANDLE);
        if(stdHandle != INVALID_HANDLE_VALUE)
        {
            int fileDescriptor = _open_osfhandle((intptr_t)stdHandle, _O_TEXT);
            if(fileDescriptor != -1)
            {
                FILE* file = _fdopen(fileDescriptor, "w");
                if(file != NULL)
                {
                    int dup2Result = _dup2(_fileno(file), _fileno(stdout));
                    if (dup2Result == 0)
                    {
                        setvbuf(stdout, NULL, _IONBF, 0);
                    }
                }
            }
        }
    }

    // Redirect unbuffered stderr to the current standard error handle
    if (bindStdErr)
    {
        HANDLE stdHandle = GetStdHandle(STD_ERROR_HANDLE);
        if(stdHandle != INVALID_HANDLE_VALUE)
        {
            int fileDescriptor = _open_osfhandle((intptr_t)stdHandle, _O_TEXT);
            if(fileDescriptor != -1)
            {
                FILE* file = _fdopen(fileDescriptor, "w");
                if(file != NULL)
                {
                    int dup2Result = _dup2(_fileno(file), _fileno(stderr));
                    if (dup2Result == 0)
                    {
                        setvbuf(stderr, NULL, _IONBF, 0);
                    }
                }
            }
        }
    }

    // Clear the error state for each of the C++ standard stream objects. We need to do this, as attempts to access the
    // standard streams before they refer to a valid target will cause the iostream objects to enter an error state. In
    // versions of Visual Studio after 2005, this seems to always occur during startup regardless of whether anything
    // has been read from or written to the targets or not.
    if (bindStdIn)
    {
        std::wcin.clear();
        std::cin.clear();
    }
    if (bindStdOut)
    {
        std::wcout.clear();
        std::cout.clear();
    }
    if (bindStdErr)
    {
        std::wcerr.clear();
        std::cerr.clear();
    }
} 
```

为了定义此函数，您需要以下一组包含：

```
#include <windows.h>
#include <io.h>
#include <fcntl.h>
#include <iostream> 
```

简而言之，此函数将 C/C++ 运行时标准输入/输出/错误句柄与与 Win32 进程关联的当前标准句柄同步。正如[文档中提到的](https://docs.microsoft.com/en-us/windows/console/allocconsole)，AllocConsole 为我们更改了这些进程句柄，因此只需在 AllocConsole 之后调用此函数来更新运行时句柄，否则我们将留下运行时初始化时锁定的句柄。基本用法如下：

```
// Allocate a console window for this process
AllocConsole();

// Update the C/C++ runtime standard input, output, and error targets to use the console window
BindCrtHandlesToStdHandles(true, true, true); 
```

此功能已经过多次修订，因此如果您对历史信息或替代方案感兴趣，请查看对此答案的编辑。但是，当前的答案是解决此问题的最佳方法，它提供了最大的灵活性并适用于任何 Visual Studio 版本。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-08T13:34:38.610

我以答案形式发布了一个便携式解决方案，以便可以接受。基本上，我将`cout`'s替换`streambuf`为使用 c 文件 I/O 实现的一个，它最终会被重定向。感谢大家的意见。

```
class outbuf : public std::streambuf {
public:
    outbuf() {
        setp(0, 0);
    }

    virtual int_type overflow(int_type c = traits_type::eof()) {
        return fputc(c, stdout) == EOF ? traits_type::eof() : c;
    }
};

int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPTSTR lpCmdLine, int nCmdShow) {
    // create the console
    if(AllocConsole()) {
        freopen("CONOUT$", "w", stdout);
        SetConsoleTitle("Debug Console");
        SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED);  
    }

    // set std::cout to use my custom streambuf
    outbuf ob;
    std::streambuf *sb = std::cout.rdbuf(&ob);

    // do some work here

    // make sure to restore the original so we don't get a crash on close!
    std::cout.rdbuf(sb);
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-23T21:26:23.077

如果控制台仅用于调试，您可以只使用`OutputDebugStringA`/`OutputDebugStringW`功能。如果您处于调试模式，它们的输出将定向到 VS 中的输出窗口，否则您可以使用[DebugView](http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx)来查看它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-07-12T09:09:11.097

这适用于 C++ 风格 I/O 的 VC++ 2017

```
AllocConsole();

// use static for scope
static ofstream conout("CONOUT$", ios::out); 
// Set std::cout stream buffer to conout's buffer (aka redirect/fdreopen)
cout.rdbuf(conout.rdbuf());

cout << "Hello World" << endl; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-09-16T19:21:39.923

对于原始版本，您可以只使用 sync_with_stdio(1) 示例：

```
if(AllocConsole())
{
    freopen("CONOUT$", "wt", stdout);
    freopen("CONIN$", "rt", stdin);
    SetConsoleTitle(L"Debug Console");
    std::ios::sync_with_stdio(1);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-23T01:19:55.603

ios 库有一个函数可以让您将 C++ IO 重新同步到任何标准 C IO 正在使用的内容：ios::sync_with_stdio()。

这里有一个很好的解释：http: [//dslweb.nwnexus.com/~ast/dload/guicon.htm](http://dslweb.nwnexus.com/~ast/dload/guicon.htm)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-23T01:39:32.520

据我所知，如果这是您第一次使用控制台活动，您的代码应该可以在 VC 2005 中使用。

在检查了一些可能性之后，您可能会在分配控制台之前尝试编写一些东西。此时写入 std::cout 或 std::wcout 将失败，您需要在进行进一步输出之前清除错误标志。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-23T11:11:03.180

Raymond Martineau 提出了一个很好的观点，即它是“你要做的第一件事”。

我有一个重定向问题，我忘记了现在的细节，结果证明在应用程序执行的早期，运行时会做出一些关于输出方向的决定，然后这些决定会持续到应用程序的其余部分。

在通过 CRT 源执行此操作后，我能够通过清除 CRT 中的一个变量来颠覆这个机制，这使它在我完成 AllocConsole 后重新审视事物。

显然，这种东西不会是可移植的，甚至可能跨工具链版本，但它可能会帮助你。

在您的 AllocConsole 之后，一路向下进入下一个 cout 输出，并找出它的去向和原因。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-05-31T04:24:05.627

试试这个 2 班轮：

```
 AllocConsole(); //debug console
    std::freopen_s((FILE**)stdout, "CONOUT$", "w", stdout); //just works 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-04-29T14:17:51.777

我不知道，但至于为什么会发生这种情况，可能`freopen("CONOUT$", "w", stdout);`不会将进程参数块（`NtCurrentPeb()->ProcessParameters->StandardOutput`过程（`NtCurrentPeb()->ProcessParameters->ConsoleHandle`）。它可能只是进行 LPC 调用，然后将句柄分配给`FILE * stdout`全局变量。C++ cout 根本不使用`FILE * stdout`，并且可能仍然无法与标准句柄的 PEB 同步。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-11-23T10:51:40.223

我不确定我是否完全理解了这个问题，但是如果您希望能够简单地将数据吐出到控制台以进行诊断..为什么不尝试 System::Diagnostics::Process::Execute() 方法或某些方法那个命名空间？？

如果无关紧要请提前道歉

# cocoa - 获取另一个应用程序窗口的唯一 ID

> ID：311956
> 
> 赞同：5
> 
> 时间：2008-11-23T00:38:56.293
> 
> 标签：cocoa, macos, macos-carbon

我是一个新手 Cocoa 开发人员，我正在开发我的第一个应用程序。我想从任何应用程序的任何窗口中读取唯一标识符——无论是 Cocoa 还是 Carbon。Cocoa 应用程序使它们的窗口 ID 可用于 AppleScript（尽管我确信通过适当的 Objective C 路由有更好的方法来做到这一点），但我正在尝试从 Adob​​e 应用程序中的文档访问窗口 ID。这似乎要棘手得多。我在参考库中似乎只能找到[HIWindowGetCGWindowID](http://developer.apple.com/documentation/Carbon/Reference/Window_Manager/Reference/reference.html#//apple_ref/c/func/HIWindowGetCGWindowID)：

"此函数返回窗口服务器在创建窗口时分配的窗口 ID。窗口 ID 通常不会与任何其他 Carbon 函数一起使用，但可以与其他需要窗口 ID 的 Mac OS X 函数一起使用，例如函数在 OpenGL 中。”

这可以用来从我的程序中获取 ID 吗？或者它只是一个可以在一个应用程序中使用的功能？

如果有人能指出我正确的方向，我将永远感激不尽。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-23T03:59:17.793

该函数`HIWindowGetCGWindowID()`只能`CGWindowID`为您的应用程序的一个窗口返回 a，因为`WindowRef`来自另一个程序的 a 在您的窗口中无效。

*CGWindow.h*中的函数`CGWindowListCopyWindowInfo()`将返回一个字典数组，每个窗口对应于您设置的条件，包括其他应用程序中的条件。它只允许您按给定窗口上方的窗口、给定窗口下方的窗口和“屏幕上”窗口进行过滤，但返回的字典包含拥有应用程序的进程 ID，您可以使用该 ID 将窗口与应用程序匹配。在每个返回的字典中，键将指向窗口 ID 作为. 还有一个函数只返回一个s 数组。*除了CGWindow.h*头文件和[Grab](http://developer.apple.com/samplecode/SonOfGrab/index.html)示例代码之外，基本上没有这些函数的文档。此外，它只有 10.5。 *`kCGWindowNumber``CFNumber``CGWindowListCreate()``CGWindowID`*

 **# python - 将整数作为字符串转换为 int 时如何不引发 Python 异常

> ID：311963
> 
> 赞同：1
> 
> 时间：2008-11-23T01:01:56.483
> 
> 标签：python, text, integer

我有一些我正在尝试解析的 HTML。在某些情况下，仅 html 属性并不能帮助我识别行类型（标题与数据）。幸运的是，如果我的行是数据行，那么它应该有一些可以转换为整数的值。对于可以进行转换的情况，我已经弄清楚了如何将 unicode 转换为整数。我正在努力编写逻辑以越过转换不起作用的单元格，因为该单元格具有必须被视为文本的内容。

例如，如果 rowColumn[1][3] 可以转换为整数，我可以通过

```
int(rowColumn[1][3].replace(',','').strip('$')) 
```

但如果 rowColumn[1][3] 包含文本内容，我会收到错误消息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T01:05:32.417

你看过 try 语句吗？

```
try:
    x = int(rowColumn[1][3].replace(',','').strip('$'))
except ValueError, e:
    x = None # rowColumn[1][3] was not an integer 
```

# php - 开始做服务器端的事情——选择什么语言和技术？

> ID：311966
> 
> 赞同：3
> 
> 时间：2008-11-23T01:05:18.940
> 
> 标签：php, ruby-on-rails, database, server-side

很长一段时间以来，我一直在做 html、css 和 javascript，主要是为了我自己的乐趣。我会说我知道的很多，我用 javascript 创建了许多简单的游戏和应用程序和实验。然而，在浏览器中可以做的事情只有这么多，对于任何更“完整”的网站，我一直面临着我对服务器端编程的无知。

那么，我需要什么。我想我需要弄清楚如何使用数据库以及如何使用一些服务器端编程语言。什么是正确的选择？我应该避免什么？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T01:15:55.487

[PHP](http://php.net/)和[MySQL](http://en.wikipedia.org/wiki/MySQL)的进入门槛相当低（它们都是免费且无处不在的）。我将从这些开始，因为大多数主机都会为您提供它们。作为一个额外的好处，它们可以很好地协同工作（并且从 Web 开发背景中学习 PHP 并不难）。

[Head First SQL](http://headfirstlabs.com/books/hfsql/)是一本学习 MySQL 的好书。本书中的所有示例都是在 MySQL 上完成的。这本书甚至解释了从哪里获得它以及如何安装它。至于 PHP，官网的[入门教程](http://us3.php.net/tut.php)是学习它的最佳场所。

更新：[Head First PHP & MySQL](http://www.amazon.ca/Head-First-MySQL-Lynn-Beighley/dp/0596006306)现已推出。我还没有读过这本书，但是该系列中的其他书籍以及同一作者的书籍非常适合从头开始学习新语言。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T01:24:37.763

下载[Python](http://www.python.org)。学习 Python 语言。学习面向对象编程。

Python 包含[SQLite](http://www.sqlite.org/)，这使得学习 SQL 语言变得更加容易。

下载[Django](http://www.djangoproject.com)框架。这使得编写简单可靠的服务器端应用程序变得容易。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T01:18:14.513

我会建议PHP。不是因为它是最好的、最现代的或最干净的语言，而是因为它对于来自纯 HTML 的人来说很容易学习。

您只需在常规 HTML 中添加少量 PHP 即可开始，奇迹发生了 :)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-23T02:32:34.957

Ruby 是一门很棒的语言，Web 框架通常会教你一些好的实践。[试试看](http://tryruby.hobix.com/)。《[学习编程》这本书](https://rads.stackoverflow.com/amzn/click/com/0976694042)使用了 Ruby，也许你想看看。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-23T03:15:33.780

我注意到您在问题中提到您一直在使用 javascript。如果您对 javascript 编程感到满意，我最近开始在 linux 上以[EJScript](http://www.ejscript.org/)的形式使用服务器端 javascript，并在 Windows 上使用 jscript。它相当轻松，到目前为止，两者的文档都非常好。如果您对使用另一种技术来学习这一点更感兴趣，那么 Django 和 Python 或 ASP.NET 和 C#（或 IronPython）对于 windows、*nix 等可用的入门平台的门槛都相当低...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-23T02:40:08.327

我想说，如果你喜欢在 Linux 中工作，那就去 PHP 和 MySQL。如果您不习惯在 Linux 中工作，请下载免费的[Visual Web Developer](http://www.microsoft.com/express/vwd/)版本的 Visual Studio Express，然后开始使用它。这使您可以在 VB.Net 或 C# 中编程，并使用 .Net Web 开发框架。就它的工作平台而言，它确实比任何 PHP 都领先几英里。还有一个免费的 SQL Server 开发人员版，可让您存储多达 4 GB 的数据。

现在也有很多 .Net 主机。尽管由于许可证成本增加，Windows 托管计划通常比 Linux 托管计划成本更高，并且为您提供更少的空间/带宽，但您仍然可以获得足够的空间在 Web 上使用和部署一些应用程序。如果您开发了一些非常酷的东西，并且超出了您的托管帐户提供的功能，那么可能是时候升级到 VPS，并在您的网站上发布广告以开始支付账单

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-23T06:03:31.710

我会向熟悉 HTML 但对编程不熟悉的人推荐 PHP。原因如下：

我目前是一名 ASP.Net 开发人员，我认为 ASP.Net 将 waaaaay 抽象到很多，使其成为一个很好的第一个编程环境。我说学习如何使用 PHP 之类的语言生成和操作直接 HTML，而不是尝试理解 GridView 等，这些与更广泛意义上的编程无关。

我不会说 ASP.Net 是“黑暗之路”或任何东西，但如果您从学习它开始，您会倾向于支持框架的温暖和绝缘臂。与 PHP 等更明确（有人会说鲁莽、混乱和乏味，但我不是其中之一）方法相比，ASP.Net 几乎是一个代码生成器。

使用 PHP，您将在查看源代码时看到您的代码对实际 HTML 的影响。对于 ASP.Net 页面，您会被它吐出的 HTML 的数量和复杂性所迷惑。

在您熟悉 PHP 之后，您可以探索像 ASP.Net 这样“为您完成大量工作”的框架的优缺点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-23T06:50:11.490

我在 3 到 4 年前就处于你的境地，就像一些评论员所说的那样，我尝试了 PHP，因为它的进入门槛很低。

那是个错误！哦，当然，我能够在这里和那里取得一些成就，包括使用书中的联系表格，该表格有很大缺陷，后来被大型垃圾邮件发送者劫持，并且我的域被大多数电子邮件服务器禁止访问。

[后来，我在Sitepoint](http://www.sitepoint.com/)和其他来源的优秀书籍、博客文章和论坛的指导下，尝试学习如何使用面向对象编程创建数据库驱动的站点。这对我的小脑袋来说太难了。我就是做不到。

所以发生了什么事？2 1/2 年前，我决定学习 Rails，它刚刚转为 v.1.1。从一开始就很有趣，而且非常有益。使用 Ruby 是一种乐趣，比 PHP 更容易学习，而且 Rails 框架组合得非常好，您可以毫不费力地制作一些具有高级功能的非常精细的网站，同时学习如何做正确的面向对象的 Web编程。

我利用我的新知识从头开始重建我[的非营利组织](http://yoga108.org/)的网站（使用新域；-），并与一位才华横溢的设计师朋友一起创建了一家[网络开发公司](http://ohlalaweb.com)。

不要误会我的意思，这并不容易，如果你想学习编程，你需要付出很多努力，但根据我自己的经验，Rails 可以为你带来一些立竿见影的效果，同时让你随着时间的推移越来越深入。

我推荐两个主要的知识来源：

*   优秀的官方[Rails 指南](http://guides.rubyonrails.org/)。
*   [Railscasts](http://railscasts.com/)的免费截屏视频。

无论您的选择是什么，我都希望您拥有最好的、有趣和充实的体验

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-23T09:40:25.623

我最近自己遇到了这个问题。我真的很喜欢 PHP 与 HTML 集成的方式，这使得我认为网站设计更加自然。像使用静态内容一样设计您的网站，然后用动态切换静态。但是，我想选择一种“好”的语言。我研究了 PHP、Ruby、Perl 和 Python，因为它们是最流行的开源选项。如果你愿意的话，我不需要任何强大的工具，比如 Ruby on Rails 或 Django，因为我只是想弄乱服务器端的东西和一些 SQL——没什么大不了的。我不记得为什么，也不想记住为什么，但我选择了 Python。但我仍然希望与 HTML 集成。我遇到了[卡里格尔](http://karrigell.sourceforge.net/). 它是一个简洁的 Python 片段，基本上可以处理集成。它带有一个小型 Web 服务器，您可以单独使用它，也可以将 mod_proxy 与 lighttpd 一起使用。不过，开发人员并不限制您只能使用 HTML 中的 Python。他们的服务器解析：HTML 中的 Python、Python 中的 HTML、普通的 Python 脚本和 Karrigell 服务。它可能不像 PHP 那样集成，但它非常好。

# jquery - 定制手风琴 - 使用每个

> ID：311970
> 
> 赞同：4
> 
> 时间：2008-11-23T01:08:26.797
> 
> 标签：jquery, accordion

我正在尝试为我的页面创建一个自定义手风琴来显示我的帖子。我有它使用 HTML 的列表格式，当您单击每个标题以展开以显示更多信息时，我正在尝试创建效果。

但是我不想为`<li>`页面上的六个元素说六个代码块。

有没有办法通过 .each(); 运行它 也许？而不是创建每个部分？尝试更动态的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T01:15:01.043

你看过[这个教程](http://roshanbh.com.np/2008/03/expandable-collapsible-toggle-pane-jquery.html)吗？

因为，正如本[例所示](http://roshanbh.com.np/examples/exapandable-panel/)，不需要多个条件即可实现这一目标。

```
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript">
$(document).ready(function()
{
  //hide the all of the element with class msg_body
  $(".msg_body").hide();
  //toggle the componenet with class msg_body
  $(".msg_head").click(function()
  {
    $(this).next(".msg_body").slideToggle(600);
  });
});
</script> 
```

> 加载页面时，所有类名为“msg_body”的元素都会折叠。
> 
> jQuery 的“slideToggle()”函数用于展开和折叠类“msg_body”的“div”。
> 
> 当用户单击类“.msg_head”的元素时，旁边带有类“msg_body”的div，会以滑动效果切换，使用jQuery制作切换面板。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-04-07T12:08:51.003

检查这个也很简单的演示：[http ://demos.pankaj.pro/jquery-tutorial-guide-to-build-a-simple-accordion/](http://demos.pankaj.pro/jquery-tutorial-guide-to-build-a-simple-accordion/)

代码 [http://time2hack.com/2013/01/jquery-tutorial-guide-to-build-a-custom-and-simple-accordion.html](http://time2hack.com/2013/01/jquery-tutorial-guide-to-build-a-custom-and-simple-accordion.html)

# php - 使用 Ajax.Request 将 JSON 从浏览器传递到 PHP 的最佳方式

> ID：311987
> 
> 赞同：4
> 
> 时间：2008-11-23T01:26:51.737
> 
> 标签：php, json, prototypejs, ajax.request

嗨，我有一个 JSON 对象，它是一个二维数组，我需要使用 Ajax.Request 将它传递给 PHP（我知道的唯一方法）。...现在我使用 js 函数手动序列化我的数组...并以这种格式获取数据： s[]=1&d[]=3&[]=4 等....

我的问题是：有没有办法更直接/更有效地传递 JSON 对象？..而不是自己序列化它？

感谢您的任何建议，安德鲁

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T01:43:26.710

将对象作为 JSON 字符串传递给 PHP，在 PHP 中使用内置的 json_decode 从字符串中获取 PHP 对象。

在 Javascript 中，在对象上使用“stringify”函数将其作为字符串获取，例如此处提供的库：[https ://github.com/douglascrockford/JSON-js/blob/master/json2.js](https://github.com/douglascrockford/JSON-js/blob/master/json2.js)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T02:51:19.723

您还可以使用 Prototype 的函数[toJSON()](http://www.prototypejs.org/api/array/tojson)将数组转换为 JSON 对象。通过 Ajax 调用将其传递给服务器后，只需使用 PHP 的函数[json_decode()](http://us.php.net/json_decode)即可对对象进行解码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-23T03:01:20.390

在 que Javascript 方面（使用 Prototye）：

```
var myJSON= Object.toJSON(youArray); 
```

在 que Php 方面：

```
$myjson = $_POST['myjson'];

$arrayJSON= json_decode(stripslashes($myjson), true); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-25T14:22:49.443

检查 [http://www.openjs.com/scripts/data/ued_url_encoded_data/](http://www.openjs.com/scripts/data/ued_url_encoded_data/) 直接正确编码嵌套数据，因为 Object.toQueryString() 不接受嵌套数据...

# html - 如何让 div 浮动到其容器的底部？

> ID：311990
> 
> 赞同：304
> 
> 时间：2008-11-23T01:29:04.243
> 
> 标签：html, css, css-float

`float:right`我多次使用（或`left`）在容器顶部浮动图像和插入框。现在，我需要使用您使用的普通文本换行将 a 浮动`div`到另一个的右下角（仅在上方和左侧换行的文本）。`div``float`

我认为这一定是相对容易的，即使`float`没有任何`bottom`价值，但我无法使用多种技术来做到这一点，并且除了使用绝对定位之外，在网络上搜索没有提出任何其他方法，但这并没有给出正确的自动换行行为。

我曾认为这将是一个非常常见的设计，但显然不是。如果没有人有建议，我将不得不将我的文本分成单独的框并`div`手动对齐，但这是相当不稳定的，我不想在需要它的每个页面上都这样做。

* * *

## 回答 #1

> 赞同：321
> 
> 时间：2008-11-23T01:56:39.880

将父 div 设置为`position: relative`，然后将内部 div 设置为...

```
position: absolute; 
bottom: 0; 
```

......你去吧:)

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2013-08-11T11:41:15.823

使其工作的一种方法如下：

*   像往常一样浮动你的元素
*   使用旋转父 div 180 度

    ```
    -moz-transform:rotate(180deg);
    -webkit-transform:rotate(180deg);
    -o-transform:rotate(180deg);
    -ms-transform:rotate(180deg);
    filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=2); 
    ```

    JSfiddle：http: [//jsfiddle.net/wcneY/](http://jsfiddle.net/wcneY/)

*   现在将所有向左浮动的元素（给它们一个类）旋转 180 度，使它们再次变直。瞧！它们浮到底部。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2008-11-24T17:24:14.157

在与各种技术斗争了几天之后，我不得不说这似乎是不可能的。即使使用 javascript（我不想这样做），它似乎也不可能。

为了澄清那些可能不理解的人 - 这就是我正在寻找的：在出版中，布局插图（图片、表格、图形等）是很常见的，这样它的底部与最后一个的底部对齐块（或页面）的文本行，文本以自然的方式围绕插入物在上方和右侧或左侧流动，具体取决于插入物位于页面的哪一侧。在 html/css 中，使用浮动样式将 inset 的顶部与块的顶部对齐是微不足道的，但令我惊讶的是，尽管它是一种常见的布局任务，但似乎不可能对齐文本的底部和 inset .

我想我将不得不重新审视这个项目的设计目标，除非有人有最后一分钟的建议。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2012-05-04T15:14:19.317

我在 JQuery 中通过在浮动右侧上方放置一个零宽度支柱元素来实现这一点，然后根据父高度减去浮动孩子的高度来调整支柱（或管道）的大小。

在 js 开始之前，我使用的是绝对位置方法，该方法有效，但允许文本在后面流动。因此，我切换到静态位置以启用支撑方法。（header 是父元素，cutout 是我想要的右下角，而 pipe 是我的支柱）

```
$("header .pipe").each(function(){
    $(this).next(".cutout").css("position","static");       
    $(this).height($(this).parent().height()-$(this).next(".cutout").height());                                                 
}); 
```

CSS

```
header{
    position: relative; 
}

header img.cutout{
    float:right;
    position:absolute;
    bottom:0;
    right:0;
    clear:right
}
header .pipe{
    width:0px; 
    float:right

} 
```

管道必须排在第一位，然后是切口，然后是 HTML 顺序中的文本。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2010-09-07T15:07:44.290

这会在页面底部放置一个固定的 div，并在您向下滚动时固定到底部

```
#div {
    left: 0;
    position: fixed;
    text-align: center;
    bottom: 0;
    width: 100%;
} 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-11-23T01:59:51.653

将 div 放入另一个 div 并将父 div 的样式设置为`position:relative;`然后在子 div 上设置以下 CSS 属性：`position:absolute; bottom:0;`

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-05-07T18:25:39.483

如果将父元素设置为位置：相对，则可以将子元素设置为底部设置位置：绝对；和底部：0；

```
#outer {
  width:10em;
  height:10em;
  background-color:blue;
  position:relative; 
}

#inner {
  position:absolute;
  bottom:0;
  background-color:white; 
}
```

```
<div id="outer">
  <div id="inner">
    <h1>done</h1>
  </div>
</div> 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-04-16T06:21:38.060

如果您可以只将文本的最底部一行放在块的一侧（而不是完全在它周围和下方，如果不结束块并开始一个新块，您就无法做到这一点），那就是将块浮动到父块的底角之一并非不可能。如果您将一些内容放在块内的段落标签中，并希望将链接浮动到块的右下角，请将链接放在段落块内并将其设置为 float: right，然后放入带有 clear 的 div 标签: 都设置在段落标签的末尾。最后一个 div 是为了确保父标签围绕浮动标签。

```
<div class="article" style="display: block;">
    <h3>title</h3>
        <p>
            text content
            <a href="#" style="display: block;float: right;">Read More</a>
        </p>
    <div style="clear: both;"></div>
</div> 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-07-05T19:13:21.357

我也找到了这个解决方案很长时间了。这就是我得到的：

对齐自我：flex-end；

链接：[https](https://philipwalton.github.io/solved-by-flexbox/demos/vertical-centering/) ://philipwalton.github.io/solved-by-flexbox/demos/vertical-centering/ 但是，我不记得我是从哪里打开这个链接的。希望能帮助到你

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-12-12T19:41:29.727

如果您希望文本很好地换行：-

```
.outer {
  display: table;
}

.inner {
  height: 200px;
  display: table-cell;
  vertical-align: bottom;
}

/* Just for styling */
.inner {
  background: #eee;
  padding: 0 20px;
}
```

```
<!-- Need two parent elements -->
<div class="outer">
  <div class="inner">
    <h3>Sample Heading</h3>
    <p>Sample Paragragh</p>
  </div>
</div>
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2015-12-10T12:52:41.873

随着[**Flexbox**](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)的引入，这变得非常容易，无需太多黑客攻击。[`align-self: flex-end`](https://developer.mozilla.org/en-US/docs/Web/CSS/align-self)在子元素上将沿[cross-axis 对齐](http://www.w3.org/TR/css-flexbox-1/#box-model)。

```
.container {
  display: flex;
}
.bottom {
  align-self: flex-end;
} 
```

```
<div class="container">
  <div class="bottom">Bottom of the container</div>
</div> 
```

**输出：**

```
.container {
  display: flex;
  /* Material design shadow */
  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 1px 5px 0 rgba(0, 0, 0, 0.12);
  height: 100px;
  width: 175px;
  padding: 10px;
  background: #fff;
  font-family: Roboto;
}
.bottom {
  align-self: flex-end;
}
```

```
<div class="container">
  <div class="bottom">Bottom of the container</div>
</div>
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-09-16T15:15:59.247

我知道这东西很旧，但我最近遇到了这个问题。

*使用绝对位置 div*的建议真的很愚蠢，因为整个浮动的东西在绝对位置上有点失去意义..

现在，我没有找到一个通用的解决方案，但在很多情况下，prople 使用浮动 div 只是为了连续显示一些东西，比如一系列 span 元素。你不能垂直对齐。

要达到类似的效果，您可以这样做：不要让 div 浮动，而是将其 display 属性设置为`inline-block`. 然后你可以垂直对齐它，但它会让你满意。您只需要将父级的 div 属性设置`vertical-align`为`top`、`bottom`或`middle``baseline`

我希望这可以帮助某人

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-01-23T05:52:16.170

这现在可以通过 flex box 实现。只需将父 div 的 'display' 设置为 'flex' 并将 'margin-top' 属性设置为 'auto' 即可。这不会扭曲两个 div 的任何属性。

```
.parent {
  display: flex;
  height: 100px;
  border: solid 1px #0f0f0f;
}
.child {
  margin-top: auto;
  border: solid 1px #000;
  width: 40px;
  word-break: break-all;
}
```

```
<div class=" parent">
  <div class="child">I am at the bottom!</div>
</div>
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-06-08T14:10:54.730

不确定，但是如果您在子 div 上使用**position: relative而不是 absolute，则之前发布的场景似乎有效。**

```
#parent {
  width: 780px;
  height: 250px;
  background: yellow;
  border: solid 2px red;
}
#child {
  position: relative;
  height: 50px;
  width: 780px;
  top: 100%;
  margin-top: -50px;
  background: blue;
  border: solid 2px green;
} 
```

```
<div id="parent">
    This has some text in it.

    <div id="child">
        This is just some text to show at the bottom of the page
    </div>
</div> 
```

而且没有桌子......！

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-06-27T12:18:09.130

我只会做一张桌子。

```
<div class="elastic">
  <div class="elastic_col valign-bottom">
    bottom-aligned content.
  </div>
</div> 
```

和CSS：

```
.elastic {
  display: table;
}
.elastic_col {
  display: table-cell;
}
.valign-bottom {
  vertical-align: bottom;
} 
```

在行动中看到它：http:
[//jsfiddle.net/mLphM/1/](http://jsfiddle.net/mLphM/1/)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-10-02T17:11:50.720

我尝试了其中几种技术，以下对我有用，所以如果所有其他方法都失败了，那么试试这个，因为它对我有用:)。

```
<style>
  #footer {
    height:30px;
    margin: 0;
    clear: both;
    width:100%;
    position: relative;
    bottom:-10;
  }
</style>

<div id="footer" >Sportkin - the registry for sport</div> 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-10-23T13:12:01.070

A 选择了@dave-kok 的这种方法。但它只有在整个内容都适合而不滚动的情况下才有效。我很感激如果有人会改进

```
outer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 100%;
}
.space {
    float: right;
    height: 75%;  
}
.floateable {
    width: 40%;
    height: 25%;
    float: right;
    clear: right;  
 } 
```

这是代码 [http://jsfiddle.net/d9t9joh2/](http://jsfiddle.net/d9t9joh2/)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2019-08-05T06:20:59.630

使用 css`margin-top`属性将页脚设置到其容器的底部。并使用 css `text-align-last`属性将页脚内容设置在中心。

```
 <div class="container" style="margin-top: 700px;  text-align-last: center; ">
      <p>My footer Here</p>  
 </div> 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-07-02T18:55:09.247

浮动和绝对定位的组合对我有用。我试图将消息的发送时间放在对话气泡的右下角。时间不应与消息正文重叠，除非确实有必要，否则它不会使气泡膨胀。

该解决方案的工作原理如下：

1.  有两个文本相同的跨度；
2.  一个是漂浮但看不见的；
3.  另一个绝对定位到角落；

隐形浮动的目的是为可见的确保空间。

```
.speech-bubble {
  font-size: 16px;
  max-width: 240px;
  margin: 10px;
  display: inline-block;
  background-color: #ccc;
  border-radius: 5px;
  padding: 5px;
  position: relative;
}

.inline-time {
  float: right;
  padding-left: 10px;
  color: red;
}

.giant-text {
  font-size: 36px;
}

.tremendous-giant-text {
  font-size: 72px;
}

.absolute-time {
  position: absolute;
  color: green;
  right: 5px;
  bottom: 5px;
}

.hidden {
  visibility: hidden;
}
```

```
<ul>
  <li>
    <span class='speech-bubble'>
      This text is supposed to wrap the time &lt;span&gt; which always seats at the corner of this bubble.
      <span class='inline-time'>13:55</span>
    </span>
  </li>

  <li>
    <span class='speech-bubble'>
      Absolute positioning doesn't work because it doesn't care if the two pieces of text overlap. We want to float.
      <span class='inline-time'>13:55</span>
    </span>
  </li>

  <li>
    <span class='speech-bubble'>
      Easy, uh?
      <span class='inline-time'>13:55</span>
    </span>
  </li>

  <li>
    <span class='speech-bubble'>
      Well, not <span class='giant-text'>THAT</span>
      easy
      <span class='inline-time'>13:56</span>
    </span>
  </li>

  <li>
    <span class='speech-bubble'>
      <span class='tremendous-giant-text'>See?</span>
      <span class='inline-time'>13:56</span>
    </span>
  </li>

  <li>
    <span class='speech-bubble'>
      The problem is, we can't tell the span to float to right AND bottom...
      <span class='inline-time'>13:56</span>
    </span>
  </li>

  <li>
    <span class='speech-bubble'>
      We can combinate float and absolute: use floated span to reserve space (the bubble will be inflated if necessary) so that the absoluted span is safe to go.
      <span class='inline-time'>13:56</span>
    </span>
  </li>

  <li>
    <span class='speech-bubble'>
      <span class='tremendous-giant-text'>See?</span>
      <span class='inline-time'>13:56</span>
      <span class='absolute-time'>13:56</span>
    </span>
  </li>

  <li>
    <span class='speech-bubble'>
      Make the floated span invisible.
      <span class='inline-time'>13:56</span>
    </span>
  </li>

  <li>
    <span class='speech-bubble'>
      <span class='tremendous-giant-text'>See?</span>
      <span class='inline-time hidden'>13:56</span>
      <span class='absolute-time'>13:56</span>
    </span>
  </li>

  <li>
    <span class='speech-bubble'>
      The giant text here is to simulate images which are common in a typical chat app.
      <span class='tremendous-giant-text'>Done!</span>
      <span class='inline-time hidden'>13:56</span>
      <span class='absolute-time'>13:56</span>
    </span>
  </li>
</ul>
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-06-08T00:34:17.240

如果您需要相对对齐并且 DIV 仍然无法满足您的需求，只需使用表格并在您希望内容与底部对齐的单元格中设置 valign = "bottom"。我知道这不是您问题的一个很好的答案，因为 DIV 应该替换表格，但这是我最近对图像标题所做的事情，到目前为止它工作得完美无缺。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2010-07-13T15:02:03.150

我也尝试过之前发布的这个场景；

```
div {
  position: absolute; 
  height: 100px; 
  top: 100%; 
  margin-top:-100px; 
} 
```

绝对定位在加载页面时将 div 固定到浏览器的最低部分，但是当页面较长时向下滚动时，它不会随您滚动。我将定位更改为相对，并且效果很好。加载时 div 直接到达底部，因此在到达底部之前您实际上不会看到它。

```
div {
      position: relative;
      height:100px; /* Or the height of your image */
      top: 100%;
      margin-top: -100px;
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2012-02-02T15:15:28.833

一种有趣的方法是将几个右浮动元素堆叠在一起。

```
<div>
<div style="float:right;height:200px;"></div>
<div style="float:right;clear:right;">Floated content</div>
<p>Other content</p>
</div> 
```

唯一的问题是，这仅在您知道盒子的高度时才有效。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-07-24T17:41:40.907

Stu 的答案是迄今为止最接近工作的，但它仍然没有考虑到您的外部 div 的高度可能会根据文本在其中的换行方式而发生变化的事实。因此，仅重新定位内部 div（通过更改“管道”的高度）是不够的。这种变化必须发生在循环内，因此您可以不断检查您是否已经实现了正确的定位，并在需要时重新调整。

上一个答案中的 CSS 仍然完全有效：

```
#outer {
    position: relative; 
}

#inner {
    float:right;
    position:absolute;
    bottom:0;
    right:0;
    clear:right
}

.pipe {
    width:0px; 
    float:right

} 
```

但是，Javascript 应该看起来更像这样：

```
var innerBottom;
var totalHeight;
var hadToReduce = false;
var i = 0;
jQuery("#inner").css("position","static");
while(true) {

    // Prevent endless loop
    i++;
    if (i > 5000) { break; }

    totalHeight = jQuery('#outer').outerHeight();
    innerBottom = jQuery("#inner").position().top + jQuery("#inner").outerHeight();
    if (innerBottom < totalHeight) {
        if (hadToReduce !== true) { 
            jQuery(".pipe").css('height', '' + (jQuery(".pipe").height() + 1) + 'px');
        } else { break; }
    } else if (innerBottom > totalHeight) {
        jQuery(".pipe").css('height', '' + (jQuery(".pipe").height() - 1) + 'px');
        hadToReduce = true;
    } else { break; }
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-11-27T12:57:13.527

我知道这是一个非常古老的线程，但我仍然想回答。如果有人遵循下面的 css & html，那么它就可以工作。子页脚 div 将像胶水一样粘在底部。

```
<style>
        #MainDiv
        {
            height: 300px;
            width: 300px;
            background-color: Red;
            position: relative;
        }

        #footerDiv
        {
            height: 50px;
            width: 300px;
            background-color: green;
            float: right;
            position: absolute;
            bottom: 0px;
        }
    </style>

<div id="MainDiv">
     <div id="footerDiv">
     </div>
</div> 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-07-12T18:14:50.363

虽然这很复杂，但这是可能的。我已经在最新的 Firefox 和 Google Chrome 浏览器上检查了这个代码。较旧的浏览器可能不支持 css`shape-outside`属性。有关更多详细信息，[请查看此参考](https://developer.mozilla.org/en-US/docs/Web/CSS/shape-outside)。

```
window.addEventListener('load', function() {
  var imageHolder = document.querySelector('.image-holder');

  var containerHeight = document.querySelector('.container').offsetHeight;

  var imageHolderHeight = imageHolder.offsetHeight;

  var countPadding = containerHeight - imageHolderHeight;
  imageHolder.style.paddingTop = countPadding + 'px';
  containerHeight = document.querySelector('.container').offsetHeight;
  var x1 = '0' + 'px ' + countPadding + 'px';

  var x2 = imageHolder.offsetWidth + 'px' + ' ' + countPadding + 'px';

  var x3 = imageHolder.offsetWidth + 'px' + ' ' + containerHeight + 'px';

  var x4 = 0 + 'px' + ' ' + containerHeight + 'px';

  var value = 'polygon(' + x1 + ',' + x2 + ',' + x3 + ',' + x4 + ')';

  imageHolder.style.shapeOutside = value;

});
```

```
.container {
  width: 300px;
  text-align: justify;
  border: 1px solid black;
}

.image-holder {
  float: right;
}
```

```
<div class='container' style="">
  <div class='image-holder' style=''>
    <img class='bottom-right' style="width: 100px;" src="https://www.lwb.org.au/services/child-youth-and-family/static/b5cca79df7320248a77f6655a278190f/a6c62/img-index-banner.jpg" alt="">
  </div>
  <div>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Error quasi ut ipsam saepe, dignissimos, accusamus debitis ratione neque doloribus quis exercitationem iure! Harum quisquam ipsam velit distinctio tempora repudiandae eveniet.</div>

</div>
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-03-19T12:24:10.757

使用一些 JavaScript，我设法将一个浮动元素固定到其容器的底部 - 并且仍然让它浮动在文本中，这对于诸如 shape-outside 之类的东西非常有用。

浮动元素获得一个等于其容器的边距顶部，减去它自己的高度。这会保留浮动，将元素推到其容器的底部边缘并防止文本在元素下方流动。

```
 const resizeObserver = new ResizeObserver(entries => {
  if(entries.length == 0) return;
  const entry = entries[0];
  if(!entry.contentRect) return;

  const containerHeight = entry.contentRect.height;
  const imgHeight = imgElem.height;
  const imgOffset = containerHeight - imgHeight;

  imgElem.style.marginTop = imgOffset + 'px';
});

const imgElem = document.querySelector('.image');
resizeObserver.observe(imgElem.parentElement); 
```

工作示例：[https ://codepen.io/strarsis/pen/QWGXGVy](https://codepen.io/strarsis/pen/QWGXGVy)

感谢 ResizeObserver 和对 JavaScript 的广泛支持，这似乎是一个非常可靠的解决方案。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-10-28T06:38:06.650

试试这个 CSS+Javascript 解决方案。从右上角的浮动 div 开始。然后计算沿右边缘的零宽度 div 的高度，以将浮动 div 推到底部。此代码可能需要一些调整才能获得正确的高度。

```
<style>
  #mainbox {border:4px solid red;width:500px;padding:10px;}
  .rightpad {float:right;clear:right;padding:0;width:0;}
  #floater {background-color:red;text-align:center;color:#FFF;width:300px;height:100px;float:right;margin-right:-10px;margin-top:10px;}
</style>
<script>
window.onload = function() {
  var mmheight = document.getElementById("mainbox").clientHeight;
  var ff = document.getElementById("floater");
  var ffheight = ff.clientHeight;
  var dd = document.createElement('div');
  dd.className = "rightpad";
  dd.style.height = (mmheight - ffheight - 20) * 1 + "px";
  ff.parentNode.insertBefore(dd,ff);
}
</script>
<div id="mainbox">
  <div id="floater" class="rightpad">123</div>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam posuere tellus et dolor vestibulum gravida. Donec vel nunc massa. Quisque quis varius libero. Fusce ut elementum magna. Praesent hendrerit diam sed velit rutrum mollis. Nunc pretium metus in tempus tempus. Quisque laoreet nibh eget volutpat dictum. Pellentesque libero ipsum, tristique et aliquam aliquam, accumsan sed sem. Phasellus facilisis sem eget mi tempus rhoncus.</p></div> 
```

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2010-04-30T17:08:36.063

很老的问题，但仍然......您可以像这样将 div 浮动到页面底部：

```
div{
  position: absolute; 
  height: 100px; 
  top: 100%; 
  margin-top:-100px; 
} 
```

你可以看到魔法发生在哪里。我认为您可以将其浮动到父 div 的底部。

* * *

## 回答 #29

> 赞同：-2
> 
> 时间：2010-07-12T18:41:55.960

`position:absolute; bottom:0;`通过添加到 CSS 中的 div ID，我在第一次尝试时就可以使用它。我没有添加父样式`position:relative;`。

它在 Firefox 和 IE 8 中都能完美运行，还没有在 IE 7 中尝试过。

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2012-01-02T21:24:38.460

另一种答案是明智地使用表格和行跨度。通过将前一行上的所有表格单元格（主要内容之一除外）设置为 rowspan="2"，您将始终在主表格单元格的底部获得一个单元格孔，您始终可以放置 valign="bottom"。

您还可以将其高度设置为一条线所需的最小值。因此，无论其余文本占用多少空间，您总是会在底部找到您最喜欢的文本行。

我尝试了所有 div 答案，但无法让他们做我需要的事情。

```
<table>
<tr>
   <td valign="top">
     this is just some random text
     <br> that should be a couple of lines long and
     <br> is at the top of where we need the bottom tag line
   </td>
   <td rowspan="2">
     this<br/>
     this<br/>
     this<br/>
     this<br/>
     this<br/>
     this<br/>
     this<br/>
     this<br/>
     this<br/>
     this<br/>
     this<br/>
     is really<br/>
     tall
  </td>
</tr>
<tr>
  <td valign="bottom">
      now this is the tagline we need on the bottom
  </td>
</tr>
</table> 
```

* * *

## 回答 #31

> 赞同：-2
> 
> 时间：2012-02-17T14:44:24.597

这是我的解决方案：

```
<style>
.sidebar-left{float:left;width:200px}
.content-right{float:right;width:700px}

.footer{clear:both;position:relative;height:1px;width:900px}
.bottom-element{position:absolute;top:-200px;left:0;height:200px;}

</style>

<div class="sidebar-left"> <p>content...</p></div>
<div class="content-right"> <p>content content content content...</p></div>

<div class="footer">
    <div class="bottom-element">bottom-element-in-sidebar</div>
</div> 
```

* * *

## 回答 #32

> 赞同：-2
> 
> 时间：2015-02-13T22:34:33.357

简单......在 html 文件中......在底部有“页脚”（或底部的 div）。所以不要这样做：

```
<div id="container">
    <div id="Header"></div>
    <div id="Footer"></div>
    <div id="Content"></div>
    <div id="Sidebar"></div>
</div> 
```

这样做：（下面有页脚。）

```
<div id="container">
    <div id="Header"></div>
    <div id="Content"></div>
    <div id="Sidebar"></div>
    <div id="Footer"></div>
</div> 
```

完成此操作后，您可以转到 css 文件并将“侧边栏”浮动到左侧。然后让“内容”向右浮动，然后让“页脚”都清除。

那应该对我有用。

* * *

## 回答 #33

> 赞同：-2
> 
> 时间：2020-06-19T19:28:03.090

哦，年轻人……你在这里：

```
<div class="block">
    <a href="#">Some Content with a very long description. Could be a Loren Ipsum or something like that.</a>
    <span>
        <span class="r-b">A right-bottom-block with some information</span>
    </span>
    <span class="clearfix"></span>
</div>
<style>
    .block {
        border: #000 solid 1px;
    }

    .r-b {
        border: #f00 solid 1px;
        background-color: fuchsia;
        float: right;
        width: 33%
    }

    .clearfix::after {
        display: block;
        clear: both;
        content: "";
    }
</style> 
```

没有绝对的地位！反应灵敏！老套

* * *

## 回答 #34

> 赞同：-3
> 
> 时间：2016-12-23T03:05:53.683

您可以尝试使用宽度为 1px 的空元素并将其浮动。然后清除您实际要定位的元素并使用空元素的高度来控制它向下的距离。

[http://codepen.io/cssgrid/pen/KNYrey/](http://codepen.io/cssgrid/pen/KNYrey/)

```
.invisible {
float: left;  
}

.bottom {
float: left;
padding-right: 35px;
padding-top: 30px;
clear: left;
} 
```

* * *

## 回答 #35

> 赞同：-5
> 
> 时间：2013-03-10T14:59:15.513

要将任何元素放在其容器的底部，只需使用以下命令：

```
div {
    position: absolute;
    bottom: 0px;
} 
```****