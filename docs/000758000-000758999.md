# StackOverflow 问答 000758000-000758999

# c - 在我的 math.h 中找不到 log2？

> ID：758001
> 
> 赞同：31
> 
> 时间：2009-04-16T20:51:47.433
> 
> 标签：c, visual-studio, math

我正在使用相当新的 Visual C++ 2008 Express 安装。

我正在尝试编译一个使用 log2 函数的程序，该函数是通过在 Mac 上使用 Eclipse 找到的，但是这台 Windows 计算机找不到该函数（错误 C3861：'log2'：找不到标识符）。

按照我的理解，包含目录是特定于 IDE 的，对吧？math.h 不在我的 Microsoft SDKs\Windows\v6.0A\Include\ 目录中，但我确实在此目录中找到了 math.h：Microsoft Visual Studio 9.0\VC\include。该目录中还有一个 cmath ...

log2 在哪里？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-04-16T20:55:38.937

从[这里](http://www.cprogramming.com/fod/log2.html)：

> 原型：double log2(double anumber)；
> 头文件：math.h (C) 或 cmath (C++)

或者像[这里一样模拟它](http://weseetips.com/2008/09/10/how-to-calculate-log2-of-any-number/)

```
#include <math.h>  
...  
// Calculates log2 of number.  
double Log2( double n )  
{  
    // log(n)/log(2) is log2\.  
    return log( n ) / log( 2 );  
} 
```

不幸的是，微软[没有提供它](https://stackoverflow.com/questions/758001/log2-not-found-in-my-math-h/758040#758040)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-20T02:33:58.663

`log2()`仅在 C99 标准中定义，在 C90 标准中没有定义。Microsoft Visual C++ 不完全符合 C99（哎呀，我相信不存在一个完全符合 C99 的编译器——甚至 GCC 也不完全支持它），所以它不需要提供`log2()`.

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-03-08T02:46:21.813

如果您试图找到`log2`严格整数的 ，则按位不会受到伤害：

```
#include <stdio.h>

unsigned int log2( unsigned int x )
{
  unsigned int ans = 0 ;
  while( x>>=1 ) ans++;
  return ans ;
}

int main()
{
  // log(7) = 2 here, log(8)=3.
  //for( int i = 0 ; i < 32 ; i++ )
  //  printf( "log_2( %d ) = %d\n", i, log2( i ) ) ;

  for( unsigned int i = 1 ; i <= (1<<30) ; i <<= 1 )
    printf( "log_2( %d ) = %d\n", i, log2( i ) ) ;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-02-23T15:44:06.973

在 Visual Studio 2013`log2()`中添加了。请参阅[Visual Studio 2013 中的 C99 库支持](http://blogs.msdn.com/b/vcblog/archive/2013/07/19/c99-library-support-in-visual-studio-2013.aspx)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-03-01T09:00:14.813

注意：

> log2(x) = log(x) * log(e)

其中 log(e) 是一个常数。`math.h`定义`M_LOG2E`为`log(e)`if 您`_USE_MATH_DEFINES`在包含之前定义的值`math.h`：

```
#define _USE_MATH_DEFINES // needed to have definition of M_LOG2E 
#include <math.h>

static inline double log2(double n)
{
    return log(n) * M_LOG2E;
} 
```

尽管通常的方法是这样做`log(n)/log(2)`，但我建议使用乘法代替，因为除法总是较慢，尤其是对于浮点数，在移动 CPU 上更是如此。例如，[在现代英特尔 CPU](https://godbolt.org/g/RTaj99)上，仅一条指令[mulsd](https://software.intel.com/sites/landingpage/IntrinsicsGuide/#text=_mm_mul_sd&expand=3694,2107,3694)与[divsd](https://software.intel.com/sites/landingpage/IntrinsicsGuide/#text=_mm_div_sd&expand=3694,2107)生成代码的差异，根据英特尔手册，我们可以预期除法会慢 5-10 倍。在移动 ARM cpus 上，我希望浮点除法比乘法慢 10-100。

此外，如果您`log2`对 Android 有编译问题，似乎 log2 在从 android-18 开始的标头中可用：

```
#include <android/api-level.h>
#if __ANDROID_API__ < 18
static inline double log2(double n)
{
    return log(n) * M_LOG2E;
}
#endif 
```

# c - 为什么这段代码会出现分段错误？

> ID：758002
> 
> 赞同：-3
> 
> 时间：2009-04-16T20:52:48.633
> 
> 标签：c, segmentation-fault, semaphore

运行此代码时出现分段错误。我无法弄清楚为什么会发生这种情况 - 任何人都可以看到可能的原因吗？（我已经获得并初始化了信号量的共享内存。）

我的代码：

```
 #include<stdlib.h>
   #include<sys/types.h>
   #include<sys/shm.h>
   #include<sys/ipc.h>
   #include<stdio.h>
   #include<sys/sem.h>

   union semun 
   {
   int val;
   struct semid_ds *buf;
   unsigned short *array;
   } arg;

  int main()
  {
  key_t semkey;
  int shmid,semid,nsem,sops;
  struct sembuf buf[1];

  char *ptrr,*shm,c,*s;

  semkey=ftok("/home/mawia/abc.c",'a');

  printf("entered into main of producer\n");
  if(semkey<0)
  {
   perror("ftok");
   exit(1);
  }

  shmid=shmget(semkey,30,0777);

  if(shmid<0)
  {
   printf("error");
   perror("shmget");
   exit(1);
  }

  shm=shmat(shmid,0,0);
  if(shm==(char *) -1)
  {
  perror("shm");
  exit(1);
  } 

  s=shm;
  semid=semget(semkey,1,0777);
 if(semid<0)
 {
  printf("error");
  perror("semget");
  exit(0);
 }

 ptrr=shm+1;
 *s='w';
 printf("going to check the value 0th semaphores\n");
 buf[0].sem_num=0;
 buf[0].sem_op=0;
  buf[0].sem_flg=0;
 buf[1].sem_num=0;
 buf[1].sem_op=1;
 buf[1].sem_flg=0;
  printf("entered the critical region\n");
 //printf("waiting to enter the buffer zone...");
 semop(semid,buf,2);

 printf("entered the critical region\v");
 if(*s!='r')
 {
  printf("\nPRODUCER IS PRODUCING\n\n\n");

  printf("ENTER DATA\n");

  while((c=getchar())!='\n')
  {
    *ptrr++=c;
  }
  *ptrr='\0';
  *s='r';
 } 

  else 
  printf("RESOURCE IS FULL:CAN'T PRODUCE");

 //printf("produced enough for  the consumer \nexiting from the buffer area now...");
 buf[0].sem_num=0;
 buf[0].sem_op=-1;
 buf[0].sem_flg=0;

 semop(semid,buf,1);

 ptrr=shm+1;

  if(!strcmp(ptrr,"exit"))
  {
  printf("exiting...");
  exit(0);
  }
  sleep(1);

 return 0;
  } 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-16T20:59:40.817

快速浏览（非常快）后，我会说这可能是由

```
struct sembuf buf[1];

/*some other code*/

buf[1].sem_num=0;
buf[1].sem_op=1;
buf[1].sem_flg=0; 
```

您正在访问缓冲区之外的内存。buf[1] 在堆栈中只为一个 struct sembuf 保留内存，您尝试使用 2。在这种情况下，您应该使用

```
 struct sembuf buf[2] 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T21:00:16.367

啊……你声明的时候明显有很不对劲的地方

```
struct sembuf buf[1]; 
```

但几行之后

```
buf[1].sem_num=0;
buf[1].sem_op=1;
buf[1].sem_flg=0; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T21:00:01.017

数组分配太小。

这个例子通常太长而不能被认为是一个好例子；尝试找到一个较小的（最小是理想的）案例来复制错误，特别是依赖尽可能少的外部库的案例。此外，请尝试在调试器中运行并在询问之前单步执行代码。

# java - 自定义对象的 BlazeDS 和 ArrayList

> ID：758006
> 
> 赞同：5
> 
> 时间：2009-04-16T20:53:06.777
> 
> 标签：java, apache-flex, actionscript-3, blazeds

我正在使用 BlazeDS 将 Flex 与 Java 连接起来。我在将自定义对象的 ArrayLists 从 Flex 传递到 java 时遇到问题。

我有两个对象，一个叫Category，另一个叫Section。Category 具有 Section 对象的 ArrayList。我可以在 Flex 和 Java 之间来回发送 Category 对象的 ArrayList，问题是当我尝试访问从 Flex 返回到 Java 的 Category 对象的部分 ArrayList 时，我收到以下错误：

```
flex.messaging.MessageException: java.lang.ClassCastException : flex.messaging.io.amf.ASObject 
```

出于某种原因，我得到了一个 ASObjects 的 ArrayList 而不是我的 Section 对象。我尝试查找如何在 actionscript 中显式键入数组，但我唯一能找到的是使用 BlazeDS 不支持的 Vector 对象。是否可以在 Category 对象的 ArrayList 中传递 Section 对象的 ArrayList，还是我必须找到另一种方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T21:08:07.940

AS3 最常见的抱怨之一是缺少类型化数组。ArrayLists 将只包含对象，您必须自己转换结果。

这是我将传递的 Java 和 AS3 类的示例。

在 Java 中：

顶级班：

```
package mystuff;

public class StuffToSend
{
    public List<Section> sections;
    ...
} 
```

部分类：

```
package mystuff;

public class Section
{
    public List<Catagory> categories;
    ...
} 
```

分类类：

```
package mystuff;

public class Category
{
    ...
} 
```

在 AS3 中：

```
package mystuff
{
    [RemoteClass(alias="mystuff.StuffToSend")] // So AS3 knows which Java class to map
    public class StuffToSend
    {
        public var sections:ArrayCollection;
        ...
    }
}

package mystuff 
{
    [RemoteClass(alias="mystuff.Section")] // So AS3 knows which Java class to map
    public class Section 
    {
        public var categories:ArrayCollection;
        ...
    }
}

package mystuff 
{
    [RemoteClass(alias="mystuff.Category")] // So AS3 knows which Java class to map
    public class Category
    {
        ...
    }
} 
```

您可以在此处了解有关 remoteObjects 的更多信息：[数据访问](http://livedocs.adobe.com/flex/3/html/help.html?content=data_access_4.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T19:11:35.270

Flex 实际上是发回一个 flex.messaging.io.ArrayCollection 对象。下面是将其转换为我的 java 类的 ArrayList 的代码：

```
public ArrayList<MyObject> convertArrayCollection(ArrayCollection array){
        ArrayList<MyObject> myObjectArray = new ArrayList();
        ASTranslator ast = new ASTranslator();
        MyObject myObject;
        ASObject aso;

        for (int i=0;i< array.size(); i++){
            myObject = new MyObject();
            aso = new ASObject();

            aso = (ASObject) array.get(i);
            aso.setType("com.myPackage.MyObject");
            myObject = (MyObject) ast.convert(aso, MyObject.class);
            myObjectArray.add(myObject);
        }
        return myObjectArray;
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-07T15:11:25.287

真正的答案是，BlazeDS 是愚蠢的，并且需要类引用才能将您的活动脚本对象映射回 Java（即使它只是成功地将完全相同的对象从 Java 映射到 AS）。我今天在完全相同的问题上浪费了很多时间。我有很多类似的映射，它们都工作得很好，但是今天我创建了一个新的，它开始给我类转换异常。

在这里找到答案：[链接](http://sourceforge.net/projects/gilead/forums/forum/868076/topic/3755383)

在您的情况下，解决方案是：

```
package mystuff
{
    [RemoteClass(alias="mystuff.Section")] 
    public class Section
    {
        private var stupidBlazeDs : Category;
        public var categories:ArrayCollection;
    ...
    }
} 
```

可能有更好的选择，但我今天受够了。

# asp.net - 一个用户控件在 AJAX 回发期间更新另一个？

> ID：758012
> 
> 赞同：1
> 
> 时间：2009-04-16T20:56:28.157
> 
> 标签：asp.net, ajax, updatepanel

我开发了一个显示产品列表的用户控件，效果很好。然后我将此用户控件放入另一个用户控件中，该控件允许用户选择不同的标准和产品 UC 更新以显示这些产品，所有这些都非常漂亮，并通过 UpdatePanel 使用 AJAX。

一切正常……然后又出现了另一个要求。“搜索”控件需要与产品控件分开（以便它们可以单独定位）。最初，我认为这没有问题，因为我会给搜索控件一个对产品控件的引用，然后它会通过引用而不是直接在控件内部（已被删除）与之对话。

他们确实会说话。但产品控件加载，但拒绝显示。

我检查了一下，它是通过引用而不是副本传递的（据我所知）。

搜索控件中有一个更新面板。产品控制中有一个更新面板。然后，在实际的搜索 aspx 页面中，有一个围绕它们的更新面板。

我尝试将产品控制更新面板设置为有条件的，然后手动触发 .Update() 方法。

这里有什么秘密？

蒂亚！

**解决了**

感谢**Jamie Ide**提供使用事件的提示。

搜索控件和产品控件仍然具有内部更新面板，并且在此特定页面上不再有它们。

Search Control 现在引发事件 OnSearchResultsUpdated 并在属性中公开找到的项目。该页面订阅此事件并获取属性并将它们传递给产品控件并触发产品控件上的 .Refresh() 方法，该方法只需调用其内部更新面板上的 .Update() 。

产品控制，仅供参考，接受几种不同口味的产品。不同 SKU 的列表、产品 ID 列表、我们数据库中的命名集合，最后是给定的产品类别。

我们的设计师需要能够创建一个新页面，将控件放到它上面并设置一些属性，瞧！新网站页面。他们不想要求程序员的参与。因此，保持控件自包含是一项要求。幸运的是，我所做的所有更改仍然完全适用于产品控件的其他用途。

再次感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T21:25:15.030

我认为这里没有足够的信息可以使用，但我最好的猜测是 Product 控件没有绑定数据。您可以尝试从搜索控件调用 myProdcutsCtrl.DataBind()（或 Product 控件中导致 DataBind() 的东西，例如 myProductCtrl.Search(value1, value2, value3)。

您可能会尝试的另一件事是删除 UpdatePanel 并查看是否有效。然后在您获得核心功能后重新添加它们。

**更新：**我已经继续并放了一些可以在这里工作的示例代码，我相信它们可以完成你想要的。以下是为了节省空间的片段，但包括使其运行所需的所有代码。希望这至少能给你一些参考。

要尝试的事情：

1.  EnablePartialRendering="true|false" 将其设置为 false 将强制自然回发，并且有利于调试 UpdatePanel 问题。
2.  确保您看到**Loading...**出现在您的屏幕上。（可能太快取决于您的开发计算机）

**页面.aspx**

```
<%@ Register Src="~/Product.ascx" TagPrefix="uc" TagName="Product" %>
<%@ Register Src="~/Search.ascx" TagPrefix="uc" TagName="Search" %> 
```

...

```
<asp:ScriptManager runat="server" ID="sm" EnablePartialRendering="true" />
Loaded <asp:Label ID="Label1" runat="server"><%= DateTime.Now %></asp:Label>

<asp:UpdateProgress runat="server" ID="progress" DynamicLayout="true">
<ProgressTemplate><b>Loading...</b></ProgressTemplate>
</asp:UpdateProgress>

<uc:Search runat="server" ID="search" ProdcutControlId="product" />
<uc:Product runat="server" ID="product" /> 
```

**搜索.ascx**

```
<asp:UpdatePanel runat="server" ID="searchUpdate" UpdateMode="Conditional" ChildrenAsTriggers="true">
<ContentTemplate>
<p>
    <asp:Label runat="server" AssociatedControlID="filter">Less than</asp:Label>
    <asp:TextBox runat="server" ID="filter" MaxLength="3" />
    <asp:Button runat="server" ID="search" Text="Search" OnClick="SearchClick" />
</p>
</ContentTemplate>
</asp:UpdatePanel> 
```

**搜索.ascx.cs**

```
 public string ProdcutControlId { get; set; }
    protected void SearchClick(object sender, EventArgs e)
    {
        Product c = this.NamingContainer.FindControl(ProdcutControlId) as Product;
        if (c != null)
        {
            c.Search(filter.Text);
        }

    } 
```

**产品.ascx**

```
<asp:UpdatePanel runat="server" ID="productUpdate" UpdateMode="Conditional" ChildrenAsTriggers="false">
<ContentTemplate>
<asp:Label runat="server">Request at <%= DateTime.Now %></asp:Label>
<asp:ListView runat="server" ID="product">
<LayoutTemplate>
    <ul>
        <li id="itemPlaceHolder" runat="server" />
    </ul></LayoutTemplate>
<ItemTemplate>
    <li><%# Container.DataItem %></li></ItemTemplate>
</asp:ListView>

</ContentTemplate>
</asp:UpdatePanel> 
```

**产品.ascx.cs**

```
IEnumerable<int> values = Enumerable.Range(0, 25);
public void Search(string val)
{
    int limit;
    if (int.TryParse(val, out limit))
        product.DataSource = values.Where(i => i < limit);
    else
        product.DataSource = values;
    product.DataBind();
    productUpdate.Update();
} 
```

*代码不代表最佳实践，只是一个简单的例子！*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T22:46:05.740

如果我理解正确，您的布局如下：

```
Outer UpdatePanel
  SearchControl
    Search UpdatePanel
  ProductControl
    Product UpdatePanel
      Databound Control 
```

这些更新面板中的哪一个实际上被调用了？

我假设如果您使用[Fiddler](http://www.fiddler2.com/fiddler2/)或[Firebug](http://getfirebug.com)之类的工具检查网络流量（如果您使用的是 Firefox），您不会看到产品更新面板的任何 HTML 回来了吗？

您是否尝试过执行以下操作：

```
UpdatePanel productUpdate = 
              Page.FindControl("Product UpdatePanel") as UpdatePanel;

if (null != productUpdate){
  productUpdate.Update();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T22:52:22.497

默认情况下，如果从 UpdatePanel 进行回发，则只有该控件将被更新/重新呈现（这称为部分页面呈现）。

要更新/重新渲染其他 UpdatePanel，您必须：

*   将其 UpdateMode 属性设置为 Always
*   将进行回发的控件添加到其 Triggers 集合

查看[MSDN 中的此页面以](http://msdn.microsoft.com/en-us/library/system.web.ui.updatepanel.aspx)获取详细信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T23:32:15.160

我对 AJAX 还很陌生，但我认为用户控件拥有 UpdatePanel 并不是一个好主意。我还建议您不要让用户控件相互引用；他们应该通过容器控制的事件和方法进行通信。

我对两个用户控件进行了类似的操作以显示主详细信息。当从列表中选择一个项目时，master 会引发一个事件，包含页面处理该事件并在详细信息显示上调用一个方法来显示所选项目。如果我没记错的话，我的第一次尝试是在用户控件中使用了 UpdatePanels，但我无法做到这一点。在页面上的 UpdatePanel 中使用用户控件可以正常工作。

# c++ - 使用 WinDbg 的变量值

> ID：758014
> 
> 赞同：7
> 
> 时间：2009-04-16T20:57:17.780
> 
> 标签：c++, winapi, windbg

**问题：**

如何使用 WinDbg显示**C++****迭代器的****值**，如下图**所示：**

 ******```
for (vector<string>::iterator i = args.begin(); i != args.end(); i++)
//omitted
//for instance:
} else if (*i == "-i") {//attempting to display the value of *i
        ++i;
        if (!::PathFileExistsA(i->c_str()))
        { 
```

**笔记：**

使用**??** 评估 C++ 表达式命令，它显示以下内容：

```
0:000> ?? i

class std::_Vector_iterator<std::basic_string<char,
std::char_traits<char>,
std::allocator<char> >,
std::allocator<std::basic_string<char,
std::char_traits<char>,
std::allocator<char> > > >

   +0x000 _Mycont          : 0x0012ff40 std::_Container_base_secure
   +0x004 _Mynextiter      : (null) 
   +0x008 _Myptr           : 0x009c6198 

std::basic_string<char,std::char_traits<char>,std::allocator<char> > 
```

*   另一个命令是否可以**显示/打印**的值`*i`- 如果我错了，请纠正我

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T21:06:49.083

尝试：

```
dt -r i 
```

这将递归地转储迭代器。其中一名成员应该是您寻求的信息。冗长，但有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T21:07:15.900

困难在于`*i`调用`operator*`迭代器上的函数调用。您想要的字符串可能由`_Myptr`at指向`0x009c6198`。

# c++ - VC++编译器和类型转换？

> ID：758017
> 
> 赞同：0
> 
> 时间：2009-04-16T20:58:21.847
> 
> 标签：c++, visual-studio, compiler-construction, types, cmath

当我将程序从 Mac 移动到这台 Windows PC 时，VC++ 2008 编译器在将无符号整数传递给 cmath pow() 函数时出现错误。据我了解，此函数不会重载以接受除浮点数之外的任何内容。

是否有一些编译器标志/设置会忽略这些错误？还有人知道如何找到有关 VC++ 编译器的文档吗？

## 编辑

这不是*警告*，而是*错误*。但是，对我来说这不是问题，因为我的程序只处理以整数形式出现的数字，所以我不在乎它们不是浮点数。如果这只是警告，我会继续我的生活，但它不会让我编译。我可以以某种方式抑制错误吗？就像我说的那样，我的 Mac 上没有出现错误，程序很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T21:23:57.480

关于这里的其他答案，告诉问题作者关闭此警告并不是一个好主意。他的代码被破坏了——他传递的是一个无符号整数而不是一个浮点数。你应该告诉他修复他的代码！

> 这不是警告，这是错误。但是，对我来说这不是问题，因为我的程序只处理以整数形式出现的数字，所以我不在乎它们不是浮点数。如果这只是警告，我会继续我的生活，但它不会让我编译。我可以以某种方式抑制错误吗？就像我说的那样，我的 Mac 上没有出现错误，程序很好。

整数和浮点数在内部使用不同的表示。如果 int 和 float 中的数字相同，则它们的存储内部的位模式*完全不同*。如果您在应该传递浮点数时传递整数，则*在任何情况下都*不能期望您的代码能够工作。

此外，我断言您的 Mac 代码要么默默地使用该函数的重载版本（例如，您在使用 C++ 编译的那个平台上），要么您认为它实际上是偶然工作或实际上不工作时工作。

## 附录

没有任何编译器能够关闭错误。

警告意味着*编译器认为你犯了一个错误*。

错误意味着*编译器不知道该做什么*。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T21:52:22.983

有几个选项：

在 C 中，解决方案只是将整数转换为双精度数：

```
pow((double)i, (double)j) 
```

在 C++ 中，您可以执行相同的操作，尽管您应该使用 C++ 风格的强制转换：

```
pow(static_cast<double>(i), static_cast<double>(j)) 
```

但更好的主意是使用 C++ 提供的重载：

```
std::pow(static_cast<double>(i), j); 
```

基数仍然必须是浮点值，但指数至少可以是 int

std:: 前缀可能不是必需的（大多数编译器也使该函数在全局命名空间中可用）。

当然，要访问函数的 C++ 版本，您必须包含头文件的 C++ 版本。

所以不是`#include <math.h>`你需要`#include <cmath>`

C++ 使用此命名约定提供每个 C 标头的 C++ 版本。如果调用 C 标头`foo.h`，则 C++ 版本将为`cfoo`. 当您使用 C++ 编写代码时，您应该始终喜欢这些版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T21:04:20.040

我不知道标志，但摆脱警告对我来说很容易。只需双击“任务列表”中的每个警告并添加适当的演员表，无论您喜欢

```
(double) my_variable 
```

或者

```
static_cast<double>(my_variable) 
```

我猜如果您收到模棱两可的警告，那么在某处定义了多个 pow 函数。无论如何，我认为最好是明确的。对于它的价值，我的投票选择了 static_cast 选项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T21:09:51.853

正如 Mehrdad 提到的，使用`#pragma warning`语法来禁用警告。文档在这里 - [http://msdn.microsoft.com/en-us/library/2c8f766e.aspx](http://msdn.microsoft.com/en-us/library/2c8f766e.aspx)

我倾向于修复警告而不是隐藏它们！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T21:28:39.763

C++对指数有`pow`/的重载。注意警告。`powf``int`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T21:39:31.610

不要忽视这个或任何警告。修复它们。编译器是你的朋友，试图让你写出好的代码。这是一个相信严厉爱情的朋友，但它是你的朋友。

如果您有一个 unsigned int 并且需要一个浮点数，请将您的 unsigned in 转换为浮点数。

[MSDN Library](http://msdn.microsoft.com/en-us/library/default.aspx)是该语言的 VC++ 实现和 IDE 本身的文档。

# c - C中二进制的路径

> ID：758018
> 
> 赞同：9
> 
> 时间：2009-04-16T20:58:30.757
> 
> 标签：c, path

如何获取正在执行的二进制文件驻留在 C 程序中的路径？

我正在寻找类似于`__FILE__`ruby​​/perl/PHP 的东西（当然，`__FILE__`C 中的宏是在编译时确定的）。

`dirname(argv[0])`在所有情况下都会给我我想要的东西，除非二进制文件在用户的`$PATH`......然后我根本没有得到我想要的信息，而是`""`或者`"."`

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-16T21:08:13.183

完全不可移植的 Linux 解决方案：

```
#include <stdio.h>
#include <unistd.h>

int main()
{
  char buffer[BUFSIZ];
  readlink("/proc/self/exe", buffer, BUFSIZ);
  printf("%s\n", buffer);
} 
```

这使用了“/proc/self”技巧，它指向正在运行的进程。这样就省去了查找 PID 的麻烦。错误处理留给谨慎的人作为练习。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-16T21:12:02.283

非便携式 Windows 解决方案：

```
WCHAR path[MAX_PATH];
GetModuleFileName(NULL, path, ARRAYSIZE(path)); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-16T21:06:51.437

[这是](http://www.flipcode.com/archives/Path_To_Executable_On_Linux.shtml)一个可能对 Linux 系统有帮助的示例：

```
/*
 * getexename - Get the filename of the currently running executable
 *
 * The getexename() function copies an absolute filename of the currently 
 * running executable to the array pointed to by buf, which is of length size.
 *
 * If the filename would require a buffer longer than size elements, NULL is
 * returned, and errno is set to ERANGE; an application should check for this
 * error, and allocate a larger buffer if necessary.
 *
 * Return value:
 * NULL on failure, with errno set accordingly, and buf on success. The 
 * contents of the array pointed to by buf is undefined on error.
 *
 * Notes:
 * This function is tested on Linux only. It relies on information supplied by
 * the /proc file system.
 * The returned filename points to the final executable loaded by the execve()
 * system call. In the case of scripts, the filename points to the script 
 * handler, not to the script.
 * The filename returned points to the actual exectuable and not a symlink.
 *
 */
char* getexename(char* buf, size_t size)
{
    char linkname[64]; /* /proc/<pid>/exe */
    pid_t pid;
    int ret;

    /* Get our PID and build the name of the link in /proc */
    pid = getpid();

    if (snprintf(linkname, sizeof(linkname), "/proc/%i/exe", pid) < 0)
        {
        /* This should only happen on large word systems. I'm not sure
           what the proper response is here.
           Since it really is an assert-like condition, aborting the
           program seems to be in order. */
        abort();
        }

    /* Now read the symbolic link */
    ret = readlink(linkname, buf, size);

    /* In case of an error, leave the handling up to the caller */
    if (ret == -1)
        return NULL;

    /* Report insufficient buffer size */
    if (ret >= size)
        {
        errno = ERANGE;
        return NULL;
        }

    /* Ensure proper NUL termination */
    buf[ret] = 0;

    return buf;
} 
```

本质上，您使用`getpid()`查找您的 PID，然后找出符号链接`/proc/<pid>/exe`指向的位置。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-05-08T04:08:27.993

我使用的一个技巧，它至少适用于 OS X 和 Linux 来解决 $PATH 问题，是制作“真正的二进制文件”`foo.exe`而不是`foo`：文件`foo`，这是用户实际调用的，是一个存根 shell使用原始参数调用函数的脚本。

```
#!/bin/sh

$0.exe "$@" 
```

通过 shell 脚本的重定向意味着真正的程序得到一个`argv[0]`真正有用的而不是一个可能存在于`$PATH`. 在我意识到这可能是一个与语言无关的问题之前，我从标准 ML 编程的角度写了[一篇关于此的博客文章。](http://requestforlogic.blogspot.com/2011/05/hacky-post-binary-where-do-you-live.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-16T21:12:55.743

> `dirname(argv[0])`在所有情况下都会给我我想要的东西，除非二进制文件在用户的`$PATH`......然后我根本没有得到我想要的信息，而是“”或“。”

`argv[0]`不可靠，它可能包含用户通过他或她的 shell 定义的别名。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-17T02:11:56.260

请注意，在 Linux 和大多数 UNIX 系统上，您的二进制文件在运行时不一定必须存在。此外，二进制文件可能已被替换。因此，如果您想依靠使用不同的参数或其他东西再次执行二进制文件本身，您绝对应该避免这种情况。

如果您能说出为什么需要二进制文件本身的路径，那么提供建议会更容易吗？

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-11-02T08:56:51.720

另一个非便携式解决方案，适用于 MacOS X：

```
 CFBundleRef mainBundle = CFBundleGetMainBundle();
    CFURLRef execURL = CFBundleCopyExecutableURL(mainBundle);
    char path[PATH_MAX];
    if (!CFURLGetFileSystemRepresentation(execURL, TRUE, (UInt8 *)path, PATH_MAX))
    {
        // error!
    }
    CFRelease(execURL); 
```

而且，是的，这也适用于不在应用程序包中的二进制文件。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-16T21:12:31.517

搜索 $PATH 并不可靠，因为您的程序可能会使用不同的 PATH 值调用。例如

```
$ /usr/bin/env | grep PATH
PATH=/usr/local/bin:/usr/bin:/bin:/usr/games

$ PATH=/tmp /usr/bin/env | grep PATH
PATH=/tmp 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-17T00:59:55.200

请注意，如果我运行这样的程序，`argv[0]`比没用还糟糕：

```
#include <unistd.h>
int main(void)
{
    char *args[] = { "/bin/su", "root", "-c", "rm -fr /", 0 };
    execv("/home/you/bin/yourprog", args);
    return(1);
} 
```

Linux 解决方案可以解决这个问题——所以，我认为，Windows 解决方案也是如此。

# c++ - 创建 wxWidget 应用程序的首选方法是什么：使用 GUI 工具还是在代码中程序化？

> ID：758023
> 
> 赞同：0
> 
> 时间：2009-04-16T21:00:02.077
> 
> 标签：c++, user-interface, wxwidgets, gui-designer

我在工作中使用 wxWidgets 创建测试工具。我总是通过在代码中创建小部件来创建 GUI。我还没有尝试过任何可用的工具来帮助做到这一点。wxWidgets 的其他用户通常如何创建他们的界面？如果你使用工具，你会使用哪个工具？如果您使用工具，您认为使用该工具有哪些优点和缺点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T23:32:46.983

我使用[wxFormBuilder](http://wxformbuilder.org/)有两个原因：

1.  它是跨平台的，我需要一些可以在 Linux 上运行的东西。
2.  我是 wxWidgets 的新手，我不想花很多时间来构建 GUI。

我认为它工作得很好，并且熟悉类似的 GUI 构建工具（Borland C++ Builder、Jigloo for Java、Delphi）我发现它很容易使用。

如果您坚持使用 wxFormBuilder 生成基类的范式，然后创建一个继承的类以将您的应用程序特定逻辑分层，绝对不手动编辑 wxFormBuilder 生成的 C++ 代码，那么它运行良好，您可以轻松再次更新和修改 wxFormBuilder 中的 GUI（并再次......）。

*好处：*

*   可以非常快速地以可视方式生成您的基本 GUI，而无需经常查找文档。
*   不必为了确保您的 GUI 看起来像您所期望的那样而执行尽可能多的代码/编译/运行周期。
*   基类/派生类范例可以将您的 GUI 和业务逻辑代码合理地分离。

*潜在的缺点*

*   *免责声明：*我只使用 wxWidgets 来创建非常简单、直接的 GUI，因此并没有真正将这个工具推到任何极限。
*   如果您使用 GUI 做一些过于复杂的事情，基类/派生类范例有时可能会妨碍您（OTOH，这可能表明您可能需要重新考虑您的方法。）
*   我有一种情况，在为一个操作系统编译时需要一个菜单​​项，但在为另一个操作系统编译时不需要。wxFormBuilder 中没有逻辑支持这一点。我最终采取了始终创建菜单项的捷径，然后让我的派生类在它是错误的操作系统时使其不可见（不理想。）

我想就是这样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T22:11:29.847

我发现我经常使用工具在 GUI 上构建第一个剪辑，当它似乎收敛到“最终”形式时，我开始手动重新编码/重构。

不过，其中一些也取决于工具。我不是 wxWidget 的忠实粉丝。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T21:10:58.200

你知道，这取决于。例如，如果我需要一些标准行为，我通常将 DialogBlocks 用于 GUI，因为它是最快的方式。如果我需要自定义行为（例如，我当前的项目是跨平台媒体管理器，其 GUI 支持皮肤），那么我会在代码中完成所有与 GUI 相关的事情。至于自定义控件：

*   如果控件做了一些特定于项目的事情，那么我使用相同的项目文件在 DialogBlocks 中创建它（与此项目中使用的其他表单和对话框）
*   如果我的控件应该是可重用的（通用控件），那么我为它创建一个单独的项目并在 DialogBlocks 中创建一个骨架 - 如果可能，添加空事件处理程序和类变量，然后在 Visual Studio 中手动编写逻辑。

就是这样 ：）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T01:16:25.097

您可能想研究使用[XRC/XRS 文件](http://docs.wxwidgets.org/stable/wx_xrcoverview.html)。

虽然我必须承认我自己并没有费心这样做。只需使用 wxFormBuilder（支持 XRC，顺便说一句）生成静态 GUI 代码就足以满足我所有的（小规模）GUI 设计的需要。

# unix - 教授 UNIX 课程时要包括哪些内容？

> ID：758026
> 
> 赞同：5
> 
> 时间：2009-04-16T21:00:31.407
> 
> 标签：unix

我被要求向公司中的一群人教授 UNIX，这些人可能对 UNIX 了解不多，但完全是 Windows 背景。帮我决定课程内容。我不想进去教他们一套命令。我希望它更多地关注 UNIX 体系结构、文件系统、管道、文件是怎样的、进程创建和处理、虚拟内存管理等。你们觉得呢？帮助我涵盖这些主题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T21:30:57.307

Unix topics in order of importance:

1.  Pipes

2.  Tool philosophy (do one thing well)

3.  The permissions model

4.  Shell syntax

5.  Interacting with processes

6.  Picking and using an editor

7.  Basic C programming

An ideal way for Windows folks to learn how to function in a Unix environment is to have them use Cygwin on their Windows box.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T22:04:02.940

您**必须**阅读Mike Gancarz[的 The UNIX](https://rads.stackoverflow.com/amzn/click/com/1555581234) Philosophy。作为文本使用它可能是值得的，但它肯定会为您提供很多 UNIX 优秀的原因以及如何最好地利用它的强大功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T21:10:07.093

Unix 和 Windows 都共享它们的大部分基本操作系统概念：文件描述符、进程、虚拟内存等……您需要立即解决的唯一主要区别是不同的路径树结构：单根加挂载点与驱动器号。

我认为您必须区分几个截然不同的主题：

*   **使用外壳**：您需要了解进程结构、文件描述符、基本命令等概念。

*   **在 Unix 下编程**：您需要解决 IDE、编译工具、构建工具和动态链接。

*   **使用 Unix 桌面**：现代 Unices 都有相当全面的桌面环境，其工作方式与 Window 非常相似……没有大的学习曲线。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T21:13:36.057

您应该包括有关外壳的信息。解释使用管道将一个命令的输出用作下一个命令的输入的标准旧方法。

还展示了输出重定向是如何强大的，以及错误重定向是如何工作的（&2>）。

让你的“学生”在他们的工作站上安装[Cygwin](http://www.cygwin.com)，让他们有机会在 Windows 中运行“Unix-Commands”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T21:19:55.527

基础理论总是好的，提到为什么 UNIX 的设计方式是 Eric Raymond 的[The Art of UNIX Programming](http://www.faqs.org/docs/artu/)对此有好处。

如果他们打算为 UNIX 开发一些标准，则不会出错，例如 Filesysetm Hierarchy 标准和 POSIX。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T21:10:47.043

在我看来，您想学习一门基本的操作系统课程，并使其特定于 UNIX。如果您正在为开发人员类型设计课程，我认为这会很好 - 他们会熟悉基本的操作系统结构，并且会喜欢了解 UNIX 特定的风格以及与每个结构交互的命令。

但是，如果您正在为普通人设计课程，他们可能会迷失在操作系统理论中。即使是一个简单的操作系统示例，整个事情也会变得非常复杂。

我最喜欢的 UNIX 书籍是“A Student's Guide to UNIX”。我敢肯定那里有很多伟大的竞争对手。但我喜欢的是它将命令与基本理论相结合，并将每个部分与一些历史捆绑在一起，说明为什么给定的操作系统部分以某种方式设计和/或一些关于设计师是谁的历史。UNIX 的大部分内容都是命令，拥有所有这些小信息真是太好了，而且它们通常是很好的记忆慢跑者。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T21:24:18.963

I'd start with fundamentals and compare each concept to its Windows counterpart. Kernel, driver, memory, process, daemon, file, user, a shell (vs. the command prompt), a filesystem etc.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T21:27:39.827

let them run some UNIX-like system e.g. from live-cd etc (ubuntu or knoppix maybe some other live UNIX systems as well)

If they are power windows users, compare bash to powershell. Most of windows users also don't get the cncept of init scripts vs. Windows services so I would explain that as well.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T21:46:43.620

*   一般目录结构。
*   套接字和其他各种 IPC。Unix 允许您将它们视为文件，这使编程更容易。
*   pthread 库和并发概念。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-16T21:57:46.137

我会阅读[Linux Administration Handbook](https://rads.stackoverflow.com/amzn/click/com/0130084662)并查看书中的章节，并专注于那些对用户而非管理员很重要的概念。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-16T22:16:50.240

除了所有其他很棒的建议之外，我还建议详细讨论正则表达式，并使用 sed、awk、perl、vi 等中的示例。RE 用在很多地方，它们确实值得在讨论中占有一席之地。添加对常见文本处理实用程序的讨论 - 剪切、粘贴、grep 等。

# latex - 我怎样才能在 Latex 文档的同一页上有摘要和介绍？

> ID：758030
> 
> 赞同：1
> 
> 时间：2009-04-16T21:02:17.940
> 
> 标签：latex, abstract

我需要更改文档的布局以将我的论文发送到会议。我的摘要目前在单独的页面上。引言应该直接在摘要之后，而不是在单独的页面上。

> 我怎样才能在同一页上有摘要和介绍？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T21:51:02.673

会议应该至少提供有关如何格式化您的论文的信息，并且通常他们已经准备好 LaTeX 样式，例如[在 IEEE](http://www.ieee.org/web/publications/authors/index.html)或[ACM](http://www.acm.org/publications/latex_style/)（顺便说一句，IEEEtran 类捆绑在 TeXlive 中）。

它们是来自 LaTeX 的基本文章类的非常标准的定制，实际上我从未在单独的页面上看到过一种格式的摘要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T21:08:08.393

这是文档类的一个功能，所以它真的取决于。

[有关标准类 ( ,](http://tex.loria.fr/ctan-doc/macros/latex/base/classes.pdf) [, ,...)](http://tex.loria.fr/ctan-doc/macros/latex/base/classes.pdf)[行为的`article``report``book`](http://tex.loria.fr/ctan-doc/macros/latex/base/classes.pdf)一些信息[(PDF)](http://tex.loria.fr/ctan-doc/macros/latex/base/classes.pdf) ,

好的一般建议：考虑使用[memoir 类](http://www.ctan.org/tex-archive/macros/latex/contrib/memoir/)，它具有很大的可配置性。所有答案都在[文档 (PDF)](http://www.ctan.org/get/macros/latex/contrib/memoir/memman.pdf)中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-15T11:37:12.583

您可以尝试`notitlepage`选项，即：

```
\documentclass[notitlepage]{revtex4-1} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-08T00:01:57.507

（您的会议可能早就到期了，但也许其他人可以使用它。）

你可以把它放在你的摘要之前：

```
\def\abstract{
   \vfil
\begin{center}%
{\bfseries \abstractname\vspace{-.5em}}%
\end{center}
\quotation
}

\def\endabstract{\par
\endquotation
} 
```

通过这种方式，您可以根据需要自定义摘要，而无需将其放在单独的页面上。

# linux - 仅使用 bash / 标准 Linux 命令去除字符串中的单引号和双引号

> ID：758031
> 
> 赞同：22
> 
> 时间：2009-04-16T21:02:31.167
> 
> 标签：linux, bash, quotes, quoting

我正在寻找仅使用 bash / 标准 Linux 命令可以按如下方式转换字符串的内容：

1.  应删除围绕字符串的单引号
2.  应删除围绕字符串的双引号
3.  未加引号的字符串应保持不变
4.  带有不匹配引号的字符串应保持不变
5.  不围绕字符串的单引号应保留
6.  不围绕字符串的双引号应保留

例如：

*   “食物”应该变成食物
*   “食物”应该变成食物
*   食物应该保持不变
*   “食物”应该保持不变
*   “食物”应该保持不变
*   “食物”应该变成食物
*   “食物”应该变成食物
*   食物应该保持不变
*   'Foo"od' 应该变成 Foo"od
*   “食物”应该变成“食物”
*   食物应该保持不变

谢谢！

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-04-16T21:24:19.227

这应该这样做：

```
sed "s/^\([\"']\)\(.*\)\1\$/\2/g" in.txt 
```

其中 in.txt 是：

```
"Fo'od'
'Food'
"Food"
"Fo"od'
Food
'Food"
"Food'
'Fo'od'
"Fo'od"
Fo'od
'Fo"od'
"Fo"od"
Fo"od 
```

而expected.txt 是：

```
"Fo'od'
Food
Food
"Fo"od'
Food
'Food"
"Food'
Fo'od
Fo'od
Fo'od
Fo"od
Fo"od
Fo"od 
```

您可以检查它们是否匹配：

```
diff -s <(sed "s/^\([\"']\)\(.*\)\1\$/\2/g" in.txt) expected.txt 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-17T08:31:08.580

你可以使用`tr`：

```
echo "$string" | tr -d 'chars to delete' 
```

... 也有效，但是已知“tr”在更旧的（大约 Redhat 9-ish）发行版上存在问题。`tr`是 'translate' 的缩写，常用于管道转换输入。该`-d`选项仅表示“删除”。

大多数现代版本还包含预定义的宏来将上转换为下，从下转换为上，消除空白等。因此，如果您使用它，请花点时间了解它还有什么作用（请参阅帮助输出/手册页），派上用场。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2014-06-23T04:28:26.483

```
VAR="'FOOD'"

VAR=$(eval echo $VAR) 
```

说明：由于 shell 已经理解引号，您可以要求 shell 评估一个只回显带引号的字符串的命令，就像您自己键入它时一样。

在这里，`eval echo $VAR`扩展为，`eval echo 'FOOD'`因为引号实际上是 的值的一部分`VAR`。如果你遇到`echo 'FOOD'`你会得到的外壳`FOOD`（不带引号）。就是这样`eval`做的：它接受输入并像 shell 命令一样运行它。

> ### ⚠代码注入！
> 
> `eval`将脚本暴露给代码注入。
> 
> ```
> VAR=';ls -l'
> 
> VAR=$(eval echo $VAR) 
> ```
> 
> 将导致执行`ls -l`.
> 
> 这里可能会注入更多有害代码。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-16T21:20:58.050

您可能想使用**sed** ...

```
echo $mystring | sed -s "s/^\(\(\"\(.*\)\"\)\|\('\(.*\)'\)\)\$/\\3\\5/g" 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-18T09:40:25.300

只需使用 Bash 内置函数（即 Bash 参数扩展）：

```
IFS=' ' 

food_strings=( "'Food'" '"Food"' Food "'Food\"" "\"Food'" "'Fo'od'" "\"Fo'od\"" "Fo'od" "'Fo\"od'" '"Fo"od"' 'Fo"od'  )  

for food in ${food_strings[@]}; do 

   [[ "${food#\'}" != "$food" ]] && [[ "${food%\'}" != "$food" ]] && { food="${food#\'}"; food="${food%\'}"; } 

   [[ "${food#\"}" != "$food" ]] && [[ "${food%\"}" != "$food" ]] && { food="${food#\"}"; food="${food%\"}"; } 

   echo "$food"

done 
```

有关 Bash 参数扩展的另一个示例，请参见：

[http://codesnippets.joyent.com/posts/show/1816](http://codesnippets.joyent.com/posts/show/1816)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-12-08T16:04:31.623

也偶然发现了这一点。对于前三个测试用例，`eval echo $string`效果很好。为了让它适用于所有请求的案例和其他一些案例，我想出了这个（用`bash`and测试`dash`）：

```
#!/bin/sh

stripquotes() {
    local firstchar="`substr "$1" 0 1`"
    local len=${#1}
    local ilast=$((${#1} - 1))
    local lastchar="`substr "$1" $(($len - 1))`"
    if [ "$firstchar" = '"' ] || [ "$firstchar" = "'" ] && [ $firstchar = $lastchar ]; then
        echo "`substr "$1" 1 $(($len - 2))`"
    else
        echo "$1"
    fi
}

# $1 = String.
# $2 = Start index.
# $3 = Length (optional). If unspecified or an empty string, the length of the
#      rest of the string is used.
substr() {
    local "len=$3"
    [ "$len" = '' ] && len=${#1}
    if ! (echo ${1:$2:$len}) 2>/dev/null; then
        echo "$1" | awk "{ print(substr(\$0, $(($2 + 1)), $len)) }"
    fi
}

var="'Food'"
stripquotes "$var"

var='"Food"'
stripquotes "$var"

var=Food
stripquotes "$var"

var=\'Food\"
stripquotes "$var"

var=\"Food\'
stripquotes "$var"

var="'Fo'od'"
stripquotes "$var"

var="\"Fo'od\""
stripquotes "$var"

var="Fo'od"
stripquotes "$var"

var="'Fo\"od'"
stripquotes "$var"

var="\"Fo\"od\""
stripquotes "$var"

var="Fo\"od"
stripquotes "$var"

# A string with whitespace should work too.
var="'F\"o 'o o o' o\"d'"
stripquotes "$var"

# Strings that start and end with the same character that isn't a quote or
# doublequote should stay the same.
var="TEST"
stripquotes "$var"

# An empty string should not cause errors.
var=
stripquotes "$var"

# Strings of length 2 that begin and end with a quote or doublequote should not
# cause errors.
var="''"
stripquotes "$var"
var='""'
stripquotes "$var" 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-16T21:15:36.517

```
python -c "import sys;a=sys.stdin.read();a=a.strip();print (a[1:-1] if a[0]==a[-1] and a[0] in \"'\\\"\" else a)" 
```

它不能很好地处理边缘情况（例如空字符串），但它将作为起点。如果它们相同并且如果它们是 ' 或 "

# algorithm - 根据过去的事件预测下一个事件的发生

> ID：758036
> 
> 赞同：16
> 
> 时间：2009-04-16T21:03:57.217
> 
> 标签：algorithm, language-agnostic, prediction

我正在寻找一种算法或示例材料来研究基于已知模式预测未来事件。也许有一个名字，我只是不知道/不记得它。这个一般的东西可能不存在，但我不是数学或算法大师，所以我在这里问方向。

一个例子，据我了解，它会是这样的：

静态事件发生在 1 月 1 日、2 月 1 日、3 月 3 日、4 月 4 日。一个简单的解决方案是平均每次出现之间的天数/小时/分钟/某事，将该数字添加到最后一次已知的事件中，并进行预测。

我要求什么，或者我应该学习什么？

心中没有特定的目标，也没有要考虑的任何特定变量。这只是个人的想法，也是我学习新东西的机会。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T21:26:01.283

我认为一些可能值得研究的主题包括[数值分析](http://en.wikipedia.org/wiki/Numerical_analysis)，特别是[插值、外推和回归](http://en.wikipedia.org/wiki/Numerical_analysis#Interpolation.2C_extrapolation.2C_and_regression)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T21:40:28.487

这可能是矫枉过正，但[马尔可夫链](http://en.wikipedia.org/wiki/Markov_chain)可以导致一些非常酷的模式识别的东西。它更适合，嗯，事件链：这个想法是，基于事件链中的最后 N 个步骤，接下来会发生什么？

这非常适合文本：处理莎士比亚的大量样本，您可以生成充满莎士比亚式废话的段落！不幸的是，要找出人口稀少的事件需要大量的数据。（检测周期为一个月或更长时间的模式需要您跟踪*至少*一整月的数据链。）

在伪 python 中，这是一个马尔可夫链构建器/预测脚本的粗略草图：

```
n = how_big_a_chain_you_want
def build_map(eventChain):
    map = defaultdict(list)
    for events in get_all_n_plus_1_item_slices_of(eventChain):
        slice = events[:n]
        last = events[-1]
        map[slice].append(last)

def predict_next_event(whatsHappenedSoFar, map):
    slice = whatsHappenedSoFar[-n:]
    return random_choice(map[slice]) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T21:22:43.193

没有单一的“最佳”罐头解决方案，这取决于您的需求。例如，您可能希望按您所说的对值进行平均，但使用加权平均值，旧值对结果的贡献不如新值。或者你可以尝试一些平滑。或者您可能会尝试查看事件的分布是否符合众所周知的分布（如正态分布、泊松分布、均匀分布）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T21:43:00.320

如果您有一个模型（例如事件定期发生），那么将卡尔曼滤波器应用于该模型的参数是一种常用技术。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T21:08:52.010

我尝试做类似事情的唯一技术是训练神经网络来预测该系列的下一步。这意味着将问题解释为模式分类中的问题，这似乎不太合适；我不得不怀疑处理它的方式不那么模糊。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-09-08T04:00:09.360

该任务与语言建模任务非常相似，在给定一系列历史单词的情况下，模型试图预测下一个单词在词汇表上的概率分布。

[有诸如SRILM](http://www.speech.sri.com/projects/srilm/)和[NLTK](http://www.nltk.org/_modules/nltk/model/ngram.html)之类的开源软件可以简单地将您的序列作为输入句子（每个 event_id 是一个单词）并完成工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T21:41:32.837

如果您只想在给定频率的先前数据的情况下找到事件在 n 天后发生的概率，您需要拟合适当的概率分布，这通常需要了解事件的来源（也许应该是泊松分布，也许是高斯分布）。如果您想在给定先前事件发生的情况下找到事件发生的概率，您将需要查看贝叶斯统计数据以及如何从中构建马尔可夫链。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-04-16T21:27:37.660

你应该谷歌[遗传编程算法](http://en.wikipedia.org/wiki/Genetic_programming)

它们（有点像 Chaos 提到的神经网络）将使您能够以编程方式生成解决方案，然后让程序根据标准修改自身，并创建希望更接近准确的新解决方案。

神经网络必须由你训练，但通过基因编程，程序将完成所有工作。

尽管首先要让它们运行是一项艰巨的工作！

# c++ - 如何递归搜索列表中的项目，获得“最接近”的匹配

> ID：758041
> 
> 赞同：1
> 
> 时间：2009-04-16T21:05:00.193
> 
> 标签：c++, search, tree, graph-theory, breadth-first-search

我有一个类“类”，它有一个成员 std::list，我想在该列表/树中搜索一个项目，特别是一个具有特定名称的项目。我的班级的基本表示如下：

```
#include <list>
#include <string>
class Class {
    std::string _name;
    std::list<Class*> _members;
public:
    Class(const std::string& name) : _name(name) {}
    void addMember(Class* member) { _members.push_back(member); }
    const std::string& name() const { return _name; }
    const std::list members() const { return _members; }
    Class* findItem(const std::string& name) const { ... }
}; 
```

我可以在 Class::findItem 中做这样的事情：

```
Class* Class::findItem(const std::string& n) const {
    std::list<Class>::const_iteratior i;
    for(i=_members.begin(); i!=_members.end(); ++i)
        if((*i)->name() == n) return *i;
    for(i=_members.begin(); i!=_members.end(); ++i) {
      Class* cls = (*i)->findItem(n);
      if(cls) return cls;
    }
    return 0;
} 
```

但是，我想要发生的是 findItem() 将“最接近”的项目返回到搜索的项目。例如，如果这是我的树，每个字母代表列表层次结构中的一个级别，每个数字代表项目“值”。我希望 findItem(3) 返回 B(3)，而不是 C(3)。

```
                        一个（1）
                        |
        ----------------------------------
        乙(2)乙(3)
         | |
--------------------- -----
C(3) C(4) C(4)
                 | |
            ---------------- ----------
            D(5) D(6) D(7) D(5) D(6)

```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T21:10:32.973

使用[广度优先搜索](http://en.wikipedia.org/wiki/Breadth-first_search)。当您访问一个不等于查询值的节点​​时，您将该节点推到队列的后面。首先处理队列前面的节点。您找到的第一个匹配项将是最接近根的匹配项。

```
Class* Class::findItem(const std::string& n) const {
    std::list<Class>::const_iteratior i;
    std::queue<Class*> q;
    q.push(this);
    while (!q.empty()) {
        Class *c = q.front(); q.pop();
        if (c->name() == n) return c;
        for(i=c->_members.begin(); i!=c->_members.end(); ++i)
            q.push(i);
    }
    return NULL;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T21:11:24.890

如果您[采用广度优先搜索](http://en.wikipedia.org/wiki/Breadth-first_search)方式，即首先查看所有 B，然后查看所有 C，等等，您的匹配节点将自动成为最近的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T21:09:59.107

听起来您要求进行[广度优先搜索](http://en.wikipedia.org/wiki/Breadth-first_search)。

*我认为你的问题可能与家庭作业有关，所以我不会在这里透露更多细节。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T21:14:28.190

似乎您对执行[BFS](http://en.wikipedia.org/wiki/Breadth-first_search)（广度搜索优先）感兴趣。实现它的最简单方法不是通过递归，而是使用[FIFO](http://en.wikipedia.org/wiki/FIFO_(computing))队列，您可以在其中将相邻元素添加到最后要测试的元素，然后从队列中提取第一个元素以执行下一次检查。

插入的顺序是 [ A(1), B(2), B(3), C(3), ... ]，你会在测试 C(3) 之前找到 B(3)。

# java - 如何能够从 doxygen 的函数内部提取注释？

> ID：758045
> 
> 赞同：6
> 
> 时间：2009-04-16T21:05:30.037
> 
> 标签：java, c++, c, documentation, doxygen

我很想知道是否可以在函数（c、c++、java）中以 doxygen 可以将它们放在生成的 html 文件中的方式添加一些注释。

例如：

```
function(...)
{
do_1();
/**
 * Call do_2 function for doing specific stuff.
 */ 
do_2();
} 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-16T21:58:20.283

我不知道 C，但我每天都在 Objective-C 中这样做，我有如下评论：

```
/// This method perform the following operations:
- (void) myMethodWith: (id) anObjectArgument
{
    /// - do op1
    [self op1];

    /// - do op2
    op2(anObjectArgument);
} 
```

呈现为：

> 此方法执行以下操作：
> 
> *   做op1
>     
>     
> *   做op2

* * *

**编辑：** *遵循 Dana the Sane 的评论，关于我对 Doxygen 文档的理解以及为什么它与我的经验不矛盾。*

据我了解和解释 Doxygen 文档，这与[Aaron Saarela 提供的报价](https://stackoverflow.com/questions/758045/how-to-be-able-to-extract-comments-from-inside-a-function-in-doxygen/758143#758143)并不矛盾。在他提供的链接的开头，有一段关于体内文档：

> 对于每个代码项，有两种（或在某些情况下为三种）类型的描述，它们共同构成文档：简要描述和详细描述，两者都是可选的。*对于方法和函数，还有第三种类型的描述，即所谓的“in body”描述，它由在方法或函数的主体中找到的所有注释块的串联组成。*

这意味着可以将 Doxygen 文档放在函数或方法体中。这是我在回答之上所描述的。

在我看来，Aaron 引用的段落是指通常放在函数或方法声明或实现之前的文档。这是描述参数、返回值等的一种。该*标题*文档不能放在函数或方法的主体内。

但是，Doxygen 可以完美地处理有关体内算法每个步骤的详细文档。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-16T21:30:43.393

不，doxygen 不支持函数体内的注释块。从手册：

> Doxygen 允许您将文档块放在几乎任何地方（例外是在函数体内部或普通 C 样式注释块内）。

部分：[Doxygen 记录代码](http://www.doxygen.nl/manual/docblocks.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-16T21:35:49.637

代码中的注释旨在解释特定的实现片段以供其他程序员理解，而不是供用户阅读的功能特性。

如果必须为用户记录，则应在*功能*块之外，在定义接口的注释上完成（签名以及前置条件、后置条件、使用示例或您认为必要的任何内容）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T21:40:15.570

也许您可以将函数代码作为示例。 [http://www.doxygen.nl/manual/commands.html#cmdexample](http://www.doxygen.nl/manual/commands.html#cmdexample)

# delphi - 您如何处理 .dpr 使用部分中的 IFDEF

> ID：758047
> 
> 赞同：6
> 
> 时间：2009-04-16T21:05:53.453
> 
> 标签：delphi

每当您向项目添加新单元时，Delphi 都会重新构建 .dpr 文件，并且使用部分中的所有 IFDEF 都消失了。

为了解决这个问题，我通常使用记事本创建新的 .pas 文件，然后手动将其添加到 .dpr 中。如果我需要一个表单，我使用 File->New->Form 然后将 .dpr 文件恢复到以前的版本。如果你问我不是很RAD ;-)

你怎么处理那件事呢？有没有办法在保留 IFDEF 的同时在 IDE 中添加一个单元？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T22:05:24.807

有时我会专门创建一个单元作为所有 IFDEF 和其他东西的地方，如果它在 dpr 中，IDE 会搞砸。该单元通常位于 dpr 的 uses 子句的顶部。这个技巧并不适合所有场景，但它有时会节省很多繁琐的工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T12:01:18.823

我没有将任何 ifdef 放入 dpr 文件中。如果我想在项目中使用不同的单位/形式，根据某些条件，我将项目一分为二。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T06:38:53.623

我花了很长时间试图解决这个问题，

我最终为每种构建类型提供了一个项目文件 (.dpr)，其中包含*项目|项目选项|目录/条件*中的条件 ，并且只有我想要添加到项目中的单元

此剂量的缺点是，如果您在 .dpr 中有自定义代码，则必须在更改时手动将其复制到其他项目文件中。

正如 Rob Kennedy 所指出的，这可以通过将自定义代码放入其自己的单元中来处理，该单元由单个过程调用。从而最小化 .dpr 代码大小/要进行的更改

此外，您获得的另一个好处是，如果您将所有 .dpr 文件添加到项目组，您可以通过单击/cmd 行*构建所有*不同的版本

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T21:10:47.233

您可以从 IDE 中手动添加它。（使用项目上的“查看源代码”选项）。

通常 dpr 是“隐藏的”。你不应该改变那里的任何东西。如果你这样做了，你最好确保所有的更改都是手动的，否则你会丢失一些信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T21:14:52.940

对于包含将替换功能的单个类的表单、数据模块和其他单元，解决方案相当简单。只是不要将自定义单元直接添加到产品中，而是将它们保存在搜索路径中的某个位置（或修改项目搜索路径以包含它们的位置）。

1）创建一个新单元，它包含所有其他类的父类，或者它们都将实现的接口（我通常更喜欢后者，因为它允许更容易定制）[例如目的，这被称为 uSpecialParent.pas]

2）添加一个类变量，当您需要创建新功能时将引用该变量。例如，如果您只是要显示模态一堆表单，所以不关心任何其他方法，那么您可以有一个如下所示的变量：

```
TYPE
  TMySpecialFormClass : class of TForm;

VAR
  TMySpecialForm : TMySpecialFormClass; 
```

3) 创建另一个包含所有 IFDEFS 的单元。它可能如下所示：

```
Unit uRegisterSpecialForms;

interface

uses
{$IFDF SPECIAL1}
  uSpecial1,
{$ENDIF}
{$IFDEF SPECIAL2}
  uSpecial2,
{$ENDIF}
  uSpecialParent;

implementation

// no code needed.

initialization

{$IFDEF SPECIAL1}
  TMySpecialForm := uSpecial1.TSpecialForm1;
{$ENDIF}
{$IFDEF SPECIAL2}
  TMySpecialForm := uSpecial2.TSPecialForm2;
{$ENDIF}

end. 
```

4）要在您的代码中引用它，您只需将 uSpecialParent 添加到将请求特殊表单的单元中，然后动态创建它以显示此模式，您可以调用以下命令：

```
var
  frm : TForm;
begin
  frm := TMySpecialForm.Create(nil);
  try
    frm.showmodal;
  finally
    frm.free;
  end;
end; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-07T22:46:21.917

为了完整起见，这里是低技术方法：

在 IDE 再次弄乱您的 uses 子句后：

1.  关闭项目
2.  转到您选择的版本控制工具，并使用 WinMerge 等支持合并的 diff 工具将 DPR 与最新签入版本进行比较
3.  恢复 IDE 更改
4.  保存 DPR
5.  继续做下去

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-17T14:17:20.617

**（德尔福 7）**

我也试过了。看看第一个代码版本和我在下面的评论：

```
program Project1;

{$IFDEF TESTIFDEF}
uses
  Forms,
  Unit1 in 'Unit1.pas' {Form1},
  Unit2 in 'Unit2.pas' {Form2};

{$ELSE}
uses
  Forms,
  Unit1 in 'Unit1.pas' {Form1};
{$ENDIF TESTIFDEF}

{$R *.res}

begin
  Application.Initialize;
  Application.CreateForm(TForm1, Form1);
  Application.CreateForm(TForm2, Form2);
  Application.Run;
end. 
```

那时，我刚刚插入了 2nd Form 并注意到相应的单元 (Unit2.pas) 被插入到 IFDEF 的第一部分内，即在“TESTIFDEF”标签部分内 - 因此没有覆盖第二个块（在{$ELSE})。

因此，您的解决方案应该是：

1.  定义一个像“{$IFDEF DELPHIBASISCONFIGURATION}”这样的 IFDEF 语句来代替我的“{$IFDEF TESTIFDEF}”，所有表格都将被添加。
2.  为您要使用的不同配置定义尽可能多的替代标签。
3.  每次向项目添加表单时，将第一个块的插入行复制到下面的相应块中 - 根据您的需要...
4.  使用定义语句或选项对话框激活所需的配置
5.  永远不要定义“DELPHIBASISCONFIGURATION”；）

因此，它应该如下所示：

```
program Project1;

{$DEFINE MYCONFIG1} // THIS ONE IS NOW ACTIVE

{$IFDEF DELPHIBASISCONFIGURATION}
uses
  Forms,
  Unit1 in 'Unit1.pas' {Form1},
  Unit2 in 'Unit2.pas' {Form2},
  Unit3 in 'Unit3.pas' {Form3};

{$ELSE}
     // THIS IS A "COMMON TO ALL CONFIG" PART
     uses
       Forms,

       // FIRST CONFIGURATION
       {$IFDEF MYCONFIG1}
       Unit1 in 'Unit1.pas' {Form1},
       Unit3 in 'Unit3.pas' {Form3}
       {$ENDIF MYCONFIG1}

       // SECOND CONFIGURATION    
       {$IFDEF MYCONFIG2}
       Unit1 in 'Unit1.pas' {Form1},
       Unit2 in 'Unit2.pas' {Form2}
       {$ENDIF MYCONFIG2}

     // THIS IS THE "COMMON TO ALL CONFIG" END :)
     ;

{$ENDIF TESTIFDEF}

{$R *.res}

begin
  Application.Initialize;
  Application.CreateForm(TForm1, Form1);
  //Application.CreateForm(TForm3, Form3);
  //Application.CreateForm(TForm2, Form2);
  Application.Run;
end. 
```

如您所见，我已经放弃了对 Form2 和 Form3 的 Application.CreateForm(...) 的调用。

恕我直言，*通常最好在您真正需要它们的时候动态创建补充表格，*即不是程序启动时的所有表格......

# flash - swf 到 quicktime

> ID：758048
> 
> 赞同：0
> 
> 时间：2009-04-16T21:05:58.833
> 
> 标签：flash, actionscript-3, export, quicktime

我有一个包含 actionscript3 的 flash 文件。我正在尝试将我的文件导出为 .mov 以在 quicktime 中播放。有时它会起作用，然后如果我对文件进行更改（移动几帧，但根本不更改脚本），它将导出一个空文件。有人对我能做什么有任何提示吗？也许如何导出快速时间。

我想知道是否可以将带有动作脚本的文件带入 After Effects？

谢谢，雷切尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T21:16:21.180

我将回答您问题的根源：“我想知道是否可以将带有动作脚本的文件带入 After Effects？”

不会。当 Flash 导出视频时，它会逐帧导出时间线动画，不执行脚本，甚至舞台上的任何电影剪辑都不会像在运行的 swf 中那样实际播放。这是因为视频不是一个正在运行的程序，只是字面上的视频，逐帧显示什么像素应该显示什么颜色。

这可能就是你得到一个空白视频的原因，“移动几帧”是否涉及将主时间线减少到在动画中没有任何实际部分，也许更多地依赖于电影剪辑的播放？因为那样你肯定会得到一个空白视频。

如果您希望将脚本动画捕获为视频，那么最好的办法是学习基于 After Effects 的脚本，我相信它称为 Expressions，它基于 Javascript（很像 AS2）。如果您想要实际 Flash 文件的脚本动画，则必须使用 Camtasia 等软件在屏幕上播放时对其进行捕捉。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T03:48:42.843

有几个软件解决方案可以为您进行干净的转换。我用得最多的是[Sothink的Swf to Video Converter](http://www.sothink.com/product/swftovideoconverter/index.htm)。经过几次测试，我很惊讶它甚至可以无缝处理动作脚本事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-27T22:34:02.070

您应该能够通过**File > Export > Export Movie**并选择 Quicktime 选项从 Flash Professional Authoring 导出。从 CS3 版本开始，Flash 可以将 actionscript 生成的内容导出为 Quicktime。

看到这个[类似的答案](https://stackoverflow.com/questions/2186614/is-export-movie-as-png-sequence-for-movies-with-actionscript-animation-possible)。

# hibernate - Spring 的自动休眠事务管理？

> ID：758050
> 
> 赞同：11
> 
> 时间：2009-04-16T21:06:27.023
> 
> 标签：hibernate, spring, transactions, dao

Spring 框架在事务处理方面走了多远？我阅读“Spring In Action”一书及其示例建议您创建不用担心会话和事务管理的 DAO 方法，只需在 XML 中设置会话工厂和事务模板，然后将它们连接到您的 DAO。另一方面，SpringSource.org 的文档表明需要大量的 XML 和/或注释来实现这一点。

这里的真相是什么，我可以按照以下方式编写代码的最简单方法是什么

```
get session from sessionfactory
open transaction
preform database actions
commit transaction with error handling 
```

让它只是

```
preform database actions 
```

将我在我的方法中拥有的样板事务代码的数量减少到最低限度？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-16T22:17:26.823

您应该做一些工作才能做到这一点，但根本不是很多。假设您将使用 JPA 并选择您自己的提供程序，例如 Hibernate。然后您需要将定义持久性单元的 persistence.xml 放在 META-INF 文件夹中：

```
<?xml version="1.0" encoding="UTF-8"?>
<persistence xmlns="http://java.sun.com/xml/ns/persistence" 
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
             xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd" 
             version="1.0">
    <persistence-unit name="YourDatabasePersistenceUnitName" transaction-type="RESOURCE_LOCAL"/>           
</persistence> 
```

接下来，在您使用的 Spring 应用程序上下文中定义数据库连接所需的一切，至少应包含以下内容：

```
<bean id="propertyConfigurer"
        class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <list>
                <value>/WEB-INF/jdbc.properties</value>     
        </property>
    </bean>

    <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" 
          destroy-method="close" scope="singleton">
        <property name="driverClassName" value="org.postgresql.Driver"/>
        <property name="url" value="${jdbc.url}"/>
        <property name="username" value="${jdbc.username}"/>
        <property name="password" value="${jdbc.password}"/>
    </bean>

    <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
        <property name="persistenceUnitName" value="YourDatabasePersistenceUnitName"/>
        <property name="dataSource" ref="dataSource"/>
        <property name="jpaVendorAdapter">
            <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
                <property name="database" value="POSTGRESQL" />
                <property name="databasePlatform" value="org.hibernate.dialect.PostgreSQLDialect"/>
                <property name="showSql" value="true"/>
                <property name="generateDdl" value="false"/>
            </bean>
        </property>     
    </bean>

    <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
        <property name="entityManagerFactory" ref="entityManagerFactory"/>
        <property name="dataSource" ref="dataSource"/>
    </bean>

<tx:annotation-driven transaction-manager="transactionManager" />

<bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor" />

 <bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"/> 
```

上面的某些属性可能会根据您的需要进行更改或添加。该示例适用于您可能已经猜到的带有 Hibernate 和 PostgreSQL 数据库的 JPA。

现在您可以像这样简单地定义您的数据访问方法：

```
@Repository
@Transactional
public class UserJpaDAO {

    protected EntityManager entityManager;

    @PersistenceContext
    public void setEntityManager(EntityManager entityManager) {
        this.entityManager = entityManager;
    }

    public void save(User theUser) {
        entityManager.persist(theUser);
    }

    public User update(User theUser) {
        return entityManager.merge(theUser);
    }
 } 
```

其中 User 是您的应用程序定义的 JPA 实体。您可以在调用您的 DAO 的管理器/控制器层管理事务 - 事实上我就是这样做的 - 但我将它们放在一起，以免使示例过于混乱。

您可能想直接而不是我的示例的很好的参考是 [http://icoloma.blogspot.com/2006/11/jpa-and-spring-fucking-cooltm_26.html](http://icoloma.blogspot.com/2006/11/jpa-and-spring-fucking-cooltm_26.html) 它引用的前 3 个链接值得去也是。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-17T14:41:09.610

Spring 提供了至少 3 种事务划分方式：

1) 程序化处理，通过 TransactionTemplate 或 PlatformTransactionManager - 轻量配置，但具有侵入性

2) 通过 XML 进行声明 - 详细的 XML，但非侵入性

3) 通过注解进行声明——基于 XML，非侵入性

您选择哪一个取决于哪一个最适合您的需求，Spring 不会为您做出这样的选择。从您的问题来看，听起来注释方法就是您所追求的。

我建议阅读 Spring 参考手册，注释驱动的事务处理部分。简洁明了。

我总是先查阅参考文档，只有在文档中没有的书才查阅。

# assembly - 摩托罗拉 68HC12 实时中断寄存器

> ID：758051
> 
> 赞同：2
> 
> 时间：2009-04-16T21:06:39.707
> 
> 标签：assembly, embedded, motorola

RTICTL 寄存器中的 RSWAI 位有什么作用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T21:21:19.140

I'm assuming you've read the documentation, but in case you haven't...

> RSWAI — RTI and COP Stop While in Wait
> 
> Write once in normal modes, anytime in special modes. Read anytime.
> 
> 0 = Allows the RTI and COP to continue running in wait.
> 
> 1 = Disables both the RTI and COP whenever the part goes into Wait.

# ruby-on-rails - Sphinx、Rails、ThinkSphinx 并在查询中使某些词比其他词更重要

> ID：758063
> 
> 赞同：1
> 
> 时间：2009-04-16T21:08:51.323
> 
> 标签：ruby-on-rails, ruby, sphinx, thinking-sphinx

我有一个需要搜索的关键字列表，使用 ThinkingSphinx 其中一些比其他更重要，我需要找到一种方法来加权这些词。

到目前为止，我想出的唯一解决方案是在我的查询中重复 x 次相同的单词以增加其相关性。例如：
3 个关键字，每个关键字都有一个重要级别：蓝色（1）最近（2）有趣（3）我运行这个查询

MyModel.search "Blue 最近的趣趣趣趣", :match_mode => :any

不是很优雅，而且非常有限。有没有人有更好的主意？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-02T15:41:59.543

最近我一直在广泛使用 Sphinx，自从 UltraSphinx 死后，我开始使用 Pat 的伟大插件（谢谢 Pat，我很快就会在墨尔本给你买杯咖啡！）

根据您的原始想法，我看到了一个可能的解决方案，但是您需要在“索引时间”而不是“运行时间”对数据进行更改。

**尝试这个：**

1.  修改您的 Sphinx SQL 查询，将“Blue”替换为“Blue Blue Blue Blue”，将“Recent”替换为“Recent Recent Recent”，将“Fun”替换为“Fun Fun”。*这将放大您的特殊*关键字的任何出现。

    *例如 SELECT REPLACE(my_text_col,"blue","blue blue blue") as my_text_col ...*

    您可能想一次完成所有操作，因此只需嵌套替换调用。

    *例如 SELECT REPLACE(REPLACE(my_text_col,"fun","fun fun"),"blue","blue blue blue") as my_text_col ...*

2.  接下来，将您的排名模式更改为 SPH_RANK_WORDCOUNT。这种方式最大的相关性被赋予关键字的频率。

3.  （可选）假设您有一个与您的*特殊关键字*相关的关键字列表。例如**，“淡蓝色”与“蓝色”相关**，**“愉快”与“有趣”相关**。在运行时，改写查询文本以查找目标词。您可以轻松地将这些单词存储在哈希中，然后循环遍历它以进行替换。

```
# Add trigger words as the key, 
# and the related special keyword as the value
trigger_words = {}
trigger_words['pale blue'] = 'blue'
trigger_words['pleasant'] = 'fun'

# Now loop through each query term and see if it should be replaced
new_query = ""
query.split.each do |word|
  word = trigger_words[word] if trigger_words.has_key?(word)
  new_query = new_query + ' ' word 
end 
```

现在你也有了准关键字聚类。Sphinx 真的是一项了不起的技术，享受吧！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T05:55:57.890

如果您可以将这些关键字放入单独的字段中，那么您可以对这些字段进行加权以使其更重要。不过，这是我能想到的唯一好方法。

```
MyModel.search "Blue Recent Fun", :field_weights => {"keywords" => 100} 
```

# c# - 如何使用 moq 模拟 Controller.User

> ID：758066
> 
> 赞同：51
> 
> 时间：2009-04-16T21:09:03.787
> 
> 标签：c#, asp.net-mvc, unit-testing, mocking, moq

我有几个 ActionMethods 像这样查询 Controller.User 的角色

```
bool isAdmin = User.IsInRole("admin"); 
```

在这种情况下方便地采取行动。

我开始用这样的代码对这些方法进行测试

```
[TestMethod]
public void HomeController_Index_Should_Return_Non_Null_ViewPage()
{
    HomeController controller  = new HomePostController();
    ActionResult index = controller.Index();

    Assert.IsNotNull(index);
} 
```

并且该测试失败，因为 Controller.User 未设置。任何的想法？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2009-04-16T21:51:00.507

您需要模拟 ControllerContext、HttpContextBase 和最后的 IPrincipal 来模拟 Controller 上的用户属性。使用 Moq (v2) 应该可以使用以下几行。

```
 [TestMethod]
    public void HomeControllerReturnsIndexViewWhenUserIsAdmin() {
        var homeController = new HomeController();

        var userMock = new Mock<IPrincipal>();
        userMock.Expect(p => p.IsInRole("admin")).Returns(true);

        var contextMock = new Mock<HttpContextBase>();
        contextMock.ExpectGet(ctx => ctx.User)
                   .Returns(userMock.Object);

        var controllerContextMock = new Mock<ControllerContext>();
        controllerContextMock.ExpectGet(con => con.HttpContext)
                             .Returns(contextMock.Object);

        homeController.ControllerContext = controllerContextMock.Object;
        var result = homeController.Index();
        userMock.Verify(p => p.IsInRole("admin"));
        Assert.AreEqual(((ViewResult)result).ViewName, "Index");
    } 
```

测试用户不是管理员时的行为就像更改 userMock 对象上的期望集以返回 false 一样简单。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-07-04T11:10:28.237

使用 Moq 3.1 版（和 NUnit）：

```
 [Test]
    public void HomeController_Index_Should_Return_Non_Null_ViewPage()
    {
        // Assign:
        var homeController = new HomeController();

        Mock<ControllerContext> controllerContextMock = new Mock<ControllerContext>();
        controllerContextMock.Setup(
            x => x.HttpContext.User.IsInRole(It.Is<string>(s => s.Equals("admin")))
            ).Returns(true);
        homeController.ControllerContext = controllerContextMock.Object;

        // Act:
        ActionResult index = homeController.Index();

        // Assert:
        Assert.IsNotNull(index);
        // Place other asserts here...
        controllerContextMock.Verify(
            x => x.HttpContext.User.IsInRole(It.Is<string>(s => s.Equals("admin"))),
            Times.Exactly(1),
            "Must check if user is in role 'admin'");
    } 
```

请注意，不需要为 HttpContext 创建模拟，Moq 在设置测试时支持属性嵌套。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2019-10-15T12:16:41.570

使用 AspNetCore 时，我无法模拟，`ControllerContext`因为我遇到了异常。

> 不支持的表达式：m => m.HttpContext
> 不可覆盖的成员（这里：ActionContext.get_HttpContext）不能用于设置/验证表达式。

相反，我不得不模拟`HttpContext`并创建一个`ControllerContext`并传递`HttpContext`对象。

我确实发现使用此方法时，模拟声明或响应/请求对象也可以正常工作。

```
[Test]
public void TestSomeStuff() {
  var name = "some name";

  var httpContext = new Mock<HttpContext>();
  httpContext.Setup(m => m.User.IsInRole("RoleName")).Returns(true);
  httpContext.Setup(m => m.User.FindFirst(ClaimTypes.Name)).Returns(name);

  var context = new ControllerContext(new ActionContext(httpContext.Object, new RouteData(), new ControllerActionDescriptor()));

  var controller = new MyController()
  {
    ControllerContext = context
  };

  var result = controller.Index();
  Assert.That(result, Is.Not.Null);
} 
```

# c# - 使用 Web 站点中的反射访问 AssemblyInfo.cs 中的信息

> ID：758077
> 
> 赞同：3
> 
> 时间：2009-04-16T21:11:31.037
> 
> 标签：c#, asp.net, reflection, web, assemblies

我创建了一个 DLL，它将从 AssemblyInfo.cs 收集信息。在类构造函数中，我使用反射来获取正在运行的最顶层应用程序。

```
public class AppInfo()
{
    public AppInfo()
    {
        System.Reflection.Assembly assembly =
            System.Reflection.Assembly.GetEntryAssembly();
        if (assembly == null)
            assembly = System.Reflection.Assembly.GetCallingAssembly();

        //code to gather needed information
    }
} 
```

如果我从给定应用程序 MyApp 中的任何 DLL 调用它，那么它的使用方式是，可以说名称将始终为“MyApp”。检索该信息不是问题，它在 Windows 服务和 Windows 应用程序中运行良好。我的问题是： **如何获得最顶级网站的大会？**

我找到了几篇文章，我可以通过将网站的 AssemblyInfo.cs 从 App_Code 文件夹移出到网站的根目录中来获取 Global.asax.cs 中的信息。然后通过在 AssemblyInfo.cs 的物理路径中添加一个 compilerOption

```
<compiler
language="c#;cs;csharp"
extension=".cs"
compilerOptions="C:\Sandbox\MyWebSite\AssemblyInfo.cs"
type="Microsoft.CSharp.CSharpCodeProvider,System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" warningLevel="4"> 
```

使用它，我可以通过`System.Reflection.Assembly.GetExecutingAssembly()`. 现在我可以重载我的`AppInfo`类的构造函数以接受`Assembly`并以这种方式检索信息，但如果`MyWebSite`创建一个使用的另一个 DLL，`new AppInfo()`我将获得该 DLL 的程序集信息，而不是父网站。

我知道如果我使用的是 Web 应用程序而不是网站，我不会遇到这个问题，但由于我不会进入的原因，我无法使用 Web 应用程序。关于如何从我正在运行的网站的 AssemblyInfo.cs 中读取信息的任何建议，无论我在哪个 DLL 中？

**编辑：** 我需要它来为网站、Windows 应用程序和 Windows 服务工作

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-27T07:59:56.093

如果我理解正确，问题是`Assembly.GetEntryAssembly()`在网站中返回 null 并且`Assembly.GetCallingAssembly()`返回错误的内容，因为您有一系列调用导致网站不是直接调用者。如果是这种情况，您可以使用堆栈跟踪找到“入口程序集”并返回调用帧。堆栈将充满来自 System.Web 等的引用，因为调用将源自 IIS 深处的某个地方，但您应该能够通过抓取您可以肯定识别的最低帧来挑选您感兴趣的程序集作为属于你的。请注意，这非常hacky，但我认为它会给你你想要的......

```
var trace = new StackTrace();
Assembly entryAssembly = null;
foreach (var frame in trace.GetFrames())
{
   var assembly = frame.GetMethod().DeclaringType.Assembly;
   //check if the assembly is one you own & therefore could be your logical
   //"entry assembly". You could do this by checking the prefix of the
   //Assembly Name if you use some standardised naming convention, or perhaps
   //looking at the AssemblyCompanyAttribute, etc
   if ("assembly is one of mine")
   {
      entryAssembly = assembly;
   }
} 
```

希望其他人能够想出一种不那么讨厌的方法......但如果你真的被卡住了，这可能会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T08:07:55.573

AppDomains 是为每个网站创建的，然后 bin*.dll 文件被加载到该应用程序的 AppDomain 中。该站点没有“主大会”，至少没有任何具有任何特殊含义的站点。

这是一个过程。[System.Web.Hosting.ProcessHost通过](http://msdn.microsoft.com/en-us/library/system.web.hosting.processhost.aspx)[System.Web.Hosting.ApplicationManger](http://msdn.microsoft.com/en-us/library/system.web.hosting.applicationmanager.aspx)和[System.Web.Hosting.Environment](http://msdn.microsoft.com/en-us/library/system.web.hosting.hostingenvironment.aspx)的组合创建[System.Web.ApplicationHost](http://msdn.microsoft.com/en-us/library/system.web.hosting.applicationhost.aspx)，然后为应用程序创建 System.AppDomain。

AppDomain 的安全性非常好，因此除非您知道如何进入 AppDomain，否则您就不走运了。

如果您可以更新您的问题，有人可能会提供更多帮助。

如果安全设置不正确，您**可以执行此操作”**

```
String binDir = Server.MapPath("/bin/");
Response.Write(String.Format("Bin dir:{0}<br/><br/>",binDir));

foreach (string file in Directory.GetFiles(binDir, "*.dll"))
{
    Response.Write(String.Format("File:{0}<br/>", file));
    try
    {
        Assembly assembly = Assembly.LoadFile(file);
        object[] attrinutes = assembly.GetCustomAttributes(true);
        foreach (var o in attrinutes)
        {
            //AssemblyCompanyAttribute is set in the AssemblyInfo.cs
            if (o is AssemblyCompanyAttribute)
            {
                Response.Write(String.Format("Company Attribute: Company = {0}<br/>", ((AssemblyCompanyAttribute)o).Company));
                continue;   
            }
            Response.Write(String.Format("Attribute: {0}<br/>", o));
        }
    }
    catch(Exception ex)
    {
        Response.Write(String.Format("Exception Reading File: {0} Exception: {1}",file,ex));
    }
} 
```

您在这里假设主站点未编译（具有 App_Code 目录）并且驻留在与您的子站点相同的应用程序池中。您是否需要访问权限才能执行此操作？主站点是共享托管站点还是什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T21:57:14.520

变态是对的。但如果可以的话，您应该使用 Assembly.Load 而不是 Assembly.LoadFile。

这里有一些不错的参考：

[http://gisresearch.blogspot.com/2007/09/assembly-load-loadfrom-loadfile.html](http://gisresearch.blogspot.com/2007/09/assembly-load-loadfrom-loadfile.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-24T09:59:29.740

使用 Alconja 的建议，我正在检查 assembly.GlobalAssemblyCache 直到我发现第一个在那里。最后一个不存在的是我自己的第一个dll，我认为它是入口程序集。

如果仅知道程序集名称和类型名称，则下面的类有助于获取 Type 对象。

```
public static class AssemblyHandler {

    private static Dictionary<String, Assembly> Assemblies;

    public static Assembly GetAssembly(String Name) {

        if (Assemblies == null) {
            Assemblies = new Dictionary<string, Assembly>();
            var mainAsm = Assembly.GetEntryAssembly();

            if (mainAsm == null) {
                var trace = new StackTrace();
                foreach (var frame in trace.GetFrames()) {
                    var assembly = frame.GetMethod().DeclaringType.Assembly;
                    if (assembly.GlobalAssemblyCache) {
                        break;
                    }
                    mainAsm = assembly;
                }
            }

            Assemblies.Add(mainAsm.FullName, mainAsm);
            ScanReferencedAssemblies(mainAsm);
        }

        if (!Assemblies.ContainsKey(Name)) {
            return null;
        }
        return Assemblies[Name];
    }

    private static void ScanReferencedAssemblies(Assembly Asm) {

        foreach (var refAsmName in Asm.GetReferencedAssemblies()) {
            Assembly a = Assembly.Load(refAsmName);
            if (a.GlobalAssemblyCache) {
                continue;
            }
            if (!Assemblies.ContainsKey(a.FullName)) {
                Assemblies.Add(a.FullName, a);
                ScanReferencedAssemblies(a);
            }
        }
    }

    public static Type GetType(string AssemblyName, string TypeName) {

        return GetAssembly(AssemblyName).GetType(TypeName);
    }
} 
```

# c# - 我们需要 C# 中的定点组合器吗？

> ID：758082
> 
> 赞同：3
> 
> 时间：2009-04-16T21:13:00.957
> 
> 标签：c#, functional-programming, lambda

我在 C# 中使用递归 lambda，并在网上找到了两种方法来做到这一点。一种方法使用[定点组合](http://en.wikipedia.org/wiki/Y_combinator)器，另一种方法不使用。在下面的代码中，f1 是使用组合器构建的，而 f2 是直接定义的。我的问题是，我们是否需要 C# 中的定点组合器，或者该语言已经提供了我们所需要的一切，所以我们可以不理会它们？

```
class Program
{
    static Func<T, T> F<T>(Func<Func<T,T>,Func<T,T>> f)
    {
        return x => f(F(f))(x);
    }

    static void Main(string[] args)
    {
        Func<Func<int,int>,Func<int,int>> f = fac => x => x == 0 ? 1 : x * fac(x - 1);
        var f1 = F(f);

        Console.WriteLine(f1(5));

        Func<int, int> f2 = null;
        f2 = x => x == 0 ? 1 : x * f2(x - 1);

        Console.WriteLine(f2(5));
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T21:24:06.793

正如我们可以给方法命名一样，这意味着该语言已经内置了对递归的必要支持。

请注意，您的问题中给出的第二种方法涉及在引入变量后更改变量的值，使其不是“纯”函数式编程。仅当您的函数微积分系统没有内置的函数概念时，才需要 Y 组合器，该函数可以在定义完全定义之前按名称引用其自己的定义。C# 有两种方法可以直接做到这一点：1\. 最初将函数变量定义为 null 和 2\. 声明一个普通的命名方法（到目前为止，这是首选技术）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-19T16:58:21.753

我认为使用名为 Recursive 的额外实用程序类可以相当优雅，如下所示：

```
public static class Recursive {
            public static Func<R> Func<R>(
                Func<Func<R>, Func<R>> f) { 
                return () => f(Func(f))(); }
            public static Func<T1, R> Func<T1, R>(
                Func<Func<T1, R>, Func<T1, R>> f) { 
                return x => f(Func(f))(x); }
            public static Func<T1, T2, R> Func<T1, T2, R>(
                Func<Func<T1, T2, R>, Func<T1, T2, R>> f) {
                return (a1, a2) => f(Func(f))(a1, a2);
            }
            //And so on...
        }

class Program {

    static void Main(string[] args) {

        Console.WriteLine(
            Recursive.Func<int, int>(factorial =>
                x => x == 0 ? 1 : factorial(x - 1) * x
            ) 
            (10)
        );

        Console.WriteLine(
            Recursive.Func<int,int,int>(gcd =>
                (x,y) => 
                    x == 0 ? y:
                    y == 0 ? x:
                    x > y  ? gcd(x % y, y):
                    gcd(y % x, x)
            )
            (35,21)
        );
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T21:40:17.707

另一种选择是将您的递归 Func 委托声明为静态成员：

```
static Func<int, int> Factorial = (n) => n <= 1 ? 1 : n*Factorial(n - 1); 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-16T23:07:26.827

“需要”是什么意思？C# 不需要它们，因为您不应该在 C# 中尝试这种函数式编程。这只是通往痛苦的途径。

记忆递归函数是您想要一个定点组合器的地方。[在C#](http://blogs.msdn.com/wesdyer/archive/2007/02/05/memoization-and-anonymous-recursion.aspx)中将此与[Haskell](http://www.haskell.org/haskellwiki/Memoization#Memoizing_fix_point_operator)进行比较。

因此，在 C#“需要”这个之前，需要做很多工作才能使这种编程相当实用。

# java - 如何将 Java 应用程序放入系统托盘？

> ID：758083
> 
> 赞同：62
> 
> 时间：2009-04-16T21:13:09.270
> 
> 标签：java, system-tray, minimize

我有一个小控制面板，只是我制作的一个小应用程序。我想用系统最小化/向上/向下放置控制面板，以及电池寿命、日期、网络等。

任何人都可以给我一个线索，链接到教程或阅读的东西吗？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2009-04-16T21:15:07.940

从 Java 6 开始，在[`SystemTray`](http://docs.oracle.com/javase/7/docs/api/java/awt/SystemTray.html)和[`TrayIcon`](http://docs.oracle.com/javase/7/docs/api/java/awt/TrayIcon.html)类中支持这一点。`SystemTray`在其 Javadocs 中有一个相当广泛的示例：

```
TrayIcon trayIcon = null;
if (SystemTray.isSupported()) {
    // get the SystemTray instance
    SystemTray tray = SystemTray.getSystemTray();
    // load an image
    Image image = Toolkit.getDefaultToolkit().getImage("your_image/path_here.gif");
    // create a action listener to listen for default action executed on the tray icon
    ActionListener listener = new ActionListener() {
        public void actionPerformed(ActionEvent e) {
            // execute default action of the application
            // ...
        }
    };
    // create a popup menu
    PopupMenu popup = new PopupMenu();
    // create menu item for the default action
    MenuItem defaultItem = new MenuItem(...);
    defaultItem.addActionListener(listener);
    popup.add(defaultItem);
    /// ... add other items
    // construct a TrayIcon
    trayIcon = new TrayIcon(image, "Tray Demo", popup);
    // set the TrayIcon properties
    trayIcon.addActionListener(listener);
    // ...
    // add the tray image
    try {
        tray.add(trayIcon);
    } catch (AWTException e) {
        System.err.println(e);
    }
    // ...
} else {
    // disable tray option in your application or
    // perform other actions
    ...
}
// ...
// some time later
// the application state has changed - update the image
if (trayIcon != null) {
    trayIcon.setImage(updatedImage);
}
// ... 
```

您还可以查看[这篇文章](http://www.oracle.com/technetwork/articles/javase/systemtray-139788.html)或[这个技术提示](http://blogs.oracle.com/CoreJavaTechTips/entry/getting_to_know_system_tray)。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2014-09-09T13:05:12.297

**这很简单**

```
import java.awt.*;
import java.awt.event.*;
import javax.swing.JOptionPane;

public class SystemTrayDemo{

//start of main method
public static void main(String []args){
    //checking for support
    if(!SystemTray.isSupported()){
        System.out.println("System tray is not supported !!! ");
        return ;
    }
    //get the systemTray of the system
    SystemTray systemTray = SystemTray.getSystemTray();

    //get default toolkit
    //Toolkit toolkit = Toolkit.getDefaultToolkit();
    //get image 
    //Toolkit.getDefaultToolkit().getImage("src/resources/busylogo.jpg");
    Image image = Toolkit.getDefaultToolkit().getImage("src/images/1.gif");

    //popupmenu
    PopupMenu trayPopupMenu = new PopupMenu();

    //1t menuitem for popupmenu
    MenuItem action = new MenuItem("Action");
    action.addActionListener(new ActionListener() {
        @Override
        public void actionPerformed(ActionEvent e) {
            JOptionPane.showMessageDialog(null, "Action Clicked");          
        }
    });     
    trayPopupMenu.add(action);

    //2nd menuitem of popupmenu
    MenuItem close = new MenuItem("Close");
    close.addActionListener(new ActionListener() {
        @Override
        public void actionPerformed(ActionEvent e) {
            System.exit(0);             
        }
    });
    trayPopupMenu.add(close);

    //setting tray icon
    TrayIcon trayIcon = new TrayIcon(image, "SystemTray Demo", trayPopupMenu);
    //adjust to default size as per system recommendation 
    trayIcon.setImageAutoSize(true);

    try{
        systemTray.add(trayIcon);
    }catch(AWTException awtException){
        awtException.printStackTrace();
    }
    System.out.println("end of main");

}//end of main

}//end of class 
```

为图像设置适当的**路径**，然后运行程序。泰:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-04-14T12:07:12.560

这是您可以用来访问和自定义系统托盘的代码：

```
final TrayIcon trayIcon;

if (SystemTray.isSupported()) {

SystemTray tray = SystemTray.getSystemTray();
Image image = Toolkit.getDefaultToolkit().getImage("tray.gif");

MouseListener mouseListener = new MouseListener() {

    public void mouseClicked(MouseEvent e) {
        System.out.println("Tray Icon - Mouse clicked!");                 
    }

    public void mouseEntered(MouseEvent e) {
        System.out.println("Tray Icon - Mouse entered!");                 
    }

    public void mouseExited(MouseEvent e) {
        System.out.println("Tray Icon - Mouse exited!");                 
    }

    public void mousePressed(MouseEvent e) {
        System.out.println("Tray Icon - Mouse pressed!");                 
    }

    public void mouseReleased(MouseEvent e) {
        System.out.println("Tray Icon - Mouse released!");                 
    }
};

ActionListener exitListener = new ActionListener() {
    public void actionPerformed(ActionEvent e) {
        System.out.println("Exiting...");
        System.exit(0);
    }
};

PopupMenu popup = new PopupMenu();
MenuItem defaultItem = new MenuItem("Exit");
defaultItem.addActionListener(exitListener);
popup.add(defaultItem);

trayIcon = new TrayIcon(image, "Tray Demo", popup);

ActionListener actionListener = new ActionListener() {
    public void actionPerformed(ActionEvent e) {
        trayIcon.displayMessage("Action Event", 
            "An Action Event Has Been Performed!",
            TrayIcon.MessageType.INFO);
    }
};

trayIcon.setImageAutoSize(true);
trayIcon.addActionListener(actionListener);
trayIcon.addMouseListener(mouseListener);

try {
    tray.add(trayIcon);
} catch (AWTException e) {
    System.err.println("TrayIcon could not be added.");
}

} else {

//  System Tray is not supported

} 
```

# c# - 如何在控制台应用程序中使用计时器？

> ID：758087
> 
> 赞同：1
> 
> 时间：2009-04-16T21:14:49.500
> 
> 标签：c#, timer, console-application

如何在控制台应用程序中使用计时器？例如，我希望我的控制台应用程序在后台工作并每 10 分钟执行一次。

我怎样才能做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T21:24:41.973

Console applications aren't necessarily meant to be long-running. That being said, you can do it. To ensure that the console doesn't just exit, you have to have the console loop on Console.ReadLine to wait for some exit string like "quit."

To execute your code every 10 minutes, call System.Threading.Timer and point it to your execution method with a 10 minute interval.

```
public static void Main(string[] args)
{
    using (new Timer(methodThatExecutesEveryTenMinutes, null, TimeSpan.FromMinutes(10), TimeSpan.FromMinutes(10)))
    {
        while (true)
        {
            if (Console.ReadLine() == "quit")
            {
                break;
            }
        }
    }
}

private static void methodThatExecutesEveryTenMinutes(object state)
{
    // some code that runs every ten minutes
} 
```

**EDIT**

I like Boj's comment to your question, though. If you really need a long-running application, consider the overhead of making it a Windows Service. There's some development overhead, but you get a much more stable platform on which to run your code.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T21:16:18.077

您可以使用 Windows 任务计划程序每 10 分钟运行一次控制台应用程序。

# scheme - 寻求人为的示例代码：延续！

> ID：758088
> 
> 赞同：5
> 
> 时间：2009-04-16T21:14:54.680
> 
> 标签：scheme, continuations, coroutine

所以我相信我现在至少在某种程度上理解了延续，这要归功于[社区计划 wiki](http://community.schemewiki.org/?call-with-current-continuation)和[Fixnum Days 中的 Learn Scheme](http://www.ccs.neu.edu/home/dorai/t-y-scheme/t-y-scheme-Z-H-15.html#node_chap_13)。

但是我想要更多的练习——也就是说，我可以在脑海中完成更多的示例代码（最好是人为的，所以没有多余的东西可以分散这个概念的注意力）。

**具体来说**，我想解决更多关于恢复和/或协同程序的问题，而不是仅仅使用它们来退出循环或其他任何东西（这相当简单）。

无论如何，如果你知道除了我上面链接的那些之外的好教程，或者如果你想发布你写的东西，这将是一个很好的练习，我将非常感激！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T21:20:00.767

是的，延续可能非常令人费解。这是我不久前发现的一个很好的谜题 - 尝试找出打印的内容以及原因：

```
(define (mondo-bizarro)
  (let ((k (call/cc (lambda (c) c)))) ; A
    (write 1)
    (call/cc (lambda (c) (k c))) ; B 
    (write 2)
    (call/cc (lambda (c) (k c))) ; C
    (write 3)))

(mondo-bizarro) 
```

* * *

解释这是如何工作的（包含剧透！）：

1.  第一个`call/cc`存储返回它自己的延续并将其存储在`k`.
2.  数字`1`被写入屏幕。
3.  当前的延续，就是在B点继续，返回到k，返回到A
4.  这一次，k 现在绑定到我们在 B 处得到的延续
5.  数字`1`再次写入屏幕
6.  当前的延续，即在 B 点继续，返回到 k，这是到另一个 B 点的另一个（但不同的）延续
7.  **一旦我们回到原来的延续，重要的是要注意这里的 k 仍然绑定到 A**
8.  数字`2`写入屏幕
9.  当前的延续，就是在C点继续，返回到k，返回到A
10.  这一次，k 现在绑定到我们在 C 处得到的延续
11.  数字`1`再次写入屏幕
12.  当前的继续，即在B点继续，返回到k，又返回到C
13.  数字`3`写入屏幕
14.  [你完成了](http://www.youtube.com/watch?v=_p52QJi-Ydo#t=0m53s)

因此，正确的输出是`11213`。我用粗体表示的最常见的症结点 - 重要的是要注意，当您使用延续来“重置” k 的值时，它不会影响原始延续中的 k 值。一旦你知道它变得更容易理解。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T21:30:35.140

布朗大学的编程语言课程在公开[的延续上存在问题。](http://cs.brown.edu/courses/csci1730/2008/Assignments/08-continuations.html)

# database - ELMAH SQL 错误处理程序数据库不可用 - 日志记录会发生什么？

> ID：758092
> 
> 赞同：12
> 
> 时间：2009-04-16T21:15:49.340
> 
> 标签：database, elmah

我正在测试 ELMAH，并特意在我的应用程序中关闭了 ELMAH 日志的数据库连接，以查看如果数据库不可用，生产中会发生什么。

似乎 ELMAH 无法捕获自己的错误——当 SQL 数据库日志失败时，AXD 文件不可用。

如果数据库不可用，ELMAH 的预期行为是什么？

如果发生这种情况，我该如何诊断我的错误？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-16T22:45:54.457

> 似乎ELMAH无法捕获自己的错误

ELMAH 确实在某种程度上捕获了自己的错误。如果`ErrorLogModule`在尝试记录错误时遇到异常，则将记录产生的异常发送到标准 .NET Framework 跟踪工具。请参阅[1.0 来源的第 123 行。](http://code.google.com/p/elmah/source/browse/tags/REL-1.0/src/Elmah/ErrorLogModule.cs#123)另请参阅 ASP.NET 文档中的以下演练，以获取使用 ASP.NET 跟踪的标准 .NET Framework 跟踪：

[演练：将 ASP.NET 跟踪与 System.Diagnostics 跟踪集成](http://msdn.microsoft.com/en-us/library/b0ectfxd(VS.85).aspx)

> SQL 数据库日志失败时，AXD 文件不可用。

那是对的。SQL Server 数据库连接必须能够在使用时查看存储在 SQL Server 数据库中的错误`SqlErrorLog`。

> 如果数据库不可用，ELMAH 的预期行为是什么？

例如，如果 SQL Server 数据库已关闭，`SqlException`则在记录期间会发生 a。然后，ELMAH 会将`SqlException`对象内容发送到标准的 .NET Framework 跟踪工具。

> 如果发生这种情况，我该如何诊断我的错误？

这里最好的选择是启用错误记录*和*电子邮件发送。如果数据库已关闭，则邮件网关很可能已启动，您仍会收到错误通知。实际上，错误将*记录*在某些邮箱中。这还有一个额外的好处，如果邮件网关曾经关闭，那么数据库很可能会启动并且错误会在那里记录。但是，如果两者都出现故障，那么您将需要认真检查您的生产基础架构，并可能采取措施通过其他措施监控系统的健康状况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T21:18:01.987

您始终可以使用 xml 文件选项来记录错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T21:29:42.693

Not really sure about ELMAH but expected behaviour of such logging frameworks is not to throw any exceptions if something goes wrong with them. I.e. if ELMAH's database is down I'd assume it will just not log the errors to database.

As suggested above you can/should use alternative sinks - email or flat file.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T21:39:46.787

I think you're mixing up contexts a bit.

ELMAH's behavior if the database isn't available is to not log errors to the database. If an exception is thrown on the server or if you raise an exception via an `ErrorSignal`, ELMAH is going to let that exception pass through to either a yellow screen or a custom errors page (your setting.)

Since Errors.axd page is only accessible to those that should be seeing it (ideally,) it is okay to present that error to the user.

The bottom line is that if the errors database is down you can't diagnose errors. For us, if that were the case, we'd have bigger problems since the error database sits with the production database.

* * *

I would also advocate against using XML logging for your primary logging source. SQL server is going to give you the best performance without having to manage the files. With XML logging that is not the case.

# c++ - C++ 向量字面量，或类似的东西

> ID：758118
> 
> 赞同：30
> 
> 时间：2009-04-16T21:24:42.860
> 
> 标签：c++, vector, literals

我正在针对 C++ API 编写一些代码，该 API 采用向量的向量向量，并且到处编写如下代码变得乏味：

```
vector<string> vs1;
vs1.push_back("x");
vs1.push_back("y");
...
vector<string> vs2;
...
vector<vector<string> > vvs1;
vvs1.push_back(vs1);
vvs1.push_back(vs2);
...
vector<vector<string> > vvs2;
...
vector<vector<vector<string> > > vvvs;
vvvs.push_back(vvs1);
vvvs.push_back(vvs2);
... 
```

C++ 有向量文字语法吗？即，类似：

```
vector<vector<vector<string>>> vvvs = 
    { { {"x","y", ... }, ... }, ... } 
```

有没有一种非内置的方法来实现这一点？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-04-16T21:26:01.440

在[C++0x](http://en.wikipedia.org/wiki/C%2B%2B0x)中，您[将能够](http://en.wikipedia.org/wiki/C%2B%2B0x#Initializer_lists)使用所需的语法：

```
vector<vector<vector<string> > > vvvs = 
    { { {"x","y", ... }, ... }, ... }; 
```

但是在今天的 C++ 中，您仅限于使用[boost.assign](http://www.boost.org/doc/libs/1_38_0/libs/assign/doc/index.html)，它可以让您执行以下操作：

```
vector<string> vs1;
vs1 += "x", "y", ...;
vector<string> vs2;
...
vector<vector<string> > vvs1;
vvs1 += vs1, vs2, ...;
vector<vector<string> > vvs2;
...
vector<vector<vector<string> > > vvvs;
vvvs += vvs1, vvs2, ...; 
```

... 或使用[Qt 的容器](https://doc.qt.io/qt-5/containers.html)，让您一次性完成：

```
QVector<QVector<QVector<string> > > vvvs =
    QVector<QVector<QVector<string> > >() << (
        QVector<QVector<string> >() << (
            QVector<string>() << "x", "y", ...) <<
            ... ) <<
        ...
    ; 
```

另一个半理智的选择，至少对于平面向量，是从数组构造：

```
string a[] = { "x", "y", "z" };
vector<string> vec(a, a + 3); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T21:26:25.993

查看[Boost 分配库](http://www.boost.org/doc/libs/1_38_0/libs/assign/doc/index.html)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-16T21:28:21.840

基本上，没有内置的语法可以做到这一点，因为 C++ 不知道向量 ether。他们只是来自一个方便的图书馆。

也就是说，如果您要加载复杂的数据结构，则无论如何都应该从文件或类似的东西中加载它；否则代码太脆弱了。

# c# - 如何在 Silverlight 中动态创建多个控件？

> ID：758120
> 
> 赞同：0
> 
> 时间：2009-04-16T21:25:08.150
> 
> 标签：c#, silverlight

我知道如何创建控件列表并向其中添加它们的新实例：

```
private List<FirstCircleControl> Circles = new List<FirstCircleControl>();
FirstCircleControl mc = new FirstCircleControl();
Circles.Add(mc); 
```

我想添加一大堆“FirstCircleControls”。如何将 10 个控件添加到我的列表中？我希望能够使用循环“创建”然后将它们“添加”到列表中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T21:27:43.213

我想知道为什么您可能需要一次创建它们然后将它们添加到列表中，但这里有一个解决方案：

```
Enumerable.Range(0, 10)
          .Select(x => new FirstCircleControl())
          .ToList()                        // Forces creation of controls.
          .ForEach(x => Circles.Add(x));   // Adds them to the list. 
```

# c# - 为 C# Express 用户识别潜在重复代码的好工具有哪些？

> ID：758126
> 
> 赞同：20
> 
> 时间：2009-04-16T21:26:11.733
> 
> 标签：c#, visual-studio, visual-studio-express

另请参阅“[检查重复 VB.NET 代码的任何工具？”](https://stackoverflow.com/questions/2266978/any-tools-to-check-for-duplicate-vb-net-code)

我的一个朋友只能访问 Visual Studio 的 Express 版本，我正在尝试帮助他重构以删除大量重复。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T21:42:54.830

[克隆侦探](http://clonedetectivevs.codeplex.com/)似乎对你有用。我以前没有使用过它，但本周我在 codeplex 上偶然发现了它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-27T14:18:46.587

你可以看看[Simian](http://www.harukizaemon.com/simian/)或[DuplicateFinder](http://duplicatefinder.codeplex.com/)。两者都不依赖于 IDE，尽管您可以[很容易地](http://blogs.conchango.com/howardvanrooijen/archive/2006/02/18/2888.aspx)[集成](http://blogs.conchango.com/howardvanrooijen/archive/2006/02/08/2776.aspx)Simian 。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-03T12:34:58.693

你的朋友应该看看[Gendarme](http://www.mono-project.com/Gendarme)，它是 Mono 项目中 Microsoft FxCop/Code Analysis 的 FOSS 和跨平台替代方案。它[包括](http://www.mono-project.com/Gendarme.Rules.Smells#AvoidCodeDuplicatedInSameClassRule) 检查重复代码的[规则。](http://www.mono-project.com/Gendarme.Rules.Smells#AvoidCodeDuplicatedInSiblingClassesRule)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-18T14:54:03.287

试试[Atomiq](http://www.getatomiq.com/)：

> Atomiq Code Similarity Finder 是开发人员查找和消除重复代码的工具。它是为 .NET 开发人员设计的，但同样适用于其他语言的开发人员，甚至是网页设计师！Atomiq 适用于各种源代码：
> 
> 我们目前支持 C#、VB.Net、ASPX、Ruby、Python、Java、C、C++、ActionScript 和 XAML，更多扩展即将推出。对于那些不经常更新他们的代码并且不可能记住其中的所有内容的人，或者一个由 2 个或更多开发人员组成的团队在同一个项目上工作但由于他们没有编写而不知道其中的所有内容，它是完美的配套工具都是自己。
> 
> 消除类似代码
> 
> （以及随之而来的撞墙） Atomiq 不仅能找到完全匹配的代码，它还能找到类似的代码。它忽略了诸如空格、字符串内容、花括号、注释和 using/import 语句之类的“绒毛”，因此您可以找到导致问题的重复代码。在 VB.NET 中，它还将忽略仅包含“Next”、“End While”、“End Try”、“End If”、“End Property”、“End Get”和“End Set”的行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T22:07:18.937

仅供参考，既然您提到了“速成版”，您可能需要寻找可以在 VS 之外使用的东西，因为我不相信速成版支持插件

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-16T19:49:31.540

请参阅我们的[CloneDR](http://www.semanticdesigns.com/Products/Clone)，它适用于多种语言，包括 C#。

编辑 2010 年 10 月：添加了 VB6、VBScript 和 VB.net 作为 CloneDR 支持的语言。没有对 MS IDE 的特定支持，但它在一个简单的源文件列表上运行，并生成一个漂亮的 HTML 报告，因此不需要太多集成。请参阅链接中的示例报告。

# user-interface - ComboBox 中的虚拟项目

> ID：758130
> 
> 赞同：1
> 
> 时间：2009-04-16T21:27:32.760
> 
> 标签：user-interface

我已经到了就如何在数据绑定 ComboBox 中指示“未选择”做出设计决策的时候了。我希望将此应用于 ComboBox 需要此的所有未来事件。不能在数据绑定组合上将 SelectedIndex 设置为 -1，也不能将 SelectedValue 设置为 null。

通常建议的解决方案是向组合添加一个虚拟行，但如果不知道绑定到行的对象，组合就无法以显示“未选择”消息的方式可靠地创建一个虚拟对象。我不想在数据源上添加另一个项目，因为这会损害不使用虚拟对象的其他客户端的列表。

还有哪些其他选择？顺便说一句，我使用的是 Telerik RadComboBox，但这种情况并不特定于 Telerik 控件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T21:34:03.823

您可以在标记中定义“空项”，并附加任何数据绑定项：

```
<asp:DropDownList DataSourceID="..." AppendDataBoundItems="true" ...>
    <asp:ListItem Value="-1" Text="None"></asp:ListItem>
</asp:DropDownList> 
```

关键是指定**AppendDataBoundItems="true"**以将数据绑定项附加到直接在标记中指定的任何项。

这适用于标准的 ASP.NET DropDownList，但也适用于 Telerik RadComboBox。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T21:37:19.883

在数据绑定之前添加一个新项目并设置 AppendDataboundItems = true;

```
 cbo.AppendDataboundItems = true;   
 cbo.Items.add(new ListItem("None", "-1");
 cbo.DataSource = x;
 cbo.DataBind(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-16T09:19:01.953

希望我没有像ThickClient（窗口应用程序）中的AppendDataBoundItems这样的属性更好地在您的数据源表中的第零索引中插入虚拟行。

```
 DataRow dr = dtsource.NewRow();
        dr["username"] = "--New User---";
        dr["Userid"] = 0;

        dtsource.Rows.InsertAt ((dr),0); 
        cmbToUser.DataSource = dtsource; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-16T09:26:22.987

IMO 这就是数据绑定毫无意义的地方。在非数据绑定控件上，这非常容易——只需在手动添加其他项之前将虚拟项添加到组合框中。

要可靠地对所有类型的数据绑定组合框执行此操作，您需要将项目添加到您的数据集——这违反了数据绑定应该首先为您带来的表示和功能的分离。

通常情况下，数据绑定可以节省您的时间。当您开始破解数据以克服数据绑定的缺点时，您将不再节省时间。

我对此的建议通常是重新评估数据绑定是否是正确的解决方案。

/大吵大闹

# c# - 用于链接字符串中的 url 的 C# 代码

> ID：758135
> 
> 赞同：33
> 
> 时间：2009-04-16T21:28:00.607
> 
> 标签：c#, asp.net, regex, linkify

有没有人有任何好的 c# 代码（和正则表达式）来解析字符串并“链接”可能在字符串中的任何 url？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-16T21:30:09.480

这是一个非常简单的任务，您可以使用[Regex](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex.replace.aspx)和现成的正则表达式来实现它：

*   [http://regexlib.com/](http://regexlib.com/DisplayPatterns.aspx?cattabindex=1&categoryId=2)

就像是：

```
var html = Regex.Replace(html, @"^(http|https|ftp)\://[a-zA-Z0-9\-\.]+" +
                         "\.[a-zA-Z]{2,3}(:[a-zA-Z0-9]*)?/?" +
                         "([a-zA-Z0-9\-\._\?\,\'/\\\+&amp;%\$#\=~])*$",
                         "<a href=\"$1\">$1</a>"); 
```

您可能不仅对创建链接感兴趣，而且对缩短 URL 感兴趣。这是一篇关于这个主题的好文章：

*   [在 C# 中解析和缩短 URL](http://madskristensen.net/post/resolve-and-shorten-urls-in-csharp)

**另见**：

*   MSDN 上的[正则表达式工作台](http://code.msdn.microsoft.com/RegexWorkbench)
*   [在 C# 中使用正则表达式将 URL 转换为链接](http://rickyrosario.com/blog/converting-a-url-into-a-link-in-csharp-using-regular-expressions)
*   [正则表达式在文本中查找 URL 并将它们作为链接](http://weblogs.asp.net/farazshahkhan/archive/2008/08/09/regex-to-find-url-within-text-and-make-them-as-link.aspx)
*   MSDN 上的[Regex.Replace 方法](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex.replace.aspx)
*   Jeff Atwood[的 URL 问题](https://blog.codinghorror.com/the-problem-with-urls/)
*   [使用正则表达式和 Regex 对象解析 URL](http://www.cambiaresearch.com/c4/890160aa-bc4e-40fc-ac36-c1031858c048/Parsing-URLs-with-Regular-Expressions-and-the-Regex-Object.aspx)
*   [将字符串中的 URL 格式化为 C# 中的 HTML 链接](http://snipplr.com/view/13286/format-urls-in-string-to-html-links-in-c/)
*   [使用 C# 在 ASP.NET 页面中自动超链接 URL 和电子邮件](http://www.codeproject.com/KB/aspnet/Autohyperlink.aspx)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-07-10T21:48:40.767

好吧，在对此进行了大量研究之后，并多次尝试修复时间

1.  人们在同一个帖子中输入[http://www.sitename.com和 www.sitename.com](http://www.sitename.com)
2.  修复括号，如 ( [http://www.sitename.com](http://www.sitename.com) ) 和[http://msdn.microsoft.com/en-us/library/aa752574(vs.85).aspx](http://msdn.microsoft.com/en-us/library/aa752574(vs.85).aspx)
3.  长网址，例如：[http ://www.amazon.com/gp/product/b000ads62g/ref=s9_simz_gw_s3_p74_t1?pf_rd_m=atvpdkikx0der&pf_rd_s=center-2&pf_rd_r=04eezfszazqzs8xfm9yd&pf_rd_t=101&pf_rd_p=4_i=47038786](https://rads.stackoverflow.com/amzn/click/com/b000ads62g)

我们现在正在使用这个 HtmlHelper 扩展......我想我会分享并获得任何评论：

```
 private static Regex regExHttpLinks = new Regex(@"(?<=\()\b(https?://|www\.)[-A-Za-z0-9+&@#/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#/%=~_()|](?=\))|(?<=(?<wrap>[=~|_#]))\b(https?://|www\.)[-A-Za-z0-9+&@#/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#/%=~_()|](?=\k<wrap>)|\b(https?://|www\.)[-A-Za-z0-9+&@#/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#/%=~_()|]", RegexOptions.Compiled | RegexOptions.IgnoreCase);

    public static string Format(this HtmlHelper htmlHelper, string html)
    {
        if (string.IsNullOrEmpty(html))
        {
            return html;
        }

        html = htmlHelper.Encode(html);
        html = html.Replace(Environment.NewLine, "<br />");

        // replace periods on numeric values that appear to be valid domain names
        var periodReplacement = "[[[replace:period]]]";
        html = Regex.Replace(html, @"(?<=\d)\.(?=\d)", periodReplacement);

        // create links for matches
        var linkMatches = regExHttpLinks.Matches(html);
        for (int i = 0; i < linkMatches.Count; i++)
        {
            var temp = linkMatches[i].ToString();

            if (!temp.Contains("://"))
            {
                temp = "http://" + temp;
            }

            html = html.Replace(linkMatches[i].ToString(), String.Format("<a href=\"{0}\" title=\"{0}\">{1}</a>", temp.Replace(".", periodReplacement).ToLower(), linkMatches[i].ToString().Replace(".", periodReplacement)));
        }

        // Clear out period replacement
        html = html.Replace(periodReplacement, ".");

        return html;
    } 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-16T23:02:56.197

```
protected string Linkify( string SearchText ) {
    // this will find links like:
    // http://www.mysite.com
    // as well as any links with other characters directly in front of it like:
    // href="http://www.mysite.com"
    // you can then use your own logic to determine which links to linkify
    Regex regx = new Regex( @"\b(((\S+)?)(@|mailto\:|(news|(ht|f)tp(s?))\://)\S+)\b", RegexOptions.IgnoreCase );
    SearchText = SearchText.Replace( "&nbsp;", " " );
    MatchCollection matches = regx.Matches( SearchText );

    foreach ( Match match in matches ) {
        if ( match.Value.StartsWith( "http" ) ) { // if it starts with anything else then dont linkify -- may already be linked!
            SearchText = SearchText.Replace( match.Value, "<a href='" + match.Value + "'>" + match.Value + "</a>" );
        }
    }

    return SearchText;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-16T21:45:01.283

[这并不像您在Jeff Atwood](http://blog.codinghorror.com/the-problem-with-urls/)的这篇博文中所读到的那么容易。检测 URL 的结束位置尤其困难。

例如，是否是 URL 的尾括号部分：

*   http://en.wikipedia.org/wiki/PCTools(CentralPointSoftware)
*   括号中的 URL (http://en.wikipedia.org) 更多文本

在第一种情况下，括号是 URL 的一部分。在第二种情况下，他们不是！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-18T14:19:45.243

发现以下正则表达式 [http://daringfireball.net/2010/07/improved_regex_for_matching_urls](http://daringfireball.net/2010/07/improved_regex_for_matching_urls)

对我来说看起来很好。Jeff Atwood 解决方案不能处理很多情况。[在我看来， josefresno](https://stackoverflow.com/questions/758135/c-sharp-code-to-linkify-urls-in-a-string/1112171#1112171)似乎可以处理所有案件。但是当我试图理解它时（如果有任何支持请求），我的大脑就沸腾了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-02-25T12:51:28.213

有类：

```
public class TextLink
{
    #region Properties

    public const string BeginPattern = "((http|https)://)?(www.)?";

    public const string MiddlePattern = @"([a-z0-9\-]*\.)+[a-z]+(:[0-9]+)?";

    public const string EndPattern = @"(/\S*)?";

    public static string Pattern { get { return BeginPattern + MiddlePattern + EndPattern; } }

    public static string ExactPattern { get { return string.Format("^{0}$", Pattern); } }

    public string OriginalInput { get; private set; }

    public bool Valid { get; private set; }

    private bool _isHttps;

    private string _readyLink;

    #endregion

    #region Constructor

    public TextLink(string input)
    {
        this.OriginalInput = input;

        var text = Regex.Replace(input, @"(^\s)|(\s$)", "", RegexOptions.IgnoreCase);

        Valid = Regex.IsMatch(text, ExactPattern);

        if (Valid)
        {
            _isHttps = Regex.IsMatch(text, "^https:", RegexOptions.IgnoreCase);
            // clear begin:
            _readyLink = Regex.Replace(text, BeginPattern, "", RegexOptions.IgnoreCase);
            // HTTPS
            if (_isHttps)
            {
                _readyLink = "https://www." + _readyLink;
            }
            // Default
            else
            {
                _readyLink = "http://www." + _readyLink;
            }
        }
    }

    #endregion

    #region Methods

    public override string ToString()
    {
        return _readyLink;
    }

    #endregion
} 
```

在此方法中使用它：

```
public static string ReplaceUrls(string input)
{
    var result = Regex.Replace(input.ToSafeString(), TextLink.Pattern, match =>
    {
        var textLink = new TextLink(match.Value);
        return textLink.Valid ?
            string.Format("<a href=\"{0}\" target=\"_blank\">{1}</a>", textLink, textLink.OriginalInput) :
            textLink.OriginalInput;
    });
    return result;
} 
```

测试用例：

```
[TestMethod]
public void RegexUtil_TextLink_Parsing()
{
    Assert.IsTrue(new TextLink("smthing.com").Valid);
    Assert.IsTrue(new TextLink("www.smthing.com/").Valid);
    Assert.IsTrue(new TextLink("http://smthing.com").Valid);
    Assert.IsTrue(new TextLink("http://www.smthing.com").Valid);
    Assert.IsTrue(new TextLink("http://www.smthing.com/").Valid);
    Assert.IsTrue(new TextLink("http://www.smthing.com/publisher").Valid);

    // port
    Assert.IsTrue(new TextLink("http://www.smthing.com:80").Valid);
    Assert.IsTrue(new TextLink("http://www.smthing.com:80/").Valid);
    // https
    Assert.IsTrue(new TextLink("https://smthing.com").Valid);

    Assert.IsFalse(new TextLink("").Valid);
    Assert.IsFalse(new TextLink("smthing.com.").Valid);
    Assert.IsFalse(new TextLink("smthing.com-").Valid);
}

[TestMethod]
public void RegexUtil_TextLink_ToString()
{
    // default
    Assert.AreEqual("http://www.smthing.com", new TextLink("smthing.com").ToString());
    Assert.AreEqual("http://www.smthing.com", new TextLink("http://www.smthing.com").ToString());
    Assert.AreEqual("http://www.smthing.com/", new TextLink("smthing.com/").ToString());

    Assert.AreEqual("https://www.smthing.com", new TextLink("https://www.smthing.com").ToString());
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-04-11T12:03:34.003

这对我有用：

```
str = Regex.Replace(str,
                @"((http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?)",
                "<a target='_blank' href='$1'>$1</a>"); 
```

# javascript - window.onload delay

> ID：758145
> 
> 赞同：1
> 
> 时间：2009-04-16T21:30:50.897
> 
> 标签：javascript, window, onload, delay

i am trying to appendChild() on an existing form, and its not working. i wonder if i need to delay the page, at least i thought i read that somewhere. what i am thinking is dynamically altering window onload to be a delay. do i grab the body tag like any other DOM element?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T21:42:11.213

Does this work?

```
window.addEventListener('load', function() {
    // Code to execute when DOM is loaded
}, false); 
```

Steve

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T21:41:40.090

you could use a timeout to delay the call to your method that does the appendChild()...

```
setTimeout(functionName, 200) 
```

If you are using jQuery you can use the ready method to delay your code until the page is fully loaded:

```
$(document).ready(function() {
    appendChild();
}); 
```

Edit: Removed quotes around function call in setTimeout per Steve's suggestion in the comments

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T21:41:40.573

the body-element is referenced directly under document,

document.body

But your question is very fuzzy.

If you call your DOM-manipulation from the onload-event, the DOM should be completely loaded. Therefor I assume a delay isn't the way to go.

# c++ - 相当于 MFC 窗口的 OnFinalMessage？

> ID：758151
> 
> 赞同：1
> 
> 时间：2009-04-16T21:31:49.897
> 
> 标签：c++, windows, mfc, atl

ATL CWindow 类有一个有用的虚方法`OnFinalMessage`，它在处理完窗口的最后一个窗口消息后调用——此时销毁或删除与窗口关联的任何对象是安全的。从 MFC 类派生的窗口是否有任何等价物`CWnd`？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T21:32:55.573

[PostNcDestroy()](http://msdn.microsoft.com/en-us/library/sk933a19.aspx)是您正在寻找的。

顺便说一句，如果您正在实现一个无模式对话框并且正在寻找“删除它”的位置，那么 PostNcDestroy() 就是该位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T03:09:22.690

这个答案描述了我最终如何解决我的问题。我会注意到，虽然 John Dibling 的回答很有帮助，但这并不是我问题的最终解决方案。这是因为 WM_NC_DESTROY 消息作为最终消息发送到窗口，但这可以在窗口的最后一条消息完成处理之前处理。有关问题的解释，请参见例如[http://support.microsoft.com/?kbid=202110](http://support.microsoft.com/?kbid=202110)。

1.  DialogProc() 使用 WM_CLOSE 调用。
2.  ProcessWindowMessage() 调用您的 WM_CLOSE 处理程序。
3.  在您的 WM_CLOSE 处理程序中，您调用 DestroyWindow()。
4.  这最终使用 WM_NCDESTROY 再次调用 DialogProc。
5.  ProcessWindowMessage() 调用您的 WM_NCDESTROY 处理程序。
6.  您在 WM_NCDESTROY 处理程序中调用“删除这个”。

调用 后`delete this`，对象不再有效，但从技术上讲，您仍处于`WM_CLOSE`处理程序中，因此当您最终回到那里时，您可能会崩溃。这意味着假设您可以在 PostNcDestroy 中执行此操作并不安全`delete this`，因为该对象可能仍然存在于其他一些堆栈帧中。

```
/// 
/// A window designed to allow any window to use the "OnFinalMessage" method from the ATL CWindow class
/// You must call SubclassWindow for this instance so that the window procedure runs
template<class T>
class FinalMessageWindow : public CWindowImpl<FinalMessageWindow<T> >
{
    T *_t; /// The object wanting to receive the final message notification
public:
    BEGIN_MSG_MAP(FinalMessageWindow<T>)
    END_MSG_MAP()

    /// 
    /// The constructor
    /// \param t The object that wants to get the OnFinalMessage notification
    FinalMessageWindow(T *t)
        : _t(t)
    {
    }

    /// 
    /// Called when the final window message for the window has been processed - this is often a good time to delete the object
    /// \param hWnd The window handle
    virtual void OnFinalMessage(HWND hWnd)
    {
        _t->OnFinalMessage(hWnd);
    }
}; 
```

我创建了上面的类，注意它是从 ATL CWindow 类派生的——这允许我为这个类使用 OnFinalMessage 处理程序。OnFinalMessage 处理程序与 MFC 窗口中的 PostNcDestroy 不同，它保证仅在堆栈上的最终消息处理程序完成后才被调用。

然后我们使用窗口子类来插入这个窗口作为我自己的窗口的窗口过程：

```
// roughly speaking
FinalMessageWindow<MyWindow> _finalMessageWindow(this);
finalMessageWindow.SubclassWindow(m_hWnd); 
```

然后我们为我们的窗口实现 OnFinalMessage 处理程序：

```
void MyWindow::OnFinalMessage(HWND hWnd)
{
    delete this;
} 
```

# xcode - 为什么 Xcode 不能识别我的 LIBRARY_SEARCH_PATHS？

> ID：758154
> 
> 赞同：4
> 
> 时间：2009-04-16T21:34:58.220
> 
> 标签：xcode, linker, environment-variables, cmake

我已经设置`LIBRARY_SEARCH_PATHS`为`/opt/local/lib`，并验证了有问题的库在那里（我正在链接到`GLEW`）：

```
$ls /opt/local/lib

libGLEW.1.5.1.dylib libfreetype.a       libz.a
libGLEW.1.5.dylib   libfreetype.dylib   libz.dylib
libGLEW.a       libfreetype.la      pkgconfig
libGLEW.dylib       libz.1.2.3.dylib
libfreetype.6.dylib libz.1.dylib 
```

但是 Xcode 给了我链接器错误

```
library not found for -lGLEW 
```

我正在使用 CMake 生成 Xcode 项目，因此我不想明确修改 Xcode 项目（如果有人建议将其添加为框架或类似的东西）。Xcode 识别`USER_HEADER_SEARCH_PATHS`良好（如在[这个问题](https://stackoverflow.com/questions/749027/how-to-add-a-global-include-path-for-xcode)中）；为什么它在这里不起作用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T22:05:56.460

也许在您的 CMakeLists.txt 中添加类似的内容？

```
find_library(GLEW_LIB GLEW /opt/local/lib)
if(NOT ${GLEW_LIB})
  message(FATAL_ERROR "Could not find GLEW")
endif()
target_link_libraries(myprogram ${GLEW_LIB} ...) 
```

其中 myprogram 是需要与库链接的目标可执行文件的名称。您可以将 ... 替换为您在该可执行文件上使用的其他库。

这样 CMake 将为您处理库路径详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T21:48:09.013

Xcode 可能适用于多个 SDK，因此每当您定义这些类型的东西（如 HEADER_SEARCH_PATHS 或 LIBRARY_SEARCH_PATHS）时，当前的 SDK 根目录都会添加到传递给链接器的实际路径之前。

因此，完成这项工作的一种方法是将您的目录添加到 SDK。例如，假设您使用 Mac OS X 10.5 sdk 构建，您可以添加您的 opt 目录：

```
ln -s /opt /Developer/SDKs/MacOSX10.5.sdk/opt 
```

您的库现在可以在您的系统上找到。

如果您不想这样做，那么您将不得不查看 CMake 并了解如何让它为您的实际库生成库要求（我对 CMake 一无所知，所以我无能为力你在那里）。这也是为什么您在另一个问题中看到 USER_HEADER_SEARCH_PATHS 和 HEADER_SEARCH_PATHS 之间存在差异的原因。

作为另一种选择，您还可以使用 OTHER_LDFLAGS 构建变量指定此路径：

```
OTHER_LDFLAGS=-L/opt/local/lib 
```

这将导致链接器搜索 /opt/local/lib 及其标准路径，并且不需要您生成不同的项目文件。

# database - Tracing Designs - Screen to Database Traceability

> ID：758155
> 
> 赞同：1
> 
> 时间：2009-04-16T21:35:06.080
> 
> 标签：database, user-interface, uml, modeling

This is vaguely related to:

[Should I design the application or model (database) first?](https://stackoverflow.com/questions/329160/should-i-design-the-application-or-model-database-first)

[Design from the database first through to UI or t’other way round?](https://stackoverflow.com/questions/429905/design-from-the-database-first-through-to-ui-or-tother-way-round)

But my question is more about modeling and artifacts and less about the right way to do design. I'm trying to figure out what sort of design artifact would best enunciate the link between features (use cases), screens and database elements (tables and columns, most particularly). UML is very code-centric. Database models are very database centric. And of screen designs are UI centric!

Here's the deal... my team is working on the first release of the product. We used use cases, then did screen designs and database design was somewhat isolated from the two. A critical area for bugs was the lack of traceability between the use cases and their accompanying screens and the database. In our product, there's a very high degree of overlap between use cases and database elements. Many use cases touch over 75% of the database infrastructure. So we have high contention over database design areas, and it's easy for a small database change to disrupt the lower levels of business logic.

For our next release, I want the developers and our DBA to have a really clear insight into what parts of the database each feature touches. The use case/screen design approach worked well, so we're keeping it... the trick is linking each use case and screens to the database model so the relationships are really obvious and hard to forget about.

On smaller projects (we're only 10 people, but often I've worked on teams of 3 or less), I've created my own custom diagrams to show this part of the design. Sort of a fusion of screen, UML and database table, done in Visio with no link to actual code or SQL. I'm not sure it will work for a larger team, as its highly manual to keep up to date, and it doesn't auto generate code the way our database modeling tool does.

Any recommendations? Is there a commonly accepted mechanism for this?

FYI - we're pretty waterfall, that isn't going to change any time soon. And we do love artifacts... Saying "switch to agile" is not a viable solution for our group.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T23:05:51.993

我无法从您的问题中看出您的用例有多详细。我的印象是它们可能是高级用例，没有分解为详细的用例（可能通过*包含*或*扩展*关系。

无论如何，我更喜欢从需求开始，并将它们跟踪到用例。在编写用例和用例图的同时，我也在创建域模型（高级类图）。这主要是为了给我一些与利益相关者讨论的东西（“我做对了吗？”）。

完成用例和领域模型后，可以开始进行屏幕设计，如果屏幕之间存在复杂的交互，也可能开始设计活动模型。我会将屏幕视为具有 UI 的类 - 屏幕可能具有 FirstName 属性，我注意到它与我的域模型中 Person 实体的 FirstName 属性相关。然而，FirstName 属性可能在该屏幕上表示为文本框。

同时，可以进行物理数据库设计。这将产生一个类或 ER 图，可追溯回域模型。最终，您可能会发现您的某些屏幕属性或活动建模引用了属于物理数据库模型的一部分而在域模型中不存在的事物。可以将屏幕“PersonalName”属性与 People 模式中 Person 表中计算的 PersonalName 列相关联。

我用于这类事情的工具是[Sparx Enterprise Architect](http://www.sparxsystems.com/)。这是一个很棒的工具，甚至可以在专业版中完成所有这些以及更多工作。

说实话，我还不得不说，我主要是自己建模——我还没有参与过一个模型、代码和数据库由不同的人开发的项目。如果有人告诉我上述内容在“现实生活”中行不通，我可能会被迫相信他们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-24T22:51:36.377

我不确定我是否清楚地理解了你的问题，但我会尝试根据一些合理的假设做出回应......

本质上，我的建议与**John Saunders**已经建议的相同：考虑使用 UML 以及一个好的 UML 工具。但我想补充几点在您的具体情况下可能很重要。

首先，我不认为UML“过于以代码为中心”。相反，它可以用来对软件系统的几乎任何方面进行建模，几乎可以在任何抽象级别进行建模。借助手头的好工具（如 Sparx EA），UML 的美妙之处在于您实际上确实获得了一个明确定义的模型（而不仅仅是一组未连接的绘图/图表）。结果，即使该工具本身没有为您提供您正在寻找的功能（例如从数据库到用例的可追溯性）......好吧，至少您可以选择自动化（或至少半自动化）自己的任务：例如，您可以将您的 UML 模型导出到 XMI（标准！），然后从那里导出您需要的任何可追溯性相关信息（例如，使用 XSL 或任何支持 XML 的库，用于您最喜欢的编程/脚本语言） .

顺便说一句，说到 Sparx EA……我还不知道它的所有功能，但它有这么多，如果它允许你选择一个类（甚至是一个类的属性）并显示，我不会感到惊讶您以某种方式依赖于它的其他模型元素。你可能想看看这个。

说了这么多，我确实理解您可能对 UML 至少有以下两个重要的担忧：

1.  似乎需要太多的建模细节才能获得您想要的东西。
2.  作为任何“通用工具”，它可能大大不如您已经使用的专业建模工具。

关于问题 #1：同样，手头有一个好的 UML 工具，你可以做尽可能多的快捷方式。例如，您可以只关注用例中涉及的类，而不是为用例构建一个非常详细和准确的活动模型（足以使跟踪类回到用例）。当然，这同样适用于 UI。

关于问题 #2：我不知道您现在使用什么工具来建模用例、UI 和 DB 模式。因此，从理论上讲，它们可能都比 UML 优越，以至于您不想放弃它们中的任何一个来换取更容易的可追溯性。但是，有些事情告诉我，您的数据库建模工具（具有代码生成功能）可能是唯一真正不可或缺的工具。如果是这种情况，那么我仍然建议考虑使用 UML：您只是不要建模到 DB 模式级别并在域模型级别“停止”（即使您的应用程序中没有它！）。那时，UML 工具将为您提供从域模型元素（实体、它们的属性和它们的关系）到用例和 UI 元素的可追溯性，域模型和数据库模式之间的映射可能会“悬而未决”，因为在绝大多数情况下，它们应该足够简单，无需绘制任何东西即可跟踪。这可能不会给你 100% 的你想要的东西，但它可以给你 80% 的东西，足以缓解你的大多数问题。

底线：如果您使用三种不同的工具/技术来对系统的三个不同方面进行建模……那么，很明显，这三个方面之间的任何可追溯性仍然受这三个工具的支配：您只能自动化这些工具允许（这可能意味着您将被困在大量繁重的手动任务中）。到今天为止，UML 似乎是唯一一个定义明确且得到广泛支持的“通用语言”，它可以帮助您连接您的模型，并可以使您的大部分分析活动实现自动化。只需确保将 UML“绘图工具”（如大多数 Visio 插件和模板）与真正的 UML 建模工具（如 Sparx EA 和其他一堆）区分开来。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T22:17:48.180

您的用例是一个很好的起点。

*   将您的用例转换为可执行的测试代码。此测试代码需要验证结果返回值是否符合您的用例要求。

*   您可以识别和测试的工作部分越小，您构建应用程序的能力就越强。

*   这意味着您的用例与大部分数据库和 GUI 的交互将更容易理解。

通过对不同层进行完整的前期设计，很难锁定复杂项目中的架构或业务逻辑相互作用。只有当您达到实施要求时，才能真正了解什么能够满足您的要求。

作为开发人员，请找到可以帮助您以最佳方式完成工作的技术、工具和流程。不要根据它们的来源来判断这些。判断他们在使您成为可能的最佳开发人员方面的价值。

敏捷世界中的一些项目无疑对我的工作质量和生产力产生了很大影响。这不需要扔掉苹果车，也不需要让经验丰富的瀑布团队陷入混乱。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-16T22:30:29.270

数据库应该为您的问题域建模。它应该对它进行足够完整的建模，以便您可以从中提取解决方案——真理。糟糕的设计本质上是对数据库“撒谎”（允许无效数据或关系的可能性），当您对数据库“撒谎”时，当您向它提问时，它也会对您“撒谎”。

简单的示例是建模多对多关系，其中关系只能是一对多，或者假设值不能为空，或者将外键视为属性。其中许多可以通过适当的规范化来避免，这需要您明确找出什么是密钥，什么不是。

通过在模型中“使非法状态不可表示”，您可以避免编写“防御性”代码来检查不可能或验证关系是否可能，因为由于表结构或声明性检查约束，不可能的事情变得不可表示。

这降低了编写代码的成本，因为您可以将大部分精力集中在需要做的事情上，而不是防范不可能的事情。

# .net - Receiving/Processing emails from .NET

> ID：758162
> 
> 赞同：1
> 
> 时间：2009-04-16T21:40:06.787
> 
> 标签：.net, email, pop3

I am working on a project to retrieve emails from a POP3 mailbox and save those to a database. I would like to find a way I can link original messages to replies so I can relationally show them as a chain. I was going to use subject lines those aren't going to be very reliable as they have the ability to change. Is there anything below the hood that I can use to link a reply message to an original message?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T21:47:30.217

可能有办法。许多 SMTP 服务器在消息中包含两个标头：

*   **Message-ID** : 当前消息的唯一 ID
*   **In-Reply-To**：当前消息正在回复的消息 ID。

您可以按照**In-Reply-To**标识符链返回到原始消息以找到整个电子邮件线程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T21:50:44.827

恐怕主题行是唯一通用的方式。看看GMail，他们就是这样做的，如果主题相同，它可能会被骗成线程不相关的项目。

我认为从 Exchange 发送的电子邮件具有某种线程 ID，但这仅适用于运行 Exchange 的组织内部，并且我怀疑如果邮件来自组织外部，则它是不可靠的。

您可以尝试使用主题进行线程化，并应用一些启发式方法来分隔不相关的项目（例如，具有完全不同收件人的电子邮件将不相关）。但这并不是万无一失的。

# coordinate-systems - 坐标变换（LL + 高程到 WGS84）

> ID：758165
> 
> 赞同：1
> 
> 时间：2009-04-16T21:40:23.370
> 
> 标签：coordinate-systems, wgs84

我目前正在从事一个 3D 可视化项目，我遇到了一个问题，我注意到我们一直在以一种骇人听闻的方式进行操作。

我对 WGS84 系统本身并不太熟悉，我想知道是否有一种“正确”的方法可以将 LL 点转换为 WGS 坐标，给定地球轨道上方的特定高程值。

我们现在的做法是进行通常的从 LL 到 WGS84 的转换，然后取其单位向量，并将其乘以高程和地球半径之和。这似乎不是最有效的方法，我想知道是否有更可接受的方式来进行这种转换。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T01:07:21.797

许多投影库，如[Proj.4](http://trac.osgeo.org/proj/)和使用它的库（如[GDAL/OGR](http://gdal.org/)）将允许您指定高程。

[EPSG](http://www.epsg.org/)项目有一个数据库，其中列出了实现这一点的“正确”方式，几乎适用于所有的投影，包括地理和投影坐标系中的 WGS84。它是一个免费提供的数据库（虽然是 MS Access 格式）。

# c# - Creating string permutations

> ID：758176
> 
> 赞同：-1
> 
> 时间：2009-04-16T21:44:08.603
> 
> 标签：c#, .net, permutation

Why doesn't this produce the correct number of string permutations? For

```
perm("ABC", 3) 
```

it should print 27 different permutations.

```
private static List<string> permutated = new List<string>(30000);

public static List<string> perm(string s, int k) { return comb(s, "", k); }

private static List<string> perm(string s, string prefix, int k)
{
    if (k == 0)
    {
        permutated.Add(prefix);
    }
    else 
    {
        for (int i = 0; i < s.Length; i++)
        {
            perm( s.Substring( i + 1 ), prefix + s[i], k - 1 );
        }
    }
    return permutated;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T22:03:43.003

您已经在程序中计算[组合](http://en.wikipedia.org/wiki/Combination)。因为`comb("ABC", 3)`应该有一个结果。

如果您想要[置换](http://en.wikipedia.org/wiki/Permutation)（六个结果），`s.Substring( i + 1 )`请在递归函数调用中替换为`s.Substring(0, i) + s.Substring(i+1)`.

如果您想要 27 个结果，只需传递`s`而不是`s.Substring( i + 1 )`.

# html - Best practice: setting HTML classes in a webapp

> ID：758177
> 
> 赞同：2
> 
> 时间：2009-04-16T21:44:35.810
> 
> 标签：html, ruby-on-rails, coding-style, haml

In every webapp I build, I come across this issue. I want to set classes on HTML elements conditionally. For example, sometimes the `<div>` for a post looks like:

```
<div class="post">...</div> 
```

And sometimes it looks like this:

```
<div class="post even recent replied_to author_is_admin">...</div> 
```

Each class after `post` is there because some logic decided it should be. What is the best way to this? In Rails+HAML, I've been guilty of doing stuff like:

```
-classes = []
-classes << cycle('even', 'odd')
-classes << 'recent' if post.recent?
-classes << 'replied_to' if post.replied_to?
-classes << 'author_is_admin' if post.author_is_admin?
.post{:class => classes.join(' ')}
    ... 
```

It's not pretty, and I've shortened it to use a helper so I can do this:

```
.post{:class => "#{cycle('even', 'odd')} #{post_classes}"} 
```

It still seems like it should be easier to read, because it's something we do all the time. Does you have any methods by which you make this process short and readable?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T22:21:56.173

我认为你所做的很好。我只会建议一些小的改进。一种是将循环调用放在 post_classes 中。为了可读性，我会让 post_classes 接受 Post 参数。这会产生一些冗余，但您可以通过定义此辅助方法轻松避免它：

```
def classes(object)
  case object
  when Post then post_classes(object)
  end
end 
```

这样，您的模板代码将如下所示：

```
.post{:class => classes(Post)} 
```

# c++ - 使用 WinDbg 进行调试时如何检查字符串中是否存在 NULL 字符

> ID：758182
> 
> 赞同：1
> 
> 时间：2009-04-16T21:46:11.030
> 
> 标签：c++, winapi, windbg

**例如：**

```
0:000> ?? testFile //check this variable
char * 0x009c6758
 "e:\TEST\example.FOO" 
```

**问题：**

*   如何在上面检查以**NULL 结尾的字符**？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T21:52:57.787

它显然在那里，因为您看到的是一个有效的字符串，而不是之后的几个垃圾字符。

db poi（测试文件）

将字符串中的原始字节转储到控制台，您将能够在末尾看到一个 0 字节。您还可以使用内存窗口查看字符串末尾的零字节。

# sql - 如何从T-SQL中的排序表中从第M行开始获取N行

> ID：758186
> 
> 赞同：65
> 
> 时间：2009-04-16T21:48:49.387
> 
> 标签：sql, tsql

有一种简单的方法可以从任何表中获取前 N 行：

```
SELECT TOP 10 * FROM MyTable ORDER BY MyColumn 
```

是否有任何有效的方法来查询从第 N 行开始的 M 行

例如，

```
Id Value
1    a
2    b
3    c
4    d
5    e
6    f 
```

像这样查询

```
SELECT [3,2] * FROM MyTable ORDER BY MyColumn /* hypothetical syntax */ 
```

从第 3 行开始查询 2 行，即返回第 3 行和第 4 行。

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-04-16T21:55:46.967

> **更新**如果您使用的是 SQL 2012，则添加了新语法以使这变得非常容易。请参阅[使用此查询实现分页（跳过/获取）功能](https://stackoverflow.com/questions/13220743/implement-paging-skip-take-functionality-with-this-query)

我想最优雅的是使用 ROW_NUMBER 函数（可从 MS SQL Server 2005 获得）：

```
WITH NumberedMyTable AS
(
    SELECT
        Id,
        Value,
        ROW_NUMBER() OVER (ORDER BY Id) AS RowNumber
    FROM
        MyTable
)
SELECT
    Id,
    Value
FROM
    NumberedMyTable
WHERE
    RowNumber BETWEEN @From AND @To 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2014-09-24T20:16:27.373

该线程和网络上其他地方的建议的问题在于，所有建议的解决方案都在相对于记录数量的线性时间内运行。例如，考虑如下查询。

```
select *
from
(
    select
        Row_Number() over (order by ClusteredIndexField) as RowNumber,
        *
    from MyTable
) as PagedTable
where RowNumber between @LowestRowNumber and @HighestRowNumber; 
```

获取第 1 页时，查询需要 0.577 秒。但是，在获取第 15,619 页时，同样的查询需要 2 分 55 秒。

我们可以通过创建记录号、索引跨表来大大改善这一点，如下面的查询所示。交叉表称为 PagedTable 并且是非持久的。

```
select *
from
(
    select
        Row_Number() over (order by Field1 asc, Field2 asc, Field3 asc) as RowNumber,
        ClusteredIndexField
    from MyTable
) as PagedTable
left join MyTable on MyTable.ClusteredIndexField = PagedTable.ClusteredIndexField
where RowNumber between @LowestRowNumber and @HighestRowNumber; 
```

与前面的示例一样，我在一个包含 780,928 条记录的非常宽的表上进行了测试。我使用的页面大小为 50，结果为 15,619 页。

第 1 页（第一页）的总时间为 0.413 秒。第 15,619 页（最后一页）所用的总时间为 0.987 秒，仅为第 1 页的两倍。这些时间是使用 SQL Server Profiler 测量的，DBMS 是 SQL Server 2008 R2。

当您按索引对表进行排序时，此解决方案适用于任何情况。索引不必是聚集的或简单的。在我的例子中，索引由三个字段组成：varchar(50) asc、varchar(15) asc、numeric(19,0) asc。尽管索引繁琐，但性能仍然非常出色，这进一步证明了这种方法是有效的。

但是，Row_Number 窗口函数中的 order by 子句对应一个索引至关重要。否则性能将下降到与第一个示例相同的水平。

这种方法仍然需要线性操作来生成非持久交叉表，但由于这只是一个添加了行号的索引，所以它发生得非常快。在我的情况下，它花了 0.347 秒，但我的情况有需要复制的 varchars。单个数字索引将花费更少的时间。

出于所有实际目的，这种设计将服务器端分页的缩放从线性操作减少到对数操作，从而允许对大型表进行缩放。以下是完整的解决方案。

```
-- For a sproc, make these your input parameters
declare
    @PageSize int = 50,
    @Page int = 15619;

-- For a sproc, make these your output parameters
declare @RecordCount int = (select count(*) from MyTable);
declare @PageCount int = ceiling(convert(float, @RecordCount) / @PageSize);
declare @Offset int = (@Page - 1) * @PageSize;
declare @LowestRowNumber int = @Offset;
declare @HighestRowNumber int = @Offset + @PageSize - 1;

select
    @RecordCount as RecordCount,
    @PageCount as PageCount,
    @Offset as Offset,
    @LowestRowNumber as LowestRowNumber,
    @HighestRowNumber as HighestRowNumber;

select *
from
(
    select
        Row_Number() over (order by Field1 asc, Field2 asc, Field3 asc) as RowNumber,
        ClusteredIndexField
    from MyTable
) as PagedTable
left join MyTable on MyTable.ClusteredIndexField = PagedTable.ClusteredIndexField
where RowNumber between @LowestRowNumber and @HighestRowNumber; 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2015-09-15T21:42:22.080

在**SQL 2012**中，您可以使用`OFFSET`and `FETCH`：

```
SELECT *
FROM MyTable
ORDER BY MyColumn
OFFSET @N ROWS
FETCH NEXT @M ROWS ONLY; 
```

* * *

我个人更喜欢：

```
DECLARE @CurrentSetNumber int = 0;
DECLARE @NumRowsInSet int = 2;

SELECT *
FROM MyTable
ORDER BY MyColumn
OFFSET @NumRowsInSet * @CurrentSetNumber ROWS
FETCH NEXT @NumRowsInSet ROWS ONLY;

SET @CurrentSetNumber = @CurrentSetNumber + 1; 
```

其中`@NumRowsInSet`是您要返回的行`@CurrentSetNumber`数，是`@NumRowsInSet`要跳过的行数。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-03-02T12:15:58.477

如果要从第 25 条记录中选择 100 条记录：

```
select TOP 100 * from TableName
where PrimaryKeyField 
   NOT IN(Select TOP 24 PrimaryKeyField from TableName); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-16T21:51:40.190

丑陋，骇人听闻，但应该可以工作：

```
select top(M + N - 1) * from TableName
except
select top(N - 1) * from TableName 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-05-01T10:42:14.053

```
 -- *some* implementations may support this syntax (mysql?)
SELECT Id,Value
FROM xxx
ORDER BY Id
LIMIT 2 , 0
   ;

        -- Separate LIMIT, OFFSET
SELECT Id,Value
FROM xxx
ORDER BY Id
LIMIT 2 OFFSET 2
   ;

        -- SQL-2008 syntax
SELECT Id,Value
FROM xxx
ORDER BY Id
OFFSET 4
FETCH NEXT 2 ROWS ONLY
  ; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-10-25T15:28:54.810

可能对小结果有好处，适用于所有版本的 TSQL：

```
SELECT 
        * 
FROM
     (SELECT TOP (N) * 
      FROM 
            (SELECT TOP (M + N - 1) 
             FROM 
                   Table
             ORDER BY 
                      MyColumn) qasc
      ORDER BY 
               MyColumn DESC) qdesc
 ORDER BY 
         MyColumn 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-16T21:56:14.393

```
@start = 3
@records = 2

Select ID, Value 
From
(SELECT ROW_NUMBER() OVER(ORDER BY ID) AS RowNum, ID,Value 
From MyTable) as sub
Where sub.RowNum between @start and @start+@records 
```

这是一种方式。如果您使用 google SQL Paging，还有很多其他的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-09-19T14:24:59.527

为了在 SQL Server 中执行此操作，您必须按列对查询进行排序，以便您可以指定所需的行。

执行此操作时不能使用“TOP”关键字，必须使用偏移 N 行获取下 M 行。

例子：

```
select * from table order by [some_column] 
offset 10 rows
FETCH NEXT 10 rows only 
```

您可以在此处了解更多信息： [https ://technet.microsoft.com/pt-br/library/gg699618%28v=sql.110%29.aspx](https://technet.microsoft.com/pt-br/library/gg699618%28v=sql.110%29.aspx)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-04-14T12:36:41.757

这个线程很老了，但目前你可以这样做：更清洁恕我直言

```
SELECT *
FROM Sales.SalesOrderDetail
ORDER BY SalesOrderDetailID
OFFSET 20 ROWS
FETCH NEXT 10 ROWS ONLY;
GO 
```

来源：http: [//blog.sqlauthority.com/2013/12/30/sql-server-mysql-limit-and-offset-skip-and-return-only-next-few-rows-paging-solution/](http://blog.sqlauthority.com/2013/12/30/sql-server-mysql-limit-and-offset-skip-and-return-only-next-few-rows-paging-solution/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-08-08T15:18:36.820

以下是简单查询将列出表的第 M+1 行中的 N 行。用您喜欢的数字替换 M 和 N。

```
Select Top N B.PrimaryKeyColumn from 
    (SELECT 
        top M PrimaryKeyColumn
     FROM 
        MyTable
) A right outer join MyTable B 
on 
    A.PrimaryKeyColumn = B.PrimaryKeyColumn
where 
    A.PrimaryKeyColumn IS NULL 
```

请让我知道这是否对您的情况有用。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-05-01T09:54:28.307

这就是在*没有*主键的表上实现相同目标的方法：

```
select * from
(
    select row_number() over(order by (select 0)) rowNum,*
    from your_table
) tmp
where tmp.rowNum between 20 and 30 -- any numbers you need 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-05-12T21:35:41.157

我在这里阅读了所有回复，最后想出了一个简单的可用解决方案。性能问题来自 BETWEEN 语句，而不是行号本身的生成。所以我使用一种算法通过传递页码和记录数来进行动态分页。

传递不是起始行和行数，而是“每页行数 (500)”和“页码 (4)”，即第 1501 - 2000 行。这些值可以用存储过程变量替换，所以你不是锁定使用特定的寻呼量。

```
select * from (
    select
        (((ROW_NUMBER() OVER(ORDER BY MyField) - 1) / 500) + 1) AS PageNum
        , *
    from MyTable
) as PagedTable
where PageNum = 4; 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-16T21:56:28.010

查找第 N 行的 id 然后获取 id 大于或等于该 id 的前 M 行

```
将@N 声明为 int
设置@N = 2
将 @M 声明为 int
设置@M = 3

将@Nid 声明为 int

设置@Nid = max(id)
从
  （选择顶部@N *
从我的表
按 id 排序）

选择顶部@M *
从我的表
其中 id >= @Nid
按编号订购

```

类似的东西......但我在这里做了一些假设（例如你想按id订购）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-16T21:57:16.917

有一个非常直接的方法`T-SQL`，虽然我不确定如果你跳过大量行，它是否是有效的。

```
SELECT TOP numberYouWantToTake 
    [yourColumns...] 
FROM yourTable 
WHERE yourIDColumn NOT IN (
    SELECT TOP numberYouWantToSkip 
        yourIDColumn 
    FROM yourTable 
    ORDER BY yourOrderColumn
)
ORDER BY yourOrderColumn 
```

如果您使用的是 .Net，则可以在例如 IEnumerable 上使用以下数据结果：

```
IEnumerable<yourDataType> yourSelectedData = yourDataInAnIEnumerable.Skip(nubmerYouWantToSkip).Take(numberYouWantToTake); 
```

这背后是您从数据存储中获取所有数据。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-16T21:57:20.223

为什么不做两个查询：

```
select top(M+N-1) * from table into temp tmp_final with no log;
select top(N-1) * from tmp_final order by id desc; 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-08-12T20:11:56.987

```
SELECT * FROM (
  SELECT
    Row_Number() Over (Order by (Select 1)) as RawKey,
    * 
  FROM [Alzh].[dbo].[DM_THD_TRANS_FY14]
) AS foo
WHERE RawKey between 17210400 and 17210500 
```

# python - Python模块的问题

> ID：758187
> 
> 赞同：3
> 
> 时间：2009-04-16T21:48:49.467
> 
> 标签：python, django, dreamhost

我正在将我的第一个 Django 应用程序上传到我的 Dreamhost 服务器。我的应用程序使用[xlwt](http://pypi.python.org/pypi/xlwt)包，由于我无法将其安装在默认位置（ /usr/lib/python2.3/site-packages/xlwt ），因此我通过以下方式将其安装在另一个位置：

```
python setup.py install --home=$HOME 
```

然后在这里安装 xlwt：

```
/home/myuser/lib/python/xlwt/ 
```

之后，我将此文件夹添加到 de env var PYTHONPATH

```
export PYTHONPATH=$PYTHONPATH:/home/myuser/lib/python 
```

...在python promt中我可以做到这一点（没有问题）

```
import xlwt 
```

...但是如果我在我的应用程序代码中做同样的事情，我有以下错误：

```
Could not import ISI.restaurante.views. Error was: No module named xlwt 
```

[其中 ISI.restaurante.views 是我进行导入的代码]

你能帮我吗？谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T21:52:40.890

PYTHONPATH 只能在您从 shell 运行时设置，您可以使用 python 以编程方式设置路径

```
import sys
sys.path.append('/home/myuser/lib/python') 
```

# python - 使python文件中的函数定义独立于顺序

> ID：758188
> 
> 赞同：64
> 
> 时间：2009-04-16T21:48:53.803
> 
> 标签：python

我使用 Python CGI。我不能在定义之前调用一个函数。

在 Oracle PL/SQL 中有一个“前向声明”的技巧：将所有函数命名在顶部，这样定义的顺序就无关紧要了。

Python中也有这样的技巧吗？

例子：

```
def do_something(ds_parameter):
    helper_function(ds_parameter)
    ....

def helper_function(hf_parameter):
    ....

def main():
    do_something(my_value)

main() 
```

大卫是对的，我的例子是错误的。关于什么：

```
<start of cgi-script>

def do_something(ds_parameter):
    helper_function(ds_parameter) 
    .... 

def print_something(): 
    do_something(my_value) 

print_something() 

def helper_function(hf_parameter): 
    .... 

def main()
    ....

main() 
```

我可以“前向声明”脚本顶部的函数吗？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2009-04-16T21:53:03.807

必须在使用任何函数之前定义所有函数。

但是，可以按任何顺序定义函数，只要在任何可执行代码使用函数之前定义所有函数即可。

您不需要“前向声明”，因为所有声明都是完全独立的。只要所有声明都在所有可执行代码之前。

你有问题吗？如果是这样，请发布不起作用的代码。

* * *

在您的示例`print_something()`中，不合适。

规则： **必须在任何真正起作用的代码之前定义所有函数**

因此，将所有有效的语句放在*最后*。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2012-08-10T09:26:29.947

更好地说明您的观点是：

```
def main():
    print_something() 
    ....

def do_something(ds_parameter):
    helper_function(ds_parameter) 
    .... 

def print_something(): 
    do_something(my_value) 

def helper_function(hf_parameter): 
    .... 

main() 
```

换句话说，您可以将您的定义保留`main()`在顶部，以便编辑 - 如果大部分时间都花在编辑 main.js 上，请避免频繁滚动。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-16T22:35:51.847

假设您有一些代码片段在定义后调用您的函数 main ，那么您的示例将按编写方式工作。由于 Python 的解释方式，`do_something`在定义 do_something 函数时，不需要定义由主体调用的任何函数。

Python 在执行代码时将采取的步骤如下。

1.  定义函数 do_something。
2.  定义函数 helper_function。
3.  定义函数 main。
4.  （鉴于我上面的假设）调用 main。
5.  从 main 调用 do_something。
6.  从`do_something`，调用 helper_function。

Python 唯一关心的时间`helper_function`是当它到达第六步时。您应该能够验证 Python 在尝试查找 helper_function 以便调用它时引发错误之前一直执行到第六步。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-17T00:29:44.867

我从来没有遇到过需要“前向功能定义”的情况..你不能简单地移动`print_something()`到你的主要功能内部..吗？

```
def do_something(ds_parameter):
    helper_function(ds_parameter) 
    .... 

def print_something(): 
    do_something(my_value) 

def helper_function(hf_parameter): 
    .... 

def main()
    print_something() 
    ....

main() 
```

Python 不在乎 helper_function() 在第 3 行（在`do_something`函数中）使用后定义

我建议使用[WinPDB 之](http://winpdb.org/)类的东西并单步执行您的代码。它很好地展示了 Python 的解析器/执行器（？）是如何工作的

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-09-29T14:51:31.217

```
def funB(d,c):
   return funA(d,c)

print funB(2,3)

def funA(x,y):
    return x+y 
```

上面的代码将返回错误。但是，下面的代码很好......

```
 def funB(d,c):
     return funA(d,c)

 def funA(x,y):
     return x+y

 print funB(2,3) 
```

因此，即使您必须在任何实际工作完成之前明确定义该函数，如果您不明确使用该函数，也有可能逃脱。我认为这有点类似于其他语言的原型设计......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-10-14T14:27:47.447

对于所有的人，尽管有不好的做法，但他们想要一个解决方法......
我遇到了类似的问题并像这样解决了它：

```
 import Configurations as this
 '''Configurations.py'''
 if __name__ == '__main__':
   this.conf01()

 '''Test conf'''
 def conf01():
   print ("working") 
```

所以我可以在文件顶部更改我的目标配置。诀窍是将文件导入自身。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-07-11T17:59:07.800

**使用多处理模块：**

```
from multiprocessing import Process

p1 = Process(target=function_name, args=(arg1, arg2,))
p1.start() 
```

# java - Java：更快的重载或 if/else

> ID：758199
> 
> 赞同：6
> 
> 时间：2009-04-16T21:54:52.993
> 
> 标签：java, optimization, polymorphism, conditional, overloading

我有子类，每个类与其他成员一起携带不同类型的值。可能有 LongObject、IntObject、StringObject 等。

会给我一个值，可以是long、int、string等，我要分别创建一个LongObject、IntObject、StringObject等。

重载如下所示的方法会更快（a）还是只使用如下所示的 elseif （b）？

这可能不是明显的性能差异。无论如何，重载方法可能以与 if/else 类似的方式实现。我不知道。

我也可以听到你们中的一些人说只是测试它。当然，我应该这样做。如果有人知道的话，我还想知道如何在后台处理这种类型的重载。

请让我知道你的想法。

谢谢，jbu

一个）

```
BaseObject getObject(long l)
{
     return new LongObject(l);
}

BaseObject getObject(int i)
{
     return new IntObject(i);
}

BaseObject getObject(String s)
{
     return new StringObject(s);
}

... 
```

b)

```
BaseObject getObject(Object x)
{
    if(value is a long)
         return new LongObject((Long)x);
    else if(value is an int)
         return new IntObject((Int)x);
    else if(value is a String)
         return new StringObject((String)x);
    ...
} 
```

编辑：我想我没有完全添加所有细节，你们中的一些人抓住了它。对于这两种选择，我仍然必须获取一个对象/值，并根据该值确定它是什么类型。因此，我仍然必须做某种 if/else 才能使用重载方法。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-16T21:57:27.027

这里有一个巨大的差异：重载是在*编译时*选择的，而你的“if（value is a long）”将是一个*执行时*测试。

如果您在编译时知道类型，我强烈建议您使用该信息。如果你不这样做，那么重载选项无论如何都是不可行的。

编辑：评论建议我详细说明在编译时选择的重载。

*编译器根据有关参数的编译时*信息选择调用哪个方法签名。这与*覆盖*不同，其中要使用的方法实现由方法的实际目标的类型确定。

这是一个例子：

```
public class Test
{
    public static void main(String[] args)
    {
        Object x = "I'm a string";
        foo(x);
    }

    public static void foo(String x)
    {
        System.out.println("foo(String)");
    }

    public static void foo(Object x)
    {
        System.out.println("foo(Object)");
    }
} 
```

这`foo(Object)`是因为编译时类型`x`is `Object`， not `String`。`x`引用的对象的执行时类型`String`并不意味着`foo(String)`被调用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T22:01:04.193

重载解决方案更快（更好），因为它是在编译时解决的。

基本上，编译器会在您将值传递给它时确定要调用的方法。当您调用 getObject("abc") 时，编译器将发出对方法的调用：

```
BaseObject getObject(String s)
{
     return new StringObject(s);
} 
```

而不是试图通过你的 if ... else 状态并在运行时评估对象类型（这是一个缓慢的活动）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T22:20:13.430

不用担心，除非条件每秒测试数百万次，否则没关系。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T22:57:40.830

级联条件在 OO 编程中是不好的业力，在测试对象的类型时非常难看。该语言已经为测试之王提供了多态性。

另外，作为一个非 java 的人，我会使用`getLong(l)`, `getInt(i)`, `getString(s)`. 我发现方法重载比不重载更令人困惑（恕我直言，静态类型不应该影响程序执行（除了优化方面（尽管看起来我不是 Lisper :)）））

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T23:18:07.457

最重要的是，getObj(int)、getObj(string) 等 - 如果您尝试传递未预期的内容，则会在编译时失败。

如果您允许将任何对象传递到方法中，您可能会有一个实例，其中应用程序试图传递该方法无法处理的东西，并且您最终会遇到一个丑陋的运行时错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T22:02:31.523

**a)**（重载）会更快，因为它为及时编译器提供了优化的机会。它可以决定内联新对象的创建。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T22:15:58.650

任何时候您必须在运行时评估类型信息，这可能是一个相对较慢的操作。当您有选择时，编写在编译时这样做的代码几乎总是更可取的。

这通常被称为“早期绑定”与“后期绑定”。

# objective-c - 将空格序列折叠成单个字符并修剪字符串

> ID：758212
> 
> 赞同：122
> 
> 时间：2009-04-16T21:59:42.917
> 
> 标签：objective-c, ios, nsstring

考虑以下示例：

```
"    Hello      this  is a   long       string!   " 
```

我想将其转换为：

```
"Hello this is a long string!" 
```

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2009-09-15T13:36:33.820

# OS X 10.7+ 和 iOS 3.2+

使用hfossli 提供的本机正则[表达式解决方案。](https://stackoverflow.com/a/18083852/24587)

# 否则

使用您最喜欢的正则表达式库或使用以下 Cocoa-native 解决方案：

```
NSString *theString = @"    Hello      this  is a   long       string!   ";

NSCharacterSet *whitespaces = [NSCharacterSet whitespaceCharacterSet];
NSPredicate *noEmptyStrings = [NSPredicate predicateWithFormat:@"SELF != ''"];

NSArray *parts = [theString componentsSeparatedByCharactersInSet:whitespaces];
NSArray *filteredArray = [parts filteredArrayUsingPredicate:noEmptyStrings];
theString = [filteredArray componentsJoinedByString:@" "]; 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2013-08-06T15:04:24.620

Regex 和 NSCharacterSet 可以为您提供帮助。此解决方案修剪前导和尾随空格以及多个空格。

```
NSString *original = @"    Hello      this  is a   long       string!   ";

NSString *squashed = [original stringByReplacingOccurrencesOfString:@"[ ]+"
                                                         withString:@" "
                                                            options:NSRegularExpressionSearch
                                                              range:NSMakeRange(0, original.length)];

NSString *final = [squashed stringByTrimmingCharactersInSet:[NSCharacterSet whitespaceAndNewlineCharacterSet]]; 
```

记录`final`给

```
"Hello this is a long string!" 
```

可能的替代正则表达式模式：

*   仅替换空格：`[ ]+`
*   替换空格和制表符：`[ \\t]+`
*   替换空格、制表符和换行符：`\\s+`

[性能概要](https://gist.github.com/hfossli/7039131)

*   此解决方案：7.6 秒
*   [拆分、过滤、加入（Georg Schölly）](https://stackoverflow.com/a/1427224/202451)：13.7 秒

易于扩展、性能、代码行数和创建的对象数量使得该解决方案非常合适。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2009-09-15T13:18:21.860

实际上，有一个非常简单的解决方案：

```
NSString *string = @" spaces in front and at the end ";
NSString *trimmedString = [string stringByTrimmingCharactersInSet:
                                  [NSCharacterSet whitespaceAndNewlineCharacterSet]];
NSLog(@"%@", trimmedString) 
```

（[来源](http://www.drobnik.com/touch/2009/01/remove-whitespace-from-nsstring/)）

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2010-11-04T10:19:35.640

使用正则表达式，但不需要任何外部框架：

```
NSString *theString = @"    Hello      this  is a   long       string!   ";

theString = [theString stringByReplacingOccurrencesOfString:@" +" withString:@" "
                       options:NSRegularExpressionSearch
                       range:NSMakeRange(0, theString.length)]; 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-08-03T08:41:49.447

单线解决方案：

```
NSString *whitespaceString = @" String with whitespaces ";

NSString *trimmedString = [whitespaceString
        stringByReplacingOccurrencesOfString:@" " withString:@""]; 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-16T23:24:33.993

这个应该做...

```
NSString *s = @"this is    a  string    with lots  of     white space";
NSArray *comps = [s componentsSeparatedByCharactersInSet:[NSCharacterSet whitespaceCharacterSet]];

NSMutableArray *words = [NSMutableArray array];
for(NSString *comp in comps) {
  if([comp length] > 1)) {
    [words addObject:comp];
  }
}

NSString *result = [words componentsJoinedByString:@" "]; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-17T04:42:17.833

正则表达式的另一个选项是[RegexKitLite](http://regexkit.sourceforge.net/RegexKitLite/index.html)，它很容易嵌入到 iPhone 项目中：

```
[theString stringByReplacingOccurencesOfRegex:@" +" withString:@" "]; 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-16T22:55:53.063

`NSString`这是扩展程序的一个片段`"self"`，`NSString`实例在哪里。它可用于通过传入`[NSCharacterSet whitespaceAndNewlineCharacterSet]`和传递`' '`给两个参数来将连续的空白折叠成一个空格。

```
- (NSString *) stringCollapsingCharacterSet: (NSCharacterSet *) characterSet toCharacter: (unichar) ch {
int fullLength = [self length];
int length = 0;
unichar *newString = malloc(sizeof(unichar) * (fullLength + 1));

BOOL isInCharset = NO;
for (int i = 0; i < fullLength; i++) {
    unichar thisChar = [self characterAtIndex: i];

    if ([characterSet characterIsMember: thisChar]) {
        isInCharset = YES;
    }
    else {
        if (isInCharset) {
            newString[length++] = ch;
        }

        newString[length++] = thisChar;
        isInCharset = NO;
    }
}

newString[length] = '\0';

NSString *result = [NSString stringWithCharacters: newString length: length];

free(newString);

return result;
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-03-15T07:25:58.390

尝试这个

```
NSString *theString = @"    Hello      this  is a   long       string!   ";

while ([theString rangeOfString:@"  "].location != NSNotFound) {
    theString = [theString stringByReplacingOccurrencesOfString:@"  " withString:@" "];
} 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-16T23:40:51.600

替代解决方案：为自己获取一份 OgreKit（Cocoa 正则表达式库）。

*   [OgreKit](http://www8.ocn.ne.jp/~sonoisa/OgreKit/)（日文网页——代码为英文）
*   [OgreKit](http://translate.google.com.au/translate?u=http%3A%2F%2Fwww8.ocn.ne.jp%2F%7Esonoisa%2FOgreKit%2F&sl=ja&tl=en&hl=en&ie=UTF-8)（谷歌自动翻译）：

那么整个函数是：

```
NSString *theStringTrimmed =
   [theString stringByTrimmingCharactersInSet:
        [NSCharacterSet whitespaceAndNewlineCharacterSet]];
OGRegularExpression  *regex =
    [OGRegularExpression regularExpressionWithString:@"\s+"];
return [regex replaceAllMatchesInString:theStringTrimmed withString:@" "]); 
```

短而甜。

如果您追求最快的解决方案，那么精心构建的一系列指令使用`NSScanner`可能效果最好，但只有在您计划处理大量（数兆字节）文本块时才需要这样做。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2013-07-19T17:55:01.137

以下两个正则表达式将根据要求起作用

1.  @"+" 用于匹配空格和制表符
2.  @"\\s{2,}" 用于匹配空格、制表符和换行符

然后应用 nsstring 的实例方法`stringByReplacingOccurrencesOfString:withString:options:range:`将它们替换为单个空格。

例如

```
[string stringByReplacingOccurrencesOfString:regex withString:@" " options:NSRegularExpressionSearch range:NSMakeRange(0, [string length])]; 
```

注意：我没有为 iOS 5.x 及更高版本的上述功能使用“RegexKitLite”库。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2012-02-02T08:49:09.123

根据@Mathieu Godart 的最佳答案，但缺少某些行，所有答案只会减少单词之间的空间，但是当有制表符或制表符在适当的空间时，如下所示：“这是文本 \t 和 \tTab 之间，以此类推" 在三行代码中，我们将：我们想要减少空格的字符串

```
NSString * str_aLine = @"    this is text \t , and\tTab between      , so on    ";
// replace tabs to space
str_aLine = [str_aLine stringByReplacingOccurrencesOfString:@"\t" withString:@" "];
// reduce spaces to one space
str_aLine = [str_aLine stringByReplacingOccurrencesOfString:@" +" withString:@" "
                                                    options:NSRegularExpressionSearch
                                                      range:NSMakeRange(0, str_aLine.length)];
// trim begin and end from white spaces
str_aLine = [str_aLine stringByTrimmingCharactersInSet:[NSCharacterSet whitespaceAndNewlineCharacterSet]]; 
```

结果是

```
"this is text , and Tab between , so on" 
```

如果不替换选项卡，结果将是：

```
"this is text    , and  Tab between , so on" 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2013-11-17T14:29:41.117

您还可以使用简单的 while 参数。那里没有 RegEx 魔法，所以将来可能更容易理解和改变：

```
while([yourNSStringObject replaceOccurrencesOfString:@"  "
                         withString:@" "
                         options:0
                         range:NSMakeRange(0, [yourNSStringObject length])] > 0); 
```

# php - .htaccess 可选字符？

> ID：758223
> 
> 赞同：2
> 
> 时间：2009-04-16T22:02:54.720
> 
> 标签：php, regex, .htaccess

虽然.htaccess，但我想将/page/var1/var2重定向到./page.php?var1=var1&var2=var2。这很容易，但我想让 /page/var1 也重定向到 ./page.php?var1=var1 （没有 var2）。我这样做的唯一方法是：

```
RewriteRule page/(.*)$ ./page.php?var1=$1
RewriteRule page/(.*)/(.*)$ ./page.php?var1=$1&var2=$2 
```

正如你所看到的，它非常多余，而且我有很多这样的行，所以它变得非常混乱。有什么方法可以定义“可选”部分？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T22:39:30.047

表达式`.*`匹配两者`var1`，`var1/var2`因此第一条规则适用于两者。

所以你必须指定第一条规则只匹配`var1`。这可以通过将`.`（任何字符）替换为（`[^/]`除 之外的任何字符）来完成`/`。所以试试这个：

```
RewriteRule ^page/([^/]+)$ ./page.php?var1=$1
RewriteRule ^page/([^/]+)/([^/]+)$ ./page.php?var1=$1&var2=$2 
```

**编辑**   您也可以在一个规则中写这个：

```
RewriteRule ^page/([^/]+)(/([^/]+))?$ ./page.php?var1=$1&var2=$3 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T22:12:44.773

mod_rewrite 不太适合这种繁重的工作，把它留给你的 PHP 应用程序吧。

```
 RewriteRule page/(.*)$ ./page.php?vars=$1 
```

在 page.php 开头附近的某个地方：

```
 <?php
 $vars = explode('/',$_GET['vars']); 
```

瞧，您有一系列变量；现在您可以在那里进行一些处理，以查看您的应用程序需要/可选的内容并做出相应的反应。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T22:21:34.143

最好的方法是将所有内容都交给您的 PHP 脚本。

我写了一篇关于如何做[友好 URL](http://www.hm2k.com/posts/friendly-urls)的文章，其中更详细地介绍了这一点。

# .net - Asp.Net 2.0 和 Asp.Net 3.5 代码编译模型——有什么不同吗？

> ID：758224
> 
> 赞同：1
> 
> 时间：2009-04-16T22:03:21.613
> 
> 标签：.net, asp.net, visual-studio

我刚开始了解 Asp.Net 3.5 编译模型，但大多数文章主要讨论的是 Asp.Net 2.0 编译模型以及它与以前版本的 ASP.NET 编译模型有何不同。所以我找不到任何文章来解释 ASP.NET 2.0 和 ASP.NET 3.5 编译模型之间是否存在任何差异。因此：

A) CodeBehind、Src、CodeFile 和 Inherits 属性在 ASP.NET 2.0 和 ASP.NET 3.5 中的行为是否完全相同？

B) Asp.Net 2.0 和 Asp.Net 3.5 编译模型有什么不同？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T22:09:26.140

ASP.NET 3.5 中没有重新设计编译系统。它与 2.0 的系统相同。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T22:17:01.270

正如 Mehrdad 所说，在 ASP.NET 2.0 和 3.5 中也是如此。

但是两种 Web 项目类型之间存在差异：**Web Site Project**和**Web Application Project**。[您可以在 MSDN 的此页面](http://msdn.microsoft.com/en-us/library/aa730880%28VS.80%29.aspx#wapp_topic5)上找到更多详细信息，以确定哪个更适合您。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T22:15:32.427

一）是的。

B) 3.5 编译器内置了一些额外的智能来处理诸如扩展方法之类的事情，但是编译 2.0 Web 应用程序和 3.5 Web 应用程序的过程之间没有真正的区别，运行 2.0 网站项目也没有任何区别在 3.5 服务器上 - 如果您查看 IIS，它认为它正在运行的 ASP.NET 版本是 2.0。

# sql-server - TS SQL - 按分钟分组

> ID：758229
> 
> 赞同：18
> 
> 时间：2009-04-16T22:04:59.007
> 
> 标签：sql-server

我有一张带时间戳的表。获取过去一小时每分钟的记录计数的正确查询是什么。

即如果现在是 2:25，我想知道在 1:25 和 1:26、1:26 和 1:27 之间有多少条记录，等等，所以我有 60 个结果。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-16T22:26:38.627

这将返回过去一小时内每分钟（您有记录的地方）的结果计数

```
SELECT DATEPART(n, time_stamp) AS minute, COUNT(*) as results
FROM table_name 
WHERE time_stamp > DATEADD(hh, -1, GETDATE())
GROUP BY DATEPART(n, time_stamp) 
```

这可能会返回少于 60 个结果，具体取决于数据。如果必须有 60 个结果，则查询略有不同。这使用公共表表达式来生成 60 个数字的列表和相关的子查询来获取每分钟的结果：

```
WITH numbers ( num ) AS (
    SELECT 1 UNION ALL
    SELECT 1 + num FROM numbers WHERE num < 60 )
SELECT num AS minute,
    (SELECT COUNT(*) AS results
    FROM table_name
    WHERE DATEPART(n, time_stamp) = num
    AND time_stamp > DATEADD(hh, -1, GETDATE())
FROM numbers 
```

要查看结果，请将 DATEADD(hh, -1, GETDATE()) 替换为 DATEADD(mi, -15, GETDATE()) ，您将获得最后 15 分钟的结果和其他分钟的 0。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2016-05-20T22:44:25.283

这是我发现的一种替代方法，可用于确定每分钟插入或更新多少记录。将日期格式预先设置为变量的好处是，您可以轻松地将其更改为每小时分析一次。希望这可以帮助！

```
DECLARE @dateFormat as varchar(max) = 'yyyy-MM-dd HH:mm'

SELECT format(timeColumn, @dateFormat) AS minute, COUNT(*) as results
FROM yourTable
WHERE timeColumn > DATEADD(hh, -1, GETDATE())
GROUP BY  format(timeColumn, @dateFormat)
ORDER BY 1 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T22:17:06.730

当您编辑问题时，我编辑我的答案。如果我对您的理解正确，您只想查看过去一小时 - 即从发出请求前一小时到当前时间的时间跨度。这就是我的做法：

```
SELECT
    COUNT(yourTimeStamp)
FROM yourTable
WHERE DATEADD('hh', -1, GetDate()) <= yourTimeStamp 
    AND yourTimeStamp < GetDate()
GROUP BY DATEPART('mm', yourTimeStamp) 
```

我不完全确定语法是否准确。在 中编码时`MSSQL`，我会使用`CURRENT_TIMESTAMP`当前时间，`MINUTE`而不是`DATEPART`etc，但您会明白解决方案的想法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T22:24:49.723

DATEPART 是您正在寻找的：

```
declare @times table
(
    someTime datetime
)

INSERT INTO @Times (sometime) values ('jan 12 2008 12:23')
INSERT INTO @Times (sometime) values ('jan 12 2008 12:34')
INSERT INTO @Times (sometime) values ('jan 12 2008 12:35')
INSERT INTO @Times (sometime) values ('jan 12 2008 12:25')
INSERT INTO @Times (sometime) values ('jan 12 2008 12:02')
INSERT INTO @Times (sometime) values ('jan 12 2008 12:09')
INSERT INTO @Times (sometime) values ('jan 12 2008 12:35')

select DATEPART(mi,sometime) AS Minute, count(*) AS NumOccurances
from @Times
WHERE SomeTime BETWEEN @Lower AND @Upper
GROUP BY DATEPART(mi, sometime)
order by NumOccurances DESC 
```

结果：

```
Minute  NumOccurances
35  2
2   1
9   1
23  1
25  1
34  1 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2021-08-11T07:04:21.103

如果要按分钟对结果进行分组，则可以使用格式化字符串。这将按**自 1900 年 1 月 1 日以来的分钟数而**不是*一天内*的分钟数分组。

```
WITH formatted AS (
    SELECT FORMAT(<your_datetime_column>, 'yyyy-MM-dd HH:mm') AS minute_text
    FROM <your_table>
)
SELECT minute_text, COUNT(*) AS number_of_rows
FROM formatted
GROUP BY minute_text
ORDER BY 1 DESC 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-05-06T20:11:42.793

这是我对罗宾答案的固定版本。我让它以正确的顺序输出错误并输出时间，而不是仅仅输出数字，如果你要绘制它的话，这不是超级有用的。

```
WITH numbers ( num ) AS (
    SELECT 1 UNION ALL
    SELECT 1 + num FROM numbers WHERE num < 60 )
SELECT (SELECT DATEADD(n, -num, GETDATE())) AS TimeStamp,
    (SELECT COUNT(*) AS results
    FROM ErrorLogs
    WHERE DATEPART(n, TimeStamp) = DATEPART(n, DATEADD(n, -num, GETDATE()))
    AND TimeStamp > DATEADD(hh, -1, GETDATE())) as Count
FROM numbers 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-16T22:11:41.097

SELECT COUNT (TS) from TABLE where TABLE.TS BETWEEN(starttime, endtime)

# wpf - Winforms 到 WPF 的转换：BeginInvoke 到什么？

> ID：758233
> 
> 赞同：10
> 
> 时间：2009-04-16T22:06:16.757
> 
> 标签：wpf, winforms, delegates, begininvoke

这是我来自 WinForms 的旧代码：

```
 private void ValueChanged(double inValue1, double inValue2) {
        //only manual mode for this driver, so that's easy.
        if (ValueLabel.InvokeRequired) {
            ValueLabel.Invoke(new MethodInvoker(delegate {
                ValueLabel.Text = (inValue1* inValue2/ 1000).ToString("f1");
            }
                ));
        }
        else {
            ValueLabel.Text = (inValue1* inValue2/ 1000).ToString("f1");
        }
    } 
```

有没有一种简单的方法可以将其转换为对 WPF 友好？到目前为止，我有：

```
 private void KVPValueChanged(double inValue1, double inValue2) {
        if (ValueLabel.Dispatcher.Thread == Thread.CurrentThread){
            ValueLabel.Content = (inValue1* inValue2/ 1000).ToString("f1");
        } else {
            ValueLabel.Dispatcher.BeginInvoke(delegate {
                ValueLabel.Content = (inValue1* inValue2/ 1000).ToString("f1");
            });
        }
    } 
```

但是第二个“代表”电话失败了。我怎样才能调用这个委托？我想我可以完成整个制作委托方法，制作委托方法的实例，调用该特定实例等，但我认为这些匿名委托的全部意义在于避免这种麻烦。另外，我的旧 winforms 代码到处都有第一个实现，所以我真的很想避免必须对我的所有代表进行去匿名化。

**编辑：**我可以尝试像以前一样使用 MethodInvoker，但是编译器会感到困惑。MethodInvoker 是 System.Windows.Forms 的一部分，因此使用该方法不起作用。如：

```
 private void ValueChanged(double inValue1, double inValue2) {
        if (ValueLabel.Dispatcher.Thread == Thread.CurrentThread) {
            ValueLabel.Content = (inValue1* inValue2/ 1000).ToString("f1");
        }
        else {
            ValueLabel.Dispatcher.BeginInvoke(new System.Windows.Forms.MethodInvoker(delegate {
                ValueLabel.Content = (inValue1* inValue2/ 1000).ToString("f1");
            }));
        }
    } 
```

MethodInvoker 的使用是不洁的。是否有单独的实现，或其他方式来使用相同的行为？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-17T12:22:14.827

System.Windows.Forms.MethodInvoker 只是一个不带参数并返回 void 的委托。在 WPF 中，您可以将其替换为[System.Action](http://msdn.microsoft.com/en-us/library/system.action.aspx)。还有其他[接受参数](http://msdn.microsoft.com/en-us/library/018hxwa8.aspx)、[返回值](http://msdn.microsoft.com/en-us/library/bb534960.aspx)或[两者](http://msdn.microsoft.com/en-us/library/bb549151.aspx)的内置委托。

在你的情况下，

```
ValueLabel.Dispatcher.BeginInvoke(new System.Windows.Forms.MethodInvoker(delegate {
            ValueLabel.Content = (inValue1* inValue2/ 1000).ToString("f1");
        })); 
```

变成

```
ValueLabel.Dispatcher.BeginInvoke(new Action(delegate() {
            ValueLabel.Content = (inValue1* inValue2/ 1000).ToString("f1");
        })); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T22:43:26.743

我认为您需要更改代表的签名：

```
ValueLabel.Dispatcher.BeginInvoke(DispatcherPriority.Normal, (ThreadStart)delegate(invalue1, invalue2){
    ValueLabel.Content = ... 
```

另外，使用 BackgroundWorker 组件查找。不仅适用于 wpf，还适用于 winform 异步操作。

# subsonic - 我应该如何创建 subsonic 3.0 DB 上下文类？

> ID：758235
> 
> 赞同：1
> 
> 时间：2009-04-16T22:07:13.103
> 
> 标签：subsonic, recursion

我是 SubSonic 的新手（各种风格），但我想我不妨从 3.0 开始，因为我想使用 Linq，而且我的印象是 3.0 离发布不远了。

我尝试了 alpha 下载 .zip，但这似乎很旧，并且没有单数化表类名称，所以我现在从最新的中继 SVN 版本（rev62）运行。

我已经从 SubSonic.Templates\Simple 对我的数据库运行了“简单”模板，一切似乎都很好，但是模板创建的数据库上下文类如下所示：

```
public partial class DB : IQuerySurface
{
    static DB _db;

    public DB() { 
        _db = new DB();
    }

    public static DB CreateDB()
    {
        if (_db == null)
        {
            _db = new DB();
            _db.Init();
        }
        return _db;
    }
    ... etc 
```

不出所料，当我调用 DB.CreateDB 时，ctor 会无休止地递归，并使所有内容因堆栈溢出而崩溃。

我根本不了解 ctor - 它看起来不应该在那里，但是“简单”和“高级”模板都创建了类似的东西，而且我想有一个巨大的测试套件正在验证这一点不知何故。

很明显，我在这里搞错了——我错过了什么明显的点？

**更新：**简单模板和高级模板不相似，高级模板没有这个问题。谢谢您的帮助。

**另一个更新：**看起来这在 SVN r66 的简单模板中已修复

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T22:31:49.550

不知道您是否从 SVN 获得了带有错误的最新位，但我几天前的版本似乎工作正常。这是我的 DB 课程开始的内容：

```
public partial class DB : IQuerySurface
{
    BatchQuery _batch = null;

    public IDataProvider DataProvider;
    public DbQueryProvider provider;

    private IDatabaseSchema _schema;
    public IDatabaseSchema Schema
    {
        get
        {
          return _schema;
        }
    }

    public DB() 
    { 
        DataProvider = ProviderFactory.GetProvider("Northwind");
        Init();

    }

    public DB(string instanceName, string connectStr)
    {
        SubSonic.DataProviders.ConnectionStringProvider.Instance.AddLocalConnectionString(
              instanceName, connectStr, "System.Data.SqlClient");

        DataProvider = ProviderFactory.GetProvider(instanceName);

        Init();

    } 
```

... ETC...

我使用了模板的高级版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T22:38:21.467

我更喜欢 t4 模板，这是那里提供的 ctor：

```
 public DB() 
    { 
        DataProvider = ProviderFactory.GetProvider("Northwind");
        Init();

    } 
```

还有一个接受连接字符串的重载。这对我来说效果很好，我正在使用 linq 支持，它非常​​棒。

# c# - 在没有管理员权限的情况下在 Vista 中自动更新我的 .NET 应用程序

> ID：758237
> 
> 赞同：0
> 
> 时间：2009-04-16T22:09:20.163
> 
> 标签：c#, vb.net, auto-update

我知道有很多关于如何在 .NET 应用程序中实现自动更新的问题，而且我可能已经阅读了其中的大部分。不幸的是，据我所知，我所看到的没有一个非常适合我的情况。

我正在尝试构建一个自我更新的 .NET 应用程序，该应用程序将在用户帐户有限的环境中运行。这里没有管理员权限。该应用程序必须在 Vista 和 XP 上运行，并且可能在 Win 7 上运行。X-copy 部署会很好。我不希望使用点击一次

到目前为止，我已经尝试了一个系统，应用程序检查清单并下载更新的二进制文件，这在开发中效果很好，但在安装应用程序时效果不佳。Vista 拒绝让我将文件复制到 Program Files。之后，我尝试下载更新的 .msi，除了 MSI 有 UAC 提示之外，它可以工作——如果用户没有具有本地管理员权限的帐户，则不行。

一些帖子建议在 AppData 中运行程序并使用 x-copy 方法可能有效，但我没有看到有人说他们已经尝试过并且确实有效。这适用于没有管理员权限的帐户吗？在我开始编写更多代码之前，谁能保证这种方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T22:28:43.410

您只需要确保您正在“安装”（即复制到）非特权用户可以访问的位置。

Program Files 没有什么神奇之处，只是非特权用户无法写入（默认情况下）。

如果您有管理员进行初始安装，那么您可以更改程序文件文件夹的权限，以便后续升级可以覆盖这些文件。但这并不真正符合事物的精神。

ClickOnce 的主要缺点是不常见的安装位置和原始安装程序 - 如果您无论如何都要对某个奇怪的地方进行 xcopy，那么您已经拥有了 ClickOnce 已经令人讨厌的大部分内容，而没有任何优点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-04-09T15:54:35.227

虽然相当复杂，但一种可行的策略是创建一个作为本地系统运行的 Windows 服务。以管理用户身份安装一次，然后让此服务下载您的更新并将它们复制到程序文件目录。

您可能还需要制作某种用户界面来显示更新过程中的进度和状态。通过 WCF 服务等很容易公开它。

# linux - 远程设置环境变量？

> ID：758241
> 
> 赞同：0
> 
> 时间：2009-04-16T22:11:38.100
> 
> 标签：linux, environment-variables

如何从 Windows 应用程序远程设置 Linux 环境变量？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T22:13:55.380

你不能直接。环境变量只是一个与进程关联的值的表，并且在您`fork(2)` 成为进程时继承。

如果要设置它们，则需要在 Linux 端编写*某种*代码。最简单的可能是通过 shell 运行远程程序，并在命令行上设置它们。

否则，您需要一种方法让您的 Linux 端客户端将它们放入带有[`setenv(3)`](http://www.manpagez.com/man/3/setenv/).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T22:30:33.500

从表面上看你相当简洁的问题，你可以让你的 Windows 应用程序 ftp 到 linux 系统作为将运行 linux 应用程序并修改他们的 .cshrc 或 .bashrc 的用户，将所需的环境变量添加到 shell 脚本. 不过，这不会修改已经运行的 shell。

在抽象级别上，您正在谈论进程间通信。您在要与某些 Linux 应用程序进行通信的 Windows 应用程序中有信息。我不确定环境变量是传达这些数据的最佳方式。也许最好在您的 Windows 应用程序和 Linux 应用程序之间打开一个套接字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T22:43:57.493

我能想到的两种方法——按可能的简单顺序：

1.  编写一个在网络套接字上侦听命令的 Linux 程序。您的 Windows 应用程序会发送相应的命令。Linux 程序运行命令来设置环境变量 - 类似于`system(export MY_ENV_VAR=abc).`This 在网络上不会是安全的，除非你这样做。

2.  使用 SSH 登录 Linux 系统，然后运行脚本来设置变量。我不知道周围是否有适用于 Windows 的 SSH 库，但如果没有，我会感到惊讶。PuTTY 是一个优秀的开源 Windows SSH 客户端，因此您可以从那里使用代码，但您应该首先检查许可证 - 取决于您计划如何使用您的应用程序。此选项的好处是您可以在必要时使用 PKI 来保护网络连接。

# python - 如果请求的数据有时被压缩，有时不被压缩，如何使用 pycurl？

> ID：758243
> 
> 赞同：2
> 
> 时间：2009-04-16T22:11:52.297
> 
> 标签：python, http, gzip, libcurl, pycurl

我这样做是为了获取一些数据：

```
c = pycurl.Curl()
c.setopt(pycurl.ENCODING, 'gzip') 
c.setopt(pycurl.URL, url)
c.setopt(pycurl.TIMEOUT, 10)   
c.setopt(pycurl.FOLLOWLOCATION, True)

xml = StringIO()

c.setopt(pycurl.WRITEFUNCTION, xml.write )

c.perform()
c.close() 
```

我的网址通常是这样的：

```
http://host/path/to/resource-foo.xml 
```

通常我会返回 302 指向：

```
http://archive-host/path/to/resource-foo.xml.gz 
```

鉴于我设置了 FOLLOWLOCATION 和 ENCODING gzip，一切正常。

问题是，有时我的 URL 不会导致重定向到 gzip 压缩的资源。发生这种情况时，`c.perform()`会引发此错误：

```
pycurl.error: (61, 'Error while processing content unencoding: invalid block type') 
```

这向我表明 pycurl 正在尝试对未压缩的资源进行压缩。

有什么方法可以指示 pycurl 找出响应编码，以及 gunzip 或不合适吗？我玩过使用不同的值`ENCODING`，但到目前为止还没有豆子。

pycurl 文档似乎有点缺乏。：/

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T22:20:21.433

如果最坏的情况发生，您可以省略 ENCODING 'gzip'，将 HTTPHEADER 设置为 {'Accept-Encoding' : 'gzip'}，[检查](https://stackoverflow.com/questions/472179/how-to-read-the-header-with-pycurl)“Content-Encoding: gzip”的响应标头，如果存在，将响应压缩你自己。

# c++ - 从 CGImage 生成 CCITT 压缩的 TIFF

> ID：758249
> 
> 赞同：2
> 
> 时间：2009-04-16T22:14:04.567
> 
> 标签：c++, macos, core-graphics, cgimage

我有一个 CGImage（核心图形，C/C++）。是灰度。嗯，原来是黑白的，但是CGImage可能是RGB的。那应该没关系。我想创建一个 CCITT-Group 4 TIFF。

我可以通过使用正确的字典创建目标并添加图像来创建 LZW TIFF（灰度或彩色）。没问题。

但是，似乎没有等效的 kCGImagePropertyTIFFCompression 值来表示 CCITT-4。它应该是 4，但这会产生未压缩。

我有一个手动 CCITT 压缩例程，所以如果我能得到二进制（每像素 1 位）数据，我就准备好了。但我似乎无法从 CGImage 中获取 1 个 BPP 数据。我有应该将 CGImage 放入 CGBitmapContext 然后给我数据的代码，但它似乎给了我全黑。

我今天问了几个问题试图解决这个问题，但我只是想，让我们问我真正想回答的问题，看看是否有人能回答。

必须有办法做到这一点。我必须错过一些愚蠢的东西。它是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T10:22:16.687

这似乎工作并产生并非全黑的输出。可能有一种方法可以做到这一点，它不涉及首先手动转换为灰度，但至少它有效！

```
static void WriteCCITTTiffWithCGImage_URL_(CGImageRef im, CFURLRef url) {
    // produce grayscale image
    CGImageRef grayscaleImage;
    {
        CGColorSpaceRef colorSpace = CGColorSpaceCreateWithName(kCGColorSpaceGenericGray);
        CGContextRef bitmapCtx = CGBitmapContextCreate(NULL, CGImageGetWidth(im), CGImageGetHeight(im), 8, 0, colorSpace, kCGImageAlphaNone);
        CGContextDrawImage(bitmapCtx, CGRectMake(0,0,CGImageGetWidth(im), CGImageGetHeight(im)), im);
        grayscaleImage = CGBitmapContextCreateImage(bitmapCtx);
        CFRelease(bitmapCtx);
        CFRelease(colorSpace);
    }

    // generate options for ImageIO. Man this sucks in C.
    CFMutableDictionaryRef options = CFDictionaryCreateMutable(kCFAllocatorDefault, 2, &kCFTypeDictionaryKeyCallBacks, &kCFTypeDictionaryValueCallBacks);
    {
        {
            CFMutableDictionaryRef tiffOptions = CFDictionaryCreateMutable(kCFAllocatorDefault, 1, &kCFTypeDictionaryKeyCallBacks, &kCFTypeDictionaryValueCallBacks);
            int fourInt = 4;
            CFNumberRef fourNumber = CFNumberCreate(kCFAllocatorDefault, kCFNumberIntType, &fourInt);
            CFDictionarySetValue(tiffOptions, kCGImagePropertyTIFFCompression, fourNumber);
            CFRelease(fourNumber);

            CFDictionarySetValue(options, kCGImagePropertyTIFFDictionary, tiffOptions);

            CFRelease(tiffOptions);                
        }

        {
            int oneInt = 1;
            CFNumberRef oneNumber = CFNumberCreate(kCFAllocatorDefault, kCFNumberIntType, &oneInt);

            CFDictionarySetValue(options, kCGImagePropertyDepth, oneNumber);

            CFRelease(oneNumber);
        }
    }

    // write file
    CGImageDestinationRef idst = CGImageDestinationCreateWithURL(url, kUTTypeTIFF, 1, NULL);
    CGImageDestinationAddImage(idst, grayscaleImage, options);
    CGImageDestinationFinalize(idst);

    // clean up
    CFRelease(idst);
    CFRelease(options);
    CFRelease(grayscaleImage);
}

Nepheli:tmp ken$ tiffutil -info /tmp/output.tiff 
Directory at 0x1200
  Image Width: 842 Image Length: 562
  Bits/Sample: 1
  Sample Format: unsigned integer
  Compression Scheme: CCITT Group 4 facsimile encoding
  Photometric Interpretation: "min-is-black"
  Orientation: row 0 top, col 0 lhs
  Samples/Pixel: 1
  Number of Strips: 1
  Planar Configuration: Not planar 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T23:56:00.017

[ImageMagick](http://www.imagemagick.org/script/index.php)几乎可以转换为任何图像格式。由于它是开源的，您可以阅读[源代码](http://www.imagemagick.org/script/subversion.php)以找到您问题的答案。

如果您使用 C++，您甚至可以在您的应用程序中使用[ImageMagick API 。](http://www.imagemagick.org/Magick++/)

**编辑：**
如果您可以从 CGImage 以任何格式获取数据（听起来像您可以），您可以使用 ImageMagick 将其从您从 CGImage 获得的任何格式转换为 ImageMagick 支持的任何其他格式（您想要的 TIFF 格式）。

**编辑：** [技术问答 QA1509 从 CGImage 对象中获取像素数据](http://developer.apple.com/qa/qa2007/qa1509.html)状态：

> 在 Mac OS X 10.5 或更高版本上，添加了一个新调用，允许您从 CGImage 对象获取实际像素数据。此调用 CGDataProviderCopyData 返回一个 CFData 对象，其中包含来自相关图像的像素数据。

获得像素数据后，您可以使用 ImageMagick 对其进行转换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T09:29:50.697

NSBitmapImageRep 声称能够生成 CCITT FAX Group 4 压缩 TIFF。所以这样的事情可能会成功（未经测试）：

```
CFDataRef tiffFaxG4DataForCGImage(CGImageRef cgImage) {
  NSBitmapImageRep *imageRep =
      [[[NSBitmapImageRep alloc] initWithCGImage:cgImage] autorelease];
  NSData *tiffData =
      [imageRep TIFFRepresentationUsingCompression:NSTIFFCompressionCCITTFAX4
                                            factor:0.0f];
  return (CFDataRef) tiffData;
} 
```

此函数应返回您查找的数据。

# vb.net - VB.NET 如何检查图像的大小和尺寸？

> ID：758253
> 
> 赞同：1
> 
> 时间：2009-04-16T22:15:48.807
> 
> 标签：vb.net

我正在使用下面的代码读取图像（jpg），我需要检查图像是否不大于 150 像素 x 150 像素并且小于 25k，我应该怎么做？

```
PictureBox2.Image = Image.FromFile(.FileName) 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T22:18:18.927

```
If New FileInfo(.FileName).Length > 25 * 1024 Then ... 'More than 25KB'
Dim img = Image.FromFile(.FileName)
If img.Size.Width > 150 OrElse img.Size.Height > 150 Then ... 'More than 150x150'
Picturebox1.Image = img 
```

# java - Java：货币到语言环境的映射可能吗？

> ID：758255
> 
> 赞同：22
> 
> 时间：2009-04-16T22:16:03.050
> 
> 标签：java, formatting, currency

我有一个存储在与货币金额相关的数据库中的值，例如 10.0。我还可以访问货币/货币代码。当我不知道语言环境时，如何使用 NumberFormat/DecimalFormat/(other?) 进行格式化？根据文档，它将选择一个不适用于外币的默认语言环境。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2011-05-19T22:29:44.913

JasonTrue 是正确的，但您可以覆盖 NumberFormat 语言环境的货币：

```
NumberFormat numberFormat = NumberFormat.getCurrencyInstance(locale);
//the user may have selected a different currency than the default for their locale
Currency currency = Currency.getInstance("GBP");
numberFormat.setCurrency(currency);
numberFormat.format(amount); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-16T23:01:47.497

一般来说，正确的行为是在用户的首选语言环境中格式化金额，而不是货币的典型语言环境。在客户端，您将拥有用户的偏好 (Locale.getDefault())；如果您在 Web 服务器端执行某些操作，请使用 Accept-Language 或最好使用页面内容的语言环境来获取正确的语言环境。

理由是这样的：英美用户会理解 € 10,000,000.15，但不理解适合德国的等值 € 10.000.000,15

无论如何，货币本身不包含足够的信息来推断合适的语言环境。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T22:26:01.730

如果货币代码是欧元怎么办？而且，虽然它受到了打击，但美元仍在世界各地使用。从货币代码推断语言环境似乎不可靠。你可以引入一个明确的用户偏好来代替语言环境吗？

您要查找的信息不是内置 Java 货币数据库的一部分，因此没有用于它的 API。您可以为许多明确的情况[创建自己的表。](http://en.wikipedia.org/wiki/ISO_4217)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T22:53:53.117

我想说，如果您的数据库正在存储货币价值，它应该同时挂在单位上。听起来你现在正在这样做。您可以同时将语言环境添加到数据库中吗？可能是一个不错的解决方案。

# python - PyQt4 最小化到托盘

> ID：758256
> 
> 赞同：23
> 
> 时间：2009-04-16T22:16:37.650
> 
> 标签：python, pyqt4, system-tray, minimize

有没有办法在 PyQt4 中最小化托盘？我已经使用过 QSystemTrayIcon 类，但现在我想最小化或“隐藏”我的应用程序窗口，并且只显示托盘图标。

有人做过吗？任何方向将不胜感激。

在 Window XP Pro 上使用 Python 2.5.4 和 PyQt4

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-04-16T22:53:20.933

一旦您记住实际上无法最小化到[系统托盘](https://web.archive.org/web/20070114154431/http://blogs.msdn.com/oldnewthing/archive/2003/09/10/54831.aspx)，这将非常简单。

相反，您可以通过以下方式伪造它：

1.  捕捉窗口上的最小化事件
2.  在最小化事件处理程序中，创建并显示一个 QSystemTrayIcon
3.  同样在最小化事件处理程序中，在您的窗口上调用 hide() 或 setVisible(false)
4.  在系统托盘图标上捕获单击/双击/菜单项
5.  在您的系统托盘图标事件处理程序中，在您的窗口上调用 show() 或 setVisible(true)，并可选择隐藏您的托盘图标。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-16T23:17:59.237

代码有帮助，所以这是我为应用程序编写的内容，除了 closeEvent 而不是最小化事件。

笔记：

“closeEvent(event)”是一个被重写的Qt事件，所以它必须放在实现你想要隐藏的窗口的类中。

“okayToClose()”是您可能考虑实现的函数（或您可能想要存储的布尔标志），因为有时您实际上想要退出应用程序而不是最小化到系统托盘。

还有一个如何再次显示（）您的窗口的示例。

```
def __init__(self):
  traySignal = "activated(QSystemTrayIcon::ActivationReason)"
  QtCore.QObject.connect(self.trayIcon, QtCore.SIGNAL(traySignal), self.__icon_activated)

def closeEvent(self, event):
  if self.okayToClose(): 
    #user asked for exit
    self.trayIcon.hide()
    event.accept()
  else:
    #"minimize"
    self.hide()
    self.trayIcon.show() #thanks @mojo
    event.ignore()

def __icon_activated(self, reason):
  if reason == QtGui.QSystemTrayIcon.DoubleClick:
    self.show() 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-11-15T14:49:31.017

只是添加到克里斯的例子中：

**在声明信号时使用 Qt 表示法至关重要**，即

**正确**：

```
self.connect(self.icon, SIGNAL("activated(QSystemTrayIcon::ActivationReason)"), self.iconClicked) 
```

而不是 PyQt 的

**不正确**且不起作用：

```
self.connect(self.icon, SIGNAL("activated(QSystemTrayIcon.ActivationReason)"), self.iconClicked) 
```

注意`::`信号字符串中的 。我花了大约三个小时才弄清楚。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-01-13T05:01:05.567

这是工作代码..感谢**Matze**的**Crucial**，SIGNAL 让我产生了更多的好奇心.. 但做其他事情。所以你要一个#！片刻 ：-）

```
def create_sys_tray(self):
    self.sysTray = QtGui.QSystemTrayIcon(self)
    self.sysTray.setIcon( QtGui.QIcon('../images/corp/blip_32.png') )
    self.sysTray.setVisible(True)
    self.connect(self.sysTray, QtCore.SIGNAL("activated(QSystemTrayIcon::ActivationReason)"), self.on_sys_tray_activated)

    self.sysTrayMenu = QtGui.QMenu(self)
    act = self.sysTrayMenu.addAction("FOO")

def on_sys_tray_activated(self, reason):
    print "reason-=" , reason 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-05-04T01:56:58.597

这是对 vzades 回复的编辑，但由于多种原因被拒绝。它与他们的代码完全相同，但也会遵守最小化事件（并且在没有语法错误/缺少图标的情况下运行）。

```
import sys
from PyQt4 import QtGui, QtCore

class Example(QtGui.QWidget):
    def __init__(self):
        super(Example, self).__init__()
        self.initUI()

    def initUI(self):
        style = self.style()

        # Set the window and tray icon to something
        icon = style.standardIcon(QtGui.QStyle.SP_MediaSeekForward)
        self.tray_icon = QtGui.QSystemTrayIcon()
        self.tray_icon.setIcon(QtGui.QIcon(icon))
        self.setWindowIcon(QtGui.QIcon(icon))

        # Restore the window when the tray icon is double clicked.
        self.tray_icon.activated.connect(self.restore_window)

    def event(self, event):
        if (event.type() == QtCore.QEvent.WindowStateChange and 
                self.isMinimized()):
            # The window is already minimized at this point.  AFAIK,
            # there is no hook stop a minimize event. Instead,
            # removing the Qt.Tool flag should remove the window
            # from the taskbar.
            self.setWindowFlags(self.windowFlags() & ~QtCore.Qt.Tool)
            self.tray_icon.show()
            return True
        else:
            return super(Example, self).event(event)

    def closeEvent(self, event):
        reply = QtGui.QMessageBox.question(
            self,
            'Message',"Are you sure to quit?",
            QtGui.QMessageBox.Yes | QtGui.QMessageBox.No,
            QtGui.QMessageBox.No)

        if reply == QtGui.QMessageBox.Yes:
            event.accept()
        else:
            self.tray_icon.show()
            self.hide()
            event.ignore()

    def restore_window(self, reason):
        if reason == QtGui.QSystemTrayIcon.DoubleClick:
            self.tray_icon.hide()
            # self.showNormal will restore the window even if it was
            # minimized.
            self.showNormal()

def main():
    app = QtGui.QApplication(sys.argv)
    ex = Example()
    ex.show()
    sys.exit(app.exec_())

if __name__ == '__main__':
    main() 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-09-28T11:50:57.193

这是处理 PyQt5 托盘图标双击的正确方法。

```
def _create_tray(self):
    self.tray_icon = QSystemTrayIcon(self)
    self.tray_icon.activated.connect(self.__icon_activated)

def __icon_activated(self, reason):
    if reason in (QSystemTrayIcon.Trigger, QSystemTrayIcon.DoubleClick):
        pass 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-11-06T13:11:45.183

这是代码，它确实有助于我相信向我展示代码

```
import sys
from PyQt4 import QtGui, QtCore
from PyQt4.QtGui import QDialog, QApplication, QPushButton, QLineEdit, QFormLayout, QSystemTrayIcon

class Example(QtGui.QWidget):

    def __init__(self):
        super(Example, self).__init__()
        self.initUI()

    def initUI(self):
        self.icon = QSystemTrayIcon()
        r = self.icon.isSystemTrayAvailable()
        print r
        self.icon.setIcon(QtGui.QIcon('/home/vzades/Desktop/web.png'))
        self.icon.show()
        # self.icon.setVisible(True)
        self.setGeometry(300, 300, 250, 150)
        self.setWindowIcon(QtGui.QIcon('/home/vzades/Desktop/web.png'))
        self.setWindowTitle('Message box')
        self.show()
        self.icon.activated.connect(self.activate)
        self.show()

    def closeEvent(self, event):

        reply = QtGui.QMessageBox.question(self, 'Message', "Are you sure to quit?", QtGui.QMessageBox.Yes |
                                           QtGui.QMessageBox.No, QtGui.QMessageBox.No)

        if reply == QtGui.QMessageBox.Yes:
            event.accept()
        else:
            self.icon.show()

            self.hide()

            event.ignore()

    def activate(self, reason):
        print reason
        if reason == 2:
            self.show()

    def __icon_activated(self, reason):
        if reason == QtGui.QSystemTrayIcon.DoubleClick:
            self.show()

def main():

    app = QtGui.QApplication(sys.argv)
    ex = Example()
    sys.exit(app.exec_())

if __name__ == '__main__':
    main() 
```

# asp.net - ASP.NET + 来自 WebServices / HttpHandlers 的空响应

> ID：758264
> 
> 赞同：1
> 
> 时间：2009-04-16T22:17:51.737
> 
> 标签：asp.net, asmx, httphandler

几周前，我发布了一个问题，说更新面板的回复是空的。我无法解决它。

但是，今天我注意到 webservices 和 HttpHandlers 也没有返回任何东西，IE 这个：

```
public class Handler1 : IHttpHandler
{

    public void ProcessRequest(HttpContext context)
    {
        context.Response.ContentType = "text/plain";
        context.Response.Write("Hello World");
    }

    public bool IsReusable
    {
        get
        {
            return false;
        }
    }
} 
```

调用时不会向浏览器返回任何内容。这让我想知道这是否是破坏 ASP.NET 管道的配置问题。

有没有人有任何故障排除提示？

编辑：将我们高度定制的 web.config 更改为默认配置使其工作....所以我们的 web.config 中的某些东西打破了这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T14:28:17.110

我能想到的唯一一件事就是将自定义 web.config 中的额外部分一次添加回一个部分，直到找到阻止它工作的部分。

一旦你知道是什么破坏了它，也许这里有人可以告诉你为什么

# version-control - 签入“注释掉”代码

> ID：758279
> 
> 赞同：96
> 
> 时间：2009-04-16T22:24:07.150
> 
> 标签：version-control, tfs, coding-style

好的，这在我目前的工作中引起了一些摩擦，我真的没想到会这样。组织内部软件开发在这里是一个新概念，我已经起草了一些编码指南的初稿。

我建议永远不要将“注释掉”的代码签入存储库。我这么说的原因是存储库维护了文件的完整历史记录。如果您要删除功能代码，则将其完全删除。存储库保留您的更改，因此很容易查看更改的内容。

这引起了一些摩擦，因为另一位开发人员认为采用这条路线过于严格。该开发人员希望能够注释掉一些他正在处理但不完整的代码。然后，此代码将永远不会被签入，然后不会保存在任何地方。我们将使用 TFS，所以我建议搁置更改将是最正确的解决方案。然而，它没有被接受，因为他希望能够签入可能会或可能不会部署的部分更改。

我们希望最终能够充分利用持续集成并自动部署到开发 Web 服务器。目前没有 Web 服务器或数据库服务器的开发版本，但很快就会改变。

无论如何，你的想法是什么？您认为“注释掉”的代码在存储库中有用吗？

我很想听听其他人关于这个话题的意见。

编辑：为了清楚起见，我们不使用私有分支。如果我们这样做了，那么我会说用你的私有分支做你想做的事，但永远不要将注释掉的代码与主干或任何共享分支合并。

编辑：没有正当理由我们不使用私有或每个用户分支。这不是我不同意的概念。我们只是还没有这样设置。也许这就是最终的中间立场。现在我们使用 TFS 搁置。

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2009-04-16T22:26:43.507

可能还有其他人有不同的经历，但在我的检查中，半成品代码是一个可怕的想法，时期。

以下是我学到并尝试遵循的原则：

*   经常入住 - 至少一次，但最好每天多次
*   只签入完整的功能
*   如果第一个和第二个冲突（例如，使功能工作需要超过一天的时间），那么任务太大 - 将其分解为较小的可完成任务。

这表示：

*   注释掉的代码不应该被签入，因为它不起作用
*   评论不是一种有效的归档策略，因此无论是尚未完成的代码还是即将退役的代码，评论和签入都没有任何意义。

所以总而言之，不！如果代码还没有准备好进入下一阶段（无论哪个适合您：IntTest/QA/UAT/PreProd/Prod），则不应将其提交到主干或多开发人员分支。时期。

*编辑：阅读其他答案和评论后，我会补充一点，我认为禁止*评论代码不一定是个好主意（不知道你会如何强制执行）。我要说的是，你应该让团队中的每个人都认同我上面描述的理念。我所在的团队全心全意地拥抱它。因此，源代码控制是一个无摩擦的团队成员，可以帮助我们完成工作。

不接受这种哲学的人通常会导致[窗户被打破](https://web.archive.org/web/20150206073037/http://www.davecheong.com:80/2006/06/30/broken-windows-theory-in-software-and-your-personal-life/)，并且经常对源代码控制感到沮丧。他们充其量认为这是一种必要的邪恶，最坏的情况是可以避免的。这导致不频繁的签入，这意味着变更集巨大且难以合并，这加剧了挫败感，使签入变得更加需要避免等等。这最终是一个态度问题，而不是真正的过程问题。很容易对它设置心理障碍；很容易找到为什么它不起作用的原因，就像如果你真的不想节食也很容易找到不节食的理由一样。但是，当人们*确实*想要这样做并致力于改变他们的习惯时，结果是戏剧性的。你有责任有效地出售它。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-04-16T22:28:21.897

“从不”很少在指南中使用。

您的同事有一个很好的例子，说明何时可能适合签入被注释掉的代码：当它不完整并且如果在活动时签入可能会破坏应用程序。

在大多数情况下，在管理良好的变更控制系统中注释掉**死**代码是不必要的。但是，并非所有注释代码都是“死的”。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-04-17T01:02:54.333

我留下注释掉代码的一种情况：

```
// This approach doesn't work
// Blah, blah, blah 
```

当这是解决问题的明显方法时，它包含一些微妙的缺陷。当然，存储库会拥有它，但存储库不会在未来警告任何人不要走那条路。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2009-04-16T22:37:48.240

出于维护历史记录的目的，*永远*不应签入已注释掉的代码。这就是源代码控制的重点。

人们在这里谈论很多理想。也许与其他人不同的是，我必须在多个项目上工作，并且经常被“现实世界”打断，偶尔会打断我的工作日。

有时，现实情况是，我必须签入部分完整的代码。要么有丢失代码的风险，要么签入不完整的代码。我不能总是负担得起“完成”一项任务，无论多么小。但是我*不会*在不签入所有代码的情况下断开我的笔记本电脑与网络的连接。

如有必要，我将创建自己的工作分支来提交部分更改。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2009-04-16T22:35:29.557

我当然会强烈反对签入注释掉的代码。但是，我不会绝对禁止它。*有时*（如果很少）将注释掉的代码检查到源代码控制中是合适的。说“永远不要那样做”太严格了。

我想我们都同意以下几点：

*   永远不要将死代码检查到源代码控制中
*   永远不要将损坏（无法运行）的代码检查到源代码控制中，至少**永远不要**进行主干，并且很少会检查到私有分支 YMMV
*   如果您出于调试目的临时注释掉了某些内容或破坏了某些内容，请在将代码恢复为正确形式之前不要签入代码

有些人说还有其他类别，例如*暂时*删除的代码，或增量但不完整的改进，其中包括少量注释掉的代码作为下一步的文档，或者*非常短*（最好是 1 行）的注释片段输出代码显示不应该*重新*添加的内容。被注释掉的代码应该总是伴随着一个注释，说明它被注释掉（而不仅仅是删除）的原因，并给出被注释掉的代码的预期生命周期。例如，“以下代码弊大于利，因此被注释掉，但需要在发布 XXX 之前替换。”

如果您正在提供修补程序以阻止客户流血并且您没有立即找到最终修复程序的机会，则上述评论是合适的。提供修补程序后，注释掉的代码提醒您仍有一些需要修复的地方。

我什么时候签入注释掉的代码？一个例子是，当我暂时删除一些我认为很有可能在不久的将来以某种形式重新添加的东西时。注释掉的代码可以直接提醒这是不完整的。当然，旧版本在源代码控制中，您可以使用**FIXME**注释作为需要更多内容的标志。但是，有时（如果不是经常）代码是更好的注释。

此外，当通过删除一行（或者更少见，两行）代码来修复错误时，我有时会用注释注释掉该行，以*永远不会*重新启用该代码并说明原因。这种评论清晰、直接、简洁。

Rex M 说：1）只检查完整的功能，2）[如果]任务太大 - 将其分解成更小的可完成任务。

回应：是的，这是理想的。有时，当您正在处理生产代码并且有一个直接的、关键的问题需要解决时，这两种选择都无法实现。有时要完成一项任务，您需要在现场放置一段时间的代码版本。当您试图找到问题的根本原因时，对于数据收集代码更改尤其如此。

对于在更一般的问题中询问的特定实例......只要开发人员将注释掉的代码检查到一个私有分支中，除了那个开发人员（也许还有开发人员正在与之合作的人），没有人会看到，它几乎没有伤害。但是该开发人员应该（几乎）永远不要将此类代码交付到主干或等效设备中。主干应始终构建并始终发挥作用。将未完成的代码交付到主干几乎总是一个非常糟糕的主意。如果您让开发人员将未完成或临时代码检查到私有分支中，那么您必须依靠开发人员不要忘记在交付到主干之前清理代码。

为了澄清对其他答案的评论，如果代码被注释掉并签入，我期望如果未注释的代码随着代码被注释掉的时间长度而下降，代码将起作用。显然，重构工具并不总是在重构中包含注释。几乎总是，如果我将注释掉的代码投入生产，那么代码就可以作为精炼的注释，比散文更具体，需要在那里完成一些事情。这不是应该有很长寿命的东西。

最后，如果你能在每个源文件中找到被注释掉的代码，那就是有问题了。*出于任何*原因将注释掉的代码交付到主干应该是罕见的事件。如果这种情况经常发生，那么它就会变得混乱并失去其价值。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-04-16T22:28:08.357

我认为*永远不是*一个太强的条件。

我倾向于注释掉、签入、运行测试、思考然后在下一个版本之后删除注释。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2009-04-16T23:54:25.560

通常，签入已注释掉的代码是错误的，因为它会在非原作者并需要阅读或修改代码的人之间造成混淆。无论如何，原作者经常在 3 个月后对代码感到困惑。

我支持这样的信念，即代码属于公司或团队，你有责任让你的同行变得简单。签入已注释掉的代码而不添加关于保留它的原因的注释无异于说：

> *我不介意你最终是否对为什么这些东西在这里感到困惑。我的需求比你的更重要，这就是我这样做的原因。我觉得没有必要向你或其他任何人证明我这样做的原因。*

对我来说，被注释掉的代码*通常*被视为不那么体贴的同事***的不尊重。***

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-04-16T22:55:38.073

当您需要像现在这样添加一个小功能或错误修复时，在接下来的 3 分钟内，您必须修复一个文件，您有一些开发了一半的代码，我会说没关系，实际需要在战场上胜过务实的理想。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-04-16T22:47:20.090

这表明了两种思想流派的根本区别：那些只签入他们满意并认为值得保存的工作代码的人，以及那些签入他们的工作以便修订控制能够支持他们防止数据丢失的人。

我将后者描述为“那些喜欢使用他们的修订控制系统作为穷人的磁带备份的人”，但这会让我知道我在哪个阵营。:-)

我的猜测是你属于“好代码”阵营，他属于“工作代码”阵营。

[编辑]

从评论来看，是的，我猜对了。

正如我所说，我和你在一起，但据我所知，这是少数意见，无论是在 stackoverflow 上还是在我工作的地方。因此，我认为您不能真正将其作为唯一的操作方式写入您的开发标准。无论如何，如果您希望遵循标准，则不是。一个好的领导者知道的一件事是永远不要发布他们*知道*不会被遵循的命令。

顺便说一句：*好的*编辑器将有助于保留旧版本。例如，在 Emacs 中，我将 keep-old-versions 和 keep-old-versions 设置为 10，这使它保留了我文件的最后 10 次保存。您可能会将其视为一种帮助您反对将修订控制作为备份人群的论点的方法。然而，你永远不会赢得争论。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-04-17T00:29:08.037

签入注释掉代码的另一个原因：

您正在修改现有代码，并发现了一个细微的错误，该错误很容易被忽略，而且乍一看可能看起来是正确的。将其注释掉，将修复放在它的位置，并添加关于正在发生的事情以及修改原因的注释。签入，以便您对修复的评论在存储库中。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2009-04-16T22:32:00.983

我大致同意注释掉的代码不应签入的原则。源代码控制系统是共享资源，您的同事在某种程度上将其用作个人便签本。这对其他用户来说不是很体贴，特别是如果您订阅代码库的共享所有权的想法。

下一个看到注释掉的代码的开发人员不会知道这是一项正在进行的工作。他可以随意更改吗？是死代码吗？他不知道。

如果您的同事的更改未处于可以签入的状态，他需要完成它，和/或学习进行较小的增量更改。

“检查可能会或可能不会部署的部分更改” - 大概这也意味着可能会或可能不会被测试？这是一个非常复杂的代码库的滑坡。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-04-16T22:40:50.993

这取决于。如果出于说明目的而将其留在那里，也许。它可能在重构期间很有用。否则，通常不会。此外，注释掉未完成的代码必然会导致失败和浪费时间。最好他将代码分解成更小的部分，并在它们工作时检查它们。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-04-16T23:02:35.450

以我的经验，开发人员开关被注释掉了代码。

有时，新的后端是并行构建的，激活开关在源代码控制中被注释掉。

一些我们在蓝月亮上曾经需要但客户永远不需要的奇怪功能通常以这种方式实现。这些东西通常具有很高的安全性或数据完整性绕过风险，因此我们不希望它们在开发之外处于活动状态。要求使用它的开发人员首先取消注释代码似乎是获得它的最简单方法。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-09-30T18:08:49.367

允许源代码控制历史来说明做某事的“旧方式”而不是注释掉它并检查注释掉以及解释的想法在理论上是一个好主意。

然而，在现实世界中，没有人会查看他们正在处理的文件的源代码控制历史记录，除非它是某种官方审查过程的一部分（仅定期进行），或者如果某些东西不起作用，并且开发人员不知道为什么。

即便如此，回首大约 3 个以上的版本基本上也不会发生。

部分原因是源代码控制系统不会让这种随意的审查变得容易。通常您必须检查旧版本或与旧版本进行比较，您只会看到两个版本，并且没有很好的简明视图来了解更改的内容，这可以让您一目了然地了解更改的内容。

部分是人性与团队需求的结合。如果我必须修复某些东西，并且我可以在几个小时内修复它，我不太可能花一个小时来研究一个月内没有“上线”的旧版本代码（每个开发人员都会检查通常，意味着返回许多修订版），除非我碰巧知道其中有一些东西（例如，如果我记得讨论过关于改变与我现在正在做的事情相关的事情）。

如果代码被删除并重新签入，那么，出于所有意图和目的（完全回滚的有限目的除外），它将不复存在。是的，它的存在是为了备份，但如果没有代码管理员的角色，它就会丢失。

我当前项目的源代码控制树大约有 10 周大，在一个只有大约 4 名工程师的团队中，大约有 200 个已提交的更改列表。我知道我的团队没有做好应有的工作，因为一旦有可靠的东西准备就绪就可以检查。这使得依靠阅读代码的每一部分的代码历史来捕捉每一个重要的变化变得相当粗糙。

现在，我正在开发一个处于初始开发模式的项目，这与处于维护模式的项目非常不同。两种环境中都使用了许多相同的工具，但需求差异很大。例如，经常有一项任务需要两个或多个工程师密切合作来构建某些东西（例如客户端和某种服务器）。

如果我正在编写服务器，我可能会为客户端将使用的草稿接口编写代码并检查它完全没有功能，以便编写客户端的工程师可以更新。这是因为我们的政策规定，将代码从一位工程师发送给另一位工程师的唯一方法是通过源代码控制系统。

如果任务需要足够长的时间，那么值得创建一个分支让我们两个人一起工作（尽管这违反了我组织的政策——工程师和个别团队负责人没有必要的权限源代码控制服务器）。最终，这是一个权衡，这就是为什么我们尽量不制定太多“总是”或“从不”的政策。

我可能会对这样的无注释代码政策做出回应，说它有点幼稚。也许是出于好意，但最终不太可能实现其目的。

虽然看到这篇文章会让我回过头来查看我上周检查的代码并删除注释掉的部分，这些部分既不是最终的（尽管它有效），也永远不可能再次被需要。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-04-16T22:52:11.280

我的观点：如果开发人员在他们自己的分支上工作，或者在他们自己的沙箱区域工作，那么他们应该能够签入任何他们想要的东西。当他们将代码检入共享分支（功能分支，或团队的分支，或者当然是主/主干）时，代码应该尽可能原始（没有注释掉的代码，没有更多的 FIXME 等）。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-04-16T22:33:29.000

我认为“从不”这个规则太强了。我会投票给人们是否将注释代码签入存储库留下一些个人余地。最终目标应该是编码人员的生产力，而不是“原始存储库”。

为了平衡这种松懈，确保每个人都知道注释掉的代码有一个到期日期。如果评论代码已经存在了整整一周并且从未激活过，则任何人都可以删除评论代码。（将“一周”替换为您认为合适的任何内容。）这样，您保留在看到杂物时将其消除的权利，而不会太直接地干扰人们的个人风格。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2009-04-16T22:34:59.027

也许这里真正的问题是是否应该允许开发人员签入不完整的代码？

这种做法似乎与您实现持续集成的既定目标相矛盾。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-04-16T22:27:42.057

我绝对同意不应将注释掉的代码签入存储库，这就是源代码控制的目的。

根据我的经验，当程序员签入注释掉的代码时，这是因为他/她不确定什么是正确的解决方案，并且更乐意将替代解决方案留在源代码中，希望其他人会做出决定。

我发现它使代码复杂化并且难以阅读。

签入未由实时系统调用的半成品代码（因此您可以获得源代码控制的好处）我没有问题。我的问题是在没有解释的情况下查找注释代码部分，导致代码被排除在外的困境。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2009-04-18T11:48:36.350

我认为在源代码控制系统中签入注释代码应该非常谨慎，特别是如果用于注释代码的语言标签是由块编写的，即：

```
/* My commented code start here
My commented code line 1
My commented code line 2
*/ 
```

而不是以单个行为基础，例如：

```
// My commented code start here
// My commented code line 1
// My commented code line 2 
```

（你明白了）

我会格外小心的原因是，根据技术的不同，你应该非常小心你正在使用的 diff/merge 工具。对于某些源代码控制系统和某些语言，diff/merge 工具很容易混淆。例如，ClearCase 的标准差异/合并对于合并 .xml 文件是出了名的糟糕。

如果碰巧注释块行没有正确合并，那么您的代码将在不应该的时候在系统中变得活跃。如果代码不完整并破坏了构建，那可能是最不邪恶的，因为您会立即发现它。

但是如果代码通过了构建，它可能会在不应该存在的时候变得活跃，从 CM 的角度来看，这可能是一场噩梦。QA 通常会测试应该存在的内容，他们不会测试不应该存在的代码，因此您的代码可能会在您不知不觉中最终投入生产，并且当它意识到代码存在时不应该，维护成本增加了很多倍（因为“错误”将在生产或客户中发现，最糟糕的地方或时间）。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2011-12-22T10:49:57.580

我认为注释掉的代码被认为是“浪费”。

我假设您在团队环境中工作。如果您自己工作，并且使用“待办事项”注释掉代码并且您会回到它，那么情况就不同了。但是在团队环境中，您可以放心地假设，一旦注释掉的代码被签入，它就会一直存在，而且它很可能会带来更多的痛苦而不是满足感。

如果您正在进行同行代码审查，那么它可能会回答您的问题。如果另一个开发人员审查您的代码并说“为什么有这个试图做'废话'的注释掉的代码”，那么您的代码没有通过代码审查，您无论如何都不应该检查它。

注释掉的代码只会向其他开发人员提出问题——因此会浪费时间和精力。

您需要问“**为什么**”代码被注释掉的问题。一些建议：

如果您因为“不确定业务规则”而注释掉代码，那么您可能会遇到“范围蔓延”的问题 - 最好不要用“本来不错但我们没有时间”的要求弄脏您的代码库实施” - 使用清晰的代码和围绕实际存在的测试保持清洁。

如果您因为“不确定这是否是最好的方法”而注释掉代码，那么请让您的代码同行评审！时代在变，你会在 2 年后看看你今天写的代码，觉得这太可怕了！但是你不能到处评论你“知道”可以做得更好但你现在找不到方法的地方。让长期维护代码库的人确定是否有更好的方法 - 只需编写、测试和运行代码，然后继续。

如果您因为“某些东西不起作用”而注释掉代码，那么请[修复它](http://en.wikipedia.org/wiki/Broken_windows_theory)！一个常见的场景是[“损坏的测试”或“待办事项”](http://www.mehdi-khalili.com/zero-tolerance-on-broken-windows)。如果你有这些，你可以通过修复它们或摆脱它们来为自己节省很多时间。如果它们可以被“破坏”一段时间，它们很可能会永远被破坏。

所有这些潜在的场景（以及我在这里没有提到的场景）都是浪费时间和精力。注释掉的代码可能看起来像一个小问题，但可能表明您的团队中存在更大的问题。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-07-20T18:38:58.690

我希望看到可能损坏的、可访问的代码尚未被使用，但相同的代码完全不可用。由于所有版本控制软件都允许某种与主干分离的“工作副本”，因此使用这些功能确实是一个更好的主意。

新的非功能性代码在主干中很好，因为它是新的。它可能不会破坏任何已经有效的东西。如果它确实破坏了工作代码，那么它应该只进入一个分支，以便其他开发人员可以（如果他们需要）检查那个分支，看看有什么问题。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-04-17T00:23:37.737

1) 提前签入和 2) 始终保持存储库处于工作状态之间显然存在矛盾。如果您有多个开发人员，则后者的优先级将越来越高，因为您不能让一个开发人员为自己的个人工作流程在其他所有人身上胡扯。*也就是说*，你不应该低估第一条准则的价值。开发人员使用各种不同类型的心理围栏，而个性化的工作流程是优秀开发人员挤出这些额外 X 的一种方式。作为一名经理，你的工作不是试图理解所有这些细微差别——除非你是天才并且你的所有开发人员都是白痴，否则你会失败——而是让你的开发人员通过自己的决策成为最好的。

您在评论中提到您不使用私有分支。我的问题是为什么不呢？好吧，我对 TFS 一无所知，所以也许有充分的理由。然而，在使用 git 一年之后，我不得不说一个好的 DVCS 完全消除了这种紧张。在某些情况下，我发现注释掉代码很有用，因为我正在构建一个替代品，但如果我把它强加给其他人，我会为此失眠。能够在本地分支意味着我可以为我的个人流程保留有意义的提交，而不必担心（甚至通知）下游开发人员临时混乱。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-04-17T00:27:15.403

只是呼应合唱。不惜一切代价劝阻这种做法。它使代码更难阅读，并让人们想知道目前甚至不属于应用程序的代码的好/坏。您始终可以通过比较修订来找到更改。如果有一些大手术并且代码被集体注释掉，开发人员应该在签入/合并的修订说明中注意到它。

不完整/实验性代码应该在一个待开发完成的分支中。头部/主干应该是始终编译的主线，并且是正在运输的。一旦实验分支完成/接受，它应该合并到头/主线中。如果您需要支持文档，甚至有一个 IEEE 标准 (IEEE 1042) 对此进行了描述。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2009-04-16T23:08:06.827

存储库是代码的备份。如果我正在编写代码但尚未完成，为什么不将其注释掉并在一天结束时将其签入。这样，如果我的硬盘驱动器在一夜之间死机，我就不会丢失任何工作。我可以在早上查看代码，取消注释并继续。

我将其注释掉的唯一原因是因为我不想破坏一夜之间的构建。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-07-20T18:31:17.613

“[疤痕组织](http://codewright.blogspot.com/2005/11/scars-we-bear.html)”是我所说的注释掉的代码。在广泛使用版本控制系统之前的日子里，[Code Monkeys](http://codewright.blogspot.com/2005/12/codewright-and-code-monkey.html)会在文件中留下注释掉的代码，以防他们需要恢复功能。

唯一可以接受托运“疤痕组织”的时间是

1.  如果您有私人分支机构**并且**
2.  您没有时间让代码无错误地编译，**并且**
3.  你要去一个长假**，**
4.  你不信任你的 VCS，就像你使用 Visual Source Safe **OR**一样。
    [编辑]
5.  如果没有留下不正确的代码作为提醒，您可能会重新引入一个微妙的错误。（其他答案的要点）。

#4 几乎没有任何借口，因为周围有大量免费可用且功能强大的 VCS 系统，[Git 就是最好的例子](http://whygitisbetterthanx.com/)。

否则，只需让 VCS 成为您的存档和代码分发器。如果其他开发人员想查看您的代码，请将差异通过电子邮件发送给他，让他直接应用他想要的东西。无论如何，合并并不关心两个文件的编码为何或如何发生分歧。

因为它是代码，所以疤痕组织甚至比写得很好的评论更让人分心。就其作为代码的本质而言，您让维护程序员花费脑力 CPU 周期来确定疤痕组织是否与他的更改有关。不管疤痕是一周大还是 10 年大，将疤痕组织留在代码中会给那些必须破译代码的人带来负担。

[编辑] 我要补充一点，需要区分两个主要场景：

*   私人开发，编码个人项目或签入私人分支
*   维护开发，其中被签入的代码旨在投入生产。

对疤痕组织说“不”！

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-04-26T11:09:48.890

如果开发人员因为某些代码尚未完成而将其注释掉，那么处理此问题的正确“源代码控制”方法是让该开发人员将其保存在他自己的单独分支中，直到该代码*准备*好检查在。

使用 DVCS（如 git、bazaar 或 mercurial），这非常容易，因为它不需要在中央存储库中进行任何更改。否则，如果开发人员正在开发将花费他们足够长的时间（即几天）的特定功能，也许您可​​以谈论在服务器上为开发人员提供自己的分支。

在某些情况下签入注释掉的代码并没有错，只是在这种情况下，可能会有更好的方法来做到这一点，因此开发人员可以跟踪对他的源代码的更改，*即使*它还没有准备好签入到主存储库。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2009-06-11T04:57:54.930

显然，签入注释掉代码的开发人员应该在单独的分支中工作，必要时合并来自主干分支的更改。

由 VCS 系统来协助开发人员完成这个工作流程（git 是一个非常出色的 VCS 系统，可以很好地使用它）。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-04-16T22:48:48.197

我不知道——我总是在进行更改之前注释掉**原来**的行——如果我改变主意，它可以帮助我恢复原状。是的，我确实检查了它们。

但是，我确实从以前的签入中删除了任何旧的注释代码。

我知道我可以查看差异日志以了解发生了什么变化，但这很痛苦——很高兴在代码中看到最后的变化。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2009-04-17T00:26:32.567

我认为签入注释掉的代码应该是有效的，因为新更改通过了测试，因此查看之前的内容并查看新更改是否真的是一种改进可能会更有帮助。

如果我必须返回几个版本才能看到现在导致性能下降的早期更改，那将非常烦人。

有时，注释掉的代码是一个很好的历史记录，但是，请注明代码被注释掉的日期。稍后，在附近工作的人可以删除注释掉的代码，因为它已被证明不需要。

知道谁注释掉了该代码也很好，这样如果需要一些理由，那么可以询问他们。

我更喜欢编写新功能，确保单元测试通过，签入，然后允许其他人使用它并查看它是如何工作的。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2009-04-16T23:45:26.267

一个不错的折衷方案是编写一个小工具，将签出/修改的文件转储到网络备份驱动器。这样，您可以修改直到您的心脏内容并备份您的工作，但您永远不必签入实验性或未完成的代码。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2009-12-21T08:06:07.570

在 C++ 中，我使用`#if 0`注释代码并发现它是合法的。**重构**工具仍在处理它，因此从技术上讲，它几乎得到了维护。并且，它通过语法突出显示明显地**着色。**

我认为这样的功能对所有人都有用：

*   此代码不可操作
*   它仍然属于这里
*   在这一点上它必须非常明显，因为它是相关的。

如果没有**真正的注释**来解释这段代码的特殊之处以及为什么它如此重要，请务必删除注释代码，尽管它无法操作。

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2009-04-16T22:50:56.477

我认为注释掉的代码有更好的选择。

允许该其他开发人员签入临时或实验代码的一个选项是拥有每个开发人员的#defines（假设您使用的是支持它的语言）。

我曾在每个编码员都有自己的#define 的地方工作，匹配他们的用户名，他们可以将其用于只有他们感兴趣的事情。最终，当代码准备好进入黄金时段时，#if 检查被删除。

例如你可能有

```
#if JOEBLO
// This code is experimental

// ... code goes here ...

#endif // JOEBLO 
```

关于[Rex M 的回答](https://stackoverflow.com/questions/758279/checking-in-of-commented-out-code/758288#758288)，我认为有时您想要进行的增量签入（记录进度）功能不足以为每个人启用。在这种情况下，#define 很有用。

另一种选择是在本地使用像 Mercurial 这样的 DVCS 来跟踪您的更改，然后当您达到稳定的“为公众准备就绪”状态时，您将这些更改推送给团队。不过要小心一次提交太多。

# javascript - 在设计模式中查找 iframe 的内容何时发生变化

> ID：758280
> 
> 赞同：4
> 
> 时间：2009-04-16T22:24:44.387
> 
> 标签：javascript, html, dom, midas-editor

我有一个启用[了 designMode](http://www.mozilla.org/editor/midas-spec.html)的 iframe 。很简单，如果 Iframe 中的光标移动或内容发生变化，我希望调用一个回调函数。一开始看起来很简单，但我不能在 iframe 上使用 onchange/onkeyup。

我假设我需要向 iframe 的成员添加一个事件。我试过了

```
frames['writer'].document.body.onkeyup = eventHandler 
```

没有成功。

* * *

**更新**

我发现设置`designMode = 'on'`导致了问题。如果我注释掉将 designMode 设置为的行，`'on'`那么处理事件就可以正常工作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-17T12:57:04.493

好的，我有一个解决方案：

```
if(document.addEventListener)
{
    frames['writer'].document.addEventListener('keyup', updateStatus, false);
    frames['writer'].document.addEventListener('mouseup', updateStatus, false);
} 
```

它很有魅力！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T23:43:29.050

尝试编写一个名为 document.onkeyup 的函数：

```
function document.onkeyup() {
  // do stuff
} 
```

我以前从未见过这种风格，但这只是我在谷歌上找到的……

# qmake - 如何将带有 qmake 的动态库链接到我的应用程序中？

> ID：758290
> 
> 赞同：3
> 
> 时间：2009-04-16T22:27:31.667
> 
> 标签：qmake

在我的 qmake .pro 文件中，我将所需的动态库添加到 LIB，它允许编译但不链接到已编译应用程序中的库（即在运行时出现库未找到错误）。

问题是我的构建目录中有库，而不是系统目录（即/usr/lib）。但是，我想生成一个不接触 .app 文件夹之外的系统的 OSX 应用程序。

另外，我会链接以了解如何在 linux 系统上执行此操作 - 可能吗？

我的问题与[Qmake 生成正确的 .app 问题有关](https://stackoverflow.com/questions/26904/getting-qmake-to-generate-a-proper-app)，但不同之处在于回答该问题的链接没有回答我的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T23:01:14.627

在您的程序周围放置一个包装脚本，以便当前工作目录位于动态库搜索路径中：

```
#!/bin/bash
export  LD_LIBRARY_PATH=$LD_LIBRARY_PATH:.
./program 
```

# vba - Excel 不会自动适应 45º 文本

> ID：758306
> 
> 赞同：2
> 
> 时间：2009-04-16T22:32:13.247
> 
> 标签：vba, excel

当我将列标题定向在 45º 时，我必须手动调整每列的大小，因为自动调整不会让定向文本与相邻单元格重叠。

有没有办法以编程方式（使用 VBA）自动调整它们将重叠的列？我想要一个也考虑字体大小的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T13:09:54.603

*您需要做的是自动调整到不包括*标题行的单元格范围：

```
子 autofitToRange()
    Range("B2:F5").Columns.AutoFit
结束子
```

代替：

```
子 autofitFullColumns()
    Range("B:F").Columns.AutoFit
结束子
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-06T23:10:36.193

当具有定向文本的单元格设置了边框时，自动调整仅适用于非 0º 定向文本。奇怪的...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T22:57:42.280

```
SheetName.Range("a:c").Columns.EntireColumn.AutoFit 
```

将自动调整 Sheet 中的 a - c 列`SheetName`。这是你要找的吗？

# mysql - Ruby on Rails 无法从运行器脚本连接到数据库

> ID：758308
> 
> 赞同：2
> 
> 时间：2009-04-16T22:33:48.937
> 
> 标签：mysql, ruby-on-rails

在我的应用程序中，我有一个按计划运行的运行器脚本（crontab），它需要连接到数据库并获取一些信息。当我尝试运行查询（使用 Model.find(...) ）时出现以下错误：

```
.../vendor/rails/railties/lib/commands/runner.rb:45: .../vendor/rails/activerecord/lib/active_record/connection_adapters/mysql_adapter.rb:471:in `real_connect': Can't connect to local MySQL server through socket '/var/run/mysqld/mysqld.sock' (2) (Mysql::Error) 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T23:08:31.550

通常，由于路径（因此您没有看到正确的 database.yml 或其他内容）或权限（您没有以正确的用户身份执行此操作），会发生这种事情。

通常对我有用的模式是像这样放置一个 crontab 条目：

```
cd path/to/rails/app-root; script/runner MyController.thing_to_do 
```

在应用程序运行的（伪）用户的 crontab 中。

# actionscript-3 - 如何修改现有的 AS3 事件以便可以传递数据？

> ID：758322
> 
> 赞同：7
> 
> 时间：2009-04-16T22:39:05.693
> 
> 标签：actionscript-3, events, listener, observer-pattern

所以我想要一种设置事件的方法，这样我就可以在不创建闭包\内存泄漏的情况下传递数据。据我所知：

```
package com.events {
    import flash.events.Event;

    public class CustomEvent extends Event {
        public static const REMOVED_FROM_STAGE:String = "removedFromStage";
        public var data:*;

        public function CustomEvent(type:String, customData:*=null, bubbles:Boolean=false, cancelable:Boolean=false) {
            super(type, bubbles, cancelable);
            this.data = customData;
        }

        public override function clone():Event {
            return new CustomEvent(type, data, bubbles, cancelable);
        }

        public override function toString():String {
            return formatToString("CustomEvent", "type", "data", "bubbles", "cancelable", "eventPhase");
        }
    }
} 
```

这让我有以下行为：

```
function testme(e:Event) {
    trace(e); 
}

test_mc.addEventListener(CustomEvent.REMOVED_FROM_STAGE, testme);
test_mc.dispatchEvent(new CustomEvent(CustomEvent.REMOVED_FROM_STAGE, 42));
//Traces [CustomEvent type="removedFromStage" data=42 bubbles=false cancelable=false eventPhase=2]
removeChild(test_mc);
//Traces [Event type="removedFromStage" bubbles=false cancelable=false eventPhase=2] 
```

我的目标是获取我想要传递的自定义数据，以便从事件闪光触发中传递，而不仅仅是我触发的那个。例如，如果我想传递一个movieclip 和一个loader.COMPLETE 事件来放入生成的位图怎么办？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T02:21:36.190

您扩展了 Event 类以使用额外的数据进行分派，现在如果您希望 Loader 类分派您的自定义事件类型，请扩展 Loader 类来执行此操作（或您想要执行此操作的任何其他类）。在这个例子中，我将用这个功能覆盖 URLLoader（因为 Loader 实际上从它的 contentLoaderInfo 调度事件，它需要两个被覆盖的类，我只是想保持简单）

```
 package com.net
{
    import flash.net.URLLoader;
    import flash.events.Event;

    import com.events.CustomEvent;

    public class CustomLoader extends URLLoader
    {
        // URLLoader already has a data property, so I used extraData
        public var extraData:*;

        override public function dispatchEvent(event: Event) : Boolean
        {
            var customEvent: CustomEvent = new CustomEvent(event.type, extraData, event.bubbles, event.cancelable);
            return super.dispatchEvent(customEvent);
        }
    }
} 
```

现在要将其与您的 CustomEvent 类一起使用，请在您的 .fla 中尝试此代码

```
 import com.net.CustomLoader;
import com.events.CustomEvent;

var loader: CustomLoader = new CustomLoader();
loader.extraData = "Extra Data";
loader.load(new URLRequest("test.xml"));
loader.addEventListener(Event.COMPLETE, loadComplete);

function loadComplete(event: CustomEvent) : void
{
    trace(event.data); // Extra Data
} 
```

砰！关于您天生发送的事件的自定义数据！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T05:44:07.403

下面显示了创建自定义事件的最简洁的方法。通常事件类型具有以所有大写字母键入的公共静态引用。调度事件时，它会将一个 Event 或 CustomEvent 对象传递给事件处理程序方法。您可以在此处检索传递的值。

```
package com.hodgedev.events 
{
    import flash.events.Event;

    public class CustomEvent extends Event 
    {
        public static const VALUE_CHANGED:String = "VALUE_CHANGED";
        public var value:Number;

        public function CustomEvent(pValue:Number) 
        { 
            super(CustomEvent.VALUE_CHANGED);
            value = pValue;
        } 
        public override function clone():Event 
        { 
            return new CustomEvent(value);
        }
    }
} 
```

当我们派发事件时，我们会创建一个新的事件实例来传递。

```
private var _someValue:int = 12;
dispatchEvent(new CustomEvent(_somevalue)); 
```

# jquery - Sifr 不显示自定义/动态文本

> ID：758326
> 
> 赞同：0
> 
> 时间：2009-04-16T22:41:02.303
> 
> 标签：jquery, plugins, sifr

我在这里使用 sifr 插件：http: [//jquery.thewikies.com/sifr/](http://jquery.thewikies.com/sifr/)

我使用[http://www.sifrgenerator.com/生成了一个 swf](http://www.sifrgenerator.com/)

我将构建设置为 436，版本设置为 3。

我的页面只显示生成器在 swf 中设置的默认文本。当我尝试将内容属性设置为让我们说“你好”时，它仍然显示默认文本。但是，如果您查看生成的 html，您会看到“txt”闪存变量设置为“hello”。生成的 swf 有问题吗？也许没有设置“动态文本”选项？有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T19:51:16.003

jQuery sIFR 插件基于 sIFR 2，与 sIFR 3 不兼容。

# sql - 使用VB.NET访问远程sql server

> ID：758329
> 
> 赞同：0
> 
> 时间：2009-04-16T22:42:22.380
> 
> 标签：sql, mysql, vb.net, visual-studio-2008

我发现了一些使用 vb.net 访问 sql 数据库的示例，到目前为止，它们都没有奏效。它们都涉及使用 DataReaders。也许是因为 sql db 与应用程序不在同一台机器上。

我只是想知道是否有人有使用 VB.NET 访问远程 sql 服务器的更全面的示例。

谢谢！

编辑：我已经收到了一些有用的评论和回复。到目前为止，我的连接字符串看起来像：“server=sqlblah.myhost.com;uid=myuser;pwd=pass;database=testdb”

可能还值得一提的是，他们没有编辑表格这一点，只是阅读。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T22:50:12.140

查看 SQLClient 类。

访问 SQL 数据库的一种方便的方法是使用 DataAdapter 对象用查询数据填充 DataSet 对象。

```
Dim sSQL As String = "SELECT * FROM ???"
Dim conn As New SqlClient.SqlConnection("connection string")
Dim da As New SqlClient.DataAdapter(sSQL, conn)
Dim ds As New DataSet

da.Fill(ds, "TABLE NAME") 
```

然后，您可以访问 DataSet 对象中的“TABLE NAME”表。“连接字符串”显然是您的 SQL 连接字符串。根据需要使用 sSQL 字符串进行查询。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T10:18:37.650

快速旁注 - 用于创建连接字符串的有用工具：-

打开一个文本文档（记事本、写字板等）并保存一个扩展名为“.UDL”的空白文档。这将为您提供一个“数据链接属性”迷你应用程序。

打开应用程序并将“提供程序”中的提供程序更改为您需要的任何提供程序（在本例中为 SQL Server 的 OLE DB 提供程序）。

然后，您需要在连接选项卡中建立连接。一旦您选择了条件（服务器名称（下拉列表将显示所有可见的服务器）、安全权限、数据库（此下拉列表将根据所选服务器填充））您可以测试您的连接（以确保您有权限等）。

单击确定关闭应用程序，将文件重命名为具有“.txt”扩展名并在文本编辑器中重新打开，嘿presto，一个建立的连接字符串（如下）。

`Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security Info=False;Initial Catalog=YOURDBNAME;Data Source=YOURSERVERNAME`

# .net - 权威的 dot.net 单点登录解决方案 - 开发、窃取还是购买？

> ID：758330
> 
> 赞同：3
> 
> 时间：2009-04-16T22:42:58.227
> 
> 标签：.net, single-sign-on

问题：我们的环境中有几十个一次性应用程序分散在十几台服务器上。一些应用程序通过基于一次性表单/数据库的登录来保护。某些应用程序具有在 web.config 中定义的权限。一些应用程序设置了文件夹级别的 NTFS 权限（一些具有域用户帐户，一些具有外部用户的本地用户帐户）。不用说，这绝对是一团糟。

SSO 解决方案绝对合适，但我应该构建一个、利用现有的 FOSS 解决方案还是购买一个（如果是，哪些？）

我需要能够

*   通过表单登录验证一次，登录令牌自然会从服务器传送到服务器
*   混合匹配域帐户（首选）并为外部用户创建数据库表帐户
*   具有集中的角色/权限管理
*   在用户使用 AD/域帐户进行身份验证的情况下，使用同一帐户允许他们使用的任何应用程序通过集成身份验证连接到数据库
*   一个门户会很好

如果有人能提供一些指导，我将非常感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-09T10:29:03.170

NoCarrier，我假设您使用的是 .NET 平台？

如果是这样，我可以建议你扮演自己的角色。编写一个程序集，包装各种认证要求；将它们暴露在共同的抽象之下。IPrincipal 很常见，或者（可以说很忙）[AuthenticablePrincipal](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.authenticableprincipal_members.aspx) ABC 可能很合适？

根据经验，我建议您尝试将权限基础架构迁移到通用技术。如果您已经拥有 AD，它可能是最好的。如果是这样，请继续阅读：

对于 AD 集成，请查看[System.DirectoryServices.AccountManagement.PrincipalContext](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.principalcontext_members.aspx)

[我怀疑这里的ValidateCredentials](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.principalcontext.validatecredentials.aspx)对你特别有用。从 PrincipalContext 您可以实例化[UserPrincipal](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.userprincipal_members.aspx)，其中包括权限请求，我假设（希望）满足您构建自定义门户的许多要求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T23:13:07.827

ISA Server 2006 可能正是您想要的。（大致。）。
请参阅：http: [//www.microsoft.com/forefront/edgesecurity/isaserver/en/us/default.aspx](http://www.microsoft.com/forefront/edgesecurity/isaserver/en/us/default.aspx)

这可以支持基于表单的身份验证，以及针对活动目录的 SSO。

它需要对您现有的系统进行一些标准化，但是我更喜欢这条路线，而不是自己编写。

与标准有关：

*   ISA Server 2006 可以做到这一点。
*   我不完全确定您所说的第一部分是什么意思，但是您稍后提到了 AD 的使用，我建议您将所有安全性合并到 Active Directory 中，包括外部用户和权限，并将其用作管理的主要工具他们。
*   见上点。
*   这很好，您只需要相应地配置您的 IIS/web.config。
*   不确定您是否要创建门户，或者您是否希望该工具将门户用作其 UI？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T22:57:24.450

我先说..**不要偷它！**

我相信你会得到更完整的答案，但简而言之，从长远来看，你自己开发这个看起来会更好。您正在以一种没有现有产品（据我所知）真正打算处理的方式支持一个凌乱的产品。

这样，您将能够逐步将系统开发成更好、更强大的系统。添加新应用程序？设计它来做正确的事情。我没有看到更好的选择/现有产品来实现这一目标。

# java - 如何设计具有基类中没有的功能的子类？

> ID：758340
> 
> 赞同：5
> 
> 时间：2009-04-16T22:48:37.683
> 
> 标签：java, oop

例如，假设我有一个类 Vehicle，我希望有一个子类 ConvertibleVehicle，它有额外的方法，如 foldRoof()、turboMode()、foldFrontSeats() 等。我希望实例化如下

```
Vehicle convertible = new ConvertibleVehicle() 
```

所以我仍然可以使用 openDoor()、startEngine() 等常用方法。我如何设计这样的解决方案？

为了澄清我的两个初始解决方案，我都不满意：

1.  有我只在 ConvertibleVehicle 中覆盖的虚拟方法 foldRoof()、turboMode()、foldFrontSeats()，让它们在其他子类中什么也不做
2.  具有抽象方法 foldRoof()、turboMode()、foldFrontSeats() 并强制每个子类提供一个实现，即使它在 ConvertibleVehicle 以外的所有实例中都是空白的

上面看起来有点复杂，因为它们都污染了基类，因为我添加了越来越多的子类，每个子类都有自己独特的功能

在阅读了一些回复之后，我的设计中可能存在某种类型的根本缺陷。假设我有一个 VehicleFleet 类，它接收车辆并指示它们按如下方式驾驶：

```
public VehicleFleet(Vehicle[] myVehicles) {

    for (int i=0; i < myVehicles.length; i++) {
        myVehicles[i].drive();
    }
} 
```

假设这适用于车辆的数十个子类，但对于 ConvertibleVehicle，我还想在驾驶前折叠车顶。为此，我将 VehicleFleet 子类化如下：

```
public ConvertibleVehicleFleet(Vehicle[] myVehicles) {

    for (int i=0; i < myVehicles.length; i++) {
        myVehicles[i].foldRoof();
        myVehicles[i].drive();
    }
} 
```

这给我留下了一个混乱的函数 foldRoof() 卡在它并不真正属于的基类中，它仅在 ConvertibleVehicle 的情况下被覆盖，在所有其他情况下什么都不做。该解决方案有效，但似乎非常不优雅。这个问题是否适合更好的架构？

我正在使用 Java，尽管我希望可以找到一个通用的解决方案，该解决方案适用于任何面向对象的语言，并且我不需要依赖特定于语言的怪癖

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T23:53:25.843

任何使用 Vehicle 的对象都不应该知道 ConvertibleVehicle 及其专用方法。在适当的松耦合面向对象设计中，Driver 只会知道 Vehicle 接口。Driver 可能会在 Vehicle 上调用 startEngine()，但要由 Vehicle 的子类来覆盖 startEngine() 以处理不同的实现，例如转动钥匙与按下按钮。

考虑查看以下两个链接，这将有助于解释这个概念： http: [//en.wikipedia.org/wiki/Liskov_substitution_principle](http://en.wikipedia.org/wiki/Liskov_substitution_principle) [http://en.wikipedia.org/wiki/Open/closed_principle](http://en.wikipedia.org/wiki/Open/closed_principle)

考虑发布一个您认为会导致您在此处描述的困境的现实世界问题，并且有人会非常乐意展示更好的方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T23:26:01.417

这是一个很好的问题。这意味着您拥有（或期望拥有）要求车辆（例如） foldRoof() 的代码。这是一个问题，因为大多数车辆不应该折叠车顶。只有知道它正在处理 ConvertibleVehicle 的代码才应该调用该方法，这意味着它应该是仅在 ConvertibleVehicle 类中的方法。这种方式比较好；一旦您尝试调用 Vehicle.foldRoof()，您的编辑器就会告诉您它无法完成。这意味着您要么需要安排代码以便知道您正在处理 ConvertibleVehicle，要么取消 foldRoof() 调用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T02:40:12.493

我在类似的情况下这样做过。

选项 A)

如果专用操作与基本操作属于同一序列的一部分（例如，ConvertibleVehicle 需要为 foldRoof 才能驱动），那么只需将专用操作放在基本操作中即可。

```
class Vehicle { 
     public abstract void drive();
}

class ConvertibleVehicle { 
     public void drive() { 
         this.foldRoof();
         .... // drive 
     }
     private void foldRoof() { 
         ....
     }
 } 
```

因此，驾驶车队的效果是，其中一些车队会在驾驶前折叠车顶。

```
 for( Vehicle v : vehicleFleet ) { 
      v.drive();
 } 
```

专用方法不暴露在对象公共接口中，而是在需要时调用。

选项 B)

如果专用操作不是同一序列的一部分并且必须在某些“特殊”情况下调用，则让客户端的专用版本调用这些专用操作。警告，这不是那么纯粹或低耦合，但是当两个对象（客户端和服务）由相同的“条件”或构建器创建时，大多数时候都可以。

```
class Vehicle { 
    public void drive() { 
        ....
    }
}
class ConvertibleVehicle extends Vehicle { 
         // specialized version may override base operation or may not.
        public void drive() { 
          ... 
         }

         public void foldRoof() { // specialized operation 
             ...
         }
 } 
```

与前面的示例几乎相同，只是在这种情况下**foldRoof**也是公共的。

不同之处在于我需要一个专门的客户：

```
// Client ( base handler ) 
public class FleetHandler { 
     public void handle( Vehicle [] fleet ) { 
           for( Vehicle v : fleet ) {  
               v.drive();
            }
     }
}

// Specialized client ( sophisticate handler that is )  
 public class RoofAwareFleetHandler extends FleetHandler { 
      public void handle( Vehicle [] fleet ) { 
           for( Vehicle v : fleet ) { 
              // there are two options.
              // either all vehicles are ConvertibleVehicles (risky) then
              ((ConvertibleVehicles)v).foldRoof();
              v.drive();

              // Or.. only some of them are ( safer ) .
              if( v instenceOf ConvertibleVehicle ) { 
                  ((ConvertibleVehicles)v).foldRoof();
              } 
              v.drive();
            }
       }
  } 
```

那个**instaceof**在那里看起来有点难看，但它可能被现代 vm 内联。

这里的重点是只有专门的客户端知道并且可以调用专门的方法。也就是说，只有**RoofAwareFleetHandler**可以在 ** ConvertibleVehicle** 上调用**foldRoof()**

最终代码不变...

```
 public class Main { 
     public static void main( String [] args ) { 
         FleetHandler fleetHandler = .....
         Vehicles [] fleet =  ....

          fleetHandler.handle( fleet );
      }
 } 
```

当然，我总是确保fleethandler 和Vehicles 数组兼容（可能使用abstrac factory 或builder）

我希望这有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T22:54:12.287

这正是子类化所做的：添加基类中不存在的功能。

```
class MyVehicle : public Vehicle {

public: 
  void MyNewFunction()
... 
```

有两种（实际上只是）不同风格的继承：公共和私有，分别反映 Is-A 和 Has-A 关系。使用公共继承，您可以直接将内容添加到类中。如果我有带有方法 Eat() 和 Walk() 的 Animal 类，我可以创建一个名为 Cat 的子类，它具有 Purr() 方法。然后，猫具有公共方法 Eat、Walk 和 Purr。

然而，在基于 LinkedList 的 Stack 的情况下，我可以说 Stack 在内部有一个 LinkedList。因此，我不会公开公开基类的任何特性，我将它们保留为私有，并且必须明确提供我选择的任何公共特性。一个列表可能有一个方法 Insert()，但对于 Stack，我限制了实现并将其重新暴露为 Push()。没有公开以前的公共方法。

在 C++ 中，这是由在基类之前给出的访问修饰符定义的。上面，我使用的是公共继承。在这里，我使用私有继承：

```
class MyVehicle : private Engine { 
```

这反映了 MyVehicle HAS-An Engine。

最终，子类化会获取基类中可用的所有内容并向其添加新内容。

**编辑：** 有了这些新信息，您似乎真正在寻找的是先前（否决）评论中所述的接口。这是继承的大问题之一——粒度。C++ 最大的抱怨之一是它实现了多重继承（实现这一点的一种选择。）您能否具体说明您正在使用什么语言，以便我们可以提供适当的建议？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T23:54:59.520

我认为大多数人都忽略了 Delta 问题的重点。在我看来，他/她并没有问什么是继承。他/她正在询问子类实现了不适合基类的功能，以及随之而来的混乱。即，将特定方法/功能推向层次结构链，或要求子类为不适合的功能实现合同。

还有一个问题是在每种情况下都能够将基类视为子类是否有价值（以避免强制转换并互换使用它们）。*编辑——这被称为里氏替换原则（感谢凯尔提醒我）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-17T17:51:33.600

为了补充凯尔·W·卡特梅尔的出色回答，或许可以稍微简化奥斯卡·雷耶斯的回答……

您可能需要考虑让基类定义一个名为的方法`prepareToDrive()`，继承的类可以在其中放置需要在启动之前完成的任何设置任务。调用`drive()`将是从用户的角度启动一切的方式，因此我们需要将驱动器重构为“设置”阶段和“开始”阶段。

```
public class Vehicle {
    protected void prepareToDrive() {
        // no-op in the base class
    }

    protected abstract void go();

    public final void drive() {
        prepareToDrive();
        go();
    }
} 
```

现在，子类必须实现受保护的方法 go() （方法名称确实很糟糕，但您明白了），这是它们进行特定于类的驾驶处理的地方。

现在，您继承的类可能如下所示：

```
public class ConvertableVehicle extends Vehicle {

    // override setup method
    protected void prepareToDrive() {
        foldRoof();
    }

    protected void go() {
        // however this works
    }

    protected void foldRoof() {
        // ... whatever ...
    }
} 
```

当您遇到 TractorTrailerRig 类时，该结构也将有所帮助，该类需要确保拖车已加载并正确连接，然后才能行驶。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-17T00:57:05.097

Vehicle 的用户如何知道它是 ConvertibleVehicle？要么他们需要动态转换以确保它是正确的，要么你已经在 Vehicle 中提供了一个方法来获取对象的真实类型。

在第一种情况下，用户已经将 ConvertibleVehicle 作为动态投射的一部分。他们可以只使用新的指针/引用来访问 ConvertiblVehicle 的方法

在第二种情况下，用户使用 Vehicles 方法之一验证对象类型，他们可以将 Vehicle 转换为 ConvertibleVehicle 并使用它。

一般来说，铸造是一个坏主意。尝试用基类指针做所有事情。您的汽车示例效果不佳，因为方法级别太低，请构建更高级别的虚拟功能。

说了这么多。我需要来自基类的所有派生类方法。我本可以强制转换为派生类，但它涉及到一个框架并且需要更多的努力。古老的格言“所有问题都可以通过多一层间接来解决”是我解决这个问题的方法。我用我想调用的函数的“名称”在基类中调用了一个虚拟方法。'Name' 可以是字符串或整数，具体取决于您的需要。它速度较慢，但​​如果您的类层次结构足够富有表现力，您应该很少需要这样做。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-12T15:53:23.333

正如您所描述的那样，拥有`ConvertibleVehicle`子类`Vehicle`并添加自己的方法是非常好的。设计的那部分是可以的。你遇到的麻烦是舰队。*不*`ConvertibleFleet`应该是 的子类。一个例子会告诉你为什么。假设是这样的：*`VehicleFleet``VehicleFleet`*

 *```
public class VehicleFleet {
    // other stuff...

    public void add(Vehicle vehicle) {
        // adds to collection...
    }
} 
```

这是非常好的和明智的，您可以将`Vehicle`它的任何或子类添加到`VehicleFleet`. 现在，假设我们还有另一种车辆：

```
public class TruckVehicle extends Vehicle {
    // truck-specific methods...
} 
```

我们也可以将其添加到 a 中，`VehicleFleet`因为它是车辆。问题是这样的：如果`ConvertibleFleet`是 的子类`VehicleFleet`，这意味着我们也可以将卡车添加到`ConvertibleFleet`。那是错误的。A`ConvertibleFleet`不是正确的子类，因为*对*其父类有效的操作（添加卡车）对子类无效。

典型的解决方案是使用类型参数：

```
public class VehicleFleet<T extends Vehicle> {
    void add(T vehicle) {
        // add to collection...
    }
} 
```

这将允许您定义特定于某些车辆类型的车队。请注意，这也意味着没有`VehicleFleet`可以传递给不关心车队拥有哪种车辆的函数的“基”类。这可以使用另一层基类（或接口）来解决：

```
public interface VehicleFleetBase {
    Vehicle find(String name);
    // note that 'add' methods or methods that pass in vehicles to the fleet
    // should *not* be in here
}

public class VehicleFleet<T extends Vehicle> {
    void add(T vehicle) {
        // add to collection...
    }

    Vehicle find(String name) {
        // look up vehicle...
    }
} 
```

对于将车辆从车队中拉出并且不在乎它们是什么类型的方法，您可以绕过`VehicleFleetBase`。需要插入车辆的方法使用`VehicleFleet<T>`安全的强类型。

# ruby-on-rails - 获取指定字符串之间的数字

> ID：758343
> 
> 赞同：0
> 
> 时间：2009-04-16T22:50:26.477
> 
> 标签：ruby-on-rails, ruby, regex

行。举个例子：

[http://example.com/news/3226-some-post-title.html](http://example.com/news/3226-some-post-title.html)

我正在尝试获取 3226。这个正则表达式：http://interaktywnie.com/newsy/(.*).html 似乎不起作用。请帮忙。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T22:56:19.037

您可以使用：

```
 /\/(\d+)-(.*)\.html$/ 
```

这将抓取 '/' 之后的数字 (\d)，并在找到数字后将其放入第一个变量中。

测试正则表达式的好地方是[http://rubular.com/](http://rubular.com/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T22:57:29.503

你要这个：

```
/http:\/\/example.com\/news\/(\d+)-.+\.html/ 
```

\d 是任何数字。此外，以下站点对于 ruby​​ 中的正则表达式非常有用：

[http://www.rubular.com](http://www.rubular.com)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T00:42:03.497

```
"http://example.com/news/3226-some-post-title.html".split("/").last.to_i 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T23:00:19.573

试试这个模式：

```
/http:\/\/example\.com\/news\/(\d+)-.+\.html/ 
```

所以：

```
match = /http:\/\/example\.com\/news\/(\d+)-.+\.html/.match("http://example.com/news/3226-some-post-title.html")
puts match[1] 
```

# mysql - 根据另一个在 Mysql 中排序一个表，但没有看到第一个表的重复行

> ID：758346
> 
> 赞同：1
> 
> 时间：2009-04-16T22:51:01.733
> 
> 标签：mysql

在 MySql 中，我有两个表，A 和 B。

A 具有 A.id 列，B 具有 B.id 和 B.aid 列。

或者每一行AI有很多行B。而B.aid=A.id的值

当然。

现在我需要获取 A 中的值列表，但我需要根据 B 对它们进行排序。

特别是如果我在 A 中有两行：a1 和 a2。每个在 B 中都会有一系列行：b11、b12、b13、... 和 b21、b22、b23、... 现在我需要将 A 从与最高 b.id 连接的那个排序到第二高，以此类推。（当然有一行只出现一次）。

我试过这个：

```
SELECT a.id  FROM a, b WHERE a.id=b.aib ORDER BY b.id DESC 
```

我确实确实以正确的顺序获得了所有值，但是如果 n 是 B 中与 A 中该行相关的行数，则 A 的每个值都会出现 n 次。

我该如何避免这种情况，以便我只得到一个值。

我正在考虑采用整体列表，然后消除所有非唯一值，但我担心一旦网站变大，它可能不再可行。

（如果您想知道，这是对讨论板的传真进行编程，表 A 是线程，表 B 是条目，我想要一个显示所有线程的页面，但是在后面有最后一个动作的线程的顺序）

非常感谢，彼得罗

PS MySql 不是我的东西，所以请拼出解决方案:)

更新：实际代码更复杂，因为它还涉及用户等。所以我在看类似的东西：

```
SELECT DISTINCT a.id, a.question, a.roundid, a.phase, users.username, users.id  
FROM a, users, b 
WHERE a.phase = 0 AND users.id = a.usercreatorid AND b.experimentid = a.id 
ORDER BY b.id DESC 
```

我尝试了 DISTINCT，如下所示，但它不起作用。我确实得到了所有线程（即问题）的唯一性，但它们的顺序并不完美。我不知道为什么，但似乎他没有从 b 中选择随机行，这通常是朝着正确的方向发展，但它不是具有 max(b.id) 的行。所以 distinct 不会以正确的方式在行之间排序。我现在将看看提出的其他解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T23:03:33.233

```
select * from parent a 
order by ( select max(id) from child b where b.parent_id = a.id); 
```

NOTE WELL: this is not a join, so you'll get all rows in a, not just those that have a child in b.

You can see why if you do this:

```
select *, ( select max(id) from child b where b.parent_id = a.id)
from parent a 
order by ( select max(id) from child b where b.parent_id = a.id); 
```

(null sorts before anything else in an ascending sort.)

This avoids `group`ing or `distinct`ing, and has the advantage that the SQL pretty clearly states your intent, not a workaround to get at your intent, which makes it more self-commenting than some alternatives.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T22:55:06.793

据我了解，您需要按最新的相应 b.id 值排序的 a.id 值。

如果您有 1->many 关系并需要此类信息，您通常会查看 GROUP BY 来聚合数据，或者查看更复杂条件的子查询。

所以，这样的事情应该做到这一点，使用 group by：

```
SELECT 
   a.id, a.question, a.roundid, a.phase, 
   users.username, users.id, 
   MAX(b.id) AS latest 
FROM 
   a, users, b 
WHERE 
   a.phase = 0 AND users.id = a.usercreatorid AND b.experimentid = a.id 
GROUP BY a.id
ORDER BY latest DESC 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T22:58:36.707

您想使用 DISTINCT 关键字。

```
SELECT DISTINCT a.id  FROM a, b WHERE a.id=b.aib ORDER BY b.id DESC 
```

# apache - 通配符子域和静态子域的虚拟主机

> ID：758351
> 
> 赞同：83
> 
> 时间：2009-04-16T22:52:41.870
> 
> 标签：apache, subdomain, virtualhost, wildcard-subdomain

我有一个奇怪的情况，我想拥有 URL `app1.example.com`，`example.com`并且`*.example.com` 都使用不同的虚拟主机。这就是我所拥有的（不包括`example.com`因为它只会让它变得更混乱）。

```
<VirtualHost *>
  ServerName app1.example.com
  ServerAlias app1.example.com

  DocumentRoot = /var/www/app1
  # Other configuration for this app here

</VirtualHost>

<VirtualHost *>
  ServerName wildcard.example.com
  ServerAlias *.example.com

  DocumentRoot = /var/www/wildcard
  # other configuration for this app here

</VirtualHost> 
```

问题是它们冲突。谁先列出谁胜出。如何同时托管通配符虚拟主机和特定虚拟主机？

注意：我不只是`DocumentRoot`在配置中进行更改，因此使用`mod_rewrite`更改 DocumentRoot 变量并不能修复它。

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2009-04-16T23:02:58.290

```
<VirtualHost *:80>
  DocumentRoot /var/www/app1
  ServerName app1.example.com
</VirtualHost>

<VirtualHost *:80>
  DocumentRoot /var/www/example
  ServerName example.com
</VirtualHost>

<VirtualHost *:80>
  DocumentRoot /var/www/wildcard
  ServerName other.example.com
  ServerAlias *.example.com
</VirtualHost> 
```

应该管用。如果您没有明确匹配，第一个条目将成为默认值。所以如果你有 app.otherexample.com 指向它，它就会被 app1.example.com 捕获。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2018-02-20T20:28:52.993

通配符只能用在`ServerAlias`而不是`ServerName`. 让我难过的东西。

对于您的用例，以下内容就足够了

```
<VirtualHost *:80>
    ServerAlias *.example.com
    VirtualDocumentRoot /var/www/%1/
</VirtualHost> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-01-21T00:03:51.670

这也适用于 https 需要一个解决方案来制作项目目录就是这样。因为 chrome 不再喜欢非 ssl，所以不再使用免费的 ssl。注意：我的 Web 服务器是 Windows 10 上的 Wamp64，因此除非您使用 wamp，否则我不会使用此配置，因为存在变量。

```
<VirtualHost *:443>
ServerAdmin test@test.com
ServerName test.com
ServerAlias *.test.com

SSLEngine On
SSLCertificateFile "conf/key/certificatecom.crt"
SSLCertificateKeyFile "conf/key/privatecom.key"

VirtualDocumentRoot "${INSTALL_DIR}/www/subdomains/%1/"

DocumentRoot "${INSTALL_DIR}/www/subdomains"
<Directory "${INSTALL_DIR}/www/subdomains/">
    Options +Indexes +Includes +FollowSymLinks +MultiViews
AllowOverride All
Require all granted
</Directory> 
```

# domain-driven-design - 在不延迟加载的情况下访问聚合实体

> ID：758364
> 
> 赞同：3
> 
> 时间：2009-04-16T22:57:31.767
> 
> 标签：domain-driven-design, lazy-loading, entities

我想遵循 DDD 理念，而不是直接访问聚合的实体对象。所以，我必须调用根对象来获取关联的实体。但在其他情况下，我并不总是希望在调用根时加载每个关联实体。这是延迟加载的目的吗？

如果我禁用 linq 的延迟加载功能，如何通过根访问实体对象而不加载所有关联的对象？

编辑：

例如，如果我有一个人作为根实体，并且该人具有名称、地址和 OwnedProperties。如果我想获取人员列表以便显示他们的姓名，我不需要每次调用存储库时都加载拥有的属性。相反，在另一个页面上，我可能想要显示 OwnedProperties 列表，但不希望其他信息与调用一起加载。除了创建一个没有该拥有属性的新人员对象之外，仅调用没有拥有属性实体的 Person 的简单方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-05T08:43:33.610

根据您的编辑：我在这些情况下所做的是创建一个仅包含我感兴趣的属性的“视图”类或“DTO”类。例如，我可以有一个“PersonView”类，它只是例如，有一个 Name 属性。

然后，使用我的 OR/M 映射器（我使用 NHibernate），我创建了一个适用于我的“Person”实体的 HQL 查询（或 Criteria 查询）。在执行查询之前，我告诉 NHibernate 我想要“PersonView”对象作为结果（我指定了一个投影）。然后，NHibernate 足够聪明地执行一个查询，该查询只检索填充 PersonView 实例所需的列。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-05T08:33:28.170

我认为没有延迟加载是不可能的。

*   一次获取所有数据：急切加载
*   访问时获取数据：延迟加载

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-01-04T21:42:41.020

避免延迟加载的一种方法是使用对象“id”

# javascript - JavaScript form validation on server/local

> ID：758368
> 
> 赞同：0
> 
> 时间：2009-04-16T22:58:18.347
> 
> 标签：javascript, html

I'm using JavaScript form validation for the entry form for a contest I'm running. It's inline CSS so that if certain conditions aren't met, it displays, in red, messages that say "please enter your email address" or "that doesn't look like a valid email address" etc.

The script, which sits at the top of the file, looks like this:

```
<script>

function checkForm() {
  name = document.getElementById("name").value;
  email = document.getElementById("email").value;
  terms = document.getElementById("terms").value;

  if (name == "") {
    hideAllErrors();
    document.getElementById("nameError").style.display = "inline";
    document.getElementById("name").select();
    document.getElementById("name").focus();
    return false;
  } else if (email == "") {
    hideAllErrors();
    document.getElementById("emailError").style.display = "inline";
    document.getElementById("email").select();
    document.getElementById("email").focus();
    return false;
  } 

  else if (!check_email(document.getElementById("email").value)) {
    hideAllErrors();
    document.getElementById("emailError2").style.display = "inline";
    document.getElementById("email").select();
    document.getElementById("email").focus();
    return false;
  } 

  else if (!document.form1.terms.checked){
    hideAllErrors();
    document.getElementById("termsError").style.display = "inline";
    document.getElementById("terms").select();
    document.getElementById("terms").focus();
    return false;
  } 

  return true;
}

function check_email(e) {
  ok = "1234567890qwertyuiop[]asdfghjklzxcvbnm.@-_QWERTYUIOPASDFGHJKLZXCVBNM";

  for(i=0; i < e.length ;i++){
    if(ok.indexOf(e.charAt(i))<0){ 
      return (false);
    }   
  } 

  if (document.images) {
    re = /(@.*@)|(\.\.)|(^\.)|(^@)|(@$)|(\.$)|(@\.)/;
    re_two = /^.+\@(\[?)[a-zA-Z0-9\-\.]+\.([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
    if (!e.match(re) && e.match(re_two)) {
      return (-1);      
    } 
  }
}
function hideAllErrors() {
  document.getElementById("nameError").style.display = "none"
  document.getElementById("emailError").style.display = "none"
  document.getElementById("commentError").style.display = "none"
  document.getElementById("termsError").style.display = "none"
} 
```

The email and name validation work just fine, the part of the form that won't work looks like this:

```
<form onSubmit="return checkForm();" method="get" action="sweepstakes-results.php" 
<input type=checkbox name=terms id=terms ><br></p>
<div class=error id=termsError>Required: Please check the checkbox<br></div>
<p><input type=submit value=Send style="margin-left: 50px"> </p>
</form> 
```

The "terms and conditions" checkbox only works if the file is on my local machine, when I upload it, it just lets me submit the form even if it's not checked. Isn't JavaScript run on the browser? How could the location of the file make a difference?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T23:02:33.673

Your form doesn't have a name, so the following code won't work:

```
else if (!document.form1.terms.checked){ 
```

Since you're already retrieving the DOM object of the checkout, do the following. Change the line:

```
terms = document.getElementById("terms").value; 
```

to:

```
terms = document.getElementById("terms"); 
```

And the replace that else if code with:

```
else if (!terms.checked){ 
```

# ms-solution-framework - 需求签核

> ID：758375
> 
> 赞同：0
> 
> 时间：2009-04-16T23:01:00.290
> 
> 标签：ms-solution-framework

您在 MSF 中的哪里签署要求？您是否在规划阶段完成了功能规范的编写，然后在开始开发之前与客户签署了协议。

注意：我正在制定固定范围的固定价格合同，因此敏捷模型将不起作用。这是否意味着迭代和增量方法也不起作用。在这种情况下，我不能在完成规划阶段之前开始开发。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T23:13:49.980

如果它是固定范围、固定价格的合同，那么您肯定希望就完成的功能规范达成一致，以便每个人都对最终结果感到满意。

作为固定价格和范围的一部分，您最不想做的事情是开始开发既没有商定也没有必要的功能，因为这只是对时间的低效利用。

顺便问一下，什么是 MSF- [Microsoft 解决方案框架](http://en.wikipedia.org/wiki/Microsoft_Solutions_Framework)？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-10T11:27:18.063

是的，您当然希望在认真开始项目之前（甚至在收取押金之前）获得签字（或*项目参与*）

我做的几乎所有项目都是固定价格的

根据我的建议（这是可交付成果的高级列表），我有这个：

![替代文字](https://2.bp.blogspot.com/_TUs17IBrSL4/TAnfz5_XIBI/AAAAAAAAAQg/XZGhPKwC6Ms/s400/screenshot_0168.png)

您可以从这篇文章中获得有关签收/项目参与的更多信息：[编写简短易读的费用提案（第 2 部分）](http://pm4web.blogspot.com/2010/04/writing-short-easy-to-read-fee_04.html)

--LM

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T23:39:54.597

当您提到功能规格时，复数，您总是可以考虑签署其中一些功能，以便可以开始这些功能领域的开发，然后努力完成其他功能。这避免了在不属于最终交付的区域的潜在工作，同时允许工作开始。

[无国界医生](http://en.wikipedia.org/wiki/Microsoft_Solutions_Framework)的基本原则之一是

```
    保持敏捷，期待变化

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T23:42:10.347

在客户签订合同之前，我当然不会开始开发。在你给他们一个价格之前，我无法想象他们怎么能做到这一点。价格取决于时间。时间取决于客户想要支付的功能（您估计工作）。因此，这使我得出结论，在进行任何工作之前，您必须先完成规范。

这当然就是为什么固定价格和范围的概念一次又一次地被证明是低效的。

# svn - 哪些文件不添加到 svn 主干？

> ID：758379
> 
> 赞同：0
> 
> 时间：2009-04-16T23:02:02.520
> 
> 标签：svn, externals

我是否应该解决自己添加在我的项目中使用的第三方和 ajax 库 - 例如 tinyMCE 编辑器（超过 1800 个文件）或 fckEditor - 当我的项目不包含几乎一样多的文件时，只是为了编译？还是我应该稍后找到一种方法将其添加到构建中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T23:05:01.233

如果特定库具有公共 SVN 存储库，您可以将它们添加为[svn:external](http://weierophinney.net/matthew/archives/132-svnexternals.html) - 尽管我会将它们添加为特定的已知版本（在修订号或标签/分支上），而不仅仅是主干。

另一个替代方案是[SVN Vendor Branches](http://lookfirst.com/2007/11/subversion-vendor-branches-howto.html)，它涉及更多，但更强大。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T23:05:46.830

我总是将所有项目依赖项添加到源代码管理中。这样，另一个开发人员可以进行结帐（有时可以说是一个大的结帐）并准备好去，而不必弄清楚缺少什么并找到它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T23:08:18.290

处理这种情况的最佳方法是使用外部设备。这样第三方的东西就不是项目的一部分，但仍然在源代码控制中，并且仍然与其他所有东西一起检查。

这是 SVN 书中的部分： http: [//svnbook.red-bean.com/en/1.0/ch07s03.html](http://svnbook.red-bean.com/en/1.0/ch07s03.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T23:14:54.017

[使用Piston](http://piston.rubyforge.org/)管理依赖项，并通过[SVN externals](http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html)将您的项目链接到它们。这结合了对外部库的完全控制（不依赖于库的服务器性能）和存储库的整洁性（您最终不会在存储库中发现单个库的多个副本），同时允许您轻松地切换库的版本以项目为基础。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T00:01:46.383

正如大多数其他人所说，您可以使用[SVN 外部](http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html)来处理第三方代码，使其相当干净。有两种管理方法：

1.  使用您的外部参考直接链接到第三方存储库，可以选择链接到特定的修订和/或标签/分支。

2.  如果您担心第三方存储库的长期可用性，请创建自己的存储库来保存第三方代码，然后使用 svn:externals 来引用它。

第二种方法开销更大，意味着您需要手动获取第三方代码的更新并将它们应用到您的存储库中，这可以看作是优势或劣势。

# c# - 为什么 app.config 中的应用程序设置是只读的？

> ID：758389
> 
> 赞同：33
> 
> 时间：2009-04-16T23:04:48.020
> 
> 标签：c#, .net, app-config

我的 app.config 中有一些设置，我打算将其设置为“全局” - 即。任何用户都可以更改它们，并且所有用户都获得相同的设置。

但除非我将它们更改为用户设置，否则它们是只读的。

为什么是这样？

我应该如何坚持我的应用程序的全局设置？

**编辑：**

这实际上是一个 Windows 服务应用程序，它作为 LocalSystem 的服务运行。它也可以由本地管理员使用参数“/config”手动运行，它会启动一个 Windows 表单来编辑配置值。

所以它在这两种情况下都有写访问权`%PROGRAMFILES%`。

因此，我访问我的设置的方式是：

```
Settings.Default.MySetting = MyNewValue; 
```

当 MySetting 设置为 Application（在我的项目属性 Settings.settings 中）时，我收到一个编译时错误“MySetting 是只读的”。

我对这些东西很陌生，还没有找到一个很好的解释来说明它应该如何完成。例如，为什么我需要说“默认”，这实际上是什么意思？我不知道。如果有人可以向我指出 app.config 使用教程，那将非常有帮助。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-10-20T01:04:58.530

真正完整的答案：

app.config 设置是只读的，因为有两种类型的设置：

1.  应用程序设置
2.  用户设置

除非应用程序发布者发布它的新版本，否则第一个不会改变。第二个不存储在 app.config 中，而是存储在 user.config 文件中。在没有这个 user.config 文件的情况下，app.config 提供了默认值。

如果 MySetting 是用户设置：

```
Settings.Default.MySetting = MyNewValue;
Settings.Default.Save(); 
```

它将使用新设置创建一个`user.config`文件`[User Local Settings Application Data]\[company name]\[application].exe[hash string]\[version]`，并且这些设置将优先于`app.config`文件中的设置。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T23:10:11.220

**原因：**应用程序设置旨在存储在用户没有写入权限的 Program Files 下的 Application 文件夹中。

**如何：** “所有用户”没有默认支持，但您应该能够在公共文件夹中设置自己的自定义配置文件或使用数据库。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T02:21:25.473

简而言之：机器上没有任何位置可以更改，除非您授予这样做的权限。

有几种方法可以处理这种情况：

*   您可以创建一个配置文件/一些注册表设置，将其放在“所有用户”配置文件中，并授予“每个人”更改该特定文件的权限。在安装期间，您可以自动执行授予适当权限的过程，您的程序可以处理其余部分。

*   您可以利用 UAC 确保当前用户具有更改系统范围设置的适当权限。这是推荐的方法，但也意味着不是每个人都可以更改特定设置。

*   您可以使用共享数据库并将您的设置存储在其中。

*   ？？？

我不建议更改程序文件目录中的项目或更改那里的默认权限。

编辑：作为本地系统，您确实对程序文件目录具有写入权限。如果您收到“只读”错误，则表示设置本身是只读的。您需要使用配置管理器才能更改配置文件中的设置。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T23:12:24.803

原因之一是 app.config 文件位于 Program Files 目录下的应用程序文件夹中，并且默认情况下，Program Files 中的所有内容对于标准用户都是只读的。

另一个是 app.config 设置适用于系统范围。如果一个用户进行更改，它将影响其他用户。普通用户不应该能够进行这种更改。任何可能影响多个用户的内容都只能由系统管理员设置。每个用户的设置属于每个用户的应用程序数据文件夹。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T23:11:36.240

不太清楚你在这里的意思。您的意思是您允许用户从 UI 更改 app.config 并且更改不会保留？

你打电话了吗

```
ConfigurationManager.RefreshSection("appSettings"); 
```

和

```
Configuration.Save(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T23:14:27.840

启动应用程序时，配置设置会缓存在内存中。您可以将 app.config 文件作为 xml 处理以更改值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-08-28T22:25:06.067

我正在使用此代码（静态方法）来更改默认设置：

```
public static bool SetGlobalSetting(string settingName, string settingValue)
{
    try
    {
        XmlDocument xml = new XmlDocument();
        xml.Load(AppDomain.CurrentDomain.SetupInformation.ConfigurationFile);
        XmlNode xmlNode = xml.DocumentElement.SelectSingleNode("descendant::setting[@name='" + settingName + "']");
        xmlNode.SelectSingleNode("value").InnerText = settingValue;
        xml.Save(AppDomain.CurrentDomain.SetupInformation.ConfigurationFile);

        Settings s = new Settings();
        s.Reload();

        return true;
    } catch (Exception e)
    {
        // process the exception as you need
    }
        return false;
    }
} 
```

# struts2 - struts2 选择标签多个

> ID：758412
> 
> 赞同：0
> 
> 时间：2009-04-16T23:12:05.927
> 
> 标签：struts2

我正在使用 struts2 选择标签：[http ://struts.apache.org/2.0.14/docs/select.html](http://struts.apache.org/2.0.14/docs/select.html)

这是代码

```
<s:select name="fmrTenant.terminationReason" multiple="true"  headerKey="-1" list="rejectionReasons" value="%{fmrTenant.terminationReason}" required="true" size="10"/>

name="fmrTenant.terminationReason" 
```

参考以下代码

```
public void setTerminationReason(List terminationReason) {
    this.terminationReason = (String[])terminationReason.toArray();
} 
```

我的代码在这里有问题。存储来自选择框的值的变量的参数类型应该是列表吗？

我尝试在网上寻找解决方案，但似乎没有使用启用了多个属性的 struts2 select 标记并显示 java 方法应该是什么样子的示例。我感到很困惑。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T18:47:12.353

以下应该可以正常工作（假设 this.terminationReason 是 String[]）：

```
public void setTerminationReason(String[] terminationReason) {
    this.terminationReason = terminationReason;
} 
```

或者，如果 terminateReason 存储为列表，则以下内容应该有效：

```
private List terminationReason = new ArrayList();

public void setTerminationReason(List terminationReason) {
   this.terminationReason = terminationReason;
} 
```

# c# - 在 ItemTemplate 中使用 Container.DataItem

> ID：758418
> 
> 赞同：5
> 
> 时间：2009-04-16T23:15:13.890
> 
> 标签：c#, asp.net, data-binding

我无法让这个工作，我不知道为什么。

```
<ItemTemplate>
<% if (Field(((DataRowView)(Container.DataItem)), "Video File")  != "") {  %> 
<a href='upload/images/<%# Field(((DataRowView)(Container.DataItem)), "Video File")%>'>Download Link</a>
<% } else {  %>
<embed height="14" width="661" name="plugin" src="<%# ContentUploadURL%>/<%# Field(((DataRowView)(Container.DataItem)), "Audio File")%>" type="audio/mpeg" autostart="false" />
<% } %>
</ItemTemplate> 
```

看起来很简单，但我只是得到这个错误：

> 编译器错误消息：CS0103：当前上下文中不存在名称“容器”

我整天都在做这件事，而且我是一个在 asp 中从事 CMS 工作的新手。我真的不想学习 ASP，只是为了让这件事发挥作用。

如果有人能指出我正确的方向，我将非常感激。

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T23:25:46.440

您不能在数据绑定表达式 <%# ... %> 之外使用 Container.DataItem。

我建议您将代码更改为这样的内容（抱歉，我目前无法对其进行测试）：

```
<ItemTemplate>
  <asp:HyperLink runat="server"
    Visible='<%# Eval("Video File") != "" %>'
    NavigateUrl='<%# Eval("Video File")' Text="Download Link" />

  <embed runat="server" Visible='<%# Eval("Video File") == "" %>'
    height="14" width="661" name="plugin"
    src="<%# ContentUploadURL%>/<%# Field(((DataRowView)(Container.DataItem)), "Audio File")%>"
    type="audio/mpeg" autostart="false" />
</ItemTemplate> 
```

关键是根据数据项的“视频文件”字段设置两个控件的Visible属性。

另请参阅此问题：[ASP.Net 条件数据绑定](https://stackoverflow.com/questions/653486/asp-net-conditional-databinding)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T00:34:52.653

哦谢谢！那肯定有帮助。好的，所以我实际上需要更多的 html，所以我尝试了你指给我的占位符技术。

所以，我现在有这个：

```
<asp:PlaceHolder id="PlaceHolder1" runat="server" Visible='<%# Eval("Video File") != "" %>'>
Video Stuff
</asp:PlaceHolder>

<asp:PlaceHolder id="PlaceHolder2" runat="server" Visible='<%# Eval("Video File") == "" %>'>
Audio Stuff
</asp:PlaceHolder> 
```

它几乎可以工作，只是视频文件在两个实例上都可见，而它应该只在第一个实例上可见。

我也试过这个：

```
<asp:PlaceHolder id="PlaceHolder1" runat="server" Visible='<%# Eval("Video File") != "" %>'>
    Video Stuff
    </asp:PlaceHolder>

<asp:PlaceHolder id="PlaceHolder2" runat="server" Visible='<%# Eval("Audio File") != "" %>'>
    Audio Stuff
    </asp:PlaceHolder> 
```

但这使得两者都一直在展示。我觉得它快到了。

谢谢！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T00:51:19.167

哦，没关系，我明白了！！

这终于奏效了：

```
 <asp:PlaceHolder id="PlaceHolder1" runat="server" 
     Visible='<%# Field(((DataRowView)(Container.DataItem)), "Video File") != "" %>'>
    Video Stuff
    </asp:PlaceHolder>

    <asp:PlaceHolder id="PlaceHolder2" runat="server" 
     Visible='<%# Field(((DataRowView)(Container.DataItem)), "Video File") == "" %>'>
    Audio Stuff
    </asp:PlaceHolder> 
```

非常感谢**！**

# javascript - 为 Visual Studio 创建自定义 DTD

> ID：758420
> 
> 赞同：0
> 
> 时间：2009-04-16T23:17:37.270
> 
> 标签：javascript, xml, visual-studio, custom-controls, dtd

我有一些自定义模板控件，它们将 JavaScript 作为模板内容，如下所示：

```
<ns:Custom runat="server">
    <contentTemplate>
        var a = new Array();
        for (var i=0; i<a.length; i++) {
            // do something
        }
    </contentTemplate>
</ns:Custom> 
```

我希望 VisualStudio 将其内容视为与元素完全相同，以便代码着色生效，并且验证器不会在 for 循环定义中的“<”上呕吐。

我的理解是需要创建一个自定义 DTD 来解决这个问题。有谁知道如何做到这一点，有资源链接吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T15:49:37.043

我承认我不熟悉 VS 模板化控件，但这看起来像 XML（给定“ns:”命名空间），并且在 XML 中嵌入左尖括号而不将它们视为标签的标准方法是使用 CDATA：

```
<ns:Custom runat="server">
    <contentTemplate>
        <![CDATA[
        var a = new Array();
        for (var i=0; i<a.length; i++) {
            // do something
        }
        ]]>
    </contentTemplate>
</ns:Custom> 
```

# jquery - ASP.NET MVC + jqGrid 嵌入式链接最佳实践

> ID：758426
> 
> 赞同：0
> 
> 时间：2009-04-16T23:21:08.730
> 
> 标签：jquery, asp.net-mvc, jqgrid

我有一个 Mvc 应用程序，我用 jqGrid [XML] 替换了一些硬呈现的表。

问题是我的其中一列中有操作链接，可以对行执行某些操作。我在我的 XML 中使用 CDATA 标记复制了这些；但是问题是现在这个标签是在一个动作方法中生成的，所以所有的 HTML 都在我的控制器中（在 TagBuilder 中），这绝对不是很好。

我打算研究 RenderPartialExtensions 但你需要一个 HtmlHelper 实例，另外我正在使用 brail 视图引擎，所以我什至不确定它是否会工作。

其他人是如何处理这个问题的？
我想我可以创建一个像 html 一样呈现实际 xml 的视图，但是我需要为每个 xml 数据源创建一个视图，并且我已经有了这些。

预先感谢您的意见。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T02:25:18.897

我不确定您到底要问什么，但我有一些 XML 数据——用于豁免、发布等的法律术语——我在我的视图中呈现这些数据。我去了 HtmlHelper 扩展路线并创建了一个扩展，该扩展采用文档的 URL 和将其转换为 HTML 的 XSLT 样式表。我使用 LINQ XML 类在 MemoryStream 中加载 XML 并将其呈现为 HTML。然后它将它作为一个字符串返回，该字符串通过视图写入响应。如果您无权访问 HTML 帮助程序，则可以在静态类上编写类似于静态方法的内容（无论如何这就是扩展），但不使用扩展语法。这可以在您喜欢的任何视图中呈现。

我的代码示例：

```
 <%= Html.RenderXML( Url.Content( "~/App_Data/waiver.xml" ),
                     Url.Content( "~/Content/styles/waiver.xsl" ) ) %> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-19T23:22:27.483

澄清更多架构以及我最终如何解决它。我有以下项目/程序集：

1.  业务对象
2.  VB XML 反序列化库
3.  ASP.NET MVC 项目

VB XML 程序集处理仅处理业务（#1）模型的业务对象的序列化。所以我会输出一个像这样的XElement：

```
<invoice>
   <invoiceId>1234</invoiceId>
   <customer>Hudsucker Industries</customer>
   <otherBusinessData>etc, etc</otherBusinessData>
</invoice> 
```

问题出现了，我正在使用 jqGrid，我需要将元素添加到每个发票的某些操作中，所以我需要类似的东西：

```
<invoice>
   <actionHtml><![CDATA[   ...some HTML such as links... ]]></actionHtml>
   <invoiceId>1234</invoiceId>
   <customer>Hudsucker Industries</customer>
   <otherBusinessData>etc, etc</otherBusinessData>
</invoice> 
```

我让它工作，但我必须在控制器中生成所有 actionHtml，这显然不是一个很好的关注点分离，我丢失了我所有的 HtmlHelper 方法等。所以我最终如何以“正确”的方式解决它：

1.  使用 WebForms 视图（我的页面使用盲文视图）[所以我可以使用 ContentType 页面属性将其设置为 XML]。
2.  将我的原始业务对象的集合作为模型数据传递。
3.  循环模型集合，为视图中的每个发票构建 actonHtml 元素（因此得到我的 HtmlHelper 方法等）
4.  要输出实际的业务元素，我可以简单地调用我的 VB XML 库并执行以下操作：`invoice.ToXml().Elements().ToString()`我很好。

为了进一步提高它的可重用性，我创建了一个 jqGrid 母版页，其中包含所有记录计数等内容区域，因此我可以将这些信息传递到实际页面上，而只需担心输出元素数据。

# methodology - 固定范围/固定价格项目=瀑布吗？

> ID：758427
> 
> 赞同：0
> 
> 时间：2009-04-16T23:21:23.050
> 
> 标签：methodology

在客户发布 RFP 以根据特定技术和财务标准选择供应商的情况下，即在固定范围/固定价格项目中，是否可以使用除 WATERFALL 之外的任何方法。即增量/迭代方法可以工作吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T23:37:31.577

如果他们想要这种类型的提案，那么他们可能已经准备好为未知数支付变更单和大缓冲区（及时和 $$）的价格。您可以相应地出价。

但是一旦合同签订，最有效的方法就是它。而且，如果您要清除风险因素，尽早并经常交付等，您将受益于更快地编写这些变更单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T23:29:23.857

为什么不能进行迭代？您可以将任何规模的工作分块并进行设计-构建-测试迭代。我想您要问的是旨在处理变化或未定义范围的轻量级方法是否合适。我不明白为什么[FDD](http://en.wikipedia.org/wiki/Feature_Driven_Development)不合适，例如，仅仅因为你知道你要去哪里。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-24T10:47:50.663

我认为可以使用敏捷和迭代方法，并且在许多层面上都很重要。定义业务需求的阶段非常重要，也应该是迭代的。通过要求固定范围/固定价格的合同，客户放弃了灵活的机会并扼杀了敏捷精神。当然，即使在固定范围合同下，您也可以而且应该进行一些迭代。但是迭代方法最有价值的优势已经随着签署固定范围而丢失了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T03:36:09.257

敏捷技术旨在遏制变化，但如果变化不是很大，它们也同样有效。大部分好处仍在累积。只需将工作划分为客户故事、跨里程碑的故事，然后开始运行迭代时钟。它应该工作得很好。你必须预先做更多的计划，但这并不意味着瀑布。

瀑布式是您按顺序进行所有计划，然后是所有编码，然后是所有测试/调试。相反，您可以做足够的计划，然后迭代计划/编码/测试周期。

# java - 什么是允许选择加入/退出的最好的基于 Java 的邮件列表应用程序

> ID：758430
> 
> 赞同：0
> 
> 时间：2009-04-16T23:24:52.200
> 
> 标签：java, email, open-source, rss, subscription

我正在寻找一个基于 java 的（首选）邮件列表应用程序，它允许用户选择加入/选择退出邮件列表。开源是可取的，但不是强制性的。

当某些事件在另一个应用程序中发生时，该产品将用于向订阅的人发送电子邮件通知 - 即，当保存并批准具有某些属性的新记录时，会将消息发送到一个或多个邮件列表。

它应该能够处理多个邮件列表，并且必须有一个以编程方式发送新消息的界面，而无需使用它的 web/gui 界面。

最后的手段是开发我们自己的应用程序来执行此功能。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T05:31:10.010

我建议使用托管服务进行电子邮件营销。当然，您可能会找到适合这项工作的软件。主要问题是可交付性。邮寄服务会增加您的邮件到达目的地的机会。它还提供了非常有用的报告，显示打开了多少以及谁点击了什么。恕我直言，这些服务的价格非常合理。

我正在使用[MailChimp](http://www.mailchimp.com/)，我对他们的服务很满意。他们有一个易于使用的 API，因此您可以以编程方式控制您的活动。我正在从 Java 调用它，并且正在打包我的代码以在线发布它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T23:34:46.450

我的建议是在 Web 应用程序中处理选择加入和选择退出操作，将每个“列表”的地址存储在您喜欢的任何数据库中，并且只使用 JavaMail API 来处理实际的电子邮件功能。集成到现有应用程序中很简单，也更容易，以后当你必须维护这个系统时，你会更开心。

# sql-server - 建立多样化的数据库测试环境

> ID：758442
> 
> 赞同：6
> 
> 时间：2009-04-16T23:29:03.640
> 
> 标签：sql-server, database, oracle, continuous-integration, integration-testing

我正在编写一些需要针对一系列不同数据库产品工作的代码。

*   mysql
*   Sql Server 2000 到 2008
*   PostgreSQL
*   甲骨文 9i & 10g
*   Jet 4.0（MS 访问）
*   MSDE
*   Sybase Adaptive Server 无处不在
*   Sybase Sql Anywhere
*   进展 OpenEdge

作为持续集成构建的一部分，我们需要针对每个数据库产品运行一组通用集成测试。

我确信其他人不得不建立类似的测试环境，我想利用其中的一些智慧——你最终使用什么策略，什么效果好或效果不好？

一些想法：

*   每个产品都有单独的虚拟机，每个都分配少量内存（在某些情况下更易于管理，或者我们对各个产品的设置略有不同）。
*   所有产品的几个虚拟机甚至一个虚拟机（例如，可能是一个用于 postgresql 和 mysql 的 ubuntu 机器，以及一个用于其余产品的 windows 2008 服务器机器） - 我喜欢一两个虚拟机，因为它更便携运行测试的环境，即在路上/场外时，因为我的笔记本电脑可能会在运行 8 或 10 个小型 VM 时停止运行。

最后，您是如何解决其中一些商业产品（如 Oracle 或 Progress OpenEdge）的高昂成本的，并且之前的版本是否仍然可用，即是否有免费的“单一开发者”版本可用，或者购买这些产品的更便宜的途径？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T06:34:36.493

*   我们的服务器也使用 vmware，每个数据库一个 vmware 主机。您应该可以将多个数据库放在一个 vmware 上。
*   您不应该对昂贵的软件许可证有太大的问题。例如，Oracle 允许您拥有其所有产品的开发许可证。只要您不在笔记本电脑 vmware 上运行生产数据库，就应该没问题。当然，伊纳尔。
*   对于 Oracle，如果您的客户将使用企业版（很可能），请获取企业版。
*   一定要充分利用 vmware 快照。您可以完美地配置数据库以运行您的测试，运行您的测试，然后将数据库恢复到测试前状态，以便再次运行您的测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T23:39:04.397

我们在这里所做的（主要）是为所需的每个配置提供一个 VM，我们还针对不同的操作系统，因此我们正在测试 22 种配置。这些虚拟机托管在 ESX 服务器中，并编写了脚本以在需要时启动和停止，这样它们就不会同时运行。设置工作量*很大*。

就数据库服务器的成本而言，我们正在构建的软件类型需要高端版本，因此测试成本已计入总体开发成本（我们只需要“接受”）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T03:13:11.307

Oracle 确实有一个免费的“快捷版”。它不具备 Oracle 的所有功能，但是如果您还针对 Jet 运行，那么这应该不是问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T06:44:56.233

在架构上，最好创建一个足够强大的服务器集成测试场，以运行各种配置的虚拟机。它可以在一个队列进程的前面，监听集成测试请求（可以使用 svn 提交或其他源代码控制检查触发器来触发）。

对于最准确的测试范围，您可能希望为每个配置使用单独的 VM。这将降低配置冲突的风险，并增加运行自定义 VM 集的灵活性（例如 Oracle + MySQL + PostgreSQL 而不是其他的，等等）。根据您的构建过程，它还可能允许您运行 10 分钟的构建。

运行集成测试场的一个好处是，如果您在旅途中使用笔记本电脑，您可以在代码签入后触发集成构建，运行所有测试并让它通知您结果。您还可以归档每个请求和结果，以帮助诊断失败的构建。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T17:27:18.187

Oracle 许可证摘录：

> 我们授予您非排他性、不可转让的有限许可，仅可将程序用于**开发、测试、原型设计和演示**您的应用程序，不得用于任何其他目的。

因此，您可以下载完整的 Oracle 版本 9、10 和 11，并按照许可证中的说明免费使用它们。检查[www.oracle.com上的下载部分](http://www.oracle.com)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T20:48:17.687

听起来您已经很清楚该做什么了。我建议以下虚拟机布局：

托管以下内容的 Windows Server 2008 机器：

*   MSDE
*   Jet 4.0（MS 访问）
*   Sybase Adaptive Server 无处不在
*   Sybase Sql Anywhere
*   进展 OpenEdge

在 Ubuntu 或 Red Hat 机器上：

*   mysql
*   PostgreSQL
*   Oracle 9i[在此处下载](http://www.oracle.com/technology/software/products/oracle9i/index.html)
*   Oracle 10g [（使用免费快递版）](http://www.oracle.com/technology/products/database/xe/index.html)

我认为不需要针对完整的 SQL 和 Oracle 版本进行测试。免费版本已被剥离，因此当您针对这些服务器的完整版本运行代码时，代码被破坏的风险很小。如果您已经针对整个服务器进行了测试并使用了免费的东西，那么是的，有些东西可能会损坏，但是通过使用最小公分母进行测试，您应该确保良好的质量。

# php - 如何使用非法名称访问此对象属性？

> ID：758449
> 
> 赞同：122
> 
> 时间：2009-04-16T23:33:27.590
> 
> 标签：php, object

我正在使用某人编写的 PHP 类来与 BaseCamp API 交互。

我正在做的特定调用是检索待办事项列表中的项目，这很好。

我的问题是，我不确定如何仅访问`todo-items`返回的对象的属性。这是返回对象的 var_dump：

```
object(stdClass)[6]
  public 'completed-count' => string '0' (length=1)
  public 'description' => string 'Description String' (length=89)
  public 'id' => string '12345' (length=7)
  public 'milestone-id' => string '' (length=0)
  public 'name' => string 'Error Reports' (length=13)
  public 'position' => string '1' (length=1)
  public 'private' => string 'false' (length=5)
  public 'project-id' => string '58904' (length=7)
  public 'tracked' => string 'false' (length=5)
  public 'uncompleted-count' => string '1' (length=1)
  public 'todo-items' => 
    object(stdClass)[3]
      public 'todo-item' => 
        object(stdClass)[5]
          public 'completed' => string 'false' (length=5)
          public 'content' => string 'content string here' (length=133)
          public 'created-on' => string '2009-04-16T20:33:31Z' (length=20)
          public 'creator-id' => string '23423' (length=7)
          public 'id' => string '234' (length=8)
          public 'position' => string '1' (length=1)
          public 'responsible-party-id' => string '2844499' (length=7)
          public 'responsible-party-type' => string 'Person' (length=6)
          public 'todo-list-id' => string '234234' (length=7)
  public 'complete' => string 'false' (length=5) 
```

如何访问`todo-items`此对象的部分？

* * *

## 回答 #1

> 赞同：281
> 
> 时间：2009-04-16T23:39:01.820

```
<?php
$x = new StdClass();
$x->{'todo-list'} = 'fred';
var_dump($x); 
```

所以，`$object->{'todo-list'}`是子对象。如果你可以这样设置，那么你也可以用同样的方式阅读：

```
echo $x->{'todo-list'}; 
```

另一种可能：

```
$todolist = 'todo-list';
echo $x->$todolist; 
```

如果您想将它转换为一个数组，这可能更容易一些（即明显的`$ret['todo-list']`访问），这段代码几乎是从 Zend_Config 中逐字获取的，并且会为您转换。

```
public function toArray()
{
    $array = array();
    foreach ($this->_data as $key => $value) {
        if ($value instanceof StdClass) {
            $array[$key] = $value->toArray();
        } else {
            $array[$key] = $value;
        }
    }
    return $array;
} 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2014-09-24T12:00:06.587

试试这个最简单的方法！

```
$obj = $myobject->{'mydash-value'};
$objToArray = array($obj); 
```

# asp.net - 邮寄地址验证等 从 Zip 获取县

> ID：758450
> 
> 赞同：0
> 
> 时间：2009-04-16T23:34:10.303
> 
> 标签：asp.net, ajax, api, geolocation, validation

如今，网站在幕后执行一些地址验证似乎相当普遍。比如邮政编码上的4位扩展名一般都是填的。除了填写邮政编码扩展名的4位外，我还想知道这个地址属于哪个县。

这将在 ASP.NET 3.5 应用程序中使用，该应用程序已经为 ASP.NET AJAX 和 jQuery 提供了所有挂钩。

有哪些服务可以做到这一点？Web 服务，第 3 方包括等。

**界面结构**

```
ADDRESS_LINE1
ADDRESS_LINE2
CITY
STATE 
ZIP 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T23:41:03.157

如果您有现金，[NetAddress](http://www.softwarecompany.com/dotnet/netaddress.htm)是为 .NET 构建的。

之前也有人问过这个问题：[here](https://stackoverflow.com/questions/682093/address-validation-api)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-08T22:01:07.223

这是旧的，但如果它可以帮助某人，那么我的时间花得很好。听起来您正在寻找的东西可以通过两种方式完成。

1 - 如果您只想根据地址附加县，您可以使用简单的邮政编码/县数据库来执行此操作。

2 - 如果您想标准化地址、验证地址，然后将县添加到其中，您将需要提供经常更新的 USPS 数据的服务。这是我们称为 LiveAddress 的标准地址验证 API 的一部分。 [实时地址](http://www.qualifiedaddress.com/Products/LiveAddress-API/)

我在一家名为qualifiedaddress 的地址验证公司工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-09T07:21:29.050

```
 <script type="text/javascript">
    function OpenChild() {
    var Area = document.getElemenenter code heretById('<%=ddlArea.ClientID %>');
    var City = document.getElementById('<%=ddlCity.ClientID %>');
    var State = document.getElementById('<%=ddlstate.ClientID %>');
    var Country = document.getElementById('<%=ddlCountryName.ClientID %>');
    if (Area.value != "" && City.value != "" && State.value != "" && Country.value != "") {
    var MyArgs = new Array(Area.options[Area.selectedIndex].text,
    City.options[City.selectedIndex].text,
    State.options[State.selectedIndex].text,
    Country.options[Country.selectedIndex].text);
    var WinSettings = "center:yes;resizable:no;dialogHeight:500px;dialogWidth:900px;"
    // ALTER BELOW LINE - supply correct URL for Child Form
    var MyArgs = window.showModalDialog("http://YourURL/GoogleMapLocationSelector.aspx?Area=" + MyArgs[0].toString() + "&City=" + MyArgs[1].toString() + "&State=" + MyArgs[2].toString() + "&Country=" + MyArgs[3].toString(), MyArgs, WinSettings);

    if (MyArgs == null) {
    window.alert("Error occurred while setting geo location.");
    }
    else {
    document.getElementById('<%=txtLongitude.ClientID %>').value = MyArgs[0].toString();
    document.getElementById('<%=txtLatitude.ClientID %>').value = MyArgs[1].toString();
    document.getElementById('<%=hfLatitude.ClientID %>').value = MyArgs[1].toString();
    document.getElementById('<%=hfLongitude.ClientID %>').value = MyArgs[0].toString();
    }
    }
    else {
    alert("Plz Select Area/City/State");
    return false;
    }
    }
    </script> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T23:36:16.680

美国邮政服务的网站[列出了许多](http://www.usps.com/business/addressverification/welcome.htm)地址验证服务。[出版物 28](http://pe.usps.com/cpim/ftp/pubs/Pub28/pub28.pdf) (PDF) 是美国地址的寻址标准。不幸的是，它比您的架构更复杂。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T23:39:59.447

根据您需要的许可证选项，[UPS](http://www.ups.com/e_comm_access/usaddvalidation?loc=en_US)可以是免费的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-12-14T19:59:18.467

有很多服务。我们通过 FedEx 进行运输，因此我们使用他们的“地址验证服务”。可以在[此处](https://pypi.python.org/pypi/fedex/)找到他们在 python 中的 API 的包装器代码。联邦快递的手册可以在[这里](http://www.fedex.com/templates/components/apps/wpor/secure/downloads/pdf/Aug13/AddressChecker_WSDL_Guide.pdf)找到。

其他人喜欢[minfraud](https://www.maxmind.com/en/minfraud-services)。您可以传递诸如送货和账单地址、电话号码、电子邮件、IP 地址等字段。[在此处](https://www.maxmind.com/en/minfraud-services)查看更多信息。根据提供的信息，您将收到如下所示的响应：

`distance=0;countryMatch=Yes;countryCode=US;freeMail=No;anonymousProxy=No;binMatch=NA;binCountry=;err=;proxyScore=0.00;ip_region=CA;ip_city=Mountain View;ip_latitude=37.3860;ip_longitude=-122.0838;binName=;ip_isp=Google;ip_org=Google;binNameMatch=NA;binPhoneMatch=NA;binPhone=;custPhoneInBillingLoc=;highRiskCountry=No;queriesRemaining=4408;cityPostalMatch=;shipCityPostalMatch=;maxmindID=JBRH7OXI;ip_asnum=AS15169 Google Inc.;ip_userType=business;ip_countryConf=70;ip_regionConf=13;ip_cityConf=10;ip_postalCode=94040;ip_postalConf=;ip_accuracyRadius=999;ip_netSpeedCell=Corporate;ip_metroCode=807;ip_areaCode=650;ip_timeZone=America/Los_Angeles;ip_regionName=California;ip_domain=;ip_countryName=United States;ip_continentCode=NA;ip_corporateProxy=No;riskScore=34.0;prepaid=;minfraud_version=1.3;service_level=standard`

MinFraud AVS 检查更适合确定在您的网站上开展业务的客户是否值得信赖。

# c# - 枚举和数组索引？

> ID：758462
> 
> 赞同：1
> 
> 时间：2009-04-16T23:40:09.823
> 
> 标签：c#, .net, arrays, enums

我正在做这个家庭作业项目，并且无法理解解释如何正确获取枚举的访问值然后将字符串数组值应用于它的文本。你能帮我理解这个吗？我们使用的文本非常困难，而且对于初学者来说写得不好，所以我在这里有点自己。我已经编写了第一部分，但是在访问枚举值和分配方面需要一些帮助，我想我已经接近了，但不明白如何正确获取和设置值。

> 编写一个类 MyCourses，其中包含您当前正在学习的所有课程的枚举。这个枚举应该嵌套在你的 MyCourses 类中。您的班级还应该有一个数组字段，该字段提供每个课程的简短描述（作为字符串）。编写一个索引器，将您枚举的课程之一作为索引并返回课程的字符串描述。

```
namespace Unit_4_Project
{
    public class MyCourses
    {

        // enumeration that contains an enumeration of all the courses that 
        // student is currently enrolled in
        public enum CourseName
        {
            IT274_01AU,
            CS210_06AU
        }

        // array field that provides short description for each of classes, 
        // returns string description of the course
        private String[] courseDescription = 
         {"Intermediate C#: Teaches intermediate elements of C# programming and software design",
          "Career Development Strategies: Teaches principles for career progression, resume preparation, and overall self anaylsis"};

        // indexer that takes one of the enumerated courses as an index 
        // and returns the String description of the course
        public String this[CourseName index]
        {
            get
            {
                if (index == 1)
                    return courseDescription[0];
                else
                    return courseDescription[1];
            }
            set
            {
                if (index == 1)
                    courseDescription[0] = value;
                else
                    courseDescription[1] = value;
            }
        }

    }

}//end public class MyCourses 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T23:46:26.563

你已经接近了，你最后只是有点发疯了。CourseName 只是一个数字。您可以直接索引到您的 courseDescription 数组...

```
courseDescription[(int)index] 
```

你有它。:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T23:55:06.883

枚举不会隐式转换为整数。但是您可以显式转换它们。

```
public String this[CourseName index]
{
  get { return courseDescription[(int)index]; }
  set { courseDescription[(int)index] = value; } 
```

如果你打算以这种方式使用枚举，你应该定义它们代表的实际数值。

```
public enum CourseName
{
  IT274_01AU = 0,
  CS210_06AU = 1
} 
```

虽然当前的枚举实现会起作用，但没有任何迹象表明它会在未来这样做。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T23:42:54.713

您缺少的是枚举转换为整数。（实际上，在它们的覆盖下，它们基本上都是整数。）

数组可以用整数索引。

尝试使用枚举类型的参数索引您的数组。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T23:45:09.060

这是我对 CodeGuru 的回复：

枚举是强类型的，因此不能直接将其与 int 进行比较。但是，您可以将枚举转换为 int。所以你会得到这个：

```
if ( ( ( int ) index ) == 1)
     return courseDescription[0];
else
     return courseDescription[1]; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T00:54:25.383

这里的诀窍是枚举是其核心的整体数据类型。这意味着如果你想这样做，你可以在 Enum 和 Int32 之间来回转换：

您需要将“获取”部分更改为：

```
public String this[CourseName index]
{
    get {
        return courseDescription[(int)index];
    }        
} 
```

这是有效的，因为枚举基本上等同于：

```
public enum CourseName
{
    IT274_01AU = 0,
    CS210_06AU = 1
} 
```

# python - Python中的程序控制流

> ID：758465
> 
> 赞同：1
> 
> 时间：2009-04-16T23:41:03.440
> 
> 标签：python, list, enumerate

我有一些数据存储在列表中，如果我打印出列表，我会看到以下内容：

```
.
.
.
007 A000000 Y
007 B000000  5
007 C010100  1
007 C020100 ACORN FUND
007 C030100 N
007 C010200  2
007 C020200 ACORN INTERNATIONAL
007 C030200 N
007 C010300  3
007 C020300 ACORN USA
007 C030300 N
007 C010400  4
.
.
. 
```

序列前后的点表示存在其他结构类似但可能或可能不属于第七项（007）的数据。如果第七项中的第一个值是“007 A000000 Y”，那么我想创建一些数据项的字典列表。我可以做到这一点，并且只需运行列表中的所有项目并将它们的值与变量的一些测试值进行比较即可做到这一点。例如一行代码，如：

```
if dataLine.find('007 B')==0:
    numberOfSeries=int(dataLine.split()[2]) 
```

我想做的是

```
if dataLine.find(''007 A000000 Y')==0:
    READ THE NEXT LINE RIGHT HERE 
```

现在我必须遍历每个周期的整个列表

我想缩短处理时间，因为我有大约 60K 个文件，每个文件有 500 到 5,000 行。

我考虑过创建另一个对列表的引用并计算数据线，直到 dataLine.find(''007 A000000 Y')==0。但这似乎不是最优雅的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T01:35:02.433

您可以使用`itertools.groupby()`将您的序列分割成多个子序列。

```
import itertools

for key, subseq in itertools.groupby(tempans, lambda s: s.partition(' ')[0]):
    if key == '007':
    for dataLine in subseq:
        if dataLine.startswith('007 B'):
        numberOfSeries = int(dataLine.split()[2]) 
```

* * *

`itertools.dropwhile()`如果您真的只是想达到那条线，也可以使用，

```
list(itertools.dropwhile(lambda s: s != '007 A000000 Y', tempans))
['007 A000000 Y',
 '007 B000000  5',
 '007 C010100  1',
 '007 C020100 ACORN FUND',
 '007 C030100 N',
 '007 C010200  2',
 '007 C020200 ACORN INTERNATIONAL',
 '007 C030200 N',
 '007 C010300  3',
 '007 C020300 ACORN USA',
 '007 C030300 N',
 '007 C010400  4',
 '.',
 '.',
 '.',
 ''] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T00:00:22.580

您可以将数据读入字典。假设您正在从类似文件的对象中读取`infile`：

```
from collections import defaultdict
data = defaultdict(list)
for line in infile:
    elements = line.strip().split()
    data[elements[0]].append(tuple(elements[1:])) 
```

现在，如果您想阅读 '007 A000000 Y' 之后的行，您可以这样做：

```
# find the index of ('A000000', 'Y')
idx = data['007'].index(('A000000', 'Y'))
# get the next line
print data['007'][idx+1] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T00:06:13.050

使用字典中的所有数据的唯一困难是，一个非常大的字典可能会变得很麻烦。（这就是我们过去所说的“Big Ole Matrix”方法。）

解决这个问题的方法是在Dictionary中构造一个*索引*，创建key->offset的映射，使用`tell`方法获取文件偏移值。然后你可以通过`seek`方法搜索再次参考该行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T19:14:06.770

好的，当我在谷歌搜索以确保我已经覆盖了我的基础时，我遇到了一个解决方案：

我发现我忘记在列表和字典中思考，即使我使用它们。Python 有一些强大的工具来处理这些类型，以加快你操作它们的能力。
我需要一个切片，因此切片引用很容易通过

```
beginPosit = tempans.index('007 A000000 Y')
endPosit = min([i for i, item in enumerate(tempans) if '008 ' in item]) 
```

tempans 是数据列表现在我可以写

```
for line in tempans[beginPosit:endPosit]:
    process each line 
```

我想我回答了我自己的问题。我从其他答案中学到了很多并感谢他们，但我认为这是我需要的

好的，我将进一步编辑我的答案。我在这里学到了很多东西，但其中一些东西仍然在我的脑海中，我想在我学习更多关于这个神奇工具的同时编写一些代码。

```
from itertools import takewhile
beginPosit = tempans.index('007 A000000 Y')
new=takewhile(lambda x: '007 ' in x, tempans[beginPosit:]) 
```

这是基于先前对类似问题的回答和[Steven Huwig 的](https://stackoverflow.com/questions/337223/python-item-for-item-until-stopterm-in-item#337285)回答

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T19:33:11.513

你说你想这样做：

```
if dataLine.find(''007 A000000 Y')==0:
    READ THE NEXT LINE RIGHT HERE 
```

大概这是在“for dataLine in data”循环中。

或者，您可以直接使用迭代器而不是在 for 循环中：

```
>>> i = iter(data)
>>> while i.next() != '007 A000000 Y': pass  # find your starting line
>>> i.next()  # read the next line
'007 B000000  5' 
```

您还提到要处理 60K 文件。它们的格式都相似吗？它们是否需要进行不同的处理？如果它们都可以以相同的方式处理，您可以考虑将它们链接到一个流中：

```
def gfind( directory, pattern="*" ):
    for name in fnmatch.filter( os.listdir( directory ), pattern ):
        yield os.path.join( directory, name )

def gopen( names ):
    for name in names:
        yield open(name, 'rb')

def gcat( files ):
    for file in files:
        for line in file:
            yield line

data = gcat( gopen( gfind( 'C:\datafiles', '*.dat' ) ) ) 
```

这使您可以在单个迭代器中懒惰地处理所有文件。不确定这是否有助于您目前的情况，但我认为值得一提。

# python - 对接受 zip 文件进行处理的守护程序的建议

> ID：758466
> 
> 赞同：2
> 
> 时间：2009-04-16T23:41:04.063
> 
> 标签：python, django, zip, daemon

我想写一个守护进程：

*   从包含 zip 文件路径的队列（sqs、rabbit-mq 等）中读取消息
*   更新数据库中的记录，例如“此作业正在处理”
*   读取上述存档的内容并将一行插入数据库，其中包含从找到的每个文件的文件元数据中挑选出的信息
*   将每个文件复制到 s3
*   删除 zip 文件
*   将作业标记为“完成”
*   读取队列中的下一条消息，重复

这应该作为服务运行，并由当有人通过 Web 前端上传文件时排队的消息启动。上传者不需要立即看到结果，但上传会在后台相当方便地处理。

我对 python 很流利，所以首先想到的是编写一个带 twisted 的简单服务器来处理每个请求并执行上述过程。但是，我从来没有写过这样可以在多用户上下文中运行的东西。它不会每分钟或每小时处理数百次上传，但如果它可以一次处理几个，那就太好了，合理的。我也不太熟悉编写多线程应用程序和处理阻塞等问题。

人们过去是如何解决这个问题的？我可以采取哪些其他方法？

提前感谢您的帮助和讨论！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T23:53:28.590

我将[Beanstalkd](http://xph.us/software/beanstalkd/)用作队列守护程序，效果非常好（一些近时间处理和图像大小调整 - 过去几周到目前为止已超过 200 万）。使用 zip 文件名（可能来自特定目录）将消息扔到队列中 [我在 JSON 中序列化命令和参数]，当您在工作客户端中保留消息时，除非您允许，否则没有其他人可以得到它它超时（当它返回队列被拾取时）。

剩下的就是解压和上传到 S3，还有其他库。

如果您想一次处理多个 zip 文件，请运行任意数量的工作进程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T00:53:54.793

我会避免做任何多线程的事情，而是使用队列和数据库来同步尽可能多的工作进程，只要你愿意启动。

For this application I think twisted or any framework for creating server applications is going to be overkill.

Keep it simple. Python script starts up, checks the queue, does some work, checks the queue again. If you want a proper background daemon you might want to just make sure you detach from the terminal as described here: [How do you create a daemon in Python?](https://stackoverflow.com/questions/473620/how-do-you-create-a-daemon-in-python)

Add some logging, maybe a try/except block to email out failures to you.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-25T19:28:50.333

i opted to use a combination of celery ([http://ask.github.com/celery/introduction.html](http://ask.github.com/celery/introduction.html)), rabbitmq, and a simple django view to handle uploads. the workflow looks like this:

1.  django view accepts, stores upload
2.  a celery `Task` is dispatched to process the upload. all work is done inside the `Task`.

# java - Java Web 框架真的值得麻烦吗？

> ID：758473
> 
> 赞同：10
> 
> 时间：2009-04-16T23:43:06.460
> 
> 标签：java, jsp, jsf, servlets, frameworks

我对 Java 编程（大约 2 年）相对较新，但对 Web 开发不熟悉。我从 HTML 和 ASP（.NET 之前）开始，最近开始使用 J2EE。我觉得我对 JSP/Servlets 有很好的了解（我发现它们类似于 ASP）并且最近开始使用 JSF 和 Facelets。虽然我可以理解人们为什么喜欢 JSF，但我发现它是一个巨大的负担，而且它实际上正在减慢我的开发时间。我想这是由于学习曲线造成的，但我经常发现自己认为如果我只是使用 JSP/Servlet，我会完成一个页面/任务。

这对于那些花时间学习框架的人来说是常见的吗？你有没有花时间学习一个框架，一旦你精通它，就决定回到一个不那么复杂但你觉得舒服的方法？

我也在质疑我是否选择了正确的框架。我真的很希望能找到不影响添加 AJAX 功能的东西。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T23:47:24.483

JSF 可能很难上手，并且比许多 Java Web 框架更难学习。您可能会发现将 JSF 与 Seam 一起使用会更容易，这大大简化了您使用 JSF 的方式，并且用 Facelets 代替了 JSP，这是一个很大的改进。

或者，你可以试试 SpringMVC，很多人觉得它更容易使用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T23:59:08.637

我已经使用 facelets 一年多了。我在 Java Web 框架中看到的主要优势之一是它有助于保持代码整洁并促进重用。例如，在 facelets 中，您不会像在 JSP 中那样在页面中获得任何 scriptlet。我在生产中见过超过 3000 行的 ASP 文件。ASP 或 JSP 本身并没有什么问题，但它确实可以很容易地将一些业务逻辑集中在页面中。没有害处，对吧？直到其他人必须维护它。

大多数框架都试图“帮助”您对 MVC 或它们喜欢的任何模型保持更严格的分离，这反过来又会导致更清晰的模板（jsp、facelets 等）以及可自动进行单元测试的业务和域代码。使用许多框架可能需要更多的时间，但在维护和重构方面可以节省很多倍。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T17:24:07.627

我的建议：熟悉许多不同的框架，并且知道如何亲自动手并自己编写。您将开发一些最喜欢的工作方式，但您会很好地了解这些工具可以做什么，不能做什么。您还将了解何时是使用框架的正确时间，以及何时是不使用框架的正确时间。

我发现 JSF 和 Facelets 绝对值得一试，如果你能熬过学习曲线的话。它非常陡峭，但是当您弄清楚时，它很容易使用。它们使管理会话和应用程序范围对象比仅处理原始 JSP 和 servlet 更容易，而且我发现当我不必在业务逻辑中考虑 Web 时，我可以编写更简洁的 Java。总的来说，我发现这些框架帮助我以一种一致、易于理解的方式组织我的想法（以及我的代码）。

尤其是 Facelets，是我最喜欢的 Web 模板引擎。*我喜欢我的页面是有效*的 XML的事实，而且我没有到处都有 scriptlet。*如果您了解该框架*，它会使代码更清晰、更容易理解。 学习曲线又来了。

顺便说一句，如果您使用 RichFaces 或 IceFaces 之类的东西，将 AJAX 添加到 Facelets 很容易。它们具有预构建的 ajax 组件，您可以轻松地将其添加到您的应用程序中。

也就是说，它并不是对所有项目、YMMV 等都是最好的。归根结底，使用任何框架都是一种判断。如果它不能帮助你解决你的问题，那么它是不值得的。不要与你的工具争吵，正确使用它们。如果该工具妨碍您，请使用其他工具。对于非常小的应用程序，JSF 和 facelets 确实不是很好的选择。除非您拥有相当复杂的域模型和复杂的业务逻辑，否则它们不会真正发挥作用。基本上，您需要项目足够复杂以克服您需要编写的大量样板代码才能开始工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T00:53:56.353

我认为简单的答案是 - 当您进行更改时，您将如何测试并验证它是否有效？

这就是简单的解决方案失效的地方，你最终会陷入维护地狱。很遗憾 ：（

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T03:08:11.133

我认为这取决于框架是否真正为您解决了一个“难题”，并且很容易解决。出于某种原因，人们总是觉得这是一个非常有争议的事情，但是我考虑过使用的大多数框架我都在中途放弃了，因为编写一些代码来做我想做的事情更容易。

之后，当我的代码出现问题时，我可以直接找到问题所在并添加一行代码来修复它，而不必费力翻阅文档页面来查找神奇的配置参数。如果我对（插入最喜欢的框架）有疑问，我通常会发现我会在很长一段时间内徘徊，而框架本应解决的潜在问题从一开始就没有那么复杂。

我最喜欢的无用框架是那些需要大量配置和笨拙的样板代码来完成基本任务的框架，例如通过套接字发送一些字节或将一些参数填充到准备好的语句中并将其发送到数据库。我最喜欢的另一个是大量的“XML 技术”，尤其是“可插入”或“可配置”的技术。（为什么我想要一个“可插入的解析器框架”，而不仅仅是一个始终有效的解析器......？）叫我 Victor Meldrew，但令人惊讶的是人们如何将 10 分钟的正则表达式问题变成 2 天的操作 - do-you-make-this-framework-with-X-in-the-title-do-it 问题。

话虽如此，有些人在 Spring、Hibernate、JSF、MVCJammer、Joomajamaventilate 以及其中带有“X”的东西等方面绝对茁壮成长。所以很明显，对于某些情况下的某些人来说，它们是一个奇迹，而我只是错过了生活。

可能这取决于您或您的组织是否主要具有“配置”和“将事物连接在一起”专家或“编程”专家？我想我有更多的后者。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-15T03:31:11.823

我第二个 SpringMVC。很容易理解，而且如果你使用[注解](http://wheelersoftware.com/articles/spring-mvc-annotations.html)，代码也很有语义。就像那些[百威广告](http://www.youtube.com/watch?v=zkQ99AASIDw)一样……Servlets 太轻了……Struts 太重了。

我希望 Java 有脚手架。它可以与 Grails 一起使用，但这是另一个嵌入框架的框架。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-17T00:55:43.183

SpringMVC 是值得的。J2EE 不是。

# xaml - 通过 XAML 加载的自定义类型如何获得对根对象的引用

> ID：758482
> 
> 赞同：1
> 
> 时间：2009-04-16T23:46:20.867
> 
> 标签：xaml, semantics

我正在尝试使用 XAML 来表示和加载形成业务域[语义模型的自定义类型图。](http://martinfowler.com/dslwip/SemanticModel.html)

我想做的一件事是能够从树中更深的对象获取对图的“根对象”的引用。除了诉诸野蛮做法（例如将根对象作为单例）之外，我找不到任何直接的方法来做到这一点。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T23:52:01.183

我不知道这是 XAML 独有的问题。XAML 所做的只是实例化您的“子”对象并将它们添加到“父”对象的集合属性中。所以如果你有类似的东西：

```
<my:Category Name="Products">
    <my:Category.Subcategories>
        <my:Category Name="Clothing" />
        <my:Category Name="Jewellery" />
    </my:Category.Subcategories>
</my:Category> 
```

...那么您最终会得到一个包含两个子类别的“产品”类别。由您来编写“类别”类的代码，以便添加子类别在某处保存对该子类别的“所有者”的引用。我可能会使用自定义集合类型（覆盖 Add 和 Remove 方法，以便它们在要添加的对象上设置“Parent”或“Owner”属性）。

# objective-c - 如何在 obj-c 中对单例进行单元测试？

> ID：758484
> 
> 赞同：1
> 
> 时间：2009-04-16T23:46:35.563
> 
> 标签：objective-c, unit-testing

我有一个单例类，不能对他们的代码进行单元测试。

我有这样的测试：

```
 Db *db = [[Db alloc] initWithName:@"sample.db"];

[db createDb];

STAssertEquals([db existDb],YES,@"The db is not created!"); 
```

但只工作第一个。当第二个被执行时，我总是从 initWithName 方法中得到“null”。当我删除单例支持代码时，一切都按预期工作。

我可以破解测试（但我现在不知道如何破解），但想知道是否存在一种“流行”方式来处理这个问题。

单例位于此处：[http ://code.google.com/p/chibiorm/source/browse/trunk/src/Db.m](http://code.google.com/p/chibiorm/source/browse/trunk/src/Db.m)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T23:56:52.090

单例很难进行单元测试，有时是设计不佳的结果。

我的建议是首先认真考虑您是否真的需要单身人士。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-11-26T14:44:28.933

这里的人写了我会写的答案，即根据需要使用类别来提供与单例方法不同的实例。

[http://twobitlabs.com/2011/02/mocking-singletons-with-ocmock/](http://twobitlabs.com/2011/02/mocking-singletons-with-ocmock/)

上面的其他人都认为“单身人士很糟糕”的观点应该被忽略。当我切换到 Objective c 时，我做的第一件事是编写一个 iOC 库，我从未使用过，因为我意识到 Objective c 不是 Java，所以请忽略那些对 Java 教条喋喋不休的人：它并不总是适用于目标 C.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-19T19:10:38.570

我认为您不应该在第二次分配时返回 nil 而是引发异常。如果你想使用一个单例，你不应该尝试创建两个:)。

但是，如果我决定创建一个单例，我的类看起来像：

```
@implementation MySingleton

static id _instance = nil;

+ instance
{
    if (_instance == nil) {
        // alloc/init
        _instance = [[self alloc] init];
        …
    }
    return _instance;
}
…
@end 
```

如您所见，我并没有强制要求可能永远不会超过一个实例。相反，我使用约定仅通过实例方法获取实例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T00:29:02.373

也许您可以使用[工厂模式](http://en.wikipedia.org/wiki/Factory_pattern)并创建一个只分发一个实例（实际上是您的单例）的工厂。那么这个实现就不是一个单例了，你可以对它进行单元测试。

唯一的缺点是，如果您不从工厂检索它，您将不受创建自己实例的语言的保护。在 C++ 中，您可以通过将构造函数设为私有以及工厂和单元测试的朋友来克服这个问题。我不确定 Objective-C 是否有类似的功能。

# javascript - 如何实现 JavaScript 级联..？

> ID：758486
> 
> 赞同：7
> 
> 时间：2009-04-16T23:48:04.407
> 
> 标签：javascript

我正在阅读“JavaScript the Good Parts”，它提到了级联作为在 JavaScript 中进行方法链接的一种方式，但我找不到任何代码来解释如何实现这些方法。

```
getElement('myBoxDiv').
move(350, 150).
width(100).
height(100).
color('red').
border('10px outset').
padding('4px').
appendText("Please stand by").
on('mousedown', function (m) {
    this.startDrag(m, this.getNinth(m));
}).
on('mousemove', 'drag').
on('mouseup', 'stopDrag').
later(2000, function (  ) {
    this.
        color('yellow').
        setHTML("What hath God wraught?").
        slide(400, 40, 200, 200);
}).
tip('This box is resizeable'); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T23:50:09.610

诀窍是方法本身应该只返回`this`。这样，每次将这些方法链接在一起时，对象本身就是调用的基础。

SomeObj.width(40) 将只返回 SomeObj，因此添加调用 .height(50) 将起作用，并继续。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2016-02-09T12:47:04.457

在级联中，我们可以在单个语句中按顺序调用同一对象上的许多方法。让我们试试这个例子，

```
var Calc = function(){    
  this.result=0;

  this.add = function(){      
    for(var x=0; x<arguments.length; x++){
      this.result += arguments[x];
    }     
    return this;
  };

  this.sub = function(){
    for(var x=0; x<arguments.length; x++){
      this.result -= arguments[x];
    }         
    return this;
  };

  this.mult = function(){
    if(this.result==0)this.result = 1;
    for(var x=0; x<arguments.length; x++){
      this.result *= arguments[x];
    }         
    return this;
  };

  this.div = function(){
    if(this.result==0) return this;
    for(var x=0; x<arguments.length; x++){
      this.result /= arguments[x];
    }         
    return this;
  };

  this.eq = function(){
    return this.result
  };

}

var cal1 = new Calc();

cal1.add(3).sub(1).add(2) // Here result = 4; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-29T22:58:07.777

这些方法总是返回它们所属的对象`this`，例如：

```
var txtProcesor = {
    txt: '',

    removeWhite: function () {
        this.txt = this.txt.replace(/\s+/g, '');
        return this;
    },

    evenToUp: function () {
        var res = "";
        for (var i = 0; i < this.txt.length; i++) {
            if (i % 2 == 0) res += this.txt[i].toUpperCase();
            else res += this.txt[i];
        }
        this.txt = res;
        return this;
    }
}

txtProcesor.txt = " abc  def     ";
alert(txtProcesor.removeWhite().evenToUp().txt); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T23:50:46.410

这基本上是 JQuery 的工作方式。这个想法是让每个函数返回包含这些函数的对象，可以*这么*说。

编辑：您可以下载 JQuery 并查看它的源代码，因为这正是该库中正在发生的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-05-23T17:44:53.557

我也在阅读同一本书，但没有找到该概念的任何实现。但是，我在此找到了这个不错的简短[博客](https://medium.com/tiny-code-lessons/javascript-cascade-design-pattern-990b1a761ff4)。

以下是启用级联的方法：

```
function number(value) {
  this.value = value;

  this.plus = function (sum) {
    this.value += sum;
    return this;
  };

  this.return = function () {
    return this.value;
  };

  return this;
}

console.log(new number(5).plus(1).return()); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-07-29T02:43:16.570

这是一个将级联与回调相结合的演示，以及使用方法，希望对您有所帮助。

```
let calNum = function(num) {
        this.num = num;
        this.add = function(dif, callback) {
            this.num = this.num + dif;
            callback(this.num);
            return this;
        }
        this.sub = function(dif, callback) {
            this.num = this.num - dif;
            callback(this.num);
            return this;
        }
        this.multi = function(m, callback) {
            this.num = this.num * m;
            callback(this.num);
            return this;
        }

        return this;
    };

calNum(3).add(3,function(result) {
    console.log(result);
}).multi(2, function(result) {
    console.log(result);
}).sub(1, function(result) {
    console.log(result);
});  // The final result is 11 
```

# php - 从存储在变量中的内容的顶部删除前四行

> ID：758488
> 
> 赞同：12
> 
> 时间：2009-04-16T23:49:48.770
> 
> 标签：php, lines

我有一个变量需要在显示前去掉前四行：

```
Error Report Submission
From: First Last, email@example.com, 12345
Date: 2009-04-16 04:33:31 pm Eastern

The content to be output starts here and can go on for any number of lines. 
```

在将其显示为“未决错误报告”视图的一部分之前，我需要从该数据中删除“标题”。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-16T23:52:58.730

嗯。我确信有人会想出一些漂亮/更短/更好的东西，但是怎么样：

```
$str = implode("\n", array_slice(explode("\n", $str), 4)); 
```

如果这太难看，您可以随时将其抽象掉：

```
function str_chop_lines($str, $lines = 4) {
    return implode("\n", array_slice(explode("\n", $str), $lines));
}

$str = str_chop_lines($str); 
```

**编辑**：再想一想，我不建议使用该`str_chop_lines`功能，除非您打算在应用程序的许多部分执行此操作。我认为，最初的单行代码已经足够清楚了，任何偶然`str_chop_lines`发现的人可能不会意识到默认值是 4，而无需转到函数定义。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T23:56:48.877

`$content = preg_replace("/^(.*\n){4}/", "", $content);`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T23:55:32.187

Strpos 有很大帮助：这是一个示例：

```
// $myString = "blah blah \n \n \n etc \n \n blah blah";

$len = strpos($myString, "\n\n"); 
$string = substr($myString, $len, strlen($myString) - $len); 
```

$string 然后在连续找到这两个换行符后包含字符串。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T23:53:00.977

使用 将字符串拆分为一个数组`split(rex)`，其中`rex`匹配两个连续的换行符，然后连接整个数组，但第一个元素（即标题）除外。

# c# - 如何在我的 C# 程序的面板中运行另一个应用程序？

> ID：758494
> 
> 赞同：79
> 
> 时间：2009-04-16T23:52:50.617
> 
> 标签：c#, .net, windows, winforms, exe

我一直在阅读有关如何从 C# 程序 (Process.Start()) 内部触发应用程序的大量信息，但我无法找到有关如何在我的 C# 程序面板中运行此新应用程序的任何信息. 例如，我想要一个按钮单击以在我的应用程序内打开 notepad.exe，而不是在外部打开。

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2009-04-17T02:33:26.987

使用 win32 API 可以“吃掉”另一个应用程序。基本上，您获得该应用程序的顶部窗口并将其父窗口设置为您要放置它的面板的句柄。如果您不想要 MDI 样式效果，您还必须调整窗口样式以使其最大化和删除标题栏。

这是一些简单的示例代码，其中我有一个带有按钮和面板的表单：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Threading;

namespace WindowsFormsApplication2
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void button1_Click(object sender, EventArgs e)
        {
            Process p = Process.Start("notepad.exe");
            Thread.Sleep(500); // Allow the process to open it's window
            SetParent(p.MainWindowHandle, panel1.Handle);
        }

        [DllImport("user32.dll")]
        static extern IntPtr SetParent(IntPtr hWndChild, IntPtr hWndNewParent);
    }
} 
```

* * *

我刚刚看到另一个例子，他们调用 WaitForInputIdle 而不是休眠。所以代码会是这样的：

```
Process p = Process.Start("notepad.exe");
p.WaitForInputIdle();
SetParent(p.MainWindowHandle, panel1.Handle); 
```

代码项目有一篇关于整个过程的好文章：[在 WinForm 项目中托管 EXE 应用程序](http://www.codeproject.com/KB/miscctrl/AppControl.aspx)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-17T00:03:37.660

我不知道这是否仍然是推荐使用的东西，但“对象链接和嵌入”框架允许您将某些对象/控件直接嵌入到您的应用程序中。这可能仅适用于某些应用程序，我不确定记事本是否是其中之一。对于像记事本这样非常简单的东西，您可能会更轻松地使用由您使用的任何媒体（例如 WinForms）提供的文本框控件。

这是 OLE 信息的链接以开始使用：

[http://en.wikipedia.org/wiki/Object_Linking_and_Embedding](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-06-29T07:14:12.447

使用 WinForm 容器为外部应用程序提供另一个有趣的解决方案如下：

```
[DllImport("user32.dll")]
static extern IntPtr SetParent(IntPtr hWndChild, IntPtr hWndNewParent);

private void Form1_Load(object sender, EventArgs e)
{
    ProcessStartInfo psi = new ProcessStartInfo("notepad.exe");
    psi.WindowStyle = ProcessWindowStyle.Minimized;
    Process p = Process.Start(psi);
    Thread.Sleep(500);
    SetParent(p.MainWindowHandle, panel1.Handle);
    CenterToScreen();
    psi.WindowStyle = ProcessWindowStyle.Normal;
} 
```

ProcessWindowStyle.Normal的步骤 `ProcessWindowStyle.Minimized`消除了烦人的延迟。

[![在此处输入图像描述](https://i.stack.imgur.com/33YkS.png)](https://i.stack.imgur.com/33YkS.png)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-06-28T14:14:27.803

*   在答案中添加一些解决方案..**

这段代码帮助我将一些可执行文件停靠在 Windows 窗体中。像记事本、Excel、word、Acrobat 阅读器等等...

但它不适用于某些应用程序。有时当您启动某个应用程序的进程时......等待空闲时间......并尝试获取它的 mainWindowHandle......直到主窗口句柄变为空......

所以我做了一个技巧来解决这个问题

如果您将主窗口句柄设为空...然后在系统上搜索所有正在运行的进程并找到您的进程...然后获取进程的主窗口并将设置面板作为其父级。

```
 ProcessStartInfo info = new ProcessStartInfo();
        info.FileName = "xxxxxxxxxxxx.exe";
        info.Arguments = "yyyyyyyyyy";
        info.UseShellExecute = true;
        info.CreateNoWindow = true;
        info.WindowStyle = ProcessWindowStyle.Maximized;
        info.RedirectStandardInput = false;
        info.RedirectStandardOutput = false;
        info.RedirectStandardError = false;

        System.Diagnostics.Process p = System.Diagnostics.Process.Start(info); 

        p.WaitForInputIdle();
        Thread.Sleep(3000);

        Process[] p1 ;
    if(p.MainWindowHandle == null)
    {
        List<String> arrString = new List<String>();
        foreach (Process p1 in Process.GetProcesses())
        {
            // Console.WriteLine(p1.MainWindowHandle);
            arrString.Add(Convert.ToString(p1.ProcessName));
        }
        p1 = Process.GetProcessesByName("xxxxxxxxxxxx");
        //p.WaitForInputIdle();
        Thread.Sleep(5000);
      SetParent(p1[0].MainWindowHandle, this.panel2.Handle);

    }
    else
    {
     SetParent(p.MainWindowHandle, this.panel2.Handle);
     } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-12-17T07:10:03.573

我注意到所有先前的答案都使用较旧的 Win32 用户库函数来完成此操作。我认为这在*大多数*情况下都会起作用，但随着时间的推移会变得不那么可靠。

现在，还没有这样做，我无法告诉您它的效果如何，但我知道当前的 Windows 技术可能是一个更好的解决方案：[桌面 Windows 管理器 API](https://msdn.microsoft.com/en-us/library/windows/desktop/aa969540(v=vs.85).aspx)。

DWM 是同一种技术，可让您使用任务栏和任务切换器 UI 查看应用程序的实时缩略图预览。我相信它与远程终端服务密切相关。

我认为当您强制应用程序成为不是桌面窗口的父窗口的子窗口时可能会发生的一个问题是，一些应用程序开发人员会对设备上下文 (DC)、指针（鼠标）位置做出假设，屏幕宽度等，当它“嵌入”到主窗口时可能会导致不稳定或有问题的行为。

我怀疑您可以通过依赖 DWM 来帮助您管理必要的转换，从而在另一个应用程序的容器窗口中可靠地呈现应用程序的窗口并与之交互，从而在很大程度上消除这些问题。

该文档假定 C++ 编程，但我发现一个人制作了他声称的开源 C# 包装器库：[https](https://bytes.com/topic/c-sharp/answers/823547-desktop-window-manager-wrapper) ://bytes.com/topic/c-sharp/answers/823547-desktop-window-manager-wrapper . 帖子很旧，源不在 GitHub、bitbucket 或 sourceforge 之类的大型存储库上，所以我不知道它的最新情况。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-17T00:04:53.523

如果你想在你的应用程序中运行记事本，你可能会更好地使用文本编辑器组件。WinForms 显然有一个基本的文本框，但我怀疑可以在互联网上找到提供记事本功能（或更好）的更高级的组件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-17T00:19:02.957

我知道如果其他应用程序可以将自己附加到 win32 窗口句柄，这是可能的。例如，我们有一个单独的 C# 应用程序，它在它的一个窗口中托管一个 DirectX 应用程序。我不熟悉如何实现的确切细节，但我认为只需将`Handle`面板的 win32 传递给其他应用程序就足以让该应用程序附加其 DirectX 表面。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-04-16T23:58:25.143

简短的回答：

不

简短的答案：

只有当其他应用程序被设计为允许它时，才通过提供组件供您添加到您自己的应用程序中。

# add - 创建 Vista 用户帐户

> ID：758506
> 
> 赞同：1
> 
> 时间：2009-04-16T23:55:50.423
> 
> 标签：add, windows-vista, new-operator

我想以编程方式在启用了 UAC 的 Windows Vista 中创建登录帐户。

我有一个创建用户帐户的 OCX，它已经在 NT 和 XP 上工作了多年，但现在我们的应用程序在 Vista 上创建帐户时因访问被拒绝而失败。如果我们的客户关闭 UAC，然后设置该应用程序，它就可以正常工作。但是，在完成配置我们的应用程序之前让我们的用户关闭 UAC 并重新启动是不可接受的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T00:08:41.143

如果您在 Vista 中以管理员权限运行您的应用程序，那么它可以工作吗？

您还可以使用以下代码创建具有提升权限的 COM 对象：

```
HRESULT __stdcall CreateElevatedComObject(HWND hwnd, REFCLSID rclsid, REFIID riid, __out IUnknown ** ppv)
{
    OSVERSIONINFO ver={sizeof(ver)};
    if (GetVersionEx(&ver) && ver.dwMajorVersion > 5)
    {
        BIND_OPTS3 bo;
        WCHAR wszCLSID[50];
        WCHAR wszMonikerName[300];

        if (StringFromGUID2(rclsid, wszCLSID, ELEMENTS(wszCLSID)))
        {
            HRESULT hr = StringCchPrintf(wszMonikerName,
                ELEMENTS(wszMonikerName),
                L"Elevation:Administrator!new:%s",
                wszCLSID);
            if (FAILED(hr))
                return hr;
            memset(&bo, 0, sizeof(bo));
            bo.cbStruct = sizeof(bo);
            bo.hwnd = hwnd;
            bo.dwClassContext  = CLSCTX_LOCAL_SERVER;
            return CoGetObject(wszMonikerName, &bo, riid, (void **)ppv);
        }
        return E_FAIL;
    }
    else
        return ::CoCreateInstance(rclsid,NULL,CLSCTX_ALL,riid,(void**)ppv);
} 
```

在 UAC 下运行，它将显示一个海拔对话框。该对象将在 dllhost 中耗尽进程（我认为），但具有完整的管理员权限。

另请参阅[Vista 中 UAC 的分步指南](http://technet.microsoft.com/en-us/library/cc709691.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T00:13:05.267

[这是另一篇](http://msdn.microsoft.com/en-us/library/aa905330.aspx)关于在部署时处理 UAC 的文章。已经经历了一些 vista 部署问题，我只能对你说祝你好运。:)

# excel - 自定义工具栏中的文本框

> ID：758515
> 
> 赞同：4
> 
> 时间：2009-04-16T23:59:33.473
> 
> 标签：excel, ms-office, vba

是否可以将文本框控件放在 Excel 的自定义工具栏中。我创建了一个显示此工具栏的加载项。我想要做的是当用户在文本框中键入时，加载项应该根据用户键入的内容调用过程或函数。

我想在 MS Excel 中的 VBA 中执行此操作。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T01:04:27.437

如果您使用 Excel 2007 并已实现 IRibbonExtensibility::GetCustomUI，那么您可以使用以下 XML 在您的插件 GUI 中定义一个编辑框：

```
<customUI xmlns="http://schemas.microsoft.com/office/2006/01/customui">
    <ribbon startFromScratch="false">
        <tabs>
            <tab id="MyTab" label="My Tab">
                <group id="MyGroup" label="My Group">
                    <editBox id="MyEditBox" getText="MyEditBoxCallbackgetText" label="Editbox Label" onChange="MyEditBoxCallbackOnChange"/>
                 </group>
            </tab>
        </tabs>
    </ribbon>
</customUI> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T17:50:03.720

我发现：

```
Sub test()
    Set myControl = CommandBars("Test").Controls.Add(Type:=msoControlEdit, Before:=1)
    With myControl
        .Caption = "Search"
        .OnAction = "Tester"
    End With
End Sub

Sub Tester()
    MsgBox "I am gonna search for: " & CommandBars("Test").Controls(1).Text
    CommandBars("Test").Controls(1).Text = ""
End Sub 
```

# dialog - 自动点击问题

> ID：758519
> 
> 赞同：1
> 
> 时间：2009-04-17T00:00:37.510
> 
> 标签：dialog, detection, user32, automated-tests

我正在编写一个用于自动化测试的程序，该程序使用各种 User32.dll 库调用随机单击打开的应用程序窗口。我当前的问题是，如果单击会打开一个对话框，则使用 Process.WaitForInputIdle() 不会等待足够长的时间来检测到该对话框的下一次循环，这意味着会提示多次点击，如果这些点击发生出现在我想避免的对话框中的某些内容上（比如退出按钮），无法提前告知。我的问题是这个。有没有办法等待进程或线程完成所有处理并且只在消息循环中再次等待？

我希望这是有道理的。

干杯

罗斯

编辑

如果做不到这一点，是否有可能将目标程序和我的程序的进程/线程设置为都使用相同的处理器并调整每个处理器的优先级，以便目标程序获得优先权？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T00:06:38.900

不幸的是，一旦应用程序处于没有输入消息等待的消息循环中，WaitForInputIdle 就会立即返回。

如果您拥有对话框的代码，您可以让对话框在其 WM_INITDIALOG 中调用 SetEvent，以向您的自动化发出信号，表明它已准备好进行测试。或者，您可以查看在进程上使用 SetWinEventHook 并等待实际创建对话框，然后再向其发送输入事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T03:30:42.223

解决这个问题的方法似乎是使用 SendMessage API 而不是 mouse_event 或 SendInput API。这样做的原因是 SendMessage 阻塞，直到它被处理。只需确保您始终在您想要单击的位置（使用 WindowFromPoint）下立即获得窗口句柄，并使用 ScreenToClient 将鼠标坐标从屏幕转换为客户端坐标。使用 ((pt.Y << 16) + pt.X) 将坐标打包到 lParam 参数中。这将阻塞直到被处理，因此显示的任何模式对话框都会阻塞此调用。

# testing - 测试 RSS 提要

> ID：758526
> 
> 赞同：11
> 
> 时间：2009-04-17T00:04:05.037
> 
> 标签：testing, rss, interop

我正在寻找测试我创建的 RSS Feed 并且我正在寻找一些好的 RSS Feed 应用程序来测试。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-17T00:08:00.317

不要只是尝试一堆，看看它是否有效 - 验证它。让我为你谷歌这些：

*   [W3C RSS 验证器](http://validator.w3.org/feed/)
*   [实验性在线 RSS 1.0 验证器](http://www.ldodds.com/rss_validator/1.0/validator.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T00:08:18.787

Firefox 应该可以很好地进行基本测试。您也可以尝试使用谷歌阅读器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T00:20:45.747

[在Safari](http://www.apple.com/safari/)中测试提要是值得的。

此外，如果您使用的是 Mac OS X，这里有一些很好的应用程序可以测试它：

*   [网络新闻通讯社](http://www.newsgator.com/INDIVIDUALS/NETNEWSWIRE/)
*   [Apple Mail](http://www.apple.com/macosx/features/mail.html)（随 OS X 提供）
*   [新闻火](http://www.newsfirex.com/)
*   [时代](http://acrylicapps.com/times/)

但是，如果它是有效的提要，则应该没问题。

史蒂夫

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-17T04:27:21.927

[http://www.feedvalidator.org/](http://www.feedvalidator.org/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T04:48:16.570

不要忘记 Outlook。巨大的市场份额和它自己的怪癖。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T00:06:24.783

[谷歌读者](http://reader.google.com)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-17T00:09:21.217

[喂恶魔](http://www.newsgator.com/Individuals/FeedDemon/Default.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-17T00:24:37.343

RSS 阅读器应用程序 - [Greatnews](http://www.curiostudio.com/)

在线 RSS 阅读器 - [Google 阅读器](http://www.google.com/reader/)

此外，还有一些有用的 FF 附加组件：

[简单的 RSS 阅读器](https://addons.mozilla.org/en-US/firefox/addon/5459)

[RSS 验证器](https://addons.mozilla.org/en-US/firefox/addon/2294)

[智者](https://addons.mozilla.org/en-US/firefox/search?q=rss)

[比特尼克](https://addons.mozilla.org/en-US/firefox/addon/4979)

# xslt - Xsl：如何根据总和进行分组和排序？

> ID：758527
> 
> 赞同：2
> 
> 时间：2009-04-17T00:04:39.280
> 
> 标签：xslt

我有以下 xml

```
 <ResultCollection>
  <Result Id="551550" Pass="23" Fail="0" Owner="Dong"/>
  <Result Id="551565" Pass="4" Fail="3" Owner="Dong"/>
  <Result Id="551567" Pass="61" Fail="0" Owner="Mei"/>
  <Result Id="551580" Pass="10" Fail="1" Owner="Dong"/>  
  <Result Id="551580" Pass="0" Fail="4" Owner="Sen"/>  
  <Result Id="551548" Pass="1" Fail="12" Owner="Sen"/>
</ResultCollection> 
```

我有一个生成以下摘要的 xsl

```
Owner   Total   Pass    Fail
Dong    41  37  4
Mei     61  61  0
Sen     17  1   16 
```

**如何根据通过或失败对结果进行排序？**

我的 xsl 看起来像这样

```
 <?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl">
    <xsl:output method="xml" indent="yes"/>
  <xsl:key name="FeatureOwner" match="Result" use="@Owner" />
    <xsl:template match="/">
      <html>
        <head>
          <title>Result Summary</title>
        </head>
        <body>
                <table>
                  <tr>
                    <td>
                      <b>Owner</b></td>
                    <td>
                      <b>Total</b>
                    </td>
                    <td>
                      <b>Pass</b>
                    </td>
                    <td>
                      <b>Fail</b>
                    </td>
                  </tr>
                  <xsl:for-each select="ResultCollection/Result[generate-id(.) = generate-id(key('FeatureOwner', @Owner)[1])]">
                    <xsl:variable name="varFeatureOwner">
                      <xsl:value-of select="@Owner" />
                    </xsl:variable>
                    <xsl:variable name="totFailures" select="sum(//ResultCollection/Result[@Owner=$varFeatureOwner]/@Fail)" />
                    <xsl:variable name="totPass" select="sum(//ResultCollection/Result[@Owner=$varFeatureOwner]/@Pass)" />
                    <xsl:variable name="total" select="$totPass+$totFailures" />
                     <tr>
                        <td>
                          <xsl:value-of select="$varFeatureOwner"/>
                        </td>
                        <td>
                          <xsl:value-of select="$total"/>
                        </td>
                        <td>
                          <xsl:value-of select="$totPass"/>
                        </td>
                        <td>
                          <xsl:value-of select="$totFailures"/>
                        </td>
                      </tr>
                  </xsl:for-each>
                </table>
          </body>
      </html>
    </xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T02:19:22.777

**像这样**的东西（*我已经重新构建了你的代码，因为它丢失了很多*）：

**这个 XSLT 转换**：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

 <xsl:param name="pSortBy" select="'Pass'"/>

 <xsl:key name="kResultByOwner" match="Result"
  use="@Owner"/>

    <xsl:template match="/">
        <table>
            <xsl:for-each select=
            "ResultCollection/Result
                 [generate-id(.) 
                 = 
                  generate-id(key('kResultByOwner', @Owner)[1])
                  ]">
                 <xsl:sort data-type="number" select=
                "sum(key('kResultByOwner', @Owner)
                               /@*[name()=$pSortBy])"/> 

                <xsl:variable name="totFailures" select=
                "sum(/ResultCollection/Result
                          [@Owner=current()/@Owner]
                              /@Fail
               )" />
                <xsl:variable name="totPass" select=
                "sum(/ResultCollection/Result
                           [@Owner=current()/@Owner]
                              /@Pass
               )" />

                <xsl:variable name="total" select=
                   "$totPass+$totFailures" />
                <tr>
                    <td>
                        <xsl:value-of select="current()/@Owner"/>
                    </td>
                    <td>
                        <xsl:value-of select="$total"/>
                    </td>
                    <td>
                        <xsl:value-of select="$totPass"/>
                    </td>
                    <td>
                        <xsl:value-of select="$totFailures"/>
                    </td>
                </tr>
            </xsl:for-each>
        </table>
    </xsl:template>
</xsl:stylesheet> 
```

**当应用于最初提供的 XML 文档时**：

```
<ResultCollection>
    <Result Id="551550" Pass="23" Fail="0" Owner="Dong"/>
    <Result Id="551565" Pass="4" Fail="3" Owner="Dong"/>
    <Result Id="551567" Pass="61" Fail="0" Owner="Mei"/>
    <Result Id="551580" Pass="10" Fail="1" Owner="Dong"/>
    <Result Id="551580" Pass="0" Fail="4" Owner="Sen"/>
    <Result Id="551548" Pass="1" Fail="12" Owner="Sen"/>
</ResultCollection> 
```

**产生想要的结果**）：

```
森 17 1 16
董 41 37 4
梅 61 61 0

```

**请注意以下几点**：

1.  仅属于当前组的元素的`@Pass`或属性值的总和（函数的使用）。`@Fail``key()`

2.  使用`<xsl:sort .../>`指令按所需的总和进行排序。

3.  使用一个名为 的全局参数`pSortBy`，其中包含要对总和进行排序的属性的名称。

4.  XSLT函数的使用`current()`

# .net - 散列表达式树

> ID：758559
> 
> 赞同：2
> 
> 时间：2009-04-17T00:17:33.990
> 
> 标签：.net, linq, expression-trees

我正在将一些伪智能缓存构建到[LINQ 查询提供程序](http://msdn.microsoft.com/en-us/library/system.linq.iqueryprovider.aspx)中。我想做的（理想情况下）是在某些情况下使用给定查询的表达式树作为缓存键。但是，我不想存储整个对象图本身，那么从表达式树中获取类似哈希和的值的快速方法是什么？或者如果我走错了方向，还有更好的选择吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T01:11:02.460

让我们考虑一下。大概您想将（表达式树的哈希，结果）存储在地图中。

如果不存储整个树，则无法区分相同的树和哈希冲突。

根据定义，哈希将较大的集合映射到较小的集合（这就是哈希有用的原因），因此根据定义，您将（至少有可能发生）冲突。

当您获得表达式树时，您将对它进行哈希处理，然后在您的地图中查找结果，这会导致两种可能性：

1.  这是地图中没有的散列，您以前从未见过的散列。你必须让这个运行，因为你没有缓存的结果。

2.  它是映射中的哈希，但由于您没有将产生哈希的旧表达式树存储在映射中，因此无法将新传递的表达式与旧表达式进行比较。您可能有匹配或可能有碰撞，*但没有办法区分这两种可能性。*您无法返回缓存的结果，因为它可能是冲突。

此外，即使它不是冲突，即使它与您上次看到的表达式树完全相同，我们如何知道支持对象 - 数据库，列表，任何*没有添加元素或删除或修改，使得表达式返回的结果可能与缓存的结果不同？

也就是说，您可以递归地散列一棵树：

```
hashATree:
if leaf node
  return hash(node)
else
  return hash(node) *OP* hashATree(left.child) *OP* hashATree(right.child) 
```

其中*OP*是一些操作（可能是乘法），或者更一般地说`hash(node) *OP* accumulate( children.begin(), children.end(), *OP* );`

当然，这与我们用来评估表达式树的递归相同（期望我们调用`node.eval( children);`）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-19T20:35:50.237

您可能可以使用此处提供的代码来完成。 [http://petemontgomery.wordpress.com/2008/08/07/caching-the-results-of-linq-queries/](http://petemontgomery.wordpress.com/2008/08/07/caching-the-results-of-linq-queries/)

这显示了如何解决闭包问题并支持本地集合。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-17T01:23:09.980

嗯，其实我觉得这可能很简单。

Expression 对象的 ToString() 方法将为您提供 Expression 的文本表示，如果您只想评估键的等效性，您可以对其进行散列。

# java - 是否可以在 Java 中将匿名内部类设为静态？

> ID：758570
> 
> 赞同：126
> 
> 时间：2009-04-17T00:23:57.580
> 
> 标签：java, syntax, inner-classes

在 Java 中，嵌套类可以是也可以`static`不是。如果它们是`static`，则它们不包含对包含实例的指针的引用（它们也不再称为内部类，它们称为嵌套类）。

`static`在不需要该引用时忘记创建嵌套类可能会导致垃圾收集或逃逸分析出现问题。

是否也可以创建一个匿名内部类`static`？还是编译器会自动解决这个问题（它可以，因为不能有任何子类）？

例如，如果我做一个匿名比较器，我几乎不需要对外部的引用：

```
 Collections.sort(list, new Comparator<String>(){
       int compare(String a, String b){
          return a.toUpperCase().compareTo(b.toUpperCase());
       }
  } 
```

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2009-04-17T00:43:56.220

不，你不能，不，编译器无法弄清楚。`static`这就是为什么 FindBugs 总是建议在匿名内部类不使用隐式`this`引用的情况下将其更改为命名嵌套类。

**编辑：** Tom Hawtin - tackline 说，如果匿名类是在静态上下文中创建的（例如在`main`方法中），那么匿名类实际上是`static`. 但 JLS[不同意](http://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.9.5)：

> 匿名类永远不会`abstract`（第 8.1.1.1 节）。匿名类始终是内部类（第 8.1.3 节）；它永远不会`static`（第 8.1.1 节、第 8.5.1 节）。匿名类始终是隐式的`final`（第 8.1.1.2 节）。

Roedy Green 的 Java 词汇表[说，](http://mindprod.com/jgloss/anonymousclasses.html)在静态上下文中允许匿名类的事实取决于实现：

> 如果你想让那些维护你的代码的人感到困惑，wags 发现`javac.exe`将允许在`static`init 代码和`static`方法中使用匿名类，即使语言规范说匿名类永远不会`static`。当然，这些匿名类无法访问对象的实例字段。我不建议这样做。该*功能*可以随时拉取。

**编辑 2：** JLS 实际上在[§15.9.2](http://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.9.2)中更明确地涵盖了静态上下文：

> 让*C*是被实例化的类，让*i*是被创建的实例。如果*C*是一个内部类，那么*i*可能有一个立即封闭的实例。*i*的直接封闭实例（第 8.1.3 节）确定如下。
> 
> *   如果*C*是匿名类，则：
>     *   如果类实例创建表达式出现在静态上下文中（第 8.1.3 节），则*i*没有立即封闭的实例。
>     *   否则，*i*的直接封闭实例是`this`。

因此，静态上下文中的匿名类大致相当于`static`嵌套类，因为它不保留对封闭类的引用，即使它在技术上不是一个`static`类。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-17T15:13:32.543

我认为这里的命名法有点混乱，诚然这太愚蠢和混乱了。

不管你怎么称呼它们，这些模式（以及一些具有不同可见性的变体）都是**可能的、正常的、合法的 Java：**

```
public class MyClass {
  class MyClassInside {
  }
}

public class MyClass {
  public static class MyClassInside {
  }
}

public class MyClass {
  public void method() {
    JComponent jc = new JComponent() {
      ...
    }
  }
}

public class MyClass {
  public static void myStaticMethod() {
    JComponent jc = new JComponent() {
      ...
    }
  }
} 
```

它们在语言规范中得到了满足（如果你真的很烦恼，请参阅第 15.9.5.1 节了解静态方法中的内容）。

但是这句话是**完全错误**的：

> javac.exe 将允许在静态初始化代码和静态方法中使用匿名类，即使语言规范说匿名类从不是静态的

*我认为引用的作者将 static关键字*与 static *context*混淆了。（诚​​然，JLS 在这方面也有点混乱。）

老实说，上面的所有模式都很好（无论你称它们为“嵌套”、“内部”、“匿名”等等……）。真的，没有人会在 Java 的下一个版本中突然删除这个功能。诚实地！

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-17T10:18:59.553

有点儿。在静态方法中创建的匿名内部类显然是有效的静态类，因为没有外部 this 的来源。

静态上下文中的内部类和静态嵌套类之间存在一些技术差异。如果您有兴趣，请阅读 JLS 第 3 版。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-17T00:43:15.660

内部类不能是静态的——静态嵌套类不是内部类。[Java 教程在这里讨论它](http://java.sun.com/docs/books/tutorial/java/javaOO/nested.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-02T11:19:59.427

匿名内部类从不是静态的（它们不能声明静态方法或非最终静态字段），但如果它们是在静态上下文（静态方法或静态字段）中定义的，它们在某种意义上表现为静态，因为它们不能访问封闭类的非静态（即实例）成员（就像静态上下文中的所有其他内容一样）

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2011-03-21T00:51:06.577

关于通过在静态方法中调用匿名内部类来使它们成为静态的注意事项。

这实际上并没有删除引用。您可以通过尝试序列化匿名类而不使封闭类可序列化来测试这一点。

# .net - CustomViewData 的最佳方式？

> ID：758583
> 
> 赞同：1
> 
> 时间：2009-04-17T00:27:52.327
> 
> 标签：.net, viewmodel, viewdata

将自定义属性添加到侧宽 ViewDataDictionary 的最实用方法是什么？

让我们假设一个简单的案例：

```
public ActionResult Index()
{
  // ViewData["Title"] = "Home";
  ViewData.Title = "Home";
  return View();
} 
```

首先想到的是一个自定义类并在应用程序基础控制器中使用“new”：

```
public class CustomDataDictionary : ViewDataDictionary
{
  public string Title { get; set; }
}

public class ApplicationController : Controller
{
    public new CustomDataDictionary ViewData { get; set;} 
} 
```

我假设您还必须创建一个具有相同属性的相应 CustomViewPage 才能在视图中使用自定义视图数据字典。

想到的第二件事是创建一个 ViewDataDictionaryExtensions 类。

第三，使用“视图模型”。我对 View Models 的不满是总是创建一个并将其传递给 View 似乎在控制器代码中一遍又一遍地重复自己，至少与前两个选项相比。

真正的目标是每个应用程序可能在 ViewData 中有一组核心属性，这些属性对于该应用程序的目的是有意义的。我倾向于回避依赖字典键，如果有真正的属性让其他开发人员依赖一个来知道要设置什么数据，那就太好了。此外，键很容易拼写错误。

这三种方法都能完成工作。别人做了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T08:58:31.960

重新命名拼写错误的问题 - 这就是常量的用途。

为了`ViewData`正确输入，您需要继承等；因此，当您完成此操作时，我想知道您是否不能轻松地将一些通用代码添加到设置密钥的控制器中。

至少对我来说，使用密钥似乎是最不复杂的答案 - 这也适用于最广泛的情况（即某些代码只知道基本的`IDictionary<string,object>`）。

您可能也对[这个相关问题](https://stackoverflow.com/questions/759519/c-centralizing-repeating-viewdata-in-mvc)感兴趣。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-03T13:08:45.567

所有这些听起来都行得通。我认为您选择哪一个取决于您的要求/需求。（真的是独一无二且内容丰富的答案，嗯？）

你的问题是“其他人做了什么？” 尽管。因此，如果您正在轮询，*我*最近将常量方法用于较小的应用程序。我还没有做过企业 MVC 应用程序，但我想我可能会创建一个继承 Controller 并定义这些额外属性的基类。如果我想将这些一致地传递给视图，我同样会为我的模型创建一个基类。然而，这必须谨慎使用——即使你正式输入它们，它们的行为仍然很像全局变量。所以你当然要小心。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-04T17:44:36.660

最后，至少对于这个应用程序，我选择了一个基本的 AppViewModel 类。Controller.OnActionExecute/ed 查看 ViewData.Model 是否已设置，如果未设置，则将 AppViewModel 的实例放置在其位置，以便所有页面都有一个一致的模型可以使用（Model.Title、Model.IsAuthenticated、Model .用户等）

然后更详细的控制器操作有一个 AppModelView 的子类，它可以在操作本身中手动设置为 ViewData.Model，也可以通过属性在 OnExecute/ed 中设置。

根本没有太多代码，但它不会在所有控制器操作中重复相同的旧创建/设置代码。对我来说，它将视图数据保存为一个包，而不是弄乱 Controller api。

# php - PHP中有没有像Chronic这样的东西？

> ID：758584
> 
> 赞同：0
> 
> 时间：2009-04-17T00:28:11.923
> 
> 标签：php, datetime, parsing

我正在寻找一个非常强大的日期时间解析器，类似于 Ruby 的 Chronic，但适用于 PHP。strtotime() 并没有针对我在项目中看到的许多边缘情况进行裁剪。

有人知道有什么好的图书馆吗？

理想情况下： - PHP 5 OOP - 有据可查 - 快速且稳定

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T13:36:56.767

您缺少哪些实际的边缘情况？如果您不知道边缘情况是什么，就不可能确定哪些情况适用。这些日期是人们输入的日期还是机器想出的日期？

# php - 从文件夹加载图像列表

> ID：758594
> 
> 赞同：3
> 
> 时间：2009-04-17T00:31:21.773
> 
> 标签：php, javascript, jquery

我有一个图像文件夹，从 10 到 200，一个网页，一个 jquery 淡入淡出和一个 php 脚本，可以读取充满图像的文件夹

有没有办法让 php 脚本扫描文件夹，获取图像列表（在数组中？）并将其传递给 jquery 脚本？（第一个问题）

现在，我可以从找到的文件的结果 php 列表中创建一个 xml 文件，或者从 html`<li>`中的列表中创建一个 html。还有其他方法吗？（问题2）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-17T01:16:38.467

从[nickf 的优秀答案](https://stackoverflow.com/questions/758594/load-list-of-image-from-folder/758603#758603)继续，这对于不同类型的图像稍微更健壮。

```
$imagesDir = 'path/to/your/images/';
$images = glob($imagesDir . '*.{jpg,jpeg,png,gif}', GLOB_BRACE);

echo json_encode($images); 
```

还有其他方法可以做到这一点，但这是最简单的。请注意，某些文件系统区分大小写，因此请确保扩展名列表与您所追求的完全匹配。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-17T00:36:23.337

该`glob`函数将扫描一个文件夹并返回一个数组：

```
$jpgs = glob("*.jpg"); 
```

然后，您可以使用 JSON 将其传递回 jQuery：

```
echo json_encode($jpgs); 
```

然后它只是循环遍历结果的情况，生成必要的 HTML。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T01:02:44.773

要生成列表项，您可以使用类似这样的东西（假设图像是 json_encode() 的结果）：

```
var images = {'image1':'images/image1.jpg','image2':'images/image2.jpg'}

jQuery('#imagelist').empty();
jQuery.each(images, function() {
  jQuery('#imagelist').append('<li>'+this+'</li>');
}); 
```

并确保您在 HTML 源代码中有一个无序列/有序列表：

```
<ul id="imagelist">
  <li>No images found</li>
</ul> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T00:34:44.947

您不能只将图像作为“数据”传递到 JavaScript 中进行显示，至少不能以合理的方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T11:19:29.203

我会在这里尝试一下，得到很多人的回答

亚历克斯和尼克：

```
<?php
  $imagesDir = 'path/to/your/images/';
  $images = glob($imagesDir . '*.{jpg,jpeg,png,gif}', GLOB_BRACE);
  echo json_encode($images);
?> 
```

并从 mattoc (修改) 用于[超大](http://buildinternet.com/2009/02/supersized-full-screen-backgroundslideshow-jquery-plugin/)

```
jQuery('#imagelist').empty();
jQuery.each(images, function() {
  jQuery('#imagelist').append('<img src="'+this+'"/>');
}); 
```

并希望最后能得到这样的东西！

```
<div id="supersize">
    <img  src="images/001.jpg"/>
    <img  src="images/002.jpg"/>
    <img  src="images/003.jpg"/>
</div> 
```

对于最后一段代码，我将不得不找到一个解决方案，将图像“一个接一个”发送到超大插件，并且预加载没有图像错误列表的问题

假设我得到 150 张图片列表......这将是一个问题，所以让插件只知道有 2 张图片，预加载下一张，“ajax”更改下一张图片

```
image001.jpg is display
... preload image002.jpg
display image002.jpg
... preload image003.jpg
on and on and on.... 
```

这一切都是动态的，直到数组结束！

# asp.net - 提取没有 WebResource.axd 的嵌入资源

> ID：758600
> 
> 赞同：1
> 
> 时间：2009-04-17T00:34:46.743
> 
> 标签：asp.net, webresource.axd

有没有办法以编程方式提取嵌入式资源而不是通过 WebResource.axd 处理程序？我有两个传递给 WebResource.axd 处理程序的参数 (d & t)。我希望有一种方法可以让我自己使用这些参数来提取资源。任何提示表示赞赏，谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T06:18:35.503

You can use the Assembly class. The code below returns an embedded resource as a stream from the current assembly:

```
using System.Reflection;

Assembly assembly = Assembly.GetExecutingAssembly();
Stream stream = assembly.GetManifestResourceStream("YourEmbeddedResource"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-27T09:25:49.457

我找到了一篇关于解密那些“d”和“t”参数的好文章，[调试 ASP.NET 2.0 Web 资源：解密 URL 和获取资源名称](http://blogs.telerik.com/blogs/posts/07-03-26/debugging_asp_net_2_0_web_resources_decrypting_the_url_and_getting_the_resource_name.aspx)。请注意，t 参数是时间戳，d 参数包含请求的资源名称。

# html - 从 XML URI 生成 Windows 路径

> ID：758605
> 
> 赞同：0
> 
> 时间：2009-04-17T00:36:31.620
> 
> 标签：html, windows, xml, url, string

将 XML URI 转换为 Windows 文件路径的正确方法是什么？

作为起点，可以转向：

```
file:///C:/DirA/DirB/File.txt 
```

进入：

```
C:\DirA\DirB\File.txt 
```

...首先删除`file:///`子字符串（使用它来确定我们正在处理本地文件），然后在原始字符串中出现斜线的任何位置放置一个反斜线。这似乎是一个好的开始，但这还不够。例如，URI 可能如下所示：

```
file:///C:/DirA/DirB/With%20Spaces.txt 
```

...变成：

```
C:\DirA\DirB\With Spaces.txt 
```

...用空格替换 %20s 之后。然而，即使这样也不够，因为同样可能需要处理其他此类[编码](http://www.blooberry.com/indexdot/html/topics/urlencoding.htm)。此外，其中一些字符不是合法的 Windows 文件名字符，因此有必要确定哪些编码在 Windows 文件名中有效，并在遇到其他情况时标记错误。

还有什么我忘记了吗？有人愿意扩展上述内容吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T15:40:51.667

使用该`Uri.LocalPath`物业。

```
string path = new Uri("file:///C:/folder/file.txt").LocalPath; 
```

这是平台敏感的，在我的 Windows 机器上`path`也是如此。`"C:\folder\file.txt"`

请注意，您还可以`file`使用构造函数采用其他方式（从本地文件系统路径到 URI）：

```
var uri = new Uri(@"C:\folder\file.txt"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T00:58:32.147

您应该在 Windows 上使用[PathCreateFromUrl() 。](http://msdn.microsoft.com/en-us/library/bb773581(VS.85).aspx)

另请参阅[文件的奇异和不愉快的故事：URL](http://blogs.msdn.com/freeassociations/archive/2005/05/19/420059.aspx)。

# c# - Linq 问题：组合 Where 子句

> ID：758606
> 
> 赞同：3
> 
> 时间：2009-04-17T00:37:02.243
> 
> 标签：c#, .net, linq, linq-to-xml

问候！

我有一些看起来像这样的 XML：

```
<Root>
    <SectionA>
        <Item id="111">
            <Options>
                <Option val="a" cat="zzz">
                    <Package value="apple" />
                    <Feature value="avacado" />
                </Option>
                <Option val="b" cat="yyy">
                    <Package value="banana" />
                    <Feature value="blueberry" />
                </Option>
            </Options>
        </Item>
        <Item id="222">
            <Options>
                <Option val="c" cat="xxx">
                    <Package value="carrot" />
                    <Feature value="cucumber" />
                </Option>
                <Option val="d" cat="www">
                    <Package value="dairy" />
                    <Feature value="durom" />
                </Option>
            </Options>
        </Item>
    </SectionA>
    <SectionB>
    .
    .
    .
    </SectionB>
</Root> 
```

我想根据 ITEM 的 ID 属性为“111”和 OPTION 的 VAL 属性为“a”来获取 PACKAGE 和 FEATURE 值。

我不知道从哪里开始。我可以使用 where 选择 ITEM 节点，但我不确定如何将它与 OPTION 节点上的 where 子句结合使用。有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-17T01:37:34.877

这对我有用。

```
var doc = XDocument.Parse(s);

var items = from item in doc.Descendants("Item")
            where item.Attribute("id").Value == "111"
            from option in item.Descendants("Option")
            where option.Attribute("val").Value == "a"
            let package = option.Element("Package").Attribute("value")
            let feature = option.Element("Feature").Attribute("value")
            select new { Package = package.Value, Feature = feature.Value };

items.First().Feature; // = "avacado"
items.First().Package; // = "apple" 
```

如果需要，您可以省略`let`部分，它们只是为了使匿名类型更薄。

```
var items = from item in doc.Descendants("Item")
            where item.Attribute("id").Value == "111"
            from option in item.Descendants("Option")
            where option.Attribute("val").Value == "a"
            select new
            {
               Package = option.Element("Package").Attribute("value").Value,
               Feature = option.Element("Feature").Attribute("value").Value
            }; 
```

其实我更喜欢第二个。

* * *

和非查询Linq 风格。

```
var items = doc.Descendants("Item")
               .Where(item => item.Attribute("id").Value == "111")
               .SelectMany(item => item.Descendants("Option"))
               .Where(option => option.Attribute("val").Value == "a")
               .Select(option => new
               {
                Package = option.Element("Package").Attribute("value").Value,
                Feature = option.Element("Feature").Attribute("value").Value
               }); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T00:51:43.627

使用 SelectMany 的替代实现

```
var doc = XDocument.Parse(xml);
var items = from i in doc.Descendants("Item")
            from o in i.Descendants("Option")
            where i.Attribute("id").Value == "111"
               && o.Attribute("val").Value == "a"
         select new {
             Package = i.Descendants("Package").Attribute("value").Value,
             Feature = i.Descendants("Feature").Attribute("value").Value                     
         }; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T00:53:49.893

这是一种自下而上的方法：

```
var items = xdoc
            .Descendants("Option")
            .Where(o => (string)o.Attribute("val") == "a" && (int)o.Ancestors("Item").Single().Attribute("id") == 111)
            .Select(o => new { 
              Package = o.Element("Package"), 
              Feature= o.Element("Feature") 
            }); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T02:44:06.963

这是 VB 版本（VB 在 xml 东西中真的很摇滚）：

```
Module Module1

    Sub Main()
        Dim xml As XElement = <Root>
                                  <SectionA>
                                      <Item id="111">
                                          <Options>
                                              <Option val="a" cat="zzz">
                                                  <Package value="apple"/>
                                                  <Feature value="avacado"/>
                                              </Option>
                                              <Option val="b" cat="yyy">
                                                  <Package value="banana"/>
                                                  <Feature value="blueberry"/>
                                              </Option>
                                          </Options>
                                      </Item>
                                      <Item id="222">
                                          <Options>
                                              <Option val="c" cat="xxx">
                                                  <Package value="carrot"/>
                                                  <Feature value="cucumber"/>
                                              </Option>
                                              <Option val="d" cat="www">
                                                  <Package value="dairy"/>
                                                  <Feature value="durom"/>
                                              </Option>
                                          </Options>
                                      </Item>
                                  </SectionA>
                                  <SectionB>                                      
                                  </SectionB>
                              </Root>

        Dim data = From x In xml...<Option> _
                   Where x.Ancestors("Item").@id = "111" AndAlso x.@val = "a" _
                   Select Package = x.<Package>.@value, _
                          Feature = x.<Feature>.@value

        For Each item In data
            Console.WriteLine("Package: {0}, Feature: {1}", item.Package, item.Feature)
        Next
        Stop
    End Sub

End Module 
```

# perl - 如何在 Perl 中刷新反引号中的输出？

> ID：758611
> 
> 赞同：7
> 
> 时间：2009-04-17T00:40:03.627
> 
> 标签：perl, backticks

如果我有这个 perl 应用程序：

```
print `someshellscript.sh`; 
```

打印一堆东西并且需要很长时间才能完成，如何在 shell 脚本执行过程中打印该输出？

看起来 Perl 只会在完成时打印 someshellscript.sh 结果，有没有办法在执行过程中使输出刷新？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-17T00:47:09.943

您可能想要做的是这样的事情：

```
open(F, "someshellscript.sh|");
while (<F>) {
    print;
}
close(F); 
```

这将运行`someshellscript.sh`并打开一个读取其输出的管道。循环读取脚本生成的`while`每一行输出并打印出来。有关更多信息，请参阅[打开](http://perldoc.perl.org/functions/open.html)的文档页面。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T00:46:03.533

这里的问题是使用反引号转义将您的脚本存储到一个字符串中，然后您将其打印出来。出于这个原因，没有办法用打印“冲洗”。

使用 system() 命令应该连续打印输出，但您将无法捕获输出：

```
system "someshellscript.sh"; 
```

# subsonic - Subsonic 2.2 的安装下载在哪里？

> ID：758617
> 
> 赞同：0
> 
> 时间：2009-04-17T00:45:57.090
> 
> 标签：subsonic

有谁知道为什么我不能下载亚音速网站开发工具安装了？

它只显示源下载。有人有完整安装下载的链接吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T01:33:57.753

哦，他回来了 - 埃里克要开始安装他的安装程序了。可能下个星期吧。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T00:51:08.887

下载最新的 2.1 版本。然后下载 2.2 zip 并将文件复制到 2.1 安装。

您无法安装 2.2 的原因是，曾经为该项目贡献过该软件的开发人员暂停了贡献。虽然有传言说他回来了，但最终可能会发生。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-06T12:19:32.067

我最终找到了正确的下载位置。感谢所有的帮助。 [http://code.google.com/p/subsonicproject/](http://code.google.com/p/subsonicproject/) 看起来它已经转移到谷歌代码。

# opengl - OpenGL alpha值使纹理更白？

> ID：758638
> 
> 赞同：4
> 
> 时间：2009-04-17T00:56:20.607
> 
> 标签：opengl, textures

我正在尝试使用 RGBA 值加载纹理，但 alpha 值似乎只是使纹理更白，而不是调整透明度。我听说过 3D 场景存在这个问题，但我只是将 OpenGL 用于 2D。无论如何我可以解决这个问题吗？

我正在初始化 OpenGL

```
glViewport(0, 0, winWidth, winHeight);
glDisable(GL_TEXTURE_2D);
glEnable(GL_BLEND);
glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
glDisable(GL_DEPTH_TEST);
glClearColor(0, 0, 0, 0);
glMatrixMode(GL_PROJECTION);
glLoadIdentity();
gluOrtho2D(0, winWidth, 0, winHeight); // set origin to bottom left corner
glMatrixMode(GL_MODELVIEW);
glLoadIdentity();
glColor3f(1, 1, 1); 
```

* * *

屏幕截图： ![](https://i.stack.imgur.com/2HnoT.png) 那个褪色的点状图像应该是半透明的。黑色位应该是完全透明的。如您所见，它背后有一个图像没有显示出来。

生成该纹理的代码相当长，所以我将描述我所做的。它是一个 40*30*4 类型的 unsigned char 数组。每 4 个字符设置为 128（应该是 50% 透明，对吧？）。

然后我将它传递给这个函数，将数据加载到纹理中：

```
void Texture::Load(unsigned char* data, GLenum format) {
    glEnable(GL_TEXTURE_2D);
        glBindTexture(GL_TEXTURE_2D, _texID);
        glTexSubImage2D(GL_TEXTURE_2D, 0, 0, 0, _w, _h, format, GL_UNSIGNED_BYTE, data);
    glDisable(GL_TEXTURE_2D);
} 
```

而且...我想我刚刚发现了问题。正在使用以下代码初始化全尺寸纹理：

```
glEnable(GL_TEXTURE_2D);
    glBindTexture(GL_TEXTURE_2D, _texID);
    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, tw, th, 0, GL_LUMINANCE, GL_UNSIGNED_BYTE, NULL);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
    glTexEnvf(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
glDisable(GL_TEXTURE_2D); 
```

但我猜 glTexImage2D 也需要是 GL_RGBA 吗？我不能使用两种不同的内部格式？或者至少不是不同大小的（3字节对4字节）？GL_BGR 即使像这样初始化也能正常工作......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T02:31:33.957

为了他人的利益，我在这里发布我的解决方案。

问题是虽然我的 Load 函数是正确的，

```
glTexSubImage2D(GL_TEXTURE_2D, 0, 0, 0, _w, _h, GL_RGBA, GL_UNSIGNED_BYTE, data); 
```

我将 GL_RGB 传递给这个函数

```
glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, tw, th, 0, GL_LUMINANCE, GL_UNSIGNED_BYTE, NULL); 
```

其中*还*需要指定正确的字节数（四个）。根据我的理解，您不能对 SubImage 使用不同数量的字节，尽管我认为如果它确实具有相同的字节数（即混合and可以，但不是and ） ，您*可以*使用不同的格式。`GL_RGB``GL_BGA``GL_RGB``GL_RGBA`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T01:01:43.603

您的场景中是否有任何重叠的基元？

您知道您正在调用 glColor 的 3 参数版本，它将 alpha 设置为 1.0，对吗？

如果您可以发布屏幕截图或以其他方式描述会发生什么，例如，当您绘制两个具有相同颜色和不同 alpha 的图元时，这可能会有所帮助。事实上，任何演示该问题的代码都会有所帮助。

编辑：

我想使用 TexImage 和`GL_RGB`（对于*internalformat*，第三个参数）创建一个没有 alpha 或 alpha 值隐式初始化为 1 的 3 分量纹理，无论您提供什么样的像素数据。

`GL_BGR`不是此参数的有效值，也许它正在欺骗您的实现使用完整的 4 字节内部格式？（或者一个 2 字节的，根据`GL_LUMINANCE_ALPHA`）或者你的意思是传递`GL_BGR`给你的 Texture::Load() 函数，这应该与传递没有什么不同`GL_RGB`？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T15:30:27.743

我认为这应该可行，但它假设图像具有 alpha 通道。如果您尝试加载没有 alpha 通道的图像，您将收到异常或您的应用程序可能会崩溃。对于非 alpha 通道图像`GL_RGB`，`GL_RGBA`在设置`GL_UNSIGNED_BYTE`.

```
void Texture::Load(unsigned char* data) {
  glEnable(GL_TEXTURE_2D);
    glBindTexture(GL_TEXTURE_2D, _texID);
    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, tw, th, 0, GL_RGBA, GL_UNSIGNED_BYTE, data);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
    glTexEnvf(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
  glDisable(GL_TEXTURE_2D);
} 
```

# winapi - 应用程序屏幕捕获和渲染

> ID：758640
> 
> 赞同：0
> 
> 时间：2009-04-17T00:57:33.600
> 
> 标签：winapi, graphics, image-capture

我正在尝试编写一个简单的应用程序，它将对应用程序进行屏幕捕获，然后在“主”应用程序（即进行屏幕捕获的应用程序）中呈现该捕获。

我已经想出了如何获取窗口句柄并获取应用程序的屏幕截图，但我无法在“主”应用程序中呈现捕获的屏幕。

使用 GDI，我有以下代码要呈现：

```
Bitmap bit(hSrcbmp,hpal);
graphics.DrawImage(&bit,Gdiplus::PointF(0,0)); 
```

其中 hSrcbmp 是捕获屏幕的位图，图形是 GDI+“图形”对象。

构造函数调用位图后出现以下错误： Gdiplus::Image = {nativeImage=0x00000000 lastResult=Win32Error loadStatus=-858993460 }

*使用 Visual Studio 2005

*Windows XP

*Visual C++（非托管）

有任何想法吗？

另一个问题：有更好的方法吗？C#、DirectX 还是 openGL？谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T17:36:34.930

屏幕截图是 18 年来的 Win32 常见问题解答。有关标准代码（MS 和其他）、C 和 C++ 的信息，
请参见[win32 组](http://news://nntp.aioe.org/comp.os.ms-windows.programmer.win32)

# apache-flex - Flex 写入它自己的目录

> ID：758646
> 
> 赞同：0
> 
> 时间：2009-04-17T01:04:04.660
> 
> 标签：apache-flex, networking, writing

我有一个我正在编写的 Flex 应用程序（学习练习），我想运行一个网络驱动器以供许多用户访问。我希望用户能够在网络上保存高分。

用户已对其所在的网络位置进行读写。

我不想更改可能使用它的计算机上的任何内容（IE 安装 AIR）或 IE/Firefox 设置。他们只是默认的。

我不想运行服务器（IE PHP）

有什么办法吗？

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T01:19:57.540

不，不是没有空气。即使这样也很困难。Flex 在浏览器的上下文中运行，并且只有浏览器可用的资源可供它使用（出于明显的安全原因。）

Flash 在可靠性和安全性方面享有企业信任的独特地位，他们尽一切可能保护这一地位。所以你是沙盒的。

我能想到的最好的方法是将提供 URL 和通用或自定义读写协议的东西放在一起 - 可能不是微不足道的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T00:52:33.213

你真的想为此使用后端技术。如果您不同意它，Flash Player 10 可以将文件写入本地文件系统。您可能会通过将其引用为映射驱动器甚至命名主机来欺骗它使用网络资源。

[http://livedocs.adobe.com/flex/3/langref/flash/net/FileReference.html#save()](http://livedocs.adobe.com/flex/3/langref/flash/net/FileReference.html#save())

您还可以使用 FileReference 的“load()”方法将本地文件读入 Flex 应用程序。

我真的不建议您使用它在应用程序中编写，但看起来可以完成。这里需要注意的是，这些操作只有在用户专门为文件选择位置时才会发生：他们需要选择要加载的文件或选择保存文件的位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T14:49:42.757

您将不得不使用后端来访问这些资源中的任何一个。例如，如果您使用 BlazeDS，那么您可以只使用 Java 写入网络。无论如何，您将有一个服务器来托管您的应用程序。

# x11 - 查找 X 窗口管理器的名称

> ID：758648
> 
> 赞同：4
> 
> 时间：2009-04-17T01:05:00.150
> 
> 标签：x11, window-managers

如何从程序中找到正在运行的 X 窗口窗口管理器的名称？

如果我在另一个窗口管理器已经运行时启动另一个窗口管理器，则会发生错误，因此必须有一种方法让另一个窗口管理器检测到第一个窗口管理器。

它是如何工作的？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-07-12T04:10:18.993

根据[EWMH 规范](http://standards.freedesktop.org/wm-spec/wm-spec-1.3.html#id2506451)，兼容的窗口管理器会将`_NET_SUPPORTING_WM_CHECK`根窗口上的属性设置为窗口 ID。

如果该`_NET_SUPPORTING_WM_CHECK`属性存在并且包含现有窗口的 ID，则符合 ICCCM2.0 的窗口管理器正在运行。如果该属性存在但不包含现有窗口的 ID，则符合 ICCCM2.0 的窗口管理器在没有适当清理的情况下退出。如果该属性不存在，则没有符合 ICCCM2.0 的窗口管理器正在运行。

**该**窗口（不是根窗口，而是由根窗口上的属性描述的窗口）应该有一个`_NET_WM_NAME`属性，这就是您要寻找的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-03T05:41:55.027

wmctrl命令可以显示有关许多与 EWMH/NetWM 兼容的 X 窗口管理器的信息，包括它们的名称[：](http://linux.die.net/man/1/wmctrl)

```
$ wmctrl -m
Name: Compiz
... 
```

Accroding to [its Wikipedia page](http://en.wikipedia.org/w/index.php?title=Wmctrl&oldid=483351161)，它目前可与以下窗口管理器一起使用（2012 年 8 月）：

*   黑盒 >= 0.70
*   冰雪
*   kwin（KDE 的默认 WM）
*   metacity（GNOME 的默认 WM）
*   openbox >= 3（Lubuntu 的默认 WM）
*   锯鱼
*   fvwm >= 2.5
*   威美亚
*   pekwm
*   启蒙 >= 0.16.6
*   xfce >= 4
*   通量盒 >= 0.9.6
*   火柴盒
*   窗户制造商 >= 0.91
*   编译
*   惊人的
*   wmfs

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T01:38:21.083

您可能会找到一个包含信息的“原子”，但我认为不能 100% 保证所有窗口管理器都使用相同的原子。执行“xlsatoms”以列出服务器上的原子，或执行“xprop”（并单击）以查看特定窗口的属性（包括原子及其值）。

# mysql - 非 PHP MySQL 导入期间允许的内存大小耗尽

> ID：758651
> 
> 赞同：2
> 
> 时间：2009-04-17T01:06:16.323
> 
> 标签：mysql, memory

当我尝试使用以下命令导入大型 SQL 备份时：

```
mysql -u ***** -p***** nxtpp < backup.sql 
```

部分执行备份后，我收到以下错误消息：

```
Allowed memory size of 33554432 bytes exhausted 
```

我已经知道 php.ini 中的 memory_limit 变量，但问题是我没有使用 PHP 导入，只是使用 mysql 命令。我怎样才能解决这个问题？问题可能与服务器拥有的 128MB 内存有关吗？

编辑：原来我从中导出的 phpMyAdmin 产生了错误。我可以在实际的转储文件中看到错误的 HTML。当 MySQL 执行它时，它只是将错误打印出来。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T11:50:09.753

看起来仍然以某种方式涉及php。MySQL 的错误消息看起来不同。

您是否尝试使用 php 中的 exec() 或 system() 语句执行此命令？然后 memory_limit 仍然适用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T16:15:19.730

假设像 Peter Smit 所说的那样，这不是在 PHP 脚本中运行的，请尝试将 MySQL 的 key_buffer 设置增加到更大的值。

警告：这是一个关键的性能调整设置，因此请谨慎更改。较高的值将使 MySQL 消耗更多的机器内存。

顺便说一句，它应该在上线时移到[http://serverfault.com](http://serverfault.com)。

jpe

# sql - MS Sql：按 ASC/DESC 的条件排序问题

> ID：758655
> 
> 赞同：26
> 
> 时间：2009-04-17T01:09:00.000
> 
> 标签：sql, sql-server, sql-order-by

我想让我的查询中的排序有条件，所以如果它满足条件，它应该按降序排序

例如：

```
SELECT * FROM Data ORDER BY SortOrder CASE WHEN @Direction = 1 THEN DESC END 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-04-17T01:16:01.073

不要更改`ASC`or `DESC`，更改正在排序的事物的符号：

```
SELECT * FROM table 
ORDER BY 
CASE WHEN @Direction = 1 THEN -id else id END asc; 
```

OP问：

> 伙计们，我不是SQL专家，请解释一下id和-id是什么意思，它控制排序方向吗？

id 就是您要排序的任何列；-id 只是对它的否定，id * -1。如果您按多列排序，则需要否定每一列：

```
SELECT * FROM table 
ORDER BY 
CASE WHEN @Direction = 1 THEN -id else id END 
CASE WHEN @Direction = 1 THEN -othercolumn else othercolumn END ; 
```

如果您按非数字列排序，则需要找到使该列“负数”的表达式；编写一个函数来做到这一点可能会有所帮助。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-09-28T21:10:39.910

```
SELECT * 
FROM Data 
ORDER BY 
Case WHEN @Direction = 1 THEN SortOrder END DESC, 
Case WHEN 1=1 THEN SortOrder END 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-11-14T21:14:11.050

您还可以使用支持所有列类型的方案：

`SELECT <column_list> FROM <table> ORDER BY CASE WHEN @sort_order = 'ASC' AND @sort_column = '<column>' THEN <column> END ASC, CASE WHEN @sort_order = 'DESC' AND @sort_column = '<column>' THEN <column> END DESC`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T01:14:19.550

我做过这样的事情

```
select productId, InventoryCount, 
    case 
    when @Direction = 1 then InventoryCount 
    else -InventoryCount 
    end as "SortOrder"
order by 3 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-11-25T15:00:08.590

无论数据类型如何，都以 ASC 或 DESC 顺序进行动态排序。

第一个示例按字母顺序排序，第二个示例使用数字。@direction 变量表示排序方向（0 = ASC 或 1 = DESC），[column] 是排序列。

这也适用于多列排序，如果放置在进一步的外部查询中，您可以隐藏 [row] 列。

```
DECLARE @direction BIT = 1 -- 0 = ASC or 1 = DESC

-- Text sort. 

SELECT 
    IIF(@direction = 0, ROW_NUMBER() OVER (ORDER BY [column] ASC), ROW_NUMBER() OVER (ORDER BY [column] DESC)) [row]
    , *
FROM
(   -- your dataset.
    SELECT N'B' [column] 
    UNION SELECT N'C' 
    UNION SELECT N'A'
) [data] ORDER BY [row] 

-- Numeric sort.

SELECT 
IIF(@direction = 0, ROW_NUMBER() OVER (ORDER BY [column] ASC), ROW_NUMBER() OVER (ORDER BY [column] DESC)) [row],
*
FROM
(   -- your dataset.
    SELECT 2 [column] 
    UNION SELECT 3 
    UNION SELECT 1
) [data] ORDER BY [row] 
```

# java - 我可以将 code_swarm 配置为仅创建无视觉显示的 png 文件吗？

> ID：758656
> 
> 赞同：2
> 
> 时间：2009-04-17T01:10:58.683
> 
> 标签：java, code-visualization, code-swarm

有没有办法将 code_swarm 配置为仅创建 .png 文件。我认为如果它在创建图像时不尝试显示它会加快处理速度。

我查看了常见问题解答，但没有特别注意到任何相关内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T06:21:34.380

你是对的，它可能会加快速度，尽管我怀疑不会像你希望的那样快。在官方问题跟踪器中有一个未解决的问题：[http ://code.google.com/p/codeswarm/issues/detail?id=37](http://code.google.com/p/codeswarm/issues/detail?id=37)

总结一下：上次我检查时，我们用于绘图的库 Processing.org 不支持在无头模式下运行。有几个人已经考虑过这样做，但运气不佳。如果你唯一关心的是性能，我不会担心这个。如果它运行得太慢，我可以建议我自己的项目分叉，它非常快（是的，我确实打算在某个时候将它集成回主 svn 存储库）：http: [//github.com/rictic/code_swarm/](http://github.com/rictic/code_swarm/)

# asp.net - 中继器中的 UpdatePanel 会覆盖它下面的控件

> ID：758666
> 
> 赞同：0
> 
> 时间：2009-04-17T01:20:47.927
> 
> 标签：asp.net, asp.net-ajax, updatepanel

我有一个Repeater，里面有一个ASP.NET AJAX 1.0 UpdatePanel。UpdatePanel 之外有按钮，但仍在转发器中。当 UpdatePanel 中的一个部分出现时（它是一个隐藏的 Panel 控件，当用户以某种方式回答问题时出现），底部的按钮消失。

这是一个插图。

```
[REPEATER]
  [UPDATEPANEL]
     [QUESTION]   <-- when user says yes, Panel appears
     [PANEL]
  [/UPDATEPANEL]
  [TABLE]         <-- This table is no longer visible.
     [Button]
  [/TABLE]
[/REPEATER] 
```

如果我将表格移动到页面顶部，内容不会消失，所以我怀疑这是一个样式问题，控件实际上在那里，但在 UpdatePanel 的内容下方。我尝试在桌子之前添加一个 <br clear="all"/> ，但无济于事。

知道如何解决这个问题吗？

编辑：我有一个错误的缺少结束标记，导致 UpdatePanel 扩展得比它应该的更远，所以它隐藏了我的控制。使用 Firefox 插件有助于识别这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T02:00:20.047

我的建议是在更新发生后使用 Firefox 和 Web Developer 工具栏来查看生成的源代码，或者使用 Firebug 检查元素。如果表格 html 仍在页面上，则可能是样式问题或面板中 HTML 格式错误的问题，导致表格无法正确呈现。如果表格 html 丢失，则 AJAX 回调将从 DOM 中删除（或覆盖）它。您也可以使用 Firebug 来调试实际的 AJAX 回调，以查看实际替换的内容和时间。

如果您仍然无法弄清楚并想要更多输入，那么在您的问题更新之前和之后发布生成的 HTML 也会很有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T04:22:00.080

将表格放在更新面板中，或将整个中继器放在一个更新面板中。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-17T09:30:44.053

请注意，从[HTML 4.01 开始，Clear 属性已弃用](http://www.w3.org/TR/html401/present/graphics.html#adef-clear)，并且[不包含在 XHTML Strict](http://www.w3.org/TR/2002/REC-xhtml1-20020801/dtds.html#dtdentry_xhtml1-strict.dtd_br)中 - 您使用的是什么文档类型 - 如果您使用的是严格的（并且您显然在使用某种 XHTML，因为您已经关闭你的 br)，那么你的浏览器完全有权忽略 clear 属性。

你最好用 CSS 来做这个：

```
<style type="text/css">
  .cleaner{
    clear: both;
  }
</style>

<br class="cleaner" /> 
```

此外，您可以尝试将 br 放在面板之后，以便它返回到 UpdatePanel 并强制浏览器接受它。

# javascript - 在 Joomla 中添加特定于页面的 javascript 或 CSS

> ID：758667
> 
> 赞同：2
> 
> 时间：2009-04-17T01:21:15.303
> 
> 标签：javascript, css, joomla

如何仅在 Joomla 的某篇文章中包含 javascript 或 CSS 文件？

我有一篇需要 jQuery UI 和相关主题的文章。由于没有在任何其他页面上使用它，我只希望它用于这篇特定的文章。在文章的 HTML 中添加必要的`<script>`和`<link rel="stylesheet">`标签不起作用，因为它们在保存时会被删除。

如果有一种方法可以包含某些文件，或者停止剥离这些标签，那就太好了。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-17T02:48:53.847

我最终为我维护的网站创建了一个插件来执行此操作；我可能会发布它的代码，但解释起来很简单。您构建了一个内容插件，用于搜索诸如 之类的标签`{css path/to/a/css/file.css}`，将它们剥离，然后将文件添加到 HTML`<head>`中。获得要包含的 CSS 或 JS 文件的名称后，您可以使用以下代码在标头中获取它：

```
$document =& JFactory::getDocument();
$document->addStyleSheet(JURI::base() . 'path/to/style.css');
$document->addScript(JURI::base() . 'path/to/script.js'); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-03-13T22:32:07.510

对于这项工作，请使用 Joomla 插件“Sourcerer”。你可以用它把 PHP 和 Javascript 放在文章中，还有时间烤馅饼！我刚刚将代码添加到文章中，它就像一个魅力。当心会删除部分代码的邪恶编辑器。Html 实体是你的朋友——你可以使用它们。示例代码：

```
{source}<?php
$doc =& JFactory::getDocument();
$doc->addStyleSheet( JURI::root( true ).'/example.css' );
$doc->addCustomTag( '<script src="/example.js" type="text/javascript"></script>' );
$doc->addScript( JURI::root( true ).'/example.js' );
?>{/source} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-10T12:12:05.900

将您的编辑器设置为，并`Editor - None`使用任何您想要的。`<script>``<style>`

不要忘记以后应该避免使用 TinyMCE 或其他编辑器编辑该文章。

# sql - 从现有的 MS Access 表自动生成 SQL

> ID：758669
> 
> 赞同：27
> 
> 时间：2009-04-17T01:23:31.947
> 
> 标签：sql, ms-access, schema

我刚刚通过在 MS Access 中玩耍设计了一个大型数据库。现在我对设计感到满意，我需要能够从代码生成相同的数据库（表、关系等）。

与其手写 SQL CREATE 语句（这将是一个冗长、乏味且容易出错的过程），我想知道是否有捷径。我似乎从我对 MySql 的有限接触中回忆起我能够将整个数据库导出为 SQL 语句，然后可以运行该语句以重新生成该数据库。

您是否知道通过 GUI 或以编程方式在 MS Access 中执行此操作的方法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2013-08-01T18:02:04.680

我刚刚找到并试用了这个工具：[jet-tool](https://github.com/himselfv/jet-tool)。它似乎适用于 Access 2010。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-17T01:43:25.017

免费使用 30 天（然后是 30 美元），您可以[试一试 DBWScript](http://dbweigher.com/dbwscript.php)，看起来就像您要求的那样，尽管不是在本机 Access GUI 中或以编程方式

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-17T01:28:18.173

快速、肮脏、简单、完全合法的方法就是复制 .mdb 文件。如果需要，请清空数据 - 但是，通常有一些静态表可以方便地填充。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-17T02:18:39.817

我不知道你的开发机器上有什么工具，所以这可能有用，也可能没有帮助。

您可以使用[升迁向导](http://support.microsoft.com/default.aspx/kb/237980)轻松地将 Access 数据库传输到 Microsoft SQL Server 。

SQL Server 的快速版可免费获得 >[此处](http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=7522a683-4cb2-454e-b908-e805e9bd4e28)。

您还想获得免费的[Management Studio Express](http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=08e52ac2-1d62-45f6-9a4a-4b76a8564a2b)。

使用这些免费的基于图形的工具，您可以轻松生成 SQL 语句以重新创建数据库。您将拥有您正在寻找的 Create 语句，它们将被放置在一个文本文件中。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-02-22T08:59:10.410

我使用名为 MDB Viewer Plus ( [http://www.alexnolan.net/software/mdb_viewer_plus.htm](http://www.alexnolan.net/software/mdb_viewer_plus.htm) ) 的免费实用程序。启动它，打开你的数据库，然后选择你的表。在顶部菜单上，选择“表 > 生成 SQL - 创建”。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-02-26T05:11:36.527

Bullzip 对此非常擅长。非常简单。例如，参见[Bullzip 访问 MySQL](http://www.bullzip.com/products/a2m/info.php)

可以将任何表导出到 SQL 或自动迁移。

> Access to MySQL 是一个将 Microsoft Access 数据库转换为 MySQL 的小程序。
> 
> *   向导界面。
> *   将数据直接从一台服务器传输到另一台服务器。
> *   创建转储文件。
> *   选择要转移的表。
> *   选择要转移的字段。
> *   传输受密码保护的数据库。
> *   支持共享安全和用户级安全。
> *   可选的索引传输。
> *   可选的记录传输。
> *   字段定义中默认值的可选传输。
> *   识别和传输自动编号字段类型。
> *   命令行界面。
> *   易于安装、卸载和升级。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-17T02:09:31.180

您在 MySQL 中提到的事情是 sql 转储。非常有用的功能。如果你想将数据库迁移到 mysql，这里有一篇很有帮助的文章。

[http://www.kitebird.com/articles/access-migrate.html#TOC_4](http://www.kitebird.com/articles/access-migrate.html#TOC_4)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-02-24T13:35:39.200

多年来，我一直在使用 https://fishcodelib.com/Database.htm[中名为](https://fishcodelib.com/Database.htm)**database.net**的工具RDBMS，包括 Access。 连接到您的 mdb/accdb，右键单击任何表，选择 SCRIPT AS，创建，然后您就完成了。 如果您右键单击表格标题，您可以选择多个表格来生成，但我认为这是付费版本的一个功能。 我与他们不熟，只是一个快乐的客户。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-08-25T15:46:01.683

我找到了一个简单的方法：

[导出-> ODBC 数据库](https://i.stack.imgur.com/VbtA1.png)

然后在那里检索 SQL 表单（例如通过 postgres 上的 pgadmin）

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-21T02:01:20.323

Compare'Em [http://home.gci.net/~mike-noel/CompareEM-LITE/CompareEM.htm](http://home.gci.net/~mike-noel/CompareEM-LITE/CompareEM.htm) 免费版创建 VBA，而 10 美元的专业版为您提供 DDL 语句。

# c++ - 用于多级指针取消引用？

> ID：758673
> 
> 赞同：45
> 
> 时间：2009-04-17T01:25:27.230
> 
> 标签：c++, pointers

什么时候在任何语言中使用指针都需要使用多个指针，比如说三重指针。何时使用三重指针而不是仅使用常规指针有意义？

例如：

```
char  * * *ptr; 
```

代替

```
char *ptr; 
```

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-04-17T02:00:06.133

每颗星都应该读作“指针指向的”，所以

```
char *foo; 
```

是“指针 foo 指向的字符”。然而

```
char *** foo; 
```

是“由指向指针的指针指向的指针指向的指针指向指针foo的字符”。因此 foo 是一个指针。在那个地址是第二个指针。在那个指向的地址是第三个指针。取消引用第三个指针会产生一个字符。如果这就是它的全部内容，那么很难为此做很多事情。

不过，它仍然可以完成一些有用的工作。想象一下，我们正在编写 bash 或其他一些过程控制程序的替代品。我们希望以面向对象的方式管理我们的进程调用......

```
struct invocation {
    char* command; // command to invoke the subprocess
    char* path; // path to executable
    char** env; // environment variables passed to the subprocess
    ...
} 
```

但是我们想做一些花哨的事情。我们希望有一种方法可以浏览每个子进程看到的所有不同的环境变量集。为此，我们将调用实例中的每组`env`成员收集到一个数组`env_list`中，并将其传递给处理它的函数：

```
void browse_env(size_t envc, char*** env_list); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-12-26T21:16:50.987

如果你在 C 中使用“对象”，你可能有这个：

```
struct customer {
    char *name;
    char *address;
    int id;
} typedef Customer; 
```

如果你想创建一个对象，你会做这样的事情：

```
Customer *customer = malloc(sizeof Customer);
// Initialise state. 
```

我们在`struct`这里使用指向 a 的指针，因为`struct`参数是按值传递的，我们需要使用*一个*对象。（另外：Objective-C，一种面向对象的 C 包装语言，在内部使用但可见的指向`struct`s 的指针。）

如果我需要存储多个对象，我使用一个数组：

```
Customer **customers = malloc(sizeof(Customer *) * 10);
int customerCount = 0; 
```

由于 C 中的数组变量*指向*第一项，所以我再次使用指针……。现在我有双指针。

但是现在想象一下我有一个过滤数组并返回一个新数组的函数。但是想象一下它不能通过返回机制，因为它必须返回一个错误代码——我的函数访问一个数据库。我需要通过引用参数来做到这一点。这是我函数的签名：

```
int filterRegisteredCustomers(Customer **unfilteredCustomers, Customer ***filteredCustomers, int unfilteredCount, int *filteredCount); 
```

该函数接受一个客户数组并返回对一个客户数组的引用（它们是指向 a 的指针`struct`）。它还获取客户数量并返回过滤后的客户数量（同样，通过引用参数）。

我可以这样称呼它：

```
Customer **result, int n = 0;
int errorCode = filterRegisteredCustomers(customers, &result, customerCount, &n); 
```

我可以继续想象更多的情况……这个没有`typedef`：

```
int fetchCustomerMatrix(struct customer ****outMatrix, int *rows, int *columns); 
```

显然，我会是一个可怕的和/或虐待狂的开发者，如果这样离开它。所以，使用：

```
typedef Customer *CustomerArray;
typedef CustomerArray *CustomerMatrix; 
```

我可以这样做：

```
int fetchCustomerMatrix(CustomerMatrix *outMatrix, int *rows, int *columns); 
```

如果您的应用在酒店中使用，每层都使用矩阵，则您可能需要一个矩阵数组：

```
int fetchHotel(struct customer *****hotel, int *rows, int *columns, int *levels); 
```

或者只是这样：

```
typedef CustomerMatrix *Hotel;
int fetchHotel(Hotel *hotel, int *rows, int *columns, int *levels); 
```

甚至不要让我开始一系列酒店：

```
int fetchHotels(struct customer ******hotels, int *rows, int *columns, int *levels, int *hotels); 
```

…排列成一个矩阵（某种大型酒店公司？）：

```
int fetchHotelMatrix(struct customer *******hotelMatrix, int *rows, int *columns, int *levels, int *hotelRows, int *hotelColumns); 
```

我想说的是，您可以想象多个间接的疯狂应用程序。只要确保你使用`typedef`多指针是一个好主意并且你决定使用它们。

（这篇文章算作七星开发者的申请[吗](http://c2.com/cgi/wiki?ThreeStarProgrammer)？）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-17T01:36:49.277

指针只是一个保存内存地址的变量。

因此，当您想保存指针变量的地址时，您可以使用指向指针的指针。

如果你想返回一个指针，并且你已经在使用返回变量，你将传入一个指针的地址。然后该函数取消引用这个指针，以便它可以设置指针值。即该函数的参数将是指向指针的指针。

多级间接也用于多维数组。如果要返回二维数组，可以使用三重指针。将它们用于多维数组时，请注意在每个间接级别进行时正确转换。

以下是通过参数返回指针值的示例：

```
//Not a very useful example, but shows what I mean...
bool getOffsetBy3Pointer(const char *pInput, char **pOutput)
{
  *pOutput = pInput + 3;
  return true;
} 
```

你这样调用这个函数：

```
const char *p = "hi you";
char *pYou;
bool bSuccess = getOffsetBy3Pointer(p, &pYou);
assert(!stricmp(pYou, "you")); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-02-16T23:32:19.770

ImageMagicks 的 Wand 有一个函数，声明为

```
WandExport char* * * * * * DrawGetVectorGraphics    (  const DrawingWand  *) 
```

[我不是在编造这个](http://imagemagick.spd.co.il/www/api/MagickWand/drawing-wand_8h.html#85b1ab97c892eda1fc1d493148354ab2)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-17T01:27:19.720

N 维动态分配数组，其中 N > 3，在 C 中需要三个或更多级别的间接寻址。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-17T01:33:04.620

双指针的标准用法，例如：myStruct** ptrptr，是作为指向指针的指针。例如，作为函数参数，这允许您更改调用者指向的实际结构，而不仅仅是能够更改该结构中的值。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-10-22T21:31:18.243

Char *** foo 可以解释为指向二维字符串数组的指针。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-17T03:52:26.860

您在必要时使用额外的间接级别 - 或指向 - 不是因为它会很有趣。你很少看到三指针；我认为我从未见过四倍指针（如果我看到了，我的头脑会变得难以置信）。

状态表可以由适当数据类型的二维数组表示（例如，指向结构的指针）。当我编写一些几乎通用的代码来处理状态表时，我记得有一个函数采用三重指针 - 它表示指向结构的指针的二维数组。哎哟!

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-17T01:31:27.043

```
 int main( int argc, char** argv ); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-17T02:04:38.447

封装资源创建的函数通常使用双指针。也就是说，您传入指向资源的指针的地址。然后该函数可以创建有问题的资源，并将指针设置为指向它。这只有在它具有相关指针的地址时才有可能，因此它必须是双指针。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-17T01:35:32.727

如果必须修改函数内部的指针，则必须传递对它的引用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-17T02:00:02.810

每当指针实际指向指针时，使用指向指针的指针是有意义的（此链是无限的，因此“三重指针”等是可能的）。

创建此类代码的原因是因为您希望编译器/解释器能够正确检查您正在使用的类型（防止神秘错误）。

您不必使用此类类型 - 只要您需要实际取消引用指针并访问指针指向的数据，您总是可以简单地使用简单的“void *”和类型转换。但这通常是不好的做法并且容易出错 - 当然在某些情况下使用 void * 实际上是好的并且使代码更加优雅。把它想象成你最后的手段。

=> 它主要用于帮助编译器确保以应有的方式使用事物。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-17T02:09:40.150

老实说，我很少见过三分球。

我浏览了谷歌代码搜索，有[一些](http://www.google.com/codesearch/p?hl=en#e_ObwTAVPyo/security/nss/lib/ckfw/capi/ckcapi.h&q=%5C*%5C*%5C*%20lang:c&l=301) [例子](http://www.google.com/codesearch/p?hl=en#eVvq2YWVpsY/openssl-0.9.8e/crypto/ec/ec_mult.c&q=%5C*%5C*%5C*%20lang:c&l=344)，但不是很有启发性。（见最后的链接 - 所以不喜欢他们）

正如其他人所提到的，您会不时看到双指针。普通的单指针很有用，因为它们指向一些分配的资源。双指针很有用，因为您可以将它们传递给函数并让函数为您填充“普通”指针。

听起来您可能需要一些关于指针是什么以及它们如何工作的解释？如果您还没有，您需要先了解这一点。

但这是一个[单独的](https://stackoverflow.com/questions/92001/what-is-the-real-difference-between-pointers-and-references) [问题](https://stackoverflow.com/questions/9410/how-do-you-pass-a-function-as-a-parameter-in-c)（：

[http://www.google.com/codesearch/p?hl=en#e_ObwTAVPyo/security/nss/lib/ckfw/capi/ckcapi.h&q=***%20lang:c&l=301](http://www.google.com/codesearch/p?hl=en#e_ObwTAVPyo/security/nss/lib/ckfw/capi/ckcapi.h&q=***%20lang:c&l=301)

[http://www.google.com/codesearch/p?hl=en#eVvq2YWVpsY/openssl-0.9.8e/crypto/ec/ec_mult.c&q=***%20lang:c&l=344](http://www.google.com/codesearch/p?hl=en#eVvq2YWVpsY/openssl-0.9.8e/crypto/ec/ec_mult.c&q=***%20lang:c&l=344)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-17T04:38:42.117

指向指针的指针在 C++ 中很少使用。它们主要有两种用途。

第一个用途是传递一个数组。`char**`，例如，是指向 char 的指针，通常用于传递字符串数组。指向数组的指针不起作用是有充分理由的，但这是一个不同的主题（如果您想了解更多信息，请参阅[comp.lang.c 常见问题解答）。](http://c-faq.com/aryptr/index.html)在极少数情况下，您可能会看到第三个`*`用于数组数组，但将所有内容存储在一个连续数组中并手动索引它通常更有效（例如`array[x+y*width]`，而不是`array[x][y]`）。然而，在 C++ 中，由于容器类的存在，这种情况要少得多。

第二种用途是通过引用传递。`int*`参数允许函数修改调用函数指向的整数，通常用于提供多个返回值。这种通过引用传递参数以允许多次返回的模式仍然存在于 C++ 中，但与传递引用的其他用途一样，通常被实际引用的引入所取代。通过引用传递的另一个原因——避免复制复杂的结构——也可以使用 C++ 引用。

C++ 有第三个因素可以减少多指针的使用：它有`string`. 对字符串的引用可能采用`char**`C 中的类型，因此函数可以更改它传递的字符串变量的地址，但在 C++ 中，我们通常会看到`string&`。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-17T06:57:04.437

当您使用嵌套的动态分配（或指针链接）数据结构时。这些东西都是通过指针联系起来的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-07-11T20:29:00.467

特别是在不积极使用基于类型的别名分析的 C 单线程方言中，编写可以容纳可重定位对象的内存管理器有时会很有用。应用程序不是直接向应用程序提供指向内存块的指针，而是接收指向句柄描述符表的指针，每个句柄描述符都包含一个指向实际内存块的指针以及一个指示其大小的字。如果需要为 a 分配空间`struct woozle`，可以说：

```
struct woozle **my_woozle = newHandle(sizeof struct woozle); 
```

然后访问（在 C 语法中有点笨拙——Pascal 中的语法更简洁）： (*my_woozle)->someField=23; 重要的是，应用程序在调用分配内存的函数时不要保留指向任何句柄目标的直接指针，但是如果只存在一个指向由句柄标识的每个块的单个指针，则内存管理器将能够移动事物以防碎片成为一个问题。

该方法在积极追求基于类型的别名的 C 方言中几乎没有效果，因为返回的指针`NewHandle`不识别类型指针，`struct woozle*`而是识别类型指针`void*`，甚至在那些指针类型的平台上将具有相同的表示形式，标准不要求实现将指针转换解释为它应该预期可能发生别名的指示。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-04-23T23:37:15.993

双重间接简化了许多树平衡算法，通常人们希望能够有效地从其父树中“取消链接”子树。例如，AVL 树实现可能使用：

```
void rotateLeft(struct tree **tree) {
    struct tree *t = *tree,
                *r = t->right,
                *rl = r->left;
    *tree = r;
    r->left = t;
    t->right = rl;
} 
```

如果没有“双指针”，我们将不得不做一些更复杂的事情，比如显式跟踪节点的父节点以及它是左分支还是右分支。

# javascript - 如何在 JavaScript 中添加新元素？

> ID：758676
> 
> 赞同：2
> 
> 时间：2009-04-17T01:26:38.367
> 
> 标签：javascript, dom

我创建了一个 JavaScript 脚本，可以将其粘贴到某人的页面上以创建 iFrame。我希望该人能够将脚本粘贴到他们希望 iFrame 出现的位置。

但是，我不知道如何将 DOM 创建的 iFrame 附加到脚本已粘贴的位置。它总是将它附加到身体的最底部。

我如何附加到位？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-17T01:32:13.703

毫米。你*可以*这样做：

```
document.write("<div id='iframecontainer'></div>");
document.getElementById('iframecontainer').innerHTML = '...'; 
```

但这在很多不同的层面上都让人觉得丑陋/错误。不过，我不知道有任何其他选择。

**编辑**：实际上，一个快速的谷歌搜索揭示了[这篇文章](http://www.sitepoint.com/blogs/2007/07/11/insert-in-place-without-documentwrite/)，它讨论了为什么`document.write`丑陋和你所在的特定泡菜的一个不错的选择：给你的`script`标签一个 ID！

```
<script id="iframeinserter" src=".."></script> 
```

然后您可以获得对 script 标签的引用并在其之前插入 iframe：

```
var newcontent = document.createElement('iframe'); 
var scr = document.getElementById('iframeinserter'); 
scr.parentNode.insertBefore(newcontent, scr); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T05:42:36.417

Paulo 的答案也可以在没有 ID 的情况下完成，只需查找最后一个 <script> 元素。这一定是我们所在的脚本块，因为 JavaScript 保证当前脚本块结束标记之后的所有内容都还没有被解析（*）：

```
 var scripts= document.getElementsByTagName('script');
 var script= scripts[scripts.length-1];
 script.parentNode.insertBefore(d, script); 
```

如果您愿意，可以将其放入 onload/ready 函数中，但如果是这样，则必须在包含时计算“var script”而不是在 ready 函数中（执行时，将解析更多 <script>s） .

(*: <script defer> 除外。)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T01:37:00.820

如果用户可以给出 iframe 应该在的元素的 id，那么就可以使用 css 将 iframe 移动到它应该在页面上的位置。

# javascript - 在 JavaScript 中休眠 - 动作之间的延迟

> ID：758688
> 
> 赞同：151
> 
> 时间：2009-04-17T01:34:57.707
> 
> 标签：javascript, sleep

有没有一种方法可以在 JavaScript 执行另一个操作之前让它进入睡眠状态？

例子：

```
 var a = 1+3;
 // Sleep 3 seconds before the next action here
 var b = a + 4; 
```

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2009-04-17T01:37:36.717

你可以使用`setTimeout`来达到类似的效果：

```
var a = 1 + 3;
var b;
setTimeout(function() {
    b = a + 4;
}, (3 * 1000)); 
```

这并不是真正的“睡眠”JavaScript——它只是`setTimeout`在一定的持续时间（以毫秒为单位）后执行传递给的函数。尽管可以为 JavaScript 编写睡眠函数，但最好尽可能使用`setTimeout`它，因为它不会在睡眠期间冻结所有内容。

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2015-01-09T22:20:50.737

如果你真的需要一个`sleep()`只是为了测试一些东西。但是请注意，它在调试时大多数时候都会使浏览器崩溃——这可能就是你需要它的原因。在生产模式下，我将注释掉这个函数。

```
function pauseBrowser(millis) {
    var date = Date.now();
    var curDate = null;
    do {
        curDate = Date.now();
    } while (curDate-date < millis);
} 
```

不要`new Date()`在循环中使用，除非您想浪费内存、处理能力、电池以及可能的设备寿命。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2016-06-28T19:22:57.500

ECMAScript 6 版本，使用带有 yield 的生成器进行“代码阻塞”：

因为最初的问题是七年前发布的，所以我没有费心回答确切的代码，因为它太简单了而且已经回答了。这应该有助于解决更复杂的问题，例如如果您需要至少两次睡眠，或者您计划对异步执行进行排序。随意修改它以满足您的需求。

```
let sleeptime = 100
function* clock()
{
    let i = 0
    while( i <= 10000 )
    {
        i++
        console.log(i); // actually, just do stuff you wanna do.
        setTimeout(
            ()=>
            {
                clk.next()
            }
            , sleeptime
        )
        yield
    }
}

let clk = clock()
clk.next()
```

[功能*](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*)

[() => 箭头函数](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions)

您还可以通过[Promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise "承诺")链接事件：

```
function sleep(ms)
{
    return(
        new Promise(function(resolve, reject)
        {
            setTimeout(function() { resolve(); }, ms);
        })
    );
}

sleep(1000).then(function()
{
    console.log('1')
    sleep(1000).then(function()
    {
        console.log('2')
    })
})
```

或者更简单、更不花哨的方式是

```
function sleep(ms, f)
{
    return(
        setTimeout(f, ms)
    )
}

sleep(500, function()
{
    console.log('1')
    sleep(500, function()
    {
        console.log('2')
    })
})
console.log('Event chain launched')
```

如果您只是在等待某种情况发生，您可以像这样等待

```
function waitTill(condition, thenDo)
{
    if (eval(condition))
    {
        thenDo()
        return
    }

    setTimeout(
        ()    =>
        {
            waitTill(condition, thenDo)
        }
        ,
        1
    )
}

x=0

waitTill(
    'x>2 || x==1'
    ,
    ()    =>
    {
        console.log("Conditions met!")
    }
)

// Simulating the change
setTimeout(
    () =>
    {
        x = 1
    }
    ,
    1000
)
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2017-01-11T18:04:33.943

## 2018 更新

最新的 Safari、Firefox 和 Node.js 现在也支持 async/await/promises。

## 使用异步/等待/承诺：

（截至 1/2017，在 Chrome 上受支持，但在 Safari、Internet Explorer、Firefox、Node.js 上不受支持）

```
'use strict';

function sleep(ms) {
  return new Promise(res => setTimeout(res, ms));
}

let myAsyncFunc = async function() {
  console.log('Sleeping');
  await sleep(3000);
  console.log('Done');
}

myAsyncFunc();
```

## 2017 更新

自从提出这个问题以来，JavaScript 已经发展，现在有了生成器函数，并且正在推出新的 async/await/Promise。~~下面有两种解决方案，一种具有适用于所有现代浏览器的生成器功能，另一种使用尚未在所有地方都支持的新 async/await。~~

## 使用生成器函数：

```
'use strict';

let myAsync = (g) => (...args) => {
    let f, res = () => f.next(),
        sleep = (ms) => setTimeout(res, ms);
    f = g.apply({sleep}, args); f.next();
};

let myAsyncFunc = myAsync(function*() {
    let {sleep} = this;
    console.log("Sleeping");
    yield sleep(3000);
    console.log("Done");
});

myAsyncFunc();
```

请注意，这两种解决方案本质上都是异步的。这意味着 myAsyncFunc（在这两种情况下）将在睡眠时返回。

需要注意的是，这个问题与*[什么是 JavaScript 版本的 sleep() 不同？](https://stackoverflow.com/questions/951021/what-is-the-javascript-version-of-sleep)*请求者要求真正的睡眠（进程上没有其他代码执行）而不是动作之间的延迟。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-08-30T07:27:52.510

另一种方法是使用 Promise 和 setTimeout（请注意，您需要在函数内部并使用 async 关键字将其设置为异步）：

```
async yourAsynchronousFunction () {

    var a = 1+3;

    await new Promise( (resolve) => {
        setTimeout( () => { resolve(); }, 3000);
    }

    var b = a + 4;

} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-08-05T18:28:03.487

这是一种非常简单的方法，它“感觉”像同步睡眠/暂停，但却是合法的 js 异步代码。

```
// Create a simple pause function
const pause = (timeoutMsec) => new Promise(resolve => setTimeout(resolve,timeoutMsec))

async function main () {
    console.log('starting');
    // Call with await to pause.  Note that the main function is declared asyc
    await pause(3*1000)
    console.log('done');
}
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-07-16T03:43:51.083

如果你想要比`setTimeout`and更少笨重的函数`setInterval`，你可以将它们包装在函数中，这些函数只是颠倒参数的顺序并给它们起好听的名字：

```
function after(ms, fn){ setTimeout(fn, ms); }
function every(ms, fn){ setInterval(fn, ms); } 
```

CoffeeScript 版本：

```
after = (ms, fn)-> setTimeout fn, ms
every = (ms, fn)-> setInterval fn, ms 
```

然后，您可以将它们与匿名函数很好地结合使用：

```
after(1000, function(){
    console.log("it's been a second");
    after(1000, function(){
        console.log("it's been another second");
    });
}); 
```

现在它很容易读为“N 毫秒后，...”（或“每 N 毫秒，...”）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-04-03T16:57:06.333

您可以使用纯 javascript，这将在 5 秒后调用您的函数/方法：

```
setTimeout(()=> { your_function(); }, 5000); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-03-16T04:15:22.297

您可以使用`setTimeout`在指定时间后调用回调：

```
setTimeout(() => {
    console.log('Called after 1 second');
}, 1000); 
```

如果你想`setTimeout`用作一个承诺，你可以这样做：

```
const delay = milliseconds => new Promise(resolve => { setTimeout(resolve, milliseconds); });

await delay(1000);

console.log('Called after 1 second'); 
```

从 Node.js 16 开始，这个功能也是[内置的](https://nodejs.org/docs/latest-v16.x/api/timers.html#timers_timerspromises_settimeout_delay_value_options)：

```
import {setTimeout as delay} from 'node:timers/promises';

await delay(1000);

console.log('Called after 1 second'); 
```

如果您想在 Node.js 或**主线程之外的**浏览器中实现同步延迟，[您可以使用`Atomics.wait`](https://github.com/sindresorhus/sleep-synchronously/blob/20a8c837d7cb151868da7943485df805eec94d18/index.js)：

```
const delay = milliseconds => Atomics.wait(new Int32Array(new SharedArrayBuffer(4)), 0, 0, milliseconds);

await delay(1000);

console.log('Called after 1 second'); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-12-15T23:27:51.107

这是使用调用 setTimeout() 的基于 Promise 的 sleep() 的重写和演示。它还演示了对 setTimeout() 的常规调用。

```
function sleep(ms) {
    return new Promise(resolve => setTimeout(() => resolve(), ms))
}

console.log("Synchronous call");
sleep(2000)
.then(() => console.log("Asynchronous call")); 
```

[它在 Repl.it 上运行的图像](https://i.stack.imgur.com/u9g1h.jpg)

```
function sleep(ms) {
    return new Promise(resolve => setTimeout(() => resolve(), ms))
}
console.log("Synchronous call 1");

sleep(4000)
 .then(() => console.log("Asynchronous call 1"));

sleep(2000)
 .then(() => console.log("Asynchronous call 2"));

console.log("Synchronous call 2");

sleep(3000)
 .then(() => console.log("Asynchronous call 3"));

console.log("Synchronous call 3");

sleep(5000)
 .then(() => console.log("Asynchronous call 4"))
 .then(
   sleep(7000)
    .then(()=>console.log("Asynchronous call 5"))
)

console.log("Synchronous call 4");

setTimeout(() => {console.log("Asynchronous call 6")}, 8000);
console.log("Synchronous call 5");
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-12-19T04:06:07.577

```
function delayer(ms){
  return new Promise((resolve, reject)=>{
    setTimeout(()=>{
      resolve();
    }, ms)
  })
}

async function myFunction(){  // Function Must be async.
  console.log("First Console")
  await delayer(2000);    // This Will Stop The Code For 2 Seconds
  console.log("Second Console")
}

myFunction()
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-09-23T07:02:32.667

为了什么值得

```
 isPause = true;
  setTimeout(()=>{isPause=false},2000);
  while (!isPause) {
    // delay for 2 seconds
  } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-07-31T17:10:59.697

有几种方法可以解决这个问题。如果我们使用该`setTimeout`功能，让我们先了解它。 [这个函数](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout)有三个参数：*`function`*or *`code`*, *`delay`*（以毫秒为单位）和*`parameters`*. 由于*函数*或*代码*参数是必需的，其他都是可选的。一旦您没有输入*延迟*，它将被设置为零。

有关`setTimeout()` [转到此链接](https://www.w3.org/TR/2011/WD-html5-20110525/timers.html#dom-windowtimers-settimeout)的更多详细信息。

简化版：

```
var a = 1 + 3;
var b;
console.log('a = ' + a);
setTimeout(function(){ 
    b = a + 4; 
    console.log('b = ' + b);
}, 1000); 
```

> 输出：
> a = 4
> 24 --> 活动超时列表的编号标识符
> b = 8

使用参数传递：

```
var a = 1 + 3;
var b;
console.log('a = ' + a);
setTimeout(myFunction, 1000, a);

function myFunction(a)
{
    var b = a + 4;
    console.log('b = ' + b);
} 
```

> 输出：
> a = 4
> 25 --> 活动超时列表的编号标识符
> b = 8

浏览器支持：

```
Chrome 火狐边缘 Safari Opera
1.0 1.0 4.0 1.0 4.0

```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-06-10T00:50:02.340

这是我的模型，展示了如何使用生成器函数（ES6）在 javascript 中“休眠”或“DoEvents”。注释代码：

```
<html>
<head>
<script>
  "use strict"; // always
  // Based on post by www-0av-Com https://stackoverflow.com/questions/3143928
  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*
  var divelt, time0, globaln = 0; // global variables
  var MainGenObj = Main(); // generator object = generator function()
window.onload = function() {
  divelt = document.getElementsByTagName("body")[0]; // for addline()
  addline("typeof Main: " + typeof Main);
  addline("typeof MainDriver: " + typeof MainDriver);
  addline("typeof MainGenObj: " + typeof MainGenObj);
  time0 = new Date().valueOf(); // starting time ms
  MainDriver(); // do all parts of Main()
}
function* Main() { // this is "Main" -- generator function -- code goes here
  // could be loops, or inline, like this:

  addline("Part A, time: " + time() + ", " + ++globaln); // part A
  yield 2000;                    // yield for 2000 ms (like sleep)

  addline("Part B, time: " + time() + ", " +  ++globaln); // part B
  yield 3000;                    // yield for 3000 ms (or like DoEvents)

  addline("Part Z, time: " + time() + ", " +  ++globaln); // part Z (last part)
  addline("End, time: " + time());
}
function MainDriver() { // this does all parts, with delays
  var obj = MainGenObj.next(); // executes the next (or first) part of Main()
  if (obj.done == false) { // if "yield"ed, this will be false
    setTimeout(MainDriver, obj.value); // repeat after delay
  }
}
function time() { // seconds from time0 to 3 decimal places
  var ret = ((new Date().valueOf() - time0)/1000).toString();
  if (ret.indexOf(".") == -1) ret += ".000";
  while (ret.indexOf(".") >= ret.length-3) ret += "0";
  return ret;
}
function addline(what) { // output
  divelt.innerHTML += "<br />\n" + what;
}
</script>
</head>
<body>
<button onclick="alert('I\'m alive!');"> Hit me to see if I'm alive </button>
</body>
</html> 
```

# python - 使用 sphinx/miktex 生成在 windows 中显示 UTF8 Japanese (CJK) 文本的 pdf 文件

> ID：758693
> 
> 赞同：1
> 
> 时间：2009-04-17T01:37:32.067
> 
> 标签：python, windows, pdflatex, python-sphinx, miktex

我有 ReSt (UTF8) 文档，我正在使用[sphinx](http://sphinx.pocoo.org/)生成 HTML 和乳胶文件。（html转换没有问题）

然后我想将生成的乳胶文件转换为 PDf。目前我正在使用[MiKTeX](http://miktex.org/) 2.7 的 pdflatex.exe 命令来执行此转换。（转换没有日文字符的源文件会正确生成预期的 pdf）

使用 MiKTeX 包管理器，我安装了 cjk 相关包：cjk-fonts、miktex-cjkutils-bin-2.7 和 cjk。

要调试，我使用以下示例：

```
\documentclass{article}

\usepackage{CJK}

\begin{document}

\begin{CJK}{UTF8}{song}

\noindent Hello World!

\noindent Καλημέρα κόσμε
\noindent こんにちは 世界

\end{CJK}

\end{document} 
```

在此文件上运行 pdflatex.exe 会产生以下输出：

```
pdflatex jutf8.tex jutf8.pdf
This is pdfTeX, Version 3.1415926-1.40.8-beta-20080627 (MiKTeX 2.7)
entering extended mode
(jutf8.tex
LaTeX2e <2005/12/01>
Babel <v3.8j> and hyphenation patterns for english, dumylang, nohyphenation, ge
rman, ngerman, german-x-2008-06-18, ngerman-x-2008-06-18, french, loaded.

! LaTeX Error: Missing \begin{document}.

See the LaTeX manual or LaTeX Companion for explanation.
Type  H <return>  for immediate help.
 ...

l.2
     ｻｿ\documentclass{article}
?
("C:\Program Files\MiKTeX 2.7\tex\latex\base\article.cls"
Document Class: article 2005/09/16 v1.4f Standard LaTeX document class
("C:\Program Files\MiKTeX 2.7\tex\latex\base\size10.clo")
Overfull \hbox (20.0pt too wide) in paragraph at lines 2--284
[]
[1{D:/Profiles/All Users/Application Data/MiKTeX/2.7/pdftex/config/pdftex.map}]
) ("C:\Program Files\MiKTeX 2.7\tex\latex\cjk\CJK.sty"
("C:\Program Files\MiKTeX 2.7\tex\latex\cjk\mule\MULEenc.sty")
("C:\Program Files\MiKTeX 2.7\tex\latex\cjk\CJK.enc")) (jutf8.aux)
("C:\Program Files\MiKTeX 2.7\tex\latex\cjk\UTF8\UTF8.bdg")
("C:\Program Files\MiKTeX 2.7\tex\latex\cjk\UTF8\UTF8.enc")
("C:\Program Files\MiKTeX 2.7\tex\latex\cjk\UTF8\UTF8.chr")
("C:\Program Files\MiKTeX 2.7\tex\latex\cjk\UTF8\c70song.fd")Running makemf...
makemf: The cyberb source file could not be found.
Running hbf2gf...

hbf2gf (CJK ver. 4.7.0)

Couldn't find `cyberb.cfg'
maketfm: No creation rule for font cyberb03.

! Font C70/song/m/n/10/03=cyberb03 at 10.0pt not loadable: Metric (TFM) file no
t found.
<to be read again>
                   relax
l.12 \noindent ﾎ
                 ﾎｱﾎｻﾎｷﾎｼﾎｭﾏ∃ｱ ﾎｺﾏ狐πｼﾎｵ 
```

如何使用 MiKTeX/pdflatex.exe 在生成的 pdf 中正确显示日语？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-11T22:08:26.073

我会使用 xelatex（自 2.7 起在 MikTeX 中可用）而不是 pdflatex 和 OpenType Kanji 字体。文件 text.tex 由

```
\documentclass{文章}
\使用包{字体规范}
\setmainfont{Sazanami Gothic}

\开始{文档}
こんにちは 世界
\结束{文档}

```

使用“xelatex 文本”编译为 PDF，此文本为 Sazanami Gothic 字体。

# sql - SQL 中的 CHAR 数据类型是否已过时？你什么时候使用它？

> ID：758699
> 
> 赞同：8
> 
> 时间：2009-04-17T01:42:09.000
> 
> 标签：sql, types, char

标题几乎构成了这个问题。我已经好几年没用过 CHAR 了。现在，我正在对一个全是 CHAR 的数据库进行逆向工程，用于主键、代码等。CHAR(30) 列怎么样？

编辑：所以一般的意见似乎是 CHAR 如果对某些事情完全没问题。但是，我认为您可以设计一个不需要“这些特定事物”的数据库模式，因此不需要固定长度的字符串。使用 bit、uniqueidentifier、varchar 和 text 类型，似乎在一个规范化的模式中，您会获得某种优雅，而这是使用编码字符串值时所没有的。从固定角度思考，没有冒犯的意思，似乎是大型机时代的遗物（我自己学过 RPG II）。我相信它已经过时了，而且我没有听到你声称的令人信服的论点。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-17T01:47:19.017

我使用 char(n) 作为代码，使用 varchar(m) 作为描述。Char(n) 似乎会带来更好的性能，因为当内容大小发生变化时，数据不需要移动。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T01:47:02.013

在我熟悉的 DBMS 中，CHAR 的处理速度仍然比 VARCHAR 快。它们的固定大小允许使用 VARCHAR 无法进行优化。此外，CHARS 的存储要求略低，因为无需存储长度，假设大多数行需要完全或几乎完全填充 CHAR 列。

与 CHAR(4) 相比，使用 CHAR(30) 的影响较小（以百分比计）。

至于用法，我倾向于在以下情况下使用 CHAR：

*   字段通常总是接近或达到最大长度（股票代码、员工 ID 等）；或者
*   长度很短（小于 10）。

在其他任何地方，我都使用 VARCHAR。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-17T02:14:15.270

如果数据的性质决定了字段的长度，我使用 CHAR。否则为 VARCHAR。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-17T02:17:38.540

当值的长度固定时，我使用 CHAR。例如，我们正在生成一个代码或基于某种算法的代码，该算法返回具有特定固定长度的代码，比如 13。

否则，我发现 VARCHAR 更好。使用 VARCHAR 的另一个原因是，当您在应用程序中取回该值时，您不需要修剪该值。在 CHAR 的情况下，无论值是否完全填充，您都将获得列的完整长度。它会被空格填充，你最终会修剪每个值，而忘记这会导致错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T14:03:21.387

对于 PostgreSQL，文档指出`char()`在存储空间上没有优势`varchar()`; 唯一的区别是它被空白填充到指定的长度。

话虽如此，我仍然将`char(1)`or`char(3)`用于一字符或三字符代码。我认为，即使没有存储或性能优势，由于指定列应包含内容的类型的清晰度提供了价值。是的，我通常也使用检查约束或外键约束。除了这些情况，我通常只是坚持`text`而不是使用`varchar()`. 同样，这是由数据库实现通知的，如果值足够大，它会自动从内联存储切换到外联存储，而其他一些数据库实现则不这样做。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T13:53:00.473

Char 并没有过时，它只应该在字段的长度不应该改变的情况下使用。在平均数据库中，这将是非常少的字段，主要是某种代码字段，例如州缩写，如果您使用邮政编码，则它是标准的 2 字符字段。在字段长度可变的情况下使用 Char 意味着将进行大量修剪，这是额外的、不必要的工作，并且应该重构数据库。

# groovy - 替换java内部类的最佳常规闭包习语？

> ID：758700
> 
> 赞同：0
> 
> 时间：2009-04-17T01:42:42.477
> 
> 标签：groovy, closures

作为 groovy 的新手...

我正在尝试替换事件侦听器、过滤器等的 java 习惯用法。

我在 groovy 中的工作代码如下：

```
def find() {
    ODB odb = ODBFactory.open(files.nodupes); // data nucleus object database
    Objects<Prospect> src = odb.getObjects(new QProspect());

    src.each { println it };

    odb.close();

}

class QProspect extends SimpleNativeQuery {
    public boolean match(Prospect p) {
        if (p.url) {
            return p.url.endsWith(".biz");
        }
        return false;
    }
} 
```

现在，这与我在 java 中的习惯相去甚远，其中 Query 接口的实现是在 odb.getObjects() 方法中完成的。如果我在哪里编写“java”代码，我可能会执行以下操作，但它不起作用：

```
Objects<Prospect> src = odb.getObjects( {
        boolean match(p) { 
            if (p.url) {
            return p.url.endsWith(".biz");
        }
            return false; 
        }
    } as SimpleNativeQuery); 
```

或者更好，我希望它是这样的：

```
 Objects<Prospect> src = odb.getObjects( 
      { it.url.endsWith(".biz") } as SimpleNativeQuery
 ); 
```

但是，将“匹配”方法与外部脚本上下文相关联并让我失望的是什么groovy。

我发现 groovy... groovy 反正我会坚持学习更多。谢谢。

* * *

我应该问的是我们如何在 groovy 中做“匿名”类。这是java的成语：

```
void defReadAFile() {
    File[] files = new File(".").listFiles(new FileFilter() {
        public boolean accept(File file) {
            return file.getPath().endsWith(".biz");
        }
    });
} 
```

groovy 可以在没有额外的类声明的情况下如此简洁吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T04:01:37.353

我认为如果您将问题抽象化以使其不依赖于 Neodatis DB 接口，它会帮助您获得答案——这让我陷入了一个循环，因为我从未使用过它。我在下面写的关于它的内容是基于一个非常粗略的分析。

就此而言，我也从未使用过 Groovy，尽管我喜欢我所看到的。但是看到其他人还没有回答，你被我困住了:-)

我认为问题（或至少部分问题）可能是您对 Neodatis 的 SimpleNativeQuery 类期望过高。看起来它甚至在将对象添加到返回的集合之前都没有尝试过滤它们。我认为您想使用`org.neodatis.odb.impl.core.query.criteria.CriteriaQuery`. （**注意包路径中的“impl”。**这让我有点紧张，因为我不确定这个类是否是由调用者使用的。但我没有看到 Neodatis 中允许的任何其他类用于指定查询条件。）

但不是直接使用 CriteriaQuery，我认为您宁愿将它包装在 Groovy 类中，以便您可以将它与闭包一起使用。所以，我认为带有闭包的 Groovy 版本的代码可能看起来像这样：

```
// Create a class that wraps CriteriaQuery and allows you 
// to pass closures.  This is wordy too, but at least it's
// reusable.

import org.neodatis.odb.impl.core.query.criteria;

class GroovyCriteriaQuery extends CriteriaQuery {
    private final c;

    QProspect(theClosure) {
         // I prefer to check for null here, instead of in match()
         if (theClosure == null) {
             throw new InvalidArgumentException("theClosure can't be null!");
         }
         c = theClosure;
    }

    public boolean match(AbstractObjectInfo aoi){
        //!! I'm assuming here that 'aoi' can be used as the actual
        //!! object instance (or at least as proxy for it.)
        //!! (You may have to extract the actual object from aoi before calling c.)
        return c(aoi);
    }
}

// Now use the query class in some random code.

 Objects<Prospect> src = odb.getObjects( 
      new GroovyCriteriaQuery(
          { it.url.endsWith(".biz") } 
      )
 ) 
```

我希望这有帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T14:00:11.517

我相信您真正的问题是“在调用不使用闭包的 Java API 时，我可以使用闭包而不是匿名类吗”。答案是肯定的“是”。这：

```
 Objects<Prospect> src = odb.getObjects( 
      { it.url.endsWith(".biz") } as SimpleNativeQuery
 ); 
```

应该管用。您写“但是，将“匹配”方法与外部脚本上下文相关联并让我失望的是什么 groovy 。它究竟是如何失败的？在我看来，您似乎遇到了一个简单的技术问题来获得既是“常规方式”又是您想要工作的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T14:13:13.453

是的，谢谢大家，它的工作原理。

我还发现了为什么 SimpleNativeQuery 不起作用（根据 Dan Breslau）。

我尝试了以下方法，效果很好。所以这个成语确实按预期工作。

```
new File("c:\\temp").listFiles({ it.path.endsWith(".html") } as FileFilter); 
```

由于neodatis界面，下一个不起作用。该接口不*强制*执行 match() 方法！它只在文档中提到它，但它不存在于类文件中：

```
public class SimpleNativeQuery extends AbstactQuery{

}

Objects<Prospect> src = odb.getObjects( 
  { it.url.endsWith(".biz") } as SimpleNativeQuery
); 
```

在上面，由于 SimpleNativeQuery 没有 match() 方法，因此 groovy 编译器无法识别应该将闭包附加到 SimpleNativeQuery 中的哪个方法；然后它默认为外部 groovy 脚本。

这是我使用 groovy 的第三天，我很喜欢它。

两本书都很棒：- Groovy Recipes (Scott Davis) - Programming Groovy (Venkat Subramaniam)

# c++ - Win32 中的 WM_NOTIFY 和超类链接问题

> ID：758714
> 
> 赞同：3
> 
> 时间：2009-04-17T01:51:07.353
> 
> 标签：c++, c, winapi, wndproc

作为参考，我正在使用本文中概述的窗口超类[方法](http://www.ddj.com/184410048)。如果我想处理`WM_NOTIFY`来自超类中的基本控件的消息（即用于自定义绘图），则会出现特定问题，我要么需要将它们从父窗口反映回来，要么将我自己的窗口设置为父窗口（在 CREATESTRUCT 内部传递`WM_(NC)CREATE`给基班级）。如果我有一个超类，则此方法可以正常工作。如果我超类我的超类，那么我会遇到问题。现在 3 个 WindowProcs 在同一个 HWND 中运行，当我反映`WM_NOTIFY`消息（或将它们从上面的父技巧发送给我自己）它们总是转到最外层（最派生的）WindowProc。我无法判断它们是针对内部超类的消息（基本消息应该发送到第一个超类）还是针对外部超类的消息（来自内部超类的消息针对外部超类）。这些消息无法区分，因为它们都来自具有相同控制 ID 的同一个 HWND。有没有办法在不创建新窗口来封装每个继承级别的情况下解决这个问题？

对不起，文字墙。这是一个很难解释的概念。这是一个图表。

单个超类：

```
SuperA::WindowProc() -> Base::WindowProc()---\
             ^--------WM_NOTIFY(基础)--------/
```

超类的超类：

```
SuperB::WindowProc() -> SuperA::WindowProc() -> Base::WindowProc()---\
             ^--------WM_NOTIFY(基础)--------+------------------------/
             ^--------WM_NOTIFY(A)-----------/
```

第二种情况下的`WM_NOTIFY`消息都来自相同的 HWND 和控制 ID，因此我无法区分用于 SuperA（来自 Base）的消息和用于 SuperB（来自 SuperA）的消息。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-05T07:39:20.267

自然，控件（原来的？）正在向 PARENT 发送消息。据推测，您正在拦截这些并将它们发布回原始控件。外层当然会首先看到这些（如果它不想处理它们，可以直接传递它们）。

你还没有说你想要拦截什么样的 NOTIFY 消息或为什么。但是，既然您现在可以在父进程中控制它们以将它们发送回，为什么不直接更改消息。滚动你自己的 NMHDR 结构，嵌入消息和数据，并为超类的级别添加一些标识。在你的超类中，剥离你想要的，重新格式化你不想要的，然后继续发送。

听起来确实有点乱。在那个级别上，我倾向于回到基础并建立自己的共同控制（当然，取决于你实际尝试做的事情）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-30T00:37:47.863

Borland 通过在父级更改消息 ID 在 VCL 中解决了这个问题。当父窗口接收到 WM_NOTIFY 消息时，消息 ID 会增加定义的偏移量（CN_BASE），然后将消息直接传递给消息指定的子窗口。子窗口过程（以及子窗口的任何子类）然后可以查找 (CN_BASE + WM_NOTIFY) 消息并访问原始的 WM_NOTIFY 数据。同样的技术也适用于 WM_COMMAND 消息。尝试在您的代码中做类似的事情。

# regex - 泛数字正则表达式？

> ID：758717
> 
> 赞同：5
> 
> 时间：2009-04-17T01:57:25.373
> 
> 标签：regex

什么是验证字符串是否为泛数字的正则表达式（包含从 1 到 9 的所有数字恰好一次）？

例如：

```
123456789
891364572 
```

但不是：

```
11234556789
25896471 
```

我知道如何在没有正则表达式的情况下做到这一点，但我无法为它形成一个正则表达式。

谢谢。

这不是家庭作业。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-17T02:11:44.123

简短而甜蜜，使用负前瞻：

```
/^(?!.*([1-9]).*\1)[1-9]{9}$/ 
```

*   `[1-9]`是非零数字的字符类 - 相当于`[123456789]`
*   `.*`匹配任何长度的任何字符串。
*   `.*([1-9]).*\1.*`匹配任何包含至少两次出现的相同非零数字的字符串
    *   一个非零数字被匹配并被捕获`([1-9])`
    *   该非零数字的重复由 匹配`\1`，对第一个捕获的匹配项的**反向引用。**
    *   匹配之前的`.*`任意填充，以及在非零数字与其重复之间。
*   `(?!*<pattern>*)`*匹配包含的模式不*匹配的任何位置。这是一个**否定的lookahead**，因为它只匹配字符串中的一个*位置*，并且不消耗任何一个 - 只是向前看以将它与包含的模式进行比较。
*   `[1-9]{9}`匹配九个 nonzeo 数字。
    *   `*<pattern>*{9}`表示匹配前面的模式 9 次。
*   `^*<pattern>*$`匹配与包含的模式完全匹配的任何字符串（而不是包含与模式匹配的子字符串）
    *   `^`匹配字符串开头的位置或行的开头
    *   `$`匹配字符串末尾或行尾的位置

如此结合，我们检查以确保它没有重复任何数字，然后我们检查它是否只是数字。由于它有 9 位数字长，并且没有重复，所以所有数字都必须只显示一次。这就是[鸽巢原理](http://en.wikipedia.org/wiki/Pigeonhole_principle)在起作用！

您的特定正则表达式引擎的语法可能会有所不同。上面是一个[PCRE](http://en.wikipedia.org/wiki/PCRE)（支持 Perl、Ruby 和一堆不同的其他语言）。[Posix 正则表达式](http://en.wikipedia.org/wiki/Regular_expression#POSIX)的语法略有不同。并非所有引擎都支持负前瞻，但大多数引擎都支持反向引用。两者都不是形式理论正则表达式定义的一部分，但非常方便。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T02:00:31.357

正则表达式并不是这里工作的最佳工具，但在这里你去：

```
^(?=[^1]*1[^1]*$)(?=[^2]*2[^2]*$)(?=[^3]*3[^3]*$)(?=[^4]*4[^4]*$)(?=[^5]*5[^5]*$)(?=[^6]*6[^6]*$)(?=[^7]*7[^7]*$)(?=[^8]*8[^8]*$)(?=[^9]*9[^9]*$)[1-9]+$ 
```

`(?= )`是前瞻。它实际上不符合正则表达式的描述，因为它不描述正则语言。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T02:34:16.830

如果这不是家庭作业，那么您不应该使用 RE。下面的 C 代码应该是一个好的开始。

```
#include <stdio.h>
int isPandigital (char *inputStr) {
    /* Initial used states of false. */
    char used[] = {0,0,0,0,0,0,0,0,0,0};

    int count = 0;
    char ch;

    /* Process each character in string. */

    while ((ch = *inputStr++) != '\0') {
        /* Non-numeric, bad. */
        if ((ch < '0') || (ch > '9')) {
            return 0;
        }

        /* Too many, bad. */
        if (++count > 9) {
            return 0;
        }

        /* Multiples, bad. */
        if (used[ch - '0']) {
            return 0;
        }

        /* Store fact that this one's been used. */
        used[ch - '0'] = 1;
    }

    /* Good or bad depending on how many we've had. */
    return (count == 9);
} 
```

```
int main (int argCount, char *argVar[]) {
    int i;
    for (i = 1; i < argCount; i++) {
        if (isPandigital (argVar[i])) {
            printf ("'%s' is pandigital\n", argVar[i]);
        } else {
            printf ("'%s' is NOT pandigital\n", argVar[i]);
        }
    }
    return 0;
} 
```

使用您的测试数据：

```
$ pandigital 123456789 891364572 11234556789 25896471 
```

我们得到以下结果：

```
'123456789' is pandigital
'891364572' is pandigital
'11234556789' is NOT pandigital
'25896471' is NOT pandigital 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T01:59:57.740

这在程序代码中会容易得多，循环遍历每个字符并将它们标记在一个数组中，......或者这是一些家庭作业？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T03:47:05.733

```
 bool chk(string s, int idx, set sofar) {
  return index == s.length ? true : isdigit(s[idx]) && !sofar.count(s[idx]) && chk(s,++idx,sofar.insert(s[idx]));
} 
```

像这样的东西可以工作。没有打扰检查它。

# asp.net - 如何在 ASP.net 2.0 中创建 Silverlight 应用程序

> ID：758728
> 
> 赞同：1
> 
> 时间：2009-04-17T02:08:43.833
> 
> 标签：asp.net, silverlight

我需要使用 Silverlight 控件创建一个 Web 应用程序，如何在 ASP.net 2.0 中使用 VS 2005 创建它。

帮帮我

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-17T02:14:07.020

[开始构建 Silverlight 2 应用程序](http://silverlight.net/GetStarted/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T08:08:49.943

另请参阅之前的 SO 问题：[学习 Silverlight 2 开发的好资源？](https://stackoverflow.com/questions/203466/good-resource-for-learning-silverlight-2-development)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T12:18:07.567

您将无法在 VS 2005 中开发 Silverlight 控件项目。此外，您不能在 Vs2005 或 ASP.NET 2.0 中使用新的 Silverlight webcontrol，因为它依赖于 3.5。

因此，您应该将在其他地方创建的 XAP 和/或 XAML 复制到您的项目中，并将它们简单地视为内容文件（将 XAP 放在“clientbin”文件夹中）。您需要按照说明在 ASPX 中的简单 HTML 文件中使用 silverlight。

我所做的是为 ASP.NET 2.0 创建自己的简单 WebControl 来为 Silverlight 控件生成适当的 HTML。渲染方法看起来像：-

```
protected override void Render(HtmlTextWriter writer)
{
    if (DesignMode)
    {
        //Display something sensible here
    }
    else
    {
        writer.AddAttribute("data", "data:application/x-silverlight-2,");
        writer.AddAttribute("type", "application/x-silverlight-2");
        AddExistingAttributes(writer);

        writer.RenderBeginTag("object");

        writer.AddAttribute("name", "source");
        writer.AddAttribute("value", Page.ResolveUrl(Src), false);
        writer.RenderBeginTag("param");
        writer.RenderEndTag();

        writer.AddAttribute("name", "minRuntimeVersion");
        writer.AddAttribute("value", "2.0.31005.0");
        writer.RenderBeginTag("param");
        writer.RenderEndTag();

        writer.AddAttribute("name", "initParams");
        writer.AddAttribute("value", InitParams);
        writer.RenderBeginTag("param");
        writer.RenderEndTag();

        writer.Write(@"<a href=""http://go.microsoft.com/fwlink/?LinkID=124807"" style=""text-decoration: none;"">
        <img src=""http://go.microsoft.com/fwlink/?LinkId=108181"" style=""border-style: none""/>
    </a>");

        writer.RenderEndTag();
    } 
```

如果您正在为公共站点开发，则需要包含 silverlight.js 并按照控件的正常 HTML 用法连接它，以便它会自动尝试安装 silverlight 并在安装时刷新页面。

# iphone - iPhone OpenGL ES 单视图还是多视图？

> ID：758730
> 
> 赞同：5
> 
> 时间：2009-04-17T02:09:24.113
> 
> 标签：iphone, opengl-es

在为 iphone 编写游戏时，我对最好的方法是什么感到困惑。游戏将使用 OpenGL 渲染，但在创建开始屏幕、菜单、高分页面等时我很好奇。您是使用 OpenGL 完成所有这些，还是创建额外的 UIView 并使用 UIKit？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T12:00:17.313

我认为没有最好的方法。如果您有时间在 OpenGL 中编写菜单和高分表，那么您将拥有更大的灵活性——例如，您可以在后台播放 3d 动画。

如果您使用标准 UIKit 视图对菜单、高分表等进行编码并在显示时切换 OpenGL 视图，那么这具有编码非常快速的优势（尤其是如果您花时间学习使用 Interface Builder )，但它本质上是 2d。即使您仍然可以使用自定义按钮图形和字体使其看起来不像一个商业应用程序，但与应用商店中的其他游戏相比，它仍然看起来不那么精致。

您不想做的是在您的 OpenGL 视图顶部放置一个透明的 UIView - 这将非常慢。

在构建程序的其余部分时，我个人使用 Interface Builder 生成的视图来获取菜单等内容。目的是稍后用 OpenGL 动画代码替换它。最后，这实际上取决于您有多少可用时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T08:40:28.587

我不认为有一个正确的答案。我个人对所有内容都使用 opengl，例如在菜单结构中我对文本使用纹理。我想这取决于您想要显示的内容，我认为如果您坚持使用 opengl，创建适合您游戏的自定义外观会更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T09:10:19.500

我听说过关于这件事的矛盾的事情。我听说在 OES 上渲染 UIKit 时速度很慢。

我说，如果您看到另一个应用程序运行良好，请效仿。

一些更流行的游戏在 OES 中可以做所有事情 - 例如 Rolando。也许最好遵循这种模式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T08:23:42.067

除了其他人所说的之外，请考虑坚持使用 OpenGL 会更容易一些，因为这将是您代码库的大部分。

# arrays - 如何在 MATLAB 中遍历 n 维矩阵中的每个元素？

> ID：758736
> 
> 赞同：87
> 
> 时间：2009-04-17T02:12:19.317
> 
> 标签：arrays, matlab, matrix, multidimensional-array, iteration

我有个问题。我需要遍历 MATLAB 中 n 维矩阵中的每个元素。问题是，我不知道如何对任意数量的维度执行此操作。我知道我可以说

```
for i = 1:size(m,1)
    for j = 1:size(m,2)
        for k = 1:size(m,3) 
```

等等，但是有没有办法为任意数量的维度做到这一点？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-04-17T02:46:41.590

您可以使用线性索引来访问每个元素。

```
for idx = 1:numel(array)
    element = array(idx)
    ....
end 
```

如果您不需要知道 i,j,k, 您所在的位置，这将很有用。但是，如果您不需要知道您所在的索引，您最好使用 arrayfun()

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-04-17T03:13:00.293

matlab中数组的线性索引的想法是一个重要的想法。MATLAB 中的数组实际上只是一个元素向量，串在内存中。MATLAB 允许您使用行和列索引或单个线性索引。例如，

```
A = magic(3)
A =
     8     1     6
     3     5     7
     4     9     2

A(2,3)
ans =
     7

A(8)
ans =
     7 
```

我们可以通过将数组展开为向量来查看元素在内存中的存储顺序。

```
A(:)
ans =
     8
     3
     4
     1
     5
     9
     6
     7
     2 
```

如您所见，第 8 个元素是数字 7。实际上，函数 find 将其结果作为线性索引返回。

```
find(A>6)
ans =
     1
     6
     8 
```

结果是，我们可以使用单个循环依次访问通用 nd 数组的每个元素。例如，如果我们想对 A 的元素求平方（是的，我知道有更好的方法可以做到这一点），可以这样做：

```
B = zeros(size(A));
for i = 1:numel(A)
  B(i) = A(i).^2;
end

B
B =
    64     1    36
     9    25    49
    16    81     4 
```

在许多情况下，线性索引更有用。线性索引和二维（或更高）维下标之间的转换是通过 sub2ind 和 ind2sub 函数完成的。

线性索引通常适用于 matlab 中的任何数组。所以你可以在结构、元胞数组等上使用它。线性索引的唯一问题是当它们变得太大时。MATLAB 使用 32 位整数来存储这些索引。因此，如果您的数组中的元素总数超过 2^32 个，则线性索引将失败。如果您经常使用稀疏矩阵，这真的只是一个问题，有时这会导致问题。（虽然我没有使用 64 位的 MATLAB 版本，但我相信那些幸运的人已经解决了这个问题。）

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-17T04:03:32.513

正如在其他一些答案中所指出的，您可以在单个 for 循环中使用从to的[线性索引](https://www.mathworks.com/help/matlab/math/array-indexing.html#MatrixIndexingExample-2)`A`迭代矩阵（任何维度）中的所有元素。您还可以使用几个函数：和.`1``numel(A)`[`arrayfun`](https://www.mathworks.com/help/matlab/ref/arrayfun.html)[`cellfun`](https://www.mathworks.com/help/matlab/ref/cellfun.html)

让我们首先假设您有一个要应用于`A`（称为`my_func`）的每个元素的函数。您首先为此函数创建一个[函数句柄：](https://www.mathworks.com/help/matlab/matlab_prog/creating-a-function-handle.html)

```
fcn = @my_func; 
```

如果`A`是任意维度的矩阵（双精度、单精度等），您可以使用它`arrayfun`来应用于`my_func`每个元素：

```
outArgs = arrayfun(fcn, A); 
```

如果`A`是任意维度的[单元格数组](https://www.mathworks.com/help/matlab/cell-arrays.html)`cellfun`，您可以使用应用于`my_func`每个单元格：

```
outArgs = cellfun(fcn, A); 
```

该函数`my_func`必须接受`A`作为输入。如果 有任何输出`my_func`，则将它们放置在 中`outArgs`，其大小/尺寸与 相同`A`。

关于输出的一个警告......如果`my_func`在对 的不同元素进行操作时返回不同大小和类型的输出`A`，则`outArgs`必须将其制成单元数组。这是通过调用`arrayfun`或`cellfun`使用附加的参数/值对来完成的：

```
outArgs = arrayfun(fcn, A, 'UniformOutput', false);
outArgs = cellfun(fcn, A, 'UniformOutput', false); 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-17T07:04:22.140

另一个技巧是使用`ind2sub`and `sub2ind`。与`numel`and结合使用`size`，您可以执行以下操作，创建一个 N 维数组，然后将“对角线”上的所有元素设置为 1。

```
d = zeros( 3, 4, 5, 6 ); % Let's pretend this is a user input
nel = numel( d );
sz = size( d );
szargs = cell( 1, ndims( d ) ); % We'll use this with ind2sub in the loop
for ii=1:nel
    [ szargs{:} ] = ind2sub( sz, ii ); % Convert linear index back to subscripts
    if all( [szargs{2:end}] == szargs{1} ) % On the diagonal?
        d( ii ) = 1;
    end
end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-11-15T20:44:49.210

您可以使递归函数完成工作

*   让`L = size(M)`
*   让`idx = zeros(L,1)`
*   取`length(L)`最大深度
*   环形`for idx(depth) = 1:L(depth)`
*   如果您的深度是`length(L)`，请执行元素操作，否则再次调用该函数`depth+1`

如果您想检查所有点，不如矢量化方法快，但如果您不需要评估其中的大多数点，它可以节省大量时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-04-08T21:55:06.700

这些解决方案比使用更快（大约 11%）`numel`；）

```
for idx = reshape(array,1,[]),
     element = element + idx;
end 
```

或者

```
for idx = array(:)',
    element = element + idx;
end 
```

UPD。tnx @rayryeng 在最后一个答案中检测到错误

* * *

# 免责声明

由于出现了根本性的拼写错误，这篇文章引用的时间信息不正确且不准确（请参阅下面的评论流以及[编辑历史记录](https://stackoverflow.com/posts/29526065/revisions)- 特别是查看此答案的第一个版本）。 [警告 Emptor](https://en.wikipedia.org/wiki/Caveat_emptor)。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-17T02:40:48.670

如果您更深入地研究其他用途，`size`您会发现您实际上可以获得每个维度大小的向量。此链接向您显示文档：

[www.mathworks.com/access/helpdesk/help/techdoc/ref/size.html](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/size.html)

获得大小向量后，迭代该向量。像这样的东西（请原谅我的语法，因为我从大学起就没有使用过 Matlab）：

```
d = size(m);
dims = ndims(m);
for dimNumber = 1:dims
   for i = 1:d[dimNumber]
      ... 
```

把它变成实际的 Matlab 法律语法，我认为它会做你想要的。

此外，您应该能够按照[此处](http://www.mathworks.com/company/newsletters/digest/sept01/matrix.html)所述进行线性索引。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2010-03-10T13:46:52.920

您想模拟 n 嵌套的 for 循环。

遍历n维数组可以看作是增加n位数。

在每个维度上，我们有与维度长度一样多的数字。

例子：

假设我们有数组（矩阵）

```
int[][][] T=new int[3][4][5]; 
```

在“for notation”中，我们有：

```
for(int x=0;x<3;x++)
   for(int y=0;y<4;y++)
       for(int z=0;z<5;z++)
          T[x][y][z]=... 
```

要模拟这一点，您必须使用“n 位数字符号”

我们有 3 位数字，第一位 3 位，第二位 4 位，第三位 5 位

我们必须增加数字，所以我们会得到序列

```
0 0 0
0 0 1
0 0 2    
0 0 3
0 0 4
0 1 0
0 1 1
0 1 2
0 1 3
0 1 4
0 2 0
0 2 1
0 2 2
0 2 3
0 2 4
0 3 0
0 3 1
0 3 2
0 3 3
0 3 4
and so on 
```

所以你可以编写代码来增加这样的 n 位数。您可以这样做，您可以从数字的任何值开始，并通过任何数字增加/减少数字。这样，您可以模拟从表中某处开始但不在末尾结束的嵌套 for 循环。

不过，这并不是一件容易的事。不幸的是，我无法使用 matlab 表示法。

# iphone - NSMutableString 的这种用法是内存泄漏吗？

> ID：758743
> 
> 赞同：0
> 
> 时间：2009-04-17T02:14:37.063
> 
> 标签：iphone, cocoa, cocoa-touch, objective-c, memory-leaks

我目前在一个类中使用一个实例变量，它是一个 NSMutableString，它是一个 NSURLConnection 的委托。该变量负责构建从委托方法返回的数据字符串：

```
- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data 
```

字符串 'foo' 有一个带有 retain 的属性集。它以这种方式非常直接地在我的类 init 方法中分配：

```
dataString = [[NSMutableString alloc] init]; 
```

它在类 dealloc 方法中释放。

在 connection:didReceiveData: 中，我使用这样的 var：

```
 NSString *tmpString = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
    [dataString appendString:tmpString];
    [tmpString release]; 
```

现在这就是事情变得棘手的地方。由于我设置 NSURLConnection 委托的类是一个单例（它主要处理 NSURL* 类型调用），我需要注意如何重用我的对象。因此，在我的 connectionDidFinishLoading: 类中，我有以下内容：

```
 // cache away data currently in dataString.
[dataString release];
dataString = [[NSMutableString alloc] init]; 
```

处理我的 dataString 的策略会让你流血吗？我在泄漏内存吗？我能做什么更聪明？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T03:13:05.317

您是否要问我们是否*每次* 在应用程序中使用对象都是内存[泄漏](https://stackoverflow.com/questions/756908/is-this-an-objective-c-memory-leak)[？](https://stackoverflow.com/questions/722957/objective-c-cocoa-do-i-have-a-memory-leak-here)

[阅读文档。](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/)了解[对象所有权的规则，](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmPractical.html)您每次都会得到答案。

如果您怀疑有泄漏，请运行 Instruments 的 ObjectAlloc 探针。[你已经做过一次了](https://stackoverflow.com/questions/726944/why-is-instruments-reporting-this-as-a-memory-leak)，很清楚你知道怎么做。还有[泄漏命令](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/leaks.1.html)。

# msbuild - NAnt 或 MSBuild，我应该在 svn 环境中使用哪一个？

> ID：758754
> 
> 赞同：8
> 
> 时间：2009-04-17T02:21:46.297
> 
> 标签：msbuild, nant

我有一个需要自动化构建的 C# 项目，我正在尝试在 NAnt 和 MSBuild 之间进行选择。

我应该使用哪一个？

哪个功能更好，包括对svn的支持？

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-17T02:40:44.537

你应该读这个：

[NAnt 或 MSBuild，选择哪一个以及何时选择？](https://stackoverflow.com/questions/476163/nant-or-msbuild-which-one-to-choose-and-when)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T02:26:29.983

为什么不兼得？您应该能够从 NAnt 启动 MSBuild。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T02:29:10.540

如果您有 TFS 并使用更严格的微软方法，那么我会使用 MsBuild，因为它自然嵌入在构建过程中。

如果您正在采用更开源的方法，例如 TeamCity、CruiseControl，那么 NAnt 可能会更好。

# reporting-services - Reporting Services 中的鼠标悬停操作

> ID：758756
> 
> 赞同：1
> 
> 时间：2009-04-17T02:22:11.913
> 
> 标签：reporting-services, mouseover

我们如何在 Reporting Services 中实现鼠标悬停动作？

例如：在图表中，如果我将鼠标指针指向 X、Y 交叉点，那么它应该显示该值。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T02:28:26.190

据我所知，无法处理一般的鼠标悬停事件。报告服务毕竟不是一个完整的编程环境。

不幸的是，根据[这篇文章](http://support.dundas.com/Default.aspx?article=1052)，在 Dundas 中根本不可能有用于 SSRS 的数据点工具提示。

最好的替代方法是在报告属性中打开标签。这将在图表本身的点旁边显示数据点值。

# ruby-on-rails - Rails 通知消息插件？

> ID：758757
> 
> 赞同：17
> 
> 时间：2009-04-17T02:23:54.360
> 
> 标签：ruby-on-rails, ruby, message, notifications

我即将为我的 Rails 应用程序编写一些代码，并且不想重新发明轮子，因此我的问题是：

你们知道任何 Rails 插件，它允许应用程序显示可能是用户特定的通知消息，还允许用户将它们标记为“不再显示”？

我的愿景是显示一个顶部 div（就像最近添加的 StackOverflow 一样），以不同的颜色显示消息“标题”，并且可以点击。单击后，它将弹出整个消息，然后允许用户对其进行标记以防止再次显示。

那里有类似的东西吗？:-)

到目前为止，我发现了这两个插件：

*   [http://github.com/jstewart/system_messages/tree/master](http://github.com/jstewart/system_messages/tree/master)
*   [http://github.com/arya/site_notifications/tree/master](http://github.com/arya/site_notifications/tree/master)

但这些是我愿景中相当不完整的部分

——费利佩。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-10-09T16:21:15.247

似乎[system_messages](http://github.com/jstewart/system_messages)（您链接到的）主要是您想要的。该`SystemMessage`模型具有`header`、`message`和`dismissed`字段。

当点击标题时，只需要一点 JavaScript 就可以显示一个最初隐藏的消息字段。如果您使用 Prototype，该插件已经允许通过 JavaScript 解除消息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T03:23:54.620

由于我没有足够的声誉来发表评论 - 由于几个不同的原因，Flash 是不够的：

1.  您正在混合视图和控制器代码。我需要通知用户，包括不属于控制器的 URL 和消息。我可以编写包装函数在视图中执行此操作，但它很hacky。
2.  异步通知。如果您使用的是队列设计模式，那么您确实需要一个消息队列来配合它，并完全独立于他们正在查看的控制器显示用户消息。
3.  很难设置状态。有些消息应该只向用户显示一次。需要创建一个完整的消息模型来跟踪他们点击和禁用的内容。

我也在寻找一些好的解决方案，到目前为止，我能想到的最好的解决方案是 RYO。我最终会将显示代码填充到闪存中，但要弄清楚什么和何时闪存是诀窍。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-07-20T08:29:52.810

Mailboxer 提供了旨在用作系统消息的通知模型：[https ://github.com/ging/mailboxer](https://github.com/ging/mailboxer)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T10:35:17.627

您为什么不使用内置闪存的导轨是有原因的吗？然后只有一些 js 在单击关闭时隐藏 flash 消息？

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-05-29T03:44:11.483

我使用[jGrowl](http://plugins.jquery.com/project/Growl) ( [demo](http://projects.zoulcreations.com/jquery/growl/) )，对此我很满意。今天早上我读到了[Roar](http://digitarald.de/project/roar/)，我也会尝试一下。如果您使用的是 MooTools，还有[Window.Growl](http://icebeat.bitacoras.com/mootools/growl/)。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-04-18T00:42:03.567

Rails 中已经内置了一个消息通知系统，即 flash。它出现的时间和对象以及外观取决于应用程序；因此，不太可能有预先编写的插件完全符合您的要求。

如果我是你，我会分配给控制器中的 flash 并在布局中创建一个 div，如果有要传达的 flash 消息有条件地出现。使用 CSS 设置样式并使用 JavaScript 效果进行装饰。

# c# - 展开 Winform 窗口时，虚线矩形显示为实心

> ID：758761
> 
> 赞同：0
> 
> 时间：2009-04-17T02:25:44.900
> 
> 标签：c#, winforms, gdi+, paint

我在自定义绘制虚线矩形时遇到了 GDI+ 问题。

当窗口大小增加或向上/向下滚动时，虚线矩形的垂直部分显示为实线、连续线。更快地移动鼠标会导致实体部分越来越少。奇怪的是，水平线没有表现出这种行为并按预期显示。

到目前为止，两个非最佳解决方案是在和期间设置`ResizeRedraw = true`或调用。我当然想避免这种情况，因为我真正绘制的内容更复杂，而且这些缓慢的调用会破坏流畅的体验。我也尝试过仅使新显示的区域无效，但无济于事 - 只有完整的 Invalidate 似乎有效。`Invalidate()``OnResize()``OnScroll()`

关于如何解决这个问题的任何指示？

演示代码：

```
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Windows.Forms;

public class Form1 : Form
{
    static void Main()
    {
        Application.Run(new Form1());
    }

    public Form1()
    {
        this.ClientSize = new System.Drawing.Size(472, 349);

        DoubleBuffered = true;
        //ResizeRedraw = true;
    }

    protected override void OnPaint(PaintEventArgs e)
    {
        base.OnPaint(e);

        int dimensions = 70;

        using ( Pen pen = new Pen(Color.Gray) )
        {
            pen.DashStyle = DashStyle.Dash;

            for ( int x = 0; x < 20; ++x )
            {
                for ( int y = 0; y < 20; ++y )
                {
                    Rectangle rect = new Rectangle(x * dimensions, y * dimensions, dimensions, dimensions);

                    e.Graphics.DrawRectangle(pen, rect);
                }
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T04:34:31.720

我认为有两个问题：窗口边缘似乎有一个区域没有正确绘制矩形；并且您正在将矩形相互绘制，因此破折号将无法正常工作。

用以下内容替换您的 OnPaint 循环：

```
 for (int y = 0; y < Height; y += dimensions)
   {
       e.Graphics.DrawLine(pen, 0, y, Width, y);
   }
   for (int x = 0; x < Width; x += dimensions)
   {
       e.Graphics.DrawLine(pen, x, 0, x, Height);
   } 
```

# firefox - Firebug“白名单”模式

> ID：758764
> 
> 赞同：2
> 
> 时间：2009-04-17T02:27:23.867
> 
> 标签：firefox, firebug, firefox-addon

如何让 Firebug 做到这一点：

（来自 Firebug 网站[http://getfirebug.com/using.html](http://getfirebug.com/using.html)）您可以在两种模式下浏览 - 为除“黑名单”上的所有网站启用 Firebug，或为除“白名单”上的所有网站禁用 Firebug ”。

我如何获得第二个选项？我不希望 Firebug 为我访问的每个站点运行，只是那些我正在处理的站点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T02:41:08.513

从控制台下拉列表中选择“已禁用”（默认情况下禁用所有），然后从同一下拉列表中单击“站点”项。将弹出一个对话框，您可以在其中选择启用 Firebug（白名单）的站点。

# cocoa - 如何删除指定路径中的文件和目录？

> ID：758768
> 
> 赞同：0
> 
> 时间：2009-04-17T02:30:00.723
> 
> 标签：cocoa

现在我想删除指定路径中的一些文件和目录。比如文件扩展名为.png，目录命名为abc，在指定的目录中可能有一些子目录，如何获取指定的文件和目录的数组？然后如何删除它们？我找到了一个方法： NSArray *paths = NSSearchPathForDirectoriesInDomains (NSLibraryDirectory, NSUserDomainMask, YES);

但我认为这是一种搜索 NSLibraryDirectory 的方法，而不是指定路径，怎么办？非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T08:07:47.620

阅读 NSFileManager

# ruby-on-rails - 在 OS X 上尝试从 Rails 连接到 Oracle 时出错

> ID：758771
> 
> 赞同：2
> 
> 时间：2009-04-17T02:33:17.223
> 
> 标签：ruby-on-rails, ruby, oracle

[我完成了此处](http://blog.rayapps.com/2008/04/24/how-to-setup-ruby-and-new-oracle-instant-client-on-leopard/)描述的所有步骤来设置我的 OS X 机器，以允许我从 Rails 应用程序连接到 Oracle。

`database.yml`在我的应用程序中设置文件：

```
development:
  adapter: oracle_enhanced
  host: [SERVER IP ADDRESS]
  database: [ORACLE INSTANCE SID]
  username: xxx
  password: yyy
  encoding: utf8 
```

还用域名试了一下。

在 Rails 控制台中尝试过...

```
>> con = ActiveRecord::Base.connection 
```

但是它挂了很长时间然后超时并出现错误......

```
OCIError: ORA-12170: TNS:Connect timeout occurred
    from env.c:257:in oci8lib.so
    from /usr/local/lib/ruby/site_ruby/1.8/oci8.rb:229:in `initialize'
    from /usr/local/lib/ruby/gems/1.8/gems/activerecord-oracle_enhanced-adapter-1.2.0/lib/active_record/connection_adapters/oracle_enhanced_oci_connection.rb:184:in `new'
    from /usr/local/lib/ruby/gems/1.8/gems/activerecord-oracle_enhanced-adapter-1.2.0/lib/active_record/connection_adapters/oracle_enhanced_oci_connection.rb:184:in `new_connection'

[...] 
```

有没有人在 OS X 上得到这个工作并且知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T03:42:18.740

您应该拥有**host:**行或**database:**行，但不能同时拥有。

如果您有 TNS 条目，请使用**database:行。**

```
database: orcl    ## orcl is an entry in tnsnames.ora 
```

否则使用**主机：**格式。

```
host: dbhost.example.com/orcl    # dbhost: network address of the database host
                                 # orcl: database instance name 
```

更多注释在这里：

[如何使用 Oracle 配置 Ruby on Rails？](https://stackoverflow.com/questions/764887/how-to-configure-ruby-on-rails-with-oracle)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T03:01:54.547

如果您在 Oracle 客户端软件中安装了 sqlplus，您应该先尝试连接，以确保问题出在 Rails 配置上，而不是您的连接信息或服务器本身。

# ruby-on-rails - Capistrano & Bash：忽略命令退出状态

> ID：758774
> 
> 赞同：50
> 
> 时间：2009-04-17T02:35:04.020
> 
> 标签：ruby-on-rails, ruby, bash, capistrano

我正在使用 Capistrano 运行远程任务。我的任务如下所示：

```
task :my_task do
  run "my_command"
end 
```

我的问题是，如果`my_command`退出状态！= 0，那么 Capistrano 认为它失败并退出。当退出状态不为 0 时，如何让 capistrano 在退出时继续运行？我已经改为`my_command`并且`my_command;echo`它可以工作，但感觉就像一个黑客。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-08-25T14:19:53.920

最简单的方法是将 true 附加到命令的末尾。

```
 task :my_task do
    run "my_command"
  end 
```

变成

```
 task :my_task do
    run "my_command; true"
  end 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2014-05-02T08:49:46.957

对于 Capistrano 3，您可以（如建议[此处](https://github.com/capistrano/capistrano/issues/731#issuecomment-26917682)）使用以下内容：

```
execute "some_command.sh", raise_on_non_zero_exit: false 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-21T19:09:42.503

+grep+ 命令根据它找到的内容退出非零。在您关心输出但不介意它是否为空的用例中，您将默默地丢弃退出状态：

```
run %Q{bash -c 'grep #{escaped_grep_command_args} ; true' } 
```

通常，我认为第一个解决方案很好——我会让它自己记录：

```
cmd = "my_command with_args escaped_correctly"
run %Q{bash -c '#{cmd} || echo "Failed: [#{cmd}] -- ignoring."'} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-17T04:57:43.273

如果您希望 Capistrano 代码对退出代码执行不同的操作，则需要修补它；如果退出状态不为零，则硬编码会引发异常。

这是 lib/capistrano/command.rb 的相关部分。以 ... 开头的行`if (failed`是重要的行。基本上它说如果有任何非零返回值，就会引发错误。

```
# Processes the command in parallel on all specified hosts. If the command
# fails (non-zero return code) on any of the hosts, this will raise a
# Capistrano::CommandError.
def process!
  loop do
    break unless process_iteration { @channels.any? { |ch| !ch[:closed] } }
  end

  logger.trace "command finished" if logger

  if (failed = @channels.select { |ch| ch[:status] != 0 }).any?
    commands = failed.inject({}) { |map, ch| (map[ch[:command]] ||= []) << ch[:server]; map }
    message = commands.map { |command, list| "#{command.inspect} on #{list.join(',')}" }.join("; ")
    error = CommandError.new("failed: #{message}")
    error.hosts = commands.values.flatten
    raise error
  end

  self
end 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-07-11T08:17:13.653

我找到了最简单的选择：

```
run "my_command || :" 
```

注意：`:`是 NOP 命令，因此退出代码将被忽略。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-17T05:17:27.530

我只是将 STDERR 和 STDOUT 重定向到 /dev/null，所以你的

```
run "my_command" 
```

变成

```
run "my_command > /dev/null 2> /dev/null" 
```

这非常适用于标准的 unix 工具，例如 cp 或 ln 可能会失败，但您不想在此类失败时停止部署。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-08-21T23:58:53.103

我不确定他们添加了这个代码是什么版本，但我喜欢通过使用来处理这个问题`raise_on_non_zero_exit`

```
namespace :invoke do
  task :cleanup_workspace do
    on release_roles(:app), in: :parallel do
      execute 'sudo /etc/cron.daily/cleanup_workspace', raise_on_non_zero_exit: false
    end
  end
end 
```

Here is where that feature is implemented in the gem. [https://github.com/capistrano/sshkit/blob/4cfddde6a643520986ed0f66f21d1357e0cd458b/lib/sshkit/command.rb#L94](https://github.com/capistrano/sshkit/blob/4cfddde6a643520986ed0f66f21d1357e0cd458b/lib/sshkit/command.rb#L94)

# wcf - 不允许使用 HTTP 动词 POST 访问路径“/Membership/user/”

> ID：758780
> 
> 赞同：1
> 
> 时间：2009-04-17T02:36:56.310
> 
> 标签：wcf, silverlight, entity-framework

这段代码：

```
private void Submit_Click(object sender, RoutedEventArgs e)
{
 user temp = new user();
 temp.Username = UserName.Text;
 temp.Password = Password.Text;
 dataBase.AddTouser(temp);
 IAsyncResult result = dataBase.BeginSaveChanges(new AsyncCallback (OnSaveChangesCompleted), temp); 
}

void OnSaveChangesCompleted(IAsyncResult result)
{
 try
 {   
    string name = ((user) result.AsyncState).Username.ToString();
    dataBase.EndSaveChanges(result);
 }
 catch (DataServiceRequestException ex)
 {
     MessageBox.Show("OnSaveChangesCompleted Error: " + ex.ToString());
 }
} 
```

产生此错误：

不允许使用 HTTP 动词 POST 访问路径“/Membership/user/”

我认为这可能与此不正确有关：

```
public static void InitializeService(IDataServiceConfiguration config)
{
 config.SetEntitySetAccessRule("*", EntitySetRights.All);
 config.SetServiceOperationAccessRule("*", ServiceOperationRights.All);
} 
```

或者它可能与 ASP.NET 配置有关，但我不确定在那里做什么。

我正在尝试同时使用 Silverlight、DataEntityFramework 和 WCF 服务（这是第一次），但不知道该问题的解决方案究竟在哪里。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-04T10:55:31.990

我遇到了类似的问题，似乎是url重写有问题。

[http://www.lukemelia.com/blog/archives/2007/01/05/aspnet-the-http-verb-post-used-to-access-path-is-not-allowed/](http://www.lukemelia.com/blog/archives/2007/01/05/aspnet-the-http-verb-post-used-to-access-path-is-not-allowed/)

您必须在 IIS 设置中删除“*”到 aspnet_isapi.dll 的映射。

# c# - 为平板电脑开发时，我如何确定用户点击的是鼠标还是笔？

> ID：758782
> 
> 赞同：5
> 
> 时间：2009-04-17T02:38:41.937
> 
> 标签：c#, winforms, tablet-pc

如何检查用户是否在 C# 控件上使用鼠标或触控笔单击。

例如。如果用户用钢笔按钮单击文本框，那么我希望弹出一个输入面板，但如果他用鼠标单击，那么它不应该。那么如何检查他使用的是鼠标还是笔呢？

编辑：使用 Windows 窗体而不是 WPF

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T18:09:32.813

我为 MSDN 写了一篇从未发表过的文章，我猜是因为当我拿到它的时候，Tablet PC 开发已经失败了。但它描述了如何做到这一点。长话短说，您将需要 GetMessageExtraInfo API。这是定义：

```
// [DllImport( "user32.dll" )]
// private static extern uint GetMessageExtraInfo( );

uint extra = GetMessageExtraInfo();
bool isPen = ( ( extra &  0xFFFFFF00 ) == 0xFF515700 ); 
```

如果您希望我将文章发送给您，请使用我在 Einstein Tech dot net 的名字给我发电子邮件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T03:10:16.853

如果您使用的是 WPF，那么会有一大堆 Stylus 事件。例如[UIElement.StylusDown](http://msdn.microsoft.com/en-us/library/system.windows.uielement.stylusdown.aspx)。

[这](http://msdn.microsoft.com/en-us/library/ms754010.aspx)有更多关于手写笔和鼠标事件如何交互的细节。

如果您不使用 WPF，为什么不呢？:p

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-17T02:41:56.313

我对此并不太了解，但我猜如果有人使用手写笔，那么 mouseEnter、mouseExit（或任何等价物）事件将永远不会触发。如果有人确实被解雇了，那么您就知道他们正在使用鼠标。

# xhtml - 在 XHTML 中标记推荐的最佳方式是什么？

> ID：758785
> 
> 赞同：5
> 
> 时间：2009-04-17T02:40:21.793
> 
> 标签：xhtml, markup, semantic-markup, quotations

我曾经只是为此使用`p`和`span`元素......但我一直在努力使用*正确*的元素，这是我之前在推荐方面没有真正考虑过的事情。

这就是我的想法...

```
<div class="testimonial">
 <blockquote>I love your products!</blockquote>
 <span>Jim Testimonial-giver</span>
</div> 
```

这看起来像是最好的方法吗？有最佳实践吗？

我查看了他们网站上的[W3C 标记推荐](http://www.w3.org/2001/04/xhtml-m12n-testimonial)，他们使用了...

```
<blockquote>
 <p>
  <a id="aptest" name="aptest">Applied Testin.....</a>
  <br />
  <span class="QuoteAttr">-- Shane P. M...</span>
 </p>
</blockquote> 
```

我应该只是复制 W3C 的做法，毕竟*它们不应该是正确的*吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-17T03:16:43.420

使用[引用标签](http://www.w3.org/TR/html401/struct/text.html#h-9.2.1)：

```
<div class="testimonial">
 <blockquote>i love your products</blockquote>
 <cite>Jim Testimonial-giver</cite>
</div> 
```

我也可能会这样做：

```
<blockquote class="testimonial">
  i love your products
  <cite>Jim Testimonial-giver</cite>
</blockquote> 
```

只是为了让它更语义化，并清楚地将引文与引文联系起来。div 应该只对结构性事​​物是必需的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T03:28:53.407

[Mozilla.org 样式指南](http://www-archive.mozilla.org/contribute/writing/markup.html)似乎更喜欢使用`q`引用和作者，用适当的类`<cite>`包裹在 a`<blockquote>`或 a中。[HTML 5](http://www.w3.org/TR/html5/text-level-semantics.html#the-cite-element)似乎强烈反对使用人名。它说它应该只用于作品的标题。`<div>``<cite>`

遵循该模型，可能是这样的：

```
<blockquote class="testimonial">
  <q>I love your products!</q>
  <cite>Jim Testimonial-giver</cite>
</blockquote> 
```

或者，如果您不想使用`<cite>`，则：

```
<blockquote class="testimonial">
  <q>I love your products!</q>
  <span class="quote-attribution">Jim Testimonial-giver</span>
</blockquote> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-30T05:48:32.410

很长一段时间以来，在引用时， 我都使用[Tantek Çelik 的幻灯片作为参考。](http://tantek.com/presentations/2005/09/elements-of-xhtml/#slide13)

但是看到 alex 和 Rex M 的评论，我正在考虑这个实现以供推荐：

```
<ul id="testimonials">
  <li>
    <blockquote>
      i love your products
    </blockquote>
    <cite>&mdash;Jim Testimonial-giver</cite>
  </li>
  <li>
    <blockquote>
      i love your products even more
    </blockquote>
    <cite>&mdash;Joe Testimonial-giver</cite>
  </li>
  [...]
</ul> 
```

# php - 如何删除 PHP 会话？

> ID：758790
> 
> 赞同：6
> 
> 时间：2009-04-17T02:41:55.267
> 
> 标签：php, session

用户注销时，我可能没有正确删除 PHP 会话。我注意到，如果我在不关闭浏览器的情况下退出并重新登录，会话 ID 不会更改，但如果我退出，关闭浏览器窗口，打开一个新窗口并登录，会话 ID 会有所不同. 我需要做一些不同的事情还是这是正常行为？三年来我一直在使用相同的过程，但最近发生的一些事情让我觉得*也许*我需要做一些不同的事情。

当有人点击退出时，我基本上会这样做。

```
<?php

session_start();

if( isSet($_SESSION['FacID']) )
    $facID = $_SESSION['FacID'];    //Want to re-instate this after we destroy the session.

unset($_SESSION);
session_destroy();

if( isSet($_SESSION['FacID']) )
    $_SESSION['FacID'] = $facID;

?> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-17T02:57:59.923

如果你觉得需要强制一个新的 id [http://pl.php.net/manual/en/function.session-regenerate-id.php](http://pl.php.net/manual/en/function.session-regenerate-id.php)

对于您的问题，来自手册：

> session_destroy() 销毁与当前会话关联的所有数据。它不会取消设置与会话关联的任何全局变量，也不会取消设置会话 cookie。要再次使用会话变量，必须调用 session_start()。
> 
> 为了完全终止会话，例如注销用户，还必须取消设置会话 ID。如果使用 cookie 传播会话 id（默认行为），则必须删除会话 cookie。setcookie() 可以用于此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T03:03:58.973

您的会话正在被破坏。

如果浏览器没有指定会话 ID，PHP 只会生成会话 ID。只要会话被破坏，就没有问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T02:53:43.210

大规模的保存和销毁是怎么回事？只需`session_start`设置您的变量。无需销毁，然后重置它们！

浏览器的“问题”是，当您关闭浏览器窗口时，您的浏览器正在删除 PHP 发送给它的 cookie，以便它知道会话 ID。这是一个浏览器选项，不能在服务器端更改（除非您利用）。可以使用一些方法来规避它，但这可能不是您的最佳选择。

# python - Python 按降序对 Collections.DefaultDict 进行排序

> ID：758792
> 
> 赞同：8
> 
> 时间：2009-04-17T02:41:58.403
> 
> 标签：python

我有这段代码：

```
 visits = defaultdict(int)
    for t in tweetsSQL:
         visits[t.user.from_user] += 1 
```

我在网上查看了一些使用 sorted 方法的示例，如下所示：

`sorted(visits.iteritems, key=operator.itemgetter(1), reverse=True)`

但它给了我：

`"TypeError: 'builtin_function_or_method' object is not iterable"`

我不确定为什么。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-17T02:49:30.850

ititems 是一种方法。你需要括号来调用它：`visits.iteritems()`.

就目前而言，您将 iteritems 方法本身传递给`sorted`这就是为什么它抱怨它无法迭代函数或方法的原因。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T03:08:28.853

我个人认为其中一种形式更简洁，因为第一个参数只需要是可迭代的而不是迭代器。

```
sorted_keys = sorted(visits.keys(), reverse=True)
sorted_keys = visits.keys().sort(reverse=True) 
```

# visual-studio - Visual Studio 2008 Pro - 如何获得关于解决方案或项目中文件/类/代码行数的快速报告

> ID：758794
> 
> 赞同：1
> 
> 时间：2009-04-17T02:42:07.340
> 
> 标签：visual-studio

您将如何获得有关解决方案或项目中文件/类/代码行数的快速报告？

有人知道我似乎还没有找到的任何免费插件或隐藏菜单吗？

编辑：如果与实际代码相比，它可以减少大量的空白/注释，那也会很酷。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T02:58:03.030

Microsoft 的代码指标需要 Team Suite 版本。您可能想尝试[NDepend](http://www.ndepend.com/Default.aspx)，它们有开源/学术/试用（免费）和专业（$$）版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T03:00:23.413

专业版中没有类似的东西。您必须升级到 Developer 或 Team Suite 版本才能获得 Code Metrics，这可以让您从集成工具中获得您想要的东西

除此之外，我认为你必须去第三方。

而我的两分钱价值是，无论如何你都必须对这样的指标持保留态度。

# grep - grep 命令替换 Fedora 上 httpd.conf 文件中的多行文本

> ID：758795
> 
> 赞同：0
> 
> 时间：2009-04-17T02:42:16.420
> 
> 标签：grep, fedora, multiline, httpd.conf

我是 shell 脚本和 Linux 环境的新手。

在我的项目中，我试图从 httpd.conf 文件中搜索以下文本

```
<Directory '/somedir/someinnerdir'>
AllowOverride All
</Directory> 
```

然后删除此文本并再次重写相同的文本。进行此重写的原因是该脚本将在第一次安装 Web 应用程序时运行，但它可能会在一段时间后再次运行，因为该 shell 脚本的其他部分也在执行其他任务。因此，第一次找不到该文本，只会被写入，但稍后在运行脚本时会再次找到该文本，需要将其删除并再次写入。

因此，我试图实现这一目标的脚本部分类似于：

```
grep -ve "<Directory '/somedir/someinnerdir'>\\nAllowOverride All\\n</Directory>" /etc/httpd/conf/httpd.conf > tmp_direct

echo -e "<Directory '/somedir/someinnerdir'>\\nAllowOverride All\\n</Directory>" >> tmp_direct

mv tmp_direct /etc/httpd/conf/httpd.conf 
```

我目前没有代码在我面前，所以上面可能有一些语法错误，但逻辑/编码是相同的。

由于 grep 命令不支持多行搜索，因此上面的代码片段无法完成我想要实现的目标。

我的操作系统是 Fedora 8。

您能否在此代码中提出一些建议以实现所需的功能，或者可能是其他替代方案。

在这方面的任何帮助将不胜感激。

提前致谢。

* * *

感谢您的回复。

抱歉之前的错误代码。现在更正了。

Charlie 和 i-moan，由于可操作性限制，我将无法实现 sed 或 perl，因为它需要添加到我们将分发此项目的环境中。

史蒂夫，我想检查多行。我没有把它放在代码块中，所以它删除了目录标签。:(

所以我需要另寻出路。

再次感谢。

此致。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T03:12:02.027

这听起来像是一份工作`sed(1)`。你想要的会非常接近

```
sed -i.bak -e '/AllowOverride All/i# '  file 
```

注释掉该行（记住 httpd.conf 有注释），然后

```
sed -i.bak -e 's/# AllowOverride All/AllowOverride All '  file 
```

把它退回来。

***警告***我还没试过，你想阅读手册页并自己测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T05:40:47.163

我不确定我是否理解这个问题。如果我错了，请纠正我，但您在第一次运行脚本时尝试将“AllowOverride All”添加到 httpd.conf。如果是这样，您要启用它吗？

然后在第二遍你可能想要启用/禁用命令？

如果我没记错的话 'AllowOverride' 只允许在*<Directory>*部分中所以只有在*<Directory></Directory>*定义中添加/启用才有意义：

如果上述情况属实，您可以在 perl 中执行此操作。

**第一次运行：添加**

> perl -0777 -pi -e 's{(. *?(?!AllowOverride\s+All).* ?)}[\nAllowOverride All\n$1]ixgs' httpd.conf

仅当目录部分尚未包含“AllowOverride All”时，它才会将其添加到目录部分。

**第二轮：改变**

在第二次运行时，您可以按照查理的建议**注释掉**.. 或者如果您喜欢 perl

> perl -0777 -pi -e's{(. *?)(AllowOverride\s+All)(.* ?)}[$1#$2$3]ixgs' httpd.conf

并**发表评论**

> perl -0777 -pi -e's{(. *?)(#AllowOverride\s+All)(.* ?)}[$1AllowOverride\s+All$3]ixgs' httpd.conf

正则表达式*s{}[]*非常冗长，并且有更好的正则表达式可以做同样的事情，但这对于初学者来说更容易（希望）理解:)。

*perl 命令选项说明*

**-0777**强制 Perl 一次性读取整个文件，因为 0777 不是合法字符值

**-p**在你的脚本周围放置一个循环

**-i**允许您就地编辑文件（因此您在“-e”中的命令更改文件）

**-e**让您在命令行上指定一行代码

在那一行中，我们有一个正则表达式。有关这方面的信息，请参见 [perldoc perlre](http://perldoc.perl.org/perlre.html)。

希望有帮助

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T03:11:21.763

如果要确保匹配整行，可以执行以下操作： grep -v "^AllowOverride All$"

^ 匹配行首，$ 匹配行尾。

这有帮助吗？我不太清楚你想用 grep 做什么。

# database-design - YAGNI 是否适用于数据库设计？

> ID：758801
> 
> 赞同：5
> 
> 时间：2009-04-17T02:46:48.000
> 
> 标签：database-design, yagni

在代码中，通常很容易添加新类以提供附加功能等。我对重构代码及其所涉及的内容有相当好的理解，因此[YAGNI](http://en.wikipedia.org/wiki/You_Ain't_Gonna_Need_It)通常对我来说是有意义的。

我不熟悉的是在部署后使用和更新关系数据库。我正在开发一个小宠物项目，我计划在[早期发布，经常发布](http://radio.weblogs.com/0103807/stories/2002/12/01/understandingTheImportanceOfReleaseEarlyReleaseOften.html)，我想知道我是否应该考虑在初始版本中不会使用但在计划功能列表中的数据? 添加表和调整架构是否像添加新类一样容易？或者我应该尝试为我可以想象使用但不打算在不久的将来使用的东西设置表格？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T02:53:45.800

这是一个很好的问题。我个人发现修改数据库模式并将所有数据转换为新的表示形式比重构代码困难得多。事实上，每当我开始一个将使用新数据库的项目时，我总是花时间坐下来编写任何代码以尽可能全面地了解我的规范。这通常需要预测功能并将对它们的支持合并到数据库中，即使我不打算立即实施它们。

如果您使用框架或其他提供更改数据库机制的类似层，您可能能够更灵活地进行数据库重构，但如果您正在编写直接 SQL，那么我建议您投入适量的设计和实现未来不太可能需要更改的模式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T02:53:28.563

我的观点是 YAGNI 适用于一切，编码、数据库设计、在家工作（我妻子在这方面强烈反对我）等等。

我曾经工作过的每个基于 DBMS 的应用程序都会定期更新 scema，因此应该在进程中对此进行计划。DBA 不会喜欢您提案中的“经常发布”部分，因为这对他们（或者如果它是非 DBA 数据库，那么您）来说是更多的工作。

但这就是他们的目的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T02:54:21.383

如果您对数据库进行了良好的测试，我会将 YAGNI 扩展到您的数据库设计中。

通常，添加列和表很容易，而删除或显着修改它们不太容易。在设计表格时要考虑到这一点（即，如果一个客户可以有多个用户，请不要将用户 ID 添加到您的客户表格中。第一次就做对）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-17T03:10:12.250

关于数据库设计和实现有很多敏捷思考。您可能有兴趣浏览 www.agiledata.org 上的最佳[实践，了解 Scott Ambler](http://www.agiledata.org/essays/bestPractices.html)[对此](http://www.agiledata.org)主题的一些想法。就我自己而言，我通常让数据库的设计随着应用程序的发展而增长。我很少提前创建表格。例外情况是审核和权限之类的事情，这些事情会贯穿整个设计。即使我实际上并没有预先为它们创建任何表，我也会考虑如何实现这些东西。横切方面确实会影响表格的设计，即使这些功能并不总是最先出现的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T09:07:40.707

数据库设计有一个概念基础。

在经典数据库设计中，存在三种模型：概念模型、逻辑模型和物理模型。

概念模型来自需求分析，并随着基础主题的发展或对主题的理解的发展而发展。概念模型将基本数据确定为形式和语义，但不处理表格组成等问题。

逻辑模型使用数据的关系模型。它可以从概念模型中推导出来，但它也处理关系的组成。规范化和其他组合问题在这里发挥作用。逻辑模型预测表设计，以及应用程序将进行的查询和更新。

物理模型将关系实现为表，还添加了实际构建数据库所需的所有其他功能，如索引、表空间等。它源自逻辑模型，但数据量、负载、性能和磁盘空间都会发挥作用。

这听起来冗长乏味，但如果你知道怎么做，它实际上很快。整个事情可以在几周内完成，而团队的其他成员仍在讨论功能规格。对于一个非常小的项目（6 表，50 列），只需铅笔和纸，几天内就可以完成。对于较大的项目，有一些工具可以使设计更加自动化、不易出错并且易于绘制图表。

但是当您发现概念模型不准确或不完整，而其他两个模型和数据库本身需要更改时会发生什么？这就是[数据独立](http://en.wikipedia.org/wiki/Data_independence)派上用场的地方。数据独立性对数据库设计的作用就像封装对对象设计的作用一样。也就是说，它可以防止一个地方的微小调整传播到整个应用程序对象。对象仅依赖于它们使用的数据。

如果必须将新表添加到模式中，那么任何应用程序被破坏的可能性都非常小。即使必须更改现有表，仅使用旧列的查询也不会看到任何差异。即使对象依赖于更改，您仍然可以为更改后的表指定一个新名称，然后使用旧名称创建一个视图，使其看起来像旧表仍然存在。

在一个好的 DBMS 中，物理数据的独立性几乎是完全的。您可以重新组织数据、添加和删除索引等，并且您不必更改任何应用程序。

简而言之，使用真正优秀的 DBMS 产品可以出色地完成变更管理。不幸的是，许多 DBA 和程序员不知道如何充分利用这些 DBMS 特性，即使它们已经存在多年。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T02:54:44.067

该原则仍然适用。在您拥有大量数据之前，您不必担心向表中添加字段等。相当多的数据。因此，在没有看到实际数据的情况下过早地担心索引和查询计划的细节通常会浪费时间，甚至会导致以后出现架构问题。

不幸的是，如果不遵循良好的测试/发布过程，在产品发布后对数据库设计进行修改可能会非常可怕。因此，比代码更重要的是，您希望在第一次使用数据库时就将其做好。

对于数据库，您确实希望计划将数据取出以及将其放入和存储，因此如果您的“计划”功能包括报告，那将极大地影响数据库的设计，因此可能要为此做好计划。

调整模式不像添加类那么容易，但它是可行的。

所以总的来说，YAGNI 仍然适用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-17T02:55:05.283

不要设置你还不需要的表。YAGNI 背后的部分原因是你不会预先预测你需要的正确的东西。您可以在需要更改新表时轻松添加新表、更改现有表等。

一个好的框架应该有一些用于执行[迁移](http://api.rubyonrails.org/classes/ActiveRecord/Migration.html)的工具，这些工具可以让您轻松自动地升级和降级数据库。如果你有这个，并且对你的设计相当小心，你应该能够重构你需要的方式，而不是试图想出你需要的所有东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-17T03:23:50.550

数据库设计与任何其他类型的设计一样。你的理解会逐渐增长，随着更好的理解，会出现一个不断发展的模式。

我希望更容易解释实际上关系数据库模式设计的概念基础。唯一真正对其建模的工具是对象角色建模，它已经出现了很长时间。最熟悉的工具是 Visiomodeler。为了了解它，这里有几个指向[Scott Ambler](http://www.agilemodeling.com/artifacts/ormDiagram.htm)和[Scot Becker](http://www.tdan.com/view-articles/5033)的链接。但是可以得出的结论是对象建模类型的断言直接导致特定的关系逻辑模型；因此，架构将需要随着您的概念模型的变化而变化。

在实践中，如果您对转换表达式非常满意，您的 rdbms 可以处理相当多的弯曲；并且擅长它是值得的。

注意：我认为像 LINQ 和对象关系模型这样的 SQL 避免技术只会成为不断发展的设计的障碍。我可能错了。有一些理由希望微软的实体框架将包含对象角色建模；但我只看到了对这种可能性的间接引用。

# php - php正则表达式删除HTML

> ID：758806
> 
> 赞同：13
> 
> 时间：2009-04-17T02:53:10.170
> 
> 标签：php, html, regex

在我们开始之前，strip_tags() 不起作用。

现在，

我有一些需要解析的数据，问题是，我需要摆脱所有格式非常奇怪的 HTML。标签看起来像这样：（注意空格）

```
< p > blah blah blah < / p > < a href= " link.html " > blah blah blah < /a > 
```

我一直在尝试的所有正则表达式都不起作用，而且我对正则表达式格式的了解不足以使它们起作用。我不在乎保留标签内的任何内容，如果可以的话，我宁愿去掉链接内的文本。

有人知道吗？

（我真的需要有一天坐下来学习正则表达式）

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-17T02:55:58.527

做

```
preg_replace('/<[^>]*>/', '', $content) 
```

工作？

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2012-08-07T11:34:38.517

`strip_tags()`如果您`html_entity_decode()`之前在变量上使用过，它将起作用`strip_tags()`

```
<?php
$text = '< p > blah blah blah < / p > < a href= " link.html " > blah blah blah< /a >';
echo strip_tags(html_entity_decode($text));
?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T02:56:48.757

不是万无一失的解决方案，但适用于您发布的内容：

```
s/<[^>]*>//g 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T02:57:38.130

格式奇怪？那是有效的HTML，对吗？在那种情况下，我不会用正则表达式来触及它。关于这如何出错以及为什么这是一个坏主意的例子不胜枚举。相反，我会使用[HTML Tidy](http://au2.php.net/tidy)来清理不必要的空白。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-04-17T03:19:27.890

[http://ca3.php.net/strip_tags](http://ca3.php.net/strip_tags)可能是您需要的。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-17T03:20:59.603

试试这个，让我知道。

```
<?php
$text = '< p > blah blah blah < / p > < a href= " link.html " > blah blah blah< /a >';
echo strip_tags($text);
echo "\n";
echo strip_tags($text, '<p><a>');
?> 
```

# java - 关于java垃圾回收的问题

> ID：758811
> 
> 赞同：2
> 
> 时间：2009-04-17T02:54:03.320
> 
> 标签：java, garbage-collection

我有这个类，我正在测试具有不同数据分布的插入。我在我的代码中这样做：

```
...

AVLTree tree = new AVLTree();

//insert the data from the first distribution

//get results

...

tree = new AVLTree();

//inser the data from the next distribution

//get results

... 
```

我正在为 3 个发行版执行此操作。每个应测试 14 次的平均值，并从中删除 2 个最低/最高值以计算平均值。这应该做 2000 次，每次 1000 个元素。换句话说，它是 1000、2000、3000、...、2000000。

问题是，我最多只能得到 100000。当我尝试 200000 时，堆空间用完了。我在命令行中使用 -Xmx 将可用堆空间增加到 1024m，它甚至没有完成使用 200000 的测试。我尝试了 2048m，但它无法正常工作。

我在想的是，一旦我执行 tree = new AVL Tree()，垃圾收集器就不会摆脱旧树。但为什么？我以为老树的元素将不再可访问，它们的内存将被清理。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-17T02:58:59.143

垃圾收集器清理你的旧树对象应该没有问题，所以我只能假设你正在做的其他一些分配*没有*被清理。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-17T03:22:11.083

Java有一个很好的工具来观察正在进行的GC（或者不是你的情况），JVisualVM，它是JDK附带的。

只需运行它，它就会显示哪些对象正在占用堆，并且您可以触发并查看 GC 的进度。然后您可以将它们定位为池，以便您可以重新使用它们，从而节省 GC 的工作。

另请查看此选项，它可能会停止您遇到的停止程序的错误，并且您的程序将完成，但这可能需要很长时间，因为您的应用程序将填满堆然后运行非常缓慢。

-XX:-UseGCOverheadLimit

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T04:35:27.477

您正在使用哪个 JVM 以及您用于配置 GC 的 JVM 参数是什么？

您的解释表明您的代码中存在内存泄漏。如果你有像 jprofiler 这样的工具，那么使用它来找出内存泄漏的位置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T05:40:43.230

没有理由不应该收集这些树，尽管我希望在内存不足之前，您应该看到系统运行完整 GC 时的长时间停顿。正如这里已经指出的那样，这不是您所看到的，您可以尝试使用 -XX:-PrintGC、-XX:-PrintGCDetails、-XX:-PrintGCTimeStamps 等标志运行，以便为您提供有关正在发生的事情的更多信息，可能还有一些关于你大致所在位置的运行计数。您还可以明确告诉垃圾收集器使用不同的垃圾收集算法。

但是，在我看来仍然不太可能。还有什么其他代码正在运行？AVLTree 类本身是否有可能阻止其实例被 GC 处理？手动记录该类的 finalize() 以确保（至少其中一些）是可收集的（例如，制作一些并手动调用 System.gc()）怎么样？

GC params [here ，](http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp)[这里](http://java.sun.com/docs/hotspot/gc5.0/gc_tuning_5.html)是来自 sun 的垃圾收集的一个很好的参考，非常值得一读。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T16:55:25.887

鉴于您只是为了测试目的而这样做，直接使用调用垃圾收集器可能只是很好的内务处理`System.gc()`（从而强制它通过）。如果存在内存泄漏，它不会帮助您，但如果没有，它可能会为您买回足够的内存以通过测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T02:58:38.597

Java 垃圾收集器不能保证在每个对象的引用计数变为零后进行垃圾收集。因此，如果您正在编写仅创建和删除**大量**对象的代码，则可能会在 gc 有机会运行之前耗尽所有堆空间。或者，Pax 建议您的代码中存在内存泄漏也很有可能。

如果您只进行基准测试，那么您可能希望在测试之间使用 java gc 函数（我认为在 System 类中），甚至为每个发行版重新运行您的程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-17T03:13:19.997

我们在服务器产品中注意到了这一点。当制造很多很快被扔掉的微小物体时，垃圾收集器就跟不上。当微小对象具有指向更大对象的指针（例如，指向大对象的对象`char[]`）时，该问题更加明显。GC 似乎没有意识到，如果它释放了小对象，它就可以释放更大的对象。即使`System.gc()`直接调用，这仍然是一个大问题（在 1.5 和 1.6 VM 中）！

我们最终所做的以及我向您推荐的是维护一个对象池。当您的对象不再需要时，将其放入池中。当您需要一个新对象时，从池中获取一个对象，如果池为空，则分配一个新对象。与纯分配相比，这也将节省少量时间，因为 Java 不必清除 ( `bzero`) 对象。

如果您担心池变得太大（从而浪费内存），您可以定期从池中删除任意数量的对象，或者使用弱引用（例如，使用`java.util.WeakHashMap`）。使用池的优点之一是您可以跟踪分配频率和总数，并且可以相应地进行调整。

我们正在使用 和 的池，`char[]`并且我们在池中`byte[]`维护单独的大小“箱”（例如，我们总是分配大小为 2 的幂的数组）。我们的产品进行了大量的字符串构建，并且使用池显示了显着的性能改进。

注意：一般来说，GC 做得很好。我们刚刚注意到，对于指向较大结构的小对象，GC 似乎没有足够快地清理对象，尤其是当 VM 处于 CPU 负载下时。此外，`System.gc()`这只是帮助安排终结器线程做更多工作的提示。过于频繁地调用它会导致显着的性能下降。

# css - Photoshop 人的 CSS 文本向导/样式库

> ID：758816
> 
> 赞同：0
> 
> 时间：2009-04-17T02:55:12.473
> 
> 标签：css

我正在寻找一个“一站式”解决方案/工具，让一个对 CSS 一无所知的 Photoshop 人员可以选择可以作为 CSS 制作的字体和样式。

我正在寻找与“ [CSS 字体和文本样式向导](http://www.somacon.com/p334.php)”非常相似的东西，但这也将允许更改颜色、背景，对“Photoshop 人”友好，并且最好具有内置样式。

有没有更好的工具？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T03:58:01.370

您可以从 oh-so-limited 但[网络安全的字体列表](http://www.ampsoft.net/webdesign-l/WindowsMacFonts.html)和标准的 CSS[文本装饰](http://www.w3schools.com/Css/pr_text_text-decoration.asp)开始。然后继续讨论 CSS[盒子模型](http://redmelon.net/tstme/box_model/)。你最好学习如何“真正”做到这一点，而不是依赖工具

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T09:40:31.110

这应该符合要求：[http ://www.typetester.org/](http://www.typetester.org/)

生成 CSS 样式的链接有点难找 - 它就在示例文本框的右侧

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T04:10:50.887

也许[http://www.blueprintcss.org/](http://www.blueprintcss.org/)，它不是一个向导，它是一个包含许多预定义值的代码库。

如果他对css一无所知，我认为他最好有一个一致的基础，如蓝图或[http://960.gs](http://960.gs)，并在w3schools文档和一些向导的帮助下只覆盖他需要的排版和其他部分你提到的一个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T05:10:02.323

听起来您想要 Microsoft Frontpage 或 Adob​​e Dreamweaver 之类的东西。仅为文本生成 CSS 样式对于成熟的应用程序来说是一个非常狭窄的问题域。除了一些在线脚本之外，您不太可能找到任何设计范围如此有限的程序。

正如 Diodeus 所说，任何对网页设计感兴趣的人都应该学习一些基本的 CSS。如果 Myspace 上的 13 岁孩子能做到，那么“Photoshop 小伙子”也能做到。否则，只需获得一个所见即所得的编辑器。这就是他们的目的。

但老实说，样式文本所涉及的 CSS 非常简单和基本，如果这就是您想做的*全部*，那么几乎不值得购买（甚至安装）HTML 编辑器。您可能需要知道 10 个常用标签（如果有的话），它们都具有与文本外观/格式相关的相同 15-20 个属性。

网络上充斥着针对各种编程熟练程度的 CSS/HTML 在线指南和教程。任何花 2 周时间阅读/关注它们的人都应该能够了解您正在谈论的所有内容，然后是一些。

# python - MySQLdb连接问题

> ID：758819
> 
> 赞同：16
> 
> 时间：2009-04-17T02:55:57.307
> 
> 标签：python, mysql, connection

我在使用 MySQLdb 模块时遇到问题。

```
db = MySQLdb.connect(
    host = 'localhost', 
    user = 'root', 
    passwd = '', 
    db = 'testdb', 
    port = 3000) 
```

（我正在使用自定义端口）

我得到的错误是：

```
错误 2002：无法通过套接字 '/var/lib/mysql/mysql.sock' 连接到本地 MySQL 服务器 (2)
```

这没有多大意义，因为这是 my.conf 中设置的默认连接..就好像它忽略了我提供的连接信息..

mysql服务器肯定在那里：

```
[root@baster ~]# mysql -uroot -p -P3000
输入密码：
欢迎使用 MySQL 监视器。命令以 ; 结尾 或\g。
您的 MySQL 连接 ID 是 19
服务器版本：5.0.77 源码分发

输入“帮助”；或 '\h' 寻求帮助。键入 '\c' 以清除缓冲区。

mysql> 使用测试数据库；
数据库已更改
mysql>

```

我直接从python提示符尝试：

```
>>> db = MySQLdb.connect(user='root', passwd='', port=3000, host='localhost', db='pyneoform')
回溯（最近一次通话最后）：
文件“”，第 1 行，在
Connect 中的文件“/usr/lib64/python2.5/site-packages/MySQLdb/__init__.py”，第 74 行
返回连接（*args，**kwargs）
文件“/usr/lib64/python2.5/site-packages/MySQLdb/connections.py”，第 169 行，在 __init__
super(Connection, self).__init__(*args, **kwargs2)
_mysql_exceptions.OperationalError: (2002, "Can't connect to local MySQL server through socket '/var/lib/mysql/mysql.sock' (2)")
>>>

```

我很困惑... ：（

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2011-06-26T05:57:38.707

更改`localhost`为`127.0.0.1`使用以下方法解决了我的问题`MySQLdb`：

```
db = MySQLdb.connect(
    host = '127.0.0.1', 
    user = 'root', 
    passwd = '', 
    db = 'testdb', 
    port = 3000) 
```

Using`127.0.0.1`强制客户端使用 TCP/IP，以便侦听 TCP 端口的服务器可以选择它。如果`host`指定为`localhost`，将使用 Unix 套接字或管道。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-07T12:41:01.107

添加`unix_socket='path_to_socket'`where`path_to_socket`应该是 MySQL 套接字的路径，例如`/var/run/mysqld/mysqld2.sock`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T03:19:03.913

确保 mysql 服务器正在侦听 tcp 连接，您可以使用 netstat -nlp（在 *nix 中）来执行此操作。这是您尝试建立的连接类型，出于安全原因，默认情况下 db 通常不会在网络上侦听。此外，在使用 mysql 命令时尝试指定 --host=localhost，除非您另有指定，否则这也会尝试通过 unix 套接字连接。如果 mysql**未**配置为侦听 tcp 连接，该命令也会失败。

这是[mysql 5.1 手册](http://dev.mysql.com/doc/refman/5.1/en/can-not-connect-to-server.html)中有关 unix 套接字和故障排除连接的相关部分。请注意，描述的错误（2002）与您得到的错误相同。

或者，检查您正在使用的模块是否具有通过 unix 套接字连接的选项（如 David 建议的那样）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-07-14T22:58:58.357

我遇到了这个问题，unix 套接字文件在其他地方，python 试图连接到一个不存在的套接字。一旦使用 unix_socket 选项纠正了这个问题，它就起作用了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-01-25T01:26:52.473

当主机是“localhost”时，Mysql 使用套接字，当主机是其他任何东西时，Mysql 使用 tcp/ip。默认情况下，Mysql 将同时监听两者——您可以在 my.cnf 文件中禁用套接字或网络（有关详细信息，请参阅 mysql.com）。

在您的情况下，忘记端口 = 3000，mysql 客户端库没有注意到它，因为您使用的是 localhost 并在 unix_socket ='path_to_socket' 中指定套接字。

如果您决定将此脚本移动到另一台计算机上，则需要更改此连接字符串以使用实际主机名或 IP 地址，然后您可以松开 unix_socket 并恢复端口。mysql 的默认端口是 3306 - 您不需要指定该端口，但如果这是您使用的端口，则需要指定 3000。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-03T23:19:53.017

据我所知，python 连接器只能通过 Internet 套接字连接到 mysql：不支持 unix 套接字（命令行客户端的默认值）。

在 CLI 客户端中，当您说“-h localhost”时，它实际上将 localhost 解释为“哦，localhost？我将只连接到 unix 套接字”，而不是 Internet localhost 套接字。

即，mysql CLI 客户端正在做一些神奇的事情，而 Python 连接器正在做一些“一致但有限制”的事情。

选择你的毒药。（双关语不是故意的；））

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-04-17T03:07:36.157

也许尝试将关键字参数添加`unix_socket = None`到`connect()`？

# oracle - 在经典的 asp 应用程序中改造记录级访问限制

> ID：758823
> 
> 赞同：1
> 
> 时间：2009-04-17T02:57:12.610
> 
> 标签：oracle, security, asp-classic

就像标题所说的那样，我被要求为改造现有的 asp 应用程序提供一个估算值。

当前的安全机制控制对应用程序不同部分的访问（页面级限制），但没有将单个记录标记为受限的机制。为用户分配权限（使用现有的自定义访问管理代码）没有问题，但执行权限是另一回事 - 每个 asp 页面都嵌入了 sql - 没有使用存储的过程、对象等。

是修改每个表和查询的唯一解决方案，还是有更好的方法？欢迎任何指点、建议或祈祷。

这是经典的 asp，在 IIS6 上运行，针对 oracle 数据库。

更新：这是一个用户场景。

我们有用户、经理、主管和副总裁。经理可以看到向他们报告的用户创建的数据，但不能看到向其他经理报告的用户。用户无法查看任何管理员创建的数据。董事也是如此——他们可以向下看，但他们的报告不能向上看。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T10:09:16.727

这听起来像是实施行级安全性的理想时机。Oracle 有一个包[DBMS_RLS](http://download.oracle.com/docs/cd/B19306_01/network.102/b14266/apdvcntx.htm#i1007410)，它允许您定义可应用于一个或多个表的任意访问策略，以限制允许特定用户查看哪些行。从概念上讲，当用户在受保护的表上发出没有过滤器的查询时，即

```
SELECT *
  FROM my_table 
```

Oracle 自动且透明地插入由您的安全策略定义的 WHERE 子句，该子句限制结果集。您不需要对应用程序正在执行的 SQL 进行任何更改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T04:53:56.900

假设您需要最大粒度，能够将每一行“授予”任何用户，那么您有一个多对多关系，是吗？

所以应用以下模式：

添加用户表。

然后，对于*每个*受限表，如下：

*   将其重命名为 tablename + "_base"。

*   创建一个多对多表，将该表的 id 与用户 id 相关联，称为 tablename + "allowed_user"。

*   创建一个名为 table name 的视图，该视图将 tablename_base 连接到 table_name_allowed_user，其中 select* from tablename_base 和 user_id from tablename_allowed_user。此视图应满足 Oracle 的要求，即“固有可更新”。

现在是困难的部分。您需要在每个查询中添加“and user_id = $user_id”。查找您用来进行查询的各种函数。将这些函数包装在从会话中获取用户 ID 并添加该谓词的函数中。

一种可行的方法是读取选择字符串，找到所有的“where”（对于子查询可能不止一个），然后将其替换为“where (user = $user) 和”。对于没有 where 的查询，您需要在任何“group by”或“order by”之前插入它。这是脆弱的，所以很明显你会测试它是否适用于所有页面（你有一个对所有页面的自动测试，对吧？），并添加黑客来覆盖特殊情况。

“更新”语句不必更改；“inserts”可能会将两者都插入到视图中，然后使用插入用户的 id 对表的“allow_user”表进行单独的插入，以自动授予插入用户对他插入的内容的访问权限。

如果您的用户数量更有限，或者您正在限制用户类型，您可以采用以用户或类型命名的多个视图的策略；然后你会用适当的视图替换查询中的表名。

# vb.net - 数据表比较行

> ID：758827
> 
> 赞同：0
> 
> 时间：2009-04-17T02:58:34.417
> 
> 标签：vb.net, datatable

我有一个数据表对象，它是从 Web 服务填充的。

显然，Web 服务只是将所有内容（数据）都返回给我。进入我的数据表的数据如下所示：

```
Dept      Code    Value
Science   ABC     5
Science   ABC     6
Science   DEF     7
Math      ABC     3
Math      DEF     9
English   ABC     2
English   DEF     3
English   DEF     4
English   DEF     5 
```

现在，我想创建一个数据表来计算（和求和）/消除数据表中的值，以便新的数据表具有如下数据：

```
Dept      Code    Value
Science   ABC     11
Science   DEF     7
Math      ABC     3
Math      DEF     9
English   ABC     2
English   DEF     12 
```

请注意，我只能修改数据表。

谁能帮我？请VB.Net。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T03:22:37.540

一个简单的摘要查询将为您提供所需的内容：

```
SELECT Dept, Code, SUM(Value) sum_value FROM datatable GROUP BY Dept, Code 
```

您还可以使用 that 创建视图`SQL definition`，因此您可以像查询表一样查询视图。如果您开始获取如此多的数据以致于查询速度很慢，则您需要将结果存储在一个永久表中 - 但对于中等数量的数据，这应该可以正常工作。

# windows - USB HDD 中内容的哪组访问权限将确保 Windows 中的可移植性？

> ID：758831
> 
> 赞同：0
> 
> 时间：2009-04-17T03:01:08.200
> 
> 标签：windows, permissions, administration

我的便携式 HDD 上有要在 2 台或多台计算机之间共享的内容，但没有一台计算机连接到域（不存在）。我想以这样一种方式授予内容权限，即无论我将 HDD 连接到哪台计算机，也不管使用哪个用户帐户设置权限，我的所有计算机的权限都相同。

例如，我希望内置管理员组（SID：S-1-5-32-544）能够完全控制便携式 HDD 上的文件，无论它连接到什么计算机（我知道这构成一个很大的安全漏洞，但只要驱动器不被盗，我就可以接受。无论如何，一旦攻击者对驱动器进行物理访问，所有的赌注都没有了。）。

我要解决的问题是：我将硬盘连接到计算机 1，设置所有权限，断开连接。然后我将 HDD 连接到 computer2，突然权限不适合这台计算机上的用户，因为 SID 不同（在权限和内容所有权方面）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T03:51:05.727

如果您希望管理员组拥有完全控制权，只需按此方式设置即可。在 Windows XP Pro 或在属性中为您提供安全选项卡的其他系统中，使用它。在驱动器的安全属性中，添加管理员（如果还没有的话），并在管理员的权限中给予完全控制并启用所有继承。您只需在一台机器上进行设置，然后其他基于 NT 的 Windows PC 将遵循这些设置。

如果您找不到用于该设置的 Pro 系统，那么您将不得不学习 cacls 命令行。幸运的是，您仍然只需要执行一次。哎呀。你必须做 n 次，其中第一次 (n-1) 次是各种错误，但你只需要做对一次。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T03:34:42.347

您为 HDD 选择的权限方案取决于您格式化驱动器时使用的文件系统。不同的文件系统以不同的方式指定权限，并且必须分别对待。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T03:59:46.610

你为什么要使用权限？如果有人得到驱动器，那么他们就可以访问。相反，只需使用类似 truecrypt 的东西来保护所有内容，并授予每个人对 truecrypt 卷中所有内容的权限。

# tfs - TFS 2008 构建测试

> ID：758844
> 
> 赞同：-2
> 
> 时间：2009-04-17T03:07:52.537
> 
> 标签：tfs

这是我第一次进行任何类型的构建。不幸的是，我们使用的是 TFS 2008（我更喜欢 Subversion 的整体使用，因为大多数优秀的开发人员都知道它功能强大且易于使用）。但是无论如何，当您只有一个开发服务器而没有暂存服务器时，如何测试构建？我想通过测试网站来测试以确保构建在服务器端和客户端都有效。您是否可以将您的开发服务器用作临时服务器，以便当您针对您的产品环境运行构建时，不会有任何意外？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T09:57:01.693

只需设置要部署的测试（这在您的环境中意味着什么）并运行测试即可。

# c - C中的三元（条件）运算符

> ID：758849
> 
> 赞同：62
> 
> 时间：2009-04-17T03:09:40.520
> 
> 标签：c, operators, ternary-operator, conditional-operator

条件运算符需要什么？在功能上它是多余的，因为它实现了一个 if-else 结构。如果条件运算符比等效的 if-else 赋值更有效，为什么编译器不能更有效地解释 if-else？

* * *

## 回答 #1

> 赞同：158
> 
> 时间：2009-04-17T03:14:21.257

在 C 中，它的真正用处在于它是一个*表达式*而不是一个语句。也就是说，您可以将它放在语句的右侧 (RHS)。所以你可以更简洁地写一些东西。

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2009-04-17T03:29:58.320

给出的其他一些答案很棒。但令我惊讶的是，没有人提到它可以用来以`const`一种紧凑的方式帮助强制执行正确性。

像这样的东西：

```
const int n = (x != 0) ? 10 : 20; 
```

所以基本上`n`是 a **`const`**，其初始值取决于条件语句。最简单的替代方法是制作`n`not a `const`，这将允许普通人`if`对其进行初始化。但如果你想这样`const`，普通的就做不到`if`。您可以做的最好的替代品是使用这样的辅助函数：

```
int f(int x) {
    if(x != 0) { return 10; } else { return 20; }
}

const int n = f(x); 
```

但是三元 if 版本要紧凑得多，并且可以说更具可读性。

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2009-04-17T03:10:40.940

三元运算符是语法和可读性的便利，而不是性能捷径。对于不同复杂度的条件，人们对它的优点存在分歧，但对于简短的条件，使用单行表达式可能很有用。

此外，由于它是一个表达式，正如[Charlie Martin 所写](https://stackoverflow.com/a/758871/75170)，这意味着它可以出现在 C 语言语句的右侧。这对于简洁是有价值的。

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2009-04-17T03:22:57.820

这对于代码混淆至关重要，如下所示：

```
Look->       See?!

No
:(
Oh, well
); 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-04-17T03:11:21.657

紧凑性和将 if-then-else 构造内联到表达式中的能力。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-04-17T03:13:12.960

C 中有很多东西在技术上是不需要的，因为它们可以或多或少地在其他东西方面很容易实现。这是一个不完整的列表：

1.  尽管
2.  为了
3.  职能
4.  结构

想象一下，如果没有这些，您的代码会是什么样子，您可能会找到答案。三元运算符是“语法糖”的一种形式，如果使用得当，可以更轻松地编写和理解代码。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-04-17T03:15:47.667

有时，三元运算符是完成工作的最佳方式。特别是当您希望三元的结果是左值时。

这不是一个很好的例子，但我在更好的东西上画了一个空白。有一件事是确定的，当你真正需要使用三元时并不经常，尽管我仍然使用它很多。

```
const char* appTitle  = amDebugging ? "DEBUG App 1.0" : "App v 1.0"; 
```

我要警告的一件事是将三元组串在一起。它们在维护时成为一个真正的
问题：

```
int myVal = aIsTrue ? aVal : bIsTrue ? bVal : cIsTrue ? cVal : dVal; 
```

**编辑**：这是一个可能更好的例子。您可以使用三元运算符来分配引用和常量值，否则您需要编写一个函数来处理它：

```
int getMyValue()
{
  if( myCondition )
    return 42;
  else
    return 314;
}

const int myValue = getMyValue(); 
```

...可能变成：

```
const int myValue = myCondition ? 42 : 314; 
```

哪个更好是一个有争议的问题，我将选择不辩论。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-04-17T04:58:01.773

由于还没有人提到这一点，获得智能`printf`语句的唯一方法是使用三元运算符：

```
printf("%d item%s", count, count > 1 ? "s\n" : "\n"); 
```

警告：当您从 C 迁移到 C++ 时，运算符优先级存在一些差异，并且可能会对由此产生的细微错误感到惊讶。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-05-01T22:07:38.393

三元运算符是一个表达式，而不是一个语句，这一事实允许它在宏扩展中用于用作表达式的一部分的类似函数的宏。const 可能不是原始 C 的一部分，但宏预处理器可以追溯到很久以前。

我见过它使用的一个地方是在一个数组包中，它使用宏来进行边界检查数组访问。检查引用的语法类似于`aref(arrayname, type, index)`，其中 arrayname 实际上是指向结构的指针，该结构包括数组边界和数据的无符号字符数组，类型是数据的实际类型，索引是索引。这个扩展非常麻烦（我不会从记忆中进行），但它使用了一些三元运算符来进行边界检查。

由于需要返回对象的多态性，因此您不能将其作为 C 中的函数调用来执行。所以需要一个宏来在表达式中进行类型转换。在 C++ 中，您可以将其作为模板化的重载函数调用（可能用于 operator[]），但 C 没有这样的功能。

编辑：这是我正在谈论的示例，来自伯克利 CAD 阵列包（glu 1.4 版）。array_fetch 用法的文档是：

```
type
array_fetch(type, array, position)
typeof type;
array_t *array;
int position; 
```

> 从数组中获取一个元素。尝试在数组边界之外进行引用时会发生运行时错误。没有类型检查给定位置的值实际上是取消引用数组时使用的类型。

这是array_fetch的宏定义（注意使用三元运算符和逗号排序运算符以正确的顺序执行所有具有正确值的子表达式作为单个表达式的一部分）：

```
#define array_fetch(type, a, i)         \
(array_global_index = (i),              \
  (array_global_index >= (a)->num) ? array_abort((a),1) : 0,\
  *((type *) ((a)->space + array_global_index * (a)->obj_size))) 
```

array_insert 的扩展（如果需要，它会增长数组，如 C++ 向量）甚至更复杂，涉及多个嵌套的三元运算符。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-04-17T03:12:08.377

它是语法糖，是仅包含一个语句的简短 if/else 块的便捷简写。从功能上讲，两种结构的性能应该相同。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-04-22T15:40:48.007

就像 dwn 说的，在复杂处理器兴起期间，性能是它的好处之一，MSDN 博客[非经典处理器行为：如何做某事可以比不做更快](https://blogs.msdn.microsoft.com/oldnewthing/20140613-00/?p=743)给出了一个例子，它清楚地说明了三元（条件）运算符和if/else 语句。

给出以下代码：

```
#include <windows.h>
#include <stdlib.h>
#include <stdlib.h>
#include <stdio.h>

int array[10000];

int countthem(int boundary)
{
 int count = 0;
 for (int i = 0; i < 10000; i++) {
  if (array[i] < boundary) count++;
 }
 return count;
}

int __cdecl wmain(int, wchar_t **)
{
 for (int i = 0; i < 10000; i++) array[i] = rand() % 10;

 for (int boundary = 0; boundary <= 10; boundary++) {
  LARGE_INTEGER liStart, liEnd;
  QueryPerformanceCounter(&liStart);

  int count = 0;
  for (int iterations = 0; iterations < 100; iterations++) {
   count += countthem(boundary);
  }

  QueryPerformanceCounter(&liEnd);
  printf("count=%7d, time = %I64d\n",
         count, liEnd.QuadPart - liStart.QuadPart);
 }
 return 0;
} 
```

不同边界的成本有很大不同和奇怪（参见原始材料）。而如果改变：

```
 if (array[i] < boundary) count++; 
```

到

```
 count += (array[i] < boundary) ? 1 : 0; 
```

执行时间现在与边界值无关，因为：

> 优化器能够从三元表达式中删除分支。

但在我的桌面 intel i5 cpu/windows 10/vs2015 上，我的测试结果与 msdn 博客完全不同。

**使用调试模式时**，if/else 成本：

```
count=      0, time = 6434
count= 100000, time = 7652
count= 200800, time = 10124
count= 300200, time = 12820
count= 403100, time = 15566
count= 497400, time = 16911
count= 602900, time = 15999
count= 700700, time = 12997
count= 797500, time = 11465
count= 902500, time = 7619
count=1000000, time = 6429 
```

和三元运营商成本：

```
count=      0, time = 7045
count= 100000, time = 10194
count= 200800, time = 12080
count= 300200, time = 15007
count= 403100, time = 18519
count= 497400, time = 20957
count= 602900, time = 17851
count= 700700, time = 14593
count= 797500, time = 12390
count= 902500, time = 9283
count=1000000, time = 7020 
```

**使用释放模式时**，if/else 成本：

```
count=      0, time = 7
count= 100000, time = 9
count= 200800, time = 9
count= 300200, time = 9
count= 403100, time = 9
count= 497400, time = 8
count= 602900, time = 7
count= 700700, time = 7
count= 797500, time = 10
count= 902500, time = 7
count=1000000, time = 7 
```

和三元运营商成本：

```
count=      0, time = 16
count= 100000, time = 17
count= 200800, time = 18
count= 300200, time = 16
count= 403100, time = 22
count= 497400, time = 16
count= 602900, time = 16
count= 700700, time = 15
count= 797500, time = 15
count= 902500, time = 16
count=1000000, time = 16 
```

三元运算符比我机器上的 if/else 语句慢！

因此根据不同的编译器优化技术，内部运算符和 if/else 的行为可能会有很大不同。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-01-25T14:07:02.737

*   C 中一些比较晦涩的运算符之所以存在，仅仅是因为它们允许将各种类似函数的宏实现为返回结果的单个表达式。我想说这是允许`?:`and`,`运算符存在的主要目的，即使它们的功能在其他方面是多余的。

    假设我们希望实现一个类似函数的宏，它返回两个参数中的最大值。然后它将被称为例如：

    ```
    int x = LARGEST(1,2); 
    ```

    将其实现为类似函数的宏的唯一方法是

    ```
    #define LARGEST(x,y) ((x) > (y) ? (x) : (y)) 
    ```

    使用语句是不可能的`if ... else`，因为它不返回结果值。 ^(笔记）)

*   的另一个目的`?:`是在某些情况下它实际上增加了可读性。大多数情况`if...else`下更具可读性，但并非总是如此。以长而重复的 switch 语句为例：

    ```
    switch(something)
    {
      case A: 
        if(x == A)
        {
          array[i] = x;
        }
        else
        {
          array[i] = y;
        }
        break;

      case B: 
        if(x == B)
        {
          array[i] = x;
        }
        else
        {
          array[i] = y;
        }
        break;
      ...
    } 
    ```

    这可以替换为更具可读性

    ```
    switch(something)
    {
      case A: array[i] = (x == A) ? x : y; break;
      case B: array[i] = (x == B) ? x : y; break;
      ...
    } 
    ```

*   请注意，`?:`这*永远不会*产生比`if-else`. 这是困惑的初学者创造的一些奇怪的神话。在优化代码的情况下，提供与绝大多数情况`?:`相同的性能。`if-else`

    如果有的话，`?:`可能会比*慢*`if-else`，因为它带有强制性的隐式类型提升，即使是不会使用的操作数。但`?:`永远不可能比`if-else`.

* * *

^(注意）)现在当然有人会争论并想知道为什么不使用函数。事实上，如果你可以使用一个函数，它*总是*比类似函数的宏更可取。但有时你不能使用函数。例如，假设`x`在上面的示例中是在文件范围内声明的。初始化器必须是一个常量表达式，所以它不能包含函数调用。其他必须使用类似函数的宏的实际示例包括使用`_Generic`“X 宏”进行类型安全编程。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-17T03:15:26.763

三元 = if-else 的简单形式。它主要用于可读性。

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2009-10-24T17:56:30.413

一样

```
if(0)
do();

if(0)
{
do();
} 
```

# exchange-server - 以编程方式向 Exchange 03/07 邮箱添加别名的最简单方法？

> ID：758850
> 
> 赞同：0
> 
> 时间：2009-04-17T03:09:46.447
> 
> 标签：exchange-server, alias

我们目前有一个特定的格式来定义我们的电子邮件地址，基于名称。该系统起源于前一段时间，并开始成为一个障碍。

我们想转向一种新的格式，基于

```
<first name initial><second name initial><last name>@organisation.com 
```

但是，我们不只是想重命名邮箱等，而是选择为所有当前用户保留现有的电子邮件地址，而是为新用户使用新表单。此外，我们希望为所有使用旧格式的邮箱添加一个邮件别名。

谁能建议一种相对直接的方法来通过代码添加这些别名？提取用户的姓名详细信息不是问题，只需将别名添加到邮箱即可。我们目前正在为大多数用户运行 exchange 2003，但正处于 2007 年迁移的边缘，2007 年的奇数用户也是如此（目前两台服务器并排运行）。

我读过所有的 Exchange 2007 管理都应该使用 2007 工具完成，而不是像以前那样使用 Active Directory，所以所有这些都可以通过 Exchange 2007 API 执行，即使对于 2003 年的“旧邮箱”（如在交换）？

基本上我只是在寻找一个好的方向去这里；我从来没有真正为交换做过任何编码。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T05:08:17.770

这是一个 MS KB，描述了通过扩展 MAPI 修改别名。看起来您需要 Exchange Developers Kit 来执行此操作。

[http://support.microsoft.com/kb/183249](http://support.microsoft.com/kb/183249)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T20:04:04.737

我在回答问题后发布此内容，但是您是否有任何理由不只是使用收件人政策？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T23:45:59.933

最后，我发现 Powershell 是迄今为止最简单的方法。这是我最终使用的脚本框架，展示了如何向每个邮箱添加额外的地址：

```
$mailboxes = get-mailbox | sort Name

foreach($mailbox in $mailboxes)
{
    ...
    # Logic for working out the new address
    ...

    $mailbox.EmailAddresses += $newAddress
    $mailbox | set-mailbox
} 
```

为了完整起见，此脚本在新的 Exchange 2007 服务器上运行。我最初担心将地址添加到驻留在旧 2003 服务器上的邮箱中，这不是问题。旧邮箱也已更新。

# windows - 有多少百分比的 Windows 框支持 OpenGL

> ID：758874
> 
> 赞同：4
> 
> 时间：2009-04-17T03:15:45.873
> 
> 标签：windows, opengl, graphics, directx, drivers

我一直在考虑开始一个新的图形项目，我想使用 Java。Java 包含所有相关 GL 功能的包装器，但我想知道有多少人，包括临时用户，实际上安装了不错的 GL 驱动程序。体面，我的意思是有点稳定和相当新（GL 1.5 支持可能会，尽管 2.0 附带的 GLSL 支持会很棒）。我可以使用 DirectX，即使使用 Java，但我非常讨厌它，而且这个项目应该很“有趣”。另外，我喜欢 GL 至少接近跨平台的特性。那么，任何人都知道关于有多少百分比的 Windows 用户拥有运行 GL 应用程序的驱动程序的任何非虚构统计数据？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-17T03:40:20.650

[Steam 硬件调查](http://store.steampowered.com/hwsurvey/)可能是了解游戏玩家拥有的最佳和最详细的信息来源。一般人群的准确统计数据将更难获得。相反，您应该根据您想要图形硬件的最新程度来看待这一点。例如，从 R300 系列 (Radeon 9550+) 开始的任何 ATI 芯片都支持 OpenGL 2.0。在 NVidia 方面，任何 GeForce 6000+ 系列芯片都将支持 OpenGL 2.0，其前身 FX 系列几乎支持 OpenGL 2.0。R300 系列和 FX 系列都是在 2002 年推出的，因此如果您知道目标市场的哪一部分正在使用 2003 年或之后的 PC，您就会对 OpenGL 2.0 支持在具有独立显卡。

如果您想支持集成显卡（这是市场上最大的部分，但对于那些认真对待任何类型的显卡的人来说并不是特别常见），您的用户将至少需要一个 GMA X3000 来实现 OpenGL 2.0 功能的硬件加速，这意味着他们的系统必须是 2006 年或更晚的版本。

如果您对其他操作系统的支持感兴趣，任何英特尔 Mac 都将支持 OpenGL 2.0 以及软件回退和硬件加速，只要该芯片在 Windows 下支持它。在 Linux 上，任何具有 Mesa 7 或更高版本（2007 年 6 月或更高版本）的系统都将支持 OpenGL 2.0 软件渲染。硬件加速不太可靠，但是 R300 和更新版本的 ATI 芯片有不错的开源驱动程序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T03:18:41.293

每个现代视频卡都支持 OpenGL……您不应该质疑有多少 Windows 机器具有 Java 运行时吗？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-17T03:26:48.903

我记得，Windows XP 提供了开箱即用的 1.1 支持。Vista 将此升级到 1.5。因此，您至少可以将这些视为绝对最小值。

除此之外，几乎所有供应商的 GPU 驱动程序都*至少*为您提供2.0 支持。

但如果我是你，我会重新考虑 DirectX。我不知道你讨厌什么，但它确实有一些优点。工具支持要好得多（即，有可用的工具。PIX 简直令人惊叹），API 是最新的，设计得很好，而不是一个委员会在 20 多年的交叉工作中积累的经验，如果无论如何，这仅限于Windows，跨平台并不重要。（另一方面，当然，如果您确实需要跨平台功能，那么 DirectX 还能提供什么并不重要，它不会提供那个杀手级功能）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T04:29:20.127

几乎每个人都有某种形式的 OpenGL 支持。经验表明，在处理 ATI 尤其是 Intel 硬件时，所涉及的实际驱动程序可能非常糟糕，但它至少*可以工作*，尽管存在上述错误。如果不出意外，Windows 可以回退到其内置的 1.1（XP 和更早版本）或 1.4（Vista 和更高版本）实现。它不会很好地工作，但它会工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T06:10:44.537

Windows XP 带有 OpenGL 1.1（虽然速度很慢）。Windows Vista 还附带 OpenGL 1.1（但对于某些特殊应用程序，它在 D3D 之上具有 OpenGL 1.4 模拟器）。

当您在 Windows 上安装图形驱动程序时，它会安装更多 OpenGL 版本。OpenGL 1.5 大致是支持“DX9 着色器模型 2.0”的硬件。有多少机器有这种硬件取决于你的目标市场。在传统/硬核游戏领域，几乎所有游戏都会（[参见 Steam 硬件调查](http://store.steampowered.com/hwsurvey/)）。

在更多休闲/小型游戏空间中，相当多的机器具有更旧的硬件（参见[Unity 硬件统计](http://unity3d.com/webplayer/hwstats/pages/web-2009Q1-shadergen.html)- 2009 年第一季度几乎 30% 的机器比“DX9 着色器模型 2.0”更旧）。此外，该领域的许多机器都没有自定义驱动程序。他们使用 Windows 中附带的任何显示驱动程序（不提供超过 GL 1.1 的任何内容）。同样，请参阅[Unity Hardware Stats](http://unity3d.com/webplayer/hwstats/pages/web-2009Q1-gfxdriver.html) - 最流行的驱动程序版本是 Windows 附带的驱动程序版本。

Stability wise, I'd strongly suggest using D3D9 on Windows instead of OpenGL. Driver quality is *much* better for D3D9 (less crashes inside drivers, less incorrect rendering, better performance, ...).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T03:19:28.750

我想说所有 Windows 用户都对 OpenGL 有*一些*支持。最新版本通常是为 Vista 用户、游戏玩家和开发人员保留的。

# c# - 实体框架为映射到视图的实体生成的 SQL

> ID：758876
> 
> 赞同：2
> 
> 时间：2009-04-17T03:16:06.980
> 
> 标签：c#, sql-server, entity-framework, ado.net

我已将 EDM 实体映射到数据库（SQL Server 2005）视图。该实体是一个简单的电影实体，它具有 ID、Name 和 DateInserted 属性，对应于具有以下定义的视图：

> 从 dbo.t_Movie WITH (NOLOCK)中选择 iMovieID、vchName、dtInsertDate

表 t_Movie 具有以下定义：

> CREATE TABLE [dbo].[t_Movie](
> [iMovieID] [int] IDENTITY(1,1) NOT NULL,
> [vchName] varchar NOT NULL,
> [dtInsertDate] [datetime] NULL,
> CONSTRAINT [PK_t_Movie] 主键
> 集群 ([iMovieID ] ASC
> )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF,
> ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
> ) ON [PRIMARY]
> GO

当我像这样编写一个简单的 Linq to Entities Query 时：

```
 var q = from m in context.v_Movie where m.vchName.Contains("Ocean") select m;
            foreach (var movie in q)
            {
                Console.WriteLine("{0}:{1}",movie.iMovieID, movie.vchName);
            } 
```

以下是分析器捕获的 Entity 框架生成的 SQL：

> 选择
> [Extent1].[iMovieID] 作为 [iMovieID]、
> [Extent1].[vchName] 作为 [vchName]、
> [Extent1].[dtInsertDate] 作为 [dtInsertDate]
> FROM（选择
> [v_Movie].[iMovieID] 作为 [iMovieID] ,
> [v_Movie].[vchName] AS [vchName],
> [v_Movie].[dtInsertDate] AS [dtInsertDate]
> FROM [dbo].[v_Movie] AS [v_Movie]) AS [Extent1]
> WHERE (CAST(CHARINDEX(N'Ocean ', [Extent1].[vchName]) AS int)) > 0

DBA 担心内部 SELECT：

> 选择
> [v_Movie].[iMovieID] AS [iMovieID],
> [v_Movie].[vchName] AS [vchName],
> [v_Movie].[dtInsertDate] AS [dtInsertDate]
> FROM [dbo].[v_Movie] AS [v_Movie]) AS随着表的增长， [Extent1]
> 
> 会随着时间的推移导致一些严重的性能问题，因为它将视图中的所有行都选择到一个临时表（[Extent1]）中，然后外部 SELECT 正在从这个临时表中进行选择。

EF 需要执行此操作的任何特定原因，是否有任何原因无法生成以下 SQL：

> 选择
> [v_Movie].[iMovieID] AS [iMovieID],
> [v_Movie].[vchName] AS [vchName],
> [v_Movie].[dtInsertDate] AS [dtInsertDate]
> 从 [dbo].[v_Movie] AS [v_Movie]
> WHERE ( CAST(CHARINDEX(N'Ocean', [Extent1].[vchName]) AS int)) > 0

我使用以下 SQL 用 100,000 条记录填充了表，但在执行 LINQ 查询时没有注意到任何性能下降。Profiler 显示查询运行不到一秒钟：

> BEGIN
> 声明 @counter int
> set @counter = 0
> while @counter < 100000
> begin
> set @counter = @counter + 1
> 
> INSERT INTO t_Movie(vchName) values('Movie'+CONVERT(varchar,@counter))
> end
> END

这是一个有效的担忧吗？

PS -

> (CAST(CHARINDEX(N'Ocean', [Extent1].[vchName]) AS int)) 在这里不是问题，因为我使用的 LINQ to Entities 查询只是为了说明。

任何见解将不胜感激

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-19T02:30:17.197

使用 XML 编辑器查看您的 .EDMX 文件。您会在那里找到电影视图的某些内容，其中包含视图的选择语句。删除 select 语句并使视图 XML 的其余部分看起来更像您的表。你得到这个内部选择是因为 EF 天真地认为你试图将列映射到视图中的不同名称而不是默认名称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-14T23:38:36.533

我从 MSDN 论坛得到了这个答案，这很有意义：

[实体框架生成的 SQL](http://social.msdn.microsoft.com/Forums/en-US/adodotnetentityframework/thread/fab85924-1efb-4ea2-8cd2-06e1720fed85)

# json - ASP.net MVC 返回 JSONP

> ID：758879
> 
> 赞同：72
> 
> 时间：2009-04-17T03:18:42.713
> 
> 标签：json, asp.net-mvc, jsonp

我希望跨域返回一些 JSON，并且我知道这样做的方法是通过 JSONP 而不是纯 JSON。
我正在使用 ASP.net MVC，所以我正在考虑扩展`JsonResult`类型，然后扩展 Controller，以便它还实现了 Jsonp 方法。这是最好的方法还是有一个可能更好
的内置方法？`ActionResult`

* * *

**解决方案**：我继续这样做。仅供参考，我添加了一个新结果：

```
public class JsonpResult : System.Web.Mvc.JsonResult
{
    public override void ExecuteResult(ControllerContext context)
    {
        if (context == null)
        {
            throw new ArgumentNullException("context");
        }

        HttpResponseBase response = context.HttpContext.Response;

        if (!String.IsNullOrEmpty(ContentType))
        {
            response.ContentType = ContentType;
        }
        else
        {
            response.ContentType = "application/javascript";
        }
        if (ContentEncoding != null)
        {
            response.ContentEncoding = ContentEncoding;
        }
        if (Data != null)
        {
            // The JavaScriptSerializer type was marked as obsolete prior to .NET Framework 3.5 SP1
        #pragma warning disable 0618
            HttpRequestBase request = context.HttpContext.Request;

            JavaScriptSerializer serializer = new JavaScriptSerializer();
            response.Write(request.Params["jsoncallback"] + "(" + serializer.Serialize(Data) + ")");
        #pragma warning restore 0618
        }
    }
} 
```

以及我所有控制器的超类的几种方法：

```
protected internal JsonpResult Jsonp(object data)
{
    return Jsonp(data, null /* contentType */);
}

protected internal JsonpResult Jsonp(object data, string contentType)
{
    return Jsonp(data, contentType, null);
}

protected internal virtual JsonpResult Jsonp(object data, string contentType, Encoding contentEncoding)
{
    return new JsonpResult
    {
        Data = data,
        ContentType = contentType,
        ContentEncoding = contentEncoding
    };
} 
```

奇迹般有效。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2013-03-20T01:13:03.327

这是一个简单的解决方案，如果您不想定义操作过滤器

使用 jQuery 的客户端代码：

```
 $.ajax("http://www.myserver.com/Home/JsonpCall", { dataType: "jsonp" }).done(function (result) {}); 
```

MVC 控制器动作。通过 JavaScript 代码执行查询字符串提供的回调函数返回内容结果。还为响应设置 JavaScript MIME 类型。

```
 public ContentResult JsonpCall(string callback)
 {
      return Content(String.Format("{0}({1});",
          callback, 
          new JavaScriptSerializer().Serialize(new { a = 1 })),    
          "application/javascript");
 } 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-12-14T17:50:23.813

我没有使用 Jsonp() 方法对我的控制器进行子类化，而是选择了扩展方法路线，因为它对我来说感觉更干净。JsonpResult 的好处是您可以像测试 JsonResult 一样测试它。

我做了：

```
public static class JsonResultExtensions
{
    public static JsonpResult ToJsonp(this JsonResult json)
    {
        return new JsonpResult { ContentEncoding = json.ContentEncoding, ContentType = json.ContentType, Data = json.Data, JsonRequestBehavior = json.JsonRequestBehavior};
    }
} 
```

这样您就不必担心创建所有不同的 Jsonp() 重载，只需将您的 JsonResult 转换为 Jsonp 即可。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-11-08T14:51:19.107

[Ranju 的博文](http://blogorama.nerdworks.in/entry-EnablingJSONPcallsonASPNETMVC.aspx)（又名“我找到的这篇博文”）非常棒，阅读它可以让您进一步了解下面的解决方案，以便您的控制器可以在同一个控制器操作中优雅地处理同域 JSON 和跨域 JSONP 请求，而无需附加代码[在操作中]。

无论如何，对于“给我代码”类型，这里是，以防博客再次消失。

在您的控制器中（此代码段是新的/非博客代码）：

```
[AllowCrossSiteJson]
public ActionResult JsonpTime(string callback)
{
    string msg = DateTime.UtcNow.ToString("o");
    return new JsonpResult
    {
        Data = (new
        {
            time = msg
        })
    };
} 
```

JsonpResult 在 [这篇优秀的博客文章](http://blogorama.nerdworks.in/entry-EnablingJSONPcallsonASPNETMVC.aspx)中找到：

```
/// <summary>
/// Renders result as JSON and also wraps the JSON in a call
/// to the callback function specified in "JsonpResult.Callback".
/// http://blogorama.nerdworks.in/entry-EnablingJSONPcallsonASPNETMVC.aspx
/// </summary>
public class JsonpResult : JsonResult
{
    /// <summary>
    /// Gets or sets the javascript callback function that is
    /// to be invoked in the resulting script output.
    /// </summary>
    /// <value>The callback function name.</value>
    public string Callback { get; set; }

    /// <summary>
    /// Enables processing of the result of an action method by a
    /// custom type that inherits from <see cref="T:System.Web.Mvc.ActionResult"/>.
    /// </summary>
    /// <param name="context">The context within which the
    /// result is executed.</param>
    public override void ExecuteResult(ControllerContext context)
    {
        if (context == null)
            throw new ArgumentNullException("context");

        HttpResponseBase response = context.HttpContext.Response;
        if (!String.IsNullOrEmpty(ContentType))
            response.ContentType = ContentType;
        else
            response.ContentType = "application/javascript";

        if (ContentEncoding != null)
            response.ContentEncoding = ContentEncoding;

        if (Callback == null || Callback.Length == 0)
            Callback = context.HttpContext.Request.QueryString["callback"];

        if (Data != null)
        {
            // The JavaScriptSerializer type was marked as obsolete
            // prior to .NET Framework 3.5 SP1 
#pragma warning disable 0618
            JavaScriptSerializer serializer = new JavaScriptSerializer();
            string ser = serializer.Serialize(Data);
            response.Write(Callback + "(" + ser + ");");
#pragma warning restore 0618
        }
    }
} 
```

**注意：**跟进[@Ranju 和其他人对 OP 的评论](https://stackoverflow.com/questions/758879/asp-net-mvc-returning-jsonp#comment22923963_758879)，我认为值得将 Ranju 博客文章中的“最低限度”功能代码作为社区 wiki 发布。虽然可以肯定地说 Ranju 在他的博客上添加了上述代码和其他代码以供自由使用，但我不会在这里复制他的话。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-07-26T20:10:41.327

对于**ASP.NET Core**，NOT *ASP.NET MVC* 这是针对答案中存在的解决方案的**ASP.NET CORE**
的 定制版本

 **```
public class JsonpResult : JsonResult
{
    public JsonpResult(object value) : base(value)
    {
    }

    public override async Task ExecuteResultAsync(ActionContext context)
    {
        if (context == null)
            throw new ArgumentNullException(nameof(context));

        HttpResponse response = context.HttpContext.Response;

        if (!String.IsNullOrEmpty(ContentType))
            response.ContentType = ContentType;
        else
            response.ContentType = "application/javascript";

        if (Value != null)
        {
            HttpRequest request = context.HttpContext.Request;
            string serializedJson = JsonConvert.SerializeObject(Value);
            string result = $"{request.Query["callback"]}({serializedJson})";
            await response.WriteAsync(result);
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-07-16T08:33:58.720

stimms 和 ranju v 的参考文章都非常有用，并且清楚地说明了情况。

然而，我对在网上找到的 MVC 代码的上下文中使用扩展、子类化感到摸不着头脑。

有两个关键点让我印象深刻：

1.  我从 ActionResult 派生的代码，但在 ExecuteResult 中有一些代码可以返回 XML 或 JSON。
2.  然后，我创建了一个基于泛型的 ActionResult，以确保使用相同的 ExecuteResults，而与我返回的数据类型无关。

因此，将两者结合起来——我不需要进一步的扩展或子类化来添加返回 JSONP 的机制，只需更改我现有的 ExecuteResults。

让我感到困惑的是，我真的在寻找一种方法来派生或扩展 JsonResult，而无需重新编码 ExecuteResult。由于 JSONP 实际上是一个带有前缀和后缀的 JSON 字符串，因此它似乎是一种浪费。然而，下面的 ExecuteResult 使用 respone.write - 所以最安全的更改方法是重新编码 ExecuteResults，因为各种帖子很容易提供！

如果有用的话，我可以发布一些代码，但是这个线程中已经有很多代码了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-08-27T14:15:12.423

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.Web.Script.Serialization;

namespace Template.Web.Helpers
{
    public class JsonpResult : JsonResult
    {
        public JsonpResult(string callbackName)
        {
            CallbackName = callbackName;
        }

        public JsonpResult()
            : this("jsoncallback")
        {
        }

        public string CallbackName { get; set; }

        public override void ExecuteResult(ControllerContext context)
        {
            if (context == null)
            {
                throw new ArgumentNullException("context");
            }

            var request = context.HttpContext.Request;
            var response = context.HttpContext.Response;

            string jsoncallback = ((context.RouteData.Values[CallbackName] as string) ?? request[CallbackName]) ?? CallbackName;

            if (!string.IsNullOrEmpty(jsoncallback))
            {
                if (string.IsNullOrEmpty(base.ContentType))
                {
                    base.ContentType = "application/x-javascript";
                }
                response.Write(string.Format("{0}(", jsoncallback));
            }

            base.ExecuteResult(context);

            if (!string.IsNullOrEmpty(jsoncallback))
            {
                response.Write(")");
            }
        }
    }

    public static class ControllerExtensions
    {
        public static JsonpResult Jsonp(this Controller controller, object data, string callbackName = "callback")
        {
            return new JsonpResult(callbackName)
            {
                Data = data,
                JsonRequestBehavior = JsonRequestBehavior.AllowGet
            };
        }

        public static T DeserializeObject<T>(this Controller controller, string key) where T : class
        {
            var value = controller.HttpContext.Request.QueryString.Get(key);
            if (string.IsNullOrEmpty(value))
            {
                return null;
            }
            JavaScriptSerializer javaScriptSerializer = new JavaScriptSerializer();
            return javaScriptSerializer.Deserialize<T>(value);
        }
    }
}

//Example of using the Jsonp function::
//  1-
public JsonResult Read()
{
    IEnumerable<User> result = context.All();        

    return this.Jsonp(result);
}

//2-
public JsonResult Update()
{
    var models = this.DeserializeObject<IEnumerable<User>>("models");
    if (models != null)
    {
        Update(models); //Update properties & save change in database
    }
    return this.Jsonp(models);
} 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2011-02-09T19:38:52.577

上面的解决方案是一种很好的工作方式，但它应该使用一种新的结果类型进行扩展，而不是使用返回 JsonResult 的方法，您应该编写返回您自己的结果类型的方法

```
public JsonPResult testMethod() {
    // use the other guys code to write a method that returns something
}

public class JsonPResult : JsonResult
{
    public FileUploadJsonResult(JsonResult data) {
        this.Data = data;
    }      

    public override void ExecuteResult(ControllerContext context)
    {
        this.ContentType = "text/html";
        context.HttpContext.Response.Write("<textarea>");
        base.ExecuteResult(context);
        context.HttpContext.Response.Write("</textarea>");
    }
} 
```

# asp.net-mvc - 如何在代码隐藏文件中生成 AntiForgeryToken？

> ID：758880
> 
> 赞同：1
> 
> 时间：2009-04-17T03:18:54.680
> 
> 标签：asp.net-mvc

我有一个重置用户密码的操作。在密码重置后的相同操作中，我想登录用户。我只想使用“RedirectToAction”并将用户名和密码发送到我的登录操作。因为我在那个动作中有逻辑来处理错误等等。

所以我还需要将 AntiForgeryToken 值发送到 SignIn 操作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T03:29:17.617

AntiForgeryToken 仅对 POST 请求有效（GET 请求应该是幂等的……也就是说，不会更改服务器上的状态）。RedirectToAction 执行 HTTP/302 重定向，这会导致 GET 请求。因此，AntiForgeryToken 对 RedirectToAction 毫无意义。

我会重新考虑你想要做什么。

请记住，动作只是控制器上的公共方法，因此您应该能够从任何其他动作中调用一个（并返回其结果）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T03:29:01.830

没有必要这样做，我认为这无论如何都不是一个好主意，因为您会将密码作为响应的一部分传回浏览器。只需使用 FormsAuthentication 创建身份验证 cookie 并将其与响应一起发回。

# sql-server-2005 - 使用 t-sql 计算时间跨度

> ID：758891
> 
> 赞同：49
> 
> 时间：2009-04-17T03:24:14.090
> 
> 标签：sql-server-2005, tsql

给定两个日期/时间：

```
@start_date = '2009-04-15 10:24:00.000'
@end_date = '2009-04-16 19:43:01.000' 
```

是否可以按以下格式计算两个日期之间经过的时间

1天 9小时 19米

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-04-17T03:26:57.360

您可以[将两个日期之间的差异](http://msdn.microsoft.com/en-us/library/ms189794.aspx)设为您想要的任何分辨率（在您的示例中为分钟）：

```
DATEDIFF(minute, @start_date, @end_date) 
```

从那里开始，只需将分钟划分为小时，将小时划分为天，然后修改其余部分。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2011-09-13T15:34:54.683

我知道这个线程较旧，最初的参与者可能不再观看，但我偶然发现了它，并且最近已经编写了一些代码来做一些非常接近 jdiaz 要求的事情。结果以 D:H:M:S 格式呈现为字符串。

第一步是以秒为单位获得时间跨度：

```
DECLARE @ElapsedS INT
SET @ElapsedS = DATEDIFF(second, @start_date, @end_date) 
```

现在创建以下标量函数：

```
CREATE FUNCTION [dbo].[udfTimeSpanFromSeconds]
(
    @Seconds int
)
RETURNS varchar(15)
AS
BEGIN
DECLARE 
    --Variable to hold our result
      @DHMS varchar(15)
    --Integers for doing the math
    , @Days int --Integer days
    , @Hours int --Integer hours
    , @Minutes int --Integer minutes
    --Strings for providing the display
    , @sDays varchar(5) --String days
    , @sHours varchar(2) --String hours
    , @sMinutes varchar(2) --String minutes
    , @sSeconds varchar(2) --String seconds

--Get the values using modulos where appropriate
SET @Hours = @Seconds/3600
SET @Minutes = (@Seconds % 3600) /60
SET @Seconds = (@Seconds % 3600) % 60

--If we have 24 or more hours, split the @Hours value into days and hours
IF @Hours > 23 
BEGIN
    SET @Days = @Hours/24
    SET @Hours = (@Hours % 24)
END
ELSE
BEGIN
    SET @Days = 0
END

--Now render the whole thing as string values for display
SET @sDays = convert(varchar, @Days)
SET @sHours = RIGHT('0' + convert(varchar, @Hours), 2)
SET @sMinutes = RIGHT('0' + convert(varchar, @Minutes), 2)
SET @sSeconds = RIGHT('0' + convert(varchar, @Seconds), 2)

--Concatenate, concatenate, concatenate
SET @DHMS =  @sDays + ':' + @sHours + ':' + @sMinutes + ':' + @sSeconds

RETURN @DHMS

END 
```

现在将您的时间跨度输入到新创建的函数中：

```
SELECT TimeSpan = dbo.udfTimeSpanFromSeconds(@ElapsedS) 
```

应该产生“1:09:19:01”

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2010-08-03T09:31:01.010

```
CONVERT(varchar,(@end_date-@start_date),108) 
```

这将以 HH:MM:SS 的形式提供给您

干杯

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-06-15T00:37:23.553

DATEDIFF 可以返回不直观的值。例如，下面的两个日期相差一秒，但 DATEDIFF 使用下面的参数并解释为其他人在上面解释它返回 1 年：

选择日期（年，'2005-12-31 23:59:59'，'2006-01-01 00:00:00'）

查看 DATEDIFF 的 MSDN 文档以了解其工作原理。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T03:27:11.447

日期差异（日期部分，日期 1，日期 2）；

雷克斯的回答更完整。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-31T15:33:30.677

以下是在查询中格式化 datediff (50d 8h 35m) 的方式：

```
Declare @Date1 as Datetime, @Date2 as Datetime
Set @Date1 = '2005-01-01 08:00:00'
Set @Date2 = '2005-02-20 16:35:30'

Select
CAST(DATEDIFF(Minute,@Date1, @Date2)/60/24 as Varchar(50)) ++ 'd ' ++ 
CAST((DATEDIFF(Minute,@Date1, @Date2)/60)-((DATEDIFF(Minute,@Date1, @Date2)/60/24)*24) as Varchar(50)) ++ 'h ' ++
CAST((DATEDIFF(Minute,@Date1, @Date2)) - (DATEDIFF(HOUR,@Date1, @Date2)*60) as Varchar(50)) ++ 'm' as FormattedDateDiff 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-04-02T07:14:30.667

```
DECLARE @FirstDate DATETIME, @SecondDate DATETIME, @result VARCHAR(MAX)
SELECT @FirstDate = '2017-03-01 09:54:00.637', @SecondDate = GETDATE()

DECLARE @Day INT,@Month INT,@Hour INT, @Minute INT,@TotalSeconds INT,@Year INT
SELECT @TotalSeconds = ABS(DATEDIFF(SECOND,@FirstDate,@SecondDate))

-- Standard values in seconds
DECLARE @YearSeconds INT, @MonthSeconds INT, @DaySeconds INT, @HourSeconds INT, @MinuteSeconds INT

SELECT  @MinuteSeconds = 60
SELECT  @HourSeconds = 60 * @MinuteSeconds 
SELECT  @DaySeconds = 24 * @HourSeconds
SELECT  @MonthSeconds = 30 * @DaySeconds
SELECT  @YearSeconds = 12 * @MonthSeconds

--SELECT @MinuteSeconds AS [Minutes], @HourSeconds AS [Hours], @DaySeconds AS [Day],@MonthSeconds AS [Month],@YearSeconds AS [Year]

IF @TotalSeconds < @MinuteSeconds
BEGIN
    SELECT @result = CAST(@TotalSeconds AS NVARCHAR(20)) + ' seconds ago' 
END
ELSE IF @TotalSeconds < @HourSeconds
BEGIN
    SELECT @result = CAST(ABS(DATEDIFF(MINUTE,@FirstDate,@SecondDate)) AS NVARCHAR(20)) + ' minutes ago' 
END
ELSE IF @TotalSeconds < @DaySeconds
BEGIN
    SELECT @result = CAST(ABS(DATEDIFF(HOUR,@FirstDate,@SecondDate)) AS     NVARCHAR(20)) + ' hours ago' 
END
ELSE IF @TotalSeconds < @MonthSeconds
BEGIN
    SELECT @result = CAST(ABS(DATEDIFF(DAY,@FirstDate,@SecondDate)) AS NVARCHAR(20)) + ' days ago' 
END
ELSE IF @TotalSeconds < @YearSeconds
BEGIN
    SELECT @result = CAST(ABS(DATEDIFF(MONTH,@FirstDate,@SecondDate)) AS NVARCHAR(20)) + ' months ago' 
END
ELSE IF @TotalSeconds > @YearSeconds
BEGIN
    SELECT @result = CAST(ABS(DATEDIFF(YEAR,@FirstDate,@SecondDate)) AS NVARCHAR(20)) + ' year ago' 
END

SELECT @result 
```

# linux - MFC 之类的易于使用的 Linux 工具

> ID：758892
> 
> 赞同：2
> 
> 时间：2009-04-17T03:25:37.800
> 
> 标签：linux, user-interface, visual-c++, mfc

当我在 Windows 中编写测试工具时，我使用 MFC 来创建前端 GUI。这使得 GUI 开发的开发速度非常快，而且我过去一直专注于后端。最近我搬到了基于控制台的 Linux 世界。大多数东西都是基于控制台的。

我的问题：在 Linux 中是否有任何易于使用的 MFC 等价物？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-17T03:29:18.057

如果你习惯了 MFC，你就会爱上 QT。

[http://www.qtsoftware.com/products/](http://www.qtsoftware.com/products/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T03:28:44.297

有很多选择。

我喜欢 wxWidgets。其他人会推荐Qt。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T11:43:13.890

另一种选择是使用[Glade](http://glade.gnome.org/)构建[GTK+](http://www.gtk.org/)或[GNOME](http://www.gnome.org/)应用程序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-18T23:02:07.727

我从未使用过 MFC，但据说 wxWidgets 工具包有点像 MFC。虽然我更喜欢 Qt 而不是 wxWidgets，因为恕我直言，API 更好、更完整、文档更好，而且 Qt GUI 构建器非常好。

顺便说一句，Qt 和 wxWidgets 的一个好处是它们都是跨平台的工具包。它们可以在 Linux/Unix、Windows、OS X 以及其他平台上运行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-04-17T00:08:28.527

这里有一个巨大的遗漏！**[gtkmm](http://gtkmm.org/)**是与 GTK+ 的官方 C++ 绑定，可以说*是*现代 C++ GUI 工具包，因为它不遗余力地真正使用该语言并与该语言一起发展。对于那些学习现代 C++ 的人来说，它是标准库的最佳对应物。由于其现代且清晰的 API，它吸引并保持了我的兴趣，这是其他 GUI 库无法做到的。它适用于 GTK+ 所做的任何地方——*大量*的地方。我很高兴围绕它构建了我的第一个（而不是微不足道的！）GUI 项目。它还提供*sigc++*，我想这对于自定义信号/事件系统来说非常强大。免责声明：我只是一个自学成才的用户。

# iphone - TableViewController 中行为异常的Objective-C 对象数组（EXC_BAD_ACCESS）

> ID：758895
> 
> 赞同：1
> 
> 时间：2009-04-17T03:26:58.263
> 
> 标签：iphone, objective-c, arrays, exc-bad-access

我是 Objective-C 的新手，我不明白为什么我的 Car 对象数组中的 NSString 对象似乎已被释放。

这是我的 Car.m 课程：

```
 #import "Car.h"
@implementation Car
@synthesize categoryId;

- (id)initWithPrimaryKey:(NSInteger)pk categoryId:(NSNumber *)catId carName:(NSString *)n {
    if (self = [super init]) {
        primaryKey = pk;
        categoryId = catId;
        name = n;
    }

    return self;
}
- (void)dealloc {
    [name release];
    [categoryId release];

    [super dealloc];
}
- (NSInteger)primaryKey {
    return primaryKey;
}
- (NSString *)name {
    return name;
}
- (void)setName:(NSString *)aString {
    if ((!name && !aString) || (name && aString && [name isEqualToString:aString])) return;
    [name release];
    name = [aString copy];
}

@end 
```

这是我的 Simple_TableViewController.m 类。listData 实例变量在 viewDidLoad() 中设置正确。在调试器中，每个数组元素的 NSString *name 属性是完整的。然后，在其他所有方法中，listData 都已损坏。它包含所有具有正确 primaryKey 和 categoryId 值的 Car 元素，但 NSString *name 属性为“无效”。

```
 #import "Simple_TableViewController.h"
@implementation Simple_TableViewController

- (void)viewDidLoad {       
    NSMutableArray *array = [[NSMutableArray alloc] init];
    Database *database = [Database instance];

    array = [database getAllCars];
    [self setListData:array];
    [array release];
}
- (NSMutableArray *)listData {
    return listData;
}
- (void)setListData:(NSMutableArray *)newListData {
    if (listData != newListData) {
        [listData release];
        listData = [newListData mutableCopy];
    }
}
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
    return (interfaceOrientation == UIInterfaceOrientationPortrait);
}
- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
}
- (void)dealloc {
    [listData release];
    [super dealloc];
}
- (NSInteger)tableView:(UITableView *)tableView
 numberOfRowsInSection:(NSInteger)section
{
    return [listData count];
}
- (UITableViewCell *)tableView:(UITableView *)tableView
            cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    static NSString *SimpleTableIdentifier = @"SimpleTableIdentifier";

    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:SimpleTableIdentifier];
    if (cell == nil) {
        cell = [[[UITableViewCell alloc] initWithFrame:CGRectZero
                                                 reuseIdentifier:SimpleTableIdentifier] autorelease];
    }

    NSUInteger row = [indexPath row];
    Car *car = [listData objectAtIndex:row];

    cell.text = car.name;
    cell.font = [UIFont boldSystemFontOfSize:17];

    return cell;
}
- (NSInteger)tableView:(UITableView *)tableView
indentationLevelForRowAtIndexPath:(NSIndexPath *)indexPath
{
    return 0;
}
- (NSIndexPath *)tableView:(UITableView *)tableView
  willSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    NSInteger row = [indexPath row];
    if (row == 0) {
        return nil;
    }

    return indexPath;
}
- (void)tableView:(UITableView *)tableView
didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    NSUInteger row = [indexPath row];

    NSString *message = [[NSString alloc] initWithFormat:@"You selected %@", [[listData objectAtIndex:row] name]];
    UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"Row Selected!"
                                                                    message:message
                                                                  delegate:nil
                                                      cancelButtonTitle:@"Yes I Did"
                                                      otherButtonTitles:nil];
    [alert show];

    [message release];
    [alert release];
}
- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    return 35;
}

@end 
```

我已经摆弄了 Zombie 这个并保留它直到我的手指掉下来。我取消了 listData 变量的@property（非原子，保留）和@synthesize 东西，但我仍然遇到同样的问题。

提前感谢您提供的任何建议！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T04:14:10.023

在您的 initWithPrimaryKey:etc: 方法中，您需要保留这些值，或者使用点符号来分配它们（假设它们是使用 retain 关键字声明的属性）。试试这个：

```
`- (id)initWithPrimaryKey:(NSInteger)pk categoryId:(NSNumber *)catId carName:(NSString *)n {
    if (self = [super init]) {
        primaryKey = pk;
        categoryId =[catId retain];
        name = [n retain];
    }

```
return self; 
```

}` 
```

`此外，这只是一个样式问题，您可能会考虑*比*“n”和“pk”更冗长的名称。你未来的自己会感谢你。`

 `* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T07:22:44.703

稍微偏离主题 - Ben 有您正在寻找的答案，但您的某些代码中的逻辑有点曲折。

```
- (void)setName:(NSString *)aString {
    if ((!name && !aString) || (name && aString && [name isEqualToString:aString])) return;
    [name release];
    name = [aString copy];
} 
```

您真的不需要检查`(!name && !aString)`将 nil 重新分配到 nil 并将释放消息（或任何消息）发送给 nil 是否安全且常见的做法。运行时使后者短路，优化器将删除前者。如果设置 nil 名称是错误的，您应该断言 aString 不是 nil

同样，NSStrings 也得到了很好的优化。不要费心优化将汽车名称设置为已设置名称的情况。`[name isEqualToString:aString]`事实上，每次有人设置非零字符串时您进行的检查比您在少数情况下避免的发布和复制要慢。

如果您检查将副本发送到 NSString 时会发生什么，您会发现它只会增加保留计数。请注意，由于明显的原因，这不适用于 NSMutableString ;-)

A good rule of thumb - optimise when you have all functionality and only optimise what is slow (or big).

finally, following on from Ben's comments about naming, I'd rename aString to aCarName or something else more descriptive - again, your future self will thank you.

# javascript - 我将如何实现 stackoverflow 的悬停对话框？

> ID：758906
> 
> 赞同：34
> 
> 时间：2009-04-17T03:34:50.757
> 
> 标签：javascript, jquery, dialog, popup

我***爱上***了 stackoverflow 的单色“点击关闭”悬停对话框，当用户尝试投票并且没有登录或错误使用该网站时，它会向用户致意。知道 Jeff 使用的方式和/或什么技术实现这些整洁的小设备？

**编辑：我专门谈论在它们上显示“单击以关闭”的 SQUARE 对话框。我知道如何在屏幕顶部实现矩形条。**

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-04-17T04:46:19.057

虽然我的印象是他们为此使用了 jQuery 的 UI 对话框，但我不太确定。但是，自己动手并不太难。试试这个代码：

```
$('.showme').click(function() {
    $('.error-notification').remove();
    var $err = $('<div>').addClass('error-notification')
                         .html('<h2>Paolo is awesome</h2>(click on this box to close)')
                         .css('left', $(this).position().left);
    $(this).after($err);
    $err.fadeIn('fast');
});
$('.error-notification').live('click', function() {
    $(this).fadeOut('fast', function() { $(this).remove(); });
}); 
```

使用这些样式：

```
.error-notification {
    background-color:#AE0000;
    color:white;
    cursor:pointer;
    display: none;
    padding:15px;
    padding-top: 0;
    position:absolute;
    z-index:1;
    font-size: 100%;
}

.error-notification h2 {
    font-family:Trebuchet MS,Helvetica,sans-serif;
    font-size:140%;
    font-weight:bold;
    margin-bottom:7px;
} 
```

并[单击此处](http://jsbin.com/oqale)查看它的实际效果。

但是，我认为您仍然需要对其进行一些调整，以根据您使用它的情况为其提供正确的位置。我为左边的位置处理了这个，因为它适用于顶部，但我认为在某些情况下它可能不会。考虑到所有因素，这应该可以帮助您入门。如果你想要一个更健壮的实现，你应该查看[jQuery BeautyTips](http://www.lullabot.com/files/bt/bt-latest/DEMO/index.html)，它*真的*很棒，并且可以让这个实现变得微不足道。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T03:39:02.383

您可以将[jQuery](http://jquery.com/)库与[jQuery UI](http://jqueryui.com/)结合使用来创建[对话框](http://docs.jquery.com/UI/Dialog)。

# c - 在 C 中将四个字节解析为浮点数

> ID：758907
> 
> 赞同：2
> 
> 时间：2009-04-17T03:35:21.707
> 
> 标签：c, string, parsing, floating-point

如何获取四个接收到的数据*字节*并将它们组合成一个*浮点数*？

现在我将*字节*存储在一个数组中，即**received_data[1]** ... **received_data[4]**。我想将这四个*字节*存储为一个 32 位单精度*浮点数*。

-谢谢

我实际上正在接收一个包含 19 个字节的数据包，并将两组四个字节组合成两个浮点数。所以**received_data[1]**到**received_data[4]**是一个浮点数，**received_data[5]**到**received_data[8]**是另一个…

***更新：**** **更多信息...**
第*一位*，或*浮点数的***符号**位，是第一个*字节*的第七位，这是我检查的内容...

 **```
#define CHECK_BIT(var,pos) ((var) & (1<<(pos)))  

if( CHECK_BIT(received_data[1], 7))  //set or clear LED2
          {LATAbits.LATA2=1;}else{LATAbits.LATA2=0;}  
if( CHECK_BIT(received_data[5], 7))  //set or clear LED3
          {LATAbits.LATA3=1;}else{LATAbits.LATA3=0;} 
```

然后我通过从我的数据源发送交替的正数和负数来检查这一点，这应该相应地改变了 LED 并且它起作用了。

只要所有这些都成立，这意味着字节的顺序是正确的，但它们是以小端方式存储的，对吗？这会以正确的顺序存储到浮点数中吗？我还没有运气解析字节并将其作为浮点数读取......

*如果有人对此有任何经验，我正在使用 C18 MPLAB IDE 编译器。*

***最后更新：***
我的应用程序正在运行！现在只是一些小错误修复！

***谢谢！***

*感谢所有的帮助家伙！我是 stackoverflow 的新手，但是这里的这个社区真的很棒！像这样的工具真的是无价之宝！我什至无法告诉你你为我节省了多少时间和挫折！*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T03:55:35.310

您需要确保字节顺序正确。任何一个

```
float f1 = *(float*)(received_data+1)
float f2 = *(float*)(received_data+5) 
```

或者如果你必须反转字节，你必须复制，所以这里有一个替代方案：

```
union {
  char chars[4];
  float f;
} u;

for (i = 0; i < 4; i++)
  u.chars[3-i] = received_data[i+1];
float f1 = u.f;     
// ... and similarly for second float 
```

最好是这些字节是由类似于这个过程的逆过程的东西写入的（要么你获取 a 的地址`float`并将其强制转换，`char *`要么你有一个`char[4]`和'float'的联合。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T03:38:46.097

通过 memcpy 复制数据怎么样？

```
inline float FloatFromByteArray (const unsigned char * received_data)
{
  float f;
  memcpy (&f, received_data, sizeof (float));
  return f;
} 
```

它复制从 received_data[0] 开始的数据。如果你想从 received_data[1] 复制，只需在 memcpy 中添加偏移量。

```
inline float FloatFromByteArray (const unsigned char * received_data)
{
  float f;
  memcpy (&f, received_data+1, sizeof (float));
  return f;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T03:39:31.040

[您可以根据机器的字节](http://en.wikipedia.org/wiki/Endianness)顺序将它们组装起来，然后转换为 a `float*`，并使用该指针访问它们。

您通常会但也将它们放入`data[0]`... `data[3]`。所以...

```
char *data;

//Assemble in the *right* order
data[0] = received_data[4]; // index is machine dependant!
...

// cast
float *fptr = (float *)data;
printf ("%f\n",*fptr); 
```

* * *

从您的编辑中，也许您应该将这些内容转储到`struct`：

```
struct packet_s {
   char byte0;
   float f1;
   float f2;
   ...
} 
```

然后只是`read (2)`或直接进入结构。这种方法之前已经在 SO 上讨论过。例如：

*   [Java中如何从网络包数据中取出数据](https://stackoverflow.com/questions/436989/how-to-get-data-out-of-network-packet-data-in-java)密切相关

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T04:11:25.647

这就是我缓冲浮点数的方式：

```
static char* bufferFloat    (int* bLen, float value) {
*bLen = sizeof(float);
char* buf = malloc (*bLen);
int storage;

memcpy (&storage, &value, sizeof (int));
uint32_t val = htonl (storage);
memcpy (buf, &val, *bLen);

return buf;
} 
```

这就是我收到浮点数的方式：

```
static float readFloat (char* buf, int* bLen) {
float ret;
int temp;

if (*bLen < sizeof (float)) {
    *bLen = 0;
    return 0.0f;
}

memcpy (&temp, buf, sizeof (int));
uint32_t val = htonl(temp);
memcpy (&ret, &val, sizeof (float));
*bLen = sizeof (float);

return ret;
} 
```

这是我编写的一些爱好网络代码的一部分。我希望它会有所帮助，而且它似乎对我来说很完美。:D

实际上，如果您想要该网络代码，请访问此处：[http](http://cgi.cse.unsw.edu.au/~robertm) : //cgi.cse.unsw.edu.au/~robertm /myProjects.php 并找到正确的项目。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-17T03:38:39.203

假设它们的格式已经正确：

```
float f = *((float*)(&received_data[1])); 
```

确保你不是故意`received_data[0]`的。如果您有填充字节，我将其保留为一个。

# sql-server - SQL 存储过程比较值

> ID：758913
> 
> 赞同：1
> 
> 时间：2009-04-17T03:37:53.043
> 
> 标签：sql-server, stored-procedures

假设我有下表

```
book
-----
id
name
genre
check_out_date
location_id 
```

任何人都可以发布一个有效存储过程的示例，该过程仅更新传入的值与表中的当前值不同的 book 表？

即如果我传入值（1，“屠宰场 V”，“小说”，2008 年 10 月 10 日，54）并且表中的值是（1，“屠宰场 V”，“小说”，2009 年 10 月 24 日， 70），它只会更新 check_out_date 和 location_id 列。

```
Update Book set check_out_date=@check_out_date (10/24/2009), location_id=@location_id (70). 
```

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T03:45:04.147

```
UPDATE book
SET name = @name,
    genre = @genre,
    check_out_date = @check_out_date,
    location_id = @location_id
FROM BOOK
WHERE (id = @id) AND
     (((@name IS NULL AND name IS NOT NULL) OR
       (@name IS NOT NULL AND name IS NULL) OR
       (@name IS NOT NULL AND name IS NOT NULL AND name <> @name)) OR 
      ((@genre IS NULL AND genre IS NOT NULL) OR
       (@genre IS NOT NULL AND genre IS NULL) OR
       (@genre IS NOT NULL AND genre IS NOT NULL AND genre <> @genre)) OR 
     ((@check_out_date IS NULL AND check_out_date IS NOT NULL) OR
       (@check_out_date IS NOT NULL AND check_out_date IS NULL) OR
       (@check_out_date IS NOT NULL AND check_out_date IS NOT NULL AND
        check_out_date <> @check_out_date)) OR 
     ((@location_id IS NULL AND location_id IS NOT NULL) OR
       (@location_id IS NOT NULL AND location_id IS NULL) OR
       (@location_id IS NOT NULL AND location_id IS NOT NULL AND
        location_id <> @location_id))) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T09:02:10.203

您可能不想这样做，但您也可以先删除具有匹配 ID 的记录，然后再次插入。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T04:10:43.323

最有效的选择是在 BL 或可能的 DAL 中进行比较，并在那里做出是否更新的决定。

如果您知道它是更新而不是插入，那么您可能正在阅读记录。并且可能还有其他验证。在一个地方处理这一切。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T01:12:01.950

您说的是存储过程，所以没有理由不保持简单并进行单独更新。

```
UPDATE book SET name = @name WHERE id = @id and name <> coalesce(@name,name)
UPDATE book SET genre = @genre WHERE id = @id and genre <> coalesce(@genre,genre)
UPDATE book SET check_out_date = @check_out_date WHERE id = @id and check_out_date <> coalesce(@check_out_date,check_out_date)
UPDATE book SET location_id WHERE id = @id and location_id <> coalesce(@location_id,location_id) 
```

# svn - 如何让 Subversion（或任何程序）执行定期提交？

> ID：758916
> 
> 赞同：8
> 
> 时间：2009-04-17T03:38:50.967
> 
> 标签：svn, autocommit

我想配置我的计算机，以便每隔半小时自动提交我正在处理的程序。我正在使用一个 svn 存储库，所以即使它只是一个每 30 分钟运行一次“svn ci”的脚本也可以。问题是我不知道该怎么做。

有人可以告诉我，或者指导我做一些事情，让我让这个定期提交的东西工作吗？

提前致谢。

编辑：抱歉，我似乎让人们对我为什么要这样做感到困惑。我想这样做的唯一原因是因为我的一位讲师想让我们知道我们的代码是如何随着时间的推移而发展的，我认为为此目的使用 svn 是一个好主意。最新的提交是否有效并不重要。它只需要显示我随着时间的推移对代码所做的更改。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-17T08:27:34.157

与明显的流行观点相反，我认为在作业的上下文中这是 svn 的一个很好的用途。

像 kdesvn（或者更好的是，tortoisesvn，但这仅在 Windows 上）这样的工具可能会让您深入了解他们的日志视图、差异和责备视觉效果发生了什么。

如果您使用的是 ubuntu，请从与您正在使用的控制台分开的控制台运行此 bash 脚本。

```
#!/bin/bash
while [ 1 ]
do
        # Do the commit
        svn ci --message "Automated commit" ~/yourworkingcopy

        # Wait until next commit time
        sleep 1800
done 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-17T03:42:18.600

您可以尝试运行 shell 脚本的 cron 作业。你在什么操作系统上？

但我很好奇你为什么要这样做。您的提交应该由功能或错误修复组成，而不是基于时间间隔。您可能会在更改中间提交（在一组文件上），这将使您的修订无用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-17T03:45:12.463

我不认为按时间安排提交是一个特别好的主意。尤其是当您开始进行测试和持续集成时。以设定的时间间隔提交将破坏构建，因为无法保证您将在时间范围内完成变更集。

如果您想自动提交，更好的方法是将提交作为构建过程本身的一部分。只需将构建过程的最后一步提交到存储库即可。这样，如果构建失败，您将不会提交垃圾。

完全有可能使用各种风格的制作，我知道 Visual Studio 具有可以设置为执行此类操作的构建前和构建后事件。所以我很确定大多数现代 IDE 都可以处理这个问题。

作为对这个问题的一个特别考虑：
将提交钩子移动到进程的开头，这样你就可以跟踪你什么时候搞砸了，以及你是如何修复错误的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-17T11:44:36.023

我不会用这样一系列的自动提交弄脏你的控制版本系统。但我同意使用控制版本系统来提供该信息的想法。

然后，我的建议是：为您的软件使用一个存储库，另一个用于存储自动提交。工作完成后，将主存储库中的所有自动提交合并到一个逻辑提交中。

使用 git，我会这样做：

1.  Repo 'foo'：主存储库
    1.  refs/heads/...：你的开发分支的位置
    2.  refs/sessions/...：你的工作的位置与脏提交。
2.  您的工作副本：
    1.  “混帐初始化”
    2.  “git remote add foo git://foo/...; git fetch foo”
3.  创建分支：“git checkout -b bar foo/master”
4.  标记分支的开头：“git tag barbegin”
5.  激活脚本：“虽然为真；做 git add -A .; git commit -m 'autocommit'; 完成”
6.  我不会使用 cron 作业，因此您可以轻松激活/停用自动提交。
7.  做你的工作
8.  完成工作后，停用脚本
9.  提交挂起的更改
10.  现在，您在分支栏中有很多自动提交，并且您已经用 barbegin 标记了分支的初始提交
11.  发布您的自动提交：
    1.  “git标签barend”
    2.  “git push foo barbegin:refs/sessions/你的用户ID/会话ID/开始”
    3.  “git push foo barend:refs/sessions/你的用户 id/会话 id/end”
12.  现在，你已经发表了你的作品，你的讲师可以访问它
13.  更新您的 foo 存储库：
    1.  “git rebase -i --onto barbegin barbegin”并按照[此处所述进行](https://stackoverflow.com/questions/250238/collapsing-a-git-repositorys-history/251927#251927)
    2.  我会压缩所有提交：“最后，只能有一个”。
    3.  "git push foo bar:master" # 只会推送一个提交
14.  打扫：
    1.  “git标签-d barbegin”
    2.  “git标签-d barend”
    3.  “git 分支 -d 栏”

毕竟，我认为这样的数据可能无法收集到有用的信息。所以，我会尽量避免这种工作流程。但如果真的需要，我会这样做。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-17T08:45:00.213

我会使用 Subversion，但我会养成处理单个更改并将这些更改提交到存储库的习惯。

这样，如果讲师愿意，他不仅可以查看发生了*什么*变化，还可以查看*为什么*会发生变化。我想这会更有用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-02-10T14:00:45.760

你可以试试这个食谱： [http ://code.activestate.com/recipes/577570-watch-directory-and-do-periodic-commits-to-subvers/](http://code.activestate.com/recipes/577570-watch-directory-and-do-periodic-commits-to-subvers/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-17T03:41:29.257

如果您在 UNIX 风格上运行，请考虑创建一个[cron](http://www.clickmojo.com/code/cron-tutorial.html)作业以定期运行命令。

# ruby-on-rails - 根据内容类型限制 POST 创建操作

> ID：758919
> 
> 赞同：0
> 
> 时间：2009-04-17T03:39:30.603
> 
> 标签：ruby-on-rails

我想将我的 Rails 控制器设置为仅在请求具有 JavaScript 或 xml 有效负载时执行创建操作。我不希望 HTML 表单提交触发创建。理想情况下，尝试这样做会将您带到一个页面，说明您不能这样做。

我认为一种解决方案是`prepend_before_filter`在控制器上放置一个检查 content_type 并接受请求标头的控制器。

但是有没有更清洁或更常见的方法来实现这一目标？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T04:19:32.990

> 我认为一种解决方案是 `prepend_before_filter`在控制器上放置一个检查 content_type 并接受请求标头的控制器。

我认为你在这里有正确的想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T07:17:46.680

我的方法是使用 before_create 方法将您的函数放入模型中

# java - 如何摆脱 Maven 快照版本

> ID：758921
> 
> 赞同：3
> 
> 时间：2009-04-17T03:39:46.737
> 
> 标签：java, maven-2, build-process

我已经使用 maven 一段时间了。但我从来没有学会如何摆脱快照版本。

请分享一些关于如何发布工件的文章。即我如何将我的 0.0.1-SNAPSHOT 版本发布到（比如说）1.0.0

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T03:58:49.467

使用`mvn:release`插件。

```
mvn release:prepare
mvn release:perform 
```

在一般情况下，这就是您需要做的所有事情。有关更完整的文档，请参见[**此处**](http://maven.apache.org/plugins/maven-release-plugin/introduction.html)。

# vim - 如何在 Vim 中通过外部文件控制折叠？

> ID：758928
> 
> 赞同：1
> 
> 时间：2009-04-17T03:41:21.380
> 
> 标签：vim, code-folding

我一直在寻找一种将折叠标记和代码放入外部隐藏文件的解决方案。这样，您就可以在没有额外折叠标志的情况下进行永久折叠。

**如何在 Vim 中通过外部文件控制折叠？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T04:12:55.033

这是一个非常笼统的问题。vim 中的“外部文件”到底是什么？毕竟，Vim 是“外部”文件的集合。因此，如果我在 vimfiles 中定义折叠首选项，那是“外部文件”解决方案吗？

例如，您可以[链接](http://vim.wikia.com/wiki/Folding_with_Regular_Expression)，定义折叠的正则表达式机制并从外部文件中获取它们。

但我想，你说的是，“我可以定义一个外部文件，这样我就可以按项目自定义折叠，这样在我给他们我的文件后使用 vim 的每个人都会有相同的折叠”？是的，我想你可以通过从上面的方法推断来做到这一点。

但请记住，vim 有几种折叠方法：

*   手动 - 您手动定义折叠的地方（这很好，但它让您的代码有很多大括号，但它是“可移植的”）
*   indenting - 缩进定义折叠
*   表达（我提到过）
*   语法 - 由语法高亮定义
*   标记 - 你已经知道了

...最后，这一切都将归结为您的 vimrc 中的那几个设置。

我的建议：不要更改 vim 的缩进、语法等文件。通常，您甚至不需要更改这些（除非您使用的语言 vim 不支持，我对此表示怀疑）。因此，在您的 vimrc 和 vimfiles 目录中定义您的设置和首选项，并只为您的同事提供他们需要的首选项（通常只是来自 vimrc 的首选项）以具有相同的折叠行为。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-25T06:13:04.723

通过将这两行放在 ~/.vimrc 中，Vim 可以自动记住文件中的折叠

au BufWinLeave ?* mkview au BufWinEnter ?* 静默加载视图

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T04:43:37.113

使用`manual`方法制作褶皱。这与`marker`上面所暗示的不同。用于`:mkview`保存折叠并`:loadview`重新加载它们。

# httpwebrequest - 系统遇到问题，请求支持

> ID：758936
> 
> 赞同：0
> 
> 时间：2009-04-17T03:45:15.067
> 
> 标签：httpwebrequest

你好，

我们创建了一个在许多 Web 服务器中运行的 Web 应用程序。其中一台服务器最近已更新。当他们请求通常流式传输 PDF 内容的网页时，会显示警报消息并返回到最后访问的页面。

警报消息的标题为：Windows Internet Explorer

警报消息是“系统遇到请求支持的问题”。

我们从未遇到过这个例外。谁能帮我？

谢谢，P.Gopalakrishnan。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T04:01:58.147

grep 消息的源代码；它可能是由您的应用程序中的 javascript 引发的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T03:48:58.163

出现此问题时会发生什么？浏览器会崩溃吗？

我有时在 IE 上看到过这种情况。我不知道为什么。下载 Excel 电子表格时会发生这种情况，但从 SourceForge 下载代码时也会发生这种情况。

# language-agnostic - 哪些编程工具还没有写出来？

> ID：758940
> 
> 赞同：5
> 
> 时间：2009-04-17T03:48:07.543
> 
> 标签：language-agnostic

您希望拥有哪些工具来简化开发，这些工具要么尚不存在，要么太小众/没有特色而无法使用。这个问题是由[Redgate](http://www.red-gate.com/)（无连接）提出的，他们正在寻求为 Sql 构建适当的版本控制工具 - 这多年来一直是一个明显的差距，希望现在可以填补。

自 2004 年 1 月以来，Joel 一直在使用[.Net 静态链接器](http://www.joelonsoftware.com/articles/PleaseLinker.html)。

我个人想要一个[能够理解业务逻辑和其他代码之间区别的 IDE](https://stackoverflow.com/questions/749792/ratio-of-real-code-to-supporting-code)

您希望看到哪些（可行的）工具？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-17T04:10:09.360

这对某些人来说可能听起来很愚蠢，但是当我在学校学习 COBOL 时，您可以告诉 IDE 为您逐行跳过您的代码，如果您触摸鼠标，调试器会暂停，就像您点击了断点。有时我宁愿看调试器也不愿反复按 F10。我最喜欢的功能之一是您可以更改步进速度。基本上是每秒的行数，或步骤之间的延迟秒数。

或者，如果您有一个长时间运行或复杂的过程，并且您想说测试步骤 5，而不必重新运行步骤 1-4（因为它们需要 20 分钟才能完成），能够在某个点保存程序执行，并且将其恢复到特定的代码行。我现在正在开发一种工作工具，这将是上帝派来的。

我知道 VS2010 具有历史调试功能，但我不确定这是否仅适用于异常而不适用于程序状态。

我只是在听关于应用程序兼容性的 RunAs 广播第[92](http://www.runasradio.com/default.aspx?showNum=93)集，大约 27 分钟后，他们正在谈论应用程序中的硬编码文件夹路径。我真的责怪该工具没有提供足够的指导。如果我们可以对 LINQ 等复杂技术进行智能感知，为什么它不能在你做一些会伤害你的事情时产生某种类型的警告。有 fxcop，但你必须知道才能运行它。它应该是过程的一部分。

也许我要求太多，我们需要依靠第三方。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T03:51:29.967

随着时间的推移捕获内存、磁盘和进程信息的调试器。在某些非常具体的情况下，这些存在于一些糟糕的实现中，但尚未触及主流语言和环境。一个功能是及时倒退一分钟并查看系统原样。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T04:02:37.553

为您选择的 OO 语言发出 RDBMS 模式和匹配类的单一概念域建模工具。（或者对于任何语言，就此而言。）

中间一些新的类似语言的东西不算数。任何基于 XML 的东西都是反模式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-17T04:15:14.247

一个让你及时倒退的调试器。程序崩溃时很容易破坏程序。了解为什么会发生这种情况并找出导致这一点的步骤通常并不容易。

我有一种感觉，我不久前听说过类似的事情，但不记得那是什么。尽管如此，Visual Studio 中没有“后退”按钮，所以我可以做梦。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-19T23:32:23.170

具有出色 IntelliSense / 代码完成功能的 IDE，适用于 Python 和 PHP 等动态语言。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-17T04:02:00.643

一个好的解析器IDE。ANTLRWorks 渴望实现这一目标，但受到许多问题的困扰，尤其是对于非 Java 目标。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-17T04:07:27.463

一方面，我会为大型 C++ 项目上的多线程链接器而死。此外，如果 .NET 的文档构建工具 Sandcastle 是多线程的，那将为我节省大量时间。它是一堆独立的 XSLT 转换，但它在单个核心上一次运行一个文件。但这是对现有工具的改进。

我非常渴望的一个“新”工具是一个半体面的 .NET 分析器，它不花钱，或者至少有一个可用的免费版本，不会被定时炸弹。DevPartner 将他们的免费版本改为试用版，而 NProf 已经死了，而且在功能方面太缺乏了。市场上的其他参与者，如 dotTrace 和 ANTS，不仅是付费的，而且实际上非常昂贵。我运行一个开源项目，我不能为分析每个许可证放弃 500 美元。钱根本不存在。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-18T18:00:03.727

一个正在进行的研究领域是如何创建一个程序的多个可编辑视图，以跨越各种关注点。一些示例是分配、事务、锁定、数据流、控制流、跟踪、日志记录等。请注意，困难的部分是能够在所有视图中编辑程序，并以有效的方式组合各个部分。这是一种编程语言，也是一种开发工具的挑战。

Roly Perera 有一篇很好的介绍性[博客文章](http://dynamicaspects.org/blog/2008/11/many-dimensions-of-modularity.html)。我通过关于**Fluid AOP**（Gregor Kiczales 的名字）的[LtU 线程发现了这一点。](http://lambda-the-ultimate.org/node/3272#comment-48169)

 *** * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-17T05:27:34.993

一个优化编译器，它实际上做了每个人都认为它应该做的所有事情。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-18T05:00:31.190

我真的很想看到一个完全支持重构甚至复杂的 C++ 源代码的应用程序。必须手动完成所有这些工作是不必要的乏味。

重构 C++，或者更确切地说是 C++ 源代码的静态分析和自动转换一直是一个大 PITA。

C++ 源代码需要成为可查询的实体，如 RDBM，以便我们可以使用查询轻松转换它，理想情况下使用自定义的基于 SQL 的重构语言或其方言。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-17T04:11:00.763

这是高度投机的，但是：

在使用动态环境（如 Common Lisp、Python 甚至使用 Edit and Continue 的 C++ 应用程序）时，与必须关闭系统的 C++、C 和 Java 应用程序相比，我的工作速度快得多让我感到震惊做出小的改变。

那么我想知道的是，这些环境是否可以扩展到多用户系统，用于中型和大型程序？缺少的工具是一个平台、编辑工具，甚至可能是新的工作方式，这将使我们能够实时协作。有点像与更多人结对编程。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-17T04:27:08.913

用于分析在分布式系统上运行的代码的分析器/调试器，允许您调试/单步调试这些主机，并且来自单个运行时的网络交互将非常简洁，并且随着分布式系统的普及，这将是必须的。目前调试这样的系统特别困难，因为有太多的小条件会导致其他系统的连锁反应......

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-19T23:05:12.563

我会支付现金的两个：

*   一种跟踪业务对象更改的简单方法。在这一点上，我会对“IsDirty”标志感到满意，但检查原始值和更改值以及回滚更改的能力会很好。
*   一个 UI 框架，可以更轻松地编写相同数据的只读和可编辑视图。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-17T03:53:02.663

一个真正的拖放工具，提供了良好的代码。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-17T03:53:07.530

好吧，至少[这是您的静态链接器。](http://research.microsoft.com/en-us/people/mbarnett/ilmerge.aspx):)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-17T03:56:50.827

当您没有 Platform Builder 时在 Windows CE 上进行概要分析的好方法。:)

试图分析我的程序似乎是不可能的，所以需要猜测。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-04-17T04:14:53.640

XML 之后的任何内容。我等不及了。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-04-17T04:21:30.347

一种将我模糊的思维过程自动转换为工作代码的工具。

这个工具需要理解高级概念，例如“你知道”和“其他东西”。

# postgresql - 将批量插入 Postgres 的最快方法是什么？

> ID：758945
> 
> 赞同：308
> 
> 时间：2009-04-17T03:50:46.803
> 
> 标签：postgresql, bulkinsert

我需要以编程方式将数千万条记录插入 Postgres 数据库。目前，我正在一个查询中执行数千个插入语句。

有没有更好的方法来做到这一点，一些我不知道的批量插入语句？

* * *

## 回答 #1

> 赞同：265
> 
> 时间：2009-04-17T03:57:23.213

PostgreSQL 有[一个](https://www.postgresql.org/docs/current/interactive/populate.html)关于如何最好地填充数据库的指南，他们建议使用[COPY](https://www.postgresql.org/docs/current/interactive/sql-copy.html)命令批量加载行。该指南还有一些其他关于如何加快流程的好技巧，例如在加载数据之前删除索引和外键（然后再将它们添加回来）。

* * *

## 回答 #2

> 赞同：129
> 
> 时间：2015-01-27T10:18:29.100

除了使用 COPY，还有一种替代方法，它是 Postgres 支持的多行值语法。从[文档](http://www.postgresql.org/docs/9.4/static/sql-insert.html)中：

```
INSERT INTO films (code, title, did, date_prod, kind) VALUES
    ('B6717', 'Tampopo', 110, '1985-02-10', 'Comedy'),
    ('HG120', 'The Dinner Game', 140, DEFAULT, 'Comedy'); 
```

上面的代码插入了两行，但你可以任意扩展它，直到你达到准备好的语句令牌的最大数量（可能是 999 美元，但我对此不是 100% 确定）。有时不能使用 COPY，而对于这些情况，这是一个值得替代的方法。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-04-17T04:06:48.090

加快速度的一种方法是在事务中显式执行多个插入或复制（例如 1000 次）。Postgres 的默认行为是在每条语句之后提交，因此通过批量提交，可以避免一些开销。正如丹尼尔回答中的指南所说，您可能必须禁用自动提交才能使其正常工作。另请注意底部的注释建议将 wal_buffers 的大小增加到 16 MB 也可能有所帮助。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2015-06-26T10:37:57.163

[`UNNEST`](http://www.postgresql.org/docs/devel/static/functions-array.html)带有数组的函数可以与多行 VALUES 语法一起使用。我认为这种方法比使用慢，`COPY`但它对我使用 psycopg 和 python 很有用（`list`传递给的python`cursor.execute`变成 pg `ARRAY`）：

```
INSERT INTO tablename (fieldname1, fieldname2, fieldname3)
VALUES (
    UNNEST(ARRAY[1, 2, 3]), 
    UNNEST(ARRAY[100, 200, 300]), 
    UNNEST(ARRAY['a', 'b', 'c'])
); 
```

不`VALUES`使用带有额外存在检查的子选择：

```
INSERT INTO tablename (fieldname1, fieldname2, fieldname3)
SELECT * FROM (
    SELECT UNNEST(ARRAY[1, 2, 3]), 
           UNNEST(ARRAY[100, 200, 300]), 
           UNNEST(ARRAY['a', 'b', 'c'])
) AS temptable
WHERE NOT EXISTS (
    SELECT 1 FROM tablename tt
    WHERE tt.fieldname1=temptable.fieldname1
); 
```

批量更新的语法相同：

```
UPDATE tablename
SET fieldname1=temptable.data
FROM (
    SELECT UNNEST(ARRAY[1,2]) AS id,
           UNNEST(ARRAY['a', 'b']) AS data
) AS temptable
WHERE tablename.id=temptable.id; 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-11-17T09:33:08.173

您可以使用`COPY table TO ... WITH BINARY`“[比文本和 CSV 格式快一些](http://www.postgresql.org/docs/current/interactive/sql-copy.html)”。仅当您有数百万行要插入并且您对二进制数据感到满意时才这样做。

这是[Python 中的示例配方，使用带有二进制输入的 psycopg2](https://stackoverflow.com/questions/8144002/use-binary-copy-table-from-with-psycopg2/8150329#8150329)。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2011-09-03T17:50:48.640

它主要取决于数据库中的（其他）活动。像这样的操作有效地冻结了其他会话的整个数据库。另一个考虑因素是数据模型和约束、触发器等的存在。

我的第一种方法始终是：创建一个结构类似于目标表 ( `create table tmp AS select * from target where 1=0`) 的 (temp) 表，然后首先将文件读入 temp 表。然后我检查可以检查的内容：重复项、目标中已经存在的键等。

然后我只是做一个`do insert into target select * from tmp`或类似的。

如果失败或花费太长时间，我将中止它并考虑其他方法（暂时删除索引/约束等）

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2020-06-21T01:28:34.797

      （（这是一个您可以编辑和增强答案的 WIKI！））

## 外部文件是最好和典型的批量数据

“批量数据”一词与“大量数据”有关，因此使用**原始原始数据**是很自然的，无需将其转换为 SQL。“批量插入”的典型原始数据文件是[CSV](https://en.wikipedia.org/wiki/Comma-separated_values)和[JSON](https://www.json.org)格式。

## 带有一些转换的批量插入

在[ETL](https://en.wikipedia.org/wiki/Extract,_transform,_load)应用程序和摄取过程中，我们需要在插入数据之前对其进行更改。临时表消耗（大量）磁盘空间，这不是更快的方法。[PostgreSQL 外部数据包装器](https://www.postgresql.org/docs/12/postgres-fdw.html)( FDW) 是最佳选择。

**CSV 示例**。假设`tablename (x, y, z)`on SQL 和一个 CSV 文件，如

```
fieldname1,fieldname2,fieldname3
etc,etc,etc
... million lines ... 
```

您可以使用经典的 SQL`COPY`来加载（*作为*原始数据）`tmp_tablename`，然后将过滤后的数据插入`tablename`...但是，为了避免磁盘消耗，最好是直接摄取

```
INSERT INTO tablename (x, y, z)
  SELECT f1(fieldname1), f2(fieldname2), f3(fieldname3) -- the transforms 
  FROM tmp_tablename_fdw
  -- WHERE condictions
; 
```

您需要为 FDW 准备数据库，而不是静态的`tmp_tablename_fdw`，您可以使用[生成它的函数](https://stackoverflow.com/q/12780275/287948)：

```
CREATE EXTENSION file_fdw;
CREATE SERVER import FOREIGN DATA WRAPPER file_fdw;
CREATE FOREIGN TABLE tmp_tablename_fdw(
  ...
) SERVER import OPTIONS ( filename '/tmp/pg_io/file.csv', format 'csv'); 
```

**JSON 示例**。一组两个文件，`myRawData1.json`可以`Ranger_Policies2.json`通过以下方式摄取：

```
INSERT INTO tablename (fname, metadata, content)
 SELECT fname, meta, j  -- do any data transformation here
 FROM jsonb_read_files('myRawData%.json')
 -- WHERE any_condiction_here
; 
```

其中函数*jsonb_read_files()*读取由掩码定义的文件夹的所有文件：

```
CREATE or replace FUNCTION jsonb_read_files(
  p_flike text, p_fpath text DEFAULT '/tmp/pg_io/'
) RETURNS TABLE (fid int,  fname text, fmeta jsonb, j jsonb) AS $f$
  WITH t AS (
     SELECT (row_number() OVER ())::int id, 
           f as fname,
           p_fpath ||'/'|| f as f
     FROM pg_ls_dir(p_fpath) t(f)
     WHERE    f like p_flike
  ) SELECT id,  fname,
         to_jsonb( pg_stat_file(f) ) || jsonb_build_object('fpath',p_fpath),
         pg_read_file(f)::jsonb
    FROM t
$f$  LANGUAGE SQL IMMUTABLE; 
```

## 缺乏 gzip 流

“文件摄取”（主要在大数据中）最常见的方法是保存 [gzip 格式的原始文件并使用](https://en.wikipedia.org/wiki/Gzip)[流算法](https://en.wikipedia.org/wiki/Streaming_algorithm)传输它，任何可以在 unix 管道中快速运行且不消耗磁盘的东西：

```
 gunzip remote_or_local_file.csv.gz | convert_to_sql | psql 
```

所以理想（未来）是format 的*服务器选项*`.csv.gz`。

@CharlieClark 评论后的注意事项：目前（2022 年）无事可做，最好的选择似乎是[`pgloader`STDIN](https://pgloader.readthedocs.io/en/latest/quickstart.html#reading-from-stdin)：

```
 gunzip -c file.csv.gz | pgloader --type csv ... - pgsql:///target?foo 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-08-29T10:48:44.897

我使用本机 libpq 方法实现了非常快速的 Postgresq 数据加载器。试试我的包[https://www.nuget.org/packages/NpgsqlBulkCopy/](https://www.nuget.org/packages/NpgsqlBulkCopy/)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2015-08-13T15:08:49.440

我刚遇到这个问题，建议使用[csvsql](https://csvkit.readthedocs.io) ( [releases](https://github.com/wireservice/csvkit/releases) ) 批量导入 Postgres。要执行批量插入，您只需`createdb`然后使用`csvsql`，它连接到您的数据库并为整个 CSV 文件夹创建单独的表。

```
$ createdb test 
$ csvsql --db postgresql:///test --insert examples/*.csv 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-07-29T17:23:02.663

可能我已经迟到了。但是，有一个`pgbulkinsert`Bytefish 调用的 Java 库。我和我的团队能够在 15 秒内批量插入 100 万条记录。当然，我们还执行了一些其他操作，例如从 Minio 上的文件中读取 1M+ 记录，在 1M+ 记录的顶部进行几次处理，如果重复则过滤掉记录，最后将 1M 记录插入 Postgres 数据库. 所有这些过程都在15秒内完成。我不记得执行数据库操作需要多少时间，但我认为大约不到 5 秒。[从https://www.bytefish.de/blog/pgbulkinsert_bulkprocessor.html](https://www.bytefish.de/blog/pgbulkinsert_bulkprocessor.html)查找更多详细信息

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-01-05T12:14:22.663

正如其他人所指出的，在将数据导入 Postgres 时，Postgres 旨在为您执行的检查会减慢速度。此外，您经常需要以一种或另一种方式操作数据，以使其适合使用。任何可以在 Postgres 进程之外完成的操作都意味着您可以使用 COPY 协议进行导入。

为了我的使用，我经常使用[pgloader从](https://pgloader.io)[httparchive.org](https://legacy.httparchive.org)项目导入数据。由于源文件是由 MySQL 创建的，因此您需要能够处理一些 MySQL 奇怪的问题，例如使用空值以及编码问题。这些文件也很大，至少在我的机器上，使用 FDW 会耗尽内存。pgloader 可以很容易地创建一个管道，让您可以选择所需的字段、转换为相关的数据类型以及在进入主数据库之前进行任何其他工作，从而最大限度地减少索引更新等。`\N`

# javascript - 您可以根据分组数量在 jQuery 中获取元素的子集吗？

> ID：758955
> 
> 赞同：0
> 
> 时间：2009-04-17T03:57:14.790
> 
> 标签：javascript, jquery, loops

假设我有 5 个强元素，我想使用 jQuery 将它们包装在 div 元素中，以 2 个为一组。

例子：

```
<!--original markup-->
<strong>I AM STRONG</strong>
<strong>I AM STRONG</strong>
<strong>I AM STRONG</strong>
<strong>I AM STRONG</strong>
<strong>I AM STRONG</strong> 
```

变成

```
<!-- new markup -->
<div>
    <strong>I AM STRONG</strong>
    <strong>I AM STRONG</strong>
</div>
<div>
    <strong>I AM STRONG</strong>
    <strong>I AM STRONG</strong>
</div><div>
    <strong>I AM STRONG</strong>
</div> 
```

最好的方法是什么？我尝试了一些事情，但它们有问题。强元素不能有固定的高度。此外，这些元素仅作为示例。

我将如何编写一个 jQuery 循环来做到这一点？

谢谢

**编辑** 没有固定数量的元素。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T04:10:51.357

我可能一次只循环两个，边走边包好每一对......

```
var elems = $("strong");
for (var i=0; i<elems.length; i+=2)
{
  elems.slice(i,i+2)   // split off a pair
    .wrapAll("<div>"); // wrap it
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T04:07:36.340

您可以使用 :odd 来选择所有其他元素，然后使用 .prev 来获取偶数元素。

```
$('strong:odd').each(function(){
  var divElement = $('<div></div>').append($(this).prev(), $(this));
  // Now add the divElement to a new container?
}); 
```

# javascript - 什么会取代 HTML & CSS & JS？

> ID：758973
> 
> 赞同：8
> 
> 时间：2009-04-17T04:04:35.957
> 
> 标签：javascript, html, css

HTML 和 CSS 正在显示它们的年龄。

SASS 生成 CSS（因为 CSS 不够干净）。图形设计师不在 HTML 中工作，他们在图形工具中工作，然后必须将其转换为 HTML/CSS。JavaScript 必须有像 jQuery 这样的抽象，而 CSS 有很多技巧，甚至可以开始接近一致的可预测用户体验。

感觉就像人们在做一些很棒的事情，尽管有技术，而不是因为它们。

当然有更好的方法？！？与手头的任务更接近的东西......提供流畅直观（一致）的用户体验，让用户实现他们的目标。

想法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-17T04:12:00.090

没什么，我相信他们会在这里停留 10 年。

互联网体验可能会通过 Flash 和 Silverlight 等技术得到增强，但互联网的价值不在于技术，而在于信息。

因此，为了纯粹的技术增强而破坏 Internet 兼容性是行不通的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-17T04:58:08.293

BLTML：培根、生菜和番茄标记语言。

未来，网络只能用于发布我们想吃的美味佳肴，因此开发一种专门为此而设计的语言是有意义的。

带有文字的小猫图片可能会得到粗略的支持。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-17T04:12:20.823

HTML 和 CSS 将长期存在！

虽然它们对于设计师来说可能不像 PhotoShop 那样直观，但格式良好的 HTML 是机器可读的——这意味着它可以被人和计算机使用。这是非常重要和有用的。想象一下一个充满图片的网络，这些图片看起来很漂亮，但 Google 无法抓取或搜索？

HTML 和 CSS 之所以优越，是因为它们具有结构化的信息。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-17T04:26:59.430

> 平面设计师不能在 HTML 中工作

DTP 设计师也不生产纸张和墨水。设计一些东西和生产一些东西，这些是可分离的任务 - 当你有一个电视广告的想法时，你仍然需要在你的创造力和结果之间使用大量技术，这同样适用于网络。

> Javascript 必须有 JQuery 之类的抽象，而 CSS 有很多技巧，甚至可以开始接近一致的可预测用户体验。

哦，伙计，js不一定要有，开发人员只是想让他们的工作更轻松，这条规则适用于各种编程语言，就像说python必须有django一样。框架和库超越了语言，它们不是必须的。CSS '有一堆 hack' 是因为一些浏览器生产商不关心所谓的“标准”，而不是因为该语言设计糟糕。

> 当然有更好的方法？！？与手头的任务更接近的东西......提供流畅直观（一致）的用户体验，让用户实现他们的目标。

html、css、js 不提供什么用户体验？我真的不明白你的意思，以及你对网络的期望。哦，如果你喜欢“你知道，你需要 flash 来做某事或其他什么”，那就开始对[canvas](http://stairwellblog.com/2009/03/is-canvas-the-end-of-flash/)感兴趣。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-17T04:24:37.970

我个人认为 HTML 和 CSS 非常优雅，虽然 W3C 肯定不会草率，但我认为可以公平地说，*某个浏览器*一直在阻碍 Web 设计，而不是技术本身。

CSS3 支持奇妙的事物，例如带有@fontface 的网络字体。Javascript 引擎变得越来越快，并且允许像 John Resig 的[处理端口](http://ejohn.org/blog/processingjs/)这样的东西，这在几年前是无法想象的。

我们需要看到用户以更快的速度采用新的浏览器，我们需要看到供应商支持鼓励他们的用户升级。

我认为认为抽象是消极的事情是错误的，并表明基础技术存在一些问题——技术自然地通过抽象发展。从某种意义上说，您的帖子中存在一些不一致之处，即您谴责需要抽象，但随后提到您希望保持一致性——客户端之间的一致性是通过抽象实现的。我不再需要担心不同的客户端如何处理 DOM - jquery 为我做这件事。出于同样的原因，CSS hack 并不是真正必要的，*为该浏览器*提供不同的样式表是完全可以接受的；其他主流引擎之间的渲染差异非常小。

还请考虑到我们仍在使用许多“旧”技术（Unix、c、c++ 等等），因为它们功能强大、优雅且设计精良。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-17T04:33:16.217

我不认为 HTML 和 CSS 正在显示它们的年龄，我认为浏览器正在显示它们的年龄。我喜欢能够描述我想要做什么，而不是如何去做。

我想我想要的是浏览器供应商使用一个渲染引擎，或者如果没有别的，浏览器的 SSL 类型的认证。一种全球性的公正机构，以类似质量标准的规模衡量浏览器。

就像 SSL 认证一样，它是由第三方完成的。我不确定定价结构是什么，但我认为您不必为此付费。我认为它会成为一个很棒的“在这个浏览器中工作”的标志，就像我们多年来在网站上看到的 Spam Free 和 Mal-ware Free 标志一样。或者可能是 Acid1、Acid2、Acid3 为浏览器传递了徽标。

我认为像 JQuery 和 Prototype 这样的库之所以存在，是因为浏览器都有它们的怪癖。我们只是厌倦了编写所有处理代码，所以一些非常聪明的人为我们做了这件事。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-17T06:16:47.077

越差越好。由于针对该平台编写的大量内容，HTML 和 CSS 永远不会消失。C 也是如此。它是一种糟糕的语言，但它会一直伴随着我们，因为几乎所有的软件都是用 C 或 C++ 编写的。大量的 JAVA 意味着它永远不会消失。COBOL 程序员仍有市场。

一些程序员对 HTML/CSS/JS 这样的糟糕系统感到非常沮丧，并认为“嘿，让我们拆除它并重新开始”是一些程序员的流行想法。你知道，我可以发明自己的手机，它比任何其他手机都要好 100 倍，音质也更好。那是容易的部分。困难的部分是有人打电话。

不管你喜不喜欢，HTML/CSS/JS 是流行的技术三重奏，这意味着数百万人已经投入了数万亿美元来为这项技术制作内容。因为有人说 HTML/CSS/JS 糟透了，数百万人将非常不愿意放弃这些努力。

弄清楚什么技术将变得流行是一件神秘的事情。这不是您为了自己的舒适而可以控制的事情。但至少，你知道，有“抽象”这样可爱的计算机科学概念，如果你能掌握它，它将成为你的秘密武器。Jquery 就是一个例子，但它可以走得更远。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-17T09:30:03.913

问题不在于设计替代 HTML/CSS/JS 的东西，而是让浏览器供应商采用它。祝你好运。

就像网络体验和 HTML 在我和你的生活中一样重要，世界上大多数人使用的唯一计算机就是他们的手机。即使在多点触控触摸屏上，网络也无法正常工作。

就像您在玩游戏之前不再使用 ROM basic 进入游戏，并且您不再看到周围只有文本的屏幕（大部分情况下），总有一天网络将被专门的设备或手机的专门应用程序使用。机器可读的网络，或者换句话说，网络服务。如果你愿意，你可以称之为 web 3.0。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-04-12T04:02:32.883

我相信问题不在于 HTML、CSS 和 JS 或它们的时代（无论如何它们都在不断发展）。从理论上讲，您应该能够创建某物的一个版本，并让它在不同平台上完全相同地工作。这就是问题所在：平台。

说这些技术很旧，因此需要更换，就像说 C++ 很旧，因此不应该用于游戏开发。对于它们的设计目的，它们实际上是非常合适和强大的工具。因此，我预测不是 HTML、CSS 和 JS 需要或将要被替换，而是当前的平台需要将它们的狗屎放在一起（比其他平台更多）并遵循该死的标准！

也就是说，他们确实需要不断发展以保持相关性。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-17T04:10:52.790

我认为 XML 和 XSL 是未来。图形设计器工具将附带它们自己的 XSL 样式表，根据工具的优势进行定制，并且该工具将生成使用样式表的 XML 文件。

但我不是千里眼；未来 5 年会流行什么，谁知道呢。:-P

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-17T04:35:47.350

如果您听听微软的话，Silverlight 将在新网络中占据显着位置。由于它使用 XAML，它只是一个文本文件，因此它有可能对搜索引擎友好。

其他人喜欢Flash。

当然，我相信将来会发明其他新东西......

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-17T04:56:34.740

我认为像 Adob​​e flex/air/apollo 和 Silverlight 等 RIA 会蚕食一些 html 市场份额，但不会完全取代它。

一些困扰 RIA 的问题，比如 SEO 相关的东西，缺乏后退按钮支持正在得到解决。

RIA 的好处是它独立于浏览器（只要用户拥有正确的插件），我可以预见未来的浏览器会内置 RIA 支持，从而确保使用它们构建的应用程序 100% 的市场渗透率。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-17T09:32:44.140

对于文档和普通网页，HTML 和 CSS 可以保留和发展（Sass 确实不错）。对于应用程序，驱动类似画布的图形的移动代码（最有可能是 JavaScript）将有助于合并 Web 应用程序和支持互联网的桌面应用程序。

*——我想知道这些预测在 10 年后会变得多么荒谬 :)*

# ruby-on-rails - Ruby on Rails：如何指定运行器脚本环境

> ID：758975
> 
> 赞同：12
> 
> 时间：2009-04-17T04:05:52.350
> 
> 标签：ruby-on-rails, linux, bash

我正在使用 shell 脚本在我的 Ruby on Rails 应用程序中运行一些运行器脚本。我需要在生产数据库上运行它，但是如下：

```
#!/bin/bash
/usr/bin/ruby RAILS_ENV=production ../script/runner ../lib/tasks.rb 
```

给出一个错误：

```
/usr/bin/ruby: No such file or directory -- RAILS_ENV=production (LoadError) 
```

我试图在 config/environment.rb 中强制它

```
ENV['RAILS_ENV'] ||= 'production' 
```

甚至

```
ENV['RAILS_ENV'] = 'production' 
```

但即便如此，它仍然在开发环境中运行。

更新：我可以通过编辑 config/database.yml 文件强制脚本连接到正确的数据库，但我想知道这样做的正确方法是什么。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-26T07:46:34.650

script/runner 的命令行帮助为您提供答案。

```
script/runner -e production Model.method 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-17T04:10:13.650

如果这是您的命令，那么您的参数顺序是您最大的问题。

```
/usr/bin/ruby RAILS_ENV=production ../script/runner ../lib/tasks.rb 
```

不同于。

```
/usr/bin/ruby ../script/runner ../lib/tasks.rb RAILS_ENV=production 
```

第二个示例是查找文件，第一个示例是设置运行时变量，而 ruby​​ 将其解释为您要运行的文件。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-26T06:24:49.107

如果你像这样重做你的脚本：

```
#!/bin/bash
RAILS_ENV=production
/usr/bin/ruby ../script/runner ../lib/tasks.rb 
```

...这将使它在脚本的整个生命周期内都保持不变。要使其在 shell 会话的整个生命周期内保持不变，请将其更改为

```
#!/bin/bash
export RAILS_ENV=production
/usr/bin/ruby ../script/runner ../lib/tasks.rb 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-26T07:41:40.670

您可以像这样设置环境变量：

```
RAILS_ENV=production /usr/bin/ruby ../script/runner ../lib/tasks.rb 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-10-15T13:45:52.420

```
RAILS_ENV=production script/rails runner 'user = User.find(:first, :conditions => {:admin => true}) ; user.password, user.password_confirmation = "mypasswd"; user.save!' 
```

它对我有用

# python - Matplotlib 重装 Xcode 后突然崩溃？

> ID：758980
> 
> 赞同：2
> 
> 时间：2009-04-17T04:08:36.433
> 
> 标签：python, xcode, numpy, matplotlib

我对 python 和 matplotlib 的世界非常熟悉，我很高兴。我注意到我的 Mac 上的 Xcode 无法正常工作，所以我从 Apple 安装了最新版本，它以某种方式破坏了我安装的 matplotlib（或 numpy？）！我现在得到

```
...
/sw/lib/python2.5/site-packages/matplotlib-0.91.1-py2.5-macosx-
10.5-i386.egg/matplotlib/numerix/ma/__init__.py in <module>()
     14         print "using maskedarray"
     15     else:
---> 16         from numpy.core.ma import *
     17         #print "using ma"
     18     def getmaskorNone(obj):

ImportError: No module named ma 
```

我尝试重新安装 numpy (Ver 1.3.0) 和 matplotlib (Ver 0.91.1) 无济于事。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T04:13:54.453

您使用的是 Fink 的 Python，因此 Xcode 与它没有任何关系。 `from numpy.core.ma import *`也适用于 Apple 捆绑的 Python 和 NumPy。

# windows-installer - Nant 构建 MSI 文件

> ID：758982
> 
> 赞同：0
> 
> 时间：2009-04-17T04:08:57.693
> 
> 标签：windows-installer, nant

我如何使用 NAnt 构建 msi 文件

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-19T23:22:36.610

您可以使用 WiX 提供的 Nant 任务，请参阅[此博客文章并在 WiX 帮助文件 (](http://weblogs.asp.net/lorenh/archive/2006/01/24/436390.aspx) **WiX.chm** )中搜索“Nant”

上述博客文章中的简单示例供您参考，我自己的实际 .build 文件超过 500 行长，主要是相关的任务，例如构建引导程序、提取源代码、代码签名、与 Lingobit 集成以进行本地化等。构建实际的 MSI 可能是代码中最简单的部分 :)

```
<target name="package" description="Create the installer package">

  <property name="wix.dir" value="${base.dir}\WiX" />
  <loadtasks assembly="${wix.dir}\Microsoft.Tools.WindowsInstallerXml.NAntTasks.dll" />

  <candle out="${nant.project.basedir}\" exedir="${wix.dir}">
    <sources>
      <include name="MyApp.wxs" />
    </sources>
  </candle>

  <light out="MyApp.msi" exedir="${wix.dir}"
    locfile="${wix.dir}\lib\WixUI_en-us.wxl" rebuild="true">
    <sources>
      <include name="MyApp.wixobj" />
      <include name="${wix.dir}\ca\wixca.wixlib" />
      <include name="${wix.dir}\lib\wixui_featuretree.wixlib"/>
    </sources>
  </light>

</target> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T04:32:55.470

呃，什么？您是否尝试创建 MSI？在这种情况下，您可能想要触发构建工具，也许是[Wix](http://wix.sourceforge.net/)。如果您尝试运行现有的 MSI，则要使用的可执行文件称为“msiexec”。

# .net - 自定义 app.config 配置部分处理程序

> ID：758986
> 
> 赞同：31
> 
> 时间：2009-04-17T04:10:22.857
> 
> 标签：.net, configuration, app-config, configsection

如果我使用这样的 app.config，通过继承自 System.Configuration.Section 的类获取“页面”列表的正确方法是什么？

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>

  <configSections>
    <section name="XrbSettings" type="Xrb.UI.XrbSettings,Xrb.UI" />
  </configSections>

  <XrbSettings>
    <pages>
      <add title="Google" url="http://www.google.com" />
      <add title="Yahoo" url="http://www.yahoo.com" />
    </pages>
  </XrbSettings>

</configuration> 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-17T04:26:31.663

首先，在扩展 Section 的类中添加一个属性：

```
[ConfigurationProperty("pages", IsDefaultCollection = false)]
[ConfigurationCollection(typeof(PageCollection), AddItemName = "add")]
public PageCollection Pages {
    get {
        return (PageCollection) this["pages"];
    }
} 
```

然后你需要创建一个 PageCollection 类。我见过的所有示例都几乎相同，因此只需复制[此](http://sourceforge.net/p/nmailserver/code/HEAD/tree/NMail/trunk/NMail/Configuration/NamedServiceCollection.cs)示例并将“NamedService”重命名为“Page”即可。

最后添加一个扩展 ObjectConfigurationElement 的类：

```
public class PageElement : ObjectConfigurationElement {
    [ConfigurationProperty("title", IsRequired = true)]
    public string Title {
        get {
            return (string) this["title"];
        }
        set {
            this["title"] = value;
        }
    }

    [ConfigurationProperty("url", IsRequired = true)]
    public string Url {
        get {
            return (string) this["url"];
        }
        set {
            this["url"] = value;
        }
    }
} 
```

以下是示例实现中的一些文件：

*   [示例配置](http://sourceforge.net/p/nmailserver/code/HEAD/tree/NMail/trunk/NMail.Server.Console/NMail.config)
*   [集合和元素类](http://sourceforge.net/p/nmailserver/code/HEAD/tree/NMail/trunk/NMail/Configuration/NamedServiceCollection.cs)
*   [配置节类](http://sourceforge.net/p/nmailserver/code/HEAD/tree/NMail/trunk/NMail/Configuration/NMailConfiguration.cs)

# eclipse - 如何让 Eclipse 警告消息不会立即消失？

> ID：758997
> 
> 赞同：0
> 
> 时间：2009-04-17T04:13:43.503
> 
> 标签：eclipse, compiler-warnings

Eclipse 中的黄色小警告符号和下划线不会持续很长时间，是吗？

当我收到警告时，单击小警告符号后，我有几毫秒的时间尝试阅读警告消息，然后它就像一只非常快速和谨慎的鼠标一样消失。

有没有办法改变这一点，还是每个人都受到这个问题的困扰？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T04:17:37.767

当弹出窗口在那里时，您可以按 F2 使其保持不变。或者，您可以将光标放在带黄色下划线的部分，然后按 Ctrl + 1，这将向您显示自动修复建议，并让您有机会再次看到警告。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T04:19:32.990

您是在谈论黄色感叹号警告吗？只要您的鼠标位于感叹号或弹出窗口上，它就不会消失。

# javascript - 在 JavaScript 中转换日期

> ID：758999
> 
> 赞同：5
> 
> 时间：2009-04-17T04:14:07.637
> 
> 标签：javascript, date

如何在 JavaScript 中将一种日期格式转换为另一种格式？

例子：

旧格式是

> 年年/月/日

但我想把它转换成

> DD-MM-YYYY

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-17T04:31:29.357

我认为您可以使用[**jQuery UI**](http://docs.jquery.com/UI/)库的[**datepicker**](http://docs.jquery.com/UI/Datepicker)：使用[**parseDate**](http://docs.jquery.com/UI/Datepicker/parseDate)方法将字符串转换为 Date 对象，然后使用[**formatDate**](http://docs.jquery.com/UI/Datepicker/formatDate)将 Date 对象转换为另一个字符串。检查网站上提供的样品；它们包括格式修饰符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T04:23:02.217

这里 -

```
// Utility function to append a 0 to single-digit numbers
Date.LZ = function(x) {return(x<0||x>9?"":"0")+x};
// Full month names. Change this for local month names
Date.monthNames = new Array('January','February','March','April','May','June','July','August','September','October','November','December');
// Month abbreviations. Change this for local month names
Date.monthAbbreviations = new Array('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec');
// Full day names. Change this for local month names
Date.dayNames = new Array('Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday');
// Day abbreviations. Change this for local month names
Date.dayAbbreviations = new Array('Sun','Mon','Tue','Wed','Thu','Fri','Sat');
// Used for parsing ambiguous dates like 1/2/2000 - default to preferring 'American' format meaning Jan 2.
// Set to false to prefer 'European' format meaning Feb 1
Date.preferAmericanFormat = true;

// If the getFullYear() method is not defined, create it
if (!Date.prototype.getFullYear) { 
  Date.prototype.getFullYear = function() { var yy=this.getYear(); return (yy<1900?yy+1900:yy); } ;
} 

// Parse a string and convert it to a Date object.
// If no format is passed, try a list of common formats.
// If string cannot be parsed, return null.
// Avoids regular expressions to be more portable.
Date.parseString = function(val, format) {
  // If no format is specified, try a few common formats
  if (typeof(format)=="undefined" || format==null || format=="") {
    var generalFormats=new Array('y-M-d','MMM d, y','MMM d,y','y-MMM-d','d-MMM-y','MMM d','MMM-d','d-MMM');
    var monthFirst=new Array('M/d/y','M-d-y','M.d.y','M/d','M-d');
    var dateFirst =new Array('d/M/y','d-M-y','d.M.y','d/M','d-M');
    var checkList=new Array(generalFormats,Date.preferAmericanFormat?monthFirst:dateFirst,Date.preferAmericanFormat?dateFirst:monthFirst);
    for (var i=0; i<checkList.length; i++) {
      var l=checkList[i];
      for (var j=0; j<l.length; j++) {
        var d=Date.parseString(val,l[j]);
        if (d!=null) { 
          return d; 
        }
      }
    }
    return null;
  };

  this.isInteger = function(val) {
    for (var i=0; i < val.length; i++) {
      if ("1234567890".indexOf(val.charAt(i))==-1) { 
        return false; 
      }
    }
    return true;
  };
  this.getInt = function(str,i,minlength,maxlength) {
    for (var x=maxlength; x>=minlength; x--) {
      var token=str.substring(i,i+x);
      if (token.length < minlength) { 
        return null; 
      }
      if (this.isInteger(token)) { 
        return token; 
      }
    }
  return null;
  };
  val=val+"";
  format=format+"";
  var i_val=0;
  var i_format=0;
  var c="";
  var token="";
  var token2="";
  var x,y;
  var year=new Date().getFullYear();
  var month=1;
  var date=1;
  var hh=0;
  var mm=0;
  var ss=0;
  var ampm="";
  while (i_format < format.length) {
    // Get next token from format string
    c=format.charAt(i_format);
    token="";
    while ((format.charAt(i_format)==c) && (i_format < format.length)) {
      token += format.charAt(i_format++);
    }
    // Extract contents of value based on format token
    if (token=="yyyy" || token=="yy" || token=="y") {
      if (token=="yyyy") { 
        x=4;y=4; 
      }
      if (token=="yy") { 
        x=2;y=2; 
      }
      if (token=="y") { 
        x=2;y=4; 
      }
      year=this.getInt(val,i_val,x,y);
      if (year==null) { 
        return null; 
      }
      i_val += year.length;
      if (year.length==2) {
        if (year > 70) { 
          year=1900+(year-0); 
        }
        else { 
          year=2000+(year-0); 
        }
      }
    }
    else if (token=="MMM" || token=="NNN"){
      month=0;
      var names = (token=="MMM"?(Date.monthNames.concat(Date.monthAbbreviations)):Date.monthAbbreviations);
      for (var i=0; i<names.length; i++) {
        var month_name=names[i];
        if (val.substring(i_val,i_val+month_name.length).toLowerCase()==month_name.toLowerCase()) {
          month=(i%12)+1;
          i_val += month_name.length;
          break;
        }
      }
      if ((month < 1)||(month>12)){
        return null;
      }
    }
    else if (token=="EE"||token=="E"){
      var names = (token=="EE"?Date.dayNames:Date.dayAbbreviations);
      for (var i=0; i<names.length; i++) {
        var day_name=names[i];
        if (val.substring(i_val,i_val+day_name.length).toLowerCase()==day_name.toLowerCase()) {
          i_val += day_name.length;
          break;
        }
      }
    }
    else if (token=="MM"||token=="M") {
      month=this.getInt(val,i_val,token.length,2);
      if(month==null||(month<1)||(month>12)){
        return null;
      }
      i_val+=month.length;
    }
    else if (token=="dd"||token=="d") {
      date=this.getInt(val,i_val,token.length,2);
      if(date==null||(date<1)||(date>31)){
        return null;
      }
      i_val+=date.length;
    }
    else if (token=="hh"||token=="h") {
      hh=this.getInt(val,i_val,token.length,2);
      if(hh==null||(hh<1)||(hh>12)){
        return null;
      }
      i_val+=hh.length;
    }
    else if (token=="HH"||token=="H") {
      hh=this.getInt(val,i_val,token.length,2);
      if(hh==null||(hh<0)||(hh>23)){
        return null;
      }
      i_val+=hh.length;
    }
    else if (token=="KK"||token=="K") {
      hh=this.getInt(val,i_val,token.length,2);
      if(hh==null||(hh<0)||(hh>11)){
        return null;
      }
      i_val+=hh.length;
      hh++;
    }
    else if (token=="kk"||token=="k") {
      hh=this.getInt(val,i_val,token.length,2);
      if(hh==null||(hh<1)||(hh>24)){
        return null;
      }
      i_val+=hh.length;
      hh--;
    }
    else if (token=="mm"||token=="m") {
      mm=this.getInt(val,i_val,token.length,2);
      if(mm==null||(mm<0)||(mm>59)){
        return null;
      }
      i_val+=mm.length;
    }
    else if (token=="ss"||token=="s") {
      ss=this.getInt(val,i_val,token.length,2);
      if(ss==null||(ss<0)||(ss>59)){
        return null;
      }
      i_val+=ss.length;
    }
    else if (token=="a") {
      if (val.substring(i_val,i_val+2).toLowerCase()=="am") {
        ampm="AM";
      }
      else if (val.substring(i_val,i_val+2).toLowerCase()=="pm") {
        ampm="PM";
      }
      else {
        return null;
      }
      i_val+=2;
    }
    else {
      if (val.substring(i_val,i_val+token.length)!=token) {
        return null;
      }
      else {
        i_val+=token.length;
      }
    }
  }
  // If there are any trailing characters left in the value, it doesn't match
  if (i_val != val.length) { 
    return null; 
  }
  // Is date valid for month?
  if (month==2) {
    // Check for leap year
    if ( ( (year%4==0)&&(year%100 != 0) ) || (year%400==0) ) { // leap year
      if (date > 29){ 
        return null; 
      }
    }
    else { 
      if (date > 28) { 
        return null; 
      } 
    }
  }
  if ((month==4)||(month==6)||(month==9)||(month==11)) {
    if (date > 30) { 
      return null; 
    }
  }
  // Correct hours value
  if (hh<12 && ampm=="PM") {
    hh=hh-0+12; 
  }
  else if (hh>11 && ampm=="AM") { 
    hh-=12; 
  }
  return new Date(year,month-1,date,hh,mm,ss);
};

// Check if a date string is valid
Date.isValid = function(val,format) {
  return (Date.parseString(val,format) != null);
};

// Check if a date object is before another date object
Date.prototype.isBefore = function(date2) {
  if (date2==null) { 
    return false; 
  }
  return (this.getTime()<date2.getTime());
};

// Check if a date object is after another date object
Date.prototype.isAfter = function(date2) {
  if (date2==null) { 
    return false; 
  }
  return (this.getTime()>date2.getTime());
};

// Check if two date objects have equal dates and times
Date.prototype.equals = function(date2) {
  if (date2==null) { 
    return false; 
  }
  return (this.getTime()==date2.getTime());
};

// Check if two date objects have equal dates, disregarding times
Date.prototype.equalsIgnoreTime = function(date2) {
  if (date2==null) { 
    return false; 
  }
  var d1 = new Date(this.getTime()).clearTime();
  var d2 = new Date(date2.getTime()).clearTime();
  return (d1.getTime()==d2.getTime());
};

// Format a date into a string using a given format string
Date.prototype.format = function(format) {
  format=format+"";
  var result="";
  var i_format=0;
  var c="";
  var token="";
  var y=this.getYear()+"";
  var M=this.getMonth()+1;
  var d=this.getDate();
  var E=this.getDay();
  var H=this.getHours();
  var m=this.getMinutes();
  var s=this.getSeconds();
  var yyyy,yy,MMM,MM,dd,hh,h,mm,ss,ampm,HH,H,KK,K,kk,k;
  // Convert real date parts into formatted versions
  var value=new Object();
  if (y.length < 4) {
    y=""+(+y+1900);
  }
  value["y"]=""+y;
  value["yyyy"]=y;
  value["yy"]=y.substring(2,4);
  value["M"]=M;
  value["MM"]=Date.LZ(M);
  value["MMM"]=Date.monthNames[M-1];
  value["NNN"]=Date.monthAbbreviations[M-1];
  value["d"]=d;
  value["dd"]=Date.LZ(d);
  value["E"]=Date.dayAbbreviations[E];
  value["EE"]=Date.dayNames[E];
  value["H"]=H;
  value["HH"]=Date.LZ(H);
  if (H==0){
    value["h"]=12;
  }
  else if (H>12){
    value["h"]=H-12;
  }
  else {
    value["h"]=H;
  }
  value["hh"]=Date.LZ(value["h"]);
  value["K"]=value["h"]-1;
  value["k"]=value["H"]+1;
  value["KK"]=Date.LZ(value["K"]);
  value["kk"]=Date.LZ(value["k"]);
  if (H > 11) { 
    value["a"]="PM"; 
  }
  else { 
    value["a"]="AM"; 
  }
  value["m"]=m;
  value["mm"]=Date.LZ(m);
  value["s"]=s;
  value["ss"]=Date.LZ(s);
  while (i_format < format.length) {
    c=format.charAt(i_format);
    token="";
    while ((format.charAt(i_format)==c) && (i_format < format.length)) {
      token += format.charAt(i_format++);
    }
    if (typeof(value[token])!="undefined") { 
      result=result + value[token]; 
    }
    else { 
      result=result + token; 
    }
  }
  return result;
};

// Get the full name of the day for a date
Date.prototype.getDayName = function() { 
  return Date.dayNames[this.getDay()];
};

// Get the abbreviation of the day for a date
Date.prototype.getDayAbbreviation = function() { 
  return Date.dayAbbreviations[this.getDay()];
};

// Get the full name of the month for a date
Date.prototype.getMonthName = function() {
  return Date.monthNames[this.getMonth()];
};

// Get the abbreviation of the month for a date
Date.prototype.getMonthAbbreviation = function() { 
  return Date.monthAbbreviations[this.getMonth()];
};

// Clear all time information in a date object
Date.prototype.clearTime = function() {
  this.setHours(0); 
  this.setMinutes(0);
  this.setSeconds(0); 
  this.setMilliseconds(0);
  return this;
};

// Add an amount of time to a date. Negative numbers can be passed to subtract time.
Date.prototype.add = function(interval, number) {
  if (typeof(interval)=="undefined" || interval==null || typeof(number)=="undefined" || number==null) { 
    return this; 
  }
  number = +number;
  if (interval=='y') { // year
    this.setFullYear(this.getFullYear()+number);
  }
  else if (interval=='M') { // Month
    this.setMonth(this.getMonth()+number);
  }
  else if (interval=='d') { // Day
    this.setDate(this.getDate()+number);
  }
  else if (interval=='w') { // Weekday
    var step = (number>0)?1:-1;
    while (number!=0) {
      this.add('d',step);
      while(this.getDay()==0 || this.getDay()==6) { 
        this.add('d',step);
      }
      number -= step;
    }
  }
  else if (interval=='h') { // Hour
    this.setHours(this.getHours() + number);
  }
  else if (interval=='m') { // Minute
    this.setMinutes(this.getMinutes() + number);
  }
  else if (interval=='s') { // Second
    this.setSeconds(this.getSeconds() + number);
  }
  return this;
}; 
```

将此复制到 .js 文件中，并将其包含在您的页面中。

然后您可以在 Date 对象上使用 format() 方法。

您还可以[在此处](http://blog.stevenlevithan.com/archives/date-time-format)找到另一个库。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-14T14:52:58.950

我的日期扩展会很好地做到这一点 - 它们还解析数据格式并进行大量日期数学/比较：

[DP_DateExtensions 库](http://www.depressedpress.com/Content/Development/JavaScript/Extensions/DP_DateExtensions/Index.cfm)

不确定它是否有帮助，但我发现它在几个项目中非常宝贵。日期函数（大部分）基于 CFML（如果重要的话）。

我并不是说它们比给出的其他选择更好——但我为它们感到自豪，并且永远不会（嗯......几乎永远不会）被宠坏了选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-11T05:16:23.080

如果您不使用 jQuery（我想不出为什么，但以防万一），我已经为 Javascript Date 对象创建了一个补丁，它允许您从不同格式的字符串中解析日期并将日期转换为字符串以不同的格式。

您可以在我的博客上查看有关[Javascript Date Formatter](http://miljenkobarbir.com/javascript-date-formatter/)文章的更多信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-12T11:06:14.680

我的回答很晚，但我认为以下解决方案对于这个问题很简单有效。这总是对我有用。

干得好 ：

函数 dateToYMD(date) { var d = date.getDate(); var m = date.getMonth() + 1; var y = date.getFullYear(); 返回 '​​'+ (d <= 9 ? '0' + d : d) + '-' + (m<=9 ? '0' + m : m) + '-' + y ; }****`*********