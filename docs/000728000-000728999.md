# StackOverflow 问答 000728000-000728999

# wpf - MVVM 绑定到 InkCanvas

> ID：728005
> 
> 赞同：5
> 
> 时间：2009-04-07T23:38:53.860
> 
> 标签：wpf, mvvm, inkcanvas

我好像遇到了路障。我们将 MVVM 与 Prism 一起使用，并且有一个需要 Ink Canvas 的视图。我创建了一个从我的 ViewModel 绑定到视图的 StrokeCollection。我可以从我的视图模型中设置集合，但是在用户绘制时视图模型不会发生更改。有没有办法使这项工作？

我的 ViewModel 中的属性如下：

```
private StrokeCollection _strokes;
public StrokeCollection Signature
{
     get
     {
         return _strokes;
     }
     set
     {
         _strokes = value;
         OnPropertyChanged("Signature");
     }
} 
```

这是我的 XAML 绑定行：

```
<InkCanvas x:Name="MyCanvas" Strokes="{Binding Signature, Mode=TwoWay}" /> 
```

出于某种原因，显然 InkCanvas 从未通知 ViewModel 任何更改。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-08T08:34:44.727

您的方法的问题是您假设`InkCanvas`创建了`StrokeCollection`. 它没有 - 它只是从中添加和删除项目。如果集合不可用（即 is `null`），绑定将失败，并且`InkCanvas`不会对其执行*任何*操作。所以：

1.  你需要创建一个`StrokeCollection`
2.  您需要假设集合的内容会发生变化，而不是集合本身

示例代码：

```
public class ViewModel : INotifyPropertyChanged
{
    private readonly StrokeCollection _strokes;

    public ViewModel()
    {
        _strokes = new StrokeCollection();
        (_strokes as INotifyCollectionChanged).CollectionChanged += delegate
        {
            //the strokes have changed
        };
    }

    public event PropertyChangedEventHandler PropertyChanged;

    public StrokeCollection Signature
    {
        get
        {
            return _strokes;
        }
    }

    private void OnPropertyChanged(string propertyName)
    {
        var handler = PropertyChanged;

        if (handler != null)
        {
            handler(this, new PropertyChangedEventArgs(propertyName));
        }
    }
} 
```

和 XAML：

```
<InkCanvas Strokes="{Binding Signature}"/> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-08-12T14:55:38.300

StrokeCollection 类有一个名为“StrokesChanged”的事件，当您在视图中绘制某些内容时，该事件总是被触发。该事件包含更新的笔画集合。

XAML：

```
<Grid>
    <InkCanvas Strokes="{Binding Signature}"/>
</Grid> 
```

虚拟机：

```
public class TestViewModel : INotifyPropertyChanged
{
    public StrokeCollection Signature { get; set; }

    public event PropertyChangedEventHandler PropertyChanged;

    public TestViewModel()
    {
        Signature = new StrokeCollection();
        Signature.StrokesChanged += Signature_StrokesChanged;
    }

    void Signature_StrokesChanged(object sender, StrokeCollectionChangedEventArgs e)
    {
        //PUT A BREAKPOINT HERE AND CHECK
        Signature = (System.Windows.Ink.StrokeCollection)sender;
    }

} 
```

希望能帮助到你！

# nlp - Crawling The Internet

> ID：728006
> 
> 赞同：12
> 
> 时间：2009-04-07T23:39:08.883
> 
> 标签：nlp, web-crawler, information-retrieval, text-mining

I want to crawl for specific things. Specifically events that are taking place like concerts, movies, art gallery openings, etc, etc. Anything that one might spend time going to.

How do I implement a crawler?

I have heard of Grub (grub.org -> Wikia) and Heritix ([http://crawler.archive.org/](http://crawler.archive.org/))

Are there others?

What opinions does everyone have?

-Jason

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-14T21:59:40.647

该主题的优秀介绍性文本是[信息检索简介](http://nlp.stanford.edu/IR-book/)（在线提供全文）。它有一章是关于[Web 抓取](http://nlp.stanford.edu/IR-book/pdf/20crawl.pdf)的，但也许更重要的是，它为您想要对抓取的文档执行的操作提供了基础。

[![信息检索导论](https://i.stack.imgur.com/ZXCu8.jpg)](https://i.stack.imgur.com/ZXCu8.jpg)
[（来源：[stanford.edu](http://nlp.stanford.edu/IR-book/iir.jpg)）]

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-08T00:07:21.780

There's a good book on the subject I can recommend called [Webbots, Spiders, and Screen Scrapers: A Guide to Developing Internet Agents with PHP/CURL](https://rads.stackoverflow.com/amzn/click/com/1593271204).

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-08T02:49:04.590

无论您做什么，请做一个好公民并遵守[robots.txt](http://en.wikipedia.org/wiki/Robots_exclusion_standard)文件。您可能想查看 wikipedia 页面上关于[重点爬虫](http://en.wikipedia.org/wiki/Focused_crawler)的参考资料。刚刚意识到我认识[Topical Web Crawlers: Evaluating Adaptive Algorithms](http://portal.acm.org/citation.cfm?doid=1031114.1031117)的作者之一。小世界。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-09T21:08:36.050

查看[Scrapy](http://scrapy.org/)。它是一个用 Python 编写的开源网络爬虫框架（我听说它与 Django 类似，只是它不提供下载页面的服务）。它易于扩展，分布式/并行，看起来很有前途。

我会使用 Scrapy，因为这样我可以节省我的优势来做一些更琐碎的事情，比如如何从抓取的内容等中提取正确的数据并插入到数据库中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T01:01:17.283

我认为网络爬虫部分将是任务中最简单的部分。困难的部分将是决定访问哪些站点以及如何发现您要访问的站点上的事件。也许您想了解使用[Google](http://code.google.com/apis/gdata/)或[Yahoo API](http://pipes.yahoo.com/pipes/)来获取您想要的数据。他们已经完成了在 Internet 上抓取大量页面的工作——无论如何，在我看来，您可以专注于更棘手的问题，即筛选数据以获取您正在寻找的事件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-07-31T21:52:54.287

Actually writing a scale directed crawler is quite a challenging task. I implemented one at work and maintained it for quite a while. There are a lot of problem that you don't know exist until you write one and hit the problems. Specifically dealing with CDNs and friendly crawling of sites. Adaptive algorithms are very important or you will trip DOS filters. Actually you will anyhow without knowing it if your crawl is big enough.

Things to think about:

*   What's except able throughput?
*   How do you deal with site outages?
*   What happens if you are blocked?
*   Do you want to engage in stealth crawling (contreversial and actually quite hard to get right)?

I have actually written some stuff up that if I ever get around to it I might put online about crawler construction since building a proper one is much tougher than people will tell you. Most of the open source crawlers work well enough for most people so if you can I recommend you use one of those. Which one is a feature/platform choice.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T05:16:23.720

如果您发现爬网成为一项任务，您可能需要考虑构建一个[RSS 聚合器](http://en.wikipedia.org/wiki/Aggregator)并订阅流行事件站点（如 craigslist 和coming.org）的 RSS 提要。

这些站点中的每一个都提供本地化的、可搜索的事件。RSS 为您提供（少数）标准化格式，而不必使用构成网络的所有格式错误的 html...

有像[ROME](https://rome.dev.java.net/) (java) 这样的开源库可以帮助使用 RSS 提要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-14T21:40:24.110

按照[Kevin](https://stackoverflow.com/questions/728006/crawling-the-internet/728595#728595)对 RSS 提要的建议，您可能想查看[Yahoo 管道](http://pipes.yahoo.com/pipes/)。我还没有尝试过，但我认为它们允许您处理多个 RSS 提要并生成网页或更多 RSS 提要。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-08T02:07:24.517

有语言特定要求吗？

我花了一些时间玩玩 Chilkat Spider Lib's for .net 一段时间后进行个人实验，

最后我在那里检查了蜘蛛库，被许可为免费软件，（据我所知，Altho 不是开源的：（）

似乎他们有python Lib。

[http://www.example-code.com/python/pythonspider.asp](http://www.example-code.com/python/pythonspider.asp) #Python [http://www.example-code.com/csharp/spider.asp](http://www.example-code.com/csharp/spider.asp) #.Net

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-15T19:45:51.483

[Nutch 爬行者](http://lucene.apache.org/nutch/)

# asp.net - .net server control performance compromise

> ID：728012
> 
> 赞同：0
> 
> 时间：2009-04-07T23:42:58.233
> 
> 标签：asp.net, ajax, performance, postback

We are finding that for a large sets of data server controls (with the amount of postbacks) they do often times result in a very slow performance. While we don't want to do all the business logic in Javascript, we would like to speed things up.

What were your solutions/ideas? AJAX?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T23:59:18.617

Two easiest places in ASP.NET to start and get the biggest gains:

*   **Reduce ViewState**. The ViewState can very quickly become unwieldy and even plain massive. I've seen developers inadvertently create pages that push down 20mb+ of ViewState. Every communication between client and server has to transmit that data. [Here is a great roundup](http://www.codinghorror.com/blog/archives/000415.html) on how-tos for using the ViewState in a smart way.

*   **Use the [HttpRuntime cache](http://msdn.microsoft.com/en-us/library/system.web.caching.cache.aspx)**. Once you fetch your data from wherever you're getting it (SQL or whatnot), store it in the cache. Always check the cache for the data before attempting to re-fetch it from the original source. The HttpRuntime cache is *extremely* fast.

    The cache link above has some good basic examples on how to add and remove items with the cache.

# ios - UIScrollView: paging horizontally, scrolling vertically?

> ID：728014
> 
> 赞同：90
> 
> 时间：2009-04-07T23:44:00.540
> 
> 标签：ios, objective-c, uiscrollview, scroll-paging

How can I force a `UIScrollView` in which paging and scrolling are on to only move vertically or horizontally at a given moment?

My understanding is that the `directionalLockEnabled` property should achieve this, but a diagonal swipe still causes the view to scroll diagonally instead of restricting motion to a single axis.

Edit: to be clearer, I'd like to allow the user to scroll horizontally OR vertically, but not both simultaneously.

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2009-05-10T03:28:18.543

我必须说，你的处境非常艰难。

请注意，您需要使用 UIScrollView with`pagingEnabled=YES`在页面之间切换，但您需要`pagingEnabled=NO`垂直滚动。

有两种可能的策略。我不知道哪一个会起作用/更容易实现，所以两个都试试。

**第一：**嵌套的 UIScrollViews。坦率地说，我还没有看到有人让这个工作。但是我个人并没有足够努力，我的实践表明，当你足够努力时，你可以[让 UIScrollView 做任何你想做](http://github.com/andreyvit/ScrollingMadness/)的事情。

所以策略是让外层滚动视图只处理水平滚动，而内层滚动视图只处理垂直滚动。要做到这一点，您必须知道 UIScrollView 在内部是如何工作的。它覆盖`hitTest`方法并始终返回自身，以便所有触摸事件都进入 UIScrollView。然后在里面`touchesBegan`，`touchesMoved`等它检查它是否对事件感兴趣，然后处理或传递给内部组件。

为了决定触摸是被处理还是被转发，当你第一次触摸它时 UIScrollView 会启动一个计时器：

*   如果您在 150 毫秒内没有显着移动手指，它会将事件传递到内部视图。

*   如果您在 150 毫秒内显着移动了手指，它就会开始滚动（并且永远不会将事件传递到内部视图）。

    请注意，当您触摸表格（它是滚动视图的子类）并立即开始滚动时，您所触摸的行永远不会突出显示。

*   如果您在 150 毫秒内*没有*显着移动手指并且 UIScrollView 开始将事件传递给内部视图，但是*您*已经将手指移动得足够远以开始滚动，则 UIScrollView 调用`touchesCancelled`内部视图并开始滚动。

    请注意，当您触摸表格时，请稍稍按住手指然后开始滚动，您触摸的行首先突出显示，但随后取消突出显示。

这些事件的顺序可以通过 UIScrollView 的配置来改变：

*   如果`delaysContentTouches`为 NO，则不使用计时器 - 事件立即转到内部控件（但如果您将手指移动得足够远，则会取消）
*   如果`cancelsTouches`为 NO，则一旦将事件发送到控件，将永远不会发生滚动。

请注意，它是 UIScrollView 从 CocoaTouch 接收*所有* `touchesBegin`、`touchesMoved`和事件`touchesEnded`（`touchesCanceled`因为它`hitTest`告诉它这样做）。然后，只要它愿意，它就会将它们转发到内部视图。

现在您已经了解了有关 UIScrollView 的所有信息，您可以更改它的行为。我敢打赌你想优先考虑垂直滚动，这样一旦用户触摸视图并开始移动他的手指（即使是轻微的），视图就会开始在垂直方向滚动；但是当用户在水平方向上移动手指足够远时，您想取消垂直滚动并开始水平滚动。

您希望将外部 UIScrollView 子类化（例如，您将类命名为 RemorsefulScrollView），以便它立即将所有事件转发到内部视图，而不是默认行为，并且只有在检测到显着水平移动时才会滚动。

如何使 RemorsefulScrollView 表现得那样？

*   看起来禁用垂直滚动并设置`delaysContentTouches`为 NO 应该使嵌套的 UIScrollViews 工作。不幸的是，它没有；UIScrollView 似乎对快速运动（无法禁用）进行了一些额外的过滤，因此即使 UIScrollView 只能水平滚动，它总是会吃掉（并忽略）足够快的垂直运动。

    效果非常严重，以至于嵌套滚动视图内的垂直滚动无法使用。（看来您已经完全掌握了这个设置，所以试试吧：按住手指 150 毫秒，然后垂直移动它——嵌套的 UIScrollView 会按预期工作！）

*   这意味着您不能使用 UIScrollView 的代码进行事件处理；您必须覆盖 RemorsefulScrollView 中的所有四种触摸处理方法并首先进行自己的处理，`super`如果您决定使用水平滚动，则仅将事件转发到 (UIScrollView)。

*   但是，您必须传递`touchesBegan`给 UIScrollView，因为您希望它记住未来水平滚动的基本坐标（如果您以后确定它*是*水平滚动）。稍后您将无法发送`touchesBegan`到 UIScrollView，因为您无法存储`touches`参数：它包含将在下一个`touchesMoved`事件之前发生变异的对象，并且您无法重现旧状态。

    所以你必须立即传递`touchesBegan`给 UIScrollView，但是你会隐藏任何进一步`touchesMoved`的事件，直到你决定水平滚动。No`touchesMoved`表示不滚动，所以这个首字母`touchesBegan`不会造成任何伤害。但是一定要设置`delaysContentTouches`为 NO，这样不会有额外的惊喜计时器干扰。

    （题外话——与你不同，UIScrollView*可以*正确存储触摸，并且可以在以后重现和转发原始`touchesBegan`事件。它使用未发布的 API 具有不公平的优势，因此可以在触摸对象发生变异之前克隆它们。）

*   鉴于你总是向前`touchesBegan`，你也必须向前`touchesCancelled`和`touchesEnded`。但是，您必须`touchesEnded`变成`touchesCancelled`，因为 UIScrollView 会将`touchesBegan`,`touchesEnded`序列解释为触摸单击，并将其转发到内部视图。您已经自己转发了正确的事件，因此您永远不希望 UIScrollView 转发任何内容。

基本上这里是你需要做的伪代码。为简单起见，在多点触控事件发生后，我绝不允许水平滚动。

```
// RemorsefulScrollView.h

@interface RemorsefulScrollView : UIScrollView {
  CGPoint _originalPoint;
  BOOL _isHorizontalScroll, _isMultitouch;
  UIView *_currentChild;
}
@end

// RemorsefulScrollView.m

// the numbers from an example in Apple docs, may need to tune them
#define kThresholdX 12.0f
#define kThresholdY 4.0f

@implementation RemorsefulScrollView

- (id)initWithFrame:(CGRect)frame {
  if (self = [super initWithFrame:frame]) {
    self.delaysContentTouches = NO;
  }
  return self;
}

- (id)initWithCoder:(NSCoder *)coder {
  if (self = [super initWithCoder:coder]) {
    self.delaysContentTouches = NO;
  }
  return self;
}

- (UIView *)honestHitTest:(CGPoint)point withEvent:(UIEvent *)event {
  UIView *result = nil;
  for (UIView *child in self.subviews)
    if ([child pointInside:point withEvent:event])
      if ((result = [child hitTest:point withEvent:event]) != nil)
        break;
  return result;
}

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
    [super touchesBegan:touches withEvent:event]; // always forward touchesBegan -- there's no way to forward it later
    if (_isHorizontalScroll)
      return; // UIScrollView is in charge now
    if ([touches count] == [[event touchesForView:self] count]) { // initial touch
      _originalPoint = [[touches anyObject] locationInView:self];
    _currentChild = [self honestHitTest:_originalPoint withEvent:event];
    _isMultitouch = NO;
    }
  _isMultitouch |= ([[event touchesForView:self] count] > 1);
  [_currentChild touchesBegan:touches withEvent:event];
}

- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event {
  if (!_isHorizontalScroll && !_isMultitouch) {
    CGPoint point = [[touches anyObject] locationInView:self];
    if (fabsf(_originalPoint.x - point.x) > kThresholdX && fabsf(_originalPoint.y - point.y) < kThresholdY) {
      _isHorizontalScroll = YES;
      [_currentChild touchesCancelled:[event touchesForView:self] withEvent:event]
    }
  }
  if (_isHorizontalScroll)
    [super touchesMoved:touches withEvent:event]; // UIScrollView only kicks in on horizontal scroll
  else
    [_currentChild touchesMoved:touches withEvent:event];
}

- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event {
  if (_isHorizontalScroll)
    [super touchesEnded:touches withEvent:event];
    else {
    [super touchesCancelled:touches withEvent:event];
    [_currentChild touchesEnded:touches withEvent:event];
    }
}

- (void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event {
  [super touchesCancelled:touches withEvent:event];
  if (!_isHorizontalScroll)
    [_currentChild touchesCancelled:touches withEvent:event];
}

@end 
```

我没有尝试运行甚至编译它（并在纯文本编辑器中输入了整个类），但是您可以从上面的内容开始，并希望它能够正常工作。

我看到的唯一隐藏的问题是，如果您将任何非 UIScrollView 子视图添加到 RemorsefulScrollView，如果孩子并不总是像 UIScrollView 那样处理触摸，您转发给孩子的触摸事件可能会通过响应链返回给您。一个防弹的 RemorsefulScrollView 实现可以防止`touchesXxx`重新进入。

**第二种策略：**如果由于某种原因嵌套的 UIScrollViews 无法正常工作或证明太难以正确，您可以尝试只使用一个 UIScrollView，`pagingEnabled`从您的`scrollViewDidScroll`委托方法动态切换其属性。

为了防止对角滚动，您应该首先尝试记住 contentOffset ，如果检测到对角移动，请`scrollViewWillBeginDragging`检查并重置里面的 contentOffset 。`scrollViewDidScroll`另一种尝试的策略是将 contentSize 重置为仅在一个方向上启用滚动，一旦您决定用户手指的方向。（UIScrollView 似乎很宽容地从其委托方法中摆弄 contentSize 和 contentOffset。）

如果这不起作用或导致视觉效果草率，则必须覆盖`touchesBegan`等`touchesMoved`，而不是将对角线移动事件转发到 UIScrollView。（但是，在这种情况下，用户体验将不是最理想的，因为您将不得不忽略对角线的移动，而不是强迫它们向一个方向移动。如果您真的很喜欢冒险，您可以编写自己的 UITouch 类似的东西，比如 RevengeTouch。目标-C 是普通的旧 C，世界上没有比 C 更鸭式的了；只要没有人检查对象的真实类，我相信没有人这样做，你可以让任何类看起来像任何其他类。这打开了可以用您想要的任何坐标合成您想要的任何触摸。）

**备份策略： TTScrollView 是**[Three20 库](http://github.com/joehewitt/three20/tree/master)中 UIScrollView 的合理重新实现。不幸的是，它对用户来说感觉非常不自然和非 iphonish。但是如果使用 UIScrollView 的每一次尝试都失败了，你可以回退到自定义编码的滚动视图。如果可能的话，我建议不要这样做；使用 UIScrollView 可确保您获得本机外观，无论它在未来的 iPhone OS 版本中如何发展。

好吧，这篇小论文有点太长了。在几天前的 ScrollingMadness 工作之后，我仍然喜欢 UIScrollView 游戏。

PS 如果你得到这些工作并且想要分享，请将相关代码通过电子邮件发送到 andreyvit@gmail.com，我很乐意将它包含在我的[ScrollingMadness 技巧包中](http://github.com/andreyvit/ScrollingMadness/)。

PPS 将这篇小文章添加到 ScrollingMadness README。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2010-07-07T18:51:25.137

这对我每次都有效...

```
scrollView.contentSize = CGSizeMake(scrollView.frame.size.width * NumberOfPages, 1); 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2013-11-12T12:17:23.473

对于像我这样的懒人：

设置`scrollview.directionalLockEnabled`为`YES`

```
- (void) scrollViewWillBeginDragging: (UIScrollView *) scrollView
{
    self.oldContentOffset = scrollView.contentOffset;
}

- (void) scrollViewDidScroll: (UIScrollView *) scrollView
{
    if (scrollView.contentOffset.x != self.oldContentOffset.x)
    {
        scrollView.pagingEnabled = YES;
        scrollView.contentOffset = CGPointMake(scrollView.contentOffset.x,
                                               self.oldContentOffset.y);
    }
    else
    {
        scrollView.pagingEnabled = NO;
    }
}

- (void) scrollViewDidEndDecelerating: (UIScrollView *) scrollView
{
    self.oldContentOffset = scrollView.contentOffset;
} 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-11-09T15:41:07.410

我使用以下方法解决了这个问题，希望对您有所帮助。

首先在您的控制器头文件中定义以下变量。

```
CGPoint startPos;
int     scrollDirection; 
```

*当您的委托收到**scrollViewWillBeginDragging**消息时， *startPos*将保留*contentOffset值。*所以在这个方法中我们这样做；*

 ***```
- (void)scrollViewWillBeginDragging:(UIScrollView *)scrollView{
    startPos = scrollView.contentOffset;
    scrollDirection=0;
} 
```

然后我们使用这些值来确定用户在**scrollViewDidScroll**消息中的预期滚动方向。

```
- (void)scrollViewDidScroll:(UIScrollView *)scrollView{

   if (scrollDirection==0){//we need to determine direction
       //use the difference between positions to determine the direction.
       if (abs(startPos.x-scrollView.contentOffset.x)<abs(startPos.y-scrollView.contentOffset.y)){          
          NSLog(@"Vertical Scrolling");
          scrollDirection=1;
       } else {
          NSLog(@"Horitonzal Scrolling");
          scrollDirection=2;
       }
    }
//Update scroll position of the scrollview according to detected direction.     
    if (scrollDirection==1) {
       [scrollView setContentOffset:CGPointMake(startPos.x,scrollView.contentOffset.y) animated:NO];
    } else if (scrollDirection==2){
       [scrollView setContentOffset:CGPointMake(scrollView.contentOffset.x,startPos.y) animated:NO];
    }
 } 
```

最后，我们必须在用户端拖动时停止所有更新操作；

```
 - (void)scrollViewDidEndDragging:(UIScrollView *)scrollView willDecelerate:(BOOL)decelerate{
    if (decelerate) {
       scrollDirection=3;
    }
 } 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2010-03-04T01:04:41.037

我可能在这里挖坟，但我今天偶然发现了这篇文章，因为我试图解决同样的问题。这是我的解决方案，似乎效果很好。

我想显示一屏内容，但允许用户滚动到其他 4 个屏幕中的一个，上下左右滚动。我有一个大小为 320x480 且 contentSize 为 960x1440 的 UIScrollView。内容偏移量从 320,480 开始。在 scrollViewDidEndDecelerating: 中，我重绘了 5 个视图（中心视图和周围的 4 个视图），并将内容偏移量重置为 320,480。

这是我的解决方案的精髓，scrollViewDidScroll: 方法。

```
- (void)scrollViewDidScroll:(UIScrollView *)scrollView
{   
    if (!scrollingVertically && ! scrollingHorizontally)
    {
        int xDiff = abs(scrollView.contentOffset.x - 320);
        int yDiff = abs(scrollView.contentOffset.y - 480);

        if (xDiff > yDiff)
        {
            scrollingHorizontally = YES;
        }
        else if (xDiff < yDiff)
        {
            scrollingVertically = YES;
        }
    }

    if (scrollingHorizontally)
    {
        scrollView.contentOffset = CGPointMake(scrollView.contentOffset.x, 480);
    }
    else if (scrollingVertically)
    {
        scrollView.contentOffset = CGPointMake(320, scrollView.contentOffset.y);
    }
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-06-05T19:26:30.587

伙计们，就像使子视图高度与滚动视图高度和内容大小高度一样简单。然后禁用垂直滚动。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-08-28T13:59:58.980

Here is my implementation of a paged `UIScrollView` that only allow orthogonal scrolls. Be sure to set `pagingEnabled` to `YES`.

PagedOrthoScrollView.h

```
@interface PagedOrthoScrollView : UIScrollView
@end 
```

PagedOrthoScrollView.m

```
#import "PagedOrthoScrollView.h"

typedef enum {
  PagedOrthoScrollViewLockDirectionNone,
  PagedOrthoScrollViewLockDirectionVertical,
  PagedOrthoScrollViewLockDirectionHorizontal
} PagedOrthoScrollViewLockDirection; 

@interface PagedOrthoScrollView ()
@property(nonatomic, assign) PagedOrthoScrollViewLockDirection dirLock;
@property(nonatomic, assign) CGFloat valueLock;
@end

@implementation PagedOrthoScrollView
@synthesize dirLock;
@synthesize valueLock;

- (id)initWithFrame:(CGRect)frame {
  self = [super initWithFrame:frame];
  if (self == nil) {
    return self;
  }

  self.dirLock = PagedOrthoScrollViewLockDirectionNone;
  self.valueLock = 0;

  return self;
}

- (void)setBounds:(CGRect)bounds {
  int mx, my;

  if (self.dirLock == PagedOrthoScrollViewLockDirectionNone) {
    // is on even page coordinates, set dir lock and lock value to closest page 
    mx = abs((int)CGRectGetMinX(bounds) % (int)CGRectGetWidth(self.bounds));
    if (mx != 0) {
      self.dirLock = PagedOrthoScrollViewLockDirectionHorizontal;
      self.valueLock = (round(CGRectGetMinY(bounds) / CGRectGetHeight(self.bounds)) *
                        CGRectGetHeight(self.bounds));
    } else {
      self.dirLock = PagedOrthoScrollViewLockDirectionVertical;
      self.valueLock = (round(CGRectGetMinX(bounds) / CGRectGetWidth(self.bounds)) *
                        CGRectGetWidth(self.bounds));
    }

    // show only possible scroll indicator
    self.showsVerticalScrollIndicator = dirLock == PagedOrthoScrollViewLockDirectionVertical;
    self.showsHorizontalScrollIndicator = dirLock == PagedOrthoScrollViewLockDirectionHorizontal;
  }

  if (self.dirLock == PagedOrthoScrollViewLockDirectionHorizontal) {
    bounds.origin.y = self.valueLock;
  } else {
    bounds.origin.x = self.valueLock;
  }

  mx = abs((int)CGRectGetMinX(bounds) % (int)CGRectGetWidth(self.bounds));
  my = abs((int)CGRectGetMinY(bounds) % (int)CGRectGetHeight(self.bounds));

  if (mx == 0 && my == 0) {
    // is on even page coordinates, reset lock
    self.dirLock = PagedOrthoScrollViewLockDirectionNone;
  }

  [super setBounds:bounds];
}

@end 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-07-02T18:50:31.833

我也必须解决这个问题，虽然 Andrey Tarantsov 的回答肯定有很多有用的信息可以帮助理解`UIScrollViews`工作原理，但我觉得解决方案有点过于复杂。我的解决方案不涉及任何子类化或触摸转发，如下所示：

1.  创建两个嵌套滚动视图，每个方向一个。
2.  创建两个 dummy `UIPanGestureRecognizers`，每个方向再创建一个。
3.  `UIScrollViews`通过使用选择器在panGestureRecognizer 属性和与`UIPanGestureRecognizer`垂直于 UIScrollView 所需滚动方向的方向相对应的虚拟对象之间创建失败依赖项`UIGestureRecognizer's` `-requireGestureRecognizerToFail:`。
4.  在`-gestureRecognizerShouldBegin:`您的虚拟 UIPanGestureRecognizers 的回调中，使用手势的 -translationInView: 选择器计算平移的初始方向（在`UIPanGestureRecognizers`您的触摸转换到足以注册为平移之前，您不会调用此委托回调）。根据计算的方向允许或禁止您的手势识别器开始，这反过来应该控制是否允许垂直 UIScrollView 平移手势识别器开始。
5.  在`-gestureRecognizer:shouldRecognizeSimultaneouslyWithGestureRecognizer:`中，不要让你的假人`UIPanGestureRecognizers`在滚动的同时运行（除非你有一些你想要添加的额外行为）。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-10-21T12:39:14.940

为了将来参考，我以 Andrey Tanasov 的回答为基础，提出了以下可以正常工作的解决方案。

首先定义一个变量来存储 contentOffset 并将其设置为 0,0 坐标

```
var positionScroll = CGPointMake(0, 0) 
```

现在在 scrollView 委托中实现以下内容：

```
override func scrollViewWillBeginDragging(scrollView: UIScrollView) {
    // Note that we are getting a reference to self.scrollView and not the scrollView referenced passed by the method
    // For some reason, not doing this fails to get the logic to work
    self.positionScroll = (self.scrollView?.contentOffset)!
}

override func scrollViewDidScroll(scrollView: UIScrollView) {

    // Check that contentOffset is not nil
    // We do this because the scrollViewDidScroll method is called on viewDidLoad
    if self.scrollView?.contentOffset != nil {

        // The user wants to scroll on the X axis
        if self.scrollView?.contentOffset.x > self.positionScroll.x || self.scrollView?.contentOffset.x < self.positionScroll.x {

            // Reset the Y position of the scrollView to what it was BEFORE scrolling started
            self.scrollView?.contentOffset = CGPointMake((self.scrollView?.contentOffset.x)!, self.positionScroll.y);
            self.scrollView?.pagingEnabled = true
        }

        // The user wants to scroll on the Y axis
        else {
            // Reset the X position of the scrollView to what it was BEFORE scrolling started
            self.scrollView?.contentOffset = CGPointMake(self.positionScroll.x, (self.scrollView?.contentOffset.y)!);
            self.collectionView?.pagingEnabled = false
        }

    }

} 
```

希望这可以帮助。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-09-12T18:08:07.493

我所做的是创建一个带有视图屏幕大小的框架的分页 UIScrollView，并将内容大小设置为我所有内容所需的宽度和 1 的高度（感谢 Tonetel）。然后我创建了菜单 UIScrollView 页面，每个页面都设置了框架，视图屏幕的大小，并将每个页面的内容大小设置为屏幕的宽度和每个页面的必要高度。然后我简单地将每个菜单页面添加到分页视图中。确保在分页滚动视图上启用分页但在菜单视图上禁用（默认情况下应禁用），您应该一切顺利。

由于内容高度，分页滚动视图现在水平滚动，但不是垂直滚动。由于内容大小的限制，每个页面都会垂直滚动，但不会水平滚动。

如果该解释有待改进，则为代码：

```
UIScrollView *newPagingScrollView =  [[UIScrollView alloc] initWithFrame:self.view.bounds]; 
[newPagingScrollView setPagingEnabled:YES];
[newPagingScrollView setShowsVerticalScrollIndicator:NO];
[newPagingScrollView setShowsHorizontalScrollIndicator:NO];
[newPagingScrollView setDelegate:self];
[newPagingScrollView setContentSize:CGSizeMake(self.view.bounds.size.width * NumberOfDetailPages, 1)];
[self.view addSubview:newPagingScrollView];

float pageX = 0;

for (int i = 0; i < NumberOfDetailPages; i++)
{               
    CGRect pageFrame = (CGRect) 
    {
        .origin = CGPointMake(pageX, pagingScrollView.bounds.origin.y), 
        .size = pagingScrollView.bounds.size
    };
    UIScrollView *newPage = [self createNewPageFromIndex:i ToPageFrame:pageFrame]; // newPage.contentSize custom set in here        
    [pagingScrollView addSubview:newPage];

    pageX += pageFrame.size.width;  
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-08-07T17:25:05.527

谢谢托内特尔。我稍微修改了您的方法，但这正是防止水平滚动所需要的。

```
self.scrollView.contentSize = CGSizeMake(self.scrollView.contentSize.width, 1); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-07-15T05:34:50.883

这是 icompot 的改进解决方案，对我来说非常不稳定。这个工作正常，很容易实现：

```
- (void) scrollViewWillBeginDragging: (UIScrollView *) scrollView
{
    self.oldContentOffset = scrollView.contentOffset;
}

- (void) scrollViewDidScroll: (UIScrollView *) scrollView
{    

    float XOffset = fabsf(self.oldContentOffset.x - scrollView.contentOffset.x );
    float YOffset = fabsf(self.oldContentOffset.y - scrollView.contentOffset.y );

        if (scrollView.contentOffset.x != self.oldContentOffset.x && (XOffset >= YOffset) )
        {

            scrollView.pagingEnabled = YES;
            scrollView.contentOffset = CGPointMake(scrollView.contentOffset.x,
                                                   self.oldContentOffset.y);

        }
        else
        {
            scrollView.pagingEnabled = NO;
               scrollView.contentOffset = CGPointMake( self.oldContentOffset.x,
                                                   scrollView.contentOffset.y);
        }

}

- (void) scrollViewDidEndDecelerating: (UIScrollView *) scrollView
{
    self.oldContentOffset = scrollView.contentOffset;
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-07-10T09:58:12.973

如果您有一个大滚动视图...并且您想限制对角滚动[http://chandanshetty01.blogspot.in/2012/07/restricting-diagonal-scrolling-in.html](http://chandanshetty01.blogspot.in/2012/07/restricting-diagonal-scrolling-in.html)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-08T00:28:55.253

From the docs:

"the default value is NO, which means that scrolling is permitted in both horizontal and vertical directions. If the value is YES and the user begins dragging in one general direction (horizontally or vertically), the scroll view disables scrolling in the other direction."

I think the important part is "if... the user *begins* dragging in one general direction". So if they begin dragging diagonally this doesn't kick in. Not that these docs are always reliable when it comes to interpretation - but that does seem to fit with what you are seeing.

This actually seems sensible. I have to ask - why do you want to restrict to only horizontal or only vertical at any time? Perhaps UIScrollView is not the tool for you?

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-10-09T07:04:55.297

需要在和中重置`_isHorizontalScroll`为 NO 。`touchesEnded``touchesCancelled`

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-08-17T11:02:34.297

我的视图由 10 个水平视图组成，其中一些视图由多个垂直视图组成，所以你会得到这样的结果：

```
 1.0   2.0   3.1    4.1
      2.1   3.1
      2.2
      2.3
```

在水平轴和垂直轴上启用分页

该视图还具有以下属性：

```
[self setDelaysContentTouches:NO];
[self setMultipleTouchEnabled:NO];
[self setDirectionalLockEnabled:YES];
```

现在为了防止对角滚动这样做：

```
-(void)scrollViewDidScroll:(UIScrollView *)scrollView {
    int pageWidth = 768;
    int pageHeight = 1024;
    int subPage =round(self.contentOffset.y / pageHeight);
    if ((int)self.contentOffset.x % pageWidth != 0 && (int)self.contentOffset.y % pageHeight != 0) {
        [self setContentOffset:CGPointMake(self.contentOffset.x, subPage * pageHeight];
    } 
} 
```

对我来说就像一个魅力！

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2021-05-31T10:39:07.327

这是本杰明答案的Swift [**5**](https://stackoverflow.com/a/33259561/10208284)**版本**[](https://stackoverflow.com/a/33259561/10208284)

 **```
// add this property to your view controller
var positionScroll: CGPoint = .zero

// make sure to set isDirectionalLockEnabled to true on your scroll view
self.scrollView.isDirectionalLockEnabled = true

// then in scrollview/collectionview/tableview delegate
func scrollViewWillBeginDragging(_ scrollView: UIScrollView) {
    positionScroll = scrollView.contentOffset
}

func scrollViewDidScroll(_ scrollView: UIScrollView) {
    // The user wants to scroll on the X axis
    if scrollView.contentOffset.x > positionScroll.x || scrollView.contentOffset.x < positionScroll.x {
        // Reset the Y position of the scrollView to what it was before scrolling started
        scrollView.contentOffset = CGPoint(x: scrollView.contentOffset.x, y: positionScroll.y)
        scrollView.isPagingEnabled = true
    } else {
        // The user wants to scroll on the Y axis
        // Reset the X position of the scrollView to what it was before scrolling started
        scrollView.contentOffset = CGPoint(x: positionScroll.x, y: scrollView.contentOffset.y)
        scrollView.isPagingEnabled = false
    }
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-06-09T06:05:33.217

如果您还没有在 3.0 测试版中尝试过这样做，我建议您试一试。我目前正在滚动视图中使用一系列表格视图，它的工作方式与预期一样。（好吧，无论如何，滚动确实如此。在寻找完全不同问题的解决方案时发现了这个问题......）

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-06-28T12:00:18.977

对于那些在@AndreyTarantsov 寻找 Swift 的人来说，第二个解决方案在代码中是这样的：

```
 var positionScroll:CGFloat = 0

    func scrollViewWillBeginDragging(scrollView: UIScrollView) {
        positionScroll = self.theScroll.contentOffset.x
    }

    func scrollViewDidScroll(scrollView: UIScrollView) {
        if self.theScroll.contentOffset.x > self.positionScroll || self.theScroll.contentOffset.x < self.positionScroll{
             self.theScroll.pagingEnabled = true
        }else{
            self.theScroll.pagingEnabled = false
        }
    } 
```

我们在这里所做的是在滚动视图被拖动之前保持当前位置，然后检查 x 与 x 的当前位置相比是否增加或减少。如果是，则将 pagingEnabled 设置为 true，如果否（y 已增加/减少），则将 pagingEnabled 设置为 false

希望对新人有用！

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-09-04T06:46:56.057

我设法通过实现 scrollViewDidBeginDragging(_:) 并查看底层 UIPanGestureRecognizer 的速度来解决这个问题。

注意：使用此解决方案，scrollView 将忽略每个对角线的平移。

```
override func scrollViewWillBeginDragging(_ scrollView: UIScrollView) {
    super.scrollViewWillBeginDragging(scrollView)
    let velocity = scrollView.panGestureRecognizer.velocity(in: scrollView)
    if velocity.x != 0 && velocity.y != 0 {
        scrollView.panGestureRecognizer.isEnabled = false
        scrollView.panGestureRecognizer.isEnabled = true
    }
} 
```

* * *

## 回答 #21

> 赞同：-3
> 
> 时间：2009-04-07T23:47:52.730

If you are using interface builder to design your interface - this could be done quite easily.

In interface builder simply click on the UIScrollView and select the option (in the inspector) that limits it to only one way scrolling.

# javascript - 在javascript中计算网页完全加载的元素

> ID：728017
> 
> 赞同：2
> 
> 时间：2009-04-07T23:44:58.977
> 
> 标签：javascript, html, dom

有没有办法找出通过javascript在网页中加载多少元素？
例如，我将向访问者展示如下内容：

> 已加载 3 个对象，还剩 10 个！请稍等。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T23:51:15.390

如果“元素”是指 DOM 元素，则不。在加载之前您不知道它们存在，并且在加载完成之前尝试执行 DOM 查询并不是很可靠。

如果你的意思是“图像”或类似的东西，你可以在你的页面上放这样的东西：

```
<div id="loadingMessageContainer"></div> 
```

并将其放在页面底部（下`</body>`）

```
<script type="text/javascript">
var imageCount = 0;
var imagesLoaded = 0;

//a function to execute when each image is loaded ("event handler")
function handleImageLoad() {
    imagesLoaded++;
    updateImageDisplay();
}

//a function which updates your message in the page
function updateImageDisplay() {
    var displayContainer = document.getElementById('loadingMessageContainer');
    var remaining = imageCount - imagesLoaded;
    displayContainer.innerHTML = imagesLoaded + ' objects loaded, ' + remaining + ' remain. Please wait.';
}

//get # of images on page and attach the OnLoad event handler
var images = document.getElementsByTagName('img');
imageCount = images.length;
for(var i=0;i<images.length;i++) {
    images[i].onload = handleImageLoad;
}
</script> 
```

# c# - 在 C# 中解析字符串；有更清洁的方法吗？

> ID：728018
> 
> 赞同：5
> 
> 时间：2009-04-07T23:45:08.387
> 
> 标签：c#, .net, parsing

C#、.NET 3.5

这对我来说只是闻起来很丑，但我想不出别的办法。

给定一个格式为“Joe Smith (jsmith)”（无引号）的字符串，我想只解析括号内的 'jsmith' 字符串。我想出了这个：

```
private static string DecipherUserName( string user )
{
    if( !user.Contains( "(" ) )
        return user;

    int start = user.IndexOf( "(" );

    return user.Substring( start ).Replace( "(", string.Empty ).Replace( ")", string.Empty );
} 
```

除了我对 RegEx 的（不）健康的厌恶之外，是否有更简单的方法来解析子字符串？

**编辑：** 为了澄清，要解析的字符串将始终为：“Joe Smith (jsmith)”（无引号）。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-07T23:51:57.323

正则表达式非常有用，以至于您咬紧牙关学习它们可以省去很多心痛。不是整个shebang，只是基础知识。

一个有效的正则表达式是“\w+\((.*)\)” - jsmith 将在 Match.Groups[1] 中。

获取正则表达式的一种简单方法是找到一个网站，让您输入正则表达式和一些文本，然后吐出匹配项......

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-07T23:55:37.347

您不需要第一次替换，因为您可以将 1 添加到“（”位置。

```
private static string DecipherUserName (string user) {           
    int start = user.IndexOf( "(" );
    if (start == -1)
        return user;
    return user.Substring (start+1).Replace( ")", string.Empty );
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-07T23:58:04.220

有点像黑客...... ^^

```
return user.Substring(user.IndexOf('(') + 1).TrimEnd(')'); 
```

如果`user`不包含左括号，则`IndexOf()`返回`-1`，我们加一，得到零，然后`SubString()`返回整个字符串。`TrimEnd()`除非用户名以右括号结尾，否则无效。

如果`user`包含左括号，`IndexOf()`则返回其索引，我们通过加一来跳过左括号，然后用 提取字符串的其余部分`Substring()`。最后，我们用 . 删除右括号`TrimEnd()`。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-08T03:56:20.217

如果用户字符串始终采用“Joe Smith (jsmith)”的形式，这应该可以工作。

```
private static string DecipherUserName(string user)
{
    string[] names = user.Split(new char[] {'(', ')'});
    return names.Length > 2 ? names[1] : user;
} 
```

如果用户字符串始终是“Joe Smith (jsmith)”，这将始终有效。

```
private static string DecipherUserName(string user)
{
    return "jsmith";
} 
```

第二个条目仅用于幽默目的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T23:49:30.497

由于 IndexOf 函数将在值不存在时返回 -1，因此您可以做一些稍微不同的事情......

```
private static string DecipherUserName( string user )
{           
   int start = user.IndexOf( "(" );

   if (start > -1)
   {
      return user.Substring( start ).Replace( "(", string.Empty ).Replace( ")", string.Empty );
   }
   else
   {
      return user;
   }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T00:10:14.643

我会用

```
int start=user.IndexOf('(');
if (start != -1) {
  end = user.IndexOf(')', start);
  return user.Substring(start+1,end-start-1);
} else
  return user; 
```

但这只是表面上的改变：在 IndexOf 中使用字符会快一点，并且使用 Substring 方法似乎更准确地表达了应该做什么（如果你有多对括号，该方法会更健壮......）

也就是说，*Daniel L*的方法（使用`String.Split`）可能更简单（但不能很好地处理格式错误的字符串，并且必须构造一个字符串数组）。

总而言之，我建议您克服对正则表达式的厌恶，因为这种情况正是它们的目的:-) ...

# function - 如何省略调用函数的 $null 参数？

> ID：728022
> 
> 赞同：1
> 
> 时间：2009-04-07T23:46:13.390
> 
> 标签：function, powershell, arguments

考虑这样的功能：

```
$missed = "{716C1AD7-0DA6-45e6-854E-4B466508EB96}"

function Test($foo = $missed, $bar = $missed)
{
  if(!$foo)
  {
    throw "error"
  }

  if(!$bar)
  {
    throw "error"
  }
} 
```

我想这样调用这个函数

```
Test -foo $foo -bar $bar 
```

但如果 $foo 或 $bar 为 $null，则会抛出异常。天真的解决方案是

```
if($foo -and $bar)
{
  Test -foo $foo -bar $bar
}
elseif ($foo)
{
  Test -foo $foo
}
elseif ($bar)
{
  Test -bar $bar
}
else
{
  Test
} 
```

如何在一/两行中重写这个 if/else 块？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T00:27:56.637

由于您无法控制 Test 功能，因此您可以这样做：

```
$params = @()
if ($foo) {
    $params += "-Foo","`$foo"
}
if ($bar) {
    $params += "-Bar","`$bar"
}
Invoke-Expression "Test $params" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T03:19:22.450

```
function m ($x) {if ($x) {$x} else {$missed}}

Test -foo (m $foo) -bar (m $bar) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T00:12:04.467

您可以将函数编写为 -

if (!$foo) {$foo = $missed}
if (!$bar) {$bar = $missed}

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-26T19:51:28.733

您可以按如下方式使用“飞溅”：

```
$params = @{}
if ($foo) {$params['foo'] = $foo}
if ($bar) {$params['bar'] = $bar}
Test @params 
```

它并不短，但它通常是一个有用的技巧。

# java - 生成 Jena Bnode ID

> ID：728025
> 
> 赞同：0
> 
> 时间：2009-04-07T23:48:00.267
> 
> 标签：java, ontology, jena

有没有办法覆盖 Jena 生成匿名节点 ID 的默认方法？

理想情况下，我想向 Jena 传递一个生成 ID 的函子，这样我就可以使它们在全球范围内独一无二（而不仅仅是机器独有的）。每当构造 AnonId 时都应使用仿函数。

```
public interface IdGenerator {
   public String createId() {
      // create a globally unique ID
      ...
      return uid;
   }
} 
```

[这与我之前的问题](https://stackoverflow.com/questions/727449/synchronizing-jena-ontmodels-with-bnodes)有些相关。

**编辑**：我意识到 AnonId 有一个带有 id 参数的构造函数。我希望避免到处调用这个构造函数，而是简单地告诉 Jena（一次）如何生成 ID。

**编辑 2**：即使我不介意到处调用该构造函数，这也可能是不可能的，因为匿名节点可能是由我无权访问的库代码创建的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-06-05T12:41:19.813

Jena 没有任何用于插入不同`AnonId`生成器的钩子。s 的创建`AnonId`也不是集中在一个地方，因此没有一种简单的方法来强制使用它们`new AnonId(String)`。实现目标的最佳方法是修补`AnonId`源代码，这很简单。

FWIW，`AnonId`代码已经有两种不同的方式来生成 ID，所以在 Jena 代码库中添加一个抽象可能是一个合理的想法。

# domain-driven-design - DDD, related entities in master detail relationships

> ID：728040
> 
> 赞同：1
> 
> 时间：2009-04-07T23:57:43.473
> 
> 标签：domain-driven-design

As I understand it all DDD entities should have an ID. So my question is in a master detail relationship, say a Product and a ProductDetail, should the ProductDetail have any knowledge of the Product? Is it necesarry with a ProductID property in the ProductDetail class? In a database this is of course normal as it is the only way to link the two objects but is this best practice in DDD? I am using Linq2Sql as a ORM mapper so this comes as a given but I think this is not the right way. Anybody with some words of wisdom on this?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-26T03:15:01.617

最终用户将如何检索 ProductDetail？如果答案是他们可能会从 Product 导航到它，那么 ProductDetail 只是 Product 的一个属性，或者是 ProductDetails 集合的一部分，它是 Product 的一个属性。

因此，在您的面向对象代码中，ProductDetail 对象不需要引用父 Product。

现在在您的数据库中，您可能会有一个带有 Id 列的 Product 主表。然后，您有一个 ProductDetail 的子表，该表具有与其相关的 Product 的 Id 的外键。

记住领域驱动设计原则仅适用于您的 OO 代码非常**重要。**关系数据库和关系数据建模完全不同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:57:02.567

外键是关系数据模型的产物。对象模型使用容器的概念进行操作。因此，Order 包含一组订单行。订单行包含产品等。

# c# - 如何阻止 UpdatePanel 导致整个页面回发？

> ID：728043
> 
> 赞同：15
> 
> 时间：2009-04-07T23:58:36.683
> 
> 标签：c#, asp.net, .net-3.5, updatepanel, community-server

我正在使用 .NET 3.5 并在 Community Server 2008 框架内构建页面。

在其中一个页面上，我试图让 UpdatePanel 工作。

我直接从 ASP.NET 网站获取了一个示例，*通过单击按钮将 UpdatePanel 中的时间更新为当前时间，*但由于某种原因，当我尝试执行该功能时，整个页面都会刷新。

这是我所拥有的：

```
protected void Button1_Click(object sender, EventArgs e)
{
    Label1.Text = "Panel refreshed at " + DateTime.Now.ToString();
    Label2.Text = "Panel refreshed at " + DateTime.Now.ToString();
} 
```

```
<asp:ScriptManager ID="ScriptManager1" runat="server"/>

<asp:UpdatePanel ID="UpdatePanel1" runat="server">
    <ContentTemplate>
        <fieldset>
            <legend>UpdatePanel</legend>
            <asp:Label ID="Label1" runat="server" Text="Panel created."></asp:Label><br />
            <asp:Button ID="Button1" runat="server" OnClick="Button1_Click" Text="Button" />
        </fieldset>
    </ContentTemplate>
</asp:UpdatePanel> 
```

每当我单击按钮时，确保面板会更新 - 但整个页面都会发回！我可以看到整个页面在闪烁。我到底做错了什么？

我在一个嵌套的 Masterpage 中，但我不确定这是否是一个问题。我正在使用的这个社区服务器框架中是否有某些东西会导致所有事件回发？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-08T00:10:09.790

您是否尝试在“触发器”部分中设置`Button1`为？`AsyncPostBackTrigger`将`ChildrenAsTriggers`属性设置为`true`并将`UpdateMode`属性设置为`Conditional`。

```
protected void Button1_Click(object sender, EventArgs e)
{    
    Label1.Text = "Panel refreshed at " + DateTime.Now.ToString();    
    UpdatePanel1.Update();
} 
```

```
<asp:ScriptManager ID="ScriptManager1" runat="server"/>
<asp:UpdatePanel ID="UpdatePanel1" runat="server" ChildrenAsTriggers="true" UpdateMode="Conditional">
    <Triggers>        
        <asp:AsyncPostBackTrigger ControlID="Button1" EventName="Click" />    
    </Triggers>    
    <ContentTemplate>        
        <fieldset>            
            <legend>UpdatePanel</legend>            
            <asp:Label ID="Label1" runat="server" Text="Panel created."></asp:Label><br />            
            <asp:Button ID="Button1" runat="server" OnClick="Button1_Click" Text="Button" />        
        </fieldset>    
    </ContentTemplate>
</asp:UpdatePanel> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T00:08:02.747

我在上面的代码示例中没有看到 Label2。如果 Label2 位于 UpdatePanel 之外，则会发生整个页面刷新，因为这是页面正确更新 Label2 所必需的。

默认情况下，UpdatePanels 只会在被其中的控件触发时动态刷新其中的内容。如果您需要进行一些更高级的更新，例如面板外部的按钮导致刷新或不同面板中的标签被更新，那么您需要在 UpdatePanel(s) 上设置 Conditional 属性并进行一些手动更新调用在你的代码中。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-10-13T11:00:02.363

另一个可能的原因是，如果页面有`ClientIDMode="static"`, 那么您希望仅刷新 UpdatePanel 的控件将刷新整个页面。

要解决此问题，您只需设置`ClientIDMode="AutoID"`应触发 UpdatePanel 回发的控件。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-10-29T16:12:46.873

如果您有一个从 .net framework v1.1 升级的旧项目，请从您的 Web 配置中删除此行以使其正常工作：

```
<xhtmlConformance mode="Legacy"/> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-08T00:08:34.973

`ChildrenAsTriggers="true"`在您的 UpdatePanel 控件上设置。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-07-21T15:28:37.380

“默认情况下，UpdatePanels 只会在被其中的控件触发时动态刷新其中的内容。”

否则会刷新整个页面！这才是重点！

# php - How can I generate a v2 signature for Amazon EC2 using PHP?

> ID：728047
> 
> 赞同：0
> 
> 时间：2009-04-08T00:01:05.633
> 
> 标签：php, amazon-ec2

I am wondering if anyone has successfully generated an EC2 v2 signature for their API using php. All examples/libraries I can find online are for v1 of the signature and that has been deprecated due to insecurities. An existing library that implements the signature generation would be appreciated too.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-25T00:34:04.927

[http://mierendo.com/software/aws_signed_query/](http://mierendo.com/software/aws_signed_query/)

我相信那是V2

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T00:04:56.030

[Here's](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1669) a PHP Library that supports V2\. I haven't tried it though.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-13T07:28:53.407

使用常量 AWSSECRET 来散列签名，而不是 $AWSKEY（未引用的变量）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-25T00:25:09.743

这是我编写并一直在使用的一些代码：

```
define("AWSKEY", "Your AWS Key");
define("AWSSECRET", "Your AWS Secret");
public function get($parameters, $host) {

    // Build out the variables
    $domain = "https://$host/";
    $parameters['AWSAccessKeyId'] = AWSKEY;
    $parameters['Timestamp'] = date('c');
    $parameters['Version'] = '2007-11-07';
    $parameters['SignatureMethod'] = 'HmacSHA256';
    $parameters['SignatureVersion'] = 2;

    // Write the signature
    $signature = "GET\n";
    $signature .= "$host\n";
    $signature .= "/\n";

    $sigparams = $parameters;

    ksort($sigparams);

    $first = true;
    foreach($sigparams as $key=>$param) {
        $signature .= (!$first ? '&' : '') . rawurlencode($key) . '=' . rawurlencode($param);
        $first = false;
    }
    $signature = hash_hmac('sha256', $signature, $AWSKEY, true);
    $signature = base64_encode($signature);
    $parameters['Signature'] = $signature;

    $url = $domain . '?';
    $first = true;
    foreach($parameters as $key=>$param) {
        $url .= (!$first ? '&' : '') . rawurlencode($key) . '=' . rawurlencode($param);
        $first = false;
    }

    $ch = curl_init(trim($url));
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

    $output = curl_exec($ch);

    return $output;

} 
```

下面是你如何使用它：

```
$params = array(
    'Action' => 'ListDomains'
);
$db->get($params, 'sdb.amazonaws.com'); 
```

`ListDomains`这将在 SimpleDB 上执行查询。该函数本身将返回 Amazon 的输出。对于更复杂的命令（即：PUT、POST 等），不需要进行任何重大修改。

# macos - glutPassiveMotionFunc 和 glutWarpMousePointer

> ID：728049
> 
> 赞同：9
> 
> 时间：2009-04-08T00:01:52.103
> 
> 标签：macos, opengl, mouse, glut

我想在 OpenGL / GLUT 窗口中实现我自己的光标。执行此操作的常用方法是冻结光标（因此它不会碰到屏幕边缘）并自己跟踪其位置。我可以使用使屏幕光标不可见

```
glutSetCursor(GLUT_CURSOR_NONE); 
```

然后在我的 glutPassiveMotionFunc 回调中使用

```
int centerX = (float)kWindowWidth / 2.0;
int centerY = (float)kWindowHeight / 2.0;

int deltaX = (x - centerX);
int deltaY = (y - centerY);

mouseX += deltaX / (float)kWindowWidth;
mouseY -= deltaY / (float)kWindowHeight;

glutWarpPointer( centerX, centerY ); 
```

这样做的原因是它使指针保持在窗口的中间。问题是，当我绘制“OpenGL”鼠标（在 glutDisplayFunc() 回调内部）时，它非常生涩。

我在网上查了一下，发现可能存在 glutWarpPointer() 导致再次调用 glutPassiveMotionFunc 回调，从而导致循环的问题，但这里似乎不会发生这种情况。

我在 Mac OS X 上，我发现一个帖子说 CGDisplayMoveCursorToPoint 更适合这个。调用 CGDisplayMoveCursorToPoint 有效，但运动仍然非常不稳定（我似乎得到了很多 x 和 y 均为 0 的事件）。无论如何，我希望它也能在 Linux 上工作，因此仅 Mac 的解决方案并不理想（但我可以在不同的系统上做不同的事情）。

我已将其简化为测试用例。

```
#include <stdio.h>
#include <OpenGL/OpenGL.h>
#include <GLUT/GLUT.h>

int curX = 0;
int curY = 0;

void display() {
    glClearColor( 0.0, 0.0, 0.0, 1.0 );
    glClear( GL_COLOR_BUFFER_BIT );

    float vx = (float)curX / 300.0 + 0.5;
    float vy = (float)curY / 300.0 + 0.5;

    glColor3f( 1.0, 0.0, 0.0 );
    glBegin( GL_POINTS );
        glVertex3f( vx, vy, 0.0 );
    glEnd();

    glutSwapBuffers();

}

void passivemotion( int x, int y ) {
    int centerX = 150;
    int centerY = 150;

    int deltaX = x - centerX;
    int deltaY = y - centerY;
    curX += deltaX;
    curY -= deltaY;

    glutWarpPointer( centerX, centerY );
}

void timer( int val ) {
    glutTimerFunc( 16, &timer,  0);
    glutPostRedisplay();
}

int main (int argc, char * argv[]) {
    glutInit(&argc, argv);
    glutInitDisplayMode(GLUT_RGB);
    glutInitWindowSize(300,300);
    glutCreateWindow("FPS Mouse Sample");
    glutDisplayFunc(&display);
    glutPassiveMotionFunc(&passivemotion);
    glutSetCursor( GLUT_CURSOR_NONE );
    glutTimerFunc( 16, &timer, 0 );
    glutMainLoop();
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T15:55:08.663

感谢 aib 的提示。你让我研究了 glutWarpPointer 的反汇编，很明显发生了什么。调用 glutWarpPointer CGPostMouseEvent 会导致一堆无意义的事件（并且没有任何方法可以跳过它们，因为您每帧只能获得一次鼠标事件，新的“真实”事件会迟到）。我找到的解决方案是仅在指针位于屏幕边缘时才变形（毕竟，该点是假装该点永远无法到达屏幕边缘）。无论如何，这里是代码。

```
int lastX = 150;
int lastY = 150;
void passivemotion( int x, int y ) {    
    int deltaX = x - lastX;
    int deltaY = y - lastY;

    lastX = x;
    lastY = y;

    if( deltaX == 0 && deltaY == 0 ) return;

    int windowX     = glutGet( GLUT_WINDOW_X );
    int windowY     = glutGet( GLUT_WINDOW_Y );
    int screenWidth     = glutGet( GLUT_SCREEN_WIDTH );
    int screenHeight    = glutGet( GLUT_SCREEN_HEIGHT );

    int screenLeft = -windowX;
    int screenTop = -windowY;
    int screenRight = screenWidth - windowX;
    int screenBottom = screenHeight - windowY;

    if( x <= screenLeft+10 || (y) <= screenTop+10 || x >= screenRight-10 || y >= screenBottom - 10) {
        lastX = 150;
        lastY = 150;
        glutWarpPointer( lastX, lastY );
        //  If on Mac OS X, the following will also work (and CGwarpMouseCursorPosition seems faster than glutWarpPointer).
        //  CGPoint centerPos = CGPointMake( windowX + lastX, windowY + lastY );
        //  CGWarpMouseCursorPosition( centerPos );
        // Have to re-hide if the user touched any UI element with the invisible pointer, like the Dock.
        //  CGDisplayHideCursor(kCGDirectMainDisplay);
    }

    curX += deltaX;
    curY -= deltaY;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-03-16T21:13:03.077

我找到了更好的方法。发生的事情是，在您扭曲鼠标后，操作系统会抑制事件约 0.25 秒。因此，只需调用：

```
#ifdef __APPLE__
CGSetLocalEventsSuppressionInterval(0.0);
#endif 
```

然后一切都会顺利进行，没有任何口吃。

您可能需要包括：

```
#include <ApplicationServices/ApplicationServices.h> 
```

并将此框架添加到您的项目或编译器选项中。

请注意，您可能会收到鼠标移动到屏幕中心的事件，因此如果它位于屏幕中间，我将忽略该事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T01:29:04.780

除了红皮书的例子，我对过剩没有太多经验，但它是不是因为你为光标绘制的内容而生涩，或者你绘制它的频率如何？如果你只是在光标应该使用 OpenGL 调用的地方画一个点，它仍然是生涩的吗？您的计时码可能有问题吗？

你调用什么代码来更新指针每次滴答？我认为它不是列出的代码，因为您每次都会计算中心点，而不是在调整大小事件上。

我很抱歉在这里盲目回答（即有限的过剩经验）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T02:21:41.083

我在这里猜测，但我怀疑运动是生涩的，因为光标是在应用程序的绘图函数 (display()) 中绘制的，而不是由操作系统处理的。

普通鼠标指针在驱动程序级别通过将光标图像与帧缓冲区内容进行异或处理 - 因此闪电般快速，并且由操作系统在中断服务例程中以非常高的优先级处理（以保持响应的错觉）。

当你自己绘制它时，你会受到操作系统的定期调度机制的影响，并通过定期清除和重绘整个窗口 rigamarole。在这种情况下，由于上述原因，它的速度很快，但不如我们习惯使用鼠标指针的速度快。

简而言之，我不确定您是否能达到预期的速度（尤其是当您的显示功能和应用程序逻辑变得更加复杂时）。

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T03:08:24.950

您是否在几帧上平均了鼠标的移动？因为我在工作，所以找不到我以前项目的代码。但我认为我平均了几帧鼠标的移动，在我这样做之前，移动非常生涩。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T12:57:37.310

可能是因为您在非双缓冲窗口上交换缓冲区吗？

您的示例不适用于我的 Win32 系统，除非我将 GLUT_DOUBLE 添加到 glutInitDisplayMode()。

编辑：

你是对的。从运动函数中调用 glutWarpPointer() 似乎会导致我的 [win32] 系统出现循环。除非我单击按钮或其他东西，否则计时器甚至没有机会触发。我打赌消息队列中充斥着运动事件。

直接从运动函数调用 display() 似乎也不起作用 - 这一次它无法注册任何类型的运动。

我可以让您的示例正常工作的唯一方法是将*被动*运动回调更改为*主动*运动回调并直接从该函数调用 display() 。我知道这与您最初的意图相去甚远，但至少我以这种方式获得了一些平稳的动作。

您是否尝试过使用 glutIdleFunc() 为您触发显示更新？它可能仍然不适用于被淹没的消息队列，但它可能值得一试。您还可以考虑使用 API 调用来捕获鼠标，而不是在每次动作时手动将光标环绕到窗口的中心。

# oop - 数据传输对象 (DTO) 的意义何在？

> ID：728052
> 
> 赞同：8
> 
> 时间：2009-04-08T00:04:49.990
> 
> 标签：oop

当我可以将所有业务类放在类库中，在业务逻辑中使用它们，然后还将这些相同的业务对象传递给边界类时，为什么还要使用 DTO/Domain 对象？

更新：一切都很好，感谢您的帮助。一个后续问题：

您通常将这些 DTO 放在哪里？除了域对象，即在同一个命名空间中？

```
namespace MedSched.Medical
{
    public class MedicalGroup
    {
        //...
    }

    public class MedicalGroupDTO
    {
        //...
    }
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T00:19:39.957

*   DTO 为您的领域模型提供了一个抽象层。因此，您可以更改模型，而不会违反您与服务客户签订的合同。这类似于数据库设计中的常见做法，其中视图和过程成为底层数据模型的抽象层。
*   序列化 - 您可能会过度暴露数据并通过网络发送臃肿的消息。这可以通过使用序列化属性来缓解，但您可能仍然有额外的信息。
*   隐式与显式合同 - 通过公开域对象，您将其留给客户来解释它们的用法，因为他们没有完整的模型可供使用。您经常会根据关联的存在或删除来隐式更新域对象，或者盲目地接受所有更改。DTO 明确表达了服务的使用和所需的操作。
*   断开连接的场景 - 具有显式消息或 DTO 将使您更容易实现消息传递和消息传递模式，例如 Message Broker 等。
*   DDD - 纯 DDD 要求域对象在外部是不可变的，因此您必须将其卸载到另一个对象，通常是 DTO。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T00:17:13.800

我可以想到使用 DTO 的 2 个基本场景：

*   **您正在从不完整且验证失败的数据创建业务对象。**例如，您正在解析创建业务对象的 CSV 文件或 Excel 文件。如果您直接使用来自这些对象的数据来创建您的业务对象，则很可能会导致对象中的多个验证规则失败，因为来自此类文件的数据容易出错。它们也往往具有与最终业务对象不同的结构：为不完整的数据设置占位符会很有用。

*   **您正在通过带宽密集型介质传输业务对象**。如果您使用的是 Web 服务，则需要在传输之前使用 DTO 来简化您的对象；否则 CLR 将很难尝试序列化所有数据。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T00:11:53.627

DTO 是数据传输对象，其中传输是关键词。当您想通过网络传递对象并可能使用不同的语言进行通信时，它们非常棒，因为它们是“轻量级的”（即没有业务逻辑）。

如果您的应用程序不是基于 Web 服务的，那么 DTO 不会真正为您购买任何东西。

所以决定使用或不使用 DTO 应该基于你的应用程序的架构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T00:17:07.607

有时，您要传递的**数据**并未准确映射到业务对象的结构，在这种情况下，您使用 DTO。

例如：当您想要传递数据的子集或投影时。

# c# - 连接到另一个应用程序以查看内存使用情况

> ID：728063
> 
> 赞同：0
> 
> 时间：2009-04-08T00:10:23.677
> 
> 标签：c#, memory-leaks

我刚开始编写一个应用程序，我想用它来附加到任何正在运行的进程，并在它分配或取消分配内存时得到通知。我已经创建了界面，因此我可以从正在运行的进程列表中进行选择，但我真的不知道如何连接到该进程以获取我正在寻找的信息。

这是我的第一个“真正的”C# 应用程序，所以我仍在学习。我想使用这个应用程序来测试其他应用程序中的内存泄漏，它只是一个个人工具（和学习经验），所以它不必是完美的。

任何帮助将不胜感激，谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T00:23:14.877

这篇文章可能会感兴趣：[监控您的 PC 的内存使用情况以进行游戏开发](http://www.gamasutra.com/view/feature/1430/monitoring_your_pcs_memory_usage_.php?print=1)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T00:24:00.430

您是否看过[PerfMon](http://msdn.microsoft.com/en-us/library/aa645516(VS.71).aspx)及其提供的功能？您可以实现自定义计数器，但它确实显示内存和 GC 活动。我过去用它来调试泄漏。

# asp.net - 如何在不使用 httpcontext.items 的情况下在线程之间保留对象？

> ID：728065
> 
> 赞同：0
> 
> 时间：2009-04-08T00:11:56.153
> 
> 标签：asp.net, multithreading, httpcontext

我有一个对象可以处理我的数据访问层 (DAL) 的内存缓存，我需要在线程之间保留它。根据我的阅读，首选方法是使用 httpcontext.item 和如下代码：

```
 Shared Property DALList() As Dictionary(Of String, DAL)
        Get
            If Not Web.HttpContext.Current.Items.Contains("_DALList") Then
                Web.HttpContext.Current.Items.Add("_DALList", New Dictionary(Of String, DAL))
            End If
            Return Web.HttpContext.Current.Items("_DALList")
        End Get
        Set(ByVal value As Dictionary(Of String, DAL))
            If Not Web.HttpContext.Current.Items.Contains("_DALList") Then
                Web.HttpContext.Current.Items.Add("_DALList", value)
            Else
                Web.HttpContext.Current.Items("_DALList") = value
            End If
        End Set
    End Property 
```

两个问题：这是否试图序列化对象，如果是，我如何让它保持对象完好无损并在内存中引用它而不是序列化它？我需要保持对象完好无损，因为它在后台处理数据库连接和缓存。

**[编辑]**

当我运行它时，我收到一个导致页面挂起的错误。事件日志中有两个项目。

错误应用程序 w3wp.exe，版本 7.0.6001.18000，时间戳 0x47919ed8，错误模块 kernel32.dll，版本 6.0.6001.18000，时间戳 0x4791ada5，异常代码 0xe053534f，错误偏移量 0x000000000002649d，进程 id 0x%10 0x%9，应用程序启动时间.

和

状态服务器已关闭过期的 TCP/IP 连接。客户端的 IP 地址是 127.0.0.1。过期的读取操作开始于 04/07/2009 20:44:29。

然后，我重新散列代码以将项目放入字典对象中，并根据会话 ID 得到这些 smae 错误。如果我使用静态变量，它可以正常工作，但是我遇到了我原来的问题，即用户将访问其他用户数据（显然这不是一个选项）。

重新散列的版本如下：（这适用于第一种方法，但不适用于此方法）

```
Shared _CurrentScope As New Dictionary(Of String, DALScope)
Public Shared Property CurrentScope() As DALScope
    Get
        If Not _CurrentScope.ContainsKey(Web.HttpContext.Current.Session.SessionID & "_CurrentScope") Then
            _CurrentScope.Add(Web.HttpContext.Current.Session.SessionID & "_CurrentScope", New DALScope)
        End If
        Return _CurrentScope(Web.HttpContext.Current.Session.SessionID & "_CurrentScope")
    End Get
    Set(ByVal value As DALScope)
        If Not _CurrentScope.ContainsKey(Web.HttpContext.Current.Session.SessionID & "_Currentscope") Then
            _CurrentScope.Add(Web.HttpContext.Current.Session.SessionID & "_Currentscope", value)
        Else
            _CurrentScope(Web.HttpContext.Current.Session.SessionID & "_Currentscope") = value
        End If
    End Set
End Property 
```

**[编辑]**

在同一会话下有多个 web 请求的情况下，锁定的好处。我最终使用了 httpcontext.item 方法，发现我的问题与属性是 byval 而不是 byref 有关。我已经更改了我的代码以包含通过 ref 处理 hte 对象的方法，现在它可以工作了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T00:18:17.697

HttpContext 存在于单个请求的生命周期内。我假设这里的线程您正在谈论跨多个请求维护状态。如果是这样 HttpContext.Items 不是你想要的。您可能想要使用应用程序缓存或其他一些缓存机制。

作为旁注，将项目放入 HttpContext.Items 不会对其进行序列化。如果您使用缓存序列化取决于您是否有缓存的后备存储，但由于这是特定于缓存的，它实际上取决于您选择的缓存。

# 编辑

我的理解是它返回对您放入系统的同一实例的引用。我使用 HttpContext 来存储我的 nHibernate 会话，其中包含很多东西。效果很棒。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T00:40:11.403

正如 Josh 已经提到的，如果您想在单个请求期间进行缓存，那么 httpcontext.items 是要走的路。如果这不起作用，那么您一定做错了什么，您究竟在哪里将数据添加到 httpcontext.items？我通常使用 httpmodule 并在 begin_request 处理程序中添加数据，但这完全取决于您要做什么

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T01:10:37.867

我可能错了，但我没有看到任何锁定实现，如果/当许多线程尝试创建/使用/更改对象时，您可能会遇到各种问题。

# actionscript-3 - ActionScript MouseEvent.clone() 出现损坏？

> ID：728067
> 
> 赞同：2
> 
> 时间：2009-04-08T00:12:36.633
> 
> 标签：actionscript-3, events, mouseevent, dispatcher

[我在尝试在 ActionScript 3 中重新分配](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/events/EventDispatcher.html#dispatchEvent())鼠标事件时遇到了问题，我对此感到有些怀疑。我已经把它缩小到[`MouseEvent.clone()`](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/events/MouseEvent.html#clone())出现的方法，好吧，完全坏了。以下事件处理程序：

```
 private function handleMouseMove( evt : MouseEvent ) : void
    {
        trace("mousemove", evt.stageX, evt.stageY);
        var newEvt : MouseEvent = evt.clone() as MouseEvent;
        trace("mousemoveclone", newEvt.stageX, newEvt.stageY);
    } 
```

产生以下输出，无穷无尽：

```
mousemove 167 206 
mousemoveclone 0 0 
```

这与我将 MouseEvent 重新分派到的代码相匹配，因此我假设克隆函数损坏。

这与链接文档表明应该发生的内容直接矛盾，除非我遗漏了什么。对于可能导致这种行为的我做了（或没有做）的事情，我完全不知所措。AS3 的家伙真的忘记阅读他们自己的文档了[`Event.clone()`](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/events/Event.html#clone())吗？

我可以通过针对我的特定用例使用函数对象来解决这个问题，但我不希望这样做。有任何想法吗？

**编辑：** localX 和 localY 成员似乎被正确克隆了，这让我对这里发生的事情感到更加茫然。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T00:21:24.570

那是一个已知的错误。您可以在此处查看错误报告：http: [//bugs.adobe.com/jira/browse/FP-343](http://bugs.adobe.com/jira/browse/FP-343)

其他一切都应该被克隆。您始终可以手动分配 stageX 和 stageY 直到修复错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-27T16:50:02.377

我意识到这个线程已经休眠了 7 个月，但只是为了更新一点——它在 FP10 和 Flex4 中仍然有效。如果您重新调度事件，也会发生这种情况。IE：

```
private function mouseListener( e:MouseEvent ):void
{
    dispatchEvent( e );
} 
```

dispatchEvent() 调用似乎相当于 clone()，所以 stageX 和 stageY 设置为 0

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-10T23:44:19.140

这是一个相当古老的问题，但这是我在谷歌上搜索解决方案时提出的问题，而这里的内容还不够全面。

这没有被“修复”的原因是因为它按预期工作。stageX 和 stageY 值是在您调用 getter 时计算的，使用事件的目标进行 localToGlobal 转换。这是必要的，这样即使目标对象在事件被调度后已经改变了位置、比例或旋转，数字也能保持正确。

如果您确实需要使用正确的 stageX 和 stageY 值重新调度 MouseEvent，您的两个选择是：

1.  创建覆盖 stageX 和 stageY getter 的 MouseEvent 的自定义子类。您可以存储原始目标并自己进行 localToGlobal 计算，也可以使用克隆原始事件时的值存储 stageX 和 stageY 的静态值。

2.  扩展 Sprite 并将您的调度程序添加到舞台，以便股票 MouseEvent 可以正常工作。

# c++ - 如何在 C++ 中计算时间差

> ID：728068
> 
> 赞同：108
> 
> 时间：2009-04-08T00:14:18.707
> 
> 标签：c++

在 C++ 中计算时间差的最佳方法是什么？我正在计时程序的执行速度，所以我对毫秒感兴趣。更好的是，秒.毫秒..

接受的答案有效，但需要包括 ctime 或 time.h 如评论中所述。

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2009-04-08T00:16:15.003

见[`std::clock()`](http://en.cppreference.com/w/cpp/chrono/c/clock)功能。

```
const clock_t begin_time = clock();
// do something
std::cout << float( clock () - begin_time ) /  CLOCKS_PER_SEC; 
```

如果您想计算自己的执行时间（而不是用户），最好在时钟滴答（而不是秒）中执行此操作。

**编辑：**
负责的头文件 -`<ctime>`或`<time.h>`

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2018-05-07T06:50:39.937

我添加了这个答案以澄清接受的[答案](https://stackoverflow.com/a/728070/5330223)显示的 CPU 时间可能不是您想要的时间。因为根据[参考](http://en.cppreference.com/w/cpp/chrono/c/clock)，有**CPU时间和挂钟时间**。挂钟时间是显示实际经过时间的时间，无论其他条件如何，例如其他进程共享的 CPU。例如，我使用多个处理器来执行某个任务，CPU 时间高达**18**秒，而实际挂钟时间实际上需要**2 秒。**

为了得到你做的实际时间，

```
#include <chrono>

auto t_start = std::chrono::high_resolution_clock::now();
// the work...
auto t_end = std::chrono::high_resolution_clock::now();

double elapsed_time_ms = std::chrono::duration<double, std::milli>(t_end-t_start).count(); 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2013-11-05T22:22:13.030

如果您使用的是 c++11，这是一个简单的包装器（请参阅此[要点](https://gist.github.com/gongzhitaao/7062087)）：

```
#include <iostream>
#include <chrono>

class Timer
{
public:
    Timer() : beg_(clock_::now()) {}
    void reset() { beg_ = clock_::now(); }
    double elapsed() const { 
        return std::chrono::duration_cast<second_>
            (clock_::now() - beg_).count(); }

private:
    typedef std::chrono::high_resolution_clock clock_;
    typedef std::chrono::duration<double, std::ratio<1> > second_;
    std::chrono::time_point<clock_> beg_;
}; 
```

或者对于 *nix 上的 c++03：

```
#include <iostream>
#include <ctime>

class Timer
{
public:
    Timer() { clock_gettime(CLOCK_REALTIME, &beg_); }

    double elapsed() {
        clock_gettime(CLOCK_REALTIME, &end_);
        return end_.tv_sec - beg_.tv_sec +
            (end_.tv_nsec - beg_.tv_nsec) / 1000000000.;
    }

    void reset() { clock_gettime(CLOCK_REALTIME, &beg_); }

private:
    timespec beg_, end_;
}; 
```

使用示例：

```
int main()
{
    Timer tmr;
    double t = tmr.elapsed();
    std::cout << t << std::endl;

    tmr.reset();
    t = tmr.elapsed();
    std::cout << t << std::endl;
    return 0;
} 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2009-04-08T00:58:03.670

我会认真考虑使用 Boost，特别是 boost::posix_time::ptime 和 boost::posix_time::time_duration （在[http://www.boost.org/doc/libs/1_38_0/doc/html/date_time/posix_time .html](http://www.boost.org/doc/libs/1_38_0/doc/html/date_time/posix_time.html)）。

它是跨平台的、易于使用的，并且根据我的经验，它提供了操作系统提供的最高级别的时间分辨率。可能也很重要；它提供了一些非常好的 IO 操作符。

要使用它来计算程序执行的差异（以微秒计；可能有点过大了），它看起来像这样 [浏览器编写，未测试]：

```
ptime time_start(microsec_clock::local_time());
//... execution goes here ...
ptime time_end(microsec_clock::local_time());
time_duration duration(time_end - time_start);
cout << duration << '\n'; 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2012-02-07T11:21:55.340

boost 1.46.0 及更高版本包括[Chrono](http://www.boost.org/doc/libs/1_47_0/doc/html/chrono/reference.html#chrono.reference.other_clocks.thread_clock_hpp)库：

> thread_clock 类提供对真实线程挂钟的访问，即调用线程的真实 CPU 时间时钟。线程相对当前时间可以通过调用thread_clock::now()获取

```
#include <boost/chrono/thread_clock.hpp>
{
...
    using namespace boost::chrono;
    thread_clock::time_point start = thread_clock::now();
    ...
    thread_clock::time_point stop = thread_clock::now();  
    std::cout << "duration: " << duration_cast<milliseconds>(stop - start).count() << " ms\n"; 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-04-08T03:56:21.947

在 Windows 中：使用[GetTickCount](http://msdn.microsoft.com/en-us/library/ms724408(VS.85).aspx)

```
//GetTickCount defintition
#include <windows.h>
int main()
{

    DWORD dw1 = GetTickCount();

    //Do something 

    DWORD dw2 = GetTickCount();

    cout<<"Time difference is "<<(dw2-dw1)<<" milliSeconds"<<endl;

} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-04-08T04:46:50.750

您也可以使用[clock_gettime](http://www.tin.org/bin/man.cgi?section=3&topic=clock_gettime)。该方法可用于测量：

1.  系统范围的实时时钟
2.  系统范围的单调时钟
3.  每进程 CPU 时间
4.  每个进程线程 CPU 时间

代码如下：

```
#include < time.h >
#include <iostream>
int main(){
  timespec ts_beg, ts_end;
  clock_gettime(CLOCK_PROCESS_CPUTIME_ID, &ts_beg);
  clock_gettime(CLOCK_PROCESS_CPUTIME_ID, &ts_end);
  std::cout << (ts_end.tv_sec - ts_beg.tv_sec) + (ts_end.tv_nsec - ts_beg.tv_nsec) / 1e9 << " sec";
} 
```

`

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-04-08T01:06:04.773

万一你在 Unix 上，你可以`time`用来获取执行时间：

```
$ g++ myprog.cpp -o myprog
$ time ./myprog 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-03-29T19:02:34.127

对我来说，最简单的方法是：

```
#include <boost/timer.hpp>

boost::timer t;
double duration;

t.restart();
/* DO SOMETHING HERE... */
duration = t.elapsed();

t.restart();
/* DO OTHER STUFF HERE... */
duration = t.elapsed(); 
```

使用这段代码你不必做经典的`end - start`.

享受你最喜欢的方法。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-04-08T00:23:46.170

附带说明：如果您在 Windows 上运行，并且确实需要精确度，则可以使用[QueryPerformanceCounter](http://msdn.microsoft.com/en-us/library/ms979201.aspx)。它为您提供（可能）**纳秒**的时间。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-04-08T00:26:26.273

在开始时以毫秒为单位获取系统时间，在结束时再次获取系统时间，然后减去。

要在 POSIX 中获取自 1970 年以来的毫秒数，您可以编写：

```
struct timeval tv;

gettimeofday(&tv, NULL);
return ((((unsigned long long)tv.tv_sec) * 1000) +
        (((unsigned long long)tv.tv_usec) / 1000)); 
```

要在 Windows 上获取自 1601 以来的毫秒数，您可以编写：

```
SYSTEMTIME systime;
FILETIME filetime;

GetSystemTime(&systime);
if (!SystemTimeToFileTime(&systime, &filetime))
    return 0;

unsigned long long ns_since_1601;
ULARGE_INTEGER* ptr = (ULARGE_INTEGER*)&ns_since_1601;

// copy the result into the ULARGE_INTEGER; this is actually
// copying the result into the ns_since_1601 unsigned long long.
ptr->u.LowPart = filetime.dwLowDateTime;
ptr->u.HighPart = filetime.dwHighDateTime;

// Compute the number of milliseconds since 1601; we have to
// divide by 10,000, since the current value is the number of 100ns
// intervals since 1601, not ms.
return (ns_since_1601 / 10000); 
```

如果您希望标准化 Windows 答案，以便它还返回自 1970 年以来的毫秒数，那么您必须将答案调整 11644473600000 毫秒。但是，如果您只关心经过的时间，那就没有必要了。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-05-10T13:37:28.950

如果您正在使用：

```
tstart = clock();

// ...do something...

tend = clock(); 
```

然后，您将需要以下内容以秒为单位获取时间：

```
time = (tend - tstart) / (double) CLOCKS_PER_SEC; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-09-23T22:49:24.937

这似乎适用于英特尔 Mac 10.7：

```
#include <time.h>

time_t start = time(NULL);

    //Do your work

time_t end = time(NULL);
std::cout<<"Execution Time: "<< (double)(end-start)<<" Seconds"<<std::endl; 
```

# android - 在模拟器中重新加载 Android 应用程序而不在 Eclipse 中重新启动模拟器？

> ID：728077
> 
> 赞同：52
> 
> 时间：2009-04-08T00:19:01.143
> 
> 标签：android, eclipse

有没有办法在模拟器中重新加载 Android 应用程序而无需关闭模拟器、保存任何代码更改并再次运行模拟器？如果我对布局进行简单的更改，我在 Eclipse 和 Android“启动”中运行它大约需要 30 秒，并且我可以解锁模拟器以运行应用程序。进行更改时有什么方法可以缩短这个时间，还是我只需要处理？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-04-08T05:08:18.233

Android 模拟器是可热部署的。保存并单击`'run'`后（假设没有编译错误），它将打包并重新部署到模拟器，然后重新启动应用程序以运行新版本。如果您有通过 USB 连接的 Android 开发人员电话，情况也是如此。

如果您收到消息“警告：Activity 未启动，其当前任务已被带到前面”，它有助于通过按后退按钮从前面退出/移动模拟器中正在运行的应用程序。在这种情况下，Android 似乎不会覆盖正在运行的应用程序。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-07-21T20:39:34.950

在 Eclipse 中运行 -> 运行配置 ...

您第一次需要设置以下突出显示的选项，因为您还没有启动任何模拟器。 ![在此处输入图像描述](https://i.stack.imgur.com/8klEW.png)

在第一次运行之后，您现在已经运行了一个模拟器。现在，当您再次进行更改时，请转到 Run -> Run Configuration ...

并设置以下突出显示的选项： ![在此处输入图像描述](https://i.stack.imgur.com/pHJDd.png)

现在，每次都将使用已经运行的模拟器来重新启动您的应用程序，并且花费的时间更少。

**注意：**每次单击“**运行”**按钮之前，请按一次模拟器中的**后退**按钮。因此，您的应用程序不再在模拟器上运行。否则，您可能会看到以下警告：

警告：Activity 没有启动，它的当前任务已经被放到了前面

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-04-07T18:11:07.240

您已经被告知不需要重新启动模拟器，但现在使用 Android Studio 2.0，您甚至不需要重新启动您的应用程序。它有一个名为[Instant Run](http://developer.android.com/tools/building/building-studio.html#instant-run)的新功能，允许您更新您的应用程序而无需重新启动它。

只需在首选项中启用它：

[![在此处输入图像描述](https://i.stack.imgur.com/3wr2Q.png)](https://i.stack.imgur.com/3wr2Q.png)

并运行：

[![在此处输入图像描述](https://i.stack.imgur.com/QcwLf.png)](https://i.stack.imgur.com/QcwLf.png)

[此链接](http://android-developers.blogspot.ie/2016/04/android-studio-2-0.html)中的更多信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-16T22:06:52.567

不要从 Eclipse 运行，而是使用项目目录中的以下批处理文件来安装和卸载 apk。那些工作得很好而且很快。

**安装.bat**

```
cd bin
adb install *.apk 
```

**卸载.bat**

```
adb uninstall this.is.package.name 
```

# javascript - gmail javascript小书签

> ID：728079
> 
> 赞同：1
> 
> 时间：2009-04-08T00:19:27.117
> 
> 标签：javascript, firefox, gmail, bookmarklet

~~如果我将其加载到新选项卡（FF3）中，它可以工作。如果我将它加载到当前选项卡中，它只会打印 url。~~

我认为实际上是将其加载到现有的 gmail 选项卡中的问题。比如说，制作小书签，单击一次，然后再次单击。这似乎是重现问题的方法。

知道什么会导致这种情况吗？我可以想到一些解决方法，但我很好奇它是如何工作的。

```
javascript:var%20t=new%20Date(),y=t.getFullYear(),m=t.getMonth()+1,d=t.getDate();document.location.href="http://mail.google.com/mail/#search/is%3Aunread+after%3A"+y+"-"+m+"-"+d

/* same code split up for readability */
javascript:
  var t = new Date(),
      y = t.getFullYear(),
      m = t.getMonth()+1,
   /* d = t.getDay(); I actually have this correct above, but not here.. oops */
      d = t.getDate(); 
  document.location.href="http://mail.google.com/mail/#search/is%3Aunread+after%3A"+y+"-"+m+"-"+d; 
```

有什么帮助吗？

谢谢 ：）

## 更新：

~~[当我从这个](https://stackoverflow.com/questions/728079/gmail-javascript-bookmarklet/730909#730909)答案中删除多余的空格并将必要的空格转换为“%20”（url编码）时，它什么都不做：~~

```
 /* this works. I was missing the final ")" altCognito wrote */
 javascript:void((function(){var%20t=%20new%20Date(),y=t.getFullYear(),m=t.getMonth()+1,d=t.getDate();window.location.href="http://mail.google.com/mail/#search/is%3Aunread+after%3A"+y+"-"+m+"-"+d;})()) 
```

~~我还尝试了一些分号摆弄和其他一般语法检查，但我不确定我在寻找什么。它既不能用作书签，也不能直接粘贴到地址栏中（无论如何对我来说）。~~

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T17:04:46.060

你想要的是看起来像这样的东西：

```
javascript:void(
    (function() {
    var t = new Date(),
          y = t.getFullYear(),
          m = t.getMonth()+1,
          d = t.getDate();
      window.location.href="http://mail.google.com/mail/#search/is%3Aunread+after%3A"+y+"-"+m+"-"+d;
    })()
) 
```

关键是 void((function() {... Your stuff here ... })())

请注意，您还想使用 getDate()，而不是 getDay，因为 getDay 返回星期几！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T03:19:35.453

最好使用[window.location.href](https://developer.mozilla.org/En/DOM:window.location) 而不是[document.location](https://developer.mozilla.org/En/DOM:document.location)

# iphone - Instruments Leaks - 不显示我的源代码

> ID：728088
> 
> 赞同：14
> 
> 时间：2009-04-08T00:24:04.453
> 
> 标签：iphone, memory, instruments, memory-leaks

我正在尝试使用 Leaks 应用程序分析 iPhone 应用程序，并且一切似乎都工作正常，除了当我尝试查看有关特定内存泄漏的详细信息时。泄漏似乎没有加载我的源代码。查看右侧的堆栈视图，我可以看到引用 iPhone 框架的调用，但引用我编写的源代码的任何内容都是空的。下面的截图说明了我的观点。浅蓝色的块应该引用我的源代码。有没有人遇到过这个问题？泄漏只是没有正确找到我的源代码/符号吗？谢谢！

编辑：我正在使用带有调试配置的“设备 - iPhone OS 2.2”编译应用程序。我通过在 Xcode 中选择 Run->Start With Performance Tool->Leaks 来启动 Leaks。如何为 Leaks 提供“使符号文件可用”？

[![替代文字](https://i.stack.imgur.com/Ow3up.png)](https://i.stack.imgur.com/Ow3up.png)
[（来源：[andrewgarrison.com](http://www.andrewgarrison.com/forum/leaks_nosource.png)）]

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-11-29T21:29:23.210

对于 iOS 4.0 及更高版本，修复符号并将那些无用的内存地址变成漂亮的文件名、函数名和行号的方法如下：

1.  在 Xcode 中，转到 Run -> Run with Performance Tool 并选择您的仪器
2.  Instruments 加载后，点击 Stop 按钮停止录制。转到文件-> 重新符号化文档。
3.  在新窗口中，单击路径并单击加号 (+) 按钮以添加新路径。导航到包含您的项目文件的文件夹，然后单击打开。单击符号化。
4.  利润！

在我终于找到解决方案之前，我一直在寻找这个好一个月。我希望这对你们中的一些人有所帮助！

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-09-22T00:40:57.580

我看到了这种情况，但是在不同的配置上。在 Snow Leopard 10.6.1、Xcode 3.2、Instruments 2.0 中，在模拟器中运行 iPhone OS 3.0 时，我没有在 Leaks 中看到任何符号。在 Apple 的 iPhone 开发者论坛中搜索显示，这是 iPhone 3.0 SDK（正在处理）的一个已知问题，将活动 SDK 切换到 3.1 是一种解决方法。果然，它对我有用！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T23:13:46.440

从您的启动磁盘和主机名中删除所有非 ascii 字符
（请参阅系统偏好设置中的共享面板）并重新启动。

达达！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-01-13T02:53:25.440

**项目**>**编辑项目设置**

选择**调试**目标

单击**构建**选项卡

确保未选中**剥离链接产品**

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T00:26:45.570

您是否在调试模式下编译并使符号文件可用？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-14T02:48:58.333

如果您的构建目标目录以“.”开头 （例如，我使用的是“.xcode-build”）然后将找不到 .dsym 文件。就我而言，将构建目录更改为“xcode-build”解决了问题，现在我的应用程序的所有符号都显示在堆栈跟踪中！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-09-03T14:20:25.220

我有同样的问题。原来我已将构建目录设置为 /tmp/xcode。将其更改回默认值可以解决问题。这是 Xcode 3.2.3 的版本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-03T07:11:14.240

我有带有 Xcode 4.5.2 - Instruments 4.5 的 Snow Leopard 一旦我将默认调试位置设置为 Legacy，它就开始显示

转到文件---->项目设置---->高级---选择旧版

![调试位置 --- 旧版设置](https://i.stack.imgur.com/uhzsE.png)

# message-queue - 关于消息传递/消息队列的经验法则

> ID：728102
> 
> 赞同：1
> 
> 时间：2009-04-08T00:32:13.670
> 
> 标签：message-queue, messaging

有人可以提供一些关于何时使用消息队列以及他们应该解决哪些实际问题的经验法则吗？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T01:49:44.560

异步消息传递允许系统以断开连接的方式进行通信。两个系统不必同时可用以完成工作。

还有其他好处。消息传递通常提供（有时是无意的）限制机制。如果许多请求同时进入，这可以防止接收系统变得不堪重负。

许多消息传递系统还提供持久性和可靠性设施，保证消息最终将被传递，即使消息传递平台或接收系统崩溃。

消息队列还提供了一层间接性。将消息放入队列的系统不一定知道谁（如果有的话）正在接收该消息。接收者可以以微妙或剧烈的方式改变，而完全不影响发送者。像这样的松散耦合通常是可取的。

许多消息传递解决方案也可以参与事务。这确保了系统既可以接收消息又可以更新数据库作为响应，并且知道两者都成功或都不成功。如有必要，消息的接收可以“回滚”并在出现问题时重试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T00:43:14.110

当您需要一种异步但有保证的方式来在分层环境中处理无状态、面向服务的请求时。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T00:42:38.153

消息队列提供可靠的消息传递。他们确保消息不会完全丢失。它们仍然可以被延迟/发送到死消息队列等，但它们永远不会从系统中完全消失——即使它卡在原始客户端上，也总会有一个副本，除非它被明确删除。

消息队列应该用于消息丢失对业务有害和/或导致系统不稳定的情况。使用它们会产生开销，因此仅应在业务需求指示时实施它们。

在实施它们的情况下，应该有某种监控过程来检查冻结的消息（由于服务关闭、消息格式不正确等而无法处理的消息）并处理它们适当地。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T15:26:59.463

消息队列对于实现负载平衡很有用。例如，服务器接收“工作”消息（订单、状态消息......）并将它们分发给所有正在侦听的客户端。

消息队列保证一条消息将被准确地传递给一个客户端。

如果客户端在不同的计算机上运行，​​则总负载将被分配，并且在必要时很容易将另一个客户端投入到消息负载中，客户端只需连接到队列并接收（部分）消息。

编辑：

也适用于在系统之间移动对象（异步）。如果它们以独立于平台的格式（[JSON](http://www.json.org/ "JSON")、XML）进行序列化，甚至可以在不同的编程语言之间进行交换。

# compiler-construction - Gimpel 的 PC-lint 和 Flexelint；有人用过吗？

> ID：728104
> 
> 赞同：2
> 
> 时间：2009-04-08T00:36:13.660
> 
> 标签：compiler-construction, static-analysis, lint, pc-lint

因此，我阅读了一些杂志文章和 Gimpel 的 PC-lint 和 Flexelint C/C++ 编译器的网站。

它真的很贵（至少对我来说），但似乎它可能有一些优点来保证成本。

所以我想知道是否有其他人使用/购买过它们并且可以提供他们的意见？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-08T00:52:28.160

前段时间我曾经使用过 PC-Lint。个人认为值得投资。您的问题的部分答案取决于其他一些因素：

1.) 您是否尝试将编译器警告级别调到最高级别？非常烦人，但这具有捕捉任何明显语义错误的效果。在我投资像 PC-Lint 这样的专业工具之前，我会这样做

2.) 你在为谁编码？如果这是学校的家庭作业，那就不值得了。如果它是您要出售给其他人的软件，那么在生成干净稳定的代码方面这是一项不错的投资。

请注意，与任何工具一样，学习有效使用 PC-Lint 可能需要一些时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-30T04:21:01.573

我刚刚将 Gimpel 的 PC-Lint 添加到构建过程中。这是一个困难的配置，但绝对值得。过去几年，我在几个不同的项目中使用相同的 linting 工具工作了几年。静态代码检查工具有助于检查编译器不会检查的各种错误，即使编译器的警告设置为最高（最严格）级别。

此外，Gimpel 的工具支持 MISRA（以及针对不同版本 ANSI C 的特定规则）。

我同意 Onorio Catenacci 的观点，如果你正在做家庭作业，那可能不值得付出代价。但如果是为了更健壮的构建过程，Lint 将帮助您在开发周期的早期发现错误，这是值得的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T02:08:35.410

我在 1985 年使用了 Gimpel 的皮棉和其他产品，是一个非常满意的客户。我有一份兼职咨询工作，而 Gimpel 的工具使我能够更快地交付更可靠的组件。

我不知道事情的相对状态在 25 年中发生了怎样的变化。我很高兴看到至少在 Unix 上，Gimpel 仍在分发混淆的源代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T18:15:03.800

这不是您所问问题的答案，但如果您正在考虑使用一种商业静态分析工具，您可能也应该考虑其他公司的静态分析工具。参见，例如，[are-c-static-code-analyis-tools-worth-it？](https://stackoverflow.com/questions/639694/are-c-static-code-analyis-tools-worth-it). 我建议在问题中添加“静态分析”标签。

# c# - 如何将 IntPtr 转换回对象

> ID：728105
> 
> 赞同：6
> 
> 时间：2009-04-08T00:37:00.633
> 
> 标签：c#, unmanaged, marshalling, intptr

所有，这是对上一个问题的跟进：[C#formatting external Dll function parameters](https://stackoverflow.com/questions/727942/c-formatting-external-dll-function-parameters)

这里特别是我试图转换为 C# 的代码：

```
FILES_GetMemoryMapping((LPSTR)(LPCTSTR)MapFile, &Size, (LPSTR)MapName, &PacketSize, pMapping, &PagePerSector);
// Allocate the mapping structure memory
pMapping = (PMAPPING)malloc(sizeof(MAPPING));
pMapping->NbSectors = 0;
pMapping->pSectors = (PMAPPINGSECTOR) malloc((Size) * sizeof(MAPPINGSECTOR));

// Get the mapping info
FILES_GetMemoryMapping((LPSTR)(LPCTSTR)MapFile, &Size, (LPSTR)(LPCTSTR)MapName, &PacketSize, pMapping, &PagePerSector); 
```

函数“FILES_GetMemoryMapping”被调用了两次，我猜第一次是获取结构的大小，第二次是实际填充它。

“pMapping”是指向 C++ 中结构的指针，在我的 C# 代码中，我将 pMapping 作为 IntPtr 类型。下一行我可以转换为：

```
pMapping = Marshal.AllocHGlobal(Marshal.SizeOf(new UM0516.Mapping())); 
```

以 (UM0516.Mapping) 为结构。很酷，所以我刚刚分配了一些 IntPtr 指向的空间。现在是下一行...“pMapping->NbSectors = 0;”

我应该如何进入现在分配的非托管内存空间，将其类型转换为 (UM0516.Mapping) 结构，并设置其成员之一？然后确保我没有搞砸太多，这样我第二次调用“FILES_GetMemoryMapping”时，它现在可以使用这个结构了吗？

-- 好的，我接受了一些建议，现在有了这个：

我试过了，在第一次“FILES_GetMemoryMapping”调用时出现“AccessViolationException 未处理”异常

这是我所拥有的：

```
string filepath = @"C:\blah.blah";
string MapFile = @"D:\blah.blah";
UM0516.Mapping myMapping = new UM0516.Mapping();
IntPtr pMapping = Marshal.AllocHGlobal(Marshal.SizeOf(myMapping));
Marshal.StructureToPtr(myMapping, pMapping, false);
ushort PacketSize = 0;
ushort size = 0;
string MapName = String.Empty;
byte PagePerSector = 0;

uint b7 = UM0516.FILES_GetMemoryMapping(MapFile, out size, MapName, out PacketSize, pMapping, out PagePerSector); 
```

你认为这个异常来自“pMapping”参数吗？这可能来自我传递的其他任何东西吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-08T00:45:31.220

为了获得 IntPtr，您要做的是创建您的结构，设置您可能需要的任何选项，像您已经拥有的那样分配内存，然后调用..

```
System.Runtime.InteropServices.Marshal.StructureToPtr(yourStructVariable, pMapping, false); 
```

这会将数据从填充的结构复制到分配的内存中。

要将内存中的数据复制到名为“ `mapping`”的新结构中，请调用...

```
UM0516.Mapping mapping = (UM0516.Mapping)System.Runtime.InteropServices.Marshal.PtrToStructure(pMapping, typeof(UM0516.Mapping)) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-07-09T20:47:48.847

要将 IntPtr 转换回对象，我使用了一种方法来执行此操作：

```
if (ptrToUnwrap == IntPtr.Zero)
    return null;
GCHandle handle = (GCHandle)ptrToUnwrap;
object handledObj = handle.Target;
if (handles.unfreed.Contains(handle))
    handles.unfreed.Remove(handle);
handle.Free();
return handledObj; 
```

（handles.unfreed 是一个未释放的 GCHandles 列表，在释放或完成句柄时会自动释放这些 GCHandles）

# c# - 时间敏感的消息验证散列 - 获得松散的时间值

> ID：728108
> 
> 赞同：0
> 
> 时间：2009-04-08T00:38:24.607
> 
> 标签：c#, security, encryption, hash

我正在研究生成对时间敏感的伪随机一次性密码。

要发送消息，用户输入他们的密码，该密码与消息一起被散列。生成的哈希与消息一起发送到服务器进行验证。服务器执行相同的哈希并将其值与提供的值进行比较。

```
verificationKey = Hash(message + password); 
```

这可以很好地验证针对用户的消息，但我需要防止攻击者重复提交。攻击者只需再次提交相同的信息，就会被接受。

本质上，我需要一个松散的基于时间的密钥来包含在哈希中。这将意味着不同时间的不同哈希值，但有足够的余地来解释通信延迟。

```
verificationKey = Hash(message + password + time); 
```

显然，如果时间值是特定的，客户端和服务器之间的任何不匹配都会导致问题。即使时间值四舍五入到最接近的整小时，也会有一个时间点 (x:30)，由于传达消息所花费的时间，值可能会有所不同。

任何人都可以就我如何获得这样的宽松时间价值提出任何建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T00:46:30.127

只需将时间戳四舍五入到几秒钟 - 可能是 2、5 或 10。服务器必须尝试两次验证 - 一次使用当前时间戳，一次使用最后一个时间戳。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T00:43:54.343

一种方法是用时间散列，然后附加时间（*在*混淆它之后）。当您收到消息时，剥离时间，解密它，然后与服务器时间进行 TimeSpan 比较。如果它足够接近，您就可以解密整个消息。

# visual-studio - 如何在 Visual Studio (2008 SP1) 项目中从 .bat 返回错误？

> ID：728113
> 
> 赞同：4
> 
> 时间：2009-04-08T00:42:16.377
> 
> 标签：visual-studio, batch-file

我有一个在 Visual Studio 自定义构建步骤中运行的批处理文件，用于将文件复制到安装目录中。我希望它在复制失败时正确出错。我所拥有的选项的问题是：

*   `exit 1`
    这在构建序列中工作得很好，但有时我想从命令行或另一个批处理中使用批处理文件，在这些情况下`exit`，调用者也会退出。

*   `exit /b 1`
    这在命令行或另一个批处理文件中运行良好，但 Visual Studio 无法识别返回代码不是 0（即它报告项目有“0 错误”）。

我遇到了一个为我提供解决方案的链接：[http ://www.nabble.com/Re:-bjam-and-Windows-p17457249.html](http://www.nabble.com/Re:-bjam-and-Windows-p17457249.html)

本质上它说我必须在执行`exit /b`. 例如，

```
echo MyProj : error : could not copy files. 
```

有谁知道究竟是什么消息格式触发 Visual Studio 识别错误？

我试过调整这个，有些工作，有些没有。似乎它必须匹配类似的东西

```
.*\: .*error.*\: 
```

这在任何地方都有记录吗？

谢谢。

这适用于 Windows XP Pro SP3 上的 Visual Studio 2008 SP1（以防`cmd.exe`Windows 版本之间的行为不同）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T09:17:31.957

您可以尝试的另一件事是：

```
set errorlevel=1
exit /b 
```

这基本上与@Bill 建议的效果相同。最后一个程序运行的返回值设置为调用的环境变量`%errorlevel%`，然后当你退出 cmd.exe 这是从进程返回的值（这是 VS 读取的）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T09:24:36.447

关于您的实际问题，
[此页面](http://msdn.microsoft.com/en-us/library/yxkt8b26.aspx)指定了 VS 预期的完整语法作为构建工具的输出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T01:30:41.643

你确定你测试正确吗？我刚刚尝试了这个批处理文件：

```
echo bla
exit /b 1 
```

使用 VS2008，作为预构建步骤并得到以下信息：

```
1>------ Build started: Project: XXXX, Configuration: Debug Win32 ------
1>Performing Pre-Build Event...
1>bla
1>Project : error PRJ0002 : Error result 1 returned from 'C:\Windows\system32\cmd.exe'.
1>Build log was saved at "file://c:\XXXXX\BuildLog.htm"
1>XXXXX - 1 error(s), 0 warning(s)
========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ========== 
```

我还尝试使用自定义构建步骤对具有相同结果的文件进行此操作。
应该注意的是，我使用的是 VS2008- **SP1**，所以这可能是不同的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T06:34:17.077

通常，批处理文件的返回值是从批处理文件中执行的最后一个命令的返回值。

Exit*应该可以*工作，但如果没有，无论出于何种原因，您始终可以使用帮助程序来设置您的返回值。

回到 DOS 时代，您可以将 ECHO 与 CHOICE 命令结合使用来设置您的返回值，但遗憾的是，它不再是 Windows 的一部分。

所以你可以写一个小程序。将所需的返回值作为参数，然后将其设置并返回为返回值的东西：

```
#include <cstdio>

int main(int argc, char * argv[]) {

    if (argc == 2) {

        return strtoul(argv[1], NULL, 10);

    } else {
        return 0;
    }
} 
```

然后在您的批处理文件中，您只需使用所需的返回值调用程序，然后跳到最后。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-03-30T14:56:26.997

由于某种原因，`exit /b 12`在写入后期构建步骤时没有设置退出代码。常规`exit 12`会工作。

所以要从你的 bat 文件中正确返回退出代码，你应该这样写：

```
call yourbat.bat
if %errorlevel% NEQ 0 exit %errorlevel% 
```

该`call`命令在运行 bat 文件时很重要，它会创建一个运行 bat 文件的新上下文，因此当您在 bat 文件中运行时`exit /b 1`，它将退出该上下文，而不是整个命令解释器。然后您可以比较错误级别并退出。

# python - Python：将大文件下载到本地路径并设置自定义 http 标头

> ID：728118
> 
> 赞同：5
> 
> 时间：2009-04-08T00:44:01.940
> 
> 标签：python, http, download, urllib2, urllib

我正在寻找从 http url 下载文件到本地文件。该文件足够大，我想下载它并将其保存为块，而不是`read()`将`write()`整个文件保存为一个巨大的字符串。

的界面`urllib.urlretrieve`本质上就是我想要的。但是，我看不到通过 下载时设置请求标头的方法 `urllib.urlretrieve`，这是我需要做的事情。

如果我使用，我可以通过它的对象`urllib2`设置请求头。`Request`但是，我没有看到将`urllib2`文件直接下载到磁盘上的路径（如`urlretrieve`. 相反，我似乎将不得不使用循环来迭代返回的数据块，自己将它们写入文件并检查我们何时完成。

`urllib.urlretrieve`构建一个可以工作但允许传入请求标头的函数的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-01-08T15:53:49.750

使用 urllib2 编写自己的函数有什么危害？

```
import os
import sys
import urllib2

def urlretrieve(urlfile, fpath):
    chunk = 4096
    f = open(fpath, "w")
    while 1:
        data = urlfile.read(chunk)
        if not data:
            print "done."
            break
        f.write(data)
        print "Read %s bytes"%len(data) 
```

并使用请求对象设置标头

```
request = urllib2.Request("http://www.google.com")
request.add_header('User-agent', 'Chrome XXX')
urlretrieve(urllib2.urlopen(request), "/tmp/del.html") 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T01:46:37.797

如果你想使用 urllib 和 urlretrieve，子类化`urllib.URLopener`并使用它的`addheader()`方法来调整标题（即：`addheader('Accept', 'sound/basic')`，我从 urllib.addheader 的文档字符串中提取）。

要安装供 urllib 使用的 URLopener，请参阅文档的[urllib._urlopener](http://docs.python.org/library/urllib.html#module-urllib)部分中的示例（注意下划线）：

```
import urllib

class MyURLopener(urllib.URLopener):
    pass # your override here, perhaps to __init__

urllib._urlopener = MyURLopener 
```

但是，您会很高兴听到您对问题评论的评论，读取一个空字符串`read()`确实是停止的信号。例如，这就是 urlretrieve 处理何时停止的方式。TCP/IP 和套接字将读取过程抽象化，阻止等待附加数据，除非另一端的连接是 EOF 并关闭，在这种情况下，从连接中读取（）会返回一个空字符串。一个空字符串意味着没有数据流入......您不必担心有序的数据包重新组装，因为这一切都已为您处理。如果这是您对 urllib2 的关注，我认为您可以安全地使用它。

# ruby - 如何将双精度转换为十六进制？

> ID：728121
> 
> 赞同：5
> 
> 时间：2009-04-08T00:44:18.430
> 
> 标签：ruby, double, hex, byte

如何将 ruby​​ float/double 转换为高字节和低字节的高端十六进制。

例子：

```
start with 99.0 
```

以结束

```
40 58 C0 00   00 00 00 00
high bytes    low bytes 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T01:38:34.867

好吧，[就像帕特里克所说](https://stackoverflow.com/questions/728121/how-to-convert-a-double-to-hex/728202#728167)的那样，使用`Array\#pack`.

```
irb> [99.0].pack('G').split('').map { |ds| ds[0] }
#=> [64, 88, 192, 0, 0, 0, 0, 0]
irb> _.map { |d| "%02x" % d }
#=> ["40", "58", "c0", "00", "00", "00", "00", "00"]
irb> [99.0].pack('E').split('').map { |ds| ds[0] }
#=> [0, 0, 0, 0, 0, 192, 88, 64]
irb> _.map { |d| "%02x" % d }    
#=> ["00", "00", "00", "00", "00", "c0", "58", "40"] 
```

所以这取决于你是想用零索引中的高位字节还是零索引中的低位字节来解包：

```
 E     |  Double-precision float, little-endian byte order
      G     |  Double-precision float, network (big-endian) byte order 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T01:14:15.940

数组类有一个打包方法：

```
a = [99.0]
s = a.pack("d")
s
=> "\000\000\000\000\000\300X@" 
```

这为您提供了一个字节字符串，但将其转换为十六进制以进行打印应该是微不足道的。

如果你想反其道而行之，string 类有一个 unpack 方法：

```
s.unpack("d")
=>[99.0] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-10-30T08:39:16.293

对于 Ruby 2.x：

```
pry(main)> [99.0].pack('E').split('')
=> ["\x00", "\x00", "\x00", "\x00", "\x00", "\xC0", "X", "@"]
pry(main)> _.map { |ds| ds.unpack("H*").first }
=> ["00", "00", "00", "00", "00", "c0", "58", "40"] 
```

# html - 我有一个 Linux 机器。如何查看我的 HTML 页面在 Internet Explorer 中呈现的样子？

> ID：728122
> 
> 赞同：7
> 
> 时间：2009-04-08T00:45:29.690
> 
> 标签：html, browser

我有一个 Linux 机器。如何查看我的[HTML](http://en.wikipedia.org/wiki/HTML)页面在 Microsoft Internet Explorer 中呈现的样子？如何在 Internet Explorer 中测试[JavaScript功能？](http://en.wikipedia.org/wiki/JavaScript)

我不想安装[VM](http://en.wikipedia.org/wiki/Virtual_machine)和 Windows 操作系统的副本。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T00:47:23.790

作为 Linux Web 开发人员，您最好的朋友是[IEs4Linux](http://en.wikipedia.org/wiki/IEs4Linux)，它使用[Wine](http://en.wikipedia.org/wiki/Wine_%28software%29)运行不同版本的 Internet Explorer。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-08T00:49:26.733

查看此页面以查看您的页面在浏览器和操作系统中的外观

[http://browsershots.org/](http://browsershots.org/)

要实际与您的网站进行交互，我建议使用[Wine或](http://www.winehq.org/)[Xen](http://www.cl.cam.ac.uk/research/srg/netos/xen/)等VM 。

另请参阅此链接：[如何在 Ubuntu 上安装 Internet Explorer](http://www.howtoforge.com/ubuntu_internet_explorer)或查看此页面[IEs4Linux](http://www.tatanka.com.br/ies4linux/page/Main_Page)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T01:04:02.737

我在工作中使用 Linux 并进行必须支持 Internet Explorer 6（及更高版本）和 Firefox 2（及更高版本）的 Web 开发。

[IE4Linux](http://www.tatanka.com.br/ies4linux/page/Main_Page)并不足以正确测试 Internet Explorer 浏览器的渲染，因为它的工作方式与 Windows 中的 Internet Explorer 不同。您可以使用[browsershots](http://browsershots.org)之类的东西，但我建议在 VM 中运行 Windows 并使用它进行 Internet Explorer 测试。我已经这样做了一段时间，只要您有用于 Windows XP 的备用 512 MB RAM，它就可以很好地工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T04:57:37.283

另一项与 browsershots 类似但速度更快的服务是[IE NetRenderer](http://ipinfo.info/netrenderer/)。否则，如果您身边有 Windows 的副本，为什么不使用虚拟机呢？Suns [VirtualBox](http://en.wikipedia.org/wiki/VirtualBox)已经足够好了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-02T11:26:10.727

我同意这`browsershots.org`是一个很好的起点，但它只提供了一个屏幕截图。如果您正在使用[JavaScript](http://en.wikipedia.org/wiki/JavaScript)或[jQuery](http://en.wikipedia.org/wiki/JQuery)，并且需要查看在 Internet Explorer（实际上是 Internet Explorer 5 及更高版本的任何版本）中与页面交互时事物的外观，这`crossbrowsertesting.com`是一个极好的资源。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-10-19T01:25:38.440

在不支付 Windows 许可证的情况下进行准确渲染的最佳选择可能是使用 MS 提供的虚拟机之一。以下是有关使用 VirtualBox 设置 VM 的教程的一些链接。

[http://blog.philipbrown.id.au/2009/03/internet-explorer-application-compatibility-vpc-images-under-virtualbox/](http://blog.philipbrown.id.au/2009/03/internet-explorer-application-compatibility-vpc-images-under-virtualbox/)

[http://www.makeuseof.com/tag/installing-windows-7-on-a-virtual-machine/](http://www.makeuseof.com/tag/installing-windows-7-on-a-virtual-machine/)

我已经使用过 VirtualBox 和这些图像，而且效果很好，唯一的缺点是你必须每季度重新安装一次，因为图像过期了。

# iphone - 清除xcode中的所有文本字段

> ID：728125
> 
> 赞同：0
> 
> 时间：2009-04-08T00:45:51.437
> 
> 标签：iphone, cocoa-touch, uitextfield

选择文本字段以使用键盘输入文本时，是否有清除所有测试字段的方法。

例如，如果您有一个已经运行过一次的小费计算器，并且所有字段现在都已填充。

现在，当您要运行另一个计算时，您单击文本字段，所有其他字段也会自动清除。

希望这是有道理的。史蒂夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T01:14:05.067

您的视图控制器应该实现该`UITextFieldDelegate`协议。然后将`-textFieldShouldBeginEditing:`or`-textFieldDidBeginEditing:`方法添加到您的视图控制器。在您的 nib 文件中或创建文本字段时，将它们的`delegate`属性设置为您的视图控制器。

然后，当调用`-textFieldShouldBeginEditing:`or`-textFieldDidBeginEditing:`方法时，如果您的应用程序准备好开始新的计算，您可以清除所有文本字段。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T07:13:41.613

您可能希望将此（以及您的后续问题）标记为“cocoa-touch”，因为它们是关于在 iPhone OS 的 Cocoa Touch 框架中使用 API，而不是“xcode”（这只是一个开发工具）。

# c++ - 我的股票市场计划可以使用什么数据源？

> ID：728126
> 
> 赞同：21
> 
> 时间：2009-04-08T00:46:11.827
> 
> 标签：c++, open-source, stocks, trading

我想为 Linux 和 Windows 制作一个免费的开源 C++ 应用程序，它将创建实时股票市场图表（即它们经常刷新）。

请您就这些问题给我一些指示：

*   我应该使用什么作为数据源？我可以实施免费服务吗？我想使用与[Google](http://www.google.co.uk/finance?q=LON:RBS)等公司相同或相似的信息。
*   我不确定最好使用哪种 GUI 工具包，是否有内置图表的工具包，或者我需要为此使用专门的库？

需要注意的一些事项：

*   这是我第一次尝试跨平台 C++ 开发和 Linux 的 GUI 应用程序。
*   我在英国，所以我想使用为伦敦证券交易所 (LON) 和纳斯达克等提供信息的数据源。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-08T00:51:15.903

## 截至 2014 年 11 月，这些链接已失效。

*   谷歌金融 API：[http ://code.google.com/apis/finance/](http://code.google.com/apis/finance/)
*   雅虎！财务 API：http: [//developer.yahoo.com/finance/](http://developer.yahoo.com/finance/)
*   [带有Qt](http://www.qtsoftware.com/products/)的跨平台 C++ 图表：http : [//www.int.com/products/2d/carnac/chart_component.htm](http://www.int.com/products/2d/carnac/chart_component.htm)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-08T01:32:31.560

假设英国的规则和美国的一样，你基本上有 3 层选择。

你可以从谷歌或雅虎之类的东西上拼凑出一个蹩脚的提要，但你绝对不会得到每一个滴答声，如果那是你所追求的。

从明显的互联网资源中脱颖而出的是一些在线经纪人。他们的数据更可靠、更及时，但显然你需要一个帐户，而且他们必须提供某种 API。检查类似 InteractiveBrokers.com 的网站。它们大多以 java 为中心，但也提供基于 Window 的 C++ DLL。其他几家经纪商也提供类似的 API，但 IB 非常出色，因为它涵盖了包括伦敦在内的众多交易所。如果这是一个问题，它们还可以相对容易地转移货币。

最后你必须去找商业经纪人。您可以通过搜索轻松找到它们，但要准备好每月至少支付几百美元。

我认为马克对 QT 的建议是一个很好的 GUI 方法。Java 往往足以建立一个运行报价网格，但在 IMO 图表区域往往会失败。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-08T03:02:57.083

您说您想要“实时”市场图表。如果您的意思是实时，您将永远无法免费获得。您在 google 等上看到的所有数据都有延迟，通常至少 15 分钟，而且他们不会得到每一个刻度。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-04-09T06:09:26.790

如果延迟不是问题，并且您只对每日数据感兴趣，您可以使用这个[历史数据 API](http://www.kibot.com/)通过简单的 HTTP 请求轻松免费获取历史数据。

# sql - 什么是 Select 语句返回表中的列名

> ID：728131
> 
> 赞同：3
> 
> 时间：2009-04-08T00:48:37.983
> 
> 标签：sql, sql-server, sql-server-2005

是否有任何选择语句来返回表中的列列表？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-08T00:50:30.240

INFORMATION_SCHEMA.COLUMNS 视图将为特定的表名提供列名。

```
SELECT Column_Name + ', '
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'Table_Name' 
```

还有其他几个视图以及上面的一个，您可能会发现它们很有用。这些 INFORMATION_SCHEMA 视图提供有关数据库架构的信息。

```
Select top 10 * from Information_Schema.tables 
Select top 10 * from Information_Schema.views 
Select top 10 * from Information_Schema.routines 
Select top 10 * from Information_Schema.parameters 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T00:52:13.420

保罗的回答对 mysql 是正确的。ON EDIT: 显然还有 sql server。啊。对不起保罗。

对于 sql server，您需要 sys.syscolumns，与此答案非常相似： [如何查看 Sybase 中的列元数据？](https://stackoverflow.com/questions/723115/how-do-i-look-at-column-metadata-in-sybase/723577#723577)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T08:50:10.510

sp_help 表名

将为您提供所有专栏以及许多其他信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T12:30:15.360

您还可以使用 SqlServer 2005 获取列数据

**SELECT column_name '列名'，data_type '数据类型' FROM information_schema.columns WHERE table_name = '表名'**

斯里尼瓦斯唐图拉。sdonthula@live.com

# database-design - 在数据库中对用户定义的层次关系建模的最佳方法是什么？

> ID：728137
> 
> 赞同：3
> 
> 时间：2009-04-08T00:53:19.250
> 
> 标签：database-design, hierarchical-data, user-defined

本质上，我希望用户能够定义一个层次模型，但是我需要允许用户在他们定义的模型中存储数据。这有意义吗？因此，用户将能够创建新的“单元类型”以分层方式进行组织，并决​​定如何组织这些类型的单元。一个简单的例子：在我假设的界面中，用户创建了三种单元类型，树干、分支和叶子。然后用户定义它们之间的关系。叶子可以存在于层次结构中的任何点，分支必须有一个主干作为父级。然后，用户可以创建这些单位类型（作为单位）的实例，并可以根据其模型中定义的规则来组织它们......在数据库中是否有这样做的好方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T01:09:21.537

这是一个非常广泛的问题，但这可能会为您指明正确的方向。请注意，您只能将关系规则存储在数据库中。执行它们将取决于您的客户端代码。试穿这个尺寸..

```
unit:
    unit id,
    name,

unit relationship:
    unit id,
    foreign unit id 
```

然后，您可以通过以下方式使用您的单位关系表..

`unit id`与它所描述的单位有关。 `foreign unit id`应该可以为空。

没有关系记录的 A`unit`只能存在于层次结构的根部。`unit`带有 a 的A`null` `foreign unit id`可以将任何其他`unit`作为其父级。否则，a`unit`必须有另一个`unit`作为其父级，并且它的类型必须是其关系记录中定义的类型之一。

至于存储实例本身，那应该很简单。

```
instance:
    instance id,
    unit id,
    parent instance_id 
```

我确定您还需要其他字段（例如姓名），但我假设您会有所了解。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T01:41:11.850

您需要实现三个概念：

*   “单元类型”及其允许的关联
*   层次结构
*   实际单位

这些概念可以在模型中或多或少独立地共存，但可以协同工作。

```
create table unittype
(
    id int;
    name varchar(20);
)

create table unitrelationship
(
    id int;
    parent_id int;
) 
```

您可以将层次结构建模为自引用表：

```
create table hierarchy
(
    id int;
    parent_id int;
    unit_type_id int;
    unit_id int;
) 
```

然后，您可以将您的单元实例放在一个或多个表中，并按照您的描述使用它们。

```
create table unit
{
    id int;
    ....
} 
```

好消息是您只限制了允许的父类型，这可以在用户界面中轻松实施，例如通过从允许类型的所有现有单元的列表中选择父类型。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-09T20:25:23.223

尽管我需要支持多个层次结构（一组子级，多个层次结构视图），但我正在处理类似的问题。我发现 Joe Celko 的“Smarties 在 SQL 中的树和层次结构”（ISBN：1558609202）很有用。我仍在努力解决这个问题，但在讨论这个话题时它经常出现，似乎值得一提。

# jquery - 使用 Greasemonkey 和 jQuery 加载远程 URL

> ID：728138
> 
> 赞同：1
> 
> 时间：2009-04-08T00:54:57.780
> 
> 标签：jquery, greasemonkey

我正在尝试从 Greasemonkey 脚本中执行 Ajax 查询，但我无法从远程 URL 加载数据。只有当正在查看的页面与 Ajax 调用在同一个域时，该脚本才会起作用。例子：

```
// ==UserScript==
// @name          Hello jQuery
// @namespace     http://www.example.com/
// @description   jQuery test script
// @include       *
// @require       http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js
// ==/UserScript==

$(document).ready(function() {
    $.get("http://www.google.com", function(data){
        alert("Data Loaded: " + data);
    });
});

// EOF 
```

此用户脚本在访问 时运行良好`google.com`，但在任何其他域上都不会出现错误或警报而失败。解决办法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T01:00:26.067

只能`GM_xmlhttpRequest`做跨站访问，不能做jQuery使用的普通[XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-08T23:32:20.637

在 Greasemonkey 中，有一个调用[XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest)`GM_xmlhttpRequest`的函数。但是，它不符合接口。因此，不能将它与 jQuery 一起使用。这适用于 jQuery 1.5。`XmlHttprequest`

Greasemonley 中的 jQuery Ajax 看起来像：

```
$.ajax({
    url: '/p/',// this even works for cross-domain requests by default
    xhr: function(){ return new GM_XHR(); },
    type: 'POST',
    success: function(val){
        ...
    }
}); 
```

来源：[http ://www.monperrus.net/martin/greasemonkey+jquery+and+xmlhttprequest+together](http://www.monperrus.net/martin/greasemonkey+jquery+and+xmlhttprequest+together)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-08T00:58:04.747

是的，你不能那样做。它被称为[XSS](http://en.wikipedia.org/wiki/Cross-site_scripting)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-27T05:25:08.883

你可以试试`load(URL, [data], [func])`。

我在[一个示例应用程序](http://sites.google.com/site/spyderhoodcommunity/tech-stuff/jqueryloadurldatafunc)中使用了它，它为我加载了 Google 搜索，即使它位于另一个域中。有一个缺点，当您尝试访问另一个域时会出现 JavaScript 安全警报。

我希望它有帮助！

PS我实际上尝试了一个非谷歌域并收到了一些错误。但我发现，出现错误是因为页面与收到的响应内容不兼容（JavaScript 错误等）。我确实发现一些页面执行成功，是我在另一个域中创建的。因此，您还必须注意加载的内容类型。

可能在这种情况下，将内容加载到 iframe 中对您来说会更好。

# java - 我可以动态卸载和重新加载（相同的其他版本）JAR 吗？

> ID：728140
> 
> 赞同：18
> 
> 时间：2009-04-08T00:56:28.620
> 
> 标签：java, jakarta-ee, jar

我正在编写一个服务器程序，用于运行 API 的单元测试 *（显示大量信息并提供 Web 访问以控制/监视整个事物）...*

此 API**在编译期间为服务器所知，**并作为 JAR 提供。

为了能够比较**不同版本** API 的单元测试结果（无需重新启动服务器），我希望能够卸载 API 的“当前”版本，并重新加载新版本（或旧版本） .

我不想使用 URLClassLoader 并按名称
（ using **`getDeclaredMethod("someMethod")`**）调用每个方法，
因为服务器严重依赖于 API，并且以这种肮脏的方式“包装”每个方法调用会很复杂。

我在想：由于 JAR 的**所有**版本的所有接口都是**相同**的，我不能通过以某种方式重新加载 JAR 的另一个版本来做到这一点（没有那个按名称调用吗？）。

*注意：我使用的是最新的 Java SE (6) 和 Java EE (5)。*

如果您认为，我试图实现的目标是不可能的，请提出“解决方法”或不同的概念。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-08T01:23:12.470

我想如果你加载一个类使用

```
Class.forName(clsname, init, classloader); 
```

（此处为[Javadoc](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Class.html#forName(java.lang.String,%20boolean,%20java.lang.ClassLoader))）您将获得给定类加载器提供的类的实例。由于该类而加载的所有内容也将通过相同的类加载器加载。

只要您对从此时开始实例化的对象非常小心（以允许 GC），您应该能够重新加载不同的版本。我以前用 Java 1.3 做过一次，它需要大量的调试，但最后我有一个“引导”应用程序，它`Runnable`按名称加载一个类，并且能够通过针对不同的实例化一个新的类加载器来“软重启” URL 并再次访问。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-07-09T14:03:45.967

您可以使用开源包：**JclLoader**，它有助于加载同一个 jar 的不同版本。这也是在我们的一个系统中进行测试的需要。

链接：http: [//sourceforge.net/projects/jcloader/](http://sourceforge.net/projects/jcloader/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-03T23:32:41.510

您可以以编程方式修改您的类路径以反映您的 JAR 更改。这是我的做法：

```
 URLClassLoader urlClassLoader = (URLClassLoader) ClassLoader.getSystemClassLoader();
        Method m = URLClassLoader.class.getDeclaredMethod("addURL", new Class[]{URL.class});
        m.setAccessible(true);
        m.invoke(urlClassLoader, jarFile.toURI().toURL());
        String cp = System.getProperty("java.class.path");
        if (cp != null) {
            cp += File.pathSeparatorChar + jarFile.getCanonicalPath();
        } else {
            cp = jarFile.toURI().getPath();
        }
        System.setProperty("java.class.path", cp); 
```

其中**jarFile**是您要使用/覆盖的 jar 版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T01:59:20.357

[OSGi](http://www.osgi.org/Main/HomePage)是一个允许您执行此操作的框架。 [JSR 277 Java 模块系统](http://jcp.org/en/jsr/detail?id=277)也是为此而设计的（我认为）。我没有关注 OSGi -vs- JSR 277 的辩论，所以我不知道他们是否正在尝试对它们进行调整。

您可以使用类加载器自行开发，但它会不那么“有趣”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T03:23:09.483

是的。我在[NFJS](http://www.nofluffjuststuff.com/show_session_view.jsp?presentationId=8599&showId=110)会议上看到过它。这就是 Web 容器之类的东西如何支持应用程序的热部署，并涉及利用类加载器的范围。为了完成它，您需要创建一个新的类加载器并使用它来加载有问题的库。然后扔掉（或不扔）加载器并在您想要重新加载时创建另一个。您可能还必须覆盖类加载器的行为（我记得默认情况下类加载器首先通过其父级获取类。）此外，我记得一个警告，即由不同类加载器创建的对象**不**兼容（不相同） type) 相互关联，即使 .class 文件完全相同。

不过，这对我来说主要是[魔法](http://en.wikipedia.org/wiki/Deep_magic_(programming))。;-)

* * *

## 回答 #6

> 赞同：-5
> 
> 时间：2009-04-08T01:13:57.050

可能不是。Java 类加载器并不真正支持运行时加载。甚至可用的类加载器也是使用代理对象的黑客。

# security - 从命令行忽略“安全警告”运行脚本

> ID：728143
> 
> 赞同：79
> 
> 时间：2009-04-08T00:58:57.427
> 
> 标签：security, powershell

我正在尝试从我信任的共享文件夹中执行一个脚本：

```
PowerShell -file "\\server\scripts\my.ps1" 
```

但是我收到了安全警告，必须按“R”才能继续

> 安全警告 仅运行您信任的脚本。虽然来自 Internet 的脚本很有用，但此脚本可能会损害您的计算机。你想运行 \server\scripts\my.ps1 吗？[D] 不运行 [R] 运行一次 [S] 暂停 [?] 帮助（默认为“D”）：d

我可以忽略这个警告吗？我想要的所需伪代码是：

```
PowerShell -IGNORE_SECURITY_WARNING -file "\\server\scripts\my.ps1" 
```

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2009-04-08T02:48:44.340

[这在 Lee Holmes 博客上的“标准映像中的 PowerShell 执行策略”](http://www.leeholmes.com/blog/2008/07/24/powershell-execution-policies-in-standard-images/)和[*Windows Power Shell 博客*](http://blogs.msdn.com/powershell/archive/2008/09/30/powershell-s-security-guiding-principles.aspx)[上的“PowerShell 安全指导原则”中](http://blogs.msdn.com/powershell/archive/2008/09/30/powershell-s-security-guiding-principles.aspx)*有所涉及。*

 ***总结** 一些机器将 UNC 路径视为大坏网，因此 PowerShell 将它们视为远程文件。您可以在这些服务器上禁用此功能 ( `UncAsIntranet = 0,`) 或将远程计算机添加到您的受信任主机。

如果您不想这样做，PowerShell v2 支持一个`-ExecutionPolicy`参数，该参数完全符合您的伪代码的要求。`PowerShell -ExecutionPolicy Bypass -File (...)`.

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2012-04-13T09:50:51.193

为避免警告，您可以：

```
Set-ExecutionPolicy bypass 
```

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2013-09-18T22:13:46.860

如果您在下载的 powershell 脚本中遇到此错误，您可以通过以下方式取消阻止脚本：

1.  右键单击有`.ps1`问题的文件，然后选择**属性**

2.  单击文件属性中的**取消阻止**

    ![在此处输入图像描述](https://i.stack.imgur.com/jOpzn.png)

3.  点击**确定**

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2016-02-09T09:20:08.757

只需将 1 分配给 SEE_MASK_NOZONECHECKS 环境变量

```
$env:SEE_MASK_NOZONECHECKS = 1
Start-Process $msi_file_path /qn -Wait | out-null 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T01:09:11.380

试试这个，编辑文件：

```
notepad foo.ps1:Zone.Identifier 
```

并设置'ZoneId = 0'

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-05-13T14:45:40.930

在我的具体情况下，这些都不起作用。所做的是从 FQDN 更改为 NetBIOS 名称。

代替：
`\\server.domain.net\file.ps1`
使用：
`\\server\file.ps1`

使用该名称绕过 IE 中的“自动检测 Intranet 网络”配置。

请参阅此处博客中的选项 1：http: [//setspn.blogspot.com/2011/05/running-powershell-scripts-from-unc.html](http://setspn.blogspot.com/2011/05/running-powershell-scripts-from-unc.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-10-07T15:52:33.970

我制作了这个 powershell 脚本来取消阻止我服务器上共享上的所有文件

```
Get-ChildItem "\\ServerName\e$\MyDirectory\" -Recurse -File | % {
       Unblock-File -Path $_.FullName
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-08T01:06:05.447

您想使用 Set-ExecutionPolicy 在您的机器上设置执行策略：

```
Set-ExecutionPolicy Unrestricted 
```

您可能需要调查各种执行策略，看看哪一个适合您。查看“ `help about_signing`”以获取更多信息。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-08T01:10:40.147

你是从网上下载的脚本吗？

然后在命令行上使用 sysinternal 的[streams.exe](http://technet.microsoft.com/en-us/sysinternals/bb897440.aspx)从文件中删除 NTFS 流。

```
cmd> streams.exe .\my.ps1 
```

现在尝试再次运行脚本。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-12-31T07:19:57.660

假设您需要从共享文件夹启动 ps 脚本

```
copy \\\server\script.ps1 c:\tmp.ps1 /y && PowerShell.exe -ExecutionPolicy Bypass -File c:\tmp.ps1 && del /f c:\tmp.ps1 
```

PS减少谷歌搜索）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-10-15T10:14:27.597

这很简单，如果您有多个 ps1 文件，请打开您的 PowerShell 并编写以下命令。在这里你必须用你的路径改变路径。

```
PS C:\Users> Get-ChildItem -Path "D:\downlod" -Recurse | Unblock-File 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-04-04T06:22:56.733

尝试 set-executionpolicy "Policyname" -force 开关，警告弹出窗口不应该出现。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-08-12T12:15:29.207

对于那些想要从已加载的 PowerShell 会话中访问文件的人，要么使用[Unblock-File](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/unblock-file?view=powershell-7)将文件标记为安全（尽管您已经需要设置一个宽松的执行策略`Unrestricted`才能工作），或者更改执行策略仅针对当前的 PowerShell 会话：

```
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process 
```

# asp.net - 如何将 SqlDatasource ConnectionString 属性绑定到函数

> ID：728144
> 
> 赞同：4
> 
> 时间：2009-04-08T01:00:22.977
> 
> 标签：asp.net

我正在尝试将 ConnectionString 属性设置为 ASPX 页面中函数的返回值。

例子：

```
<asp:SqlDataSource runat="server" id="blah"
    ConnectionString="<%= ServerSensing.GetConnectionStringByServer("someKey"); %>"
    >
    ...
</asp:SqlDataSource> 
```

以上显然是行不通的..所以..什么会？

先发制人：*不，我不能使用Web.config绑定

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T02:07:21.163

您应该可以在 Page_Load 中设置它，例如：

```
blah.ConnectionString = ServerSensing.GetConnectionStringByServer("someKey"); 
```

或者，如果您无法访问后面的代码，请在页面上放置一些内联代码，例如在 SqlDataSource 的标记之前

```
<%
     blah.ConnectionString = ServerSensing.GetConnectionStringByServer("someKey");
%> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-13T01:04:17.613

我发现关于这个问题的最佳方法是在您的解决方案中使用 Expression Builder。

使用此功能，您可以创建自定义内联表达式并在`SqlDataSource`标签中使用它。

你会在这里找到一些例子：

[http://weblogs.asp.net/infinitiesloop/archive/2006/08/09/The-CodeExpressionBuilder.aspx](http://weblogs.asp.net/infinitiesloop/archive/2006/08/09/The-CodeExpressionBuilder.aspx)

这就是我在我的应用程序中实现的方式：

* * *

```
[ExpressionPrefix("RepConnectionString")]
public class RepConnectionStringExpressionBuilder : ExpressionBuilder
{
    public override CodeExpression GetCodeExpression(BoundPropertyEntry entry, object parsedData, ExpressionBuilderContext context)
    {
        CodeTypeReferenceExpression thisType = new CodeTypeReferenceExpression(base.GetType());

        CodePrimitiveExpression expression = new CodePrimitiveExpression(entry.Expression.Trim().ToString());

        string evaluationMethod = "GetConnectionString";

        return new CodeMethodInvokeExpression(thisType, evaluationMethod, new CodeExpression[] { expression });
    }

    public static string GetConnectionString(string expression)
    {
        XmlDocument xmlDoc = new XmlDocument();
        string wPath = HttpContext.Current.Server.MapPath("~/XmlFile.xml");
        xmlDoc.Load(wPath);
        XmlNode wNode = xmlDoc.SelectSingleNode("Autenticacoes/Database[@id='" + expression + "']");

        string wConnString = "";
        if (wNode != null)
        {
            wConnString = "Data Source=" + wNode.Attributes["servidor"].Value + 
                          ";Initial Catalog=" + wNode.Attributes["db"].Value + 
                          ";Persist Security Info=True" + 
                          ";User ID=" + wNode.Attributes["login"].Value + 
                          ";Password=" + wNode.Attributes["senha"].Value;
        }

        return wConnString;
    }
} 
```

* * *

在 web.config 中：

```
<compilation>
    <expressionBuilders>
        <add expressionPrefix="RepConnectionString" type="RepConnectionStringExpressionBuilder" />
    </expressionBuilders>
</compilation> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T01:53:42.243

你能在后面的代码中设置连接字符串吗？

# c# - 如何在 Castle Active Record 中执行“ExecuteNonQuery”

> ID：728160
> 
> 赞同：0
> 
> 时间：2009-04-08T01:09:39.447
> 
> 标签：c#, .net, castle-activerecord

我有以下代码通过我们的活动记录 ORM 层执行数据库级操作。

```
public static void Vacuum() {
  Execute(
    delegate(ISession session, object instance) {
      ISQLQuery query =
        session.CreateSQLQuery(@"
          VACUUM billableaddresses;
          ")
      query.List();
      return null;
    }, null);
} 
```

通常，当我需要进行这样的非查询时（我承认这非常罕见），我简单地输入一个 select '1'; 在足够安抚 Active Record 以将查询作为非查询执行的查询之后。

但是，postgres 'vacuum' 命令必须单独运行，并且不能作为多语句查询的一部分。

看 ISQLQuery 接口，似乎没有执行非查询的方法，所以我想知道如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T02:18:51.790

对于特定的数据库调用，您可以从中获取原始 IDbConnection

```
ActiveRecordMediator.GetSessionFactoryHolder().GetSessionFactory(typeof (object)).ConnectionProvider.GetConnection() 
```

# python - 安全擦除内存中的密码 (Python)

> ID：728164
> 
> 赞同：49
> 
> 时间：2009-04-08T01:13:20.607
> 
> 标签：python, security, passwords

如何将用户输入的密码存储在内存中，并在不再需要后安全删除？

详细地说，目前我们有以下代码：

```
username = raw_input('User name: ')
password = getpass.getpass()
mail = imaplib.IMAP4(MAIL_HOST)
mail.login(username, password) 
```

调用该`login`方法后，我们需要做些什么来用乱码填充包含密码的内存区域，以便有人无法通过核心转储来恢复密码？

有一个类似的问题，但是它是在 Java 中，并且解决方案使用字符数组： [创建帐户时，如何将密码哈希安全地存储在内存中？](https://stackoverflow.com/questions/646224/how-does-one-store-password-hashes-securely-in-memory-when-creating-accounts)

这可以在 Python 中完成吗？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-04-08T02:01:43.127

Python 对内存的控制没有那么低。接受它，然后继续前进。您可以做的**最好**`del password`的事情是在调用之后`mail.login`不保留对密码字符串对象的引用。任何声称能够做更多事情的解决方案只会给您一种错误的安全感。

Python 字符串对象是不可变的；创建字符串后，没有直接的方法可以更改字符串的内容。*即使*您能够以某种方式覆盖所引用的字符串的内容`password`（这在技术上可以通过愚蠢的 ctypes 技巧实现），仍然会有在各种字符串操作中创建的密码的其他副本：

*   当 getpass 模块从输入的密码中删除尾随换行符时
*   由 imaplib 模块引用密码，然后在将其传递给套接字之前创建完整的 IMAP 命令

您将不得不以某种方式获取对所有这些字符串的引用并覆盖它们的内存。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-11-18T04:32:22.677

实际上，有一种方法可以在 Python 中安全地擦除字符串；使用 memset C 函数，根据[在 python 中将数据标记为敏感](https://stackoverflow.com/questions/982682/mark-data-as-sensitive-in-python/983525#983525)

编辑添加，在帖子发布很久之后：[这是对字符串实习的更深入研究](http://guilload.com/python-string-interning/)。根据 CPython 引用计数 GC，在某些情况下（主要涉及非常量字符串）不会发生实习，从而使字符串值的清理更加明确。（虽然仍然不是“擦洗”/“消毒”清理。）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2018-08-20T18:52:04.190

正确的解决方案是使用可变的 bytearray() ...，您可以安全地从 RAM 中清除密钥和敏感材料。

但是，有一些库，特别是 python“密码学”库，可以防止“字节数组”被使用。这是有问题的......在某种程度上，这些密码库应该确保*只有*可变类型用于密钥材料。

[SecureString](https://pypi.org/project/SecureString/)是一个 pip 模块，可让您从内存中完全删除密钥...（我对其进行了一些重构并将其称为[SecureBytes](https://pypi.org/project/SecureBytes/)）。我编写了一些单元测试来证明密钥已被完全删除。

但是有一个很大的警告：如果某人的密码是“type”，那么“type”这个词将从所有 python 中删除......包括函数定义和对象属性。

换句话说......改变不可变类型是一个糟糕的主意，除非你非常小心，否则可能会立即使任何正在运行的程序崩溃。

正确的解决方案是：*永远不要对密钥材料、密码等使用不可变类型*。任何构建加密库或例程（如“getpass”）的人都应该使用“bytearray”而不是 python 字符串。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-08T02:26:42.757

如果您完成后不需要邮件对象持续存在，我认为您最好的选择是在子流程中执行邮件工作（请参阅[子流程](http://docs.python.org/library/subprocess.html)模块。）这样，当子流程死亡时，您的密码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-23T14:47:47.370

这可以使用 numpy chararray 来完成：

```
import numpy as np

username = raw_input('User name: ')
mail = imaplib.IMAP4(MAIL_HOST)
x = np.chararray((20,))
x[:] = list("{:<20}".format(raw_input('Password: ')))
mail.login(username, x.tobytes().strip())
x[:] = '' 
```

您必须确定密码的最大大小，但这应该在被覆盖时删除数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-10-09T03:56:47.507

这里：下面用零替换变量的内存地址字节，然后取消引用指向内存位置的指针。

在基于 Debian 的系统上测试。

```
import sys 
import ctypes

def nuke(var_to_nuke):
    strlen = len(var_to_nuke)
    offset = sys.getsizeof(var_to_nuke) - strlen - 1
    ctypes.memset(id(var_to_nuke) + offset, 0, strlen)
    del var_to_nuke               # derefrencing the pointer. 
```

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2009-04-08T01:17:11.487

编辑：删除了不好的建议......

如果您愿意，您也可以使用像 java 示例这样的数组，但只需覆盖它就足够了。

[http://docs.python.org/library/array.html](http://docs.python.org/library/array.html)

* * *

## 回答 #8

> 赞同：-5
> 
> 时间：2009-04-08T01:20:09.997

将密码存储在一个列表中，如果只是将列表设置为null，则列表中存储的数组的内存会自动释放。

# c# - 在嵌套母版页中查找控件

> ID：728168
> 
> 赞同：8
> 
> 时间：2009-04-08T01:15:22.757
> 
> 标签：c#, asp.net, .net-3.5, master-pages

我有一个嵌套 2 级的母版页。它有一个母版页，并且该母版页有一个母版页。

当我将控件粘贴在名为“bcr”的 ContentPlaceHolder 中时 - 我必须像这样找到控件：

```
 Label lblName =(Label)Master.Master.FindControl("bcr").FindControl("bcr").FindControl("Conditional1").FindControl("ctl03").FindControl("lblName"); 
```

我完全迷路了吗？还是需要这样做？

我即将使用 MultiView，它位于条件内容控件内部。因此，如果我想更改视图，我必须获得对该控件的引用，对吗？获得该参考将更加糟糕！有没有更好的办法？

谢谢

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-08T01:35:53.500

查找控件很痛苦，我一直在使用很久以前从[CodingHorror 博客](https://blog.codinghorror.com/recursive-pagefindcontrol/)中获得的这种方法，如果传入一个空的 id，只需进行一次修改就返回 null。

```
/// <summary>
/// Recursive FindControl method, to search a control and all child
/// controls for a control with the specified ID.
/// </summary>
/// <returns>Control if found or null</returns>
public static Control FindControlRecursive(Control root, string id)
{
    if (id == string.Empty)
        return null;

    if (root.ID == id)
        return root;

    foreach (Control c in root.Controls)
    {
        Control t = FindControlRecursive(c, id);
        if (t != null)
        {
            return t;
        }
    }
    return null;
} 
```

就您而言，我认为您需要以下内容：

```
Label lblName = (Label) FindControlRecursive(Page, "lblName"); 
```

使用这种方法通常更方便，因为您无需知道控件所在的确切位置即可找到它（当然，假设您知道 ID），但如果您有同名的嵌套控件，您将可能会出现一些奇怪的行为，所以这可能需要注意。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T01:33:06.893

首先，您应该知道 MasterPages 实际上位于 Pages 中。以至于在您的 ASPX 的 Load 事件之后实际上调用了 MasterPage 的 Load 事件。

这意味着，Page 对象实际上是控件层次结构中的最高控件。

因此，了解这一点，在这种嵌套环境中找到任何控件的最佳方法是编写一个递归函数，该函数循环遍历每个控件和子控件，直到找到您要查找的那个。在这种情况下，您的 MasterPages 实际上是主 Page 控件的子控件。

您可以从任何控件内部访问主 Page 对象，如下所示：

C＃：

这一页;

VB.NET

我的页面

我发现通常，控件的类 FindControl() 方法非常无用，因为环境总是嵌套的。

因为如果是这样，我决定使用 .NET 的 3.5 新扩展功能来扩展 Control 类。

通过使用下面的代码 (VB.NET)，例如，您的 AppCode 文件夹，您的所有控件现在将通过调用 FindByControlID() 执行递归查找

```
 Public Module ControlExtensions
    <System.Runtime.CompilerServices.Extension()> _
    Public Function FindControlByID(ByRef SourceControl As Control, ByRef ControlID As String) As Control
        If Not String.IsNullOrEmpty(ControlID) Then
            Return FindControlHelper(Of Control)(SourceControl.Controls, ControlID)
        Else
            Return Nothing
        End If
    End Function

    Private Function FindControlHelper(Of GenericControlType)(ByVal ConCol As ControlCollection, ByRef ControlID As String) As Control
        Dim RetControl As Control

        For Each Con As Control In ConCol
            If ControlID IsNot Nothing Then
                If Con.ID = ControlID Then
                    Return Con
                End If
            Else
                If TypeOf Con Is GenericControlType Then
                    Return Con
                End If
            End If

            If Con.HasControls Then
                If ControlID IsNot Nothing Then
                    RetControl = FindControlByID(Con, ControlID)
                Else
                    RetControl = FindControlByType(Of GenericControlType)(Con)
                End If

                If RetControl IsNot Nothing Then
                    Return RetControl
                End If
            End If
        Next

        Return Nothing
    End Function

End Module 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-08T01:48:27.793

虽然我喜欢递归，并且同意 andy 和 Mun，但您可能要考虑的另一种方法是拥有一个[强类型的 Master page](http://www.odetocode.com/Articles/419.aspx)。您所要做的就是在您的 aspx 页面中添加一个指令。

不要从母版页访问页面的控件，而是考虑从页面本身访问母版页中的控件。当您在母版页上有标题标签并希望从使用母版的每个页面中设置其值时，这种方法很有意义。

我不是 100% 肯定，但我认为这将是嵌套母版页更简单的技术，因为您只需将 VirtualPath 指向包含您希望访问的控件的主控。但是，如果您想访问两个控件，每个母版页中都有一个控件，这可能会很棘手。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-11T19:13:44.970

这是一个更通用的代码，可以使用自定义条件（可以是 lambda 表达式！）

称呼：

```
Control founded = parent.FindControl(c => c.ID == "youdId", true); 
```

控制扩展

```
 public static class ControlExtensions
{
    public static Control FindControl(this Control parent, Func<Control, bool> condition, bool recurse)
    {
        Control founded = null;
        Func<Control, bool> search = null;
        search = c => c != parent && condition(c) ? (founded = c) != null :
                                                    recurse ? c.Controls.FirstOrDefault(search) != null :
                                                    (founded = c.Controls.FirstOrDefault(condition)) != null;
        search(parent);
        return founded;
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-08T05:06:58.717

我已经使用了该`<%@ MasterType VirtualPath="~/MyMaster.master" %>`方法。我在主母版页中有一个属性，然后在详细母版页中有其他同名的属性调用主主属性，它工作正常。

我在主页上有这个

```
 public string MensajeErrorString
    {
        set
        {
            if (value != string.Empty)
            {
                MensajeError.Visible = true;
                MensajeError.InnerHtml = value;
            }
            else
                MensajeError.Visible = false;
        }

    } 
```

这只是一个必须显示错误消息的 div 元素。我想在具有详细母版页的页面中使用相同的属性（这与主母版嵌套）。

然后在细节大师我有这个

```
 public string MensajeErrorString
    {
        set
        {
                Master.MensajeErrorString = value;
        }

    } 
```

我从详细主控中调用主主控属性来创建相同的行为。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-30T11:07:04.187

我刚刚让它完美地工作。

在 contentpage.aspx 中，我写了以下内容：

`If Master.Master.connectsession.IsConnected Then my coded comes in here End If`

# sql - SQL 中是否存在与供应商无关的多行注释分隔符？

> ID：728172
> 
> 赞同：37
> 
> 时间：2009-04-08T01:17:24.420
> 
> 标签：sql, comments

在编辑、构建或从 SQL 语句中挑选时，我发现自己正在与四种流行的数据库工具之一进行交互。我一直在对 DB2 和 Informix 进行单行注释。我在 vim 中创建了宏来提高效率，但我想知道我是否工作太努力了。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-04-08T02:46:37.327

C 样式注释在 SQL 2003 和 SQL 2008 中是标准的（但在 SQL 1999 或更早版本中不是）。以下 DBMS 都支持 C 风格的注释：

*   Informix
*   PostgreSQL
*   MySQL
*   甲骨文
*   DB2
*   赛贝斯
*   安格尔
*   微软 SQL 服务器
*   SQLite（3.7.2 及更高版本）
*   Teradata 和 Aster

这不是每一个可能的 DBMS，但它或多或少是每一个主要的 SQL DBMS。（我愿意添加任何其他支持或不支持 C 样式注释的 DBMS 的注释。）

SQL 2003 标准记录注释符号如下：

```
<comment> ::= <simple comment> | <bracketed comment>

<simple comment> ::=
    <simple comment introducer> [ <comment character> ... ] <newline>

<simple comment introducer> ::=
    <minus sign> <minus sign> [ <minus sign> ... ]

<bracketed comment> ::=
    <bracketed comment introducer> <bracketed comment contents>
    <bracketed comment terminator>

<bracketed comment introducer> ::= <slash> <asterisk>

<bracketed comment terminator> ::= <asterisk> <slash>

<bracketed comment contents> ::= [ { <comment character> | <separator> }... ]

<comment character> ::= <nonquote character> | <quote> 
```

IBM Informix Dynamic Server（IDS 或 Informix）支持 C 风格的注释。它还支持 ' `{ ... }`' 作为潜在的多行注释，除非在上下文中它意味着其他东西 - 其他东西是 LIST 或 SET 或 MULTISET 文字。（您可能会发现 DB-Access 被 C 风格的注释弄糊涂了；这是一个单独的问题。）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-08T02:28:55.683

ISO 标准仅定义以两个破折号开头的单行注释。一些供应商支持 C 风格的注释（即多行以 /* 开头并以 */ 结尾），但不应将其视为“与供应商无关”。

# webkit - 从 webkit 调度事件以在 Adob e AIR 中使用

> ID：728174
> 
> 赞同：0
> 
> 时间：2009-04-08T01:19:07.287
> 
> 标签：webkit, air

我的 AIR 应用程序中有一个 webkit HTML 组件，并且希望能够响应从 webkit 组件中的 HTML 生成的 onclick 和 ondoubleclick 等事件。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T04:36:48.013

有，虽然我花了一点时间才找到它。

这应该是一个很好的起点：[http ://livedocs.adobe.com/flex/3/html/help.html?content=ProgrammingHTMLAndJavaScript_04.html](http://livedocs.adobe.com/flex/3/html/help.html?content=ProgrammingHTMLAndJavaScript_04.html)

这是关键代码：

```
var html:HTMLLoader = new HTMLLoader();
var foo:String = "Hello from container SWF." 
function helloFromJS(message:String):void {
    trace("JavaScript says:", message);
}
var urlReq:URLRequest = new URLRequest("test.html");
html.addEventListener(Event.COMPLETE, loaded);
html.load(urlReq);

function loaded(e:Event):void{
    html.window.foo = foo;
    html.window.helloFromJS = helloFromJS;
} 
```

在上一个示例中加载到 HTMLLoader 对象中的 HTML 内容（在名为 test.html 的文件中）可以访问父 SWF 文件中定义的 foo 属性和 helloFromJS() 方法：

```
<html>
    <script>
        function alertFoo() {
            alert(foo); 
        }
    </script>
    <body>
        <button onClick="alertFoo()">
            What is foo?
        </button>
        <p><button onClick="helloFromJS('Hi.')">
            Call helloFromJS() function.
        </button></p>
    </body>
</html> 
```

# c# - 如何让我的文本解析正则表达式识别 STOP 令牌？

> ID：728177
> 
> 赞同：1
> 
> 时间：2009-04-08T01:20:43.647
> 
> 标签：c#, regex

我为文本解析器编写了一个正则表达式，如下所示：

```
^\s*(?<Count>[0-9]+)\s*[x|X]\s*(?<Currency>[^\d\sN]?)(?<ParVal>\d+)(?<Type>[^Nn]?)\s.*$ 
```

捕获模式，例如：

```
....
1 x 1p
1 x 3p 
.... 
```

它运作良好，但是我不知道如何检测 1 x 1p 模式是否高于/低于正则表达式中的 STOP 行（我只是一个 regx 新手 :-( ）

```
....
1 x 1p    <= here
1 x 3p
STOP
1 x 1p     <= and here
.... 
```

希望你能理解我的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T01:39:03.417

该正则表达式一次应用于一行，因此当您循环遍历这些行时，只需先检查该行是否为“STOP”，如果是，则跳出循环。检查不能作为正则表达式的一部分进行。

# ruby-on-rails - 自动测试无限循环

> ID：728179
> 
> 赞同：2
> 
> 时间：2009-04-08T01:21:37.937
> 
> 标签：ruby-on-rails, testing

我在 Rails 项目中使用自动测试时遇到了一个问题，当测试失败时（即，我修改了测试文件并且自动测试自动运行测试），自动测试不断尝试运行测试（当然每次都失败，因为文件尚未修改），而不是等到文件再次保存。并且在打开咆哮通知时，当我尝试修复代码以使测试通过时，这可能会非常烦人。它不会一直发生，但大多数时候都会发生。有没有其他人遇到过这个并知道解决方案？谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T20:37:19.343

我找到了解决方案。可能与 OSX（在 Leopard 上运行）更改文件夹中的 .DS_Store 文件或另一个临时文件有关。将以下内容添加到我的 .autotest 中就可以了（这也可以防止自动测试查看 Ferret 生成的索引文件夹）。

```
Autotest.add_hook :initialize do |at|
  %w{.git vendor index .DS_Store ._}.each {|exception| at.add_exception(exception)}
end 
```

# c - 字符串与 C 中的 char 指针数组有何不同？

> ID：728180
> 
> 赞同：1
> 
> 时间：2009-04-08T01:23:01.490
> 
> 标签：c, pointers

我的印象是它们是同一回事。然而，在我看来，他们在这里受到了不同的对待。我感到困惑的部分看起来像这样。

```
Foo* initFoo(char* name);

int main
{
  Foo* foo;
  char* player_name[25];
  scanf("%s", player_name);
  foo = initFoo(player_name);
}

Foo* initFoo(char* name)
{
  printf("\n%s", name);
} 
```

字符串打印得很好。但是，我收到一个编译器警告，上面写着：从不兼容的指针类型传递 'initFoo' 的参数 1。我对指针缺少什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T01:24:56.180

字符串是一个字符数组。你这里有一个指向字符的指针数组。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T01:33:52.913

该行：

```
char* player_name[25]; 
```

为 char 分配一个 25 个元素的指针数组。指向 char 的指针通常被认为是一个字符串，因此这个声明可以解释为一个字符串数组，但是用于存储这些字符串的内存还不存在。您必须单独分配这些字符串。

假设您的机器上的指针是 4 字节，那么这一行将产生分配 25 x 4 = 100 字节的效果。

在 C 中，当您使用不带下标的数组名称时，它会“分解”为指向数组第一个元素的指针。

所以......当这行被执行时：

```
scanf("%s", player_name); 
```

player_name 指向 100 字节的内存，足够容纳 100 个读入的字符（以及 99 个字符加上终止的 NUL 字节）。编译器不会保护您免于将这些字符存储在为 25 个指针分配的内存中。

最后：

```
foo = initFoo(player_name); 
```

将数组的起始地址传递给函数 initFoo()。编译器知道这可能是错误的，因为 initFoo() 应该采用指向 chars 的指针，而不是指向 char 指针数组的指针，但它允许您执行此操作，但警告除外。initFoo() 中的 printf() 语句将该指针重新解释为 char 指针，您会得到正确的结果！

正如其他人所说，将一行更改为

```
char player_name[25]; 
```

它声明了一个 25 个字符的数组。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-08T01:26:40.153

```
char* player_name[25];  /* means an array of character pointers. */
char  player_name[25];  /* will get rid of the warning */ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T01:26:50.013

要修复它，请更改为：

```
char player_name[25]; 
```

# c++ - 如何删除、重新安装和/或查找有关 Visual Studio 2008 修补程序的信息？

> ID：728192
> 
> 赞同：0
> 
> 时间：2009-04-08T01:31:09.957
> 
> 标签：c++, visual-studio, visual-studio-2008, visual-c++

另一位开发人员和我在不同机器上使用 Microsoft Visual Studio 2008 版本 9.0.30729.1 SP 构建的本机 C++ 可执行文件遇到了不同的行为。

我们静态链接到标准库，所以我们认为这不是 DLL 版本问题。我们已经排除了源代码和构建设置的差异。

我们推测，也许我们在不同的机器上安装了不同的“修补程序”，这些修补程序要么影响代码生成，要么可能在它们的 C++ 标准库实现中存在差异。

我们每个人都使用了 [帮助 | 关于微软 Visual Studio | Copy Info] 以获取版本信息，然后对它们进行比较。果然，我们发现了一些差异。我有一些我的同事没有的修补程序。他有一对我的安装中缺少的。

这是来自版本信息的示例修补程序条目：

*Microsoft Visual Studio 2008 Professional Edition - ENU 的修补程序 (KB953256) KB953256 此修补程序适用于 Microsoft Visual Studio 2008 Professional Edition - ENU。如果您以后安装更新的服务包，此修补程序将被自动卸载。有关详细信息，请访问[http://support.microsoft.com/kb/953256](http://support.microsoft.com/kb/953256)。*

您会注意到，提供的链接已失效。事实上，在我们发现的四个差异中，除了一个之外，所有差异都有死链接：

*   [http://support.microsoft.com/kb/948484](http://support.microsoft.com/kb/948484)（死链接）
*   [http://support.microsoft.com/kb/952241](http://support.microsoft.com/kb/952241)
*   [http://support.microsoft.com/kb/953256](http://support.microsoft.com/kb/953256)（死链接）
*   [http://support.microsoft.com/kb/958357](http://support.microsoft.com/kb/958357)（死链接）

有没有人知道如何真正找到有关这些神秘修补程序的更多信息？对这些特定的有什么建议吗？在每次完全重新安装 Visual Studio 的情况下，是否有人对我们如何使我们的单独安装同步（可能通过删除和/或重新安装修补程序）有提示？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T02:52:13.257

在本机 C++ 应用程序中导致不同行为的主要原因可能是：KB958357

这似乎是现在 KB962219 的早期版本。详细信息可在 Visual C++ 团队博客上的此帖子中找到：http: [//blogs.msdn.com/vcblog/archive/2008/12/17/vc9-sp1-hotfix-for-the-vector-function-ft-crash .aspx](http://blogs.msdn.com/vcblog/archive/2008/12/17/vc9-sp1-hotfix-for-the-vector-function-ft-crash.aspx)

> 此修补程序实际上修复了 5 个错误：
> 
> 1.  VC9 TR1（功能包）中的小函子优化破坏了 function::swap()。这破坏了 VC9 SP1 中的矢量>。“破碎”的意思是“编译但崩溃”。
>     
>     
> 2.  vector> 不符合要求 X 具有默认构造函数。（这是一般错误的具体示例：vector>、vector>> 等也受到影响。）
>     
>     
> 3.  vector> 不符合要求 X 和 Y 具有默认构造函数。（这是一般错误的具体示例，见上文。）
>     
>     
> 4.  vector> 不符合要求 X 具有默认构造函数。
>     
>     
> 5.  随机分布被破坏，触发无限循环并发出虚假结果。

这些看起来足以导致不同行为的更改，但这完全取决于您的代码。查看在每台计算机上安装该修补程序的最新版本是否可以解决您看到的差异。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T02:52:30.947

我不确定这有多大帮助，但这里是各种热修复的信息

*   948484 - 适用于 x64 的 Visual C++ 2008 SP1 设计时组件
*   953256 - Visual Studio 团队资源管理器 SP1
*   958357 - 安装 Visual Studio 2008 SP1 后似乎是 TR1 的热补丁

根据服务包详细信息，看起来以下之一可能是机器之间的差异

*   TR1 修补程序：http: [//blogs.msdn.com/vcblog/archive/2008/12/17/vc9-sp1-hotfix-for-the-vector-function-ft-crash.aspx](http://blogs.msdn.com/vcblog/archive/2008/12/17/vc9-sp1-hotfix-for-the-vector-function-ft-crash.aspx)
*   一台机器有 Team Explorer 而另一台没有
*   为了完整起见，显而易见的要抛弃：一个 x86 另一个 x64。

# python - Python/urllib 突然停止正常工作

> ID：728193
> 
> 赞同：1
> 
> 时间：2009-04-08T01:31:58.097
> 
> 标签：python, urllib

我正在编写一个小工具来监控学校的开课情况。

我编写了一个 python 脚本，每隔几分钟就会从每个部门获取当前可用的课程。

该脚本运行正常，直到 uni 的网站开始返回：

```
SIS Server is not available at this time 
```

Uni一定是屏蔽了我的服务器吧？好吧，并不是因为这是我直接从其他 PC 转到 URL 时得到的输出。但是，如果我通过 uni 网站上进行 POST 的中介表格，我不会收到该消息。

我请求的 URL 是[https://s4.its.unc.edu/SISMisc/SISTalkerServlet](https://s4.its.unc.edu/SISMisc/SISTalkerServlet)

这就是我的 python 代码的样子：

```
data = urllib.urlencode({"progname" : "SIR033WA", "SUBJ" : "busi", "CRS" : "", "TERM" : "20099"})
f = urllib.urlopen("https://s4.its.unc.edu/SISMisc/SISTalkerServlet", data)
s =  f.read()
print (s) 
```

我真的很难过！似乎 python 没有发送正确的请求。起初我认为它没有发送正确的帖子数据，但我将 URL 更改为我的 localbox，并且 apache 收到的帖子数据似乎很好。

如果您想查看系统的实际运行情况，请转到[https://s4.its.unc.edu/SISMisc/browser/student_pass_z.jsp](https://s4.its.unc.edu/SISMisc/browser/student_pass_z.jsp)并单击“以访客身份进入”按钮，然后查找“课程可用性” . （现在你知道我为什么要建造这个了！）

最奇怪的是这一直工作到上午 11 点！我以前也遇到过同样的错误，但只持续了几分钟。这告诉我，与 uni 对我的服务器的任何阻塞相比，这在某处更成问题。

**更新** 根据建议，我尝试使用更合法的推荐人/用户代理。结果相同。这是我尝试过的：

```
import httplib
import urllib
headers =  {'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US;rv:1.9.0.4) Gecko/2008102920 Firefox/3.0.4',"Content-type": "application/x-www-form-urlencoded","Accept": "text/plain","Referrer": "https://s4.its.unc.edu/SISMisc/SISTalkerServlet"}
data = urllib.urlencode({"progname" : "SIR033WA", "SUBJ" : "busi", "CRS" : "", "TERM" : "20099"})
c = httplib.HTTPSConnection("s4.its.unc.edu",443)
c.request("POST", "/SISMisc/SISTalkerServlet",data,headers)
r = c.getresponse()
print r.read() 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T04:20:00.410

这篇文章不会尝试修复您的代码，而是建议使用调试工具。

曾几何时，我正在编写一个程序来为我填写在线表格。为了准确了解我的浏览器是如何处理 POST、cookie 等等的，我安装了 WireShark ( [http://www.wireshark.org/](http://www.wireshark.org/) )，一个网络嗅探器。这个应用程序允许我逐块查看在 IP 和硬件级别上发送和接收的数据。

您可以考虑尝试类似的程序并比较网络流量。这可能会突出您的浏览器正在执行的操作与您的脚本正在执行的操作之间的差异。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T01:42:34.623

在看到来自奇怪的非浏览器用户代理字符串的多个请求后，它们可能会阻止未从站点引用的用户。例如，PHP 有一个称为`$_SERVER['HTTP_REFERRER']`IIRC 的功能，它会检查将用户推荐到当前页面的页面。由于您的程序未在 User-Agent 字符串中包含一个（您正试图直接访问它），因此它们很可能会阻止您基于此访问。尝试在您的 http 请求的标头中添加引荐来源网址，看看效果如何。（最好是链接到您要访问的页面的页面）

[http://whatsmyuseragent.com/](http://whatsmyuseragent.com/)可以帮助您构建您的欺骗用户代理。

然后你像这样构建标题......

```
headers = {"Content-type": "application/x-www-form-urlencoded",
"Accept": "text/plain"} 
```

然后将它们作为附加参数与您的 HTTPConnection 请求一起发送...

```
conn.request("POST", "/page/on/site", params, headers) 
```

请参阅[httplib](http://docs.python.org/library/httplib.html)上的 python 文档以获取更多参考和示例。

# javascript - window.showModalDialog 与 window.open

> ID：728196
> 
> 赞同：12
> 
> 时间：2009-04-08T01:33:27.393
> 
> 标签：javascript

什么情况下要使用 window.showModalDialog 函数？它接缝你可以用 window.open 函数和一些删除一些 chrome 的参数（导航、地址栏等）做同样的事情。

您想在什么时候使用 window.showModalDialog 和 window.open？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2012-07-06T00:53:45.280

自从最初提出这个问题以来已经有几年了，从那时起事情发生了一些变化。 `window.showModalDialog`现在已正式[标准化为 HTML5 的一部分，](http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dialogs-implemented-using-separate-documents)并在 IE、Firefox 3+、Chrome（[尽管有](http://code.google.com/p/chromium/issues/detail?id=16045)问题）和 Safari 5.1+ 中受支持。

不幸`window.showModalDialog`的是，仍然受到许多问题的困扰。

*   在 Firefox、Chrome 和 Safari 中，模态对话框默认被阻止为弹出窗口。
*   Chrome 中的模态对话框有问题，并不是真正的模态对话框 - 请参阅[http://code.google.com/p/chromium/issues/detail?id=16045](http://code.google.com/p/chromium/issues/detail?id=16045)和[http://code.google.com/p/chromium /issues/detail?id=42939](http://code.google.com/p/chromium/issues/detail?id=42939)。
*   当模式对话框启动时，除 Chrome 之外的所有浏览器都会阻止用户与整个窗口（收藏夹、浏览器控件、其他选项卡等）进行交互。
*   它们很难调试，因为它们在等待模式对话框完成时会在父窗口中停止 JavaScript 执行。
*   没有移动浏览器支持`window.showModalDialog`。

因此，使用`window.showModalDialog`. 如果您需要打开的窗口是模态的（即用户在处理对话框之前不能与页面的其余部分交互），我建议使用[jQuery UI 的对话框插件](http://jqueryui.com/demos/dialog/)。

`window.open`将适用于非模态窗口，但我会坚持使用 jQuery UI 的对话框，因为打开新窗口往往会惹恼用户。

如果您有兴趣，我会在我的博客上更详细地介绍这一点 - [http://tjvantoll.com/2012/05/02/showmodaldialog-what-it-is-and-why-you-should-never-use-它/](http://tjvantoll.com/2012/05/02/showmodaldialog-what-it-is-and-why-you-should-never-use-it/) .

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-08T01:41:17.123

模态对话框是一旦被父级打开的对话框，在对话框关闭之前不允许您将注意力集中在父级上。

可以将模式对话框用于登录表单、编辑表单等，您希望在其中弹出用于用户交互但不允许用户返回到打开弹出窗口的窗口。

附带说明一下，我相信只有 Internet Explorer 实现`window.showModalDialog`了 ，所以这会限制您对它的使用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-04-11T13:29:10.847

`showModalDialog()`目前正在作为**HTML5**的一部分进行标准化。第三个参数（用于附加选项）在 HTML5 版本中不存在，并且（安全地）被 Safari 和 Chrome 忽略。

[http://dev.w3.org/html5/spec//user-prompts.html#dialogs-implemented-using-separate-documents](http://dev.w3.org/html5/spec//user-prompts.html#dialogs-implemented-using-separate-documents)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-07-06T18:41:39.320

请注意，Chrome 2 中有一个错误会阻止 showModalDialog() 正确加载。弹出窗口出现，但内容永远不会加载。

避免使用 showModalDialog() 的另一个原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-11T13:20:50.880

`showModalDialog()`适用于 Internet Explorer、Firefox（3 及以上） 适用于 Chrome 但弹出窗口不是模型（您可以转到父窗口）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-03T14:17:02.820

请注意，虽然您可以从任何弹出窗口中显示模式，但您不能在某些浏览器（IE、Safari）中的模型对话框中使用 window.open。

# visual-studio-2005 - VS2005类库包含c代码？

> ID：728197
> 
> 赞同：0
> 
> 时间：2009-04-08T01:33:42.993
> 
> 标签：visual-studio-2005

可以构建包含 c 代码的类库吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-04-08T14:31:27.943

如果您的意思是是否可以用 C 编写面向对象的代码，那么是的。Google 在 C 中搜索面向对象编程时的第一个结果：

[C中的面向对象编程](http://www.accu.informika.ru/acornsig/public/articles/oop_c.html)

[使用 ANSI C 进行面向对象编程 (PDF)](http://www.cs.rit.edu/~ats/books/ooc.pdf)

[ANSI C 和面向对象编程](http://barracudaserver.com/WP/DeviceControl/OOIntro.html)

我相信您可以找到关于该主题的数百篇不同论文的其余部分。

一个很好的例子是[GLib 库](http://library.gnome.org/devel/glib/)。

# c# - 使用 Silverlight 应用程序支持插件的最佳方式是什么？

> ID：728201
> 
> 赞同：1
> 
> 时间：2009-04-08T01:37:14.903
> 
> 标签：c#, .net, silverlight

我有一个 silverlight 应用程序，我想支持它的插件开发。我在想插件开发人员会创建一个 dll，而我的主 silverlight 应用程序将有某种配置文件，您将列出 dll 和插件的类型，主应用程序将检测、下载和加载 dll插件。

这听起来可能与silverlight有关吗？

最好的方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T12:30:56.250

查看复合应用程序库： [http ://compositewpf.codeplex.com/](http://compositewpf.codeplex.com/)

此框架可帮助您创建模块化 Silverlight 应用程序。当您熟悉该框架时，使用此框架可以轻松添加新模块。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T02:26:24.317

听起来对我来说是可行的。我可能会为我的插件创建一组接口，并在某种开发包中为插件开发人员提供这些接口。至于在 Silverlight 中在运行时动态加载程序集，请查看此链接：

[Silverlight - 动态加载程序集](http://www.silverlightshow.net/items/Silverlight-Dynamically-Loading-an-Assembly.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T02:29:02.033

也要考虑存储。我也在考虑同样的好奇心。也许 IsoStore 是您可以保存它们的地方。用户拥有您的应用程序的插件（符合接口），您可以让他们找到它（OpenFileDialog）并将其加载到您的应用程序中（保存在 IsoStore 中）。当然，这不是一个持久的解决方案，而是一个有趣的解决方案。

# c# - WPF ListView：附加双击（在项目上）事件

> ID：728205
> 
> 赞同：85
> 
> 时间：2009-04-08T01:40:55.050
> 
> 标签：c#, wpf, xaml

我有以下内容`ListView`：

```
<ListView Name="TrackListView">
    <ListView.View>
        <GridView>
            <GridViewColumn Header="Title" Width="100" 
                            HeaderTemplate="{StaticResource BlueHeader}" 
                            DisplayMemberBinding="{Binding Name}"/>

            <GridViewColumn Header="Artist" Width="100"  
                            HeaderTemplate="{StaticResource BlueHeader}"  
                            DisplayMemberBinding="{Binding Album.Artist.Name}" />
        </GridView>
    </ListView.View>
</ListView> 
```

如何将事件附加到将在双击项目时触发的每个绑定项目？

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-04-08T02:04:31.013

从这里找到解决方案：http: [//social.msdn.microsoft.com/Forums/en-US/wpf/thread/3d0eaa54-09a9-4c51-8677-8e90577e7bac/](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/3d0eaa54-09a9-4c51-8677-8e90577e7bac/)

* * *

XAML：

```
<UserControl.Resources>
    <Style x:Key="itemstyle" TargetType="{x:Type ListViewItem}">
        <EventSetter Event="MouseDoubleClick" Handler="HandleDoubleClick" />
    </Style>
</UserControl.Resources>

<ListView Name="TrackListView" ItemContainerStyle="{StaticResource itemstyle}">
    <ListView.View>
        <GridView>
            <GridViewColumn Header="Title" Width="100" HeaderTemplate="{StaticResource BlueHeader}" DisplayMemberBinding="{Binding Name}"/>
            <GridViewColumn Header="Artist" Width="100" HeaderTemplate="{StaticResource BlueHeader}" DisplayMemberBinding="{Binding Album.Artist.Name}" />
        </GridView>
    </ListView.View>
</ListView> 
```

C＃：

```
protected void HandleDoubleClick(object sender, MouseButtonEventArgs e)
{
    var track = ((ListViewItem) sender).Content as Track; //Casting back to the binded Track
} 
```

* * *

## 回答 #2

> 赞同：80
> 
> 时间：2011-02-03T16:09:13.427

没有内存泄漏*（无需取消订阅每个项目）*，工作正常：

XAML：

```
<ListView MouseDoubleClick="ListView_MouseDoubleClick" ItemsSource="{Binding TrackCollection}" /> 
```

C＃：

```
 void ListView_MouseDoubleClick(object sender, MouseButtonEventArgs e)
    {
        var item = ((FrameworkElement) e.OriginalSource).DataContext as Track;
        if (item != null)
        {
            MessageBox.Show("Item's Double Click handled!");
        }
    } 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2015-02-17T21:04:59.787

我的解决方案是基于[@epox_sub 的回答](https://stackoverflow.com/a/4888542/492)，您应该查看将事件处理程序放在 XAML 中的位置。代码隐藏对我不起作用，因为我`ListViewItems`是复杂的对象。[@sipwiz 的回答](https://stackoverflow.com/a/728243/492)是一个很好的暗示去哪里看......

```
void ListView_MouseDoubleClick(object sender, MouseButtonEventArgs e)
{
    var item = ListView.SelectedItem as Track;
    if (item != null)
    {
      MessageBox.Show(item + " Double Click handled!");
    }
} 
```

这样做的好处是您获得了`SelectedItem`DataContext 绑定（`Track`在这种情况下）。所选项目有效，因为第一次单击双击将其选中。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2020-02-16T13:33:32.800

我使用的替代方法是事件到命令，

```
<ListView ItemsSource="{Binding SelectedTrack}" SelectedItem="{Binding SelectedTrack}" >
    <i:Interaction.Triggers>
         <i:EventTrigger EventName="MouseDoubleClick">
              <i:InvokeCommandAction Command="{Binding SelectTrackCommand}"/>
         </i:EventTrigger>
    </i:Interaction.Triggers>
    ...........
    ...........
</ListView> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-12-13T14:53:52.600

对于那些对主要维护 MVVM 模式感兴趣的人，我使用了[Andreas Grech 的答案](https://stackoverflow.com/a/728248/4254572)来解决问题。

> **基本流程：**
> 
> 用户双击项目 -> 代码中的事件处理程序 -> 视图模型中的 ICommand

项目视图.xaml：

```
<UserControl.Resources>
    <Style TargetType="ListViewItem" x:Key="listViewDoubleClick">
        <EventSetter Event="MouseDoubleClick" Handler="ListViewItem_MouseDoubleClick"/>
    </Style>
</UserControl.Resources>

...

<ListView ItemsSource="{Binding Projects}" 
          ItemContainerStyle="{StaticResource listViewDoubleClick}"/> 
```

ProjectView.xaml.cs：

```
public partial class ProjectView : UserControl
{
    public ProjectView()
    {
        InitializeComponent();
    }

    private void ListViewItem_MouseDoubleClick(object sender, MouseButtonEventArgs e)
    {
        ((ProjectViewModel)DataContext)
            .ProjectClick.Execute(((ListViewItem)sender).Content);
    }
} 
```

项目视图模型.cs：

```
public class ProjectViewModel
{
    public ObservableCollection<Project> Projects { get; set; } = 
               new ObservableCollection<Project>();

    public ProjectViewModel()
    {
        //Add items to Projects
    }

    public ICommand ProjectClick
    {
        get { return new DelegateCommand(new Action<object>(OpenProjectInfo)); }
    }

    private void OpenProjectInfo(object _project)
    {
        ProjectDetailView project = new ProjectDetailView((Project)_project);
        project.ShowDialog();
    }
} 
```

可以在[这里](http://wpftutorial.net/DelegateCommand.html)找到 DelegateCommand.cs 。

在我的例子中，我有一个`Project`填充`ListView`. 这些对象包含的属性比列表中显示的要多，我打开一个`ProjectDetailView`（一个 WPF `Window`）来显示它们。

事件处理程序的`sender`对象是 selected `ListViewItem`。随后，`Project`我想要访问的 包含在`Content`属性中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-08T02:03:14.310

在您的示例中，您是否试图捕捉何时选择 ListView 中的项目或单击列标题？如果是前者，您将添加一个 SelectionChanged 处理程序。

```
<ListView Name="TrackListView" SelectionChanged="MySelectionChanged"> 
```

如果是后者，您必须在 GridViewColumn 项目上使用 MouseLeftButtonUp 或 MouseLeftButtonDown 事件的某种组合来检测双击并采取适当的操作。或者，您可以处理 GridView 上的事件并从那里计算出鼠标下方的列标题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-12-22T22:13:08.677

基于[epox_spb 的答案](https://stackoverflow.com/a/4888542/747369)，我添加了一个检查以避免在双击 GridViewColumn 标题时出现错误。

```
void ListView_MouseDoubleClick(object sender, MouseButtonEventArgs e)
{
    var dataContext = ((FrameworkElement)e.OriginalSource).DataContext;
    if (dataContext is Track)
    {
        MessageBox.Show("Item's Double Click handled!");
    }
} 
```

# ruby-on-rails - 为什么我的 Rails 功能测试中的 post 失败？

> ID：728209
> 
> 赞同：5
> 
> 时间：2009-04-08T01:41:45.767
> 
> 标签：ruby-on-rails, testing

当我在 Rails 功能测试中运行帖子时

```
setup do
  post :create, :user => Factory.attributes_for(:user)
end 
```

它失败了，我没有得到任何关于为什么的反馈。我知道它失败了，因为我确保数据库中有一条额外记录的断言失败了。

我试着做

```
setup do
  post :create, :user => Factory.attributes_for(:user)
  assert_valid @controller.object
end 
```

但 object 是一种受保护的方法。

如何检查 post 调用导致的模型对象上的错误？

我正在使用 Shoulda 和 Factory Girl，但我怀疑这并不重要。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T15:35:10.893

添加以下断言：

```
assert_nil assigns(:user).errors 
```

如果保存您的对象时出现错误（可能是验证），这将失败，并向您显示错误对象的值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-10-06T12:03:40.137

我正在使用 rails 3.2.13，似乎 assert_nil 无法正常工作，如上一个答案中所述。

这对我有用：

```
assert_empty assigns(:user).errors 
```

我相信这是因为即使是成功的“保存”调用也会返回一个 ActiveRecord:Errors 对象，其中包含“消息”的空散列，因此您也可以这样做：

```
assert_empty assigns(:user).errors.messages 
```

# php - 在 SOAP 请求 PHP 中设置参数的属性

> ID：728220
> 
> 赞同：0
> 
> 时间：2009-04-08T01:49:50.723
> 
> 标签：php, soap

我正在尝试使用只允许 SOAP 请求的网络服务

据我所知，我必须创建一个看起来像这样的请求

```
<?xml version="1.0" encoding="utf-8"?>
<SessionCreateRQ xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <POS>
    <Source PseudoCityCode="SECRET_CODE" />
  </POS>
</SessionCreateRQ> 
```

但是，在将参数添加到 SessionCreateRQ 方法时，我不知道如何添加名为 Source 的 POS 参数，也不知道如何设置该参数的属性

我在php中尝试以下

```
 $body = array(
        'POS' => array('source' => 'PseudoCityCode:SECRET_CODE'));

    try
    {
        $result = $c->SessionCreateRQ($body);
    } 
```

但没有运气，有没有人知道我应该如何正确构建这个调用？

谢谢 ！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T23:08:54.897

首先，您需要此服务的 WSDL 定义（在线或在本地文件中）。任何不错的 SOAP 服务都向用户提供 WSDL。

其次，您需要将 WSDL 服务定义转换为 PHP 代码。试试[wsdl2php](http://sourceforge.net/projects/wsdl2php) 生成器。它生成带有类的文件，用于调用 Web 服务。

您的示例将大致如下：

```
require_once 'GeneratedTypes.php';
$client = new SOAPService();
$res = $client->SessionCreateRQ(SECRET_CODE); 
```

ps wsdl2php 不理想，但它正在工作:)

# sql - 禁用表上的外键约束？

> ID：728221
> 
> 赞同：6
> 
> 时间：2009-04-08T01:50:38.897
> 
> 标签：sql, sql-server, sql-server-2005

我可以暂时禁用外键约束吗？我该怎么做呢？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-08T01:59:15.693

暂时禁用约束（外键是约束）：

```
ALTER TABLE MyTable NOCHECK CONSTRAINT MyConstraint 
```

重新启用约束

```
ALTER TABLE MyTable CHECK CONSTRAINT MyConstraint 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T12:53:11.610

顺便说一句，这就是为什么在[BCP](http://msdn.microsoft.com/en-us/library/ms162802.aspx)或将数据[批量插入](http://msdn.microsoft.com/en-us/library/ms188365.aspx)表时需要“更改表”权限的原因。使用默认配置，不检查检查约束和外键。

# embeddedwebserver - 嵌入式应用服务器

> ID：728224
> 
> 赞同：1
> 
> 时间：2009-04-08T01:53:33.973
> 
> 标签：embeddedwebserver

我打算做一个 C++ 独立桌面应用程序，它使用 web / html 作为其文档内容的主要格式。

我需要一个好的应用服务器的建议，它可以生成动态内容并且可以很容易地嵌入到我的桌面应用程序中。它支持什么服务器端编程语言并不重要。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T02:05:09.313

在 C/C++ 应用程序中嵌入语言没有什么比[Lua更好的了。](http://lua.org)这样做，您可以简单地添加[Xavante](http://www.keplerproject.org/xavante/)，它与完整的[Kepler](http://www.keplerproject.org/)环境一起支持非常灵活和现代的 Web 应用程序。

（免责声明：我是 Xavante 的作者之一；但我写这篇文章更多是因为我爱 Lua，而不是因为对 Xavante 的任何自豪）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T01:33:21.987

我假设您的应用程序将通过网络浏览器界面使用，这就是您生成 HTML 内容的原因。考虑到这一点，您仍然可以通过 Web 服务器将 C/C++ 用于前端和后端逻辑。

有几个支持 CGI 服务的小型快速 Web 服务器。然后，您可以使用 C/C++ 作为 CGI 服务编写后端服务器。您还可以使用 C/C++ 和嵌入式浏览器（如 Gecko 或 Webkit）编写您的客户端。

# php - MySQLi 中的参数

> ID：728229
> 
> 赞同：9
> 
> 时间：2009-04-08T01:55:04.563
> 
> 标签：php, parameters, mysqli

我正在将 PHP 与 MySQLi 一起使用，并且我遇到了类似的查询

```
SELECT $fields FROM $table WHERE $this=$that AND $this2=$that2 
```

到目前为止，我已经编写了一些代码来拼接我给它的数组，例如：

```
$search = array(name=michael, age=20) //turns into
SELECT $fields FROM $table WHERE name=michael AND age=20 
```

有没有更有效的方法来做到这一点？

我相当担心 MySQL 注入 - 这似乎很容易受到攻击。谢谢！

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-08T02:02:25.340

奇怪的是，您问题的标题基本上就是它的答案。你想做这样的事情，使用 mysqli 参数化查询：

```
$db = new mysqli(<database connection info here>);
$name = "michael";
$age = 20;

$stmt = $db->prepare("SELECT $fields FROm $table WHERE name = ? AND age = ?");
$stmt->bind_param("si", $name, $age);
$stmt->execute();
$stmt->close(); 
```

更多信息在[手册的 mysqli 部分](http://php.net/manual/en/book.mysqli.php)，特别是与[MySQLi_STMT](http://php.net/manual/en/class.mysqli-stmt.php)相关的函数。

请注意，我个人更喜欢使用[PDO](http://php.net/manual/en/book.pdo.php)而不是 mysqli，我不喜欢 mysqli 所做的所有`bind_param`/`bind_result` 东西。如果我必须使用它，我会围绕它编写一个包装器，使其更像 PDO。

# c++ - 为什么引用在 C++ 中不可重新安装

> ID：728233
> 
> 赞同：83
> 
> 时间：2009-04-08T01:58:56.037
> 
> 标签：c++, pointers, reference, language-design

C++ 引用有两个属性：

*   它们总是指向同一个对象。
*   它们不能为 0。

指针则相反：

*   它们可以指向不同的对象。
*   它们可以为 0。

为什么 C++ 中没有“不可为空、可重新定位的引用或指针”？我想不出一个很好的理由为什么引用不应该是可重新安装的。

**编辑：** 这个问题经常出现，因为当我想确保“关联”（我在这里避免使用“引用”或“指针”这些词）永远不会无效时，我通常会使用引用。

我想我从来没有想过“很棒，这个 ref 总是指同一个对象”。如果引用是可重新安装的，仍然可以得到如下的当前行为：

```
int i = 3;
int& const j = i;
```

这已经是合法的 C++，但毫无意义。

**我这样重申我的问题： “'引用***是*对象'设计背后的基本原理是什么？为什么认为引用*始终*是同一个对象而不是仅在声明为 const 时才被认为是有用的？”

干杯，菲利克斯

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-04-08T02:16:42.547

C++ 不允许您重新绑定引用的原因在 Stroustrup 的“C++ 的设计和演变”中给出：

> 初始化后无法更改引用所指的内容。也就是说，一旦 C++ 引用被初始化，它就不能在以后引用不同的对象；它不能重新绑定。我过去曾被 Algol68 引用所困扰，其中`r1=r2`可以分配`r1`给所引用的对象或分配一个新的引用值`r1`（重新绑定`r1`），具体取决于`r2`. 我想避免在 C++ 中出现此类问题。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-04-08T02:05:04.210

在 C++ 中，常说“引用*即*对象”。从某种意义上说，确实如此：虽然在编译源代码时引用被作为指针处理，但引用的目的是表示在调用函数时不会复制的对象。由于引用不能直接寻址（例如，引用没有地址，& 返回对象的地址），重新分配它们在语义上没有意义。此外，C++ 已经有指针，它处理重新设置的语义。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-04-08T02:34:14.157

因为那样你就没有不能为 0 的可重新安装类型。除非你包含了 3 种类型的引用/指针。这只会使语言复杂化而收益很小（那么为什么不添加第 4 种类型呢？不可重新设置的引用可以是 0？）

一个更好的问题可能是，您为什么希望引用可重新安装？如果是这样，那将在很多情况下使它们变得不那么有用。这会使编译器更难进行别名分析。

似乎 Java 或 C# 中的引用可重新安装的主要原因是因为它们完成了指针的工作。它们指向对象。它们不是对象的别名。

下面的效果应该是什么？

```
int i = 42;
int& j = i;
j = 43; 
```

在今天的 C++ 中，使用不可重新安装的引用，这很简单。j 是 i 的别名，i 以 43 结束。

如果引用是可重新安装的，那么第三行会将引用 j 绑定到不同的值。它不再是 i 的别名，而是整数文字 43（这当然是无效的）。或者也许是一个更简单（或至少在语法上有效）的示例：

```
int i = 42;
int k = 43;
int& j = i;
j = k; 
```

带有可重新安装的参考。j 将在评估此代码后指向 k。对于 C++ 的不可重新定位的引用，j 仍然指向 i，并且 i 被赋值为 43。

使引用可重新定位会改变语言的语义。引用不能再是另一个变量的别名。相反，它成为一种单独的值类型，具有自己的赋值运算符。然后引用的最常见用法之一将是不可能的。并且什么都不会作为交换得到。新获得的引用功能已经以指针的形式存在。所以现在我们有两种方法来做同样的事情，而没有办法做当前 C++ 语言中的引用所做的事情。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-08T02:35:25.823

引用不是指针，它可能在后台实现为指针，但其核心概念并不等同于指针。引用应该像它所引用`*is*`的对象一样看待。因此，您无法更改它，并且它不能为 NULL。

指针只是一个保存内存地址的变量。 **指针本身有一个自己的内存地址，并且在该内存地址内它保存着另一个**它所指向的内存地址。 **引用不一样，它没有自己的地址，因此不能更改为“持有”另一个地址。**

我认为[参考资料上的 parashift C++ FAQ](http://www.parashift.com/c%2B%2B-faq-lite/references.html#faq-8.1)说得最好：

> 重要提示：即使引用通常使用底层汇编语言中的地址来实现，但请不要将引用视为指向对象的有趣指针。引用是对象。它不是指向对象的指针，也不是对象的副本。它是对象。

并再次在[FAQ 8.5](http://www.parashift.com/c%2B%2B-faq-lite/references.html#faq-8.5)中：

> 与指针不同，一旦引用绑定到一个对象，它就不能“重新定位”到另一个对象。引用本身不是一个对象（它没有身份；获取引用的地址可以得到引用的地址；记住：引用是它的引用）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-08T02:50:54.303

**可重新定位的引用在功能上与指针相同。**

关于可空性：您不能保证这样的“可重新安装引用”在编译时是非 NULL 的，因此任何此类测试都必须在运行时进行。您可以通过编写一个智能指针样式的类模板来实现这一点，该模板在初始化或分配为 NULL 时会引发异常：

```
struct null_pointer_exception { ... };

template<typename T>
struct non_null_pointer {
    // No default ctor as it could only sensibly produce a NULL pointer
    non_null_pointer(T* p) : _p(p) { die_if_null(); }
    non_null_pointer(non_null_pointer const& nnp) : _p(nnp._p) {}
    non_null_pointer& operator=(T* p) { _p = p; die_if_null(); }
    non_null_pointer& operator=(non_null_pointer const& nnp) { _p = nnp._p; }

    T& operator*() { return *_p; }
    T const& operator*() const { return *_p; }
    T* operator->() { return _p; }

    // Allow implicit conversion to T* for convenience
    operator T*() const { return _p; }

    // You also need to implement operators for +, -, +=, -=, ++, --

private:
    T* _p;
    void die_if_null() const {
        if (!_p) { throw null_pointer_exception(); }
    }
}; 
```

这在某些情况下可能很有用——带参数的函数肯定会比带`non_null_pointer<int>`参数的函数向调用者传达更多的信息`int*`。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-02-10T15:20:03.757

有趣的是，这里的许多答案都有些模糊甚至题外话（例如，这不是因为引用不能为零或相似，事实上，您可以轻松构建一个引用为零的示例）。

无法重新设置参考的真正原因非常简单。

*   指针使您能够做两件事：更改指针后面的值（通过`->`or`*`运算符），以及更改指针本身（直接赋值`=`）。例子：

    ```
    int a;
    int * p = &a;
    ```

    1.  更改值需要取消引用：`*p = 42;`
    2.  更改指针：`p = 0;`
*   引用只允许您更改值。为什么？由于没有其他语法来表达重新设置。例子：

    ```
    int a = 10;
    int b = 20;
    int & r = a;
    r = b; // re-set r to b, or set a to 20?
    ```

换句话说，如果允许您重新设置参考，那将是模棱两可的。通过引用传递时更有意义：

```
void foo(int & r)
{
    int b = 20;
    r = b; // re-set r to a? or set a to 20?
}
void main()
{
    int a = 10;
    foo(a);
} 
```

希望有帮助:-)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-08T02:16:17.867

将 C++ 引用命名为“别名”可能会更容易混淆？正如其他人所提到的，C++ 中的引用应该是它们***所**引用的变量*，而不是对变量的指针/*引用*。因此，我想不出一个很好的理由它们*应该*是可重置的。

在处理指针时，允许 null 作为值通常是有意义的（否则，您可能需要一个引用）。如果您特别想禁止持有 null，您可以随时编写自己的智能指针类型；）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-08T02:04:28.067

*某些编译器**有时会强制*C++ 引用为0 （这样做是个坏主意*，而且违反了标准*）。

 *```
int &x = *((int*)0); // Illegal but some compilers accept it 
```

**编辑：**根据比我更了解标准的各种人的说法，上面的代码会产生“未定义的行为”。至少在 GCC 和 Visual Studio 的某些版本中，我已经看到这做了预期的事情：相当于将指针设置为 NULL（并在访问时导致 NULL 指针异常）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-08T02:55:39.893

你不能这样做：

```
int theInt = 0;
int& refToTheInt = theInt;

int otherInt = 42;
refToTheInt = otherInt; 
```

...出于同样的原因，为什么 secondInt 和 firstInt 在这里没有相同的值：

```
int firstInt = 1;
int secondInt = 2;
secondInt = firstInt;
firstInt = 3;

assert( firstInt != secondInt ); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-05-30T00:30:50.487

这实际上不是答案，而是针对此限制的解决方法。

基本上，当您尝试“重新绑定”引用时，您实际上是在尝试使用相同的名称来引用以下上下文中的新值。在 C++ 中，这可以通过引入块作用域来实现。

在 jalf 的例子中

```
int i = 42;
int k = 43;
int& j = i;
//change i, or change j?
j = k; 
```

如果要更改 i，请按上述方式编写。但是，如果你想改变`j`to mean的含义`k`，你可以这样做：

```
int i = 42;
int k = 43;
int& j = i;
//change i, or change j?
//change j!
{
    int& j = k;
    //do what ever with j's new meaning
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-08T02:05:59.967

我想这与优化有关。

当您可以明确地知道变量的内存位时，静态优化会容易*得多。*指针会打破这种情况，并且可重新设置的引用也会。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-08T02:21:48.320

因为有时事情不应该重新指向。（例如，对 Singleton 的引用。）

因为在函数中知道你的参数不能为空是很棒的。

但主要是因为它允许使用真正是指针的东西，但它就像一个本地值对象。引用 Stroustrup 的话，C++ 努力使类实例“像 ints d 那样做”。通过 vaue 传递 int 很便宜，因为 int 适合机器寄存器。类通常比整数大，并且按值传递它们会产生很大的开销。

能够传递一个“看起来像”值对象的指针（通常是一个 int 或两个 int 的大小）允许我们编写更简洁的代码，而无需取消引用的“实现细节”。而且，与运算符重载一起，它允许我们使用类似于 int 语法的语法编写类。特别是，它允许我们编写模板类，其语法同样适用于原始类型，如整数和类（如复数类）。

而且，特别是在运算符重载的情况下，有些地方我们应该返回一个对象，但同样，返回一个指针要便宜得多。Oncve 再次返回一个引用是我们的“out.

而且指针很难。也许不适合你，也不适合任何意识到指针只是内存地址值的人。但回想我的 CS 101 课时，他们绊倒了许多学生。

```
char* p = s; *p = *s; *p++ = *s++; i = ++*p; 
```

可能会令人困惑。

哎呀，经过 40 年的 C 语言，人们甚至不能同意指针声明应该是：

```
char* p; 
```

或者

```
char *p; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-08T03:01:02.737

我一直想知道为什么他们没有为此创建一个引用赋值运算符（比如：=）。

只是为了让某人紧张，我编写了一些代码来更改结构中引用的目标。

不，我不建议重复我的把戏。如果移植到足够不同的架构，它将中断。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-08T11:02:09.257

半认真的：恕我直言，让它们与指针有一点不同；）你知道你可以写：

```
MyClass & c = *new MyClass(); 
```

如果您以后还可以写：

```
c = *new MyClass("other") 
```

在指针旁边有任何引用是否有意义？

```
MyClass * a =  new MyClass();
MyClass & b = *new MyClass();
a =  new MyClass("other");
b = *new MyClass("another"); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-08T22:36:35.250

C++ 中的引用不可为空的事实是它们只是别名的副作用。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-07-31T13:44:17.027

我同意接受的答案。但是对于 constness，它们的行为很像指针。

```
struct A{
    int y;
    int& x;
     A():y(0),x(y){}
};

int main(){
  A a;
  const A& ar=a;
  ar.x++;
} 
```

作品。看

[const 引用传递的类的引用成员行为的设计原因](https://stackoverflow.com/questions/11739804/design-reasons-for-the-behavior-of-reference-members-of-classes-passed-by-const)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-10-04T19:45:25.260

如果您想要一个作为引用的成员变量并且您希望能够重新绑定它，那么有一种解决方法。虽然我发现它有用且可靠，但请注意它在内存布局上使用了一些（非常弱的）假设。由您决定它是否符合您的编码标准。

```
#include <iostream>

struct Field_a_t
{
    int& a_;
    Field_a_t(int& a)
        : a_(a) {}
    Field_a_t& operator=(int& a)
    {
        // a_.~int(); // do this if you have a non-trivial destructor
        new(this)Field_a_t(a);
    }
};

struct MyType : Field_a_t
{
    char c_;
    MyType(int& a, char c)
        : Field_a_t(a)
        , c_(c) {}
};

int main()
{
    int i = 1;
    int j = 2;
    MyType x(i, 'x');
    std::cout << x.a_;
    x.a_ = 3;
    std::cout << i;
    ((Field_a_t&)x) = j;
    std::cout << x.a_;
    x.a_ = 4;
    std::cout << j;
} 
```

这不是很有效，因为您需要为每个可重新分配的引用字段使用单独的类型并将它们设为基类；此外，这里有一个弱假设，即具有单个引用类型的类不会具有可能破坏 MyType 的运行时绑定的a`__vfptr`或任何其他相关字段。`type_id`我知道的所有编译器都满足该条件（不这样做几乎没有意义）。

# c# - 如何在 C++/CLI 中将属性添加到返回值？

> ID：728241
> 
> 赞同：3
> 
> 时间：2009-04-08T02:02:37.120
> 
> 标签：c#, attributes, c++-cli

在 C# 中，您可以使用属性来装饰函数返回值，如下所示：

```
[return: MarshalAs(UnmanagedType.IUnknown)]
object LoadStuff(); 
```

我的问题是，如何在 C++/CLI 中做到这一点？我有这个：

```
[return: MarshalAs(UnmanagedType::IUnknown)]
Object^ LoadStuff(); 
```

但编译器出错了`'return' : unknown attribute qualifier`.

有没有我找不到的替代语法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T02:15:58.600

使用 returnvalue 而不是 return

```
[returnvalue: MarshalAs(UnmanagedType::IUknown)] 
```

属性目标的完整列表可在 C++/CLI 规范[(PDF)的第 28.2 节中找到](http://www.plumhall.com/C++-CLI%20draft%201.5.pdf)

# asp.net - 在运行时切换中继器的 ItemTemplate

> ID：728245
> 
> 赞同：1
> 
> 时间：2009-04-08T02:04:20.517
> 
> 标签：asp.net

是否可以为Repeater 的ItemTemplate 定义多个模板并根据某些条件在它们之间切换？

我使用转发器查看帖子列表，但希望对属于当前用户的行有不同的视图（例如，包含用于删除帖子的 LinkBut​​ton）

如果这是不可能的，那么是否可以在中继器的 ItemTemplate 中使用 Multiview 控件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T04:01:21.607

我尝试在 ItemTemplate 中使用 MultiView 控件，效果很好，希望这可以帮助遇到同样问题的人：

```
<asp:Repeater ID="Repeater1" runat="server" OnItemCommand="Repeater1_ItemCommand">
  <ItemTemplate>
    <asp:MultiView ID="MultiView1" runat="server" ActiveViewIndex="<%# ((Post)Container.DataItem).Member.ID == CurrentMemberID ? 1 : 0 %>">
      <asp:View ID="View1" runat="server"><!-- some links --></asp:View>
      <asp:View ID="View2" runat="server"><asp:LinkButton CommandName="DeletePost" CommandArgument="<%# ((Post)Container.DataItem).Id %>" ID="LinkButton1" runat="server">Delete Post</asp:LinkButton></asp:View>
    </asp:MultiView>
  </ItemTemplate>
</asp:Repeater> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T03:03:40.810

我不知道是否可以在模板之间切换，但我发现[Repeater.OnItemDataBound](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.repeater.onitemdatabound.aspx)事件对于修改单个中继器项目的显示最有用。

例如，要显示基于当前用户的链接按钮...

```
protected void repeater_ItemDataBound(object sender, RepeaterItemEventArgs e)
{
   LinkButton = e.Item.FindControl("btnDelete");
   LinkButton.Visible = (e.Item.DataItem as DataRow)["CreatedBy"] == getCurrentUser();
} 
```

通常我保持每个中继器项目的数据布局一致，并通过更改模板中控件的 CssStyle 和 Visible 属性来修改视觉外观。如果有更激进的布局更改，我会将每个布局选项放在一个占位符中，并使用逻辑来确定要显示哪个占位符。

# php - 将在同一个对象中具有依赖关系的方法重构为更可测试的方法（PHP）

> ID：728252
> 
> 赞同：1
> 
> 时间：2009-04-08T02:07:03.880
> 
> 标签：php, unit-testing, tdd, dependency-injection, inversion-of-control

我目前在我的类中有一个方法，它必须调用其他方法，一些在同一个对象中，另一些来自其他对象。

```
 class MyClass
{
    public function myMethod()
    {
        $var1 = $this->otherMethod1();
        $var2 = $this->otherMethod2();
        $var3 = $this->otherMethod3();
        $otherObject = new OtherClass();
        $var4 = $otherObject->someMethod();

        # some processing goes on with these 4 variables
        # then the method returns something else

        return $var5;
    }
} 

```

我是整个 TDD 游戏的新手，但我*认为*我理解的一些关键前提是更可测试的代码是组合、松散耦合，以及一些依赖注入/控制反转的策略。

在这种特殊情况下，我如何着手将方法重构为更可测试的东西？

我是否将`$this`对象引用作为参数传递给方法，以便我可以轻松地模拟/存根协作方法？这是推荐的还是太过分了？

```
 class MyClass
{
    public function myMethod($self, $other)
    {
        # $self == $this
        $var1 = $self->otherMethod1();
        $var2 = $self->otherMethod2();
        $var3 = $self->otherMethod3();
        $var4 = $other->someMethod();

        # ...

        return $var5;
    }
} 

```

此外，对我来说很明显，依赖关系对于 TDD 来说是一个相当大的问题，因为必须考虑如何将存根/模拟注入上述方法进行测试。大多数 TDDers 是否使用 DI/IoC 作为公共依赖项的主要策略？在什么时候它变得夸大了？你能给出一些有效地做到这一点的建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T02:28:59.020

这些都是一些很好的问题......首先让我说我根本不了解JS，但我是一名单元测试人员并且已经处理过这些问题。我首先要指出的是，如果你不使用它，JsUnit 是存在的。

我不会太担心你的方法在同一个类中调用其他方法......这一定会发生。更让我担心的是另一个对象的创建，这取决于它有多复杂。

例如，如果您正在实例化一个通过网络执行各种操作的类，那么对于简单的单元测试来说这太重了。您更愿意做的是模拟对该类的依赖，以便您可以让对象产生您希望从其在网络上的操作中收到的结果，而不会产生网络上的开销：网络故障、时间， ETC...

传入另一个对象有点混乱。人们通常做的是有一个工厂方法来实例化另一个对象。工厂方法可以根据您是否正在测试（通常通过标志）来决定是实例化真实对象还是模拟对象。实际上，您可能希望使另一个对象成为您的类的成员，并在构造函数中调用工厂，或者直接决定是否实例化模拟对象或真实对象。在设置函数或测试用例中，您可以在模拟对象上设置特殊条件，以便它返回正确的值。

另外，只要确保您在同一个班级中对您的其他功能进行了测试......我希望这会有所帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T04:05:10.240

看起来这个类的整个想法并不完全正确。在 TDD 中，您正在测试类，而不是方法。如果一个方法有它自己的责任并提供它自己的（单独的可测试的）功能，它应该被移到一个单独的类中。否则，它只会破坏整个 OOP 封装。特别是它打破了单一职责原则。

在您的情况下，我会将测试的方法提取到另一个类中并注入`$var1`, `$var2`,`$var3`和`$other`作为依赖项。应该模拟`$other`，以及测试类所依赖的任何对象。

```
class TestMyClass extends MyTestFrameworkUnitTestBase{
     function testMyClass()
     {
          $myClass = new MyClass();
          $myClass->setVar1('asdf');
          $myClass->setVar2(23);
          $myClass->setVar3(78);
          $otherMock = getMockForClassOther();
          $myClass->setOther($otherMock);
          $this->assertEquals('result', $myClass->myMethod());
     }
} 
```

我使用的基本规则是：如果我想测试一些东西，我应该把它变成一个类。不过，这在 PHP 中并不总是如此。但它在 90% 的情况下都适用于 PHP。（根据我的经验）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T02:16:07.727

我可能错了，但我的印象是对象/类对他们的客户来说应该是黑盒子，对他们的测试客户也是如此（我认为封装是我正在寻找的术语）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T02:37:51.013

你可以做几件事：

最好的办法是模拟，这里有一个这样的库：[http ://code.google.com/p/php-mock-function](http://code.google.com/p/php-mock-function)

它应该让您只模拟您想要的特定功能。

如果这不起作用，那么下一个最好的办法是在类中提供`method2`作为对象的方法的实现`MyClass`。如果您不能直接模拟方法，我发现这是更简单的方法之一：

```
class MyClass {
  function __construct($method2Impl) {
    $this->method2Impl = $method2Impl;
  }
  function method2() {
    return $this->method2Imple->call();
  }
} 
```

另一种选择是添加一个“正在测试”标志，以便该方法表现不同。我也不推荐这样做——最终你会有不同的代码路径和他们自己的错误。

另一种选择是子类化并覆盖您需要的行为。我 - 真的 - 不建议这样做，因为您最终会自定义您的覆盖模拟，以至于它本身就会有错误:)。

最后，如果您需要模拟一个方法，因为它太复杂了，那么将它移动到它自己的对象中并使用组合（基本上使用我上面提到的技术）*可能*`method2Impl`是一个好兆头。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-05T17:09:04.697

可能，这更多是违反单一责任原则的问题，这会导致 TDD 问题。

这是一件好事，这意味着 TDD 暴露了设计缺陷。故事是这样的。

如果这些方法不是公开的，只是你将代码分解成更易于消化的块，老实说，我不在乎。

如果这些方法是公开的，那么你就有问题了。遵循规则，“类实例的任何公共方法必须在任何时候都可以调用”。也就是说，如果您需要对方法调用进行某种排序，那么是时候分解该类了。

# iphone - 删除执行线程的 UIViewController 会使我的应用程序崩溃

> ID：728257
> 
> 赞同：0
> 
> 时间：2009-04-08T02:08:41.893
> 
> 标签：iphone

我的应用程序在选项卡栏中有按钮。

当我触摸一个按钮时，我加载一个笔尖，添加视图并从堆栈中删除其他视图并释放它。

问题是我的一个视图控制器正在使用一个从 NSURLConnection 获取 xml 数据的对象，解析它们并将它们发送到视图控制器以显示它们。它可以工作，但有时当我触摸另一个导致此视图控制器释放的按钮时它会崩溃。

释放它并停止获取数据的线程的最佳方法是什么？

非常感谢你的帮助。

蒂埃里

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T13:10:55.790

与其释放它，不如创建一个 Cancel 函数，在该类中将一些布尔标志设置为 true。在 XML 解析部分，检查该标志。如果它是真的：

```
[self release];
return; 
```

# html - HTML缩小？

> ID：728260
> 
> 赞同：99
> 
> 时间：2009-04-08T02:10:28.100
> 
> 标签：html, minify

是否有在线工具可以输入页面的[HTML](http://en.wikipedia.org/wiki/HTML)源代码并缩小代码？

我会为 aspx 文件这样做，因为让网络服务器 gzip 它们不是一个好主意......

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-09-07T10:14:22.257

也许尝试[HTML Compressor](http://code.google.com/p/htmlcompressor/)，这是一个前后表，显示了它可以做什么（包括 Stack Overflow 本身）：

![抱歉，markdown 没有表格的概念](https://i.stack.imgur.com/P4vN0.png)

它具有许多用于优化您的页面的选项，包括脚本最小化（ompressor、Google Closure Compiler、您自己的压缩器），这将是安全的。默认选项集非常保守，因此您可以从它开始并尝试启用更激进的选项。

该项目有很好的文档记录和支持。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-07-09T06:14:56.467

[不要这样做](http://en.wikipedia.org/wiki/Optimization_%28computer_science%29#When_to_optimize)。或者更确切地说，如果您坚持这样做，请在完成任何更重要的网站优化后进行。这项工作的成本/收益极有可能可以忽略不计，*特别是*如果您计划手动使用在线工具来处理每个页面。

使用[YSlow](http://developer.yahoo.com/yslow/)或[Page Speed](http://code.google.com/speed/page-speed/)来确定您*真正*需要做什么来优化您的页面。我的猜测是减少 HTML 的字节数不会是您网站的最大问题。压缩、缓存管理、图像优化等更有可能对您网站的整体性能产生更大的影响。这些工具将向您展示最大的问题是什么——如果您已经处理了所有问题并且仍然发现 HTML 缩小会产生重大影响，那就去做吧。

（如果您确定要这样做，并且使用 Apache httpd，则可以考虑使用[mod_pagespeed](http://code.google.com/p/page-speed/wiki/MinifyHtml)并打开一些选项以减少空格等，但要注意[风险](http://code.google.com/p/page-speed/wiki/MinifyHtml)。）

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2014-03-17T05:15:39.040

这是对您问题的简短回答：**您应该缩小 HTML、CSS、JS**。有一个易于使用的工具，称为[grunt](http://gruntjs.com/)。它允许您自动执行许多任务。其中包括[JS](https://github.com/gruntjs/grunt-contrib) [、](https://github.com/gruntjs/grunt-contrib-uglify) CSS [、](https://github.com/gruntjs/grunt-contrib-cssmin) HTML[缩小](https://github.com/gruntjs/grunt-contrib-htmlmin)、[文件连接](https://github.com/gruntjs/grunt-contrib-concat)等等。

这里写的答案非常过时，有时甚至没有意义。与旧的 2009 年相比，很多事情发生了变化，所以我将尝试正确回答这个问题。

简短的回答 -**你绝对应该缩小 HTML**。今天它是微不足道的，并且提供了大约[5% 的加速](https://code.google.com/p/htmlcompressor/)。如需更长的答案，请阅读整个答案

回到过去，人们手动缩小 css/js（通​​过一些特定的工具运行它来缩小它）。自动化这个过程有点困难，而且肯定需要一些技能。知道即使现在很多高级网站都没有使用 gzip（这是微不足道的），人们不愿意缩小 html 是可以理解的。

**那么为什么人们要缩小 js 而不是 html**呢？当你缩小 JS 时，你会做以下事情：

*   删除评论
*   删除空格（制表符、空格、换行符）
*   将长名称更改为短名称 ( `var isUserLoggedIn`to `var a`)

即使在过去，这也带来了很大的改进。但是在 html 中，您无法将长名称简称为短名称，在那段时间也几乎没有什么可评论的。所以唯一剩下的就是删除空格和换行符。这只会带来少量的改进。

**这里写的一个错误论点是，因为内容是使用 gzip 提供的，所以缩小没有意义。**这是完全错误的。是的，gzip 减少了缩小的改进是有道理的，但是如果你可以正确地修剪它们，为什么要 gzip 注释和空格，并且 gzip 只是重要的部分。这就像您有一个要归档的文件夹，其中包含一些您永远不会使用的废话，并且您决定只压缩它而不是清理和压缩它。

**另一个为什么做缩小毫无意义的论点是它很乏味。**也许这在 2009 年是正确的，但在此之后出现了新的工具。现在你不需要手动缩小你的标记。对于像[Grunt](http://gruntjs.com/)这样的东西，安装[grunt-contrib-htmlmin](https://github.com/gruntjs/grunt-contrib-htmlmin)（依赖于[@kangax](http://kangax.github.io/html-minifier/)的 HTMLMinifier）并配置它来缩小你的 html 是很简单的。您只需要 2 小时来学习 grunt 并配置所有内容，然后一切都会在不到一秒的时间内自动完成。听起来 1 秒（您甚至可以使用[grunt-contrib-watch](https://github.com/gruntjs/grunt-contrib-watch)自动执行任何操作）对于大约 5% 的改进来说并不是那么糟糕（即使使用 gzip）。

**还有一个论点是 CSS 和 JS 是静态的**，而 HTML 是由服务器生成的，所以你不能预先缩小它。这在 2009 年也是如此，但目前[越来越](https://twitter.com/)多[的](https://www.facebook.com/)网站看起来像一个单页应用程序，其中服务器很薄，客户端负责所有的路由、模板和其他逻辑。所以服务器只给你[JSON](http://www.json.org/)和客户端呈现它。在这里，您有很多用于页面的 html 和不同的模板。

所以结束我的想法：

*   谷歌正在缩小 html。
*   [pageSpeed](https://developers.google.com/speed/pagespeed/)要求您缩小 html
*   做起来很简单
*   它提供了约 5% 的改进
*   它与 gzip 不同

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2009-08-20T01:11:40.163

我写了一个网络工具来缩小 HTML。 [http://prettydiff.com/?m=minify&html](http://prettydiff.com/?m=minify&html)

该工具使用以下规则运行：

*   删除所有 HTML 注释*   空白字符的运行被转换为单个空格字符*   删除标签内不必要的空白字符*   删除两个标签之间的空白字符，其中这两个标签之一不是单例*   标签内的所有内容`style`都被假定为 CSS 并被缩小为这样*   一个标签内的所有内容`script`都被假定为 JavaScript，除非提供了不同的媒体类型，然后像这样缩小

*   CSS 和 JavaScript 缩小使用 JSMin 的重分叉形式。这个 fork 被扩展为原生支持 CSS 并且还支持 SCSS 语法。JavaScript 缩小支持自动分号插入，但尚不支持自动大括号插入。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-12-14T17:07:02.947

这对我有用：

[http://minify.googlecode.com/git/min/lib/Minify/HTML.php](http://minify.googlecode.com/git/min/lib/Minify/HTML.php)

它不是一个已经可用的在线工具，但作为一个简单的 PHP 包含它很容易，您可以自己运行它。

不过，我不会保存压缩文件，如果你真的需要动态地执行此操作，并且启用 Gzip 服务器压缩总是一个更好的主意。我不知道这在 IIS/.Net 中的参与程度如何，但在 PHP 中，它就像在全局包含文件中添加一行一样简单

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-08T03:39:05.623

CodeProject 有一个已发布的示例项目（[http://www.codeproject.com/KB/aspnet/AspNetOptimizer.aspx?fid=1528916&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2794900](http://www.codeproject.com/KB/aspnet/AspNetOptimizer.aspx?fid=1528916&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2794900)）来处理以下一些情况。 .

*   将 ScriptResource.axd 调用组合成一个调用
*   根据浏览器功能压缩所有客户端脚本，包括 gzip/deflate
*   用于删除注释、缩进和换行符的 ScriptMinifier。
*   基于浏览器功能（包括 gzip/deflate）压缩所有 html 标记的 HTML 压缩器。
*   而且 - 最重要的是 - 一个 HTML 缩小器，用于将完整的 html 写入单行并在可能的级别（正在建设中）缩小它。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-04-16T10:44:09.760

对于 Microsoft .NET 平台，有一个名为[WebMarkupMin](http://webmarkupmin.codeplex.com)的库，它可以生成 HTML 代码的缩小。

此外，还有一个模块可以将此库集成到 ASP.NET MVC - [WebMarkupMin.Mvc](http://nuget.org/packages/WebMarkupMin.Mvc)中。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-03-25T18:27:16.867

试试[http://code.mini-tips.com/html-minifier.html](http://code.mini-tips.com/html-minifier.html)，这是 Html Minifier 的 .NET 库

HtmlCompressor 是一个小型、快速且非常易于使用的 .NET 库，它通过删除额外的空格、注释和其他不需要的字符来缩小给定的 HTML 或 XML 源，而不会破坏内容结构。结果页面变得更小并且加载更快。压缩器的命令行版本也可用。

# php - 是否可以使用 ajax/jquery 技术预加载页面内容？

> ID：728261
> 
> 赞同：17
> 
> 时间：2009-04-08T02:10:36.757
> 
> 标签：php, javascript, jquery, ajax, preloader

是否可以预加载所有页面内容（例如显示加载栏/动画 gif.. 或加载文本..），直到内容完全加载然后显示给用户/访问者？如果这是可能的，您能否给我一些指导或资源来实现这一目标。因为我能够轻松找到图像预加载器，但我正在寻找一种预加载技术，该技术将在显示之前预加载页面上的所有内容。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-08T03:06:27.417

没有必要为此使用 Ajax。只需将页面的包装器 div 设置`display`为`none`. 然后将其更改`block`为加载 *文档的时间。*

您的代码可能看起来像这样，使用 vanilla javascript：

```
<script type="text/javascript">
    function preloader() {
        document.getElementById("preloader").style.display = "none";
        document.getElementById("container").style.display = "block";
    }

    window.onload = preloader;
</script>

<style>
div#wrapper {
    display: none;
}

div#preloader {             
    top: 0; right: 10px;
    position:absolute;
    z-index:1000;
    width: 132px; height: 38px;
    background: url(path/to/preloaderBg.png) no-repeat;
    cursor: wait;
    text-shadow: 0px 1px 0px #fefefe;  //webkit                 
}
</style>

<body>
    <div id="preloader">Loading... Please Wait.</div>
    <div id="wrapper">
        <!-- page contents goes here -->
    </div>
</body> 
```

**更新**，在 jQuery 中：

```
<script type="text/javascript">
    // Use $(window).load(fn) if you need to load "all" page content including images, frames, etc.
    $(document).ready(function(){ 
        $("#preloader").hide();
        $("#container").show();
    });
</script> 
```

相关文档：Events/ [ready](http://docs.jquery.com/Events/ready#fn) , Events/ [load](http://docs.jquery.com/Events/load#fn) , CSS/ [css](http://docs.jquery.com/CSS/css#namevalue) & Core/ [$](http://docs.jquery.com/%24)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-08T09:28:08.810

如果您选择在加载整个页面之前隐藏内容的方法，请不要将其最初隐藏在 CSS 中，然后在 JavaScript 中取消隐藏。如果你这样做，任何禁用或不可用 JavaScript 的人都将无法获得任何页面。相反，从脚本中隐藏和显示。

```
<body>
    <script type="text/javascript">
        document.body.style.visibility= 'hidden';
        window.onload= function() { document.body.style.visibility= 'visible'; };
    </script> 
```

另请注意，“预加载器”一词并不适合您在这里所做的事情。'pre' 意味着您通过获取和缓存页面来提高性能，以便在需要的时候准备好运行。

但实际上情况恰恰相反：当页面加载时，当部分内容可用时，它会等待向用户显示任何内容，从而*降低性能。*击败渐进式渲染会使浏览变慢，而不是更快。这通常是明显的错误，除了在少数特殊情况下，使用正常的浏览器渐进式渲染是最好的。这就是网络的工作方式；人们现在已经习惯了。

（也就是说，除了那些并不真正使用或理解网络但要求他们公司的网站立即出现的那种愚蠢的管理类型之外的人。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T02:24:41.077

我做了一些我需要知道图像何时完全加载的事情，所以我使用`$.get()`函数进行了预加载，并传递了一个回调函数作为最后一个参数。这样，当实际下载图像时，我的回调会触发，我会知道浏览器已经在缓存中保存了图像。

您可以编写一个函数，为您告诉它预加载的每个图像增加一个全局变量，然后您的回调可以减少计数器。当计数器归零时，调用另一个函数。一旦预加载所有图像，此功能现在将触发。

这是为了图像。当 $(document).ready() 被触发时，可以保证加载其他所有内容。因此，如果您此时开始您的例程，则应该加载页面上的所有内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-01-13T12:43:05.660

最好的办法

```
函数阿贾克斯（）{
$('#wapal').html('图像路径');
$.ajax({
      url:'somfile.php',
         方法：'get'，
         成功：功能（数据）{
         如果（数据==''）返回；
         $('#wapal').html(数据);
       }
    });
}

```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-15T08:14:56.080

你可以很容易地用 jquery 做到这一点。

脚本

```
 $(window).load(function() {
     $('#preloader').fadeOut('slow', function() { $(this).remove(); });
}); 
```

款式

```
 div#preloader {
   position: fixed;
   z-index: 999;
   width: 100%;
   height: 100%;
   background: #c6d6c2 url(ajax-loader.gif) no-repeat center center;
 } 
```

HTML

```
`div id="preloader"` 
```

* * *

 `## 回答 #6

> 赞同：1
> 
> 时间：2012-06-23T13:23:07.693

**对 DMus -Jerad Answer 进行了一些修改，因为当页面上有 adsense 时它不起作用。**

你可以很容易地用 jquery 做到这一点。

脚本

```
$(document).ready(function() {
     $('#preloader').fadeOut('slow', function() { $(this).remove(); });
}); 
```

款式

```
div#preloader {
   position: fixed;
   z-index: 999;
   width: 100%;
   height: 100%;
   background: #c6d6c2 url(ajax-loader.gif) no-repeat center center;
 } 
```

HTML

```
div id="preloader" 
```

# asp.net - 从 JSON 对象中提取字符串值

> ID：728268
> 
> 赞同：3
> 
> 时间：2009-04-08T02:15:52.580
> 
> 标签：asp.net, javascript, jquery, web-services, json

我有一个 Web 服务，它返回一个 JSON 对象，其中包含字符串“Hello World”。如何将这个字符串拉出对象？

数据 = [对象对象]

谢谢

缺口

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T02:22:35.043

你必须知道你的对象是怎样的，对象有哪些成员。

你可以尝试类似的东西

```
for(var e in data)
    alert(e + ' : ' + data[e]); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T02:25:25.723

您可以使用`eval`：

```
var foo = eval('(' + data + ')'); 
```

但这有潜在的危险，特别是如果您不信任从服务器发送的内容。因此，从 JSON 对象中提取数据的最佳方式（也是最安全的方式）是使用[Crockford 的 JSON 库](http://www.json.org/js.html)：

```
var foo = JSON.parse(data); 
```

* * *

顺便说一句，如果您使用 jQuery 查询 ASP.Net Web 服务，请注意这个`d.`问题（用作容器对象）。因此，要提取返回的对象，您必须执行以下操作：

```
var foo = JSON.parse(data);
if (foo) {
    //Foo is not null
    foo = f.d;
} 
```

更多关于这里的信息：http: [//encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T02:25:00.840

如果您使用 jQuery 的 post 函数，您可以按照[此处](http://docs.jquery.com/Ajax/jQuery.post)找到的示例进行操作。

```
$.post("test.php", { func: "getNameAndTime" },
    function (data) {
        alert(data.name); // John
        console.log(data.time); //  2pm
    }, "json"); 
```

在您的情况下，我怀疑您会调用 data.data。

# php - PHP, cURL post 登录到 WordPress

> ID：728274
> 
> 赞同：17
> 
> 时间：2009-04-08T02:19:20.403
> 
> 标签：php, wordpress, curl

我正在为需要通过链接单击自动登录的客户开发一个项目。

我正在使用握手页面通过以下代码执行此操作：

```
$username = "admin";
$password = "blog";
$url = "http://wordpressblogURL/";
$cookie = "cookie.txt";

$postdata = "log=" . $username . "&pwd=" . $password . "&wp-submit=Log%20In&redirect_to=" . $url . "blog/wordpress/wp-admin/&testcookie=1";
$ch = curl_init();
curl_setopt ($ch, CURLOPT_URL, $url . "blog/wordpress/wp-login.php");

curl_setopt ($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt ($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.6) Gecko/20070725 Firefox/2.0.0.6");
curl_setopt ($ch, CURLOPT_TIMEOUT, 60);
curl_setopt ($ch, CURLOPT_FOLLOWLOCATION, 1);
curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 0);
curl_setopt ($ch, CURLOPT_COOKIEJAR, $cookie);
curl_setopt ($ch, CURLOPT_REFERER, $url . "blog/wordpress/wp-login.php");

curl_setopt ($ch, CURLOPT_POSTFIELDS, $postdata);
curl_setopt ($ch, CURLOPT_POST, 1);
$result = curl_exec ($ch);
curl_close($ch);
echo $result;

exit; 
```

这工作正常。它让我很好。

问题是我相信 WordPress 关闭了 URL。

详细地说，我的握手页面（我登录）位于“blog”目录中，而我的 WordPress 应用程序位于位于“blog”目录内的“wordpress”目录中。浏览器中的 URL 显示`..blog/handshake.php`。但是，它在浏览器窗口中有 WordPress 的管理部分。WordPress 管理链接现在无法正常工作，因为当 URL`../blog`需要在目录中时，它在`..blog/wordpress/wp-admin`目录中。

[cURL](http://en.wikipedia.org/wiki/CURL)中有没有办法让浏览器中的 URL 反映实际页面？

我应该改用 FSockOPen 吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-01-05T22:11:47.513

Kalium 做对了——WordPress 界面中的路径是相对的，导致管理界面在以这种方式访问​​时无法正常工作。

你的方法在几个方面是有关的，所以我想提出一些快速的建议。

首先，我会尝试找到一种方法来从硬编码中删除`$username`and变量。`$password`想想这是多么容易破解——例如，如果通过管理界面更新密码，您代码中的硬编码值将不再正确，您的“自动登录”现在将失败。此外，如果有人以某种方式组成了该站点并获得了访问权限`handshake.php`——那么，现在他们已经获得了您博客的用户名和密码。

`/blog`鉴于路径是相对的（在您的示例代码中），您的 WordPress 安装看起来与您编写的握手脚本位于同一台服务器上。因此，我建议尝试在您的父应用程序登录中模仿他们验证的会话。过去我已经做过好几次了——只是不记得具体细节了。因此，例如，您的登录脚本不仅会设置您的登录凭据，还会设置 WordPress 身份验证所需的会话密钥。

这个过程将涉及挖掘大量 WordPress 的代码，但这就是开源的美妙之处！尝试简单地将 WordPress 的身份验证机制集成到应用程序的登录机制中，而不是使用 cURL 和硬编码值。我会首先查看源代码`wp-login.php`并从那里开始。

如果所有其他方法都失败了，并且您决定不尝试将会话身份验证机制与 WordPress 的机制相结合，那么您可以通过对代码的这些更改立即解决您的问题（而不修复您的方法中更令人担忧的方面）：

首先，添加以下 curl_opt：

```
curl_setopt($ch, CURLOPT_COOKIEFILE, $cookie);  // Enables session support 
```

然后，在关闭 cURL 处理程序后添加：

```
curl_close($ch);
// Instead of echoing the result, redirect to the administration interface, now that the valid, authenticated session has been established
header('location: blog/wordpress/wp-admin/');
die(); 
```

因此，在这个不太理想的解决方案中，您将使用 cURL 对用户进行身份验证，然后与其尝试将管理界面劫持到当前页面，不如将它们重定向到常规管理界面。

我希望这有帮助！如果您需要更多帮助/解决方案尚不清楚，请告诉我。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T04:14:11.093

检查 HTML 源代码。听起来 WP 的链接可能是相对的。但是，不要让这个过程变得比现在更复杂，我建议您执行登录，将所需的任何 cookie 交给用户，然后重定向它们。

否则，您正在逐个编写代理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-20T05:17:53.257

如果您的脚本没有在一次执行中执行您需要的所有功能，您可能需要解析出 cookie 值，将它们存储在文件中，然后在下一次执行时重新发送。查看 CURLOPT_COOKIEFILE 选项。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-05-31T03:02:33.860

这是对我有用的代码：

关键的变化是我从我的帖子字符串中删除了名为“testcookie”的参数。

注意：在下面的代码中添加您的网站而不是“mywordpress”以及用户名和密码

```
$curl = curl_init();

//---------------- generic cURL settings start ----------------
$header     = array(
      "Referer: https://mywordpress/wp-login.php",
"Origin: https://mywordpress",
"Content-Type: application/x-www-form-urlencoded",
"Cache-Control: no-cache",
"Pragma: no-cache",
"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
"User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.5 Safari/605.1.15"
      );

curl_setopt($curl, CURLOPT_HTTPHEADER, $header);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, 0);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, 0);
curl_setopt($curl, CURLOPT_USERAGENT, 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.5 Safari/605.1.15');
curl_setopt($curl, CURLOPT_AUTOREFERER, true);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($curl, CURLOPT_FOLLOWLOCATION, 1);
curl_setopt($curl, CURLOPT_COOKIESESSION, true);
curl_setopt($curl, CURLOPT_COOKIEFILE, 'cookies.txt');
curl_setopt($curl, CURLOPT_COOKIEJAR, 'cookies.txt');
//---------------- generic cURL settings end ----------------

$url = 'https://mywordpress/wp-login.php';
curl_setopt($curl, CURLOPT_URL, $url);

$post = 'log=username&pwd=password&wp-submit=Log+In&redirect_to=https%3A%2F% mywordpress%2Fwp-admin%2F';
curl_setopt($curl, CURLOPT_POST, TRUE);
curl_setopt($curl, CURLOPT_POSTFIELDS, $post);

$output = curl_exec($curl);

curl_close ($curl);

echo ($output) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-11T20:19:12.553

使用[Zend Framework 的 Cookies](http://framework.zend.com/manual/en/zend.http.cookies.html)类为您管理它们。我过去曾使用它来使用[cURL](http://en.wikipedia.org/wiki/CURL)抓取网站的安全部分。

# sql-server - ASP.NET MVC“股票应用程序”部署问题

> ID：728281
> 
> 赞同：0
> 
> 时间：2009-04-08T02:23:28.037
> 
> 标签：sql-server, asp.net-mvc, database

我开始学习 ASP.NET MVC。

我已经部署了“库存” ASP.NET MVC 示例应用程序（即简单的用户帐户系统），以便在我开始玩游戏时有一个实时版本进行测试。

*请注意，我正在使用： - ASP.NET MVC 1.0 版本。- WebFusion 主机。*

**我认为问题与访问数据库有关。**

我使用以下指南进行部署：http: [//msdn.microsoft.com/en-us/library/dd410407.aspx](http://msdn.microsoft.com/en-us/library/dd410407.aspx)

当我尝试登录或注册时存在错误（似乎与数据库相关的任何内容）。

我收到错误消息屏幕，其中指出：“抱歉，处理您的请求时发生错误。”

任何能以我的方式发现错误或出了什么问题的人的任何建议都会非常感激。

**编辑：导出和导入数据库**

我认为这是没有正确部署数据库的问题，我只是将它部署在 App Data 文件夹中（就像创建应用程序时一样）并使用默认连接字符串。

我不确定如何使用我的网络主机 webfusion.com 导入数据库。它要求我将我的数据库导出到 .sql 文件**（知道如何做到这一点吗？）**然后上传该文件以在服务器上创建数据库。此时我的主机提供了连接字符串。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T02:32:51.150

总是从明显的......听起来像数据库权限错误开始。

部署时，您是否确保部署的数据库对您的应用程序的用户凭据具有适当的用户权限？

**更新：**

要检查这一点，请按照下列步骤操作：

1.  打开 ASP.NET MVC 应用程序的 web.config 文件。

2.  找到配置文件的部分。对于默认的 ASP.NET MVC 示例，它如下所示：

    <connectionStrings> <add name="ApplicationServices" connectionString="data source=.\SQLEXPRESS;Integrated Security=SSPI;AttachDBFilename=|DataDirectory|aspnetdb.mdf; User Instance=true" providerName="System.Data.SqlClient"/> </connectionStrings>

3.  此默认连接字符串使用集成身份验证。在您部署的站点上使用集成安全性可能会变得很棘手。解决这个问题的最简单方法是创建一个 sql 帐户供您的应用程序使用。然后将该 SQL 用户添加到部署的数据库中。

4.  创建用户并将其添加到数据库后，您需要更新连接字符串。查看此资源以制作您的连接字符串：

[http://www.connectionstrings.com](http://www.connectionstrings.com)

# .net - 在 Ironpython 中开始 .net 开发

> ID：728293
> 
> 赞同：3
> 
> 时间：2009-04-08T02:30:00.393
> 
> 标签：.net, ironpython

我处于需要开始学习一些 .net 才能在工作中使用某些应用程序的情况。

目前我的知识主要是 python 和 php，所以我有兴趣采用铁 python 路线来学习和实现 .net 。

这是一个好主意吗？和/或有什么好的资源可以开始学习吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T02:38:14.320

你很幸运...... [IronPython In Action](http://www.manning.com/foord/)刚刚在过去一两周内发布。

# java - 使用 log4j 创建多个不同内容的日志文件

> ID：728295
> 
> 赞同：81
> 
> 时间：2009-04-08T02:31:18.097
> 
> 标签：java, log4j

有没有办法配置 log4j 以便将不同级别的日志记录输出到不同的附加程序？

我正在尝试设置多个日志文件。主日志文件将捕获所有类的所有 INFO 及以上消息。（在开发中，它将捕获所有 DEBUG 及以上消息，以及特定类的 TRACE。）

然后，我想要一个单独的日志文件。该日志文件将捕获特定类子集的所有 DEBUG 消息，并忽略任何其他类的所有消息。

有没有办法得到我所追求的？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-04-08T02:55:03.233

这应该让你开始：

```
log4j.rootLogger=QuietAppender, LoudAppender, TRACE
# setup A1
log4j.appender.QuietAppender=org.apache.log4j.RollingFileAppender
log4j.appender.QuietAppender.Threshold=INFO
log4j.appender.QuietAppender.File=quiet.log
...

# setup A2
log4j.appender.LoudAppender=org.apache.log4j.RollingFileAppender
log4j.appender.LoudAppender.Threshold=DEBUG
log4j.appender.LoudAppender.File=loud.log
...

log4j.logger.com.yourpackage.yourclazz=TRACE 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-08T17:57:27.340

也许是这样的？

```
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">
<log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/">
 <!-- general application log -->
 <appender name="MainLogFile" class="org.apache.log4j.FileAppender">
  <param name="File" value="server.log" />
  <param name="Threshold" value="INFO" />
  <layout class="org.apache.log4j.PatternLayout">
   <param name="ConversionPattern" value="%-5p %t [%-40.40c] %x - %m%n"/>
  </layout>
 </appender> 
 <!-- additional fooSystem logging -->
 <appender name="FooLogFile" class="org.apache.log4j.FileAppender">
  <param name="File" value="foo.log" />
  <layout class="org.apache.log4j.PatternLayout">
   <param name="ConversionPattern" value="%-5p %t [%-40.40c] %x - %m%n"/>
  </layout>
 </appender>
 <!-- foo logging -->
 <logger name="com.example.foo">
  <level value="DEBUG"/>
  <appender-ref ref="FooLogFile"/>
 </logger>
 <!-- default logging -->
 <root>
  <level value="INFO"/>
  <appender-ref ref="MainLogFile"/>
 </root>
</log4j:configuration> 
```

因此，所有信息消息都写入 server.log；相比之下， foo.log 只包含 com.example.foo 消息，包括调试级别的消息。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-06T14:03:20.527

我有这个问题，但有一个转折 - 我试图将不同的内容记录到不同的文件中。我有关于 LowLevel 调试日志和 HighLevel 用户日志的信息。我希望 LowLevel 只去一个文件，而 HighLevel 去一个文件和一个 syslogd。

我的解决方案是配置 3 个附加程序，然后像这样设置日志记录：

```
log4j.threshold=ALL
log4j.rootLogger=,LowLogger

log4j.logger.HighLevel=ALL,Syslog,HighLogger
log4j.additivity.HighLevel=false 
```

我很难弄清楚的部分是“log4j.logger”可以列出多个附加程序。我试图一次做一行。

希望这可以在某个时候帮助某人！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-08T02:46:59.853

对于主日志文件/附加程序，设置一个`.Threshold = INFO`以将附加程序中实际记录的内容限制为 INFO 及以上，无论记录器是否启用了 DEBUG、TRACE 等。

至于捕捉 DEBUG 并且除此之外什么都没有……您可能必须编写一个自定义附加程序。

但是我建议不要这样做，因为这听起来会使故障排除和分析变得非常困难：

1.  如果您的目标是拥有一个可以查找故障的单个文件，那么跨不同文件的日志数据将很烦人 - 除非您有一个非常严格的日志记录策略，否则您可能需要来自 DEBUG 和 INFO 的内容能够有效地跟踪有问题的代码的执行。
2.  通过仍然记录所有调试消息，您将失去通常通过关闭日志记录（方式）在生产系统中获得的任何性能提升。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-02-01T14:24:01.257

演示链接：[https ://github.com/RazvanSebastian/spring_multiple_log_files_demo.git](https://github.com/RazvanSebastian/spring_multiple_log_files_demo.git)

我的解决方案基于 XML 配置，使用`spring-boot-starter-log4j`. 该示例是使用`spring-boot-starter`两个 Logger 写入不同日志文件的基本示例。

# python - 如何将html实体转换为符号？

> ID：728296
> 
> 赞同：0
> 
> 时间：2009-04-08T02:32:18.250
> 
> 标签：python, unicode, beautifulsoup, html-entities

我已经[根据这个答案对脚本](https://stackoverflow.com/questions/6936/using-what-ive-learned-from-stackoverflow-html-scraper/50772#50772)进行了一些修改。我遇到了 unicode 问题。有些问题最终写得不好。

一些答案和响应最终看起来像：

`Yeah.. I know.. I&#8217;m a simpleton.. So what&#8217;s a Singleton? (2)`

我怎样才能使`&#8217;`被翻译成正确的字符？

注意：如果这很重要，我在法式窗口上使用 python 2.6。

```
>>> sys.getdefaultencoding()
'ascii'
>>> sys.getfilesystemencoding()
'mbcs' 
```

* * *

**EDIT1：**根据 Ryan Ginstrom 的帖子，我已经能够更正部分输出，但我遇到了 python 的 unicode 问题。

在空闲/python shell 中：

> 是的.. 我知道.. 我是个傻子.. 那么单身人士呢？

在文本文件中，重定向标准输出时

> 是的..我知道..我是个傻瓜..那么什么是单例？

我该如何纠正？

* * *

**Edit2：**我已经尝试过 Jarret Hardie 的解决方案，但它没有做任何事情。我在 Windows 上，使用 python 2.6，所以我的站点包文件夹位于：

> C:\Python26\Lib\site-packages

没有 siteconfig.py 文件，所以我创建了一个，粘贴了 Jarret Hardie 提供的代码，启动了一个 python 解释器，但似乎还没有加载。

> > > sys.getdefaultencoding() 'ascii'

我注意到在以下位置有一个 site.py 文件：

> C:\Python26\Lib\site.py

我尝试更改函数中的编码

```
def setencoding():
    """Set the string encoding used by the Unicode implementation.  The
    default is 'ascii', but if you're willing to experiment, you can
    change this."""
    encoding = "ascii" # Default value set by _PyUnicode_Init()
    if 0:
        # Enable to support locale aware default string encodings.
        import locale
        loc = locale.getdefaultlocale()
        if loc[1]:
            encoding = loc[1]
    if 0:
        # Enable to switch off string to Unicode coercion and implicit
        # Unicode to string conversion.
        encoding = "undefined"
    if encoding != "ascii":
        # On Non-Unicode builds this will raise an AttributeError...
        sys.setdefaultencoding(encoding) # Needs Python Unicode build ! 
```

将编码设置为 utf-8。它起作用了（当然是在重新启动python之后）。

```
>>> sys.getdefaultencoding()
'utf-8' 
```

可悲的是，它没有纠正我程序中的字符。:(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T06:58:41.353

您应该能够将 HTMl/XML 实体转换为 Unicode 字符。在 SO 中查看这个答案：

[使用 Python 解码 HTML 实体](https://stackoverflow.com/questions/628332/decoding-html-entities-with-python)

基本上你想要这样的东西：

```
from BeautifulSoup import BeautifulStoneSoup

soup = BeautifulStoneSoup(urllib2.urlopen(URL),
                          convertEntities=BeautifulStoneSoup.ALL_ENTITIES) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T00:28:01.627

更改 siteconfig.py 中的默认编码是否有效？

在您的站点包文件（在我的 OS X 系统上`/Library/Python/2.5/site-packages/`）中，创建一个名为`siteconfig.py`. 在这个文件中放：

```
import sys
sys.setdefaultencoding('utf-8') 
```

一旦 siteconfig.py 被处理，setdefaultencoding 方法就会从 sys 模块中删除，因此您必须将它放在 site-packages 中，以便 Python 在解释器启动时读取它。

# c# - DataTable.RejectChanges() 和刷新表单文本框控件

> ID：728307
> 
> 赞同：0
> 
> 时间：2009-04-08T02:40:25.063
> 
> 标签：c#, datagridview

我正在研究 C# 中的框架理解。我有一个表单，表单上有简单的添加/编辑、保存/取消（和退出）按钮。表单有一个网格和一个绑定到它的数据表（数据表是表单上的一个字段，用于在表单的持续时间内保留范围）。

表单上还有 3 个简单的文本框控件绑定到`DataTable`. 当我滚动网格时，文本框详细信息会自动刷新......完美。

我的添加/取消协调工作正常，但编辑/取消失败。在以下方面失败。

我启动表单，网格显示 3 行（第 1 列是一个简单的“描述”）。第一行有一个值`Test`（因此在表单上显示了相应的绑定单个文本框控件）。我单击编辑按钮，现在可以更改单个文本框（不是数据网格）并将其更改为`Test changed value`.

所以，现在，我去单击“取消”按钮并希望以下...网格不会用新值更新，并且单个文本框控件会恢复到其原始`Test`值。

在 Cancel 按钮中，我发出一个`MyDataTable.RejectChanges()`，并且网格正确地保留了原始`Test`值，但文本框控件保留了`Test changed value`内容。当我`RejectChanges()`在添加/取消组合期间进行相同的调用时，一切正常。

为了在添加/取消过程中模拟类似的情况，我明确地将网格强制到数据表中的最后一个有效行，这反过来又更新了文本框......显然，在`MyDataGridView.CurrentRow`触发的调用/重新加载过程中做了一些事情看不见。由于它是一个编辑，我不会从表中删除一行（从“添加”临时），然后拒绝（删除），并通过`MyDataGridView.CurrentCell = [0, LastDataRowInDataTable]`.

任何想法都会很棒。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-07-27T17:18:34.547

在`Datetimepicker`调用. _ 通过调用控件的方法解决了。`Textbox``RejectChanges``ResetCurrentItem()``BindingSource`

# ruby - 十六进制转义问题

> ID：728308
> 
> 赞同：2
> 
> 时间：2009-04-08T02:41:00.990
> 
> 标签：ruby, escaping, hex

我需要使用 Ruby 将转义字符打印到二进制文件中。主要问题是斜杠需要整个字节才能正确转义，我不知道/不能以这种方式创建字节。

我正在创建十六进制值，基本上：

```
'\x' + char 
```

其中 char 是一些“十六进制”值，例如 65。在十六进制中，\x65 是 ASCII 字符“e”。

不幸的是，当我把这个序列放到文件中时，我得到了这样的结果：

```
\\x65 
```

如何创建具有正确转义值的十六进制字符串？我尝试了***很多***东西，包括单引号或双引号、打包、解包、多个斜杠等。我尝试了很多不同的组合，以至于我觉得我现在对问题的理解比开始时要少。

如何？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T18:58:17.600

您可能需要在文件上设置二进制模式，和/或使用 putc。

```
File.open("foo.tmp", "w") do |f|
  f.set_encoding(Encoding::BINARY) # set_encoding is Ruby 1.9  
  f.binmode                        # only useful on Windows
  f.putc "e".hex
end 
```

希望这可以给你一些想法，即使你有 Ruby <1.9。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T19:21:44.530

好的，如果你想创建一个第一个字节具有整数值的字符串`0x65`，请使用`Array#pack`

```
irb> [0x65].pack('U')
#=> "e"
irb> "e"[0]
#=> 101 
```

101 [10] = 65 [16]，所以这行得通。

如果要创建一个文字字符串，其第一个字节是'\'，第二个是'x'，第三个是'6'，第四个是'5'，那么只需使用插值：

```
irb> "\\x#{65}"
#=> "\\x65"
irb> "\\x65".split('')
#=> ["\\", "x", "6", "5"] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T02:55:14.480

如果您有十六进制值并且想要创建一个包含与该十六进制值对应的字符的字符串，您可以执行以下操作：

```
irb(main):002:0> '65'.hex.chr
=> "e" 
```

另一种选择是使用`Array#pack`; 如果您需要将数字列表转换为单个字符串，则可以使用它：

```
irb(main):003:0> ['65'.hex].pack("C")
=> "e"
irb(main):004:0> ['66', '6f', '6f'].map {|x| x.hex}.pack("C*")
=> "foo" 
```

# c - 在 Windows 中打印到控制台时需要回车吗？

> ID：728312
> 
> 赞同：2
> 
> 时间：2009-04-08T02:42:23.950
> 
> 标签：c, windows, carriage-return, linefeed

似乎只放一个换行就足够了，但我知道它应该是回车+换行。如果您不输入回车而只使用换行符，会发生什么可怕的事情吗？

这是在 ANSI C 中，不会被重定向到文件或其他任何东西。只是一个普通的控制台应用程序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T06:17:21.390

Windows 控制台遵循为文件假定的相同行结束约定，或者就实际的物理终端而言。它需要同时查看 CR 和 LF 才能正确移动到下一行。

也就是说，在 ANSI C 程序和那个控制台之间有很多软件基础设施。特别是，任何标准 C 库 I/O 函数都会尝试做正确的事情，假设您允许它有机会。这就是定义参数的`fopen()`'s`t`和`b`修饰符的原因。`mode`

使用`t`（大多数流的默认设置，尤其是`stdin`and `stdout`），任何`\n`打印的都将转换为 CRLF 序列，而读取则相反。要关闭该行为，请使用`b`修饰符。

顺便说一句，传统上连接到 *nix 盒子的终端，包括 XTerm 模拟的 DEC VT100，也需要 CR 和 LF。然而，在 *nix 世界中，从换行符到 CRLF 序列的转换是在 tty 设备驱动程序中处理的，因此大多数程序不需要知道它，并且`t`和`b`修饰符都被忽略了。在这些平台上，如果您需要在不进行修改的情况下在 tty 上发送和接收字符，则需要查找 stty(1) 或它所依赖的系统调用。

如果您的其他 ANSI C 程序正在避免 C 库 I/O 到控制台（可能是因为您需要访问控制台的字符颜色和其他属性），那么您是否需要发送 CR 将取决于您使用的 Win32 API 调用发送字符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T02:49:05.573

如果您在 *nix 环境中，\n（换行）可能没问题。如果您在 Windows 中并且没有（现在）重定向换行符也可以，但是如果有人在某个时候重定向，:-(

但是，如果您使用的是 Windows，则如果将输出重定向到文本文件然后另一个进程尝试使用数据，则可能会出现问题。

控制台知道要显示什么，但消费者可能不高兴......

如果您使用的是 C#，您可以尝试 Environment.NewLine“常量”。

[http://msdn.microsoft.com/en-us/library/system.environment.newline.aspx](http://msdn.microsoft.com/en-us/library/system.environment.newline.aspx)

如果你真的在 vanilla c 中，你会被 \r\n 困住。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T02:50:30.170

这取决于您使用它们的目的。如果您不同时放置`\r`和 ，某些程序将无法正确显示换行符`\n`。

如果您尝试仅编写`\n`一些使用您的文本文件（或输出）的程序，则可能会将您的文本显示为单行而不是多行。

还有一些文件格式和协议如果不同时使用`\r`和`\n`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T03:16:55.850

我已经很久没有尝试过了，以至于我不确定我是否记得发生了什么......但是换行符本身不会在不返回左列的情况下向下移动一行吗？

根据您的编译器，标准输出可能会以文本模式打开，在这种情况下，单个换行符将在被写出之前转换为 \r\n。

**编辑：**我刚刚尝试了快速测试，在 XP 中正常显示没有返回的文件。我仍然不知道是否有任何编译器为您插入返回值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T06:23:48.240

在 C 中，文件（称为“流”）有两种形式——二进制或文本。

这种区别的含义取决于实现/平台，但在 Windows（我见过的常见实现）上，当写入文本流时，'\n' 会自动转换为“\r\n”，并且在从文本中读取时流 "\r\n" 会自动转换为 '\n'。

“控制台”实际上是“标准输出”，是默认打开为文本流的流。因此，在 Windows 上的实践中，编写 "Hello, world!\n" 应该就足够了 - 并且可移植。

# c# - 发布版本中的 C# 命令行参数问题

> ID：728317
> 
> 赞同：0
> 
> 时间：2009-04-08T02:43:50.030
> 
> 标签：c#, .net, winforms

我有一个我自己无法解决的看似简单的问题。我有一个 WinForm 应用程序，修改了 main 方法以接受如下命令行参数：

```
 [STAThread]
    static void Main(String[] args)
    {
        int argCount = args.Length;
    } 
```

此代码工作正常，并且在调试模式下使用以下执行行编译时 argCount 等于 2：program.exe -file test.txt。但是，一旦我在发布模式下编译程序，argCount 现在是 1，具有相同的命令行参数。唯一的参数包含“-file test.txt”。不仅如此，只有当我从 obj/Release 文件夹运行编译的可执行文件时才会发生这种情况，而不是从 bin/Release 运行。不幸的是，安装项目从 obj/Release 获取可执行文件，所以我无法更改它。这是一个已知问题吗？有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T08:01:20.330

命令行处理应该是相同的，因此正在发生其他事情。当我尝试这个时：

```
class Program {
    [STAThread]
    static void Main(String[] args) {
        Console.WriteLine("Have {0} arguments", args.Length);
        for (int i = 0; i < args.Length; ++i) {
            Console.WriteLine("{0}: {1}", i, args[i]);
        }
    }
} 
```

然后它从各个位置得到 100% 一致的结果，获得“合并”参数的唯一方法是在命令行上将它们括在引号中（专门用于让您确实有包含空格的参数，请参阅下面的最后一个例子）：

```
PS C:\...\bin\Debug> .\ConsoleApplication1.exe 一二三
有 3 个参数
0：一
1：两个
2：三个
PS C:\...\bin\Debug> pushd ..\release
PS C:\...\bin\Release> .\ConsoleApplication1.exe 一二三
有 3 个参数
0：一
1：两个
2：三个
PS C:\...\bin\Release> pushd ..\..\obj\debug
PS C:\...\obj\Debug> .\ConsoleApplication1.exe 一二三
有 3 个参数
0：一
1：两个
2：三个
PS C:\...\obj\Debug> pushd ..\release
PS C:\...\obj\Release> .\ConsoleApplication1.exe 一二三
有 3 个参数
0：一
1：两个
2：三个
PS C:\...\obj\Release> .\ConsoleApplication1.exe -file test.txt
有 2 个论据
0：-文件
1：测试.txt
PS C:\...\obj\Release> .\ConsoleApplication1.exe "-file test.txt"
有 1 个参数
0：-文件 test.txt

```

*附加*虽然从命令提示符启动可以很容易地查看正在传递的内容，但很难检查另一个应用程序何时启动您的应用程序。然而，像[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx "系统内部")这样的工具将显示用于启动程序的命令行（双击进程并查看图像选项卡）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T15:32:08.763

这适用于 bin/Debug、bin/Release、obj/Debug 和 obj/Release：

```
static class Program {
  /// <summary>
  /// The main entry point for the application.
  /// </summary>
  [STAThread]
  static void Main(string[] args) {
    FormMain.Args = args;

    Application.EnableVisualStyles();
    Application.SetCompatibleTextRenderingDefault(false);
    Application.Run(new FormMain());
  }
}

  public partial class FormMain: Form {
    public static string[] Args;

    public FormMain() {
      InitializeComponent();
    }

    private void FormMain_Shown(object sender, EventArgs e) {
      foreach (string s in Args) {
        MessageBox.Show(s);
      }
    }
  } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T02:47:48.663

您是否尝试过[Environment.GetCommandLineArgs()](http://msdn.microsoft.com/en-us/library/system.environment.getcommandlineargs.aspx)？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T15:41:48.600

您的问题（正如理查德在他的代码中指出的那样）是您在运行发布版本时的参数都包含在一组引号中。删除引号，它将起作用。

# c# - Linq OrderBy 针对特定值

> ID：728319
> 
> 赞同：51
> 
> 时间：2009-04-08T02:44:36.987
> 
> 标签：c#, linq, linq-to-objects

Linq 中有没有办法在不知道值顺序的情况下对一组值（在这种情况下为字符串）执行 OrderBy？

考虑以下数据：

```
A
B
A
C
B
C
D
E 
```

还有这些变量：

字符串 firstPref，secondPref，thirdPref；

当值设置如下：

```
firstPref = 'A';
secondPref = 'B';
thirdPref = 'C'; 
```

是否可以像这样订购数据：

```
A
A
B
B
C
C
D
E 
```

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2009-04-08T02:55:30.847

如果您将偏好放入列表中，它可能会变得更容易。

```
List<String> data = new List<String> { "A","B","A","C","B","C","D","E" };
List<String> preferences = new List<String> { "A","B","C" };

IEnumerable<String> orderedData = data.OrderBy(
   item => preferences.IndexOf(item)); 
```

这将把所有没有出现`preferences`在前面的项目，因为`IndexOf()`返回`-1`。临时解决方法可能是反转`preferences`并按降序排列结果。这变得非常丑陋，但有效。

```
IEnumerable<String> orderedData = data.OrderByDescending(
   item => Enumerable.Reverse(preferences).ToList().IndexOf(item)); 
```

如果你 concat`preferences`和`data`.

```
IEnumerable<String> orderedData = data.OrderBy(
   item => preferences.Concat(data).ToList().IndexOf(item)); 
```

我不喜欢在`Concat()`里面`ToList()`。但目前我没有很好的解决方法。我正在寻找一个很好的技巧来把`-1`第一个例子变成一个大数字。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2016-05-18T08:27:04.463

除了@Daniel Brückner在其末尾定义的[答案](https://stackoverflow.com/a/728353)和问题：

> 我不喜欢里面的 Concat() 和 ToList() 。但目前我没有真正>好的解决方法。我正在寻找一个很好的技巧来将第一个 >example 的 -1 变成一个大数字。

我认为解决方案是使用语句 lambda 而不是表达式 lambda。

```
var data = new List<string> { "corge", "baz", "foo", "bar", "qux", "quux" };
var fixedOrder = new List<string> { "foo", "bar", "baz" };
data.OrderBy(d => {
                    var index = fixedOrder.IndexOf(d);
                    return index == -1 ? int.MaxValue : index; 
                  }); 
```

有序数据为：

```
foo 
bar 
baz 
corge 
qux 
quux 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-08T07:42:47.253

将首选值放入字典中。在字典中查找键是 O(1) 操作，而在列表中查找值是 O(n) 操作，因此它的扩展性要好得多。

为每个首选值创建一个排序字符串，以便将它们放在其他值之前。对于其他值，值本身将用作排序字符串，以便它们实际排序。（使用任意高值只会将它们放在未排序的列表末尾）。

```
List<string> data = new List<string> {
    "E", "B", "D", "A", "C", "B", "A", "C"
};
var preferences = new Dictionary<string, string> {
    { "A", " 01" },
    { "B", " 02" },
    { "C", " 03" }
};

string key;
IEnumerable<String> orderedData = data.OrderBy(
    item => preferences.TryGetValue(item, out key) ? key : item
); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-07-12T11:00:05.273

将所有答案（以及更多）组合到一个通用的 LINQ 扩展中，该扩展支持处理任何数据类型的缓存，可以不区分大小写，并允许与前后排序链接：

```
public static class SortBySample
{
    public static BySampleSorter<TKey> Create<TKey>(IEnumerable<TKey> fixedOrder, IEqualityComparer<TKey> comparer = null)
    {
        return new BySampleSorter<TKey>(fixedOrder, comparer);
    }

    public static BySampleSorter<TKey> Create<TKey>(IEqualityComparer<TKey> comparer, params TKey[] fixedOrder)
    {
        return new BySampleSorter<TKey>(fixedOrder, comparer);
    }

    public static IOrderedEnumerable<TSource> OrderBySample<TSource, TKey>(this IEnumerable<TSource> source, Func<TSource, TKey> keySelector, BySampleSorter<TKey> sample)
    {
        return sample.OrderBySample(source, keySelector);
    }

    public static IOrderedEnumerable<TSource> ThenBySample<TSource, TKey>(this IOrderedEnumerable<TSource> source, Func<TSource, TKey> keySelector, BySampleSorter<TKey> sample)
    {
        return sample.ThenBySample(source, keySelector);
    }
}

public class BySampleSorter<TKey>
{
    private readonly Dictionary<TKey, int> dict;

    public BySampleSorter(IEnumerable<TKey> fixedOrder, IEqualityComparer<TKey> comparer = null)
    {
        this.dict = fixedOrder
            .Select((key, index) => new KeyValuePair<TKey, int>(key, index))
            .ToDictionary(kv => kv.Key, kv => kv.Value, comparer ?? EqualityComparer<TKey>.Default);
    }

    public BySampleSorter(IEqualityComparer<TKey> comparer, params TKey[] fixedOrder)
        : this(fixedOrder, comparer)
    {
    }

    public IOrderedEnumerable<TSource> OrderBySample<TSource>(IEnumerable<TSource> source, Func<TSource, TKey> keySelector)
    {
        return source.OrderBy(item => this.GetOrderKey(keySelector(item)));
    }

    public IOrderedEnumerable<TSource> ThenBySample<TSource>(IOrderedEnumerable<TSource> source, Func<TSource, TKey> keySelector)
    {
        return source.CreateOrderedEnumerable(item => this.GetOrderKey(keySelector(item)), Comparer<int>.Default, false);
    }

    private int GetOrderKey(TKey key)
    {
        int index;
        return dict.TryGetValue(key, out index) ? index : int.MaxValue;
    }
} 
```

使用 LINQPad-Dump() 的示例用法：

```
var sample = SortBySample.Create(StringComparer.OrdinalIgnoreCase, "one", "two", "three", "four");
var unsorted = new[] {"seven", "six", "five", "four", "THREE", "tWo", "One", "zero"};
unsorted
    .OrderBySample(x => x, sample)
    .ThenBy(x => x)
    .Dump("sorted by sample then by content");
unsorted
    .OrderBy(x => x.Length)
    .ThenBySample(x => x, sample)
    .Dump("sorted by length then by sample"); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-08T03:22:37.723

Danbrucs 解决方案更优雅，但这里有一个使用自定义 IComparer 的解决方案。如果您需要更高级的排序条件，这可能会很有用。

```
 string[] svals = new string[] {"A", "B", "A", "C", "B", "C", "D", "E"};
    List<string> list = svals.OrderBy(a => a, new CustomComparer()).ToList();

    private class CustomComparer : IComparer<string>
    {
        private string firstPref = "A";
        private string secondPref = "B";
        private string thirdPref = "C";
        public int Compare(string x, string y)
        {
            // first pref 
            if (y == firstPref && x == firstPref)
                return 0;
            else if (x == firstPref && y != firstPref)
                return -1;
            else if (y == firstPref && x != firstPref)
                return 1;
            // second pref
            else if (y == secondPref && x == secondPref)
                return 0;
            else if (x == secondPref && y != secondPref)
                return -1;
            else if (y == secondPref && x != secondPref)
                return 1;
            // third pref
            else if (y == thirdPref && x == thirdPref)
                return 0;
            else if (x == thirdPref && y != thirdPref)
                return -1;
            else
                return string.Compare(x, y);
        }
    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T02:50:36.053

是的，您必须实现自己的`IComparer<string>`，然后将其作为 LINQ 的 OrderBy 方法的第二个参数传入。

可以在这里找到一个示例： [订购 LINQ 结果](http://srtsolutions.com/blogs/billwagner/archive/2006/03/29/ordering-linq-results.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-10-03T22:30:13.747

对于大型列表不是很有效，但相当容易阅读：

```
public class FixedOrderComparer<T> : IComparer<T>
{
    private readonly T[] fixedOrderItems;

    public FixedOrderComparer(params T[] fixedOrderItems)
    {
        this.fixedOrderItems = fixedOrderItems;
    }

    public int Compare(T x, T y)
    {
        var xIndex = Array.IndexOf(fixedOrderItems, x);
        var yIndex = Array.IndexOf(fixedOrderItems, y);
        xIndex = xIndex == -1 ? int.MaxValue : xIndex;
        yIndex = yIndex == -1 ? int.MaxValue : yIndex;
        return xIndex.CompareTo(yIndex);
    }
} 
```

用法：

```
var orderedData = data.OrderBy(x => x, new FixedOrderComparer<string>("A", "B", "C")); 
```

注意：`Array.IndexOf<T>(....)`用于`EqualityComparer<T>.Default`查找目标索引。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-03-31T19:36:26.807

我用这些。我喜欢 IEnumerable 重载的清洁度，但优先级映射版本在重复调用时应该有更好的性能。

```
 public static IEnumerable<T> OrderByStaticList<T>(this IEnumerable<T> items, IReadOnlyDictionary<T, double> priorityMap)
    {
        return items.OrderBy(x => priorityMap.GetValueOrDefault(x, double.MaxValue));
    }

    public static IEnumerable<T> OrderByStaticList<T>(this IEnumerable<T> items, IEnumerable<T> preferenceOrder)
    {
        int priority = 0;
        var priorityMap = preferenceOrder.ToDictionary(x => x, x => (double) priority++);
        return OrderByStaticList(items, priorityMap);
    }

    [TestMethod]
    public void PriorityMap_DeterminesSort()
    {
        var map = new Dictionary<char, double>()
        {
            {'A', 1},
            {'B', 7},
            {'C', 3},
            {'D', 42},
            {'E', -1},
        };
        Assert.AreEqual("EACBD", new string("ABCDE".OrderByStaticList(map).ToArray()));
    }

    [TestMethod]
    public void PriorityMapMissingItem_SortsLast()
    {
        var map = new Dictionary<char, double>()
        {
            {'A', 1},
            {'B', 7},
            {'D', 42},
            {'E', -1},
        };
        Assert.AreEqual("EABDC", new string("ABCDE".OrderByStaticList(map).ToArray()));
    }

    [TestMethod]
    public void OrderedList_DeterminesSort()
    {
        Assert.AreEqual("EACBD", new string("ABCDE".OrderByStaticList("EACBD").ToArray()));
    }

    [TestMethod]
    public void OrderedListMissingItem_SortsLast()
    {
        Assert.AreEqual("EABDC", new string("ABCDE".OrderByStaticList("EABD").ToArray()));
    } 
```

# visual-c++ - 用 Visual C++ 编写的最大的开源项目是什么？

> ID：728320
> 
> 赞同：2
> 
> 时间：2009-04-08T02:44:53.007
> 
> 标签：visual-c++, open-source

用 Visual C++ 编写的最大的开源项目是什么？

我可以看到电骡项目很大，但最大的是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T02:53:40.773

我认为您会发现一些最大的软件是一些开源游戏引擎，例如 Ogre3D：[http](http://www.ogre3d.org/) ://www.ogre3d.org/ 或 Irrlicht：http: [//irrlicht.sourceforge.net/](http://irrlicht.sourceforge.net/)

如果您想深入了解一些东西，这些是几个相当大的开源项目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T03:10:37.737

Panda3d 是另一种用 c++ 编写的（尽管它更好地与基于 python 的 API 一起使用）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T08:50:33.083

Google Chrome是用 Visual C++[构建的。](http://dev.chromium.org/developers/how-tos/build-instructions-windows)[根据 Ohloh](https://www.ohloh.net/p/chrome/analyses/latest)的说法，它有 2-3M 行代码，但我不知道这是否是一个准确的数字。

# latex - 大文档中的三列框架并在乳胶中重命名内容

> ID：728323
> 
> 赞同：1
> 
> 时间：2009-04-08T02:45:41.757
> 
> 标签：latex

我只是在学习乳胶，所以这对你们中的一些人来说可能是微不足道的。我浏览了一些教程，但它们似乎都涵盖了相同的内容。

我正在写一份大报告 - 一路计算（它必须整洁，因为它是文档的一部分）。它由页面周围的框架（15 毫米边距）和其中的 3 列组成：左列（3 厘米宽）是方程式来源的引用（例如“ABS 3-2-7”），中间是是计算，右边是可接受的值（5 厘米宽）。这是一种标准的做事方式，所以我无法选择布局。

现在，我不明白，我将如何创建这样的布局？带有列的框架必须出现在每一页上。如何做到这一点？我从未见过这样的文档，所以我不确定如何简化创建过程。

其次，如何重命名文档类中的英文内容？例如，“文章”类，我有“参考文献”，我需要有“文学”。有没有办法在不接触 .cls 文件的情况下重命名它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T03:00:36.107

对于您的第一个问题，请查看 longtable 包（如果尚未安装，请访问[ctan.org ）](http://tug.ctan.org/cgi-bin/ctanPackageInformation.py?id=longtable)

使用表格的问题是它不能像你想要的那样跨页面工作。

至于第二个问题，它取决于环境和文档类型，但通常您必须更新命令。

例如，将文章类添加到序言 \renewcommand\refname{Literatura} 以执行您所要求的操作。如果我没记错的话，它是书籍的 bibname。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T06:46:59.557

LaTeX 中的表格设计并不是很容易。我会使用`tabbing`而不是`tabular`手动绘制线条以保持简单。一个缺点是您不会自动调整表格单元格的大小，但是由于您的格式是固定的，我认为这是一件好事（即，如果文本溢出，您会注意到它并自己修复它，而您的表不会意外拉伸到边缘）。如果您在文档中使用多个这样的表格，请尝试使用`\newenvironment`.

```
\documentclass{article}
\usepackage[margin=15mm]{geometry}
\usepackage{amsmath}
\usepackage{calc}

\newlength{\tableheight}
\setlength{\tableheight}{20cm}  % how high to draw the lines of the table
\newlength{\rulethickness}
\setlength{\rulethickness}{1pt} % how thick lines to draw
\newcommand{\verticalline}{\smash{\rule[-\tableheight]{\rulethickness}{\tableheight}}}
\newlength{\myindent}
\setlength{\myindent}{3mm}      % how much to indent each column
\newlength{\leftcolumn}
\setlength{\leftcolumn}{3cm-\myindent}
\newlength{\midcolumn}
\setlength{\midcolumn}{\textwidth-3cm-5cm-\myindent-\rulethickness}
\newlength{\rightcolumn}
\setlength{\rightcolumn}{5cm-\myindent}

\begin{document}
\begin{tabbing}
  % first set the tab stops
  \hspace*{\myindent}\=\hspace{\leftcolumn}\=%
  \hspace{\myindent}\=\hspace{\midcolumn}\=%
  \hspace{\myindent}\=\hspace{\rightcolumn}\=\kill
  % then draw the lines
  \rule{\textwidth}{\rulethickness}\\[-\baselineskip]
  \smash{\rule[-\tableheight]{\textwidth}{\rulethickness}}\\[-\baselineskip]
  \verticalline\>\>\verticalline\>\>\verticalline\>\>\verticalline\\
  % Now start the table: indent the first column with \>
  \>ABS 3--2--7 
  % ... and each additional column with \>\>
  \>\> $\iint_{-\infty,-\infty}^{\infty,\infty} e^{-x^2-y^2}\, dx\,dy$ 
  \>\> 2.507 
  % End each line with \\, add e.g. [2pt] to get 2pt extra space if required
  \\[2pt]
  % here's another line:
  \>ABS 3--2--8 \>\> $\displaystyle\sum_{k=0}^n k^2$ \>\> $\frac12 n(n+1)$ \\
  % etc. Be careful not to overflow the table - there's no automatic check for that.
\end{tabbing}

\newpage % also remember to start a new page after the table

\end{document} 
```

要更改固定名称，请参阅[此常见问题解答](http://www.tex.ac.uk/cgi-bin/texfaq2html?label=fixnam)，或者[如果](http://www.tex.ac.uk/cgi-bin/texfaq2html?label=latexwords)您使用`babel`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T02:51:01.607

在这种情况下，您可能希望使用`tabular`环境来生成三列（或者如果您的报告内容运行时间超过一页，则[作为 simon 注释）。](https://stackoverflow.com/questions/728323/three-columns-frame-in-a-big-document-and-renaming-stuff-in-latex/728357#728357) `longtable`就像是：

```
\framebox{
  \centering
  \begin{tabular}{p{3cm}|p{\specialwidth}|p{5cm}}
  Ref 1-0-0 & 1.2345 & 1.2346 \\
  Ref 1-0-1 & 2.3456 & 2.3454 \\
  ...
  \end{tabular}
} 
```

您会注意到我使用了段落格式的列（`p{<length>}`格式说明符），并用`\framebox`.

您可以`\specialwidth`手动计算，也可以计算：

```
\newlength{\specialwidth}
\setlength{\specialwidth}{\textwidth}
\addtolength{\specialwidth}{-10cm} % extra room for the seperators... 
```

在国际化问题上我帮不了你...

# php - 使用 PHPMailer 向 SMTP 发送电子邮件时出现问题

> ID：728324
> 
> 赞同：1
> 
> 时间：2009-04-08T02:45:48.777
> 
> 标签：php, smtp, debian, phpmailer

尝试通过 Exchange 服务器发送消息时收到以下错误日志：

```
SMTP -> get_lines(): $data was "" 
SMTP -> get_lines(): $str is "220 mail.borschow.com Microsoft ESMTP MAIL Service, Version: 6.0.3790.1830 ready at Tue, 7 Apr 2009 21:56:53 -0400 " 
SMTP -> get_lines(): $data is "220 mail.borschow.com Microsoft ESMTP MAIL Service, Version: 6.0.3790.1830 ready at Tue, 7 Apr 2009 21:56:53 -0400 " 
SMTP -> FROM SERVER: 220 mail.borschow.com Microsoft ESMTP MAIL Service, Version: 6.0.3790.1830 ready at Tue, 7 Apr 2009 21:56:53 -0400 
SMTP -> get_lines(): $data was "" 
SMTP -> get_lines(): $str is "250-mail.borschow.com Hello [10.0.254.231] " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] " 
SMTP -> get_lines(): $str is "250-TURN " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN " 
SMTP -> get_lines(): $str is "250-SIZE " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE " 
SMTP -> get_lines(): $str is "250-ETRN " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN " 
SMTP -> get_lines(): $str is "250-PIPELINING " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING " 
SMTP -> get_lines(): $str is "250-DSN " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN " 
SMTP -> get_lines(): $str is "250-ENHANCEDSTATUSCODES " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES " 
SMTP -> get_lines(): $str is "250-8bitmime " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime " 
SMTP -> get_lines(): $str is "250-BINARYMIME " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME " 
SMTP -> get_lines(): $str is "250-CHUNKING " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME 250-CHUNKING " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME 250-CHUNKING " 
SMTP -> get_lines(): $str is "250-VRFY " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME 250-CHUNKING 250-VRFY " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME 250-CHUNKING 250-VRFY " 
SMTP -> get_lines(): $str is "250-X-LINK2STATE " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME 250-CHUNKING 250-VRFY 250-X-LINK2STATE " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME 250-CHUNKING 250-VRFY 250-X-LINK2STATE " 
SMTP -> get_lines(): $str is "250-XEXCH50 " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME 250-CHUNKING 250-VRFY 250-X-LINK2STATE 250-XEXCH50 " 
SMTP -> get_lines(): $data was "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME 250-CHUNKING 250-VRFY 250-X-LINK2STATE 250-XEXCH50 " 
SMTP -> get_lines(): $str is "250 OK " 
SMTP -> get_lines(): $data is "250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME 250-CHUNKING 250-VRFY 250-X-LINK2STATE 250-XEXCH50 250 OK " 
SMTP -> FROM SERVER: 250-mail.borschow.com Hello [10.0.254.231] 250-TURN 250-SIZE 250-ETRN 250-PIPELINING 250-DSN 250-ENHANCEDSTATUSCODES 250-8bitmime 250-BINARYMIME 250-CHUNKING 250-VRFY 250-X-LINK2STATE 250-XEXCH50 250 OK 
SMTP -> get_lines(): $data was "" 
SMTP -> get_lines(): $str is "504 5.7.4 Unrecognized authentication type. " 
SMTP -> get_lines(): $data is "504 5.7.4 Unrecognized authentication type. " 
SMTP -> ERROR: AUTH not accepted from server: 504 5.7.4 Unrecognized authentication type. 
SMTP -> get_lines(): $data was "" 
SMTP -> get_lines(): $str is "250 2.0.0 Resetting " 
SMTP -> get_lines(): $data is "250 2.0.0 Resetting " 
SMTP -> FROM SERVER: 250 2.0.0 Resetting 
```

## 笔记

*   我已经尝试使用我分配的用户/密码，但管理员说发送时甚至不需要使用用户/密码。所以我也尝试不使用它，但没有成功。
*   我什至尝试使用**smtp.gmail.com**

## 更新（2009 年 4 月 16 日）

好的，我发现了我的问题。

我正在使用一个 SMTP 服务器，它允许在没有身份验证的情况下发送消息。因此我从我的代码中删除了登录名和密码。但我忘记将“使用身份验证”标志设置为 false。现在它正在工作。

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T03:04:24.320

```
SMTP -> get_lines(): $str is "504 5.7.4 Unrecognized authentication type. " 
SMTP -> get_lines(): $data is "504 5.7.4 Unrecognized authentication type. " 
SMTP -> ERROR: AUTH not accepted from server: 504 5.7.4 Unrecognized authentication type. 
```

您使用的是什么身份验证。我认为这是造成问题的原因。在此处发布代码，以便我们提供更多帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T03:02:51.920

请记住，Gmail 需要 SSL 进行连接，而且它们不使用标准 SMTP 端口。如果您使用的是旧版本的 phpMailer，您需要进行一些修改以使其正常工作。

[这里有一个页面可以帮助你](http://deepakssn.blogspot.com/2006/06/gmail-php-send-email-using-php-with.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-28T21:24:34.970

尝试添加这个：

```
$mail->SMTPAuth   = true;

$mail->SMTPSecure = "tls"; 
```

如今，许多 SMTP 服务器都需要 TLS。

# c# - 可以从 C DLL 调用 C# DLL 吗？

> ID：728325
> 
> 赞同：8
> 
> 时间：2009-04-08T02:45:55.457
> 
> 标签：c#, .net, c++, dll, cross-platform

我已经用 C# 构建了一个 DLL。现在我想使用[R 环境](http://www.r-project.org/)来调用该 DLL 中的函数。R 环境支持调用非托管 C/C++ DLL，但不支持调用 .NET DLL。所以我的问题是，我可以从 C/C++ DLL 调用 C# DLL 中的函数吗？如果是这样，您是否有指向有关如何执行此操作的信息的链接？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-08T02:48:27.057

执行此操作的最直接方法是将 C# DLL 中的 C# 类之一公开为 COM 对象，然后从 C/C++ DLL 创建它的实例。如果这不是一个可接受的选项，您需要创建一个混合模式 C++ DLL（其中包含托管和非托管代码）。您的 C/C++ DLL 可以调用混合模式 DLL 中的导出函数，而后者又可以将调用转发给您的 C# 类。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T02:51:57.110

这篇文章可能会帮助你：

[CLR 托管 API (MSDN)](http://msdn.microsoft.com/en-us/magazine/cc163567.aspx)

**更新：**有一个名为[mergebin](http://sqlite-dotnet2.cvs.sourceforge.net/viewvc/sqlite-dotnet2/SQLite.NET/tools/mergebin/)的工具随[.NET SQLite 包装器](http://sqlite.phxsoftware.com/)一起提供，您可以使用它来创建混合模式的本机/托管 DLL。从以下位置获取源代码：

[ADO.NET 2.0 的 SQLite (SourceForge)](http://sourceforge.net/project/showfiles.php?group_id=132486&package_id=145568)

您将在`bin\tools`文件夹中找到 exe。

凯夫

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-04-24T19:10:53.747

这实际上很容易。只需使用 NuGet 将“UnmanagedExports”包添加到您的 .Net 项目。有关详细信息，请参阅[https://sites.google.com/site/robertgiesecke/Home/uploads/unmanagedexports](https://sites.google.com/site/robertgiesecke/Home/uploads/unmanagedexports)。

然后，您可以直接导出，而无需执行 COM 层。这是示例 C# 代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;
using RGiesecke.DllExport;

class Test
{
    [DllExport("add", CallingConvention = CallingConvention.Cdecl)]
    public static int TestExport(int left, int right)
    {
        return left + right;
    }
} 
```

R 应该能够像常规 C dll 一样加载 TextExport。

# javascript - 为什么我的网站在 IE7 中在淡入另一个淡入淡出的页面时崩溃？

> ID：728338
> 
> 赞同：1
> 
> 时间：2009-04-08T02:50:15.850
> 
> 标签：javascript, jquery, internet-explorer, crash

请看**[http://www.idea-palette.com](http://www.idea-palette.com)**

我有多个页面正在使用顶部导航淡化。当用户使用 jQuery Cycle 插件单击上述任何按钮以淡入包含幻灯片的另一个页面时，IE7 崩溃。

当我注释掉控制幻灯片淡入淡出的 jQuery 时，IE7 不再崩溃。你可以在这里看到：**[http ://www.idea-palette.com/IEindex.php](http://www.idea-palette.com/IEindex.php)**

我猜 IE7 不喜欢它淡入淡出的某些内容，其中包含一些其他内容已经在淡出的过程中。我猜这两者以某种方式使 IE7 过载，所以它崩溃了。

在我发现 jQuery Cycle Plugin 导致页面崩溃之前，我询问了为什么会这样（[为什么我的网站在 IE 中崩溃？](https://stackoverflow.com/questions/723823/why-does-my-website-crash-in-ie)），stackoverflow 上的 jeffamaphone 在查看我的网站时发现了以下信息：

'它与你的 DirectX 过滤器有关（可能是什么在做淡入淡出）。这是堆栈，EAX 为 NULL。无论代码在做什么都是试图取消 EAX：

> CDXTFilterBehavior::_ClearSurface: 6C8E87E1 mov edi,edi 6C8E87E3 push ebp
> 6C8E87E4 mov ebp,esp 6C8E87E6 push ecx
> 6C8E87E7 mov eax,dword ptr [ebp+0Ch] 6C8E87EA mov ecx,dword ptr [eax] <--- EAX 为 NULL
> 
> dxtrans.dll!CDXTFilterBehavior::_ClearSurface()
> dxtrans.dll!CDXTFilterBehavior::_DrawUnfilteredElementLayers()
> dxtrans.dll!CDXTFilterBehavior::_DrawElementWithProceduralSurfaces()
> dxtrans.dll!CDXTFilterBehavior::_ExecuteFilterChain()
> dxtrans.dll!CDXTFilterBehavior::Draw()
> mshtml.dll!CPeerHolder::Draw()
> mshtml.dll!CLayout::DrawClientLayers()
> mshtml.dll!CDispContainer::DrawSelf()
> mshtml.dll!CDispNode::Draw()
> mshtml.dll!CDispContainer::DrawChildren()
> mshtml.dll!CDispContainer::DrawSelf()
> mshtml.dll!CDispNode::Draw()
> mshtml.dll!CDispContainer::DrawChildren()
> mshtml.dll!CDispContainer::DrawSelf()
> mshtml.dll!CDispNode::Draw()
> mshtml.dll!CDispContainer::DrawChildren()
> mshtml.dll!CDispContainer::DrawSelf()
> mshtml.dll!CDispNode::Draw()
> mshtml.dll!CDispContainer::DrawChildren()
> mshtml.dll!CDispContainer::DrawSelf()
> mshtml.dll!CDispNode::Draw()
> mshtml.dll!CDispContainer::DrawChildren()
> mshtml.dll!CDispContainer::DrawSelf()
> mshtml.dll!CDispNode::Draw()
> mshtml.dll!CDispRoot::DrawEntire()
> mshtml.dll!CDispRoot::DrawRoot()
> mshtml.dll!CView::RenderView()
> mshtml.dll!CDoc::OnPaint()
> mshtml.dll!CServer::OnWindowMessage()
> mshtml.dll!CDoc::OnWindowMessage()
> mshtml.dll!CServer::WndProc()
> user32.dll!_InternalCallWinProc@20()
> user32.dll!_UserCallWinProcCheckWow@32()
> user32.dll!_CallWindowProcAorW@24()
> user32.dll!_CallWindowProcW@20()
> user32.dll！ _InternalCallWinProc@20()
> user32.dll!_UserCallWinProcCheckWow@32()
> user32.dll!_DispatchClientMessage@20()
> user32.dll!_fnDWORD@4()
> ntdll.dll!_KiUserCallbackDispatcher@12()
> user32.dll!_NtUserDispatchMessage@4()
> user32.dll!_DispatchMessageWorker@8()
> user32.dll!_DispatchMessageW@4()
> ieframe.dll!CTabWindow::_TabWindowThreadProc()
> kernel32.dll!@BaseThreadInitThunk@12()
> ntdll.dll!_RtlUserThreadStart@8()
> ntdll.dll!_RtlUserThreadStart@8()

也许您正在从 DOM 中删除一个元素，而转换仍在对其进行操作？

有人知道我该如何解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T04:24:00.383

正如我在您上次发布此内容时的评论中提到的，如果您可以远程使 IE 崩溃，您应该[联系 Microsoft](http://support.microsoft.com/gp/contactbug/)。此漏洞至少可导致拒绝服务攻击，并可能导致远程代码执行或远程 root（使网页按需崩溃浏览器的错误很可能被利用以允许攻击者运行不受信任的代码在您的机器上）。虽然这里的人可能能够帮助您解决您的问题，但确实应该通知 Microsoft，以便他们可以修复潜在的错误。

**编辑**：为了尝试解决您自己的问题，以及为了报告错误，您应该尝试将问题减少到最小的测试用例。将所有内容剥离为足以重现错误的最小元素集。然后对代码执行相同的操作。你应该努力得到一个只有一两个图像的测试用例，只有触发问题的交叉淡入淡出，没有其他东西。

然后，是的，要报告错误，请向他们发送指向您的最小测试用例的链接（或者如果可以的话，将其包含在错误报告中）。提到它是一个远程拒绝服务漏洞，你不知道它是否会导致远程代码执行。

正如我所提到的，将其缩减为一个最小的示例应该能够帮助您解决您的错误。至少，你更有可能在这里获得关于最小代码示例的帮助，而不是整个网站，其中有很多东西正在发生，没有人真正喜欢挖掘。

# python - 在 Tkinter 中动态创建菜单。（lambda 表达式？）

> ID：728356
> 
> 赞同：6
> 
> 时间：2009-04-08T02:59:40.257
> 
> 标签：python, lambda, copy, tkinter

我有一个菜单按钮，单击它时应显示一个包含特定字符串序列的菜单。那个序列中到底是什么字符串，直到运行时我们才知道，所以弹出的菜单必须在那一刻生成。这是我所拥有的：

```
class para_frame(Frame):
    def __init__(self, para=None, *args, **kwargs):
        # ...

        # menu button for adding tags that already exist in other para's
        self.add_tag_mb = Menubutton(self, text='Add tags...')

        # this menu needs to re-create itself every time it's clicked
        self.add_tag_menu = Menu(self.add_tag_mb,
                                 tearoff=0,
                                 postcommand = self.build_add_tag_menu)

        self.add_tag_mb['menu'] = self.add_tag_menu

    # ...

    def build_add_tag_menu(self):
        self.add_tag_menu.delete(0, END) # clear whatever was in the menu before

        all_tags = self.get_article().all_tags()
        # we don't want the menu to include tags that already in this para
        menu_tags = [tag for tag in all_tags if tag not in self.para.tags]

        if menu_tags:
            for tag in menu_tags:
                def new_command():
                    self.add_tag(tag)

                self.add_tag_menu.add_command(label = tag,
                                              command = new_command)
        else:
            self.add_tag_menu.add_command(label = "<No tags>") 
```

重要的部分是“if menu_tags:”下的内容——假设 menu_tags 是列表 ['stack', 'over', 'flow']。那么我想要做的实际上是这样的：

```
self.add_tag_menu.add_command(label = 'stack', command = add_tag_stack)
self.add_tag_menu.add_command(label = 'over', command = add_tag_over)
self.add_tag_menu.add_command(label = 'flow', command = add_tag_flow) 
```

其中 add_tag_stack() 定义为：

```
def add_tag_stack():
    self.add_tag('stack') 
```

等等。

问题是，变量 'tag' 取值 'stack' 然后取值 'over' 等等，直到调用 new_command 时才会计算它，此时变量 'tag' 只是 '流动'。因此，无论用户单击什么，添加的标签始终是菜单上的最后一个标签。

我最初使用的是 lambda，我想也许像上面那样明确定义函数可能会更好。无论哪种方式都会出现问题。我尝试使用变量“tag”的副本（使用“current_tag = tag”或使用复制模块），但这并不能解决问题。我不确定为什么。

我的思绪开始徘徊在“eval”之类的东西上，但我希望有人能想出一个不涉及如此可怕事情的聪明方法。

非常感谢！

（如果相关，Tkinter.__version__ 返回 '$Revision: 67083 $' 并且我在 Windows XP 上使用 Python 2.6.1。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T03:38:40.070

首先，您的问题与 Tkinter 无关；最好将其简化为一段简单的代码来演示您的问题，这样您就可以更轻松地进行试验。这是我尝试过的您正在做的事情的简化版本。我用 dict 代替菜单，以便于编写一个小测试用例。

```
items = ["stack", "over", "flow"]
map = { }

for item in items:
    def new_command():
        print(item)

    map[item] = new_command

map["stack"]()
map["over"]()
map["flow"]() 
```

现在，当我们执行此操作时，如您所说，我们得到：

```
flow
flow
flow 
```

这里的问题是 Python 的范围概念。特别是，该`for`语句没有引入新的范围级别，也没有为`item`;引入新的绑定。所以它`item`每次通过循环更新同一个变量，并且所有`new_command()`函数都引用同一个项目。

您需要做的是为每个`item`s 引入一个新级别的范围，以及一个新的绑定。最简单的方法是将其包装在一个新的函数定义中：

```
for item in items:
    def item_command(name):
        def new_command():
            print(name)
        return new_command

    map[item] = item_command(item) 
```

现在，如果您将其替换为前面的程序，您将获得所需的结果：

```
stack
over
flow 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T03:21:41.563

我认为这种事情在 Tkinter 中很常见。

试试这个（在适当的时候）：

```
def new_command(tag=tag):
    self.add_tag(tag) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-12-13T21:21:41.940

我有一个类似的错误。仅显示列表中的最后一项。通过设置固定

`command=lambda x=i: f(x)`

注意`x=i`后面`lambda`。此分配使您的局部变量`i`直接进入`f(x)`您的`command`. 希望，这个简单的例子会有所帮助：

```
# Using lambda keyword to create a dynamic menu.
import tkinter as tk

def f(x):
    print(x)

root = tk.Tk()
menubar = tk.Menu(root)
root.configure(menu=menubar)
menu = tk.Menu(menubar, tearoff=False)
l = ['one', 'two', 'three']
for i in l:
    menu.add_command(label=i, command=lambda x=i: f(x))
menubar.add_cascade(label='File', menu=menu)
root.mainloop() 
```

# javascript - 如何正确克隆 JavaScript 对象？

> ID：728360
> 
> 赞同：3466
> 
> 时间：2009-04-08T03:01:06.323
> 
> 标签：javascript, clone, javascript-objects

我有一个对象`x`。我想将其复制为 object `y`，以便更改为`y`不修改`x`。我意识到复制从内置 JavaScript 对象派生的对象会导致额外的、不需要的属性。这不是问题，因为我正在复制我自己的文字构造对象之一。

如何正确克隆 JavaScript 对象？

* * *

## 回答 #1

> 赞同：1689
> 
> 时间：2009-04-08T05:58:23.557

对 JavaScript 中的任何对象执行此操作都不会简单或直接。您将遇到错误地从对象原型中获取属性的问题，这些属性应该留在原型中而不是复制到新实例中。例如，如果您要向 中添加一个`clone`方法`Object.prototype`，正如某些答案所描述的那样，您将需要显式跳过该属性。`Object.prototype`但是，如果您不知道添加了其他附加方法或其他中间原型怎么办？在这种情况下，您将复制不应该复制的属性，因此您需要使用该方法检测不可预见的非本地属性[`hasOwnProperty`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Object/hasOwnProperty "Mozilla JavaScript 参考：Object.hasOwnProperty")。

除了不可枚举的属性之外，当您尝试复制具有隐藏属性的对象时，您还会遇到更棘手的问题。例如，`prototype`是函数的隐藏属性。此外，对象的原型由属性引用，该属性`__proto__`也是隐藏的，并且不会被迭代源对象属性的 for/in 循环复制。我认为`__proto__`可能特定于 Firefox 的 JavaScript 解释器，在其他浏览器中可能有所不同，但你明白了。并非所有事物都是可枚举的。如果您知道它的名称，您可以复制隐藏的属性，但我不知道有什么方法可以自动发现它。

寻求优雅解决方案的另一个障碍是正确设置原型继承的问题。如果您的源对象的原型是`Object`，那么只需创建一个新的通用对象`{}`就可以了，但如果源的原型是 的某个后代`Object`，那么您将丢失您使用`hasOwnProperty`过滤器跳过的原型中的其他成员，或者在原型中，但一开始就无法枚举。一种解决方案可能是调用源对象的`constructor`属性来获取初始复制对象，然后复制属性，但是您仍然不会获得不可枚举的属性。例如，一个[`Date`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Date "Mozilla JavaScript 参考：日期")对象将其数据存储为隐藏成员：

```
function clone(obj) {
    if (null == obj || "object" != typeof obj) return obj;
    var copy = obj.constructor();
    for (var attr in obj) {
        if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];
    }
    return copy;
}

var d1 = new Date();

/* Executes function after 5 seconds. */
setTimeout(function(){
    var d2 = clone(d1);
    alert("d1 = " + d1.toString() + "\nd2 = " + d2.toString());
}, 5000); 
```

的日期字符串`d1`将比 的日期字符串晚 5 秒`d2`。一种使一个`Date`与另一个相同的方法是调用该`setTime`方法，但这是特定于`Date`类的。我认为这个问题没有万无一失的通用解决方案，尽管我很乐意犯错！

当我不得不实现一般的深度复制时，我最终妥协了，假设我只需要复制一个普通的`Object`, `Array`, `Date`, `String`, `Number`, 或`Boolean`. 最后 3 种类型是不可变的，所以我可以执行浅拷贝而不用担心它会改变。我进一步假设包含在`Object`或`Array`也将是该列表中 6 种简单类型之一的任何元素。这可以通过如下代码来完成：

```
function clone(obj) {
    var copy;

    // Handle the 3 simple types, and null or undefined
    if (null == obj || "object" != typeof obj) return obj;

    // Handle Date
    if (obj instanceof Date) {
        copy = new Date();
        copy.setTime(obj.getTime());
        return copy;
    }

    // Handle Array
    if (obj instanceof Array) {
        copy = [];
        for (var i = 0, len = obj.length; i < len; i++) {
            copy[i] = clone(obj[i]);
        }
        return copy;
    }

    // Handle Object
    if (obj instanceof Object) {
        copy = {};
        for (var attr in obj) {
            if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr]);
        }
        return copy;
    }

    throw new Error("Unable to copy obj! Its type isn't supported.");
} 
```

只要对象和数组中的数据形成树形结构，上述函数就可以充分适用于我提到的 6 种简单类型。也就是说，对象中对相同数据的引用不超过一个。例如：

```
// This would be cloneable:
var tree = {
    "left"  : { "left" : null, "right" : null, "data" : 3 },
    "right" : null,
    "data"  : 8
};

// This would kind-of work, but you would get 2 copies of the 
// inner node instead of 2 references to the same copy
var directedAcylicGraph = {
    "left"  : { "left" : null, "right" : null, "data" : 3 },
    "data"  : 8
};
directedAcyclicGraph["right"] = directedAcyclicGraph["left"];

// Cloning this would cause a stack overflow due to infinite recursion:
var cyclicGraph = {
    "left"  : { "left" : null, "right" : null, "data" : 3 },
    "data"  : 8
};
cyclicGraph["right"] = cyclicGraph; 
```

它不能处理任何 JavaScript 对象，但它可能足以满足许多目的，只要你不认为它只适用于你扔给它的任何东西。

* * *

## 回答 #2

> 赞同：1104
> 
> 时间：2012-06-03T09:36:59.400

如果你不在`Date`你的对象中使用 s、functions、undefined、regExp 或 Infinity，一个非常简单的方法是`JSON.parse(JSON.stringify(object))`：

```
const a = {
  string: 'string',
  number: 123,
  bool: false,
  nul: null,
  date: new Date(),  // stringified
  undef: undefined,  // lost
  inf: Infinity,  // forced to 'null'
}
console.log(a);
console.log(typeof a.date);  // Date object
const clone = JSON.parse(JSON.stringify(a));
console.log(clone);
console.log(typeof clone.date);  // result of .toISOString()
```

这适用于包含对象、数组、字符串、布尔值和数字的所有类型的对象。

另请参阅[这篇关于浏览器的结构化克隆算法的文章，该算法](https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/The_structured_clone_algorithm)在向工作人员发送消息和从工作人员发送消息时使用。它还包含深度克隆功能。

* * *

## 回答 #3

> 赞同：805
> 
> 时间：2011-03-02T06:36:13.403

使用 jQuery，您可以使用[extend进行](http://api.jquery.com/jQuery.extend)**浅拷贝**：

```
var copiedObject = jQuery.extend({}, originalObject) 
```

对 的后续更改`copiedObject`不会影响`originalObject`，反之亦然。

或者制作一个**深拷贝**：

```
var copiedObject = jQuery.extend(true, {}, originalObject) 
```

* * *

## 回答 #4

> 赞同：791
> 
> 时间：2015-05-05T01:46:28.397

在 ECMAScript 6 中有[Object.assign](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)方法，它将所有可枚举自身属性的值从一个对象复制到另一个对象。例如：

```
var x = {myProp: "value"};
var y = Object.assign({}, x); 
```

但请注意**，这是一个浅拷贝**- 嵌套对象仍被复制为引用。

* * *

## 回答 #5

> 赞同：303
> 
> 时间：2016-11-07T17:14:38.383

每个[MDN](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Deep_Clone)：

*   如果你想要浅拷贝，请使用`Object.assign({}, a)`
*   对于“深”副本，请使用`JSON.parse(JSON.stringify(a))`

不需要外部库，但您需要先检查[浏览器兼容性](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Browser_compatibility)。

* * *

## 回答 #6

> 赞同：143
> 
> 时间：2012-03-19T15:17:52.737

有很多答案，但没有一个提到ECMAScript 5 中的[Object.create](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/create)，它诚然没有给你一个精确的副本，而是将源设置为新对象的原型。

因此，这不是问题的确切答案，但它是一种单线解决方案，因此很优雅。它最适合两种情况：

1.  这种继承有用的地方（呃！）
2.  源对象不会被修改的地方，因此这两个对象之间的关系不成问题。

例子：

```
var foo = { a : 1 };
var bar = Object.create(foo);
foo.a; // 1
bar.a; // 1
foo.a = 2;
bar.a; // 2 - prototype changed
bar.a = 3;
foo.a; // Still 2, since setting bar.a makes it an "own" property 
```

为什么我认为这个解决方案更好？它是原生的，因此没有循环，没有递归。但是，较旧的浏览器将需要一个 polyfill。

* * *

## 回答 #7

> 赞同：139
> 
> 时间：2015-12-15T16:42:26.017

# 一种在一行代码中克隆 Javascript 对象的优雅方法

`Object.assign`方法是 ECMAScript 2015 (ES6) 标准的一部分，完全符合您的需要。

```
var clone = Object.assign({}, obj); 
```

> Object.assign() 方法用于将所有可枚举自身属性的值从一个或多个源对象复制到目标对象。

[阅读更多...](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)

支持旧浏览器的**polyfill ：**

```
if (!Object.assign) {
  Object.defineProperty(Object, 'assign', {
    enumerable: false,
    configurable: true,
    writable: true,
    value: function(target) {
      'use strict';
      if (target === undefined || target === null) {
        throw new TypeError('Cannot convert first argument to object');
      }

      var to = Object(target);
      for (var i = 1; i < arguments.length; i++) {
        var nextSource = arguments[i];
        if (nextSource === undefined || nextSource === null) {
          continue;
        }
        nextSource = Object(nextSource);

        var keysArray = Object.keys(nextSource);
        for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {
          var nextKey = keysArray[nextIndex];
          var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);
          if (desc !== undefined && desc.enumerable) {
            to[nextKey] = nextSource[nextKey];
          }
        }
      }
      return to;
    }
  });
} 
```

* * *

## 回答 #8

> 赞同：94
> 
> 时间：2014-07-09T08:37:55.783

互联网上的大多数解决方案都存在几个问题。所以我决定进行跟进，其中包括为什么不应该接受已接受的答案。

## 起始情况

我想用它的所有孩子和他们的孩子等**深度复制**一个Javascript 。`Object`但由于我不是一个普通的开发人员，我的`Object`有*normal* `properties`，`circular structures`甚至`nested objects`.

所以让我们创建一个`circular structure`和一个`nested object`第一个。

```
function Circ() {
    this.me = this;
}

function Nested(y) {
    this.y = y;
} 
```

让我们将所有内容放在一个`Object`名为`a`.

```
var a = {
    x: 'a',
    circ: new Circ(),
    nested: new Nested('a')
}; 
```

接下来，我们要复制`a`到一个名为的变量中`b`并对其进行变异。

```
var b = a;

b.x = 'b';
b.nested.y = 'b'; 
```

您知道这里发生了什么，因为如果不是，您甚至不会遇到这个好问题。

```
console.log(a, b);

a --> Object {
    x: "b",
    circ: Circ {
        me: Circ { ... }
    },
    nested: Nested {
        y: "b"
    }
}

b --> Object {
    x: "b",
    circ: Circ {
        me: Circ { ... }
    },
    nested: Nested {
        y: "b"
    }
} 
```

现在让我们找到解决方案。

## JSON

我尝试的第一次尝试是使用`JSON`.

```
var b = JSON.parse( JSON.stringify( a ) );

b.x = 'b';
b.nested.y = 'b'; 
```

不要在上面浪费太多时间，你会得到`TypeError: Converting circular structure to JSON`的。

## 递归副本*（接受的“答案”）*

让我们看看接受的答案。

```
function cloneSO(obj) {
    // Handle the 3 simple types, and null or undefined
    if (null == obj || "object" != typeof obj) return obj;

    // Handle Date
    if (obj instanceof Date) {
        var copy = new Date();
        copy.setTime(obj.getTime());
        return copy;
    }

    // Handle Array
    if (obj instanceof Array) {
        var copy = [];
        for (var i = 0, len = obj.length; i < len; i++) {
            copy[i] = cloneSO(obj[i]);
        }
        return copy;
    }

    // Handle Object
    if (obj instanceof Object) {
        var copy = {};
        for (var attr in obj) {
            if (obj.hasOwnProperty(attr)) copy[attr] = cloneSO(obj[attr]);
        }
        return copy;
    }

    throw new Error("Unable to copy obj! Its type isn't supported.");
} 
```

看起来不错吧？它是对象的递归副本，也可以处理其他类型，例如`Date`，但这不是必需的。

```
var b = cloneSO(a);

b.x = 'b';
b.nested.y = 'b'; 
```

递归和`circular structures`不能很好地协同工作......`RangeError: Maximum call stack size exceeded`

## 本机解决方案

与同事争吵后，我的老板问我们发生了什么事，他在谷歌搜索后找到了一个简单的*解决方案*。它被称为`Object.create`。

```
var b = Object.create(a);

b.x = 'b';
b.nested.y = 'b'; 
```

该解决方案是前段时间添加到 Javascript 中的，甚至可以处理`circular structure`.

```
console.log(a, b);

a --> Object {
    x: "a",
    circ: Circ {
        me: Circ { ... }
    },
    nested: Nested {
        y: "b"
    }
}

b --> Object {
    x: "b",
    circ: Circ {
        me: Circ { ... }
    },
    nested: Nested {
        y: "b"
    }
} 
```

...你看，它不适用于内部的嵌套结构。

## 原生解决方案的 polyfill

像 IE 8 一样，在旧版浏览器中有一个 polyfill `Object.create`。这是 Mozilla 推荐的东西，当然，它并不完美，会导致与*原生解决方案*相同的问题。

```
function F() {};
function clonePF(o) {
    F.prototype = o;
    return new F();
}

var b = clonePF(a);

b.x = 'b';
b.nested.y = 'b'; 
```

我已经把范围放在`F`了范围之外，所以我们可以看看`instanceof`告诉我们什么。

```
console.log(a, b);

a --> Object {
    x: "a",
    circ: Circ {
        me: Circ { ... }
    },
    nested: Nested {
        y: "b"
    }
}

b --> F {
    x: "b",
    circ: Circ {
        me: Circ { ... }
    },
    nested: Nested {
        y: "b"
    }
}

console.log(typeof a, typeof b);

a --> object
b --> object

console.log(a instanceof Object, b instanceof Object);

a --> true
b --> true

console.log(a instanceof F, b instanceof F);

a --> false
b --> true 
```

*与本机解决方案*相同的问题，但输出稍差一些。

## 更好（但不完美）的解决方案

在挖掘时，我发现了一个类似的问题（[在 Javascript 中，执行深层复制时，由于属性是“this”，我如何避免循环？](https://stackoverflow.com/questions/10728412/in-javascript-when-performing-a-deep-copy-how-do-i-avoid-a-cycle-due-to-a-pro)），但有一个更好的解决方案。

```
function cloneDR(o) {
    const gdcc = "__getDeepCircularCopy__";
    if (o !== Object(o)) {
        return o; // primitive value
    }

    var set = gdcc in o,
        cache = o[gdcc],
        result;
    if (set && typeof cache == "function") {
        return cache();
    }
    // else
    o[gdcc] = function() { return result; }; // overwrite
    if (o instanceof Array) {
        result = [];
        for (var i=0; i<o.length; i++) {
            result[i] = cloneDR(o[i]);
        }
    } else {
        result = {};
        for (var prop in o)
            if (prop != gdcc)
                result[prop] = cloneDR(o[prop]);
            else if (set)
                result[prop] = cloneDR(cache);
    }
    if (set) {
        o[gdcc] = cache; // reset
    } else {
        delete o[gdcc]; // unset again
    }
    return result;
}

var b = cloneDR(a);

b.x = 'b';
b.nested.y = 'b'; 
```

让我们看看输出......

```
console.log(a, b);

a --> Object {
    x: "a",
    circ: Object {
        me: Object { ... }
    },
    nested: Object {
        y: "a"
    }
}

b --> Object {
    x: "b",
    circ: Object {
        me: Object { ... }
    },
    nested: Object {
        y: "b"
    }
}

console.log(typeof a, typeof b);

a --> object
b --> object

console.log(a instanceof Object, b instanceof Object);

a --> true
b --> true

console.log(a instanceof F, b instanceof F);

a --> false
b --> false 
```

需求是匹配的，但还是有一些小问题，包括改变`instance`of`nested`和`circ`to `Object`。

> 共享叶子的树的结构不会被复制，它们将成为两个独立的叶子：

```
 [Object]                     [Object]
         /    \                       /    \
        /      \                     /      \
      |/_      _\|                 |/_      _\|  
  [Object]    [Object]   ===>  [Object]    [Object]
       \        /                 |           |
        \      /                  |           |
        _\|  |/_                 \|/         \|/
        [Object]               [Object]    [Object] 
```

## 结论

最后一个使用递归和缓存的解决方案可能不是最好的，但它是对象的**真正**深层副本。它处理简单`properties`的 ,`circular structures`和`nested object`，但在克隆时会弄乱它们的实例。

[jsfiddle](http://jsfiddle.net/einfallstoll/N4mr2/)

* * *

## 回答 #9

> 赞同：80
> 
> 时间：2012-06-13T23:44:10.383

如果你对浅拷贝没问题，underscore.js 库有一个[克隆](http://underscorejs.org/#clone)方法。

```
y = _.clone(x); 
```

或者你可以像这样扩展它

```
copiedObject = _.extend({},originalObject); 
```

* * *

## 回答 #10

> 赞同：75
> 
> 时间：2017-07-06T13:50:03.497

**好的，**假设你在下面有这个对象并且你想克隆它：

```
let obj = {a:1, b:2, c:3}; //ES6 
```

或者

```
var obj = {a:1, b:2, c:3}; //ES5 
```

答案主要取决于您使用的**ECMAscript**`ES6+` ，在 中，您可以简单地使用`Object.assign`来进行克隆：

```
let cloned = Object.assign({}, obj); //new {a:1, b:2, c:3}; 
```

或像这样使用扩展运算符：

```
let cloned = {...obj}; //new {a:1, b:2, c:3}; 
```

但是如果你使用`ES5`，你可以使用一些方法，但是`JSON.stringify`，只要确保你不使用大量数据来复制，但在许多情况下它可能是一种方便的方式，如下所示：

```
let cloned = JSON.parse(JSON.stringify(obj)); 
//new {a:1, b:2, c:3};, can be handy, but avoid using on big chunk of data over and over 
```

* * *

## 回答 #11

> 赞同：54
> 
> 时间：2020-07-06T06:45:14.457

## 2020 年 7 月 6 日更新

有三 (3) 种方法可以在 JavaScript 中克隆对象。由于 JavaScript 中的对象是引用值，因此您不能简单地使用 = 进行复制。

方法是：

```
const food = { food: 'apple', drink: 'milk' }

// 1\. Using the "Spread"
// ------------------

{ ...food }

// 2\. Using "Object.assign"
// ------------------

Object.assign({}, food)

// 3\. "JSON"
// ------------------

JSON.parse(JSON.stringify(food))

// RESULT:
// { food: 'apple', drink: 'milk' } 
```

这可以作为参考总结。

* * *

## 回答 #12

> 赞同：47
> 
> 时间：2009-10-29T20:24:06.643

一种特别不优雅的解决方案是使用 JSON 编码来制作没有成员方法的对象的深层副本。该方法是对您的目标对象进行 JSON 编码，然后通过对其进行解码，您可以获得所需的副本。您可以根据需要进行多次解码，制作尽可能多的副本。

当然，函数不属于 JSON，所以这只适用于没有成员方法的对象。

这种方法非常适合我的用例，因为我将 JSON blob 存储在键值存储中，当它们在 JavaScript API 中作为对象公开时，每个对象实际上都包含对象原始状态的副本，所以我们可以在调用者改变暴露的对象后计算增量。

```
var object1 = {key:"value"};
var object2 = object1;

object2 = JSON.stringify(object1);
object2 = JSON.parse(object2);

object2.key = "a change";
console.log(object1);// returns value 
```

* * *

## 回答 #13

> 赞同：40
> 
> 时间：2016-04-13T15:43:34.157

您可以简单地使用[扩展属性](https://github.com/sebmarkbage/ecmascript-rest-spread/blob/master/Spread.md)来复制没有引用的对象。但要小心（见评论），“副本”只是在最低的对象/数组级别。嵌套属性仍然是引用！

* * *

**完整克隆：**

```
let x = {a: 'value1'}
let x2 = {...x}

// => mutate without references:

x2.a = 'value2'
console.log(x.a)    // => 'value1' 
```

**使用二级引用克隆：**

```
const y = {a: {b: 'value3'}}
const y2 = {...y}

// => nested object is still a references:

y2.a.b = 'value4'
console.log(y.a.b)    // => 'value4' 
```

* * *

JavaScript 实际上本身并不支持深度克隆。使用效用函数。例如拉姆达：

> [http://ramdajs.com/docs/#clone](http://ramdajs.com/docs/#clone)

* * *

## 回答 #14

> 赞同：33
> 
> 时间：2018-08-03T15:55:05.480

```
const objClone = { ...obj }; 
```

请注意，**嵌套对象**仍被复制**为引用。**

* * *

## 回答 #15

> 赞同：30
> 
> 时间：2009-04-08T03:13:46.963

来自这篇文章：Brian Huisman[如何在 Javascript 中复制数组和对象：](https://greywyvern.com/?post=363)

```
Object.prototype.clone = function() {
  var newObj = (this instanceof Array) ? [] : {};
  for (var i in this) {
    if (i == 'clone') continue;
    if (this[i] && typeof this[i] == "object") {
      newObj[i] = this[i].clone();
    } else newObj[i] = this[i]
  } return newObj;
}; 
```

* * *

## 回答 #16

> 赞同：30
> 
> 时间：2014-09-03T19:08:28.020

对于那些使用 AngularJS 的人，也有直接的方法来克隆或扩展这个库中的对象。

```
var destination = angular.copy(source); 
```

或者

```
angular.copy(source, destination); 
```

更多在 angular.copy[文档](https://docs.angularjs.org/api/ng/function/angular.copy)中......

* * *

## 回答 #17

> 赞同：27
> 
> 时间：2009-04-08T03:16:14.087

```
function clone(obj) {
    if(obj == null || typeof(obj) != 'object')
        return obj;    
    var temp = new obj.constructor(); 
    for(var key in obj)
        temp[key] = clone(obj[key]);    
    return temp;
} 
```

* * *

## 回答 #18

> 赞同：26
> 
> 时间：2012-01-26T18:12:50.343

A.Levy 的回答几乎是完整的，这是我的一点贡献：**有一种方法如何处理递归引用**，请参见这一行

`if(this[attr]==this) copy[attr] = copy;`

如果对象是 XML DOM 元素，我们必须使用**cloneNode**代替

`if(this.cloneNode) return this.cloneNode(true);`

受 A.Levy 详尽的研究和 Calvin 的原型制作方法的启发，我提供了以下解决方案：

```
Object.prototype.clone = function() {
  if(this.cloneNode) return this.cloneNode(true);
  var copy = this instanceof Array ? [] : {};
  for(var attr in this) {
    if(typeof this[attr] == "function" || this[attr]==null || !this[attr].clone)
      copy[attr] = this[attr];
    else if(this[attr]==this) copy[attr] = copy;
    else copy[attr] = this[attr].clone();
  }
  return copy;
}

Date.prototype.clone = function() {
  var copy = new Date();
  copy.setTime(this.getTime());
  return copy;
}

Number.prototype.clone = 
Boolean.prototype.clone =
String.prototype.clone = function() {
  return this;
} 
```

另请参阅答案中的安迪·伯克 (Andy Burke) 的注释。

* * *

## 回答 #19

> 赞同：23
> 
> 时间：2012-12-13T00:05:07.187

使用 Lodash：

```
var y = _.clone(x, true); 
```

* * *

## 回答 #20

> 赞同：23
> 
> 时间：2020-04-30T12:21:03.987

# 表现

今天 2020.04.30 我在 MacOs High Sierra v10.13.6 上在 Chrome v81.0、Safari v13.1 和 Firefox v75.0 上执行所选解决方案的测试。

我专注于复制 DATA 的速度（具有简单类型字段的对象，而不是方法等）。解AI只能做浅拷贝，解JU可以做深拷贝。

### 浅拷贝的结果

*   解决方案`{...obj}`(A) 在 chrome 和 firefox 上最快，在 safari 上中速
*   基于`Object.assign`（B）的解决方案在所有浏览器上都很快
*   jQuery (E) 和 lodash (F,G,H) 解决方案中等/相当快
*   解决方案`JSON.parse/stringify`（K）非常慢
*   解决方案 D 和 U 在所有浏览器上都很慢

[![在此处输入图像描述](https://i.stack.imgur.com/mCte1.png)](https://i.stack.imgur.com/mCte1.png)

### 深拷贝的结果

*   解决方案 Q 在所有浏览器上最快
*   jQuery (L) 和 lodash (J) 中等速度
*   解决方案`JSON.parse/stringify`（K）非常慢
*   解决方案 U 在所有浏览器上最慢
*   lodash (J) 和解决方案 U crash on Chrome for 1000 level deep object

[![在此处输入图像描述](https://i.stack.imgur.com/KxBqv.png)](https://i.stack.imgur.com/KxBqv.png)

## 细节

对于选择的解决方案： [A](https://stackoverflow.com/a/44950864/860099) [B](https://stackoverflow.com/a/30042948/860099) C(my) [D](https://stackoverflow.com/a/49497485/860099) [E](https://stackoverflow.com/a/5164215/860099) [F](https://stackoverflow.com/a/11024936/860099) [G](https://stackoverflow.com/a/13850856/860099) [H](https://stackoverflow.com/a/11024936/860099) [I](https://stackoverflow.com/a/728694/860099) [J](https://stackoverflow.com/a/57504513/860099) [K](https://stackoverflow.com/a/10869248/860099) [L](https://stackoverflow.com/a/5164215/860099) [M](https://stackoverflow.com/a/728400/860099) [N](https://stackoverflow.com/a/728395/860099) [O](https://stackoverflow.com/a/1042676/860099) [P](https://stackoverflow.com/a/33273256/860099) [Q](https://stackoverflow.com/a/24648941/860099) [R](https://stackoverflow.com/a/24648941/860099) [S](https://stackoverflow.com/a/39029912/860099) [T](https://stackoverflow.com/a/11462081/860099) [U](https://stackoverflow.com/a/53737490/860099)，我执行 4 次测试

*   浅小：具有 10 个非嵌套字段的对象 - 您可以在[此处运行它](https://jsbench.me/0xk9l5ci9x/1)
*   浅大：具有 1000 个非嵌套字段的对象 - 您可以在[此处运行它](https://jsbench.me/t0k9l64319/1)
*   deep-small：具有 10 个级别嵌套字段的对象 - 您可以在[此处运行它](https://jsbench.me/pvk9l6pzfj/1)
*   deep-big：具有 1000 个级别嵌套字段的对象 - 您可以在[此处运行它](https://jsbench.me/euk9l6x9jx/1)

测试中使用的对象显示在下面的代码片段中

```
let obj_ShallowSmall = {
  field0: false,
  field1: true,
  field2: 1,
  field3: 0,
  field4: null,
  field5: [],
  field6: {},
  field7: "text7",
  field8: "text8",
}

let obj_DeepSmall = {
  level0: {
   level1: {
    level2: {
     level3: {
      level4: {
       level5: {
        level6: {
         level7: {
          level8: {
           level9: [[[[[[[[[['abc']]]]]]]]]],
  }}}}}}}}},
};

let obj_ShallowBig = Array(1000).fill(0).reduce((a,c,i) => (a['field'+i]=getField(i),a) ,{});

let obj_DeepBig = genDeepObject(1000);

// ------------------
// Show objects
// ------------------

console.log('obj_ShallowSmall:',JSON.stringify(obj_ShallowSmall));
console.log('obj_DeepSmall:',JSON.stringify(obj_DeepSmall));
console.log('obj_ShallowBig:',JSON.stringify(obj_ShallowBig));
console.log('obj_DeepBig:',JSON.stringify(obj_DeepBig));

// ------------------
// HELPERS
// ------------------

function getField(k) {
  let i=k%10;
  if(i==0) return false;
  if(i==1) return true;
  if(i==2) return k;
  if(i==3) return 0;
  if(i==4) return null;
  if(i==5) return [];
  if(i==6) return {};  
  if(i>=7) return "text"+k;
}

function genDeepObject(N) {
  // generate: {level0:{level1:{...levelN: {end:[[[...N-times...['abc']...]]] }}}...}}}
  let obj={};
  let o=obj;
  let arr = [];
  let a=arr;

  for(let i=0; i<N; i++) {
    o['level'+i]={};
    o=o['level'+i];
    let aa=[];
    a.push(aa);
    a=aa;
  }

  a[0]='abc';
  o['end']=arr;
  return obj;
}
```

下面的代码片段展示了经过测试的解决方案并显示了它们之间的差异

```
function A(obj) {
  return {...obj}
}

function B(obj) {
  return Object.assign({}, obj); 
}

function C(obj) {
  return Object.keys(obj).reduce( (a,c) => (a[c]=obj[c], a), {})
}

function D(obj) {
  let copyOfObject = {};
  Object.defineProperties(copyOfObject, Object.getOwnPropertyDescriptors(obj));
  return copyOfObject;
}

function E(obj) {
  return jQuery.extend({}, obj) // shallow
}

function F(obj) {
  return _.clone(obj);
}

function G(obj) {
  return _.clone(obj,true);
}

function H(obj) {
  return _.extend({},obj);
}

function I(obj) {
    if (null == obj || "object" != typeof obj) return obj;
    var copy = obj.constructor();
    for (var attr in obj) {
        if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];
    }
    return copy;
}

function J(obj) {
  return _.cloneDeep(obj,true);
}

function K(obj) {
	return JSON.parse(JSON.stringify(obj));
}

function L(obj) {
  return jQuery.extend(true, {}, obj) // deep
}

function M(obj) {
  if(obj == null || typeof(obj) != 'object')
    return obj;    
  var temp = new obj.constructor(); 
  for(var key in obj)
    temp[key] = M(obj[key]);    
  return temp;
}

function N(obj) {
  let EClone = function(obj) {
    var newObj = (obj instanceof Array) ? [] : {};
    for (var i in obj) {
      if (i == 'EClone') continue;
      if (obj[i] && typeof obj[i] == "object") {
        newObj[i] = EClone(obj[i]);
      } else newObj[i] = obj[i]
    } return newObj;
  };

	return EClone(obj);
};

function O(obj) {
    if (obj == null || typeof obj != "object") return obj;
    if (obj.constructor != Object && obj.constructor != Array) return obj;
    if (obj.constructor == Date || obj.constructor == RegExp || obj.constructor == Function ||
        obj.constructor == String || obj.constructor == Number || obj.constructor == Boolean)
        return new obj.constructor(obj);

    let to = new obj.constructor();

    for (var name in obj)
    {
        to[name] = typeof to[name] == "undefined" ? O(obj[name], null) : to[name];
    }

    return to;
}

function P(obj) {
  function clone(target, source){

      for(let key in source){

          // Use getOwnPropertyDescriptor instead of source[key] to prevent from trigering setter/getter.
          let descriptor = Object.getOwnPropertyDescriptor(source, key);
          if(descriptor.value instanceof String){
              target[key] = new String(descriptor.value);
          }
          else if(descriptor.value instanceof Array){
              target[key] = clone([], descriptor.value);
          }
          else if(descriptor.value instanceof Object){
              let prototype = Reflect.getPrototypeOf(descriptor.value);
              let cloneObject = clone({}, descriptor.value);
              Reflect.setPrototypeOf(cloneObject, prototype);
              target[key] = cloneObject;
          }
          else {
              Object.defineProperty(target, key, descriptor);
          }
      }
      let prototype = Reflect.getPrototypeOf(source);
      Reflect.setPrototypeOf(target, prototype);
      return target;
  }
  return clone({},obj);
}

function Q(obj) {
    var copy;

    // Handle the 3 simple types, and null or undefined
    if (null == obj || "object" != typeof obj) return obj;

    // Handle Date
    if (obj instanceof Date) {
        copy = new Date();
        copy.setTime(obj.getTime());
        return copy;
    }

    // Handle Array
    if (obj instanceof Array) {
        copy = [];
        for (var i = 0, len = obj.length; i < len; i++) {
            copy[i] = Q(obj[i]);
        }
        return copy;
    }

    // Handle Object
    if (obj instanceof Object) {
        copy = {};
        for (var attr in obj) {
            if (obj.hasOwnProperty(attr)) copy[attr] = Q(obj[attr]);
        }
        return copy;
    }

    throw new Error("Unable to copy obj! Its type isn't supported.");
}

function R(obj) {
    const gdcc = "__getDeepCircularCopy__";
    if (obj !== Object(obj)) {
        return obj; // primitive value
    }

    var set = gdcc in obj,
        cache = obj[gdcc],
        result;
    if (set && typeof cache == "function") {
        return cache();
    }
    // else
    obj[gdcc] = function() { return result; }; // overwrite
    if (obj instanceof Array) {
        result = [];
        for (var i=0; i<obj.length; i++) {
            result[i] = R(obj[i]);
        }
    } else {
        result = {};
        for (var prop in obj)
            if (prop != gdcc)
                result[prop] = R(obj[prop]);
            else if (set)
                result[prop] = R(cache);
    }
    if (set) {
        obj[gdcc] = cache; // reset
    } else {
        delete obj[gdcc]; // unset again
    }
    return result;
}

function S(obj) {
    const cache = new WeakMap(); // Map of old - new references

    function copy(object) {
        if (typeof object !== 'object' ||
            object === null ||
            object instanceof HTMLElement
        )
            return object; // primitive value or HTMLElement

        if (object instanceof Date) 
            return new Date().setTime(object.getTime());

        if (object instanceof RegExp) 
            return new RegExp(object.source, object.flags);

        if (cache.has(object)) 
            return cache.get(object);

        const result = object instanceof Array ? [] : {};

        cache.set(object, result); // store reference to object before the recursive starts

        if (object instanceof Array) {
            for(const o of object) {
                 result.push(copy(o));
            }
            return result;
        }

        const keys = Object.keys(object); 

        for (const key of keys)
            result[key] = copy(object[key]);

        return result;
    }

    return copy(obj);
}

function T(obj){
    var clonedObjectsArray = [];
    var originalObjectsArray = []; //used to remove the unique ids when finished
    var next_objid = 0;

    function objectId(obj) {
        if (obj == null) return null;
        if (obj.__obj_id == undefined){
            obj.__obj_id = next_objid++;
            originalObjectsArray[obj.__obj_id] = obj;
        }
        return obj.__obj_id;
    }

    function cloneRecursive(obj) {
        if (null == obj || typeof obj == "string" || typeof obj == "number" || typeof obj == "boolean") return obj;

        // Handle Date
        if (obj instanceof Date) {
            var copy = new Date();
            copy.setTime(obj.getTime());
            return copy;
        }

        // Handle Array
        if (obj instanceof Array) {
            var copy = [];
            for (var i = 0; i < obj.length; ++i) {
                copy[i] = cloneRecursive(obj[i]);
            }
            return copy;
        }

        // Handle Object
        if (obj instanceof Object) {
            if (clonedObjectsArray[objectId(obj)] != undefined)
                return clonedObjectsArray[objectId(obj)];

            var copy;
            if (obj instanceof Function)//Handle Function
                copy = function(){return obj.apply(this, arguments);};
            else
                copy = {};

            clonedObjectsArray[objectId(obj)] = copy;

            for (var attr in obj)
                if (attr != "__obj_id" && obj.hasOwnProperty(attr))
                    copy[attr] = cloneRecursive(obj[attr]);                 

            return copy;
        }       

        throw new Error("Unable to copy obj! Its type isn't supported.");
    }
    var cloneObj = cloneRecursive(obj);

    //remove the unique ids
    for (var i = 0; i < originalObjectsArray.length; i++)
    {
        delete originalObjectsArray[i].__obj_id;
    };

    return cloneObj;
}

function U(obj) {
  /*
    Deep copy objects by value rather than by reference,
    exception: `Proxy`
  */

  const seen = new WeakMap()

  return clone(obj)

  function defineProp(object, key, descriptor = {}, copyFrom = {}) {
    const { configurable: _configurable, writable: _writable }
      = Object.getOwnPropertyDescriptor(object, key)
      || { configurable: true, writable: true }

    const test = _configurable // Can redefine property
      && (_writable === undefined || _writable) // Can assign to property

    if (!test || arguments.length <= 2) return test

    const basisDesc = Object.getOwnPropertyDescriptor(copyFrom, key)
      || { configurable: true, writable: true } // Custom…
      || {}; // …or left to native default settings

    ["get", "set", "value", "writable", "enumerable", "configurable"]
      .forEach(attr =>
        descriptor[attr] === undefined &&
        (descriptor[attr] = basisDesc[attr])
      )

    const { get, set, value, writable, enumerable, configurable }
      = descriptor

    return Object.defineProperty(object, key, {
      enumerable, configurable, ...get || set
        ? { get, set } // Accessor descriptor
        : { value, writable } // Data descriptor
    })
  }

  function clone(object) {
    if (object !== Object(object)) return object /*
    —— Check if the object belongs to a primitive data type */

    if (object instanceof Node) return object.cloneNode(true) /*
    —— Clone DOM trees */

    let _object // The clone of object

    switch (object.constructor) {
      case Array:
      case Object:
        _object = cloneObject(object)
        break

      case Date:
        _object = new Date(+object)
        break

      case Function:
        const fnStr = String(object)

        _object = new Function("return " +
          (/^(?!function |[^{]+?=>)[^(]+?\(/.test(fnStr)
            ? "function " : ""
          ) + fnStr
        )()

        copyPropDescs(_object, object)
        break

      case RegExp:
        _object = new RegExp(object)
        break

      default:
        switch (Object.prototype.toString.call(object.constructor)) {
          //                              // Stem from:
          case "[object Function]":       // `class`
          case "[object Undefined]":      // `Object.create(null)`
            _object = cloneObject(object)
            break

          default:                        // `Proxy`
            _object = object
        }
    }

    return _object
  }

  function cloneObject(object) {
    if (seen.has(object)) return seen.get(object) /*
    —— Handle recursive references (circular structures) */

    const _object = Array.isArray(object)
      ? []
      : Object.create(Object.getPrototypeOf(object)) /*
        —— Assign [[Prototype]] for inheritance */

    seen.set(object, _object) /*
    —— Make `_object` the associative mirror of `object` */

    Reflect.ownKeys(object).forEach(key =>
      defineProp(_object, key, { value: clone(object[key]) }, object)
    )

    return _object
  }

  function copyPropDescs(target, source) {
    Object.defineProperties(target,
      Object.getOwnPropertyDescriptors(source)
    )
  }
}

// ------------------------
// Test properties
// ------------------------

console.log(`  shallow deep  func  circ  undefined date  RegExp bigInt`)

log(A);
log(B);
log(C);
log(D);
log(E);
log(F);
log(G);
log(H);
log(I);
log(J);
log(K);
log(L);
log(M);
log(N);
log(O);
log(P);
log(Q);
log(R);
log(S);
log(T);
log(U);

console.log(`  shallow deep  func  circ  undefined date  RegExp bigInt
----
LEGEND:
shallow - solution create shallow copy
deep - solution create deep copy
func - solution copy functions
circ - solution can copy object with circular references
undefined - solution copy fields with undefined value
date - solution can copy date
RegExp - solution can copy fields with regular expressions
bigInt - solution can copy BigInt
`)

// ------------------------
// Helper functions
// ------------------------

function deepCompare(obj1,obj2) {
  return JSON.stringify(obj1)===JSON.stringify(obj2);
}

function getCase() { // pure data case
  return { 
    undef: undefined,
    bool: true, num: 1, str: "txt1",    
    e1: null, e2: [], e3: {}, e4: 0, e5: false,
    arr: [ false, 2, "txt3", null, [], {},
      [ true,4,"txt5",null, [], {},  [true,6,"txt7",null,[],{} ], 
        {bool: true,num: 8, str: "txt9", e1:null, e2:[] ,e3:{} ,e4: 0, e5: false}
      ],
        {bool: true,num: 10, str: "txt11", e1:null, e2:[] ,e3:{} ,e4: 0, e5: false}
    ], 
    obj: { 
        bool: true, num: 12, str: "txt13",
        e1: null, e2: [], e3: {}, e4: 0, e5: false,
        arr: [true,14,"txt15",null,[],{} ],
        obj: { 
          bool: true, num: 16, str: "txt17",
          e1: null, e2: [], e3: {}, e4: 0, e5: false,
          arr: [true,18,"txt19",null,[],{} ],
          obj: {bool: true,num: 20, str: "txt21", e1:null, e2:[] ,e3:{} ,e4: 0, e5: false}
      } 
    } 
  };
}

function check(org, copy, field, newValue) {
  copy[field] = newValue;
  return deepCompare(org,copy); 
}

function testFunc(f) {
	let o = { a:1, fun: (i,j)=> i+j };
  let c = f(o);

  let val = false
  try{
    val = c.fun(3,4)==7;
  } catch(e) { }
  return val;
} 

function testCirc(f) {
	function Circ() {
    this.me = this;
  }

  var o = {
      x: 'a',
      circ: new Circ(),
      obj_circ: null,
  };

  o.obj_circ = o;

  let val = false;

  try{
    let c = f(o);  
    val = (o.obj_circ == o) && (o.circ == o.circ.me);
  } catch(e) { }
  return val;
} 

function testRegExp(f) {
  let o = {
    re: /a[0-9]+/,
  };

  let val = false;

  try{
    let c = f(o);  
    val = (String(c.re) == String(/a[0-9]+/));
  } catch(e) { }
  return val;
}

function testDate(f) {
  let o = {
    date: new Date(),
  };

  let val = false;

  try{
    let c = f(o);  
    val = (+new Date(c.date) == +new Date(o.date));
  } catch(e) { }
  return val;
}

function testBigInt(f) {
  let val = false;

  try{
    let o = {
      big: 123n,
    };

    let c = f(o);  

    val = o.big == c.big;
  } catch(e) { }

  return val;
}

function log(f) {
  let o = getCase();  // orginal object
  let oB = getCase(); // "backup" used for shallow valid test

  let c1 = f(o); // copy 1 for reference
  let c2 = f(o); // copy 2 for test shallow values
  let c3 = f(o); // copy 3 for test deep values

  let is_proper_copy = deepCompare(c1,o);  // shoud be true

  // shallow changes
  let testShallow = 
    [ ['bool',false],['num',666],['str','xyz'],['arr',[]],['obj',{}] ]
    .reduce((acc,curr)=> acc && check(c1,c2,curr[0], curr[1]), true );

  // should be true (original object shoud not have changed shallow fields)
  let is_valid = deepCompare(o,oB); 

  // deep test (intruduce some change)
  if (c3.arr[6]) c3.arr[6][7].num = 777;

  let diff_shallow = !testShallow; // shoud be true (shallow field was copied)
  let diff_deep = !deepCompare(c1,c3);    // shoud be true (deep field was copied)
  let can_copy_functions = testFunc(f);
  let can_copy_circular = testCirc(f);
  let can_copy_regexp = testRegExp(f);
  let can_copy_date = testDate(f);
  let can_copy_bigInt = testBigInt(f);

  let has_undefined = 'undef' in c1; // field with undefined value is copied?  
  let is_ok = is_valid && is_proper_copy;
  let b=(bool) => (bool+'').padEnd(5,' '); // bool value to formated string

  testFunc(f);

  if(is_ok) {
    console.log(`${f.name} ${b(diff_shallow)}   ${b(diff_deep)} ${b(can_copy_functions)} ${b(can_copy_circular)} ${b(has_undefined)}     ${b(can_copy_date)} ${b(can_copy_regexp)}  ${b(can_copy_bigInt)}`)
  } else {
    console.log(`${f.name}: INVALID ${is_valid} ${is_proper_copy}`,{c1})
  }

}
```

```
<script src="https://code.jquery.com/jquery-3.5.0.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.15/lodash.min.js"></script>

This snippet only presents tested solutions and show differences between them (but it no make performence tests)
```

下面是 Chrome 用于浅大对象的示例结果

[![在此处输入图像描述](https://i.stack.imgur.com/zluC1.png)](https://i.stack.imgur.com/zluC1.png)

* * *

## 回答 #21

> 赞同：22
> 
> 时间：2017-04-13T20:17:11.753

在 ES-6 中，您可以简单地使用 Object.assign(...)。前任：

```
let obj = {person: 'Thor Odinson'};
let clone = Object.assign({}, obj); 
```

一个很好的参考在这里： [https ://googlechrome.github.io/samples/object-assign-es6/](https://googlechrome.github.io/samples/object-assign-es6/)

* * *

## 回答 #22

> 赞同：20
> 
> 时间：2015-08-27T09:20:24.920

对克隆简单对象感兴趣：

`JSON.parse(JSON.stringify(json_original));`

来源：[如何不通过引用将 JavaScript 对象复制到新变量？](https://stackoverflow.com/questions/18359093/how-to-copy-javascript-object-to-new-variable-not-by-reference?answertab=votes#tab-top)

* * *

## 回答 #23

> 赞同：17
> 
> 时间：2012-05-26T13:45:40.157

您可以使用一行代码克隆一个对象并从前一个对象中删除任何引用。只需这样做：

```
var obj1 = { text: 'moo1' };
var obj2 = Object.create(obj1); // Creates a new clone without references

obj2.text = 'moo2'; // Only updates obj2's text property

console.log(obj1, obj2); // Outputs: obj1: {text:'moo1'}, obj2: {text:'moo2'} 
```

对于当前不支持 Object.create 的浏览器/引擎，您可以使用这个 polyfill：

```
// Polyfill Object.create if it does not exist
if (!Object.create) {
    Object.create = function (o) {
        var F = function () {};
        F.prototype = o;
        return new F();
    };
} 
```

* * *

## 回答 #24

> 赞同：17
> 
> 时间：2017-05-12T10:49:39.660

```
let clone = Object.assign( Object.create( Object.getPrototypeOf(obj)), obj) 
```

ES6 解决方案，如果你想（浅）克隆一个**类实例**而不仅仅是一个属性对象。

* * *

## 回答 #25

> 赞同：15
> 
> 时间：2016-12-16T11:34:33.233

老问题的新答案！如果您有幸使用 ECMAScript 2016 (ES6) 和[Spread Syntax](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator)，这很容易。

```
keepMeTheSame = {first: "Me!", second: "You!"};
cloned = {...keepMeTheSame} 
```

这为对象的浅拷贝提供了一种干净的方法。制作深层副本，即为每个递归嵌套对象中的每个值创建一个新副本，需要上述较重的解决方案。

JavaScript 不断发展。

* * *

## 回答 #26

> 赞同：14
> 
> 时间：2019-01-12T07:04:18.783

我认为有一个简单而有效的答案。在深度复制中，有两个问题：

1.  保持属性相互独立。
2.  并使方法在克隆对象上保持活动状态。

所以我认为一个简单的解决方案是首先序列化和反序列化，然后对其进行分配以复制函数。

```
let deepCloned = JSON.parse(JSON.stringify(source));
let merged = Object.assign({}, source);
Object.assign(merged, deepCloned); 
```

虽然这个问题有很多答案，但我希望这个也有帮助。

* * *

## 回答 #27

> 赞同：14
> 
> 时间：2019-05-20T08:35:11.347

对于深拷贝和克隆，JSON.stringify 然后 JSON.parse 对象：

```
obj = { a: 0 , b: { c: 0}};
let deepClone = JSON.parse(JSON.stringify(obj));
obj.a = 5;
obj.b.c = 5;
console.log(JSON.stringify(deepClone)); // { a: 0, b: { c: 0}} 
```

* * *

## 回答 #28

> 赞同：11
> 
> 时间：2018-12-12T06:48:20.657

（以下主要整合了@Maciej [Bukowski](https://stackoverflow.com/a/39029912)、@ [A. Levy](https://stackoverflow.com/a/728694)、@ [Jan Turoň](https://stackoverflow.com/a/9023088) [、](https://stackoverflow.com/a/37503916) @ Redu的回答，以及@ [LeviRoberts](https://stackoverflow.com/questions/728360/how-do-i-correctly-clone-a-javascript-object/53737490#comment96229185_53737490)、@ [RobG](https://stackoverflow.com/q/728360#comment42972840_9023088)的评论，多谢他们！！！）

**深拷贝**？- 是的！（大多）;
**浅拷贝**？- 不！（除外`Proxy`）。

真诚欢迎大家来测试`clone()`。
此外，`defineProp()`旨在轻松快速地*（重新）定义或复制*任何类型的描述符。

# 功能

```
function clone(object) {
  /*
    Deep copy objects by value rather than by reference,
    exception: `Proxy`
  */

  const seen = new WeakMap()

  return clone(object)

  function clone(object) {
    if (object !== Object(object)) return object /*
    —— Check if the object belongs to a primitive data type */

    if (object instanceof Node) return object.cloneNode(true) /*
    —— Clone DOM trees */

    let _object // The clone of object

    switch (object.constructor) {
      case Array:
      case Object:
        _object = cloneObject(object)
        break

      case Date:
        _object = new Date(+object)
        break

      case Function:
        _object = copyFn(object)
        break

      case RegExp:
        _object = new RegExp(object)
        break

      default:
        switch (Object.prototype.toString.call(object.constructor)) {
          //                                  // Stem from:
          case "[object Function]":
            switch (object[Symbol.toStringTag]) {
              case undefined:
                _object = cloneObject(object) // `class`
                break

              case "AsyncFunction":
              case "GeneratorFunction":
              case "AsyncGeneratorFunction":
                _object = copyFn(object)
                break

              default:
                _object = object
            }
            break

          case "[object Undefined]":          // `Object.create(null)`
            _object = cloneObject(object)
            break

          default:
            _object = object                  // `Proxy`
        }
    }

    return _object
  }

  function cloneObject(object) {
    if (seen.has(object)) return seen.get(object) /*
    —— Handle recursive references (circular structures) */

    const _object = Array.isArray(object)
      ? []
      : Object.create(Object.getPrototypeOf(object)) /*
        —— Assign [[Prototype]] for inheritance */

    seen.set(object, _object) /*
    —— Make `_object` the associative mirror of `object` */

    Reflect.ownKeys(object).forEach(key =>
      defineProp(_object, key, { value: clone(object[key]) }, object)
    )

    return _object
  }
}

function copyPropDescs(target, source) {
  Object.defineProperties(target,
    Object.getOwnPropertyDescriptors(source)
  )
}

function convertFnToStr(fn) {
  let fnStr = String(fn)
  if (fn.name.startsWith("[")) // isSymbolKey
    fnStr = fnStr.replace(/\[Symbol\..+?\]/, '')
  fnStr = /^(?!(async )?(function\b|[^{]+?=>))[^(]+?\(/.test(fnStr)
    ? fnStr.replace(/^(async )?(\*)?/, "$1function$2 ") : fnStr
  return fnStr
}

function copyFn(fn) {
  const newFn = new Function(`return ${convertFnToStr(fn)}`)()
  copyPropDescs(newFn, fn)
  return newFn
}

function defineProp(object, key, descriptor = {}, copyFrom = {}) {
  const { configurable: _configurable, writable: _writable }
    = Object.getOwnPropertyDescriptor(object, key)
    || { configurable: true, writable: true }

  const test = _configurable // Can redefine property
    && (_writable === undefined || _writable) // Can assign to property

  if (!test || arguments.length <= 2) return test

  const basisDesc = Object.getOwnPropertyDescriptor(copyFrom, key)
    || { configurable: true, writable: true } // Custom…
    || {}; // …or left to native default settings

  ["get", "set", "value", "writable", "enumerable", "configurable"]
    .forEach(attr =>
      descriptor[attr] === undefined &&
      (descriptor[attr] = basisDesc[attr])
    )

  const { get, set, value, writable, enumerable, configurable }
    = descriptor

  return Object.defineProperty(object, key, {
    enumerable, configurable, ...get || set
      ? { get, set } // Accessor descriptor
      : { value, writable } // Data descriptor
  })
} 
```

## // 测试

```
const obj0 = {
  u: undefined,
  nul: null,
  t: true,
  num: 9,
  str: "",
  sym: Symbol("symbol"),
  [Symbol("e")]: Math.E,
  arr: [[0], [1, 2]],
  d: new Date(),
  re: /f/g,
  get g() { return 0 },
  o: {
    n: 0,
    o: { f: function (...args) { } }
  },
  f: {
    getAccessorStr(object) {
      return []
        .concat(...
          Object.values(Object.getOwnPropertyDescriptors(object))
            .filter(desc => desc.writable === undefined)
            .map(desc => Object.values(desc))
        )
        .filter(prop => typeof prop === "function")
        .map(String)
    },
    f0: function f0() { },
    f1: function () { },
    f2: a => a / (a + 1),
    f3: () => 0,
    f4(params) { return param => param + params },
    f5: (a, b) => ({ c = 0 } = {}) => a + b + c
  }
}

defineProp(obj0, "s", { set(v) { this._s = v } })
defineProp(obj0.arr, "tint", { value: { is: "non-enumerable" } })
obj0.arr[0].name = "nested array"

let obj1 = clone(obj0)
obj1.o.n = 1
obj1.o.o.g = function g(a = 0, b = 0) { return a + b }
obj1.arr[1][1] = 3
obj1.d.setTime(+obj0.d + 60 * 1000)
obj1.arr.tint.is = "enumerable? no"
obj1.arr[0].name = "a nested arr"
defineProp(obj1, "s", { set(v) { this._s = v + 1 } })
defineProp(obj1.re, "multiline", { value: true })

console.log("\n\n" + "-".repeat(2 ** 6))

console.log(">:>: Test - Routinely")

console.log("obj0:\n ", JSON.stringify(obj0))
console.log("obj1:\n ", JSON.stringify(obj1))
console.log()

console.log("obj0:\n ", obj0)
console.log("obj1:\n ", obj1)
console.log()

console.log("obj0\n ",
  ".arr.tint:", obj0.arr.tint, "\n ",
  ".arr[0].name:", obj0.arr[0].name
)
console.log("obj1\n ",
  ".arr.tint:", obj1.arr.tint, "\n ",
  ".arr[0].name:", obj1.arr[0].name
)
console.log()

console.log("Accessor-type descriptor\n ",
  "of obj0:", obj0.f.getAccessorStr(obj0), "\n ",
  "of obj1:", obj1.f.getAccessorStr(obj1), "\n ",
  "set (obj0 & obj1) .s :", obj0.s = obj1.s = 0, "\n ",
  "  → (obj0 , obj1) ._s:", obj0._s, ",", obj1._s
)

console.log("—— obj0 has not been interfered.")

console.log("\n\n" + "-".repeat(2 ** 6))

console.log(">:>: Test - More kinds of functions")

const fnsForTest = {
  f(_) { return _ },
  func: _ => _,
  aFunc: async _ => _,
  async function() { },
  async asyncFunc() { },
  aFn: async function () { },
  *gen() { },
  async *asyncGen() { },
  aG1: async function* () { },
  aG2: async function* gen() { },
  *[Symbol.iterator]() { yield* Object.keys(this) }
}

console.log(Reflect.ownKeys(fnsForTest).map(k =>
  `${String(k)}:
  ${fnsForTest[k].name}-->
    ${String(fnsForTest[k])}`
).join("\n"))

const normedFnsStr = `{
  f: function f(_) { return _ },
  func: _ => _,
  aFunc: async _ => _,
  function: async function() { },
  asyncFunc: async function asyncFunc() { },
  aFn: async function () { },
  gen: function* gen() { },
  asyncGen: async function* asyncGen() { },
  aG1: async function* () { },
  aG2: async function* gen() { },
  [Symbol.iterator]: function* () { yield* Object.keys(this) }
}`

const copiedFnsForTest = clone(fnsForTest)
console.log("fnsForTest:", fnsForTest)
console.log("fnsForTest (copied):", copiedFnsForTest)
console.log("fnsForTest (normed str):", eval(`(${normedFnsStr})`))
console.log("Comparison of fnsForTest and its clone:",
  Reflect.ownKeys(fnsForTest).map(k =>
    [k, fnsForTest[k] === copiedFnsForTest[k]]
  )
)

console.log("\n\n" + "-".repeat(2 ** 6))

console.log(">:>: Test - Circular structures")

obj0.o.r = {}
obj0.o.r.recursion = obj0.o
obj0.arr[1] = obj0.arr

obj1 = clone(obj0)
console.log("obj0:\n ", obj0)
console.log("obj1:\n ", obj1)

console.log("Clear obj0's recursion:",
  obj0.o.r.recursion = null, obj0.arr[1] = 1
)
console.log(
  "obj0\n ",
  ".o.r:", obj0.o.r, "\n ",
  ".arr:", obj0.arr
)
console.log(
  "obj1\n ",
  ".o.r:", obj1.o.r, "\n ",
  ".arr:", obj1.arr
)
console.log("—— obj1 has not been interfered.")

console.log("\n\n" + "-".repeat(2 ** 6))

console.log(">:>: Test - Classes")

class Person {
  constructor(name) {
    this.name = name
  }
}

class Boy extends Person { }
Boy.prototype.sex = "M"

const boy0 = new Boy
boy0.hobby = { sport: "spaceflight" }

const boy1 = clone(boy0)
boy1.hobby.sport = "superluminal flight"

boy0.name = "one"
boy1.name = "neo"

console.log("boy0:\n ", boy0)
console.log("boy1:\n ", boy1)
console.log("boy1's prototype === boy0's:",
  Object.getPrototypeOf(boy1) === Object.getPrototypeOf(boy0)
) 
```

# 参考

1.  [`Object.create()`| MDN](https://mdn.io/Object/create)
2.  [`Object.defineProperties()`| MDN](https://mdn.io/Object/defineProperties)
3.  [属性的可枚举性和所有权 | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Enumerability_and_ownership_of_properties#Detection_Table)
4.  [TypeError: 循环对象值 | MDN](https://mdn.io/Errors/Cyclic_object_value)

# 使用的语言技巧

1.  [有条件地向对象添加道具](https://stackoverflow.com/a/40560953)

* * *

## 回答 #29

> 赞同：10
> 
> 时间：2019-08-15T03:24:02.867

> ***[使用 lodash _.cloneDeep()。](https://lodash.com/docs/4.17.15#cloneDeep)***

***浅拷贝：lodash _.clone()***

*可以通过简单地复制引用来进行浅拷贝。*

```
let obj1 = {
    a: 0,
    b: {
        c: 0,
        e: {
            f: 0
        }
    }
};
let obj3 = _.clone(obj1);
obj1.a = 4;
obj1.b.c = 4;
obj1.b.e.f = 100;

console.log(JSON.stringify(obj1));
//{"a":4,"b":{"c":4,"e":{"f":100}}}

console.log(JSON.stringify(obj3));
//{"a":0,"b":{"c":4,"e":{"f":100}}} 
```

[![浅拷贝：lodash _.clone()](https://i.stack.imgur.com/vmysI.png)](https://i.stack.imgur.com/vmysI.png)

***深拷贝：lodash _.cloneDeep()***

*字段被取消引用：而不是对被复制对象的引用*

```
let obj1 = {
    a: 0,
    b: {
        c: 0,
        e: {
            f: 0
        }
    }
};
let obj3 = _.cloneDeep(obj1);
obj1.a = 100;
obj1.b.c = 100;
obj1.b.e.f = 100;

console.log(JSON.stringify(obj1));
{"a":100,"b":{"c":100,"e":{"f":100}}}

console.log(JSON.stringify(obj3));
{"a":0,"b":{"c":0,"e":{"f":0}}} 
```

[![深拷贝：lodash _.cloneDeep()](https://i.stack.imgur.com/z0M6n.png)](https://i.stack.imgur.com/z0M6n.png)

* * *

## 回答 #30

> 赞同：8
> 
> 时间：2012-07-12T23:15:38.623

这是对 A. Levy 的代码的改编，也可以处理函数的克隆和多个/循环引用 - 这意味着如果被克隆的树中的两个属性是同一对象的引用，则克隆的对象树将具有这些属性指向被引用对象的同一个克隆。这也解决了循环依赖的情况，如果不加以处理，就会导致无限循环。算法的复杂度为 O(n)

```
function clone(obj){
    var clonedObjectsArray = [];
    var originalObjectsArray = []; //used to remove the unique ids when finished
    var next_objid = 0;

    function objectId(obj) {
        if (obj == null) return null;
        if (obj.__obj_id == undefined){
            obj.__obj_id = next_objid++;
            originalObjectsArray[obj.__obj_id] = obj;
        }
        return obj.__obj_id;
    }

    function cloneRecursive(obj) {
        if (null == obj || typeof obj == "string" || typeof obj == "number" || typeof obj == "boolean") return obj;

        // Handle Date
        if (obj instanceof Date) {
            var copy = new Date();
            copy.setTime(obj.getTime());
            return copy;
        }

        // Handle Array
        if (obj instanceof Array) {
            var copy = [];
            for (var i = 0; i < obj.length; ++i) {
                copy[i] = cloneRecursive(obj[i]);
            }
            return copy;
        }

        // Handle Object
        if (obj instanceof Object) {
            if (clonedObjectsArray[objectId(obj)] != undefined)
                return clonedObjectsArray[objectId(obj)];

            var copy;
            if (obj instanceof Function)//Handle Function
                copy = function(){return obj.apply(this, arguments);};
            else
                copy = {};

            clonedObjectsArray[objectId(obj)] = copy;

            for (var attr in obj)
                if (attr != "__obj_id" && obj.hasOwnProperty(attr))
                    copy[attr] = cloneRecursive(obj[attr]);                 

            return copy;
        }       

        throw new Error("Unable to copy obj! Its type isn't supported.");
    }
    var cloneObj = cloneRecursive(obj);

    //remove the unique ids
    for (var i = 0; i < originalObjectsArray.length; i++)
    {
        delete originalObjectsArray[i].__obj_id;
    };

    return cloneObj;
} 
```

一些快速测试

```
var auxobj = {
    prop1 : "prop1 aux val", 
    prop2 : ["prop2 item1", "prop2 item2"]
    };

var obj = new Object();
obj.prop1 = "prop1_value";
obj.prop2 = [auxobj, auxobj, "some extra val", undefined];
obj.nr = 3465;
obj.bool = true;

obj.f1 = function (){
    this.prop1 = "prop1 val changed by f1";
};

objclone = clone(obj);

//some tests i've made
console.log("test number, boolean and string cloning: " + (objclone.prop1 == obj.prop1 && objclone.nr == obj.nr && objclone.bool == obj.bool));

objclone.f1();
console.log("test function cloning 1: " + (objclone.prop1 == 'prop1 val changed by f1'));
objclone.f1.prop = 'some prop';
console.log("test function cloning 2: " + (obj.f1.prop == undefined));

objclone.prop2[0].prop1 = "prop1 aux val NEW";
console.log("test multiple references cloning 1: " + (objclone.prop2[1].prop1 == objclone.prop2[0].prop1));
console.log("test multiple references cloning 2: " + (objclone.prop2[1].prop1 != obj.prop2[0].prop1)); 
```

* * *

## 回答 #31

> 赞同：8
> 
> 时间：2013-08-10T22:45:08.877

# 结构化克隆

在此处查看[我对一个几乎重复的问题的回答](https://stackoverflow.com/a/10916838/157247)。您可以使用 HTML 标准包含的相同结构化克隆机制在领域之间发送数据。很快，您将能够通过新的`structuredClone`全局方法做到这一点。

```
const clone = structuredClone(original); 
```

有关更多详细信息，请参阅[其他答案](https://stackoverflow.com/a/10916838/157247)。

* * *

## 回答 #32

> 赞同：8
> 
> 时间：2020-08-13T13:19:47.460

最正确的复制对象是使用`Object.create`：

```
Object.create(Object.getPrototypeOf(obj), Object.getOwnPropertyDescriptors(obj)); 
```

这样的符号将使相同的对象具有正确的原型和隐藏属性。

* * *

## 回答 #33

> 赞同：6
> 
> 时间：2012-06-03T09:29:51.493

我只是想添加到`Object.create`这篇文章中的所有解决方案，这不适用于 nodejs。

在 Firefox 中的结果

```
var a = {"test":"test"};
var b = Object.create(a);
console.log(b);´ 
```

是

`{test:"test"}`.

在nodejs中是

```
{} 
```

* * *

## 回答 #34

> 赞同：6
> 
> 时间：2012-07-23T21:43:48.160

```
function clone(src, deep) {

    var toString = Object.prototype.toString;
    if(!src && typeof src != "object"){
        //any non-object ( Boolean, String, Number ), null, undefined, NaN
        return src;
    }

    //Honor native/custom clone methods
    if(src.clone && toString.call(src.clone) == "[object Function]"){
        return src.clone(deep);
    }

    //DOM Elements
    if(src.nodeType && toString.call(src.cloneNode) == "[object Function]"){
        return src.cloneNode(deep);
    }

    //Date
    if(toString.call(src) == "[object Date]"){
        return new Date(src.getTime());
    }

    //RegExp
    if(toString.call(src) == "[object RegExp]"){
        return new RegExp(src);
    }

    //Function
    if(toString.call(src) == "[object Function]"){
        //Wrap in another method to make sure == is not true;
        //Note: Huge performance issue due to closures, comment this :)
        return (function(){
            src.apply(this, arguments);
        });

    }

    var ret, index;
    //Array
    if(toString.call(src) == "[object Array]"){
        //[].slice(0) would soft clone
        ret = src.slice();
        if(deep){
            index = ret.length;
            while(index--){
                ret[index] = clone(ret[index], true);
            }
        }
    }
    //Object
    else {
        ret = src.constructor ? new src.constructor() : {};
        for (var prop in src) {
            ret[prop] = deep
                ? clone(src[prop], true)
                : src[prop];
        }
    }

    return ret;
}; 
```

* * *

## 回答 #35

> 赞同：6
> 
> 时间：2012-11-28T18:48:47.300

由于[mindeavor](https://stackoverflow.com/users/49695/mindeavor)声明要克隆的对象是“文字构造”对象，因此解决方案可能是简单地多次*生成对象而不是克隆对象的实例：*

```
function createMyObject()
{
    var myObject =
    {
        ...
    };
    return myObject;
}

var myObjectInstance1 = createMyObject();
var myObjectInstance2 = createMyObject(); 
```

* * *

## 回答 #36

> 赞同：6
> 
> 时间：2014-11-12T01:25:16.797

我已经编写了自己的实现。不确定它是否算作更好的解决方案：

```
/*
    a function for deep cloning objects that contains other nested objects and circular structures.
    objects are stored in a 3D array, according to their length (number of properties) and their depth in the original object.
                                    index (z)
                                         |
                                         |
                                         |
                                         |
                                         |
                                         |                      depth (x)
                                         |_ _ _ _ _ _ _ _ _ _ _ _
                                        /_/_/_/_/_/_/_/_/_/
                                       /_/_/_/_/_/_/_/_/_/
                                      /_/_/_/_/_/_/...../
                                     /................./
                                    /.....            /
                                   /                 /
                                  /------------------
            object length (y)    /
*/ 
```

以下是实现：

```
function deepClone(obj) {
    var depth = -1;
    var arr = [];
    return clone(obj, arr, depth);
}

/**
 *
 * @param obj source object
 * @param arr 3D array to store the references to objects
 * @param depth depth of the current object relative to the passed 'obj'
 * @returns {*}
 */
function clone(obj, arr, depth){
    if (typeof obj !== "object") {
        return obj;
    }

    var length = Object.keys(obj).length; // native method to get the number of properties in 'obj'

    var result = Object.create(Object.getPrototypeOf(obj)); // inherit the prototype of the original object
    if(result instanceof Array){
        result.length = length;
    }

    depth++; // depth is increased because we entered an object here

    arr[depth] = []; // this is the x-axis, each index here is the depth
    arr[depth][length] = []; // this is the y-axis, each index is the length of the object (aka number of props)
    // start the depth at current and go down, cyclic structures won't form on depths more than the current one
    for(var x = depth; x >= 0; x--){
        // loop only if the array at this depth and length already have elements
        if(arr[x][length]){
            for(var index = 0; index < arr[x][length].length; index++){
                if(obj === arr[x][length][index]){
                    return obj;
                }
            }
        }
    }

    arr[depth][length].push(obj); // store the object in the array at the current depth and length
    for (var prop in obj) {
        if (obj.hasOwnProperty(prop)) result[prop] = clone(obj[prop], arr, depth);
    }

    return result;
} 
```

* * *

## 回答 #37

> 赞同：5
> 
> 时间：2012-03-30T06:03:57.270

Jan Turoň 上面的答案非常接近，由于兼容性问题，可能最好在浏览器中使用，但它可能会导致一些奇怪的枚举问题。例如，执行：

```
for ( var i in someArray ) { ... } 
```

在遍历数组的元素后将 clone() 方法分配给 i 。这是避免枚举并与 node.js 一起使用的改编：

```
Object.defineProperty( Object.prototype, "clone", {
    value: function() {
        if ( this.cloneNode )
        {
            return this.cloneNode( true );
        }

        var copy = this instanceof Array ? [] : {};
        for( var attr in this )
        {
            if ( typeof this[ attr ] == "function" || this[ attr ] == null || !this[ attr ].clone )
            {
                copy[ attr ] = this[ attr ];
            }
            else if ( this[ attr ] == this )
            {
                copy[ attr ] = copy;
            }
            else
            {
                copy[ attr ] = this[ attr ].clone();
            }
        }
        return copy;
    }
});

Object.defineProperty( Date.prototype, "clone", {
    value: function() {
        var copy = new Date();
        copy.setTime( this.getTime() );
        return copy;
    }
});

Object.defineProperty( Number.prototype, "clone", { value: function() { return this; } } );
Object.defineProperty( Boolean.prototype, "clone", { value: function() { return this; } } );
Object.defineProperty( String.prototype, "clone", { value: function() { return this; } } ); 
```

这避免了使 clone() 方法可枚举，因为 defineProperty() 默认可枚举为 false。

* * *

## 回答 #38

> 赞同：5
> 
> 时间：2016-08-05T18:49:37.657

使用`deepcopy`从`npm`. 在浏览器和`node`作为`npm module...`

[https://www.npmjs.com/package/deepcopy](https://www.npmjs.com/package/deepcopy)

`let a = deepcopy(b)`

* * *

## 回答 #39

> 赞同：5
> 
> 时间：2019-09-11T06:37:18.827

**使用 ( ...** )复制对象

```
//bad
const original = { a: 1, b: 2 };
const copy = Object.assign({}, original, { c: 3 }); // copy => { a: 1, b: 2,c: 3 }

//good
const originalObj = { id: 5, name: 'San Francisco'};
const copyObject = {...originalObj, pincode: 4444};
console.log(copyObject)  //{ id: 5, name: 'San Francisco', pincode: 4444 } 
```

同样可用于**将数组**从一个复制到另一个

```
const itemsCopy = [...items]; 
```

* * *

## 回答 #40

> 赞同：5
> 
> 时间：2020-01-01T03:48:52.177

克隆对象的简单递归方法。也可以使用 lodash.clone。

```
let clone = (obj) => {
	let obj2 = Array.isArray(obj) ? [] : {};
	for(let k in obj) {
          obj2[k] = (typeof obj[k] === 'object' ) ? clone(obj[k]) :  obj[k];
        }
        return obj2;
    }

let w = { name: "Apple", types: ["Fuji", "Gala"]};
let x = clone(w);
w.name = "Orange";
w.types = ["Navel"];
console.log(x);
console.log(w);
```

* * *

## 回答 #41

> 赞同：4
> 
> 时间：2013-04-16T02:56:17.070

请参阅[http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#safe-passing-of-structured-data](http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#safe-passing-of-structured-data)了解 W3C 的“结构化数据安全传递”算法，该算法旨在实现通过浏览器将数据传递给例如网络工作者。但是，它有一些限制，因为它不处理函数。有关更多信息，请参阅[https://developer.mozilla.org/en-US/docs/DOM/The_structured_clone_algorithm](https://developer.mozilla.org/en-US/docs/DOM/The_structured_clone_algorithm)，包括 JS 中的另一种算法，它可以让您部分实现。

* * *

## 回答 #42

> 赞同：4
> 
> 时间：2015-01-30T21:16:21.583

克隆一个基于`template`. 如果您不想要一个精确的副本，但您确实想要某种可靠克隆操作的鲁棒性但您只想要克隆位，或者您想确保您可以控制每个属性值的存在或格式，您会怎么做克隆？

我贡献这个是因为它对我们有用，我们创建它是因为我们找不到类似的东西。您可以使用它来克隆一个基于对象的`template`对象，该对象指定我要克隆的对象的哪些属性，并且模板允许函数将这些属性转换为不同的东西，如果它们不存在于源对象上，或者你想要处理克隆。如果它没有用，我相信有人可以删除这个答案。

```
 function isFunction(functionToCheck) {
       var getType = {};
       return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';
   }

   function cloneObjectByTemplate(obj, tpl, cloneConstructor) {
       if (typeof cloneConstructor === "undefined") {
           cloneConstructor = false;
       }
       if (obj == null || typeof (obj) != 'object') return obj;

       //if we have an array, work through it's contents and apply the template to each item...
       if (Array.isArray(obj)) {
           var ret = [];
           for (var i = 0; i < obj.length; i++) {
               ret.push(cloneObjectByTemplate(obj[i], tpl, cloneConstructor));
           }
           return ret;
       }

       //otherwise we have an object...
       //var temp:any = {}; // obj.constructor(); // we can't call obj.constructor because typescript defines this, so if we are dealing with a typescript object it might reset values.
       var temp = cloneConstructor ? new obj.constructor() : {};

       for (var key in tpl) {
           //if we are provided with a function to determine the value of this property, call it...
           if (isFunction(tpl[key])) {
               temp[key] = tpl[key](obj); //assign the result of the function call, passing in the value
           } else {
               //if our object has this property...
               if (obj[key] != undefined) {
                   if (Array.isArray(obj[key])) {
                       temp[key] = [];
                       for (var i = 0; i < obj[key].length; i++) {
                           temp[key].push(cloneObjectByTemplate(obj[key][i], tpl[key], cloneConstructor));
                       }
                   } else {
                       temp[key] = cloneObjectByTemplate(obj[key], tpl[key], cloneConstructor);
                   }
               }
           }
       }

       return temp;
   } 
```

一个简单的调用方法是这样的：

```
var source = {
       a: "whatever",
       b: {
           x: "yeah",
           y: "haha"
       }
   };
   var template = {
       a: true, //we want to clone "a"
       b: {
           x: true //we want to clone "b.x" too
       }
   }; 
   var destination = cloneObjectByTemplate(source, template); 
```

如果您想使用函数来确保返回属性或确保它是特定类型，请使用这样的模板。我们没有使用，而是`{ ID: true }`提供了一个仍然只是复制`ID attribute`源对象的函数，但它确保它是一个数字，即使它不存在于源对象上。

```
 var template = {
    ID: function (srcObj) {
        if(srcObj.ID == undefined){ return -1; }
        return parseInt(srcObj.ID.toString());
    }
} 
```

数组可以很好地克隆，但如果您愿意，您也可以让自己的函数处理这些单独的属性，并执行以下特殊操作：

```
 var template = {
    tags: function (srcObj) {
        var tags = [];
        if (process.tags != undefined) {
            for (var i = 0; i < process.tags.length; i++) {

                tags.push(cloneObjectByTemplate(
                  srcObj.tags[i],
                  { a : true, b : true } //another template for each item in the array
                );
            }
        }
        return tags;
    }
 } 
```

所以在上面，我们的模板只是复制`tags`源对象的属性（如果它存在）（假设它是一个数组），并且对于该数组中的每个元素，调用克隆函数以基于第二个模板单独克隆它只需复制每个标签元素的`a`和`b`属性。

如果您将对象进出节点，并且您想控制这些对象的哪些属性被克隆，那么这是控制它的好方法，`node.js`并且代码也可以在浏览器中工作。

这是它的使用示例：http: [//jsfiddle.net/hjchyLt1/](http://jsfiddle.net/hjchyLt1/)

* * *

## 回答 #43

> 赞同：4
> 
> 时间：2018-11-09T12:24:05.663

**根据**404 位贡献者的**[Airbnb JavaScript 风格指南：](https://github.com/airbnb/javascript#objects--rest-spread)**

> 将对象扩展运算符优于 Object.assign 用于浅拷贝对象。使用 object rest 运算符获取省略某些属性的新对象。

```
// very bad
const original = { a: 1, b: 2 };
const copy = Object.assign(original, { c: 3 }); // this mutates `original` ಠ_ಠ
delete copy.a; // so does this

// bad
const original = { a: 1, b: 2 };
const copy = Object.assign({}, original, { c: 3 }); // copy => { a: 1, b: 2, c: 3 }

// good
const original = { a: 1, b: 2 };
const copy = { ...original, c: 3 }; // copy => { a: 1, b: 2, c: 3 }

const { a, ...noA } = copy; // noA => { b: 2, c: 3 } 
```

**另外我想警告您，即使 Airbnb 几乎不推荐对象传播运算符方法。请记住，Microsoft Edge 仍然不支持此 2018 功能。**

[ES2016+兼容表>>](http://kangax.github.io/compat-table/es2016plus/)

* * *

## 回答 #44

> 赞同：4
> 
> 时间：2019-06-16T15:58:20.040

正[如此链接](https://javascript.info/prototype-methods)所说，使用此代码：

```
let clone = Object.create(Object.getPrototypeOf(obj),
 Object.getOwnPropertyDescriptors(obj)); 
```

* * *

## 回答 #45

> 赞同：4
> 
> 时间：2019-08-12T12:23:14.783

简单的

```
var restore = { name:'charlesi',
age:9}
var prev_data ={
name: 'charles'
age : 10
}

var temp = JSON.stringify(prev_data)
restore = JSON.parse(temp)

restore = {
name:'charlie',
age : 12} 
```

输出 prev_data：

```
{
name: 'charles'
age : 10
} 
```

* * *

## 回答 #46

> 赞同：3
> 
> 时间：2013-01-07T18:30:05.627

在我的代码中，我经常定义 a`function (_)`来处理副本，以便我可以传递`by value`给函数。此代码创建一个深层副本，但保持继承。它还跟踪子副本，以便可以在没有无限循环的情况下复制自引用对象。随意使用它。

它可能不是最优雅的，但它还没有让我失望。

```
_ = function(oReferance) {
  var aReferances = new Array();
  var getPrototypeOf = function(oObject) {
    if(typeof(Object.getPrototypeOf)!=="undefined") return Object.getPrototypeOf(oObject);
    var oTest = new Object();
    if(typeof(oObject.__proto__)!=="undefined"&&typeof(oTest.__proto__)!=="undefined"&&oTest.__proto__===Object.prototype) return oObject.__proto__;
    if(typeof(oObject.constructor)!=="undefined"&&typeof(oTest.constructor)!=="undefined"&&oTest.constructor===Object&&typeof(oObject.constructor.prototype)!=="undefined") return oObject.constructor.prototype;
    return Object.prototype;
  };
  var recursiveCopy = function(oSource) {
    if(typeof(oSource)!=="object") return oSource;
    if(oSource===null) return null;
    for(var i=0;i<aReferances.length;i++) if(aReferances[i][0]===oSource) return aReferances[i][1];
    var Copy = new Function();
    Copy.prototype = getPrototypeOf(oSource);
    var oCopy = new Copy();
    aReferances.push([oSource,oCopy]);
    for(sPropertyName in oSource) if(oSource.hasOwnProperty(sPropertyName)) oCopy[sPropertyName] = recursiveCopy(oSource[sPropertyName]);
    return oCopy;
  };
  return recursiveCopy(oReferance);
};

// Examples:
Wigit = function(){};
Wigit.prototype.bInThePrototype = true;
A = new Wigit();
A.nCoolNumber = 7;
B = _(A);
B.nCoolNumber = 8; // A.nCoolNumber is still 7
B.bInThePrototype // true
B instanceof Wigit // true 
```

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2014-01-16T21:52:49.180

您可以使用功能闭包来获得深拷贝的所有好处，而无需深拷贝。这是一个非常不同的范例，但效果很好。与其尝试复制现有对象，不如在需要时使用一个函数来实例化一个新对象。

首先，创建一个返回对象的函数

```
function template() {
  return {
    values: [1, 2, 3],
    nest: {x: {a: "a", b: "b"}, y: 100}
  };
} 
```

然后创建一个简单的浅拷贝函数

```
function copy(a, b) {
  Object.keys(b).forEach(function(key) {
    a[key] = b[key];
  });
} 
```

创建一个新对象，并将模板的属性复制到它上面

```
var newObject = {}; 
copy(newObject, template()); 
```

但是上面的复制步骤不是必须的。您需要做的就是：

```
var newObject = template(); 
```

现在你有了一个新对象，测试一下它的属性是什么：

```
console.log(Object.keys(newObject)); 
```

这显示：

```
["values", "nest"] 
```

是的，这些是 newObject 自己的属性，而不是对另一个对象的属性的引用。让我们检查一下：

```
console.log(newObject.nest.x.b); 
```

这显示：

```
"b" 
```

newObject 获得了模板对象的所有属性，但没有任何依赖链。

[http://jsbin.com/ISUTIpoC/1/edit?js,console](http://jsbin.com/ISUTIpoC/1/edit?js,console)

我添加了这个例子来鼓励一些辩论，所以请添加一些评论:)

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2016-08-19T01:46:09.303

我认为，在没有库的情况下，**使用缓存重复**是我们可以做到的最好的方法。

而被低估的**WeakMap**会遇到循环问题，其中存储对新旧对象的引用对可以帮助我们轻松地重新创建整个树。

我阻止了 DOM 元素的深度克隆，可能你不想克隆整个页面 :)

```
function deepCopy(object) {
    const cache = new WeakMap(); // Map of old - new references

    function copy(obj) {
        if (typeof obj !== 'object' ||
            obj === null ||
            obj instanceof HTMLElement
        )
            return obj; // primitive value or HTMLElement

        if (obj instanceof Date) 
            return new Date().setTime(obj.getTime());

        if (obj instanceof RegExp) 
            return new RegExp(obj.source, obj.flags);

        if (cache.has(obj)) 
            return cache.get(obj);

        const result = obj instanceof Array ? [] : {};

        cache.set(obj, result); // store reference to object before the recursive starts

        if (obj instanceof Array) {
            for(const o of obj) {
                 result.push(copy(o));
            }
            return result;
        }

        const keys = Object.keys(obj); 

        for (const key of keys)
            result[key] = copy(obj[key]);

        return result;
    }

    return copy(object);
} 
```

一些测试：

```
// #1
const obj1 = { };
const obj2 = { };
obj1.obj2 = obj2;
obj2.obj1 = obj1; // Trivial circular reference

var copy = deepCopy(obj1);
copy == obj1 // false
copy.obj2 === obj1.obj2 // false
copy.obj2.obj1.obj2 // and so on - no error (correctly cloned).

// #2
const obj = { x: 0 }
const clone = deepCopy({ a: obj, b: obj });
clone.a == clone.b // true

// #3
const arr = [];
arr[0] = arr; // A little bit weird but who cares
clone = deepCopy(arr)
clone == arr // false;
clone[0][0][0][0] == clone // true; 
```

注意：我使用常量、for of 循环、=> 运算符和 WeakMaps 来创建更重要的代码。今天的浏览器支持这种语法（ES6）

* * *

## 回答 #49

> 赞同：3
> 
> 时间：2020-01-20T09:09:45.463

`JSON.parse(JSON.stringify(orig_obj)`正如许多同行所说的 deep_cloning解决方案有几个我发现的问题，它们列在下面：

1.  `undefined`它在复制原始对象中的值时丢弃条目，
2.  如果有一些值，比如`Infinity`，`NaN`等等，它们将`null`在复制时转换成，
3.  如果原始对象中有`Date`类型，它将在克隆对象中被字符串化（`typeof date_entry --> string`）。

找到了一种克隆对象的有效方法，它在各种情况下都对我很有效。请看下面的代码，因为它解决了上面提到的所有陷阱`JSON.parse(...)`，但导致正确的深度克隆：

```
var orig_obj = {
  string: 'my_str',
  number: 123,
  bool: false,
  nul: null,
  nested : {
    value : true
  },
  nan : NaN,
  date: new Date(), 
  undef: undefined,
  inf: Infinity,
}
console.log("original_obj before modification: ", orig_obj, "\n");
console.log(typeof orig_obj.date, "\n");

var clone_obj = Object.assign({}, orig_obj);

//this below loop will help in deep cloning and solving above issues
for(let prop in orig_obj) {
    if(typeof orig_obj[prop] === "object") {
        if(orig_obj[prop] instanceof Date)
            clone_obj[prop] = orig_obj[prop];
        else {
            clone_obj[prop] = JSON.parse(JSON.stringify(orig_obj[prop]));
        }
    }
}

console.log("cloned_obj before modification: ", orig_obj, "\n");

clone_obj.bool = true;
clone_obj.nested.value = "false";

console.log("original_obj post modification: ", orig_obj, "\n");
console.log("cloned_obj post modification: ", clone_obj, "\n");
console.log(typeof clone_obj.date); 
```

* * *

## 回答 #50

> 赞同：3
> 
> 时间：2022-01-02T16:00:32.133

原生 JS：

```
const shallowClone = {...originalObj};
const deepClone = JSON.parse(JSON.stringify(originalObj)); 
```

使用库：

```
// Lodash
const shallowClone = _.clone(originalObj);
const deepClone = _. cloneDeep(originalObj);

// JQuery
const shallowClone = jQuery.extend({}, originalObj);
const deepClone = jQuery.extend(true, {}, originalObj);

// Angular
const deepClone = angular.copy(originalObj); 
```

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2014-10-28T19:06:15.070

我已经在标量对象的情况下尝试过这个，它对我有用：

```
function binder(i) {
  return function () {
    return i;
  };
}

a=1;
b=binder(a)(); // copy value of a into b

alert(++a); // 2
alert(b); // still 1 
```

问候。

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2017-10-25T06:15:09.023

这是一个没有以下缺陷的现代解决方案`Object.assign()`（不通过引用复制）：

```
const cloneObj = (obj) => {
    return Object.keys(obj).reduce((dolly, key) => {
        dolly[key] = (obj[key].constructor === Object) ?
            cloneObj(obj[key]) :
            obj[key];
        return dolly;
    }, {});
}; 
```

* * *

## 回答 #53

> 赞同：2
> 
> 时间：2019-01-23T19:39:07.453

使用[默认值](https://www.npmjs.com/package/defaults)（历史上特定于 nodejs，但现在可以从浏览器中使用，这要归功于现代 JS）：

```
import defaults from 'object.defaults';

const myCopy = defaults({}, myObject); 
```

* * *

## 回答 #54

> 赞同：2
> 
> 时间：2019-02-25T07:39:14.283

为了更好地理解对象的复制，[这个说明性的 jsbin 可能很有价值](https://jsbin.com/sekarup/edit?js,console)

```
class base {
  get under(){return true}
}

class a extends base {}

const b = {
  get b1(){return true},
  b: true
}

console.log('Object assign')
let t1 = Object.create(b)
t1.x = true
const c = Object.assign(t1, new a())
console.log(c.b1 ? 'prop value copied': 'prop value gone')
console.log(c.x ? 'assigned value copied': 'assigned value gone')
console.log(c.under ? 'inheritance ok': 'inheritance gone')
console.log(c.b1 ? 'get value unchanged' : 'get value lost')
c.b1 = false
console.log(c.b1? 'get unchanged' : 'get lost')
console.log('-----------------------------------')
console.log('Object assign  - order swopped')
t1 = Object.create(b)
t1.x = true
const d = Object.assign(new a(), t1)
console.log(d.b1 ? 'prop value copied': 'prop value gone')
console.log(d.x ? 'assigned value copied': 'assigned value gone')
console.log(d.under ? 'inheritance n/a': 'inheritance gone')
console.log(d.b1 ? 'get value copied' : 'get value lost')
d.b1 = false
console.log(d.b1? 'get copied' : 'get lost')
console.log('-----------------------------------')
console.log('Spread operator')
t1 = Object.create(b)
t2 = new a()
t1.x = true
const e = { ...t1, ...t2 }
console.log(e.b1 ? 'prop value copied': 'prop value gone')
console.log(e.x ? 'assigned value copied': 'assigned value gone')
console.log(e.under ? 'inheritance ok': 'inheritance gone')
console.log(e.b1 ? 'get value copied' : 'get value lost')
e.b1 = false
console.log(e.b1? 'get copied' : 'get lost')
console.log('-----------------------------------')
console.log('Spread operator on getPrototypeOf')
t1 = Object.create(b)
t2 = new a()
t1.x = true
const e1 = { ...Object.getPrototypeOf(t1), ...Object.getPrototypeOf(t2) }
console.log(e1.b1 ? 'prop value copied': 'prop value gone')
console.log(e1.x ? 'assigned value copied': 'assigned value gone')
console.log(e1.under ? 'inheritance ok': 'inheritance gone')
console.log(e1.b1 ? 'get value copied' : 'get value lost')
e1.b1 = false
console.log(e1.b1? 'get copied' : 'get lost')
console.log('-----------------------------------')
console.log('keys, defineProperty, getOwnPropertyDescriptor')
f = Object.create(b)
t2 = new a()
f.x = 'a'
Object.keys(t2).forEach(key=> {
  Object.defineProperty(f,key,Object.getOwnPropertyDescriptor(t2, key))
})
console.log(f.b1 ? 'prop value copied': 'prop value gone')
console.log(f.x ? 'assigned value copied': 'assigned value gone')
console.log(f.under ? 'inheritance ok': 'inheritance gone')
console.log(f.b1 ? 'get value copied' : 'get value lost')
f.b1 = false
console.log(f.b1? 'get copied' : 'get lost')
console.log('-----------------------------------')
console.log('defineProperties, getOwnPropertyDescriptors')
let g = Object.create(b)
t2 = new a()
g.x = 'a'
Object.defineProperties(g,Object.getOwnPropertyDescriptors(t2))
console.log(g.b1 ? 'prop value copied': 'prop value gone')
console.log(g.x ? 'assigned value copied': 'assigned value gone')
console.log(g.under ? 'inheritance ok': 'inheritance gone')
console.log(g.b1 ? 'get value copied' : 'get value lost')
g.b1 = false
console.log(g.b1? 'get copied' : 'get lost')
console.log('-----------------------------------') 
```

* * *

## 回答 #55

> 赞同：2
> 
> 时间：2021-08-27T08:38:51.203

我已经完成了上述所有解决方案，它们都很好。但是，您可以使用另一种方法来克隆对象（使用值不引用）。[对象.assign](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)

```
let x = {
    a: '1',
    b: '2'
}

let y = Object.assign({}, x)
y.a = "3"

console.log(x) 
```

输出将是

```
{ a: '1', b: '2' } 
```

此外，您还可以使用相同的方法克隆数组。

```
clonedArray = Object.assign([], array) 
```

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2009-04-08T03:16:47.957

如果您的对象中没有循环依赖项，我建议使用其他答案之一或[jQuery 的复制方法](https://stackoverflow.com/questions/122102/what-is-the-most-efficent-way-to-clone-a-javascript-object/122704#122704)，因为它们看起来都非常有效。

如果存在循环依赖关系（即两个子对象相互链接），那么您就有点搞砸了，因为（从理论上）[没有办法优雅地解决这个问题](https://stackoverflow.com/questions/597588/how-do-you-clone-an-array-of-objects-in-javascript/597726#597726)。

* * *

## 回答 #57

> 赞同：1
> 
> 时间：2017-02-04T15:17:01.820

好的，所以这可能是浅拷贝的最佳选择。if 遵循了许多使用 assign 的示例，但它也保留了继承和原型。它也很简单，适用于大多数类数组和对象，除了那些具有构造函数要求或只读属性的对象。但这意味着它对于 TypedArrays、RegExp、Date、Maps、Sets 和 Object 版本的原语（Boolean、String 等）会惨遭失败。

```
function copy ( a ) { return Object.assign( new a.constructor, a ) } 
```

where`a`可以是任何 Object 或 class 构造的实例，但对于使用专门的 getter 和 setter 或具有构造函数要求的东西来说也不可靠，但对于更简单的情况，它会摇摆不定。它也适用于论点。

您也可以将它应用于原语以获得奇怪的结果，但是......除非它最终成为一个有用的黑客，谁在乎。

结果来自基本的内置对象和数组...

```
> a = { a: 'A', b: 'B', c: 'C', d: 'D' }
{ a: 'A', b: 'B', c: 'C', d: 'D' }
> b = copy( a )
{ a: 'A', b: 'B', c: 'C', d: 'D' }
> a = [1,2,3,4]
[ 1, 2, 3, 4 ]
> b = copy( a )
[ 1, 2, 3, 4 ] 
```

并且由于平均 get/setter、构造函数所需的参数或只读属性以及对父亲的犯罪而失败。

```
> a = /\w+/g
/\w+/g
> b = copy( a )  // fails because source and flags are read-only
/(?:)/
> a = new Date ( '1/1/2001' )
2000-12-31T16:00:00.000Z
> b = copy( a )  // fails because Date using methods to get and set things
2017-02-04T14:44:13.990Z
> a = new Boolean( true )
[Boolean: true]
> b = copy( a )  // fails because of of sins against the father
[Boolean: false]
> a = new Number( 37 )
[Number: 37]
> b = copy( a )  // fails because of of sins against the father
[Number: 0]
> a = new String( 'four score and seven years ago our four fathers' )
[String: 'four score and seven years ago our four fathers']
> b = copy( a )  // fails because of of sins against the father
{ [String: ''] '0': 'f', '1': 'o', '2': 'u', '3': 'r', '4': ' ', '5': 's', '6': 'c', '7': 'o', '8': 'r', '9': 'e', '10': ' ', '11': 'a', '12': 'n', '13': 'd', '14': ' ', '15': 's', '16': 'e', '17': 'v', '18': 'e', '19': 'n', '20': ' ', '21': 'y', '22': 'e', '23': 'a', '24': 'r', '25': 's', '26': ' ', '27': 'a', '28': 'g', '29': 'o', '30': ' ', '31': 'o', '32': 'u', '33': 'r', '34': ' ', '35': 'f', '36': 'o', '37': 'u', '38': 'r', '39': ' ', '40': 'f', '41': 'a', '42': 't', '43': 'h', '44': 'e', '45': 'r', '46': 's' } 
```

* * *

## 回答 #58

> 赞同：1
> 
> 时间：2017-10-17T05:46:34.187

我不知道这不适用于哪些情况，但它给了我一个数组的副本。我觉得它很可爱:) 希望它有帮助

```
copiedArr = origArr.filter(function(x){return true}) 
```

* * *

## 回答 #59

> 赞同：1
> 
> 时间：2017-11-10T09:07:58.887

如果您的对象是一个类（例如[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes)）：

```
var copiedObject = jQuery.extend(true, {}, originalObject);
copiedObject.__proto__ = originalObject.__proto__; 
```

然后在`copiedObject`你有一个深度复制的`originalObject`类实例及其所有方法。

* * *

## 回答 #60

> 赞同：1
> 
> 时间：2018-02-23T21:22:14.520

如果您使用的是 TypeScript，需要支持较旧的 Web 浏览器（因此不能使用 `Object.assign`），并且没有使用内置克隆方法的库，您可以`combine`在几行代码中让自己成为助手。它结合了对象，如果你只有一个，就克隆它。

```
/** Creates a new object that combines the properties of the specified objects. */
function combine(...objs: {}[]) {
    const combined = {};
    objs.forEach(o => Object.keys(o).forEach(p => combined[p] = o[p]));
    return combined;
} 
```

* * *

## 回答 #61

> 赞同：1
> 
> 时间：2018-03-27T11:44:30.810

您可以在不修改父对象的情况下克隆您的对象 -

```
 /** [Object Extend]*/
    ( typeof Object.extend === 'function' ? undefined : ( Object.extend = function ( destination, source ) {
        for ( var property in source )
            destination[property] = source[property];
        return destination;
    } ) );
    /** [/Object Extend]*/
    /** [Object clone]*/
    ( typeof Object.clone === 'function' ? undefined : ( Object.clone = function ( object ) {
        return this.extend( {}, object );
    } ) );
    /** [/Object clone]*/

    let myObj = {
        a:1, b:2, c:3, d:{
            a:1, b:2, c:3
        }
    };

    let clone = Object.clone( myObj );

    clone.a = 10;

    console.log('clone.a==>', clone.a); //==> 10

    console.log('myObj.a==>', myObj.a); //==> 1 // object not modified here

    let clone2 = Object.clone( clone );

    clone2.a = 20;

    console.log('clone2.a==>', clone2.a); //==> 20

    console.log('clone.a==>', clone.a); //==> 10 // object not modified here 
```

* * *

## 回答 #62

> 赞同：1
> 
> 时间：2018-04-27T14:44:44.363

我正在为这个问题提供答案，因为我在这里看不到任何可以解决`DOM`元素问题的本机递归实现。

问题在于`<element>`has`parent`和`child`属性，链接到其他元素的`parent`和`child`值，指向原始`<element>`，导致**无限递归**或**循环冗余**。

如果您的对象是安全且简单的，例如

```
{
    '123':456
} 
```

...那么这里的任何其他答案都可能有效。

但如果你有...

```
{
    '123':<reactJSComponent>,
    '456':document.createElement('div'),
} 
```

...那么你需要这样的东西：

```
 // cloneVariable() : Clone variable, return null for elements or components.
var cloneVariable = function (args) {
    const variable = args.variable;

    if(variable === null) {
            return null;
    }

    if(typeof(variable) === 'object') {
            if(variable instanceof HTMLElement || variable.nodeType > 0) {
                    return null;
            }

            if(Array.isArray(variable)) {
                    var arrayclone = [];

                    variable.forEach((element) => {
                            arrayclone.push(cloneVariable({'variable':element}));
                    });

                    return arrayclone;
            }

            var objectclone = {};

            Object.keys(variable).forEach((field) => {
                    objectclone[field] = cloneVariable({'variable':variable[field]});
            });

            return objectclone;
    }

    return variable;
} 
```

* * *

## 回答 #63

> 赞同：1
> 
> 时间：2019-11-23T22:18:15.227

```
var x = {'e': 2, 'd': 8, 'b': 5};

const y = {};
for(let key in x) {
    y[key] = x[key];
}
console.log(y); // =>>> {e: 2, d: 8, b: 5}

const z = {};
Object.keys(x).forEach(key => {
    z[key] = x[key];
});
console.log(z); // =>>> {e: 2, d: 8, b: 5}

const w = {};
for(let i = 0; i < Object.keys(x).length; i++) {
    w[Object.keys(x)[i]] = x[Object.keys(x)[i]];
}
console.log(w); // =>>> {e: 2, d: 8, b: 5}

const v = {};
for(let key of Object.keys(x)) {
    v[key] = x[key];
}
console.log(v); // =>>> {e: 2, d: 8, b: 5}

x['q'] = 100;   // Altering x will not affect the other objects

console.log(x); // =>>> {e: 2, d: 8, b: 5, q: 100}
console.log(y); // =>>> {e: 2, d: 8, b: 5}
console.log(z); // =>>> {e: 2, d: 8, b: 5}
console.log(w); // =>>> {e: 2, d: 8, b: 5}
console.log(v); // =>>> {e: 2, d: 8, b: 5} 
```

* * *

## 回答 #64

> 赞同：1
> 
> 时间：2021-06-02T02:25:54.677

**在 JavaScript 中复制对象的方法**

1.  使用展开 ( `...`) 语法
2.  使用 `Object.assign()` 方法
3.  使用 `JSON.stringify()` and `JSON.parse()` 方法

```
const person = {
    firstName: 'John',
    lastName: 'Doe'
};

// using spread ...
let p1 = {
    ...person
};

// using  Object.assign() method
let p2 = Object.assign({}, person);

// using JSON
let p3 = JSON.parse(JSON.stringify(person)); 
```

* * *

## 回答 #65

> 赞同：1
> 
> 时间：2021-06-22T15:00:07.663

您可以使用 rest 运算符来克隆数组或对象

```
let myObj = {1: 100, 'a': 200};

let clone = {...myObj}; 

clone.a = 300;

console.log(clone.a) // Output :- 300
console.log(myObj.a) // Output :- 200 
```

* * *

## 回答 #66

> 赞同：1
> 
> 时间：2021-08-27T08:27:49.360

这会生成您的（不仅仅是参考）的**新副本。**`obj`

```
let myCopy = JSON.parse(JSON.stringify(obj)); 
```

..工作效率比`_.cloneDeep(obj)`.

* * *

## 回答 #67

> 赞同：0
> 
> 时间：2009-04-08T03:55:34.320

来自[Apple JavaScript 编码指南](http://developer.apple.com/DOCUMENTATION/ScriptingAutomation/Conceptual/JSCodingGuide/OOJavaScript/OOJavaScript.html#//apple_ref/doc/uid/TP40006539-SW3)：

```
// Create an inner object with a variable x whose default
// value is 3.
function innerObj()
{
        this.x = 3;
}
innerObj.prototype.clone = function() {
    var temp = new innerObj();
    for (myvar in this) {
        // this object does not contain any objects, so
        // use the lightweight copy code.
        temp[myvar] = this[myvar];
    }
    return temp;
}

// Create an outer object with a variable y whose default
// value is 77.
function outerObj()
{
        // The outer object contains an inner object.  Allocate it here.
        this.inner = new innerObj();
        this.y = 77;
}
outerObj.prototype.clone = function() {
    var temp = new outerObj();
    for (myvar in this) {
        if (this[myvar].clone) {
            // This variable contains an object with a
            // clone operator.  Call it to create a copy.
            temp[myvar] = this[myvar].clone();
        } else {
            // This variable contains a scalar value,
            // a string value, or an object with no
            // clone function.  Assign it directly.
            temp[myvar] = this[myvar];
        }
    }
    return temp;
}

// Allocate an outer object and assign non-default values to variables in
// both the outer and inner objects.
outer = new outerObj;
outer.inner.x = 4;
outer.y = 16;

// Clone the outer object (which, in turn, clones the inner object).
newouter = outer.clone();

// Verify that both values were copied.
alert('inner x is '+newouter.inner.x); // prints 4
alert('y is '+newouter.y); // prints 16 
```

史蒂夫

* * *

## 回答 #68

> 赞同：0
> 
> 时间：2013-07-27T15:53:28.723

```
//
// creates 'clone' method on context object
//
//  var 
//     clon = Object.clone( anyValue );
//
!((function (propertyName, definition) {
    this[propertyName] = definition();
}).call(
    Object,
    "clone",
    function () {
        function isfn(fn) {
            return typeof fn === "function";
        }

        function isobj(o) {
            return o === Object(o);
        }

        function isarray(o) {
            return Object.prototype.toString.call(o) === "[object Array]";
        }

        function fnclon(fn) {
            return function () {
                fn.apply(this, arguments);
            };
        }

        function owns(obj, p) {
            return obj.hasOwnProperty(p);
        }

        function isemptyobj(obj) {
            for (var p in obj) {
                return false;
            }
            return true;
        }

        function isObject(o) {
            return Object.prototype.toString.call(o) === "[object Object]";
        }
        return function (input) {
            if (isfn(input)) {
                return fnclon(input);
            } else if (isobj(input)) {
                var cloned = {};
                for (var p in input) {
                    owns(Object.prototype, p)
                    || (
                        isfn(input[p])
                        && ( cloned[p] = function () { return input[p].apply(input, arguments); } )
                        || ( cloned[p] = input[p] )
                    );
                }
                if (isarray(input)) {
                    cloned.length = input.length;
                    "concat every filter forEach indexOf join lastIndexOf map pop push reduce reduceRight reverse shift slice some sort splice toLocaleString toString unshift"
                    .split(" ")
                    .forEach(
                      function (methodName) {
                        isfn( Array.prototype[methodName] )
                        && (
                            cloned[methodName] =
                            function () {
                                return Array.prototype[methodName].apply(cloned, arguments);
                            }
                        );
                      }
                    );
                }
                return isemptyobj(cloned)
                       ? (
                          isObject(input)
                          ? cloned
                          : input
                        )
                       : cloned;
            } else {
                return input;
            }
        };
    }
));
// 
```

* * *

## 回答 #69

> 赞同：0
> 
> 时间：2013-09-07T14:23:17.557

由于同样的问题，我来到了这个页面，但我既没有使用 JQuery，也没有一个克隆方法适用于我自己的对象。

我知道我的回答与这个问题并没有太大的关系，因为它是一种不同的方法。我不使用克隆函数，而是使用创建函数。它为以下（不幸地限制）目的对我有用：

1.  我主要使用 JSP 生成的 Javascript
2.  我一开始就知道必须生成哪个对象（在我的情况下，它是来自数据库的信息，它被获取一次并且需要在 JS 中更频繁地部署。

首先，我这样定义我的对象：

```
var obj= new Object();
obj.Type='Row';
obj.ID=1;
obj.Value='Blah blah'; 
```

现在我移动了所有东西，比如：

```
function getObjSelektor(id_nummer,selected){
var obj = document.createElement("select");
obj.setAttribute("id","Selektor_"+id_nummer);
obj.setAttribute("name","Selektor");
obj.setAttribute("size","1");

var obj_opt_1 = document.createElement("option");
obj_opt_1.setAttribute("value","1");
if(1==selected)
    posopval_opt_1.setAttribute("selected","selected");
obj_opt_1.innerHTML="Blah blah";
obj.appendChild(obj_opt_1);

var obj_opt_2 = document.createElement("option");
obj_opt_2.setAttribute("value","2");
if(2==selected)
    obj_opt_2.setAttribute("selected","selected");
obj_opt_2.innerHTML="2nd Row";
obj.appendChild(obj_opt_2);

...

return obj;
} 
```

并在常规代码中调用该函数：

```
myDiv.getObjSelektor(getObjSelektor(anotherObject.ID)); 
```

如前所述，这是一种不同的方法，它为我的目的解决了我的问题。

* * *

## 回答 #70

> 赞同：0
> 
> 时间：2013-09-25T06:48:13.793

如果你有一个带函数的对象，你可以用 JSONfn 来做，见[http://www.eslinstructor.net/jsonfn/](http://www.eslinstructor.net/jsonfn/)。

```
var obj= {
    name:'Marvin',
    getName :  function(){
      return this.name;
    }
}
var cobj = JSONfn.parse(JSONfn.stringify(obj)); 
```

* * *

## 回答 #71

> 赞同：0
> 
> 时间：2014-02-09T10:16:57.013

复制最终可能指向自身的对象的问题可以通过简单的检查来解决。添加此检查，每次有复制操作。它可能很**慢**，但它*应该可以*工作。

我使用**toType()**函数显式地返回对象类型。我也有我自己的**copyObj()**函数，它在逻辑上非常相似，它回答了所有三个 Object()、Array() 和 Date() 情况。

我在 NodeJS 中运行它。

**尚未测试。**

```
// Returns true, if one of the parent's children is the target.
// This is useful, for avoiding copyObj() through an infinite loop!
function isChild(target, parent) {
  if (toType(parent) == '[object Object]') {
    for (var name in parent) {
      var curProperty = parent[name];

      // Direct child.
      if (curProperty = target) return true;

      // Check if target is a child of this property, and so on, recursively.
      if (toType(curProperty) == '[object Object]' || toType(curProperty) == '[object Array]') {
        if (isChild(target, curProperty)) return true;
      }
    }
  } else if (toType(parent) == '[object Array]') {
    for (var i=0; i < parent.length; i++) {
      var curItem = parent[i];

      // Direct child.
      if (curItem = target) return true;

      // Check if target is a child of this property, and so on, recursively.
      if (toType(curItem) == '[object Object]' || toType(curItem) == '[object Array]') {
        if (isChild(target, curItem)) return true;
      }
    }
  }

  return false;     // Not the target.
} 
```

* * *

## 回答 #72

> 赞同：0
> 
> 时间：2016-07-12T00:51:11.493

`JSON.stringify`要处理无法处理的循环对象，您可以引入一个名为[JSOG](https://github.com/jsog/jsog)的库，它将任意图形序列化和反序列化为 JSON 格式。

```
var clone = JSOG.parse(JSOG.stringify(original)); 
```

尝试用这个技巧修补 JSOG 以进行克隆也可能很有趣（目前没有时间，但如果有人想试一试......）：

序列化一个简单的函数：

```
foo.f = function(a) { return a }
var stringForm = foo.f.toString() // "function (a) { return a }" 
```

反序列化一个函数：

```
eval("foo.f = " + stringForm) 
```

将需要一些约定（可能以属性的名称）来识别函数与常规字符串（`@func_f`也许）。

当然，如果该函数调用第二个函数，则第二个函数将需要像原来的那样存在。

但是，如果您要接受来自不受信任来源的序列化形式，上述内容是非常危险的，但是接受来自不受信任来源的任何形式的任何函数都是危险的，所以如果您对克隆函数感兴趣，则必须已经建立信任（或者您已经打算编写安全漏洞！）。

**免责声明：**我没有测试过 JSOG stringify/parse vs JSON stringify/parse 的速度，但它确实适用于我测试过的简单（圆形）对象。

* * *

## 回答 #73

> 赞同：0
> 
> 时间：2022-03-01T19:28:42.900

简短而甜蜜：

```
let clone = Object.fromEntries(Object.entries(obj)); 
```

演示：

```
let obj = {a: 'b'};
let clone = Object.fromEntries(Object.entries(obj));

clone.a = 'c';

console.log(obj, clone);
```

* * *

## 回答 #74

> 赞同：-1
> 
> 时间：2017-05-19T14:10:34.113

好的，我知道它有很多答案，但没有人指出，EcmaScript5 有分配方法，适用于 FF 和 Chrome，它复制可枚举和自己的属性和符号。

[对象分配](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)

* * *

## 回答 #75

> 赞同：-1
> 
> 时间：2021-04-11T03:55:21.200

所以只是添加一些简单的东西，如果你想创建一个灯箱或类似的东西，上面的大多数答案都是不必要的复杂，简单地复制源属性和其他任何必要的东西更容易。

* * *

## 回答 #76

> 赞同：-2
> 
> 时间：2013-05-06T17:54:27.777

我最喜欢和优雅的 JS 对象**克隆**解决方案是

```
function CloneObject() {}
function cloneObject(o) {
   CloneObject.prototype = o;
   return new CloneObject();
} 
```

用于`cloneObject(object)`获取 JS 对象的克隆。

与许多**复制**解决方案不同，此克隆将原型关系保留在克隆对象中。

* * *

## 回答 #77

> 赞同：-3
> 
> 时间：2013-08-31T02:41:43.140

```
function clone(obj)
{
    var cloneObj = Object.create(obj);

    return cloneObj;
} 
```

在 Javascript 中对象单独继承另一个对象（原型继承）。Object.create(obj) 返回一个对象，它是 obj 的子对象或子对象。在上述函数中，它将有效地返回对象的副本。

但是，这是一种非常奇怪的克隆方式，因为我没有将继承用于其真正目的。

# python - 有没有办法在python中重载+=？

> ID：728361
> 
> 赞同：51
> 
> 时间：2009-04-08T03:01:52.920
> 
> 标签：python, operator-overloading

我知道`__add__`覆盖 plus 的方法，但是当我使用它来覆盖 += 时，我最终遇到了两个问题之一：

(1) 如果`__add__`自我变异，则

```
z = x + y 
```

当我真的不希望 x 在那里发生变异时，会变异 x 。

(2) 如果`__add__`返回一个新对象，则

```
tmp = z
z += x
z += y
tmp += w
return z 
```

将返回没有 w 的东西，因为 z 和 tmp 在执行后指向不同的对象`z += x`。

我可以制作某种方法，但如果可能的话`.append()`，我更愿意重载。`+=`

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-04-08T03:06:14.207

是的。只需覆盖对象的`__iadd__`方法，该方法采用与`add`. [您可以在此处](http://docs.python.org/reference/datamodel.html#emulating-numeric-types)找到更多信息。

# internet-explorer-7 - 如何强制 IE7 工具栏始终显示

> ID：728362
> 
> 赞同：4
> 
> 时间：2009-04-08T03:02:05.527
> 
> 标签：internet-explorer-7, toolbar

我有 IE7 的开发人员工具栏，当我想以类似于 firebug for firefox 的功能的方式检查页面布局时，这非常有用。

但是，我正在使用一个打开一个禁用工具栏的新窗口的网站，并且我无法访问我的开发工具栏按钮！有没有办法强制 IE7 总是显示工具栏？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T16:51:45.610

我不相信你可以。

您可以通过按 F11，然后再次按 F11 来恢复无镶边窗口（打开时没有导航工具栏、菜单、其他工具栏）中的导航工具栏（后退、前进、地址栏、搜索框），但这仍然无法让您访问到 IE 开发者工具栏。

有时可行的方法是在新的无镶边窗口具有焦点时按 CTRL+N。这样做将打开一个新的镀铬（工具栏、菜单等）到与无镀铬窗口相同的 URL。如果 chromeless 窗口 URL 是 POST 的结果，或者以某种方式在服务器上修改状态的 GET，则该技巧不会很好地工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T16:58:52.237

我想这是因为弹出窗口是使用javascript`window.open()`调用打开的，指定不在新窗口上使用工具栏？

一种可能性是打开页面源代码，找到打开窗口的 javascript 调用，并将其粘贴到地址栏中，将其修改为不禁用工具栏。

例如，如果调用当前看起来像：

```
window.open(url, "newWindow", "toolbar=no,width=500,..."); 
```

编辑地址栏以读取如下内容：

```
javascript:window.open(url, "newWindow", "toolbar=yes,width=500,..."); 
```

当您按 Enter 键时，它应该会弹出相同的窗口，但带有工具栏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T16:53:44.793

IE8 内置了开发工具栏，因此您始终可以通过 F12 访问它。考虑升级？

# linq - 在gridview中的日期绑定范围之间计数。LINQ to SQL Visual Basic

> ID：728369
> 
> 赞同：0
> 
> 时间：2009-04-08T03:04:25.817
> 
> 标签：linq

可能有人可以帮助我解决查询 LINQ to SQL Visual Basic 中的一个问题。

我的数据库有三个表，

```
* Students(StudentID, StudentName),
* Class(ClassID, ClassDate),
* Attendance(StudentID, ClassID) which Attendance tables is the junction table between Students and Class. 
```

例如：

学生们

学生ID.............学生姓名

第1001章…………史密斯

第1002章 …………约翰

第1003章…………鲍勃

班级

班级ID............班级日期

1.......................2009 年 1 月 1 日

2.......................2009 年 1 月 3 日

3 .....................2009 年 1 月 7 日

出勤率

学生ID............班级ID

1001 ....................1

1002 ....................1

1003 ....................1

1001 ....................2

1003 ....................2

1001 ....................3

1002 ....................3

1003 ....................3

我尝试了下面的查询 Visual Basic LINQ to SQL 来列出某个日期范围内的所有学生和出勤人数。

```
1 Dim db = New AttendanceControllerDataContext
2
3 Dim result = From std In db.Students _
4 Select std.StudentID, _
5 std.StudentName, _
6 Attendance = std.Attendances.Count()
7
8 GridView1.DataSource = result
9 GridView1.DataBind() 
```

当我尝试这个时，它给了我：

学生ID........学生姓名......出勤率

1001.......史密斯............3

第1002章…………………………2

第1003章………………………………………………………………………………………………………………………………………………………………………………3

在第 6 行，出勤我想根据班级表中的日期范围来计算，例如，如果我选择了 2009 年 1 月 2 日到 2009 年 1 月 7 日之间的日期范围，那么我尝试了以下代码：

```
 1   Dim db = AttendanceControllerDataContext

 2   Dim result = From std In db.Students, atd In db.Attendances _
 3                Where atd.studentID = std.studentID _
 4                Select std.studentID, _
 5                std.studentName, _
 6                Attendance = atd.Class.date >= 1/2/2009 _
 7                And atd.Class.date <= 1/7/2009  std.Attendances.Count()
 8   GridView1.DataSource = result
 9   GridView1.DataBind() 
```

结果是：

学生ID........学生姓名......出勤率

第1001章…………………………2

第1001章…………………………2

第1002章…………………………………………………………………………………………………………………………………………………………1

第1003章…………………………2

第1003章…………………………2

但是，我只想要一个如下所示的列表：

学生ID........学生姓名......出勤率

第1001章…………………………2

第1002章…………………………………………………………………………………………………………………………………………………………1

第1003章…………………………2

我怎样才能做到这一点？有什么建议吗？预先感谢..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T08:48:26.840

代替

```
Attendance = std.Attendances.Count() 
```

在您的第一个代码示例中使用

```
Attendance = std.Attendances.Where(Function(att) att.Class.ClassDate >= "1/2/2009" And att.Class.ClassDate <= "1/7/2009").Count() 
```

# .net - ASP.NET CustomValidator 客户端

> ID：728370
> 
> 赞同：2
> 
> 时间：2009-04-08T03:04:40.370
> 
> 标签：.net, asp.net, javascript, validation

我无法让这个 CustomValidator 工作。

在 <head> 中：

```
<script language="javascript" type="text/javascript">
  function ValidateFile(sender, args){
      alert("Hi");

      args.IsValid = document.getElementById("fuFile").value != "" || 
                     document.getElementById("c101_c7").value != "";
  }
</script> 
```

在身体里：

```
<asp:FileUpload ID="fuFile" runat="server" size="70"/>
<asp:TextBox ID="c101_c7" class="textbox" runat="server"/>
<asp:CustomValidator ID="vldFile" runat="server" ClientValidationFunction="ValidateFile"
    ErrorMessage="You must either upload a file or provide a URL of a file."></asp:CustomValidator> 
```

如果必须填写 FileUpload 或 TextBox，args.IsValid 中应该包含什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T05:28:59.307

我发现实际上让后面的代码告诉您的 JavaScript 代码控件的客户端 ID 是什么很有帮助，因为它可能与您的想法不同（基于 ASP .NET 决定执行的操作）：

```
document.getElementById('<%=fuFile.ClientID %>'); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-16T14:35:34.120

```
<script type="text/javascript">
//<![CDATA[
    function validateField(sender, args) {        
        var regExp = /(^[a-zA-Z]{2,50})$/;
        var val = document.getElementById(sender.controltovalidate).value;
        args.IsValid = regExp.test(val);
}
//]]>
</script> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T03:27:41.767

您只是使用普通按钮来触发验证吗？

您是否在此代码的其他任何地方实现验证组？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T03:32:02.177

您需要在自定义验证器上设置 ControlToValidate 属性。目前验证器没有连接到任何控件。

另外，我确定您只是没有发布这部分标记，但您需要有一个控件来执行回发并导致验证作为其回发的一部分。一个按钮将为此工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T05:22:03.567

这有效

```
document.getElementById("ctl00_ContentPlaceHolder1_fuFile").value 
```

# ios - 什么时候调用 layoutSubviews？

> ID：728372
> 
> 赞同：284
> 
> 时间：2009-04-08T03:05:12.757
> 
> 标签：ios, cocoa-touch, autolayout, bounds, layoutsubviews

`layoutSubview`我有一个自定义视图，在动画期间没有收到消息。

我有一个充满屏幕的视图。如果我更改导航栏的高度，它在屏幕底部有一个自定义子视图，可以在 Interface Builder 中正确调整大小。`layoutSubviews`在创建视图时调用，但不再调用。我的子视图布局正确。如果我关闭通话状态栏，`layoutSubviews`则根本不会调用子视图，即使主视图确实为其调整大小设置了动画。

什么情况下`layoutSubviews`实际调用？

我已经`autoresizesSubviews`设置`NO`为我的自定义视图。在 Interface Builder 中，我设置了顶部和底部支柱以及垂直箭头。

* * *

难题的另一部分是必须将窗口设为关键：

```
[window makeKeyAndVisible]; 
```

否则子视图不会自动调整大小。

* * *

## 回答 #1

> 赞同：518
> 
> 时间：2011-03-16T18:42:58.673

我有一个类似的问题，但对答案（或我能在网上找到的任何答案）不满意，所以我在实践中尝试过，这就是我得到的：

*   `init`不会导致`layoutSubviews`被调用（duh）
*   `addSubview:`导致 `layoutSubviews`在添加的视图、添加到的视图（目标视图）以及目标的所有子视图上调用
*   仅当框架的大小参数不同时，视图才`setFrame` 智能地调用`layoutSubviews`已设置其框架的视图
*   滚动 UIScrollView 会导致`layoutSubviews`在 scrollView 及其父视图上被调用
*   旋转设备仅调用 `layoutSubview`父视图（响应的 viewControllers 主视图）
*   调整视图大小将调用`layoutSubviews`其父视图（**重要提示：** *如果确定其大小的内容发生变化，则具有内在内容大小的视图将重新调整大小；例如，更新 UILabel 上的文本将导致更新内在内容大小，因此调用`layoutSubviews`它的superview*）

我的结果 - [http://blog.logichigh.com/2011/03/16/when-does-layoutsubviews-get-called/](https://web.archive.org/web/*/blog.logichigh.com/2011/03/16/when-does-layoutsubviews-get-called/)

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2013-10-21T07:09:41.410

在@BadPirate 之前的回答的基础上，我做了一些进一步的实验，并提出了一些澄清/更正。我发现`layoutSubviews:`当且仅当：

*   它自己的**界限**（不是框架）发生了变化。
*   它的直接子视图之一的边界发生了变化。
*   子视图被添加到视图中或从视图中删除。

一些相关细节：

*   仅当新值不同（*包括不同的 origin* ）时，才认为边界已更改。请特别注意，这就是`layoutSubviews:`UIScrollView 滚动时调用的原因，因为它通过更改其边界的原点来执行滚动。
*   更改框架只会在大小发生更改时更改边界，因为这是传播到边界属性的唯一内容。
*   尚未在视图层次结构中的视图边界更改将导致调用`layoutSubviews:` *最终将视图添加到视图层次结构*中的时间。
*   并且只是为了完整性：这些触发器不*直接*调用 layoutSubviews，而是调用`setNeedsLayout`，它设置/引发一个标志。运行循环的每次迭代，对于*视图层次结构中的*所有视图，都会检查此标志。对于发现标志的每个视图， `layoutSubviews:`都会调用它并重置标志。层次较高的视图将首先被检查/调用。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2015-09-10T06:14:36.963

[https://developer.apple.com/library/prerelease/tvos/documentation/WindowsViews/Conceptual/ViewPG_iPhoneOS/CreatingViews/CreatingViews.html#//apple_ref/doc/uid/TP40009503-CH5-SW1](https://developer.apple.com/library/prerelease/tvos/documentation/WindowsViews/Conceptual/ViewPG_iPhoneOS/CreatingViews/CreatingViews.html#//apple_ref/doc/uid/TP40009503-CH5-SW1)

> 每当视图中发生以下任何事件时，都可能发生布局更改：
> 
> 一种。视图边界矩形的大小发生变化。
> 湾。发生界面方向更改，这通常会触发根视图的边界矩形的更改。
> C。与视图层关联的一组核心动画子层发生变化并需要布局。
> d。您的应用程序通过调用视图的 `setNeedsLayout` or `layoutIfNeeded` 方法来强制进行布局。
> e. `setNeedsLayout` 您的应用程序通过调用视图底层对象的方法来强制布局 。

![](https://i.stack.imgur.com/4LSv0.png)

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2012-10-29T11:59:14.370

[BadPirate 的回答](https://stackoverflow.com/a/5330162/814730)中的一些观点只是部分正确：

1.  为`addSubView`点

    > `addSubview`导致 layoutSubviews 在被添加的视图、它被添加到的视图（目标视图）以及目标的所有子视图上被调用。

    它取决于视图的（目标视图）自动调整大小掩码。如果它启用了自动调整掩码，layoutSubview 将在每个`addSubview`. 如果它没有自动调整大小掩码，则仅当视图的（目标视图）帧大小更改时才会调用 layoutSubview。

    示例：如果您以编程方式创建 UIView（默认情况下它没有自动调整大小掩码），则仅当 UIView 框架更改时才会调用 LayoutSubview `addSubview`。

    正是通过这种技术，应用程序的性能也得到了提高。

2.  对于设备旋转点

    > 旋转设备仅调用父视图（响应视图控制器的主视图）上的 layoutSubview

    仅当您的 VC 位于 VC 层次结构中时（根位于`window.rootViewController`），这才是正确的，这是最常见的情况。在 iOS 5 中，如果你创建了一个 VC，但它没有被添加到任何另一个 VC 中，那么当设备旋转时，这个 VC 不会被注意到。因此，调用 layoutSubviews 不会注意到它的视图。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-04-09T14:41:40.763

我将解决方案追溯到 Interface Builder 坚持认为在打开了模拟屏幕元素（状态栏等）的视图上不能更改弹簧。由于主视图的弹簧已关闭，因此该视图无法更改大小，因此在出现通话栏时会完全向下滚动。

关闭模拟功能，然后调整视图大小并正确设置弹簧会导致动画发生并调用我的方法。

调试中的一个额外问题是，当通过菜单切换通话状态时，模拟器会退出应用程序。退出应用程序 = 没有调试器。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2014-02-14T20:39:58.470

调用 `[self.view setNeedsLayout];` viewController 使其调用 viewDidLayoutSubviews

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-04-08T04:12:24.483

你看过layoutIfNeeded吗？

文档片段如下。如果在动画期间显式调用此方法，动画是否有效？

layoutIfNeeded 如果需要，布局子视图。

```
- (void)layoutIfNeeded 
```

讨论 使用此方法在绘制之前强制子视图的布局。

可用性 适用于 iPhone OS 2.0 及更高版本。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-06-24T07:13:42.850

将 OpenGL 应用程序从 SDK 3 迁移到 4 时，不再调用 layoutSubviews。经过大量试验和错误后，我终于打开了 MainWindow.xib，选择了 Window 对象，在检查器中选择了 Window Attributes 选项卡（最左侧）并选中了“Visible at launch”。似乎在 SDK 3 中它仍然会导致 layoutSubViews 调用，但在 4 中没有。

6小时的挫败感告一段落。

# c# - 在 sql server compact edition 上执行插入或更新（upsert）

> ID：728373
> 
> 赞同：2
> 
> 时间：2009-04-08T03:05:48.060
> 
> 标签：c#, sql, entity-framework, sql-server-ce, upsert

我有使用 sqlserver 精简版和实体框架进行数据访问的 c# 项目。我需要向数据库插入或更新大量行，5000+ 或更多，所以如果密钥存在，如果不插入则更新记录。我找不到使用紧凑版和 EF 执行此操作的方法，但性能不佳，即在核心 i7 计算机上花费 2 分钟以上。我曾尝试搜索记录以查看它是否存在，如果不存在则插入或更新，如果存在，则搜索是杀手锏。我已经尝试编译搜索查询，但只带来了很小的改进。我尝试过的另一件事是将记录插入到 try catch 中，如果它更新失败，但这会迫使我在每条记录上保存更改以获取异常，而不是在最后，这是一个性能杀手。显然我不能 t 使用存储过程，因为它是精简版。此外，我还研究过以某种方式直接在数据库上执行 t-sql，但紧凑中缺少进程语句似乎排除了这一点。我已经在世界各地寻找想法。如果我可以过度表达部署优势和防止用户挖掘数据库的能力，我真的很想使用紧凑型。任何建议将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-30T08:19:02.300

当我们使用 SQL CE（以及 SQL 2005 Express）时，我们总是先调用更新，然后如果 udate 给出的行数为 0，则调用插入。这实现起来非常简单，不需要尝试费用。 .catch 块用于控制流。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T04:10:07.297

鉴于您的问题陈述，我猜测该软件假定了一个相对强大的环境。您是否考虑过将确定 sqlce 的任务并自行完成？本质上，从相关表中获取所有 ID（键？）的排序列表，并在排队插入之前根据该列表检查每个对象键？

这做出了一些假设，这对于典型的数据库来说是个坏消息，但您可能可以在 sqlce 中侥幸逃脱。例如，它假定在您执行此插入时，其他用户不会插入或显着修改行。

如果键列表太长而无法合理地保存在内存中以进行此类检查，恐怕我会说 sqlce 可能不是该工作的正确工具。:(

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T21:06:34.810

也许您可以通过使用简单的查询来获得您寻求的结果。假设您要插入或更新的表是这样的

```
TABLE original
     id integer,
     value char(100) 
```

首先，您可以使用新值创建一个临时表（您可以使用 SELECT INTO 或其他方式来创建它）

```
TABLE temp
    id integer,
    value char(100) 
```

现在，您需要做两件事，更新原始行，然后插入新值

```
UPDATE original 
SET original.value = temp.value
FROM original, temp
WHERE original.id = temp.id

INSERT INTO original 
SELECT * from temp 
WHERE temp.id not IN (select o.id from original o) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T00:12:31.540

我不确定这是否可行，因为我没有使用实体框架，但是您是否尝试过先运行更新并检查行数——如果没有更新行则插入？这可能比捕获异常更快。将异常用于控制流通常是一种不好的做法，并且通常会大大减慢速度。

如果您可以直接编写 SQL，那么最快的方法是将所有数据放入临时表中，然后更新现有数据并插入其余数据（如上面 Andrea Bertani 的示例）。通过在插入的选择中对原始表使用左连接，并排除原始表中的值不为空的任何行，您应该会获得更好的结果：

```
INSERT INTO original
SELECT * FROM temp
LEFT JOIN original ON original.id = temp.id
WHERE original.id IS NULL 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-24T16:30:00.057

我建议直接使用 SqlCeResultSet。您失去了 EF 良好的类型安全性，但性能却*非常*快。我们从 ADO.NET 2.0 样式的 TypeDataSets 切换到 SqlCeResultSet 和 SqlCeDataReader，速度提高了 20 到 50 倍。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-30T07:50:28.333

请参阅 SqlCeResultSet。对于一个 .NETCF 项目，我删除了几乎所有的 sql 代码来支持这个类。只需在此处和 msdn 中搜索“SqlCeResultSet”即可。

快速概览：

1.  打开结果集。如果您需要寻找（用于检查是否存在），则必须为结果集提供索引。

2.  寻找结果集并阅读以检查您是否找到该行。即使在具有数万行的表上，这也非常快（因为查找使用索引）。

3.  插入或更新记录（请参阅 SqlCeResultSet.NewRecord）。

* * *

我们已经成功开发了一个带有 sqlce 数据库的项目，该数据库具有一个超过 65000 行的主产品表（具有 4 个索引的读/写）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-24T16:39:06.917

SQL Server 精简版目前处于开发的早期阶段。此外，根据您的设备，内存磁盘访问可能非常缓慢，并且 SQLCE 和 .NET 类型安全开销非常大。它最适合使用漂亮的静态数据存储。

我建议您要么使用更轻量级的 API，要么考虑使用 SQLite。

# robots.txt - googlebot 会将我的网站编入索引吗？

> ID：728374
> 
> 赞同：3
> 
> 时间：2009-04-08T03:06:04.533
> 
> 标签：robots.txt, googlebot

在我的 robots.txt 文件中，我有以下行

用户代理：Googlebot-Mobile 禁止：/

用户代理：GoogleBot 禁止：/

站点地图： http: [//mydomain.com/sitemapindex.xml](http://mydomain.com/sitemapindex.xml)

我知道如果我放前 4 行，googlebot 不会索引网站，但是如果我放最后一行**Sitemap: [http://mydomain.com/sitemapindex.xml](http://mydomain.com/sitemapindex.xml)**，googlebot 能索引网站吗？

谢谢，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T03:29:04.807

我针对我自己的域（每个页面都有一个站点地图条目）测试了您的 robots.txt，Googlebot 和 Googlebot-Mobile 返回它们被禁止访问。

基于此 - 我会说 robots.txt 文件优先于任何站点地图。

另外，从逻辑上讲-如果您阻止整个域，则不允许该机器人访问站点地图。站点地图条目只是告诉爬虫在哪里可以找到您的站点地图 - 而不是他们访问它的授权。

即使您允许使用站点地图，我认为机器人不会抓取您的站点 - 站点地图的设计更多地是为了告诉机器人多久抓取您的网站，而不是允许它们抓取什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T03:21:37.477

不，我不认为谷歌会这样做。它实际上是一个好机器人和坏机器人的问题。即使您添加了 robots.txt 文件来限制机器人仍然可以抓取的某些区域。它实际上是一个是或否的问题。robots.txt 就像一个警告板，而不是安全墙。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-06T07:27:23.083

googlebot 甚至无法触摸 sitemapindex.xml

*   robots.txt 是一个爬虫指令。
*   sitemap.xml 是通过 googlebot 爬虫获取的。
*   googlebot 不会访问 sitemapindex.xml
*   没有抓取覆盖，没有索引，没有 SERP 列表

您可以使用 google 网站管理员工具 robots.txt 验证工具对此进行测试，并将其作为 googlebot（在实验室部分）功能获取。

# php - 高效搜索 3 级层次结构

> ID：728378
> 
> 赞同：0
> 
> 时间：2009-04-08T03:06:40.990
> 
> 标签：php, oracle, search, hierarchy

假设我有一个 FirstName > MiddleName > LastName 层次结构（为了这个问题，大约 10k 行）。这意味着您可以有“John > Mary-Anne > Eddy”或“Eddy > John > Jacob”行。关键是层次结构没有什么意义，而且对用户来说非常陌生（不像国家>州>城市结构）。

因为它是如此的非结构化和混乱，我想为用户提供一个自动完成的输入框。当他们键入时，它应该搜索可能的子字符串匹配，并且当他们在某个级别“root”他们的搜索字符串时，它会将结果限制在该级别以下。

现在，因为有很多人叫“约翰”，所以如果他们输入“约翰”，他们只会得到类似的结果，这没什么意义

*   约翰 > 艾伦 > 亚历山大
*   约翰 > 艾伦 > Burschawitz
*   约翰 > 艾伦……重复 100 次……

因为他们永远不会看到唯一的行“Jason > John > Smith”。

相反，他们应该得到类似的东西（“*”只是“嘿，下面还有很多行”的用户的一个任意指示符）：

*   约翰 > 艾伦 > *
*   杰森 > 约翰 > 史密斯
*   迈克 > 约翰 > *
*   玛丽 > 埃琳娜 > 乔纳森

如果他们键入“John > Al”，则结果将仅限于“John >”下的任何内容，但应与上述类似地进行分组。

我希望解释清楚。要求有点松。只是合理的，这样人们就可以在树中搜索并找到他们想要的东西。

现在，我有一些有趣的 SQL 来查找行中的搜索词，找出它的位置，进行一些子字符串化、分组和排序以获得上述结果，但它的性能不够好。

我试图在典型的 LAMP 堆栈上解决这个问题（Oracle 除外）。它不是共享主机，所以我可以完全控制服务器。数据每隔几周就会发生少量变化，并且搜索结果可以在合理的时间内保持陈旧（例如，更新搜索索引的 cron 并非不可能）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T03:02:51.600

啊。抱歉，我无法描述我的问题。无论如何，这是我想出的解决方案。

基本上，从包含层次结构每个连续级别的所有不同值的 3 列表创建第二个表，以及指示层次结构中该行的深度的列。

例如从`mytable(A, B, C)`，创建`search_t(A, B, C, level)`

因此，使用“一 > 二 > 三”，您可以创建 3 行（A、B、C、级别）：

*   “一”，空，空，1
*   “一”，“二”，空，2
*   “一”、“二”、“三”、3

搜索时，您可以通过为级别选择一个值并为上层列提供值来限制级别：

`WHERE A='One' and level > 1 and (B like '%t%' or C like '%t')`

`search_str`如果您创建一个列并对其执行`LIKE`匹配，它可能会有点简化和通用。

`WHERE A='One' and level > 1 and search_str like '%t%'`

回想起来，如果数据已经在邻接列表模型中，这可能会更加明显。

# c++ - 有没有办法让 Asio 在没有 Boost 的情况下工作？

> ID：728380
> 
> 赞同：6
> 
> 时间：2009-04-08T03:07:05.390
> 
> 标签：c++, boost, boost-asio

我知道有一个版本的 ASIO 不包含在 Boost 命名空间中，但即便如此，ASIO 也依赖于 Boost，但我想知道是否有办法让 ASIO 在不依赖 Boost 的情况下工作（因为我不能包含 Boost进入项目，原因太多了）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-08T04:45:56.883

不，我不相信。只要我听说过，ASIO 就一直在使用 boost。我认为它们是非常相互关联的。但是您可能对工具[bcp](http://www.boost.org/doc/libs/1_38_0/tools/bcp/bcp.html)感兴趣，它可以让您提取要使用的库所需的最小 boost 子集。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T09:25:42.747

Asio还有一个非增强版：

> Asio 有两种变体：（非 Boost）Asio 和 Boost.Asio。

看：

[http://think-async.com/Asio/](http://think-async.com/Asio/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T22:55:02.797

“非boost asio”有自己的线程位而不是使用boost.thread，但它仍然需要boost.date_time、boost.array、boost.utility、boost.bind、boost.shared_ptr...

没有任何版本的 Asio 可以在没有任何 Boost 依赖的情况下工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-06-22T12:56:23.327

最近的 ASIO 版本可以在没有 Boost 的情况下在独立模式下工作。这种模式可能是由库的 C++11 支持启用的，因为它现在可以使用标准线程、期货等，而不是它们的 Boost 实现。您可以像下面这样简单地包含 ASIO 并享受：

```
#define ASIO_STANDALONE
#include <asio.hpp> 
```

# database - 具有大量位域的数据库结构

> ID：728381
> 
> 赞同：0
> 
> 时间：2009-04-08T03:07:25.763
> 
> 标签：database, data-structures

我有一类具有大量二进制属性的数据——准确地说是 151（！）——我关心如何在结构上对这些数据进行建模。尽管将位字段存储为字节的内部效率很高，但我的编程感觉却在创建一个具有 151 个位字段（以及其他属性）的表时感到刺痛。

不会有大量的行——可能是 1000 行，并且一旦投入生产就不会经常更改。

我曾考虑将我的数据分类为不相交的子类并创建单独的表，但以这种方式拆分属性是不切实际的，即使可能也肯定不会有效地映射到数据子类。另一个问题是我想将所有数据放在一起并避免字段和/或行重复。我也考虑过使用一些自定义二进制格式，但这不可行，因为我的数据中的键字段被用作其他表中的外键。

查询将大量使用 WHERE 子句来提取相关数据。我考虑过使用多个 longs 或 int 字段，但我认为这是不可行的，因为我不知道 SQL 中没有按位与运算符或函数，并且如上所述，属性的分类是有问题的，更不用说其他主要的软件工程问题（使用此方法）。

我将使用 PostgreSQL。

所以，我的问题是我只是制作一个包含大量字段的表格，还是有其他与关系模型兼容的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T03:26:47.243

我看到的最大问题是一个明显的事实，即单字段索引的基数至少可以说很低。也许您可以多描述一下数据，然后我们可以讨论其他设计？例如，所有这些都相互独立吗？

只有 1000 行，将其存储在其他地方可能比数据库更简单（尽管我想有很多连接机会？）不是出于查询效率的原因，但它看起来并不像数据库数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T03:13:44.047

为什么不能使用位操作符？

```
&   bitwise AND 91 & 15 11
|   bitwise OR  32 | 3  35
#   bitwise XOR 17 # 5  20
~   bitwise NOT ~1  -2 
```

来自：[http ://www.postgresql.org/docs/7.4/static/functions-math.html](http://www.postgresql.org/docs/7.4/static/functions-math.html)

我认为您可以将它们分组为较小的组，但除了这样做之外，我不知道其他方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T03:15:07.070

[PostgreSQL 原生支持位和位串。](http://www.postgresql.org/docs/8.3/static/datatype-bit.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T03:35:58.393

对最适合您的问题域的数据进行建模。您在这里没有太多数据，在最坏的情况下，假设每行占用 200 个字节，您看到的数据少于 200 Kb。即使您的特定数据库没有以有效的方式实现布尔属性，这也是微不足道的。

另一方面，拥有 150 个布尔属性听起来有些可疑，也许您的数据模型可以进一步规范化？

# language-agnostic - 数据库设计：偏爱抽象还是外键约束？

> ID：728385
> 
> 赞同：1
> 
> 时间：2009-04-08T03:09:57.113
> 
> 标签：language-agnostic, database-design, oop, entity-relationship

假设我们有这种情况：

```
Artist ==< Album ==< Track
//ie, One Artist can have many albums, and one album can have many tracks 
```

在这种情况下，所有 3 个实体都具有基本相同的字段：

*   ID
*   姓名
*   与相应子代（Artist to Album 和 Album to Track）的一对多关系的外来物

* * *

所提供解决方案的典型解决方案是三个表，在一对多关系字段中具有相同的字段（ArtistID、AlbumID 等）和外键约束。

但是，在这种情况下，我们可以合并一种继承形式来避免相同字段的重复吗？我说的是这样的事情：

```
Table: EntityType(EntityTypeID, EntityName)
       This table would hold 3 entities (1\. Artist, 2\. Album, 3\. Track)

Table: Entities(EntityID, Name, RelField, EntityTypeID)
       This table will hold the name of the entity (like the name of 
       an artist for example), the one-many field (foreign-key
       of EntityID) and EntityTypeID holding 1 for Artist, 2 for Album 
       and so on. 
```

* * *

你觉得上面的设计怎么样？在这个数据库场景中加入“OOP 概念”是否有意义？

最后，您更喜欢第一种情况的外键约束还是更通用的（例如，存在将艺术家与 Track 链接的风险，因为没有检查输入器外键值是否真的是一张专辑）的方法？

*..btw，想想看，我想你实际上可以检查一个艺术家的 RelField 的输入值是否对应一个专辑，也许有触发器？*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T03:14:53.450

我最近看到这种抽象的想法被一致地实现了，应用程序及其数据库变成了一个需要维护和排除故障的怪​​物。我会远离这种技术。越简单越好，这是我的口头禅。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T03:13:06.310

不可避免地会在各个实体上累积的额外字段几乎没有机会如此有责任感。如果不以相当接近的方式反映现实，将一无所获。

我认为您甚至不会在常规的 OO 设计中将这些实体混为一谈。

这让我（但只是轻微地）想起了我曾经看到的尝试在一个表（名为“实体”）中实现所有内容，另一个表（名为“属性”）和它们之间的连接表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T03:17:27.127

通过将这三者结合在一起，您的查询的可读性会降低（除非您随后将这三个类别分解为视图），并使搜索和索引变得更加困难。

另外，在某些时候，您会希望将属性添加到一个类别，而这些属性不是其他类别的属性。将这三者结合在一起，你就没有改变的余地，而不会破坏系统的大部分内容。

不要太聪明，你会绊倒自己。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T03:17:43.663

我可以看到以您的 OOP 方式执行此操作的唯一优势是将来是否添加了其他元素类型（即，除了艺术家、专辑和曲目之外）。在这种情况下，您不需要更改架构。

但是，我倾向于选择非 OOP 方式并在这种情况下更改架构。OOP 解决方案存在的一些问题是：

*   如果要添加艺术家的生日怎么办？
*   如果你想存储专辑和曲目的持续时间怎么办？
*   如果要存储轨道类型怎么办？

基本上，如果您想存储仅针对一种或两种元素类型的特定内容怎么办？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T03:28:25.913

如果你喜欢这种事情，那么看看[PostgreSQL](http://www.postgresql.org/)中的表继承。

```
create table Artist (id integer not null primary key, name varchar(50));
create table Album (parent integer foreign key (id) references Artist) inherits (Artist);
create table Track (parent integer foreign key (id) references Album) inherits (Artist); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T03:16:05.837

我同意 le dorfier 的观点，您可能会从基本实体（ID、名称）的概念中得到一些重用，但除此之外，Artist、Album 和 Track 的概念会有所不同。

一个更现实的模型可能必须处理多个艺术家可能为一张专辑的单首曲目做出贡献的事实......

# loops - MIPS 代码损坏

> ID：728392
> 
> 赞同：0
> 
> 时间：2009-04-08T03:13:07.870
> 
> 标签：loops, assembly, mips

我正在为我的计算机组织课程编写一些 MIPS 代码，而且我似乎无法让 MIPS 正常工作，而且在线上没有那么多 MIPS 资源。我在 PCSPIM 上运行代码。该代码应该将 10 添加到 array2 的内容并将它们存储在 array1 中，然后打印 array 1。重新编写的代码现在可以正常工作。

```
.text
main:
    la $t0, array1
    la $t1, array2
    la $s0, valuec
    li $s2, 6
    add $t6, $zero, 1 #i = 1

Loop:
    addi $t6, $t6, 1 #i++

    lw  $t2, ($t0)
    lw  $t5, ($t1)
    lw  $s1, ($s0)
    addu $t2, $t5, $s1
    sw  $t2, ($t0)
    add $t0, $t0, 4
    add $t1, $t1, 4
    li $v0, 1
    move $a0, $t2
    syscall
    blt $t6, $s2, Loop

    li $v0, 10
    syscall
.data
    array1: .space 20
    array2: .word 1,2,3,5,9
    valuec: .word 10 
```

PCSPIM 打印 0 5 次并返回 Exception 7 [Bad data Address] 发生并被忽略

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T03:33:03.407

这是家庭作业，所以我现在只给你一些线索，并在你进行时添加。有几件事：

1/ 你需要告诉我们它*应*该做什么。这是最重要的。

2/ 您将 array1 地址存储到 t0 中，然后在第一个循环中重用 t0。

3/ 您似乎对地址和这些地址的内容（`"la $s0, valuec"`和`"addu $t0, $t1, $s0"`）感到困惑。

**更新：**

实际上我必须暂时退出，所以我会发布我的解决方案，以免让您陷入困境。

我之前提到的混淆是您将两个地址加载到 $t1 和 $s0 中，然后将它们加在一起以获得另一个地址 - 这可能远远超出您的数据区域（您实际上应该添加一个地址和偏移量）。

这基本上就是您的代码存在的问题（打印的零和崩溃）。你最好的办法是解决这个问题，并参考下面的代码作为最后的手段，看看我会怎么做。从长远来看，复制代码对您没有帮助，您最好假设您的教育工作者也在检查所有网站是否存在抄袭行为。

这是我想出的代码（很快，所以你需要测试它——它可能有错误）。我建议您详细阅读评论以*了解*它在做什么。

我会在几个小时后回来看看你过得怎么样。干杯。

```
.text
main:

# Initialization of array pointers and loop

    la      $t0, array1       # address of array 1
    la      $t1, array2       # address of array 2
    li      $t2, 1            # element number
    li      $t3, 6            # upper limit of elements

# Process each word in array 2, adding 10 and placing
# into array 1.

Loop:
    lw      $t3, 0($t1)       # get word from array 2
    addi    $t3, $t3, 10      # add 10 to word
    sw      $t3, 0($t0)       # store word into array 1
    addi    $t0, $t0, 4       # move to next entry in array 1 and 2
    addi    $t1, $t1, 4
    addi    $t2, $t2, 1       # increment element number
    blt     $t2, $t3, Loop    # loop until all elements done

# Initialize printing loop by going back to start of array 1

    la      $t0, array1       # address of array 1
    li      $t2, 1            # element number

# Loop through array 1, printing each element.

pLoop:  
    lw      $t2, 0($t0)       # get word from array 1
    li      $v0, 1            # 'print' command code
    move    $a0, $t2          # needs value in $a0
    syscall                   # print it
    addi    $t0, $t0, 4       # move to next entry in array 1
    addi    $t2, $t2, 1       # increment element number
    blt     $t2, $t3, Loop    # loop until all elements done

    li      $v0, 10           # 'terminate' command code
    syscall                   # exit

# Data arrays for array 1 and 2

.data
array1: .word 0,0,0,0,0
array2: .word 1,2,3,4,5 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-08T03:27:35.840

有许多可能的问题，但最明显/最可能的是您没有在数据部分开始之前从 main 返回。

```
jr ra 
```

# mysql - 如何使用 Rails ActiveRecord 迁移将主键插入 MySQL 数据库？

> ID：728415
> 
> 赞同：2
> 
> 时间：2009-04-08T03:24:27.360
> 
> 标签：mysql, ruby-on-rails, ruby, primary-key

我需要为图像文件表创建 AR 迁移。图像被检入到源代码树中，并且应该像 attachment_fu 文件一样工作。既然如此，我正在 /public/system 下为它们创建一个层次结构。

由于 attachment_fu 生成链接的方式，我需要使用目录命名约定来插入主键值。如何覆盖 MySQL 中的自动增量以及任何 Rails 魔法，以便我可以执行以下操作：

```
image = Image.create(:id => 42, :filename => "foo.jpg")
image.id #=> 42 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T17:22:42.460

哎呀，这不是一个令人愉快的问题。我能想到的最简单的方法是在您的迁移中添加一些代码，这些代码实际上通过附件“上传”所有文件，因此让插件创建 ID 并放置文件。

像这样的东西：

```
Dir.glob("/images/to/import/*.{jpg,png,gif}").each do |path|

  # simulate uploading the image
  tempfile = Tempfile.new(path)
  tempfile.set_encoding(Encoding::BINARY) if tempfile.respond_to?(:set_encoding)
  tempfile.binmode
  FileUtils.copy_file(path, tempfile.path)

  # create as you do in the controller - may need other metadata here
  image = Image.create({:uploaded_data => tempfile})
  unless image.save
    logger.info "Failed to save image #{path} in migration: #{image.errors.full_messages}"
  end

  tempfile.close!
end 
```

看看attachment-fu 的测试可能会有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T04:04:40.790

与 Sybase 不同，在 MySQL 中，如果在插入语句的列列表中指定 id 列，则可以在 id 中插入任何有效的、非重复的值。不需要做一些特别的事情。

我怀疑 rails 的魔法只是不让 rails 知道 id 是自动递增的。如果这是您插入此表的唯一方法，则不要将*id*设为 auto_increment。只需输入一个 int 非空主键。

虽然坦率地说，这是使用密钥作为数据，所以这让我感到不安。如果 attachment_fu 只是在寻找名为“id”的*列*，则将名为 id 的列设为真正的数据，并将名为“actual_id”的列设为实际的、合成的、auto_incremented 键。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-10T22:51:24.550

```
image = Image.create(:filename => "foo.jpg") { |r| r.id = 42 } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T04:31:25.607

这是我的kluge：

```
class AddImages < ActiveRecord::Migration
  def self.up
    Image.destroy_all

    execute("ALTER TABLE images AUTO_INCREMENT = 1")

    image = Image.create(:filename => "foo.jpg")
    image.id #=> 1
  end

  def self.down
  end
end 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T22:44:52.453

我不完全确定我理解你为什么需要这样做，但如果你只需要这样做一次，对于迁移，只需`execute`在迁移中使用来设置 ID（假设它还没有被占用，我可以'没想到会是）：

> 执行“插入图像（id，文件名）值（42，'foo.jpg'）”

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T02:19:52.503

我同意 AdminMyServer 虽然我相信您仍然可以直接在对象上执行此任务：

`image = Image.new :filename => "foo.jpg"
image.id = 42
image.save` 

您还需要确保在流程结束时更新您的 id 自动增量，以避免将来发生冲突。

`newValue = Images.find(:first, :order => 'id DESC').id + 1
execute("ALTER TABLE images AUTO_INCREMENT = #{newValue}")`

希望这可以帮助。

# c++ - c++ 中的 +-ing 字符串和 <<-ing 字符串有什么区别吗？

> ID：728416
> 
> 赞同：2
> 
> 时间：2009-04-08T03:25:23.083
> 
> 标签：c++, text, concatenation, cout

以下片段的效果之间有什么区别（如果有）：

```
cout << "Some text" << s1 << "some more text\n";

cout << "Some text" + s1 + "some more text\n"; 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-08T03:36:21.323

operator+ 对字符串的结果是一个新字符串。因此，在示例中

```
cout << "Some text" + s1 + "some more text\n"; 
```

在将整个内容写入 cout 之前，会创建两个新字符串（意味着内存分配）。在您的第一个示例中，所有内容都直接写入 cout ，没有不必要的内存分配。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T03:47:16.180

考虑以下：

```
cout << "Some text" + " " + "some more text\n"; 
```

它不会像你想的那样做。Operator+ 并不总是意味着连接。

**编辑：**当应用于原始字符串时， operator+ 不会连接 - 它会将指针的地址添加到字符串。结果几乎可以保证是无意义的，因为它指向的内存区域与任何原始字符串都没有关系。运气好的话，它会让你的程序崩溃。

**编辑2：**显然自从我犯这个错误以来已经很长时间了。结果是如此荒谬，以至于编译器拒绝编译它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T03:41:48.113

是的，`string operator+ (const char* lhs, const string& rhs)`创建并返回一个未命名的临时字符串对象。

`cout << "Some text"`调用 ostream& ostream::operator<<( const char* const) 并返回 ostream 引用。

```
cout << "Some text" << s1 << "some more text\n"; 
```

是`ostream::operator<<( "Some text").operator<<(s1).operator<<("some more text\n")`，对 cout 的三个调用，调用 op<< 的两个不同重载，即采用 a`const* char* const`的 op<< 和采用 a 的 op<< `const string&`。没有内存分配，唯一的复制是到 cout 的缓冲区。

```
cout << "Some text" + s1 + "some more text\n"; 
```

在`ostream::operator<<(t1)`一个临时字符串对象上，我将调用*t1*，其中 t1 是`::operator+ ( "Some text", s1).operator+("some more text\n")`. （注意第一个 operator+ 不是 string 的成员，而是命名空间范围内的 op+ (const char* const, const string&)。它返回一个字符串，所以第二个 +" 是 string::operator+( const char* const) .)

因此，在此代码中创建（然后销毁）两个临时字符串对象。这意味着字符串的两个内部表示（因此两个内存分配）和两个复制两个新分配的内存（除了复制到 cout 的缓冲区）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T03:33:44.140

第二个在将字符串发送到 cout 之前将它们连接起来，这是一个性能损失，对于大字符串可能会非常大。如果可以的话，你总是想使用第一种形式。

# ruby - 如何在 ruby 中设置类范围常量？

> ID：728417
> 
> 赞同：3
> 
> 时间：2009-04-08T03:25:52.147
> 
> 标签：ruby, constants

超级初学者易分红宝石题。我正在尝试通过对[Project Euler](http://projecteuler.net)问题进行编程来学习一些红宝石。所以我有一个测试

```
class ProjectEuler_tests < Test::Unit::TestCase
  @solution = 123456 # Not the answer so as not to be a spoiler
  def test_problem_1
    assert_equal(@solution, ProjectEuler1.new.solve)
  end
end 
```

但这不起作用，@solution 在测试运行时为零。在类范围内分配它的正确方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T03:36:45.567

[ruby 中的类常量](http://www.ruby-doc.org/docs/UsersGuide/rg/constants.html)以大写字符开头：

```
class ProjectEuler_tests < Test::Unit::TestCase
  SOLUTION = 123456 # Not the answer so as not to be a spoiler
  def test_problem_1
    assert_equal(SOLUTION, ProjectEuler1.new.solve)
  end
end 
```

# iphone - 如何在 iPhone 上实现 AABB 射线投射命中检查

> ID：728418
> 
> 赞同：4
> 
> 时间：2009-04-08T03:26:10.973
> 
> 标签：iphone, objective-c, 3d, opengl-es

基本上，我画了一个 3D 立方体，我可以旋转它，但我希望能够触摸它并知道用户触摸了立方体表面的哪个位置。

我用于设置、生成和旋转。它基于分子代码和 NeHe 教程 #5。

任何帮助、链接、教程和代码将不胜感激。我有很多开发经验，但在 openGL 和 3d 方面没有太多经验。

```
//
//  GLViewController.h
//  NeHe Lesson 05
//
//  Created by Jeff LaMarche on 12/12/08.
//  Copyright Jeff LaMarche Consulting 2008\. All rights reserved.
//

#import "GLViewController.h"
#import "GLView.h"

@implementation GLViewController
- (void)drawBox
{
    static const GLfloat cubeVertices[] = { 
        -1.0f, 1.0f, 1.0f,
        1.0f, 1.0f, 1.0f, 
        1.0f,-1.0f, 1.0f, 
        -1.0f,-1.0f, 1.0f,
        -1.0f, 1.0f,-1.0f,
        1.0f, 1.0f,-1.0f, 
        1.0f,-1.0f,-1.0f, 
        -1.0f,-1.0f,-1.0f 
    };
    static const GLubyte cubeNumberOfIndices = 36;

    const GLubyte cubeVertexFaces[] = { 
        0, 1, 5, // Half of top face
        0, 5, 4, // Other half of top face

        4, 6, 5, // Half of front face
        4, 6, 7,    // Other half of front face

        0, 1, 2, // Half of back face
        0, 3, 2, // Other half of back face

        1, 2, 5, // Half of right face
        2, 5, 6, // Other half of right face

        0, 3, 4, // Half of left face
        7, 4, 3, // Other half of left face

        3, 6, 2, // Half of bottom face
        6, 7, 3, // Other half of bottom face

    }; 
    const GLubyte cubeFaceColors[] = { 
        0, 255,   0, 255,
        255, 125,   0, 255,
        255,   0,   0, 255,
        255, 255,   0, 255,
        0,   0, 255, 255,
        255,   0, 255, 255
    };

    glEnableClientState(GL_VERTEX_ARRAY);

    glVertexPointer(3, GL_FLOAT, 0, cubeVertices);
    int colorIndex = 0;
    for(int i = 0; i < cubeNumberOfIndices; i += 3) 
    { 
        glColor4ub(cubeFaceColors[colorIndex], cubeFaceColors[colorIndex+1], cubeFaceColors[colorIndex+2], cubeFaceColors[colorIndex+3]);
        int face = (i / 3.0);
        if (face%2 != 0.0)
            colorIndex+=4;

        glDrawElements(GL_TRIANGLES, 3, GL_UNSIGNED_BYTE, &cubeVertexFaces[i]);
    } 

    glDisableClientState(GL_VERTEX_ARRAY);
}

//move this to a data model later!
- (GLfixed)floatToFixed:(GLfloat)aValue;
{ 
    return (GLfixed) (aValue * 65536.0f); 
}

- (void)drawViewByRotatingAroundX:(float)xRotation rotatingAroundY:(float)yRotation scaling:(float)scaleFactor translationInX:(float)xTranslation translationInY:(float)yTranslation view:(GLView*)view;
{
    glMatrixMode(GL_MODELVIEW);
    GLfixed currentModelViewMatrix[16]  = {  45146, 47441, 2485,  0,
                                            -25149, 26775,-54274, 0,
                                            -40303, 36435, 36650, 0,
                                                  0,    0,     0, 65536 };
    /*
    GLfixed currentModelViewMatrix[16]  = { 0, 0, 0, 0,
                                            0, 0, 0, 0,
                                            0, 0, 0, 0,
                                            0, 0, 0, 65536 };
    */
    //glLoadIdentity();
    //glOrthof(-1.0f, 1.0f, -1.5f, 1.5f, -10.0f, 4.0f);

    // Reset rotation system
    if (isFirstDrawing)
    {   
        //glLoadIdentity();
        glMultMatrixx(currentModelViewMatrix);
        [self configureLighting];
        isFirstDrawing = NO;
    }

    // Scale the view to fit current multitouch scaling
    GLfixed fixedPointScaleFactor = [self floatToFixed:scaleFactor];
    glScalex(fixedPointScaleFactor, fixedPointScaleFactor, fixedPointScaleFactor);      

    // Perform incremental rotation based on current angles in X and Y
    glGetFixedv(GL_MODELVIEW_MATRIX, currentModelViewMatrix);   

    GLfloat totalRotation = sqrt(xRotation*xRotation + yRotation*yRotation);

    glRotatex([self floatToFixed:totalRotation],
              (GLfixed)((xRotation/totalRotation) * (GLfloat)currentModelViewMatrix[1] + (yRotation/totalRotation) * (GLfloat)currentModelViewMatrix[0]),
              (GLfixed)((xRotation/totalRotation) * (GLfloat)currentModelViewMatrix[5] + (yRotation/totalRotation) * (GLfloat)currentModelViewMatrix[4]),
              (GLfixed)((xRotation/totalRotation) * (GLfloat)currentModelViewMatrix[9] + (yRotation/totalRotation) * (GLfloat)currentModelViewMatrix[8])
              );

    // Translate the model by the accumulated amount
    glGetFixedv(GL_MODELVIEW_MATRIX, currentModelViewMatrix);   
    float currentScaleFactor = sqrt(pow((GLfloat)currentModelViewMatrix[0] / 65536.0f, 2.0f) + pow((GLfloat)currentModelViewMatrix[1] / 65536.0f, 2.0f) + pow((GLfloat)currentModelViewMatrix[2] / 65536.0f, 2.0f));    

    xTranslation = xTranslation / (currentScaleFactor * currentScaleFactor);
    yTranslation = yTranslation / (currentScaleFactor * currentScaleFactor);
    // Grab the current model matrix, and use the (0,4,8) components to figure the eye's X axis in the model coordinate system, translate along that
    glTranslatef(xTranslation * (GLfloat)currentModelViewMatrix[0] / 65536.0f, xTranslation * (GLfloat)currentModelViewMatrix[4] / 65536.0f, xTranslation * (GLfloat)currentModelViewMatrix[8] / 65536.0f);
    // Grab the current model matrix, and use the (1,5,9) components to figure the eye's Y axis in the model coordinate system, translate along that
    glTranslatef(yTranslation * (GLfloat)currentModelViewMatrix[1] / 65536.0f, yTranslation * (GLfloat)currentModelViewMatrix[5] / 65536.0f, yTranslation * (GLfloat)currentModelViewMatrix[9] / 65536.0f);

    // Black background, with depth buffer enabled
    glClearColor(0.0f, 0.0f, 0.0f, 1.0f);
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

    [self drawBox];
}

- (void)configureLighting;
{
    const GLfixed           lightAmbient[] = {13107, 13107, 13107, 65535};
    const GLfixed           lightDiffuse[] = {65535, 65535, 65535, 65535};
    const GLfixed           matAmbient[] = {65535, 65535, 65535, 65535};
    const GLfixed           matDiffuse[] = {65535, 65535, 65535, 65535};    
    const GLfixed           lightPosition[] = {30535, -30535, 0, 0}; 
    const GLfixed           lightShininess = 20;    

    glEnable(GL_LIGHTING);
    glEnable(GL_LIGHT0);
    glEnable(GL_COLOR_MATERIAL);
    glMaterialxv(GL_FRONT_AND_BACK, GL_AMBIENT, matAmbient);
    glMaterialxv(GL_FRONT_AND_BACK, GL_DIFFUSE, matDiffuse);
    glMaterialx(GL_FRONT_AND_BACK, GL_SHININESS, lightShininess);
    glLightxv(GL_LIGHT0, GL_AMBIENT, lightAmbient);
    glLightxv(GL_LIGHT0, GL_DIFFUSE, lightDiffuse);
    glLightxv(GL_LIGHT0, GL_POSITION, lightPosition);       

    glEnable(GL_DEPTH_TEST);

    glShadeModel(GL_SMOOTH);
    glEnable(GL_NORMALIZE);         
}

-(void)setupView:(GLView*)view
{
    const GLfloat zNear = 0.1, 
    zFar = 1000.0, 
    fieldOfView = 60.0; 
    GLfloat size; 

    glMatrixMode(GL_PROJECTION); 
    glEnable(GL_DEPTH_TEST); 
    size = zNear * tanf(DEGREES_TO_RADIANS(fieldOfView) / 2.0); 
    CGRect rect = view.bounds; 
    glFrustumf(-size, size, -size / (rect.size.width / rect.size.height), size / 
               (rect.size.width / rect.size.height), zNear, zFar); 
    glViewport(0, 0, rect.size.width, rect.size.height);
    glScissor(0, 0, rect.size.width, rect.size.height);
    glMatrixMode(GL_MODELVIEW); 
    glLoadIdentity(); 
    glClearColor(0.0f, 0.0f, 0.0f, 1.0f); 

    glTranslatef(0.0f, 0.0f, -6.0f);
    isFirstDrawing = YES;
}

- (void)didReceiveMemoryWarning 
{
    [super didReceiveMemoryWarning]; 
}

- (void)dealloc 
{
    [super dealloc];
}

@end 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T10:25:08.637

为了实现 Ray cast hit 检查，您应该检查以下来源：
[http://www.mvps.org/directx/articles/rayproj.htm](http://www.mvps.org/directx/articles/rayproj.htm)
[http://bookofhook.com/mousepick.pdf](http://bookofhook.com/mousepick.pdf)
[http://eigenclass.blogspot .com/2008/10/opengl-es-picking-using-ray-boundingbox.html](http://eigenclass.blogspot.com/2008/10/opengl-es-picking-using-ray-boundingbox.html)

基本上，首先，从 2D 触摸创建 3D 射线。然后使用该射线检查与您世界中的对象的交集。您应该创建当前矩阵的逆矩阵，并且从逆矩阵中，您可以使用近和远剪辑平面创建开始和结束位置。然后在计算近点和远点时，您应该应用投影设置。

顺便说一句：在我的项目中，我的点识别是基于颜色唯一像素比较而不是光线投射命中检查。只需找到独特的颜色，就更容易实现命中检查。只是一个建议，希望对您有所帮助:) 干杯，
Guvener

# c# - 如何以编程方式单击 WPF 中的按钮？

> ID：728432
> 
> 赞同：153
> 
> 时间：2009-04-08T03:32:01.163
> 
> 标签：c#, .net, wpf, button

由于 WPF 中没有`button.PerformClick()`方法，有没有办法以编程方式单击 WPF 按钮？

* * *

## 回答 #1

> 赞同：199
> 
> 时间：2009-04-09T12:21:38.293

就像 JaredPar 说的，你可以参考 Josh Smith 的自动化文章。但是，如果您查看他的文章的评论，您会发现针对 WPF 控件引发事件的更优雅的方式

```
someButton.RaiseEvent(new RoutedEventArgs(ButtonBase.ClickEvent)); 
```

我个人更喜欢上面的那个而不是自动化同行。

* * *

## 回答 #2

> 赞同：143
> 
> 时间：2009-04-08T03:38:08.590

WPF 在此采用与 WinForms 略有不同的方法。他们没有将对象的自动化内置到 API 中，而是为每个负责自动化它的对象提供了一个单独的类。在这种情况下，您需要`ButtonAutomationPeer`完成此任务。

```
ButtonAutomationPeer peer = new ButtonAutomationPeer(someButton);
IInvokeProvider invokeProv = peer.GetPattern(PatternInterface.Invoke) as IInvokeProvider;
invokeProv.Invoke(); 
```

[这](http://joshsmithonwpf.wordpress.com/2007/03/09/how-to-programmatically-click-a-button/)是关于该主题的博客文章。

注意：`IInvokeProvider`接口是在`UIAutomationProvider`程序集中定义的。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2011-03-16T12:10:57.153

如果你想调用点击事件：

```
SomeButton.RaiseEvent(new RoutedEventArgs(Button.ClickEvent)); 
```

如果您希望按钮看起来像被按下：

```
typeof(Button).GetMethod("set_IsPressed", BindingFlags.Instance | BindingFlags.NonPublic).Invoke(SomeButton, new object[] { true }); 
```

之后就没有压力了：

```
typeof(Button).GetMethod("set_IsPressed", BindingFlags.Instance | BindingFlags.NonPublic).Invoke(SomeButton, new object[] { false }); 
```

或使用切换按钮

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2012-06-14T07:29:45.360

```
this.PowerButton.RaiseEvent(new RoutedEventArgs(Button.ClickEvent)); 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-08T03:35:39.877

如果您可以访问源，则以编程方式“单击”按钮的一种方法是简单地调用按钮的 OnClick 事件处理程序（或执行与按钮关联的 ICommand，如果您正在以更 WPF-y 的方式执行操作）。

你为什么做这个？例如，您是在进行某种自动化测试，还是尝试执行按钮从不同代码部分执行的相同操作？

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-09-03T12:58:51.333

正如[Greg D](https://stackoverflow.com/users/6932/greg-d)所说，我认为`Automation`使用 MVVM 模式（引发单击事件并执行命令）单击按钮的替代方法是`OnClick`使用反射调用该方法：

```
typeof(System.Windows.Controls.Primitives.ButtonBase).GetMethod("OnClick", BindingFlags.Instance | BindingFlags.NonPublic).Invoke(button, new object[0]); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-01-13T21:57:19.953

在使用*MVVM*命令模式进行**Button**功能时（推荐做法），触发**Button**效果的简单方法如下：

```
someButton.Command.Execute(someButton.CommandParameter); 
```

这将使用按钮触发的**Command**对象并传递*XAML*定义的**CommandParameter**。

 ** * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-02-03T08:50:06.800

自动化 API 解决方案的问题在于，它需要对框架程序集的引用`UIAutomationProvider`作为项目/包依赖项。

另一种方法是模仿行为。下面是我的扩展解决方案，它还考虑了 MVVM 模式及其绑定命令 - 实现为**扩展方法**：

```
public static class ButtonExtensions
{
    /// <summary>
    /// Performs a click on the button.<br/>
    /// This is the WPF-equivalent of the Windows Forms method "<see cref="M:System.Windows.Forms.Button.PerformClick" />".
    /// <para>This simulates the same behaviours as the button was clicked by the user by keyboard or mouse:<br />
    /// 1\. The raising the ClickEvent.<br />
    /// 2.1\. Checking that the bound command can be executed, calling <see cref="ICommand.CanExecute" />, if a command is bound.<br />
    /// 2.2\. If command can be executed, then the <see cref="ICommand.Execute(object)" /> will be called and the optional bound parameter is p
    /// </para>
    /// </summary>
    /// <param name="sourceButton">The source button.</param>
    /// <exception cref="ArgumentNullException">sourceButton</exception>
    public static void PerformClick(this Button sourceButton)
    {
        // Check parameters
        if (sourceButton == null)
            throw new ArgumentNullException(nameof(sourceButton));

        // 1.) Raise the Click-event
        sourceButton.RaiseEvent(new RoutedEventArgs(System.Windows.Controls.Primitives.ButtonBase.ClickEvent));

        // 2.) Execute the command, if bound and can be executed
        ICommand boundCommand = sourceButton.Command;
        if (boundCommand != null)
        {
            object parameter = sourceButton.CommandParameter;
            if (boundCommand.CanExecute(parameter) == true)
                boundCommand.Execute(parameter);
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-08-21T20:19:23.357

您也可以调用按钮被点击的方法 `Button_Click(new object(), new RoutedEventArgs(ButtonBase.ClickEvent));` 花药方式是`ButtonName.RaiseEvent(new RoutedEventArgs(ButtonBase.ClickEvent));` 两种方式都需要`using System.Windows.Controls.Primitives;`

*   `Button_Click(new object(), new RoutedEventArgs(ButtonBase.ClickEvent));`
*   `ButtonName.RaiseEvent(new RoutedEventArgs(ButtonBase.ClickEvent));`

# c# - C# 中基于接口编程的运算符重载

> ID：728434
> 
> 赞同：76
> 
> 时间：2009-04-08T03:32:13.037
> 
> 标签：c#, .net, operator-overloading, equals

## 背景

我在当前项目中使用基于接口的编程，并且在重载运算符（特别是 Equality 和 Inequality 运算符）时遇到了问题。

* * *

## 假设

*   我正在使用 C# 3.0、.NET 3.5 和 Visual Studio 2008

更新 - 以下假设是错误的！

*   要求所有比较都使用 Equals 而不是 operator== 不是一个可行的解决方案，尤其是在将类型传递给库（例如 Collections）时。

我担心要求使用 Equals 而不是 operator== 的原因是，我在 .NET 指南中找不到任何地方表明它将使用 Equals 而不是 operator== 甚至建议使用它。但是，在重新阅读[了覆盖等于和运算符 == 的指南](http://msdn.microsoft.com/en-us/library/ms173147.aspx)后，我发现了这一点：

> 默认情况下，运算符 == 通过确定两个引用是否指示同一个对象来测试引用是否相等。因此，引用类型不必实现 operator == 即可获得此功能。当类型是不可变的，即实例中包含的数据不能更改时，重载运算符 == 来比较值相等而不是引用相等可能很有用，因为作为不可变对象，它们可以被视为与 long 相同因为它们具有相同的价值。在非不可变类型中覆盖 operator == 不是一个好主意。

和这个[Equatable Interface](http://msdn.microsoft.com/en-us/library/ms131187.aspx)

> IEquatable 接口由通用集合对象（例如 Dictionary、List 和 LinkedList）在 Contains、IndexOf、LastIndexOf 和 Remove 等方法中测试相等性时使用。应该为可能存储在通用集合中的任何对象实现它。

* * *

## 约束

*   任何解决方案都不得要求将对象从它们的接口转换为它们的具体类型。

* * *

## 问题

*   当 operator== 的两边都是接口时，没有来自底层具体类型的 operator== 重载方法签名将匹配，因此将调用默认的 Object operator== 方法。
*   在类上重载运算符时，二元运算符的至少一个参数必须是包含类型，否则会产生编译器错误（错误 BC33021 [http://msdn.microsoft.com/en-us/library/watt39ff .aspx](http://msdn.microsoft.com/en-us/library/watt39ff.aspx) )
*   无法在接口上指定实现

请参阅下面演示该问题的代码和输出。

* * *

## 问题

**在使用基于接口的编程时，如何为类提供适当的运算符重载？**

* * *

## 参考

[== 运算符（C# 参考）](http://msdn.microsoft.com/en-us/library/53k8ybth.aspx)

对于预定义的值类型，相等运算符 (==) 如果其操作数的值相等则返回 true，否则返回 false。对于字符串以外的引用类型，== 如果它的两个操作数引用同一个对象，则返回 true。对于字符串类型，== 比较字符串的值。

* * *

## 也可以看看

* * *

## 代码

```
using System;

namespace OperatorOverloadsWithInterfaces
{
    public interface IAddress : IEquatable<IAddress>
    {
        string StreetName { get; set; }
        string City { get; set; }
        string State { get; set; }
    }

    public class Address : IAddress
    {
        private string _streetName;
        private string _city;
        private string _state;

        public Address(string city, string state, string streetName)
        {
            City = city;
            State = state;
            StreetName = streetName;
        }

        #region IAddress Members

        public virtual string StreetName
        {
            get { return _streetName; }
            set { _streetName = value; }
        }

        public virtual string City
        {
            get { return _city; }
            set { _city = value; }
        }

        public virtual string State
        {
            get { return _state; }
            set { _state = value; }
        }

        public static bool operator ==(Address lhs, Address rhs)
        {
            Console.WriteLine("Address operator== overload called.");
            // If both sides of the argument are the same instance or null, they are equal
            if (Object.ReferenceEquals(lhs, rhs))
            {
                return true;
            }

            return lhs.Equals(rhs);
        }

        public static bool operator !=(Address lhs, Address rhs)
        {
            return !(lhs == rhs);
        }

        public override bool Equals(object obj)
        {
            // Use 'as' rather than a cast to get a null rather an exception
            // if the object isn't convertible
            Address address = obj as Address;
            return this.Equals(address);
        }

        public override int GetHashCode()
        {
            string composite = StreetName + City + State;
            return composite.GetHashCode();
        }

        #endregion

        #region IEquatable<IAddress> Members

        public virtual bool Equals(IAddress other)
        {
            // Per MSDN documentation, x.Equals(null) should return false
            if ((object)other == null)
            {
                return false;
            }

            return ((this.City == other.City)
                && (this.State == other.State)
                && (this.StreetName == other.StreetName));
        }

        #endregion
    }

    public class Program
    {
        static void Main(string[] args)
        {
            IAddress address1 = new Address("seattle", "washington", "Awesome St");
            IAddress address2 = new Address("seattle", "washington", "Awesome St");

            functionThatComparesAddresses(address1, address2);

            Console.Read();
        }

        public static void functionThatComparesAddresses(IAddress address1, IAddress address2)
        {
            if (address1 == address2)
            {
                Console.WriteLine("Equal with the interfaces.");
            }

            if ((Address)address1 == address2)
            {
                Console.WriteLine("Equal with Left-hand side cast.");
            }

            if (address1 == (Address)address2)
            {
                Console.WriteLine("Equal with Right-hand side cast.");
            }

            if ((Address)address1 == (Address)address2)
            {
                Console.WriteLine("Equal with both sides cast.");
            }
        }
    }
} 
```

* * *

## 输出

```
Address operator== overload called
Equal with both sides cast. 
```

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-04-08T04:22:08.033

简短回答：我认为您的第二个假设可能存在缺陷。**`Equals()`是检查两个对象的*语义相等*`operator ==`性的正确方法，而不是.**

* * *

长答案：运算符的重载解析是*在编译时执行的，而不是在运行时执行的*。

除非编译器可以明确知道它应用运算符的对象的类型，否则它不会编译。由于编译器无法确定 an`IAddress`是否会成为已定义覆盖的东西，`==`因此它会回退到`operator ==`.`System.Object`

**为了更清楚地看到这一点，请尝试定义一个`operator +`for`Address`并添加两个`IAddress`实例。**除非您显式转换为`Address`，否则它将无法编译。为什么？因为编译器无法判断某个特定`IAddress`是 an `Address`，并且没有默认`operator +`实现可以回退到 in `System.Object`。

* * *

您的部分挫败感可能源于`Object`实现 an的事实`operator ==`，并且一切都是 an `Object`，因此编译器可以成功地解析`a == b`所有类型的操作。当您覆盖时`==`，您希望看到相同的行为但没有，这是因为编译器可以找到的最佳匹配是原始`Object`实现。

> 要求所有比较都使用 Equals 而不是 operator== 不是一个可行的解决方案，尤其是在将类型传递给库（例如 Collections）时。

在我看来，这正是你应该做的。**`Equals()`是检查两个对象的*语义相等性的正确方法。***有时语义相等只是引用相等，在这种情况下您不需要更改任何内容。在其他情况下，如您的示例中，`Equals`当您需要比引用相等性更强的相等性合同时，您将覆盖。例如，如果两个`Persons`人具有相同的社会安全号码，您可能需要考虑两个相等，或者`Vehicles`如果他们具有相同的 VIN，则两个相等。

但是`Equals()`和`operator ==`不是一回事。每当你需要覆盖`operator ==`时，你应该覆盖`Equals()`，但几乎从不反过来。`operator ==`更多的是语法上的便利。某些 CLR 语言（例如 Visual Basic.NET）甚至不允许您覆盖相等运算符。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-12-16T15:35:49.710

我们遇到了同样的问题，并找到了一个很好的解决方案：ReSharper 自定义模式。

我们将所有用户配置为使用除他们自己之外的通用全局模式目录，并将其放入 SVN 中，以便每个人都可以对其进行版本控制和更新。

该目录包括我们系统中已知的所有错误模式：

`$i1$ == $i2$` （其中 i1 和 i2 是我们的接口类型的*表达式*，或派生的。

替换模式是

`$i1$.Equals($i2$)`

严重性为“显示为错误”。

同样我们有`$i1$ != $i2$`

希望这可以帮助。PS 全局目录是 ReSharper 6.1 (EAP) 中的功能，很快就会被标记为最终版本。

**更新**：我提交了一个[ReSharper 问题](http://youtrack.jetbrains.net/issue/RSRP-286954)以将所有接口“==”标记为警告，除非它与 null 进行比较。如果您认为这是一个有价值的功能，请投票。

**Update2**：ReSharper 还具有可以提供帮助的 [CannotApplyEqualityOperator] 属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-02-14T02:01:56.863

IMO 这是 C# 中一个令人困惑的设计缺陷。IMO == 应该和现在的完全一样`Equals`（基本上不应该有`Equals`），如果你想要只引用相等，你可以调用一个专门的方法，比如 ReferenceEquals。围绕运算符重载和继承的语言设计缺陷加剧了这种情况 - 即您注意到的那些以及缺乏对运算符的扩展方法支持。

# c# - 显示来自摄像机的实时图像

> ID：728437
> 
> 赞同：0
> 
> 时间：2009-04-08T03:34:43.857
> 
> 标签：c#, .net, image-processing

我正在开发一个 C# .NET 应用程序，它将显示从相机（智能相机）捕获的图像。我正在使用下面的函数将从相机接收到的原始数据（这是一个字节数组）转换为位图图像。我在下面的代码中遇到的问题是，显示在 C# .NET 应用程序的图片框中的图像（理想情况下应该是实时图像）看起来像电影卷轴，并且一直向右滚动。知道如何解决这个问题吗？

```
private Image ByteArrayToImage(byte[] myByteArray) 
{
    if (myByteArray != null)
    {
        MemoryStream ms = new MemoryStream(myByteArray);
        int Height = 504; /*The exact height of image from Smart Camera*/
        int Width = 664;  /*The exact width of image from Smart Camera*/

        BitmapData bmpData = 
            bmp.LockBits(new Rectangle(0, 0, bmp.Width, bmp.Height), 
                         ImageLockMode.WriteOnly, bmp.PixelFormat);

        Marshal.Copy(myByteArray, 0, bmpData.Scan0, myByteArray.Length);

        Bitmap bmp = new Bitmap(Width, Height, PixelFormat.Format24bppRgb);
        BitmapData bmpData = 
            bmp.LockBits(new Rectangle(0, 0, bmp.Width, bmp.Height), 
                         ImageLockMode.ReadWrite, bmp.PixelFormat);
        int offset = 0;
        long ptr = bmpData.Scan0.ToInt64();
        for (int i = 0; i < Height; i++)
        {
            Marshal.Copy(myByteArray, offset, new IntPtr(ptr), Width);
            offset += (Width);
            ptr += bmpData.Stride;
        }
        bmp.UnlockBits(bmpData);
        return bmp;
    }
    return null;
} 
```

@Mark，在我用于从相机接收数据的代码段下方找到...

逻辑：我首先接收 sizeof 图像，然后打开套接字连接 n 循环，直到我从相机获得 sizeof 字节。

```
public static byte[] receivedata(Socket clientSock)
{
    if (clientSock != null)
    {
        byte[] size = new byte[10000000]; 
        byte[] buffer = null;
        int ch, received, offset;

        try
        {
            clientSock.Receive(size);
            //MessageBox.Show("size array is " + size[0] 
            // +  " " + size[1] +  " " + size[2] +  " " );
            ch = BitConverter.ToInt32(size, 0);

            //ch = 334656;

            //MessageBox.Show("Sizeofimg = " + ch + "");

            buffer = new byte[ch];

            //MessageBox.Show("Start receiving image from camera");
            received = 0;
            offset = 0;
            do
            {
                received += clientSock.Receive(buffer, 
                                               offset + received, 
                                               ch - received,
                                               SocketFlags.None);
            } while (received < ch);

                //MessageBox.Show("Received " + received + " values");
                System.Threading.Thread.Sleep(50);
            }
            catch (Exception e)
            {
                MessageBox.Show("Error receiving ...");
                MessageBox.Show(e.StackTrace);
            }
            return buffer;
        }
        else
        {
            return null;
        }
    }
} 
```

请指出问题...在此先感谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T03:54:10.737

“向右滚动”告诉我每个图像都在一致地解码，但连续的图像彼此之间是关闭的。正确的？这意味着问题不在于您向我们展示的代码，而在于从相机读取的代码。

**编辑：**您的宽度和高度似乎有一点偏差。我为 664x504 相机找到的唯一文档指出，“活动区域”（实际包含图片的部分）实际上是 648x488。如果是这种情况，您的图片似乎也会有点倾斜，因为每一行都会从下一行偏移，并且会向上移动，因为您读取的每一帧都会获得下一帧数据的一部分。

# mobile - Web、应用程序和移动编程之间的主要技术区别是什么？

> ID：728443
> 
> 赞同：3
> 
> 时间：2009-04-08T03:37:42.007
> 
> 标签：mobile

我想知道 Web（ASP、PHP、Ruby 等）、应用程序（C、C++、.NET、Java）和移动（J2ME、Objective C）编程之间的主要技术区别是什么，哪个最难.

如果有人学习其中之一，他是否可以轻松切换到其他之一？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T13:37:27.463

首先，从*技术*角度来看，您应该询问 Web 应用程序和客户端应用程序之间的区别。在每个类别中，您可以询问标准 Web 应用程序和移动 Web 应用程序以及标准客户端应用程序和移动客户端应用程序之间的区别。

Web 应用程序和客户端应用程序之间的区别在于 Web 应用程序缺少状态：每个页面请求都与所有其他页面请求完全断开链接。只有通过各种技术变通方法，Web 应用程序才能设法维持 Web 应用程序用户在从一个页面导航到另一个页面时正在运行一个连贯的应用程序的错觉。例如，在 ASP.NET 中，ASP.NET ISAPI DLL 管理一个“会话”对象，该对象从用户的页面请求中提取会话 cookie，然后使用它来识别适合处理请求的会话数据。

相比之下，在客户端应用程序中，应用程序的每个方面都针对单个用户，并且当您从一个对话框导航到另一个对话框时，应用程序的“状态”是给定的。此外，应用程序与用户计算机的紧密集成允许使用板载资源（内存、磁盘）。相比之下，在 Web 应用程序中，除了由浏览器（它*是*客户端应用程序，而不是 Web 应用程序）介导之外，对这些资源的访问很少或根本没有。

*移动*Web 应用程序本质上只是具有两个警告的 Web 应用程序：屏幕尺寸要小得多，并且浏览器功能通常不太健壮。因此，您编写移动 Web 应用程序的方式与标准 Web 应用程序几乎相同，但您不能指望成熟浏览器通常具有的某些功能。顺便说一句，随着移动设备变得更强大，最后一个限制正在迅速消失。

移动*客户端*应用程序需要特定于移动设备的开发环境、部署策略等。标准客户端应用程序开发中使用的工具和技术不能很好地映射到移动客户端。相反，您需要学习新的工具、控件和技术。此规则唯一真正的例外是可通过 .NET 获得的工具。Microsoft 已尝试提供尽可能多的通用性，尽管即使在这里，您也会发现与开发 WinForms 应用程序时相比，您有不同的思维方式和不同的约束。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T03:55:17.893

这是这些应用程序运行的上下文。

Web 应用程序在服务器上运行，旨在为使用 Web 浏览器的大量客户端提供服务。尽管 Web 服务器本身运行在某些操作系统上，但在它们上运行的 Web 应用程序并没有与该操作系统紧密耦合。

移动和桌面应用程序通常与运行它们的操作系统更紧密地耦合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T03:45:14.517

移动应用程序可以与桌面应用程序一样编写，大致为 Windows 应用程序、控制台应用程序和浏览器应用程序（因为大多数移动平台都支持浏览器）。但大多数工具的移动版本受到更多限制；并且通常涉及通信，这通常会使开发更具挑战性，试图保持各种状态。而且您通常必须对 UI 代码中的细微之处更加敏感。

移动应用程序和 Web 应用程序之间确实没有特别的二分法。这些概念并不是特别正交。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T13:32:45.150

如果您查看像 .NET 这样的编程框架，您将能够轻松地在 Web（ASP.NET 和 Silverlight）、移动（.NET 移动）和桌面（.NET 和 WPF）之间切换，因为这些语言都基于相同的核心框架。您可以用不同的语言编写 .NET，其中最常见的是 VB.NET 和 C#。

如果您正在学习，我个人建议使用 C#。你会在互联网上找到更多的例子，它也会更类似于你将来可能想要学习的语言（JavaScript、Java 等）

# javascript - 在 IE Mobile 的 JavaScript 中替代“className”？

> ID：728447
> 
> 赞同：1
> 
> 时间：2009-04-08T03:40:03.530
> 
> 标签：javascript, ie-mobile

我正在开发一个需要在 IE Mobile 中运行的移动网络应用程序。我已经缩小了一个 JavaScript 错误，我遇到了 IE Mobile 不支持“ `className`”属性（IE4 引擎...）。我正在尝试找到一种适用于所有浏览器且代码更改最少的替代方案（我已经有一些使用' `className`'的库）。

我能想到的最简单的方法是修改 IE 的元素原型以包含 className（如果没有的话），问题是我不知道`className`IE Mobile 中的 ' ' 替代品是什么。

我试过这个：

```
element.className = element.class; 
```

这显然不起作用，因为`class`它是 JavaScript 中的一个关键字，而我的 JS 压缩器不喜欢它，而且它可能无论如何都无效。

除了在我需要修改元素的类的任何地方使用“setAttribute()”之外，是否有任何我可以使用的属性等同于 className？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T18:21:28.460

虽然您无法避免使用`setAttribute()`，但您可以从 jQuery 剧本中取出一行并使用带有可选参数的辅助过程。此代码未经测试，但应该可以工作：

```
var className = function (obj, value)
{
    if (value !== undefined)
    {
        return obj.setAttribute ('class', value);
    }
    return obj.getAttribute ('class');
};

// Use as
alert (className (element));
className (element, "foo");
alert (className (element)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T04:01:51.933

没有属性，没有。恐怕你被 getAttribute() 和 setAttribute() 困住了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-14T17:31:45.983

按照 John Millikin 的做法，您甚至可以将该函数作为 IE 元素原型的一部分：

```
Element.prototype.getClass = function() {
    return obj.getAttribute ('class');
}
Element.prototype.setClass = function(newClass) {
    return obj.setAttribute('class', newClass);
} 
```

或者如果你想要一个像约翰提供的组合方法......

```
Element.prototype.className = function(newClass) {
    if (!newClass)
        return this.getClass();
    return this.setClass(newClass);
} 
```

# c# - C# 中的事件跟踪

> ID：728450
> 
> 赞同：0
> 
> 时间：2009-04-08T03:43:45.660
> 
> 标签：c#, events, bug-tracking, sequence

我想了解事件周期。我有一个带有网格和文本框的表单。它有一个网格，绑定到 DataTable，文本框也绑定到同一个表。我正在尝试调试某些东西，并且需要知道如何识别表单中触发的所有事件，以查看可以为我解决问题的方法。

无论如何，除非我明确地对表单上的每个类进行子类化，并将每个事件覆盖/附加到我自己的事件处理程序，否则我如何获取/侦听在某个操作期间触发的所有事件......例如更改“已选择” DataGridView 中的道路。它显然更新了自己的“CurrentRow”......我需要知道什么/如何强制重新加载 SAME CurrentRow。

原因：在表单级别“编辑模式”期间，我更改了另一个“文本框”控件中的内容，并拒绝更改，我需要它来模拟当前“记录”被重新加载以恢复其原始值。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T03:52:15.593

您可以启动分析器并查看方法调用树。

# c# - 在 ItemTemplate 中将 Gridview 列从 ID 转换为字符串

> ID：728451
> 
> 赞同：0
> 
> 时间：2009-04-08T03:44:33.940
> 
> 标签：c#, asp.net, gridview, controls

我目前有一个显示的 Gridview

类型ID、名称、描述。

我想在 gridview 中显示实际类型名称而不是 TypeID。我创建了这个接受 ID 并返回名称的函数，但我在使用它时遇到了问题。有 15-20 种不同的类型，所以如何将 TypeID 转换为类型名称，以便在呈现 Gridview 时显示它。

```
protected string GetGenericTypeByID(int genericTypeID)
        {
            string genericTypeName;

            GenericType.Generic_TypeDataTable genericTypeNameDS = new GenericType.Generic_TypeDataTable();
            genericTypeNameDS = GenericBO.Get_GenericTypeByID(genericTypeID);

            genericTypeName = genericTypeNameDS[0]["Generic_Type_Name"].ToString();

            return genericTypeName;

        } 
```

我以为我可以在 ItemTemplate 中使用该功能，但我认为似乎更难

```
 <ItemTemplate>
                    <asp:Label ID="Label1" runat="server" Text='<%# Bind("GetGenericTypeByID("Generic_Type_ID")")%>'></asp:Label>
                </ItemTemplate> 
```

感谢所有帮助我解决这个问题的人。我最终使用了下面的方法，并且效果很好。GetGenericTypeByID(Convert.ToInt32(Eval("Generic_Type_ID")))

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T05:15:12.647

您已经完全掌握了“bind/eval”和方法调用。
请参阅[在 DataGrid 或 GridView TemplateField 中使用方法](http://yasserzaid.wordpress.com/2009/03/12/using-method-inside-a-datagrid-or-gridview-templatefield/)

```
<asp:TemplateField HeaderText=”Name”&gt;
<ItemTemplate>
    <a href='<%# FormatUrl(Eval(”email1″).ToString())%>'><%# Eval(”fname”) %>,&nbsp;<%# Eval(”lname”) %></a>
</ItemTemplate> 
```

'FormatUrl' 函数为：

```
public string FormatUrl(string email)
{
    return “mailto:” + email;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T05:26:15.320

您是否仅限于标签标签？如果没有，请扩展 David HAust 的答案，尝试以下操作：

```
<ItemTemplate>
    <%#GetGenericTypeByID(Eval(Generic_Type_ID))%>
</ItemTemplate> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T05:01:05.553

在用于填充网格的行类上创建一个只读属性，并获取此属性以返回函数的结果。

# objective-c - Objective-C 数组，风格和精神

> ID：728453
> 
> 赞同：1
> 
> 时间：2009-04-08T03:46:44.653
> 
> 标签：objective-c

新手问题。查看数组（即：动态大小）这有效：

```
NSArray *array;
array = [NSArray arrayWithObjects:
     @"one", @"two", nil]; 
```

这不会：

```
array = [NSArray arrayWithObjects:
     1, 2, nil]; 
```

好的我明白了。这有效：

```
array = [NSArray arrayWithObjects:
     [NSNumber numberWithInt:1], [NSNumber numberWithInt:2], nil]; 
```

它不像 C++ / Java 那样“即时”。我在阅读的 init 示例中看到了同样的情况。例如：

```
// pseudo objc example
MyVar v = [MyVar init];  // blank
[v setSomething];
[v setSomethingElse];
// use v down here 
```

在 C++/Java 中，我会这样做：

```
MyVar v = new MyVar("foo", "bar", "baz", "quux"); 
```

而且我知道默认情况下 v 已准备就绪。有没有我不应该战斗的ObjC精神？我是否应该期望写更多的行和更少的“单行”？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T04:02:29.687

在 Objective-C 中，“init”方法只是一个方法。与构造函数不同于其他方法的 Java 或 C++ 不同。因此，您可以定义自己的 init 方法，其行为类似于 C++ 或 Java 构造函数。例如，您可以定义一个带有多个参数的 init 方法。它可能看起来像这样。

```
MyVar* v = [[MyVar alloc] initWithName:@"foo" andTitle:@"bar"];
// do something with v
[v release]; 
```

通常的做法是简单地创建执行对象初始化的新方法，并在方法名称前加上“init”以保持清晰和一致性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T09:10:56.340

使用 Objective-C 的冗长所获得的是更高的可读性。

当然，当你在写代码时，可能很容易敲出你写的东西

```
MyRect rect = new MyRect(1.0, 1.0, 3.0 3.0); 
```

但是当你，或者更有可能是其他人来维护你的代码时，我会认为这更容易阅读：

```
MyRect *rect = [[MyRect alloc] initWithX:1.0 Y:1.0 width:3.0 height:3.0]; 
```

在这些聪明的编辑器时代，写起来并没有那么难。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T09:23:08.137

`NSArray`, 其可修改的变体`NSMutableArray`, 以及所有的集合结构 ( `NSDictionary`, `NSSet`) 都是为存储对象而设计的。这就是为什么你看到`[NSNumber numberWithInt:1]`而不是简单的`1`。

对于字符串，请注意 Objective-c 字符串（如`@"one"`，包括前导`@`）是类型的对象`NSString`，而 C 字符串（如`"one"`，不带`@`）不是对象。

如果您希望在数组中存储简单值，请不要忘记 Objective-C 是 C 的超集。这意味着您可以使用如下声明：

```
int array[] = { 1, 2, 3 }; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T04:03:09.653

您可以编写带有命名参数的构造函数以将其简化为一行：

```
MyVar *v = [[MyVar alloc] initWithFoo:@"foo" bar:@"bar" baz:@"baz" quux:@"quux"]; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T04:01:34.290

是的，Objective-C 相当冗长，所以你需要习惯它。

`MyVar init`情况不太对；您通常需要执行 a`[[MyVar alloc] init]`或 a `[MyVar new]`。在许多情况下，有一些`init`变体接受参数，比如

```
MyVar v = [[MyVar alloc] initWithSomething: "foo" somethingElse: "bar"]; 
```

如果你想要一些不那么冗长的东西，你可以在其中获得更多的衬里，你可能想研究一下[MacRuby](http://www.macruby.org/)，它是 Ruby 和 Objective-C 之间的绑定，让你可以访问所有 Cocoa API，但更紧凑, 高级语法（而且你可以使用[HotCocoa](http://www.macruby.org/hotcocoa.html)变得更紧凑。当然，使用 MacRuby 会有一点性能损失，所以如果你正在做一个高性能游戏，编写你的绘图循环可能并不理想在 RubyCocoa 中，但它适用于绝大多数应用程序。

# spring - 如何注入 Spring ReloadableResourceBundleMessageSource

> ID：728455
> 
> 赞同：4
> 
> 时间：2009-04-08T03:47:12.093
> 
> 标签：spring

为了以编程方式刷新资源包缓存，我使用了 Spring 的 ReloadableResourceBundleMessageSource。我无法将它注入到我想要调用 clearCache() 方法的 bean 中。

我不得不求助于以下方法：

```
private ReloadableResourceBundleMessageSource messageSource;

@Autowired
public void setMessageSource(MessageSource messageSource) {
  this.messageSource = (ReloadableResourceBundleMessageSource((DelegatingMessageSource)messageSource).getParentMessageSource();
} 
```

这行得通，但必须有更好的方法。消息资源定义如下：

```
<bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
<property name="basenames" >
<list>
   <value>WEB-INF/content/Content</value>
 </list>
 </property>
</bean> 
```

我不明白为什么 Spring 会注入 DelegatingMessageSource 类型的消息源。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T09:48:21.253

我不认为在这种情况下按类型自动装配会起作用，因为自动装配候选者很可能是它`ApplicationContext`本身（参见参考文档的[第 3.8.2 节](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#context-functionality-messagesource)）。这导致您必须挖掘所有这些层才能获得原始`ReloadableResourceBundleMessageSource`.

尝试`messageSource`通过 XML 配置传递对 bean 的引用。用注释属性`@Qualifier('messageSource')`也应该工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-25T18:22:32.107

当 Spring 找不到定义的“messageSource”时，通常会注入 DelegatingMessageSource。你确定你正确地定义了它或者它在必要时是可见的吗？我认为这里的问题是如何设置 XML 配置。

我在 Spring Web Flow 和表单操作方面遇到了类似的情况。在我的 XML 配置中，“messageSource”不可见，导致 DelegatingMessageSource 被注入。我将“messageSource”bean 定义放入 webflow 配置中，然后一切正常，我停止获取 DelegationMessageSource 对象。然而，这是一个丑陋的修复，因为现在我在两个地方定义了“messageSource”。

无论如何，这个问题是在我切换到 Spring 2.5.6 之后才开始的。我正在使用 Webflow 1。一旦有机会，我将尝试更新到 Webflow 2，看看会发生什么。也许这会解决问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T19:31:27.877

您是否尝试将方法定义为：

```
public void setMessageSource(ReloadableResourceBundleMessageSource messageSoure) {
    this.messageSoure = messageSoure;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-01T11:30:39.660

当您尝试`messageSource`在控制器中运行它时，您会得到任何东西，空字符串。如果你仔细观察，你会发现你`DelegatingMessageSource`的 messageSource 属性中有一个空的父源，这意味着它是 EMPTY，即总是返回空白，并且这个异常发生在控制器中

```
ReloadableResourceBundleMessageSource incompatible with org.springframework.context.support.DelegatingMessageSource 
```

[阅读更多..](http://www.imrantariq.com/blog/?p=950)

# debugging - 标准调试方法

> ID：728456
> 
> 赞同：7
> 
> 时间：2009-04-08T03:47:15.043
> 
> 标签：debugging, standards

你调试问题的标准方法是什么？这似乎是一个相当广泛的问题，你们中的一些人回答“这取决于问题”，但我认为我们中的很多人都是凭直觉进行调试的，实际上并没有尝试过对我们的流程进行措辞。这就是我们说“视情况而定”的原因。

我最近有点被迫说出我的过程，因为我和一些开发人员正在解决同样的问题，我们正在以完全不同的方式对其进行调试。我希望他们了解我想要做什么，反之亦然。

经过一番思考，我意识到我的调试方式实际上很单调。我将首先尝试能够可靠地复制问题（尤其是在我的本地机器上）。然后通过一系列消除（我认为这与问题有关）尝试找出问题所在。

其他人试图以完全不同的方式做到这一点。

所以，只是想知道你们那里有什么工作吗？如果您必须用文字形式化它，您会说您的过程用于调试什么？

顺便说一句，我们还没有发现我们的问题 =)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T03:57:34.050

我的方法因我对手头系统的熟悉程度而异。通常我会做类似的事情：

1.  如果可能的话，复制失败。
2.  检查故障状态以确定故障的直接原因。
3.  如果我熟悉该系统，我可能会很好地猜测根本原因。如果不是，我开始通过软件机械地追溯数据，同时挑战软件所做的基本假设。
4.  如果问题似乎有一个一致的触发器，我可能会使用调试器手动向前遍历代码，同时挑战代码所做的隐含假设。

当然，追查根本原因是事情可能会变得棘手。这就是拥有转储（或者更好的是，一个活的、破碎的进程）真正无价的地方。

***我认为调试过程中的关键点是挑战先入为主的概念和假设。*** 我在该组件中发现我或同事*发誓*工作正常的错误的次数是巨大的。

更直观的朋友和同事告诉我，当他们看着我调试或要求我帮助他们解决问题时，我非常迂腐。:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T05:52:05.273

考虑获取David J Agans的《[调试》一书。](http://www.debuggingrules.com/)副标题是“寻找最难以捉摸的软件和硬件问题的 9 条不可或缺的规则”。他的调试规则列表——在网站上以海报形式提供（也有这本书的链接）是：

*   了解系统
*   让它失败
*   停止思考，看看
*   分而治之
*   一次改变一件事
*   保留审计线索
*   检查插头
*   获得全新的视角
*   如果你不修复它，它就没有修复

最后一点与软件行业特别相关。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T03:55:51.840

当我遇到一个我似乎无法弄清楚的错误时，我喜欢为这个问题建立一个模型。制作问题代码部分的副本，并开始从中删除功能，一次一个。每次删除后对代码运行单元测试。通过此过程，您将删除带有错误的功能（并因此定位错误），或者将错误隔离到包含问题本质的核心代码段。一旦你弄清楚问题的本质，解决起来就会容易得多。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-08T04:31:59.350

我选择了网上的那些或一些我不记得的书（*可能*是 CodingHorror ...）

调试 101：

*   复制
*   逐渐缩小范围
*   避免使用调试器
*   一次只改变一件事

心理方法：

*   橡皮鸭调试
*   不要推测
*   不要急于责备工具
*   了解问题和解决方案
*   休息一下
*   考虑多种原因

错误预防方法：

*   监控你自己的故障注入习惯
*   尽早引入调试辅助工具
*   松散耦合和信息隐藏
*   编写回归测试以防止 Re 发生

技术方法：

*   惰性跟踪语句
*   查阅第三方产品的日志文件
*   在网络上搜索堆栈跟踪
*   按合同引入设计
*   把石板擦干净
*   间歇性错误
*   探索局部性
*   介绍虚拟实现和子类
*   重新编译/重新链接
*   探测边界条件和特殊情况
*   检查版本依赖（第三方）
*   检查最近更改的代码
*   不要相信错误信息
*   图形错误

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-08T04:07:03.437

我通常会根据手头的信息形成一个假设。一旦完成，我会努力证明它是正确的。如果它被证明是错误的，我会从一个不同的假设开始。

使用这种方法可以很容易地解决大多数多线程同步问题。

此外，您还需要对您正在使用的调试器及其功能有一个很好的了解。我在 Windows 应用程序上工作，发现 windbg 对查找错误非常有帮助。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-08T04:07:05.213

将错误减少到最简单的形式通常会导致对问题的更好理解，并增加在必要时能够让其他人参与的好处。

设置一个快速复制场景，以便有效地利用您的时间来测试您选择的任何假设。

创建工具以快速转储环境以进行比较。

使用日志记录创建和重现错误已达到最高级别。

检查系统日志是否有任何警报。

查看文件日期和时间戳以了解问题是否可能是最近的介绍。

查看源存储库以了解相关模块中的最新活动。

应用演绎推理并应用[奥卡姆剃刀](http://physics.ucr.edu/~wudka/Physics7/Notes_www/node10.html)原则。

愿意退后一步，从问题中解脱出来。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T04:05:30.863

我也是使用消除过程的忠实粉丝。排除变量极大地简化了调试任务。这通常是应该做的第一件事。

另一个真正有效的技术是尽可能回滚到上一个工作版本并重试。这可能非常强大，因为它为您提供了坚实的基础，可以更加谨慎地进行。对此的一种变体是使代码达到可以工作的程度，但功能较少，而不是不具有更多功能。

当然，重要的是不要只是尝试。这会增加你的绝望，因为它永远不会奏效。我宁愿跑 50 次来收集关于这个 bug 的信息，而不是疯狂地摇摆并希望它有效。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-08T08:57:15.093

我发现“调试”的最佳时间是在编写代码时。换句话说，要防守。检查返回值，自由使用断言，使用某种可靠的日志记录机制并记录所有内容。

为了更直接地回答这个问题，我调试问题的最有效方法是阅读代码。拥有日志可以帮助您找到相关代码以快速阅读。没有记录？花时间把它放进去。看起来你似乎没有找到错误，你也可能没有。不过，日志记录可能会帮助您找到另一个错误，最终，一旦您完成了足够多的代码，您就会发现它......比设置调试器并尝试重现问题、单步执行等更快。

在调试时，我尝试考虑可能出现的问题。我提出了一个相当随意的分类系统，但它对我有用：所有错误都属于四个类别之一。请记住，我说的是运行时问题，而不是编译器或链接器错误。这四类是：

*   动态内存分配
*   堆栈溢出
*   未初始化的变量
*   逻辑错误

这些类别对我来说对 C 和 C++ 最有用，但我希望它们在其他地方也能很好地应用。逻辑错误类别很大（例如，当正确的事情是 a <= b 时放置 a < b），并且可能包括诸如未能在线程之间同步访问之类的事情。

知道我在寻找什么（这四件事之一）有助于找到它。发现错误似乎总是比修复它们要困难得多。

调试的实际机制通常是：

1.  我有演示问题的自动化测试吗？
    *   如果没有，添加一个失败的测试
2.  更改代码以使测试通过
3.  确保所有其他测试仍然通过
4.  签入更改

您的环境中没有自动化测试？没有时间像现在这样设置它。组织事物太难以至于您可以测试程序的各个部分？花点时间做到这一点。修复此特定错误可能会花费“太长时间”，但您越早开始，其他一切都会越快。同样，您可能无法修复您正在寻找的特定错误，但我敢打赌您会在此过程中找到并修复其他错误。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-08T04:37:09.337

我的调试方法不同，可能是因为我还是初学者。

当我遇到逻辑错误时，我似乎最终会添加更多变量以查看哪些值在哪里，然后我在导致问题的代码段中逐行调试。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-08T05:35:41.320

复制问题并生成可重复的测试数据集绝对是调试的第一步，也是最重要的一步。

如果我能识别出一个可重复的错误，我通常会尝试隔离所涉及的组件，直到找到问题所在。我经常会花一点时间排除案例，以便明确说明：问题不在于组件 X（或流程 Y 等）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-08T06:08:31.567

首先，我尝试复制错误，如果无法复制错误，那么在非平凡的程序中基本上不可能猜测问题。

然后，如果可能，将代码拆分到一个单独的独立项目中。这有几个原因：如果原始项目很大，第二次调试非常困难，它会消除或突出关于代码的任何假设。

我通常总是有另一个 VS open 副本，用于调试迷你项目中的部分并测试我稍后添加到主项目中的例程。

一旦在单独的模块中重现了错误，战斗几乎就赢了。

有时破解一段代码并不容易，所以在这些情况下，我会根据问题的复杂程度使用不同的方法。在大多数情况下，关于数据的假设似乎来咬我，所以我尝试在代码中添加大量断言，以确保我的假设是正确的。我还使用#ifdef 禁用代码，直到错误消失。消除对其他模块的依赖等......有点像秃鹰一样在错误中缓慢盘旋......

我想我并没有真正有意识的方式来做这件事，它变化很大，但一般原则是消除围绕问题的噪音，直到它非常明显。希望我听起来不会太混乱:)

# php - 用 PHP 下载文件的最佳方法

> ID：728458
> 
> 赞同：4
> 
> 时间：2009-04-08T03:47:23.747
> 
> 标签：php

哪个是从 PHP 中的另一个域下载文件的最佳方式？即一个 zip 文件。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T03:49:53.913

最简单的方法是，例如使用[cURL](http://php.net/curl)[`file_get_contents()`](http://php.net/file_get_contents)更高级的方法。您可以使用.[`file_put_contents()`](http://php.net/file_put_contents)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T13:33:20.547

通常，fopen 函数也适用于远程文件，因此您可以执行以下操作来规避内存限制（但它比 file_get_contents 慢）

```
<?php
$remote = fopen("http://www.example.com/file.zip", "rb");
$local = fopen("local_name_of_file.zip", 'w');
while (!feof($remote)) {
  $content = fread($remote, 8192);
  fwrite($local, $content);
}
fclose($local);
fclose($remote);
?> 
```

从这里复制：[http ://www.php.net/fread](http://www.php.net/fread)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-05-02T05:51:15.660

您可以使用一行代码来执行此操作：

```
copy(URL, destination); 
```

此函数在成功时返回 TRUE，在失败时返回 FALSE。

# javascript - 浮动栏javascript（原型或脚本）

> ID：728471
> 
> 赞同：1
> 
> 时间：2009-04-08T03:56:10.480
> 
> 标签：javascript, prototypejs, scriptaculous

我正在寻找一个随页面滚动的水平条，理想地在原型或脚本中实现。我希望它与向第一次使用 stackoverflow 的用户显示的栏完全一样，告诉他们常见问题解答。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T04:02:27.800

位置：固定

另请参阅：[模拟位置：在 IE6 中固定，div 为 100% 高度？](https://stackoverflow.com/questions/387485/simulating-position-fixed-in-ie6-with-a-div-of-100-height)

# .net - .NET 中的键盘映射

> ID：728477
> 
> 赞同：5
> 
> 时间：2009-04-08T04:00:19.347
> 
> 标签：.net, keyboard

如果我知道某个键已被按下（例如`Key.D3`），并且该`Shift`键也按下（`Keyboard.IsKeyDown(Key.LeftShift) || Keyboard.IsKeyDown(Key.RightShift)`），我如何找出指的是什么字符（例如，`#`在美国键盘上，在英国键盘上的英国英镑符号等） ?

换句话说，我如何以编程方式找出`Shift`+`3`产生`#`的（它不会在非美国键盘上）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-08T04:11:20.897

如果您想确定您将从给定键和给定修饰符中获得什么字符，您应该使用该[`user32 ToAscii`](http://msdn.microsoft.com/en-us/library/ms646316.aspx)函数。或者[`ToAsciiEx`](http://msdn.microsoft.com/en-us/library/ms646318.aspx)，如果您想使用当前键盘布局*以外*的键盘布局。

```
using System.Runtime.InteropServices;
public static class User32Interop
{
  public static char ToAscii(Keys key, Keys modifiers)
  {
    var outputBuilder = new StringBuilder(2);
    int result = ToAscii((uint)key, 0, GetKeyState(modifiers),
                         outputBuilder, 0);
    if (result == 1)
      return outputBuilder[0];
    else
      throw new Exception("Invalid key");
  }

  private const byte HighBit = 0x80;
  private static byte[] GetKeyState(Keys modifiers)
  {
    var keyState = new byte[256];
    foreach (Keys key in Enum.GetValues(typeof(Keys)))
    {
      if ((modifiers & key) == key)
      {
        keyState[(int)key] = HighBit;
      }
    }
    return keyState;
  }

  [DllImport("user32.dll")]
  private static extern int ToAscii(uint uVirtKey, uint uScanCode,
                                    byte[] lpKeyState,
                                    [Out] StringBuilder lpChar,
                                    uint uFlags);
} 
```

您现在可以像这样使用它：

```
char c = User32Interop.ToAscii(Keys.D3, Keys.ShiftKey); // = '#' 
```

如果您需要多个修饰符，只需`or`它们即可。`Keys.ShiftKey | Keys.AltKey`

# .net-1.0 - 在哪里可以找到 .NET v1.0.5000.0？

> ID：728497
> 
> 赞同：4
> 
> 时间：2009-04-08T04:11:23.377
> 
> 标签：.net-1.0

我刚刚在我的工作场所被告知，我们有一个用于生产的应用程序已停止工作。我正在尽我所能寻找应用程序的源代码在我们的源代码控制中的位置，但运气不佳。我真的希望这不是在本地机器上开发的应用程序，并且从未检查过源代码控制。

看来这个应用程序很老了，原来的开发者早就不在了。为了了解有关此应用程序的更多信息，我使用了 .NET Reflector 来查看内部...我发现它引用了 mscorlib、System、System.Data、System.Drawing 和 System.Windows .Forms 但它们都声明它们是 1.0.5000.0 版本。

这怎么可能？难道这是一个针对 .NET 1.0 框架开发的应用程序，并且从那时起就一直在生产环境中使用？如果 .NET 1.0 安装在它可能运行的机器上，或者 .NET 3.5 向后兼容，是否有可能。

如果我能找到应用程序的源代码，找到 .NET v1.0.5000.0 将是一件小事......但如果没有，我可能需要弄清楚如何让这个应用程序在我们当前的环境中运行......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T04:18:16.107

[这是 1.0a 的下载](http://www.microsoft.com/downloads/details.aspx?FamilyID=D7158DEE-A83F-4E21-B05A-009D06457787&displaylang=en)。生产服务器将安装 1.0，否则应用程序将无法运行。如果它是一个 ASP 应用程序，IIS 被配置为让它在它自己的 1.0 应用程序池中运行。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T04:25:23.080

听起来 .NET 1.0 确实在您的生产设备上……很确定您可以并行安装任意多个版本的 .NET。

Samuel 已经指出了 .NET 1.0 的下载位置，但如果您找不到源代码，另一件事可能会有所帮助，那就是 .NET Reflector 的[File Disassembler](http://www.denisbauer.com/NETTools/FileDisassembler.aspx)插件。然后你可以一键反汇编整个东西并得到应该工作的源代码（尽管有丑陋的私有变量名）。

祝你好运...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T04:18:47.353

你能从反射器中提取源代码，看看是否可以编译吗？免责声明：我希望这个建议和听起来一样古怪。

# shared-libraries - Common Lisp：在共享主机环境中使用库的最佳方式是什么？

> ID：728500
> 
> 赞同：4
> 
> 时间：2009-04-08T04:12:28.553
> 
> 标签：shared-libraries, common-lisp, shared-hosting

前几天我在考虑这个问题，想看看 SO 社区对这个主题有什么看法。

就目前而言，Common Lisp 作为一个 Web 开发平台受到了一些关注，并且有充分的理由（我相信你已经对此深信不疑）。

我想知道如何以与 PHP 类似的方式在共享环境中使用库。

如果我设置 SBCL 之类的东西作为解释器来解释 Python 或 PHP 等 FASL 文件，那么使用库（例如[clsql](http://clsql.b9.com/)）的最佳方式是什么。

大多数都是 asdf 可安装库，但是每次发出请求时都需要并安装库，这将是一笔愚蠢的开销。

请记住，这是针对共享主机的；最好..

1) 安装库的系统范围副本以在应用程序中使用；减少空间，但使用正确版本的库可能会出现问题。

2) 允许用户（通过控制面板）为自己安装本地副本；更多空间，没有版本问题。

3）告诉他们将它包装到一个模块中并像 Python 那样按需加载它（我不确定是否/如何使用 Lisp 来完成）。仅仅能够加载一个库以供使用将是最好的选择，但我认为它们中的很多都不是为了以这种方式使用而设计的。

无论如何，想听听你的意见，谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T09:38:32.703

我有两种看待它的方式：

1.  为每个请求启动一个 Lisp

    这样一来，Lisp 是一个保存了所有必要的库和数据的图像会更好。但这种方法对我来说看起来不是很有希望。

2.  运行 Lisp 并让前端（Web 浏览器、另一个 Web 服务器……）连接到它

    这样，您既可以启动保存的图像，也可以启动一次加载一堆东西并为请求提供服务的 Lisp。

我喜欢在部署场景中使用保存的图像/应用程序。它们可以快速启动，包含所有必要的软件并且独立于库更改。

因此，提供包含必要软件的预配置 Lisp 图像或让用户配置和保存图像可能很有用。

# java - 我可以添加到 JRuby/Rails 项目中的 Java 功能示例是什么？

> ID：728508
> 
> 赞同：2
> 
> 时间：2009-04-08T04:19:19.613
> 
> 标签：java, ruby-on-rails, ruby, jruby, crud

这实际上是两个问题合而为一。

1.  是否存在人们正在使用 JRuby 的特定类型的 Java 功能，还是主要是因为 JRuby 与 MRI 相比具有性能优势？

我问的原因是，我想在 Rails 项目中添加一些 Java 功能（只是为了表明它是可能的）。理想情况下，这个 Java 功能也很有用，而不是多余的。这引出了我的下一个问题。. .

2.  有什么例子可以很好地演示将 Java 功能添加到简单的 Rails CRUD 应用程序中？

我猜你可以在 Ruby 类中做任何事情，你也可以在 Java 类中轻松地做（大约两倍的代码），所以我理解这个问题可能很难回答。我只是想知道是否存在更适合在 Java 中执行的特定类型的功能。

顺便说一句，这里没有什么危险的。我只是在玩耍和测试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T05:30:47.947

我会找到一个专注的 Java 库，它可以满足 Java 的现有需求，并致力于在您的 rails 应用程序中利用该库。一种可能性是使用[JTS](http://tsusiatsoftware.net/jts/main.html)（Java 拓扑套件）来操作 rails 应用程序中的地理区域，并将它们转换为在您的 rails 应用程序内的地图上显示。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T00:48:37.350

我认为 Ruby 类库（gems）几乎可以做 Java 库可以做的任何事情，因此在“独立”场景中使用 JRuby on Rails 没有太多令人信服的理由。

我使用它与供应商 Java 应用程序集成。敲出一个快速控制器和一些视图比使用 Java/Swing 扩展要容易得多。

同样在“企业”环境中，Rails 开发人员可能不得不部署到 Tomcat 或 Glassfish。JRuby 的 Warbler gem 实现了这一点。

# c# - .NET 应用程序中不稳定的无效 Viewstate 问题

> ID：728513
> 
> 赞同：63
> 
> 时间：2009-04-08T04:23:21.960
> 
> 标签：c#, .net, asp.net, viewstate

[我似乎时不时地在我的ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)应用程序的事件查看器中得到一个“无效的视图状态” 。

其中大多数（95%）似乎是在引用`ScriptResource.axd`（应用程序使用[ASP.NET AJAX](http://en.wikipedia.org/wiki/ASP.NET_AJAX)库）。我也无法删除[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)库，因为 Ajax 无处不在。

如何减少这些错误？我每天会遇到约 100-200 个错误，我不知道如何解决它们！它们来自不同的浏览器、不同的 IP 和地理位置。

我很难重现这个问题，因为它几乎没有发生在我身上，它只是突然发生在我身上 3-4 次。

**错误：**

```
Process information: 
    Process ID: 4004 
    Process name: w3wp.exe 
    Account name: NT AUTHORITY\NETWORK SERVICE 

Exception information: 
    Exception type: HttpException 
    Exception message: Invalid viewstate. 

Request information: 
    Request URL: http://domainnamehere/ScriptResource.axd?d=W1R6x9VzZ2C9SKnIkOmX9VRLhSjJ3nOF1GSQvPwKS3html 
    Request path: /ScriptResource.axd 
    User host address: 124.177.170.75 
    User:  
    Is authenticated: False 
    Authentication Type:  
    Thread account name: NT AUTHORITY\NETWORK SERVICE 

Thread information: 
    Thread ID: 1 
    Thread account name: NT AUTHORITY\NETWORK SERVICE 
    Is impersonating: False 
    Stack trace:    at System.Web.UI.Page.DecryptStringWithIV(String s, IVType ivType)
   at System.Web.UI.Page.DecryptString(String s)
   at System.Web.Handlers.ScriptResourceHandler.DecryptParameter(NameValueCollection queryString)
   at System.Web.Handlers.ScriptResourceHandler.ProcessRequestInternal(HttpResponse response, NameValueCollection queryString, VirtualFileReader fileReader)
   at System.Web.Handlers.ScriptResourceHandler.ProcessRequest(HttpContext context)
   at System.Web.Handlers.ScriptResourceHandler.System.Web.IHttpHandler.ProcessRequest(HttpContext context)
   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()
   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously)

Custom event details: 

For more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp. 
```

我也时不时地在我的 .NET 代码中遇到这个错误，这可能是相关的：

```
Exception raised in GLOBAL.ASAX.Application_Error(): 'Padding is invalid and cannot be removed.' at System.Security.Cryptography.RijndaelManagedTransform.DecryptData(Byte[] inputBuffer, Int32 inputOffset, Int32 inputCount, Byte[]& outputBuffer, Int32 outputOffset, PaddingMode paddingMode, Boolean fLast)
   at System.Security.Cryptography.RijndaelManagedTransform.TransformFinalBlock(Byte[] inputBuffer, Int32 inputOffset, Int32 inputCount)
   at System.Security.Cryptography.CryptoStream.FlushFinalBlock()
   at System.Web.Configuration.MachineKeySection.EncryptOrDecryptData(Boolean fEncrypt, Byte[] buf, Byte[] modifier, Int32 start, Int32 length, IVType ivType, Boolean useValidationSymAlgo)
   at System.Web.UI.ObjectStateFormatter.Deserialize(String inputString) 
```

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-06-04T20:31:18.097

这似乎与许多人遇到的相同的 IE8 问题。似乎发生的事情是，IE8（在 IE8 呈现模式和 IE7 兼容模式下）会在 HTML 文档的中间丢失 4096 个字节，并且这个丢失的数据会导致这个异常（你通常在 ScriptResource 或 WebResource 调用中看到这个） .

这是有关该问题的 Microsoft 错误报告： [https ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=434997](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=434997)

还有很多关于这个问题的论坛、博客等帖子：

*   [生成的 Webresource.axd 参数无效](https://stackoverflow.com/questions/461605/invalid-webresource-axd-parameters-being-generated)
*   [IE 8 丢弃内存页？](https://stackoverflow.com/questions/835130/ie-8-dropping-memory-pages)
*   [http://forums.asp.net/t/1373410.aspx?PageIndex=1](http://forums.asp.net/t/1373410.aspx?PageIndex=1)
*   [http://forums.asp.net/p/1409964/3085329.aspx](http://forums.asp.net/p/1409964/3085329.aspx)

* * *

微软已对此问题作出回应：

注意是 Internet Explorer 8 中的一个错误。Internet Explorer 团队一直在调查此问题。

**影响**：到目前为止，我们认为该问题对最终用户使用 Web 应用程序的体验没有影响；唯一的负面影响是 JavaScript 推测下载引擎发送的虚假/格式错误的请求。当解析器实际需要该脚本时，将在那时正确下载和使用该脚本。

**情况**：虚假请求似乎仅在某些时间情况下发生，仅当包含带有 CHARSET 指令的 Content-Type 的 META HTTP-EQUIV 标记出现在文档中时，并且仅当 JavaScript SRC URL 跨越第 4096 个字节时HTTP 响应正文。

**解决方法：**因此，我们目前认为可以通过使用 HTTP Content-Type 标头声明页面的 CHARSET 而不是在页面中指定它来缓解此问题。

所以，而不是把

```
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"> 
```

相反，在您的 head 标记中，发送以下 HTTP 响应标头：

```
Content-Type: text/html; charset=utf-8 
```

请注意，HTTP 标头中的字符集规范会提高所有浏览器的性能，因为浏览器的解析器在遇到字符集声明时无需从头重新开始解析。此外，使用 HTTP 标头有助于缓解某些 XSS 攻击向量。

注意：有报道称，当 META HTTP-EQUIV 不在页面上时，仍然会发生此问题。当我们进行更多调查时，我们将更新此评论。

Microsoft 于 2009 年 6 月 30 日下午 12:25 发布。

编辑：我偶尔仍会看到此异常，但据报道此错误已修复：http: [//blogs.msdn.com/b/ieinternals/archive/2010/04/01/ie8-lookahead-downloader-fixed.aspx](http://blogs.msdn.com/b/ieinternals/archive/2010/04/01/ie8-lookahead-downloader-fixed.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T17:49:33.350

我猜你正在使用 ASP.NET AJAX。我有同样的问题。偶尔我会在我的事件日志中找到这个异常，并且请求的路径是 ALWAYS ScriptResource.axd。

在 machineKey 中使用固定的validationKey 和decryptionKey 并没有解决我的问题。

根据我收集到的信息，我倾向于认为这个错误与 ViewState 无关；我的理论是，出于某种原因，某些 UA 以某种方式弄乱了 ScriptResource.axd 的“d”参数。通过手动请求有问题的路径，可以轻松复制该问题。这给出了一个“无效的 ViewState”异常，即使 ViewState 在这里甚至不适用。

挖掘我的日志，我发现例如：

**此请求服务正常 (200)：/** ScriptResource.axd?d=oFCAB7_vUyp7Hhe9lxZBz37lpoAxhfbWwwdfFy3Zd3z41W_33Y_9Dq6i10g9Q1NRCY1n0_DNg1nE6-DDbsD6r4EiuwoeDzp9mjDDfBNLb1k1&t=41df03cc

**这个略有不同的请求也可以正常处理（200）：/** ScriptResource.axd?d=oFCAB7_vUyp7Hhe9lxZBz37lpoAxhfbWwwdfFy3Zd3z41W_33Y_9Dq6i10g9Q1NR5ijsxQts4AfbJdACRwmQ8sHt6UAzui3spEnooPneTz01&t=41df03cc

**此请求失败并返回 500 响应和 Invalid ViewState 异常：** /ScriptResource.axd?d=oFCAB7_vUyp7Hhe9lxZBz37lpoAxhfbWwwdfFy3Zd3z41W_3 **products$ctl00$AddToCart1$id**

如果仔细观察，三个请求的前几个字符都是相同的，但最后一个请求的后几个字符（粗体）显然是控件 ID“products$ctl00$AddToCart1$id”（我有一个控件名为 products和添加到购物车）。我不知道这个 ID 是如何到达那里的，但就我而言，这就是导致所有这些 Invalid ViewState 异常的原因。

我不确定这是否与 OP 相同，但我注意到 Martin 的请求 URL 以“html”结尾，这对于应该是键的参数来说有点巧合......

由于这个问题，我已经很头疼了。到目前为止，我遇到的最有见地的帖子是这个[http://bytes.com/topic/asp-net/answers/861764-invalid-viewstate-system-string-decryptstringwithiv](http://bytes.com/topic/asp-net/answers/861764-invalid-viewstate-system-string-decryptstringwithiv)

有什么见解吗？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-04T16:53:32.180

Viewstate 问题令人烦恼且令人沮丧 - 我注意到一些人在此线程中谈到了 Viewstate 问题。因此，这里有一些建议，您可以按顺序查看。

1.  我会回应 Freddy Rios 在帖子中已经说过的话。确保您已对机器密钥进行硬编码。这将解决绝大多数这些问题。ScriptResource 链接的重要之处在于它应该在查询字符串中有 ad 参数和 at 参数。如果没有其他问题！

2.  在您完成之前不要让用户回发。您可能可以使用 javascript 和一些 css 来做到这一点。从记忆中，我认为有一种方法可以使用元标记来做到这一点，但它可能只是 IE。

3.  我会看的是尽早刷新响应。我认为脚本管理器之后最好。但是您可能需要进行一些实验。

4.  如果您的视图状态看起来臃肿，请在 IIS 中打开 GZip 压缩。

5.  如果您的视图状态变得非常臃肿并且您无法打开 GZip 压缩/或者它有不良的副作用。然后您可以压缩和解压缩视图状态。 [http://www.codeproject.com/KB/viewstate/ViewStateCompression.aspx](http://www.codeproject.com/KB/viewstate/ViewStateCompression.aspx)

6.  如果这仍然给您留下臃肿的视图状态，您可以考虑在本地存储视图状态。 [http://blog.arctus.co.uk/articles/2007/04/23/advanced-asp-net-storing-viewstate-in-a-database/](http://blog.arctus.co.uk/articles/2007/04/23/advanced-asp-net-storing-viewstate-in-a-database/) 是一个很好的起点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-31T21:33:06.960

我认为，您必须在 aspx 页面中使用：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"> 
```

这解决了我的问题

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T04:37:48.667

使用固定的机器密钥（即使在做单服务器时）。

使用机器密钥的自动配置时会出现此问题，每次回收应用程序域时都会获得一个新的。这会影响视图状态验证、动态资源查询字符串解密和身份验证票证 [插入机器密钥的其他用途]。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T05:02:07.500

当 Viewstate 太大时，我已经看到过这样的问题。由于弗雷迪描述的问题，我已经看到它发生了。

我通常不喜欢使用 Viewstate 的想法。你能完全关闭 Viewstate 吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-28T03:22:04.457

我也遇到了这个问题，我已经尝试了我找到的所有博客中提到的所有内容（固定机器密钥、视图状态大小等）。99% 的错误记录在对 ScriptResource.axd 的请求上。我在 Win 2003 服务器上使用 .net 3.5 SP1。该应用程序托管在两台相同的并行服务器上，50/50 平衡。每个服务器都有相同的机器密钥。

通常这个错误对我来说并不重要，但是，在 3 个月的时间里，发生的趋势一直在上升。

是否有人认为此错误与未正确进行 UrlEncoded/HtmlEncoded 或 UrlDecoded 的 Viewstate 有关。视图状态中可能存在某些浏览器正在用某些编码值替换的字符子集。我不确定这是否有意义..

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-07T13:03:20.380

您正在运行非英语操作系统吗？

由于某些原因，“NT Authority\Network Service”的帐户名称已本地化为其他语言。
可悲的是，许多程序将帐户名硬编码为英文名称，并且在外国版本的 Windows 上运行时找不到网络服务，导致事件日志中出现各种时髦的错误。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-01T15:24:29.627

我刚刚将这个问题缩小到一个使用趋势科技防病毒软件的用户，并且在他于 2009 年 5 月 21 日更新他的趋势科技软件后，错误才开始发生。在此日期之前没有错误。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-11-04T11:15:57.800

问题似乎是 IE8 中的前瞻下载器。

它似乎只在相当模糊的情况下影响 IE8。它可能被忽视的原因之一是附加到 URL 的 4k 数据块通常被服务器丢弃。似乎使它更有可能发生的事情之一是网络连接速度慢。以下资源之一中的某个人指出，他只对新西兰的客户有问题。

很多人解释两个不同的问题，其中一个在上面的问题中描述（发送到服务器的格式错误的 URL）：

[http://connect.microsoft.com/VisualStudio/feedback/details/434997/invalid-webresource-axd-parameters-being-generated](http://connect.microsoft.com/VisualStudio/feedback/details/434997/invalid-webresource-axd-parameters-being-generated)

文章解释了前瞻下载器已修复：

[http://blogs.msdn.com/b/ieinternals/archive/2010/04/01/ie8-lookahead-downloader-fixed.aspx](http://blogs.msdn.com/b/ieinternals/archive/2010/04/01/ie8-lookahead-downloader-fixed.aspx)

**KB980182** – 修复了问题的累积更新：

[http://support.microsoft.com/kb/980182](http://support.microsoft.com/kb/980182)

**注意：**因为如果前瞻下载器无法检索脚本，则会自动重新下载脚本，因此应该可以更改回旧的验证模式，在该模式下，不检查 .axd 文件的有效性并删除问题：

```
<httpRuntime requestValidationMode="2.0" /> 
```

# httpwebrequest - 未在 HttpWebRequest 中发送的身份验证标头

> ID：728525
> 
> 赞同：1
> 
> 时间：2009-04-08T04:29:23.477
> 
> 标签：httpwebrequest

我正在使用 HttpWebRequest 连接到服务。在服务日志中，即使信息正确，也会记录身份验证错误。使用该服务设置服务器的供应商表示，.NET 在第一次尝试时不会发送身份验证标头。

```
_Req.Credentials = new NetworkCredential(username, password); 
```

发送请求时，服务器会以需要标头进行响应，然后请求会发送这些标头。这是正确的，有没有办法在初始请求时发送它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-09-01T11:45:52.030

请参阅指向[本文中答案的](http://blog.kowalczyk.info/article/Forcing-basic-http-authentication-for-HttpWebReq.html)[这个问题](https://stackoverflow.com/questions/1058252/net-cf-2-0-httpwebrequest-pre-authentication-and-sending-credentials-on-first-re)：手动添加标题（即使是第一次）。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-27T06:44:42.467

```
HttpWebRequest request;
request.PreAuthenticate = true; 
```

# java - Sandboxing Java / Groovy / Freemarker Code - Preventing execution of specific methods

> ID：728531
> 
> 赞同：6
> 
> 时间：2009-04-08T04:32:29.193
> 
> 标签：java, security, groovy, sandbox, freemarker

I'm developing a system that allows developers to upload custom groovy scripts and freemarker templates.

I can provide a certain level of security at a very high level with the default Java security infrastructure - i.e. prevent code from accessing the filesystem or network, however I have a need to restrict access to specific methods.

My plan was to modify the Groovy and Freemarker runtimes to read Annotations that would either whitelist or blacklist certain methods, however this would force me to maintain a forked version of their code, which is not desirable.

All I essentially need to be able to do is prevent the execution of specific methods when called from Groovy or Freemarker. I've considered a hack that would look at the call stack, but this would be a massive speed hit (and it quite messy).

Does anyone have any other ideas for implementing this?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T15:43:13.213

You can do it by subclassing the GroovyClassLoader and enforcing your constraints within an AST Visitor. THis post explains how to do it: [http://hamletdarcy.blogspot.com/2009/01/groovy-compile-time-meta-magic.html](http://hamletdarcy.blogspot.com/2009/01/groovy-compile-time-meta-magic.html)

Also, the code referenced there is in the samples folder of Groovy 1.6 installer.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-05-22T12:19:42.493

You should have a look at the project [groovy-sandbox](http://groovy-sandbox.kohsuke.org/) from kohsuke. Have also a look to his [blog post here](http://kohsuke.org/2012/04/27/groovy-secureastcustomizer-is-harmful/) on this topic and what is solution is addressing: sandboxing, but performance drawback.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T04:59:35.710

OSGi is great for this. You can partition your code into bundles and set exactly what each bundle exposes, and to what other bundles. Would that work for you?

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-31T14:50:15.547

You might also consider the java-sandbox ([http://blog.datenwerke.net/p/the-java-sandbox.html](http://blog.datenwerke.net/p/the-java-sandbox.html)) a recently developed library that allows to securely execute untrusted code from within java.

Also see: [http://blog.datenwerke.net/2013/06/sandboxing-groovy-with-java-sandbox.html](http://blog.datenwerke.net/2013/06/sandboxing-groovy-with-java-sandbox.html)

# .net - Spring.NET 和构造函数拦截器

> ID：728533
> 
> 赞同：3
> 
> 时间：2009-04-08T04:33:48.207
> 
> 标签：.net, constructor, aop, spring.net

我正在尝试在构造时对对象执行一些 AOP，并找到了 IConstructorInterceptor，它非常适合我想要的东西，但它[似乎不起作用](http://jira.springframework.org/browse/SPRNET-215)（至少在 1.2 版中）。

我还查看了 IObjectPostProcessor 和 IInstantiationAwareObjectPostProcessor，但我找不到任何方法可以在构造时间前后对对象进行处理... IInstantiationAwareObjectPostProcessor 上的 PostProcessPropertyValues 方法很接近，但它只通过 setter 注入的属性不是构造函数 arg 值...

具体来说，我想要的是在实例化之后对对象的引用，同时对注入构造函数的对象的引用。有什么办法可以做到这一点，或者我最好的选择是切换到设置器注入并使用后处理器或 MethodInterceptor？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-10-18T21:12:58.677

AOP 提出调用拦截，而不是依赖注入。使用 Spring.Net，您可以使用 seters 或构造函数来执行任何依赖注入。对于您的帖子和评论，它应该可以工作。

在 Spring.Net 初始化管道上，第一步分析依赖图，执行任何对象创建并设置所有依赖项。之后，如果您的类实现“Spring.Objects.Factory.IInitializingObject”，则方法“void AfterPropertiesSet();” 叫做。其他执行方式是使用您的对象配置，您可以在对象节点上设置 init-method。此行为基于 IoC/DI 概念。

也许您需要创建一个特定的工厂对象。为此，您的工厂必须实现 Spring.Objects.Factory.IFactoryObject 接口。这有助于容器为您委派对象创建（此配置上的属性和构造函数适用于您的工厂）。

此致

# java - Java 中 C 的“静态”关键字的等价物是什么？

> ID：728534
> 
> 赞同：8
> 
> 时间：2009-04-08T04:35:04.850
> 
> 标签：java, c, static

我想知道什么是java中的等效关键字，它可以执行与“C中的静态关键字”相同的功能。我想在java中进行递归，执行与C中的静态关键字相同的功能......

请帮忙..

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-08T04:57:58.257

C 有两种完全不同的`static`关键字用法，而 C++ 增加了第三种用法：

```
// Use 1: declare a variable or function to be local to a given module
// At global scope:
static int global_var;
static void func(); 
```

在这种情况下，全局变量`global_var`和函数`void func()`只能在声明它们的文件中访问；它们不能被任何其他文件访问。

```
// Use 2: declare a variable inside a function with global scope
void func(void)
{
    static int x;
} 
```

在这种情况下，该变量`x`实际上是一个全局变量，因为它只有一个实例——多次调用`func()`（包括递归调用）将始终访问同一个变量。

```
// Use 3 (C++ only): declare a global variable with class scope
class Widget
{
public:
    static int var;
}; 
```

在这种情况下，this 将变量声明`Widget::var`为全局变量，但其作用域不同。在类成员函数之外，它必须命名为`Widget::var`; 在类成员函数中，它可以命名为 just `var`。它也可以被制造`protected`或`private`进一步限制其范围。

现在，Java 中这 3 种用途的类似物是什么？

案例1没有直接模拟；最接近的是声明具有包范围的对象，这是通过省略 a `public`、`protected`或来完成的`private`：

```
class Widget  // Declare a class with package scope
{
    int x;  // Declare a member variable with package scope
    void func() {}  // Declare a member function with package scope
} 
```

在这种情况下，声明的对象只能被同一个包中的类访问；其他软件包无法访问它们。

案例 2 在 Java 中也没有类似物。最接近的方法是声明一个全局变量（即静态类变量，因为 Java 在最严格的意义上没有真正的全局变量）：

```
class Widget
{
    private static int func_x;
    public static void func()
    {
        // use func_x here in place of 'static int x' in the C example
    }
} 
```

案例 3 是唯一在 Java 中有*直接*类比的案例。在这种情况下，`static`关键字的作用完全相同。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-08T05:04:32.423

C 中的`"static"`关键字实际上有两个功能，具体取决于它的使用位置。这些功能是可见性和持续时间（这些是我基于大量教学的术语，标准，如果你对那个详细程度感兴趣，使用不同的术语，我经常发现这些术语会使新学生感到困惑，因此我在使用它们时保持沉默）。

*   在文件级别使用时，它将项目（变量或函数）标记为未导出，以便链接器无法看到它。这是静态的，因为可见性，持续时间与程序相同（即，直到程序退出）。这对于将项目封装在单个编译单元（源文件，最简单的定义）中很有用。该项目可用于整个编译单元（假设它在使用前声明）。
*   在函数内使用时，它控制持续时间（可见性仅限于函数内）。在这种情况下，该项目也被创建一次并持续到程序退出。函数内的非静态变量在函数进入和退出时创建和销毁。

我收集你所追求的是第一种类型，基本上是一个全局变量，因为我不能立即看到递归中其他变体的用途。

这是无法做到的，因为在 Java 中，*一切都*必须属于一个类。解决方法是创建一个包含“全局变量”的类，并且：

*   传递该对象，以便您可以引用其成员；或者
*   构造一个单例项目，以便您可以访问其成员。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-08T04:38:04.843

Java 没有全局变量，因此没有直接的等价物。但是，`static`Java 中有一个关键字与类的所有实例共享字段的状态，这很好地近似于您所描述的内容。

> 我想在java中进行递归，执行与C中的静态关键字相同的功能......

但是，如果您要进行递归，**您确定静态变量是您需要的吗？**递归函数调用所需的任何特殊状态几乎总是传递回自身，而不是单独维护。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T04:45:21.283

Java 中的 static 概念与C*中的**static*概念不同。但是，Java 中也有一个*static*关键字。但它更像是 C++ 中的*静态*，然后是 C，但有一些差异。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-04T12:27:24.820

您可以在java中模拟一个静态类，如下所示：

```
 /**
     * Utility class: this class contains only static methods and behaves as a static class.
     */

public abstract class Utilities
    {
        // prevent inheritance
        private Utilities()
        {
        }
    // ... all your static methods here
        public static Person convert(string) {...}
    } 
```

这个类不能被继承（像 final 一样，因为尽管它有一个私有构造函数是抽象的），不能被实例化（像 static 因为抽象），所以只能调用其中的静态方法。

# c - 将 C 数组作为 char* 函数参数传递

> ID：728535
> 
> 赞同：7
> 
> 时间：2009-04-08T04:35:40.200
> 
> 标签：c, arrays

我有一些我正在使用以下变量声明的代码：

```
char tmpry[40]; 
```

它与此功能一起使用：

```
char *SomeFunction(char *tmpryP) {
   // Do stuff.
} 
```

函数调用是：

```
SomeFunction(&tmpry[0]); 
```

我非常确定这与以下内容相同：

```
SomeFunction(tmpry); 
```

我什至检查过 SomeFunction 中的 char* 指针在两种情况下最终都指向与数组相同的内存位置。

我的问题是关于这两个函数调用是否相同的完整性检查（因此最初的程序员只是很讨厌）？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-08T04:37:36.560

两者是等价的，我认为 SomeFunction(tmpry); 更具可读性。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-08T04:47:47.613

它们完全相同。

```
someArray[i] 
```

确切的意思

```
*(someArray + i) 
```

其中第二种情况下的 someArray 是指向内存位置的指针。相似地，

```
&someArray[i] 
```

确切的意思

```
(someArray + i) 
```

在这两种情况下，术语都是指向内存位置的指针。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-08T05:00:21.933

它*可能*很重要，如果`SomeFunction`是一个宏并采用它`"sizeof"`的一个参数，因为`sizeof(tmpry)`可能不一定等于`sizeof(&tmpry[0])`。

否则，正如其他人指出的那样，它们完全相同。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-09T00:16:23.387

[关于数组和指针](http://c-faq.com/aryptr/index.html)的[C 编程常见问题解答](http://c-faq.com/)部分解决了这个问题（以及许多其他常见的 C 问题和困惑。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T05:09:33.847

正如其他人所说，这两个符号是等价的。

我通常会使用更简单的，除非有多个这样的调用：

```
SomeFunction(&tmparry[0]);
SomeFunction(&tmparry[10]);
SomeFunction(&tmparry[NNN]); 
```

理想情况下，所有常量（幻数）都是枚举（或`#define`）常量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T04:40:47.940

两者都是相同的，尽管第二个看起来不错并且阐明了将数组传递给函数的意图。但是 SomeFunction 怎么知道被传递的数组的大小，它总是假设为 40 吗？我觉得最好将大小也作为参数传递给 SomeFunction。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-08T04:41:21.527

这两个变体是等价的并且像这样传递

```
SomeFunction(tmpry); 
```

看起来更干净。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-08T14:55:02.160

宣言

诠释一个[10]；诠释*帕；

必须牢记数组和指针之间的一个区别。指针是一个变量，所以 pa=a 和 pa++ 是合法的。但是数组名不是变量；像 a=pa 和 a++ 这样的结构是非法的

作为函数定义中的格式参数，char s[] 和 char *s 是等价的；

来自：[C 编程语言](https://rads.stackoverflow.com/amzn/click/com/0131103628)第 2 期，第 99-100 页

# python - Python“循环赛”

> ID：728543
> 
> 赞同：4
> 
> 时间：2009-04-08T04:38:53.967
> 
> 标签：python, iteration, round-robin

给定多个 (x,y) 有序对，我想比较它们之间的距离。所以假设我有一个有序对的列表：

```
pairs = [a,b,c,d,e,f] 
```

我有一个函数需要两个有序对并找到它们之间的距离：

```
def distance(a,b):
    from math import sqrt as sqrt
    from math import pow as pow
    d1 = pow((a[0] - b[0]),2)
    d2 = pow((a[1] - b[1]),2)
    distance = sqrt(d1 + d2)
    return distance 
```

如何使用此函数将每个有序对与每个其他有序对进行比较，最终找到它们之间距离最大的两个有序对？

伪代码：

```
 distance(a,b)
     distance(a,c)
     ...
     distance(e,f) 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-08T04:51:52.877

在 python 2.6 中，您可以使用 itertools.permutations

```
import itertools
perms = itertools.permutations(pairs, 2)
distances = (distance(*p) for p in perms) 
```

或者

```
import itertools
combs = itertools.combinations(pairs, 2)
distances = (distance(*c) for c in combs) 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-08T04:47:59.810

```
try:

    from itertools import combinations

except ImportError:

    def combinations(l, n):
        if n != 2: raise Exception('This placeholder only good for n=2')
        for i in range(len(l)):
            for j in range(i+1, len(l)):
                yield l[i], l[j]

coords_list = [(0,0), (3,4), (6,8)]

def distance(p1, p2):
    return ( ( p2[0]-p1[0] ) ** 2 + ( p2[1]-p1[1] )**2 ) ** 0.5

largest_distance, (p1, p2) = max([
     (distance(p1,p2), (p1, p2)) for (p1,p2) in combinations(coords_list, 2)
     ])

print largest_distance, p1, p2 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-08T04:54:37.737

尝试：

```
max(distance(a, b) for (i, a) in enumerate(pairs) for b in pairs[i+1:]) 
```

这避免了身份比较（例如`distance(x, x)`，`distance(y, y)`等）。它还避免进行对称比较，因为`distance(x, y) == distance(y, x)`.

* * *

**更新：**我喜欢**[Evgeny 的解决方案](https://stackoverflow.com/questions/728543/python-round-robin/728567#728567)**使用`itertools`得更好，因为它更简洁地表达了你想要做的事情。我们的两种解决方案都做同样的事情。（注意：确保使用*组合*，而不是*排列*——这会慢得多！）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-08T17:26:06.963

稍微相关，您不必自己计算欧几里得距离，有 math.hypot：

```
In [1]: a = (1, 2)
In [2]: b = (4, 5)
In [3]: hypot(a[0]-b[0], a[1]-b[1])
Out[3]: 4.2426406871192848 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T04:48:20.933

如果您不介意在两次相同的两点之间进行距离计算，以下将找到最大距离：

```
max( [distance(a, b) for a in pairs for b in pairs] ) 
```

为了改为使用 a 和 b 对，请执行以下操作：

```
import operator
max( [((a,b), distance(a, b)) for a in pairs for b in pairs], key=operator.itemgetter(1)) 
```

您可以将其与 John Feminella 的解决方案相结合，以获得 (a,b) 元组，而无需进行过多的距离比较

# selenium - Firebug 和 Selenium：性能

> ID：728545
> 
> 赞同：3
> 
> 时间：2009-04-08T04:39:21.050
> 
> 标签：selenium, firebug

我是 Firebug 的忠实粉丝——我一直使用它来满足我的 Web 开发需求。也就是说，我注意到 Firebug 的一件事是它显着减慢了页面速度。特别是，如果在（本地）Selenium 脚本运行时打开 Firebug，则该脚本需要 2-3 倍的时间来执行，有时我什至会看到超时错误。他们的每站点激活模型在这里根本没有帮助 - 我正在开发和测试同一个站点。

我希望能够在我的 Selenium 脚本启动之前关闭 Firebug，并在 Selenium 完成后将其重新打开（或者，在最坏的情况下，将其关闭 - 最大的烦恼是启动 Selenium 只是为了找出一些测试无缘无故失败）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T04:42:12.790

我最喜欢的解决方案是创建一个新的、单独的 Firefox 配置文件（运行`firefox -ProfileManager`），然后使用该配置文件启动您的 Selenium 脚本。除了你放进去的东西之外，它会清除所有东西。这样，您的个人环境将尽可能少地污染您的开发环境，并且您将保持干净的分离。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T05:40:42.477

我通常不会在我开发的同一台机器上运行测试。如果您可以在部署和运行测试的地方设置单独的测试机器，则可以使 Firefox、IE 等免于插件/附加组件（例如可能会妨碍您的测试的 firebug）并完全避免此问题。

在单独的机器上运行测试也可以释放你的开发机器，这样你就可以在测试运行的同时继续工作。我不确定你的具体情况，但想想当你有成百上千的测试用例在运行时，你不想坐在那里等待它们完成。您希望能够在它运行时工作，查看它生成的报告，并在必要时进行调查。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T10:44:53.350

您可以尝试 Firebug 1.4 的 alpha 版本。激活/挂起模式在这个版本中改为更简单的模式：看到面板时激活，否则处于挂起模式，更多信息请参见[http://blog.getfirebug.com/?p=124](http://blog.getfirebug.com/?p=124)。

# c# - 这是捕获问题吗？我仍然无法解决

> ID：728553
> 
> 赞同：1
> 
> 时间：2009-04-08T04:44:00.740
> 
> 标签：c#, capture

我认为这是一个捕获问题，但我没有做任何工作。尝试在这里简化：

```
foreach (Question question in Test.Questions)
{
  int id= question.id;
  if(someIDictionary.TryGetValue(id, out value)
  { 
    question.answerobject.number=someinteger;
  }
  else
  {
    question.answerobject.number=someotherinteger;
  }
} 
```

我尝试为问题对象制作临时文件，但仍然无法正常工作。所有结果始终是最后一次迭代值。

**编辑：** **每个答案对象都是在每个问题对象中创建的，因为问题是使用 linq to sql 创建的。然后问题作为 IList 返回。**

**编辑 2：如果我将值分配给另一个问题字段，则不会发生此问题。问题仅在于 answerobject。所有问题（最后一个作业）的 answerobject 的值都是相同的。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T04:58:01.283

你看到的问题是什么？“捕获”问题只影响异步/延迟/线程代码 - 它不应该影响这种情况。

我想知道这里最可能的问题是否是您的所有`Question`对象都具有相同的`answerobject`实例 - 或者甚至您多次拥有相同的`Question`实例。

* * *

“捕获问题”的插图（见评论）：这是使用 lambda/anon 方法时看到的问题；如果在 lambda/anon 方法中使用了迭代变量（`question`上面），它会被“捕获”——但以一种有点违反直觉的方式......

例如; 我们可能期望这会打印（以不可预知的顺序）数字 0-9：

```
int[] vals = {0,1,2,3,4,5,6,7,8,9};
foreach(int i in vals) {
    ThreadPool.QueueUserItem(delegate {
        Console.WriteLine(i);
    });
}
Console.ReadLine(); 
```

但它没有......我们通过添加一个额外的变量来修复它：

```
int[] vals = {0,1,2,3,4,5,6,7,8,9};
foreach(int i in vals) {
    int tmp = i;
    ThreadPool.QueueUserItem(delegate {
        Console.WriteLine(tmp);
    });
}
Console.ReadLine(); 
```

这是因为捕获变量的行为是由它们的词法范围决定的……迭代变量的范围比我们想要的大一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T17:21:59.873

在创建对象时将 answerobject.number (int?) 分配为“Null”时，似乎会出现此问题。如果我尝试在循环期间分配一个值，我会遇到上述问题。但是，如果我在创建对象时分配了一个整数，问题就消失了，然后我可以在循环期间添加新值。你能解释一下，因为我不明白。

# character - SAXParser 中的字符转换

> ID：728554
> 
> 赞同：0
> 
> 时间：2009-04-08T04:45:03.297
> 
> 标签：character, saxparser

我有一个问题……一个非常奇特的问题，请你指导一下。

原始消息：Kevätsunnuntaisin lentää

数据流向是 HttpConnector -> WSDLConnector -> 到底层系统

以下是前7个字符的编码

4b 65 76 c3 a4 74 73 75 - 在 Http 连接器中 - 请求 XML 具有 UTF-8 编码

4b 65 76 a3 74 73 75 - 在 WSDL 连接器中 -

```
InputSource inputSource = new InputSource(myInputStream);
inputSource.setEncoding("UTF-8");

parser.parse(inputSource); 
```

原始字符串被转换为 Kev£tsunnuntaisin lent££。此外，还有一个字节的丢失。

你能指导我哪里出错了吗？我必须怎么做才能避免这种字符转换？

谢谢你的帮助！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T10:39:48.037

这很简单：myInputStream 中的数据没有编码为 UTF-8，因此解码失败。

我的猜测是您将 HTML 连接器的输出保存为字符串，然后将其用作 WSDL 连接器的输入。在字符串中，数据是 unicode，而不是 UTF-8。用于`String.getBytes('UTF-8')`获取具有正确编码的字节数组。

至于所有编码问题：总是告诉计算机它应该使用哪种编码，而不是希望它会正确猜测。字节没有编码，计算机也不是心灵感应的 :) 我希望它永远不会......

# ruby - 如何在 Ruby 中动态确定方法名

> ID：728563
> 
> 赞同：2
> 
> 时间：2009-04-08T04:49:12.273
> 
> 标签：ruby, metaprogramming

在 Ruby 中，有没有办法确定方法的名称，类似于“类”方法如何返回对象的类型？

例如：

```
def example_method
  puts method_name
end

#=> "example_method" 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T04:59:55.523

试试这个方法，从[**这里**](http://www.ruby-forum.com/topic/75258)：

```
module Kernel
 private
  def current_method_name
    caller[0] =~ /`([^']*)'/ and $1
  end
end

class Foo
 def test_method
   current_method_name   # "test_method"
 end
end 
```

这适用于旧版本的 Ruby (< 1.9)。对于较新的版本，请参阅Ben**[在此处突出显示的另一个 StackOverflow 答案。](https://stackoverflow.com/questions/199527/get-the-name-of-the-currently-executing-method-in-ruby)**

# java - JSF：用嵌套对象支持 Bean？

> ID：728582
> 
> 赞同：0
> 
> 时间：2009-04-08T05:01:44.507
> 
> 标签：java, jsf, class, nested, mbeans

**JSF 1.1**，使用带有嵌套对象的支持 bean，我可以读取嵌套对象的所有属性。

例如，假设一个名为“foo”的支持 bean 带有一个嵌套对象“bar”，我可以通过 h:form 设置/写入 foo.bar 的所有属性吗？

我的意思是这样的：

```
            f:视图
            h:表格
            h:inputText value="#{myBean.mySelectedReport.someProp}" /

```

这在支持bean中：

```
        公共 SomeObject getMySelectedReport() {...}

```

但是当我将它发送到正确的支持 bean 时，它不会存储 someProp 值的值

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T06:52:37.203

**很好，我可以自己回答，因为我自己解决了**：如果对其他有同样问题的人有用，那么问题是“from-view-id”上的 JSF 1.1 通配符，例如“/ajax/uiChannel*”只匹配没有的页面任何查询参数进入“来自 url”，只有这一个“/ajax/uiChannel.jsp?*”和“/ajax/uiChannel*?*”通配符似乎有效

# c# - 我可以通过类型变量而不是显式类型来转换类的实例吗？

> ID：728587
> 
> 赞同：3
> 
> 时间：2009-04-08T05:04:54.590
> 
> 标签：c#, casting

有没有办法使用 Type 变量而不是显式提供的类型来转换类的实例？

例如，在我下面的方法中，“this”是“Node”的派生类型。我希望该方法反复尝试从 GetNodeIntrinsicProperty() 获取一个值，之后如果它得到一个空值，它应该将自己转换为它的基本类型并重试。

基本上，我想调用 GetNodeIntrinsicProperty() 的每个实现，直到我得到一个值。

```
 public string GetIntrinsicProperty(String propertyKey)
    {
        //sets the original type value
        Type currType = this.GetType();

        Node thisNode = this;
        String propertyValue;

        while (currType is Node)
        {
            //casts thisNode as CurrType
            thisNode = thisNode as currType;

            /*The live above gives me the following error
             * 
             * Error    20  The type or namespace name 'currType' could not be found 
            (are you missing a using directive or an assembly reference?)   */

            //trys to get the property with the current cast
            //GetNodeIntrinsicProperty() is defined seperately in each type
            propertyValue = thisNode.GetNodeIntrinsicProperty(propertyKey);

            if (propertyValue != null)
            {
                return propertyValue;
            }

            //sets CurrType to its base type
            currType = currType.BaseType;
        }

        return null;
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T22:17:17.120

好吧，我退后一步，意识到我真正在做的是尝试创建一个方法，该方法将通过传递属性名称来返回公共属性的值。而不是手动创建我的类中的属性和巧合具有相同名称的字符串之间的关系，我认为最好自动执行此操作。

所以这就是我现在正在做的事情，它似乎有效。此外，我不必担心两个类试图定义重复的属性键，因为派生类已经不能在其基类中具有与一个重复的属性名称，除非存在明确的抽象/覆盖关系。

```
 public HashSet<string> GetIntrinsicPropertyKeys()
    {
        Type t = this.GetType();
        PropertyInfo[] properties = t.GetProperties();
        HashSet<string> keys = new HashSet<string>();

        foreach (PropertyInfo pNfo in properties)
        {
            keys.Add(pNfo.Name);
        }

        return keys;
    }

    public string GetIntrinsicProperty(string propertyKey)
    {
        HashSet<string> allowableKeys = this.GetIntrinsicPropertyKeys();
        String returnValue = null;

        if (allowableKeys.Contains(propertyKey))
        {
            Type t = this.GetType();
            PropertyInfo prop = t.GetProperty(propertyKey);

            returnValue = (string)prop.GetValue(this, null);
        }
        return returnValue;
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T05:23:43.080

我不完全理解您要做什么，但是您可以使用 Convert.ChangeType(yourObject, yourType) 将对象转换为特定类型。它返回一个 object 类型的对象，因此您仍然必须手动转换它。我不知道这是否有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T05:39:16.240

好的，所以首先回答你的问题。

我假设你有这样的结构：

```
 public class Node
    {
        public string GetIntrinsicProperty(String propertyKey)
        {
            //sets the original type value
            Type currType = this.GetType();

            Node thisNode = this;
            String propertyValue;

            while (currType.IsSubclassOf(typeof(Node)))
            {
                MethodInfo mi = currType.GetMethod("GetIntrinsicProperty",BindingFlags.Instance | BindingFlags.Public,null,new Type[] {typeof(string)},null);
                if (mi.DeclaringType != typeof(Node))
                {
                    propertyValue = (string)mi.Invoke(this, new object[] { propertyKey });

                    if (propertyValue != null)
                    {
                        return propertyValue;
                    }
                }
                //sets CurrType to its base type
                currType = currType.BaseType;
            }
            return null;
        }
    }

    public class OtherNode : Node
    {
        new public string GetIntrinsicProperty(string propertyKey)
        {
            return "OtherNode says Hi!";
        }
    }

    public class TestNode : Node
    {
    } 
```

上面 GetIntrinsicProperty 的实现将满足您的要求，但我认为这是错误的。

您正在迫使子类准确复制您的签名，并迫使开发人员了解您想要什么。这就是虚方法的用途。如果我对您的理解正确，那么做您想做的事情的正确方法是：

```
 public class Node
    {
        public virtual string GetIntrinsicProperty(String propertyKey)
        {
            switch(propertyKey)
            {
                case "NodeUnderstoodProp":
                    return "I know! Call on me!";
                default:
                    return null;
            }
        }
    }

    public class OtherNode : Node
    {
        public override string GetIntrinsicProperty(string propertyKey)
        {
            switch (propertyKey)
            {
                case "OtherUnderstoodProp":
                    return "I'm the OtherNode, and I know better, call on me!";
                default:
                    return base.GetIntrinsicProperty(propertyKey);
            }
        }
    }

    public class TestNode : Node
    {
    }

    static void Main(string[] args)
    {
        Node node = new OtherNode();
        var prop1 = node.GetIntrinsicProperty("NodeUnderstoodProp");
        var prop2 = node.GetIntrinsicProperty("OtherUnderstoodProp");
        var prop3 = node.GetIntrinsicProperty("PropTooHard!");

        node = new TestNode();
        prop1 = node.GetIntrinsicProperty("NodeUnderstoodProp");
        prop2 = node.GetIntrinsicProperty("OtherUnderstoodProp");
        prop3 = node.GetIntrinsicProperty("PropTooHard!");
    } 
```

虚拟方法的想法是，变量的类型并不决定调用哪个实现，而是对象的运行时类型决定了它。

据我所知，您所描述的情况是您尝试自己调度对象运行时类型的方法实现。几乎是虚拟方法的定义。

如果我没有得到正确的问题，请澄清。:)

# python - 如何使用 msilib 从 python 模块创建 .msi 文件的示例

> ID：728589
> 
> 赞同：3
> 
> 时间：2009-04-08T05:09:12.460
> 
> 标签：python, windows, windows-installer

谁能给我一个示例，说明如何使用 python 的[msilib](http://docs.python.org/library/msilib.html)标准库模块从自定义 python 模块创建 msi 文件？

例如，假设我有一个名为 cool.py 的自定义模块，代码如下

```
class Cool(object):
    def print_cool(self):
        print "cool" 
```

我想使用 msilib 创建一个 msi 文件，它将在 python 的 site-packages 目录中安装cool.py。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T06:12:10.310

您需要为您的模块编写一个 distutils 设置脚本，然后您可以执行

```
python setup.py bdist_msi 
```

并且将为您的模块创建一个 msi-installer。

另请参阅[http://docs.python.org/distutils/apiref.html#module-distutils.command.bdist_msi](http://docs.python.org/distutils/apiref.html#module-distutils.command.bdist_msi)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T05:42:45.357

我认为存在一个误解：将 MS CAB 文件视为`.zip`-Files 之类的档案。现在可以将任何内容放入这样的存档中，例如您的`cool.py`. 但我认为您提到了 python 源代码，因为您希望它执行，否则只需使用像 zip 这样的存档器，无需使用`mslib`.

如果我是对的，那么您首先需要使用[py2exe](http://www.py2exe.org/)或[pyinstaller 之](http://www.pyinstaller.org/)类的东西将您的脚本转换为可执行文件。

# database-design - 为像 Yelp 或 eBay（许多类别和子类别）这样的网站设计数据库和关系的最佳方法是什么？

> ID：728593
> 
> 赞同：3
> 
> 时间：2009-04-08T05:13:11.887
> 
> 标签：database-design, associations

他们是否有一个针对所有类别的表格和一个针对所有子类别的表格（以及另一个针对子子类别的表格，依此类推），还是什么？所有级别如何相互交流？

我是一个新手，开始从事一个可能具有这种复杂程度的项目，我很难理解这一点。

我正在使用 Rails，但我也很欣赏数据库模式的答案、进一步阅读的指针等。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T05:24:24.903

我假设您在这里处理分层数据。

你只需要两张桌子。其中一张表用于类别和类别之间的关系。例如：

```
CategoryID CategoryName ParentCategoryID
----------------------------------------
1          Computers    NULL
2          Programming  1
3          Games        1
4          Python       2 
```

另一个表用于存储与类别关联的数据。例如：

```
CategoryID ItemID Description
----------------------------------------------
4          1      Book – Programming in Python
3          1      World of Warcraft 
```

第一个表包含将子类别链接到其父类别的外键列。这被称为“邻接表模型”。该模型的优点是易于理解，并且可以通过客户端代码轻松完成各种操作（例如，检索 Python 类别的路径 - /Computers/Programming/Python）（如果您不这样做）注意性能成本，因为您可能需要对数据库进行多次查询）。但是，如果您尝试在完整的 SQL 中执行此操作，可能会令人难以置信。例如，检索类别的路径将需要自联接。

构建此表的另一种方法是将类别和子类别视为集合和子集（称为“嵌套集模型”）。没有图表很难解释这个模型，而[在 MySQL 中管理分层数据一](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)文 似乎在解释概念方面做得更好（“邻接表”和“嵌套集”模型）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T05:19:16.570

我的建议是为每个使用单独的表，但是，“一个子类别是否可以存在于多个类别中”的问题也会改变结果。

如果有一对一的类别表 A，那么子类别表 B 与父类别 ID（来自 A）。

但是，如果它们可以存在于多个类别中，那么您可能会有一个规范化的表结构，其中您有类别 A、子类别 B 以及 Cat_ID 和 Sub_ID 的第三个表作为单个记录。

此外，与产品相关，您还将有一个规范化的表设置，其中有 Products 表、Category 表，然后是 Product_Categories 以及 product_id 和 category_id。这是无限可扩展的（上帝保佑）子类别表、product_subcategories、sub sub、sub sub sub、blah blah blah 等等等等。

# jquery - jquery 谷歌类型建议限制列表

> ID：728596
> 
> 赞同：0
> 
> 时间：2009-04-08T05:16:49.757
> 
> 标签：jquery, jquery-plugins, autosuggest

我目前在页面上具有根据用户在文本框中键入的内容（jquery 建议）向用户提供建议的功能。我想添加的功能是将选择/输入到文本框中的内容限制为列表中的项目。基本上就像一个组合框，它将其选择限制为列表中的内容。

我的一个想法是验证文本框中的条目是否与列表中的项目匹配。我必须提醒用户输入的内容是不允许的（或者也许有办法让他们输入其他字符？），没关系，但不是真正干净的用户界面。

我认为 SO 上有人做过这样的事情；如果有人有实现此功能的想法，请告诉我。

* * *

我使用的基本jquery：

```
<script type="text/javascript">
    $(function() {
        $('#autocomplete').autocomplete("getPcodes.aspx", { mustMatch: true, autoFill:true, multipleSeparator: "; ", minChars:3 });
    });
</script> 
```

自动完成有很多不错的选择。我以前使用过建议 jquery，但我想我会选择这个。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T05:27:32.697

[jQuery Autocomplete 插件](http://bassistance.de/jquery-plugins/jquery-plugin-autocomplete/)允许您强制用户从返回的数据集中选择一个选项。

[在http://docs.jquery.com/Plugins/Autocomplete/autocomplete#url_or_dataoptions](http://docs.jquery.com/Plugins/Autocomplete/autocomplete#url_or_dataoptions)检查选项 mustMatch ：

> 如果设置为 true，自动完成器将只允许后端显示的结果。请注意，非法值会导致输入框为空。

# perl - 我的 Perl 脚本如何在同一目录中找到它的模块？

> ID：728597
> 
> 赞同：59
> 
> 时间：2009-04-08T05:17:06.807
> 
> 标签：perl, module, directory

我最近编写了一个新的 Perl 脚本来根据进程名称/用户名终止进程，并使用类对其进行扩展，以便我可以在其他程序中重用进程代码。我目前的布局是 -

```
/home/mutew/src/prod/pskill       <-- Perl script
/home/mutew/src/prod/Process.pm   <-- Package to handle process descriptions 
```

我在 $PATH 变量中添加了 ~/src/prod 以从任何地方访问脚本。从其驻留目录以外的任何目录运行脚本会导致“无法在 @INC 中找到 Process.pm”（这是可以理解的，因为除了 /usr 中的共享目录之外，@INC 仅包括当前目录 - '.'）。我一直在使用的一种解决方法是这样使用 lib 指令 -

```
use lib '/home/mutew/src/prod'; 
```

但这是一个主要的可移植性问题。任何解决方案也可以让我将脚本导出到其他系统而无需更改？

* * *

**编辑**

1.  我选择“depesz”作为正确答案是因为它的简单性和核心模块的使用。
2.  brian d foy 的回答虽然提出了其他方法来完成相同的任务（TMTOWTDI），但他在 perlfaq8 中的贡献使这个问题绝对是多余的。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2011-09-16T14:37:28.050

我很好奇为什么简单的解决方案

```
use File::Basename;
use lib dirname (__FILE__);
use SomeModuleLocatedInTheSameDirectoryAsThisPerlScriptOrModule; 
```

没有出现。如果文件不是主要的可执行 perl 脚本，而只是一个不可执行的 Perl 模块，则 FindBin 模块似乎存在一些问题。至少我是这样解释[文档](http://perldoc.perl.org/FindBin.html#KNOWN-ISSUES)中的评论的。并没有真正测试它。

要拥有与此 Perl 文件位置相关的任何其他路径，请执行以下操作

```
use File::Basename;
use lib dirname (__FILE__) . "/MyModules"; 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-04-08T06:32:21.057

我发现最简单的方法是使用 FindBin 模块。像这样：

```
use FindBin;
use lib $FindBin::Bin; 
```

一般来说，我更喜欢以这样的方式提供我的脚本，即程序在whatever/bin中，而库在whatever/lib中

在这些情况下，我使用稍微复杂一点的方法：

```
use Cwd qw(abs_path);
use FindBin;
use lib abs_path("$FindBin::Bin/../lib"); 
```

abs_path 调用是为了让@INC 包含whatever/lib，而不是whatever/bin/../lib——这只是一个微小的改变，但是使阅读错误消息更容易。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-04-08T14:58:11.950

来自[perlfaq8](http://faq.perl.org/perlfaq8.html)，它回答[“如何在运行时将目录添加到我的包含路径 (@INC)？”](http://faq.perl.org/perlfaq8.html#How_do_I_add_a_direc) . 围绕这个问题还有其他几个问题的答案。

* * *

如何在运行时将目录添加到我的包含路径 (@INC)？

以下是修改包含路径的建议方法，包括环境变量、运行时开关和代码内语句：

PERLLIB 环境变量

```
$ export PERLLIB=/path/to/my/dir
$ perl program.pl 
```

PERL5LIB 环境变量

```
$ export PERL5LIB=/path/to/my/dir
$ perl program.pl 
```

perl -Idir 命令行标志

```
$ perl -I/path/to/my/dir program.pl 
```

使用 lib 编译指示：

```
use lib "$ENV{HOME}/myown_perllib"; 
```

最后一个特别有用，因为它了解机器相关架构。lib.pm 实用模块首先包含在 Perl 的 5.002 版本中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-10-16T10:57:33.220

除了已经说明的解决方案：

1.  使用 FindBin / lib
2.  Perl 常见问题 8[如何在运行时将目录添加到我的包含路径 (@INC)？](https://learn.perl.org/faq/perlfaq8.html#How-do-I-add-a-directory-to-my-include-path-INC-at-runtime)

我在部署之前（在 /usr/local/lib/site_perl/ 或 @INC 的其他地方）开发/测试模块时使用的“最简单的方法”（™）是在加载模块之前修改 @INC，如下所示：

```
#!/usr/bin/perl
use strict;
use warnings;
# Modify @INC prior to module loading.
BEGIN { unshift @INC, '.'; }
use YourModuleInCWD; 
```

（[将当前工作目录添加到@INC？ - PerlMonks](https://www.perlmonks.org/bare/?node_id=375341)）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T05:29:54.327

看看[Par::Packer](http://search.cpan.org/dist/PAR-Packer/lib/PAR/Packer.pm)。它创建一个包含所有脚本依赖项的可执行文件。它使分发变得容易。您还可以为您的用户提供可以安装在他们系统上的模块版本。请参阅[Module::Starter](http://search.cpan.org/dist/Module-Starter/lib/Module/Starter.pm)以获取构建标准 CPAN 样式分发所需的所有文件的简单方法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-10-12T15:12:29.153

您可以使用该`-I`标志使 perl 在任何目录中查找。在这里，`-I`代表`@INC`perl 查找模块的路径数组。使用`-I`将给定路径添加`@INC`到此执行的数组中。

例如：

```
perl -I lib bin/script.pl 
```

其中 lib 包含我要使用的模块。

我知道这适用于**perl 5**。我不确定其他版本。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T02:11:18.230

要将相对链接转换为绝对链接并添加到@INC，我通常使用 ex::lib。当然，仅当您计划在计划运行脚本的所有机器上保持脚本和模块的相对位置相同时，这才有用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-02-01T14:00:12.537

保持简单。无需导入任何库；只需找出您当前的工作目录：

```
use lib "$ENV{PWD}/relativ_path_own_perllib"; 
```

对于类似的问题，您可以读取环境变量，它提供了有关您所在位置、主目录、操作系统内容等的信息，只需在 shell 终端中使用一行编程代码，例如：

```
perl -e 'map { print; print " : ". $ENV{$_}." \n\r"; } sort keys %ENV ' 
```

不需要绑定一些库；只需使用`%ENV-Hash`.

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2013-09-10T14:52:23.343

[FindBin::libs](http://search.cpan.org/perldoc?FindBin%3a%3alibs)会找到你所有的库放置在相对于你的脚本运行路径的合理位置。

# ruby-on-rails - 我的应用程序中未定义的方法。怎么了？

> ID：728598
> 
> 赞同：2
> 
> 时间：2009-04-08T05:17:25.967
> 
> 标签：ruby-on-rails, ruby

我尝试像这样在我的应用程序中阻止 IP 地址 - [lifeonrails.org](http://lifeonrails.org/2007/8/26/blocking-ip-addresses-in-rails)。我已经在/lib 中有一个模块和模型banned_ip。

为什么我在views/banned_ips/index.html下面有这个错误？

===我的错误：===

**Admin/banned_ips#index 中的 NoMethodError**

*显示第 9 行引发的 app/views/admin/banned_ips/index.html.erb：*

```
undefined method `banned?' for "127.0.0.1":String 
```

*提取的源代码（在第 9 行附近）：*

```
6:     <th>Last_ip</th>
7:     <th>Date</th>
8:   </tr>
9: <% if request.remote_ip.banned? == true %>banned<% else %>ok<% end %>
10: <% for banned_ip in @banned_ips %>
11:   <tr>
12:     <td><%=h banned_ip.first_ip %></td> 
```

* * *

===模块 infrid.rb 在 /lib===

```
module Infrid
  class IPAddress
    include Comparable
    def initialize(address)
      @address = address
    end
    def split
      @address.split(‘.‘).map {|s| s.to_i }
    end
    def <=>(other)
      split <=> other.split
    end
    def to_s
      @address
    end
  end
end 
```

* * *

===模型banned_ip:===

```
class BannedIp < ActiveRecord::Base
    @banned_ips # hash of ips and masks
    validates_presence_of :first_ip, :message =>"first address is needed"
    validates_presence_of :last_ip, :message =>"last address is needed"
    validates_format_of :first_ip, :with => REG_IP, :message => "is invalid (must be x.x.x.x where x is 0-255)", :if => Proc.new {|ar| !ar.first_ip.blank? }
    validates_format_of :last_ip, :with => REG_IP, :message => "is invalid (must be x.x.x.x where x is 0-255)", :if => Proc.new {|ar| !ar.last_ip.blank? }

    def self.banned?(ip)
      reload_banned_ips if @banned_ips.nil?
      begin
          ip = Infrid::IPAddress.new(ip)
          @banned_ips.each { |b|
            return true if ip.between?(b[0], b[1])
          }
      rescue
          logger.info "IP FORMAT ERROR"
          return true
      end
      false
    end
    def self.banned_ips
        reload_banned_ips if @banned_ips.nil?
        @banned_ips.collect {|b| b[0].to_s + ".." + b[1].to_s }.join"\n"
    end
    #keeps a cache of all banned ip ranges
    def self.reload_banned_ips
      r = connection.select_all("select first_ip, last_ip from banned_ips")
      if !r
        @banned_ips=[] 
      end
      @banned_ips = r.map {|item| [Infrid::IPAddress.new(item["first_ip"]),Infrid::IPAddress.new(item["last_ip"])] }
    end
end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T05:38:13.013

这`request.remote_ip`会将 IP 地址作为字符串返回，而字符串没有`banned?`方法。看起来像你想要`BannedIP.banned?(request.remote_ip)`的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T05:40:25.490

您的问题是您正在尝试调用`banned?`a `String`，而不是您的`BannedIp`班级。你有两个解决方案。

1.  将检查禁止 IP 的代码替换为`BannedIp.banned?(request.remote_ip)`
2.  将方法修补到为您调用类方法的字符串类中，该方法是 rails stype 但可读性较差。

这里需要这个。（错误阻止代码块工作）

```
class String
  def banned?
    BannedIp.banned?(self)
  end
end 
```

# c# - Windows Mobile 开发：.Net compact 与 Native (c++) 代码的选择

> ID：728602
> 
> 赞同：0
> 
> 时间：2009-04-08T05:20:22.137
> 
> 标签：c#, .net, c++, windows, mobile

我在一个经验丰富且多元化的开发团队工作，我们正准备着手进行我们的第一个移动开发，该开发将针对 Windows Mobile 6（平台更改不是一种选择）。

我们在用于 Windows 桌面和服务器开发的 Visual C++ 和 .Net 技术方面拥有技能和经验。

移动开发将包括一些图像处理，以及对蓝牙设备的读/写访问。不幸的是，我真的不能提供比这更多的细节。

我们正在尝试在使用托管代码或本机代码编写移动客户端之间做出选择。我们将分别使用 C# 或 C++。

我的问题是：

*   这些语言之间的预期性能差异有多大？我听说原生代码在移动设备上要快得多，但我很想听听有经验的人的意见。

*   在使用 Windows Mobile 服务访问蓝牙设备方面，这两种语言是否有任何主要优势？

*   托管代码或本机代码之间对电池寿命有影响吗？

*   是否还有其他重要的知识需要我们考虑？

感谢您的反馈。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T06:12:49.217

另一个考虑因素是内存使用和模块大小的问题。我们在移动开发中遇到了重大问题，只是试图让操作系统将我们所有的 DLL 加载到内存中。与常规的 Windows 开发不同，所有模块都必须加载到 32Mb 的非常严格的限制。我们不得不执行很多非常肮脏的技巧来成功加载我们所有的东西。我们发现，即使用户打开手机或使用蓝牙设备，这些设备的驱动程序也会导致我们的应用程序失败，因为它们会占用我们模块的空间。

考虑到所有这些，我们无法在我们的应用程序中添加对 .Net 的支持，因为这会在我们的应用程序中引入额外的模块重量。如果您的应用程序有很多依赖项，您可能需要考虑这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T05:54:03.757

几天前有人提出并回答了一个非常相似的[问题。](https://stackoverflow.com/questions/708484/c-or-c-to-program-mobile-barcode-device)您可以在那里找到有用的信息。

对您的问题的简短回答：

*   本机代码更快，但对于许多应用程序来说，速度差异不会很明显。不要仅仅为了速度而使用本机代码，除非这是您的应用程序的关键因素。托管应用程序也可以快速运行 - 启动它们可能需要更长的时间。
*   .NET 应用程序有一个很好的蓝牙[库](http://inthehand.com/content/32feet.aspx)。我不知道用于 C++ 应用程序的类似库。
*   实现良好的电池寿命取决于您的设计。平台的选择并不重要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T06:04:58.753

除了在 kgiannakakis 提到的另一个问题中的伟大而冗长的答案之外，我还必须添加一些想法和观点。

在我的工作场所，我们一直在使用 C++ 和 ATL/WTL 为 Windows CE 5.0 编写应用程序。与 MFC 和 .Net 相比，这最终很容易使用并且非常轻巧。

要考虑的另一点（正如这里的高级开发人员所解释的那样）是 .Net 紧凑框架需要在每次应用程序切换到时将字节码重新编译为机器码。这可能需要很长时间和处理器能力，所以要小心。

# java - Java注释不起作用

> ID：728605
> 
> 赞同：22
> 
> 时间：2009-04-08T05:24:18.507
> 
> 标签：java, annotations

我正在尝试使用 Java 注释，但似乎无法让我的代码识别出存在。我究竟做错了什么？

```
 import java.lang.reflect.*;
  import java.lang.annotation.*;

  @interface MyAnnotation{}

  public class FooTest
  { 
    @MyAnnotation
    public void doFoo()
    {       
    }

    public static void main(String[] args) throws Exception
    {               
        Method method = FooTest.class.getMethod( "doFoo" );

        Annotation[] annotations = method.getAnnotations();
        for( Annotation annotation : method.getAnnotations() )
            System.out.println( "Annotation: " + annotation  );

    }
  } 
```

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-04-08T05:26:34.383

您需要使用注解接口上的@Retention 注解将注解指定为运行时注解。

IE

```
@Retention(RetentionPolicy.RUNTIME)
@interface MyAnnotation{} 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-08T05:30:10.460

简短的回答：您需要将 @Retention(RetentionPolicy.RUNTIME) 添加到您的注释定义中。

解释：

默认情况下，编译器**不**保留注释。它们在运行时根本不存在。起初这听起来很傻，但是有很多注释只供编译器（@Override）或各种源代码分析器（@Documentation 等）使用。

如果您想像示例中那样通过反射实际使用注释，则需要让 Java 知道您希望它在类文件本身中记下该注释。该注释如下所示：

```
@Retention(RetentionPolicy.RUNTIME)
public @interface MyAnnotation{} 
```

有关更多信息，请查看官方文档[1](http://java.sun.com/j2se/1.5.0/docs/guide/language/annotations.html)，并特别注意有关 RetentionPolicy 的部分。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-03-12T21:02:38.450

使用`@Retention(RetentionPolicy.RUNTIME)` 检查下面的代码。它对我有用：

```
import java.lang.reflect.*;
import java.lang.annotation.*;

@Retention(RetentionPolicy.RUNTIME)
@interface MyAnnotation1{}

@Retention(RetentionPolicy.RUNTIME)
@interface MyAnnotation2{}

public class FooTest {
    @MyAnnotation1
    public void doFoo() {
    }

    @MyAnnotation2
    public void doFooo() {
    }

    public static void main(String[] args) throws Exception {
        Method method = FooTest.class.getMethod( "doFoo" );
        for( Annotation annotation : method.getAnnotations() )
            System.out.println( "Annotation: " + annotation  );

        method = FooTest.class.getMethod( "doFooo" );
        for( Annotation annotation : method.getAnnotations() )
            System.out.println( "Annotation: " + annotation  );
    }
} 
```

# html - 禁用某些图像的缓存

> ID：728616
> 
> 赞同：123
> 
> 时间：2009-04-08T05:30:20.240
> 
> 标签：html, image, caching

我使用 PHP 库生成了一些图像。

有时浏览器不会加载新生成的文件。

如何仅为我动态创建的图像禁用缓存？

注意：随着时间的推移，我必须为创建的图像使用相同的名称。

* * *

## 回答 #1

> 赞同：258
> 
> 时间：2009-04-08T11:45:33.113

这个问题的一个常见且简单的解决方案，感觉像是一个 hack，但相当可移植，是在每个动态图像请求中添加一个随机生成的查询字符串。

所以，例如 -

```
<img src="image.png" /> 
```

会成为

```
<img src="image.png?dummy=8484744" /> 
```

或者

```
<img src="image.png?dummy=371662" /> 
```

从 web 服务器的角度来看，访问的是相同的文件，但从浏览器的角度来看，不能执行缓存。

随机数生成可以在服务页面时发生在服务器上（只要确保页面本身没有被缓存......），也可以在客户端（使用 JavaScript）上发生。

您将需要验证您的网络服务器是否可以处理这个技巧。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-04-08T05:54:39.557

浏览器缓存策略可以由 HTTP 标头控制。请记住，它们只是一个提示，真的。由于浏览器在此（以及任何其他）字段中非常不一致，因此您需要多个标题才能在一系列浏览器上获得所需的效果。

```
header ("Pragma-directive: no-cache");
header ("Cache-directive: no-cache");
header ("Cache-control: no-cache");
header ("Pragma: no-cache");
header ("Expires: 0"); 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-05-24T21:03:01.470

如果您需要使用 javascript 在浏览器中动态执行此操作，这里有一个示例...

```
<img id=graph alt="" 
  src="http://www.kitco.com/images/live/gold.gif" 
  />

<script language="javascript" type="text/javascript">
    var d = new Date(); 
    document.getElementById("graph").src = 
      "http://www.kitco.com/images/live/gold.gif?ver=" + 
       d.getTime();
</script> 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2016-06-01T11:42:24.057

**解决方案 1 不是很好。**它确实有效，但是在图像文件的末尾添加 hacky 随机或时间戳查询字符串将使浏览器重新下载并缓存每个图像的每个版本，每次加载页面时，无论图像是否发生变化在服务器上。

**解决方案 2 没用。**将`nocache`标题添加到图像文件不仅很难实现，而且完全不切实际，因为它需要您提前*预测何时需要它*，即第一次加载您认为将来***可能会***更改的任何图像时.

## 输入 Etag...

我发现解决此问题的**绝对最佳方法是在图像目录中****的 .htaccess**文件中使用**[ETAGS 。](https://httpd.apache.org/docs/2.4/mod/core.html#fileetag)**下面告诉 Apache 在图像文件头中向浏览器发送一个唯一的散列。此哈希仅在图像文件被修改时才会更改，并且此更改会触发浏览器在下次请求时重新加载图像。

```
<FilesMatch "\.(jpg|jpeg)$">
FileETag MTime Size
</FilesMatch> 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2015-11-19T02:21:55.387

我检查了所有答案，最好的答案似乎是（不是）：

```
<img src="image.png?cache=none"> 
```

首先。

但是，如果您添加**cache=none**参数（这是静态“无”字），它不会影响任何东西，浏览器仍然从缓存加载。

这个问题的解决方案是：

```
<img src="image.png?nocache=<?php echo time(); ?>"> 
```

您基本上添加了unix时间戳以使参数动态且没有缓存，它起作用了。

但是，我的问题有点不同：我正在加载动态生成的 php 图表图像，并使用 $_GET 参数控制页面。我希望在 URL GET 参数保持不变时从缓存中读取图像，并且在 GET 参数更改时不缓存。

为了解决这个问题，我需要散列 $_GET 但因为它是数组，所以这里是解决方案：

```
$chart_hash = md5(implode('-', $_GET));
echo "<img src='/images/mychart.png?hash=$chart_hash'>"; 
```

**编辑**：

尽管上述解决方案工作得很好，但有时您希望在文件更改之前提供缓存版本。（使用上述解决方案，它会完全禁用该图像的缓存）因此，要从浏览器提供缓存图像，直到图像文件使用发生变化：

```
echo "<img src='/images/mychart.png?hash=" . filemtime('mychart.png') . "'>"; 
```

> filemtime() 获取文件修改时间。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-12-25T14:48:27.980

我知道这个话题很老，但它在谷歌中排名很好。我发现把它放在你的标题中效果很好；

```
<meta Http-Equiv="Cache-Control" Content="no-cache">
<meta Http-Equiv="Pragma" Content="no-cache">
<meta Http-Equiv="Expires" Content="0">
<meta Http-Equiv="Pragma-directive: no-cache">
<meta Http-Equiv="Cache-directive: no-cache"> 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-07-13T08:10:13.780

我只是在寻找解决方案，而上面的答案在我的情况下不起作用（而且我没有足够的声誉来评论它们）。事实证明，至少对于我的用例和我使用的浏览器（OSX 上的 Chrome），唯一似乎阻止缓存的是：

```
Cache-Control = 'no-store' 
```

为了完整起见，我现在使用所有 3 个“无缓存、无存储、必须重新验证”

因此，在我的情况下（在 Python 中使用 Flask 动态生成图像），我必须执行以下操作以希望在尽可能多的浏览器中工作......

```
def make_uncached_response(inFile):
    response = make_response(inFile)
    response.headers['Pragma-Directive'] = 'no-cache'
    response.headers['Cache-Directive'] = 'no-cache'
    response.headers['Cache-Control'] = 'no-cache, no-store, must-revalidate'
    response.headers['Pragma'] = 'no-cache'
    response.headers['Expires'] = '0'
    return response 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-09-05T11:24:22.280

更改图像源是解决方案。您确实可以通过向图像添加时间戳或随机数来做到这一点。

更好的是添加一个校验和，例如图像所代表的数据。这会在可能的情况下启用缓存。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-01-20T18:04:45.927

让我们添加另一个解决方案。

在末尾添加一个唯一的字符串是一个完美的解决方案。

```
example.jpg?646413154 
```

以下解决方案扩展了此方法并提供缓存功能并在更新图像时获取新版本。

更新图像时，[文件时间](http://php.net/manual/en/function.filemtime.php)将更改。

```
<?php
$filename = "path/to/images/example.jpg";
$filemtime = filemtime($filename);
?> 
```

**现在输出图像：**

```
<img src="images/example.jpg?<?php echo $filemtime; ?>" > 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-11-04T00:45:29.053

我有这个问题并像这样克服。

```
var newtags='<div class="addedimage"><h5>preview image</h5><img src="'+one+'?nocache='+Math.floor(Math.random() * 1000)+'"></div>'; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-07-24T10:29:15.000

我用它来解决我的类似问题......显示图像计数器（来自外部提供商）。它并不总是正确刷新。添加随机参数后，一切正常:)

我附加了一个日期字符串以确保至少每分钟刷新一次。

**示例代码（PHP）：**

```
$output .= "<img src=\"http://xy.somecounter.com/?id=1234567890&".date(ymdHi)."\" alt=\"somecounter.com\" style=\"border:none;\">"; 
```

这会产生`src`如下链接：

```
http://xy.somecounter.com/?id=1234567890&1207241014 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-02-26T16:22:19.897

如果您有一个硬编码的图像 URL，例如：[http](http://example.com/image.jpg) ://example.com/image.jpg ，您可以使用 php 将标题添加到您的图像。

首先，您必须让 apache 将您的 jpg 处理为 php。请参见此处： [是否可以使用扩展名 file.php.jpg 执行 PHP？](https://stackoverflow.com/questions/8025236/is-it-possible-to-execute-php-with-extension-file-php-jpg)

从文件加载图像（imagecreatefromjpeg），然后添加先前答案的标题。使用 php 函数 header 添加标题。

然后用 imagejpeg 函数输出图像。

请注意，让 php 处理 jpg 图像是非常不安全的。另请注意，我尚未测试此解决方案，因此由您决定是否使其工作。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2014-12-18T08:34:12.257

很简单，发送一个标头位置。

我的网站，包含一张图片，上传图片后，没有变化，然后我添加了这段代码：

```
<?php header("Location: pagelocalimage.php"); ?> 
```

工作适合我。

# reference - 可变值对象/共享状态（和啤酒酿造！）

> ID：728620
> 
> 赞同：1
> 
> 时间：2009-04-08T05:30:56.337
> 
> 标签：reference, mutable, value-objects

我是一个生疏的程序员，试图再次在该领域学习。我断断续续地发现，我的自学和正规教育都导致了一些坏习惯。因此，我试图让我的思想围绕良好的设计模式，以及——通过扩展——当它们是错误的。语言是 Java，这是我的问题：

我正在尝试编写软件来协助啤酒酿造。在酿造过程中，有时您必须用特定种类的啤酒花代替配方中要求的啤酒花。例如，您可能有一个需要“阿马里洛”啤酒花的配方，但您只能得到“Cascade”，它具有足够相似的香气，可以替代；啤酒花具有一定量的 Alpha 酸（每给定质量），两种啤酒花之间的比率是替代公式的一部分。我正在尝试在我的程序中（正确地）对此进行建模。

我最初的目标是拥有两个对象。一个 a `HopVariety`，它具有关于各种啤酒花的一般描述信息，一个 a `HopIngredient`，它是 a 的特定实例，`HopVariety`还包括给定配方中使用的量。`HopIngredient`应该知道它的多样性，并且`HopVariety`应该知道什么可以用作它的替代品（并非所有替代品都是对称的）。这似乎是好的 OOP。

问题是这样的：我正在尝试遵循良好的做法并使我的价值对象不可变。（在我的脑海中，我将其归类`HopVariety`为`HopIngredient`价值对象，而不是“演员”。）但是，我需要用户能够使用新的可行替换来更新给定的 HopVariety。如果我遵循不变性，这些更改将不会传播到单个成分。*如果选择可变性*，我会通过共享可变值对象潜在地引入副作用而表现不佳。

因此，选项 B：引入各种类型的 VarietyCollection，并通过名称或唯一标识符松散地耦合成分和品种。然后是 VarietySubstitutionManager，这样品种就不会引用其他品种，而只会引用它们的 id。这与我*想要*做的背道而驰，因为持有对品种对象的引用具有直观意义，现在我要介绍感觉像是过度抽象的东西，并将函数与数据分开。

那么，我如何在特定实例之间正确共享状态？解决问题的正确或至少最明智的方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T05:48:10.477

你确定`HopVariety`应该是一个值对象吗？在我看来，这听起来像是一个实体——“阿马里洛”啤酒花品种是唯一的，所以它应该是一个唯一可识别的对象。就像“托尼伍斯特”只是一个（不完全是，但你明白了；））

我推荐阅读[领域驱动设计](http://en.wikipedia.org/wiki/Domain-driven_design)以及实体和值对象之间的差异。

顺便说一句：[DDD 书中](http://domaindrivendesign.org/books/#DDD)有很多像你这样的情况以及如何处理它们的例子。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T05:38:45.447

我认为您的选择是

*   让“更新品种”功能遍历现有的对象图并创建一个更新了所有成分的新对象图，或者
*   继续使用可变性

根据手头的信息，我不清楚哪个更适合您的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T22:12:32.170

您希望避免具有多个引用的对象突变有多严重？

如果您希望配方集合反映用户对品种集的更新，并且您希望避免对象中的可变字段，那么您将强迫自己使用功能对象更新来处理用户输入。

*这*条路的尽头是 I/O monad。你想朝那个方向走多远？

使用允许变异副作用的函数式语言，例如 S/ML 等，您可能会选择保持品种和成分对象的纯净，并存储从存储在单个可变对象中的最新品种集合返回当前品种对象的函数参考细胞。这似乎是一种合理的分割差异的方法。

# perl - 在 Perl 的 GD::Graph 中向图形添加文本？

> ID：728625
> 
> 赞同：1
> 
> 时间：2009-04-08T05:32:49.267
> 
> 标签：perl, graph, charts

我正在使用Perl 中的[GD::Graph模块绘制图形。](http://search.cpan.org/dist/GD-Graph)

我可以很好地绘制图形，但在绘制的图像中，我想在绘制的图形图像顶部添加一些文本。基本上只是想在这个绘制的图像中添加一些文本。但是，我没有看到这样做的选项。

有人知道这是否可行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T15:18:28.250

一旦你有了 GD 对象，你就可以做任何 GD 允许你做的事情，包括添加额外的文本：

```
$gd = $graph->plot( \@data );

$gd->string($font,$x,$y,$string,$color); 
```

如果您只想添加标题或坐标轴标签，GD::Graph 已经内置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T05:37:15.090

以下[文章](http://linuxgazette.net/issue83/padala.html)概述了使用 GD::Graph 包含文本的方法。我想如果你想在图表本身上写，你可能在这篇文章中找不到任何有用的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T05:38:03.700

你试过标题吗？

从使用部分：

```
$graph->set( 
    x_label           => 'X Label',
    y_label           => 'Y label',
    title             => 'Some simple graph',
    y_max_value       => 8,
    y_tick_number     => 8,
    y_label_skip      => 2 
) or die $my_graph->error; 
```

**编辑：**

显然我误解了这个问题，文本应该覆盖在图表区域上。在这种情况下，*实验性*的get_feature_coordinates 方法显然可用于获取“坐标轴内矩形的坐标”，并且从中您应该知道可以直接在 GD::Image 上绘制的位置`$graph->plot(\@data)`

# ruby-on-rails - 将嵌入式 Derby 与 JRuby on Rails 结合使用

> ID：728626
> 
> 赞同：5
> 
> 时间：2009-04-08T05:33:06.147
> 
> 标签：ruby-on-rails, jruby, derby

尝试将 JRuby 1.2.0 和 Rails 2.3.2 与嵌入式 Derby 数据库一起使用。我已将`derbytools.jar`and复制`derby.jar`到`$RUBY_HOME/lib`，但`rake db:migrate`仍然给出：

```
The driver encountered an error: 
    cannot load Java class org.apache.derby.jdbc.ClientDriver 
```

Aaaand...我预感到并想通了。因此，我将在此处发布此内容，以防其他人遇到与我相同的问题。

我在网上找到的几乎所有文档都`database.yml`对 Derby 进行了以下配置：

```
development:
    adapter: jdbc
    driver: org.apache.derby.jdbc.ClientDriver
    url: jdbc:derby:[db];create=true
    username: xxx
    password: xxx 
```

这可能适用于客户端/服务器设置，但对于嵌入式 Derby 设置，您需要：

```
development:
    adapter: jdbc
    driver: org.apache.derby.jdbc.EmbeddedDriver
    url: jdbc:derby:[db];create=true
    username: xxx
    password: xxx 
```

请注意“EmbeddedDriver”，而不是“ClientDriver”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T16:44:14.267

要回答，因为我讨厌在我的个人资料中看到那个红色块。

当您使用嵌入式 derby 时，ActiveRecord-JDBC 中还有一个微妙的错误——如果您不给它一个用户名和密码，那么什么都不起作用。我已经找到了这个错误的原因，并且正在努力提交一个补丁，但是如果你遇到了同样的问题，请告诉我，我会在这里发布代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T09:07:30.757

奇怪的是它对我来说很好，在我的 ubuntu 9.04 盒子上：我只使用标准的 ubuntu 包，我的数据库配置是：

```
development:
 adapter: jdbc
 driver: org.apache.derby.jdbc.EmbeddedDriver
 url: jdbc:derby:[myapp];create=true 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-07T16:46:31.357

ClientDriver 在 derbyclient.jar 中

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-27T23:51:47.603

除了 Don 的回答，我在使用没有用户名/密码的 ClientDriver 时遇到了这个错误：`The driver encountered an error: java.sql.SQLNonTransientConnectionException: Password length (0) is outside the range of 1 to 255.`

在 database.yml 中设置用户名/密码解决了这个问题！

# php - 如何在 php 的数组中添加缺失的索引？

> ID：728627
> 
> 赞同：4
> 
> 时间：2009-04-08T05:33:17.347
> 
> 标签：php, arrays

例子：

我有这样的数组：

数组（[0] => 苹果 [2] => 橙色 [5] => 梨 [8] => 梨）

有一个函数可以补全缺失的索引：1,3,4,6,7????

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T08:41:18.237

对于较大的阵列，这应该更快。对于较小的数组，任何方法都可以。

```
$existingKeys = array_keys($array);

//you can use any value instead of null
$newKeys = array_fill_keys(range(min($existingKeys), max($existingKeys)), null);
$array += $newKeys;

//optional, probably not needed
ksort($array); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T05:48:21.383

您可以尝试从最低索引到最高索引的 for() 并在它为空时完成

```
for($i = 0 ;$i <= 8 ; $i++) 
{
//if it's not set
if(!isset($array[$i]))
{
//set to empty
$array[$i] = "";
}

} 
```

此外，您可以先计算数组上的元素数量并将其包装在一个函数中

```
 function completeIndexes($array)
    {

    $total = count($array);
     for($i = 0 ;$i < $total ; $i++) 

        {
        //if it's not set
        if(!isset($array[$i]))
        {
        //set to empty
        $array[$i] = "";
        }

        }
return $array; 
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T05:49:32.813

```
for($i=0;i<count($array);++$i){
    $array[$i] = isset($array[$i])? $array[$i] : '';
} 
```

不过，它只是用空字符串填充缺失的键。不确定这是否适合您。

**编辑**

只是注意到 Perr0_hunter 在我之前写了几乎相同的东西：P

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-08T05:45:40.093

如果你想要做的是重新排序数组，那么你会得到

```
Array( [0] => Apple [1] => Orange [2] => Pear [3] => Pear ) 
```

只需创建一个新数组并将值复制到其中。它将按顺序分配新索引

IE

```
$new_array = array();
for( $value in $old_array )
  $new_array[] = $value; 
```

# xml - 想要保存已更改节点值的 xslt 应用 xml 文件

> ID：728628
> 
> 赞同：1
> 
> 时间：2009-04-08T05:33:29.717
> 
> 标签：xml, xslt

我为 XML 创建了一个 XSLT，它的节点值显示为文本。现在我想将原始 XML 文件保存为具有更改值的新文件。这些值由用户在 xml 生成的 html 文本框中输入。我正在使用 windows mobile(PDA) C# .net compact 框架。将 xslt 应用的 xml 文件加载到 webbrowser 控件中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T06:03:50.223

脚步：

一个。从 XML 文件加载 XmlDocument。

湾。从 XSL 文件加载 XSLT 文档。

C。创建要写入输出的 XmlTextWriter 或 XmlWriter。如果转换的输出方法是“xml”，这可以引用目标 XML 文件。

d。通过提供任何必需的参数，使用 XSLT 转换 XML 文档。我认为这些值将来自您的用户输入文本框。

[这是一个演练](http://support.microsoft.com/kb/307322)，它展示了如何在不直接使用 XmlTextWriter 的情况下执行此操作。还有[一个](http://www.csharpfriends.com/Articles/getArticle.aspx?articleID=63)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T07:32:12.070

你对你的环境（编程语言、操作系统等）给出零细节。在 Unix 上，使用 xsltproc，我会简单地使用 shell 重定向：

```
xsltproc transform.xsl data.xml > result.xml 
```

# mysql - 我应该为我的大型项目使用 MySQL 6.0 吗？

> ID：728633
> 
> 赞同：0
> 
> 时间：2009-04-08T05:36:29.197
> 
> 标签：mysql, version, mysql6

MySQL 6.0 用于生产。我可以将它用于大型项目的数据库存储吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T05:43:25.233

MySQL 5.1 是最新的稳定版本，我建议坚持使用它。6.0 在这一点上会很不稳定。

**编辑**截至 2011-05-26 MySQL 5.5.12 是最新的稳定版本。请参阅此链接以获取最新的稳定版本：[http ://dev.mysql.com/downloads/](http://dev.mysql.com/downloads/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T05:55:53.720

MySQL 6.0 目前是 alpha 版本，所以我建议你使用当前的稳定版本 -> MySQL 5.1

[在这里](http://dev.mysql.com/doc/refman/6.0/en/full-table.html)，您可以找到有关表大小限制的一些信息，具体取决于操作系统。MySQL 没有内部限制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T06:01:21.460

仅当您的站点需要重要的增强功能时。即便如此，我也会忍住并使用变通方法，直到它至少进入测试版。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T06:16:44.857

我们尝试在 IIS7 机器上使用最新的 PHP 和 MySQL 5.1，但失败了。我敢肯定，如果你下载 PHP 的源代码并编译它，它会支持 5.1，但开箱即用它似乎支持 5.0。所以，我们用 5.0 替换了 5.1，一切都完美无缺。

短篇小说是使用效果好的东西。我会在开发中尝试它并在生产中避免它，直到一切正常。

# php - 删除过多的换行符

> ID：728640
> 
> 赞同：5
> 
> 时间：2009-04-08T05:40:35.583
> 
> 标签：php, whitespace

我正在寻找类似 trim() 但在字符串范围内的东西。用户有时会在输入后输入 2、3、4 或更多行回车，我需要清理此输入。

样本输入

```
i like cats

my cat is happy
i love my cat

hope you have a nice day 
```

期望的输出

```
i like cats

my cat is happy
i love my cat

hope you have a nice day 
```

我没有看到任何内置的东西，字符串替换需要多次迭代才能完成工作。在我提出一个小的递归字符串替换之前，我想看看你们还有什么其他建议。

我有一种奇怪的感觉，这个也有一个正则表达式。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-08T06:00:13.337

```
function str_squeeze($body) {
    return preg_replace("/\n\n+/", "\n\n", $body);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T05:55:23.753

你需要多少文字才能做到这一点？如果它小于约 100k，那么您可能只使用简单的搜索并替换正则表达式（搜索类似的内容`/\n+/`并替换为`\n`）

另一方面，如果您需要遍历兆字节的数据，那么您可以逐个字符地解析文本，将输入复制到输出，除非遇到多个换行符，在这种情况下，您只需复制一个换行符并忽略休息。

不过，我不建议使用递归字符串替换，听起来会非常慢。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T07:01:21.300

终于设法得到它，需要 preg 所以你在 php 中使用 PCRE 版本，还需要一个 \n\n 替换字符串，以便不擦除所有行尾，而是一个：

```
 $body = preg_replace("/\n\n+/", "\n\n", $body); 
```

谢谢你让我走上正轨。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-09T07:57:55.960

要考虑所有三个换行符序列：

```
preg_replace('/(?:\r\n|[\r\n]){2,}/', "\n\n", $str) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-08T06:13:22.820

以下正则表达式应删除多个换行符，同时忽略单个换行符，这在您的定义中是可以的：

```
ereg_replace("\n\n+", "\n\n", $string); 
```

您可以使用这个[PHP 正则表达式测试工具](http://lumadis.be/regex/test_regex.php)对其进行测试，该工具非常方便（但它似乎与 PHP 不完全一致）。

[编辑] 将 ' 修复为 "，因为它们似乎不起作用。不得不承认我刚刚在网络工具中测试了正则表达式。;)

# sharepoint - 创建从 SPItemEventReceiver 继承的新基类时出现 VSeWSS 问题

> ID：728644
> 
> 赞同：0
> 
> 时间：2009-04-08T05:41:52.317
> 
> 标签：sharepoint

我试图做以下事情：

```
public abstract class MyItemEventReceiverBase : SPItemEventReceiver

public class TestItemEventReceiver : MyItemEventReceiverBase 
```

它可以毫无问题地构建，但是当我切换到 WSP 视图时，Visual Studio 会出错。错误如下：“*无法加载一种或多种请求的类型。检索 LoaderExceptions 属性以获取更多信息。* ”没有关于实际问题的更多详细信息。

那么是否可以创建一个继承自 SPItemEventReceiver 的基类，该基类可供自定义列表项事件接收器类使用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T20:44:51.410

我有完全相同的错误！[我什至在微软开了一张票，在最后一个人给我发来这个页面](http://www.microsoft.com/downloads/details.aspx?FamilyID=7bf65b28-06e2-4e87-9bad-086e32185e68&displaylang=en)的链接之前，我经历了 5 个人，注意甜蜜的报价

> Microsoft 不为这些扩展提供技术支持

无论如何，足够的咆哮，问题是你不能在不同的程序集中拥有你的基类。我在我的 Web 程序集中创建了一个 webpart 基类，并尝试在我的站点模板程序集中从它继承。不行。所以确保基类在同一个程序集中。

（我遇到另一篇文章说如果您的基类在打开 VS2008 之前在 GAC 中，它将起作用，但我从未尝试过）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T21:10:20.023

出于实验目的：在没有抽象基类的情况下是否会发生错误？

# c# - 什么更快——Java 或 C#（或好的旧 C）？

> ID：728645
> 
> 赞同：28
> 
> 时间：2009-04-08T05:42:10.150
> 
> 标签：c#, java, .net, c, performance

我目前正在决定一个平台来构建科学计算产品，并且正在决定在 Core2 Quad CPU 上使用英特尔编译器的 C#、Java 或纯 C。它主要是整数算术。

到目前为止，我的基准测试显示 Java 和 C 大致相当，.NET/C# 落后约 5% - 但是我的一些同事声称，如果有足够的时间，经过正确优化的 .NET 将击败这两者让 JIT 完成其工作。

我总是假设 JIT 会在应用程序启动后的几分钟内完成它的工作（在我的情况下可能是几秒钟，因为它主要是紧密的循环），所以我不确定是否相信他们

任何人都可以说明情况吗？.NET 会击败 Java 吗？（或者我现在最好还是坚持使用 C 语言？）。

该代码是高度多线程的，数据集大小为数 TB。

在这种情况下，Haskell/Erlang 等不是选项，因为有大量现有的遗留 C 代码将被移植到新系统，并且将 C 移植到 Java/C# 比 Haskell 或 Erlang 简单得多。（当然，除非这些提供了显着的加速）。

编辑：我们正在考虑迁移到 C# 或 Java，因为理论上它们可能会更快。我们可以减少处理时间的每一个百分点，每年可以为我们节省数万美元。在这一点上，我们只是试图评估 C、Java 或 c# 是否会更快。

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2009-04-08T06:43:58.410

问题中的关键信息是：

> 我们可以减少处理时间的每一个百分比每年为我们节省数万美元

因此，您需要考虑削减每一个百分点的*成本。*如果这种优化工作每年花费数万美元，那么就不值得去做。你可以通过解雇程序员来节省更多的钱。

有了正确的技能（如今这些技能更稀有，因此更昂贵），您可以手工制作汇编程序以获得最快的代码。使用稍微不那么稀有（且昂贵）的技能，你几乎可以用一些看起来很丑陋的 C 代码来做同样的事情。等等。您从中挤出的性能越多，开发工作的成本就越高，而且付出的努力越多，回报就越少。如果从中获得的利润保持在“每年数万美元”，那么就会有一个不再值得努力的地步。事实上，我大胆猜测你已经到了那个地步，因为“每年数万美元”在一份薪水的范围内，而且可能不足以购买手动优化复杂程序所需的技能。

我猜如果您已经用 C 编写了代码，那么将其全部重写为另一种语言的直接翻译将浪费 90% 的精力。它的执行速度很可能会变慢，因为您不会利用平台的功能，而是与它们对抗，例如尝试像使用 C 一样使用 Java。

同样在您现有的代码中，有些部分会对运行时间做出重要贡献（它们经常运行），而其他部分则完全不相关（它们很少运行）。因此，如果您对加速程序有一些想法，那么浪费时间将其应用于不影响运行时间的程序部分是没有经济意义的。

因此，请使用分析器来查找热点，并查看现有代码中哪些地方浪费了时间。

**当我注意到对“多线程”代码的引用时更新**

在这种情况下，如果您将精力集中在消除瓶颈上，以便您的程序可以在大量内核上很好地扩展，那么它每年都会自动变得更快，其速度将使您可以进行的任何其他优化相形见绌。明年这个时候，四核将成为台式机的标准配置。在那之后的一年，8核会越来越便宜（我一年多前花了几千美元买了一个），我预测到那时一台32核机器的成本将低于开发人员。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-04-08T05:46:30.340

对不起，但这不是一个简单的问题。这在很大程度上取决于*到底*发生了什么。C# 肯定没有懈怠，你很难说“java 更快”或“C# 更快”。C是一个非常不同的野兽......它可能有更快的潜力 -**如果**你做对了; 但在大多数情况下，它会大致相同，但更难编写。

它还取决于你*如何*做——锁定策略、你*如何*做并行化、主要代码体等。

Re JIT - 您可以使用 NGEN 将其展平，但是可以；如果您正在使用相同的代码，则应该尽早进行 JITted。

C#/Java（优于 C）的一个非常有用的特性是它们有可能更好地利用本地 CPU（优化等），而您不必担心。

另外 - 使用 .NET，考虑诸如“并行扩展”（捆绑在 4.0 中）之类的东西，它为您提供了更强大的线程故事（与没有 PFX 的 .NET 相比）。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-04-08T08:37:46.857

**不用担心语言；并行化！**

如果你有一个高度多线程、数据密集的科学代码，那么我认为担心语言不是你最大的问题。我认为您应该专注于使您的应用程序并行化，尤其是使其扩展到单个节点之外。这将使您获得比仅仅切换语言更高的性能。

只要您被限制在单个节点上，您就会对应用程序的计算能力和带宽感到饥渴。在即将推出的众核机器上，尚不清楚您是否拥有在所有内核上进行数据密集型计算所需的带宽。您可以进行计算密集型工作（就像 GPU 一样），但如果您需要将大量数据流式传输到每个内核，您可能无法提供所有内核。

我认为你应该考虑两种选择：

1.  **MapReduce**
    您的问题听起来很适合[Hadoop](http://en.wikipedia.org/wiki/Hadoop)之类的东西，它专为数据密集型作业而设计。

    Hadoop 已在 Linux 上扩展到 10,000 个节点，您可以将工作分流到其他人（*例如*亚马逊、微软）或您自己的计算云。它是用 Java 编写的，因此就移植而言，您可以从 Java 中调用现有的 C 代码，也可以将整个代码移植到 Java。

2.  **MPI**
    如果您不想麻烦移植到 MapReduce，或者由于某种原因您的并行范例不适合 MapReduce 模型，您可以考虑调整您的应用程序以使用[MPI](http://www.mcs.anl.gov/research/projects/mpi/)。这也将允许您扩展到（可能数千个）核心。MPI 是计算密集型分布式内存应用程序的事实标准，我相信存在 Java 绑定，但大多数人将 MPI 与 C、C++ 和 Fortran 一起使用。因此，您可以将代码保留在 C 中，并专注于并行化性能密集型部分。如果您有兴趣，请查看[OpenMPI for starters。](http://www.open-mpi.org/)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-04-08T05:52:57.517

老实说，我对这些基准感到惊讶。

在计算密集型产品中，我会押注 C 以更快地执行。您可能会编写像筛子一样泄漏内存的代码，并且具有与线程相关的有趣缺陷，但它应该更快。

我认为 Java 或 C# 会更快的唯一原因是测试的运行时间较短。如果发生很少或没有 GC，您将避免实际释放内存的开销。如果该过程是迭代或并行的，请尝试在您认为已完成一堆对象的任何地方粘贴 GC.Collect（在将内容设置为 null 或以其他方式删除引用之后）。

此外，如果您正在处理数 TB 的数据，我的意见是，使用 C 获得的确定性内存分配会更好。如果您在分配堆时大致接近于释放，那么您的堆将基本上保持未碎片化。在 GC 环境下，您的程序在经过相当长的运行时间后很可能会使用比您想象的更多的内存，这仅仅是因为碎片。

对我来说，这听起来像是那种 C 是合适的语言的项目，但需要额外注意内存分配/释放。我敢打赌，如果在完整数据集上运行，C# 或 Java 将会失败。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-04-08T08:36:16.113

很久以前， [Raymond Chen](http://blogs.msdn.com/oldnewthing/)和[Rico Mariani](http://blogs.msdn.com/ricom/)发表了一系列博客文章，逐步优化将文件加载到字典工具中。虽然 .NET 在早期更快（即容易快速），但 C/Win32 方法最终明显更快——但相当复杂（例如使用自定义分配器）。

最后，哪个更快的答案将在很大程度上取决于您愿意在每种方法的每一微秒内花费多少时间。这种努力（假设你做得正确，由真实的分析器数据指导）将比语言/平台的选择产生更大的差异。

* * *

第一个和最后一个性能博客条目：

*   [陈第 1 部分](http://blogs.msdn.com/oldnewthing/archive/2005/05/10/415991.aspx)
*   [马里亚尼第 1 部分](http://blogs.msdn.com/ricom/archive/2005/05/10/performance-quiz-6-chinese-english-dictionary-reader.aspx)
*   [检查最后一部分](http://blogs.msdn.com/oldnewthing/archive/2005/05/19/420038.aspx)
*   [马里亚尼最后一部分](http://blogs.msdn.com/ricom/archive/2005/05/20/performance-quiz-6-conclusion-studying-the-space.aspx)

（最后一个链接给出了结果的总体总结和一些分析。）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-08T05:47:05.130

这将在很大程度上取决于您具体在做什么。我有优于 C 代码的 Java 代码。我的 Java 代码比 C++ 代码慢得多（我不使用 C#/.NET，所以无法与这些代码交谈）。

所以，这取决于你在做什么，我相信你可以找到语言 X 比语言 Y 更快的东西。

您是否尝试过通过探查器运行 C# 代码以查看它在哪里花费的时间最多（在您使用 Java 和 C 时也是如此）。也许你需要做一些不同的事情。

Java HotSpot VM 比 .NET 更成熟（其根源至少可以追溯到 1994 年），因此这可能归结为两者的代码生成能力。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-04-08T09:56:18.837

您说“代码是多线程的”，这意味着算法是可并行的。此外，您保存“数据集大小为几 TB”。

优化就是发现和消除瓶颈。

明显的瓶颈是数据集的带宽。鉴于数据的大小，我猜测数据保存在服务器上而不是台式机上。你没有给出你正在使用的算法的任何细节。算法所花费的时间是否大于读取/写入数据/结果所花费的时间？该算法是否适用于总数据的子集？

我将假设该算法适用于数据块而不是整个数据集。

您有两种情况需要考虑：

1.  与获取数据相比，该算法处理数据所需的时间更多。在这种情况下，您需要优化算法。

2.  该算法处理数据所需的时间少于获取数据所需的时间。在这种情况下，您需要增加算法和数据之间的带宽。

在第一种情况下，您需要一个可以编写良好的汇编代码的开发人员，以充分利用您正在使用的处理器，并利用 SIMD、GPU 和多核（如果可用）。无论您做什么，都不要只是增加线程数，因为一旦线程数超过内核数，您的代码就会变慢！这是由于切换线程上下文的额外开销。另一种选择是使用类似于 SETI 的分布式处理系统（您的组织中有多少台 PC 用于管理目的 - 想想所有多余的处理能力！）。正如 bh213 所提到的，C#/Java 可能比使用 SIMD 等编写良好的 C/C++ 慢一个数量级。但如今，这是一个小众技能。

在后一种情况下，如果您受到带宽的限制，那么您需要改进将数据连接到处理器的网络。在这里，请确保您使用的是最新的以太网设备 - 1Gbps 无处不在（PC 卡、交换机、路由器等）。不要使用无线，因为它更慢。如果有很多其他流量，请考虑与“办公室”网络并行的专用网络。考虑将数据存储在更靠近客户端的位置 - 每五个左右的客户端使用一个直接连接到每个客户端的专用服务器，该服务器镜像来自服务器的数据。

如果节省百分之几的处理时间可以节省“数万美元”，那么请认真考虑聘请顾问，实际上是两个 - 一个软件，一个网络。他们应该很容易用节省下来的钱为自己买单。我敢肯定这里有很多有资格提供帮助的人。

但是，如果降低成本是最终目标，那么请考虑[Google 的方法](http://www.cringely.com/2009/04/geek-chic-google%E2%80%99s-culture-of-efficiency/)- 编写代码，使 CPU 保持在 100% 以下。这通过减少冷却直接和间接地节省了能源，从而降低了成本。你会想要更多的钱，所以它又是 C/C++ - Java/C# 有更多的开销，开销 = 更多的 CPU 工作 = 更多的能量/热量 = 更多的成本。

因此，总而言之，在省钱方面，比您要选择的语言要多得多。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-08T05:46:14.633

如果已经有大量遗留 C 代码将添加到系统中，那么为什么要迁移到 C# 和 Java？

为了响应您关于希望利用处理速度的任何改进的最新编辑……那么您最好的选择是坚持使用 C，因为它比具有运行时环境开销的 C# 和 Java 更接近硬件来处理。越接近硬件，您应该能够运行得越快。诸如 C# 和 Java 之类的高级语言将导致更快的开发时间……但 C……或更好的汇编语言将导致更快的处理时间……但更长的开发时间。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-04-08T08:56:48.857

我参加了几场 TopCoder 的马拉松比赛，其中表现是胜利的关键。

我的选择是 C#。我认为 C# 解决方案的位置略高于 Java，并且比 C++ 稍慢......直到有人用 C++ 编写了一个速度快一个数量级的代码。您被允许使用 Intel 编译器，而获奖代码充满了 SIMD 指令，您无法在 C# 或 Java 中复制它。但是如果 SIMD 不是一个选项，C# 和 Java 应该足够好，只要您注意正确使用内存（例如，注意缓存未命中并尝试将内存访问限制为 L2 缓存的大小）

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-04-08T12:01:15.010

您的问题措辞不佳（或至少标题如此），因为它暗示这种差异是地方性的，并且适用于所有 java/c#/c 代码实例。

值得庆幸的是，问题的主体措辞更好，因为它对您的代码所做的事情提供了相当详细的解释。它没有说明您正在使用的 c#/java 运行时的版本（或提供者）。它也没有说明代码将在其上运行的目标架构或机器。这些事情有很大的不同。

你做了一些基准测试，这很好。关于为什么你会看到你所做的结果的一些*建议：*

*   您在编写高性能 c# 代码方面不如在 java/c 上好（这不是批评，甚至可能，但这是您应该考虑的真正可能性）
*   JVM 的更高版本进行了一些重要的优化，以使非竞争锁非常快。这可能会使事情对您有利（尤其是与您正在使用的 c 实现线程原语的比较）
*   由于与 c 代码相比，java 代码似乎运行良好，因此您可能并不十分依赖堆分配策略（分析会告诉您这一点）。
*   由于 c# 代码的运行不如 java 代码好（假设代码具有可比性），因此存在几个可能的原因：
    *   您正在使用（不必要的）JVM 将内联但 CLR 不会内联的虚拟函数
    *   最新的 JVM进行了[逃逸分析](http://en.wikipedia.org/wiki/Escape_analysis)，这可能会使一些代码路径更加高效（尤其是那些涉及生命周期受堆栈限制的字符串操作）
    *   只有最新的 32 位 CLR 会内联涉及非原始结构的方法
    *   一些 JVM JIT 编译器使用热点风格机制，试图检测代码的“热点”并花费更多精力重新调整它们。

如果不了解您的代码大部分时间都在做什么，就不可能提出具体的建议。由于在对象上使用结构或通过针对 CLR 的运行时特定功能（如非装箱泛型），我可以很容易地编写在 CLR 下性能更好的代码，这作为一般陈述几乎没有指导意义。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-04-08T05:49:30.817

实际上它是“汇编语言”。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-04-08T05:57:12.173

取决于您正在编写什么样的应用程序。尝试计算机语言基准游戏

[http://shootout.alioth.debian.org/u32q/benchmark.php?test=all&lang=csharp&lang2=java&box=1](http://shootout.alioth.debian.org/u32q/benchmark.php?test=all&lang=csharp&lang2=java&box=1) [http://shootout.alioth.debian.org/u64/benchmark.php?test=all&lang=csharp&lang2 =java&box=1](http://shootout.alioth.debian.org/u64/benchmark.php?test=all&lang=csharp&lang2=java&box=1)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-04-08T09:14:28.000

重申一下，如果你在做算术科学计算，你应该使用 GPU，而不是 CPU。[如果 Matlab 许可不是问题，带有 CUDA 插件](http://developer.nvidia.com/object/matlab_cuda.html)的 Matlab 将比 Java 或 c# 更棒。nVidia 文档展示了如何将任何 CUDA 函数编译为 mex 文件。如果你需要免费软件，我喜欢 pycuda。

但是，如果 GPU 不是一个选项，我个人喜欢 C 用于很多例程，因为编译器所做的优化不像 JIT 那样复杂：您不必担心“类”是否会变成“结构”或不。以我的经验，问题通常可以被分解，这样更高级的东西可以用 Python 等表达能力很强的语言编写（丰富的原语、动态类型、非常灵活的反射），并且可以用 C 等语言编写转换。此外，如果您选择走 C/C++ 路线，则有整洁的编译器软件，如[PLUTO](http://www.cse.ohio-state.edu/~bondhugu/pluto/)（自动循环并行化和 OpenMP 代码生成），以及 Hoard、tcmalloc、BLAS（GPU 的 CUBLAS）等库。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-04-08T10:14:56.110

需要注意的一件事是，如果您的应用程序将受益于[惰性评估](http://www.haskell.org/haskellwiki/Haskell/Lazy_evaluation "懒惰的评价")，那么像[Haskell](http://haskell.org/)这样的函数式编程语言可能会通过不评估不必要的分支而产生与理论优化的结构化/OO 代码完全不同的速度提升。

此外，如果您正在谈论更好的性能带来的金钱收益，请不要忘记将维护软件的成本添加到等式中。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2010-03-21T11:47:34.550

**当然，答案是去购买你能负担得起的具有最多内核/处理器的最新 PC。**如果您购买一台最新的 2x4 核 PC，您会发现它不仅具有两倍于四核的内核，而且它们的运行速度比上一代处理器/机器快 25-40%。

这将使您的速度提高大约 150%。远不止选择 Java/C# 或 C。如果您继续购买新盒子，那么您每 18 个月会再次获得相同的东西！

*你可以坐在那里几个月重写你的代码，或者我可以今天下午去我当地的 PC 商店，运行速度比你当天所有的努力都快。*

提高代码质量/效率是好的，但有时将实施资金花在其他地方会更好。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2010-03-21T12:00:17.237

用一种或另一种语言写作只会给你大量工作带来小的加速。要真正加快速度，您可能需要查看以下内容：

1.  购买最新最快的硬件。
2.  从 32 位操作系统迁移到 64 位。
3.  网格计算。
4.  CUDA/OpenCL。
5.  使用编译器优化，如矢量化。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-08T05:47:57.327

我会使用 C#（或 Java），因为您的*开发*时间可能会比使用 C 快得多。如果您最终需要额外的速度，那么您总是可以用 C 重写一个部分并将其称为模块。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-04-16T17:56:22.253

我的首选是 C 或 C++，因为我没有通过 JIT 编译器与机器语言分开。

您想要进行激烈的性能调整，这意味着一次单步执行一条指令以查看热点，然后调整源代码以生成最佳汇编程序。

如果你不能让编译器生成你认为足够好的汇编代码，那么一定要为热点编写你自己的汇编程序。您正在描述一种对性能的需求至关重要的情况。

如果我站在你的立场（或曾经），我不会做的是依赖关于一种语言比另一种语言更快或更慢的轶事概括。我要做的是沿着[THIS](https://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024)和[THIS](https://stackoverflow.com/questions/368831/how-to-write-a-profiler/738647#738647)和[THIS](http://www.wikihow.com/Optimize-Your-Program%27s-Performance)的路线进行多次激烈的性能调整。这种事情我已经做过很多次了，关键是迭代诊断和修复的循环，因为每一个修复的蛞蝓都会使剩余的蛞蝓更加明显，直到你真的无法从萝卜中挤出另一个循环。

祝你好运。

补充：是否有一些很少更改的配置信息决定了如何处理大量数据？如果是这样，可能是程序花费了大量时间重新解释配置信息以找出下一步该做什么。如果是这样，编写一个*代码生成器*通常是一个巨大的胜利，它将读取配置信息并生成一个临时程序，该程序可以快速浏览数据，而无需经常弄清楚要做什么。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2011-05-13T14:50:30.390

取决于您的基准测试和硬件。我认为这是速度而不是内存或 CPU 使用率。但是....

如果您有一台专门用于仅具有非常大内存的应用程序的机器，那么 java 可能会快 5%。

如果您在现实世界中内存有限并且在同一台机器上运行更多应用程序，.net 看起来更好地利用计算资源：[请参见此处](http://www.codeproject.com/KB/dotnet/RuntimePerformance.aspx)

如果硬件非常受限，C/C++ 会胜出。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-04-08T05:53:15.147

如果您使用的是高度多线程的代码，我建议您查看即将推出的[适用于 .NET 的任务并行库 (TPL) 和](http://msdn.microsoft.com/en-us/concurrency/default.aspx)适用于本机 C++ 应用程序的并行模式库 (PPL)。这将为您节省很多线程/死锁问题以及您将花费大量时间自行研究和解决的所有其他问题。就我自己而言，我真的相信托管世界中的内存管理会更有效率，并且从长远来看会击败本机代码。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-04-08T06:34:42.817

如果您的大部分代码都在 C 中，为什么不保留它呢？原则上和设计上，很明显 C 更快。随着时间的推移，它们可能会缩小差距，但它们总是具有更高级别的 os 间接性和“安全性”。C 之所以快，是因为它“不安全”。想想边界检查。每种语言都支持与 C 的接口。所以我不明白为什么如果 C 代码仍在工作并以你喜欢的任何语言使用它，为什么不喜欢把它包装起来

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-04-08T10:34:37.030

我会考虑其他人都在使用什么——不是这个网站上的人，而是那些编写相同类型的大规模并行或超高性能应用程序的人。

我发现他们都用 C/C++ 编写代码。所以，仅仅为了这个事实（即，不管语言之间的任何速度问题），我都会选择 C/C++。如果你用同一种语言写作，他们使用和开发的工具对你来说会更有用。

除此之外，我发现 C# 应用程序在某些领域的性能略低于最佳性能，多线程就是其中之一。.NET 将尝试使您免受线程问题的影响（在大多数情况下可能是一件好事），但这会导致您的特定情况出现问题（测试：尝试编写一个使用大量线程访问共享对象的简单循环。运行在单核 PC 上，您可以获得比在多核机器上运行更好的性能 - .net 添加自己的锁以确保您不会搞砸）（我使用了[Jon Skeet 的单例](http://www.yoda.arachsys.com/csharp/singleton.html)基准测试。静态锁在我的旧笔记本上用了 1.5 秒，在我的超快台式机上用了 8.5 秒，锁定版本更糟糕，你自己试试）

下一点是，使用 C，您倾向于直接访问内存和数据 - 没有任何障碍，使用 C#/Java，您将使用提供的许多类中的一些。这些在一般情况下会很好，但是您追求的是最好、最有效的方法来访问它（对于您的情况来说，这对于数 TB 的数据来说很重要，这些类在设计时并未考虑到这些数据集，它们是为其他人使用的常见情况而设计的），所以再一次，你会更安全地使用 C - 当你读取几个 TB 时，你永远不会让 GC 被一个在内部创建新字符串的类阻塞如果你用 C 语言编写数据！

因此，看起来 C#/Java 可以为您提供优于本机应用程序的优势，但我认为您会发现这些优势仅适用于通常编写的业务线应用程序。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-04-13T00:22:25.187

请注意，对于繁重的计算，有一个很大的优势是紧密的循环可以适合 CPU 的一级缓存，因为它避免了重复进入较慢的内存来获取指令。

即使对于二级缓存，像 Quake IV 这样的大型程序使用 4 Mb 二级缓存与 1 Mb 二级缓存相比，性能提高了 10% - [http://www.tomshardware.com/reviews/cache-size-matter,1709- 5.html](http://www.tomshardware.com/reviews/cache-size-matter,1709-5.html)

对于这些紧密的循环，C 很可能是最好的，因为您对生成的机器代码拥有最多的控制权，但对于其他一切，您应该选择具有最佳库的平台来完成您需要执行的特定任务。例如，netlib 库被认为在处理大量问题时具有非常好的性能，并且可以使用许多其他语言的端口。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-04-13T00:39:25.300

如果每个百分比真的可以为您节省数万美元，那么您应该请一位领域专家来帮助您完成该项目。在初始阶段考虑性能的精心设计和编写的代码可能会快一个数量级，为您节省 90% 或 900,000 美元。我最近在一些代码中发现了一个细微的缺陷，它使进程加快了 100 倍以上。我的一位同事发现了一个在 O(n^3) 中运行的算法，他将其重写为 O(N log n)。这往往是巨大的性能节省所在。

如果问题非常简单，以至于您确定无法使用更好的算法来显着节省成本，那么 C 很可能是您最好的语言。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2012-02-03T16:03:36.957

最重要的事情已经在这里说了。我要补充：

开发者利用编译器利用的语言来生成处理器利用系统资源使用的机器指令。当链的所有部分都以最佳方式执行时，程序将“快速”。

因此，对于“最佳”语言选择：

*   选择你最能控制的语言
*   它能够充分指示编译器
*   生成近乎最优的机器码，使得
*   目标机器上的处理器能够最佳地利用处理资源。

如果您不是性能专家，您将很难在任何语言中实现“最佳性能”。可能 C++ 仍然提供了最多的选项来控制机器指令（尤其是 SSE 扩展）。

我建议以众所周知的 80:20 规则为导向。这对所有人来说都是正确的：硬件、语言/平台和开发人员的努力。

由于升级到更快的处理器 fe，开发人员一直依赖硬件来自动修复所有性能问题。过去可能有效的方法在（最近的）将来不会有效。开发人员现在有责任为并行执行相应地构建她的程序。虚拟机和虚拟运行时环境的语言将在这里显示出一些优势。[即使没有大规模并行化， C#](http://ilnumerics.net)或[Java](http://jblas.org)也没有理由不能像 C++ 一样成功。

@Edit：请参阅[C#、Matlab 和 FORTRAN 的比较](http://ilnumerics.net/blog/fast-faster-performance-comparison-c-ilnumerics-fortran-matlab-and-numpy-part-ii/)，其中 FORTRAN 不会单独获胜！

* * *

## 回答 #26

> 赞同：-6
> 
> 时间：2009-04-08T06:54:26.030

参考；“*到目前为止，我的基准测试表明 Java 和 C 大致相当*”

那么您的基准测试存在严重缺陷......

C 总是比 C# 和 Java 快几个数量级，除非你做错了什么……！

PS！请注意，这不是试图欺负 C# 和 Java，我既喜欢 Java 又喜欢 C#，还有其他原因导致您在许多问题上选择 Java 或 C# 而不是 C。但是 Java 和 C# 都不会正确的书面测试永远无法以与 C 相同的速度执行...

*编辑是因为反对我言论的评论数量庞大*

比较一下这两个混蛋...

C＃

```
public class MyClass
{
   public int x;

   public static void Main()
   {
      MyClass[] y = new MyClass[1000000];
      for( int idx=0; idx < 1000000; idx++)
      {
          y[idx] = new MyClass();
          y[idx].x = idx;
      }
   }
} 
```

反对这个（C）

```
struct MyClass
{
   int x;
}

void Main()
{
   MyClass y[1000000];
   for( int idx = 0; idx < 1000000; idx++)
   {
      y[idx].x = idx;
   }
} 
```

C# 版本首先需要将其数组存储在堆上。C 版本将数组存储在堆栈上。将内容存储在堆栈上只是更改整数值的值，而将内容存储在堆上意味着找到足够大的内存块，并且可能意味着遍历内存很长时间。

现在主要是 C# 和 Java 分配大量内存，他们一直在消耗这些内存，直到用完为止，这使得这个逻辑执行得更快。但即便如此，将其与更改整数值进行比较就像是 F16 与油轮的速度比较......

其次，在 C 版本中，因为所有这些对象都已经在堆栈中，我们不需要在循环中显式创建新对象。再一次，对于 C#，这是一个“寻找可用内存操作”，而 C 版本是一个 ZIP（*什么都不做操作*）

第三个事实是，当这些对象超出范围时，C 版本会自动删除所有这些对象。再一次，这是一个*只改变整数值的值*的操作。在大多数 CPU 架构上，这需要 1 到 3 个 CPU 周期。C# 版本没有这样做，但是当垃圾收集器启动并需要收集这些项目时，我的猜测是我们正在谈论*数百万*个 CPU 周期......

此外，C 版本将立即变为 x86 代码（在 x86 CPU 上），而 C# 版本将首先变为 IL 代码。然后稍后在执行时必须进行 JIT 编译，这可能单独花费几个数量级的时间，然后只执行 C 版本。

现在一些聪明人可能会执行上述代码并测量 CPU 周期。然而，这样做基本上没有任何意义，因为从数学上证明，托管版本可能需要数百万倍于 C 版本的 CPU 周期数。所以我的猜测是，在这个例子中，我们现在谈论的速度要慢 5-8 个数量级。当然，这是一个“被操纵的测试”，因为我“*正在寻找一些东西来证明我的观点*”，但是我挑战那些在这篇文章中对我发表不好评论的人，以创建一个在 C 中执行速度不快并且也没有不要使用由于存在“更好的替代方案”而通常不会在 C 中使用的构造。

请注意，C# 和 Java 是很棒的语言。*一天中的任何*时候，我都更喜欢它们。但不是因为他们更快。因为他们不是。它们*总是*比 C 和 C++ 慢。除非你用 C 或 C++ 蒙着眼睛编写代码......

编辑;

C# 当然有*struct关键字，如果我们使用关键字**struct*而不是*class*将 C# 类更改为值类型，这将严重影响上述 C# 版本的速度。struct 关键字意味着 C# 将在堆栈上存储给定类型的新对象 - 对于上述示例，这将大大提高速度。上面的示例恰好也包含这些对象的数组。

即使我们像这样经历和优化 C# 版本，我们最终还是会得到比 C 版本慢几个数量级的东西......

一段*好的*C代码*总是*比 C#、Java、Python 和*任何你选择的托管语言*更快......

正如我所说，我喜欢 C#，我今天所做的大部分工作是 C# 而不是 C。但是我不使用 C#，因为它比 C 更快。我使用 C# 因为我不需要 C 给我的速度增益我的大部分问题。

C# 和 Java*都比*C 慢得多，而 C++ 就这点而言...

# forms - 表单提交预览

> ID：728648
> 
> 赞同：0
> 
> 时间：2009-04-08T05:42:59.430
> 
> 标签：forms

我有一个用户填写的相当长的 HTML 表单。填写完成后，用户可以预览他们提交的数据。从那里他们可以将数据提交到系统中或返回并编辑它。我想知道处理此预览步骤的最佳方法是什么。我的一些想法是：

*   将表单数据存储在 cookie 中以供预览
*   将表单数据存储在会话中
*   将数据放入数据库中，状态列指示它是预览

创建这样的预览时，您通常会做什么？还有其他问题需要考虑吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T06:02:57.883

把数据作为隐藏字段（）。

为什么不使用 cookie 或会话？- 如果用户决定丢弃这些数据，他可能只是导航到其他页面。当他稍后返回并看到完整的数据时，他可能会感到惊讶。

为什么不是数据库？- 如果用户只是关闭浏览器，谁来清理你数据库中的数据？...我宁愿不为此写一个 cron 作业。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T06:23:02.873

我不确定这是否是最佳实践，但是当我完成这项任务时，我已将其放入会话中。我希望用户在单个会话期间预览和提交/重新编辑数据，因此会话对我来说就足够了。

如果您希望预览保留在您的用户机器上，您应该使用 cookie - 这意味着用户不必在单个会话期间汇总/重新编辑预览，但可以在此操作之间关闭浏览器，然后返回到在下一个会话中预览。使用这种方法，您必须考虑用户可以在其浏览器中拒绝 cookie。这就是人们通常将会话与 cookie 结合在一起的原因。

除非您想以某种方式跟踪和存储预览和编辑操作，否则无需将数据放入数据库（带有状态列）。你可以把数据库想象成你桌子上的一个抽屉——你把文件放在那里，里面放着你想存储的东西，以后再找。如果你只是画一个预览草稿，结果提交后，只有最终版本存储在抽屉/数据库中，预览被弄皱并扔掉，而不是你不会把它放在数据库中。但是，如果出于某种原因您认为稍后会查看草稿，则必须将它们存储在数据库中。

我不确定我的英语是否清楚，但我尽力了：D

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T13:12:19.787

我首先会根据表格填写的难度来衡量它。如果这是一个漫长的过程（例如抵押贷款或其他信息）并且您有用户登录，您可能希望为他们提供一个机会来保存未完成的表格并稍后再回来查看。

会话仅适用于（取决于您的设置）需要不到一小时的任务。易于开始和完成的手动输入数据（如 CD/DVD 编目）将非常适合存储会话。同样，如果这个人不得不停下来寻找一些文件（同样，在抵押贷款应用程序或在线税表等的情况下），如果会话超时并且他们必须重新输入信息。

我会避免直接将内容注入 cookie，因为数据是为后续请求传递的，并且假设您已经可以访问基本会话功能。

如果您使用数据库，**则**需要对访问进行时间戳记（假设您不只是将其保留为用户确定的一些已保存名称，例如“我的 2008 年抵押文件”），以便稍后清理它。如果用户确实将其保存在表单中间，则将其保留，直到他们完成表单或将其删除。

# winforms - winform.net 2.0 的交叉表数据控件

> ID：728650
> 
> 赞同：1
> 
> 时间：2009-04-08T05:43:24.717
> 
> 标签：winforms, .net-2.0, crosstab

任何人都可以建议我在 .net 中显示交叉表数据的任何 winforms 控件吗？

更新： 1\. 控件应该是可编辑的 2\. 绑定支持将是附加功能。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T05:48:10.977

如果您只需要数据的只读显示，则将[ReportViewer 控件](http://www.gotreportviewer.com/)与 Matrix 一起使用可能是最简单的。

# iphone - Iphone-sdk - “不能使用对象作为方法的参数”

> ID：728655
> 
> 赞同：0
> 
> 时间：2009-04-08T05:45:40.467
> 
> 标签：iphone, objective-c

我的 .h 文件如下

```
#import <Foundation/Foundation.h>

@interface MyClass : NSObject {
}
- (void) addWidget: (Widget*)aWidget;
@end 
```

举例来说，Widget 只是一些只包含几个字符串的简单类。显然，要么我做错了什么，要么只是被 Java / C# 宠坏了，因为当我尝试构建时，编译器告诉我不能使用对象作为方法的参数。

有谁知道我做错了什么？还是objective-c方法不接受复杂类型？（说不是这样！）

**[更新]** 好的，这很奇怪..但我刚刚从“构建”菜单中选择了“干净”，现在错误消失了..啊..我的这种误导。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T05:49:15.217

该代码唯一的问题是 Widget 没有在任何地方声明。您应该在使用类型之前使用`#import "Widget.h"`或放置。`@class Widget;`

# debian - 查找有关 linux 应用程序文件的信息

> ID：728657
> 
> 赞同：1
> 
> 时间：2009-04-08T05:46:07.567
> 
> 标签：debian

我有一个想在 debian 中运行的程序，但是当我启动它时，我得到一个分段错误错误。它以前在debian中工作过。我可以运行任何命令来查看问题所在吗？它需要什么库以及它是否是有效的可执行文件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T05:54:14.147

对于开始类型

```
whereis programname 
```

获取可执行文件的位置、它的文档和（可能）它在系统上的源代码。然后输入

```
file `which programname` 
```

看看它是否是一个有效的可执行文件。然后输入

```
/lib/ld-linux.so.* --list `which programname` 
```

查看程序运行所需的共享库。

最后，输入

```
ulimit -c unlimited
programname
gdb `which programname` core
where
q 
```

以获得碰撞的准确位置。

例子：

```
$ whereis perl
perl: /usr/bin/perl /usr/bin/X11/perl /usr/share/man/man1/perl.1.gz

$ file `which perl`
/usr/bin/perl: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), for GNU/Linux 2.6.4, dynamically linked (uses shared libs), stripped

$ /lib/ld-linux.so.* --list `which perl`
        linux-gate.so.1 =>  (0xffffe000)
        libnsl.so.1 => /lib/libnsl.so.1 (0xb7f56000)
        libdl.so.2 => /lib/libdl.so.2 (0xb7f51000)
        libm.so.6 => /lib/libm.so.6 (0xb7f28000)
        libcrypt.so.1 => /lib/libcrypt.so.1 (0xb7ef1000)
        libutil.so.1 => /lib/libutil.so.1 (0xb7eec000)
        libpthread.so.0 => /lib/libpthread.so.0 (0xb7ed2000)
        libc.so.6 => /lib/libc.so.6 (0xb7d76000)
        /lib/ld-linux.so.2 (0xb7f92000)

$ ulimit -c unlimited
$ perl
^\Quit (core dumped)
$ gdb `which perl` core
GNU gdb (GDB; openSUSE 11.1) 6.8.50.20081120-cvs
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "i586-suse-linux".
For bug reporting instructions, please see:
<http://bugs.opensuse.org/>...
(no debugging symbols found)
Core was generated by `perl'.
Program terminated with signal 3, Quit.
#0  0xffffe430 in __kernel_vsyscall ()
(gdb) where
#0  0xffffe430 in __kernel_vsyscall ()
#1  0xb7fd2b93 in __read_nocancel () from /lib/libpthread.so.0
#2  0x081bcb9b in PerlIOUnix_read ()
#3  0x081be025 in PerlIOBuf_fill ()
#4  0x081bc402 in PerlIOBase_read ()
#5  0x081bc571 in PerlIO_getc ()
#6  0x0812121e in Perl_sv_gets ()
#7  0x081f11e1 in Perl_filter_read ()
#8  0x081f15e3 in ?? ()
#9  0x081facc9 in Perl_yylex ()
#10 0x08210674 in Perl_yyparse ()
#11 0x080d844f in ?? ()
#12 0x080dc372 in perl_parse ()
#13 0x08063ff8 in main ()
(gdb) quit 
```

例子：

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T05:52:22.543

`strace`或`gdb`。Strace 将打印系统调用跟踪，`gdb program`允许`bt`在崩溃后键入并查看堆栈跟踪。

# c# - 使用 c# 将 SQL Server 备份文件 (.bak) 创建到任何位置

> ID：728658
> 
> 赞同：8
> 
> 时间：2009-04-08T05:46:10.560
> 
> 标签：c#, sql-server, permissions, backup

我正在尝试用 C# 编写简单的应用程序，这将允许我通过 ftp 备份、压缩和发送我的 SQL Server 数据库。我遇到的一个问题是，如果我尝试在与“C:\Program Files\Microsoft SQL Server\MSSQL.3\MSSQL\Backup”不同的位置创建备份文件 (.bak)，我将无法创建它或“C:\Program Files\Microsoft SQL Server\MSSQL.3\MSSQL\Data”文件夹。我知道这是一个前提问题。有人可以指出我的资源或在这里写一个简短的片段如何以编程方式将这样的权限添加到我系统上的任何文件夹。

问候克里斯

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-08T10:15:24.237

我假设您正在将程序作为计划任务运行...您是否为任务的执行用户授予目标文件夹的写入权限？

**编辑：**
有权限你可以有2个场景：

*   窗户认证
*   混合认证

如果您使用的是windows认证，则获取windows用户的读写权限。否则 sql server 服务帐户的权限。

这种行为对我来说很有意义，并且可能在你的场景中击中钉子！

**编辑2：**
我不想鼓励你这样做......当你弄乱他们的acl时，一些管理员可能会讨厌你，但这[可能](http://weblogs.asp.net/cumpsd/archive/2004/02/08/69403.aspx)会奏效

顺便说一句：Magnus Johansson[已经给了](https://stackoverflow.com/questions/728658/creating-sql-server-backup-file-bak-with-c-to-any-location/728696#728696)你一个“try-this”链接

无论您采用哪种方法 - 请务必提交正确的用户（如上所述！）

*（完整的历史）
......*
旁注：
我知道这不是你问题的确切答案，但我建议你 smo 生成备份......

喜欢

```
using Microsoft.SqlServer.Management.Smo;

var bdi = new BackupDeviceItem(/* your path inlcuding desired file */);
var backup = new Backup
{
    Database = /* name of the database */,
    Initialize = true
};

backup.Devices.Add(bdi);

var server = new Server(this.SqlServer);

try
{
    backup.SqlBackup(server);
}
catch (Exception ex)
{
    // * log or sth
} 
```

你只需要关心 .dll 的。获取所需服务器版本的程序集（某些参数/属性因服务器版本而异）
更多信息[在这里](http://msdn.microsoft.com/en-us/library/ms162129.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T09:11:33.570

好的，伙计们，马格努斯和混蛋！非常感谢你的帮助。我已经将 Magnus 的链接与关于在文件夹上设置权限的文章结合起来，并进行了一些研究，最后我得到了它:)。所以重新假设，我正在使用 Smo，并且要创建一个具有适当权限的文件夹，我必须查找该组而不是 win32_Users。如果有人发现这篇文章，他会发现它很有用，你可以在这里看到一个简短的片段：

```
string tempPath = Directory.CreateDirectory("C:\\path_to_your_folder").FullName;

//set permissions
SelectQuery sQuery = new SelectQuery("Win32_Group", 
                                     "Domain='" + 
                                     System.Environment.UserDomainName.ToString() + 
                                     "'");
try
{
    DirectoryInfo myDirectoryInfo = new DirectoryInfo("C:\\path_to_your_folder");
    DirectorySecurity myDirectorySecurity = myDirectoryInfo.GetAccessControl();
    ManagementObjectSearcher mSearcher = new ManagementObjectSearcher(sQuery);
    foreach (ManagementObject mObject in mSearcher.Get())
    {
        string User = System.Environment.UserDomainName + "\\" + mObject["Name"];
        if(User.StartsWith("your-machine-name\\SQL"))
        {
            myDirectorySecurity.
            AddAccessRule(new FileSystemAccessRule(User, 
                                                   FileSystemRights.FullControl,
                                                   AccessControlType.Allow));
        }
    }
    myDirectoryInfo.SetAccessControl(myDirectorySecurity);
}
catch (Exception ex)
{
    Console.WriteLine(ex.StackTrace);
} 
```

再次感谢大家的帮助！Stackoverflow 摇滚！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-06-20T11:52:26.653

这是一个用于在 C# 中进行备份的程序。希望对您有所帮助

```
 public void BackupDatabase (string BackUpLocation, string BackUpFileName, string 
   DatabaseName, string ServerName )
   {

        DatabaseName = "[" + DatabaseName + "]";

        string fileUNQ = DateTime.Now.Day.ToString() + "_" + DateTime.Now.Month.ToString() + "_" + DateTime.Now.Year.ToString() +"_"+ DateTime.Now.Hour.ToString()+ DateTime.Now .Minute .ToString () + "_" + DateTime .Now .Second .ToString () ;

        BackUpFileName = BackUpFileName + fileUNQ + ".bak";
        string SQLBackUp = @"BACKUP DATABASE " + DatabaseName + " TO DISK = N'" + BackUpLocation + @"\" + BackUpFileName + @"'";

        string svr = "Server=" + ServerName + ";Database=master;Integrated Security=True";

        SqlConnection cnBk = new SqlConnection(svr);
        SqlCommand cmdBkUp = new SqlCommand(SQLBackUp, cnBk);

        try
        {
            cnBk.Open();
            cmdBkUp.ExecuteNonQuery();
            Label1.Text = "Done";
            Label2.Text = SQLBackUp + " ######## Server name " + ServerName + " Database " + DatabaseName + " successfully backed up to " + BackUpLocation + @"\" + BackUpFileName + "\n Back Up Date : " + DateTime.Now.ToString();
        }

        catch (Exception ex)
        {
            Label1.Text = ex.ToString();
            Label2.Text = SQLBackUp + " ######## Server name " + ServerName + " Database " + DatabaseName + " successfully backed up to " + BackUpLocation + @"\" + BackUpFileName + "\n Back Up Date : " + DateTime.Now.ToString();
        }

        finally
        {
            if (cnBk.State == ConnectionState.Open)
            {

                cnBk .Close(); 
            } 
      } 
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T05:59:02.993

看看[这篇文章](http://www.redmondpie.com/applying-permissions-on-any-windows-folder-using-c/)。

请记住为运行 SQL Server 实例的帐户设置权限。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T06:46:14.520

虽然这可能无法回答您的直接问题，但我建议您查看 SQL Server Integration Services (SSIS)。这看起来就像创建 SSIS 的确切内容，并且在 2008 版本中，如果标准组件不能满足您的需要（早期版本使用 VB.NET），则可以在需要时使用 C# 代码。

[MSDN SSIS 信息链接 1](http://msdn.microsoft.com/en-us/library/ms141026.aspx)
[SSIS 2005 教程链接 2](http://www.accelebrate.com/sql_training/ssis_tutorial.htm)

看看它。

# iphone - 如何在iphone应用程序中将视图更改为水平

> ID：728663
> 
> 赞同：0
> 
> 时间：2009-04-08T05:47:44.067
> 
> 标签：iphone

如何将视图更改为水平视图。我不希望它在 iPhone 侧放时切换，我希望它永久水平。谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T12:59:28.180

[注意：stackoverflow（查询](https://stackoverflow.com/search?q=setStatusBarOrientation)）上已经有几个与“风景”相关的问题/答案。[但是为了直接回答你的问题，这里是苹果官方文档](https://developer.apple.com/iphone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/ApplicationEnvironment/ApplicationEnvironment.html#//apple_ref/doc/uid/TP40007072-CH7-SW18)对此主题的高级摘要：

1.  使用字符串值 UIInterfaceOrientationLandscapeRight（或 UIInterfaceOrientationLandscapeLeft）将 UIInterfaceOrientation 添加到 Info.plist。完成同样事情的另一个选项是在启动时调用 UIApplication 的 setStatusBarOrientation:animated: 方法（即在 applicationDidFinishLaunching: 内）。
2.  在你的根视图控制器中实现 shouldAutorotateToInterfaceOrientation: 如下：

    ```
    -(BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation { 
       return (interfaceOrientation == UIInterfaceOrientationLandscapeRight);
    }
    ```

# wpf - WPF中的线程问题

> ID：728669
> 
> 赞同：0
> 
> 时间：2009-04-08T05:48:51.023
> 
> 标签：wpf, multithreading

我收到了这个异常

> 用户代码未处理 System.InvalidOperationException Message="调用线程无法访问此对象，因为不同的线程拥有它。"

每当我运行以下代码时

```
public partial class MainScreen : Window
{
        Timer trm;

        public MainScreen()
        {
            InitializeComponent();

            trm = new Timer(1000);
            trm.AutoReset = true;
            trm.Start();
            trm.Elapsed += new ElapsedEventHandler(trm_Elapsed);
        }

        void trm_Elapsed(object sender, ElapsedEventArgs e)
        {
            lblTime.Content = System.DateTime.Now;
        }
} 
```

伙计们任何解决方案......我非常想摆脱它:(

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T06:08:28.853

请改用 DispatcherTimer：

```
public partial class MainScreen : Window{
DispatcherTimer tmr;    
public MainScreen() {
InitializeComponent();
tmr = new DispatcherTimer();
tmr.Tick += new EventHandler(tmr_Tick);
tmr.Start();    
}
void tmr_Tick(object sender, EventArgs e) {
    lblTime.Content = System.DateTime.Now;
}
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T05:55:39.227

任何时候修改 Windows 控件都必须在 UI 线程（创建控件的线程）上进行。

有关详细信息，请参阅[此问题](https://stackoverflow.com/questions/716472)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T06:10:13.263

简而言之，您应该使用 Dispatcher.Invoke 方法来更新 UI 元素。

# delphi - 不知何故 COM 对象实例丢失

> ID：728673
> 
> 赞同：1
> 
> 时间：2009-04-08T05:51:00.393
> 
> 标签：delphi, com

我有一个主应用程序，一个类型库包含 2 个 COM 对象，一个是 IFile，一个是 IFiles。IFiles 创建 IFile，并将它们存储在 TLIST 中，并具有 Add、Remove 等标准方法。IFile 和 IFiles 都是 TAutoObject。

IFiles 中的“Add”方法工作正常，它只是创建 IFile 对象 [代码 1]，并将其添加到 TList。问题是 IFile 对象实例以一种非常奇怪的方式丢失。见 [代码 2]

[代码 1]

```
function IFiles.Add(AFilename: String): IFile;
begin
  Result := CoIFile.Create;
  Result.Filename := AFilename;
  // ShowMessage(IntToStr(Result._AddRef));
  fFiles.Add(@Result);
end; 
```

在主应用程序中，我有这样的测试代码。[代码 2]

```
var
  i: Integer;
  f: IFile;
  Files: IFiles;
begin
  Files := CoTIFile.Create;
  for i:= 1 to 4 do
  begin
    // Create a dummy file object
    f := Files.Add('Filename ' + IntToStr(i));
    f._AddRef; // Not sure if AddRef works like this
    // Prints out the last file
    Memo1.Lines.Add(Files.Files[i-1].Filename);
  end;

  for i:= 0 to Files.Count-1 do
  begin
    f := Files.Files[i];
    // F is nil at all time.
    if (f<>nil) then Memo1.Lines.Add(f.Filename); // ! No print out.
  end;  
end; 
```

从第二个循环开始，即使 fFiles.Count = 4，但所有内容都丢失了。我是否需要在 IFile 中进行一些额外的处理来处理 AddRef 和 Release？或者我写的 IFiles.Add 方法是错误的？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T06:22:02.270

尝试使用 TInterfaceList 而不是 TList 来存储 IFile 的实例。这可能会解决您的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T09:16:45.017

原始代码中的问题是您正在添加一个`IFile` *指向*列表的指针，但是当您稍后从列表中读取一个值时，您将指针直接分配给另一个`IFile`变量。所以你有本质上是一个`PIFile`存储在`IFile`变量中的值。Delphi 通常允许您将无类型`Pointer`类型分配给任何类似指针的类型，包括接口。

要修复您的原始代码，您需要编写如下所示的第二个外观：

```
var
  p: Pointer;

for i := 0 to Pred(Files.Count) do begin
  p := Files.Files[i];
  if not Assigned(p) then
    continue;
  f := IFile(p^);
  if not Assigned(f) then
    continue;
  Memo1.Lines.Add(f.Filename);
end; 
```

`f._AddRef`您在第一个循环中调用是对的。返回时`IFiles.Add`，结果的引用计数是`1`因为存储在循环中的值是一个指针，而不是实际的引用。您需要增加引用计数，因为`f`它将被重新用于其他值。由于您手动计数的引用存储在`FFiles`列表中，因此最好在`_AddRef`内部调用`IFiles.Add`而不是等到它返回。

当您清除列表或从列表中删除项目时，您需要调用`_Release`所有接口引用。

但[托比的回答](https://stackoverflow.com/questions/728673/somehow-com-object-instance-gets-lost/728739#728739)给出了更好的主意：`TInterfaceList`用于存储接口列表。`TList`根本不适合本身的任务。

最后一条建议：名称上的“I”前缀用于表示*接口*类型。接口没有自己的方法实现。您已经展示了`IFiles.Add`, 所以`IFiles`显然不是接口类型的实现。它应该被命名`TFiles`，或者也许是`TFileList`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T06:14:28.370

如果没有对它的引用，我会自动释放 COM 对象。在代码 1 中，COM 对象在“结束”语句中被释放。

我认为您需要创建一个包装器对象，而该包装器对象就是您添加到文件中的内容。

抱歉，我现在没有时间创建示例。

# html - Google 是否“理解”微格式，它对我的 SEO 有帮助吗？

> ID：728674
> 
> 赞同：10
> 
> 时间：2009-04-08T05:51:02.903
> 
> 标签：html, seo, semantic-markup, microformats

语义 HTML 使 Google 更容易抓取和“理解”网站，但微格式呢？微格式是否比标准 HTML 标记更具语义/可抓取性？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T11:39:46.680

谷歌在过去几天宣布了一些 RDFa 和微格式支持。

链接和评论在这里：

[http://rdfa.info/2009/05/12/google-announces-support-for-rdfa/](http://rdfa.info/2009/05/12/google-announces-support-for-rdfa/)

雅虎一直在使用 RDFa 和 Microformats 来驱动 Search Monkey：

[http://developer.yahoo.com/searchmonkey/](http://developer.yahoo.com/searchmonkey/)

两者都可能有助于点击率，但不一定有助于排名。随着时间的推移，预计会有更多的搜索引擎使用更多不同的 RDFa 词汇表。BOSS在这里也有关系：

[http://developer.yahoo.com/search/boss/](http://developer.yahoo.com/search/boss/)

目的是帮助创建更多搜索引擎，他们将可以访问页面中的数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T06:18:08.533

对于地理信息，Google 将解析 KML 文件并将其和其中的链接编入索引。

我相信雅虎已经落后于 RDFa 我认为谷歌还没有承认这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T17:44:27.447

AFAIK，所有主要搜索引擎都支持 rel-nofollow 微格式。除此之外，我不知道有任何支持。然而，有一些更小、更专业的搜索引擎是专门为微格式设计的。例如，有些搜索引擎允许您使用 XFN 微格式搜索人与人之间的关系。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T05:58:16.350

据我所知，谷歌并没有积极谈论这些微格式作为生成页面排名的一种方式，据我了解，它更多地适用于其他类型的机器人，而不仅仅是制作通用搜索引擎。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T08:39:06.120

目前，谷歌还没有宣布任何对微格式的**支持**。我希望，在不久的将来他们会。
另一方面，[雅虎宣布](http://ysearchblog.com/2008/03/13/the-yahoo-search-open-ecosystem/)将支持 RDFa、eRDF 和微格式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-20T06:57:25.720

它们使您的页面更具语义性，因为它们在您将信息组合在一起的方式上更加一致。主要的搜索引擎可以并且确实可以读取微格式，并且经常使用它们来显示谷歌所谓的“丰富片段”（[http://googlewebmastercentral.blogspot.com/2009/05/introducing-rich-snippets.html](http://googlewebmastercentral.blogspot.com/2009/05/introducing-rich-snippets.html)），这增加了一些SERP有趣的东西。必应和雅虎也都显示这些。

# twitter - 在 MySQL 数据库中缓存/存储 Twitter API 数据

> ID：728678
> 
> 赞同：0
> 
> 时间：2009-04-08T05:52:31.527
> 
> 标签：twitter

我在 mysql 数据库中有一个 twitter 用户名数据库。我想用数据填充当前空的描述、位置和 url 字段。

最好的方法是什么？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T06:01:48.510

您应该查看 Twitter [REST API 文档](http://apiwiki.twitter.com/REST+API+Documentation)。里面应该有可以使用的东西。

例如，如果您使用以下 url，您将获得有关特定用户的 JSON 格式的信息：`http://twitter.com/users/show/<userid>.json`. 如果您使用`.xml`而不是结束您的 url `.json`，您将获得 xml 格式的相同信息。

然后在您的应用程序中，您可以解析返回的数据并将缺失值添加到数据库中。

# mysql - 我应该对多个操作使用单个过程，还是将它们拆分为多个过程？

> ID：728679
> 
> 赞同：0
> 
> 时间：2009-04-08T05:52:36.770
> 
> 标签：mysql, stored-procedures

我正在为数据库中的几个操作编写存储过程，我只是想知道：

*   为可以执行添加、修改、删除操作或...的表设计一个过程是否更好？
*   我应该为每个操作设计单独的程序吗

哪种方法会更好？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T05:54:36.407

我会说每个操作都有一个单独的存储过程是最好的。否则你会在你的程序中得到太多的逻辑。

此外，大多数操作需要不同的参数。对于删除，您只需要主键，但对于插入，您必须提供所有不可为空的列的值。当您只想删除一条记录时，您不想提供虚拟插入参数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T05:55:41.943

至少您需要几个带有 if ... else 逻辑的 SQL 命令。我发现，如果存储过程只做一件事，它们就更容易管理。

这是一个可从正常程序开发中转移的概念，但它更强烈地适用于存储过程。

好处：更容易测试、更有意义的 SP 名称（例如 UpdateCustomer 而不是 CustomerHandler）、更少的耦合/更好的内聚、更简单的过程、更少的参数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T06:11:59.547

每个程序一次操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T06:29:15.713

你不爱鲍勃叔叔吗：[单一责任原则](http://en.wikipedia.org/wiki/Single_responsibility_principle)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-26T11:26:31.267

最好为不同的逻辑实现不同的程序。

这样，您可以轻松管理代码并减少依赖关系。

# c# - 有没有办法将 VS 与只能通过 sftp 访问的远程站点一起使用？

> ID：728690
> 
> 赞同：4
> 
> 时间：2009-04-08T05:56:07.963
> 
> 标签：c#, visual-studio, ftp, sftp

我正在使用 asp.net 并编写一些类（CMS 的控件）以在我的网站上使用。目前我正在使用具有 sftp 支持和语法突出显示的文本编辑器 (UE) 来编辑文件并通过 sftp 保存。然后我只是在测试站点上测试它。它运行良好..但由于我对 c# 很陌生，我总是在查找方法、参数等。

不是不可能，而是痛苦。

这就是 Visual Studio 的用武之地。我想使用 VS，所以我得到自动完成和 MSDN 的钩子。但是我对设置本地环境不感兴趣，因为我的网络主机已经有一个测试环境，坦率地说，这是我的设置和主机之间的差异（即：CMS、unicode 问题、日期.. .) 这是比较棘手的部分。

有没有办法将 Visual Studio 与只能通过 sftp 访问的远程站点一起使用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-11T10:23:58.737

一种方法是将 SFTP 服务器安装为 Windows 驱动器。

如果 SFTP 服务器在您的本地网络上，那么您可以将其挂载为 Windows 共享。如果它在您的 DMZ 中的网络之外，那么您可以找到可让您将 SFTP 服务器安装为驱动器的软件。

允许您执行此操作的软件包括[ExpanDrive](http://www.expandrive.com/windows)。这将允许您像往常一样使用 Visual Studio，同时在后台根据需要将文件上传到 SFTP 服务器并从 SFTP 服务器下载。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T00:58:14.023

嗯，这是一个答案：

我的第一个想法是设置 FileZilla 以发送您“已发布”开发网站的目录。这将是最简单的设置，坦率地说，这是将内容传输到服务器的最快方式。

如果您正在专门寻找一种应用程序内的方法来执行此操作：

Visual Studio 设置为接受嵌入式应用程序。例如：VIM（Vi 嵌入式）。您可以简单地加载一个精通 sFTP 的嵌入式应用程序。

一个例子：

来自[VIM 文档](http://www.vim.org/htmldoc/pi_netrw.html)：

Vim 下面向网络的文件传输是由基于 VimL 的脚本 () 使用插件技术实现的。它目前支持使用 rcp、scp、ftp 或 ftp+<.netrc>、scp、fetch、dav/cadaver、rsync 或 sftp 跨网络读写。

# javascript - Javascript外部脚本加载异常

> ID：728697
> 
> 赞同：0
> 
> 时间：2009-04-08T05:59:18.970
> 
> 标签：javascript, external-script

我正在维护一个遗留的 javascript 应用程序，它的组件分为 4 个 JS 文件。

它们是“Default.aspx”、“set1.aspx”、“set2.aspx”和“set3.aspx”。ASPX 页面从属于它们各自集合的多个（所有不同的）源文件中写出压缩的 JS，并将内容类型标头设置为“text/javascript”。

通过添加对第一个集合的引用并创建主条目对象来调用应用程序。

```
<script src="/app/default.aspx" type="text/javascript"></script>

<script type="text/javascript>

    var ax;  

    // <body onload="OnLoad()">
    function OnLoad() {
        ax = new MyApp(document.getElementById("axTargetDiv"));
    }

</script> 
```

在第一组脚本 (default.aspx) 的末尾是以下*确切*代码：

```
function Script(src) {
    document.write('<script src="' + src + '" type="text/javascript"></script>');
}

Script("set1.aspx?v=" + Settings.Version); 
```

它将加载第二组脚本 (set1.aspx)。这在所有主要浏览器（IE6-8 Firefox Safari Opera Chrome）中都没有任何错误。

但是，由于我一直在安静地编写这个脚本，所以我想在很多地方简化函数调用并错误地内联上述 Script 函数，导致以下代码：

```
document.write('<script src="set1.aspx?v=' + Settings.Version + '" type="text/javascript"></script>'); 
```

在使用测试页面进行测试时，现在在所有浏览器中都会引发以下错误：

```
MyApp is not defined. 
```

这发生在一行：`ax = new MyApp(...`Visual Studio JS 调试器*和*Firebug 报告它。

我在发布到这个问题的前 4 个答案中尝试了各种方法，但无济于事。使 MyApp 能够成功加载的唯一方法是将实际的“添加脚本”代码放入函数（即`document.write('script')`行）中：

**如果我把这`document.write`条线放在一个函数中，它就可以工作，否则就不行。发生了什么？**

拆分和/或转义脚本文本不起作用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T08:41:18.253

要查看问题，请查看其脚本元素中的第一行：

```
<script type="text/javascript">
    document.write('<script src="set1.aspx?v=1234" type="text/javascript"></script>');
</script> 
```

因此，出现了一个 HTML 解析器并看到了开始的 <script> 标记。在 <script> 内部，普通的 <tag> 解析被禁用（在 SGML 术语中，元素具有 CDATA 内容）。为了找到脚本块的结束位置，HTML 解析器会查找匹配的关闭标记 </script>。

它找到的第一个是字符串文字中的那个。HTML 解析器无法知道它在字符串文字中，因为 HTML 解析器对 JavaScript 语法一无所知，他们只知道 CDATA。所以你实际上是在说：

```
<script type="text/javascript">
    document.write('<script src="set1.aspx?v=1234" type="text/javascript">
</script> 
```

也就是说，一个未闭合的字符串文字和一个未完成的函数调用。这些会导致 JavaScript 错误，并且永远不会写入所需的脚本标记。

解决该问题的常见尝试是：

```
document.write('...</scr' + 'ipt>'); 
```

这在技术上仍然是错误的（并且不会验证）。这是因为在 SGML 中，结束 CDATA 元素的字符序列实际上不是 '</tagname>' 而只是 '</' — 仍然存在于上一行中的序列。浏览器通常更宽容，实际上会允许它。

可能最好的解决方案是转义序列。有几种可能性，但最简单的是使用 JavaScript 字符串文字转义 ('\xNN')：

```
document.write('\x3Cscript src="set1.aspx?v=1234\x26w=5678" type="text/javascript"\x3E\x3C/script\x3E'); 
```

以上转义所有 '<', '>' 和'&' 字符，它不仅停止出现在字符串中的 '</' 序列，而且还允许将其插入到 XHTML 脚本块中而不会导致错误。

（在 XHTML 中，没有 CDATA 元素之类的东西，因此这些字符的含义与包含在正常内容中的含义相同，并且脚本块中的字符串 '<script>' 实际上会创建一个嵌套的脚本元素！这是可能的允许 <>& 在 XHTML 脚本块中使用 <![CDATA[ 部分，但它有点难看，通常最好避免在内联脚本中使用这些字符。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T06:17:42.497

1) 确保在脚本“实际”包含在您的页面中之前不要尝试引用 MyApp。

2）尝试在你的内联加载器中打破“脚本”这个词，如下所示：

```
<script type="text/javascript">
document.write('<scr' + 'ipt src="set1.aspx?v=1234" type="text/javascript"></scr' + 'ipt>');
</script> 
```

或者，使用我从谷歌分析代码中借来的并且能够成功使用的语法：

```
<script type="text/javascript">
document.write(unescape("%3Cscript src='set1.aspx?v=1234' type='text/javascript'%3E%3C/script%3E"));
</script> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T08:30:36.687

你也可以试试：

```
var script = document.createElement("script");
script.src = "set1.aspx?v=1234";
script.type = "text/javascript";
document.getElementsByTagName("head")[0].appendChild(script); 
```

史蒂夫

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T07:52:38.290

如果您可以使用 JQuery，您可以使用以下内容：

```
$.getScript("set1.aspx?v=1234"); 
```

这会将脚本加载到全局 javascript 上下文中。确保将响应的内容类型设置为“text/javascript”。

希望这可以帮助...

# delphi - 什么是用于从外部应用程序访问菜单命令的发送 API

> ID：728701
> 
> 赞同：0
> 
> 时间：2009-04-08T06:01:30.803
> 
> 标签：delphi, api, menu, send

是否有发送 api 来访问另一个应用程序中的菜单命令？例如，我正在尝试访问记事本的查看菜单。我要怎么做？我已经使用 GetSystemMenu 获得了菜单，但我无法访问它。我认为这已经有一个 API，但我不知道。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T08:18:47.403

Python 中的以下代码激活查看/状态栏菜单项。将它转换为 Delphi 应该没有问题，因为它看起来像伪代码。它选择第 4 个菜单项（“视图”）和第 1 个菜单项（“状态栏”）。如果需要，您可以将其更改为通过遍历项目并使用`GetMenuString`. 有关详细信息，请参阅 MSDN。

请注意，它不会进行任何错误检查。另请注意，它希望记事本的标题为“无标题 - 记事本”。（您可以将其更改`None`为搜索任何内容；我想那将是`nil`在 Delphi 中。）

```
from win32gui import *
from win32con import *
hwnd = FindWindow('Notepad', 'Untitled - Notepad') # use Winspector Spy to find window class name and title
hmenu = GetMenu(hwnd)
hviewmenu = GetSubMenu(hmenu, 3)                   # 3rd menu item across, starting from 0
id = GetMenuItemID(hviewmenu, 0)                   # 0th menu item down ("Status Bar")
PostMessage(hwnd, WM_COMMAND, id, 0) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T22:57:11.160

这里有一些 Delphi 代码。
请注意，如果您没有真正的菜单，这将不起作用。
来自帮助：“GetMenu 不适用于浮动菜单栏。浮动菜单栏是模仿标准菜单的自定义控件；它们不是菜单。要获得浮动菜单栏的句柄，请使用 Active Accessibility API。”

例如，它不适用于 Delphi 本身......

```
// Grab sub menu for a Window (by handle), given by (0 based) indices in menu hierarchy
function GetASubmenu(const hW: HWND; const MenuInts: array of Integer): HMENU;
var
  hSubMenu: HMENU;
  I: Integer;
begin
  Result := 0;
  if Length(MenuInts) = 0 then
    Exit;

  hSubMenu := GetMenu(hW);
  if not IsMenu(hSubMenu) then
    Exit;

  for I in MenuInts do
  begin
    Assert(I < GetMenuItemCount(hSubMenu), format('GetASubmenu: tried %d out of %d items',[I, GetMenuItemCount(hSubMenu)]));
    hSubMenu := GetSubMenu(hSubMenu, I);
    if not IsMenu(hSubMenu) then
      Exit;
  end;

  Result := hSubMenu;
end;

// Get the caption for MenuItem ID
function GetMenuItemCaption(const hSubMenu: HMENU; const Id: Integer): string;
var
  MenuItemInfo: TMenuItemInfo;
begin
  MenuItemInfo.cbSize := 44;           // Required for Windows 95\. not sizeof(AMenuInfo)
  MenuItemInfo.fMask := MIIM_STRING;
  // to get the menu caption, 1023 first chars should be enough
  SetLength(Result, 1023 + 1);
  MenuItemInfo.dwTypeData := PChar(Result);
  MenuItemInfo.cch := Length(Result)-1;
  if not GetMenuItemInfo(hSubMenu, Id, False, MenuItemInfo) then
    RaiseLastOSError;
  // real caption's size. Should call GetMenuItemInfo again if was too short
  SetLength(Result, MenuItemInfo.cch);
  {$WARN SYMBOL_PLATFORM OFF}
  if DebugHook > 0 then
    OutputDebugString(MenuItemInfo.dwTypeData);
end;

procedure Test;
var
  hwnd, hSubMenu: Cardinal;
  id : Integer;
begin
//  hwnd := FindWindow('Afx:00400000:8:00010013:00000000:03F61829', nil); // UltraEdit
//  hSubMenu := GetASubmenu(hwnd, [5,0]);
  hwnd := FindWindow('Notepad', nil); // get the 1st instance of Notepad...
  hSubMenu := GetASubmenu(hwnd, [3]); // 4th submenu Menu aka &View

  if hSubMenu > 0 then
  begin
    id := GetMenuItemID(hSubMenu, 0); // 1st Item in that sub menu (must not be a submenu itself)
    if id > -1 then
    begin
      PostMessage(hwnd, WM_COMMAND, id, 0); 
      ShowMessage('Done: ' + GetMenuItemCaption(hSubMenu, id));
    end
    else
      RaiseLastOSError;
  end
  else
    RaiseLastOSError;
end; 
```

# iphone - 调整 UITextView 的大小

> ID：728704
> 
> 赞同：27
> 
> 时间：2009-04-08T06:03:05.810
> 
> 标签：iphone, uitextview

我`UITextView`的`UIView`. 添加的textview是不可编辑的，它只是为了显示一些数据。textview 中显示的数据是动态的。那就是行数不固定。它可能会有所不同。所以如果行数增加，textview的大小也需要增加。我不知道该怎么做。请给我一些想法。

**更新：**

这就是我正在做的事情：

```
UIView *baseView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 300, 200)];
baseView.backgroundColor = [UIColor grayColor];
[window addSubview:baseView];

UITextView *textView = [[UITextView alloc] initWithFrame:CGRectMake(5, 30, 100, 30)];
textView.autoresizingMask = UIViewAutoresizingFlexibleHeight;
textView.text = @"asdf askjalskjalksjlakjslkasj";
[textView sizeToFit];
[baseView addSubview:textView]; 
```

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2010-05-17T16:54:48.897

在[How do I size a UITextView to its content? 上发布了一个答案？](https://stackoverflow.com/questions/50467/how-do-i-size-a-uitextview-to-its-content)

```
CGRect frame = _textView.frame;
frame.size.height = _textView.contentSize.height;
_textView.frame = frame; 
```

或更好（考虑到 contentInset 感谢 kpower 的评论）

```
CGRect frame = _textView.frame;
UIEdgeInsets inset = textView.contentInset;
frame.size.height = _textView.contentSize.height + inset.top + inset.bottom;
_textView.frame = frame; 
```

注意：如果您要多次引用对象的属性（例如 frame 或 contentInset），最好将其分配给局部变量，这样您就不会触发额外的方法调用（_textView.frame/[_textView frame] are method来电）。如果您多次调用此代码（100000 次），那么这将明显变慢（十几个方法调用是微不足道的）。

但是...如果您想在没有额外变量的情况下在一行中执行此操作，那将是

```
_textView.frame = CGRectMake(_textView.frame.origin.x, _textView.frame.origin.y, _textView.frame.size.width, _textView.contentSize.height + _textView.contentInset.top + _textView.contentInset.bottom); 
```

以 5 次额外的方法调用为代价。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-04-08T09:33:45.927

您可以使用`setFrame:`或`sizeToFit`。

**更新：**

我使用`sizeToFit`with `UILabel`，它工作得很好，但`UITextView`它是 的子类`UIScrollView`，所以我可以理解为什么`sizeToFit`不能产生预期的结果。

您仍然可以计算文本高度并使用，但如果文本太长`setFrame`，您可能想利用's 滚动条。`UITextView`

以下是获取文本高度的方法：

```
#define MAX_HEIGHT 2000

NSString *foo = @"Lorem ipsum dolor sit amet.";
CGSize size = [foo sizeWithFont:[UIFont systemFontOfSize:14]
              constrainedToSize:CGSizeMake(100, MAX_HEIGHT)
                  lineBreakMode:UILineBreakModeWordWrap]; 
```

然后你可以用你的`UITextView`：

```
[textView setFont:[UIFont systemFontOfSize:14]];
[textView setFrame:CGRectMake(5, 30, 100, size.height + 10)]; 
```

或者您可以先进行高度计算并避开这`setFrame`条线：

```
UITextView *textView = [[UITextView alloc] initWithFrame:CGRectMake(5, 30, 100, size.height + 10)]; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-08-07T19:16:38.440

### sizeToFit 确实有效

如果在第一次调整文本大小后调用 sizeToFit。因此，在您第一次设置它之后，对设置文本的后续调用将不会导致大小发生变化。即使您调用 sizeToFit。

但是，您可以强制它像这样调整大小：

1.  设置文本。
2.  将 textView 框架高度更改为 CGFLOAT_MAX。
3.  调用 sizeToFit。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-11-04T18:21:11.227

`textView.contentSize.height`在文本实际增长*后*`textViewDidChange`只能调整大小。为了获得最佳视觉效果，最好事先调整大小。几个小时后，我想出了如何让它和 Instagram 一样完美（它拥有所有 BTW 中最好的算法）

 *用这个初始化：

```
 // Input
    _inputBackgroundView = [[UIImageView alloc] initWithFrame:CGRectMake(0.0f, size.height - _InputBarHeight, size.width, _InputBarHeight)];
    _inputBackgroundView.autoresizingMask = UIViewAutoresizingNone;
   _inputBackgroundView.contentMode = UIViewContentModeScaleToFill;
    _inputBackgroundView.userInteractionEnabled = YES;
    [self addSubview:_inputBackgroundView];
   [_inputBackgroundView release];

   [_inputBackgroundView setImage:[[UIImage imageNamed:@"Footer_BG.png"] stretchableImageWithLeftCapWidth:80 topCapHeight:25]];

    // Text field
    _textField = [[UITextView alloc] initWithFrame:CGRectMake(70.0f, 0, 185, 0)];
   _textField.backgroundColor = [UIColor clearColor];
    _textField.delegate = self;
   _textField.contentInset = UIEdgeInsetsMake(-4, -2, -4, 0);
   _textField.showsVerticalScrollIndicator = NO;
   _textField.showsHorizontalScrollIndicator = NO;
    _textField.font = [UIFont systemFontOfSize:15.0f];
    [_inputBackgroundView addSubview:_textField];
   [_textField release];

   [self adjustTextInputHeightForText:@""]; 
```

填充 UITextView 委托方法：

```
- (void) textViewDidBeginEditing:(UITextView*)textView {

   [self adjustTextInputHeightForText:_textField.text];
}

- (void) textViewDidEndEditing:(UITextView*)textView {

   [self adjustTextInputHeightForText:_textField.text];
}

- (BOOL) textView:(UITextView*)textView shouldChangeTextInRange:(NSRange)range replacementText:(NSString*)text {

   if ([text isEqualToString:@"\n"])
   {
      [self performSelector:@selector(inputComplete:) withObject:nil afterDelay:.1];
      return NO;
   }
   else if (text.length > 0)
   {
      [self adjustTextInputHeightForText:[NSString stringWithFormat:@"%@%@", _textField.text, text]];
   }
   return YES;
}

- (void) textViewDidChange:(UITextView*)textView {

   [self adjustTextInputHeightForText:_textField.text];
} 
```

诀窍是...

```
- (void) adjustTextInputHeightForText:(NSString*)text {

   int h1 = [text sizeWithFont:_textField.font].height;
   int h2 = [text sizeWithFont:_textField.font constrainedToSize:CGSizeMake(_textField.frame.size.width - 16, 170.0f) lineBreakMode:UILineBreakModeWordWrap].height;

   [UIView animateWithDuration:.1f animations:^
   {
      if (h2 == h1)
      {
         _inputBackgroundView.frame = CGRectMake(0.0f, self.frame.size.height - _InputBarHeight, self.frame.size.width, _InputBarHeight);
      }
      else
      {
         CGSize size = CGSizeMake(_textField.frame.size.width, h2 + 24);
         _inputBackgroundView.frame = CGRectMake(0.0f, self.frame.size.height - size.height, self.frame.size.width, size.height);
      }
      CGRect r = _textField.frame;
      r.origin.y = 12;
      r.size.height = _inputBackgroundView.frame.size.height - 18;
      _textField.frame = r;

   } completion:^(BOOL finished)
   {
      //
   }];
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-07-19T20:45:50.763

这对我来说非常有效：

```
#define MAX_HEIGHT 2000     
CGSize size = [text sizeWithFont:[UIFont systemFontOfSize:14]
      constrainedToSize:CGSizeMake(100, MAX_HEIGHT)
          lineBreakMode:UILineBreakModeWordWrap];

[textview setFont:[UIFont systemFontOfSize:14]];
[textview setFrame:CGRectMake(45, 6, 100, size.height + 10)];
textview.text = text; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-09-30T02:26:50.277

请执行下列操作：

```
_textView.text = someText;
[_textView sizeToFit];
_textView.frame.height = _textView.contentSize.height; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-05-16T13:19:29.490

为了解决类似的问题，我刚刚创建了一个基于自动布局的轻量级 UITextView 子类，它会根据用户输入的大小自动增长和缩小，并且可以受最大和最小高度的约束——所有这些都无需一行代码。

[https://github.com/MatejBalantic/MBAutoGrowingTextView](https://github.com/MatejBalantic/MBAutoGrowingTextView)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-06-04T20:20:51.333

@Gabe 给出的答案似乎直到 viewDidAppear 之后才在 iOS7.1 中起作用。请参阅下面的测试。

更新：实际上，情况更加复杂。如果您在 resizeTheTextView 方法中分配 textView.text，则在 iOS7 中，调整大小相当于只允许单行文本。严重奇怪。

UPDATE2：另请参阅[iOS7 中不同的 UITextView 内容大小](https://stackoverflow.com/questions/19046969/uitextview-content-size-different-in-ios7)

UPDATE3：请参阅最底部的代码了解我现在正在使用的内容。似乎完成了这项工作。

```
#import "ViewController.h"

@interface ViewController ()
{
    UITextView *textView;
}
@end

@implementation ViewController

- (void)viewDidLoad
{
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.

    textView = [[UITextView alloc] initWithFrame:CGRectMake(50, 50, 200, 1)];
    [self.view addSubview:textView];
    CALayer *layer = textView.layer;
    layer.borderColor = [UIColor blackColor].CGColor;
    layer.borderWidth = 1;

    textView.text = @"hello world\n\n";

    // Calling the method directly, after the view is rendered, i.e., after viewDidAppear, works on both iOS6.1 and iOS7.1
    UIButton *button = [UIButton buttonWithType:UIButtonTypeRoundedRect];
    [button setTitle:@"Change size" forState:UIControlStateNormal];
    [button addTarget:self action:@selector(resizeTheTextView) forControlEvents:UIControlEventTouchUpInside];
    [button sizeToFit];
    CGRect frame = button.frame;
    frame.origin.y = 400;
    button.frame = frame;
    [self.view addSubview:button];

    // Works on iOS6.1, but does not work on iOS7.1
    //[self resizeTheTextView];
}

- (void) viewWillAppear:(BOOL)animated
{
    // Does not work on iOS7.1, but does work on iOS6.1
    //[self resizeTheTextView];
}

- (void) viewDidAppear:(BOOL)animated
{
    // Does work on iOS6.1 and iOS7.1
    //[self resizeTheTextView];
}

- (void) resizeTheTextView
{
    NSLog(@"textView.frame.size.height: %f", textView.frame.size.height);

    NSLog(@"textView.contentSize.height: %f", textView.contentSize.height);

    // 5) From https://stackoverflow.com/questions/728704/resizing-uitextview
    CGRect frame = textView.frame;
    UIEdgeInsets inset = textView.contentInset;
    frame.size.height = textView.contentSize.height + inset.top + inset.bottom;
    textView.frame = frame;

    NSLog(@"inset.top: %f, inset.bottom: %f",  inset.top,  inset.bottom);

    NSLog(@"textView.frame.size.height: %f", textView.frame.size.height);

    NSLog(@"textView.contentSize.height: %f", textView.contentSize.height);
}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

@end 
```

更新3：

```
if ([[UIDevice currentDevice] majorVersionNumber] < 7.0) {
    CGRect frame = _abstractTextView.frame;
    UIEdgeInsets inset = _abstractTextView.contentInset;
    frame.size.height = _abstractTextView.contentSize.height + inset.top + inset.bottom;
    _abstractTextView.frame = frame;
}
else {
    CGSize textViewSize = [_abstractTextView sizeThatFits:CGSizeMake(_abstractTextView.frame.size.width, FLT_MAX)];
    _abstractTextView.frameHeight = textViewSize.height;
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-09-07T11:33:48.320

**如果您在其上设置了内容模式**，则将 UITextView 添加到其父级后，它似乎会自动调整大小。

这意味着您无需手动计算高度并应用高度约束。它似乎工作！在 iPad 上的 iOS7 和 iOS8 中测试。

例如

```
--
textView.contentMode = UIViewContentMode.Center;
-- 
```

*如果有人能解释为什么这会起作用，那将不胜感激。我在弄乱界面生成器中的选项时偶然发现了它。*

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-04-10T16:21:56.397

只需设置`scrollEnabled`为`NO`，或取消选中IB 的 Scroll View 部分中的*Scrolling Enabled*`UITextView`和will self-size。

# c - 优雅地加密/解密脚本的建议？[现在在 Sourceforge 上]

> ID：728706
> 
> 赞同：0
> 
> 时间：2009-04-08T06:04:05.323
> 
> 标签：c, unix, encryption, scripting

**更新2：**

感谢您的输入。我已经实现了该算法，它可以在[SourceForge](https://sourceforge.net/projects/shellcrypt/)下载。这是我的第一个开源项目，所以请多多包涵。

**更新：**

我不确定我是否足够清楚，或者对此做出回应的每个人都了解贝壳如何消耗 #! 输入类型。值得一看的好书是 Advanced Unix Programming。如此处所示，调用 popen 并提供其标准输入就足够了[。](https://stackoverflow.com/questions/790475/how-can-a-shell-encryption-program-use-less-user-time)

**原始问题：**

我们的脚本在具有许多用户的高度分布式环境中运行。由于许多原因，使用权限来隐藏它们是有问题的。

由于第一行可用于指定脚本的“解释器”，因此初始行可用于定义解密器

```
#!/bin/decryptandrun
*(&(*S&DF(*SD(F*SDJKFHSKJDFHLKJHASDJHALSKJD
SDASDJKAHSDUAS(DA(S*D&(ASDAKLSDHASD*(&A*SD&AS
ASD(*A&SD(*&AS(D*&AS(*D&A(SD&*(A*S&D(A*&DS 
```

鉴于我可以编写脚本来加密并放置我想要解密脚本的适当标题（它本身可能有一个解释器行，例如 #!/bin/perl 在它的顶部）而不做任何愚蠢的事情，比如把它写出来到一个临时文件。我发现了一些愚蠢的商业产品来做到这一点。我认为这可以在几个小时内完成。是否有一种众所周知的方法可以使用管道而不是对系统调用进行编码？我正在考虑使用[execvp](http://linux.about.com/library/cmd/blcmdl3_execvp.htm)但替换当前进程还是创建子进程更好？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T06:34:06.030

如果您的用户可以执行decryptandrun 程序，那么他们就可以读取它（以及它需要读取的任何文件，例如解密密钥）。所以他们可以只提取代码来自己解密脚本。

您可以通过制作 decrtyptandrun suid 来解决此问题。但是，其中的任何错误都可能导致用户获得 root 权限（或者至少是拥有解密密钥的帐户的权限）。所以这可能不是一个好主意。当然，如果您不遗余力地隐藏这些解密脚本的内容或密钥，使它们对用户不可读......那么为什么不能对脚本的内容做同样的事情呢？ '试图隐藏？

此外，您不能将`#!`解释的可执行文件作为另一个`#!`解释的可执行文件的解释器。

密码学的基本规则之一是，除非您是经验丰富的密码分析家，否则不要发明自己的加密算法（或工具）。

这让我想知道为什么您觉得需要加密您的用户将运行的脚本。他们看到脚本的内容有什么问题吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T07:18:11.480

[布赖恩坎贝尔的回答](https://stackoverflow.com/questions/728706/recommendations-for-encrypting-decrypting-scripts-elegantly/728767#728767)有正确的想法，我会拼出来：

您需要使您的脚本不可读但可由用户 ( `jbloggs`) 执行，并设置`decodeandrun`setuid。您可以将其设为 setuid root，但将其设为某个组的 setgid 会更安全`decodegroup`，然后将脚本文件的组设置为`decodegroup`. 您需要确保`decodegroup`对脚本文件具有读取和执行权限，并且`jbloggs`不是该组的成员。

请注意，`decodegroup`需要读取权限`decodeandrun`才能读取脚本文件的文本。

有了这个设置，就可以（至少在 Linux 上）`jbloggs`执行脚本但不查看它。但是请注意，这*使得解密过程本身变得不必要*——脚本文件也可能是明文，因为`jbloggs`无法读取它。

**[更新：刚刚意识到这个策略不能处理加密内容本身就是一个以 . 开头的脚本的情况`#!`。那好吧。]**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T15:21:17.407

你正在解决错误的问题。问题是您拥有不希望用户访问的数据，并且该数据存储在用户可以访问的位置。首先尝试解决用户访问权限超出其要求的问题...

如果您不能保护整个脚本，您可能只想研究保护数据。将其移至单独的位置并加密。使用只能由特定 ID（最好不是 root）访问的密钥加密数据，并编写一个小的 suid 程序来访问数据。在您的 setuid 程序中，验证谁应该运行该程序，并比较调用程序的名称/校验和（您可以结合调用进程的 cwd 检查进程的命令行以查找路径，使用 lsof或 /proc 文件系统）在解密之前具有预期值。

如果需要更多，您确实需要重新评估系统上用户的状态——他们要么拥有太多的访问权限，要么您的信任度太低。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T06:35:25.310

您链接的所有`exec()`-family 函数都接受文件名，而不是内存地址。我完全不确定你将如何做你想做的事，即在解密例程中“挂钩”，然后重定向到解密脚本的 #! 口译员。

这将要求您将脚本解密为临时文件，并将该文件名传递给`exec()`调用，但您（非常合理地）说您不想通过将脚本放在临时文件中来公开脚本。

如果可以告诉内核用内存中的现有进程替换一个新进程，那么您将有一条路可走，但据我所知，它不是。所以我认为做这个“链式”不会很容易#！下列的。

# iphone - 这是使用 AVAudioPlayer 的正确方法吗，我的代码看起来正确吗？

> ID：728717
> 
> 赞同：2
> 
> 时间：2009-04-08T06:11:27.303
> 
> 标签：iphone

考虑代码：

```
 soundFilePath = [[NSBundle mainBundle] pathForResource: @"Sound"    ofType: @"wav"];    
    fileURL = [[NSURL alloc] initFileURLWithPath: soundFilePath];   
    avPlayerNextLevel = [[AVAudioPlayer alloc] initWithContentsOfURL: fileURL  error: nil];
    avPlayerNextLevel1.volume = volume ;
    [soundFilePath release];
    [fileURL release]; 
```

播放声音然后我做

```
 if([avPlayerNextLevel prepareToPlay]){
        [avPlayerNextLevel play];
    } 
```

我在游戏中多次这样做。有时在模拟器上，声音停止播放。有时我用 AvAudioPlayer 检测到内存泄漏。

我的代码看起来一切正常吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-03T18:08:08.077

您需要释放您创建的 AVAudioPlayer 实例。由于上面的代码将委托设置为self，只需实现以下方法并在那里释放：

```
 - (void)audioPlayerDidFinishPlaying:(AVAudioPlayer *)player successfully:(BOOL)flag {
    NSLog(@"Audio finished playing.");
    [player release];
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T07:21:17.960

1.  为什么要`release`使用**非**拥有引用 ( `soundFilePath`)？
2.  `prepareToPlay`如果您要立即调用，则无需手动操作`play`。

引用文档`play`：

> **讨论**
> 
> 如果音频播放器尚未准备好播放，则调用此方法会隐式调用 prepareToPlay 方法。

就个人而言，我这样做：

```
NSURL *soundUrl = [NSURL fileURLWithPath:
                   [[NSBundle mainBundle] pathForResource:track
                                                   ofType:nil]];
audioPlayer = [[AVAudioPlayer alloc] initWithContentsOfURL:soundUrl
                                                     error:nil];
[audioPlayer setDelegate:self];
[audioPlayer play]; 
```

Where `audioPlayer`is an `ivar`and`track`是我之前从配置下一首歌曲播放的地方获得`lvar`的类型。`NSString*`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T06:40:09.250

我一直在研究类似的东西，但我使用的代码略有不同。不幸的是，我遇到了内存泄漏，因此我决定尝试一下您发布的代码。结果相同：当我调用 [audioPlayer play] 时，内存再次泄漏；

我真的不知道发生了什么。当涉及 AVAudioPlayer 时，你们是否知道任何内存泄漏？

# algorithm - 索引句子的最佳算法

> ID：728724
> 
> 赞同：5
> 
> 时间：2009-04-08T06:13:58.560
> 
> 标签：algorithm, search, indexing, seo

想象一下，我有一个需要索引句子的情况。让我更深入地解释一下。

**例如我有这些句子：**

1.  美丽的天空。
2.  美丽的天空之梦。
3.  美好的梦。

据我想象，索引应该是这样的：

[替代文字 http://img7.imageshack.us/img7/4029/indexarb.png](http://img7.imageshack.us/img7/4029/indexarb.png)

但我也想通过这些词中的任何一个进行搜索。

例如，如果我通过“the”进行搜索，它应该显示给我与“beautiful”的联系。如果我通过“美丽”进行搜索，它应该给我与（上一个）“The”、（下一个）“天空”和“梦想”的联系。如果我按“天空”搜索，它应该（以前）连接到“美丽”等......

有任何想法吗 ？也许您知道针对此类问题的现有算法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T06:51:58.110

**简答**

创建一个具有两个前向/前向链接向量的结构。然后将单词结构存储在哈希表中，键作为单词本身。

**长答案**

这是一个语言解析问题，除非您不介意胡言乱语，否则不容易解决。

1.  我去了公园篮球场。
2.  你能把车停好。

您的链接算法将创建如下句子：

1.  我开车去公园。
2.  你会停车篮球场。

我不太确定这方面的 SEO 应用程序，但我不欢迎另一个乱七八糟的垃圾邮件网站占用搜索结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T07:18:37.140

我想你会想要某种[倒排索引](http://en.wikipedia.org/wiki/Inverted_index)结构。您将拥有一个 Hashmap，其中单词作为键指向表单对的列表`(sentence_id, position)`。然后，您可以将句子存储为数组或链表。您的示例如下所示：

```
sentence[0] = ['the','beautiful', 'sky'];
sentence[1] = ['beautiful','sky', 'dream'];
sentence[2] = ['beautiful', 'dream'];

inverted_index = 
{
 'the': {(0,0)},
 'beautiful': {(0,1), (1,0), (2,0)},
 'sky' : {(0,2),(1,1)},
 'dream':{(1,2), (2,1)}
}; 
```

使用这种结构查找单词可以在恒定时间内完成。在确定了您想要的单词后，也可以在恒定时间内找到给定句子中的前一个和后一个单词。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T06:21:55.373

您可以尝试挖掘由句子组成的[马尔可夫链。](http://en.wikipedia.org/wiki/Markov_chain)您还需要双向链（即查找下一个和上一个单词），即存储可能出现在给定之后或之前的单词。

当然，马尔可夫链是生成内容的随机过程，但是也可以使用类似的方法来存储您需要的信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T06:25:17.970

看起来它可以存储在一个非常简单的数据库中，其中包含以下表格：

```
Words:
    Id     integer primary-key
    Word   varchar(20)
Following:
    WordId1 integer foreign-key Words(Id) indexed
    WordId2 integer foreign-key Words(Id) indexed 
```

然后，每当你解析一个句子时，只需插入那些不存在的句子，如下所示：

```
The beautiful sky.
    Words (1,'the')
    Words (2, 'beautiful')
    Words (3,, 'sky')
    Following (1, 2)
    Following (2, 3)
Beautiful sky dream.
    Words (4, 'dream')
    Following (3, 4)
Beautiful dream.
    Following (2, 4) 
```

然后，您可以尽情地查询其他单词之后或之前的单词。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T06:21:19.900

使用[关联数组](http://www.comp.leeds.ac.uk/Perl/associative.html)可以让您在 Perl 中快速解析句子。它比您预期的要快得多，并且可以有效地将其转储到树状结构中，以供更高级别的语言随后使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T07:12:33.550

这应该让你接近，在 C# 中：

```
class Program
{
    public class Node
    {
        private string _term;
        private Dictionary<string, KeyValuePair<Node, Node>> _related = new Dictionary<string, KeyValuePair<Node, Node>>();

        public Node(string term)
        {
            _term = term;
        }

        public void Add(string phrase, Node previous, string [] phraseRemainder, Dictionary<string,Node> existing)
        {
            Node next= null;
            if (phraseRemainder.Length > 0)
            {
                if (!existing.TryGetValue(phraseRemainder[0], out next))
                {
                    existing[phraseRemainder[0]] = next = new Node(phraseRemainder[0]);
                }
                next.Add(phrase, this, phraseRemainder.Skip(1).ToArray(), existing);
            }
            _related.Add(phrase, new KeyValuePair<Node, Node>(previous, next));

        }
    }

    static void Main(string[] args)
    {
        string [] sentences = 
            new string [] { 
                "The beautiful sky",
                "Beautiful sky dream",
                "beautiful dream"
            };

        Dictionary<string, Node> parsedSentences = new Dictionary<string,Node>();

        foreach(string sentence in sentences)
        {
            string [] words = sentence.ToLowerInvariant().Split(' ');
            Node startNode;
            if (!parsedSentences.TryGetValue(words[0],out startNode))
            {
                parsedSentences[words[0]] = startNode = new Node(words[0]);
            }
            if (words.Length > 1)
                startNode.Add(sentence,null,words.Skip(1).ToArray(),parsedSentences);
        }
    }
} 
```

我冒昧地假设您想保留实际的初始短语。在此结束时，您将获得短语中的单词列表，并且在每个短语中，都有一个使用该单词的短语列表，并引用每个短语中的下一个和前一个单词。

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2009-04-08T06:16:05.373

树搜索算法（如 BST 等）

# php - 将函数从外部文件动态加载到类中

> ID：728731
> 
> 赞同：2
> 
> 时间：2009-04-08T06:17:21.623
> 
> 标签：php, class

是否可以在 php 中加载一个函数，比如从外部文件中包含在一个类中。我正在尝试为辅助函数创建一个加载器，以便我可以调用：

```
$registry->helper->load('external_helper_function_file'); 
```

之后它应该能够像这样调用文件中的函数：

```
$registry->helper->function(); 
```

谢谢你的帮助

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T09:34:45.847

抛开意见，这是很好的 OOP 设计。即使使用当前版本的 PHP 也是可能的，尽管不像 PHP5.3 那样干净。

```
class Helper {
    /* ... */
    function load($file) {
      include_once($file);
    }
    function __call($functionName, $args) {
       if(function_exists($functionName))  
         return call_user_func_array($functionName, $args);
    }

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T09:25:45.290

好的，第一，我同意这是不礼貌的。此外，在 5.3 中，您可以使用带有 __call 魔术字的新闭包语法将运算符用作函数（JS 风格）。

现在，如果我们想以您的方式提供一种方法，我可以考虑使用 create_fnuction 和 __call 魔法。

基本上，您使用正则表达式模式将函数转换为兼容的字符串，并将它们放在私有成员中。比你使用 __call 方法来获取它们。我正在做一个小演示。

好的，下面是课程。我从几周前看到的一个使用闭包来实现 JS 样式对象的类中获得灵感：

```
/**
 * supplies an interface with which you can load external functions into an existing object
 * 
 * the functions supplied to this class will recive the classes referance as a first argument, and as 
 * a second argument they will recive an array of supplied arguments.
 * 
 * @author arieh glazer <arieh.glazer@gmail.com>
 * @license MIT like 
 */
class Function_Loader{
    /**
     * @param array holder of genarated functions
     * @access protected
     */
    protected $_funcs = array();

    /**
     * loads functions for an external file into the object
     * 
     * a note- the file must not contain php tags.
     * 
     * @param string $source a file's loaction
     * 
     * @access public
     */
    public function load($source){
        $ptrn = '/function[\s]+([a-zA-Z0-9_-]*)[\s]*\((.*)\)[\s]*{([\w\s\D]+)}[\s]*/iU';
        $source = file_get_contents($source);
        preg_match_all($ptrn,$source,$matches);
        $names = $matches[1];
        $vars = $matches[2];
        $funcs = $matches[3];
        for ($i=0,$l=count($names);$i<$l;$i++){
            $this->_funcs[$names[$i]] = create_function($vars[$i],$funcs[$i]);
        }
    }

    public function __call($name,$args){
        if (isset($this->_funcs[$name])) $this->_funcs[$name]($this,$args);
        else throw new Exception("No Such Method $name");
    }
} 
```

限制 - 1st，源不能有任何 php 标签。第二，功能永远是公开的。第三——我们只能模仿$this。我所做的是将 $this 作为第一个参数传递，第二个是参数数组（这是第四个限制）。此外，您将无法从类中访问非公共成员和方法。源文件的示例：

```
function a($self,$arr=array()){
    //assuming the object has a member called str
    echo $self->str;
} 
```

这对我来说是一个有趣的练习，但总的来说是一个不好的做法

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T06:41:42.050

所以你想要的不仅仅是`include`一个文件，而是`include`一个对象的范围？

...

我认为你的做法是错误的。`registry`如果对象具有一系列具有自己功能的辅助成员，则更有意义。最终结果可能如下所示：

```
$registry->aHelper->aFunction();
$registry->aDifferentHelper->aDifferentFunction(); 
```

通过仔细使用 {} 语法，您应该能够将成员对象动态添加到您的上帝对象。

在这一点上值得注意的是，一个[上帝对象](http://en.wikipedia.org/wiki/God_object)几乎是一个[反模式](http://en.wikipedia.org/wiki/Anti-pattern)。如果您在全局范围内需要这些功能，请使用引导包含技术，然后将其置于全局范围内。如果您需要传递该数据，则可以根据需要将其传递给函数，或者将其存储在数据库中并在其他地方检索。

我知道上帝对象看起来*确实是个好主意，但我向你保证，它以后会让事情变得一团糟。*

# fonts - 如何为网站选择字体？

> ID：728741
> 
> 赞同：4
> 
> 时间：2009-04-08T06:23:01.550
> 
> 标签：fonts

我不是网页设计师，更像是 Web 应用服务器端开发人员。就像音盲一样，我猜我是字体盲……也许我不知道我需要什么。

当你看脸书时

```
font-family:"lucida grande",tahoma,verdana,arial,sans-serif; 
```

堆栈溢出

```
font-family:Arial,Helvetica,sans-serif; 
```

邮箱

```
font-family:arial,sans-serif; 
```

纽约时报网

```
font-family:georgia,"times new roman",times,serif; 
```

维基百科

```
font-family:sans-serif; 
```

人们如何做出决定？它是页面设计其余部分的一个因素吗？为什么这些网站有如此多的变化？是否有可读性标准？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T06:34:53.190

在这里：

*   [网络字体选择](https://stackoverflow.com/questions/410461/font-typeface-selection-for-the-web)
*   [什么是最易读/最吸引人的字体](https://stackoverflow.com/questions/340923/what-is-the-most-readable-appealing-font)

否则很重要的一点是，对于网络来说，只有非常有限的字体范围，因为为了确保人们看到您希望他们看到的内容，您必须选择每个人系统上都有的字体。

[编辑] 由于这个答案已被接受，我想我应该改进它。

我最近发现博客条目[对网络字体](http://dustinbrewer.com/fonts-on-the-web-and-a-list-of-web-safe-fonts/)和不同的操作系统有一个非常有用的概述。

此外，很好地解释了[网络字体的解剖结构](http://www.sitepoint.com/article/anatomy-web-fonts/)。

### Cool&new：动态文本替换

对于需要为例如 h1 甚至 h2 标签实现非标准字体的网站来说，一项非常酷的新技术是[sIFR](http://www.mikeindustries.com/blog/sifr/)。这篇[博文](http://www.netmag.co.uk/zine/home/dynamic-text-replacement)展示了它是如何实现的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T06:31:19.547

那么，您应该做出的第一个也是最重要的决定是您是否想要带有[serifs](http://en.wikipedia.org/wiki/Serif)或[sans-serif 的字体](http://en.wikipedia.org/wiki/Sans-serif)。在印刷媒体中，衬线字体更适合长文本，但大多数人更喜欢计算机上的无衬线字体。正如向我解释的那样，衬线是眼睛可以抓住的一种锚，因此使用衬线字体更容易阅读大文本。对于大文本，无衬线字体往往会使眼睛疲劳。

关于实际字体，我想这更取决于个人喜好。

最重要的是，建议一个网站最多使用 2 或 3 种不同的字体。否则，它会破坏网站的一致性和易用性。在这种情况下，少即是多。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T18:05:13.013

无论您选择哪种字体，您的声明都应以 ,sans-serif; 结尾。,衬线; 或者，等宽；因为这些是保证用户代理呈现的唯一 3 个。

Arial、verdana、times 和 courier 已经在我使用过的每一个商业浏览器上呈现。我知道 Linux 上的开源浏览器通常不会有 verdana。

佐治亚州、塔霍马州等完全是一场赌博，我会远离或有更常见的备份。我相信您知道浏览器会选择它可以在列表中呈现的第一个字体。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-23T02:13:42.770

Facebook 的字体声明似乎有点过分，除了 Lucide Grande 通常出现在 Mac OS 和 Windows 上的 Tahoma 之外。如果你想安全地使用它，在大多数操作系统（如 Arial、Verdana 或 Times New Roman）上找到的单一字体就可以了，然后是通用字体（serif、sans-serif、monospace），它告诉浏览器选择合适的如果找不到指定的字体，则要渲染的字体。[w3schools.com - http://www.w3schools.com/css/css_font.asp](http://www.w3schools.com/css/css_font.asp)是学习 Web 字体和 CSS 的一个很好的资源。

就可读性而言 - 衬线字体在字母形式的末端几乎没有细节，称为衬线，有助于填充字母之间的空间，使眼睛更容易水平跟踪文本。传统上，无衬线字体被认为更容易在屏幕上阅读，但这是由于旧版 Web 浏览器对衬线的渲染效果不佳。现代网络浏览器使用操作系统级别的抗锯齿（平滑）来更准确地呈现字体。

无论您做出何种选择，您都应该考虑使用 serif 和 sans-serif 字体的组合来帮助在您的网页上建立强大的信息层次结构。例如，您可以为标题选择衬线字体，为正文选择无衬线字体。

# installation - InstallShield PackageForTheWeb 兼容性

> ID：728743
> 
> 赞同：0
> 
> 时间：2009-04-08T06:23:15.777
> 
> 标签：installation, installshield

经典的 InstallShield PFT 4.00 包装器是否仍在使用现代操作系统，一位客户报告了一个错误，我不确定它是否与 PFT 相关：

“程序不是有效的 32 位程序。”

这是系统信息：Microsoft Windows XP Media Center Edition Version 2002 Service Pack 3。2.8 Ghz 1GB RAM

PFT 包装的 setupper 可以很好地与普通 XP 和 Vista 配合使用。

PFT 被称为 setup.exe 并且有自动运行： [autorun] open=setup.exe icon=setup.exe,0

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-05T15:45:51.230

是的，经典的 pftw 包装器适用于现代操作系统，尽管我无法确定 Windows 7，因为我没有尝试过。媒体中心与程序无法运行的 XP 没有什么不同，这听起来更像是有人通过设置为 ascii 的 ftp 连接下载...

# unit-testing - 当修复涉及更改被测方法的签名时如何使用 TDD？

> ID：728747
> 
> 赞同：8
> 
> 时间：2009-04-08T06:25:21.513
> 
> 标签：unit-testing, refactoring, tdd, methodology

我试图了解 TDD 方法并遇到了 - 我认为是 - 一个先有鸡还是先有蛋的问题：如果错误修复涉及更改方法的签名该怎么办。

考虑以下方法签名：

```
string RemoveTokenFromString (string delimited, string token) 
```

顾名思义，此方法删除 a `token`from的所有实例`delimited`并返回结果字符串。

后来我发现这个方法有一个错误（例如从字符串中删除了错误的位）。所以我写了一个测试用例来描述错误发生的场景，并确保测试失败。

在修复 bug 时，我发现该方法需要更多信息才能正常工作——而这部分信息只能作为参数发送（被测方法是静态类的一部分）。

那我该怎么办？如果我修复了这个错误，这会迫使我改变单元测试——那会是“正确的”TDD 方法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T17:41:28.047

你陷入了 TDD 中最危险的陷阱：你认为 TDD 是关于测试的，但事实并非如此。但是，很容易掉入这个陷阱，因为 TDD 中的所有术语都是关于测试的。这就是发明 BDD 的原因：它本质上是 TDD，但没有令人困惑的术语。

在 TDD 中，测试并不是真正的测试，它们只是示例。断言并不是真正的断言，它们是期望。而且您不是在处理单位，而是在处理行为。BDD 只是这样称呼他们。（注意：BDD 自最初发明以来一直在发展，现在它包含了不属于 TDD 的内容，但最初的意图只是“很多人做错了 TDD，所以用不同的词来帮助他们做对”。 )

无论如何，如果您认为测试不是测试，而是该方法应该如何工作的行为示例，那么随着您对预期行为的更好理解，删除或更改测试不仅允许TDD，是*唯一正确的选择*！永远记住这一点！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T06:39:20.993

当您发现单元的预期行为发生变化时，轰炸您的测试绝对没有错。

```
//Up front
[Test]
public void should_remove_correct_token_from_string()
{
  var text = "do.it.correctly..";
  var expected = "doitcorrectly";
  Assert.AreEqual(StaticClass.RemoveTokenFromString(text, "."), expected);
}

//After finding that it doesn't do the right thing
//Delete the old test and *design* a new function that
//Does what you want through a new test
//Remember TDD is about design, not testing!
[Test]
public void should_remove_correct_token_from_string()
{
  var text = "do.it.correctly..";
  var expected = "doitcorrectly";
  Assert.AreEqual(
      StaticClass.RemoveTokenFromString(
          text,
          ".",
          System.Text.Encoding.UTF8), expected);
}

//This will force you to add a new parameter to your function
//Obviously now, there are edge cases to deal with your new parameter etc.
//So more test are required to further design your new function 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-08T06:45:49.637

把事情简单化。

如果你的单元测试是错误的或过时的，你必须重写它。如果您的规格发生变化，或者某些规格不再相关，您的单元测试必须反映这一点。

红色、绿色、重构*也*适用于您的单元测试，而不仅仅是您正在测试的代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T06:41:24.750

有一个称为[Add Parameter的](http://sourcemaking.com/refactoring/add-parameter)**重构**可以在这里提供帮助。

如果您的语言支持[方法重载](http://en.wikipedia.org/wiki/Method_overloading)，您可以先使用新参数创建新函数，复制现有函数的主体并修复您的问题。

然后当问题解决后，您可以一一修改所有测试，以调用新方法。最后，您可以删除旧方法。

使用不支持方法重载的语言，创建一个具有不同名称的新函数，在该新函数中复制现有函数的主体，让现有函数调用新函数，可能为新参数使用一个虚拟值。然后，您可以通过所有测试。让您的旧测试一一调用新功能。当不再使用旧方法时，可以将其删除并重命名新功能。

这有点过程广泛，但我认为这*是*遵循红绿重构的 TDD 方式。

如果可用，参数的默认值也可能有所帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T06:29:54.340

红色，绿色，重构。

无论你做什么，你首先要达到一个状态，即你有一个正在编译但失败的测试用例重现了这个错误。然后，您可以继续将参数添加到测试和实现中，但不对其进行任何操作，因此您仍然拥有 Red。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T07:59:52.080

我想说不要担心“正确”/“正确”的方式......任何可以帮助您更快地接近解决方案的方法。

如果你发现你需要接受一个额外的参数，

*   更新测试用例中的调用
*   将新参数添加到实际方法中
*   验证您的代码是否构建并且测试再次失败。
*   继续使其成为绿色。

只有在添加新参数会导致无数编译错误的情况下，我才会推荐 - 采取小步骤......你不想在发现你真的不需要第三个参数之前更新整个源代码库或你需要第四个……时间浪费了。因此，在更新所有引用之前，让新版本的方法“工作”。（正如菲利普在这里所说）

*   使用添加的参数编写新的重载
*   将旧方法的代码移动到新的重载中
*   使用新参数的一些默认值使旧的过载中继或委托给新的过载
*   现在您可以回到手头的任务并让新测试变为绿色。
*   如果您不再需要旧的重载，请将其删除并修复产生的编译错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-08T06:37:57.427

如果一种方法不能正确地完成工作，那么它需要被修复，如果修复需要更改签名，那么请注意其中的错误。根据 TDD，您首先编写肯定会失败的测试用例，然后编写满足测试的方法。按照这种方法，如果测试中的方法调用需要一个参数才能运行，那么您需要这样做。

# java - 如何运行 servlet 程序？

> ID：728748
> 
> 赞同：0
> 
> 时间：2009-04-08T06:25:48.767
> 
> 标签：java

如何运行 servlet 程序？如何设置类路径？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T06:32:27.860

请阅读此[http://www.jsptube.com/servlet-tutorials/simple-servlet-example.html](http://www.jsptube.com/servlet-tutorials/simple-servlet-example.html)了解您的第一步。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T06:31:03.027

好吧，您通常在 Websphere Application Server 或 Tomcat 等 servlet 容器中运行它。您配置类路径的方式取决于您选择的 servlet 容器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T07:10:36.007

只是重复一下基础知识：servlet 是一段运行在 servlet 容器（即专用 Web 服务器）中的 Java 代码。它侦听客户端请求（通常通过 Web 浏览器发出）并用响应（例如 HTML 页面）来回答它们。

因此，“运行”一个 servlet 可能意味着两种不同的东西：

1.  将 servlet 部署到 servlet 容器（从而使其监听请求），或
2.  实际上使它处理客户请求

(1) 是通过将 servlet 代码（+ 3rd 方库）打包到[war](http://en.wikipedia.org/wiki/WAR_(Sun_file_format))文件中并将此 Web 应用程序存档部署到服务器来实现的——详细信息可能因 servlet 容器的类型而异。`http://localhost:8080/servletexample`(2) 通过发出 http 请求触发，例如通过在浏览器的地址栏中输入 servlet URL（类似）。

# asp.net - 使用 CreateUserWizard 回发

> ID：728749
> 
> 赞同：0
> 
> 时间：2009-04-08T06:25:55.240
> 
> 标签：asp.net, createuserwizard

我在 CreateUserWizard 中有一个 RadUpload 控件。从互联网上的简短搜索，上传需要回发，而 CreateUserWizard 不回发。知道如何让向导回发。或在用户注册期间上传文件的任何其他机制。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T17:41:46.847

我从未将 CreateUserWizard 与 Telerik 一起使用，但正如我在您的另一个 Telerik 问题中指出的那样：将 Telerik 控件放在标准或其他第三方控件中通常不是一个好主意。他们通常对此反应不佳。

如果您需要在另一个组件之上使用 Telerik 组件，我通常会在其中“设计”它们。就像是：

```
<div style="left:200px;top:125px;"><telerik:RadComponent runat="server" something="whatever" /></div> 
```

也就是说，我不确定 CreateUserWizard 是否能够回发。您不能在某处放置一个按钮以在单击时生成回发吗？

# django - 如何在第一次访问字段时生成字段的值？

> ID：728750
> 
> 赞同：0
> 
> 时间：2009-04-08T06:26:10.713
> 
> 标签：django

使用 Django，如何在第一次访问字段时生成字段的值？然后将值存储在字段上。

在我的情况下，它是一个图像，但它可以是我想的任何东西。我需要的是一个在访问字段或包装访问之前运行的函数，并在检查空值时生成它，或类似的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T13:24:33.517

几年来，djangoproject 中有一张[getters and setters票，但没有运气。](http://code.djangoproject.com/ticket/3148)对于您描述的情况，我已经看到了三种常见的方法：

*   将您的模型字段以不同的名称命名，例如，并在您的对象中调用查询该字段`image_field`的 getter/setter 对（使用 python`property`语法） 。`image`这将适用于您的函数随意使用，但来自框架本身的任何调用显然会忽略您的 getter/setter。

*   如果可能的话，创建您自己的[自定义字段](http://docs.djangoproject.com/en/dev/topics/db/models/#custom-field-types)子类来为您工作。

*   按照 ozanonay 的建议覆盖保存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T08:12:43.017

保存对象时是否有任何理由无法执行此操作？因为这很容易通过覆盖相关模型中的 save 方法来实现，例如：

```
def save(self, force_insert=False, force_update=False):
    if not self.image:
        self.image = foo
    super(RelevantModel, self).save(force_insert, force_update) 
```

当然，如果第一次保存对象的时间和第一次访问特定字段的时间之间存在相关差异，那么这并不能解决您的问题。

# asp.net - 如何在文本区域中显示 HTML

> ID：728752
> 
> 赞同：1
> 
> 时间：2009-04-08T06:27:24.020
> 
> 标签：asp.net, html, formatting, richtextbox

亲爱的，我在 nvarchar(max) 字段中保存了格式化文本（粗体，字体，样式等），它用于一些描述字段，在另一个阶段，我希望能够编辑这个描述，所以在编辑页面，我阅读了原始信息，将其填写在字段中并等待用户更改并保存，这适用于各种普通文本字段，也适用于文本区域中显示的普通文本，但是当我用样式文本填充文本区域，它显示 HTML 代码而不是结果，例如，它显示：

```
<span style="font-weight: bold; text-decoration: line-through;">SM</span><span style="background-color: rgb(51, 102, 255);">ART</span><br> 
```

任何关于如何使 textArea（模式设置为多行的普通 asp.net 文本框）显示 HTML 的建议而不是它应该看起来的样子，而不是它应该看起来的样子，而不是代码？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T06:30:50.343

你需要一个所见即所得的编辑器，比如 tinyMCE [http://tinymce.moxiecode.com/](http://tinymce.moxiecode.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T06:47:31.460

您不能在 TextArea/TextBox 控件中显示 HTML 结果。但是要显示 HTML 结果，您有很多选择。

正如 Schnalle 所说，使用编辑器的最佳且最简单的方法。像 tinyMCE 或 FCKEditor。

在一个项目中，我使用 div 来显示和编辑 HTML 内容。它允许用户编辑、复制、粘贴、粗体、斜体、.. 等：

```
<div runat="server" ID="divContent" contenteditable="true"> 
    Editable Area, set your content here...
</div> 
```

也许你可以结合 textarea 和 div 做你想做的事。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-17T19:45:35.767

如果您只想让它显示代码，请使用 < 作为 <, 和 > 作为 >。例如：

```
<textarea>
&lt;html&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</textarea> 
```

# seo - URL缩短会影响页面排名吗？

> ID：728755
> 
> 赞同：2
> 
> 时间：2009-04-08T06:29:14.373
> 
> 标签：seo, pagerank, url-shortener

最近有很多关于 URL Shortening 的炒作。我猜一些 URL Shortening 服务甚至提供跟踪统计信息。但是，在原始 URL 中添加更多级别的查找不会以任何方式影响页面排名吗？只是好奇想知道。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-08T06:58:48.827

IT 依赖于 URL 缩短服务的实现。如果他们在重定向中使用 HTTP 301 和/或 HTTP 302，那么 Google 可以很好地根据 Page Rank 正确解释这些内容。但是，其他参数可能会受到 URL 缩短的影响。

大多数搜索引擎使用锚文本和 URL 文本作为为特定 URL 提供点击的参数。如果 URL 从[http://example.com/some-article-about-C](http://example.com/some-article-about-C)更改为[http://example.com/234432](http://example.com/234432) ，那么显然第一个为搜索引擎提供了更多信息，这将使其在搜索引擎中表现更好“文章”和“c”...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T06:45:54.583

现在可能，但我不希望这种情况持续太久。SEO 和 PageRank 是许多猜测被当作智慧传递的主题。

如果您非常担心您的 PageRank，那么您可以这样做。将这种能量投入到创建人们想要链接的内容中。你会得到更好的结果。

人们买东西。机器人不会。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T07:04:26.050

好吧，我可以告诉您一件事*不会*影响您的 PageRank - 使用 DNS 的 URL 缩短器。

绝大多数 URL 缩短器使用客户端重定向 - 通过脚本/元刷新，或通过框架。这些可能会影响您的排名，因为它们会改变 Google 看到的内容——您永远不知道。[例如](http://nic.ch.vu)，从[Dot.tk](http://dot.tk)到[PopNIC](http://www.popnic.com/)、[Smartdots](http://smartdots.com)、[JoyNIC](http://www.joynic.com/)、[HomeNIC](http://www.homenic.com/)、[EuropNIC](http://www.europnic.com)、[Tipdots](http://www.tipdots.com)、[DuoNIC](http://duonic.com)、[UnoNIC](http://www.unonic.com/)、[Cydots](http://www.cydots.com/)、[FreeNIC](http://freenic.at)、[Mediadots](http://mediadots.com)、[Ulimit](http://ulimit.com)、[kurzURL](http://kurzurl.de)、[co.nr](http://co.nr)和[de.be/de.vu/ch.vu](http://nic.de.be)。_ [_](http://nic.de.vu)

不过，一些服务正在使用正确的 DNS 进行转发。其中包括[Afraid.org](http://afraid.org)、[co.cc](http://www.co.cc/)、[No-ip](http://no-ip.com)和[Da.ru。](http://da.ru)这对访客和蜘蛛是完全透明的，因此您可以确保它不会影响您的排名。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-17T14:07:07.807

对 URL 缩短的批评已近乎歇斯底里。将其与近乎迷信的 SEO 指导相结合，如果不是彻底的巫术，你会发现很多（错误）信息。[URL 缩短是一场茶杯中的风暴](http://www.cforcoding.com/2009/06/hysteria-over-url-shortening.html)。不要指望它会对搜索引擎产生任何影响。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-28T06:48:06.383

不，它不会影响页面排名。但网址不应链接到色情、viagara 等不良邻居。网址缩短意味着缩短并放置它，而不是放置巨大的网址。您可以尝试[zxc9.com](http://zxc9.com)及其服务 API。

# silverlight - 导致 XamlParseException AG_E_PARSER_BAD_PROPERTY_VALUE 的依赖属性

> ID：728765
> 
> 赞同：0
> 
> 时间：2009-04-08T06:32:51.947
> 
> 标签：silverlight, data-binding, dependency-properties

我创建了两个 UserControl，第一个显示对象列表，第二个显示从第一个中选择的对象的详细信息。我在第一个控件上创建了一个依赖属性，并将每个 UserControl 绑定到我的 Resources 集合中声明的对象。我已经看到博客文章描述了这一点，但似乎无法让它发挥作用。我收到 XamlParseException。有趣的是，只有当我在我的第一个 UserControls 上设置绑定 Mode=TwoWay 时才会出现异常。这是代码...

**页面.xaml**

```
<UserControl.Resources>
    <local:Item x:Key="SelectedItem" />
</UserControl.Resources>

...

<controls:ItemList 
    SelectedItem="{Binding Mode=TwoWay, Source={StaticResource SelectedItem}}">                     
</controls:ItemList >

...

<controls:ItemDetails
    DataContext="{Binding Source={StaticResource SelectedItem}}">                       
</controls:ItemDetails> 
```

**项目列表.xaml.cs**

```
public partial class ItemList: UserControl
{
    public ItemList()
    {
        InitializeComponent();
    }

    public static readonly DependencyProperty SelectedItemProperty =
        DependencyProperty.Register("SelectedItem", typeof(Item), typeof(ItemList), new PropertyMetadata(new Item()));
    public Item SelectedItem
    {
        get { return (Item )GetValue(SelectedItemProperty ); }
        set { SetValue(SelectedItemProperty , value); }
    } 
```

欢迎任何建议！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T21:19:50.783

从外观上看，您的 Xaml 不正确。您缺少一个需要双向绑定的属性。您是说要绑定到源中定义的对象，但您没有指定要绑定到的该资源的属性。在这种情况下，SelectedItem 资源是 Item 类型的对象……您需要绑定到 Item 的属性。因此，如果 item 具有名为 value 的属性，您的 Xaml 可能如下所示：

```
SelectedItem="{Binding Value, Source={StaticResource SelectedItem}, Mode=TwoWay}" 
```

试试这个：

```
SelectedItem="{Binding SelectedItem, Mode=TwoWay}" 
```

ib。

# c++ - 为什么我的文件加载线程没有与主线程并行？

> ID：728773
> 
> 赞同：-1
> 
> 时间：2009-04-08T06:36:19.177
> 
> 标签：c++, multithreading, winapi

我的程序在后台进行文件加载和 memcpy'ing，而屏幕是要以交互方式更新的。这个想法是异步加载程序很快需要的文件，以便在主线程需要它们时可以使用它们。但是，加载/复制似乎不会与主线程并行发生。主线程在加载期间暂停，并且通常会等待所有加载（一次最多 8 个）完成，然后再进行主线程的主循环的下一次迭代。

我使用的是 Win32，所以我使用 _beginthread 来创建文件加载/复制线程。

工作线程函数：

```
void fileLoadThreadFunc(void *arglist)
{
    while(true)
    {
        // s_mutex keeps the list from being updated by the main thread
        s_mutex.lock();  // uses WaitForSingleObject INFINITE
        // s_filesToLoad is a list added to from the main thread
        while (s_filesToLoad.size() == 0)
        {
            s_mutex.unlock();
            Sleep(10);
            s_mutex.lock();
        }
        loadObj *obj = s_filesToLoad[0];
        s_filesToLoad.erase(s_filesToLoad.begin());
        s_mutex.unlock();

        obj->loadFileAndMemcpy();
    }
} 
```

主线程启动：

```
_beginThread(fileLoadThreadFunc, 0, NULL); 
```

主线程用来“踢”线程以加载文件的类中的代码：

```
// I used the commented code to see if main thread was ever blocking
// but the PRINT never printed, so it looks like it never was waiting on the worker
//while(!s_mutex.lock(false))
//{
//  PRINT(L"blocked! ");
//}
s_mutex.lock();
s_filesToLoad.push_back(this);
s_mutex.unlock(); 
```

基于评论的更多注释：

*   工作线程中的 loadFileAndMemcpy() 函数通过 Win32 ReadFile 函数加载 - 这会导致主线程阻塞吗？
*   我将工作线程优先级降低到 THREAD_PRIORITY_BELOW_NORMAL 和 THREAD_PRIORITY_LOWEST，这有点帮助，但是当我移动鼠标以查看工作线程工作时它移动的速度时，鼠标“跳跃”了一下（没有降低优先级，情况更糟）。
*   我在 Core 2 Duo 上运行，所以我不希望看到任何鼠标延迟。
*   互斥代码似乎不是问题，因为“阻塞！” 从未在我上面的测试代码中打印过。
*   我将睡眠时间提高到 100 毫秒，但就鼠标延迟而言，即使 1000 毫秒似乎也无济于事。
*   正在加载的数据很小 - 20k .png 图像（但它们是 2048x2048）.. 它们很小，因为这只是测试数据，图像中只有一种颜色，所以实际数据会大得多。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T21:36:04.923

您将必须显示主线程的代码，以指示如何通知它已加载文件。很可能存在阻塞问题。如果您可以在主循环中使用异步 I/O 而不是线程，这确实是一个很好的案例。如果没有别的，你真的需要使用条件或事件。一个触发文件阅读器线程有工作要做，另一个向主线程发出文件已加载的信号。

编辑：好的，所以这是一个游戏，您正在轮询文件是否已作为渲染循环的一部分完成加载。这是我会尝试的：使用 ReadFileEx 启动重叠读取。这不会阻塞。然后在您的主循环中，您可以通过使用具有零超时的等待函数之一来检查读取是否完成。这也不会阻塞。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T06:41:57.713

不确定你的具体问题，但你*真的*应该互斥保护大小调用。

```
void fileLoadThreadFunc(void *arglist) {
    while (true) {
        s_mutex.lock();
        while (s_filesToLoad.size() == 0) {
            s_mutex.unlock();
            Sleep(10);
            s_mutex.lock();
        }
        loadObj *obj = s_filesToLoad[0];
        s_filesToLoad.erase(s_filesToLoad.begin());
        s_mutex.unlock();
        obj->loadFileAndMemcpy();
    }
} 
```

现在，检查您的具体问题，我看不出您提供的代码有任何问题。*如果互斥锁是它们之间的唯一争用，*主线程和文件加载器线程应该很高兴地并行运行。

我这样说是因为可能存在其他争论点，例如在标准库中，您的示例代码没有显示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T07:01:32.597

我会以这种方式编写该循环，减少可能会搞砸的锁定解锁：P：

```
void fileLoadThreadFunc(void *arglist)
{
    while(true)
    {
        loadObj *obj = NULL;

        // protect all access to the vector
        s_mutex.lock();
        if(s_filesToLoad.size() != 0)
        {
             obj = s_filesToLoad[0];
             s_filesToLoad.erase(s_filesToLoad.begin());
        }
    s_mutex.unlock();

    if( obj != NULL )
            obj->loadFileAndMemcpy();
        else
            Sleep(10);

    }
} 
```

MSDN 关于[同步](http://msdn.microsoft.com/en-us/library/ms810427.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T21:09:54.470

如果您可以考虑开源选项，Java 有一个阻塞队列 [[链接](http://java.sun.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html)]，Python [[链接](http://docs.python.org/library/queue.html)] 也是如此。这会将您的代码减少到（这里的队列绑定到 load_fcn，即使用闭包）

```
def load_fcn():
    while True:
        queue.get().loadFileAndMemcpy()
threading.Thread(target=load_fcn).start() 
```

即使您可能不应该使用它们，python 3.0 线程也有一个 _stop() 函数，python2.0 线程有一个 _Thread__stop 函数。您还可以将“无”值写入队列并签入 load_fcn()。

此外，如果您愿意，可以在 stackoverflow 中搜索“[python] gui”和“[subjective] [gui] [java]”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-29T06:05:16.427

根据目前提供的信息，我的猜测是文件加载处理程序中的某些内容正在与您的主循环交互。我不知道所涉及的库，但根据您的描述，文件处理程序执行以下操作：

*   加载 20k 文件的原始二进制数据
*   将 20k 解释为 PNG 文件
*   加载到表示 2048x2048 像素图像的结构中

关于用于实现这些步骤的库，我想到了以下可能性：

*   可能是未压缩图像数据的内存分配持有主线程执行的任何绘图/交互操作所需的锁？
*   会不会是负责将 PNG 数据转换为像素的调用实际上持有一个低级游戏库锁，它与您的主线程产生不利交互？

获得更多信息的最佳方法是尝试在不使用当前代码的情况下对文件加载器处理程序的活动进行建模......自己编写一个例程，分配正确大小的内存块并执行一些处理，变成 20k源数据到目标块大小的结构中......然后一次一点地向它添加进一步的逻辑，直到在性能崩溃时缩小范围以隔离罪魁祸首。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-29T06:45:45.463

我认为您的问题在于访问 FilesToLoad 对象。

正如我所看到的，这个对象在它实际处理它时被你的线程锁定（根据你的代码，每 10 毫秒一次），并且在它试图更新列表时被你的主线程锁定。这可能意味着您的主线程正在等待一段时间才能访问它和/或操作系统解决了可能发生的任何竞争情况。

我会建议你要么启动一个工作线程，只是在你想要的时候加载一个文件，设置一个信号量（甚至是一个布尔值）来显示它何时完成，或者使用 _beginthreadex 并为每个线程创建一个挂起的线程文件，然后同步它们，以便在每个完成时恢复下一行。

如果您希望一个线程在后台永久运行擦除和加载文件，那么您总是可以让它处理它自己的消息队列并使用 Windows 消息传递来回传递数据。这节省了很多关于线程锁定和避免竞争条件的心痛。

# .net - 从.net中的文件名写入和读取日期的最简单方法

> ID：728776
> 
> 赞同：1
> 
> 时间：2009-04-08T06:37:19.783
> 
> 标签：.net

由于文件名提供的限制，将日期时间写入文件名然后将其读回.net 中的日期时间的最简单方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T06:42:01.737

简单地说：

```
DateTime original = DateTime.Today;
string s = original.ToString("yyyyMMdd", CultureInfo.InvariantCulture);
DateTime dt = DateTime.ParseExact(s, "yyyyMMdd", CultureInfo.InvariantCulture); 
```

（显然与文件名的其余部分结合......根据需要添加更多精度 - 小时，分钟等）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T06:47:15.733

编辑：不幸的是，原始格式使用冒号，不能在 Windows 文件名中使用。这是一个真正的耻辱，因为它是理想的。在那种情况下，我会选择：

```
 yyyy-MM-dd`T`HH-mm-ss 
```

（如果您需要，则以毫秒为单位）。我不知道是否*有任何*文化在这些领域中使用了任何不寻常的东西。这将是相当令人惊讶的，但你可能应该使用`CultureInfo.InvariantCulture`只是为了确定。

不过，我喜欢在其中添加破折号 - 当您查看文件列表时，它可以更轻松地解析。

**编辑：原始答案**

我建议您使用“s”标准格式字符串给出的可排序日期/时间格式模式，例如：

```
 Console.WriteLine(DateTime.UtcNow.ToString("s")); 
```

打印如下内容：

```
 2009-04-08T06:45:43 
```

这对人类来说很容易解析，对计算机来说很容易解析，与文化无关，并且可以适当地分类。

# vb.net - 我可以在 VB.NET 中限定参数的类型吗？

> ID：728777
> 
> 赞同：4
> 
> 时间：2009-04-08T06:37:33.340
> 
> 标签：vb.net, generics

这是两个问题（一个比另一个更具体）。

如果我有这样的方法：

```
Public Function Blah(String Foo)
End Function 
```

我可以将 Foo 限定为另一种类型（例如，我可以要求 Foo 是一个也实现 IInterface 的字符串吗？）。

我在想象与此类似的东西：

```
Public Function Blah(RandomObject Foo Where RandomObject Is IInterface)
End Function 
```

此外，有没有办法限定 Type 参数？

例如，我可以要求我作为参数的类型是特定类树的吗？

```
Public Function Blah(Type t Where Type Of String)
End Function 
```

我应该提到我在属性的属性的上下文中使用它，因此类声明本身不能是通用的（这纯粹是专注于限定方法参数而不是键入类及其方法）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T06:44:53.290

对我来说，这看起来像是泛型的一个案例。您的方法签名在 VB.NET 中将是这样的：

```
Public Function Blah(Of T As {IImplementedByT})(Foo As T) 
```

这指定 Foo 可以是任何类型 T，只要 T 实现 IImplementedByT。请注意，此方法可以是通用的，而包含的类不需要是通用的。如果您希望 T 是从 RandomClass 派生的也实现此接口的类，您可以指定两个约束：

```
Public Function Blah(Of T As {RandomClass, IImplementedByT})(Foo As T) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T06:42:57.757

*您可以对泛型*类型执行第一个操作，但不能对非泛型类型执行此操作。基本上一个变量（包括一个参数）只能有一个编译时类型，所以你不能说“它必须是一个`Foo`和一个`IBar`- 你必须选择一个或另一个。泛型让你说“它必须是某种类型`T`，其中`T`派生`Foo`并实现`IBar`“虽然。

泛型是一个巨大的话题 - 太大而无法在 Stack Overflow 答案中涵盖 - 但 Microsoft 有一篇[很好的介绍性文章](http://msdn.microsoft.com/en-us/library/ms379608.aspx)。

至于你的第二个问题——不，你不能那样做。该`Type`值仅在执行时才知道，因此它必须是执行时检查。不过，您可以使用[`Type.IsAssignableFrom`](http://msdn.microsoft.com/en-us/library/system.type.isassignablefrom.aspx).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T06:41:30.287

不确定“Foo 是一个也实现 IInterface 的字符串”是什么意思。

string 类是密封的，所以你不能从它继承，因此你不能在它上面实现一个接口。

我希望我在正确的页面上。

# matlab - Matlab分数到浮点

> ID：728789
> 
> 赞同：0
> 
> 时间：2009-04-08T06:43:02.797
> 
> 标签：matlab, floating-point, numerical

在具有一个变量的方程上使用“求解”函数后，Matlab 似乎不喜欢使用浮点数。所以，我的回答是

```
ans = -2515439103678008769411809280/29019457930552314063110978530889-1/232155663444418512504887828247112*13479465975722384794797850090594238631144539220477565900842902305^(1/2) 
```

而且我不确定将其转换为可理解的小数的最佳方法是什么。到目前为止我最好的方法是

```
eval(char(ans)) 
```

（对于那些跟踪的人来说，这给了我-0.5002），但我对这个解决方案并不满意。

任何人都可以提出更好的建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T06:54:20.133

好吧，我看到的[下一页](http://matlab.izmiran.ru/help/techdoc/matlab_prog/ch11_st4.html)就有了答案。这是“双重”功能：

```
double(ans) 
```

# java - Java和MySQL日期问题

> ID：728803
> 
> 赞同：0
> 
> 时间：2009-04-08T06:49:04.480
> 
> 标签：java, mysql, time

我做了一个 rs.getTimestamp("datetime")

在爪哇。

在数据库中，这个日期时间是 2009/03/06 02:47:18

但时间返回为 14:47:18

我对 MySQL 日期不是很了解，所以我希望能解释一下为什么会发生这种情况。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T07:01:44.810

没关系。它与 MySQL 或任何数据库无关。这是 Timestamp 默认显示的格式，我相信。这并不意味着它错过了日期或其他东西。

您始终可以在代码中以任何格式格式化方法返回的时间戳。查看[java.text.SimpleDateFormat](http://java.sun.com/javase/6/docs/api/java/text/SimpleDateFormat.html)类。或者更好的是，查看更复杂的[Joda Time](http://joda-time.sourceforge.net/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T06:55:06.107

两件事情。首先，我认为我们需要示例代码。从你给我们的情况来看，发生了什么根本不清楚。上下文、用法、数据库模式和示例行。

其次，[ResultSet.getTimestamp()](http://java.sun.com/j2se/1.4.2/docs/api/java/sql/ResultSet.html#getTimestamp(java.lang.String))应该返回[Timestamp](http://java.sun.com/j2se/1.4.2/docs/api/java/sql/Timestamp.html)类型的对象，而不是任何类型的 String。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T07:06:50.850

SimpleDateFormat time = new SimpleDateFormat("HHmmss");

datime = time.format(rs.getTimestamp("datetime"))

然后将日期时间打印到文件中。

表中的 datetime 列是 datetime 数据类型

# java - 使用 jetty 以编程方式安装和运行 servlet 测试

> ID：728805
> 
> 赞同：0
> 
> 时间：2009-04-08T06:49:26.103
> 
> 标签：java, servlets

jetty servlet 容器既快速又轻巧，可以在单元测试中运行（实际上我是为了提供文件）。

可以通过编程方式（例如在测试中）将实际的 servlet 安装到其中并让它运行它们吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T06:52:42.257

是的。我们使用多种工具定期执行此操作。最简单的可能是[HTTP-unit](http://www.httpunit.org/doc/servletunit-intro.html)。当我们在 jetty 中部署时，我们通常会部署应用程序的较大部分并运行[Selenium](http://seleniumhq.org/)。HttpUnit 是最简单的，但在某些时候您的应用程序复杂性可能需要更完整的部署。请参阅[嵌入码头的文档部分](https://www.eclipse.org/jetty/documentation/9.4.x/embedding-jetty.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T07:17:52.290

为什么不使用任何 HttpUnit、[HTMLUnit](http://htmlunit.sourceforge.net/)等。创建一个 ANT 脚本来执行运行测试所需的任何操作。

# asp.net - 限制访问 Web ASP .NET 应用程序的用户数

> ID：728812
> 
> 赞同：7
> 
> 时间：2009-04-08T06:53:55.873
> 
> 标签：asp.net, login, licensing

如何限制 Web 应用程序的用户数量。

您可能希望将 Web 应用程序限制为一次只能处理 20 个用户。我们公司销售基于多个许可证的应用程序，但我们不确定 Web 应用程序中的行为可能是什么。

我已经看到一些建议说您可以在用户登录时将用户帐户标记为“LoggedIn = True”。然后每次新的成功登录尝试都会检查“LoggedIn = True”记录的数量。如果超过限制，则拒绝用户。

在这种情况下如何处理意外输入？如果：

*   用户不点击注销，关闭浏览器
*   浏览器崩溃，用户没有机会注销
*   网络连接中断，客户端断电等。

以上所有内容仍将设置“LoggedIn = True”标志并有助于登录用户的数量。这可能会无意中阻止真正经过身份验证的用户。

如果可能的话，我正在寻找更多的 ASP.NET 解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T06:58:36.033

假设您的用户身份验证以某种方式基于会话，那么所有“意外”情况的答案（这实际上是常态——人们似乎很少退出 Web 应用程序）将是这些用户槽在会话超时时变为空闲状态. 因此，您需要调查应用程序的使用模式。如果您让很多人登录几分钟，但仅此而已，那么 30 分钟的会话超时将意味着很少有人真正使用该应用程序。

根本问题是 Web 应用程序本质上是断开连接的，因此您无法监控用户在页面请求之间实际执行的操作。通常，您会为特定用户出售此类应用程序的许可证（因此，如果一家公司购买 20 个许可证，则将为他们提供 20 个用户名和密码）。然后，您当然可以通过拒绝第二次登录或停用前一次登录来防止使用相同的用户名和密码进行多次登录（如果有人真正从一台机器移动到另一台机器而没有注销其中一个，这可能是更好的方法你概述的原因）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T07:17:53.930

最常见的解决方案是有一个活动计时器。您可以假设活跃用户将在“X”时间内发出至少一个请求——比如 5 分钟左右。

您可以通过将 ajax 样式的异步请求触发在页面加载时启动的计时器来强制执行此操作。例如，如果您假设所有活动用户每**5分钟至少发出 1 个请求，那么每个页面将每****4**分钟请求一个空（但无缓存）页面。这样一来，只要他们打开浏览器窗口，您就会始终拥有来自该用户的活动。同样，这是由异步请求处理的，而不是任何类型的重新加载指令。这使得它对用户绝对透明。

作为额外的奖励，看看您是否可以让该 ajax 请求下拉一些有用的信息，而不仅仅是强制执行许可限制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T07:20:20.210

正如 David 指出的那样，主要问题是区分空闲用户和离开应用程序的用户。

一个可能的解决方案是保持较低的会话超时时间（比如 1 或 2 分钟）并使用回调函数来保持会话对空闲用户保持活动状态。然后，您可以在 Session_Start 中增加一个计数器并在 Session_End 中减少它，并使用它来跟踪活动会话的数量。如果活动会话的数量超出您的限制，您会将新用户重定向到放弃会话的页面，并告诉用户您目前有太多访问者。

# java - Win2003终端服务器的小程序加载问题

> ID：728824
> 
> 赞同：1
> 
> 时间：2009-04-08T07:02:59.440
> 
> 标签：java, applet, windows-server-2003

Applet 加载似乎失败，JAVA 1.6 出错 java.lang.ClassNotFoundException: at sun.applet.AppletClassLoader.findClass(Unknown Source) at java.lang.ClassLoader.loadClass(Unknown Source)

我认为这与Win2003下用户帐户的安全性有限有关。有任何想法吗？该站点是受信任的。它适用于管理员用户。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T08:49:10.480

DiskQUOTA 已满。

# c# - 即使存在 linq to sql 连接，子集合也不会过滤

> ID：728828
> 
> 赞同：3
> 
> 时间：2009-04-08T07:07:14.063
> 
> 标签：c#, .net, linq-to-sql, many-to-many

我有一个 LINQ 查询：

```
var result = from mt in MessageTypes
            join mtfmt in MessageTypeField_MessageTypes
                on new { MessageTypeID = mt.ID, MessageTypeFieldID = messageTypeFieldId } equals new { MessageTypeID = mtfmt.MessageTypeID, MessageTypeFieldID = mtfmt.MessageTypeFieldID }
            where (mt.StatusID == (int)status)
            select mt; 
```

或 Lambda 语法，如果您愿意（我正在使用的那个）（`messageTypeFieldID`设置在来自参数的 var 调用之上。）：

```
var messageTypes = context.MessageTypes
                .Join(
                context.MessageTypeField_MessageTypes,
                mt =>
                new
                    {
                        MessageTypeID = mt.ID,
                        MessageTypeFieldID = messageTypeFieldID
                    },
                mtfmt =>
                new
                    {
                        MessageTypeID = mtfmt.MessageTypeID,
                        MessageTypeFieldID = mtfmt.MessageTypeFieldID
                    },
                (mt, mtfmt) =>
                new
                    {
                        mt = mt,
                        mtfmt = mtfmt
                    }
                )
                .Where(x => (x.mt.StatusID == (int)status))
                .Select(x => x.mt); 
```

我刚刚开始学习 LINQ 连接，并遇到了一种情况，即在我正在设置的新规范化（多对多）表中需要它，并且我希望返回所有*消息类型*，每个消息类型及其关联*字段*都位于“MessageTypeField_MessageType”下。

我的“MessageTypeField_MessageTypes”表是一个相当简单的标准化策略设置，就像这样，我应该说明即使 MessageTypeID“有很多”它是唯一数据，所以它可能是：

```
[ID | MessageTypeID | MessageTypeFieldID]
 1    63      10
 1    63      11
 1    63      12 
```

现在上面的代码执行并返回一个我很满意的查询..（执行正确的 INNER JOIN）但是当我查看`messageTypes.ToList()[0].MessageTypeField_MessageTypes`例如快速观察时，我希望看到**1 条记录**，我得到了一整套 messageTypeField_MessageType 记录~17，*只*过滤`MessageTypeFieldID`而不是过滤`MessageTypeID`。它应该在每次迭代时按消息类型 id 过滤，并且只返回一条记录。关于我做错了什么或如何实现我需要的任何想法？

对不起，这个复杂的例子，但我希望你们能帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T07:14:30.410

如果您正在查看导航属性（即 的某个子集合`mt`），那么这与您的查询无关；听起来你想使用[`AssociateWith`](http://msdn.microsoft.com/en-us/library/system.data.linq.dataloadoptions.associatewith.aspx). 如果您只是想过滤子数据，这在很大程度上*取代了连接......*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T07:34:41.720

考虑将您的选择更改为：

```
 select new 
 {
    MessageType = mt,
    MessageField = mtfmt
 } 
```

正如 Marc 提到的，更改查询与导航属性无关。类似于上面的东西可能是你想要的。

如果你想坚持使用导航属性，你应该使用 AssociateWith 和 LoadWith 的组合。第一个过滤，然后使它成为一个急切的负载（所以你不会以多次往返结束）。

# mysql - MySql 存储过程创建错误

> ID：728830
> 
> 赞同：0
> 
> 时间：2009-04-08T07:08:16.777
> 
> 标签：mysql, stored-procedures

我正在尝试使用以下代码在我的 mysql 数据库中创建一个存储过程。我收到一个错误。请帮我解决

我的 MySQl 版本是 5.0.51b

```
CREATE PROCEDURE tv_insert_user(IN firstName VARCHAR(25),
IN lastName VARCHAR(25), IN emailId VARCHAR(22),IN countryId INT,IN stateId INT)
  BEGIN
     INSERT INTO tv_user_master(FIRST_NAME,LAST_NAME,EMAIL,COUNTRY_ID,STATE_ID) VALUES(firstName,lastName,lname,emailId,countryId,stateId)
  END 
```

错误：

* * *

错误代码：1064 您的 SQL 语法有错误；检查与您的 MySQL 服务器版本相对应的手册，以在第 5 行的“END”附近使用正确的语法（花费 0 毫秒）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T08:04:54.393

lname-thing 不是错误消息的内容。您需要指定不同的分隔符。MySQL 命令的默认分隔符是分号，但分号用于语句末尾的存储过程中。在此示例中，我将分隔符更改为 //，并使用它来结束该过程。这允许我在块内使用分号。

```
DELIMITER //

CREATE PROCEDURE tv_insert_user(IN firstName VARCHAR(25),
IN lastName VARCHAR(25), IN emailId VARCHAR(22),IN countryId INT,IN stateId INT)
BEGIN
   INSERT INTO tv_user_master(FIRST_NAME,LAST_NAME,EMAIL,COUNTRY_ID,STATE_ID)   VALUES(firstName,lastName,emailId,countryId,stateId);
END;
//

DELIMITER ; 
```

一旦您解决了分隔符位，您可能会收到有关 INSERT 命令和额外属性（两次姓氏）的错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T07:26:35.170

值列表中有一个额外的变量

```
CREATE PROCEDURE tv_insert_user(IN firstName VARCHAR(25), IN lastName VARCHAR(25), IN emailId VARCHAR(22),IN countryId INT,IN stateId INT)
BEGIN
 INSERT INTO tv_user_master(FIRST_NAME,LAST_NAME,EMAIL,COUNTRY_ID,STATE_ID)
  VALUES(firstName,lastName,lname,emailId,countryId,stateId)
                            ^^^^^^
END 
```

尝试删除并查看是否仍然出现错误，如果还没有更改分隔符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T07:48:14.527

正如 sfossen 所说，删除`lname`.
此外，在插入的末尾添加一个分号：

```
 CREATE PROCEDURE tv_insert_user(IN firstName VARCHAR(25), IN lastName VARCHAR(25), IN emailId VARCHAR(22),IN countryId INT,IN stateId INT)
  BEGIN
     INSERT INTO tv_user_master(FIRST_NAME,LAST_NAME,EMAIL,COUNTRY_ID,STATE_ID) VALUES(firstName,lastName,emailId,countryId,stateId)**;**
  END 

```

# c# - SMTP 邮件发送

> ID：728831
> 
> 赞同：2
> 
> 时间：2009-04-08T07:08:24.513
> 
> 标签：c#, smtp

我正在使用以下代码发送电子邮件：

```
MailMessage Mailer = new MailMessage();
Mailer.From = new MailAddress(From);
Mailer.To.Add(new MailAddress(To));
Mailer.Subject = Subject;
Mailer.Body = Body;
Mailer.IsBodyHtml = isBodyHTML;
SmtpClient mSmtpClient = new SmtpClient();
mSmtpClient.Host = "ExchangeServer.XXX.YYY.COM"; // Our Exchange server Name
Mailer.Attachments.Add(new System.Net.Mail.Attachment(strLogFile));
mSmtpClient.Send(Mailer); 
```

我停止了我的 SMTP 服务，但邮件仍然成功发送。我只是想了解如果我的 SMTP 服务停止了，程序如何发送电子邮件，不应该将其转储到 mailroot 文件夹中吗？

谢谢， 普拉文

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T07:20:32.253

看起来你已经告诉它在这里使用带有这条线的交换服务器：

```
mSmtpClient.Host = "ExchangeServer.XXX.YYY.COM"; // Our Exchange server Name 
```

所以它根本不会使用你的 smtp 服务。将该行代码更改为：

```
mSmtpClient.Host = "localhost"; 
```

它将开始使用本地 smtp 服务，如果您尝试在服务停止的情况下运行代码，它将失败。

# sql - 使用 sql 查询将字符串转换为 int

> ID：728833
> 
> 赞同：207
> 
> 时间：2009-04-08T07:09:00.830
> 
> 标签：sql, sql-server-2005

如何在 SQL Server 2005 上使用 SQL 查询将字符串转换为整数？

* * *

## 回答 #1

> 赞同：355
> 
> 时间：2009-04-08T07:13:15.250

您可以使用[CAST 或 CONVERT](http://msdn.microsoft.com/en-us/library/ms187928(SQL.90).aspx)：

```
SELECT CAST(MyVarcharCol AS INT) FROM Table

SELECT CONVERT(INT, MyVarcharCol) FROM Table 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2015-04-08T07:50:19.580

另请注意，当从数字字符串转换`'56.72'`为 INT 时，您可能会遇到 SQL 错误。

```
Conversion failed when converting the varchar value '56.72' to data type int. 
```

要解决这个问题，只需执行以下两次转换：

字符串 -> 数字 -> 整数

或者

```
SELECT CAST(CAST (MyVarcharCol AS NUMERIC(19,4)) AS INT) 
```

将数据从 TableA 复制到 TableB 时，转换是隐式的，因此您不需要第二次转换（如果您愿意向下舍入到最接近的 INT）：

```
INSERT INTO TableB (MyIntCol)
SELECT CAST(MyVarcharCol AS NUMERIC(19,4)) as [MyIntCol]
FROM TableA 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2018-09-27T10:35:32.373

从 SQL Server 2012 开始，您可以使用[TRY_PARSE](https://docs.microsoft.com/en-us/sql/t-sql/functions/try-parse-transact-sql)或[TRY_CONVERT](https://docs.microsoft.com/en-us/sql/t-sql/functions/try-convert-transact-sql)。

```
SELECT TRY_PARSE(MyVarcharCol as int)

SELECT TRY_CONVERT(int, MyVarcharCol) 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2018-11-30T13:33:24.853

试试这个，它在雅典娜对我有用：

```
cast(MyVarcharCol as integer) 
```

# shell-extensions - 如何在 shell 扩展中从外部调用 IShellFolder::EnumObjects

> ID：728839
> 
> 赞同：1
> 
> 时间：2009-04-08T07:12:41.023
> 
> 标签：shell-extensions

我创建了一个类似于 Google 的 GDrive 的 Windows Shell 扩展。现在我想向继承自 IShellView 的 ListView 添加不同的视图。添加了一个新的上下文菜单以显示 3 个视图（详细信息、小图标、大图标）。当使用上下文菜单更改视图时，需要刷新/创建当前窗口以显示更改后的视图。在我的 IShellFolder::EnumObjects 中，创建了一个新的 ListView 对象并自动调用 OnCreate。当我使用上下文菜单更改视图时，我也需要调用此方法。我想可能有一些像 SHChangeNotify() 这样的 API 可以自动所有 EnumObjects() 并且将使用更改后的视图创建一个新的 IShellView 窗口。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-03T14:15:45.817

正如我从您的问题中了解到的那样，您需要在列表视图中查看相同的内容，但使用新视图。

选择新的视图模式后不需要重新创建 Listview 对象，只需将 ListView 的样式设置为**LVS_REPORT**、**LVS_SMALLICON**或**LVS_ICON**。

[SHChangeNotify](http://msdn.microsoft.com/en-us/library/windows/desktop/bb762118%28v=vs.85%29.aspx)用于将更改反映到树窗格而不是 ListView。

# java - 实例化内部类

> ID：728842
> 
> 赞同：14
> 
> 时间：2009-04-08T07:13:23.033
> 
> 标签：java, inner-classes

我有一个实用方法，当从中删除不相关的逻辑时，简化的方法如下所示：

```
public static <A extends Foo> List<A> getFooList(Class<A> clazz) {
   List<A> returnValue = new ArrayList<A>();
   for(int i=0; i < 5; i++) {
        A object = clazz.newInstance();
        returnValue.add(object);
   }

   return returnValue;
} 
```

问题是，如果`clazz`是一个内部类，例如`Foo.Bar.class`，那么`newInstance()`即使是公共的，该方法也不起作用`Bar`，因为它会抛出一个`java.lang.InstantiationException`.

有没有办法动态实例化内部类？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-08T07:18:50.540

如果它是真正的*内部*类而不是*嵌套*（静态）类，则有一个隐式构造函数参数，它是对外部类实例的引用。你不能`Class.newInstance`在那个阶段使用 - 你必须得到适当的构造函数。这是一个例子：

```
import java.lang.reflect.*;

class Test
{
    public static void main(String[] args) throws Exception
    {
        Class<Outer.Inner> clazz = Outer.Inner.class;

        Constructor<Outer.Inner> ctor = clazz.getConstructor(Outer.class);

        Outer outer = new Outer();
        Outer.Inner instance = ctor.newInstance(outer);
    }
}

class Outer
{
    class Inner
    {
        // getConstructor only returns a public constructor. If you need
        // non-public ones, use getDeclaredConstructors
        public Inner() {}
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-02-23T16:59:28.653

更通用的东西：

```
 public static <T> T createInstance(final Class<T> clazz) throws SecurityException, NoSuchMethodException,
            IllegalArgumentException, InstantiationException, IllegalAccessException, InvocationTargetException {

            T instanceToReturn = null;
            Class< ? > enclosingClass = clazz.getEnclosingClass();

            if (enclosingClass != null) {
                Object instanceOfEnclosingClass = createInstance(enclosingClass);

                Constructor<T> ctor = clazz.getConstructor(enclosingClass);

                if (ctor != null) {
                    instanceToReturn = ctor.newInstance(instanceOfEnclosingClass);
                }
            } else {
                instanceToReturn = clazz.newInstance();
            }

            return instanceToReturn;
     } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T07:24:55.177

仅当 clazz 表示抽象类或接口时，才会抛出此异常。您确定要传递一个代表具体类的 Class 对象吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-08-01T18:08:48.153

在 Jmockit 1.41 中，使用这个：

ConstructorReflection.newInstance

# php - 如何设计用于浏览文本手册页的 Web 界面？

> ID：728843
> 
> 赞同：0
> 
> 时间：2009-04-08T07:13:34.983
> 
> 标签：php, ajax, json, documentation-system

我想设计一个网络应用程序，允许我对手册页集合进行排序、浏览和显示各种属性（例如标题、标签、描述）。

具体来说，这些是R 包中的[R 文档文件](http://cran.r-project.org/doc/manuals/R-exts.html#Rd-format)，其中包含一组数据集，由 SVN 存储库中的几个人维护。这些文件的格式是 .Rd，类似于 LaTeX，但不同。

R 具有将这些手册页转换为 html 或 pdf 的功能，但我希望能够拥有一个允许用户单击特定关键字并为这些手册页显示列表（和简短摘录）的 Web 界面在 \keyword{} 标记中包含该关键字。

此外，生成的 html 有点难看，我希望能够提供自己的 CSS。

一个明显的选择是将我想要的所有元数据加载到像 MySQL 这样的数据库中，并设计我的站点来运行查询并获取适当的数据。

我想避免这种情况，以尽量减少对未来维护者的维护。文件数量很小（<500），数据量很小（每个文件只有几百行）。

我目前的倾向是有一个脚本，从每个文件中提取所需的元数据到一个摘要 JSON 文件中，并在 PHP 中加载这个 summary.json 文件，对其进行解码，然后循环遍历数组以查找那些具有与当前匹配的属性的项目查询（例如所有带有关键字 1 和关键字 2 的文档）。

我从以下方向开始……

```
$contents=file_get_contents("summary.json");
$c=json_decode($contents,true);
foreach ($c as $ind=>$val ) { .... etc 
```

另一个想法是编写一个脚本，将这些 .Rd 文件转换为 xml。在这种情况下，是否有任何轻量级框架可以轻松地对一小部分 xml 文件进行排序和搜索？

我不确定 xQuery 是不是有点矫枉过正，或者我是否有时间深入研究它......

我认为我正在遭受所有 AJAX 诱惑的选项过多综合症。任何帮助是极大的赞赏。

我正在寻找一个超级简单的解决方案。你们中的一些人可能会如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T07:43:20.123

我的方法是从文件中解析关键字（根据您的描述，我假设它们具有特殊符号以将它们与普通单词/文本区分开来）并将此数据存储为 searchindex 某处。不一定是 mySQL，sqlite 对你的项目来说肯定足够了。搜索将非常简单。

解析文件可以自动作为提交后挂钩到您的颠覆存储库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T07:45:04.817

为什么不为每个摘要字段创建带有列的表 SUMMARIES？然后您可以使用全文索引对其进行索引，为每个字段分配不同的权重。

您不需要 MySQL，您可以使用内置 Google 全文索引 (FTS3) 的 SQLite。

# c# - Web 服务中缺少参数

> ID：728845
> 
> 赞同：0
> 
> 时间：2009-04-08T07:14:25.577
> 
> 标签：c#, php, asp.net, web-services, crystal-reports

我目前正在开发 Web 服务以从 Crystal Report 中检索 pdf 文档。由于报告中没有参数值，服务工作正常。一旦我在查询中使用参数，就无法再显示报告，并且我检索到诸如“缺少参数值”之类的错误。但是只有一个参数，我很确定我设置了该参数的值......这是我更改/添加值的代码：

```
// 参数是一个字符串，如 'parametername:value'
字符串索引 = param.Split(':')[0];
字符串值 = param.Split(':')[1];
// repDoc 是当前的报告
repDoc.ParameterFields[index].CurrentValues.Clear();
repDoc.ParameterFields[index].CurrentValues.AddValue(value);
// 现在我将 PDF 创建为 HTTP 响应
repDoc.ExportToHttpResponse(ExportFormatType.PortableDocFormat, response, false, "Report");

```

我真的不知道为什么它不起作用......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T07:36:36.113

如果真的设置了参数，请尝试调试？

我确定！=我检查过了

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T08:12:54.187

我发现了错误...我在创建报告之前做了一个 repDoc.refresh() .. 似乎参数值是这样删除的...删除刷新后一切正常:)

谢谢你的帮助！！！

古士肯

# c - 分配给较大宽度整数时的 C 整数溢出行为

> ID：728847
> 
> 赞同：7
> 
> 时间：2009-04-08T07:14:35.170
> 
> 标签：c, casting, integer, overflow, integer-overflow

如果我在 C 中执行以下代码：

```
#include <stdint.h>

uint16_t a = 4000;
uint16_t b = 8000;

int32_t c = a - b;

printf("%d", c); 
```

结果它正确打印了“-4000”。但是，我有点困惑：从另一个减去一个更大的无符号整数时不应该有算术溢出吗？这里有什么铸造规则？这个问题似乎有点无聊，所以任何参考都将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T07:40:36.650

这个问题实际上有些复杂。[算术表达式的操作数使用标准 (C89)](http://flash-gordon.me.uk/ansi.c.txt)的第 3.2.1.5 节中的特定规则进行转换。在您的情况下，答案取决于类型`uint16_t`是什么。如果它小于`int`，例如`short int`，那么操作数将被转换为`int`-4000，但在 16 位系统上，`uint16_t`可能是`unsigned int`并且不会自动转换为有符号类型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T07:35:55.633

简短的回答是，这些都是`int`在减法过程中提升的。[对于长答案，请查看C 标准](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1124.pdf)的第 6.3.1.1 节，其中讨论了算术表达式中的**整数提升**。标准中的相关语言：

> 如果 an**`int`**可以表示原始类型的所有值，则将该值转换为**`int`**; 否则，将其转换为**`unsigned int`**. 这些被称为*整数促销*。整数提升不会改变所有其他类型。

细节也在那里，但它们变得非常讨厌。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T07:20:36.480

`int32_t`在减法期间，两个操作数都被提升。如果结果大于最大值，`int32_t`您会看到溢出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T07:56:02.167

事实上，有一个溢出，但 C 没有告诉你。

当解释为有符号整数时，溢出留下的值恰好是 -4000。这在 2 的补码机器上按设计工作。

尝试将结果解释为无符号，您会注意到 (u1-u2) 在 u1 < u2 时计算为一些看似无关的数字。

# windows - Windows中的内核对象和事件对象有什么区别？

> ID：728848
> 
> 赞同：2
> 
> 时间：2009-04-08T07:15:16.057
> 
> 标签：windows, winapi

据我所知，它们都由一个可以由用户操作的 HANDLE 指向。有什么不同？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T07:22:10.627

大多数用于在多线程应用程序中创建、同步和监视线程的 API 都依赖于内核对象，内核对象也用于管理内存和文件。KO 是操作系统资源，例如进程、线程、事件、互斥体、信号量、共享内存和文件等。

除了创建或打开内核对象。您通过 HANDLE 而不是名称来引用它。HANDLE 是唯一标识内核对象的 32 位值。

内核对象是通用的，而 **事件是特定的内核对象之一**。

参考

[内核对象。](http://msdn.microsoft.com/en-us/library/ms724485(VS.85).aspx)

[事件](http://msdn.microsoft.com/en-us/library/ms682655(VS.85).aspx)。

# c# - 无法访问类中的 Winforms 控件

> ID：728852
> 
> 赞同：4
> 
> 时间：2009-04-08T07:16:42.950
> 
> 标签：c#, winforms

我目前正在使用 Visual Studio 2008 在 C# 中的一个小型 Windows 窗体项目中工作。我已向项目中添加了一个自定义类，但在此类中我无法访问窗体控件​​（如列表框、文本框、按钮）以以编程方式更改它们的属性。

类文件包含 using system.windows.forms 并且所有文件都在同一个命名空间中。令人惊讶的是，我也无法访问 form1 类本身中的控件，除非我在该类中创建一个方法，然后智能感知弹出各种控件的名称。

然而，在自定义类中，智能感知根本不显示控件的名称。

感谢有人能解释为什么会发生这种情况。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T07:22:19.987

封装意味着您的单独类*不*应该直接与控件对话。相反，您应该在（外部）上公开属性和方法`Control`- 例如：

```
public string TitleText {
    get {return titleLbl.Text;}
    set {titleLbl.Text = value;}
} 
```

对于更复杂的操作，最好使用方法；属性非常适合用于离散值的简单读/写。

这提供了各种优势：

*   如果需要，您可以将详细信息抽象为接口（或类似接口）
*   您可以更改实现（例如，使用表单的文本作为标题）而不更改调用代码
*   它只是......更好;-p

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T07:24:30.807

您的班级需要对表单的引用才能使其正常工作。这样做的原因是表单不是静态类，因此您可以拥有它的多个实例。

给它引用的最好方法可能是在类构造函数中传递它。然后该类将具有对表单的引用，并且可以使用该引用来更改控件。

如果您 100% 确定您将只打开一个表单实例，则可以使用的另一种选择是向返回表单实例的表单类添加一个公共静态属性。然后，该属性将可用于您的其他类。

此外，请确保您的控件是公开的，或者更好地向您的表单添加可用于间接操作控件的公开方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T07:28:42.873

Form1 中的控件将是私有的

```
partial class Form1
{
   //elided other good stuff 
   private System.Windows.Forms.Button button1;
} 
```

所以不，你不能直接从另一个类访问它。

您可以按照[@abatishchev 的](https://stackoverflow.com/questions/728852/unable-to-access-winforms-control-in-a-class/728857#728857)建议将其公开（但这将是一个非常糟糕的主意）。更好的计划是使用[@Marc Gravell](https://stackoverflow.com/posts/728872/edit)建议的属性。[您仍然需要将对表单的引用传递给您希望使用属性的类（正如@Rune Grimstad](https://stackoverflow.com/posts/728875/edit)所指出的那样）。您正在尝试在应用程序中编写一个直接向 UI 询问数据的类。这通常不被认为是一个好主意。这个类应该完全关注它自己的目的。您应该为类需要访问的特定数据位设计属性或事件，而不必将整个表单传递给它，也许只是它需要使用或更改的值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T07:32:04.003

看看如何使用 MVP 模式（示例代码）实现这一点：[Implementing MVC with Windows Forms](https://stackoverflow.com/questions/654722/implementing-mvc-with-windows-forms/685722#685722)

更新：您提到的类中的代码实际上应该是表单演示者的一部分，它具有对表单的引用（通过 IView 接口）。这就是你应该如何设计你的 UI 代码，而不是直接访问其他 Form 的私有部分。

# c++ - 一个应用程序可以依赖于两个不同版本的 libstdc++ 吗？

> ID：728858
> 
> 赞同：4
> 
> 时间：2009-04-08T07:17:59.590
> 
> 标签：c++, apache, libstdc++

一个应用程序可以同时依赖于两个不同版本的 libstdc++ 吗？（例如：libstdc++5 和 libstdc++6）？场景是 - 一些二进制文件依赖于 libstdc++ 6，但加载了一个依赖于 libstdc++5 的 .so ......

那会有工作的机会吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T07:49:20.467

最重要的是，您需要检查这两个版本的库是否二进制兼容。例如，G++ 3.3 和 3.4 不是。

即使它们是： * 可能存在名称修改问题 * 您不能进行跨模块分配/释放（无论如何都是个坏主意） * 您可能无法使用 STL 处理模块

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T11:05:09.030

我最近刚刚将一个 C++ 应用程序从 AS3/GCC323 移植到了 AS4/GCC346。虽然应用程序本身链接到 libstdc++.so.6，但它链接到的一些库仍然链接到 libstdc++.so.5。当我尝试运行它时，Depsite 成功构建了 SEGV。

一旦我在 AS4/GCC346 上重新编译了库，应用程序和库仅链接到 libstdc++.so.6 并且 SEGV 不再发生。

所以我会说答案是否定的，你不能链接到两者。

乔恩

# c# - 从超链接而不是从文件夹获取图像以填充我的中继器控件

> ID：728862
> 
> 赞同：0
> 
> 时间：2009-04-08T07:18:52.367
> 
> 标签：c#, asp.net, image, repeater, directory

我不想用我项目中文件夹中的图片填充我的中继器，我想用指向图像所在位置的链接来填充它............

> [http://www.erate.co.za/imgGrab.aspx?Id=99](http://www.erate.co.za/imgGrab.aspx?Id=99)

我必须进行哪些代码更改才能让我的代码查看图像的超链接而不是“图片”文件夹？

我的页面加载

```
protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            string sBasePath = System.Web.HttpContext.Current.Request.ServerVariables["APPL_PHYSICAL_PATH"];
            if ( sBasePath.EndsWith("\\"))
                sBasePath = sBasePath.Substring(0,sBasePath.Length-1);

            sBasePath = sBasePath + "\\" + "pics";

            System.Collections.Generic.List<string> oList = new System.Collections.Generic.List<string>();
            foreach (string s in System.IO.Directory.GetFiles(sBasePath, "MyPicture.jpg"))
            {
                //We could do some filtering for example only adding .jpg or something
                oList.Add( System.IO.Path.GetFileName( s ));

            }
            repImages.DataSource = oList;
            repImages.DataBind();
        }

    } 
```

我的中继器的 ItemDataBound 事件（称为 repImages）

```
 protected void repImages_ItemDataBound(object sender, RepeaterItemEventArgs e)
    {
        if (e.Item.ItemType == ListItemType.AlternatingItem ||
            e.Item.ItemType == ListItemType.Item)
        {
            string sFile = e.Item.DataItem as string;

            //Create the thumblink
            HyperLink hlWhat = e.Item.FindControl("hlWhat") as HyperLink;
            hlWhat.NavigateUrl = ResolveUrl("~/pics/" + sFile  );
            hlWhat.ToolTip = System.IO.Path.GetFileNameWithoutExtension(sFile);
            hlWhat.Attributes["rel"] = "imagebox-bw";

            Image oImg = e.Item.FindControl("imgTheImage") as Image;
            oImg.ImageUrl = ResolveUrl("~/createthumb.ashx?gu=/pics/" + sFile + "&xmax=100&ymax=100" );

        }

    } 
```

艾蒂安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T09:18:24.030

如果我理解正确，这是一个多方面的问题：

一个。您希望从 Internet URL 而不是本地文件夹加载图像。这意味着您必须有某种方式列出远程 URL 上可用的文件。如果您客观地看待这个问题，您会意识到从远程位置和从本地系统检索图像之间的唯一区别是文件很容易使用 DirectoryInfo 类进行枚举。这里的`GetFiles`方法返回一个数组，`FileInfo`您可以使用 FileName 属性获取每个的实际文件名。所以基本上，您需要一个映射到文件位置的字符串列表。

湾。仅从远程位置枚举文件取决于许多因素，例如您用于检索该列表的协议。如果您使用的是 HTTP，并且我们可以假设您对该位置的服务器有一定的控制权，那么 URL 需要主要支持目录浏览。然后，您需要解析提供的目录列表（非标准且特定于服务器）并将所有可用的图像 URL 加载为字符串。然后，您可以使用该列表填充您的中继器。请参阅[此讨论](https://stackoverflow.com/questions/124492/c-httpwebrequest-command-to-get-directory-listing)以获取可能的解决方案。

如果服务器支持 FTP，那么您的工作会变得更容易，因为您可以使用 WebRequestMethods.Ftp.ListDirectory 或 WebRequestMethods.Ftp.ListDirectory 方法枚举图像。

C。如果要为图像创建缩略图，则必须编写代码来下载每个图像，将其保存在临时位置，然后对其执行尺寸操作。

d。但是，如果 Internet 位置上可用的图像列表是静态的，并且您已经拥有该信息，则可以简单地将该列表加载为字符串列表并将每个 Image 控件的 src 属性设置为该列表。然而，缩略图仍然是一个问题，除非您也可以在该 URL 上上传您的缩略图创建者（HTTP 处理程序），以便在本地检索文件以进行操作，并自动为您提供缩略图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T08:43:59.213

在转发器的模板中包含一个`<img>`标签。如果您需要以编程方式设置源，请将其设为`runat="server"`.

# java - Java：如何将 JMenu 添加到 JPanel 或创建下拉按钮？

> ID：728867
> 
> 赞同：6
> 
> 时间：2009-04-08T07:21:05.870
> 
> 标签：java, swing, drop-down-menu, menuitem, menubar

有什么方法可以将 JMenuItem 添加到 JPanel，以便我可以在地址栏下创建一个按钮来显示多个选项，例如 Firefox 中的最新新闻按钮？

我只能将 JMenu 和 JMenuItems 添加到 JMenuBar、JPopupMenu 和其他 JMenu 和 JMenuitems

有没有办法在 Java Swing 中创建一个下拉 Jbutton？（左侧带有向下箭头的那些向用户显示了更多选项）

提前致谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T09:01:07.487

最后，我用一个简单的 Jutton 和一个带有显示选项的 JPopupPane 实现了“显示选项按钮”：

在按钮的 ActionPerformedListener 中，我编写了以下代码：

```
popMenu.show(showOptionsButton,0,showOptionsButton.getHeight()) 
```

它可以像 JMenuBar 中的 JMenu 一样正常工作，但与下拉按钮不完全一样，您可以在其中执行按下按钮的操作或按下向下箭头显示更多操作。我相信这可以使用两个“非常接近”的按钮来完成，然后在箭头按钮中使用上面的代码，但将“动作按钮”设置为弹出窗口的组件，以便弹出窗口显示在两个按钮的下方。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T07:40:09.337

A`JMenuBar`应该只添加到`JFrame`( `setMenuBar()`)，而不是 a `JPanel`。

Swing 下拉按钮是前往此处的方式。

有关各种实现提议的良好讨论，请参阅[本文](http://java.dzone.com/news/drop-down-buttons-swing-new-al)

[替代文字 http://blogs.sun.com/geertjan/resource/dropdownbutton1-jl.png](http://blogs.sun.com/geertjan/resource/dropdownbutton1-jl.png)

上面的下拉按钮使用**NetBeans UI Utilities API**（`platform7/modules/org-openide-awt.jar`在任何 NetBeans IDE 发行版中）。您不需要有 NetBeans 来运行它：只有您从 NetBeans 安装中提取的这个 jar。

# email - 点项目

> ID：728868
> 
> 赞同：0
> 
> 时间：2009-04-08T07:21:17.353
> 
> 标签：email, gmail, ssl, dotproject

我已经在 linux 机器上安装了 dot 项目。使用 ssmtp 为 gmail 帐户发送电子邮件以获取邮件通知。但是当我创建任何用户时，它不会向用户电子邮件 ID 发送邮件以创建帐户。但我从 shell 提示发送邮件。我得到的错误是无法发送电子邮件：530 5.7.0 必须先发出 STARTTLS 命令。添加了 22sm11794837wfd.6 :( 。如果有人有解决方案，请帮助我....

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T07:44:27.250

Gmail 需要安全连接（TLS 或 SSL）。

您需要配置 SSMPT（不是 dotProject）才能与 Google 的 SMTP 服务器安全通信。

我认为您可以将以下内容添加到您的 ssmtp.conf 文件中，并且（假设您的 SSMTP 包是使用 SSL 支持编译的）它应该可以工作：

```
UseTLS=YES 
```

也许：

```
UseSTARTTLS=YES 
```

更多信息[在这里](http://linux.die.net/man/5/ssmtp.conf)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T07:33:22.893

我假设“530 5.7.0 必须首先发出 STARTTLS 命令。” 意味着您必须使用 TLS（传输层安全性）进行连接。dot 项目支持吗？

# json - 我应该如何在 Scala 中指定类 JSON 的非结构化数据的类型？

> ID：728871
> 
> 赞同：10
> 
> 时间：2009-04-08T07:22:18.940
> 
> 标签：json, generics, data-structures, scala, strong-typing

我正在考虑将一个非常简单的文本模板库移植到 scala，主要是作为学习语言的练习。该库目前在 Python 和 Javascript 中实现，其基本操作或多或少归结为这一点（在 python 中）：

```
template = CompiledTemplate('Text {spam} blah {eggs[1]}')
data = { 'spam': 1, 'eggs': [ 'first', 'second', { 'key': 'value' }, true ] }
output = template.render(data) 
```

在 Scala 中，这些都不是很难做到的，但我不清楚的是如何最好地表达`data`参数的静态类型。

基本上，此参数应该能够包含您在 JSON 中找到的各种内容：一些原语（字符串、整数、布尔值、null），或者零个或多个项目的列表，或者零个或多个项目的映射。（出于这个问题的目的，可以将映射限制为具有字符串键，这似乎是 Scala 无论如何都喜欢的东西。）

我最初的想法只是将 a`Map[string, Any]`用作顶级对象，但这对我来说似乎并不完全正确。事实上，我不想在其中添加任何类型的任意对象；我只想要我上面概述的元素。同时，我认为在 Java 中我真正能够得到的最接近的是`Map<String, ?>`，而且我知道 Scala 的作者之一设计了 Java 的泛型。

我特别好奇的一件事是其他具有类似类型系统的函数式语言如何处理此类问题。我有一种感觉，我在这里真正想做的是提出一组我可以进行模式匹配的案例类，但我不太能够想象它会是什么样子。

我有*Programming in Scala*，但老实说，我的眼睛开始对协变 / 逆变的东西有点呆滞，我希望有人能更清楚、更简洁地向我解释这一点。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-10T07:18:27.690

您发现您需要某种案例类来为您的数据类型建模。在函数式语言中，这些类型的东西被称为“抽象数据类型”，你可以通过谷歌搜索一下了解 Haskell 如何使用它们。Scala 的 Haskell 的 ADT 等价物使用密封的特征和案例类。

Let's look at a [rewrite of the JSON parser combinator](http://paste.pocoo.org/show/106688/) from the Scala standard library or the Programming in Scala book. Instead of using Map[String, Any] to represent JSON objects, and instead of using Any to represent arbitrary JSON values, it uses an abstract data type, `JsValue`, to represnt JSON values. `JsValue` has several subtypes, representing the possible kinds of JSON values: `JsString`, `JsNumber`, `JsObject`, `JsArray`, `JsBoolean` (`JsTrue`, `JsFalse`), and `JsNull`.

处理这种形式的 JSON 数据涉及到模式匹配。由于 JsValue 是密封的，如果您没有处理所有情况，编译器会警告您。例如， 的代码`toJson`，一个接受 a`JsValue`并返回`String`该值表示的方法，如下所示：

```
 def toJson(x: JsValue): String = x match {
    case JsNull => "null"
    case JsBoolean(b) => b.toString
    case JsString(s) => "\"" + s + "\""
    case JsNumber(n) => n.toString
    case JsArray(xs) => xs.map(toJson).mkString("[",", ","]")
    case JsObject(m) => m.map{case (key, value) => toJson(key) + " : " + toJson(value)}.mkString("{",", ","}")
  } 
```

模式匹配既让我们确保我们正在处理每一种情况，也让我们从它的 JsType 中“解包”底层值。它提供了一种类型安全的方式来了解我们已经处理了每个案例。

此外，如果您在编译时知道您正在处理的 JSON 数据的结构，您可以做一些非常酷的事情，比如[n8han 的提取器](http://technically.us/code/x/weaving-tweed-with-scala-and-json/)。很强大的东西，看看。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T17:22:52.883

好吧，有几种方法可以解决这个问题。我可能只会使用`Map[String, Any]`，它应该可以很好地满足您的目的（只要地图来自`collection.immutable`而不是`collection.mutable`）。但是，如果您*真的*想经历一些痛苦，可以为此提供一个类型：

```
sealed trait InnerData[+A] {
  val value: A
}

case class InnerString(value: String) extends InnerData[String]
case class InnerMap[A, +B](value: Map[A, B]) extends InnerData[Map[A, B]]
case class InnerBoolean(value: Boolean) extends InnerData[Boolean] 
```

现在，假设您正在将 JSON`data`字段读入名为 的 Scala 字段中`jsData`，您将为该字段指定以下类型：

```
val jsData: Map[String, Either[Int, InnerData[_]] 
```

每次从 中拉出一个字段时`jsData`，都需要进行模式匹配，检查该值是类型`Left[Int]`还是`Right[InnerData[_]]`（的两个子类型`Either[Int, InnerData[_]]`）。获得内部数据后，您将对其进行模式匹配以*确定*它是否代表`InnerString`,`InnerMap`或`InnerBoolean`.

从技术上讲，无论如何，您都必须进行这种模式匹配，以便在您将数据从 JSON 中提取出来后使用它。良好类型方法的优点是编译器会检查您以确保您没有错过任何可能性。缺点是你不能跳过不可能的事情（比如`'eggs'`映射到一个`Int`）。此外，所有这些包装对象都会产生一些开销，因此请注意这一点。

请注意，Scala 确实允许您定义一个类型别名，该别名应减少为此所需的 LoC 数量：

```
type DataType[A] = Map[String, Either[Int, InnerData[A]]]

val jsData: DataType[_] 
```

添加一些隐式转换以使 API 更漂亮，您应该会变得漂亮而花花公子。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T17:26:07.460

JSON 在“Scala 编程”中的组合子解析一章中用作示例。

# nmake - 什么是 NMAKE，我该如何使用它？

> ID：728873
> 
> 赞同：14
> 
> 时间：2009-04-08T07:23:01.857
> 
> 标签：nmake

什么是 NMAKE，我该如何使用它？

NMAKE有很好的教程吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-08T07:24:19.513

[`NMAKE`](http://msdn.microsoft.com/en-us/library/dd9y37ha.aspx)是微软的[`make`](http://en.wikipedia.org/wiki/Make_(software))工具实现。

# lucene - 城市名称查询

> ID：728877
> 
> 赞同：0
> 
> 时间：2009-04-08T07:24:54.753
> 
> 标签：lucene, lucene.net

我是 Lucene 的新手，正在使用 Lucene 开发城市搜索 API。如果用户输入 san francisco 作为搜索输入，那么它应该只给出完全匹配的城市，而不是 San Jose/San Diego 等。

我应该如何在 Lucene 中索引城市名称？我需要使用哪个 Lucene 分析器和查询类？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T07:42:06.053

使用 StandardAnalyzer 索引您的内容。然后使用[PhraseQuery](http://lucene.apache.org/java/2_3_0/api/org/apache/lucene/search/PhraseQuery.html)进行搜索。为此，只需将查询字符串用作带有双引号的“san francisco”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-07-01T11:01:46.977

```
<?php
if(isset($_POST['submit']) && $_POST['submit']=='submit' ){
    $city   =   $_POST['city'];  
    $query  =  "SELECT * FROM libreary  WHERE city LIKE'".$city."'";
    $row    =  mysqli_query($con,$query);
    $result =  mysqli_num_rows($row);
if($result>0){
    while($row1 = mysqli_fetch_array($row)){
        print_r($row1);
    }
}
    $respon['Response'] = $response; 
    print_r(json_encode($respon));

}
?> 
```

# c# - 在启动时自动运行程序并在 PPC 上从内存中停止应用程序

> ID：728882
> 
> 赞同：1
> 
> 时间：2009-04-08T07:27:57.557
> 
> 标签：c#, pocketpc

当窗口关闭时，我必须停止应用程序。单击 (x) 按钮时，窗口将保留在内存中。如何删除内存中的应用程序？另一个问题是我希望在硬重启袖珍电脑时安装应用程序，我该怎么做？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T07:42:00.017

默认情况下，当您单击右上角的 X 时，表单将隐藏。您需要将表单的“MinimizeBox”属性设置为“False”，以关闭应用程序。

在硬重启（通常称为冷启动）时安装应用程序需要您将应用程序的 CAB 文件放在设备的闪存（永久）内存中。然后，您通常必须编写一个脚本并将其放置在某个地方以调用 CAB。这可能因设备而异，因此您必须查看该设备。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T07:42:09.923

将窗体的 MinimizeBox 属性设置为 False 会导致出现“确定”按钮。Ok 按钮用于关闭应用程序而不是最小化

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T07:44:03.087

要防止应用程序最小化这是 PocketPC 应用程序的默认行为，请将表单上的 MinimizeBox 选项设置为 false。

至于您的第二个选项，这可能会更棘手，因为它取决于 PDA。如果它具有持久内存，您可以将它放在那里，并找到一种在初始化期间运行 CAB 文件的方法。

[更新] windows 菜单中似乎有一个启动文件夹。也许您可以编写一个实用程序来检查您的应用程序是否已安装，如果没有则启动 CAB 安装程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T08:07:51.640

默认行为确实是最小化应用程序。使用替换 [x] 的自定义任务管理器，您可以调整此行为。一些供应商（例如 HTC）专门为此目的包含自定义任务管理器。

一个通用但很好的任务管理器是[WkTASK](http://soft.photoracer.net/docs/wktask_en.html)，这里是相关的功能描述：

> **X 按钮**
> 使用 X 按钮，您可以使用如下操作：
> 
> *   点击：真的很近
> *   长按：显示上下文菜单
> *   拖动：一些手势（要显示程序启动器，请向下拖动。要显示今天，请向左拖动。）

WkTASK 提供了更多功能，但您可以对其进行微调以仅执行您想要的操作。

# python - 定义Python源代码编码的正确方法

> ID：728891
> 
> 赞同：175
> 
> 时间：2009-04-08T07:35:05.290
> 
> 标签：python, encoding

[PEP 263](http://www.python.org/dev/peps/pep-0263/)定义了如何声明 Python 源代码编码。

通常，Python 文件的前 2 行应以：

```
#!/usr/bin/python
# -*- coding: <encoding name> -*- 
```

但是我看到很多文件都以：

```
#!/usr/bin/python
# -*- encoding: <encoding name> -*- 
```

=>**编码**而不是**编码**。

那么声明文件编码的正确方法是什么？

是否允许**编码**，因为使用的正则表达式是惰性的？或者它只是声明文件编码的另一种形式？

我问这个问题是因为 PEP 不谈论**编码**，它只是谈论**编码**。

* * *

## 回答 #1

> 赞同：167
> 
> 时间：2009-04-08T08:20:41.127

[在此处](http://docs.python.org/reference/lexical_analysis.html#encoding-declarations)查看文档：

“如果 Python 脚本的第一行或第二行中的注释与正则表达式匹配，则`coding[=:]\s*([-\w.]+)`将此注释作为编码声明处理”

“这种表达的推荐形式是

```
# -*- coding: <encoding-name> -*- 
```

它也被 GNU Emacs 识别，并且

```
# vim:fileencoding=<encoding-name> 
```

这被 Bram Moolenaar 的 VIM 识别。”

因此，您可以在“编码”部分之前放置几乎任何内容，但如果您想 100% 兼容 python-docs-recommendation，请坚持使用“编码”（不带前缀）。

更具体地说，您需要使用 Python 识别的任何内容*以及您使用的特定编辑软件*（如果它需要/接受任何内容）。例如`coding`，GNU Emacs 可以识别（开箱即用）该表单，但 Vim 不识别（是的，没有普遍的协议，它本质上是一场[地盘争夺战](https://en.wikipedia.org/wiki/Turf_war)）。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-04-08T08:21:12.310

263:

> 第一行或第二行必须匹配正则表达式“coding[:=]\s*([-\w.]+)”

因此，“encoding **: UTF-8** ”匹配。

PEP 提供了一些示例：

```
#!/usr/bin/python
# vim: set fileencoding=<encoding name> : 
```

```
# This Python file uses the following encoding: utf-8
import os, sys 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2016-03-22T19:28:47.653

只需将下面的语句复制粘贴到程序顶部即可。它将解决字符编码问题

```
#!/usr/bin/env python
# -*- coding: utf-8 -*- 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2018-06-25T08:13:02.283

### 截至今天 - 2018 年 6 月

* * *

[PEP 263](https://www.python.org/dev/peps/pep-0263/)本身提到了它遵循的正则表达式：

> 要定义源代码编码，必须将魔术注释放在源文件中，作为文件的第一行或第二行，例如：
> 
> ```
> # coding=<encoding name> 
> ```
> 
> 或（使用流行编辑认可的格式）：
> 
> ```
> #!/usr/bin/python
> # -*- coding: <encoding name> -*- 
> ```
> 
> 或者：
> 
> ```
> #!/usr/bin/python
> # vim: set fileencoding=<encoding name> : 
> ```
> 
> 更准确地说，第一行或第二行必须匹配以下正则表达式：
> 
> ```
> ^[ \t\f]*#.*?coding[:=][ \t]*([-_.a-zA-Z0-9]+) 
> ```

因此，正如其他答案已经总结的那样，它将`coding`与任何前缀匹配，但是如果您想尽可能地符合 PEP 标准（尽管据我所知，使用`encoding`而不是`coding`不违反PEP 263 以任何方式）——坚持使用 'plain' `coding`，没有前缀。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T07:46:39.507

如果我没记错的话，源文件编码的原始提议是在前几行使用正则表达式，这将允许两者。

我认为正则表达式类似于`coding:`后面的东西。

我发现了这个： http: [//www.python.org/dev/peps/pep-0263/](http://www.python.org/dev/peps/pep-0263/) 这是最初的提议，但我似乎找不到最终的规范说明他们做了什么。

我当然已经习惯`encoding:`了很好的效果，所以很明显这很有效。

尝试换成完全不同的东西，`duhcoding: ...`看看它是否同样有效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T07:43:34.117

我怀疑它类似于 Ruby - 任何一种方法都可以。

这主要是因为不同的文本编辑器使用不同的方法（即这两种）进行标记编码。

使用 Ruby，只要第一个或第二个（如果有 shebang 行）包含匹配的字符串：

```
coding: encoding-name 
```

并忽略这些行上的任何空格和其他绒毛。（它通常也可以是 = 而不是 :）。

# c - 微型内存管理器

> ID：728895
> 
> 赞同：2
> 
> 时间：2009-04-08T07:37:13.307
> 
> 标签：c, memory, memory-management

我有一大块内存，让我们说'NN'MB。我想要一个只从这个内存分配的自定义内存管理器。内存管理器应该能够使用已经可用的块进行分配和释放。如果它也可以处理碎片，那就太好了。

编辑：我在 C 中寻找一些开源，或者是否有一些 API，如 malloc 和 free。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T07:47:26.230

能够“处理”碎片是一个相当苛刻的要求。如果您的意思是管理器必须能够对内存进行碎片整理，这意味着它不能拥有标准的 C `malloc()`API。您需要一个间接 API，其中内存分配不是由实际可直接取消引用的地址引用，而是更抽象的东西。

这是因为您的内存管理器必须能够在碎片整理期间移动分配的内存块，如果应用程序将直接绝对指针保存到分配的内存中，它就无法做到这一点。

当然，强制应用程序间接使用内存意味着许多常见的 C 习惯用法和 API 会被破坏，因为自由使用指针的期望在 C 中很常见。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T07:54:51.687

我强烈建议检查 Andrei Alexandrescu 的[Policy-Based Memory Allocation Fine-tuning your memory management](http://www.ddj.com/cpp/184402039)

还有一段他就该主题所做[的演讲视频，](http://video.google.com/videoplay?docid=8718136231005757634)也强烈推荐作为学习资源。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T07:39:09.167

必须是C吗？C++ 的 Loki 分配器可以做到这一点

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T09:03:05.803

请参阅 glib malloc() 和内存减少

[http://live.gnome.org/MemoryReduction](http://live.gnome.org/MemoryReduction)

# c# - SyncRoot 模式有什么用？

> ID：728896
> 
> 赞同：71
> 
> 时间：2009-04-08T07:37:52.930
> 
> 标签：c#, multithreading, design-patterns, concurrency

我正在阅读描述 SyncRoot 模式的 ac# 书。表明

```
void doThis()
{
    lock(this){ ... }
}

void doThat()
{
    lock(this){ ... }
} 
```

并与 SyncRoot 模式进行比较：

```
object syncRoot = new object();

void doThis()
{
    lock(syncRoot ){ ... }
}

void doThat()
{
    lock(syncRoot){ ... }
} 
```

但是，我不太了解这里的区别；似乎在这两种情况下，两种方法一次只能由一个线程访问。

这本书描述了*......因为实例的对象也可以用于从外部进行同步访问，并且您无法从类本身控制这种形式，您可以使用SyncRoot模式*嗯？'实例的对象'？

谁能告诉我上面两种方法的区别？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-04-08T07:43:07.673

如果您想要防止多个线程同时访问的内部数据结构，您应该始终确保您锁定的对象不是公共的。

这背后的原因是任何人都可以锁定公共对象，因此您可以创建死锁，因为您无法完全控制锁定模式。

这意味着锁定`this`不是一种选择，因为任何人都可以锁定该对象。同样，你不应该锁定你暴露给外界的东西。

这意味着最好的解决方案是使用内部对象，因此提示就是使用`Object`.

锁定数据结构是您真正需要完全控制的事情，否则您可能会设置死锁场景，这可能会非常难以处理。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-12-15T12:38:57.710

这种模式的实际目的是实现与包装层次结构的正确同步。

例如，如果类 WrapperA 包装了 ClassThanNeedsToBeSynced 的实例，而类 WrapperB 包装了同一个 ClassThanNeedsToBeSynced 实例，则您不能锁定 WrapperA 或 WrapperB，因为如果锁定 WrapperA，锁定 WrappedB 将不会等待。出于这个原因，您必须锁定 wrapperAInst.SyncRoot 和 wrapperBInst.SyncRoot，它们将锁定委托给 ClassThanNeedsToBeSynced 的锁定。

例子：

```
public interface ISynchronized
{
    object SyncRoot { get; }
}

public class SynchronizationCriticalClass : ISynchronized
{
    public object SyncRoot
    {
        // you can return this, because this class wraps nothing.
        get { return this; }
    }
}

public class WrapperA : ISynchronized
{
    ISynchronized subClass;

    public WrapperA(ISynchronized subClass)
    {
        this.subClass = subClass;
    }

    public object SyncRoot
    {
        // you should return SyncRoot of underlying class.
        get { return subClass.SyncRoot; }
    }
}

public class WrapperB : ISynchronized
{
    ISynchronized subClass;

    public WrapperB(ISynchronized subClass)
    {
        this.subClass = subClass;
    }

    public object SyncRoot
    {
        // you should return SyncRoot of underlying class.
        get { return subClass.SyncRoot; }
    }
}

// Run
class MainClass
{
    delegate void DoSomethingAsyncDelegate(ISynchronized obj);

    public static void Main(string[] args)
    {
        SynchronizationCriticalClass rootClass = new SynchronizationCriticalClass();
        WrapperA wrapperA = new WrapperA(rootClass);
        WrapperB wrapperB = new WrapperB(rootClass);

        // Do some async work with them to test synchronization.

        //Works good.
        DoSomethingAsyncDelegate work = new DoSomethingAsyncDelegate(DoSomethingAsyncCorrectly);
        work.BeginInvoke(wrapperA, null, null);
        work.BeginInvoke(wrapperB, null, null);

        // Works wrong.
        work = new DoSomethingAsyncDelegate(DoSomethingAsyncIncorrectly);
        work.BeginInvoke(wrapperA, null, null);
        work.BeginInvoke(wrapperB, null, null);
    }

    static void DoSomethingAsyncCorrectly(ISynchronized obj)
    {
        lock (obj.SyncRoot)
        {
            // Do something with obj
        }
    }

    // This works wrong! obj is locked but not the underlaying object!
    static void DoSomethingAsyncIncorrectly(ISynchronized obj)
    {
        lock (obj)
        {
            // Do something with obj
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-04-08T07:45:24.050

这是一个例子：

```
class ILockMySelf
{
    public void doThat()
    {
        lock (this)
        {
            // Don't actually need anything here.
            // In this example this will never be reached.
        }
    }
}

class WeveGotAProblem
{
    ILockMySelf anObjectIShouldntUseToLock = new ILockMySelf();

    public void doThis()
    {
        lock (anObjectIShouldntUseToLock)
        {
            // doThat will wait for the lock to be released to finish the thread
            var thread = new Thread(x => anObjectIShouldntUseToLock.doThat());
            thread.Start();

            // doThis will wait for the thread to finish to release the lock
            thread.Join();
        }
    }
} 
```

您会看到第二个类可以在 lock 语句中使用第一个类的实例。这会导致示例中的死锁。

正确的 SyncRoot 实现是：

```
object syncRoot = new object();

void doThis()
{
    lock(syncRoot ){ ... }
}

void doThat()
{
    lock(syncRoot ){ ... }
} 
```

由于`syncRoot`是私有字段，您不必担心该对象的外部使用。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-04-08T07:50:46.377

这是与此主题相关的另一件有趣的事情：

[SyncRoot 在集合上的可疑值（由 Brad Adams 撰写）](http://web.archive.org/web/20140817041947/http://blogs.msdn.com/b/brada/archive/2003/09/28/50391.aspx)：

> 您会`SyncRoot`注意到`System.Collections`. 回想起来（原文如此），我认为这个属性是一个错误。我团队的项目经理 Krzysztof Cwalina 刚刚给我发了一些关于为什么会这样的想法——我同意他的观点：
> 
> 我们发现`SyncRoot`基于 - 的同步 API 在大多数情况下不够灵活。API 允许线程安全地访问集合的单个成员。问题是在许多情况下您需要锁定多个操作（例如删除一个项目并添加另一个项目）。换句话说，通常是使用集合的代码想要选择（并且可以实际实现）正确的同步策略，而不是集合本身。我们发现它`SyncRoot`实际上很少使用，在使用它的情况下，它实际上并没有增加太多价值。在不使用它的情况下，它只会让`ICollection`.
> 
> 请放心，在构建这些集合的通用版本时，我们不会犯同样的错误。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-08T07:46:30.710

请参阅[此](https://docs.microsoft.com/en-us/archive/msdn-magazine/2003/january/net-column-safe-thread-synchronization)Jeff Richter 的文章。更具体地说，这个示例演示了锁定“this”会导致死锁：

```
using System;
using System.Threading;

class App {
   static void Main() {
      // Construct an instance of the App object
      App a = new App();

      // This malicious code enters a lock on 
      // the object but never exits the lock
      Monitor.Enter(a);

      // For demonstration purposes, let's release the 
      // root to this object and force a garbage collection
      a = null;
      GC.Collect();

      // For demonstration purposes, wait until all Finalize
      // methods have completed their execution - deadlock!
      GC.WaitForPendingFinalizers();

      // We never get to the line of code below!
      Console.WriteLine("Leaving Main");
   }

   // This is the App type's Finalize method
   ~App() {
      // For demonstration purposes, have the CLR's 
      // Finalizer thread attempt to lock the object.
      // NOTE: Since the Main thread owns the lock, 
      // the Finalizer thread is deadlocked!
      lock (this) {
         // Pretend to do something in here...
      }
   }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-08T08:02:53.820

另一个具体的例子：

```
class Program
{
    public class Test
    {
        public string DoThis()
        {
            lock (this)
            {
                return "got it!";
            }
        }
    }

    public delegate string Something();

    static void Main(string[] args)
    {
        var test = new Test();
        Something call = test.DoThis;
        //Holding lock from _outside_ the class
        IAsyncResult async;
        lock (test)
        {
            //Calling method on another thread.
            async = call.BeginInvoke(null, null);
        }
        async.AsyncWaitHandle.WaitOne();
        string result = call.EndInvoke(async);

        lock (test)
        {
            async = call.BeginInvoke(null, null);
            async.AsyncWaitHandle.WaitOne();
        }
        result = call.EndInvoke(async);
    }
} 
```

在此示例中，第一次调用将成功，但如果您在调试器中进行跟踪，则对 DoSomething 的调用将阻塞，直到锁被释放。第二次调用将死锁，因为主线程在**test**上持有监视器锁。

问题是 Main 可以锁定对象实例，这意味着它可以阻止实例执行对象认为应该同步的任何事情。关键是对象本身知道什么需要锁定，外部干扰只是自找麻烦。这就是为什么拥有一个私有成员变量的模式，您可以*专门*用于同步而不必担心外部干扰。

等效的静态模式也是如此：

```
class Program
{
    public static class Test
    {
        public static string DoThis()
        {
            lock (typeof(Test))
            {
                return "got it!";
            }
        }
    }

    public delegate string Something();

    static void Main(string[] args)
    {
        Something call =Test.DoThis;
        //Holding lock from _outside_ the class
        IAsyncResult async;
        lock (typeof(Test))
        {
            //Calling method on another thread.
            async = call.BeginInvoke(null, null);
        }
        async.AsyncWaitHandle.WaitOne();
        string result = call.EndInvoke(async);

        lock (typeof(Test))
        {
            async = call.BeginInvoke(null, null);
            async.AsyncWaitHandle.WaitOne();
        }
        result = call.EndInvoke(async);
    }
} 
```

使用私有静态对象进行同步，而不是使用类型。

# sql - 您可以在 T-SQL 中对存储过程的结果进行选择吗

> ID：728898
> 
> 赞同：5
> 
> 时间：2009-04-08T07:38:44.347
> 
> 标签：sql, sql-server-2005, stored-procedures

```
select * from (EXEC sp_SomeStoredProc) 
```

如果你不能这样做，那么是什么阻止它被添加到 SQL 标准或 T-SQL 中？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-08T07:41:07.710

您不能这样做，但是您可以将其作为插入来执行。例如

```
insert mytable
exec myStoredProcedure 
```

此外，永远不要将存储过程命名为 sp_xxxx。这是因为在查找用户存储过程之前，由于 sp_，SQL 将始终在系统存储过程区域中进行搜索，从而导致性能上的少量损失，这可能会使它在频繁运行的进程中变得相当重要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T08:14:29.423

这是可能的，但肯定不是正确的方法：

```
USE test
GO
CREATE procedure dbo.select1 AS
SELECT 1 
GO
EXEC sp_addlinkedserver @server='OQtest', @datasrc='localhost', @provider='SQLNCLI', @srvproduct=''
GO
SELECT * FROM OPENQUERY(OQtest, 'test.dbo.select1') 
```

您可能还需要调整服务器上的安全设置才能使其正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T07:46:30.927

如果存储过程没有返回行怎么办？多个结果集？变化？存储过程的潜在用途多种多样。

当您拥有`SELECT * FROM TableOrView`时，就会有直接绑定和易于检查的语法和结构。

更准确地说，在关系意义上，存储过程不是关系/表，因此您无法从中进行选择。

用户定义的函数可以实现您想要的，但允许代码符合某些关系/表概念。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T07:51:56.577

你不能这样做，但你可以考虑sqlserver2005中的一个函数。这是一个从逗号分隔列表创建表的示例函数

```
Create Function [dbo].[CsvToInt] ( @Array varchar(1000)) 
returns @IntTable table 
    (IntValue int)
AS
begin

    declare @separator char(1)
    set @separator = ','

    declare @separator_position int 
    declare @array_value varchar(1000) 

    set @array = @array + ','

    while patindex('%,%' , @array) <> 0 
    begin

      select @separator_position =  patindex('%,%' , @array)
      select @array_value = left(@array, @separator_position - 1)

        Insert @IntTable
        Values (Cast(@array_value as int))

      select @array = stuff(@array, 1, @separator_position, '')
    end

    return
end 
```

然后从函数中简单选择...

```
Select * FROM dbo.CsvToInt('1,2,3,5') 
```

你会得到一个表值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T08:32:20.363

您可以使用 ck 描述的方法，但实际上并不推荐这样做。您可以查看[Erland Sommarskog 撰写](http://www.sommarskog.se/)的[如何在存储过程之间共享数据的精彩帖子的](http://www.sommarskog.se/share_data.html)[INSERT-EXEC](http://www.sommarskog.se/share_data.html#INSERTEXEC)部分以了解更多详细信息。

# asp.net - asp.net 生成没有密钥存储的 RSA 公钥对

> ID：728899
> 
> 赞同：2
> 
> 时间：2009-04-08T07:38:47.450
> 
> 标签：asp.net, security

我必须在 Windows 服务和 asp.net 网站之间进行一些安全通信。在 asp.net 网站中，我正在生成一个密钥对，将我的公钥发送到我的 Windows 服务，然后从我的服务接收加密消息并使用 asp.net 解密。

第一个问题是这个..[用户配置文件不是在 asp.net 中创建的，](http://blogs.msdn.com/alejacma/archive/2007/12/03/rsacryptoserviceprovider-fails-when-used-with-asp-net.aspx)所以我必须使用 RSAParams.Flags = CspProviderFlags.UseMachineKeyStore;。

这在我的托管服务提供商中不起作用，因为我无权访问我的机器商店。

我认为我的解决方案是在内存中生成密钥对并且从不使用密钥库，这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T15:44:03.820

结帐[http://www.codeproject.com/KB/security/EZRSA.aspx](http://www.codeproject.com/KB/security/EZRSA.aspx)文章摘录：

“救命！我们该怎么办？？在谷歌上搜索了一下，然后给我们（优秀的）网络托管服务提供商 Liquid Six 发了一封快速的电子邮件，发现其原因在于 RSACryptoServiceProvider 所基于的 Windows crypt API 的深处。从本质上讲，允许脚本加载自己的私钥会损害 Windows 密钥存储的安全性，因此所有明智的 Web 托管服务提供商都将其关闭，以免流氓脚本窃取/覆盖托管服务提供商自己的私钥。这让我印象深刻Windows crypt API 中的主要问题，但你去吧。我想我们被它困住了。

更多的谷歌搜索发现了两个基本资源：Chew Keong TAN 最优秀的 BigInteger 类和一些 LGPL 'C' 代码来进行必要的计算和来自 XySSL 的 PKCS#1 封装（最初由 Christopher Devine 编写）。这些资源对我特别有用，因为 (a) 处理具有数百位数字的数字的能力是一个专业领域，并且 (b) 我讨厌 ASN.1（PKCS#1 格式建立在它之上）。计算本身看似简单。

经过一两天的缝合和修补，EZRSA 诞生了。EZRSA 几乎可以完成 RSACryptoServiceProvider 可以做的所有事情，但完全在托管代码中，并且不使用 Windows crypt API。因此，它可以在任何地方运行，无论您的网络托管服务提供商对您施加什么信任级别（这是我们所需要的）。”

希望能帮助到你！

# plugins - 如何扩展 Windows 资源管理器功能？

> ID：728901
> 
> 赞同：1
> 
> 时间：2009-04-08T07:40:03.143
> 
> 标签：plugins, windows-xp, explorer

我将如何在 XP 中扩展 Windows 资源管理器的功能？

有什么方法可以让我创建一个可以挂接到 explore.exe 的“插件”以添加额外的文件夹浏览功能？我可以使用什么语言来实现这一目标？

这是我[在这里提出的问题的扩展。](https://stackoverflow.com/questions/575639/how-can-i-get-windows-explorer-to-browse-to-next-folder-vbscript-batch-etc)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T07:43:22.540

[CodeProject](http://www.codeproject.com/KB/shell/shellextguideindex.aspx)上有一系列很棒的教程可能会对您有所帮助。那里需要 C++。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T08:53:27.147

有一本名为[“Visual Basic Shell Programming”](https://rads.stackoverflow.com/amzn/click/com/1565926706)的旧 O'reilly 书，其中详细解释了 API。虽然从以 VB6 为中心的角度来看，API 都是通过 COM 公开的，因此可以从任何支持这一点的语言中使用它们。 [本文](http://www.theserverside.net/tt/articles/showarticle.tss?id=ShellExtensions)讨论了使用带有 .Net 的 windows shell 和构建互操作程序集的工具。

# c# - 我可以从 Main 构造函数中关闭程序吗？

> ID：728921
> 
> 赞同：4
> 
> 时间：2009-04-08T07:45:34.440
> 
> 标签：c#, multithreading, screen, loading, main

您可以在构造函数完成并加载主窗体之前退出应用程序吗？

在启动时，我有一个加载屏幕，在加载主窗体之前显示。在构造函数完成之前从构造函数显示加载屏幕。

我通过在主窗体和退出屏幕之间使用变量来对退出屏幕执行类似的操作。如果退出屏幕返回 true，我在主窗体中有一个应用程序退出。

最后，应该在主构造函数中完成所有线程/类/加载/程序设置还是我做错了？

### 更新：

我的意思是在 program.cs 和静态 main 之后

```
namespace app
{
 public partial class app1 : Form
 {
   public app1()
   {  
      InitializeComponent();
      // open loading screen
      // initialize vars
      // create objects
   }
 // form opens when app1() finishes 
```

1.  是`app1()`初始化一切的正确位置吗？
2.  如果我在完成之前尝试从加载屏幕发回“关闭”消息`app1()`，则它不起作用 - 即使没有任何内容打开，该过程仍会运行。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-14T11:57:59.650

我发现，当我仍然在不同的线程上显示初始屏幕（看起来与您正在做的事情相似）时，如果我尝试从主表单构造函数中终止我的应用程序，那`Application.Exit()`不起作用，但`Environment.Exit(-1)`确实如此。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-07-22T02:22:36.200

尝试这个，

```
 public partial class MyForm : Form
    {        
    public MyForm()
    {
     if (MyFunc())
        {
            this.Shown += new EventHandler(MyForm_CloseOnStart);
        }
    }

    private void MyForm_CloseOnStart(object sender, EventArgs e)
    {
         this.Close();
    }
    } 
```

它会运作良好......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T12:44:49.370

当主线程结束时：

*   后台线程被“杀死/放弃”
*   等待前台线程（创建线程时的默认设置）直到它们完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T12:50:51.350

您只能通过抛出异常来破坏构造函数。要偷偷地做到这一点，请抛出您自己的特定异常。

```
class ConstructorAbortedException : Exception { }

class Foo
{
  public Foo()
  {
    if(goesWrong)
    {
      throw new ConstructorAbortedException();
    }
  }
}

void Bar()
{
  try
  {
    Foo f = new Foo();
  }
  catch(ConstructorAbortedException)
  {
    //..
  }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T07:49:43.540

哪个类的哪个主要构造函数？

您是在谈论`Main`在类中具有默认位置的静态方法`Program`吗？

您可以使用该方法进行在屏幕上打开任何窗口之前需要进行的初始化。

显然，如果您需要使用加载屏幕，您可能需要将一些代码移动到其他地方，因为您需要围绕表单的消息循环，并且消息循环将阻塞，直到您的表单关闭。

如果在打开任何表单之前从 Main 方法返回，则不会明显显示任何表单。

说了这么多，我觉得你的问题有点含糊，我很确定我不明白你在问什么。

首先，`Main`它不是构造函数，它只是一个静态方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-07-26T14:13:03.127

正如 jontsnz 回答的

`Environment.Exit(-1)`

那样，构造函数中的代码可以正常工作，但这会导致应用程序抛出“应用程序挂起”事件，这可以被视为 Windows 事件查看器中的错误。虽然使用

`Environment.Exit(0)`

退出而不注册错误，所以我更喜欢那个。

# java - Java Applet 为用户而不是管理员关闭 IE - JAVAPOLICY.EXE 文件在哪里？

> ID：728922
> 
> 赞同：0
> 
> 时间：2009-04-08T07:46:00.587
> 
> 标签：java, windows, internet-explorer, applet

我对 Win2003 有问题，即 Java Applet 为用户而不是管理员关闭 IE。

我找到了以下解决方案，但它指的是缺少 JAVAPOLICY.EXE 文件：

[http://www.experts-exchange.com/Programming/Languages/Java/J2SE/Q_22694925.html](http://www.experts-exchange.com/Programming/Languages/Java/J2SE/Q_22694925.html)

这个 javapolicy.exe 文件在哪里，它不包含在最新的 JRE6 中？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T17:19:00.503

您应该能够在以下位置找到 policytool.exe

```
C:\Program Files\Java\jre6\bin 
```

政策文件位于

```
C:\Program Files\Java\jre6\lib\security\java.policy 
```

# svn - 如何使用 git-svn 切换 svn 分支？

> ID：728931
> 
> 赞同：22
> 
> 时间：2009-04-08T07:49:23.587
> 
> 标签：svn, git, git-svn

### 复制

> [如何让 git-svn 使用特定的 svn 分支作为远程存储库？](https://stackoverflow.com/questions/192736/how-do-i-make-git-svn-use-a-particular-svn-branch-as-the-remote-repository)

我正在使用 git-svn 来跟踪其他人在 svn 上的开发。我试图弄清楚如何使用 gti-svn 从一个 svn 分支切换到另一个。我能找到的所有示例都在谈论使用 svn switch 作为切换位置而不是实际分支的方法。

本质上，我想使用 svn fetch 从 /svn/branch/1.3 而不是 /svn/branch/1.2 开始。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-19T11:17:06.073

在通过 git-svn 处理 svn 分支时，这些命令对我非常有用：

```
#create local Git branch that mirrors remote svn branch

git checkout -b local/RELEASE-0.12 RELEASE-0.12 
#will connect with a remote svn branch named ‘RELEASE-0.12′

# -n will show which svn branch you will commit into:
git svn dcommit --dry-run 
```

请参阅我关于[justaddwater.dk](http://www.justaddwater.dk/2009/03/09/using-git-for-svn-repositories-workflow/)的文章中的完整说明。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-08T08:26:58.677

如果您已正确克隆了 SVN 存储库（使用`-T -b -t`或`-s`），您应该能够使用 git 分支命令，例如：

```
git reset --hard remotes/branch

git checkout branch 
```

等等

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-11-16T09:39:21.730

根据我的经验，它工作得很好

```
git checkout -b RELEASE-0.12 RELEASE-0.12 
```

`local/`不需要前缀，并且将其排除在外对我来说不会那么混乱。旧`RELEASE-0.12`分支已经是远程分支，所以 git 不会将它与新分支混淆。

上面的命令不会创建跟踪分支关系。但这不是必需的，`git svn rebase`无论如何都可以按预期工作。

# c# - C# + Custom graphics on controls?

> ID：728933
> 
> 赞同：1
> 
> 时间：2009-04-08T07:50:22.650
> 
> 标签：c#, winforms, user-controls

I was just wondering if there are ways of creating my own custom winforms controls? I've been plundering with Visual Studio 2008 now trying to do some c# apps. And the GUI end up looking terrible because of the standard winforms limitations.

And I noticed that I can add images to buttons for example, but ther's no hover effect. Or, the hover effect makes the whole button area gray. I don't want any of that, I just want to either create my own graphics for the controls or find some free (opensource perhaps) controls that already exist.

Any light on any of this, anyone? :)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T07:57:00.183

You can write complete Winforms controls from scratch, doing all the painting and input processing yourself - you just create a class derived from 'Control' and get on with it.

There's a fair bit to making a first-class control which integrates nicely with the VS designer, so people tend to derive their custom control from an existing control which has most of the behaviour they want.

Here would be a good place to start: [http://msdn.microsoft.com/en-us/library/6hws6h2t.aspx](http://msdn.microsoft.com/en-us/library/6hws6h2t.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T07:55:40.467

First - may be more pragmatic to look at WPF, or hosting some WPF elements inside winforms (which is supported - [like so](http://nayyeri.net/blog/host-wpf-controls-in-windows-forms/)). Other than that - you *can* do all your own painting if you want; but it is a lot of work.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T07:57:36.860

Any reason why you don't use WPF? You have much more more UI control if you went down the route.

If you must go with WinForms then there are many commercial solutions like [DevExpress](http://www.devexpress.com/Products/NET/Controls/WinForms/Skins/index.xml). If you really want you own look and feel it'll be alot of work.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T07:58:34.407

Yes. You can create your own controls. It is called a User Control. Just select Add->and User Control.

WPF is a good alternative if you want your windows form to look fancy.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T08:44:20.680

I'm puzzled, you are doing WinForms development, yet in comments say you have done many months of WPF development, but WPF is not good enough because it is not cross platform.

How is WinForm more cross platform, and have you seen how ugly WinForms looks under mono on a Mac as it's draw via X11.

If you want style and cross platform, go for Flex or Silverlight, as your already know WPF I'd go the Silverlight route.

It's cross platform, and has all the beauty of WPF, but at the cost of reduced functionality out of the box.

# c - 如何在进入 VC 中的 main() 例程之前执行一些代码？

> ID：728939
> 
> 赞同：8
> 
> 时间：2009-04-08T07:52:32.067
> 
> 标签：c, msvcrt, crt

我正在阅读微软的 CRT 源代码，我可以想出以下代码，其中函数 __initstdio1 将在 main() 例程之前执行。

问题是，如何在进入 VC 中的 main() 例程之前执行一些代码（不是 VC++ 代码）？

```
#include <stdio.h>

#pragma section(".CRT$XIC",long,read)

int __cdecl __initstdio1(void);

#define _CRTALLOC(x) __declspec(allocate(x))

_CRTALLOC(".CRT$XIC") static pinit = __initstdio1;

int z = 1;

int __cdecl __initstdio1(void) {
    z = 10;
    return 0;
}

int main(void) {
    printf("Some code before main!\n");
    printf("z = %d\n", z);
    printf("End!\n");
    return 0;
} 
```

输出将是：

```
Some code before main!
z = 10
End! 
```

但是，我无法理解代码。

我在 .CRT$XIC 上做了一些谷歌搜索，但没有找到运气。一些专家可以向我解释上面的代码段，特别是以下内容：

1.  这条线`_CRTALLOC(".CRT$XIC") static pinit = __initstdio1;`是什么意思？变量pinit的意义是什么？
2.  在编译期间，编译器 (cl.exe) 会抛出如下警告：

Microsoft (R) 32 位 C/C++ 优化编译器版本 15.00.30729.01，适用于 80x86 版权所有 (C) Microsoft Corporation。版权所有。

```
stdmacro.c
stdmacro.c(9) : warning C4047: 'initializing' : 'int' differs in levels of indirection from 'int (__
cdecl *)(void)'
Microsoft (R) Incremental Linker Version 9.00.30729.01
Copyright (C) Microsoft Corporation.  All rights reserved.

/out:stdmacro.exe
stdmacro.obj 
```

需要采取哪些纠正措施来删除警告消息？

提前致谢。

添加：

我已经修改了代码并将 pinit 的类型指定为 _PIFV。现在警告信息消失了。

新代码如下：

```
#include <stdio.h>

#pragma section(".CRT$XIC1",long,read)

int __cdecl __initstdio1(void);

typedef int  (__cdecl *_PIFV)(void);

#define _CRTALLOC(x) __declspec(allocate(x))

_CRTALLOC(".CRT$XIC1") static _PIFV pinit1 = __initstdio1;

int z = 1;

int __cdecl __initstdio1(void) {
    z = 100;

    return 0;
}

int main(void) {
    printf("Some code before main!\n");
    printf("z = %d\n", z);
    printf("End!\n");
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T08:26:54.980

一个简单的方法来做到这一点。

```
#include <iostream>

int before_main()
{
    std::cout << "before main" << std::endl;
    return 0;
}

static int n = before_main();

void main(int argc, char* argv[])
{
    std::cout << "in main" << std::endl;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T08:05:04.220

这就是 _CRTALLOC 的定义：

```
extern _CRTALLOC(".CRT$XIA") _PVFV __xi_a[];
extern _CRTALLOC(".CRT$XIZ") _PVFV __xi_z[];// C initializers
extern _CRTALLOC(".CRT$XCA") _PVFV __xc_a[];
extern _CRTALLOC(".CRT$XCZ") _PVFV __xc_z[];// C++ initializers 
```

这是一张要预初始化的表格，其中`__initstdio1`放置了指向您的函数的指针。

此页面描述了 CRT 初始化：

[http://msdn.microsoft.com/en-us/library/bb918180.aspx](http://msdn.microsoft.com/en-us/library/bb918180.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T07:58:18.230

至少在 C++ 中，您不需要所有特定于实现的东西：

```
#include <iostream>

struct A {
   A() { std::cout << "before main" << std::endl; }
};

A a;

int main() {
   std::cout << "in main" << std::endl;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-11T20:13:29.723

不久前，我在 CodeGuru 上写了一篇关于此的获奖[文章。](http://www.codeguru.com/cpp/misc/misc/threadsprocesses/article.php/c6945)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T08:09:24.023

[这里](http://wiki.osdev.org/C_PlusPlus)有一些信息（搜索 CRT）。变量的意义`pinit`是没有的，它只是放在可执行文件中的一段数据，运行时可以在其中找到它。但是，我建议您给它一个类型，如下所示：

```
_CRTALLOC(".CRT$XIC") static void (*pinit)()=... 
```

链接器警告可能只是警告您有一个具有`int`返回类型的函数，但不返回任何内容（可能您最好将返回类型更改为`void`）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T20:10:41.730

即使在 C 中，也需要在`main()`输入之前运行一些代码，如果只是将命令行转换为 C 调用约定。在实践中，标准库需要一些初始化，具体的需求可能因编译而异。

`crt0`真正的程序入口点是在链接时设置的，并且由于历史原因通常位于一个类似名称的模块中。如您所见，该模块的源代码可在 crt 源代码中找到。

为了支持在链接时发现的初始化，使用了一个特殊的段。它的结构是一个固定签名的函数指针列表，将在早期迭代`crt0`并调用每个函数。在 C++ 链接中使用相同的函数指针数组（或非常相似的数组）来保存指向全局对象构造函数的指针。

链接器通过允许链接的每个模块在其中包含数据来填充数组，这些数据都连接在一起以形成最终可执行文件中的段。该变量的唯一意义`pinit`是它被声明（由`_CRTALLOC()`宏）位于该段中，并被初始化为要在 C 启动期间调用的函数的地址。

显然，这方面的细节是非常特定于平台的。对于一般编程，将初始化和当前 main 包装在 new 中可能会更好`main()`：

```
int main(int argc, char **argv) {
    early_init();
    init_that_modifies_argv(&argc, &argv);
    // other pre-main initializations...
    return real_main(argc,argv);
} 
```

出于特殊目的，修改`crt0`模块本身或执行特定于编译器的技巧来调用额外的早期初始化函数可能是最好的答案。例如，当构建在没有操作系统加载程序的情况下从 ROM 运行的嵌入式系统时，通常需要自定义`crt0`模块的行为以便完全有一个堆栈来将参数推送到`main()`. 在这种情况下，可能没有比修改`crt0`以初始化内存硬件以满足您的需要更好的解决方案了。

# php - 使用 PHP 库的分层 png 图像

> ID：728941
> 
> 赞同：0
> 
> 时间：2009-04-08T07:54:45.807
> 
> 标签：php, image, png

有人知道可以生成分层 PNG 图像的 PHP 库吗？（我不确定，但我认为 tiff 图像标准也支持图层）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T08:04:32.803

AFAIR，PNG 不支持图层。MNG 可以，您可以使用[ImageMagick](http://www.imagemagick.org)生成这些。
PHP 扩展见：[http ://www.php.net/imagick](http://www.php.net/imagick)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T07:39:21.967

从[ImageMagic](http://www.imagemagick.org) [API 站点](http://www.imagemagick.org/script/api.php)：

> PHP
> MagickWand for PHP 是 ImageMagick MagickWand API 的原生 PHP 扩展。
> IMagick 是一个原生 PHP 扩展，用于使用 ImageMagick API 创建和修改图像。此处提供了扩展的文档。
> phMagick 是 ImageMagick 的包装器类，将最常见的 Web 图像操作操作包装在易于使用的函数中，但允许通过向其命令行程序发出系统调用来完全访问 ImageMagick 的功能。
> 
> ImageMagick® 是一个用于创建、编辑和合成位图图像的软件套件。它可以读取、转换和写入各种格式（超过 100 种）的图像，包括 DPX、EXR、GIF、JPEG、JPEG-2000、PDF、PhotoCD、PNG、Postscript、SVG 和 TIFF。使用 ImageMagick 可以平移、翻转、镜像、旋转、缩放、剪切和变换图像，调整图像颜色，应用各种特殊效果，或绘制文本、线条、多边形、椭圆和贝塞尔曲线。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T08:29:37.033

假设您指的是烟花中的分层 PNG 文件，我认为您做不到。除了正确支持这些文件的烟花外，我什么都没看到。

# visual-studio - 在单个 Visual Studio 会话中打开文件的两个实例

> ID：728949
> 
> 赞同：611
> 
> 时间：2009-04-08T07:58:03.020
> 
> 标签：visual-studio, editor

我有一个文件*xyz.cpp*。我想在 Visual Studio 中打开这个文件的两个实例（顺便说一句，我使用的是 Visual Studio 2005）。我为什么要这样做？我想并排比较同一文件的两个部分。我知道解决方法，例如：

1.  制作文件的副本。但问题是它并不优雅，我不想每次遇到这种情况时都复制。

2.  我可以把窗口一分为二。拆分它的问题是我只能水平拆分它。水平分割的结果是我屏幕的右半部分是空白。

如果我能够垂直拆分它或打开同一文件的两个实例，它将增加我可以比较的代码行数。

* * *

## 回答 #1

> 赞同：980
> 
> 时间：2009-04-21T11:33:46.017

这是如何做到的......

1.  选择您想要两个副本的选项卡
2.  从菜单中选择菜单*窗口*→*新窗口*。
3.  右键单击新选项卡并选择*新建垂直选项卡组*

如果*新窗口*未在 *Window 菜单中列出，请注意该命令确实存在，即使在 Visual Studio 2017 中也是如此。使用菜单*Tools* → *Customize* → *Commands将其添加到**Window*菜单。此时决定在哪里放置*New Window*命令并选择*Add Command*。

 ***> **更新**于“2018 年 7 月 30 日”

在 Visual Studio Code 1.25.1 及更高版本中

**方式一**

您可以在侧面板（资源管理器）中简单地左键单击您的文件，然后按`Ctrl`+ `Enter`。

**方式二**

只需在 Visual Studio Code 侧面板（资源管理器）中右键单击您的文件，然后选择第一个选项*open to the side*。

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2011-09-13T04:41:21.590

对于 Visual Basic、HTML 和 JScript 以及 RDL 表达式，[PaulB 的答案](https://stackoverflow.com/questions/728949/open-two-instances-of-a-file-in-single-visual-studio-session/772159#772159)`Window > New Window`中提到的选项被禁用。但是，可以在注册表中更改选项以启用菜单项。

所有其他语言不限于单个代码窗口，因此您无需编辑注册表即可使用[PaulB 的答案。](https://stackoverflow.com/questions/728949/open-two-instances-of-a-file-in-single-visual-studio-session/772159#772159)

**在 Windows 注册表中启用新窗口。**^([ [1](http://msmvps.com/blogs/deborahk/archive/2010/05/17/visual-studio-window-new-window.aspx) ] [ [2](http://blogs.msdn.com/b/zainnab/archive/2010/05/20/multiple-views-of-the-same-document-window-vstipenv0016.aspx) ])

1.  转到以下注册表项。此示例适用于 Basic (Visual Basic)，但关键也适用于 HTML、JScript 和 RDL 表达式。

    *   64 位操作系统：`HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VisualStudio\10.0\Languages\Language Services\Basic`
    *   32 位操作系统：`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\10.0\Languages\Language Services\Basic`
2.  找到该值`Single Code Window Only`并执行以下操作之一：

    *   将其设置为 0
    *   重命名值
    *   删除值（**谨慎使用**！）

这将启用“新窗口”菜单项，但它可能在菜单中仍然不可见。

**添加菜单项**

要真正看到新窗口菜单项，我必须将其重新添加到菜单中：

*   工具 > 自定义... > 命令 > 添加命令...
*   选择“菜单栏”，然后在下拉菜单中选择“窗口”菜单
*   添加命令...>窗口>新窗口>确定

**恢复注册表值**
将此复制粘贴到记事本，另存为 .reg 文件并将文件导入注册表以恢复初始设置。

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VisualStudio\10.0\Languages\Language Services\Basic]
“仅单个代码窗口”=dword:00000001

```

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2017-12-03T06:49:18.963

转到*菜单*→ *Windows* →*新窗口*：

[![在此处输入图像描述](https://i.stack.imgur.com/cJplN.png)](https://i.stack.imgur.com/cJplN.png)

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2016-01-04T17:52:50.337

您可以使用*Windows* → *New Window*选项复制当前窗口。查看更多信息：*[为什么我喜欢 Visual Studio 2010？取消停靠窗口](http://www.sadev.co.za/content/why-i-visual-studio-2010-undock-windows#sthash.UTUQg8au.dpuf)*

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2009-04-21T11:18:50.000

打开文件（如果您使用多个选项卡组，请确保您的文件被选中）。

菜单*窗口*→*拆分* （或者，在编辑器的垂直滚动条上方有这个小块 - 抓住它并向下拖动）

这为您提供了同一文件的两个（水平）视图。请注意，任何编辑操作都会反映在两个视图上。

完成后，抓住拆分器并将其一直向上拖动（或菜单*Window* → *Remove Split*）。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2020-11-08T16:21:52.610

如何在 Visual Studio 2019 中并排打开同一文件的两个实例：

1.  打开文件。

2.  单击`Window -> New Window`。

3.  应该使用相同的文件打开一个新窗口。

4.  点击`Window -> New Vertical Document Group`。

结果： [![在此处输入图像描述](https://i.stack.imgur.com/TUGN5.png)](https://i.stack.imgur.com/TUGN5.png)

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2018-07-05T13:49:06.563

打开文件后，转到命令窗口（菜单*View* → *Other Windows* → *Command window*，或者只是`Ctrl`+ `Alt`+ `A`）

类型：

```
Window.NewWindow 
```

接着

```
Window.NewVerticalTabGroup 
```

为我工作（Visual Studio 2017）。

或使用菜单：

菜单*窗口*→*新窗口*

菜单*窗口*→*新的垂直点击组*

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2012-01-26T09:49:24.160

[卢克的回答](https://stackoverflow.com/questions/728949/open-two-instances-of-a-file-in-a-single-visual-studio-session/7396899#7396899)对我不起作用。“新窗口”命令已在自定义设置中列出，但未显示在 .js 选项卡上下文菜单中，尽管删除了注册表设置。

所以我用：

工具

定制...

键盘...

向下滚动以选择 Window.NewWindow

我按下并分配了快捷键，`Ctrl`+ `Shift`+ `W`。

这对我有用。

==== 编辑 ====

好吧，“工作”太强大了。我的键盘快捷键确实在同一个 JavaScript 文件上打开了另一个选项卡，但毫无帮助的是它不会呈现内容；它只是一个空白的窗口！你可能会有更好的运气。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-08T08:00:00.910

*我认为，窗口*菜单，*新的水平/垂直选项卡组*就可以了。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2017-06-29T13:05:48.433

对于较新的版本（例如 Visual Studio 2017）

*   选择要复制的窗口。
*   转到窗口选项卡，然后单击列表顶部的拆分。
*   完成后，再次单击它以将其关闭。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2015-07-30T10:52:22.657

在使用 Visual Studio 2013 和 VB.NET 时，我发现您可以非常轻松地自定义菜单并添加“新窗口”命令 - 无需弄乱注册表！

天知道为什么微软选择不包含某些语言的命令...？

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-04-08T08:08:57.817

**对于无法**在垂直选项卡组中打开相同文件的文件类型（例如 .vb 文件），您可以

*   打开**2 个不同的 Visual Studio 实例**
*   在每个实例中打开相同的文件
*   调整 IDE 窗口的大小并将它们并排放置以实现您的布局。

但是，如果您在一个实例中保存到磁盘，则在切换到另一个实例时必须重新加载文件。此外，如果您在这两种情况下都进行了编辑，则必须在第二次保存时解决。在这两种情况下，Visual Studio 都会向您提示各种选项。如果您只在一个实例中进行编辑，您会稍微简化您的生活。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-08T17:18:03.533

我没有 Visual Studio 2005 的副本，但此过程适用于 Visual Studio 2008：

1.  打开 xyz.cpp 以及其他一些文件。
2.  右键单击选项卡标题并选择新的垂直选项卡组。
3.  左键单击第一个选项卡组中的其他文件。
4.  再次通过解决方案资源管理器打开 xyz.cpp。

您现在应该在不同的垂直选项卡组中有两个文件实例。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-03-06T08:50:14.013

我想出了一个技巧，可能会产生原始答案中预期的结果。

如果您在源代码管理的两个窗口中都有您想要的文件，您可以右键单击该文件并选择比较，您可以比较

如果您进行比较，您将有一个名为 diff 的新窗口，向您显示文件的内容。

这当然不理想，因为差异窗口会使差异颜色污染文本。注意：您可以将要打开的文件与空文件进行比较，然后您将看到窗口以非常难看的绿色背景。

这并不完美，它是一种 hack，但这是我发现在两个窗口中真正拥有相同文件的唯一方法。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-09-15T11:23:46.760

要处理一个长文件的两个部分，只需使用快捷方式 ( Ctrl + \ ) 或在选定选项卡上单击拆分编辑器窗口。该图标位于 VS Code 的右上角。 [![在此处输入图像描述](https://i.stack.imgur.com/EDELN.jpg)](https://i.stack.imgur.com/EDELN.jpg)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-11-12T08:28:53.513

由于问题太老了，不知道回答这个问题就像打死马跑还是不跑。但是如果有人使用 VSCode 1.62.1 或更高版本，要在另一个选项卡中查看相同的脚本，只需右键单击工具栏上的脚本名称并选择“向右拆分”（或向上/向下/向左拆分）。

# sql-server - 如何从本地 .BAK 文件恢复 SQL Server 2005 DB？

> ID：728954
> 
> 赞同：1
> 
> 时间：2009-04-08T07:59:55.263
> 
> 标签：sql-server, ssis, ssms

我需要从不在服务器上但在我的本地计算机上的 .BAK 文件恢复数据库。

通常，我将桌面远程连接到 SQL 服务器，复制 .BAK 文件，然后使用 Management Studio 进行恢复。但这感觉有点尴尬，尤其是在这样的日子里，当我因为远程桌面上已达到允许的连接数而被淘汰时。

我想使用 Management Studio 从本地机器上的文件中恢复数据库。我可以通过 Management Studio 连接到 SQL 服务器，但是当我执行任务 -> 恢复 -> 数据库并选择文件时，它只能让我浏览服务器的文件系统。

有没有办法让它在我的本地文件系统上查找 .BAK？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T08:08:14.697

*我认为这是一次性的，而不是永久的修复*

* * *

您可以通过服务器访问本地系统驱动器吗？
例如

> \\你的电脑号码\c$

否则你为什么不把文件复制到服务器上呢？

# c++ - 返回向量迭代器的函数

> ID：728960
> 
> 赞同：2
> 
> 时间：2009-04-08T08:02:01.700
> 
> 标签：c++, vector, iterator

我有这个继承向量并具有一些附加功能的新类 Seq。我可以将所有向量方法与 Seq 一起使用。

有这个数据结构：

```
Seq< vector<int> > sweepEvents; 
```

我想要一个函数，它接受一个元素向量边缘搜索`sweepEvents`并将迭代器返回到找到的元素的位置`sweepEvents`（如果且仅当`edge`找到）和迭代器返回到向量的最后一个元素（如果且仅如果`edge`没有找到）。

然后我想使用这个迭代器，因为我想比较迭代器的上一个位置和下一个位置的元素。

我有以下用于创建和返回迭代器的函数：

```
Seq< vector<int> >::iterator QSweep::insertSweepEvents(edge_t edge,int currentDim){
    int changePosition;
    int found=0;

    for (int i=0;i<currentDim;i++){
         if (edge[0]==sweepEvents[i][1]){
             changePosition=i;
             found=1;
             return sweepEvents.begin()+changePosition;
         }
    }
    if (found==1){
        sweepEvents.rep().insert(sweepEvents.begin()+changePosition,edge);
        sweepEvents.rep().erase(sweepEvents.begin()+changePosition+1);
    }   
    else{
        sweepEvents.rep().insert(sweepEvents.end(),edge);
    }

    return sweepEvents.end()-1;
} 
```

然后我在主函数中调用这个迭代器。我实际上尝试过，但它没有编译，我不知道除此之外使用什么语法：

```
int main(){
    Seq< vector<int> > sweepEvents;
    vector<int> edge;
    //.....initialize sweepEvents and edge

    //declare iterator but not working
     Seq< vector<int> >::iterator comparePosition; 

   //not working neither
    comparePosition=insertSweepEvents(edge,sweepEvents.size());
} 
```

关于我应该如何正确调用迭代器的任何想法？我看到它不能作为数组中的整数索引工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T08:46:22.733

Seq< vector< T > >::iterator 是否在您的 Seq 类中定义？

使模板'vector'的参数并不意味着存在类型 Seq< vector< int >>::iterator

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T08:11:24.847

什么编译错误？如何定义`Seq<X>::iterator`？

```
#include <vector>

template<typename T>
struct Seq
  : public std::vector<T>
{ };

typedef Seq< std::vector<int> > SeqI;

SeqI::iterator insertSweepEvents(SeqI &s)
{
  return s.begin();
}

int main()
{
  SeqI s;
  SeqI::iterator e = insertSweepEvents(s);
} 
```

这工作正常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T11:31:31.387

一点旁注：

在`vector`更改 a 之后，尤其是在附加或插入时，它的迭代器将变得无效。这是因为它`vector`试图为其内部数据分配一个最小大小的连续内存块，同时它试图最小化它需要分配一个新的、更大的块的次数。所以数据可能会在内存中移动，所以在a 之前的迭代器*在它**之后*`push`不再有效。

 *另一个小提示：

您可以通过使用找到两个迭代器之间的差异`std::difference( it1, it2 )`。您可以使用 重新应用该差异`std::advance( it1, d )`。

第三个小提示：

您似乎在 for 循环中有一个“返回”语句，但其余代码使用仅在返回时设置的变量......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T08:10:39.807

您的代码中有一些不合逻辑的地方。看我的评论：

```
int found = 0;
for (int i=0;i<currentDim;i++){
     if (edge[0]==sweepEvents[i][1]){
                 changePosition=i;
                 found=1; 
// This place is one, where we assign 1 to found, and we do return after that (maybe you want do break/?)
                 return sweepEvents.begin()+changePosition;
         }
}
if (found==1){ // as you see we reach this place only when found == 0 
```

# asp.net - 具有多个 ASP.NET 站点的 SQL Express 用户实例

> ID：728962
> 
> 赞同：2
> 
> 时间：2009-04-08T08:02:33.463
> 
> 标签：asp.net, sql-server, sql-server-2005, sql-server-express, user-instance

如何获得两个单独的 ASP.NET 站点，在本例中是使用实体框架和 Web 服务的网站，以使用相同的本地数据库 mdf 和 ldf？

我环顾四周，我认为这种本地数据库称为用户实例 - 至少他们是我目前使用它的方式。在我从[MSDN 库](http://msdn.microsoft.com/en-us/library/ms254504.aspx)中找到以下信息之前，我不确定它是否会起作用，现在我真的不确定它是否会起作用。

> 用户实例场景包括：
> 
> ...
> 
> 使用 Windows 身份验证的专用 ASP.NET 托管。单个 SQL Server Express 实例可以托管在 Intranet 上。应用程序使用 ASPNET Windows 帐户进行连接，而不是使用模拟。用户实例不应用于第三方或共享托管场景，在这些场景中，所有应用程序将共享相同的用户实例，并且不再相互隔离。

无需任何额外配置即可立即工作吗？当我尝试将数据库添加到每个连续的应用程序时，如果有其他任何东西正在使用数据库，我会收到一个文件正在使用错误，这让我相信我不能这样做。但是，如果我停止使用数据库，然后添加它，然后启动它，它*似乎*工作正常。有没有人向我保证以这种方式使用它不会损坏或遇到任何错误？

最好将 mdf & ldf 存储在网站的 App_Data 目录 (|DataDirectory|) 中。如果我这样做，我认为我不能可靠地为服务使用相对寻址，除非我将它放在站点的子目录中，这是正确的吗？

**编辑：**我正在使用 SQL Server Express，因为这是学校的作业，所以我几乎必须使用它。如果有没有用户实例的方法，我会尝试不使用它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T08:49:21.633

你不能用`User Instance`这个。这一次只允许一个客户端连接到您的数据库。当您的两个应用程序使用相同的凭据时，您会收到您描述的错误。当您的两个应用程序使用不同的凭据时，您实际上会获得两个单独的实例（也不是您想要的）。

此外，用户实例仅在 SQL Server Express 上受支持。我不知道你的生产环境是什么样的，但它可能不在 SQL Server Express 上运行？

您应该`AttachDBFilename`在 Web 应用程序的连接字符串中使用指向本地数据库：`AttachDBFilename=|DataDirectory|\MyDB.mdf`.

在您的 Web 服务中，您也可以使用`AttachDBFilename`它，但这取决于 Web 服务的部署位置指向的位置。

# c# - 在 NET 3.5 中搜索组件

> ID：728964
> 
> 赞同：0
> 
> 时间：2009-04-08T08:04:05.050
> 
> 标签：c#, .net, controls, .net-3.5

我正在.NET 3.5 SP1 中寻找与这个（Delphi）类似的组件

[替代文字 http://img15.imageshack.us/img15/6657/compc.jpg](http://img15.imageshack.us/img15/6657/compc.jpg)

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T08:05:10.820

带有“View = Detail”的 ListView 或 DataGridView。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T08:07:51.297

查看[PropertyGrid](http://msdn.microsoft.com/en-us/library/system.windows.forms.propertygrid.aspx)控件

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T08:09:01.433

根据您的具体应用，您可能还想查看 PropertyGrid（除了 TcKs 答案）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T08:10:05.207

是的，[使用详细视图的 ListView](http://www.vbdotnetheaven.com/UploadFile/mahesh/MultiColumnListViewControl04252005023924AM/MultiColumnListViewControl.aspx)是要走的路。

# compression - 我没有得到 Golomb / Rice 编码：它确实会产生更多的输入位，或者是吗？

> ID：728966
> 
> 赞同：13
> 
> 时间：2009-04-08T08:04:16.627
> 
> 标签：compression

或者，也许，我没有得到[一元编码](http://en.wikipedia.org/wiki/Unary_coding)：

在[Golomb 或 Rice 编码](http://en.wikipedia.org/wiki/Rice_coding)中，您通过将一个数字`N`除以另一个数字将其拆分为两部分，`M`然后将该除法的整数结果编码为一元，余数编码为二进制。

在 Wikipedia[示例](http://en.wikipedia.org/wiki/Rice_coding#Example)中，他们使用 42 as`N`和 10 as `M`，因此我们最终得到商`q`4（一元：1110）和余数`r`2（二进制 010），因此生成的消息是`1110,010`，或 8 位 (逗号可以跳过）。42 的简单二进制表示是`101010`, 或 6 位。

对我来说，这似乎是由于它的一元表示`q`总是比二进制多。

显然，我在这里遗漏了一些重要的观点。它是什么？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-22T09:23:49.627

重要的一点是，哥伦布码并不意味着比一个特定数字的最短二进制编码更短。相反，通过提供一种特定类型的[可变长度编码](http://en.wikipedia.org/wiki/Variable-length_code)，与固定宽度编码相比，它们**减少了每个编码值的*平均*长度，如果编码值来自大范围，但最常见的值通常很小（因此是大多数时候只使用该范围的一小部分）。**

例如，如果您要传输 0 到 1000 范围内的整数，但大多数实际值都在 0 到 10 之间，在固定宽度编码中，大多数传输的代码都会有前导不包含任何信息的 0：

要覆盖 0 到 1000 之间的所有值，您需要一个 10 位宽的固定宽度二进制编码。现在，由于您的大多数值都低于 10，因此大多数数字的至少前 6 位将为 0，并且携带的信息很少。

要使用 Golomb 代码纠正这一点，您可以通过将数字除以 10 并分别编码商和余数来拆分数字。对于大多数值，必须传输的只是余数，最多可以使用 4 位进行编码（如果您使用截断二进制作为余数，它可能会更少）。然后商以一元形式传输，它将`0`所有低于 10 的值编码为单个位，如`10`10..19、20..29`110`等。

现在，对于您的大多数值，您已将消息大小减少到最大 5 位，但您仍然能够在没有分隔符的情况下明确地传输所有值。

对于较大的值（例如，990..999 范围内的值需要 100 位的商），这会带来相当高的成本，这就是为什么编码对于 2 边几何分布是最佳的。

较大值的商中的 1 位的长行程可以通过后续行程编码来解决。但是，如果商在结果消息中占用太多空间，这可能表明其他代码可能比 Golomb/Rice 更合适。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T08:33:29.893

Golomb 编码和二进制代码之间的一个区别是二进制代码不是前缀代码，它不能用于编码任意大数字的字符串（您无法确定 1010101010101010 是 10101010 和 10101010 的串联还是其他）。因此，它们不是那么容易比较的。

其次，Golomb 码最适合几何分布，在这种情况下，参数为 2^(-1/10)。42 的概率约为 0.3 %，因此您知道这对于输出字符串的长度有多重要。

# c++ - 查找集合的所有子集

> ID：728972
> 
> 赞同：39
> 
> 时间：2009-04-08T08:06:19.617
> 
> 标签：c++, algorithm, math, subset

我需要一种算法来查找集合中元素数量为 的集合的所有子集`n`。

```
S={1,2,3,4...n} 
```

编辑：到目前为止，我无法理解提供的答案。我想逐步解释答案如何找到子集。

例如，

```
S={1,2,3,4,5} 
```

你怎么知道`{1}`并且`{1,2}`是子集？

有人可以帮我用 C++ 中的一个简单函数来查找 {1,2,3,4,5} 的子集吗

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-04-08T11:38:16.173

递归地执行此操作非常简单。基本思想是，对于每个元素，子集的集合可以平均分为包含该元素的子集和不包含该元素的子集，否则这两个集合是相等的。

*   对于 n=1，子集的集合是 {{}, {1}}
*   对于 n>1，找到 1,...,n-1 的子集的集合并制作两个副本。对于其中一个，将 n 添加到每个子集。然后取两个副本的并集。

**编辑**使其一目了然：

*   {1} 的子集是 {{}, {1}}
*   对于 {1, 2}，取 {{}, {1}}，每个子集加 2 得到 {{2}, {1, 2}} 并取与 {{}, {1}} 的并集得到{{}、{1}、{2}、{1、2}}
*   重复直到达到 n

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2012-09-25T17:52:49.547

回答太晚了，但迭代方法在这里听起来很容易：

1) 对于一组`n`元素，获取 的值`2^n`。将有 2^n 个子集。（2^n 因为每个元素可以存在（1）或不存在（0）。所以对于 n 个元素，将有 2^n 个子集。）。例如：
`for 3 elements, say {a,b,c}, there will be 2^3=8 subsets`

2) 得到 的二进制表示`2^n`。例如：
`8 in binary is 1000`

3) 从`0`到`(2^n - 1)`。在每次迭代中，对于二进制表示中的每个 1，形成一个子集，其元素对应于二进制表示中该 1 的索引。例如：

```
For the elements {a, b, c}
000 will give    {}
001 will give    {c}
010 will give    {b}
011 will give    {b, c}
100 will give    {a}
101 will give    {a, c}
110 will give    {a, b}
111 will give    {a, b, c} 
```

4) 对步骤 3 中找到的所有子集进行并集。返回。例如：
`Simple union of above sets!`

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2013-05-01T00:09:32.780

万一其他人过来仍然想知道，这里有一个使用迈克尔在 C++ 中的解释的函数

```
vector< vector<int> > getAllSubsets(vector<int> set)
{
    vector< vector<int> > subset;
    vector<int> empty;
    subset.push_back( empty );

    for (int i = 0; i < set.size(); i++)
    {
        vector< vector<int> > subsetTemp = subset;  //making a copy of given 2-d vector.

        for (int j = 0; j < subsetTemp.size(); j++)
            subsetTemp[j].push_back( set[i] );   // adding set[i] element to each subset of subsetTemp. like adding {2}(in 2nd iteration  to {{},{1}} which gives {{2},{1,2}}.

        for (int j = 0; j < subsetTemp.size(); j++)
            subset.push_back( subsetTemp[j] );  //now adding modified subsetTemp to original subset (before{{},{1}} , after{{},{1},{2},{1,2}}) 
    }
    return subset;
} 
```

但请考虑到，这将返回一组大小为 2^N 的所有可能子集，这意味着可能会有重复。如果您不想要这个，我建议实际使用 a`set`而不是 a `vector`（我曾经使用它来避免代码中的迭代器）。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-08T08:15:12.263

如果您想列举所有可能的子集，请查看[本文](http://applied-math.org/subset.pdf)。他们讨论了不同的方法，例如字典顺序、格雷编码和银行家序列。他们给出了银行家序列的示例实现，并讨论了解决方案的不同特征，例如性能。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-07-14T18:58:57.243

在这里，我已经详细解释过了。如果您喜欢这篇博文，请点赞。

[http://cod3rutopia.blogspot.in/](http://cod3rutopia.blogspot.in/)

如果你在这里找不到我的博客，无论如何都是解释。

这是一个本质上是递归的问题。

本质上，对于要出现在子集中的元素，有 2 个选项：

1）它存在于集合中

2）它在集合中不存在。

这就是为什么一组 n 个数字有 2^n 个子集的原因。（每个元素 2 个选项）

这是打印所有子集的伪代码（C++），后面是解释代码如何工作的示例。1)A[] 是要找出其子集的数字数组。2) bool a[] 是布尔数组，其中 a[i] 表示数字 A[i] 是否存在于集合中。

```
print(int A[],int low,int high)  
   {
    if(low>high)  
    {
     for(all entries i in bool a[] which are true)  
        print(A[i])
    }  
   else  
   {set a[low] to true //include the element in the subset  
    print(A,low+1,high)  
    set a[low] to false//not including the element in the subset  
    print(A,low+1,high)
   }  
  } 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-02-02T09:42:40.613

自底向上 O(n) 空间解

```
#include <stdio.h>

void print_all_subset(int *A, int len, int *B, int len2, int index)
{
    if (index >= len)
    {
        for (int i = 0; i < len2; ++i)
        {
            printf("%d ", B[i]);
        }
        printf("\n");

        return;
    }
    print_all_subset(A, len, B, len2, index+1);

    B[len2] = A[index];
    print_all_subset(A, len, B, len2+1, index+1);
}

int main()
{
    int A[] = {1, 2, 3, 4, 5, 6, 7};
    int B[7] = {0};

    print_all_subset(A, 7, B, 0, 0);
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-03-15T11:22:15.703

这是python中用于查找集合的所有子集的简单递归算法：

```
def find_subsets(so_far, rest):
        print 'parameters', so_far, rest
        if not rest:
            print so_far
        else:
            find_subsets(so_far + [rest[0]], rest[1:])
            find_subsets(so_far, rest[1:])

find_subsets([], [1,2,3]) 
```

输出如下： $python subsets.py

```
parameters [] [1, 2, 3]
parameters [1] [2, 3]
parameters [1, 2] [3]
parameters [1, 2, 3] []
[1, 2, 3]
parameters [1, 2] []
[1, 2]
parameters [1] [3]
parameters [1, 3] []
[1, 3]
parameters [1] []
[1]
parameters [] [2, 3]
parameters [2] [3]
parameters [2, 3] []
[2, 3]
parameters [2] []
[2]
parameters [] [3]
parameters [3] []
[3]
parameters [] []
[] 
```

观看来自斯坦福的以下视频，以获得对该算法的一个很好的解释：

```
https://www.youtube.com/watch?v=NdF1QDTRkck&feature=PlayList&p=FE6E58F856038C69&index=9 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-10-28T02:43:39.747

这是 Michael 针对 std::vector 中任何类型元素的解决方案的实现。

```
#include <iostream>
#include <vector>

using std::vector;
using std::cout;
using std::endl;

// Find all subsets
template<typename element>
vector< vector<element> > subsets(const vector<element>& set)
{
  // Output
  vector< vector<element> > ss;
  // If empty set, return set containing empty set
  if (set.empty()) {
    ss.push_back(set);
    return ss;
  }

  // If only one element, return itself and empty set
  if (set.size() == 1) {
    vector<element> empty;
    ss.push_back(empty);
    ss.push_back(set);
    return ss;
  }

  // Otherwise, get all but last element
  vector<element> allbutlast;
  for (unsigned int i=0;i<(set.size()-1);i++) {
    allbutlast.push_back( set[i] );
  }
  // Get subsets of set formed by excluding the last element of the input set
  vector< vector<element> > ssallbutlast = subsets(allbutlast);
  // First add these sets to the output
  for (unsigned int i=0;i<ssallbutlast.size();i++) {
    ss.push_back(ssallbutlast[i]);
  }
  // Now add to each set in ssallbutlast the last element of the input
  for (unsigned int i=0;i<ssallbutlast.size();i++) {
    ssallbutlast[i].push_back( set[set.size()-1] );
  }
  // Add these new sets to the output
  for (unsigned int i=0;i<ssallbutlast.size();i++) {
    ss.push_back(ssallbutlast[i]);
  }

  return ss;

}

// Test
int main()
{

  vector<char> a;
  a.push_back('a');
  a.push_back('b');
  a.push_back('c');

  vector< vector<char> > sa = subsets(a);

  for (unsigned int i=0;i<sa.size();i++) {
    for (unsigned int j=0;j<sa[i].size();j++) {
      cout << sa[i][j];
    }
    cout << endl;
  }

  return 0;

} 
```

输出：

```
(empty line)
a
b
ab
c
ac
bc
abc 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2018-10-28T15:59:22.567

一个优雅的递归解决方案，对应于上面的最佳答案解释。核心向量运算只有 4 行。归功于安蒂的 Laaksonen 的“竞争编程指南”一书。

```
// #include <iostream>
#include <vector>
using namespace std;

vector<int> subset;
void search(int k, int n) {
    if (k == n+1) {
    // process subset - put any of your own application logic
    // for (auto i : subset) cout<< i << " ";
    // cout << endl;
    }
    else {
        // include k in the subset
        subset.push_back(k);
        search(k+1, n);
        subset.pop_back();
        // don't include k in the subset
        search(k+1,n);
    }
}

int main() {
    // find all subset between [1,3]
    search(1, 3);
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-10-01T12:07:10.307

你不必弄乱递归和其他复杂的算法。您可以使用 0 到 2^(N-1) 之间的所有数字的位模式（十进制到二进制）找到所有子集。这里 N 是该集合中的基数或项目数。此处通过实现和演示解释了该技术。

[http://codeding.com/?article=12](http://codeding.com/?article=12)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-10-24T04:35:07.793

这是Scala中的一个解决方案：

```
def subsets[T](s : Set[T]) : Set[Set[T]] = 
  if (s.size == 0) Set(Set()) else { 
    val tailSubsets = subsets(s.tail); 
    tailSubsets ++ tailSubsets.map(_ + s.head) 
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-02-16T01:45:32.900

这是一些伪代码。您可以通过存储每次调用的值来减少相同的递归调用，然后在递归调用检查调用值是否已经存在之前。

以下算法将具有除空集之外的所有子集。

```
list * subsets(string s, list * v){
    if(s.length() == 1){
        list.add(s);    
        return v;
    }
    else
    {
        list * temp = subsets(s[1 to length-1], v);     
        int length = temp->size();

        for(int i=0;i<length;i++){
            temp.add(s[0]+temp[i]);
        }

        list.add(s[0]);
        return temp;
    }
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-07-08T12:58:06.283

这是我前段时间写的一个工作代码

```
// Return all subsets of a given set
#include<iostream>
#include<cstdio>
#include<algorithm>
#include<vector>
#include<string>
#include<sstream>
#include<cstring>
#include<climits>
#include<cmath>
#include<iterator>
#include<set>
#include<map>
#include<stack>
#include<queue>
using namespace std;

typedef vector<int> vi;
typedef vector<long long> vll;
typedef vector< vector<int> > vvi;
typedef vector<string> vs;

vvi get_subsets(vi v, int size)
{
    if(size==0) return vvi(1);
    vvi subsets = get_subsets(v,size-1);

    vvi more_subsets(subsets);

    for(typeof(more_subsets.begin()) it = more_subsets.begin(); it !=more_subsets.end(); it++)
    {
        (*it).push_back(v[size-1]);
    }

    subsets.insert(subsets.end(), (more_subsets).begin(), (more_subsets).end());
    return subsets;
}

int main()
{
    int ar[] = {1,2,3};
    vi v(ar , ar+int(sizeof(ar)/sizeof(ar[0])));
    vvi subsets = get_subsets(v,int((v).size()));

    for(typeof(subsets.begin()) it = subsets.begin(); it !=subsets.end(); it++)
    {
        printf("{ ");

        for(typeof((*it).begin()) it2 = (*it).begin(); it2 !=(*it).end(); it2++)
        {
            printf("%d,",*it2 );
        }
        printf(" }\n");
    }
    printf("Total subsets = %d\n",int((subsets).size()) );
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-04-10T18:35:12.403

> 这个问题很老了。但是对于 OP 的问题，有一个简单优雅的递归解决方案。

```
using namespace std;
void recsub(string sofar, string rest){
  if(rest=="") cout<<sofar<<endl;
  else{
    recsub(sofar+rest[0], rest.substr(1)); //including first letter
    recsub(sofar, rest.substr(1)); //recursion without including first letter.
  }
}
void listsub(string str){
  recsub("",str);
}
int main(){
  listsub("abc");
  return 0;
}

//output
abc
ab
ac
a
bc
b
c

//end: there's a blank output too representing empty subset 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-08T13:50:58.803

一种简单的方法是以下伪代码：

```
Set getSubsets(Set theSet)
{
  SetOfSets resultSet = theSet, tempSet;

  for (int iteration=1; iteration < theSet.length(); iteration++)
    foreach element in resultSet
    {
      foreach other in resultSet
        if (element != other && !isSubset(element, other) && other.length() >= iteration)
          tempSet.append(union(element, other));
    }
    union(tempSet, resultSet)
    tempSet.clear()
  }

} 
```

好吧，我不确定这是否正确，但看起来还可以。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-09-10T15:54:23.933

这是我的递归解决方案。

```
vector<vector<int> > getSubsets(vector<int> a){

//base case
    //if there is just one item then its subsets are that item and empty item
    //for example all subsets of {1} are {1}, {}

    if(a.size() == 1){
        vector<vector<int> > temp;
        temp.push_back(a);

        vector<int> b;
        temp.push_back(b);

        return temp;

    }
    else
    {

         //here is what i am doing

         // getSubsets({1, 2, 3})
         //without = getSubsets({1, 2})
         //without = {1}, {2}, {}, {1, 2}

         //with = {1, 3}, {2, 3}, {3}, {1, 2, 3}

         //total = {{1}, {2}, {}, {1, 2}, {1, 3}, {2, 3}, {3}, {1, 2, 3}}

         //return total

        int last = a[a.size() - 1];

        a.pop_back();

        vector<vector<int> > without = getSubsets(a);

        vector<vector<int> > with = without;

        for(int i=0;i<without.size();i++){

            with[i].push_back(last);

        }

        vector<vector<int> > total;

        for(int j=0;j<without.size();j++){
            total.push_back(without[j]);
        }

        for(int k=0;k<with.size();k++){
            total.push_back(with[k]);
        }

        return total;
    }

} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-03-26T14:49:14.967

如前所述，一个简单的位掩码可以解决问题.... by rgamber

```
#include<iostream>
#include<cstdio>

#define pf printf
#define sf scanf

using namespace std;

void solve(){

            int t; char arr[99];
            cin >> t;
            int n = t;
            while( t-- )
            {
                for(int l=0; l<n; l++) cin >> arr[l];
                for(int i=0; i<(1<<n); i++)
                {
                    for(int j=0; j<n; j++)
                        if(i & (1 << j))
                        pf("%c", arr[j]);
                    pf("\n");
                }
            }
        }

int main() {
      solve();
      return 0;
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-11-14T22:31:56.677

对于那些想要使用 std::vector 和 std::set 来实现 Michael Borgwardt 算法的简单实现的人：

```
// Returns the subsets of given set
vector<set<int> > subsets(set<int> s) {
    vector<set<int> > s1, s2;
    set<int> empty;
    s1.push_back(empty); // insert empty set
    // iterate over each element in the given set
    for(set<int>::iterator it=s.begin(); it!=s.end(); ++it) {
        s2.clear(); // clear all sets in s2
        // create subsets with element (*it)
        for(vector<set<int> >::iterator s1iter=s1.begin(); s1iter!=s1.end(); ++s1iter) {
            set<int> temp = *s1iter;
            temp.insert(temp.end(), *it);
            s2.push_back(temp);
        }
        // update s1 with new sets including current *it element
        s1.insert(s1.end(), s2.begin(), s2.end());
    }
    // return
    return s1;
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-03-07T01:07:14.523

```
 vector<vetor<int>> subarrays(vector<int>& A) {
        vector<vetor<int>> set;
        vector<vector<int>> tmp;

        set.push_back({});
        set.push_back({});
        set[1].push_back(A[0]);

        for(int i=1;i<A.size();i++){
            tmp=set;
            for(int j=0;j<tmp.size();j++){
                tmp[j].push_back(A[i]);
            }
            set.insert( set.end(), tmp.begin(), tmp.end() );
        }
        return set;
    } 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-03-21T17:22:09.503

这是按照原始答案的代码

```
 void print_subsets(std::vector<int>& nums, int i, std::vector<std::vector<int>>& results, std::vector<int>& r) {    
        if (i < nums.size()) {    
            r.push_back(nums[i]);  // First consider the element
            print_subsets(nums, i + 1, results, r);
            r.pop_back(); // Now don't consider the element
            print_subsets(nums, i + 1, results, r);
        }
        else {
            results.push_back(r);
        }     
    }

// Main method
   vector<vector<int>> subsets(vector<int>& nums) {
        std::vector<std::vector<int>> results;
        std::vector<int> r;
        print_subsets(nums, 0, results, r);        
        return results;
    } 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-06-08T02:12:51.723

根据公认的 Swift 中的递归解决方案：

```
private func getSubsets(_ set: Set<Int>) -> Set<Set<Int>> {

    var set = set // Allows you to manipulate the set

    if set.isEmpty { // Base Case: Subset of an empty set is an empty set

        return [[]]

    } else { // Remove n, find subset of 1,...,n - 1, duplicate subset and append n to duplicated set, return the union of both

        let n = set.removeFirst()

        var subset = getSubsets(set)

        for i in subset {
            var temp = i
            temp.insert(n)
            subset.insert(temp)
        }

        return subset

    }

} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2022-01-22T15:38:24.800

基于上述“Michael Borgwardt”算法的无递归Java 版本。

public static List<List> powerset(List array) { List<List> perms = new ArrayList<List>(); if(array.size()==0) { perms.add(new ArrayList()); 退货烫发；} 返回幂集（数组，烫发）；}

```
public static List<List<Integer>> powerset(List<Integer> array, List<List<Integer>> perms) {

    for(int i=0;i<array.size();i++){
        perms.add(Arrays.asList(array.get(i)));
        int x=perms.size();
        for(int j=0;j<x;j++){
            List<Integer> tmp = new ArrayList<Integer>(perms.get(j));   
            if(!(tmp.size()==1 && tmp.get(0)==array.get(i))){
                tmp.add(array.get(i));
                perms.add(tmp);
            }
        }
    }
    perms.add(new ArrayList<Integer>());
return perms; 
```

}

# string - Groovy：如何按字符串长度顺序对 String:s 的 ArrayList 进行排序？

> ID：728978
> 
> 赞同：12
> 
> 时间：2009-04-08T08:08:26.413
> 
> 标签：string, sorting, groovy, arraylist

如何在 Groovy 中按字符串长度顺序对`ArrayList`of`String`进行排序？

代码：

```
def words = ['groovy', 'is', 'cool']
// your code goes here:
// code that sorts words in ascending length-of-word order
assert words == ['is', 'cool', 'groovy'] 
```

肯定有不止一种方法可以做到这一点——所以我会把答案交给提供最优雅解决方案的人。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-08T09:14:56.487

```
words = words.sort { it.size() } 
```

获取降序

```
words = words.sort { -it.size() } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-06-24T16:21:19.587

如果在接受的解决方案`{ -it.size() }`中不适用于降序，您可以试试这个： `{ -1 * it.size() }`

# c++ - 赋值运算符是否适用于不同类型的对象？

> ID：728986
> 
> 赞同：8
> 
> 时间：2009-04-08T08:10:34.410
> 
> 标签：c++, operator-overloading, virtual-functions

```
class A {
public:
void operator=(const B &in);
private:
 int a;
};

class B {
private:
 int c;

} 
```

对不起。发生了错误。赋值运算符有效吗？或者有什么办法可以做到这一点？[A类和B类之间没有关系。]

```
void A::operator=(const B& in) 
{ 
a = in.c;

} 
```

非常感谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-08T08:17:27.310

是的，你可以这样做。

```
#include <iostream>
using namespace std;

class B {
  public:
    B() : y(1) {}
    int getY() const { return y; }
  private:
     int y;
};

class A {
  public:
    A() : x(0) {}
    void operator=(const B &in) {
       x = in.getY();
    }
    void display() { cout << x << endl; }
  private:
     int x;
};

int main() {
   A a;
   B b;
   a = b;
   a.display();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-11-21T15:25:22.237

这不是一个答案，但应该知道赋值运算符的典型习惯用法是让它返回对对象类型的引用（而不是 void）并在最后返回 (*this)。这样，您可以链接分配，如 a = b = c：

```
A& operator=(const A& other) 
{
    // manage any deep copy issues here
    return *this;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T08:18:17.810

赋值运算符和参数化构造函数都可以具有任何类型的参数，并以任何他们想要初始化对象的方式使用这些参数的值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-12T21:00:31.453

其他人对此有所了解，但我实际上会陈述它。是的，您可以使用不同的类型，但请注意，除非您使用朋友，否则您的类无法访问通过运算符传入的类的私有成员。

这意味着 A 将无法访问 B::c 因为它是私有的。

# windows-server-2003 - 软件无法写入 C：Win2003 受限用户“磁盘空间不足”

> ID：728990
> 
> 赞同：0
> 
> 时间：2009-04-08T08:11:17.420
> 
> 标签：windows-server-2003, diskspace

软件无法写入存储在 C 中的配置文件文件夹：Win2003 受限用户由于“磁盘空间不足”

当我查看管理员权限时，C: 驱动器上有足够的空间

当我限制用户使用 cmd.exe 并说 dir c:/ 时，它的 0 个字节是免费的

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T08:16:18.017

看起来有一个[磁盘配额](http://www.microsoft.com/technet/scriptcenter/topics/win2003/quotas.mspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T08:19:20.457

[本文](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-6117811.html)介绍如何在 Windows SBS 2003 和 Windows Server 2003 中设置用户磁盘配额。

* * *

*[在 Windows Server 2003 和 Windows XP 中管理磁盘配额](http://www.microsoft.com/technet/scriptcenter/topics/win2003/quotas.mspx)有更多关于以编程方式设置配额的信息。*******`*******