# StackOverflow 问答 000762000-000762999

# c# - Filer DataTable 排除 DBNull.Value

> ID：762000
> 
> 赞同：2
> 
> 时间：2009-04-17T20:06:37.220
> 
> 标签：c#, asp.net, linq, datatable

我从 excel 文件中收到一个 DataTable，第一列中的数据如下所示：

`11129`

`DBNull.Value`

`29299`

`29020`

`DBNull.Value`

`29020`

我正在使用 LINQ 来选择 distict，如果没有如下 DBNull.Value 值，它就可以工作。

```
albumIds = dt.AsEnumerable().Select(p => (int)p.Field<double>("F1")).Distinct().ToArray(); 
```

但是，如果`DBNull.Value`存在代表空 excel 单元格的情况，我会收到转换错误。

如何`DBNull.Value`从我的结果集中过滤掉那些？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T21:36:03.200

正如 Jeremy 的回答中所暗示的那样，如果您引用了[System.Data.DataSetExtensions.dll](http://msdn.microsoft.com/en-us/library/bb360891.aspx)，您将获得一些方便的扩展方法，用于使用 LINQ 处理数据集和数据表。具体来说，您可以使用 Field `<int?>`() 方法将可能包含 DBNull 的整数列转换为可为空的整数列...

```
albumIds = dt.AsEnumerable().Select(row => row.Field<int?>("F1"))
                            .Where(val => val.HasValue)
                            .Select(val => val.Value)
                            .Distinct()
                            .ToArray(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T20:14:46.187

您只需要先过滤掉空值。那么你的 LINQ 表达式应该很好用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T20:32:44.880

在尝试使用 Where 方法进行转换之前，您需要检查 DBNull 的字段，这可能是最简单的。

```
dt.AsEnumerable().Where(p => p.Field("F1") != DBNull.Value).Select(p => (int)p.Field("F1")).Distinct().ToArray(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T21:44:25.723

你可以试试这个：

```
dt.AsEnumerable().Where(p => p.IsNull("F1") == false)
  .Select(p => p.Field<int>("F1")).Distinct().ToArray(); 
```

我无法真正检查这一点，因为我没有此数据库设置

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-17T21:34:59.507

我会回答我自己的问题。

如果值为空，我不使用 Linq，而是执行 foreach 循环并删除行。然后做 Linq distinct

```
 foreach(DataRow row in dt.Rows)
            {
                if (String.IsNullOrEmpty(row["F1"].ToString()))
                    row.Delete();
            }

            dt.AcceptChanges();

            albumIds = dt.AsEnumerable().Select(p => (int)p.Field<double>("F1")).Distinct().ToArray(); 
```

# javascript - 用于在网页中编写脚本的 Firefox 扩展

> ID：762003
> 
> 赞同：0
> 
> 时间：2009-04-17T20:06:41.573
> 
> 标签：javascript, firefox, scripting, webpage

我是 Firefox 扩展构建的新手，希望对我正在创建的应用程序有所帮​​助。我想创建一个 firefox 扩展，在选择激活 firefox 扩展时，打开一个新选项卡并将脚本发送到页面以显示一定数量的文本或执行某种活动。唯一的问题是我不知道如何在 javascript 或 xul 文件中实现这些。

我在 javascript 文件中创建了菜单选项，这是从 XUL 文件中调用的。谁能帮我在网页中创建脚本？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T20:09:56.653

如果您要运行的脚本是 JavaScript，我建议您只使用[GreaseMonkey](http://www.greasespot.net/) [插件](https://addons.mozilla.org/en-US/firefox/addon/748)。

# asp.net-mvc - DesignPatterns：哪个最适合用于向导风格的用户界面？

> ID：762008
> 
> 赞同：5
> 
> 时间：2009-04-17T20:08:36.297
> 
> 标签：asp.net-mvc, design-patterns, wizard

我正在实现一个向导风格的用户界面。当用户浏览向导时，单击下一步，根据他们在每个屏幕上选择的选项，用户将不得不通过一组特定的向导屏幕。

这是在 ASP.NET MVC 中构建的。我想知道哪种设计模式最适合实现向导中步骤序列的逻辑。同样，根据他们所做的选择，他们有多个通过向导的路径。

我可以使用链表吗？“[命令设计模式](http://www.dofactory.com/Patterns/PatternCommand.aspx)”？你有什么建议吗？

换句话说：您在哪里/如何根据用户在向导的特定步骤中选择的内容来抽象/封装确定向导中下一步是什么的逻辑？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T20:11:59.407

如果您希望允许用户在向导中前后导航，“ [State ”模式可能有意义。](http://en.wikipedia.org/wiki/State_pattern)

工作流模式也可能有意义。也许使用 Windows Workflow 基础进行调查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T21:37:58.203

> 换句话说：您在哪里/如何根据用户在向导的特定步骤中选择的内容来抽象/封装确定向导中下一步是什么的逻辑？

一种方法是对 Wizard、Step 和 Product 类进行建模。也许是这样的？

```
public class Wizard
{
  public Step forward() {//...}

  public Step backward() {//...}

  public Step current() {//...}

  public Product getProduct() {//...}
}

public class Step
{
  public String name() {//...}

  public void commit(Product product) {//...}

  public void rollback(Product product) {//...}
}

public class Product
{
  //...
} 
```

向导的目的是构建产品（汽车、计算机、假期等）。

在这种情况下，由向导决定下一步 - 可能基于向导正在构建的产品状态。Wizard 就像一个在 UI 控制下的[Builder](http://en.wikipedia.org/wiki/Builder_pattern)，它是 Director 并告诉 Wizard 何时以及在什么方向进行转换。由向导决定下一步实际上是什么。可以支持多个分支点，但该实现将隐藏在 Wizard 中。

Step 将是具有撤消/重做功能的[命令模式的一个实例。](http://en.wikipedia.org/wiki/Command_pattern)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T01:10:24.403

我喜欢保持简单。我使用步骤编号在我正在构建的对象上设置一个值，因此如果我正在构建保险单，我将在保单上拥有一个属性，指示它所处的步骤。然后我有一个方法，即路由器，查看策略并确定下一步将其发送到哪里，您可以在路由器中构建额外的逻辑以跳过步骤，或者您可以将逻辑放在每个步骤方法中并重定向回路由器方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T20:22:42.470

我不得不同意博。

实际上，如果您需要一套复杂的导航逻辑规则，那么您有一个 GUI 方面的向导，而不是引擎盖下的向导。

如果尝试构建的确实是一个向导，那么每个屏幕最多应该流入 2-3 个不同的屏幕（IMO）。这可以很容易地存储到一个非常简单的结构中（数据库、静态配置文件）。

# .net - 如何更改 ColorDialog 的标题？

> ID：762009
> 
> 赞同：5
> 
> 时间：2009-04-17T20:08:42.223
> 
> 标签：.net, winforms, colordialog

我正在[`ColorDialog`](http://msdn.microsoft.com/en-us/library/system.windows.forms.colordialog.aspx)WinForms 中启动一个组件，让用户选择特定自定义控件的图表的背景颜色和前景色。两个配置选项都在配置对话框的同一页面上，所以我想在弹出对话框时将颜色对话框的标题设置为“背景颜色”以更改图表的背景，并设置“网格颜色”以更改颜色的网格。这将提供一个有用的用户体验，如果用户不确定他们是否选择更改背景或网格颜色，他们将能够查看图表的标题。

不幸的是，文档似乎没有提到任何操纵`ColorDialog`' 标题的方法。有可能做出这种改变吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-17T21:29:04.543

不幸的是，无法更改通用颜色选择器对话框的标题。一种可能的解决方案是找到或创建一个颜色选择器控件，以专用形式托管，当然，您可以分配适当的标题。或者您可以[采用组合框形式的 Office 风格的颜色选择](http://www.openwinforms.com/office2007_style_color_picker.html)。

**编辑**

受 Rob 回答的启发，我找到了以下解决方案。它涉及从[ColorDialog继承，从](http://msdn.microsoft.com/en-us/library/system.windows.forms.colordialog(loband).aspx)[HookProc](http://msdn.microsoft.com/en-us/library/system.windows.forms.commondialog.hookproc(loband).aspx)方法中获取 HWND并通过 P/Invoke调用[SetWindowText ：](http://msdn.microsoft.com/en-us/library/ms633546(loband).aspx)

```
public class MyColorDialog : ColorDialog
{
    [DllImport("user32.dll")]
    static extern bool SetWindowText(IntPtr hWnd, string lpString);

    private string title = string.Empty;
    private bool titleSet = false;

    public string Title
    {
        get { return title; }
        set
        {
            if (value != null && value != title)
            {
                title = value;
                titleSet = false;
            }
        }
    }

    protected override IntPtr HookProc(IntPtr hWnd, int msg, IntPtr wparam, IntPtr lparam)
    {
        if (!titleSet)
        {
            SetWindowText(hWnd, title);
            titleSet = true;
        }

        return base.HookProc(hWnd, msg, wparam, lparam);
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-27T19:11:47.060

我将其发布为我如何做到这一点的参考。我使用了 WM_INITDIALOG （在我对 Tormod 的回答的评论中引用）

```
/// <summary>
/// The standard ColorDialog dialog box with a title property.
/// </summary>
public class ColorDialogWithTitle : ColorDialog
{
    private const int InitDialogMessage = 0x0110; // WM_INITDIALOG

    /// <summary>
    /// Initializes a new instance of the ColorDialogWithTitle class.
    /// </summary>
    public ColorDialogWithTitle() :
        base()
    {
        this.Title = Resources.ColorDialogWithTitle_DefaultTitle;

        return;
    }

    /// <summary>
    /// Gets or sets the title that will be displayed on the dialog when it's shown.
    /// </summary>
    [Browsable(true)]
    [Category("Appearance")]
    [Description("The title that will be displayed on the dialog when it's shown.")]
    public string Title
    {
        get;
        set;
    }

    /// <summary>
    /// The hook into the dialog's WndProc that we can leverage to set the
    /// window's text.
    /// </summary>
    /// <param name="hWnd">The handle to the dialog box window.</param>
    /// <param name="msg">The message being received.</param>
    /// <param name="wparam">Additional information about the message.</param>
    /// <param name="lparam">More additional information about the message.</param>
    /// <returns>
    /// A zero value if the default dialog box procedure processes the
    /// message, a non-zero value if the default dialog box procedure 
    /// ignores the message.
    /// </returns>
    [SecurityPermission(SecurityAction.LinkDemand, Flags = SecurityPermissionFlag.UnmanagedCode)]
    protected override IntPtr HookProc(IntPtr hWnd, int msg, IntPtr wparam, IntPtr lparam)
    {
        if (msg == InitDialogMessage)
        {
            // We'll ignore failure cases for now.  The default text isn't 
            // so bad and this isn't library code.
            SafeNativeMethods.SetWindowText(hWnd, this.Title);
        }

        return base.HookProc(hWnd, msg, wparam, lparam);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T21:40:00.803

假设 ColorDialog 暴露了它的 hWnd（我没有在这台机器上检查 Visual Studio），你可以使用 Win32 [SetWindowText](http://msdn.microsoft.com/en-us/library/ms633546(VS.85).aspx) API。PInvoke 签名可以在[PInvoke.net](http://www.pinvoke.net/default.aspx/user32/SetWindowText.html)上找到。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-09-05T23:36:52.870

我发布这个以防其他人在未来几年遇到这个问题。

在 OnShow() 事件中使用 SetWindowText() 函数可以正常工作。我不确定哪个版本的 Delphi 引入了 TColorDialog.OnShow 但它至少可以追溯到 XE2。

```
procedure TForm1.ColorDialog1Show(Sender: TObject);
  begin
  SetWindowText(ColorDialog1.Handle, MyTitle);
  end; 
```

出于我的目的，我为 MyTitle 使用了一个全局变量，并在调用 ColorDialog1.Execute 之前分配了适当的文本。

# web-services - Axis 2 java2wsdl 创建的 wsdl 与 JBoss 在 ?wsdl URL 中显示的不同

> ID：762010
> 
> 赞同：1
> 
> 时间：2009-04-17T20:09:01.053
> 
> 标签：web-services, jboss, wsdl, wsdl2java

我正在重构构建自下而上 Web 服务的客户端代码的方式。[现有构建通过在 JBoss 4.2 上部署 Web 服务并针对http://devserver.url?wsdl](http://devserver.url?wsdl)执行 Axis 2 AntCodegenTask 来创建 Java 客户端代码。如果开发服务器已关闭或具有过时的 wsdl，则此方法将失败。（只要 wsdl 更改，Crusie Control 就会失败。）

我需要针对 Web 服务类本身构建客户端代码，而不必指向 Web 服务的部署。我使用 java2wsdl 从 Web 服务类生成 wsdl，然后使用相同的 AntCodegenTask 生成客户端类。

问题是 java2wsdl 创建的 wsdl 与 JBoss 在[http://devserver.url?wsdl](http://devserver.url?wsdl)中显示的不同。其中一些命名空间是不同的，AntCodegenTask 步骤不会将这些命名空间转换为正确的包结构。

我必须让最终的包结构成为客户端代码所期望的。现有的 AntCodegenTask 使用 namespacetopackages="..." 来实现这一点，但是当我对 java2wsdl 生成的 wsdl 执行相同的 AntCodegenTask 时，它不会将命名空间转换为包名。

为什么在 JBoss 中部署 Web 服务时，Axis 会显示与从 java2wsdl 生成的不同的 wsdl？

有没有办法使用 Axis 从 Web 服务类创建客户端代码而不生成中间 wsdl？

java2wsdl 和 wsdl2java Ant 任务的文档有点参差不齐。Axis 2 v 1.4.1 在不同的包中为 AntCodegenTask 和 2 个 Java2WSDLTasks 提供了 Ant 任务。Axis 2 安装包括 wsdl2java 和 java2wsdl 的二进制文件，但没有 codegen 二进制文件。也许 AntCodegenTask 和 wsdl2java 是一样的。

有没有人有这样的东西可以与 Axis 2 一起使用？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-02-24T13:00:09.603

在 JBoss 服务器上部署 web 服务。保存本地 WSDL 文件并将其作为参数传递给 Ant 任务。希望生成的类是正确的，但是 Axis 2 可能不喜欢使用 JBoss 生成的 WSDL。

在这种情况下，使用 JBoss 提供的 wsconsume.bat 而不是 AXIS ant 任务。

始终使用生成的 WSDL 文件，将其与应用程序打包等，因为即使是不同版本的 JBoss 也会产生不同的 WSDL 文件。

Axis 总是有点糟糕，如果可以的话（我现在不是那么明显......）使用 Apache CXF 或本机 JBoss 实现。

# javascript - 使用“let”和“var”有什么区别？

> ID：762011
> 
> 赞同：5648
> 
> 时间：2009-04-17T20:09:26.777
> 
> 标签：javascript, scope, ecmascript-6, var, let

### ECMAScript 6 引入[了`let`语句](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let)。

我听说它被描述为一个`local`变量，但我仍然不太确定它与`var`关键字的行为有何不同。

有什么区别？什么时候应该`let`使用而不是`var`？

* * *

## 回答 #1

> 赞同：7497
> 
> 时间：2012-07-12T02:53:34.897

# 范围规则

主要区别在于范围规则。由关键字声明的变量`var`的作用域是直接函数体（因此是函数作用域），而`let`变量的作用域是由 表示的直接*封闭*块`{ }`（因此是块作用域）。

```
function run() {
  var foo = "Foo";
  let bar = "Bar";

  console.log(foo, bar); // Foo Bar

  {
    var moo = "Mooo"
    let baz = "Bazz";
    console.log(moo, baz); // Mooo Bazz
  }

  console.log(moo); // Mooo
  console.log(baz); // ReferenceError
}

run();
```

`let`将关键字引入语言的原因是函数范围令人困惑，并且是 JavaScript 中错误的主要来源之一。

[从另一个 Stack Overflow 问题](https://stackoverflow.com/questions/750486/javascript-closure-inside-loops-simple-practical-example)看一下这个例子：

```
var funcs = [];
// let's create 3 functions
for (var i = 0; i < 3; i++) {
  // and store them in funcs
  funcs[i] = function() {
    // each should log its value.
    console.log("My value: " + i);
  };
}
for (var j = 0; j < 3; j++) {
  // and now let's run each one to see
  funcs[j]();
}
```

`My value: 3`每次`funcs[j]();`调用时都输出到控制台，因为匿名函数绑定到同一个变量。

人们必须创建立即调用的函数来从循环中捕获正确的值，但这也很麻烦。

# 吊装

`var`虽然用关键字声明的变量被[提升](https://dev.to/godcrampy/the-secret-of-hoisting-in-javascript-egi)（在代码运行之前用初始化`undefined`），这意味着它们甚至在声明之前就可以在其封闭范围内访问：

```
function run() {
  console.log(foo); // undefined
  var foo = "Foo";
  console.log(foo); // Foo
}

run();
```

`let`变量在其定义被评估之前不会被初始化。在初始化之前访问它们会导致`ReferenceError`. 从块的开始到处理初始化，该变量被称为处于“临时死区”。

```
function checkHoisting() {
  console.log(foo); // ReferenceError
  let foo = "Foo";
  console.log(foo); // Foo
}

checkHoisting();
```

# 创建全局对象属性

在顶层`let`， 与 不同`var`，不会在全局对象上创建属性：

```
var foo = "Foo";  // globally scoped
let bar = "Bar"; // not allowed to be globally scoped

console.log(window.foo); // Foo
console.log(window.bar); // undefined
```

# 重新声明

在严格模式下，`var`将允许您在同一范围内重新声明同一变量，同时`let`引发 SyntaxError。

```
'use strict';
var foo = "foo1";
var foo = "foo2"; // No problem, 'foo1' is replaced with 'foo2'.

let bar = "bar1"; 
let bar = "bar2"; // SyntaxError: Identifier 'bar' has already been declared
```

* * *

## 回答 #2

> 赞同：756
> 
> 时间：2015-05-27T10:16:23.697

`let`也可以用来避免闭包问题。它绑定新值而不是保留旧引用，如下面的示例所示。

```
for(var i=1; i<6; i++) {
  $("#div" + i).click(function () { console.log(i); });
}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<p>Clicking on each number will log to console:</p> 
<div id="div1">1</div>
<div id="div2">2</div>
<div id="div3">3</div>
<div id="div4">4</div>
<div id="div5">5</div>
```

上面的代码演示了一个经典的 JavaScript 闭包问题。对变量的引用`i`存储在 click 处理程序闭包中，而不是`i`.

每个单击处理程序都将引用同一个对象，因为只有一个计数器对象可以容纳 6 个，因此每次单击都会得到 6 个。

一般的解决方法是将其包装在匿名函数中并`i`作为参数传递。现在也可以通过使用`let`instead来避免此类问题`var`，如下面的代码所示。

[（在 Chrome 和 Firefox 50 中测试）]

```
for(let i=1; i<6; i++) {
  $("#div" + i).click(function () { console.log(i); });
}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<p>Clicking on each number will log to console:</p> 
<div id="div1">1</div>
<div id="div2">2</div>
<div id="div3">3</div>
<div id="div4">4</div>
<div id="div5">5</div>
```

* * *

## 回答 #3

> 赞同：284
> 
> 时间：2016-02-23T18:35:27.890

### `let`和有什么区别`var`？

*   使用`var`语句定义的变量在定义它的整个[**函数**](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/function)中都是已知的，从函数的开始。*(*)*
*   使用`let`语句定义的变量仅在定义它[**的块**](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/block)中是已知的，从它被定义的那一刻起。*(**)*

要了解差异，请考虑以下代码：

```
// i IS NOT known here
// j IS NOT known here
// k IS known here, but undefined
// l IS NOT known here

function loop(arr) {
    // i IS known here, but undefined
    // j IS NOT known here
    // k IS known here, but has a value only the second time loop is called
    // l IS NOT known here

    for( var i = 0; i < arr.length; i++ ) {
        // i IS known here, and has a value
        // j IS NOT known here
        // k IS known here, but has a value only the second time loop is called
        // l IS NOT known here
    };

    // i IS known here, and has a value
    // j IS NOT known here
    // k IS known here, but has a value only the second time loop is called
    // l IS NOT known here

    for( let j = 0; j < arr.length; j++ ) {
        // i IS known here, and has a value
        // j IS known here, and has a value
        // k IS known here, but has a value only the second time loop is called
        // l IS NOT known here
    };

    // i IS known here, and has a value
    // j IS NOT known here
    // k IS known here, but has a value only the second time loop is called
    // l IS NOT known here
}

loop([1,2,3,4]);

for( var k = 0; k < arr.length; k++ ) {
    // i IS NOT known here
    // j IS NOT known here
    // k IS known here, and has a value
    // l IS NOT known here
};

for( let l = 0; l < arr.length; l++ ) {
    // i IS NOT known here
    // j IS NOT known here
    // k IS known here, and has a value
    // l IS known here, and has a value
};

loop([1,2,3,4]);

// i IS NOT known here
// j IS NOT known here
// k IS known here, and has a value
// l IS NOT known here 
```

在这里，我们可以看到我们的变量`j`只在第一个 for 循环中是已知的，而不是在之前和之后。然而，我们的变量`i`在整个函数中都是已知的。

另外，考虑到块范围的变量在声明之前是未知的，因为它们没有被提升。您也不允许在同一个块内重新声明同一个块范围的变量。这使得块范围的变量比全局或功能范围的变量更不容易出错，全局或功能范围的变量被提升并且在多个声明的情况下不会产生任何错误。

* * *

### `let`今天使用安全吗？

有些人会争辩说，将来我们将只使用 let 语句，而 var 语句将变得过时。JavaScript 大师[**Kyle Simpson**](https://twitter.com/getify)写[**了一篇非常详尽的文章，解释了为什么他认为情况不会如此**](https://davidwalsh.name/for-and-against-let)。

然而，今天绝对不是这样。事实上，我们实际上需要问自己使用该`let`语句是否安全。该问题的答案取决于您的环境：

*   如果您正在编写服务器端 JavaScript 代码 ( [**Node.js**](https://nodejs.org/en/) )，则可以安全地使用该`let`语句。

*   如果您正在编写客户端 JavaScript 代码并使用基于浏览器的转译器（如[**Traceur**](https://github.com/google/traceur-compiler)或[**babel-standalone**](https://github.com/babel/babel-standalone)），您可以安全地使用该`let`语句，但是您的代码在性能方面可能不是最佳的。

*   如果您正在编写客户端 JavaScript 代码并使用基于节点的转译器（如[**traceur shell 脚本**](https://github.com/google/traceur-compiler/wiki/Compiling-Offline)或[**Babel**](https://babeljs.io/)），则可以安全地使用该`let`语句。而且因为您的浏览器只会知道转译的代码，所以性能缺陷应该是有限的。

*   如果您正在编写客户端 JavaScript 代码并且不使用转译器，则需要考虑浏览器支持。

    还有一些浏览器根本不支持`let`：

[![在此处输入图像描述](https://i.stack.imgur.com/J9kEC.png)](https://i.stack.imgur.com/J9kEC.png)

* * *

### 如何跟踪浏览器支持

`let`有关在您阅读此答案时哪些浏览器支持该声明的最新概述，请参阅[**此`Can I Use`页面**](http://caniuse.com/#search=let)。

* * *

*(*) 全局和功能范围的变量可以在声明之前初始化和使用，因为 JavaScript 变量是被[**提升**](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)的。*这意味着声明总是在范围的顶部。

*(**) 块范围的变量不被提升*

* * *

## 回答 #4

> 赞同：171
> 
> 时间：2009-04-17T20:11:47.053

这是[关键字的](https://developer.mozilla.org/en/New_in_JavaScript_1.7#Block_scope_with_let)[解释`let`](https://developer.mozilla.org/en/New_in_JavaScript_1.7#Block_scope_with_let)和一些示例。

> `let`非常喜欢`var`。主要区别在于`var`变量的作用域是整个封闭函数

[Wikipedia 上的此表](http://en.wikipedia.org/wiki/JavaScript#Version_history)显示了哪些浏览器支持 Javascript 1.7。

请注意，只有 Mozilla 和 Chrome 浏览器支持它。IE、Safari 和其他可能没有。

* * *

## 回答 #5

> 赞同：135
> 
> 时间：2015-06-02T20:59:17.957

接受的答案缺少一点：

```
{
  let a = 123;
};

console.log(a); // ReferenceError: a is not defined 
```

* * *

## 回答 #6

> 赞同：118
> 
> 时间：2016-11-23T22:52:38.350

# `let`

## 块范围

使用关键字声明的变量`let`是块作用域的，这意味着它们仅在声明它们的[块](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/block)中可用。

### 在顶层（函数之外）

在顶层，使用声明的变量`let`不会在全局对象上创建属性。

```
var globalVariable = 42;
let blockScopedVariable = 43;

console.log(globalVariable); // 42
console.log(blockScopedVariable); // 43

console.log(this.globalVariable); // 42
console.log(this.blockScopedVariable); // undefined 
```

### 在函数内部

在函数内部（但在块外部），`let`与`var`.

```
(() => {
  var functionScopedVariable = 42;
  let blockScopedVariable = 43;

  console.log(functionScopedVariable); // 42
  console.log(blockScopedVariable); // 43
})();

console.log(functionScopedVariable); // ReferenceError: functionScopedVariable is not defined
console.log(blockScopedVariable); // ReferenceError: blockScopedVariable is not defined 
```

### 块内

在块内使用声明的变量`let`不能在该块外访问。

```
{
  var globalVariable = 42;
  let blockScopedVariable = 43;
  console.log(globalVariable); // 42
  console.log(blockScopedVariable); // 43
}

console.log(globalVariable); // 42
console.log(blockScopedVariable); // ReferenceError: blockScopedVariable is not defined 
```

### 循环内

用 in 循环声明的变量`let`只能在该循环内引用。

```
for (var i = 0; i < 3; i++) {
  var j = i * 2;
}
console.log(i); // 3
console.log(j); // 4

for (let k = 0; k < 3; k++) {
  let l = k * 2;
}
console.log(typeof k); // undefined
console.log(typeof l); // undefined
// Trying to do console.log(k) or console.log(l) here would throw a ReferenceError. 
```

### 带闭包的循环

如果在循环中使用`let`而不是`var`，每次迭代都会得到一个新变量。这意味着您可以安全地在循环内使用闭包。

```
// Logs 3 thrice, not what we meant.
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 0);
}

// Logs 0, 1 and 2, as expected.
for (let j = 0; j < 3; j++) {
  setTimeout(() => console.log(j), 0);
} 
```

## 时间死区

由于[临时死区](https://stackoverflow.com/q/33198849/3853934)，使用声明的变量在声明`let`之前无法访问。尝试这样做会引发错误。

```
console.log(noTDZ); // undefined
var noTDZ = 43;
console.log(hasTDZ); // ReferenceError: hasTDZ is not defined
let hasTDZ = 42; 
```

## 无需重新声明

您不能使用多次声明同一个变量`let`。您也不能使用`let`与使用`var`.

```
var a;
var a; // Works fine.

let b;
let b; // SyntaxError: Identifier 'b' has already been declared

var c;
let c; // SyntaxError: Identifier 'c' has already been declared 
```

# `const`

`const`非常类似于`let`— 它是块范围的并且具有 TDZ。然而，有两件事是不同的。

## 无需重新分配

使用声明的变量`const`不能重新分配。

```
const a = 42;
a = 43; // TypeError: Assignment to constant variable. 
```

请注意，这并不意味着该值是不可变的。它的属性仍然可以更改。

```
const obj = {};
obj.a = 42;
console.log(obj.a); // 42 
```

如果你想拥有一个不可变的对象，你应该使用[`Object.freeze()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze).

## 需要初始化程序

使用 声明变量时，您始终必须指定一个值`const`。

```
const a; // SyntaxError: Missing initializer in const declaration 
```

* * *

## 回答 #7

> 赞同：95
> 
> 时间：2020-05-11T17:04:48.587

## 在最基本的条件下，

```
for (let i = 0; i < 5; i++) {
  // i accessible ✔️
}
// i not accessible ❌ 
```

* * *

```
for (var i = 0; i < 5; i++) {
  // i accessible ✔️
}
// i accessible ✔️ 
```

* * *

⚡️沙盒玩↓

[![编辑 let vs var](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/let-vs-var-emzh5?fontsize=14&hidenavigation=1&theme=dark)

* * *

## 回答 #8

> 赞同：64
> 
> 时间：2015-03-06T10:41:10.797

这是两者之间差异的示例（对 chrome 的支持刚刚开始）：
![在此处输入图像描述](https://i.stack.imgur.com/dqNYW.png)

如您所见，该`var j`变量的值仍在 for 循环范围（块范围）之外，但该`let i`变量在 for 循环范围之外未定义。

```
"use strict";
console.log("var:");
for (var j = 0; j < 2; j++) {
  console.log(j);
}

console.log(j);

console.log("let:");
for (let i = 0; i < 2; i++) {
  console.log(i);
}

console.log(i);
```

* * *

## 回答 #9

> 赞同：61
> 
> 时间：2009-04-17T21:38:22.663

有一些细微的区别——`let`作用域的行为更像是变量作用域在或多或少的任何其他语言中所做的。

例如，它的范围是封闭块，它们在声明之前不存在，等等。

然而值得注意的是，这`let`只是较新的 Javascript 实现的一部分，并且具有不同程度的[浏览器支持](http://caniuse.com/#search=let)。

* * *

## 回答 #10

> 赞同：61
> 
> 时间：2017-03-22T14:39:46.200

主要区别在于**作用域**的不同，而**let**只能在它声明的**作用域内**可用，例如在 for 循环中，而**var**可以在循环外访问。[从MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let)中的文档（也来自 MDN 的示例）：

> **let**允许您将范围限制在使用它的块、语句或表达式中声明变量。这与**var**关键字不同，它在全局范围内定义一个变量，或者在整个函数的本地定义一个变量，而不考虑块范围。
> 
> **let**声明的变量的作用域是定义它们的块，以及任何包含的子块。这样，**let的工作方式与****var**非常相似。主要区别在于**var**变量的作用域是整个封闭函数：

```
function varTest() {
  var x = 1;
  if (true) {
    var x = 2;  // same variable!
    console.log(x);  // 2
  }
  console.log(x);  // 2
}

function letTest() {
  let x = 1;
  if (true) {
    let x = 2;  // different variable
    console.log(x);  // 2
  }
  console.log(x);  // 1
}` 
```

> 在程序和函数的顶层，**let**与**var**不同，不会在全局对象上创建属性。例如：

```
var x = 'global';
let y = 'global';
console.log(this.x); // "global"
console.log(this.y); // undefined 
```

> 在块内使用时，让变量的范围限制在该块内。注意作用域在声明它的函数内部的**var**之间的区别。

```
var a = 1;
var b = 2;

if (a === 1) {
  var a = 11; // the scope is global
  let b = 22; // the scope is inside the if-block

  console.log(a);  // 11
  console.log(b);  // 22
} 

console.log(a); // 11
console.log(b); // 2 
```

也不要忘记它的 ECMA6 功能，所以它还没有完全支持，所以最好总是使用 Babel 等将它转换为 ECMA5 ......有关访问[babel 网站的更多信息](https://babeljs.io)

* * *

## 回答 #11

> 赞同：33
> 
> 时间：2016-01-17T15:11:31.843

*   ~~**变量不提升**~~

    ~~`let`不会**提升**到它们出现的块的整个范围。相比之下，`var`可以提升如下。~~

    ```
    {
       console.log(cc); // undefined. Caused by hoisting
       var cc = 23;
    }

    {
       console.log(bb); // ReferenceError: bb is not defined
       let bb = 23;
    } 
    ```

    实际上，根据@Bergi，[两者`var`和`let`都被提升](https://stackoverflow.com/questions/31219420/are-variables-declared-with-let-or-const-not-hoisted-in-es6)了。

*   **垃圾收集**

    块范围`let`是有用的，涉及到闭包和垃圾收集以回收内存。考虑，

    ```
    function process(data) {
        //...
    }

    var hugeData = { .. };

    process(hugeData);

    var btn = document.getElementById("mybutton");
    btn.addEventListener( "click", function click(evt){
        //....
    }); 
    ```

    `click`处理程序回调根本不需要该变量`hugeData`。理论上，`process(..)`运行后，巨大的数据结构`hugeData`可能会被垃圾回收。然而，一些 JS 引擎可能仍然必须保持这个巨大的结构，因为该`click`函数在整个范围内都有一个闭包。

    但是，块作用域可以使这个庞大的数据结构被垃圾回收。

    ```
    function process(data) {
        //...
    }

    { // anything declared inside this block can be garbage collected
        let hugeData = { .. };
        process(hugeData);
    }

    var btn = document.getElementById("mybutton");
    btn.addEventListener( "click", function click(evt){
        //....
    }); 
    ```

*   **`let`循环**

    `let`in the loop 可以**将它重新绑定**到循环的每个迭代，确保从上一个循环迭代结束时重新为其分配值。考虑，

    ```
    // print '5' 5 times
    for (var i = 0; i < 5; ++i) {
        setTimeout(function () {
            console.log(i);
        }, 1000);  
    } 
    ```

    但是，替换`var`为`let`

    ```
    // print 1, 2, 3, 4, 5\. now
    for (let i = 0; i < 5; ++i) {
        setTimeout(function () {
            console.log(i);
        }, 1000);  
    } 
    ```

    因为`let`使用这些名称为 a) 初始化表达式 b) 每次迭代（之前评估增量表达式）创建一个新的词法环境，所以[这里](https://stackoverflow.com/a/30900289/3011380)有更多详细信息。

* * *

## 回答 #12

> 赞同：31
> 
> 时间：2017-05-22T01:09:39.303

不同之处在于每个声明的变量的[范围](https://en.wikipedia.org/wiki/Variable_(computer_science)#Scope_and_extent)。

在实践中，范围差异有许多有用的后果：

1.  `let`变量仅在其*最近的封闭*块 ( `{ ... }`) 中可见。
2.  `let`变量只能在声明变量*后*出现的代码行中使用（即使[它们被提升](/questions/33198849)了！）。
3.  `let`变量可能不会被后续的`var`or重新声明`let`。
4.  全局`let`变量不会添加到全局`window`对象中。
5.  `let`变量很*容易*与闭包一起使用（它们不会导致[竞争条件](https://en.wikipedia.org/wiki/Race_condition#Software)）。

所施加的限制`let`降低了变量的可见性并增加了提前发现意外名称冲突的可能性。这使得跟踪和推理变量变得更容易，包括它们的[可达性](https://en.wikipedia.org/wiki/Unreachable_memory)（帮助回收未使用的内存）。

因此，`let`当在大型程序中使用变量或以新的和意想不到的方式组合独立开发的框架时，变量不太可能引起问题。

`var`如果您确定在循环中使用闭包 (#5) 或在代码中声明外部可见的全局变量 (#4) 时需要单一绑定效果，则可能仍然有用。如果迁移出转译器空间并迁移到核心语言中，则 for 导出的使用`var`可能会被取代。[`export`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export)

# 例子

**1\. 在最近的封闭块之外不使用：** 此代码块将引发引用错误，因为第二次使用`x`发生在声明它的块之外`let`：

```
{
    let x = 1;
}
console.log(`x is ${x}`);  // ReferenceError during parsing: "x is not defined". 
```

相比之下，与`var`作品相同的例子。

**2\. 声明前不使用：**
这段代码会`ReferenceError`在代码运行前抛出a，因为`x`在声明之前使用了：

```
{
    x = x + 1;  // ReferenceError during parsing: "x is not defined".
    let x;
    console.log(`x is ${x}`);  // Never runs.
} 
```

相反，同样的例子在`var`解析和运行时不会抛出任何异常。

**3\. 不重新声明：** 下面的代码演示了用 声明的变量`let`以后可能不会重新声明：

```
let x = 1;
let x = 2;  // SyntaxError: Identifier 'x' has already been declared 
```

**4\. 未附加到的全局变量`window`：**

```
var button = "I cause accidents because my name is too common.";
let link = "Though my name is common, I am harder to access from other JS files.";
console.log(link);  // OK
console.log(window.link);  // undefined (GOOD!)
console.log(window.button);  // OK 
```

**5\. 易于使用闭包：** 声明的变量`var`不能很好地与循环内的闭包一起使用。`i`这是一个简单的循环，它输出变量在不同时间点的值序列：

```
for (let i = 0; i < 5; i++) {
    console.log(`i is ${i}`), 125/*ms*/);
} 
```

具体来说，这会输出：

```
i is 0
i is 1
i is 2
i is 3
i is 4 
```

在 JavaScript 中，我们经常在比创建它们的时间晚得多的时候使用变量。当我们通过传递给的闭包延迟输出来证明这一点时`setTimeout`：

```
for (let i = 0; i < 5; i++) {
    setTimeout(_ => console.log(`i is ${i}`), 125/*ms*/);
} 
```

...只要我们坚持，输出就保持不变`let`。相反，如果我们`var i`改为使用：

```
for (var i = 0; i < 5; i++) {
    setTimeout(_ => console.log(`i is ${i}`), 125/*ms*/);
} 
```

...循环意外输出“i is 5”五次：

```
i is 5
i is 5
i is 5
i is 5
i is 5 
```

* * *

## 回答 #13

> 赞同：26
> 
> 时间：2014-08-18T00:58:29.177

这是一个添加到其他人已经编写的内容的示例。假设您要创建一个函数数组`adderFunctions`，其中每个函数接受一个 Number 参数并返回参数和函数在数组中的索引的总和。尝试`adderFunctions`使用`var`关键字生成循环不会像人们天真期望的那样工作：

```
// An array of adder functions.
var adderFunctions = [];

for (var i = 0; i < 1000; i++) {
  // We want the function at index i to add the index to its argument.
  adderFunctions[i] = function(x) {
    // What is i bound to here?
    return x + i;
  };
}

var add12 = adderFunctions[12];

// Uh oh. The function is bound to i in the outer scope, which is currently 1000.
console.log(add12(8) === 20); // => false
console.log(add12(8) === 1008); // => true
console.log(i); // => 1000

// It gets worse.
i = -8;
console.log(add12(8) === 0); // => true 
```

上面的过程不会生成所需的函数数组，因为`i`的范围超出了`for`创建每个函数的块的迭代。相反，在循环结束时，`i`每个函数的闭包中的每个匿名函数都引用`i`循环结束时的值（1000）`adderFunctions`。这根本不是我们想要的：我们现在在内存中有一个包含 1000 个不同函数的数组，它们的行为完全相同。如果我们随后更新 的值`i`，突变将影响所有的`adderFunctions`。

`let`但是，我们可以使用关键字再试一次：

```
// Let's try this again.
// NOTE: We're using another ES6 keyword, const, for values that won't
// be reassigned. const and let have similar scoping behavior.
const adderFunctions = [];

for (let i = 0; i < 1000; i++) {
  // NOTE: We're using the newer arrow function syntax this time, but 
  // using the "function(x) { ..." syntax from the previous example 
  // here would not change the behavior shown.
  adderFunctions[i] = x => x + i;
}

const add12 = adderFunctions[12];

// Yay! The behavior is as expected. 
console.log(add12(8) === 20); // => true

// i's scope doesn't extend outside the for loop.
console.log(i); // => ReferenceError: i is not defined 
```

这一次，`i`是在`for`循环的每次迭代中反弹。现在，每个函数都保留`i`函数创建时的值，`adderFunctions`并按预期运行。

现在，图像混合这两种行为，您可能会明白为什么不建议在同一脚本中混合`let`新旧行为。这样做可能会导致一些非常混乱的代码。`const``var`

```
const doubleAdderFunctions = [];

for (var i = 0; i < 1000; i++) {
    const j = i;
    doubleAdderFunctions[i] = x => x + i + j;
}

const add18 = doubleAdderFunctions[9];
const add24 = doubleAdderFunctions[12];

// It's not fun debugging situations like this, especially when the
// code is more complex than in this example.
console.log(add18(24) === 42); // => false
console.log(add24(18) === 42); // => false
console.log(add18(24) === add24(18)); // => false
console.log(add18(24) === 2018); // => false
console.log(add24(18) === 2018); // => false
console.log(add18(24) === 1033); // => true
console.log(add24(18) === 1030); // => true 
```

不要让这种情况发生在你身上。使用棉绒。

> **注意：**这是一个教学示例，旨在演示循环中的`var`/`let`行为以及易于理解的函数闭包。这将是一种可怕的添加数字的方法。但是在其他上下文中可能会在现实世界中遇到在匿名函数闭包中捕获数据的一般技术。YMMV。

* * *

## 回答 #14

> 赞同：23
> 
> 时间：2015-12-17T03:22:03.993

可能以下两个函数显示差异：

```
function varTest() {
    var x = 31;
    if (true) {
        var x = 71;  // Same variable!
        console.log(x);  // 71
    }
    console.log(x);  // 71
}

function letTest() {
    let x = 31;
    if (true) {
        let x = 71;  // Different variable
        console.log(x);  // 71
    }
    console.log(x);  // 31
} 
```

* * *

## 回答 #15

> 赞同：17
> 
> 时间：2015-08-11T00:35:29.740

看起来，至少在 Visual Studio 2015 和 TypeScript 1.5 中，“var”允许在一个块中多次声明相同的变量名，而“let”则不允许。

这不会产生编译错误：

```
var x = 1;
var x = 2; 
```

这会：

```
let x = 1;
let x = 2; 
```

* * *

## 回答 #16

> 赞同：17
> 
> 时间：2016-07-08T00:21:11.467

`let`很有趣，因为它允许我们做这样的事情：

```
(() => {
    var count = 0;

    for (let i = 0; i < 2; ++i) {
        for (let i = 0; i < 2; ++i) {
            for (let i = 0; i < 2; ++i) {
                console.log(count++);
            }
        }
    }
})(); 
```

这导致计数 [0, 7]。

然而

```
(() => {
    var count = 0;

    for (var i = 0; i < 2; ++i) {
        for (var i = 0; i < 2; ++i) {
            for (var i = 0; i < 2; ++i) {
                console.log(count++);
            }
        }
    }
})(); 
```

仅计数 [0, 1]。

* * *

## 回答 #17

> 赞同：17
> 
> 时间：2018-09-09T13:08:18.867

## 函数 VS 块作用域：

`var`和之间的主要区别在于`let`使用声明的变量`var`是**函数范围**的。而用声明的函数`let`是**块作用域**的。例如：

```
function testVar () {
  if(true) {
    var foo = 'foo';
  }

  console.log(foo);
}

testVar();  
// logs 'foo'

function testLet () {
  if(true) {
    let bar = 'bar';
  }

  console.log(bar);
}

testLet(); 
// reference error
// bar is scoped to the block of the if statement 
```

**变量`var`：**

当第一个函数`testVar`被调用时，用 声明的变量 foo`var`仍然可以在`if`语句之外访问。该变量在**函数**范围内的**任何地方**`foo`都可用。**`testVar`**

 ******变量`let`：**

当第二个函数`testLet`被调用时，用 声明的变量 bar`let`只能在`if`语句内部访问。因为用声明的变量`let`是**块范围**的（其中块是大括号之间的代码，例如，，，`if{}`）。`for{}``function{}`

## `let`变量不会被提升：

`var`和之间的另一个区别`let`是声明为的变量`let` **不会被提升**。一个例子是说明这种行为的最佳方式：

`let` **不**被提升的变量：

```
console.log(letVar);

let letVar = 10;
// referenceError, the variable doesn't get hoisted 
```

`var` **带有do**的变量被提升：

```
console.log(varVar);

var varVar = 10;
// logs undefined, the variable gets hoisted 
```

## 全球`let`不依附于`window`：

在全局范围内声明的变量`let`（即不在函数中的代码）不会作为属性添加到全局`window`对象上。例如（此代码在全局范围内）：

```
var bar = 5;
let foo  = 10;

console.log(bar); // logs 5
console.log(foo); // logs 10

console.log(window.bar);  
// logs 5, variable added to window object

console.log(window.foo);
// logs undefined, variable not added to window object 
```

> **什么时候应该`let`用完`var`？**

尽可能使用`let`over `var`，因为它的范围更具体。这减少了在处理大量变量时可能发生的潜在命名冲突。`var`当您希望全局变量显式位于对象上时可以使用`window`（如果确实需要，请务必仔细考虑）。

* * *

## 回答 #18

> 赞同：17
> 
> 时间：2020-01-26T11:39:21.787

ES6 引入了两个替代**var的新关键字（** **let**和**const** ） 。

 **当您需要块级减速时，您可以使用 let 和 const 而不是 var。

下表总结了 var、let 和 const 之间的区别

[![在此处输入图像描述](https://i.stack.imgur.com/GBn5a.jpg)](https://i.stack.imgur.com/GBn5a.jpg)

* * *

## 回答 #19

> 赞同：13
> 
> 时间：2017-10-28T12:42:16.280

`var`是全局范围（可提升）变量。

`let`并且`const`是块范围。

> 测试.js

```
{
    let l = 'let';
    const c = 'const';
    var v = 'var';
    v2 = 'var 2';
}

console.log(v, this.v);
console.log(v2, this.v2);
console.log(l); // ReferenceError: l is not defined
console.log(c); // ReferenceError: c is not defined
```

* * *

## 回答 #20

> 赞同：10
> 
> 时间：2016-10-14T05:01:10.210

如果我正确阅读了规范，那么`let` **幸运**的是，还可以利用它来避免用于模拟私有成员的[自调用函数——](https://stackoverflow.com/questions/592396/what-is-the-purpose-of-a-self-executing-function-in-javascript#592414)*一种流行的设计模式，它降低了代码的可读性，使调试复杂化，没有增加真正的代码保护或其他好处——除了可能满足某人的对语义的渴望，所以停止使用它。/咆哮*

```
var SomeConstructor;

{
    let privateScope = {};

    SomeConstructor = function SomeConstructor () {
        this.someProperty = "foo";
        privateScope.hiddenProperty = "bar";
    }

    SomeConstructor.prototype.showPublic = function () {
        console.log(this.someProperty); // foo
    }

    SomeConstructor.prototype.showPrivate = function () {
        console.log(privateScope.hiddenProperty); // bar
    }

}

var myInstance = new SomeConstructor();

myInstance.showPublic();
myInstance.showPrivate();

console.log(privateScope.hiddenProperty); // error 
```

请参阅“[模拟私有接口](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/let#Emulating_private_interfaces)”

* * *

## 回答 #21

> 赞同：10
> 
> 时间：2018-05-22T13:12:36.923

**使用时`let`**

关键字将`let`变量声明附加到`{ .. }`它包含的任何块（通常是一对）的范围内。换句话说，`let`隐式劫持了任何块的变量声明范围。

`let`不能在对象中访问变量，`window`因为它们不能被全局访问。

```
function a(){
    { // this is the Max Scope for let variable
        let x = 12;
    }
    console.log(x);
}
a(); // Uncaught ReferenceError: x is not defined 
```

**使用时`var`**

`var`ES5 中的变量在函数中具有作用域，这意味着变量在函数内部有效，而不是在函数本身外部有效。

`var`变量可以在`window`对象中访问，因为它们不能被全局访问。

```
function a(){ // this is the Max Scope for var variable
    { 
        var x = 12;
    }
    console.log(x);
}
a(); // 12 
```

**如果您想了解更多，请继续阅读下面**

关于范围的最著名的面试问题之一也可以满足以下的确切`let`用法`var`；

**使用时`let`**

```
for (let i = 0; i < 10 ; i++) {
    setTimeout(
        function a() {
            console.log(i); //print 0 to 9, that is literally AWW!!!
        }, 
        100 * i);
} 
```

这是因为在使用时`let`，对于每个循环迭代，变量都是有作用域的并且有自己的副本。

**使用时`var`**

```
for (var i = 0; i < 10 ; i++) {
    setTimeout(
        function a() {
            console.log(i); //print 10 times 10
        }, 
        100 * i);
} 
```

这是因为在使用时`var`，对于每个循环迭代，变量都是有作用域的并且具有共享副本。

* * *

## 回答 #22

> 赞同：8
> 
> 时间：2016-07-21T17:42:16.157

一些技巧`let`：

1.

```
 let statistics = [16, 170, 10];
    let [age, height, grade] = statistics;

    console.log(height) 
```

2.

```
 let x = 120,
    y = 12;
    [x, y] = [y, x];
    console.log(`x: ${x} y: ${y}`); 
```

3.

```
 let node = {
                   type: "Identifier",
                   name: "foo"
               };

    let { type, name, value } = node;

    console.log(type);      // "Identifier"
    console.log(name);      // "foo"
    console.log(value);     // undefined

    let node = {
        type: "Identifier"
    };

    let { type: localType, name: localName = "bar" } = node;

    console.log(localType);     // "Identifier"
    console.log(localName);     // "bar" 
```

### 获取器和设置器`let`：

```
let jar = {
    numberOfCookies: 10,
    get cookies() {
        return this.numberOfCookies;
    },
    set cookies(value) {
        this.numberOfCookies = value;
    }
};

console.log(jar.cookies)
jar.cookies = 7;

console.log(jar.cookies) 
```

* * *

## 回答 #23

> 赞同：8
> 
> 时间：2022-01-12T18:20:10.143

这个解释取自我在[Medium](https://blog.devgenius.io/how-does-hoisting-in-javascript-works-80614300cb98)上写的一篇文章：

> 提升是一种 JavaScript 机制，其中变量和函数声明由解析器移动到其作用域的顶部，解析器在 JavaScript 解释器开始实际代码执行之前将源代码读入中间表示。因此，无论变量或函数在哪里声明，它们都将被移动到其作用域的顶部，而不管它们的作用域是全局的还是局部的。这意味着
> 
> ```
> console.log (hi);     
> var hi = "say hi"; 
> ```
> 
> 实际上是这样解释的
> 
> ```
> var hi = undefined;
> console.log (hi);
> hi = "say hi"; 
> ```
> 
> 因此，正如我们刚才看到的，`var`变量被提升到其作用域的顶部，并使用 undefined 的值进行初始化，这意味着我们可以在代码中实际声明它们之前实际分配它们的值，如下所示：
> 
> ```
> hi = “say hi”
> console.log (hi); // say hi
> var hi; Regarding function declarations, we can invoke them before actually declaring them like so:
> 
> sayHi(); // Hi
> 
> function sayHi() {
>    console.log('Hi');
> }; Function expressions, on the other hand, are not hoisted, so we’ll get the following error:
> 
> sayHi(); //Output: "TypeError: sayHi is not a function
> 
> var sayHi = function() {
>   console.log('Hi');
> }; ES6 introduced JavaScript developers the `let` and `const` keywords. While `let` and `const` are block-scoped and not function 
> ```
> 
> 范围，因为`var`在讨论它们的提升行为时它不应该有所作为。我们将从最后开始，JavaScript 提升`let` 和`const`.
> 
> ```
> console.log(hi); // Output: Cannot access 'hi' before initialization 
> let hi = 'Hi'; 
> ```
> 
> 正如我们在上面看到的，`let`不允许我们使用未声明的变量，因此解释器显式地输出一个引用错误，指示`hi`在初始化之前无法访问该变量。如果我们将上面的内容更改`let` 为`const`
> 
> ```
> console.log(hi); // Output: Cannot access 'hi' before initialization
> const hi = 'Hi'; 
> ```
> 
> 因此，最重要的是，JavaScript 解析器搜索变量声明和函数，并在代码执行之前将它们提升到其作用域的顶部，并在内存中为它们赋值，以便解释器在执行代码时遇到它们，他将识别它们并且将能够使用分配的值执行代码。使用 声明的变量`let`或`const`在执行开始时未初始化的变量，而`var`使用`undefined`
> 
> 我添加了这个视觉插图来帮助理解提升的变量和函数是如何保存在内存中的[![在此处输入图像描述](https://i.stack.imgur.com/7aRxL.png)](https://i.stack.imgur.com/7aRxL.png)

* * *

## 回答 #24

> 赞同：7
> 
> 时间：2019-09-07T11:25:15.033

下面显示了 'let' 和 'var' 在范围内的不同之处：

```
let gfoo = 123;
if (true) {
    let gfoo = 456;
}
console.log(gfoo); // 123

var hfoo = 123;
if (true) {
    var hfoo = 456;
}
console.log(hfoo); // 456 
```

`gfoo`由`let`最初定义的 , 在全局**范围内**，当我们在其范围内`gfoo`再次声明***更改***时，并且当为该范围内的变量分配新值时，它**不会影响**全局范围。`if clause`

 ***而`hfoo`, by`var`最初是在**全局范围内**定义的，但是当我们在 内部声明它时`if clause`，它再次考虑全局范围 hfoo，尽管 var 再次被用来声明它。当我们重新分配它的值时，我们看到全局范围 hfoo 也受到了影响。这是主要区别。

* * *

## 回答 #25

> 赞同：6
> 
> 时间：2017-12-17T10:47:31.203

let 是 es6 的一部分。这些功能将以简单的方式解释差异。

```
function varTest() {
  var x = 1;
  if (true) {
    var x = 2;  // same variable!
    console.log(x);  // 2
  }
  console.log(x);  // 2
}

function letTest() {
  let x = 1;
  if (true) {
    let x = 2;  // different variable
    console.log(x);  // 2
  }
  console.log(x);  // 1
} 
```

* * *

## 回答 #26

> 赞同：6
> 
> 时间：2019-04-18T00:49:32.580

让 vs var。这都是关于**范围**的。

**var 变量是全局的**，基本上可以在任何地方访问，而**let 变量不是全局**的，只存在直到右括号杀死它们。

请参阅下面的示例，并注意 Lion (let) 变量在两个 console.logs 中的行为方式有何不同；它超出了第二个 console.log 的范围。

```
var cat = "cat";
let dog = "dog";

var animals = () => {
    var giraffe = "giraffe";
    let lion = "lion";

    console.log(cat);  //will print 'cat'.
    console.log(dog);  //will print 'dog', because dog was declared outside this function (like var cat).

    console.log(giraffe); //will print 'giraffe'.
    console.log(lion); //will print 'lion', as lion is within scope.
}

console.log(giraffe); //will print 'giraffe', as giraffe is a global variable (var).
console.log(lion); //will print UNDEFINED, as lion is a 'let' variable and is now out of scope. 
```

* * *

## 回答 #27

> 赞同：6
> 
> 时间：2020-10-25T17:15:21.910

我刚刚遇到一个用例，我不得不使用`var`它`let`来引入新变量。这是一个案例：

我想用动态变量名创建一个新变量。

```
let variableName = 'a';
eval("let " + variableName + '= 10;');
console.log(a);   // this doesn't work 
```

```
var variableName = 'a';
eval("var " + variableName + '= 10;');
console.log(a);   // this works 
```

上面的代码不起作用，因为`eval`引入了一个新的代码块。声明 using`var`将在此代码块之外`var`声明一个变量，因为在函数范围内声明了一个变量。

`let`另一方面，在块范围内声明一个变量。因此，`a`变量只会在`eval`块中可见。

* * *

## 回答 #28

> 赞同：4
> 
> 时间：2018-08-07T10:25:57.247

正如刚才提到的：

> 区别在于范围。`var`范围为最近的**功能块**，`let`范围为**最近的封闭块**，它可以小于一个功能块。如果在任何块之外，两者都是全局的。让我们看一个例子：

**示例 1：**

在我的两个示例中，我都有一个函数`myfunc`。`myfunc`包含一个`myvar`等于 10 的变量。在我的第一个示例中，我检查是否`myvar`等于 10 ( `myvar==10`) 。如果是，我 `myvar`再次使用关键字声明一个变量（现在我有两个 myvar 变量）`var`并为其分配一个新值（20）。在下一行中，我在控制台上打印它的值。在条件块之后，我再次`myvar`在控制台上打印 的值。如果您查看 的输出`myfunc`， `myvar`其值等于 20。

[![让关键字](https://i.stack.imgur.com/sWpnR.png)](https://i.stack.imgur.com/sWpnR.png)

**示例 2 ：** 在我的第二个示例中`var`，我没有在条件块中使用关键字，而是使用关键字`myvar`声明`let`。现在，当我打电话时，`myfunc` 我得到两个不同的输出：`myvar=20`和`myvar=10`.

所以区别很简单，即它的范围。

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2016-07-01T08:22:35.487

现在我认为使用以下语句可以更好地为语句块定义变量范围`let`：

```
function printnums()
{
    // i is not accessible here
    for(let i = 0; i <10; i+=)
    {
       console.log(i);
    }
    // i is not accessible here

    // j is accessible here
    for(var j = 0; j <10; j++)
    {
       console.log(j);
    }
    // j is accessible here
} 
```

我认为人们会在这里开始使用 let ，以便他们在 JavaScript 中拥有类似的作用域，就像其他语言、Java、C# 等一样。

对 JavaScript 中的作用域没有清晰理解的人通常会更早地犯错误。

不支持使用 提升`let`。

使用这种方法，JavaScript 中存在的错误将被消除。

请参阅*[ES6 In Depth: let 和 const](https://hacks.mozilla.org/2015/07/es6-in-depth-let-and-const/)*以更好地理解它。

* * *

## 回答 #30

> 赞同：3
> 
> 时间：2019-02-13T16:07:22.670

我想将这些关键字链接到执行上下文，因为执行上下文在所有这些中都很重要。执行上下文有两个阶段：创建阶段和执行阶段。此外，每个执行上下文都有一个变量环境和外部环境（它的词法环境）。

在执行上下文的创建阶段，var、let 和 const 仍将其变量存储在内存中，并且在给定执行上下文的变量环境中具有未定义的值。区别在于执行阶段。如果您在为其赋值之前使用使用 var 定义的变量的引用，它将只是未定义的。不会引发异常。

但是，在声明之前，您不能引用使用 let 或 const 声明的变量。如果您在声明之前尝试使用它，那么在执行上下文的执行阶段将引发异常。现在该变量仍将在内存中，由执行上下文的创建阶段提供，但引擎不允许您使用它：

```
function a(){
    b;
    let b;
}
a();
> Uncaught ReferenceError: b is not defined 
```

使用 var 定义的变量，如果引擎在当前执行上下文的变量环境中找不到该变量，那么它将沿着作用域链（外部环境）检查该变量的外部环境变量环境。如果在那里找不到它，它将继续搜索范围链。let 和 const 不是这种情况。

let 的第二个特点是它引入了块作用域。块由花括号定义。示例包括功能块、if 块、for 块等。当您在块内使用 let 声明变量时，该变量仅在块内可用。实际上，每次运行该块时，例如在 for 循环中，它都会在内存中创建一个新变量。

ES6 还引入了 const 关键字来声明变量。const 也是块作用域。let 和 const 的区别在于 const 变量需要使用初始化器来声明，否则会产生错误。

最后，当涉及到执行上下文时，用 var 定义的变量将附加到“this”对象。在全局执行上下文中，这将是浏览器中的窗口对象。这不是 let 或 const 的情况。

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2019-03-11T16:52:45.457

由于我目前正在尝试深入了解 JavaScript，因此我将分享我的简短研究，其中包含一些已经讨论过的优秀作品以及其他一些从不同角度看的细节。

如果我们了解*function*和*block scope之间的区别，理解***var**和**let**之间的区别会更容易。

 **让我们考虑以下情况：

```
(function timer() {
    for(var i = 0; i <= 5; i++) {
        setTimeout(function notime() { console.log(i); }, i * 1000);
    }
})();

   Stack            VariableEnvironment //one VariablEnvironment for timer();
                                       // when the timer is out - the value will be the same value for each call
5\. [setTimeout, i]  [i=5] 
4\. [setTimeout, i]  
3\. [setTimeout, i]
2\. [setTimeout, i]
1\. [setTimeout, i]
0\. [setTimeout, i]

####################    

(function timer() {
    for (let i = 0; i <= 5; i++) {
        setTimeout(function notime() { console.log(i); }, i * 1000);
    }
})();

   Stack           LexicalEnvironment - each iteration has a new lexical environment
5\. [setTimeout, i]  [i=5]       
                      LexicalEnvironment 
4\. [setTimeout, i]    [i=4]     
                        LexicalEnvironment 
3\. [setTimeout, i]      [i=3]       
                         LexicalEnvironment 
2\. [setTimeout, i]       [i=2]
                           LexicalEnvironment 
1\. [setTimeout, i]         [i=1]
                             LexicalEnvironment 
0\. [setTimeout, i]           [i=0] 
```

当`timer()`被调用时，将创建一个**ExecutionContext**，它将包含**变量**环境和与每次迭代对应的所有**词汇环境。**

还有一个更简单的例子

功能范围

```
function test() {
    for(var z = 0; z < 69; z++) {
        //todo
    }
    //z is visible outside the loop
} 
```

块范围

```
function test() {
    for(let z = 0; z < 69; z++) {
        //todo
    }
    //z is not defined :(
} 
```

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2016-12-27T09:44:55.907

这篇文章明确定义了var、let和const的区别

> `const`是标识符不会被重新分配的信号。
> 
> `let`, 是可以重新分配变量的信号，例如循环中的计数器或算法中的值交换。它还表明该变量将仅在定义它的块中使用，这并不总是整个包含函数。
> 
> `var`现在是在 JavaScript 中定义变量时可用的最弱信号。变量可能会或可能不会被重新分配，并且变量可能会或可能不会用于整个函数，或者仅用于块或循环的目的。

[https://medium.com/javascript-scene/javascript-es6-var-let-or-const-ba58b8dcde75#.esmkpbg9b](https://medium.com/javascript-scene/javascript-es6-var-let-or-const-ba58b8dcde75#.esmkpbg9b)

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2019-04-28T02:21:13.280

我认为这些术语和大多数示例有点压倒性，我个人遇到的主要问题是理解什么是“块”。`IF`在某些时候我意识到，一个块可以是除语句之外的任何大括号。函数或循环的左括号`{`将定义一个新块，其中定义的任何内容在同一事物（函数或循环）`let`的右括号之后将不可用；`}`考虑到这一点，更容易理解：

```
let msg = "Hello World";

function doWork() { // msg will be available since it was defined above this opening bracket!
  let friends = 0;
  console.log(msg);

  // with VAR though:
  for (var iCount2 = 0; iCount2 < 5; iCount2++) {} // iCount2 will be available after this closing bracket!
  console.log(iCount2);

    for (let iCount1 = 0; iCount1 < 5; iCount1++) {} // iCount1 will not be available behind this closing bracket, it will return undefined
  console.log(iCount1);

} // friends will no be available after this closing bracket!
doWork();
console.log(friends);
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2018-05-18T07:27:41.083

[在MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let)中查看此链接

```
let x = 1;

if (x === 1) {
let x = 2;

console.log(x);
// expected output: 2
}

console.log(x);
// expected output: 1 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2019-02-16T17:17:45.373

[![在此处输入图像描述](https://i.stack.imgur.com/sEh8Y.png)](https://i.stack.imgur.com/sEh8Y.png)

看看这张图片，我创建了一个非常简单的示例来演示`const`和`let`变量。如您所见，当您尝试更改`const`变量时，您会收到错误消息（**尝试覆盖 'name' which is constant'**），但请查看`let`变量...

首先我们声明`let age = 33`，然后分配一些其他值`age = 34;`，这没关系，我们尝试更改`let`变量时没有任何错误

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2016-05-19T11:41:10.847

[ECMAScript 6](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_-_ECMAScript_2015)添加了一个关键字来声明除“let”之外的“const”以外的变量。

在“var”之上引入“let”和“const”的主要目标是拥有块作用域而不是传统的词法作用域。 [本文非常简要地解释了 "var" 和 "let" 之间的区别，并且还涵盖了关于 "const" 的讨论](https://medium.com/@charan4u/ecmascript-6-beginner-guide-part-3-block-level-bindings-2b3cd5c5d408#.ev9gwp2jb)。

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2020-12-15T15:01:45.073

在 2015 年之前，使用`var`关键字是**声明**JavaScript**变量**的唯一方法。

在**ES6**（JavaScript 版本）之后，它允许 2 个新关键字**let** & **const**。

`let`= 可以重新分配
`const`= 不能重新分配（ const 来自常量，缩写形式 'const' ）

**例子：**

*   假设在这里声明一个国家/地区名称/您的母亲的名字`const`是最合适的。因为很快或以后更改国家名称或您母亲的名字的机会较小。

*   您的年龄、体重、薪水、自行车速度等这些类型的数据经常变化或需要重新分配。那些情况，`let`是用的。

* * *

## 回答 #38

> 赞同：-3
> 
> 时间：2021-05-04T17:48:25.053

**var**变量的作用域是函数和全局作用域，但**let**变量作用域是块作用域（大括号 {}）

```
const myFun=()=> {
      var str1 = "hello";
      let str2 = "program";

      console.log(str1, str2); // hello program

      {
        var myvar1 = "hiii"
        let myvar2 = "ooo";
        console.log(myvar1, myvar2); // hiii ooo
      }

      console.log(myvar1); // hiii
      console.log(myvar2); // ReferenceError
    }
    console.log(myvar1); // not defined
    myFun(); 
```

* * *

## 回答 #39

> 赞同：-3
> 
> 时间：2021-05-07T07:59:52.017

仅当您要在脚本中将变量设置为全局变量或要在同一范围内重新声明同一变量时，才使用 var 关键字。随着 ES2015 的到来，当你想将变量设置为函数作用域、块作用域、循环作用域或不想在同一作用域内重新声明变量时，使用 let 关键字。

# javascript - jQuery 中什么是好的图像选择器？

> ID：762024
> 
> 赞同：0
> 
> 时间：2009-04-17T20:13:55.987
> 
> 标签：javascript, jquery, extjs

我正在 jQuery 中寻找一个不错的图像选择器。[Ext在这里](http://extjs.com/deploy/ext/docs/index.html)有一个不错的（在示例和演示 -> 视图 -> 图像选择器下）。jQuery有类似的东西吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-07T17:49:43.653

Extjs 实际上有 jquery、prototype 和 yui 的适配器。这将有效地将 Ext 变成一个 jquery 附加组件。因此，考虑到这一点，您可以插入 jquery 适配器并使用 Ext 图像选择器代码。这是最近关于使用 Ext 和 jquery 的讨论：[http ://extjs.com/forum/showthread.php?t=69340](http://extjs.com/forum/showthread.php?t=69340)

# c# - 你在实例变量前面使用“this”吗？

> ID：762025
> 
> 赞同：10
> 
> 时间：2009-04-17T20:14:03.663
> 
> 标签：c#, coding-style

从类本身访问实例变量或类的属性时，是否在它们前面加上“ `this.`”？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-17T20:17:46.837

我只在构造函数或设置器中使用`this.`前缀，主要是在传递的参数与相关成员变量具有相同名称的情况下。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-17T20:18:41.467

在 C# 中，我绝对愿意。主要原因是：

1.  做与不做是文体问题。尽管发生了所有的战斗，但我不相信客观上有更好的方法。

2.  我的源分析工具 ( [StyleCop](http://code.msdn.microsoft.com/sourceanalysis) ) 默认要求`this.`在实例访问之前。我的第一点暗示我不应该太在意我是否总是这样做，并且因为默认的 StyleCop 设置是始终需要它，所以我选择阻力最小/一致性最高的路径，并遵循默认设置.

对于大多数风格问题，我都遵循这一理念。我非常喜欢*不*更改自动格式化 IDE 中的默认格式化选项。它只是让每个人的生活变得更加艰难，因为这实际上并不那么重要。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-17T20:40:32.927

不，我认为它是视觉噪音。我认为 this 变量是不良命名风格的拐杖。在我的类型中，我应该能够管理字段、属性和方法的命名。

绝对没有充分的理由将您的支持字段命名为“myfield”，将构造函数的参数命名为“myField”，将属性命名为“myField”。

```
 public class TestClass
 {
    private string myField;
    public TestClass(string myField)
    {
      this.myField = myField;
    }
    public string MyField {get { return myField;} set {myField = value}}
 } 
```

就个人而言，我总是在我所有的私有支持字段中添加一个前缀 _。

```
 public class TestClass
 {
    private string _myField;
    public TestClass(string myField)
    {
      _myField = myField;
    }
    public string MyField {get { return _myField;} set {_myField = value}}
 } 
```

现在在 C# 中具有自动属性

```
 public class TestClass
 {
    private string MyField {get; set;}
    public TestClass(string myField)
    {
      MyField = myField;
    }
 } 
```

除了上述内容之外，您可能是唯一一次键入此内容。是因为您想查看当前类型的智能感知。如果您需要这样做，那么我认为您的类型太大并且可能没有遵循[单一责任原则](http://en.wikipedia.org/wiki/Single_responsibility_principle)。假设你是。为什么要保留这个。在您实际拨打电话之后。重构它。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-17T20:20:54.333

它增加了混乱。所以不行。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-04-17T20:26:11.713

绝对地。'this' 避免了对任何前缀的需要，例如 m_。更重要的是，它快速提高了我的代码的性能，这就是为什么：

我真的很喜欢微软警察（FxCop、StyleCop）。他们真的帮助我抓住了通常我不会想到的东西。例如，如果方法不引用任何成员变量，FxCop 的一个建议是将方法标记为静态，这样就不必将方法分配给类的每个实例。来自[MSDN](http://msdn.microsoft.com/en-us/library/ms245046(VS.80).aspx)：

> 不访问实例数据或调用实例方法的方法可以标记为静态（在 Visual Basic 中为共享）。将方法标记为静态后，编译器将向这些成员发出非虚拟调用站点。发出非虚拟调用站点将阻止在运行时对每个调用进行检查，以确保当前对象指针不为空。这可以为性能敏感的代码带来可衡量的性能增益。在某些情况下，无法访问当前对象实例代表了正确性问题。

用'this'作为我的成员变量的前缀。为我做了两件事。首先，它满足 StyleCop。其次，更重要的是，它可以帮助我快速确定一个方法是否需要标记为静态。

当然，运行 FxCop 会告诉我是否需要将方法标记为静态。但是，使用“this”。帮助我花更多时间编写新代码，减少修复 FxCop 违规的时间。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-17T20:20:02.150

我认为这种做法在大多数情况下都能提高可读性，所以是的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-17T20:17:30.127

每当我有一个名称与实例变量相同的方法参数时（很少），我都会这样做，以避免混淆。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-17T20:17:44.090

不，但后来我写了很多 VB ;)

大约我会检查 this/Me 的唯一时间是当我不记得成员的确切名称时，或者当我需要用同名的函数参数来区分它时。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-17T20:17:44.730

没有！我当然可以看到它可能是有益的，但我所做的任何工作都不够复杂，需要另一个层次的澄清。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-17T20:19:28.533

我们正在使用 ReSharper，它可以很好地管理所有这些。大多数情况下，除非将其保留在构造函数中，否则我们会删除“this”，因为我们通常使用具有相同名称的构造函数参数。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-17T20:42:22.143

我愿意，对我来说它为代码增加了一点清晰度，它是在当前过程中还是在类中？

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-17T22:23:55.333

是的，如果我看到这个。我确定它是本地的，我不需要再看下去了。如果它没有以这个为前缀。（或者可能是'_'）我必须检查它是在本地还是在祖先中声明的，或者它是一个参数还是......

在调试过程中，所有这些检查都需要更多时间......

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-18T01:15:56.683

一般来说是的，我愿意。传达范围是可读性的一个重要方面。它将它与局部变量、静态方法等区分开来。它还传达定义是“附近”的。

哦，我只为公共方法/属性这样做。那些往往是大写的，所以 this.Thing 看起来不错。内部视图看起来像外部视图 (myInstance.Thing)。私有属性通常是小写的，因此对那些人来说这是一个不那么有吸引力的想法。

当然，这不是绝对必要的，有些人更喜欢它更简洁。但它为我和其他可能查看代码的开发人员提供了提示。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-17T20:24:00.050

我愿意。当 Visual Studio 中的 Intellisense 不像现在这样聪明时，我就养成了这个习惯。

我认为这不会让人分心，因为我写了很多 Python 并且习惯于到处看到 self。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-17T20:24:26.210

仅在需要与参数区分开来时，例如在 setter 或构造函数中。我认为它在不必要的情况下的使用是“codejunk”，类似于 Edward Tufte 的[chartjunk](http://en.wikipedia.org/wiki/Chartjunk)。噪音，而不是信号。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-17T20:25:40.763

如果您的实例变量名称与方法参数相同 - 它不再是“澄清的理由”。如果你不做 prepend- 它可能会导致缺陷。

我认为这就是 Ben S 的意思——但只是想强调一下——这不再是最佳实践的问题。

我经常这样做——增加清晰度。我不认为它会增加混乱——因为我们的大脑很快就会读过去，但会记录它是一个实例变量

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-04-17T22:35:19.970

我做了很多只是因为它使自动完成弹出。

# xml - 您可以接受这种验证许可证的方式吗？

> ID：762029
> 
> 赞同：4
> 
> 时间：2009-04-17T20:15:09.493
> 
> 标签：xml, licensing, cryptography

我有一个 XML 文件，其中描述了获得产品许可的公司名称、版本和一些额外信息。

看起来像这样

```
<Licence>
  <Name>sdfsdf</Name>
  <Version>1.2.1.1</Version>
  <NumberOfServer>4</NumberOfServer>
</Licence> 
```

然后我使用私钥签署这个字段并得到

```
<Licence>
  <Name>sdfsdf</Name>
  <Version>1.2.1.1</Version>
  <NumberOfServer>4</NumberOfServer>
  <Signature xmlns="http://www.w3.org/2000/09/xmldsig#">
    <SignedInfo>
      <CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315" />
      <SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" />
      <Reference URI="">
        <Transforms>
          <Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" />
        </Transforms>
        <DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1" />
        <DigestValue>M368eFB9ydifttSxX26sB6XiPV4=</DigestValue>
      </Reference>
    </SignedInfo>
    <SignatureValue>TTYP6d+zESn6/2PtL5ikN+7E9u8Njm32vYVyVANC5U0EGLBwS//3yPjUoBx3glJXHClzPQBQEUi0LJNauTFvo1IBYwLjAuaYGtleti4IXpjrQCVaIudETSv5Z7oB8+C/+nsqsC26fXf9vWxvaKXJJzcep88r0wIfVe31HSd18FU=</SignatureValue>
  </Signature>
</Licence> 
```

然后我在应用程序中发送公钥并阅读文件以确保它们具有正确的版本和“NumberOfServers”作为许可证密钥的用途。

***这种方法的缺点是什么？***

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-17T20:32:10.357

一个问题：攻击者可以生成一个密钥对，一个许可证，用该私钥签署许可证，然后用他们自己的替换应用程序中的公钥。这听起来可能有些牵强，但这是小偷所做的事情。

如果您试图保护向不诚实人群销售的产品（例如，尚未了解诚信价值的孩子），加密狗更强大。

如果您向关心他们声誉的个人或企业销售产品，这足以帮助他们保持诚实并跟踪他们的许可证。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T20:21:10.150

> 这种方法的缺点是什么？

这就是你自己滚动的问题。在现场尝试之前，你不会知道它的缺点。对于用户群较少的临时应用程序，这*可能会*很好，但如果有足够的动机（阅读 $$$$ ）来破坏它，那么它很可能并且将会被破坏。历史向我们证明了这一点。我个人会尝试一个真正的解决方案。我过去使用[过 X-Formation](http://www.x-formation.com/lm-x_license_manager/index.html)的 LM-X，它看起来很合理。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T20:36:42.890

你想保护什么？休闲复印机还是更巧妙的复印机？（你不能保护最好的，就像你不能阻止最熟练的窃贼一样。）如果人们非法使用你的软件会有多糟糕？谁是目标受众，初创公司或财富 500 强公司？您愿意在多大程度上惹恼您的合法用户？

副手，考虑打破这个方案，我会考虑找到公钥并使用十六进制编辑器替换另一个，然后修改 XML 并重新签名。或者，设置一个带有假公司名称的许可证服务器环境（但是你要检查它），或者可能不止一个以允许更多许可证。

这就是我立即想到的，我对颠覆许可证问题知之甚少。我不知道您是否涵盖了这些问题。

而且，正如 Shane C. Mason 指出的那样，除非你是一个有成就的黑帽，否则你不知道这些漏洞。我还建议将其视为加密货币，并强烈建议您使用普遍可用且广受信任的方案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T15:32:51.507

我建议的一件事是滚动您自己的 XML 文件签名方法。我最初使用 SignedXml 类进行许可，但后来意识到任何人都非常容易通过查看 XML 文件本身来推断我在做什么（因为指定了算法等）。

因此，相反，我组合了每条数据（在我的例子中是客户编号、许可证密钥和版本），对其进行哈希处理，并对结果进行签名，而不是整个 XML 文件。然后我对其进行了更多的混淆，并将数据添加为许可证中的单个“数据”元素。

仅仅通过查看它，就不可能看到任何关于我使用了哪些算法或流程的指标。当然，任何人都可以轻松地在 Reflector 中打开我的程序集并查看它是如何被验证的。但是，由于每个许可证的副本都保存在档案中，如果我怀疑客户更改了许可证以赋予他们更多功能，我可以用我的验证他们的副本并拒绝他们提供任何进一步的支持和/或采取法律行动。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T14:39:02.990

微软刚刚发布了一个虚拟实验室 - [MSDN Labcast On-Demand：通过数字签名 XML 文档为应用程序添加安全性](https://www.microsoft.com/resources/virtuallabs/step3-msdn.aspx?LabId=cbbfffeb-4619-498a-9adc-5fb648166a3d&BToken=reg)

# sql-server-2008 - 在 Report Builder 2.0 中使用 MDX 参数

> ID：762032
> 
> 赞同：0
> 
> 时间：2009-04-17T20:16:55.137
> 
> 标签：sql-server-2008, parameters, mdx, reportbuilder

我目前有一个如下所示的查询：

`SELECT`
`NON EMPTY ([Measures].[TOTAL]) ON 0,`
`NON EMPTY (([ENROLL DATE].[CALENDAR].[YEAR].["` **`+ Parameters!EnrollDate.Value +`** `"] * [DIM ENROLLMENT].[ENROLLMENT].[ENROLLMENT PROG].ALLMEMBERS)) ON 1`

`FROM (SELECT (([DIM ENROLLMENT].[ENROLLMENT].[TERMINATION REASON].[Still Enrolled])) ON 0 FROM [NapaCHI]);`

**粗体**部分来自我手动指定参数的参数部分`Label = 2006 and Value = 2006`。我已经尝试了几乎所有可接受的语法并阅读了有关此内容的每篇文章，无论我自己定义值还是使用单独的 MDX 语句选择不同的非空年份和 (NULL) 作为聚合，我似乎都无法让它工作。

请帮忙，这让我发疯了！谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-27T02:03:07.510

您的表达式看起来不完整，您需要以 and = 符号开头并正确引用它。类似于以下内容

```
="SELECT
NON EMPTY ([Measures].[TOTAL]) ON 0, 
NON EMPTY (([ENROLL DATE].[CALENDAR].[YEAR].[" + Parameters!EnrollDate.Value + "] * [DIM ENROLLMENT].[ENROLLMENT].[ENROLLMENT PROG].ALLMEMBERS)) ON 1 

FROM (SELECT (([DIM ENROLLMENT].[ENROLLMENT].[TERMINATION REASON].[Still Enrolled])) ON 0 FROM [NapaCHI]);" 
```

您可能还会遇到数据类型问题，您可能希望使用参数的 .Label 属性或将值显式转换为字符串。如果这些都不起作用，那么了解您遇到的错误将很有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-10T20:55:50.980

我认为这个 MDX 要求：

```
NON EMPTY (([ENROLL DATE].[CALENDAR].[YEAR].[Calendar " + Parameters!EnrollDate.Value + "] 
```

或者你可以像这样使用实际的 MDX 语言：

```
[ENROLL DATE].[CALENDAR].[YEAR].&[" + Parameters!EnrollDate.Value + "-01-01T00:00:00] 
```

其中任何一个都应该工作。

# asp-classic - 为什么我的 VBS 脚本文件在复制到我的 ASP 页面时不起作用？

> ID：762034
> 
> 赞同：0
> 
> 时间：2009-04-17T20:16:58.040
> 
> 标签：asp-classic, vbscript, active-directory

当从命令窗口调用时，我的脚本查询 Active Directory 可以工作，但它在我的 ASP 页面上不起作用。而不是`echo("message")`在 VBS 文件中，我 `Response.Redirect(message)`在我的 ASP 中使用。所以这里的代码在 CMD 窗口中运行良好，但在 IE 中却不行。无论如何，我希望有人可以提供帮助。

```
Option Explicit

Dim objRootDSE, strDNSDomain, objCommand, objConnection
Dim strQuery, strBase, strFilter, strAttributes
Dim objRecordSet, strAlias, strName, strSAM
Dim blnFlag

''// Use ADO to search Active Directory.
Set objCommand = CreateObject("ADODB.Command")
Set objConnection = CreateObject("ADODB.Connection")
objConnection.Provider = "ADsDSOObject"
objConnection.Open "Active Directory Provider"
objCommand.ActiveConnection = objConnection

''// Set AD query propeties
strBase = "<LDAP://10.10.10.10>"
strFilter = "(&(objectCategory=person)(objectClass=user)(cn="gossmari")"
strAttributes = "displayName,mailNickname,sAMAccountName"

''// AD query
strQuery = strBase & ";" & strFilter & ";" & strAttributes & ";subtree"
objCommand.CommandText = strQuery
objCommand.Properties("Page Size") = 100
objCommand.Properties("Cache Results") = False
Set objRecordSet = objCommand.Execute

    Do Until objRecordSet.EOF
       strName = objRecordSet.Fields("displayName")
       strAlias = objRecordSet.Fields("mailNickname")
       strSAM = objRecordSet.Fields("sAMAccountName")
       objRecordSet.MoveNext
    Loop

''// Echo the requested information 
''// replaced by Response.Redirect("http://www.google.com/" & strName)
Wscript.Echo strSAM & " ; " & strAlias & " ;   " & strName

objConnection.Close 
```

编辑：我不断收到的错误是：处理 URL 时服务器发生错误。请联系系统管理员。如果您是系统管理员，请单击此处了解有关此错误的更多信息。

我的电脑运行的是 windows vista，我真的开始讨厌它了

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T20:24:15.837

它返回什么错误？

一种可能的原因可能是 ASP 页面在其下执行的凭据没有查询 Active Directory 的权限。如果它是一个默认网页，它可能使用匿名身份验证运行，转换为 [LOCALMACHINE]\IUSR_[LOCALMACHINE]。

这可以解释为什么它在您的凭据下运行时运行，而不是在 IIS 的上下文中运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T20:23:08.307

实际上给我们错误消息会有所帮助。

如果您开箱即用地运行 IE，您将看不到它。转到工具、Internet 选项、高级选项卡并关闭“显示友好的 HTTP 错误消息”

由于默认匿名 IIS 用户在其中运行的安全上下文，通常访问活动目录等内容将无法正常工作，因此如果您切换到集成安全性，您可能会走得更远。

# linux - 如何在 Linux 中创建很多（我的意思是很多）套接字？

> ID：762051
> 
> 赞同：6
> 
> 时间：2009-04-17T20:20:25.830
> 
> 标签：linux, networking, sockets, tcp

我试图用不同的语言（C#、Java、C++、PHP）创建一个简单的程序来连接到服务器，并且都以相同的方式运行。所以我相信这个问题更多的是操作系统级别的事情。

基本上我希望程序使用 TCP 套接字连接到服务器并发送 1 个字节，然后关闭套接字。这需要每秒执行数千次并持续一段时间。这是为了对服务器进行基准测试。

到目前为止，在数千个客户端套接字之后，系统完全停止。它只能在冷却一分钟左右后开始创建插槽。我确保在传输后关闭了每个套接字。

现在，这类问题对于像 Apache 这样的服务器很熟悉，建议实用程序（如 ab/siege）使用 keep-alive 协议对 Apache 进行基准测试。即，创建少量 TCP 连接，但通过它们发出多个请求以进行基准测试。然而，这在我们的案例中是不可能的，因为我们的专有服务器不提供 HTTP 服务，也不支持 HTTP 1.1 keep-alive 模型。

那么如何实现呢？我检查了以下限制

1.  `ulimit`设置为一个非常高的数字
2.  `TCP TIME_WAIT`通过设置`/proc/sys/net/ipv4/tcp_rw_recycle`和`/proc/sys/net/ipv4/tcp_rw_reuse`1 消除。（我确实确认`netstat`没有`TIME_WAIT`套接字）
3.  这与线程/进程数量的限制无关。我试过重新启动我的客户端应用程序，它是一样的。一旦操作系统拒绝新的套接字，就没有任何帮助了。

PS。这**不是**服务器端限制。我们通过购买另一个盒子并在第一个客户端盒子拒绝创建新套接字时在其上运行相同的客户端代码来测试这一点。服务器处理得很好。我们不想购买 5-10 个盒子并在它们之间轮换来克服这个问题。

操作系统：Fedora 10 Linux 2.6.24-23-xen #1 SMP

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-17T20:53:51.977

老笑话：男人去看医生，说“医生，我这样做会很痛*”*，他的手臂扭到一个奇怪的位置。

医生回答：“好吧，不要那样*做*！”

看，你正在做的是一个*非常*不自然的过程。建立 TCP 连接需要握手，传输的字节数*远远*超过每条消息一个字节。设置和拆卸时间将很重要。您正在做的很可能是用完与该握手相关的内核资源；果然，如果你让它不管它，停止拍它，它最终会赶上来。

那么，您*真正*想要衡量的是什么？你真的*想做*什么？如果你真的想一次发送一个字节——上帝禁止——至少考虑使用 udp；没有糟糕的设置/拆卸。与开销相比，它仍然非常低效——即使是 UDP 数据包也需要大约 20 字节的帧——但它更好。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-18T03:10:20.150

查看 Richard Jones 的文章，[使用 Mochiweb 实现百万用户的 Comet 应用程序，第 3 部分](http://www.metabrew.com/article/a-million-user-comet-application-with-mochiweb-part-3/)。这是关于在 Erlang 中实现 Comet 应用程序，但“将其提高到 100 万”部分描述了他如何对他的服务器进行基准测试；它以“从一个主机创建一百万个 tcp 连接是非常重要的”语句打开。这应该让你对你的目的有所了解。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-18T02:30:09.810

您是否尝试在套接字上设置标志 SO_REUSEADDR ？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-17T21:00:26.687

有没有可能你的端口用完了？除非您愿意在循环中调用 bind() 以查找下一个空闲端口，否则您只会获得 5000 - 1024 个端口。

端口为 0 的 bind() 返回 1024-5000 范围内的空闲端口。具有指定端口的 bind() 获取该端口（如果可用）。

```
int bindnextport(int s, struct sockaddr sa)  
{  
   static int nextport = 1025;  
   int lastport;  
   lastport = nextport;  
   do {  
      sa.sa_data[0] = nextport >> 8;  
      sa.sa_data[1] = nextport & 255;  
      if (!bind(s, &sa, sizeof(sa))  
         return 0;  
      ++nextport;  
      if (nextport >= 65536) nextport = 1024;  
   } while (lastport != nextport);  
   return 1;  
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T21:00:19.887

连接然后发送 1 个字节不是任何东西的基准，除了 TCP 协议本身。正如查理马丁上面所说，大部分时间都浪费在连接然后断开套接字上。

我了解您想要进行基准测试，但这真的可以很好地代表您的应用程序的功能吗？你真的要建立一个连接只是为了发送 1 个字节吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-17T21:01:27.230

[nginx](http://nginx.net/) http 服务器声称能够保持 10,000 个不活动的 HTTP keep-alive 连接。你可以看看他们是[怎么做](http://sysoev.ru/nginx/nginx-0.6.36.tar.gz)的。

# .net - 如何使 WSDL.exe 不生成 XxxAsync 方法（我仍然想要 Begin/EndXxx）

> ID：762056
> 
> 赞同：5
> 
> 时间：2009-04-17T20:21:12.867
> 
> 标签：.net, asynchronous, wsdl

有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-26T15:13:34.493

请参阅：http: [//msdn.microsoft.com/en-us/library/7h3ystb6%28VS.80%29.aspx](http://msdn.microsoft.com/en-us/library/7h3ystb6%28VS.80%29.aspx)

使用参数：“newAsync”和“oldAsync”来关闭异步方法。

希望这可以帮助。

干杯!

# web-applications - 是什么在为 YouTube 提供动力？

> ID：762059
> 
> 赞同：6
> 
> 时间：2009-04-17T20:22:06.030
> 
> 标签：web-applications, youtube

我打算写一个内部的大型视频共享网站。

是否有资源或文章展示了如何规划如此大型的应用程序开发和部署？

是否有关于 YouTube 使用什么作为他们的编程语言、视频服务器等的详细大纲？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-17T20:24:12.360

[YouTube 架构](http://highscalability.com/youtube-architecture)：

> 1.  阿帕奇
> 2.  Python
> 3.  Linux (苏塞)
> 4.  MySQL
> 5.  psyco，一个动态的 python->C 编译器
> 6.  用于视频而不是 Apache 的 lighttpd

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-17T20:27:48.230

**YouTube 平台：**

> 阿帕奇
> 
> Python
> 
> Linux
> 
> mysql
> 
> psyco，一个动态的 python->C 编译器
> 
> 用于视频而不是 Apache 的 lighttpd

有关[YouTube 架构的更多信息](http://highscalability.com/youtube-architecture)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-17T20:45:50.870

如果我能给你一个建议：从小处着手！

大型项目往往需要很长时间才能完成。如果你从小处着手，你首先要有某种概念证明。所以你可以一块一块地扩展它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T20:28:09.010

有一次，他们使用 lighttpd 来提供 Flash 视频内容。他们的 HTTP 标头表明他们在很多页面上都使用 Apache。他们的帮助系统在 python 上运行，但我认为 Google 的所有帮助内容都在 python 上运行，所以这并不奇怪。除此之外，我认为可以肯定地说有很多内部技术，这无疑是由谷歌提供的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T20:24:14.310

YouTube 是用 Python 开发的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T20:45:19.017

它由 Python 提供支持：     

[![在此处输入图像描述](https://i.stack.imgur.com/kLDNu.png)](https://i.stack.imgur.com/kLDNu.png)

# iphone - 在 drawRect 中使用 Core Graphics 绘制图像网格：

> ID：762063
> 
> 赞同：5
> 
> 时间：2009-04-17T20:22:56.357
> 
> 标签：iphone, objective-c, core-animation, core-graphics

我的问题是：我有一个简单的块图像，我想用它制作一个网格。我在 UIView 中创建了一个 CGPoints 数组。然后我用

```
blackImage = [UIImage imageNamed:@"black.png"]; 
```

进而

```
- (void)drawRect:(CGRect)rect {
    for (int j = 0 ; j <= 11; j++)
    {
        for (int i = 0 ; i <= 7; i++) 
        {
            [blackImage drawAtPoint: (CGPointFromString([[self.points objectAtIndex:j] objectAtIndex:i]))];
        }
    }
    [whiteImage drawAtPoint:(CGPointMake((CGFloat)(floor((touchX+0.001)/40)*40), (CGFloat)(floor((touchY+0.001)/40))*40))];

    //  [whiteImage drawAtPoint:(CGPointMake(240.0, 320.0))];   
} 
```

其中 TouchX 和 TouchY 是用户触摸屏幕的 CGPoints。所以我基本上在用户触摸的网格上显示不同的图像。

首先，问题是每次调用DrawRect都会重绘整个屏幕。我希望能够保存状态（通过更改 BOOL 数组？）并让用户在屏幕上拖动并更改多个图像。但是，当我在 DrawRect 之外时，我无法在 UImage 上使用“drawAtPoint”方法。（引发错误）。

无论如何，我开始研究 CoreAnimation 和 Quartz 文档，并感到非常困惑。我不确定我是否应该为每块砖创建多个 UIView（似乎过多），或者 CALayers 或 CGLayers 的网格......我认为我想做的事情很简单......但我真的不明白图层，以及使用 CALayer 和 CGLayer 的区别。显然“所有 UIView 都支持图层”这是什么意思？

我对如何实现这一点有点迷茫。我基本上想在网格中交换图像，以便用户基本上可以在屏幕上“绘画”并切换图像。

* * *

## 编辑

我尝试使用 [self setNeedsDisplayinRect] 来实现它，并传入用户手指下的 CGRect。但是，这仍然在 TouchesMoved 中调用 DrawRect，这给了我想要的效果，但在 iPhone 上太慢了。有没有更有效的方法来使用 CALayers 来实现相同的效果？我是 Core Animation 的新手，并不真正了解如何使用图层来解决这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T05:53:02.600

我认为在你的情况下， UIImage 应该处理这个应用程序并提供良好的性能。问题似乎是您正在强制整个屏幕重绘以响应每条`drawRect:`消息。传入的矩形指定您需要重绘的“脏区”。任何其他绘图都只是在浪费时间。

同样，您传递给视图的`setNeedsDisplay:`rect 是您特别要使其无效的 rect。计算触摸周围的矩形并使其无效。UIKit 将（可能）联合多个脏矩形并发送单个`drawRect:`.

我建议您执行以下优化：

1.  检查传递给您`drawRect:`（在调试器中）的脏矩形，如果它小于全屏编写代码，以确保您只在脏矩形内重新绘制图像
2.  使用 touches 事件确保您只使需要重绘的区域无效，然后重新访问 1。
3.  如果这不能获得您需要的性能，请使用 Quartz 绘制黑白矩形而不是使用图像，以防它是一些 UIImage 怪异（但我怀疑是这种情况）

如果您需要显示位图而 1 和 2 无法获得所需的性能，您将不得不求助于较低级别的技术。有很多例子包括[这个](https://stackoverflow.com/questions/258292/how-do-i-use-calayer-with-the-iphone)关于 SO 的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T21:25:00.090

要仅使您的视图的一部分无效，请`setNeedsDisplayInRect:`仅使用已更改的区域进行调用。如果多个矩形发生了变化，你可以用不同的矩形调用它两次。

解决此问题的另一种方法是创建多个`CALayer`s 并移动/隐藏它们。

此外，您永远不应该`drawRect:`直接调用，`setNeedsDisplay`而是使用。`drawRect:`每当视图的某个区域无效并需要绘制时，都会被 UIKit 调用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T23:26:48.963

77 个离散图像作为 CALayers 或 UIViews 的网格并不太麻烦（假设你的图像只有几个像素宽），所以我推荐这种方法。UIViews 并不比 CALayers 重，所以我要做的是构建一个离散的 UIImageViews 网格（假设您的黑色图像不仅仅是黑色，如果不是，您可以将标准 UIView 的 backgroundColor 设置为黑色或白色）。如果您不需要在视图中移动时跟踪触摸，您甚至可以在 UIImageView 的自定义子类中或通过控制器中的委托方法进行触摸处理以切换视图图像。

这样，重新渲染的唯一显示部分将是正在更改的特定 UIView。我推荐 UIViews 而不是 CALayers 仅仅是因为 UIViews 更容易放置在视图层次结构中。

For a clear explanation of how CALayers, UIViews, and the like interact on the iPhone, I'd recommend reading the "The View Rendering Architecture" subsection within the "View Architecture and Geometry" section of the "iPhone Application Programming Guide".

# visual-studio-2008 - 新的 Windows 移动项目 - .NET CF 中的 LINQ 到数据？

> ID：762074
> 
> 赞同：1
> 
> 时间：2009-04-17T20:25:31.903
> 
> 标签：visual-studio-2008, windows-mobile, compact-framework, sql-server-ce

我必须使用 CF 3.5 将我在 MCL 中编写的项目转换为 windows mobile。我正在使用 Visual Basic 和 VS 2008。那里没有太多信息，而且大部分信息都在 C# 中。我现在正在努力解决这个问题。

访问数据的最佳方式是什么？我习惯于使用 LINQ to SQL，但这似乎不是一个选择。我需要能够搜索符合条件、正常 CRUD 操作等的数据。

我花了几天时间研究这个问题，发现了**很多**相互矛盾的数据！这个项目需要在接下来的 3 周左右完成。我现在压力很大。

衷心感谢您的所有想法！

——乔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T20:52:52.087

好吧，像“什么是数据访问的最佳方式”这样的问题相当模糊。您可能希望更具体地了解您的需求，尤其是您打算使用的数据库或 tat 是否仍处于打开状态。

话虽如此，具有类型化或非类型化数据集和/或直接命令的 SqlCE 得到了坚实的支持。还有一些选项可以将其连接到同步框架中。

* * *

要添加更多信息，有一个 SqlCeResultset 比常规数据集更有效（内存方面）。确保调查该选项。

简而言之：先创建一个普通的类型化数据集，然后找到XSD文件的属性，将Custom_Tool改为MSResultSetGenerator

关于上传，忘记 RDA。查看 Patterns&Practices Disconnected Service Agent 或[ADO.NET 的同步服务](http://msdn.microsoft.com/en-us/sync/default.aspx)

# c# - System.Data.OleDb.OleDbException：定义的字段太多

> ID：762076
> 
> 赞同：2
> 
> 时间：2009-04-17T20:25:45.163
> 
> 标签：c#, winforms, ms-access, .net-3.5, oledbexception

我正在构建一个 .NET WinForms 应用程序来替换 Microsoft Access（在此处插入集体呻吟）数据库中的一系列表单。为了完成初始版本，我尝试使用现有查询，而不是深入研究数据模型及其明显的设计问题。

我使用 OleDbCommand 对象调用查询并将它们视为存储过程。这在我们用来在办公室测试应用程序的工作站上运行良好，但在客户端计算机上运行时失败并出现“System.Data.OleDb.OleDbException：定义的字段太多”错误。两种环境都运行 MS Access 2003，因此客户端计算机上的错误原因并不明显。

我在[http://www.eggheadcafe.com/conversation.aspx?messageid=33475714&threadid=33453796](http://www.eggheadcafe.com/conversation.aspx?messageid=33475714&threadid=33453796)上发现了一篇文章说如果列数超过 127 就会发生这种情况。查询中使用的几个表超过这个数量的列（我知道几乎完全没有标准化）。我相信这是原因，但无法解释为什么我们办公室没有发生错误。有什么建议可以解决将数据访问拆分为多个查询的问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-19T06:50:36.043

我不明白为什么会发生这种情况。

但是，这可能与安装在您的办公室和客户端计算机中的 MDAC 组件有关（即 MDAC 组件包括 JET oledb 驱动程序）。

这可能会有所帮助。

# c# - 这个问题的最佳设计模式是什么？

> ID：762103
> 
> 赞同：2
> 
> 时间：2009-04-17T20:34:14.643
> 
> 标签：c#, .net, design-patterns

目前我正在尝试实现一个系统或一种创建类型的方法，但在创建时也获取类型名称。

所以说我有这样的动作，可以由应用程序的用户创建：

```
Blur
Contrast
Sharpen
Diffuse
Invert
... 
```

那么当他们通过 UI 创建时，我应该如何提取他们的名字。所以说你有每个单独的 UI 按钮。每次您创建其中一个时，都必须将它们命名为`Blur01`, `Blur02`, ... 这些对象将以数百万的数量创建。

所以目前他们有`.Name`必须在创建时设置的属性。但我也不想在每个类中复制代码来设置名称。

我应该为此使用什么设计模式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T20:58:30.497

如果您希望每种类型都有自己的、唯一的增量器，那么您将拥有重复的代码。您可以通过将静态字典保存在具有 Type 和 int 的基类中来避免这种情况，例如：

```
private static Dictionary<Type,int> nameSuffixCounters =
     new Dictionary<Type,int>();

public string CreateName()
{
    Type type = this.GetType();
    return string.Format("{0}{1}",type.Name, this.GetNextAndIncrement(type));
}

private int GetNextAndIncrement(Type type)
{
    int current;
    if (!this.nameSuffixCounters.TryGetValue(type, out current))
    {
        current = 0;
    }
    nameSuffixCounters[type] = ++current;
    return current;
} 
```

这样的事情会摆脱重复的代码，但它增加了在基类中使用反射的一些复杂性......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T21:06:02.743

[命令模式](http://en.wikipedia.org/wiki/Command_pattern)?

[使用这种模式将具有为撤销/重做功能](http://www.cs.mcgill.ca/~hv/classes/CS400/01.hchen/doc/command/command.html)奠定基础的优势，看起来您可能在某些时候需要它。

简而言之，您可以创建一个名为“Command”的接口，从中派生名为“Blur”、“Sharpen”等的子类。Command 将定义一个 execute() 方法，该方法将根据需要由您的子类实现：

```
public interface Command
{
  public void execute();

  public String getName();
}

public class Blur implements Command
{
  // ...

  public Blur(String name)
  {
    // ...
  }

  //...

  public void execute()
  {
    // execute the blur command
  }
} 
```

许多 UI 工具包都支持这种模式 - 例如 Swing。因此，您可能不需要做太多工作即可使其正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T20:28:41.433

我不确定为什么（大多数）答案都提到了反射——好的 ol' 多态性对此非常有效。获取运行时类型名称很容易——它只是`this.GetType().Name`.

唯一有点棘手的部分是维护每个类的唯一计数器。之前已经在 SO 上讨论过 - 但我找不到链接 ATM。但是，最重要的是，您可以（ab）使用泛型或维护 a`Dictionary<Type, int>`来跟踪。

泛型版本之所以有效，是因为每个不同的类型参数都会创建一个不同的泛型类 - 所以它们每个都有不同的静态计数器：

```
abstract class Command<T> where T : Command<T> {
   private static int counter = 1;
   private static object syncLock = new object();

   protected Command() {
      lock (syncLock) {
         _name = this.GetType().Name + counter++.ToString();
      }
   }

   public string Name { get { return _name; } }
   private string _name;
}

class Blur : Command<Blur> { }

class Sharpen : Command<Sharpen> { } 
```

无需覆盖派生类中的任何内容，但您必须确保您的继承`Command<T>`是正确的 - 否则您将共享计数器。我还使用了锁来同步对计数器的访问——假设您将从多个线程创建实例。

如果您不喜欢通用版本，那么 a`Dictionary<Type, int>`也可以。

```
abstract class Command {
   private static Dictionary<Type, int> counter = new Dictionary<Type, int>();
   private static object syncLock = new object();

   protected Command() {
      Type t = this.GetType();
      lock (syncLock) {
         if (!counter.ContainsKey(t)) {
            counter.Add(t, 0);
         }
         _name = t.Name + counter[t]++.ToString();
      }
   }

   public string Name { get { return _name; } }
   private string _name;
}

class Blur : Command { }
class Sharpen : Command { } 
```

由于您将创建“数百万”个，我可能会分析两者并检查内存使用情况。我并不特别关心通用方法——因为它很容易搞砸并传递错误的类型参数——但我怀疑它的内存使用情况要好一些。此外，如果您要创建 > `int.MaxValue`，您将不得不担心溢出。

说了这么多，我不确定你为什么不只维护一个索引可寻址集合并通过索引来引用它们 - 比如`Blur[0]`？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T21:33:45.170

恐怕没有办法在一个地方做到这一点。你必须在每个类定义中显式地“键入”类（类型）名称。原因是基类中的任何反射都将返回基类类型，而不是具体类型...除非您覆盖每个派生类中的方法，在这种情况下，您不妨将类型名称硬编码为字符串 const （避免反射命中）...

那么，怎么样

```
public const string TypeName = "MYTypeName"; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T12:35:15.550

如果它不必是人类可读的，我会使用 GUID 作为对象的名称，并有一个基本字段来指示创建它的基本操作。每个对象都可以被唯一地标识为（基本名称）-（ID）。您可以有一个人类可读的描述字段，但不用于查找。如果您确实需要显示 GUID，我使用的技巧是从 Base 16 转换为 Base 34。基本上从 0123456789ABCDEF 到 0123456789ABCDEFGHJKLMNPQRSTUVWXZY。这会产生一个更短的字符串，更容易显示和输入。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-17T20:46:59.747

您最好的选择是在基类中创建一个属性（或函数，如果您愿意），该属性`virtual`提供一种基名称。就像是..

```
public virtual string BaseName
{
    get { return GetType().Name; }
} 
```

您的`.Name`属性可以保持不变，也可以更改为`.NameSuffix`，您可以组合`BaseName`并`NameSuffix`形成一个完整的名称。

但最终，这可能不是解决此问题的最佳方式。命名这些对象/动作的目的是什么？在我看来，您在图像处理中使用了命令模式，并且您正在设置要执行的操作链，或者想要保留要撤消的操作链。这样的系统将更适合链表结构，您可以在某种图形中显示（如果需要），显示动作（可能是类的名称，或`BaseName`上面定义的）和它们所在的系列将被执行。

至于您需要使用名称来实例化对象，我不太清楚为什么。如果确实有必要，您唯一的两个选择是工厂模式或对类名称或自定义属性值使用反射（如果需要，也可用于提供名称）。但是，如果您要“以百万计”实例化它们，请**远离反射**。

我想这是一种迂回的说法，这完全取决于这需要如何工作。您必须提供更具体和全面的信息才能获得相应具体和全面的答案。

# java - Different views with Spring's SimpleFormController

> ID：762104
> 
> 赞同：1
> 
> 时间：2009-04-17T20:34:25.580
> 
> 标签：java, spring

I'm using Spring's `SimpleFormController` for form processing. In my case, the edit view (JSP) can vary depending on what's being edited. `SimpleFormController`'s `formView` is a field (class variable) which means that it's shared by all threads that use the instance of it. Thus it's not safe (nor appropriate) to set the formView (via `setFormView`) in `formBackingObject`. My question is, is it possible to use `SimpleFormController` with different edit views based on some context?

**Follow up**: After looking at the source it appears that I can override `showForm(HttpServletRequest req, HttpServletResponse resp, BindException errors)` and call `showForm(HttpServletRequest req, BindException errors, String viewName)` with whatever view I want.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T20:59:31.837

I believe SimpleFormController provides two "showForm" protected methods. These can be overridden and the BindException used to retrieve the "target" which is your form object, you can then return a ModelAndView based on any bound form object property. You should also take a look at processFormSubmission, it dictates which methods are called really. Another method is "isFormChangeRequest" which determines whether or not your form should change - you can use this to set this to true and it will then call showForm with the request, response, etc. and you can then re-examine the request.

The only way you'll learn how to use this hierarchy is by examining it. It is not very good - it provides many things, but not very well. Spring MVC typically has to be extended in order for it to be very useful.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T20:40:12.837

I don't think it's doable with SimpleFormController.

You could try to stop using the controller hierarchy classes which is about to be deprecated anyway and take a look at annotation based Controllers introduced with Spring 2.5\. They allow a much more flexible form handling. Don't be put off if you don't like Auto-injection. Although none of the examples really make it obvious, you can use annotation driven controllers and define all beans in an XML content.

# php - 我将如何修复此 php 代码导致的每月最后一天的错误？

> ID：762106
> 
> 赞同：3
> 
> 时间：2009-04-17T20:35:18.150
> 
> 标签：php, date, mktime

下面的代码是我用于网站菜单的代码，它将当月页面的链接移动到当月更改时的链接列表顶部。

但这在某些月份的 31 日失败，例如四月；对于大多数链接，我有两个指向同一个月的链接。我已经阅读了 php 生成日期方式的问题，但不知道如何更改此代码。

任何 php 博士都想尝试一下吗？谢谢

```
<?php $month1 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+1 , date('d'), date('Y'))));
$month2 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+2 , date('d'), date('Y'))));
$month3 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+3 , date('d'), date('Y'))));
$month4 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+4 , date('d'), date('Y'))));
$month5 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+5 , date('d'), date('Y'))));
$month6 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+6 , date('d'), date('Y'))));
$month7 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+7 , date('d'), date('Y'))));
$month8 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+8 , date('d'), date('Y'))));
$month9 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+9 , date('d'), date('Y'))));
$month10 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+10 , date('d'), date('Y'))));
$month11 = (date('F', mktime(date('H'), date('i'), date('s'), date('m')+11 , date('d'), date('Y')))); ?>

<a href="http://mydomain.com/<?php echo strtolower(date('F')); ?>/" title="<?php echo ucfirst(date('F')); ?>"><?php echo (date('F')); ?></a><br />

<a href="http://mydomain.com/<?php echo strtolower($month1); ?>/" title="<?php echo $month1; ?>"><?php echo $month1; ?></a><br />

...(2 through 10)...

<a href="http://mydomain.com/<?php echo strtolower($month11); ?>/" title="<?php echo $month11; ?>"><?php echo $month11; ?></a><br /> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T20:37:47.693

您可以考虑使用[strtotime()](http://is.php.net/manual/en/function.strtotime.php)而不是 mktime。由于在 strtotime() 中可以做到

```
strtotime("-1 day", time()); 
```

在某个月的第一天，它会准确地回到某一天。即使在闰年计算。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T20:54:53.503

在您的代码中使用 1 而不是 date('d') ；然而，任何时候你看到重复的代码，只有一个数字发生变化，你应该考虑循环：

```
<?php
for ($i = 0; $i < 12; $i++) {
    $month = date('F', mktime(0, 0, 0, date('m') + $i, 1, date('Y')));
?>

    <a href="http://mydomain.com/<?php echo strtolower($month); ?>" title="<?php echo $month; ?>"><?php echo $month; ?></a><br />

<?php
}
?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T20:56:54.417

``<?php``

 ````
$current_month = date('n');
$MONTHS = array();
for ($m=0; $m<12; $m++) {
  $display_month = $m + $current_month;
  $MONTHS[] = date('F',mktime(1,1,1,$display_month,1,date("Y")));
}
foreach ($MONTHS as $month) {
  echo "
    <a
      href=\"http://mydomain.com/".strtolower($month)."\"
      title=\"$month\">$month</a><br />";
}
?> 
````  `* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T20:47:04.800

哦，天哪，那是一些丑陋的代码。您应该真正研究[Loops](http://php.net/manual/en/language.control-structures.php) (for/while/etc) 和[Arrays](http://php.net/manual/en/language.types.array.php)。

您那里的代码可以简化为：

**已编辑**：*我的代码与原始代码有相同的问题，使用 scronide 的解决方案修复，感谢您指出。*

```
<?php
for ($i = 0; $i < 12; $i++)
{
    $months[$i] = date('F', mktime(0, 0, 0, date('m') + $i, 1, date('Y')));
}

for ($i = 0; $i < 12; $i++)
{
    print '<a href="http://mydomain.com/'.strtolower($months[$i]).'/" title="'.$months[$i].'">'.$months[$i]."</a><br />\n";
}
?> 
```

或者，如果您不介意将这两个函数（获取月份名称和打印链接）组合在一起，并且您不需要为其他任何内容存储月份名称：

```
<?php
for ($i = 0; $i < 12; $i++)
{
    $month = date('F', mktime(0, 0, 0, date('m') + $i, 1, date('Y')));
    print '<a href="http://mydomain.com/'.strtolower($month)."/\" title=\"$month\">$month</a><br />\n";
}
?> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T20:47:49.477

我不知道这是否能解决您的问题，因为我不确定我是否理解问题所在，但我知道如何使这段代码更具可读性：

```
<?php 
    $month1 = date('F', strtotime("+1 month"));
    $month2 = date('F', strtotime("+2 month"));
    $month3 = date('F', strtotime("+3 month"));
    $month4 = date('F', strtotime("+4 month"));
    $month5 = date('F', strtotime("+5 month"));
    $month6 = date('F', strtotime("+6 month"));
    $month7 = date('F', strtotime("+7 month"));
    $month8 = date('F', strtotime("+8 month"));
    $month9 = date('F', strtotime("+9 month"));
    $month10 = date('F', strtotime("+10 month"));
    $month11 = date('F', strtotime("+11 month"));
?> 
```

（但我也同意 Chad Birch 关于使用循环而不是重复代码的说明）

```
<?php
    foreach(range(0,11) as $key){
        $months[$key]=date('F', strtotime("+{$key} month"));
    }
/* ... */
    foreach($months as $month){
        print "<a href='http://mydomain.com/".strtolower($month).
            "' title='".$month."'>".$month."</a><br />";
    }
?> 
```

# python - 在 Python 中导入

> ID：762111
> 
> 赞同：3
> 
> 时间：2009-04-17T20:37:07.897
> 
> 标签：python, import

是否可以根据位置导入模块？

（例如，我导入的所有模块都必须在 /usr/lib64/python2.5/ 或类似的目录中吗？）

我想导入当前脚本本地的模块。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-17T20:41:04.160

您可以像这样在运行时扩展路径：

```
sys.path.extend(map(os.path.abspath, ['other1/', 'other2/', 'yourlib/'])) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T20:39:58.530

您可以编辑您的[PYTHONPATH](http://docs.python.org/tutorial/modules.html#the-module-search-path)以添加或删除每当您尝试导入时 python 将搜索的位置。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T20:40:13.333

*   默认情况下，python 将从当前目录导入。

*   **sys.path**是控制 python 在哪里搜索导入的变量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T20:43:14.543

您可以导入与您要导入的模块在同一路径中的模块。例如：

目录包含： `mod1.py, mod2.py`

```
mod2.py
--------
import mod1 
```

或者您可以将任何目录添加到您的 PYTHON_PATH 变量中：

```
import sys
sys.path.extend('/user/some/other/directory')
import mod1 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T20:46:45.410

它默认在 ./lib 中搜索。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-18T01:27:44.843

对于导入过程的低级控制，[imp](http://docs.python.org/library/imp.html)模块允许您从任意打开的文件中以任意名称导入模块。

例如，如果这是`foo.py`：

```
def x():
    print 'hello, world' 
```

然后这段代码：

```
import imp

with open('foo.py', 'r') as module_file:
    imp.load_module('module_name', module_file, '', ('', 'r', imp.PY_SOURCE))

import module_name

module_name.x() 
```

打印“你好，世界”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-18T17:34:48.000

## 使用**初始化**.py

对 sys.path 进行动态修改的唯一问题是您需要在每个脚本中重复它并对路径名进行硬编码。如果您甚至有两个或三个文件，那会变得混乱且不干燥。

相反，如果您的文件结构如下所示：

```
~/foo/__init__.py
~/foo/foo.py
~/foo/bar/__init__.py
~/foo/bar/baz.py 
```

这里的**init** .py 是使用 touch 创建的空白文件，而 foo.py 和 baz.py 是实际的 Python 脚本。然后你可以做这样的事情：

```
import sys
try:
    from foo import foo
    from foo.bar import baz
except ImportError:
    "%s is not in %s. Add to your PYTHONPATH in ~/.bashrc" % \
    (os.path.expanduser("~/foo"),sys.path) 
```

从一开始就将你的东西构建为一个包需要*更多*的工作，但可以更容易地在以后扩展项目并查看导入的来源。此外，如果您移动内容，您可以使用单个符号链接，而不是通过代码库进行查找/替换。例如，如果您将 '~/foo' 移动到 '~/downloads/foo'，只需执行以下操作：

```
cd ~
ln -s ~/downloads/foo foo 
```

你所有的进口仍然有效。

# iis - WebResource.axd 404 用于我的 SiteMapPath CSS 和其他

> ID：762117
> 
> 赞同：4
> 
> 时间：2009-04-17T20:37:59.377
> 
> 标签：iis, iis-6, http-status-code-404, webresource.axd

我的网站在我的服务器和 2003 处女服务器上运行良好。但是当我将站点移动到客户端的服务器时，某些站点功能不起作用。就像 SiteMapPath 的 CSS 和菜单的 javascript。

从客户端服务器记录：

`2009-04-03 17:22:20 W3SVC44836191 XXX.XXX.XXX.XXX GET /WebResource.axd d=nFPK0XLN-ynHK7RFK3-O_5JOGa3F6eDQZaw2fDS9H-hsMCDPLAS0vS6xsQkMZOo5bD2x9W3P9ULIjVogWhfPoA2&t=633626988000000000 8080 - XXX.XXX.XXX.XXX Mozilla/4.0+(compatible;+MSIE+6.0;+Windows+NT+5.1;+SV1;+InfoPath.1;+.NET+CLR+2.0.50727; +.NET+CLR+1.1.4322;+.NET+CLR+3.0.04506.30;+MS-RTC+LM+8) 404 0 2`

已经为 axd 扩展名尝试了取消选中“验证该文件存在”技巧，没有骰子。[http://allantech.blogspot.com/2008/01/webresourceaxd-gives-404.html](http://allantech.blogspot.com/2008/01/webresourceaxd-gives-404.html)

我正在使用文本菜单表单[http://www.obout.com](http://www.obout.com)。我在知识库中找到的唯一东西没有帮助。 [http://www.obout.com/inc/KnowLedgeBase.aspx?id=114](http://www.obout.com/inc/KnowLedgeBase.aspx?id=114)

我已经仔细检查了文件权限。

有任何想法吗？

眼镜：

```
OS: Windows 2003 Server
IIS: 6
.Net: 3.5 
```

**更新**我最终在客户端位置使用了不同的服务器，一切运行良好。我还没有在其他地方重复这个错误，也没有听说过任何人遇到过类似的问题。

* * *

我猜IIS的安装已经失败了。由于它是生产服务器，因此客户端不需要重新安装 IIS。如果有人碰巧解决了这个问题，请在此处发布。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T04:38:52.403

你检查服务器时间了吗？有时，如果设置不正确，它也会导致问题。

如果这不起作用，请尝试通过在 Visual Studio 命令提示符上运行此命令再次安装 aspnet_client 文件 -

```
aspnet_regiis -c 
```

然后这样做 -

```
aspnet_regiis -i //Will install ASP.NET version and update scriptmaps at the IIS metabase root and for all scriptmaps below the root. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T18:03:36.787

这可能看起来有点明显，但是您检查过为您的 Web 应用程序注册的 httpHandlers 了吗？

只需要一个 <clear /> 属性，所有这些都不起作用。因此，您可能需要检查 Microsoft.Net\Framework\Config 中客户端的 web.config 文件，看看是否所有内容都在那里。在我的机器上，我发现了以下行：

```
 <add path="WebResource.axd" verb="GET" type="System.Web.Handlers.AssemblyResourceLoader" validate="true"/> 
```

如果它不存在，则将该行添加到某些 <httpHandlers> 部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T06:26:03.253

事件日志是否可能包含信息更丰富的错误消息？404 返回码不一定意味着“未找到”——ASP.NET 处理程序可能仍会执行，但会导致错误。此错误消息可能会指示故障。

如果事件日志中没有错误，则：

1.  检查其他 WebResource.axd 调用是否成功。应用程序是否实际使用任何 WebResource 调用？
2.  您尝试加载的资源是否实际存在于应用程序中？您可以使用 Reflector 查看任何 3rd 方 DLL 并查看其资源。
3.  您的应用程序是否重新配置或以其他方式处理 HTTP 处理程序？如果是这样，也许某些东西可能正在取消注册或抢占 WebResource.axd 处理程序？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T08:23:45.347

该站点是 Asp.Net 2.0 还是 3.5？您在问题规范 .Net3.5 中提到，但在您的评论中，您似乎正在将该站点设置为 2.0 站点。您是否尝试过将 iis 下的应用程序更改为 3.5 应用程序？

如果您的站点是 3.5，您可能需要从 3.5 框架目录重做 aspnet_regiis。

# python - Django 模板：比较 IF 语句中的字典长度

> ID：762118
> 
> 赞同：3
> 
> 时间：2009-04-17T20:38:44.977
> 
> 标签：python, django

我正在尝试比较 django 模板中字典的长度

例如，我想知道执行以下操作的正确语法：

```
 {% if error_messages %}
        <div class="error">
            {% if length(error_messages) > 1 %}
                Please fix the following errors:
                <div class="erroritem">
                    {% for key, value in error_messages.items %}
                        <br>{{ value }}
                    {% endfor %}
                </div>

            {% else %}
                    {% for key, value in error_messages.items %}
                        {{ value }}
                    {% endfor %}
            {% endif %}
        </div>
    {% endif %} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-17T20:42:35.607

你可以这样做，使用[长度](http://docs.djangoproject.com/en/dev/ref/templates/builtins/#length)过滤器和[ifequal](https://docs.djangoproject.com/en/dev/ref/templates/builtins/#ifequal-and-ifnotequal)标签：

```
{% if error_messages %}
    <div class="error">
        {% ifequal error_messages|length 1 %}
            error_messages[0]
        {% else %}
            Please fix the following errors:
            <div class="erroritem">
            {% for key, value in error_messages.items %}
                <br>{{ value }}
            {% endfor %}
            </div>
        {% endifequal %}
    </div>
{% endif %} 
```

其他任何事情都必须遵循[自定义标签和过滤器](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#howto-custom-template-tags)的路径。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-05-01T12:44:52.100

您实际上可以同时使用`if`标签和 `length`过滤器

```
{% if page_detail.page_content|length > 2 %}
<strong><a class="see-more" href="#" data-prevent-default="">
Learn More</a></strong>{% endif %} 
```

**NB** Ensure no spaces between the dictionary/object and the `length` filter when used in the `if` tag so as not to throw an exception.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-03T19:06:38.100

使用 smart_if 模板标签：

[http://www.djangosnippets.org/snippets/1350/](http://www.djangosnippets.org/snippets/1350/)

它超级酷:)

可以做所有明显的事情，比如：

{% 如果文章|长度 >= 5 %}...{% endif %}

{% if "ifnotequal tag" != "beautiful" %}...{% endif %}

# c# - 共享主机环境中的服务器端批处理

> ID：762138
> 
> 赞同：0
> 
> 时间：2009-04-17T20:45:16.380
> 
> 标签：c#, asp.net, batch-processing

我正在编写一个将托管在共享托管环境中的网站。因此，我将无法访问诸如任务调度程序之类的东西。该网站需要每半天进行一次各种检查。在这种情况下触发这些任务的最佳方式是什么？

我能想到的最好的两件事在哪里：

*   每次用户访问我的网站时触发该进程 - 执行某种检查以查看该进程上次运行的时间，如果它大于 12 小时运行该进程。
*   有一些运行进程的隐藏页面，然后让一些外部实体每隔 12 小时 ping 这个页面。

这两种方法似乎有点笨拙？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T20:50:33.373

您可以使用一个使用[asp.net 缓存](https://blog.stackoverflow.com/2008/07/easy-background-tasks-in-aspnet/)的小技巧。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T20:56:30.033

绝对不要使用您的选项 #2，除非您有某种保护措施以防止意外运行它。

您也不希望您的处理依赖于用户请求。如果您有一个非常缓慢的一天（比如假期加上某处的大纤维切割）并且暂时没有人访问该站点，会发生什么？

# asp.net - 是否可以检测移动浏览器的 GPS 位置？

> ID：762141
> 
> 赞同：10
> 
> 时间：2009-04-17T20:45:58.610
> 
> 标签：asp.net, mobile, gps

我正在制作一个针对手机的网站，并希望在用户访问我的默认页面时获得当前的 GPS 纬度/经度，以便我可以向他们展示他们所在地区的结果。这可能使用 ASP.NET 吗？

> ### 也可以看看
> 
> [从移动浏览器获取位置数据](https://stackoverflow.com/questions/97865/get-position-data-from-mobile-browser)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-11-23T00:13:32.537

是的，您可以使用 JavaScript 执行此操作并将结果提交回服务器：

```
 function onPositionUpdate(position)
        {
            var lat = position.coords.latitude;
            var lng = position.coords.longitude;
            alert("Current position: " + lat + " " + lng);
        }

        if(navigator.geolocation)
            navigator.geolocation.getCurrentPosition(onPositionUpdate);
        else
            alert("navigator.geolocation is not available"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T21:03:01.517

有些服务会根据 IP 地址为您提供位置。它不会像 GPS 数据那样精确，但如果没有在手机上安装应用程序，它可能与您将获得的一样接近。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-16T10:49:06.580

目前，[GeoLocation API](http://dev.w3.org/geo/api/spec-source.html)在现代智能手机中高度可用。

请参阅我对相关问题的回答[How to Get GPS location from the web browser](https://stackoverflow.com/questions/2577305/how-to-get-gps-location-from-the-web-browser/8150325#8150325)。该解决方案是纯javascript，因此它与服务器技术无关。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T20:49:05.170

您必须获得安全许可才能访问相应的 GPS API。只要您知道 API，您就可以获取适当的数据，但这取决于操作系统。我知道它可以通过 Python 作为诺基亚手机的 PyS60 访问。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T13:24:16.110

目前你不会有太多的运气，但这在几年内应该是可能的。W3C 已经发布了[Geolocation API Draft](http://dev.w3.org/geo/api/spec-source.html)，并且这已经被实现到一个名为[Locatable](http://cydia.thebigboss.org/moreinfo/Locatable.php)的越狱 iPhone 应用程序中，但是支持将如此之少而且相距甚远，不值得花时间去实现！

# ms-access - 访问查询错误 - Null 和 Variant 数据类型 - 如何修复此错误？

> ID：762152
> 
> 赞同：5
> 
> 时间：2009-04-17T20:49:53.700
> 
> 标签：ms-access, null, types, variant

全部，

这个错误让我发疯。我花了 2 个小时试图弄清楚和/或解决它，但没有运气。这是错误：

“您试图将 NULL 值分配给不是 Variant 数据类型的变量。”

这是我的 SQL：

```
SELECT tbl_budir_002.Location_Index, tbl_parent_001.NEWPARENTID 
INTO tbl_budir_003
FROM (tbl_budir_002 
    LEFT JOIN qry_parent_003 
        ON tbl_budir_002.Location_Index = qry_parent_003.Location_Index) 
    LEFT JOIN tbl_parent_001 
        ON qry_parent_003.PARENTNAME = tbl_parent_001.PARENTNAME; 
```

我认为在这一点上出现了复杂情况—— tbl_parent_001 是通过 group by 从另一个更大的表创建的（以单个化 PARENTNAME 记录）。我必须手动进入表并将字段 NEWPARENTID 分配为类型自动编号，以便我可以为 PARENTNAME 记录提供主键。现在，当我运行查询时，出现上述错误。我怀疑这是导致我出现问题的自动编号，但我不知道通过使用查询创建主键的任何其他方法。

因此，我需要在两件事上提供帮助：(1) 在当前查询设置的情况下减轻错误；(2) 找出更好的方法来创建主键，而不是通过表的设计视图手动输入主键。

谢谢，诺亚

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-01-07T18:47:25.907

这是发生了什么：http: [//support.microsoft.com/kb/197587](http://support.microsoft.com/kb/197587)。除了 Access 2000，根据我的经验，知识库中的信息至少适用于 Access 2002。除了解决方法 1 和 2，如果您的解决方案可以忍受，我成功地将我的自动编号字段包装在 NZ() 中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-03-11T15:29:42.350

上周我收到了错误消息，并尝试了几件事来解决这个问题。就我而言，这与我试图将数据附加到表中但没有意识到我正在附加到主键（这是一个自动编号字段）有关（当然是偶然的）。

一旦我从附加查询中删除了这个字段，一切都会按预期工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T22:18:56.263

好的，您必须考虑数据库中的空值。这并不难，但有时会很烦人。您不能像数字一样将 null 隐式转换为文本。使用 nz - Null 到零。如果替换为文本，则使用“”，如果如下所示的数字，则使用 0。例如`nz(myText,"") or nz(myNumber,0)`

```
SELECT nz(tbl_budir_002.Location_Index,0), 
       nz(tbl_parent_001.NEWPARENTID ,0)... 
```

您也可以使用 IsNull() ，但它不像您必须使用条件语句将其设置为其他内容那样方便。我在标准上使用 isnull，在其他所有内容上使用 nz。

```
iif(isnull(tbl_budir_002.Location_Index),0,tbl_budir_002.Location_Index) 
```

玩得开心。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T21:51:07.860

看起来你的问题可能是`LEFT JOIN`. 由于您正在插入一个尚不存在的表，因此访问可能会尝试将 NEWPARENTID 列设置为主键。尝试运行查询`JOIN`以查看是否收到相同的错误。您可能还想尝试先手动创建表，然后再插入，这样 Access 就不必猜测您想要什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2022-02-01T18:15:59.407

我已将“0”而不是“Null”分配给存储主数据表主键的组合框。这解决了我的问题。

# .net - ADO.NET 实体框架和连接的子类

> ID：762158
> 
> 赞同：0
> 
> 时间：2009-04-17T20:52:13.383
> 
> 标签：.net, entity-framework, orm, joined-subclass

你能在 Entity Framework 版本 1 中做一个 Joined Subclass 吗？你如何处理这个问题？

加入子类：
[http ://www.xylax.net/hibernate/joinedsubclass.html](http://www.xylax.net/hibernate/joinedsubclass.html)
[http://www.redhat.com/docs/manuals/jboss/jboss-eap-4.2/doc/hibernate/Hibernate_Reference_Guide/Mapping_declaration-joined_subclass。 html](http://www.redhat.com/docs/manuals/jboss/jboss-eap-4.2/doc/hibernate/Hibernate_Reference_Guide/Mapping_declaration-joined_subclass.html)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T21:00:08.310

是的。实体框架称其为“[每种类型的表](http://msdn.microsoft.com/en-us/library/bb738685.aspx)”。

# screenshot - 如何以编程方式创建给定网站的屏幕截图？

> ID：762162
> 
> 赞同：11
> 
> 时间：2009-04-17T20:53:36.203
> 
> 标签：screenshot, image-capture

我希望能够创建给定网站的屏幕截图，但该网站可能比屏幕上显示的要大。有没有办法我可以做到这一点？

目标是在 WinForms 应用程序中使用 C# 中的 .NET 执行此操作。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-17T20:56:02.923

有几个工具。

问题是，你需要在某个给定的程序中渲染它，并拍摄它的快照。我不了解.NET，但这里有一些工具可供查看。

*   [KHTML2PNG](http://khtml2png.sourceforge.net/)
*   [imagegrabwindow()](http://is.php.net/manual/en/function.imagegrabwindow.php)（仅限 Windows PHP）
*   [使用 Python 和 QtWebKit 创建网页的屏幕截图](http://www.blogs.uni-osnabrueck.de/rotapken/2008/12/03/create-screenshots-of-a-web-page-using-python-and-qtwebkit/)
*   [网站缩略图服务](http://webshotspro.com/)
*   [使用嵌入式 Mozilla 自动截取网页截图](http://www.hackdiary.com/2004/06/13/taking-automated-webpage-screenshots-with-embedded-mozilla/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T21:03:22.810

我刚刚发现了 browsershots.org 网站**[，](http://www.browsershots.org)**它为一大堆不同的浏览器生成屏幕截图。在某种程度上，您甚至可以指定分辨率。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T21:03:40.143

**我在 VB.NET 中编写了一个程序，除了屏幕尺寸问题外，**它执行了您指定的操作。

 **我在表单中嵌入了一个 Web 控件（查看所有控件的最底部），并调整了它的设置（隐藏滚动）。我使用计时器等待动态内容，然后使用“copyFromScreen”获取图像。

我的程序具有动态尺寸（可通过命令行设置）。我发现如果我的程序比屏幕大，图像只会返回屏幕外区域的黑色像素。因为那时我的工作已经完成，所以我没有进一步研究。

希望能给你一个好的开始。对不起，任何错误的措辞。我每隔几个月登录一次 Windows 进行开发。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T20:57:35.290

将 at 作为屏幕截图可能会变得丑陋。使用 wget 捕获页面的全部内容很容易，但是图像意味着捕获渲染。

这里[有一些](http://www.sizlopedia.com/2007/07/17/5-easy-methods-to-capture-images-of-web-pages/)声称可以做到这一点的工具。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-15T22:06:29.500

如果页面尺寸大于屏幕尺寸，您可以在 WebBrowser 控件上呈现它，然后拍摄快照，您必须滚动控件拍摄一个或多个快照，然后合并所有图片:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T05:29:05.577

这是以编程方式创建屏幕截图的代码：

```
 using System.Drawing.Imaging;

int screenWidth = Screen.GetBounds(new Point(0, 0)).Width;
int screenHeight = Screen.GetBounds(new Point(0, 0)).Height;
Bitmap bmpScreenShot = new Bitmap(screenWidth, screenHeight);
Graphics gfx = Graphics.FromImage((Image)bmpScreenShot);
gfx.CopyFromScreen(0, 0, 0, 0, new Size(screenWidth, screenHeight));
bmpScreenShot.Save("test.jpg", ImageFormat.Jpeg); 

```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-07-06T05:59:46.377

**Java 网站截图**

*[将屏幕](https://stackoverflow.com/questions/3922276/how-to-combine-multiple-pngs-into-one-big-png-file/31239105#31239105)组合在一起以获得最终的整个网页屏幕截图。*

```
public static void main(String[] args) throws FileNotFoundException, IOException {
        System.setProperty("webdriver.chrome.driver", "D:\\chromedriver.exe");
        ChromeDriver browser = new ChromeDriver();  
        WebDriver driver = browser;
        driver.get("https://news.google.co.in/");
        driver.manage().timeouts().implicitlyWait(500, TimeUnit.SECONDS);

        JavascriptExecutor jse = (JavascriptExecutor) driver;
        Long clientHeight = (Long) jse.executeScript("return document.documentElement.clientHeight");
        Long scrollHeight = (Long) jse.executeScript("return document.documentElement.scrollHeight");
        int screens = 0, xAxis = 0, yAxis = clientHeight.intValue();
        String screenNames = "D:\\Screenshots\\Yash";
        for (screens = 0; ; screens++) {
            if (scrollHeight.intValue() - xAxis < clientHeight) {
                File crop = new File(screenNames + screens+".jpg");
                FileUtils.copyFile(browser.getScreenshotAs(OutputType.FILE), crop);                 

                BufferedImage image = ImageIO.read(new FileInputStream(crop));            
                int y_Axixs = scrollHeight.intValue() - xAxis;
                BufferedImage croppedImage = image.getSubimage(0, image.getHeight()-y_Axixs, image.getWidth(), y_Axixs);
                ImageIO.write(croppedImage, "jpg", crop);               
                break;
            }               

FileUtils.copyFile(browser.getScreenshotAs(OutputType.FILE), new File(screenNames + screens+".jpg")); 
 jse.executeScript("window.scrollBy("+ xAxis +", "+yAxis+")");

                jse.executeScript("var elems = window.document.getElementsByTagName('*');"                              
                        + "     for(i = 0; i < elems.length; i++) { "
                        + "         var elemStyle = window.getComputedStyle(elems[i], null);"
                        + "         if(elemStyle.getPropertyValue('position') == 'fixed' && elems[i].innerHTML.length != 0 ){"                                                                  
                        + "             elems[i].parentNode.removeChild(elems[i]); "                                
                        + "}}");    // Sticky Content Removes
                xAxis += yAxis;
        }
        driver.quit();
    } 
```

# python - 在 Python (Django/Satchmo) 中覆盖类成员变量

> ID：762165
> 
> 赞同：1
> 
> 时间：2009-04-17T20:54:10.087
> 
> 标签：python, django, satchmo

我正在使用 Satchmo 和 Django，并试图扩展 Satchmo 的产品模型。我想让 Satchmo 的 Product 模型中的字段之一在管理员中具有默认值，而无需更改 Satchmo 的源代码。这是 Satchmo 产品模型的缩写版本：

```
class Product(models.Model):
    site = models.ForeignKey(Site, verbose_name='Site') 
```

这就是我试图做的扩展它......

```
class MyProduct(Product):
    Product.site = models.ForeignKey(Site, verbose_name='Site', editable=False, default=1) 
```

这不起作用，关于为什么的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T21:55:30.830

有两个原因，首先，您尝试覆盖类变量的方式不是它在 Python 中的工作方式。您只需在类中正常定义它，与`def __init__(self):`覆盖超类初始值设定项的方式相同。但是，Django 模型继承根本不支持这一点。如果要添加约束，可以在 save() 方法中进行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T15:52:20.053

如果你真的想的话，你可能会对其进行猴子补丁：

```
site_field = Product._meta.get_field('site')
site_field.editable = False
site_field.default = 1 
```

但这是一个讨厌的习惯，可能会导致问题；可以说比直接修补 Satchmo 的源代码更难维护。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-17T23:43:16.780

您不能从子类更改超类。

你有来源。使用颠覆。做出改变。当 Satchmo 更新时，合并围绕您的更改的更新。

# unit-testing - Moq - 如何对方法中引用的更改进行单元测试

> ID：762167
> 
> 赞同：2
> 
> 时间：2009-04-17T20:54:23.923
> 
> 标签：unit-testing, mocking, moq

改天，另一个问题。我的服务层有以下方法

```
public MatchViewData CreateMatch(string user)
{
    var matchViewData = !HasReachedMaxNumberOfMatchesLimit(user) ?
        CreateMatchAndAddToRepository(user) : 
        MatchViewData.NewInstance(new Match(user));

    matchViewData.LimitReached = HasReachedMaxNumberOfMatchesLimit(user);
    return matchViewData;
} 
```

该方法调用 this 辅助方法来创建一个新的匹配对象：

```
private MatchViewData CreateMatchAndAddToRepository(string user)
{
    var match = new Match(user);
    MatchRepository.Add(match);
    return MatchViewData.NewInstance(match);
} 
```

存储库存储给定的匹配对象并将 id 设置为某个值 > 0。

```
public void Add(Match match)
{
    Check.Require(match != null);
    var numberOfMatchesBefore = Matches.Count;
    SetIdPerReflection(match, NextVal());
    Matches.Add(match);
    Check.Ensure(numberOfMatchesBefore == Matches.Count - 1);
} 
```

matchviewdata 对象复制了 match 对象的一些属性（包括 id）。

我的单元测试应该验证服务中生成的 viewdata 对象的 id > 0。要对此进行归档，我必须模拟存储库和 add 方法的行为。但是每次调用 service 方法时都会创建一个新的匹配对象，并且存储库上的 add 方法会更新引用的匹配对象（不需要返回值）。我不知道用最小起订量来解决这个问题。

到目前为止，这是我的单元测试：

```
[Test]
public void ServiceCreateMatchReturnedMatchViewDataHasNonZeroId()
{
    var match = TestUtils.FakePersistentMatch(User, 1);
    var repositoryMock = new Mock<IMatchRepository>();
    repositoryMock.Setup(
           r => r.Add(It.IsAny<Match>())).Callback(() => match.Id = 1);
    var serviceFacade = new DefaultServiceFacade(repositoryMock.Object);

    var returnedMatch = serviceFacade.CreateMatch(User);

    Assert.That(returnedMatch.Id, Is.GreaterThan(0));
} 
```

我尝试了其他一些变化 - 没有任何效果。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T17:13:29.827

在我看来，您的问题出在这一行；

```
repositoryMock.Setup(
       r => r.Add(It.IsAny<Match>())).Callback(() => match.Id = 1); 
```

您实际上在这里所做的是设置您在测试中声明的第一个匹配对象的 id，而不是在您的服务中创建的新匹配。

因为`Match`您将提供给存储库的对象是在内部创建的，所以我想不出一种简单的方法来在您的 Test 方法中引用它来为其设置回调。对我来说，这表明你可能试图在一个单元测试中测试太多。

我认为您应该简单地测试是否调用了 Add 方法并编写一个单独的测试以确保它按预期工作。

我提出这样的建议；

```
[Test]
public void ServiceAddsNewMatchToRepository()
{
   var repositoryMock = new Mock<IMatchRepository>();
   bool addCalled = false;
   repositoryMock
       .Expect(r => r.Add(It.Is<Match>(x => x.Id == 0))
       .Callback(() => addCalled = true);

   var serviceFacade = new DefaultServiceFacade(repositoryMock.Object);
   serviceFacade.CreateMatch(User);

   Assert.True(addCalled);
}

....

[Test]
public void AddingANewMatchGeneratesANewId()
{
  var match = new Match(user);
  var matchRepository = new MatchRepository();
  var returnedMatch = matchRepository.Add(match);

  Assert.That(returnedMatch.Id, Is.GreaterThan(0));      
} 
```

# dll - 变基 - 无法让 odbcint.dll 在其首选基址加载

> ID：762177
> 
> 赞同：1
> 
> 时间：2009-04-17T20:57:36.320
> 
> 标签：dll, odbc, rebase

`.exe`内置 Visual Studio的默认基地址是 0x00400000。

`d3dx9_30.dll`和`odbcint.dll`（都存在于 中）的默认基地址`%windir%\system32`也是 0x00400000。因此，默认情况下，`exe`链接到这些 dll 中的任何一个的 s 都会发生运行时地址冲突。操作系统会自动将 重新定位`dll`到不同的基地址并根据需要修复指针，当我附加 VS 调试器时，我可以看到这种情况：重新定位的模块得到一个感叹号图标覆盖。

重新定位系统 DLL 是一个非常糟糕的主意，更不用说在用户系统上几乎不可能做到。所以我决定重新设置我`exe`的 s 以防止这种地址冲突，从而防止运行时重新设置基础。

如果我将客户端 EXE 更改为不同的基地址以将其移开`d3dx9_30.dll`，它可以正常工作：没有地址冲突、没有重定位、没有修复。

但是，如果我将我的服务器 EXE 更改为不同的基地址以将它们移开`odbcint.dll`，它就不起作用。

`odbcint.dll`在内存中是 0x17000 字节，并且首选基地址 0x00400000。我尝试将我的 EXE 设置为 0x00420000，然后设置为 0x00660000。仍然`odbcint.dll`在运行时重新定位。我使用 进行了分析`depends.exe`，这表明在`odbcint.dll`加载之前没有其他模块试图声明此地址。

有没有人有理论解释为什么我无法`odbcint.dll`在其首选地址加载？

`Update`: vadump 显示，当我进入 main() 时，位于 0x00400000-0x00470000 的内存被声明为“UNKNOWN_MAPPED”。我一直无法找到有关这到底意味着什么的更多信息。我假设某些系统 dll 在加载时保留了此内存；我的调试功能不够强大，无法发现是哪个、为什么或确切的时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-19T18:29:52.180

如果您下载 VADump（可在[Windows 资源工具包](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd&displaylang=en)中获得：） ，您可以准确地看到哪些模块正在访问这些页面并导致它丢失其地址。（运行 vadump -op pid。）

你没有说你正在使用什么操作系统，但是在 Vista/2K8+ 上你应该也知道[ASLR](http://technet.microsoft.com/en-us/magazine/2007.04.vistakernel.aspx)。

# mysql - MySql查询，合并表

> ID：762184
> 
> 赞同：4
> 
> 时间：2009-04-17T21:00:15.610
> 
> 标签：mysql

我有两个 MySql 表，一个包含食物，一个包含食谱（食物组）。食谱表有一个标题，然后有一个项目表，其中包含该食谱中的所有食物。该表与食物表相连。现在我需要组合这些表并将它们一起列出。

食物表：

```
食品ID | 标题 | 卡路里
   1 根香蕉 100
   2 苹果 50

```

配方表：

```
食谱ID | 标题
   1个水果混合
```

收据项目表：

```
收据 | 食谱ID | 美食家
   1 1 1
   2 1 2

```

我需要将它们组合到一个列表中，其中包含同一列表中的食物和食谱。所以在上面的例子中，我需要一个这样的列表：

```
标题 | 食品ID | 食谱ID | 卡路里
香蕉 1 空 100
苹果 2 空 50
水果混合 空 1 150
```

这有可能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-17T21:02:08.697

你使用一个叫做[UNION的东西](http://dev.mysql.com/doc/refman/5.0/en/union.html)

union 的问题是所有表都必须具有相同的字段。但是您可以在 SELECT 查询中添加假字段以获得您需要的结果。大桌子可能会很慢。

```
SELECT title, foodid, NULL as recipeid, calories FROM Food-table
UNION
SELECT title, NULL as foodid, recipeid, calories FROM Recipe-table 
```

但是您应该真正研究[JOINS](http://dev.mysql.com/doc/refman/5.0/en/join.html)，因为那里有一个链接表。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T21:04:27.067

```
SELECT title, foodid, null, calories
FROM Food

UNION

SELECT r.title, null, r.recipeid, sum(calories)
FROM recipe r
INNER JOIN RecipeItem ri ON ri.recipeid=r.recipeid
INNER JOIN Food f ON f.foodid=ri.foodid
GROUP BY r.title, r.recipeid 
```

# atl - 我在哪里可以获得活动模板库？

> ID：762188
> 
> 赞同：8
> 
> 时间：2009-04-17T21:00:45.517
> 
> 标签：atl

我以前从未使用过 COM，我的任务是编写一个使用一些第三方 COM 对象的应用程序。如果有人能指出一些关于如何使用它们的好教程，将不胜感激。更直接的是，我似乎没有安装活动模板库。我在网上搜索过，但不知道如何获得它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T21:05:05.303

它是 Microsoft Visual Studio 的一部分（但不是[Express Edition](http://msdn.microsoft.com/en-us/library/hs24szh9.aspx)的一部分。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T21:09:18.163

正如 Dan 指出的那样，这些是随 Visual Studio 分发的。

如果您没有 Visual Studio，则可以从 Microsoft Visual C++ Redistributable 包之一获取 ATL 库：

*   [2005 SP1（32 位）](http://www.microsoft.com/downloads/details.aspx?familyid=200B2FD9-AE1A-4A14-984D-389C36F85647)
*   [2005 SP1（64 位）](http://www.microsoft.com/downloads/details.aspx?familyid=EB4EBE2D-33C0-4A47-9DD4-B9A6D7BD44DA)
*   [2005（安腾）](http://www.microsoft.com/downloads/details.aspx?familyid=526BF4A7-44E6-4A91-B328-A4594ADB70E5)
*   [2008 SP1（32 位）](http://www.microsoft.com/downloads/details.aspx?familyid=A5C84275-3B97-4AB7-A40D-3802B2AF5FC2)
*   [2008 SP1（64 位）](http://www.microsoft.com/downloads/details.aspx?familyid=BA9257CA-337F-4B40-8C14-157CFDFFEE4E)
*   [2008 SP1（安腾）](http://www.microsoft.com/downloads/details.aspx?FamilyID=dcc211e6-ab82-41d6-8dec-c79937393fe8)

注意：标有 2005 的是版本 8（atl80.dll），标有 2008 的是版本 9（atl90.dll）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T21:07:52.393

我认为您必须拥有 Visual Studio 2005 或 2008（不是 Express）的副本才能获得 ATL。如果您安装了其中一个，但没有 ATL，请转到“控制面板：添加/删除程序”并执行“修改”安装（在驱动器中使用程序 CD 或 DVD）并确保该框为 ATL 检查。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-17T22:13:07.887

至于**教程**：

我还没有在网上找到一个很好的。有几个关于使用 ATL/COM 的 OK 页面：

*   [活动模板库使构建紧凑的 COM 对象成为一种乐趣](http://www.microsoft.com/msj/0697/atl.aspx)，作者 Don Box（COM 的资深专家）。本文开头：“我爱 COM。COM 很好。COM 就像一杯上好的比尔森啤酒或啤酒，从不让人失望。事实上，我越看 COM 越喜欢它。不幸的是，我使用 C++ 工作，而 C++ 确实如此。不分享我对生活中美好事物的欣赏。” 虽说宗师传教，现在12岁了，还是一篇不错的文章……
*   Mike Dunn在 CodeProject上关于 COM的优秀[教程。](http://www.codeproject.com/KB/COM/comintro.aspx)
*   [DevGuy 的 C++ COM 技巧](http://www.devguy.com/fp/Tips/COM/)——链接和建议的大杂烩。
*   [COM Programmer's Cookbook——](http://msdn.microsoft.com/en-us/library/ms809982.aspx)这篇古老的（1995 年）文章还不错，尽管它的年代久远，而且它描述了用 C 而不是 C++ 实现 COM 对象（显式 vtables！）

* * *

我自己对 COM 和 ATL 有点生疏，但如果我没记错的话，你会想学习的类你会使用得最多（特别是如果你使用别人的 COM 对象而不是实现你的own) 是 CComBSTR、CComPtr 和 CComVariant。此外，Visual C++ 中的#import 语句使使用外部 COM 对象变得更加容易，它从外部 DLL 或 EXE 为您生成智能指针类。

如果您要实现 COM 对象，我强烈建议您获取[ATL Internals](https://rads.stackoverflow.com/amzn/click/com/0201695898)的副本（现在有一个更新的版本涵盖 ATL v8）。是的，它确实在各个部分中详细介绍了一些血腥细节，但即使作为一本入门书，它也写得相当好。

如果您以前从未使用过 COM，那么“经典”书籍[Essential COM](https://rads.stackoverflow.com/amzn/click/com/0201379686)和[Effective COM](https://rads.stackoverflow.com/amzn/click/com/0201695898)非常好，您可能可以从您最喜欢的旧书来源以低廉的价格获得它们。[如果您还没有熟悉RAII](http://www.hackcraft.net/raii/)习语，您还需要非常熟悉。

新闻组[microsoft.public.vc.atl](http://groups.google.com/group/microsoft.public.vc.atl/topics)非常适合提出特定问题。（不过，他们在那里往往比在 StackOverflow 上更粗暴）

当心：COM 有很多小问题，尽管 ATL 确实帮助它变得更容易并且没有太多臃肿。“模拟动态绑定”技术又名[CRTP](http://en.wikipedia.org/wiki/Curiously_Recurring_Template_Pattern)在 C++ 世界中很有用，不仅在 ATL/COM 的上下文中，而且特别是如果您正在开发一个可重用类库，您希望在只有一个实例的情况下子类化或混合一次出现（例如，一个类 CSpiffyFramework 提供了您想要大量重用的 mixin 功能，并且您有一个想要包含该功能的派生类，它不是虚拟对象模型的一部分，所以您真的不需要需要一个vtable）。

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-11-12T12:39:35.800

我安装了这个：[http](http://www.microsoft.com/en-us/download/details.aspx?id=3138) ://www.microsoft.com/en-us/download/details.aspx?id= 3138 并在我的构建服务器上获得了 C++ 编译器和所有东西，但没有 ATLMFC 库。上面链接的redist包就是这样，可再发行的，而不是需要的头文件和包含文件。经过大量搜索，我最终在服务器上安装了vs2008，废话。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2017-12-14T08:12:49.803

这是如何将 atl 与 vs express 一起使用：

你需要 WDK 7.1.0：

[https://www.microsoft.com/en-us/download/details.aspx?id=11800](https://www.microsoft.com/en-us/download/details.aspx?id=11800)

1.  下载 Visual Studio 速成版

    从 Microsoft 免费获取 VS Express C++

2.  从 Microsoft 下载免费提供的 Windows Driver Kit（7.1 或更高版本）

    从 Microsoft 免费获取 WDK 7.1.0

    您可以使用虚拟克隆驱动器挂载 ISO 文件或使用 7-zip 解压缩它。

3.  安装 WDK 并选择“构建环境”选项

    这将安装 ATL 和 MFC 头文件和库文件。ATL 是 Windows 上 FireBreath 的要求。确保将其安装在默认位置，以便 FireBreath 可以找到它

4.  对于 VS 快递 2010

    如果您使用的是旧版本的 FireBreath，scjohn 的这篇文章可能对您有用。请注意，FireBreath 1.4 beta 1 和更高版本不再需要这些步骤！

[http://www.firebreath.org/display/documentation/Building+with+Visual+Studio+Express](http://www.firebreath.org/display/documentation/Building+with+Visual+Studio+Express)

【vs2010 express包含路径】

C:\WinDDK\7600.16385.1\inc\atl71

【vs2010 express lib路径】

C:\WinDDK\7600.16385.1\lib\ATL\i386

# php - 在单个测试中断言多个条件，还是拆分为多个测试？

> ID：762192
> 
> 赞同：5
> 
> 时间：2009-04-17T21:02:13.423
> 
> 标签：php, unit-testing, testing, correctness

如果您正在测试如下所示的计数函数，那么在一个函数中为函数测试多个事物与为每个测试都有一个测试函数是“正确的”还是“错误的”？

```
function testGetKeywordCount() {
    $tester = $this -> getDatabaseTester($this -> CompleteDataFile);
    $tester -> onSetUp();

    $KeywordID = 0;
    $this -> setExpectedException('InvalidArgumentException');
    $this -> keyword -> getKeywordCount($KeywordID,'Active');

    $KeywordID = 1;
    $this -> setExpectedException('InvalidArgumentException');
    $this -> keyword -> getKeywordCount($KeywordID,'InvalidStatus');

    $this -> assertEquals(1, $this -> keyword -> getKeywordCount($KeywordID,'Active'));

    $tester -> onTearDown();
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T21:03:45.617

您应该有多个测试功能，每个测试自己的条件。这样，无需调试就更容易发现故障。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T21:08:25.450

每个场景都有一个测试用例是理想的。但是，在某些情况下，在一个测试用例中测试多个场景会更方便（从实现工作的角度来看是有效的）。如果您使用的框架不会在第一次失败时停止，而是尝试在测试用例中尽可能多地执行，那么该框架适用于每个测试用例的多个场景。

我更喜欢在单元测试上花费尽可能少的时间，并且在那段时间内仍然获得尽可能多的覆盖率。

最后，如何实现单元测试并不重要，重要的是这些测试的正确性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T22:28:06.757

测试框架并不总是值得您努力遵循每个测试规则的一个断言。

其中之一是[RSpec](http://rspec.info/) for Ruby，它允许您设置[嵌套示例组](http://blog.codefront.net/2007/12/30/why-i-love-rspec-nested-example-groups/)。例如：

*   用户
    *   没有密码
        *   是无效的
        *   抛出异常
    *   有密码
        *   以前用过的
            *   是无效的
            *   抛出异常
            *   出行安全警告
        *   以前没用过的
            *   已验证
            *   重定向到帐户页面

通过逐步构建场景并测试每个步骤，更容易坚持每个测试方法一个断言。它还可以更轻松地发现未经测试的场景。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-22T18:23:01.613

将断言分成两个单独的测试的一个论点是，如果其中一个断言失败，您将得到一个失败；如果两个断言都失败，你会得到两个失败。

此外，通过使每个测试的名称尽可能具有暗示性，当出现问题时，您将获得额外的线索。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-20T13:19:55.820

我不会在上面的示例代码中谈论单元测试。
您的示例更像是一个自动化功能测试，它测试功能流。

但是在这种情况下，可以有多个断言。

**只需确保 2 个断言不是一个接一个。**

不好的例子

```
public void ValidateRulesEntry_Valid_ValidConditionsFromFile()
{
    string condition = "Target.HasValue";
    string returnMessage;

    bool successFul = CodeParserTryParseCondition(condition, out returnMessage);

    Assert.IsTrue(successFul);
    Assert.IsFalse(string.IsNullOrEmpty(returnMessage));
    Assert.IsTrue(returnMessage == "OK");

} 
```

最后的 2 个断言依赖于第一个断言 IsTrue(successFul)。

想一想：如果测试失败 --> 告诉我为什么（不查看调试输出）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-08T10:09:24.130

这是一个有不同答案的问题，具体取决于您问的人，主要取决于他/她的个人意见或专业经验。一些极端理论的人会告诉你，在测试中拥有多个断言是一种至高无上的罪过，你将永远注定要失败。但是其他有更多实际经验的人可能会告诉你，在某些情况下，每次测试有 10 甚至 50 个断言是非常好的。

那么，谁是对的？

面对这种困境时，我总是尽量保持客观，为了做出选择，我决定对一些目前由经过认证和经验丰富的专业人士开发的最受欢迎的 github 存储库进行一项小型研究。

那么，大玩家如何测试自己的项目呢？更重要的是，单元测试框架是如何自己进行单元测试的？

让我们看几个例子：

休眠

[https://github.com/hibernate/hibernate-orm/blob/master/hibernate-core/src/test/java/org/hibernate/engine/spi/EntityEntryTest.java](https://github.com/hibernate/hibernate-orm/blob/master/hibernate-core/src/test/java/org/hibernate/engine/spi/EntityEntryTest.java) [https://github.com/hibernate/hibernate -orm/blob/master/hibernate-core/src/test/java/org/hibernate/engine/spi/NonSortedExecutableListTest.java](https://github.com/hibernate/hibernate-orm/blob/master/hibernate-core/src/test/java/org/hibernate/engine/spi/NonSortedExecutableListTest.java) [https://github.com/hibernate/hibernate-orm/blob/master/hibernate-core/ src/test/java/org/hibernate/engine/spi/SortedExecutableListTest.java](https://github.com/hibernate/hibernate-orm/blob/master/hibernate-core/src/test/java/org/hibernate/engine/spi/SortedExecutableListTest.java) [https://github.com/hibernate/hibernate-orm/blob/master/hibernate-envers/src/test/java/org/hibernate/envers /test/JpaStaticMetamodelTest.java](https://github.com/hibernate/hibernate-orm/blob/master/hibernate-envers/src/test/java/org/hibernate/envers/test/JpaStaticMetamodelTest.java) [https://github.com/hibernate/hibernate-orm/blob/master/hibernate-hikaricp/src/test/java/org/hibernate/test/hikaricp/HikariCPConnectionProviderTest.java](https://github.com/hibernate/hibernate-orm/blob/master/hibernate-hikaricp/src/test/java/org/hibernate/test/hikaricp/HikariCPConnectionProviderTest.java) [https://github.com/hibernate/hibernate-orm/blob/master/hibernate-proxool/src/test/java/org/hibernate/test/proxool/ProxoolConnectionProviderTest.java](https://github.com/hibernate/hibernate-orm/blob/master/hibernate-proxool/src/test/java/org/hibernate/test/proxool/ProxoolConnectionProviderTest.java)

春天

[https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/test/java/org/springframework/util/AntPathMatcherTests.java](https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/test/java/org/springframework/util/AntPathMatcherTests.java) [https://github.com/spring-projects /spring-framework/blob/master/spring-core/src/test/java/org/springframework/util/ClassUtilsTests.java](https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/test/java/org/springframework/util/ClassUtilsTests.java) [https://github.com/spring-projects/spring-framework/blob/master/spring-核心/src/test/java/org/springframework/util/ObjectUtilsTests.java](https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/test/java/org/springframework/util/ObjectUtilsTests.java) [https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/test/java/org/springframework /util/AutoPopulatingListTests.java](https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/test/java/org/springframework/util/AutoPopulatingListTests.java)

六月 4

[https://github.com/junit-team/junit4/blob/master/src/test/java/junit/tests/extensions/ActiveTestTest.java](https://github.com/junit-team/junit4/blob/master/src/test/java/junit/tests/extensions/ActiveTestTest.java) [https://github.com/junit-team/junit4/blob/master /src/test/java/junit/tests/extensions/RepeatedTestTest.java](https://github.com/junit-team/junit4/blob/master/src/test/java/junit/tests/extensions/RepeatedTestTest.java) [https://github.com/junit-team/junit4/blob/master/src/test/java/junit/tests/runner/ResultTest.java](https://github.com/junit-team/junit4/blob/master/src/test/java/junit/tests/runner/ResultTest.java) [https ://github.com/junit-team/junit4/blob/master/src/test/java/org/junit/rules/TimeoutRuleTest.java](https://github.com/junit-team/junit4/blob/master/src/test/java/org/junit/rules/TimeoutRuleTest.java)

六月 5

[https://github.com/junit-team/junit5/blob/master/platform-tests/src/test/java/org/junit/platform/launcher/core/DefaultLauncherTests.java](https://github.com/junit-team/junit5/blob/master/platform-tests/src/test/java/org/junit/platform/launcher/core/DefaultLauncherTests.java) [https://github.com/junit -team/junit5/blob/master/platform-tests/src/test/java/org/junit/platform/launcher/core/LauncherDiscoveryRequestBuilderTests.java](https://github.com/junit-team/junit5/blob/master/platform-tests/src/test/java/org/junit/platform/launcher/core/LauncherDiscoveryRequestBuilderTests.java) [https://github.com/junit-team/junit5/blob/master/平台测试/src/test/java/org/junit/platform/launcher/listener/SummaryGenerationTests.java](https://github.com/junit-team/junit5/blob/master/platform-tests/src/test/java/org/junit/platform/launcher/listener/SummaryGenerationTests.java) [https://github.com/junit-team/junit5/blob/master/junit-jupiter-engine/src/test /java/org/junit/jupiter/engine/StandardTestClassTests.java](https://github.com/junit-team/junit5/blob/master/junit-jupiter-engine/src/test/java/org/junit/jupiter/engine/StandardTestClassTests.java) [https://github.com/junit-team/junit5/blob/master/junit-jupiter-engine/src/test/java/org/junit/jupiter/引擎/DiscoveryFilterApplierTests.java](https://github.com/junit-team/junit5/blob/master/junit-jupiter-engine/src/test/java/org/junit/jupiter/engine/DiscoveryFilterApplierTests.java)

谷歌真相

[https://github.com/google/truth/blob/master/core/src/test/java/com/google/common/truth/DoubleSubjectTest.java](https://github.com/google/truth/blob/master/core/src/test/java/com/google/common/truth/DoubleSubjectTest.java) [https://github.com/google/truth/blob/master /core/src/test/java/com/google/common/truth/BigDecimalSubjectTest.java](https://github.com/google/truth/blob/master/core/src/test/java/com/google/common/truth/BigDecimalSubjectTest.java) [https://github.com/google/truth/blob/master/core/src/test/java/com/google/common/真相/DoubleSubjectTest.java](https://github.com/google/truth/blob/master/core/src/test/java/com/google/common/truth/DoubleSubjectTest.java)

正如我们在上面的例子中所看到的，专业的开发人员似乎不太关心单一的断言诫命。事实上，他们大部分时间都违反了这条规则，看起来他们完全可以接受。也许他们忽略了它，因为这不是一个严格的规则，而只是一个建议。**值得一提的是，即使是单元测试框架，大多数时候每次测试都会使用多个断言来测试自己。**

所以我的结论很清楚：关于这个问题，在一个测试中拥有尽可能多的断言是完全有效的。如果专业开发人员正在这样做，您也可以这样做。

# logging - ELMAh 中的块 404 FavIco 错误

> ID：762193
> 
> 赞同：8
> 
> 时间：2009-04-17T21:02:19.677
> 
> 标签：logging, http-status-code-404, elmah

我注意到 ELMAH 在我的本地服务器上记录了一个 404 not found for favico。如何通过过滤器抑制此错误？我对配置它还不是很熟悉..

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-10-16T18:27:08.043

官方 elmah[错误过滤页面](http://code.google.com/p/elmah/wiki/ErrorFiltering)解释了可以抑制此 404 图标错误的多种方法。

您可以像这样在 web.config 中以声明方式过滤掉*所有*404 错误。不过，我不确定是否有一种方法可以仅抑制 404 图标。

```
<errorFilter>
    <test>
        <equal binding="HttpStatusCode" value="404" type="Int32" />
    </test>
</errorFilter> 
```

如果您想以编程方式执行此操作，您可以消除 ErrorLog 或 ErrorEmail 过滤事件中的错误，如官方文档中所述。下面的代码有点矫枉过正，但它演示了如何*仅*过滤掉/favicon.ico 请求的 404 错误。

```
void ErrorLog_Filtering(object sender, ExceptionFilterEventArgs e)
{
    if (((HttpException)e.Exception.GetBaseException()).GetHttpCode() == 404
       && ((HttpContext)e.Context).Request.Path == "/favicon.ico")
    {
        e.Dismiss();
    }
} 
```

我个人更喜欢通过 web.config 以声明方式过滤所有 404，或者像 Joel 建议的那样提供一个 favicon。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-17T21:25:35.487

它不能帮助您了解如何配置 ELMAH，但防止 404 请求网站图标的最简单方法是提供一个...

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-04-22T19:11:04.347

通过使用下面的代码，我能够让 ELMAH 忽略该错误。您也可以添加任何其他您想忽略的路径。从技术上讲，这些可能是单独的测试，但如果将来我想忽略与我的应用程序相关的其他 404 错误，我想我会将它们组合在一起，因为它们不依赖于我的应用程序并且仅在这里从我的错误记录中删除混乱。

```
<errorFilter>
    <test>
        <or>
            <and>
                <equal binding="HttpStatusCode" value="404" type="Int32" />
                <equal binding="Context.Request.Path" value="/favicon.ico" type="string" />
            </and>
            <and>
                <equal binding="HttpStatusCode" value="404" type="Int32" />
                <equal binding="Context.Request.Path" value="/robots.txt" type="string" />
            </and>
        </or>
    </test>
</errorFilter> 
```

当然，如果您担心这会使您的 web.config 变得混乱，您可以随时将过滤器拆分到一个专用文件中。

```
<elmah>
    <security allowRemoteAccess="1" />
    <errorLog type="Elmah.SqlErrorLog, Elmah" connectionStringName="elmah-sqlserver" />
    <errorFilter configSource="elmahFilters.config" />
</elmah> 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-01-28T11:06:10.300

并不是我的 Web 应用程序正在请求一个网站图标，而是当我浏览到 elmah.axd 页面时，浏览器会请求一个网站图标。

据说，这应该有效：

```
<elmah>
  <errorFilter>
  <test>
      <and>
          <equal binding="HttpStatusCode" 
                 value="404" type="Int32" />
          <regex binding="Context.Request.ServerVariables['URL']" 
                 pattern="/favicon\.ico(\z|\?)" />
      </and>
  </test>
 </errorFilter>
</elmah> 
```

但你猜怎么着，它没有。

我发现工作的唯一方法是将 favicon.ico 添加到我的网络根目录。这不适用于我的网站，仅适用于 elmah.axd 页面。不需要调用 route.IgnoreRoute。

这是带有我的 favicon 的 elmah.axd，没有错误：

![elmah 与 favicon.ico](https://i.stack.imgur.com/hdDy2.jpg)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-02-24T15:00:54.303

我只是忽略路线而不是配置 Elmah。这对我有用：

```
routes.IgnoreRoute("{*favicon}", new {favicon=@"(.*/)?favicon.ico(/.*)?"}); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-01-17T19:54:58.857

我在上面使用了 Kurt Schindler 的编程解决方案（vs config）；但是，我注意到在 ErrorLog_Filtering 事件处理程序中两次抛出非 HttpExceptions。为避免这种情况，请确保对 GetBaseException 方法进行类型检查。这是片段

```
void ErrorLog_Filtering(object sender, ExceptionFilterEventArgs e)
{
    if (e.Exception.GetBaseException() is HttpException)
    {
        if (((HttpException)e.Exception.GetBaseException()).GetHttpCode() == 404
            && ((HttpContext)e.Context).Request.Path == "/favicon.ico")
        {
            e.Dismiss();
        }
    }
} 
```

这里没有什么新鲜事，如果您碰巧看到一些奇怪的行为，仅供参考。

谢谢...

# unix - 如何捕获 execvp 的输出

> ID：762200
> 
> 赞同：4
> 
> 时间：2009-04-17T21:04:42.060
> 
> 标签：unix, named-pipes

我正在开发一个使用 execvp 执行程序的程序。它需要捕获子进程的结果并在主进程中解析它们。似乎有一种方法，使用命名管道和复制。我正在努力寻找一个很好的例子，但到目前为止还没有运气。如果有人对此有任何指示、链接和/或建议，我将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-17T21:29:36.057

您不需要命名管道；未命名的管道工作得很好。实际上，通常你可以只使用而不是自己 `popen`做`pipe`/// `fork`。像这样工作（虽然你的实现可能有更多的错误检查）：`dup``exec``popen``libc`

```
FILE *popen(const char *command, const char *type) {
    int fds[2];
    const char *argv[4] = {"/bin/sh", "-c", command};
    pipe(fds);
    if (fork() == 0) {
        close(fds[0]);
        dup2(type[0] == 'r' ? 0 : 1, fds[1]);
        close(fds[1]);
        execvp(argv[0], argv);
        exit(-1);
    }
    close(fds[1]);
    return fdopen(fds[0], type);
} 
```

这将创建一个未命名的管道，并且`fork`s. 在孩子中，它将标准输出（或标准输入）重新附加到管道的一端，然后`exec`是孩子。父级可以简单地从管道的另一端读取（或写入）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T21:15:06.527

你不能只使用 popen() 吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-17T09:54:59.537

这是一个简单的示例，演示了如何使用 popen 来实现您的目标。只需将比“echo”更有趣的东西作为命令:)

```
#include <stdio.h>

int main() 
{
    char buf[100];
    int i = 0;
    FILE *p = popen("echo \"Test\"","r");
    if (p != NULL )
    {
        while (!feof(p) && (i < 99) )
        {
            fread(&buf[i++],1,1,p);
        }
        buf[i] = 0;
        printf("%s",buf);
        pclose(p);
        return 0;
    }
    else
    {
        return -1;
    }
} 
```

# oop - 在没有 RTTI 或基类修改的情况下作用于基类或子类

> ID：762201
> 
> 赞同：1
> 
> 时间：2009-04-17T21:04:48.003
> 
> 标签：oop

[昨天](https://stackoverflow.com/questions/757812/hibernate-polymorphism-instantiating-the-right-class/759132#759132)我问了一个类似的问题，该问题专门针对一项技术，但现在我发现自己对广义上的主题感到疑惑。

为简单起见，我们有两个类，A 和 B，其中 B 派生自 A。B 真正“是”A，并且 A 中定义的所有例程在 B 中具有相同的含义。

假设我们要显示一个 As 列表，其中一些实际上是 B。当我们遍历我们的 As 列表时，如果当前对象实际上是 B，我们想要显示 B 的一些附加属性......或者我们只是想给 B 着色不同，但是 A 和 B 都没有任何概念“颜色”或“显示的东西”。

解决方案：

1.  基本上通过在 A 中包含一个名为 isB() 的方法来使 A 类半感知 B，该方法返回 false。B 将覆盖该方法并返回 true。显示代码将进行如下检查： if (currentA.isB()) B b = currentA;

2.  在 A 中提供一个 display() 方法，B 可以覆盖....但是我们开始合并 UI 和模型。除非有一些我没有看到的很酷的技巧，否则我不会考虑这个。

3.  使用 instanceof 检查当前要显示的 A 对象是否真的是 B。

4.  只需将 B 中的所有垃圾添加到 A，即使它不适用于 A。基本上只在 A 中包含一个 B（不从 A 继承）并将其设置为 null 直到它应用。这有点吸引人。这类似于#1，我猜想使用组合而不是继承。

似乎这个特殊问题应该不时出现并有一个明显的解决方案。

所以我想这个问题可能真的归结为：

**如果我有一个通过*添加附加功能*（而不仅仅是更改基类的现有行为）来扩展基类的子类，我是否在做一些可悲的错误？** 一旦我们尝试对可能是 A 或 B 的对象集合采取行动，这一切似乎都会立即崩溃。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T21:55:45.180

选项 2 的变体（或 1 和 2 的混合）可能有意义：毕竟，多态性是“B 是 As 但在情况 X 中需要表现不同”的标准解决方案。同意， display() 方法可能会将模型与 UI 联系得太紧密，但可能您想要在 UI 级别的不同渲染反映了模型级别的语义或行为差异。可以在方法中捕获这些吗？例如，不是直接的 getDisplayColour() 方法，而是 getPriority() （例如）方法，A 和 B 返回不同的值，但仍由 UI 决定如何将其转换为颜色?

但是，鉴于您提出的更一般的问题是“我们如何处理*额外的*我们不能或不允许通过基类多态访问的行为”，例如，如果基类不在我们的控制之下，您的选项可能是选项 3、访问者模式或辅助类。在在这两种情况下，您都有效地将多态性转移给外部实体——在选项 3 中，UI（例如演示者或控制器）执行 instanceOf 检查并根据它是否为 B 执行不同的操作；在访问者或辅助案例，新类。鉴于您的示例，Visitor 可能是矫枉过正（另外，如果您不能/愿意更改基类以适应它，我认为不可能实现它），所以我会建议一个名为“renderer”之类的简单类：

```
public abstract class Renderer {
  public static Renderer Create(A obj) {
    if (obj instanceOf B)
      return new BRenderer();
    else
      return new ARenderer();
  }

  public abstract Color getColor();
}

// implementations of ARenderer and BRenderer per your UI logic 
```

这封装了运行时类型检查并将代码捆绑到具有明确职责的合理定义的类中，而没有访问者的概念开销。（不过，根据 GrizzlyNyo 的回答，如果您的层次结构或功能集比您在此处显示的更复杂，Visitor 可能更合适，但很多人发现 Visitor 很难理解，我倾向于避免它简单的情况——但你的里程可能会有所不同。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T09:53:25.907

[itowlson](https://stackoverflow.com/questions/762201/act-on-base-or-subclass-without-rtti-or-base-class-modification/762354#762354)给出的答案很好地涵盖了问题的大部分。我现在将尽可能简单地处理最后一段。

应该实现继承以供重用，以便您的派生类在旧代码中重用，而不是让您的类重用基类的部分（您可以为此使用聚合）。

从这个角度来看，如果您有一个要用于具有一些新功能的新代码的类，但应该透明地用作以前的类，那么继承是您的解决方案。新代码可以使用新功能，旧代码将无缝使用您的新对象。

虽然这是一般意图，但也有一些常见的陷阱，这里的界限很微妙，您的问题正是关于这条界限。如果您有一个 base 类型的对象集合，那应该是因为这些对象只能与 base 的方法一起使用。它们是“基地”，表现得像基地。

使用“instanceof”或向下转换（C++ 中的 dynamic_cast<>()）等技术来检测真正的运行时类型是我会在代码审查中标记的东西，并且只有在程序员详细解释为什么任何其他选项更糟糕之后才能接受比那个解决方案。我会接受它，例如，在[itowlson](https://stackoverflow.com/users/61700/itowlson)的答案是在基地中的给定操作无法获得信息的前提下。也就是说，基本类型没有任何方法可以为调用者提供足够的信息来确定颜色。如果包含这样的操作没有意义：除了表示颜色之外，您是否要根据相同的信息对对象执行任何操作？如果逻辑依赖于真实类型，那么操作应该在基类中，以便在派生类中被覆盖。如果这是不可能的（该操作是新的并且仅适用于某些给定的子类型），则至少应该在基础中进行一个操作，以允许调用者确定向下转换不会失败。再说一次，我真的需要一个合理的理由让调用者代码需要了解真实类型。为什么用户希望以不同的颜色看到它？用户会对每种类型执行不同的操作吗？

如果您最终需要使用代码来绕过类型系统，那么您的设计会有一种奇怪的[味道](https://stackoverflow.com/questions/432492/whats-a-more-polite-word-for-code-smell)。当然，永远不要说永不，但你可以肯定地说：避免依赖*instanceof*或向下转换的逻辑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T21:45:47.857

这看起来像访客设计模式（也称为“双重调度”）的教科书案例。

请参阅[此答案](https://stackoverflow.com/questions/255214/when-should-i-use-the-visitor-design-pattern/461660#461660)以获取有关访问者和复合模式的详细说明的链接。

# java - 当我尝试在 Java 中运行我的套接字程序时，为什么会出现错误？

> ID：762205
> 
> 赞同：3
> 
> 时间：2009-04-17T21:06:04.147
> 
> 标签：java, networking, sockets

我正在使用 jcreatorLE 和 JDK 1.6 来运行我的程序。我不知道为什么我尝试运行时会出错。有人可以向我解释原因吗？

**这是服务器的代码：**

```
import java.io.*;
import java.net.*;

class ServidorTCP {
   // variable to wait for connections
   private static ServerSocket servidor = null;
   // Variable to process client connections
   private static Socket conexion = null;
   // To send data to the client
   private static DataOutputStream salida = null;
   // Read the client
   private static DataInputStream entrada = null;

   public static void main(String args[]) {
      // args [0] is the port number to be listened to
      int puerto = new Integer(args[0]).intValue();

      // opening of the socket
      try {
         // Port where the client requests pending
         servidor = new ServerSocket(puerto);

         System.out.println("Servidor TCP iniciado...");
         boolean ejecutar = true;

         // It is starting to respond to requests
         while (ejecutar) {
            System.out.println("\nWaiting for Connections...");
            conexion = servidor.accept();      // Connection is expected

            // The connection was established with the client
            entrada = new DataInputStream(conexion.getInputStream());
            salida = new DataOutputStream(conexion.getOutputStream());

            System.out.println("\nConexion recibida...\n");
            String inicio = entrada.readUTF();
            System.out.println("Reception Date: "+new java.util.Date());
            System.out.println("From: "+(conexion.getInetAddress()).toString());
            System.out.println("received: "+inicio);

            salida.writeUTF(inicio.toUpperCase());
            entrada.close();
            salida.close();
            conexion.close();
         }

         // Close the socket
         System.out.println("\ntransmission completed...\n");
         servidor.close();
      } catch (Exception e) {
         e.printStackTrace();
      }
   }
} 
```

**这是客户端套接字程序的代码：**

```
import java.io.*;
import java.net.*;

class ClienteTCP {
   private static Socket           cliente = null;
   private static DataInputStream  entrada = null;
   private static DataOutputStream salida  = null;

   public static void main(String args[]) {
      int len = new Integer(args.length);
      String cadena = "";
      System.out.println("\nNumero de arg: "+len);
      for (int i=2; i<len;i++) {
         cadena = cadena + args[i];
         cadena = cadena + " ";
      }

      System.out.println("\nLa Cadena: "+cadena);
      int puerto = new Integer(args[1]).intValue();

      try {
         cliente = new Socket(args[0],puerto);
         entrada = new DataInputStream(cliente.getInputStream());
         salida = new DataOutputStream(cliente.getOutputStream());

         //SENDING INFORMATION DATA
         System.out.println("\nEnviando datos al servidor: "+cadena);
         salida.writeUTF(cadena);

         //Recibiendo la información
         System.out.println("Recibido: "+entrada.readUTF());
         entrada.close();
         salida.close();

         //Cierre del socket
         cliente.close();
         System.out.println("\nConexion terminada...\n");
      } catch (Exception e) {
         e.printStackTrace();
      }
   }
} 
```

**这是运行它的结果：**

```
[Loaded java.lang.Object from shared objects file]
[Loaded java.io.Serializable from shared objects file]
[Loaded java.lang.Comparable from shared objects file]
[Loaded java.lang.CharSequence from shared objects file]
[Loaded java.lang.String from shared objects file]
[Loaded java.lang.reflect.GenericDeclaration from shared objects file]
[Loaded java.lang.reflect.Type from shared objects file]
[Loaded java.lang.reflect.AnnotatedElement from shared objects file]
[Loaded java.lang.Class from shared objects file]
[Loaded java.lang.Cloneable from shared objects file]
[Loaded java.lang.ClassLoader from shared objects file]
[Loaded java.lang.System from shared objects file]
[Loaded java.lang.Throwable from shared objects file]
[Loaded java.lang.Error from shared objects file]
[Loaded java.lang.ThreadDeath from shared objects file]
[Loaded java.lang.Exception from shared objects file]
[Loaded java.lang.RuntimeException from shared objects file]
[Loaded java.security.ProtectionDomain from shared objects file]
[Loaded java.security.AccessControlContext from shared objects file]
[Loaded java.lang.ClassNotFoundException from shared objects file]
[Loaded java.lang.LinkageError from shared objects file]
[Loaded java.lang.NoClassDefFoundError from shared objects file]
[Loaded java.lang.ClassCastException from shared objects file]
[Loaded java.lang.ArrayStoreException from shared objects file]
[Loaded java.lang.VirtualMachineError from shared objects file]
[Loaded java.lang.OutOfMemoryError from shared objects file]
[Loaded java.lang.StackOverflowError from shared objects file]
[Loaded java.lang.IllegalMonitorStateException from shared objects file]
[Loaded java.lang.ref.Reference from shared objects file]
[Loaded java.lang.ref.SoftReference from shared objects file]
[Loaded java.lang.ref.WeakReference from shared objects file]
[Loaded java.lang.ref.FinalReference from shared objects file]
[Loaded java.lang.ref.PhantomReference from shared objects file]
[Loaded java.lang.ref.Finalizer from shared objects file]
[Loaded java.lang.Runnable from shared objects file]
[Loaded java.lang.Thread from shared objects file]
[Loaded java.lang.Thread$UncaughtExceptionHandler from shared objects file]
[Loaded java.lang.ThreadGroup from shared objects file]
[Loaded java.util.Dictionary from shared objects file]
[Loaded java.util.Map from shared objects file]
[Loaded java.util.Hashtable from shared objects file]
[Loaded java.util.Properties from shared objects file]
[Loaded java.lang.reflect.AccessibleObject from shared objects file]
[Loaded java.lang.reflect.Member from shared objects file]
[Loaded java.lang.reflect.Field from shared objects file]
[Loaded java.lang.reflect.Method from shared objects file]
[Loaded java.lang.reflect.Constructor from shared objects file]
[Loaded sun.reflect.MagicAccessorImpl from shared objects file]
[Loaded sun.reflect.MethodAccessor from shared objects file]
[Loaded sun.reflect.MethodAccessorImpl from shared objects file]
[Loaded sun.reflect.ConstructorAccessor from shared objects file]
[Loaded sun.reflect.ConstructorAccessorImpl from shared objects file]
[Loaded sun.reflect.DelegatingClassLoader from shared objects file]
[Loaded sun.reflect.ConstantPool from shared objects file]
[Loaded sun.reflect.FieldAccessor from shared objects file]
[Loaded sun.reflect.FieldAccessorImpl from shared objects file]
[Loaded sun.reflect.UnsafeFieldAccessorImpl from shared objects file]
[Loaded sun.reflect.UnsafeStaticFieldAccessorImpl from shared objects file]
[Loaded java.lang.Iterable from shared objects file]
[Loaded java.util.Collection from shared objects file]
[Loaded java.util.AbstractCollection from shared objects file]
[Loaded java.util.List from shared objects file]
[Loaded java.util.AbstractList from shared objects file]
[Loaded java.util.RandomAccess from shared objects file]
[Loaded java.util.Vector from shared objects file]
[Loaded java.lang.Appendable from shared objects file]
[Loaded java.lang.AbstractStringBuilder from shared objects file]
[Loaded java.lang.StringBuffer from shared objects file]
[Loaded java.lang.StackTraceElement from shared objects file]
[Loaded java.nio.Buffer from shared objects file]
[Loaded sun.misc.AtomicLong from shared objects file]
[Loaded sun.misc.AtomicLongCSImpl from shared objects file]
[Loaded java.lang.Boolean from shared objects file]
[Loaded java.lang.Character from shared objects file]
[Loaded java.lang.Number from shared objects file]
[Loaded java.lang.Float from shared objects file]
[Loaded java.lang.Double from shared objects file]
[Loaded java.lang.Byte from shared objects file]
[Loaded java.lang.Short from shared objects file]
[Loaded java.lang.Integer from shared objects file]
[Loaded java.lang.Long from shared objects file]
[Loaded java.io.ObjectStreamField from shared objects file]
[Loaded java.util.Comparator from shared objects file]
[Loaded java.lang.String$CaseInsensitiveComparator from shared objects file]
[Loaded java.security.Guard from shared objects file]
[Loaded java.security.Permission from shared objects file]
[Loaded java.security.BasicPermission from shared objects file]
[Loaded java.lang.RuntimePermission from shared objects file]
[Loaded java.util.AbstractMap from shared objects file]
[Loaded sun.misc.SoftCache from shared objects file]
[Loaded java.lang.ref.ReferenceQueue from shared objects file]
[Loaded java.lang.ref.ReferenceQueue$Null from shared objects file]
[Loaded java.lang.ref.ReferenceQueue$Lock from shared objects file]
[Loaded java.util.HashMap from shared objects file]
[Loaded java.lang.annotation.Annotation from shared objects file]
[Loaded java.util.Map$Entry from shared objects file]
[Loaded java.util.HashMap$Entry from shared objects file]
[Loaded java.security.AccessController from shared objects file]
[Loaded java.lang.reflect.ReflectPermission from shared objects file]
[Loaded java.security.PrivilegedAction from shared objects file]
[Loaded sun.reflect.ReflectionFactory$GetReflectionFactoryAction from shared objects file]
[Loaded java.util.Stack from shared objects file]
[Loaded sun.reflect.ReflectionFactory from shared objects file]
[Loaded java.lang.ref.Reference$Lock from shared objects file]
[Loaded java.lang.ref.Reference$ReferenceHandler from shared objects file]
[Loaded java.lang.ref.Finalizer$FinalizerThread from shared objects file]
[Loaded java.util.Enumeration from shared objects file]
[Loaded java.util.Hashtable$EmptyEnumerator from shared objects file]
[Loaded java.util.Iterator from shared objects file]
[Loaded java.util.Hashtable$EmptyIterator from shared objects file]
[Loaded java.util.Hashtable$Entry from shared objects file]
[Loaded sun.misc.Version from shared objects file]
[Loaded java.lang.Runtime from shared objects file]
[Loaded sun.reflect.Reflection from shared objects file]
[Loaded java.util.Collections from shared objects file]
[Loaded java.util.Set from shared objects file]
[Loaded java.util.AbstractSet from shared objects file]
[Loaded java.util.Collections$EmptySet from shared objects file]
[Loaded java.util.Collections$EmptyList from shared objects file]
[Loaded java.util.Collections$EmptyMap from shared objects file]
[Loaded java.util.Collections$ReverseComparator from shared objects file]
[Loaded java.util.Collections$SynchronizedMap from shared objects file]
[Loaded java.io.File from shared objects file]
[Loaded java.io.FileSystem from shared objects file]
[Loaded java.io.Win32FileSystem from shared objects file]
[Loaded java.io.WinNTFileSystem from shared objects file]
[Loaded java.io.ExpiringCache from shared objects file]
[Loaded java.util.LinkedHashMap from shared objects file]
[Loaded java.io.ExpiringCache$1 from shared objects file]
[Loaded java.util.LinkedHashMap$Entry from shared objects file]
[Loaded sun.security.action.GetPropertyAction from shared objects file]
[Loaded java.lang.StringBuilder from shared objects file]
[Loaded java.util.Arrays from shared objects file]
[Loaded java.lang.Math from shared objects file]
[Loaded sun.misc.JavaIODeleteOnExitAccess from shared objects file]
[Loaded java.io.File$1 from shared objects file]
[Loaded sun.misc.SharedSecrets from shared objects file]
[Loaded sun.misc.Unsafe from shared objects file]
[Loaded java.lang.IncompatibleClassChangeError from shared objects file]
[Loaded java.lang.NoSuchMethodError from shared objects file]
[Loaded sun.jkernel.DownloadManager from shared objects file]
[Loaded java.lang.ThreadLocal from shared objects file]
[Loaded sun.jkernel.DownloadManager$1 from shared objects file]
[Loaded java.util.concurrent.atomic.AtomicInteger from shared objects file]
[Loaded java.lang.Class$3 from shared objects file]
[Loaded java.lang.reflect.Modifier from shared objects file]
[Loaded sun.reflect.LangReflectAccess from shared objects file]
[Loaded java.lang.reflect.ReflectAccess from shared objects file]
[Loaded sun.jkernel.DownloadManager$2 from shared objects file]
[Loaded java.lang.ClassLoader$3 from shared objects file]
[Loaded java.io.ExpiringCache$Entry from shared objects file]
[Loaded java.lang.ClassLoader$NativeLibrary from shared objects file]
[Loaded java.io.Closeable from shared objects file]
[Loaded java.io.InputStream from shared objects file]
[Loaded java.io.FileInputStream from shared objects file]
[Loaded java.io.FileDescriptor from shared objects file]
[Loaded java.io.Flushable from shared objects file]
[Loaded java.io.OutputStream from shared objects file]
[Loaded java.io.FileOutputStream from shared objects file]
[Loaded java.io.FilterInputStream from shared objects file]
[Loaded java.io.BufferedInputStream from shared objects file]
[Loaded java.util.concurrent.atomic.AtomicReferenceFieldUpdater from shared objects file]
[Loaded java.util.concurrent.atomic.AtomicReferenceFieldUpdater$AtomicReferenceFieldUpdaterImpl from shared objects file]
[Loaded sun.reflect.misc.ReflectUtil from shared objects file]
[Loaded java.io.FilterOutputStream from shared objects file]
[Loaded java.io.PrintStream from shared objects file]
[Loaded java.io.BufferedOutputStream from shared objects file]
[Loaded java.io.Writer from shared objects file]
[Loaded java.io.OutputStreamWriter from shared objects file]
[Loaded sun.nio.cs.StreamEncoder from shared objects file]
[Loaded java.nio.charset.Charset from shared objects file]
[Loaded java.nio.charset.spi.CharsetProvider from shared objects file]
[Loaded sun.nio.cs.FastCharsetProvider from shared objects file]
[Loaded sun.nio.cs.StandardCharsets from shared objects file]
[Loaded sun.util.PreHashedMap from shared objects file]
[Loaded sun.nio.cs.StandardCharsets$Aliases from shared objects file]
[Loaded sun.nio.cs.StandardCharsets$Classes from shared objects file]
[Loaded sun.nio.cs.StandardCharsets$Cache from shared objects file]
[Loaded sun.nio.cs.HistoricallyNamedCharset from shared objects file]
[Loaded sun.nio.cs.MS1252 from shared objects file]
[Loaded java.lang.Class$1 from shared objects file]
[Loaded sun.reflect.ReflectionFactory$1 from shared objects file]
[Loaded sun.reflect.NativeConstructorAccessorImpl from shared objects file]
[Loaded sun.reflect.DelegatingConstructorAccessorImpl from shared objects file]
[Loaded sun.misc.VM from shared objects file]
[Loaded java.nio.charset.CharsetEncoder from shared objects file]
[Loaded sun.nio.cs.SingleByteEncoder from shared objects file]
[Loaded sun.nio.cs.MS1252$Encoder from shared objects file]
[Loaded java.nio.charset.CodingErrorAction from shared objects file]
[Loaded java.nio.charset.CharsetDecoder from shared objects file]
[Loaded sun.nio.cs.SingleByteDecoder from shared objects file]
[Loaded sun.nio.cs.MS1252$Decoder from shared objects file]
[Loaded java.nio.ByteBuffer from shared objects file]
[Loaded java.nio.HeapByteBuffer from shared objects file]
[Loaded java.nio.Bits from shared objects file]
[Loaded java.nio.ByteOrder from shared objects file]
[Loaded java.lang.Readable from shared objects file]
[Loaded java.nio.CharBuffer from shared objects file]
[Loaded java.nio.HeapCharBuffer from shared objects file]
[Loaded java.nio.charset.CoderResult from shared objects file]
[Loaded java.nio.charset.CoderResult$Cache from shared objects file]
[Loaded java.nio.charset.CoderResult$1 from shared objects file]
[Loaded java.nio.charset.CoderResult$2 from shared objects file]
[Loaded sun.nio.cs.Surrogate$Parser from shared objects file]
[Loaded sun.nio.cs.Surrogate from shared objects file]
[Loaded java.io.BufferedWriter from shared objects file]
[Loaded java.lang.Terminator from shared objects file]
[Loaded sun.misc.SignalHandler from shared objects file]
[Loaded java.lang.Terminator$1 from shared objects file]
[Loaded sun.misc.Signal from shared objects file]
[Loaded sun.misc.NativeSignalHandler from shared objects file]
[Loaded java.io.Console from shared objects file]
[Loaded sun.misc.JavaIOAccess from shared objects file]
[Loaded java.io.Console$1 from shared objects file]
[Loaded java.io.Console$1$1 from shared objects file]
[Loaded java.lang.Shutdown from shared objects file]
[Loaded java.util.ArrayList from shared objects file]
[Loaded java.lang.Shutdown$Lock from shared objects file]
[Loaded java.lang.ApplicationShutdownHooks from shared objects file]
[Loaded java.util.IdentityHashMap from shared objects file]
[Loaded sun.misc.OSEnvironment from shared objects file]
[Loaded sun.io.Win32ErrorMode from shared objects file]
[Loaded sun.misc.JavaLangAccess from shared objects file]
[Loaded java.lang.System$2 from shared objects file]
[Loaded java.lang.NullPointerException from shared objects file]
[Loaded java.lang.ArithmeticException from shared objects file]
[Loaded java.lang.Compiler from shared objects file]
[Loaded java.lang.Compiler$1 from shared objects file]
[Loaded sun.misc.Launcher from shared objects file]
[Loaded java.net.URLStreamHandlerFactory from shared objects file]
[Loaded sun.misc.Launcher$Factory from shared objects file]
[Loaded java.security.SecureClassLoader from shared objects file]
[Loaded java.net.URLClassLoader from shared objects file]
[Loaded sun.misc.Launcher$ExtClassLoader from shared objects file]
[Loaded sun.security.util.Debug from shared objects file]
[Loaded sun.misc.JavaNetAccess from shared objects file]
[Loaded java.net.URLClassLoader$7 from shared objects file]
[Loaded java.util.StringTokenizer from shared objects file]
[Loaded java.security.PrivilegedExceptionAction from shared objects file]
[Loaded sun.misc.Launcher$ExtClassLoader$1 from shared objects file]
[Loaded sun.misc.MetaIndex from shared objects file]
[Loaded java.io.Reader from shared objects file]
[Loaded java.io.BufferedReader from shared objects file]
[Loaded java.io.InputStreamReader from shared objects file]
[Loaded java.io.FileReader from shared objects file]
[Loaded sun.nio.cs.StreamDecoder from shared objects file]
[Loaded java.lang.reflect.Array from shared objects file]
[Loaded java.util.Locale from shared objects file]
[Loaded java.util.concurrent.ConcurrentMap from shared objects file]
[Loaded java.util.concurrent.ConcurrentHashMap from shared objects file]
[Loaded java.util.concurrent.locks.Lock from shared objects file]
[Loaded java.util.concurrent.locks.ReentrantLock from shared objects file]
[Loaded java.util.concurrent.ConcurrentHashMap$Segment from shared objects file]
[Loaded java.util.concurrent.locks.AbstractOwnableSynchronizer from shared objects file]
[Loaded java.util.concurrent.locks.AbstractQueuedSynchronizer from shared objects file]
[Loaded java.util.concurrent.locks.ReentrantLock$Sync from shared objects file]
[Loaded java.util.concurrent.locks.ReentrantLock$NonfairSync from shared objects file]
[Loaded java.util.concurrent.locks.AbstractQueuedSynchronizer$Node from shared objects file]
[Loaded java.util.concurrent.ConcurrentHashMap$HashEntry from shared objects file]
[Loaded java.lang.CharacterDataLatin1 from shared objects file]
[Loaded java.io.ObjectStreamClass from shared objects file]
[Loaded sun.net.www.ParseUtil from shared objects file]
[Loaded java.util.BitSet from shared objects file]
[Loaded java.net.URL from shared objects file]
[Loaded java.net.Parts from shared objects file]
[Loaded java.net.URLStreamHandler from shared objects file]
[Loaded sun.net.www.protocol.file.Handler from shared objects file]
[Loaded java.util.HashSet from shared objects file]
[Loaded sun.misc.URLClassPath from shared objects file]
[Loaded sun.net.www.protocol.jar.Handler from shared objects file]
[Loaded sun.misc.Launcher$AppClassLoader from shared objects file]
[Loaded sun.misc.Launcher$AppClassLoader$1 from shared objects file]
[Loaded java.lang.SystemClassLoaderAction from shared objects file]
[Loaded java.lang.StringCoding from shared objects file]
[Loaded java.lang.ThreadLocal$ThreadLocalMap from shared objects file]
[Loaded java.lang.ThreadLocal$ThreadLocalMap$Entry from shared objects file]
[Loaded java.lang.StringCoding$StringDecoder from shared objects file]
[Loaded java.net.URLClassLoader$1 from shared objects file]
[Loaded sun.misc.URLClassPath$3 from shared objects file]
[Loaded sun.misc.URLClassPath$Loader from shared objects file]
[Loaded sun.misc.URLClassPath$JarLoader from shared objects file]
[Loaded java.security.PrivilegedActionException from shared objects file]
[Loaded sun.misc.URLClassPath$FileLoader from shared objects file]
[Loaded sun.misc.Resource from shared objects file]
[Loaded sun.misc.URLClassPath$FileLoader$1 from shared objects file]
[Loaded sun.nio.ByteBuffered from shared objects file]
[Loaded java.security.CodeSource from shared objects file]
[Loaded java.security.PermissionCollection from shared objects file]
[Loaded java.security.Permissions from shared objects file]
[Loaded java.net.URLConnection from shared objects file]
[Loaded sun.net.www.URLConnection from shared objects file]
[Loaded sun.net.www.protocol.file.FileURLConnection from shared objects file]
[Loaded java.net.ContentHandler from shared objects file]
[Loaded java.net.UnknownContentHandler from shared objects file]
[Loaded sun.net.www.MessageHeader from shared objects file]
[Loaded java.io.FilePermission from shared objects file]
[Loaded java.io.FilePermission$1 from shared objects file]
[Loaded java.security.Policy from shared objects file]
[Loaded sun.security.provider.PolicyFile from shared objects file]
[Loaded java.security.Policy$UnsupportedEmptyCollection from shared objects file]
[Loaded java.io.FilePermissionCollection from shared objects file]
[Loaded java.security.AllPermission from shared objects file]
[Loaded java.security.UnresolvedPermission from shared objects file]
[Loaded java.security.BasicPermissionCollection from shared objects file]
[Loaded java.security.Principal from shared objects file]
[Loaded java.security.cert.Certificate from shared objects file]
[Loaded ServidorTCP from file:/C:/Users/administrador/Documents/]
[Loaded java.lang.IndexOutOfBoundsException from shared objects file]
[Loaded java.lang.ArrayIndexOutOfBoundsException from shared objects file]

Exception in thread "main" java.lang.ArrayIndexOutOfBoundsException: 0
    at ServidorTCP.main(ServidorTCP.java:21)

[Loaded java.util.AbstractList$Itr from shared objects file]
[Loaded java.util.IdentityHashMap$KeySet from shared objects file]
[Loaded java.util.IdentityHashMap$IdentityHashMapIterator from shared objects file]
[Loaded java.util.IdentityHashMap$KeyIterator from shared objects file]
[Loaded java.io.DeleteOnExitHook from shared objects file]
[Loaded java.util.LinkedHashSet from shared objects file]
[Loaded java.util.HashMap$KeySet from shared objects file]
[Loaded java.util.LinkedHashMap$LinkedHashIterator from shared objects file]
[Loaded java.util.LinkedHashMap$KeyIterator from shared objects file]

Process completed. 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-17T21:50:16.067

您必须在命令行中指定端口号。

知道如何阅读日志总是有用的。

看。在您的日志中，您有一堆类名，但只有一个与您的代码相关：

```
Exception in thread "main" java.lang.ArrayIndexOutOfBoundsException: 0
    at ServidorTCP.main(ServidorTCP.java:21) 
```

其余的都是关于 java.lang、java.util、java.io 等，你没有编码的类。

如果您查看该错误行，它会显示：

```
 java.lang.ArrayIndexOutOfBoundsException: 
```

这意味着您试图访问**超出其边界的数组**。也就是说，如果数组大小为 5，您可能试图访问第 6 个元素。这是非法的，这是一个异常（更正式的 RuntimeException 意味着你有一个编程错误）

然后日志会添加发生的信息。

```
 at ServidorTCP.main(ServidorTCP.java:21) 
```

在 ServidorTCP 类中（在第 21 行的 Java 文件 ServidorTCP 中。

您可以在该行查看该文件，这就是它显示的内容：

```
 20:    // args [0] is the port number to be heard
 21:    int puerto = new Integer(args[0]).intValue(); 
```

也就是说，变量“puerto”的值将是使用**args[0]**的内容创建的新整数，这是 args 数组的第一个元素。

该数组在 main 方法中定义：

```
 public static void main(String args[]){ 
```

并自动填充命令行参数。

因此，如果您在不提供参数的情况下运行程序，则在数组 args 中搜索索引 0 将失败。

我不知道你可以在 jcreator 的哪个位置添加命令行参数，但我很确定在“运行”菜单的某个地方，或者在“运行”配置或类似的地方，应该有类似“程序参数”的东西" 您可以使用端口号填充该值，尝试使用 8085。

# **或者**

您还可以更改服务器的第 21 行并像这样初始化它：

```
//int puerto = new Integer(args[0]).intValue();
int puerto = 8085; // por mis pistolas :) 
```

并看到它运行。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-17T21:08:39.350

听起来当你启动服务器时你没有给它任何命令行参数。换句话说，你正在运行类似的东西：

```
java -cp . ServidorTCP 
```

当你应该跑步时

```
java -cp . ServidorTCP 40000 
```

（在端口 40000 上启动服务器）

如果从 IDE 启动程序，则需要了解如何在启动程序时传入参数。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-17T21:11:36.410

由于它是一个 ArrayIndexOutOfBounds 异常，我将开始查看您在哪里使用数组。因此，在您的情况下，您尝试从参数数组中获取端口号。因此，首先看一下，并确保您将端口号作为命令行参数传入。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-17T21:24:08.657

查看您的 main() 方法的签名：

```
公共静态无效主（字符串参数 []）

```

错误在这里：

```
int puerto = new Integer(args[0]).intValue();

```

如果你通过不传递参数来调用你的程序，它会尝试从一个实际上是空的数组中读取一个整数。

如果您不想关心参数，只需执行以下操作：

```
int arguments = new Integer (args.length);

如果（参数 = 0）{
  这个.puerto = 4000;
}

```

那应该做的工作。如果没有传递任何参数，它将假定端口 4000（或您选择的任何端口）作为默认端口。

# java - Java 集合 API 错误？

> ID：762219
> 
> 赞同：3
> 
> 时间：2009-04-17T21:09:24.433
> 
> 标签：java, collections

我在 Collections.java 中偶然发现了 Java Collections API 中的一个错误。

这是来自 JDK 源代码的逐字代码。如您所知，JavaDoc 版本标记为“1.106, 04/21/06”。该方法位于第 638 行。

```
public static <T extends Object & Comparable<? super T>> T max(Collection<? extends T> coll) {
    Iterator<? extends T> i = coll.iterator();
    T candidate = i.next();

    while (i.hasNext()) {
        T next = i.next();
        if (next.compareTo(candidate) > 0)
            candidate = next;
    }
    return candidate;
} 
```

如果你花点时间分析这个方法，你会很快发现错误：T Candidate = i.next()。哦！在迭代器上调用 i.next() 而不先检查 hasNext()？那只是要求例外。

在编码过程中肯定应该发现类似的东西吗？这意味着使用 API 必须检查集合是否至少有两个元素。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-17T21:13:03.287

否 - 这意味着尝试查找空集合的最大元素是无效的。这在 API 文档中指定：

```
Throws:
    NoSuchElementException - if the collection is empty. 
```

`Iterator.next()`如果没有下一个元素，这就是记录在案的内容，所以它完全按照它的意思做。

请注意，*在*第一次调用 next() 之后，会调用 hasNext() 来检查是否存在*多个*元素。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-17T21:14:44.407

很难将其称为错误，因为[此处记录了异常](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#max(java.util.Collection))

抛出：

*   如果集合包含不可相互比较的元素（例如，字符串和整数），则 ClassCastException。
*   **如果集合为空，则 NoSuchElementException。**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T21:19:01.713

如果集合为空，则根据[API doc](http://java.sun.com/j2se/1.5.0/docs/api/index.html) *`Collection.max`*方法抛出。*`NoSuchElementException`*

这正是你观察到的。

# php - 用 PHP 实现的简单密码学问题

> ID：762221
> 
> 赞同：2
> 
> 时间：2009-04-17T21:10:05.760
> 
> 标签：php, cryptography

我需要实现几个符合以下条件的功能：

1.  函数 genKey：给定一个字符串 q（这可能是一个 MD5 或 SHA 哈希）和一个种子字符串，该函数必须生成一个新字符串 p

2.  function checkKey：如果字符串 p 是从字符串 q 生成的，则此函数必须返回 true（使用前面的函数）

在伪代码中，上面的内容是这样的：

```
p=genKey(q,seed) ; // generate string p from q and seed 

checkKey(p,q)==true ; // if p was generated from q, then this must return true. False otherwise. 
```

有谁知道做这种事情的现有算法？
如果没有已知的 PHP 实现，我可以自己实现算法，所以我真正要求的是实现这一点的过程。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T21:24:19.140

听起来您可能正在尝试描述 MAC。

消息验证码采用消息摘要、秘密和消息。秘密和数据一起散列，结果包含在消息中。

知道秘密的消息接收者可以执行相同的摘要计算，并将他的 MAC 与收到消息的 MAC 进行比较。如果它们相等，他可以相信消息没有被更改。

* * *

鉴于您的评论，我现在了解到您正在使用非对称密钥，而不是在 MAC 中使用的密钥。

但是，仍然存在一些混乱。通常，私人签名密钥由其所有者保密，在这种情况下，它似乎是客户端。客户端可以加密证明他们拥有与公钥对应的私钥，而无需披露私钥。

使用数字签名，您可以执行以下操作：

```
p = genKey(pvt, seed)
checkKey(pub, p) 
```

这里，`pvt`是服务器的私钥，`pub`是它的公钥。`seed`参数是被签名的数据。如果我了解您的应用程序（我对此表示怀疑），`seed`则应该是客户端标识符。然后`p`是捆绑`seed`在一起的消息格式及其签名。您的问题令人困惑，因为`q`它既用于生成又用于验证`p`——就像共享秘密一样。

但是，此方案（或 MAC 方案）中没有任何内容可以阻止一个客户端使用另一个客户端的`p`. 使用这种技术所能做的就是确保消息内容没有被更改。例如，如果消息类似于“clientID=Alice,IPAddress=192.168.1.1”，您可以确保 Mallory 没有用他自己的 IP 地址代替 Alice 的。

但是如果消息只是“clientID=Alice”，你无法阻止 Alice 向 Bob 提供她的防篡改消息（作为分摊许可证成本的回报），你也无法控制 Mallory 是否侵入 Alice 的盒子并窃取消息。

顺便说一句，如果您真的只需要消息完整性，并且您可以轻松地在发送者和接收者之间共享一个秘密，那么 MAC 与公钥加密相比具有一些很好的优势，例如更小的消息大小和更快的性能。

概述您试图防御的威胁。密码学很难。设计未经尝试的方案通常会以糟糕的方式结束。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T21:56:33.183

对于这个讨论，让 p == hash(q)

然后，您可以轻松地将 OpenSSL 与 php 结合使用，使用私钥对“p”进行签名，并将该签名保留在“p”旁边。

然后，使用与您的私钥配对的公钥，使用 OpenSSL 验证功能来检查“p”与签名很简单。在这种情况下，“p”将是要验证的数据。

有关在 php 中使用 OpenSSL 签名和验证数据的信息和示例，请参阅[openssl_sign](http://us3.php.net/manual/en/function.openssl-sign.php)和[openssl_verify ：](http://us3.php.net/manual/en/function.openssl-verify.php)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T21:24:18.580

您可以使用`[crypt()](http://us.php.net/crypt)`、`[hash()](http://uk3.php.net/manual/en/function.hash.php)`或`[md5()](http://uk3.php.net/manual/en/function.md5.php)`。

编辑：我不介意投反对票。看看其他答案的复杂性，我一定误解了这个问题。但是，如果人们会在他们的投票中附上评论，这样我至少知道我的回答有什么问题，那就太好了。

我从这个问题中了解到，提问者想要实现类似的东西：

```
function genKey($q, $seed) {
  // assuming $seed is a properly formatted md5/sha salt
  return crypt($q, $seed);
}

function checkKey($p, $q, $seed) {
  return ($p == genKey($q, $seed));
} 
```

我认为 PHP 的任何一种单向加密功能都可以用来实现这一点是错误的吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T22:18:42.600

你可以尝试这样的事情：

```
$p = genKey($q,rand());
checkKey($p,$q) == true;

function genkey($q,$seed)
{
    if(array_search($_SESSION['seeds'],$seed) === FALSE)
    {
        $_SESSION['seeds'][] = $seed;
    }
    return hash("sha512", $q . $seed);
}

function checkKey($p,$q)
{
    $returnVal = false;
    foreach($_SESSION['seeds'] AS $s)
    {
        if(hash("sha512", $q . $s) == $p)
        {
            $returnVal = true;
            break;
        }
    }
    return $returnVal;
} 
```

当然，我会推荐其他东西来存储有效种子，但这只是一个概念证明。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T01:24:53.150

好的，您指的是**公钥密码学**的原理，特别是创建签名。它遵循复杂的数学原理（您必须实施）。

在基本的 RSA 签名中，您可以通过应用以下数学来创建签名**s ：**

```
s = m^d % n 
```

其中**m**是消息（或字符串 q ），**d**是私钥，**n**是模数（在私钥和公钥之间共享）。

然后可以通过这个数学来验证：

```
 m = s^e % n 
```

其中**e**是公钥。

当然，必须按照特定的数学标准生成密钥才能正常工作。有时钥匙会变得非常大。同样，所有这些都是通过整数完成的，因此您必须将文本转换为十进制并返回。

有关更多信息和更多数学知识，请查看[此页面。](http://www.di-mgt.com.au/rsa_alg.html)

**编辑：** 我想我应该提一下为什么要使用公钥密码术。基本上，它可以防止两件事：消息是可验证的并且不能被伪造。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T21:24:41.497

检查方能否获得种子？如果种子可以在检查方面保持安全（例如在 Web 应用程序上），您可以轻松地使用 MD5 执行 HTTP Digest 身份验证等操作。

伪代码：

```
 function genKey(q) {
      p = md5sum(q . ':' . seed);
      return p;
   }

   function checkKey(p,q) {
      return md5sum(q . ':' . seed) == p;
   } 
```

如果您需要第二方来验证“签名”，那么您可能只想使用 PKI。

# php - 如何将 BitmapData 对象直接上传到我的服务器？

> ID：762226
> 
> 赞同：5
> 
> 时间：2009-04-17T21:11:41.963
> 
> 标签：php, xml, flash, actionscript-3, http

我希望从我的 Flash 应用程序 (AS3) 上传到 imageshacks XML API。我想知道我该怎么做。

“在 Flash 中，我们必须使用 UrlRequest 和 UrlLoader 类发布数据，但是我们遇到了 Flash API 的限制。UrlRequest 的数据属性可以是 UrlVariablesByteArray 对象。没有简单的方法来发送名称值对以及 JPG 字节数组。这是一个大问题，因为大多数上传应用程序都需要文件名和其他标题来伴随原始文件数据“

我希望有人可以帮助我克服上述问题！

谢谢大家

## 更新

我在这里尝试使用本教程：http: [//www.mikestead.co.uk/2009/01/04/upload-multiple-files-with-a-single-request-in-flash/](http://www.mikestead.co.uk/2009/01/04/upload-multiple-files-with-a-single-request-in-flash/)

问题是它不是用于未保存的图像，而是从您的本地计算机获取图像，然后将其上传到图像已经有名称的服务器！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-23T17:12:41.057

这对我很有帮助：http: [//kitchen.braitsch.io/upload-bitmapdata-snapshot-to-server-in-as3/](http://kitchen.braitsch.io/upload-bitmapdata-snapshot-to-server-in-as3/)

您需要修改 URLRequestWrapper 以在需要的地方插入字段名和文件名。这是我所做的：

```
bytes = 'Content-Disposition: form-data; name="' + $fieldName + '"; filename="'; 
```

它对标头进行了最多的格式化，因此服务器可以将其理解为文件上传。

顺便说一句，如果您有 BitmapData，您可能需要先将其编码为 JPEG 或 PNG。

问候，阿尔乔姆

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T06:46:06.140

您可以将您的文件名数据和您想要的任何其他数据与 URLRequest 一起发送：

```
var params:URLVariables = new URLVariables();
params.id = ride.id;
params.filename = ride.map_image;
params.path = 'maps/';
var req:URLRequest = new URLRequest( ModelLocator.SERVER_URL + "/php/uploadpic.php");
req.method = URLRequestMethod.GET;
req.data = params;
fileRef.upload(req); 
```

在 php 的服务器端，您可以通过以下方式访问额外的变量： $_REQUEST['path'] 和 $_REQUEST['filename'] 等

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T20:05:27.813

我没有使用 imageshack API，但您可能想尝试使用 adobe 的 JPGEncoder 类 - 这是一个传递用户名和 JPG 字节数组的快速示例，它非常简单。

```
private function savePicToServer(bmpData:BitmapData):void
{
    var jpgEncoder:JPGEncoder = new JPGEncoder(85);
    var jpgStream:ByteArray = jpgEncoder.encode(bmpData);

    var loader:URLLoader = new URLLoader();
        configureListeners(loader);

    var header:URLRequestHeader = new URLRequestHeader("Content-type", "application/octet-stream");
    var request:URLRequest = new URLRequest(ModelLocator.BASE_URL + ModelLocator.UPLOAD_URL + "?user=" + ModelLocator.getInstance().username);
    request.requestHeaders.push(header);
    request.method = URLRequestMethod.POST;
    request.data = jpgStream;
    loader.load(request);
} 
```

请注意，变量作为查询字符串的一部分传递。你不能像几个人建议的那样使用 URLVariables，因为 URLVariables 将存储在请求的 data 属性中，我们已经使用它来传递 byteArray。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T12:53:32.227

无论如何，我并没有真正得到问题的问题：如果问题是如何从闪存发送文件的名称和扩展名（图像类型）以及图像数据的 byteArray，您应该使用 URLVariables 对象。

该对象还可以将查询字符串作为字节而不是文本发送。

```
var request:URLRequest = new URLRequest();
request.url = "your_server_page_for_example.php";
request.method = URLRequestMethod.POST;

var variables:URLVariables = new URLVariables();
variables.name = "imgName";
variables.type = ".jpg";
variables.image = myByteArray;

request.data = variables; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-23T12:26:03.577

您可以使用 URLVariables，只是 base64 编码字节数组，所以它不是二进制数据：

```
import mx.utils.Base64Encoder;
// ...
var urlRequest:URLRequest = new URLRequest("/whatever");
urlRequest.method = URLRequestMethod.POST;
var urlVariables:URLVariables = new URLVariables();
var base64Encoder:Base64Encoder = new Base64Encoder();
base64Encoder.encodeBytes(byteArray);
urlVariables.something_base64 = base64Encoder.toString();
urlRequest.data = urlVariables;
navigateToURL(urlRequest, "_blank"); 
```

然后在服务器端 base64decode '' post 字段，即：

php:

```
base64_decode($_POST['something_base64']) 
```

导轨：

```
require 'base64';
# ...
Base64.decode64(params[:something_base64]) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-25T06:37:16.283

对于所有在这里寻找upload.php 的php 实现的人，只需我的2 美分。如果您尝试过 HTTP_RAW_POST_DATA 但没有成功，请尝试 file_get_contents("php://input");

它对我有用

```
$data = file_get_contents("php://input");
file_put_contents("filename",$data); 
```

# c# - 具有重叠匹配的多行正则表达式

> ID：762229
> 
> 赞同：1
> 
> 时间：2009-04-17T21:12:25.237
> 
> 标签：c#, .net, css, regex

我正在开发一种工具来解析 CSS 样式声明的文件。它使用了一个非常复杂的正则表达式，除了预期的性能问题和一些暂时不影响我的小错误之外，它正在做我想做的所有事情，除了一件事。

我让它匹配元素名称、类、子类、伪类等的所有组合。但是，当一行包含多个声明时，我只能让它匹配一次。举个例子，这就是现在让我绊倒的事情：

```
td.class1, td.class2, td.class3
{
    background-color: #FAFAFA;
    height: 10px;
} 
```

我可以编写一个满足所有三个声明的表达式，但由于我还在它后面捕获信息（括号内的实际样式信息），我觉得这整个文本块都被认为是考虑在内的，所以引擎移动到刚刚处理的整个块之后的下一个字符。

有没有办法做到这一点，每个类都将是一个单独的匹配项，并且所有类都将包含以下样式信息？我知道我可以修改我的正则表达式以匹配整行，然后在我得到匹配后将其解析为逗号，但如果可能的话，我想将我的所有逻辑保留在表达式本身中。

如果表达式和/或我用来生成它的注释代码与答案绝对相关，我可以发布它，但是表达式很大/丑陋（就像所有重要的正则表达式一样）并且代码有点冗长。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T21:24:24.180

你需要一个 CSS 解析器，而不是一个正则表达式。您可能应该阅读[Is there a CSS Parser for C#](https://stackoverflow.com/questions/512720/is-there-a-css-parser-for-c)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T06:04:29.127

这是一个适用于您的示例数据的正则表达式：

```
@"([^,{}\s]+(?:\s+[^,{}\s]+)*)(?=[^{}]*(\{[^{}]+\}))" 
```

第一部分匹配并捕获组 #1 中的选择器 (td.class1)，然后前瞻跳过任何剩余的选择器并捕获组 #2 中的关联样式规则。下一次匹配尝试从前一次开始的地方开始，因此它匹配下一个选择器 (td.class2)，并且前瞻再次捕获相同的规则块。

这不会处理 @-rules 或评论，但它适用于您提供的示例数据。我什至在一些真实世界的样式表上检查了它，它做得非常好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T21:16:48.957

根据您的正则表达式引擎的细微差别，您可以通过在前瞻中嵌入捕获括号来做到这一点，例如：

```
\.(\w+)(?=.*?{([^}]*)}) 
```

我希望弄清楚匹配组的含义是一项相当大的练习。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T04:18:56.820

这对正则表达式来说不是一个好问题。

另一方面，你只需要通过几次就可以编写一个基本的 CSS 解析器，当然。

CSS语法毕竟只是[一些东西]，[打开花括号]，[一些其他东西]，[关闭花括号]。

你找到这两块东西，你把第一个用逗号分开，第二个用分号分开，你就大功告成了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-18T18:26:53.877

我需要对 AmbroseChapel 所说的持有类似的观点，并且我在 AS3 中需要它，所以我分享它以防它帮助其他人。我试图做到彻底，评论将引导您完成整个过程。我已经在一些流行的 CSS 样板中对其进行了测试，并且效果很好。:) （这仅用于列出选择器名称，而不用于属性解析。）

```
 public function getSelectors( targetCSS:String, includeElements:Boolean = true ):ArrayCollection
    {

        var newSelectorCollection:ArrayCollection = new ArrayCollection();

        if( targetCSS == null || targetCSS == "" ) return newSelectorCollection;

        var newSelectors:Array = new Array();

        var elements:Array = new Array();
        var ids:Array = new Array();
        var classes:Array = new Array();

        // Remove comments
        var cssString:String = "";
        var commentParts:Array = targetCSS.split( "/*" );

        for( var c:int = 0; c < commentParts.length; c++ ){

            var comPart:String = commentParts[ c ] as String;

            var comTestArray:Array = comPart.split( "*/" );

            if( comTestArray.length > 1 ){

                comTestArray.shift();
                comPart = comTestArray.join( "" );

            }

            cssString += comPart;

        }

        // Remove \n
        cssString = cssString.split( "\n" ).join( "" );
        // Remove \t
        cssString = cssString.split( "\t" ).join( "" );
        // Split at }
        var cssParts:Array = cssString.split( "}" );

        for( var i:int = 0; i < cssParts.length; i++ ){

            var cssPrt:String = cssParts[ i ] as String;

            // Detect nesting such as media queries by finding more than one {
            var nestingTestArray:Array = cssPrt.split( "{" );

            // If there is nesting split at { then drop index 0 and re-join with {
            if( nestingTestArray.length > 2 ){

                nestingTestArray.shift();
                cssPrt = nestingTestArray.join( "{" );

            }

            // Split at each item at {
            var cssPrtArray:Array = cssPrt.split( "{" );

            // Disregard anything after {
            cssPrt = cssPrtArray[ 0 ] as String;

            // Split at ,
            var selectorList:Array = cssPrt.split( "," );

            for( var j:int = 0; j < selectorList.length; j++ ){

                var sel:String = selectorList[ j ] as String;

                // Split at : and only keep index 0
                var pseudoParts:Array = sel.split( ":" );

                sel = pseudoParts[ 0 ] as String;

                // Split at [ and only keep index 0
                var attrQuryParts:Array = sel.split( "[" );

                sel = attrQuryParts[ 0 ] as String;

                // Split at spaces
                var selectorNames:Array = sel.split( " " );

                for( var k:int = 0; k < selectorNames.length; k++ ){

                    var selName:String = selectorNames[ k ] as String;

                    if( selName == null || selName == "" ){

                        continue;

                    }

                    // Check for direct class applications such as p.class-name
                    var selDotIndex:int = selName.indexOf( ".", 1 );
                    if( selDotIndex != -1 ){

                        // Add the extra classes
                        var dotParts:Array = selName.split( "." );

                        for( var d:int = 0; d < dotParts.length; d++ ){

                            var dotPrt:String = dotParts[ d ] as String;

                            if( d > 0 ){

                                dotPrt = "." + dotPrt;

                                if( d == 1 && selName.indexOf( "." ) === 0 ){

                                    selName = dotPrt;

                                }else{

                                    selectorNames.push( dotPrt );

                                }

                            }else{

                                if( dotPrt != "" ){

                                    selName = dotPrt;

                                }

                            }

                        }

                    }

                    // Only add unique items
                    if( newSelectors.indexOf( selName ) == -1 ){

                        // Avoid @ prefix && avoid *
                        if( selName.charAt( 0 ) != "@" && selName != "*" ){

                            newSelectors.push( selName );

                            switch( selName.charAt( 0 ) ){

                                case ".":
                                    classes.push( selName );
                                    break;

                                case "#":
                                    ids.push( selName );
                                    break;

                                default:
                                    elements.push( selName );
                                    break;

                            }

                        }

                    }

                }

            }

        }

        if( includeElements ){

            newSelectorCollection.source = elements.sort().concat( ids.sort().concat( classes.sort() ) );

        }else{

            newSelectorCollection.source = ids.sort().concat( classes.sort() );

        }

        return newSelectorCollection;

    } 
```

# open-source - 网络蜘蛛与 Wget 的蜘蛛有何不同？

> ID：762235
> 
> 赞同：7
> 
> 时间：2009-04-17T21:14:49.490
> 
> 标签：open-source, wget, web-crawler

下一句在 Wget 的手册中引起了我的注意

```
wget --spider --force-html -i bookmarks.html

This feature needs much more work for Wget to get close to the functionality of real web spiders. 
```

我发现以下与 wget 中的蜘蛛选项相关的代码行。

```
src/ftp.c
780:      /* If we're in spider mode, don't really retrieve anything.  The
784:      if (opt.spider)
889:  if (!(cmd & (DO_LIST | DO_RETR)) || (opt.spider && !(cmd & DO_LIST)))
1227:      if (!opt.spider)
1239:      if (!opt.spider)
1268:      else if (!opt.spider)
1827:          if (opt.htmlify && !opt.spider)

src/http.c
64:#include "spider.h"
2405:  /* Skip preliminary HEAD request if we're not in spider mode AND
2407:  if (!opt.spider
2428:      if (opt.spider && !got_head)
2456:      /* Default document type is empty.  However, if spider mode is
2570:           * spider mode.  */
2571:          else if (opt.spider)
2661:              if (opt.spider)

src/res.c
543:  int saved_sp_val = opt.spider;
548:  opt.spider       = false;
551:  opt.spider       = saved_sp_val;  

src/spider.c
1:/* Keep track of visited URLs in spider mode.
37:#include "spider.h"
49:spider_cleanup (void)

src/spider.h
1:/* Declarations for spider.c

src/recur.c
52:#include "spider.h"
279:      if (opt.spider)
366:              || opt.spider /* opt.recursive is implicitely true */
370:             (otherwise unneeded because of --spider or rejected by -R) 
375:                   (opt.spider ? "--spider" : 
378:                     (opt.delete_after || opt.spider
440:      if (opt.spider) 

src/options.h
62:  bool spider;           /* Is Wget in spider mode? */

src/init.c
238:  { "spider",           &opt.spider,            cmd_boolean },

src/main.c
56:#include "spider.h"
238:    { "spider", 0, OPT_BOOLEAN, "spider", -1 },
435:       --spider                  don't download anything.\n"),
1045:  if (opt.recursive && opt.spider) 
```

我想看看代码的差异，而不是抽象的。我喜欢代码示例。

**网络蜘蛛**在代码中与 Wget 的蜘蛛有何不同？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-05-12T12:47:11.703

**真正的蜘蛛需要大量的工作**

为整个 WWW 编写蜘蛛是一项艰巨的任务 --- 你必须注意许多“小细节”，例如：

*   每台蜘蛛计算机应该从几千台服务器并行接收数据，以有效利用连接带宽。（异步套接字 i/o）。
*   您需要多台并行蜘蛛的计算机，以覆盖 WWW 上的大量信息（集群；划分工作）
*   您需要对蜘蛛网站有礼貌：
    *   尊重 robots.txt 文件。
    *   不要太快地获取大量信息：这会使服务器过载。
    *   不要获取您真正不需要的文件（例如 iso 磁盘映像；用于软件下载的 tgz 包...）。
*   您必须处理 cookie/会话 ID：许多站点将唯一的会话 ID 附加到 URL 以识别客户端会话。每次您到达该站点时，您都​​会获得一个新的会话 ID 和一个新的页面虚拟世界（具有相同的内容）。由于这些问题，早期的搜索引擎忽略了动态内容。现代搜索引擎已经了解了问题所在以及如何处理这些问题。
*   您必须检测并忽略麻烦的数据：提供看似无限量数据的连接或太慢而无法完成的连接。
*   除了以下链接之外，您可能还需要解析[站点地图](http://en.wikipedia.org/wiki/Sitemaps)以获取页面的 URL。
*   您可能想评估哪些信息对您很重要，哪些信息会经常更改以比其他页面更频繁地刷新。注意：整个 WWW 的蜘蛛会接收大量数据——您需要为带宽付费。您可能想使用 HTTP HEAD 请求来猜测页面是否已更改。
*   除了接收之外，您还想处理信息并存储它。Google 建立索引，为每个单词列出包含它的页面。您可能需要单独的存储计算机和连接它们的基础设施。传统的关系数据库无法满足存储/索引整个 WWW 的数据量和性能要求。

这是很多工作。但是如果你的目标比阅读整个 WWW 更谦虚，你可能会跳过一些部分。如果您只是想下载 wiki 等的副本，请参阅 wget 的规范。

注意：如果您不相信它的工作量很大，您可能想了解 Google 如何重新发明大多数计算轮（在基本 Linux 内核之上）以构建好的蜘蛛。即使你偷工减料，也是很多工作。

让我在三点上添加一些技术性评论

**并行连接/异步套接字通信**

您可以在并行进程或线程中运行多个蜘蛛程序。但是您需要大约 5000-10000 个并行连接才能充分利用您的网络连接。而且这个数量的并行进程/线程会产生太多的开销。

更好的解决方案是异步输入/输出：在一个线程中处理大约 1000 个并行连接，方法是在非阻塞模式下打开套接字，并使用 epoll 或 select 来处理那些已经接收到数据的连接。自 Linux 内核 2.4 以来，Linux 对可扩展性的出色支持（我也建议您研究内存映射文件）在以后的版本中不断改进。

注意：使用异步 i/o 比使用“快速语言”更有帮助：最好为 1000 个用 Perl 编写的连接编写一个 epoll 驱动的进程，而不是运行用 C 编写的 1000 个进程。如果你做得对，你可以用 perl 编写的进程使 100Mb 连接饱和。

**从最初的答案来看：** 这种方法的缺点是您必须自己以异步形式实现 HTTP 规范（我不知道有一个可重用的库可以做到这一点）。使用更简单的 HTTP/1.0 协议比现代 HTTP/1.1 协议更容易做到这一点。无论如何，您可能不会从普通浏览器的 HTTP/1.1 的优势中受益，因此这可能是节省一些开发成本的好地方。

**五年后编辑：** 今天，有很多免费/开源技术可以帮助您完成这项工作。[我个人喜欢node.js](https://stackoverflow.com/questions/tagged/node.js)的异步[http 实现](http://nodejs.org/api/http.html)--- 它为您节省了上面原始段落中提到的所有工作。当然，今天还有很多模块可供您在蜘蛛中需要的其他组件使用。但是请注意，第三方模块的质量可能会有很大差异。你必须检查你使用的任何东西。**[老化信息：]****最近，我使用 node.js 编写了一个爬虫，我发现用于链接和数据提取的 HTML 处理的 npm 模块的可靠性不足。对于这项工作，我将此处理“外包”给用另一种编程语言编写的流程。但是事情正在迅速变化，当您阅读此评论时，这个问题可能已经成为过去......**

 ****将工作分配到多台服务器上**

一台计算机无法跟上整个 WWW 的蜘蛛网。您需要将您的工作分布在多个服务器上并在它们之间交换信息。我建议为每台服务器分配特定的“域名范围”：保留一个域名的中央数据库，并参考蜘蛛计算机。

从接收到的网页中批量提取URL：按照域名排序；删除重复项并将它们发送到负责的蜘蛛计算机。在该计算机上，保留已获取的 URL 的索引并获取剩余的 URL。

如果您在每台蜘蛛计算机上保留等待获取的 URL 队列，您将不会遇到性能瓶颈。但是要实现这一点需要大量的编程。

**阅读标准**

我提到了几个标准（HTTP/1.x、Robots.txt、Cookies）。花点时间阅读并实施它们。如果您只遵循您知道的网站示例，您将犯错误（忘记与您的示例无关的部分标准）并给使用这些附加功能的网站带来麻烦。

阅读 HTTP/1.1 标准文档很痛苦。但是所有的小细节都被添加到其中，因为有人真的需要这些小细节并且现在使用它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T21:34:40.207

我不确定评论的原作者到底指的是什么，但我可以猜到 wget 像蜘蛛一样慢，因为它似乎只使用一个执行线程（至少根据你所显示的）。

像[heritrix](http://crawler.archive.org/)这样的“真实”蜘蛛使用大量并行性和技巧来优化它们的爬行速度，同时对它们正在爬行的网站也很友好。这通常意味着以每秒 1 次（左右）的速度限制对一个网站的点击，并同时抓取多个网站。

同样，这只是基于我对蜘蛛的一般了解以及您在此处发布的内容的猜测。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T17:06:40.867

不幸的是，许多更知名的“真实”网络蜘蛛都是封闭源代码的，实际上是封闭的二进制文件。但是，wget 缺少许多基本技术：

*   并行性；如果不一次检索多个页面，您将永远无法跟上整个网络的步伐
*   优先级；某些页面对蜘蛛来说比其他页面更重要
*   速率限制；如果您继续尽可能快地拉下页面，您将很快被禁止
*   保存到本地文件系统以外的其他地方；网络足够大，它不适合单个目录树
*   定期重新检查页面而不重新启动整个过程；在实践中，使用真正的蜘蛛，您会想要频繁地重新检查“重要”页面的更新，而不太有趣的页面可能会持续数月。

还可以使用各种其他输入，例如站点地图等。重点是，wget 的设计初衷不是为了爬取整个网络，而且它也不是一个可以在小代码示例中捕获的东西，因为它是使用整个技术的问题，而不是任何单个小子程序出错为任务。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T20:09:51.310

我不会详细介绍如何爬取互联网，我认为 wget 评论是关于爬取一个网站，这仍然是一个严峻的挑战。

*   作为蜘蛛，您需要弄清楚何时停止，而不是仅仅因为 URL 更改为 date=1/1/1900 到 1/2/1900 等而进行递归爬网
*   解决 URL 重写的更大挑战（我不知道谷歌或任何其他人如何处理这个问题）。爬行足够但不是太多是相当大的挑战。以及如何通过一些随机参数和内容的随机变化自动识别 URL Rewrite？
*   您至少需要在一定程度上解析 Flash / Javascript
*   您需要考虑一些疯狂的 HTTP 问题，例如*基本*标记。考虑到大多数网站都不是 XHTML 并且浏览器的语法非常灵活，即使解析 HTML 也不容易。

我不知道在 wget 中实现或考虑了多少，但您可能想看看 httrack 以了解此任务的挑战。

我很乐意给你一些代码示例，但这是一项艰巨的任务，*如果没有 3rd 方库*，一个体面的蜘蛛将大约 5000 loc 。

*+ 其中一些已经由@yaakov-belch 解释过，所以我不会再输入它们了*

# wcf - ClientCredentialType=Windows 和 =Ntlm 之间的区别

> ID：762239
> 
> 赞同：11
> 
> 时间：2009-04-17T21:15:26.433
> 
> 标签：wcf, visual-studio-2005, cassini

任何人都可以清楚地解释使用之间的区别

*   `clientCredentialType=Windows`， 和
*   `clientCredentialType=Ntlm`

在托管 WCF 服务时在服务器端 Web.config 中？

我有一个`basicHttpBinding`用于与现有客户端互操作的 SOAP 1.1 ( ) 服务。它使用 ASP.NET 角色，因此需要对客户端进行身份验证。

当我使用VS2005（Cassini）服务器托管服务时，我必须`ClientCredentialType=Ntlm`如上所述指定，并在VS2005的项目属性中选中**Ntlm**身份验证框。 `ClientCredentialType=Windows`不起作用 - 客户得到：

> 401 未经授权的错误

但是，当我在 IIS 下运行时，情况正好相反：`ClientCredentialType=Windows`工作正常，但`ClientCredentialType=Ntlm`失败。

谁能解释一下，最好建议一种方法，我可以使用相同的 web.config 文件在 Cassini 和 IIS 中运行服务？

**更新**

我的开发机器上有 .NET 3.5 SP1，它是在域中运行的 XP SP2。因此，Cassini 在域帐户下运行，而 IIS 5.1 在本地帐户下运行。

我想知道这是否与这些文章中描述的 .NET 3.5SP1 中的重大变化有关。

[http://www.aspnetpro.com/newsletterarticle/2008/12/asp200812ab_l/asp200812ab_l.asp](http://www.aspnetpro.com/newsletterarticle/2008/12/asp200812ab_l/asp200812ab_l.asp) [http://msmvps.com/blogs/alvin/archive/2008/11/14/net-3-5-sp1-break -change-to-wcf.aspx](http://msmvps.com/blogs/alvin/archive/2008/11/14/net-3-5-sp1-breaking-change-to-wcf.aspx) [http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=354236](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=354236)

当服务器在域帐户下运行（这是我使用 Cassini 的情况 - 作为我的普通域用户帐户运行）时，情况听起来类似于`clientCredentialType=Windows`失败，并且在本地帐户下运行时工作（这是我使用 IIS 的情况）。

问题是建议的修复需要更改 WCF 客户端配置文件 - 但在我的情况下，我将 SOAP 1.1 ( `basicHttpBinding`) 与非 WCF 客户端一起使用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T22:00:25.437

clientCredentialType=Windows 使用内置的 Windows 身份验证，可以通过 Active Directory 和 NTLM。

显然，NTLM 类型只会使用 NTLM 进行身份验证。

我确定您已经看过它，但这里是 WCF 安全性的链接：http: [//msdn2.microsoft.com/en-us/library/ms734769.aspx](http://msdn2.microsoft.com/en-us/library/ms734769.aspx)

有关您的设置的更多详细信息会有所帮助。IIS 和 Cassini 服务器是否在同一个机器上运行？如果没有，您是否在每个盒子上设置了相同的帐户？默认情况下，IIS6 支持 NTLM，所以让它工作应该没有问题。

# c# - ASP.NET Store上传文件sql server表

> ID：762240
> 
> 赞同：3
> 
> 时间：2009-04-17T21:15:58.193
> 
> 标签：c#, asp.net, sql-server, sql-server-2005, varbinary

如何将 ASP.net 网络表单上传的文件存储到 sql server 2005 varbinary(max) 字段中？

这是我到目前为止所拥有的：

```
protected void btnUpload_Click(object sender, EventArgs e)
{
    for (int i = 0; i < Request.Files.Count; i++)
    {
        StoreFile(Request.Files[i]);
    }
}

private void StoreFile(HttpPostedFile file)
{
    // what do i do now?
} 
```

一个简单的旧 ado.net 示例会很好。linq to sql 示例也是如此。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T21:41:50.910

关于如何将文件直接上传到[4GuysFromRolla的数据库中有很好的教程](http://www.4guysfromrolla.com/articles/120606-1.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T14:10:24.793

以下是我使用 Linq To Sql 执行此操作的方法：

```
FilesDataContext db = new FilesDataContext();

protected void btnUpload_Click(object sender, EventArgs e)
{
    for (int i = 0; i < Request.Files.Count; i++)
    {
        StoreFile(Request.Files[i]);
    }

    db.SubmitChanges();
}

private void StoreFile(HttpPostedFile file)
{
    byte[] data = new byte[file.ContentLength];
    file.InputStream.Read(data, 0, file.ContentLength);

    File f = new File();
    f.Data = data;
    f.Filename = file.FileName;
    db.Files.InsertOnSubmit(f);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T21:21:51.707

这通常被认为是不好的形式。它会使您的数据库膨胀，并且与将所有文件保存在硬盘驱动器文件夹中并仅将文件的位置存储在数据库中相比并没有真正提供任何优势。你确定你要这么做吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-26T00:02:53.390

这是对 Ronnie 答案的快速重构：

```
Public Shared Sub SaveUploadedFile(File As HttpPostedFile)
  Dim oFile As Db.File

  oFile = New Db.File
  oFile.Data = File.ToBytes
End Sub

<Extension()>
Public Function ToBytes(File As HttpPostedFile) As Byte()
  ToBytes = New Byte(File.ContentLength - 1) {}

  Using oStream As Stream = File.InputStream
    oStream.Read(ToBytes, 0, File.ContentLength)
  End Using
End Function 
```

高温高压

# sql - 访问查询 (SQL) 以返回按 WEEKS 排序（分组）的记录

> ID：762242
> 
> 赞同：1
> 
> 时间：2009-04-17T21:17:05.320
> 
> 标签：sql, ms-access

问候 SQL 大师，

我不知道你能不能帮助我，但我会努力的。我有几个按年份分组的大型数据库（每年都在不同的数据库中）。我希望能够比较从一年到下一年的特定一周的值。例如，“显示 2008 年第 17 周与 2002 年第 17 周的对比”。

我有以下理想情况下我会使用的周定义：

1.  每年只有 52 周，每周 7 天（只需要 364 天），
2.  第一周的第一天从 1 月 2 日开始 - 这意味着我们不使用 1 月 1 日的数据，并且
3.  在闰年，第一周的第一天也从 1 月 2 日开始加上我们跳过 2 月 29 日。

有任何想法吗？

提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-17T22:11:21.913

最好避免创建表，因为您必须更新和维护它才能使查询正常工作。

`DatePart('ww',[myDate])`会给你周数。在决定哪一周属于哪一年时，您可能会遇到一些问题 - 例如，如果 2003 年 1 月 1 日是星期三，那么该周属于 2002 年的第 52 周还是 2003 年的第 1 周？您的会计部门将在一周中的某一天作为您的周末（通常是星期六）。我通常只选择其中天数最多的一年。DatePart 将始终将第一周计为 1，在上面的示例中，最后一周计为 53。无论哪种方式，您都可能不太在意。您可以为每年创建查询

```
SELECT DatePart('ww',[myDate]) as WeekNumber,myYearTable.* as WeekNumber 
FROM myYearTable 
```

然后加入查询以获取您的数据。如果一张桌子有 52 周，而另一张桌子有 53 周（大多数将显示为 53），那么您将在今年年底放松几天。或者你可以在周末之前完成——这总是给你星期六，这会将一周的晚些时候推到下一年。

```
(7-Weekday([myDate]))+[myDate] 
```

然后

```
DatePart('ww',(7-Weekday([myDate]))+[myDate]) 
```

希望有帮助

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T21:24:17.020

获取周数

```
 'to get the week number in the year
 select datepart( week, datefield)

 'to get the week number in the month
 select (datepart(dd,datefield) -1 ) / 7 + 1 
```

您不需要考虑闰年等问题。只需比较周一和周日的周数

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T21:26:56.687

由于您对一周开始时间的具体定义与数据库使用的标准不同，因此我认为周表可以解决您的问题。为每一年创建一个表，定义每周包含的日期和周数。然后通过加入该表以及相关的其他表，您可以只请求第 17 周的数据。

```
Table structure
Date      Week
20090102   1
20090103   1 
```

等等

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-01-21T09:02:05.457

我需要创建一个同时显示年份和周数的查询，例如 2014-52。当您使用 Datepart() 公式将前一年的第 53 周转换为第 52 周时，年份显示正确，但显示错误的年份是之前的第 1 周，现在应该是第 52 周。它显示该周为 2015-52 而不是 2014-52。

此外，如果您只使用周数，它会对数据进行错误排序，例如：

2014-1,2014-11,2014-2

为了克服这个问题，我创建了以下查询来插入 0 并检查第 1 周中仍应低于第 52 周的天数。

```
ActualWeek: IIf(DatePart("ww",[SomeDate],1,3)=52 And DatePart("ww",[SomeDate])=1, DatePart("yyyy",[SomeDate],1,3)-1,DatePart("yyyy",[SomeDate],1,3)) & "-" & IIf(DatePart("ww",[SomeDate],1,3)<10,"0" & DatePart("ww",[SomeDate],1,3),DatePart("ww",[SomeDate],1,3)) 
```

# .net - 如何检索用户所属的所有角色（组）？

> ID：762245
> 
> 赞同：27
> 
> 时间：2009-04-17T21:18:04.087
> 
> 标签：.net, windows-identity, rbac, windows-principal

有没有办法在不通过方法明确检查的情况下获取 Windows 身份验证用户所在的角色列表`WindowsPrincipal.IsInRole`？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-04-17T21:39:56.530

`WindowsPrincipal.IsInRole`只检查用户是否是具有该名称的组的成员；Windows 组*是一个*角色。您可以从该`WindowsIdentity.Groups`属性中获取用户所属的组的列表。

你可以`WindowsIdentity`从你的`WindowsPrincipal`：

```
WindowsIdentity identity = WindowsPrincipal.Identity as WindowsIdentity; 
```

或者您可以从 WindowsIdentity 上的工厂方法中获取它：

```
WindowsIdentity identity = WindowsIdentity.GetCurrent(); 
```

`WindowsIdenity.Groups`是一个集合，`IdentityReference`它只为您提供组的 SID。如果您需要组名，则需要将其转换`IdentityReference`为 an`NTAccount`并获取值：

```
var groupNames = from id in identity.Groups
                 select id.Translate(typeof(NTAccount)).Value; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-17T21:41:53.873

编辑：乔什打败了我！:)

试试这个

```
using System;
using System.Security.Principal;

namespace ConsoleApplication5
{
    internal class Program
    {
        private static void Main(string[] args)
        {
            var identity = WindowsIdentity.GetCurrent();

            foreach (var groupId in identity.Groups)
            {
                var group = groupId.Translate(typeof (NTAccount));
                Console.WriteLine(group);
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-05-14T14:17:19.370

如果没有连接到域服务器，该`Translate`函数可能会抛出以下异常`The trust relationship between this workstation and the primary domain failed.`

但是对于大多数组来说，它会没问题，所以我使用：

```
foreach(var s in WindowsIdentity.GetCurrent().Groups) {
    try {
        IdentityReference grp = s.Translate(typeof (NTAccount)); 
        groups.Add(grp.Value);
    }
    catch(Exception) {  }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-09-15T14:20:00.913

在 ASP.NET MVC 站点中，您可以这样做：

将此添加到您的 Web.config：

```
<system.web>
  ...
  <roleManager enabled="true" defaultProvider="AspNetWindowsTokenRoleProvider" />
  ...
</system.web> 
```

然后，您可以使用`Roles.GetRolesForUser()`来获取用户所属的所有 Windows 组。确保你是`using System.Web.Security`.

# c# - 为什么我不能同时定义隐式和显式运算符？

> ID：762246
> 
> 赞同：33
> 
> 时间：2009-04-17T21:18:32.930
> 
> 标签：c#, operator-overloading

为什么我不能像这样定义隐式和显式运算符？

```
 public class C
    {
        public static implicit operator string(C c)
        {
            return "implicit";
        }

        public static explicit operator string(C c)
        {
            return "explicit";
        }
    } 
```

不过你可以做这个黑客:)

```
 class Program
    {
        public class A
        {

        }

        public class B
        {
            public static implicit operator A(B b)
            {
                Console.WriteLine("implicit");
                return new A();
            }
        }

        public class C : B
        {
            public static explicit operator A(C c)
            {
                Console.WriteLine("explicit");
                return new A();
            }
        }

        static void Main(string[] args)
        {
            C c = new C();

            A a = c;
            A b = (A) c;
        }
    } 
```

这打印：

```
implicit
explicit 
```

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2012-06-05T06:48:15.070

检查一下：[为什么不能在 C# 中同时存在相同类型的隐式和显式运算符？](https://stackoverflow.com/questions/10892278/why-cant-coexist-implicit-and-explicit-operator-of-the-same-type-in-c)

如果您定义一个显式运算符，您将能够执行以下操作：

```
Thing thing = (Thing)"value"; 
```

如果你定义了一个隐式操作符，你仍然可以做上面的事情，但你也可以利用隐式转换：

```
Thing thing = "value"; 
```

简而言之，显式只允许显式转换，而隐式允许显式和隐式转换......因此您只能定义一个。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-17T21:23:54.463

我不知道阻止这种情况的技术限制，但我认为他们会这样做以防止人们自爆。

```
string imp = new C(); // = "implicit"
string exp = (string)new C(); // = "explicit" 
```

那会让我发疯而且毫无意义，`C`应该只以一种方式转换为字符串，而不是两种不同的方式。

# design-patterns - Fowler 数据映射器对象创建

> ID：762252
> 
> 赞同：1
> 
> 时间：2009-04-17T21:23:21.077
> 
> 标签：design-patterns, orm, containers, datamapper, creation

我一直在将 Fowler 模式用于具有数据映射器的域模型，并且在如何实现 CRUD 的创建部分时遇到了一些困惑。我无法利用现有的 ORM 技术，因为底层数据源是自定义系统。困扰我的领域是当我需要创建一个新对象时如何调用底层 ORM。My Domain Layer 看不到我的 ORM，除了我的查找器。

我不确定我是否走在正确的轨道上，但以下是我能看到的唯一选项：

1.  以与 Fowler finder 相同的方式处理创建函数。在域模型层中为 ORM 类的创建方法创建一个接口。然后让领域模型调用一个 DI 容器，并根据接口实例化一个 ORM 类的实例。

2.  在 ORM 中对象 A 的水合期间，附加一个委托，该委托指向对象 B 的 ORM 上的创建方法。要求域对象 A 被水合，您可以调用对象 A 上的委托，这将调用对象 B 的映射器上的 create 方法。

3.  ？？？

我一定遗漏了一些东西，因为这不可能那么复杂。任何帮助将非常感激。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-04T19:02:58.433

看看 ORM 是如何解决这个问题的？在支持动态创建对象的语言中，数据如何与域对象相关的“映射”作为单独的配置提供。这些类是通过反射或字节码库创建的。我想这取决于您希望制作 Data Mapper 的通用程度。从我可以从原始模式中收集到的数据，每个域对象都可以存在数据映射器。

也许您正在尝试通用解决方案。否则，它可能是关于配置一个通用映射器，其中包含有关如何使用反射构建对象的信息。

也就是说，今天的 ORM 层可以处理代表 CanonicalClass 名称的字符串 + 期望在这些类上的方法列表。

传递要持久化的对象可以使用此信息检查对象。可以使用数据库中的数据使用反射来创建对象。一些 ORM 解决方案可能不会以深度方式创建对象树，而是为延迟获取创建代理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-04T19:08:34.613

如果您的问题只是从 Type A 映射到 Type B，您可能需要考虑[AutoMapper](http://www.codeplex.com/AutoMapper)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-22T11:31:24.043

回复：“当我需要创建一个新对象时如何调用底层 ORM”

您是否研究过 AGGREGATE ROOT 和 REPOSITORY 模式的想法 - 它们可能会有所帮助。

作为粗略的总结：AGGREGATE ROOT 是一个“实体”，在系统中具有全局唯一 ID。大多数时候，这些是您的应用程序需要“按 id”获取的唯一对象。它们是通过一个存储库找到的，该存储库通常被初始化以*了解*应用程序启动/引导时的数据层。

聚合根的工厂通常也被初始化以*了解*应用程序启动/引导时的数据层。

然后，存储库可以以它喜欢的任何方式调解为对象挖掘数据的过程。REPOSITORY 委托给数据层/映射器以获取原始数据，并倾向于将对象重构的实际工作委托给 FACTORY（类/方法）来进行构建。然后，REPOSITORY 返回新重构的 AGGREGATE ROOT 对象或（collection- of) 到调用 REPOSITORY 的 find 方法的客户端 - 即应用程序。REPOSITORY 是检索和保存 AGGREGATE ROOT 的接口，并给出了它们存储在内存中的行为。

但是，应用程序可能会直接使用 FACTORY 来创建全新的 AGGREGATE ROOT 对象。

AGGREGATE ROOT 的工厂对 ORM/Mapper 层有很好的了解，并且在创建一个全新的实体时，它可能会调用某种“数字序列对象”的服务来获取其唯一 ID。

聚合根通常是您需要“按全局已知 ID 查找”的唯一类型的域对象，因为任何其他域对象都是：

*   一次性价值对象 - 如货币价值，或
*   “聚合根依赖”实体。即具有仅在 AGGREGATE ROOT 上下文中唯一的 id 的对象，这意味着
    *   AGGREGATE ROOT 应该是唯一需要找到/使用它的东西 - 在内部
    *   可以使用 AGGREGATE ROOT 的 ORM Mapper 找到它们
    *   它们的 id 可以由定义其上下文/范围的 AGGREGATE ROOT 创建

延伸阅读：

参见领域驱动设计，Eric Evans。

聚合根： http: [//books.google.co.uk/books ?id=7dlaMs0SECsC&lpg=PP1&dq=domain%20driven%20design&pg=PA147#v=onepage&q=&f=false](http://books.google.co.uk/books?id=7dlaMs0SECsC&lpg=PP1&dq=domain%20driven%20design&pg=PA147#v=onepage&q=&f=false)

[存储库：http: //books.google.co.uk/books](http://books.google.co.uk/books?id=7dlaMs0SECsC&lpg=PP1&dq=domain%20driven%20design&pg=PA147#v=onepage&q=&f=false) ?id=7dlaMs0SECsC&lpg=PP1&dq=domain%20driven%20design&pg=PA147#v=onepage&q=&f=false

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-24T05:18:49.170

如果您在 .NET 上实现，正如 Richard 建议的那样，请查看[AutoMapper](http://automapper.codeplex.com/)。如果您使用 Java 实现，请查看[ModelMapper](http://modelmapper.org)。

# wpf - 在不按住 CTRL 的情况下单击 RichTextBox 中的超链接 - WPF

> ID：762271
> 
> 赞同：16
> 
> 时间：2009-04-17T21:28:30.240
> 
> 标签：wpf, richtextbox, click, hyperlink, ctrl

我有一个`isReadOnly`设置为`True`. 我希望用户能够单击 RichTextBox 中包含的超链接，而无需按住`Ctrl`.

除非被按住，否则 HyperLink 上的 Click 事件似乎不会触发`Ctrl`，所以我不确定如何继续。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2011-05-26T23:55:58.597

我找到了解决方案。将 IsDocumentEnabled 设置为“True”，并将 IsReadOnly 设置为“True”。

```
<RichTextBox IsReadOnly="True" IsDocumentEnabled="True" /> 
```

一旦我这样做了，当我将鼠标悬停在超链接标签中显示的文本上时，鼠标就会变成“手”。在不控制的情况下单击将触发“单击”事件。

我正在使用 .NET 4 中的 WPF。我不知道早期版本的 .NET 是否不能像我上面描述的那样运行。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2013-11-24T18:42:15.787

[JHubbard80](https://stackoverflow.com/users/772243/jhubbard80)的答案是一个可能的解决方案，如果您不需要选择内容，这是最简单的方法。

但是我需要 :P 这是我的方法：为 .s 中的 s 设置`Hyperlink`样式`RichTextBox`。本质是使用 a`EventSetter`使`Hyperlink`s 处理`MouseLeftButtonDown`事件。

```
<RichTextBox>
    <RichTextBox.Resources>
        <Style TargetType="Hyperlink">
            <Setter Property="Cursor" Value="Hand" />
            <EventSetter Event="MouseLeftButtonDown" Handler="Hyperlink_MouseLeftButtonDown" />
        </Style>
    </RichTextBox.Resources>
</RichTextBox> 
```

在代码隐藏中：

```
private void Hyperlink_MouseLeftButtonDown(object sender, MouseEventArgs e)
{
    var hyperlink = (Hyperlink)sender;
    Process.Start(hyperlink.NavigateUri.ToString());
} 
```

感谢[gcores](https://stackoverflow.com/users/40256/gcores)的启发。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-17T23:18:52.533

设法找到解决这个问题的方法，几乎​​是偶然的。

加载到我的 RichTextBox 中的内容只是作为纯字符串存储（或输入）。我对 RichTextBox 进行了子类化，以允许绑定它的 Document 属性。

与该问题相关的是，我有一个看起来像这样的 IValueConverter Convert() 重载（对解决方案非必要的代码已被删除）：

```
FlowDocument doc = new FlowDocument();
Paragraph graph = new Paragraph();

Hyperlink textLink = new Hyperlink(new Run(textSplit));
textLink.NavigateUri = new Uri(textSplit);
textLink.RequestNavigate += 
  new System.Windows.Navigation.RequestNavigateEventHandler(navHandler);

graph.Inlines.Add(textLink);
graph.Inlines.Add(new Run(nonLinkStrings));

doc.Blocks.Add(graph);

return doc; 
```

这让我得到了我想要的行为（将纯字符串推入 RichTextBox 并获取格式），它还导致链接的行为类似于普通链接，而不是嵌入在 Word 文档中的链接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-02-01T02:39:06.980

我从@hillin 的回答中更改了 EventSetter。 *MouseLeftButtonDown*在我的代码（.Net 框架 4.5.2）中不起作用。

```
<EventSetter Event="RequestNavigate" Handler="Hyperlink_RequestNavigate" /> 
```

```
private void Hyperlink_RequestNavigate(object sender, System.Windows.Navigation.RequestNavigateEventArgs e)
{
    Process.Start(e.Uri.ToString());
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T22:52:45.247

您是否尝试过处理 MouseLeftButtonDown 事件而不是 Click 事件？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-11-28T08:59:36.207

如果您想在*没有默认系统导航*的情况下始终将**箭头**变成**手形光标**，以下是方法。

 *```
<RichTextBox>
            <RichTextBox.Resources>
                <Style TargetType="{x:Type Hyperlink}">                                
                    <EventSetter Event="MouseEnter" Handler="Hyperlink_OnMouseEnter"/>
                </Style>                
            </RichTextBox.Resources>
</RichTextBox>

private void Hyperlink_OnMouseEnter(object sender, MouseEventArgs e)
        {
            var hyperlink = (Hyperlink)sender;
            hyperlink.ForceCursor = true;
            hyperlink.Cursor = Cursors.Hand;
        } 
```

# javascript - 如何同步多个 iframe 的滚动位置

> ID：762274
> 
> 赞同：16
> 
> 时间：2009-04-17T21:29:03.450
> 
> 标签：javascript, html, iframe

我有一个基于标签的 HTML 布局（比如 5）。在每个选项卡中，我加载一个 iframe。iframe 内容是彼此的变体，用户可以通过切换选项卡进行比较。

如何在 javascript 中同步所有 iframe 的垂直和水平滚动？换句话说，在一个 iframe 中滚动应该与所有其他 iframe 滚动相同的量，从而允许用户比较相同的数据。

加分项：iframe 内容仅在用户第一次打开选项卡时加载。所以新打开的 iframe 应该直接滚动到与已经打开的 iframe 相同的位置。

谢谢。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-17T21:36:45.773

虽然这适用于 div，但不适用于 iframe。

这是你可以做的，

```
$($('#iframe1').contents()).scroll(function(){
    $($('#iframe2').contents()).scrollTop($(this).scrollTop());
}); 
```

使用[jQuery 的滚动事件](http://docs.jquery.com/Events/scroll)，您应该能够同步它们。

**编辑**：不需要插件。这是对我有用的代码：

```
<html>
<head>
<SCRIPT language="javascript" type="text/javascript" src="jquery-1.3.2.js"></SCRIPT>
<SCRIPT>
$(document).ready(function()
{
$("#div1").scroll(function () { 
        $("#div2").scrollTop($("#div1").scrollTop());
        $("#div2").scrollLeft($("#div1").scrollLeft());
    });
$("#div2").scroll(function () { 
        $("#div1").scrollTop($("#div2").scrollTop());
        $("#div1").scrollLeft($("#div2").scrollLeft());
    });

});

</SCRIPT>
</head>
<body>
<div id="div1" style="overflow:auto;height:100px;width:200px;border:1px solid black;">
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
</div>

<div id="div2" style="overflow:auto;height:100px;width:200px;border:1px solid black;">
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
Test..................................................................................................................................................................................................................................................................................test
<BR/><BR/>
</div>

</body>
</html> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-17T21:37:11.887

我使用这样的代码同步溢出的 div：

```
frame1.onscroll = function(e) {
   frame2.scrollTop = frame1.scrollTop;
   frame2.scrollLeft = frame1.scrollLeft;
 }; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-04T12:44:09.547

仅当 div 具有相同的宽度时，可接受的解决方案才有效。如果不是，它会导致无限循环：#div1 滚动 #div2，然后 #div2 的滚动事件滚动 #div1 等 :)

编辑解决方案：

```
var skip = false;
$("#div1").scroll(function () {
    if (skip){skip=false; return;} else skip=true; 
    $("#div2").scrollTop($("#div1").scrollTop());
    $("#div2").scrollLeft($("#div1").scrollLeft());
});
$("#div2").scroll(function () { 
    $("#div1").scrollTop($("#div2").scrollTop());
    $("#div1").scrollLeft($("#div2").scrollLeft());
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-10-10T06:49:59.507

我认为这个答案可以修复无限循环。

```
 var jsScroll0;
      var jsScroll1;
      windows[0].on('scroll.scrollInTheSameTime', function() {
        if (jsScroll1 === true) {
          jsScroll1 = false;
          return;
        }
        jsScroll0 = true;
        windows[1].scrollTop(windows[0].scrollTop());
        windows[1].scrollLeft(windows[0].scrollLeft());
      });
      windows[1].on('scroll.scrollInTheSameTime', function() {
        if (jsScroll0 === true) {
          jsScroll0 = false;
          return;
        }
        jsScroll1 = true;
        windows[0].scrollTop(windows[1].scrollTop());
        windows[0].scrollLeft(windows[1].scrollLeft());
        // jsScroll = false;
      }); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-08-30T15:48:07.200

要同步任意数量的元素，请使用以下代码：

```
jQuery.fn.synchroniseScroll = function() {

        var elements = this;
        if (elements.length <= 1) return;

        elements.scroll(
        function() {
            var left = $(this).scrollLeft();
            var top = $(this).scrollTop();
            elements.each(
            function() {
                if ($(this).scrollLeft() != left) $(this).scrollLeft(left);
                if ($(this).scrollTop() != top) $(this).scrollTop(top);
            }
            );
        });
    } 
```

使用它非常简单。假设您有几个 div 定义为：

```
<div class=”scrollDiv” style=”overflow:auto;”&gt; .. some large content</div> 
```

要将所有 div 上的滚动条与 scrollDiv 类同步，您需要编写的是：

```
$(“.scrollDiv”).synchroniseScroll(); 
```

来源：http: [//blogs.msdn.com/b/matt/archive/2009/03/19/synchronizing-scrollbars-using-jquery.aspx](http://blogs.msdn.com/b/matt/archive/2009/03/19/synchronizing-scrollbars-using-jquery.aspx)

# vb.net - 如何在实体框架中添加多对多关系

> ID：762276
> 
> 赞同：1
> 
> 时间：2009-04-17T21:29:10.970
> 
> 标签：vb.net, entity-framework

我是新手。我已经能够在存在一对多关系的地方添加新实体。当关系使用多对多时，我在添加新实体时遇到问题（不知道该怎么做）。

在我的 EDM 中，我有：

1.  组织
    `<Scalar Properties>`
    _ Org_ID（身份字段）
    b. 组织名称
    c. OrgDesc
    `<Navigation Properties>`
    Building_orgs_Relation

2.  建筑物
    `<Scalar Properties>`
    a) Building_ID（身份字段）
    b) Building_Desc
    `<Navigation Properties>`
    Building_orgs_Relation

3.  Org_Building_Relation
    a) Building_org_ID（身份字段）
    b) Org_ID
    c) Building_ID
    `<Navigation Properties>`
    Building
    Org

我想要：

*   插入新组织
*   删除现有组织
*   将组织重新分配到不同的建筑物
*   更新组织

有人可以提供一个关于如何使用上述 EDM 进行操作的示例吗？VB代码将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T21:53:52.457

现在，实体框架在它可以处理的多对多关系方面确实受到限制。Visual Studio 设计人员唯一能识别的是一个只包含两列的表，这两个列都是其他两个表的外键，并且主键是两个外键上的复合键。

因此，如果您可以控制数据库架构，您可以做的一件事是更改 Org_Building_Relation 表以删除 Building_org_ID 列，并使主键成为 Org_ID 和 Building_ID 上的复合键。如果您这样做，那么当您映射表时，实体框架会将其识别为多对多关系。

如果您不能这样做（例如，您无法控制数据库模式），那么您需要确保您在 EDMX 中映射的唯一字段是与其他表相关的字段，并且你不映射主键。这很困难，因为映射向导会在您每次更新时丢弃并重新创建存储映射。

另一种选择是不在实体框架中使用“适当的”多对多映射，而是将关系视为另一个实体，而不是将其包含在关系中。

我不记得在即将发布的 .NET 4.0 中是否对此进行了改进。

# c# - 在 NUnit 测试期间的拆卸事件中，如何获取应用于刚刚测试的方法的属性？

> ID：762278
> 
> 赞同：3
> 
> 时间：2009-04-17T21:30:55.443
> 
> 标签：c#, nunit

我有一个正在运行的测试方法。当方法生成异常时，我想知道测试的名称和异常内容。

在测试的拆解中，我想访问这些信息。我如何从`[TearDown]`属性方法访问它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T21:39:49.587

我认为 nunit 没有内置的好方法，但这不是一个很难解决的问题。只需将测试包装在 try/catch 块中，捕获任何异常，并将它们（和测试名称）保存到测试类中的私有成员变量中。然后你就可以从你的 TearDown 方法中访问了。

不是特别优雅，但它确实有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-07-03T08:41:41.740

您可以在测试拆卸方法中访问文本上下文对象

```
[TearDown]
public void TestTearDown()
{
  // inc. class name
  var fullNameOfTheMethod = NUnit.Framework.TestContext.CurrentContext.Test.FullName; 
  // method name only
  var methodName = NUnit.Framework.TestContext.CurrentContext.Test.Name;
  // the state of the test execution
  var state = NUnit.Framework.TestContext.CurrentContext.Result.State; // TestState enum
} 
```

我不知道哪个版本最先支持它，但我的是 24。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-18T21:05:11.840

另一种解决方案是使用模板方法并使用此方法运行所有测试。例如：

```
// template method
void Execute(Action test)
{
    try
    {
        test();
    }
    catch (Exception e)
    {
        // handle exception here
        throw;
    }
}

[Test]
public void Test()
{
    Execute(() =>
        {
            // your test here
        });
} 
```

当您的测试使用一些必须在测试前初始化并在测试后处理的资源（例如临时文件）时，此模式特别有用。在这种情况下，您可以在测试委托中使用类型参数。

另一个优点是您可以轻松地让测试在不同的线程上运行，使用不同的文化等。

缺点很明显：它迫使您在每个测试中都使用 lambda 方法。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-17T21:38:57.187

**选项1：**我认为你不能。或者更确切地说，我不知道你可以。我如何满足这种需求是在特定测试上使用 try/catch，对异常执行我想要的操作，然后在 catch 块中再次抛出，以便测试可能失败。

```
try{
    // do something that can potentially throw;
}
catch(Exception ex){
    // do something interesting with the ex;
    throw;
} 
```

**选项 2：**如果您还没有走得太远，您可能想要使用 xUnit，它具有不同的异常预期模型，并且可以提供您正在寻找的一些控制。

# c# - WPF 数据访问层架构

> ID：762281
> 
> 赞同：3
> 
> 时间：2009-04-17T21:31:42.913
> 
> 标签：c#, wpf, web-services, linq-to-sql

我目前正在开发一个 WPF 客户端应用程序，它使用 Linq-to-SQL 来处理类型化的表对象，并在外部服务器上的 MS SQL 数据库中包装大量的 CRUD 存储过程。我没有预见到直接通过上下文操作数据，只有存储过程。

我最担心的两个问题是：1）数据库安全 2）灵活的架构

据我所知，由于该应用程序可以通过 Internet 轻松下载，因此不能在应用程序本身中存储数据库连接信息（出于安全原因）。我觉得我唯一的选择是将我的 DAL 放入 Web 服务中。

用户凭据可以在每个操作的基础上传递，并且数据库连接信息将安全地存储在安全的 Web 服务器上。

我很好奇这种方法是否有效，如果有效，是否最佳？我可以轻松地序列化 Linq-to-SQL 对象（表和存储过程结果）以在客户端和 Web 服务之间来回发送吗？

先感谢您。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T21:50:59.157

你是对的，如果你的应用程序是在互联网上使用的，你几乎必须在那里放置一个中间层。

如果您正在做的主要是 CRUD，我认为一个好主意是看看[ADO .Net Data Services](http://msdn.microsoft.com/en-us/data/bb931106.aspx)。这是一种通过 REST 接口公开数据的有效方式，并且您可以获得客户端库以在客户端以类型化的方式访问您的数据。

它支持通常的 ASP.Net 安全机制（例如表单身份验证、成员资格提供程序等），因此您可以根据用户的凭据保护您的访问点（为此，您可以使用可以处理身份验证的[客户端服务](http://msdn.microsoft.com/en-us/library/bb384297.aspx)在您的应用程序和服务器之间）。

希望这些指点有所帮助。

# c# - 在 IIS 上使用 C# 输出到控制台

> ID：762282
> 
> 赞同：2
> 
> 时间：2009-04-17T21:33:16.700
> 
> 标签：c#, iis, console

我们正在尝试调试我们在 IIS 上以 C# 运行的一些 Web 服务代码。我是 Windows 编程新手，不知道如何查看控制台的输出。我们在代码中有一些写语句，但我不知道如何在这个东西运行时查看控制台。帮助？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-17T21:43:06.413

我发现 Trace 功能非常有用。您可以通过以下方式到达： [http://mysiteurl/trace.axd](http://mysiteurl/trace.axd)

在您的 web.config 中，将以下内容放在 System.Web 标记中：

```
<trace enabled="true" 
       localOnly="false" 
       pageOutput="false" 
       requestLimit="500" 
       traceMode="SortByTime"
/> 
```

现在从您的代码后面，您可以通过执行以下操作注入一些日志记录：

```
HttpContext.Current.Trace.Warn("I Made It Here!"); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T21:40:36.763

你会想看看 ASP.NET 跟踪

这是一个方便的链接，可以帮助您入门：[http ://www.asp101.com/articles/robert/tracing/default.asp](http://www.asp101.com/articles/robert/tracing/default.asp)

如果您将以下内容放在 web.config 中，则可以启用应用程序范围的跟踪，然后您将可以访问您的 trace.axd

```
<trace enabled="true" 
    localOnly="false" 
    pageOutput="false" 
    requestLimit="500" 
    traceMode="SortByTime"
/> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T21:36:14.433

如果您使用的是 asp.net，那么 trace.axd 应该包含跟踪语句（只要它打开）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T21:38:06.847

您不会获得 IIS 的控制台。最接近您的是 Debug.WriteLine，带有附加的调试器或使用页面跟踪。建议使用日志框架，该框架将写入调试器（附加时）以及文件和可能的事件日志（全部通过您的侦听器配置）。

一些很棒的有 log4net 和 NLog。

# shared-memory - 求共享内存锁定问题的文章

> ID：762288
> 
> 赞同：3
> 
> 时间：2009-04-17T21:35:12.797
> 
> 标签：shared-memory

我正在审查一些代码并对所使用的技术感到怀疑。

在 linux 环境中，有两个进程附加多个共享内存段。第一个进程定期加载一组要共享的新文件，并将共享内存 id (shmid) 写入“主”共享内存段中的某个位置。第二个进程不断读取这个“主”位置并使用 shmid 附加其他共享段。

在多 CPU 主机上，在我看来，如果一个进程在另一个进程正在写入内存时尝试读取内存会发生什么，这可能取决于实现。但也许硬件级总线锁定可以防止电线上的位错位？读取过程是否获得了一个很快就会改变的值并不重要，只有读取被破坏为既不是旧值也不是新值的东西才重要。这是一个边缘情况：只有 32 位被写入和读取。

谷歌搜索 shmat 的东西并没有让我在这个领域找到任何确定的东西。

我强烈怀疑它不安全或不理智，我真正想要的是一些详细描述问题的文章的指针。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-17T21:46:56.060

这是合法的——因为在操作系统中不会阻止你这样做。

但它聪明吗？不，你应该有某种类型的同步。

不会有“电线上的损坏位”。它们会以 1 或 0 的形式出现。但是没有什么可说的，在另一个进程尝试读取它们之前，你的所有位都会被写出。并且无法保证它们的写入速度与读取速度。

您应该始终假设 2 个进程（或线程）的操作之间绝对没有关系。

除非您做对了，否则不会发生硬件级总线锁定。使您的编译器/库/操作系统/cpu正确执行可能比预期的要难。编写同步原语以确保它正确发生。

锁定将使其安全，并且并不难做到。所以就去做吧。

* * *

@unknown - 自从我的答案发布以来，这个问题发生了一些变化。但是，您描述的行为完全取决于平台（硬件、操作系统、库和编译器）。

如果不给编译器特定的指令，实际上并不能保证一次性写出 32 位。想象一下 32 位字未在字边界上对齐的情况。这种不对齐的访问在 x86 上是可以接受的，而在 x68 的情况下，访问被 cpu 变成了一系列对齐的访问。

这些操作之间可能会发生中断。如果在中间发生上下文切换，则某些位会被写入，而另一些则不会。砰，你死定了。

另外，让我们考虑一下 16 位 CPU 或 64 位 CPU。两者仍然很受欢迎，并且不一定按您的想法工作。

因此，实际上您可能会遇到“其他一些 cpu 核心拾取 1/2 写入的字大小值”的情况。如果您不使用同步，您编写代码就好像预期会发生这种类型的事情。

现在，有一些方法可以预写你的文章，以确保你能写出一个完整的单词。这些方法属于同步的范畴，创建同步原语是最好留给库、编译器、操作系统和硬件设计人员的事情类型。特别是如果您对可移植性感兴趣（即使您从未移植过代码，也应该如此）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-22T04:34:55.873

这个问题实际上比一些人讨论的还要严重。Zifre 是正确的，在当前的 x86 CPU 上，内存写入是原子的，但这种情况很快就不再是这样了——内存写入仅对单个核心是原子的——其他核心可能不会以相同的顺序看到写入。

换句话说，如果你这样做

```
a = 1;
b = 2; 
```

在 CPU 2 上，您可能会看到`b`在位置“a”之前修改了位置。此外，如果您写入的值大于本机字长（x32 处理器上的 32 位），则写入不是原子的 - 因此 64 位写入的高 32 位将在与低位不同的时间到达总线32位写入。这会使事情变得非常复杂。

使用内存屏障，你会没事的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-17T22:24:17.750

你需要在某个地方锁定。如果不在代码级别，那么在硬件内存缓存和总线。

在后 PentiumPro 英特尔 CPU 上您可能没问题。从我刚刚读到的内容来看，英特尔让他们后来的 CPU 基本上忽略了机器代码上的 LOCK 前缀。相反，缓存一致性协议确保数据在所有 CPU 之间保持一致。因此，如果代码写入的数据不跨越缓存行边界，它将起作用。无法保证跨缓存线的内存写入顺序，因此多字写入是有风险的。

如果您使用的是 x86 或 x86_64 以外的任何东西，那么您就**不行**。许多非英特尔 CPU（可能还有英特尔安腾）通过使用显式缓存一致性机器命令来获得性能，如果您不使用它们（通过自定义 ASM 代码、编译器内部函数或库），则无法保证通过缓存写入内存**永远**对另一个 CPU 可见或以任何特定顺序发生。

因此，仅仅因为某些东西在您的 Core2 系统上运行并不意味着您的代码是正确的。如果您想检查可移植性，请在其他 SMP 架构上尝试您的代码，例如 PPC（较旧的 MacPro 或 Cell 刀片）或 Itanium 或 IBM Power 或 ARM。Alpha 是一款出色的 CPU，可用于揭示不良 SMP 代码，但我怀疑您能否找到它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-25T13:25:55.653

在通过内存共享数据时，两个进程、两个线程、两个 cpu、两个内核都需要特别注意。

这篇 IBM 文章很好地概述了您的选择。

**Linux 同步方法剖析** 内核原子、自旋锁和互斥锁，作者：M. Tim Jones (mtj@mtjones.com)，Emulex 顾问工程师

[http://www.ibm.com/developerworks/linux/library/l-linux-synchronization.html](http://www.ibm.com/developerworks/linux/library/l-linux-synchronization.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-17T22:33:03.017

我实际上认为这应该是完全安全的（但取决于确切的实现）。假设“主”段基本上是一个数组，只要 shmid 可以原子地写入（如果它是 32 位那么可能没问题），并且第二个进程只是读取，你应该没问题。仅当两个进程都在写入时才需要锁定，或者正在写入的值不能以原子方式写入。你永远不会得到一个损坏的（半写的值）。当然，可能有一些奇怪的架构无法处理这个问题，但在 x86/x64 上应该没问题（可能还有 ARM、PowerPC 和其他常见架构）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-27T18:19:59.567

阅读[现代微处理器中的内存排序，第一部分](http://www.linuxjournal.com/article/8211)和[第二部分](http://www.linuxjournal.com/article/8212)

他们给出了为什么这在理论上是不安全的背景。

这是一场潜在的比赛：

*   进程 A（在 CPU 内核 A 上）写入新的共享内存区域
*   进程 A 将该共享内存 ID 放入共享的 32 位变量中（即 32 位对齐 - 如果您允许，任何编译器都会尝试像这样对齐）。
*   进程 B（在 CPU 内核 B 上）读取变量。假设 32 位大小和 32 位对齐，它不应该在实践中得到垃圾。
*   进程 B 尝试从共享内存区域读取。现在，不能保证它会看到 A 写入的数据，因为您错过了内存屏障。（实际上，在映射共享内存段的库代码中，CPU B 上可能碰巧存在内存屏障；问题是进程 A 没有使用内存屏障）。

此外，还不清楚如何使用这种设计安全地释放共享内存区域。

使用最新的内核和 libc，您可以将 pthreads 互斥锁放入共享内存区域。（这确实需要带有 NPTL 的最新版本——我使用的是 Debian 5.0 “lenny”，它工作正常）。围绕共享变量的简单锁定意味着您不必担心神秘的内存屏障问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-17T21:40:08.230

我不敢相信你会问这个。**不**，它不一定安全。至少，这将取决于编译器是否生成在您设置 shmid 时自动设置共享内存位置的代码。

现在，我不了解 Linux，但我怀疑 shmid 是 16 到 64 位的。这意味着至少有可能所有平台都有一些指令可以原子地写入这个值。但是你不能在不被询问的情况下依赖编译器来做这件事。

内存实现的细节是最特定于平台的东西之一！

顺便说一句，在您的情况下可能无关紧要，但总的来说，即使在单个 CPU 系统上，您也必须担心锁定问题。通常，某些设备可以写入共享内存。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-17T21:46:34.500

合法的？我想。取决于您的“管辖权”。安全和理智？几乎可以肯定不是。

编辑：我会用更多信息更新它。

你可能想看看[这个](http://en.wikipedia.org/wiki/Concurrent_computing)维基百科页面；特别是关于“协调对资源的访问”的部分。特别是，维基百科的讨论基本上描述了**信心失败**；即使对于原子资源，对共享资源的非锁定访问也会导致误报/误传对已完成操作的**信心**。本质上，在检查它是否可以修改资源之间的时间段内，资源被外部修改，因此，条件检查中固有的信心被破坏了。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-22T04:42:56.853

我同意它可能会起作用 - 所以它可能是安全的，但并不理智。主要问题是是否真的需要这种低级共享 - 我不是 Linux 专家，但我会考虑为主共享内存段使用例如 FIFO 队列，以便操作系统为您完成锁定工作. 无论如何，消费者/生产者通常需要队列进行同步。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-29T10:24:27.503

我不相信这里有人讨论过锁争用对总线的影响有多大，尤其是在总线带宽受限的系统上。

[这](http://people.cs.vt.edu/~dsn/papers/HIGH_PERFORMANCE_COMPUTING_PARADIGM_INFRASTRUCTURE.pdf)是一篇关于这个问题的深入文章，他们讨论了一些替代调度算法，这些算法减少了对通过总线的独占访问的总体需求。在某些情况下，这比简单的调度程序增加了 60% 以上的总吞吐量（当考虑显式锁定前缀指令或隐式 xchg cmpx 的成本时）。这篇论文不是最新的工作，也没有多少真正的代码（当学术的），但它值得阅读和考虑这个问题。

较新的 CPU ABI 提供了比简单的***锁定****任何*其他操作。

[来自 FreeBSD（许多内部内核组件的作者）的 Jeffr 讨论了 monitor 和mwait](http://jeffr-tech.livejournal.com/21310.html)，为 SSE3 添加了 2 条指令，在一个简单的测试用例中确定了 20% 的改进。他后来假设；

> 所以现在这是自适应算法的第一阶段，我们旋转一段时间，然后在高功率状态下睡眠，然后根据负载在低功率状态下睡眠。

...

> 在大多数情况下，我们仍然在 hlt 中闲置，因此对功率应该没有负面影响。事实上，进入和退出空闲状态会浪费大量时间和精力，因此它可以通过减少所需的总 CPU 时间来提高负载下的功率。

我想知道使用暂停而不是hlt会产生什么影响。

来自[英特尔的 TBB；](http://www.threadingbuildingblocks.org/)

```
 ALIGN 8
        PUBLIC __TBB_machine_pause
__TBB_machine_pause:
L1:
        dw 090f3H; pause
        add ecx,-1
        jne L1
        ret
end 
```

[Art of Assembly](http://maven.smith.edu/~thiebaut/ArtOfAssembly/CH19/CH19-12.html#HEADING12-118)还使用同步，不使用锁定前缀或 xchg。我有一段时间没有读过那本书，也不会直接谈论它在用户域保护模式 SMP 上下文中的适用性，但值得一看。

祝你好运！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-22T06:24:30.370

如果 shmid 有其他类型，`volatile sig_atomic_t`那么您可以很确定即使在同一个 CPU 上，单独的线程也会遇到麻烦。如果类型是，`volatile sig_atomic_t`那么您就不能完全确定，但是您仍然可能会很幸运，因为多线程可以比信号可以做更多的交错。

如果 shmid 跨越高速缓存行（部分在一个高速缓存行中，部分在另一个高速缓存行中），那么当写入 cpu 正在写入时，您肯定会发现一个正在读取的 cpu 读取新值的一部分和旧值的一部分。

这正是发明“比较和交换”等指令的原因。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-22T13:41:57.633

听起来你需要一个读写器锁：[http](http://en.wikipedia.org/wiki/Readers-writer_lock) ://en.wikipedia.org/wiki/Readers-writer_lock 。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-04-27T17:47:58.770

答案是——同时进行读写是绝对安全的。

> 很明显，shm 机制为用户提供了基本的工具。所有访问控制都必须由程序员负责。**内核友好地提供了锁定和同步，这意味着用户不必担心竞争条件。**请注意，此模型仅提供了一种在进程之间共享数据的对称方式。如果一个进程希望通知另一个进程新数据已插入共享内存，它必须使用信号、消息队列、管道、套接字或其他类型的 IPC。

来自Linux文章[中的共享内存。](http://www.codemaestro.com/reviews/11)

最新的 Linux shm 实现只是使用`copy_to_user`和`copy_from_user`调用，它们在内部与内存总线同步。

# python - Matplotlib 构建问题：错误 C1083：无法打开包含文件：'ft2build.h'

> ID：762292
> 
> 赞同：34
> 
> 时间：2009-04-17T21:36:22.170
> 
> 标签：python, build, matplotlib, freetype

**ft2build.h**位于此处：

**C:\Program Files\GnuWin32\include**

最初，我犯了和这里一样的错误：

[致命错误 C1083：无法打开包含文件：'tiffio.h'：没有此类文件或目录 VC++ 2008](https://stackoverflow.com/questions/160938/fatal-error-c1083-cannot-open-include-file-tiffio-h-no-such-file-or-director)

但从那时起，我已经更正了那个特定的错误（我已将上述目录添加到“包含”列表，而不是“可执行文件”列表），但我仍然收到错误。完整的输出是这样的：

```
BUILDING MATPLOTLIB
            matplotlib: 0.98.5.2
                python: 2.6.2 Stackless 3.1b3 060516 (release26-maint, Apr
                        14 2009, 21:19:36) [MSC v.1500 32 bit (Intel)]
              platform: win32
       Windows version: (5, 1, 2600, 2, 'Service Pack 3')

REQUIRED DEPENDENCIES
                 numpy: 1.3.0
             freetype2: found, but unknown version (no pkg-config)
                        * WARNING: Could not find 'freetype2' headers in any
                        * of '.', '.\freetype2'.

OPTIONAL BACKEND DEPENDENCIES
                libpng: found, but unknown version (no pkg-config)
                        * Could not find 'libpng' headers in any of '.'
               Tkinter: no
                        * No tk/win32 support for this python version yet
              wxPython: 2.8.9.2
                        * WxAgg extension not required for wxPython >= 2.8
                  Gtk+: no
                        * Building for Gtk+ requires pygtk; you must be able
                        * to "import gtk" in your build/install environment
       Mac OS X native: no
                    Qt: no
                   Qt4: no
                 Cairo: no

OPTIONAL DATE/TIMEZONE DEPENDENCIES
              datetime: present, version unknown
              dateutil: matplotlib will provide
                  pytz: matplotlib will provide

OPTIONAL USETEX DEPENDENCIES
                dvipng: no
           ghostscript: no
                 latex: no
               pdftops: no

[Edit setup.cfg to suppress the above messages]
============================================================================
pymods ['pylab']
packages ['matplotlib', 'matplotlib.backends', 'matplotlib.projections', 'mpl_to
olkits', 'matplotlib.numerix', 'matplotlib.numerix.mlab', 'matplotlib.numerix.ma
', 'matplotlib.numerix.npyma', 'matplotlib.numerix.linear_algebra', 'matplotlib.
numerix.random_array', 'matplotlib.numerix.fft', 'matplotlib.delaunay', 'pytz',
'dateutil', 'dateutil/zoneinfo']
running build
running build_py
copying lib\matplotlib\mpl-data\matplotlibrc -> build\lib.win32-2.6\matplotlib\m
pl-data
copying lib\matplotlib\mpl-data\matplotlib.conf -> build\lib.win32-2.6\matplotli
b\mpl-data
running build_ext
building 'matplotlib.ft2font' extension
C:\Program Files\Microsoft Visual Studio 9.0\VC\BIN\cl.exe /c /nologo /Ox /MD /W
3 /GS- /DNDEBUG -IC:\Python26\lib\site-packages\numpy\core\include -I. -IC:\Pyth
on26\lib\site-packages\numpy\core\include\freetype2 -I.\freetype2 -IC:\Python26\
include -IC:\Python26\include\Stackless -IC:\Python26\PC /Tpsrc/ft2font.cpp /Fob
uild\temp.win32-2.6\Release\src/ft2font.obj
ft2font.cpp
C:\Program Files\Microsoft Visual Studio 9.0\VC\INCLUDE\xlocale(342) : warning C
4530: C++ exception handler used, but unwind semantics are not enabled. Specify
/EHsc
c:\python26\lib\site-packages\matplotlib-0.98.5.2\src\ft2font.h(13) : fatal erro
r C1083: Cannot open include file: 'ft2build.h': No such file or directory
error: command '"C:\Program Files\Microsoft Visual Studio 9.0\VC\BIN\cl.exe"' fa
iled with exit status 2 
```

我应该提到这是 Python 2.6

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2011-03-05T19:02:47.553

在 Ubuntu 10.10 上构建 matplotlib 时也会出现此错误。解决办法是：

```
sudo apt-get install python-dev libfreetype6-dev 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-18T05:27:41.803

你是否正确安装了freetype？如果有，`ft2build.h`安装目录下应该有一个名为的文件，找到该文件的目录就是您应该用`-I`. 字符串“GnuWin32”没有出现在构建命令的输出中的任何位置，因此看起来您没有将该目录放在正确的包含列表中。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-11-02T02:13:29.213

Mac OS X 的另一个解决方案是使用 Homebrew 安装 Freetype。

```
brew install freetype 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-07-02T14:48:43.637

我可以通过执行以下操作在 Windows 上解决此问题：

```
 set INCLUDE=%INCLUDE%;C:\tmp\msvcr90-x32
   set LIB=%LIB%;C:\tmp\msvcr90-x32
   pip.exe install matplotlib 
```

Windows 上 Freetype 的链接库可以在这里找到：[http](http://www.lfd.uci.edu/~gohlke/pythonlibs/#matplotlib) ://www.lfd.uci.edu/~gohlke/pythonlibs/#matplotlib（来自 meawoppl 的评论）

只需下载“matplotlib‑1.x‑windows‑link‑libraries.zip”，然后从 zip 文件中打开 README。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2020-03-22T10:36:36.720

这个问题在谷歌中出现了这个错误，所以像其他几个人一样，我会忽略它只询问 Windows 的事实。

在 Debian 10 (Buster) 上，我必须这样做：

```
sudo apt install libfreetype6-dev pkg-config 
```

注意`pkg-config`依赖关系；没有它，将安装 FreeType 标头，但 matplotlib 无法找到它们。它会在输出输出页面之前对此发出警告，因此很容易错过：

```
IMPORTANT WARNING:
    pkg-config is not installed.
    matplotlib may not be able to find some of its dependencies 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-01-22T12:55:35.400

对于那些在 Mac OS 10.6（雪豹）和 Python 2.7 上可能有同样问题的人。，我找到的最简单的解决方案是获取一个下载 Numpy、scipy 和 matplotlib 并为您编译它们的 make 文件。您可以自定义 make 文件以仅获取 matplotlib。这是解决方案的[链接](http://stefan.sofa-rockers.org/2010/11/17/building-numpy-scipy-matplotlib-python-27-snow-leo/)。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-09-07T22:42:44.920

我在 red hat 6 中遇到了同样的错误。原来我需要安装`freetype-devel`，而不是`freetype`（使用`sudo yum install freetype-devel`）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-08-19T07:04:16.437

我还通过在 Mac OS X 上使用 homebrew 安装 freetype 解决了这个问题。但是，这还不够，因为在 Mac OS X 10.7 下这些库没有正确链接。所以我不得不手动将它们添加到`pip`命令中，如下所示：

```
brew install freetype
brew install libpng
LDFLAGS="-L/usr/local/opt/freetype/lib -L/usr/local/opt/libpng/lib" CPPFLAGS="-I/usr/local/opt/freetype/include -I/usr/local/opt/libpng/include -I/usr/local/opt/freetype/include/freetype2" pip install matplotlib 
```

请注意，您还必须添加文件夹`/usr/local/opt/freetype/include/freetype2`，默认情况下自制程序通知中不包含该文件夹，但会导致找不到`ft2build.h`.

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-11-15T01:35:40.087

我花了几个小时试图让 matplotlib 安装最新的 python 3、pip、setuptools 一切......最终对我有用的是去 [https://www.lfd.uci.edu/~gohlke/pythonlibs/#matplotlib](https://www.lfd.uci.edu/~gohlke/pythonlibs/#matplotlib)下载轮文件并在同一目录中执行它：

```
pip install matplotlib‑3.2.0rc2‑cp38‑cp38‑win_amd64.whl 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-03-12T21:23:32.690

将文件下载到 C 盘上的文件夹中。`cd..` 在 Windows CMD 提示符中，管理员使用或`cd wheels`（在我的情况下我将文件保存到）导航您的路径 ，`c:\Wheels`然后键入`pip install YourFilename.whl`

结果是

```
Processing c:\wheels\scipy-0.19.0-cp27-cp27m-win_amd64.whl
Requirement already satisfied: numpy>=1.8.2 in c:\python27\lib\site-packages (from scipy==0.19.0)
Installing collected packages: scipy
Successfully installed scipy-0.19.0 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-02-21T19:47:12.200

我对jetson nano（aarch64-linux-gnu）有同样的问题。这对我有用 -

```
sudo apt-get install python-dev libfreetype6-dev
pip3 install --upgrade cyton
pip3 install matplotlib 
```

# asp.net - 在 ASP.NET 中使用 Debug.Assert 是否值得？

> ID：762299
> 
> 赞同：15
> 
> 时间：2009-04-17T21:38:51.650
> 
> 标签：asp.net, debugging, assert

在 ASP.NET 中设置适当的调试环境似乎是一个相当大的麻烦，我只是想知道使用 Asserts 是否可行。我读了一点，发现您需要修改 web.config 以正确使用 Asserts。这通常是最好的方法还是有其他可能更容易使用的调试方法？

我们不使用单元测试框架，因此与问题无关。

您如何知道它们正常工作或根本不工作之间的区别？目前我可以在我的代码中放入断言，它绝对不会做任何事情，因为它们没有在 web.config 中配置。这对我来说似乎很危险。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-17T21:44:05.613

我会在这里指导你：[我什么时候应该使用 Debug.Assert()？](https://stackoverflow.com/questions/129120/when-should-i-use-debugassert). 有几个很好的答案可以告诉您何时可以使用它们，并且您可以从那里找出它是否值得在您的应用程序中使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T21:43:20.467

拥有调试断言将确保您的代码是正确的。用正确的测试用例组合肯定会对你有所帮助。

一些单元测试框架带有可以记录消息并在断言上抛出异常的处理程序。选择其中一个框架或编写自己的处理程序是您可能需要考虑的事情。但是一旦单元测试代码捕捉到这些异常，它们应该被记录并标记为失败。

# c - 如何在 Vim 中自动折叠较长的 C 代码？

> ID：762310
> 
> 赞同：6
> 
> 时间：2009-04-17T21:41:51.453
> 
> 标签：c, vim, folding

我经常遇到不折叠的 C 代码。如果没有折叠，阅读它们会很烦人，尤其是长文件。我怎样才能折叠它们？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-17T21:59:12.770

根据语法折叠

```
:set foldmethod=syntax 
```

如果您想在要折叠的位上手动执行此操作

```
:set foldmethod=manual 
```

然后通过选择/移动并按下 zf 创建新的折叠，例如

```
shift-v j j zf 
```

（忽略空格）

编辑：另请参阅此答案的评论以了解缩进和标记折叠方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-17T21:58:40.167

我认为您可能混淆了术语。你需要“包装”还是“折叠”。换行是由于长度而通常不适合屏幕的行被换行，即显示在屏幕上的几行连续的行上（实际上，它是一行，分几行 - 很难解释，最好在实践）。

在 vim 中，包装由

```
:set wrap 
```

打开它，然后

```
:set textwidth=80 
```

确定 vim 应该在哪里包装文本（80 个字符通常是一个很好的措施）。

另一方面，折叠是完全不同的事情。它是 vim 将几行代码（例如，一个函数）折叠成一行代码的一种方式。它对于提高代码的可读性很有用。Vim 有几种折叠方法，你可以看到所有的折叠方法

```
:help folding 
```

我认为您正在寻找的是语法折叠，但我可能是错的。我建议阅读帮助页面，它不长，而且非常有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-03-16T14:02:12.697

[我已经为 C 和 C++](https://github.com/LucHermitte/VimFold4C)卷起了一个折叠插件。与缩进和基于标记的折叠相比，它超越了语法折叠所做的事情（可能它可以改进，我不知道），并且展开的噪音更少且不是真正有用的东西。

警告：为了有不错的反应时间，我不得不做一些简化，有时结果很混乱（我们必须打字`zx`来修复它）。

这是一个小截屏视频，看看插件如何折叠正确平衡的 C++ 源代码，目前没有被修改:(

[![在此处输入图像描述](https://i.stack.imgur.com/GWRTx.gif)](https://i.stack.imgur.com/GWRTx.gif)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T21:48:19.660

在 vi（相对于 vim）中，答案是：

```
:set wm=1 
```

这会将换行边距设置为行尾前的一个字符。这不是世界上具有可变大小窗口的最佳规范（当很难改变大小时，它对绿屏很有意义）。

这意味着在 vim 中还有另一种方法可以做到这一点：

```
:set textwidth=30 
```

参见：[VimDoc 用户手册第 25.1 节](http://vimdoc.sourceforge.net/htmldoc/usr_25.html#25.1)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-03-16T10:14:50.660

实际上，还有另一种非常直接有效的方法，就是 using`foldmethod = marker`和 set `foldmarker`to be `{,}`。然后折叠结果将如下所示：

1.  所有功能折叠。基本上，它看起来像 IDE 中的大纲。（`set foldlevel=1`如果您不想在开始时折叠所有内容，您也可以或更多）

[![在此处输入图像描述](https://i.stack.imgur.com/cKmP3.png)](https://i.stack.imgur.com/cKmP3.png)

2.  当您使用 level-1 via 打开它时，这就是正常功能的样子`zo`。

[![在此处输入图像描述](https://i.stack.imgur.com/yHkMO.png)](https://i.stack.imgur.com/yHkMO.png)

此外，按语法进行折叠需要一些额外的工作，这里有一个很好的[教程](http://vim.wikia.com/wiki/Syntax-based_folding)。但是我觉得 fold by`marker={,}`就足够了，最重要的是，它简单整洁。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T22:54:43.107

你可能想要的设置

```
:set foldmethod=syntax 
```

但是不要手动输入！这错过了 Vims 最大的功能之一，该功能已经内置了数百种文件类型的自定义设置。为此，请将其添加到您的 ~/.vimrc

```
filetype plugin on
filetype indent on 
```

文件类型检测主要基于扩展名，在本例中为 *.c 文件。请参阅 :help :filetype 了解更多信息。您还可以自定义这些基于文件类型的设置。

# c# - 为什么一个基本的单线程 C# 控制台应用程序需要 3 个线程？

> ID：762316
> 
> 赞同：19
> 
> 时间：2009-04-17T21:44:20.857
> 
> 标签：c#, .net, multithreading, console

我用一条`Console.ReadLine`语句在 c# 中创建了一个控制台应用程序。在 Visual Studio 中运行此应用程序并进入调试器会在线程窗口中显示 7 个线程（6 个工作线程，一个是 .NET SystemEvents，另一个是`vshost.RunParkingWindow`主线程）。

当我在 Visual Studio 之外运行应用程序时，我在 Windows 任务管理器中看到总共 3 个线程。当我期望 1 个线程时，为什么会有这么多？其他人是为了什么而产生的？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-17T21:57:16.847

如果您正在运行 .NET 应用程序，我相信除了您的主线程之外，您总是会为 JIT（即时编译器）和 GC（垃圾收集）线程获得一个线程（主要是休眠）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-01-21T16:20:42.433

您不必担心：如果您不明确使用它们，您的任何代码都不会在主线程之外的另一个线程中运行。其他线程用于：

*   垃圾收集器
*   定稿
*   线程池

> 3个线程共享一个标准输入吗？

理论上是的，但其他人不会使用它，除非你在析构函数内或 ThreadPool.QueueUserWorkItem 内使用 Console.ReadLine，所以不用担心你会在主线程中获取所有数据

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-28T16:33:23.043

有一种方法可以将 SystemEvents 通知程序移动到您的线程中：

```
public static class ThreadingHelper_NativeMethods
{
   [DllImport("user32.dll")]
   public static extern bool IsGUIThread(bool bConvert);
}

     // This code forces initialization of .NET BroadcastEventWindow to the UI thread.
     // http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/fb267827-1765-4bd9-ae2f-0abbd5a2ae22
     if (ThreadingHelper_NativeMethods.IsGUIThread(false))
     {
        Microsoft.Win32.SystemEvents.InvokeOnEventsThread(new MethodInvoker(delegate()
        {
           int x = 0;
        }));
     } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T21:58:37.017

不要忘记终结器线程！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-21T16:21:01.570

如果您还没有完成任何线程或线程池工作，那么这些线程中只有一个是您的。其余的由运行时创建，它是库，例如垃圾收集。线程数将根据您使用的库、内核数等而有所不同。

这些线程可能共享上下文，例如控制台，但您只需要担心同步您自己的线程和构造。

# jquery - jquery屏蔽输入

> ID：762319
> 
> 赞同：4
> 
> 时间：2009-04-17T21:45:25.347
> 
> 标签：jquery, javascript

我试图掩盖一个文本字段并查看了[http://digitalbush.com/projects/masked-input-plugin/](http://digitalbush.com/projects/masked-input-plugin/)

有人用过这个插件吗？

我试图掩盖一个文本字段，以便用户只能输入一些美元金额。美元金额可以在 0 - 500000 之间

通过这个插件可行吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T22:04:17.173

屏蔽输入插件只能做固定长度的字段。它也可以进行部分输入，但只能在字段的末尾。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T21:55:33.450

尝试为某个范围制作掩码只会惹恼用户。相反，当焦点离开文本字段时，使用 blur 事件检查范围。

```
$('#yourinput').blur(function() {
  val dollarAmount = parseInt($(this).val());
  if (dollarAmount < 0) {
    $(this).val(0);
  } elseif (dollarAmount > 500000) {
    $(this).val(500000);
  }
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-24T19:59:17.467

我也喜欢使用蒙面输入插件，并希望创建相同的东西。我同意上面的 Aaron 的观点，我不相信 jBush Masked Input 插件目前支持我能找到的它。虽然我认为 jBush 一直在考虑这样做：http: [//forum.jquery.com/topic/jquery-masked-input-plugin-direction](http://forum.jquery.com/topic/jquery-masked-input-plugin-direction)

我一直在寻找同样的东西。到目前为止，我发现的最接近的东西是这个字母数字插件：http: [//itgroup.com.ph/alphanumeric/](http://itgroup.com.ph/alphanumeric/)

为了解决您的问题，您可以将其设置为仅允许数字，加上一些额外的（逗号、十进制）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-22T10:19:25.817

我发现的所有插件都有一些烦恼或奇怪的行为（光标跳到结尾，无法使用 shift+箭头键选择文本等），但这个插件的问题是我能找到的最少的：

[https://github.com/plentz/jquery-maskmoney](https://github.com/plentz/jquery-maskmoney)

很抱歉挖掘了这个旧线程，但我最终使用了这个插件，可能对绊倒这个线程的人有用（比如我）

# visual-studio - “添加服务引用”在 VS 中失败

> ID：762322
> 
> 赞同：1
> 
> 时间：2009-04-17T21:46:29.227
> 
> 标签：visual-studio, web-services

在 MS 的 Visual Web Developer 中，我有一个完全默认的 ASP.NET Web 服务项目和另一个项目。当在第二个项目上使用右键菜单运行“添加服务引用”时，我可以找到作为选项列出的第一个项目，但是当我尝试选择它时出现错误，我得到一个错误

```
元数据包含无法解析的引用：“http://0.0.0.0:3495/Service1.asmx?wsdl”。
下载“http://0.0.0.0:3495/Service1.asmx?wsdl”时出错。
无法连接到远程服务器
请求的地址在其上下文 0.0.0.0:3495 中无效
元数据包含无法解析的引用：“http://localhost:3495/Service1.asmx”。
元数据包含无法解析的引用：“http://localhost:3495/Service1.asmx”。
如果在当前解决方案中定义了服务，请尝试构建解决方案并再次添加服务引用。

```

我在使用 WCF 服务时也遇到了同样的问题。

我究竟做错了什么？

* * *

我找到了这个有[这个服务的](http://aspnet.15seconds.com/010430/SampleService.asmx)[参考资料](http://www.15seconds.com/Issue/010430.htm)，并且可以使用它。（ WhyT_***默认****服务不能**正常工作？*）

 *** * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-14T16:01:52.387

由于未生成代理，因此未添加引用。

在我的情况下，我得到“元数据包含无法解析的引用”，因为合同上公开对象使用的某些内部类型不可序列化。

应用 Serializable 属性后，代理正确生成并添加了引用。

因此，您可能想检查通过合同公开的类型是否可序列化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-10T15:10:27.697

该服务需要可供所有（匿名）用户访问。您可以使用以下方法使位置可访问：

```
<location path="YOURPATH" >
  <system.web>
    <authorization>
      <allow users="*" />
    </authorization>
  </system.web>
</location> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T21:49:57.863

该服务需要可用。

如果您只启动服务，添加服务引用应该可以工作。

# php - 保存网页内容 (php)

> ID：762324
> 
> 赞同：0
> 
> 时间：2009-04-17T21:46:43.690
> 
> 标签：php, mysql, database

我有一个网站，它有一个页面，在每个表格中向用户显示一组锻炼课程。会话中的练习是href链接，不能作为变量发送到数据库。

链接显示在页面上的表格中，这是我无法将它们发送到数据库的另一个原因。

如何保存网页的状态（可能保存到文件中）以便用户稍后查看（在现有的锻炼部分中）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T22:00:09.117

如果您想要做的只是创建生成站点的副本，那么前面提到的输出控制功能会有所帮助。

但是，似乎真正的问题与您要问的问题有点距离。您有哪些信息无法存储在数据库中？为什么不能保存？您始终可以在那里存储数据，然后重新生成页面。我认为你从错误的角度来处理这个问题。

您能否举例说明当前数据库中数据的结构？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T21:57:30.277

使用php的[“输出控制功能”怎么样？](http://php.net/manual/en/ref.outcontrol.php)他们将缓冲输出，然后您可以将其保存到文件中:)

# c# - 什么时候使用缓存太多了？

> ID：762326
> 
> 赞同：2
> 
> 时间：2009-04-17T21:47:24.607
> 
> 标签：c#, asp.net, caching

*   我真的很难找到最好的解决方案，真正让我困惑的是，只要 .net 框架清除低优先级缓存项目，我为什么要担心内存（我知道这是一个转储问题）？

*   我真的可以限制 ASP.net 缓存使用一定数量的 RAM，而不是来自 IIS，因为我的网站在共享主机上，这对缓存有什么影响？

*   静态类在某些情况下会更好用吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T22:11:04.817

[可悲的是， processModel 配置元素](http://msdn.microsoft.com/en-us/library/7w2sway1.aspx)上的 memoryLimit 属性只允许在机器级别（在 machine.config 中）设置 - 并且配置文件的工作方式，没有办法说“这是任何一个应用程序可以拥有的最大内存，但如果他们愿意，他们可以要求更少”。

如果您发现缓存中的内容不断地从缓存中取出，它们真的应该在缓存中吗？您要么没有经常阅读它们，以至于一开始就费心缓存它们，要么您试图一次将太多东西放入缓存中。

* * *

缓存假脱机可以通过内置的性能监视器看到。在 ASP.NET 应用程序和 ASP.NET 应用程序 v2.0.50727 下，您可以找到如下内容：

*   缓存 API 修剪
*   缓存 API 周转率
*   缓存总修剪
*   缓存总周转率

可以在[TechNet](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/a8c5b994-7722-4dc6-a246-7dfe667c6816.mspx?mfr=true)上找到更多详细信息。

# language-agnostic - 在考虑 Web 兼容性时我应该忽略谁？

> ID：762328
> 
> 赞同：1
> 
> 时间：2009-04-17T21:48:14.577
> 
> 标签：language-agnostic

根据 W3Cschools 的数据，只有 17% 的用户仍在使用 IE6。
[来源](http://www.w3schools.com/browsers/browsers_stats.asp)

他们的统计数据还显示，只有 4% 的用户的分辨率为 800x600 或更低。
[来源](http://www.w3schools.com/browsers/browsers_display.asp)

在什么时候我会忽略拒绝更新的用户以改善其他用户的体验？

您认为网页内容对这个门槛的影响有多大？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-17T21:53:26.357

我支持 IE6 和 1024x768，因为这是我的大多数目标受众（教育）正在使用的。

我建议在您决定将/不支持什么之前收集一些统计数据。

你应该尽可能地迎合**你的**听众。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-17T21:50:23.417

当您接触到足够多的目标受众时，成本变得太大而无法弥补您通过支持较少使用的浏览器获得的额外一点点。

对于大多数网站来说，支持它所需的一点工作量来说，17% 的下降太多了。

但是IE5够小，兼容性问题也够大，支持也没有意义。

如果您正在运行一个面向技术受众的网站，您可能会放弃 ie6，因为您的目标受众中很少有人会被拒之门外，而且支持他们的额外工作大于他们对您的网站所代表的价值。

关于屏幕分辨率 - 请记住，越来越多的用户正在通过移动设备体验互联网。您只能通过查看您的内容/应用程序和您的用户群并做出判断来回答这个问题。

在大多数情况下，大型网站透明地支持各种分辨率和设备，但是一旦您查看您的受众和应用程序，您可能只需要支持一种。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T22:21:28.817

请记住，许多用户不会在浏览器最大化的情况下进行浏览，因此屏幕分辨率是一个相对无用的统计数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T21:52:42.770

如果您使用 GWT、dojo 等跨浏览器工具包，您不应该忽视任何人。这正是它们的用途。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T22:11:30.777

我想这确实取决于您网站的受众，而不是 w3cschools 的统计数据。据该网站称，Firefox 为 46%（2009 年 3 月）。对于我的网站，63% 的流量是由 ff 产生的。因此，您可以假设您自己的网站有很大的不同。

如果您通过该网站赚钱，请查看数字并根据您的用户转化率决定是否值得让该网站可用于 ie6 以及预期的投资回报。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T21:55:51.670

如果您的网站从客户那里获得收入，那么

Sum（来自 86% 用户的收入）> 3 * Sum（来自 14% 用户（使用 IE6）的收入）

别的

每个客户都是国王。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-17T22:37:46.407

如果你的网站不赚钱，我绝对不会做任何额外的工作来支持 IE6。如果它是一个技术站点，我什至根本不会打扰 IE，只要坚持标准（当然，它可能会在 IE 7/8 中工作）。

如果您从您的网站赚钱，请考虑这一点。利润减少 17% 你会接受吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-17T22:44:24.957

我不会忽视 IE6 用户。并非所有用户都必须能够升级，例如，某些用户可能会从 IT 部门要求特定版本的 IE 的工作场所访问您的站点。

# java - 单例异常有效吗？

> ID：762330
> 
> 赞同：8
> 
> 时间：2009-04-17T21:48:34.513
> 
> 标签：java, exception, static, singleton

我的一位同事介绍了静态工厂方法（就在 Effective Java 中），然后举例说明了它用于获取静态/单例异常。

这对我来说是一个危险信号。异常不是有状态的吗？它们不是由 JVM 填充以获取堆栈跟踪信息吗？你真的得到了什么节省，因为异常应该只发生在特殊情况下？

我对异常的了解相当有限，所以我来找你：单例异常会起作用吗，有什么理由使用它们吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-17T21:56:37.473

单例异常应该是一种性能优化。想法是在创建异常时消除填充堆栈跟踪的成本，这通常是异常中最昂贵的部分。

如果异常足够独特且具有描述性，并且不会使用堆栈跟踪，那么单例可能会有效。您可以设计应用程序，使带有特定消息的特定异常类型始终意味着异常源自特定位置。那么堆栈跟踪将无关紧要。

2003年[4 月 22 日的技术提示文章](http://java.sun.com/developer/JDCTechTips/2003/tt0422.html#2)描述了您重用异常的场景。在这种情况下，他们试图通过减少创建的对象数量来与垃圾收集器博弈。如果您跳过`populateStackTrace()`呼叫，您将不必担心线程。

通常，如果异常的性能影响导致问题，则表明异常正在用于应用程序逻辑，应使用错误代码。

在较新的 JVM（我相信是 1.4+）中，这种“优化”可以由 JVM 在“-server”模式下运行时自动完成。这个热点优化可以通过选项来控制`-XX:+OmitStackTraceInFastThrow`。

*就个人而言，我建议不要使用单例异常 [anti-] 模式。*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T21:59:20.663

虽然我非常不同意这种方法，但 Singleton Exceptions*可以*在单线程环境中工作。

建议单例异常模式的人们倾向于习惯于旧的 c 风格的调用/错误/检查错误范式，并希望将其翻译成一种新奇的“面向对象”语言。

这是可能的，但我称之为代码异味。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T21:54:37.540

我可以想象这样一种情况，您希望能够在您的异常条件中检测到您的应用程序的另一部分是否已经抛出了异常；我可以看到使用单例异常来实现这种目的；但这似乎有点多余。从本质上讲，它将信号量（“某事发生”）与异常（“我发生了某事”）的概念混为一谈。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T23:28:35.863

如果“静态工厂方法”不断返回相同的对象，它就不是真正的工厂方法。

Even`java.lang.Throwable`有两项可变状态：堆栈跟踪和初始原因，直到新版本的 Java 添加更多。任何共享`Throwable`都需要违反合同`fillInStackTrace`或行为非常奇怪。此外，重用`Throwable`不能合理地改变消息。

所以你可以摆脱它，但你愿意吗？几乎所有的性能问题（你通常不应该经常抛出异常）都归结为`fillInStackTrace`. 如果您将其淘汰，那么重用就没有什么意义了。

（我更喜欢短语“静态创建方法”而不是“静态工厂方法”，因为“工厂”太重载了。）

# ruby - Rack 和 Rails Metal (Ruby) 有什么区别？

> ID：762336
> 
> 赞同：6
> 
> 时间：2009-04-17T21:50:53.430
> 
> 标签：ruby, rack

我不明白！

机架：[http ://rack.rubyforge.org/](http://rack.rubyforge.org/)

Rails 金属：[http ://weblog.rubyonrails.org/2008/12/17/introducing-rails-metal](http://weblog.rubyonrails.org/2008/12/17/introducing-rails-metal)

看了两篇文章，眼睛都模糊了。这两个组件如何关联？例子会很棒吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-17T22:03:24.163

Rack 是一个非常轻量级的规范，Ruby Web 服务器可以实现。它是中间件，这意味着它位于 Web 服务器（例如，Passenger）和 Rails 之间。

Rails Metal 是一种在您需要最高性能时使用 Rails 处理 HTTP 请求的方法。它实际上将您带入了金属并绕过了标准 Rails 的请求/响应周期为您提供的所有正常功能（以及开销）。从技术上讲，Rails Metal 是 Rack 处理程序的实现。

你可能会发现这两个 Railscasts 主题信息丰富：

*   [导轨金属](http://railscasts.com/episodes/150-rails-metal)
*   [机架中间件](http://railscasts.com/episodes/151-rack-middleware)

您可以使用以下方法获取 Rails 应用程序的 Rack 中间件堆栈列表`rake middleware`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T22:02:00.673

Rack 是一个通用的 Ruby API/抽象层，它允许不同的应用程序框架集成到 Web 服务器。

Rails Metal 是 Rails 对 Rack 处理程序的实现。它不仅包括一个调用 Rails 的处理程序，而且还公开了自己的 API，使您可以更轻松地创建自己的处理程序来访问 Web 服务器并绕过核心 Rails。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-17T22:19:16.200

[在Jesse Newland 的网站](http://soylentfoo.jnewland.com/articles/2008/12/16/rails-metal-a-micro-framework-with-the-power-of-rails-m)上有一个很好的讨论和一些例子：

> 因此，从本质上讲，**Rails Metal 是 Rails 新的 Rack 中间件支持的薄包装器**。机架中间件是非常强大的东西：独立处理请求或与其他中间件协同处理请求的独立于框架的组件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-08-09T17:48:59.553

除了其他人所涵盖的差异之外，我想指出，Rack 应用程序可以是中间件或最终端点，而`ActionController::Metal`始终是端点而不是中间件。

# bash - 如何从“查找”中排除所有“权限被拒绝”消息？

> ID：762348
> 
> 赞同：867
> 
> 时间：2009-04-17T21:54:07.073
> 
> 标签：bash, error-handling, find, file-permissions

我需要隐藏所有*权限被拒绝*的消息：

```
find . > files_and_folders 
```

当出现这样的消息时，我正在试验。我需要收集所有不会出现的文件夹和文件。

是否可以将权限级别定向到`files_and_folders`文件？

如何同时隐藏错误？

* * *

## 回答 #1

> 赞同：578
> 
> 时间：2009-04-17T21:57:42.587

采用：

```
find . 2>/dev/null > files_and_folders 
```

当然，这不仅隐藏了`Permission denied`错误，还隐藏了所有错误消息。

如果您真的想保留其他可能的错误，例如符号链接上的跳数过多，而不是权限被拒绝的错误，那么您可能不得不大胆猜测您没有很多名为“权限被拒绝”的文件并尝试：

```
find . 2>&1 | grep -v 'Permission denied' > files_and_folders 
```

* * *

如果您只想过滤标准错误，您可以使用更精细的构造：

```
find . 2>&1 > files_and_folders | grep -v 'Permission denied' >&2 
```

该`find`命令的 I/O 重定向是：`2>&1 > files_and_folders |`. 管道将标准输出重定向到`grep`命令并首先应用。将`2>&1`标准错误发送到与标准输出（管道）相同的位置。将`> files_and_folders`标准输出（但不是标准错误）发送到文件。最终结果是写入标准错误的消息被发送到管道中，并且常规输出`find`被写入文件。过滤标准输出（您可以决定您希望它的`grep`选择性，并且可能必须根据语言环境和 O/S 更改拼写）和最终`>&2`意味着幸存的错误消息（写入标准输出）再次进入标准错误。最终的重定向在终端可以被认为是可选的，但是在脚本中使用它是一个非常好的主意，这样错误消息就会出现在标准错误上。

这个主题有无穷无尽的变化，这取决于你想做什么。这将适用于具有任何 Bourne shell 衍生工具（Bash、Korn 等）的任何 Unix 变体和任何符合 POSIX 标准的[`find`](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/find.html).

如果您希望适应`find`系统上的特定版本，可能会有其他选项可用。特别是GNU`find`具有其他版本中不可用的无数选项 - 请参阅当前接受的一组选项的答案。

* * *

## 回答 #2

> 赞同：303
> 
> 时间：2016-10-31T03:51:28.573

笔记：

*   这个答案可能比用例保证的更深入，并且**`find 2>/dev/null`在许多情况下可能已经足够好了**。对于跨平台的观点和讨论一些先进的 shell 技术以找到尽可能健壮的解决方案可能仍然很有趣，即使所防范的情况可能在很大程度上是假设性的。

* * *

如果您的**shell 是`bash`或`zsh`**，那么有**一个解决方案既健壮又相当简单**，**只使用符合 POSIX 的`find`特性**；虽然`bash`它本身不是 POSIX 的一部分，但大多数现代 Unix 平台都附带了它，这使得该解决方案具有广泛的可移植性：

```
find . > files_and_folders 2> >(grep -v 'Permission denied' >&2) 
```

笔记：

*   **如果您的系统配置为显示*本地化*错误消息，请在`find`下面的调用前加上`LC_ALL=C`** ( `LC_ALL=C find ...`) 以确保报告*英文*消息，以便`grep -v 'Permission denied'`按预期工作。但是，任何*确实*显示的错误消息都将始终以英文显示。

*   `>(...)`是一个（很少使用的）*输出* [进程替换](http://mywiki.wooledge.org/ProcessSubstitution)，它允许将输出（在这种情况下，*stderr* output ( `2>`) 重定向到内部命令的标准输入`>(...)`。
    除了`bash`and之外`zsh`，*原则上*`ksh`也支持它们，但试图将它们与重定向结合起来*stderr*，就像这里 ( ) 所做的那样，似乎被默默地忽略了 (in )。**`2> >(...)``ksh 93u+`**

     ***   `grep -v 'Permission denied'`过滤*掉*( )包含该短语的`-v`所有行（来自命令的 stderr 流），并将剩余的行输出到 stderr ( )。`find``Permission denied``>&2`

    *   注意：完成*后*`grep`某些输出可能会到达的可能性很小，因为整个命令不会等待内部命令完成。在中，您可以通过附加到命令来防止这种情况。 *`find``>(...)``bash``| cat`*** 

 ***这种方法是：

*   **健壮**：`grep`仅适用于*错误消息*（而不适用于文件路径和错误消息的组合，可能导致误报），并且除了权限被拒绝的错误消息之外的错误消息被传递到标准错误。

*   **side-effect free** :`find`的退出代码被保留：无法访问遇到的至少一个文件系统项目会导致退出代码`1`（尽管这不会告诉您是否发生了除了权限被拒绝的错误之外的错误（也））*。*

* * *

### 符合 POSIX 标准的解决方案：

完全符合 POSIX 的解决方案要么有限制，要么需要额外的工作。

**如果无论如何要在*文件*`find`中捕获 ' 的输出***（或完全抑制），那么[Jonathan Leffler 的答案](https://stackoverflow.com/a/762360/45375)中基于管道的解决方案是简单、健壮且符合 POSIX 的：*

 *```
find . 2>&1 >files_and_folders | grep -v 'Permission denied' >&2 
```

请注意，重定向的顺序很重要：`2>&1`must come *first*。

预先在文件中捕获标准输出输出允许通过管道*仅*`2>&1`发送错误消息，然后可以明确地对其进行操作。*`grep`*

 *唯一的**缺点是*整个退出代码*将是`grep`命令的**，而不是`find`，这在这种情况下意味着：如果根本*没有*错误或*只有*权限被拒绝的错误，则退出代码将是`1`(signaling *failure* )，否则 (许可被拒绝以外的错误）`0`- 这与意图相反。
**也就是说，`find`的退出代码无论如何都很少使用**，因为它通常传达的信息很少，超出*基本*故障，例如通过不存在的路径。
但是，具体情况甚至只有*一些*由于缺少权限而无法访问的输入路径的一部分*反映*在`find`的退出代码中（在 GNU 和 BSD 中）：如果*任何*`find`处理的文件发生权限拒绝错误，则退出代码设置为.*`1`*

 *以下变体解决了以下问题：

```
find . 2>&1 >files_and_folders | { grep -v 'Permission denied' >&2; [ $? -eq 1 ]; } 
```

现在，退出代码指示是否发生了除此之外的任何错误*：* `Permission denied`如果`1`是，`0`否则。
换句话说：退出代码现在反映了命令的真实意图：`0`如果根本没有错误或*仅*发生权限拒绝错误，则报告成功（）。
可以说，这甚至比仅传递`find`的退出代码更好，就像顶部的解决方案一样。

* * *

[评论中的gniourf_gniourf](https://stackoverflow.com/users/1815797/gniourf-gniourf)建议使用复杂的重定向（仍然符合 POSIX）**对该解决方案进行泛化，**即使**将文件路径打印到*stdout***的默认行为也适用：

```
{ find . 3>&2 2>&1 1>&3 | grep -v 'Permission denied' >&3; } 3>&2 2>&1 
```

简而言之：自定义文件描述符`3`用于临时交换 stdout ( `1`) 和 stderr ( `2`)，因此可以通过 stdout将错误消息*单独*传送到。`grep`

如果没有这些重定向，数据（文件路径）*和*错误消息都将`grep`通过标准输出传送到，`grep`然后将无法区分*错误消息和* *名称恰好包含*短语`Permission denied`的（假设的）文件。*`Permission denied`*

 *然而，与第一个解决方案一样，报告的退出代码将是`grep`'s，而不是`find`'s，但可以应用与上述相同的修复。

* * *

### 现有答案的注释：

*   [关于Michael Brux 的回答](https://stackoverflow.com/a/25234419/45375)，有几点需要注意`find . ! -readable -prune -o -print`：

    *   它需要*GNU* `find`；值得注意的是，它不适用于 macOS。当然，如果您只需要使用 GNU 的命令`find`，这对您来说不是问题。

    *   一些`Permission denied`错误可能*仍然*会出现：`find ! -readable -prune`报告当前用户确实具有权限但缺少（可执行）权限的目录的*子项的此类错误。*原因是因为目录本身*是*可读的，没有被执行，然后尝试下降*到*该目录会触发错误消息。也就是说，*典型*的情况是权限丢失。`r``x`*`-prune`**`r`***

    ****   注意：以下几点是哲学和/或特定用例的问题，您可能会认为它与您无关，并且该命令很适合您的需求，特别是如果您只需要*打印*路径：

        *   *如果*您将权限拒绝错误消息的过滤概念化为您希望能够应用于*任何命令的**单独任务，那么主动**防止*权限拒绝错误的相反方法需要在命令中引入“噪音” ，这也引入了复杂性和逻辑*缺陷*。 *`find`*`find`**
        ****   例如，对 Michael 的回答（截至撰写本文时）投票最多的评论试图展示如何通过包含过滤器来*扩展*`-name`命令，如下所示：
            `find . ! -readable -prune -o -name '*.txt'`
            但是，这*不能*按预期工作，因为*需要*`-print`尾随操作（可以在[这个答案](https://stackoverflow.com/questions/1489277/how-to-use-prune-option-of-find-in-sh)中找到解释）。这种微妙之处可能会引入错误。******
****   正如他自己所说， [Jonathan Leffler 的回答](https://stackoverflow.com/a/762360/45375)中的第一个解决方案会**盲目地使*****所有*****错误消息**静音（而且解决方法很麻烦，而且并不完全可靠，正如他所解释的那样）。**然而，务实地说**，这是**最简单的解决方案**，因为您可能满足于假设任何和所有错误都与权限相关。`find . 2>/dev/null > files_and_folders`

    ******   [薄雾的答案](https://stackoverflow.com/a/27503763/45375)，简洁实用`sudo find . > files_and_folders`，但出于安全原因，除了***打印*****文件名****之外，其他任何事情都是不明智的***：因为你以*root*用户身份运行，“你有可能让你的整个系统被 find 中的错误搞砸或恶意版本，或意外写入某些内容的错误调用，如果您以正常权限运行此操作，则不会发生这种情况”（来自[Tripleee](https://stackoverflow.com/users/874188/tripleee)对雾的回答的评论）。*

    **   [viraptor 的答案](https://stackoverflow.com/a/762377/45375)中的第二个解决方案存在误报的`find . 2>&1 | grep -v 'Permission denied' > some_file`风险（由于通过管道发送 stdout 和 stderr 的混合），并且可能不是通过 stderr报告*非*许可拒绝错误，而是在输出路径旁边捕获它们在输出文件中。********* 

 ******* * *

## 回答 #3

> 赞同：299
> 
> 时间：2014-08-11T00:44:07.097

采用：

```
find . ! -readable -prune -o -print 
```

或更一般地说

```
find <paths> ! -readable -prune -o <other conditions like -name> -print 
```

*   避免“权限被拒绝”
*   并且不要抑制（其他）错误消息
*   并获得退出状态 0（“所有文件都已成功处理”）

适用于：find (GNU findutils) 4.4.2。背景：

*   测试`-readable`匹配可读文件。当`!`测试为假时，运算符返回真。并`! -readable`匹配不可读的目录（&files）。
*   该`-prune`操作不会下降到目录中。
*   `! -readable -prune`可以翻译为：如果目录不可读，请不要深入其中。
*   该`-readable`测试考虑了访问控制列表和`-perm`测试忽略的其他权限伪影。

有关更多详细信息，另请参见[`find`(1) 联机帮助页。](http://man7.org/linux/man-pages/man1/find.1.html)

* * *

## 回答 #4

> 赞同：119
> 
> 时间：2012-02-15T08:27:40.037

如果您想从根目录 "/" 开始搜索，您可能会看到如下输出：

```
find: /./proc/1731/fdinfo: Permission denied
find: /./proc/2032/task/2032/fd: Permission denied 
```

是因为许可。要解决这个问题：

1.  您可以使用 sudo 命令：

    ```
    sudo find /. -name 'toBeSearched.file' 
    ```

它询问超级用户的密码，当输入密码时，你会看到你真正想要的结果。如果您没有使用 sudo 命令的权限，这意味着您没有超级用户的密码，请先让系统管理员将您添加到 sudoers 文件中。

2.  您可以使用将标准错误输出从（通常显示/屏幕）重定向到某个文件，并避免在屏幕上看到错误消息！重定向到特殊文件 /dev/null ：

    ```
    find /. -name 'toBeSearched.file' 2>/dev/null 
    ```

3.  您可以使用将标准错误输出从（通常显示/屏幕）重定向到标准输出（通常显示/屏幕），然后使用带有 -v "invert" 参数的 grep 命令进行管道传输，以查看具有“权限被拒绝”的输出行词对：

    ```
    find /. -name 'toBeSearched.file' 2>&1 | grep -v 'Permission denied' 
    ```

* * *

## 回答 #5

> 赞同：102
> 
> 时间：2012-02-04T02:29:45.227

我不得不使用：

```
find / -name expect 2>/dev/null 
```

指定我想要查找的名称，然后告诉它将所有错误重定向到 /dev/null

期望是我正在寻找的期望程序的位置。

* * *

## 回答 #6

> 赞同：66
> 
> 时间：2009-04-17T21:59:16.357

使用**2>/dev/null**进行管道`stderr`传输`/dev/null`

 **`find . -name '...' 2>/dev/null`

* * *

## 回答 #7

> 赞同：30
> 
> 时间：2014-03-23T15:08:56.193

您还可以使用`-perm`and`-prune`谓词来避免进入不可读的目录（另请参阅[如何从 find 程序中删除“permission denied”打印输出语句？- Unix & Linux Stack Exchange](https://unix.stackexchange.com/questions/19430/how-do-i-remove-permission-denied-printout-statements-from-the-find-program/121020#121020)）：

```
find . -type d ! -perm -g+r,u+r,o+r -prune -o -print > files_and_folders 
```

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2009-04-17T21:57:44.567

重定向标准错误。例如，如果您在 unix 机器上使用 bash，您可以将标准错误重定向到 /dev/null，如下所示：

```
find . 2>/dev/null >files_and_folders 
```

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2016-02-01T22:57:56.910

虽然上述方法不能解决 Mac OS X 的情况，因为 Mac OS X 不支持`-readable`switch，但这是您可以避免输出中出现“Permission denied”错误的方法。这可能会帮助某人。

`find / -type f -name "your_pattern" 2>/dev/null`.

例如，如果您使用带有 的其他命令`find`来查找目录中特定模式的文件的大小，`2>/dev/null`仍然可以使用，如下所示。

`find . -type f -name "your_pattern" -exec du -ch {} + 2>/dev/null | grep total$`.

这将返回给定模式的文件的总大小。注意`2>/dev/null`find 命令末尾的。

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2009-04-17T22:00:10.897

这些错误被打印到标准错误输出 (fd 2)。要过滤掉它们，只需将所有错误重定向到 /dev/null：

```
find . 2>/dev/null > some_file 
```

或者先加入 stderr 和 stdout，然后用 grep 找出那些特定的错误：

```
find . 2>&1 | grep -v 'Permission denied' > some_file 
```

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2016-12-25T04:17:05.630

## 简单的回答：

`find . > files_and_folders 2>&-`

*[`2>&-`](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_07_06)关闭 ( `-`) 标准错误文件描述符 ( `2`)，因此所有错误消息都被静音。*

*   如果打印`1`任何“ ”错误，退出代码仍然存在`Permission denied`

## GNU 的可靠答案`find`：

`find . -type d \! \( -readable -executable \) -prune -print -o -print > files_and_folders`

*将额外的选项传递给`find`那个[`-prune`](https://www.gnu.org/software/findutils/manual/html_mono/find.html#index-g_t_002dprune-48)（防止下降到），但仍然是[`-print`](https://www.gnu.org/software/findutils/manual/html_mono/find.html#index-g_t_002dprint-66)任何目录（）不具有（）和权限，或（）任何其他文件。[`-type`](https://www.gnu.org/software/findutils/manual/html_mono/find.html#index-g_t_002dtype-31)`d`[`\!`](https://www.gnu.org/software/findutils/manual/html_mono/find.html#index-g_t_0021-57)[`-readable`](https://www.gnu.org/software/findutils/manual/html_mono/find.html#index-g_t_002dreadable-39)[`-executable`](https://www.gnu.org/software/findutils/manual/html_mono/find.html#index-g_t_002dexecutable-41)[`-o`](https://www.gnu.org/software/findutils/manual/html_mono/find.html#index-g_t_002do-62)`-print`*

*   [`-readable`](https://www.gnu.org/software/findutils/manual/html_mono/find.html#index-g_t_002dreadable-39)和[`-executable`](https://www.gnu.org/software/findutils/manual/html_mono/find.html#index-g_t_002dexecutable-41)options 是 GNU 扩展，不是[POSIX 标准的一部分](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/find.html)
*   可能仍会`Permission denied`在异常/损坏的文件上返回“”（例如，请参阅影响使用< v2.0.5的容器安装文件系统的[错误报告）](https://github.com/lxc/lxcfs/issues/149)`lxcfs`

## 适用于任何 POSIX 兼容`find`（GNU、OSX/BSD 等）的强大答案

`{ LC_ALL=C find . 3>&2 2>&1 1>&3 > files_and_folders | grep -v 'Permission denied'; [ $? = 1 ]; } 3>&2 2>&1`

*使用[管道](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_09_02)将标准错误流传递给[`grep`](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/grep.html)，删除包含该`'Permission denied'`字符串的所有行。*

*`LC_ALL=C`使用[环境变量](http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap08.html#tag_08_02)设置[POSIX 语言](http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap07.html#tag_07_02)环境，并[复制文件描述符](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_07_06)以将标准错误流通过管道传输到，并用于反转返回的错误代码以近似.`3>&2 2>&1 1>&3``3>&2 2>&1` `grep``[ $? = 1 ]`[`[]`](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/test.html)`grep``find`*

*   还将过滤`'Permission denied'`由于输出重定向引起的任何错误（例如，如果`files_and_folders`文件本身不可写）

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-09-16T00:59:49.617

为了避免*仅仅*出现权限被拒绝警告，请通过从搜索中删除它们来告诉 find 忽略不可读的文件。将表达式作为 OR 添加到您的查找中，例如

```
find / \! -readable -prune -o -name '*.jbd' -ls 
```

这主要是说*（匹配一个不可读的文件并从列表中删除它）*或*（匹配一个像**.j​​bd这样的名称*并显示它 [with ls]）*。（请记住，默认情况下，除非您使用 -or，否则表达式是 AND 一起使用的。）您需要在第二个表达式中使用 -ls，否则 find 可能会添加一个默认操作来显示任一匹配项，这也会显示所有不可读的文件.

但是如果你在你的系统上寻找真实的文件，通常没有理由去寻找 /dev，它有很多很多的文件，所以你应该添加一个不包括那个目录的表达式，比如：

```
find / -mount \! -readable -prune  -o  -path /dev -prune  -o  -name '*.jbd' -ls 
```

所以*（匹配不可读的文件并从列表中修剪）*或*（匹配路径 /dev 并从列表中修剪）*或*（匹配**.jbd之类的文件*并显示它）*。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2014-12-16T11:37:48.253

采用

```
sudo find / -name file.txt 
```

这很愚蠢（因为你提升了搜索）并且不安全，但写起来要短得多。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-12-22T11:06:40.663

以上答案都不适合我。我在 Internet 上找到的所有内容都集中在：隐藏错误。None 正确处理进程返回代码/退出代码。我在 bash 脚本中使用命令 find 来定位一些目录，然后检查它们的内容。我使用退出代码评估命令 find 是否成功：零值有效，否则失败。

[Michael Brux](https://stackoverflow.com/users/3701456/michael-brux)上面提供的[答案](https://stackoverflow.com/questions/762348/how-can-i-exclude-all-permission-denied-messages-from-find/25234419#25234419)有时有效。但我有一个失败的场景！我发现了问题并自己解决了。我需要在以下情况下修剪文件：

```
it is a directory AND has no read access AND/OR has no execute access 
```

看到这里的关键问题是：AND/OR。我读到的一个很好的建议条件序列是：

```
-type d ! -readable ! -executable -prune 
```

这并不总是有效。这意味着当匹配时触发修剪：

```
it is directory AND no read access AND no execute access 
```

当授予读取访问权限但没有执行访问权限时，此表达式序列将失败。

经过一些测试后，我意识到这一点并将我的 shell 脚本解决方案更改为：

> 不错的发现 /home*/ -maxdepth 5 -follow \
>     \( -type d -a **! \( -readable -a -executable \)** \) -prune \
>     -o \
>     \( -type d -a -readable -a -可执行文件 -a -name "${m_find_name}" \) -print

这里的关键是为组合表达式放置“不正确”：

```
has read access AND has execute access 
```

否则它没有完全访问权限，这意味着：修剪它。事实证明，在以前建议的解决方案失败的一种情况下，这对我有用。

我在评论部分提供了以下问题的技术细节。如果细节过多，我深表歉意。

*   ¿ 为什么使用命令 nice？我明白[了](https://unix.stackexchange.com/questions/19430/how-do-i-remove-permission-denied-printout-statements-from-the-find-program/19433#19433)。最初我认为在查看整个文件系统时降低进程优先级会很好。我意识到这对我来说毫无意义，因为我的脚本仅限于几个目录。我将 -maxdepth 减少到 3。
*   ¿ 为什么要在 /home*/ 中搜索？这与该线程无关。我通过非特权用户（不是root）编译的源代码手动安装所有应用程序。它们安装在“/home”中。我可以有多个二进制文件和版本一起生活。我需要以主从方式定位所有目录、检查和备份。我可以拥有多个“/home”（在专用服务器中运行的多个磁盘）。
*   ¿ 为什么使用 -follow？用户可能会创建指向目录的符号链接。它的用处取决于，我需要记录找到的绝对路径。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-12-27T04:02:43.893

您可以使用 grep -v invert-match

```
-v, --invert-match        select non-matching lines 
```

像这样：

```
find . > files_and_folders
cat files_and_folders | grep -v "permission denied" > files_and_folders 
```

应该到魔法

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2017-08-09T23:10:28.153

-=对于 MacOS=-

使用别名创建一个新命令：只需添加 ~/.bash_profile 行：

```
alias search='find / -name $file 2>/dev/null' 
```

在新的终端窗口中，您可以调用它：

```
$ file=<filename or mask>; search 
```

> 例如：
> 
> $文件=等；搜索

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2018-01-16T18:13:23.267

如果您使用的是 CSH 或 TCSH，这里有一个解决方案：

```
( find . > files_and_folders ) >& /dev/null 
```

如果要输出到终端：

```
( find . > /dev/tty ) >& /dev/null 
```

但是，[正如“csh-whynot”常见问题解答所述，您不应该使用 CSH。](http://www.faqs.org/faqs/unix-faq/shell/csh-whynot/)

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2021-06-25T10:15:48.960

只需使用它来搜索系统中的文件。

`find / -name YOUR_SEARCH_TERM 2>&1 | grep YOUR_SEARCH_TERM`

让我们不要做不必要的过度工程，您只想搜索您的文件对吗？如果文件存在于您可以访问的区域中，那么该命令将为您列出文件。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2021-09-22T19:50:27.463

## GNU `find`^(†的优化解决方案</sup>)

至少对于某些系统+文件系统组合，`find`不需要`stat`文件来获取其类型。然后，您可以在测试可读性之前检查它是否是一个目录，以加快搜索速度^(‡</sup> — 我所做的测试有 30% 的改进。因此，对于长时间搜索或经常运行的搜索，请使用以下之一：)

**打印所有可见的东西**

```
$ find . -print -type d ! -readable -prune
$ find . -type d ! -readable -prune , [expression] -print 
```

**打印可见*文件***

```
$ find . -type d \( ! -readable -prune -o -true \) -o [expression] -print 
```

**打印可见目录**

```
$ find . -type d -print ! -readable -prune
$ find . -type d \( ! -readable -prune , [expression] -print \) 
```

**仅打印*可读*目录**

```
$ find . -type d ! -readable -prune -o [expression] -print 
```

* * *

### 笔记

^(†</sup>`-readable`和`,`（逗号）运算符是 GNU 扩展。这个表达)

```
$ find . [expression] , [expression] 
```

*逻辑上*等价于

```
$ find . \( [expression] -o -true \) [expression] 
```

^(‡</sup> 这是因为`find`启用此优化的实现将`stat`在讨论的用例中完全避免使用非目录文件。)

* * *

### 编辑：外壳函数

这是我最终使用的 POSIX shell 函数，用于将此测试添加到任何表达式。`-print`使用隐式和命令行选项似乎可以正常工作：

```
findr () {
    j=$#; done=
    while [ $j -gt 0 ]; do
        j=$(($j - 1))
        arg="$1"; shift
        test "$done" || case "$arg" in
            -[A-Z]*) ;;  # skip options
            -*|\(|!)     # find start of expression
                set -- "$@" \( -type d ! -readable -prune -o -true \)
                done=true
                ;;
        esac
        set -- "$@" "$arg"
    done
    find "$@"
} 
```

答案中列出的其他两个替代方案导致 POSIX shell 中的语法错误（甚至无法获取包含函数定义的文件）或 ZSH 中的错误输出......运行时间似乎是相同的。

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2021-07-08T23:26:25.133

最小的解决方案就是添加`readable`标志。

`find . -name foo -readable`

# objective-c - Apple 代码：将 Object 初始化为 nil，然后

> ID：762362
> 
> 赞同：1
> 
> 时间：2009-04-17T21:57:55.177
> 
> 标签：objective-c

```
 - (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {

    // Date formatter for displaying dates
    static NSDateFormatter *dateFormatter = nil;
    if(dateFormatter == nil){
        dateFormatter = [[NSDateFormatter alloc] init];
        [dateFormatter setTimeStyle:NSDateFormatterMediumStyle];
        [dateFormatter setDateFormat:NSDateFormatterMediumStyle];
    } 
```

为什么我们初始化 dateFormatter 变量然后立即测试它是否为 nil？我在新的 Apple 代码中注意到了很多。好奇的！

-水牛

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-17T22:04:10.107

这是因为该变量是一个局部静态变量，这意味着即使在局部函数返回或超出范围后，它也会保持其值。因此，第一次执行函数时，变量设置为 nil。然后，检查 nil 并初始化变量（这只发生一次）。每隔一次执行该函数，该变量将有一个非零值，因此初始化代码块将不会被执行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T21:59:56.560

很可能是因为它是一个静态变量。换句话说，它的值在方法退出后不应该改变。很可能，这是因为您只需要在每个方法调用中都保留一个变量实例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T02:37:26.063

该变量是一个局部静态变量。它的值在方法调用之间保持不变。因此，在第一次调用时，它被初始化为 nil，然后它的值被重新分配给`NSDateFormatter*`. 在随后的调用中，该值非零（因为它已分配给`NSDateFormatter`实例的地址），因此不会重新初始化。

局部静态变量类似于命名空间范围的全局变量。*它的值对进程来说是全局的，但它只*在它被声明的范围内可见。

# .net - 开发移动网络应用程序

> ID：762379
> 
> 赞同：0
> 
> 时间：2009-04-17T22:00:44.250
> 
> 标签：.net, mobile

在开发移动 Web 应用程序时，与 .net 一起使用的最佳维护和推荐框架是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T22:20:42.470

如果您不解释应用程序的目的和功能，这很难回答。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T22:54:55.880

没有我知道的。我使用动态数据实体 Web 应用程序项目为移动内容创建了一个 cms，用于使用 CKEditor 管理内容，CKEditor 是一个常规的 asp.net Web 应用程序，用于处理门户和[wurfl](http://wurfl.sourceforge.net/)作为手机检测。

CMS 处理大约 50 个域。

# oop - Matlab子类化问题

> ID：762380
> 
> 赞同：3
> 
> 时间：2009-04-17T22:01:07.447
> 
> 标签：oop, matlab

关于matlab中子类化的问题，在新的类系统下。我的 A 类具有一些受保护的属性：

```
classdef Table < Base

properties (SetAccess = protected, GetAccess = public)
    PropA = [];
end %properties 
```

我想创建一个具有一些特殊功能的子类，并进一步限制对 PropA 的访问。（即在子类中将访问设为私有）。我的第一个想法是：

```
classdef subTable < Table

...
methods (Access = private)
    out = get.PropA(obj, value);
end %private methods 
```

但是，在帮助中它说：“您必须在不指定任何属性的方法块中定义属性访问方法。” 这么多的想法。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-25T18:12:56.930

我不相信这是可能的。来自[MATLAB 文档](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_oop/brenyev-1.html#zmw57dd0e11935)：

只有两个条件允许您重新定义超类属性：

*   超类属性 Abstract 属性设置为 true
*   超类属性的 SetAccess 和 GetAccess 属性都设置为私有

我也不认为这样做是个好主意。它违反了里氏[替换原则](http://en.wikipedia.org/wiki/Liskov_substitution_principle)。为接受表而编写的函数也应该能够接受子表并正常工作。如果这样的函数访问 PropA，它会在传递子表时失败。

# php - PHP 函数 strtotime() 支持哪些日期格式？

> ID：762389
> 
> 赞同：4
> 
> 时间：2009-04-17T22:04:49.480
> 
> 标签：php, datetime

我真的很喜欢 PHP 函数 strtotime()，但是[用户手册](http://ca.php.net/strtotime)并没有给出支持的日期格式的完整描述。它只给出了几个例子，例如“2000 年 9 月 10 日”、“+1 周 2 天 4 小时 2 秒”和“下周四”。

在哪里可以找到完整的说明？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-17T22:04:59.713

我找不到任何官方的东西，但我看到[一个教程](http://www.programmers-corner.com/viewTutorial.php/80)说 strtotime() 使用 GNU 日期输入格式。这些[在 GNU 手册](http://www.gnu.org/software/tar/manual/html_node/Date-input-formats.html)中有详细描述。

我注意到的一个差异是“下一个”与 GNU 手册中描述的行为不匹配。使用 strtotime()，"next Thursday" 将给出与 "Thursday" 相同的结果，除非今天是星期四。

如果今天是星期四，那么

*   strtotime("星期四") == strtotime("今天")
*   strtotime("下周四") == strtotime("今天 + 7 天")

如果今天不是星期四，那么

*   strtotime("星期四") == strtotime("下星期四")

我正在使用 PHP 5.2.6。

**更新：**

我想自从我发布此用户手册以来已经更新了用户手册，否则我是盲目的。它现在包含指向“[日期和时间格式”一章](http://php.net/manual/en/datetime.formats.php)的链接，其中包括有关[相对格式](http://php.net/manual/en/datetime.formats.relative.php)的部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T00:12:50.360

您可以通过查看以下 C 代码来开始跟踪它在做什么：

[http://cvs.php.net/viewvc.cgi/php-src/ext/date/php_date.c](http://cvs.php.net/viewvc.cgi/php-src/ext/date/php_date.c)

搜索 PHP_FUNCTION(strtotime)

这也是主要的正则表达式解析：

[http://cvs.php.net/viewvc.cgi/php-src/ext/date/lib/parse_date.re](http://cvs.php.net/viewvc.cgi/php-src/ext/date/lib/parse_date.re)

祝你好运

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T23:40:24.290

根据我的经验，strtotime() 可以接受任何看起来像约会的东西。找出它的边界的最好方法是创建一个测试脚本并插入值，看看什么有效，什么无效。

```
$input = "Apr 10th";
print(date('Y-m-d', strtotime($input))); 
```

只需不断更改 $input 变量并观察结果即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T00:24:11.610

基本上，[日期](http://ca.php.net/manual/en/function.date.php)可以创建 strtotime 的任何内容都会解析。除了一个例外，它确实存在非美式格式的问题。因此，请保持月-日-年类型格式不变。

# firefox - Firefox：获取视口的实际屏幕位置

> ID：762394
> 
> 赞同：1
> 
> 时间：2009-04-17T22:06:30.913
> 
> 标签：firefox, location, viewport

对于firefox，无论如何确定“视口”（即客户区）的TopLeft位置？我知道高度/宽度可通过 window.innerHeight 和 window.innerWidth 获得。但我还需要知道“innerTop”和“innerLeft”（不存在）。

谢谢，

抢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T03:49:07.157

如果可以获取鼠标事件，可以查看它的[event.screenX](https://developer.mozilla.org/en/DOM/event.screenX) /screenY 属性并减去 event.clientX/clientY 属性。这甚至是跨浏览器兼容的（DOM 2 级事件）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-19T08:51:07.657

*   [`window.innerHeight`](https://developer.mozilla.org/en/DOM/window.innerHeight#Example)- 文档区域的高度。
*   `window.outerHeight`- 整个窗口的高度。

你可以从另一个中减去一个，得到文档区域到窗口顶部的距离，再加上状态栏的高度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-19T10:05:39.567

Try this:

```
document.documentElement.getBoundingClientRect() 
```

The result of this function will have a left and a top property which will give you what you need.

Note: This function is implemented in Fx3 so you'll need the DOM-traversing offsetParent iteration for older versions.

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2013-05-22T05:00:13.143

这似乎也给出了从文档顶部到视口的偏移量：

`window.pageYOffset`

# .net - WPF等待光标与BackgroundWorker线程

> ID：762396
> 
> 赞同：3
> 
> 时间：2009-04-17T22:07:23.157
> 
> 标签：.net, wpf, multithreading, backgroundworker, mouse-cursor

我想在 BackgroundWorker 进程在另一个线程中运行时显示沙漏光标并禁用窗口。

这就是我正在做的事情：

```
Private Sub MyButton_Click(...)
    Dim box As New AnotherWpfWindow()
    box.Owner = Me
    ...
    box.ShowDialog()
    If (box.DialogResult.GetValueOrDefault = True) Then
        Me.IsEnabled = False
        Me.Cursor = Cursors.Wait
        MyBackgroundWorker.RunWorkerAsync()
    End If
End Sub

Private Sub MyBackgroundWorker_RunWorkerCompleted(...)
    UpdateInterface()
    Me.IsEnabled = True
    Me.Cursor = Cursors.Arrow
End Sub 
```

窗口像我想要的那样被禁用，但光标仍然是一个箭头。我怎样才能使它成为等待光标？

根据这个问题 ，它似乎适用于[vg1890 ：](https://stackoverflow.com/users/31221/vg1890) [Disabling all but one control in a WPF window](https://stackoverflow.com/questions/273809/disabling-all-but-one-control-in-a-wpf-window)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-11-21T11:36:55.267

另一种方法是全局更改光标，是..

```
Mouse.OverrideCursor = Cursors.Wait;

//Do something
//...

Mouse.OverrideCursor = null; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-17T22:26:16.760

这里似乎发生的是 WPF 忽略了禁用窗口上的光标设置。以下解决方法似乎有效：不是禁用窗口本身，而是禁用窗口的*内容*：

C＃：

```
((UIElement)Content).IsEnabled = false;
Cursor = Cursors.Wait;

// and in RunWorkerCompleted handler:
((UIElement)Content).IsEnabled = true;
Cursor = Cursors.Arrow; 
```

视觉基础：

```
DirectCast(Content, UIElement).IsEnabled = False
Cursor = Cursors.Wait

' and in RunWorkerCompleted handler:'
DirectCast(Content, UIElement).IsEnabled = True
Cursor = Cursors.Arrow 
```

# perl - 按哈希值哈希的哈希值排序 Perl

> ID：762399
> 
> 赞同：3
> 
> 时间：2009-04-17T22:09:28.877
> 
> 标签：perl, sorting, hash, perl-data-structures

我有一个类似于以下的哈希结构：

```
KeyA => {
         Key1 => {
                   Key4 => 4
                   Key5 => 9
                   Key6 => 10
                 }
         Key2 => {
                   Key7 => 5
                   Key8 => 9
                 }
        }
KeyB => {
         Key3 => {
                   Key9 => 6
                   Key10 => 3
                 }
        } 
```

我需要打印出通过哈希结构的遍历路径和遍历结束时的值，以便按值排序。例如，对于上面的哈希结构，我需要打印：

```
KeyB Key3 Key10 3
KeyA Key1 Key4  4
KeyA Key2 Key7  5
KeyB Key3 Key9  6
KeyA Key2 Key8  9
KeyA Key1 Key5  9
KeyA Key1 Key6  10 
```

目前，为了解决这个问题，我正在使用嵌套的 foreach 循环遍历哈希结构，并通过插入一个键等于遍历路径（例如“KeyA Key3 Key10”）且值等于末尾值的元素来创建扁平哈希遍历路径（例如 3），然后执行另一个 foreach 循环，按值对展平的哈希进行排序。

有没有更有效的方法来做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T22:28:35.773

考虑创建一个排序数组，而不是创建一个新的哈希。遍历初始值，根据值，键值对插入到数组中，然后遍历结果数组。这应该在初始迭代中为您提供 O(n) + 每个插入的 O(lg n) + 最后迭代的 O(n)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T07:16:38.577

您还可以使用递归解决方案为任意嵌套深度的嵌套数据结构解决此问题。您递归地构建一个包含路径和值的目标数组，然后对该数组进行排序。

```
use warnings;
use strict;

sub paths {
    my ($data, $cur_path, $dest) = @_; 
    if (ref $data eq 'HASH') {
        foreach my $key (keys %$data) {
            paths($data->{$key}, [@$cur_path, $key], $dest);
        }   
    } else {
        push @$dest, [$cur_path, $data];
    }   
}

my $data = {
    KeyA => {
        Key1 => { Key4 => 4, Key5 => 9, Key6 => 10 },
        Key2 => { Key7 => 5, Key8 => 9 }
    },
    KeyB => { Key3 => { Key9 => 6, Key10 => 3 } }
};

my $dest = []; 
paths($data, [], $dest);

foreach my $result (sort { $a->[1] <=> $b->[1] } @$dest) {
    print join(' ', @{$result->[0]}, $result->[1]), "\n";
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T02:02:42.263

对于您给出的数据结构，嵌套循环并没有真正的替代方案。（可能有更好的数据结构，但我们无法知道。）我会这样编码：

```
use strict;
use warnings;

my %hash = (
    KeyA => {
        Key1 => {
            Key4 => 4,
            Key5 => 9,
            Key6 => 10,
        },
        Key2 => {
            Key7 => 5,
            Key8 => 9,
        },
    },
    KeyB => {
        Key3 => {
            Key9 => 6,
            Key10 => 3,
        },
    },
);

my @array;
while (my ($k1, $v1) = each %hash) {
    while (my ($k2, $v2) = each %$v1) {
        while (my ($k3, $v3) = each %$v2) {
            push @array, [$k1, $k2, $k3, $v3];
        }
    }
}

foreach my $x (sort { $a->[-1] <=> $b->[-1] } @array) {
    print join(' ', @$x), "\n";
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-17T06:16:38.883

使用多维散列仿真将其转换为平面散列（参见 perlvar 中的 $;），然后对生成的散列进行排序。

```
use strict;
use warnings;
my %hash = (
    KeyA => {
          Key1 => {
                    Key4 => 4,
                    Key5 => 9,
                    Key6 => 10,
                  },
          Key2 => {
                    Key7 => 5,
                    Key8 => 9,
                  }
         },
    KeyB => {
          Key3 => {
                    Key9 => 6,
                    Key10 => 3,
                  },
         },
);

my %fhash = 
   map {
        my @fh;
        foreach my $k2 (keys %{$hash{$_}}) {
                foreach my $k3 (keys %{$hash{$_}{$k2}}) {
                        push @fh, (join($;, $_, $k2, $k3) => $hash{$_}{$k2}{$k3});
                }   
        }
        @fh;
   } keys %hash;

foreach (sort { $fhash{$a} <=> $fhash{$b} } keys %fhash) {
    printf("%s\t%d\n", join("\t", split(/$;/, $_)), $fhash{$_});
} 
```

您可以将生成 fhash 的 map / foreach 循环直接传递给排序。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2010-08-17T02:42:07.303

这些其他解决方案似乎更优雅，因为它们“聪明”。但是，鉴于您的数据结构的简单性，您的方法实际上很好。这种结构很容易变平。您要求提供更有效的解决方案，但没有提供。

# java - 如何显示数组列表中的所有元素？

> ID：762400
> 
> 赞同：19
> 
> 时间：2009-04-17T22:09:47.737
> 
> 标签：java, arraylist, car-analogy

假设我有一个带有属性的汽车类`make`，`registration`并且我创建了一个 ArrayList 来存储它们。如何显示 ArrayList 中的所有元素？

我现在有这个代码：

```
public Car getAll()
{
    for(int i = 0; i < cars.size(); i++) //cars name of arraylist
    {
        Car car = cars.get(i);  
        {
            return cars.get (i);
        }
    }
    return null;
} 
```

它编译得很好，但是当我使用以下代码在我的测试器类中尝试它时：

```
private static void getAll(Car c1)
{
    ArrayList <Car> cars = c1.getAll(); // error incompatible type
    for(Car item : cars)
    {   
        System.out.println(item.getMake()
                + " "
                + item.getReg()
                );
    }
} 
```

我收到不兼容类型的错误。我的编码正确吗？如果没有，有人可以告诉我应该怎么做吗？

谢谢你

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-17T22:20:07.680

你想制作这样的东西吗？

```
public List<Car> getAll() {
    return new ArrayList<Car>(cars);
} 
```

然后调用它：

```
List<Car> cars = c1.getAll();
for (Car item : cars) {   
    System.out.println(item.getMake() + " " + item.getReg());
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T22:13:06.467

你的`getAll()`方法没有得到全部。它返回第一辆车。

该`return`语句终止循环。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T22:14:09.880

您收到错误是因为 Car 类中的 getAll 函数返回一个 Car 并且您希望将其分配到数组中。

这真的不清楚，您可能想发布更多代码。你为什么将一个 Car 传递给函数？在汽车上调用 getAll 是什么意思。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-17T23:34:33.213

另一种方法是`toString()`向您的`Car`类添加一个方法，然后让`toString()`ArrayList 的方法完成所有工作。

```
@Override
public String toString()
{
    return "Car{" +
            "make=" + make +
            ", registration='" + registration + '\'' +
            '}';
} 
```

您不会在输出中每行得到一辆汽车，但如果您只想查看数组中的内容，它会快速而简单。

```
List<Car> cars = c1.getAll();
System.out.println(cars); 
```

输出将是这样的：

```
[Car{make=FORD, registration='ABC 123'},
Car{make=TOYOTA, registration='ZYZ 999'}] 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-17T22:20:14.297

根本不清楚你在做什么。您的函数 getAll() 应该返回 List<Car>，而不是 Car。否则，为什么叫它getAll？

如果你有

```
Car[] arrayOfCars 
```

并想要一个列表，您可以简单地这样做：

```
List<Car> listOfCars = Arrays.asList(arrayOfCars); 
```

数组[在此处](http://java.sun.com/javase/6/docs/api/java/util/Arrays.html)记录。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-17T23:14:28.423

切线：String.format() 岩石：

```
public String toString() {
    return String.format("%s %s", getMake(), getReg());
}

private static void printAll() {
    for (Car car: cars)
        System.out.println(car); // invokes Car.toString()
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-09-06T06:13:04.410

为每个循环设置以获取所有值

```
for (String member : members){
    Log.i("Member name: ", member);
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-17T22:21:56.337

嗨，抱歉，第二个代码应该是：

私人静态无效getAll（CarList c1）{

```
ArrayList <Car> cars = c1.getAll(); // error incompatible type
for(Car item : cars)
{   
      System.out.println(item.getMake()
                       + " "
                       + item.getReg()
                       );
} 
```

}

我有一个名为 CarList 的类，其中包含 arraylist 及其方法，所以在测试器类中，我基本上有这段代码来使用该 CarList 类：

汽车清单 c1; c1 = new CarList();

其他一切正常，例如添加和删除汽车以及显示单独的汽车，我只需要一个代码来显示数组列表中的所有汽车。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-05-11T06:56:13.117

Arraylist 使用 Iterator 接口遍历元素 **使用 this**

```
public void display(ArrayList<Integer> v) {
        Iterator vEnum = v.iterator();
        System.out.println("\nElements in vector:");
        while (vEnum.hasNext()) {
            System.out.print(vEnum.next() + " ");
        }
    } 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2017-08-19T15:05:01.817

您可以使用`arraylistname.clone()`

# database - 数据库 - 数据版本控制

> ID：762405
> 
> 赞同：57
> 
> 时间：2009-04-17T22:12:11.820
> 
> 标签：database, database-design, versioning

关于在数据库中对数据进行版本控制，我已经阅读了一些关于 SO（例如[这个）的问题。](https://stackoverflow.com/questions/39281/database-design-for-revisions)

我喜欢上面提到的一些建议。很长一段时间以来，我一直想要（需要）修改我的许多表格，但一直没有解决。作为一名只有简单数据库工作的程序员，我想知道一个人将如何真正做到这一点。

我不是在要求 SQL 语法中的实际解决方案。我最终可以自己解决这个问题（或者在时机成熟时发布 SO）。我只是要求人们评论他们将如何去做，如果我要“修改”数亿条记录，可能会出现任何潜在的性能问题。或任何其他建议，只要它基于以下示例即可。

举一个简单的例子：

```
Person
------------------------------------------------
ID                UINT NOT NULL,
PersonID          UINT NOT NULL,
Name              VARCHAR(200) NOT NULL,
DOB               DATE NOT NULL,
Email             VARCHAR(100) NOT NULL

Audit
------------------------------------------------
ID                UINT NOT NULL,
UserID            UINT NOT NULL,               -- Who
TableName         VARCHAR(50) NOT NULL,        -- What
OldRecID          UINT NOT NULL,               -- Where
NewRecID          UINT NOT NULL,
AffectedOn        DATE NOT NULL,               -- When
Comment           VARCHAR(500) NOT NULL        -- Why 
```

如果 TableName 是字符串，我不确定如何将 Audit 表链接到任何其他表（例如 Person）？

另外，假设我要填充三个 GUI：

1.  特定人员 ID 的完整记录
2.  列出所有人员的表格视图（按 id）
3.  在每个条目下方显示每个人及其修订信息的视图（每人的修订数量、修订日期、修订评论等），按最新修订排序。

完成1和2，查询Person表好还是Audit表好？

要完成 3，所谓的数据库专家会简单地获取所有记录并将其传递给软件进行处理，还是按 PersonID 和受影响日期分组？这通常是在一个查询中处理还是在多个查询中处理？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-04-17T22:33:00.677

多年来，我已经完成了各种审计计划，目前我将实施这样的事情：

```
Person
------------------------------------------------
ID                UINT NOT NULL,
PersonID          UINT NOT NULL,
Name              VARCHAR(200) NOT NULL,
DOB               DATE NOT NULL,
Email             VARCHAR(100) NOT NULL

Person_History
------------------------------------------------
ID                UINT NOT NULL,
PersonID          UINT NOT NULL,
Name              VARCHAR(200) NOT NULL,
DOB               DATE NOT NULL,
Email             VARCHAR(100) NOT NULL
AuditID           UINT NOT NULL

Audit
------------------------------------------------
ID                UINT NOT NULL,
UserID            UINT NOT NULL,               -- Who
AffectedOn        DATE NOT NULL,               -- When
Comment           VARCHAR(500) NOT NULL        -- Why 
```

当前记录始终在 Person 表中。如果有更改，则创建审计记录并将旧记录复制到 Person_History 表中（注意 ID 不会更改，可以有多个版本）

审核 ID 位于 *_History 表中，因此您可以根据需要将多个记录更改链接到一个审核记录。

编辑：
如果您没有每个基表的单独历史记录表，并且想要使用同一个表来保存旧的和“已删除”的记录，那么您必须用状态标志标记记录。问题是在查询当前记录时真的很痛苦——相信我，我已经做到了。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-18T17:06:06.913

您如何正常创建表，在每条记录上都有一个 ModifiedDate Colm（如果您愿意，还有 ModifiedBy），并通过物化视图进行所有数据访问，该视图按 Id 对数据进行分组，然后执行 HAVING ModifiedDate = MAX(ModifiedDate )?

这样，添加与另一个具有相同 ID 的新记录将从视图中删除旧记录。如果要查询历史，请不要通过视图

我一直发现使用相同的 Colm 维护不同的表很复杂且容易出错。

编辑：我写这个答案 12 年后才回到这个答案。我会说最初的问题被误导了-您应该审核用户级别的事件，而不是对数据库列的更改。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T16:58:07.603

在 DJ 发表的使用每个基表的历史表和 Karl 对可能的性能问题发表的评论之后，我进行了一些 SQL 研究，以找出将记录从一个表传输到另一个表的最快方法。

我只是想记录我的发现：

我认为我必须执行 SQL 提取以从基表加载记录，然后执行 SQL 推送以将记录放入历史记录表，然后更新基表以插入更改的数据。总共 3 笔交易。

但令我惊讶的是，我意识到您可以使用 SELECT INTO 语法使用一个 SQL 语句来执行前两个事务。我打赌性能会快一百倍。

然后，我们只需使用基表中的新数据更新记录。

我仍然没有找到一条 SQL 语句来一次完成所有 3 个事务（我怀疑我会这样做）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T18:18:49.657

我喜欢你的审计表，这是一个好的开始。您的审计表存在基数问题，因此我将其分解为两个表：

```
Person
------------------------------------------------
ID                UINT NOT NULL,
PersonID          UINT NOT NULL,
Name              VARCHAR(200) NOT NULL,
DOB               DATE NOT NULL,
Email             VARCHAR(100) NOT NULL,
AuditID           UINT NOT NULL 

Audit
------------------------------------------------
ID                UINT NOT NULL,
TableName         VARCHAR(50) NOT NULL,        -- What
TableKey          UINT NOT NULL,
CreateDate        DATETIME NOT NULL  DEFAULT(NOW),
CreateUserID      UINT NOT NULL,
ChangeDate        DATETIME NOT NULL  DEFAULT(NOW),
ChangeUserID      UINT NOT NULL

Audit_Item
------------------------------------------------
ID                UINT NOT NULL,
AuditID           UINT NOT NULL,               -- Which audit record
UserID            UINT NOT NULL,               -- Who
OldRecID          UINT NOT NULL,               -- Where
NewRecID          UINT NOT NULL,
AffectedOn        DATE NOT NULL,               -- When
Comment           VARCHAR(500) NOT NULL        -- Why 
```

建议的初始布局有一个审计记录，它指向（我假设）两个人员记录。这种设计的挑战是：

*   您的人员表中的哪些记录是当前的“真实”记录？
*   您如何表示对 Person 记录的整个更改历史？如果您指向 Person 表中的两条记录，那么请参阅第 1 点：哪一条是当前记录？
*   Create*、Change* 字段从 Audit_Item 记录的集合中汇总。它们只是为了方便访问而存在。
*   Person 表中的 AuditID 键允许您指向 Audit 表并获取单个 Person 的历史记录，而无需使用子句查询 Audit 表`WHERE TableName='Person'`

# javascript - IE7 在某些机器上崩溃，调试栏中出现错误，但看不到“showstopper”

> ID：762414
> 
> 赞同：1
> 
> 时间：2009-04-17T22:17:06.113
> 
> 标签：javascript, jquery, internet-explorer

我最近被告知我的网站在 IE7 中崩溃。我自己在一堆机器上测试过它，但当然它总是运行完美。我哥哥刚刚在他的电脑上给我看了IE7，它肯定会崩溃。

我已经运行了“调试栏”，它在 HTMLCheck 中显示了一些错误，并警告说 fb:login-button 无法识别（但当然是允许的）。

我运行 javascript 检查，它说

```
脚本错误：
//----------------
线路：1
字符：6
代码：0
错误消息：语法错误

```

我自己实际上看不到任何脚本错误。

链接是[http://HearWhere.com](http://HearWhere.com)

如果有人可以帮助我弄清楚为什么 15% 左右的 IE 用户会失败，我会非常非常感激。皮特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T19:04:51.917

肯定会在我拥有的虚拟机上使 IE7 崩溃。值得一开始做一些审计——例如，你包含并调用了 Google Analytics JS 两次，如果没有别的，这可能会搞砸你的统计数据。

我之前在 IE7 中遇到过与 jQuery 相关的崩溃，所有这些都可以归结为大型 jQuery 循环。看看你的代码和注释部分，你正在循环一个可能有大量结果的 jQuery 选择的结果，或者当你向 DOM 中插入大量元素的时候。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T14:03:31.723

IE8 有一个非常好的 javascript 调试器，但对我来说它不会在 IE8 中崩溃。以前我在 IE 6 和 7 中使用 Microsoft Script Editor 进行调试。出于某种奇怪的原因，它与 Microsoft Office 捆绑在一起！设置有点麻烦，但它可以工作。

[http://www.jonathanboutelle.com/mt/archives/2006/01/howto_debug_jav.html](http://www.jonathanboutelle.com/mt/archives/2006/01/howto_debug_jav.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T15:34:36.897

没有 Javascript 错误（根据 FireBug），但该页面的 CSS 中存在大量错误，其中任何一个都可能与 IE7 产生冲突。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-21T06:15:39.697

如果您正在崩溃，则 JS 代码不是可能的原因。您需要查看隔离特定操作系统、IE 版本号、补丁级别和外部依赖项（闪存版本等）。

# vb.net - 获取继承类的名称

> ID：762415
> 
> 赞同：1
> 
> 时间：2009-04-17T22:17:37.280
> 
> 标签：vb.net, inheritance

在下面的模型中，我如何从方法 DoMagix() 中找出我是 FooDAL 还是 WeeDAL 的实例？

```
Public MustInherit Class DataAccessClass
    Public Sub DoMagix()
        '** LOOK AT ME!!! **
        'Who am I? Why am I here? Where am I going? 
        '** /LOOK AT ME!!! **
    End Sub
End Class

Public Class FooDAL
   Inherits DataAccessClass
End Class

Public Class WeeDAL
   Inherits DataAccessClass
End Class 
```

我的 OO 技能很烂，所以如果我弄错了术语，请打我一巴掌，让我变直（请按这个顺序）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T22:19:32.067

~~首先，DoMagix 应该是“可覆盖的”。~~

您可以在 DoMagix 中使用 GetType(Me) 来了解它在运行时是什么类型。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T10:16:20.797

“时空旅行者”在评论中写下了答案：

我认为 Overridable 是没有必要的；但是，它应该使用 Me.GetType()，它是多态的，并且即使 DoMagix 没有设置为 Overridable，也应该获得正确的类型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-03-29T09:14:41.437

希望我能“复活”这个话题。我遇到了类似的问题，除了我需要一个共享属性来返回子名称......所以我......构造不起作用。我知道，这被认为是糟糕的设计，但我没有更好的主意 - 除了一堆重复的代码......我的目标与 OP 的目标非常相似......如何将“A”放入基类的 XString没有实例的属性...？（xd 是一个 XMLDocument...）

```
Public MustInherit Class MinMax

    Protected Shared Property XString As String = ???

    Public Shared Function isValid(value As String) As Boolean
        Return min <= value <= max
    End Function

    Private Shared ReadOnly Property min As Double
        Get
            Return xd.SelectSingleNode(String.Format("FOEB/Restrictions/{0}", XString)).InnerText.Split("..")(0)
        End Get
    End Property
    Private Shared ReadOnly Property max As Double
        Get
            Return xd.SelectSingleNode(String.Format("FOEB/Restrictions/{0}", XString)).InnerText.Split("..")(1)
        End Get
    End Property
End Class 
```

类用法：

```
Public Class Restrictions
    Public Class A
        Inherits MinMax
    End Class
    Public Class B
        Inherits MinMax
    End Class

End Class

dim isOk as Boolean= Restrictions.A.isValid("10") 
```

对应的 XML

```
<?xml version="1.0" encoding="utf-8" ?>
<FOEB>
  <Restrictions>
    <A>1..21</A>
  </Restrictions>
</FOEB> 
```

所以返回值应该是 TRUE

Xstring 受到保护，因为我试图在孩子中隐藏/覆盖 - 运气不好，所以它实际上与这种方式无关

# javascript - 为什么 chrome 不运行这个 javascript

> ID：762416
> 
> 赞同：9
> 
> 时间：2009-04-17T22:17:37.767
> 
> 标签：javascript, google-chrome

当我在 Chrome（版本 2）中运行它时，它不会返回字符串，但它可以在 Firefox（版本 3）中运行。为什么是这样？

```
<html>
<head>
<script type="text/javascript">
function disp_prompt() {
    var name=prompt("Please enter your name","Harry Potter");
    if (name!=null && name!="") {
        document.write("Hello " + name + "! How are you today?");
    }
}
</script>
</head>
<body>

<input type="button" onclick="disp_prompt()" value="Display a prompt box" />

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-18T02:56:00.827

要将内容附加到文档，您应该只`document.write()`在 <script>-block 解析阶段调用。

如果您调用了`document.write`它在该上下文之外执行的某个地方，例如在您的事件处理程序中，则不会进行解析，因此该字符串无处`'foo'`可去。

根据[原始 JavaScript 参考](http://docs.sun.com/source/816-6408-10/document.htm#1221642)应该发生的是：

> 事件处理程序在原始文档关闭后执行，因此如果您没有在事件处理程序中显式发出 document.open 方法，则 write 方法会隐式打开 mimeType text/html 的新文档。

也就是说，它假设您犯了一个错误并且打算这样做：

```
document.open('text/html');
document.write(html); 
```

它将整个文档替换为新内容。您还会注意到，因为您没有通过调用完成该操作：

```
document.close(); 
```

...在 Firefox 中，“正在加载”的 throbber 仍然处于动画状态，期望将更多内容写入文档（但它永远不会出现）。

在这种情况下，您正在`document.write()`输入一个字符串：

```
Hello bobince! How are you today? 
```

这显然不是一个有效的 HTML 文档。Chrome（和 Safari，行为相同）试图将其解析为 HTML 文档，但由于它是文档元素 (<html>) 之外的非空白文本内容而失败，这是不允许的。如果您在名称输入中放置一些标签：

```
Hello <em>bobince</em>! How are you today? 
```

你会看到 <em> 元素之外的所有东西都被丢弃了。Firefox 和 IE 设法应用他们的“修复任何元素之外的文本”损坏的 HTML 规则来拯救你，但 Chrome 没有。

如果你想要`document.write()`一个新文件，你应该确保它确实是一个完整的文件：

```
<html><head><title>Greetings</title><body><p>Hello bobince! How are you today?</p></body></html> 
```

或者，如果你想要`document.write()`一个文本字符串，理论上你应该调用：

```
document.open('text/plain'); 
```

在 write() 之前。但请注意，Chrome 或 Safari 不支持 mimetype 参数；他们将始终将您编写的内容视为 HTML。

无论如何，**您可能不想使用这种方法**。如果您想添加（或更改）现有页面，您通常应该使用 DOM 方法，例如在状态输出 div 上设置文本，或使用 innerHTML 替换正文内容。

`document.write()`在一些地方需要（特别是当您从头开始创建新窗口或框架时），但否则通常是错误的，应该怀疑。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-17T22:26:21.893

不要使用 document.write。如果你把它改成类似

```
if (name != null && name != "") {
    document.getElementById('foo').innerHTML = "Hello " + name + "! How are you today?";
}

<body>
<input ...

<div id='foo'> </div>
</body> 
```

document.write 有很奇怪的行为。您希望将文本写入哪里？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-17T23:37:14.533

只需在 write 调用中添加一些段落标签：

```
<html>
<head>
<script type="text/javascript">

function disp_prompt() {
    var name = window.prompt("Please enter your name", "Harry Potter");
    if (name) {
        window.document.write("<p>Hello " + name + "! How are you today?<\/p>");
    }
}
</script>
</head>
<body>

<input type="button" onclick="disp_prompt()" value="Display a prompt box" />

</body>
</html> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-07-16T14:57:41.677

参加聚会有点晚了，但我`document.write()`在 Chrome DevTools 中看到了一个带有链接的违规行为。不用说，这是一本有趣的书。

**这是关于什么的？**

`document.write()`从 Chrome v55 开始，Chrome 将在一组非常选择的情况下开始阻止。你可以在这里读到它：

[https://developers.google.com/web/updates/2016/08/removing-document-write](https://developers.google.com/web/updates/2016/08/removing-document-write)

这应该**只**对使用 2G 蜂窝连接的用户以及可能其他类型的连接速度较慢的用户生效。以下是相关文章的摘录：

> 考虑到这些数据，Chrome 从版本 55 开始，当我们通过更改 Chrome 中处理 document.write() 的方式检测到这种已知的不良模式时，Chrome 会代表所有用户进行干预（请参阅 Chrome 状态）。具体来说，当满足以下所有条件时，Chrome 将不会执行通过 document.write() 注入的元素：
> 
> 1.  用户的连接速度很慢，特别是当用户使用 2G 时。（将来，这种变化可能会扩展到其他连接速度较慢的用户，例如慢速 3G 或慢速 WiFi。）
> 2.  document.write() 位于顶级文档中。干预不适用于 iframe 中的 document.written 脚本，因为它们不会阻止主页的呈现。
> 3.  document.write() 中的脚本是解析器阻塞的。具有“异步”或“延迟”属性的脚本仍将执行。
> 4.  该脚本未托管在同一站点上。换句话说，Chrome 不会干预具有匹配 eTLD+1 的脚本（例如，在[www.example.org](http://www.example.org)上插入的 js.example.org 上托管的脚本）。
> 5.  该脚本尚未在浏览器 HTTP 缓存中。缓存中的脚本不会导致网络延迟，仍会执行。
> 6.  页面请求不是重新加载。如果用户触发了重新加载，Chrome 将不会进行干预，并将正常执行页面。
> 
> 第三方片段有时使用 document.write() 来加载脚本。幸运的是，大多数第三方提供了异步加载替代方案，允许第三方脚本加载而不会阻止页面上其余内容的显示。

因此，如果您`document.write()`满足所有 6 个条件，那么 Chrome 将阻止它。当它发生时，您应该能够在 DevTools 中看到该消息。

**OP的问题**

要解决 OP 的问题，`document.write()`必须先使用才能使用`document.open("text/html")`。完成对文档的写入后，您需要使用`document.close()`. 如果您只是要编写纯文本，请使用`document.open("text/plain")`. 但是，我最近在某处读到 Chrome 会忽略 mimetype 并强制使用 text/html。

```
<html>
<head>
<script type="text/javascript">
function disp_prompt() {
    var name=prompt("Please enter your name","Harry Potter");
    if (name!=null && name!="") {
        document.open("text/plain");
        document.write("Hello " + name + "! How are you today?");
        document.close();
    }
}
</script>
</head>
<body>

<input type="button" onclick="disp_prompt()" value="Display a prompt box" />

</body>
</html> 
```

**- 或者 -**

您可以修改您编写的文本以包含正确的 HTML，如下所示：

```
document.write('<html><head></head><body>Hello ' + name + '! How are you today?</body></html>'); 
```

不要忘记在所有情况下添加`document.open()`和。`document.close()`

# ruby-on-rails - Ruby on Rails：从初始化文件运行 rake 任务时出错

> ID：762423
> 
> 赞同：0
> 
> 时间：2009-04-17T22:20:04.687
> 
> 标签：ruby-on-rails, ruby, rake, initializer

我有文件 config/initializers/custom.rb

在文件中，只有一行：

```
`rake thinking_sphinx:start` 
```

我认为这应该像从命令行键入时一样执行该行。使用这行代码，当我运行“ruby script/server”时，服务器冻结并且不输出任何错误消息。我错过了什么吗？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T17:13:44.587

初始化程序在您的应用程序加载时加载。Rake 任务通常会加载您的应用程序。如果您从初始化程序调用 Rake 任务，您将把您的应用程序抛出一个循环。

如果您担心在开发中忘记启动 Sphinx，请给自己一点警告：

```
# config/initializers/custom.rb
begin
  ThinkingSphinx::Search.search "test" # test search
rescue ThinkingSphinx::ConnectionError
  puts "** Oops! ThinkingSphinx is off! **"
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T22:22:55.387

我询问了如何通过 netbeans 让它以开发模式启动，但想法是一样的。 [赏金仍然开放](https://stackoverflow.com/questions/730003/netbeans-and-rails-is-there-a-way-to-make-the-run-option-in-netbeans-also-start)。

我的猜测是，您没有启动服务器，因为 sphinx 需要它自己的进程，因此它永远不会返回到您的自定义初始化程序。

# oracle - 如何使用 telnet 检查与 Oracle 的连接？

> ID：762434
> 
> 赞同：9
> 
> 时间：2009-04-17T22:24:27.140
> 
> 标签：oracle, telnet

我一直在尝试让 sqlplus 从我的 OS X 机器连接到 Oracle。[我在这里](https://stackoverflow.com/questions/761418/how-come-sqlplus-not-connecting)问了另一个问题。

一个人建议我尝试 telnet。查阅手册页，我尝试了：

```
[ ethan@gir ~ ]$ telnet DBHOST:1521
Trying xxx.xxx.xxx.xxx...
telnet: connect to address xxx.xxx.xxx.xxx: Operation timed out
telnet: Unable to connect to remote host 
```

还...

```
[ ethan@gir ~ ]$ telnet DBHOST 1521 
```

......结果相同。

我不确定如何解释这些结果。无论如何，这似乎是您所期望的。你不会这样做...

```
$ ssh some_mysql_host:3306 
```

telnet 到 Oracle 有何不同？

或者，也许我不明白他们的意思。

如果有人可以帮助我了解如何使用 telnet 测试与 Oracle 的连接，我将不胜感激。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-17T22:46:40.270

他们提议使用`telnet`仅仅是因为它是最简单的 TCP/IP 客户端之一，而且它几乎安装在任何地方。这只是一种从命令行检查您是否真的能够与任何特定服务建立 TCP/IP 连接的简单方法。

此外，在许多基于 ASCII 的 IP 协议上，它可以直接与服务器进行实际交互，通过输入命令并查看响应来检查其工作情况——我自己已经用 SMTP 服务器做过很多次了。

在您的情况下，当您超时时，整个主机都已关闭，或者防火墙阻止了对该特定主机或服务的访问。如果您可以使用 a 访问服务器，`ping`则后者更有可能。

还有一个外部机会，您的名称解析实际上将您带到了错误的主机，但您应该能够通过查看`telnet`它试图连接的 IP 地址来确认这一点。

另一个常见的响应是“连接被拒绝”。这意味着主机已启动，但指定端口上没有运行任何服务。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-17T22:29:11.247

基本上当您指定端口号时，例如

`Telnet myserver 1521`

它将尝试连接到该端口上的机器。如果您看到任何返回的数据或什至是空白控制台，则它已连接。如果您收到无法连接的消息，则表明机器未在该端口上侦听或防火墙阻止了连接。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T22:28:48.847

您尝试 telnet 到 dbhost 1521 时出现“无法连接”并超时，这表明您的“dbhost”主机名解析给了您错误的答案，或者该主机处于脱机、关闭或您的网络问题。

如果 oracle 工作正常，您将获得连接。你真的不能用它*做*任何事情，但它会确认 oracle 已经启动并正在监听。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-11-14T07:47:19.700

Oracle 实例没有从其他系统连接，当它从 连接时`localhost`，我认为端口没有打开，它显示`telnet 1521`从其他系统的端口有问题。

* * *

## 回答 #5

> 赞同：-6
> 
> 时间：2009-04-20T08:50:22.453

为什么不以“正确”的方式去做呢？如果数据库及其监听器工作正常，Telnet 到某个任意网络端口不会为您提供正确的信息。

只需安装 oracle [instantclient](http://www.oracle.com/technology/software/tech/oci/instantclient/index.html)软件并使用配置向导。

# sql - 如何通过 JDBC 将值插入 Microsoft Access 数据库？

> ID：762438
> 
> 赞同：0
> 
> 时间：2009-04-17T22:26:56.213
> 
> 标签：sql, ms-access, jdbc

我用 Java 创建了一个字母游戏，我需要通过 JDBC 使用 Microsoft Access 数据库在其中包含一个高分函数。数据库中的表包含以下字段

```
Table Name: Scores

Name       (Text)
Difficulty (Text)
Characters (Number)
Accuracy   (Text)
Time       (Text)
Score      (Text) 
```

我需要一条 SQL 语句来插入来自 Java 的值以更新 Microsoft Access 数据库表。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T23:11:04.907

尝试以下操作：

```
String dataSourceName = "my_ODBC_DSN_name";
String username = "username";
String password = "password";
String url = "jdbc:odbc:" + dataSourceName;

Connection con = null;
try {
  Class.forName("sun.jdbc.odbc.JdbcOdbcDriver");
  con = DriverManager.getConnection(url, username, password);

  PreparedStatement pst = con.prepareStatement("INSERT INTO Scores "
           + "(Name, Difficulty, Characters, Accuracy, Time, Score) "
           + "VALUES (?, ?, ?, ?, ?, ?)");

  pst.setString(1, "Name String");
  pst.setString(2, "Difficulty String");
  pst.setInt(3, 20);
  pst.setString(4, "Acurracy String");
  pst.setString(5, "Time String");
  pst.setString(6, "Score String");

  pst.executeUpdate();
} catch (SQLException e) {
  e.printStackTrace();
} catch (ClassNotFoundException e) {
  e.printStackTrace();
} finally {
  if (con != null)
    try {
      con.close();
    } catch (SQLException e) {
      e.printStackTrace();
    }
} 
```

您必须首先在 Windows 控制面板中设置 ODBC DSN。它位于**控制面板 -> 管理工具 -> 数据源**中。

除了您的主要问题之外，我还同意 Russ Cam 的意见，即您可能应该修改您的数据库模式，以便您为时间和分数列使用适当的列类型，并可能为准确性和难度使用适当的列类型。在规范化设计中，“姓名”也将是另一个表的外键（类似于 player_id），该表将保存每个玩家的详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T22:45:26.887

插入

```
INSERT INTO Scores (Name, Difficulty, Characters, Accuracy, Time, Score)
VALUES ('Name Value', 'Difficulty Value', 3, 'High', '10:30', '235'); 
```

为了更新，您需要在 Scores 表中设置一个[PRIMARY KEY](http://www.databasedev.co.uk/define_primary_key.html)，以便您只更新一条特定记录（除非您打算更新多条记录）。无论如何，我都会建议在桌面上进行 PK。

此外，我注意到难度、准确性、时间和分数都是基于文本的字段 - 现在我不知道您的数据库架构/设计是什么样的，但难度、准确性和分数让我印象深刻，它们本质上是数字的，而时间听起来像日期/时间。查看[MS Access（JET DB 引擎）数据类型](http://msdn.microsoft.com/en-us/library/ms714540(VS.85).aspx)以获取更多信息。

**编辑：取自评论**

看[这里](http://java.sun.com/docs/books/tutorial/jdbc/overview/index.html)，在 JDBC 中参数化 SQL 语句的最佳方法似乎是使用 JDBC API 编写*存储过程*（**准备好的语句**），然后将需要插入的值设置为准备好的语句上的参数。

这是[关于更新的 JDBC 教程](http://java.sun.com/docs/books/tutorial/jdbc/basics/updating.html)和[关于插入](http://www.jdbc-tutorial.com/jdbc-prepared-statements.htm).

# iphone - AVAudioPlayer、音频会话类别和锁定

> ID：762444
> 
> 赞同：0
> 
> 时间：2009-04-17T22:31:11.180
> 
> 标签：iphone

我正在使用 AVAudioPlayer 在游戏中播放声音。当用户锁定设备时，我会暂停游戏（并将其发送到恢复视图）并希望所有声音都停止播放。

但是，由于恢复视图与我在加载保存的游戏时使用的相同，因此该视图使用 AVAudioPlayer 触发声音。当它在屏幕锁定的情况下这样做时，声音是可以听到的，即使我将音频会话设置为 kAudioSessionCategory_SoloAmbientSound。

有谁知道如何停止所有声音，即使`AVAudioPlayer play`被调用？

我尝试调用此方法：

```
AudioSessionSetActive(false) 
```

但这没有帮助。

**更新：**当设备被锁定时，我目前将音量设置为 0.0，但是，我想知道是否有通过 AudioSessions 等的内置方式。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T15:31:51.303

我能找到的最好方法是在锁定事件时将音量设置为 0，并在设备解锁时恢复它。

# python - 这个 Python 代码线程安全吗？

> ID：762448
> 
> 赞同：2
> 
> 时间：2009-04-17T22:33:40.753
> 
> 标签：python, multithreading

```
import time
import threading

class test(threading.Thread):
    def __init__ (self):
      threading.Thread.__init__(self)
      self.doSkip = False
      self.count = 0

    def run(self):
      while self.count<9:
         self.work()

    def skip(self):
      self.doSkip = True

    def work(self):
      self.count+=1
      time.sleep(1)
      if(self.doSkip):
        print "skipped"
        self.doSkip = False
        return
      print self.count

t = test()
t.start()
while t.count<9:
  time.sleep(2)
  t.skip() 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T22:42:54.943

以哪种方式线程安全？我在这里看不到您可能想要保护的任何部分。

skip 可能`doSkip`随时重置，因此锁定它没有多大意义。您没有同时访问的任何资源 - 因此恕我直言，此代码中没有任何内容可以损坏/不安全。

根据锁定/计数的不同，唯一可能运行不同的部分是每次调用`.skip()`. 如果要确保每次跳过都会导致跳过调用`.work()`，则应更改`doSkip`为受增量和比较/减量锁定保护的计数器。目前，一个线程可能会`doSkip`在检查之后但在`doSkip`重置之前打开。在这个例子中没关系，但在某些实际情况下（有更多代码）它可能会有所作为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-19T00:53:39.130

每当互斥布尔值的测试（例如 if(self.doSkip) ）与互斥布尔值的集合分开时，您可能会遇到线程问题。

规则是你的线程会在最不方便的时候被换掉。也就是说，在测试之后和设置之前。将它们靠得更近可以减少搞砸的机会，但不会消除它们。您几乎总是需要从语言或内核中专门创建的机制来完全关闭该窗口。

线程库具有信号量，可用于同步线程和/或创建代码的关键部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T22:44:50.617

显然没有任何关键资源，所以我会说它是线程安全的。

但是像往常一样，您无法预测调度程序将按什么顺序阻塞/运行两个线程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T22:46:59.380

只要您不在线程之间共享数据，这就是并且将是线程安全的。

如果其他线程需要读取/写入数据到您的线程类，那么这将不是线程安全的，除非您使用某种同步机制（如锁）保护数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-19T22:40:55.353

为了详细说明 DanM 的答案，可以想象这可能会发生：

1.  线程 1：`t.skip()`
2.  线程 2：`if self.doSkip: print 'skipped'`
3.  线程 1：`t.skip()`
4.  线程 2：`self.doSkip = False`
5.  等等

换句话说，虽然您可能希望每次调用都会看到一个“跳过” `t.skip()`，但这一系列事件会违反这一点。

但是，由于您的`sleep()`电话，我认为这一系列事件实际上是不可能的。

（除非您的计算机运行速度*非常*慢）

# ruby - 为什么 active_record 会破坏 Ruby 陷阱的行为，我该如何解决？

> ID：762458
> 
> 赞同：0
> 
> 时间：2009-04-17T22:40:14.527
> 
> 标签：ruby, windows, activerecord, exception-handling, control-c

在过去的几天里，我一直在尝试解决一直困扰我的 active_record 问题。[railsforum](http://railsforum.com/viewtopic.php?pid=94513#p94513)和[stackoverflow](https://stackoverflow.com/questions/754167/ruby-windows-activerecord-and-control-c)上的帖子已经完全干涸。这些帖子中的长度和详细程度可能会劝阻评论者，所以我再次尝试 - 简而言之。

在 Windows 下，陷阱行为在我的脚本中是正常的 - 直到我“需要 'active_record'”，此时陷阱不再正常工作。它们根本无法运行，它使我的数据库处于混乱状态。

有问题的脚本通过活动记录与其他系统上的其他脚本交互。当用户点击 control-c 或脚本因任何其他原因终止时，脚本在退出之前通知数据库其（脚本）即将到来的厄运是至关重要的。由于陷阱无法使用，我被困住了。

有解决方法吗？如果您对测试代码感兴趣，请参阅我的链接帖子。只需几行即可重现该问题。

谢谢...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T17:44:09.567

您是否考虑过在 Windows 平台上更新 Ruby？我对[您的代码示例](https://stackoverflow.com/questions/754167/ruby-windows-activerecord-and-control-c)进行了一些测试，结果如下：

*   Ruby 1.8.6-p36、Gem 1.3.2、ActiveRecord 2.2.2：**失败**
*   **Ruby 1.8.7-p72、Gem 1.3.1、 ActiveRecord** 2.1.0：工作
***   **Ruby 1.8.7- p72**、Gem 1.3.2、ActiveRecord 2.2.2：工作***   Ruby 1.9.1-p0、Gem 1.3.1、ActiveRecord 2.3.2：**有时可以使用******

 ****# java - 如何禁用 Java 安全管理器？

> ID：762459
> 
> 赞同：18
> 
> 时间：2009-04-17T22:40:34.980
> 
> 标签：java, security, reflection, db4o

有没有办法完全禁用 Java 安全管理器？

我正在试验 db4o 的源代码。它使用反射来持久化对象，并且似乎安全管理器不允许反射读取和写入私有或受保护的字段。

我的代码：

```
public static void main(String[] args) throws IOException {
    System.out.println("start");
    new File( DB_FILE_NAME ).delete();
    ObjectContainer container = Db4o.openFile( DB_FILE_NAME );
    String ob = new String( "test" );
    container.store( ob );
    ObjectSet result = container.queryByExample( String.class );
    System.out.println( "retrieved (" + result.size() + "):" );
    while( result.hasNext() ) {
        System.out.println( result.next() );
    }
    container.close();
    System.out.println("finish");
} 
```

输出：

```
开始
[db4o 7.4.68.12069 2009-04-18 00:21:30]
 AccessibleObject#setAccessible() 不可用。不能存储私有字段。
检索到 (0):
结束

```

[该线程](http://developer.db4o.com/forums/permalink/10482/10482/ShowThread.aspx)建议修改 java.policy 文件以允许反射，但它似乎对我不起作用。

我正在使用参数启动 JVM，
`-Djava.security.manager -Djava.security.policy==/home/pablo/.java.policy`
因此指定的策略文件将是唯一使用的策略文件

该文件如下所示：

```
授予 {
    权限 java.security.AllPermission;
    权限 java.lang.reflect.ReflectPermission "suppressAccessChecks";
};

```

我花了最后 3 个小时在这上面，但不知道如何使它工作。任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-18T00:18:29.940

您可以尝试将其添加到程序的 main() 中：

```
System.setSecurityManager(null); 
```

当我遇到安全管理器问题时，为我工作了一个“受信任的”WebStart 应用程序。不确定它是否适用于您的 db4o 案例，但可能值得一试。

编辑：我并不是说这是安全管理器问题的一般解决方案。我只是提出它作为帮助调试原始海报问题的一种方式。显然，如果您想从安全管理器中受益，那么您不应该禁用它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-17T22:54:57.440

您的`java.security.policy`命令行选项中真的有两个“=”符号吗？那是行不通的。确保您将属性设置为

```
-Djava.security.policy=/home/pablo/.java.policy 
```

要真正禁用`SecurityManager`，只需完全放弃`java.security.manager`系统属性就足够了。

* * *

*更新：*当我阅读策略文件的文档以了解有关“==”语法的更多信息时，我注意到除非策略文件位于当前工作目录中，否则需要将其指定为 URL（包括方案）。您是否尝试过使用“file:”方案为策略路径添加前缀？

我也很困惑，因为（假设您以用户“pablo”的身份运行），看起来该策略应该默认从您的主目录加载，所以您根本不需要指定它。另一方面，如果您不是以用户“pablo”运行，则该文件可能不可读。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-18T05:55:01.597

我找到了这个示例，说明如何使您的代码[可以访问私有字段和方法。](http://tutorials.jenkov.com/java-reflection/private-fields-and-methods.html)基本上，它归结为*Field.setAccessible(true)*和*Method.setAccessible(true)的使用*

字段示例：

```
Field privateStringField = PrivateObject.class.
            getDeclaredField("privateString");

privateStringField.setAccessible(true); 
```

方法示例：

```
Method privateStringMethod = PrivateObject.class.
        getDeclaredMethod("getPrivateString", null);

privateStringMethod.setAccessible(true); 
```

您还可以考虑将 Groovy 与您的 Java 代码一起使用，因为它（当前）规避了 Java 代码的许多访问级别限制。虽然，此留言板张贴似乎暗示此“功能”[可能会在 Groovy 的未来版本中发生变化](http://www.nabble.com/Re%3A-Can-Groovy-scripts-change-private-instance-variables-of-Java-classes-!--p20718223.html)。

# c# - 使用不同域时的远程处理问题

> ID：762465
> 
> 赞同：2
> 
> 时间：2009-04-17T22:43:11.120
> 
> 标签：c#, remoting

我有以下项目：服务器、客户端、远程对象。客户端做一些事情，然后将远程对象的代理传递给服务器。在服务器和客户端位于不同的域之前，所有的东西都可以正常工作。现在，当我尝试将结果传递给服务器时出现异常

> “在 mscorlib.dll 中发生了“System.Runtime.Remoting.RemotingException”类型的未处理异常

附加信息：此远程代理没有通道接收器，这意味着服务器没有注册的服务器通道正在侦听，或者此应用程序没有合适的客户端通道与服务器通信。"

互联网上的一些消息来源说我需要创建一些额外的频道，但我不知道应该在哪里以及如何做，因为我已经在服务器和客户端上注册了频道。

```
Info:
server - domain 2
client - domain 1
remote object - domain 1 
```

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T22:59:18.883

对我来说听起来像是权限问题。您如何托管远程对象？您如何跨域进行身份验证？ 这是一篇关于身份验证可能遇到的一些问题[的不错的文章。](http://msdn.microsoft.com/en-us/library/ms973909.aspx)

从[这篇文章](http://msdn.microsoft.com/en-us/library/59hafwyt(VS.80).aspx)...

*默认情况下，TCP 客户端通道使用运行客户端进程的用户身份对自身进行身份验证。您可以通过设置域、用户名和密码属性来指定替代身份，以指定替代身份*

您是否在频道属性中指定了正确的凭据（包括域）？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T23:08:34.460

> 然后将远程对象的代理传递给服务器

你能解释一下吗？这听起来不是个好主意。通常使用代理来调用远程方法 (RPC)。将代理传递回服务器，没有意义。当然它可能在某些情况下有效，但它只会增加不必要的复杂性。

如果要传递对象，请创建一个单独的数据类并将其作为参数传递给远程方法。

Common.dll

```
[Serializable]
public class Data
{
    int a;
    int b;
}
[Serializable]
public class ResultData
{
    int c;
}
public interface IServerInterface
{
    ResultData DoSomething(Data data);
} 
```

服务器.dll

```
public class ServerObject : MarshalByRefObject, IServerInterface
{
    public ResultData DoSomething(Data data)
    {
        // do some work on the server
        return new ResultData();
    }
} 
```

客户端.exe

```
class Program
{
    static void Main(string[] args)
    {
        IServerInterface proxy = CreateProxy();
        ResultData result = proxy.DoSomething(new Data());

    }
} 
```

# php - 弄清楚为什么这个简单的比较在 PHP 中显示不相等

> ID：762467
> 
> 赞同：1
> 
> 时间：2009-04-17T22:44:02.647
> 
> 标签：php

我在一个脚本中进行了检查，以确保总数是正确的。它所做的是查看存储在数据库中的总数，然后使用其他变量计算总数应该是多少。

如果这两个值 - 存储的总数和计算的总数 - 不相等，这是一个问题，所以我希望它发送电子邮件警报。

这是我用来执行此操作的代码片段：

```
$storedTotal     = $row['total']; # Pulls from a varchar field in the database
$calculatedTotal = $subtotal + $tax + $shipping - $deduct;

# Make sure the stored total equals what it should (the calculated total)
if($storedTotal != $calculatedTotal) {
    # Send an alert
    mail("admin@domain.com","Total check fail","Stored total:$storedTotal \n\n Calculated total:$calculatedTotal \n\n");
} 
```

看起来很简单，但是，我反复收到来自它的电子邮件，如下所示：

```
Stored total:23.40

Calculated total:23.40 
```

如您所见，这两个值看起来相同。

任何人都可以看到他们没有表现出平等的任何原因吗？我没有使用严格的相等检查，所以它不应该被类型绊倒。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-17T22:49:15.067

这很可能是一个浮点比较错误 - 可能有一些非常微不足道的数字，默认`float -> string`转换例程认为不值得打印，但它们的重要性足以导致比较失败。您会在 StackOverflow 上找到许多类似的问题。

由于这些似乎是货币金额，只需检查它们是否在彼此小单位的十分之一之内：

```
$is_equal = (abs($val1 - $val) < 0.001); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T23:14:57.143

在比较它们之前尝试转换和舍入：

```
$storedTotal        = round(floatval($storedTotal), 2);
$calculatedTotal    = round(floatval($calculatedTotal), 2);

if ($storedTotal != calculatedTotal) {
... 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-06T15:33:31.610

我遇到了同样的问题——结果我的简单数据一致性完整性检查失败了。我使用 Alnitak 的解决方案来实现这个简单的功能：

```
function not_equals($val1, $val2)
{
    return (abs($val1 - $val2) > 0.001);
} 
```

现在我的测试通过了，但我很不高兴。6.60 不等于 6.60 的编程语言？？？PHP 还会对我做什么？我想回到C++！

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-17T22:52:15.077

一定有其他东西是你遗漏的，而我们没有看到。可能与浮动的大小有关。

因为。

```
$test = "24.50";
$test2 = 24.50;

var_dump($test == $test2); // bool(true) 
```

# asp.net - BinaryWrite 与 WriteFile

> ID：762471
> 
> 赞同：5
> 
> 时间：2009-04-17T22:45:01.147
> 
> 标签：asp.net

我应该使用什么将文件写入响应？在我看来，有两种不同的选择。选项一是将文件读入流，然后将字节写入浏览器

```
Response.BinaryWrite(new bytes[5]) 
```

下一个选项是直接使用 Response.WriteFile 从文件系统写入文件。任何一种方法都有什么优点/缺点？

编辑：纠正错别字

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-18T03:03:29.030

如果磁盘上有文件并且至少使用 asp.net 2.0，则首选 Response.TransmitFile。

Response.WriteFile 将整个文件读入内存，然后将文件写入响应。TransmitFile [“将指定文件直接写入 HTTP 响应输出流，而不将其缓冲在内存中。”](http://msdn.microsoft.com/en-us/library/12s31dhy(VS.80).aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T23:17:11.257

另一个考虑因素是这是一次写入还是频繁写入的文件。如果你经常写这个文件，那么你可能想要缓存它，这样`Response.BinaryWrite`是最有意义的。

如果你有它在内存中，我不会将它写入文件系统并使用`Response.WriteFile`.

# java - 将 .properties 文件放在 Eclipse 项目中的什么位置？

> ID：762475
> 
> 赞同：14
> 
> 时间：2009-04-17T22:45:30.210
> 
> 标签：java, eclipse, properties

我有一个非常简单的属性文件测试，我正在尝试开始工作：（以下是 TestProperties.java）

```
package com.example.test;

import java.util.ResourceBundle;

public class TestProperties {
    public static void main(String[] args) {
        ResourceBundle myResources =
              ResourceBundle.getBundle("TestProperties");
        for (String s : myResources.keySet())
        {
            System.out.println(s);
        }
    }

} 
```

和 TestProperties.properties 在同一目录中：

```
something=this is something
something.else=this is something else 
```

我也保存为`TestProperties_en_US.properties`

当我从 Eclipse 运行 TestProperties.java 时，它找不到属性文件：

```
java.util.MissingResourceException: 
Can't find bundle for base name TestProperties, locale en_US 
```

难道我做错了什么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-17T22:46:46.650

将其放在您的源路径之一的根级别，或在调用中完全限定资源名称`getBundle`，例如

```
ResourceBundle myResources =
          ResourceBundle.getBundle("com.example.test.TestProperties"); 
```

[`ResourceBundle.getBundle(String, Locale, ClassLoader)`](http://java.sun.com/javase/6/docs/api/java/util/ResourceBundle.html)有关更多信息，请参阅文档。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-06-06T21:05:41.030

不要将您的属性文件放入您的 src 文件夹中！显然这是可行的，但基本上这不是你应该如何处理你的问题。在您的项目中创建一个新文件夹，例如“资源”文件夹，将其添加到项目属性中的类路径中，并将除 .java 之外的所有文件放在那里。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-08T17:56:00.613

我也一直在尝试解决这个问题，我发现在尝试运行项目之前必须刷新 Eclipse 的文件列表。然后，您可以将文件放在基本目录中并正常使用它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-20T14:58:40.627

将 TestProperties_en_US.properties(propery) 文件放在 src 文件夹中，然后运行它将运行的程序

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T22:54:30.237

啊哈，非常感谢。这也有效。

```
package com.example.test;

import java.util.ResourceBundle;

public class TestProperties {
    public static void main(String[] args) {
        ResourceBundle myResources =
           ResourceBundle.getBundle(TestProperties.class.getCanonicalName());
        for (String s : myResources.keySet())
        {
            System.out.println(s);
        }
    }
} 
```

# database-design - 如何在数据模式模型中有效地设计动态层次结构？

> ID：762478
> 
> 赞同：0
> 
> 时间：2009-04-17T22:46:44.280
> 
> 标签：database-design

澄清一下，假设我的数据库中有用户和用户统计信息，并且我还有与这两个表相关的城市、州、县和地区等信息。在这种情况下，我可以通过一夜之间或增量过程轻松地将我的用户统计信息汇总到城市、州、县和地区级别。

另一种情况是，我没有固定的组，如城市、州、县，但我希望某些超级用户能够灵活地创建自己的组并以以下形式手动绑定用户：

```
User1|
User2| - group1
User3|
                 -> group3
User4|
User5| - group2
User6| 
```

此外，我仍然可以继续拥有这样的城市、州、县组：

```
User1|
User4| - city1
User3|
                 -> county1
User4|
User5| - city2 
```

是否有已知的数据库模式可用于有效地将关联数据汇总到这些不同的存储桶中？某种标记模式？

请让我知道如果我不清楚，我可以更详细地澄清。

进一步澄清：

我想按国家/地区跟踪用户点击的报告，我可以进一步向下钻取 2 个级别到州和城市。

现在让我们说我有一个工具来创建自己的分组（通过用户界面），现在我将能够创建具有来自不同州的城市的新区域。因此，现在我的报告可以按国家/地区显示用户点击次数，然后我可以深入了解自定义区域（城市组）。现在应该根据新组重新计算所有分析，如用户点击、各种平均值。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T23:17:32.100

看看[嵌套集](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)或邻接列表（也在同一篇文章中）。他们有自己的优点和缺点......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T23:01:10.657

这听起来类似于我关于[用户定义的分层数据模型](https://stackoverflow.com/questions/728137/what-is-the-best-way-to-model-user-defined-hierarchical-relationships-in-a-databa)的问题，也许那里的答案会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-14T16:08:29.757

你的逻辑是错误的。城市、县、州没有等级——一个城市可以存在于不同的县等。

# python - Python正则表达式问题

> ID：762482
> 
> 赞同：0
> 
> 时间：2009-04-17T22:47:53.933
> 
> 标签：python, html, regex

我正在尝试对网页中的一行进行正则表达式。该行如下：

```
<tr><td width=60 bgcolor='#ffffcc'><b>random Value</b></td><td align=center width=80> 
```

这是我尝试过的，但它似乎不起作用，有人可以帮助我吗？'htmlbody' 包含 html 页面，不，我没有忘记导入 're'。

```
reg = re.compile("<tr><td width=60 bgcolor='#ffffcc'><b>([^<]*)</b></td><td align=center width=80>")
value = reg.search(htmlbody)
print 'Value is', value 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T23:22:47.530

使用正则表达式没有可靠的方法来做到这一点。请参阅[您能否提供一些示例，说明为什么使用正则表达式难以解析 XML 和 HTML？](https://stackoverflow.com/questions/701166)为什么。您需要的是一个 HTML 解析器，例如[HTMLParser](http://docs.python.org/library/htmlparser.html)：

```
#!/usr/bin/python

from HTMLParser import HTMLParser

class FindTDs(HTMLParser):
        def __init__(self):
                HTMLParser.__init__(self)
                self.level = 0

        def handle_starttag(self, tag, attrs):
                if tag == 'td':
                        self.level = self.level + 1

        def handle_endtag(self, tag):
                if tag == 'td':
                        self.level = self.level - 1

        def handle_data(self, data):
                if self.level > 0:
                        print data

find = FindTDs()

html = "<table>\n"
for i in range(3):
        html += "\t<tr>"
        for j in range(5):
                html += "<td>%s.%s</td>" % (i, j)
        html += "</tr>\n"
html += "</table>"

find.feed(html) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T22:56:45.987

这

```
import re

htmlbody = "<tr><td width=60 bgcolor='#ffffcc'><b>random Value</b></td><td align=center width=80>"

reg = re.compile("<tr><td width=60 bgcolor='#ffffcc'><b>([^<]*)</b></td><td align=center width=80>")
value = reg.search(htmlbody).group(1)
print 'Value is', value 
```

打印出来

```
Value is random Value 
```

这是你想要的吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T23:26:50.767

听起来您可能想要使用`findall`而不是`search`：

```
reg = re.compile("<tr><td width=60 bgcolor='#ffffcc'><b>([^<]*)</b></td><td align=center width=80>")
value = reg.findall(htmlbody)
print 'Found %i match(es)' % len(value) 
```

不过，我必须提醒您，正则表达式在处理 HTML 方面是出了名的差。最好使用[Python 内置的 HTMLParser 模块](http://docs.python.org/library/htmlparser.html)使用适当的解析器。

# iphone - 如何在 Iphone 的视图中下推分组表？

> ID：762485
> 
> 赞同：2
> 
> 时间：2009-04-17T22:51:53.330
> 
> 标签：iphone, sdk, grouped-table

下面显示了将分组表添加到视图时的默认位置？如何在视图中将整个分组表向下推？

[![替代文字](https://i.stack.imgur.com/Wqomw.png)](https://i.stack.imgur.com/Wqomw.png)
[（来源：[pessoal.org](http://pessoal.org/blog/wp-content/uploads/2009/02/standard-200x300.png)）]

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-17T23:49:20.103

您可以将具有固定高度的透明视图分配给 tableView 的 tableHeaderView 属性。这会将表格内容向下推透明视图的高度。

你可以从你的 UITableViewController 的 viewDidLoad 中做到这一点：

```
// force the table down 70 pixels
CGRect headerFrame = self.tableView.bounds;
headerFrame.size.height = 70;

UIView *header = [[UIView alloc] initWithFrame: headerFrame];
header.backgroundColor = [UIColor clearColor];

self.tableView.tableViewHeader = header;

[header release]; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T23:41:42.027

查看 UITableView 的 delagate。
您将找到一个属性“heightForHeaderInSection”。

对于第 0 部分，只需使标题更大（默认为 0），它会将表格推到视图下方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T04:33:11.933

如果您正在向下移动表格，那么您无疑希望使用获得的空间来添加 UI 元素。

此时，考虑在 IB 中构建页面。您可以将表格视图调整为您喜欢的位置，并将 UI 元素放在表格上方。您可以使用 UIViewController 来管理页面并添加 UITableViewDelegate/Datasource 协议方法，以便您可以将 UITableView 作为委托连接回您的视图控制器......然后您还可以将其他 UI 元素连接到同一个视图控制器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T23:20:37.177

最简单的方法可能只是修改表格视图的框架。您需要通过 IBOutlet 或通过在视图层次结构中查找视图来获取对控制器中 tableview 的引用，**或者**您可以在 Interface Builder 中更改框架。

在代码中类似于：

```
tableView.frame = CGRectMake(0.0, 200.0, 320.0, 280.0); 
```

将 tableview 定位在屏幕下方并限制其高度 - 您使用的尺寸将取决于您是否在视图上有标签栏以及类似的东西。

在界面构建中，只需选择 tableview，然后选择 Size 检查器（带有标尺图标的检查器选项卡）并设置高度和 y 偏移以将其向下移动视图。

# asp.net - 生成的图像显示与下载

> ID：762487
> 
> 赞同：1
> 
> 时间：2009-04-17T22:52:44.810
> 
> 标签：asp.net, asp.net-mvc

我有一个 MVC 操作，它从数据库中提取图像并通过 File(byte[], string) 方法将其发送到响应中。当我在浏览器中导航到该操作时，它会下载文件而不是在浏览器中显示它。

我正在设置文件并将内容类型设置为“image/jpeg”。是否需要设置另一个标题才能让它做我想做的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T01:30:59.237

好的，谜团解开了。

Controller.File() 有一个没有文件名的重载；只是数据和内容类型。使用该重载会导致正确设置内容配置。回想起来，我想这很有意义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T23:03:34.707

[响应内容类型](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.contenttype.aspx)

```
Response.ContentType = "image/jpeg"; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T23:03:54.503

我会使用[Fiddler](http://www.fiddler2.com/fiddler2/)将您的响应标头与普通静态 JPG 的响应标头进行比较。那肯定会告诉你。

# ios - 分配一个 NSUInteger IndexBuffer

> ID：762489
> 
> 赞同：1
> 
> 时间：2009-04-17T22:53:56.320
> 
> 标签：ios, objective-c, nsuinteger

我正在尝试`NSIndexSet`通过调用来检索我的`-getIndexes:maxCount:indexRange`

这是我的代码

```
const NSUInteger arrayCount = picturesArray.count;
NSUInteger theIndexBuffer[arrayCount];      
[picturesArray getIndexes:theIndexBuffer maxCount:arrayCount inIndexRange:nil]; 
```

但是，在调试器`IndexBuffer`中始终显示为`-1`. 当我用静态数字初始化它时`NSUInteger theIndexBuffer[10]`，我得到了一个合适的实例。

这可能是因为它不知道`arrayCount`编译时是什么。
这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T23:03:16.297

您可以使用这样的指针动态分配它：

```
NSUInteger *theIndexBuffer = (NSUInteger *)calloc(picturesArray.count, sizeof(NSUInteger));
// Use your array however you were going to use it before
free(theIndexBuffer); // make sure you free the allocation 
```

在 C 中，即使这是一个动态分配的缓冲区，您也可以使用数组下标运算符并（在大多数情况下）假装它只是一个数组。所以，如果你想得到第三个元素，你可以写：

```
NSUInteger thirdElement = theIndexBuffer[2]; // arrays are 0-indexed 
```

完成后不要忘记释放它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T19:43:35.630

我不认为你做错了什么。[它在 C99 中有效。](http://gcc.gnu.org/onlinedocs/gcc/Variable-Length.html)您可以通过查看这是否为真来仔细检查：

```
sizeof(theIndexBuffer) == arrayCount * sizeof(NSUInteger) 
```

# scalability - 社交网站如何计算好友更新？

> ID：762490
> 
> 赞同：25
> 
> 时间：2009-04-17T22:54:06.680
> 
> 标签：scalability, social-networking

社交网站可能会为用户、朋友和活动维护表格......

他们如何使用这些表以高效且可扩展的方式计算好友事件？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-18T00:26:53.897

许多社交网站（如 Twitter）根本不使用 RDBMS，而是使用 Message Queue 应用程序。其中很多都是从已经存在的应用程序开始的，比如 RabbitMQ。其中一些变得足够大，他们必须大量定制或构建自己的。Twitter 正在第二次这样做。

消息队列应用程序通过为一项或多项其他服务保存来自一项服务的消息来工作。例如说服务弗兰克正在向队列 foo 发布消息。Joe 和 Jill 订阅了 Franks foo 队列。应用程序将跟踪 Joe 或 Jill 是否收到了消息，并且一旦队列的每个订阅者都收到了消息，它就会丢弃它。弗兰克发送消息并忘记了它。Joe 和 Jill 向 foo 请求消息并获取他们尚未收到的任何消息。乔和吉尔对消息做任何他们需要做的事情。也许保留它也许不会。

消息队列应用程序保证应该得到消息的每个人都能够并且将在他们请求时得到消息。发布者可以自信地发送消息，订阅者最终可以获得它们。这样做的好处是完全异步并且不需要昂贵的连接。

编辑：我还应该提到，通常这些大规模存储的东西是严重非规范化的。因此，Joe 和 Jill 可能正在存储完全相同的消息的副本。这被认为是可以的，因为它有助于将应用程序扩展到数十亿用户。

其他阅读：

1.  [http://www.rabbitmq.com/](http://www.rabbitmq.com/)
2.  [http://qpid.apache.org/](http://qpid.apache.org/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-17T23:17:10.337

社交网站的主要数据结构是[图](http://en.wikipedia.org/wiki/Graph_theory)。在 facebook 上，图表是无向的（当你是某人的朋友时，他们就是你的朋友）。在 twitter 上，图表是定向的（您关注某人，但他们不一定关注您）。

表示图的两种流行方法是[邻接表](http://en.wikipedia.org/wiki/Adjacency_list)和[邻接矩阵](http://en.wikipedia.org/wiki/Adjacency_matrix)。

邻接列表只是图上的边列表。考虑一个具有整数用户 ID 的用户。

```
User1, User2
  1      2
  1      3
  2      3 
```

这些记录的无向解释是用户 1 是用户 2 和用户 3 的朋友，用户 2 也是用户 3 的朋友。

在数据库表中表示这一点很简单。就是我们熟悉的多对多关系连接表。查找特定用户的朋友的 SQL 查询很容易编写。

既然您知道特定用户的朋友，您只需将这些结果加入更新表。此表包含由用户 ID 索引的所有用户更新。

只要所有这些表都被正确索引，您就可以很容易地设计高效的查询来回答您感兴趣的问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-21T07:02:50.253

特拉维斯为此写了一篇很棒的文章，

[Rails 和 pfeed 上的活动日志和好友动态](http://web.archive.org/web/20100901004231/http://www.travisdunn.com/activity-logs-and-friend-feeds-on-rails-pfeed)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T23:05:50.160

对于小规模来说，在 users.friends 和 users.events 上进行连接和查询缓存可能很好，但随着朋友和事件的增长，速度会很快减慢。您还可以尝试基于事件的模型，其中每次用户创建事件时，都会在连接表中创建一个条目（可能称为“friends_events”）。因此，每当用户想要查看他们的朋友创建了哪些事件时，他们可以简单地在他们自己的 id 和 friends_events 表之间进行连接并找出答案。通过这种方式，您可以避免抓住所有有朋友的用户，然后将他们的朋友加入事件表。

# iphone - 在 GNU GPLv3 开源许可下发布 iOS 应用程序是否合法？

> ID：762498
> 
> 赞同：12
> 
> 时间：2009-04-17T22:57:10.103
> 
> 标签：iphone, licensing, gpl

在 GNU 通用公共许可证 (GPL) v3 开源许可证下发布 iOS 应用程序是否合法？显然，你不能使用其他人的 GPL 源，但我拥有整个源的版权可以吗？

如果 GPL 许可证不合适——我可以使用 MIT 许可证、BSD 许可证或其他许可证吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-18T07:24:27.013

尽管[我不是律师](http://www.freedom-to-tinker.com/blog/paul/being-acquitted-versus-being-searched-yanal)，但从我对 GPL、IMO 的看法来看，[GPLv3](http://www.gnu.org/licenses/gpl-3.0.html)与 App Store 分发完全不兼容，仅因为第 3 段，我引用：

> ### 3\. 保护用户的合法权益不受反规避法的影响。
> 
> 根据任何适用法律履行 1996 年 12 月 20 日通过的 WIPO 版权条约第 11 条规定的义务，或禁止或限制规避此类措施的类似法律，任何涵盖的作品均不应被视为有效技术措施的一部分。
> 
> 当您传送涵盖的作品时，您放弃任何禁止规避技术措施的法律权力，前提是此类规避是通过对涵盖的作品行使本许可下的权利而实现的，并且您否认有任何限制操作或修改的意图作品作为对作品的用户执行您或第三方禁止规避技术措施的合法权利的一种手段。

基本上，AFAIK，这意味着设备必须完全开放，任何人都可以在设备上安装和使用他们对源代码的修改。

[然而，这一段在GPLv2](http://www.gnu.org/licenses/gpl-2.0.html)中并不存在。这是我为[Gorillas](http://gorillas.lyndir.com)选择的许可证，因为据我所知，它是兼容的。我敢肯定，如果有人决定不是这样并将其告上法庭，那么任何事情都可能发生，但从技术上讲；GPL 甚至从未见过法庭（至少，据我所知没有）。如果有一天 Apple 决定明确提及 GPL 不兼容，因为他们无法遵守其分发条款，那么他们可能会告诉我们不要这样许可它，我将切换到[CDDL](http://www.sun.com/cddl/)左右。

至于您提到的其他许可证；这些都很好。它们远没有 GPL 那样严格的限制。

仅供参考，这是一些许可证的相当不错的比较：

[版权、许可和 CDDL 插图](http://blogs.oracle.com/chandan/entry/copyrights_licenses_and_cddl_illustrated)

顺便说一句，您还可以采用任何这些出色的许可证（包括 GPLv3）并对其进行调整以使其兼容（前提是它们不受版权保护）或将它们用于[双重许可](http://en.wikipedia.org/wiki/Dual_license)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-17T23:07:32.170

简短的回答，据我了解，是和否

更详细地说，没有什么能阻止您编写 iPhone 应用程序并在 GPL 下发布源代码。但是，在应用商店分发机制下，许可证的某些部分[似乎无法实现](http://plasmasturm.org/log/512/)

现实世界的结果是像[Colloquy mobile](http://colloquy.mobi/)之类的情况，您必须在应用商店付费，但可以免费获得[源代码](http://colloquy.info/project/browser/trunk/Mobile)（如果您注册了 99 美元，则可以构建/安装到您的 iPhone/iTouch 上）开发程序）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-18T21:22:56.610

如果您拥有所有代码的版权，那么应该没有问题。您可以根据 GPL 将其许可给其他人，但它不适用于您或您根据其他条款选择许可的任何其他人。

# java - Java 替代 Windows Workflow Foundation

> ID：762499
> 
> 赞同：12
> 
> 时间：2009-04-17T22:58:31.193
> 
> 标签：java, workflow, workflow-foundation

Windows Workflow Foundation 有哪些 Java 替代方案？我正在寻找至少提供与 WWF 相同的功能，并具有相同的灵活性和相对易用性的东西。我非常喜欢免费的解决方案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-17T23:01:59.110

Java 有几个很棒的工作流引擎，[JBPM](http://www.jboss.org/jbpm/)就是其中之一。

其他可以在[这里](http://java-source.net/open-source/workflow-engines)找到。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T00:40:30.573

我们使用过 OSWorkflow 并取得了成功。特别是，它很容易与 Spring 和 Quartz 集成。

[http://www.opensymphony.com/osworkflow/](http://www.opensymphony.com/osworkflow/)

# iphone - 来自 iPhone 的 Twitpic API - 已发布图片但未返回 URL？

> ID：762501
> 
> 赞同：1
> 
> 时间：2009-04-17T22:59:59.677
> 
> 标签：iphone, web-services, api, twitter

这是一个奇怪的...

在这里的人们的帮助下，我成功地将我的 iPhone 应用程序发布到了 TwitPic - 当我第一次让它工作时，我也可以看到一个 XML 结果被返回......

但由于过去两天的某种原因，API 调用似乎成功了——图片出现在 TwitPic 上——但是......响应似乎是空的......

有人有想法么？见过类似的吗？我用来调用 API 的代码是：

```
 ASIFormDataRequest *request = [[[ASIFormDataRequest alloc] initWithURL:url] autorelease];

[request setData:twitpicImage forKey:@"media"];
[request setPostValue:username forKey:@"username"];
[request setPostValue:password forKey:@"password"];

// Initiate the WebService request
[request start];

// Need to find out how I can access the result from this call...

/* Result structure should be:

 <?xml version="1.0" encoding="UTF-8"?>
    <rsp stat="ok">
        <mediaid>abc123</mediaid>
        <mediaurl>http://twitpic.com/abc123</mediaurl>
    </rsp>
*/

// Check for errors
if ([[request responseHeaders] objectForKey:@"stat"] != @"ok"){
    UIAlertView *errorAlert = [[UIAlertView alloc] initWithTitle:@"TwitPic Submission" 
                                                    message:[[request responseHeaders] objectForKey:@"mediaurl"]
                                                   delegate:nil
                                          cancelButtonTitle:@"OK!" 
                                          otherButtonTitles:nil];
    [errorAlert show]; 
    [errorAlert release];
}

NSString *twitpicURL = [[request responseHeaders] objectForKey:@"mediaurl"];

UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"TwitPic Submission" 
                                      message:twitpicURL
                                      delegate:nil
                                      cancelButtonTitle:@"OK!" 
                                      otherButtonTitles:nil]; 
```

我试着只是转储出 [request responseString] ......现在也是空的。那是肯定的。

与往常一样，任何帮助都感激不尽。有能力我会回馈！

干杯，

杰米。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-13T03:22:14.500

好的，问题解决了:-)

看看这个网站：[链接文本](http://allseeing-i.com/ASIHTTPRequest/How-to-use#streaming)

只需将这些行添加到您的请求中：

```
[request setDidFinishSelector:@selector(requestDone:)];
[request setDidFailSelector:@selector(requestWentWrong:)]; 
```

以及以下方法：

```
- (void)requestDone:(ASIHTTPRequest *)request { NSString *response = [request responseString];}
- (void)requestWentWrong:(ASIHTTPRequest *)request { NSError *error = [request error];} 
```

NSString *response 包含来自 twitpic 的所有重要反馈。

享受 ：-）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T23:05:50.787

啊！我想我找到了问题所在。似乎是 TwitPic 的问题 - 2 天前，我将密码更改为包含数字和字母的混合大小写密码。我只是将其重置为全小写字母，然后……一切正常。

我已经向 twitpic 支持发送了一条消息 - 希望他们会关注它！

杰米。

# f# - 有没有好的 F# 文本编辑器？

> ID：762502
> 
> 赞同：13
> 
> 时间：2009-04-17T23:00:16.460
> 
> 标签：f#, text-editor

F#有什么好的**文本编辑器吗？**

我不想启动资源密集型 Visual Studio，而是想知道是否有任何文本编辑器可以漂亮地格式化 F# 代码。

我刚刚开始使用 F#，使用记事本通过 FSI.exe 学习给我带来了很多麻烦......

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-17T23:03:23.707

看看这个： [没有 Visual Studio 的 F#](http://plus.kaist.ac.kr/~shoh/fsharp/html/fsharp-without-visual-studio.html)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-18T00:08:58.980

不要太挑逗，但展望未来，VS2010 使用新的可重新托管的编辑器组件，您可以在这里听到一些关于它的信息：[Hanselminutes Podcast 147 - Visual Studio 2010 中基于 WPF 的新文本编辑器 - 开发人员访谈](http://www.hanselman.com/blog/HanselminutesPodcast147TheNewWPFbasedTextEditorInVisualStudio2010InterviewWithADev.aspx)

无论如何，这意味着 VS 中的 F# 编辑体验理论上可以与 VS 完全解耦，并托管在一个轻量级的编辑器中。这意味着 F# 有可能在没有 VS 的情况下发布样本或“VS 编辑体验”（工具提示、曲线、智能感知等）。

需要明确的是，我们 F# 团队还没有任何具体的计划来发布这样的东西，但是 VS 和编辑器和 MEF 等新的内部分解应该让这很容易做到（我们已经对其进行了原型设计）一个周末，它主要是有效的）。所以希望未来能有一些很酷的东西。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-19T14:31:48.057

另外两个选项：

1.  SharpDevelop 使用 Robert Pickering 的 F# 插件。
2.  带有 F# CTP 的 Visual Studio 2008 Shell

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-17T23:03:20.197

任何将处理 OCaml 的编辑器都应该处理 F# -okay-。大多数情况下，您只需要标签。我个人推荐 KomodoEdit。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-10-08T21:16:33.357

对于记事本++，有人制作了一个文件并将其放在维基上：

[http://notepad-plus.sourceforge.net/commun/userDefinedLang/userDefineLang_Fsharp.xml](http://notepad-plus.sourceforge.net/commun/userDefinedLang/userDefineLang_Fsharp.xml)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-05T00:22:00.447

另一种选择：

1.  xacc.ide，一个支持一堆 .NET 语言的小 ide。但坦率地说，我已经有一段时间没有使用它了，因为我对 Visual Studio 2008（IntelliSense、交互式语法检查、fsi 等）非常满意。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-02-16T22:03:23.617

您可以设置[Sublime Text 2](http://www.sublimetext.com/2)以使用 F#，如此处所述[http://blog.kulman.sk/using-sublime-text-2-as-f-repl/](http://blog.kulman.sk/using-sublime-text-2-as-f-repl/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-04-13T13:07:40.937

您可以使用[Ionide](http://ionide.io/)包与[Visual Studio Code (VS Code)](https://code.visualstudio.com/)或[Atom](https://atom.io/)编辑器集成。

这是一篇文章“[使用 Ionide 在 Visual Studio Code 中支持 F#](https://blogs.msdn.microsoft.com/dotnet/2015/12/03/guest-post-announcing-f-support-in-visual-studio-code-with-ionide/) ”

# cocoa-touch - 如何在 iPhone 上用 cocoa 发布 http 帖子

> ID：762504
> 
> 赞同：0
> 
> 时间：2009-04-17T23:01:24.320
> 
> 标签：cocoa-touch, http

任何人都可以粘贴一些关于如何发布几个值的 http 帖子的代码吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T23:11:35.047

谷歌搜索的第二个答案看起来像你可能需要的：

[http://www.iphonedevforums.com/forum/sample-code/69-getting-content-url.html](http://www.iphonedevforums.com/forum/sample-code/69-getting-content-url.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-06T15:00:53.487

// 你可以使用 sendSynchronousRequest:returningResponse:error: 同步驱动一个 NSURLConnection // 但这会阻塞整个线程直到收到响应

// thebodyData = 发送到服务器的有效负载（格式正确） // theMimeType = 有效负载的 mineType //url 是 http POST 调用的适当 url

```
NSMutableURLRequest *theRequest = [NSMutableURLRequest requestWithURL:url];
        [theRequest setHTTPMethod:@"POST"];

        NSURLConnection *theConnection = [[NSURLConnection alloc]initWithRequest:theRequest delegate:self];
        if(theConnection)
        {
            webData = [[NSMutableData data]retain];
             // give the details of the payload -- mine time and body content.
            [theRequest setValue: theMimeType forHTTPHeaderField:@"Content-Type"];
            [theRequest setHTTPBody:theBodyData];

        }
        else
        {
            NSLog(@"theConnection is NULL");
        }

// the delegate methods templates...

 - (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response
{
    [webData setLength:0];  // clear the data incase it was a redirect in between.
}

 - (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data
{
    [webData appendData:data];  // collect the data from server as it comes in.
}

 - (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error
{
    [[NSAlert alertWithError:error] runModal]; // report the error
}

- (void)connectionDidFinishLoading:(NSURLConnection *)connection
{
    // Once this method is invoked, "webData" contains the complete result
} 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-18T02:17:22.633

这是一些执行 POST 调用的基本代码：

```
//url is the appropriate url for the http POST call
    NSMutableURLRequest *theRequest = [NSMutableURLRequest requestWithURL:url];
            [theRequest setHTTPMethod:@"POST"];

            NSURLConnection *theConnection = [[NSURLConnection alloc]initWithRequest:theRequest delegate:self];
            if(theConnection)
            {
                webData = [[NSMutableData data]retain];
            }
            else
            {
                NSLog(@"theConnection is NULL");
            } 
```

您需要实现 NSURLConnection 的适当委托方法。

# .net - 网站如何使用 hitcounters 来增加流量

> ID：762507
> 
> 赞同：1
> 
> 时间：2009-04-17T23:03:01.697
> 
> 标签：.net, ruby-on-rails, asp.net-mvc, openlaszlo

我正在寻找一种方法来跟踪特定网页的点击次数。当点击次数达到一定数量时，流量被驱动到不同的网页。具体来说，我可以使用它来修改不同值的点击次数，并以此逻辑将人们带到不同的网页。免费的网络流量分析软件能帮我解决这个问题吗？他们是否允许我访问这些数字以供我操作？

我是新手 Web 程序员和中级 C/C++ 程序员。我目前正在尝试使用 .NET MVC 框架构建网站，但我愿意接受其他解决问题的方法（Ruby on Rails 或 OpenLaszlo）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T00:36:40.100

你的目标是什么？如果您要根据访问建立逻辑，我不会依赖 3rd 方软件，因为跟踪通常会有延迟并且可能会出现故障（大多数免费分析包的正常运行时间都很差）。您可能希望在数据库中创建一个表，其中包含每个带有计数器的页面的记录，并在有人访问该页面时更新该计数器，然后您可以根据该数据建立您的逻辑。

如果您给我更多信息，我可能会提供更多帮助，您是否出于特定原因尝试这样做？这似乎是一个奇怪的要求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T02:02:20.330

只是补充詹姆斯所说的话。更好的解决方案是通过跟踪命中来自己处理。但是 Google Analytics 有一个我认为可以在这种情况下使用的[API 。](http://code.google.com/apis/analytics/docs/gaJS/gaJSApi.html)我没有使用它，但我认为它可以使用。但我个人的观点是，如果你尝试做的事情没有太多好处，那么你最好不要这样做。;-)

# unit-testing - 在单元测试中拥有多个断言是不好的做法吗？

> ID：762512
> 
> 赞同：53
> 
> 时间：2009-04-17T23:03:41.477
> 
> 标签：unit-testing, assert

在单元测试中拥有多个断言是不好的做法吗？有关系吗？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-04-17T23:44:08.040

`assert`有时我每个测试用例只有一个，但我想更多时候我有几个`assert`语句。

我见过@Arkain 逃避的情况，其中一段非常大的代码只有一个单元测试套件，只有几个测试用例，它们都被标记为`testCase1`,`testCase2`等，每个测试用例都有数百个断言。更好的是，每个条件通常取决于先前执行的副作用。每当构建失败时，总是在这样的单元测试中，需要相当长的时间来确定问题出在哪里。

但另一个极端是您的问题所暗示的：每种可能条件的单独测试用例。根据您要测试的内容，这可能是有道理的，但通常我`assert`每个测试用例都有几个 s。

例如，如果您编写了`java.lang.Integer`，您可能会遇到如下情况：

```
public void testValueOf() {
    assertEquals(1, Integer.valueOf("1").intValue());
    assertEquals(0, Integer.valueOf("0").intValue());
    assertEquals(-1, Integer.valueOf("-1").intValue());
    assertEquals(Integer.MAX_VALUE, Integer.valueOf("2147483647").intValue());
    assertEquals(Integer.MIN_VALUE, Integer.valueOf("-2147483648").intValue());
    ....
}

public void testValueOfRange() {
    assertNumberFormatException("2147483648");
    assertNumberFormatException("-2147483649");
    ...
}

public void testValueOfNotNumbers() {
    assertNumberFormatException("");
    assertNumberFormatException("notanumber");
    ...
}
private void assertNumberFormatException(String numstr) {
    try {
        int number = Integer.valueOf(numstr).intValue();
        fail("Expected NumberFormatException for string \"" + numstr +
             "\" but instead got the number " + number);
    } catch(NumberFormatException e) {
        // expected exception
    }
} 
```

对于在测试用例中放入多少断言，我可以想到一些简单的规则：

*   不要有多个`assert`依赖于先前执行的副作用。
*   将测试相同功能/特性或其方面的 s组合`assert`在一起——在不需要时不需要多个单元测试用例的开销。
*   上述任何规则都应该被实用性和常识所覆盖。您可能不希望有一千个单元测试用例在每个测试用例中包含一个断言（甚至是多个断言），并且您不希望一个测试用例包含数百个`assert`语句。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-17T23:09:59.370

不，这不是一个坏习惯。如果您正在测试的方法返回一个类，您应该测试应该设置的不同变量。为此，您不妨使用一个单元测试。

但是，如果您在一个单元测试中测试多个功能，那么当它失败时，您将不清楚是哪些功能导致了问题。记住单元测试是你的朋友，所以让他们帮助你。使其易于查看出了什么问题，以便您可以修复它。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-18T00:12:43.510

您的单元测试应该是相当细粒度的。通常，断言越少，您的测试就越有可能针对特定功能，而不是在同一测试中混合测试多个功能。这是否意味着所有测试都应该只有一个断言？不，但如果我发现几个断言，我会认为这是一种“测试气味”，可能会在同一个单元测试中测试多个东西。像对待代码气味一样对待这种“气味”，并重构测试以改进它，以便它只测试一个“事物”——即使它需要多个断言。

例如，我现在正在做一个 MVC 项目，我编写的测试之一是正确的视图是由动作呈现的。如果不同的代码路径可能导致不同的视图，则实际上可能有其中的几个。这就是我将其定义为正确视图的方式：结果是正确的类型并具有正确的名称。这需要两个断言，但我只测试一件事。

```
var result = controller.Action() as ViewResult;

Assert.IsNotNull( result );
Assert.AreEqual( viewName, result.ViewName ); 
```

我可能会对模型做类似的事情，但我不会在与检查视图相同的测试中测试模型是否正确，因为这些是代码行为的不同方面。我可以更改预期的模型或视图，并将其放在单独的测试中，只有那些与方法的该特性相关的测试需要更改。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-18T00:48:58.353

对我来说，在单元测试中有多个断言是很常见的。我通常有一个前提条件的断言，然后是预期的后置条件的断言。

考虑：

```
assert(list.isEmpty());

FetchValues(list);

assert(list.count == expectedItemCount);

AssertValuesMatch(list,expectedValues); 
```

是的，我可以将两个后置条件分成两个测试，但根据 FetchValues 的成本可能会不必要地减慢整个测试过程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-17T23:11:34.377

我不认为这是不好的做法。单元测试可以做任何他们想做的事情：断言、记录到文件、向管理层发送侮辱性 SMS 消息，等等。

*可能的*问题是，增加的复杂性可能会改变被测程序的行为，但如果你小心的话，这种情况很少发生，而且无论如何都可以被发现。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-06-01T18:11:27.620

我绝对应该在测试方法中只使用一个断言！使用许多断言可能是您正在测试不止一件事的代码味道。此外，有人可能会在您的测试中添加新的断言而不是编写另一个断言。当第一个断言失败时，你如何理解你的其他断言是如何完成的？

您可能还会发现这篇文章很有趣：[https ://timetocode.wordpress.com/2016/06/01/zen-of-unit-testing/](https://timetocode.wordpress.com/2016/06/01/zen-of-unit-testing/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-18T00:16:04.797

放入您想要的所有断言。严重地。

我试图断言直到并包括我的测试的具体目标的每一步。

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2009-04-18T00:02:34.563

没关系。唯一重要的是您的单元测试将涵盖所有可能的错误。

这是“过度思考”的一个例子。

# c# - 设置类的任何属性时，有没有办法调用方法？

> ID：762514
> 
> 赞同：6
> 
> 时间：2009-04-17T23:03:56.467
> 
> 标签：c#, reflection, properties, delegates

因此，我要做的是在设置 C# 类中的任何属性时调用单个 propertyWasSet() 函数（相反，在获取时调用 propertyWasGot()）。我还想知道调用了哪个属性的“get”。

我想维护一个“设置”属性的字典，并检查“获取”操作是否已设置（如果尚未设置则抛出错误）。

我一直在查看 msdn 文档中的反射、代表等...，但我不完全确定这是可能的。

有没有办法做到这一点？或者在调用可以在基类或其他东西中拦截的这些函数之一时触发事件？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-17T23:17:45.390

前一周我为 Set 写了一个拦截器，它可以很容易地为 Get 扩展，它使用 RealProxy，这意味着你的基类需要从 MarshalByRefObject 派生。

另一个奇特的选择是让你的类抽象，并使用反射发射来构造一个包含所有属性的具体类。

您也可以查看代码生成器来解决这个问题或 PostSharp ...

此解决方案的性能并不出色，但对于大多数 UI 绑定来说应该足够快。可以通过为代理调用生成 LCG 方法来改进它。

```
public interface IInterceptorNotifiable {
    void OnPropertyChanged(string propertyName);
}

/// <summary>
/// A simple RealProxy based property interceptor
/// Will call OnPropertyChanged whenever and property on the child object is changed
/// </summary>
public class Interceptor<T> where T : MarshalByRefObject, IInterceptorNotifiable, new() {

    class InterceptorProxy : RealProxy {
        T proxy; 
        T target;
        EventHandler<PropertyChangedEventArgs> OnPropertyChanged;

        public InterceptorProxy(T target)
            : base(typeof(T)) {
            this.target = target;
        }

        public override object GetTransparentProxy() {
            proxy = (T)base.GetTransparentProxy();
            return proxy;
        }

        public override IMessage Invoke(IMessage msg) {

            IMethodCallMessage call = msg as IMethodCallMessage;
            if (call != null) {

                var result = InvokeMethod(call);
                if (call.MethodName.StartsWith("set_")) {
                    string propName = call.MethodName.Substring(4);
                    target.OnPropertyChanged(propName);
                } 
                return result;
            } else {
                throw new NotSupportedException();
            } 
        }

        IMethodReturnMessage InvokeMethod(IMethodCallMessage callMsg) {
            return RemotingServices.ExecuteMessage(target, callMsg);
        }

    }

    public static T Create() {
        var interceptor = new InterceptorProxy(new T());
        return (T)interceptor.GetTransparentProxy();
    }

    private Interceptor() {
    }

} 
```

用法：

```
 class Foo : MarshalByRefObject, IInterceptorNotifiable {
        public int PublicProp { get; set; }
        public string lastPropertyChanged;

        public void OnPropertyChanged(string propertyName) {
            lastPropertyChanged = propertyName;
        }

    }

    [Test]
    public void TestPropertyInterception() {

        var foo = Interceptor<Foo>.Create();
        foo.PublicProp = 100;

        Assert.AreEqual("PublicProp", foo.lastPropertyChanged);

    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T23:08:53.587

您可能需要查看[PostSharp](http://www.postsharp.org/)来完成此类任务。它被设计为在 C#（或任何 .NET 语言）之上运行，并且具有额外的反射不会使您的代码混乱的好处。事实上，我不相信你能找到一个纯粹使用 C#/Reflection 的解决方案，而不需要手动向你的每个属性添加代码，所以我肯定会推荐 PostSharp 作为要走的路。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T16:12:23.553

您请求的 SET 部分与 WPF 依赖属性系统非常相似。但是 GET 部分是如此不寻常，甚至在 WPF 依赖属性系统中也没有！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T23:08:17.330

我认为您需要的与 WPF 依赖属性系统非常相似。你可能想看看它的实现。无论如何，您也可以将拦截代码添加到每个属性的 getter 和 setter 中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T23:09:01.743

如果您不自己创建它，就没有这样的东西。

# vim - Vim：重新映射键以切换行号

> ID：762515
> 
> 赞同：18
> 
> 时间：2009-04-17T23:04:45.250
> 
> 标签：vim, key-bindings, remap

我补充说：

```
set number
nnoremap <F2> :set nonumber! 
```

到我的 vimrc 文件。基本上它应该做的是让我按下`F2`切换行号，但它不起作用。我做错了什么？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-17T23:13:27.180

在您的`.vimrc`中，添加以下内容：

```
set number
nnoremap <F2> :set nonumber!<CR> 
```

然后按下`F2`将切换行号。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-18T00:31:46.507

这就是我使用的（使用不同的键绑定）：

```
nmap <f2> :set number! number?<cr> 
```

数字！” 切换设置和“数字？” 报告状态。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-06-05T19:19:46.823

```
nmap <silent> <F11> :exec &nu==&rnu? "se nu!" : "se rnu!"<CR> 
```

在新的 vim 中，您可以同时设置相对数字和数字，这样：

```
set nu rnu 
```

[![在此处输入图像描述](https://i.stack.imgur.com/grzGM.png)](https://i.stack.imgur.com/grzGM.png)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-18T00:50:51.267

这是一种方法：

```
map <silent> <F2> :if &number <Bar>
    \set nonumber <Bar>
        \else <Bar>
    \set number <Bar>
        \endif<cr> 
```

（这个很好，因为我通常也会把 foldcolumn 放在那里）

这是另一个：

```
map <silent> <F2> :set invnumber<cr> 
```

（直接法）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-07-25T10:10:15.883

我用它在 relativenumber （具有当前绝对行号）和无行号之间切换

```
nnoremap <silent> <leader>l :set relativenumber! <bar> set nu!<CR> 
```

# ruby-on-rails - 在 Rails 中使用 Javascript OpenID 选择器

> ID：762520
> 
> 赞同：1
> 
> 时间：2009-04-17T23:05:58.633
> 
> 标签：ruby-on-rails, ruby, authentication, openid, openid-selector

根据[这篇文章](https://stackoverflow.com/questions/702114/stackoverflow-like-login-system-in-rails)，似乎 SO 正在使用[Javascript OpenID Selector](http://code.google.com/p/openid-selector/) (JOIS) 在其“视图”中处理 OpenID 登录。

我喜欢简单的界面，我想在 Rails 项目中使用它。

我知道[RPX](https://rpxnow.com/)可能是更容易的选择，但我想自己构建它。

你能帮我找到几个问题的答案吗？

1.  你们中是否有人已经这样做了，或者有人知道一个很好的例子吗？
2.  如果我在我看来使用 JOIS，你会推荐什么设置（插件/宝石的组合）？
3.  是否有基于[Prototype](http://www.prototypejs.org/) 而不是[JQuery](http://jquery.com/)的 JOIS 实现（或除 RPX 之外的任何类似实现） ？
4.  [除了Ruby OpenID](http://openidenabled.com/ruby-openid/)库之外，我是否需要另一个库 来支持 JOIS 支持的所有帐户提供程序（OpenID、Google、Yahoo 等）？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T17:35:22.023

回答#4，不。OpenID 选择器提供的所有选项都是标准的 OpenID 提供程序，而 ruby​​ OpenID 库（我假设您说的是 Janrain 库）支持所有这些选项。

抱歉，剩下的我不能帮你。我自己已经有 3 年没有真正使用过 Ruby 库了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-03T17:38:11.050

我帮助自己并使用 Rails 实现了 Javascript OpenID-Selector（尽管使用 JQuery 而不是 Prototype）：

[https://github.com/vazqujav/authlogic_openid_selector_example](https://github.com/vazqujav/authlogic_openid_selector_example)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-30T20:14:07.267

1.  我将[open-selector.com作为](http://open-selector.com)[IdSelector](http://idselector.com)的替代品。您可以随意检查代码并查看它（它只是一个 .js 文件）
2.  根本没有必要搞乱服务器端身份验证，只要您可以提交表单就可以了。
3.  我使用了 Jquery，但主要用于更改 CSS 属性和帮助选择节点，您可以使用任何其他 JS 框架轻松地做到这一点
4.  如果您谈论的是 JS 解决方案，那么网站登录过程背后的技术应该是什么（参见 #2）。OpenID 协议旨在与提供者无关，因此您的标准 OpenID 库应该适用于任何支持 OpenID 的提供者（Google、Yahoo、MySpace 等）

# actionscript-3 - 使用自定义 LoaderInfo 类的自定义 AS3 Loader 类？

> ID：762521
> 
> 赞同：3
> 
> 时间：2009-04-17T23:06:43.327
> 
> 标签：actionscript-3

这是一个专门关于创建自定义 Loader 类作为[如何修改现有 AS3 事件以便我可以传递数据的后续问题的问题？](https://stackoverflow.com/questions/758322/how-do-i-modify-existing-as3-events-so-that-i-can-pass-data). 如果这不是解决此问题的正确方法，请告诉我。

我有一个自定义 Loader 类和一个自定义 LoaderInfo 类。我想不通的是如何让 Loader 类使用自定义 LoaderInfo 类作为它的 contentLoaderInfo 属性。

```
package com.display {
    import flash.display.Loader;

    import com.display.CustomLoaderInfo;

    public class CustomLoader extends Loader {
        public var customData:*;

        public function CustomLoader(passedData: *= null) {
            customData = passedData;
        }
    }
} 
```

^ 必须在其中做一些事情以使其具有新的 CustomLoaderInfo

```
package com.display {
    import flash.display.LoaderInfo;    
    import flash.events.Event;

    import com.events.CustomEvent;

    public class CustomLoaderInfo extends LoaderInfo {
        public var customData:*;

        public function CustomLoaderInfo(passedData: *= null) {
            customData = passedData;
        }       

        override public function dispatchEvent(event:Event):Boolean {
            var customEvent:CustomEvent = new CustomEvent(event.type, customData, event.bubbles, event.cancelable);
            return super.dispatchEvent(customEvent);
        }
    }
} 
```

^ 这可能有效，但由于我无法让 CustomLoader 使用它，所以我还不知道。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-19T17:07:03.907

我不知道它如何适合您正在做的事情，但您根本不会费心制作扩展的 LoaderInfo。Loader.contentLoaderInfo 有一个名为 loader 的属性，它将返回所使用的 Loader（或在本例中为 CustomLoader）。理论上，您可以使用您拥有的 CustomLoader 类来执行此操作：

```
 var loader: CustomLoader = new CustomLoader("Extra Data");
loader.load(new URLRequest("file.swf"));
loader.contentLoaderInfo.addEventListener(Event.COMPLETE, loaderComplete);

function loaderComplete(event: Event) : void
{
    var customData:* = (event.target.loader as CustomLoader).customData;
    trace(customData); // Extra Data
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T18:28:14.343

您必须覆盖创建 loaderinfo 实例的函数，这可能位于私有函数中。然后，在新函数中，您可以实例化您的自定义 loaderInfo 类，但您还必须执行覆盖方法所做的任何其他事情。您也可能会遇到一些关于 loadinfo 的安全沙箱问题。覆盖这样的函数通常只有在编写函数时才考虑到这一点。

或者，您可以使用原型链（[在此处阅读](http://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7f3f.html)）在运行时更改 loaderInfo 类。但我不会推荐它。在我看来，这不是一个好习惯。

如果您让它工作，您仍然会遇到问题，即您的自定义事件将无法与任何具有未从 Event 类继承的属性的事件一起使用（例如具有进度相关属性的 ProgressEvent）。

我会说你应该寻找另一种解决方案。在您链接到您的问题中，您谈论发送带有您的事件的影片剪辑。你有没有想过到达另一条路？当您收到事件时，您将获得对调度它的对象 (Event.target) 的引用。您不能使用该参考来获取影片剪辑吗？

也许你可以更详细地解释你的问题（也许在一个新问题中，所以你仍然保持开放），我相信有更好/更简单的方法来解决它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-04T21:53:00.260

我需要这样的东西，因为我想携带一个带有信息的索引......即 - 在触发事件后有类似 event.target.index 的东西可用......无论如何我设计了一个包含加载器和加载器信息的类。 ..继承人类

公共类 LoaderBox 扩展 Sprite {

```
 public static var PROGRESS:String = "progress"
   public static var COMPLETE:String = "complete"

   public var id:int
   public var index:int
   public var loader:Loader
   public var info:LoaderInfo
   public var isOpen:Boolean
   //
   public var percent:Number = -1

   public function load(path:String,idx:int=-1,nm:String=null){
       loader  = new Loader()
       if (nm != null){
           name = nm
       }
       index = idx
       var req:URLRequest = new URLRequest(path)
       info = loader.contentLoaderInfo
       info.addEventListener(Event.COMPLETE,complete)
       info.addEventListener(ProgressEvent.PROGRESS,progress)
       isOpen = true
       loader.load(req) 
    }
    private function complete(e:Event):void{
       isOpen = false
       dispatchEvent(new Event(LoaderBox.COMPLETE))
    }
    private function progress(e:ProgressEvent):void{
       if (e.target.bytesTotal>0){  
          percent = Math.floor(e.target.bytesLoaded/e.target.bytesTotal * 100)
       }
       dispatchEvent(new Event(LoaderBox.PROGRESS))
    } 
```

}

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-09T17:10:12.900

标记答案的潜在问题：如果 contentLoaderInfo 吐出 IOError，则无法访问 .loader 属性来访问自定义加载器类。

我所做的如下： * 在我的自定义加载器类中，创建以下方法：

```
 public function requestError(event:Event):void {
        dispatchEvent(event);           
    } 
```

当为 IOerror 添加一个监听器到 contentLoaderInfo 时，指向自定义加载器类的方法：

```
_loaderCls.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR, _loaderCls.requestError); 
```

然后，将相同的侦听器添加到您的加载器类并使其调用您需要的任何方法。那时， event.target 将是您的自定义加载器类的，您可以向该类添加您需要的任何额外信息：

```
_loaderCls.addEventListener(IOErrorEvent.IO_ERROR, requestError); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-24T22:11:29.693

或者您可以做更好的事情将数据传递到 Loader 类：

```
 package com.display
{
    import flash.display.Loader;

    public class Loader extends flash.display.Loader
    {
        private var _obj:Object;

        public function Loader():void
        {
            super();
        }

        public function get obj():Object
        {
            return _obj;
        }

        public function set obj(o:Object):void
        {
            _obj = o;
        }
    }

} 
```

# .net - 是否有类似 WCF/ASP.NET Web 服务的东西可以按照我希望的方式工作？

> ID：762523
> 
> 赞同：0
> 
> 时间：2009-04-17T23:07:35.507
> 
> 标签：.net, web-services

*（是的，我心怀不满、恼怒和争论，好吧，我在这里发泄一下，但我的实际问题**是**客观的，我保证`<g>`）*

## 排气

在过去的两周里，我刚刚浏览了 WCF 的许多方面以及现在的 ASP.NET Web 服务。这是通过。获取错误/谷歌错误/修复错误（可能）/重复循环。经过几个小时（主要是在配置部分）之后，我有点惊讶有人甚至会费心使用它们。足够的通风...

## 问题

我需要在互联网上的 Web 服务器上有一个客户端应用程序调用代码。我希望服务器端代码看起来像这样

```
interface I
{
  string GetFoo(int i);
  SomeType GetBar(OtherType ot);
}

[HostAsService<I>]
class Foo : I
{
    ....
} 
```

和客户端看起来像这样

```
I i = new ServiceProxy<I>(new Uri("http://my.domain.com/some/path")); 
```

重要的是，此配置是最小且直接的：不包括 12 个不同位置的服务名称，没有向导生成代码和 web.config 条目，当我从本地测试切换时，没有需要更改的隐藏 URL机器在服务器上进行测试。我只想简单

有这样的吗？

*注意：与更复杂、更灵活的模型相比，我实际上更喜欢更简单、更不灵活、更少破坏模型的东西。只要我可以在管道中填充任何可序列化的类型，这就是我需要的所有灵活性*

*注意 2：我**不是**在问如何使用 WCF 或 ASMX 服务（如果可以按照我想要/需要的方式工作，那很好，但我真的不在乎此时使用什么，只要它有效）*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T01:03:13.607

[这是一个非常简单的 WCF 服务示例](http://weblogs.asp.net/ralfw/archive/2007/04/14/a-truely-simple-example-to-get-started-with-wcf.aspx)。它似乎非常接近你想要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T08:04:54.000

您绝对可以在一个非常基本的 WCF 场景中完成所有这些 - 如果您愿意，您可以在代码中完成所有设置和配置，而不是配置。

您需要在服务器端：

1) 定义函数调用的服务合同 IMyService 2) 实现该接口的服务实现 MyService 3) 将托管您的服务的服务主机 - 这是您必须定义诸如绑定之类的部分（要使用什么协议使用）和端点（使用什么地址）

您需要在客户端：

1）访问 IMyService 接口（将其放入自己的独立接口程序集） 2）创建 ChannelFactory 3）让通道工厂为您提供与服务通信的通道

这一切都可以在代码中完成 - 没有外部配置可言。

Pluralsight 的 Aaron Skonnard 进行了 5 到 15 分钟的精彩系列赛。[有关如何创建 WCF 服务的屏幕投射](http://channel9.msdn.com/shows/Endpoint/)- 通常显示如何在代码中执行此操作，以及如何使用配置执行此操作。第 9 频道的节目“Endpoint.TV”实际上也混杂了工作流内容 - 但您也应该能够在其中找到基本的 WCF 截屏视频。一探究竟！

马克

PS：如果您认真学习 WCF（我绝对会推荐！），您应该查看 Michèle Leroux Bustamante 的书[Learning WCF - A Hands On Guide](https://rads.stackoverflow.com/amzn/click/com/0596101627) - 强烈推荐。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T23:18:39.240

实际上，WCF 足够灵活，您应该能够自己创建这样的东西。不过，如果您不使用配置文件，我不知道您会在哪里指定要使用的序列化。我也不知道一旦您在服务器上更改了序列化选择，您将如何将其传达给客户端。

当然，如果没有任何配置，您就会陷入默认设置。我假设您希望默认值为 http 或 https、SOAP 格式、文档/文字、没有 WS-* 功能等？

我有点担心您使用的是“ASP.NET Web 服务”一词。您没有使用 ASMX 服务，是吗？不。

# c# - 如何自动将 VS2003 类转换为部分 Designer.cs 文件？

> ID：762528
> 
> 赞同：9
> 
> 时间：2009-04-17T23:09:12.167
> 
> 标签：c#, visual-studio, winforms, partial

我正在将一个项目从 Visual Studio 2003 升级到 2008，并希望自动生成`XXX.Designer.cs`文件并更新相应的`XXX.cs`原始文件。

有什么自动的方法吗？

**更新**：我指的是 WinForms。当然，我知道旧样式有效，但我正在寻找一种无需手动操作即可采用新样式的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-09-06T05:41:11.780

有一个浮动的宏可以做到这一点。我已经使用它并且效果很好。从查看[Nathan Jones 博客](http://www.nathanpjones.com/wp/2010/02/converting-vb-net-2003-winforms-to-20052008-partial-classes/)开始。如果您运气不佳，请从[VSCONVERT - PasteBin 下载宏源（我发布）的 zip](http://pastebin.com/fG8L0Dh6)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T23:38:40.307

我们遇到了这个问题。

基本上，设计器文件应该只包含一组对象声明（即表单上的对象）和 InitializeComponent() 调用。如果你在你的构造函数上做了任何花哨的工作，那也可能在那里。

只需创建一个名为 MyForm.Designer.cs 的文件并将其添加到项目中。VS2008 会自动将它放在 MyForm.cs 下面。从那里，如果您创建部分类标题和命名空间，然后将所有声明和 Initializecomponent 调用复制到设计器文件中，那么它将起作用。

但是因为如果你不得不，人们会编辑initializecomponent并编辑默认构造函数，VS2005和2008无法自动升级这些文件，因为可能会发生各种奇怪的事情。我想从项目的角度来看，您认为您的工作代码将从分离中获得什么好处？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T01:40:32.067

原始类将继续工作 - 即使使用 Visual Studio 设计器。VS 放在 Designer 类中的代码只是为了将设计器“噪音”移除到单独的文件中，这样您就可以专注于类中的非可视代码。

使用向导将项目迁移到 VS2008 后，您可以在 VS 中打开表单并像以前一样继续编辑它们。您创建的任何新表单都将获得 Designer 支持文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T23:13:23.543

我不确定我是否理解，但我会猜测一下。

这是 VS2003 中的 ASP.NET 项目吗？里面有 .Designer.cs 文件吗？是不是您已经进行了升级，但您发现您现在没有 .Designer.cs 文件？

如果是这样 - 您可能无意中将您的 Web 应用程序项目更改为网站“项目”。这种“项目”是在 VS2005 中引入的，所以你还没有看到它。这些不是真正的项目（没有 .csproj 文件），它们还有许多其他差异。

否则，如果您的项目过去没有 .Designer.cs 文件，那么您为什么现在需要它们呢？

一般来说，创建设计器文件的方法是在设计器中打开文件，等待一段时间让设计器完成它正在做的事情（更新屏幕等）；然后保存文件。您可能必须“触摸”原件才能让设计师重新评估事物。

# windows - 如何编写运行 vcvars32.bat 的构建批处理脚本，然后继续构建？

> ID：762539
> 
> 赞同：17
> 
> 时间：2009-04-17T23:16:53.067
> 
> 标签：windows, visual-studio, vcbuild

我想编写一个简单的批处理脚本来加载 Visual Studio 构建环境`vcvars32.bat`，然后使用`vcbuild`. 但是，我的脚本不会在`vcvars32.bat`. 我得到的最后一个输出是：

```
Setting environment for using Microsoft Visual Studio 2008 x86 tools. 
```

如您所见，我使用的是 Visual Studio 2008。这是我最简单的批处理脚本：

```
@echo off
"C:\Program Files\Microsoft Visual Studio 9.0\VC\bin\vcvars32.bat"
vcbuild 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-17T23:17:01.460

你必须`call`在你的批处理脚本中使用，否则终止`vcvars32.bat`会终止你自己的批处理脚本。因此，您的脚本应该是：

```
@echo off
call "C:\Program Files\Microsoft Visual Studio 9.0\VC\bin\vcvars32.bat"
vcbuild 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-18T01:43:51.373

您还需要检查该脚本是否尚未运行，或者如果您在同一个控制台中一遍又一遍地调用您的脚本，您将开始耗尽内存。

```
IF '%VSINSTALLDIR%' NOT EQU '' THEN EXIT 0 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-02-27T20:36:58.157

确切的程序文件路径取决于您使用的是 32 位还是 64 位操作系统以及 Visual Studio 的安装位置。使用 Visual Studio 在安装时设置的 VS100COMNTOOLS 环境变量来解决这个问题。

```
call "%VS100COMNTOOLS%\..\..\VC\bin\vcvars32.bat"
... 
```

请注意，每个版本的 Visual Studio 都有一个基于其基础版本号的特定环境变量。

```
Visual Studio 2005    VS80COMNTOOLS
Visual Studio 2008    VS90COMNTOOLS
Visual Studio 2010    VS100COMNTOOLS
Visual Studio 2012    VS110COMNTOOLS
Visual Studio 2013    VS120COMNTOOLS
Visual Studio 2014    VS130COMNTOOLS
Visual Studio 2015    VS140COMNTOOLS
Visual Studio 2016    VS150COMNTOOLS
Visual Studio 2017    VS160COMNTOOLS 
```

你明白了。

# linux - 哪种颠覆服务器类型最好？

> ID：762545
> 
> 赞同：6
> 
> 时间：2009-04-17T23:18:36.293
> 
> 标签：linux, svn

Subversion 有多种服务器类型：

*   svnserve 守护进程
*   svnserve 通过 xinetd
*   svn over ssh
*   基于http的服务器
*   通过 file:/// URLs 直接访问

其中哪一个最适合小型 Linux 系统（一到两个用户）？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-18T14:45:21.853

**网址：**

*   非常灵活且易于管理
*   没有网络问题（端口 80）
*   第 3 方身份验证（例如 LDAP、Active Directory）
*   Unix + Win 原生支持
*   webdav 支持在没有 svn 客户端的情况下进行编辑
*   慢，因为每个动作都会触发一个新的 http 动作。比 svn:// 慢 5-8 倍
*   历史上特别慢
*   不加密传输的数据

**HTTPS：**

*   和http一样
*   传输数据的加密

**svn:**

*   最快的传输
*   标准中没有密码加密。设置：管理员可以读取密码
*   防火墙问题，因为没有使用 std.port
*   必须启动守护程序服务
*   不加密传输的数据

**svn+ssh**

*   几乎和 svn:// 一样快
*   没有 Windows 操作系统带有内置 ssh 组件，所以 3rd 方工具是 essentiell
*   不需要守护程序服务
*   密码加密
*   传输加密

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-17T23:44:49.880

其中一个选项绝对是“最差”的选项：文件访问。不要使用它，而是使用其中一种基于服务器的方法。

然而，是使用 HTTP 还是使用 Svnserve 完全是一个偏好问题。事实上，您可以同时使用两者，repo 上的写锁确保您在使用一个然后使用另一个时不会损坏任何东西。

我的偏好只是简单地使用 apache - http 对防火墙和互联网更友好，它也更容易连接到 ldap 或其他身份验证机制，并且您也可以获得 webdav 之类的功能。性能可能低于 svnserve，但不是特别明显（通过网络传输数据构成了任何性能问题的大部分）

如果您需要文件传输的安全性，那么 svnserve+ssh 或 apache over https 是您的选择。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-18T00:23:42.033

查看[牙线周刊第 28 集](http://www.twit.tv/floss28)。Greg Stein 是 SVN 的 WebDAV 协议的发明者之一，并讨论了权衡。我的收获是 SVN: 更快，但 http/webdav 实现几乎适用于所有目的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-17T23:37:34.280

我一直使用 XInetD 和 HTTP。HTTP 也有 WebDAV，所以如果我愿意，我可以在线浏览源代码（或者如果你想要加密和暗网类型的东西，你可以需要一个 VPN）。

这实际上取决于您受到的限制（如果有的话）。

它只会在局域网上吗？您需要在 LAN 之外进行访问吗？如果是这样，你会有VPN吗？您是否有静态 IP 地址并且是否允许转发端口？

如果您没有受到任何限制，那么我建议您使用 xinetd（如果您安装了 xientd，如果没有安装，则使用守护程序）然后（如果您需要远程访问）如果您需要远程访问，请使用基于 http 的服务器（如果您不想发送纯文本 un/pw，也可以使用 HTTPS 进行加密）。

大多数其他选择是更多的努力，更少的好处。

这是一个 SVN 存储库——如果你不喜欢它，你可以随时收拾行李并进行更改。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-18T01:48:25.043

为了便于管理和安全，我们将 svn+ssh 用于需要提交访问的任何内容。我们为一些开源代码的匿名（只读）访问设置了基于 HTTP 的访问，而且速度要快得多；svn+ssh 的问题是它必须为每个用户启动一个 ssh 连接和一个全新的 svnserve 以进行每个操作，一段时间后可能会变得非常慢。

所以，我建议：

*   **http**用于匿名连接
*   **svn+ssh**如果您需要一些安全且相对快速和简单的东西（假设您的用户已经设置了 ssh 并且您的用户可以访问服务器）
*   **https**如果您需要更快、更安全的东西，并且您不介意管理它的额外开销（或者如果您尚未设置 ssh 或不想处理 Unix 权限）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-17T23:26:20.160

我喜欢[sliksvn](http://www.sliksvn.com/en/download)在 Windows 中作为服务运行，只需 2 分钟即可设置，然后忘记它。
它还附带客户端工具，但也可以下载 tortoise。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-17T23:46:43.790

如果您打算仅在本地计算机上使用服务器并了解 unix 权限，则使用 file:// url 将快速、简单且安全。同样，如果您了解 unix 权限和 ssh 并需要远程访问它，那么 ssh 会很好用。虽然我看到其他人将其称为“最差”，但我很确定这仅仅是因为需要了解 unix 权限。

如果您不喜欢或不了解 unix 权限，则需要使用 svnserve 或 http。我个人可能会选择在 xinetd 中运行它。

最后，如果您有防火墙或代理问题，您可能需要考虑使用 http。它要复杂得多，我认为你不会看到好处，所以我会把它放在你的名单上。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-18T00:10:17.900

我会推荐这个`http`选项，因为我目前正在使用`svn+ssh`它，而且它似乎是可用协议的红发继子：3rd-party 工具支持始终`svn+ssh`比`http`.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-18T01:21:00.680

我负责为我的开发团队管理 svnserve 和 Apache+SVN，我更喜欢基于 http 的解决方案，因为它具有灵活性。我对系统管理知之甚少，毕竟我是一名软件专家，我喜欢能够将身份验证和授权交给 Apache。

两种方法的团队大约有 10 到 15 人，两种方法都同样有效。如果您计划将来进行任何扩展，您可以考虑基于 http 的解决方案。它与 svnserve 一样易于配置，而且如果您不打算将服务器暴露在 Internet 上，那么您也不必过多担心 Apache 的安全和管理。

作为 SVN 的用户，我更喜欢基于 http 的与 Apache 的集成。我喜欢能够用我的网络浏览器浏览存储库。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-08T10:23:24.180

我很好奇为什么不 FSFS？重要信息 - 我正在管理 Windows 系统。

我用 SVN 做过很多项目，几乎所有项目都是从 FSFS 运行的。最大的存储库约为 70GB（极限），最大的存储库数量约为 700。

即使我们将它托管在 Windows、NetApp 和许多其他存储系统上，我们也从未遇到过任何问题。大多数时候，当我问为什么不使用 FSFS 时，唯一的问题是人们根本不信任它。

好处：

*   无需后端（或专用服务器）
*   快速可靠
*   支持挂钩脚本
*   使用 NTFS 权限
*   易于理解、易于支持、易于管理

缺点：

*   从您的网络外部访问不是那么容易（VPN）
*   仅存储库级别的权限（读、读/写）
*   挂钩脚本在当前用户凭据下运行（有时是优势，有时是劣势）

马丁

# cocoa - 在 Cocoa 中绘制一堆（~200）彩色矩形的最佳方法是什么？

> ID：762548
> 
> 赞同：1
> 
> 时间：2009-04-17T23:19:06.977
> 
> 标签：cocoa, rectangles

我目前的计划是通过子类化 NSView 来绘制矩形，但这对于我正在尝试做的事情来说似乎是一种非常低效的方式，即绘制一堆固定的、不重叠的矩形，它们会不时改变颜色。有没有更好的办法？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T23:36:27.170

您可以尝试使用`CALayer`s，有点像这样：[http](http://theocacao.com/document.page/555) ://theocacao.com/document.page/555 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T00:26:55.490

如果它们都是相同的颜色或图像，您可能会发现单个 CGLayer 更有效。该 API 的目的是多次绘制相同的东西。

另一方面，如果矩形独立移动或者上面有不同的颜色或图像，Core Animation 绝对是要走的路。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T19:22:19.003

对于游戏来说，Core Animation 将是一项很棒的技术，但如果你暂时想坚持使用 NSView，你可以创建一个类似于 NSCell 的类，游戏板视图使用它来实现定位和绘图。这与许多 Cocoa 控件类的工作方式相似，后者使用单个单元格（具有不同的值）在视图中绘制多个项目。

请记住，使用单独的 NSView 对象可能已经足够快了，但是无论速度差异如何，此策略都允许您以有意义的方式分离逻辑。

# c# - 请帮助我解决使用 POP3 协议检索电子邮件的问题

> ID：762553
> 
> 赞同：2
> 
> 时间：2009-04-17T23:21:44.133
> 
> 标签：c#, compact-framework, pop3

我正在使用 C# 和 Microsoft .Net Compact Framework 1.0。我尝试使用`System.Net.Sockets.NetworkStream`and`TcpClient`类来实现 POP3 协议。我能够登录并接收电子邮件并使用一些电子邮件服务器保存附件。但对于某些人来说，我一直遇到问题。

`List <Index>`我通过发送命令来读取电子邮件的大小。在某些情况下，我得到的尺寸明显小于实际值。例如，对于同一个电子邮件：

```
Actual size: 577860, Returned size: 421096 using Exchange 2007
Actual size: 561005, Returned size: 560997 using Exchange 2003 
```

为什么我总是找不到合适的尺寸？以下是我正在使用的代码。

电子邮件的大小永远不会与程序`StringBuilder`结束时的大小相匹配`PopRead`。我无法可靠地阅读电子邮件，因为电子邮件大小不可靠，并且`DataAvailable`属性`NetworkStream`有时是错误的，即使有更多数据可以读取。

我观察到，`DataAvailable`当我尝试通过无线方式（使用数据计划）连接到电子邮件服务器时，与通过 activesync 使用计算机的 Internet 连接时相比，该属性更常见。

如果有帮助，电子邮件服务器是 Exchange 2003 和 Exchange 2007。

```
private bool POPRead(StringBuilder strBuffer, long lngFetchMailSize)
{
   const int bufferSize = 1024;

    byte[] inb;
    if (enc == null)
    {
        enc = new ASCIIEncoding();
    }

    try
    {
        if (lngFetchMailSize > 0 && lngFetchMailSize < (32 * bufferSize))
        {
            // limit the size of the buffer as the amount of memory
            // on Pocket PC is limited.
            inb = new byte[lngFetchMailSize];
        }
        else
        {
            inb = new byte[bufferSize];
        }
        Array.Clear(inb, 0, inb.Length);
        bool bMoreData = true;
        long iBytesRead = 0L;
        int bytesReadInThisRound = 0;

        int numberOfTimesZeroBytesRead = 0;

        while (bMoreData)
        {
            bytesReadInThisRound = this.nsPOP.Read(inb, 0, inb.Length);
            iBytesRead += bytesReadInThisRound;

            if (bytesReadInThisRound == 0)
            {
                numberOfTimesZeroBytesRead++;
            }
            else
            {//If on a retry the data read is not empty, reset the counter.
                numberOfTimesZeroBytesRead = 0;
            }

            strBuffer.Append(enc.GetString(inb, 0, bytesReadInThisRound));
            Array.Clear(inb, 0, bytesReadInThisRound);
            // DataAvailable sometimes gives false even though there is
            // more to be read.
            bMoreData = this.nsPOP.DataAvailable;
            // Use this number (5), since some servers sometimes give the size
            // of the email bigger than the actual size.
            if ((lngFetchMailSize != 0 && !bMoreData)
                && (iBytesRead < lngFetchMailSize)
                && numberOfTimesZeroBytesRead < 5)
            {
                bMoreData = true;
            }
        }
    }
    catch (Exception ex)
    {
        string errmessage = "Reading email Expected Size: " + lngFetchMailSize;
        LogException.LogError(ex, errmessage, false, "oePPop.POPRead");
        Error = ex.Message + " " + errmessage;
        return false;
    }
    finally
    {
        GC.Collect();
    }
    return true;
} 
```

以下过程用于获取电子邮件的大小：

```
private long GetMailSize(int index)
{
    StringBuilder strBuffer = new StringBuilder();
    const string LISTError = "Unable to read server's reply for LIST command";
    if ((this.POPServer != null) && (this.nsPOP != null))
    {
        if (!this.POPWrite("LIST " + index))
        {
            return -1L;
        }
        if (!this.POPRead(strBuffer))
        {
            this.Error = LISTError;
            return -1L;
        }
        if (!this.IsOK(strBuffer))
        {
            return -1L;
        }
        string strReturned = strBuffer.ToString();
        int pos1 = strReturned.IndexOf(" ", 3);
        if (pos1 == -1)
        {
            this.Error = LISTError;
            return -1L;
        }
        int pos2 = strReturned.IndexOf(" ", (int)(pos1 + 1));
        if (pos2 == -1)
        {
            this.Error = LISTError;
            return -1L;
        }
        int pos3 = strReturned.IndexOf("\r\n", (int)(pos2 + 1));
        if (pos3 == -1)
        {
            this.Error = LISTError;
            return -1L;
        }
        long mailSize = 0;
        Int64.TryParse(strBuffer.ToString(pos2 + 1, pos3 - (pos2 + 1)).Trim(), out mailSize);
        return mailSize;
    }
    this.Error = NotConnectedError;
    return -1L;
} 
```

希望我提供了解决问题所需的所有信息。任何朝着正确方向的帮助或指示都会有很大帮助。

谢谢，
钱德拉。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T01:54:47.073

您的错误可能在于以您的方式使用 ASCIIEncoder。

来自[MSDN](http://msdn.microsoft.com/en-us/library/38b953c8.aspx)：

> 要转换的数据，例如从流中读取的数据，只能在顺序块中可用。在这种情况下，或者如果数据量太大需要分割成更小的块，应用程序应该分别使用GetDecoder方法或GetEncoder方法提供的Decoder或Encoder。

由于您一次解码一点，因此可能会错误地解码流的某些部分。

我会更改您的代码以使用[解码器](http://msdn.microsoft.com/en-us/library/system.text.asciiencoding.getdecoder.aspx)，或者一次读取整个消息，然后使用 GetString() 成员对其进行解码。

作为额外的健全性检查，您可以使用 RETR <index> 返回的消息大小并查看它是否与 LIST 返回的匹配。如果它们不匹配，我至少会选择 RETR 返回的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T23:38:18.367

POP3 是一个棘手的协议。有这么多不同的服务器要处理，许多都有自己晦涩难懂的怪癖。如果这是一个生产应用程序，我会认真考虑购买经过彻底测试的第 3 方组件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T02:04:10.800

由于电子邮件应以句点结尾，因此我会进行此比较以终止循环。

代替

```
 if ((lngFetchMailSize != 0 && !bMoreData)
       && (iBytesRead < lngFetchMailSize)
       && numberOfTimesZeroBytesRead < 5)
  {
      bMoreData = true;
  } 
```

我会把它写成

```
 if(!bMoreData 
    && strBuffer.ToString(strBuffer.Length - 5, 5) != "\r\n.\r\n")
  {
       bMoreData = true;
  } 
```

# objective-c - 从 Objective-C 导航 XML

> ID：762567
> 
> 赞同：4
> 
> 时间：2009-04-17T23:36:51.817
> 
> 标签：objective-c, xml

我从 TwitPic 得到这个 XML 响应：

```
 <?xml version="1.0" encoding="UTF-8"?>
    <rsp stat="ok">
        <mediaid>abc123</mediaid>
        <mediaurl>http://twitpic.com/abc123</mediaurl>
    </rsp> 
```

我想访问“mediaurl”标签中的值。

所以我尝试了：

```
NSString *twitpicURL = [[request responseHeaders] objectForKey:@"mediaurl"]; 
```

但这似乎不起作用。

有人可以指出我正确的方向吗？

谢谢，

杰米。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T01:17:46.147

Apple 的[NSXMLDocument](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSXMLDocument_Class/Reference/Reference.html)（仅适用于 Mac OS X）和[NSXMLParser](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSXMLParser_Class/Reference/Reference.html)（适用于 Mac OS X 和 iPhone）都基于开源 C 库[Libxml2](http://xmlsoft.org/index.html)（适用于 Mac OS X 和 iPhone）。

如果您决定使用 NSXMLDocument，我建议使用[XPath](http://developer.apple.com/documentation/Cocoa/Conceptual/NSXML_Concepts/Articles/QueryingXML.html#//apple_ref/doc/uid/TP40001258)作为获取数据的快速/简单方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T00:16:10.053

CoreFoundation 有一个用于解析 xml 的库。

[http://developer.apple.com/documentation/CoreFoundation/Conceptual/CFXML/CFXML.html](http://developer.apple.com/documentation/CoreFoundation/Conceptual/CFXML/CFXML.html)

如果你不是为苹果平台开发，expat 是一个众所周知的 C XML 解析器 :)

[http://expat.sourceforge.net/](http://expat.sourceforge.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-21T01:19:46.900

我意识到你在几天前问过这个问题，但我想我会给你一个如何使用 NSXMLParser 的例子。我不记得我从哪里学到的，但这是我在项目中使用的技术。

您可以像这样创建自己的类并在网络调用结束后实例化它并调用“parseData：”函数，或者简单地将所有这些笨拙的东西粘贴到处理网络代码的类中并从那里调用函数。

```
#import "ThaweExampleParser.h"

@interface ThaweExampleParser() <NSXMLParserDelegate>
@property (nonatomic) BOOL accumulatingParsedCharacterData;
@property (nonatomic, strong) NSMutableString *currentParsedCharacterData;
@property (nonatomic, strong) NSMutableDictionary *parsedContents;
@end

@implementation ThaweExampleParser

@synthesize accumulatingParsedCharacterData;
@synthesize currentParsedCharacterData;
@synthesize parsedContents;

/*
 *  This function you would call when your network connection finishes.
 *  You pass in the NSMutableData you collected during the request.
 */

- (void)parseData:(NSData *)webData
{
    self.currentParsedCharacterData = [NSMutableString string];
    self.parsedContents = [NSMutableDictionary dictionary];
    NSXMLParser *parser = [[NSXMLParser alloc] initWithData:webData];
    parser.delegate = self;
    [parser parse];
}

/*
 *  The parsed calls this function everytime it finds a new tag.
 *  A tag looks like "<mediaurl>"
 *  So in this case we want to turn or BOOL to YES so that the last function collects only the characters we care about.
 */

- (void)parser:(NSXMLParser *)parser didStartElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName attributes:(NSDictionary *)attributeDict
{
    if ([elementName isEqualToString:@"mediaurl"])
    {
        self.accumulatingParsedCharacterData = YES;
        [self.currentParsedCharacterData setString:@""];
    }
}

/* 
 *  Much the previous function except the tag looks like "</mediaurl>"
 *  Turn our BOOL to NO because we are done collecting characters for the moment.
 *  We also are saving the important data to a dictionary so that you can use it later.
 */

- (void)parser:(NSXMLParser *)parser didEndElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName
{
    if ([elementName isEqualToString:@"mediaurl"])
    {
        self.accumulatingParsedCharacterData = NO;
        [self.parsedContents setObject:[self.currentParsedCharacterData copy] forKey:elementName];
    }
}

/*
 *  The parser calls this function everytime it finds characters.
 *  In your case it would call it maybe 5 or 6 times with data that you dont want to collect.
 *  So we use a BOOL to control what we collect;
 */

- (void)parser:(NSXMLParser *)parser foundCharacters:(NSString *)string
{
    if (self.accumulatingParsedCharacterData) [self.currentParsedCharacterData appendString:string];
}

@end 
```

# unity3d - Unity 的免费版本是否带有完整的源代码？

> ID：762578
> 
> 赞同：13
> 
> 时间：2009-04-17T23:42:39.963
> 
> 标签：unity3d

我正在考虑使用 Unity 的免费版本。有谁知道它是否带有完整的源代码？

此外，许可证是什么样的（与 Torque 引擎相比有多灵活。）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-04T13:01:19.710

Unity 没有提供完整的源代码。您可以请求源许可证，但我相信价格是协商的。见页面底部 - [https://store.unity3d.com/shop/](https://store.unity3d.com/shop/)

我使用过 Unity 和 Torque，发现 Unity 更易于使用。虽然 Torque 带有完整的源代码，但 GarageGames 缺乏设计、资源和整体支持。我的建议是选择 Unity3D。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-07-03T12:01:07.443

您应该会发现这篇博文非常有用：http: [//blogs.unity3d.com/2009/03/20/why-you-probably-dont-need-a-source-code-license/](http://blogs.unity3d.com/2009/03/20/why-you-probably-dont-need-a-source-code-license/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-12-07T18:33:25.307

我认为值得补充的是，现在[Unity Indie 是免费的](http://unity3d.com/#freeunity)！它不附带源代码。许可证比较页面在[这里](http://unity3d.com/unity/licenses)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-11T08:23:18.723

请参阅[Unity 许可证表](http://unity3d.com/unity/licenses)。

# php - 优化非尾递归函数

> ID：762580
> 
> 赞同：1
> 
> 时间：2009-04-17T23:43:50.147
> 
> 标签：php, optimization, recursion

我有这个功能，其基本操作概述如下：

```
function render($index) {
    foreach($things[$index] as $key => $data) {
        echo '<div>';
        /* irrelevant operations */
        if(isset($data['id'])) {
            echo '<div class="wrap">';
            render($things[$data['id']]);
            echo '</div>';
        }
        echo '</div>';
    }
} 
```

我一生都无法弄清楚如何优化此功能；如果调用堆栈变得太大，我担心 PHP 会崩溃。

有没有办法优化这个功能？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-17T23:50:48.290

您必须担心是非常值得怀疑的。如果您将 div 嵌套得足够深以至于调用堆栈被填满，那么递归深度是您最不担心的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T23:48:34.223

你正在做的是有效地遍历一棵树。基本上，这并不比打印树中的所有值差。你有没有因为它变得太大而遇到任何具体的麻烦？这棵树的嵌套有多深？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-18T00:35:07.653

您不需要使用递归对树进行深度优先遍历；它恰好工作得非常好。如果你担心炸掉你的堆栈，你可以在所有只保留最后和当前位置的元素上运行一个长循环。不过，递归是执行深度优先遍历的一种更简单且（通常）更好的方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-18T00:59:20.653

这段代码未经测试，但在我看来，迭代函数应该是这样的：

```
function render($index){
    $stack = array();
    array_push($index);

    $pre = '';
    $post = '';

    while(!empty($stack)){
        $idx = array_pop($stack);

        foreach($things[$idx] as $key => $value){
            $pre .= '<1>';
            $spost = '';

            if(isset($data['id'])){
                $pre .= '<2 class="wrap">';
                $spost .= '</2>';

                $stack[] = $things[$data['id']];
            }

            $spost .= '</1>';
            $post .= $spost;
        }
    }

    return $pre . $post;
} 
```

# java - 如何使动态属性在 JSP 标记文件中起作用？

> ID：762588
> 
> 赞同：3
> 
> 时间：2009-04-17T23:49:53.893
> 
> 标签：java, jsp, tags, dynamic-attributes

因此，根据我的 JSP 参考书，以及我在网上可以找到的所有其他参考资料，我应该能够执行以下操作：

```
<%@ tag dynamic-attributes="dynamicAttributesVar" %> 
```

然后当有人使用我没有在属性指令中定义的属性时，我应该能够从“dynamicAttributesVar”映射中访问该属性：

```
<%= dynamicAttributesVar.get("someUnexpectedAttribute") %> 
```

但是，这根本行不通。当我尝试时，我只是得到一个“dynamicAttributesVar 无法解析”的错误。

现在，我确实发现（通过查看为标记生成的 Java 类）我可以通过执行以下操作“破解”一个有效的动态属性变量：

```
<% Map dynamicAttributesVar = _jspx_dynamic_attrs; %> 
```

现在，除非我还在我的 tag 指令上使用了 dynamic-attributes 参数，否则该 hack 不起作用，所以似乎该参数正在*做某事*。

但我想知道的是，我怎样才能让它为所有其他 JSP 用户做它做的事情？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-09-23T10:05:44.383

只是想获得一个徽章来回答一个四年前的问题。

我也有这个问题，并在[O'Reilly](http://www.onjava.com/pub/a/onjava/excerpt/jserverpages3_ch11/)找到了一些使用 JSTL 而不是 scriptlet 的帮助。

原始海报可以使用此代码来获取所有键/值：

```
<c:forEach items="${dynamicAttributesVar}" var="a"> 
${a.key}="${a.value}" 
</c:forEach> 
```

这将得到一个特定的值：

```
<c:out value="${dynamicAttributesVar['someUnexpectedAttribute']}"/> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-18T00:03:52.767

“dynamicAttributesVar”不是动态属性放入的页面上下文中的键名吗？所以你可以做

```
<c:out value="${dynamicAttributesVar.someUnexpectedAttributes}"/> 
```

或者如果您必须使用 scriptlet：

```
Map dynamicAttributes = (Map) pageContext.getAttribute("dynamicAttributesVar") 
```

（免责声明：我没有尝试过，我只是在带有直接 Java 实现的标签中使用了动态属性......但这似乎是合理的）

# mysql - 如何从 mySQL 中的组合表中获取列的总和？

> ID：762593
> 
> 赞同：1
> 
> 时间：2009-04-17T23:56:02.117
> 
> 标签：mysql, syntax

我一直在尝试为下面的场景编写一个 mySQL 语句，但我无法让它按预期工作。如果你们能帮我把它弄好，我将不胜感激！

我在 mySQL 数据库中有两个表，即*event*和*route*：

**事件：**

> 编号 | 日期 | 目的地 | 司机 | 乘客 | 描述 | 执行

**路线：**

> 姓名 | 距离

*   *drivers*在“jack:jill:john”形式的事件中包含一个字符串，其中包含已注册驱动程序的用户名。
*   *destination*包含事件目标（哦，真的吗？），其值始终与表*route中字段**名称*中的值之一相同（即目标必须已存在于*route*中）。
***   *执行*告诉事件是即将到来（0）还是已经执行（1）。*   *distance*是从家庭位置到目的地的距离，以公里为单位。**

 **我想要的是获得一个特定用户的总距离，只计算已经执行的事件。

例如，如果 Jill 已在两个已执行的事件中注册为驾驶员，其中到目的地的距离分别为 50 公里和 100 公里，我希望查询返回值 150。

我知道我可以使用类似`...WHERE drivers LIKE '%jill%' AND executed = 1`的方法来获取 Jill 驾驶的执行事件，并`SUM()`获取总距离，但是我如何结合这两个表并让它全部工作？

非常感激您的帮忙！

/莱纳斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T00:09:47.620

我已经多年没有使用 MySQL，如果我的语法错误，很抱歉，但是应该这样做：

在通用 SQL 中：

```
select sum(distance) from route
 join event on route.name = event.destination 
 where drivers like '%jill%' AND executed = 1 
```

或者不使用 JOIN：

```
select sum(distance) from route, event
 where drivers like '%jill%' AND executed = 1
 and route.name = event.destination 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T02:49:11.263

斯图尔特的回答向您展示了如何获得列的总和，但我只想指出：

```
...WHERE drivers LIKE '%jill%'... 
```

将返回名称包含字母“jill”的驱动程序的任何事件。

其次，这种数据库设计似乎没有被规范化。您有重复的司机姓名和路线名称。如果您对数据库进行规范化并具有以下内容：

**参与者**

```
编号 | 姓名 | 角色

```

**事件**

```
编号 | 日期 | route_id | 描述 | 执行

```

**路线**

```
编号 | 姓名 | 距离

```

**参与者事件**

```
编号 | 参与者ID | event_id

```

那么处理数据会容易得多。

然后，如果您想实现用户搜索，您可以进行查询：

```
SELECT id FROM participant WHERE
    name LIKE '%jill%' AND
    role='driver'; 
```

然后，如果查询返回多个结果，让用户/应用程序选择正确的驱动程序*，然后*运行`SELECT SUM`类似 Stuart 的查询：

```
SELECT SUM(r.distance) FROM route r
    JOIN event e ON e.route_id=r.id
    JOIN participant_event pe ON e.id=pe.event_id
    JOIN participant p ON pe.participant_id=p.id
    WHERE p.id=?; 
```

否则，确保您仅获得**一名**驾驶员驾驶的总距离的唯一方法是执行以下操作（假设`drivers`以逗号分隔）：

```
...WHERE LCASE(drivers)='jill' OR
    drivers LIKE 'jill, %' OR
    drivers LIKE '%, jill' OR
    drivers LIKE '%, jill,%'; 
```

# vim - 有没有办法在 Vim 中模拟 ReSharper 的“扩展选择”功能？

> ID：762613
> 
> 赞同：7
> 
> 时间：2009-04-18T00:13:32.807
> 
> 标签：vim, editor, resharper, text-editor

ReSharper 有一个很好的功能，称为“扩展选择”：通过反复按`CTRL+W`（我认为这是默认设置），您可以从当前插入符号位置选择越来越多的内容。首先是一个单词，然后是越来越多的单词，一行，内部然后是外部行块（例如 if 块），然后是一个函数，等等......

基本上，通过反复按下组合键，您最终可以选择整个文件。我相信至少你们中的一些人会熟悉它。

我刚刚开始学习 vim 的所有复杂性，但我没有足够的经验来了解如何在 Vim 中实现这样的事情（尽管我认为这是可能的）。所以我的问题是针对 Vim 大师的：这可以做到吗？怎么做？

**更新：**一些背景故事。我一直在和我的前老板谈论 Vim 的所有好处，他认为这一切都很棒。他唯一的问题/问题是：*它有“扩展选择”吗？*到目前为止，我的问题是*否定*的。所以，如果有人知道答案，我最终会赢得讨论：P（也许创建一个新的 Vim 转换`:-)`）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T00:37:18.007

答案是肯定的。进入可视模式后，您可以使用所有常规导航方法以及一些额外的导航方法。

我最喜欢的一些？首先在正常模式下按 v 以进入视觉模式，然后按：

1.  *iw* - 选择内部单词。非常适合选择一个单词，同时排除周围的大括号或引号
2.  *w* - 多次点击以继续选择每个后续单词。
3.  *b* - 选择 wordwise backwords
4.  *^* - 选择从当前位置到行首的所有内容
5.  *$* - 从当前位置到行尾全选

我相信这里的其他人也可以添加到这个列表中。哦，别忘了 Visual Block 模式 Cv 用上面的命令在 vim 中试用它，它在二维中工作:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T02:24:32.477

我快速解决了这个问题。它不能按原样工作。随意在 vim wiki 上进行编辑和发布，如果您对其进行了改进，也可以将其作为插件发布。

您可能想为每种语言制作 ag:resharp_list （例如，一个用于括号语言等）

所需要的只是原始光标位置的标记：标记和重置索引的超时自动命令。

```
"resharp emulator
"TODO this needs a marker
"also c-w is bad mapping as it has a lag with all the other-
"window mappings
"
let g:resharp_index = 0

let g:resharp_select =  ['iw', 'is', 'ip', 'ggVG']

func! ResharpSelect()
    if g:resharp_index >= len (g:resharp_select)
        let g:resharp_index = 0
    endif

    exe "norm \<esc>v" . g:resharp_select[g:resharp_index]
    let g:resharp_index = g:resharp_index + 1
endfun

nnoremap <c-w>  :call ResharpSelect()<cr>
vnoremap <c-w>  :call ResharpSelect()<cr>

"Something to reset on timeout. TODO this doesn't work
au CursorHold :let g:resharp_index = 0<cr> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T00:37:44.263

如果你在谈论 Vim（你应该是 :-），你可以开始用`v`命令标记文本，那么你就有了所有标准的光标移动命令（而且，正如你所知，有*很多*），这将扩展选择，以及移动光标。

然后，您只需对所选文本做任何您想做的事情。

有关血腥细节，请参见[此处](http://www.vim.org/htmldoc/visual.html#Visual)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-18T00:40:10.310

需要编写一个函数来保存当前选择，然后尝试越来越宽的选择，直到新选择超过已保存的选择或选择所有文本。一些可能的选择是：

*   viW - 选择单词
*   vis - 选择句子
*   vip - 选择段落
*   viB - 选择最里面的括号内的文本
*   v2iB - 在下一个最里面的括号内选择文本
*   ggVG - 选择所有文本

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-10T21:53:50.297

我认为杰里米沃尔的方向是正确的。为了进一步了解这个方向，您可以查看 Tim Pope 的“surround.vim”脚本。[github 上](https://github.com/tpope/vim-surround/blob/master/doc/surround.txt)有一个很好的描述。或者，如果您愿意，可以从[vim.org 获取](http://vim.sourceforge.net/scripts/script.php?script_id=1697)。它可能会帮助你做一些你想做的事情，尽管它似乎没有一个功能，比如在标签中选择。让我知道我是否错了。

最终，您真正想要的是封闭文本对象的层次结构。如果你没有，你应该阅读文本对象。[这里](http://blog.interlinked.org/tutorials/vim_tutorial.html)有一个很好的概述。请注意，您可以使用计数一次抓取多个对象，或者迭代地执行此操作（`vawasap}}}`从正常模式尝试）。

您还可以获得定义其他文本对象的脚本，例如[使用](https://github.com/michaeljsmith/vim-indent-object)缩进定义文本对象的脚本。如果您根据通用标准进行格式化，它将适用于多种语言，并保证适用于 python。

一个烦恼是光标结束在可视块的末尾，因此，例如，您不能轻松地选择一些 () 之间的所有内容，然后获取它们之前的函数名称......

...但是，我刚刚在[这篇文章](https://stackoverflow.com/questions/3196424/vim-object-select-with-syntax-aware-text-objects)中发现您可以使用`o`. 凉爽的！

我怀疑从长远来看，您会发现自己能够跳过中间选择更有效率。

无论如何，我很想看看其他人是否也提出了更通用的解决方案！

# c# - 如何在文件的一部分上使用 DeflateStream？

> ID：762614
> 
> 赞同：3
> 
> 时间：2009-04-18T00:14:51.633
> 
> 标签：c#, .net, compression, png, deflate

我正在解决[我的另一个问题](https://stackoverflow.com/questions/723392/using-chunks-in-a-png)它正在读取 PNG 的“zTXt”块中的数据。我正在查找文件中的块，并阅读 zTXt 的关键字。我无法读取 zTXt 的压缩部分。我以前从未使用过 DeflateStream 对象，并且遇到了一些麻烦。读取时，似乎期望长度参数为“未压缩”字节。然而，就我而言，我只知道“压缩”字节中的数据长度。为了解决这个问题，我将所有需要解压缩的数据放入 MemoryStream 中，然后使用 DeflateStream 进行“读取结束”。现在这简直太棒了，除了它抛出一个 InvalidDataException 消息“块长度与它的补码不匹配”。现在我不知道这意味着什么。

块的格式是 ID（“zTXt”）的 4 个字节，数据长度的大端 32 位 int，数据，最后是我现在忽略的 CRC32 校验和。

zTXt 块的格式首先是以 null 结尾（字符串作为关键字），然后是压缩方法的一个字节（始终为 0，DEFLATE 方法），其余数据为压缩文本。

我的方法接收一个新的 FileStream，并返回一个带有 zTXt 关键字和数据的字典。

现在是怪物：

```
public static List<KeyValuePair<string, string>> GetZtxt(FileStream stream)
{
    var ret = new List<KeyValuePair<string, string>>();
    try {
        stream.Position = 0;
        var br = new BinaryReader(stream, Encoding.ASCII);
        var head = br.ReadBytes(8); // The header is the same for all PNGs.
        if (!head.SequenceEqual(new byte[] { 0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A })) return null; // Not a PNG.
        while (stream.Position < stream.Length) {
            int len; // Length of chunk data.
            if (BitConverter.IsLittleEndian)
                len = BitConverter.ToInt32(br.ReadBytes(4).Reverse().ToArray(), 0);
            else
                len = br.ReadInt32();

            char[] cName = br.ReadChars(4); // The chunk type.
            if (cName.SequenceEqual(new[] { 'z', 'T', 'X', 't' })) {
                var sb = new StringBuilder(); // Builds the null-terminated keyword associated with the chunk.
                char c = br.ReadChar();
                do {
                    sb.Append(c);
                    c = br.ReadChar();
                }
                while (c != '\0');
                byte method = br.ReadByte(); // The compression method.  Should always be 0\. (DEFLATE method.)
                if (method != 0) {
                    stream.Seek(len - sb.Length + 3, SeekOrigin.Current); // If not 0, skip the rest of the chunk.
                    continue;
                }
                var data = br.ReadBytes(len - sb.Length - 1); // Rest of the chunk data...
                var ms = new MemoryStream(data, 0, data.Length); // ...in a MemoryStream...
                var ds = new DeflateStream(ms, CompressionMode.Decompress); // ...read by a DeflateStream...
                var sr = new StreamReader(ds); // ... and a StreamReader.  Yeesh.
                var str = sr.ReadToEnd(); // !!! InvalidDataException !!!
                ret.Add(new KeyValuePair<string, string>(sb.ToString(), str));
                stream.Seek(4, SeekOrigin.Current); // Skip the CRC check.
            }
            else {
                stream.Seek(len + 4, SeekOrigin.Current); // Skip the rest of the chunk.
            }
        }
    }
    catch (IOException) { }
    catch (InvalidDataException) { }
    catch (ArgumentOutOfRangeException) { }
    return ret;
} 
```

一旦解决了这个问题，我需要编写一个函数，将这些 zTXt 块添加到文件中。所以希望一旦解决这个问题，我就能理解 DeflateStream 是如何工作的。

非常感谢！！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-21T23:59:46.350

经过这么长时间，我终于找到了问题所在。数据采用 zlib 格式，存储的数据比单独使用 DEFLATE 多一点。如果我在获得压缩数据之前刚刚读取了 2 个额外字节，则该文件被正确读取。

请参阅[此反馈页面](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=97064)。（我没有提交那个。）

我现在想知道。这两个字节的值分别是 0x78 和 0x9C。如果我发现其他值，我应该假设 DEFLATE 会失败吗？

# java - .net alternatives for available java programs

> ID：762625
> 
> 赞同：0
> 
> 时间：2009-04-18T00:26:05.850
> 
> 标签：java, .net

I have seen some question asking java alternative for something which is available in .net

Example : [Java alternative to Windows Workflow Foundation](https://stackoverflow.com/questions/762499/java-alternative-to-windows-workflow-foundation)

I am interested to know if there is anything else that is available in java and we have to look for an alternative in .net. I am a MS based technology developer and don't have much experience developing in java so I am interested to know about this.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T00:34:07.780

[Windows Workflow Foundation is .NET](http://msdn.microsoft.com/en-us/netframework/aa663328.aspx)

There are many technologies in Java, that might not have equivalents in .NET

I think you should be more specific.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T00:44:05.230

[K2](http://www.k2.com/en/index.aspx) is a good alternative to WF. Or maybe I misunderstand your question. :)

# debugging - 如何在 GDB 中获取内存地址的符号名称？

> ID：762628
> 
> 赞同：45
> 
> 时间：2009-04-18T00:27:39.950
> 
> 标签：debugging, memory, gdb

例如，我知道 0x46767f0 属于一个 NSString*，有什么方法可以找出它是什么 NSString 来帮助我找到我想要的一些错误？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-04-18T00:33:10.357

我相信您正在寻找：

```
info symbol <addresss> 
```

打印存储在地址 addr 中的符号名称。如果没有符号完全存储在 addr，GDB 打印最近的符号和它的偏移量。

**例子：**

```
(gdb) info symbol 0x400225
_start + 5 in section .text of /tmp/a.out

(gdb) info symbol 0x2aaaac2811cf
__read_nocancel + 6 in section .text of /usr/lib64/libc.so.6 
```

[你可以在这里](https://sourceware.org/gdb/onlinedocs/gdb/Symbols.html)阅读更多关于它的信息。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2012-11-29T17:01:20.180

gdb> 列表 *0xAABBCCDD

这会告诉你文件名和行号。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-18T00:34:11.837

如果它是一个堆栈变量，我无法意识到这样做。否则，尝试`p/a <pointer symbol or address>`它会打印符号名称（或偏移到最近的符号名称）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-18T06:05:17.237

宝 0x46767f0

将向对象发送`-description`消息。这将打印出您的 NSString 的内容，但我建议在向随机地址发送随机消息之前使用 Brian 的答案来检查您的地址内容。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-03-30T16:14:17.270

**`addr2line`**

这个 Binutils 实用程序可以处理任何符号地址，包括变量和函数名。

默认情况下它是非交互式的，这在某些情况下很有用，在进行事后分析时。

主程序

```
#include <stdio.h>

int myvar;

int main(void) {
    printf("myvar = %d\n", myvar);
} 
```

编译和反汇编：

```
gcc -O 0 -g gdb3 -o main -pedantic-errors -std=c89 -Wextra main.c
readelf -s tmp.out  | grep -E ' (main|myvar)' 
```

给出：

```
55: 0000000000201014     4 OBJECT  GLOBAL DEFAULT   24 myvar
65: 000000000000064a    32 FUNC    GLOBAL DEFAULT   14 main 
```

现在我们可以尝试：

```
addr2line -e main 201014 64a 
```

这使：

```
/full/path/to/main.c:3
/full/path/to/main.c:5 
```

例如，Boost 堆栈跟踪库使用它来显示堆栈跟踪行：[print call stack in C or C++](https://stackoverflow.com/questions/3899870/print-call-stack-in-c-or-c/54365144#54365144)

# php - Cms 插件到多控制器 php 站点

> ID：762629
> 
> 赞同：0
> 
> 时间：2009-04-18T00:30:06.777
> 
> 标签：php, content-management-system

我有一个 php 站点设置，其中包含用于站点不同部分的多个控制器。
例如 index.php、gallery.php、faq.php 等。
目前我有一个从每个控制器调用的基本模板，该模板又包含页面的相关内容。我还使用 tinymce 来编辑这个内容文件。所以它真的是一个非常简单的cms。

编辑：澄清一下，我想为我的 cms 提供几个新功能。例如特定部分编辑、菜单编辑和其他一些。
但我认为与其继续开发并重新发明轮子，不如尝试找到一个可以插入我的多控制器系统的 cms，而不是强迫我在它的框架中开发我的应用程序。我想我希望它只管理内容，而不是我网站的任何其他后端内容。

希望这是可以理解的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T05:01:46.063

我也推荐[Drupal](http://drupal.org/)。它组织得很好，很容易适应几乎任何风格的网站。您可以将其用作纯 cms 或根据需要添加带有附加功能的插件 .. 核心包相当小，非常易于设置和使用，并且得到很好的支持 .. 值得一看

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T01:10:45.103

我不确定我是否正确理解了您的问题。您有一个带有基本 CMS 的站点，该站点使用模板系统和多个控制器。您不想要一个*框架*来移植您的网站，而是想要一个将“插入”到您当前网站的*CMS ？*您究竟想将什么插入您的网站？（即您在寻找什么特性/功能？）

编辑：如果您的目标是在不重新发明轮子的情况下构建更强大的 CMS，我仍然认为您应该考虑使用像 CakePHP 这样的 MVC 框架。建立在一个设计良好的框架上还可以让你在未来更容易扩展你的网站的功能（以及更容易维护一个复杂的 web 应用程序）。

我能想到的唯一其他选择是简单地用更强大的 CMS 替换现有的 CMS，例如 Drupal/Joomla/Wordpress，然后您可以使用模块进行扩展。但这可能会给您带来更少的灵活性，而不是更多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T04:28:54.487

让我看看我有没有这个权利。你想要一个CMS。但它必须符合你的任意做事方式，你可以加入并开始工作。您需要一个完全没有框架的 CMS。只做前端而不做后端的 CMS。

您根本不需要 CMS。就其本质而言，CMS 负责后端工作。这就是CMS的*意义所在。*您想要的是 Dreamweaver 式的魔术模板处理。

或者，也许您应该采用真正的 CMS 或框架，然后从那里开始工作。期望从 CMS 中获得这种神奇的精神力量是不合理的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T20:50:00.277

如果您编写了一个非常基本的 CMS 供自己使用，那么在我看来，采用现有的开箱即用的解决方案（如 Drupal、Joomla 等）应该没有问题。这些都是功能齐全的 CMS，可以随时使用并带有一些图形工作和一点点黑客攻击可以看起来像你想要的任何东西。

您的另一个选择是使用其他人建议的现有框架，例如 CakePHP、CodeIgniter 等。这些框架基本上为您提供了构建比现在更强大的自定义 CMS 所需的所有工具。

在我看来，您至少对自己在做什么有所了解。我建议您查看可用的不同框架并使用它运行。

[代码点火器](http://codeigniter.com/ "代码点火器")

[CakePHP](http://cakephp.org/ "CakePHP")

# unix - 查看 POSIX 系统上是否存在命令

> ID：762631
> 
> 赞同：24
> 
> 时间：2009-04-18T00:31:34.433
> 
> 标签：unix, shell, posix

我希望能够通过 shell 脚本判断任何 POSIX 系统上是否存在命令。

在 Linux 上，我可以执行以下操作：

```
if which <command>; then
   ...snip...
fi 
```

`which`但是，当命令不存在时，Solaris 和 MacOS不会给出退出失败代码，它们只是将错误消息打印到 STDOUT。

另外，我最近发现`which`命令本身不是 POSIX（参见[http://pubs.opengroup.org/onlinepubs/9699919799/idx/utilities.html](http://pubs.opengroup.org/onlinepubs/9699919799/idx/utilities.html)）

有任何想法吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-18T00:55:47.790

`command -v`是一个 POSIX 指定的命令，它执行什么操作。

定义为在找不到命令或发生错误时返回>0。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T00:34:43.740

您可以将“which”的 stdout/stderr 读入变量或数组（使用反引号），而不是检查退出代码。

如果系统没有“which”或“where”命令，您也可以获取 $PATH 变量的内容，然后遍历所有目录并搜索给定的可执行文件。本质上就是这样做的（尽管它可能会使用 $PATH 结果的一些缓存/优化）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-01-10T00:49:12.550

A`function_command_exists`用于检查命令是否存在：

```
#!/bin/sh

set -eu

function_command_exists() {
    local command="$1"
    local IFS=":" # paths are delimited with a colon in $PATH

    # iterate over dir paths having executables
    for search_dir in $PATH
    do
        # seek only in dir (excluding subdirs) for a file with an exact (case sensitive) name
        found_path="$(find "$search_dir" -maxdepth 1 -name "$command" -type f 2>/dev/null)"

        # (positive) if a path to a command was found and it was executable
        test -n "$found_path" && \
        test -x "$found_path" && \
            return 0
    done

    # (negative) if a path to an executable of a command was not found
    return 1
}

# example usage
echo "example 1";

command="ls"
if function_command_exists "$command"; then
    echo "Command: "\'$command\'" exists"
else
    echo "Command: "\'$command\'" does not exist"
fi

command="notpresent"
if function_command_exists "$command"; then
    echo "Command: "\'$command\'" exists"
else
    echo "Command: "\'$command\'" does not exist"
fi

echo "example 2";

command="ls"
function_command_exists "$command" && echo "Command: "\'$command\'" exists"

command="notpresent"
function_command_exists "$command" && echo "Command: "\'$command\'" does not exist"

echo "End of the script" 
```

输出：

```
example 1
Command: 'ls' exists
Command: 'notpresent' does not exist
example 2
Command: 'ls' exists
End of the script 
```

请注意，即使使用了脚本的`set -eu`that turn`-e`选项，脚本也被执行到最后一行“脚本结束”

因为运算符中没有`Command: 'notpresent' does not exist`，所以跳过了执行，但脚本的执行一直持续到最后。`example 2``&&``echo "Command: "\'$command\'" does not exist"`

请注意，`function_command_exists`不检查您是否有权执行该命令。这需要单独进行。

解决方案`command -v <command-to-check>`

```
#!/bin/sh
set -eu;

# check if a command exists (Yes)
command -v echo > /dev/null && status="$?" || status="$?"
if [ "${status}" = 127 ]; then
   echo "<handle not found 1>"
fi

# check if a command exists (No)
command -v command-that-does-not-exists > /dev/null && status="$?" || status="$?"
if [ "${status}" = 127 ]; then
   echo "<handle not found 2>"
fi 
```

产生：

```
<handle not found 2> 
```

因为`echo`在第一个例子中发现。

运行 a`command`和处理错误（包括找不到命令）的解决方案。

```
#!/bin/sh

set -eu;

# check if a command exists (No)
command -v command-that-does-not-exist > /dev/null && status="$?" || status="$?"
if [ "${status}" = 127 ]; then
   echo "<handle not found 2>"
fi

# run command and handle errors (no problem expected, echo exist)
echo "three" && status="$?" || status="$?"
if [ "${status}" = 127 ]; then
   echo "<handle not found 3>"

elif [ "${status}" -ne 0 ]; then
   echo "<handle other error 3>"
fi

# run command and handle errors (<handle not found 4> expected)
command-that-does-not-exist && status="$?" || status="$?"
if [ "${status}" = 127 ]; then
   echo "<handle not found 4>"

elif [ "${status}" -ne 0 ]; then
   echo "<handle other error 4>"
fi

# run command and handle errors (command exists but <handle other error 5> expected)
ls non-existing-path && status="$?" || status="$?"
if [ "${status}" = 127 ]; then
   echo "<handle not found 5>"

elif [ "${status}" -ne 0 ]; then
   echo "<handle other error 5>"
fi 
```

产生：

```
<handle not found 2>
three
./function_command_exists.sh: 34: ./function_command_exists.sh: command-that-does-not-exist: not found
<handle not found 4>
ls: cannot access 'non-existing-path': No such file or directory
<handle other error 5> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2022-01-14T19:05:49.310

一个实用程序在 Debian Linux 的 debianutils 包的[Git 存储库](https://salsa.debian.org/debian/debianutils/-/blob/master/which)`which`中作为 shell 脚本提供。该脚本似乎与 POSIX 兼容，如果您考虑版权和许可，您可以使用它。请注意，是否以及如何弃用该实用程序存在一些[争议；](https://lwn.net/Articles/874049/)（在撰写本文时）Git 中的[当前版本显示弃用消息，而](https://salsa.debian.org/debian/debianutils/-/blob/610a65c6ef040872a124576ddb504c2d4918e880/which)[早期版本](https://salsa.debian.org/debian/debianutils/-/blob/09b5efc8e9e0235f51b997714e6acef7d25bc517/which)添加了稍后删除的选项以启用静默操作。`which``-s`

`command -v`这样是有问题的，因为它可能会输出 shell 函数名称、别名定义、关键字、内置或不可执行的文件路径。另一方面`which`，如果您运行相应的参数或作为`command`. 作为使用`which`脚本的替代方法，使用的 POSIX shell 函数`command -v`可能类似于

```
#!/bin/sh
# Argument $1 should be the basename of the command to be searched for.
# Outputs the absolute path of the command with that name found first in
# a directory listed in PATH environment variable, if the name is not
# shadowed by a special built-in utility, a regular built-in utility not
# associated with a PATH search, or a shell reserved word; otherwise
# outputs nothing and returns 1\. If this function prints something for
# an argument, it is the path of the same executable as what 'command'
# would execute for the same argument.
executable() {
    if cmd=$(unset -f -- "$1"; unalias -a; command -v -- "$1") \
        && [ -z "${cmd##/*}" ] && [ -x "$cmd" ]; then
        printf '%s\n' "$cmd"
    else
        return 1
    fi
} 
```

免责声明：请注意，使用`command -v`上面的脚本找不到名称等于特殊内置实用程序名称、与 PATH 搜索无关的常规内置实用程序或 shell 保留字的可执行文件。如果 PATH 搜索中存在不可执行文件和可执行文件，它也可能找不到可执行文件。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2022-01-13T07:13:38.617

以下适用于`bash`and`zsh`并避免了函数和别名。

如果找不到二进制文件，则返回 1。

```
bin_path () {
        if [[ -n ${ZSH_VERSION:-} ]]; then
                builtin whence -cp "$1" 2> /dev/null
        else
                builtin type -P "$1"
        fi
} 
```

# active-directory - 大多数 LDAP 管理员是否手动创建 LDIF？

> ID：762663
> 
> 赞同：3
> 
> 时间：2009-04-18T00:44:33.060
> 
> 标签：active-directory, ldap, data-modeling, adam, ldif

是否有使工作更容易的工具？如果仅存在命令行工具，那么任何人都可以推测 GUI 工具是否有市场？例如，您可以通过可视化建模来创建关系数据库。LDAP 是否应该存在相同的概念？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T11:59:13.707

Apache Directory Studio 包括一个 ldif 编辑器。它仍然是一个文本编辑器，但具有语法突出显示、自动完成和 ldif 文件的组折叠功能：http: [//directory.apache.org/studio/](http://directory.apache.org/studio/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T01:01:57.713

我不知道是否有任何工具，但手工创建它们并不难。

如果您使用的是 IPlanet LDAP，那么他们有一个很好的界面来创建和修改模式。:)

我不知道您是否会认为这是手动操作，否则这是一种使用工具。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T12:06:55.750

我已经使用 Perl 和[Net::LDAP::LDIF](http://search.cpan.org/~gbarr/perl-ldap/lib/Net/LDAP/LDIF.pod)模块完成了一些 LDIF 处理，它使编写自定义 LDAP 转换的脚本变得非常容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T21:21:16.920

您是否查看过命令行工具[LDIFDE.exe](http://support.microsoft.com/kb/555636)？应该在您的域控制器上。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T21:38:14.603

业务人员给我 Excel 电子表格，其中用户和组数据的格式不一致，并希望它立即加载（然后他们返回一个新版本并告诉我他们只添加了一些新用户，但有些丢失了，一些数据现在无效，缺少列等。）他们希望分配唯一的密码，根据部门 ID 字段设置组成员资格，等等。

然后他们两周后回来，想知道那个电子表格和六个月前的电子表格之间的区别。叹。

我通常只用一些手工制作的 Python 脚本来完成这一切。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-19T01:37:45.187

很多时候，您可能会将对象从一棵树复制到另一棵树。或者支持他们。在这种情况下，大多数 LDAP 工具都有某种方式可以导出为 LDIF。然后，您可以根据需要轻松修改文件。

或复制示例以重复使用。

我见过很多工具，它们会做任务并将结果输出为 LDIF，可以很方便，但它们基本上都是点使用工具。

# java - 如何在 Apache Ivy 中使用 TestNG？

> ID：762673
> 
> 赞同：7
> 
> 时间：2009-04-18T00:52:30.763
> 
> 标签：java, ant, ivy, testng

我尝试将[TestNG](http://testng.org/)与[Apache Ivy](http://ant.apache.org/ivy/)一起使用，但没有成功。这是我的`ivy.xml`：

```
<ivy-module version="2.0">

    <info organisation="me" module="myproject"/>

    <dependencies>
      <dependency org="org.testng" name="testng" rev="5.8" />
    </dependencies>

</ivy-module> 
```

这实际上无法下载 TestNG jarfile。好像是因为TestNG有jdk14和jdk15的jarfile。这是来自的输出`ivy:retrieve`：

```
[ivy:retrieve] :: resolving dependencies :: me#myproject;working@jared-mbp17
[ivy:retrieve]  confs: [default]
[ivy:retrieve]  found org.testng#testng;5.8 in public
[ivy:retrieve] :: resolution report :: resolve 1139ms :: artifacts dl 11ms
    ---------------------------------------------------------------------
    |                  |            modules            ||   artifacts   |
    |       conf       | number| search|dwnlded|evicted|| number|dwnlded|
    ---------------------------------------------------------------------
    |      default     |   1   |   1   |   1   |   0   ||   1   |   0   |
    ---------------------------------------------------------------------
[ivy:retrieve] 
[ivy:retrieve] :: problems summary ::
[ivy:retrieve] :::: WARNINGS
[ivy:retrieve]      [FAILED     ] org.testng#testng;5.8!testng.jar:  (0ms)
[ivy:retrieve]  ==== shared: tried
[ivy:retrieve]    /Users/jared/.ivy2/shared/org.testng/testng/5.8/jars/testng.jar
[ivy:retrieve]  ==== public: tried
[ivy:retrieve]    http://repo1.maven.org/maven2/org/testng/testng/5.8/testng-5.8.jar
[ivy:retrieve]      ::::::::::::::::::::::::::::::::::::::::::::::
[ivy:retrieve]      ::              FAILED DOWNLOADS            ::
[ivy:retrieve]      :: ^ see resolution messages for details  ^ ::
[ivy:retrieve]      ::::::::::::::::::::::::::::::::::::::::::::::
[ivy:retrieve]      :: org.testng#testng;5.8!testng.jar
[ivy:retrieve]      ::::::::::::::::::::::::::::::::::::::::::::::
[ivy:retrieve] 
[ivy:retrieve] :: USE VERBOSE OR DEBUG MESSAGE LEVEL FOR MORE DETAILS 
```

在存储库中，您可以看到两个不同的 jarfile： [http ://repo1.maven.org/maven2/org/testng/testng/5.8/testng-5.8-jdk14.jar](http://repo1.maven.org/maven2/org/testng/testng/5.8/testng-5.8-jdk14.jar) [http://repo1.maven.org/maven2/org /testng/testng/5.8/testng-5.8-jdk15.jar](http://repo1.maven.org/maven2/org/testng/testng/5.8/testng-5.8-jdk15.jar)

如何指定`jdk14`or `jdk15`？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-18T00:52:42.103

您需要指定所需工件的分类器。

[从 2.1.0-RC1 开始](http://issues.apache.org/jira/browse/IVY-1041)有一个相关的修复。您可以使用元素`artifact`内的`dependency`元素来指定`classifier`您想要的。在这种情况下，分类器应该是`jdk14`or `jdk15`。如果你想`jdk15`你`ivy.xml`会是：

```
<ivy-module version="2.0"
            xmlns:e="http://ant.apache.org/ivy/extra">

    <info organisation="me" module="myproject"/>

    <dependencies>
      <dependency org="org.testng" name="testng" rev="5.8"
                  transitive="false">
        <artifact name="testng" type="jar" ext="jar" e:classifier="jdk15" />
      </dependency>
    </dependencies>

</ivy-module> 
```

请注意将 XML 命名空间`"http://ant.apache.org/ivy/extra"`指定为`ivy-module`元素的属性。没有那个是`e:classifier`行不通的。

# c# - 在 C# 中使用 Moq 对克隆方法进行单元测试

> ID：762677
> 
> 赞同：2
> 
> 时间：2009-04-18T00:52:48.377
> 
> 标签：c#, moq, clone

我有一些带有克隆方法的基本类：

```
public class SimpleClass
{
    public int ValueA { get; set; }

    public string ValueB { get; set; }

    public ulong ValueC { get; set; }

    public SimpleClass TypedClone()
    {
        var item = new SimpleClass
        {
            ValueA = this.ValueA,
            ValueB = this.ValueB,
            ValueC = this.ValueC 
        };

        return item;
    }
} 
```

我想要一个单元测试，它会告诉我是否添加了 ValueD，但忘记将其添加到 Clone 方法中。我的第一次尝试是使用 Moq 及其 VerifyGet 方法来确保访问每个属性。

```
 public void GenericCloneTest()
    {
        var mock = new Mock<SimpleClass>();
        var c = mock.Object.GenericClone();
        var properties = typeof(SimpleClass).GetProperties();

        foreach (var property in properties)
        {
            var expression = Expression.Property(
                Expression.Parameter(typeof(SimpleClass), "c"), 
                property);

            var type = Expression.GetFuncType(typeof (SimpleClass),  
                property.PropertyType);

            var actionExpression = Expression.Lambda(type, expression,
                Expression.Parameter(typeof(SimpleClass), "c"));

            mock.VerifyGet<object>
                ((Expression<Func<SimpleClass,object>>)actionExpression);
        }
    } 
```

这不起作用，因为 VerifyGet 方法需要知道 Property 访问器的返回类型，而且我想不出任何在运行时插入它的方法（你会注意到我尝试使用崩溃的“对象”的蹩脚尝试）烧毁）。

我什至不确定使用起订量是个好主意，这只是我的第一个。

更新：由于没有快速简便的通用方法来测试克隆方法，我决定为每个类编写特定于类型的测试。这仍然给我留下了知道何时添加属性的问题。我决定将其附加到我的克隆单元测试中：

```
 var signature = typeof (Connection)
            .GetProperties()
            .Select(p => p.Name)
            .Aggregate(
                new StringBuilder(), 
                (builder, name) =>
                    builder.Append(name)).ToString();

      Assert.AreEqual(
           "DataSessionStateDataTechnologyBytesReceivedBytesSentDuration",
           signature); 
```

如果我添加一个属性，测试将失败。当签名匹配失败时，它仍然取决于我是否有足够的责任来修复测试的其余部分。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T01:35:04.063

确保获得所有字段的最简单方法之一是简单地使用 MemberwiseClone() 方法。这将自动将您的所有类字段复制到新实例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T02:16:31.777

你真的不想在这里使用 Moq，你只需要使用一些反射。基本上编写一个创建对象实例的测试，设置每个属性，克隆它，然后确保每个属性在克隆上相等。

就像保罗说的那样，请查看基本上为您执行此操作的 MemberwiseClone()，或者至少实现 ICloneable，这是如何执行此操作的标准做法。（MemberwiseClone() 只做一个浅拷贝，这就是你可能需要实现 ICloneable 的原因）。然后，您甚至可以编写一个测试，通过您的程序集查找实现 ICloneable 的所有内容并对其进行测试。

# ruby - 使用 Ruby 的 Test::Unit for Selenium 进行数据驱动测试

> ID：762678
> 
> 赞同：1
> 
> 时间：2009-04-18T00:52:57.143
> 
> 标签：ruby, unit-testing, selenium, rake, testunit

我对 Ruby 和 Selenium 都很陌生，我只是想找出构建测试工具的最佳方法。我正在使用 Rake、Rake::TestTask 和 Test::Unit 来驱动它。我有一个套件，我想为每个浏览器/操作系统组合运行一次。我不知道如何参数化我的测试，我已经习惯了 Junit4 和 TestNG。

```
require 'rake'
require 'rake/testtask'

browsers = ['IE on Windows', 'Firefox on Windows', 'Firefox on Mac', 'Safari on Mac']

task :default => [:run_tasks]

task :create_tasks do
  browsers.each do |browser|    
    Rake::TestTask.new("selenium_units:#{browser}") do |t|
      t.libs << "lib"
      t.pattern = 'test/*_test.rb'
      t.verbose = true
      t.warning = true
      t.opts = "BROWSER=\"#{browser}\""
    end
  end  
end

task :run_tasks => [:create_tasks]
task :run_tasks => browsers.map { |e| "selenium_units:"+ e } 
```

我真的很希望能够在我的套件或案例的设置中阅读 BROWSER=。有什么建议或者在 Ruby 中是否有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T02:41:08.973

经过大量挖掘源代码后，我发现了一个没有记录的功能。Test::Unit 测试运行器除了在命令行上执行您的测试用例，依靠自动运行器运行该类特定类的任何用例用例之外不做任何事情。因此，当他们在 -- 之后所说的任何内容将作为选项传递时，它们的意思是命令行选项，而不是某些变量或参数。

所以...添加

```
t.options = '-- -foo -bar=baz' 
```

实际上会将它们传递到您的 ARGV 中，并且您需要手动处理它们。将这些参数放入工厂类中以获取适当的 Selenium 实例对我有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T03:02:00.717

这可能不是你要问的。但我已经在 Python 中解决了完全相同的问题，并在 [Parameterizing Your Tests](http://tobyho.com/Parameterizing_Your_Tests)中写了一篇博客。我相信您可以在 Ruby 中使用相同的方法，但不确定它与您所做的相比如何。我很想知道其他人是如何解决这个问题的，但没有找到太多的文档。

# javascript - 在 Firefox 中触发“无法在此上下文中创建对象，代码：9”的原因是什么？

> ID：762679
> 
> 赞同：0
> 
> 时间：2009-04-18T00:53:28.623
> 
> 标签：javascript, firefox

我们偶尔会在 Firefox 上的网络应用程序中看到这一点。是什么触发了它，我们如何预防它？它似乎偶尔发生，并且错误消息不会产生有关线路位置的有用信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T00:58:02.060

一个[快速的谷歌搜索](http://www.google.com/search?q=object+cannot+be+created+in+this+context&ie=utf-8&oe=utf-8&aq=t&rlz=1R1GGGL_en-GB___US319&client=firefox-a)产生了这个：

[http://blowery.org/2008/02/28/object-cannot-be-created-in-this-context-code-9/](http://blowery.org/2008/02/28/object-cannot-be-created-in-this-context-code-9/)

> ...检查您的代码以查看您是否尝试在空引用上获取对计算样式的引用。

它似乎与 Dojo 框架有关。

* * *

**编辑**：哈。对不起，我给了你自己的博客作为答案。我想我不完全明白你在问什么。如果您想避免该错误，您可以在运行适用的代码之前使用对象检查。

```
function isValidObject(someObject)
{
    return typeof someObject != null;
}

var obj1 = "Hello World";

if(isValidObject(obj1))
{
    //This code will run
}

if(isValidObject(ob2))
{
    //This code will not run
} 
```

希望这会有所帮助。

# continuous-integration - TeamCity 用户：几个问题

> ID：762692
> 
> 赞同：1
> 
> 时间：2009-04-18T01:04:08.240
> 
> 标签：continuous-integration, teamcity, lint, pulse

这些问题仅适用于 TeamCity 用户

1）是否可以配置 TeamCity 以根据您自己的正则表达式提取构建工件信息？这正是 Pulse 在[这里所做的](http://zutubi.com/products/pulse/features/list/#process)

2) TeamCity 是否与任何任务/错误跟踪工具集成？像JIRA？

3）这个问题只适用于运行静态代码分析器的人。像 PC-Lint/Visual Lint 这样的工具可以生成 XML 报告。TeamCity 是否可以配置为解析这些工件并生成构建失败？

4) 我目前正在评估 TeamCity……那里的社区论坛似乎不太活跃。对于那些支付支持费用的人，Jetbrains 如何提供支持？好吗？Atlassian 似乎要好得多。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-23T09:03:13.307

1.  TeamCity 允许使用基于 Ant 的模式获取构建工件。您可以指定多个模式并为每个模式设置目标目录。[在http://www.jetbrains.net/confluence/display/TCD4/Build+Artifact](http://www.jetbrains.net/confluence/display/TCD4/Build+Artifact)了解更多信息

2.  有一个集成允许将 RF-3432 链接到 Jira 问题。更高级的集成可能会出现在 TC 的下一个版本中。[在http://www.jetbrains.net/confluence/display/TCD4/Mapping+External+Links+in+Comments](http://www.jetbrains.net/confluence/display/TCD4/Mapping+External+Links+in+Comments)了解更多信息

3.  仅使用自定义插件。或者您的构建过程可以发送特定的“回声”消息，该消息将更改构建状态和描述。

4.  好的，我是 JetBrainer。可能我们不会立即回复，但我们会努力尽快回答论坛问题。付费客户也有电子邮件支持。

希望这会有所帮助，KIR

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-19T04:07:22.673

*免责声明：*我不为 JetBrains 工作！但在我目前的工作中，我曾与 Pulse 和 TeamCity 合作过。

**构建工件**：是的，TeamCity 将导出构建后保留的工件。您可以添加定义 ant 样式的通配符模式来匹配文件（默认模式匹配根构建目录中留下的任何文件）。这些文件可以从针对每个单独构建的项目视图中看到。

您也可以在构建脚本中使用特殊的[服务命令](http://www.jetbrains.net/confluence/display/TCD4/Build+Script+Interaction+with+TeamCity#BuildScriptInteractionwithTeamCity-artPublishing)来立即导​​出工件，我这样做是为了生成 xml 文件的代码复杂性工具，我还为此定义了一个自定义图。

**错误跟踪**：我没有这方面的经验，但[KIR](https://stackoverflow.com/questions/762692/teamcity-users-a-few-questions/901183#901183)指出了一些替代方案。

**XML Parsing** : 你可以用 ant 来控制它。[我在我的构建中包含了一个名为andariel](http://andariel.uworks.net)的第三方工具，它可以跨 xml 文档运行 XPath，然后使用服务消息导出结果（在本例中是超过复杂性限制的方法计数）以显示在自定义图形中。

我相信您还可以发布工件，为 TeamCity 提供 XSL 来呈现 XML，并在构建结果中创建一个附加选项卡来显示它（但是我没有这样做）

**技术支持**：我发现社区论坛非常好，平民和 Jetbrains 员工都在一两天内回答了大多数问题，而且我使用的是免费的“专业”版本。我只能想象电子邮件支持即使不是更好也一样好！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T01:25:02.447

我对这个问题有点困惑，因为我使用 TeamCity、TC（我猜是 TC 的设计原则）是为了让构建脚本（而不是 TC）保持与构建命令相对应的状态。

换句话说，如果您需要 TeamCity 做一些很酷的事情，只需在构建脚本中添加这些很酷的东西，或者使用构建系统中的现有任务，或者自己编写一个。

TeamCity 支持 NAnt、MSBuild、Ant，并且可以肯定，您可以在 buildagent 上安装任何其他构建平台。

我希望 TC 或任何其他 CI 平台拥有的唯一集成是源代码控制与我选择的 SC 的集成。其余的集成应该由我的构建脚本控制。这样，我只在每个项目的项目开始时配置我的 TC 一次，然后再也不碰它。相反，构建可以根据版本进行更改。

因此，理论上，通过构建脚本，您的问题的间接答案是肯定的。

希望这可以帮助。

# c# - 自动尺寸 Silverlight 应用程序

> ID：762704
> 
> 赞同：0
> 
> 时间：2009-04-18T01:23:07.757
> 
> 标签：c#, silverlight-2.0

我想让我的 silverlight 应用程序通过更改主机 div 的高度来自动调整其大小以适应应用程序中的内容。您将如何获得整个应用程序的大小？

例如，我有一个三行网格，顶行和底行有按钮，中间行有一个 DataGrid，它可以根据用户选择的页面大小改变高度。我希望应用程序将主机 div 的高度调整为显示整个应用程序的高度。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T23:26:15.367

你在这里有两个选择。

1.  您可以通过 HtmlPage 属性直接操作 DOM（我建议为托管 div 提供一个唯一 ID 以帮助您找到它）
2.  编写一个基于某些参数调整大小的 javascript 函数，例如函数 resizeSLHost(width, height)。然后，您可以从 silverlight 调用 javascript 函数并将实际高度和宽度传递给它。

# assembly - 我的 MIPS 程序是否正确？

> ID：762708
> 
> 赞同：5
> 
> 时间：2009-04-18T01:27:29.790
> 
> 标签：assembly, mips

编写一个 MIPS 程序，生成从 1 到 100 的所有偶数并将其相加。

*   它必须至少有一个循环
*   它应该将总和存储在寄存器 R12 中

* * *

这就是我写的：

```
main:
    li      $t0, 0               # clear register $t0 to zero
    li      $t4, 0               # clear register $t4 to zero
loop:
    add     $t0, $t0, 2          # generating even numbers in register $t0
    add     $t4, $t4, $t0        #  compute the sume
    bne     $t0, 100, loop       # if t0 reached 100 then go to loop.
    b endloop                    # branch to endloop
endloop:
    li      $v0, 10              # terminate program run and
    syscall                      # Exit 
```

这个对吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-18T02:11:54.630

我刚刚完成了我的 MIP 汇编课程，我有一个建议给你：**不要使用 PC Spim！**

我使用过 PC Spim、Mars 和 Qemu，最适合一般课程作业的是[Mars (Mips Assembler and Runtime Simulator)](http://courses.missouristate.edu/KenVollmar/MARS/)。编辑器很好，它的崩溃少*了很多*，它允许您轻松调试和设置断点。它是免费的、开源的，由密苏里州立大学创建。

它以 .jar 文件的形式提供，因此您可以在 Windows 和 Linux 上运行它。 ![替代文字](https://imgur.com/NQ31O.jpg)
[[火星米普斯模拟器](http://courses.missouristate.edu/KenVollmar/MARS/v3_2_screenshot.jpg)]

在一般情况下，判断一个数字是偶数还是奇数的一种简单方法是将数字与（按位）1 与数字相加，如果结果为 0，则数字为偶数。

但是，由于我们想要一个系列中的所有偶数，我们可以像您在发布的代码中所做的那样循环并将我们的数字增加 2。

添加立即数时，您应该使用“addi”或“addu”指令，而不是“add”。您还说您想将结果放入寄存器 $r12 但这不是有效的 MIP 寄存器。查看 MIP 维基百科链接以查看所有寄存器的列表：[MIPS - 寄存器使用。](http://en.wikipedia.org/wiki/MIPS_architecture#Compiler_Register_Usage)

我已修改您的程序以使其正常工作。它将最终结果存储在 $t1 中，然后打印最终结果。

```
 .text
                .globl main
main:
    li      $t0, 0               # $t0 = loop counter
    li      $t1, 0               # $t1 = sum of even numbers
loop:
    addi    $t0, $t0, 2          # generating even numbers in register $t0
    add     $t1, $t1, $t0        #  compute the sum
    bne     $t0, 100, loop       # if t0 reached 100 then go to loop.

    li      $v0, 4
    la      $a0, result
    syscall                      # print out "Sum = "

    li      $v0, 1
    move    $a0, $t1
    syscall                      # print out actual sum

exit:
    li      $v0, 10              # terminate program run and
    syscall                      # Exit 

                .data
result:         .asciiz "Sum = " 
```

在火星上运行它后，我得到以下信息：

> Sum = 2550
> -- 程序运行完毕 --

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T01:53:04.020

您应该能够自己使用 SPIM。“b endloop”这一行也是不必要的，因为如果你不分支回到循环的顶部，程序将“落入”endloop。

在此处下载 SPIM：http:
[//pages.cs.wisc.edu/~larus/spim.html](http://pages.cs.wisc.edu/~larus/spim.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T02:16:54.883

代码看起来不错。正如 cunwold 所说，“b endloop”是不必要的，因为分支目标是第一个分支（bne ...）失败。不过有一个错误。

您以两种不同的方式使用相同的指令（添加）。该指令

```
add $t0,$t0,2 
```

应该

```
addiu $t0,$t0,2 
```

由于您要添加一个中间寄存器，而不是两个寄存器。

所以，就这样吧。我将系统调用部分替换为对函数的实际返回（在 $v0 寄存器中返回值）。

希望能帮助到你。

文件 main.c

```
#include <stdio.h>

extern int addEven();

int main(){

        printf("%d\n",addEven());
        return 0;
} 
```

文件 addEven.S（程序集）

```
#include <mips/regdef.h>

  /*
   * int addEven();
   * Adds even numbers between 0 and 100.
   * 0 + 2 + 4 + 6 +....+100 = 2550
   */

        .text
        .align 2
        .globl addEven

addEven:
        li      t0,0            # clear register $t0 to zero
        li      t4,0            # clear register $t4 to zero
loop:
        addiu   t0, t0,2          # generating even numbers in register $t0
        add     t4, t4,t0          #  compute the sume (R12 = t4)
        bne     t0, 100, loop      # if t0 reached 100 then go to loop.
endloop:
        move    v0,t4
        jr      ra 
```

我编译并链接了这些文件。就这样吧。

```
root@:~/stackoverflow# gcc -c -g addEven.S
root@:~/stackoverflow# gcc -c -g main.c
root@:~/stackoverflow# gcc main.o addEven.o -o prog 
root@:~/stackoverflow# ./prog 
2550
root@:~/stackoverflow# 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T01:40:14.347

试试[这个](http://pages.cs.wisc.edu/~larus/spim.html)模拟器。当我学习计算机组织时，我使用了 SPIM，它相当容易使用。您还可以在线找到有关 MIPS 的教程。请记住，Google 是您的朋友。

# jquery - 扩展的自动建议功能

> ID：762720
> 
> 赞同：2
> 
> 时间：2009-04-18T01:41:51.613
> 
> 标签：jquery, autocomplete

我已经能够毫无问题地让 jQuery autosuggest 正常工作，我只是想知道结果是否可以基于 2 个表单字段的组合？

让我试着解释得更好一点！我有一个带有关键字文本输入框的表单和一个带有国家列表的选择列表。

我想为所选的关键字搜索词提供建议，但也将这些建议限制在从下拉列表中选择的国家/地区（如果更改）……这可能吗？

我希望我已经解释了我的问题好吗！对此的任何建议将不胜感激！

干杯！德克兰

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T02:18:36.843

您可以将下拉列表的值与用户在文本框中键入的内容结合起来，并将其作为一个字符串提交给您的 PHP/ASP 服务器端代码。例如，像这样：

```
$("#textbox").change(fetchKeywords);

function fetchKeywords()
{
    var string=$("#textbox").val() + "||" + $("#select").val();
    $.post("auto-suggest.php",{keyword:string});
} 
```

这会给你一个字符串，比如`"My keyword||USA"`. 然后，您可以使用`explode()`（如果使用 PHP）或`String.split()`函数使用`||`分隔符拆分关键字和国家/地区代码。

注意：我没有使用过这个特定的 jquery 插件，所以你必须稍微改变一下`fetchKeywords()`函数才能让它与那个插件一起工作。

# java - 包装罐子的 OSGi 服务

> ID：762721
> 
> 赞同：0
> 
> 时间：2009-04-18T01:43:05.913
> 
> 标签：java, osgi

我正在尝试创建一个包装另一个 jar 的 OSGi 服务。我将 jar 添加到项目、类路径和二进制构建中。我在 Activator 中注册了该服务，但是当消费包调用该服务时，我在包装 jar 上得到一个 java.lang.NoClassDefFoundError 。有谁知道我在这里做错了什么？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T14:02:49.787

您是否正在导出消费者所需的包，以及实施所需的所有包。消费者将需要导入将被引用的所有内容。

附带说明一下，以这种方式创建包在 Eclipse 中不能很好地用于开发（在运行时可以正常工作）。如果您尝试从另一个 OSGi 项目引用 jar 中的类或接口，IDE 将不会解析任何内容，因为它无法“看到”jar 中的文件。必须在包中扩展 jar 才能使所有内容都可见（在 IDE 中）。Eclipse 基于导入和导出自动创建适当的类路径引用以用于构建目的。如果包中没有 jar 文件，您将不得不显式维护这个类路径。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T10:21:52.190

您的行为可能有多种原因。为了确保，我会检查以下内容：

*   假设您使用 Eclipse 检查您是否已将 jar 包含在清单编辑器的“构建”选项卡中，并在“类路径”下的“运行时”选项卡中指向这个 jar。

*   创建的包：它是否包含 jar？它是否具有指向 jar 的“Bundle-ClassPath”标头，例如：“Bundle-ClassPath: lib/myLibrary.jar,”。（最后一个 . 需要包含来自捆绑包根目录的类 - 您的激活器 fi）

*   确保 jar 实际上包含所有必需的依赖项，或者通过包装包中的 Import-Package 标头表达它们。为此，Eclipse 有一个“导入向导”。顺便说一下，前面提到的 bnd 工具也是如此。希望有帮助...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T02:51:55.327

您是否在清单中使用了 Bundle-Classpath？为什么不对现有的 jar使用[bnd ？](http://www.aqute.biz/Code/Bnd)

# c# - 从最终构建器运行 Web 部署项目的构建操作

> ID：762723
> 
> 赞同：1
> 
> 时间：2009-04-18T01:44:09.063
> 
> 标签：c#, asp.net, finalbuilder, web-deployment-project

如您所知，Final builder 是一个出色的构建自动化程序，我想使用它来自动移动 aspx、ascx、图像文件、css、dll 等......在构建 Web 部署之后，这将大大减轻为我工作，而不是手动复制文件。

更好的是，如何在 Visual Studio 中创建快捷方式，这样当我单击它时，它将运行最终的构建构建过程。

我认为有了这种组合，生活会容易得多，而且我不必来回走动。

那我该怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-10T00:01:47.107

如果您有一个从构建服务器到实时服务器的映射驱动器，那么您可以在 Final Builder 中执行 XCOPY 命令来复制文件。

# command-line - 可用性的 CLI 模式/反模式

> ID：762724
> 
> 赞同：4
> 
> 时间：2009-04-18T01:45:00.543
> 
> 标签：command-line, usability

**哪些模式有助于或降低 CLI 界面的可用性？**

以 ClearCase 的 CLI 为例。CLI 非常全面（+1），但它有几个明显的机会。[最近，我想使用clearfsimport](http://publib.boulder.ibm.com/infocenter/cchelp/v7r0m0/index.jsp?topic=/com.ibm.rational.clearcase.cc_ref.doc/topics/clearfsimport.htm)强制文件小写为 ClearCase 。不幸的是，我结束了它的表亲[clearimport](http://www.scmlife.com/cf/200306/clearimport.html)的文档。这可能看起来很轻微，但它花费的时间比我愿意承认的要多。中间的变化吸引了我。

为什么要用几乎相同的名称提供几乎相同的功能？我认为有很多更好的选择

*   `clearimport -fs`
*   `fsclearimport`
*   `clear_fs_import`
*   `clearimport_fs`

任何事情都会比他们选择的更好。我正在编写的代码**是**一个 CLI，这种经历让我审视了自己的选择。我想我已经涵盖了所有基础知识（标准帮助、长格式与短格式、有意义的短名称、提供示例、消除歧义、准确处理引号内的空格等）。

有一些关于这个主题的[文献。](http://catb.org/esr/writings/taoup/html/ch11s06.html)

[也许一个糟糕的 CLI 与一个糟糕的 API](https://stackoverflow.com/questions/186964/java-core-api-anti-patterns-what-is-wrong)没有什么不同。CLI 在某种意义上是一种 API。目标自然是共同的：灵活性、可读性和完整性。有几个因素将 CLI 与典型的 API 区分开来。一个是 CLI 需要支持可编写脚本（可能多次参与一系列管道）。另一个是自动完成和命名空间的存在方式不同。你并不总是有一个漂亮的彩色 GUI 为你做事。CLI 必须在外部直接向客户记录自己。最后，CLI 的受众与标准 API 大不相同。我很欣赏你可能有的任何见解。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-18T01:51:43.070

我喜欢子命令模式，这是我最熟悉的，因为它在命令行 Subversion 客户端中实现。

```
svn [subcommand] [options] [files] 
```

如果没有子命令，subversion 会有太多不同的选项让我无法有效地记住它们，而且帮助系统会很痛苦。

但是，如果我不记得任何特定的子命令是如何工作的，我可以输入：

```
svn help [subcommand] 
```

...它只向我显示了帮助文档的相关部分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-01T15:17:30.203

如上所述，这种格式：

```
 [master verb] [subverb] [optionally, noun] [options] 
```

可以很好地记住可用的命令。cvs、svn、Perforce、git，都坚持这一点。它提高了命令的可发现性，这是一个主要的 CLI 问题。这里出现的一个问题是主动词选项与子动词选项。IE，

```
cvs -d dir command bar 
```

不同于

```
cvs command -d dir bar 
```

这在 cvs 中是一个令人困惑的情况，它`svn`通过允许以任何顺序指定的选项来“修复”。您自己的解决方案可能会有所不同；如果您有充分的理由将选项传递给主动词，好吧，请注意开销。

查看 API 可用性也是一个好主意，但要注意 CLI 命令中没有真正的输入，而且 CLI 命令“返回”的内容非常丰富，因为您既有返回码，也有输出到一起工作。在 unixy/streams 世界中，输出通常比返回码重要得多。获得正确的输出格式至关重要。此外，虽然很诱人，但我发现向 stdout 和 stderr 发送不同的东西并不总是有用的。它使新手甚至中级用户感到困惑（因为在大多数情况下，他们都被转储到控制台），并且很少有有用的高级用户。所以除非真的需要它，否则我会避免它；（例如）某人很容易对为什么命令的输出是 '' 感到非常困惑

设计中的另一个问题是“下一步是什么”问题。在 GUI 中，用户接下来的步骤由可用的按钮、菜单等说明。在 CLI 中，用户可以逐字地键入接下来的任何命令，并将任何命令传递给任何其他命令。（或者至少尝试一下。）我设计我的命令以提供提示（在帮助或输出中）关于典型工作流程中可能的后续步骤。

另一个好的模式是允许用户自定义输出。虽然用户可以使用`cut`,`sort`等来定制输出，但能够指定格式字符串会放大命令的实用性。我在这里引用的示例是`top`，它可以让您告诉它您想要哪些列。

# java - 服务器设计与实现

> ID：762736
> 
> 赞同：3
> 
> 时间：2009-04-18T01:57:08.953
> 
> 标签：java, c++

迄今为止，我一直从事嵌入式系统和硬件接口的系统编程工作。为了乐趣和个人知识，最近在接触 Erlang 之后，我一直在尝试学习更多关于服务器编程的知识。我一直在回过头来从 C++/Java 的角度考虑服务器，现在我想知道如何使用 C++ 或 Java 等技术构建可扩展系统。

我已经读过，由于上下文切换和内存有限，每个客户端线程处理程序是不现实的。通常会创建一个线程池，并混合使用工作线程和异步 I/O 来处理请求。我想知道，首先，如何确定线程池大小？是否只需要测量并找到最佳平衡？最终随着系统的扩展，可能需要不止一台服务器来处理请求。如何跨处理大型客户群的多个服务器管理请求？

我只是在寻找可以阅读更多内容并找到问题答案的方向。我会研究计算机科学的哪个领域以获取该领域的更多信息？这个计算领域是否有任何设计模式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T02:06:54.843

你的问题太笼统了，没有很好的答案。答案在很大程度上取决于上下文、任何一个线程的处理量、请求到达的速度、正在使用的 CPU 系列、正在使用的 Web 容器以及许多其他因素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T02:17:19.763

[C++ Network Programming: Mastering Complexity Using ACE and Patterns](http://www.cs.wustl.edu/~schmidt/ACE/book1/)和 [C++ Network Programming: Systematic Reuse with ACE and Frameworks](http://www.cs.wustl.edu/~schmidt/ACE/book2/)是很好的书籍，描述了许多设计模式及其与高度可移植的[ACE](http://www.cs.wustl.edu/~schmidt/ACE.html)库的使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T03:20:36.757

与 Lothar 一样，我们使用[ACE](http://www.cs.wustl.edu/~schmidt/ACE.html)库，其中包含反应器和前摄器模式，用于使用 C++ 代码处理异步事件和异步 I/O。我们使用相当大的工作线程池，这些线程池会根据需要增长（达到可配置的最大值）并随着时间的推移而缩小。

C++ 的技巧之一是如何跨网络边界传播异常和错误情况（语言不处理）。我知道.NET 有一些方法可以跨越这些网络边界引发异常。

您可能会考虑的一件事是研究 SOA（面向服务的体系结构）来处理更高级别的分布式系统问题。ACE 如果真的在机器的裸机上运行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T04:00:33.417

对于 C++，我使用了 boost::asio，它是非常现代的 C++，使用起来非常愉快。C++0x 网络库也将基于 ASIO 的实现，所以它是很有价值的知识。

正如您已经了解到的那样，每个客户端设计 1 个线程是行不通的。对于高性能多线程，最好的线程数似乎是 CoresX2，但对于服务器，每个请求有很多 IO，这意味着大量的空闲等待。从经验来看，查看 Apache、MySQL 和 Oracle 的线程数量大约是用于数据库服务器的 CoresX10 和用于 Web 服务器的 CoresX40，并不是说这些是理想的，但它们似乎是成功系统的模式，所以如果你的系统可以平衡以使用相似的数字以最佳方式工作，至少您会知道您的设计并非完全糟糕。

# c# - C# GUI 处理关闭时的问题

> ID：762742
> 
> 赞同：0
> 
> 时间：2009-04-18T02:12:03.583
> 
> 标签：c#, multithreading, user-interface

当我在搜索完成之前关闭我的应用程序时，我收到 System.InvalidOperationException 错误。当我关闭 Form1_FormClosing 时，我告诉所有线程中止。在一个线程中，它调用了一个委托函数，该函数告诉表单中的一个控件更改其文本。发生这种情况时，我会得到上面的异常以及“附加信息：在创建窗口句柄之前不能在控件上调用 Invoke 或 BeginInvoke”。

我能做些什么来纠正这个问题？我可以添加一个 isClosing 标志并在更新文本之前对其进行检查，但这感觉像是一种黑客行为并掩盖了问题。我该如何正确解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T02:34:55.900

发生这种情况是因为托管控件正在被释放并且不再具有其句柄，但您尚未关闭窗口，因此您仍然可以看到它。

您可以创建一个函数来包装调用并在调用之前进行`Invoke`检查。如果是假的，你不能打电话，你可以忽略这个电话。`IsHandleCreated``Invoke``IsHandleCreated``Invoke`

```
public static class ControlExtensions
{
  public static TResult InvokeEx<TControl, TResult>(this TControl control,
                                          Func<TControl, TResult> func)
    where TControl : Control
  {
    if (!control.IsHandleCreated)
      return default(T);

    if (control.InvokeRequired)
      return (TResult)control.Invoke(func, control);
    else
      return func(control);
  }

  public static void InvokeEx<TControl>(this TControl control,
                                        Action<TControl> action)
    where TControl : Control
  {
    control.InvokeEx(c => { action(c); return c; });
  }
} 
```

因此，现在只需将`Invoke`线程中的任何 s 包装起来`InvokeEx`，它就会在控件已被释放且不再具有句柄时进行处理。

```
this.InvokeEx(c => c.label1.Text = "Hello world"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T02:42:43.510

我同意塞缪尔的观点，但也会检查`IsDisposed`：

```
void Handler()
{
  if (ctrl.IsDisposed || !ctrl.IsHandleCreated) return;
  if (ctrl.InvokeRequired) 
    Invoke(...);
  else {
    ...
  }
} 
```

# python - 使用带有 mysql unix 时间戳的 sqlalchemy 定义表

> ID：762750
> 
> 赞同：4
> 
> 时间：2009-04-18T02:22:58.800
> 
> 标签：python, mysql, sqlalchemy

背景，有几种方法可以在 MySQ 中存储日期。

1.  作为字符串，例如“09/09/2009”。
2.  作为使用函数 UNIX_TIMESTAMP() 的整数，这应该是传统的 unix 时间表示（您知道自纪元以来的秒数加/减闰秒）。
3.  作为 MySQL TIMESTAMP，mysql 特定的数据类型与 unix 时间戳不同。
4.  作为 MySQL 日期字段，另一种 mysql 特定数据类型。

    不要将案例 2 与案例 3（或案例 4）混淆，这一点非常重要。我有一个带有整数日期字段的现有表（案例 2）我如何在 sqlalchemy 中以我不必访问 mysql 的“FROM_UNIXTIME”函数的方式定义它？

    作为记录，仅使用 sqlalchemy.types.DateTime 并希望它在检测到整数列不起作用时做正确的事情，它适用于时间戳字段和日期字段。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-15T00:44:41.407

我认为您展示的类型装饰器存在一些问题。

1.  `impl`应该`sqlalchemy.types.Integer`代替`DateTime`.
2.  装饰器应该允许可以为空的列。

这是我的想法：

```
 import datetime, time
from sqlalchemy.types import TypeDecorator, DateTime, Integer

class IntegerDateTime(TypeDecorator):
    """a type that decorates DateTime, converts to unix time on
    the way in and to datetime.datetime objects on the way out."""
    impl = Integer # In schema, you want these datetimes to
                   # be stored as integers.
    def process_bind_param(self, value, _):
        """Assumes a datetime.datetime"""
        if value is None:
            return None # support nullability
        elif isinstance(value, datetime.datetime):
            return int(time.mktime(value.timetuple()))
        raise ValueError("Can operate only on datetime values. "
                         "Offending value type: {0}".format(type(value).__name__))
    def process_result_value(self, value, _):
        if value is not None: # support nullability
            return datetime.datetime.fromtimestamp(float(value)) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T09:19:18.627

所以，是的，这种方法有效。最后我回答了我自己的问题：/，希望有人觉得这很有用。

```
import datetime, time
from sqlalchemy.types import TypeDecorator, DateTime
class IntegerDateTime(TypeDecorator):
    """a type that decorates DateTime, converts to unix time on
    the way in and to datetime.datetime objects on the way out."""
    impl = DateTime
    def process_bind_param(self, value, engine):
        """Assumes a datetime.datetime"""
        assert isinstance(value, datetime.datetime)
        return int(time.mktime(value.timetuple()))
    def process_result_value(self, value, engine):
        return datetime.datetime.fromtimestamp(float(value))
    def copy(self):
        return IntegerDateTime(timezone=self.timezone) 
```

# c++ - 指针问题.. ( C++ )

> ID：762752
> 
> 赞同：0
> 
> 时间：2009-04-18T02:26:09.650
> 
> 标签：c++, pointers

就在我以为我已经弄明白的时候，我收到了一个异常处理错误。问题：问题在于私有成员在构造函数之外丢失了信息。这是我的班级定义

**代码：**

```
class ClassType
{
    private:
             char *cPointer;
             int length;

    public:
            ClassType();
            // default constr. needed when allocating  in main.
            ClassType( const ClassType* );
            char otherFunc();    
}; 
```

类类型.cpp：

```
"#include ClassType.h"

ClassType( const ClassType* )
{
    cPointer = ClassType->cPointer;
    length = ClassType->length;
}

ClassType::ClassType( const char *myVar )
{
    cPointer = new char[ strlen( myVar ) + 1 ]  //+1 for trailing '\0'
    strcpy( cPointer, myVar );
    length = strlen( cPointer );
}

char ClassType::otherFunc()
{
    cPointer;  // Nothing is shown when debugging..
    cPointer = "MyPointer"; // Results in  acrash
    length = 5; // Results in a crash
}

// The main function is working properly. 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T02:38:18.497

1.  这不是有效的 C++ 代码。
2.  如果你使用 C++，你不应该使用 std::string 作为字符串吗？
3.  基于另一个实例的构造函数应该是`ClassType(const ClassType& rhs)`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T02:37:47.017

我想不出为什么它会在你指出的地方崩溃，但是你的代码有几个问题（其中一些是编译时问题，所以我们不能确定这段代码准确地反映了这个问题）：

*   存在所有权问题 - 何时`ClassType::ClassType( const ClassType* )`调用，哪个实例`ClassType`拥有指向的对象`cPointer`？
*   没有 dtor 可以释放在 `ClassType::ClassType( const char *myVar )' 中分配的内存
*   由于`cPointer`可能指向`new`或可能不指向分配的内容，因此您在尝试确定何时`new`应该删除分配的内容时会遇到问题。

就编译时错误而言：

*   的定义`ClassType( const ClassType* )`应该从`ClassType::ClassType( const ClassType* )`
*   的内容`ClassType::ClassType( const ClassType* )`应该使用参数而不是`ClassType`类名作为指针
*   `char ClassType::otherFunc()`需要一个退货声明

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T02:39:32.190

这是真正的代码吗？

```
ClassType( const ClassType* )
{
    cPointer = ClassType->cPointer;
    length = ClassType->length;
} 
```

如果是这样，它需要是这样的：

```
ClassType( const ClassType* rhs )
{
    cPointer = rhs->cPointer;
    length = rhs->length;
} 
```

此外，此构造函数不是默认 ctor：

```
ClassType( const ClassType* ); // default constr. needed when allocating  in main. 
```

默认 ctor 特别是一个接受零个参数或所有参数都指定了默认值的 ctor。换句话说，默认 ctor 是可以这样调用的 ctor：

```
ClassType myObject; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T05:42:01.783

[我在您关于此代码的其他问题](https://stackoverflow.com/questions/762833/pointer-issues-2-valid-c-syntax/762847#762847)中提供了一个非常完整的答案。我认为主要问题是您的复制构造函数被大量破坏。这将导致双重免费错误和其他不良情况。此外，由于您的析构函数在您分配的指针上调用 delete，因此您永远无法将字符串文字分配给您的类指针。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T02:41:23.420

默认构造函数是那些所有参数都具有默认值的构造函数，因此您的构造函数采用指针不是默认构造函数。

您的崩溃位置表明该类尚未正确构建，因此您在分配给它们时可能会遇到地址错误。

您能否发布主要内容，因为这可能是解决问题的关键？

# latex - PStricks 和 TikZ 如何比较易于学习和 API 设计质量？

> ID：762754
> 
> 赞同：27
> 
> 时间：2009-04-18T02:31:17.657
> 
> 标签：latex, diagram, tikz, literate-programming, pstricks

我的团队在我们的大部分源代码中都使用了[文学编程](http://www.literateprogramming.com)——这意味着内部文档是使用 LaTeX 编写的。我们一直在使用[PStricks](http://www.tug.org/PSTricks/)来绘制系统的精美技术图，但最近被推荐使用[TikZ](http://sourceforge.net/projects/pgf/)。我收集了这些信息：

*   TikZ/PGF 是新的和维护的；PStricks 在没有维护者的情况下运行了很长时间，但在过去几年中得到了一些维护。
*   TikZ 适用于许多后端，包括（对于那些关心的人）`pdftex`。PStricks 仅适用于`dvips`.
*   PStricks 比 TikZ 更强大，更有表现力。在紧急情况下，您甚至拥有 PostScript 的全部功能。
*   PStricks 有一个重要的生态系统，即构建在它之上的额外包；TikZ 太新了，没有很多这样的东西。
*   TikZ 声称在设计时“考虑到了 PStricks 的缺点”。作者没有具体说明*哪些*缺点。

我对两个问题的答案感兴趣。如果您愿意，请随时为每个问题发布一个答案：

*   这两种工具的**学习曲线如何？**（我认为 PStricks 有一个陡峭的学习曲线；关于 TikZ 我不了解。）

*   **被视为编程 API**，这两个包中的一个包的设计是否明显优于另一个包？如果是这样，哪个设计更好，*为什么*？（它有什么特性让你认为它更好？）

为了提出一个令人信服的论点，为什么一种 API 比另一种更好，您可能需要借助示例。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-01T06:50:46.350

快速回答：我更喜欢 TikZ 而不是 pstricks，因为我认为 TikZ

*   设计得更好
*   更容易学习
*   与 pdftex 兼容
*   给你更多的权力和抽象（你不必手动指定尽可能多的坐标）
*   让您用同样的努力创建更漂亮的图形
*   使用 TeX 编程更容易扩展（它从一开始就考虑到了可扩展性）

对于 pstricks 的用户，我建议将来使用 TikZ 编写所有新文档。对于METAPOST的用户，如果他们的图形不使用线性方程求解，我推荐TikZ。如果 METAPOST 图形需要线性方程求解，我建议尝试[Asymptote](http://asymptote.sourceforge.net/)。

pstricks 确实为您提供了 PostScript 的强大功能，但使您的图形创作功能强大的不是 PostScript，而是抽象：使用自动定位、自动交点计算和显示样式模板。TikZ 为你提供了强大的抽象，即使你不是程序员，或者你这次不愿意编程。

我没有编写 TikZ 扩展的经验，但是快速浏览一下 TikZ 源代码，与我遇到的其他 TeX 宏包相比，它似乎很容易理解和扩展。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-10-21T12:36:43.800

作为 TikZ 的忠实用户，我一直在与我物理系的一位喜欢 pstricks 的教授进行辩论，我认为我们已经得出结论，正如我在其他帖子中所说的那样。在深入 PS 本身时缺席几次，TikZ 和 pstricks 在大多数方面都非常可比。TiKZ 的可扩展性和兼容性很有吸引力，让我们同意：

*   我们认为新用户应该学习 TikZ。
*   pstricks 的老手可能不会从转换中获得足够的收益，并且可能不值得做。

希望这会有所帮助！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-17T11:50:53.657

我只用过 PSTricks，但我已经让它做我想做的一切。Tikz 有一本好看的手册，而且显然非常强大。我希望从绘图系统中得到两件我不能用 PSTricks 做的事情：羽化边缘（Tikz 可以做），我不记得另一件事了。OP 在询问“易于学习”：PSTricks 肯定需要一些试验和错误，我认为一些我不太擅长的编码学科。但是 \rput 是我使用 PSTricks 的核心。我无法想象没有它。

另一方面，“装饰品”看起来很整洁。我喜欢手册（共 560 页）第 210 页（！）上的“从垃圾中保存”示例。我不喜欢 Tikz 似乎使用完全不同的符号这一事实——我不认识其中的 LaTeX，这使它看起来很陌生和奇怪。不过，手册看起来很漂亮。透明度和“淡化”效果似乎非常强大.. 可以在 pstricks 中完成吗？..但我怀疑我是否会使用它们。Tikz 似乎更多地关注事物的“绘图”端。通常，我不画画，我做数字。

你会在坐标上做算术吗？我必须重新开始并从头开始学习使用 Tikz，如果我什至不确定我会从中得到什么，这将是一个艰难的卖点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-24T02:04:45.740

我正在开发一个使用安装在服务器上的 Miktex 发行版的 asp.net 应用程序。

该应用程序将生成数学问题并生成供访问者下载的 pdf 文件。数学问题包含一些 jpeg 图像和数学图表。

我很困惑是使用 PSTricks 还是 Tikz。在对应用程序进行基准测试后，我必须使用 Tikz，因为它只需要一个使用 pdftex 的编译步骤。所以 Tikz 在这种情况下获胜。:D

注意：我希望我的回答与您的问题相符：D

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-22T02:19:33.447

我认为 pstricks 更胜一筹。TikZ 甚至没有翻译坐标的好方法，比如 rput/uput/Aput/Bput pstricks 命令。您可以使用 xshift 和 yshift，但它们需要单位 (!)，因此缩放图像将需要手动共享每个 xshift/yshift 调用。

# jquery - 如何突出显示只有一行的 HTML 表格行可以突出显示？

> ID：762761
> 
> 赞同：0
> 
> 时间：2009-04-18T02:36:25.037
> 
> 标签：jquery

```
$(document).ready(function() {
  $("tr").removeClass();
  $("tr:gt(0)").click(function() {
    $(this).css("color", "red")
  });
});
```

```
.highlight td {
  background: red;
}
```

```
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title></title>
  <link href="003.css" type="text/css" rel="stylesheet" />
  <script src="http://code.jquery.com/jquery-latest.js"></script>
</head>

<body>
  <table>
    <tr>
      <td>NAME</td>
      <td>AGE</td>
    </tr>
    <tr>
      <td>John Smith</td>
      <td>44</td>
    </tr>
    <tr>
      <td>Mary Green</td>
      <td>66</td>
    </tr>
    <tr>
      <td>Bob Black</td>
      <td>22</td>
    </tr>
  </table>
</body>

</html>
```

以下代码不起作用，但如何纠正它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-18T02:48:30.500

也许尝试改变

```
$("tr:gt(0)").click(function(){$(this).css("color","red")}); 
```

进入

```
$("tr:gt(0)").click(function() {
        $(".highlight").removeClass("highlight");
        $(this).addClass("highlight");
    }); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T02:46:14.577

您没有设置任何`<td>`to`class="highlight"`所以背景都不会是红色的。

# .net - 我可以在客户端计算机上期望什么最低版本的 .NET？

> ID：762762
> 
> 赞同：1
> 
> 时间：2009-04-18T02:36:31.917
> 
> 标签：.net

我知道，一般来说，我可以期望在大多数客户端/客户机器上安装 .NET 2.0 或更好的版本，因为它已包含在 Windows XP SP1 (SP2?) 中一段时间​​，并且在 Vista/2003/2008 中成为标准配置。但我现在的问题是，我能否期望 .NET 3.0 支持 WCF/WPF？我们构建组件库，因此我们不能做出太多假设，并且要求我们的开发客户包括 3.0 安装程序并不理想。

所以我想的问题是，根据您的经验，在大多数安装了 .NET 的机器上安装的 .NET 的最低版本是多少？是否有资源可以跟踪此类事情？

澄清一下：我对最终安装者没有任何控制或影响。我感兴趣的是已经存在哪些依赖项，而不是如何使客户端机器达到规范。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-18T02:44:47.857

**永远不要假设关于客户端机器的任何事情**。

如果客户端需要，将目标框架与安装捆绑在一起很容易。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T02:42:57.957

根据我的经验，此时您可以非常安全地假设为 2.0。假设更高版本似乎总是给我们带来麻烦。（另一方面，只需提供一个指向 3.5 安装程序的链接就非常容易且轻松。）

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-18T03:12:21.893

你应该在你的网站上实现类似[browsercheck](https://www.cyscape.com/showbrow.aspx?bhcp=1)的东西来收集所有的浏览器统计信息。这样，分析就会自己说话，不需要任何假设。

# visual-studio - 为什么升级内存后 Visual Studio / Resharper 仍然很慢？

> ID：762763
> 
> 赞同：2
> 
> 时间：2009-04-18T02:36:42.073
> 
> 标签：visual-studio, resharper

[ReSharper](http://en.wikipedia.org/wiki/ReSharper)建议使用 4 GB 内存。我刚刚将我的 PC 从 512 MB 内存升级到 4 GB（我有一个[戴尔](http://en.wikipedia.org/wiki/Dell)）。安装此内存后，我需要在 Windows 中做些什么吗？还是现在就去？我期待在 Visual Studio 中看到很大的提升，但它似乎仍然很慢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-18T02:37:52.803

查看新的 Resharper 4.5 版本。他们为提高速度做了很多工作。

您还可以关闭一些 Visual Studio Intellisense 选项，这样 VS 就不会做与 R# 相同的工作。

要禁用 VS IntelliSense：

1.  工具 | 选项
2.  文本编辑器 | C# | 智能感知
3.  取消选中“显示完成列表...”
4.  文本编辑器 | C# | 格式化
5.  取消选中所有 3 个选项

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-30T10:49:10.857

如果您启用了解决方案范围分析选项，这可能会占用大量内存并导致性能问题。除非进行项目-项目重构或偶尔进行代码分析，否则最好不要使用它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-30T10:55:36.917

这实际上取决于项目的类型，最重要的是项目的大小。在处理像我们这样的大型 Web 项目时，Resharper 一直是一个巨大的性能杀手，因为它似乎无法处理大量的 aspx 和 ascx 文件。我们的解决方案包含 24 个子项目和 328 个 ascx 页面，使用 640 个 ascx 控件，有时在文本视图中打开一个 ascx 需要长达 20 秒（更不用说设计视图）。我们工作的机器配备了 4GB 的 Ram，有些配备了 8GB。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T03:26:21.097

我在使用 resharper 时遇到了几个问题，最终导致我完全卸载它。我对表现感到满意，但对 resharper 可能会更满意。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-30T11:02:08.103

这与记忆无关。你只需要一个好的 CPU（他们推荐四核。）

我在[Core 2 Duo](http://en.wikipedia.org/wiki/List_of_Intel_Core_2_microprocessors#Core_2_Duo)和 2 GB RAM 上安装了 ReSharper 4.5。启动 Visual Studio 需要 15 到 30 秒，但之后一切都很顺利。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-10-06T13:48:49.410

我个人尝试后选择卸载 R# 6.0。性能价格太高了。我的开发 PC 是 Win7 32 位 4GB RAM，我主要使用 MVC3 解决方案，其中包含大约 40 个项目。即使关闭了动态分析，显示智能感知菜单也需要几秒钟，这对我来说是一个很大的禁忌。加上暂停 R#（工具、选项、Resharper、Suspend）会导致智能感知不再工作（R# 是否完全取代了 VS 智能感知？）。一个具有许多优点的有趣产品有太多严重的缺点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-30T06:15:20.937

我可以看到所有与性能相关的问题都是因为机器的 FSB 速度（RAM 速度）较低。它类似于其他组件消耗处理器消息的速度。FSB 速度需要更高（例如 1333/1600/1833 MHz）以及更高时钟的 CPU 和 SSD 以获得更好的开发体验。

# python - 您如何在数据库中存储应用引擎图像对象？

> ID：762764
> 
> 赞同：1
> 
> 时间：2009-04-18T02:36:47.113
> 
> 标签：python, google-app-engine, image

我有点坚持我的代码：

```
def setVenueImage(img):
  img = images.Image(img.read())
  x, y = photo_utils.getIdealResolution(img.width, img.height)
  img.resize(x, y)
  img.execute_transforms()
  venue_obj = getVenueSingletonObject()
  if venue_obj is None:
      venue_obj = Venue(images = [img])
  else:
      venue_obj.images.append(img)
  db.put(venue_obj) 
```

我将 django 与应用引擎一起使用 - 所以 img.read() 工作正常。

事实上，在我尝试将 img 存储到数据库之前，所有这些代码都可以正常工作。我的模型需要一个 Blob，所以当我将图像作为 img 放入时，它会抛出一个合适的结果，我得到：

> BadValueError at /admin/venue/ 图片列表中的项目必须都是 Blob 实例

好的，所以图像不能是 Blob，但是我如何使它成为 Blob？Blobs 接受一个字节字符串，但是如何使我的图像成为一个字节字符串？

我没有在文档中看到他们*实际*使用图像对象的任何地方，所以我不确定这一切应该如何工作，但我确实想使用图像对象来调整我的图像大小（我知道你可以做到PIL，但我想知道如何使用谷歌的 Image 类来做到这一点）。

感谢您的任何指点:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T04:09:34.627

我对这个解决方案不满意，因为它不会将 Image 对象转换为 blob，但暂时可以：

```
def setVenueImage(img):
  original = img.read()
  img = images.Image(original)
  x, y = photo_utils.getIdealResolution(img.width, img.height)
  img = images.resize(original, x, y)
  venue_obj = getVenueSingletonObject()
  if venue_obj is None:
      venue_obj = Venue(images = [db.Blob(img)])
  else:
      venue_obj.images.append(db.Blob(img))
  db.put(venue_obj) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-22T20:54:28.920

这可能会起作用：

```
def setVenueImage(img):
  img = images.Image(img.read())
  x, y = photo_utils.getIdealResolution(img.width, img.height)
  img.resize(x, y)
  img_bytes = img.execute_transforms() # Converts to PNG
  venue_obj = getVenueSingletonObject()
  if venue_obj is None:
      venue_obj = Venue(images = [img_bytes])
  else:
      venue_obj.images.append(img_bytes)
  db.put(venue_obj) 
```

我假设 Venue.images 是 ListProperty(db.Blob)，对吗？这可能是错误的做法。使用简单的 blob 属性定义一个 VenueImage 模型，并将其密钥存储到 Venue。如果您将图像直接放在那里，您将达到数据存储的 1MB 行限制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T02:45:09.963

[http://code.google.com/appengine/docs/python/images/usingimages.html](http://code.google.com/appengine/docs/python/images/usingimages.html)

我认为该链接应该有所帮助。祝你好运。

# delphi - 使用Delphi修改另一个delphi程序的版本信息

> ID：762778
> 
> 赞同：2
> 
> 时间：2009-04-18T02:45:34.080
> 
> 标签：delphi, version

我想在 Delphi 中创建一个小工具，可以更新另一个 exe 文件中的 Delphi 版本信息。我知道有几个现有的实用程序可以解决这个问题，但我需要完全的编程控制，并且不希望对命令行等进行炮击。

经过网络搜索，我找不到任何在exe中修改版本信息的Delphi源代码示例，有人可以提供一些代码或方向吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-18T04:17:12.160

我不能给出完整的答案，但我可以让你开始。[DelphiDabbler.com](http://www.delphidabbler.com/articles?article=20)上有一篇文章介绍了如何从文件中获取版本信息。`GetFileVersionInfo`是执行此操作的 Windows API。要设置它，我相信`UpdateResource`您需要使用 Windows API 函数。[CodeProject](http://www.codeproject.com/KB/cpp/UpdateVersion.aspx)上的另一篇文章使用 C 涵盖了这一点，但它应该让您对需要做什么有一个坚实的了解。

祝你好运！

编辑：我在 Delphi 新闻组上找到了一些代码，可能会给你更多帮助：

```
// Credit to Michael Winter for this code!
Sz := GetLen;
GetMem(Data, Sz);
try
  GetData(Data, Sz);
  HFile := BeginUpdateResource(PChar(FileName), false);
  if HFile = 0 then
    RaiseLastWin32Error;
  DoDiscard := true;
  try
    if not UpdateResource(HFile, RT_VERSION, PChar(1), 0, Data, Sz) then
      RaiseLastWin32Error;
    DoDiscard := false;
  finally
    if not EndUpdateResource(HFile, DoDiscard) then
      RaiseLastWin32Error;
  end;
finally
  FreeMem(Data);
end; 
```

这只是一个片段，需要您做一些工作，但这是大部分工作！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T15:30:06.783

还有 Colin Wilson 的带有源代码的[XN 资源编辑器可能会有所帮助。](http://www.wilsonc.demon.co.uk/d10resourceeditor.htm)

# c# - C#：如何处理乱序的 TCP 数据包？

> ID：762779
> 
> 赞同：3
> 
> 时间：2009-04-18T02:45:42.380
> 
> 标签：c#, sockets

可以请某人解释如何处理乱序数据包。我正在使用原始套接字来捕获数据包，并在它们到来时对其进行解析，但其中一些以错误的顺序出现，例如：

1.  Id............标志
2.  16390：（PSH，确认）
3.  16535：（PSH，确认）
4.  16638：（确认）
5.  16640：（PSH，确认）
6.  16639：（确认）
7.  16695：（PSH，确认）

ID：16390、16535、16695的数据包是单独的数据包，可以自由处理ID：16638、16640、16639的数据包是一个数据包的序列，在解析前要按升序排列。

更糟糕的是，带有 Push 标志的数据包有时会首先出现，所以我只是将它们传递给解析器，然后它之前的数据包来了，解析器只是将其丢弃为已损坏。

有没有办法处理它？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-18T02:48:03.043

TCP 段不会乱序，因为在您确认前一个之前不会发送下一个。

> TCP 按顺序对它发送到特定目标端口的段进行编号，以便如果它们无序到达，TCP 实体可以对它们重新排序。

这发生在 TCP 之下的传输层上，因此任何 TCP 连接都不会“看到”这种情况发生。就 TCP 而言，它们总是有序的。因此，如果您看到它们乱序，那么您没有在 TCP 传输层上工作，您处于较低级别。

另外，仅供参考...

*   TCP数据是一个“段”
*   IP数据是一个“数据报”
*   网络级是一个“包”

**编辑：**您提供的链接将为您提供 IP 数据报流，因此您必须自己处理 TCP 流。我不会假装这很容易，并试图在这里解释。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-18T02:52:14.360

TCP 保证顺序。所以我假设你在谈论IP。

您可以尝试的一件事是将数据包放入最小堆中，然后等待下一个您想要的数据包 ID 号可用。

至于推送数据包，应该尽快收到，不受订购限制，因此由您决定要等待多长时间以查看是否会收到更早的推送数据包。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-18T02:51:59.790

为什么不使用普通的 tcp 套接字，以便它们按顺序排列？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-02-15T00:21:23.413

序列号将显示顺序。它以 4G 包装，因此您必须考虑到这一点。您将不得不使用与 TCP 相同的基本例程。缓冲乱序数据包并丢弃重复数据包。有效载荷的序列号 + Len 是下一个序列号。

TCP/IP Illistrated vol 2 或 TCP.c ？

# wpf - 在winforms或wpf中拖放

> ID：762781
> 
> 赞同：6
> 
> 时间：2009-04-18T02:47:32.657
> 
> 标签：wpf, winforms, drag-and-drop

我想创建一个简单的 winforms 或 wpf 应用程序，我可以在其中拖放虚拟“卡片”。下面这不是我想要做的，但它是我在网上找到的最接近代表用户界面的东西。

[http://www.greenpeppersoftware.com/confluence/plugins/advanced/gallery-slideshow.action?imageNumber=1&pageId=24870977&decorator=popup&galleryTitle=Task+board+and+transitions](http://www.greenpeppersoftware.com/confluence/plugins/advanced/gallery-slideshow.action?imageNumber=1&pageId=24870977&decorator=popup&galleryTitle=Task+board+and+transitions)

所以基本上我想在 GUI 中有列，我可以在其中从一个拖放到另一个。

我的问题是：

1.  这在winforms或wpf中会更容易吗
2.  我从哪里开始？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T09:34:04.737

在 winForms 和 WPF 中，拖放都可以通过使用目标 DragOver 和 Drop 上的事件以类似的方式完成。

但是，使用 WPF，您还有其他选择。您还可以通过在拖动时显示缩略图来使应用程序看起来更好（这在 winforms 中是可能的，但更难实现）。

看看[这个 WPF 示例](http://dotnetslackers.com/WPF/re-193181_WPF_Drag_and_Drop_Between_ItemsControls.aspx)，它使用了一个帮助类，并认为它完全符合您的需要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T17:36:21.287

我同意 John 的观点，即 WinForms 和 WPF 在拖放方面非常接近。但是 WPF 为 ItemsControl 提供了更多的“通用基础”，允许实现更独立于最终使用的 UI 元素（ListBox、ListView、TreeView...可以轻松切换）。显然 WPF 允许更多花哨的效果。

我强烈推荐这篇博文： [http](http://www.beacosta.com/blog/?p=53) ://www.beacosta.com/blog/?p= 53 既适用于一些拖放基础知识，也适用于干净的 WPF 拖放方法。它展示了一个相当通用的帮助器的一个很好的实现，用于从/到 WPF ItemsControls 拖放，我真的很喜欢“插入装饰器”。而且我确实喜欢通过使用附加属性将拖放代码与用户控件本身很好地分开，这使得它更易于使用和维护。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T03:15:35.567

在 WPF 中可能会稍微容易一些，因为 Thumb 控件提供了易于使用的内置拖动支持。（如果我没记错的话，在 WinForms 中您需要自己处理鼠标事件，而 WPF Thumb 会为您执行此操作并将它们转换为拖动开始、增量和结束事件。）

但是，如果您比另一个框架更熟悉一个框架，那可能会使 Thumb 控件产生的差异相形见绌。

您还应该四处寻找可以为您处理此问题的工具包/框架——我认为 WinForms 和 WPF 都存在它们（虽然不确定）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T04:50:38.387

darg 和 drop 的一个好方法被解释为

将拖动检测为 MouseMove 和 MouseLeftButtonDown 的组合

找到您要拖动的数据并创建一个包含格式、数据和允许的效果的 DataObject。

通过调用 DoDragDrop() 启动拖动

在要允许放置的元素上将 AllowDrop 属性设置为 True。

将处理程序注册到 DragEnter 事件以检测拖放位置上的拖动。通过在事件参数上调用 GetDataPresent() 检查格式和数据。如果可以删除数据，请在事件 args 上设置 Effect 属性以显示适当的鼠标光标。

当用户释放鼠标按钮时，将调用 DragDrop 事件。通过在事件 args 中提供的 Data 对象上调用 GetData() 方法来获取数据。

[你可以在这里](http://www.wpftutorial.net/DragAndDrop.html)找到完整的文章

# .net - 您会避免使用需要 .NET 3.5 的组件吗？

> ID：762785
> 
> 赞同：0
> 
> 时间：2009-04-18T02:50:23.180
> 
> 标签：.net

[在对上一个问题](https://stackoverflow.com/questions/762762/what-minimum-version-of-net-can-i-expect-on-client-machines)的跟进中，您会避免使用需要 .NET 3.0/3.5 的组件库吗？额外的安装要求会不会要求太多，或者 .NET 安装程序是否足够容易，只需包含或链接到它并不重要？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T03:09:38.937

对我来说，更多的是*何时*而不是*是否*的问题。让我们面对现实吧，几乎每个人都会在某个时候升级到 .NET 3.5，如果还没有的话。

坦率地说，我想不出为什么不应该将 Windows 计算机升级到 .NET 3.5 的充分理由。

话虽如此，如果我有一个客户出于某种原因拒绝接受任何需要 .NET 3 的软件，那么如果我希望获得报酬，我将不得不接受他们。

至于安装程序，安装最新的 .NET 确实没什么大不了的，那就是安装 .NET 2。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T03:06:59.287

在几种情况下，我可能会避免使用该组件。.NET 运行时升级的易用性并不是唯一的因素。如果您的应用程序将在公司环境中使用，或者您没有技术受众，我会采取最低公分母的态度。如果您的听众不受限制，您可能有理由转向另一个方向。另一个重要因素是组件为您的应用程序带来的功能。如果该功能足够重要或足够重要，请权衡用户配置环境的时间。环境可能会迎头赶上，但这些其他外部因素可能很重要。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T04:37:21.987

缺乏对 Windows 2000 的支持有时是避免使用 .NET 3.5 的一个原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T03:01:20.127

这完全取决于我在写什么。如果我正在编写一个针对大型消费者群的应用程序，我可能会远离需要 3.5 的东西，因为下载的大小。如果我正在编写 Visual Studio 2008 加载项，我会毫不犹豫地使用需要 3.5 的东西。如果我正在编写一个内部应用程序，这将取决于当前的桌面配置以及 IT 管理员对推出 3.5 的开放程度（如果还没有的话）。恐怕您可能需要一个更具体的场景才能获得更具体的答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T03:16:13.007

没有必要避免。有很多工具/安装程序可以使安装接缝更少且无处不在。请记住，您需要 .NET 3.5 SP1。

注意：您的客户端需要具有管理员权限才能安装 .Net（如果它尚未存在）。这有时会给愤怒的客户带来问题。请记住关于 MLB 驳斥 Silverlight 的文章，主要是因为用户在工作中没有足够的权限而无法安装该插件。

# ruby - Ruby 监视器分段错误

> ID：762795
> 
> 赞同：0
> 
> 时间：2009-04-18T03:00:11.690
> 
> 标签：ruby, monitor

我按照[http://www.ruby-doc.org/stdlib/libdoc/monitor/rdoc/index.html](http://www.ruby-doc.org/stdlib/libdoc/monitor/rdoc/index.html)中的示例对代码进行了一些修改：

```
require 'monitor.rb'

buf = []
buf.extend(MonitorMixin)
empty_cond = buf.new_cond

producer = Thread.start do
# producer
line = "produce at #{Time.now}"
#while line
  buf.synchronize do
    puts "==> #{line}"
    buf.push(line)
    empty_cond.signal
  end
  sleep(2)
  #line = "produce at #{Time.now}"
#end
end

loop do
   buf.synchronize do
      empty_cond.wait_while { buf.empty? }
      item = buf.shift
      puts "got #{item.inspect}"
   end
end 
```

我让程序运行。大约 5 分钟后，它会抛出“分段错误”。与死锁有关的东西？

/杰克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T06:40:11.067

正如您的代码所代表的那样（在生产者循环中带有注释掉的 while 语句），生产者线程只需运行一次循环并退出。消费者从 buf 读取一条生产线，然后陷入僵局，等待更多永远不会到达的线。

Ruby 的线程调度程序具有内置的死锁检测功能，因此它会在看到“消费者”循环已死锁时终止程序。

要亲自查看死锁，请将生产者转换为全局变量`$producer`并将循环语句用`$consumer = Thread.start do ... end`. 将代码加载到 irb 并评估 $producer 应该会导致 => #< Thread:0x000000010afb58 dead > （并且 $consumer 在休眠线程中）

取出与生产者的 while 循环相关的注释，您将拥有一个工作（无限）循环，该循环以 2 秒的间隔生成当前时间。

# arrays - 数组和派生类型

> ID：762797
> 
> 赞同：6
> 
> 时间：2009-04-18T03:01:51.280
> 
> 标签：arrays, types, fortran

对于我的新项目，我必须使用数组而不是临时文件来存储来自用户的信息。为此，我还需要创建派生类型。

但是，我还没有理解什么是数组，什么是派生类型，如何使用它们，它们可以做什么，以及其他一些基本的想法。谁能给我一些关于数组和派生类型的信息？

我为他们编写了代码，但我不知道它是否正确编写。如果有人可以帮我检查一下，我将不胜感激。

这是我的数组和派生类型：

```
! derived type
TYPE Bank
  INTEGER :: acNumber, acChecks
  REAL :: acBlance, acRate
  CHARACTER :: acType*1, acLName*15, acFName*15
END TYPE

! array
INTEGER, PARAMETER :: MaxRow, MaxColum = 7
INTEGER, DIMENSION(MaxRow:MaxColum) :: AccountData 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-19T20:22:10.710

如果您是一名 fortran 程序员，您可能见过一个接受 10/15 参数的子例程。如果你仔细想想，这太疯狂了（它们太多了，你冒着交换它们的风险），你很快就会意识到一些争论总是一起传播的。将它们打包在一个单独的实体下是有意义的，该实体将所有东西作为一个整体而不是作为独立实体来承载。这将大大减少参数的数量，只给您找到适当关联的负担。这个单一的实体就是类型。

在您的代码中，您说银行是这些信息的集合。您现在可以声明该类型的具体变量，它将表示并提供对单个变量 acNumber、acChecks 等的访问。为此，您必须使用 % 符号。所以如果你的银行变量被称为b，你可以说例如

```
b%acNumber = 5 
```

你可以把 b 想象成一个壁橱，里面有不同的架子。你移动封闭，所有的架子和它们的内容一起移动。

数组是一组相同类型的实体（例如，整数或字符（len=1024）或银行），它们一个接一个，因此您可以使用数字索引访问它们中的每一个。请记住，除非另有说明，否则 fortran 中的数组索引从 1 开始（在所有其他主要语言中，第一个索引为零）

至于你的代码，我建议你：

*   写

    ```
     INTEGER, DIMENSION(MaxRow:MaxColum) :: AccountData 
    ```

    作为

    ```
     INTEGER :: AccountData(MaxRow,MaxColum) 
    ```

    它是一样的，但你写的少。另请注意，使用 : 和 , 是有区别的。如果你想定义一个矩阵（你的情况），它是一个二维数组，你必须使用逗号。你写的是错误的。

*   对于字符串，最好写

    ```
     CHARACTER :: acType*1, acLName*15, acFName*15 
    ```

    作为

    ```
     CHARACTER(LEN=1) :: acType
     CHARACTER(LEN=15) :: acLName
     CHARACTER(LEN=15) :: acFName 
    ```

    在这种情况下，你写得更多，但你的语法已被弃用（不过我可能是错的）另外，请记住，如果你在类型中每行写一个成员变量会更好。这是一个品味问题，但我更喜欢通过每个成员变量一行来查看类型的完整大小。

*   对于 MaxRows 和 MaxColumns，我会将它们写为 MAX_ROWS 和 MAX_COLUMNS。传统上高度一致的参数和内容在任何主要语言中都以全大写、下划线分隔的名称标识。

* * *

**编辑**：回答您的评论，这是使用数组的示例

```
$ more foo.f90 
program test
    integer :: myarray(10)

    myarray = 0   ! equivalent to zeroing the single elements one by one
    myarray(2) = 5
    myarray(7) = 10

    print *, myarray

end program
$ g95 foo.f90 -o foo
$ ./foo
 0 5 0 0 0 0 10 0 0 0 
```

数组就像多个具有相同名称的变量，由索引标识。对于表示向量或矩阵非常有用。您当然可以做一个您定义的聚合类型的数组，而不是预定义的类型（例如整数）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-19T19:18:29.223

数组是变量的有序列表，所有类型相同，以整数为索引。请参阅[Wikipedia](http://en.wikipedia.org/wiki/Array "维基百科中的数组") 中的数组 请注意，在 Fortran 中，数组索引比大多数其他低级语言更灵活，因为您可以拥有一个由下限、上限和步幅组成的索引三元组，而不是每个维度的单个索引。在这种情况下，表达式的左值是一个子数组，而不是数组类型的单个元素。

派生类型是用户定义的复合类型，它由多个不同类型的组件组成。在其他一些语言中，这些被称为结构、结构类型或记录类型。参见[维基百科中的记录](http://en.wikipedia.org/wiki/Record_(computer_science) "在维基百科中记录")

您还可以创建一个派生类型的数组，或者您可以拥有一个派生类型，其中一个或多个组件本身就是数组，或者就此而言，其他派生类型。由你决定！

检查代码的最简单方法是尝试编译它。让它通过编译器当然不能保证程序按预期工作，但这肯定是一个必需的步骤。

# java - Java中的MidiUnavailableException？

> ID：762803
> 
> 赞同：8
> 
> 时间：2009-04-18T03:06:38.630
> 
> 标签：java, audio, midi

我在用 Java 播放 MIDI 文件时遇到了一些问题。`MidiUnavailableException (MIDI OUT transmitter not available)`当我尝试玩它时，我得到的是一个。我的代码是标准的：

```
try {
    midiseq = MidiSystem.getSequencer();
    midiseq.open();
    midiseq.setSequence(MidiSystem.getSequence(sound1));
    midiseq.setLoopCount(Sequencer.LOOP_CONTINUOUSLY);
    midiseq.start();
} catch (Exception e) {e.printStackTrace();} 
```

`midiseq`是一个`Sequencer`；`sound1`是一个`InputStream`。

此代码适用于其他几台计算机，甚至适用于 Eclipse 以及在 JAR 文件中使用时，只是在我从命令提示符启动它时不起作用。我下载了一个更稳定的 Java midi 应用程序，它抛出了同样的异常。

它不可能是硬件问题，因为 Eclipse 可以毫无问题地运行它，也不可能是编码问题，因为它可以在其他计算机上正常运行。甚至这一行代码也会抛出这个异常：

```
javax.sound.midi.MidiSystem.getSequencer(); 
```

提前致谢。

编辑：我的操作系统是 Windows Vista。在我问这个问题之前，我已经下载了最新的 JRE 和 JDK（我认为是 1.6.0_13）。

编辑：代码：

```
ClassLoader.getSystemClassLoader().loadClass("com.sun.media.sound.RealTimeSequencer");
System.out.println( "Sequencer class loaded" );// Otherwise ClassNotFoundException 
```

打印“Sequencer 类已加载。”

但是这段代码：

```
 try{
        System.out.println(javax.sound.midi.MidiSystem.getSequencer());
        System.exit(0);
      } catch(Exception e) {
        throw new RuntimeException(e);
      }
      System.exit(1); 
```

抛出`MidiUnavailableException.`

另外，这段代码：

```
 MidiDevice.Info[] devices = MidiSystem.getMidiDeviceInfo();
    if (devices.length == 0) {
        System.out.println("No MIDI devices found");
    } else {
        for (MidiDevice.Info dev : devices) {
            System.out.println(dev);
        }
    } 
```

给了我这个：

```
    微软 MIDI 映射器
    Microsoft GS 波表合成器
    实时音序器
    Java 声音合成器

```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-19T08:04:26.147

首先看一下您的系统的功能：

```
MidiDevice.Info[] devices = MidiSystem.getMidiDeviceInfo();
if (devices.length == 0) {
    System.out.println("No MIDI devices found");
} else {
    for (MidiDevice.Info dev : devices) {
        System.out.println(dev);
    }
} 
```

如果那里什么都没有，您可能需要安装[音库](http://java.sun.com/products/java-media/sound/soundbanks.html)以使 jvm 能够创建软件音序器。

还要检查 MidiSystem.getReceiver() 的输出，因为如果无法创建接收器（[MidiSystem javadoc](http://java.sun.com/j2se/1.5.0/docs/api/javax/sound/midi/MidiSystem.html#getSequencer(boolean))），也会发生可怕的 MidiUnavailableException。

我希望安装 soundbank 文件将使 jvm 有机会退回到合成器接收器，并且不再需要硬件访问（这似乎失败了：）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T04:59:51.667

它可能与权限有关吗？如果您以与普通命令行程序不同的（更有特权的）用户身份运行 JAR 文件，这可能会解释差异。如果不是这样，也许是一些 Java 系统属性......我想不出任何其他东西会在将相同的代码作为 JAR 文件或单独的 .class 文件运行之间产生差异。

如果您编辑问题以提供有关您运行程序的不同方式的更多详细信息，这可能会有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-23T21:18:38.080

另外（在黑暗中再次拍摄），您能否尝试对任何其他可能使用声音，特别是 Midi 设备的应用程序进行硬关机？我知道当另一个应用程序使用 Midi 并且没有发布它时，人们会在某些 Linux 上遇到这个问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-23T21:13:32.507

当从命令提示符启动失败，但从 JAR 启动时，我会检查你是否真的在这两种情况下使用相同的 Java 版本。对于 Jar，检查 Windows 资源管理器中的文件关联，对于命令行，检查 java -version 是否输出预期的版本（如果没有，挖掘您的 PATH 变量）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-06T12:43:33.883

安装 JMF2.1.1e 后，删除所有 sound.jar 文件，这些文件不仅安装在 JMF 目录中，还安装在 jre 和 jdk 目录中。

[http://www.coderanch.com/t/274513/java/java/javax-sound-midi-compatibility-JMF](http://www.coderanch.com/t/274513/java/java/javax-sound-midi-compatibility-JMF)说：

问题是文件sound.jar 在3个地方找到它并删除它。

C:\Program Files\JMF2.1.1e\lib\sound.jar

C:\Program Files\Java\jdk1.6.0_07\jre\lib\ext\sound.jar

C:\Program Files\Java\jre1.6.0_07\lib\ext\sound.jar

此外，从 PATH 和 CLASSPATH 中删除 sound.jar 引用 这是一个旧的 sound.jar，它在新版本的 Java 中弄乱了新的声音 API。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-05T21:28:04.687

我曾经也有过一样的问题。该错误是由类路径中包含的 JMF 引起的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-19T03:48:15.283

我发现了同样的问题：无法播放 MIDI。但是我注意到，当我将 JDK 从 1.6.0_10 升级到 1.6.0_13 时，问题就开始了。

我用简单的程序测试了两个 JDK：

公共类 MidiTester {

```
public static void main(String[] args) {
  try{
    System.out.println(javax.sound.midi.MidiSystem.getSequencer());
    System.exit(0);
  } catch(Exception e) {
    throw new RuntimeException(e);
  }
  System.exit(1);
} 
```

}

JDK 1.6.0_10 给出了结果：com.sun.media.sound.RealTimeSequencer@1bd747

JDK 1.6.0_13 给出了结果：线程“main”中的异常 java.lang.RuntimeException: javax.sound.midi.MidiUnavailableException: MIDI OUT 发射器在 ivan.seaquest.MidiTester.main(MidiTester.java:10) 处不可用: javax.sound.midi.MidiUnavailableException: MIDI OUT 发射器在 com.sun.media.sound.AbstractMidiDevice.createTransmitter(AbstractMidiDevice.java:444) 在 com.sun.media.sound.AbstractMidiDevice.getTransmitter(AbstractMidiDevice.java: 299) 在 javax.sound.midi.MidiSystem.getSequencer(MidiSystem.java:451) 在 javax.sound.midi.MidiSystem.getSequencer(MidiSystem.java:348) 在 ivan.seaquest.MidiTester.main(MidiTester.java:7 )

我将在 Sun 创建一个错误。我希望它有帮助...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-18T12:29:56.873

你能添加你的操作系统和java版本吗？

并发布异常；Java 通常可以很好地说明问题所在。这并不总是很容易理解:)

在我的带有 java 1.5.0_16 的 mac 上，我没有收到异常（在命令行上）。

以下程序

```
public class MidiTester {

    public static void main(String[] args) {
      try{
        System.out.println(javax.sound.midi.MidiSystem.getSequencer());
        System.exit(0);
      } catch(Exception e) {
        throw new RuntimeException(e);
      }
      System.exit(1);
    }
} 
```

印刷

```
com.sun.media.sound.RealTimeSequencer@d08633 
```

您可以检查类路径上是否有定序器类：

```
ClassLoader.getSystemClassLoader().loadClass("com.sun.media.sound.RealTimeSequencer");
System.out.println( "Sequencer class loaded" );// Otherwise ClassNotFoundException 
```

这至少可以清楚地表明您是否没有类（在通过 PATH 访问的 java 中），或者它是否与权限问题等不同。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-24T13:10:47.290

将资源管理器指向您的 JRE 文件夹（您用于运行程序的 $PATH 上 bin 文件夹上方的那个），例如“C:\Program Files\Java\jre1.6.0”

进入 \lib 文件夹。您是否看到一个名为“audio”的文件夹？里面有东西吗？如果没有，请访问[http://java.sun.com/products/java-media/sound/soundbanks.html](http://java.sun.com/products/java-media/sound/soundbanks.html)

按照说明下载任何 MIDI 库，并将其复制到上述文件夹中。让我们知道它是否有效！

# excel - 清理表

> ID：762813
> 
> 赞同：3
> 
> 时间：2009-04-18T03:15:20.857
> 
> 标签：excel, vba, ms-access

我想要做的是，在 Excel 中，使用 VBA 将数据推送到现有的 Access 表。我已经能够做到这一点，但我有一个小问题。在我push数据访问之前，我想清除Access表上的当前数据，所以当新的数据从Excel进来时，它是Access表中唯一的数据。我真的不知道如何为 Access 编写代码，因为该课程一直在 VBA for Excel 上。我尝试了几种不同的方法，但每次都不起作用。例如，看起来应该可以工作的代码是

```
DoCmd.RunSQL "DELETE tblName.* FROM CoversheetTableFourthAttempt 
```

但我收到一个错误，告诉我定义一个对象。

如果你能帮我解决这个问题，我真的很感激

我把我的代码放在下面以供参考。

```
Sub AccessFourthMonth()

Dim cn As ADODB.Connection, rs As ADODB.Recordset, r As Long
    ' connect to the Access database
    Set cn = New ADODB.Connection
    cn.Open "Provider=Microsoft.Jet.OLEDB.4.0; " & _
        "Data Source=C:\Users\Kent\Documents\MBA\Winter 2009 Semester\MBA 614\Final Project\shilded\testdatabase.mdb"

' open a recordset
Set rs = New ADODB.Recordset

rs.Open "CoversheetTableFourthAttempt", cn, adOpenKeyset, adLockOptimistic, adCmdTable
' all records in a table
r = 2 ' the start row in the worksheet

Do While Len(Range("A" & r).Formula) > 0
' repeat until first empty cell in column A
    With rs

        .AddNew ' create a new record
        ' add values to each field in the record
        .Fields("Project") = Range("A" & r).Value
        .Fields("Description") = Range("B" & r).Value
        .Fields("Amount") = Range("C" & r).Value
        .Fields("Date") = Range("D" & r).Value
        .Update ' stores the new record
    End With
    r = r + 1 ' next row
Loop
rs.Close
Set rs = Nothing
cn.Close
Set cn = Nothing

End Sub 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-18T03:22:56.470

尝试

```
DoCmd.RunSQL "DELETE * FROM TableName" 
```

本文可能会感兴趣：[在 VBA 代码中执行 SQL 语句](http://www.databasejournal.com/features/msaccess/article.php/3505836/Executing-SQL-Statements-in-VBA-Code.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T04:42:03.800

从 Excel 中尝试以下操作：

```
dim cn as adodb.connection
dim cmd as adodb.command
set cn = new adodb.connection
cn.open "put your connection string here"
set cmd = new adodb.command
cmd.commandtype = adcmdtext
cmd.commandtext = "Delete * from myTable"
cmd.activeconnection = cn.connectionstring
cmd.execute 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T18:21:14.220

你的`DoCmd`方法有两个问题。您使用引号开始字符串，但没有包含结束引号。但即使有正确的引用，你`DoCmd`也不会工作，因为 Excel 不知道*CoversheetTableFourthAttempt*是 Access 数据库中表的名称。

您展示了您可以成功地创建到您的 Access 数据库的 ADO 连接。所以我的建议是使用`Execute`连接对象的方法来执行你的SQL语句：

```
cn.Execute "DELETE FROM CoversheetTableFourthAttempt;" 
```

最后，访问[Access 中的问题名称和保留字，](http://allenbrowne.com/AppIssueBadWord.html)以了解为什么*Date*、*Description*和*Project*不是 Access 字段名称的好选择。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T21:08:34.723

DoCmd 是 Access 应用程序内部的，Excel 应用程序无法识别。解决问题的简单方法是从 Excel 本身触发删除查询。

在您的 cn.Open "Provider.. 行之后添加此部分

```
cn.Execute "DELETE * FROM CoversheetTableFourthAttempt" 
```

这应该在填充数据的下一部分运行之前清除表格。

# powershell - 获取powershell以显示可以在驱动器上找到某个文件的所有路径

> ID：762816
> 
> 赞同：6
> 
> 时间：2009-04-18T03:16:31.807
> 
> 标签：powershell

我正在尝试构建一个函数，该函数将向我显示某个文件名所在的所有路径。该函数将采用一个参数，即文件名。结果将是所有路径的列表，或者是一条消息，说明系统上没有这样的文件。

我是 Powershell 的新手，我还没有掌握语法。我试过这个：

```
Get-ChildItem -Path -Include notepad.exe 
```

但这引发了一条错误消息。我目前正在尝试：

```
$i="notepad.exe"

Foreach ($i in Get-ChildItem c:\ -Recurse){echo -Path} 
```

现在开始了，它还在运行，不知道会发生什么，真的。

编辑：回显了大量只说“-Path”的行......

任何人都可以帮助解决这个问题吗？顺便说一下，我正在运行 Powershell 1.0。

因此，为了解释执行此命令时我希望看到的内容，以下是我在查找 *.txt 后所期望的示例：

> C:/foo.txt
> C:/A/foobar.txt
> C:/A1/foo.txt

依此类推，列出我硬盘上所有 .txt 文件的路径。只有路径，每行一个，不需要额外的信息。

编辑2：

我已经做到了。我会把这个问题留给那些在未来寻找这个的人。

我使用的函数是这样的（这个具体的例子会给你一个硬盘上所有 .zip 文件的列表，在需要的地方编辑）：

```
Get-ChildItem -Path c:\ -Include "*.zip" -Recurse -Force -Name > c:\listOfPaths.txt 
```

这在我的 C:\ 文件夹中创建了一个名为 listOfPaths.txt 的文件，其中包含在我的硬盘驱动器的所有子文件夹中以 .zip 结尾的任何文件的所有出现的列表。

没有提到“c：\”位，但我不介意。

编辑3：

感谢 capar 提供更完整的版本。

这是 capar 的代码（或者我是如何让它工作的，因为 Get-Children 在 1.0 中不起作用）

```
Get-ChildItem -Path c:\ -Recurse *.txt | Select-Object -Property FullName 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-18T04:44:06.993

因为是星期五晚上，我决定和 Power Shell 一起玩，看看我能不能帮忙:) 这非常接近你的要求，我认为：

```
Get-ChildItem -Path c:\ -Recurse *.txt | Select-Object -Property FullName 
```

如果有帮助，此命令将列出 Get-ChildItem 返回的任何对象的属性：

```
Get-ChildItem | Get-Member 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T03:41:52.697

ls c:\ -r | ? {$_.name -eq "notepad.exe"}

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-31T08:30:51.653

在 Powershell V3 中也无法识别 Get-Children。如果有人删除了那个坏例子，那就太好了。

作为对任何搜索文件的人的警告：今天的硬盘驱动器上的 C:\ 将需要很长时间才能运行。建议您尽可能缩小搜索范围。由于您的文件夹结构可能包含空格或特殊字符，请使用打字机引号 (") 或撇号 (') 分隔符。

$mylistofffiles = Get-ChildItem -Path 'C:\Windows\Setup\Scripts' -Recurse *.cmd | 选择对象-属性全名

$mylistofffiles

# java - 您会在 Google App Engine 中使用什么 Java 框架？

> ID：762821
> 
> 赞同：9
> 
> 时间：2009-04-18T03:20:54.963
> 
> 标签：java, google-app-engine, frameworks

自从我使用 Java 完成任何网站以来已经有一段时间了，我想知道 Google App Engine 有哪些框架选项。

对于没有真正偏好的人，您会建议什么框架？

我喜欢 Ruby On Rails，并且正在进入 Django，我也喜欢这样。专业上，我是一名 ASP.NET 开发人员，因此我在这方面拥有最丰富的经验，但我希望扩展到其他技术和模式。

如果能有更多的 MVC 经验就好了。

谢谢，马克

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T04:49:29.523

[Spring 框架](http://www.springsource.org "春天框架")有效，尽管您必须确保 commons-logging 不被称为 commons-logging-1.1.1.jar （正如我在 maven 约定中所使用的那样，Google 提供了一个具有相同名称的 jar，并且存在类加载问题结果）。所以，Spring WebMVC 被证实可以工作——这增加了它的姊妹项目[Spring Webflow](http://www.springsource.org/webflow)可以工作的可能性——尽管我不能说我真的很喜欢 Webflow 2 与 Webflow 1 完全不同的地方。

此外，我还没有找到一个真正包含“保存和继续”概念的框架——用户经常喜欢这样做，如果你在自己流。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T10:24:09.360

[Wicket](http://wicket.apache.org/)在 App Engine 上工作，您只需对[配置进行一些调整](http://www.danwalmsley.com/2009/04/08/apache-wicket-on-google-app-engine-for-java/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-12T20:06:27.610

我在 GAE 上与[Vaadin有过不同的经历。](http://vaadin.com)一些应用程序几乎与使用 localhost 一样快，但有时延迟很奇怪。可能取决于您的应用程序部署在哪个服务器上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-16T17:23:55.287

试试ItsNat，[更多信息](http://java.dzone.com/articles/single-page-interface-google)。

* * *

## 回答 #5

> 赞同：-17
> 
> 时间：2009-04-18T05:14:43.817

不要因为一个简单的原因使用它——供应商锁定。

*   服务不满意怎么办？
*   如果您可以在其他地方获得更好的交易（Java 托管）会怎样？
*   如果你想销售你的产品怎么办——你的平台在哪里？
*   如果 Google 认为 App Engine 不值得他们努力并关闭它会怎样？
    *   作为旁注，谷歌已经并将关闭无利可图的服务。一个简单的搜索会发现很多，尤其是在这些艰难时期。
*   你关心供应商锁定吗？

如果您不在乎失去投入的精力和时间，并且可能想要一个平台只是为了玩，那么我想这没关系，但对于任何严重的事情请远离。

# asp.net-mvc - 如何在 ASP.NET MVC 中枚举 formcollection？

> ID：762825
> 
> 赞同：43
> 
> 时间：2009-04-18T03:23:05.020
> 
> 标签：asp.net-mvc, enumerator

如何枚举[ASP.NET MVC](http://en.wikipedia.org/wiki/ASP.NET_MVC_Framework)中 FormCollection (system.web.mvc) 的所有键/值？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-04-18T18:58:39.873

这里有 3 种专门使用 FormCollection 对象的方法。

```
public ActionResult SomeActionMethod(FormCollection formCollection)
{
  foreach (var key in formCollection.AllKeys)
  {
    var value = formCollection[key];
  }

  foreach (var key in formCollection.Keys)
  {
    var value = formCollection[key.ToString()];
  }

  // Using the ValueProvider
  var valueProvider = formCollection.ToValueProvider();
  foreach (var key in valueProvider.Keys)
  {
    var value = valueProvider[key];
  }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T18:48:10.660

```
foreach(KeyValuePair<string, ValueProviderResult> kvp in form.ToValueProvider())
{
    string htmlControlName = kvp.Key;
    string htmlControlValue = kvp.Value.AttemptedValue;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-18T12:46:20.923

```
foreach(var key in Request.Form.AllKeys)
{
   var value = Request.Form[key];
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-05T13:52:26.217

我用这个：

```
string keyname;
string keyvalue;

for (int i = 0; i <= fc.Count - 1; i++)
{
    keyname = fc.AllKeys[i];
    keyvalue = fc[i];
} 
```

希望它可以帮助某人。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-19T16:25:27.250

在 .NET Framework 4.0 中，使用 ValueProvider 的代码是：

```
 IValueProvider valueProvider = formValues.ToValueProvider();
        foreach (string key in formValues.Keys)
        {
            ValueProviderResult result = valueProvider.GetValue(key);
            string value = result.AttemptedValue;
        } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-13T16:55:26.807

在 VB.Net 中：

```
Dim fv As KeyValuePair(Of String, ValueProviderResult)
For Each fv In formValues.ToValueProvider
    Response.Write(fv.Key + ": " + fv.Value.AttemptedValue)
Next 
```

# jquery - JQuery Boxy 插件调整大小和访问

> ID：762828
> 
> 赞同：2
> 
> 时间：2009-04-18T03:25:13.283
> 
> 标签：jquery, plugins

究竟如何调整 Boxy.load() 的大小？我可以使用以下方法调整大小： var tmp = new Boxy(); tmp.resize(40,40);

但如果我再尝试使用 tmp.load('somefile.php'); 它指出 tmp.load 不是函数。我也试过：

var tmp = Boxy.load('somefile.php'); tmp.resize(100,100); // 表示 tmp.resize 不是函数。

使用 Boxy.load() 创建方形窗口后，如何调整其大小。提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-19T03:44:56.037

我通读了文档，我想我明白了：

[http://onehackoranother.com/projects/jquery/boxy/](http://onehackoranother.com/projects/jquery/boxy/)

基本上，您需要在 Boxy.load 的 afterShow 选项中设置回调。

Boxy.load() 不返回实例，因为它是一个ajax调用，所以它立即返回但不能绘制任何东西，所以交回一个Boxy实例是没有意义的。因此，在您的回调中，您将拥有对整个 Boxy 对象的完全访问权限，并且您将能够调用 resize。它看起来像这样：

```
Boxy.load("whereever.html", {
  afterShow: function() {
    this.resize(40,40);
  }
}); 
```

多田！我测试了它，它似乎几乎可以解决问题。它不能很好地处理垂直调整大小，但水平是我所期望的。（但我试图将很多东西塞进窗口，所以它很可能只是重新调整它的大小以适应内容。

# shell - 转义字符串

> ID：762832
> 
> 赞同：5
> 
> 时间：2009-04-18T03:40:47.317
> 
> 标签：shell, scripting, escaping

我正在编写一个 shell 脚本，我想转义一个字符串。有什么办法可以转换这个：

```
I'm happy.
You're sad. 
```

至

```
I\'m happy.\nYou\'re sad. 
```

我很确定有一些`sed`/的组合`awk`可以做到这一点....

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2015-11-16T09:15:56.343

您可以为此使用纯 Bash（请参阅[http://tldp.org/LDP/abs/html/string-manipulation.html](http://tldp.org/LDP/abs/html/string-manipulation.html)）。

就像是：

```
#!/bin/bash
X="I'm happy.
You're sad."
echo "========== BEFORE =========="
echo "${X}"
echo "========== AFTER ==========="
X="${X//\'/\\\'}"
X="${X//$'\n'/\\n}"
echo "${X}"
echo "============================" 
```

将产生输出：

```
========== BEFORE ==========
I'm happy. You're sad.
========== AFTER ===========
I\'m happy.\nYou\'re sad.
============================ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T03:49:47.513

尝试

```
sed 's/\\ /\\n/g' | sed 's/\\'/\\\'/g' 
```

我可能在这里搞砸了一些`\`。最好的方法是自己尝试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T03:49:50.913

这适用于`'`替换`\'`。

```
echo "I'm happy. You're sad" | sed "s/'/\\\'/g" 
```

您确定要替换“快乐”之间的空格吗？和“你”有一个`\n`？ `\n`是换行符，但您的原始行似乎没有换行符。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T05:44:34.320

我认为这可以满足您的需求。命令中操作的顺序`sed`非常关键。请注意，这也处理字符串中的反斜杠（以及单引号）（我的 PS1 提示符是`Osiris JL:`）：

```
Osiris JL: cat zzz
xxx="I'm happy.
You're sad."
yyy=$(echo "$xxx" | sed 's/[\'\'']/\\&/g;s/$/\\n/;$s/\\n$//')
echo "$xxx"
echo $xxx
echo "$yyy"
echo $yyy
#eval echo $yyy
#eval echo "$yyy"
Osiris JL: sh zzz
I'm happy.
You're sad.
I'm happy. You're sad.
I\'m happy.\n
You\'re sad.
I\'m happy.\n You\'re sad.
Osiris JL: 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-08-08T13:03:35.413

这是我使用的解决方案`awk`：

```
$ awk '{$1=$1}1' FS=\' OFS="\\\'" ORS='\\n' <<< "I'm happy.
You're sad." 
```

这导致输出

```
I\'m happy.\nYou\'re sad.\n 
```

**解释：**

我将字段分隔符 ( `FS`) 设置为`'`（将其转义为`shell`as `\'`）并将*输出*字段分隔符 ( `OFS`) 设置为`\'`（包裹`"..."`以转义`'`for the`shell`并转义`\`两次，一次用于 the `shell`，第二次用于`awk`, as `"\\\'"`）。如果没有其他选项，记录分隔符 ( `RS`) 是换行符，但我将*输出*记录分隔符 ( `ORS`) 设置为`\n`（再次转义`\`for `awk`as `\\n`）。

现在剩下要做的唯一事情`awk`是重新计算每条记录（通过设置`$1`为`$1`，没有任何变化，但`awk`认为记录已更改，有效地替换`FS`为`OFS`und 因此每个`'`by `\'`）并打印每条记录（这是`1`模式所做的：`1`对所有记录都是正确的，并且由于没有给出任何操作，因此执行标准操作`{print $0}`），有效地替换`RS`为`ORS`，因此每个换行符都替换为`\n`。

# c++ - 指针问题 2 [有效的 C++ 语法]

> ID：762833
> 
> 赞同：0
> 
> 时间：2009-04-18T03:40:59.377
> 
> 标签：c++, pointers

这个版本正在运行。我在`//`整个代码中都做了评论，以更好地说明我遇到的问题。该程序依赖于读取文本文件。以包含标点符号的段落格式。

可以将这个和上面的内容复制到一个文本文件中并运行该程序。

// Word.cpp

```
#define _CRT_SECURE_NO_WARNINGS // disable warnings for strcpy
#define ARRY_SZ 100
#include <iostream>
#include <fstream>
#include "Word.h"

using namespace std;

Word::Word( const char* word )
{
    ptr_ = new char[ strlen( word ) + 1 ];
    strcpy( ptr_, word  );  
    len_ = strlen( ptr_ );
}

Word::Word( const Word* theObject ) 
{
    ptr_ = theObject->ptr_;
    len_ = theObject->len_;
}

Word::~Word()
{
    delete [] ptr_;
    ptr_ = NULL;
}

char Word::GetFirstLetterLower()
{
    // I want to use ptr_ and len_ here
    // but the information is gone!
    char c = 0;
    return c;
}

char* Word::GetWord()
{
    for (int x = 0; x < strlen( (char*)ptr_ ); x++)
        ptr_[x];  // Results in a crash.

    return ptr_;
} 
```

// Word.h

```
const int FILE_PATH_SZ = 512;
class Word
{
private:
    char* ptr_;
    int len_;
public:
    Word( const Word* ); // an appropriate default constructor
    Word( const char* );
    ~Word( );
    char GetFirstLetterLower( );
    char* GetWord( );
    static char fileEntry[ FILE_PATH_SZ ];
}; 
```

// main.cpp

```
#ifdef  _DEBUG
#define _CRTDBG_MAP_ALLOC
#include <iostream>
#include <fstream>
#include <string>
#endif
#include "Word.h"
using namespace std;

const int WORD_SZ = 100;
Word** g_wordArray;
int g_arrSz;

static char filePath[ FILE_PATH_SZ ] = {};
void FreeWordArray();

int main( const int argc, const char **argv )
{
    int     wrdCount = 0;
    char    usrMenuOption     = 0,
            getFirstLetter          = 0,
            tmpArray[WORD_SZ] = {},
            *getWord = 0;
    string  str, 
            str2;
    ifstream  inFile, 
              inFile2;

    do 
    {
        cout << "Please make a selection: \n\
a) Read a text file\n\
b) Remove words starting with letter\n\
c) Print words to console\n\
d) Quit\n";
        cin  >> usrMenuOption;
        switch( usrMenuOption )
        {
            case'A':
            case'a':
                cout << "Enter a file name: ";
                cin.sync();
                cin  >> filePath;
                inFile.open( filePath );
                if ( !inFile ) return -1;
                inFile >> str; // prime the eof flag
                while ( !inFile.eof() )
                {        
                    inFile >> str;
                    wrdCount++;
                    g_wordArray = new Word *[wrdCount];
                }
                inFile.close();
                inFile2.open( filePath );

                while( !inFile2.eof() )
                {
                    inFile2 >> str2;
                    for ( unsigned x = 0; x < str2.length(); x++ )
                    g_wordArray[x] = new Word( str2.c_str() );
                }
                cout << wrdCount << " Words read from the file " << endl;
                inFile2.close();
                break;
            case'B':
            case'b':
                getFirstLetter = g_wordArray[wrdCount]->GetFirstLetterLower();
                //getWord = g_wordArray[wrdCount]->GetWord();
                cout << getWord << endl;
                break;
            case'C':
            case'c':
                break;
            case'D':
            case'd':
                cout << "Quit Requested. " << endl;
                break;
            default:
                cout << '"' << usrMenuOption << '"' << " Not Defined! " << endl;
        }
    } while (usrMenuOption != 'D' && usrMenuOption != 'd');

#ifdef _DEBUG
    _CrtDumpMemoryLeaks();
#endif
    cin.ignore();
    return 0;
}

void FreeWordArray()
{
    // free the memory that is allocated
    return;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-18T03:56:52.490

**编辑：**我将此编辑放在顶部，因为它直接回答了您关于 Word 为何损坏的问题。您的复制构造函数是错误的：

```
Word::Word( const Word* theObject ) 
{
    ptr_ = theObject->ptr_;
    len_ = theObject->len_;
} 
```

这不会复制`theObject->ptr_`指向的内容，只是指针。所以你实际上有两个`Word`对象指向同一个内部字符串。当 Word 对象被删除时，这会变得非常糟糕。一个正确的实现（使用你所做的技术，我建议反对它们）将是这样的：

```
Word::Word( const Word* theObject ) 
{
    ptr_ = new char[theObject->len_ + 1 ];
    strcpy( ptr_, theObject->ptr_  );  
    len_ = theObject->len_;
} 
```

**编辑：** Earwicker 还注意到以下内容：

> ...虽然“复制构造函数”不是复制构造函数。所以编译器生成的仍然存在，并且执行相同的成员复制，因此同样的问题仍然存在。

为了解决这个问题，您需要创建一个正确的复制构造函数，它应该具有原型：

```
Word::Word(const Word &theObject); 
```

这里还有这段代码：

```
while ( !inFile.eof() )
{        
    inFile >> str;
    wrdCount++;
    g_wordArray = new Word *[wrdCount];
} 
```

像筛子一样漏！您在读取**每个**`g_wordArray`单词后重新分配并且完全忘记删除前一个单词。我将再次使用您尝试使用的技术展示一个理智的实现。

 **```
while (inFile >> str)
{        
    inFile >> str;
    wrdCount++;
}
g_wordArray = new Word *[wrdCount]; 
```

注意它是如何计算单词的，然后在它知道要分配多少之后分配空间**一次。**现在`g_wordArray`已准备好用于最多`wrdCount`word 对象。

**原始答案：**

你为什么不直接用 替换`Word`类`std::string`？这将使代码更小，更容易使用。

如果它让您更轻松，请执行以下操作：

```
typedef std::string Word; 
```

那么你可以这样做：

```
Word word("hello");
char first_char = word[0]; 
```

此外，它还有一个额外的好处，就是您无需使用`.c_str()`成员来获取 c 样式的字符串。

**编辑：**

我也会把你`g_wordArray`的变成一个`std::vector<Word>`. 这样你就可以简单地做到这一点：

```
g_wordArray.push_back(Word(str)); 
```

没有更多的动态分配！这一切都为你完成。字数组的大小将仅受您拥有的 RAM 数量的限制，因为`std::vector`当您使用`push_back()`.

此外，如果你这样做......猜猜得到字数你只需这样做：

```
g_wordArray.size(); 
```

无需手动跟踪它们的数量！

**编辑：**

此外，此代码已损坏：

```
while( !inFile2.eof() )
{
    inFile2 >> str2;
    ...
} 
```

因为直到您尝试读取后才设置 eof，所以最好使用此**模式**：

```
while(inFile2 >> str2)
{
    ...
} 
```

这将在 EOF 上正确停止。

**最重要的是，如果你做得对，你需要编写的实际代码应该很少。**

**编辑：**

这是我认为您想要的示例直接实现。从菜单项看来，用户的意图似乎是首先选择选项“a”，然后选择“b”零次或多次以过滤掉一些单词，然后最后 c 打印结果（每行一个单词）。此外，实际上并不需要选项“D”，因为点击`Ctrl+D`会向程序发送 EOF 并使“ `while(std::cin >> option)`”测试失败。从而结束程序。（至少在我的操作系统中，Windows 可能是 Ctrl+Z`）。

它也没有努力（你也没有）处理标点符号，但这里是：

```
#include <string>
#include <vector>
#include <fstream>
#include <iostream>
#include <algorithm>
#include <functional>
#include <iterator>

struct starts_with : public std::binary_function<std::string, char, bool> {
    bool operator()(const std::string &s, char ch) const {
        return s[0] == ch;
    }
};

void print_prompt() {
    std::cout << "Please make a selection: \na) Read a text file\nb) Remove words starting with letter\nc) Print words to console" << std::endl;
}

int main( const int argc, const char **argv) {
    std::vector<std::string> file_words;
    char option;
    print_prompt();
    while(std::cin >> option) {
        switch(option) {
        case 'a':
        case 'A':
            std::cout << "Enter a file name: ";
            // scope so we can have locals declared
            {
                std::string filename;
                std::string word;
                std::cin >> filename;
                int word_count = 0;
                std::ifstream file(filename.c_str());
                while(file >> word) {
                    file_words.push_back(word);
                }
                std::cout << file_words.size() << " Words read from the file " << std::endl;
            }
            break;
        case 'b':
        case 'B':
            // scope so we can have locals declared
            {
                std::cout << "Enter letter to filter: ";
                char letter;
                std::cin >> letter;

                // remove all words starting with a certain char
                file_words.erase(std::remove_if(file_words.begin(), file_words.end(), std::bind2nd(starts_with(), letter)), file_words.end());
            }
            break;          

        case 'c':
        case 'C':
            // output each word to std::cout separated by newlines
            std::copy(file_words.begin(), file_words.end(), std::ostream_iterator<std::string>(std::cout, "\n"));
            break;
        }
        print_prompt();
    }
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T04:01:16.580

在没有遍历整个 main.cpp 的情况下，我确实在构造函数/析构函数集中注意到了一个问题：

```
Word::Word( const Word* theObject ) 
{
    ptr_ = theObject->ptr_;
    len_ = theObject->len_;
}

Word::~Word()
{
    delete [] ptr_;
    ptr_ = NULL;
} 
```

请注意，在您的复制构造函数中，您只需分配内部指针以匹配您从中复制的对象。但是在您的析构函数中，您删除了内部指针处的数据。

这就是它可能会变得丑陋的地方：

```
Word w1 = Word("hello");
Word w2 = Word(w1);
delete w2; 
```

现在，你的第一个词包含什么？指针会存在，但它引用的数据在`w2`的析构函数中被删除。

他们称其为“复制构造函数”，因为这就是您应该做的：*复制*事物。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T03:59:49.517

是`g_wordArray[wrdCount]`有效的 Word 对象吗？我的 C++ 生锈了，但在我看来，这超出了数组的末尾。此外，您似乎在反复践踏`g_wordArray`inFile2 循环中的内容：对于您读入 str2 的每个字符串，您将重新初始化`g_wordArray`. 这可以解释成员变量的明显破坏。最后，我不确定这一点，但是在您将新值读入 str2 后，str2.c_str() 返回的指针是否仍然有效？因此，您的 GetWord() 循环可能会从 strlen 获取垃圾值，然后滚落到永远不会着陆。

# c# - 在自定义操作中获取 setup.exe 的位置

> ID：762834
> 
> 赞同：1
> 
> 时间：2009-04-18T03:41:04.790
> 
> 标签：c#, installation, custom-action

C# 2005

我正在使用安装程序类，因为我需要一个将读取 xml 配置文件的自定义操作。

所以当用户双击设置时，在同一个文件夹中会有一个 config.xml 文件。我想在安装事件中阅读此 config.xml 文件。该文件夹将包含 setup.exe 和 config.xml

但是，它无法找到 config.xml 文件，因为它正在 C:\windows\system32 下寻找它。我通过使用 applicationstartup.path 发现了这一点。但是，包含 setup 和 config.xml 的 setup 文件夹位于我的桌面上。

我以为它会在当前位置寻找它。这将是设置文件夹。

困难在于我的安装文件夹将从 Internet 下载，任何用户都可以下载它并将其解压缩到计算机上的任何位置。

这是我安装事件的代码片段。

非常感谢您的任何建议

```
protected override void OnAfterInstall(System.Collections.IDictionary savedState)
    {
        DataTable dt = new DataTable();
        MessageBox.Show(Application.StartupPath.ToString());
        dt.ReadXml("config.xml");

        MessageBox.Show(base.Context.Parameters["CAT_TargetDir"].ToString());
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-19T03:11:24.133

假设您在谈论 MSI，那不是[OriginalDatabase](http://msdn.microsoft.com/en-us/library/aa370562(VS.85).aspx)属性吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-01T22:07:41.087

假设您没有输入错误`CAT_TargetDir`，而是`TARGETDIR`可以执行以下解决方法：设置 CustomActionData 并将 TARGETDIR 作为参数传递给您的自定义操作。这不是最优雅的解决方案，但它应该很容易工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-15T10:43:32.123

我设法解决了这个问题。

答案就是写一个简单的 bat 文件来为我完成所有的工作。然后 bat 文件将调用 setup 并安装应用程序。

谢谢，

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-19T15:46:36.613

你也可以试试这个：[我需要一个从 MSI 源目录复制文件的 MSI 自定义操作](https://stackoverflow.com/questions/368154/i-require-a-msi-custom-action-that-copies-a-file-from-the-msi-source-directory/2094661#2094661)

# javascript - Javascript CANVAS 是如何工作的？

> ID：762836
> 
> 赞同：2
> 
> 时间：2009-04-18T03:43:30.773
> 
> 标签：javascript, canvas

Javascript CANVAS 很棒：它允许我们在浏览器屏幕上绘制线条、多边形之类的东西。

我想知道 Javascript CANVAS 是如何工作的。例如画一条线，它是使用一系列对齐的小图像来模拟这条线还是其他方法？

提前致谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-18T03:55:54.020

任何合理的实现者只会使用位图（内部存储在浏览器中），并使用 OS 本机绘图命令绘制到该位图。

为什么这有关系？如果您想知道的话，它与 HTML+CSS 完全无关。

更详细，为详细起见：

当浏览器的 HTML 解析器看到一个画布元素（具有给定的宽度和高度）时，它需要分配一个屏幕像素图来覆盖该区域。它要么手动执行此操作（即 malloc()），要么调用某些 OS 本机绘图 API 以创建要在其上绘图的表面。操作系统原生 API 可以是 Windows、Gtk、Kde、Qt 或浏览器实现者选择的任何其他绘图库。此外，它高度依赖于操作系统。Internet Explorer 可能会调用一些 Windows 本地库（即 DirectX 或 WinFooBarMethod()）。

一旦创建了绘图表面，JavaScript 解释器的内部就可以访问它，可能是通过指向所构建绘图表面的指针或句柄。然后，当 JS 解释器看到对其中一个画布方法的调用时，它会将其转换为对相应操作系统本机命令的调用。

因此，使用 Windows 3.1 风格的比喻：

```
"new canvas(width, height)" = "WinCreatePixmap(width, height)" 
"canvas.setPixel(x,y,color)" = "WinSetPixel(x,y,color)" 
```

并使用手动管理的像素图：

```
"new canvas(width, height)" = "malloc(width * height * sizeof(Pixel))"
"canvas.setPixel(x,y,color)" = "canvas[x][y] = color;" 
```

同样，对于 JavaScript 开发人员来说，如何实现这些方法并不重要。唯一需要关心的是那些正在编写支持画布的 HTML5 兼容 Web 浏览器的人。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-12-15T18:35:32.253

如果你知道 C++，你可以去源码。

例如，在 Firefox 中，“图形上下文”对象由类实现[`nsCanvasRenderingContext2D`](http://hg.mozilla.org/mozilla-central/file/d5c0ef71be03/content/canvas/src/nsCanvasRenderingContext2D.cpp#l1501)。但该类实际上并没有直接修改像素。相反，它要求一个名为 Thebes 的单独对象来执行此操作。Thebes 又将这项工作委托给名为[Cairo](http://www.cairographics.org/)的图形库，该库通常要求操作系统提供的库来执行实际的像素工作。我想到处都是类似的故事。

在最底部，画布有一个二维像素数组。每个像素都是一个 32 位整数。通过将值分配给数组的元素来设置像素。某处有一些代码可以确定要绘制哪些像素并将适当的值分配给适当的数组元素。

从理论上讲，像素可能是由您的显卡绘制的，但我听说显卡通常不能被信任来执行 2D 图形，因为硬件针对 3D 游戏进行了积极的调整，并且牺牲了太多的准确性来换取速度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-20T20:19:52.247

你想多了，很简单：

画布就像可以在浏览器上绘制的图像。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T03:44:39.040

这肯定是特定于~~JavaScript 引擎~~浏览器的实现吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T04:11:32.203

如果您对线条绘制的工作原理感兴趣，请查看[Bresenham 的线条绘制算法](http://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-15T18:18:25.833

我认为执行很重要。为什么这有关系？看闪光。当您使用绘图 API 创建复杂的分形图稿时，它实际上是在创建矢量图稿并使每条线和曲线成为所绘制对象的子图，因此它每帧都会重新渲染矢量图图。崩溃！或突突……突突……突突……所以对于复杂的分形或记录方程式的艺术，我必须使用位图或渲染引擎 CACKS . 它确实有所作为，因为现在我正在尝试将我的一些 Flash 多媒体传输到 Javascript 并遇到浏览器之间的差异。

# javascript - xpath 油脂猴

> ID：762844
> 
> 赞同：0
> 
> 时间：2009-04-18T03:50:50.677
> 
> 标签：javascript, greasemonkey

我正在尝试在greasemonkey 脚本中修改gmail。使用 xpather，我可以获得我想要隐藏的部分的 xpath 表达式。但是使用以下代码段我无法匹配。永远不会调用警报函数。谁能指出我做错了什么？

```
var allLinks, thisLink;
allLinks = document.evaluate(
     "//html/body/div[1]/div/div/div[1]/div/div[3]/div[1]/div[2]/div[2]/div[1]/div[1]",
     document,
     null,
     XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,
     null);
for (var i = 0; i < allLinks.snapshotLength; i++) {
  thisLink = allLinks.snapshotItem(i);
  alert("found");
} 
```

@艾伦风暴

我安装了firebug，使用控制台测试了它的脚本，但我仍然无法让它在greasemonkey下工作。Greasemonkey 仍然没有给我一个警告框。我还尝试添加一个加载事件侦听器，但也没有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T06:58:34.953

首先，一般调试技巧，然后刺你的问题。

请记住，Greasemonkey 脚本只是 javascript，您仍然可以使用所有可用的 Javascript 工具来调试您的问题。打开 gmail，启动[Firebug](http://www.getfirebug.com)，然后尝试直接在命令行上运行您的 javascript 代码（单击控制台行右侧的向上圆圈箭头以获得更大的输入区域）。

当我对您的 javascript 片段执行上述操作时， allLinks.snapshotLength 的计算结果为 0，表明您的 xpath 表达式不匹配任何内容。这很奇怪，因为当我使用[XPath Checker](https://addons.mozilla.org/en-US/firefox/addon/1095)时，它与徽标相匹配。

再深入一点，看起来 gmail 的主文档是许多 iframe，而 iframe 包含实际的应用程序元素。具体来说，有一个 ID 为“canvas_frame”的框架，其中包含应用程序界面的实际 DOM。当我尝试

```
canvas = window.frames[document.getElementById('canvas_frame').name].document;
allLinks = canvas.evaluate(
     "//html/body/div[1]/div/div/div[1]/div/div[3]/div[1]/div[2]/div[2]/div[1]/div[1]",
     canvas,
     null,
     XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,
     null); 
```

我得到一个长度为 1 的响应，这可能更适合您的需求。

最后，这不是必需的，但您的 xPath 表达式看起来有点脆弱。如果 gmail 稍微改变了文档结构（例如，使用包装器 div），您的程序就会中断。考虑这样的事情。

```
<!-- 
all divs on the page that contains an h1 element 
that contains the text "Gmail Logo" 
-->
//div[contains(./h1,"Gmail Logo")] 
```

# javascript - 如何让 Ajax 表单提交在 ASP.net MVC 中工作？

> ID：762845
> 
> 赞同：2
> 
> 时间：2009-04-18T03:55:39.030
> 
> 标签：javascript, asp.net-mvc, ajax, form-submit

我对 AJAX 和 Javascript 世界很陌生，我正在尝试实现[Scott Hanselman 的](http://www.hanselman.com/blog/ASPNETMVCPreview4UsingAjaxAndAjaxForm.aspx)表单提交示例以更新页面的一部分。我几乎逐字逐句地复制了他的例子，但我似乎无法让它发挥作用。当我单击提交按钮时，控制器操作被成功调用，但结果在浏览器中呈现为新页面，而不是仅更新我在 Ajax 表单中指定的范围。

这是我的视图代码：

```
<asp:Content ID="indexHead" ContentPlaceHolderID="head" runat="server">
    <title>Home Page</title>
</asp:Content>

<asp:Content ID="indexContent" ContentPlaceHolderID="MainContent" runat="server">

    <% using (Ajax.BeginForm("TestAction", new AjaxOptions { UpdateTargetId = "target" }))
       { %>

        <%= Html.TextBox("TextBox")%>
        <input type="submit" value="Submit" />
        <span id="target" />

    <% } %>

</asp:Content> 
```

我的控制器动作：

```
 public string TestAction(string TextBox)
    {
        return TextBox;
    } 
```

我在母版页中包含了以下几行

```
<script src="../../Scripts/MicrosoftMvcAjax.debug.js"type="text/javascript"></script>  
<script src="../../Scripts/MicrosoftMvcAjax.js" type="text/javascript"></script> 
<script src="../../Scripts/MicrosoftAjax.js" type="text/javascript"></script> 
```

但它似乎所做的只是调用动作并将结果呈现为新页面，而不是更新目标跨度。这里有一些小屏幕截图来说明正在发生的事情。

[截图 1 http://martindoms.com/scr1.JPG](http://martindoms.com/scr1.JPG)

[截图 2 http://martindoms.com/scr2.JPG](http://martindoms.com/scr2.JPG)

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T05:36:42.703

您的母版页中包含的 javascript 顺序错误。重新排序以使 MicrosoftAjax.js 包含在这三个中的第一个并且它将起作用。

```
<script src="../../Scripts/MicrosoftAjax.js" type="text/javascript"></script>
<script src="../../Scripts/MicrosoftMvcAjax.js" type="text/javascript"></script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T04:27:25.583

只是抛出一些想法在那里......

[http://www.asp.net/learn/MVC/tutorial-33-cs.aspx](http://www.asp.net/learn/MVC/tutorial-33-cs.aspx)

您的控制器操作在这样定义的类中？

```
public class MyController : Controller 
```

显然，类的名称必须以单词控制器结尾。

# c++ - C/C++ 替换/重定义规则？

> ID：762852
> 
> 赞同：1
> 
> 时间：2009-04-18T04:01:06.113
> 
> 标签：c++, operator-overloading, new-operator, replace

我对 C/C++ 并不是特别陌生，但今天我发现了一些我没想到的东西。这在 gcc 中编译：

```
 /* test.c */
#include <stddef.h> // !

typedef unsigned long int size_t; // NO ERROR
typedef unsigned long int size_t; // NO ERROR

int
main(void)
{
  typedef unsigned long int size_t; // NO ERROR
  return 0;
} 
```

这不会：

```
 /* test.c */
#include <stddef.h>

typedef unsigned long int size_t; // NO ERROR
typedef unsigned long int size_t; // NO ERROR

int
main(void)
{
  typedef unsigned long int size_t; // NO ERROR
  typedef unsigned long int size_t; // ERROR
  return 0;
} 
```

这也不是：

```
 /* test.**h** */ // ! header
typedef unsigned long int size_t;
typedef unsigned long int size_t; // ERROR 
```

同样在 g++ 中编译：

```
 /* test.h */ // ! header
#include <cstddef>

inline void* operator new(size_t, void* p) throw() { return p; } 
```

这不会：

```
 /* test.h */ // ! header
#include <new> // !

inline void* operator new(size_t, void* p) throw() { return p; } // ERROR 
```

这样做：

```
 /* test.cc */
#define _NEW

#include <new> // !
#include <iostream>
#include <cstdlib>

using std::cout;
using std::endl;

inline void* operator new(size_t size) throw() // NO ERROR EXPECTED
{
  cout << "OPERATOR NEW CALLED" << endl;
  return malloc(size);
}

inline void* operator new(size_t, void* p) throw() // NO ERROR
{
  cout << "PLACEMENT NEW CALLED" << endl;
  return p;
}

int main()
{
  char *buffer[4];
  int *i = new (buffer) int;
  int *j = new int;
  return 0;
} 
```

（替换标准的 new 操作符在上述所有情况下都有效。替换替换的 new 操作符是非法的，我知道。）

很容易看到一种模式，但是有人可以给我一个“标准”的解释吗？为什么我可以在 .c 或 .cc 文件中做我在 .h 文件中不能做的事情（重新定义旧的 typedef，替换非法替换的函数）？

* * *

谢谢回复。我省略了一些代码，包括标题保护。在最后一个 .cc 示例中，我将 HTML 编码为 << 为 & gt ；> 错误地忘记包含 cstdlib。我已经修复了代码，所以它可以编译。然而，我忽略的另一件事是#define _NEW，它被证明是至关重要的。显然在 GNU 中，<new> 的标头保护定义了 _NEW，所以我在这里定义它阻止了标准新标头的包含，所以我替换工作了

```
m@m:~/Desktop/Library$ ./a.out
安置新呼叫
操作员新呼叫

```

所以，是的，唯一无法解释的是我为什么可以在 .c/.cc 文件中多次重新键入定义内容，但不能像这样在 .h 中重新键入：

```
/* test.c */
#include <stddef.h>

typedef unsigned long int size_t; // NO ERROR
typedef unsigned long int size_t; // NO ERROR

int
main(void)
{
  typedef unsigned long int size_t; // NO ERROR
  return 0;
} 
```

反正我也不想那样做，只是想知道。

编辑：谢谢，这真的回答了所有问题。将其更改为 xyz 不允许在给定范围内进行多个定义，这感觉不错。:) 我做这些小测试的原因是我正在为一个小型操作系统编写 C 和 C++ 的一个子集，但是由于我使用现有的库而没有删除任何东西来帮助我进行测试，所以我正在尝试弄清楚如何确保（1）我的代码在测试中被调用（例如我的新位置）和（2）我的代码不会与 GNU 库发生冲突。（1）的答案现在看起来很明显。我只是将标准 Xh 中的标头保护宏#define 到我的 Xh 中:)。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T05:10:09.613

在 MacOS X 10.4.11（古老的 - 但计算机也是如此）上使用 GCC 4.0.1，带有“test.h”的示例有效 - 或者我对它的改编。看来您可以拥有任意数量的（相同的）“size_t”全局类型定义 - 我有 5 个版本为`stddef.h`.

main 中的第一个 typedef 显然是合法的；它是一个新的范围，可以为名称定义新的含义。

C99 基本原理说：

> 在 C89 中，可以在内部块中使用显式包含类型名称的声明重新声明 typedef。该规则避免了是否将 typedef 作为类型名称或重新声明的候选者的歧义。在 C99 中，不允许隐式 int 声明，因此这种歧义 [原文如此！] 是不可能的，并且不再需要该规则。

稍后，在讨论标准标头时，它还说：

> C89 委员会决定让库头文件“幂等”，也就是说，它们应该可以包含任意次数，并且可以以任意顺序包含。这一要求反映了广泛的现有实践，可能需要在标头中进行一些保护性包装，以避免例如重新定义 typedef。为了确保可以使这种保护性包装起作用，并确保 typedef 的正确范围，标准头文件只能包含在任何声明之外。

因此，很明显，`typedef`通常不允许在单个范围（例如文件范围）中重新定义 a。因此，我认为，多个外部重新定义`size_t`可能是 GCC 的一个特性或一个错误 - 实际上是一个特性。

如果您更改`size_t`为`xyz`，则会收到更多错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T04:27:33.773

我不确定`typedef`在您的情况下多个 s 是如何编译的。请记住，标头不会自行编译，而是与实现类一起编译。此外，您的标头缺少标头保护或`#pragma once`指令。您正在使用哪些选项？

至于放置`new`- 标准（18.5.1.3）明确禁止 - 所以这是行不通的。

这里没有模式——除了重新定义已经声明的符号。

顺便说一句：您的示例`.c`或示例均未使用[Comeau](http://www.comeaucomputing.com/pcgi-bin/compiler.cgi)`.cpp`编译。

# php - PHP 开发的一些最佳模式和实践是什么？

> ID：762855
> 
> 赞同：22
> 
> 时间：2009-04-18T04:02:31.413
> 
> 标签：php

我主要是在与 mysql 一起工作时寻找良好的开发实践。我搜索了这些问题，但找不到任何相关问题。如果有人分享他们从经验中获得的实践和智慧，我将不胜感激。

除了一些编码标准，我也在寻找设计标准和常见的架构实践。

背景：我的职业生涯始于 Java，多年来我转向 C#/.NET 领域。我已经从事建筑师工作 3 年多了。只是添加了这个给人们一些想法。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-18T07:34:15.727

我建议你熟悉一下 PHP 的历史，我知道这样做让我对 PHP 的今天和它的起源有了更大的了解。

简而言之，PHP 是由 Rasmus Lerdorf 编写的，旨在为实际执行繁重工作的 C 代码提供简单的包装函数，以便他可以使用更简单的语言/语法来编写需要动态运行的模板。PHP 和围绕它的社区的发展最好被描述为有机的。就像其他有机生长的东西一样，它不仅仅是有点凌乱、不对称和完全不一致。

一旦您了解了 PHP 及其社区，您就需要接受 PHP 的所有内容和所有内容。这个想法最好由 Terry Chay 在他的文章[PHP without PHP](http://terrychay.com/blog/article/php-without-php.shtml)中提出。他特别谈到了时髦缓存的概念，但他抓住了 PHP 编码的概念，就好像它是 PHP 而不是（在此处插入最喜欢的语言）比我见过的任何人都好。换句话说，不要试图将 PHP 变成 Java、C#、Ruby 等，因为如果你这样做了，你会失败，你会讨厌你的生活。

看看 [PHP 是如何以正确的方式完成的？](https://stackoverflow.com/questions/694246/how-is-php-done-the-right-way).

我必须说，您必须首先、最后并始终避免大多数初级 PHP 开发人员使用意大利面条代码反模式的倾向。换句话说，如果你发现你正在编写包含 sql 查询、数据操作、数据验证和 html 输出的代码，所有这些都在一个 php 脚本中，那么你做错了。

为了避免这种情况，了解一些关于面向 Web 的设计模式的本质是有帮助的。这当然排除了对面向对象编程的熟悉。但是，一旦您学习了 PHP 中面向对象编程的基础知识，就可以学习 MVC 设计模式。您不必完全实现这一点，但使用 Model-View-Controller 的基本思想可以避免大多数新手倾向于创建的 blob 脚本问题。

在这一点上，我强烈建议您对在网络上找到的任何代码片段持保留态度。即使你在一本书中找到它，你也必须考虑这本书的年代。PHP 作为一门语言已经取得了相当长的进步，你不能只从表面上获取代码样本，因为根据他们的年龄，他们可能使用在 3.x 或 4.x 中有效但不再适用的变通办法需要更新的功能。

要做的一件好事是研究那里的各种框架。评估你喜欢什么和不喜欢什么。甚至可以编写框架文档提供的每个快速入门，以便您可以开始了解自己喜欢和不喜欢什么。我强烈建议您查看框架以及其他几个开源项目中的代码，以便您了解其他人如何使用 PHP 做事。再一次，对这一切持保留态度，因为每个 PHP 开发人员都有自己的烦恼和细微差别，而且我们没有一个人总是正确的。事实上，大多数时候使用 PHP 会有几种非常好的方法来做某事。

如果您想更好地了解框架正在实现的模式，并且通常在 SO 的普通白话中被抛出，我建议您阅读[Fowler](https://rads.stackoverflow.com/amzn/click/com/0321127420)和[GoF](https://rads.stackoverflow.com/amzn/click/com/0201633612)。他们将教授您将在开发工作中使用的所有基本设计模式。

具体注意以下几点：

*   包含大量函数的函数文件。这很可能代表需要将函数直接放在需要它们的脚本中，或者它也可能表明有机会创建一些更通用的函数，这些函数可以用来完成几个高度特定的函数的角色。当然，如果你正在构建有凝聚力、封装良好的类，你不应该遇到这个问题。
*   无所不能的课。这是一个 blob 反模式，非常讨厌。在这种情况下，您需要确定内聚和封装在哪里崩溃，并利用这些点将类分解为几个更小、更易维护的类。
*   不使用参数化查询或至少转义参数的 SQL 查询。非常非常非常糟糕。
*   未执行验证或仅在客户端执行验证的任何实例。在为 Web 开发时，确保您的网站和用户安全的唯一方法是假设其他人都是黑帽。
*   突然对使用模板引擎的痴迷。PHP 是一种模板语言。在使用模板引擎之前，请确保您有明确的理由在您的网站上添加另一层。

如需进一步阅读，请查看以下内容：

[PHP Application Design Patterns](https://stackoverflow.com/questions/548399/what-php-application-design-design-patterns-do-you-use)
[Defend PHP](https://stackoverflow.com/questions/309300/defend-php-convince-me-it-isnt-horrible) -- 有助于让您了解最常见的批评。
[strip_tags 和 mysqlirealescapestring 的安全性](https://stackoverflow.com/questions/585358/security-of-striptags-and-mysqlirealescapestring/)
[每个 PHP 程序员应该知道什么](https://stackoverflow.com/questions/306497/what-should-every-php-programmer-know/)
[如何构建 ORM](https://stackoverflow.com/questions/598332/how-would-an-orm-framework-in-php-be-structured/)
[组织类层次结构的最佳方法](https://stackoverflow.com/questions/220347/best-way-to-organize-php-class-heirarchy/)
[PHP 应用程序的主要组件/层](https://stackoverflow.com/questions/548378/what-are-the-main-components-layers-of-a-php-application/)
[为什么使用 PHP 框架](https://stackoverflow.com/questions/474641/why-should-i-use-an-mvc-framework-for-php/)
[推荐的 PHP 安全培训](https://stackoverflow.com/questions/612177/recommend-security-training-for-php-mysql-web-developer/)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-18T04:33:47.253

*   使用编码标准。
*   使用单元测试。PHPUnit 和 SimpleTest 是 PHP 中主要的 xUnit 系统。
*   面向对象。
*   使用版本控制。任何版本控制，只要使用它。
*   如果适用，请使用框架。Zend、CodeIgniter、Symfony 和 CakePHP 是主要的。
*   如果没有框架，至少使用 ORM。Propel 和 Doctrine 是主要的。
*   文档。沉重。使用 PHPdoc 或类似的。

有大量用于 PHP 的工具。请使用它们，并编写良好的可维护代码。你会让每个人都更快乐。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-18T06:40:41.643

使用 PDO 或 mysqli。使用其中之一将为您提供准备好的语句，这些语句更安全、更有效。我不敢相信我看到了多少使用古老 mysql 接口的示例和教程。例如，如果您决定尝试使用 postgres，PDO 还可以让您更轻松地切换到不同的数据库系统。

您可能会考虑使用 Doctrine ( [http://www.doctrine-project.org](http://www.doctrine-project.org) )。它有一些自己的学习曲线，但提供了非常方便的功能。对我来说，最方便的部分是表格创建/测试数据加载功能。就个人而言，我更喜欢编写自己的 SQL 并使用 PDO 执行它，而不是在生产中大量使用 ORM。

主要是了解SQL和MySQL。[http://www.kitebird.com/mysql-book/](http://www.kitebird.com/mysql-book/)这本书很棒。PHP 方面不是很激烈；PDO 负责大部分工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T04:26:23.247

[Zend Framework](http://framework.zend.com)的“ [PHP 编码标准](http://framework.zend.com/manual/en/coding-standard.html)”是一个很好的起点。还要检查[这个帖子](https://stackoverflow.com/questions/694246/how-is-php-done-the-right-way)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-19T16:30:52.997

您具有 Java 背景，并且 PHP 中的许多 OO 内容都非常 Javaesque。这意味着您（希望）在 Java 中学到的许多设计模式也适用于（在较小程度上）PHP。数据库访问的一个示例是 DataMapper 模式。

# c# - C# 保存/加载富文本速度问题

> ID：762859
> 
> 赞同：1
> 
> 时间：2009-04-18T04:08:29.187
> 
> 标签：c#, profiling, load, save, richtext

我目前正在尝试解决涉及加载和保存富文本的速度问题。这是详细信息。在我的应用程序中，我有一个 Question 类，它需要能够存储两个富文本。目前，这两个富文本作为 TextRanges 存储在 Question 类中。就保存/加载而言，我使用的是 TextRange.Load(Stream, DataFormats) 和 TextRange.Save(Stream, DataFormats)。一切正常...

我的问题是我需要从文件中保存/加载 1000 多个这样的问题。当我这样做时，保存/加载包含这些问题的文件需要 20~ 秒。最重要的是，我希望能够一次加载其中的几个文件……这可能会让用户等待几分钟。我确定我的问题现在很清楚了。

所以我开始调查为什么保存/加载文件需要这么长时间，并且从分析器中我发现保存/加载文件所花费的时间中有 80% 是在 TextRange.Load 和 TextRange.Save 方法中。

所以我的问题是......有没有人有任何建议或指针来加快我的文件保存/加载？

我试图想出另一种方法来将富文本存储在 Question 类和文件中。我很快就没有想法了，但我想在我承认之前来到这里。任何帮助是极大的赞赏。如果我需要澄清任何事情，也请告诉我。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T05:40:15.970

每次调用 Load 和 Save 有多少开销，对于大范围调用 Load 一次与小范围调用多次有什么优势？加载 +1000 个问题时，您调用 Load 多少次？每个调用 Load 的行为是否都会在某处更新 RichTextBox 或 Flow Document？如果不是，一旦加载了 TextRanges，您将如何处理它们？

我注意到这个相关[线程](https://stackoverflow.com/questions/688660/saving-loading-richtextbox-content-with-other-data-using-c)并认为我会提供一个建议：如果您将字节数组（或内存流）保存在 Question 类中而不是 TextRange 中，并且仅在您实际需要在 RichTextBox 中加载数据时才创建 TextRange （当问题的窗口打开时）？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T04:45:34.057

您可能会研究[threading](http://msdn.microsoft.com/en-us/library/aa645740(VS.71).aspx)。这样您就可以在不锁定 UI 的情况下加载您的问题。加载前 100 个，当它们用完时，再加载 100 个左右。

# c# - 如何检查数据读取器是否为空或为空

> ID：762861
> 
> 赞同：58
> 
> 时间：2009-04-18T04:10:21.067
> 
> 标签：c#, null, sqldatareader

我有一个数据读取器，它从 sql server 数据库返回一个 lsit 记录。我在数据库中有一个名为“附加”的字段。该字段有 50% 的时间为空或为空。

我正在尝试编写检查该字段是否为空的代码。这背后的逻辑是：如果“附加”字段包含文本，则显示信息，否则隐藏该字段。

我试过了：

```
if (myReader["Additional"] != null)
{
    ltlAdditional.Text = "contains data";
}
else
{
     ltlAdditional.Text = "is null";
} 
```

上面的代码给了我这个错误：

异常详细信息：**System.IndexOutOfRangeException：附加**

任何帮助将不胜感激...

* * *

### 也可以看看：

> [检查 SqlDataReader 对象中的列名](https://stackoverflow.com/questions/373230/check-for-column-name-in-a-sqldatareader-object)

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-04-18T04:18:14.730

```
if (myReader["Additional"] != DBNull.Value)
{
    ltlAdditional.Text = "contains data";
}
else
{
     ltlAdditional.Text = "is null";
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2013-08-23T08:11:18.537

```
if (myReader.HasRows) //The key Word is **.HasRows**

{

    ltlAdditional.Text = "Contains data";

}

else

{   

    ltlAdditional.Text = "Is null Or Empty";

} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-10-20T20:39:12.383

我已经 3 年多没有使用 DataReaders 了，所以我想确认一下我的记忆并找到了这个。无论如何，对于像我一样发生在这篇文章中并想要一种使用列名而不是序号来测试 IsDBNull 的任何人，并且您使用的是 VS 2008+（我认为是 .NET 3.5），您可以编写一个扩展方法这样您就可以将列名传递给：

```
public static class DataReaderExtensions
{
    public static bool IsDBNull( this IDataReader dataReader, string columnName )
    {
        return dataReader[columnName] == DBNull.Value;
    }
} 
```

凯文

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-03-08T23:54:42.137

这是正确且经过测试的解决方案

```
if (myReader.Read())
{

    ltlAdditional.Text = "Contains data";
}
else
{   
    ltlAdditional.Text = "Is null";
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-11-27T17:58:40.417

我也使用 OleDbDataReader.IsDBNull()

```
if ( myReader.IsDBNull(colNum) ) { retrievedValue = ""; }
else { retrievedValue = myReader.GetString(colNum); } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-18T04:12:45.027

首先，您可能想要检查一个`DBNull`not a regular `Null`。

或者你可以看看`IsDBNull`方法

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-18T04:22:15.580

除了给出的建议之外，您还可以像这样直接从您的查询中执行此操作 -

```
SELECT ISNULL([Additional], -1) AS [Additional] 
```

这样您就可以编写条件来检查字段值是 < 0 还是 >= 0。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-06-25T22:27:05.947

@乔菲利普斯

SQlDataReader.IsDBNull(int index) 需要列的序号。有没有办法使用列名而不是序号来检查空值？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-02-13T15:36:31.403

试试这个更简单的等效语法：

```
ltlAdditional.Text = (myReader["Additional"] == DBNull.Value) ? "is null" : "contains data"; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-10-16T03:01:33.417

我也遇到过这种问题，但我的，我使用 DbDataReader 作为我的通用阅读器（用于 SQL、Oracle、OleDb 等）。如果使用 DataTable，DataTable 有这个方法：

```
DataTable dt = new DataTable();
dt.Rows[0].Table.Columns.Contains("SampleColumn"); 
```

使用它我可以确定该列是否存在于我的查询具有的结果集中。我也在寻找 DbDataReader 是否具有此功能。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-02-02T13:05:28.753

这

例子：

```
objCar.StrDescription = (objSqlDataReader["fieldDescription"].GetType() != typeof(DBNull)) ? (String)objSqlDataReader["fieldDescription"] : ""; 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-04-18T04:35:34.563

AMG - 对不起，有一个金发碧眼的时刻。在我最初设计数据库之后，将“附加”字段添加到数据库中。

我更新了所有代码以使用这个新字段，但是我忘记更新调用选择数据库字段的实际数据读取器代码，因此它没有调用“附加”

# java - 您如何配置 Apache Ivy 以删除孤立工件？

> ID：762868
> 
> 赞同：6
> 
> 时间：2009-04-18T04:15:00.450
> 
> 标签：java, ant, ivy

假设我有一个`ivy.xml`包含以下内容：

```
 <dependency org="checkstyle" name="checkstyle" rev="4.3" /> 
```

然后我想升级到 Checkstyle 4.4，所以我将我的更改`ivy.xml`为包含：

```
 <dependency org="checkstyle" name="checkstyle" rev="4.4" /> 
```

在`retrieve`第一次配置之后，我有了文件`checkstyle-4.3.jar`. 第二次配置后，我也有了文件`checkstyle-4.4.jar`，文件`checkstyle-4.3.jar`依然存在。

有没有办法让 Ivy 意识到旧文件是一个孤立文件，并将其从`lib`目录中删除？我的想法是，我不希望我的开发人员的磁盘空间使用量在我每次升级工具时都急剧增加。

理想情况下，我也希望它从本地存储库中删除。我确实意识到本地存储库的目的是在项目之间共享它，因此删除任何东西是没有意义的，因为它不知道该工件是否仍在其他项目中使用。但必须有某种修剪程序......

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-19T15:51:02.157

我一直在使用 Ivy 2.0.0，所以我不知道这是否适用于您正在使用的版本。

Ivy[`retrieve`](http://ant.apache.org/ivy/history/2.0.0/use/retrieve.html)任务有一个`sync`属性。将此设置为`true`您检索到的目录（`lib`在您的情况下）中未使用/未知的文件将被删除。请记住，这意味着该目录中*任何*手动复制的、Ivy 未明确解析的工件都将被删除。

另外，请注意，如果您使用该`sync`选项，但 Ivy 没有解析依赖项（`ivy.xml`例如，空或缺失），则检索目录将被删除。

# javascript - 如何使混合地图成为 Google 地图 API 上的默认地图？

> ID：762874
> 
> 赞同：3
> 
> 时间：2009-04-18T04:19:33.683
> 
> 标签：javascript, google-maps

谷歌地图只是让 API 和真实的东西一模一样。所以现在我希望地图默认显示混合地图，我查看了[谷歌的文档](http://code.google.com/apis/maps/documentation/controls.html#DefaultUI)，但我似乎找不到办法做到这一点。

提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-18T06:32:03.507

你试过[构造函数](http://code.google.com/apis/maps/documentation/reference.html#GMapOptions)吗？

```
map = new GMap2(document.getElementById("map_canvas"), { mapTypes:[G_HYBRID_MAP] });
map.setCenter(new GLatLng(37.4419, -122.1419), 13);
map.setUIToDefault(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-04-10T15:06:16.917

你也可以通过地图类型

```
map.setCenter(point, zoom, G_HYBRID_MAP); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-10-17T17:20:02.823

对于 V3 API，您可以在地图选项中设置默认地图类型：

```
map.setOptions({
      mapTypeId: google.maps.MapTypeId.HYBRID
}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T20:19:01.427

要使混合成为默认地图，请尝试以下操作：

```
map = new GMap2(document.getElementById("map_canvas"));
map.setUIToDefault();
map.setMapType(G_HYBRID_MAP); 
```

这是[文档](http://code.google.com/apis/maps/documentation/reference.html#GMap2.setMapType)。

# c# - 线程、中止和等待

> ID：762875
> 
> 赞同：2
> 
> 时间：2009-04-18T04:19:52.793
> 
> 标签：c#, multithreading

我正在中止一个线程（很快就会成为线程），问题是我需要停止直到所有线程都被中止。

完成后，`Thread.Abort();`我想使用`Thread.Join()`等待它完全中止。然而，这不起作用。它只是永远等待。我如何中止每个线程并等到它完成后再继续？

**附加信息：**如果你好奇为什么——在这种情况下，我正在关闭一个窗口，我将一个委托函数传递给它在完成（或中止）时调用的线程。如果我不停止，那么窗口将关闭并且该函数将调用无效句柄/objs。我可以轻松地使用相同的方法，插入一个标志并循环和睡眠，直到设置所有标志，但感觉不对。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T04:32:21.360

我从多年的线程经验中了解到，如果遵循这些规则，生活*会变*得更轻松。

与这个问题相关的一个是：

*   让线程控制它们自己的资源，包括它们的生命周期。

我不会中止线程，我只是在线程创建者和线程本身之间建立一个通信方法来通知线程终止，然后让线程本身关闭。

这种方法通常可以像控制线程主循环的创建者写入/线程读取标志一样简单。如果线程在循环中有长时间运行的任务，您还应该定期检查。

然后创建者线程应该加入，直到线程退出。如果设计得当，您可以设置所需时间的上限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T04:35:20.713

使用诸如事件之类的同步对象。例如，每个后台线程都有一个与之关联的事件。当线程终止时，它会发出事件信号。主线程对事件集执行 WaitHandle.WaitAll，并且仅在所有事件都发出信号时继续。

请注意，如果后台线程有可能需要很长时间才能终止，那么在等待它们时阻塞主线程会造成糟糕的用户体验。因此，如果是这种情况，您可能希望在阻止之前隐藏窗口。此外，您需要测试这对您的回调委托有什么影响——如果 UI 线程在等待中被阻塞，它是否能够处理您的委托？

如果线程由于窗口关闭而被杀死，那么不调用委托可能不是更好的设计吗？只需让主线程告诉后台线程它们终止的原因，如果原因是“窗口关闭”，则让它们跳过回调。（这假设您正在与线程通信，正如 Pax 正确建议的那样，而不是仅仅调用 Abort。）

# math - 有没有办法在有序矩阵中找到给定单元格的行？

> ID：762886
> 
> 赞同：0
> 
> 时间：2009-04-18T04:29:17.263
> 
> 标签：math

例如，给定一个矩阵：

```
 01|02|03|04|05
    06|07|08|09|10
    11|12|13|14|15 
```

并且知道矩阵是 5x3，如果给定值“7”，有没有一种方法可以知道它在第 2 行？情况是矩阵总是从 1 到 n 排序，从 0 开始。

最后，矩阵线性存储在一个基于零的数组中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T04:48:43.940

如果它是基于 0 的：

> 行：n / 宽度
> 列：n % 宽度

在您的示例中，您说它是从零开始的，但它实际上是从 1 开始的，并且您将左上角的元素计为 (row,col)=(1,1)，因此您需要调整数学：

> 行：(n-1) / 宽度 + 1
> 列：(n-1) % 宽度 + 1

在您的情况下，n = 7，宽度 = 5：

> 行 = (7-1)/5 + 1 = 1+1 = 2
> 列 = (7-1)%5 + 1 = 1+1 = 2

注意：我使用的是标准程序员的整数数学，其中“a/b”真正的意思是“floor(a/b)”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T04:44:42.170

```
row = ceiling(7 / 5)  or   ceiling(position / width) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T04:32:06.367

```
Let X be your index
-------------------
column = X % width
row    = ceiling(X / width) 
```

**编辑**：现在我做了一些改变似乎可以工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T04:37:03.517

如果矩阵以[行](http://en.wikipedia.org/wiki/Row-major_order)优先顺序存储，则行索引映射到元素索引，如下所示：

```
 rowIndex = (elementIndex - 1) / numcolumns
 columnIndex = (elementIndex % numcolumns) - 1 
```

这始终是整数除法——所以没有余数。您将获得从 0 开始的行和列索引。

留作练习来弄清楚列主要布局中发生了什么。

# iphone - iPhone 互联网连接

> ID：762888
> 
> 赞同：1
> 
> 时间：2009-04-18T04:32:18.020
> 
> 标签：iphone

我目前正在为 iPhone 开发一款游戏，我想为玩家提供将他们的高分提交到我的服务器的选项。游戏本身不需要互联网连接。

处理这个问题的最佳方法是什么，如果没有互联网连接，只需发出请求并优雅地失败，或者是否有 API 请求用户连接到互联网？

我正在使用 NSURLRequest 和 NSURLConnection 提交数据。

我搜索了 Apple 文档，我遇到的唯一一件事是持久 wifi 连接的标志，但这似乎有点矫枉过正。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T04:48:32.100

查看[可达性示例](http://developer.apple.com/iphone/library/samplecode/Reachability/index.html)。它具有一系列用于测试网络连接的功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T06:00:06.250

NSURLConnection 将满足您的所有需求。如果有可用的连接（WAN 或 WiFi），它将完成设置连接所需的一切。如果您尝试时没有连接，只需存储高分并在您的应用下次启动时上传。

除非您想提供有关失败发生原因的详细信息或在网络可用时提供立即重试，否则复杂的可达性代码（如苹果示例）对于上传高分表来说听起来有点过分了。

# sql - 从 MySQL 中的多个表中进行选择

> ID：762894
> 
> 赞同：2
> 
> 时间：2009-04-18T04:33:14.197
> 
> 标签：sql, mysql

我有两个表，即States，Package_Details。以下是表格的详细信息。

状态

*   state_id
*   州名

包装_详情

*   ID
*   sender_state //用状态ID存储状态
*   receiver_state //用状态ID存储状态

现在我在构建 SQL 查询时遇到问题，该查询将选择并显示 Package_Details 中的记录，用 States 表中的相应 state_name 替换 sender_state 和 receiver_state。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-18T04:40:17.190

你需要加入。例子：

```
SELECT p.id, s1.state_name AS sender, s2.state_name AS receiver
  FROM 
       package_details p
  JOIN states s1 ON (p.sender_state = s1.state_id)
  JOIN states s2 ON (p.receiver_state = s2.state_id) 
```

请注意如何`states`通过为其分配别名 ( `states s1`) 并使用别名来引用表来在查询中使用两次。

如果您需要经常执行此连接，您可能希望创建一个视图。

MySQL's documentation on joins is here: [http://dev.mysql.com/doc/refman/5.0/en/join.html](http://dev.mysql.com/doc/refman/5.0/en/join.html). The documentation on creating views is here: [http://dev.mysql.com/doc/refman/5.0/en/create-view.html](http://dev.mysql.com/doc/refman/5.0/en/create-view.html).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T04:37:06.137

您需要阅读 SQL JOIN：

[http://www.w3schools.com/Sql/sql_join.asp](http://www.w3schools.com/Sql/sql_join.asp)

[http://dev.mysql.com/doc/refman/5.0/en/join.html](http://dev.mysql.com/doc/refman/5.0/en/join.html)

# linq - LINQ：在日期时间字段中按月和年分组

> ID：762899
> 
> 赞同：45
> 
> 时间：2009-04-18T04:35:41.617
> 
> 标签：linq, tsql, group-by, substring

我有一个带有日期时间字段的表。我想检索按月/年组合以及该月/年中出现的记录数分组的结果集。如何在 LINQ 中做到这一点？

我能弄清楚的最接近的是在 TSQL 中：

```
select substring(mo,charindex(mo,'/'),50) from (
select mo=convert(varchar(2),month(created)) + '/' + convert(varchar(4), year(created)) 
 ,qty=count(convert(varchar(2),month(created)) + '/' + convert(varchar(4), year(created)))
from posts 
group by convert(varchar(2),month(created)) + '/' + convert(varchar(4), year(created))
) a
order by substring(mo,charindex(mo,'/')+1,50) 
```

但我不会说这有效...

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-04-18T04:58:21.607

```
var grouped = from p in posts
     group p by new { month = p.Create.Month,year= p.Create.Year } into d
     select new { dt = string.Format("{0}/{1}",d.Key.month,d.Key.year), count = d.Count() }; 
```

[这是LINQ](http://msdn.microsoft.com/en-us/library/bb882657.aspx)中可用的 DateTime 函数的列表。为此，您还需要了解[多列分组](http://weblogs.asp.net/zeeshanhirani/archive/2008/05/07/group-by-multiple-columns-in-linq-to-sql.aspx)

降序排列

```
var grouped = (from p in posts 
  group p by new { month = p.Create.Month,year= p.Create.Year } into d 
  select new { dt = string.Format("{0}/{1}",d.Key.month,d.Key.year), count = d.Count()}).OrderByDescending (g => g.dt); 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2015-04-03T01:50:13.557

这适用于那些试图完成相同但使用 lambda 表达式的人。

Assuming that you already have a collection of entities and each entity has OrderDate as one of its properties.

```
yourCollection
// This will return the list with the most recent date first.
.OrderByDescending(x => x.OrderDate)
.GroupBy(x => new {x.OrderDate.Year, x.OrderDate.Month})
// Bonus: You can use this on a drop down
.Select(x => new SelectListItem
        {
           Value = string.Format("{0}|{1}", x.Key.Year, x.Key.Month),
           Text = string.Format("{0}/{1} (Count: {2})", x.Key.Year, x.Key.Month, x.Count())
        })
.ToList(); 
```

If you do not need the collection of SelectListItem then just replace the select with this one:

```
.Select(x => string.Format("{0}/{1} (Count: {2})", x.Key.Year, x.Key.Month, x.Count())) 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-11-18T15:07:25.523

你也可以这样做

```
from o in yg
group o by o.OrderDate.ToString("MMM yyyy") into mg
select new { Month = mg.Key, Orders = mg } 
```

你的结果将是

{2014 年 1 月 25 日} {2015 年 2 月 15 日} 等等...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T04:41:01.853

[本网站](http://www.formatexception.com/2009/03/linq-group-by-and-groupby/)有一个可以满足您需求的示例。

这是基本语法：

```
from o in yg
group o by o.OrderDate.Month into mg
select new { Month = mg.Key, Orders = mg } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-07-11T13:28:43.747

Here is a simple solution for grouping in DateTime.

```
List<leaveallview> lav = new List<leaveallview>();
lav = dbEntity.leaveallviews.Where(m =>m.created==alldate).ToList();
dynamic lav1 = lav.GroupBy(m=>m.created.Value.GetDateTimeFormats()).FirstOrDefault().ToList(); 
```

# ruby-on-rails - 在 Rails 中关闭 json 键引用

> ID：762904
> 
> 赞同：2
> 
> 时间：2009-04-18T04:37:29.130
> 
> 标签：ruby-on-rails, json, quotes, google-visualization

Rails 2.3 的特性之一是 json 键引用。我想知道是否有一种简单的方法可以关闭键引用或修改引用的完成方式（例如更改为单引号）。

我想输出 Google 的 Visualization API 将接受的 json 格式（[http://code.google.com/apis/visualization/documentation/dev/implementing_data_source.html#examples](http://code.google.com/apis/visualization/documentation/dev/implementing_data_source.html#examples)）。键没有引号。

从 Rails 发行说明：

如果您在“json.org”站点上查看规范，您会发现 JSON 结构中的所有键都必须是字符串，并且必须用双引号引起来。从 Rails 2.3 开始，我们在这里做正确的事，即使是数字键。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-19T08:31:18.280

这可能听起来有点傻，但我所做的只是修改 Rails 的代码。它又快又脏，每次升级都必须重新应用它，但似乎没有更好的方法。祝你好运！

# html - 将使用哪个样式表？（IE条件语句）

> ID：762906
> 
> 赞同：1
> 
> 时间：2009-04-18T04:39:48.720
> 
> 标签：html, css, internet-explorer

我需要为 IE 使用不同的样式表，我想知道哪个样式表将获得控制权。

例如，我将在 <head> 中使用以下代码：

```
<link rel="stylesheet" type="text/css" href="styles/style.css" />
<!--[if IE]><link rel="stylesheet" type="text/css" href="styles/ie.css" /><![endif]--> 
```

那么我需要在 IE 样式表中的任何地方使用 !important 吗？或者第二个样式表是否会被 IE 视为更重要？顺序重要吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-18T04:43:08.243

无论哪种风格具有最高的[特异性](http://www.smashingmagazine.com/2007/07/27/css-specificity-things-you-should-know/)将获胜。如果您在两个样式表中提供相同的选择器，则最新的选择器将获胜。否则，从我上面链接的文章中：

> 1.  具体性决定了浏览器应用哪个 CSS 规则。
> 2.  特殊性通常是您的 CSS 规则不适用于某些元素的原因，尽管您认为它们应该适用。
> 3.  每个选择器在特异性层次结构中都有自己的位置。
> 4.  如果两个选择器适用于同一个元素，则具有更高特异性的选择器获胜。
> 5.  有四个不同的类别定义了给定选择器的特异性级别：内联样式、ID、类+属性和元素。
> 6.  如果您喜欢 Star Wars: [CSS Specificity Wars](http://www.stuffandnonsense.co.uk/archives/css_specificity_wars.html) ，您可以理解特异性。
> 7.  如果你喜欢扑克，你可以理解特殊性：[扑克玩家的 CSS 特殊性](http://iamacamera.org/default.aspx?id=95)
> 8.  When selectors have an equal specificity value, the latest rule is the one that counts.
> 9.  When selectors have an unequal specificity value, the more specific rule is the one that counts.
> 10.  具有更具体选择器的规则具有更大的特异性。
> 11.  最后定义的规则会覆盖任何先前的冲突规则。
> 12.  嵌入式样式表比其他规则具有更大的特异性。
> 13.  ID 选择器比属性选择器具有更高的特异性。
> 14.  您应该始终尝试使用 ID 来增加特异性。
> 15.  类选择器胜过任意数量的元素选择器。
> 16.  通用选择器和继承选择器具有 0,0,0,0 的特异性。
> 17.  您可以使用 CSS 特异性计算器计算 CSS 特异性。

[这是关于它的官方文档](http://www.w3.org/TR/CSS21/cascade.html#specificity)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T04:43:57.493

第二个声明将覆盖 ie 中的第一个声明。

# wpf - WPF + IoC：“指定的 Visual 已经是另一个 Visual 的子对象或 CompositionTarget 的根。”

> ID：762909
> 
> 赞同：2
> 
> 时间：2009-04-18T04:41:21.150
> 
> 标签：wpf, spring, xaml, inversion-of-control

[编辑：沿 mvvm 线重新思考架构使这个问题在很大程度上消失了 - 感谢[@kent](https://stackoverflow.com/users/5380/kent-boogaart) ]

使用 Spring.NET + WPF。

在配置中加载两个 WPF 按钮：

```
<object name="Button1" type="System.Windows.Controls.Button, PresentationFramework" >
  <property name="Name" value="Next" />
  <property name="Width" value="200"/>
  <property name="Content" value="Next"/>
</object>
<object name="Button2" type="System.Windows.Controls.Button, PresentationFramework" >
  <property name="Name" value="Back" />
  <property name="Width" value="200"/>
  <property name="Content" value="Back"/>
</object> 
```

并将它们传递给 xaml 类的构造函数（“代码隐藏”）

```
<object name="MyNewScreen" type="MyControls.MyUserControl>
  <constructor-arg name="buttons">
 <list>
    <ref object="Button1"/>
    <ref object="Button2"/> 
 </list>
 </object> 
```

类构造函数具有：

```
public DataGridControl(ArrayList buttons)
{
    //(yes this should be a List<Button> but I can't make spring happy with that)
    foreach(var b in buttons) this.stackPanel.Children.Add(b);
    ... 
```

抛出一个：

`Specified Visual is already a child of another Visual or the root of a CompositionTarget.`

现在，我看到来自 Spring 的两个按钮的 .GetHashCode() 是相同的。所以我可以理解 WPF 不喜欢什么。

但是我不能`XamlReader.Load(new XmlNodeReader(document));`像[一些人建议](http://www.google.com/search?q=XamlReader.Load(new+XmlNodeReader(document))%3B)的那样做，而不会丢失我的事件接线。

任何想法如何解决这个问题？

[编辑] 我正在整理事件。事件连接不是问题，但它确实解释了为什么我首先要这样做。为了简洁起见，我将其从原始帖子中删除：

```
<object id="eventListener2" type="MyEventListener">
<listener event="Click" method="b_Click">
<ref object="Button2" />
</listener>
</object> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T08:51:06.777

具有相同的哈希码并不意味着对象实例相同。检查它们是否实际上是同一个实例的一种简单方法是在构造函数中设置断点并在监视窗口中评估此表达式：

```
object.ReferenceEquals(buttons[0], buttons[1]) 
```

如果`true`，它们是完全相同的对象，那是你的问题。

也就是说，我认为您更有可能创建多个控件，每个控件都`Button`通过 Spring 配置导入相同的 s 。

根据[Spring 文档](http://www.springframework.net/doc-latest/reference/html/objects.html#objects-factory-scopes)，对象的默认范围是`singleton`. 您真正想要的是 Spring 为每个需要它的控件创建一个新的 Button 实例。因此，您的配置应该更像这样：

```
<object name="Button1" type="System.Windows.Controls.Button, PresentationFramework" singleton="false">
  <property name="Name" value="Next" />
  <property name="Width" value="200"/>
  <property name="Content" value="Next"/>
</object> 
```

说了这么多，我认为使用 MVVM 方法会好得多。您可以让 Spring 提供视图模型实例（可以毫无问题地共享）并从该模型生成 UI。

# configuration - 如何在单个 EAR 中为不同的战争配置多个 log4j？

> ID：762918
> 
> 赞同：9
> 
> 时间：2009-04-18T04:45:50.267
> 
> 标签：configuration, log4j, war, ear

我有一个 EAR，其结构如下：

```
APP.ear 
- APP1.war
    - WEB-INF/classes/log4j.properties
- APP2.war
    - WEB-INF/classes/log4j.properties
- app1-ejb.jar
- app2-ejb.jar
- log4j.jar
- spring.jar
- commons-lang.jar (...and other jar) 
```

我希望每个 WAR 都有自己的应用程序日志。但似乎上面的配置不起作用。APP1 和 APP2 的日志转到 APP1 的日志。无论如何要创建单独的应用程序日志吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-20T03:50:11.787

事实证明，由于类加载器，这是不可能的。类加载器层次结构如下：

应用程序类加载器 -> Ejb 类加载器 -> war 类加载器

要为单个战争创建单独的日志，可以将 log4j.jar 放入战争中，让 log4j 使用战争类加载器。但是由于app1-ejb.jar和app2-ebj.jar都需要用到log4j，所以log4j.jar只能放在顶层。所以 log4j 处于应用程序类加载器级别。

我可以指定一个 log4j 配置来将不同的包记录到不同的文件中。但是对于像spring这样的普通库，日志是不能分离的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-22T11:09:03.903

它不起作用的原因是因为 log4j 存在于根位置，而是让每个战争在其 WEB-INF/lib 目录中都有一个 Log4j.jar 并从根目录中删除 log4j.jar。

有关这方面的更多信息，请参阅我在此 [http://techcrawler.wordpress.com/上的博客文章](http://techcrawler.wordpress.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-23T12:59:32.393

您还可以通过在代码中使用 PropertyConfigurator 动态更改属性文件中的 FILE 属性来实现此目的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-28T07:16:21.767

Logback 是解决此问题的可行解决方案。在查看了不同的 hack 以使其与 log4j 一起工作之后，我们决定切换到 Logback。我在 webapp 中使用了以下配置和 Logback jar。

webapp 内的一个 Logback 文件，其中包含一个外部文件：

```
 <?xml version="1.0" encoding="UTF-8" ?>
    <configuration scan="true" scanPeriod="10 seconds">
        <contextListener class="ch.qos.logback.classic.jul.LevelChangePropagator">
            <resetJUL>true</resetJUL>
        </contextListener>

        <contextName>${project.artifactId}</contextName>

        <jmxConfigurator />

        <include file="${logback.configuration.filepath}" />
    </configuration> 
```

`${logback.configuration.filepath}`在 Maven 过滤期间被配置文件的 webapp 外部的确切路径替换（类似于*/opt/server/conf/loback.included.conf*）。

然后，`logback.included.conf`（这个文件是项目的一部分，用 交付`build-helper:attach-artifact`，所以`${project.artifactId}`在 Maven 过滤期间也被替换）的内容：

```
 <?xml version="1.0" encoding="UTF-8" ?>
    <included>
        <appender name="file" class="ch.qos.logback.core.FileAppender">
            <file>/var/log/server/${project.artifactId}.log</file>
            <encoder>
                <pattern>[@/%contextName] %date{ISO8601} [%-5level] %thread:[%logger] %msg%n</pattern>
            </encoder>
        </appender>

        <root level="INFO">
            <appender-ref ref="file" />
        </root>
    </included> 
```

唯一的限制是，包含文件的内容必须与包含者之一兼容。实际上只是写规则。

# c# - 异常阻塞了我的 IDE

> ID：762919
> 
> 赞同：0
> 
> 时间：2009-04-18T04:46:11.607
> 
> 标签：c#, exception, system.net.webexception, suppression

我正在我的一个页面上扫描死链接。在一个我得到许多“System.dll 中发生'System.Net.WebException' 类型的第一次机会异常”数十个。我如何让 MSVC# 不显示它们？我正在捕获所有这些异常，因为我正在测试链接（实际上它被称为 testStatus，只请求头部并返回一个布尔值，如果它还活着的话）。如何使输出更易于阅读？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T14:26:02.057

**If they appear in the Output window:**
Right click anywhere in the Output window and uncheck "Exception Messages".

**If they appear in the Immediate Window:**
You may have enabled output redirection (Redirect all Output Window text to the Immediate Window in Tools->Options->Debugging), you must then disable it inside the Output window too (because they are redirected from there).

* * *

But remember that you turned them off, sometimes they are quite useful.

# powershell - Powershell ps1 文件“未被识别为 cmdlet、函数、可运行程序或脚本文件。”

> ID：762927
> 
> 赞同：27
> 
> 时间：2009-04-18T04:55:32.567
> 
> 标签：powershell

我刚才做了一个Powershell函数，保存到一个ps1文件中。但是，当我尝试从 powershell 中执行它时，它不会运行。

我已经通过输入以下命令更改了运行未签名代码的设置：

```
set-executionpolicy remotesigned 
```

功能是这样的：

```
Function listAllPaths([string]$fromFolder, [string]$filter, [string]$printfile){
Get-ChildItem -Path $fromFolder -Include $filter -Recurse -Force -Name > $printfile
} 
```

它所做的是创建一个文本文件，其中列出了某个文件的所有路径。
我把它直接放在c:\ 下，并将文件命名为listAllPaths，与函数相同。

当我在 Powershell 中输入以下命令时：

```
PS> listAllPaths.ps1 c:\ *.pdf testingPDF.txt 
```

我收到一条错误消息：

> 术语“listAllPaths.ps1”未被识别为 cmdlet、函数、可运行程序或脚本文件。验证术语并重试。

我已经尝试了几件事，老实说，我不知道如何让它工作？我期望的是在给定路径上创建一个文件，在这个例子中是 c:\。该文件具有名称 testingPDF.txt 和生成的内容。

有人可以告诉我我在这里忘记了什么。

不，谷歌并没有回答所有问题。已经试过了。如果我没有尝试过在线搜索引擎，我不会来这里问它。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-18T05:00:50.353

这是在您的环境路径不包括当前目录的许多平台上的典型错误。因此，当您执行脚本（或命令或程序等）时，除了当前/工作目录之外，您的运行时环境到处可见。

尝试

```
PS> .\listAllPaths.ps1 c:\ *.pdf testingPDF.txt 
```

编辑：阅读您的评论后，我建议您尝试一下。我还没有真正验证你的 PS 脚本的逻辑。我只是想让你的脚本先执行。

尝试如下编辑您的脚本，并按上述方式执行。

```
Function listAllPaths([string]$fromFolder, [string]$filter, [string]$printfile){
Get-ChildItem -Path $fromFolder -Include $filter -Recurse -Force -Name > $printfile
}

listAllPaths 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-18T05:09:59.270

我可能在这里偏离了基地，但是您的脚本是在*定义*一个函数，而不是在执行它吗？也许您需要“获取”脚本：

```
. .\listallpaths.ps1 
```

...这样现在你的“listallpaths”函数就被定义了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-18T13:49:16.450

如果你用参数替换“function listallpaths”并像这样摆脱周围的{}..

```
param([string]$fromFolder, [string]$filter, [string]$printfile)
Get-ChildItem -Path $fromFolder -Include $filter -Recurse -Force -Name > $printfile 
```

您将拥有一个可以根据需要调用的脚本文件。

```
PS> .\listAllPaths.ps1 c:\ *.pdf testingPDF.txt 
```

正如马特所暗示的那样，通过声明函数，当您调用脚本时，它将创建函数然后退出。PowerShell 脚本基本上是一个存储在文件中的函数（没有周围的大括号......它们是隐含的），函数本身将存储在内存中。

# database - 识别关系和非识别关系有什么区别？

> ID：762937
> 
> 赞同：857
> 
> 时间：2009-04-18T05:04:55.070
> 
> 标签：database, database-design, data-modeling, identifying-relationship

我无法完全掌握这些差异。你能描述这两个概念并使用现实世界的例子吗？

* * *

## 回答 #1

> 赞同：1124
> 
> 时间：2009-04-18T05:59:30.870

*   **标识关系**是子表中的行的存在依赖于父表中的行。这可能会令人困惑，因为如今为子表创建伪键是一种常见的做法，但*不*将外键作为子表的父部分的主键。形式上，“正确”的做法是让外键成为子主键的一部分。但逻辑关系是，没有父母，孩子就无法存在。

    示例：A`Person`有一个或多个电话号码。如果他们只有一个电话号码，我们可以简单地将其存储在`Person`. 由于我们希望支持多个电话号码，我们创建了第二个表`PhoneNumbers`，其主键包括`person_id`引用该`Person`表。

    我们可能会认为电话号码属于一个人，即使它们被建模为单独表格的属性。这是一个强有力的线索，表明这是一种识别关系（即使我们没有真正包含`person_id`在 的主键中`PhoneNumbers`）。

*   **非标识关系**是指父项的主键属性不能*成为*子项的主键属性。一个很好的例子是查找表，例如`Person.state`引用主键的外键`States.state`。 `Person`是关于 的子表`States`。但是其中的一行`Person`不是由它的`state`属性来标识的。即`state`不是主键的一部分`Person`。

    非标识关系可以是**可选**的或**强制**的，这意味着外键列分别允许 NULL 或不允许 NULL。

* * *

另请参阅我对[仍然对识别与非识别关系感到困惑的回答](https://stackoverflow.com/questions/2814469/still-confused-about-identifying-vs-non-identifying-relationships/2814663#2814663)

* * *

## 回答 #2

> 赞同：941
> 
> 时间：2010-03-06T12:54:57.827

现实世界还有另一种解释：

一本书属于一个所有者，一个所有者可以拥有多本书。但是，这本书也可以在没有所有者的情况下存在，并且它的所有权可以从一个所有者变为另一个所有者。一本书和所有者之间的关系是一种非识别关系。

然而，一本书是由一个作者写的，而这个作者可能写了多本书。但是，这本书需要由作者撰写——没有作者，它就无法存在。因此，书与作者之间的关系是一种识别关系。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2017-07-04T12:39:13.887

[比尔的答案](https://stackoverflow.com/a/762994/244935)是正确的，但*令人震惊的是*，在所有其他答案中，没有人指出最重要的方面。

人们一遍又一遍地说过，在识别关系中，没有父母，孩子就无法存在。（例如[user287724](https://stackoverflow.com/a/2392504/244935)）。这是真的，但完全没有抓住重点。外键*为非空*就足以实现这一点。它不需要是主键的一部分。

**所以这才是真正的原因：**

识别关系的目的是**外键永远不会改变**，因为它是主键的一部分......[因此](https://softwareengineering.stackexchange.com/questions/8187/should-a-primary-key-be-immutable)识别！

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2009-04-18T05:45:23.943

标识关系指定子对象不能在没有父对象的情况下存在

非标识关系指定对象之间的常规关联，1:1 或 1:n 基数。

非标识关系可以在不需要父级的情况下指定为可选的，或者在需要父级的情况下通过设置父表基数来指定为强制...

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-04-18T05:51:23.743

这是一个很好的描述：

两个实体之间的关系可以分类为“识别”或“非识别”。当父实体的主键包含在子实体的主键中时，存在标识关系。另一方面，当父实体的主键包含在子实体中但不作为子实体主键的一部分时，则存在非标识关系。此外，非识别关系可以进一步分类为“强制性”或“非强制性”。当子表中的值不能为空时，存在强制的非标识关系。另一方面，当子表中的值可以为空时，存在非强制性的非标识关系。

[http://www.sqlteam.com/article/database-design-and-modeling-fundamentals](http://www.sqlteam.com/article/database-design-and-modeling-fundamentals)

下面是一个识别关系的简单示例：

```
Parent
------
ID (PK)
Name

Child
-----
ID (PK)
ParentID (PK, FK to Parent.ID) -- notice PK
Name 
```

这是一个对应的非识别关系：

```
Parent
------
ID (PK)
Name

Child
-----
ID (PK)
ParentID (FK to Parent.ID) -- notice no PK
Name 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2016-06-01T20:07:12.300

[user287724的回答](https://stackoverflow.com/a/2392504/366904)给出了以下书籍和作者关系的例子：

> 然而，一本书是由作者写的，而作者可能写了多本书。但是这本书需要作者写，没有作者就不可能存在。因此，书与作者之间的关系是一种识别关系。

这是一个非常令人困惑的示例，绝对*不是*`identifying relationship`.

是的，`book`没有至少一个就不能写`author`，但是`author`（它是外键）的不是`book`在表中**识别**！`book``books`

您可以`author`从行中删除（FK）`book`，仍然可以通过其他字段（，，...等）识别书行，但不能识别书`ISBN`的`ID`作者**！**

我认为一个有效的例子是`identifying relationship`（产品表）和（特定产品详细信息表）之间的关系`1:1`

```
products table
+------+---------------+-------+--------+
|id(PK)|Name           |type   |amount  |
+------+---------------+-------+--------+
|0     |hp-laser-510   |printer|1000    |
+------+---------------+-------+--------+
|1     |viewsonic-10   |screen |900     |
+------+---------------+-------+--------+
|2     |canon-laser-100|printer|200     |
+------+---------------+-------+--------+

printers_details table
+--------------+------------+---------+---------+------+
|Product_ID(FK)|manufacturer|cartridge|color    |papers|
+--------------+------------+---------+---------+------+
|0             |hp          |CE210    |BLACK    |300   |
+--------------+------------+---------+---------+------+
|2             |canon       |MKJ5     |COLOR    |900   |
+--------------+------------+---------+---------+------+
* please note this is not real data 
```

在此示例`Product_ID`中，`printers_details`表中的 FK 被认为是引用`products.id`表的 FK 并且也是表中**的 PK**`printers_details`，这是一种识别关系，因为`Product_ID`打印机表中的 (FK) 正在**识别**子表中的行，我们无法删除来自`product_id`子表，因为我们无法再识别该行，因为我们丢失了它的主键

如果你想把它放在两行：

> 标识关系是当子表中的 FK 被视为子表中的 PK（或标识符）但仍引用父表时的关系

**另一个例子**可能是当您在某个国家数据库的导入和导出中有 3 个表（进口 - 产品 - 国家）

该`import`表是具有这些字段（`product_id`（FK），`country_id`（FK），进口量，价格，进口单位，运输方式（空运，海运）） `we may use the (`product_id `, the`country_id`）来识别每个导入行“如果它们都在同一年”，这两个列可以在子表（导入）中组成一个主键，并且还可以引用父表。

请我很高兴我终于理解了`identifying relationship`and的概念`non identifying relationship`，所以请不要告诉我我对所有这些投票都错了，因为这是一个**完全无效的例子**

是的，从逻辑上讲，没有作者就不能写一本书，但是没有作者就可以确定一本书，实际上它不能与作者确定！

**您可以 100% 从书行中删除作者，但仍然可以识别这本书！**.

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2014-05-22T14:31:57.643

**非识别关系**

非识别关系意​​味着孩子与父母相关，但可以单独识别。

```
PERSON    ACCOUNT
======    =======
pk(id)    pk(id)
name      fk(person_id)
          balance 
```

ACCOUNT 和 PERSON 之间的关系是不可识别的。

**识别关系**

识别关系意​​味着需要父母向孩子提供身份。孩子之所以存在，是因为父母。

这意味着外键也是主键。

```
ITEM      LANGUAGE    ITEM_LANG
====      ========    =========
pk(id)    pk(id)      pk(fk(item_id))
name      name        pk(fk(lang_id))
                      name 
```

ITEM_LANG 和 ITEM 之间的关系是标识性的。在 ITEM_LANG 和 LANGUAGE 之间。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2015-01-09T15:40:16.317

如果你认为删除父项时也应该删除子项，那么它是一种标识关系。

如果即使删除了父项，也应该保留子项，则它是非标识关系。

例如，我有一个包含学员、培训、文凭和培训课程的培训数据库：

*   受训者与培训课程有确定的关系
*   培训与培训课程具有识别关系
*   但受训者与文凭有非识别性关系

如果删除相关学员、培训或文凭之一，则仅应删除培训课程。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-04-01T18:47:45.570

标识关系意味着子实体完全依赖于父实体的存在。

**示例**帐户表人员表和人员帐户。人员帐户表仅通过帐户和人员表的存在来标识。

非标识关系是指子表不通过父表的存在来标识。

**示例**作为 accountType 和 account.accountType 表的表不标识存在 account 表。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-02-10T05:14:55.007

就像下面链接中很好解释的那样，识别关系有点像 ER 概念模型中与其父级的弱实体类型关系。用于数据建模的 UML 样式 CAD 不使用 ER 符号或概念，关系的种类是：识别、非识别和非特定。

标识关系是父/子关系，其中子实体是一种弱实体（即使在传统的 ER 模型中，它也称为标识关系），其自身属性没有真正的主键，因此无法由其自身唯一标识. 在物理模型上，对子表的每次访问都将依赖于（包括语义上）父主键，该主键变成子主键的一部分或全部（也是外键），通常会产生复合键在孩子方面。子项本身的最终现有密钥只是伪密钥或部分密钥，不足以识别该类型实体或实体集的任何实例，没有父项的 PK。

非标识关系是完全独立实体集的普通关系（部分或全部），其实例不依赖于彼此的主键来唯一标识，尽管它们可能需要外键来实现部分或全部关系，但不是作为孩子的主键。孩子有自己的主键。父母同上。两者独立。根据关系的基数，一个的 PK 作为 FK 到另一个（N 侧），如果是部分的，可以为空，如果是全部，则不能为空。但是，在这样的关系中，FK 永远不会是孩子的 PK，就像识别关系一样。

[http://docwiki.embarcadero.com/ERStudioDA/XE7/en/Creating_and_Editing_Relationships](http://docwiki.embarcadero.com/ERStudioDA/XE7/en/Creating_and_Editing_Relationships)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2018-01-21T07:25:36.727

从父级迁移到子级的属性是否有助于**识别¹**子级？

*   如果**是**：标识依赖存在，关系是标识的，子实体是“弱的”。
*   如果**不是**：标识依赖不存在，关系是非标识的，子实体“强”。

请注意，识别依赖意味着存在依赖，但反之则不然。每个非 NULL FK 都意味着没有父级的子级不能存在，但仅此一项并不能确定关系。

有关这方面的更多信息（以及一些示例），请查看[ERwin 方法指南](https://support.ca.com/cadocs/0/CA%20ERwin%20Data%20Modeler%20r8-ENU/Bookshelf_Files/PDF/ERwin_Methods.pdf)的“识别关系”部分。

PS我意识到我参加聚会（非常）迟到了，但我觉得其他答案要么不完全准确（根据存在依赖而不是身份依赖来定义它），要么有点曲折。希望这个答案能提供更多的清晰度......

* * *

*¹孩子的 FK 是孩子的 PRIMARY KEY 或（非 NULL）UNIQUE 约束的一部分。*

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-04-19T12:07:51.350

一个很好的例子来自订单处理。来自客户的订单通常具有标识订单的订单号、每个订单出现一次的一些数据（例如订单日期和客户 ID）以及一系列行项目。每个行项目包含一个项目编号，用于标识订单中的行项目、订购的产品、该产品的数量、产品的价格以及行项目的金额，可以通过将数量乘以价格。

标识行项目的编号仅在单个订单的上下文中标识它。每个订单中的第一个行项目是项目编号“1”。行项目的完整标识是项目编号及其所属的订单编号。

因此，订单和订单项之间的父子关系是一种识别关系。ER 建模中一个密切相关的概念称为“子实体”，其中行项目是订单的子实体。通常，子实体与其从属的实体具有强制性的子-父标识关系。

在经典数据库设计中，LineItems 表的主键是 (OrderNumber, ItemNumber)。今天的一些设计师会给一个项目一个单独的 ItemID，作为主键，并由 DBMS 自动递增。在这种情况下，我推荐古典设计。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-09-09T21:22:39.363

[对Daniel Dinnyes 回答](https://stackoverflow.com/a/44906252/798677)的补充：

在非标识关系中，您不能将相同的主键列（例如“ID”）两次具有相同的值。

但是，通过标识关系，**您可以让“ID”列的相同值显示两次**，只要它具有不同的“otherColumn_ID”外键值，因为主键是两列的组合。

请注意，FK 是否为“非空”并不重要！;-)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-09-29T12:00:58.007

识别关系存在于两个强实体之间。非识别关系可能并不总是强实体和弱实体之间的关系。可能存在子实体具有主键但其实体的存在可能取决于其父实体的情况。

例如：卖方与书籍之间的关系可能存在，其中卖方可能有自己的主键，但仅在出售书籍时才创建其实体

基于比尔·卡尔文的参考

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-08-06T12:47:38.133

假设我们有这些表：

```
user
--------
id
name

comments
------------
comment_id
user_id
text 
```

这两个表之间的关系将识别关系。因为，评论只能属于其所有者，不能属于其他用户。例如。每个用户都有自己的评论，当用户被删除时，该用户的评论也应该被删除。

# objective-c - 在 NSString 中搜索网络链接

> ID：762939
> 
> 赞同：2
> 
> 时间：2009-04-18T05:07:28.730
> 
> 标签：objective-c, regex, iphone

我有一个带有网络链接的 NSString。我需要在以 http:// 开头的字符串中查找所有 Web 链接。做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T05:46:38.997

方法

```
- (NSString *)stringByEvaluatingJavaScriptFromString:(NSString *)script 
```

使您能够运行自定义 JavaScript。JavaScript 可能可以访问 DOM，如果可以的话，提取所有锚标记并返回它们应该很简单。

当然，我只写过最小的 iPhone 应用程序，而且对 JavaScript 或 DOM 不是很熟悉，所以我在这里可能有点离谱。

查看 DOM 和 JavaScript 可能很简单

```
anchors = [htmlview_object stringByEvaluatingJavaScriptFromString @"document.anchors"]; 
```

但是，再一次，我真的不知道我在说什么。

尝试这个：

```
javascript = @"function return_links() {\n"
"    var a = new Array;\n"
"    for (i = 0; i < document.anchors.length; i++) {\n"
"        a.push(document.anchors[i].href);\n"
"    }\n"
"    return a.join(\"\\n\");\n"
"}\n"
"return_links();\n";
links = [htmlview_object stringByEvaluatingJavaScriptFromString javascript]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T06:16:11.373

最好的方法是在 NSString 和 HTML Parser 中查找链接，请参阅[Parsing HTML on the iPhone](https://stackoverflow.com/questions/405749)。如果您必须使用正则表达式（请参阅[Can you provide some examples of why it is hard to parse XML and HTML with a regex?](https://stackoverflow.com/questions/701166)为什么不应该），[PCRE](http://sourceforge.net/projects/objpcre/)似乎可用于 iPhone。链接的一个常见且有缺陷的正则表达式是`/href="(.*?)"/`.

当然，可用的最佳解析器可能是原生 html 查看小部件，并且由于它使您能够运行 JavaScript（请参阅我对原始问题的原始答案），您应该能够从 DOM 中提取锚点（document.anchors ) 并使用 document.write() 和其他 DOM 方法编写/重写您需要的任何内容。

# c# - 在 C# 中反映类型的接口

> ID：762945
> 
> 赞同：0
> 
> 时间：2009-04-18T05:14:38.217
> 
> 标签：c#, reflection, interface

如何反映 .NET 中给定类型（类或接口）实现的接口？

由于所反映的类型将是通用的（无论是在实现意义上还是在语义意义上），最好这样做而不必硬编码程序集名称，尽管我意识到我可以从 Type 类中获得这个名称任何给定类型。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T05:20:03.477

调用 Type.GetInterfaces()。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T05:33:06.143

Type.GetInterfaces() 只会让您*声明*接口（MSDN 应该有解释这一点的文档）。要获得继承的接口，您必须自己完成工作。类似于：*_*

```
 using System;
using System.Linq;

public static IEnumerable<Type> GetAllInterfacesForType(this Type type)
{
   foreach (var interfaceType in type.GetInterfaces())
   {
       yield return interfaceType;
       foreach (var t in interfaceType.GetAllInterfacesForType())
           yield return t;
   }
}

public static IEnumerable<Type> GetUniqueInterfacesForType(this Type type)
{ return type.GetAllInterfaces().Distinct(); } 

```

如果它不能直接编译，我会立即写下这个，很抱歉。

# c - 从整数中获取浮点值

> ID：762953
> 
> 赞同：5
> 
> 时间：2009-04-18T05:26:03.960
> 
> 标签：c, objective-c, iphone

如何从整数除法中获得浮点数或实数？例如：

```
double result = 30/233; 
```

产量为零。我想要带小数位的值。

然后如何格式化以便在与字符串一起使用时只显示两位小数？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-18T05:33:53.737

您可以在分子或分母上加一个小数：

```
double result = 30.0 / 233;
double result = 30 / 233.0; 
```

对这两个数字中的任何一个进行类型转换也可以。

至于问题的第二部分，如果你使用 printf 风格的格式字符串，你可以这样做：

```
sprintf(str, "result = %.2f", result); 
```

基本上，“.2”表示要在小数点后输出多少位。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-19T08:49:42.730

如果你有一个整数（不是整数常量）：

```
int i = 20;
int j = 220;
double d = i/(double)j; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-22T14:31:16.983

这是最简单的方法来做你想要达到的目标，我认为..

```
double result = 30/233.0f; 
```

对于 iOS 开发（iPhone/iPad/等）最好使用浮点类型。

```
float result = 30/233.0f; 
```

# vb.net - 使用项目资源的 VB.NET 图像数组

> ID：762954
> 
> 赞同：1
> 
> 时间：2009-04-18T05:27:06.500
> 
> 标签：vb.net, arrays, image

我需要使用对资源文件夹的引用来制作一组图像。

以下是我的代码，它不起作用：

```
Dim imgPictures(8) As Image
imgPictures(0) = Image.FromFile(My.Resources.cat_1.ToString) 
```

我如何为此任务引用位于资源文件夹中的图像？

干杯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T06:21:55.837

你可以使用`My.Resource.GetString("ResourceKey{0}")`它的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T14:36:09.503

在代码中引用资源的最简单方法是将其添加到项目资源中。

*   右键单击项目并选择属性
*   选择资源选项卡
*   将组合框更改为图像
*   从添加资源组合按钮中选择“添加现有”图像
*   选择你的形象

然后，您可以使用以下代码直接在代码中引用图像

```
Dim img = My.Resources.NameOfTheImage 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-03T11:55:14.863

```
Dim imgPictures(8) As Image
imgPictures(0) = My.Resources.ResourceManager.GetString("myResourceName") 
```

...

```
' For assigning a resource to a image control based on your array 
' of strings use something  like this:

Me.picture1.Image = My.Resources.ResourceManager.GetObject(arr(i)) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-26T06:37:17.747

我认为 JaredPar 走在了正确的轨道上，但还需要更多信息。

从本质上讲，它有点取决于资源的存储方式。（如果您正在寻找资源的路径，您很可能需要考虑反射。）

* * *

如果您的图像是嵌入的或内容，您可以直接引用它们：

-（在Visual Studio中右键单击图像>属性>构建操作=“嵌入式资源”

-（在Visual Studio中右键单击图像>属性>构建操作=“内容”；还确保复制到输出目录=“始终复制”）

```
Dim imgPictures(8) As Image
imgPictures(0) = My.Resources.NameOfImage1
imgPictures(1) = My.Resources.NameOfImage2
... 
```

如果您的图像只是在一个文件夹中：

```
Dim imgPictures(8) As Image
imgPictures(0) = Bitmap.FromFile( <filename1> )
imgPictures(1) = Bitmap.FromFile( <filename2> )
... 
```

斯科特

# c# - 可以通过访问类型来限制对对象属性的访问吗

> ID：762959
> 
> 赞同：0
> 
> 时间：2009-04-18T05:29:02.313
> 
> 标签：c#

我想将对象的属性设置为只读，但我希望允许访问更改属性值的某些类除外。我该怎么做呢？

```
class Restricted ()
{ 

public int Property1{get; }
public int Property2{get; }

} 
```

如果我做 ：

```
public int Property1{ get; private set;} 
```

如何选择允许设置此属性的类？检查类型？这是一种有效的方法和安全吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T05:35:44.030

你不能，至少不能单独使用语言。C# 中的访问修饰符是：

*   public：任何人都可以设置该属性
*   private：只有该类中的代码才能设置该属性
*   protected：只有此类或子类中的代码才能设置该属性
*   internal：只有此程序集（或 InternalsVisibleTo 程序集）中的代码才能设置该属性
*   protected internal：只有此类或子类或此程序集（或 InternalsVisibleTo 程序集）中的代码才能设置该属性

“特定类可以设置属性”没有修饰符，类似于 C++ 中的友元声明。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T06:00:33.003

您可以创建[朋友程序集](http://msdn.microsoft.com/en-us/library/0tke9fxk(VS.80).aspx)。也就是说，将您类的内部方法的访问权限授予另一个程序集中的所有类。我不认为你可以逐个班级地做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T05:38:54.100

如果您控制要授予设置器访问权限的类，则可以将属性集标记为“内部”，然后将所有类编译到同一个程序集中。这样，任何其他使用你的类的东西都不能使用 setter。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T05:55:37.850

通常使用只允许读取访问的接口。

```
public interface IPublicProperties
{
  int Property1 { get; }
  int Property2 { get; }
}

internal class Restricted : IPublicProperties
{ 
  public int Property1 { get; set; }
  public int Property2 { get; set; }
} 
```

缺点是，使用 setter 的类需要将接口转换为实际类。好消息是，在大多数情况下，从长远来看，使用接口是有好处的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T07:41:28.423

这些方法在 C++ 中工作，无需使用`friend`访问说明符。我不确定他们是否会在 C# 中工作。另外，在漫长的一天后看到您的问题后，这只是我的想法，因此它可能充满了错误。

一种方式：类将自身转换为成员可变的私有基。缺点：任何其他类都可以调用解锁。

```
 #include <iostream>

  struct unlocked { 
      int a;
      int b;
      //virtual ~unlocked(); // don't call delete on a unlocked
  };

  class locked : private unlocked {

     public:
     locked() {
        a = 0 ;  // accessible within locked
        b = 1 ;
    }

     unlocked& unlock( ) {
        return *this ;
     } 

     void print( std::ostream& o ) {
        o << " a = " << a << ", b = " << b << std::endl ;
     }

  } ; 
```

用法：

```
 int main() {

     locked foo ;
     foo.print( std::cout );
     // foo.a = 1 ; illegal
     foo.unlock().a = 1 ;
     foo.print( std::cout ) ;
     std::cout << &foo << " " << &(foo.unlock()) << std::endl;
  } 
```

* * *

另一种方式：调用 unlock，一个类`key' must be passed. Class`key的实例`is a protected inner class of public class 'keyed'. Only class`keyed `can mutate class 'locked`。缺点：`locked`必须私下继承`keyed`，才能`keyed::key`对`locked`. 但是因为两者`keyed`都`key`没有成员，所以从它们继承几乎没有开销。您可以`keyed`按原样使用，或者更好地从它继承。

```
 #include <iostream>

  class locked ;

  class keyed ;

  class keyed {
     protected:
      struct key{};

     public:
     void mutateLocked( locked& );
  };

  struct unlocked { 
      int a;
      int b;
      void print( std::ostream& o ) {
        o << this << " a = " << a << ", b = " << b << std::endl ;
      }
  };

  class locked : private unlocked, private keyed {

     public:
     locked() {
        a = 0 ;
        b = 1 ;
    }

     unlocked& unlock( keyed::key& k) {
        return *this ;
     } 

     using unlocked::print; 
  } ;

  void keyed::mutateLocked(locked& m ) {
     key k ;
     m.print(std::cout) ;
     unlocked& n = m.unlock( k ) ;
     n.a = 55;
     n.b = 77;
     n.print(std::cout);
  } 
```

用法：

```
 int main() {

     keyed k ;
     //keyed::key kk; // not accessible

     locked foo ;
     //unlocked& bar = (unlocked) foo; // not accessible
     foo.print( std::cout );
     //foo.a = 1 ;  // not accessible
     //foo.unlock(kk).a = 1 ;
     k.mutateLocked(foo);
     foo.print( std::cout ) ;
 } 
```

# c# - 将数据存储在 C# 源文件与 XML 等中......？

> ID：762960
> 
> 赞同：2
> 
> 时间：2009-04-18T05:29:13.670
> 
> 标签：c#, xml, serialization, xna, yaml

这是一个 C# 问题。

如果有人尝试将他们的数据（例如配置文件）存储在 *.cs 文件而不是 XML 中，我只是在徘徊？

我真的很讨厌 XML。每次需要一些数据时解析类似 html 的结构的整个想法似乎很愚蠢。

是否有 XML 的轻量级替代品（如 YAML）？在我的情况下，我实际上需要为（游戏）关卡存储一些数据，其中有很多不同的对象、地形类型等......在一个平面文件中，以便我稍后阅读。

我想我可以序列化我的**Level**类，但我希望数据文件在任何文本编辑器中都是可编辑的。

欢迎任何帮助，谢谢！

PS：关于 .cs 文件，我忘了提到我希望能够通过编辑器在游戏中创建（和保存）新关卡。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T05:44:18.160

我在游戏行业工作多年，我们使用 XML 是因为它有最好的工具支持。Yaml 或 Ini 文件用于配置，但游戏数据存储在 XML 中。当然，我们通常拥有将 XML 转换为二进制代码的工具，用于发布游戏，但在开发和自定义游戏工具开发过程中，XML 只是摇摆不定。

有时 XML 是满足您需求的合适工具，不要仅仅因为它们在某些领域不是最好的（比如 Ajax（传输）与数据定义）而对技术产生偏见

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T06:11:07.300

为什么不（xml）？

我没有看到不使用 XML 的情况，特别是考虑到您想在文件中存储不同类型的信息。

也就是说，对于 .cs 文件方法，我建议构建应用程序代码，以便加载初始化所需数据的代码，而不是在文件中查找数据。它为您提供了一个清晰的模式（编译 + 加载），因为您现在正在加载一个初始化类，而不是在文件中查找数据。尽可能多地添加以使那里的配置尽可能简单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T06:37:39.687

由于您不想使用 XML，我建议您创建自己的可文本编辑的文件格式。

```
PROPERTIES
name = First Level
number = 1
END

MONSTERS
Barbarian
pos = (3, 6)
health = 2

Dragon
pos = (10, 10)
health = 8
END 
```

依此类推，以获取您需要的任何其他内容。

自己创建解析器非常简单。几乎只是逐行读取文件。在第一行，您会看到标题是 PROPERTIES，因此您可以读入属性，直到读入 END 行。对于您拥有的任何其他标题也是如此。有很多方法可以改变这一点，因此您可以按照自己的意愿制作语法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T05:31:49.390

ini 文件？

```
[section]
key=value 
```

在仔细阅读您的问题并思考之后，XML 在游戏行业中非常标准，因为它的结构、支持子项以及任何文本编辑器都可以手动编辑。

想到的一些使用 XML 文件的游戏：

魔兽世界
孤岛危机
命令与征服3

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T08:22:19.043

> 每次需要一些数据时解析类似 html 的结构的整个想法似乎很愚蠢。

如果您不打算使用 XML 或 YAML，您将不得不编写自己的解析器和验证器，而现在您已经进入了愚蠢统治的领域。XML 很烦人，但如果没有用于操作它的工具生态系统则更糟。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-04T13:19:30.687

我们喜欢 JSON 作为配置文件——它的用途非常广泛。

它易于手动编辑，易于解析和生成（包括强大的 .NET 库 - MS 和 3rd 方），并且非常强大 - 一种具有良好基本数据类型的 XML。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-18T05:34:17.590

如果您的数据不是太复杂或分层，您可以将其存储在属性文件格式中，如下所示：

```
level.name=My Level
level.mapfile=Map.txt 
```

等等

另一方面，XML 在 C# 中通过序列化（ISerializable 或 DataContract）非常容易使用，您不必编写任何解析代码，框架会为您完成所有工作。在文本编辑器中编辑 XML 不会那么糟糕！

如果您愿意在 XML 上做出一点妥协，您可以使用[NameValueCollection](http://msdn.microsoft.com/en-us/library/system.collections.specialized.namevaluecollection.aspx)来保存您的配置项。然后，您可以使用内置的 .NET 序列化对其进行序列化。该文件将是 XML，但它是一种非常简单、易于编辑的格式，您不必担心任何手动类型转换/验证。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-18T05:39:57.267

如果您以前听说过它，请不要这样做，但您应该看看这个 YAML 的东西。它非常酷，拥有[`its own homepage`](http://www.yaml.org/)一切。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-18T08:07:40.343

甚至认为相当重的 XML 通常是在文件中存储数据的最佳选择，而 LINQ for XML 确实使读取和写入该数据变得更加容易。

如果您的数据变得非常复杂，另一种选择是使用 SQLite 之类的东西，我以前使用过它，对于单用户访问，它确实非常快速且易于使用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-19T14:48:10.560

听起来您想要一种可以在文本编辑器中编辑的二进制格式。不幸的是（直到每个人都能流利地使用十六进制编辑器）在速度和易于编辑之间存在不可避免的权衡。

由于二进制格式基本上是对您的状态进行编码的最小字节集的非常密集的包装，因此解析起来既快速又容易。另一方面，XML 格式很容易编辑。一种可能的解决方案是创建两者并构建一个在它们之间转换的简单程序。然后，您的高级用户将使用此程序将您的关卡转换为 XML、编辑它们，然后再将它们转换回来。

如果您最终在这种情况下使用 XML，我建议您使用多个文件，也许每个对象一个。听起来你打算拥有一个复杂的世界。把它切碎一点是有道理的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-19T15:04:10.647

如果您使用 .NET 配置系统，它会为您进行 XML 解析。请参阅[如何：使用 ConfigurationSection 创建自定义配置部分](http://msdn.microsoft.com/en-us/library/2tw134k3.aspx)。即使它位于 ASP.NET 部分中，它也适用于所有 .NET 代码。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-28T17:12:25.600

从技术上讲，您不需要解析 XML，只需创建一个数据模型，然后序列化为 XML 并从 XML 反序列化。在 Visual Studio 中为数据模型构建一个编辑器也非常简单，方法是让 TreeView 或 ListView 显示数据模型中的每个项目/对象，并使用 PropertyEditor 编辑所选对象的属性。使用 OpenFileDialog 和 SaveFileDialog 让用户选择 XML 文件和 XmlSerializer 来加载和保存您的数据模型。我向你保证真的无痛！:-)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-06-28T17:31:31.347

我在游戏行业工作，我们确实几乎专门使用 XML 来完成您所描述的工作。
原因如下：
1\. 它易于理解并且是标准
2\. 它在库方面具有出色的支持
3\. 它可以验证 - 这在创建数据编辑器时是必不可少
的 4\. 它是结构化的
5\. 它是人类可读的，因此很容易可调试

您说您讨厌仅仅为了获得一个价值而不得不拖网它的事实向我表明您应该使用那里的众多 xml 解析器之一。相信我，这很容易而且有效

人们使用它是有充分理由的。是的，它确实有它的缺点，即冗长等，但相信我的优点远远超过缺点！

# windows - SetThreadAffinityMask 被忽略....有什么想法吗？

> ID：762961
> 
> 赞同：1
> 
> 时间：2009-04-18T05:29:47.757
> 
> 标签：windows, winapi, setthreadaffinitymask

更新：我发现了问题 - 令人尴尬/讽刺的是，它是在错误的线程中调用 SetThreadAffinity()，而不是主线程（程序启动很混乱......）

现在一切正常，感谢所有帮助！我已经为参加我的小型调试会议的每个人投了赞成票。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T05:43:30.110

像这样称呼它有什么不同吗？：

```
DWORD_PTR mask = 1; 
SetThreadAffinityMask(GetCurrentThread(), mask); 
```

您的线程句柄是否具有必要的[访问权限](http://msdn.microsoft.com/en-us/library/ms686769(VS.85).aspx)？：

> **Windows Server 2003 和 Windows** **XP/2000**：句柄必须具有 THREAD_SET_INFORMATION 和 THREAD_QUERY_INFORMATION 访问权限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T07:47:17.660

尽管我使用它们已经有几个月了，但我对该功能没有任何问题。

以下是您可能需要检查的一些事项：

*   没有冲突的 SetProcessAffinityMask 和 SetThreadAffinityMask
*   如果处理器 2 上有一个线程，那么程序的其余部分可能正在使用处理器 1
*   显示[GetCurrentProcessorNumber](http://msdn.microsoft.com/en-us/library/ms683181(VS.85).aspx)以测试它是否在正确的 CPU 上运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T07:59:39.863

你在做什么似乎是正确的，你可以试试[SetThreadIdealProcessor](http://msdn.microsoft.com/en-us/library/ms686253(VS.85).aspx "设置线程理想处理器")吗？

# xml - 测试 Atom 服务器的最佳方法是什么？

> ID：762997
> 
> 赞同：2
> 
> 时间：2009-04-18T06:01:16.700
> 
> 标签：xml, testing, atom-feed

我正在设置一个 Atom 服务器来充当后端数据库的 REST-ful 接口。

我想进行一些测试以确保： - 输出符合 Atom 和 AtomPub - 生成的数据是数据库状态的正确表示

我对在已知状态下设置数据库的概念感到满意。但我不确定最好的测试策略。

看来我可以使用 JUnit 测试，根据 Atom 模式验证结果，但我会对更轻量级的策略感兴趣。

我非常喜欢 Selenium，但不能完全理解以非交互模式设计测试。请求和操作 Atom 提要不像 html 浏览。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T16:33:37.473

除了 Selenium 之外，还有一些工具可以帮助测试 ATOM 服务 - 例如，看看[JMeter](http://jakarta.apache.org/jmeter/index.html)，它可以帮助对 PUT / POST 请求进行编码。

不过，老实说，对于像 ATOM 这样易于编码的 API，如果直接使用 JUnit，最终可能会同样高效。除非您只是想做一次性的探索性测试，否则您最终会编写代码和/或脚本，无论您使用什么工具，熟悉新工具只会增加测试开发时间。******************************`***********