# StackOverflow 问答 000203000-000203999

# web-applications - 如何将 Web 应用程序部署到桌面？

> ID：203007
> 
> 赞同：6
> 
> 时间：2008-10-14T22:00:54.447
> 
> 标签：web-applications, installation, deployment

我通常构建基于 Web 的应用程序。但是，有时需要将这些应用程序分发到各种平台，并让它们更像常规应用程序而不是 Web 应用程序。一个快速的解决方案可能是创建一个图标来打开没有菜单、url 栏或图标的浏览器。

看起来 IE 可能对此有一些选择。我对 Firefox 的搜索并没有出现太多。我希望我的解决方案可以在 Windows、Linux 和 Mac 上运行。而且我不介意为每个平台构建不同的解决方案。

一个想法，构建一个小型 XULRunner 应用程序，它只是一个浏览器窗口。但是，XULRunner 的下载大小为 10MB。当用户可能已经拥有浏览器时，这似乎有些过分了。另一个选项可能只是一个安装程序，它会创建一个图标和一个包含 URL 的浏览器链接。这会起作用，但不会使 Web 应用程序看起来像一个普通的应用程序。

您对如何在多个平台上部署看起来更像常规应用程序的 Web 应用程序有什么想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T22:25:08.720

Adobe AIR 应该支持 Linux Real Soon Now™。获得类似浏览器的基本功能非常简单，但它的 Webkit 实现并不完美。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-15T00:52:34.757

用于 Firefox 的 Prism 可以做到这一点。[Fluid](http://fluidapp.com/)是一个 Mac 等价物，它围绕 WebKit 框架创建一个独立的应用程序容器。这很好，但占用空间也很大（10MB）。压缩到大约 3MB 作为一个 zip，但我从未测试过 Fluid 生成的应用程序的可移植性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T22:04:55.593

有专门为此设计的[Google Gears 。](http://gears.google.com/)然而，它暂时只能在 Windows 上运行，但它打算移植到 Linux/Mac，尽管目前没有计划的发布日期。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T22:05:03.703

我不确定您的具体需求，但从 .NET 方面来看，您可以创建一个包含浏览器控件的应用程序，并在默认情况下简单地导航到您的 Web 应用程序，并且不包含任何导航选项！

这会让你得到你想要的，这是一个没有菜单等的浏览器，占用空间也会很小。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T22:07:07.150

您可以使用 Google 齿轮为用户提供创建桌面快捷方式的选项。[请记住，牛奶](http://rememberthemilk.com/)可以做到这一点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-14T22:08:55.850

首先，您需要托管 Web 应用程序，购买空间（.NET 的 www.discountasp.net 非常棒）然后使用可以在 Linux、Mac 和 Windows 下运行的[Prism 。](http://labs.mozilla.com/projects/prism/)

请记住，客户端始终需要连接到网络，除非您的应用程序在[Google Gears](http://gears.google.com/)下运行，并且所有内容都存储在本地并且可以在没有网络连接的情况下使用，请注意，为此，您需要更改代码中的一些内容。您可以[使用此链接启动 Google Gears](http://code.google.com/apis/gears/design.html)。:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-14T22:03:57.763

FireFox 有 Prism 插件，谷歌浏览器内置了这个功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T22:04:27.637

如果您使用的是 java，则可以使用轻量级 servlet 容器，例如[Winstone](http://winstone.sourceforge.net/)。例如 Winstone 的使用，看看使用[Hudson](http://hudson-ci.org/)持续集成服务器是多么容易。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-14T22:11:36.983

我们正在考虑并且已经为此使用虚拟机进行了原型设计。虚拟机将是带有 tomcat 和 oracle 的 linux。我们可能还会使用安装在 linux 中的 firefox 来控制这方面。用户将通过 VM 看到他们习惯的浏览器界面。应用程序结构与我们部署到内网服务器的结构相同，但实现是完全可移动且自包含的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-14T22:27:47.277

如果您的网络应用程序只是一个带有 Javascript 的独立 HTML 页面，您只需将页面保存到他们的系统并将扩展名从 .HTML 更改为 .HTA

有关 HTML 应用程序的更多信息：http: [//msdn.microsoft.com/en-us/library/ms536496 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms536496(VS.85).aspx)

希望这可以帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-15T00:32:17.557

您需要更具体地了解您正在开发的“网络应用程序”的类型，以及您的预期目标平台和受众。这将在很大程度上决定您可以使用什么技术。

如果您使用 java 进行开发，您可以将 jetty 与应用程序捆绑在一起，然后告诉用户“将浏览器指向[http://localhost:8080/whatever](http://localhost:8080/whatever)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-15T00:24:11.770

我自己为 ASP.NET Web 应用程序解决了这个问题，并将[一个原型](http://www.wynia.org/wordpress/jackalope/)组合在一起，它是 Web 服务器/Web 浏览器的组合。它当然不是跨平台的，并且真正针对 Windows/.NET，但它是另一种选择。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-01-30T12:20:43.220

我为 HTML5 游戏开发人员制作了一个应用程序，如果您想在 Windows 上运行您的 html5 游戏或应用程序，如本机应用程序，则无需托管或手动运行本地服务器即可访问 html5 功能。

WinApps Jx Builder 是一款应用程序，允许您将 HTML5、java 脚本、CSS 打包到一个可执行应用程序中，用于在 Windows 操作系统上运行 Native-Like 的 Windows。从现在开始，您只需双击即可在 Desktope 上运行 HTML5 网站、应用程序和游戏，其余的由 WinApps JX 负责。

你甚至不需要互联网，它的行为就像原生应用程序一样，没有地址栏或菜单或任何让它看起来像浏览器的东西

但是您需要在您的机器上安装 Google chrome 框架：

[谷歌浏览器框架](http://www.google.com/chromeframe/thankyou.html?prefersystemlevel=true&statcb)

[- WinApps Jx -](https://dl.dropboxusercontent.com/s/c96jppd51mxjpk2/WinApps%20Jx%20Builder.exe?dl=1&token_hash=AAGOY99OwM_zTMKez9YdjkITdeGz9e8jvXfw4Wy61hDgdg)

# java - Log4j 用法 - 登录到 Windows 事件日志时如何自定义事件 ID？

> ID：203013
> 
> 赞同：0
> 
> 时间：2008-10-14T22:02:27.797
> 
> 标签：java, logging, log4j

我正在向现有的 Java 应用程序添加 Windows 事件日志记录功能，并且我想利用事件 ID（我们的管理员已经在使用它们）。使用 NTEventLogAppender 记录时，有没有办法指定事件 ID？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T05:58:58.240

从我目前的研究来看，似乎无法从默认的 4096 修改事件 ID。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-01T12:08:55.433

查看[log4jna](http://log4jna.codeplex.com)。它是 log4j NTEventLogAppender 的替代品。它现在没有做你想做的事，但它“这么接近”。如果您仍然需要它，我们可以努力实现它。

# .net - 计算 AppDomain 中类的实例

> ID：203018
> 
> 赞同：1
> 
> 时间：2008-10-14T22:02:53.913
> 
> 标签：.net, appdomain

我想知道是否有一种方法可以通过编程方式或使用第三方工具（分析器？）来概述 AppDomain 中当前有多少类实例处于活动状态（包括或不包括派生类），甚至更好的是，它们在哪里已分配（不确定这是否可能）。

我知道我可以更改我自己的类以以某种方式包含一些运行计数器，但我也希望将它用于我无法控制的（托管）类。

这甚至可能吗？一些提示或关键字会有所帮助:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T22:04:47.043

我认为您想要使用的是 SOS 和 Windows 调试工具包。

Tess Ferandez 有一个很棒的博客，其中包含大量有关使用它的信息。

[http://blogs.msdn.com/tess/](http://blogs.msdn.com/tess/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T22:09:35.803

我几乎不敢回答，因为必须有很多更简单的方法，但是使用[adplus](http://msdn.microsoft.com/en-us/library/cc265629.aspx)进行挂起转储，然后使用[WinDbg](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx)和 Son of Strike 导航转储文件。

您还可以获得一个[分析器](http://msdn.microsoft.com/en-us/library/ms979205.aspx)，它将帮助您对挂起转储进行一些基本分析。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T22:21:02.440

我不认为有一种巧妙的方法可以通过反射来做到这一点，就像你可以枚举类或方法一样。[CLR Profiler](http://msdn.microsoft.com/en-us/library/ms979205.aspx)将附加到一个进程，然后报告分配了每个类的多少实例。[从理论上讲，您可以针对 CLR Profiler 使用的相同API](http://msdn.microsoft.com/en-us/library/ms404386.aspx)编写自己的代码，但我怀疑这会花费很多精力，而且不一定有启发性。

# c# - 如何从 ViewResult 中截取 HTML，对其进行修改并提供服务？

> ID：203022
> 
> 赞同：3
> 
> 时间：2008-10-14T22:03:54.533
> 
> 标签：c#, asp.net-mvc

我正在写一个简单的CMS。

我希望能够加载一个视图，将其包含在母版页中，然后扫描 HTML，以便我可以用我自己的博客输出替换一些自定义标签（如 {{blog}}），然后将其提供给浏览器。

如何从 ViewResult 访问 HTML 以拦截它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T16:09:45.870

这会很棘手，因为 ViewResult 将其响应直接写入 Response.Stream。因此，您可能必须处理 Response.Filter 属性才能将 ViewResult 输出到 MemoryStream，以便您可以在返回 ContentResult 之前操作内容。所有这一切都可能发生在 OnResultExecuting 中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-15T06:17:58.560

听起来你想写一个`ActionFilterAttribute`. 该属性有以下方法：

*   **OnActionExecuting** - 在装饰动作执行之前调用
*   **OnActionExecuted** - 在调用 action 方法之后，但在`ActionResult`渲染之前调用。
*   **OnResultExecuting** - 在呈现结果之前调用
*   **OnResultExecuted** - 在呈现结果后调用

这里有一个示例，它根据“Content-type”标头返回 JSON 或 XML 数据：[Create REST API using ASP.NET MVC that speak both Json and plain Xml](http://omaralzabir.com/create_rest_api_using_asp_net_mvc_that_speaks_both_json_and_plain_xml/ "使用 ASP.NET MVC 创建 REST API，它会说 Json 和普通 Xml")

# crystal-reports - 水晶报表中的 XHTML

> ID：203025
> 
> 赞同：1
> 
> 时间：2008-10-14T22:04:19.917
> 
> 标签：crystal-reports

是否可以在 Crystal Reports 中完全显示 XHTML？我有一个设置为使用 HTML 标签显示的字段，但它忽略了我需要的许多标签，例如

*   . 如果字体也由 XHTML 设置，那就太好了。

    如果没有，是否有具有 Crystal Reports 功能但更擅长呈现 XHTML 的报表工具？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T15:54:33.593

我没有测试太多 XTHML 文档，但我知道[Crystal-Clear](http://inetsoftware.de/products/crystalclear/)能够显示 HTML 文档以及 Crystal Reports。由于 Crystal-Clear 是一种 Java 解决方案，他们将 JEditorPane 与 HTMLEditorKit 一起使用。听起来这也将允许使用 XHTML 文档。由于 Crystal Clear 还可以打开 Crystal Reports 报表，您可以尝试使用此解决方案创建报表。您需要为包含 XHTML 的字段指定“文本解释”属性并执行报告。

# java - 在Java中列出文件的最佳方法，按修改日期排序？

> ID：203030
> 
> 赞同：262
> 
> 时间：2008-10-14T22:04:56.200
> 
> 标签：java, file, sorting

我想获取目录中的文件列表，但我想对其进行排序，以便最旧的文件排在第一位。我的解决方案是调用 File.listFiles 并根据 File.lastModified 重新排序列表，但我想知道是否有更好的方法。

编辑：按照建议，我当前的解决方案是使用匿名比较器：

```
File[] files = directory.listFiles();

Arrays.sort(files, new Comparator<File>(){
    public int compare(File f1, File f2)
    {
        return Long.valueOf(f1.lastModified()).compareTo(f2.lastModified());
    } }); 
```

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2008-10-14T22:12:55.687

我认为您的解决方案是唯一明智的方法。获取文件列表的唯一方法是使用[File.listFiles()](http://java.sun.com/javase/6/docs/api/java/io/File.html#listFiles())并且文档指出这不能保证返回文件的顺序。因此，您需要编写一个使用[File.lastModified()的](http://java.sun.com/javase/6/docs/api/java/io/File.html#lastModified())[Comparator](http://java.sun.com/javase/6/docs/api/java/util/Comparator.html)并将其与文件数组一起传递给[Arrays.sort()](http://java.sun.com/javase/6/docs/api/java/util/Arrays.html#sort(T[],%20java.util.Comparator))。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2017-06-08T21:25:54.177

**自 Java 8 以来的优雅解决方案：**

```
File[] files = directory.listFiles();
Arrays.sort(files, Comparator.comparingLong(File::lastModified)); 
```

* * *

**或者，如果您希望它按降序排列，只需将其反转：**

```
File[] files = directory.listFiles();
Arrays.sort(files, Comparator.comparingLong(File::lastModified).reversed()); 
```

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2010-11-22T17:06:34.537

如果您有很多文件，这可能会更快。这使用了 decorate-sort-undecorate 模式，以便每个文件的最后修改日期只获取*一次，*而不是每次排序算法比较两个文件时。这可能会将 I/O 调用的数量从 O(n log n) 减少到 O(n)。

不过，它的代码更多，所以只有在您主要关心速度并且在实践中它明显更快（我没有检查过）时才应该使用它。

```
class Pair implements Comparable {
    public long t;
    public File f;

    public Pair(File file) {
        f = file;
        t = file.lastModified();
    }

    public int compareTo(Object o) {
        long u = ((Pair) o).t;
        return t < u ? -1 : t == u ? 0 : 1;
    }
};

// Obtain the array of (file, timestamp) pairs.
File[] files = directory.listFiles();
Pair[] pairs = new Pair[files.length];
for (int i = 0; i < files.length; i++)
    pairs[i] = new Pair(files[i]);

// Sort them by timestamp.
Arrays.sort(pairs);

// Take the sorted pairs and extract only the file part, discarding the timestamp.
for (int i = 0; i < files.length; i++)
    files[i] = pairs[i].f; 
```

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2014-02-03T17:53:27.950

类似的方法是什么，但没有对 Long 对象进行装箱：

```
File[] files = directory.listFiles();

Arrays.sort(files, new Comparator<File>() {
    public int compare(File f1, File f2) {
        return Long.compare(f1.lastModified(), f2.lastModified());
    }
}); 
```

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2008-10-14T22:24:51.730

您还可以查看[apache commons IO](http://commons.apache.org/io/)，它具有内置的[最后修改比较器](http://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/comparator/LastModifiedFileComparator.html)和许多其他用于处理文件的不错的实用程序。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2015-10-05T19:04:09.447

在 Java 8 中：

`Arrays.sort(files, (a, b) -> Long.compare(a.lastModified(), b.lastModified()));`

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2013-07-12T22:41:06.567

## 如果可以在执行排序的同时修改或更新您正在排序的文件：

* * *

## Java 8+

```
private static List<Path> listFilesOldestFirst(final String directoryPath) throws IOException {
    try (final Stream<Path> fileStream = Files.list(Paths.get(directoryPath))) {
        return fileStream
            .map(Path::toFile)
            .collect(Collectors.toMap(Function.identity(), File::lastModified))
            .entrySet()
            .stream()
            .sorted(Map.Entry.comparingByValue())
//            .sorted(Collections.reverseOrder(Map.Entry.comparingByValue()))  // replace the previous line with this line if you would prefer files listed newest first
            .map(Map.Entry::getKey)
            .map(File::toPath)  // remove this line if you would rather work with a List<File> instead of List<Path>
            .collect(Collectors.toList());
    }
} 
```

## 爪哇 7

```
private static List<File> listFilesOldestFirst(final String directoryPath) throws IOException {
    final List<File> files = Arrays.asList(new File(directoryPath).listFiles());
    final Map<File, Long> constantLastModifiedTimes = new HashMap<File,Long>();
    for (final File f : files) {
        constantLastModifiedTimes.put(f, f.lastModified());
    }
    Collections.sort(files, new Comparator<File>() {
        @Override
        public int compare(final File f1, final File f2) {
            return constantLastModifiedTimes.get(f1).compareTo(constantLastModifiedTimes.get(f2));
        }
    });
    return files;
} 
```

这两种解决方案都创建了一个临时地图数据结构，以保存目录中每个文件的恒定最后修改时间。我们需要这样做的原因是，如果在执行排序时您的文件正在更新或修改，那么您的比较器将违反比较器接口通用合同的传递性要求，因为最后修改时间可能在比较期间发生变化。

另一方面，如果您知道在排序过程中文件不会被更新或修改，那么您几乎可以摆脱提交给这个问题的任何其他答案，我偏爱：

## Java 8+（排序期间没有并发修改）

```
private static List<Path> listFilesOldestFirst(final String directoryPath) throws IOException {
    try (final Stream<Path> fileStream = Files.list(Paths.get(directoryPath))) {
        return fileStream
            .map(Path::toFile)
            .sorted(Comparator.comparing(File::lastModified))
            .map(File::toPath)  // remove this line if you would rather work with a List<File> instead of List<Path>
            .collect(Collectors.toList());
    }
} 
```

[注意：我知道您可以通过在排序流操作中使用Files::getLastModifiedTime](https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/nio/file/Files.html#getLastModifiedTime(java.nio.file.Path,java.nio.file.LinkOption...)) api来避免在上述示例中与 File 对象进行转换，但是，您需要在 lambda 中处理已检查的 IO 异常，这总是很痛苦. 我会说如果性能足够关键以至于翻译是不可接受的，那么我要么通过将其作为 UncheckedIOException 传播来处理 lambda 中的已检查 IOException，要么完全放弃 Files api，只处理 File 对象：

```
final List<File> sorted = Arrays.asList(new File(directoryPathString).listFiles());
sorted.sort(Comparator.comparing(File::lastModified)); 
```

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2014-08-12T00:44:57.023

进口：

```
org.apache.commons.io.comparator.LastModifiedFileComparator 
```

[阿帕奇公地](http://commons.apache.org/proper/commons-io/javadocs/api-release/index.html?org/apache/commons/io/comparator/package-summary.html)

代码 ：

```
public static void main(String[] args) throws IOException {
        File directory = new File(".");
        // get just files, not directories
        File[] files = directory.listFiles((FileFilter) FileFileFilter.FILE);

        System.out.println("Default order");
        displayFiles(files);

        Arrays.sort(files, LastModifiedFileComparator.LASTMODIFIED_COMPARATOR);
        System.out.println("\nLast Modified Ascending Order (LASTMODIFIED_COMPARATOR)");
        displayFiles(files);

        Arrays.sort(files, LastModifiedFileComparator.LASTMODIFIED_REVERSE);
        System.out.println("\nLast Modified Descending Order (LASTMODIFIED_REVERSE)");
        displayFiles(files);

    } 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-03-29T16:58:23.310

```
public String[] getDirectoryList(String path) {
    String[] dirListing = null;
    File dir = new File(path);
    dirListing = dir.list();

    Arrays.sort(dirListing, 0, dirListing.length);
    return dirListing;
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2021-07-29T06:26:45.157

如果有人正在寻找它，这是 Kotlin 的做法：

```
val filesList = directory.listFiles()

filesList?.let{ list ->
    Arrays.sort(list) { 
        f1, f2 -> f2.lastModified().compareTo(f1.lastModified()) 
    }
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-03-30T10:21:20.513

```
Collections.sort(listFiles, new Comparator<File>() {
        public int compare(File f1, File f2) {
            return Long.compare(f1.lastModified(), f2.lastModified());
        }
    }); 
```

`listFiles`ArrayList 中所有文件的集合在哪里

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-03-16T23:15:16.090

您可以尝试番石榴[订购](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/collect/Ordering.html)：

```
Function<File, Long> getLastModified = new Function<File, Long>() {
    public Long apply(File file) {
        return file.lastModified();
    }
};

List<File> orderedFiles = Ordering.natural().onResultOf(getLastModified).
                          sortedCopy(files); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-06-11T09:16:30.040

您可以使用 Apache [LastModifiedFileComparator](http://commons.apache.org/proper/commons-io/javadocs/api-1.4/org/apache/commons/io/comparator/LastModifiedFileComparator.html) 库

```
 import org.apache.commons.io.comparator.LastModifiedFileComparator;  

File[] files = directory.listFiles();
        Arrays.sort(files, LastModifiedFileComparator.LASTMODIFIED_COMPARATOR);
        for (File file : files) {
            Date lastMod = new Date(file.lastModified());
            System.out.println("File: " + file.getName() + ", Date: " + lastMod + "");
        } 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-08-02T19:48:47.430

```
private static List<File> sortByLastModified(String dirPath) {
    List<File> files = listFilesRec(dirPath);
    Collections.sort(files, new Comparator<File>() {
        public int compare(File o1, File o2) {
            return Long.compare(o1.lastModified(), o2.lastModified());
        }
    });
    return files;
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2021-11-18T11:51:31.573

让数组名称-> 文件。

* * *

```
Ascending -> Arrays.sort(files, (o1, o2) -> Long.compare(o1.lastModified(), o2.lastModified()));

Descending -> Arrays.sort(files, (o1, o2) -> Long.compare(o2.lastModified(), o1.lastModified())); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-11-27T06:06:16.233

当我在搜索相同的问题但在`android`. 我并不是说这是按上次修改日期获取排序文件的最佳方法，但它是我发现的最简单的方法。

下面的代码可能对某人有帮助-

```
File downloadDir = new File("mypath");    
File[] list = downloadDir.listFiles();
    for (int i = list.length-1; i >=0 ; i--) {
        //use list.getName to get the name of the file
    } 
```

谢谢

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-07-30T08:58:11.883

有一种非常简单方便的方法来处理该问题，而无需任何额外的比较器。只需将修改后的日期编码到带有文件名的字符串中，对其进行排序，然后再次将其剥离。

使用固定长度 20 的字符串，将修改后的日期（长）放入其中，并用前导零填充。然后只需将文件名附加到此字符串：

```
String modified_20_digits = ("00000000000000000000".concat(Long.toString(temp.lastModified()))).substring(Long.toString(temp.lastModified()).length()); 

result_filenames.add(modified_20_digits+temp.getAbsoluteFile().toString()); 
```

这里会发生什么：

文件名 1：C:\data\file1.html 上次修改时间：1532914451455 上次修改时间 20 位：00000001532914451455

文件名 1：C:\data\file2.html 上次修改时间：1532918086822 上次修改时间 20 位：00000001532918086822

将电影名转换为：

文件名1：00000001532914451455C:\data\file1.html

文件名2：00000001532918086822C:\data\file2.html

然后，您可以对该列表进行排序。

您需要做的就是稍后再次剥离这 20 个字符（在 Java 8 中，您可以使用 .replaceAll 函数仅用一行将其剥离为整个数组）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-09-18T11:14:21.460

@jason-orendorf[答案](https://stackoverflow.com/a/4248059/1649029)的稍微现代化的版本。

**注意：**此实现保持原始数组*untouched*，并返回一个*新*数组。这可能是可取的，也可能不是可取的。

```
files = Arrays.stream(files)
        .map(FileWithLastModified::ofFile)
        .sorted(comparingLong(FileWithLastModified::lastModified))
        .map(FileWithLastModified::file)
        .toArray(File[]::new);

private static class FileWithLastModified {
    private final File file;
    private final long lastModified;

    private FileWithLastModified(File file, long lastModified) {
        this.file = file;
        this.lastModified = lastModified;
    }

    public static FileWithLastModified ofFile(File file) {
        return new FileWithLastModified(file, file.lastModified());
    }

    public File file() {
        return file;
    }

    public long lastModified() {
        return lastModified;
    }
} 
```

[但同样，所有的想法](https://stackoverflow.com/a/4248059/1649029)都归功于@jason-orendorf ！

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2022-01-28T11:00:22.690

在 java 6 中，最好的方法是：

```
 File[] listaArchivos = folder.listFiles();
            Arrays.sort(listaArchivos, new Comparator<File>() {
                @Override
                public int compare(File f1, File f2) {
                    return (f1.lastModified() < f2.lastModified()) ? -1 : ((f1.lastModified() == f2.lastModified()) ? 0 : 1);
                }
            }); 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2018-07-28T17:11:59.983

还有一种完全不同的方法可能更容易，因为我们不处理大量数字。

在检索所有文件名和 lastModified 日期之后，无需对整个数组进行排序，您可以在列表的正确位置检索到每个文件名后插入每个文件名。

你可以这样做：

```
list.add(1, object1)
list.add(2, object3)
list.add(2, object2) 
```

将 object2 添加到位置 2 后，它会将 object3 移动到位置 3。

# windows - 文件安全属性被文件复制搞砸了

> ID：203036
> 
> 赞同：3
> 
> 时间：2008-10-14T22:06:20.053
> 
> 标签：windows, winapi, file, copy, acl

我有一个更新我们产品的 Windows 服务。它将产品文件复制到临时目录，通常是“C:\Windows\Temp”，修补二进制文件，然后在重新启动时使用 MoveFileEx 将文件复制回安装目录，通常是“C:\Program Files\Product ”。安装目录中的文件从父文件夹继承其安全属性。复制、修补和重新启动后，安装目录中的文件缺少一些 ACL。具体来说，这些文件不再具有用户组的 ACL，因此用户在重新启动后无法再运行该程序。

谁能解释这里发生了什么？似乎从安装目录复制到临时目录，文件继承了临时目录的 ACL。但是，在 MoveFileEx/Reboot 上，文件仅继承 install 和 temp 目录共有的 ACL。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T22:16:41.777

在 Windows 中，如果您复制文件，则该文件采用目标目录的 ACL。如果您移动一个文件，ACL 将覆盖它可能从该目录继承的任何文件。我不确定 MoveFileEx 对文件的操作可能会有所不同。

临时目录通常位于用户配置文件下（%TMP% 和 %TEMP% 通常都指向此处），因此在此处复制文件将具有该用户的权限。将这些文件移动到程序文件目录将只需要用户权限，因此只能由安装用户运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T22:26:48.200

一种可能的解决方法是修补位于同一目录但名称不同的文件副本。重新启动后，可以换入已修补的版本。或者，先重新启动，然后就地修补它们，并在需要手动回滚时将它们备份到临时目录。

如果您真的想将它们移动到不同的位置，那么在要修补的文件所在的位置创建一个临时文件夹将有助于权限保持不变，前提是该目录使用继承的权限。

# asp.net - 任何人都知道为什么 SQL Server 2005 会抛出“'SQLOLEDB' failed with no error message available, result code: E_FAIL(0x80004005).”？

> ID：203040
> 
> 赞同：1
> 
> 时间：2008-10-14T22:07:55.463
> 
> 标签：asp.net, sql-server

我们有一个为后端运行 SQL Server 2005 和为前端运行 ASP.Net 的 Web 系统（使用 .net 2.0）。

有时，系统会在标题中显示错误：“SQLOLEDB”失败，没有可用的错误消息，结果代码：E_FAIL(0x80004005)。

网络系统 24/7 运行得很好，然后不时地把它扔到一个选择或类似的地方。我已经尝试重新运行引发错误的确切选择，但是（当然）当我这样做时它工作正常。而且，为了回答明显的后续问题，不，我们最近没有进行任何代码更改或升级。

有没有人遇到过这个？在谷歌上四处寻找似乎只会出现 Access 存在某种文件问题（权限、丢失数据文件等）的情况。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T00:08:28.307

首先，它可能不是 SQL Server 抛出错误，如果是，则可能不是在运行 SQL 语句本身时，但如果是，它几乎肯定是没有权限的登录所特有的，而不是SQL 命令本身。

0x80004005 错误是一般的权限失败，它几乎可以发生在任何事情上，但最有可能发生在另一层。

当应用程序在其下运行的帐户无权访问网络以打开与 SQL Server 的连接时，我在身份验证中看到了它。SQL Server 甚至从未看到请求，但客户端会说找不到服务器。

如果它是间歇性的，则可能表明存在间歇性域控制器问题，但这取决于您的 Windows Server 和 Active Directory 的设置方式，以及您的应用程序连接到 SQL Server 的方式。

要解决这个问题，您的网络管理员需要真正了解他们的 Windows 日志记录功能并为您跟踪它。

# svn - 在网络托管包上进行 SVn 结帐/更新的最佳方式

> ID：203050
> 
> 赞同：0
> 
> 时间：2008-10-14T22:11:36.313
> 
> 标签：svn, deployment

我想通过 subversion 结帐将我的网站部署在我的网络托管包上。我没有对我的托管包的 SSH 访问权限，它只是一个基本的 LAMP 网络托管包，但我知道网络服务器上安装了一个 SVN 客户端。

我正在考虑编写某种可以执行不同功能的脚本（PHP 或 Shell）。就像结帐、更新、切换到另一个标签等，我可以以某种方式从外部调用。

任何关于最佳实践、需要注意的事项以及如何进行的输入都非常感谢。

> **更新**：过去几周我一直在使用以下技术。我精心设计（并经过充分测试）了几个可以从 cron 通过 cPanel 执行的 shell 脚本。每当 cron 完成一项工作时，它都会通过电子邮件将工作的控制台输出发送给我。这样我就可以监控所有命令是否成功。由于我只在服务器上进行更新而没有提交，所以我没有遇到任何关于 Subversion 的问题。当然，在我的 .htaccess 文件中，我创建了一条规则，拒绝对隐藏的 .svn 文件夹进行任何访问。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T22:24:05.303

除非您具有 shell 访问权限，否则我会犹豫使用 Subversion 在您的网络主机上管理您的网站。在执行 Subversion 操作时，可能有些事情需要您的交互注意，而您无法通过脚本界面提供这些事情。

相反，我可能建议的是维护一个反映远程目录的本地结帐目录。当您想对您的实时站点进行更改时，请在本地结帐时执行 svn 更新，使其看起来完全符合您的要求，然后使用您最喜欢的镜像工具（`rsync`或其他工具）将站点推送到您的虚拟主机。

或者，您可以将 Web 主机切换到您可以访问 shell 的主机。我使用 Git 以这种方式管理一些网站，并且效果非常好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T05:11:59.427

好消息是 svn 很容易编写脚本，但坏消息是如果没有 shell 访问权限，您可能会遇到困难。

如果您在没有 shell 访问权限的情况下执行此操作，请注意任何可以更改 svn 下目录中文件的内容。这可能会导致工作副本和最新版本之间发生冲突并阻止您的更新。您可能希望在更新脚本中构建一个恢复命令，并在更新之前递归地恢复。

另一种选择是导出而不是签出。您不会有 .svn 目录，也不必担心文件冲突。您可能希望导出到一个干净的目录而不是覆盖，因为我认为 svn 导出不会触及非版本控制文件，包括通过 svn 删除的文件。

困难的部分是 Web 服务器的用户 ID 可能没有对您想要在结帐时访问的目录的写入权限。因此它需要以另一个用户身份运行 svn 命令以获得写入权限和文件所有权。我使用 suid-perl 更改有效的 uid/gid，并从 php.ini 调用这些 perl 脚本。Perl 然后以正确的身份调用 svn 命令。如果您确实需要 suid，那么您需要能够更改文件权限并设置 suid 位。也许你的 FTP 可以设置 suid 权限，否则你需要一个 shell。想到的唯一其他选项（这是一个坏主意）是授予 Web 服务器对整个目录的写访问权限。

如果 svn 存储库在单独的机器上，您可能想要使用 svn+ssh。这可能意味着在 Web 服务器上存储密钥文件或密码。确保密钥文件的权限正确，因为如果它们对所有者以外的任何人可读，ssh 会拒绝它们。为了安全起见，请确保 subversion 服务器上的登录只能访问 svn 存储库。

在您的 .htaccess 文件或 httpd.conf 中，您应该阻止来自任何地方的任何人对 .svn 目录的所有访问。

我还将我的 PHP 更新程序页面保存在受 SSL 密码保护的目录中。它只能执行一项操作，即将 web 目录从 svn 更新到最新版本。它不接受任何用户输入。如果它确实允许用户选择标签或修订版，它将只接受来自列表的标签选择，或整数修订版号。这些将在使用前进行高度清理，并且不会在 shell 命令或选项中使用任何用户输入。

最主要的是当您有任何 PHP 或外部可访问的脚本执行修改服务器上的数据的命令时要注意安全性。

我认为在您没有获得 shell 访问权限的机器上，您将在权限和文件所有权方面遇到很多困难。除非您与该托管服务提供商密切相关，否则我建议您升级到提供工具以简化您的工作的提供商。你会为自己节省足够的时间，这很可能是物有所值的。

# javascript - 节省用户登录时间

> ID：203054
> 
> 赞同：4
> 
> 时间：2008-10-14T22:12:24.283
> 
> 标签：javascript, time, frontend, logoff

在我正在开发的应用程序中，我必须存储某些特定用户保持登录到应用程序的时间，不幸的是，在 Web 应用程序中，用户可以通过多种方式注销。

1.  用户单击注销。
2.  用户会话到期。
3.  用户关闭窗口。
4.  用户在地址栏中键入另一个站点 URL。

第一个非常简单，因为应用程序可以控制注销过程。但在其他方面，它变得棘手。

你会怎么做来解决这个问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T22:14:36.727

在每个页面视图上，更新您的计数。如果他们注销，那么您就有了准确的衡量标准。如果他们导航离开，或任何其他方法，那么你最多的是他们在一页上的时间长度。

如果准确测量*真的很*重要，那么也许每分钟都有一个 AJAX“心跳”，但这很可能是矫枉过正。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T22:30:11.877

对于#3 和#4，您可以在 window.onunload 事件上附加一些东西，让您有时间进行计算，但请注意您的代码足够快，以至于在发送 AJAX 请求之前页面不会完全卸载。

就＃2而言，nickf建议的“心跳”可能是那里最好的解决方案。

# c - 在 VS2008 中访问 void* 的内容时如何克服“错误 C2100：非法间接”

> ID：203058
> 
> 赞同：4
> 
> 时间：2008-10-14T22:13:35.700
> 
> 标签：c, visual-studio-2008

我有一个在 VS2008 中创建的 C 应用程序。我正在创建一个模拟创建函数，它覆盖结构中的函数引用。但是，如果我尝试以直截了当的方式执行此操作，例如：

```
void *ptr = &(*env)->GetVersion;
*ptr = <address of new function> 
```

然后我得到一个“错误 C2100：非法间接”错误作为 *ptr，当 ptr 是一个 void * 似乎是一个被禁止的构造。我也可以通过使用 int/long 指针来解决它，将其映射到相同的地址并修改 long 指针的内容：

```
*structOffsetPointer = &(*env)->GetVersion;
functionPointer = thisGetVersion;
structOffsetPointerAsLong = (long *)structOffsetPointer;
*structOffsetPointerAsLong = (long)functionPointer; 
```

但我担心如果我在 32 位和 64 位环境之间切换，使用 long 或 int 指针会导致问题。

那么有没有简单的方法来禁用这个错误？假设不是，win64下是int还是long 64位？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T22:25:49.793

当取消引用“void *”时，您会得到一个没有大小（或者实际上没有类型）的“void”，因此它不知道如何为它分配一些东西。它与以下内容相同：

```
void blah = 0xdeadbabe; // let's assume a 32-bit addressing system 
```

为了添加我自己的响应并给出解决方案，我会给它一个正确类型的指针，指向 GetVersion 类型的函数。如果您的“env”结构字段指向的 GetVersion 是：

```
int GetVersion(); 
```

那么你想要：

```
int (**ptr)() = &(*env)->GetVersion; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T22:33:19.357

那么怎么样：

```
void **ptr = (void **) &(*env)->GetVersion;
*ptr = <address of new function> 
```

正确的方法是使用类型系统，避免所有类型转换并声明指向函数的实际指针，例如：

```
typedef int (*fncPtr)(void);
fncPtr *ptr = &(*env)->GetVersion;
*ptr = NewFunction; 
```

上面假设 GetVersion 是 fncPtr 类型并且 NewFunction 被声明为 int NewFunction(void);

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T22:21:27.167

上次我在visual studio 下玩void* & C，VS 玩的不是很好。以下是一些信息数据点：

指针始终是系统字的大小（8/16/32/64）...（除非您有分段内存，我*假设*您没有）。这是因为它需要指向内存空间中的任何位置。对于*冯诺依曼*机器，函数指针将与数据指针大小相同，因为数据和代码占用相同的内存空间。这在*哈佛*架构下无法保证。我对 Windows Vista 不够熟悉，不知道它是否出于安全原因以编程方式伪造了哈佛体系结构。

我个人*不会*禁用这个错误，只是为了让编译器完成它的工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T22:22:44.403

如前所述，要将函数的地址存储在指针中，您根本不应该进行间接寻址。

但是，您还谈到担心可能存储指针的 int 类型的大小（这通常不是您想要做的事情，除非您有充分的理由这样做）。

如果您出于某种原因想要在 int 类型中保存一个指针，那么在 Windows 上，一个类型`UINT_PTR`（或者如果你有的话）将保存大多数指针类型（我认为它不一定足够大来保存一些指向 -成员类型）。`uintptr_t``stdint.h`

# .net - 如何在 Vista 64 上以 32 位模式运行程序？

> ID：203061
> 
> 赞同：1
> 
> 时间：2008-10-14T22:15:03.483
> 
> 标签：.net, 64-bit

我正在构建一个通过 OleDB/Jet 与 Access 数据库对话的应用程序。只有 32 位 Jet 提供程序，没有 64 位提供程序，因此应用程序需要在 32 位模式下运行。我的开发盒是 Vista 64，所以我将项目设置为为 x86 而不是任何 cpu 构建。这让我的应用程序运行并与数据库对话。

但是现在我想用 Gallio Icarus 运行一些单元测试，它是为任何 cpu 构建的并且是强签名的（这意味着使用 CorFlags.exe（在 SDK 中）强制切换到 32 位只会导致程序集不运行直到重新签名）。

有什么方法可以在 32 位模式下运行 Gallio Icarus，以便我可以加载这些单元测试？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T03:03:37.457

原来诀窍是使用 CorFlags.exe 将 Gallio.Host.exe 标记为仅 32 位。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T22:16:55.973

您需要专门针对 x86 处理器构建程序。

项目属性 -> 构建 -> 平台目标：x86

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T02:35:36.343

Gallio 不是开源的吗？您可以下载并构建（必要时签名）以满足您的需求，或者我错过了什么，我应该得到我的外套吗？

[http://www.gallio.org/Development.aspx](http://www.gallio.org/Development.aspx)[链接文本](http://www.gallio.org/Development.aspx)

# flash - XMLSocket 在 Firefox 中工作，但不在 IE 中

> ID：203068
> 
> 赞同：0
> 
> 时间：2008-10-14T22:17:07.160
> 
> 标签：flash, internet-explorer, firefox, actionscript, xmlsocket

我正在帮助一位对 Flash 应用程序有问题的客户。Flash 应用程序使用 XMLSocket 连接到在 localhost 上运行的服务。它在Firefox下运行良好。

它使用以下行来设置安全策略：

System.security.loadPolicyFile("xmlsocket://localhost:10032");

在 firefox 下运行 flash 应用程序，监听 10032 端口的服务与 <policy-file-request/> 建立连接，响应它，并且运行良好。在IE下，服务永远得不到连接，后续的socket连接也不起作用。

编辑：问题原来是由在隐藏的 div 标签中嵌入 flash 引起的。在这种情况下，它拒绝发送策略文件请求。不隐藏 div 它可以工作。关于 FF 和 IE 之间不同版本的 flash 的答案是正确的，这就是它在 FF 中工作的原因（它是一个旧版本）。较新的版本不喜欢隐藏的 DIV 标签。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T10:52:03.220

您确定在两个浏览器上运行完全相同版本的 flash 吗？不同版本之间对网络安全的要求似乎发生了显着变化。完全有可能在 IE 和 firefox 中安装不同版本的 flash player，因为一个是 activeX 控件，另一个是浏览器插件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-31T07:50:20.093

在向策略文件发送请求的末尾添加“新行”字节。

像这样："" + "\n"

# css - 什么是最好的 CSS 框架，值得付出努力吗？

> ID：203069
> 
> 赞同：106
> 
> 时间：2008-10-14T22:17:26.847
> 
> 标签：css, css-frameworks

在另一个论坛上阅读时，我遇到了 CSS 框架的世界。我一直特别关注的是[BluePrint](http://www.blueprintcss.org/)。我想知道是否有其他人遇到过 CSS 框架，建议哪个是最好的，是否值得付出努力？

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2008-10-14T22:45:21.987

CSS“框架”完全没有抓住重点。

CSS 不像 JavaScript，您可以在其中包含一个基础库/框架，然后从中调用函数和对象来完成更高级别的工作。CSS 框架可以给你的只是声明性规则：一些默认的浏览器规则重置的东西，一些强制将你的页面创作到的类样式，以及使用'float'和'clear'的布局规则。你可以自己用几行 CSS 来编写它，而不是拖入一百条框架规则的臃肿。

特别是“网格布局”的东西可以追溯到将您的演示文稿混合到您的标记中的糟糕过去。'div class="span-24"' 并不比表格好，您必须回到那里并更改标记以影响布局。而且我见过的所有框架都是基于固定像素的浮动框，因此无法创建可在各种窗口大小上访问的流动布局。

它是反向创作，只对害怕编写 CSS 规则的人有用。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-14T22:49:33.663

~~所以，还没有人回答这个问题（虽然我看到了一些赞成票），所以~~我将至少尝试解决此提示中的第二个问题。

CSS 框架很棒；像任何其他框架一样，它们减少了开发时间，让您可以立即着手进行特定于站点的设计和 CSS。他们会考虑艰难的决定，因此您不必这样做。

不幸的是，使用框架（通常）有两个缺点：

1.  该框架决定了 CSS 代码的整体结构和机制。现在，我不是在谈论 CSS 重置（它们本身很有用，但它们不是真正的框架）；我说的是一个诚实到好的框架，它已经决定了您将在文档中使用哪些语义标签等。因此，您依赖于框架，以及何时出现错误在框架中，您通常必须自己修复它。

2.  框架不是忽视跨浏览器/高级 CSS 问题的借口。您总是会遇到它们，就像您使用 PHP 或 JavaScript 框架一样。你需要知道如何处理它们。有一句俗话说，在使用别人的框架之前，您应该先编写自己的框架。

快速浏览一下 Blueprint，我不会真正将其称为框架。也许是在顶部有一些额外的好东西的重置。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-14T23:03:31.857

我看过 BluePrint 和其他一些，我推荐的唯一 CSS“框架”是[YUI Grids](http://developer.yahoo.com/yui/grids/)

优点：

*   由最好的前端工程师之一 (IMO) (Nate Koechley) 撰写
*   很小。4KB
*   非常灵活（1000 种不同的布局）
*   支持流体宽度 (100%) 布局以及 750 像素、950 像素和 974 像素的预设固定宽度布局，并且能够轻松自定义为任意数字。
*   支持轻松自定义固定宽度布局的宽度。
*   模板列与源顺序无关，因此您可以将最重要的内容放在标记层的首位，以提高可访问性和搜索引擎优化 (SEO)。
*   自动清除页脚。无论哪一列更长，页脚都停留在底部。
*   小于 100% 的布局会自动居中。
*   有点语义的类名（比 top、left、right 等更好）

缺点：

*   与手写 HTML 和 CSS 相比，有很多额外的标记
*   需要一些学习来弄清楚如何做复杂的布局

正如其他人所发布的那样，CSS 没有真正的“框架”。[重置](http://developer.yahoo.com/yui/reset/)样式表对布局也有很大帮助。我通常坚持使用重置样式表并从那里开始。但是如果你没有大量的 CSS 经验，YUI Grids 可以为你节省一些时间。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-12-02T22:54:20.683

[Compass](http://acts-as-architect.blogspot.com/2008/11/introducing-compass.html)是一个真正的 CSS 框架，因为它不仅为您提供模板（YUI 和蓝图），还提供可重用的构造和更高级别的声明，同时仍为您提供熟悉的 CSS 语法。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-15T19:38:45.373

花时间学习和理解（真正理解！）一些 css 框架，如 BluePrint 和 YUI，以及像 Eric Meyer 的 css 重置。然后，花时间根据您的工作方法和您构建的网站类型来组合您自己的重置和/或框架。

就个人而言，我使用 Eric Meyer 的大部分重置以及我自己的一些类和重置，以及来自 BluePrint 和 YUI 的一些想法。

我最近观看了 Eric Meyer 关于 CSS 框架的演讲，他在演讲中提出了一个问题：“那么哪一个适合我？” 然后他通过展示一张空白幻灯片回答了这个问题。他的观点是，大多数重置和框架中肯定有一些有用的概念，但最适合您的是您自己编写的概念（值得付出努力）。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-04-21T09:45:08.273

**为什么使用 css 框架？**

*   如果时间紧迫。

*   如果您不了解 css，并且不知道可以为您编写它的人。

*   如果您对标准等不太重视。

我认识的程序员非常乐于使用 blueprint 或 960，因为它允许他们自行组合布局，而无需求助于前端开发人员。这非常适合个人项目或资源有限的初创公司。

如果您已经对 CSS 有相当的了解，那么大概您已经拥有一个不错的库存布局库，因此您显然不需要框架。

但是，如果您是初学者并且只需要启动并运行某些东西，那么您可能会转向框架，因为它使基本布局更加简单，并且还解决了浏览器兼容性问题。

说了这么多，许多开箱即用的框架确实使用了一些可怕的类名等。我知道一些网站以框架为起点，然后使用自己的类和 id 标签对其进行定制。但显然，重写也涉及到一些工作。如上所述，使用 Compass 之类的东西确实有助于解决这个问题。

所以，CSS 框架——它们可以节省你的时间，但代价是语义。它们也可能会损害您对 CSS 的了解，但这更多地取决于您在学习这门学科上的投入程度。是否使用它们取决于您。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2010-03-31T11:55:37.747

您必须问问自己，可用的框架在解决您的问题方面有多有效。它们符合您的要求吗？

通过使用框架，您可以在像素级别设置一些规则或细节，并将剩余的时间用于实施和生产。这是一个巨大的生产力提升。如果您发现自己在项目后期花时间调整了几个像素（微管理设计），这表明框架可能有用。

[The Pragmatic Programmer](http://en.wikipedia.org/wiki/The_Pragmatic_Programmer)中的提示 #17说：“程序接近问题域”。使用抽象层可以让您更接近解决布局的实际问题。例如：您可能可以专注于通过您拥有的额外时间来增强用户体验，而不是对像素进行细微的调整。

这并不是说你必须为了数量而牺牲质量。这是关于效率的。

在最近的一个项目中，我制作了自己的框架，因为我们的资源非常有限，而流行的框架并没有达到我想要的效果。然后，我将设计团队的 PSD 设置为与我部署的同一网格对齐。

框架不必是 CSS 的任何特定实现。它不一定是你从互联网上下载的臃肿的东西或实现过时想法的东西。这只是完成工作的一种技巧。如果一些编码人员已经拥有自己的框架并且甚至不知道它，我不会感到惊讶。事实上，如果您将 DOM 视为使用 CSS 扩展的一组默认元素，那么根据定义，这就是一个框架。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-14T23:28:03.990

实际上，在过去的 24 小时里，我花了很大一部分时间自己调查这个问题，呵呵。我的结论是一个不错的重置（我使用[YUI Reset](http://developer.yahoo.com/yui/reset/)），也许还有其他东西来设置基线（在我的情况下[YUI 字体](http://developer.yahoo.com/yui/fonts/)是值得的；也许 BluePrint 的“额外好东西”会在你的身上）是一个好主意。但是，“框架”——通常类似于[YUI 网格](http://developer.yahoo.com/yui/grids/)——限制性太强，迫使您使用它们的类名、ID 等，并且很少像手工制作的 CSS 那样适合您的网站。

简而言之：重置看起来很不错；最好消除所有变化，例如列表的边距与填充，或段落间距等。但这就是我所能接受的。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-12-02T22:49:01.973

我没用过，是的，但我认为[emastic](http://code.google.com/p/emastic/)可能是一个值得一试的好选择。它在范围上类似于蓝图，但也支持弹性布局（因此得名），您可以在 px、em 或 % 中指定值，甚至可以混合它们。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-06-09T23:09:10.597

指南针我认为是惊人的。确保您看到[截屏视频](http://wiki.github.com/chriseppstein/compass)。

我在一些网站上使用[960.gs](http://www.960.gs)，发现它非常简单易用，值得付出努力。为我节省了大量的布局工作。确保检查自定义 CSS 生成器，它以 960 像素的固定宽度消失。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-06-21T07:18:56.263

我认为Site Point 首席执行官 Kevin Yank 的[这段视频演示](http://www.sitepoint.com/blogs/2009/11/10/video-css-frameworks-%E2%80%93-make-the-right-choice/)将回答您的问题。我真的建议观看。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2010-11-19T03:07:46.413

Compass 允许您使用自己的语义名称重命名框架的类和 id，因此您可能想检查一下。它还提供了对诸如 mixins 之类的普通 CSS 无法获得的东西的访问。

我对所谓的“CSS 专家”感到震惊，他们批评这些工具却没有真正深入研究并使用它们。它们是必不可少的吗？不。如果你喜欢自己的框架（你确实有一个自己的框架，对吧？CSS 框架只是一个精心定义的库——每个人都应该使用一个），那么一定要继续使用它。没有人强迫你使用其他框架，而且我没有看到使用框架的人告诉 CSS 纯粹主义者他们“做错了”。

从这样的角度批评框架只会暴露出不安全感和无知。例如，一个人会在不了解 CSS 的情况下使用 Compass 之类的工具的想法是可笑的。您是否意识到，一个框架通常不会为您编写所有的 CSS？您仍然可以在大多数框架的上下文中拆分并编写自己的 CSS。事实上，如果您不了解 CSS，您可能很快就会感到沮丧。

就我自己而言，我很欣赏拥有一个框架，因为它已经记录在案，由数百名其他用户测试过，而且我可以通过 Compass 应用我自己的类和 ID。如果我需要框架不适合的东西，那么我将自己编写代码。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-10-14T23:14:24.127

AppFuse 的 Matt Raible 不久前举办了一场 CSS 框架竞赛，为 AppFuse 开发 CSS 框架。结果在[这里](http://css.appfuse.org/themes/)公布。有一些变体，我自己也使用过一些，因为我使用 AppFuse 并且发现它们非常好。

我应该补充一点，这些 CSS 框架运行良好，因为它们用于主题应用程序。也就是说，如果您遵守规则，那么从一个切换到下一个就像更改属性文件中的一个值一样简单。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-10-15T04:27:09.690

我在一个网站上使用 BluePrint 取得了很大的成功（我可以在此处提及该网站，但我确信该帖子会被标记为垃圾邮件！）。我不确定将来是否会使用它，因为我认为 CSS 的一个想法是没有硬编码布局逻辑。您不应该使用名为 span-24 和 span-12 的 css 元素来定义布局，而是使用 searchBox 和 mainContent 之类的元素。至少我是这么看的。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-03-12T16:18:25.843

我找到了很好的链接：[前 12 个 CSS 框架以及如何理解它们](http://speckyboy.com/2008/03/28/top-12-css-frameworks-and-how-to-understand-them/)

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-03-13T14:43:47.607

这是我关于 CSS 框架的博客文章[何时使用 CSS 框架？](http://www.vcarrer.com/2008/08/when-to-use-css-framework.html)

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2009-05-18T20:51:47.723

我知道使用 CSS 框架并保留语义标记的唯一方法是使用更高级别的抽象。目前，我知道 Compass 是唯一一个成熟到可以使用的工具，但 Nicole Sullivan 似乎正在用她的“面向对象的 CSS”项目做一些有趣的事情。

我发现 Compass 对 Sass 混合的巧妙使用非常出色，并且朝着可维护语义标记的圣杯迈出了一大步。我认为我不想使用没有像 Compass 这样的抽象的 Blueprint 或 YUI 这样的框架来将表示类排除在标记之外。

顺便说一句，有一个漂亮的名为 Elastic 的 CSS 框架看起来足够好，我正在考虑将它添加到 Compass 中。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-10-15T04:06:56.843

我相信 CSS 是关于简单的。目标是当您在 HTML 和样式表之间进行引用时，有一个或两个位置可以检查。添加更多的行，尤其是那些你没有写过并且可能不太熟悉的行，将成倍地增加复杂性，从而增加 CSS 代码的波动性。

我会在您编写布局时建议您的布局，并从中开发通用模板系统。虽然我喜欢让 CSS 更加模块化，但通常取决于设计，你的 CSS 可能是非常特定于案例的，根本不是模块化的。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-10-15T04:21:16.067

我在一些一次性网站上使用过 Blueprint，它确实节省了时间，主要用于跨浏览器测试。

将演示代码添加到您的标记中确实很糟糕，尽管从好的方面来说它是可读的。虽然我喜欢“您可以在不触及标记的情况下重新设计”的概念，但如果您正在制作一个无论如何都不会发生的网站，并且您只需要昨天完成，那么蓝图就是值得一看的东西。

不过，它可以创建哪些类型的布局也需要权衡取舍。如果您从一开始就在严格的网格上对站点进行线框，则可以更轻松地将其转换到框架中而无需大惊小怪。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-10-16T20:25:28.677

我使用过 BluePrint 和 YUI，但我总是对他们给他们的 id 和类的一些名称感到沮丧。

每个人都有自己的想法，但我更喜欢从头开始做事，但过了一段时间，您将开发一个流程，在该流程中您将使用以前的工作并将其应用于新项目，并进行一些调整以使网站看起来像您想要的那样喜欢它。

确保使用良好的命名约定，以防万一其他人进来编辑 css，那么他们就会很好地了解每个样式名称所指的内容。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2010-12-15T05:07:38.627

克雷格，

Compass 正是您所寻找的：它允许您使用自己的名称重命名蓝图 CSS 类，例如“span-24”。它还使用变量和 mixin 扩展了 CSS 功能。确实，那些在没有检查 Compass 的情况下过早判断框架的人“没有抓住重点”。这有点像那些多年前告诉我们的那些人，我们在布局中使用 CSS 而不是 HTML 表格错过了重点。

-马特

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-12-06T02:55:45.063

查看[http://www.ez-css.org/](http://www.ez-css.org/)。最简单、最轻的 CSS 框架之一。:)

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2011-11-01T21:29:19.207

看看这个演示： [http](http://www.richstyle.org/demo-web.php) ://www.richstyle.org/demo-web.php 这个框架基于“HTML 标签应该足够”的想法。我认为可重用性是选择软件组件（包括 Web 框架）的最重要因素。对于 Web 框架开发人员，您对标准的承诺越多，您就越能保证可重用性。

# unit-testing - 当它导致*更少*测试时，我应该使用“玻璃盒”测试吗？

> ID：203075
> 
> 赞同：3
> 
> 时间：2008-10-14T22:21:31.097
> 
> 标签：unit-testing, black-box, white-box

例如，我正在针对 CsvReader 编写测试。这是一个枚举和拆分文本行的简单类。它唯一*存在的理由*是忽略引号中的逗号。它不到一页。

通过“黑盒”测试课程，我检查了类似

*   如果文件不存在怎么办？
*   如果我没有文件的权限怎么办？
*   如果文件有非 Windows 换行符怎么办？

但实际上，所有这些都是 StreamReader 的事情。我的班级在没有对这些案例做任何事情的情况下工作。所以本质上，我的测试是捕捉 StreamReader 抛出的错误，以及框架处理的测试行为。感觉很多工作都白费了。

我看过相关的问题

*   [QA 是否应该从严格的黑盒角度进行测试？](https://stackoverflow.com/questions/164170/should-qa-test-from-a-strictly-black-box-perspective)
*   [严格捕获测试用例以进行单元测试](https://stackoverflow.com/questions/12569/rigor-in-capturing-test-cases-for-unit-testing)

我的问题是，如果我使用我所知道的来*避免*这种工作，我是否错过了“玻璃盒”测试的意义？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T23:11:13.523

我认为您不应该浪费时间测试不是您的代码的东西。这是一个设计选择，而不是测试选择，是处理底层框架的错误还是让它们传播到调用者。FWIW，我认为您让它们传播是正确的。但是，一旦您做出了设计决定，您的单元测试应该覆盖您的代码（并且很好地覆盖它），而不需要测试底层框架。使用[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)和模拟 Stream 可能也是一个好主意。

[编辑] 依赖注入示例（有关更多信息，请参见上面的链接）

不使用依赖注入我们有：

```
public class CvsReader {
   private string filename;
   public CvsReader(string filename)
   {
      this.filename = filename;
   }

   public string Read()
   {
      StreamReader reader = new StreamReader( this.filename );
      string contents = reader.ReadToEnd();
      .... do some stuff with contents...
      return contents;
   }
} 
```

使用依赖注入（构造函数注入），我们可以：

```
public class CvsReader {
   private IStream stream;
   public CvsReader( IStream stream )
   {
      this.stream = stream;
   }

   public string Read()
   {
       StreamReader reader = new StreamReader( this.stream );
       string contents = reader.ReadToEnd();
       ...  do some stuff with contents ...
       return contents;
   }
} 
```

这使得 CvsReader 更容易测试。我们在构造函数中传递了一个实现我们依赖的接口的实例，在本例中为 IStream。因此，我们可以创建另一个实现 IStream 的类（可能是模拟类），但不一定执行文件 I/O。我们可以使用这个类向我们的读者提供我们想要的任何数据，而无需涉及任何底层框架。在这种情况下，我会使用 MemoryStream，因为我们只是从中读取。不过，在我们想要的情况下，我们可以使用一个模拟类并给它一个更丰富的接口，让我们的测试配置它给出的响应。这样我们就可以测试我们编写的代码，而完全不涉及底层框架代码。或者，我们也可以传递一个 TextReader，但正常的依赖注入模式使用接口，我想用接口展示模式。可以说传入 TextReader 会更好，因为上面的代码仍然依赖于 StreamReader 实现。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T23:11:18.250

这实际上取决于您的 CsvReader 的接口，您需要考虑该类的用户期望什么。

例如，如果其中一个参数是文件名并且文件不存在应该发生什么？这不应该取决于您是否使用流阅读器。单元测试应该测试你的类的可观察到的外部行为，并且在某些情况下，稍微深入挖掘并另外确保覆盖某些实现细节，例如当阅读器完成时关闭文件。

但是，您不希望单元测试依赖于所有细节，或者假设由于实现细节而发生某些事情。

您在问题中提到的所有示例都涉及您班级的可观察行为（在这种情况下为例外情况），因此应该进行与它们相关的单元测试。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T22:42:12.617

是的，但这将严格用于单元测试：

您可以通过定义抽象流读取器接口并使用实现该接口的模拟流读取器测试您自己的实现，从任何特定的 StreamReader 抽象您的 CSV 读取器实现。您的模拟阅读器显然不会受到不存在的文件、权限问题、操作系统差异等错误的影响。因此，您将完全测试自己的代码，并且可以实现 100% 的代码覆盖率。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T21:33:39.853

我倾向于同意 tvanfosson：如果您从 StreamReader 继承并以某种方式对其进行扩展，那么您的单元测试应该只执行您添加或更改的功能。否则，您将浪费大量时间和认知能量来编写、阅读和维护不会增加任何价值的测试。

尽管 markj 认为测试应该涵盖一个类的“可观察的外部行为”是正确的，但我认为考虑该行为的来源是合适*的*。如果它是通过从另一个（可能是单元测试的）类继承而来的行为，那么我认为添加自己的**单元**测试没有任何好处。OTOH，如果它是通过组合的行为，那么它*可能会*证明一些测试是合理的，以确保传递正常工作。

我的偏好是对您更改的特定功能进行单元测试，然后编写检查错误条件的**集成**测试，但在您最终支持的业务需求的上下文中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-26T18:29:42.037

仅供参考，如果这是 .NET，您应该考虑不要重新发明轮子。

对于 C#

添加对 Microsoft.VisualBasic 的引用 使用奇妙的类 Microsoft.VisualBasic.FileIO.TextFieldParser() 来处理您的 CSV 解析需求。

Microsoft 已经对其进行了测试，因此您不必这样做。

享受。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-14T22:23:38.363

您应该始终管理框架抛出的错误；这样您的应用程序就很健壮并且不会因灾难性错误而崩溃...

# c# - 用于 64 位操作系统的 C#？

> ID：203085
> 
> 赞同：2
> 
> 时间：2008-10-14T22:24:09.097
> 
> 标签：c#, .net, 64-bit

如何使我的编译针对 Windows 64 位进行优化？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-15T08:56:32.017

您可能还想在运行时进行检查，以确保：

```
using System;
using System.Runtime.InteropServices;

class SystemChecker
{
    static bool Is64Bit
    {
        get { return Marshal.SizeOf(typeof(IntPtr)) == 8; }
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T22:25:39.793

托管项目会根据所选架构自动构建 => 在 AMD64 上创建的默认 C# 项目将是 AMD64，X86 上的 X86。默认情况下，本机始终为 32 位。

要显式设置平台：

1 打开解决方案资源管理器，选择解决方案，右键->配置管理器。

2 转到“活动解决方案平台”，单击新建。

3 在出现的“新解决方案平台”对话框中选择新平台，比如安腾。将“Copy Settings From”设置为“Any CPU”，这是“Active Solution Platform”中的默认设置。

4 单击确定。

这是来自[网络日志](http://blogs.msdn.com/deeptanshuv/archive/2006/04/11/573795.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-14T22:29:05.747

正如 Patrick Desjardins 所说，有一点补充。

如果您有使用 Interop 并使用 32 位编译的第三方 DLL，请注意。在这种情况下，您将特别需要将所有使用它的程序集设置为使用 x86，否则会发生各种奇怪的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-17T20:54:31.810

`/platform`您可以通过-flag编译为 64 位。请注意，**Visual Studio Express**没有直接的 64 位编译设置。

有关更多信息，请参见[此处，以及](http://msdn.microsoft.com/en-us/library/ms241064%28v=vs.80%29.aspx)[此处](http://msdn.microsoft.com/en-us/library/zekwfyz4%28v=vs.80%29.aspx)。从第二个来源获取以下信息：

在 64 位 Windows 操作系统上：

*   编译的程序集`/platform:x86`将在 WOW64 下运行的 32 位 CLR 上执行。
*   使用 编译的可执行文件`/platform:anycpu`将在 64 位 CLR 上执行。
*   使用 编译的 DLL`/platform:anycpu`将在与加载它的进程相同的 CLR 上执行。

**运行时检查：**

您可以通过以下选项之一在运行时检查执行位环境

```
bool is64BitProcess = IntPtr.Size == 8;
int bitProcess = IntPtr.Size*8;
//C# 4 provides System.Environment.Is64BitProcess
//TimothyP's solution:
bool is64BitProcess = Marshal.SizeOf(typeof(IntPtr)) == 8; 
```

# windows - 如何以适合文件/文件夹名称的格式在 Windows 命令行上获取当前日期/时间？

> ID：203090
> 
> 赞同：591
> 
> 时间：2008-10-14T22:25:34.303
> 
> 标签：windows, datetime, batch-file, cmd

更新：现在是 2016 年，我会为此使用 PowerShell，除非有一个真正令人信服的向后兼容原因，特别是因为使用`date`. 请参阅@npocmaka 的[https://stackoverflow.com/a/19799236/8479](https://stackoverflow.com/a/19799236/8479)

* * *

我可以使用什么 Windows 命令行语句以可以放入文件名的格式获取当前日期时间？

我想要一个 .bat 文件，它将一个目录压缩到一个存档中，并将当前日期和时间作为名称的一部分，例如，`Code_2008-10-14_2257.zip`. 有没有什么简单的方法可以做到这一点，独立于机器的区域设置？

我真的不介意日期格式，理想情况下它是 yyyy-mm-dd，但任何简单的都可以。

到目前为止，我已经得到了这个，它在我的机器上给了我`Tue_10_14_2008_230050_91`：

```
rem Get the datetime in a format that can go in a filename.
set _my_datetime=%date%_%time%
set _my_datetime=%_my_datetime: =_%
set _my_datetime=%_my_datetime::=%
set _my_datetime=%_my_datetime:/=_%
set _my_datetime=%_my_datetime:.=_%

rem Now use the timestamp by in a new ZIP file name.
"d:\Program Files\7-Zip\7z.exe" a -r Code_%_my_datetime%.zip Code 
```

我可以忍受这个，但它似乎有点笨拙。理想情况下，它会更简短，并具有前面提到的格式。

我正在使用 Windows Server 2003 和 Windows XP Professional。我不想安装额外的实用程序来实现这一点（尽管我意识到有些可以很好地格式化日期）。

* * *

## 回答 #1

> 赞同：711
> 
> 时间：2008-10-14T22:36:53.733

请参阅*[Windows 批处理文件 (.bat) 以获取 MMDDYYYY 格式的当前日期](http://www.tech-recipes.com/rx/956/windows-batch-file-bat-to-get-current-date-in-mmddyyyy-format/)*：

```
@echo off
For /f "tokens=2-4 delims=/ " %%a in ('date /t') do (set mydate=%%c-%%a-%%b)
For /f "tokens=1-2 delims=/:" %%a in ('time /t') do (set mytime=%%a%%b)
echo %mydate%_%mytime% 
```

如果您更喜欢 24 小时/军用格式的时间，您可以将第二个 FOR 行替换为：

```
For /f "tokens=1-2 delims=/:" %%a in ("%TIME%") do (set mytime=%%a%%b) 
```

> C:> .\date.bat
> 2008-10-14_0642

如果您想要独立于地区日/月顺序的日期，则可以使用“WMIC os GET LocalDateTime”作为源，因为它是 ISO 顺序：

```
@echo off
for /F "usebackq tokens=1,2 delims==" %%i in (`wmic os get LocalDateTime /VALUE 2^>NUL`) do if '.%%i.'=='.LocalDateTime.' set ldt=%%j
set ldt=%ldt:~0,4%-%ldt:~4,2%-%ldt:~6,2% %ldt:~8,2%:%ldt:~10,2%:%ldt:~12,6%
echo Local date is [%ldt%] 
```

> C:>test.cmd
> 本地日期为 [2012-06-19 10:23:47.048]

* * *

## 回答 #2

> 赞同：121
> 
> 时间：2013-11-05T21:21:53.570

另外两种不依赖于时间设置的方法（均取自[：如何独立于本地化获取数据/时间：）](http://www.dostips.com/forum/viewtopic.php?f=3&t=4555)。两者也都获得了星期几，而且都不需要管理员权限！：

1.  **MAKECAB** - 适用于每个 Windows 系统（速度快，但会创建一个小临时文件）（foxidrive 脚本）：

    ```
    @echo off
    pushd "%temp%"
    makecab /D RptFileName=~.rpt /D InfFileName=~.inf /f nul >nul
    for /f "tokens=3-7" %%a in ('find /i "makecab"^<~.rpt') do (
       set "current-date=%%e-%%b-%%c"
       set "current-time=%%d"
       set "weekday=%%a"
    )
    del ~.*
    popd
    echo %weekday% %current-date% %current-time%
    pause 
    ```

    [有关获取日期功能的更多信息](http://ss64.com/ps/get-date.html)。

2.  **ROBOCOPY** - 它不是 Windows XP 和 Windows Server 2003 的本机命令，但可以[从 microsoft 站点下载](http://www.microsoft.com/en-us/download/details.aspx?id=17657)。但它内置于 Windows Vista 及更高版本的所有内容中：

    ```
    @echo off
    setlocal
    for /f "skip=8 tokens=2,3,4,5,6,7,8 delims=: " %%D in ('robocopy /l * \ \ /ns /nc /ndl /nfl /np /njh /XF * /XD *') do (
     set "dow=%%D"
     set "month=%%E"
     set "day=%%F"
     set "HH=%%G"
     set "MM=%%H"
     set "SS=%%I"
     set "year=%%J"
    )

    echo Day of the week: %dow%
    echo Day of the month : %day%
    echo Month : %month%
    echo hour : %HH%
    echo minutes : %MM%
    echo seconds : %SS%
    echo year : %year%
    endlocal 
    ```

    还有另外三种使用其他 Windows 脚本语言的方法。它们会给你更多的灵活性，例如你可以得到一年中的一周，毫秒的时间等等。

3.  **JScript/batch**混合（需要另存为`.bat`）。JScript 在 NT 及更高版本的每个系统上都可用，作为[Windows 脚本主机](http://en.wikipedia.org/wiki/Windows_Script_Host)的一部分（[尽管可以通过注册表禁用，但这种情况很少见](http://technet.microsoft.com/en-us/library/ee198684.aspx)）：

    ```
    @if (@X)==(@Y) @end /* ---Harmless hybrid line that begins a JScript comment

    @echo off
    cscript //E:JScript //nologo "%~f0"
    exit /b 0
    *------------------------------------------------------------------------------*/

    function GetCurrentDate() {
            // Today date time which will used to set as default date.
            var todayDate = new Date();
            todayDate = todayDate.getFullYear() + "-" +
                           ("0" + (todayDate.getMonth() + 1)).slice(-2) + "-" +
                           ("0" + todayDate.getDate()).slice(-2) + " " + ("0" + todayDate.getHours()).slice(-2) + ":" +
                           ("0" + todayDate.getMinutes()).slice(-2);

            return todayDate;
        }

    WScript.Echo(GetCurrentDate()); 
    ```

4.  **VSCRIPT/BATCH**混合（*[是否可以在不使用临时文件的情况下在批处理文件中嵌入和执行 VBScript？](https://stackoverflow.com/questions/9074476/is-it-possible-to-embed-and-execute-vbscript-within-a-batch-file-without-using-a)*）与 JScript 相同的情况，但混合不是那么完美：

    ```
    :sub echo(str) :end sub
    echo off
    '>nul 2>&1|| copy /Y %windir%\System32\doskey.exe %windir%\System32\'.exe >nul
    '& echo current date:
    '& cscript /nologo /E:vbscript "%~f0"
    '& exit /b

    '0 = vbGeneralDate - Default. Returns date: mm/dd/yy and time if specified: hh:mm:ss PM/AM.
    '1 = vbLongDate - Returns date: weekday, monthname, year
    '2 = vbShortDate - Returns date: mm/dd/yy
    '3 = vbLongTime - Returns time: hh:mm:ss PM/AM
    '4 = vbShortTime - Return time: hh:mm

    WScript.echo  Replace(FormatDateTime(Date,1),", ","-") 
    ```

5.  **PowerShell** - 可以安装在每台具有 .NET 的机器上 - 从 Microsoft 下载（[v1](http://www.microsoft.com/en-us/download/details.aspx?id=7217)、[v2](http://support.microsoft.com/kb/968929/bg)、[v3](http://www.microsoft.com/en-us/download/details.aspx?id=34595)（仅适用于 Windows 7 及更高版本））。它默认安装在 Windows 7/Windows Server 2008 及更高版本的所有设备上：

    ```
    C:\> powershell get-date -format "{dd-MMM-yyyy HH:mm}" 
    ```

    要从批处理文件中使用它：

    ```
    for /f "delims=" %%# in ('powershell get-date -format "{dd-MMM-yyyy HH:mm}"') do @set _date=%%# 
    ```

6.  **自编译 jscript.net/batch**（从未见过没有 .NET 的 Windows 机器，所以我认为这是一个非常便携的）：

    ```
    @if (@X)==(@Y) @end /****** silent line that start JScript comment ******

    @echo off
    ::::::::::::::::::::::::::::::::::::
    :::       Compile the script    ::::
    ::::::::::::::::::::::::::::::::::::
    setlocal
    if exist "%~n0.exe" goto :skip_compilation

    set "frm=%SystemRoot%\Microsoft.NET\Framework\"

    :: Searching the latest installed .NET framework
    for /f "tokens=* delims=" %%v in ('dir /b /s /a:d /o:-n "%SystemRoot%\Microsoft.NET\Framework\v*"') do (
        if exist "%%v\jsc.exe" (
            rem :: the javascript.net compiler
            set "jsc=%%~dpsnfxv\jsc.exe"
            goto :break_loop
        )
    )
    echo jsc.exe not found && exit /b 0
    :break_loop

    call %jsc% /nologo /out:"%~n0.exe" "%~dpsfnx0"
    ::::::::::::::::::::::::::::::::::::
    :::       End of compilation    ::::
    ::::::::::::::::::::::::::::::::::::
    :skip_compilation

    "%~n0.exe"

    exit /b 0

    ****** End of JScript comment ******/
    import System;
    import System.IO;

    var dt=DateTime.Now;
    Console.WriteLine(dt.ToString("yyyy-MM-dd hh:mm:ss")); 
    ```

7.  **Logman**这不能得到星期几。它相对较慢，并且还会创建一个临时文件，并且基于 logman 在其日志文件上放置的时间戳。它适用于 Windows XP 及更高版本的所有设备。它可能永远不会被任何人使用 - 包括我 - 但这是另一种方式......

    ```
    @echo off
    setlocal
    del /q /f %temp%\timestampfile_*

    Logman.exe stop ts-CPU 1>nul 2>&1
    Logman.exe delete ts-CPU 1>nul 2>&1

    Logman.exe create counter ts-CPU  -sc 2 -v mmddhhmm -max 250 -c "\Processor(_Total)\%% Processor Time" -o %temp%\timestampfile_ >nul
    Logman.exe start ts-CPU 1>nul 2>&1

    Logman.exe stop ts-CPU >nul 2>&1
    Logman.exe delete ts-CPU >nul 2>&1
    for /f "tokens=2 delims=_." %%t in  ('dir /b %temp%\timestampfile_*^&del /q/f %temp%\timestampfile_*') do set timestamp=%%t

    echo %timestamp%
    echo MM: %timestamp:~0,2%
    echo dd: %timestamp:~2,2%
    echo hh: %timestamp:~4,2%
    echo mm: %timestamp:~6,2%

    endlocal
    exit /b 0 
    ```

8.  **WMIC**的另一种方法也给出了一年中的一周和一周中的一天，但不是毫秒（对于毫秒检查 foxidrive 的答案）：

    ```
    for /f %%# in ('wMIC Path Win32_LocalTime Get /Format:value') do @for /f %%@ in ("%%#") do @set %%@
    echo %day%
    echo %DayOfWeek%
    echo %hour%
    echo %minute%
    echo %month%
    echo %quarter%
    echo %second%
    echo %weekinmonth%
    echo %year% 
    ```

9.  使用**[TYPEPERF](http://ss64.com/nt/typeperf.html)**并尽可能快地与不同的语言设置兼容：

    ```
    @echo off
    setlocal

    :: Check if Windows is Windows XP and use Windows XP valid counter for UDP performance
    ::if defined USERDOMAIN_roamingprofile (set "v=v4") else (set "v=")

    for /f "tokens=4 delims=. " %%# in ('ver') do if %%# GTR 5 (set "v=v4") else ("v=")
    set "mon="
    for /f "skip=2 delims=," %%# in ('typeperf "\UDP%v%\*" -si 0 -sc 1') do (
       if not defined mon (
          for /f "tokens=1-7 delims=.:/ " %%a in (%%#) do (
            set mon=%%a
            set date=%%b
            set year=%%c
            set hour=%%d
            set minute=%%e
            set sec=%%f
            set ms=%%g
          )
       )
    )
    echo %year%.%mon%.%date%
    echo %hour%:%minute%:%sec%.%ms%
    endlocal 
    ```

10.  **MSHTA**允许调用类似于上面#3 中演示的 JScript 方法的 JavaScript 方法。请记住，涉及月份值的 JavaScript 日期对象属性的编号是从 0 到 11，而不是从 1 到 12。所以值 9 表示十月。

    ```
    <!-- : Batch portion

    @echo off
    setlocal

    for /f "delims=" %%I in ('mshta "%~f0"') do set "now.%%~I"

    rem Display all variables beginning with "now."
    set now.

    goto :EOF

    end batch / begin HTA -->

    <script>
        resizeTo(0,0)
        var fso = new ActiveXObject('Scripting.FileSystemObject').GetStandardStream(1),
            now = new Date(),
            props=['getDate','getDay','getFullYear','getHours','getMilliseconds','getMinutes',
                'getMonth','getSeconds','getTime','getTimezoneOffset','getUTCDate','getUTCDay',
                'getUTCFullYear','getUTCHours','getUTCMilliseconds','getUTCMinutes','getUTCMonth',
                'getUTCSeconds','getYear','toDateString','toGMTString','toLocaleDateString',
                'toLocaleTimeString','toString','toTimeString','toUTCString','valueOf'],
            output = [];

        for (var i in props) {output.push(props[i] + '()=' + now[props[i]]())}
        close(fso.Write(output.join('\n')));
    </script> 
    ```

* * *

## 回答 #3

> 赞同：118
> 
> 时间：2009-12-23T09:40:23.903

### 区域独立的日期时间解析

命令的输出格式`%DATE%`和`dir`命令的输出格式取决于区域，因此既不健壮也不智能。[date.exe](http://sourceforge.net/projects/unxutils/files/)（[UnxUtils](http://en.wikipedia.org/wiki/UnxUtils)的一部分）以任何可以想到的格式提供任何日期和时间信息。您还可以从任何文件中提取日期/时间信息`date.exe`。

### 示例：（在 cmd 脚本中使用 %% 而不是 %）

`date.exe +"%Y-%m-%d"`
2009-12-22

`date.exe +"%T"`
18:55:03

`date.exe +"%Y%m%d %H%M%S: Any text"`
20091222 185503：任何文本

`date.exe +"Text: %y/%m/%d-any text-%H.%M"`
文本：22 年 9 月 12 日-任何文本-18.55

`Command: date.exe +"%m-%d """%H %M %S """"`
07-22“18:55:03”`

参考文件中的日期/时间信息：
`date.exe -r c:\file.txt +"The timestamp of file.txt is: %Y-%m-%d %H:%M:%S"`

在 CMD 脚本中使用它来获取年、月、日、时间信息：

```
for /f "tokens=1,2,3,4,5,6* delims=," %%i in ('C:\Tools\etc\date.exe +"%%y,%%m,%%d,%%H,%%M,%%S"') do set yy=%%i& set mo=%%j& set dd=%%k& set hh=%%l& set mm=%%m& set ss=%%n 
```

在 CMD 脚本中使用它来获取任何所需格式的时间戳：

```
for /f "tokens=*" %%i in ('C:\Tools\etc\date.exe +"%%y-%%m-%%d %%H:%%M:%%S"') do set timestamp=%%i 
```

从任何参考文件中提取日期/时间信息。

```
for /f "tokens=1,2,3,4,5,6* delims=," %%i in ('C:\Tools\etc\date.exe -r file.txt +"%%y,%%m,%%d,%%H,%%M,%%S"') do set yy=%%i& set mo=%%j& set dd=%%k& set hh=%%l& set mm=%%m& set ss=%%n 
```

将其日期/时间信息添加到文件中：

```
for /f "tokens=*" %%i in ('C:\Tools\etc\date.exe -r file.txt +"%%y-%%m-%%d.%%H%%M%%S"') do ren file.txt file.%%i.txt 
```

date.exe 是[免费 GNU 工具的一部分](http://sourceforge.net/projects/unxutils/files/)，无需安装。

注意：复制`date.exe`到搜索路径中的任何目录可能会导致其他使用 Windows 内置`date`命令的脚本失败。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2010-07-08T10:50:58.477

这是 alt.msdos.batch.nt 的一个变体，它独立于本地工作。

把它放在一个文本文件中，例如 getDate.cmd

```
-----------8<------8<------------ snip -- snip ----------8<-------------
    :: Works on any NT/2k machine independent of regional date settings
    @ECHO off
    SETLOCAL ENABLEEXTENSIONS
    if "%date%A" LSS "A" (set toks=1-3) else (set toks=2-4)
    for /f "tokens=2-4 delims=(-)" %%a in ('echo:^|date') do (
      for /f "tokens=%toks% delims=.-/ " %%i in ('date/t') do (
        set '%%a'=%%i
        set '%%b'=%%j
        set '%%c'=%%k))
    if %'yy'% LSS 100 set 'yy'=20%'yy'%
    set Today=%'yy'%-%'mm'%-%'dd'% 
    ENDLOCAL & SET v_year=%'yy'%& SET v_month=%'mm'%& SET v_day=%'dd'%

    ECHO Today is Year: [%V_Year%] Month: [%V_Month%] Day: [%V_Day%]

    :EOF
-----------8<------8<------------ snip -- snip ----------8<------------- 
```

为了让代码在没有错误消息到 stderr 的情况下正常工作，我必须在 %%a、%%b 和 %%c 的变量分配周围添加单引号。我的语言环境（PT）在循环/解析的一个阶段导致错误，其中执行“set = 20”之类的内容。引号为赋值语句的左侧产生一个标记（尽管为空）。

缺点是混乱的语言环境变量名称：'yy'、'mm' 和 'dd'。但是，嘿，谁在乎！

* * *

## 回答 #5

> 赞同：39
> 
> 时间：2009-04-12T13:13:23.517

我用这个（同样不是区域独立（英国））

```
set bklog=%date:~6,4%-%date:~3,2%-%date:~0,2%_%time:~0,2%%time:~3,2% 
```

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2014-09-07T19:47:40.953

此代码的前四行将在 Windows XP Professional 及更高版本中为您提供可靠的 YY DD MM YYYY HH Min Sec 变量。

```
@echo off
for /f "tokens=2 delims==" %%a in ('wmic OS Get localdatetime /value') do set "dt=%%a"
set "YY=%dt:~2,2%" & set "YYYY=%dt:~0,4%" & set "MM=%dt:~4,2%" & set "DD=%dt:~6,2%"
set "HH=%dt:~8,2%" & set "Min=%dt:~10,2%" & set "Sec=%dt:~12,2%"

set "datestamp=%YYYY%%MM%%DD%" & set "timestamp=%HH%%Min%%Sec%" & set "fullstamp=%YYYY%-%MM%-%DD%_%HH%%Min%-%Sec%"
echo datestamp: "%datestamp%"
echo timestamp: "%timestamp%"
echo fullstamp: "%fullstamp%"
pause 
```

* * *

## 回答 #7

> 赞同：26
> 
> 时间：2008-10-14T22:43:39.523

不幸的是，这不受区域设置的影响，但它可以满足您的需求。

```
set hour=%time:~0,2%
if "%time:~0,1%"==" " set hour=0%time:~1,1%
set _my_datetime=%date:~10,4%-%date:~4,2%-%date:~7,2%_%hour%%time:~3,2% 
```

令人惊奇的是您可以在[Wikipedia](http://en.wikipedia.org/wiki/Environment_variable)上找到的东西。

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2011-07-15T13:00:25.487

请使用以下脚本在命令行中获取当前日期：

```
echo %Date:~0,3%day 
```

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-10-14T22:36:49.943

另一种方式（[信用](http://weblogs.asp.net/whaggard/archive/2005/08/18/423029.aspx)）：

```
@For /F "tokens=2,3,4 delims=/ " %%A in ('Date /t') do @( 
    Set Month=%%A
    Set Day=%%B
    Set Year=%%C
)

@echo DAY = %Day%
@echo Month = %Month%
@echo Year = %Year% 
```

请注意，我在这里的两个答案仍然取决于区域设置确定的日期和月份的顺序 - 不知道如何解决这个问题。

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2009-12-04T19:44:01.493

```
"d:\Program Files\7-Zip\7z.exe" a -r code_%date:~10,4%-%date:~4,2%-%date:~7,2%.zip 
```

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2008-10-14T22:31:53.387

这不是很简单，但可能是一种更灵活的方式（[信用](http://www.tech-recipes.com/rx/956/windows-batch-file-bat-to-get-current-date-in-mmddyyyy-format/)）：

```
FOR /F "TOKENS=1* DELIMS= " %%A IN ('DATE/T') DO SET CDATE=%%B
FOR /F "TOKENS=1,2 eol=/ DELIMS=/ " %%A IN ('DATE/T') DO SET mm=%%B
FOR /F "TOKENS=1,2 DELIMS=/ eol=/" %%A IN ('echo %CDATE%') DO SET dd=%%B
FOR /F "TOKENS=2,3 DELIMS=/ " %%A IN ('echo %CDATE%') DO SET yyyy=%%B
SET date=%mm%%dd%%yyyy% 
```

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2010-05-18T06:03:16.007

简短的回答：

```
 :: Start - Run , type:
 cmd /c "powershell get-date -format ^"{yyyy-MM-dd HH:mm:ss}^"|clip"

 :: click into target media, Ctrl + V to paste the result 
```

长答案

```
 @echo off
    :: START USAGE  ==================================================================
    ::SET THE NICETIME 
    :: SET NICETIME=BOO
    :: CALL GetNiceTime.cmd 

    :: ECHO NICETIME IS %NICETIME%

    :: echo nice time is %NICETIME%
    :: END USAGE  ==================================================================

    echo set hhmmsss
    :: this is Regional settings dependant so tweak this according your current settings
    for /f "tokens=1-3 delims=:" %%a in ('echo %time%') do set hhmmsss=%%a%%b%%c 
    ::DEBUG ECHO hhmmsss IS %hhmmsss%
    ::DEBUG PAUSE
    echo %yyyymmdd%
        :: this is Regional settings dependant so tweak this according your current settings
    for /f "tokens=1-3 delims=." %%D in ('echo %DATE%') do set  yyyymmdd=%%F%%E%%D
    ::DEBUG ECHO yyyymmdd IS %yyyymmdd%
    ::DEBUG PAUSE

    set NICETIME=%yyyymmdd%_%hhmmsss%
    ::DEBUG echo THE NICETIME IS %NICETIME%

    ::DEBUG PAUSE 
```

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2010-10-04T20:57:03.313

这是一种在一行中获取日期时间的方法：

```
for /f "tokens=2,3,4,5,6 usebackq delims=:/ " %a in ('%date% %time%') do echo %c-%a-%b %d%e 
```

在美国，这将输出“yyyy-mm-dd hhmm”。不同的区域设置会导致不同的 %date% 输出，但您可以修改令牌顺序。

如果您需要不同的格式，请通过重新排列标记或使用不同（或不使用）分隔符来修改 echo 语句。

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2013-04-28T16:05:38.040

[**Matthew Johnson**](https://stackoverflow.com/a/3859042/2657515)获得单行日期和时间[的单行解决方案是](https://stackoverflow.com/a/3859042/2657515)*雄辩*且有用的。

然而，它确实需要一个简单的修改才能在批处理文件中工作：

```
for /f "tokens=2,3,4,5,6 usebackq delims=:/ " %%a in ('%date% %time%') do echo %%c-%%a-%%b %%d%%e 
```

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2014-11-19T08:51:50.313

只需使用这一行：

```
PowerShell -Command "get-date" 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2011-01-03T12:55:17.483

我用[vMax](https://stackoverflow.com/users/386539/vmax)的批处理文件更改[了答案](https://stackoverflow.com/questions/203090/how-to-get-current-datetime-on-windows-command-line-in-a-suitable-format-for-usi/3202796#3202796)，因此它也适用于荷兰语。 荷兰人 - 像我们一样坚持不懈 - 在 , , 中有一些更改，并且破坏了原始批处理文件。
`%date%``date/t``date`

如果有些人也可以对照其他 Windows 语言环境检查这一点，并报告结果，那就太好了。
如果批处理文件在您的位置失败，请在命令提示符下包含这两个语句的输出：
`echo:^|date`
`date/t`

这是您应该从批处理文件中获得的输出示例：

```
C:\temp>set-date-cmd.bat
Today is Year: [2011] Month: [01] Day: [03]
20110103 
```

这是修改后的代码，并附有原因的注释：

```
:: https://stackoverflow.com/questions/203090/how-to-get-current-datetime-on-windows-command-line-in-a-suitable-format-for-usi
:: Works on any NT/2k machine independent of regional date settings
::
:: 20110103 - adapted by jeroen@pluimers.com for Dutch locale
:: Dutch will get jj as year from echo:^|date, so the '%%c' trick does not work as it will fill 'jj', but we want 'yy'
:: luckily, all countries seem to have year at the end: http://en.wikipedia.org/wiki/Calendar_date
::            set '%%c'=%%k
::            set 'yy'=%%k
::
:: In addition, date will display the current date before the input prompt using dashes
:: in Dutch, but using slashes in English, so there will be two occurances of the outer loop in Dutch
:: and one occurence in English.
:: This skips the first iteration:
::        if "%%a" GEQ "A"
::
:: echo:^|date
:: Huidige datum: ma 03-01-2011
:: Voer de nieuwe datum in: (dd-mm-jj)
:: The current date is: Mon 01/03/2011
:: Enter the new date: (mm-dd-yy)
::
:: date/t
:: ma 03-01-2011
:: Mon 01/03/2011
::
:: The assumption in this batch-file is that echo:^|date will return the date format
:: using either mm and dd or dd and mm in the first two valid tokens on the second line, and the year as the last token.
::
:: The outer loop will get the right tokens, the inner loop assigns the variables depending on the tokens.
:: That will resolve the order of the tokens.
::
@ECHO off
    set v_day=
    set v_month=
    set v_year=

    SETLOCAL ENABLEEXTENSIONS
    if "%date%A" LSS "A" (set toks=1-3) else (set toks=2-4)
::DEBUG echo toks=%toks%
      for /f "tokens=2-4 delims=(-)" %%a in ('echo:^|date') do (
::DEBUG echo first token=%%a
        if "%%a" GEQ "A" (
          for /f "tokens=%toks% delims=.-/ " %%i in ('date/t') do (
            set '%%a'=%%i
            set '%%b'=%%j
            set 'yy'=%%k
          )
        )
      )
      if %'yy'% LSS 100 set 'yy'=20%'yy'%
      set Today=%'yy'%-%'mm'%-%'dd'%

    ENDLOCAL & SET v_year=%'yy'%& SET v_month=%'mm'%& SET v_day=%'dd'%

    ECHO Today is Year: [%V_Year%] Month: [%V_Month%] Day: [%V_Day%]
    set datestring=%V_Year%%V_Month%%V_Day%
    echo %datestring%

    :EOF 
```

——杰伦

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2011-01-03T13:26:05.157

这是时间部分的类似批处理文件。

```
:: http://stackoverflow.com/questions/203090/how-to-get-current-datetime-on-windows-command-line-in-a-suitable-format-for-usi
:: Works on any NT/2k machine independent of regional time settings
::
:: Gets the time in ISO 8601 24-hour format
::
:: Note that %time% gets you fractions of seconds, and time /t doesn't, but gets you AM/PM if your locale supports that.
:: Since ISO 8601 does not care about AM/PM, we use %time%
::
    @ECHO off
    SETLOCAL ENABLEEXTENSIONS
    for /f "tokens=1-4 delims=:,.-/ " %%i in ('echo %time%') do (
      set 'hh'=%%i
      set 'mm'=%%j
      set 'ss'=%%k
      set 'ff'=%%l)
    ENDLOCAL & SET v_Hour=%'hh'%& SET v_Minute=%'mm'%& SET v_Second=%'ss'%& SET v_Fraction=%'ff'%

    ECHO Now is Hour: [%V_Hour%] Minute: [%V_Minute%] Second: [%v_Second%] Fraction: [%v_Fraction%]
    set timestring=%V_Hour%%V_Minute%%v_Second%.%v_Fraction%
    echo %timestring%

    :EOF 
```

——杰伦

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2008-10-14T22:29:00.490

这是我用过的：

```
::Date Variables - replace characters that are not legal as part of filesystem file names (to produce name like "backup_04.15.08.7z")
SET DT=%date%
SET DT=%DT:/=.%
SET DT=%DT:-=.% 
```

* * *

如果您想进一步了解自动备份到 7-Zip 档案，我有一个免费/开放的项目，您可以使用或查看想法：[http ://wittman.org/ziparcy/](http://wittman.org/ziparcy/)

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2014-01-22T11:59:17.323

基于 的函数`wmic`：

```
:Now  -- Gets the current date and time into separate variables
::    %~1: [out] Year
::    %~2: [out] Month
::    %~3: [out] Day
::    %~4: [out] Hour
::    %~5: [out] Minute
::    %~6: [out] Second
  setlocal
  for /f %%t in ('wmic os get LocalDateTime ^| findstr /b [0-9]') do set T=%%t
  endlocal & (
    if "%~1" neq "" set %~1=%T:~0,4%
    if "%~2" neq "" set %~2=%T:~4,2%
    if "%~3" neq "" set %~3=%T:~6,2%
    if "%~4" neq "" set %~4=%T:~8,2%
    if "%~5" neq "" set %~5=%T:~10,2%
    if "%~6" neq "" set %~6=%T:~12,2%
  )
goto:eof 
```

**优势：**地区独立。**缺点：**只有系统管理员可以运行 wmic.exe。

用法：

```
call:Now Y M D H N S
echo %Y%-%M%-%D% %H%:%N%:%S% 
```

这回显了这样的字符串：

```
2014-01-22 12:51:53 
```

请注意，函数参数是 out-Parameters - 也就是说，您必须提供变量名称而不是值。

所有参数都是可选的，`call:Now Y M`如果您只想获取年份和月份，则有效调用也是如此。

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2011-06-14T19:02:38.490

我有一个类似的问题。我每天从 FTP 服务器自动下载一个加密文件。我想使用 gpg 解密文件，将文件重命名为当前日期（YYYYMMDD 格式）并将解密的文件放入正确部门的文件夹中。

我经历了几个根据日期重命名文件的建议，直到我偶然发现了这个简单的解决方案。

```
for /f "tokens=1-5 delims=/ " %%d in ("%date%") do rename "decrypted.txt" %%g-%%e-%%f.txt 
```

它运行良好（即文件名显示为“2011-06-14.txt”）。

[（来源）](http://www.computerhope.com/issues/ch000987.htm)

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2010-10-31T04:45:36.517

[http://sourceforge.net/projects/unxutils/files/](http://sourceforge.net/projects/unxutils/files/)

在 ZIP 文件中查找名为“Date.exe”的内容并将其重命名为“DateFormat.exe”（以避免冲突）。

将它放在您的 Windows system32 文件夹中。

它有很多“日期输出”选项。

如需帮助，请使用`DateFormat.exe --h`

我不确定您如何将其输出放入环境变量中……使用 SET。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2011-09-06T12:09:39.790

生成 ISO 日期格式的区域独立解决方案：

```
rem save the existing format definition
for /f "skip=2 tokens=3" %%a in ('reg query "HKCU\Control Panel\International" /v sShortDate') do set FORMAT=%%a
rem set ISO specific format definition
reg add "HKCU\Control Panel\International" /v sShortDate /t REG_SZ /f /d yyyy-MM-dd 1>nul:
rem query the date in the ISO specific format 
set ISODATE=%DATE%
rem restore previous format definition
reg add "HKCU\Control Panel\International" /v sShortDate /t REG_SZ /f /d %FORMAT% 1>nul: 
```

还可以优化的地方：如果在修改日期格式的过程中在短时间内使用日期格式，其他进程可能会感到困惑。因此，根据现有格式字符串解析输出可能“更安全”——但会更复杂

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2020-07-13T11:21:13.810

组合`Powershell`成一个批处理文件并使用元变量来分配每个：

```
@echo off
for /f "tokens=1-6 delims=-" %%a in ('PowerShell -Command "& {Get-Date -format "yyyy-MM-dd-HH-mm-ss"}"') do (
    echo year: %%a
    echo month: %%b
    echo day: %%c
    echo hour: %%d
    echo minute: %%e
    echo second: %%f
) 
```

如果您喜欢月份名称`MMM`或`MMMM`12 小时到 24 小时格式`hh`或`HH`

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2017-05-10T22:23:20.500

```
:: GetDate.cmd -> Uses WMIC.exe to get current date and time in ISO 8601 format
:: - Sets environment variables %_isotime% and %_now% to current time
:: - On failure, clears these environment variables
:: Inspired on -> https://ss64.com/nt/syntax-getdate.html
:: - (cX) 2017 adolfo.dimare@gmail.com
:: - http://stackoverflow.com/questions/203090
@echo off

set _isotime=
set _now=

:: Check that WMIC.exe is available
WMIC.exe Alias /? >NUL 2>&1 || goto _WMIC_MISSING_

if not (%1)==() goto _help
SetLocal EnableDelayedExpansion

:: Use WMIC.exe to retrieve date and time
FOR /F "skip=1 tokens=1-6" %%G IN ('WMIC.exe Path Win32_LocalTime Get Day^,Hour^,Minute^,Month^,Second^,Year /Format:table') DO (
    IF "%%~L"=="" goto  _WMIC_done_
        set _yyyy=%%L
        set _mm=00%%J
        set _dd=00%%G
        set _hour=00%%H
        set _minute=00%%I
        set _second=00%%K
)
:_WMIC_done_

::   1    2     3       4      5      6
:: %%G  %%H    %%I     %%J    %%K    %%L
:: Day  Hour  Minute  Month  Second  Year
:: 27   9     35      4      38      2017

:: Remove excess leading zeroes
        set _mm=%_mm:~-2%
        set _dd=%_dd:~-2%
        set _hour=%_hour:~-2%
        set _minute=%_minute:~-2%
        set _second=%_second:~-2%
:: Syntax -> %variable:~num_chars_to_skip,num_chars_to_keep%

:: Set date/time in ISO 8601 format:
        Set _isotime=%_yyyy%-%_mm%-%_dd%T%_hour%:%_minute%:%_second%
:: -> http://google.com/search?num=100&q=ISO+8601+format

if 1%_hour% LSS 112 set _now=%_isotime:~0,10% %_hour%:%_minute%:%_second%am
if 1%_hour% LSS 112 goto _skip_12_
    set /a _hour=1%_hour%-12
    set _hour=%_hour:~-2%
    set _now=%_isotime:~0,10% %_hour%:%_minute%:%_second%pm
    :: -> https://ss64.com/nt/if.html
    :: -> http://google.com/search?num=100&q=SetLocal+EndLocal+Windows
    :: 'if () else ()' will NOT set %_now% correctly !?
:_skip_12_

EndLocal & set _isotime=%_isotime% & set _now=%_now%
goto _out

:_WMIC_MISSING_
echo.
echo WMIC.exe command not available
echo - WMIC.exe needs Administrator privileges to run in Windows
echo - Usually the path to WMIC.exe is "%windir%\System32\wbem\WMIC.exe"

:_help
echo.
echo GetDate.cmd: Uses WMIC.exe to get current date and time in ISO 8601 format
echo.
echo    %%_now%%     environment variable set to current date and time
echo    %%_isotime%% environment variable to current time in ISO format
echo    set _today=%%_isotime:~0,10%%
echo.

:_out
:: EOF: GetDate.cmd 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-01-28T19:17:13.933

*   我使用`date.exe`, 并将其重命名`date_unxutils.exe`以避免冲突。

*   将它放在`bin`批处理脚本旁边的文件夹中。

## 代码

```
:: Add binaries to temp path
IF EXIST bin SET PATH=%PATH%;bin

:: Create UTC Timestamp string in a custom format
:: Example: 20210128172058
set timestamp_command='date_unxutils.exe -u +"%%Y%%m%%d%%H%%M%%S"'
FOR /F %%i IN (%timestamp_command%) DO set timestamp=%%i
echo %timestamp% 
```

## 下载 UnxUtils

*   [链接](http://sourceforge.net/projects/unxutils/files/unxutils/current/UnxUtils.zip/download)。

## 参考

*   我建立在这个[很棒的答案上。](https://stackoverflow.com/a/1951681/10830091)

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-11-04T02:14:36.977

PowerShell 试试下面的代码。它将在 24 小时内创建日期为 ddmmyyhhmm 的文件或文件夹变量

```
[int] $day = Get-Date -UFormat %d
[int] $month = Get-Date -UFormat %m
[int] $year = Get-Date -UFormat %y
[String] $date = "$($day)$($month)$($year)"
$time = Get-Date -UFormat %R
$time -replace ‘[:]’,”&quot;
$fileFolderName = $date + time 
```

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2016-08-11T20:07:16.770

给定一个已知的位置，以功能形式供参考。该`ECHOTIMESTAMP`调用显示了如何将时间戳放入变量中（`DTS`在此示例中。）

```
@ECHO off

CALL :ECHOTIMESTAMP
GOTO END

:TIMESTAMP
SETLOCAL  EnableDelayedExpansion
    SET DATESTAMP=!DATE:~10,4!-!DATE:~4,2!-!DATE:~7,2!
    SET TIMESTAMP=!TIME:~0,2!-!TIME:~3,2!-!TIME:~6,2!
    SET DTS=!DATESTAMP: =0!-!TIMESTAMP: =0!
ENDLOCAL & SET "%~1=%DTS%"
GOTO :EOF

:ECHOTIMESTAMP
SETLOCAL
    CALL :TIMESTAMP DTS
    ECHO %DTS%
ENDLOCAL
GOTO :EOF

:END

EXIT /b 0 
```

并保存到文件 timestamp.bat 中，输出如下：

[![在此处输入图像描述](https://i.stack.imgur.com/zc1ZI.jpg)](https://i.stack.imgur.com/zc1ZI.jpg)

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2016-08-16T10:44:40.553

对于 Windows 7，此代码适用于我：

```
SET DATE=%date%
SET YEAR=%DATE:~0,4%
SET MONTH=%DATE:~5,2%
SET DAY=%DATE:~8,2%
ECHO %YEAR%
ECHO %MONTH%
ECHO %DAY%

SET DATE_FRM=%YEAR%-%MONTH%-%DAY% 
ECHO %DATE_FRM% 
```

* * *

## 回答 #29

> 赞同：-3
> 
> 时间：2016-08-15T15:57:00.700

我知道已经提到了很多方法。但这是我分解它以了解它是如何完成的方法。希望它对喜欢逐步方法的人有所帮助。

```
:: Check your local date format
echo %date%

    :: Output is Mon 08/15/2016

:: get day (start index, number of characters)
::         (index starts with zero)
set myday=%DATE:~0,4%
echo %myday%
    :: output is Mon 

:: get month
set mymonth=%DATE:~4,2%
echo %mymonth%
    :: output is 08

:: get date 
set mydate=%DATE:~7,2% 
echo %mydate%
    :: output is 15

:: get year
set myyear=%DATE:~10,4%
echo %myyear%
    :: output is 2016 
```

* * *

## 回答 #30

> 赞同：-3
> 
> 时间：2018-12-06T10:13:19.273

我注意到 o/p 没有**要求**独立于区域的解决方案。我的解决方案是针对英国的。

这是用于批处理文件的最简单的解决方案，即 1 行解决方案：

```
FOR /F "tokens=1-3 delims=/" %%A IN ("%date%") DO (SET today=%%C-%%B-%%A)
echo %today% 
```

# .net - 互操作控件未选择 XP 样式

> ID：203096
> 
> 赞同：1
> 
> 时间：2008-10-14T22:27:23.410
> 
> 标签：.net, winforms, vb6, interop

我在 VS2005 中创建了一个 Interop 用户控件。当用户控件显示在 VB6 中时，它不会拾取/使用 XP 样式（按钮和选项卡看起来像 VB6 按钮/选项卡）。

在 VB6 中，如何让 XP 样式与我的控件一起使用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T22:36:46.887

您需要为应用程序添加清单文件，将名称为 {exefilename}.exe.manifest 的文件添加到与应用程序相同的文件夹中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T21:45:52.040

清单文件仅适用于 .net 的早期版本，在 .net 1.1 之后，您可以通过编程方式激活它们。我必须`Application.EnableVisualStyles()`在互操作用户控件的默认构造函数中添加该行。

```
Public Sub New()
    Application.EnableVisualStyles() '-- I added this line
    ' This call is required by the Windows Form Designer.
    InitializeComponent()
    ' Add any initialization after the InitializeComponent() call.
    'Raise Load event
    Me.OnCreateControl()
End Sub 
```

这是[微软的帖子，`Application.EnableVisualStyles`](http://blogs.msdn.com/rprabhu/archive/2003/09/28/56540.aspx)它解释了一切。

* * *

@marioh - 感谢您的回复。

# javascript - 根据需要使用 javascript 注入脚本引用？

> ID：203113
> 
> 赞同：12
> 
> 时间：2008-10-14T22:36:11.600
> 
> 标签：javascript, include

我有一个 JS 函数，可能偶尔会在某些页面上使用。它依赖于另一个 JS 文件（swfObject.js），但我想避免在所有地方都包含这个文件，因为大多数时候这是一个浪费的请求。

相反，我想创建一个通用函数，它可以根据需要将脚本引用注入到页面 DOM 中，因此如果调用此函数，它将检查脚本，如果不存在，则将其加载。

我相当确定这是可能的（而且我不会使用 document.write），但在我冒险进入未知领域之前，有没有人这样做过，如果有，有什么建议吗？

编辑：好的，我试过了，它适用于 IE6 和 FF，我还没有测试过其他浏览器。

这是我的代码（修订版 2.0，现在带有可选回调）：

```
function loadJSInclude(scriptPath, callback)
{
    var scriptNode = document.createElement('SCRIPT');
    scriptNode.type = 'text/javascript';
    scriptNode.src = scriptPath;

    var headNode = document.getElementsByTagName('HEAD');
    if (headNode[0] != null)
        headNode[0].appendChild(scriptNode);

    if (callback != null)    
    {
        scriptNode.onreadystagechange = callback;            
        scriptNode.onload = callback;
    }
} 
```

并在具有依赖关系的方法中：

```
var callbackMethod = function ()
{
    // Code to do after loading swfObject
}

// Include SWFObject if its needed
if (typeof(SWFObject) == 'undefined')    
    loadJSInclude('/js/swfObject.js', callbackMethod);
else
    calbackMethod(); 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T22:47:05.990

如果您使用的是更高级别的框架，例如 JQuery，您可以查看该`$.getScript(url, callback)`功能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-15T08:57:19.177

如果您希望您的代码在下一行，并且喜欢编写如下内容：

```
if (iNeedSomeMore){
  Script.load("myBigCodeLibrary.js");  // includes code for myFancyMethod();
  myFancyMethod();                     // cool, no need for callbacks!
} 
```

有一种*无需回调*即可注入脚本依赖项的聪明方法。您只需通过*同步 AJAX 请求*提取脚本并在全局级别评估脚本。

如果您使用 Prototype，则 Script.load 方法如下所示：

```
var Script = {
  _loadedScripts: [],
  include: function(script){
    // include script only once
    if (this._loadedScripts.include(script)){
      return false;
    }
    // request file synchronous
    var code = new Ajax.Request(script, {
      asynchronous: false, method: "GET",
      evalJS: false, evalJSON: false
    }).transport.responseText;
    // eval code on global level
    if (Prototype.Browser.IE) {
      window.execScript(code);
    } else if (Prototype.Browser.WebKit){
      $$("head").first().insert(Object.extend(
        new Element("script", {type: "text/javascript"}), {text: code}
      ));
    } else {
      window.eval(code);
    }
    // remember included script
    this._loadedScripts.push(script);
  }
}; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T22:45:41.860

检查 YUI 加载程序实用程序。它是超级方便、不显眼的 javascript，用于按需加载脚本。

这是一个使用非 YUI 脚本的示例的链接：

[http://developer.yahoo.com/yui/examples/yuiloader/yl-addmodule.html](http://developer.yahoo.com/yui/examples/yuiloader/yl-addmodule.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-23T23:55:03.620

如果脚本本身包含 document.write，则这些方法（包括 document.writing 脚本标记）都不起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-12T18:22:36.363

我编写了一个简单的模块，它可以自动执行在 JavaScript 中导入/包含模块脚本的工作。试一试，请留下一些反馈！:) 有关代码的详细说明，请参阅此博客文章：[http ://stamat.wordpress.com/2013/04/12/javascript-require-import-include-modules/](http://stamat.wordpress.com/2013/04/12/javascript-require-import-include-modules/)

```
// ----- USAGE -----

require('ivar.util.string');
require('ivar.net.*');
require('ivar/util/array.js');
require('http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js');

ready(function(){
    //do something when required scripts are loaded
});

    //--------------------

var _rmod = _rmod || {}; //require module namespace
_rmod.LOADED = false;
_rmod.on_ready_fn_stack = [];
_rmod.libpath = '';
_rmod.imported = {};
_rmod.loading = {
    scripts: {},
    length: 0
};

_rmod.findScriptPath = function(script_name) {
    var script_elems = document.getElementsByTagName('script');
    for (var i = 0; i < script_elems.length; i++) {
        if (script_elems[i].src.endsWith(script_name)) {
            var href = window.location.href;
            href = href.substring(0, href.lastIndexOf('/'));
            var url = script_elems[i].src.substring(0, script_elems[i].length - script_name.length);
            return url.substring(href.length+1, url.length);
        }
    }
    return '';
};

_rmod.libpath = _rmod.findScriptPath('script.js'); //Path of your main script used to mark the root directory of your library, any library

_rmod.injectScript = function(script_name, uri, callback, prepare) {

    if(!prepare)
        prepare(script_name, uri);

    var script_elem = document.createElement('script');
    script_elem.type = 'text/javascript';
    script_elem.title = script_name;
    script_elem.src = uri;
    script_elem.async = true;
    script_elem.defer = false;

    if(!callback)
        script_elem.onload = function() {
            callback(script_name, uri);
        };

    document.getElementsByTagName('head')[0].appendChild(script_elem);
};

_rmod.requirePrepare = function(script_name, uri) {
    _rmod.loading.scripts[script_name] = uri;
    _rmod.loading.length++;
};

_rmod.requireCallback = function(script_name, uri) {
    _rmod.loading.length--;
    delete _rmod.loading.scripts[script_name];
    _rmod.imported[script_name] = uri;

    if(_rmod.loading.length == 0)
        _rmod.onReady();
};

_rmod.onReady = function() {
    if (!_rmod.LOADED) {
        for (var i = 0; i < _rmod.on_ready_fn_stack.length; i++){
            _rmod.on_ready_fn_stack[i]();
        });
        _rmod.LOADED = true;
    }
};

_.rmod = namespaceToUri = function(script_name, url) {
    var np = script_name.split('.');
    if (np.getLast() === '*') {
        np.pop();
        np.push('_all');
    }

    if(!url)
        url = '';

    script_name = np.join('.');
    return  url + np.join('/')+'.js';
};

//you can rename based on your liking. I chose require, but it can be called include or anything else that is easy for you to remember or write, except import because it is reserved for future use.
var require = function(script_name) {
    var uri = '';
    if (script_name.indexOf('/') > -1) {
        uri = script_name;
        var lastSlash = uri.lastIndexOf('/');
        script_name = uri.substring(lastSlash+1, uri.length);
    } else {
        uri = _rmod.namespaceToUri(script_name, ivar._private.libpath);
    }

    if (!_rmod.loading.scripts.hasOwnProperty(script_name) 
     && !_rmod.imported.hasOwnProperty(script_name)) {
        _rmod.injectScript(script_name, uri, 
            _rmod.requireCallback, 
                _rmod.requirePrepare);
    }
};

var ready = function(fn) {
    _rmod.on_ready_fn_stack.push(fn);
}; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-09-16T00:49:22.347

考虑使用[require.js](http://requirejs.org/)。这可能需要对您的前端框架进行一些返工，但这完全值得。使用 require，您可以在您的 中执行以下操作`fileUsedOccasionally.js`：

```
定义（['swfObject'，'someOtherDependency']，函数（swfObject，someOtherDependency）{
  // 你现在可以使用 swfObject 作为 JS 对象了！你可以随便叫它
  // 你必须编写一个 swfObject.js 来用 require 包装它
  // 但这是微不足道的
});

```

# .net - WCF - 在没有 IIS7 的情况下，可以在单一设置中使用 SSL 的 NetTcp 和 basicHttp

> ID：203117
> 
> 赞同：0
> 
> 时间：2008-10-14T22:37:30.580
> 
> 标签：.net, asp.net, wcf

是否可以两者兼得

*   NetTcp 绑定端点，以及
*   使用 SSL 的 basicHttp 绑定端点

在单个部署中，使用 Windows 服务还是 IIS6？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T16:07:03.660

是的，单个服务主机可以公开具有不同绑定的多个端点。但是，正常的 IIS 限制适用于 IIS，因此 IIS 6 一开始就不支持 NetTcp 绑定。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-24T14:39:04.623

从 IIS 7.0 开始，您*可以*使用 IIS 的 net.tcp 绑定。*是*的，您可以在单个 WCF 服务安装中公开多个绑定（即 wsHttpBinding 和 net.tcp）。以下 (2) 链接应该会有所帮助：

**多个端点：http:**
[//msdn.microsoft.com/en-us/library/ms751515.aspx](http://msdn.microsoft.com/en-us/library/ms751515.aspx)

**IIS 7：支持非 HTTP 协议：http:**
[//blogs.msdn.com/b/swiss_dpe_team/archive/2008/02/08/iis-7-support-for-non-http-protocols.aspx](http://blogs.msdn.com/b/swiss_dpe_team/archive/2008/02/08/iis-7-support-for-non-http-protocols.aspx)

# sql - sql 脚本中的 Week() 函数

> ID：203118
> 
> 赞同：2
> 
> 时间：2008-10-14T22:38:04.170
> 
> 标签：sql, sql-server, sql-server-2005

我正在使用 sql server 2005。我只是想知道我们是否可以获得特定月份的周数。示例`Date = '2008-10-16'`有没有我们可以拥有的东西`SELECT WEEK(Date)`。或者有什么更好的建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T22:39:27.130

```
SELECT DATEPART( week, '2008-10-16') 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T22:43:16.187

你可以这样做：

```
SET @weeksinmonth=datediff(week, @date, @lastdate) + 1 
```

这是我的一个存储过程的复制粘贴。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T22:54:43.213

```
select (datepart(dd,'2008-10-08')-1) / 7 + 1 
```

# c++ - C++ 编译器如何知道要调用哪个虚函数实现？

> ID：203126
> 
> 赞同：9
> 
> 时间：2008-10-14T22:43:23.767
> 
> 标签：c++, oop, polymorphism

[这是来自http://www.cplusplus.com/doc/tutorial/polymorphism.html](http://www.cplusplus.com/doc/tutorial/polymorphism.html)的多态性示例（为便于阅读而编辑）：

```
// abstract base class
#include <iostream>
using namespace std;

class Polygon {
    protected:
        int width;
        int height;
    public:
        void set_values(int a, int b) { width = a; height = b; }
        virtual int area(void) =0;
};

class Rectangle: public Polygon {
    public:
        int area(void) { return width * height; }
};

class Triangle: public Polygon {
    public:
        int area(void) { return width * height / 2; }
};

int main () {
    Rectangle rect;
    Triangle trgl;
    Polygon * ppoly1 = &rect;
    Polygon * ppoly2 = &trgl;
    ppoly1->set_values (4,5);
    ppoly2->set_values (4,5);
    cout << ppoly1->area() << endl; // outputs 20
    cout << ppoly2->area() << endl; // outputs 10
    return 0;
} 
```

我的问题是编译器如何知道 ppoly1 是 Rectangle 而 ppoly2 是 Triangle，以便它可以调用正确的 area() 函数？它可以通过查看“Polygon * ppoly1 = ▭”行并知道 rect 是一个 Rectangle 来发现这一点，但这并不是在所有情况下都有效，不是吗？如果你做了这样的事情怎么办？

```
cout << ((Polygon *)0x12345678)->area() << endl; 
```

假设您被允许访问该随机内存区域。

我会对此进行测试，但我目前无法在我使用的计算机上进行测试。

（我希望我没有遗漏一些明显的东西......）

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-14T22:46:42.170

每个对象（属于具有至少一个虚函数的类）都有一个指针，称为 a `vptr`。它指向`vtbl`它的实际类（每个具有虚函数的类至少有一个；对于某些多重继承场景可能不止一个）。

`vtbl`包含一堆指针，每个虚函数一个。所以在运行时，代码只使用对象`vptr`来定位`vtbl`，并从那里找到实际覆盖函数的地址。

在您的特定情况下，`Polygon`,`Rectangle`和`Triangle`每个都有一个`vtbl`, 每个都有一个指向其相关`area`方法的条目。您`ppoly1`将有一个`vptr`指向`Rectangle`'s的指向`vtbl`，并且与's`ppoly2`类似。希望这可以帮助！`Triangle``vtbl`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-14T22:52:25.310

[Chris Jester-Young](https://stackoverflow.com/questions/203126/how-does-the-c-compiler-know-which-implementation-of-a-virtual-function-to-call#203136)给出了这个问题的基本答案。

[维基百科](http://en.wikipedia.org/wiki/Virtual_table)有更深入的处理。

如果您想了解此类事物如何工作的全部细节（以及所有类型的继承，包括多重继承和虚拟继承），最好的资源之一是 Stan Lippman 的“ [C++ 对象模型内部](https://rads.stackoverflow.com/amzn/click/com/0201834545)”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-14T22:46:31.373

忽略绑定的各个方面，实际上并不是编译器决定了这一点。

正是 C++ 运行时通过 vtables 和 vpointers 评估派生对象在运行时的实际情况。

我强烈推荐 Scott Meyer 的《Effective C++》一书，它很好地描述了这是如何完成的。

甚至涵盖了如何忽略派生类中的方法中的默认参数，并且仍然采用基类中的任何默认参数！那是有约束力的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T22:48:45.707

要回答您问题的第二部分：该地址可能不会在正确的位置有一个 v-table，然后会发疯。此外，根据标准，它是未定义的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T23:04:50.603

```
cout << ((Polygon *)0x12345678)->area() << endl; 
```

这段代码是一场等待发生的灾难。编译器会编译它，但是当涉及到运行时，你不会指向一个有效的 v-table，如果你幸运的话，程序就会崩溃。

在 C++ 中，您不应该像这样使用旧的 C 风格强制转换，您应该像这样使用**dynamic_cast**：

```
Polygon *obj = dynamic_cast<Polygon *>(0x12345678)->area();
ASSERT(obj != NULL);

cout << obj->area() << endl; 
```

如果给定的指针不是有效的 Polygon 对象，dynamic_cast 将返回 NULL，因此它将被 ASSERT 捕获。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-14T23:06:58.137

虚函数表。也就是说，您的两个 Polygon 派生对象都有一个虚函数表，其中包含指向所有（非静态）函数实现的函数指针；当你实例化一个 Triangle 时， area() 函数的虚函数指针指向 Triangle::area() 函数；当你实例化一个 Rectangle 时， area() 函数指向 Rectangle::area() 函数。因为虚函数指针与对象的数据一起存储在内存中，所以每次将该对象作为 Polygon 引用时，都会使用该对象的相应 area()。

# c# - 是否可以在 Socket 和 TcpClient 对象之间进行转换？

> ID：203147
> 
> 赞同：13
> 
> 时间：2008-10-14T22:49:45.470
> 
> 标签：c#, .net, sockets, tcpclient, system.net

这是另一个 C#/.NET 问题，仅基于好奇而不是迫切*需要*...

如果你有一个`Socket`实例并且你想将它包装在更高级别的`TcpClient`类中，这可能吗？你会怎么做？

相反，如果您有 的实例`TcpClient`，是否有可能获得基础`Socket`？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-14T23:00:07.260

> 如果你有一个 Socket 实例并且你想将它包装在更高级别的 TcpClient 类中，这可能吗？你会怎么做？

```
Socket socket = ...;
TcpClient client = new TcpClient();
client.Client = socket; 
```

> 反之，如果你有一个 TcpClient 的实例，是否有可能获得底层的 Socket？

[使用TcpClient.Client](http://msdn.microsoft.com/en-us/library/system.net.sockets.tcpclient.client.aspx)属性获取底层 Socket 。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T22:56:18.563

从 TcpClient 到 Socket 非常容易。`tcpClientInstance.Client`是底层的 Socket 实例。

# delphi - 防止系列在 Delphi TChart 中使用 clWhite

> ID：203151
> 
> 赞同：2
> 
> 时间：2008-10-14T22:55:21.420
> 
> 标签：delphi, charts, colors, teechart

我有一份使用我正在维护的 TChart 的报告。自动添加的 TLineSeries 之一被分配颜色 clWhite，它太靠近背景 (clBtnFace)。

如果我更改它，那么添加的下一个系列将采用 clWhite。在创建所有其他系列之后，没有返回并更改它，有没有办法告诉 TChart 我不希望我的任何系列成为 clWhite？

当一个系列被添加到 TChart 时，TChart 会为其分配一种颜色。我希望它不分配 clWhite。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-15T00:49:11.017

好的，不要轻易放弃，我做了更多的搜索。在 TeeProcs 单元中有一个 TColorArray 类型的*名为**ColorPalette*的**单元**变量 。如果我找到并用另一种颜色替换白色来修复它。可能有它的实例副本。我会继续寻找，因为那将是首选。

 **要恢复**ColorPalette** ，只需在同一单元中调用单元方法**SetDefaultColorPalette 。**

```
SetDefaultColorPalette; // Make sure we start with the default
ColorPalette[4] := $007FFF; // Change White to Orange
try
  // add series to the chart
finally
  SetDefaultColorPalette;  // Set it back to Default
end; 
```

顺便说一句，我不能**接受作为答案**，因为我也问了这个问题，但我测试了它并且它有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T23:41:08.190

从 TeeCharts 模块中我可以看出；不，您不能指定发货时不应该采用的颜色。
您可以以编程方式遍历所有 TLineSeries 条目，确保它们在运行时不使用 clWhite。假设您有一个可接受的颜色数组 clArray，您可以使用以下代码在运行时设置每个 tLineSeries 条目的颜色。

```
procedure TForm1.setColors(aChart: TChart; aColorArray: array of TColor);
var
  chi : Integer;
  coi : Integer;
begin
  coi := low(aColorArray);
  for chi := 0 to aChart.SeriesList.Count - 1 do begin
    aChart.SeriesList[chi].Color := aColorArray[coi];
    inc(coi);
    if coi > high(aColorArray) then
      coi := low(aColorArray);
  end;
end;

procedure TForm1.FormShow(Sender: TObject);
var
  ca : array of TColor;
begin
  setLength(ca, 3);
  ca[0] := clRed;
  ca[1] := clBlue;
  ca[2] := clGreen;
  setColors(Chart1, ca);
end; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T01:10:13.613

您可以使用系列方法 ClearPalette 然后 AddPalette 来创建您的自定义调色板。

# javascript - 如何使用 Ajax 解决“NS_ERROR_ILLEGAL_VALUE”错误？

> ID：203161
> 
> 赞同：8
> 
> 时间：2008-10-14T23:00:13.547
> 
> 标签：javascript, ajax

我只是编写了一个小型 Ajax 框架以在小型项目中实现可重用性，但我遇到了一个问题。基本上我`NS_ERROR_ILLEGAL_VALUE`在发送请求时收到“”错误，我不知道发生了什么。

HTML 页面（已修剪但显示错误）

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
    <head> 
        <title>Ajax Test</title> 
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 

        <script type="text/javascript">

            var COMPLETE = 4;
            var OK = 200;

            function GetXMLHttpRequestObject()
            {
                var XMLHttpRequestObject = false;

                if(window.XMLHttpRequest)
                {
                    if(typeof XMLHttpRequest != 'undefined')
                    {
                        try
                        {
                            XMLHttpRequestObject = new XMLHttpRequest();
                        }
                        catch (e)
                        {
                            XMLHttpRequestObject = false;
                        }
                    }
                }
                else if (window.ActiveXObject)
                {
                    try
                    {
                        XMLHttpRequestObject = new ActiveXObject('Msxml2.XMLHTTP');
                    }
                    catch (e)
                    {
                        try
                        {
                            XMLHttpRequestObject = new ActiveXObject('Microsoft.XMLHTTP');
                        }
                        catch (e)
                        {
                            XMLHttpRequestObject = false;
                        }
                    }
                }
                else
                {
                    XMLHttpRequestObject = false;
                }
                return XMLHttpRequestObject;
            }

            //The Main Ajax Object
            function AjaxRequest(p_RequestMethod, p_DestinationURL)
            {
                this.XMLHttpRequestObject = GetXMLHttpRequestObject();

                this.RequestedMethod = p_RequestMethod;
                this.DestinationURL = p_DestinationURL;

                this.XMLHttpRequestObject.open(this.RequestMethod, this.DestinationURL);

                this.OnStateChange = function(Callback)
                {
                    this.XMLHttpRequestObject.onreadystatechange = Callback;
                }

                this.Send = function(p_Content)
                {
                    this.XMLHttpRequestObject.send(p_Content);
                }

                this.GetState()
                {
                    return this.XMLHttpRequestObject.readyState;
                }

                this.GetResponseText = function()
                {
                    return this.XMLHttpRequestObject.responseText;
                }

                this.GetResponseStatus = function()
                {
                    return this.XMLHttpRequestObject.status;
                }

                this.GetResponseStatusText = function()
                {
                    return this.XMLHttpRequestObject.statusText;
                }
            }

            var Request;

            function GetData()
            {
                Request = new AjaxRequest('POST', 'http://www.kalekold.net/ajax/Ajax.php');
                Request.OnStateChange = StateChange;
                Request.Send();
            }

            function StateChange()
            {
                window.alert("State: " + Request.GetState());
                window.alert("Response: " + Request.GetResponseStatus());
                window.alert("Response Text: " + Request.GetResponseStatusText());

                if(Request.GetState() == COMPLETE && Request.GetResponseStatus() == OK)
                {
                    Result = Request.GetResponseText();
                    window.alert(Result);
                }
            }
        </script> 

    </head> 
    <body> 
        <form>
            <textarea name="TextArea" rows="10" cols="80"></textarea><br />
            <input type="button" value="Load" onClick="GetData();">
        </form>
    </body> 
</html> 
```

PHP 文件：

```
<?php
$XML = <<< PROLOG
<?xml version="1.0" encoding="iso-8859-1"?>
PROLOG;

$XML .= "<results>";
    $XML .= "<result>";
        $XML .= "<FirstName>Gary</FirstName>";
        $XML .= "<SecondName>Willoughby</SecondName>";
        $XML .= "<Age>35</Age>";
    $XML .= "</result>";
    $XML .= "<result>";
        $XML .= "<FirstName>Sara</FirstName>";
        $XML .= "<SecondName>Gostick</SecondName>";
        $XML .= "<Age>35</Age>";
    $XML .= "</result>";
$XML .= "</results>";

header("Content-Type: text/xml");
echo $XML;
?> 
```

完整的错误：

```
uncaught exception: [Exception... "Component returned failure code: 0x80070057 (NS_ERROR_ILLEGAL_VALUE) [nsIXMLHttpRequest.open]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: http://www.kalekold.net/ajax/ :: AjaxRequest :: line 63"  data: no]

Line 0 
```

我只是看不出哪里出了问题，有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-15T08:33:41.767

异常“组件返回失败代码：0x80070057 (NS_ERROR_ILLEGAL_VALUE)”是由于传入 open 方法调用的非法值引起的。

查看您的代码，我发现拼写错误：

```
this.RequestedMethod = p_RequestMethod;
this.DestinationURL = p_DestinationURL;

this.XMLHttpRequestObject.open(this.RequestMethod, this.DestinationURL);

```

看到 this.RequestedMethod 属性设置为 p_RequestMethod 并且 this.RequestMethod 被传递到“open”方法的调用中。

此外，我建议不要创建自己的包装器，而是使用开源[XMLHttpRequest.js](http://code.google.com/p/xmlhttprequest/) - 符合标准的跨浏览器 XMLHttpRequest 对象实现，它还修复了浏览器原生 XMLHttpRequest 对象实现的大约 20 个错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T08:37:14.910

此错误消息是 FireFox 的 XMLHttpRequest 对象的“怪癖”之一。IE 中的相同问题会有不同的症状。

你不想自己处理所有这些怪癖，因为那里有很多好的库。

例如，在 Netscape 和 FX 调用`XMLHttpRequestObject.responseText`或`XMLHttpRequestObject.status`引发任何连接问题的“NS_...”错误。IE 将改为返回操作系统网络错误代码 - 不会引发错误。如果您自己处理此问题，则必须为两者构建错误处理。

我会推荐[jQuery](http://jquery.com/)。[原型](http://www.prototypejs.org/)也很棒。

# markdown - Markdown 文档中的书签链接

> ID：203171
> 
> 赞同：18
> 
> 时间：2008-10-14T23:07:45.683
> 
> 标签：markdown, bookmarklet

如何在 Markdown 解析文档中包含书签？降价是否有任何“标签”，基本上说“不要解析这个”？

例如，您可能有类似的东西：

```
<a href="javascript:function my_bookmarklet()
                {alert('Hello World');}
                my_bookmarklet();">Hello</a> 
```

但是，如果我尝试将其中的 javascript 传递到 markdown 中的链接中，如下所示：

```
[Hello World!](javascript:function my_bookmarklet(){alert('Hello World');}my_bookmarklet();) 
```

你得到一个混乱的链接，如下所示。

[Hello World!](javascript:function my_bookmarklet(){alert('Hello World');}my_bookmarklet();)

有没有办法解决？

不，我不想将恶意书签放在 SO 或任何东西中，但我想为我的网站使用降价，并想发布一些我写的书签。

编辑：我以为我有答案……但现在看来我还没有答案。

这似乎在 WMD 和摊牌中效果很好，但在 Markdown.php 编辑器中却不行。任何人都有专门使用 Markdown.php 的经验吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-12-31T06:53:48.337

```
[Hello World!][1]
[1]:javascript:alert('Hello World') 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-14T23:14:03.333

Markdown 将保留任何 HTML，因此您只需输入

```
<a href="javascript:function my_bookmarklet()
                {alert('Hello World');}
                my_bookmarklet();">Hello</a> 
```

~~并打招呼。~~ *编辑：不再适用于 SO，这是一件好事*

您还可以使用反斜杠转义特殊字符（在这种情况下，它会将您的 Javascript 中的“)”视为 URL 的结尾）并且链接语法将起作用：

```
[Hello](javascript:function my_bookmarklet(\){alert('Hello World'\);}my_bookmarklet(\);) 
```

~~给出 [Hello](javascript:function my_bookmarklet(){alert('Hello World');}my_bookmarklet();)~~

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-04-12T23:36:07.483

我知道这是一个非常古老的问题，但是（如果有人像我一样在这里找到他们的方式），如果您对脚本进行 url 编码，它将起作用。

例如：

```
 [Hello World](javascript:%28function%28%29%7Balert%28%22Hello%20World%22%29%7D%29%28%29%3B) 
```

当然，如上所述，它在 SO 上不起作用。

注意：一些 url-encoders 会将空格（“”）替换为“+”，这适用于常规 url，但不适用于 js 代码，空格应替换为“%20”

**编辑**：这似乎并不普遍正确。我想特定的降价解析器会在这里进行最终调用。但这在更多使用降价的地方对我有用。

# build-process - 如何让 doxygen 跑得更快？

> ID：203172
> 
> 赞同：21
> 
> 时间：2008-10-14T23:09:34.307
> 
> 标签：build-process, doxygen

Doxygen 有点慢 - 处理我的整个项目大约需要几分钟，所以对于小的增量更改，这比实际构建我的其余代码要长。有成千上万个文件没有任何文档，所以我猜它大部分时间都在处理它们。有没有办法让它在没有任何文档的情况下跳过文件？

让它只处理更改的文件怎么样？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-04T10:34:39.303

来自 Doxygen 文档：

> 如何从我的目录树中排除所有测试目录？
> 
> 只需在配置文件中放置这样的排除模式：
> 
> EXCLUDE_PATTERNS = */测试/*

因此，您应该使用模式来排除文件。自从我使用 Doxygen 已经很长时间了，但我不记得有任何选项可以只处理更改的文件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-23T02:15:36.600

我发现关闭该选项`SEARCH_INCLUDES`有很大的不同。它正在查看整个平台 SDK 并包含编译器的路径，这些路径无论如何都没有记录，也不会出现在生成的文档中。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-07-20T16:29:17.007

有一个 DOT_NUM_THREADS 选项可以提高多核机器的性能。不幸的是，doxygen 本身只是单线程的。

另一种方法是将您的代码组织成模块，为每个模块运行一个单独的 doxygen 实例并将生成的标签链接在一起： http: [//www.doxygen.nl/manual/external.html](http://www.doxygen.nl/manual/external.html)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-06T09:04:36.283

Doxygen 擅长查找文件之间的连接，无论是否更改。但是 Doxygen 不会记住有关未更改文件的信息，因此它必须每次都处理整个代码库。

可能的解决方案是组织项目，使从未更改的文件属于一个模块，该模块被排除在 Doxygen 范围之外并且其文档已经可用。然后可以告诉 Doxygen 将新建的文档链接到这个现有的模块文档。

更进一步，还可以使 Doxygen 逐个模块运行，只处理更改的模块和链接到所有模块文档的顶级文档。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-16T12:42:10.777

我不认为让 Doxygen 在正常的开发周期上运行是一个好主意。我们的 Doxygen 构建作为我们持续集成服务器职责的一部分运行。

也就是说，每次构建运行 doxygen 以捕获丢失的文档有一些好处。所以我会修剪 doxygen 配置以用于删除图表的开发构建，甚至停止苹果将其导入 xcode。

# java - 是否有可以创建丰富的 Word 文档的 Java API？

> ID：203174
> 
> 赞同：112
> 
> 时间：2008-10-14T23:09:59.847
> 
> 标签：java, ms-word, docx, doc

我有一个新的应用程序，我将在其中生成一个包含表格、图表、目录和文本的 Word 文档。为此使用什么好的 API？你有多确定它支持图表、ToCs 和表格？使用它们有哪些隐藏的陷阱？

一些澄清：

*   我无法输出 PDF，他们需要 Word 文档。
*   他们使用的是 MS Word 2003（或 2007），而不是 OpenOffice
*   应用程序在 *nix app-server 上运行

如果我可以从模板文档开始，然后用表格、图表等填充一些空格，那就太好了。

编辑：以下几个很好的答案，就我目前的情况而言，每个都有自己的缺点。很难从他们那里选出一个“最终答案”。想我会把它打开，并希望能创造出更好的解决方案。

编辑：OpenOffice UNO 项目似乎确实最接近我的要求。虽然 POI 肯定更主流，但它对于我想要的来说太不成熟了。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-11-02T16:05:55.173

2007 年，我的项目成功地使用 OpenOffice.org 的[通用网络对象](https://www.openoffice.org/udk/common/man/uno.html)(UNO) 接口从 Java Web 应用程序（Struts/JSP 框架）以编程方式生成 MS-Word 兼容文档 (*.doc) 以及相应的 PDF 文档。

OpenOffice UNO 还允许您构建与 MS-Office 兼容的图表、电子表格、演示文稿等。我们能够动态构建复杂的 Word 文档，包括图表和表格。

我们通过使用带有书签插入的模板 MS-Word 文档来简化流程，软件在其中插入内容，但是，您可以完全从头开始构建文档。目标是让软件生成报告文档，最终用户可以共享和进一步调整，然后将其转换为 PDF 以进行最终交付和存档。

如果您希望用户使用 OpenOffice 而不是 MS-Office，您可以选择以 OpenOffice 格式生成文档。在我们的例子中，用户想要使用 MS-Office 工具。

UNO 包含在 OpenOffice 套件中。我们只是将我们的 Java 应用程序链接到套件中与 UNO 相关的库。[OpenOffice 软件开发工具包](http://www.openoffice.org/download/sdk/)(SDK) 包含示例应用程序和 UNO 开发人员指南。

我还没有调查过最新的 OpenOffice UNO 是否可以生成 MS-Office 2007 Open XML 文档格式。

OpenOffice UNO 的重要之处在于：

1.  它是免费软件
2.  它支持多种语言（例如 Visual Basic、Java、C++ 等）。
3.  它与平台无关（Windows、Linux、Unix 等）。

以下是一些有用的网站：

*   [打开办公之家](http://www.openoffice.org)
*   [Open Office UNO 开发人员指南](http://wiki.services.openoffice.org/wiki/Documentation/DevGuide/OpenOffice.org_Developers_Guide)
*   [OpenOffice 开发者论坛](http://www.staroffice.org/developers.html)（尤其是“宏和 API”和“代码片段”论坛）。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-10-14T23:17:05.230

我认为[Apache POI](http://poi.apache.org/)可以完成这项工作。一个可能的问题取决于您的目标用途，这可能是由于 HWPF 仍处于早期开发阶段。

> [HWPF](http://poi.apache.org/hwpf/index.html) 是一组 API，用于使用（仅）Java 读取和写入 Microsoft Word 97(-XP) 文档。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-07-26T03:22:35.000

你可以使用这个： [http ://code.google.com/p/java2word](http://code.google.com/p/java2word)

我实现了这个名为 Java2Word 的 API。只需几行代码，您就可以生成一个 Microsoft Word 文档。

例如。：

```
IDocument myDoc = new Document2004();
myDoc.getBody().addEle(new Heading1("Heading01"));
myDoc.getBody().addEle(new Paragraph("This is a paragraph...") 
```

有一些示例如何使用。基本上你需要一个 jar 文件。如果您需要任何进一步的信息，请告诉我如何设置它。

*我写这个是因为我们在一个项目中有一个真正的必要性。更多在我的博客：

http://leonardo-pinho.blogspot.com/2010/07/java2word-word-document-generator-from.html *

欢呼莱昂纳多

**编辑**：链接中的项目移至[https://github.com/leonardoanalista/java2word](https://github.com/leonardoanalista/java2word)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-12-21T21:59:55.357

试试 Aspose.Words for Java，它可以在任何安装了 Java 的操作系统上运行。

如果您需要 MS Word 输出格式，它会将文档输出为 DOC、DOCX 或 RTF。所有的支持都一样好。

使用此 API，您可以从头开始创建文档，从节点开始并设置它们的格式属性。您还可以使用 DocumentBuilder 提供更高级别的方法，例如创建表格行、插入字段等。或者您可以在现有的预先创建的文档之间复制/加入/移动部分，比如您想组装一份合同，只需抓取并复制来自多个文档的片段和 Aspose.Words 将在生成的文档中正确地合并样式、列表格式等。

您将能够使用 Aspose.Words 插入 TOC 字段，但从今天开始，在 Microsoft Word 中打开文档时，TOC 字段将需要更新字段。但是，我们将在 2010 年初发布对 TOC 字段的全面支持。例如，它将像 MS Word 那样构建完整的 TOC。

我在 Aspose.Words 团队。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-08T10:57:50.297

试试[Aspose.Words](http://www.aspose.com/categories/java-components/aspose.words-for-java/default.aspx) for java。

> Aspose.Words for Java 是一个用于 Java 的高级（商业）类库，使您能够直接在 Java 应用程序中执行大量文档处理任务。
> 
> Aspose.Words for Java 支持 DOC、OOXML、RTF、HTML 和 OpenDocument 格式。使用 Aspose.Words，您可以在不使用 Microsoft Word 的情况下生成、修改和转换文档。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-02-08T01:17:51.147

它只被简单地提到过一次，所以我想提到 docx4j 库，因为我在 docx4j 上取得的成功比其他任何事情都多。Apache POI 对 Word 文档的支持不是很好。此外，与 Aspose.Words 不同的是，docx4j 是一个开源库。

唯一的缺点是使用 docx4j 您必须创建 Office Open XML (docx) 格式文档，而不是基于 OLE2 (doc) 格式的文档。这是 Word 2007 的默认格式，但 Word 2003 和更早版本的用户需要安装兼容包。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-14T23:26:46.753

我使用[Aspose.Words](http://www.aspose.com/)在 .NET 中进行邮件合并。我相信他们也有 Java 版本。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-14T23:17:21.500

您可以使用像[JACOB](http://dn.codegear.com/article/33305)这样的 Java COM 桥接器。如果它来自客户端，另一种选择是使用 Javascript。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-09T19:11:34.127

有一个名为 JODConverter 的工具，它可以连接到开放式办公室以公开其文件格式转换器，还有可以发布到的 web 应用程序（位于 tomcat 中）和命令行工具的版本。我一直在使用 html 并成功转换为 .doc 和 pdf，它在一个相当大的项目中，还没有上线，但我想我会使用它。 [http://sourceforge.net/projects/jodconverter/](http://sourceforge.net/projects/jodconverter/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-14T23:27:33.290

我过去开发过纯 XML 的 word 文件。我使用了 .NET，但语言应该无关紧要，因为它是真正的 XML。这不是最容易做的事情（几年前有一个项目需要它。）这些只适用于 Word 2007 或更高版本 - 但您所需要的只是描述每个标签功能的 Microsoft 白皮书。您可以像使用 Word 一样使用标签完成您想要的所有操作（当然一开始会更痛苦。）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-27T02:52:58.553

[docx4j](http://dev.plutext.org)或 poi，两者都是 ASL v2

@wondersofcomputing：iText 实际上是免费和开源的

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-04T16:06:20.343

**iText**真的很容易使用。

如果您需要 doc 文件，您可以从命令行调用**abiword**（免费轻量级多操作系统文本处理器），它有几个转换格式转换选项。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-05-04T16:24:20.843

> 经过一番研究，我发现了 iText，一个 PDF 和 RTF 文件创建 API。我想我可以使用 RTF 生成创建一个 Doc 可读文件，然后可以使用 Doc 进行编辑并重新保存。
> 
> 有人对以这种方式使用的 iText 有任何经验吗？

Bill，从编程的角度来看，POI 和 iText API 非常相似。我过去曾使用过这两种方法，发现它们都易于使用且有据可查。

使用 iText，您可以获得能够在格式（RTF 和 PDF）之间切换的优势，只需对代码进行少量更改。如果我没记错的话，内容是使用相同的调用布局的，然后使用几行代码设置为 PDF 或 RTF。

但是，我相信 RTF 中的格式与 DOC 相比是有限的。我不知道您是否能够毫不费力地实现您正在寻找的高级功能（表格、内联图像），如果有的话。

鉴于您所说的 HWPF 没有足够的功能来满足您的需求（我只处理了 POI 的 Excel 方面），您**最好的选择可能是说服那些认为 PDF 是这项工作的最佳技术的权力**。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-15T22:20:31.457

还有另一种可能性，因为这是一个网络应用程序。

我能够渲染一个将 MIME 类型设置为“application/msword”的 HTML 页面，这导致浏览器生成 Word，它很好地导入了 html，允许编辑和保存，就像我输出一个真正的 Word 文档一样。

表格工作正常，但我还没有开始工作的图像。它可能就像 HTML 中的一个标签一样简单，或者我可能必须流式传输包含二进制图像数据的响应的单独部分，或者我还没有想出的其他方法。:)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-05-16T03:40:21.067

尽管这比请求晚得多，但它可能会帮助其他人。 [Docmosis](http://www.docmosis.com)提供了一个 Java API，用于使用文档作为模板创建 doc、pdf、odt 格式的文档。它使用 OpenOffice 作为引擎来执行格式转换。文档操作和填充由 Docmosis 本身执行。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-10-15T01:21:08.550

经过一番研究，我发现了[iText](http://www.lowagie.com/iText/)，一个 PDF 和 RTF 文件创建 API。我想我可以使用 RTF 生成创建一个 Doc 可读文件，然后可以使用 Doc 进行编辑并重新保存。

有人对以这种方式使用的 iText 有任何经验吗？

# java - 仅用 ant 编译源代码树的一部分

> ID：203180
> 
> 赞同：10
> 
> 时间：2008-10-14T23:14:03.580
> 
> 标签：java, ant, jar, javac

假设我在我的 src/ 树中有我的资源（也可能在我的 test/ 树中）。假设我只想编译那棵树的*一部分*。我可能想要这样做的原因是多种多样的。举个例子，我可能想要创建尽可能小的 jar（不包括某些类），或者我可能想要我正在编译的最快的编译时间。不过，我绝对想编译所有依赖项！

这可以通过命令行轻松实现：

```
javac -d build/ -cp whatever -sourcepath src src/path/to/MyClass.java 
```

现在，你怎么能用蚂蚁做到这一点？javac ant[任务编译所有内容](http://ant.apache.org/manual/Tasks/javac.html)：

> 将递归扫描源目录和目标目录以查找要编译的 Java 源文件。

可以使用`excludes`and`includes`参数，但它们为此目的是有问题的。事实上，似乎必须明确设置所有`includes`（不是自动依赖查找），**甚至最坏**的[排除优先于包含](http://ant.apache.org/manual/dirtasks.html#patternset)：

> 当同时使用包含和排除时，仅使用与至少一个包含模式匹配且不匹配*任何*排除模式的文件/目录。

因此，您不能使用

```
<javac srcdir="${src.dir}" destdir="${build.dir}" classpathref="classpath"
            excludes="**/*.java" includes="src/path/to/MyClass.java" /> 
```

因为它不会编译任何东西:-(

有没有办法`javac`用 ant 实现那个简单的命令行？

* * *

编辑：谢谢你的回答，萨迪，我接受它，因为它确实以我在这个问题中想知道的方式工作。但是我有几条评论（太长了，不能在您的答案的评论字段中）：

1）我确实阅读了文档（请参阅上面的链接），但不清楚是否只有`includes`您实际上也排除了其他所有内容

2）当你只是`includes`蚂蚁记录类似

```
[javac] Compiling 1 source file to /my/path/to/build 
```

即使依赖项使其编译（远）不仅仅是一个源文件。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-15T02:39:07.927

为什么要排除和包含？如果您至少有一个包含，则仅在显式包含文件时才编译文件。所以这应该工作：

```
<javac srcdir="${src.dir}" destdir="${build.dir}" classpathref="classpath"
        includes="src/path/to/MyClass.java" /> 
```

或者更灵活：

```
<javac srcdir="${src.dir}" destdir="${build.dir}" classpathref="classpath">
    <include name="src/path/to/MyClass.java"/>
    <include name="src/path/to/AnotherClass.java"/>
</javac> 
```

要在 jar 中仅包含某些包或类，请使用文件集属性

```
<jar jarfile="${outlib}/something.jar">
    <fileset dir="${build.dir}">
        <include name='src/path/to/classes' />
    </fileset>
</jar> 
```

同样，您可以使用多个包含来组合单独的包。尝试包含并[阅读文档](http://ant.apache.org/manual/)，您一定会找到所需的答案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-07-12T12:54:56.927

老问题，但我在同一个问题上苦苦挣扎，找到了一个更优雅的解决方案。所以在这里，以供将来参考：

根据 ant 文档，该`<javac>`元素是隐式`<fileset>`的，因此可以采用[Selectors](https://ant.apache.org/manual/Types/selectors.html "选择器") like `<filename name="**/MyClass.java"/>`，所以这只会编译 MyClass.java：

```
<javac srcdir="${src.dir}" destdir="${build.dir}" classpathref="classpath">
  <filename name="**/path/to/MyClass.java"/>
</javac> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T01:51:13.013

实际上，ant 只*检查*所有内容，如果您连续运行两次编译，您会发现第二次要快得多。实际上，很容易被说服错过一些事情。

如果您甚至不希望它考虑所有内容，则必须将其分解为较小的模块/项目/源代码树，以便明确告诉 ant 编译什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-23T13:59:54.083

只需提供您要构建的文件的逗号分隔列表。举个例子

```
<property name="includeFileList" value="<name of java class>.java"/>

<javac srcdir="${src.dir}" destdir="${build.dir}"
       target="1.6" debug="true" includes="${includeFileList}"/> 
```

它会起作用的。

# javascript - 将“非常简单的历史”与 Rails 集成

> ID：203188
> 
> 赞同：0
> 
> 时间：2008-10-14T23:18:01.233
> 
> 标签：javascript, ruby-on-rails, ajax

在尝试解决“ajax 后退按钮”问题时，我发现了[真正简单的历史](http://code.google.com/p/reallysimplehistory/)库。

有没有人尝试将它与 Rails 集成？

它是普通的旧 javascript，所以它似乎应该很好地集成，但我对 JS 本身几乎一无所知，所以我不太有信心在没有教程或其他东西的情况下尝试进行集成。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T00:01:15.030

[这个博客](http://lindsaar.net/2008/2/22/history-buttons-with-ajax-and-ruby-on-rails)（当我在谷歌或雅虎搜索“Rails 非常简单的历史”时，它根本没有出现

# c# - 从 C# 访问 Win32 C/C++ 结构成员

> ID：203189
> 
> 赞同：5
> 
> 时间：2008-10-14T23:18:18.080
> 
> 标签：c#, c++, winapi, interop, struct

我正在使用某种挂钩从 C# 拦截 Win32 API 调用本机 dll 或 exe。在这种特殊情况下，我对 user32.dll 中的 DrawText() 感兴趣。在 Win32 API 中是这样声明的：

```
INT WINAPI DrawTextW(HDC hdc, LPCWSTR str, INT count, LPRECT rect, UINT flags) 
```

LPRECT 结构具有以下签名（也在 Win32 API 中）：

```
typedef struct tagRECT { 
    LONG left;
    LONG top;
    LONG right;
    LONG bottom;
} RECT LPRECT; 
```

LONG 是 32 位系统上 32 位整数的 typedef（不了解 64 位系统，此时无关紧要，因为我在 32 位 Windows 上）。为了能够访问这个结构的成员，我在我的 C# 代码中声明了它......

```
[StructLayout(LayoutKind.Sequential, Pack = 1)]
    public struct RECT
    {
        public Int32 left;
        public Int32 top;
        public Int32 right;
        public Int32 bottom;
    } 
```

...并使用此 RECT 结构编写了 P/Invoke 的签名：

```
[DllImport("user32.dll", CharSet = CharSet.Unicode, SetLastError = true, CallingConvention = CallingConvention.StdCall)]
static extern IntPtr DrawText(IntPtr HDC, String str, Int32 count, ref RECT rect, UInt32 flags, IntPtr dtp); 
```

由于结构是 C# 中的值类型，而不是 C/C++ 中的引用类型，因此此处需要 ref 修饰符。

但是，当我使用`rect.top rect.left`etc 时，它们几乎总是返回 0。我知道这是不正确的事实。但是在谷歌搜索了无数小时并尝试了很多不同的东西之后，我无法让这个简单的东西发挥作用。

我尝试过的事情：

*   对 RECT 成员使用不同的原语（int、long、short、UInt32...）。实际上很明显这不是类型问题，因为无论如何我应该看到一些乱码，而不是 0。
*   删除 ref 修饰符。这也是愚蠢的（绝望的时候，绝望的措施），因为 rect.left 正确地返回指向 rect 的指针而不是它的值。
*   尝试过`unsafe`的代码块。没用，但我可能在实现中犯了一个错误（我不记得我做了什么）。除了这种方法通常保留用于 COM 和 Win32 中棘手的指针情况，无论如何，这对我的情况来说是多余的。
*   尝试`[MarshallAs]`在 RECT 成员之前添加。没区别。
*   玩弄`Pack`价值观。没有不同。

我相当确定我错过了一些非常简单直接的东西，但我不知道它是什么......

任何帮助表示赞赏。谢谢你。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T23:40:07.087

[http://www.pinvoke.net/default.aspx/user32.DrawText](http://www.pinvoke.net/default.aspx/user32.DrawText)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T23:43:34.257

我注意到您说您尝试过`[MarshallAs]`但您尝试过`[MarshalAs(UnmanagedType.Struct)]`吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T08:16:43.533

部分问题是在应该使用 StringBuilder 的地方使用 String。

试试这个签名（使用[PInvoke Interop Assistant](http://codeplex.com/clrinterop)生成）

```
 [System.Runtime.InteropServices.StructLayoutAttribute(System.Runtime.InteropServices.LayoutKind.Sequential)]
public struct tagRECT {

    /// LONG->int
    public int left;

    /// LONG->int
    public int top;

    /// LONG->int
    public int right;

    /// LONG->int
    public int bottom;
}

public partial class NativeMethods {

    /// Return Type: int
    ///hdc: HDC->HDC__*
    ///lpchText: LPCWSTR->WCHAR*
    ///cchText: int
    ///lprc: LPRECT->tagRECT*
    ///format: UINT->unsigned int
    [System.Runtime.InteropServices.DllImportAttribute("user32.dll", EntryPoint="DrawTextW")]
public static extern  int DrawTextW([System.Runtime.InteropServices.InAttribute()] System.IntPtr hdc, [System.Runtime.InteropServices.MarshalAsAttribute(System.Runtime.InteropServices.UnmanagedType.LPWStr)] System.Text.StringBuilder lpchText, int cchText, ref tagRECT lprc, uint format) ;

} 
```

# graphics - 好的图片库引擎

> ID：203193
> 
> 赞同：3
> 
> 时间：2008-10-14T23:21:07.547
> 
> 标签：graphics, image-gallery

什么是最好的开源图片库引擎？既可以独立使用，也可以用于现有框架，例如 Wordpress 或 Drupal。

希望随着时间的推移，我们可以在这里建立一个好的列表。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T23:49:24.087

[画廊](http://gallery.menalto.com)是经典的选择。它具有皮肤、安全层、大量插件等，但如果您愿意，可以轻松地使用默认设置运行。我已经用了很多年了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-17T09:40:25.547

好问题，很多人在许多网络论坛上问这个问题，所以希望我们能得到一些好的回应，并有一个很好的解决方案列表。

就我个人而言，我总是说诸如 Gallery 或其他一些 OS 脚本之类的东西，但最近我发现自己使用越来越多的东西，比如一个简单的 php 脚本，它只是吐出我们的图像列表（可能每页 7 个）但依赖于 Javascript库，例如 mootools 或 Ext 来提供所有功能，特别是对于小型或个人画廊。我现在特别喜欢 noobslide mootools 类，它有一些可爱的画廊效果。

[Noobslide](http://www.efectorelativo.net/laboratory/noobSlide/)

我想归根结底，这一切都取决于您的需求，不会有一个适合所有人的答案，但希望这里会出现许多不同的解决方案，以满足不同人的需求。

# javascript - 使用命名函数作为 jQuery 中 $.getJSON 的回调来满足 Facebook 请求签名需求

> ID：203194
> 
> 赞同：3
> 
> 时间：2008-10-14T23:21:23.957
> 
> 标签：javascript, jquery, json, facebook, jsonp

我正在尝试通过 jQuery 访问 Facebook API Admin.getMetrics 方法。我在服务器端正确地编写了请求 url（为了让我的应用程序保密）。然后我将 url 发送到浏览器以使用`jQuery.getJSON()`.

Facebook 要求我将我的所有请求参数的副本连同我的应用程序密码一起发送，以验证我的真实性。问题是 jQuery 想要生成回调函数本身的名称，以便与它为您传入的匿名函数提供的名称相匹配，以便在数据返回时调用。因此，函数的名称在执行之前不可用，`jQuery.getJSON()`并且由于签名不匹配，Facebook 认为我的请求是不真实的（我发送的签名不包含正确的回调参数，因为直到`jQuery.getJSON()`运行才生成）。

我能想到的解决这个问题的唯一方法是以某种方式指定我的函数的名称，`jQuery.getJSON()`而不是让它保持匿名。但我在 jQuery AP 中找不到这样做的任何选项。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-05-18T12:30:13.487

唯一对我有用的是以下设置

`jQuery.ajax({ url: fbookUrl, dataType: "jsonp", type: "GET", cache: true, jsonp: false, jsonpCallback: "MyFunctionName" //insert here your function name });`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T16:12:22.370

的使用`jQuery.getScript`结果接近——但不完全——答案。使用 getScript 消除了 jQuery 将动态命名的匿名函数添加到请求参数的需要（尽管如果您继续并像上面的代码一样向它传递匿名函数，它仍然会这样做）。`jQuery.getScript`但是，与jQuery 的 Ajax 库中的所有其他调用一样， in的默认设置是附加一个额外的参数`_=12344567`（其中 1234567 实际上是一个时间戳）。jQuery 这样做是为了防止浏览器缓存响应。但是，这个附加功能会破坏我对请求的签名，就像自动命名的回调函数一样。

在 #jquery 的一些帮助下，我了解到让 jQuery 完全不弄乱你的参数的唯一方法是使用`jQuery.Ajax`带有以下参数的基本方法发出请求：

```
jQuery.ajax({
  url: fbookUrl,
  dataType: "script",
  type: "GET",
  cache: true,
  callback: null,
  data: null
}); 
```

（`fbookUrl`我尝试使用包括签名和 在内的完整参数请求的 Facebook API url在哪里`callback=myFunction`）。arg 指定生成的`dataType: "script"`JSONP 应填充到页面上的脚本标记中执行，`cache: true`告诉 jQuery 允许浏览器缓存响应，即跳过添加时间戳参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T23:47:08.087

您可以将 JSONP 选项传递给 $.ajaxSetup，这将允许您修复被调用的函数名称，文档如下：

**jsonp String**
覆盖 jsonp 请求中的回调函数名称。在“callback=?”中将使用该值代替“callback” GET 的 url 中的查询字符串的一部分或 POST 的数据。所以 {jsonp:'onJsonPLoad'} 会导致 'onJsonPLoad=?' 传递给服务器。

有关更多详细信息，请参见此处[http://docs.jquery.com/Ajax/jQuery.ajax#options](http://docs.jquery.com/Ajax/jQuery.ajax#options)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T15:26:28.440

这是具有固定回调的更好解决方案：

```
window.fixed_callback = function(data){
    alert(data.title);
};

$(function() {
    $.getScript("http://api.flickr.com/services/feeds/photos_public.gne?tags=cats&tagmode=any&format=json&jsoncallback=fixed_callback", function(data) {
    alert('done'); } );
}); 
```

此回调的问题是您一次只能处理一种请求，因为该函数是全局注册的。回调函数可能不得不变成它可以检索和调用适当函数的不同类型数据的调度程序。

# visual-c++ - 如何检测 VC++ 2008 可再发行组件？

> ID：203195
> 
> 赞同：33
> 
> 时间：2008-10-14T23:22:07.420
> 
> 标签：visual-c++, redistributable

是否有我可以查找的注册表设置来确定是否安装了 Visual C++ 可再发行组件，无论是独立安装还是作为 Visual Studio 2008 的一部分？我知道我可以启动 VC++ 2008 可再发行安装程序并让它处理检测，但如果我可以检查它并且如果可再发行已在系统上，则无需费心启动安装程序，它看起来会更干净。

如果没有要搜索的设置，这没什么大不了的，因为这仅适用于我们为新版本软件提供的初步安装程序。我们正在开发的新的基于 Windows Installer 的安装程序将不需要它，它将取代旧的技术安装程序并将使用合并模块。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-05-21T07:36:48.317

当您使用不同的操作系统时，我认为这些解决方案中的任何一个都无济于事！例如，使用 Vista VC8.0，MsiQueryProductState 将始终返回 -1

而 -1 则用于 VC8.0/8.0 SP1/9.0 与 Windows 7 ！所以微软提供的 GUID 解决方案并不适用于所有情况

所以我想我不得不坚持使用 %windir%\winsxs 方法并搜索

> *   x86_Microsoft.VC80.CRT*
> *   x86_Microsoft.VC90.CRT*

对于那些正在寻找所有 GUID 的人，这是我创建的列表：

Visual C++ 2005 运行时文件

```
* VC 8.0 (x86) - {A49F249F-0C91-497F-86DF-B2585E8E76B7}
* VC 8.0 (x64) - {6E8E85E8-CE4B-4FF5-91F7-04999C9FAE6A}
* VC 8.0 (ia64) - {03ED71EA-F531-4927-AABD-1C31BCE8E187} 
```

Visual C++ 2005 SP1 运行时文件

```
* VC 8.0 SP1 (x86) - {7299052B-02A4-4627-81F2-1818DA5D550D}
* VC 8.0 SP1 (x64) - {071C9B48-7C32-4621-A0AC-3F809523288F}
* VC 8.0 SP1 (ia64) - {0F8FB34E-675E-42ED-850B-29D98C2ECE08} 
```

Visual C++ 2005 SP1 ATL 安全更新运行时文件

```
* VC 8.0 SP1 ATL Patch (x86) - {837B34E3-7C30-493C-8F6A-2B0F04E2912C}
* VC 8.0 SP1 ATL Patch (x64) - {6CE5BAE9-D3CA-4B99-891A-1DC6C118A5FC}
* VC 8.0 SP1 ATL Patch (ia64) - {85025851-A784-46D8-950D-05CB3CA43A13} 
```

Visual C++ 2008 运行时文件

```
* VC 9.0 (x86) - {FF66E9F6-83E7-3A3E-AF14-8DE9A809A6A4}
* VC 9.0 (x64) - {350AA351-21FA-3270-8B7A-835434E766AD}
* VC 9.0 (ia64) - {2B547B43-DB50-3139-9EBE-37D419E0F5FA} 
```

Visual C++ 2008 SP1 运行时文件

```
* VC 9.0 SP1 (x86) - {9A25302D-30C0-39D9-BD6F-21E6EC160475}
* VC 9.0 SP1 (x64) - {8220EEFE-38CD-377E-8595-13398D740ACE}
* VC 9.0 SP1 (ia64) - {5827ECE1-AEB0-328E-B813-6FC68622C1F9} 
```

Visual C++ 2008 SP1 ATL 安全更新运行时文件

```
* VC 9.0 SP1 ATL (x86) - {1F1C2DFC-2D24-3E06-BCB8-725134ADF989}
* VC 9.0 SP1 ATL (x64) - {4B6C7001-C7D6-3710-913E-5BC23FCE91E6}
* VC 9.0 SP1 ATL (ia64) - {977AD349-C2A8-39DD-9273-285C08987C7B} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-18T10:24:32.293

检查注册表：

> VC++2008 (sp1): HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{3C3D696B-0DB7-3C6D-A356-3DB8CE541918}

或者

> VC++2008（原版）：HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{FF66E9F6-83E7-3A3E-AF14-8DE9A809A6A4}

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-10-01T11:11:52.750

VC2005的最新版本：

Visual C++ 2005 Service Pack 1 可再发行包 MFC 安全更新

```
* VC 8.0 SP1 MFCLOC Patch (x86) - {710F4C1C-CC18-4C49-8CBF-51240C89A1A2}
* VC 8.0 SP1 MFCLOC Patch (x64) - {AD8A2FA1-06E7-4B0D-927D-6E54B3D31028}
* VC 8.0 SP1 MFCLOC Patch (ia64) - {C2F60BDA-462A-4A72-8E4D-CA431A56E9EA} 
```

8.0.50727.6195

[http://www.microsoft.com/downloads/details.aspx?familyid=AE2E1A40-7B45-4FE9-A20F-2ED2923ACA62](http://www.microsoft.com/downloads/details.aspx?familyid=AE2E1A40-7B45-4FE9-A20F-2ED2923ACA62)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-15T00:00:52.207

又快又脏：

```
if (LoadLibrary(L"msvcrt80.dll")!=NULL)
{
  // it is installed
} 
```

Loadlibrary 将为您处理搜索路径。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-09T15:27:44.170

看起来微软开发人员提出了[另一种解决方案，使用](http://blogs.msdn.com/astebner/archive/2009/01/29/9384143.aspx)[MsiQueryProductState API](http://msdn.microsoft.com/en-gb/library/aa370363.aspx)，唉，也依赖于 GUID。

*更新*：代码昨天上线，似乎工作正常。以下是正在做的事情：检查我最新知道的 GUID 和路径² to-where-it-is-supposed-to-be-installed。如果两者都失败，则安装它。这似乎工作正常。

此外，它与命令行参数“/qb”一起安装，这意味着“无人看管但不是不可见”。请参阅有关这些参数[的其他博客文章。](http://blogs.msdn.com/astebner/archive/2009/03/26/9513328.aspx)

FWIW，用于 Microsoft Visual C++ 2008 / VC90 SP1 可再发行组件的 GUID - x86 9.0.30729

*   64 位 30729.17：8220EEFE-38CD-377E-8595-13398D740ACE
*   32 位 30729.17：9A25302D-30C0-39D9-BD6F-21E6EC160475
*   32位30729.01：6AFCA4E1-9B78-3640-8F72-A7BF33448200

² 路径： `$WINDIR\WinSxS\x86_Microsoft.VC90.CRT_1fc8b3b9a1e18e3b_9.0.30729*`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-15T05:51:01.487

`$WINDIR\WinSxS\x86_Microsoft.VC90.CRT_*`例如，检查您是否正在检查 Visual Studio 2008 可再发行组件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-11-14T05:23:31.323

我在 Github 上开源[了一个 Visual C++ 项目，该项目专门检查 VC++ 可再发行 DLL](https://github.com/markedup-mobi/crt-detector)，并使其在 Apache 2.0 许可下可用。

它具有三种不同的方法来检查 VC++9 和 VC++10 运行时的可用性：

1.  检查 MsiQueryProductState API；
2.  检查 WinSxS 文件夹的内容以查找匹配的产品目录；和
3.  检查当前工作目录是否有 VC++9 和 VC++10 运行时的任何本地版本（并检查它们的内容。）

编辑：这是使用它的实际样子的示例：

```
 wcout << _T("Checking for the availability of VC++ runtimes..") << endl;
 wcout << _T("----------- Visual C++ 2008 (VC++9) -----------") << endl;
 wcout << _T("Visual C++ 2008 (x86) ? ") << (IsVC2008Installed_x86() ? _T("true") : _T("false")) << endl;
 wcout << _T("Visual C++ 2008 (x64) ? ") << (IsVC2008Installed_x64() ? _T("true") : _T("false")) << endl;
 wcout << _T("Visual C++ 2008 SP1 (x86) ? ") << (IsVC2008SP1Installed_x86() ? _T("true") : _T("false")) << endl;
 wcout << _T("Visual C++ 2008 SP1 (x64) ? ") << (IsVC2008SP1Installed_x64() ? _T("true") : _T("false")) << endl; 
```

我在 Apache 2.0 下授权了[**crt-detector**](https://github.com/markedup-mobi/crt-detector)项目，因此请随意在您自己的应用程序中使用它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-09-11T12:55:58.900

**其他遇到此问题的人的**更新：****

 **1) 如果您安装了 Visual Studio，则将存在所需的 DLL，但“redist 包”不存在，因此缺少注册表项。（即这将给出假阴性）。但是，在这种情况下将 redist 安装在顶部是无害的。

2) redist 的每个主要版本（VS2005/VS2008、x86/x64/IA64 和服务包的任意组合：SP1、ATL 安全更新）都有不同的 GUID。如果您希望在 x86 和 x64 PC 上部署您的应用程序，请小心。

3) 如果您使用 LoadLibrary 或检查 Dll 文件，请确保您使用正确的版本。如果您查找 msvcrt80.dll （等）的“任何”副本，那么您将无法判断它是否是您的程序链接到的版本。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-10-21T13:24:40.737

“Microsoft Visual C++ 2008 Service Pack 1 Redistributable Package MFC 安全更新 (x86)”的产品代码是 {9BE518E6-ECC6-35A9-88E4-87755C07200F}

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-14T23:29:16.703

您可以检查 WINDOWS\WinSxS 目录下的文件以查看您安装了哪些版本。通常可以一次安装多个版本，因此您可能需要检查已安装的特定版本。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-29T23:41:06.547

找到 VC2008 可再发行的注册表项。这是我的解决方案：

```
BOOL IsVC2008RedistInstalled(LPCTSTR pLogFile)
{
    TCHAR szLogEntry[256];
    memset(szLogEntry, '0', sizeof(szLogEntry));
    HKEY hKey;
    LONG lErr;

    TCHAR csid[256];
    _stprintf( csid, _T("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\{9A25302D-30C0-39D9-BD6F-21E6EC160475}"));
    lErr = RegOpenKeyEx(HKEY_LOCAL_MACHINE, csid, 0, KEY_QUERY_VALUE, &hKey);
    if (lErr == ERROR_SUCCESS)
    {
    _stprintf(szLogEntry, _T("VC2008 Redistributable was installed before.\n"));
    toFile(pLogFile, szLogEntry);
    return TRUE;
    }
    else
    {
    _stprintf(szLogEntry, _T("VC2008 Redistributable was not installed before. %ld\n"), lErr);
    toFile(pLogFile, szLogEntry);
    return FALSE;
    }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-10-13T20:05:02.370

我想使用以下值扩展 GUID 列表：

32位30729.17
{9A25302D-30C0-39D9-BD6F-21E6EC160475}
32位30729.01
{6AFCA4E1-9B78-3640-8F72-A7BF33448200}的
64位30729.17
{8220EEFE-38CD-377E-8595-13398D740ACE}的
64位30729.01
{0DF3AE91-E533-3960-8516- B23737F8B7A2}
VC ++ 2008（SP 1）
{3C3D696B-0DB7-3C6D-A356-3DB8CE541918}
VC ++ 2008（原始）
{FF66E9F6-83E7-3A3E-AF14-8DE9A809A6A4}
IA64 30729.01
{22E23C71-C27A-3F30-8849-BB6129E50679 }
32 位 30729.4148
{7B33F480-496D-334A-BAC2-205DEC0CBC2D}
Visual Studio 2008 专业版 SP1
{D7DAD1E4-45F4-3B2B-899A-EA728167EC4F}
32 位 30729.01
{F333A313D-125C-142A}5CDCE-32A

所以请决定，通过 GUID 检查 VCredist 的存在是否是一个好主意。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-08-25T11:32:44.183

最可靠的方法是使用具有不同 vcredist 版本的 GUID 的**MsiQueryProductState API。**

有用！

问候。

# javascript - 动态创建元素的事件绑定？

> ID：203198
> 
> 赞同：1675
> 
> 时间：2008-10-14T23:25:19.113
> 
> 标签：javascript, jquery, events, unobtrusive-javascript

我有一些代码循环遍历页面上的所有选择框并将`.hover`事件绑定到它们以对它们的宽度进行一些调整`mouse on/off`。

这发生在页面准备就绪并且工作正常。

我遇到的问题是，我在初始循环之后通过 Ajax 或 DOM 添加的任何选择框都不会绑定事件。

我找到了这个插件（[jQuery Live Query Plugin](http://brandonaaron.net/docs/livequery/#getting-started)），但是在我使用插件向我的页面添加另一个 5k 之前，我想看看是否有人知道这样做的方法，无论是直接使用 jQuery 还是通过其他选项。

* * *

## 回答 #1

> 赞同：2473
> 
> 时间：2009-07-30T15:34:49.733

**从 jQuery 1.7 开始**，您应该使用[`jQuery.fn.on`](https://api.jquery.com/on/#on-events-selector-data-handler)已填充的选择器参数：

```
$(staticAncestors).on(eventName, dynamicChild, function() {}); 
```

*解释：*

这称为事件委托，其工作方式如下。`staticAncestors`该事件附加到应处理的元素的静态父 ( ) 上。每次在此元素或其中一个后代元素上触发事件时，都会触发此 jQuery 处理程序。然后，处理程序检查触发事件的元素是否与您的选择器 ( `dynamicChild`) 匹配。当匹配时，您的自定义处理程序函数将被执行。

* * *

**在此之前**，推荐的方法是使用[`live()`](http://api.jquery.com/live)：

```
$(selector).live( eventName, function(){} ); 
```

但是，`live()`在 1.7 中已弃用`on()`，而在 1.9 中完全删除。`live()`签名：

```
$(selector).live( eventName, function(){} ); 
```

...可以替换为以下[`on()`](http://api.jquery.com/on/)签名：

```
$(document).on( eventName, selector, function(){} ); 
```

* * *

例如，如果您的页面正在使用类名动态创建元素，`dosomething`您会将事件绑定到**已经存在的父**级（这是这里问题的关键，您需要绑定到现有的东西，不要绑定到动态内容），这可以是（也是最简单的选择）是`document`. 尽管记住[`document`可能不是最有效的选择](https://stackoverflow.com/questions/12824549/should-all-jquery-events-be-bound-to-document)。

```
$(document).on('mouseover mouseout', '.dosomething', function(){
    // what you want to happen when mouseover and mouseout 
    // occurs on elements that match '.dosomething'
}); 
```

绑定事件时存在的任何父级都可以。例如

```
$('.buttons').on('click', 'button', function(){
    // do something here
}); 
```

将适用于

```
<div class="buttons">
    <!-- <button>s that are generated dynamically and added here -->
</div> 
```

* * *

## 回答 #2

> 赞同：408
> 
> 时间：2013-08-09T09:51:28.050

的文档中有很好的解释[`jQuery.fn.on`](http://api.jquery.com/on/)。

简而言之：

> 事件处理程序仅绑定到当前选定的元素；当您的代码调用`.on()`.

因此在下面的例子中`#dataTable tbody tr`必须在代码生成之前存在。

```
$("#dataTable tbody tr").on("click", function(event){
    console.log($(this).text());
}); 
```

如果将新的 HTML 注入页面，最好使用委托事件来附加事件处理程序，如下所述。

**委托事件**的优点是它们可以处理来自以后添加到文档的后代元素的事件。例如，如果表存在，但行是使用代码动态添加的，则以下将处理它：

```
$("#dataTable tbody").on("click", "tr", function(event){
    console.log($(this).text());
}); 
```

除了能够处理尚未创建的后代元素上的事件之外，委托事件的另一个优点是当必须监视许多元素时，它们的开销可能会大大降低。在 1,000 行的数据表中`tbody`，第一个代码示例将处理程序附加到 1,000 个元素。

委托事件方法（第二个代码示例）仅将事件处理程序附加到一个元素， the `tbody`，并且事件只需要冒泡一个级别（从 clicked`tr`到`tbody`）。

**注意：**委托事件不适用于[SVG](http://en.wikipedia.org/wiki/Scalable_Vector_Graphics)。

* * *

## 回答 #3

> 赞同：261
> 
> 时间：2014-12-09T07:59:49.100

这是一个**纯 JavaScript**解决方案，没有任何库或插件：

```
document.addEventListener('click', function (e) {
    if (hasClass(e.target, 'bu')) {
        // .bu clicked
        // Do your thing
    } else if (hasClass(e.target, 'test')) {
        // .test clicked
        // Do your other thing
    }
}, false); 
```

`hasClass`在哪里

```
function hasClass(elem, className) {
    return elem.className.split(' ').indexOf(className) > -1;
} 
```

`**[Live demo](http://jsfiddle.net/ramswaroop/Nrxp5/28/)**`

*归功于 Dave 和 Sime Vidas*

使用更现代的 JS，`hasClass`可以实现为：

```
function hasClass(elem, className) {
    return elem.classList.contains(className);
} 
```

* * *

下面嵌入了相同的 jsfiddle Live 演示：

```
function hasClass(elem, className) {
  return elem.classList.contains(className);
}

document.addEventListener('click', function(e) {
  if (hasClass(e.target, 'bu')) {
    alert('bu');
    document.querySelector('.bu').innerHTML = '<div class="bu">Bu<div class="tu">Tu</div></div>';
  } else if (hasClass(e.target, 'test')) {
    alert('test');
  } else if (hasClass(e.target, 'tu')) {
    alert('tu');
  }

}, false);
```

```
.test,
.bu,
.tu {
  border: 1px solid gray;
  padding: 10px;
  margin: 10px;
}
```

```
<div class="test">Test
  <div class="bu">Bu</div>test
</div>
```

* * *

## 回答 #4

> 赞同：80
> 
> 时间：2008-10-14T23:31:40.723

您可以在创建对象时将事件添加到对象。如果您在不同时间向多个对象添加相同的事件，则创建命名函数可能是可行的方法。

```
var mouseOverHandler = function() {
    // Do stuff
};
var mouseOutHandler = function () {
    // Do stuff
};

$(function() {
    // On the document load, apply to existing elements
    $('select').hover(mouseOverHandler, mouseOutHandler);
});

// This next part would be in the callback from your Ajax call
$("<select></select>")
    .append( /* Your <option>s */ )
    .hover(mouseOverHandler, mouseOutHandler)
    .appendTo( /* Wherever you need the select box */ )
; 
```

* * *

## 回答 #5

> 赞同：52
> 
> 时间：2008-10-14T23:35:39.060

您可以简单地将事件绑定调用包装到一个函数中，然后调用它两次：一次在文档准备好时，一次在添加新 DOM 元素的事件之后。如果您这样做，您将希望避免在现有元素上绑定相同的事件两次，因此您需要取消绑定现有事件或（更好）仅绑定到新创建的 DOM 元素。代码看起来像这样：

```
function addCallbacks(eles){
    eles.hover(function(){alert("gotcha!")});
}

$(document).ready(function(){
    addCallbacks($(".myEles"))
});

// ... add elements ...
addCallbacks($(".myNewElements")) 
```

* * *

## 回答 #6

> 赞同：41
> 
> 时间：2011-03-21T22:35:24.003

尝试使用`.live()`而不是`.bind()`; 将在 Ajax 请求执行后`.live()`绑定`.hover`到您的复选框。

* * *

## 回答 #7

> 赞同：35
> 
> 时间：2016-01-22T01:06:59.497

## 动态创建元素上的事件绑定

**单元素：**

```
$(document.body).on('click','.element', function(e) {  }); 
```

**子元素：**

```
 $(document.body).on('click','.element *', function(e) {  }); 
```

注意添加的`*`. 将为该元素的所有子元素触发一个事件。

我注意到：

```
$(document.body).on('click','.#element_id > element', function(e) {  }); 
```

它不再工作了，但它以前工作过。我一直在使用来自 Google [CDN](http://en.wikipedia.org/wiki/Content_delivery_network)的 jQuery ，但我不知道他们是否更改了它。

* * *

## 回答 #8

> 赞同：32
> 
> 时间：2018-06-14T11:15:18.920

***这是由事件委托完成的***。事件将绑定到 wrapper-class 元素，但将委托给 selector-class 元素。这就是它的工作原理。

```
$('.wrapper-class').on("click", '.selector-class', function() {
    // Your code here
}); 
```

和 HTML

```
<div class="wrapper-class">
    <button class="selector-class">
      Click Me!
    </button>
</div> 
```

#注意：包装类元素可以是任何东西。文档、正文或您的包装。**Wrapper 应该已经存在**。但是，`selector`不一定需要在页面加载时呈现。它可能会稍后出现，并且该事件将继续绑定`selector` **而不会失败**。

* * *

## 回答 #9

> 赞同：31
> 
> 时间：2015-11-21T12:01:48.983

我更喜欢使用选择器并将其应用于文档。

这将自身绑定在文档上，并将适用于页面加载后将呈现的元素。

例如：

```
$(document).on("click", 'selector', function() {
    // Your code here
}); 
```

* * *

## 回答 #10

> 赞同：26
> 
> 时间：2011-12-21T07:26:56.543

您可以使用 live() 方法将元素（甚至是新创建的元素）绑定到事件和处理程序，例如 onclick 事件。

这是我编写的示例代码，您可以在其中看到 live() 方法如何将所选元素（甚至是新创建的元素）绑定到事件：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Untitled Document</title>
    </head>

    <body>
        <script src="http://code.jquery.com/jquery-latest.js"></script>
        <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.16/jquery-ui.min.js"></script>

        <input type="button" id="theButton" value="Click" />
        <script type="text/javascript">
            $(document).ready(function()
                {
                    $('.FOO').live("click", function (){alert("It Works!")});
                    var $dialog = $('<div></div>').html('<div id="container"><input type ="button" id="CUSTOM" value="click"/>This dialog will show every time!</div>').dialog({
                                                                                                         autoOpen: false,
                                                                                                         tite: 'Basic Dialog'
                                                                                                     });
                    $('#theButton').click(function()
                    {
                        $dialog.dialog('open');
                        return('false');
                    });
                    $('#CUSTOM').click(function(){
                        //$('#container').append('<input type="button" value="clickmee" class="FOO" /></br>');
                        var button = document.createElement("input");
                        button.setAttribute('class','FOO');
                        button.setAttribute('type','button');
                        button.setAttribute('value','CLICKMEE');
                        $('#container').append(button);
                    });
                    /* $('#FOO').click(function(){
                                                     alert("It Works!");
                                                 }); */
            });
        </script>
    </body>
</html> 
```

* * *

## 回答 #11

> 赞同：23
> 
> 时间：2015-10-07T17:43:38.617

另一种解决方案是在创建元素时添加监听器。与其将侦听器放在主体中，不如在创建它的那一刻将侦听器放在元素中：

```
var myElement = $('<button/>', {
    text: 'Go to Google!'
});

myElement.bind( 'click', goToGoogle);
myElement.append('body');

function goToGoogle(event){
    window.location.replace("http://www.google.com");
} 
```

* * *

## 回答 #12

> 赞同：22
> 
> 时间：2016-06-30T06:25:30.750

像这样尝试-

```
$(document).on( 'click', '.click-activity', function () { ... }); 
```

* * *

## 回答 #13

> 赞同：18
> 
> 时间：2016-03-26T02:15:42.887

注意放置元素的“MAIN”类，例如，

```
<div class="container">
     <ul class="select">
         <li> First</li>
         <li>Second</li>
    </ul>
</div> 
```

在上述场景中，jQuery 将监视的 MAIN 对象是“容器”。

然后，您将基本上在容器下拥有元素名称，例如`ul`,`li`和`select`：

```
$(document).ready(function(e) {
    $('.container').on( 'click',".select", function(e) {
        alert("CLICKED");
    });
 }); 
```

* * *

## 回答 #14

> 赞同：16
> 
> 时间：2017-04-05T07:11:21.660

您可以在使用动态创建时将事件附加到元素[`jQuery(html, attributes)`](https://api.jquery.com/jQuery/#jQuery-html-attributes)。

> **从 jQuery 1.8 开始**，任何 jQuery 实例方法（的方法`jQuery.fn`）都可以用作传递给第二个参数的对象的属性：

```
function handleDynamicElementEvent(event) {
  console.log(event.type, this.value)
}
// create and attach event to dynamic element
jQuery("<select>", {
    html: $.map(Array(3), function(_, index) {
      return new Option(index, index)
    }),
    on: {
      change: handleDynamicElementEvent
    }
  })
  .appendTo("body");
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">
</script>
```

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2016-08-11T16:16:58.270

你可以使用

```
$('.buttons').on('click', 'button', function(){
    // your magic goes here
}); 
```

或者

```
$('.buttons').delegate('button', 'click', function() {
    // your magic goes here
}); 
```

这两种方法是等价的，但参数的顺序不同。

请参阅：[jQuery 委托事件](http://api.jquery.com/delegate/)

* * *

## 回答 #16

> 赞同：13
> 
> 时间：2017-09-16T07:01:23.027

这就是为什么动态创建的元素不响应点击的原因：

```
var body = $("body");
var btns = $("button");
var btnB = $("<button>B</button>");
// `<button>B</button>` is not yet in the document.
// Thus, `$("button")` gives `[<button>A</button>]`.
// Only `<button>A</button>` gets a click listener.
btns.on("click", function () {
  console.log(this);
});
// Too late for `<button>B</button>`...
body.append(btnB);
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<button>A</button>
```

作为一种解决方法，您必须听取所有点击并检查源元素：

```
var body = $("body");
var btnB = $("<button>B</button>");
var btnC = $("<button>C</button>");
// Listen to all clicks and
// check if the source element
// is a `<button></button>`.
body.on("click", function (ev) {
  if ($(ev.target).is("button")) {
    console.log(ev.target);
  }
});
// Now you can add any number
// of `<button></button>`.
body.append(btnB);
body.append(btnC);
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<button>A</button>
```

这称为“事件委托”。好消息，它是 jQuery 的内置功能 :-)

```
var i = 11;
var body = $("body");
body.on("click", "button", function () {
  var letter = (i++).toString(36).toUpperCase();
  body.append($("<button>" + letter + "</button>"));
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<button>A</button>
```

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2015-12-18T08:48:51.010

**绑定事件时存在**的任何父对象，如果您的页面使用类名**按钮****动态创建元素**，您会将事件绑定到已经存在的父对象

 **```
$(document).ready(function(){
  //Particular Parent chield click
  $(".buttons").on("click","button",function(){
    alert("Clicked");
  });  

  //Dynamic event bind on button class  
  $(document).on("click",".button",function(){
    alert("Dymamic Clicked");
  });
  $("input").addClass("button");  
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<div class="buttons">
  <input type="button" value="1">
  <button>2</button>
  <input type="text">
  <button>3</button>  
  <input type="button" value="5">  
  </div>
<button>6</button>
```

* * *

## 回答 #18

> 赞同：11
> 
> 时间：2018-06-08T02:29:14.173

将事件绑定到已经存在的父级：

```
$(document).on("click", "selector", function() {
    // Your code here
}); 
```

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2017-04-18T19:47:07.697

另一种创建元素和绑定事件的灵活解决方案（[来源](https://stackoverflow.com/questions/10619445/the-preferred-way-of-creating-a-new-element-with-jquery)）

```
// creating a dynamic element (container div)
var $div = $("<div>", {id: 'myid1', class: 'myclass'});

//creating a dynamic button
 var $btn = $("<button>", { type: 'button', text: 'Click me', class: 'btn' });

// binding the event
 $btn.click(function () { //for mouseover--> $btn.on('mouseover', function () {
    console.log('clicked');
 });

// append dynamic button to the dynamic container
$div.append($btn);

// add the dynamically created element(s) to a static element
$("#box").append($div); 
```

注意：**这将为每个元素创建一个事件处理程序实例**（在循环中使用时可能会影响性能）

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2016-11-30T09:07:46.457

使用`.on()`jQuery [http://api.jquery.com/on/](http://api.jquery.com/on/)的方法将事件处理程序附加到活动元素。

从 1.9 版开始，`.live()`方法也被删除。

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2018-06-08T02:53:27.857

我更喜欢以模块化函数方式部署事件侦听器，而不是编写`document`关卡事件侦听器的脚本。所以，我喜欢下面。*请注意，您不能过度订阅具有相同事件侦听器的元素，因此不必担心多次附加侦听器 - 只有一个会粘住。*

```
var iterations = 4;
var button;
var body = document.querySelector("body");

for (var i = 0; i < iterations; i++) {
    button = document.createElement("button");
    button.classList.add("my-button");
    button.appendChild(document.createTextNode(i));
    button.addEventListener("click", myButtonWasClicked);
    body.appendChild(button);
}

function myButtonWasClicked(e) {
    console.log(e.target); //access to this specific button
}
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-09-27T15:42:58.670

```
<html>
    <head>
        <title>HTML Document</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    </head>

    <body>
        <div id="hover-id">
            Hello World
        </div>

        <script>
            jQuery(document).ready(function($){
                $(document).on('mouseover', '#hover-id', function(){
                    $(this).css('color','yellowgreen');
                });

                $(document).on('mouseout', '#hover-id', function(){
                    $(this).css('color','black');
                });
            });
        </script>
    </body>
</html> 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2018-05-18T00:13:34.533

我正在寻找一种解决方案，以便在动态添加的元素中 获得`$.bind`和工作而不会出现问题。`$.unbind`

由于[on()](http://api.jquery.com/on/)使得附加事件的技巧，为了对我来的那些创建一个假的解除绑定：

```
const sendAction = function(e){ ... }
// bind the click
$('body').on('click', 'button.send', sendAction );

// unbind the click
$('body').on('click', 'button.send', function(){} ); 
```

# javascript - 是否可以在 Web 表单中获取消息框？

> ID：203199
> 
> 赞同：0
> 
> 时间：2008-10-14T23:25:28.567
> 
> 标签：javascript, user-interface, dialog

我试过了，但我猜 Message Box 只适用于 win 表格。在 Web 表单中使用的最佳替代方案是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T23:29:34.347

您可以在 JavaScript 中使用`confirm`是/否问题和`alert`“OK”消息。

另一种选择是使用 JavaScript 弹出一个看起来和行为都像消息框的新窗口。这种情况下的模式因浏览器而异。在 Internet Explorer 中，该方法

```
window.showModalDialog(url,name,params) 
```

将显示一个模态对话框。Mozilla 的方法是仍然使用

```
window.open(url,name,params) 
```

但添加`modal=yes`到`params`列表中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T23:27:24.863

```
result = confirm('Yes or no question here.') 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T23:28:36.970

JavaScript：

```
alert("This box has an OK button."); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T23:30:57.090

Ajax ModalPopup 也可以很好地工作。这是一个例子：

[http://www.asp.net/ajax/ajaxcontroltoolkit/samples/modalpopup/modalpopup.aspx](http://www.asp.net/ajax/ajaxcontroltoolkit/samples/modalpopup/modalpopup.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T23:40:07.927

您有 dojo 对话框小部件： http: [//www.dojotoolkit.org/](http://www.dojotoolkit.org/)，您可以将它用作消息框。

# sql - 撤消对 SQL Server 2005 数据库的更改

> ID：203200
> 
> 赞同：2
> 
> 时间：2008-10-14T23:25:48.830
> 
> 标签：sql, sql-server, sql-server-2005, recovery

我在数据库 [SQL Server Server 2005] 上运行了一些“ALTER”脚本，并覆盖了一些存储过程。有什么方法可以撤消更改并恢复我的旧存储过程？

有没有办法从 .LDf 文件中获取执行的脚本？这样我就可以为我的存储过程重新运行我最初的“创建”脚本。

我没有旧存储过程的备份文件。

[ps 我根据@Gulzar 的](https://stackoverflow.com/users/4337/gulzar)已删除答案备份了数据库，看起来我已经“被冲洗”了。

@Pittsburgh DBA：感谢解决方案，但备份后它似乎不起作用。

**道德：在尝试建议的答案之前等待 10 分钟**

* * *

**来自 Gulzar 的更新**：我的意思是在尝试任何事情之前进行文件备份（为了安全起见）。不是 SQL Server 备份。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T23:31:35.997

第一：暂时不要进行任何备份。

市场上有几种工具可以做这种事情。

你可以试试这个：

[ApexSQL 日志](http://www.apexsql.com/sql_tools_log.asp)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-19T01:56:21.253

万一其他人有同样的问题 - 你是否每 X 分钟进行一次事务日志备份？如果是这样，您可以使用 Quest LiteSpeed 的日志阅读器或 Quest Toad for SQL Server 的日志阅读器来读取日志文件备份。它也为日志备份或 ldf 中的任何事务提供撤消/重做脚本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T23:58:39.717

之后，考虑使用 ApexSQLScript 定期编写数据库脚本（并存储在版本控制中）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-09-09T13:11:52.117

你可以！转到 sql server 管理工作室，连接到您的数据库，左键单击您的数据库并转到“任务”。选择还原-> 数据库。然后单击“时间轴”按钮并选择“特定日期”并选择错误前一天。必须关闭所有有权访问您的数据库的程序。它对我有用，我有同样的问题。

# stdin - 替换文件的标准输入

> ID：203207
> 
> 赞同：2
> 
> 时间：2008-10-14T23:27:34.413
> 
> 标签：stdin, scanf

我有一个这样的 fscanf 程序：

fscanf(stdin, "%d %d,....

我有很多 fscanf 和我想测试的文件，文件是这样的

10485770 15 51200000 -2 10 10 10485760 10485760 10 10485760 10485760 10 10485760 10485760

好吧，我的问题是如何告诉程序或编译器不要从键盘而是从那些文件中获取输入。这些程序是基准，在我得到输入的文件中，我确信有一种方法可以自动执行此操作，因为在某些情况下有很多输入。先感谢您。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T23:30:19.133

尝试自由打开。例如。

```
freopen( "somefile.txt", "r", stdin ); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T23:31:16.353

从命令行运行时，您可以使用“<”运算符将文件重定向到标准输入。

例如，在 Windows 上：

```
$ type input_file
10485770 15 51200000 -2 10 10 10485760 10485760 10 10485760 10485760 10 10485760
10485760
$ my_program.exe < input_file 
```

或在 *nix 上：

```
$ cat input_file
10485770 15 51200000 -2 10 10 10485760 10485760 10 10485760 10485760 10 10485760
10485760
$ ./my_program < input_file 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-14T23:37:36.297

查找文件结构。您将希望在此解决方案中使用 FILE 指针。

# css - CSS 浏览器支持图表

> ID：203208
> 
> 赞同：7
> 
> 时间：2008-10-14T23:27:47.330
> 
> 标签：css, browser, cross-browser

是否有任何资源可以通过大多数浏览器/操作系统组合提供 CSS 属性及其支持图表？例如，如果我想知道浏览器支持什么`overflow`或`min-height`在实现这些属性及其值时需要注意的任何怪癖，那么获得所有这些的最佳位置是什么？

我找到了几个地方，但我没有留下深刻的印象。

有什么建议么？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-14T23:46:50.800

[http://www.quirksmode.org/css/contents.html](http://www.quirksmode.org/css/contents.html)

Quriks 模式也是此类信息的一个非常好的资源。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-04-18T01:34:18.723

caniuse.com 在这种方式上也很有帮助。您还可以在那里查看其他实现，例如 HTML5 或 SVG 支持。 [http://caniuse.com/](http://caniuse.com/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-14T23:30:04.220

维基百科的文章相当令人印象深刻，是一个很好的起点：

[http://en.wikipedia.org/wiki/CSS_support](http://en.wikipedia.org/wiki/CSS_support)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-14T23:50:32.557

我过去使用的大多数 CSS 参考网站都已过时，但 SitePoint 最近（我想说过去一年）发布了一个保持最新且易于浏览的[CSS 参考。](http://reference.sitepoint.com/css "CSS 参考")

# drm - 防止复制保护规避

> ID：203229
> 
> 赞同：16
> 
> 时间：2008-10-14T23:37:33.533
> 
> 标签：drm, copy-protection

任何访问洪流跟踪器的人肯定会发现成群结队的“破解”程序，从简单的共享软件到价值数千美元的软件套件，应有尽有。似乎只要程序不依赖远程服务（例如 MMORPG），任何内置的复制保护或用户身份验证都是无用的。

有效地防止破解者绕过复制保护是不可能的吗？为什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-14T23:52:19.870

不，实际上不可能阻止它。你可以让它变得极其困难——一些 Starforce 版本显然做到了这一点，但代价是严重激怒了一些“用户”（受害者可能更准确）。

你的代码在他们的系统上运行，他们可以用它做任何他们想做的事情。附加调试器，修改内存，等等。就是这样。

孢子似乎是一个很好的例子，在这个方向上的严厉努力不仅完全未能阻止它在 P2P 网络等周围共享，而且严重[损害了产品的形象，](http://www.amazon.com/review/product/B000FKBCX4)几乎可以肯定是销售。

另外值得注意的是，用户可能需要破解复制保护以供自己使用；我记得几年前在我的笔记本电脑上玩暗黑破坏神，它没有内置光驱。所以我掉进了一个没有CD的裂缝，然后在长途飞机上玩了几个小时。强迫这种检查，因此用户要解决它是最愚蠢的错误特征。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-17T04:59:10.700

如果不破坏您的产品，就不可能阻止它。证据：

鉴于：您试图阻止黑客/窃取的人将不可避免地在技术上比您的大部分市场复杂得多。
鉴于：您的产品将被一些公众使用。
给定：使用您的产品需要在某种程度上访问它的数据。

因此，您必须以足够的方式向公众发布您的加密密钥/复制保护方法/程序数据，以使数据以可用/未加密的形式出现。
因此，您以*某种*方式让盗版者可以访问您的数据。
因此，与您的合法受众相比，黑客更容易访问您的数据。
因此，任何通过最简单的保护方法的事情最终都会像海盗一样对待您的合法受众并疏远他们

或者简而言之，最终用户看到它的方式：
[![偷这个漫画](https://imgs.xkcd.com/comics/steal_this_comic.png "我花了更多时间尝试播放 audible.com 的有声读物，而不是听这本书。 我已经失去了所有其他我支付的 DRM 锁定音乐。")](http://xkcd.com/488/)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-14T23:47:10.347

因为这是针对有思想的对手的固定防御。

几千年前的军事理论家把这个打死了？

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-14T23:45:28.400

复制保护就像安全——不可能达到 100% 完美，但你可以添加层，使其更难破解。

大多数应用程序都会问（自己）“许可证有效吗？” 黑客只需要找到那个点并修改编译后的代码以返回“是”。或者，破解者可以使用蛮力尝试不同的许可证密钥，直到其中一个成功。还有社会因素——一旦一个人购买了这个工具，他们可能会在互联网上发布一个有效的许可证代码。

因此，代码混淆使找到要更改的代码变得更加困难（但并非不可能）。二进制文件的数字签名使更改代码变得更加困难，但并非不可能。蛮力方法可以用带有大量纠错位的长许可证代码来对抗。社交攻击可以通过要求作为*许可证代码本身一部分的*姓名、电子邮件和电话号码来缓解。我用这种方法效果很好。

祝你好运！

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-03-22T21:35:21.720

很抱歉打断了一个古老的话题，但这是我们的谋生之道，我们真的很擅长。这就是我们所做的一切。所以这里的一些信息是错误的，我想澄清一下。

理论上无法破解的保护不仅是可能的，我们销售的也是如此。主要的复制保护供应商（包括我们）遵循的基本模型是使用 exe 和 dll 的加密以及在运行时解密的密钥。

有三个组件：

1.  非常强大的加密：我们使用 AES 128 位加密，有效地免疫暴力攻击。有一天，当量子计算机很普遍时，它可能会被破解，但假设你会破解这种强度加密来复制软件而不是国家机密是不合理的。

2.  安全密钥存储：如果破解者能够获得加密密钥，那么你就完蛋了。保证密钥不会被盗的唯一方法是将其存储在安全设备上。我们使用加密狗（它有多种形式，但操作系统总是将其视为可移动闪存驱动器）。加密狗将密钥存储在智能卡芯片上，该芯片针对 DPA 等侧信道攻击进行了加固。密钥生成与非确定性和动态的多个因素相关联，因此不可能有单个密钥/主破解。密钥存储和计算机上的运行时之间的通信也被加密，因此可以阻止中间人攻击。

3.  调试器检测：基本上你想阻止破解者拍摄内存快照（解密后）并从中制作可执行文件。我们为防止这种情况所做的一些事情是保密的，但通常我们允许调试器检测并在存在调试器时锁定许可证（这是一个可选设置）。我们也从未完全解密内存中的整个程序，因此您永远无法通过“窃取”内存来获取所有代码。

我们有一个全职的密码学家，他几乎可以破解任何人的保护系统。他把所有的时间都花在研究如何破解软件上，这样我们就可以阻止它。因此，您不会认为这只是我们所做工作的廉价骗局，我们并不是独一无二的：SafeNet 和 Arxan Technologies 等其他公司也可以提供一些非常强大的保护。

许多纯软件或混淆方案很容易破解，因为破解者可以识别程序入口点并绕过任何许可证检查或 ISV 为防止盗版而投入的其他内容。当没有找到许可证时，即使有加密狗的人也会抛出一个对话框——在该错误上设置断点将使破解者在汇编代码中有一个很好的位置来做补丁。同样，这需要未加密的机器代码可用——如果您对 .exe 进行强加密，您将无法获得这些代码。

最后一件事：我认为我们的独特之处在于我们举办了几次公开比赛，我们向人们提供了一个系统并邀请他们破解它。我们已经获得了一些相当丰厚的现金奖励，但还没有人破解我们的系统。如果 ISV 采用我们的系统并错误地实施它，这与在您的前门上放一把大挂锁并用木螺钉连接到便宜的搭扣上没有什么不同——很容易绕过。但是，如果您按照我们的建议使用我们的工具，我们相信您的软件不会被破解。

HTH。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-16T21:59:23.763

安全性和复制保护之间的区别在于，通过安全性，您可以保护资产免受攻击者的侵害，同时允许授权用户访问。使用复制保护，攻击者和授权用户是同一个人。这使得完美的复制保护变得不可能。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-14T23:46:20.553

我认为如果有足够的时间，一个潜在的破解者可以绕过任何复制保护，即使是那些使用远程服务器回调的人。它所要做的就是通过一个盒子重定向所有传出流量，该盒子将过滤这些请求，并以适当的消息进行响应。

在足够长的时间线上，复制保护系统的存活率为 0。只要有足够的时间和知识，一切都可以逆向工程。

也许您应该专注于使用真实的、已注册的、未破解的版本使您的软件更具吸引力的方法。优质的客户服务、注册优惠等奖励合法用户。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-14T23:49:33.633

基本上历史已经告诉我们，您可以通过复制保护购买最多的是一点时间。从根本上说，由于您希望某人以一种方式查看数据，因此有一种方法可以获取该数据。因为有一种方法可以利用这种方法来获取数据。

对此，任何复制保护或加密所能做的唯一事情就是让事情变得非常困难。如果某人有足够的动力，总会有解决问题的蛮力方式。

但更重要的是，在计算机软件领域，我们有大量的工具可以让我们看到事情是如何工作的，一旦你掌握了复制保护如何工作的方法，那么得到你想要的就很简单了。

另一个问题是，复制保护在很大程度上只会让为您的软件付费的用户感到沮丧。看看他们不关心的开源模型，有些人正在赚大钱，鼓励人们复制他们的软件。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-16T22:42:36.890

*“试图让比特不可复制就像试图让水不湿一样。”* ——布鲁斯·施奈尔

复制保护和其他形式的数字限制管理本质上是可破坏的，因为不可能使计算机可以看到比特流，同时防止计算机复制它们。就是做不到。

正如其他人所指出的，复制保护只会惩罚合法客户。我不想玩 Spore，但如果我愿意，我可能会购买它，然后安装破解版，因为它实际上是一个更好的产品，因为它没有破坏系统的 SecuROM 或剥夺财产的激活方案。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-14T23:54:22.487

}} 为什么？

您可以购买世界上最昂贵的保险箱，并用它来保护某些东西。一旦你放弃了打开保险箱的密码，你就失去了安全感。

软件也是如此，如果您希望人们使用您的产品，您必须让他们能够打开众所周知的保险箱并访问内容，混淆打开锁的方法无济于事。您已授予他们打开它的能力。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-14T23:55:16.820

您可以信任您的客户/用户，或者您可以浪费过多的时间和资源试图打败他们，而不是提供他们想要支付的功能。

只是不值得打扰。真的。如果你不保护你的软件，而且它很好，那么毫无疑问会有人盗版它。当然，障碍会很低。但是，您从不打扰中节省的时间将是您可以投资于您的产品、营销、客户关系等方面的时间，从而长期建立您的客户群。

如果你确实花时间保护你的产品而不是开发它，你肯定会减少盗版。但是现在您的竞争对手可能能够开发您没有时间开发的功能，并且您很可能最终销售量减少，即使在短期内也是如此。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-10-15T20:38:17.997

正如其他人所指出的那样，您最终会让真实和合法的用户感到沮丧，而不是让骗子感到沮丧。当您开发规避技术时，请始终牢记您的付费用户。

如果你的软件是想要的，你就没有希望对抗无聊的 17 岁大军。:)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-16T22:34:56.403

在个人复制/非商业版权侵权的情况下，关键因素似乎是项目价格与复制难易程度之间的关系。您可以增加复制它的难度，但正如前面的一些答案所强调的那样，收益会递减。另一种策略是降低价格，直到通过 bittorrent 下载它比简单地购买它更麻烦。

实际上有许多成功的例子，作者找到了一个定价的最佳点，这无疑为自己带来了巨大的利润。试图 100% 防止未经授权的复制是一个失败的原因，您只需要获得一大群愿意付费而不是非法下载的客户。使盗版软件变得便宜的原因也是使发布软件变得便宜的原因。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-05-26T15:10:41.907

有一个简单的方法，我很惊讶你在上面的答案中没有这么说。将复制保护移至安全区域（了解安全实验室中的服务器）。您的服务器将从客户端接收随机数（检查该数字是否以前未使用过），使用客户端的编号和您的私钥加密一些不断发展的二进制代码/计算结果并将其发送回。没有黑客可以规避这一点，因为他们无权访问您的服务器代码。

我所描述的基本上是其他 SSL 的 web 服务，这就是当今大多数公司的发展方向。

缺点：竞争对手将在您完成加密代码期间开发相同特色产品的离线版本。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-02-22T11:00:21.240

关于不需要网络的保护：

根据浮动的笔记，花了两年时间破解一个流行的应用程序，该应用程序使用了与约翰回答中描述的类似方案。（自定义硬件加密狗保护）

另一个不涉及加密狗的方案是“扩展保护”。我刚刚创造了这个，但它的工作原理是这样的：有一个应用程序可以保存用户数据，用户可以从第三方购买扩展等。当用户加载数据或使用新的扩展时，扩展和保存的数据还包含执行检查的代码。当然，这些检查也受到校验和检查的保护。它在纸面上并不像其他方案那样安全，但实际上这个应用程序一直都是半破解的，因此尽管被破解，但它主要用作试验，因为破解总是会错过一些检查并且必须修补这些扩展作为好。

关键是，虽然这些是可以破解的，但如果有足够多的软件供应商使用这样的方案，这会使 warescene 中愿意为这些方案献身的少数人过度劳累。如果您进行数学计算，则保护不必那么好，只要有足够多的供应商使用这些不断变化的自定义保护，它就会压倒饼干，而warez场景将在那里结束。***

没有发生这种情况的唯一原因是因为发布者购买了他们在所有地方使用的单一保护，使其成为一个巨大的目标，就像 Windows 是恶意软件的目标一样，在多个应用程序中使用的任何保护都是一个更大的目标。所以每个人都需要做自己的定制、独特的多层扩展保护。如果最好的破解者需要几个月的时间来破解一个版本，那么每年的warez 版本数量将下降到大约十几个版本。

现在对于营销软件中的一些理论：

如果您认为warez 提供了有价值的营销价值，那么这应该被纳入商业计划。这可能需要一个非常非常（太）基本的 lite 版本，但仍然需要花费几美元来确保它被破解。然后，您会通过定期提供的“从精简版廉价升级的有限时间”和其他追加销售策略来吸引用户。精简版应该最多有一个值得购买的功能，否则会非常残废。价格应该<10 $。完整版的价格应该是 10 美元精简版付费演示版升级价格的两倍。例如。如果完整版是 80 美元，您会以 40 美元的价格提供从精简版升级到完整版的价格，或者看起来真的很讨价还价的东西。当然你'

完整版的代码与精简版没有相似之处，这一点至关重要。您希望精简版被软件化，而完整版要么需要耗费大量时间来破解，要么在功能上具有网络依赖性，难以在本地模仿。破解者可能更擅长破解，而不是尝试编写/复制应用程序在 Web 服务器上的部分功能。

***附录：对于应用程序/游戏，场景可能会在这种不太可能和理论上的情况下结束，对于音乐/电影和实践等其他事物，我会考虑让数字 dl 购买者更便宜地获得额外的可收藏实物或在线 -唯一的价值 - 许多人是东西的收藏家（尤其是海盗），如果它比数字副本获得了足够令人满意的东西，他们可能会被诱惑购买。

不过要当心——有一种叫做“期望上升定律”的东西。游戏示例：Ultima 4-6 标准盒子包含一张由布制成的地图，而天际收藏版则包含一张纸制成的地图。期望值提高了，有些人不会对纸质地图感到满意。您想要保持产品或服务质量不变，或者提前管理预期。我认为，在考虑这些增值产品时，这一点至关重要，因为您希望它们制造得合乎需要但不会越来越昂贵，并且不会变成看起来如此毫无价值以至于违背目的的东西。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-15T00:00:42.910

在这种情况下，高质量的软件是一件坏事，因为如果没有人是你的软件，那么他们就不会花时间尝试破解它，另一方面，像 Adob​​e 的 Master Collection CS3 这样的东西在发布后几天就可以使用。

所以这个故事的寓意是，如果你不希望有人窃取你的软件，那么有一个选择：不要写任何值得窃取的东西。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-15T00:08:57.107

我认为有人会想出一种动态的 AI 方法来击败所有当前标准的复制保护方法；哎呀，我肯定很想得到报酬来解决这个问题。一旦他们到达那里，就会开发出新的方法，但这会减慢速度。

社会阻止软件盗窃的第二个最佳方法是重罚并执行处罚。

最好的办法是扭转道德沦丧，从而提高社会诚信水平。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-03-24T19:46:32.040

如果我听说过一个失败的原因......当然这并不意味着你不应该尝试。

就个人而言，我喜欢 Penny Arcade 对此的看法：[“A Cyclical Argument With A Literal Strawman”](http://www.penny-arcade.com/comic/2010/2/19/) [alt text http://sonicloft.net/im/52](http://sonicloft.net/im/52)

# c# - How can I keep a console open until CancelKeyPress event is fired?

> ID：203246
> 
> 赞同：9
> 
> 时间：2008-10-14T23:47:05.700
> 
> 标签：c#, .net, console

What is the best way to keep a console application open as long as the CancelKeyPress event has not been fired?

I would prefer to not use Console.Read or Console.ReadLine as I do not want to accept input. I just want to enable the underlying application to print to the console event details as they are fired. Then once the CancelKeyPress event is fired I want to gracefully shut down the application.

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-15T00:08:11.617

I'm assuming that "gracefully shut down the application" is the part you are struggling with here. Otherwise your application will automatically exit on ctrl-c. You should change the title.

Here's a quick demo of what I think you need. It could be refined a bit more with use of locking and Monitors for notification. I'm not sure exactly what you need though, so I'll just pose this...

```
class Program
{

    private static volatile bool _s_stop = false;

    public static void Main(string[] args)
    {
        Console.CancelKeyPress += new ConsoleCancelEventHandler(Console_CancelKeyPress);
        while (!_s_stop)
        {
            /* put real logic here */
            Console.WriteLine("still running at {0}", DateTime.Now);
            Thread.Sleep(3000);
        }
        Console.WriteLine("Graceful shut down code here...");

        //don't leave this...  demonstration purposes only...
        Console.ReadLine();
    }

    static void Console_CancelKeyPress(object sender, ConsoleCancelEventArgs e)
    {
        //you have 2 options here, leave e.Cancel set to false and just handle any
        //graceful shutdown that you can while in here, or set a flag to notify the other
        //thread at the next check that it's to shut down.  I'll do the 2nd option
        e.Cancel = true;
        _s_stop = true;
        Console.WriteLine("CancelKeyPress fired...");
    }

} 
```

The _s_stop boolean should be declared volatile or an overly-ambitious optimizer might cause the program to loop infinitely.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-07-05T02:28:52.677

The `_s_stop` boolean should be declared volatile in the example code, or an overly-ambitious optimizer might cause the program to loop infinitely.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T23:53:54.907

There is already a handler bound to CancelKeyPress that terminates your application, the only reason to hook to it is if you want to intercept the event and prevent the app from closing.

In your situation, just put your app into an infinite loop, and let the built in event handler kill it. You may want to look into using something like Wait(1) or a background process to prevent it from using tons of CPU while doing nothing.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T23:58:18.343

This may be what you're looking for:

[http://msdn.microsoft.com/en-us/library/system.console.cancelkeypress.aspx](http://msdn.microsoft.com/en-us/library/system.console.cancelkeypress.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-04-25T06:35:09.000

Simply run your program or codes without debugging, on your keyboard key in `CTRL + f5` instead of F5(debugging).

# c# - .NET 的最佳音频压缩库是什么？

> ID：203254
> 
> 赞同：4
> 
> 时间：2008-10-14T23:50:56.160
> 
> 标签：c#, .net, vb.net, audio, compression

我正在为.NET 寻找一个好的音频压缩库。任何使用 MP3 的东西都已经过时了（因为许可问题）。基本上我只需要能够将常规 WAV 音频数据压缩成某种格式，然后解压缩回 WAV。最好是代码都是 .NET（C# 或 VB.NET），但我认为这不太可能。它应该是无损的或相对无损的（最好是 192 MP3），压缩比至少为 4:1。我更喜欢基于缓冲区的 API，但基于文件的 API 也可以。

有谁知道这样的事情？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-17T14:34:05.097

您是否考虑过使用 WMA？如果您使用托管 C++ 或 C++/CLI，那么围绕 Windows Media Format SDK 编写托管包装器非常容易。然后，更高级别的 VB.Net 或 C# 程序集可以轻松使用此程序集。只要您安装了 WMP，它甚至具有不需要任何额外依赖项的优势。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T00:05:46.380

您是否考虑过**.OGG**格式？我不知道 .net 库是否可用，但 libogg 和 libvorbis C 库不是火箭科学且经过良好测试。对于一个简单的压缩/解压缩作业，您可能会使用一个处理所有细节的两个函数包装器。

围绕它们编写一个 .net 包装器应该很容易。

好处：

*   无专利
*   即使对于闭源项目也可用的许可证
*   *非常*好的压缩比
*   跨平台（可能不是那么重要，因为您的目标是 .net，但仍然很高兴拥有）。
*   最后但同样重要的是：一个非常成熟的库，没有已知的错误和良好的支持。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T01:10:29.557

[FLAC](http://flac.sourceforge.net/)看起来很有趣。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T01:28:48.410

[Monkey's Audio](http://www.monkeysaudio.com)是另一种（它甚至可以在.NET 中工作）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-15T00:01:48.197

您可能会查看 OGG 编解码器。我不确定是否有任何用 .NET 编写的，但它是开源的，所以如果这对您很重要，您应该能够轻松地移植一个。

[OGG Vorbis 编解码器](http://xiph.org/downloads/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-04T15:18:59.137

看看FMod。具有良好的音频压缩、播放以及 3d 效果功能。它支持许多音频格式。它是用 C 编写的，但有一个很好的 C# 包装器。

[[ [http://www.fmod.org/]]](http://www.fmod.org/]])

# c++ - 如何使用 C 或 C++ 在 Linux 上获取已安装的 True Type 字体列表？

> ID：203257
> 
> 赞同：6
> 
> 时间：2008-10-14T23:53:38.277
> 
> 标签：c++, c, linux, fonts, truetype

我的应用程序如何获取 Linux 上可用的 True Type 字体列表。

是否有一个标准目录，它们存储在不同的发行版中？或者其他一些标准的方法来定位它们？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-15T07:23:27.713

我认为 fontconfig 是正确的方法。查看[wikipedia 文章](http://en.wikipedia.org/wiki/Fontconfig)或[fontconfig 主页](http://fontconfig.org)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-16T21:16:07.443

尝试一个名为“XListFonts”的函数

[http://tronche.com/gui/x/xlib/graphics/font-metrics/XListFonts.html](http://tronche.com/gui/x/xlib/graphics/font-metrics/XListFonts.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-16T23:36:13.007

我只是使用 GTK+ 使用的 Pango 来完成它。我通过查看 linux 'Character Map' 程序 (gucharmap) 的代码找到了它。这是基本思想：

```
 PangoFontFamily **families;

  ...

  pango_context_list_families (
          gtk_widget_get_pango_context (GTK_WIDGET (notebook)),
          &families, &fontCount);

  printf("%d fonts found\n", fontCount);
  for(i=0; i<fontCount; i++)
  {
    printf("[%s]\n", pango_font_family_get_name (families[i]));
  } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-19T12:55:18.323

不相关，但您可以使用`fontmatrix`显示全部和预览（yum -y install fontmatrix）

![在此处输入图像描述](https://i.stack.imgur.com/o7waF.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T23:57:03.790

如果您没有编写专有软件或任何其他与 GPL 不兼容的许可软件，您可以尝试查看 xlsfonts 的代码以了解如何查询字体服务器。（字体服务器可以是 X 本身，但没关系。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-16T21:17:47.863

如果您使用的是 GTK+ 或 Qt 之类的高级工具包，那么可能有更好的功能可以为您做这件事；如果没有，fontconfig 是事实上的方法。

# css - CSS 性能

> ID：203274
> 
> 赞同：4
> 
> 时间：2008-10-15T00:02:04.577
> 
> 标签：css, performance, optimization

通常当我建立一个站点时，我将所有的 CSS 放在一个文件中，并且与一组元素相关的所有属性都被一次性定义。像这样：

```
#myElement {
    color: #fff;
    background-color: #000;
    padding: 10px;
    border: 1px solid #ccc;
    font-size: 14pt;
}

.myClass {
    font-size: 12pt;
    padding: 5px;
    color: #ee3;
} 
```

正如我所看到的那样，我一直在考虑将我的定义拆分为许多不同的文件（colors.css、layout.css、fonts.css ...）。像这样的东西：

```
/* colours.css */
#myElement {
    color: #fff;
    background-color: #000;
    border-color: #ccc;
}
.myClass {
    color: #ee3;
}

/* layout.css */
#myElement {
    padding: 10px;
    border: 1px solid;
}
.myClass {
    padding: 5px;
}

/* fonts.css */
#myElement {
    font-size: 14pt;
}
.myClass {
    font-size: 12pt;
} 
```

为了减少 HTTP 请求，我会在推出之前合并文件并去除空格，所以这不是问题，但我的问题是：一遍又一遍地重复所有这些选择器会导致浏览器出现任何性能问题吗？

或者，是否有任何工具可以通过合并来自不同文件的定义来避免这个（潜在的）问题？即：获取我在第二个示例中给出的输入（3 个不同的文件），并将它们组合到一个文件中，就像第一个示例一样。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T00:09:59.427

浏览器必须找到所有定义，然后将它们添加并根据最新定义覆盖不同的属性。所以会有一点开销。

话虽这么说，即使在 5 年前的硬件上，它也会相当小，也不会很明显。这些天浏览器在这方面非常有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T21:55:46.313

我无法评论性能，但我在我的网站上尝试了这种方法并最终恢复为一个大文件。

我的理由：

*   我厌倦了在三个或四个不同的文件中为 div.foo 创建规则，并且如果我想更改该 div 则打开三个或四个文件。
*   有时，分离功能并不像应有的那么容易。要在 IE 中居中 div，您可能必须将父元素的文本居中，即使这不是标准方式。现在我的布局与我的字体混合在一起。
*   随着代码的增长，对我来说查找内容的最简单方法是对我想要的元素进行文本搜索。但是我必须打开几个文件才能查看所有规则，也许该元素在此文件中没有规则，所以我没有匹配项。

所以我又回到了 main.css 和 iehacks.css。并松了一口气。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T00:21:41.837

正如威廉所说，您不会从浏览器解析 CSS 中看到任何问题。但是，您可能会看到客户端可以向单个主机打开的 HTTP 请求数量的问题。通常，这默认为两个。因此，如果您确实将 CSS 放在多个文件中，您可能希望将它们放在单独的子域中，它们将被视为不同的主机，这将允许 HTML 页面与您的 CSS 文件同时加载.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T00:28:43.227

渲染/解析速度不应该有任何明显的差异。正如其他人所说，计算机速度足够快，可以非常快地渲染 CSS。

您的问题实际上与加载页面所需的请求数有关。加载页面时，额外的 Web 请求会增加开销。加载一个大文件比加载几个小文件要快得多。它对客户端（浏览器）和提供所有这些 CSS 文件的服务器都有影响。

只要您在生产中合并文件，就可以了。

[Yahoo 的 YUI Compressor](http://developer.yahoo.com/yui/compressor/)是一个很好的工具，可以将你的 CSS 文件压缩成更小的文件。我上次检查时，它无法定义（至少我上次查看它时），但性能影响应该不足以真正需要。

# mod-rewrite - 干净的 URL 是后端还是前端

> ID：203278
> 
> 赞同：6
> 
> 时间：2008-10-15T00:02:49.363
> 
> 标签：mod-rewrite, frontend, backend, clean-url

你怎么看.. 干净的 URL 是后端还是前端的“纪律”

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-15T00:48:38.493

如果我们从最终用户体验中谈论 url 是“干净的”，那么我将打破常规并说 url 通常不直观，它们永远不会，它们旨在是机器可读的。

url 的格式没有标准，因此当从一个站点导航到另一个站点时，人类永远不会记得如何仅通过记住 url 及其“友好语法”来访问资源。我们可以争论是否使用“？” 和 '&' 或 '/' 表示如何通过 url 识别资源；一种方法比另一种更好吗？没关系。在一天结束时，机器会解析它并发回结果。

我们应该停止自欺欺人，认为人们实际上是在输入这些东西，并意识到 uri 是针对机器的，而不是针对人的。

我还没有使用/记住超出地址的[http://domain.com/](http://domain.com/)部分的前几个字符的 uri，而且我已经使用网络很长时间了。这就是书签的用途。网站上的任何地方都没有说“在我们的 url 中更改此部分以查看'其他'资源”，因为 url 通常是无证和不透明的。

是的，让您的 uri 的 SEO 友好（即使它们会定期更改）但忘记整个“人类/清洁”资源标识符的事情，这是一个神秘的白日梦。

我同意 Vlion 的观点，即 url 应该提供一种独特的机制来为资源添加书签并返回它（与这些可恶的 web 2.0 ajax/silverlight/flash 创作中的一些不同），但书签永远不会让人类理解和理解。似乎有相当多的注意力和精力花在构思人类可以记住和输入的 url 策略上，这是浪费精力。让我们继续解决实际问题。

对不起，咆哮，但是在某些圈子里有很多与 url 相关的 web 2.0 废话，这完全是浪费时间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-15T00:55:31.037

**答案是两者。**

例如：

[https://stackoverflow.com/questions/ **203278** /are-clean-urls-a-backend-or-a-frontend-thing](https://stackoverflow.com/questions/**203278**/are-clean-urls-a-backend-or-a-frontend-thing)

上面的数字是一个数据库id，一个后端的东西。砍掉漂亮的部分，它会进入同一页面。因此，*“are-clean-urls-a-backend-or-a-frontend-thing”*是前端事物的一部分。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-15T23:54:39.350

现在 Firefox 的[Awesome bar](http://www.mozilla-europe.org/en/firefox/features/#location-bar)和 Google Chrome 的[Omnibox](http://www.youtube.com/watch?v=zdHNhF46Z3g)地址栏可用于搜索浏览历史记录，这使得用户可以更轻松地搜索他们的历史记录以查找以前访问过的网站，因此拥有干净的 url 可以帮助用户更轻松地在他们的历史记录中找到网站.

确保页面有适当的标题很重要（因为两个浏览器都会搜索标题和 url），但是通过确保 url 中也有相关的关键字，当在地址栏中输入这些关键字时，url 将是更有可能在建议中显示得更高，因为关键字将在 url 和标题中匹配两次。

此外，一旦用户输入了网站的名称，他们将看到来自该网站的示例 url，然后他们可以将其用作缩小搜索范围的模板。因此，在 url 中为网站的不同部分或操作使用动词和名词将有助于用户将搜索范围缩小到他们感兴趣的网站部分，例如 stackoverflow 的*/questions/*或*/tag/*部分，或者docs.google.com/doc 末尾的“/doc”可用于*仅*查看Google docs* 上的文档页面。

由于 Firefox 和 Chrome 都会搜索输入到地址栏中的每个空格分隔的单词，因此可以认为搜索 url 不是完全人类可读的，而是允许用户实际阅读他们感兴趣的关键字从网址中，“噪音”的数量应保持在最低限度。

* * *

** 格式为 http*://docs.google.com/Doc?id=gibberish**

 *** * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-15T00:36:26.817

我的观点很简单：

*   我用浏览器访问的每个地方（有各种边缘情况例外）都应该是可**收藏**的，**前进/后退**应该是可用的，并且不会破坏任何数据输入。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-15T00:04:09.080

后端肯定。您的服务器必须负责路由到 URL 请求的资源。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-15T00:07:34.597

我认为使用友好 URL 的主要原因是：

*   易于链接/共享
*   介绍
*   搜索引擎优化

所以我认为这纯粹是客户端的乐趣。虽然它们在服务器上也很好，但它们并不是关键任务。

# ruby-on-rails - Ruby on Rails 是如何工作的？

> ID：203288
> 
> 赞同：33
> 
> 时间：2008-10-15T00:07:42.553
> 
> 标签：ruby-on-rails, ruby

我是一名 PHP 开发人员，对 Ruby 有一点了解。我想学习 Ruby on Rails，但我遇到的大多数资源都将 RoR 功能视为“魔法”——即，它具有一定的内部一致性，但不要问它在 Ruby 方面是如何工作的， MySQL 等

无论如何，我想深入了解 RoR 的工作原理、构建它的设计决策等。我特别对 ActiveRecord 感兴趣，但实际上我正在寻找整个包。

欢迎任何书籍/网站/建议。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-15T02:21:38.617

“Agile Web Development with Rails”和“The Rails Way”这两本书都很不错。“Pro Active Record”对 Active Record 进行了深入研究，但没有涉及太多其他内容。播客 Railscasts 有时只是使用魔法，但有时它解释了真正发生的事情。诸如[Art of Mission 之](http://www.artofmission.com/articles)类的各种博客可以找到您所寻找的内容。

此外，使用 ruby​​-debug gem 可以让您更好地了解正在发生的事情 - 您可以进入幕后运行的内容。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-15T11:29:17.670

这里有两个方面可以单独检查：

1.  一般概念（包括设计模式、一般态度原则，如 DRY 和 CoC 甚至敏捷性等），因为它们是 Rails 中许多设计决策背后的原则。这些概念中的任何一个都可以独立于 Rails 进行研究（因为它们是通用编程概念）。在深入挖掘之前至少对这些有一些了解是很好的。网上有很多关于这些一般原则的资料（前面提到的 Martin Fowler 的网站是掌握这些概念的更好资料来源之一）。

2.  Rails 将这些概念实现到其语料库中的方式。这里有两件事要记住。由于 Rails 大量利用其母语的特性，因此了解 Ruby 的特性（例如 mixins 和 Ruby 的大量动态特性）至关重要。最后要了解的是Rails**如何**使用这些特性，即。它是如何分解为类和模块的，它有多少功能是在运行时动态创建的，等等。为此，我强烈推荐 David A. Black 的《Ruby for Rails》一书（这本书正是关于 Ruby、它的特性以及 Rails 使用它们的方式）。虽然这本书可能有点过时，但我认为它的内容仍然非常宝贵。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-15T03:37:15.313

如果你真的想知道它是如何工作的，你可以看看源代码。[在线 API 文档](http://api.rubyonrails.org/)可让您直接在文档页面中查看每个方法的源代码。

Rails 中的 ActiveRecord 基于 Martin Fowler 的[Active Record 模式](http://martinfowler.com/eaaCatalog/activeRecord.html)。它基本上是一个 ORM（对象关系映射器）。就 ORM 而言，它甚至没有那么复杂。[Java Persistence with Hibernate](https://rads.stackoverflow.com/amzn/click/com/1932394885)很好地概述了常见的 ORM 概念。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-20T17:15:04.880

这个也可能很适合这里-> [http://railsforphp.com/](http://railsforphp.com/)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-15T02:47:09.673

这是对您问题的切线回答，但我也是从 PHP 开发到 Ruby/Rails 开发的，这对我来说是一个很大的转变。作为 PHP 开发人员，我们习惯于进入细节，说话，而不是被阻止查看引擎盖。

按照设计，Rails 是一个黑盒子。你应该学习 Rails，几乎作为一门语言本身。这是一种新的 Web 开发思维方式，尤其是从 PHP 开发人员的角度来看，尽管这种想法在一般编程中并不少见。

不费心去深入了解可能是开始以“Rails 方式”做事的最佳方式。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-15T10:51:12.690

[Jamis Buck 在他的博客](http://weblog.jamisbuck.org/)上有一系列很好的“ [Under the Hood](http://weblog.jamisbuck.org/under-the-hood) ”文章，涵盖了 Rails 内部的某些方面。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-15T00:11:38.100

我发现这个网站是一个很好的参考：

[http://www.tutorialspoint.com/ruby-on-rails-2.1/index.htm](http://www.tutorialspoint.com/ruby-on-rails-2.1/index.htm)

它在其示例中假设 MySQL。

不过，我相信你可以通过谷歌搜索“ruby on rails 教程”来找到一堆堆。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-19T22:05:51.627

Rails 中的“魔法”涉及[元编程](http://en.wikipedia.org/wiki/Metaprogramming)[`method_missing`](http://rubylearning.com/satishtalim/ruby_method_missing.html)的概念。[The Pragmatic Programmers](http://www.pragprog.com/)的[Dave Thomas](http://pragdave.pragprog.com/)创建了一组[关于元编程 Ruby 的截屏视频](http://www.pragprog.com/screencasts/v-dtrubyom/the-ruby-object-model-and-metaprogramming)。

PHP 有一个类似的函数，称为[`__call`](http://blog.whitet.net/articles/2008/01/22/rubys-method_missing-equivalent-for-php)，并且 PHP 5.3 引入了[`__callstatic`](http://www.sitepoint.com/article/whats-new-php-5-3/2/)。您可以查看这些内容，并在 Google 中搜索“php 元编程”，以获取有关在 PHP 中实现类似 Rails 的行为的一些阅读材料。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-15T13:57:11.583

Rails 中的 ruby​​ 元编程魔法：除了上面提到的黑色“Ruby for Rails”之外，还可以查看 Rappin “Professional Rails”和 Ediger “Advanced Rails”的书籍

命名约定很重要：

[http://rails.wincent.com/wiki/Rails_conventions](http://rails.wincent.com/wiki/Rails_conventions)

[http://www.softiesonrails.com/2007/10/18/ruby-101-naming-conventions](http://www.softiesonrails.com/2007/10/18/ruby-101-naming-conventions)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-16T12:10:57.990

如果您真的想了解 Rails，请阅读您想要的 Rails 源代码。

/Library/Ruby/Gems/1.8/gems/ on OSX 或 freeze rails 并可以在您的 RAILS_ROOT/vendor/ 目录中访问它

# ios - Objective-C 中的多个 NSURLConnection 委托

> ID：203294
> 
> 赞同：15
> 
> 时间：2008-10-15T00:08:53.783
> 
> 标签：ios, objective-c, macos, cocoa

我有两个 NSURLConnections。第二个取决于第一个的内容，因此对于两个连接，处理从连接接收到的数据将是不同的。

我刚刚开始学习Objective-C，我想知道实现代表的正确方法是什么。

现在我正在使用：

```
NSURL *url=[NSURL URLWithString:feedURL];
NSURLRequest *urlR=[[[NSURLRequest alloc] initWithURL:url] autorelease];
NSURLConnection *conn=[[NSURLConnection alloc] initWithRequest:urlR delegate:self]; 
```

我不想使用 self 作为委托，如何定义具有不同委托的两个连接？

```
NSURLConnection *c1 = [[NSURLConnection alloc] initWithRequest:url delegate:handle1];
NSURLConnection *c2 = [[NSURLConnection alloc] initWithRequest:url delegate:handle2]; 
```

我将如何创建 handle1 和 handle2 作为实现？还是接口？我真的不明白你会怎么做。

任何帮助都是极好的。

谢谢，布赖恩·吉安福卡罗

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-15T20:52:14.663

**Ben**，虽然您的信息很有帮助，但它并没有完全回答我提出的问题。

我终于想出了如何设置我自己的代表，这正是我真正要问的。

我是这样实现的：

```
@interface DownloadDelegate : NSObject 
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response;
- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data;
@end

@implementation DownloadDelegate
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response {
}
- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data {
}
@end 
```

我们像这样使用委托：

```
DownloadDelegate *dd = [DownloadDelegate alloc];
NSURLConnection *c2 = [[NSURLConnection alloc] initWithRequest:url delegate:dd]; 
```

希望对处于相同位置的任何人有所帮助，并再次感谢**Ben**的帮助。

谢谢，

**布赖恩·吉安福卡罗**

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-10-25T09:18:04.840

我认为以干净的方式处理多个连接的最佳方法是保留一个委托并仅使用标签标识每个 NSURLConnection （这是一个非常简单的子类，您可以从[http://www.isignmeout.com阅读和复制/multiple-nsurlconnections-viewcontroller/](http://www.isignmeout.com/multiple-nsurlconnections-viewcontroller/) )

基本上用一个识别标签初始化每个 NSURLConnection ，然后你可以在委托中拉那个标签，并使用 Switch-Case 根据你需要的任何逻辑处理它。

**更新**

我已经将子类 NSURLConnection 变成了一个简单的 Category - 更简单和更干净

[https://github.com/Shein/Categories](https://github.com/Shein/Categories)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-16T03:07:50.660

在您的示例中，您分配了一个 DownloadDelegate 对象，而无需对其进行初始化。

```
 `DownloadDelegate *dd = [DownloadDelegate alloc];` 
```

`这是危险的。反而：`

 ````
 `DownloadDelegate *dd = [[DownloadDelegate alloc] init];` 
```

`此外，在您的 @interface 声明中声明您的委托响应方法并不是*绝对*必要的（尽管它当然不会受到伤害）。最后，你要确保你实现了 connection:didFailWithError: 和 connectionDidFinishLoading: 来释放你的 DownloadDelegate 对象，否则你会泄漏。`

 `很高兴你能跑起来！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-15T00:43:12.373

委托被实现为标准的 NSObject-descended 对象。

您可以将两个连接指向同一个委托。

委托应实现您想要捕获的 NSURLConnectionDelegate 方法（例如 -connection:didReceiveData: 和 -connectionDidFinishLoading:)。这些方法将由委托适当地调用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-12T18:44:26.223

[在http://github.com/leonho/iphone-libs/tree/master](http://github.com/leonho/iphone-libs/tree/master)尝试我的 MultipleDownload 类，它为您处理多个 NSURLConnection 对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-03T23:02:03.373

由于委托是异步调用的，他们可以随机调用 didfinishloading。然后，您可以使用状态检查来确定“其他”下载是否已完成，然后再继续。

我使用 2 个代表：

例如（这是伪 oc）：

```
jsondelegate = [[JSonDelegate alloc]initWithCaller:self andSelector:@selector(jsonDone:)]
otherdelegate = [[OtherDelegate] initWithCaller:self andSelector:@selector(otherDone:)] 
```

当每个委托完成时，委托通过调用 2 个 done 方法通知调用者。

每个 done 方法接收 url 数据，并将其状态保存到 ivar。然后他们检查是否设置了另一个 ivar，如果两者都完成，则继续处理。

```
if(self.jsonString && self.otherData){
  continueProcessing
} 
```

希望这可以帮助。

# colors - 色盲模拟器

> ID：203296
> 
> 赞同：24
> 
> 时间：2008-10-15T00:09:38.057
> 
> 标签：colors, accessibility, color-blindness

像任何负责任的开发人员一样，我想确保我制作的网站可供尽可能广泛的受众访问，其中包括相当一部分患有某种形式的色盲的人。

有许多网站可以通过渲染图片或过滤所有内容来过滤您提供给它的 URL。但是，即使在呈现中等复杂的布局时，这两种方法似乎都失败了，所以我有兴趣找到一种客户端方法。

理想的解决方案是整个屏幕上的系统过滤器，可用于测试任何程序。下一个最好的东西是浏览器插件。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-07-11T08:47:55.667

我遇到了[Color Oracle](http://colororacle.org/)并认为它可能会有所帮助。这是简短的描述：

> Color Oracle 是一款适用于 Windows、Mac 和 Linux 的色盲模拟器。它通过实时向您展示具有常见色觉障碍的人会看到什么，从而消除了色盲设计中的猜测。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-10-17T05:29:20.423

Color Oracle 很棒，但另一个选择是[KMag](https://www.kde.org/applications/utilities/kmag/)，它是 Linux 中 KDE 的一部分。它表面上是一个屏幕放大镜，但可以模拟远视、近视、远视和色盲。

它与 Color Oracle 的不同之处在于需要一个额外的窗口来显示重新着色的图像，但优点是可以在预览模拟的同时修改底层图像。

这是一个屏幕截图，左边是原始图形，右边是 KMag 窗口，模拟红盲。

[![在此处输入图像描述](https://i.stack.imgur.com/dGbTW.png)](https://i.stack.imgur.com/dGbTW.png)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-15T00:17:11.317

这是一个模拟各种色盲的网站的链接：

[http://www.vischeck.com/](http://www.vischeck.com/)

它们让您可以使用三种不同的色盲类型检查 URL 和屏幕截图（尽管 URL 检查有点过时。图像检查效果更好）。

我鼓励每个人检查他们的应用程序顺便说一句。用别人的眼睛看你自己的应用程序可能会让人大开眼界（双关语）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-21T15:13:17.180

我知道这是一个相当古老的问题，但我最近发现了一个有趣的解决方案来透明地模拟色盲。

[在使用 Linux 时，您可以使用 Compiz 的Color Filter](http://wiki.compiz.org/Plugins/Colorfilter)插件来模拟色盲。它配备了 deuteranopia 和 protonopia 配置文件，并实时更改整个屏幕的颜色。

它非常好，因为它在所有应用程序中都可以透明地工作（甚至在 Youtube-Videos 中），但它只能在 Compiz 可用的地方工作，例如只能在 Linux 下工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T18:50:49.537

这是一篇文章，其中包含一些针对色盲用户优化 UI 的指南：

[Particletree » 善待色盲](http://particletree.com/features/interfaces-and-color-blindness/)

它包含指向另一篇文章的链接，其中包含您要求的工具类型：

[10 种颜色对比检查工具可提高您设计的可访问性 | 伯里亚街 456 号](http://www.456bereastreet.com/archive/200709/10_colour_contrast_checking_tools_to_improve_the_accessibility_of_your_design/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-20T18:57:51.160

一篇很好的论文解释了保留颜色差异的转换：

[单色和双色的彩色图像的细节保留再现。(PDF)](http://www.cs.clemson.edu/~geist/recent_papers/g3geis.pdf)

我还没有实现过滤器，但我计划在我有更多空闲时间时实现。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-08-11T12:15:18.543

我发现[Color Simulations](http://www.coloursimulations.com/)在 Windows 10 上易于使用。该软件可以将色盲滤镜应用于屏幕的一部分或整个屏幕。最棒的是它让我可以正常与我的电脑交互，就好像它在全屏模式下不存在一样。不过，它在使用集成显卡的 4K 屏幕上运行速度很慢。

# sql - 表中“下一个”和“上一个”的 SQL 是什么？

> ID：203302
> 
> 赞同：11
> 
> 时间：2008-10-15T00:13:06.927
> 
> 标签：sql

我有一个项目表，每个项目都有一个与之关联的日期。如果我有与一个项目关联的日期，如何使用 SQL 查询数据库以获取表中的“上一个”和“后续”项目？

不可能简单地添加（或减去）一个值，因为日期之间没有常规间隔。

一种可能的应用程序是相册或博客 Web 应用程序中的“上一个/下一个”链接，其中基础数据位于 SQL 表中。

我认为有两种可能的情况：

**首先**，每个日期都是唯一的：

样本数据：

```
1,3,8,19,67,45 
```

当提供 8 作为参数时，哪个查询（或多个查询）会给出 3 和 19？（或第 3、8、19 行）。请注意，并不总是要返回三行 - 在序列的末尾会丢失一。

**其次**，如果有一个单独的唯一键来对元素进行排序，那么返回“围绕”日期的集合的查询是什么？预期的顺序是按日期然后键。

样本数据：

```
(key:date) 1:1,2:3,3:8,4:8,5:19,10:19,11:67,15:45,16:8 
```

'8' 的查询返回集合：

```
2:3,3:8,4:8,16:8,5:19 
```

或生成表的查询：

```
key date prev-key next-key
1   1    null     2
2   3    1        3
3   8    2        4
4   8    3        16
5   19   16       10
10  19   5        11
11  67   10       15
15  45   11       null
16  8    4        5 
```

表顺序并不重要 - 只是 next-key 和 prev-key 字段。

* * *

TheSoftwareJedi 和 Cade Roux 都有适用于我昨晚发布的数据集的解决方案。对于第二个问题，这两个数据集似乎都失败了：

```
(key:date) 1:1,2:3,3:8,4:8,5:19,10:19,11:67,15:45,16:8 
```

预期的顺序是按日期然后键，所以一个预期的结果可能是：

```
2:3,3:8,4:8,16:8,5:19 
```

另一个：

```
key date prev-key next-key
1   1    null     2
2   3    1        3
3   8    2        4
4   8    3        16
5   19   16       10
10  19   5        11
11  67   10       15
15  45   11       null
16  8    4        5 
```

表顺序并不重要 - 只是 next-key 和 prev-key 字段。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-15T00:16:21.490

从元素 < 8 的数据中选择最大值（元素）

联盟

从元素 > 8 的数据中选择 min(element)

但通常将 sql 用于面向集合的操作而不是迭代操作更有用。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-15T00:40:51.910

自加入。

对于表：

```
/*
CREATE TABLE [dbo].[stackoverflow_203302](
    [val] [int] NOT NULL
) ON [PRIMARY]
*/ 
```

带参数`@val`

```
SELECT cur.val, MAX(prv.val) AS prv_val, MIN(nxt.val) AS nxt_val
FROM stackoverflow_203302 AS cur
LEFT JOIN stackoverflow_203302 AS prv
    ON cur.val > prv.val
LEFT JOIN stackoverflow_203302 AS nxt
    ON cur.val < nxt.val
WHERE cur.val = @val
GROUP BY cur.val 
```

您可以将其设为带有输出参数的存储过程，或者将其作为相关子查询加入到您正在提取的数据中。

如果没有参数，对于您的数据，结果将是：

```
val         prv_val     nxt_val
----------- ----------- -----------
1           NULL        3
3           1           8
8           3           19
19          8           45
45          19          67
67          45          NULL 
```

对于修改后的示例，您将其用作相关子查询：

```
/*
CREATE TABLE [dbo].[stackoverflow_203302](
    [ky] [int] NOT NULL,
    [val] [int] NOT NULL,
    CONSTRAINT [PK_stackoverflow_203302] PRIMARY KEY CLUSTERED (
        [ky] ASC
    )
)
*/

SELECT cur.ky AS cur_ky
        ,cur.val AS cur_val
        ,prv.ky AS prv_ky
        ,prv.val AS prv_val
        ,nxt.ky AS nxt_ky
        ,nxt.val as nxt_val
FROM (
    SELECT cur.ky, MAX(prv.ky) AS prv_ky, MIN(nxt.ky) AS nxt_ky
    FROM stackoverflow_203302 AS cur
    LEFT JOIN stackoverflow_203302 AS prv
        ON cur.ky > prv.ky
    LEFT JOIN stackoverflow_203302 AS nxt
        ON cur.ky < nxt.ky
    GROUP BY cur.ky
) AS ordering
INNER JOIN stackoverflow_203302 as cur
    ON cur.ky = ordering.ky
LEFT JOIN stackoverflow_203302 as prv
    ON prv.ky = ordering.prv_ky
LEFT JOIN stackoverflow_203302 as nxt
    ON nxt.ky = ordering.nxt_ky 
```

与预期的输出：

```
cur_ky      cur_val     prv_ky      prv_val     nxt_ky      nxt_val
----------- ----------- ----------- ----------- ----------- -----------
1           1           NULL        NULL        2           3
2           3           1           1           3           8
3           8           2           3           4           19
4           19          3           8           5           67
5           67          4           19          6           45
6           45          5           67          NULL        NULL 
```

在 SQL Server 中，我更喜欢将子查询设为公用表表达式。如果有很多嵌套，这会使代码看起来更线性，嵌套更少并且更容易遵循（此外，在某些重新连接时需要更少的重复）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-15T00:16:20.320

首先，这应该有效（ORDER BY 很重要）：

```
select min(a)
from theTable
where a > 8

select max(a)
from theTable
where a < 8 
```

对于我请求你问的第二个问题......：

```
 select * 
    from theTable
    where date = 8

    union all

    select *
    from theTable
    where key = (select min(key) 
                 from theTable
                 where key > (select max(key)
                              from theTable
                              where date = 8)
                )

    union all

    select *
    from theTable
    where key = (select max(key) 
                 from theTable
                 where key < (select min(key)
                              from theTable
                              where date = 8)
                )

    order by key 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T01:04:35.590

```
SELECT 'next' AS direction, MIN(date_field) AS date_key
FROM table_name
  WHERE date_field > current_date
GROUP BY 1 -- necessity for group by varies from DBMS to DBMS in this context
UNION
SELECT 'prev' AS direction, MAX(date_field) AS date_key
  FROM table_name
  WHERE date_field < current_date
GROUP BY 1
ORDER BY 1 DESC; 
```

产生：

```
direction  date_key
---------  --------
prev              3
next             19 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-15T11:30:16.573

我自己基于 TheSoftwareJedi 尝试设置的解决方案。

第一个问题：

```
select date from test where date = 8
union all
select max(date) from test where date < 8
union all
select min(date) from test where date > 8
order by date; 
```

第二个问题：

在调试时，我使用了数据集：

```
(key:date) 1:1,2:3,3:8,4:8,5:19,10:19,11:67,15:45,16:8,17:3,18:1 
```

给出这个结果：

```
select * from test2 where date = 8
union all
select * from (select * from test2
                   where date = (select max(date) from test2 
                                     where date < 8)) 
    where key = (select max(key) from test2 
                    where date = (select max(date) from test2 
                                      where date < 8))
union all
select * from (select * from test2
                   where date = (select min(date) from test2 
                                     where date > 8)) 
    where key = (select min(key) from test2 
                    where date = (select min(date) from test2 
                                      where date > 8))
order by date,key; 
```

在这两种情况下，最终的 order by 子句严格来说都是可选的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-11-27T20:28:14.950

如果您的 RDBMS 支持 LAG 和 LEAD，这很简单（Oracle、PostgreSQL、SQL Server 2012）

这些允许在单个查询中选择任何给定行的任一侧的行

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-15T01:39:27.797

试试这个...

```
SELECT TOP 3 * FROM YourTable
WHERE Col >= (SELECT MAX(Col) FROM YourTable b WHERE Col < @Parameter)
ORDER BY Col 
```

# sql - 在层次树中查找叶节点

> ID：203316
> 
> 赞同：16
> 
> 时间：2008-10-15T00:20:41.107
> 
> 标签：sql, database, tree

我的数据库中有一个存储树结构的表。以下是相关字段：

```
mytree (id, parentid, otherfields...) 
```

我想找到所有的叶子节点（即任何`id`不是另一个记录的记录`parentid`）

我试过这个：

```
SELECT * FROM mytree WHERE `id` NOT IN (SELECT DISTINCT `parentid` FROM `mytree`) 
```

但这返回了一个空集。奇怪的是，删除“NOT”会返回所有非叶节点的集合。

谁能看到我哪里出错了？

*更新：*感谢大家的回答，他们都是正确的并且为我工作。我接受了丹尼尔的，因为它也解释了为什么我的查询不起作用（NULL 的事情）。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-15T00:30:26.750

您的查询无效，因为子查询包括`NULL`. 以下轻微修改对我有用：

```
SELECT * FROM `mytree` WHERE `id` NOT IN (
    SELECT DISTINCT `parentid` FROM `mytree` WHERE `parentid` IS NOT NULL) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-15T00:28:33.167

不知道为什么您的查询不起作用。这是左外连接语法中的相同内容 - 试试这种方式？

```
select a.*
from mytree a left outer join
     mytree b on a.id = b.parentid
where b.parentid is null 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-15T00:31:09.587

```
SELECT * FROM mytree AS t1
LEFT JOIN mytree AS t2 ON t1.id=t2.parentid
WHERE t2.parentid IS NULL 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T00:41:31.940

```
Select * from mytree where id not in (Select distinct parentid from mytree where parentid is not null) 
```

[http://archives.postgresql.org/pgsql-sql/2005-10/msg00228.php](http://archives.postgresql.org/pgsql-sql/2005-10/msg00228.php)

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2015-10-05T20:25:01.640

我的表结构是

```
memberid    MemberID    joiningposition packagetype
RPM00000    NULL          Root                free
RPM71572    RPM00000       Left           Royal
RPM323768   RPM00000       Right              Royal
RPM715790   RPM71572       Left            free
RPM323769   RPM71572      Right            free
RPM715987   RPM323768      Left             free
RPM323985   RPM323768      Right               free
RPM733333   RPM323985     Right            free
RPM324444   RPM715987     *emphasized text*Right               Royal 
```

--

```
ALTER procedure [dbo].[sunnypro]
as
DECLARE @pId varchar(40) = 'RPM00000';
Declare @Id int
set @Id=(select id from registration where childid=@pId) 
begin

-- Recursive CTE
    WITH R AS
     (

SELECT 

    BU.DateofJoing,
    BU.childid,
    BU.joiningposition,
    BU.packagetype
    FROM registration AS BU
    WHERE
    BU.MemberID = @pId and
   BU.joiningposition IN ('Left', 'Right')
    or BU.packagetype in('Royal','Platinum','Majestic')
     and BU.Id>@id
    UNION All

-- Recursive part
SELECT

     BU.DateofJoing,
     BU.childid,
     R.joiningposition,
    BU.packagetype

    FROM R
    JOIN registration AS BU
    ON BU.MemberID = R.childid
    WHERE
    BU.joiningposition IN ('Left', 'Right') and
  BU.packagetype in('Royal','Platinum','Majestic')
 and BU.Id>@id
)

INSERT INTO Wallatpayout
       (childid
       ,packagetype

       ,joiningposition
       ,DateofJoing
       ,Total)

-- Final groups of nodes found
SELECT top 3

R.childid,
R.packagetype,
R.joiningposition,
R.DateofJoing,
Total = COUNT_BIG(*)
FROM R where R.packagetype in('Royal','Platinum','Majestic')
GROUP BY R.childid,
R.joiningposition,
R.DateofJoing,
R.packagetype
OPTION (MAXRECURSION 0);
end 
```

# wcf - 在 BizTalk 2006 R2 中使用 WCF 服务

> ID：203322
> 
> 赞同：6
> 
> 时间：2008-10-15T00:25:16.403
> 
> 标签：wcf, biztalk, biztalk2006r2

我试图弄清楚如何在 BizTalk 2006 R2 中使用 WCF 服务（发送请求并接收响应）。

我已经完成了“添加生成的项目”向导。现在我试图找出如何使用它在编排中生成的项目。

应该如何提出请求？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T03:29:49.713

下面是如何做到这一点的描述 - 我将假设至少具有 BizTalk 映射之类的基本知识，如果您需要更多详细信息，请告诉我，我会更新。

在 BizTalk 中生成项目后，您应该（至少）：

*   创建了带有消息和端口类型的编排文件
*   描述您从 WCF 服务发送和接收的消息的架构
*   一个 .Binding.xml 文件，描述 WCF 服务公开的服务协定并允许在 BizTalk 中轻松配置

    1.  打开编排文件。这应该是空的。
*   将一个端口从工具箱拖到编排设计器表面。

*   适当地命名端口。
*   选择“使用现有端口类型” - 现有端口类型之一将是您的 WCF 服务（由添加生成的项目向导创建）
*   指定您将发送和接收消息
*   指定稍后绑定

此端口应具有请求和响应操作消息，并且它们应该已自动配置为将消息用于您的 WCF 服务。如果您的服务公开了多个操作，您将在此处看到这一点。

2.  使用标准 BizTalk 映射方法，将要发送到 WCF 服务的数据映射到 WCf 端口的请求消息中。（您可能希望将编排设计器中的消息名称更改为比默认的 message_1、message_2... 更好的名称）

3.  将接收和发送形状拖到业务流程设计器上，并将它们连接到正确的端口消息。

4.  连接 BizTalk 业务流程的其余部分以从适当的源系统获取数据（这只是基本的 BizTalk，而不是 WCF）

5.  部署 BizTalk 应用程序。

    该应用程序现已准备就绪，您可以将其部署到 BizTalk。

6.  配置 BizTalk 应用程序

    *   打开 BizTalk Server 2006 管理控制台并找到包含您刚刚部署的业务流程的应用程序。
    *   编排将被取消登记，您需要绑定其所有端口
        对于大多数端口，这就像任何其他 BizTalk 应用程序一样 - 只是处理 WCF 服务的端口不同。

对于 WCF 端口，您有（至少开始时）两个主要选项：

1.  导入由 BizTalk 生成项目向导创建的绑定文件（右键单击应用程序并导入 - 导航到 .xml 绑定文件）- 在您了解 Biztalk 如何表示所有 WCF 绑定选项之前，这可能是可取的。
2.  配置您自己的 WCF 发送端口。

    *   为此，端口需要是 Solicit-Response 以匹配 WCF 服务。
    *   选择一种 WCF 发送端口类型以匹配 WCF 服务的绑定类型。
        首先（对于基本 Web 服务），这通常是 WCF-BasicHttp。
        一旦您掌握了基础知识，您可能希望返回这里并尝试自定义绑定中可用的选项 - 那里有*很多*！
    *   配置发送端口。
        *   在常规选项卡中输入指定 .svc 文件的 url，
            例如[http://localhost/WCF/myservice.svc](http://localhost/WCF/myservice.svc)
        *   设置 Action 以匹配 WCF 服务 .wsdl 文件中指定的操作，
            例如[http://tempuri.org/IMyContract/MyMethod](http://tempuri.org/IMyContract/MyMethod)

现在创建 WCF 端口后，您可以将业务流程端口绑定到它。

完成所有这些后，您应该能够启动 BizTalk 应用程序并且一切正常。

可能有帮助的一件事 - 错误将被写入事件日志，它们可能没有帮助，但您还应该能够在挂起的消息视图中看到从服务返回的任何肥皂故障消息。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T03:29:15.640

如果您只是使用它来编排 WCF 服务，那么 BizTalk 就太过分了。您可以更轻松地在 Windows Workflow Foundation 内部的 .NET 3.5 中使用 WCF 服务。

也就是说，这是一个应该有所帮助的截屏视频：

[http://www.pluralsight.com/community/blogs/aaron/archive/2007/11/15/49172.aspx](http://www.pluralsight.com/community/blogs/aaron/archive/2007/11/15/49172.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-16T06:37:24.957

它与 BizTalk 中的其他服务开发一样非常简单。让它更简单。

1.  只需开发您想要的工作流程（编排）和服务。
2.  打开 WCF Web 发布向导并检查 (a) 启用元数据端点，(b) 在您的应用程序中创建 BizTalk 接收位置。
3.  转到您的 BizTalk 控制台并启用接收位置并从 Biztalk 控制台启动您的应用程序。
4.  然后从 IE 或 Fire Fox 浏览它以检查服务是否正在运行。现在服务已经开发。让我们为它的客户做点什么。
5.  转到 Patah "c:\Program Files\Microsoft SDKs\Windows\v6.0A\Bin\" 并写入 SVCUTL 和您的服务 url，即 c:\Program Files\Microsoft SDKs\Windows\v6.0A\Bin\ svcutil localhost:axix//axx.svx?wsdl，这会复制两个文件，一个是output.config，另一个是BizTalkServiceInstance。将这两个文件剪切并粘贴到您的 ciletn 中，然后查看您的服务 desp 的使用情况。我认为这是我尝试做的最简单的。感谢阿卜杜勒·阿齐兹·法鲁奇。

# sql - TSQL 扩展过程'xp_dirscan'？

> ID：203333
> 
> 赞同：1
> 
> 时间：2008-10-15T00:31:22.333
> 
> 标签：sql, sql-server, sql-server-2005, tsql

SQL Server 2005 中扩展过程“xp_dirscan”的等价物是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T04:47:43.653

它不是 SQL Server 中的本机交付代码。这是一个第 3 方扩展存储过程（它是一个 DLL）。

您可以在[SQL Server Central 上注册并查看本文](http://www.sqlservercentral.com/articles/Administering/sql2000dbatoolkitpart4/2364/)的下载和说明。

它适用于 SQL 2000，但注册 DLL 应该是相同的（我在 '2005 上没有尝试过）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T00:56:57.023

`xp_dirscan`似乎是执行递归目录搜索的扩展存储过程。如果您有权访问 DLL，则可以将其注册为 SQL 2005 中的扩展存储过程。

或者，您可以使用`xp_cmdshell`托管扩展存储过程编写执行相同操作的代码。

# php - Creating the Singleton design pattern in PHP5

> ID：203336
> 
> 赞同：209
> 
> 时间：2008-10-15T00:33:27.650
> 
> 标签：php, oop, design-patterns, singleton

How would one create a Singleton class using PHP5 classes?

* * *

## 回答 #1

> 赞同：270
> 
> 时间：2008-10-15T00:45:17.190

```
/**
 * Singleton class
 *
 */
final class UserFactory
{
    /**
     * Call this method to get singleton
     *
     * @return UserFactory
     */
    public static function Instance()
    {
        static $inst = null;
        if ($inst === null) {
            $inst = new UserFactory();
        }
        return $inst;
    }

    /**
     * Private ctor so nobody else can instantiate it
     *
     */
    private function __construct()
    {

    }
} 
```

To use:

```
$fact = UserFactory::Instance();
$fact2 = UserFactory::Instance(); 
```

`$fact == $fact2;`

But:

```
$fact = new UserFactory() 
```

Throws an error.

See [http://php.net/manual/en/language.variables.scope.php#language.variables.scope.static](http://php.net/manual/en/language.variables.scope.php#language.variables.scope.static "PHP: Variable Scope : Using Static Variables") to understand static variable scopes and why setting `static $inst = null;` works.

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2013-04-08T02:31:06.017

Unfortunately [Inwdr's answer](https://stackoverflow.com/questions/203336/creating-the-singleton-design-pattern-in-php5/1939269#1939269) breaks when there are multiple subclasses.

Here is a correct inheritable Singleton base class.

```
class Singleton
{
    private static $instances = array();
    protected function __construct() {}
    protected function __clone() {}
    public function __wakeup()
    {
        throw new Exception("Cannot unserialize singleton");
    }

    public static function getInstance()
    {
        $cls = get_called_class(); // late-static-bound class name
        if (!isset(self::$instances[$cls])) {
            self::$instances[$cls] = new static;
        }
        return self::$instances[$cls];
    }
} 
```

Test code:

```
class Foo extends Singleton {}
class Bar extends Singleton {}

echo get_class(Foo::getInstance()) . "\n";
echo get_class(Bar::getInstance()) . "\n"; 
```

* * *

## 回答 #3

> 赞同：120
> 
> 时间：2009-12-21T10:12:26.397

PHP 5.3 allows the creation of an inheritable Singleton class via late static binding:

```
class Singleton
{
    protected static $instance = null;

    protected function __construct()
    {
        //Thou shalt not construct that which is unconstructable!
    }

    protected function __clone()
    {
        //Me not like clones! Me smash clones!
    }

    public static function getInstance()
    {
        if (!isset(static::$instance)) {
            static::$instance = new static;
        }
        return static::$instance;
    }
} 
```

This solves the problem, that prior to PHP 5.3 any class that extended a Singleton would produce an instance of its parent class instead of its own.

Now you can do:

```
class Foobar extends Singleton {};
$foo = Foobar::getInstance(); 
```

And $foo will be an instance of Foobar instead of an instance of Singleton.

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2016-06-13T22:17:57.473

**The Real One and Modern** way to make Singleton Pattern is:

```
<?php

/**
 * Singleton Pattern.
 * 
 * Modern implementation.
 */
class Singleton
{
    /**
     * Call this method to get singleton
     */
    public static function instance()
    {
      static $instance = false;
      if( $instance === false )
      {
        // Late static binding (PHP 5.3+)
        $instance = new static();
      }

      return $instance;
    }

    /**
     * Make constructor private, so nobody can call "new Class".
     */
    private function __construct() {}

    /**
     * Make clone magic method private, so nobody can clone instance.
     */
    private function __clone() {}

    /**
     * Make sleep magic method private, so nobody can serialize instance.
     */
    private function __sleep() {}

    /**
     * Make wakeup magic method private, so nobody can unserialize instance.
     */
    private function __wakeup() {}

} 
```

So now you can use it like.

```
<?php

/**
 * Database.
 *
 * Inherited from Singleton, so it's now got singleton behavior.
 */
class Database extends Singleton {

  protected $label;

  /**
   * Example of that singleton is working correctly.
   */
  public function setLabel($label)
  {
    $this->label = $label;
  }

  public function getLabel()
  {
    return $this->label;
  }

}

// create first instance
$database = Database::instance();
$database->setLabel('Abraham');
echo $database->getLabel() . PHP_EOL;

// now try to create other instance as well
$other_db = Database::instance();
echo $other_db->getLabel() . PHP_EOL; // Abraham

$other_db->setLabel('Priler');
echo $database->getLabel() . PHP_EOL; // Priler
echo $other_db->getLabel() . PHP_EOL; // Priler 
```

As you see this realization is lot more flexible.

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2008-10-15T07:06:37.620

You probably should add a private __clone() method to disallow cloning of an instance.

```
private function __clone() {} 
```

If you don't include this method the following gets possible

```
$inst1=UserFactory::Instance(); // to stick with the example provided above
$inst2=clone $inst1; 
```

now `$inst1` !== `$inst2` - they are not the same instance any more.

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2013-05-18T12:16:02.280

```
<?php
/**
 * Singleton patter in php
 **/
trait SingletonTrait {
   protected static $inst = null;

  /**
   * call this method to get instance
   **/
   public static function getInstance(){
      if (static::$inst === null){
         static::$inst = new static();
      }
      return static::$inst;
  }

  /**
   * protected to prevent clonning 
   **/
  protected function __clone(){
  }

  /**
   * protected so no one else can instance it 
   **/
  protected function __construct(){
  }
} 
```

to use:

```
/**
 *  example of class definitions using SingletonTrait
 */
class DBFactory {
  /**
   * we are adding the trait here 
   **/
   use SingletonTrait;

  /**
   * This class will have a single db connection as an example
   **/
  protected $db;

 /**
  * as an example we will create a PDO connection
  **/
  protected function __construct(){
    $this->db = 
        new PDO('mysql:dbname=foodb;port=3305;host=127.0.0.1','foouser','foopass');
  }
}
class DBFactoryChild extends DBFactory {
  /**
   * we repeating the inst so that it will differentiate it
   * from UserFactory singleton
   **/
   protected static $inst = null;
}

/**
 * example of instanciating the classes
 */
$uf0 = DBFactoryChild::getInstance();
var_dump($uf0);
$uf1 = DBFactory::getInstance();
var_dump($uf1);
echo $uf0 === $uf1; 
```

respose:

```
object(DBFactoryChild)#1 (0) {
}
object(DBFactory)#2 (0) {
} 
```

If you are using PHP 5.4: ***trait*** its an option, so you don't have to waste the inheritance hierarchy in order to have the ***Singleton pattern***

and also notice that whether you use ***traits*** or ***extends Singleton*** class one loose end was to create singleton of child classes if you dont add the following line of code:

```
 protected static $inst = null; 
```

in the child class

the unexpected result will be:

```
object(DBFactoryChild)#1 (0) {
}
object(DBFactoryChild)#1 (0) {
} 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2012-01-18T04:20:25.753

```
protected  static $_instance;

public static function getInstance()
{
    if(is_null(self::$_instance))
    {
        self::$_instance = new self();
    }
    return self::$_instance;
} 
```

This code can apply for any class without caring about its class name.

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-07-14T11:27:51.183

# Supports Multiple Objects with 1 line per class:

This method will enforce singletons on any class you wish, al you have to do is add 1 method to the class you wish to make a singleton and this will do it for you.

This also stores objects in a "SingleTonBase" class so you can debug all your objects that you have used in your system by recursing the `SingleTonBase` objects.

* * *

Create a file called SingletonBase.php and include it in root of your script!

The code is

```
abstract class SingletonBase
{
    private static $storage = array();

    public static function Singleton($class)
    {
        if(in_array($class,self::$storage))
        {
            return self::$storage[$class];
        }
        return self::$storage[$class] = new $class();
    }
    public static function storage()
    {
       return self::$storage;
    }
} 
```

Then for any class you want to make a singleton just add this small single method.

```
public static function Singleton()
{
    return SingletonBase::Singleton(get_class());
} 
```

* * *

Here is a small example:

```
include 'libraries/SingletonBase.resource.php';

class Database
{
    //Add that singleton function.
    public static function Singleton()
    {
        return SingletonBase::Singleton(get_class());
    }

    public function run()
    {
        echo 'running...';
    }
}

$Database = Database::Singleton();

$Database->run(); 
```

And you can just add this singleton function in any class you have and it will only create 1 instance per class.

NOTE: You should always make the __construct private to eliminate the use of new Class(); instantiations.

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-12-05T05:25:45.753

```
class Database{

        //variable to hold db connection
        private $db;
        //note we used static variable,beacuse an instance cannot be used to refer this
        public static $instance;

        //note constructor is private so that classcannot be instantiated
        private function __construct(){
          //code connect to database  

         }     

         //to prevent loop hole in PHP so that the class cannot be cloned
        private function __clone() {}

        //used static function so that, this can be called from other classes
        public static function getInstance(){

            if( !(self::$instance instanceof self) ){
                self::$instance = new self();           
            }
             return self::$instance;
        }

        public function query($sql){
            //code to run the query
        }

    }

Access the method getInstance using
$db = Singleton::getInstance();
$db->query(); 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2016-09-27T16:32:11.013

You don't really need to use Singleton pattern because it's considered to be an antipattern. Basically there is a lot of reasons to not to implement this pattern at all. Read this to start with: [Best practice on PHP singleton classes](https://stackoverflow.com/questions/8776788/best-practice-on-php-singleton-classes).

If after all you still think you need to use Singleton pattern then we could write a class that will allow us to get Singleton functionality by extending our SingletonClassVendor abstract class.

This is what I came with to solve this problem.

```
<?php
namespace wl;

/**
 * @author DevWL
 * @dosc allows only one instance for each extending class.
 * it acts a litle bit as registry from the SingletonClassVendor abstract class point of view
 * but it provides a valid singleton behaviour for its children classes
 * Be aware, the singleton pattern is consider to be an anti-pattern
 * mostly because it can be hard to debug and it comes with some limitations.
 * In most cases you do not need to use singleton pattern
 * so take a longer moment to think about it before you use it.
 */
abstract class SingletonClassVendor
{
    /**
     *  holds an single instance of the child class
     *
     *  @var array of objects
     */
    protected static $instance = [];

    /**
     *  @desc provides a single slot to hold an instance interchanble between all child classes.
     *  @return object
     */
    public static final function getInstance(){
        $class = get_called_class(); // or get_class(new static());
        if(!isset(self::$instance[$class]) || !self::$instance[$class] instanceof $class){
            self::$instance[$class] = new static(); // create and instance of child class which extends Singleton super class
            echo "new ". $class . PHP_EOL; // remove this line after testing
            return  self::$instance[$class]; // remove this line after testing
        }
        echo "old ". $class . PHP_EOL; // remove this line after testing
        return static::$instance[$class];
    }

    /**
     * Make constructor abstract to force protected implementation of the __constructor() method, so that nobody can call directly "new Class()".
     */
    abstract protected function __construct();

    /**
     * Make clone magic method private, so nobody can clone instance.
     */
    private function __clone() {}

    /**
     * Make sleep magic method private, so nobody can serialize instance.
     */
    private function __sleep() {}

    /**
     * Make wakeup magic method private, so nobody can unserialize instance.
     */
    private function __wakeup() {}

} 
```

Use example:

```
/**
 * EXAMPLE
 */

/**
 *  @example 1 - Database class by extending SingletonClassVendor abstract class becomes fully functional singleton
 *  __constructor must be set to protected becaouse: 
 *   1 to allow instansiation from parent class 
 *   2 to prevent direct instanciation of object with "new" keword.
 *   3 to meet requierments of SingletonClassVendor abstract class
 */
class Database extends SingletonClassVendor
{
    public $type = "SomeClass";
    protected function __construct(){
        echo "DDDDDDDDD". PHP_EOL; // remove this line after testing
    }
}

/**
 *  @example 2 - Config ...
 */
class Config extends SingletonClassVendor
{
    public $name = "Config";
    protected function __construct(){
        echo "CCCCCCCCCC" . PHP_EOL; // remove this line after testing
    }
} 
```

Just to prove that it works as expected:

```
/**
 *  TESTING
 */
$bd1 = Database::getInstance(); // new
$bd2 = Database::getInstance(); // old
$bd3 = Config::getInstance(); // new
$bd4 = Config::getInstance(); // old
$bd5 = Config::getInstance(); // old
$bd6 = Database::getInstance(); // old
$bd7 = Database::getInstance(); // old
$bd8 = Config::getInstance(); // old

echo PHP_EOL."COMPARE ALL DATABASE INSTANCES".PHP_EOL;
var_dump($bd1);
echo '$bd1 === $bd2' . ($bd1 === $bd2)? ' TRUE' . PHP_EOL: ' FALSE' . PHP_EOL; // TRUE
echo '$bd2 === $bd6' . ($bd2 === $bd6)? ' TRUE' . PHP_EOL: ' FALSE' . PHP_EOL; // TRUE
echo '$bd6 === $bd7' . ($bd6 === $bd7)? ' TRUE' . PHP_EOL: ' FALSE' . PHP_EOL; // TRUE

echo PHP_EOL;

echo PHP_EOL."COMPARE ALL CONFIG INSTANCES". PHP_EOL;
var_dump($bd3);
echo '$bd3 === $bd4' . ($bd3 === $bd4)? ' TRUE' . PHP_EOL: ' FALSE' . PHP_EOL; // TRUE
echo '$bd4 === $bd5' . ($bd4 === $bd5)? ' TRUE' . PHP_EOL: ' FALSE' . PHP_EOL; // TRUE
echo '$bd5 === $bd8' . ($bd5 === $bd8)? ' TRUE' . PHP_EOL: ' FALSE' . PHP_EOL; // TRUE 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-01-24T22:28:10.907

I know this is probably going to cause an unnecessary flame war, but I can see how you might want more than one database connection, so I would concede the point that singleton might not be the best solution for that... however, there are other uses of the singleton pattern that I find extremely useful.

Here's an example: I decided to roll my own MVC and templating engine because I wanted something really lightweight. However, the data that I want to display contains a lot of special math characters such as ≥ and μ and what have you... The data is stored as the actual UTF-8 character in my database rather than pre-HTML-encoded because my app can deliver other formats such as PDF and CSV in addition to HTML. The appropriate place to format for HTML is inside the template ("view" if you will) that is responsible for rendering that page section (snippet). I want to convert them to their appropriate HTML entities, but PHPs get_html_translation_table() function is not super fast. It makes better sense to retrieve the data one time and store as an array, making it available for all to use. Here's a sample I knocked together to test the speed. Presumably, this would work regardless of whether the other methods you use (after getting the instance) were static or not.

```
class EncodeHTMLEntities {

    private static $instance = null;//stores the instance of self
    private $r = null;//array of chars elligalbe for replacement

    private function __clone(){
    }//disable cloning, no reason to clone

    private function __construct()
    {
        $allEntities = get_html_translation_table(HTML_ENTITIES, ENT_NOQUOTES);
        $specialEntities = get_html_translation_table(HTML_SPECIALCHARS, ENT_NOQUOTES);
        $this->r = array_diff($allEntities, $specialEntities);
    }

    public static function replace($string)
    {
        if(!(self::$instance instanceof self) ){
            self::$instance = new self();
        }
        return strtr($string, self::$instance->r);
    }
}
//test one million encodings of a string
$start = microtime(true);
for($x=0; $x<1000000; $x++){
    $dump = EncodeHTMLEntities::replace("Reference method for diagnosis of CDAD, but clinical usefulness limited due to extended turnaround time (≥96 hrs)");
}
$end = microtime(true);
echo "Run time: ".($end-$start)." seconds using singleton\n";
//now repeat the same without using singleton
$start = microtime(true);
for($x=0; $x<1000000; $x++){
    $allEntities = get_html_translation_table(HTML_ENTITIES, ENT_NOQUOTES);
    $specialEntities = get_html_translation_table(HTML_SPECIALCHARS, ENT_NOQUOTES);
    $r = array_diff($allEntities, $specialEntities);
    $dump = strtr("Reference method for diagnosis of CDAD, but clinical usefulness limited due to extended turnaround time (≥96 hrs)", $r);
}
$end = microtime(true);
echo "Run time: ".($end-$start)." seconds without using singleton"; 
```

Basically, I saw typical results like this:

```
php test.php
Run time: 27.842966794968 seconds using singleton
Run time: 237.78191494942 seconds without using singleton

```

So while I'm certainly no expert, I don't see a more convenient and reliable way to reduce the overhead of slow calls for some kind of data, while making it super simple (single line of code to do what you need). Granted my example only has one useful method, and therefore is no better than a globally defined function, but as soon as you have two methods, you're going to want to group them together, right? Am I way off base?

Also, I prefer examples that actually DO something, since sometimes it's hard to visualise when an example includes statements like "//do something useful here" which I see all the time when searching for tutorials.

Anyway, I'd love any feedback or comments on why using a singleton for this type of thing is detrimental (or overly complicated).

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2013-08-09T21:10:57.160

All this complexity ("late static binding" ... harumph) is, to me, simply a sign of PHP's broken object/class model. If class objects were first-class objects (see Python), then "$_instance" would be a class *instance* variable -- a member of the class object, as opposed to a member/property of its instances, and also as opposed to shared by its descendants. In the Smalltalk world, this is the difference between a "class variable" and a "class instance variable".

In PHP, it looks to me as though we need to take to heart the guidance that patterns are a guide towards writing code -- we might perhaps think about a Singleton template, but trying to write code that inherits from an actual "Singleton" class looks misguided for PHP (though I supposed some enterprising soul could create a suitable SVN keyword).

I will continue to just code each singleton separately, using a shared template.

Notice that I'm absolutely staying OUT of the singletons-are-evil discussion, life is too short.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-12-17T19:21:10.640

This article covers topic quite extensively: [http://www.phptherightway.com/pages/Design-Patterns.html#singleton](http://www.phptherightway.com/pages/Design-Patterns.html#singleton)

> Note the following:
> 
> *   The constructor `__construct()` is declared as `protected` to prevent creating a new instance outside of the class via the `new` operator.
> *   The magic method `__clone()` is declared as `private` to prevent cloning of an instance of the class via the `clone` operator.
> *   The magic method `__wakeup()` is declared as `private` to prevent unserializing of an instance of the class via the global function `unserialize()`.
> *   A new instance is created via late static binding in the static creation method `getInstance()` with the keyword `static`. This allows the subclassing of the `class Singleton` in the example.

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-01-31T07:00:50.653

I have written long back thought to share here

```
class SingletonDesignPattern {

    //just for demo there will be only one instance
    private static $instanceCount =0;

    //create the private instance variable
    private static $myInstance=null;

    //make constructor private so no one create object using new Keyword
    private function  __construct(){}

    //no one clone the object
    private function  __clone(){}

    //avoid serialazation
    public function __wakeup(){}

    //ony one way to create  object
    public static  function  getInstance(){

        if(self::$myInstance==null){
            self::$myInstance=new SingletonDesignPattern();
            self::$instanceCount++;
        }
        return self::$myInstance;
    }

    public static function getInstanceCount(){
        return self::$instanceCount;
    }

}

//now lets play with singleton design pattern

$instance = SingletonDesignPattern::getInstance();
$instance = SingletonDesignPattern::getInstance();
$instance = SingletonDesignPattern::getInstance();
$instance = SingletonDesignPattern::getInstance();

echo "number of instances: ".SingletonDesignPattern::getInstanceCount(); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-10-08T22:51:27.850

I agree with the first answer but I would also declare the class as final so that it cannot be extended as extending a singleton violates the singleton pattern. Also the instance variable should be private so that it cannot be accessed directly. Also make the __clone method private so that you cannot clone the singleton object.

Below is some example code.

```
/**
 * Singleton class
 *
 */
final class UserFactory
{
    private static $_instance = null;

    /**
     * Private constructor
     *
     */
    private function __construct() {}

    /**
     * Private clone method
     *
     */
     private function __clone() {}

    /**
     * Call this method to get singleton
     *
     * @return UserFactory
     */
    public static function getInstance()
    {
        if (self::$_instance === null) {
            self::$_instance = new UserFactory();
        }
        return self::$_instance;
    }
} 
```

Example Usage

```
$user_factory = UserFactory::getInstance(); 
```

What this stops you from doing (which would violate the singleton pattern..

**YOU CANNOT DO THIS!**

```
$user_factory = UserFactory::$_instance;

class SecondUserFactory extends UserFactory { } 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-11-13T16:33:07.777

This should be the right way of Singleton.

```
class Singleton {

    private static $instance;
    private $count = 0;

    protected function __construct(){

    }

    public static function singleton(){

        if (!isset(self::$instance)) {

            self::$instance = new Singleton;

        }

        return self::$instance;

    }

    public function increment()
    {
        return $this->count++;
    }

    protected function __clone(){

    }

    protected function __wakeup(){

    }

} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-06-02T15:39:11.813

I liked @jose-segura method of using traits but didn't like the need to define a static variable on sub-classes. Below is a solution that avoids it by caching the instances in a static local variable to the factory method indexed by class name:

```
<?php
trait Singleton {

  # Single point of entry for creating a new instance. For a given
  # class always returns the same instance.
  public static function instance(){
    static $instances = array();
    $class = get_called_class();
    if( !isset($instances[$class]) ) $instances[$class] = new $class();
    return $instances[$class];
  }

  # Kill traditional methods of creating new instances
  protected function __clone() {}
  protected function __construct() {}
} 
```

Usage is the same as @jose-segura only no need for the static variable in sub-classes.

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-12-08T15:49:43.190

Database class that checks if there is any existing database instance it will return previous instance.

```
 class Database {  
        public static $instance;  
         public static function getInstance(){  
            if(!isset(Database::$instance) ) {  
                Database::$instance = new Database();  
            }  
           return Database::$instance;  
         }  
         private function __cunstruct() {  
           /* private and cant create multiple objects */  
         }  
         public function getQuery(){  
            return "Test Query Data";  
         }  
    }  
    $dbObj = Database::getInstance();  
    $dbObj2 = Database::getInstance();  
    var_dump($dbObj);  
    var_dump($dbObj2);  

/* 
After execution you will get following output: 

object(Database)[1] 
object(Database)[1] 

*/ 
```

Ref [http://www.phptechi.com/php-singleton-design-patterns-example.html](http://www.phptechi.com/php-singleton-design-patterns-example.html)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-01-02T08:21:56.983

**This is the example of create singleton on Database class**

design patterns 1) singleton

```
class Database{
  public static $instance;
  public static function getInstance(){
    if(!isset(Database::$instance)){
    Database::$instance=new Database();

     return Database::$instance;
    }

  }

  $db=Database::getInstance();
  $db2=Database::getInstance();
  $db3=Database::getInstance();

  var_dump($db);
  var_dump($db2);
  var_dump($db3); 
```

then out put is --

```
 object(Database)[1]
  object(Database)[1]
  object(Database)[1] 
```

use only single instance not create 3 instance

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-01-09T11:06:18.557

Quick example:

```
final class Singleton
{
    private static $instance = null;

    private function __construct(){}

    private function __clone(){}

    private function __wakeup(){}

    public static function get_instance()
    {
        if ( static::$instance === null ) {
            static::$instance = new static();
        }
        return static::$instance;
    }
} 
```

Hope help.

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-11-21T04:07:00.700

The above answers are ok, But I'll add more.

Whoever come here in 2021, I'll show another example of using `Singleton` Pattern class as a `trait` and Re-use this in any class.

```
<?php

namespace Akash;

trait Singleton
{
    /**
     * Singleton Instance
     *
     * @var Singleton
     */
    private static $instance;

    /**
     * Private Constructor
     *
     * We can't use the constructor to create an instance of the class
     *
     * @return void
     */
    private function __construct()
    {
        // Don't do anything, we don't want to be initialized
    }

    /**
     * Get the singleton instance
     *
     * @return Singleton
     */
    public static function getInstance()
    {
        if (!isset(self::$instance)) {
            self::$instance = new self();
        }

        return self::$instance;
    }

    /**
     * Private clone method to prevent cloning of the instance of the
     * Singleton instance.
     *
     * @return void
     */
    private function __clone()
    {
        // Don't do anything, we don't want to be cloned
    }

    /**
     * Private unserialize method to prevent unserializing of the Singleton
     * instance.
     *
     * @return void
     */
    private function __wakeup()
    {
        // Don't do anything, we don't want to be unserialized
    }
} 
```

So, use it like in any class easily. Suppose, we want to implement Singleton pattern in `UserSeeder` class.

```
<?php

class UserSeeder
{
    use Singleton;

    /**
     * Seed Users
     *
     * @return void
     */
    public function seed()
    {
        echo 'Seeding...';
    }
} 
```

* * *

## 回答 #22

> 赞同：-4
> 
> 时间：2013-02-01T11:54:52.580

Here's my example that provides ability to call as $var = new Singleton() and also creating 3 variables to test if it creates new object:

```
class Singleton{

    private static $data;

    function __construct(){
        if ($this::$data == null){
            $this->makeSingleton();
        }
        echo "<br/>".$this::$data;
    }

    private function makeSingleton(){
        $this::$data = rand(0, 100);
    }

    public function change($new_val){
        $this::$data = $new_val;
    }

    public function printme(){
        echo "<br/>".$this::$data;
    }

}

$a = new Singleton();
$b = new Singleton();
$c = new Singleton();

$a->change(-2);
$a->printme();
$b->printme();

$d = new Singleton();
$d->printme(); 
```

# jquery - JQuery：当前、格式良好、可打印的文档？

> ID：203340
> 
> 赞同：32
> 
> 时间：2008-10-15T00:35:54.413
> 
> 标签：jquery

我正在寻找当前 (1.2)、格式良好、可打印的 jQuery 文档版本。我检查了替代资源页面并查看了 CF 和 Java 的 PDF 版本，但两者都已过时。

jQuery 站点在工具箱中有带有“可打印版本”的 API 浏览器，但它的打印效果非常糟糕，我真的不想一次打印一个页面或选项卡。

我很难相信这种流行的工具没有打印文档——我想要的只是一个简单的清单，上面有描述和例子。

我错过了什么吗？

如果需要，我可以购买其中一本书，但不确定哪本书适合当前版本。

谢谢！

* * *

**更新：** 我可以看到有人投了反对票。我知道这是一个非常基本的问题，但不是轻率或轻率地问它。我已经付出了相当大的努力自己找到了这个，并且非常擅长在需要时查找信息。

也许认为这个问题不值得问的人知道在哪里可以找到打印文档？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-20T04:48:41.250

看看[这个页面](http://charupload.wordpress.com/2007/12/07/jquery-documentation-chm/)。

它为最新的 jQuery 1.3 编译了 html 帮助文件 (CHM)。

那家伙还编写了另一个有用的 CHM 手册。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T02:06:35.263

[http://www.amazon.com/jQuery-Action-Bear-Bibeault/dp/1933988355/ref=pd_bbs_sr_1?ie=UTF8&s=books&qid=1224036401&sr=8-1](https://rads.stackoverflow.com/amzn/click/com/1933988355)

和

[http://www.amazon.com/jQuery-Reference-Guide-Karl-Swedberg/dp/1847193811/ref=pd_sim_b_3](https://rads.stackoverflow.com/amzn/click/com/1847193811)

它不是文档，但如果在查看 jQuery 站点上的教程和参考资料时浏览器中的打印功能还不够，那么这些书肯定会。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T06:14:52.540

您也可以通过使用像[PediaPress](http://pediapress.com/)这样的服务来自己做一些工作，该服务专门将 MediaWiki 数据转换为打印形式。

jQuery API 是所有 MediaWiki，您可以编写一个简单的刮板来收集（只需查看“编辑”页面）。

[PediaPress 有一些代码](http://code.pediapress.com/wiki/wiki/mwlib)来解析用 Python 编写的 MediaWiki。有了它，您可以随心所欲地变换材料。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T02:21:50.380

网上有很多很好的 jQuery 备忘单。这是一个...

[http://www.gscottolson.com/jquery/jQuery1.2.cheatsheet.v1.0.pdf](http://www.gscottolson.com/jquery/jQuery1.2.cheatsheet.v1.0.pdf)

其中之一，之前参考的 Manning 书，以及优秀的在线文档让你很快成为专家。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-15T02:30:28.850

我上次检查时，所有*可打印*的jQuery 文档都已过时。这里有一个适用于 v1.1 的版本：

[http://www.bennadel.com/blog/544-Printing-The-Entire-jQuery-API-As-A-PDF-Using-CFDocument-And-XML-Parsing-.htm](http://www.bennadel.com/blog/544-Printing-The-Entire-jQuery-API-As-A-PDF-Using-CFDocument-And-XML-Parsing-.htm)

我不知道文档的任何*最新*版本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T05:11:24.657

我个人使用并更喜欢：[http ://colorcharge.com/wp-content/uploads/2007/12/jquery12_colorcharge.png](http://colorcharge.com/wp-content/uploads/2007/12/jquery12_colorcharge.png)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-25T16:03:32.507

[http://api.jquery.com/](http://api.jquery.com/)是我遇到的最好的参考，它的底部还有一个[可下载的应用程序，可以作为](http://api.jquery.com/update/jquery-api-browser-2.0.air)[Adob​​e AIR](http://www.adobe.com/products/air/)应用程序安装……非常方便。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T08:26:18.707

是的，我也对操作书中的 jquery 感到失望，通过 packt 学习 jquery 要好得多，但仍然没有涵盖最常见的需求，可能 john resig 需要自己写一本书。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-26T17:25:55.780

从 [http://roshanbh.com.np/2008/03/jquery-benefits-examples-free-ebook.html](http://roshanbh.com.np/2008/03/jquery-benefits-examples-free-ebook.html)你可以下载一个 chm，然后打印出来。链接在条目的末尾。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-05-26T23:51:36.283

[以下是一些 jQuery 备忘单](http://www.javascripttoolbox.com/jquery/cheatsheet/)，有多种可打印格式，并附有使用说明和示例。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-02-26T20:48:01.743

新的 ansewr，因为这是一个旧帖子，并且是我在这里找到的唯一帖子，[http://www.bennadel.com/resources/uploads/jquery_documentation.pdf](http://www.bennadel.com/resources/uploads/jquery_documentation.pdf)

# windows - 有什么方法可以检测 Windows 中的监视器状态（打开或关闭）？

> ID：203355
> 
> 赞同：23
> 
> 时间：2008-10-15T00:42:49.330
> 
> 标签：windows, winapi

有谁知道是否有 API 可以在 Windows (XP/Vista/2000/2003) 中获取当前监视器状态（打开或关闭）？

我所有的搜索似乎都表明没有真正的方法可以做到这一点。

[此线程](http://www.promixis.com/forums/archive/index.php/t-1282.html)尝试使用[GetDevicePowerState](http://msdn.microsoft.com/en-us/library/aa372690(VS.85).aspx)根据 Microsoft 的文档不适用于显示设备。

在 Vista 中，我可以收听[GUID_MONITOR_POWER_ON](http://msdn.microsoft.com/en-us/library/aa373195(VS.85).aspx)但手动关闭监视器时似乎没有收到事件。

在 XP 中，我可以连接`WM_SYSCOMMAND` `SC_MONITORPOWER`，寻找状态 2。这仅适用于系统触发断电的情况。

WMI`Win32_DesktopMonitor`类似乎也没有帮助。

**编辑**：这是关于 comp.os.ms-windows.programmer.win32[的讨论](http://groups.google.com/group/comp.os.ms-windows.programmer.win32/browse_thread/thread/6d3e0a0828e68b89/d095095f5244bab4?lnk=gst&q=GetDevicePowerState++monitor#d095095f5244bab4)，表明没有可靠的方法可以做到这一点。

还有其他人有其他想法吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-15T12:00:32.350

[GetDevicePowerState](https://msdn.microsoft.com/en-us/library/windows/desktop/aa372690%28v=vs.85%29.aspx) *有时*适用于监视器。如果存在，您可以打开`\\.\LCD`设备。完成后立即关闭它。

从本质上讲，你很不走运——没有可靠的方法来检测显示器的电源状态，除了编写设备驱动程序和过滤显示驱动程序链上下游的所有电源 IRP。这也不是很可靠。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-05T10:36:01.560

您可以连接一个网络摄像头，将其指向您的屏幕，然后对您收到的图像进行一些分析；）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-15T15:23:17.120

在根据监视器状态进行任何操作之前，请记住用户可以使用具有其他系统的远程桌面的机器，这些系统不需要将监视器连接到机器 - 所以不要关闭任何基于监视器状态的可视化。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-05T01:40:13.640

**你不能。**

看起来所有显示器电源功能都连接到**“电源安全模式”**
搜索后我在**[这里](http://cboard.cprogramming.com/showthread.php?p=755126)**找到了连接**SC_MONITORPOWER**消息和系统值的代码（帖子编号 2）
我使用代码来测试当我手动切换时系统值是否正在改变关闭显示器。

```
int main()
{
    for(;monitorOff()!=1;)
        Sleep(500);
    return 0;
}//main 
```

而且代码永远不会停止，无论我关闭显示器多久。
有monitorOff函数的代码：

```
int monitorOff()
{
    const GUID MonitorClassGuid =
        {0x4d36e96e, 0xe325, 0x11ce, 
            {0xbf, 0xc1, 0x08, 0x00, 0x2b, 0xe1, 0x03, 0x18}};

    list<DevData> monitors;
    ListDeviceClassData(&MonitorClassGuid, monitors);

    list<DevData>::iterator it = monitors.begin(),
                            it_end = monitors.end();
    for (; it != it_end; ++it)
    {
        const char *off_msg = "";

        //it->PowerData.PD_PowerStateMapping
        if (it->PowerData.PD_MostRecentPowerState != PowerDeviceD0)
        {
            return 1;
        }
    }//for

    return 0;
}//monitorOff 
```

**结论：**当您手动切换显示器时，**您无法通过 windows 捕捉到它**（如果没有异常的驱动程序接口），因为所有 windows 功能都连接到**“电源安全模式”**。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-08T23:30:14.697

在 Windows XP 或更高版本中，您可以使用 IMSVidDevice 接口。

请参阅 [http://msdn.microsoft.com/en-us/library/dd376775(VS.85).aspx](http://msdn.microsoft.com/en-us/library/dd376775(VS.85).aspx)

（不确定这是否适用于 Sever 2003）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-16T08:47:22.057

如果您的显示器有某种内置的 USB 集线器，您可以尝试使用它来检测显示器是否处于关闭/打开状态。
这当然只有在显示器被认为“关闭”时 USB 集线器没有保持连接时才有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-05-03T13:06:24.757

使用 Delphi 代码，您可以在待机过程中检测无效的监视器几何形状：

```
i := 0
('Monitor'+IntToStr(i)+': '+IntToStr(Screen.Monitors[i].BoundsRect.Left)+', '+
IntToStr(Screen.Monitors[i].BoundsRect.Top)+', '+
IntToStr(Screen.Monitors[i].BoundsRect.Right)+', '+
IntToStr(Screen.Monitors[i].BoundsRect.Bottom)) 
```

结果：

待机前监控几何：

```
Monitor0: 0, 0, 1600, 900 
```

在 Deplhi7 中待机时监控几何：

```
Monitor0: 1637792, 4210405, 31266576, 1637696 
```

在 DeplhiXE 中待机时监控几何图形：

```
Monitor0: 4211194, 40, 1637668, 1637693 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-07-07T09:19:11.743

这是一篇非常古老的帖子，但如果它可以帮助某人，我已经找到了一种检测屏幕是否可用的解决方案：Windows 的连接和配置显示器 (CCD) API。

它是的一部分，`User32.ddl`有趣的功能是`GetDisplayConfigBufferSizes`和`QueryDisplayConfig`。它为我们提供了可以在 windows 的配置面板中查看的所有信息。

特别是`PathInfo`包含具有标志的`TargetInfo`属性。`targetAvailable`到目前为止，该标志似乎已在我尝试过的所有配置上正确更新。

这使您可以了解连接到 PC 的每个屏幕的状态并设置它们的配置。

[这是.Net的CCD包装器](https://github.com/regueiro/CCDWrapper/tree/master/CCDWrapper)

# .net - 在 TabControl 的第一个和最后一个可见 TabItem 上设置样式

> ID：203358
> 
> 赞同：5
> 
> 时间：2008-10-15T00:44:56.847
> 
> 标签：.net, wpf, xaml, tabcontrol, tabitem

我想在 TabControl 中的第一个和最后一个 TabItems 上设置样式，并在 TabItems 的可见性更改时更新它们。我看不到使用触发器的方法。

我们追求的是这样的：

```
| > > > |
```

而 TabItems 的可见性是由绑定决定的。

我确实让它在代码中工作。在 TabItem 可见性更改时，通过 TabItems 枚举，直到找到第一个可见的。在那个上设置样式。对于所有其他可见的 TabItem，将它们设置为尖头样式（这样以前第一个可见的现在是尖头的）。然后从头开始，直到找到一个可见的 TabItem 并在该选项上设置最后一个样式。（这也让我们解决了 TabControl 的问题，如果没有选择任何可见的 TabItem，它将显示不可见的 TabItem 的内容。）

毫无疑问，我可以对我的方法进行改进，但我不相信这是正确的方法。

你会如何处理这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T20:08:03.893

请注意，当 TabControl 在视图中时，我们的 TabItems 的可见性不会受到影响，因此我们只能在 TabControl 可见性更改时应用样式。

```
私人无效面包屑_IsVisibleChanged（对象发送者，DependencyPropertyChangedEventArgs e）
{
        if ((bool)e.NewValue)
        {
            如果（发件人是 TabControl）
            {
                TabControl tabControl = (TabControl)sender;
                int firstVisible = -1;

                for (int i = 0; i -1) //如果是-1，它们都是不可见的
                    {

                        for (int i = tabControl.Items.Count - 1; i > firstVisible; i--)
                        {
                            TabItem tabItem = (TabItem)tabControl.Items[i];
                            if (tabItem.Visibility == Visibility.Visible)
                            {

                                tabItem.Style = (Style)FindResource("LastBreadcrumbTabItem");
                                休息;

                            }
                        }
                    }
                }
            }
        }

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T12:01:50.833

抱歉，到目前为止，您能否更好地解释一下，我已将您的问题解释为：

当在选项卡控件的开头和结尾在选项卡项目上更改可见性时，请应用特定的样式 - 即，如果它滚动看不到视图，然后更改样式？

如果是这样，那么当您添加 TabItems（以编程方式或在 wpf 中）时，您将需要在您希望处理的 TabItems 上实现 IsVisibleChanged 事件处理程序（即第一个和最后一个或全部？）

```
 public Window1()
    {
        InitializeComponent();

        this.myTabItem.IsVisibleChanged += new DependencyPropertyChangedEventHandler(myTabItem_IsVisibleChanged);
    }

    private void myTabItem_IsVisibleChanged(object sender, DependencyPropertyChangedEventArgs e)
    {
        myTabControl.Items[0].Style = FindResource("MyTabItemStyle") as Style;
    } 
```

如果您以编程方式将选项卡项添加到控件中，这很简单... :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-20T13:58:26.253

我采用了 silverlight tabcontrol 并使 tabitems 可滚动。这是帖子的链接。我想这就是你要找的。

[http://www.dansoltesz.com/post/2010/07/20/Silverlight-tabcontrol-with-scrollable-tabItems.aspx](http://www.dansoltesz.com/post/2010/07/20/Silverlight-tabcontrol-with-scrollable-tabItems.aspx)

# sql - Oracle PL/SQL 的单元测试框架？

> ID：203376
> 
> 赞同：24
> 
> 时间：2008-10-15T00:58:07.630
> 
> 标签：sql, oracle, unit-testing, plsql

[我已经看到了为MS SQL Server](https://stackoverflow.com/questions/202940/unit-tests-framework-for-databases)提出的问题（和答案），尽管我还不知道 Oracle 和 PL/SQL 的问题。Oracle 的 PL/SQL 是否有 xUnit 风格的测试框架？这些是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-15T01:02:07.293

最常用的大概是[utPLSQL](http://utplsql.org/)

该工具包的原作者现在为 Quest 工作，该公司拥有一个[商业 PL/SQL 单元测试应用程序](http://www.quest.com/code-tester-for-oracle/)。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-02-24T00:08:05.413

[SQL Developer](http://www.oracle.com/technology/products/database/sql_developer/index.html)的最后一个版本包括一个非常有趣的单元测试套件。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-11-27T14:22:10.883

我已经[使用 Ruby 库 ruby​​-plsql 创建并使用了 PL/SQL 单元测试框架](http://blog.rayapps.com/2009/11/27/oracle-plsql-unit-testing-with-ruby)。

它提供了比 utPLSQL 更短、更易读的测试，并且与 GUI 工具（如 Quest Code Tester 或 SQLDeveloper 2.1）相比提供了更大的灵活性。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-15T01:29:14.870

PLUTO 似乎很新，而且似乎没有很多文档。所以我担心你会通过大量的错误来让事情正常工作。utPLSQL 已经存在了很多年并且被广泛部署，所以有更多的错误修复和更多的人可以在你遇到问题时提供帮助。

此外，并非贬低任何人，但编写 utPLSQL 的 Steven Feuerstein 是世界上最知名的 PL/SQL 专家之一。虽然我确信 PLUTO 的作者是一位完全称职的开发人员，但我认为他的声誉远不及 Steven 所拥有的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-17T14:06:11.963

我在搜索 PL/SQL 单元测试框架时发现了这个问题。我发现了一篇[PLUTO 的开发人员对此提出异议的](http://en.oreilly.com/oscon2008/public/schedule/detail/3026)文章：

> ...有一些产品可以帮助 PL/SQL 程序员测试他们的代码。Quest Software 有一个名为 Code Tester for Oracle 的产品；然而，免费版本是 cripple-ware，而付费版本只是增加了一个障碍，让您不得不说服您的组织开始测试。还有一个 utPLSQL 项目在几年前就被放弃了，它开始遭受 bit rot 的困扰。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-09-16T04:56:22.580

我最近成功地使用了[PL/SQL Commons](http://code.google.com/p/plsql-commons/)工具包的单元测试框架（另见[作者的幻灯片](http://www.slideshare.net/areuser/plsql-commons-v10-6623604)）。该工具包尚未公开（在撰写本文时），但如果您向作​​者发送电子邮件，您将获得一个工作包（或者至少我得到了）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-15T01:04:55.497

我还找到了另一个库：[PLUTO](http://code.google.com/p/pluto-test-framework/) - 有没有人使用过这些并且可以比较/对比它们？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-12-01T19:01:27.967

我们使用 DBUnit。尽管开发人员需要学习一点 Java，但它可以很好地集成到 Cruise Control 等持续集成工具中。模板、实用程序和代码示例帮助我们的 pl/sql 开发人员快速上手。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-05T02:52:33.963

没有使用任何，但 utPLSQL 的最后一个 realese 是在 2005 年 7 月，因为作者与 oracle 的商业代码测试器相同（[http://www.quest.com/code-tester-for-oracle/](http://www.quest.com/code-tester-for-oracle/)）我不认为我们将来会看到很多 utPLSQL，所以我想我会抓住 PLUTO（2008）的机会

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-10-23T12:28:55.480

我看了所有这些，但我唯一喜欢的是[PLUnit](http://plunit.com/)。它的维护者似乎已经放弃了它（我不得不调整脚本以使其安装）。但是 API 非常简单，它不会尝试将 OOP/xUnit 方法强制用于 PL/SQL。

# c# - 获取枚举的最大值

> ID：203377
> 
> 赞同：170
> 
> 时间：2008-10-15T00:59:33.837
> 
> 标签：c#, enums

你如何获得枚举的最大值？

* * *

## 回答 #1

> 赞同：244
> 
> 时间：2008-10-15T01:05:10.003

Enum.GetValues() 似乎按顺序返回值，因此您可以执行以下操作：

```
// given this enum:
public enum Foo
{
    Fizz = 3, 
    Bar = 1,
    Bang = 2
}

// this gets Fizz
var lastFoo = Enum.GetValues(typeof(Foo)).Cast<Foo>().Last(); 
```

**编辑**

对于那些不愿意阅读评论的人：您也可以这样做：

```
var lastFoo = Enum.GetValues(typeof(Foo)).Cast<Foo>().Max(); 
```

...当您的某些枚举值为负时，这将起作用。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2013-07-12T15:30:25.263

我同意马特的回答。如果您只需要最小和最大 int 值，那么您可以按如下方式进行。

**最大：**

```
Enum.GetValues(typeof(Foo)).Cast<int>().Max(); 
```

**最低限度：**

```
Enum.GetValues(typeof(Foo)).Cast<int>().Min(); 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-08-20T00:52:28.590

根据马特汉密尔顿的回答，我想为它创建一个扩展方法。

由于`ValueType`不被接受为泛型类型参数约束，因此我没有找到更好的方法来限制`T`以下`Enum`内容。

任何想法都会非常感激。

PS。请忽略我的 VB 含蓄，我喜欢以这种方式使用 VB，这就是 VB 的优势，这就是我喜欢 VB 的原因。

Howeva，这里是：

## C＃：

```
static void Main(string[] args)
{
    MyEnum x = GetMaxValue<MyEnum>(); //In newer versions of C# (7.3+)
    MyEnum y = GetMaxValueOld<MyEnum>();  
}

public static TEnum GetMaxValue<TEnum>()
  where TEnum : Enum
{
     return Enum.GetValues(typeof(TEnum)).Cast<TEnum>().Max();
}

//When C# version is smaller than 7.3, use this:
public static TEnum GetMaxValueOld<TEnum>()
  where TEnum : IComparable, IConvertible, IFormattable
{
    Type type = typeof(TEnum);

    if (!type.IsSubclassOf(typeof(Enum)))
        throw new
            InvalidCastException
                ("Cannot cast '" + type.FullName + "' to System.Enum.");

    return (TEnum)Enum.ToObject(type, Enum.GetValues(type).Cast<int>().Last());
}

enum MyEnum
{
    ValueOne,
    ValueTwo
} 
```

## VB：

```
Public Function GetMaxValue _
    (Of TEnum As {IComparable, IConvertible, IFormattable})() As TEnum

    Dim type = GetType(TEnum)

    If Not type.IsSubclassOf(GetType([Enum])) Then _
        Throw New InvalidCastException _
            ("Cannot cast '" & type.FullName & "' to System.Enum.")

    Return [Enum].ToObject(type, [Enum].GetValues(type) _
                        .Cast(Of Integer).Last)
End Function 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-15T08:13:31.793

这有点挑剔，但 any 的实际最大值`enum`是`Int32.MaxValue`（假设它是`enum`派生自`int`）。`Int32`将 any值转换为 any是完全合法的`enum`，无论它是否实际声明了具有该值的成员。

合法的：

```
enum SomeEnum
{
    Fizz = 42
}

public static void SomeFunc()
{
    SomeEnum e = (SomeEnum)5;
} 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-11-03T08:19:49.130

再次尝试后，我得到了这个扩展方法：

```
public static class EnumExtension
{
    public static int Max(this Enum enumType)
    {           
        return Enum.GetValues(enumType.GetType()).Cast<int>().Max();             
    }
}

class Program
{
    enum enum1 { one, two, second, third };
    enum enum2 { s1 = 10, s2 = 8, s3, s4 };
    enum enum3 { f1 = -1, f2 = 3, f3 = -3, f4 };

    static void Main(string[] args)
    {
        Console.WriteLine(enum1.one.Max());        
    }
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-11-03T07:34:58.783

使用 Last 函数无法获得最大值。使用“max”函数即可。像：

```
 class Program
    {
        enum enum1 { one, two, second, third };
        enum enum2 { s1 = 10, s2 = 8, s3, s4 };
        enum enum3 { f1 = -1, f2 = 3, f3 = -3, f4 };

        static void Main(string[] args)
        {
            TestMaxEnumValue(typeof(enum1));
            TestMaxEnumValue(typeof(enum2));
            TestMaxEnumValue(typeof(enum3));
        }

        static void TestMaxEnumValue(Type enumType)
        {
            Enum.GetValues(enumType).Cast<Int32>().ToList().ForEach(item =>
                Console.WriteLine(item.ToString()));

            int maxValue = Enum.GetValues(enumType).Cast<int>().Max();     
            Console.WriteLine("The max value of {0} is {1}", enumType.Name, maxValue);
        }
    } 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-02-23T18:34:57.563

与 Matthew J Sullivan 一致，对于 C#：

```
 Enum.GetValues(typeof(MyEnum)).GetUpperBound(0); 
```

我真的不确定为什么有人会想使用：

```
 Enum.GetValues(typeof(MyEnum)).Cast<MyEnum>().Last(); 
```

...逐字逐句，从语义上讲，它似乎没有多大意义？（有不同的方式总是好的，但我看不到后者的好处。）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-09-03T22:57:55.610

在 System.Enum 下有一些方法可以获取有关枚举类型的信息。

因此，在 Visual Studio 的 VB.Net 项目中，我可以键入“System.Enum”。智能感知带来了各种各样的好处。

特别是一种方法是 System.Enum.GetValues()，它返回枚举值的数组。一旦你得到了数组，你应该能够做任何适合你特定情况的事情。

在我的例子中，我的枚举值从零开始并且没有跳过任何数字，所以要获得我的枚举的最大值，我只需要知道数组中有多少元素。

VB.Net 代码片段：

```
'''''''

Enum MattType
  zerothValue         = 0
  firstValue          = 1
  secondValue         = 2
  thirdValue          = 3
End Enum

'''''''

Dim iMax      As Integer

iMax = System.Enum.GetValues(GetType(MattType)).GetUpperBound(0)

MessageBox.Show(iMax.ToString, "Max MattType Enum Value")

''''''' 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-10-29T15:18:18.953

当我需要枚举的最小值和最大值时，我使用了以下内容。我只是将最小值设置为枚举的最小值，将最大值设置为枚举中的最大值作为枚举值本身。

```
public enum ChannelMessageTypes : byte
{
    Min                 = 0x80, // Or could be: Min = NoteOff
    NoteOff             = 0x80,
    NoteOn              = 0x90,
    PolyKeyPressure     = 0xA0,
    ControlChange       = 0xB0,
    ProgramChange       = 0xC0,
    ChannelAfterTouch   = 0xD0,
    PitchBend           = 0xE0,
    Max                 = 0xE0  // Or could be: Max = PitchBend
}

// I use it like this to check if a ... is a channel message.
if(... >= ChannelMessageTypes.Min || ... <= ChannelMessages.Max)
{
    Console.WriteLine("Channel message received!");
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-08-20T07:31:16.660

在 F# 中，使用辅助函数将枚举转换为序列：

```
type Foo =
    | Fizz  = 3
    | Bang  = 2

// Helper function to convert enum to a sequence. This is also useful for iterating.
// stackoverflow.com/questions/972307/can-you-loop-through-all-enum-values-c
let ToSeq (a : 'A when 'A : enum<'B>) =
    Enum.GetValues(typeof<'A>).Cast<'B>()

// Get the max of Foo
let FooMax = ToSeq (Foo()) |> Seq.max 
```

运行它...

```
> 类型 Foo = | 嘶嘶声 = 3 | 砰 = 2
> val ToSeq : 'A -> seq<'B> 当 'A : enum<'B>
> val FooMax : Foo = Fizz

```

定义时编译器`when 'A : enum<'B>`不需要 ，但 ToSeq 的任何使用都需要 ，即使是有效的枚举类型也是如此。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-01-20T10:39:21.130

它并非在所有情况下都可用，但我经常自己定义最大值：

```
enum Values {
  one,
  two,
  tree,
  End,
}

for (Values i = 0; i < Values.End; i++) {
  Console.WriteLine(i);
}

var random = new Random();
Console.WriteLine(random.Next((int)Values.End)); 
```

当然，当您在枚举中使用自定义值时，这将不起作用，但通常它可以是一个简单的解决方案。

# random - 是否存在无状态随机数生成器？

> ID：203382
> 
> 赞同：19
> 
> 时间：2008-10-15T01:02:45.657
> 
> 标签：random, prng, stateless

使用单个随机数生成器 (RNG) 生成多个数字与每个生成器生成一个数字并丢弃它之间有区别吗？两种实现都生成同样随机的数字吗？正常的 RNG 和安全的 RNG 之间有区别吗？

我有一个 Web 应用程序，它应该代表客户生成一个随机数列表。也就是说，从每个客户的角度来看，这些数字应该是随机的。这是否意味着我需要为每个客户端会话保留一个单独的随机 RNG？或者我可以在所有会话中共享一个 RNG 吗？或者我可以根据每个请求创建和丢弃 RNG 吗？

**更新**：这个问题与[随机序列的子集是否也是随机的有关？](https://stackoverflow.com/questions/471157/is-a-subset-of-a-random-sequence-also-random)

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-15T03:37:39.650

随机数生成器有一个状态——这实际上是一个必要的特性。下一个“随机”数字是前一个数字和种子/状态的函数。纯粹主义者称它们为伪随机数发生器。这些数字将通过随机性的统计测试，但实际上并不是随机的。

随机值的序列是有限的并且会重复。

将随机数生成器想象为对一组数字进行混洗，然后以随机顺序处理它们。种子用于“洗牌”数字。一旦设置了种子，数字序列就固定了，很难预测。有些种子会比其他种子更快地重复。

大多数生成器的周期足够长，没有人会注意到它重复。一个 48 位随机数生成器将在重复之前产生数千亿个随机数——使用 (AFAIK) 任何 32 位种子值。

当你给它一个种子并让它喷出值时，生成器只会生成类似随机的值**。**如果您更改种子，则使用新种子值生成的数字与前一个种子生成的值相比可能不是随机的——当您更改种子时，所有赌注都已关闭。所以不要。

一种合理的方法是拥有一个生成器并将数字“处理”给您的各种客户。不要混淆创建和丢弃生成器。不要乱换种子。

最重要的是，永远不要尝试编写自己的随机数生成器。大多数语言库中的内置生成器都非常好。尤其是使用超过 32 位的现代版本。

一些 Linux 发行版有一个`/dev/random`和`/dev/urandom`设备。您可以阅读这些内容来为您的应用程序的随机数生成器提供种子。这些具有或多或少的随机值，但它们通过从随机系统事件中“收集噪声”来工作。谨慎使用它们，因此在使用之间会有很多随机事件。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-15T01:04:52.033

我建议多次使用单个生成器。据我所知，所有的发电机都有一个状态。当您为生成器播种时，您将其状态设置为基于种子的某些内容。如果您不断产生新的种子，您选择的种子很可能不会像仅使用一个生成器生成的数字那样随机。

对于我使用过的大多数生成器来说尤其如此，它们使用当前时间（以毫秒为单位）作为种子。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-15T15:30:51.207

基于硬件的、真正的 [1] 随机数生成器是可能的，但不是微不足道的，而且通常具有较低的平均速率。可用性也可能是一个问题[2]。结合“随机数发生器”搜索“散粒噪声”或“放射性衰变”应该会返回一些命中。

这些系统不需要维护状态。可能不是你要找的。

正如其他人所指出的，软件系统只是伪随机的，并且**必须**保持状态。

一种折衷方案是使用基于硬件的 RNG 来提供熵池（存储状态），该池可用于播种 PRNG。这在 /dev/random [3] 和 /dev/urandom [4] 的 linux 实现中非常明确地完成。

这些是关于 /dev/random 熵池的默认输入到底有多随机的一些争论。

* * *

脚注：

1.  以我们对物理学的理解的任何问题为模
2.  因为你在等待一个随机的过程
3.  /dev/random 具有直接访问从被认为是真正或几乎随机的各种来源播种的熵池的功能，并在熵耗尽时阻塞
4.  /dev/urandom 类似于 /dev/random，但是当熵耗尽时，使用加密哈希，这使得熵池有效地成为有状态的 PRNG

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-15T01:06:57.783

如果您创建一个 RNG 并从中生成一个随机数，然后丢弃该 RNG，则生成的数字仅与用于启动 RNG 的种子一样随机。

最好创建一个 RNG 并从中提取许多数字。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-15T01:21:12.653

正如人们已经说过的，最好将 PRNG 播种一次，然后重复使用它。安全 PRNG 只是一种适用于加密应用程序的 PRNG。每次重新播种都会产生合理随机结果的唯一方法是它来自真正随机的“现实世界”来源 - 即专用硬件。即使这样，来源也可能有偏差，理论上使用相同的 PRNG 仍然会更好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-15T01:32:06.173

通常，对于严重的 PRNG，播种新状态需要相当长的时间，并且每次都创建新状态并没有太大帮助。我能想到的唯一情况是您可能需要多个 PRNG 用于不同的系统，例如在赌场游戏中，您有一个用于洗牌的生成器和一个用于生成由计算机控制角色完成的评论的单独的生成器，这种方式真的很专注用户无法根据角色行为猜测结果。

播种的一个很好的解决方案是使用[这个（Random.org）](http://www.random.org/integers/)，它们免费提供从大气噪声生成的随机数。它可能是比使用时间更好的播种来源。

编辑：在你的情况下，我肯定会为每个客户端使用一个 PRNG，如果没有其他原因，只是为了良好的编程标准。无论如何，如果您在客户之间共享一个 PRNG，您仍然会为每个客户提供伪随机值，其质量等于您的 PRNG 的质量。所以这是一个可行的选择，但似乎是一个糟糕的编程策略

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-15T06:00:14.230

值得一提的是，Haskell 是一种试图完全消除可变状态的语言。为了使这一目标与 IO 等硬性要求（需要某种形式的可变性）相协调，必须使用 monad 将状态从一个计算线程化到下一个计算。通过这种方式，Haskell 实现了它的伪随机数生成器。严格来说，生成随机数本质上是有状态的操作，但是 Haskell 能够通过将状态“突变”移动到 bind( `>>=`) 操作中来隐藏这个事实。

这可能听起来有点抽象，并不能真正完全回答您的问题，但我认为它仍然适用。从理论上讲，在不涉及状态的情况下使用 RNG 是不可能的。无论如何，有一些技术可以用来减轻这种交互并使其*看起来*好像整个操作是无状态的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-15T01:14:24.947

通常最好创建一个 PRNG 并从中提取多个值。创建多个实例意味着您需要确保实例的种子是唯一的，这需要合并特定于实例的信息。

顺便说一句，有更好的“真实”随机数发生器，但它们通常需要专门的硬件来执行诸如从计算机内部的电信号变化中获取随机数据之类的事情。除非你真的很担心，否则我想说语言库和/或操作系统中内置的伪随机数生成器可能就足够了，只要你的种子值不容易预测。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-22T00:39:36.027

安全 PRNG 的使用取决于您的应用程序。随机数有什么用？如果它们是真正有价值的东西（例如任何与密码相关的东西），你就不想使用更少的东西。

安全 PRNG 速度要慢得多，并且可能需要库进行任意精度的操作，以及素数测试等......

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2008-10-15T01:04:42.767

好吧，只要每次创建它们的种子都不同，那么不，我认为不会有任何区别；但是，如果它取决于时间之类的东西，那么由于种子有偏差，它们可能会不一致。

# naming-conventions - 由具有布尔值的 id 索引的数组的最佳名称

> ID：203383
> 
> 赞同：2
> 
> 时间：2008-10-15T01:03:28.400
> 
> 标签：naming-conventions, variables

我痴迷于我使用的数组和变量的最佳名称，我会在同义词库、字典等中查找单词。

所以我试图命名这个数组/结构：

```
$nameMe = array(
    '392' => TRUE,
    '234' => TRUE,
    '754' => TRUE,
    '464' => TRUE,
); 
```

它用于检查该 id 是否具有特定属性，就像这样

```
if(isset($name[$id])) {
    doSomething();
} 
```

问题是我得到了很长的变量名，比如

```
$propertyNameArrayIdIndexed 
```

关于如何更好地命名数组的这个特定函数的任何想法？或更好的名字

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T01:15:21.607

```
$hasProperty[$id] 
```

或者

```
$isSomething[$id] 
```

究竟是什么属性？

```
$isOdd[$id]
$isWriteable[$id]
$hasAssociatedFile[$id] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T01:11:06.933

长变量名没有错，只要它们描述变量正在做什么，而不是它是如何声明或定义的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-15T01:13:58.380

我会从变量名中删除“数组”。

使用数组的函数可以命名为：

IsPropertyAvailable?($id)

要不就

是否可用？($id)

正确封装时。

因此可以命名用于查询的关联数据结构

$availableIds

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T01:14:41.200

你希望你的代码读起来尽可能像简单的英语。用简单的英语，你最终会得到类似的东西；

If the car is red 做红车的事

所以我的建议是避免在变量的命名中引入不必要的计算机语言（'array'、'property'、'index'等）。您的编程语言正在对您强加“isset”。很好，这清楚地表明你有一个布尔数组，意味着你可以简单地说；

if( isset(red[car_idx]) ) dosomething();

摘要：我认为数组应该简单地命名为您要测试的属性。如果属性的名称是一个很好的英语形容词，无论是否适用于名词，那么即使没有 isset()，数组的布尔性质也是显而易见的。如此简单；

红色[]、长方形[]、大[]

不是 IsRed[]、IsOblong[]、IsLarge[]，因为除了 isset() 中的那个之外，额外的“Is”是多余的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-15T01:39:31.243

通过它们的“角色”（在 UML 意义上）而不是它们的类型来命名变量。因此，变量的正确名称应该很大程度上取决于它的使用位置和使用方式。仅仅知道数据结构的类型不足以给它一个恰当的名字。因此，假设您有一个属性枚举，每个属性都可以作为图标呈现。我会省略任何类型的指示，并将其声明为`Set<Property> displayableIcons`.

即使您使用的是匈牙利表示法，实际类型也不应该是名称的一部分，但是一些类型限定符或非正式子类型的指示是可以的，例如`String b64JpgMugshot`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-15T01:07:40.280

属性命名，IspropertyNameable。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-15T01:20:56.117

你的数组只包含`true`吗？如果是这样，我会说将您的数据结构更改为以下内容：

```
$availableIds = array(392, 234, 754, 464); 
```

然后你的`if`陈述更有意义：

```
if (in_array($myId, $availableIds)) { ... } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-15T01:50:21.690

我只是使用 dah[]。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-15T02:00:11.903

I would agree with other commenters that the question seems to lack proper context for proper concise naming, but something generic like able['foo'], enabled['bar'] or ready['ack'] may work.

# .net - 如何判断 Windows 何时处于非活动状态

> ID：203384
> 
> 赞同：10
> 
> 时间：2008-10-15T01:04:15.403
> 
> 标签：.net, windows

各种程序只有在您有一段时间没有使用计算机时才能发挥作用（例如屏幕保护程序、Google 桌面索引等）。

他们怎么知道它何时处于非活动状态？Windows 中是否有一些功能可以告诉您它已停用多长时间，或者您是否必须使用某种键盘/鼠标挂钩来自己跟踪活动？

我正在使用 C#，但我对任何确定不活动状态的方法都感兴趣。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-15T01:18:25.687

编辑：更改答案，提供害羞答案背后的文本和细节（应该并且被接受）。随意合并和删除这个。

[GetLastInputInfo](http://pinvoke.net/default.aspx/user32/GetLastInputInfo.html)函数 GetLastInputInfo 函数检索最后输入事件的时间。

从 P/Invoke 粘贴到这里

此函数检索自上次用户输入以来的时间

```
[DllImport("user32.dll")]
static extern bool GetLastInputInfo(ref LASTINPUTINFO plii);

static int GetLastInputTime()
{
    int idleTime = 0;
    LASTINPUTINFO lastInputInfo = new LASTINPUTINFO();
    lastInputInfo.cbSize = Marshal.SizeOf( lastInputInfo );
    lastInputInfo.dwTime = 0;

    int envTicks = Environment.TickCount;

    if( GetLastInputInfo( ref lastInputInfo ) )
    {
    int lastInputTick = lastInputInfo.dwTime;

    idleTime = envTicks - lastInputTick;
    }

    return (( idleTime > 0 ) ? ( idleTime / 1000 ) : idleTime );
}

[StructLayout( LayoutKind.Sequential )]
struct LASTINPUTINFO
{
    public static readonly int SizeOf = Marshal.SizeOf(typeof(LASTINPUTINFO));

    [MarshalAs(UnmanagedType.U4)]
    public int cbSize;    
    [MarshalAs(UnmanagedType.U4)]
    public UInt32 dwTime;
} 
```

~~FWIW：我在 AnAppADay 期间实现了一个全局键盘和鼠标挂钩。请参阅此应用程序以获取源代码 - 它非常接近您想要的。您需要的类位于 AnAppADay.Utils 命名空间中。~~ [由于linkrot而划伤]

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-15T01:12:41.347

[谷歌是你的朋友](http://dataerror.blogspot.com/2005/02/detect-windows-idle-time.html)

基本上就是这样用[的。](http://msdn.microsoft.com/en-us/library/ms646302.aspx)
使用前不要忘记完全准备好文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T01:14:24.400

键盘和鼠标挂钩是我认为最有价值的东西。可以插入下面的类，你只需要弄清楚你想用关于键和鼠标更新的信息做什么。

```
using System;
using System.Runtime.InteropServices;
using System.Threading;
using System.Windows.Forms;

namespace Example {

    public class Hook {

        delegate int HookProc(int nCode, IntPtr wParam, IntPtr lParam);

        [FlagsAttribute]
            public enum WindowMessage {
            WM_KEYDOWN =        0x0000000000000100, // &H100
            WM_MOUSEMOVE =      0x0000000000000200, // &H200
            WM_LBUTTONDOWN =    0x0000000000000201, // &H201
            WM_RBUTTONDOWN =    0x0000000000000204,  // &H204
            WH_KEYBOARD = 2,
            WH_MOUSE = 7,
            HC_ACTION = 0
        }

        [DllImport("user32.dll",CharSet=CharSet.Auto, CallingConvention=CallingConvention.StdCall)]
        private static extern int CallNextHookEx(int idHook, int nCode, IntPtr wParam, IntPtr lParam);

        [DllImport("user32.dll",CharSet=CharSet.Auto, CallingConvention=CallingConvention.StdCall)]
        private static extern bool UnhookWindowsHookEx(int idHook);

        [DllImport("user32.dll",CharSet=CharSet.Auto, CallingConvention=CallingConvention.StdCall)]
        private static extern int SetWindowsHookEx(int idHook, HookProc lpfn, IntPtr hInstance, int threadId);

        //Declare MouseHookProcedure as a HookProc type.
        static HookProc MouseHookProcedure;
        static HookProc KeyboardHookProcedure;

        private static int  mhMouseHook = 0;
        private static int  mhKeyboardHook = 0;

        public Hook() {}

        public static void Init() {
            MouseHookProcedure = new HookProc( MouseHookProc );
            KeyboardHookProcedure = new HookProc( KeyboardHookProc );
            mhMouseHook = SetWindowsHookEx( (int)WindowMessage.WH_MOUSE, MouseHookProcedure, (IntPtr)0, AppDomain.GetCurrentThreadId() );
            mhKeyboardHook = SetWindowsHookEx( (int)WindowMessage.WH_KEYBOARD, KeyboardHookProcedure, (IntPtr)0, AppDomain.GetCurrentThreadId() );
        }

        public static void Terminate() {
            UnhookWindowsHookEx( mhMouseHook );
            UnhookWindowsHookEx( mhKeyboardHook );
        }

        private static int MouseHookProc( int nCode, IntPtr wParam, IntPtr lParam ) {
            if ( nCode >= 0 ) {
                //do something here to update the last activity point, i.e. a keystroke was detected so reset our idle timer.
            }
            return CallNextHookEx( mhMouseHook, nCode, wParam, lParam );
        }

        private static int KeyboardHookProc( int nCode, IntPtr wParam, IntPtr lParam ) {
            if ( nCode >= 0 ) {
                //do something here to update the last activity point, i.e. a mouse action was detected so reset our idle timer.
            }
            return CallNextHookEx( mhKeyboardHook, nCode, wParam, lParam );
        }

    }
} 
```

当然，这只适用于您正在挂钩的应用程序。如果您需要跟踪整个系统的不活动状态，则需要创建一个可以加载到所有其他窗口的地址空间中的 DLL。不幸的是，我还没有听说过任何允许 .net 编译的 .dll 在这种情况下工作的 hack；我们有一个为此目的而挂钩的 C++ DLL。

# c# - Visual Studio 中的上下文帮助

> ID：203397
> 
> 赞同：4
> 
> 时间：2008-10-15T01:10:14.690
> 
> 标签：c#, visual-studio, visual-studio-2008, helpfile

有没有办法更改 Visual Studio 中的上下文相关帮助，以便它只搜索插入符号下的文本，而不是代码中的编译错误？

更多信息：编译并收到编译错误（下划线）后，将插入符号放在带下划线的文本中并按下`F1`将带您进入编译错误页面，而不是插入符号下的函数帮助。可以将此行为更改为始终转到方法/关键字帮助吗？

语言：C#

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-17T08:20:13.243

我找到的唯一解决方案是修复编译错误；-)

一种解决方法是**使用“动态帮助”窗口**（来自帮助菜单或`CTRL`- `F1`, `D`），编译错误位于列表顶部，但通常的项目将在下一个列出。

对于那些不理解这个问题的人，这里有一个微不足道的、不切实际的例子：

```
int myInt = new int(3); 
```

一旦你下线，'new int(3);' bit 带有红色下划线，但如果您选择第二个 'int' 并按`F1`，您将获得有关声明整数的帮助。

但是，如果您编译它，有问题的部分会用一条摆动的蓝线加下划线，然后选择“int”并按下`F1`可以帮助您解决编译错误。这不仅仅是焦点移动到错误列表窗口的情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T01:26:32.473

如果我记得，编译后，默认选择的窗口是消息（错误列表）之一。如果您点击`F1`此处，您将获得有关错误消息的帮助。但是如果您选择代码窗口，您将获得有关所选文本的帮助。

这是你正在经历的行为吗？？？

# mysql - 您如何为 MySQL 和 Postgres 编写不区分大小写的查询？

> ID：203399
> 
> 赞同：64
> 
> 时间：2008-10-15T01:10:29.273
> 
> 标签：mysql, ruby-on-rails, database, postgresql, heroku

我在本地运行 MySQL 数据库进行开发，但部署到使用 Postgres 的 Heroku。Heroku 几乎可以处理所有事情，但我不区分大小写的 Like 语句变得区分大小写。我可以使用 iLike 语句，但我的本地 MySQL 数据库无法处理。

编写与 MySQL 和 Postgres 兼容的不区分大小写查询的最佳方法是什么？或者我是否需要根据我的应用程序正在与之交谈的数据库编写单独的 Like 和 iLike 语句？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-10-11T14:47:06.707

这个故事的寓意是：不要使用不同的软件堆栈进行开发和生产。绝不。

您最终会遇到无法在开发中重现的错误；你的测试将毫无价值。只是不要这样做。

使用不同的数据库引擎是不可能的 - 会有更多的情况下它的行为与 LIKE 不同（另外，您是否检查过数据库使用的排序规则？它们在每种情况下都相同吗？如果不是，你可以忘记在 varchar 列上的 ORDER BY 工作相同）

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2008-10-15T01:16:19.450

```
select * from foo where upper(bar) = upper(?); 
```

如果在调用者中将参数设置为大写，则可以避免第二次函数调用。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2012-04-13T23:15:00.760

使用阿雷尔：

```
Author.where(Author.arel_table[:name].matches("%foo%")) 
```

`matches`将对`ILIKE`Postgres 和`LIKE`其他所有内容使用运算符。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-15T01:21:33.170

在 postgres 中，你可以这样做：

```
SELECT whatever FROM mytable WHERE something ILIKE 'match this'; 
```

我不确定是否有 MySQL 的等价物，但你总是可以这样做，这有点难看，但应该在 MySQL 和 postgres 中都可以工作：

```
SELECT whatever FROM mytable WHERE UPPER(something) = UPPER('match this'); 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-06-20T12:14:25.847

有几个答案，没有一个是非常令人满意的。

*   **LOWER(bar) = LOWER(?)**将在 MySQL 和 Postgres 上*工作*，但可能*在 MySQL 上执行得非常糟糕*：由于 LOWER 函数，MySQL 不会使用它的索引。在 Postgres 上，您可以添加功能索引（在**LOWER(bar)**上），但 MySQL 不支持此功能。
*   MySQL 将（除非您设置了区分大小写的[排序规则](http://dev.mysql.com/doc/refman/5.0/en/case-sensitivity.html)）自动进行不区分大小写的匹配，并使用其索引。（**酒吧=？**）。
*   从数据库外部的代码中，维护**bar**和**bar_lower**字段，其中 bar_lower 包含**lower(bar)**的结果。（这也可以使用数据库触发器）。（请参阅[Drupal](http://drupal.org/node/83738)上对此解决方案的讨论）。这很笨拙，但至少在几乎每个数据库上都以相同的方式运行。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-07-31T22:30:01.820

REGEXP 不区分大小写（除非与 BINARY 一起使用），并且可以像这样使用...

```
 SELECT id FROM person WHERE name REGEXP 'john'; 
```

...匹配“John”、“JOHN”、“john”等。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-03-05T16:19:33.533

如果您使用的是 PostgreSQL 8.4，您可以使用[citext](http://developer.postgresql.org/pgdocs/postgres/citext.html)模块来创建不区分大小写的文本字段。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-04-27T15:37:46.520

使用整理。

[http://dev.mysql.com/doc/refman/5.0/en/case-sensitive.html](http://dev.mysql.com/doc/refman/5.0/en/case-sensitivity.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-10-11T14:41:45.797

您也可以考虑查看[searchlogic](http://github.com/binarylogic/searchlogic)插件，它为您执行[LIKE/ILIKE](http://github.com/binarylogic/searchlogic/blob/master/lib/searchlogic/named_scopes/conditions.rb#L89)切换。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-01-12T00:59:18.337

如果要匹配块中的子字符串，也可以在 postgres 中使用 ~*。~ 匹配区分大小写的子字符串，~* 不区分大小写的子字符串。这是一个缓慢的操作，但我可能会发现它对搜索有用。

```
Select * from table where column ~* 'UnEvEn TeXt';
Select * from table where column ~ 'Uneven text'; 
```

两者都会点击“Some Uneven text here” 只有前者会点击“Some UNEVEN TEXT here”

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-05T18:19:05.423

转换为 upper 是最好的，因为它涵盖了 3 个最常用的 Rails 数据库后端的兼容语法。PostgreSQL、MySQL 和 SQLite 都支持这种语法。它有一个（小）缺点，您必须在应用程序或条件字符串中将搜索字符串大写，这使它有点难看，但我认为您获得的兼容性使其值得。

MySQL 和 SQLite3 都有一个不区分大小写的 LIKE 运算符。只有 PostgreSQL 有一个区分大小写的 LIKE 运算符和一个 PostgreSQL 特定的（根据手册）ILIKE 运算符，用于不区分大小写的搜索。您可以在 Rails 应用程序的条件中指定 ILIKE 而不是 LIKE，但请注意该应用程序将停止在 MySQL 或 SQLite 下工作。

第三种选择可能是检查您正在使用的数据库引擎并相应地修改搜索字符串。这可能通过侵入/monkeypatching ActiveRecord 的连接适配器并让 PostgreSQL 适配器修改查询字符串以在查询执行之前用“LIKE”替换“ILIKE”来更好地完成。然而，这个解决方案是最复杂的，并且考虑到像大写这两个术语这样更简单的方法，我认为这不值得努力（尽管这样做你会得到很多布朗尼点）。

# visual-studio-2008 - 您如何在发布构建期间自动部署网站？

> ID：203421
> 
> 赞同：5
> 
> 时间：2008-10-15T01:19:15.280
> 
> 标签：visual-studio-2008, deployment, msbuild, build-process, ftp

在 Visual Studio 2008 中进行发布构建时，我想上传（通过 ftp）一个网站。我不希望上传任何源代码文件，最好配置应该上传哪些文件夹。我正在使用 ASP.NET Web 应用程序或 MVC。如何配置 VS.NET 以自动上传（和覆盖）最后部署的网站？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T01:31:31.057

您可以使用 Microsoft 的[Visual Studio Web 部署项目](http://www.microsoft.com/downloads/details.aspx?FamilyId=0AA30AE8-C73B-4BDD-BB1B-FE697256C459&displaylang=en)加载项。

我将它与 MSBuild 一起用作 CruiseControl 的一部分，它非常好，并且通过[MS Build 的一些社区任务，](http://msbuildtasks.tigris.org/)您可以将 *.config（或任何 XML 文件）替换作为构建过程的一部分。

编辑：我还看到 MSBuild 社区任务包含一个 FtpUpload 操作。这应该正是您所需要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T00:42:42.233

好吧，事实证明，最简单的方法是使用 VS.NET 中内置的“发布”功能。
右键单击项目，然后单击发布。它将为您构建和部署项目。它显然不像使用 MSBuild 或 Nant 那样可定制，但它确实有一些选项： ![发布屏幕](https://i.stack.imgur.com/KR7Wu.png)

我以前使用过此功能，但不知何故我认为它仅适用于“网站”项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T01:41:38.183

或者你可以使用 nant

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-06T16:21:05.297

Nant 没有 ftp 任务。[在这里](http://www.digizzle.com/Projects/FtpTask/Default.aspx)，我找到了最方便、非常轻便、完美的解决方案。奇怪为什么没有它的端口到 nant。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-07T11:52:30.117

这个问题有点老了，但我建议您为此使用[MSDeploy](http://www.iis.net/expand/WebDeploymentTool)。如果您愿意，您还可以使用[WDP](http://www.microsoft.com/downloads/details.aspx?FamilyId=0AA30AE8-C73B-4BDD-BB1B-FE697256C459&displaylang=en)为您进行 ASP.NET 编译和合并。MSDeploy 的伟大之处在于您可以在目标机器上安装 MSDeploy 远程代理服务。然后，当您执行同步时，它将确定哪些文件已过期并仅发送这些文件。因此节省您的时间和带宽。您还可以在部署站点时执行转换。它也很容易部署到许多不同的服务器。我有一个关于 MSDeploy 的在线视频，更多信息请访问[http://sedodream.com/2009/10/27/MSDeployPresentationMaterials.aspx](http://sedodream.com/2009/10/27/MSDeployPresentationMaterials.aspx)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-07T11:55:36.967

*免责声明：我写了这个*

我用我写的东西，dashy： http: [//www.mirios.com.au/dashy](http://www.mirios.com.au/dashy)

但是不要轻易使用它，因为你需要有：

1.  源代码控制（目前仅限于 SVN）
2.  CI 服务器（Cruise Control 或 Hudson 或其他）
3.  能够将软件安装到您希望部署到的服务器上
4.  耐心设置一切
5.  有点信任，因为它仍在开发中:)

随意给它一个裂缝，但是，目前，我不推荐它用于任何关键的事情。

# java - 使用 swing 的 MaskFormatter 的电子邮件掩码是什么

> ID：203422
> 
> 赞同：0
> 
> 时间：2008-10-15T01:19:36.497
> 
> 标签：java, swing, mask

使用 Java swing，使用 时对应于正确电子邮件掩码的字符串是什么[`MaskFormatter`](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/text/MaskFormatter.html)？真的有可能将 a`MaskFormatter`用于电子邮件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T02:20:31.223

尽管使用 MaskFormatter 确实很有意义，但我认为这不是最合乎逻辑的答案。因为电子邮件地址的长度在@ 符号前后会有很大差异。因此，您可以在 @ 符号前后给 MaskFormatter 一个巨大的上限，即 255 *，但这会产生一些可怕的代码。我建议在提交时[验证电子邮件地址](http://www.javapractices.com/topic/TopicAction.do?Id=180)或类似的东西。希望有帮助。

# php - 在 ASP 中是否有用于附加到字符串变量的运算符？

> ID：203425
> 
> 赞同：2
> 
> 时间：2008-10-15T01:20:59.707
> 
> 标签：php, vbscript, operators

`.=`连接字符串时，与 PHP 等效的 ASP 是什么？我指的是 asp 而不是 asp.net。

我的意思是指定我在一个for循环中。所以我想知道`.=`（在php中）不是标准连接的等价物。

*例子：*

```
For Each Item In Request.Form
    If (Item = "service") then 
        For x=1 To Request.Form(item).Count
            service = "&service="&Request.Form(Item)(x)
        Next
    End If
Next 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-15T01:22:11.450

在 VBScript 中：

```
Variable = Variable & "something more" 
```

在 JScript 中，我相信您可以使用：

```
variable += "something more"; 
```

具体来说：

```
service = service & "&service=" & Request.Form(Item)(x) 
```

假设你希望你的结果看起来像......

```
&service=blah1&service=blah2&service=blah3 
```

尽管您可能需要对您的 Request.Form(Item)(x) 值进行 URL 编码，因为任何“&”（和其他字符）都可能真正搞砸您正在尝试做的事情。在直接从 HTML 表单中使用未经处理的输入时也要小心，这非常危险。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-15T01:25:26.203

我不能确定，但​​ &= 应该在 ASP 中工作。我知道它适用于 VB.Net。虽然我不记得这在 asp 中是否有效。如果这不起作用，唯一的解决方案是 a = a & b。

# sql-server - SQL DTS 数据库复制失败

> ID：203442
> 
> 赞同：2
> 
> 时间：2008-10-15T01:30:57.517
> 
> 标签：sql-server, sql-server-2000, dts

大家好，我一直在研究这个问题一段时间，通常的谷歌搜索没有帮助:(

我在 SQL 2000 中有一个生产数据库。我想将它复制到训练数据库的顶部以刷新它。我希望这是计划每周发生一次的事情，以使培训数据库保持最新。

我为此创建了一个 DTS 工作。在该 DTS 作业中，我有一个“复制 SQL Server 对象”任务。该任务设置为：

*   创建所有复制的对象
    *   首先删除目标对象
*   复制数据
    *   替换现有数据
*   复制索引、触发器、主键和外键
*   复制所有用户表、视图、函数和存储过程。

当我运行这个 DTS 包时（当然是在预生产中进行测试），它完成了 99% 并抛出以下错误：

```
Step Error Source: Microsoft SQL-DMO (ODBC SQLState: 42S02)
Step Error Description:[Microsoft][ODBC SQL Server Driver][SQL Server]Invalid object name 'dbo.vwEstAssetStationAddress'.
Step Error code: 800400D0
Step Error Help File:SQLDMO80.hlp
Step Error Help Context ID:1131 
```

我在网上搜索并没有提供太多帮助。有报道称这些错误会受到影响，但似乎没有一个符合我的情况。我发现的一个建议是 sysdepends 表已损坏，导致 DTS 作业以错误的顺序运行其脚本。但是，我运行了以下脚本来更正该表，但它仍然抛出相同的错误：

```
USE master
GO
ALTER DATABASE [DATABASE NAME]
SET SINGLE_USER
GO

USE [DATABASE NAME]
GO

DBCC CHECKTABLE('sysdepends',REPAIR_REBUILD )
GO

USE master
GO
ALTER DATABASE [DATABASE NAME]
SET MULTI_USER
GO 
```

我还看到拥有不同的对象所有者可能会导致此错误。但我已经确认，在这种情况下，这些对象都归 dbo 用户所有。

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T04:10:09.770

我觉得很愚蠢，但我将我刚刚找到的答案发布给后代（所以所有有帮助的人都可以停止代表我的压力。

即使我选择了所有要复制的用户表、视图、存储过程和用户​​定义的函数，我也没有选择“包括所有依赖对象”。我曾假设如果您选择两个对象进行复制，并且一个依赖于另一个，SQL 将始终以正确的顺序执行它们。显然不是。选择这个小复选框让一切变得不同。

再次感谢那些提供建议的人

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T01:58:52.530

不知何故，您的 DTS 包找不到 dbo.vwEstAssetStationAddress 表。不幸的是，该消息没有说明它是在源还是目标上找不到它。

按照您在 DTS 包中的顺序，具体步骤是什么？我假设上面的任务项列表不按顺序排列。我知道这不是答案，但看起来我们需要更多信息来进一步帮助您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T02:12:57.980

感谢您的回复 hectorsosajr。

导致错误的对象 (dbo.vwEstAssetStationAddress) 是一个引用 2 个基础表的视图。我已经测试了在源数据库和目标数据库上查询视图以及运行定义它的 SELECT 语句，它工作正常。

DTS 中的数据库对象复制任务不允许您指定它传输事物的顺序。据我了解，它使用 sysdepends 表来确定必要的事件顺序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T02:41:07.143

听起来它正在尝试基于尚不存在的视图创建存储过程/视图。

为什么不以不同的名称备份和恢复数据库？（如果不是生产，我会说分离、复制和重新附加）。您可以在 T-SQL 的控制下完成所有这些工作。

看看[这个链接](https://sqlblog.org/2008/09/09/keeping-sysdepends-up-to-date-in-sql-server-2008)是否能帮助你找到你的依赖问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-15T02:52:07.137

我试图避免通过备份/恢复来做到这一点。有一些数据库用户是 SQL Server 帐户（不是 Active Directory）。这变得很痛苦，但是如果您需要从一台服务器到另一台服务器，因为您必须删除这些用户并重新创建它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-15T03:47:00.863

我已经运行了另一个测试来尝试隔离它。我完全从目标数据库中删除了上述视图，然后再次运行 DTS。它因同样的错误而失败。但是，显然是无效对象名称的视图已成功重新创建。似乎错误来自试图引用该视图的某些东西，但当它遇到该错误时它实际上并没有停止脚本。

凯德 - 我会检查那个链接。我还将尝试确定引用视图和破坏的内容。

# outlook - MAPI：PR_SEARCH_KEY 的格式

> ID：203446
> 
> 赞同：0
> 
> 时间：2008-10-15T01:33:28.073
> 
> 标签：outlook, exchange-server, mapi, msg

有谁知道 MAPI 属性的格式`PR_SEARCH_KEY`？

[在线文档](http://msdn.microsoft.com/en-us/library/ms529414(EXCHG.10).aspx)对此有这样的说法：

> 搜索关键字由地址类型（大写字符）、冒号“:”、规范形式的电子邮件地址和终止空字符组成。

交换文件[MS-OXOABK](http://msdn.microsoft.com/en-us/library/cc433489(EXCHG.80).aspx)是这样说的：

> PtypBinary 类型的 PidTagSearchKey 属性是一个二进制值，它由 ASCII 字符串“EX:”后跟转换为全大写的对象的 DN，后跟零字节值连接而成。

然而，我在这个属性中看到的所有 MAPI 消息都将它作为某种二进制 16 字节序列，看起来像一个 GUID。还有其他人有关于它的更多信息吗？它总是16字节吗？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T20:52:16.627

我相信`PR_SEARCH_KEY`对于不同的对象，该属性将具有不同的格式（正如 Moishe 所暗示的）。

MAPI 消息对象将在创建 时分配一个唯一值`PR_SEARCH_KEY`，但是如果复制该对象，该属性值也会被复制。我想当您回复电子邮件时，Exchange 会将`PR_SEARCH_KEY`值分配为原始邮件的值。

您将需要检查每个对象类型以了解其`PR_SEARCH_KEY`是如何形成的，但我怀疑所有 MAPI 类型是否总是 16 个字节。

此链接[USENET 讨论](http://groups.google.com/group/microsoft.public.win32.programmer.messaging/browse_thread/thread/79ff9c1a90fd28b6/93da8a356076e683?lnk=st&q=PR_SEARCH_KEY#93da8a356076e683)与扩展 MAPI 专家 Dmitry Streblechenko 进行了很好的讨论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T01:43:59.143

您从在线文档中引用的那些之前的句子是“MAPI 使用特定规则来构建消息收件人的搜索键”，这让我认为它正在谈论 MAPI_MAILUSER 对象上的 PR_SEARCH_KEY 属性——或者至少不是 MAPI_MESSAGE 对象上的属性。

# api - LISTSERV 有 API 吗？

> ID：203453
> 
> 赞同：0
> 
> 时间：2008-10-15T01:39:32.117
> 
> 标签：api, email, mailing-list, listserv

我有一个自定义应用程序，用于发送选择加入的新闻通讯和营销电子邮件。它在发送邮件方面做得很好，但它根本不响应退回或取消订阅请求。在我看来，与其自己构建该功能，不如使用诸如 LISTSERV 之类的邮件列表管理器。

但是，我不确定 LISTSERV 是否符合要求。我需要一些可以与现有数据和代码集成的东西。

例如，时事通讯会发送给几个网站上的注册用户。我不知道是否有办法从现有数据库中提取时事通讯的地址。此外，我希望人们能够使用他们现在使用的相同帐户管理界面来选择加入和退出。我宁愿不让用户接触底层的邮件列表管理软件。

LISTSERV 是否有允许我扩展它以满足我的需要的 API？如果没有，是否还有其他高质量的邮件列表管理工具可以做到？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T02:01:21.030

LISTSERV 确实有一个强大的（如果是巴洛克式的）编程接口；看[http://www.lsoft.com/manuals/15.5/LISTSERV15.5_AdvancedTopicsManual.pdf](http://www.lsoft.com/manuals/15.5/LISTSERV15.5_AdvancedTopicsManual.pdf)。

[mailman](http://www.gnu.org/software/mailman/index.html)本身没有 API，但它确实有一套完整的命令行工具，这使得它非常可编写脚本。

而且，当然，mailman 和 majordomo 都附带了所有源代码（分别是 Python 或 Perl），因此可以按照您想要的任何方式进行自定义。或者，如果您想要的只是反弹处理，您可以从其中一个中撕下该部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T01:55:28.187

我从另一个问题中看到，有一些[工具可以检查 POP3 帐户是否有退回的电子邮件](https://stackoverflow.com/questions/7231/automatically-check-bounced-emails-via-pop3)，并将它们分类为硬退回、不在办公室回复、取消订阅等。

如果我放弃寻找 MLM 并编写自己的退回处理代码，我希望能够利用那里建议的工具之一。

# c# - 如何从可执行文件中获取图标，只有在 C# 中它的进程实例

> ID：203456
> 
> 赞同：28
> 
> 时间：2008-10-15T01:41:28.853
> 
> 标签：c#

我可以从进程中获取可执行位置，如何从文件中获取图标？

也许使用 windows api LoadIcon()。我想知道是否有.NET方式...

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-15T02:02:40.200

```
Icon ico = Icon.ExtractAssociatedIcon(theProcess.MainModule.FileName); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-15T02:18:21.463

这是来自控制台应用程序实现的示例。

```
using System;
using System.Drawing;         //For Icon
using System.Reflection;      //For Assembly

namespace ConsoleApplication
{
    class Program
    {
        static void Main(string[] args)
        {
            try
            {
                //Gets the icon associated with the currently executing assembly
                //(or pass a different file path and name for a different executable)
                Icon appIcon = Icon.ExtractAssociatedIcon(Assembly.GetExecutingAssembly().Location);                
            }
            catch(ArgumentException ae) 
            {
                //handle
            }           
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-15T03:33:10.080

使用[ExtractIconEx](http://www.pinvoke.net/default.aspx/shell32/ExtractIconEx.html)（和[此处](http://msdn.microsoft.com/en-us/library/ms648069.aspx)）p/invoke。您可以从任何 dll 或 exe 中提取大小图标。Shell32.dll 本身有超过 200 个图标，这些图标对于标准的 Windows 应用程序非常有用。您只需要首先弄清楚您想要的图标的索引是什么。

编辑：我做了快速搜索并找到[了这个](https://stackoverflow.com/questions/189031/set-same-icon-for-all-my-forms#189618)。索引 0 图标是应用程序图标。

# asp.net - 可扩展/可重用的授权模型

> ID：203468
> 
> 赞同：2
> 
> 时间：2008-10-15T01:48:29.510
> 
> 标签：asp.net, ajax, authorization, script#

好的，所以我正在寻找一些架构指导，我的团队有机会使用我们正在构建的新功能重新制定某些决策，我想看看 SO 的想法:-)当然某些事情我们不会改变，所以解决方案必须适合这个模型。也就是说，我们有一个 ASP.NET 应用程序，它使用 Web 服务来允许用户在系统上执行操作。

问题的出现是因为与许多系统一样，不同的用户需要访问不同的功能。一些角色可以访问 Y 按钮，而另一些角色可以访问 Y 和 B 按钮，而另一个角色仍然只能访问 B。大多数时候，我看到这个，开发人员只是把 if 语句混杂在一起来处理用户界面状态。我担心如果不加以检查，这将成为无法维护的混乱，因为除了将授权逻辑放在 GUI 中之外，还需要将其放在 Web 服务中（通过 ajax 调用）以确保只有授权用户才能调用某些方法.

所以我的问题是，如何设计一个系统来减少检查特定角色的随机临时 if 语句，这些语句可以在 GUI/webform 代码和 web 服务代码中重复使用。

为清楚起见，这是一个 ASP.NET Web 应用程序，使用 Web 表单和[Script#](http://projects.nikhilk.net/ScriptSharp/)来实现 AJAX 功能。不要让脚本#让您无法回答，它与 asp.net ajax 没有根本不同:-)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T02:26:42.007

在 Code Complete (p. 411) 中，Steve McConnell 给出了以下建议（比尔·盖茨将其解读为微软商业广告中的睡前故事）。

“在适当的情况下使用，表格驱动的代码比复杂的逻辑更简单，更容易修改，效率更高。”

“您可以使用表格来描述过于动态而无法在代码中表示的逻辑。”

“表驱动的方法比以前的方法更经济[死记硬背的面向对象设计]”

使用基于表格的方法，您可以轻松添加新的“用户”（如在用户/代理及其操作的建模理念中）。这是避免许多“如果”的好方法。而且我以前曾在像您这样的情况下使用过它，它使代码保持整洁。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T20:01:15.513

从传统的组、角色或操作级别权限转移到“基于声明”的授权，就像 WCF 提供的一样。

[Zermatt](https://connect.microsoft.com/Downloads/DownloadDetails.aspx?SiteID=642&DownloadID=12901)是 Microsoft 类库的代号，它将帮助开发人员在服务器和客户端上构建基于声明的应用程序。Active Directory 将成为 STS 之一，应用程序将能够与您自己的以及其他行业标准服务器同时对其进行授权......

# database - 如何在 Oracle 中使用枚举？

> ID：203469
> 
> 赞同：44
> 
> 时间：2008-10-15T01:48:37.780
> 
> 标签：database, oracle, enums

如何仅使用 SQL 在 Oracle 中使用枚举？（无 PSQL）

在 MySQL 中，您可以执行以下操作：

```
CREATE TABLE sizes (
   name ENUM('small', 'medium', 'large')
); 
```

在 Oracle 中执行此操作的类似方法是什么？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-10-15T02:36:05.763

阅读一些关于[MySQL enum](http://dev.mysql.com/doc/refman/5.0/en/enum.html)的信息，我猜最接近的等价物将是一个简单的检查约束

```
CREATE TABLE sizes (
  name VARCHAR2(10) CHECK( name IN ('small','medium','large') )
); 
```

但这不允许您通过索引引用该值。更复杂的外键关系也是可能的

```
CREATE TABLE valid_names (
  name_id   NUMBER PRIMARY KEY,
  name_str  VARCHAR2(10)
);

INSERT INTO valid_sizes VALUES( 1, 'small' );
INSERT INTO valid_sizes VALUES( 2, 'medium' );
INSERT INTO valid_sizes VALUES( 3, 'large' );

CREATE TABLE sizes (
  name_id NUMBER REFERENCES valid_names( name_id )
);

CREATE VIEW vw_sizes
  AS 
  SELECT a.name_id name, <<other columns from the sizes table>>
    FROM valid_sizes a,
         sizes       b
   WHERE a.name_id = b.name_id 
```

只要您通过视图进行操作，您似乎就可以很好地复制该功能。

现在，如果您承认 PL/SQL 解决方案，您可以创建自定义对象类型，其中可能包含限制它们可以保存的值集的逻辑，并具有获取 ID 和获取值的方法等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2018-08-15T13:34:35.920

为什么不对列使用约束？它会做同样的事情：

ALTER TABLE x ADD CONSTRAINT size_constraint check (x_size in ('small', 'medium', 'large'))

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-08T09:04:59.223

在此链接中，您可以找到受 C 语言枚举启发的 Oracle 替代解决方案/解决方法：[http ://www.petefinnigan.com/weblog/archives/00001246.htm](http://www.petefinnigan.com/weblog/archives/00001246.htm)

简而言之，Pete 建议定义一些整数常量并使用 SUBTYPE 来约束它们：

```
RED constant number(1):=1;
GREEN constant number(1):=2;
BLUE constant number(1):=3;
YELLOW constant number(1):=4;

subtype COLORS is binary_integer range 1..4; 
```

之后，您可以使用 COLORS 类型声明变量、传递参数和从函数返回值等。

# crystal-reports - 如何在 Crystal Reports 8.0 中按日期分组？

> ID：203473
> 
> 赞同：2
> 
> 时间：2008-10-15T01:53:13.633
> 
> 标签：crystal-reports, sql-server-2000

我有一个看起来像这样的水晶报表：

*日期 | 人 | 门票 | 摘要
日期 | 人 | 门票 | 摘要
日期 | 人 | 门票 | 概括*

我希望它看起来像：

*约会
人 | 门票 | 摘要
人 | 门票 | 摘要

日期
人 | 门票 | 概括*

所有值都是从 MS SQL 2000 数据库中提取的，最终将使用该报告的应用程序是一个 VB 6 应用程序，不幸的是我不得不支持它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T03:47:02.640

Crystal 具有添加分组的功能，您只需在其中选择日期字段即可。您应该可以通过右键单击日期字段并选择“分组依据”选项来执行此操作！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T05:38:23.913

JFV 有正确的答案。唯一需要注意的是添加组时，“常用”选项卡上的最后一个下拉菜单（“将打印此部分：”）设置您希望按日期而不是按小时、周、月对数据进行分组年或任何时间段。
如果您没有设置这个并且您在数据库中的 datetime 字段还包含一个时间部分，您最终可能会得到比您预期更多的组。
如果您忘记设置“将打印此部分：”选项，请右键单击部分部分并选择“更改组...”

# java - 如何在 Java 中识别不可变对象

> ID：203475
> 
> 赞同：45
> 
> 时间：2008-10-15T01:55:00.637
> 
> 标签：java, functional-programming, immutability

在我的代码中，我正在创建一个对象集合，这些对象将由各种线程以一种仅在对象不可变时才安全的方式访问。当尝试将新对象插入我的集合时，我想测试它是否是不可变的（如果不是，我将抛出异常）。

我可以做的一件事是检查一些众所周知的不可变类型：

```
private static final Set<Class> knownImmutables = new HashSet<Class>(Arrays.asList(
        String.class, Byte.class, Short.class, Integer.class, Long.class,
        Float.class, Double.class, Boolean.class, BigInteger.class, BigDecimal.class
));

...

public static boolean isImmutable(Object o) {
    return knownImmutables.contains(o.getClass());
} 
```

这实际上让我完成了 90% 的工作，但有时我的用户会想要创建自己的简单不可变类型：

```
public class ImmutableRectangle {
    private final int width;
    private final int height;
    public ImmutableRectangle(int width, int height) {
        this.width = width;
        this.height = height;
    }
    public int getWidth() { return width; }
    public int getHeight() { return height; }
} 
```

有什么方法（可能使用反射）可以可靠地检测一个类是否是不可变的？误报（认为它不可变时认为它是不可变的）是不可接受的，但误报（认为它不可变时认为它是可变的）是不可接受的。

**编辑添加：**感谢您提供有见地和有用的答案。正如一些答案所指出的，我忽略了定义我的安全目标。这里的威胁是无知的开发人员——这是一段框架代码，将被大量对线程几乎一无所知并且不会阅读文档的人使用。我不需要防御恶意开发者——任何足够聪明地[改变字符串](http://directwebremoting.org/blog/joe/2005/05/26/1117108773674.html)或执行其他恶作剧的人也将足够聪明地知道在这种情况下它是不安全的。代码库的静态分析是一种选择，只要它是自动化的，但不能指望代码审查，因为不能保证每个审查都会有精通线程的审查者。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-15T02:52:21.130

没有可靠的方法来检测一个类是否是不可变的。这是因为有很多方法可以改变类的属性，而您无法通过反射检测到所有这些。

接近这一点的唯一方法是：

*   只允许不可变类型的最终属性（您知道的原始类型和类是不可变的），
*   要求类本身是最终的
*   要求它们从您提供的基类继承（保证是不可变的）

然后，您可以使用以下代码检查您拥有的对象是否不可变：

```
static boolean isImmutable(Object obj) {
    Class<?> objClass = obj.getClass();

    // Class of the object must be a direct child class of the required class
    Class<?> superClass = objClass.getSuperclass();
    if (!Immutable.class.equals(superClass)) {
        return false;
    }

    // Class must be final
    if (!Modifier.isFinal(objClass.getModifiers())) {
        return false;
    }

    // Check all fields defined in the class for type and if they are final
    Field[] objFields = objClass.getDeclaredFields();
    for (int i = 0; i < objFields.length; i++) {
        if (!Modifier.isFinal(objFields[i].getModifiers())
                || !isValidFieldType(objFields[i].getType())) {
            return false;
        }
    }

    // Lets hope we didn't forget something
    return true;
}

static boolean isValidFieldType(Class<?> type) {
    // Check for all allowed property types...
    return type.isPrimitive() || String.class.equals(type);
} 
```

**更新：**正如评论中所建议的，它可以扩展为在超类上递归而不是检查某个类。还建议在 isValidFieldType 方法中递归使用 isImmutable。这可能可行，我也做了一些测试。但这不是微不足道的。您不能只通过调用 isImmutable 来检查所有字段类型，因为 String 已经没有通过这个测试（它的字段`hash`不是最终的！）。此外，您很容易遇到无休止的递归，导致*StackOverflowErrors* ;) 其他问题可能是由泛型引起的，您还必须检查它们的类型是否不可变。

我认为通过一些工作，这些潜在的问题可能会以某种方式得到解决。但是，你必须先问问自己这是否真的值得（也是性能方面的）。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-10-15T08:24:14.203

使用[Java Concurrency in Practice 中的](http://jcip.net/)[Immutable](http://jcip.net.s3-website-us-east-1.amazonaws.com/annotations/doc/net/jcip/annotations/Immutable.html)注解。[然后FindBugs](http://findbugs.sourceforge.net/)工具可以帮助检测可变但不应该可变的类。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-15T02:14:18.087

在我的公司，我们定义了一个名为`@Immutable`. 如果你选择将它附加到一个类，这意味着你保证你是不可变的。

它适用于文档，在您的情况下，它可以用作过滤器。

当然，您仍然依赖于作者信守不可变的诺言，但由于作者明确添加了注释，这是一个合理的假设。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-15T02:12:03.893

基本上没有。

你可以建立一个巨大的接受类的白名单，但我认为不那么疯狂的方法是在集合的文档中写下这个集合的所有内容都*必须*是不可变的。

**编辑：**其他人建议有一个不可变的注释。这很好，但您也需要文档。否则人们只会想“如果我把这个注释放在我的类上，我可以将它存储在集合中”，并且会把它扔到任何东西上，不管是不可变的还是可变的类。事实上，我会警惕使用不可变注释，以防人们认为注释*使*他们的类不可变。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-15T03:34:50.043

这可能是另一个提示：

如果该类没有设置器，则它不能被改变，授予它创建的参数是“原始”类型或本身不可变。

也不能覆盖任何方法，所有字段都是最终的和私有的，

明天我会尝试为您编写一些代码，但是 Simon 使用反射的代码看起来很不错。

同时尝试获取 Josh Block 的“Effective Java”一书，它有一个与该主题相关的项目。虽然 is 没有明确说明如何检测不可变类，但它展示了如何创建一个好的类。

该项目被称为：“支持不变性”

链接：http: [//java.sun.com/docs/books/effective/](http://java.sun.com/docs/books/effective/)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-15T07:43:18.843

> 在我的代码中，我正在创建一个对象集合，这些对象将由各种线程以一种仅在对象不可变时才安全的方式访问。

不是对您的问题的直接回答，但请记住，不可变的对象不能自动保证是线程安全的（遗憾的是）。代码需要是无副作用的线程安全的，这要困难得多。

假设你有这个类：

```
class Foo {
  final String x;
  final Integer y;
  ...

  public bar() {
    Singleton.getInstance().foolAround();
  }
} 
```

然后该`foolAround()`方法可能包括一些非线程安全的操作，这会炸毁你的应用程序。并且不可能使用反射对此进行测试，因为实际引用只能在方法体中找到，而不是在字段或暴露的接口中。

除此之外，其他的都是正确的：您可以扫描该类的所有声明字段，检查它们中的每一个是否都是最终的并且也是不可变的类，然后您就完成了。我不认为方法是最终的是必需的。

另外，在递归检查依赖字段的不变性时要小心，你可能会得到圆圈：

```
class A {
  final B b; // might be immutable...
}

class B {
  final A a; // same so here.
} 
```

类 A 和 B 是完全不可变的（甚至可能通过一些反射黑客来使用），但是幼稚的递归代码将进入无限循环检查 A，然后是 B，然后是 A，然后是 B，...

您可以使用不允许循环的“已看到”映射来解决此问题，或者使用一些非常聪明的代码来确定类是不可变的，如果它们的所有依赖项仅取决于它们自己是不可变的，但这将非常复杂......

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-15T02:15:22.840

您可以要求您的客户添加元数据（注释）并在运行时通过反射检查它们，如下所示：

元数据：

```
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.CLASS)
public @interface Immutable{ } 
```

客户代码：

```
@Immutable
public class ImmutableRectangle {
    private final int width;
    private final int height;
    public ImmutableRectangle(int width, int height) {
        this.width = width;
        this.height = height;
    }
    public int getWidth() { return width; }
    public int getHeight() { return height; }
} 
```

然后通过在类上使用反射，检查它是否有注释（我会粘贴代码但它的样板，可以很容易地在网上找到）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-15T16:31:38.650

为什么所有的建议都要求课程是最终的？如果您使用反射来检查每个对象的类，并且您可以通过编程方式确定该类是不可变的（不可变的，最终字段），那么您不需要要求该类本身是最终的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-02-18T07:02:28.763

您可以使用来自[jcabi-aspects 的](http://aspects.jcabi.com/)[`@Immutable`](http://aspects.jcabi.com/annotation-immutable.html)AOP 和注释：

```
@Immutable
public class Foo {
  private String data;
}
// this line will throw a runtime exception since class Foo
// is actually mutable, despite the annotation
Object object = new Foo(); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-15T05:25:43.473

就像其他回答者已经说过的那样，恕我直言，没有可靠的方法来确定对象是否真的不可变。

我只想引入一个接口“不可变”来在附加时进行检查。这作为一个提示，无论出于何种原因，都应该插入不可变对象。

```
interface Immutable {}

class MyImmutable implements Immutable{...}

public void add(Object o) {
  if (!(o instanceof Immutable) && !checkIsImmutableBasePrimitive(o))
    throw new IllegalArgumentException("o is not immutable!");
  ...
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-07-27T11:08:57.347

试试这个：

```
public static boolean isImmutable(Object object){
    if (object instanceof Number) { // Numbers are immutable
        if (object instanceof AtomicInteger) {
            // AtomicIntegers are mutable
        } else if (object instanceof AtomicLong) {
            // AtomLongs are mutable
        } else {
            return true;
        }
    } else if (object instanceof String) {  // Strings are immutable
        return true;
    } else if (object instanceof Character) {   // Characters are immutable
        return true;
    } else if (object instanceof Class) { // Classes are immutable
        return true;
    }

    Class<?> objClass = object.getClass();

    // Class must be final
    if (!Modifier.isFinal(objClass.getModifiers())) {
            return false;
    }

    // Check all fields defined in the class for type and if they are final
    Field[] objFields = objClass.getDeclaredFields();
    for (int i = 0; i < objFields.length; i++) {
            if (!Modifier.isFinal(objFields[i].getModifiers())
                            || !isImmutable(objFields[i].getType())) {
                    return false;
            }
    }

    // Lets hope we didn't forget something
    return true;
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-05-30T13:01:14.237

据我所知，没有办法识别 100% 正确的不可变对象。但是，我写了一个库来让你更接近。它对一个类的字节码进行分析以确定它是否不可变，并且可以在运行时执行。它是严格的，因此它还允许将已知的不可变类列入白名单。

您可以在以下网址查看：[www.mutabilitydetector.org](http://www.mutabilitydetector.org)

它允许您在应用程序中编写如下代码：

```
/*
* Request an analysis of the runtime class, to discover if this
* instance will be immutable or not.
*/
AnalysisResult result = analysisSession.resultFor(dottedClassName);

if (result.isImmutable.equals(IMMUTABLE)) {
    /*
    * rest safe in the knowledge the class is
    * immutable, share across threads with joyful abandon
    */
} else if (result.isImmutable.equals(NOT_IMMUTABLE)) {
    /*
    * be careful here: make defensive copies,
    * don't publish the reference,
    * read Java Concurrency In Practice right away!
    */
} 
```

它在 Apache 2.0 许可下是免费和开源的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-04T16:27:46.930

查看[joe-e](http://www.joe-e.org/)，它是 Java 功能的实现。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-04T19:21:59.337

适用于大部分内置类的东西是对 instanceof Comparable 的测试。对于像 Date 这样不可变的类，在大多数情况下，它们通常被视为不可变的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-01-23T14:35:23.327

我赞赏并钦佩 Grundlefleck 为他的可变性检测器所做的大量工作，但我认为这有点矫枉过正。您可以编写一个简单但实​​际上非常合适（即*实用*的）检测器，如下所示：

（注意：这是我的评论的副本：[https](https://stackoverflow.com/a/28111150/773113) ://stackoverflow.com/a/28111150/773113 ）

首先，您不会只是编写一个确定类是否不可变的方法。相反，您将需要编写一个不变性检测器类，因为它必须保持某种状态。检测器的状态将是它迄今为止检查过的所有类的检测到的不变性。这不仅对性能有用，而且实际上是必要的，因为一个类可能包含循环引用，这会导致简单的不变性检测器陷入无限递归。

类的不变性有四个可能的值：`Unknown`、`Mutable`、`Immutable`和`Calculating`。您可能希望有一个映射，它将您迄今为止遇到的每个类与一个不变性值相关联。当然，`Unknown`实际上并不需要实现，因为它将是尚未在映射中的任何类的隐含状态。

因此，当您开始检查一个类时，您将它与`Calculating`映射中的一个值相关联，完成后，您将替换`Calculating`为`Immutable`or `Mutable`。

对于每个类，您只需要检查字段成员，而不需要检查代码。检查字节码的想法是相当错误的。

首先，你不**应该**检查一个类是否是最终的；类的最终确定性不会影响其不变性。相反，一个期望一个不可变参数的方法应该首先调用不可变检测器来断言传递的实际对象的类的不变性。如果参数的类型是 final 类，这个测试可以省略，所以 finality 对性能有好处，但严格来说没有必要。此外，正如您将在下面看到的那样，类型为非最终类的字段将导致声明类被认为是可变的，但这仍然是声明类的问题，而不是非最终类的问题不可变成员类。拥有不可变类的高层次结构是非常好的，其中所有非叶节点当然必须是非最终的。

你不应该**检查**一个字段是否是私有的；一个类拥有一个公共字段是完全可以的，并且该字段的可见性不会以任何方式、形状或形式影响声明类的不变性。您只需要检查该字段是否为final，其类型是否不可变。

在检查一个类时，您首先要做的是递归以确定其`super`类的不变性。如果超级是可变的，那么根据定义，后代也是可变的。

然后，您只需要检查类的*声明*字段，而不是*所有*字段。

如果一个字段不是最终的，那么你的类是可变的。

如果一个字段是最终的，但该字段的类型是可变的，那么你的类是可变的。（数组根据定义是可变的。）

如果一个字段是最终的，并且该字段的类型是`Calculating`，则忽略它并继续下一个字段。如果所有字段都是不可变的或`Calculating`，那么您的类是不可变的。

如果字段的类型是接口、抽象类或非最终类，那么它被认为是可变的，因为您完全无法控制实际实现可能会做什么。这似乎是一个无法克服的问题，因为这意味着将可修改的集合包装在 an`UnmodifiableCollection`中仍然无法通过不变性测试，但实际上没问题，可以通过以下解决方法来处理。

一些类可能包含非最终字段，但*实际上仍然是不可变*的。类就是一个例子`String`。其他属于这一类的类是包含非最终成员纯粹用于性能监控目的的类（调用计数器等），实现*冰棒不变性的类*（查找），以及包含成员的类，这些成员是已知不会引起任何副作用的接口。此外，如果一个类包含真正的可变字段但承诺在计算 hashCode() 和 equals() 时不考虑它们，那么该类在多线程方面当然是不安全的，但它仍然可以被视为为了将其用作地图中的键，它是不可变的。因此，所有这些情况都可以通过以下两种方式之一处理：

1.  手动将类（和接口）添加到不变性检测器。如果你知道某个类实际上是不可变的，尽管它的不变性测试失败了，你可以手动添加一个条目到你的检测器，将它与`Immutable`. 这样，检测器将永远不会尝试检查它是否是不可变的，它只会说“是的，它是”。

2.  引入`@ImmutabilityOverride`注解。您的不变性检测器可以检查字段上是否存在此注释，如果存在，它可能会将字段视为不可变，尽管该字段可能是非最终的或其类型可能是可变的。检测器还可以检查类上是否存在此注释，从而将类视为不可变的，甚至无需检查其字段。

我希望这对后代有所帮助。

# css - Google 地图气泡中的 CSS 格式如何工作？

> ID：203477
> 
> 赞同：4
> 
> 时间：2008-10-15T01:55:36.580
> 
> 标签：css, google-maps, kml

我正在使用 KML 和 GGeoXml 对象在嵌入式 Google 地图上叠加一些形状。KML 文件中的地标具有一些显示在气球中的自定义描述信息。

```
<Placemark>
    <name />
    <description>
        <![CDATA[
            <div class="MapPopup">
                <h6>Concession</h6>
                <h4>~Name~</h4>
                <p>Description goes here</p>
                <a class="Button GoRight FloatRight" href="#"><span></span>View details</a>
            </div>
        ]]>
    </description>
    <styleUrl>#masterPolyStyle</styleUrl>
    ...Placemarks go here ...
</Placemark> 
```

到目前为止一切顺利 - 弹出窗口出现并包含正确的文本。这是奇怪的事情：我正在尝试使用 CSS 来格式化弹出窗口中的内容，并且它成功了一半。

具体来说：

*   和元素使用我在样式表中指定的颜色和背景图像呈现`<h6>`。`<h4>`

*   一切都以 Arial 显示，而不是我在 CSS 中指定的字体。

*   类名似乎被忽略了（例如，没有`a.Button`应用任何格式；如果我定义了像下面这样的样式，它将被忽略。）

    ```
     div.MapPopup { background:pink; } 
    ```

有任何想法吗？CSS 根本不工作我不会感到惊讶，但奇怪的是它只部分工作。

### 更新

这是一个屏幕截图，可以更好地说明这一点。我已经`<div class="MapPopup">`在页面的下方（黄色）复制了标记，以显示它应该如何根据我的 CSS 呈现。

![替代文字](https://farm4.static.flickr.com/3072/2942636927_2f8119a72a.jpg?v=0)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-16T14:56:50.790

正如建议的那样，我已经和 Firebug 一起去看看发生了什么。看起来谷歌正在做两件令人讨厌的事情：

1.  它正在从我的 HTML 中删除所有类属性。
2.  它到处乱扔各种硬编码样式。

这是我的 HTML 以及 Google 插入的前几个包装器：

```
<div style="font-family: Arial,sans-serif; font-size: small;">
    <div id="iw_kml">
        <div>
            <h6>Concession</h6>
            <h4>BOIS KASSA 1108000 (Mobola-Mbondo)</h4>
            <p>
                Description goes here</p>
            <a target="_blank"><span />View details </a>
        </div>
    </div>
</div> 
```

如您所见，我的课程（例如`MapPopup`在我的第一个`div`等标签`Button`中`<a>`）都已被删除。

知道了这一点，我将能够解决谷歌的干扰，使用`!important`和定位整个地图的容器`div`——尽管如此，这很烦人，而且来自谷歌的出乎意料的笨拙。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-17T21:18:54.153

与 KML 块中的 HTML 相关的更多令人讨厌的问题`<description>`：任何链接都被赋予属性`target="_blank"`，无论您喜欢与否。我目前正在探索使用 jQuery 来撤消它的方法，但这太麻烦了。我真的不明白为什么 Google 觉得有必要篡改这个 HTML。

另请参阅[官方 Google Group 上的此线程](http://groups.google.com/group/Google-Maps-API/browse_thread/thread/455e75b2c4549ab2/517f48eefbae46cb)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-04T22:10:24.437

我有过类似的问题。我不知道你是如何实现你的标记的，或者你是否正在使用 InfoWindow 或 .addListener，但是我不得不让 css 样式在“弹出气泡”（在标记上方）内工作是为了使用所谓的“内联样式”。所以我有一个变量传递给 InfoWindow。假设您已经使用一些选项初始化了一个变量“marker”，并创建了“map”实例，一些示例代码如下所示：

```
/*start of myHtml2 variable*/
var myHtml2 = "<div style=\"background-color:lightgray\"><div style=\"padding:5px\"><div
style=\"font-size:1.25em\">Some text</div><div>Some more text<br/>
Yet more text<br/></div><table style=\"padding:5px\"><tr><td><img src=\"A lake.jpg\"
width=\"75px\" height=\"50px\"></td><td>More text<br/>Again, more text<br/><div
style=\"font-size:.7em\">Last text</div></td></tr></table></div></div>"
/*end of variable*/

var infowindow2 = new google.maps.InfoWindow({content: myHtml2});
 /*mouseover could be 'click', etc.*/
google.maps.event.addListener(marker, 'mouseover', function(){  
infowindow2.open(map, marker);
}); 
```

我知道 css 样式代码很麻烦，但是我还没有找到在头部使用 css 或从样式表中使用复杂 css 样式的方法 总是有冲突，有些功能没有t 正确渲染。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T03:25:28.520

我的第一个猜测是您遇到了 CSS 特异性的问题。[在http://www.smashingmagazine.com/2007/07/27/css-specificity-things-you-should-know/](http://www.smashingmagazine.com/2007/07/27/css-specificity-things-you-should-know/)上有一篇很好的文章，所以如果你可以包含一个容器元素 ID，那*可能会*有所帮助.

如果这不是问题，请告诉我，我会想出更多的想法。

# oracle - Oracle 10gr2：输入的强制执行日期在上午 9 点到下午 5 点之间？

> ID：203484
> 
> 赞同：3
> 
> 时间：2008-10-15T01:59:11.970
> 
> 标签：oracle, date, time, constraints

我想强制输入的日期时间在上午 9 点到下午 5 点之间。如何使用 ORACLE CHECK 约束强制执行此操作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-15T02:16:53.150

```
SQL> ed
Wrote file afiedt.buf

  1  create table date_check (
  2  dt date check( to_number( to_char( dt, 'HH24' ) ) between 9 and 16 )
  3* )
SQL> /

Table created.

SQL> ed
Wrote file afiedt.buf

  1* insert into date_check values( to_date( '01/01/2008 08:30', 'DD/MM/YYYY HH2
4:MI' ) )
SQL> /
insert into date_check values( to_date( '01/01/2008 08:30', 'DD/MM/YYYY HH24:MI'
 ) )
*
ERROR at line 1:
ORA-02290: check constraint (SCOTT.SYS_C006170) violated

SQL> ed
Wrote file afiedt.buf

  1* insert into date_check values( to_date( '01/01/2008 10:30', 'DD/MM/YYYY HH2
4:MI' ) )
SQL> /

1 row created.

SQL> ed
Wrote file afiedt.buf

  1* insert into date_check values( to_date( '01/01/2008 17:30', 'DD/MM/YYYY HH2
4:MI' ) )
SQL> /

insert into date_check values( to_date( '01/01/2008 17:30', 'DD/MM/YYYY HH24:MI'
 ) )
*
ERROR at line 1:
ORA-02290: check constraint (SCOTT.SYS_C006170) violated 
```

# python - 创建自包含的 Python 应用程序

> ID：203487
> 
> 赞同：21
> 
> 时间：2008-10-15T02:00:27.553
> 
> 标签：python, windows, executable, self-contained

我正在尝试创建一个独立的[pisa](http://www.htmltopdf.org/)版本（html 到 pdf 转换器，[最新版本](http://pypi.python.org/pypi/pisa/3.0.27)），但由于几个错误，我无法成功。我试过了`py2exe`，`bb-freeze`和`cxfreeze`。

这必须在 Windows 中，这让我的生活更加艰难。我记得几个月前作者有一个包含安装的 zip 文件，但现在它已经消失了，只剩下依赖于 python 的方式。

你将如何解决这个问题？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-15T02:17:35.520

查看[pyinstaller](http://www.pyinstaller.org/)，它可以生成独立的可执行文件（就像在一个 .EXE 文件中一样，仅此而已）。

# sql - 查找具有多个 ActiveRecord HABTM 关联的记录

> ID：203489
> 
> 赞同：4
> 
> 时间：2008-10-15T02:01:51.573
> 
> 标签：sql, ruby-on-rails, ruby, activerecord

我有两个模型，由 Has 和 Belongs To Many 连接表连接。让我们将这些模型称为用户和事件。大多数用户有 0 个事件，而很少有一个或多个事件。我想做类似的事情：

User.find(:all, :joins => :events, :conditions => [" ***'计算事件的东西'*** > ?"], 0)

问题是，我不确定如何仅选择具有 1 个或多个关联事件的用户。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T04:31:53.220

我找到了答案：

```
User.find(:all, :joins => :events, :select => 'DISTINCT `users`.*') 
```

基本上，`users`.* 将结果集限制为仅 users 表，而 DISTINCT 关键字确保每个用户只返回一次。

# sql - 为什么 Oracle 9i 将空字符串视为 NULL？

> ID：203493
> 
> 赞同：227
> 
> 时间：2008-10-15T02:04:18.840
> 
> 标签：sql, oracle, null, string

我知道它*确实*将 ' ' 视为`NULL`，但这并不能告诉我*为什么*会这样。据我了解 SQL 规范，' ' 与`NULL`- 一个是有效数据不同，另一个表示缺少相同的信息。

随意推测，但请指出是否是这种情况。如果甲骨文有任何人可以对此发表评论，那就太好了！

* * *

## 回答 #1

> 赞同：231
> 
> 时间：2008-10-15T02:30:04.560

我相信答案是甲骨文非常非常古老。

早在 SQL 标准出现之前，Oracle 就做出了设计决定，即`VARCHAR`/`VARCHAR2`列中的空字符串是空字符串，`NULL`并且只有一种 NULL 的含义（有关系理论家会区分从未提示过的数据，存在答案但用户不知道的数据，没有答案的数据等。所有这些都构成了某种意义上的`NULL`）。

当 SQL 标准出现并同意`NULL`空字符串是不同的实体时，已经有 Oracle 用户的代码假定两者是等价的。因此，Oracle 基本上只能选择破坏现有代码、违反 SQL 标准或引入某种初始化参数来改变潜在大量查询的功能。违反 SQL 标准 (IMHO) 是这三个选项中破坏性最小的。

Oracle 保留了`VARCHAR`在未来版本中更改数据类型以遵守 SQL 标准的可能性（这就是每个人都`VARCHAR2`在 Oracle 中使用的原因，因为该数据类型的行为保证在未来保持不变）。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-10-15T02:38:52.637

甲骨文副总裁[Tom Kyte ：](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:5984520277372)

> 零长度 varchar 被视为 NULL。
> 
> '' 不被视为 NULL。
> 
> '' 分配给 char(1) 时变为 ' ' （char 类型是空白填充字符串）。
> 
> '' 分配给 varchar2(1) 时变为 ''，这是一个零长度字符串，而零长度字符串在 Oracle 中为 NULL（它不是长 ''）

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-10-15T13:46:13.057

Oracle 文档提醒开发人员注意这个问题，至少可以追溯到版本 7。

Oracle 选择用“不可能值”技术来表示 NULLS。例如，数字位置中的 NULL 将存储为“负零”，这是一个不可能的值。计算产生的任何负零都将在存储之前转换为正零。

Oracle 还错误地选择将长度为零的 VARCHAR 字符串（空字符串）视为不可能的值，并且是表示 NULL 的合适选择。事实证明，空字符串远非不可能的值。甚至是字符串拼接操作下的身份！

Oracle 文档警告数据库设计人员和开发人员，Oracle 的某些未来版本可能会破坏空字符串和 NULL 之间的这种关联，并破坏任何依赖于该关联的代码。

除了不可能的值之外，还有一些技术可以标记 NULLS，但 Oracle 没有使用它们。

（我在上面使用“位置”这个词来表示行和列的交集。）

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-02-18T15:50:41.173

如果您像早期开发人员可能会做的那样考虑 Oracle，我怀疑这会更有意义 - 作为数据输入系统的美化后端。数据库中的每个字段都对应于数据输入操作员在其屏幕上看到的表单中的字段。如果操作员没有在字段中输入任何内容，无论是“生日”还是“地址”，那么该字段的数据就是“未知”。操作员无法指示某人的地址实际上是一个空字符串，而且这实际上没有多大意义。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-05T16:33:04.133

空字符串与 NULL 相同，只是因为与两者（空字符串和 null）不同的情况相比，它是“较小的邪恶”。

在 NULL 和空字符串不相同的语言中，必须始终检查这两个条件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-03-23T11:34:49.027

[根据官方 11g 文档](http://docs.oracle.com/cd/B28359_01/server.111/b28286/sql_elements005.htm)

> Oracle 数据库当前将长度为零的字符值视为空值。但是，在未来的版本中，这可能不会继续存在，Oracle 建议您不要将空字符串视为与 null 相同。

**可能的原因**

1.  `val IS NOT NULL`比`val != ''`
2.  无需检查两个条件`val != '' and val IS NOT NULL`

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-08-08T15:11:37.060

书中的例子

```
 set serveroutput on;   
    DECLARE
    empty_varchar2 VARCHAR2(10) := '';
    empty_char CHAR(10) := '';
    BEGIN
    IF empty_varchar2 IS NULL THEN
    DBMS_OUTPUT.PUT_LINE('empty_varchar2 is NULL');
    END IF;

    IF '' IS NULL THEN
    DBMS_OUTPUT.PUT_LINE(''''' is NULL');
    END IF;

    IF empty_char IS NULL THEN
    DBMS_OUTPUT.PUT_LINE('empty_char is NULL');
    ELSIF empty_char IS NOT NULL THEN
    DBMS_OUTPUT.PUT_LINE('empty_char is NOT NULL');
    END IF;

    END; 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2010-04-09T19:52:59.633

因为不将其视为 NULL 也不是特别有用。

如果您在 Oracle 上在这方面犯了错误，您通常会立即注意到。但是，在 SQL Server 中，它似乎可以工作，并且仅当有人输入空字符串而不是 NULL 时才会出现问题（可能来自 .net 客户端库，其中 null 与“”不同，但您通常将它们视为相同）。

我并不是说 Oracle 是对的，但在我看来，这两种方式都差不多一样糟糕。

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2008-10-15T02:27:46.623

事实上，我在处理 Oracle 时遇到了困难，包括无效的日期时间值（不能打印、转换或任何东西，只能用 DUMP() 函数查看），这些值被**允许**插入数据库，显然是通过一些错误客户端作为二进制列的版本！保护数据库完整性就这么多！

Oracle 处理 NULL 链接：

[http://digitalbush.com/2007/10/27/oracle-9i-null-behavior/](http://digitalbush.com/2007/10/27/oracle-9i-null-behavior/)

[http://jeffkemponoracle.com/2006/02/empty-string-andor-null.html](http://jeffkemponoracle.com/2006/02/empty-string-andor-null.html)

* * *

## 回答 #10

> 赞同：-6
> 
> 时间：2011-07-14T02:27:56.930

首先，Oracle 并不总是将 null 和 null 字符串视为相同的。根据定义，空字符串是不包含字符的字符串。这与 null 完全不同。根据定义，NULL 是没有数据。

五六年前，Oracle 对 null 字符串的处理方式与 null 不同。虽然，像 null 一样，null string 等于所有内容并且不同于所有内容（我认为 null 很好，但 null 字符串完全错误），至少 length(null string) 会返回 0，因为它应该返回 null string零长度的字符串。

目前在 Oracle 中，length(null) 返回 null，我猜是可以的，但是 length(null string) 也返回 null，这是完全错误的。

我不明白他们为什么决定开始同等对待这两个不同的“价值观”。它们意味着不同的东西，程序员应该有能力以不同的方式对它们采取行动。他们改变了他们的方法的事实告诉我，他们真的不知道应该如何对待这些价值观。

# java - 测试 REST Web 服务

> ID：203495
> 
> 赞同：63
> 
> 时间：2008-10-15T02:06:56.057
> 
> 标签：java, web-services, rest, testing, rest-client

我的组织正致力于在 JBoss 应用服务器上构建 RESTful Web 服务。到目前为止，QA 团队习惯于使用 SoapUI 测试 SOAP Web 服务。SoapUI 有一个具有 REST 功能的新版本。我们正在考虑使用它。

1.  网络上是否有任何公开可用的 RESTful 服务可供人免费测试？

2.  有哪些工具可用于（和使用）测试 RESTful Web 服务？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-06-24T09:52:03.133

[soapUI](http://www.soapui.org)也可以完成这项工作，请查看[此博客文章](http://www.eviware.com/blogs/oleblog/?p=11)以开始使用。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-15T10:42:07.187

请尝试 Firefox 插件海报，它使用简单，让您快速上手

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-15T03:09:11.203

您可以使用相当简单的 Python 代码来运行 Web 服务。根据您的安全性，您可以简单地使用 Python`urllib`或`urllib2`执行 REST 请求并检查您的答案。

此外，您可能希望使用 Python`unittest`来控制 REST 服务的 Python 测试的执行。

```
class TestSomeREST( unittest.TestCase ):
    def setUp(self):
        REALM = "blah@blah.com"
        self.client= RESTClient( "localhost", 18000, "tester", "tester", REALM )
    def test_1_get(self):
        response = self.client.get('/this/that/other/2/')
        self.failUnlessEqual(200, response.status_code)
        j1= JSONDecoder().decode(response.content)
        self.assertEquals(2, j1[0]['pk'] )
        entity= j1[0]['fields']
        self.assertEquals('Some Other Group', entity['name'])
        self.assertEquals('E1G2', entity['customer_id']) 
```

RESTClient 类使用 urllib2 为每个请求传递摘要身份验证。它相当复杂，但如果我感兴趣，我可以分享本质。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-15T02:43:17.793

查看[提琴手](http://www.fiddler2.com/fiddler2/)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-15T02:41:45.550

CURL 让你走到一半。另一半是检查标头、响应代码和实体内容以确保其良好。您可以为此使用各种工具（在 shell 脚本领域，将标头和内容通过管道传输到文件，并对它们进行差异化可能就可以解决问题）。进一步完善工具集并不难，也许与您选择的单元测试框架叠加起来。

我用 AJAX 构建了一个 rest webservice 测试面板。其实一点也不难。您需要解决一些安全问题（即确保您在同一台服务器上拥有测试套件，或者可能是签名的 Javascript。）

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-01-05T16:48:42.747

要测试 REST 服务，您可以尝试[REST Assured](http://code.google.com/p/rest-assured/)，这使得测试 REST 服务和验证 Java 中的响应变得非常简单（使用 JUnit 或 TestNG）。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2012-06-02T00:25:15.083

查看邮递员 - [https://chrome.google.com/webstore/detail/fdmmgilgnpjigdojojpjoooidkmcomcm/](https://chrome.google.com/webstore/detail/fdmmgilgnpjigdojojpjoooidkmcomcm/)。这是我过去几个月一直在研究的一个工具，最近从我得到的反馈来看，它对于大型 REST 项目变得非常有用，同时有助于进行基本的 REST 端点测试。

这个代码也可以在 Github 上找到。[https://github.com/a85/POSTMan-Chrome-Extension](https://github.com/a85/POSTMan-Chrome-Extension)

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2012-11-11T16:56:07.423

测试 REST Web 服务的最简单方法是`curl`在终端中使用。

我用一些代码来测试我的 Rails 网络服务。您可以修改它们以适应您的服务。

**得到**

```
curl http://localhost:3000/courses.json 
```

**邮政**

```
curl -H "Content-Type:application/json"  -d '{"courseCode":"55555","courseName":"SEEEE","courseYr":999}' http://localhost:3000/courses.json 
```

**放入 Raills：eg1** （包含所有字段）：

```
curl -H "X-Http-Method-Override: put" -H "Content-Type:application/json"  -d '{"courseCode":"123456","courseName":"AAAAAAAA","courseYr":12345}' http://localhost:3000/courses/5.json 
```

eg2（仅编辑该字段）：

```
curl -H "X-Http-Method-Override: put" -H "Content-Type:application/json"  -d '{"courseYr":999999999}' http://localhost:3000/courses/3.json 
```

**在提供 id 的 rails 中删除**

```
 curl -H "X-Http-Method-Override: delete" -H "Content-Type:application/json"  -d '{"id":4}' http://localhost:3000/courses/5.json 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-19T13:31:43.210

我还没有测试它，但是这个 Java 应用程序似乎很适合测试 REST 服务。Javalobby 上也有一个关于它的教程。

Java 应用程序：[http ://code.google.com/p/rest-client/](http://code.google.com/p/rest-client/)

教程：http : [//java.dzone.com/announcements/wiztoolsorg-restclient-21-rele](http://java.dzone.com/announcements/wiztoolsorg-restclient-21-rele)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-12-20T16:02:23.497

您可以使用 Simple REST Client 也是 Google Chrome 的扩展[https://chrome.google.com/webstore/detail/fhjcajmcbmldlhcimfajhfbgofnpcjmb](https://chrome.google.com/webstore/detail/fhjcajmcbmldlhcimfajhfbgofnpcjmb)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-09-16T08:02:59.533

SOA Cleaner，是一个测试soap 和rest 的测试工具（也是WCF，但是你好像不需要那个特性）。它非常直观且可用。用 .NET 编写。还提供免费版本。可以从[http://xyrow.com](http://xyrow.com)下载。祝你好运！

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-06-17T08:45:02.100

我正在为 Google Chrome 使用[**REST 控制台扩展**](https://github.com/codeinchaos/restconsole)，这是迄今为止我尝试过的最好的。它还支持各种安全机制，如 OAuth

（更新2：修复链接）

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-05-29T14:20:51.397

我正在使用内部 .NET 框架测试 RESTful 服务（在 Java 中移植它没有问题）。基本原则：

*   构建客户端（拨打电话）
*   构建类型类（XML 和 JSON）
*   反序列化响应
*   断言东西

如果您想了解更多信息，我很高兴与您交谈。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-09-06T10:46:25.270

对于 java，还存在[RESTFuse](http://developer.eclipsesource.com/restfuse/)，它允许开发可能如下所示的单元测试：

```
@Rule
public Destination destination = new Destination("http://localhost:8080/rest/");

@HttpTest( method = Method.GET, path = "/status" ,authentications =
   @Authentication(type = AuthenticationType.BASIC, user = "joe", password = "doe")
)
public void testAuthRhqadmin() {
    com.eclipsesource.restfuse.Assert.assertOk(response);
} 
```

此测试针对`http://localhost:8080/rest/status`使用密码 doe 的用户 joe 运行并进行身份验证。然后方法的主体检查 GET 调用是否返回 200 状态代码。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-15T03:11:35.177

试试 Python 的 httplib。这很容易，您指定方法、url，并使用 urllib.urlencode 作为参数/POST 正文。

如果您愿意，这可以与内置的 unittest 模块结合使用，以报告错误。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-15T19:53:38.213

为此，我一直在使用 JMeter，尤其是负载测试之类的东西。它类似于 SoapUI（我也使用过），但更倾向于测试网页，这使得它在测试 RESTful 服务方面也相当不错。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-24T03:40:37.580

我编写了一个专门用于测试 REST Web 服务的程序。它是一个用 .NET 2.0 编写的非常简单的应用程序（我只在 Windows Vista 上测试过它，但应该也可以在 XP 上运行）。应用程序使用 HttpWebRequest 发出请求，并显示结果响应，以及请求和响应的标头。我做了一些测试，但我认为它可能会帮助您测试您的 Web 服务。

[休息测试](http://www.lucidhelix.com/files/RESTTest.zip)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-12-08T02:23:32.547

我目前正在为此目的调查 wsclient CLI 应用程序（[http://wso2.org/library/3362](http://wso2.org/library/3362)）。它很有前途，可用于从 bash shell 破解快速测试。当然，正如这里许多人提到的，*nix 系统附带的许多工具将通过一些编码/脚本来完成这项工作

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-01-11T00:41:56.990

如果您喜欢使用 Ruby，那么可以使用REST [-Client gem](https://github.com/archiloque/rest-client)

对于测试人员，我发现 ruby​​ 是一门非常容易学习的语言，并且它有一些优秀的工具，比如 Cucumber，用于进行 BDD 风格的验收测试。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-08-26T16:19:35.980

我尝试了许多 REST 客户端，到目前为止，我使用过的最好的是 Chrome 应用程序：[DHC](https://chrome.google.com/webstore/detail/dhc-rest-http-api-client/aejoelaoggembcahagimdiliamlcdmfm)。

> DHC（又名 Dev HTTP 客户端）是由开发人员设计和开发的，目的是让开发人员更轻松地直接发现、操作和测试 HTTP 资源。除了发送/接收自定义 HTTP 请求/响应的主要功能之外，它还允许将请求永久保存到本地存储库以供以后重用，此外，请求声明可以包含特定于上下文的变量。通过使用上下文，您可以轻松地在各种环境之间切换，而无需修改请求声明。（例如从测试环境到生产环境）

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-09-16T11:34:17.500

测试 REST 完整的 Web 服务是一项简单的任务。浏览器上提供免费的插件作为 REST 客户端，您必须从该客户端发送具有预期/必需方法类型的 Web 服务：GET/POST/PUT/DELETE 如果参数匹配，则将在浏览器主体中生成输出.![在此处输入图像描述](https://i.stack.imgur.com/smdfQ.png)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-03-01T07:45:00.623

我知道这是一个非常古老的问题，但可能对其他人有所帮助。只是为了回答您的第一个问题，您可以[在此处查看](http://www.groupkt.com/post/f2129b88/free-restful-web-services-to-consume-and-test.htm)以获取一些 REST Web 服务进行测试。

Firefox 中的 Fiddler 和 Poster 插件可用于测试任何 REST Web 服务。SoapUI 还带有 RESTful Web 服务支持。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-04-01T19:34:18.263

对于高级 REST 测试，您可以尝试[HttpMaster](http://www.httpmaster.net "HttpMaster")。
它支持动态参数、友好的 XML/JSON 查看器以及可以组合成逻辑表达式的各种类型的响应数据验证。
对于基本的 http 请求，一些浏览器插件就足够了。

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2011-08-16T06:16:25.750

[OnionTest](http://www.oniontest.org) 仍处于测试阶段，但非常有用

# sql-server - 如何在不更改 rowversion 的情况下更新记录

> ID：203497
> 
> 赞同：6
> 
> 时间：2008-10-15T02:10:29.997
> 
> 标签：sql-server, tsql, rowversion

如果表中包含 rowversion 列，并且您对该行进行更新，则 rowversion 列的值会增加。我知道这是设计和 rowversion 列的目的，但是有什么方法可以使更新操作对 rowversion 值没有影响？

编辑：需要跟踪所有列的更新，但是我们希望避免将某些操作视为新版本。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T02:14:32.563

不，请参阅[MSDN](http://msdn.microsoft.com/en-us/library/ms182776.aspx)。“每次修改或插入具有 rowversion 列的行时，都会在 rowversion 列中插入递增的数据库 rowversion 值。”

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-15T02:19:20.900

不，但也许您的意思是使用[auto-increment](http://www.sitepoint.com/forums/showthread.php?t=41676)？然后在创建行时您有一个新的唯一编号，但在更新行时它不会更改。

如果您还想要某种不适用于所有列的更改计数器，那么您可以自己在另一列中实现它。

# perforce - 在 Perforce 中禁用 +S 文件类型

> ID：203516
> 
> 赞同：3
> 
> 时间：2008-10-15T02:18:17.530
> 
> 标签：perforce

Perforce 的文件类型系统包括修改后的 +S 以表示文件是临时文件。这意味着没有为该文件存储任何文件历史记录 - 仅维护最新版本，并且每次新签入都会替换它。

这显然是我们最近发现的意外设置的危险标志。有没有办法确保将来不会使用它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-15T02:21:17.480

您可以编写一个预提交触发器来查看此标志的文件列表，如果是这种情况，则拒绝提交。

有关详细信息，请参阅[Perforce 手册的这一章](http://www.perforce.com/perforce/doc.current/manuals/p4sag/06_scripting.html)。

# .net - 如何区分 WinForm 控件上的数据绑定和用户操作

> ID：203520
> 
> 赞同：2
> 
> 时间：2008-10-15T02:19:28.403
> 
> 标签：.net, winforms, data-binding

我有一个典型的catch-22问题。我有一个包含文本框和复选框的 .NET WinForm 控件。这两个控件都是绑定到数据类实例上的属性的数据。文本框用于价格，复选框表示价格是价格覆盖。数据类上还有一个属性，用于保存商品的原始价格。

我希望控件遵守以下规则：

*   当用户在价格文本框中输入值时，会自动选中复选框以指示他们正在覆盖价格值
*   取消选中该复选框时，该项目的价格将恢复为原始价格。

当用户取消选中复选框时，事件处理程序测试选中状态，并将项目的价格属性设置为原始价格值。但是，价格值是数据绑定的，会触发一个绑定事件，该事件会更新文本框值，该值会触发文本更改事件处理程序，该处理程序重新检查复选框。

我试图捕获我明确更新会触发控件更改事件的内容的条件。但这仅适用于其中的一部分。文本框更改事件在我无法控制的其他时间触发，例如在最初显示表单时触发数据绑定。

我一直在四处寻找，我想我只是没有想出正确的搜索词来找到我正在寻找的东西。数据绑定似乎非常美妙，直到你需要用它做一些实际的事情，比如让两个绑定控件相互交互。似乎没有办法区分触发控制事件的原因。

我还查看了绑定源组件上可用的事件，但似乎没有任何更有用的东西。我可以处理绑定完成后触发的事件，但那是在问题发生之后。

有人有什么建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T07:07:00.287

我建议不要在表单代码中处理逻辑，而是在数据类中处理。您在表单中只需要几行来设置数据绑定。然后数据类可以处理其余部分：

形式

```
Private _dc As DataClass

Private Sub Form1_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    _dc = New DataClass
    txtPrice.DataBindings.Add("text", _dc, "Price")
    chkOverride.DataBindings.Add("checked", _dc, "override")
End Sub 
```

数据类

```
Private _originalPrice As Double = 50

Private _price As Double = _originalPrice
Public Property Price() As Double
    Get
        Return _price
    End Get
    Set(ByVal value As Double)
        If (_price <> value) Then
            _price = value
            Override = _price <> _originalPrice
        End If
    End Set
End Property

Private _override As Boolean
Public Property Override() As Boolean
    Get
        Return _override
    End Get
    Set(ByVal value As Boolean)
        If _override <> value Then
            _override = value
            If Not _override Then Price = OriginalPrice
        End If
    End Set
End Property 
```

无需处理表单中的任何 CheckedChanged 或 TextChanged 事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T03:00:29.130

您是否考虑过处理 TextBox [TextChanged](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.textchanged(VS.80).aspx)事件来处理 CheckBox 状态而不是绑定它？

然后，您可以将当前的 TextBox 值与原始值进行比较，并确定 CheckBox 是真还是假。

另一个想法是您可以继承 TextBox 并向您的自定义 TextBox 添加属性，以便 TextBox 处理它自己的状态。例如，它可以有一个只读的 IsOriginal 属性。

我现在没有安装VS，所以我没有验证它，如果你想要一个例子，请告诉我。

# c# - 从 XmlDocument 中获取带有换行符的缩进 XML 的最简单方法是什么？

> ID：203528
> 
> 赞同：111
> 
> 时间：2008-10-15T02:25:59.683
> 
> 标签：c#, .net, xmldocument, outerxml

当我从头开始构建 XML 时`XmlDocument`，该`OuterXml`属性已经将所有内容都很好地缩进了换行符。但是，如果我调用`LoadXml`一些非常“压缩”的 XML（没有换行符或缩进），那么输出就会`OuterXml`保持这种状态。所以 ...

从 的实例获取美化 XML 输出的最简单方法是`XmlDocument`什么？

* * *

## 回答 #1

> 赞同：221
> 
> 时间：2008-10-15T03:01:29.287

根据其他答案，我研究[`XmlTextWriter`](https://docs.microsoft.com/en-us/dotnet/api/system.xml.xmltextwriter)并提出了以下辅助方法：

```
static public string Beautify(this XmlDocument doc)
{
    StringBuilder sb = new StringBuilder();
    XmlWriterSettings settings = new XmlWriterSettings
    {
        Indent = true,
        IndentChars = "  ",
        NewLineChars = "\r\n",
        NewLineHandling = NewLineHandling.Replace
    };
    using (XmlWriter writer = XmlWriter.Create(sb, settings)) {
        doc.Save(writer);
    }
    return sb.ToString();
} 
```

它的代码比我希望的要多一些，但它的工作原理很简单。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2008-10-15T02:28:32.440

改编自[Erika Ehrli 的](http://blogs.msdn.com/erikaehrli/archive/2005/11/16/IndentXMLFilesandDocuments.aspx)博客，应该这样做：

```
XmlDocument doc = new XmlDocument();
doc.LoadXml("<item><name>wrench</name></item>");
// Save the document to a file and auto-indent the output.
using (XmlTextWriter writer = new XmlTextWriter("data.xml", null)) {
    writer.Formatting = Formatting.Indented;
    doc.Save(writer);
} 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2012-07-20T15:49:09.617

如果您可以访问 Linq，甚至更容易

```
try
{
    RequestPane.Text = System.Xml.Linq.XElement.Parse(RequestPane.Text).ToString();
}
catch (System.Xml.XmlException xex)
{
            displayException("Problem with formating text in Request Pane: ", xex);
} 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2010-10-16T03:11:45.203

更短的扩展方法版本

```
public static string ToIndentedString( this XmlDocument doc )
{
    var stringWriter = new StringWriter(new StringBuilder());
    var xmlTextWriter = new XmlTextWriter(stringWriter) {Formatting = Formatting.Indented};
    doc.Save( xmlTextWriter );
    return stringWriter.ToString();
} 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-09-13T07:14:05.070

`XmlDocument`如果为已经包含子节点的节点调用上述 Beautify 方法，`XmlProcessingInstruction`则会引发以下异常：

> 无法编写 XML 声明。WriteStartDocument 方法已经写好了。

这是我对原始版本的修改版本，以摆脱异常：

```
private static string beautify(
    XmlDocument doc)
{
    var sb = new StringBuilder();
    var settings =
        new XmlWriterSettings
            {
                Indent = true,
                IndentChars = @"    ",
                NewLineChars = Environment.NewLine,
                NewLineHandling = NewLineHandling.Replace,
            };

    using (var writer = XmlWriter.Create(sb, settings))
    {
        if (doc.ChildNodes[0] is XmlProcessingInstruction)
        {
            doc.RemoveChild(doc.ChildNodes[0]);
        }

        doc.Save(writer);
        return sb.ToString();
    }
} 
```

它现在对我有用，可能您需要扫描节点的所有子节点`XmlProcessingInstruction`，而不仅仅是第一个？

* * *

**2015 年 4 月更新：**

由于我遇到了另一种编码错误的情况，因此我搜索了如何在没有 BOM 的情况下强制执行 UTF-8。我找到[了这篇博文](http://www.timvw.be/2007/01/08/generating-utf-8-with-systemxmlxmlwriter/)并基于它创建了一个函数：

```
private static string beautify(string xml)
{
    var doc = new XmlDocument();
    doc.LoadXml(xml);

    var settings = new XmlWriterSettings
    {
        Indent = true,
        IndentChars = "\t",
        NewLineChars = Environment.NewLine,
        NewLineHandling = NewLineHandling.Replace,
        Encoding = new UTF8Encoding(false)
    };

    using (var ms = new MemoryStream())
    using (var writer = XmlWriter.Create(ms, settings))
    {
        doc.Save(writer);
        var xmlString = Encoding.UTF8.GetString(ms.ToArray());
        return xmlString;
    }
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-15T02:28:53.703

```
XmlTextWriter xw = new XmlTextWriter(writer);
xw.Formatting = Formatting.Indented; 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-11-17T00:39:09.143

```
 public static string FormatXml(string xml)
    {
        try
        {
            var doc = XDocument.Parse(xml);
            return doc.ToString();
        }
        catch (Exception)
        {
            return xml;
        }
    } 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-07-09T13:30:38.170

一个简单的方法是使用：

```
writer.WriteRaw(space_char); 
```

就像这个示例代码一样，这段代码是我用来使用 XMLWriter 创建树状视图的结构：

```
private void generateXML(string filename)
        {
            using (XmlWriter writer = XmlWriter.Create(filename))
            {
                writer.WriteStartDocument();
                //new line
                writer.WriteRaw("\n");
                writer.WriteStartElement("treeitems");
                //new line
                writer.WriteRaw("\n");
                foreach (RootItem root in roots)
                {
                    //indent
                    writer.WriteRaw("\t");
                    writer.WriteStartElement("treeitem");
                    writer.WriteAttributeString("name", root.name);
                    writer.WriteAttributeString("uri", root.uri);
                    writer.WriteAttributeString("fontsize", root.fontsize);
                    writer.WriteAttributeString("icon", root.icon);
                    if (root.children.Count != 0)
                    {
                        foreach (ChildItem child in children)
                        {
                            //indent
                            writer.WriteRaw("\t");
                            writer.WriteStartElement("treeitem");
                            writer.WriteAttributeString("name", child.name);
                            writer.WriteAttributeString("uri", child.uri);
                            writer.WriteAttributeString("fontsize", child.fontsize);
                            writer.WriteAttributeString("icon", child.icon);
                            writer.WriteEndElement();
                            //new line
                            writer.WriteRaw("\n");
                        }
                    }
                    writer.WriteEndElement();
                    //new line
                    writer.WriteRaw("\n");
                }

                writer.WriteEndElement();
                writer.WriteEndDocument();

            }

        } 
```

这样，您可以按照您通常习惯的方式添加制表符或换行符，即 \t 或 \n

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-05-13T14:27:24.690

在实施此处发布的建议时，我遇到了文本编码问题。似乎 的编码`XmlWriterSettings`被忽略了，并且总是被流的编码覆盖。使用 a 时`StringBuilder`，这始终是 C# 内部使用的文本编码，即 UTF-16。

所以这是一个支持其他编码的版本。

重要提示：如果您的对象在加载文档时启用`XMLDocument`了其属性，则格式将被完全忽略。`preserveWhitespace`这让我困惑了一段时间，所以请确保不要启用它。

我的最终代码：

```
public static void SaveFormattedXml(XmlDocument doc, String outputPath, Encoding encoding)
{
    XmlWriterSettings settings = new XmlWriterSettings();
    settings.Indent = true;
    settings.IndentChars = "\t";
    settings.NewLineChars = "\r\n";
    settings.NewLineHandling = NewLineHandling.Replace;

    using (MemoryStream memstream = new MemoryStream())
    using (StreamWriter sr = new StreamWriter(memstream, encoding))
    using (XmlWriter writer = XmlWriter.Create(sr, settings))
    using (FileStream fileWriter = new FileStream(outputPath, FileMode.Create))
    {
        if (doc.ChildNodes.Count > 0 && doc.ChildNodes[0] is XmlProcessingInstruction)
            doc.RemoveChild(doc.ChildNodes[0]);
        // save xml to XmlWriter made on encoding-specified text writer
        doc.Save(writer);
        // Flush the streams (not sure if this is really needed for pure mem operations)
        writer.Flush();
        // Write the underlying stream of the XmlWriter to file.
        fileWriter.Write(memstream.GetBuffer(), 0, (Int32)memstream.Length);
    }
} 
```

这将使用给定的文本编码将格式化的 xml 保存到磁盘。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-07-09T16:52:13.110

如果你有一个 XML 字符串，而不是一个可以使用的文档，你可以这样做：

```
var xmlString = "<xml>...</xml>"; // Your original XML string that needs indenting.
xmlString = this.PrettifyXml(xmlString);

private string PrettifyXml(string xmlString)
{
    var prettyXmlString = new StringBuilder();

    var xmlDoc = new XmlDocument();
    xmlDoc.LoadXml(xmlString);

    var xmlSettings = new XmlWriterSettings()
    {
        Indent = true,
        IndentChars = " ",
        NewLineChars = "\r\n",
        NewLineHandling = NewLineHandling.Replace
    };

    using (XmlWriter writer = XmlWriter.Create(prettyXmlString, xmlSettings))
    {
        xmlDoc.Save(writer);
    }

    return prettyXmlString.ToString();
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-08-31T13:56:55.263

基于接受的答案的更简化的方法：

```
static public string Beautify(this XmlDocument doc) {
    StringBuilder sb = new StringBuilder();
    XmlWriterSettings settings = new XmlWriterSettings
    {
        Indent = true
    };

    using (XmlWriter writer = XmlWriter.Create(sb, settings)) {
        doc.Save(writer);
    }

    return sb.ToString(); 
} 
```

不需要设置新行。缩进字符也有默认的两个空格，所以我也不想设置它。

# gridview - Ajax 和 GridView-Fu——如何让 AccordionPanes 与 GridViews 一起工作？

> ID：203538
> 
> 赞同：2
> 
> 时间：2008-10-15T02:30:28.910
> 
> 标签：gridview, asp.net-ajax

好的，我知道这里有人曾经尝试过这种忍者精英级别的编码。基本上我想做的是：

我想要一个 GridView，其中返回的每一行都成为 asp.net-ajax AccordionPane 的标题部分。每行也有一些唯一的键，当您单击每个 AcccordionPane 标题时，它将依次显示内容窗格，然后打开另一个 GridView，其中填充了从具有该唯一性的数据库中提取的信息钥匙。

现在我知道有人尝试过这种疯狂的事情 --- 看起来并没有那么难，请查看名为 awni 的海报中的 cooments 部分：

[http://www.asp.net/learn/ajax-videos/video-87.aspx](http://www.asp.net/learn/ajax-videos/video-87.aspx)

```
<ajaxToolkit:AccordionPane ID="AccordionPane2>
    <Header>
       **********EACH HEADER IS A ROW FROM A DATABASE 
    </Header>
    <Content>
        <asp:GridView  DataSourceID="SqlDataSource1">
        <Columns>
           **********THIS GRIDVIEW IS POPULATED WITH A DATABASE QUERY
        </Columns>
        </asp:GridView>
    </Content>
</ajaxToolkit:AccordionPane> 
```

是否可以？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T20:13:12.107

您是否尝试过 ListView？我认为您可以在 ItemTemplate 中定义 AccordianPanes，然后在每一行内绑定一个内部 GridView 或 ListView。唯一的缺点是它会在加载时填充所有 Grid/ListViews。

# php - 除了编写插件和主题之外，是否有必要在任何情况下修改 Wordpress？

> ID：203543
> 
> 赞同：2
> 
> 时间：2008-10-15T02:34:18.840
> 
> 标签：php, wordpress

我最近不得不从事一个项目，以前的开发人员修改了 wp-admin 目录。对我来说这似乎是个坏主意，因为 Wordpress 会不断更新。我只是没有那种修改 Wordpress 的专业水平吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-15T02:41:46.143

作为开源，我认为像 WordPress 这样的软件在任何时候都可以修改和扩展。

修改或不修改是权衡取舍。新功能可以封装为模块，这可能会导致其功能的集成度低于预期。但是，完全集成更改可能会阻碍随着新版本的发布而轻松更新软件。

它确实需要非常熟悉软件的人才能直接修改软件，但这不一定是一个坏主意。

顺便说一句，我认为修改 WordPress 几乎是必要的，特别是如果您希望它具有体面的架构或实际上是安全的（好吧，那是一个刺拳，起诉我）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-15T03:43:30.370

好吧，这只是一个坏主意，因为这意味着您现在负责维护内部事实上的分叉……每次 WordPress 发布更新时，您都必须进行三向差异以将您的更改合并到新的“真实“ WordPress。（三向差异意味着您在旧版本的分支和标准旧版本之间进行差异以构建补丁集，然后将该补丁集应用于新版本。）您还应该自己使用 VCS 来保持自己理智的。

如果你做不到这一点，那么你就做不到，遵循 KISS 原则并且不弄乱应用程序代码并没有错。

如果您可以编写一个插件来做同样的事情并且同样高效，那么您应该这样做，这样您就不必维护自己的 fork。

但是，WordPress 有很多糟糕的地方（效率、安全性），您可以通过破解应用程序代码来改善（有时不需要做太多工作，只需禁用您不需要的代码）。WordPress 是肮脏的遗留意大利面条代码，最初是由对软件或数据库设计知识几乎为零的人编写的，它做了很多非常愚蠢的事情，比如*在每次请求*时查询数据库以查看它自己的`siteurl`内容，而这永远不会改变——有花 5 分钟时间更改 2 行代码并没有错，所以它不再这样做了。

我在当时排名前 20 的 Technorati 博客中担任技术主管，并做了很多工作以在单个服务器上扩展 WordPress，然后扩展到集群（管理员与公共访问具有单独的服务器）。我们有上游反向代理（即 Varnish 或 Squid）充当 HTTP 加速器和一个内部对象/页面片段缓存系统，该系统插入 memcached 并使用 PEAR::Cache_Lite 故障转移到文件系统缓存。我们不得不修改 WordPress 来做一些事情，比如发送理智的、缓存友好的 HTTP 标头，以禁用许多不必要的 SQL 和处理。

我修改了 WP 以使用 MySQL 的仅内存 NDB 集群存储引擎运行，这意味着在很多查询中指定索引（但最终我们选择了复制集群）。在将其修改为在单独的服务器上运行以供管理员和公共访问时，我们锁定了公共端版本，因此它以大大降低的 MySQL 权限运行，只允许读取（第三个 MySQL 用户获得了评论权限）。

如果您有严重的垃圾评论问题（即 10K/小时），那么您*必须*做一些超越插件的事情。垃圾邮件会拒绝你，因为 WordPress 刚刚初始化其核心在没有并发的独立 P4 上大约需要半秒，而且由于 WP 是一个代码毛球，所以如果不先初始化核心就无法做任何事情。

“WP-Cron” 是脑死的，如果您可以访问实际的 crontab 来执行这些功能，则应该禁用它。做起来不难。

简而言之，我可以继续列出您可能想要进行修改的原因。

在整个过程中，出于可维护性的原因，将这些修改保持在最低限度并尽可能清晰地记录它们当然是一个目标，并且在有意义时我们将许多作为插件实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T02:46:01.453

在一个博客/论坛组合中，我们将注册程序整合在一起，以便人们填写一张表格同时注册 WordPress 和 phpBB。我确信使用插件有更好的方法来做到这一点，但它确实有一个意想不到的好处——它真的让垃圾邮件机器人感到困惑。尽管每天都有几个人注册，但我们在论坛的生活中大约有两个垃圾邮件帖子。

当然，我不建议这样做 - 它会阻止我们升级任何一个软件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T02:50:08.013

如果可能的话，我倾向于强烈反对修改核心代码，尤其是在像 WordPress 这样更新的项目中。如果 WordPress 无法通过插件等来完成您需要的工作，那么您最好使用像 Drupal 这样可扩展/通用的系统。将面向博客的 CMS 入侵到其他东西中可能不值得。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-16T01:16:45.173

在旧版本的 WordPress（1.0 甚至早期的 2.0）中，我不会对修改 WordPress 本身视而不见。

然而，WordPress 的架构已经成熟。侧边栏不再需要手动编码。相反，您可以移植您的主题以使用小部件并创建小部件（真是天赐良机！）。不喜欢某些东西的显示方式 - 只需修改主题！不喜欢 WordPress 的处理方式？创建一个插件。我很难想出修改 WordPress 代码本身的理由，而这些代码本身无法通过 WordPress 的现代模块化组件（小部件、插件、主题）来处理。

我是那种总是在像 WordPress 这样的开源应用程序中获得“幕后”的人。然而，如今，真的没有充分的理由来修改核心 WordPress 代码。

# c++ - 链接上未定义的符号 ___gxx_personality_v0

> ID：203548
> 
> 赞同：54
> 
> 时间：2008-10-15T02:36:38.213
> 
> 标签：c++, c, gcc, g++

我一直在用这个命令行构建这个未定义的符号：

```
$ gcc test.cpp
Undefined symbols:
  "___gxx_personality_v0", referenced from:
  etc... 
```

test.cpp 很简单，应该可以正常构建。什么是交易？

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2008-10-15T02:38:09.393

采用

```
g++ test.cpp 
```

相反，因为这是 C++ 代码。

* * *

或者，如果您*真的*想使用`gcc`，请添加`-lstdc++`到命令行，如下所示：

```
gcc test.cpp -lstdc++ 
```

在每个场景下运行产生`md5`的`a.out`结果表明它是相同的输出。

但是，是的，`g++`可能会让你的世界变得更简单。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-26T17:13:21.577

该`.cpp`扩展会导致`gcc`将您的文件编译为 C++ 文件。（请参阅[GCC 文档](http://gcc.gnu.org/onlinedocs/gcc-4.4.1/gcc/Overall-Options.html#index-file-name-suffix-71)。）

尝试编译相同的文件，但将其重命名为具有`.c`扩展名：

```
mv test.cpp
gcc test.c 
```

`-x c`或者，您可以通过传递给编译器来显式指定语言：

```
gcc -x c -c test.cpp -o test.o 
```

* * *

如果您`nm test.o`在这些 C 语言版本上运行，您会注意到它`___gxx_personality_v0`没有作为符号列出。
（如果您在使用 生成的目标文件上运行相同的命令`gcc -c test.cpp -o test.o`，则该`___gxx_personality_v0`符号存在。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-12-02T22:08:38.143

以防万一有人和我有同样的问题：文件扩展名应该`.c`不是 a `.C`（gcc 区分大小写）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-08-29T18:38:22.620

有同样的问题，但有不同的解决方案：

静态库中的 C++ 代码被链接，并被 .m 文件引用。将 .m 文件重命名为 .mm 可解决此问题。

# rest - 互联互通有什么好处？

> ID：203549
> 
> 赞同：2
> 
> 时间：2008-10-15T02:37:29.410
> 
> 标签：rest

面向资源的架构 (ROA) 定义的连通性有什么好处？按照我的理解，连通性的关键是能够仅使用根 URI 来抓取整个应用程序状态。

但这真的有用吗？

例如，假设 HTTP GET [http://example.com/users/joe](http://example.com/users/joe)返回一个指向[http://examples.com/uses/joe/bookmarks](http://examples.com/uses/joe/bookmarks)的链接。

除非您正在编写一个愚蠢的网络爬虫（即使这样我也想知道），您仍然需要在编译时教客户每个链接的含义。也就是说，客户端需要知道“书签 URI”返回书签资源的 URI，然后将控制权交给特殊的书签处理算法。您不能只是盲目地将链接传递给某些通用客户端方法。因为无论如何你都需要这个逻辑：

1.  客户端在运行时找出 URI 与在编译时提供它（使[http://example.com/users/bookmarks](http://example.com/users/bookmarks)成为根 URI）有什么区别？

2.  为什么使用`[http://example.com/users/joe/bookmarks/2](http://example.com/users/joe/bookmarks/2)`首选链接`id="2"`？

我能想到的唯一好处是能够随着时间的推移更改非根 URI 的路径，但这会破坏缓存的链接，因此无论如何它并不是真正可取的。我错过了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T16:05:39.920

你是对的，改变 Uris 是不可取的，但它确实发生了，使用完整的 Uris 而不是构造它们会使更改更容易处理。

另一个好处是您的客户端应用程序可以轻松地从多个主机检索资源。如果您允许您的客户端构建 URI，则客户端需要知道某些资源驻留在哪个主机上。当所有资源都位于单个主机上时，这没什么大不了的，但是当您聚合来自多个主机的数据时，它变得更加棘手。

我最后的想法是，也许您将连通性的概念视为静态链接网络，从而过度简化了连通性的概念。当然，客户需要知道资源中可能存在的某些链接，但不一定需要确切知道跟随该链接的后果是什么。

让我举个例子：一个用户正在为一些物品下订单，他们准备提交他们的购物车。提交链接实际上可能会转到两个不同的地方，具体取决于订单是在本地交付还是在国际交付。也许超过一定价值的订单需要经过额外的步骤。客户端只知道它必须遵循提交链接，但它不知道下一步要去哪里。当然，您可以构建一个通用的“下一步”类型的资源，以便客户端可以明确地了解这些知识，但是通过让服务器动态传递链接，您可以减少客户端-服务器耦合。

我认为资源中的链接是用户可以选择做什么的占位符。谁来做这项工作以及如何完成工作取决于服务器附加到该链接的 uri。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T03:03:38.780

它更容易扩展，您可以编写小应用程序和脚本来相当容易地与核心应用程序一起工作。

补充：嗯，整点开始于您没有在编译时指定如何以硬编码方式将 URI 转换为 uid 的想法，而是您可以使用字典或解析来做到这一点，从而为您提供更灵活的系统。

然后稍后说其他人决定更改 URI 语法，该人可以编写一个小脚本来翻译 URI，而无需接触您的核心应用程序。另一个好处是，如果您的 URI 是合乎逻辑的其他用户，即使在公司场景中，也可以轻松编写 Mash-ups 以使用您的系统，而无需触及您的原始应用程序甚至重新编译它。

当然，与整个论点相反的是，在简单的 UID 系统上实现基于 URI 的系统将花费您更长的时间。但是如果你的 App 会被其他人以常规方式使用，那么最初的时间投资将获得很大的回报（可以说具有良好的基于​​可扩展性的 ROI）。

补充：另外一点在某种程度上是一个口味问题，URI 本身将是一个更好的名称，因为它传达了一个逻辑和定义的含义

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-19T02:03:18.697

我将添加我自己的答案：

1.  遵循服务器提供的 URI 比自己构建它们要容易得多。当资源关系变得过于复杂而无法用简单的规则表达时，尤其如此。在服务器中编写一次逻辑比在众多客户端中重新实现它更容易。
2.  即使单个资源 URI 保持不变，资源之间的关系也可能发生变化。例如，假设谷歌地图从 0 到 100 索引他们的地图图块，从屏幕的左上角到右下角计数。如果谷歌地图要改变他们的瓦片的比例，计算相对瓦片索引的客户端就会崩溃。
3.  Custom IDs identify a resource. URIs go a step further by identifying how to retrieve the resource representation. This simplifies the logic of read-only clients such as web-crawlers or clients that download opaque resources such as video or audio files.

# .net - Graphics.MeasureString 返回与 Win32 GetTextExtent 不同的值

> ID：203577
> 
> 赞同：3
> 
> 时间：2008-10-15T02:59:03.143
> 
> 标签：.net, winforms, dpi, highdpi

我一直在尝试在 C# 中找到一种方法来测量字符串的大小。在 Win32 中测量字符串的[标准方法](http://support.microsoft.com/kb/145994)是使用 GetTextExtent。真正的目标是找到字体字符的*平均*宽度和高度。查找字符平均宽度的标准方法是从获取所有字母字符的宽度并除以 52 开始：

```
size = dc.GetTextExtent(
       "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz", 52);
averageWidth = size / 52; 
```

Microsoft 有一个页面列出了某些 DPI 设置下某些字体大小的[平均字符宽度](http://msdn.microsoft.com/en-us/library/bb847924.aspx)，我已经通过我自己对 GetTextExtent 的调用确认了它们。

*   **塔荷马 8pt, 96dpi:** 13x6 像素
*   **塔霍马 9pt，96dpi：** 14x7 像素
*   **Segoe UI 9pt，96dpi**：15x7 像素

现在我想在 .NET WinForms 下执行相同的计算。使用 Graphics.MeasureString() 我想出了代码：

```
public static SizeF GetAvgCharSizeF(Graphics g, Font font)
{
   String s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";

   SizeF textSize = g.MeasureString(s, font);

   float baseUnitX = (textSize.Width / s.Length);
   float baseUnitY = textSize.Height;

   return new SizeF(baseUnitX, baseUnitY);
} 
```

不幸的是，这些值与已知的、可接受的真实值不匹配：

*   **Tahoma 8pt，96dpi：** 14x6 像素*（14.21x6.09 像素）*
*   **Tahoma 9pt，96dpi：** 16x7 像素*（15.98x6.85 像素）*
*   **Segoe UI 9pt，96dpi：** 17x7 像素*（17.46x6.91 像素）*

平均字符宽度结果还可以，但字符高度太大了约 13%。我假设额外的高度是由于高度分类的差异已更改为包括上升者和下降者。如果测量字符串太高，我尝试将其更改为：

```
String s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"; 
```

到

```
String s = "acemnorsuvwxyz"; 
```

认为现在字符串没有那么高，所以测量的高度应该更短。不，它返回的高度与包含上升器和下降器的字符串版本*完全相同*（尽管平均宽度稍大一些）。

这可能是什么原因，并且可以获得平均字符高度可以对平均文本高度做什么，使其与 GetTextExtent 返回的可接受值匹配？

注意：尽管获取平均字符高度的标准做法是使用 GetTextMetrics，但 GetTextExtents 返回的高度返回相同的值。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T03:09:37.553

我怀疑这是因为 .NET 中的文本渲染引擎不同。您可能想要查找 GDI 和 GDI+ 之间的差异。如果您调用该`Application.SetCompatibleTextRenderingDefault(<bool>)`方法，使用 true 或 false 作为参数，情况也可能会再次发生变化（我相信默认值为 true）。

一般来说，如果您使用 Windows API 进行绘图，则使用 Windows API 进行测量，如果您使用 .NET 进行绘图，则使用 .NET 进行测量。

# java - Java Servlet：性能

> ID：203586
> 
> 赞同：4
> 
> 时间：2008-10-15T03:04:16.830
> 
> 标签：java, ajax, servlets

我正在开发一个 Java 中的 Web 应用程序，它通过 AJAX 调用从 servlet 获取数据。

该应用程序具有几个页面元素，它们以相当快的间隔从服务器获取新数据。

有很多用户，对服务器的需求可能会变得相当高，所以我很好奇：

**哪种方法提供最佳性能：**

许多 servlet（每种类型的数据请求一个）？

**或者：**

一个可以处理所有请求的 servlet？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-15T03:07:09.057

拥有多个 servlet 没有性能原因。在 Web 应用程序中，无论有多少请求，都只会实例化一个 servlet 类的实例。请求不是序列化的，它们是并发处理的，因此您的 servlet 需要是线程安全的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T03:13:17.747

[struts 框架](http://struts.apache.org/)对应用程序中的所有内容都使用一个 servlet。你的东西插入到那个 servlet 中。如果它对他们有用，它可能对你有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T03:42:15.210

拥有多个服务的一个可能原因是，如果您将来需要扩展到多个服务器来处理负载，那么将单独的服务移动到它自己的服务器上比在一切都在“幕后”进行更容易一项服务。

话虽如此，如果您有多个 servlet，则会有额外的维护开销，因此需要平衡未来的灵活性和较低的可维护性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T03:58:30.263

如果您使用多个 servlet，则没有性能增强，因为每个 servlet 请求都在单独的线程中处理，前提是它不是单线程的。

但是保持代码的模块化和分离，您可以拥有多个 servlet。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-15T03:19:25.210

就像 Tony 说的那样，真的没有理由使用多个 servlet，除非您需要分解一个复杂的 Java Servlet 类或者可能实现一个拦截过滤器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-15T05:55:29.607

我相信您知道，只要您在 web.xml 文件中为您的应用程序注册不同的节点，您就可以拥有同一个 servlet 的多个实例——即，假设您想这样做。

除此之外，据我了解，您可能会从彗星架构中受益——http: [//en.wikipedia.org/wiki/Comet_(programming)](http://en.wikipedia.org/wiki/Comet_(programming))。
在一些 servlet 容器上已经有一些 Comet 的实现——这里看看如何使用 Ajax 和 Comet—— [http://www.ibm.com/developerworks/java/library/j-jettydwr/](http://www.ibm.com/developerworks/java/library/j-jettydwr/)。在决定你的架构之前，你应该学习。

BR，
~A

# iphone - iPhone SDK：-[UILabel setFont:] 中的断言失败

> ID：203589
> 
> 赞同：1
> 
> 时间：2008-10-15T03:04:44.927
> 
> 标签：iphone

我有一个 iPhone 应用程序，可以在我笔记本电脑的模拟器中编译和运行良好。现在，我尝试在 iMac 上的模拟器中构建和运行相同的代码，它会启动并让我单击一个按钮，但随后出现断言失败。

这是控制台中的内容：

```
*** Assertion failure in -[UILabel setFont:], /SourceCache/UIKit/UIKit-738/UILabel.m:438
*** Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'Invalid parameter not satisfying: font != nil'
Stack: (
2493366603,
2432871995,
2493366059,
2459146836,
817183141,
817926218,
837317240,
837317032,
837315376,
837314643,
2492860866,
2492867620,
2492869880,
85304,
85501,
816175835,
816221412,
9096,
8930
) 
```

这是堆栈跟踪：

```
#0  0x949dbff4 in ___TERMINATING_DUE_TO_UNCAUGHT_EXCEPTION___
#1  0x9102ae3b in objc_exception_throw
#2  0x94962ad3 in CFRunLoopRunSpecific
#3  0x94962cf8 in CFRunLoopRunInMode
#4  0x00014d38 in GSEventRunModal
#5  0x00014dfd in GSEventRun
#6  0x30a5dadb in -[UIApplication _run]
#7  0x30a68ce4 in UIApplicationMain
#8  0x00002388 in main at main.m:16 
```

我的代码没有直接调用 setFont:。但是，这将是程序执行中某些按钮第一次可见的点。

我已经谷歌了。一些有类似问题的人说，当他们编辑 NIB、改变他们的时区或其他奇怪的东西时，这个问题得到了神奇的解决。

任何想法真正的原因是什么？

（请不要抱怨保密协议。）

* * *

**更新：**如果我将某些按钮的字体从“TimesNewRomanPS-BoldMT”更改为“Times”，则不再发生断言失败。但是为什么我不能使用所需的字体，它存在于 iPhone 上，安装在新机器上，并且可以在 Interface Builder 中选择？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T03:45:05.233

如果您的 xib 文件中有 UILabel，它们可能以某种方式损坏，或者您可能为它们设置了在您的两台机器上都不存在的字体（您可以在编辑 UILabel 时使用 command-T 来调出字体选择器；不确定是否可以设置非 iPhone 字体，但可以）。否则，请尝试从您的 xib 文件中删除 UILabels，直到它运行为止，这就是您的罪魁祸首。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T09:07:13.607

如果它不是一个 UILabel，它可能是一个 UIButton（它包含一个 UILable）等等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-04T20:49:56.750

有同样的问题，但在特殊情况下。仅当代码为 iOS 4 编译但部署在 3.1.3 删除 Arial-Narrow 的设备上并且它工作时。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-14T10:31:43.310

并非所有字体都在 iphone 中可用，只有某些字体可用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-21T00:35:29.853

我们遇到了这个问题，因为我们使用`[UIFont fontWithName:fontSize:]`了名称`Helvatica Bold`（带空格）而不是`Helvetica-Bold`（带破折号）。`Helvatica Bold`显然适用于当前的操作系统版本，但不适用于 iOS 3.1。`Helvetica-Bold`似乎是正确的版本。

# visual-studio - 在 VS 2003 中包含目录

> ID：203590
> 
> 赞同：0
> 
> 时间：2008-10-15T03:05:53.380
> 
> 标签：visual-studio, include

Visual Studio 2003 中为单个项目设置包含路径的设置在哪里？我知道工具>选项中的 VC 目录选项，但这是特定于机器的，当我将其交给其他开发人员时无济于事。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T03:12:20.090

![替代文字](https://www.lemurproject.org/images/VS_Net_AdditionalIncludes.jpg)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T04:07:52.443

奇怪的是我没有看到那个选项。我最终在 jedit 中打开了 vcproj 文件并将其写入。

[idontknow http://img88.imageshack.us/img88/1128/idontknowmanln2.jpg](http://img88.imageshack.us/img88/1128/idontknowmanln2.jpg)

# sql - SQL 查询中的投影/复制？

> ID：203591
> 
> 赞同：0
> 
> 时间：2008-10-15T03:06:19.930
> 
> 标签：sql, tsql

我的 SQL 有点生疏——有没有一种 SQL 方法可以投影一个看起来像这样的输入表：

```
Name                SlotValue              Slots
----                ---------              -----
ABC                 3                      1
ABC                 4                      2
ABC                 6                      5 
```

进入一个看起来像这样的“投影”结果表：

```
Name                SlotSum                 Slot
----                -------                 ----
ABC                 13                      1
ABC                 10                      2
ABC                 6                       3
ABC                 6                       4
ABC                 6                       5 
```

换句话说，结果集应该包含等于 MAX(Slots) 的行数，从 1 到 MAX(Slots) 的枚举 (Slot)，并且每个“slots”的总和应该反映投影出的 SlotValues 的总和到“插槽”位置。对于病理情况：

```
Name               SlotValue                Slots
----               ---------                -----
ABC                4                        3 
```

我们应该得到：

```
Name               SlotSum                  Slot
----               -------                  ----
ABC                4                        1
ABC                4                        2
ABC                4                        3 
```

求和逻辑非常简单——将每个 SlotValue 投影到 Slot 的数量：

```
SlotValue         SlotValue        SlotValue       Slot             Sum
---------         ---------        ---------       ----             ---
3                 4                6               1                13 (3+4+6)
0                 4                6               2                10 (0+4+6)
0                 0                6               3                6 (0+0+6)
0                 0                6               4                6 (0+0+6)
0                 0                6               5                6 (0+0+6) 
```

更新：最后我在存储过程中使用了 LOCALGHOST 方法的变体。我希望可能有一种方法可以在没有循环的情况下做到这一点。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-15T03:28:31.603

我不确定您能否在视图中执行此操作。你必须使用一个程序。您也可以在过程中使 ProjectedTable 成为临时/变量表。我真的很想看看您如何将其放入视图中，因为您需要动态生成一系列数字。

```
declare @maxSlot int 
set @maxSlot = select max(slots) from SlotTable

truncate ProjectedTable
while @i > 0 
    begin
    insert into ProjectedTable (
          SlotSum
          ,Slot
    ) values (
          (select sum(slotValue) from SlotTable where slots >= @maxSlot)
         ,@maxSlot
    )
    set @maxSlot = @maxSlot - 1 
end
select SlotSum, Slot from ProjectedTable 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T03:40:02.640

干得好。这将以其当前形式执行多达 100 个插槽。你可以发挥你的想象力来容纳更多。

```
DECLARE @SLOT TABLE
    (
    SlotName varchar(25) NOT NULL,
    SlotValue int NOT NULL,
    Slot int NOT NULL
    )

INSERT INTO @SLOT (SlotName, SlotValue, Slot)
    SELECT 'ABC', 3, 1
    UNION
    SELECT 'ABC', 4, 2
    UNION
    SELECT 'ABC', 6, 5

SELECT
    CASE
        WHEN SLOT.SlotName IS NOT NULL THEN SLOT.SlotName
        ELSE 
            COALESCE(
            (SELECT TOP 1 SL.SlotName FROM @SLOT AS SL WHERE SL.Slot < SLOT_PROJECT.Slot ORDER BY SL.Slot DESC),
            (SELECT TOP 1 SL.SlotName FROM @SLOT AS SL WHERE SL.Slot > SLOT_PROJECT.Slot ORDER BY SL.Slot ASC)
            )
    END AS SlotName,
    (
    SELECT
        SUM(SLOT10.SlotValue)
    FROM
        @SLOT AS SLOT10
    WHERE
        SLOT10.Slot >= SLOT_PROJECT.Slot
    ) AS SlotSum,
    SLOT_PROJECT.Slot
FROM
    (
    SELECT
        (TENS.Seq + ONES.Seq) AS Slot
    FROM
        (
        SELECT 1 AS Seq
        UNION ALL
        SELECT 2
        UNION ALL
        SELECT 3
        UNION ALL
        SELECT 4
        UNION ALL
        SELECT 5
        UNION ALL
        SELECT 6
        UNION ALL 
        SELECT 7
        UNION ALL
        SELECT 8
        UNION ALL
        SELECT 9
        ) AS ONES
        CROSS JOIN
        (
        SELECT 0 AS Seq
        UNION ALL
        SELECT 10
        UNION ALL
        SELECT 20
        UNION ALL
        SELECT 30
        UNION ALL
        SELECT 40
        UNION ALL
        SELECT 50
        UNION ALL
        SELECT 60
        UNION ALL 
        SELECT 70
        UNION ALL
        SELECT 80
        UNION ALL
        SELECT 90
        ) AS TENS
    WHERE
        (TENS.Seq + ONES.Seq) <= (SELECT MAX(Slot) FROM @SLOT)
    ) AS SLOT_PROJECT
    LEFT JOIN @SLOT AS SLOT ON
        SLOT.Slot = SLOT_PROJECT.Slot 
```

# regex - 如何在 Perl 中仅匹配 Unicode 字符串中的完全组合字符？

> ID：203605
> 
> 赞同：8
> 
> 时间：2008-10-15T03:10:13.510
> 
> 标签：regex, perl, unicode, locale, character-properties

我正在寻找一种仅匹配 Unicode 字符串中完全组成的字符的方法。

是否`[:print:]`依赖于包含此字符类的任何正则表达式实现中的语言环境？例如，它会匹配日文字符“あ”，因为它不是控制字符，还是`[:print:]`总是 ASCII 码 0x20 到 0x7E？

是否有任何字符类（包括 Perl RE）可用于匹配控制字符以外的任何内容？如果`[:print:]`仅包含 ASCII 范围内的字符，我会假设`[:cntrl:]`也包含。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-15T05:27:30.287

```
echo あ| perl -nle 'BEGIN{binmode STDIN,":utf8"} print"[$_]"; print /[[:print:]]/ ? "YES" : "NO"' 
```

这主要是有效的，尽管它会生成一个关于宽字符的警告。但它给了你一个想法：你必须确保你正在处理一个真正的 unicode 字符串（检查 utf8::is_utf8）。或者只是检查[perlunicode](http://search.cpan.org/~tty/kurila-1.14_0/pod/perlunicode.pod "perlunicode") - 整个主题仍然让我头晕目眩。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-15T06:48:26.190

我认为您不需要或不需要语言环境，而是Unicode。如果您已解码文本字符串，`\w`将匹配任何语言中的单词字符，`\d`不仅匹配`0..9`每个 Unicode 数字等。在正则表达式中，您可以使用`\p{PropertyName}`. 对你来说特别有趣的可能是`\p{Print}`。[这是所有可用 Unicode 字符属性的列表](http://perldoc.perl.org/perluniprops.html)。

我写了[一篇关于 Unicode 和 Perl 的基础知识和精妙之处的文章](http://perlgeek.de/en/article/encodings-and-unicode)，它应该让你很好地了解 perl 会将你的字符串识别为一个字符序列，而不仅仅是一个字节序列。

更新：使用 Unicode，您不会获得依赖于语言的行为，而是无论语言如何，都是合理的默认值。这可能是您想要的，也可能不是您想要的，但是为了区分可打印/控制字符，我不明白为什么您需要依赖语言的行为。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-01-07T23:12:47.990

`\X`匹配一个完全组合的字符（序列）。证明：

```
#!/usr/bin/env perl
use 5.010;
use utf8;
use Encode qw(encode_utf8);

for my $string (qw(あ ご ご), "\x{3099}") {
    say encode_utf8 sprintf "%s $string", $string =~ /\A \X \z/msx ? 'ok' : 'nok';
} 
```

测试数据是：一个普通字符、一个预组合字符、一个组合字符序列和一个组合字符（它本身“不算数”，对Unicode第3章的简化）。

替换`\X`为`[[:print:]]`看到 Tanktalus 的答案在最后两种情况下产生错误匹配。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-15T03:11:14.803

是的，这些表达式取决于语言环境。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-15T03:26:58.080

您始终可以使用字符类`[^[:cntrl:]]`来匹配非控制字符。

# c# - 为什么 C# 不提供 C++ 风格的“朋友”关键字？

> ID：203616
> 
> 赞同：217
> 
> 时间：2008-10-15T03:23:43.360
> 
> 标签：c#, c++, design-patterns, oop, friend

[C++ 朋友关键字](http://www.cplusplus.com/doc/tutorial/inheritance/)允许将 a指定`class A`为其`class B`朋友。这允许`Class B`访问`private`/的`protected`成员`class A`。

我从来没有读过任何关于为什么 C#（和 VB.NET）忽略它的内容。[对这个较早的 StackOverflow 问题](https://stackoverflow.com/questions/17434/when-should-you-use-friend-in-c)的大多数答案似乎都在说它是 C++ 的一个有用部分，并且有充分的理由使用它。根据我的经验，我不得不同意。

在我看来，另一个[问题](https://stackoverflow.com/questions/200079/inheritance-trees-and-protected-constructors-in-c#200117)实际上是在问如何`friend`在 C# 应用程序中做类似的事情。虽然答案通常围绕嵌套类，但它似乎不如使用`friend`关键字那么优雅。

最初的《[设计模式》一书](https://rads.stackoverflow.com/amzn/click/com/0201633612)在其示例中经常使用它。

所以总而言之，为什么 C# 中`friend`缺少，以及在 C# 中模拟它的“最佳实践”方式（或方式）是什么？

（顺便说一句，`internal`关键字*不是*一回事，它允许整个程序集中的*所有*类访问`internal`成员，同时`friend`允许您让某个类*完全访问*另一个*类*）

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-10-15T10:01:45.600

在旁注中。使用朋友不是违反封装，相反，它是关于执行它。就像访问器+修改器、运算符重载、公共继承、向下转换*等*一样，它经常被误用，但这并不意味着关键字没有，或者更糟的是，没有一个不好的用途。

请参阅另一个线程中的[Konrad Rudolph](https://stackoverflow.com/users/1968/konrad-rudolph)的[消息](https://stackoverflow.com/questions/17434/when-should-you-use-friend-in-c#17505)，或者如果您愿意，请参阅C++ FAQ 中[的相关条目](https://isocpp.org/wiki/faq/friends#friends-and-encap)。

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2008-10-15T03:40:47.333

在编程中有朋友或多或少被认为是“肮脏的”并且容易被滥用。它破坏了类之间的关系并破坏了 OO 语言的一些基本属性。

话虽如此，这是一个不错的功能，我自己在 C++ 中使用过很多次；并且也想在 C# 中使用它。但我敢打赌，因为 C# 的“纯”OOness（与 C++ 的伪 OOness 相比）MS 决定因为 Java 没有朋友关键字 C# 也不应该（开个玩笑；））

严肃地说：内部不如朋友，但它确实完成了工作。请记住，您很少会不通过 DLL 将代码分发给 3rd 方开发人员；因此，只要您和您的团队了解内部类及其用途，就可以了。

**编辑**让我澄清一下friend关键字如何破坏OOP。

私有和受保护的变量和方法可能是 OOP 中最重要的部分之一。对象可以保存只有它们可以使用的数据或逻辑的想法允许您编写独立于您的环境的功能实现 - 并且您的环境不能更改它不适合处理的状态信息。通过使用friend，您将两个类的实现耦合在一起——这比只耦合它们的接口要糟糕得多。

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2008-10-15T05:41:25.453

对于信息，.NET 中另一个相关但不完全相同的东西是`[InternalsVisibleTo]`，它允许程序集指定另一个程序集（例如单元测试程序集），该程序集（有效地）具有对类型/成员的“内部”访问权限原始组件。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2016-05-15T13:06:17.513

事实上，C# 提供了以纯 OOP 方式获得相同行为而无需特殊词的可能性 - 它是私有接口。

至于问题[什么是朋友的C#等价物？](https://stackoverflow.com/questions/204739/what-is-the-c-sharp-equivalent-of-friend?answertab=votes#tab-top)被标记为与本文重复，没有人提出真正好的实现 - 我将在这里给出这两个问题的答案。

主要思想来自这里：[什么是私有接口？](https://stackoverflow.com/questions/792908/what-is-a-private-interface/792932#792932)

比方说，我们需要一些类来管理另一个类的实例并在它们上调用一些特殊方法。我们不想给任何其他类调用这个方法的可能性。这与朋友 c++ 关键字在 c++ 世界中所做的完全相同。

我认为实际实践中的一个很好的例子可能是全状态机模式，其中一些控制器更新当前状态对象并在必要时切换到另一个状态对象。

你可以：

*   公开 Update() 方法的最简单和最糟糕的方法 - 希望每个人都能理解它为什么不好。
*   下一种方法是将其标记为内部。如果你把你的类放到另一个程序集中就足够了，但即便如此，该程序集中的每个类都可以调用每个内部方法。
*   使用私有/受保护的接口 - 我遵循这种方式。

**控制器.cs**

```
public class Controller
{
    private interface IState
    {
        void Update();
    }

    public class StateBase : IState
    {
        void IState.Update() {  }
    }

    public Controller()
    {
        //it's only way call Update is to cast obj to IState
        IState obj = new StateBase();
        obj.Update();
    }
} 
```

**程序.cs**

```
class Program
{
    static void Main(string[] args)
    {
        //it's impossible to write Controller.IState p = new Controller.StateBase();
        //Controller.IState is hidden
        var p = new Controller.StateBase();
        //p.Update(); //is not accessible
    }
} 
```

那么，继承呢？

我们需要使用[由于不能将显式接口成员实现声明为虚拟](https://msdn.microsoft.com/en-us/library/aa664593(v=vs.71).aspx)并将 IState 标记为受保护以提供从 Controller 派生的可能性中描述的技术。

**控制器.cs**

```
public class Controller
{
    protected interface IState
    {
        void Update();
    }

    public class StateBase : IState
    {
        void IState.Update() { OnUpdate(); }
        protected virtual void OnUpdate()
        {
            Console.WriteLine("StateBase.OnUpdate()");
        }
    }

    public Controller()
    {
        IState obj = new PlayerIdleState();
        obj.Update();
    }
} 
```

**PlayerIdleState.cs**

```
public class PlayerIdleState: Controller.StateBase
{
    protected override void OnUpdate()
    {
        base.OnUpdate();
        Console.WriteLine("PlayerIdleState.OnUpdate()");
    }
} 
```

最后是如何测试类控制器抛出继承的示例： **ControllerTest.cs**

```
class ControllerTest: Controller
{
    public ControllerTest()
    {
        IState testObj = new PlayerIdleState();
        testObj.Update();
    }
} 
```

希望我涵盖所有情况，我的回答很有用。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-10-15T03:40:04.013

通过使用 C# 中的接口，您应该能够完成与 C++ 中使用“朋友”相同的事情。它要求您明确定义在两个类之间传递哪些成员，这是额外的工作，但也可能使代码更易于理解。

如果有人有一个不能用接口模拟的合理使用“朋友”的例子，请分享！我想更好地理解 C++ 和 C# 之间的区别。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2011-01-02T05:36:27.003

使用`friend`C++ 设计人员可以精确控制 private* 成员的暴露对象。但是，他不得不揭露每一位私人成员。

`internal`C# 设计人员可以精确控制他公开的私有成员集。显然，他只能暴露一个私人成员。但是，它将暴露给程序集中的所有类。

通常，设计者希望仅将少数私有方法公开给选定的少数其他类。例如，在类工厂模式中，可能希望类 C1 仅由类工厂 CF1 实例化。因此类 C1 可能有一个受保护的构造函数和一个友元类工厂 CF1。

正如你所看到的，我们有两个维度可以破坏封装。 `friend`沿着一个维度破坏它，沿着另一个维度`internal`去做。哪一个是封装概念中更严重的突破？很难说。`friend`但如果两者兼而有之，那就太好了`internal`。此外，这两者的一个很好的补充是第 3 类关键字，它将逐个成员使用（like `internal`）并指定目标类（like `friend`）。

* 为简洁起见，我将使用“私人”而不是“私人和/或受保护”。

- 尼克

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-10-15T03:28:55.690

[您可以使用 C# 关键字“internal”](http://msdn.microsoft.com/en-us/library/7c5ka91b.aspx)接近 C++“朋友” 。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-01-19T16:27:31.887

Friend 在编写单元测试时非常有用。

虽然这会以轻微污染类声明为代价，但它也是编译器强制提醒，哪些测试实际上可能关心类的内部状态。

我发现一个非常有用且干净的习惯用法是当我有工厂类时，使它们成为他们创建的具有受保护构造函数的项目的朋友。更具体地说，当时我有一个工厂负责为报表编写器对象创建匹配的渲染对象，渲染到给定的环境。在这种情况下，您对报表编写器类（如图片块、布局带、页眉等）与其匹配的呈现对象之间的关系有一个单一的了解。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2010-04-09T05:52:54.590

C# 缺少“friend”关键字，原因与缺少确定性破坏的原因相同。改变惯例让人感觉很聪明，好像他们的新方法优于别人的旧方法。这都是关于骄傲。

说“朋友班不好”与“不要使用 gotos”或“Linux 比 Windows 更好”等其他不合格的说法一样短视。

“friend”关键字与代理类相结合是一种仅将类的*某些*部分暴露给特定其他类的好方法。代理类可以充当所有其他类的可信屏障。“public”不允许任何这样的定位，如果真的没有概念上的“is a”关系，那么使用“protected”来获得继承的效果是很尴尬的。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-10-15T08:07:42.460

这实际上不是 C# 的问题。这是 IL 中的一个基本限制。C# 受此限制，任何其他寻求可验证的 .Net 语言也是如此。此限制还包括在 C++/CLI 中定义的托管类（[规范第 20.5 节](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-372.pdf)）。

话虽如此，我认为尼尔森对为什么这是一件坏事有一个很好的解释。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-11-15T07:41:53.543

不要再为这种限制找借口了。朋友不好，内心好？它们是一样的，只是那个朋友可以让你更精确地控制谁可以访问，谁不可以。

这是为了强制执行封装范式？所以你必须编写访问器方法，现在怎么办？你应该如何阻止每个人（除了 B 类的方法）调用这些方法？你不能，因为你也无法控制它，因为缺少“朋友”。

没有一种编程语言是完美的。C# 是我见过的最好的语言之一，但是为缺少功能找个愚蠢的借口对任何人都没有帮助。在 C++ 中，我想念简单的事件/委托系统、反射（+自动反序列化）和 foreach，但在 C# 中，我想念运算符重载（是的，一直告诉我你不需要它）、默认参数、一个 const这是无法避免的，多重继承（是的，一直告诉我你不需要它，接口是一个足够的替代品）以及决定从内存中删除实例的能力（不，这不是非常糟糕，除非你是修补匠）

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2015-01-19T22:47:03.597

**我只会回答“如何”的问题。**

这里有很多答案，但是我想提出一种“设计模式”来实现该功能。我将使用简单的语言机制，其中包括：

*   接口
*   嵌套类

例如，我们有 2 个主要课程：学生和大学。学生有只有大学允许访问的 GPA。这是代码：

```
public interface IStudentFriend
{
    Student Stu { get; set; }
    double GetGPS();
}

public class Student
{
    // this is private member that I expose to friend only
    double GPS { get; set; }
    public string Name { get; set; }

    PrivateData privateData;

    public Student(string name, double gps) => (GPS, Name, privateData) = (gps, name, new PrivateData(this);

    // No one can instantiate this class, but Student
    // Calling it is possible via the IStudentFriend interface
    class PrivateData : IStudentFriend
    {
        public Student Stu { get; set; }

        public PrivateData(Student stu) => Stu = stu;
        public double GetGPS() => Stu.GPS;
    }

    // This is how I "mark" who is Students "friend"
    public void RegisterFriend(University friend) => friend.Register(privateData);
}

public class University
{
    var studentsFriends = new List<IStudentFriend>();

    public void Register(IStudentFriend friendMethod) => studentsFriends.Add(friendMethod);

    public void PrintAllStudentsGPS()
    {
        foreach (var stu in studentsFriends)
            Console.WriteLine($"{stu.Stu.Name}: stu.GetGPS()");
    }
}

public static void Main(string[] args)
{
    var Technion = new University();
    var Alex     = new Student("Alex", 98);
    var Jo       = new Student("Jo", 91);

    Alex.RegisterFriend(Technion);
    Jo.RegisterFriend(Technion);
    Technion.PrintAllStudentsGPS();

    Console.ReadLine();
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-07-11T21:25:53.277

自 .Net 3 以来就有 InternalsVisibleToAttribute，但我怀疑他们只是在单元测试兴起后才添加它来满足测试程序集的需求。我看不出有很多其他使用它的理由。

它在装配级别工作，但它在内部不工作的地方工作；也就是说，您想要分发一个程序集，但希望另一个非分布式程序集具有访问它的特权。

非常正确地，他们要求朋友程序集是强键控，以避免有人在受保护的程序集旁边创建假朋友。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-06-05T07:29:57.387

我已经阅读了许多关于“朋友”关键字的聪明评论，我同意它是有用的东西，但我认为什么“内部”关键字不太有用，而且它们对于纯 OO 编程仍然不好。

我们有什么？（说“朋友”我也说“内部”）

*   使用“朋友”是否会使代码对 oo 不那么纯粹？
*   是的;

*   不使用“朋友”会使代码更好吗？

*   不，我们仍然需要在类之间建立一些私有关系，并且只有打破我们美丽的封装才能做到，所以它也不好，我可以说它比使用“朋友”更邪恶。

使用朋友会产生一些本地问题，不使用它会给代码库用户带来问题。

我看到的编程语言的常见良好解决方案是这样的：

```
// c++ style
class Foo {
  public_for Bar:
    void addBar(Bar *bar) { }
  public:
  private:
  protected:
};

// c#
class Foo {
    public_for Bar void addBar(Bar bar) { }
} 
```

你怎么看待这件事？我认为它是最常见和纯面向对象的解决方案。您可以对任何您想要的课程开放访问您选择的任何方法。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-15T03:29:59.087

我怀疑它与 C# 编译模型有关——在运行时构建 IL JIT 编译它。即：C# 泛型与 C++ 泛型根本不同的原因相同。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-06-04T13:24:44.413

您可以将其保密并使用反射来调用函数。如果您要求测试框架测试私有函数，则测试框架可以执行此操作

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-01-30T09:41:40.240

我以前经常使用朋友，我不认为这有任何违反 OOP 或任何设计缺陷的迹象。有几个地方它是用最少的代码达到正确目的的最有效方法。

一个具体的例子是创建接口组件，为其他软件提供通信接口。通常有一些重量级的类可以处理协议的复杂性和对等点的特性，并提供一个相对简单的连接/读/写/转发/断开模型，涉及在客户端应用程序和程序集之间传递消息和通知。这些消息/通知需要包装在类中。属性通常需要由协议软件操作，因为它是它们的创建者，但是很多东西必须对外界保持只读。

声明协议/“创建者”类对所有创建的类具有亲密访问权是违反 OOP 的，这简直是愚蠢的——创建者类不得不在上升过程中对每一位数据进行比特处理。我发现最重要的是最小化“OOP for OOP's Sake”模型通常导致的所有 BS 额外代码行。额外的意大利面只会制造更多的错误。

人们知道您可以在属性、属性和方法级别应用 internal 关键字吗？它不仅适用于顶级类声明（尽管大多数示例似乎都表明了这一点。）

如果您有一个使用friend关键字的C++类，并且想在C#类中模拟它： 1\. 将C#类声明为public 2\. 声明在C++中受保护的所有属性/属性/方法，因此朋友可以访问为internal in C# 3\. 为所有内部属性和属性的公共访问创建只读属性

我同意它与朋友不是 100% 相同，并且单元测试是需要类似朋友的东西的一个非常有价值的例子（协议分析器日志记录代码也是如此）。然而 internal 提供了对你想要暴露的类的暴露，而 [InternalVisibleTo()] 处理其余的——似乎它是专门为单元测试而生的。

至于朋友“变得更好，因为你可以明确地控制哪些类可以访问”——一群可疑的邪恶类首先在同一个程序集中做什么？对您的程序集进行分区！

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2012-06-21T19:47:40.580

可以通过分离接口和实现来模拟友谊。这个想法是：“*需要一个具体的实例，但限制该实例的构造访问*”。

例如

```
interface IFriend { }

class Friend : IFriend
{
    public static IFriend New() { return new Friend(); }
    private Friend() { }

    private void CallTheBody() 
    {  
        var body = new Body();
        body.ItsMeYourFriend(this);
    }
}

class Body
{ 
    public void ItsMeYourFriend(Friend onlyAccess) { }
} 
```

尽管`ItsMeYourFriend()`只有公共`Friend`类可以访问它，因为没有其他人可以获取`Friend`该类的具体实例。它有一个私有构造函数，而工厂`New()`方法返回一个接口。

有关详细信息，请参阅我的文章[Friends and internal interface members at no cost with coding to interfaces](http://www.codeproject.com/Articles/403679/Friends-and-internal-interface-members-at-no-cost)。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-07-18T20:09:38.157

有人建议使用朋友可以使事情失控。我同意，但这并不会降低它的用处。我不确定这位朋友是否一定会伤害 OO 范式，而不是让所有班级成员公开。当然，该语言将允许您将所有成员公开，但它是一个有纪律的程序员，会避免这种类型的设计模式。同样，一个有纪律的程序员会在有意义的特定情况下保留使用friend。在某些情况下，我觉得内部暴露太多了。为什么要向程序集中的所有内容公开一个类或方法？

我有一个 ASP.NET 页面，它继承了我自己的基页，而基页又继承了 System.Web.UI.Page。在此页面中，我有一些代码以受保护的方法处理应用程序的最终用户错误报告

```
ReportError("Uh Oh!"); 
```

现在，我有一个包含在页面中的用户控件。我希望用户控件能够调用页面中的错误报告方法。

```
MyBasePage bp = Page as MyBasePage;
bp.ReportError("Uh Oh"); 
```

如果 ReportError 方法受到保护，它就不能这样做。我可以将其设为内部，但它会暴露给程序集中的任何代码。我只是希望它暴露给当前页面（包括子控件）的一部分的 UI 元素。更具体地说，我希望我的基本控件类定义完全相同的错误报告方法，并简单地调用基本页面中的方法。

```
protected void ReportError(string str) {
    MyBasePage bp = Page as MyBasePage;
    bp.ReportError(str);
} 
```

我相信朋友之类的东西可以在语言中有用和实现，而不会使语言不像“OO”那样，也许作为属性，这样你就可以让类或方法成为特定类或方法的朋友，允许开发人员提供非常具体访问。也许像......（伪代码）

```
[Friend(B)]
class A {

    AMethod() { }

    [Friend(C)]
    ACMethod() { }
}

class B {
    BMethod() { A.AMethod() }
}

class C {
    CMethod() { A.ACMethod() }
} 
```

在我之前的示例中，可能有以下内容（可以争论语义，但我只是想表达这个想法）：

```
class BasePage {

    [Friend(BaseControl.ReportError(string)]
    protected void ReportError(string str) { }
}

class BaseControl {
    protected void ReportError(string str) {
        MyBasePage bp = Page as MyBasePage;
        bp.ReportError(str);
    }
} 
```

在我看来，朋友概念对它的风险并不比将事情公开，或创建公共方法或属性来访问成员。如果有什么朋友允许数据可访问性的另一个级别的粒度，并允许您缩小该可访问性，而不是通过内部或公共来扩大它。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-15T05:28:24.933

如果你正在使用 C++ 并且你发现你自己使用了friend关键字，这是一个非常强烈的迹象，你有一个设计问题，因为为什么一个类需要访问其他类的私有成员？

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2012-07-05T08:06:55.663

BSD

有人说，朋友伤害了纯粹的OOness。我同意。

也有人说朋友帮忙封装，我也同意。

我认为友谊应该添加到 OO 方法中，但不像 C++ 中那样。我想要一些我的朋友类可以访问的字段/方法，但我不希望他们访问我所有的字段/方法。就像在现实生活中一样，我会让我的朋友访问我的个人冰箱，但我不会让他们访问我的银行账户。

可以按如下方式实现

```
 class C1
    {
        private void MyMethod(double x, int i)
        {
            // some code
        }
        // the friend class would be able to call myMethod
        public void MyMethod(FriendClass F, double x, int i)
        {
            this.MyMethod(x, i);
        }
        //my friend class wouldn't have access to this method 
        private void MyVeryPrivateMethod(string s)
        {
            // some code
        }
    }
    class FriendClass
    {
        public void SomeMethod()
        {
            C1 c = new C1();
            c.MyMethod(this, 5.5, 3);
        }
    } 
```

这当然会产生编译器警告，并会损害智能感知。但它会做的工作。

另一方面，我认为一个自信的程序员应该在不访问私有成员的情况下进行测试单元。这完全超出了范围，但请尝试阅读有关 TDD 的信息。但是，如果您仍然想这样做（有 c++ 之类的朋友），请尝试类似

```
#if UNIT_TESTING
        public
#else
        private
#endif
            double x; 
```

所以你在没有定义 UNIT_TESTING 的情况下编写所有代码，当你想要进行单元测试时，你将#define UNIT_TESTING 添加到文件的第一行（并在#if UNIT_TESTING 下编写进行单元测试的所有代码）。这应该小心处理。

既然我认为单元测试是使用朋友的一个坏例子，我会举一个例子，为什么我认为朋友可以是好的。假设您有一个破坏系统（类）。随着使用，破碎系统会磨损，需要翻新。现在，您希望只有获得许可的技工才能修复它。为了使示例不那么琐碎，我会说机械师将使用他的个人（私人）螺丝刀来修复它。这就是为什么 mechanic 类应该是 BreakSystem 类的朋友。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-01-02T15:59:17.230

友谊也可以通过使用“代理”——一些内部类来模拟。考虑以下示例：

```
public class A // Class that contains private members
{
  private class Accessor : B.BAgent // Implement accessor part of agent.
  {
    private A instance; // A instance for access to non-static members.
    static Accessor() 
    { // Init static accessors.
      B.BAgent.ABuilder = Builder;
      B.BAgent.PrivateStaticAccessor = StaticAccessor;
    }
    // Init non-static accessors.
    internal override void PrivateMethodAccessor() { instance.SomePrivateMethod(); }
    // Agent constructor for non-static members.
    internal Accessor(A instance) { this.instance = instance; }
    private static A Builder() { return new A(); }
    private static void StaticAccessor() { A.PrivateStatic(); }
  }
  public A(B friend) { B.Friendship(new A.Accessor(this)); }
  private A() { } // Private constructor that should be accessed only from B.
  private void SomePrivateMethod() { } // Private method that should be accessible from B.
  private static void PrivateStatic() { } // ... and static private method.
}
public class B
{
  // Agent for accessing A.
  internal abstract class BAgent
  {
    internal static Func<A> ABuilder; // Static members should be accessed only by delegates.
    internal static Action PrivateStaticAccessor;
    internal abstract void PrivateMethodAccessor(); // Non-static members may be accessed by delegates or by overrideable members.
  }
  internal static void Friendship(BAgent agent)
  {
    var a = BAgent.ABuilder(); // Access private constructor.
    BAgent.PrivateStaticAccessor(); // Access private static method.
    agent.PrivateMethodAccessor(); // Access private non-static member.
  }
} 
```

当仅用于访问静态成员时，它可能会简单得多。这种实现的好处是所有类型都在友谊类的内部范围内声明，并且与接口不同，它允许访问静态成员。

# language-agnostic - 如何命名变量

> ID：203618
> 
> 赞同：48
> 
> 时间：2008-10-15T03:24:52.310
> 
> 标签：language-agnostic, naming, conventions

*   你用什么规则来命名你的变量？
*   在哪里允许使用单字母 var？
*   你在名字里放了多少信息？
*   例如代码怎么样？
*   您首选的无意义变量名是什么？（在 foo & bar 之后）
*   为什么它们拼写为[“foo”和“bar”](http://en.wikipedia.org/wiki/Foobar)而不是[FUBAR](http://en.wikipedia.org/wiki/FUBAR)

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-10-15T03:38:10.523

```
function startEditing(){
   if (user.canEdit(currentDocument)){
      editorControl.setEditMode(true);
      setButtonDown(btnStartEditing);
   }
 } 
```

应该像叙事作品一样阅读。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-15T04:29:38.233

我一直遵循的一条规则是：如果一个变量以某些特定单位编码一个值，那么这些单位必须是变量名的一部分。例子：

```
int postalCodeDistanceMiles;
decimal reactorCoreTemperatureKelvin;
decimal altitudeMsl;
int userExperienceWongBakerPainScale 
```

我不会对任何火星着陆器（或我无聊的 CRUD 业务应用程序中的等效故障）负责。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-15T03:40:41.000

好吧，这一切都取决于您正在开发的语言。由于我目前使用的是 C#，因此我倾向于您使用以下语言。

camelCase 变量。

camelCase 用于参数。

属性的 PascalCase。

m_PascalCase 用于成员变量。

**单字母变量允许在哪里？** 我倾向于在 for 循环中执行此操作，但每当我这样做时都会感到有点内疚。但是对于 foreach 和 lambda 表达式，for 循环现在并不常见。

**你在名字里放了多少信息？** 如果代码有点难以理解，请写评论。不要将变量名变成注释，即 . `int theTotalAccountValueIsStoredHere` 不需要。

**您首选的无意义变量名是什么？** **（在 foo & bar 之后）** i 或 x。foo 和 bar 对我来说有点过于大学教科书的例子。

**为什么它们拼写为“foo”和“bar”而不是 FUBAR？** 传统

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-15T05:40:15.407

这些都是 C# 约定。

**变量名大小写**

大小写表示范围。Pascal 大小写变量是所属类的字段。骆驼大小写变量是当前方法的局部变量。

我只有一个前缀字符约定。类属性的支持字段是 Pascal 大小写的，并带有下划线前缀：

```
private int _Foo;
public int Foo { get { return _Foo; } set { _Foo = value; } } 
```

我在那里看到了一些 C# 变量命名约定——我很确定这是 Microsoft 文档——反对使用下划线前缀。这对我来说似乎很疯狂。如果我查看我的代码并看到类似

```
_Foo = GetResult(); 
```

我问自己的第一件事是，“我是否有充分的理由不使用属性访问器来更新该字段？” 答案通常是“是的，你最好在开始使用这段代码之前知道那是什么。”

**单字母（和短）变量名**

虽然我倾向于同意变量名应该有意义的格言，但在实践中，在很多情况下，使它们的名称有意义不会增加代码的可读性或可维护性。

循环迭代器和数组索引是使用短变量和任意变量名的明显地方。不太明显但在我的书中同样适用的是 nonce 用法，例如：

```
XmlWriterSettings xws = new XmlWriterSettings();
xws.Indent = true;
XmlWriter xw = XmlWriter.Create(outputStream, xws); 
```

那来自 C# 2.0 代码；如果我今天写它，当然，我不需要 nonce 变量：

```
XmlWriter xw = XmlWriter.Create(
   outputStream, 
   new XmlWriterSettings() { Indent=true; }); 
```

但是在 C# 代码中仍然有很多地方我必须创建一个您将要传递到其他地方然后扔掉的对象。

许多开发人员会在这种情况下使用类似的名称`xwsTemp`。我发现`Temp`后缀是多余的。我在其声明中命名了该变量`xws`（而且我只在该声明的可视范围内使用它；这很重要）告诉我它是一个临时变量。

我将使用短变量名的另一个地方是在大量使用单个对象的方法中。这是一段生产代码：

```
 internal void WriteXml(XmlWriter xw)
    {
        if (!Active)
        {
            return;
        }
        xw.WriteStartElement(Row.Table.TableName);

        xw.WriteAttributeString("ID", Row["ID"].ToString());
        xw.WriteAttributeString("RowState", Row.RowState.ToString());

        for (int i = 0; i < ColumnManagers.Length; i++)
        {
            ColumnManagers[i].Value = Row.ItemArray[i];
            xw.WriteElementString(ColumnManagers[i].ColumnName, ColumnManagers[i].ToXmlString());
        }
        ... 
```

如果我给 XmlWriter 一个更长的名称，那么世界上没有任何方法可以使代码更易于阅读（或更安全地修改）。

哦，我怎么知道这`xw`不是临时变量？因为我看不到它的声明。我只在声明的 4 或 5 行内使用临时变量。如果我需要一个用于更多代码的代码，我要么给它一个有意义的名称，要么将使用它的代码重构为一种方法——嘿，真是巧合——将短变量作为参数。

**你在名字里放了多少信息？**

足够的。

事实证明这是一种黑色艺术。有很多信息我*不必*输入名称。我知道变量何时是属性访问器的支持字段、临时变量或当前方法的参数，因为我的命名约定告诉我这一点。所以我的名字没有。

这就是为什么它不那么重要。

在实践中，我不需要花费太多精力来弄清楚变量名。我把所有的认知努力都放在了命名类型、属性和方法上。这比命名变量要重要得多，因为这些名称通常在范围内是公共的（或至少在整个命名空间中可见）*。*名称空间中的名称需要以*相同的方式*传达含义。

这段代码中只有一个变量：

```
 RowManager r = (RowManager)sender;

        // if the settings allow adding a new row, add one if the context row
        // is the last sibling, and it is now active.
        if (Settings.AllowAdds && r.IsLastSibling && r.Active)
        {
            r.ParentRowManager.AddNewChildRow(r.RecordTypeRow, false);
        } 
```

属性名称几乎使注释变得多余。（几乎。实际上调用该属性是有原因的，`AllowAdds`而不是`AllowAddingNewRows`经过很多思考，但它不适用于这段特定的代码，这就是为什么会有注释。）变量名？谁在乎？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-15T03:43:07.673

*   我只将单个字符变量用于循环控制或非常短的函数。

> ```
> for(int i = 0; i< endPoint; i++) {...}
> 
> int max( int a, int b) {
>     if (a > b)
>        return a;
>     return b;
> } 
> ```

*   信息量取决于变量的范围，它可以使用的地方越多，我想要的信息就越多，以跟踪其用途。
*   当我编写示例代码时，我会尝试像在实际代码中那样使用变量名（尽管函数可能会得到无用的名称，例如 foo 或 bar）。
*   见[“Foo”的词源](http://www.ietf.org/rfc/rfc3092.txt)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-15T04:52:51.837

几乎每一种被广泛使用的现代语言都有自己的编码标准。这是一个很好的起点。如果所有其他方法都失败了，请使用推荐的任何方法。当然也有例外，但这些是一般准则。如果您的团队更喜欢某些变化，只要您同意它们，那也没关系。

但归根结底，这不一定是您使用的标准，而是您首先拥有它们并且遵守它们的事实。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-15T06:56:54.893

**你用什么规则来命名你的变量？**

通常，由于我是 C# 开发人员，我遵循[IDesign C# 编码标准](http://www.idesign.net/idesign/download/IDesign%20CSharp%20Coding%20Standard.zip)指定的变量命名约定，原因有两个

1) 我喜欢它，并且觉得它易于阅读。[2) 这是我最近广泛使用的 Visual Studio 2005 / 2008](http://joel.fjorden.se/static.php?page=CodeStyleEnforcer "代码样式执行器插件")的 Code Style Enforcer AddIn 附带的默认设置。

**单字母变量允许在哪里？**

有几个地方我会允许单字母变量。通常这些是简单的循环索引器，或 X、Y、Z 坐标等数学概念。除此之外，从来没有！（我在其他任何地方都使用过它们，我在重读代码时通常会被它们咬伤）。

**你在名字里放了多少信息？**

足以准确地知道变量的用途。正如罗伯特·马丁所说：

> 变量、函数或类的名称应该回答所有大问题。它应该告诉你它为什么存在，它做什么，以及它是如何使用的。如果名称需要注释，则名称不会显示其意图。来自*Clean Code - 敏捷软件工艺手册*

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-06T03:54:39.967

我从不使用像 foo 或 bar 这样无意义的变量名，当然，除非代码真的被丢弃了。

对于循环变量，我将字母加倍，以便更容易在文件中搜索变量。例如，

```
for (int ii=0; ii < array.length; ii++)
{
    int element = array[ii];
    printf("%d", element);
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-15T03:48:11.330

**你用什么规则来命名你的变量？**我在单词 (load_vars)、驼峰式大小写 (loadVars) 和无空格 (loadvars) 之间切换了下划线。类总是 CamelCase，大写。

**单字母变量允许在哪里？**循环，主要是。一次性代码中的临时变量。

**你在名字里放了多少信息？**足以提醒我在编码时它是什么。（是的，这可能会导致以后出现问题！）

**您首选的无意义变量名是什么？(在 foo & bar 之后)** temp, res, r。我实际上并没有大量使用 foo 和 bar 。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-15T04:45:52.553

你用什么规则来命名你的变量？

*   我需要能够在一年的时间内理解它。还应符合已有的风格。

单字母变量允许在哪里？

*   超明显的东西。例如字符 c; c = getc(); 循环索引（i，j，k）。

你在名字里放了多少信息？

*   很多很多。

例如代码怎么样？

*   和上面一样。

您首选的无意义变量名是什么？（在 foo & bar 之后）

*   我不喜欢没有意义的变量名。如果一个变量没有任何意义，为什么它在我的代码中？

为什么它们拼写为“foo”和“bar”而不是 FUBAR

*   传统。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-20T09:47:13.003

**你用什么规则来命名你的变量？** CamelCase 用于所有重要变量，CamelCase 用于所有类

**单字母变量允许在哪里？** 在循环构造和数学函数中，单字母 var 名称与数学定义一致。

**你在名字里放了多少信息？** 你应该能够像阅读一本书一样阅读代码。函数名称应该告诉您函数的作用（scalarProd()、addCustomer() 等）

**例如代码怎么样？**

**您首选的无意义变量名是什么？（在 foo & bar 之后）** temp、tmp、input，我从来没有真正使用过 foo 和 bar。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-15T08:06:51.820

我遵守的规则是；

名称是否完整准确地描述了变量所代表的内容？

这个名字是指现实世界的问题而不是编程语言的解决方案吗？

这个名字是否足够长，你不必把它弄糊涂？

计算值限定符（如果有）是否位于名称的末尾？

它们是否仅在需要时才专门实例化？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-18T15:45:01.847

由于我作为承包商工作，在不同的公司和项目之间移动，我更喜欢避免自定义命名约定。它们使新开发人员或维护开发人员更难熟悉（并遵循）正在使用的标准。

因此，尽管人们可以在其中找到不同意的地方，但我还是会[参考 Microsoft Net 官方指南](http://msdn.microsoft.com/en-us/library/ms229002.aspx)，以获得一组一致的命名约定。

除了一些例外（匈牙利符号），我认为一致的使用可能比任何任意规则集更有用。也就是说，每次都以相同的方式进行。

.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-09-01T15:38:37.350

1.  **使用清楚地描述它所包含内容的变量。**如果类要变大，或者如果它在公共范围内，则需要更准确地描述变量名。当然，好的命名会让你和其他人更好地理解代码。

*   例如：使用“employeeNumber”而不是“number”。
*   在引用按钮的变量名称的末尾使用 Btn 或 Button，对于字符串等使用 str。

2.  **变量以小写开头，类以大写开头。**

*   “MyBigClass”类示例，变量“myStringVariable”示例

3.  **为了更好的可读性，使用大写来表示一个新词。**不要使用“_”，因为它看起来更丑，而且需要更长的时间来写。

*   例如：使用“员工姓名”。

4.  **仅在循环中使用单字符变量。**

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-15T03:29:47.200

我会说尽量清楚地命名它们。永远不要使用单字母变量，如果您只是在测试某些东西（例如，在交互模式下）并且不会在生产中使用它，则只能使用 'foo' 和 'bar'。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-15T03:36:06.033

当地人：fooBar；成员/类型/函数 FooBar 接口：IFooBar

至于我，只有名字是经典的，单个字母才有效；i/j/k 仅用于局部循环索引，x,y,z 用于矢量部分。

var 具有传达含义但足够短而不会换行的名称

富，酒吧，*巴兹*。泡菜也是最爱。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-15T03:36:56.903

我喜欢给我的变量添加前缀：str = String、int = Integer、bool = Boolean 等。

在循环中使用单个字母既快速又简单： For i = 0 to 4...Loop

变量是您正在使用的简短但描述性的替代品。如果变量太短，您可能无法理解它的用途。如果它太长，您将永远为代表 5 的变量键入。

Foo & Bar 用于示例代码以显示代码的工作方式。您可以使用几乎任何不同的无意义字符来代替。我通常只使用 i、x 和 y。

我个人对 foo bar 与 fu bar 的看法是太明显了，没有人喜欢 2 字符变量，3 更好！

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-15T03:45:57.497

在 DSL 和其他流畅的接口中，变量名和方法名通常一起构成一个词法实体。例如，我个人喜欢（公认的异端）命名模式，其中动词放在变量名而不是方法名中。@see[变量命名的第六条规则](http://www.iam.unibe.ch/~akuhn/blog/2008/07/read-aloud-naming/)

`$`另外，我喜欢在一段代码的主要变量中使用 spartan作为变量名。例如，一个漂亮地打印树结构的类可以`$`用于 StringBuffer inst var。@see[这是详细的！](http://www.iam.unibe.ch/~akuhn/blog/2008/09/this-is-verbose/)

否则，我会参考 Einar Hoest 的 Programmer's Phrasebook。@see [http://www.nr.no/~einarwh/phrasebook/](http://www.nr.no/~einarwh/phrasebook/)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-15T03:59:41.913

我总是在 for 循环中使用单字母变量，它看起来更漂亮，更容易阅读。

很大程度上取决于您编程的语言，我在 C++ 中命名变量的方式与在 Java 中不同（Java 更适合 imo 过长的变量名，但这可能只是个人喜好.或者它可能与Java内置函数的命名方式有关......）。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-15T04:38:34.877

在我的 VB3 时代，我学会了永远不要使用单字母变量名。问题是，如果你想在任何使用变量的地方搜索，搜索单个字母有点困难！

较新版本的 Visual Studio 具有智能变量搜索功能，可以避免这个问题，但旧习惯等等。无论如何，我宁愿在荒谬的一面犯错。

```
for (int firstStageRocketEngineIndex = 0; firstStageRocketEngineIndex < firstStageRocketEngines.Length; firstStageRocketEngineIndex++)
{
  firstStageRocketEngines[firstStageRocketEngineIndex].Ignite();
  Thread.Sleep(100);  // Don't start them all at once. That would be bad.
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-10-15T06:00:47.490

如何命名变量几乎不重要。你真的不需要任何规则，除了那些由语言指定的规则，或者至少是你的编译器强制执行的规则。

选择你认为你的队友能猜出的名字被认为是礼貌的，但风格规则并没有人们想象的那样真正有帮助。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-08-18T14:09:33.497

我在 MathCAD 工作，我很高兴，因为 MathCAD 在命名方面给了我难以置信的可能性，而且我经常使用它们。如果没有这个，我无法理解如何编程。为了区分一个变量和另一个变量，我必须在名称中包含很多信息，例如：

1.首先 - 就是 -N 表示数量，F 表示力等等

2.在第二个 - 附加索引 - 例如力的方向

3.在第三个 - 向量或矩阵 var 内的索引，为方便起见，我将 var name 放在 {} 或 [] 括号中以显示其尺寸。

因此，作为结论，我的 var 名称类似于 N.dirs / Fx i.row / {F}.w.(i,jk) / {F}.w.(k,ij)。有时我必须为向量值 {F}.{GCS}.w.(i,jk) / {F}.{LCS}.w.(i,jk) 添加坐标系的名称

作为最后一步，我在外部函数的末尾以粗体添加外部模块的名称，或者像 Row.MTX.f([M]) 这样的 var，因为 MathCAD 没有函数的帮助字符串。

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2008-10-15T03:56:37.550

**更新**

首先，命名取决于现有的约定，无论是来自语言、框架、库还是项目。（在罗马时...） 示例：对 jQuery 插件使用[jQuery 样式](http://docs.jquery.com/JQuery_Core_Style_Guidelines)，对 iOS 应用程序使用[Apple 样式。](https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CodingGuidelines/CodingGuidelines.html)前一个例子需要更多的警惕（因为 JavaScript 可能会变得混乱并且不会自动检查），而后一个例子更简单，因为该标准得到了很好的执行和遵循。YMMV 取决于领导者、社区，尤其是工具。

**我将搁置我所有的命名习惯以遵循任何现有的约定。**

* * *

总的来说，我遵循这些原则，所有这些都围绕着编程作为*通过书面语言进行的另一种人际交流*形式。

*   **可读性**——重要的部分应该有坚实的名字；但这些名称不应替代适当的*意图*文档。代码可读性的测试是你是否可以在几个月后回到它并且仍然足够理解而不至于在第一印象中折腾整个事情。这意味着避免缩写；参见[反对匈牙利符号的案例](http://www.folklore.org/StoryView.py?project=Macintosh&story=Hungarian.txt)。

*   **可写性**——公共区域和样板文件应该保持简单（尤其是如果没有 IDE），这样代码编写起来更容易也更有趣。这有点受[Rob Pyke 的风格](http://doc.cat-v.org/bell_labs/pikestyle)启发。

*   **可维护性**- 如果我将类型添加到我的名字`arrItems`中，那么如果我将该属性更改为`CustomSet`扩展类的实例，那就太糟糕了`Array`。类型注释应保存在文档中，并且仅在适当的情况下（对于 API 等）。

*   **标准、通用命名**- 对于哑环境（文本编辑器）：类应该是 in `ProperCase`，变量应该是短的，如果需要的话应该是 in `snake_case`，函数应该是 in `camelCase`。

* * *

对于 JavaScript，这是语言限制和影响命名的工具的经典案例。它有助于通过不同的命名来区分变量和函数，因为没有 IDE 可以握住您的手，`this`而`prototype`其他样板文件会模糊您的视野并混淆您的区分技能。一个范围内所有不重要的或全局派生的变量都被缩写也很常见。该语言没有`import [path] as [alias];`，因此本地变量成为别名。然后是大量不同的空白约定。这里（以及任何地方，真的）唯一的解决方案是正确记录意图（和身份）。

此外，语言本身是基于函数级别范围和闭包的，因此灵活性可以使具有 2+ 范围级别的变量的块感觉非常混乱，所以我已经看到命名`_`范围链中每个级别的前置位置该范围内的变量。

* * *

## 回答 #24

> 赞同：-3
> 
> 时间：2008-10-15T10:26:13.460

我现在做了很多 php，但并不总是这样，而且在变量命名方面我学到了一些技巧。

//这是我的字符串变量 $strVar = "";

//这将表示一个数组 $arrCards = array();

//这是一个整数 $intTotal = NULL:

//对象 $objDB = new database_class();

//布尔值 $blValid = true;

# layout - 如何在不为每种语言创建单独的 ASP 页面的情况下制作双语网站？

> ID：203620
> 
> 赞同：2
> 
> 时间：2008-10-15T03:25:18.503
> 
> 标签：layout, internationalization

我需要关于如何解决表格布局问题的想法。我想根据选择的语言设置不同的列宽度。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T03:41:30.610

您可以拥有特定于语言的 CSS，然后只需根据语言加载适当的 CSS。

在 CSS 中，您可以为表格添加样式以定义布局。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T03:28:57.060

根据当前选择的语言在 scriplet 中使用 if-else 并放置适当的“td”标签。

希望这就是你要找的！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T03:38:08.213

一个可变开关，例如：

```
<%
dim columnWidth
if session("lang") = "eng" then
    columnWidth = 50
else
    columnWidth = 100
end if
%>

<table>
    <tr>
        <td width="<%= columnWidth %>px">[content]</td>
    </tr>
</table> 
```

对于 c#，代码为：

```
<%
private int columnWidth;
if (session("lang") == "eng") {
    columnWidth = 50;
} else {
    columnWidth = 100;
}
%> 
```

# java - 您可以在不同的 OSGi 包中包含 JSF 自定义组件吗？

> ID：203629
> 
> 赞同：2
> 
> 时间：2008-10-15T03:29:18.013
> 
> 标签：java, jsf, osgi

有人一起使用过 OSGi 和 JSF 吗？

我问是因为 JSF 使用类加载器魔法来查找自定义组件。从教程（强调我的）：

> 此配置文件最终将成为代表此组件的 .jar 文件中的 META-INF/faces-config.xml。**JSF 将在运行时加载的每个 .jar 文件**（在 WEB-INF/lib 目录中的 .war 文件）中查找这样的文件名，并在其配置中使用它们中的每一个。通过这种方式，可以将多个组件 .jar 文件组合成一个 Web 应用程序，并且每个 .jar 中描述的所有组件都将可供应用程序使用。

我希望能够将 JSF 自定义组件作为 OSGi 包（即自定义组件位于与 JSF 运行时不同的 OSGi 包中），并且 JSF 能够在运行时找到这些。

有没有人做过类似的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T03:58:02.290

我不确定它是否能准确回答你的问题，但我发现这个关于[Spring 和 osgi](http://groups.google.com/group/spring-osgi/browse_thread/thread/c400b0317a87a27d/619d115987e4a9cd?#619d115987e4a9cd)的线程很有趣，尤其是这个[特定的答案](http://groups.google.com/group/spring-osgi/msg/8d12c504c3a6f98d)，其中依赖项和类路径捆绑在 MANIFEST.MF 中。

该线程还导致了本教程的更新，该[教程关于 OSGi™ 服务平台的 Spring 动态模块 (DM)](http://springosgi.googlepages.com/)也可能感兴趣。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-18T21:03:30.693

可以通过以下方式：

*   您的 web osgi 包必须在 MANIFEST.MF 中有“Require-Bundle”指向包含组件的包
*   您的组件 jar 必须具有包含 META-INF 的 Export-Package 和 META-INF 的子包，其中有任何 JSF 相关文件（当然还有组件的标准包）。例如：Export-Package: META-INF,META-INF.resources...

如果您使用 maven-bundle 插件，则必须使用撇号和等号来导出 META-INF 和子包。例如：

```
<Export-Package>
  a.b.c,
  '=META-INF',
  '=META-INF.resources',
  ...
</Export-Package> 
```

在 JSF Spec 2.2 中可能有关于 JSF-OSGI 关系的部分。要查看进度，请参阅[http://java.net/jira/browse/JAVASERVERFACES_SPEC_PUBLIC-942](http://java.net/jira/browse/JAVASERVERFACES_SPEC_PUBLIC-942)

# xslt - 为什么我的 XSL 转换链接相对于基数出来？

> ID：203640
> 
> 赞同：1
> 
> 时间：2008-10-15T03:35:44.210
> 
> 标签：xslt

```
<a>
 <xsl:attribute name="href">
 <xsl:value-of select="link" />
 </xsl:attribute>
 <xsl:attribute name="target">new</xsl:attribute>
 <xsl:value-of select="title" />
 </a> 
```

那是我的模板，在我的代码中：

```
 sb.Append("<title>");
 sb.AppendFormat("{0} - {1}", f.UserName, f.PointTypeDesc);
 sb.Append("</title>");
 sb.Append("<link>");
 sb.AppendFormat("{0}", HttpUtility.UrlEncode(url));
 sb.Append("</link>"); 
```

网址是“ [http://www.cnn.com](http://www.cnn.com) ”

但它呈现为：“ [http://localhost/http://www.cnn.com](http://localhost/http://www.cnn.com) ”

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-19T23:40:11.513

在我看来，问题一定出在 HttpUtility.UrlEncode 上。您是否检查过您正在创建的 xml 的内容？XSL 对我来说看起来是正确的，尽管它可以更简洁地写成：

```
<a href="{@link}" target="new">
  <xsl:value-of select="title"/>
</a> 
```

# c++ - C++“命名参数成语”与 Boost::Parameter 库

> ID：203667
> 
> 赞同：35
> 
> 时间：2008-10-15T03:46:56.557
> 
> 标签：c++, named-parameters, boost-parameter

我查看了[Named Parameter Idiom](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.20)和[Boost::Parameter library](http://www.boost.org/doc/libs/1_36_0/libs/parameter/doc/html/index.html)。每个人都比另一个人有什么优势？是否有充分的理由总是选择一个而不是另一个，或者在某些情况下它们中的每一个都比另一个更好（如果是，在什么情况下）？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-15T04:14:09.390

实现命名参数习语真的很简单，几乎和使用 Boost::Parameter 一样简单，所以它可以归结为一个要点。

- 你已经有提升依赖了吗？如果您不这样做，则 Boost::parameter 不够特别，不值得添加依赖项。

就我个人而言，我从未在生产代码中看到过 Boost::parameter，100% 的时间它都是命名参数的自定义实现，但这不一定是一件好事。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-15T12:21:56.347

通常，我是 Boost 的忠实拥护者，但我不会使用 Boost.Parameter 库有几个原因：

1.  如果您不知道发生了什么，则该调用看起来就像您在进行调用之前为调用函数范围内的变量分配了一个值。这可能非常令人困惑。
2.  一开始就需要太多样板代码来设置它。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-07-27T23:45:32.937

还有一点，虽然我从未使用过命名参数惯用语，但我使用 Boost Parameter 来定义多达 20 个可选参数。而且，我的编译时间很疯狂。过去需要几秒钟，现在需要 30 秒。如果您有一个使用您使用 boost 参数编写的小应用程序的东西库，那么这会增加。当然，我可能会错误地实现它，但我希望这会改变，因为除此之外，我真的很喜欢它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-15T07:53:37.387

命名参数习语要简单得多。我（现在）不明白为什么我们需要 Boost::Parameter 库的复杂性。（即使是假定的“特征”推导参数，似乎也是引入编码错误的一种方式；））

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T22:45:23.417

您可能不希望 Boost.Parameter 用于一般应用程序逻辑，而希望它用于您正在开发的库代码，它可以为库的客户端节省大量时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-15T04:48:43.593

从来没有听说过，但是查看链接，命名参数更容易理解。我会在 boost 实施中迅速选择它。

# java - 无法编译调用具有通用列表参数的接口中的方法的类

> ID：203677
> 
> 赞同：2
> 
> 时间：2008-10-15T03:53:23.003
> 
> 标签：java, generics

刚收到一个关于泛型的问题，为什么在使用泛型列表时不能编译？如果它不可能，无论如何围绕它？非常感谢任何答案。

```
// Interface used in the ServiceAsync inteface.
public interface BaseObject
{
    public String getId();
}

// Class that implements the interface
public class _ModelDto implements BaseObject, IsSerializable
{
    protected String id;

    public void setId(String id)
    {
        this.id = id;
    }

    public String getId()
    {
        return id;
    }
}

// Interface used in the ServiceAsync inteface.
public interface MyAsync<T>
{
     // Nothing here.
}

// Service interface use both interfaces above.
public interface ServiceAsync
{
    public void getList(MyAsync<List<? extends BaseObject>> callback);
}

public class MyClass
{
    ServiceAsync service = (some implementation);
    MyAsync<List<_ModelDto>> callBack = new MyAsync<List<_ModelDto>>()
    {

    };

    service.getList(callBack);  // This does not compile, says arguments are not applicable????
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-15T05:07:13.523

从我的角度来看，您的 MyAsync 接口不包含任何方法签名并且没有特别有用的名称这一事实是一种代码异味，但我假设这只是一个虚拟示例。正如它所写的，getList() 不可能有任何合理的实现以任何方式使用回调。请记住，类型擦除将删除此方法签名以`getList(MyAsync callback);`

这不编译的原因是你的界限是错误的。`MyAsync<List<? extends BaseObject>>`给出 T as `List<? extends BaseObject>`，一个未知类型的列表.

在我看来，您想要的是 getList 方法本身是通用的：

```
public interface ServiceAsync {
    public <T extends BaseObject> void getList(MyAsync<List<T>> callback);
}

public class MyClass {
    public void foo() {
        ServiceAsync service = null;
        MyAsync<List<_ModelDto>> callBack = new MyAsync<List<_ModelDto>>() {};

        service.getList (callBack);  // This compiles
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T04:45:02.010

这 '？' 在泛型类型中可能会很混乱。老实说，我不确定为什么这不会编译。它与使用“？”有关 在嵌套的泛型类型中。但我确实知道一些解决方法。

MyClass 中的 MyAsync 声明必须引用 _ModelDto 是否有原因？如果您将其更改为如下所示，它将起作用：

```
 ServiceAsync service = (some implementation);
   MyAsync<List<? extends BaseObject>> callBack = new MyAsync<List<? extends BaseObject>>() 
   {

   };

   service.getList(callBack); 
```

如果您需要直接引用 _ModelDto 类型，您可以更改 ServiceAsync 的定义，它将解决问题。
将其更改为如下所示：

```
public interface ServiceAsync<T extends BaseObject>
{
    public void getList(MyAsync<List<T>> callback);
} 
```

然后将参数类型添加到 MyClass 中的声明中

```
public class MyClass 
{
   public void method() 
   {
      ServiceAsync<_ModelDto> service = (some implementation);
      MyAsync<List<_ModelDto>> callBack = new MyAsync<List<_ModelDto>>() 
      {

      };

      service.getList(callBack);
   }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T12:02:36.650

这与参数化类型的子类型规则有关。我将分三步解释：

## 非嵌套案例

当您具有以下子类型关系时（`<:`“是”的子类型的符号在哪里）：

```
_ModelDto <: BaseObject 
```

以下关系不**成立**：

```
List<_ModelDto> <: List<BaseObject> 
```

但是以下关系可以：

```
List<_ModelDto> <: List<? extends _ModelDto> <: List<? extends BaseObject> 
```

这就是 Java 有通配符的原因：启用这些子类型关系。所有这些都在[泛型教程](http://java.sun.com/j2se/1.5/pdf/generics-tutorial.pdf)中进行了解释。如果您理解这一点，我们可以继续嵌套案例......

## 嵌套案例

让我们做同样的事情，但多了一层嵌套。从子类型关系开始：

```
List<_ModelDto> <: List<? extends BaseObject> 
```

由于与上述完全相同的原因，以下关系不**成立：**

```
MyAsync<List<_ModelDto>> <: MyAsync<List<? extends BaseObject>> 
```

这*正是*您在调用 时尝试进行的转换`service.getList(callBack)`，并且由于子类型关系不成立，因此转换失败。

但是，如上所述，您**确实**具有以下关系：

```
MyAsync<List<_ModelDto>>
  <: MyAsync<? extends List<_ModelDto>>
  <: MyAsync<? extends List<? extends BaseObject>> 
```

## 解决方案

因此，您应该编写`getList`如下签名以使调用正常工作：

```
public void getList(MyAsync<? extends List<? extends BaseObject>> callback); 
```

不同之处在于主体`getList`将受限于它如何使用`callback`. 如果`MyAsync`包含以下成员：

```
public interface MyAsync<T> {
    T get();
    void set(T t);
} 
```

然后，body`getList`就可以`get`从回调中得到一个列表。但是，它不能`set`列出列表（除了将其设置为`null`），因为它不确切知道`?`.

相反，使用您的原始签名，`set`它是可用的，这就是编译器不允许您的参数的原因。

# parsing - 如何使用 NLP 解析配方成分？

> ID：203684
> 
> 赞同：29
> 
> 时间：2008-10-15T03:57:19.610
> 
> 标签：parsing, nlp

我需要将配方成分解析为适用于该行的数量、尺寸、项目和描述，例如 1 杯面粉、2 个柠檬皮和 1 杯包装好的红糖等。这样做的最佳方法是什么？我有兴趣在项目中使用 python，所以我假设使用 nltk 是最好的选择，但我对其他语言持开放态度。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2011-08-12T01:43:11.467

我实际上是为我的网站执行此操作，该网站现在是供其他人使用的[开源项目的一部分。](https://github.com/KitchenPC/core)

我写了一篇关于我的技术的博客文章，享受吧！

[http://blog.kitchenpc.com/2011/07/06/chef-watson/](http://blog.kitchenpc.com/2011/07/06/chef-watson/)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2018-09-12T21:54:33.447

*纽约时报*在解析他们的食谱档案时遇到了这个问题。他们使用了一种称为线性链条件随机场 (CRF) 的 NLP 技术。这篇博文提供了一个很好的概述：

*   [“使用条件随机字段从食谱中提取结构化数据”](https://open.blogs.nytimes.com/2015/04/09/extracting-structured-data-from-recipes-using-conditional-random-fields/)

他们开源了他们的代码，但很快就放弃了。我维护[了它的最新版本](https://github.com/mtlynch/ingredient-phrase-tagger)，并[写了一些](https://mtlynch.io/resurrecting-1/)关于我如何对其进行现代化改造的文章。

如果您正在寻找现成的解决方案，有几家公司提供成分解析服务：

*   [Zestful](https://zestfuldata.com/)（完全披露：我是作者）
*   [勺子](https://rapidapi.com/spoonacular/api/Recipe%20-%20Food%20-%20Nutrition/functions/Parse%20Ingredients)
*   [毛豆](https://rapidapi.com/edamam/api/edamam-nutrition-analysis)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-03-03T15:15:42.023

我想这是几年前的事了，但我正在考虑自己做一些类似的事情并遇到了这个问题，所以我想我可能会尝试一下，以防它对 f 中的其他人有用

即使您说要解析免费测试，大多数食谱的食谱列表都有一个非常标准的格式：每种成分都在单独的一行上，准确的句子结构很少那么重要。词汇的范围也相对较小。

一种方法可能是检查每一行是否有可能是名词和表示数量的单词/符号的单词。我认为 WordNet 可能有助于查看一个词是否可能是名词，但我之前没有使用过它。或者，您可以使用[http://en.wikibooks.org/wiki/Cookbook:Ingredients](http://en.wikibooks.org/wiki/Cookbook:Ingredients)作为单词列表，不过我也不知道它到底有多全面。

另一部分是识别数量。它们有几种不同的形式，但足够少，您可能可以创建一个关键字列表。特别是，请确保您有良好的错误报告。如果程序无法完全解析一行，请让它向您报告该行是什么，以及它已经/尚未识别的内容，以便您可以相应地调整关键字列表。

Aaanyway，我不保证这一切都会奏效（而且几乎可以肯定不是 100% 可靠），但这就是我开始解决问题的方式

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-20T14:40:57.950

这是一个不完整的答案，但是您正在考虑编写一个自由文本解析器，正如您所知，这并不简单:)

使用烹饪特定知识的一些作弊方法：

1.  为“形容词”和“动词”构建单词列表，并过滤它们
    1.  测量单位形成一个封闭的集合，使用单词和缩写，如 {L., c, cup, t, dash}
    2.  说明——切、切、煮、剥。在这之后发生的事情几乎肯定是成分
2.  请记住，您主要是在寻找名词，您可以获取一个带标签的非名词列表（例如来自 WordNet）并过滤它们。

如果您更有野心，可以查看[NLTK Book](http://www.nltk.org/book)的解析器章节。

祝你好运！这听起来像是一个几乎可行的项目！

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-15T08:22:58.480

您能更具体地说明您的输入是什么吗？如果您只有这样的输入：

```
1 cup flour
2 lemon peels
1 cup packed brown sugar 
```

完全不使用任何 NLP 来解析它不会太难。

# .net - 跨不同框架版本的 .NET 序列化的稳定性

> ID：203694
> 
> 赞同：9
> 
> 时间：2008-10-15T04:09:24.313
> 
> 标签：.net, serialization, upgrade, versions, stability

我正在处理的一个项目需要在关闭之前序列化一个数据结构，并在它再次启动时从这个序列化数据中恢复其状态。

去年，我们正在为 .NET 1.1 构建，遇到了一个棘手的问题：

*   我们的代码在 .NET 2.0 上运行
*   客户升级了一些软件，以某种方式将 1.1 设置为默认值
*   我们的代码在 .NET 1.1 上运行，无法反序列化其存储状态

通过禁止特定的软件升级，这个特定问题得到了“解决”，现在我们的目标是 .NET 2.0 框架（因此我们不可能在 1.1 上运行），这应该不是问题。

这种序列化在 2.0 和更新的框架之间再次发生不兼容变化的可能性有多大？如果我们将`<supportedVersion>`代码修复为 2.0.50727，那么 2.0.50727.1434 和 2.0.50727.nnnn（未来的某个版本）之间发生变化的可能性有多大？被序列化的数据结构是标准类库中的数组、映射、字符串等。

此外，即使在进一步的 .NET 升级之后，是否也能保证始终安装 2.0.50727 框架？欢迎指向 Microsoft 文档。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-15T07:09:45.960

框架版本之间发生变化的可能性很低（但不是零！）。目的是您应该能够使用二进制序列化和远程处理在运行不同框架版本的客户端和服务器之间进行通信。.NET 1.x 和 2.0 之间的不兼容[是一个可用补丁解决的错误](http://blogs.msdn.com/eugeneos/archive/2006/03/15/552315.aspx)。

但是二进制序列化还有其他问题，尤其是对您正在序列化的结构的版本控制的支持很差。从您描述的用例来看，Xml 序列化是显而易见的选择：如果您不介意对 .NET 3.x 的依赖，DataContractSerializer 比 XmlSerializer 更灵活。

您不能保证 .NET Framework 2.0 将始终安装在未来版本的 Windows 上。但我确信微软会努力确保大多数 .NET 2.0 应用程序在 .NET 4.x 及更高版本上运行时不会发生变化。我对此没有任何参考资料：任何此类承诺在任何情况下都只会真正适用于下一版本的 Windows（Windows 7）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-15T06:00:17.567

经验法则通常是：XML 序列化应该能够在新的框架版本中存活，因此可以长期存储，但二进制序列化不能（因此只能是暂时的）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-15T05:48:30.837

你用的是什么序列化器？在许多方面，像 XmlSerializer 或 DataContractSerializer 这样的序列化程序可以为您提供许多细节的缓冲，并提供更简单的可扩展性选项。在某些时候，新的 CLR 版本无疑是必要的——所以我认为没有人可以对 2.0.50727 做出任何保证；不过，您短期内应该是安全的。我希望更少的重大变化......

[更新以下关于另一个回复的注释]

如果出于空间/性能原因需要二进制格式，则另一种选择是使用不同的二进制序列化程序。例如，[protobuf-net](http://code.google.com/p/protobuf-net/)适用于所有 .NET 变体*，但二进制格式（由 Google 建议）是跨平台兼容的（Java、C++ 等）——使其非常便携、快速且体积小。

*=我没有在微框架上尝试过，但是 CF、Silverlight、Mono、.NET 2.0 等都支持。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-15T06:57:50.667

如果兼容性是一个问题，[ISerializable](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.iserializable.aspx)接口可能是您正在寻找的解决方法。此界面使您可以更好地控制项目的序列化方式。有关更多信息，请尝试[有关 msdn 的这篇文章](http://msdn.microsoft.com/en-us/library/ty01x675.aspx)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-15T08:35:21.077

我有两件事要添加到其他答案中...

首先，使用自定义[SerializationBinder](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.serializationbinder.aspx)可以让您在导入遗留的序列化数据时遇到很多困难。

其次，我认为必须为任何持久数据编写广泛的**单元测试**。我总是特别做两个测试：

1.  往返测试——你能序列化和反序列化你的对象并得到完全相同的东西吗？
2.  旧版导入测试 - 确保您拥有从应用的每个已发布版本中导出的序列化数据版本。导入数据并检查一切是否按预期返回。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-10T13:03:19.447

您不必为了获得更高的灵活性和版本控制而使用 XML。

我使用了 Simon Hewitt 的开源库，请参阅*[Optimizing Serialization in .NET - part 2](https://www.codeproject.com/Articles/16017/Optimizing-Serialization-in-NET-part)*而不是默认的 .NET 序列化。它提供了一些自动化，但本质上您可以控制被序列化和反序列化的信息流。对于版本控制，可以首先序列化（文件）版本，并且在反序列化时，解释信息流的方式取决于版本。

这很简单，虽然由于显式的序列化/反序列化而有些乏味。

作为奖励，它的速度提高了 20-40 倍，并且为大型数据集占用的空间更少（但在您的情况下可能并不重要）。

# c# - 在结构上使用“new”是否会在堆或堆栈上分配它？

> ID：203695
> 
> 赞同：304
> 
> 时间：2008-10-15T04:09:30.443
> 
> 标签：c#, .net, memory-management

当您使用运算符创建类的实例时`new`，内存会在堆上分配。当您使用运算符创建结构的实例时，`new`内存在哪里分配，在堆上还是在堆栈上？

* * *

## 回答 #1

> 赞同：321
> 
> 时间：2008-10-15T08:21:51.510

好吧，让我们看看我是否可以更清楚地说明这一点。

首先，Ash 是对的：问题*不*在于值类型*变量*的分配位置。这是一个不同的问题——答案不仅仅是“在堆栈上”。它比这更复杂（C# 2 使它变得更加复杂）。我有[一篇关于该主题](https://jonskeet.uk/csharp/memory.html)的文章，如果需要，我会对其进行扩展，但我们只处理`new`操作员。

其次，这一切真的取决于你在说什么级别。我正在查看编译器对源代码的处理，就它创建的 IL 而言。JIT 编译器很可能会在优化大量“逻辑”分配方面做一些聪明的事情。

第三，我忽略了泛型，主要是因为我实际上并不知道答案，部分是因为它会使事情变得过于复杂。

最后，所有这些都只是当前的实现。C# 规范没有详细说明这一点——它实际上是一个实现细节。有些人认为托管代码开发人员真的不应该关心。我不确定我会走那么远，但值得想象一个实际上所有局部变量都存在于堆上的世界——这仍然符合规范。

* * *

值类型上的运算符有两种不同的情况`new`：您可以调用无参数构造函数（例如`new Guid()`）或有参数构造函数（例如`new Guid(someString)`）。这些产生显着不同的IL。要了解原因，您需要比较 C# 和 CLI 规范：根据 C#，所有值类型都有一个无参数构造函数。根据 CLI 规范，*没有*值类型具有无参数构造函数。（有时会通过反射获取值类型的构造函数——你不会找到无参数的构造函数。）

C# 将“用零初始化值”视为构造函数是有意义的，因为它使语言保持一致——您可以将其`new(...)`视为*始终*调用构造函数。CLI 以不同的方式思考它是有意义的，因为没有真正的代码可以调用——当然也没有特定于类型的代码。

在初始化它之后，您将如何处理该值也会有所不同。IL 用于

```
Guid localVariable = new Guid(someString); 
```

与用于以下的 IL 不同：

```
myInstanceOrStaticVariable = new Guid(someString); 
```

此外，如果将该值用作中间值，例如方法调用的参数，则情况再次略有不同。为了显示所有这些差异，这里有一个简短的测试程序。它没有显示静态变量和实例变量之间的区别：IL 在 和 之间会有所不同`stfld`，`stsfld`但仅此而已。

```
using System;

public class Test
{
    static Guid field;

    static void Main() {}
    static void MethodTakingGuid(Guid guid) {}

    static void ParameterisedCtorAssignToField()
    {
        field = new Guid("");
    }

    static void ParameterisedCtorAssignToLocal()
    {
        Guid local = new Guid("");
        // Force the value to be used
        local.ToString();
    }

    static void ParameterisedCtorCallMethod()
    {
        MethodTakingGuid(new Guid(""));
    }

    static void ParameterlessCtorAssignToField()
    {
        field = new Guid();
    }

    static void ParameterlessCtorAssignToLocal()
    {
        Guid local = new Guid();
        // Force the value to be used
        local.ToString();
    }

    static void ParameterlessCtorCallMethod()
    {
        MethodTakingGuid(new Guid());
    }
} 
```

这是该类的 IL，不包括不相关的位（例如 nops）：

```
.class public auto ansi beforefieldinit Test extends [mscorlib]System.Object    
{
    // Removed Test's constructor, Main, and MethodTakingGuid.

    .method private hidebysig static void ParameterisedCtorAssignToField() cil managed
    {
        .maxstack 8
        L_0001: ldstr ""
        L_0006: newobj instance void [mscorlib]System.Guid::.ctor(string)
        L_000b: stsfld valuetype [mscorlib]System.Guid Test::field
        L_0010: ret     
    }

    .method private hidebysig static void ParameterisedCtorAssignToLocal() cil managed
    {
        .maxstack 2
        .locals init ([0] valuetype [mscorlib]System.Guid guid)    
        L_0001: ldloca.s guid    
        L_0003: ldstr ""    
        L_0008: call instance void [mscorlib]System.Guid::.ctor(string)    
        // Removed ToString() call
        L_001c: ret
    }

    .method private hidebysig static void ParameterisedCtorCallMethod() cil  managed    
    {   
        .maxstack 8
        L_0001: ldstr ""
        L_0006: newobj instance void [mscorlib]System.Guid::.ctor(string)
        L_000b: call void Test::MethodTakingGuid(valuetype [mscorlib]System.Guid)
        L_0011: ret     
    }

    .method private hidebysig static void ParameterlessCtorAssignToField() cil managed
    {
        .maxstack 8
        L_0001: ldsflda valuetype [mscorlib]System.Guid Test::field
        L_0006: initobj [mscorlib]System.Guid
        L_000c: ret 
    }

    .method private hidebysig static void ParameterlessCtorAssignToLocal() cil managed
    {
        .maxstack 1
        .locals init ([0] valuetype [mscorlib]System.Guid guid)
        L_0001: ldloca.s guid
        L_0003: initobj [mscorlib]System.Guid
        // Removed ToString() call
        L_0017: ret 
    }

    .method private hidebysig static void ParameterlessCtorCallMethod() cil managed
    {
        .maxstack 1
        .locals init ([0] valuetype [mscorlib]System.Guid guid)    
        L_0001: ldloca.s guid
        L_0003: initobj [mscorlib]System.Guid
        L_0009: ldloc.0 
        L_000a: call void Test::MethodTakingGuid(valuetype [mscorlib]System.Guid)
        L_0010: ret 
    }

    .field private static valuetype [mscorlib]System.Guid field
} 
```

如您所见，有许多不同的指令用于调用构造函数：

*   `newobj`：在堆栈上分配值，调用参数化构造函数。用于中间值，例如分配给字段或用作方法参数。
*   `call instance`：使用已分配的存储位置（无论是否在堆栈上）。这在上面的代码中用于分配给局部变量。如果使用多次`new`调用多次为同一个局部变量分配一个值，它只会在旧值的顶部初始化数据——它*不会*每次都分配更多的堆栈空间。
*   `initobj`：使用已分配的存储位置并擦除数据。这用于我们所有的无参数构造函数调用，包括那些分配给局部变量的调用。对于方法调用，有效地引入了一个中间局部变量，其值由`initobj`.

我希望这能说明这个话题是多么复杂，同时也能对它有所启发。在*某些*概念意义上，每次调用都会`new`在堆栈上分配空间——但正如我们所见，即使在 IL 级别，这也不是真正发生的事情。我想强调一个特殊情况。采取这种方法：

```
void HowManyStackAllocations()
{
    Guid guid = new Guid();
    // [...] Use guid
    guid = new Guid(someBytes);
    // [...] Use guid
    guid = new Guid(someString);
    // [...] Use guid
} 
```

“逻辑上”有 4 个堆栈分配 - 一个用于变量，一个用于三个`new`调用中的每一个 - 但实际上（对于该特定代码）堆栈只分配一次，然后重复使用相同的存储位置。

编辑：为了清楚起见，这仅在某些情况下是正确的......特别是，`guid`如果构造函数抛出异常，则值将不可见`Guid`，这就是 C# 编译器能够重用相同堆栈槽的原因。*有关更多详细信息以及不*适用的情况，请参阅 Eric Lippert[关于值类型构造的博客文章。](https://ericlippert.com/2010/10/11/debunking-another-myth-about-value-types/)

 *我在写这个答案时学到了很多东西 - 如果有任何不清楚的地方，请要求澄清！

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-10-15T05:12:51.640

根据具体情况，可以在堆栈或堆上分配包含结构字段的内存。如果结构类型变量是一个局部变量或参数，没有被一些匿名委托或迭代器类捕获，那么它将被分配到堆栈上。如果变量是某个类的一部分，那么它将在堆上的类中分配。

如果结构是在堆上分配的，那么实际上不需要调用 new 运算符来分配内存。唯一的目的是根据构造函数中的内容设置字段值。如果未调用构造函数，则所有字段都将获得其默认值（0 或 null）。

同样对于分配在堆栈上的结构，除了 C# 要求在使用所有局部变量之前将它们设置为某个值，因此您必须调用自定义构造函数或默认构造函数（不带参数的构造函数始终可用于结构）。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-15T08:59:23.523

简而言之，new 是结构体的误称，调用 new 只是调用构造函数。结构的唯一存储位置是它定义的位置。

如果它是一个成员变量，它直接存储在它定义的任何地方，如果它是一个局部变量或参数，它就存储在堆栈中。

将此与类进行对比，类在结构完整存储的任何地方都有引用，而引用指向堆上的某处。（内部成员，本地/堆栈参数）

稍微了解一下 C++ 可能会有所帮助，其中类/结构之间没有真正的区别。（语言中有类似的名称，但它们仅指事物的默认可访问性）当您调用 new 时，您将获得指向堆位置的指针，而如果您有非指针引用，则它直接存储在堆栈中或在另一个对象中，C# 中的 ala 结构。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-15T04:11:10.220

与所有值类型一样，结构总是在它们被*声明*的地方。

有关何时使用结构的更多详细信息，请[在此处](https://stackoverflow.com/questions/85553/when-should-i-use-a-struct-instead-of-a-class)查看此问题。这个问题[在这里](https://stackoverflow.com/questions/37931/whats-the-use-of-value-types-in-net)了解更多关于结构的信息。

**编辑：**我错误地回答说他们*总是*在堆栈中。这是[不正确](http://www.c-sharpcorner.com/UploadFile/rmcochran/csharp_memory01122006130034PM/csharp_memory.aspx?ArticleID=9adb0e3c-b3f6-40b5-98b5-413b6d348b91)的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-01T04:07:05.243

我可能在这里遗漏了一些东西，但我们为什么要关心分配？

值类型是按值传递的；），因此不能在与定义它们的范围不同的范围内进行变异。为了能够改变值，您必须添加 [ref] 关键字。

引用类型是通过引用传递的，并且可以被改变。

当然，不可变引用类型字符串是最流行的一种。

数组布局/初始化：值类型 -> 零内存 [name,zip][name,zip] 引用类型 -> 零内存 -> null [ref][ref]

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-09-08T08:08:16.217

`class`or`struct`声明就像一个蓝图，用于在运行时创建实例或对象。如果定义一个`class`或`struct`称为 Person，Person 是类型的名称。如果您声明并初始化一个 Person 类型的变量 p，则 p 被称为 Person 的对象或实例。可以创建相同 Person 类型的多个实例，每个实例的 和 中可以有不同的`properties`值`fields`。

A`class`是引用类型。创建 的对象时`class`，分配给该对象的变量仅保存对该内存的引用。当对象引用分配给新变量时，新变量引用原始对象。通过一个变量所做的更改会反映在另一个变量中，因为它们都引用相同的数据。

A`struct`是一个值类型。创建a 时`struct`，分配给 的变量`struct`保存结构的实际数据。当`struct`被分配给一个新变量时，它被复制。因此，新变量和原始变量包含相同数据的两个单独副本。对一个副本所做的更改不会影响另一个副本。

通常，用于对更复杂的行为或在创建对象`classes`后要修改的数据进行建模。最适合主要包含在创建后不打算修改的数据的小型数据结构。`class``Structs``struct`

[更多...](http://msdn.microsoft.com/en-us/library/ms173109.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-15T04:11:47.443

结构被分配到堆栈。这是一个有用的解释：

[结构](http://www.developerfusion.com/article/4341/the-quick-dirty-net-guide-to-cvb-oop/7/)

> 此外，在 .NET 中实例化的类会在堆或 .NET 的保留内存空间上分配内存。而由于在堆栈上分配，结构在实例化时会产生更高的效率。此外，应该注意的是，在结构中传递参数是按值完成的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-15T05:26:08.807

几乎所有被认为是值类型的结构都在堆栈上分配，而对象在堆上分配，而对象引用（指针）在堆栈上分配。

# svn - 有什么方法可以忽略来自 NTFS 存储库的文件？

> ID：203702
> 
> 赞同：4
> 
> 时间：2008-10-15T04:14:01.993
> 
> 标签：svn, ntfs

好的，所以在某个时间点，有人将一些名称需要区分大小写的文件系统的文件签入到我经常签出的存储库的主干中。当我尝试检查它时（在我的 Windows 计算机上），这当然会导致我的本地工作副本锁定。有什么方法可以设置我的本地颠覆副本，以便它会忽略任何名称不同的文件，只是以防万一？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T04:23:25.190

您可以使用存储库浏览器删除/重命名有问题的文件，然后照常更新您的工作副本，修复对您重命名的文件可能需要修复的任何引用，然后提交修复。

然后拿起霰弹枪射击最开始这样做的人。区分大小写的滥用是我难以原谅的少数难闻的气味之一。

（编辑：假设 TortoiseSVN，但解决方案适用于任何 SVN 实现。你只是不能使用漂亮的浏览器。）

**编辑：**

另一种选择是重命名文件的本地版本，然后使用存储库浏览器检查冲突文件的第二个版本，移动内容，如上所述整理引用，然后提交更改。

这样做的好处是只需要一次提交，并且不会不必要地与可能正在或可能不会使用这两个文件的其他人打交道。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T04:40:02.190

++一氧化碳

我会亲自清理存储库，然后采取保护措施以防止将来发生这种情况。尽管它的工作量更大。

这是一个链接来完成修复存储库的过程，然后您可以添加他们在说明中描述的钩子。

[http://subversion.tigris.org/faq.html#case-change](http://subversion.tigris.org/faq.html#case-change)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T04:26:13.780

使用 Interix 的编译器重新编译 svn。现在它可以在 NTFS 上正确处理大小写。

# jquery - jQuery选择器“祖先后代”和“父>子”之间的区别

> ID：203707
> 
> 赞同：14
> 
> 时间：2008-10-15T04:17:29.960
> 
> 标签：jquery

以下两种形式的 jQuery 选择器似乎做同样的事情：

*   $("div > ul.posts")
*   $("div ul.posts")

即选择“div”元素下的“posts”类的所有“ul”元素。

有什么区别吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-15T04:22:35.800

关于，只会选择 s 的`$("div > ul.posts")`直接后代。`DIV`

```
<div>
    <ul class="posts"> <!--SELECTED-->
        <li>List Item</li>
        <ul class="posts"> <!--NOT SELECTED-->
            <li>Sub list item</li>
        </ul>
    </ul>

    <fieldset>
        <ul class="posts"> <!--NOT SELECTED-->
            <li>List item</li>
        </ul>
    </fieldset>

    <ul class="posts"> <!--SELECTED-->
        <li>List item</li>
    </ul>
</div> 
```

while`$("div ul.posts")`将选择所有符合条件的后代。所以 all 和 any`ul.posts`都将被选中，无论它们的嵌套级别是多少，只要沿着链的某个位置，它们都在一个`div`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-15T04:19:18.100

第一个只选择 parentNode 为 div 的 ul.posts。

第二个也会选择：

```
<div>
    <blockquote>
        <ul class="posts"></ul>
    </blockquote>
</div> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-19T15:57:07.290

哦。所以“祖先后代”是指一个父元素下的所有指定元素，无论嵌套多深

虽然“父子元素”仅指第一个指定元素，即使它再次出现在父元素下的其他地方

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-16T17:04:57.580

我只是在这里添加一个熟悉的参考。我意识到这是在最初的问题之后多年，但它在谷歌的第一页上，也许这对其他人有帮助。

想想现实世界的祖先和父母。父母和孩子总是相隔一代，但祖先和他们的后代可以相隔数百年。该`>`符号有助于象征父母和孩子之间的直接关系。

# windows - 如何确定接口是否是 Windows PC 上的物理 LAN 端口？

> ID：203709
> 
> 赞同：5
> 
> 时间：2008-10-15T04:17:55.560
> 
> 标签：windows, wmi, admin, ipconfig

我正在寻找一种方法来准确确定接口是否是 Windows 中 PC 上的物理 802.3 以太网端口。

使用 ipconfig /all 我可以列出所有接口，当我在我的电脑上执行此操作时，可以在此处列出几个条目，包括 VPN、蓝牙、Wifi 和物理以太网接口。

我正在寻找类似“isPhysical(interface)”的东西。（有多个物理网口没问题，我只想知道是不是物理网口）。

**更新：**

杰伊和克里斯谢谢！

（评论空间不够，我就在这里发）

我目前正在考虑使用 WMI Win32_NetworkAdapter。但是，它显示了 AdapterType="Ethernet 802.3" 的 4 个接口。

我的电脑上只有 1 个物理端口，其他端口的名称为“虚拟机网络服务驱动程序”。（我认为这些是我的公司出于某些邪恶的原因安装的）

我在界面中找到了我需要的属性，但是在winXP下没有！！！

> PhysicalAdapter 数据类型：布尔型 访问类型：只读
> 
> 指示适配器是物理适配器还是逻辑适配器。如果为 True，则适配器是物理的。**Windows Server 2003、Windows XP、Windows 2000 和 Windows NT 4.0：此属性不可用。**

除了对名称中的“虚拟”一词进行文本过滤之外，有什么方法可以确定它是否是物理端口？

**更新 12/08**

看起来虚拟接口是在安装 VM 时添加的。

以下是有关虚拟适配器的一些详细信息：http: [//blogs.msdn.com/virtual_pc_guy/archive/2005/04/01/404816.aspx](http://blogs.msdn.com/virtual_pc_guy/archive/2005/04/01/404816.aspx)

发现如果用户没有管理员权限，WMI 界面不会返回所需数据的问题。所以，现在看看 GetAdapterInfo 方法。但是，它似乎在实际适配器的描述中添加了“虚拟机服务驱动程序”，使得“虚拟”文本检查无效。

GetAdapterInfo 返回的结构：

[http://msdn.microsoft.com/en-us/library/aa366062(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa366062(VS.85).aspx)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-15T04:41:40.877

调用[GetIfEntry](http://msdn.microsoft.com/en-us/library/aa365939(VS.85).aspx)并在返回的[MIB_IFROW](http://msdn.microsoft.com/en-us/library/aa366836(VS.85).aspx)结构中查找 IF_TYPE_ETHERNET_CSMACD 的 dwType。

或者在 .NET 中，查找具有以太网[NetworkInterfaceType的 System.Net.NetworkInformation.NetworkInterface。](http://msdn.microsoft.com/en-us/library/system.net.networkinformation.networkinterface.networkinterfacetype.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T05:09:15.160

到目前为止，我见过的任何 Windows 2000 SP2 及更高版本的最佳方法是使用 WMI。

[http://msdn.microsoft.com/en-us/library/aa394582(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa394582(VS.85).aspx)

Win32_NetworkAdapter [http://msdn.microsoft.com/en-us/library/aa394216(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa394216(VS.85).aspx)

您可以使用 Jay 提到的命名空间 System.Net.NetworkInformation。这是一个关于检测哪些网卡连接或断开的链接：

[http://felizk.dk/?p=43](http://felizk.dk/?p=43)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T09:10:20.723

通过以下方式检查接口：调用 GetIfEntry 并在返回的 MIB_IFROW 结构中查找 IF_TYPE_ETHERNET_CSMACD 的 dwType。

或者在 .NET 中，查找具有以太网 NetworkInterfaceType 的 System.Net.NetworkInformation.NetworkInterface。

并检查名称是否包含文本“虚拟”。

---这似乎是一种蹩脚的检查方式，但到目前为止，这是我看到的唯一忽略那些虚拟 802.3 适配器的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T04:25:24.607

如果一台机器有两个网卡，你将如何选择哪一个是正确的？我看到这样做的唯一方法是为用户提供一个包含每个接口 IP 地址的下拉组合。有关示例，请参见 Wireshark -

如果有其他解决方案，我想听听他们 -

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-15T04:26:46.820

我不确定答案 - 但请注意，可能有多个以太网接口。

# ruby - 充当可标记的merb？

> ID：203719
> 
> 赞同：0
> 
> 时间：2008-10-15T04:26:17.493
> 
> 标签：ruby, merb

是否已经有针对 merb 用户的可标记解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T20:41:58.927

[Datamapper的 dm 标签](http://dm-tags.rubyforge.org/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T13:24:50.680

看起来您的问题的答案是“否”。

我确实发现[这](http://www.mbleigh.com/2008/6/11/gemplugins-a-brief-introduction-to-the-future-of-rails-plugins)至少表现出一些兴趣，但现在已经几个月了，没有明显的进展。

也许您可以通过改写问题来获得更多信息？诸如“哪些选项可用于在 Merb 中进行标记？”

# asp.net - 处理时 VB 脚本中的错误日志信息

> ID：203732
> 
> 赞同：0
> 
> 时间：2008-10-15T04:38:08.763
> 
> 标签：asp.net, vbscript, error-handling

我有一个由许多作业实例运行的 VBScript 文件。如果脚本处理中出现任何错误，我需要记录错误信息。如果我维护一个日志文件，那么我如何区分 vb 脚本调用的每个实例（大约 10 个同时实例）的日志文件。

我不进行任何数据库日志记录。

请推荐一些好的方法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-15T04:47:47.963

我会为所有实例使用相同的日志文件。然后我会让每个实例创建一个 GUID：

[http://www.microsoft.com/technet/scriptcenter/resources/qanda/feb05/hey0221.mspx](http://www.microsoft.com/technet/scriptcenter/resources/qanda/feb05/hey0221.mspx)

当实例记录错误时，它使用 GUID 来标识自己。这样，如果您有 10 个或 50 个实例，它们将在日志记录中是唯一的，并且您不会到处都有大量的日志文件。

# javascript - 为什么 instanceof 对某些文字返回 false ？

> ID：203739
> 
> 赞同：313
> 
> 时间：2008-10-15T04:44:20.997
> 
> 标签：javascript, literals, instanceof

```
"foo" instanceof String //=> false
"foo" instanceof Object //=> false

true instanceof Boolean //=> false
true instanceof Object //=> false
false instanceof Boolean //=> false
false instanceof Object //=> false

12.21 instanceof Number //=> false
/foo/ instanceof RegExp //=> true

// the tests against Object really don't make sense 
```

数组字面量和对象字面量匹配...

```
[0,1] instanceof Array //=> true
{0:1} instanceof Object //=> true 
```

为什么不是全部？或者，为什么他们不都*没有*？
那么，它们是什么例子呢？

在 FF3、IE7、Opera 和 Chrome 中也是如此。所以，至少它是一致的。

* * *

## 回答 #1

> 赞同：479
> 
> 时间：2008-10-15T04:54:52.020

基元是一种不同于从 Javascript 中创建的对象的类型。来自[Mozilla API 文档](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Special_Operators/instanceof_Operator)：

```
var color1 = new String("green");
color1 instanceof String; // returns true
var color2 = "coral";
color2 instanceof String; // returns false (color2 is not a String object) 
```

我找不到任何用代码构造原始类型的方法，也许这是不可能的。这可能是人们使用`typeof "foo" === "string"`而不是`instanceof`.

记住这样的事情的一个简单方法是问自己“我想知道什么是理智和容易学习的”？无论答案是什么，Javascript 都会做另一件事。

* * *

## 回答 #2

> 赞同：118
> 
> 时间：2011-10-14T19:38:48.857

我用：

```
function isString(s) {
    return typeof(s) === 'string' || s instanceof String;
} 
```

因为在 JavaScript 中字符串可以是文字或对象。

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2013-08-05T11:35:25.690

在 JavaScript 中，一切都是对象（或者至少可以被视为对象），除了[基本](https://developer.mozilla.org/en-US/docs/Glossary/Primitive)类型（布尔值、null、数字、字符串和值`undefined`（以及 ES6 中的符号））：

```
console.log(typeof true);           // boolean
console.log(typeof 0);              // number
console.log(typeof "");             // string
console.log(typeof undefined);      // undefined
console.log(typeof null);           // object
console.log(typeof []);             // object
console.log(typeof {});             // object
console.log(typeof function () {}); // function 
```

如您所见，对象、数组和值`null`都被视为对象（`null`是对不存在的对象的引用）。函数之所以与众不同，是因为它们是一种特殊类型的*可调用*对象。然而，它们仍然是对象。

另一方面，文字,`true`和不是对象。它们是 JavaScript 中的原始值。然而，布尔值、数字和字符串也有构造函数，它们分别包装各自的原语以提供附加功能：`0``""``undefined``Boolean``Number``String`

```
console.log(typeof new Boolean(true)); // object
console.log(typeof new Number(0));     // object
console.log(typeof new String(""));    // object 
```

正如您所看到的，当原始值分别包含在`Boolean`,`Number`和`String`构造函数中时，它们分别成为对象。该`instanceof`运算符仅适用于对象（这就是它返回`false`原始值的原因）：

```
console.log(true instanceof Boolean);              // false
console.log(0 instanceof Number);                  // false
console.log("" instanceof String);                 // false
console.log(new Boolean(true) instanceof Boolean); // true
console.log(new Number(0) instanceof Number);      // true
console.log(new String("") instanceof String);     // true 
```

如您所见，两者`typeof`都`instanceof`不足以测试一个值是布尔值、数字还是字符串 -`typeof`仅适用于原始布尔值、数字和字符串；并且`instanceof`不适用于原始布尔值、数字和字符串。

幸运的是，这个问题有一个简单的解决方案。的默认实现`toString`（即它本身定义在 上）返回原始值和对象`Object.prototype.toString`的内部属性：`[[Class]]`

```
function classOf(value) {
    return Object.prototype.toString.call(value);
}

console.log(classOf(true));              // [object Boolean]
console.log(classOf(0));                 // [object Number]
console.log(classOf(""));                // [object String]
console.log(classOf(new Boolean(true))); // [object Boolean]
console.log(classOf(new Number(0)));     // [object Number]
console.log(classOf(new String("")));    // [object String] 
```

值的内部`[[Class]]`属性比值更有用`typeof`。我们可以`Object.prototype.toString`用来创建我们自己的（更有用的）`typeof`操作符版本，如下所示：

```
function typeOf(value) {
    return Object.prototype.toString.call(value).slice(8, -1);
}

console.log(typeOf(true));              // Boolean
console.log(typeOf(0));                 // Number
console.log(typeOf(""));                // String
console.log(typeOf(new Boolean(true))); // Boolean
console.log(typeOf(new Number(0)));     // Number
console.log(typeOf(new String("")));    // String 
```

希望这篇文章有所帮助。要了解有关原语和包装对象之间差异的更多信息，请阅读以下博客文章：[JavaScript 原语的秘密生活](http://javascriptweblog.wordpress.com/2010/09/27/the-secret-life-of-javascript-primitives/ "JavaScript 基元的秘密生活 |  JavaScript, JavaScript...")

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2009-07-26T23:10:50.880

您可以使用构造函数属性：

```
'foo'.constructor == String // returns true
true.constructor == Boolean // returns true 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2017-08-23T10:33:53.250

```
 typeof(text) === 'string' || text instanceof String; 
```

你可以使用它，它适用于两种情况

1.  `var text="foo";` // typeof 会起作用

2.  `String text= new String("foo");` // instanceof 将起作用

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-06-18T19:29:31.987

这在 ECMAScript 规范[第 7.3.19 步第 3 节](https://www.ecma-international.org/ecma-262/6.0/#sec-ordinaryhasinstance)中定义：`If Type(O) is not Object, return false.`

换句话说，如果`Obj`in`Obj instanceof Callable`不是一个对象，`instanceof`就会直接短路到`false`。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-03-17T23:19:39.113

我相信我已经提出了一个可行的解决方案：

```
Object.getPrototypeOf('test') === String.prototype    //true
Object.getPrototypeOf(1) === String.prototype         //false 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-02-15T18:27:09.553

原始包装类型是在读取字符串、数字或布尔值时在后台自动创建的引用类型。例如：

```
var name = "foo";
var firstChar = name.charAt(0);
console.log(firstChar); 
```

这是幕后发生的事情：

```
// what the JavaScript engine does
var name = "foo";
var temp = new String(name);
var firstChar = temp.charAt(0);
temp = null;
console.log(firstChar); 
```

因为第二行像对象一样使用字符串（原语），所以 JavaScript 引擎会创建一个 String 的实例，以便 charAt(0) 可以工作。String 对象在它被销毁之前只存在一个语句检查[这个](https://dev.to/benjaminmock/do-you-know-what-autoboxing-in-js-is-enl)

**instanceof**运算符返回 false ，因为只有在读取值时才会创建临时对象。因为 instanceof 实际上并没有读取任何内容，所以没有创建临时对象，它告诉我们这些值不是原始包装类型的实例。您可以手动创建原始包装器类型

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2015-01-12T09:59:50.023

对我来说，造成的混乱

```
"str".__proto__ // #1
=> String 
```

所以`"str" istanceof String`应该返回`true`，因为 istanceof 的工作原理如下：

```
"str".__proto__ == String.prototype // #2
=> true 
```

表达式**#1**和**#2**的结果相互冲突，所以应该有一个错误。

**#1 错了**

我发现它是由`__proto__`非标准属性引起的，所以使用标准属性：`Object.getPrototypeOf`

```
Object.getPrototypeOf("str") // #3
=> TypeError: Object.getPrototypeOf called on non-object 
```

**现在表达式#2**和**#3**之间没有混淆

 *** * *

## 回答 #10

> 赞同：-8
> 
> 时间：2010-02-16T16:54:35.380

或者您可以像这样制作自己的功能：

```
function isInstanceOf(obj, clazz){
  return (obj instanceof eval("("+clazz+")")) || (typeof obj == clazz.toLowerCase());
}; 
```

用法：

```
isInstanceOf('','String');
isInstanceOf(new String(), 'String'); 
```

这些都应该返回true。

# c - 如何加入挂在阻塞 IO 上的线程？

> ID：203754
> 
> 赞同：29
> 
> 时间：2008-10-15T04:53:28.997
> 
> 标签：c, linux, multithreading, pthreads

我有一个线程在后台运行，它以阻塞方式从输入设备读取事件，现在当我退出应用程序时，我想正确清理线程，但我不能只运行 pthread_join() 因为线程由于阻塞 IO，永远不会退出。

我该如何正确解决这种情况？我应该发送 pthread_kill(theard, SIGIO) 还是 pthread_kill(theard, SIGALRM) 来打破块？这是否是正确的信号？还是有另一种方法来解决这种情况并让该子线程退出阻塞读取？

目前有点困惑，因为我的谷歌搜索都没有找到解决方案。

这是在 Linux 上并使用 pthreads。

编辑：我玩了一下 SIGIO 和 SIGALRM，当我不安装信号处理程序时，它们会破坏阻塞 IO，但会在控制台上给出一条消息（“I/O 可能”）但是当我安装信号处理程序时，为避免该消息，它们不再中断阻塞 IO，因此线程不会终止。所以我有点回到第一步。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2010-09-26T22:08:01.400

执行此操作的规范方法是使用`pthread_cancel`，线程已经完成`pthread_cleanup_push`/`pop`为它正在使用的任何资源提供清理。

不幸的是，这永远不能在 C++ 代码中使用。任何 C++ 标准库代码，或`try {} catch()`当时调用堆栈上的任何代码`pthread_cancel`都可能 segvi 杀死你的整个进程。

唯一的解决方法是处理`SIGUSR1`，设置停止标志，`pthread_kill(SIGUSR1)`然后在 I/O 上阻塞线程的任何地方，如果`EINTR`在重试 I/O 之前检查停止标志。在实践中，这在 Linux 上并不总是成功，不知道为什么。

但无论如何，谈论是否必须调用任何 3rd 方库是没有用的，因为它们很可能有一个紧密的循环，只会在`EINTR`. 对他们的文件描述符进行逆向工程以关闭它也不会切断它——他们可能正在等待信号量或其他资源。在这种情况下，根本不可能编写工作代码。是的，这完全是脑残。与设计 C++ 异常和`pthread_cancel`. 据说这可能会在未来的 C++ 版本中得到修复。祝你好运。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-15T08:29:21.683

我也建议使用 select 或其他一些非基于信号的方法来终止你的线程。我们拥有线程的原因之一是试图摆脱疯狂的信号。那就是说...

通常使用 pthread_kill() 和 SIGUSR1 或 SIGUSR2 向线程发送信号。其他建议的信号——SIGTERM、SIGINT、SIGKILL——具有您可能不感兴趣的进程范围的语义。

至于你发送信号时的行为，我的猜测是它与你如何处理信号有关。如果您没有安装处理程序，则应用该信号的默认操作，但在接收信号的线程的上下文中。因此，例如，SIGALRM 将由您的线程“处理”，但处理将包括终止进程——可能不是所需的行为。

线程接收到信号通常会将其从使用 EINTR 的读取中中断，除非它确实处于前面答案中提到的那种不间断状态。但我认为不是，否则您对 SIGALRM 和 SIGIO 的实验不会终止该过程。

您的阅读可能处于某种循环中吗？如果读取以 -1 返回终止，则跳出该循环并退出线程。

您可以使用我放在一起的这个非常草率的代码来测试我的假设——我现在离我的 POSIX 书籍有几个时区......

```
#include <stdlib.h>
#include <stdio.h>
#include <pthread.h>
#include <signal.h>

int global_gotsig = 0;

void *gotsig(int sig, siginfo_t *info, void *ucontext) 
{
        global_gotsig++;
        return NULL;
}

void *reader(void *arg)
{
        char buf[32];
        int i;
        int hdlsig = (int)arg;

        struct sigaction sa;
        sa.sa_handler = NULL;
        sa.sa_sigaction = gotsig;
        sa.sa_flags = SA_SIGINFO;
        sigemptyset(&sa.sa_mask);

        if (sigaction(hdlsig, &sa, NULL) < 0) {
                perror("sigaction");
                return (void *)-1;
        }
        i = read(fileno(stdin), buf, 32);
        if (i < 0) {
                perror("read");
        } else {
                printf("Read %d bytes\n", i);
        }
        return (void *)i;
}

main(int argc, char **argv)
{
        pthread_t tid1;
        void *ret;
        int i;
        int sig = SIGUSR1;

        if (argc == 2) sig = atoi(argv[1]);
        printf("Using sig %d\n", sig);

        if (pthread_create(&tid1, NULL, reader, (void *)sig)) {
                perror("pthread_create");
                exit(1);
        }
        sleep(5);
        printf("killing thread\n");
        pthread_kill(tid1, sig);
        i = pthread_join(tid1, &ret);
        if (i < 0)
                perror("pthread_join");
        else
                printf("thread returned %ld\n", (long)ret);
        printf("Got sig? %d\n", global_gotsig);

} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-15T06:54:36.210

为了在特定条件下优雅地退出线程，您`select()`可能会有超时，即使它不经常发生。我知道，民意调查很糟糕...

另一种选择是为每个孩子设置一个管道，并将其添加到线程正在监视的文件描述符列表中。当您希望该子级退出时，从父级向管道发送一个字节。不以每个线程的管道为代价进行轮询。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-15T06:57:03.367

取决于它如何等待 IO。

如果线程处于“Uninterruptible IO”状态（在顶部显示为“D”），那么您真的无能为力。线程通常只是短暂地进入这个状态，做一些事情，比如等待页面被交换（或按需加载，例如从 mmap'd 文件或共享库等），但是失败（特别是 NFS 服务器）可能导致它会在那个状态停留更长时间。

真的没有办法摆脱这种“D”状态。线程不会响应信号（您可以发送它们，但它们将被排队）。

如果是普通的 IO 函数，如 read()、write() 或等待函数，如 select() 或 poll()，信号将正常传递。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-04-26T03:18:42.093

随着事情的发展和新技术可以*更好地*处理线程中的信号，老问题很可能会得到新的答案。

从 Linux 内核 2.6.22 开始，系统提供了一个名为的新函数，该函数`signalfd()`可用于为给定的一组 Unix 信号打开文件描述符（完全杀死进程的信号除外。）

```
// defined a set of signals
sigset_t set;
sigemptyset(&set);
sigaddset(&set, SIGUSR1);
// ... you can add more than one ...

// prevent the default signal behavior (very important)
sigprocmask(SIG_BLOCK, &set, nullptr);

// open a file descriptor using that set of Unix signals
f_socket = signalfd(-1, &set, SFD_NONBLOCK | SFD_CLOEXEC); 
```

现在您可以使用`poll()`or`select()`函数沿您正在侦听的更常用的文件描述符（套接字、磁盘上的文件等）侦听信号。

如果您想要一个可以一遍又一遍地检查信号和其他文件描述符的循环（即，它对您的其他文件描述符也很重要），那么 NONBLOCK 很重要。

我有这样一个实现，它适用于 (1) 计时器、(2) 套接字、(3) 管道、(4) Unix 信号、(5) 常规文件。实际上，实际上是任何文件描述符加上计时器。

[https://github.com/m2osw/snapcpp/blob/master/snapwebsites/libsnapwebsites/src/snapwebsites/snap_communicator.cpp](https://github.com/m2osw/snapcpp/blob/master/snapwebsites/libsnapwebsites/src/snapwebsites/snap_communicator.cpp)
[https://github.com/m2osw/snapcpp/blob/master/snapwebsites/libsnapwebsites/src/snapwebsites /snap_communicator.h](https://github.com/m2osw/snapcpp/blob/master/snapwebsites/libsnapwebsites/src/snapwebsites/snap_communicator.h)

您可能还对[libevent等库感兴趣](http://libevent.org/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-15T06:53:56.540

上次遇到此类问题时，我想到的一个解决方案是创建一个文件（例如管道），该文件仅用于唤醒阻塞线程。

这个想法是从主循环创建一个文件（或每个线程 1 个，正如超时所暗示的那样 - 这将使您更好地控制唤醒哪些线程）。所有在文件 I/O 上阻塞的线程都会使用它们尝试操作的文件以及主循环创建的文件（作为读取的成员）执行 select()文件描述符集）。这应该使所有 select() 调用返回。

需要将用于从主循环处理此“事件”的代码添加到每个线程。

如果主循环需要唤醒所有线程，它可以写入文件或关闭它。

* * *

我不能确定这是否有效，因为重组意味着尝试它的需要消失了。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-15T05:47:47.250

我认为，正如您所说，唯一的方法是发送一个信号，然后适当地捕获并处理它。替代方案可能是 SIGTERM、SIGUSR1、SIGQUIT、SIGHUP、SIGINT 等。

您还可以在输入描述符上使用 select() ，以便仅在准备好时读取。您可以使用 select() 超时，例如一秒，然后检查该线程是否应该完成。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-15T07:43:01.760

我总是添加一个与我在加入之前运行的线程函数相关的“ *kill* ”函数，以确保线程可以在合理的时间内加入。当线程使用阻塞 IO 时，我会尝试利用系统来打破锁定。例如，当使用套接字时，我会在其上执行 kill call *shutdown(2)*或*close(2)*，这将导致网络堆栈干净地终止它。

Linux 的套接字实现是线程安全的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-25T23:26:06.277

我很惊讶没有人建议 pthread_cancel。我最近写了一个多线程 I/O 程序，然后调用 cancel() 和 join() 工作得很好。

我最初尝试了 pthread_kill() 但最终只是用我测试的信号终止了整个程序。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-16T20:28:33.907

如果您在 EINTR 上循环的第三方库中阻塞，您可能需要考虑将 pthread_kill 与调用空函数（而不是 SIG_IGN）的信号（USR1 等）与实际关闭/替换文件描述符的组合问题。通过使用 dup2 将 fd 替换为 /dev/null 或类似内容，您将导致第三方库在重试读取时获得文件结束结果。

请注意，通过首先对原始套接字进行 dup()，您可以避免需要实际关闭套接字。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-15T07:57:20.843

根据不同的手册页，信号和线程是 Linux 上的一个微妙问题。你使用 LinuxThreads 还是 NPTL（如果你在 Linux 上）？

我不确定这一点，但我认为信号处理程序会影响整个过程，所以要么终止整个过程，要么一切继续。

您应该使用定时选择或轮询，并设置一个全局标志来终止您的线程。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-15T13:58:03.283

我认为最干净的方法是让线程在循环中使用条件变量来继续。

当触发 i/o 事件时，应发出条件信号。

主线程可以在将循环谓词更改为 false 时发出条件信号。

就像是：

```
while (!_finished)
{
    pthread_cond_wait(&cond);
    handleio();
}
cleanup(); 
```

请记住使用条件变量来正确处理信号。他们可以有诸如“虚假唤醒”之类的东西。所以我会在 cond_wait 函数周围包装你自己的函数。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-15T16:07:22.663

```
struct pollfd pfd;
pfd.fd = socket;
pfd.events = POLLIN | POLLHUP | POLLERR;
pthread_lock(&lock);
while(thread_alive)
{
    int ret = poll(&pfd, 1, 100);
    if(ret == 1)
    {
        //handle IO
    }
    else
    {
         pthread_cond_timedwait(&lock, &cond, 100);
     }
}
pthread_unlock(&lock); 
```

thread_alive 是一个线程特定的变量，可以与信号结合使用来杀死线程。

至于句柄 IO 部分，您需要确保您使用 open 与 O_NOBLOCK 选项，或者如果它是一个套接字，您可以设置 MSG_NOWAIT?? 类似的标志。对于其他 fds 我不确定

# javascript - 当 asp.net 应用程序在 firefox 下运行时，如何在 Visual Studio 中调试 javascript？

> ID：203756
> 
> 赞同：7
> 
> 时间：2008-10-15T04:54:42.833
> 
> 标签：javascript, debugging

在 mozilla firefox 浏览器下运行 asp.net 应用程序时，如何在 Visual Studio 中调试 javascript？IE 通过启用 javascript 调试选项来支持。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-15T04:59:25.723

目前，没有允许您直接在 Visual Studio 中调试 JavaScript 的 Firefox 扩展。

Visual Studio 2008 附带了一个非常好的[JavaScript 调试器](http://www.asp.net/learn/3.5-videos/video-219.aspx)，但您必须在 Internet Explorer 中使用它。

为了在 Firefox 上调试 JavaScript，我强烈推荐你[Firebug](http://www.getfirebug.com/)，它是一个非常好的 JavaScript 调试器......

# python - 接收socket大小限制好不好？

> ID：203758
> 
> 赞同：2
> 
> 时间：2008-10-15T04:55:33.843
> 
> 标签：python, sockets

我正在用 Python 编写一个程序，它将充当服务器并接受来自客户端的数据，对数据量施加硬性限制是个好主意，如果是，为什么？

更多信息：因此，某些聊天程序限制了每次发送（即每次用户按下发送）可以发送的文本量，所以问题归结为是否有正当理由，如果是，那是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T07:17:11.187

您很可能已经看到了防止“额外”传入数据的代码。这通常是由于缓冲区溢出的可能性，其中复制到内存中的额外数据超出了预先分配的数组并用攻击者代码覆盖了可执行代码。用 C 等语言编写的代码通常会进行大量长度检查以防止此类攻击。get 和 strcpy 等函数被替换为更安全的对应函数，如 fgets 和 strncpy，它们有一个长度参数来防止缓冲区溢出。

如果你使用像 Python 这样的动态语言，你的数组会调整大小，这样它们就不会溢出和破坏其他内存，但你仍然必须小心清理外部数据。

由于数据库字段大小等原因，聊天程序可能会限制消息的大小。如果 80% 的传入消息是 40 个字符或更少，90% 是 60 个字符或更少，98% 是 80 个字符或更少，为什么让你的消息文本字段允许每条消息 10k 个字符？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T05:00:04.523

你的问题到底是什么？

当您在套接字上接收时，会立即返回套接字缓冲区中的当前可用数据。如果您给接收（或读取，我猜）一个巨大的缓冲区大小，例如 40000，它可能永远不会一次返回那么多数据。如果你给它一个很小的缓冲区大小，比如 100，那么它会立即返回它拥有的 100 个字节，并且仍然有更多可用的字节。无论哪种方式，您都不会限制客户端向您发送的数据量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T01:10:57.573

我不知道您的实际应用程序是什么，但是，对客户端可以发送的数据总量设置硬性限制可能有助于减少您遭受拒绝服务攻击的风险，例如客户端连接并发送 100MB 的数据可能会无法接受地加载您的应用程序。

但这实际上取决于您的应用程序是什么。您是在追求每条线路的限制还是每个连接的总限制或什么？

# unit-testing - 使用 CPPUnit 从异常中恢复

> ID：203771
> 
> 赞同：2
> 
> 时间：2008-10-15T05:01:12.337
> 
> 标签：unit-testing, exception, testing, cppunit

我一直在使用 CPPUnit 作为单元测试框架，现在正尝试在自动化构建和打包系统中使用它。然而，一个阻碍我的问题是，如果在单元测试运行期间发生崩溃，例如空指针取消引用，它会停止其余的自动化。

CPPUnit 有没有办法从异常中恢复，记录测试失败，然后优雅地存在而不是终止单元测试过程？即使是针对空指针取消引用的特定方法也会很有用，因为它构成了我遇到的大约 90% 的问题。

为了特定于技术，我在 Windows 系统上使用 makefile。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T06:40:50.590

您正在构建过程中自动执行基于 cppunit 的单元测试，对吗？

如果您尝试使用 CppUnit 执行构建过程，我会很想说不要那样做！

你能告诉我们当单元测试崩溃时是什么停止了构建过程吗？你的单元测试是从什么开始的，一个 Makefile，一个你自己的脚本，还是一个[持续集成框架](http://en.wikipedia.org/wiki/Continuous_Integration#Software)？

* * *

为了尝试回答您的问题，CppUnit 无法从违规或分段错误中恢复。在类 Unix 系统上，您应该能够捕获 SIGSEGV 并继续，**但是** **处于哪个状态**？

如果您的崩溃发生在您的单元测试中而不是您的产品中，那么我建议您依靠[断言保护](http://xunitpatterns.com/Guard%20Assertion.html)来防止取消引用 NULL 指针：

```
class TestObject : public CPPUNIT_NS::TestCase
{
  CPPUNIT_TEST_SUITE(Test);
  CPPUNIT_TEST(testObjectIsReady);
  CPPUNIT_TEST_SUITE_END();

public:
  void setUp(void) {}
  void tearDown(void) {} 

protected:
  void testObjectIsReady(void)
  { 
     Object *theObject = GetObject();

     CPPUNIT_ASSERT_MESSAGE("check pointer is not null", theObject != NULL);

     //--- now you can play with your object without dereferencing a NULL pointer
     CPPUNIT_ASSERT_MESSAGE("check objet is ready", theObject->isReady());
  }
}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T17:42:54.313

很抱歉这么说，但您之前收到的答案很荒谬。cppunit 在这方面确实欠缺。cppunit 应该实现一个 EXIT_ON_FAIL 宏，它允许您捕获 Windows 中的访问冲突（使用 SetUnhandledExceptionFilter），然后您可以进行任何清理并允许 cpp-unit 通过 EXIT_ON_FAIL 报告故障。然后在报告后，退出应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T05:04:35.450

在 C/C++ 中，从此类错误中恢复的最佳方法是在单独的进程中运行每个测试，然后从父进程监视它们。这在 UNIX 中非常简单——只需在测试开始前进行 fork() 即可。[check](http://check.sourceforge.net/)支持这一点，并且您可能会修补 CPPUnit 以使其具有此行为而无需大惊小怪。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T04:59:34.797

作为稍后阅读此问题的任何人的附加说明，我发现[UnitTest++](http://unittest-cpp.sourceforge.net/UnitTest++.html)可以在测试中捕获异常，并且只是使用适当的信息使测试失败，而不是导致进程退出。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-11T07:35:37.263

我没有尝试过，但如果在 Windows 中，我想使用 SEH 会有所帮助：

```
__try
{
// running your case
}

__except
{
} 
```

将其集成到 CppUnit 框架中，每次收到未知异常时，将案例标记为失败。

# sql-server-2005 - 在 SQL Server (2005) 中存储适量文本的最佳数据类型是什么？

> ID：203780
> 
> 赞同：1
> 
> 时间：2008-10-15T05:11:17.137
> 
> 标签：sql-server-2005, types

在 SQL Server (2005) 中存储适量文本的最佳数据类型是什么？

例如，想象一个表格，存储有关网站上可用下载的信息。我想要一个简短的下载标题，比如 varchar(20)。一条路径，比如 varchar(255) 然后我想存储一些关于下载的用户友好文本 - 描述。在某些情况下，它可能与标题一样短，而在其他情况下，您可能需要几段解释。

什么是最好的？大小为 4000 的 varchar，还是 varchar(max) 或其他？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T05:26:02.643

程序描述的 PAD（便携式应用程序描述）规范最高字符限制为 2000 个字符 *请参阅程序描述部分。

[http://www.asp-shareware.org/pad/spec/spec.php](http://www.asp-shareware.org/pad/spec/spec.php)

下载站点提交工具使用此规范使作者更容易提交他们的软件。此外，我认为您可以下载几个遵循 PAD 规范的列表。

所以我会建议 varchar(2000) 基于我不想存储超过我需要的事实。使用 varchar(max) 记录一条记录就可以了，但是当您拥有数千个存储成本时，存储成本可能会上升。

编辑： varchar(max) 可以是 2GB - 1，这就是我要限制它的原因。 [http://msdn.microsoft.com/en-us/library/ms176089(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms176089(SQL.90).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T05:20:36.913

使用 varchar(max)，您可以在其中放置一个巨大的文本，并且它的存储大小会根据需要增加。您可以在 varchar(max) 上拥有 sql 组函数，例如，group by。或者如果在 SQL 中查找全文搜索，您可以选择文本数据类型

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T16:25:38.040

大小应取决于所存储数据的大小。不要将 varchar (max) 用于只有 2 个字符的状态字段。我通常会查看我期望获得的最大值，然后在确定大小时添加 10-20% 的软糖因子。如果您需要存储 unicode 字符，请不要忘记使用 nvarchar。

# project-planning - 线框图是否过度规划？

> ID：203781
> 
> 赞同：7
> 
> 时间：2008-10-15T05:11:24.140
> 
> 标签：project-planning, wireframe

37 Signal 的*Getting Real*让我相信，线框图和编写功能规范文档是构建 Web 应用程序和动态网站所不需要的中间步骤。

这些步骤的开销值得吗？在 HTML/CSS 甚至是 PhotoShop 文档中进行原型设计（以便设计师可以直接处理它们）是否比使用 Visio 等软件更好？就个人而言，我倾向于后者，但不确定。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-15T06:39:10.767

“计划失败就是计划失败” - 或类似的东西。

线框图不仅限于网络应用程序；它广泛用于任何需要对任何系统进行高级概述的地方（它只是被称为其他东西）。

功能规格，当您知道要做什么以及如何去做时，确实是矫枉过正。您的意图的高级图表就足够了。它*永远不会是不必要*的。它主要帮助您专注于您想做的事情的范围和意图/目标。

重点应该放在防止浪费精力上——在中途发现一些重要的、影响所有其他对象的东西丢失不是你想要发现的。在这种情况下，线框图将有助于检测大多数主要功能需求。您只需要在绝对需要的地方详细说明功能规范。使用 Photoshop 来设计你也将是“浪费精力”——使用带有 CSS/HTML 的进化原型（RAD 技术）要好得多——但仍然可以用笔和纸模拟你的意图。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-15T05:16:09.700

37Signals 甚至提倡跳过 Photoshop 直接使用 HTML。请参阅[http://www.37signals.com/svn/posts/1061-why-we-skip-photoshop](http://www.37signals.com/svn/posts/1061-why-we-skip-photoshop)。我同意他们对预先规划的评估。从长远来看，我认为花时间在 HTML/CSS/JS 中构建工作原型是不值得的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-06-30T08:44:00.693

在现实生活中，您希望避免寻找“理想”的做事方式。而是将您所理解的内容用于明确和具体的目的。

样机可以为您节省大量时间和精力。因为它们可能只是您花在创建和维护它们上的额外时间。

**现实生活中的例子#1：**样机拯救了一天。政府的大系统，期限是荒谬的。

原因： 几个月过去了，各种架构文件实际上是完全没有必要的，因为硬件和软件架构都被固定在最微小的细节上，实际上已经存在。

解决方案：与客户一起疯狂地创建模型 20 天，直到我们简单地将带有笔记的屏幕交给开发人员。开发人员确实不得不要求一些澄清，但由于具有固定的架构和清晰可视化的需求，他们能够立即开发出所需的大量功能。

**现实生活中的例子#2：**样机毁了一天。“认识到”对模型的需求的大型政府系统。

这显示了人类（或公司？）将世界上最好的东西变成噩梦的能力。

大政府机构请大顾问公司带领大IT公司解决问题。政府机构还建立了一个由政府主题专家组成的大型特设机构，以帮助和加快这一进程。

几个月过去了，在决定使用适当的方法和使用它们的正确方法方面。当然，为了不伤害任何人的感情或重要性，做出了各种妥协。

结果：Sw 架构将成为包括模型在内的所有内容的来源。首先设计，然后绘制。从 OOAD 和序列图映射操作，制作 UX 图，然后识别 UI 逻辑对象和内容包，绘制实际屏幕并将其合并到正式用例中，在每月一次的正式研讨会中向用户展示 UC，这些研讨会兼作需求验收会议，因为有人发现时间在流逝。

在那些研讨会上，即使强制客户也无法理解（高度正式的，有许多描述数据属性的表格等）UC，每个大约 30 页长。当客户有一些反馈时，它是在模型上。但不鼓励反馈，因为模型的任何更改都会导致更改序列图、组件图、操作模型、UX 图、检查可追溯性矩阵、更新 UC 文本等。而且只是为了获得更多反馈。（“该死的客户，他们永远不会满足。”是摩托车）。在推出功能有限的 v1.0 之后，没有人再关心文档了，文档太多了。开发者们为自己的生命而战，每天都在做无数的小改动，

这不是使用模型的方式。该项目比计划持续了近 2 年。

换句话说，不要寻找理想的方法。或者任何你不理解的方法。你目前的目标是什么？您知道实现该目标的最快方式是什么（其他方式不算在内）？去吧。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T05:16:38.450

这可能取决于您与谁一起工作。如果是您和设计师，那么功能规格可能会太麻烦。但是，在我的工作中，高管们想准确地知道他们在项目结束时会得到什么，因此我们很难实施迭代开发。通常迭代是用线框、功能规格和模型定义的..:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-01-27T06:20:54.100

做线框图的主要目的是阐明需求。清楚地记录需求总是可取的，没有比可视化需求更好的方法了。线框在这里有很大的帮助，它让产品所有者（客户）清楚地了解最终产品的期望。在得到产品负责人的批准后，它还可以让开发团队更清楚地了解要开发的内容。在某种程度上它可以节省大量的开发时间并避免冲突。在我看来，即使项目很小，线框对于顺利执行项目也总是有用的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-15T12:56:38.600

我相信这取决于你对自己想要做什么的理解程度。如果您正在为客户工作并且他们没有在需求方面表达太多，您可能需要一种具有极快迭代的方法。如果你已经有了很好的理解，并且可以产生更实质性的东西，而不必担心因为方向错误而将其丢弃，那么可以花费更多的时间。无论哪种方式，可点击的原型都可以在很大程度上确定真实站点最终需要什么。如果您可以就原型达成一致，那么当您的应用程序与原型匹配时，您就知道它是完整的。

# artificial-intelligence - 如何检查一个游戏对象是否可以看到另一个？

> ID：203787
> 
> 赞同：10
> 
> 时间：2008-10-15T05:16:35.190
> 
> 标签：artificial-intelligence, visibility

我有一个对象，它面向特定方向，（例如）45 度视野和极限视野范围。我已经完成了所有初始检查（四叉树节点和距离），但现在我需要检查特定对象是否在该视锥内（在这种情况下，如果我们能看到它，则决定只跟随该对象）。

除了从`Direction - (FieldOfView / 2)`to的每个角度投射一条光线`Direction + (FieldOfView / 2)`（我现在正在这样做，这太可怕了），进行这种可见性检查的最佳方法是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-31T16:21:18.187

我在视频游戏行业工作过，我可以说每帧都做像 arccos 这样的三角函数并不理想。相反，您预先计算锥角的余弦：

```
float cos_angle = cos(PI/4); // 45 degrees, for example 
```

然后，您可以通过将每一帧与圆锥和 .

```
vector test_point_vector = normalize(test_point_loc - cone_origin);
float dot_product = dot(normalized_cone_vector, text_point_vector);
bool inside_code = dot_product > cos_angle; 
```

没有三角函数，只有一些乘法、除法和加法。大多数游戏引擎都为向量优化了 normalize() 函数。

这是因为这个等式起作用的：

```
A · B = |A| * |B| * cos(Θ) 
```

如果对向量 (A -> An) 进行归一化，则方程会简化：

```
An · Bn = cos(Θ) 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-15T05:28:02.000

计算您的视图方向（理解为向量）与从您开始到对象结束的向量之间的角度。如果它属于 FieldOfView/2，您可以查看该对象。

那个角度是：

```
arccos(scalarProduct(viewDirection, (object - you)) / (norm(viewDirection)*norm(object - you))). 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-15T05:31:16.567

获取查看器的航向矢量与查看器到目标的矢量之间的角度。如果该角度小于 (FieldOfView/2)，则目标位于观察者的视野中。

如果您的向量是 2d 或 3d，这将以相同的方式工作。（在 3D 中，如果您有一个视锥体而不是圆锥体，那么您需要将角度分成两个分量。）您只需要找到两个向量之间的角度。

如果要测试大于单个点的目标，则每个目标都需要多个点，例如边界框的角。如果从观察者到任何这些点的矢量在视野内给出了一个角度，那么框的那个角是可见的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-15T05:30:58.937

如果您正在做 3D 并且可以将查看范围定义为视锥体，那么您可以使用类似于这种[视锥体剔除](http://www.flipcode.com/archives/Frustum_Culling.shtml)技术的东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-04T12:20:21.460

已经有了很好的答案，但我只是想给你一个 Wolfire 博客的链接，他们最近开始了一个代数系列，以“视野”方程为例。[去读吧](http://blog.wolfire.com/2009/07/linear-algebra-for-game-developers-part-2/)，它写得很好，很容易。

# flash - Flash 播放器可以使用的内存量是否有限制？

> ID：203800
> 
> 赞同：9
> 
> 时间：2008-10-15T05:26:50.880
> 
> 标签：flash, memory

Flash 播放器可以使用的内存量是否有任何限制？如果您的 SWF 随着时间的推移从服务器获取大量数据，那么将有越来越多的数据保存在内存中。对此有限制吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-15T07:45:45.250

不在台式 PC 上运行的任何 Flash 版本中。只要您的应用程序继续使用更多内存，桌面 Flash 就会一直向操作系统请求它，直到操作系统内存不足或发生崩溃。当然你的开发者应该适当地限制你的内存使用，但 Flash 不会强迫你这样做。

在 Flash Lite（专为手机设计的移动版本）中，主机应用程序对内存使用施加了预先配置的限制，但这可能不是您关心的。:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-15T09:57:12.847

检查您使用了多少：

trace("内存使用情况：" + (System.totalMemory/1048576) + "MB");

并注意泄漏！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-14T23:45:29.173

Iain 有关于检查使用的 totalMemory 的正确答案。

您可能可以使用分页系统。尽管从服务器加载的数据越来越多，但我认为并非所有数据都始终被使用。您可以从服务器获取数据并逐渐将数据保存在客户端计算机上的[SharedObject](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/net/SharedObject.html)中（但请注意 silesize 限制），并且您将跟踪本地可用的数据（例如从索引 0 到 900 的数据）。如果用户想查看 200 到 300 之间的数据，您将获得存储的数据（如果它当然已经存储），如果不请求数据并通知用户数据正在传输中。

以下是一些与 totalMemory 和垃圾收集器相关的方便链接：

*   [Flex 内存限制 - 如何配置](https://stackoverflow.com/questions/560510/flex-memory-limit-how-to-configure/749736#749736)
*   [在 Actionscript 3 中卸载 ByteArray](https://stackoverflow.com/questions/34/unloading-a-bytearray-in-actionscript-3)
*   [http://www.craftymind.com/2008/04/09/kick-starting-the-garbage-collector-in-actionscript-3-with-air/](http://www.craftymind.com/2008/04/09/kick-starting-the-garbage-collector-in-actionscript-3-with-air/)

但我认为更适合，因为服务器有很多数据，可能是这样的： [“Flash 播放器在 Web 场景中的内存安全限制是多少，AS 3.0 位操作有多好？”](http://www.linkedin.com/answers/technology/web-development/TCH_WDD/452057-43859701?browseCategory=)

# excel - CSV 日期格式

> ID：203807
> 
> 赞同：2
> 
> 时间：2008-10-15T05:37:38.470
> 
> 标签：excel, csv, vba

我有一个 VB 应用程序，它可以提取数据并创建 3 个 CSV 文件（a.csv、b.csv、c.csv）。然后我使用另一个 Excel 电子表格 (import.xls) 将上述 CSV 文件中的所有数据导入到此工作表中。

import.xls 文件有一个宏，可以一个一个地打开 CSV 文件并复制数据。我面临的问题是 CSV 文件中的日期存储为 mm/dd/yyyy，并按原样复制到 Excel 工作表中。但我想要 dd/mm/yyy 格式的日期。

当我手动打开任何 CSV 文件时，日期会以正确的格式 (mm/dd/yyyy) 显示。知道如何解决这个问题吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-15T05:41:09.557

当我遇到这个问题时，我通常将日期写为 yyyy-mm-dd，Excel 会明确地解释它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-15T05:42:51.767

您可以使用**格式化**VBA 功能：

```
Format(DateText, "dd/mm/yyyy") 
```

这将按照你喜欢的方式格式化它。

要获得更持久的解决方案，请尝试在 Windows 本身中更改区域设置，Excel 将其用于日期格式。

开始 -> 设置 -> 控制面板 -> 区域选项。

确保将语言设置为适当的语言，并且日期设置符合您的要求

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T06:44:16.310

首先，其他答案都很好，但还有一些您可能会觉得有帮助的信息

CSV 文件仅包含文本。也就是说，数据不是日期格式，而是文本格式。因此，当您在 Excel 中打开 CSV 文件时，Excel 默认会为您解释该数据。它不必。您可以强制将其保留为文本，或者如 Mark 所述，您可以将代码添加到您的导入宏中，为您更改它。如果您想要一个自动化的过程，那么这是最好的解决方案。只需将 VBA 中的代码添加到将所需日期格式应用于包含日期数据的列的宏中。或者，您可以在打开文件并粘贴数据后手动执行此操作，方法是自己选择列并更改格式。您可以自定义数字格式（选择自定义），然后自己编写。例如 dd/mm/yyyy。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T12:25:37.923

我有一个类似的问题并像这样解决了它，本质上它是“以上所有”选项

1.  将`format(date,'dd-mmm-yyyy')` 日期转换为 2-3-4 格式，例如 01-aug-2008，计算机绝不会将 01-aug 误认为 08-jan :-)
2.  由于在 excel 中复制它会自动将其恢复为日期/时间格式，因此请使用`cstr`1 中的函数将结果转换为字符串
3.  将复制日期的单元格格式化为文本（如果不这样做，像 excel 一样笨拙，它将再次将其转换回日期/时间
4.  将工作表另存为 csv 文件并在记事本中打开以确认它已经工作

有些人可能会说这有点矫枉过正，但最好是为了安全起见，而不是让用户在一年后打电话给我并告诉我它对日期做了一些奇怪的事情

# sql - 我将如何编写这个 3 级深度 mysql 查询？

> ID：203809
> 
> 赞同：4
> 
> 时间：2008-10-15T05:38:52.197
> 
> 标签：sql, mysql

这可能有点难以解释，但我会尝试。

我想显示类别列表（存储在 1 个表中）以及与每个类别关联的域数（存储在另一个表中）。

在这种情况下，活动扳手是每个域都有一组与之关联的记录（存储在第三个表中）。我只想显示与它们相关联的域的类别，并且域的计数应该只反映与它们相关联的记录的域（来自第三个表）。

我当前的查询

```
SELECT r.rev_id, c.cat_id, c.cat_name, count(d.dom_id) As rev_id_count FROM reviews r
INNER JOIN  domains d ON r.rev_domain_from=d.dom_id 
INNER JOIN  categories c ON d.dom_catid=c.cat_id  
WHERE rev_status = 1
GROUP BY cat_name  
ORDER BY cat_name 
```

这将选择正确的类别名称，但显示错误计数 (rev_id_count)。如果类别中有 2 个域，并且每个域有 2 条记录，则显示计数为 4，而应为 2。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T06:43:37.497

```
SELECT Categories.Name,count(DISTINCT categories.name) FROM Categories
JOIN Domains ON Categories.ID=Domains.CID
JOIN Records ON Records.DID=Domains.ID
GROUP BY Categories.Name
```

使用以下设置进行测试：

```
 CREATE TABLE Categories (Name nvarchar(50), ID int  NOT NULL IDENTITY(1,1))
CREATE TABLE Domains (Name nvarchar(50), ID int NOT NULL IDENTITY(1,1), CID int)
CREATE TABLE Records (Name nvarchar(50), ID int NOT NULL IDENTITY(1,1), DID int)

INSERT INTO Records (DID) VALUES (1)
INSERT INTO Records (DID) VALUES (1)
INSERT INTO Records (DID) VALUES (2)
INSERT INTO Records (DID) VALUES (2)
INSERT INTO Records (DID) VALUES (3)
INSERT INTO Records (DID) VALUES (3)

INSERT INTO Domains (Name,CID) VALUES ('D1',1)
INSERT INTO Domains (Name,CID) VALUES ('D2',1)
INSERT INTO Domains (Name,CID) VALUES ('D5',1)
INSERT INTO Domains (Name,CID) VALUES ('D3',2)
INSERT INTO Domains (Name,CID) VALUES ('D4',2)

INSERT INTO Categories (Name) VALUES ('1')
INSERT INTO Categories (Name) VALUES ('2')
INSERT INTO Categories (Name) VALUES ('3') 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T06:40:09.623

```
select c.name, count(distinct d.did) from domains d
  left join categories c on c.cid = d.cid
  left join records r on r.did = d.did
  group by c.name 
```

使用 2 个类别、每个类别 2 个域、每个域的随机记录数进行测试。结果集：

```
name     count
----     -----    
test     2
test2    2 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T05:43:40.940

像这样的东西？

```
SELECT c.name, count(d.id)
FROM categories c
JOIN domains d ON c.id = d.cid
JOIN records r ON r.did = d.id
GROUP BY c.name; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T06:18:42.053

首先选择具有记录的域 - 然后拉入与域匹配的类别。

所以像

```
 SELECT * FROM records 
    INNER JOIN domains on <clause> 
    INNER JOIN categories on <clause>
 WHERE <something> 
```

我不能很好地解释这一点，但是在编写 SQL 时，很容易从我们想要在 select 中查看的字段列表中查看内容，并倾向于使用它来指示我们使用表来构建数据的方式. 事实上，我们应该更多地关注数据与我们正在构建的查询的关系（通常看起来是从前到后）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-15T06:27:18.853

扩展 AquilaX 的解决方案，您只需要选择域的名称：

```
SELECT c.name, d.name, count(d.id)
  FROM categories c
    JOIN domains d ON c.id = d.cid
    JOIN records r ON r.did = d.id
GROUP BY c.name, d.name; 
```

应该显示：

```
Cat 1, Domain 1, 2
Cat 1, Domain 2, 1
Cat 2, Domain 3, 5 
```

ETC...

*（虽然没有测试）*

# c++ - C++ 头文件 - 接口和实现细节之间的分离

> ID：203823
> 
> 赞同：5
> 
> 时间：2008-10-15T05:49:23.923
> 
> 标签：c++, coding-style

我的程序中的一个类使用了一些第三方库。库对象是我班级的私人成员：

```
// My.h
    #include <3pheader.h>

    class My 
    {
    ...
    private:
       3pObject m_object;
    } 
```

这个问题 - 我的程序中使用 My 类的任何其他单元都应该配置为包含 3p 标头。移动到另一种 3p 将危及整个构建......我看到两种方法来解决这个问题 - 一种是制作 3pObject 外部并将 m_Object 转换为指针，在构造函数中初始化；其次是创建一个“接口”和“工厂”类并导出它们......

你能建议另一种方法来解决这个问题吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-15T05:57:04.190

私有实现 (PIMPL) 模式：

[http://www.codeproject.com/KB/tips/PIMPL.aspx](http://www.codeproject.com/KB/tips/PIMPL.aspx)

基本上，您定义您的类包含一个指向您转发声明的结构的指针。然后在 cpp 文件中定义结构并使用类中的构造函数和析构函数来创建/删除 PIMPL。

:)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-15T05:58:21.283

使用“pimpl”成语：

```
// header
class My
{
  class impl;
  std::auto_ptr<impl> _impl;
};

// cpp
#include <3pheader.h>
class My::impl
{
  3pObject _object;
}; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T06:20:00.773

[QT](http://trolltech.com/products)的所有内部结构都是使用私有实现类完成的。
您可以查找它以获得有关如何正确完成的良好参考。

# c# - 我可以简单地“读取”正在使用的文件吗？

> ID：203837
> 
> 赞同：14
> 
> 时间：2008-10-15T06:01:22.870
> 
> 标签：c#, file, file-io, filesystems, file-permissions

我正在尝试使用 StreamReader 读取文件，但它始终被另一个进程使用，所以我收到此错误：

> 该进程无法访问文件 '\arfjwknasgmed17\C$\FLAG CONDITION\CP-ARFJN-FLAG.XLS'，因为它正被另一个进程使用。

有没有办法可以在不复制的情况下阅读它？还是这是我唯一的选择？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-15T06:06:41.907

仅当打开文件的程序首先指定对该文件的读取共享权限时，您才能读取该文件。

如果该文件确实没有读取共享权限，那么您将无法首先复制它。

如果您指定的共享权限与已打开文件的程序的共享权限冲突，您可能无法访问该文件。例如，如果已经打开它的程序没有授予写访问权限，则您不能授予写访问权限。

如果首先打开文件的程序支持卷影复制 (VSS)，您还可以使用 VSS 来访问该文件。

有一些商业软件驱动程序允许您访问这些文件，即使它们正在使用中。您过去可以使用 St-Bernards 的 Open File Manager，也可以使用VisionWorks Solutions Inc. 的[File Access Manager (FAM)](http://www.vwsolutions.com/FAM/)。这些驱动程序通常是 OEM 用于备份软件公司以包含在他们的产品中。

VSS 通过告诉已经打开文件的程序另一个程序想要从文件中读取来工作。VSS 然后复制该文件并让您从该副本中读取。VSS 不适用于旧版应用程序。

FAM 通过指定可以访问独占打开和锁定文件的应用程序的“允许列表”，透明地适用于旧版和非旧版程序。仅允许此列表中的程序访问这些文件。当一个文件被打开时，它会进入缓存模式，这样您就可以获得文件的副本，就像文件的“备份/打开”开始时一样。此时，最初打开文件的程序会看到文件的实际状态，而允许列表中的第二个程序会看到文件的“打开/备份”发生时的文件。这确保了文件的一致性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-03T04:57:49.783

试试下面的代码。

```
FileStream fileStr = File.Open(<full file name>, FileMode.Open, FileAccess.Read, FileShare.ReadWrite);
fileStream = new StreamReader(fileStr); 
```

我已经在 Windows XP 上试过了。如果文件已经被其他进程以写入模式打开并且它没有指定共享权限，您仍然可以以读取模式打开文件。

免责声明：它有效，但是，我不确定您是否应该在生产代码中使用它。我还没有找到任何说它应该工作的正式文件。

# jquery - jQuery Validation 插件：禁用对指定提交按钮的验证

> ID：203844
> 
> 赞同：170
> 
> 时间：2008-10-15T06:14:55.760
> 
> 标签：jquery, jquery-validate

我有一个包含多个字段的表单，我正在使用 Jörn Zaeffere 出色的 jQuery Validation 插件进行验证（有些添加了用于自定义验证的方法）。您如何规避使用指定提交控件的验证（换句话说，使用某些提交输入触发验证，但不触发其他输入验证）？这类似于具有标准 ASP.NET 验证器控件的 ValidationGroups。

我的情况：

它与 ASP.NET WebForms 一起使用，但如果您愿意，可以忽略它。但是，我更多地将验证用作“建议”：换句话说，当提交表单时，验证会触发，但不是显示“必需”消息，而是显示“建议”，其中包含“你错过了以下字段....您仍然要继续吗？” 那时，在错误容器中，现在可以看到另一个提交按钮，可以按下该按钮，它将忽略验证并提交。如何绕过此按钮控件的表单 .validate() 并仍然发布？

[http://jquery.bassistance.de/validate/demo/multipart/](http://jquery.bassistance.de/validate/demo/multipart/)上的 Buy and Sell a House 示例允许这样做以便点击前面的链接，但它是通过创建自定义方法并将其添加到验证器来实现的。我宁愿不必创建自定义方法来复制验证插件中已有的功能。

以下是我现在拥有的立即适用的脚本的缩短版本：

```
var container = $("#<%= Form.ClientID %> div.validationSuggestion");

$('#<%= Form.ClientID %>').validate({          
    errorContainer: container,
    errorLabelContainer: $("ul",container),
    rules: {
        <%= YesNo.UniqueID %>: { required: true },
        <%= ShortText.UniqueID %>: { required: true } // etc.

    },
    messages: {
        <%= YesNo.UniqueID %>: 'A message.',
        <%= ShortText.UniqueID %>: 'Another message.' // etc.
    },
    highlight: function(element, errorClass) {
        $(element).addClass(errorClass);
        $(element.form).find("label[for=" + element.id + "]").addClass(errorClass);
        $(element.form).find("label[for=" + element.id + "]").removeClass("valid");
    },
    unhighlight: function(element, errorClass) {
        $(element).removeClass(errorClass);
        $(element.form).find("label[for=" + element.id + "]").removeClass(errorClass);
        $(element.form).find("label[for=" + element.id + "]").addClass("valid");
    },
    wrapper: 'li'
}); 
```

* * *

## 回答 #1

> 赞同：293
> 
> 时间：2008-10-15T08:09:22.440

您可以将 CSS 类添加`cancel`到提交按钮以禁止验证

例如

```
<input class="cancel" type="submit" value="Save" /> 
```

在此处查看此功能的 jQuery Validator 文档：[Skipping validation on submit](https://jqueryvalidation.org/reference#link-skipping-validation-on-submit)

* * *

**编辑**：

上述技术已被弃用并替换为`formnovalidate`属性。

```
<input formnovalidate="formnovalidate" type="submit" value="Save" /> 
```

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2010-05-21T04:07:35.700

其他（未记录的）方法是调用：

```
$("form").validate().cancelSubmit = true; 
```

在按钮的单击事件上（例如）。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2015-07-27T23:26:32.653

另一种（动态）方式：

```
$("form").validate().settings.ignore = "*"; 
```

要重新启用它，我们只需设置回默认值：

```
$("form").validate().settings.ignore = ":hidden"; 
```

来源：[https ://github.com/jzaefferer/jquery-validation/issues/725#issuecomment-17601443](https://github.com/jzaefferer/jquery-validation/issues/725#issuecomment-17601443)

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2015-04-13T21:09:51.200

将 formnovalidate 属性添加到输入

```
 <input type="submit" name="go" value="Submit"> 
    <input type="submit" formnovalidate name="cancel" value="Cancel"> 
```

添加 class="cancel" 现在已弃用

[请参阅此链接](http://jqueryvalidation.org/reference#skipping-validation-on-submit)上提交时跳过验证的文档

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-07-28T20:48:38.783

您可以在连接验证时使用**onsubmit:false**选项（请参阅[文档](http://docs.jquery.com/Plugins/Validation/validate#toptions)），该选项不会在提交表单时进行验证。然后在你的 asp:button 中添加一个 OnClientClick= $('#aspnetForm').valid(); 明确检查表单是否有效。

您可以将其称为选择加入模型，而不是上述的选择退出模型。

请注意，我还在使用带有 ASP.NET WebForms 的 jquery 验证。有一些问题需要解决，但是一旦你解决了这些问题，用户体验就会非常好。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-07-01T10:10:54.783

（`@lepe`'s 的扩展和+的`@redsquare`答案）`ASP.NET MVC``jquery.validate.unobtrusive.js`

* * *

[jquery 验证插件](http://jqueryvalidation.org/reference/)（不是微软不显眼的插件）允许您在提交按钮上放置一个`.cancel`类以完全绕过验证（如接受的答案所示）。

```
 To skip validation while still using a submit-button, add a class="cancel" to that input.

  <input type="submit" name="submit" value="Submit"/>
  <input type="submit" class="cancel" name="cancel" value="Cancel"/> 
```

（不要将此与[`type='reset'`](http://www.electrictoolbox.com/html-form-reset-input/)完全不同的东西混淆）

不幸的是，`jquery.validation.unobtrusive.js`验证处理（ASP.NET MVC）代码有点搞砸了[jquery.validate 插件的默认行为](http://jqueryvalidation.org/reference/)。

这就是我想出的让您按`.cancel`上图所示的提交按钮的方法。如果微软曾经“修复”过这个问题，那么你可以删除这个代码。

```
 // restore behavior of .cancel from jquery validate to allow submit button 
    // to automatically bypass all jquery validation
    $(document).on('click', 'input[type=image].cancel,input[type=submit].cancel', function (evt)
    {
        // find parent form, cancel validation and submit it
        // cancelSubmit just prevents jQuery validation from kicking in
        $(this).closest('form').data("validator").cancelSubmit = true;
        $(this).closest('form').submit();
        return false;
    }); 
```

注意：如果第一次尝试它似乎不起作用 - 确保您没有往返服务器并看到服务器生成的页面有错误。您需要通过其他方式绕过服务器端的验证 - 这只是允许在客户端提交表单而不会出错（另一种方法是向`.ignore`表单中的所有内容添加属性）。

`button`（注意：如果您使用按钮提交，您可能需要添加到选择器）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-01-18T14:16:45.703

```
$("form").validate().settings.ignore = "*"; 
```

或者

```
$("form").validate().cancelSubmit = true; 
```

但是在自定义所需的验证器中没有成功。为了动态调用提交，我使用以下代码创建了一个假的隐藏提交按钮：

```
var btn = form.children('input.cancel.fakeSubmitFormButton');
if (btn.length === 0) {
    btn = $('<input name="FakeCancelSubmitButton" class="cancel fakeSubmitFormButton hide" type="submit" formnovalidate value="FakeCancelSubmitButton" />');
    form.append(btn);
}
btn.click(); 
```

现在正确跳过验证:)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-12-24T21:02:31.237

这个问题很老，但我发现另一种解决方法是使用`$('#formId')[0].submit()`，它获取 dom 元素而不是 jQuery 对象，从而绕过任何验证钩子。此按钮提交包含输入的父表单。

```
<input type='button' value='SubmitWithoutValidation' onclick='$(this).closest('form')[0].submit()'/> 
```

另外，请确保您没有任何`input`名为“提交”的 ，否则它会覆盖名为 的函数`submit`。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-09-09T13:37:12.503

我发现最灵活的方法是使用 JQuery：

```
event.preventDefault(): 
```

例如，如果我不想提交我想重定向，我可以这样做：

```
$("#redirectButton").click(function( event ) {
    event.preventDefault();
    window.location.href='http://www.skip-submit.com';
}); 
```

或者我可以将数据发送到不同的端点（例如，如果我想更改操作）：

```
$("#saveButton").click(function( event ) {
    event.preventDefault();
    var postData = $('#myForm').serialize();
    var jqxhr = $.post('http://www.another-end-point.com', postData ,function() {
    }).done(function() {
        alert("Data sent!");
    }).fail(function(jqXHR, textStatus, errorThrown) {
        alert("Ooops, we have an error");
    }) 
```

一旦你做了'event.preventDefault();' 你绕过验证。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-01-31T07:36:14.850

我有两个用于表单提交的按钮，名为保存和退出的按钮绕过验证：

```
$('.save_exist').on('click', function (event) {
            $('#MyformID').removeData('validator');
            $('.form-control').removeClass('error');
            $('.form-control').removeClass('required');                
            $("#loanApplication").validate().cancelSubmit = true;
            $('#loanApplication').submit();
            event.preventDefault();
}); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-07-21T08:58:50.017

```
<button type="submit" formnovalidate="formnovalidate">submit</button> 
```

也在工作

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-11-01T19:35:50.587

这是最简单的版本，希望对某人有所帮助，

```
$('#cancel-button').click(function() {
    var $form = $(this).closest('form');
    $form.find('*[data-validation]').attr('data-validation', null);
    $form.get(0).submit();
}); 
```

# c++ - 替换 CDC 矢量图形的快速库

> ID：203847
> 
> 赞同：1
> 
> 时间：2008-10-15T06:15:35.260
> 
> 标签：c++, mfc, sdk, gdi, vector-graphics

我有一个成熟的 MFC C++ 应用程序，它显示在屏幕上并使用 Win32 GDI 上的 CDC 包装进行打印。虽然它多年来一直在优化，但我想用更快的东西替换它。图形包括渲染的三角形表面模型、复杂的折线和多边形以及大量文本。它需要满足以下条件；

*   显示的矢量数量可能非常大。例如，单个曲面三角形在渲染时可能会生成数字线和实心填充。目前，这些信息没有存储在任何地方，它是动态生成和绘制的。SDK 应该支持限制缓冲向量的总数，否则容易耗尽内存。

*   SDK 应该能够呈现到任何 CWnd 派生类，包括 CView 和 ScrollView 类。

*   SDK 应该支持打印到任何 Windows 打印设备，

*   SDK 应该足够低级，以使来自低级 CDC/GDI 调用的端口相对简单。

*   开源总是很好，但一次性费用高达 2000 美元，可选升级/支持也可以。每个用户的许可费用是不可接受的，

*   访问源代码将是一个很大的好处，特别是在 Windows CE / Mobile 上运行部分 SDK 的想法。

*   我目前处理自己的 3d 到 2d 视口管理。如果没有合适的低级 SDK，则更高级别的 SDK 必须能够很好地处理 3d，并在 32 位 Windows 平台上处理数百万个三角形、多边形和文本实体。

有什么建议么？在您提出的建议中列出具体的优缺点将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T07:47:41.157

我认为 DirectX 或[SDL](http://libsdl.org/)将满足您的需求。它们是为 3D 设计的，但也适用于 2D。两者都支持 Windows CE/Mobile，而 SDL 也可用于一堆非 Microsoft 操作系统。

不幸的是，库不支持与 GDI 的直接兼容性。但是您可以通过创建一个转换器类来解决这个问题，它将接受来自您的 GDI 设计的应用程序类的所有输出图形，并转换格式以适应 DirectX 或 SDL 类的需要（取决于您要使用什么）。

我个人曾经做过一次这样的转换器类。我有一个使用 SDL 为 Pocket PC 编写的游戏，我需要将它移植到 Palm 设备上。在那里我不得不使用不同的图形库（我现在不记得库的名称），但我成功地将所有 SDL 函数输出移植到其他库所需的格式。我需要更改我的应用程序以调用转换器（包装器）函数，该函数将调用转发到 Palm 或 Pocket PC 库，具体取决于它当前运行的设备。所以我认为你可以对转换 GDI -> DirectX 或 GDI -> SDL 做同样的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T11:20:06.050

我曾经为一个项目评估过 FastGraph ( [http://www.fastgraph.com](http://www.fastgraph.com) )。我喜欢在我写的小测试程序中，它非常快。由于外部原因（与我评估的库无关），我们最终没有使用它，所以我没有更多的实践经验。

# numbers - 如何通过按位运算获得整数的第 N 位？

> ID：203854
> 
> 赞同：35
> 
> 时间：2008-10-15T06:19:29.340
> 
> 标签：numbers, bit-manipulation

例子。123456，我们想要从右边数第三个（'4'）出来。

实践中的想法是分别访问每个数字（即 6 5 4 3 2 1）。

首选 C/C++/C#。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-15T06:32:27.847

更有效的实现可能是这样的：

```
char nthdigit(int x, int n)
{
    while (n--) {
        x /= 10;
    }
    return (x % 10) + '0';
} 
```

如果您只需要其中一个，这可以节省将所有数字转换为字符串格式的工作。而且，您不必为转换后的字符串分配空间。

如果速度是一个问题，您可以预先计算一个 10 的幂数组并使用 n 来索引该数组：

```
char nthdigit(int x, int n)
{
    static int powersof10[] = {1, 10, 100, 1000, ...};
    return ((x / powersof10[n]) % 10) + '0';
} 
```

正如其他人所提到的，这与您将要进行以 10 为底的按位运算一样接近。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-04-18T23:39:41.510

只是花时间根据这里的答案写这篇文章，所以我想我会分享。

这是基于 Brannon 的回答，但可以让您一次获得多个数字。在我的情况下，我使用它从保存在 int 中的日期和时间中提取部分，其中数字为 yyyymmddhhnnssm_s 格式。

```
public static int GetDigits(this int number, int highestDigit, int numDigits)
{
    return (number / (int)Math.Pow(10, highestDigit - numDigits)) % (int)Math.Pow(10, numDigits);
} 
```

我做了一个扩展，你可能不想这样做，但这里是示例用法：

```
int i = 20010607;
string year = i.GetDigits(8,4).ToString();
string month = i.GetDigits(4,2).ToString();
string day = i.GetDigits(2,2).ToString(); 
```

结果：

年 = 2001

月 = 6

天 = 7

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-15T06:37:13.547

使用以 10 为底的数学：

```
class Program
{
    static void Main(string[] args)
    {
        int x = 123456;

        for (int i = 1; i <= 6; i++)
        {
            Console.WriteLine(GetDigit(x, i));
        }
    }

    static int GetDigit(int number, int digit)
    {
        return (number / (int)Math.Pow(10, digit - 1)) % 10;
    }
} 
```

产生：

```
6
5
4
3
2
1 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-15T06:30:22.157

它不能（容易）与按位运算一起工作的原因是十进制系统的基数（10）不是二进制系统的基数（2）的幂。

如果您以 8 为基数进行编码，您将拥有`pow(2, 3) == 8`, 并且可以将每个八进制数字提取为三个位的块。

因此，您确实必须转换为 base 10，这通常通过转换为字符串来完成（使用 toString (Java) 或 sprintf (C)，正如其他人在回复中所显示的那样）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-15T08:22:38.577

这适用于高达 451069 的无符号整数，如下[所述](http://www.cs.uiowa.edu/~jones/bcd/divide.html)：

```
def hundreds_digit(u): return mod10(div100(u))

def div100(u): return div10(div10(u))
def mod10(u):  return u - mul10(div10(u))
def mul10(u):  return ((u << 2) + u) << 1

def div10(u):
    Q = ((u >> 1) + u) >> 1  # Q = u*0.11
    Q = ((Q >> 4) + Q)       # Q = u*0.110011
    Q = ((Q >> 8) + Q) >> 3  # Q = u*0.00011001100110011
    return Q

# Alternatively:
#   def div100(u): return (u * 0xa3d7) >> 22
# though that'd only work for 16-bit u values.
# Or you could construct shifts and adds along the lines of div10(),
# but I didn't go to the trouble. 
```

测试一下：

```
>>> hundreds_digit(123456)
4
>>> hundreds_digit(123956)
9 
```

不过，如果它更快，我会感到惊讶。也许你应该重新考虑你的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-11-02T05:09:37.900

**值 = (数字 % (10^position)) / 10^(position - 1)**

例子：

数字 = 23846

位置 = 1 -> 值 = 6

位置 = 2 -> 值 = 4

位置 = 3 -> 值 = 8

**这是一个简单的 Objective-C 实用程序方法来执行此操作：**

```
+ (int)digitAtPosition:(int)pos of:(int)number {

    return (number % ((int)pow(10, pos))) / (int)pow(10, pos - 1);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-15T08:00:19.103

您可以尝试按位左移（对于 N-1），然后读取 [0] 处的数字，因为这可能是一种汇编方法。

123456 -> 456 -> 读取第一个数字

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-07-08T09:11:52.257

以下代码将给出一个数字中的第 n 个数字：

```
public void getDigit(long n,int k){
    int i=0;
    long r =0;
    while(i<n){
        r=n%10;
        n=n/10;
        i++;
    }
    System.out.println( k + "th digit from right " + r);
 } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-12-04T22:13:07.080

只是为了好玩，这里是它的 C# 扩展类：

```
public static class IntExtensions
{
    /// <summary>
    /// Returns the nth digit from an int, 
    /// where 0 is the least significant digit 
    /// and n is the most significant digit.
    /// </summary>
    public static int GetDigit(this int number, int digit)
    {
        for (int i = 0; i < digit; i++)
        {
            number /= 10;
        }
        return number % 10;
    }
} 
```

用法：

```
int myNumber = 12345;
int five = myNumber.GetDigit(0);
int four = myNumber.GetDigit(1);
int three = myNumber.GetDigit(2);
int two = myNumber.GetDigit(3);
int one = myNumber.GetDigit(4);
int zero = myNumber.GetDigit(5); 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2018-03-04T14:59:41.377

两位数 d1 和 d2 将被传递。程序必须打印第 n 个数字是只有数字与 d1 和 d2 组成的数字系统 输入格式 第一行包含 d1 第二行包含 d2 第三行包含 n d1 不等于 d2

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2016-06-11T17:21:49.707

```
int returndigit(int n,int d)
{
    d=d-1;
    while(d--)
    {
        n/=10;
    }
    return (n%10);
} 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-10-15T06:24:42.043

在 C 中，您可以执行以下操作，其中 n=0 表示最右边的数字

```
char nthDigitFromRight(int x,int n)
{
    char str[20];
    sprintf(str,"%020d",x);
    return(str[19 - x]);
} 
```

如果您希望最右边的数字为 n=1，请将 [19-x] 更改为 [20-x]。

# python - 格式化纯文本时，如何让 python-markdown 额外“urlify”链接？

> ID：203859
> 
> 赞同：5
> 
> 时间：2008-10-15T06:22:22.203
> 
> 标签：python, django, markdown

Markdown 是一个很好的工具，可以将纯文本格式化为漂亮的 html，但它不会自动将纯文本链接转换为 URL。像这个：

[http://www.google.com/](http://www.google.com/)

格式化文本块时，如何获取降价以向 URL 添加标签？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-11-03T05:36:24.327

你可以写一个markdown的扩展。将此代码另存为 mdx_autolink.py

```
import markdown
from markdown.inlinepatterns import Pattern

EXTRA_AUTOLINK_RE = r'(?<!"|>)((https?://|www)[-\w./#?%=&]+)'

class AutoLinkPattern(Pattern):

    def handleMatch(self, m):
        el = markdown.etree.Element('a')
        if m.group(2).startswith('http'):
            href = m.group(2)
        else:
            href = 'http://%s' % m.group(2)
        el.set('href', href)
        el.text = m.group(2)
        return el

class AutoLinkExtension(markdown.Extension):
    """
    There's already an inline pattern called autolink which handles 
    <http://www.google.com> type links. So lets call this extra_autolink 
    """

    def extendMarkdown(self, md, md_globals):
        md.inlinePatterns.add('extra_autolink', 
            AutoLinkPattern(EXTRA_AUTOLINK_RE, self), '<automail')

def makeExtension(configs=[]):
    return AutoLinkExtension(configs=configs) 
```

然后在您的模板中使用它，如下所示：

```
{% load markdown %}

(( content|markdown:'autolink')) 
```

更新：

我发现这个解决方案有一个问题：当使用 markdown 的标准链接语法并且显示的部分与正则表达式匹配时，例如：

```
[www.google.com](http://www.yahoo.co.uk) 
```

奇怪地变成： [www.google.com](http://www.google.com)

但是谁愿意这样做呢？！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-18T23:35:33.173

最佳情况下，编辑降价并在 URL 周围放置 < >。这将使链接可点击。唯一的问题是它需要教育您的用户或编写降价的人。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-15T07:55:15.090

在 python-markdown2 中有一个额外的：

[http://code.google.com/p/python-markdown2/wiki/LinkPatterns](http://code.google.com/p/python-markdown2/wiki/LinkPatterns)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-15T06:28:50.507

这不是 Markdown 的一个特性——你应该做的是对文本运行一个后处理器来寻找一个类似 URL 的模式。[Google 应用引擎示例代码](http://google-app-engine-samples.googlecode.com/svn/trunk/cccwiki/wiki.py)中有一个很好的示例——请参阅`AutoLink`转换。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-15T21:05:13.577

我使用的是[Django 框架](http://www.djangoproject.com/)，它有一个名为 urlize 的过滤器，它完全符合我的要求。但是，它只适用于纯文本，所以我无法通过 markdown 的输出。我按照[本指南](https://docs.djangoproject.com/en/dev/howto/custom-template-tags/)创建了一个名为 urlify2 的自定义过滤器，它适用于 html，并通过此过滤器传递文本：

```
<div class="news_post">
  {% autoescape off %}
    {{ post.content|markdown|urlify2}}
  {% endautoescape %}
</div> 
```

urlify2.py 过滤器：

```
from django import template
import re

register = template.Library()

urlfinder = re.compile("([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}|((news|telnet|nttp|file|http|ftp|https)://)|(www|ftp)[-A-Za-z0-9]*\\.)[-A-Za-z0-9\\.]+):[0-9]*)?/[-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]*[^]'\\.}>\\),\\\"]")

@register.filter("urlify2")
def urlify2(value):
    return urlfinder.sub(r'<a href="\1">\1</a>', value) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-06T07:42:34.763

我无法编译 superjoe30 的正则表达式，所以我调整了他的解决方案，将纯 URL（在 Markdown 文本中）转换为与 Markdown 兼容。

修改后的过滤器：

```
urlfinder = re.compile('^(http:\/\/\S+)')
urlfinder2 = re.compile('\s(http:\/\/\S+)')
@register.filter('urlify_markdown')
def urlify_markdown(value):
    value = urlfinder.sub(r'<\1>', value)
    return urlfinder2.sub(r' <\1>', value) 
```

在模板内：

```
<div>
    {{ content|urlify_markdown|markdown}}
</div> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-02-06T04:02:46.747

我知道这个问题已经有将近十年的历史了，但是 markdown-urlize 涵盖了我能想到的所有可能的用例，包括在 url 之前不需要 http(s)://，将括号留在 中`(google.com)`，从 中删除尖括号`<google.com>`，忽略 url在代码块中，还有更多我没有想到的：

[https://github.com/r0wb0t/markdown-urlize](https://github.com/r0wb0t/markdown-urlize)

没有 pip 安装，但你可以得到这个：

[https://raw.githubusercontent.com/r0wb0t/markdown-urlize/master/mdx_urlize.py](https://raw.githubusercontent.com/r0wb0t/markdown-urlize/master/mdx_urlize.py)

然后将上述文件放在python路径（第一个选项）或不（第二个选项）上，然后使用以下之一：

```
markdown.markdown(text, extensions=['urlize'], safe_mode=True)
markdown.markdown(text, extensions=['path.to.mdx_urlize'], safe_mode=True) 
```

# c# - 缺少公开可见类型或成员的 XML 注释

> ID：203863
> 
> 赞同：426
> 
> 时间：2008-10-15T06:24:10.687
> 
> 标签：c#, visual-studio

我收到此警告：“缺少公开可见类型或成员的 XML 注释”。

如何解决这个问题？

* * *

## 回答 #1

> 赞同：727
> 
> 时间：2008-10-15T06:30:20.393

5个选项：

*   填写文档注释（很好，但很耗时）
*   关闭评论生成（在项目属性中）
*   禁用项目属性中的警告（在“项目属性”中转到项目属性-> 构建>“错误和警告”（部分），抑制警告（文本框），添加 1591（逗号分隔列表））。默认情况下它会更改活动配置，考虑将配置更改为全部。
*   用于`#pragma warning disable 1591`仅对某些代码位（以及`#pragma warning restore 1591`之后）禁用警告
*   忽略警告（坏主意 - 你会错过新的“真实”警告）

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2008-10-15T06:31:24.650

当然，将 XML 注释添加到公开可见的类型和成员 :)

```
///<Summary>
/// Gets the answer
///</Summary>
public int MyMethod()
{
   return 42;
} 
```

您需要`<summary>`对所有成员进行这些类型的评论 - 这些也会显示在智能感知弹出菜单中。

您收到此警告的**原因**是您已将项目设置为输出文档 xml 文件（在项目设置中）。这对于类库（.dll 程序集）很有用，这意味着您的 .dll 用户可以在 Visual Studio 中获取您的 API 的智能感知文档。

我建议您为自己获取一份[GhostDoc](http://www.roland-weigelt.de/ghostdoc/) Visual Studio 插件的副本。使记录变得更加容易。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2012-02-26T08:30:51.703

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2017-12-22T16:59:47.527

还有另一种方法可以抑制这些消息，而无需任何代码更改或编译指示块。使用 Visual Studio - 转到项目属性 > 构建 > 错误和警告 > 抑制警告 - 将 1591 附加到警告代码列表。

[![在此处输入图像描述](https://i.stack.imgur.com/LaGvl.png)](https://i.stack.imgur.com/LaGvl.png)

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2008-10-15T06:29:17.603

插入 XML 注释。;-)

```
/// <summary>
/// Describe your member here.
/// </summary>
public string Something
{
    get;
    set;
} 
```

乍一看，这可能看起来像是一个笑话，但*实际上它可能*很有用。对我来说，即使是私有方法，考虑什么方法也是有帮助的（当然，除非真的很微不足道）。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2017-02-02T09:40:38.883

这是因为在您的项目属性中指定了 XML 文档文件，并且您的方法/类是公开的并且缺少文档。
您可以：

1.  禁用 XML 文档：

    > 右键单击您的项目 -> 属性 -> '构建' 选项卡 -> 取消选中 XML 文档文件。

2.  坐下来自己写文档！

XML 文档的摘要如下所示：

```
/// <summary>
/// Description of the class/method/variable
/// </summary>
..declaration goes here.. 
```

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2020-07-17T07:13:59.770

抑制警告的一个非常简单的方法是在`.csproj`文件中添加一个属性：

```
<Project>
    <PropertyGroup>
        ...     
        <!--disable missing comment warning-->
        <NoWarn>$(NoWarn);1591</NoWarn>
    </PropertyGroup>
... 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2015-12-30T12:35:14.860

我知道这是一个非常老的线程，但它是谷歌的第一个响应，所以我想我会添加一些信息：

只有在“项目属性”->“构建”下的警告级别设置为 4 时才会发生这种行为. 除非您真的需要那么多信息，否则您可以将其设置为 3，您将摆脱这些警告。当然，更改警告级别不仅仅影响评论，因此如果您不确定会丢失什么，请参阅文档：
[https ://msdn.microsoft.com/en-us/library/thxezb7y.aspx](https://msdn.microsoft.com/en-us/library/thxezb7y.aspx)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2012-08-30T16:19:08.467

我想在此处列出的答案中添加一些内容：

正如 Isak 所指出的，XML 文档对类库很有用，因为它为 Visual Studio 中的任何使用者提供智能感知。因此，一个简单而正确的解决方案是简单地关闭任何顶级项目（如 UI 等）的文档，这不会在其自己的项目之外实现。

此外，我想指出，该警告仅针对**公开可见**的成员。因此，如果您将类库设置为仅公开它需要的内容，则无需文档`private`和`internal`成员即可。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2015-09-09T08:12:26.333

在您的解决方案中，一旦您选中生成 XML 文档文件的选项，它就会开始检查您的公共成员是否拥有 XMLDoc，如果没有，您将收到每个元素的警告。如果您真的不想发布您的 DLL，并且您不需要文档，请转到您的解决方案，构建部分并将其关闭，否则如果您需要它，请填写它们，如果有不重要的属性和字段，只需使用预编译器指令超越它们， `#pragma warning disable 1591` 您还可以恢复警告： `#pragma warning restore 1591`

杂注用法：代码中的任何位置在您收到编译器警告的位置之前...（对于文件，将其放在标头中，并且您不需要再次启用它，对于单个类环绕类，或对于方法环绕一个方法，或者......你不需要包装它，你可以调用它并随便恢复它（从文件开头开始，在方法内结束）），编写以下代码：

`#pragma warning disable 1591` 如果您需要恢复它，请使用： `#pragma warning restore 1591`

这里有一个例子：

```
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using MongoDB.Bson;
using MongoDB.Bson.Serialization.Attributes;
using RealEstate.Entity.Models.Base;

namespace RealEstate.Models.Base
{
    public class CityVM
    {

#pragma warning disable 1591

        [Required]
        public string Id { get; set; }

        [Required]
        public string Name { get; set; }

        public List<LanguageBasedName> LanguageBasedNames { get; set; }

        [Required]
        public string CountryId { get; set; }

#pragma warning restore 1591

        /// <summary>
        /// Some countries do not have neither a State, nor a Province
        /// </summary>
        public string StateOrProvinceId { get; set; }
    }
} 
```

**请注意**，pragma 指令从行首开始

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-05-10T17:53:38.797

**文件**>**编辑**>**查看项目**（单击）

下拉弓的底部（单击**Open/Current work** > **Properties**），在“Output”下的“Build”处打开项目属性页面。“取消选中” **XML 文档**复选框。

重建并且没有警告。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-02-21T07:51:07.597

当您使用 VisualStudio 进行构建时，Jon Skeet 的回答非常有用。但是，如果您通过命令行构建 sln（在我的情况下是通过 Ant），那么您可能会发现 msbuild 忽略了 sln 抑制请求。

将此添加到 msbuild 命令行为我解决了这个问题：

```
/p:NoWarn=1591 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-10-13T14:59:59.970

将警告级别设置为 2 会禁止显示此消息。不知道这是否是最好的解决方案，因为它还会抑制有用的警告。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-02-25T07:49:39.837

```
#pragma warning disable 1591
#pragma warning disable 1591
#pragma warning disable 1572
#pragma warning disable 1571
#pragma warning disable 1573
#pragma warning disable 1587
#pragma warning disable 1570 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2017-06-01T10:56:27.703

您需要为显示警告的成员添加 /// 注释。

见下面的代码

```
public EventLogger()
{
    LogFile = string.Format("{0}{1}", LogFilePath, FileName);
} 
```

它为公开可见的类型或成员“.EventLogger()”显示警告缺少 XML 注释

我为该成员添加了评论，警告消失了。

```
///<Summary>
/// To write a log <Anycomment as per your code>
///</Summary>
public EventLogger()
{
    LogFile = string.Format("{0}{1}", LogFilePath, FileName);
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-08-25T17:29:11.203

在这里晚了，但是这个线程中的许多解决方案都专注于完全在项目或类中删除警告。

如果您想保留合法警告但删除一些警告 - 例如，当您使用 swagger 公开 API 时 WebApi 控制器上的 cancelToken （api 用户不需要这个 - 它由 DI 提供）。

丑陋而明显，但至少在这种情况下，取消令牌是最后一个参数。

```
 /// <summary>
    /// Creates a Service
    /// </summary>
    /// <param name="service">The Service Definition</param> (**note no cancellation token param**)
    /// <returns>A newly created item</returns>
    /// <response code="201">Returns the newly created service</response>
    /// <response code="400">If there are validation errors with the submitted json body</response>
    /// <response code="409">Conflict. The service already exists</response>
    /// <response code="500">Because life is never perfect</response>
    [ProducesResponseType(typeof(Service), 201)]
    [ProducesResponseType(400)]
    [ProducesResponseType(409)]
    [ProducesResponseType(500)]
    [HttpPost]
    public async Task<ActionResult> ServiceCreate([FromBody] ServicePostRequest service,
#pragma warning disable 1573  
        CancellationToken cancellationToken = default) //**note: no warning**
#pragma warning restore 1573
    { 
```

* * *

## 回答 #17

> 赞同：-6
> 
> 时间：2013-11-27T20:04:23.877

将属性附加到方法后，我收到了该消息

```
[webMethod]
public void DoSomething()
{
} 
```

但正确的方法是这样的：

```
[webMethod()] // Note the Parentheses 
public void DoSomething()
{
} 
```

# visual-studio - Visual Studio 中的国际化

> ID：203886
> 
> 赞同：4
> 
> 时间：2008-10-15T06:40:03.650
> 
> 标签：visual-studio, internationalization

我对 Visual Studio 还很陌生，想知道如何在我开始的新项目中最好地计划翻译。我需要提供英语、德语和法语。

我过去经常使用 Eclipse，我刚刚开发了一个新应用程序，当它完成后，我可以启动一个向导将字符串外部化到资源文件中。这些字符串将提供给某人进行翻译。

你对 VS 的体验如何？（我目前正在使用 VS2005 Express）您对计划翻译最好的建议是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T06:43:01.850

前往[微软的 I18n](http://msdn.microsoft.com/de-ch/goglobal/default(en-us).aspx)页面

[msdn](http://msdn.microsoft.com/de-ch/goglobal/bb688157(en-us).aspx)上有一篇不错的文章，介绍了 Microsoft 世界中 i18n 的更一般方面。

Visual Studio 特别是：

*   MSDN VS国际化[登陆页面](http://msdn.microsoft.com/en-us/library/1021kkz0.aspx)（**你最好的选择**）
*   而[这篇](http://msdn.microsoft.com/en-us/library/h6270d0z.aspx)msdn 文章在技术层面上处理它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T20:52:09.530

这取决于您使用的技术：Win32/MFC、.NET、...

对于 MFC 应用程序，我的这篇[CodeProject 文章](http://www.codeproject.com/KB/string/stringtable.aspx)可能有助于从资源（字符串表）中检索字符串。[这个](http://www.codeproject.com/KB/locale/LanguageMenu.aspx)可以帮助您在应用程序启动时加载所需的翻译（包括其他好东西，例如语言菜单）。

关于翻译和翻译管理，[appTranslator](http://www.apptranslator.com)将使您的生活更轻松。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T07:00:02.220

我可以彻底推荐阅读Guy Smith-Ferrier 的[.Net Internationalization](http://www.amazon.co.uk/NET-Internationalization-Developers-Guide-Building/dp/0321341384/ref=sr_1_1?ie=UTF8&s=books&qid=1224053397&sr=8-1)。

它详细介绍了应用程序全球化、国际化和本地化选项（包括优缺点和优秀示例），以及我没有考虑过的主题，例如本地化部署（即 ClickOnce 和设置项目）

我所拥有的这本书的版本是针对 VS2005 / .Net2.0 的，虽然它主要侧重于 Windows 窗体应用程序，但包括了对 ASP.Net 的考虑

![替代文字](https://i.stack.imgur.com/LfUPj.jpg)

# c# - 在 C# 中创建正弦波或方波

> ID：203890
> 
> 赞同：32
> 
> 时间：2008-10-15T06:43:00.367
> 
> 标签：c#, audio, signal-processing

如何生成给定频率的音频正弦波或方波？

我希望这样做来校准设备，那么这些波有多精确？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2013-11-04T16:53:21.250

这可以让您给出频率、持续时间和幅度，并且它是 100% 的 .NET CLR 代码。没有外部DLL。它通过创建 WAV 格式来工作`MemoryStream`，这就像只在内存中创建文件，而不将其存储到磁盘。然后它`MemoryStream`与`System.Media.SoundPlayer`.

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Windows.Forms;

public static void PlayBeep(UInt16 frequency, int msDuration, UInt16 volume = 16383)
{
    var mStrm = new MemoryStream();
    BinaryWriter writer = new BinaryWriter(mStrm);

    const double TAU = 2 * Math.PI;
    int formatChunkSize = 16;
    int headerSize = 8;
    short formatType = 1;
    short tracks = 1;
    int samplesPerSecond = 44100;
    short bitsPerSample = 16;
    short frameSize = (short)(tracks * ((bitsPerSample + 7) / 8));
    int bytesPerSecond = samplesPerSecond * frameSize;
    int waveSize = 4;
    int samples = (int)((decimal)samplesPerSecond * msDuration / 1000);
    int dataChunkSize = samples * frameSize;
    int fileSize = waveSize + headerSize + formatChunkSize + headerSize + dataChunkSize;
    // var encoding = new System.Text.UTF8Encoding();
    writer.Write(0x46464952); // = encoding.GetBytes("RIFF")
    writer.Write(fileSize);
    writer.Write(0x45564157); // = encoding.GetBytes("WAVE")
    writer.Write(0x20746D66); // = encoding.GetBytes("fmt ")
    writer.Write(formatChunkSize);
    writer.Write(formatType);
    writer.Write(tracks);
    writer.Write(samplesPerSecond);
    writer.Write(bytesPerSecond);
    writer.Write(frameSize);
    writer.Write(bitsPerSample);
    writer.Write(0x61746164); // = encoding.GetBytes("data")
    writer.Write(dataChunkSize);
    {
        double theta = frequency * TAU / (double)samplesPerSecond;
        // 'volume' is UInt16 with range 0 thru Uint16.MaxValue ( = 65 535)
        // we need 'amp' to have the range of 0 thru Int16.MaxValue ( = 32 767)
        double amp = volume >> 2; // so we simply set amp = volume / 2
        for (int step = 0; step < samples; step++)
        {
            short s = (short)(amp * Math.Sin(theta * (double)step));
            writer.Write(s);
        }
    }

    mStrm.Seek(0, SeekOrigin.Begin);
    new System.Media.SoundPlayer(mStrm).Play();
    writer.Close();
    mStrm.Close();
} // public static void PlayBeep(UInt16 frequency, int msDuration, UInt16 volume = 16383) 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-10-15T07:04:48.420

您可以使用[NAudio](http://codeplex.com/naudio)并创建一个派生的 WaveStream 输出正弦波或方波，您可以将其输出到声卡或写入[WAV](http://en.wikipedia.org/wiki/WAV)文件。如果您使用 32 位浮点样本，您可以直接从 sin 函数中写入值，而无需缩放，因为它已经在 -1 和 1 之间。

至于准确性，您的意思是完全正确的频率，还是完全正确的波形？没有真正的方波这样的东西，即使是正弦波也可能在其他频率上有一些非常安静的伪影。如果重要的是频率的准确性，那么您将依赖声卡中时钟的稳定性和准确性。话虽如此，我想对于大多数用途来说，准确性已经足够了。

下面是一些示例代码，它以 8 kHz 采样率和 16 位样本（即非浮点）生成 1 kHz 样本：

```
int sampleRate = 8000;
short[] buffer = new short[8000];
double amplitude = 0.25 * short.MaxValue;
double frequency = 1000;
for (int n = 0; n < buffer.Length; n++)
{
    buffer[n] = (short)(amplitude * Math.Sin((2 * Math.PI * n * frequency) / sampleRate));
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-02-01T16:13:21.577

尝试[在 C# 中创建正弦并保存到波形文件](http://alvas.net/alvas.audio,tips.aspx#tip86)

```
private void TestSine()
{
    IntPtr format;
    byte[] data;
    GetSineWave(1000, 100, 44100, -1, out format, out data);
    WaveWriter ww = new WaveWriter(File.Create(@"d:\work\sine.wav"),
        AudioCompressionManager.FormatBytes(format));
    ww.WriteData(data);
    ww.Close();
}

private void GetSineWave(double freq, int durationMs, int sampleRate, short decibel, out IntPtr format, out byte[] data)
{
    short max = dB2Short(decibel);//short.MaxValue
    double fs = sampleRate; // sample freq
    int len = sampleRate * durationMs / 1000;
    short[] data16Bit = new short[len];
    for (int i = 0; i < len; i++)
    {
        double t = (double)i / fs; // current time
        data16Bit[i] = (short)(Math.Sin(2 * Math.PI * t * freq) * max);
    }
    IntPtr format1 = AudioCompressionManager.GetPcmFormat(1, 16, (int)fs);
    byte[] data1 = new byte[data16Bit.Length * 2];
    Buffer.BlockCopy(data16Bit, 0, data1, 0, data1.Length);
    format = format1;
    data = data1;
}

private static short dB2Short(double dB)
{
    double times = Math.Pow(10, dB / 10);
    return (short)(short.MaxValue * times);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-05-17T10:39:33.887

使用*Math.NET 数值*

[https://numerics.mathdotnet.com/Generate.html](https://numerics.mathdotnet.com/Generate.html)

> **正弦**
> 
> 生成给定长度的正弦波数组。这相当于将缩放的三角正弦函数应用于幅度为 2π 的周期性锯齿。
> 
> s(x)=A⋅sin(2πνx+θ)
> 
> Generate.Sinusoidal(length,samplingRate,frequency,amplitude,mean,phase,delay)

例如

```
 Generate.Sinusoidal(15, 1000.0, 100.0, 10.0); 
```

返回数组 { 0, 5.9, 9.5, 9.5, 5.9, 0, -5.9, ... }

还有

```
Generate.Square(... 
```

这将

> 创建一个周期性的方波...

不能说精度。

# c++ - 使用编译器/链接器进行 C++ 代码清理

> ID：203899
> 
> 赞同：5
> 
> 时间：2008-10-15T06:52:37.477
> 
> 标签：c++, visual-studio-2008, maintenance

我将 VS2008 用于 C++ 项目。代码很老，经过很多人的手。有几个不再使用的类层次结构、函数、枚举等。

有没有办法让编译器/链接器列出已声明或定义但未在任何地方引用的标识符？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-15T07:20:09.823

VS 将警告在函数中声明但未使用的标识符，您可能需要移至警告级别 4，但对于全局变量，以及寻找许多其他潜在问题，您最好尝试[lint](http://www.gimpel.com/)或[visual lint](http://www.riverblade.co.uk/products/visual_lint/index.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-15T11:09:46.927

PC-Lint“整个项目”分析（同时分析多个文件）可以做到这一点。如果您需要帮助设置它，请随时与我联系。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T07:13:19.993

不确定 Visual C++，但 g++ 会警告未使用的变量。您可以尝试通过 g++ 传递您的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T08:54:20.133

[http://en.wikipedia.org/wiki/Lint_programming_tool](http://en.wikipedia.org/wiki/Lint_programming_tool) [http://www.gimpel.com/](http://www.gimpel.com/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-15T12:52:51.540

[PC-Lint](http://www.gimpel.com/)将执行此操作。但是，不要一无所有地运行它。我做了并且有 120 万个错误——相当于每行约 5 个。这被大大推高了，因为几乎每个 UI 类都引用了 resource.h 和 resource.h 列出了很多 #defines，lint 说“用 const int 替换定义”。要获得一个好的起点，请阅读[Power of 2 博客上的这篇文章](http://powerof2games.com/node/27)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-15T08:47:16.933

对于最明显的未使用声明，高警告级别会解决这个问题。

关于未使用代码的识别，deadstripper（不是深夜犯罪剧的中心，而是在链接期间剔除未使用代码的机制）只会让您部分了解 - 您真正想要的是代码覆盖率分析工具。存在很多，不幸的是它们都相当昂贵。

具有良好上下文标记和调用图机制的强大编辑器也将有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-15T14:14:03.373

参考 Graham 的帖子：FWIW 我从来没有真正看到使用 resource.h 文件的“用 const int 替换定义”消息——尽管其他一些（以前在同一位置定义）可能会很痛苦。

无论如何，如果某个特定的 PC-Lint 消息妨碍您发现您正在寻找的内容，那么在您的 options.lnt 文件中使用 -e 将其关闭是一件简单的事情。还需要注意 -w 选项，它允许您全局设置警告级别（例如 -w0 +e766 关闭除消息 766 之外的所有内容）。

对于未使用的符号和声明，您需要注意诸如 755（信息——未引用全局宏）、758（信息——未引用全局枚举）、769（信息——未引用全局枚举常量）之类的消息和 1714（信息——未引用成员函数）。请记住，这些在单个文件分析中被抑制，因此您需要运行整个项目分析才能看到它们。

# xml - 用于打印 xml 块的 XPath 条件

> ID：203911
> 
> 赞同：3
> 
> 时间：2008-10-15T06:59:41.067
> 
> 标签：xml, xpath

我正在使用 Java API 和 XPath 来解析我的 XML。我有这样的 XML：

```
<animals>
  <dog>
    <looks>dangerous </looks> 
     <bites> hard </bites>
     <growls> yes </growls>
  </dog>
  <cat>nothing special</cat>
</animals> 
```

我想打印一个 XPath 条件

```
<dog>
  <looks>dangerous </looks> 
  <bites> hard </bites>
  <growls> yes </growls>
</dog> 
```

但我现在不能。如果我使用`/animal/dog/text()`它会给`dangerous`. 但我想它是单独使用打印文本的。有没有办法使用 XPath 条件来获取 XML 块？

**编辑**：

非常感谢您的回复。感谢您花在这方面的时间。有没有办法在不打印内部文本的情况下在 Java 中做到这一点？

这是我的 XPath 条件所在：

```
public static final String XPATH_INPUT_DATA="//text()"; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T07:21:41.380

如果您使用 /animals/dog，您将获得带有所有子节点的“dog”节点。打印该节点的内部 xml 应该可以满足您的需求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T12:30:46.610

使用命令行工具[xpath](http://www.xml.com/pub/a/2002/04/17/perl-xml.html)演示 rslite 的方法（用 Perl 编写，但它是标准 Xpath，它应该适用于任何地方）：

```
% xpath -e /animals/dog animals.xml 
Found 1 nodes in animals.xml:
-- NODE --
<dog>
   <looks>dangerous </looks> 
   <bites> hard </bites>
   <growls> yes </growls>
</dog> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T13:12:20.017

XPath 所做的只是选择一个节点。//text() 测试只选择文档中的所有文本节点。文档中的元素仅作为元素节点存在，而不是您似乎暗示的文本块。如果要将这些元素转换为文本，则需要在 Java 级别进行此转换（通过打印内部文本）。

# python - python是否支持多处理器/多核编程？

> ID：203912
> 
> 赞同：70
> 
> 时间：2008-10-15T06:59:50.787
> 
> 标签：python, multicore

多处理器编程和多核编程有什么区别？最好在 python 中展示如何编写用于多道程序和多核编程的小程序的示例

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-10-15T09:24:52.147

没有“多处理器”或“多核”编程之类的东西。*作为应用程序程序员，“多处理器”和“多核”计算机*之间的区别可能与您无关；它与内核如何共享内存访问的微妙之处有关。

为了利用多核（或多处理器）计算机，您需要一个以可以并行运行的方式编写的程序，以及一个允许程序在多个核上实际并行执行的运行时（以及操作系统，尽管您可以在 PC 上运行的任何操作系统都可以执行此操作）。这实际上是*并行*编程，尽管并行编程有不同的方法。与 Python 相关的是多处理和多线程。

在 C、C++、Java 和 C# 等语言中，您可以通过执行多个线程来编写并行程序。CPython 和 PyPy 运行时中的全局解释器锁排除了这个选项；但仅适用于那些运行时。（在我个人看来，多线程既[危险又棘手](http://www.softpanorama.org/People/Ousterhout/Threads/index.shtml)，Python 鼓励您不要将其视为获得性能优势的一种方式，这通常是一件好事。）

如果你想用 Python 编写一个可以在多核上运行的并行程序，你有几个不同的选择：

*   使用该模块编写一个多线程程序[`threading`](http://www.python.org/doc/2.5.2/lib/module-threading.html)并在 IronPython 或 Jython 运行时中运行它。
*   使用该[`processing`](http://pypi.python.org/pypi/processing)模块（现在作为[`multiprocessing`](https://docs.python.org/2/library/multiprocessing.html)模块包含在 Python 2.6 中）一次在多个进程中运行您的代码。
*   使用该[`subprocess`](http://www.python.org/doc/2.5.2/lib/module-subprocess.html)模块运行多个 python 解释器并在它们之间进行通信。
*   使用[Twisted](http://twistedmatrix.com/)和[安瓿](https://launchpad.net/ampoule/)。这不仅具有跨不同进程运行代码的优势，而且（如果您不共享对文件等内容的访问）也可能跨不同计算机运行。

无论您选择其中哪个选项，您都需要了解如何将程序正在执行的工作拆分为有意义的块。由于我不确定您正在考虑编写什么样的程序，因此很难提供有用的示例。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-15T07:26:44.490

正如在另一篇文章中提到的那样，Python 2.6 具有[多处理](http://docs.python.org/library/multiprocessing.html)模块，它可以利用多个内核/处理器（它通过透明地启动多个进程来绕过 GIL）。它提供了一些类似于线程模块的原语。您将在文档页面中找到一些（简单）使用示例。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-15T09:58:37.243

您实际上可以编写将使用多个处理器的程序。由于 GIL 锁，您无法使用线程执行此操作，但您可以使用不同的进程执行此操作。任何一个：

*   使用[subprocess](http://www.python.org/doc/2.5.2/lib/module-subprocess.html)模块，并划分您的代码以执行每个处理器的进程
*   看看[parallelpython](http://www.parallelpython.com/content/view/17/31/)模块
*   如果您使用 python > 2.6，请查看[多进程](http://docs.python.org/dev/library/multiprocessing.html)模块。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-15T07:03:00.047

您可以阅读有关 python 中的多线程和一般线程的信息

Python 中的多线程：http: [//www.devshed.com/c/a/Python/Basic-Threading-in-Python/](http://www.devshed.com/c/a/Python/Basic-Threading-in-Python/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-15T07:07:18.290

如果我理解正确的话，Python 有一个叫做 GIL（全局解释器锁）的东西，它有效地使得在 Python 中执行多线程时无法利用多核。

参见例如 Guido van Rossum 的关于该主题的[博客条目。](http://www.artima.com/weblogs/viewpost.jsp?thread=214235)据我所知，在“主流”语言中，只有 C/C++ 和 Java 对多核有有效的支持。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-15T07:08:24.497

主要区别在于您如何组织和分发数据。多核通常在一个 cpu 的不同内核之间具有更高的带宽，并且多处理器需要更多地涉及 cpu 之间的总线。

Python 2.6 获得了多进程（进程，如程序运行）和更多用于多线程编程的同步和通信对象。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-13T13:22:51.163

如果您没有 Python 2.6（例如，如果您使用的是 Ubuntu Edgy 或 Intrepid，则没有），您可以使用[Google 代码反向移植](http://code.google.com/p/python-multiprocessing/)版本的多处理。它是 PyPI 的一部分，这意味着您可以使用 EasyInstall（它是 Ubuntu 中的 python-setuptools 包的一部分）轻松安装它。

# vba - VBA 编辑器中的宏

> ID：203918
> 
> 赞同：0
> 
> 时间：2008-10-15T07:06:18.683
> 
> 标签：vba, unicode

一直在使用 VBA 创建一个简单的程序，我可以用它来复习中文词汇。

到目前为止，我已经做了一些工作，但是在输入诸如“ā”（unicode 257）之类的宏字符时遇到了一个巨大的问题。我现在正在处理的特定应用程序涉及更改文本框表单的内容，以便在我在文本框中键入时自动替换“a”。这样的程序本身很简单——我可以让它与拼音字符“á”和“à”一起工作。

```
Select Case testchar
    Case "a"
    Mid(strclip, markloc, 1) = "ā"
End Select 
```

前一个是尝试使用 Mid 函数在用户的适当提示下将文本框字符串中的一个字符替换为拼音字符。

挂断是我无法将“ā”输入VBA！我一直在寻找互联网，但这对其他人来说似乎不是问题。当我在 VBA 编辑器中输入 alt + 0257 时，什么也没有发生。我也不能从记事本复制粘贴。我准备废弃 VBA 并用其他语言重做这个应用程序。

干杯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T07:28:52.210

您可以使用 ChrW 生成 Unicode 字符：

```
Mid(strclip, markloc, 1) = ChrW(257) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T07:25:49.017

我没有在我的机器上安装 ms-office 来试用它。
但是，您可以使用带有 Unicode 参数的 StrConv 函数（连同 LCID）将 unicode 内容放入文本框中。

请注意，VB6 样式控件不接受 unicode 值。
如果您在 VBA 编辑器中创建表单，它应该可以工作（因为它使用 Forms 2.0 库）。

# .net - 调试 .NET 安装项目

> ID：203927
> 
> 赞同：1
> 
> 时间：2008-10-15T07:11:52.493
> 
> 标签：.net, deployment, installation

如何调试 .NET 安装项目？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T13:55:04.833

尝试使用

```
Debugger.Break() 
```

# c# - C#流式套接字，如何分隔消息？

> ID：203930
> 
> 赞同：2
> 
> 时间：2008-10-15T07:14:24.050
> 
> 标签：c#, sockets

标题有点长，不过...

我一直在查看这些示例，特别是关于将消息大小写入和读取到字节流的部分
[http://doc.trolltech.com/4.4/network-fortuneclient-client-cpp.html](http://doc.trolltech.com/4.4/network-fortuneclient-client-cpp.html)
[http:// /doc.trolltech.com/4.4/network-fortuneserver-server-cpp.html](http://doc.trolltech.com/4.4/network-fortuneserver-server-cpp.html)

但我似乎无法在 C# 中弄清楚。

```
StreamWriter writer = new StreamWriter(tcpClient.GetStream());
writer.Write(data.Length + data); 
```

这根本不工作。有人可以在正确的方向上轻推我吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T07:43:36.063

通常你会先发送长度。两端应该就长度的样子达成一致——例如，您可能乐于使用固定的 4 字节长度前缀作为二进制：

```
 byte[] data = ...
  int len = data.Length;
  byte[] prefix = Bitconverter.GetBytes(len);
  stream.Write(prefix, 0, prefix.Length); // fixed 4 bytes
  stream.Write(data, 0, data.Length); 
```

显然，调用者需要做同样的事情——即读取前 4 个字节以获得长度。对于读取，接收器应注意不要读取太多数据。一种方法是使用限制流 - 例如，[此类](http://code.google.com/p/protobuf-net/source/browse/trunk/protobuf-net/SubStream.cs)可用于获取不会读取太多的 Stream。

如果您不希望总是发送 4 个字节的开销，那么可以使用一些更有趣的编码 - 例如，使用 msb 作为延续块。

对于信息，[protobuf-net](http://code.google.com/p/protobuf-net/)是围绕 Google 的“协议缓冲区”基于消息的格式设计的二进制序列化程序。它为您处理了很多细节，如果您不想花大量时间编写序列化代码，它可能会很有趣。QuickStart 项目中有套接字的示例，[例如这里](http://code.google.com/p/protobuf-net/source/browse/trunk/QuickStart/3%20Sockets.cs)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T07:18:43.820

而不是`data.Length`，尝试：

```
writer.Write(chr(data.Length) + data); 
```

这将为每个数据块添加一个字节作为其长度的前缀（最多 255 个字节长）。正如你所要求的，这只是一个轻推。:)

更新：我只记得 C# 都是 Unicode 之类的东西，所以 chr() 可能给你不止一个字节。调整以适应。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T07:36:16.687

我想这应该这样做：（我假设你的数据是一个字符串）

```
流流 = tcpClient.GetStream();
编码编码 = Encoding.GetEncoding("编码名称");

byte[] bytes = encoding.getBytes(data);

stream.Write(BitConverter.GetBytes((short)bytes.Length),0,2); // 希望数据不再是 64k
流。写入（字节，0，字节。长度）；

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T08:26:00.613

当您说“这根本不工作”时，我会特别好奇什么不工作。它们是套接字两端的 .NET 应用程序吗？如果是这样，请忽略此答案。如果不是，那么问题可能出在整数的字节顺序上吗？小端与大端的问题？这个线程在这里讨论它：

[http://bytes.com/forum/thread225649.html](http://bytes.com/forum/thread225649.html)

[http://books.google.com/books?id=2zT5b2BS1OUC&pg=PA64&lpg=PA64&dq=c%23+sockets+integers+byte+ordering&source=web&ots=_ISzZZ6HHT&sig=tUHdNT0NGv0uxusmHG9YjFw6j9k&hl=en&sa=X&oi=book_result&resnum=2&ct=result](http://books.google.com/books?id=2zT5b2BS1OUC&pg=PA64&lpg=PA64&dq=c%23+sockets+integers+byte+ordering&source=web&ots=_ISzZZ6HHT&sig=tUHdNT0NGv0uxusmHG9YjFw6j9k&hl=en&sa=X&oi=book_result&resnum=2&ct=result)

如果两端都不是 .NET，另一个问题可能是另一端需要 ANSI 字符串，而您正在发送 Unicode。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-15T08:52:56.440

如果您想保留它的纯文本性，您还可以指定特定的最大大小并通过 string.Format 填充数字。（例如，长度中只允许 4 个字符）这避免了有用数据流中的数字问题，也简化了解码。

最终的明文解决方案是在长度和数据之间放置一个特定字符，例如 -，然后一次抓取单个字符，直到遇到减号，解码检索到的字符串（当然忽略减号），然后使用它来确定剩余字符串的长度，以及只需要更改以在其间添加该字符的输出代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-02T23:13:38.953

使用 WriteLine 代替 Write，使用 ReadLine 代替 Read...

如果您正在谈论发送纯文本消息，请在消息末尾附加换行符。然后，读取字节直到遇到这个换行符并将字节转换为字符串。为方便起见，任何 System.IO.StreamReader 和 System.IO.StreamReader 在单个方法（WriterLine 或 ReadLine）中实现此行为 writer.WriteLine("Line to send"); 字符串 lineSent = reader.ReadLine();

# windows - 从 .bat 文件中安全地终止进程

> ID：203935
> 
> 赞同：1
> 
> 时间：2008-10-15T07:19:18.390
> 
> 标签：windows, batch-file, taskkill

我有一个需要自我更新的 VB6 应用程序。为此，PM 建议使用要从应用程序启动的批处理文件。批处理文件应该终止进程，从本地服务器下载新版本，覆盖旧文件并再次启动应用程序。
我的问题是我不确定 taskkill 只有在进程被杀死并且所有使用的资源都被释放后才会返回对父级的控制；特别是，我们想知道进程的 .exe 文件会发生什么。有没有保证在taskkill返回后会解锁？- 当然，理论上它不应该被任何其他进程锁定，这是我们唯一感兴趣的情况。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T07:31:29.553

如果进程被杀死，则 exe 将被释放以进行更新。作为使用 taskkill 的替代方法，您可以使用 sysinternals 中的 pskill，但 taskkill 应该可以很好地与 /IM 参数一起使用。

但是，pskill 或 taskkill 都不会在返回控制之前等待进程停止。因此，您必须监视进程以确保它们不再运行。

此外，这将是我的首选解决方案，可以通过单击一次来部署 vb6 应用程序，这将使用新版本自动更新应用程序。查看[这篇文章](http://msdn.microsoft.com/en-us/library/aa697430.aspx)了解详情。

至于进程打开的资源，有可能保持打开状态（比如sql连接），但很可能会成功关闭。您只能通过在进程上测试 taskkill 来监控发生的情况来确定。

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T07:47:50.987

我通过让应用程序本身检查更新来做到这一点。如果有，则应用程序会将它们下载到临时位置。之后，它将启动一个 (.js) 脚本并退出应用程序。该脚本将等待进程关闭（休眠），复制更新并再次启动应用程序。

这样，您在脚本中的逻辑就会少得多，并且您可以在拥有更多可用工具的环境中完成您的工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T07:28:34.690

有一个命令行参数，例如 /Shutdown，VB 程序将处理该参数。

MyApp.exe /关机

/Shutdown 参数将查找应用程序的现有运行实例（使用 FindWindow API）并向窗口发送用户消息，请求它顺利关闭。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T07:29:58.290

Taskkill 应该仅在进程终止后返回（根据下面的评论：如果需要用户输入，请使用 /F 标志强制终止程序）。

要了解有关它的更多信息，您可以使用[进程资源](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)管理器并查看进程终止的确切时间，以及是否有人仍然打开 .exe 文件（Ctrl+F 和 exe 的名称） - 但情况并非如此。

# sql-server - SSRS中文本框的最大长度是多少

> ID：203949
> 
> 赞同：1
> 
> 时间：2008-10-15T07:30:58.070
> 
> 标签：sql-server, reporting-services

我需要知道 ssrs 中文本框的最大长度。它可以容纳多少数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T07:43:03.273

最大长度为 32k。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-10-16T10:48:52.193

SSRS 2012 中文本框的最大长度为 4680 个字符。

# asp.net - 数据绑定如何与结构化软件一起使用

> ID：203956
> 
> 赞同：0
> 
> 时间：2008-10-15T07:36:43.100
> 
> 标签：asp.net, data-binding, webforms, design-patterns

我最近一直在做一些依赖于大量数据绑定的 Web 项目，并且对结果非常满意。数据绑定 Webforms 主要按照我需要的方式工作，并且我为自己节省了大量代码。

仍然感觉很奇怪的一件事是，我在整个应用程序中混合了应用程序逻辑和数据库逻辑。数据源直接查询数据库..

此外，没有办法（我能想到）可以让我对这个系统进行单元测试。通过到处都有 DA 逻辑，我无法真正摆脱数据库调用并提供假数据。（尽管我仍在学习如何在正常项目中做到这一点）。

那么，这最初是如何工作的呢？如何在不牺牲结构和可测试性的情况下使用数据绑定？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T07:45:55.873

很有可能！

[这](http://www.ddj.com/windows/200001974)是一篇关于它的文章。（但是专注于winforms）

一个[常见的陷阱](http://codebetter.com/blogs/ranjan.sakalley/archive/2006/04/16/Unit-test-for-Databinding.aspx)。

然而，这侧重于 winforms，webforms 是另一回事，而且很难正确测试。

如果你喜欢单元测试，为什么不看看[asp.net mvc](http://www.asp.net/mvc/)

# java - 如何在 Tapestry 中隐藏额外的组件跨度标签？

> ID：203968
> 
> 赞同：2
> 
> 时间：2008-10-15T07:48:52.450
> 
> 标签：java, tapestry

如果我使用 span 标签来呈现像 <span jwcid="@If" .../> 这样的组件，我的 HTML 会以一堆无用的 span 标签结束。大多数时候，没关系，但在某些情况下，它会干扰我的 CSS 或使页面无效。有没有办法告诉 Tapestry 处理标签，但不实际渲染它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-18T09:10:54.687

看看`org.apache.tapestry.renderTags` [Tapestry 配置属性](http://tapestry.apache.org/tapestry4.1/usersguide/configuration.html#Configuration%20Properties)：

> 指定某些块级组件是否默认呈现其模板标签名称。
> 
> 这目前影响 If、Else 和 For 组件。

您还可以为`renderTag`特定组件实例指定参数，请参阅[If 组件](http://tapestry.apache.org/tapestry4.1/components/general/if.html)文档。

# apache-flex - 如何在 ActionScript 3 中从一个类的实例到一个 Class 对象？

> ID：203969
> 
> 赞同：46
> 
> 时间：2008-10-15T07:51:17.670
> 
> 标签：apache-flex, flash, actionscript-3, actionscript

如何`Class`从该类的实例中获取 actionscript 类的实例？

在 Python 中，这将是`x.__class__`; 在 Java 中，`x.getClass();`.

我知道存在[某些可怕的黑客](http://actionscript.org/forums/showthread.php3?t=120135#td_post_545693)来做到这一点，但我正在寻找一种内置的语言工具，或者至少是一个建立在可靠东西上的库例程。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-10-15T08:19:41.077

您可以通过基 Object 类的“构造函数”属性来获取它。IE：

```
var myClass:Class = Object(myObj).constructor; 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-15T08:18:02.377

你有什么理由不能这样做？

```
var s:Sprite = new flash.display.Sprite();

var className:String = flash.utils.getQualifiedClassName( s );
var myClass:Class = flash.utils.getDefinitionByName( className ) as Class;

trace(className ); // flash.display::Sprite
trace(myClass); // [class Sprite]

var s2 = new myClass();
trace(s2); // [object Sprite] 
```

我不知道避免通过字符串往返的方法，但它应该工作得很好。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-02-05T20:35:47.920

公认的（也是目前最流行的答案）有一些缺陷。答案适用于这个特定的用例，但评论已将答案扩展为看似通用的解决方案。

但在某些情况下，它不是一个类型安全的解决方案，并且它不能处理所有可能的对象。不支持 XML 的想法在这里和其他地方已经得到了很好的解决，但类型安全的想法却没有。

所做的假设是它是程序员创建的类对象。这是我设置的一些测试（这是在严格模式下，但是是本地测试）。注意`int`测试结果：

```
var sprite:Sprite = new Sprite();
var xml:XML = new XML();
var testInt:int = 2;
var testClass:TestClass = new TestClass();
var testAnon:Object = {};

trace("classname 1 = " + getQualifiedClassName(sprite));
trace("myclass 1 = " + getDefinitionByName(getQualifiedClassName(sprite)));
trace("constructor a 1 = " + Object(sprite).constructor);
trace("constructor a 1 = " + (Object(sprite).constructor as Class));
trace("constructor b 1 = " + sprite["constructor"]);
trace("constructor b 1 = " + (sprite["constructor"] as Class));
trace("...");
trace("classname 2 = " + getQualifiedClassName(xml));
trace("myclass 2 = " + getDefinitionByName(getQualifiedClassName(xml)));
trace("constructor a 2 = " + Object(xml).constructor);
trace("constructor a 2 = " + (Object(xml).constructor as Class));
trace("constructor b 2 = " + xml["constructor"]);
trace("constructor b 2 = " + (xml["constructor"] as Class));
trace("...");
trace("classname 3 = " + getQualifiedClassName(testInt));
trace("myclass 3 = " + getDefinitionByName(getQualifiedClassName(testInt)));
trace("constructor a 3 = " + Object(testInt).constructor);
trace("constructor a 3 = " + (Object(testInt).constructor as Class));
trace("constructor b 3 = " + testInt["constructor"]);
trace("constructor b 3 = " + (testInt["constructor"] as Class));
trace("...");
trace("classname 4 = " + getQualifiedClassName(testClass));
trace("myclass 4 = " + getDefinitionByName(getQualifiedClassName(testClass)));
trace("constructor a 4 = " + Object(testClass).constructor);
trace("constructor a 4 = " + (Object(testClass).constructor as Class));
trace("constructor b 4 = " + testClass["constructor"]);
trace("constructor b 4 = " + (testClass["constructor"] as Class));
trace("...");
trace("classname 5 = " + getQualifiedClassName(testAnon));
trace("myclass 5 = " + getDefinitionByName(getQualifiedClassName(testAnon)));
trace("constructor a 5 = " + Object(testAnon).constructor);
trace("constructor a 5 = " + (Object(testAnon).constructor as Class));
trace("constructor b 5 = " + testAnon["constructor"]);
trace("constructor b 5 = " + (testAnon["constructor"] as Class));
trace("..."); 
```

定义`TestClass`为：

```
package
{
    public class TestClass
    {
    }
} 
```

结果：

```
classname 1 = flash.display::Sprite
myclass 1 = [class Sprite]
constructor a 1 = [class Sprite]
constructor a 1 = [class Sprite]
constructor b 1 = [class Sprite]
constructor b 1 = [class Sprite]
...
classname 2 = XML
myclass 2 = [class XML]
constructor a 2 = 
constructor a 2 = null
constructor b 2 = 
constructor b 2 = null
...
classname 3 = int
myclass 3 = [class int]
constructor a 3 = [class Number]
constructor a 3 = [class Number]
constructor b 3 = [class Number]
constructor b 3 = [class Number]
...
classname 4 = src::TestClass
myclass 4 = [class TestClass]
constructor a 4 = [class TestClass]
constructor a 4 = [class TestClass]
constructor b 4 = [class TestClass]
constructor b 4 = [class TestClass]
...
classname 5 = Object
myclass 5 = [class Object]
constructor a 5 = [class Object]
constructor a 5 = [class Object]
constructor b 5 = [class Object]
constructor b 5 = [class Object]
... 
```

除了当前的任何测试之外，还有相当充分的理由使用`getDefinitionByName`这些`constructor`方法。该`getDefinitionByName`方法允许：

*   Adobe 为（当前和未来）有问题的领域开发内部解决方案
*   您不必为将来的 Adob​​e 开发更改代码
*   您不必开发两个（或更多）单独的动态实例化方法。

现在可能会变慢，但将来 Adob​​e 方面可能会进行改进以解决速度问题。

（例如，以前`uint`for-loops 比 慢`int`很多，所以设置了很多转换代码来使用 fast `int`。这是一个相当简单的问题要解决，所以 Adob​​e 修复了它，现在有很多代码跳过了一些不必要的障碍来实现过时的目标。）

由于该`getDefinitionByName`方法在所有情况下都能正常工作，因此应使用该方法开发代码，然后努力让 Adob​​e 修复速度问题。

# orm - 需要的意见：连接或断开域模型中的实体更好吗？

> ID：203971
> 
> 赞同：1
> 
> 时间：2008-10-15T07:53:05.000
> 
> 标签：orm, domain-driven-design

我正在开始一个新项目；我希望遵循 DDD 方法。我们已经与业务部门进行了交谈，并在某些细节（互联网电视）方面获得了对该领域的一些了解。

该团队五人强大且分布广泛。我们采用了存储库模式进行数据访问。我们总体上遵循基于服务的方法；服务负责执行操作，我们将通过 REST API 公开一些操作，一些通过我们自己的客户端应用程序公开。

没有使用 ORM 经验的人（目前我也没有大量经验）希望对实体之间没有关系的实体进行建模，其理由是这迫使使用存储库的开发人员准确地知道他们的影响正在数据库上。我想指出的是，这最终会导致一组非常健谈的服务、更多需要维护和测试的代码，以及一个根本没有抓住重点的领域模型。我认为这不是一个好方法，我与之交谈过的任何人也没有。

他们对实现这种方法的渴望是存储库外观下的 Linq2SQL。这需要第二个模型，它与域模型之间的映射类/层，以及存储库中的大量重复，因为编写通用存储库似乎是不可能的（我们目前已经看到）。也无法映射利用继承的 L2S 实体（这意味着每个实体都必须具有 created-on、created-by 等属性）

**第一个问题：** 谁能给我一些关于如何改变主意的建议？我正在编写一个使用 NHibernate 的副项目，它当然很好地支持 DDD 方法，基于“给我看代码”是一个强有力的论点。

**第二个问题：** 我应该尝试在我的 NHibernate 使用我自己的时间副项目中演示什么样的事情？我是新手；他们对 NHibernate 的厌恶之一是学习曲线和对 XML 的要求；我的反驳是它是一个强大的工具，而且 Fluent NHibernate 消除了对 XML 的需求。他们还是不喜欢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T22:49:40.273

你看过 DDD 中聚合根的概念吗？基本上，您只需从存储库中请求聚合根，然后加载整个聚合。聚合具有执行所需操作所需的一切，这样可以消除您对闲聊的担忧，也可以解决您的团队对明确加载内容的担忧。

在您的辅助项目中，演示基于加载整个聚合的聚合根的存储库。这是相当直接的代码，其意图非常明确。不幸的是，您仍然必须遵循 NHibernate 学习曲线，但是如果您使用这种方法，那么“魔法”就会减少。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T09:08:32.650

因为我没有使用过休眠，所以不能给你细节。但适用于几乎所有此类情况的一般事实是：

```
“让一切尽可能简单，但不要更简单。”
   -  艾尔伯特爱因斯坦

```

所以我的意见是使用尽可能少的连接来保持系统的良好定义。并且避免尝试连接所有东西，因为它会在后面咬你（记住编程中的松散耦合原则）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T23:29:43.810

根据您的描述，我猜您正在构建的每个服务都以特定实体为中心，当您的域模型想要不同的实体时，它需要使用不同的服务。

如果是这种情况，我会建议该服务过于细化。我建议围绕需要完成的流程为您的服务构建接口，并使用这些服务实现的域模型部分。我的理解是 SOA 提倡将系统公开为一组服务，但是单个系统的组件之间的内部交互不应该是服务。

这种方法导致了一个丰富的域模型，使用聚合根作为将实体关联在一起的一种手段和存储库的基础，服务位于这种暴露粗粒度行为之上，而不是与任何单个实体的基本交互。系统内部的客户端应用程序可以提供此功能（使用相同的域模型）。

如果模型中的实体是相关的并且这些关系对系统的行为很重要，那么应该强制执行这些关系（因此系统反映了被建模的域），如果每个实体都是独立的，这将很难做到，特别是如果它们是服务。

您最终将得到一个所有实体服务都需要相互调用的系统（创建大量耦合、增加变更管理开销等），否则您将无法强制执行这些关系，这意味着稀释您的模型并可能导致不一致的行为或丢失的数据。

这将从根本上归结为高内聚和低耦合的基本原则，它们是相反的力量，有必要在解决方案中尝试平衡它们。如果您没有关系（或隐式关系），那么您会以内聚为代价获得低耦合，并且如果确实存在未表示的关系或在更高级别增加依赖关系，则可能会产生维护问题。如果你强烈地强制执行太多的关系，你最终会导致你的领域模型变成一团泥球并且变得难以管理。这方面的具体建议很困难，但通常我会从使用聚合构建模型开始，专注于聚合内部的关系并经常查看模型。

特别是在 NHibernate 上，我建议展示它提供的简洁抽象、所需代码的减少、无需更改代码的简单配置以及提供的功能数量，例如身份映射和工作单元等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T23:13:21.520

看来您的团队正在使用 ORM 只是将数据库映射到一组具体类的一种方式，以使代码更好一些。如果您想创建一个域模型而不仅仅是一个抽象的数据库模型，那么很明显您应该包含关系。如何在幕后加载数据是另一回事。

# java - 如何从 ArrayList 中删除重复的元素？

> ID：203984
> 
> 赞同：546
> 
> 时间：2008-10-15T08:05:26.113
> 
> 标签：java, list, collections, arraylist, duplicates

我有一个`ArrayList<String>`，我想从中删除重复的字符串。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1062
> 
> 时间：2008-10-15T08:11:27.693

如果您不想在 a 中重复`Collection`，您应该考虑为什么要使用`Collection`允许重复的 a。删除重复元素的最简单方法是将内容添加到 a `Set`（不允许重复），然后将`Set`后面添加到`ArrayList`：

```
Set<String> set = new HashSet<>(yourList);
yourList.clear();
yourList.addAll(set); 
```

当然，这会破坏`ArrayList`.

* * *

## 回答 #2

> 赞同：307
> 
> 时间：2008-10-15T08:18:19.550

尽管将 转换`ArrayList`为 a 可以`HashSet`有效地删除重复项，但如果您需要保留插入顺序，我宁愿建议您使用此变体

```
// list is some List of Strings
Set<String> s = new LinkedHashSet<>(list); 
```

然后，如果需要取回`List`引用，可以再次使用转换构造函数。

* * *

## 回答 #3

> 赞同：153
> 
> 时间：2014-04-20T01:23:18.067

在 Java 8 中：

```
List<String> deduped = list.stream().distinct().collect(Collectors.toList()); 
```

请注意，应遵守列表成员的[hashCode-equals合同，以使过滤正常工作。](https://stackoverflow.com/questions/2265503/why-do-i-need-to-override-the-equals-and-hashcode-methods-in-java)

* * *

## 回答 #4

> 赞同：66
> 
> 时间：2016-05-24T06:17:57.090

假设我们有一个`String`类似的列表：

```
List<String> strList = new ArrayList<>(5);
// insert up to five items to list. 
```

然后我们可以通过多种方式删除重复元素。

## 在 Java 8 之前

```
List<String> deDupStringList = new ArrayList<>(new HashSet<>(strList)); 
```

**注意：**如果我们想保持插入顺序，那么我们需要使用`LinkedHashSet`代替`HashSet`

## 使用番石榴

```
List<String> deDupStringList2 = Lists.newArrayList(Sets.newHashSet(strList)); 
```

## 使用 Java 8

```
List<String> deDupStringList3 = strList.stream().distinct().collect(Collectors.toList()); 
```

**注意：** 如果我们想在**特定的列表实现**中收集结果，例如`LinkedList`，我们可以将上面的示例修改为：

```
List<String> deDupStringList3 = strList.stream().distinct()
                 .collect(Collectors.toCollection(LinkedList::new)); 
```

我们也可以`parallelStream`在上面的代码中使用，但它可能不会带来预期的性能优势。检查此[问题](https://stackoverflow.com/questions/53645037/will-parallel-stream-work-fine-with-distinct-operation)以获取更多信息。

* * *

## 回答 #5

> 赞同：53
> 
> 时间：2008-10-15T08:13:48.343

如果您不想重复，请使用[Set](http://java.sun.com/javase/6/docs/api/java/util/Set.html)而不是`List`. 要将 a 转换`List`为 a，`Set`您可以使用以下代码：

```
// list is some List of Strings
Set<String> s = new HashSet<String>(list); 
```

如果确实有必要，您可以使用相同的结构将 a 转换`Set`回`List`.

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2016-11-04T09:47:10.770

您也可以这样做，并保持顺序：

```
// delete duplicates (if any) from 'myArrayList'
myArrayList = new ArrayList<String>(new LinkedHashSet<String>(myArrayList)); 
```

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2010-12-28T16:07:10.687

这是一种不会影响您的列表排序的方法：

```
ArrayList l1 = new ArrayList();
ArrayList l2 = new ArrayList();

Iterator iterator = l1.iterator();

while (iterator.hasNext()) {
    YourClass o = (YourClass) iterator.next();
    if(!l2.contains(o)) l2.add(o);
} 
```

l1 是原始列表，l2 是没有重复项的列表（确保 YourClass 根据您要代表相等的内容具有 equals 方法）

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2015-08-12T17:30:38.417

Java 8 流提供了一种非常简单的方法来从列表中删除重复元素。使用不同的方法。如果我们有一个城市列表，并且我们想从该列表中删除重复项，则可以在一行中完成 -

```
 List<String> cityList = new ArrayList<>();
 cityList.add("Delhi");
 cityList.add("Mumbai");
 cityList.add("Bangalore");
 cityList.add("Chennai");
 cityList.add("Kolkata");
 cityList.add("Mumbai");

 cityList = cityList.stream().distinct().collect(Collectors.toList()); 
```

[如何从数组列表中删除重复元素](http://netjs.blogspot.com/2015/08/how-to-remove-duplicate-elements-from-arraylist-java.html)

* * *

## 回答 #9

> 赞同：22
> 
> 时间：2013-10-10T20:24:46.860

这可以解决问题：

```
private List<SomeClass> clearListFromDuplicateFirstName(List<SomeClass> list1) {

     Map<String, SomeClass> cleanMap = new LinkedHashMap<String, SomeClass>();
     for (int i = 0; i < list1.size(); i++) {
         cleanMap.put(list1.get(i).getFirstName(), list1.get(i));
     }
     List<SomeClass> list = new ArrayList<SomeClass>(cleanMap.values());
     return list;
} 
```

* * *

## 回答 #10

> 赞同：21
> 
> 时间：2011-12-09T22:55:49.180

也有[`ImmutableSet`](https://google.github.io/guava/releases/snapshot/api/docs/com/google/common/collect/ImmutableSet.html)来自[Guava](https://github.com/google/guava)的选项（[这里](https://github.com/google/guava/wiki/ImmutableCollectionsExplained)是文档）：

```
ImmutableSet.copyOf(list); 
```

* * *

## 回答 #11

> 赞同：21
> 
> 时间：2013-10-17T18:38:14.440

可以在不使用**HashSet**或**另一个**arraylist 的情况下从 arraylist 中删除重复项。

试试这个代码..

```
 ArrayList<String> lst = new ArrayList<String>();
    lst.add("ABC");
    lst.add("ABC");
    lst.add("ABCD");
    lst.add("ABCD");
    lst.add("ABCE");

    System.out.println("Duplicates List "+lst);

    Object[] st = lst.toArray();
      for (Object s : st) {
        if (lst.indexOf(s) != lst.lastIndexOf(s)) {
            lst.remove(lst.lastIndexOf(s));
         }
      }

    System.out.println("Distinct List "+lst); 
```

输出是

```
Duplicates List [ABC, ABC, ABCD, ABCD, ABCE]
Distinct List [ABC, ABCD, ABCE] 
```

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2008-10-18T16:11:35.457

可能有点矫枉过正，但我​​喜欢这种孤立的问题。:)

此代码使用临时 Set（用于唯一性检查），但直接删除原始列表中的元素。由于 ArrayList 中的元素删除会导致大量的数组复制，因此避免了 remove(int) 方法。

```
public static <T> void removeDuplicates(ArrayList<T> list) {
    int size = list.size();
    int out = 0;
    {
        final Set<T> encountered = new HashSet<T>();
        for (int in = 0; in < size; in++) {
            final T t = list.get(in);
            final boolean first = encountered.add(t);
            if (first) {
                list.set(out++, t);
            }
        }
    }
    while (out < size) {
        list.remove(--size);
    }
} 
```

当我们这样做的时候，这里有一个 LinkedList 的版本（好多了！）：

```
public static <T> void removeDuplicates(LinkedList<T> list) {
    final Set<T> encountered = new HashSet<T>();
    for (Iterator<T> iter = list.iterator(); iter.hasNext(); ) {
        final T t = iter.next();
        final boolean first = encountered.add(t);
        if (!first) {
            iter.remove();
        }
    }
} 
```

使用marker界面呈现List的统一解决方案：

```
public static <T> void removeDuplicates(List<T> list) {
    if (list instanceof RandomAccess) {
        // use first version here
    } else {
        // use other version here
    }
} 
```

编辑：我猜泛型的东西在这里并没有真正增加任何价值。哦，好吧。:)

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2015-09-20T14:41:56.813

```
public static void main(String[] args){
    ArrayList<Object> al = new ArrayList<Object>();
    al.add("abc");
    al.add('a');
    al.add('b');
    al.add('a');
    al.add("abc");
    al.add(10.3);
    al.add('c');
    al.add(10);
    al.add("abc");
    al.add(10);
    System.out.println("Before Duplicate Remove:"+al);
    for(int i=0;i<al.size();i++){
        for(int j=i+1;j<al.size();j++){
            if(al.get(i).equals(al.get(j))){
                al.remove(j);
                j--;
            }
        }
    }
    System.out.println("After Removing duplicate:"+al);
} 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2015-12-10T14:46:58.367

如果您愿意使用第三方库，可以使用[Eclipse Collections](http://www.eclipse.org/collections/)（以前称为 GS Collections）`distinct()`中的方法。

```
ListIterable<Integer> integers = FastList.newListWith(1, 3, 1, 2, 2, 1);
Assert.assertEquals(
    FastList.newListWith(1, 3, 2),
    integers.distinct()); 
```

使用`distinct()`而不是转换为 Set 然后返回到 List的优点是`distinct()`保留了原始 List 的顺序，保留了每个元素的第一次出现。它是通过使用 Set 和 List 来实现的。

```
MutableSet<T> seenSoFar = UnifiedSet.newSet();
int size = list.size();
for (int i = 0; i < size; i++)
{
    T item = list.get(i);
    if (seenSoFar.add(item))
    {
        targetCollection.add(item);
    }
}
return targetCollection; 
```

如果您无法将原始 List 转换为 Eclipse Collections 类型，则可以使用 ListAdapter 获取相同的 API。

```
MutableList<Integer> distinct = ListAdapter.adapt(integers).distinct(); 
```

**注意：**我是 Eclipse Collections 的提交者。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2018-05-09T12:54:46.867

## 如果您使用模型类型 List< T>/ArrayList< T> 。希望，对你有帮助。

**这是我的代码，没有使用任何其他数据结构，如 set 或 hashmap**

```
for (int i = 0; i < Models.size(); i++){
for (int j = i + 1; j < Models.size(); j++) {       
 if (Models.get(i).getName().equals(Models.get(j).getName())) {    
 Models.remove(j);
   j--;
  }
 }
} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2013-10-12T12:51:01.780

如果您想保留您的订单，那么最好使用**LinkedHashSet**。因为如果您想通过迭代将此列表传递给插入查询，则将保留顺序。

试试这个

```
LinkedHashSet link=new LinkedHashSet();
List listOfValues=new ArrayList();
listOfValues.add(link); 
```

当您想要返回 List 而不是 Set 时，这种转换将非常有用。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2014-12-08T10:57:39.617

这三行代码可以从 ArrayList 或任何集合中删除重复的元素。

```
List<Entity> entities = repository.findByUserId(userId);

Set<Entity> s = new LinkedHashSet<Entity>(entities);
entities.clear();
entities.addAll(s); 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2011-04-11T08:17:38.553

填充 ArrayList 时，为每个元素使用一个条件。例如：

```
 ArrayList< Integer > al = new ArrayList< Integer >(); 

    // fill 1 
    for ( int i = 0; i <= 5; i++ ) 
        if ( !al.contains( i ) ) 
            al.add( i ); 

    // fill 2 
    for (int i = 0; i <= 10; i++ ) 
        if ( !al.contains( i ) ) 
            al.add( i ); 

    for( Integer i: al )
    {
        System.out.print( i + " ");     
    } 
```

我们将得到一个数组 {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10}

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2015-03-11T12:47:31.060

**代码：**

```
List<String> duplicatList = new ArrayList<String>();
duplicatList = Arrays.asList("AA","BB","CC","DD","DD","EE","AA","FF");
//above AA and DD are duplicate
Set<String> uniqueList = new HashSet<String>(duplicatList);
duplicatList = new ArrayList<String>(uniqueList); //let GC will doing free memory
System.out.println("Removed Duplicate : "+duplicatList); 
```

**注意：**肯定会有内存开销。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2016-03-26T10:13:30.243

```
ArrayList<String> city=new ArrayList<String>();
city.add("rajkot");
city.add("gondal");
city.add("rajkot");
city.add("gova");
city.add("baroda");
city.add("morbi");
city.add("gova");

HashSet<String> hashSet = new HashSet<String>();
hashSet.addAll(city);
city.clear();
city.addAll(hashSet);
Toast.makeText(getActivity(),"" + city.toString(),Toast.LENGTH_SHORT).show(); 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2017-11-30T18:40:58.163

您可以在下面使用嵌套循环：

```
ArrayList<Class1> l1 = new ArrayList<Class1>();
ArrayList<Class1> l2 = new ArrayList<Class1>();

        Iterator iterator1 = l1.iterator();
        boolean repeated = false;

        while (iterator1.hasNext())
        {
            Class1 c1 = (Class1) iterator1.next();
            for (Class1 _c: l2) {
                if(_c.getId() == c1.getId())
                    repeated = true;
            }
            if(!repeated)
                l2.add(c1);
        } 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-10-15T13:48:30.757

如前所述，您应该使用实现 Set 接口的类而不是 List 来确保元素的唯一性。如果必须保持元素的顺序，则可以使用 SortedSet 接口；TreeSet 类实现了该接口。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2012-01-22T15:23:18.183

```
for(int a=0;a<myArray.size();a++){
        for(int b=a+1;b<myArray.size();b++){
            if(myArray.get(a).equalsIgnoreCase(myArray.get(b))){
                myArray.remove(b); 
                dups++;
                b--;
            }
        }
} 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2013-01-02T17:06:41.123

LinkedHashSet 可以解决问题。

```
String[] arr2 = {"5","1","2","3","3","4","1","2"};
Set<String> set = new LinkedHashSet<String>(Arrays.asList(arr2));
for(String s1 : set)
    System.out.println(s1);

System.out.println( "------------------------" );
String[] arr3 = set.toArray(new String[0]);
for(int i = 0; i < arr3.length; i++)
     System.out.println(arr3[i].toString()); 
```

//输出：5,1,2,3,4

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2015-08-02T09:54:03.153

```
 List<String> result = new ArrayList<String>();
        Set<String> set = new LinkedHashSet<String>();
        String s = "ravi is a good!boy. But ravi is very nasty fellow.";
        StringTokenizer st = new StringTokenizer(s, " ,. ,!");
        while (st.hasMoreTokens()) {
            result.add(st.nextToken());
        }
         System.out.println(result);
         set.addAll(result);
        result.clear();
        result.addAll(set);
        System.out.println(result);

output:
[ravi, is, a, good, boy, But, ravi, is, very, nasty, fellow]
[ravi, is, a, good, boy, But, very, nasty, fellow] 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2017-03-26T06:19:13.793

这用于您的自定义对象列表

```
 public List<Contact> removeDuplicates(List<Contact> list) {
    // Set set1 = new LinkedHashSet(list);
    Set set = new TreeSet(new Comparator() {

        @Override
        public int compare(Object o1, Object o2) {
            if (((Contact) o1).getId().equalsIgnoreCase(((Contact) o2).getId()) /*&&
                    ((Contact)o1).getName().equalsIgnoreCase(((Contact)o2).getName())*/) {
                return 0;
            }
            return 1;
        }
    });
    set.addAll(list);

    final List newList = new ArrayList(set);
    return newList;
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2012-09-30T21:45:41.383

```
import java.util.*;
class RemoveDupFrmString
{
    public static void main(String[] args)
    {

        String s="appsc";

        Set<Character> unique = new LinkedHashSet<Character> ();

        for(char c : s.toCharArray()) {

            System.out.println(unique.add(c));
        }
        for(char dis:unique){
            System.out.println(dis);
        }

    }
} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2013-08-29T07:21:09.310

```
public Set<Object> findDuplicates(List<Object> list) {
        Set<Object> items = new HashSet<Object>();
        Set<Object> duplicates = new HashSet<Object>();
        for (Object item : list) {
            if (items.contains(item)) {
                duplicates.add(item);
                } else { 
                    items.add(item);
                    } 
            } 
        return duplicates;
        } 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-06-13T12:51:39.000

```
 ArrayList<String> list = new ArrayList<String>();
    HashSet<String> unique = new LinkedHashSet<String>();
    HashSet<String> dup = new LinkedHashSet<String>();
    boolean b = false;
    list.add("Hello");
    list.add("Hello");
    list.add("how");
    list.add("are");
    list.add("u");
    list.add("u");

    for(Iterator iterator= list.iterator();iterator.hasNext();)
    {
        String value = (String)iterator.next();
        System.out.println(value);

        if(b==unique.add(value))
            dup.add(value);
        else
            unique.add(value);

    }
    System.out.println(unique);
    System.out.println(dup); 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2014-09-11T06:52:56.530

如果要从 ArrayList 中删除重复项，则意味着找到以下逻辑，

```
public static Object[] removeDuplicate(Object[] inputArray)
{
    long startTime = System.nanoTime();
    int totalSize = inputArray.length;
    Object[] resultArray = new Object[totalSize];
    int newSize = 0;
    for(int i=0; i<totalSize; i++)
    {
        Object value = inputArray[i];
        if(value == null)
        {
            continue;
        }

        for(int j=i+1; j<totalSize; j++)
        {
            if(value.equals(inputArray[j]))
            {
                inputArray[j] = null;
            }
        }
        resultArray[newSize++] = value;
    }

    long endTime = System.nanoTime()-startTime;
    System.out.println("Total Time-B:"+endTime);
    return resultArray;
} 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2015-07-01T11:54:45.330

@jonathan-stafford 解决方案是可以的。但这不会保留列表顺序。

如果要保留列表顺序，则必须使用：

```
public static <T> void removeDuplicate(List <T> list) {
Set <T> set = new HashSet <T>();
List <T> newList = new ArrayList <T>();
for (Iterator <T>iter = list.iterator();    iter.hasNext(); ) {
   Object element = iter.next();
   if (set.add((T) element))
      newList.add((T) element);
   }
   list.clear();
   list.addAll(newList);
} 
```

这只是为了完成答案。很好！

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2015-09-23T09:36:02.547

这是我的答案，没有使用任何其他数据结构，如 set 或 hashmap 等。

```
public static <T> ArrayList<T> uniquefy(ArrayList<T> myList) {

    ArrayList <T> uniqueArrayList = new ArrayList<T>();
    for (int i = 0; i < myList.size(); i++){
        if (!uniqueArrayList.contains(myList.get(i))){
            uniqueArrayList.add(myList.get(i));
        }
    }

    return uniqueArrayList;
} 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2015-12-02T02:23:21.667

像这样的东西会更好吗？

```
public static void removeDuplicates(ArrayList<String> list) {
    Arraylist<Object> ar     = new Arraylist<Object>();
    Arraylist<Object> tempAR = new Arraylist<Object>();
    while (list.size()>0){
        ar.add(list(0));
        list.removeall(Collections.singleton(list(0)));
    }
    list.addAll(ar);
} 
```

那应该保持顺序，并且在运行时也不是二次的。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2018-05-17T02:53:05.023

时间复杂度：O(n)：没有设置

```
private static void removeDup(ArrayList<String> listWithDuplicateElements) {
    System.out.println(" Original Duplicate List :" + listWithDuplicateElements);
    List<String> listWithoutDuplicateElements = new ArrayList<>(listWithDuplicateElements.size());

    listWithDuplicateElements.stream().forEach(str -> {
        if (listWithoutDuplicateElements.indexOf(str) == -1) {
            listWithoutDuplicateElements.add(str);
        }
    });     

    System.out.println(" Without Duplicate List :" + listWithoutDuplicateElements);
} 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2018-07-05T00:14:17.103

这是正确的（如果您担心 HashSet 的开销。

```
 public static ArrayList<String> removeDuplicates (ArrayList<String> arrayList){
    if (arrayList.isEmpty()) return null;  //return what makes sense for your app
    Collections.sort(arrayList, String.CASE_INSENSITIVE_ORDER);
    //remove duplicates
    ArrayList <String> arrayList_mod = new ArrayList<>();
    arrayList_mod.add(arrayList.get(0));
    for (int i=1; i<arrayList.size(); i++){
        if (!arrayList.get(i).equals(arrayList.get(i-1))) arrayList_mod.add(arrayList.get(i));
    }
    return arrayList_mod;
} 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2019-02-08T15:20:31.850

```
Set<String> strSet = strList.stream().collect(Collectors.toSet()); 
```

是删除重复项的最简单方法。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2019-03-09T01:44:37.810

如果您希望您的列表自动忽略重复项并保留其顺序，您可以创建一个**HashList**（一个 HashMap 嵌入式列表）。

```
public static class HashList<T> extends ArrayList<T>{
        private HashMap <T,T> hashMap;
        public HashList(){
            hashMap=new HashMap<>();
        }

        @Override
        public boolean add(T t){
            if(hashMap.get(t)==null){
                hashMap.put(t,t);
                return super.add(t);
            }else return false;
        }

        @Override
        public boolean addAll(Collection<? extends T> c){
            HashList<T> addup=(HashList<T>)c;
            for(int i=0;i<addup.size();i++){
                add(addup.get(i));
            }return true;
        }

    } 
```

**`Usage Example:`**

```
HashList<String> hashlist=new HashList<>();
hashList.add("hello");
hashList.add("hello");
System.out.println(" HashList: "+hashlist); 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2021-10-08T17:59:20.797

这是一个适用于任何对象的解决方案：

```
public static <T> List<T> clearDuplicates(List<T> messages,Comparator<T> comparator) {
    List<T> results = new ArrayList<T>();
    for (T m1 : messages) {
        boolean found = false;
        for (T m2 : results) {
            if (comparator.compare(m1,m2)==0) {
                found=true;
                break;
            }
        }
        if (!found) {
            results.add(m1);
        }
    }
    return results;
} 
```

* * *

## 回答 #39

> 赞同：-2
> 
> 时间：2015-11-17T07:26:39.697

在 Java 中，List 允许对其元素进行有序访问。它们可以有重复项，因为它们的查找键是位置而不是某个哈希码，每个元素都可以在它们保留在列表中时进行修改，其中 Set 表示唯一元素的集合，并且当元素在集合中时，它们不能被修改。虽然没有限制阻止您修改集合中的元素，如果元素被修改，那么它可能会永远丢失在集合中。

```
public static void main(String[] args) {
       List<String> l = new ArrayList<String>();
       l.add("A");
       l.add("B");
       l.add("C");
       l.add("A");
       System.out.println("Before removing duplicates: ");
       for (String s : l) {
            System.out.println(s);
       }
       Set<String> set = new HashSet<String>(l);
       List<String> newlist = new ArrayList<String>(set);
       System.out.println("after removing duplicates: ");
       for (String s : newlist) {
            System.out.println(s);
       }
  } 
```

作为参考，请参阅此链接[如何从 ArrayList 中删除重复项](http://techno-terminal.blogspot.in/2015/11/how-to-remove-duplicates-from-arraylist.html)

# php - 如何使用 C++ cURL (libcurl) 管理一个简单的 PHP 会话

> ID：203990
> 
> 赞同：2
> 
> 时间：2008-10-15T08:10:33.733
> 
> 标签：php, c++, session, curl, libcurl

我正在编写一个 C++ 客户端，它使用 libcurl 与 PHP 脚本进行通信。

通信应该是基于会话的，因此第一个任务是登录并让 PHP 脚本设置会话。

我不习惯使用 C++ 或 PHP 的会话。我基本上知道它与 cookie 和通信会话 id 有关。

我在 curl 主页上找不到任何演示简单会话管理用例的示例。

我假设它与 curl 中的以下一个或多个选项有关：

```
CURLOPT_COOKIE
CURLOPT_COOKIEFILE
CURLOPT_COOKIEJAR
CURLOPT_COOKIESESSION
CURLOPT_COOKIELIST 
```

但是，例如，仅从 CURLOPT_COOKIESESSION 的文档中，我无法真正看到全局。

任何做过这个的人，请分享一段简单的代码来展示这个概念。

问候

罗伯特

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T16:28:07.143

据我了解，如果您启用 cookie，CURL 将自动为您处理会话 cookie，只要您为会话中的每个请求重用 CURL 句柄：

```
CURL *Handle = curl_easy_init();

// Read cookies from a previous session, as stored in MyCookieFileName.
curl_easy_setopt( Handle, CURLOPT_COOKIEFILE, MyCookieFileName );
// Save cookies from *this* session in MyCookieFileName
curl_easy_setopt( Handle, CURLOPT_COOKIEJAR, MyCookieFileName );

curl_easy_setopt( Handle, CURLOPT_URL, MyLoginPageUrl );
assert( curl_easy_perform( Handle ) == CURLE_OK );

curl_easy_setopt( Handle, CURLOPT_URL, MyActionPageUrl );
assert( curl_easy_perform( Handle ) == CURLE_OK );

// The cookies are actually saved here.
curl_easy_cleanup( Handle ); 
```

我不肯定您需要同时设置 COOKIEFILE 和 COOKIEJAR，但文档看起来就是这样。无论如何，您必须设置两者之一才能在 CURL 中启用 cookie。你可以做一些简单的事情：

```
curl_easy_setopt( Handle, CURLOPT_COOKIEFILE, "" ); 
```

这不会从磁盘读取任何 cookie，但会在 curl 句柄期间启用会话 cookie。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T11:15:13.877

我有一个 bash 中命令行 curl 的示例 - 登录到 PHPMyAdmin，然后使用它的导出功能。也许它会帮助你：

```
#!/bin/bash

PHPMYADMINURL="http://www.example.com/phpmyadmin/"

# Username and password, has to be URL-encoded
MYUSERNAME="username"
MYPASSWORD="password"

TMPCOOKIES="$(mktemp)" || exit 1

TOKEN=$(
        curl \
                --silent \
                --show-error \
                --data @- \
                --data "lang=en-utf-8" \
                --cookie-jar "$TMPCOOKIES" \
                --dump-header - \
                --url "$PHPMYADMINURL" \
                <<< "pma_username=$MYUSERNAME&pma_password=$MYPASSWORD" \
                | egrep 'token=[0-9a-h]+' \
                | head -1 \
                | sed -r 's/^(.*token=)([0-9a-h]+)(.*)/\2/' \
        ) || exit 1

curl \
       --cookie "$TMPCOOKIES" \
       --data "token=$TOKEN" \
       --data "export_type=server" \
       --data "what=sql" \
       --data "asfile=sendit" \
       --data "sql_data=something" \
       --data "sql_columns=something" \
       --data "sql_hex_for_blob=something" \
       --data "compression=gzip" \
       --url "$PHPMYADMINURL"export.php 1>&2 || exit 1

rm -f "$TMPCOOKIES" || exit 1 
```

PHPMyAdmin 使用除了 cookie 之外的令牌，因此代码比通常需要的要复杂一些。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-15T08:26:42.110

PHP 中的会话旨在为多个请求保留一些状态，因为 HTTP 本身是无状态的。要从 PHP 获取会话，只需请求一个启动会话的 php 页面，并保留您返回的 cookie 以供后续请求使用。

在 php 中启动会话很简单——调用 session_start() 函数。如果请求中存在 cookie，该函数将恢复现有会话。当会话启动时，可以使用超全局数组 $_SESSION 设置持久变量。在那里存储一个“已登录”令牌是个好主意 =) 要结束 PHP 会话，请将 $_SESSION 设置为 array()，以便销毁令牌。***``********