# StackOverflow 问答 000808000-000808999

# javascript - 建议一种方法和/或 COTS 应用程序，用于在数据库驱动的 Web 应用程序上提供 Fly-Out 帮助文本？

> ID：808002
> 
> 赞同：1
> 
> 时间：2009-04-30T17:01:40.617
> 
> 标签：javascript, html

我需要提出一种方法来为我公司支持的 Web 应用程序的最终用户提供帮助文本。基本上，我们希望在网页上有一个区域，用户可以单击或悬停在该区域上，并为他们提供相关帮助，这样他们就不必再参考用户手册了。

我们想要完成的是将所有帮助文本填充到数据库中并从数据库中读取，以便可以轻松更新它。然后，我们需要一种方法来确定特定网页上的哪些网页和区域需要相应的相关帮助文本。

有人通过他们自己的设计实现了这一点并愿意分享吗？还是有执行此功能的商业应用程序？

任何帮助，将不胜感激。谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T17:04:43.917

您可以查看 robohelp。 [http://www.codeproject.com/KB/aspnet/CtxtSensRoboHelp7WebHelp.aspx](http://www.codeproject.com/KB/aspnet/CtxtSensRoboHelp7WebHelp.aspx)

# c# - 在 Visual Studio 2005 的解决方案资源管理器中以编程方式更改文件图标

> ID：808003
> 
> 赞同：2
> 
> 时间：2009-04-30T17:01:41.350
> 
> 标签：c#, visual-studio, visual-studio-2005

我正在为 Visual Studio 编写一个插件，它必须与 VS 2005 兼容。这个插件涉及将某些文件标记为“特殊”，我真的很想在解决方案资源管理器中让它们的特殊性在视觉上显而易见 -目前我的用户要么必须手动记录哪些文件是特殊的，要么右键单击每个潜在的特殊文件并查看那里有哪些菜单项。

理想情况下，我想更改图标，但我很乐意（例如）将文件名设为粗体或其他内容。

不幸的是，所有与外观相关的方法似乎都存在于 Microsoft.VisualStudio.Package.FileNode 上，而我只能访问 UIHierarchyItems 和 ProjectItems。我花了几天时间在 MSDN 上苦苦挣扎，但我找不到任何方法来构造给定 ProjectItem 或 UIHierarchyItem 的 FileNode。MSDN 论坛上有一个建议的解决方案，但它假设您从 FileNode 开始，据我所知，这意味着创建自定义项目类型（并且可能是某种项目转换系统）。我认为我的用户不会对此感到太高兴。

还是我缺少什么？

# windows - How to Generate File of a determinate Size in Windows?

> ID：808005
> 
> 赞同：17
> 
> 时间：2009-04-30T17:02:18.883
> 
> 标签：windows, scripting, file, filesystems

How is the Best and fastest way to do it?

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-04-30T17:56:04.217

PowerShell:

```
$f = new-object System.IO.FileStream c:\temp\test.dat, Create, ReadWrite
$f.SetLength(42MB)
$f.Close() 
```

This will create a file c:\temp\test.dat that consists of 42MB of nullbytes. You can of course just give byte count instead as well. (42MB = 42 * 1048576 for PowerShell)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-30T17:02:46.903

I found this [Page](http://thebackroomtech.com/2009/01/16/howto-generate-many-files-of-a-particular-size-in-windows/), I try it and work great.

To create a single File use

```
fsutil file createnew filename filesize 
```

To create a lot of Files use

```
For /L %i in (1,1,25000) do fsutil file createnew A%i.tmp 12288 
```

will create 25,000 files of 12288 bytes (12KB) named A1.tmp, A2.tmp, A3,tmp…</p>

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-19T01:39:42.080

```
c:\>fsutil file createnew /?
Usage : fsutil file createnew <filename> <length>
   Eg : fsutil file createnew C:\testfile.txt 1000 
```

# c# - 收藏已修改；从 LIstBox 中删除 ListItem 时，枚举可能不会执行错误

> ID：808006
> 
> 赞同：8
> 
> 时间：2009-04-30T17:02:28.383
> 
> 标签：c#, .net, ienumerable

我有两个 ListBox，lstAvailableColors 和 lstSelectedColors。每个列表框之间有两个按钮，添加和删除。当在 lstAvailableColors 中选择一种或多种颜色并单击“添加”按钮时，我想将它们从 lstAvailableColors 中删除并在 lstSelectedColors 中显示它们。此外，如果在 lstSelectedColors 中选择了颜色并单击了“删除”按钮，我想从 lstSelectedColors 中删除颜色并将它们添加回 lstAvailableColors。当我这样做时，我在删除项目时收到以下错误：

收藏已修改；枚举操作可能无法执行。

这是添加按钮和删除按钮的代码：

添加：

```
protected void btnAdd_Click(object sender, EventArgs e)
{
    foreach (ListItem item in lstAvailableColors.Items)
    {
        if (item.Selected)
        {
            lstSelectedColors.Items.Add(item);
            lstAvailableColors.Items.Remove(item);
        }
    }
} 
```

消除：

```
protected void btnRemove_Click(object sender, EventArgs e)
{
    foreach (ListItem item in lstSelectedColors.Items)
    {
        if (item.Selected)
        {
            lstAvailableColors.Items.Add(item);
            lstSelectedColors.Items.Remove(item);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-30T17:08:03.567

在 .Net 中枚举集合时，无法修改集合。您需要将枚举分离出来并将代码删除到不同的块中。这是一个关于如何在没有 LINQ 的情况下执行此操作的快速示例

```
protected void btnAdd_Click(object sender, EventArgs e)
{
    var selected = new List<ListItem>();
    foreach (ListItem item in lstAvailableColors.Items)
    {
        if (item.Selected)
        {
            selected.Add(item);
            lstSelectedColors.Items.Add(item);
        }
    }
    foreach (ListItem item in selected)
    {
        lstAvailableColors.Items.Remove(item);
    }
} 
```

这是使用 LINQ 的更简洁的版本

```
var selected = lstAvailableColors.Cast<ListItem>().Where(i => i.Selected).ToList();
selected.ForEach( x => { lstSelectedColors.Items.Add(x); });
selected.ForEach( x => { lstAvailableColors.Items.Remove(x);}); 
```

**编辑**

LINQ 版本分为两部分。第一部分是第一行，它找到当前选定的项目并将值存储在 a 中`List<ListItem>`。该行包含 .ToList() 调用非常重要，因为这会强制查询立即执行而不是延迟执行。

接下来的两行遍历每个选择的值并将其删除或添加到适当的列表中。因为选择的列表已经存储了，所以我们在修改它时不再枚举集合。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-30T17:06:27.643

当您为该集合使用 Enumerator 时，您不能修改集合，for each 语句的作用。

您必须使用普通的 for 循环遍历数据，然后才能修改集合，但如果插入或删除元素，则必须小心正确更新当前索引。如果您只是添加或删除元素而不插入一些元素，则从最后一个元素迭代到第一个元素就可以了。

```
protected void btnAdd_Click(object sender, EventArgs e)
{
    for (Int32 i = lstAvailableColors.Items.Count; i >= 0; i--)
    {
        ListItem item = lstAvailableColors.Items[i];

        if (item.Selected)
        {
            lstSelectedColors.Items.Add(item);
            lstAvailableColors.Items.Remove(item);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-30T17:08:28.247

您不能修改正在迭代的集合。一般来说，这类问题的一个好的解决方案是创建一个空集合，然后在迭代器中复制所有不想删除的元素；迭代完成后，将原始集合替换为新集合。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T17:08:24.330

正如提到的另一个答案，在完成迭代之前您不能删除项目。所以也许这样的东西对你来说是最干净的：

```
var itemsToRemove =
lstAvailableColors.Items.Cast<ListItem>().Where(i => i.IsSelected).ToArray();

foreach(ListItem item in itemsToRemove) lstAvailableColors.Remove(item); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T17:04:26.587

迭代集合时不能修改集合。遍历副本或使用 for，反向迭代并在您向下移动时删除。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-16T13:56:12.983

有关如何删除所选项目的示例。此处仅获取和删除选定的索引。

```
 public void RemoveSelectedItems(ListBox listbox)
   {
       List<ListItem> items = GetSelectedItems(listbox);
       foreach (var listItem in items)
       {
           listbox.Items.Remove(listItem);
       }
   }

  public List<ListItem> GetSelectedItems(ListBox listbox)
  {
     int[] selectedIndices = listbox.GetSelectedIndices();
     return selectedIndices.Select(index => listbox.Items[index]).ToList();
  } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-05T05:58:28.777

也许这就是你需要的

```
protected void btnAdd_Click(object sender, EventArgs e)
{
    while(listBox1.SelectedIndex!=-1)
    {
           listBox1.Items.Remove(listBox1.SelectedItem);
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-01T04:11:47.277

这可能会对您有所帮助；

## 去除：

```
protected void btnRemove_Click(object sender, EventArgs e)
{
    {
        for (int i = 0; i < lstAvailableColors.Items.Count; i++)
        { 
            if(lstAvailableColors.Items[i].Selected)
                lstAvailableColors.Items.RemoveAt(i);
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-09-23T17:51:09.373

您面临的问题是您无法修改您遍历的集合。您可以通过使用单个 linq 来解决此问题：

```
protected void btnAdd_Click(object sender, EventArgs e)
{
    lstAvailableColors.Items.RemoveAll(ac => ac.Selected);
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-02-18T13:00:56.677

您可以使用这个通用函数从 ObservableCollection 中删除多个项目（我知道很多人害怕异常，但异常只不过是一个开发工具）

```
 public static void OCRemoveMultiple<T>(ref ObservableCollection<T> inputList, IList<T> toRemoveItems)
    {
        REITERATE:
        {
            try
            {
                while( inputList.Intersect<T>(toRemoveItems).Any())
                {
                    var intersectionList = inputList.Intersect<T>(toRemoveItems);
                    foreach (var item in intersectionList)
                    {
                        inputList.Remove(item);
                    }
                }

            }
            catch (Exception)
            {
                goto REITERATE;
            }
        }
    } 
```

这是一个测试用例（示例）如何使用它：

```
 ObservableCollection<object> targetList = new ObservableCollection<object>();

        targetList.Add("T1");
        targetList.Add("T2");
        targetList.Add("B3");
        targetList.Add("B4");
        targetList.Add("T5");

        IList<object> toRemove = targetList.ToList().Where(k=>k.ToString().Contains("B")).ToList();

        OCRemoveMultiple(ref targetList, toRemove);

        targetList.ToList().ForEach(k => Console.WriteLine(k.ToString())); // Writes "T1", "T2" and "T5" 
```

# arrays - 为什么在这种情况下将 Excel 数组公式包装在 SUM 中不会产生内容的总和？

> ID：808011
> 
> 赞同：1
> 
> 时间：2009-04-30T17:03:35.823
> 
> 标签：arrays, excel, inner-join

聪明人，

在 Excel 中，将数组公式包装在 SUM 中似乎不会在所有情况下产生数组内容的总和。（也就是说，在我看来；显然，我很可能会感到困惑。）

尝试在 Excel 中编写等效的内部联接时会出现这种情况。由于涉及 Excel for Mac 的原因，我在不使用 Visual Basic 或 MS Query 的情况下执行此操作：仅数组公式和 INDEX/MATCH。我认为，我已经成功了，除了这种我无法理解的奇怪行为。

目前我正在使用kludge，但不必这样做会很好。任何帮助或建议将不胜感激。

以下重现了该问题：

## 表格1

```
key | fkey
----+------
  a |   x
  a |   y
  b |   x
  b |   y 
```

## 表 2

```
key | value
----+------
  x |   1
  y |  10 
```

上面的布局应该代表这两个小表格在电子表格中的显示方式：没有发生任何聪明的事情。四个明显的范围被命名为`table1.key`、`table1.fkey`、`table2.key`和`table2.value`。

所以，然后，内部连接。我想要表 2 中与表 1 中的特定键相对应的值，并在“table1.fkey=table2.key”上加入。输入公式：

```
{=("a"=table1.key)*INDEX(table2.value, MATCH(table1.fkey, table2.key, FALSE))} 
```

分成*两个*垂直单元格给出所需的结果；即：

> ```
> 1
> 10 
> ```

（酷，还是什么？）到目前为止，一切都很好。但现在我实际上想要上面两个数字的总和。所以我简单地将上面的公式包装在一个 SUM 中，然后在一个单元格中输入*结果*：

```
{=SUM(("a"=table1.key)*INDEX(table2.value, MATCH(table1.fkey, table2.key, FALSE)))} 
```

结果？

> ```
> 2 
> ```

有谁知道到底发生了什么*？*

詹姆士

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T20:25:35.230

在单个元胞数组公式中使用时，INDEX 的 row_num 参数不能是数组。INDEX 函数总是返回 1。试试这个

```
=SUM(INDEX(table2.value,{2,1}))
```

它总是返回 10，因为 INDEX 只接受数组的第一个元素。我不知道为什么它们对于单单元格数组公式与多单元格的工作方式不同。

# apache - mod_rewrite 还是 mod_alias？

> ID：808014
> 
> 赞同：25
> 
> 时间：2009-04-30T17:04:18.333
> 
> 标签：apache, mod-rewrite, redirect, httpd.conf, mod-alias

我有一个服务器，它的 httpd.conf 已经有一些“ *RedirectMatch 永久*”指令。

我对 mod_alias 不是很熟悉，我只使用过 mod_rewrite。

基本的区别是什么？我在 mod_alias 中没有看到“L”标志来停止处理规则。

对于从一个子域重定向到另一个子域的最佳实践，我应该使用哪一个？

我可以同时使用两者吗？哪个优先？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-30T17:20:35.847

mod_alias 基本上是 mod_rewrite 的更简单版本。它不能做一些 mod_rewrite 可以做的事情，比如操纵查询字符串。如果您可以选择其中任何一个，我看不出您有任何理由要使用 mod_alias。

是否有特定原因需要尝试同时使用两者？

[你应该知道的 Apache mod_rewrite 和 mod_alias 技巧](http://wayback.archive.org/web/20131107001958/http://my.opera.com/GreyWyvern/blog/2007/09/12/apache-mod-rewrite)似乎是一篇关于这两者的好文章。它在某一时刻注意到 mod_rewrite 规则在 mod_alias 规则之前执行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-07-14T16:47:11.817

正如公认的答案所说：`mod_rewrite`可以做不能做的事情`mod_alias`。然而，它的主要好处`mod_alias`是它更易于使用。

apache 文档说我们应该`mod_alias`用于简单的事情，比如重定向，并且`mod_rewrite`只用于我们不能用更简单的模块做的事情，比如`mod_alias`. 查看文档：[何时不使用 mod_rewrite](https://httpd.apache.org/docs/trunk/rewrite/avoid.html)。

# 4d-database - 为什么我的 4D 写入文档没有与其他记录一起保存？

> ID：808017
> 
> 赞同：2
> 
> 时间：2009-04-30T17:04:41.657
> 
> 标签：4d-database

在 4D 中，如何保证 4D 写入文档与其余记录一起保存？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-09-26T16:56:37.440

我知道，我迟到了。如果您想自动保存 4D 写入，请在您正在修改的表中创建一个字段，并将下划线作为最后一个字符。

您的 4D 写入区域名称：myLetter 您的表格字段名称：myLetter_ <--“下划线”是秘密

一旦您点击接受，4D 就会将其与记录一起保存。

如果您使用的是 SAVE RECORD，那将是一项艰巨的工作。在保存记录之前的行中，您需要将 4D 写入区域转移到您的字段中：

[TableName]myLetter_:=WR AREA TO BLOB(myLetter) 保存记录([TableName])

彼得

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-04T18:16:43.633

ACCEPT 和 SAVE RECORD ([table]) 之间存在差异。

在输入表单上保存 4D Write 文档时，您需要使用 ACCEPT。

# .net - 检测到重入

> ID：808030
> 
> 赞同：2
> 
> 时间：2009-04-30T17:07:11.510
> 
> 标签：.net, interop, webbrowser-control, reentrancy

我在设置 webbrowser 控件的属性时收到“检测到可重入”MDA 错误。仅当我调用“SetWindowsHookEx”以在同一线程中挂钩某些拨号时才会发生这种情况。

通常，这个挂钩代码可以正常工作，但它与 Webbrowser Control 配合得不好。当我忽略异常代码工作正常时，至少看起来不错，但显然我有点担心。

是否知道为什么**会**发生此错误以及如何解决该问题。

我在 MSDN 中看到了这篇文章 - [http://msdn.microsoft.com/en-us/library/ms172237.aspx](http://msdn.microsoft.com/en-us/library/ms172237.aspx)但它并没有真正帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T17:29:40.440

我想通了：

*   它应该在同一个线程中（这是预期的）
*   它不应在非托管控件的初始化期间运行。所以我在设置所有属性和事件后运行它然后它工作。

# javascript - 在 JavaScript 中嵌入 HTML

> ID：808038
> 
> 赞同：4
> 
> 时间：2009-04-30T17:08:53.237
> 
> 标签：javascript, html

我有一大段 HTML 想在运行时添加到文档中。

如何在 JS 文件中嵌入 HTML？

```
var p = document.createElement("div");
p.innerHTML = '<div>  MY HTML  
               <some element>  </some element>
               <some element>  </some element>
               </div>' 
```

问题是我的 HTML 是多行的；如何在 JS 字符串中添加换行符？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T17:12:20.857

您可以使用反斜杠字符来忽略 JavaScript 字符串中的行尾。

[http://www.componentart.com/BLOGS/jovan/archive/2007/10/17/multiline-strings-in-javascript.aspx](http://www.componentart.com/BLOGS/jovan/archive/2007/10/17/multiline-strings-in-javascript.aspx)

# sql - 有什么方法可以将早于“Y”天的数据移动到 MySQL 中的存档/历史表中？

> ID：808039
> 
> 赞同：1
> 
> 时间：2009-04-30T17:08:56.933
> 
> 标签：sql, mysql, database, history

希望每 X 天将 Y 天前的数据从表 A 中的数据移动到历史表 B，然后从历史表 B 中删除早于 Z 天的数据。

只是探索不同的方法来实现这一点。因此，任何建议将不胜感激。

变量示例 X - 7days Y - 60days z - 365days

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T17:14:49.213

```
CREATE PROCEDURE prc_clean_tables (Y INT, Z INT)
BEGIN
        BEGIN TRANSACTION;

        DECLARE _now DATETIME;
        SET _now := NOW();

        INSERT
        INTO    b
        SELECT  *
        FROM    a
        WHERE   timestamp < _now - INTERVAL Y DAY;
        FOR UPDATE;

        DELETE
        FROM    a
        WHERE   timestamp < _now - INTERVAL Y DAY;

        DELETE
        FROM    b
        WHERE   timestamp < _now - INTERVAL Z DAY;

        COMMIT;
END 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T17:29:29.163

这似乎是直截了当的。

你想要一个每晚的 cron 作业来运行一个脚本。

```
#crontab -e 

50 11 * * * $HOME/scripts/MyWeeklyArchive.sh 
```

脚本文件本身也很简单。我们将只使用 mysqldump 和 Now() 函数；

```
#! /bin/bash

/usr/bin/mysqldump -uUser -pPassword Current_DB Table --where='date < NOW() - INTERVAL 7 DAY' | /usr/bin/mysql -uUser -pPassword archive_DB 
```

您可以只在 cron 文件中包含该行，但出于可伸缩性等考虑，我建议将其设为脚本文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T19:03:49.747

如果您使用的是 MySQL 5.1，您也许可以使用事件调度程序，而不是 cron。我没有使用过它，但我在 SQL Server 中使用过类似的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T17:26:55.097

最简单的方法当然是将在线表中的行插入到历史表中，然后进行删除。正如 Quassnoi 建议的那样，将其封装在 SPROC 中将是完美的。

另一种可能更好的方法是利用[分区](http://dev.mysql.com/doc/refman/5.1/en/partitioning-overview.html)。如果您的表按日期分区，您应该能够通过简单地删除相关分区来加速至少 DELETE 部分。INSERT 部分也可能更快，因为所有插入的行都来自一个分区（如果您正确创建分区）。

如果模式相同，甚至可能有某种技巧可以让您相对瞬时地将分区从一个表移动到另一个表。

# ruby-on-rails - 以编程方式从 Rails 发布表单

> ID：808048
> 
> 赞同：2
> 
> 时间：2009-04-30T17:11:08.927
> 
> 标签：ruby-on-rails

我将如何从一些 Rails 代码中创建和发布表单 POST 请求？
我的用例是我收到了一个表单请求，我想将此请求转发给我的参数完整的第三方。

我应该补充一点，我也想通过表单将用户重定向到第三方。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T17:16:07.527

来自[Net::HTTP 的 ruby​​ 文档](http://www.ruby-doc.org/stdlib/libdoc/net/http/rdoc/classes/Net/HTTP.html)：

```
 res = Net::HTTP.post_form(URI.parse('http://www.example.com/search.cgi'),
                              {'q'=>'ruby', 'max'=>'50'}) 
```

您可以将 params 作为第二个参数传递，例如：

```
 Net::HTTP.post_form(URI.parse('http://www.example.com/search.cgi'), params)
 redirect_to some_path 
```

另外，不要忘记需要库：

```
 require 'net/http'
 require 'uri' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-01T13:47:42.197

你也许可以这样做：

1.  接收用户的帖子
    *   更改您想要的任何数据
    *   用一个充满隐藏字段的表单来响应请求
    *   在 dom-loaded 上通过 javascript 自动将该表单发布给第三方

或者：

1.  将表单操作设置为第三方 url
2.  用js拦截onsubmit事件
    *   通过简单的客户端操作表单来更改您需要的任何数据
    *   或者，向您的应用程序发布一个 ajax 请求以处理数据，并从 ajax 响应中替换您需要的字段
    *   现在处理数据后，让表单传递给第三方

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T11:57:47.460

您将不得不通过 Javascript 执行此操作，因为无法重定向 POST 请求（[根据 HTTP/1.1 协议](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)）。

# version-control - 源代码控制中多语言项目的合理结构是什么？

> ID：808052
> 
> 赞同：5
> 
> 时间：2009-04-30T17:12:51.403
> 
> 标签：version-control, projects-and-solutions, monorepo

在工作中，我们正在开发一个包含大量前端、后端和支持组件的大型应用程序。通常前端是用 C# 开发的，后端是用 Java 开发的，尽管后端的一部分也是用 C# 和可能后来的 C++ 开发的。

语言和平台的选择不是任意的；我们尝试权衡每个组件在开发时间、工具链成本、特定开发团队对语言的熟悉程度等方面的相对优点。但是，所有这些组件的共同点是，它们都是完整操作所必需的产品，并且它们是由独立的（但高度沟通的）团队同时开发的。

以前，我们使用 Team Foundation Server 编写 .NET 代码，使用 Subversion 编写 Java 代码；因为团队职责明确分离，除了将一个源代码树生成的二进制文件（在本例中为 WAR）放置在另一个源代码树中的不便以及保持分支和修订同步的高手动开销之外，这几乎没有造成什么问题。有了这个项目，团队之间的分离程度故意要小得多，分支/合并的数量预计会大大增加；因此，我们正在转向统一的 VCS，更具体地说是 Subversion。

这让我想到了问题的实质：如何有效地混合 Java 和 C# 代码？在实践中，我们将拥有依赖于 Java 代码库的 .NET 代码；Java 二进制文件需要运行除单元测试代码以外的任何东西（集成测试已经需要二进制文件，并且 QA、验收测试等当然也需要）。我们目前的想法是这样的：

```
/树干
    /java
        /组件1
        /组件2
        /图书馆1
        /图书馆2
    /网
        /组装1
        /组装2
        /...
        项目.sln

```

这个想法是将整个源代码树放在一个分支下；.NET 代码依赖于 Java 代码，因此我们将在解决方案中添加一个构建后步骤，这将（很可能）调用 Java 组件的 ant 脚本。这允许对整个代码库（对于 .NET 开发人员）或仅对 Java 组件（对于 Java 开发人员）进行分支。

这个解决方案的问题是：

1.  当两个代码库中的一个变得如此之大以至于为每个分支复制它变得不切实际时会发生什么？（我们的想法：拆分为 .NET 和 Java 代码的单独存储库并使用 svn:externals，对此的任何输入将*不胜*感激）。
2.  我们使用 Eclipse 进行 Java 开发。我们如何管理“共享”工作空间（即哪些项目需要哪些组件、依赖关系图等）？到目前为止，我们拥有的 Java 组件相对较少，因此每个开发人员都可以同时将所有这些组件保存在工作区中。随着 Java 组件和 Java 开发人员的增加，我看不出我们如何才能继续这样做。关于如何在保持两个代码库之间同步的同时保持工作区版本化（la 解决方案文件）的任何建议？

我很想听听你的意见！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T17:52:00.980

1：我发现最好按组件而不是语言来分组。如果一个组件需要多种语言的接口，您仍然需要将它们作为一个开发、测试和发布。因此，将一个组件拆分为多个存储库*并不是*一个好主意。

如果代码的一部分紧密依赖于另一部分，请将其放在一起。更好地跨 repos 拆分组件。（这甚至适用于内部结构，特别是随着事情的发展，如果你按类型而不是按功能打包东西是很困难的，即在 MVC 中，每个类别没有三个巨大的包，而是保留 FooView、FooModel 和FooController 紧。）

svn:externals 可能会起作用，并且我认为您可以使用更高版本的“内部”，即链接到同一仓库中的其他目录。这比管理单独的存储库要容易得多，尤其是在标记和分支方面。（不寒而栗）

2：您总是可以让开发人员设置不同的工作区，或者使用工作集。与 OS 变体相比，商业 Eclipse 版本对共享工作区设置的支持更好。（没有尝试过，只工作过并且对操作系统感到沮丧）

我已经在一个仓库中完成了 C++ (MSVS) 和 Java (Eclipse)，而且效果很好。C++/Python 也类似。确保您的构建系统支持构建和测试所有内容（即使您的 IDE 只构建一个部分）。

# c# - 自定义向导：是否可以在从自定义向导创建项目时添加 dll 引用？

> ID：808054
> 
> 赞同：0
> 
> 时间：2009-04-30T17:13:22.883
> 
> 标签：c#, visual-studio-2008, assemblies, reference, wizard

我想知道是否有人可以告诉我我想要完成的事情是否可行。

我在 VS 2008 中使用 C#。

我有两个项目模板和另一个链接两个项目并调用它们的模板的模板。第一个项目是用户控件，第二个项目是需要引用用户控件的测试应用。我还有一个从模板调用的自定义向导。创建项目后，向导会编译用户控件并获取其 dll 的路径。然后，我需要从 dll 路径到我的测试应用程序添加对用户控件的引用。我不可能在此之前添加引用，因为我不知道 dll 的名称将是什么，直到用户创建新的用户控件项目并为其提供他们想要的任何名称。有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-01T00:11:06.857

而不是 DLL 引用 - 你可以使用项目引用吗？

# visual-studio-2008 - Visual Studio 2008 不生成 Web 服务 Reference.cs 代理类？

> ID：808059
> 
> 赞同：0
> 
> 时间：2009-04-30T17:14:24.113
> 
> 标签：visual-studio-2008, web-services, soap, wsdl

我刚刚将一个项目从 Visual Studio 2005 格式移植到 Visual Studio 2008。这个项目大量使用了消费网络服务。

对于 Visual Studio 生成的代理类 (Reference.cs)，我们使用自己的自定义父类。

我使用 Visual Studio 2008 添加了一个新的 Web 引用，它没有生成代理类，只是一个 reference.map 文件。看来它可能是即时构建这些的。这不能满足我的需要，因为我需要修改代码以适应我们的框架。

请注意，这是 Web 引用，而不是服务引用。

有谁知道让 VS2k8 像 2k5 一样工作的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T18:31:17.627

经过一番折腾，我在网上找到了这篇[文章](http://developers.de/blogs/andreas_erben/archive/2007/02/02/svcutil.exe_2F00_wsdl.exe_3A00_-issue-with-message-part-name-_2200_parameters_2200_.aspx)。

事实证明，提供的 WSDL 有一个片段，如：

```
<wsdl:message name="someMessageRequest">
    <wsdl:part name="parameters" element="ns0:someMessageRequest"/>
</wsdl:message>
<wsdl:message name="someMessageResponse">
    <wsdl:part name="parameters" element="ns0:someMessageResponse"/>
</wsdl:message>

... SNIP ...

<soap:operation style="document" soapAction="someMessage"/>
<wsdl:input>
     <soap:body use="literal" parts="parameters"/>
</wsdl:input>
<wsdl:output>
     <soap:body use="literal" parts="parameters"/>
</wsdl:output> 
```

因为它对请求和响应参数使用相同的名称，所以 wsdl.exe 无法解析它并死掉。

我的修复：

```
<wsdl:message name="someMessageRequest">
    <wsdl:part name="parametersRequest" element="ns0:someMessageRequest"/>
</wsdl:message>
<wsdl:message name="someMessageResponse">
    <wsdl:part name="parametersResponse" element="ns0:someMessageResponse"/>
</wsdl:message>

... SNIP ...

<soap:operation style="document" soapAction="someMessage"/>
<wsdl:input>
     <soap:body use="literal" parts="parametersRequest"/>
</wsdl:input>
<wsdl:output>
     <soap:body use="literal" parts="parametersResponse"/>
</wsdl:output> 
```

现在代理已生成。

SoA 的部分乐趣在于，您永远不能相信提供给您工作的 WSDL :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T17:16:09.087

也许您应该使用[svcutil.exe](http://msdn.microsoft.com/en-us/library/aa347733.aspx)或[wsdl.exe](http://msdn.microsoft.com/en-us/library/7h3ystb6(VS.80).aspx)来生成代理类文件。

# javascript - iFrame 中 html 元素的精确坐标

> ID：808061
> 
> 赞同：0
> 
> 时间：2009-04-30T17:14:59.150
> 
> 标签：javascript, html

如何获取页面上可能存在于 iFrame 中的 HTML 元素的绝对 x,y 坐标。页面有时会单独调用，有时会从 iFrame 中调用。

这是我编写的函数，用于根据元素的 offsetLeft 和 offsetTop 以及 offseParent 来计算 x,y 位置。

```
function getXY(obj) 
{
var curObj = obj;
var curLeft = curTop = 0;

curLeft += curObj.offsetLeft
curTop += curObj.offsetTop;

while (curObj.offsetParent != null) 
{
    curObj = curObj.offsetParent;               
    curLeft += curObj.offsetLeft
    curTop += curObj.offsetTop;
}
obj.x = curLeft;
obj.y = curTop;
} 
```

如果页面是顶部，这很好用，但问题是如果页面是从 iFrame 内运行的，我不知道页面上 iFrame 的偏移量。

无论页面是否在 iFrame 中，有没有办法获得准确的绝对坐标？

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T17:25:23.167

我使用[JQuery 维度](http://plugins.jquery.com/project/dimensions)来做到这一点。它可以很好地遍历 DOM 并为您添加所有偏移量。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T18:10:42.853

尝试使用 Dojo 或 JQuery 等 JavaScript 框架。它们具有所有这些基本功能，并且可以在现代浏览器中始终如一地工作。

在道场：

```
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.3/dojo/dojo.xd.js"></script>
// box is an oject {l, t, w, h, x, y}
// (x,y) are the absolute coordinates
// (l,t) are the left and top offsets relative to the parent container
box = dojo.coords(aDomObj); 
```

有关详细信息，请参阅[http://docs.dojocampus.org/dojo/coords](http://docs.dojocampus.org/dojo/coords)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T20:24:15.420

好吧，如果对您有用，我会建议建议的 jquery 尺寸。要访问父 iframe，您需要查找 window.parent。然后，您可以通过父母递归地获得您的偏移量。

```
if (window.parent && window.parent.frames && window.parent.document && window.parent.document.getElementsByTagName) {
    var iframes = window.parent.document.getElementsByTagName("IFRAME");
    for (var i = 0; i < iframes.length; i++) {
        var id = iframes[i].id || iframes[i].name || i;
        if (window.parent.frames[id] == window) {
            //iframes[i] is your iframe in your parent.
        }
    }
} 
```

我正在使用这种技术来识别jQueryUI 的[FrameDialog](http://plugins.jquery.com/project/jquery-framedialog)插件中的框架。

# vb.net - x=x+1 与 x +=1

> ID：808062
> 
> 赞同：32
> 
> 时间：2009-04-30T17:15:39.430
> 
> 标签：vb.net, performance, operators

我的印象是这两个命令导致相同的结果，即将 X 增加 1，但后者可能更有效。

如果这不正确，请解释差异。

如果是正确的，为什么后者应该更有效率？他们不应该都编译成同一个IL吗？

谢谢。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2009-04-30T17:25:52.400

来自[+= 的 MSDN 库](http://msdn.microsoft.com/en-us/library/f6z5yhhs.aspx)：

> 使用此运算符与指定 result = result + expression 几乎相同，只是 result 只计算一次。

所以它们并不相同，这就是为什么 x += 1 会更有效。

**更新：**我刚刚注意到我的 MSDN Library 链接指向 JScript 页面而不是[VB 页面](http://msdn.microsoft.com/en-us/library/s7s8d7f4.aspx)，它不包含相同的引用。

因此，经过进一步的研究和测试，该答案不适用于 VB.NET。我错了。这是一个示例控制台应用程序：

```
Module Module1

Sub Main()
    Dim x = 0
    Console.WriteLine(PlusEqual1(x))
    Console.WriteLine(Add1(x))
    Console.WriteLine(PlusEqual2(x))
    Console.WriteLine(Add2(x))
    Console.ReadLine()
End Sub

Public Function PlusEqual1(ByVal x As Integer) As Integer
    x += 1
    Return x
End Function

Public Function Add1(ByVal x As Integer) As Integer
    x = x + 1
    Return x
End Function

Public Function PlusEqual2(ByVal x As Integer) As Integer
    x += 2
    Return x
End Function

Public Function Add2(ByVal x As Integer) As Integer
    x = x + 2
    Return x
End Function

End Module 
```

PlusEqual1 和 Add1 的 IL 确实是相同的：

```
.method public static int32 Add1(int32 x) cil managed
{
.maxstack 2
.locals init (
    [0] int32 Add1)
L_0000: nop 
L_0001: ldarg.0 
L_0002: ldc.i4.1 
L_0003: add.ovf 
L_0004: starg.s x
L_0006: ldarg.0 
L_0007: stloc.0 
L_0008: br.s L_000a
L_000a: ldloc.0 
L_000b: ret 
} 
```

PlusEqual2 和 Add2 的 IL 也几乎相同：

```
.method public static int32 Add2(int32 x) cil managed
{ 
.maxstack 2
.locals init (
    [0] int32 Add2)
L_0000: nop 
L_0001: ldarg.0 
L_0002: ldc.i4.2 
L_0003: add.ovf 
L_0004: starg.s x
L_0006: ldarg.0 
L_0007: stloc.0 
L_0008: br.s L_000a
L_000a: ldloc.0 
L_000b: ret 
} 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-30T17:29:29.990

我写了一个简单的控制台应用程序：

```
static void Main(string[] args)
{
    int i = 0;
    i += 1;
    i = i + 1;
    Console.WriteLine(i);
} 
```

我使用 Reflector 对其进行了拆卸，这就是我得到的：

```
private static void Main(string[] args)
{
    int i = 0;
    i++;
    i++;
    Console.WriteLine(i);
} 
```

他们是一样的。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-04-30T17:17:58.613

它们编译成相同的，第二个更容易输入。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-04-30T17:17:32.467

### 重要的：

`+=`在一般语言中，指定评估的答案在做什么方面肯定是正确的。但是在 VB.NET 中，我假设`X`在 OP 中指定的是一个变量或一个属性。

* * *

它们可能会编译为相同的 IL。

### 更新（以解决可能存在的争议）：

VB.NET 是一种编程语言规范。任何符合规范中定义的编译器都可以是 VB.NET 实现。如果您编辑 MS VB.NET 编译器的源代码以生成用于`X += 1`案例的蹩脚代码，您仍然会符合 VB.NET 规范（因为它没有说明它将如何工作。它只是说明了效果将完全相同，这使得生成相同的代码是合乎逻辑的，确实）。

虽然编译器很可能（我觉得确实如此）为两者生成相同的代码，但它是一个相当复杂的软件。哎呀，当相同的代码被编译两次时，你甚至不能保证编译器生成完全相同的代码！

您可以 100% 确定地说（除非您非常了解编译器的源代码）是一个好的编译器应该生成*相同的代码，性能方面*，这可能是也可能不是*完全相同的代码*。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-30T18:03:13.323

这么多猜测！即使是反射器的结论也不一定正确，因为它可以在拆卸时进行优化。

那么为什么你们没有人只看一下 IL 代码呢？看看下面的 C# 程序：

```
static void Main(string[] args)
{
    int x = 2;
    int y = 3;
    x += 1;
    y = y + 1;
    Console.WriteLine(x);
    Console.WriteLine(y);
} 
```

此代码段编译为：

`.method private hidebysig static void Main(string[] args) cil managed`
`{`
`.entrypoint`
`// Code size 25 (0x19)`
`.maxstack 2`
`.locals init ([0] int32 x,`
`[1] int32 y)`
`// some commands omitted here`

`IL_0004: ldloc.0`
`IL_0005: ldc.i4.1`
`IL_0006: add`
`IL_0007: stloc.0`

`IL_0008: ldloc.1`
`IL_0009: ldc.i4.1`
`IL_000a: add`
`IL_000b: stloc.1`

`// some commands omitted here`
`}`

正如你所看到的，它实际上是完全一样的。为什么会这样？因为 IL 的目的是告诉我们该做什么，而不是如何去做。优化将是 JIT 编译器的工作。顺便说一句，在 VB.Net 中是一样的

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-30T17:24:25.837

在 x86 上，如果 x 在寄存器 eax 中，它们都会导致类似

公司；

所以你是对的，经过一些编译阶段，IL 将是相同的。

有一整类这样的问题可以用“相信你的优化器”来回答。

著名的神话是
x++；
效率低于
++x；
因为它必须存储一个临时值。如果您从不使用临时值，优化器将删除该存储。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-30T17:18:27.333

它们在 VB 中可能相同；它们在 C 中不一定相同（运算符来自哪里）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-30T17:18:40.420

1.  是的，它们的行为相同。
2.  不，它们可能同样有效。优化器擅长这类事情。如果您想仔细检查，请编写优化代码并在反射器中查看。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-30T17:19:08.330

如果 x 是像 int 或 float 这样的简单类型，优化器可能会产生相同的结果。

如果您使用其他语言（此处的 VB 知识有限，您可以重载 += 吗？）其中 x 可能是一个大喇叭对象，前者会创建和额外的副本，可能是数百兆。后者没有。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-30T17:20:51.197

是相同的。

```
x=x+1 
```

数学被认为是矛盾的，而

```
x+=1 
```

不是而且很容易打字。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-30T18:56:18.767

在 C++ 中，它取决于**x**是什么数据类型以及如何定义运算符。如果**x**是某个类的实例，您可以获得完全不同的结果。

或者也许你应该解决这个问题并指定**x**是一个整数或其他什么。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-30T18:57:00.247

我认为差异是由于用于内存引用的额外时钟周期，但结果我错了！我自己无法理解这件事

```
instruction type        example                      cycles 
```

==================================================== ==================

```
ADD reg,reg             add ax,bx                       1
ADD mem,reg             add total, cx                   3
ADD reg,mem             add cx,incr                     2
ADD reg,immed           add bx,6                        1
ADD mem,immed           add pointers[bx][si],6          3
ADD accum,immed         add ax,10                       1

INC reg                 inc bx                          1
INC mem                 inc vpage                       3

MOV reg,reg             mov bp,sp                       1
MOV mem,reg             mov array[di],bx                1
MOV reg,mem             mov bx,pointer                  1
MOV mem,immed           mov [bx],15                     1
MOV reg,immed           mov cx,256                      1
MOV mem,accum           mov total,ax                    1
MOV accum,mem           mov al,string                   1
MOV segreg,reg16        mov ds,ax                       2, 3
MOV segreg,mem16        mov es,psp                      2, 3
MOV reg16,segreg        mov ax,ds                       1
MOV mem16,segreg        mov stack_save,ss               1
MOV reg32,controlreg    mov eax,cr0                     22
                        mov eax,cr2                     12
                        mov eax,cr3                     21, 46
                        mov eax,cr4                     14
MOV controlreg,reg32    mov cr0,eax                     4
MOV reg32,debugreg      mov edx,dr0                     DR0-DR3,DR6,DR7=11;
                                                        DR4,DR5=12 
MOV debugreg,reg32      mov dr0,ecx                     DR0-DR3,DR6,DR7=11;
                                                        DR4,DR5=12 
```

来源：[http ://turkish_rational.tripod.com/trdos/pentium.txt](http://turkish_rational.tripod.com/trdos/pentium.txt)

指令可以翻译为：

```
;for i = i+1   ; cycles
mov  ax,   [i]  ; 1
add  ax,   1    ; 1
mov  [i],  ax   ; 1

;for i += 1
; dunno the syntax of instruction. it should be the pointers one :S     

;for i++
inc  i          ; 3
;or
mov  ax,   [i]  ; 1
inc  ax         ; 1
mov  [i],  ax   ; 1

;for ++i
mov  ax,   [i]  ; 1
;do  stuff      ; matters not
inc  ax         ; 1
mov  [i],  ax   ; 1 
```

结果都是一样的：S它只是一些可能有用的数据。请给出意见！

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-05-01T06:38:34.897

值得注意的是 +=、-=、*= 等进行了隐式转换。

```
int i = 0;
i = i + 5.5; // doesn't compile.
i += 5.5; // compiles. 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-30T17:18:18.893

在运行时（至少使用 PERL）没有区别。x+=1 比 x = x+1 快大约 0.5 秒

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-30T17:20:24.660

程序效率没有区别；只是打字效率。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-30T17:24:43.853

早在 1980 年代初期，Lattice C 编译器的一项非常酷的优化就是“x = x + 1;”、“x += 1;” 和“x++;” 都产生了完全相同的机器代码。如果他们可以做到，那么这个千年编写的编译器肯定可以做到。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-05-01T11:51:46.767

如果 x 是一个简单的整数标量变量，它们应该是相同的。

如果 x 是一个大表达式，可能有副作用，`+=1`并且`++`应该快两倍。

许多人专注于这种低级优化，好像这就是优化的全部内容。我假设你知道这是一个更大的主题。

# c# - 如何在另一个内部调用 DataList 的 ondeletecommand

> ID：808067
> 
> 赞同：1
> 
> 时间：2009-04-30T17:16:39.007
> 
> 标签：c#, asp.net

我在更新面板中有一个包含用户控件的数据列表，这些用户控件中的任何一个都可能包含一个数据列表。我正在尝试触发内部数据列表的 ondeletecommand，但没有任何反应。任何线索

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T19:36:56.063

您是否在包含数据列表的用户控件中挂钩 OnDeleteCommand？每个容器都会触发各自的事件

# vba - 分页符之间没有悬空的词标题？

> ID：808068
> 
> 赞同：0
> 
> 时间：2009-04-30T17:16:49.910
> 
> 标签：vba, ms-word

有没有人有一个好的 VBA 方式（或者可能有我找不到的 MS Word 设置）来确保 Word 标题不会在页面末尾晃来晃去。

例如，假设左边的数字是页码。

```
1 这是页面的倒数第二行。
1 标题 1
2 本文从第二页开始

```

我想要做的是自动将标题 1 向下移动，以便：

```
1 这是页面的倒数第二行。
1  
2 标题 1
2 本文从第二页开始

```

我熟悉这个问题： [Getting the headings from a Word document](https://stackoverflow.com/questions/274814/getting-the-headings-from-a-word-document)

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T17:51:47.470

您描述的悬空标题场景似乎仅在手动设置字体并且样式最初保留为正常时发生。

如果将标题上的样式设置为标题 1、2 或 3，它将防止标题单独留在页面底部。

如果您决定更改文档以使用基于样式的标题，您将需要更改样式和格式窗口中的标题样式。
要打开该窗口，请执行以下任一操作：

*   单击`Styles and Formatting`工具栏上的按钮（字体选择器左侧的“A”按钮），或
*   `Format > Styles and Formatting...`通过菜单选项打开它。

然后，您可以将鼠标悬停在可用样式上，选择下拉箭头，单击`Modify...`，然后根据自己的喜好更改样式。

（使用 Word 2003 测试。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T00:53:36.143

您想要“继续下一个”（段落格式 > 换行符和分页符选项卡）。

可能还感兴趣：寡妇/孤儿控制

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-05-11T13:06:35.597

有一种方法。定义样式时，请务必为 .ParagraphFormat.KeepTogheter 或 .ParagraphFormat.KeepWithNext 设置 TRUE

# ruby - Ruby：如何使用符号来表示数组中的事物？

> ID：808069
> 
> 赞同：1
> 
> 时间：2009-04-30T17:16:51.143
> 
> 标签：ruby, arrays, idioms

我有一个如下所示的数组数组：

```
fruits_and_calories = [
  ["apple", 100],
  ["banana", 200],
  ["kumquat", 225],
  ["orange", 90]
] 
```

我还有一个要在数组的每个元素上调用的方法：

```
fruits_and_calories.each do |f| eat(f[0], f[1]) 
```

我真的很想能够说类似的话：

```
fruits_and_calories.each do |f| eat(f[:name], f[:calories]) 
```

有没有一种方法可以在不必更改数组中的每个项目的情况下完成此操作（例如，通过迭代它并以某种方式添加符号）？或者，如果这太难了，有没有更好的选择？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-30T17:39:48.700

最好的答案是根本不使用数组，而是使用哈希：

```
fruits_and_calories = { :apple => 100,
                        :banana => 200,
                        :kumquat => 225,
                        :orange => 90}
fruits_and_calories.each do |name, calories| 
  eat(name, calories)
end 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-30T18:16:23.200

完全不改变数据结构，你可以改变块参数来达到同样的效果：

```
fruits_and_calories.each  do |name, calories|  eat(name, calories);  end 
```

这是因为 Ruby 会自动将内部数组（["apple", 100] 等）扩展到块的参数列表中（'do |name,calories| ... end'）。这是 Ruby 从 Lisp 继承的一个技巧，称为“解构参数”。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-30T18:08:11.970

Pesto 的答案（使用哈希）是一个很好的答案，但我想我更喜欢使用 Struct。

```
Fruit = Struct.new(:name, :calories)

fruits = [
  Fruit.new("apple", 100),
  Fruit.new("banana", 200),
  Fruit.new("kumquat", 225),
  Fruit.new("orange", 90)
]

fruits.each {|f| eat(f.name, f.calories)} 
```

这也有助于`eat`从名称和卡路里转变为以水果为例：

```
fruits.each {|f| eat(f)} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T17:25:12.853

数组总是由数字索引，所以据我所知，使用标准数组是不可能的。

就个人而言，我只是选择在代码上方使用注释来暗示 f[0] 和 f[1] 代表什么。

但是，如果您一心想这样做，我猜想在 Array 类上进行一些鸭式打字是可行的：

```
 class Array
  def name ; self[0] ; end
  def calories ; self[1] ; end
end

# then call it with:
fruits_and_calories.each {|f| eat(f.name, f.calories) } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T17:30:33.013

有什么理由它本身*必须*是一个数组吗？这似乎是一个哈希，或者一个水果类。

# lotus-notes - Lotus Notes 文本字段的最大字符数是多少？

> ID：808072
> 
> 赞同：1
> 
> 时间：2009-04-30T17:17:32.640
> 
> 标签：lotus-notes

Lotus Notes 文本字段的最大字符数是多少？在 Lotus Notes 客户端中，我遇到了 32K 错误。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-09-02T16:12:38.147

Lotus Notes 和 Domino 中的文本字段没有 254 个字符的“默认限制”。很小的限制仅在少数情况下发挥作用，例如从 notes.ini 或 ACL 条目写入或读取的字符串的大小。

根据 IBM 在 Domino Designer 8.5.x 帮助文件中的回答是，文本字段的限制为 32k 字节。但是，Notes 8.5.x C API 帮助文件声明项目的最大大小为 64k 字节，但如果设置了摘要标志，则最大大小为 32k。在视图列中使用的文本字段需要汇总标志，并且 Notes 表单始终假定已设置该标志。您必须使用 LotusScript 或 Java 或 Notes C API 代码来处理非摘要项目。

有两件事使这变得复杂：1）如果文档中存储了其他摘要项，则每个摘要文本项都在与所有其他摘要项竞争摘要缓冲区中的空间（这是视图数据的来源），并且该限制也是32k。2) 旧版本的 Lotus Notes 和 Domino 对摘要缓冲区有 15k 的限制，但我不清楚它是否只是 Notes 和 Domino 软件版本，还是 NSF 文件的磁盘存储 (ODS) 版本这会影响汇总缓冲区的大小。

因此，最好的信息是您可以拥有一个高达 64k 的计算显示文本字段，并且您可能能够拥有一个高达 64k 的存储非摘要文本字段，但如果它是一个普通的摘要文本字段限制为 15k 或 32k，具体取决于软件版本，也可能取决于 ODS。

请记住，LMBCS 字符可能是多字节的，因此 32k 限制并不一定意味着 32k 字符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-24T16:18:26.077

根据您尝试执行的操作，您可以使用没有 32k 大小限制的 Notes 富文本字段。因此，您可以使用此“富文本”字段仅存储文本 - 这实际上是完成将 .isSummary 属性设置为 false，但不需要您添加任何脚本代码。富文本字段不能在视图中呈现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T09:41:40.980

它比这更复杂一些 - 根据版本，您可以通过使用 Lotusscript QuerySave 事件为字段设置 NotesItem 的 .isSummary 属性将文本字段的大小增加到 32K，但这意味着您无法显示视图中的字段数据。

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2009-04-30T17:41:21.350

文本字段的默认最大长度为 254 个字符。文本字段允许的最大长度为 15,360 个字符。

# ruby-on-rails - 如何在 Windows 上运行 Rails“脚本/[xyz]”命令？

> ID：808081
> 
> 赞同：2
> 
> 时间：2009-04-30T17:18:34.167
> 
> 标签：ruby-on-rails, windows, ruby

我习惯于在 Mac 上进行 Rails 开发工作。但是，现在其他开发人员将与我一起工作，他们使用 Windows，XP 和 Vista。我正在尝试找出 Windows 环境，以便我可以帮助他们。

在 OS X 和 Linux 中，你有这种东西......

```
$ cd [Rails project root]
$ script/console 
```

在 Windows 上尝试过，但我得到的只是“'脚本'不被识别为内部或外部命令......等等。”

什么是 Windows 等价物？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-30T17:21:11.600

```
ruby script/whatever 
```

那应该为你做。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-30T17:37:12.280

进入你的 rails 目录，然后输入：

```
ruby script/(your command) 
```

确保您的路径上有 ruby​​ 的路径 - 否则您需要执行以下操作：

```
(path to ruby)/ruby script/(your command) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T17:21:17.217

做：

```
c:\railsproject\> ruby script/console 
```

为你工作？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T17:21:55.110

您是否尝试过发出 ruby​​ script\console ？（Windows 使用反斜杠作为路径分隔符而不是前斜杠，并且不支持 shebang 语法。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T17:21:57.980

rails path/to/your/new/application

cd path/to/your/new/application

红宝石脚本/服务器

看看这个：[http ://rubyonrails.org/download](http://rubyonrails.org/download)

# ant - JUnit Ant 任务可以报告忽略的测试吗？

> ID：808083
> 
> 赞同：5
> 
> 时间：2009-04-30T17:19:02.947
> 
> 标签：ant, junit

我们目前使用 JUnit 4.4 和 Ant 1.7.1 进行构建。我有一些测试用例是`@Ignore`d。当我在 Eclipse 中运行它们时，JUnit 测试运行器将它们报告为已忽略。我希望看到它们在 Ant 的 XML 输出中列出（以便我可以报告它们），但它们似乎不存在。

有人有这个工作吗？有开关可以打开它们吗？我需要升级吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T17:34:47.200

看起来这是一个已知的[Ant 问题/错误](https://issues.apache.org/bugzilla/show_bug.cgi?id=43969)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-09T14:32:35.480

该线程讨论了同样的问题，但它提供了一些额外的信息：当使用 maven surefire 运行测试时，您可以获得忽略测试的数据，并且 hudson 能够显示该数据。

[http://jenkins.361315.n4.nabble.com/Is-it-possible-to-show-Ignore-JUnit-tests-td1565288.html](http://jenkins.361315.n4.nabble.com/Is-it-possible-to-show-Ignore-JUnit-tests-td1565288.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-06T08:31:32.687

[此问题](https://issues.apache.org/bugzilla/show_bug.cgi?id=43969)的修复现已应用于 Ant 核心的负责人，计划作为即将发布的 Ant 1.9.0 版本的一部分发布。

应该可以在本地尝试此修复，将 Ant 发行版的 lib 目录中的 ant-junit.jar 替换为[nightly builds](https://builds.apache.org/view/A-F/view/Ant//job/Ant_Nightly/lastBuild/artifact/trunk/distribution/binaries/)中的版本，或者运行完整的 nightly Ant 发行版，或者直接构建 Ant 源代码。由于 Ant 团队目前正在对准备新版本进行投票，因此可能值得等待 1.9.0 正式打包并推出下载。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-21T16:03:26.117

刚刚用 JUnit 4.11 尝试了 Ant 1.9.0。如果您使用`<junit printsummary="on">`，您将获得如下输出：

```
[junit] Running com.example.IgnoredTest
[junit] Tests run: 1, Failures: 0, Errors: 0, Skipped: 1, Time elapsed: 0.01

[junit] Running com.example.PassingTest
[junit] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.01

[junit] Running com.example.FailingTest
[junit] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.01 
```

我认为如果我们可以通过以下方式获得这样的输出会更好`printsummary=off`：

```
[junit] Test com.example.IgnoredTest SKIPPED
[junit] Test com.example.FailingTest FAILED 
```

但似乎上面更详细的输出是我们能做的最好的，除非我错过了[junit 任务参数](http://ant.apache.org/manual/Tasks/junit.html)之一的一些晦涩的技巧。

# compiler-construction - 如何在 win 和 *nix 中判断二进制文件是发布还是调试

> ID：808100
> 
> 赞同：35
> 
> 时间：2009-04-30T17:23:07.120
> 
> 标签：compiler-construction, debugging, release

是否有一个简单的命令行实用程序来检查可执行文件和动态库等二进制文件，以判断它们是发布版本还是调试版本？*nix 或 windows 上有类似的东西吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2011-03-16T18:38:04.360

*   对于**Linux**上的 C++ ，您可以执行以下操作：

    > ```
    >  objdump --source yourbin |grep printf 
    > ```

    将 printf 替换为您执行的任何函数调用。如果是调试，它将显示您执行的所有实际源代码调用。如果是release，它只会显示符号表中创建的符号。

*   对于**Windows**上的 C++ ，您可以使用 depends.exe 并查看它是否依赖于 MSVCRT（发布）或 MSVCRTD（调试）

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-30T17:33:17.623

在 linux 上，您甚至可以对动态库使用“文件”命令。如果它说“已剥离”，则所有调试符号都将被剥离。如果它说“未剥离”，则相反

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T17:33:36.000

对于 Windows，[Dependency Walker](http://www.dependencywalker.com/)具有可选的命令行输出，列出了 exe 加载的每个 dll（及其依赖项）。通过 grep 运行它，看看 msvcrt-dll 是否弹出广告。

这仅在动态链接时才有效。否则可能会更棘手。

*如果*这些字符串在可执行文件中可见，您也许可以对调试/发布中不同的某些函数进行 grep 。

如果您的应用程序根本不使用运行时，那将非常棘手。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T17:43:06.400

*对于 unix：*使用 ELF 可执行文件，您可以使用**objdump**或**nm**来查看可执行文件的符号表（请注意，如果不剥离它会更好地工作）。某些符号的存在或不存在将倾向于指示调试或发布版本。（至于哪个，这可能取决于您使用的库等。您必须进行一些挖掘才能找到常见的库；请随时在评论中提出要查找的内容，我会更新回答。）

*对于 Windows：* dependencywalker 建议很好。对于命令行等效项，您可以在大多数 Visual Studio 安装中找到**dumpbin**，它在某种程度上等同于 *nix 上的 objdump。您还可以在例如 msys 或 cygwin 中找到适用于某些 windows exe 文件的 nm 或 objdump。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-30T17:34:19.447

没有太多事情要做。如果您在 Reflector 中打开一个程序集，您可以查找该程序集属性：

```
[assembly: Debuggable(DebuggableAttribute.DebuggingModes.DisableOptimizations | DebuggableAttribute.DebuggingModes.EnableEditAndContinue | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.Default)] 
```

但显然这也被添加到发布模式中。

如果它是您自己的程序集，那么解决方案是使用一些预处理器指令。

```
#ifdef DEBUG
[MyAttribute("foo")]
#endif 
```

编辑：对不起，我假设.NET。我的锤子来了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-30T17:39:46.423

大多数情况下，可执行文件和库的调试版本都与运行时的调试版本相关联。在 Windows 上，有一些遵循的调试/发布版本的名称方案，其中包括 MS。库的调试版本的名称应以 d 结尾。您可以使用 Dependency Walker ( [http://www.dependencywalker.com](http://www.dependencywalker.com) ) 之类的工具来查看可执行文件或库所依赖的库。如果您发现运行时库的调试版本，则很有可能您的可执行文件或库是在调试模式下构建的。

但是，这仅在以下情况下才有效

*   您可以通过查看运行时的名称来判断它是哪个版本（它遵循一些命名方案，就像我上面描述的那样）
*   您的可执行文件/库链接到动态运行时而不是静态运行时。在第二种情况下，运行时被拉入可执行文件/库，它不再是依赖项
*   你在 Windows 上:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-04-18T07:05:53.013

Use depends.exe to find out which version it is. when You open the file through depends walker it will show file which are needed. By seeing the list of system32 files you can it whether it is debug or release

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-11-03T13:55:15.947

您可以使用 filever.exe。

```
filever.exe <my binary file>
--a-- W32i   APP   -         1.0.0.0 shp     25,600 11-03-2013 <my file> 
```

要获得filever，您可以下载windows xp 的支持工具。

如果您移动到 ​​Windows 7 或更高版本（像大多数 Windows 用户一样），您可以下载它，通过 winzip 打开它。

然后从 support.cab 中提取 filever。

它适用于 Windows 7 就好了。

# asp.net - TreeView 操作，保存添加等

> ID：808101
> 
> 赞同：2
> 
> 时间：2009-04-30T17:23:38.693
> 
> 标签：asp.net, treeview, viewstate

这是我想要做的。我有一个 TreeView 服务器端控件（asp.net 2.0），我需要用户能够向其中添加节点，然后在添加所有所需节点之后，数据应保存到数据库中。

以下是我想注意的一些事项：

1）我不想在每次添加新节点时保存树数据，而是将数据保持在会话中，直到用户决定保存整个树。这里的问题是：我可以将树绑定到 ArrayList 对象并将该对象保留在会话中（而不是将整个树保留在会话中）吗？然后每次添加节点时，我都必须将树重新绑定到 ArrayList 而不是数据库。

2) 我希望最小化 ViewState，有什么提示吗？什么最有效：压缩视图状态或始终将其全部保存在服务器上？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-02-21T09:09:23.420

使用 TreeNodeCollection 作为内部数组以保存在 ViewState 或 Session 中。这是您可以使用的方法的粗略模型；远非完美，但应该让你走上正确的轨道。

```
TreeView tv = new TreeView();
    // Button click event for 'Add Node' button
    protected void AddNode(object sender, EventArgs e)
    {
        if (SaveNodeToDb(txtNewNode.Text, txtNavUrl.Text))
        {
            // Store user input details for new node in Session
            Nodes.Add(new TreeNode() { Text = txtNewNode.Text, NavigateUrl = txtNavUrl.Text });
            // Clear and re-add
            tv.Nodes.Clear();
            foreach (TreeNode n in Nodes)
                tv.Nodes.Add(n);
        }

    }

    public bool SaveNodeToDb(string name, string url)
    {
        // DB save action here.
    }

    public TreeNodeCollection Nodes
    {
        get
        {
            if (Session["UserNodes"] ! = null)
                return (TreeNodeCollection) Session["UserNodes"];
            else
                return new TreeNodeCollection();
        }
        set
        {
            Session["UserNodes"] = value;
        }
    } 
```

# c# - C# 中的工程符号？

> ID：808104
> 
> 赞同：13
> 
> 时间：2009-04-30T17:24:21.170
> 
> 标签：c#, string

是否有任何代码（或内置函数）允许以工程符号输出浮点数？

例如，`1.5e-4`将显示为`150µ`，而 5e-3 将显示为`5m`。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-30T18:07:20.147

这可能需要重构：

```
private static string ToEngineeringNotation(this double d)
{
    double exponent = Math.Log10(Math.Abs(d));
    if (Math.Abs(d) >= 1)
    {
        switch ((int)Math.Floor(exponent))
        {
            case 0: case 1: case 2:
                return d.ToString();
            case 3: case 4: case 5:
                return (d / 1e3).ToString() + "k";
            case 6: case 7: case 8:
                return (d / 1e6).ToString() + "M";
            case 9: case 10: case 11:
                return (d / 1e9).ToString() + "G";
            case 12: case 13: case 14:
                return (d / 1e12).ToString() + "T";
            case 15: case 16: case 17:
                return (d / 1e15).ToString() + "P";
            case 18: case 19: case 20:
                return (d / 1e18).ToString() + "E";
            case 21: case 22: case 23:
                return (d / 1e21).ToString() + "Z";
            default:
                return (d / 1e24).ToString() + "Y";
        }
    }
    else if (Math.Abs(d) > 0)
    {
        switch ((int)Math.Floor(exponent))
        {
            case -1: case -2: case -3:
                return (d * 1e3).ToString() + "m";
            case -4: case -5: case -6:
                return (d * 1e6).ToString() + "μ";
            case -7: case -8: case -9:
                return (d * 1e9).ToString() + "n";
            case -10: case -11: case -12:
                return (d * 1e12).ToString() + "p";
            case -13: case -14: case -15:
                return (d * 1e15).ToString() + "f";
            case -16: case -17: case -18:
                return (d * 1e15).ToString() + "a";
            case -19: case -20: case -21:
                return (d * 1e15).ToString() + "z";
            default:
                return (d * 1e15).ToString() + "y";
        }
    }
    else
    {
        return "0";
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-30T17:49:39.207

这是一些 Ruby 代码的[链接，它执行类似的操作，尽管它的格式为 dddem，其中 m，指数，始终是 3 的倍数。](http://snippets.dzone.com/posts/show/595)

音译为 C#。由于我不熟悉格式，我不确定这是否完全符合您的要求。例如，0.0015 格式为 2e-3。使用 case 语句和 UTF-8 或其他编码将指数替换为希腊字母是相当简单的。练习留给读者。

```
public static class FormatExtensions
{
    public static string ToEngineering( this double value )
    {
        int exp = (int)(Math.Floor( Math.Log10( value ) / 3.0 ) * 3.0);
        double newValue = value * Math.Pow(10.0,-exp);
        if (newValue >= 1000.0) {
            newValue = newValue / 1000.0;
            exp = exp + 3;
        }
        return string.Format( "{0:##0}e{1}", newValue, exp);        
    }
} 
```

用法：

```
Console.WriteLine( ((double)15000).ToEngineering() );
double val = 15000;
Console.WriteLine( val.ToEngineering() ); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-30T19:12:26.670

而不是子类化，我会利用 Double 实现 IFormattable 并编写一个格式化数字的 IFormatProvider 的事实。然后我的代码看起来类似于：

```
double d = 123.45;
Console.WriteLine(d.ToString(null, new MyCustomFormat())); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-12-18T15:18:02.267

这是另一个处理负数且不四舍五入的版本

```
public static string ToEngineering(this double value)
{
    var absValue = Math.Abs(value);
    var exp = absValue < 0.001 ? 0 : (int)(Math.Floor(Math.Log10(absValue) / 3.0) * 3.0);
    var newValue = value * Math.Pow(10.0, -exp);
    return $"{newValue}e{exp}";
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-11-09T11:50:58.727

结合两个较早的答案并添加一个单位（伏特等）给出了很好的整洁答案，例如 11000 伏特作为 11kV。

```
public static string ToEngineering(this double value, string unitName)
{
    int exp = (int)(Math.Floor(Math.Log10(value) / 3.0) * 3.0);
    double newValue = value * Math.Pow(10.0, -exp);
    if (newValue >= 1000.0)
    {
        newValue = newValue / 1000.0;
        exp = exp + 3;
    }
    var symbol = String.Empty;
    switch (exp)
    {
        case 3:
            symbol = "k";
            break;
        case 6:
            symbol = "M";
            break;
        case 9:
            symbol = "G";
            break;
        case 12:
            symbol = "T";
            break;
        case -3:
            symbol = "m";
            break;
        case -6:
            symbol = "μ";
            break;
        case -9:
            symbol = "n";
            break;
        case -12:
            symbol = "p";
            break;
        }

    return string.Format("{0:##0.000} {1}{2}", newValue, symbol, unitName);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-02-05T05:48:15.223

我来这里是为了寻找一个可以采用任何数字表示的函数，例如有符号/无符号整数、浮点数、双精度、十进制、数字字符串，虽然我找到了一些灵​​感 Patrick McDonald 的答案，但我没有找到我正在寻找的完整答案，所以我编写了自己的解决方案，该解决方案采用数字字符串，可以从任何数字类型轻松获得。如果他们希望拥有更通用的东西，我将在此线程中分享我的解决方案供其他人使用：

```
public static string ToEngineeringNotation(string originalString, int? significantFigures = null)
{
  var str = originalString;

  // remove spaces and negative sign

  str.Replace(" ", "");
  string prefix = "";
  if (str[0] == '-')
  {
    str = str.Substring(1);
    prefix = "-";
  }

  // Get the exponent, remove the exponent nomenclature

  int exponent = 0;
  int exponentStrIndex = 0;
  if ((exponentStrIndex = str.IndexOfAny("Ee".ToArray())) >= 0)
  {
    string exponentStr = str.Substring(exponentStrIndex + 1);
    str = str.Substring(0, exponentStrIndex);
    Int32.TryParse(exponentStr, out exponent);
  }

  // remove the decimal point, and adjust the exponent so the decimal point
  // should go just after the first digit, and trim trailing zeros

  int currentDecimalPosition = str.IndexOf('.');
  if (currentDecimalPosition >= 0)
  {
    exponent += currentDecimalPosition-1;
    str = str.Replace(".", "");
  }
  else
  {
    exponent += str.Length - 1;
  }
  str = str.TrimEnd('0');

  // At this point we should only have digits, just return the original string if we don't

  if (!str.All(char.IsDigit))
  {
    return originalString;
  }

  // Trim leading zeros, the decimal point is effectively moved as it's
  // just after the first digit, so adjust the exponent

  int lengthBefore = str.Length;
  str = str.TrimStart('0');
  exponent += str.Length-lengthBefore;

  // Put the decimal point back in, but move the decimal point right
  // according to the shift worked out above.

  if (significantFigures.HasValue && significantFigures.Value < str.Length)
  {
    if (str.Length >= significantFigures.Value && str[significantFigures.Value] >= '5' && Int64.TryParse(str.Substring(0, significantFigures.Value), out var integerValue))
    {
      // Need to round up
      str = (integerValue + 1).ToString();
      if(str.Length> significantFigures.Value)
      {
        ++exponent;
      }
    }
    str = str.Substring(0, significantFigures.Value);
  }

  // work out how much we need to shift the decimal point to get
  // engineering notation

  var decimalShiftRequired = exponent % 3;
  if (decimalShiftRequired < 0)
    decimalShiftRequired += 3;

  if (exponent == 0)
  {
    decimalShiftRequired = 0;
  }
  str = str.PadRight(1 + decimalShiftRequired, '0');
  str = $"{str.Substring(0, 1 + decimalShiftRequired)}.{str.Substring(1 + decimalShiftRequired)}";
  exponent -= decimalShiftRequired;

  // Remove the decimal point if there are no digits after it
  str = str.TrimEnd('.');

  // Create a default suffix consisting of the exponent
  string suffix = exponent != 0 ? $"E{(exponent < 0 ? "" : "+")}{exponent}" : "";

  // Work out which letter to put on the end, if any. If no letter is found,
  // then the Exponent suffix above will be added without modification

  switch (exponent)
  {
    case 3:
      suffix = "k"; break;
    case 6:
      suffix = "M"; break;
    case 9:
      suffix = "G"; break;
    case 12:
      suffix = "T"; break;
    case 15:
      suffix = "P"; break;
    case 18:
      suffix = "E"; break;
    case 21:
      suffix = "Z"; break;
    case 24:
      suffix = "Y"; break;
    case -3:
      suffix = "m"; break;
    case -6:
      suffix = "μ"; break;
    case -9:
      suffix = "n"; break;
    case -12:
      suffix = "p"; break;
    case -15:
      suffix = "f"; break;
    case -18:
      suffix = "a"; break;
    case -21:
      suffix = "z"; break;
    case -24:
      suffix = "y"; break;
  }
  return $"{prefix}{str}{suffix}";
} 
```

这是上述函数顶部的注释块，我把它放在最后，这样人们就不必滚动它来获取代码：

```
/// <summary>
/// Converts a numeric string to Engineering Notation
/// </summary>
/// <example>
/// class Program
/// {
///   static void Main(string[] args)
///   {
///     foreach(var a in SampleNumbers)
///     {
///        var leftPad = a < 0 ? "" : " ";
///        var rightPad = a < 0 ? "--> " : "-> ";
///        var original = $"{leftPad}{a.ToString().PadRight(22)}{rightPad}";
///        var engineering = $"{leftPad}{a.ToEngineeringNotation(256).PadRight(22)}{rightPad}";
///        var engineering3Figures = $"{leftPad}{a.ToEngineeringNotation(3)}";
///        Console.WriteLine($"/// {original}{engineering}{engineering3Figures}");
///     }
///     Console.ReadLine();
///   }
///     
///   private static IEnumerable<double> SampleNumbers
///   {
///     get
///     {
///       var testValues = new[]
///       {
///         Double.NaN,
///         Double.Epsilon,
///         Double.MinValue,
///         Double.MaxValue,
///         Double.NegativeInfinity,
///         Double.PositiveInfinity,
///         -300,
///         -30,
///         -1.1,
///         -1,
///         -0.1,
///         -0.01,
///         -0.001,
///         -0.0001,
///         0,
///         0.0001,
///         0.001,
///         0.01,
///         0.1,
///         1,
///         1.1,
///         30,
///         300
///       };
///  
///       foreach (double a in testValues)
///       {
///         yield return a;
///       }
///       for (int i = 28; i >= -28; --i)
///       {
///         yield return Math.Pow(10, i) * -9.995567890123;
///         yield return Math.Pow(10, i) * -1.234567890123;
///         yield return Math.Pow(10, i) * -1.235567890123;
///       }
///       for (int i = -28; i <= 28; ++i)
///       {
///         yield return Math.Pow(10, i) * 9.995567890123;
///         yield return Math.Pow(10, i) * 1.234567890123;
///         yield return Math.Pow(10, i) * 1.235567890123;
///       }
///     }
///   }
/// }
/// Gives the following output
/// 
///  NaN                   ->  NaN                   ->  NaN
///  5E-324                ->  5E-324                ->  5E-324
/// -1.7976931348623157E+308--> -179.76931348623157E+306--> -180E+306
///  1.7976931348623157E+308->  179.76931348623157E+306->  180E+306
/// -8                    --> -8                    --> -8
///  8                     ->  8                     ->  8
/// -300                  --> -300                  --> -300
/// -30                   --> -30                   --> -30
/// -1.1                  --> -1.1                  --> -1.1
/// -1                    --> -1                    --> -1
/// -0.1                  --> -100m                 --> -100m
/// -0.01                 --> -10m                  --> -10m
/// -0.001                --> -1m                   --> -1m
/// -0.0001               --> -100µ                 --> -100µ
///  0                     ->  0                     ->  0
///  0.0001                ->  100µ                  ->  100µ
///  0.001                 ->  1m                    ->  1m
///  0.01                  ->  10m                   ->  10m
///  0.1                   ->  100m                  ->  100m
///  1                     ->  1                     ->  1
///  1.1                   ->  1.1                   ->  1.1
///  30                    ->  30                    ->  30
///  300                   ->  300                   ->  300
/// -9.995567890123E+28   --> -99.95567890123E+27   --> -100E+27
/// -1.2345678901229999E+28--> -12.345678901229999E+27--> -12.3E+27
/// -1.235567890123E+28   --> -12.35567890123E+27   --> -12.4E+27
/// -9.995567890123E+27   --> -9.995567890123E+27   --> -10.0E+27
/// -1.234567890123E+27   --> -1.234567890123E+27   --> -1.23E+27
/// -1.2355678901230001E+27--> -1.2355678901230001E+27--> -1.24E+27
/// -9.995567890123001E+26--> -999.5567890123001Y   --> -1.00E+27
/// -1.234567890123E+26   --> -123.4567890123Y      --> -123Y
/// -1.2355678901230002E+26--> -123.55678901230002Y  --> -124Y
/// -9.995567890123001E+25--> -99.95567890123001Y   --> -100Y
/// -1.234567890123E+25   --> -12.34567890123Y      --> -12.3Y
/// -1.2355678901230002E+25--> -12.355678901230002Y  --> -12.4Y
/// -9.995567890123001E+24--> -9.995567890123001Y   --> -10.0Y
/// -1.234567890123E+24   --> -1.234567890123Y      --> -1.23Y
/// -1.235567890123E+24   --> -1.235567890123Y      --> -1.24Y
/// -9.995567890123001E+23--> -999.5567890123001Z   --> -1.00Y
/// -1.234567890123E+23   --> -123.4567890123Z      --> -123Z
/// -1.2355678901230002E+23--> -123.55678901230002Z  --> -124Z
/// -9.995567890123E+22   --> -99.95567890123Z      --> -100Z
/// -1.234567890123E+22   --> -12.34567890123Z      --> -12.3Z
/// -1.235567890123E+22   --> -12.35567890123Z      --> -12.4Z
/// -9.995567890123001E+21--> -9.995567890123001Z   --> -10.0Z
/// -1.2345678901229999E+21--> -1.2345678901229999Z  --> -1.23Z
/// -1.235567890123E+21   --> -1.235567890123Z      --> -1.24Z
/// -9.995567890123E+20   --> -999.5567890123E      --> -1.00Z
/// -1.2345678901229999E+20--> -123.45678901229999E  --> -123E
/// -1.235567890123E+20   --> -123.5567890123E      --> -124E
/// -9.995567890123001E+19--> -99.95567890123001E   --> -100E
/// -1.234567890123E+19   --> -12.34567890123E      --> -12.3E
/// -1.235567890123E+19   --> -12.35567890123E      --> -12.4E
/// -9.995567890123E+18   --> -9.995567890123E      --> -10.0E
/// -1.234567890123E+18   --> -1.234567890123E      --> -1.23E
/// -1.235567890123E+18   --> -1.235567890123E      --> -1.24E
/// -9.995567890123E+17   --> -999.5567890123P      --> -1.00E
/// -1.234567890123E+17   --> -123.4567890123P      --> -123P
/// -1.235567890123E+17   --> -123.5567890123P      --> -124P
/// -99955678901230000    --> -99.95567890123P      --> -100P
/// -12345678901230000    --> -12.34567890123P      --> -12.3P
/// -12355678901230000    --> -12.35567890123P      --> -12.4P
/// -9995567890123000     --> -9.995567890123P      --> -10.0P
/// -1234567890123000     --> -1.234567890123P      --> -1.23P
/// -1235567890123000     --> -1.235567890123P      --> -1.24P
/// -999556789012300      --> -999.5567890123T      --> -1.00P
/// -123456789012300      --> -123.4567890123T      --> -123T
/// -123556789012300      --> -123.5567890123T      --> -124T
/// -99955678901230       --> -99.95567890123T      --> -100T
/// -12345678901230       --> -12.34567890123T      --> -12.3T
/// -12355678901230       --> -12.35567890123T      --> -12.4T
/// -9995567890123        --> -9.995567890123T      --> -10.0T
/// -1234567890123        --> -1.234567890123T      --> -1.23T
/// -1235567890123        --> -1.235567890123T      --> -1.24T
/// -999556789012.3       --> -999.5567890123G      --> -1.00T
/// -123456789012.29999   --> -123.45678901229999G  --> -123G
/// -123556789012.3       --> -123.5567890123G      --> -124G
/// -99955678901.23001    --> -99.95567890123001G   --> -100G
/// -12345678901.23       --> -12.34567890123G      --> -12.3G
/// -12355678901.230001   --> -12.355678901230001G  --> -12.4G
/// -9995567890.123001    --> -9.995567890123001G   --> -10.0G
/// -1234567890.123       --> -1.234567890123G      --> -1.23G
/// -1235567890.1230001   --> -1.2355678901230001G  --> -1.24G
/// -999556789.0123       --> -999.5567890123M      --> -1.00G
/// -123456789.0123       --> -123.4567890123M      --> -123M
/// -123556789.0123       --> -123.5567890123M      --> -124M
/// -99955678.90123       --> -99.95567890123M      --> -100M
/// -12345678.90123       --> -12.34567890123M      --> -12.3M
/// -12355678.90123       --> -12.35567890123M      --> -12.4M
/// -9995567.890123       --> -9.995567890123M      --> -10.0M
/// -1234567.890123       --> -1.234567890123M      --> -1.23M
/// -1235567.8901230001   --> -1.2355678901230001M  --> -1.24M
/// -999556.7890123001    --> -999.5567890123001k   --> -1.00M
/// -123456.7890123       --> -123.4567890123k      --> -123k
/// -123556.78901230001   --> -123.55678901230001k  --> -124k
/// -99955.67890123       --> -99.95567890123k      --> -100k
/// -12345.67890123       --> -12.34567890123k      --> -12.3k
/// -12355.678901230001   --> -12.355678901230001k  --> -12.4k
/// -9995.567890123       --> -9.995567890123k      --> -10.0k
/// -1234.5678901229999   --> -1.2345678901229999k  --> -1.23k
/// -1235.567890123       --> -1.235567890123k      --> -1.24k
/// -999.5567890123001    --> -999.5567890123001    --> -1.00k
/// -123.45678901229999   --> -123.45678901229999   --> -123
/// -123.5567890123       --> -123.5567890123       --> -124
/// -99.95567890123       --> -99.95567890123       --> -100
/// -12.345678901229999   --> -12.345678901229999   --> -12.3
/// -12.35567890123       --> -12.35567890123       --> -12.4
/// -9.995567890123       --> -9.995567890123       --> -10.0
/// -1.234567890123       --> -1.234567890123       --> -1.23
/// -1.235567890123       --> -1.235567890123       --> -1.24
/// -0.9995567890123      --> -999.5567890123m      --> -1.00
/// -0.1234567890123      --> -123.4567890123m      --> -123m
/// -0.12355678901230001  --> -123.55678901230001m  --> -124m
/// -0.09995567890123001  --> -99.95567890123001m   --> -100m
/// -0.01234567890123     --> -12.34567890123m      --> -12.3m
/// -0.01235567890123     --> -12.35567890123m      --> -12.4m
/// -0.009995567890123    --> -9.995567890123m      --> -10.0m
/// -0.001234567890123    --> -1.234567890123m      --> -1.23m
/// -0.0012355678901230002--> -1.2355678901230002m  --> -1.24m
/// -0.0009995567890123001--> -999.5567890123001µ   --> -1.00m
/// -0.0001234567890123   --> -123.4567890123µ      --> -123µ
/// -0.0001235567890123   --> -123.5567890123µ      --> -124µ
/// -9.995567890123001E-05--> -99.95567890123001µ   --> -100µ
/// -1.234567890123E-05   --> -12.34567890123µ      --> -12.3µ
/// -1.2355678901230002E-05--> -12.355678901230002µ  --> -12.4µ
/// -9.995567890123E-06   --> -9.995567890123µ      --> -10.0µ
/// -1.234567890123E-06   --> -1.234567890123µ      --> -1.23µ
/// -1.235567890123E-06   --> -1.235567890123µ      --> -1.24µ
/// -9.995567890123E-07   --> -999.5567890123n      --> -1.00µ
/// -1.234567890123E-07   --> -123.4567890123n      --> -123n
/// -1.235567890123E-07   --> -123.5567890123n      --> -124n
/// -9.995567890123E-08   --> -99.95567890123n      --> -100n
/// -1.234567890123E-08   --> -12.34567890123n      --> -12.3n
/// -1.2355678901230001E-08--> -12.355678901230001n  --> -12.4n
/// -9.995567890123E-09   --> -9.995567890123n      --> -10.0n
/// -1.234567890123E-09   --> -1.234567890123n      --> -1.23n
/// -1.2355678901230001E-09--> -1.2355678901230001n  --> -1.24n
/// -9.995567890123E-10   --> -999.5567890123p      --> -1.00n
/// -1.234567890123E-10   --> -123.4567890123p      --> -123p
/// -1.235567890123E-10   --> -123.5567890123p      --> -124p
/// -9.995567890123E-11   --> -99.95567890123p      --> -100p
/// -1.2345678901229998E-11--> -12.345678901229998p  --> -12.3p
/// -1.235567890123E-11   --> -12.35567890123p      --> -12.4p
/// -9.995567890123E-12   --> -9.995567890123p      --> -10.0p
/// -1.2345678901229999E-12--> -1.2345678901229999p  --> -1.23p
/// -1.235567890123E-12   --> -1.235567890123p      --> -1.24p
/// -9.995567890123E-13   --> -999.5567890123f      --> -1.00p
/// -1.234567890123E-13   --> -123.4567890123f      --> -123f
/// -1.2355678901230002E-13--> -123.55678901230002f  --> -124f
/// -9.995567890123001E-14--> -99.95567890123001f   --> -100f
/// -1.2345678901229999E-14--> -12.345678901229999f  --> -12.3f
/// -1.235567890123E-14   --> -12.35567890123f      --> -12.4f
/// -9.995567890123002E-15--> -9.995567890123002f   --> -10.0f
/// -1.234567890123E-15   --> -1.234567890123f      --> -1.23f
/// -1.2355678901230002E-15--> -1.2355678901230002f  --> -1.24f
/// -9.995567890123E-16   --> -999.5567890123a      --> -1.00f
/// -1.234567890123E-16   --> -123.4567890123a      --> -123a
/// -1.2355678901230001E-16--> -123.55678901230001a  --> -124a
/// -9.995567890123001E-17--> -99.95567890123001a   --> -100a
/// -1.234567890123E-17   --> -12.34567890123a      --> -12.3a
/// -1.2355678901230001E-17--> -12.355678901230001a  --> -12.4a
/// -9.995567890123002E-18--> -9.995567890123002a   --> -10.0a
/// -1.234567890123E-18   --> -1.234567890123a      --> -1.23a
/// -1.2355678901230002E-18--> -1.2355678901230002a  --> -1.24a
/// -9.995567890123E-19   --> -999.5567890123z      --> -1.00a
/// -1.2345678901229999E-19--> -123.45678901229999z  --> -123z
/// -1.235567890123E-19   --> -123.5567890123z      --> -124z
/// -9.995567890123E-20   --> -99.95567890123z      --> -100z
/// -1.2345678901229999E-20--> -12.345678901229999z  --> -12.3z
/// -1.235567890123E-20   --> -12.35567890123z      --> -12.4z
/// -9.995567890122999E-21--> -9.995567890122999z   --> -10.0z
/// -1.2345678901229998E-21--> -1.2345678901229998z  --> -1.23z
/// -1.2355678901229999E-21--> -1.2355678901229999z  --> -1.24z
/// -9.995567890123002E-22--> -999.5567890123002y   --> -1.00z
/// -1.234567890123E-22   --> -123.4567890123y      --> -123y
/// -1.235567890123E-22   --> -123.5567890123y      --> -124y
/// -9.995567890123E-23   --> -99.95567890123y      --> -100y
/// -1.2345678901229999E-23--> -12.345678901229999y  --> -12.3y
/// -1.235567890123E-23   --> -12.35567890123y      --> -12.4y
/// -9.995567890123E-24   --> -9.995567890123y      --> -10.0y
/// -1.234567890123E-24   --> -1.234567890123y      --> -1.23y
/// -1.235567890123E-24   --> -1.235567890123y      --> -1.24y
/// -9.995567890123E-25   --> -999.5567890123E-27   --> -1.00y
/// -1.234567890123E-25   --> -123.4567890123E-27   --> -123E-27
/// -1.2355678901230002E-25--> -123.55678901230002E-27--> -124E-27
/// -9.995567890123E-26   --> -99.95567890123E-27   --> -100E-27
/// -1.234567890123E-26   --> -12.34567890123E-27   --> -12.3E-27
/// -1.2355678901230001E-26--> -12.355678901230001E-27--> -12.4E-27
/// -9.995567890123001E-27--> -9.995567890123001E-27--> -10.0E-27
/// -1.2345678901229999E-27--> -1.2345678901229999E-27--> -1.23E-27
/// -1.2355678901230001E-27--> -1.2355678901230001E-27--> -1.24E-27
/// -9.995567890123E-28   --> -999.5567890123E-30   --> -1.00E-27
/// -1.2345678901229998E-28--> -123.45678901229998E-30--> -123E-30
/// -1.235567890123E-28   --> -123.5567890123E-30   --> -124E-30
///  9.995567890123E-28    ->  999.5567890123E-30    ->  1.00E-27
///  1.2345678901229998E-28->  123.45678901229998E-30->  123E-30
///  1.235567890123E-28    ->  123.5567890123E-30    ->  124E-30
///  9.995567890123001E-27 ->  9.995567890123001E-27 ->  10.0E-27
///  1.2345678901229999E-27->  1.2345678901229999E-27->  1.23E-27
///  1.2355678901230001E-27->  1.2355678901230001E-27->  1.24E-27
///  9.995567890123E-26    ->  99.95567890123E-27    ->  100E-27
///  1.234567890123E-26    ->  12.34567890123E-27    ->  12.3E-27
///  1.2355678901230001E-26->  12.355678901230001E-27->  12.4E-27
///  9.995567890123E-25    ->  999.5567890123E-27    ->  1.00y
///  1.234567890123E-25    ->  123.4567890123E-27    ->  123E-27
///  1.2355678901230002E-25->  123.55678901230002E-27->  124E-27
///  9.995567890123E-24    ->  9.995567890123y       ->  10.0y
///  1.234567890123E-24    ->  1.234567890123y       ->  1.23y
///  1.235567890123E-24    ->  1.235567890123y       ->  1.24y
///  9.995567890123E-23    ->  99.95567890123y       ->  100y
///  1.2345678901229999E-23->  12.345678901229999y   ->  12.3y
///  1.235567890123E-23    ->  12.35567890123y       ->  12.4y
///  9.995567890123002E-22 ->  999.5567890123002y    ->  1.00z
///  1.234567890123E-22    ->  123.4567890123y       ->  123y
///  1.235567890123E-22    ->  123.5567890123y       ->  124y
///  9.995567890122999E-21 ->  9.995567890122999z    ->  10.0z
///  1.2345678901229998E-21->  1.2345678901229998z   ->  1.23z
///  1.2355678901229999E-21->  1.2355678901229999z   ->  1.24z
///  9.995567890123E-20    ->  99.95567890123z       ->  100z
///  1.2345678901229999E-20->  12.345678901229999z   ->  12.3z
///  1.235567890123E-20    ->  12.35567890123z       ->  12.4z
///  9.995567890123E-19    ->  999.5567890123z       ->  1.00a
///  1.2345678901229999E-19->  123.45678901229999z   ->  123z
///  1.235567890123E-19    ->  123.5567890123z       ->  124z
///  9.995567890123002E-18 ->  9.995567890123002a    ->  10.0a
///  1.234567890123E-18    ->  1.234567890123a       ->  1.23a
///  1.2355678901230002E-18->  1.2355678901230002a   ->  1.24a
///  9.995567890123001E-17 ->  99.95567890123001a    ->  100a
///  1.234567890123E-17    ->  12.34567890123a       ->  12.3a
///  1.2355678901230001E-17->  12.355678901230001a   ->  12.4a
///  9.995567890123E-16    ->  999.5567890123a       ->  1.00f
///  1.234567890123E-16    ->  123.4567890123a       ->  123a
///  1.2355678901230001E-16->  123.55678901230001a   ->  124a
///  9.995567890123002E-15 ->  9.995567890123002f    ->  10.0f
///  1.234567890123E-15    ->  1.234567890123f       ->  1.23f
///  1.2355678901230002E-15->  1.2355678901230002f   ->  1.24f
///  9.995567890123001E-14 ->  99.95567890123001f    ->  100f
///  1.2345678901229999E-14->  12.345678901229999f   ->  12.3f
///  1.235567890123E-14    ->  12.35567890123f       ->  12.4f
///  9.995567890123E-13    ->  999.5567890123f       ->  1.00p
///  1.234567890123E-13    ->  123.4567890123f       ->  123f
///  1.2355678901230002E-13->  123.55678901230002f   ->  124f
///  9.995567890123E-12    ->  9.995567890123p       ->  10.0p
///  1.2345678901229999E-12->  1.2345678901229999p   ->  1.23p
///  1.235567890123E-12    ->  1.235567890123p       ->  1.24p
///  9.995567890123E-11    ->  99.95567890123p       ->  100p
///  1.2345678901229998E-11->  12.345678901229998p   ->  12.3p
///  1.235567890123E-11    ->  12.35567890123p       ->  12.4p
///  9.995567890123E-10    ->  999.5567890123p       ->  1.00n
///  1.234567890123E-10    ->  123.4567890123p       ->  123p
///  1.235567890123E-10    ->  123.5567890123p       ->  124p
///  9.995567890123E-09    ->  9.995567890123n       ->  10.0n
///  1.234567890123E-09    ->  1.234567890123n       ->  1.23n
///  1.2355678901230001E-09->  1.2355678901230001n   ->  1.24n
///  9.995567890123E-08    ->  99.95567890123n       ->  100n
///  1.234567890123E-08    ->  12.34567890123n       ->  12.3n
///  1.2355678901230001E-08->  12.355678901230001n   ->  12.4n
///  9.995567890123E-07    ->  999.5567890123n       ->  1.00µ
///  1.234567890123E-07    ->  123.4567890123n       ->  123n
///  1.235567890123E-07    ->  123.5567890123n       ->  124n
///  9.995567890123E-06    ->  9.995567890123µ       ->  10.0µ
///  1.234567890123E-06    ->  1.234567890123µ       ->  1.23µ
///  1.235567890123E-06    ->  1.235567890123µ       ->  1.24µ
///  9.995567890123001E-05 ->  99.95567890123001µ    ->  100µ
///  1.234567890123E-05    ->  12.34567890123µ       ->  12.3µ
///  1.2355678901230002E-05->  12.355678901230002µ   ->  12.4µ
///  0.0009995567890123001 ->  999.5567890123001µ    ->  1.00m
///  0.0001234567890123    ->  123.4567890123µ       ->  123µ
///  0.0001235567890123    ->  123.5567890123µ       ->  124µ
///  0.009995567890123     ->  9.995567890123m       ->  10.0m
///  0.001234567890123     ->  1.234567890123m       ->  1.23m
///  0.0012355678901230002 ->  1.2355678901230002m   ->  1.24m
///  0.09995567890123001   ->  99.95567890123001m    ->  100m
///  0.01234567890123      ->  12.34567890123m       ->  12.3m
///  0.01235567890123      ->  12.35567890123m       ->  12.4m
///  0.9995567890123       ->  999.5567890123m       ->  1.00
///  0.1234567890123       ->  123.4567890123m       ->  123m
///  0.12355678901230001   ->  123.55678901230001m   ->  124m
///  9.995567890123        ->  9.995567890123        ->  10.0
///  1.234567890123        ->  1.234567890123        ->  1.23
///  1.235567890123        ->  1.235567890123        ->  1.24
///  99.95567890123        ->  99.95567890123        ->  100
///  12.345678901229999    ->  12.345678901229999    ->  12.3
///  12.35567890123        ->  12.35567890123        ->  12.4
///  999.5567890123001     ->  999.5567890123001     ->  1.00k
///  123.45678901229999    ->  123.45678901229999    ->  123
///  123.5567890123        ->  123.5567890123        ->  124
///  9995.567890123        ->  9.995567890123k       ->  10.0k
///  1234.5678901229999    ->  1.2345678901229999k   ->  1.23k
///  1235.567890123        ->  1.235567890123k       ->  1.24k
///  99955.67890123        ->  99.95567890123k       ->  100k
///  12345.67890123        ->  12.34567890123k       ->  12.3k
///  12355.678901230001    ->  12.355678901230001k   ->  12.4k
///  999556.7890123001     ->  999.5567890123001k    ->  1.00M
///  123456.7890123        ->  123.4567890123k       ->  123k
///  123556.78901230001    ->  123.55678901230001k   ->  124k
///  9995567.890123        ->  9.995567890123M       ->  10.0M
///  1234567.890123        ->  1.234567890123M       ->  1.23M
///  1235567.8901230001    ->  1.2355678901230001M   ->  1.24M
///  99955678.90123        ->  99.95567890123M       ->  100M
///  12345678.90123        ->  12.34567890123M       ->  12.3M
///  12355678.90123        ->  12.35567890123M       ->  12.4M
///  999556789.0123        ->  999.5567890123M       ->  1.00G
///  123456789.0123        ->  123.4567890123M       ->  123M
///  123556789.0123        ->  123.5567890123M       ->  124M
///  9995567890.123001     ->  9.995567890123001G    ->  10.0G
///  1234567890.123        ->  1.234567890123G       ->  1.23G
///  1235567890.1230001    ->  1.2355678901230001G   ->  1.24G
///  99955678901.23001     ->  99.95567890123001G    ->  100G
///  12345678901.23        ->  12.34567890123G       ->  12.3G
///  12355678901.230001    ->  12.355678901230001G   ->  12.4G
///  999556789012.3        ->  999.5567890123G       ->  1.00T
///  123456789012.29999    ->  123.45678901229999G   ->  123G
///  123556789012.3        ->  123.5567890123G       ->  124G
///  9995567890123         ->  9.995567890123T       ->  10.0T
///  1234567890123         ->  1.234567890123T       ->  1.23T
///  1235567890123         ->  1.235567890123T       ->  1.24T
///  99955678901230        ->  99.95567890123T       ->  100T
///  12345678901230        ->  12.34567890123T       ->  12.3T
///  12355678901230        ->  12.35567890123T       ->  12.4T
///  999556789012300       ->  999.5567890123T       ->  1.00P
///  123456789012300       ->  123.4567890123T       ->  123T
///  123556789012300       ->  123.5567890123T       ->  124T
///  9995567890123000      ->  9.995567890123P       ->  10.0P
///  1234567890123000      ->  1.234567890123P       ->  1.23P
///  1235567890123000      ->  1.235567890123P       ->  1.24P
///  99955678901230000     ->  99.95567890123P       ->  100P
///  12345678901230000     ->  12.34567890123P       ->  12.3P
///  12355678901230000     ->  12.35567890123P       ->  12.4P
///  9.995567890123E+17    ->  999.5567890123P       ->  1.00E
///  1.234567890123E+17    ->  123.4567890123P       ->  123P
///  1.235567890123E+17    ->  123.5567890123P       ->  124P
///  9.995567890123E+18    ->  9.995567890123E       ->  10.0E
///  1.234567890123E+18    ->  1.234567890123E       ->  1.23E
///  1.235567890123E+18    ->  1.235567890123E       ->  1.24E
///  9.995567890123001E+19 ->  99.95567890123001E    ->  100E
///  1.234567890123E+19    ->  12.34567890123E 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-02-12T11:01:33.610

这是一个方法：

```
public static string GetNumberWithUnitPrefix(double number, int power = 1)
    {
        char[] incPrefixes = new[] { 'k', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y' };
        char[] decPrefixes = new[] { 'm', 'µ', 'n', 'p', 'f', 'a', 'z', 'y' };

        int degree = (int)Math.Floor(Math.Log10(Math.Abs(number)) / (3 * (double)power));
        double scaled = number * Math.Pow(1000, -(degree * power));

        char? prefix = null;
        switch (Math.Sign(degree))
        {
            case 1: prefix = incPrefixes[degree - 1]; break;
            case -1: prefix = decPrefixes[-degree - 1]; break;
        }

        return ToStringWithSeparator(MathFunctions.RoundToSignificantDigits(scaled, 4)).ToString() + prefix;
    } 
```

`power`例如，如果要将 m² 转换为 mm²，请使用输入（在本例中为 2）

（改进的答案表格[格式化带有公制前缀的数字？](https://stackoverflow.com/questions/12181024/formatting-a-number-with-a-metric-prefix)）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-07-18T01:04:25.273

`ICustomFormmatter`对符号使用私有字典。

```
class EngNotationFormatter : IFormatProvider, ICustomFormatter
{
    private readonly Dictionary<double, string> notationSymbols = new Dictionary<double, string>
    {
        {double.NegativeInfinity, ""}, //Handles when value is 0
        {-24, "y"},
        {-21, "z"},
        {-18, "a"},
        {-15, "f"},
        {-12, "p"},
        {-9, "n"},
        {-6, "μ"},
        {-3, "m"},
        {0, ""},
        {3, "k"},
        {6, "M"},
        {9, "G"},
        {12, "T"},
        {15, "P"},
        {18, "E"},
        {21, "Z"},
        {24, "Y"},
    };

    public string Format(string format, object arg, IFormatProvider formatProvider)
    {
        double value = Convert.ToDouble(arg);

        double exponent = Math.Log10(Math.Abs(value));
        double engExponent = Math.Floor(exponent / 3) * 3;

        string symbol = notationSymbols.ContainsKey(engExponent) ? notationSymbols[engExponent] : "e" + engExponent;

        return (value * Math.Pow(10, (int)-engExponent)) + symbol;
    }

    public object GetFormat(Type formatType)
    {
        if (formatType == typeof(ICustomFormatter))
            return this;
        else
            return null;
    }
} 
```

示例使用

```
(0.00005678).ToString(new EngNotationFormatter()); //56.78μ
(0.1234).ToString(new EngNotationFormatter());     //123.4m
(0).ToString(new EngNotationFormatter());          //0
(1300).ToString(new EngNotationFormatter());       //1.3k
(19000).ToString(new EngNotationFormatter());      //19k 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-09-26T04:11:56.500

这是一个旧线程，但答案也可能是正确的。现有代码的问题：它不处理 NaN、任何无穷大、负数或非常小的数字（如 double.Epsilon）。而且你不能精确传递。

我的代码是：

```
 static string DoubleToEngineering(double value, string displayPrecision)
    {
        string Retval;
        if (double.IsNaN(value)
            || double.IsInfinity(value)
            || double.IsNegativeInfinity(value)
            || double.IsPositiveInfinity(value)
            || value == 0.0
            )
        {
            Retval  = String.Format("{0:" + "F" + displayPrecision + "}", value);
            return Retval;
        }
        bool isNeg = value < 0;
        if (isNeg) value = -value;

        int exp = (int)(Math.Floor(Math.Log10(value) / 3.0) * 3.0);
        int powerToRaise = -exp;
        double newValue = value;
        // Problem: epsilon is something-324
        // The biggest possible number is somethinge306
        // You simply can't do a Math.Power (10, 324), it becomes infiniity.
        if (powerToRaise > 300)
        {
            powerToRaise -= 300;
            newValue = newValue * Math.Pow(10.0, 300);
        }

        newValue = newValue * Math.Pow(10.0, powerToRaise);

        // I don't know when this below is triggered.
        if (newValue >= 1000.0)
        {
            newValue = newValue / 1000.0;
            exp = exp + 3;
        }
        var fmt = "{0:F" + displayPrecision + "}";
        Retval = String.Format (fmt, newValue);
        if (exp != 0) Retval += String.Format("e{0}", exp);
        if (isNeg) Retval = "-" + Retval;
        return Retval;
    } 
```

测试用例如下。我个人的测试用例标准（抱歉，这不遵循最新和最好的 NUnit 指南）：公共静态 Test() 不接受任何参数并返回错误数。它通常调用一个私有静态 TestOne(args, expected) 计算实际值，与预期值进行比较，并返回错误数。

```
 private static int TestDoubleToEngineeringOne(double value, string expected)
    {
        var fakePrecision = "4";
        int NError = 0;
        var actual = DoubleToEngineering(value, fakePrecision);
        if (actual != expected)
        {
            System.Diagnostics.Debug.WriteLine($"ERROR: DoubleToEngineering({value}) expected {expected} actual {actual}");
            NError++;
        }
        return NError;
    }

    public static int TestDoubleToEngineering()
    {
        int NError = 0;
        NError += TestDoubleToEngineeringOne(0, "0.0000");
        NError += TestDoubleToEngineeringOne(1, "1.0000");
        NError += TestDoubleToEngineeringOne(2, "2.0000");
        NError += TestDoubleToEngineeringOne(3, "3.0000");
        NError += TestDoubleToEngineeringOne(10, "10.0000");
        NError += TestDoubleToEngineeringOne(999, "999.0000");
        NError += TestDoubleToEngineeringOne(1000, "1.0000e3");

        NError += TestDoubleToEngineeringOne(1.234E21, "1.2340e21");

        NError += TestDoubleToEngineeringOne(-1, "-1.0000");
        NError += TestDoubleToEngineeringOne(-999, "-999.0000");
        NError += TestDoubleToEngineeringOne(-1000, "-1.0000e3");

        NError += TestDoubleToEngineeringOne(0.1, "100.0000e-3");
        NError += TestDoubleToEngineeringOne(0.02, "20.0000e-3");
        NError += TestDoubleToEngineeringOne(0.003, "3.0000e-3");
        NError += TestDoubleToEngineeringOne(0.0004, "400.0000e-6");
        NError += TestDoubleToEngineeringOne(0.00005, "50.0000e-6");

        NError += TestDoubleToEngineeringOne(double.NaN, "NaN");
        NError += TestDoubleToEngineeringOne(double.PositiveInfinity, "∞");
        NError += TestDoubleToEngineeringOne(double.NegativeInfinity, "-∞");
        NError += TestDoubleToEngineeringOne(double.Epsilon, "4.9407e-324");
        NError += TestDoubleToEngineeringOne(double.MaxValue, "179.7693e306");
        NError += TestDoubleToEngineeringOne(double.MinValue, "-179.7693e306");

        return NError;
    } 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-04-30T17:47:44.157

要解决此问题，您需要创建一个类（称为 Engineering），该类继承自您覆盖 ToString() 成员的 Float。

编辑：好的，我现在明白这个问题了。尽管如此，解决方案仍然是子类化。

# c# - 在 asp.net 上使用 ajax 创建动态控件

> ID：808111
> 
> 赞同：1
> 
> 时间：2009-04-30T17:25:35.677
> 
> 标签：c#, asp.net, ajax, dynamic, controls

我的页面上有添加和删除按钮。添加按钮将一个复选框、两个文本框和一个下拉列表添加到我页面上的新行。删除按钮删除它们。我按照[Joe Stagner 的例子](http://www.asp.net/Learn/ajax-videos/video-286.aspx)很好地运行了这个。

问题：动态创建的控件都需要在选中时触发相同的事件（对于复选框），对于选定的索引更改（对于下拉列表）也是如此。

我在创建对象时尝试添加事件处理程序，但它似乎没有触发？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T18:07:31.363

对于每个页面加载，您需要以某种方式 [会话、视图状态等] 持久化动态创建的控件。重新创建动态控件并使用 preInit 函数中每个页面加载的委托重新绑定事件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T18:10:11.450

是的，就像所有人所说的那样，这是生命周期问题。当您动态加载用户控件时，您应该始终执行以下操作。

*   为每个用户控件分配一个唯一的 ID。
*   在 Page_Load 或 Page_Init 事件上重新加载用户控件。

为了让这一切更容易，我建议将加载抽象为您将从 Page_Load 和 Page_Init 调用的函数，如前所述，该函数将检查目标用户控件是否已加载，并将再次为您加载，以执行此操作，您将加载的用户控件 ID 存储在 Session 或 viewstate 中。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T17:51:55.037

我认为您可能会遇到这样一个事实，即在每个页面发布时，您的页面都被完全重新创建 - 本质上，页面必须复制页面上的控件，然后才能尝试将回发（和事件）反馈给它们。我认为您可能需要做的是将代码添加到您的 page_load 中，这将重新创建动态创建的控件，并使用与它们相同的 id，并注册事件处理程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T17:58:16.300

听起来您有页面生命周期问题。

对于动态创建的控件来触发事件，您应该在页面的 PreInit 事件中创建它们。

这是Asp.net 页面生命周期[备忘单的链接。](http://john-sheehan.com/blog/net-cheat-sheets/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-17T16:55:54.320

如果您想在没有自动回发的情况下执行此操作，您可以删除自动回发并在那里抛出和 ASP 按钮。任何 runat 服务器都应该触发您的动态事件处理程序。

# c# - 解释一下这个 LINQ 代码？

> ID：808119
> 
> 赞同：1
> 
> 时间：2009-04-30T17:27:00.073
> 
> 标签：c#, .net, linq

我问了一个问题，其中一个响应包含以下 LINQ 代码：

```
var selected = lstAvailableColors.Cast<ListItem>().Where(i => i.Selected).ToList();
selected.ForEach( x => { lstSelectedColors.Items.Add(x); });
selected.ForEach( x => { lstAvailableColors.Items.Remove(x);}); 
```

有人可以向一个新手解释上述 LINQ 吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T17:35:37.417

LINQ 运算符使用所谓的[fluent interface](http://en.wikipedia.org/wiki/Fluent_interface)，因此您可以将第一行视为一系列函数调用。假设`lstAvailableColors`是`IEnumerable<T>`，想法是每种可用颜色都流经 LINQ 运算符。

让我们分解一下：

```
var selected = lstAvailableColors
    // each item is cast to ListItem type
    .Cast<ListItem>() 
    // items that don't pass the test (Selected == true) are dropped
    .Where(i => i.Selected) 
    // turn the stream into a List<ListItem> object
    .ToList(); 
```

编辑：正如 JaredPar 指出的，上面的最后一行 ( `ToList()`) 非常重要。如果您不这样做，那么这两个`selected.ForEach`调用中的每一个都将重新运行查询。这称为[延迟执行](http://blogs.msdn.com/charlie/archive/2007/12/09/deferred-execution.aspx)，是 LINQ 的重要组成部分。

您可以像这样重写第一行：

```
var selected = new List<ListItem>();

foreach (var item in lstAvailableColors)
{
    var listItem = (ListItem)item;

    if (!listItem.Selected)
         continue;

    selected.Add(listItem);
} 
```

最后两行只是编写 foreach 循环的另一种方式，可以重写为：

```
foreach (var x in selected)
{
    lstSelectedColors.Items.Add(x);
}

foreach (var x in selected)
{
    lstAvailableColors.Items.Remove(X);
} 
```

学习 LINQ 最难的部分可能是学习数据流和[lambda 表达式](http://msdn.microsoft.com/en-us/library/bb397687.aspx)的语法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T17:33:16.393

来自原始问题的解释。

LINQ 版本分为两部分。第一部分是第一行，它查找当前选定的项目并将值存储在列表中。该行包含 .ToList() 调用非常重要，因为这会强制查询立即执行而不是延迟执行。

接下来的两行遍历每个选择的值并将其删除或添加到适当的列表中。因为选择的列表已经存储了，所以我们在修改它时不再枚举集合。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T17:31:36.897

它将列表中的每个项目转换为 ListItem 类型，然后仅选择 Selected 属性为 true 的项目。然后它会创建一个仅包含这些项目的新列表。对于结果列表中的每个项目，它将该项目添加到所选颜色列表中，并将其从可用颜色列表中删除。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T17:43:25.963

也许一些翻译会有所帮助

```
var selected = lstAvailableColors.Cast<ListItem>().Where(i => i.Selected).ToList(); 
```

可以写成：

```
List<ListItem> selected = new List<ListItem>();

foreach (ListItem item in lstAvailableColors)
{
    if (item.Selected)
        selected.Add(item);
} 
```

请注意`foreach`，在这种情况下，将列表中的项目隐式转换为循环变量的任何类型`ListItem`，以便处理`Cast<ListItem>`列表中的 。`Where`过滤掉表达式为的任何项目`false`，所以我对`if`语句做同样的事情。最后，`ToList`把序列变成一个列表，所以我只是边走边建立一个列表。最终结果是一样的。

和：

```
selected.ForEach( x => { lstSelectedColors.Items.Add(x); });
selected.ForEach( x => { lstAvailableColors.Items.Remove(x); }); 
```

可以写成：

```
foreach (ListItem item in selected)
{
    lstSelectedColors.Items.Add(item);
    lstAvailableColors.Items.Remove(item);
} 
```

我怀疑在这种情况下是否有充分的理由以更晦涩的方式编写它。

# html - 我应该使用哪些元信息？

> ID：808124
> 
> 赞同：6
> 
> 时间：2009-04-30T17:28:26.233
> 
> 标签：html, seo, metadata

[我在互联网上看到很多关于元标签](http://www.w3schools.com/html/html_meta.asp)的不同观点。我已经使用它们一段时间了，但我现在想知道我是否一直在使用当前的最佳实践来做这件事。

我知道描述是最重要的...

```
<meta name="description" content="This is not a website" /> 
```

**但是其他元标记呢？**我什至应该使用描述标签以外的东西吗？例如，有人说现在使用关键字是不好的做法，因为某些网站过度使用它们，这可能导致网站进入搜索引擎的垃圾邮件文件夹。

最后，**编写描述元标记时的最佳实践是什么？**使用我个人的例子，现在我有一个引用各种歌曲的网站。我应该这样做：

```
<meta name="description" content="MyWebsite - Here, there are songs" /> 
```

在每个不同的页面上或更多类似的内容：

```
<meta name="description" content="Song Title X, Artist Y" /> 
```

或者 ：

```
<meta name="description" content="MyWebsite - Here, there are songs | Song Title X, Artist Y" /> 
```

或前一个的任何组合......或其他什么？

谢谢 ！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T21:42:55.590

以下是 Google 爬虫支持的元标记列表：

[元标记 - 网站管理员/网站所有者帮助](http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=79812)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T18:01:23.733

每个页面都应该有自己的元描述，描述用于在搜索结果屏幕上显示有关页面的数据

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T18:13:56.327

我不知道为什么我对我的评论投了反对票，但让我详细说明一下，希望投票能被推翻。

元标签**关键字**是搜索引擎的重要标签。对于音乐网站，您可能需要添加如下内容。然后，当搜索引擎浏览您的网站时，他们会知道您特别希望您的网站与哪些词相关联。

下面是一个例子：<meta name="keywords" content="Rock, Jazz, Bluegrass, Blues, Bass, Guitar, 60s, 70s" />

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T02:28:35.557

我不认为你所有的描述元标记。让我详细说明一下。

第一个，很好读（你知道这些描述将在搜索中呈现），但它不是那么精确！对您的 SEO 不利。

第二个，对 SEO 好，对读者不好。

第三个，比前两个好，但你需要打磨它们。

PS你可以添加更多的单词。

# silverlight - 从 SilverLight 调用时，NetConnect 在 Flash 中静默失败

> ID：808137
> 
> 赞同：0
> 
> 时间：2009-04-30T17:32:37.593
> 
> 标签：silverlight, actionscript, javascript, rtmp

这是一个复杂的问题，因为有很多活动部件。我提前道歉。

我正在尝试编写一个托管 Flash 相机和麦克风的 Silverlight 控件（因为 Silverlight 本身不支持这些东西，运气不好）。我编写了一个简短的 Flex 应用程序（“WLocalWebCam.swf”）来处理相机，并公开两个外部方法：connect(uri:String, streamName:String) 和 disconnect()。我可以通过 JavaScript 成功调用这些（简化为删除错误处理等）：

```
function connectWebCam(webCamID, rtmpUri, streamName) {
    var flashCam = getWebCam(webCamID);
    flashCam.Connect(rtmpUri, streamName);
}

function disconnectWebCam(webCamID) {
    var flashCam = getWebCam(webCamID);
    flashCam.Disconnect();
}

function getWebCam(id) {
    return document.getElementById(id);
} 
```

当我从另一个 JavaScript 源（例如，按钮单击处理程序）调用这些函数时，网络摄像头正确连接到 RTMP 服务器（我使用的是 Wowza）。但是，当我在 Silverlight 的同一页面上调用完全相同的函数时，Flash 摄像头无法连接到 RTMP 服务器。

```
/// <summary>
/// Connect() invokes the connectWebCam() JavaScript function contained in the WebCam.js file on the website.
/// The connectWebCam() method in turn calls the Connect() method on the contained Flash web cam object.
/// </summary>
public void Connect()
{
    ScriptObject connectWebCam = (ScriptObject)HtmlPage.Window.GetProperty("connectWebCam");
    connectWebCam.InvokeSelf(CameraID, RtmpUri.ToString(), CameraID);
} 
```

然而，它以一种有趣的方式失败了。ActionScript 的 connect() 方法被调用，它成功地调用了 getConnection()，但是 handleNetStatus 事件处理程序方法永远不会被调用，并且 Wowza 服务器永远不会看到连接尝试。

这是我正在使用的 ActionScript 代码，这次保留了调试位。

```
public function connect(uri:String, name:String):void
{
    rtmpUri = uri;
    streamName = name;
    logMessage("Beginning attempt to open connection; rtmpUri=" + rtmpUri + "; streamName = " + streamName);
    logMessage("Retrieving camera.");
    cam = Camera.getCamera();
    if( cam != null )
    {
        logMessage("Retrieved camera.");
        cam.setMode( 320, 240, 20 );
        cam.setQuality( 0,0 );          
    }
    else
    {
        logMessage("Unable to retrieve camera instance.");
    }

    logMessage("Retrieving microphone.");
    mic = new Microphone();
    if (mic == null)
    {
        logMessage("Unable to retrieve microphone instance.");
    }
    logMessage("Retrieving NetConnection.");
    chatNC = getConnection(); 
}

private function getConnection(): NetConnection
{
    var nc: NetConnection = new NetConnection();    
    if (nc != null)
    {
        logMessage("Retrieved NetConnection().");
        nc.client = this;
        nc.objectEncoding = ObjectEncoding.AMF0;
        nc.addEventListener( NetStatusEvent.NET_STATUS, this.handleNetStatus );
        logMessage("Connecting to " + rtmpUri);
        nc.connect(rtmpUri); // <-- We get successfully to this point.
    }
    else
    {
        logMessage("Unable to retrieve new NetConnection()");
    }               
    return nc;
}

private function handleNetStatus( event:NetStatusEvent ):void
{
    logMessage("[SYSTEM MESSAGE] net status " + event.info.code + "  type " + event.type); // <-- We never get this far.  This bit never gets called.

    switch( event.info.code )
    {
        case "NetConnection.Connect.Success":
            publishVideoStream();
            break;
        default:
            Alert.show("Error connecting: " + event.info.code, "Error Connecting");
            break;
    }
} 
```

这让我非常摸不着头脑。

有谁知道为什么如果从 Silverlight 调用与从 JavaScript 调用完全相同的 ActionScript 会表现不同？有关故障排除的任何建议吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T22:11:15.397

叹。没关系。事实证明，如果您尝试连接到而不是. 当你给它正确的参数时，一切都会按预期工作。在我发现我做错了什么之前，我一定已经看过该代码一百次了。**`http:`**`//localhost/videochat`**`rtmp:`**`//localhost/videochat`

# javascript - 如何正确实现 jQuery Sifr 插件？

> ID：808140
> 
> 赞同：2
> 
> 时间：2009-04-30T17:33:16.063
> 
> 标签：javascript, jquery, fonts, sifr

我整个下午都在尝试让 jQuery Sifr 插件 ( [http://jquery.thewikies.com/sifr/](http://jquery.thewikies.com/sifr/) ) 工作，但没有成功。该插件的站点的文档有限，而且对于一些看起来很简单的事情，我相信我一定快到了。我还在[http://www.eona.com/sifr/](http://www.eona.com/sifr/)上找到了一些信息，但我认为它适用于旧版本的插件。

我使用在线 Sifr 生成器 ( [http://www.sifrgenerator.com/](http://www.sifrgenerator.com/) ) 制作了自己的字体文件，也使用 Flash CS4 自己制作了字体文件，但似乎都不起作用。

这是我的代码：

```
$(document).ready(function(){       
    $.sifr({
        path: 'http://**.com/js/',
        save: true
    });

    $('.pageInfo h1').sifr({
        font: 'soho',
        debug: true
    });
}); 
```

现在，“保存：true”不在此插件的文档中，但我确实在插件网站的其他地方找到了它，有趣的是，没有它，什么都不会发生，但包含它，我得到的只是默认值“使用 sIFR3" 消息而不是我的元素的文本呈现。

该插件的网站还说“它支持 sIFR 版本 2 和版本 3 字体。”这是什么意思？我的字体文件可以是较新的 v3 类型吗？

我真的很感激任何和所有的帮助。

先感谢您

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-20T13:16:44.377

我在使用 jQuery 插件（现在使用 sIFR 3）时遇到了同样的问题，对我来说，预发布的 swf 的版本小于 436 - 特别是来自 sifrvault 的字体。您的字体可能需要重新发布，获取 ttf 并使用 OpensIFRr。

-杰伊

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-28T14:49:36.717

我在这里！

不好意思推迟了。:)

您必须至少指定构建和版本。

这是一个示例：

```
$.sifr({
    build: 436,
    version: 3,
    path: 'http://**.com/js/',
    save: true
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T19:06:01.037

您是否尝试过跳过字体选项并将对 swf（包括 .swf 文件扩展名）的直接引用传递给路径选项？几周前我尝试了那个插件，我认为这可能是开始工作所必需的。

YMMV，但我的经验是，许多奇怪的小错误潜入了插件中，使用官方 sIFR 2.0 在文档（就绪）代码中运行普通的 sifr.replaceElement 远没有那么令人沮丧（而且同样简单和高效） .7 从[http://wiki.novemberborn.net/sifr/](http://wiki.novemberborn.net/sifr/)发布。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T19:14:50.873

我不相信 jQuery 插件与 sIFR 3 兼容（无论如何我建议你使用它）。

# c++ - 何时使用 Malloc 而不是 New

> ID：808148
> 
> 赞同：2
> 
> 时间：2009-04-30T17:34:52.037
> 
> 标签：c++, malloc, new-operator, dynamic-memory-allocation

重复：[在什么情况下我使用malloc vs new？](https://stackoverflow.com/questions/184537/in-what-cases-do-i-use-malloc-vs-new/)

只是重新阅读这个问题：
[C ++中的“new”和“malloc”和“calloc”有什么区别？](https://stackoverflow.com/questions/807939/what-is-the-difference-between-new-and-malloc-and-calloc-in-c-closed)

我检查了答案，但没有人回答这个问题：

*   我什么时候会使用 malloc 而不是 new？

有几个原因（我可以想到两个）。
让最好的漂浮到顶部。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-30T17:38:29.030

突然想到的一对：

*   当您需要在 C++ 和 C 之间移植代码时。
*   当您在可能从 C 调用的库中分配内存时，C 代码必须释放分配。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T17:41:49.320

从`new/malloc`我在该线程上发布的 Stroustrup 常见问题解答中：

> 每当您使用 malloc() 时，您必须考虑初始化并将返回指针转换为正确的类型。您还必须考虑是否有适合您使用的字节数。考虑到初始化时， malloc() 和 new 之间没有性能差异。

这应该回答你的问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T17:38:59.890

我能想到在 C++ 中使用 malloc 的最佳原因是与纯 C API 交互时。我使用过的一些 C API 拥有某些参数的内存。因此，它们负责释放内存，因此内存必须可以通过 free 释放。Malloc 将适用于此目的，但不一定是新的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T17:40:07.827

在 C++ 中，几乎没有。new 通常是调用构造函数的 malloc 的包装器（如果适用）。

但是，至少在 Visual C++ 2005 或更高版本中，[使用 malloc 实际上会导致新的](http://msdn.microsoft.com/en-us/magazine/cc337897.aspx#S6).

考虑这段代码：

```
MyStruct* p = new MyStruct[count];
MyStruct* p = (MyStruct*)malloc(count* sizeof(MyStruct)); 
```

它们看起来相当。但是，第一个代码生成器实际上会检查`count * sizeof(MyStruct).` 如果 count 来自不受信任的源中的整数溢出，它可能会导致整数溢出，从而导致分配少量内存，但是当您使用 count 时，您会溢出缓冲区。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-30T17:55:18.883

在使用将使用 free() 的 C 库时，每个人都提到过（使用略有不同的词），并且周围有很多这样的库。

我看到的另一种情况是：

了解您自己的内存管理时（因为某些原因，您通过建模发现默认值不够好）。您可以使用 malloc 分配内存块，并使用放置 new 初始化池中的对象。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-30T17:39:21.103

原因之一是在 C++ 中，您可以重载 new 运算符。

如果您想确保在代码中使用系统库内存分配，您可以使用 malloc。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T17:38:28.970

C++ 程序员应该很少需要调用 malloc。我能想到的这样做的唯一原因是一个糟糕的 API，它期望你传入 malloc 的内存，因为它会做免费的。在您自己的代码中，new 应该始终等于 malloc。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T17:39:30.590

如果要通过 free() 释放内存（在您或其他人的代码中），则使用 malloc 非常需要。

否则我不确定。一种人为的情况是，当您不希望在退出时运行析构函数时，但在这种情况下，您可能应该拥有具有无操作 dtor 的对象。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-30T17:42:45.793

当您不想担心捕获异常（或使用非抛出版本的 new）时，您可以使用 malloc。

# string - 如何 PInvoke 多字节 ANSI 字符串？

> ID：808154
> 
> 赞同：4
> 
> 时间：2009-04-30T17:37:17.287
> 
> 标签：string, pinvoke

我正在为不支持 Unicode 字符串但支持多字节 ANSI 字符串的库开发 PInvoke 包装器。在调查有关库的 FxCop 报告时，我注意到正在使用的字符串封送处理有一些有趣的副作用。PInvoke 方法使用“最佳匹配”映射来创建单字节 ANSI 字符串。为了说明，这是一种方法的样子：

```
[DllImport("thedll.dll", CharSet=CharSet.Ansi)]
public static extern int CreateNewResource(string resourceName); 
```

使用包含非 ASCII 字符的字符串调用此函数的结果是 Windows 找到一个“关闭”字符，通常这看起来像它最终是“？？？”。如果我们假设“a”是一个非 ASCII 字符，那么将“cat”作为参数传递将创建一个名为“c?t”的资源。

如果我遵循 FxCop 规则中的指导方针，我最终会得到这样的结果：

```
[DllImport("thedll.dll", CharSet=CharSet.Ansi, BestFitMapping = false, ThrowOnUnmappableChar = true)]
public static extern int CreateNewResource([MarshalAs(UnmanagedType.LPStr)] string resourceName); 
```

这引入了行为的改变；现在，当无法映射字符时，将引发异常。这让我很担心，因为这是一个重大变化，所以我想尝试将字符串编组为多字节 ANSI，但我看不到这样做的方法。 `UnmanagedType.LPStr`指定为单字节 ANSI 字符串，`LPTStr will be Unicode or ANSI depending on the system, and LPWStr is not what the library expects.`

`How would I tell PInvoke to marshal the string as a multibyte string? I see there's a `WideCharToMultiByte()` API function, could I change the signature to expect an IntPtr`到我在非托管内存中创建的字符串？看起来这仍然存在当前实现存在的许多问题（它仍然可能需要删除或替换字符），所以我不确定这是否是一种改进。我还缺少另一种编组方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T17:43:13.543

ANSI*是*多字节的，ANSI 字符串根据系统上当前启用的代码页进行编码。`WideCharToMultiByte`工作方式与 P/Invoke 相同。

也许您所追求的是转换为 UTF-8。虽然`WideCharToMultiByte`支持这一点，但我认为 P/Invoke 不支持，因为不可能采用 UTF-8 作为系统范围的 ANSI 代码页。此时，您将考虑将字符串作为 an`IntPtr`来传递，尽管如果您这样做，您也可以使用托管`Encoding`类来进行转换，而不是`WideCharToMultiByte`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T17:41:49.477

这是我发现完成此任务的最佳方法。不是编组为字符串，而是编组为字节 []。让 pinvoke 函数 API 的调用者负责以最合适的方式转换为字节数组。最有可能通过使用 Text.Encoding 类之一。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T17:59:35.703

如果您最终不得不手动调用 WideCharToMultiByte，我将摆脱 p/invoke 并在 C++/CLI 包装函数中使用 WideCharToMultiByte 手动编组它。在这些互操作场景中，托管 C++ 比 C# 好得多。

但是，如果这是您拥有的唯一 p/invoke，那么它可能不值得。

# asp.net - Is this supposed to work this way?

> ID：808168
> 
> 赞同：3
> 
> 时间：2009-04-30T17:39:35.673
> 
> 标签：asp.net, web-services, asmx

I have this code up on my server [here](http://smplsite.com/sandbox2/process.asmx) (Yes I known ASMX is a bad idea but WCF doesn't work at all for some reason):

```
<%@ WebService Language="C#" Class="Test" %>

using System.Web;
using System.Web.Services;

[WebService(Namespace = "http://smplsite.com/smplAccess")]
[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
public class Test : System.Web.Services.WebService
{
    State s;

    public Test()
    {
        s = (Session["foo"] ?? (Session["foo"] = new State())) as State ;
    }

    [WebMethod(EnableSession = true)]
    public void Set(int j) { i=j; }

    [WebMethod(EnableSession = true)]
    public int Get() { return i; }
}

class State
{
    public int i = 5;
} 
```

when I run the folloing code:

```
class Program
{
    static void Main(string[] args)
    {
        var ser = new ServiceReference1.TestSoapClient();

        Console.WriteLine(ser.Get());
        ser.Set(3);
        Console.WriteLine(ser.Get());
    }
} 
```

I expect to get back:

```
5
3 
```

but I got back

```
5
5 
```

## My Solution

1.  Usee `wsdl.exe` to generate a proxy class
2.  Add references as needed to get it to compile
3.  Use [Martin's](https://stackoverflow.com/questions/808168/is-this-supposed-to-work-this-way/808219#808219) solution

* * *

[This Seems related](http://msdn.microsoft.com/en-us/library/system.web.services.webmethodattribute.enablesession.aspx)

Edit: Added State object.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T17:51:33.650

Web services are stateless, so they do not store their state between multiple calls. Everytime you call a method, a new instance of the service will be created and its members will have the default values again.

What you can do, is to enable session state (as you have done) and store your state in the ASP.NET session.

Something like this:

```
[WebMethod(EnableSession = true)]
public void Set(int j) { Session["i"] = j; }

[WebMethod(EnableSession = true)]
public int Get() { return Session["i"] == null ? 5 : (int)Session["i"]; } 
```

This was what is required on the server side. But you also have to take care on the client side:

Since an ASP.NET session is identified by a cookie, you have to make sure that you are passing the same cookie to the server with every web method call. To do so, you have to instantiate a CookieContainer and assign it to the web service proxy instance:

```
static void Main(string[] args)
{
    var ser = new ServiceReference1.TestSoapClient();
    ser.CookieContainer = new System.Net.CookieContainer();
    // ...
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T17:43:13.047

You need to turn on sessions.

```
[WebMethod(EnableSession = true)] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T17:46:12.960

It looks to me like its not persisting class state between session method calls - probably a new object is being called each time. I'm actually not sure that you can rely on getting the same object instance each time you call the service. Joshua's answer is correct, but you'll also need to write code to persist your service's internal field into that session.

# c# - 将比较器分配给 ListViewItemSorter

> ID：808169
> 
> 赞同：0
> 
> 时间：2009-04-30T17:39:43.240
> 
> 标签：c#, sorting, listview

我想根据列对 C# 中的 ListView 控件进行排序。我创建了 ColumnClickEventHandler：

```
 private void contactsListView_ColumnClick(object sender, ColumnClickEventArgs e)
    {
        contactsListView.ListViewItemSorter = new ListViewItemComparer(e.Column);
        contactsListView.Sort();
    } 
```

ListViewItemComparer 类如下所示：

```
 class ListViewItemComparer : IComparer<ListViewItem>
{
    private int col;
    public ListViewItemComparer()
    {
        col = 0;
    }
    public ListViewItemComparer(int column)
    {
        col = column;
    }
    public int Compare(ListViewItem x, ListViewItem y)
    {
        int returnVal = -1;
        returnVal = String.Compare(x.SubItems[col].Text, y.SubItems[col].Text);
        return returnVal;
    }
} 
```

此代码不会编译，因为 contactsListView.ListViewItemSorter 是 IComparer 类型，而 ListViewItemComparer 类是 IComparer。

有没有办法明确地将一个转换为另一个？或者只是用另一种方式排序？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T17:45:34.740

泛型`IComparer<T>`和非泛型`IComparer`不能相互转换。

也许您`ListViewItemComparer`应该改为实施非泛型`IComparer`？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T17:44:38.360

我相信比较类应该是 I `Comparer, not IComparer<type>`。 [这是一篇](http://blogs.interknowlogy.com/joelrumerman/archive/2007/04/03/12497.aspx)可能有帮助的文章，它使用了 SortDescriptions。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-11T19:17:34.640

尝试

```
class ListViewItemComparer : IComparer 
```

不是

```
class ListViewItemComparer : IComparer<ListViewItem> 
```

# sqlite - SQLite 的 SubSonic 连接字符串

> ID：808175
> 
> 赞同：1
> 
> 时间：2009-04-30T17:40:48.137
> 
> 标签：sqlite, subsonic, app-config

我正在编写一个需要简单持久层的桌面应用程序——我发现了 SubSonic 并且它能够与 SQLite 一起工作。但是我需要将数据库文件保存在用户的 AppData 文件夹中，并且不知道如何将这些值放入 app.config - 我不想使用绝对路径。

app.config 可以以某种方式访问​​环境变量或引用应用程序数据文件夹吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-01T01:37:48.927

对于 subsonic v2.x，我会忽略 app.config 连接字符串，并在使用数据库之前在运行时设置它。当然，提供者名称保持不变。

```
string dbPath = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData), @"MyApplication\Northwind.db3");

DataService.Providers["Northwind"].DefaultConnectionString =
            String.Format(@"Data Source={0};Version=3;New=False;Connection Timeout=3", dbPath); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T17:59:01.337

无法在 app.config 中为连接字符串指定 AppData 文件夹。

但是您可以做的是在安装期间或首次运行应用程序时将值写入配置文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T20:09:30.727

查找appdata的“框架方式”是使用Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData)

无论平台如何，这都会找到正确的 appdata 路径。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T20:59:30.250

如果您使用 ASP.NET 有几种方法，无论是哪一种语言

Server.MapPath("~") 会将应用程序的根目录作为完整路径名返回，然后您只需将“/app_data”添加到它即可获得完整路径。

或者检查 HttpContext.Current.Request 和 HttpContext.Current.Application 有许多（并且比我刚才提到的那个更好）属性将为您提供相同的文件夹 - 作为完整路径的应用程序的根。

请注意，即使您将应用程序作为虚拟文件夹，并且在该文件夹的 IIS 中配置了应用程序的常规文件夹，这些都应该可以工作

但是，这仅在运行时才有可能，因此在 app.config 中无法真正提及。您可以尝试使用 app.config 驻留的相对路径 IE“../App_Data”或“/App_data”，但我不确定您的确切要求。

祝你好运

# c# - .net 3.5 c# 在本地工作，但在我发布到共享帐户时不工作

> ID：808188
> 
> 赞同：0
> 
> 时间：2009-04-30T17:43:23.700
> 
> 标签：c#, .net

我是 .NET 新手，遇到了问题。我有一个创建安全令牌以使用远程 Web 服务的应用程序。当我在我的机器上本地运行应用程序时，它运行良好（在 Visual Web Developer Express 2008 中）。然后，我在 godaddy.com 上使用了一个共享主机 Windows 帐户。当我发布网站然后在线查看时，我收到错误消息：

## “/”应用程序中的服务器错误。

安全异常描述：应用程序试图执行安全策略不允许的操作。要授予此应用程序所需的权限，请联系您的系统管理员或在配置文件中更改应用程序的信任级别。

异常详细信息：System.Security.SecurityException：请求“System.Security.Permissions.FileIOPermission，mscorlib，Version=2.0.0.0，Culture=neutral，PublicKeyToken=b77a5c561934e089”类型的权限失败。`

有什么建议可以检查问题吗？是我的应用吗？Godaddy的限制？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T18:21:35.247

基本上发生的事情是您的应用程序正在尝试写入文件系统，并且由于没有被授予权限而出现权限错误。你有几件事要做。

1.  确认您将文件写入的确切位置。在共享帐户上，您应该只写入路径中的文件夹，而不是尝试使用任何临时位置。
2.  完成 #1 后，请联系 GoDaddy 以找出您无权写入所需目录的原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T18:25:57.793

尝试使用 Server.MapPath 找到一个位置来定位您的文件。如果您对“c:\tempdir\website1\tempfile.txt”之类的内容进行硬编码，这将不起作用，因为它是 GoDaddy 上的共享主机。

Server.MapPath 方法根据根文件所在的位置返回动态文件路径。您应该对 GoDaddy 上的根目录具有读/写权限。

# standards - 有效的开发团队有哪些关键概念？

> ID：808191
> 
> 赞同：1
> 
> 时间：2009-04-30T17:44:14.947
> 
> 标签：standards, process

在我工作的地方，我们最近组建了我们所谓的开发标准委员会，其任务是改进我们的程序、流程、方法、工具、标准，以及我们认为有助于我们成为一个更有效的团队的任何东西。

我们有一个我们已经排名的项目的电子表格，并且将从上到下开始处理。我们有更好的源代码控制（目前在 SourceSafe）、实现错误跟踪器（例如 FogBugz 的 Mantis）、同行代码审查、迁移到 .Net 3.5、可能迁移到某种形式的敏捷、做更多实际的团队开发而不是每个项目类型的单个开发人员，以及其他一些东西......

您认为可以成就或破坏开发团队的一些关键因素是什么？我们应该在这个列表中添加什么？

一些附加信息：我们的 windows 团队大约有 12 人，如果包括所有平台，大约有 50 人正在开发中。我们希望尽可能地为每个人改进，但我们最大的关注点是 Windows 团队。我们所有人都在这里至少几年了，所以我们大多数人都彼此认识并且合作得很好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T17:49:21.160

签入代码时需要注释（如果您可以将提交绑定回您的错误跟踪器，那就太好了）

可能是静态代码分析，比如 Visual Studio 内置的

[CruiseControl](http://cruisecontrol.sourceforge.net/ "巡航控制")等持续集成

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T17:49:26.103

您团队中的人数实际上在这里非常重要。每个团队都应该实现一些基本的东西（源代码控制、错误跟踪等），但是有些东西是不同的团队规模。例如，一个非常小的团队的代码审查可能更加非正式。

转向敏捷是一个好主意，除非你的特定开发环境使它成为一个坏主意。此外，如果没有使用您的软件的人的支持，您将无法做到这一点。

考虑做一些事情来确保团队之间的沟通更容易，障碍更少——你所有的成员都彼此了解吗？可以互相合作吗？你了解彼此的特质吗？学习团队合作比您可以做出的任何随机流程改进都重要得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T17:50:43.200

开发团队确实需要优秀的人开始，他们可以很好地协同工作，但这并不是真正要添加到列表中的项目。但是，它确实会影响我的第一个建议，要务实。如果您不鼓励您的开发人员思考他们的工作方式并推动他们自我改进，那么就很难建立一个可以为他们做这件事的开发环境。

导师和培训：如果您不能进行 XP，那么至少尽可能将您的初级与高级联系起来。您不仅会分享知识，还会分享您拥有的项目的背景。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T18:10:24.773

某种持续集成和定期的、经过测试的、有效的“发布”为质量创造了奇迹。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T17:47:26.060

> 作为更好的源代码控制（目前在 SourceSafe 上）

如果这是 Visual SourceSafe - 您需要立即更改它。试试 cvs、svn 或什至像 Perforce 这样付费的东西。

存在一种称为[Rational Unified Process](http://en.wikipedia.org/wiki/IBM_Rational_Unified_Process)的东西来处理您的问题（以及更多）。

# django - 注释两个字段相乘的总和

> ID：808201
> 
> 赞同：41
> 
> 时间：2009-04-30T17:46:46.593
> 
> 标签：django, django-models

我有三个模型，例如简化：

```
class Customer(models.Model):
    email = models.CharField(max_length=128)

class Order(models.Model):
    customer = models.ForeignKey(Customer)
    order_status = models.CharField(blank=True, max_length=256)

class Lineitem(models.Model):
    order = models.ForeignKey(Order)
    quantity = models.IntegerField(blank=True)
    price = models.DecimalField(max_digits=6, decimal_places=2) 
```

我想查询客户（可能使用过滤器）并注释他们花费的总额（即总和超过（价格 * 数量）

我努力了：
`Customer.objects.filter(something).annotate(total_spent=Sum(F('order__lineitem__quantity') * F('order__lineitem__price')))`

看起来 Sum() 不能与 F() 表达式一起使用。还有另一种方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2016-02-15T15:53:32.310

也许您现在不需要这个答案，但是如果您阅读了有关[Sum 表达式](https://docs.djangoproject.com/en/3.1/topics/db/aggregation/#cheat-sheet)的文档，则需要声明`output_field`，如下所示：

```
Customer.objects.filter(something)
                .annotate(total_spent=Sum(
                    F('order__lineitem__quantity') * 
                    F('order__lineitem__price'),   
                    output_field=models.FloatField()
                )) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-08-24T15:07:16.630

您可以尝试在模型中使用属性`LineItem`：

```
class Lineitem(models.Model):
    order = models.ForeignKey(Order)
    quantity = models.IntegerField(blank=True)
    price = models.DecimalField(max_digits=6, decimal_places=2)
    def _get_total(self):
        return quantity * price
    total = property(_get_total) 
```

然后我认为你可以用使用的总金额来注释

```
Customer.objects.filter(something).annotate(total_spent=Sum('order__lineitem__total')) 
```

我不知道这种方法的效率与其他方法有何关系，但它比替代方案更 Pythonic/Django-y，即手动编写整个 SQL 查询，如

```
Customer.objects.raw("SELECT ... from <customer_table_name> where ...") 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T17:54:09.540

你看过使用该`.extra()`方法吗？

请参阅[Django 查询集 API](http://docs.djangoproject.com/en/dev/ref/models/querysets/#extra-select-none-where-none-params-none-tables-none-order-by-none-select-params-none)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-16T21:56:25.250

您可能需要推出自己的自定义聚合器。您可以找到一个简单的`GROUP_CONCAT`示例，让您从这里开始：http: [//harkablog.com/inside-the-django-orm-aggregates.html](http://harkablog.com/inside-the-django-orm-aggregates.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-26T20:20:49.640

我刚遇到这个，我不认为注释并且可以使用属性，请参阅[Django - 你可以使用属性作为聚合函数中的字段吗？](https://stackoverflow.com/questions/3066491/django-can-you-use-property-as-the-field-in-an-aggregation-function)

这就是我所做的。

```
class Customer(models.Model):
    email = models.CharField(max_length=128)

class Order(models.Model):
    customer = models.ForeignKey(Customer)
    order_status = models.CharField(blank=True, max_length=256)

class Lineitem(models.Model):
    order = models.ForeignKey(Order)
    quantity = models.IntegerField(blank=True)
    price = models.DecimalField(max_digits=6, decimal_places=2)
    @property
    def total(self):
        return self.quantity * self.price 
```

然后使用 sum 和列表推导：

```
sum([li.total for li in  LineItem.objects.filter(order__customer=some_customer).filter(somefilter)]) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-06-18T02:51:11.803

类似于：[https ://stackoverflow.com/a/19888120/1344647](https://stackoverflow.com/a/19888120/1344647)

```
from django.db.models import Sum

q = Task.objects.filter(your-filter-here).annotate(total=Sum('progress', field="progress*estimated_days")) 
```

编辑：感谢@Max，使用注释而不是聚合。

# svn - SVN 是否具有始终以特定方式解决冲突的属性？

> ID：808207
> 
> 赞同：2
> 
> 时间：2009-04-30T17:48:35.933
> 
> 标签：svn, tortoisesvn

当我进行 SVN 更新时，我希望一个特定的版本控制文件总是被头版本破坏，而不是每次更新时都必须手动解决它。这样的属性存在吗？或者，不太可能，Tortoise SVN 是否有自己的选择？

**编辑：**更多解释 - 有一个特定的构建文件由构建机器签入；在本地工作时，如果我正在处理它的源代码，我会自己重新编译该文件。当我对整个存储库进行更新时，我真的不在乎该特定文件是否被破坏，因为无论如何我都会自己重新编译它。强制同步并不是一个真正的选择，因为我不想意外破坏我的源文件，只是这些特殊的例外。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T17:58:41.137

在名为 *--accept 的开关中的颠覆更新命令中：

`svn up --accept [postpone|base|mine-full|theirs-full|edit|launch]`

这触发了交互式冲突解决。

在 TortoiseSVN 中也是如此。如果发生第一次冲突，将显示对话框

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T17:51:14.743

这不是叫强制同步头吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T20:29:25.670

答案是否定的，没有任何内置功能。

# asp.net - 在 VB6 中嵌入 ASP.NET 应用程序

> ID：808214
> 
> 赞同：0
> 
> 时间：2009-04-30T17:50:33.527
> 
> 标签：asp.net, vb6

有人知道我如何将 ASP.NET 3.5 应用程序嵌入到 Visual Basic 6 应用程序中吗？

我的另一个选择是在 VB6 应用程序中提供一个超链接，它将打开 ASP.NET 应用程序.....但如果可能的话，我更愿意将 ASP.NET 应用程序嵌入到 VB6 的选项卡控件中。

提前致谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T18:31:14.880

对于 .net 应用程序的自动登录（假设它是 ASP.net），我会让 vb6 应用程序登录过程将会话 GUID 写入数据库，并在构建到 .net 的链接时将其用作 get 或 post 变量应用。

在 ASP.NET 端，修改 MembershipProvider 以将 guid 和用户名作为成功验证 vb6 应用程序的证据。

根据您的环境需要的保护程度，您可能应该采取一些额外的安全预防措施。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T18:06:46.750

实际上，您最好的选择可能是在新选项卡上使用 Web 浏览器控件，并将其指向您的 ASP.NET 应用程序。

对于自动登录，您应该能够让用户登录一次。您可能需要在 ASP.NET 应用程序中启用“记住我”功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T17:52:13.680

这听起来是个可怕的主意。

我认为您应该提供更多有关这种情况的背景信息，以便可以提出替代方案。

**编辑**：你说 VB6 应用程序不能被重写......但它可以被编辑吗？根据 ASP.Net 应用程序中功能的复杂性，您可以更改 ASP.Net 应用程序以包含 Web 服务并从 VB6 应用程序访问该功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T17:54:03.707

这将是一个两部分的过程。

创建一个 .NET 库来托管 asp.net，[http://www.west-wind.com/presentations/aspnetruntime/aspnetruntime.asp](http://www.west-wind.com/presentations/aspnetruntime/aspnetruntime.asp)。

然后使用 interopt 启动库。不过听起来确实是个坏主意。

# c++ - 是否存在不允许重复并保持输入顺序的数据结构？

> ID：808215
> 
> 赞同：6
> 
> 时间：2009-04-30T17:50:38.317
> 
> 标签：c++, data-structures

**重复：** [选择具有唯一性并保持插入顺序的 STL 容器](https://stackoverflow.com/questions/769097/choosing-a-stl-container)

我正在寻找一种类似于集合的数据结构，它不允许插入重复项，但也知道插入项目的顺序。它基本上是集合和列表/向量的组合。

我只会使用列表/向量并自己检查重复项，但我们需要快速验证重复项，因为结构的大小可能会变得非常大。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T17:55:58.507

看看[Boost.MultiIndex](http://www.boost.org/doc/libs/1_38_0/libs/multi_index/doc/tutorial/basics.html)。您可能需要为此编写一个包装器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T18:06:49.480

以插入顺序为索引的[Boost.Bimap应该可以工作（例如 boost::bimap < size_t, Foo > ）。](http://www.boost.org/doc/libs/1_38_0/libs/bimap/doc/html/index.html)如果要从数据结构中删除对象，则需要单独跟踪下一个插入订单值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T17:54:02.147

编写自己的包含向量和集合的类似乎是显而易见的解决方案 - 没有 C++ 标准库容器可以满足您的需求。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T18:22:03.497

Java 以有序集的形式具有此功能。我不认为 C++ 有这个，但自己实现并不难。Sun 的人对 Java 类所做的就是扩展散列表，以便将每个项目同时插入到散列表中并保存在双链表中。这几乎没有开销，特别是如果您预先分配用于构造链表的项目。

如果我在哪里，我会编写一个类，该类要么使用私有向量来存储项目，要么自己在类中实现哈希表。当任何项目要插入到集合中时，检查它是否在哈希表中，如果有这样的项目，可以选择替换其中的项目。然后在哈希表中找到旧项目，更新列表以指向新元素，你就完成了。

要插入一个新元素，你也可以这样做，除了你必须在列表中使用一个新元素——你不能重复使用旧元素。

要删除一个项目，您需要重新排列列表以指向它，然后释放列表元素。

请注意，您应该可以直接从元素中获取您感兴趣的元素所在的链表部分，这样您每次必须移动或更改元素时都不必遍历链表。

如果您预计在程序运行期间会更改很多这些项目，您可能希望保留列表项目的列表，这样您就可以仅占据该列表的头部，而不是每次必须添加一个时分配内存新元素。

您可能想查看跳舞链接算法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T17:54:46.950

我只使用两种数据结构，一种用于顺序，一种用于身份。（如果您存储值，一个可以指向另一个，这取决于您想要最快的操作）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T17:54:49.383

听起来像是[OrderedDictionary](http://msdn.microsoft.com/en-us/library/system.collections.specialized.ordereddictionary.aspx)的工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T17:55:58.287

快速的重复验证似乎是这里的关键部分。我可能会使用某种类型的地图/字典，并自己跟踪插入顺序作为实际数据。因此，关键是您要插入的“数据”（然后对其进行哈希处理，并且您不允许重复的键），并将地图的当前大小作为“数据”放入。当然，这仅在您没有任何删除时才有效。如果您需要，只需在每次插入时增加一个外部变量，相对顺序会告诉您何时插入。

不一定漂亮，但也不难实现。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T18:17:48.483

假设您在这里谈论的是 ANSI C++，我要么自己编写，要么使用组合和委托来包装用于数据存储的映射和用于插入顺序的键向量。根据数据的特性，您可能可以使用插入索引作为映射键并避免使用向量。

# scheduling - 在 gemstone 中安排任务的最佳方法是什么？

> ID：808217
> 
> 赞同：0
> 
> 时间：2009-04-30T17:51:04.697
> 
> 标签：scheduling, smalltalk, oodb, gemstone

我的网站在宝石上运行。为了向用户提供统计数据，我需要运行定期任务。这是如何在 gemmtone 中达到最佳效果的？来自宝石内部还是来自操作系统？黄玉是正确的选择吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T18:41:35.433

使用 cron 之类的东西来启动 topaz 进程是正确的方法。

确保您捕获了 topaz 进程的标准输出，并在日志文件的名称中包含目的和日期。

如果任务的频率低于每 5 分钟一次，那么在延迟上启动一个“永久”黄玉进程（如维护虚拟机）是一个不错的方法。

我们的一些客户使用[CONTROL-M](http://en.wikipedia.org/wiki/CONTROL-M)来启动 topaz，其中包括其流程调度中的工作流。

戴尔

# registry - 注册表脚本 - 您可以在没有 dword 关键字的情况下分配十进制值吗

> ID：808220
> 
> 赞同：2
> 
> 时间：2009-04-30T17:51:41.387
> 
> 标签：registry

以下哪个注册表脚本在语法上是正确的？两者都会起作用吗？是首选吗？

**样品 A：**

```
REGEDIT4

[HKEY_LOCAL_MACHINE\software\microsoft\windows\currentversion\policies\explorer]
"nodrivetypeautorun"=255 
```

**样品 B：**

```
REGEDIT4

[HKEY_LOCAL_MACHINE\software\microsoft\windows\currentversion\policies\explorer]
"nodrivetypeautorun"=dword:000000FF 
```

从技术上讲，在这个例子中，“nodrivetypeautorun”元素是一个双字数据类型。我不想专注于“nodrivetypeautorun”元素。我只关心 dword 数据类型以及在注册表脚本中设置它们的正确方法。

我认为 Sample A 将无法导入该值，并且我认为我可以证明这一点。我需要的是一个可以支持我的在线参考，因为与我一起工作的一些人不会相信我的话，即使我证明了这个问题。我在谷歌上花了一些时间，但找不到我要找的东西。这个问题的首选答案应该有这样的参考，但我会接受其他专业人士的普遍共识。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T20:51:46.897

MS 知识库有一篇关于此的文章。

[http://support.microsoft.com/kb/310516/](http://support.microsoft.com/kb/310516/)

这是您感兴趣的摘录：

> .Reg 文件的语法 .reg 文件具有以下语法：
> 
> RegistryEditorVersion 空行 [RegistryPath1] "DataItemName1"="DataType1:DataValue1" DataItemName2"="DataType2:DataValue2" 空行 [RegistryPath2] "DataItemName3"="DataType3:DataValue3"

因此，设置值的“官方”方式似乎包括指定“DataType”，在您的情况下为“dword”。

# sql - 如何确定字段是否设置为非空？

> ID：808225
> 
> 赞同：3
> 
> 时间：2009-04-30T17:52:23.070
> 
> 标签：sql, sql-server, tsql

我部署了一个现有程序，其中一些客户数据库的字段设置为不为空，而另一些则可以为空。我需要运行一个补丁来更正数据库，以便该列可以为空，但不需要针对所有数据库运行它，只针对不正确的数据库运行它。是否有一种简单的方法可以在 SQL Server 中用于执行此检查？最好是可以作为 SQL 脚本的一部分运行的东西。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-30T17:55:58.083

查看 INFORMATION_SCHEMA 视图。例如：

```
SELECT
     IS_NULLABLE
FROM
     My_DB.INFORMATION_SCHEMA.COLUMNS
WHERE
     TABLE_SCHEMA = 'dbo' AND
     TABLE_NAME = 'My_Table' AND
     COLUMN_NAME = 'My_Column' 
```

IS_NULLABLE 将是“YES”或“NO”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T17:55:16.697

```
select Table_Name, Column_Name, Is_Nullable
from information_schema.columns 
```

会得到你的信息

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T17:55:28.913

```
select isnullable from syscolumns where name = 'status' 
```

# linux - Linux 的 HPUX macinfo 等效项？或者我使用的是什么硬件？

> ID：808231
> 
> 赞同：2
> 
> 时间：2009-04-30T17:52:59.323
> 
> 标签：linux, statistics, hp-ux

在 HPUX 中，命令“machinfo”列出机器信息，例如 CPU 数量、时钟速度、总线速度、处理器类型、高速缓存信息、总内存和操作系统版本信息。

是否有等效的 Linux 实用程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T17:57:41.140

其中有很多文件`/proc`包含有关系统的信息，例如等。有关详细信息`/proc/cpuinfo`，`/proc/meminfo`请参阅手册页`proc`。

还有一些实用程序可以帮助您，尽管其中一些可能未安装：

*   `dmidecode`
*   `x86info`
*   `lspci`
*   `lsusb`
*   `uname`

...可能还有其他的，其中一些依赖于分布。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T19:51:59.490

*cat /proc/cpuinfo*和*cat /proc/meminfo*很可能是您要查找的内容：

CPU信息：

```
cat /proc/cpuinfo
processor   : 0
vendor_id   : GenuineIntel
cpu family  : 6
model               : 15
model name  : Intel(R) Core(TM)2 Duo CPU     T7700  @ 2.40GHz
stepping    : 10
cpu MHz             : 800.000
cache size  : 4096 KB
physical id : 0
siblings    : 2
core id             : 0
cpu cores   : 2
fpu         : yes
fpu_exception       : yes
cpuid level : 10
wp          : yes
flags               : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good pni monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr lahf_lm ida
bogomips    : 4792.63
clflush size        : 64
cache_alignment     : 64
address sizes       : 36 bits physical, 48 bits virtual
power management:

processor   : 1
vendor_id   : GenuineIntel
cpu family  : 6
model               : 15
model name  : Intel(R) Core(TM)2 Duo CPU     T7700  @ 2.40GHz
stepping    : 10
cpu MHz             : 800.000
cache size  : 4096 KB
physical id : 0
siblings    : 2
core id             : 1
cpu cores   : 2
fpu         : yes
fpu_exception       : yes
cpuid level : 10
wp          : yes
flags               : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good pni monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr lahf_lm ida
bogomips    : 4787.77
clflush size        : 64
cache_alignment     : 64
address sizes       : 36 bits physical, 48 bits virtual
power management: 
```

内存信息：

```
$ cat /proc/meminfo
MemTotal:      3977260 kB
MemFree:         26224 kB
Buffers:        141712 kB
Cached:        1190744 kB
SwapCached:         20 kB
Active:        2452144 kB
Inactive:       966032 kB
SwapTotal:     2097144 kB
SwapFree:      2051636 kB
Dirty:           10984 kB
Writeback:           0 kB
AnonPages:     2085712 kB
Mapped:         171640 kB
Slab:           364212 kB
SReclaimable:   323032 kB
SUnreclaim:      41180 kB
PageTables:      29032 kB
NFS_Unstable:        0 kB
Bounce:              0 kB
CommitLimit:   4085772 kB
Committed_AS:  3231676 kB
VmallocTotal: 34359738367 kB
VmallocUsed:     20564 kB
VmallocChunk: 34359716859 kB 
```

# database - 使 SQL Server 数据库脱机时的极长等待时间

> ID：808232
> 
> 赞同：289
> 
> 时间：2009-04-30T17:53:15.423
> 
> 标签：database, sql-server-2005, performance

我正在尝试在我的开发数据库上执行一些脱机维护（从实时备份还原开发数据库），但是通过 SQL Server Management Studio 执行的“脱机”命令执行速度**非常**慢 - 现在大约需要 30 分钟。我几乎束手无策，我似乎无法在网上找到任何关于可能导致速度问题或如何解决它的参考资料。

一些网站建议打开与数据库的连接会导致速度变慢，但使用此数据库的唯一应用程序是我的开发机器的 IIS 实例，并且服务已停止 - 没有更多打开的连接。

什么可能导致这种放缓，我能做些什么来加快速度？

* * *

## 回答 #1

> 赞同：427
> 
> 时间：2009-04-30T18:16:45.180

经过一些额外的搜索（受 gbn 的回答和 u07ch 对 KMike 的回答的评论启发的新搜索词）我发现了这个，它在 2 秒内成功完成：

```
ALTER DATABASE <dbname> SET OFFLINE WITH ROLLBACK IMMEDIATE 
```

### （更新）

[当这仍然失败并出现以下错误时，您可以按照此博客文章的](http://blog.degree.no/2013/03/long-wait-time-when-taking-sql-server-database-offline/)启发修复它：

> ALTER DATABASE 失败，因为无法在数据库 'dbname' 上放置锁 稍后再试。

您可以运行以下命令来找出谁在锁定您的数据库：

```
EXEC sp_who2 
```

并使用`SPID`您在以下命令中找到的任何内容：

```
KILL <SPID> 
```

然后再次运行该`ALTER DATABASE`命令。它现在应该可以工作了。

* * *

## 回答 #2

> 赞同：132
> 
> 时间：2009-04-30T18:12:01.853

很可能从某个地方连接到数据库（一个罕见的例子：[异步统计更新](http://msdn.microsoft.com/en-us/library/ms190397(SQL.90).aspx)）

要查找连接，请使用[sys.sysprocesses](http://msdn.microsoft.com/en-us/library/ms179881(SQL.90).aspx)

```
USE master
SELECT * FROM sys.sysprocesses WHERE dbid = DB_ID('MyDB') 
```

要强制断开连接，请使用[ROLLBACK IMMEDIATE](http://msdn.microsoft.com/en-us/library/ms174269(SQL.90).aspx)

```
USE master
ALTER DATABASE MyDB SET SINGLE_USER WITH ROLLBACK IMMEDIATE 
```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-04-30T18:01:18.290

您是否有任何连接到此数据库的打开的 SQL Server Management Studio 窗口？

将其置于单用户模式，然后重试。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2013-08-20T15:02:42.603

就我而言，在等了这么久之后，我没有耐心，干脆关闭了管理工作室。在退出之前，它显示了成功消息，db is offline。这些文件可以重命名。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2017-01-24T03:16:05.880

执行存储过程 sp_who2

这将允许您查看是否有任何阻塞锁.. 杀死他们应该修复它。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-12-10T16:23:13.603

在 SSMS 中：右键单击 SQL 服务器图标，活动监视器。开放进程。找到已处理的连接。右键单击该进程，Kill。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-30T18:25:36.530

每当您遇到此类事情时，您都应该始终考虑您的事务日志。带有立即回滚的 alter db 语句表明情况确实如此。看看这个：http: [//msdn.microsoft.com/en-us/library/ms189085.aspx](http://msdn.microsoft.com/en-us/library/ms189085.aspx)

加强检查点等。您需要确定日志中的事务是否值得保存，然后选择相应的模式来运行您的数据库。你真的没有理由等待，也没有理由让你丢失数据——你可以两者兼得。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-02-25T15:52:31.423

关闭发出请求的 SSMS（SQL 服务管理器）实例为我解决了这个问题.....

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-09-11T15:45:25.077

就我而言，在执行此操作之前，我查看了数据库中的一些表。我的用户帐户在 SSMS 中保持与此数据库的活动连接。一旦我在 SSMS 中断开与服务器的连接（打开“使数据库脱机”对话框），操作就成功了。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-01-23T13:45:49.387

为了解决这个问题，我停止了在 IIS 中连接到数据库的网站，然后“冻结”“使数据库脱机”面板立即解冻。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-10-03T09:23:31.750

我尝试了以下所有建议，但没有任何效果。

1.  执行 sp_who
2.  杀死 < SPID >

3.  ALTER DATABASE SET SINGLE_USER WITH Rollback 立即

    ALTER DATABASE SET OFFLINE 立即回滚

    结果：上述两个命令也都卡住了。

4\. 右键单击数据库 -> 属性 -> 选项 将数据库只读设置为 True 在对话框中单击“是”，警告 SQL Server 将关闭与数据库的所有连接。

结果：窗口被卡在执行中。

作为最后的手段，我从配置管理器重新启动 SQL 服务器服务，然后运行 ​​ALTER DATABASE SET OFFLINE WITH ROLLBACK IMMEDIATE。它就像一个魅力

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-08-17T11:58:33.673

此外，关闭您可能打开的任何连接到相关数据库的查询窗口；）

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-02-01T19:24:28.960

在 SSMS 中，将数据库设置为只读，然后再返回。连接将被关闭，从而释放锁。

就我而言，有一个网站与数据库建立了开放连接。这个方法很简单：

1.  右键单击数据库 -> 属性 -> 选项
2.  设置`Database Read-Only`为真
3.  在对话框警告中单击“是”，SQL Server 将关闭与数据库的所有连接。
4.  重新打开选项并关闭只读
5.  现在尝试重命名数据库或使其脱机。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-07-02T12:19:50.143

对我来说，我只需要进入 Job Activity Monitor 并停止正在处理的两件事。然后马上就下线了。就我而言，尽管我知道这两个过程是什么，并且可以停止它们。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-08-11T18:45:21.207

就我而言，该数据库与旧的 Sharepoint 安装有关。在服务器管理器中停止和禁用相关服务“取消挂起”已运行 40 分钟的脱机操作，并立即完成。

您可能希望检查当前是否有任何服务正在使用该数据库。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-09-19T16:51:55.113

下次，从“脱机”对话框中，记得选中“删除所有活动连接”复选框。我也在本地机器上的 SQL_EXPRESS 上没有连接，但是除非我选中该复选框，否则这种减速发生在我身上。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2015-12-02T12:49:23.237

就我而言，我停止了 Tomcat 服务器。然后数据库立即脱机。

# asp.net-mvc - ASP.Net MVC 路由操作名称冲突

> ID：808236
> 
> 赞同：4
> 
> 时间：2009-04-30T17:54:11.817
> 
> 标签：asp.net-mvc, asp.net-mvc-routing

我们有一个处理艺术家和场地的网站，我们正在用 ASP.net MVC 开发它。

我们在文件夹 (Views/Artists/..)、ArtistsController、ArtistsRepository 中有我们的艺术家视图，并遵守 REST 操作名称，例如 Show、New、Delete 等。

当我们第一次模拟该站点时，在我们的测试环境中一切都运行良好，因为我们的测试 URL 是 /artists/Show/1209 但我们需要更改它以便网站显示为 /artists/Madonna 和 /artists/Foo-Fighters 等

但是，我们如何区分有效的艺术家名称和该控制器的动作名称？！例如，艺术家/PostComment 或艺术家/DeleteComment？我需要允许路由来处理这个。我们默认的 Show 路线是：

```
routes.MapRoute(
               "ArtistDefault",
               "artists/{artistName}",
               new { controller = "Artists", action = "Show", artistName = ""} 
```

解决这个问题的一种方法是让我们的网站在 /artists 上明显运行，但将我们的控制器重命名为单数 - ArtistController - 而不是 ArtistsController。这将违背我们开始时使用的命名约定（但是，嘿！）。

您还有其他建议吗？如果可能的话，我们还可以根据动词进行路由（因此 PostComment 将是一个 POST，因此我们可能可以路由到该操作），但我不确定这是否可取，更不用说可能了。

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-30T18:37:06.147

MapRoute 的第四个参数允许您指定值的限制。您可以在此路由之前添加一条用于“艺术家/{action}/{id}”的路由，并限制操作的有效值；未能匹配您的一项操作，它将落入下一条与艺术家姓名匹配的路线。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-30T22:56:56.240

You would actually define multiple routes... the defined actions in your controller would go first with the default being at the bottom. I like to think of route definitions as a "big 'ole switch statement" where first rule satisfied wins..

```
routes.MapRoute(
               "ArtistPostComment",
               "artists/PostComment/{id}",
               new { controller = "Artists", action = "PostComment", id = "" }
);
routes.MapRoute(
               "ArtistDeleteComment",
               "artists/DeleteComment/{id}",
               new { controller = "Artists", action = "DeleteComment", id = "" }
);
routes.MapRoute(
               "ArtistDefault",
               "artists/{artistName}",
               new { controller = "Artists", action = "Show", artistName = "" }
); 
```

# visual-studio-2008 - VC2008，如何为 C++/CLI 项目中的单个文件关闭 CLR 标志

> ID：808250
> 
> 赞同：2
> 
> 时间：2009-04-30T17:56:12.017
> 
> 标签：visual-studio-2008, clr, c++-cli

[这篇文章](http://www.techtalkz.com/vc-net/66949-performance-pure-native-c-class-managed-c-cli-dll-comp.html)说可以关闭单个 .cpp 文件的 CLR 标志。

**来自帖子：** *您可以在每个 .cpp 文件中单独设置 /CLR 开启或关闭。为整个项目打开它，。正如您所做的那样，然后为仅包含本机（非托管）代码的文件关闭它。当您打开 VC++ 项目属性对话框时，您仍然可以单击解决方案资源管理器中的文件/项目来更改您正在处理的范围。单击非托管 .cpp 文件为该文件设置选项。*

这是真的？我不知道如何通过我的 C++/CLI 项目的属性页来做到这一点。我将如何做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T17:58:48.560

只需右键单击解决方案资源管理器中的文件并点击属性。选项是“使用公共语言运行时支持编译”，位于 C/C++ -> 常规下。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-19T04:53:53.800

需要注意的一件事是预编译的标头。但是，您可以在混合项目中重新启用预编译的头文件。如果添加 stdafx.mgd.cpp / stdafx.mgd.h 之类的内容，然后，对于为 C++/CLI 配置的每个文件，将“通过文件使用 PCH”更改为 stdafx.mgd.h 并附加“.mgd .pch”在下面预编译头文件行的末尾...（必须与您用于 stdafx.mgd.cpp 的命名匹配并选择“创建预编译头文件...”）

由于习惯了快速的 C# 编译时间，每一点都有助于提高 C++/CLI 编译的性能……哦，别忘了 /MP ;)

抱歉，这有点离题，但通常是相关的/下一步......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T17:57:28.423

没关系，答案就在我面前（即使在我引用的段落中）。

*您仍然可以单击解决方案资源管理器中的文件/项目来更改您正在处理的范围。单击非托管 .cpp 文件为该文件设置选项。*

这只是那些日子之一:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T17:57:50.810

右键单击解决方案资源管理器 > 属性 > C/C++ 上的文件名。

# excel - 宏插件

> ID：808252
> 
> 赞同：1
> 
> 时间：2009-04-30T17:56:23.123
> 
> 标签：excel, vba

目前设置此宏，如果 G 列有“Last Term”和“Okay”或“Okay”和“Stay”彼此相邻，则 07a 将输入到 I 列的同一行中。我想修改这个代码，以便如果 G 列包含“Last Term”并且 K 列包含“Okay”和“End”或“Okay”和“Stay”，以任意组合或任何顺序，可能在它们之间、之前或之后有其他词只要存在这两种不同的组合，那么 07a 就会被输入到同一行的 I 列中。

Sub Plugin() Dim nRow As Long Dim iRow As Long

```
nRow = ActiveSheet.Cells(Rows.Count, "G").End(xlUp).Row

For iRow = 1 To nRow
    With Cells(iRow, "G")
        If .Text Like "Okay*" Or .Text Like "End*" Then
            Cells(iRow, "I") = "07a"
        If .Text Like "Okay*" Or .Text Like "Stay*" Then
            Cells(iRow, "I") = "07a"
        End If
    End With
Next iRow 
```

结束子

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T20:37:33.813

试试下面的代码：

```
Sub Plugin()
Dim nRow As Long
Dim iRow As Long
Dim KUpperText As String

nRow = ActiveSheet.Cells(Rows.Count, "G").End(xlUp).Row

For iRow = 1 To nRow
    KUpperText = UCase(Cells(iRow, "K").Text)
    If UCase(Cells(iRow, "G").Text) Like UCase("Last Term*") Then
        If ((KUpperText Like "*END*" And KUpperText Like "*OKAY*") _
         Or (KUpperText Like "*STAY*" And KUpperText Like "*OKAY*")) Then
            Cells(iRow, "I") = "07a"
        End If
    End If
Next iRow
End Sub 
```

对于每个循环，我读取 K 列中的文本字符串。它被格式化为大写，以确保处理“结束”和“结束”。

# winapi - Windows 2000 不支持 CryptBinaryToString。是否有替代方案？

> ID：808253
> 
> 赞同：1
> 
> 时间：2009-04-30T17:56:26.587
> 
> 标签：winapi, base64

`CryptBinaryToString`Windows 2000 不支持Windows API 函数。

有替代方案吗？

我需要的主要用途是编码/解码 BASE64

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T18:10:43.090

如果你想要 BASE64，你可以找到一些非常短的实现，比如[b64.c](http://base64.sourceforge.net/)。如果您需要更多与密码/证书相关的东西，请尝试为 win32 获取 openssl。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-30T18:01:02.440

[您可以从MSDN 描述](http://msdn.microsoft.com/en-us/library/aa379887(VS.85).aspx)中滚动您自己的。

# delphi - ReportBuilder 7.x - 在打印时控制打印到文件

> ID：808254
> 
> 赞同：0
> 
> 时间：2009-04-30T17:57:13.947
> 
> 标签：delphi, file, printing, reportbuilder

使用 ReportBuilder 7.X

问题

是否可以控制打印到文件。

我需要在打印时更改字段的长度

例子：

标签2

在设置中 - 我将其长度设置为 800，这是该字段应为的最大值。但是，在许多情况下，记录少于该记录，我需要在打印到文件之前将其设置为计算的大小。

这可能吗？

是否可以在打印时（打印前、打印后）控制此打印的任何部分以归档...？对象是否可用？

我相信我们是 10.x 及更高版本的注册用户，但仍然没有重新编译 Delphi 2009 中的应用程序和新的 ReportBuilder....所以，目前这不是一个选项。

谢谢

谢恩

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T21:36:35.163

我解决了这个！每个控件都有一个 saveLength 属性。我可以使用一个可以随时更改的全局变量（控制整个记录的长度）。然后就在我打印他的标签之前，我可以设置它的 saveLength 属性

感谢所有回复的人

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T19:08:27.443

您可以尝试使用您正在使用的 tDataSource 的**OnDataChange**事件将您的数据链接到您的报告。当关联数据集中的当前记录发生更改时，将触发此事件。在这种情况下，请将您的标签调整为当前记录的大小。

# java - J2ME 的 Integer.parseInt() 坏了吗？

> ID：808262
> 
> 赞同：3
> 
> 时间：2009-04-30T17:58:52.023
> 
> 标签：java, java-me, parseint

在为 J2ME 编写游戏时，我们遇到了使用 java.lang.Integer.parseInt() 的问题

我们有几个常量值定义为十六进制值，例如：

```
CHARACTER_RED = 0xFFAAA005; 
```

在游戏过程中，该值被序列化并通过网络连接接收，以十六进制值的字符串表示形式出现。为了将其解析回 int，我们尝试了以下操作，但未成功：

```
// Response contains the value "ffAAA005" for "characterId"
string hexValue = response.get("characterId");
// The following throws a NumberFormatException
int value = Integer.parseInt(hexValue, 16); 
```

然后我进行了一些测试并尝试了这个：

```
string hexValue = Integer.toHexString(0xFFAAA005);
// The following throws a NumberFormatException
int value = Integer.parseInt(hexValue, 16); 
```

这是实际代码的例外：

```
java.lang.NumberFormatException: ffaaa005
    at java.lang.Integer.parseInt(Integer.java:462)
    at net.triadgames.acertijo.GameMIDlet.startMIDlet(GameMIDlet.java:109) 
```

我必须承认，这让我很困惑。查看 parseInt 代码，当被解析的数字“越过”“负/正边界”时，似乎会抛出 NumberFormatException（也许有人可以用正确的术语对此进行编辑？）。

这是 Integer.parseInt 函数的预期行为吗？最后我不得不编写自己的十六进制字符串解析函数，我对提供的实现非常不满意。

换句话说，我期望 Integer.parseInt() 在整数的十六进制字符串表示上工作被误导了吗？

编辑：在我最初的帖子中，我写了 0xFFFAAA005 而不是 0xFFAAA005。我已经纠正了这个错误。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T18:01:52.300

`String`您正在解析的文件太大而无法放入`int`. 在 Java 中，an`int`是有符号的 32 位数据类型。您的字符串至少需要 36 位。

* * *

您的（正）值仍然太大而无法放入有*符号*的32-bit`int`中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T18:02:28.677

是否意识到您的输入 (4289372165) 溢出了`int`(2147483647) 的最大大小？

尝试将值解析为 a并在解析之前`long`修剪字符串的前导：`"0x"`

```
public class Program {
    public static void main(String[] args) {
        String input = "0xFFFAAA005";
        long value = Long.parseLong(input.substring(2), 16);
        System.out.print(value);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T18:02:26.087

我不是 java 开发人员，但我猜 parseInt 只适用于整数。0xFFFAAA005 有 9 个十六进制数字，所以它是一个长整数，而不是整数。我的猜测是它在抱怨，因为您要求它解析一个大于结果数据类型的数字。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T18:05:09.327

您的数字似乎太大而无法放入 int，请尝试改用 Long.parseLong()。此外，如果您的字符串中有 0x，则该字符串似乎不会被解析，因此请尝试将其切断。

# sharepoint - 删除不存在的网站

> ID：808268
> 
> 赞同：0
> 
> 时间：2009-04-30T18:00:31.427
> 
> 标签：sharepoint

在设置测试环境时，当我在 SharePoint 中遇到一个奇怪的错误时，我试图设置许多不同类型的网站来测试各种事物。

我在一个空白网站模板下创建了一个子网站，并看到了“新闻网站”的选项，所以我选择了它并收到错误消息，指出未在网站集级别启用发布功能。

美好的。所以，我去激活它，然后尝试再次创建站点，我得到了错误：

> 网站地址“/mpsite/news”已被使用

好的，所以该站点必须已经创建，所以我尝试访问该 URL 并获取：

> 找不到网页

美好的。因此，显然它在站点创建过程中出错了，所以我将通过 STSADM 将其删除。错误的：

> 没有名为“ [http://server/mpsite/news/](http://server/mpsite/news/) ”的顶级网站。

因此，该站点列在站点和工作区列表中，但实际上并不存在，也无法实际删除。

如何从站点和工作区列表中删除它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-01T00:14:46.457

您遇到了 SharePoint 的一个可爱的未记录“功能” -在以单独的、离散的步骤创建网站*后应用网站模板。*这意味着，一个网站可能在没有模板的情况下“存在”（就内容数据库而言），这会给您留下一个您无法浏览的网站，但在 SharePoint 炼狱中仍然可以“存在”（我已经实际上写了几个涉及依赖这个“功能”的黑客）。

在我看来，您可能遇到了一种这样的情况 - 当您去创建您的网站时，我猜您在将模板应用于您的新闻网站之前遇到了错误。

我过去解决类似问题的方法是使用 SharePoint Designer 删除网站 - 因为它直接查看内容数据库以了解存在和不存在的内容，它可能会删除您的 rouge 新闻网站.

希望这可以帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T18:11:51.197

您是否尝试过[http://server/mpsite/news/_layouts/deleteweb.aspx](http://server/mpsite/news/_layouts/deleteweb.aspx)？

或者可能是来自站点操作的“内容和结构”( [http://server/mpsite/_layouts/sitemanager.aspx ) 链接？](http://server/mpsite/_layouts/sitemanager.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-12-27T21:23:10.670

我知道这很旧，但它可能对某人有所帮助。在 SP2013 中，使用损坏的 Web 的 url 运行 Remove-SPWeb Powershell 命令对我来说非常有效。

# performance - MapServer 性能缓慢

> ID：808273
> 
> 赞同：2
> 
> 时间：2009-04-30T18:01:32.987
> 
> 标签：performance, google-maps, gis, mapserver

我正在使用 mapserver 创建一个将与 google map api 一起显示的地图。我遇到了性能问题。

我的地图都是 shapefile 格式。

我运行测试以获得时间来渲染地图。

使用 shp2img 工具渲染地图时，使用命令行

```
shp2img -i gif -m C:\myfolder\mymapfile.map -o C:\myfolder\test.gif -all_debug 5 -map_debug 5 
```

我从日志文件中获得以下指标：

```
[Thu Apr 30 13:50:19 2009].148000 msLoadMap(): 0.000s
[Thu Apr 30 13:50:19 2009].180000 msDrawMap(): Layer 0 (PWorld2), 0.032s
[Thu Apr 30 13:50:19 2009].180000 msDrawMap(): Drawing Label Cache, 0.000s
[Thu Apr 30 13:50:19 2009].180000 msDrawMap() total time: 0.032s
[Thu Apr 30 13:50:19 2009].195000 msSaveImage() total time: 0.015s
[Thu Apr 30 13:50:19 2009].195000 msFreeMap(): freeing map at 01595E18.
[Thu Apr 30 13:50:19 2009].195000 freeLayer(): freeing layer at 0159CD00.
[Thu Apr 30 13:50:19 2009].195000 shp2img total time: 0.047s 
```

通过 mapserver 渲染同一张地图时，使用

```
http://localhost/cgi-bin/mapserv.exe?mymapfile.map&layers=&mode=tile&tilemode=gmap&tile=1+1+2 
```

日志文件给出了这个：

```
[Thu Apr 30 13:51:50 2009].664000 CGI Request 1 on process 3520
[Thu Apr 30 13:51:50 2009].664000 msTileSetExtent (-10013744.792915, 8348.961808) (-5009.377085, 10010405.208192)
[Thu Apr 30 13:51:51 2009].23000 msDrawMap(): Layer 0 (PWorld2), 0.359s
[Thu Apr 30 13:51:51 2009].23000 msDrawMap(): Drawing Label Cache, 0.000s
[Thu Apr 30 13:51:51 2009].23000 msDrawMap() total time: 0.359s
[Thu Apr 30 13:51:51 2009].23000 msSaveImage() total time: 0.000s
[Thu Apr 30 13:51:51 2009].23000 mapserv request processing time (loadmap not incl.): 0.359s
[Thu Apr 30 13:51:51 2009].23000 msFreeMap(): freeing map at 01598690. 
```

对于同一张地图，shp2img 工具渲染地图的速度比 mapserver 快 10 倍。添加更多图层并使用谷歌地图的平铺模式时，最长可达 10 秒。

有人知道为什么 mapserver 渲染这么慢吗？有解决方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-22T10:57:22.910

shp2img 和 mapserv 请求之间有几个区别：

1) shp2img 创建单个图像，您的 mapserv 请求生成图块。这意味着它可能必须为同一个边界框渲染 9 个图块而不是 1 个。这会产生开销。尝试在不设置切片选项的情况下进行渲染并再次运行测试。

2) mapserv 中的 cgi 请求开销很小 3) Mapserv 通过 http 推送图像，而 shp2img 直接写入磁盘。4）您没有在 mapserv 请求中指定图层，这意味着 mapserv 去寻找图层。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-02T13:42:35.467

您可以阅读： http: [//mapserver.org/optimization/index.html](http://mapserver.org/optimization/index.html)

*   最重要的一点是删除 EPSG 文件中未使用的投影。例如，在 RedHat 6 /usr/share/proj/epsg 下我有 3 个投影。
*   删除未使用的字体
*   mapfile 解析器从上到下读取文件，因此将最常用的层放在文件的顶部（EPSG 解析器的工作方式相同）

形状文件“应该”具有相同的调用者投影，否则 Mapserver 必须即时重新投影它们。

EG 来自我的 OpenLayers 代码 (900913)：

```
var options = {
    projection: new OpenLayers.Projection('EPSG:900913'), //aka  EPSG:3785
    displayProjection: new OpenLayers.Projection('EPSG:4326'), //geographic 
```

我所有的形状文件都是基于 900913 投影的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T19:04:32.443

我有一些建议，但没有硬性答案，我没有做太多的地图服务器配置，但我和有的人一起工作过。

1.  您可以对地图服务器进行很多优化，我会检查邮件列表。
2.  使地图文件尽可能小，因为地图服务器打开和解析地图文件可能很耗时。
3.  提前创建所有图块，然后使用 mapserver 获取文件。动态平铺不是很快。

# python - Django 和 lxml 中的解码问题

> ID：808275
> 
> 赞同：3
> 
> 时间：2009-04-30T18:02:13.483
> 
> 标签：python, django, utf-8, lxml, decoding

使用 Django 应用程序的已部署版本时，lxml 有一个奇怪的问题。我使用 lxml 解析从服务器获取的另一个 HTML 页面。这在我自己的计算机上的开发服务器上运行良好，但由于某种原因它`UnicodeDecodeError`在服务器上给了我。

```
('utf8', "\x85why hello there!", 0, 1, 'unexpected code byte') 
```

我已确保 Apache（使用 mod_python）与`LANG='en_US.UTF-8'`.

我试过用谷歌搜索这个问题，并尝试了不同的方法来正确解码字符串，但我无法弄清楚。

在您的回答中，您可能会假设我的字符串被调用`hello`或其他东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-02T22:32:06.140

“\x85为什么你好！” 不是 utf-8 编码的字符串。您应该在将网页传递给 lxml 之前尝试解码网页。通过在获取页面时查看 http 标头来检查它使用的编码，也许你会在那里发现问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-14T06:31:39.053

没有诸如`u"\x85why hello there!"`帮助之类的语法吗？

您可能会发现官方 Python 文档中的以下资源很有帮助：

*   [Python介绍，Unicode字符串](http://docs.python.org/tutorial/introduction.html#unicode-strings)
*   [序列类型——str、unicode、list、tuple、buffer、xrange](http://docs.python.org/library/stdtypes.html#typesseq)

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-30T18:41:18.803

由于修改 site.py 不是一个理想的解决方案，请在程序开始时尝试以下操作：

```
import sys
reload(sys)
sys.setdefaultencoding("utf-8") 
```

# java - 使用 Java 的 Runtime.exec() 时如何添加超时值？

> ID：808276
> 
> 赞同：77
> 
> 时间：2009-04-30T18:02:25.823
> 
> 标签：java, process, timeout, runtime, exec

我有一种用于在本地主机上执行命令的方法。我想向该方法添加一个超时参数，以便如果被调用的命令没有在合理的时间内完成，该方法将返回错误代码。这是到目前为止的样子，没有超时功能：

```
public static int executeCommandLine(final String commandLine,
                                     final boolean printOutput,
                                     final boolean printError)
    throws IOException, InterruptedException
{
    Runtime runtime = Runtime.getRuntime();
    Process process = runtime.exec(commandLine);

    if (printOutput)
    {
        BufferedReader outputReader = new BufferedReader(new InputStreamReader(process.getInputStream()));
        System.out.println("Output:  " + outputReader.readLine());
    }

    if (printError)
    {
        BufferedReader errorReader = new BufferedReader(new InputStreamReader(process.getErrorStream()));
        System.out.println("Error:  " + errorReader.readLine());
    }

    return process.waitFor();
} 
```

谁能建议我实现超时参数的好方法？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2014-03-12T20:02:40.197

如果您使用的是 Java 8 或更高版本，您可以简单地将新的[waitFor 与 timeout 一起使用](https://docs.oracle.com/javase/8/docs/api/java/lang/Process.html#waitFor-long-java.util.concurrent.TimeUnit-)：

```
Process p = ...
if(!p.waitFor(1, TimeUnit.MINUTES)) {
    //timeout - kill the process. 
    p.destroy(); // consider using destroyForcibly instead
} 
```

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2009-04-30T18:22:47.413

```
public static int executeCommandLine(final String commandLine,
                                     final boolean printOutput,
                                     final boolean printError,
                                     final long timeout)
      throws IOException, InterruptedException, TimeoutException {
  Runtime runtime = Runtime.getRuntime();
  Process process = runtime.exec(commandLine);
  /* Set up process I/O. */
  ... 
  Worker worker = new Worker(process);
  worker.start();
  try {
    worker.join(timeout);
    if (worker.exit != null)
      return worker.exit;
    else
      throw new TimeoutException();
  } catch(InterruptedException ex) {
    worker.interrupt();
    Thread.currentThread().interrupt();
    throw ex;
  } finally {
    process.destroyForcibly();
  }
}

private static class Worker extends Thread {
  private final Process process;
  private Integer exit;
  private Worker(Process process) {
    this.process = process;
  }
  public void run() {
    try { 
      exit = process.waitFor();
    } catch (InterruptedException ignore) {
      return;
    }
  }  
} 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-10-09T12:40:51.153

按照[erickson 的回答](https://stackoverflow.com/a/808367/624109)，我创建了一种更通用的方法来做同样的事情。

```
public class ProcessWithTimeout extends Thread
{
    private Process m_process;
    private int m_exitCode = Integer.MIN_VALUE;

    public ProcessWithTimeout(Process p_process)
    {
        m_process = p_process;
    }

    public int waitForProcess(int p_timeoutMilliseconds)
    {
        this.start();

        try
        {
            this.join(p_timeoutMilliseconds);
        }
        catch (InterruptedException e)
        {
            this.interrupt();
        }

        return m_exitCode;
    }

    @Override
    public void run()
    {
        try
        { 
            m_exitCode = m_process.waitFor();
        }
        catch (InterruptedException ignore)
        {
            // Do nothing
        }
        catch (Exception ex)
        {
            // Unexpected exception
        }
    }
} 
```

现在，您所要做的如下：

```
Process process = Runtime.getRuntime().exec("<your command goes here>");
ProcessWithTimeout processWithTimeout = new ProcessWithTimeout(process);
int exitCode = processWithTimeout.waitForProcess(5000);

if (exitCode == Integer.MIN_VALUE)
{
    // Timeout
}
else
{
    // No timeout !
} 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-05-01T02:32:12.587

我使用建议的三种方法实现了这个，这些方法带有详细的代码示例（我是线程编程的新手，这些示例代码非常宝贵——如果只是用英文解释，我仍然会摸不着头脑如何做到这一点没有代码）。

我实现了我正在使用的实用程序类，其中三种方法用于执行具有超时的命令，如下所示：

```
package com.abc.network.lifecycle.util;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.concurrent.Callable;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.TimeoutException;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

/**
 * Utility class for performing process related functions such as command line processing.
 */
public class ProcessUtility
{

    static Log log = LogFactory.getLog(ProcessUtility.class);

    /**
     * Thread class to be used as a worker
     */
    private static class Worker
        extends Thread
    {
        private final Process process;
        private Integer exitValue;

        Worker(final Process process)
        {
            this.process = process;
        }

        public Integer getExitValue()
        {
            return exitValue;
        }

        @Override
        public void run()
        {
            try
            {
                exitValue = process.waitFor();
            }
            catch (InterruptedException ignore)
            {
                return;
            }
        }
    }

    /**
     * Executes a command.
     * 
     * @param command
     * @param printOutput
     * @param printError
     * @param timeOut
     * @return
     * @throws java.io.IOException
     * @throws java.lang.InterruptedException
     */
    public static int executeCommandWithExecutors(final String command,
                                                  final boolean printOutput,
                                                  final boolean printError,
                                                  final long timeOut)
    {
        // validate the system and command line and get a system-appropriate command line 
        String massagedCommand = validateSystemAndMassageCommand(command);

        try
        {
            // create the process which will run the command
            Runtime runtime = Runtime.getRuntime();
            final Process process = runtime.exec(massagedCommand);

            // consume and display the error and output streams
            StreamGobbler outputGobbler = new StreamGobbler(process.getInputStream(), "OUTPUT", printOutput);
            StreamGobbler errorGobbler = new StreamGobbler(process.getErrorStream(), "ERROR", printError);
            outputGobbler.start();
            errorGobbler.start();

            // create a Callable for the command's Process which can be called by an Executor 
            Callable<Integer> call = new Callable<Integer>()
            {
                public Integer call()
                    throws Exception
                {
                    process.waitFor();
                    return process.exitValue();
                }
            };

            // submit the command's call and get the result from a 
            Future<Integer> futureResultOfCall = Executors.newSingleThreadExecutor().submit(call);
            try
            {
                int exitValue = futureResultOfCall.get(timeOut, TimeUnit.MILLISECONDS);
                return exitValue;
            }
            catch (TimeoutException ex)
            {
                String errorMessage = "The command [" + command + "] timed out.";
                log.error(errorMessage, ex);
                throw new RuntimeException(errorMessage, ex);
            }
            catch (ExecutionException ex)
            {
                String errorMessage = "The command [" + command + "] did not complete due to an execution error.";
                log.error(errorMessage, ex);
                throw new RuntimeException(errorMessage, ex);
            }
        }
        catch (InterruptedException ex)
        {
            String errorMessage = "The command [" + command + "] did not complete due to an unexpected interruption.";
            log.error(errorMessage, ex);
            throw new RuntimeException(errorMessage, ex);
        }
        catch (IOException ex)
        {
            String errorMessage = "The command [" + command + "] did not complete due to an IO error.";
            log.error(errorMessage, ex);
            throw new RuntimeException(errorMessage, ex);
        }
    }

    /**
     * Executes a command.
     * 
     * @param command
     * @param printOutput
     * @param printError
     * @param timeOut
     * @return
     * @throws java.io.IOException
     * @throws java.lang.InterruptedException
     */
    public static int executeCommandWithSleep(final String command,
                                              final boolean printOutput,
                                              final boolean printError,
                                              final long timeOut)
    {
        // validate the system and command line and get a system-appropriate command line 
        String massagedCommand = validateSystemAndMassageCommand(command);

        try
        {
            // create the process which will run the command
            Runtime runtime = Runtime.getRuntime();
            Process process = runtime.exec(massagedCommand);

            // consume and display the error and output streams
            StreamGobbler outputGobbler = new StreamGobbler(process.getInputStream(), "OUTPUT", printOutput);
            StreamGobbler errorGobbler = new StreamGobbler(process.getErrorStream(), "ERROR", printError);
            outputGobbler.start();
            errorGobbler.start();

            // run a thread which will set a flag once it has slept for the timeout period
            final boolean[] flags = { true };
            new Thread()
            {
                @Override
                public void run()
                {
                    try
                    {
                        Thread.sleep(timeOut);
                    }
                    catch (InterruptedException ex)
                    {
                        String errorMessage = "Timeout loop thread unexpectedly interrupted.";
                        log.error(errorMessage, ex);
                        throw new RuntimeException(errorMessage, ex);
                    }
                    flags[0] = false;
                }
            }.start();

            // execute the command and wait 
            int returnValue = -1;
            while (flags[0] && (returnValue < 0))
            {
                returnValue = process.waitFor();
            }

            // if the command timed out then log it
            if (returnValue < 0)
            {
                log.warn("The command [" + command + "] did not complete before the timeout period expired (timeout: " +
                         timeOut + " ms)");
            }

            return returnValue;
        }
        catch (InterruptedException ex)
        {
            String errorMessage = "The command [" + command + "] did not complete due to an unexpected interruption.";
            log.error(errorMessage, ex);
            throw new RuntimeException(errorMessage, ex);
        }
        catch (IOException ex)
        {
            String errorMessage = "The command [" + command + "] did not complete due to an IO error.";
            log.error(errorMessage, ex);
            throw new RuntimeException(errorMessage, ex);
        }
    }

    /**
     * Executes a command.
     * 
     * @param command
     * @param printOutput
     * @param printError
     * @param timeOut
     * @return
     * @throws java.io.IOException
     * @throws java.lang.InterruptedException
     */
    public static int executeCommandWithWorker(final String command,
                                               final boolean printOutput,
                                               final boolean printError,
                                               final long timeOut)
    {
        // validate the system and command line and get a system-appropriate command line 
        String massagedCommand = validateSystemAndMassageCommand(command);

        try
        {
            // create the process which will run the command
            Runtime runtime = Runtime.getRuntime();
            Process process = runtime.exec(massagedCommand);

            // consume and display the error and output streams
            StreamGobbler outputGobbler = new StreamGobbler(process.getInputStream(), "OUTPUT", printOutput);
            StreamGobbler errorGobbler = new StreamGobbler(process.getErrorStream(), "ERROR", printError);
            outputGobbler.start();
            errorGobbler.start();

            // create and start a Worker thread which this thread will join for the timeout period 
            Worker worker = new Worker(process);
            worker.start();
            try
            {
                worker.join(timeOut);
                Integer exitValue = worker.getExitValue();
                if (exitValue != null)
                {
                    // the worker thread completed within the timeout period
                    return exitValue;
                }

                // if we get this far then we never got an exit value from the worker thread as a result of a timeout 
                String errorMessage = "The command [" + command + "] timed out.";
                log.error(errorMessage);
                throw new RuntimeException(errorMessage);
            }
            catch (InterruptedException ex)
            {
                worker.interrupt();
                Thread.currentThread().interrupt();
                throw ex;
            }
        }
        catch (InterruptedException ex)
        {
            String errorMessage = "The command [" + command + "] did not complete due to an unexpected interruption.";
            log.error(errorMessage, ex);
            throw new RuntimeException(errorMessage, ex);
        }
        catch (IOException ex)
        {
            String errorMessage = "The command [" + command + "] did not complete due to an IO error.";
            log.error(errorMessage, ex);
            throw new RuntimeException(errorMessage, ex);
        }
    }

    /**
     * Validates that the system is running a supported OS and returns a system-appropriate command line.
     * 
     * @param originalCommand
     * @return
     */
    private static String validateSystemAndMassageCommand(final String originalCommand)
    {
        // make sure that we have a command
        if (originalCommand.isEmpty() || (originalCommand.length() < 1))
        {
            String errorMessage = "Missing or empty command line parameter.";
            log.error(errorMessage);
            throw new RuntimeException(errorMessage);
        }

        // make sure that we are running on a supported system, and if so set the command line appropriately
        String massagedCommand;
        String osName = System.getProperty("os.name");
        if (osName.equals("Windows XP"))
        {
            massagedCommand = "cmd.exe /C " + originalCommand;
        }
        else if (osName.equals("Solaris") || osName.equals("SunOS") || osName.equals("Linux"))
        {
            massagedCommand = originalCommand;
        }
        else
        {
            String errorMessage = "Unable to run on this system which is not Solaris, Linux, or Windows XP (actual OS type: \'" +
                                  osName + "\').";
            log.error(errorMessage);
            throw new RuntimeException(errorMessage);
        }

        return massagedCommand;
    }
} 
```

我创建了一个类来使用和显示命令的输出和错误流（取自[http://www.javaworld.com/javaworld/jw-12-2000/jw-1229-traps.html?page=4](http://www.javaworld.com/javaworld/jw-12-2000/jw-1229-traps.html?page=4)）：

```
package com.abc.network.lifecycle.util;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

/**
 * Utility thread class which consumes and displays stream input.
 * 
 * Original code taken from http://www.javaworld.com/javaworld/jw-12-2000/jw-1229-traps.html?page=4
 */
class StreamGobbler
    extends Thread
{
    static private Log log = LogFactory.getLog(StreamGobbler.class);
    private InputStream inputStream;
    private String streamType;
    private boolean displayStreamOutput;

    /**
     * Constructor.
     * 
     * @param inputStream the InputStream to be consumed
     * @param streamType the stream type (should be OUTPUT or ERROR)
     * @param displayStreamOutput whether or not to display the output of the stream being consumed
     */
    StreamGobbler(final InputStream inputStream,
                  final String streamType,
                  final boolean displayStreamOutput)
    {
        this.inputStream = inputStream;
        this.streamType = streamType;
        this.displayStreamOutput = displayStreamOutput;
    }

    /**
     * Consumes the output from the input stream and displays the lines consumed if configured to do so.
     */
    @Override
    public void run()
    {
        try
        {
            InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
            BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
            String line = null;
            while ((line = bufferedReader.readLine()) != null)
            {
                if (displayStreamOutput)
                {
                    System.out.println(streamType + ">" + line);
                }
            }
        }
        catch (IOException ex)
        {
            log.error("Failed to successfully consume and display the input stream of type " + streamType + ".", ex);
            ex.printStackTrace();
        }
    }
} 
```

我创建了一个大约需要 10 秒才能完成的测试命令：

```
#!/bin/bash
sleep 10
echo 'TEST COMMAND RAN OK' 
```

然后我创建了一个测试程序来测试三种不同的方法，分别以 5 秒的超时值（命令应该失败）和 15 秒的超时值（命令应该成功）调用每个方法：

```
package com.abc.network.lifecycle.util;

public class ProcessUtilityTester
{

    /**
     * @param args
     */
    public static void main(final String[] args)
    {
        try
        {
            String command = args[0];
            int exitValue = -1;
            System.out.println("\n\n5000ms timeout With Executors:");
            try
            {
                exitValue = -1;
                exitValue = ProcessUtility.executeCommandWithExecutors(command, true, true, 5000);
            }
            catch (Exception ex)
            {
                ex.printStackTrace();
            }
            finally
            {
                System.out.println("\nExit value:" + exitValue);
            }
            System.out.println("\n\n5000ms timeout With Sleep:");
            try
            {
                exitValue = -1;
                exitValue = ProcessUtility.executeCommandWithSleep(command, true, true, 5000);
            }
            catch (Exception ex)
            {
                ex.printStackTrace();
            }
            finally
            {
                System.out.println("\nExit value:" + exitValue);
            }
            System.out.println("\n\n5000ms timeout With Worker:");
            try
            {
                exitValue = -1;
                exitValue = ProcessUtility.executeCommandWithWorker(command, true, true, 5000);
            }
            catch (Exception ex)
            {
                ex.printStackTrace();
            }
            finally
            {
                System.out.println("\nExit value:" + exitValue);
            }
            System.out.println("\n\n15000ms timeout With Executors:");
            try
            {
                exitValue = -1;
                exitValue = ProcessUtility.executeCommandWithExecutors(command, true, true, 15000);
            }
            catch (Exception ex)
            {
                ex.printStackTrace();
            }
            finally
            {
                System.out.println("\nExit value:" + exitValue);
            }
            System.out.println("\n\n15000ms timeout With Sleep:");
            try
            {
                exitValue = -1;
                exitValue = ProcessUtility.executeCommandWithSleep(command, true, true, 15000);
            }
            catch (Exception ex)
            {
                ex.printStackTrace();
            }
            finally
            {
                System.out.println("\nExit value:" + exitValue);
            }
            System.out.println("\n\n15000ms timeout With Worker:");
            try
            {
                exitValue = -1;
                exitValue = ProcessUtility.executeCommandWithWorker(command, true, true, 15000);
            }
            catch (Exception ex)
            {
                ex.printStackTrace();
            }
            finally
            {
                System.out.println("\nExit value:" + exitValue);
            }
        }
        catch (Exception ex)
        {
            ex.printStackTrace();
        }
        finally
        {
            System.exit(0);
        }
    }

} 
```

这是我在运行测试程序时看到的：

```
5000ms timeout With Executors:
May 1, 2009 1:55:19 AM com.abc.network.lifecycle.util.ProcessUtility executeCommandWithExecutors
SEVERE: The command [/tmp/testcmd.sh] timed out.
java.util.concurrent.TimeoutException
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:228)
        at java.util.concurrent.FutureTask.get(FutureTask.java:91)
        at com.abc.network.lifecycle.util.ProcessUtility.executeCommandWithExecutors(ProcessUtility.java:179)
        at com.abc.network.lifecycle.util.ProcessUtilityTester.main(ProcessUtilityTester.java:19)
java.lang.RuntimeException: The command [/tmp/testcmd.sh] timed out.
        at com.abc.network.lifecycle.util.ProcessUtility.executeCommandWithExecutors(ProcessUtility.java:186)
        at com.abc.network.lifecycle.util.ProcessUtilityTester.main(ProcessUtilityTester.java:19)
Caused by: java.util.concurrent.TimeoutException
        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:228)
        at java.util.concurrent.FutureTask.get(FutureTask.java:91)
        at com.abc.network.lifecycle.util.ProcessUtility.executeCommandWithExecutors(ProcessUtility.java:179)
        ... 1 more

Exit value:-1

5000ms timeout With Sleep:
OUTPUT>TEST COMMAND RAN OK
OUTPUT>TEST COMMAND RAN OK

Exit value:0

5000ms timeout With Worker:
May 1, 2009 1:55:34 AM com.abc.network.lifecycle.util.ProcessUtility executeCommandWithWorker
SEVERE: The command [/tmp/testcmd.sh] timed out.
java.lang.RuntimeException: The command [/tmp/testcmd.sh] timed out.
        at com.abc.network.lifecycle.util.ProcessUtility.executeCommandWithWorker(ProcessUtility.java:338)
        at com.abc.network.lifecycle.util.ProcessUtilityTester.main(ProcessUtilityTester.java:47)

Exit value:-1

15000ms timeout With Executors:
OUTPUT>TEST COMMAND RAN OK
OUTPUT>TEST COMMAND RAN OK

Exit value:0

15000ms timeout With Sleep:
OUTPUT>TEST COMMAND RAN OK

Exit value:0

15000ms timeout With Worker:
OUTPUT>TEST COMMAND RAN OK

Exit value:0 
```

因此，据我所知，使用 Worker 线程类的方法效果最好，因为它在两种情况下都给出了预期的结果。使用 Executors 的方法也可以按预期工作，但需要注意的是，它似乎在 15000 毫秒 timout 情况下运行了两次命令（即，我看到了两次命令的输出）。使用 sleep() 方法的方法不会在 5000 毫秒超时情况下按预期使命令超时，并显示两次输出，但在 15000 毫秒超时情况下按预期运行命令。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-01T19:10:29.800

对于使用执行器框架的每个人：你们都忘记关闭执行器。因此将其更改为以下内容：

```
ExecutorService service = Executors.newSingleThreadExecutor();
try {
    Future<Integer> ft = service.submit(call);
    try {
        int exitVal = ft.get(2000L, TimeUnit.MILLISECONDS);
        return exitVal;
    } catch (TimeoutException to) {
        p.destroy();
        throw to;
    }
}
finally {
    service.shutdown();
} 
```

如果你不这样做，你的程序将保持一个活动的非守护线程，确保你的程序永远不会退出，直到你调用 System.exit

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-12-01T02:13:09.993

对于那些不能使用新的 Java 8 方法 [`waitFor(long timeout, TimeUnit unit)`](https://docs.oracle.com/javase/8/docs/api/java/lang/Process.html#waitFor-long-java.util.concurrent.TimeUnit-)（因为他们在 Android 上或者根本无法升级）的人，您可以简单地从 JDK 源代码中将其撕下来，并将其添加到您的 utils 文件中的某个位置：

```
public boolean waitFor(long timeout, TimeUnit unit, final Process process)
            throws InterruptedException
    {
        long startTime = System.nanoTime();
        long rem = unit.toNanos(timeout);

        do {
            try {
                process.exitValue();
                return true;
            } catch(IllegalThreadStateException ex) {
                if (rem > 0)
                    Thread.sleep(
                            Math.min(TimeUnit.NANOSECONDS.toMillis(rem) + 1, 100));
            }
            rem = unit.toNanos(timeout) - (System.nanoTime() - startTime);
        } while (rem > 0);
        return false;
    } 
```

我对 JDK8 源代码中的原始代码所做的唯一更改是添加了 `Process`参数，以便我们可以[`exitValue`](https://docs.oracle.com/javase/8/docs/api/java/lang/Process.html#exitValue--)从进程中调用该方法。

如果进程尚未终止，该[`exitValue`](https://docs.oracle.com/javase/8/docs/api/java/lang/Process.html#exitValue--)方法将直接尝试返回或抛出一个。`IllegalThreadStateException`在这种情况下，我们等待收到的超时并终止。

该方法返回一个布尔值，因此如果它返回 false，那么您知道您需要手动终止该进程。

这种方式似乎比上面发布的任何方法都简单（当然可以直接调用 waitFor）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-07-25T21:20:53.257

小型应用程序的轻量级解决方案：

```
public class Test {
    public static void main(String[] args) throws java.io.IOException, InterruptedException {   
        Process process = new ProcessBuilder().command("sleep", "10").start();

        int i=0;
        boolean deadYet = false;
        do {
            Thread.sleep(1000);
            try {
                process.exitValue();
                deadYet = true;
            } catch (IllegalThreadStateException e) {
                System.out.println("Not done yet...");
                if (++i >= 5) throw new RuntimeException("timeout");
            }
        } while (!deadYet);
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-30T18:04:26.287

如果调用超过您的阈值才能完成，则作为委托实施并失败。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-30T18:04:49.123

如果有可用的，请尝试在单独的线程或事件队列中使用 Timer（或 Sleep()）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-30T19:45:01.350

有多种方法可以做到这一点，但我会考虑使用 Executor——它只是帮助您封装将退出值或异常从线程传递回原始调用者。

```
 final Process p = ...        
    Callable<Integer> call = new Callable<Integer>() {
    public Integer call() throws Exception {
        p.waitFor();
        return p.exitValue();
      }
    };
    Future<Integer> ft = Executors.newSingleThreadExecutor().submit(call);
    try {
      int exitVal = ft.get(2000L, TimeUnit.MILLISECONDS);
      return exitVal;
    } catch (TimeoutException to) {
      p.destroy();
      throw to;
    } 
```

我认为你无法绕过等待超时的竞争条件，然后进程在你调用destroy()之前终止。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-05-21T18:22:07.037

我还测试了 worker 的实现，并且像一个魅力一样工作。在处理进程io下，我添加了线程来处理stde和stdo。如果工作线程超时，我也会退出 io 线程。

```
Process p = Runtime.getRuntime().exec(cmd.trim());

            //setup error and output stream threads
            CommandStreamThread eStream = new CommandStreamThread(p.getErrorStream(), "STDE");            
            CommandStreamThread oStream = new CommandStreamThread(p.getInputStream(), "STDO");

            // kick them off
            eStream.start();
            oStream.start();

            //setup a worker thread so we can time it out when we need
            CommandWorkerThread worker=new CommandWorkerThread(p);
            worker.start();

            try {
                worker.join(this.getTimeout());
                if (worker.getExit() != null)
                    return worker.getExit();
                else
                    throw new TimeoutException("Timeout reached:"+this.getTimeout()+" ms");
            } catch(InterruptedException ex) {
                eStream.interrupt();
                oStream.interrupt();
                worker.interrupt();
                Thread.currentThread().interrupt();
                throw ex;
            } finally {
                p.destroy();
            } 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-10-21T16:58:08.587

首先是一些背景信息，我遇到了运行命令时超时的问题，因为我尝试执行的程序永远不会在出现错误的情况下打印任何调试或错误信息，并且只会继续自行在内部重试导致进程卡住因为重试时从来没有错误或输出流。

所以在`process.exec()`or`process.start()`之后

它会永远卡在这条线上，

`BufferedReader input = new BufferedReader(newInputStreamReader(process.getInputStream()));`

根据 java 1.8 with`public boolean waitFor(long timeout,TimeUnit unit)`方法，它应该在指定的超时后“理想地”超时，但在我的情况下，由于某种原因它从未超时可能是因为我正在将应用程序作为 Windows 服务运行（我已经检查了用户权限和一切帐户，但没有帮助）。

所以我尝试用下面的逻辑来实现它，我们将继续检查输入流`input.ready()`和一个超时标志。与所有其他现有的解决方案相比，这个简单的解决方案就像一个魅力。

代码：

```
public boolean runCommand() throws IOException, InterruptedException, Exception {
    StringBuilder rawResponse = new StringBuilder();
    System.out.println("Running Command " + Arrays.toString(command));
    ProcessBuilder processBuilder = new ProcessBuilder(Arrays.asList(command));
    processBuilder.redirectErrorStream(true);
    Process process = processBuilder.start(); //Executing the process
    BufferedReader input = new BufferedReader(new InputStreamReader(process.getInputStream()));
    waitForTimeout(input, process); //Waiting for Timout
    String line;
    while ((line = input.readLine()) != null) {
        rawResponse.append(line).append("\n");
    }
    return true;
}

//Timeout method 
private void waitForTimeout(BufferedReader input, Process process) throws InterruptedException, Exception {
    int timeout = 5;
    while (timeout > 0) {
        if (!process.isAlive() || input.ready()) {
            break;
        } else {
            timeout--;
            Thread.sleep(1000);
            if (timeout == 0 && !input.ready()) {
                destroyProcess(process);
                throw new Exception("Timeout in executing the command "+Arrays.toString(command));
            }
        }
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-30T18:12:45.063

您可以启动一个在您想要的时间内休眠的线程，并在休眠后更改您在 executeCommandLine 方法中循环的布尔值。

类似的东西（未经测试或编译，此解决方案是一个原型，如果适合您的需要，您应该重构它）：

```
public static int executeCommandLine(final String commandLine,
                                     final boolean printOutput,
                                     final boolean printError)
    throws IOException, InterruptedException
{
    Runtime runtime = Runtime.getRuntime();
    Process process = runtime.exec(commandLine);

    if (printOutput)
    {
        BufferedReader outputReader = new BufferedReader(new InputStreamReader(process.getInputStream()));
        System.out.println("Output:  " + outputReader.readLine());
    }

    if (printError)
    {
        BufferedReader errorReader = new BufferedReader(new InputStreamReader(process.getErrorStream()));
        System.out.println("Error:  " + errorReader.readLine());
    }

    ret = -1;
    final[] b = {true};
    new Thread(){
       public void run(){
           Thread.sleep(2000); //to adapt
           b[0] = false;
       }
    }.start();
    while(b[0])
    {
          ret = process.waitFor();
    }

    return ret;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-05-24T13:05:21.797

这是 StreamThread

```
public class CommandStreamThread extends Thread{
        private InputStream iStream;
        private String cPrompt;

        CommandStreamThread (InputStream is, String cPrompt)
        {
            this.iStream = is;
            this.cPrompt = cPrompt;
        }

        public void run()
        {
            try
            {
                InputStreamReader streamReader= new InputStreamReader(this.iStream);
                BufferedReader reader = new BufferedReader(streamReader);

                String linesep=System.getProperty("line.separator");
                String line=null;
                while ((line=reader.readLine())!=null){
                    System.out.println(line);
                    //Process the next line seperately in case this is EOF is not preceded by EOL
                    int in;
                    char[] buffer=new char[linesep.length()];
                    while ( (in = reader.read(buffer)) != -1){
                        String bufferValue=String.valueOf(buffer, 0, in);
                        System.out.print(bufferValue);
                        if (bufferValue.equalsIgnoreCase(linesep))
                            break;
                    }
                }

                //Or the easy way out with commons utils!
                //IOUtils.copy(this.iStream, System.out);

              } catch (Exception e){
                    e.printStackTrace();  
              }
        }

        public InputStream getIStream() {
            return iStream;
        }

        public void setIStream(InputStream stream) {
            iStream = stream;
        }

        public String getCPrompt() {
            return cPrompt;
        }

        public void setCPrompt(String prompt) {
            cPrompt = prompt;
        }

} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-09-11T04:49:45.277

Apache Commons Exec 可以帮助您做到这一点。

见[http://commons.apache.org/proper/commons-exec/tutorial.html](http://commons.apache.org/proper/commons-exec/tutorial.html)

```
String line = "your command line";
CommandLine cmdLine = CommandLine.parse(line);
DefaultExecutor executor = new DefaultExecutor();
ExecuteWatchdog watchdog = new ExecuteWatchdog(60000);
executor.setWatchdog(watchdog);
ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
PumpStreamHandler streamHandler = new PumpStreamHandler(outputStream);
executor.setStreamHandler(streamHandler);
int exitValue = executor.execute(cmdLine);
System.out.println(exitValue);
System.out.println(outputStream.toString()); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-10-02T23:14:58.663

如果使用 Java 8，我会选择 Aleksander Blomskøld answer iepwaitFor(1, TimeUnit.MINUTE)

否则，如果 Java 6/7 并使用 Swing，那么您可以使用 SwingWorker：

```
 final Process process = ...
   SwingWorker<Integer, Integer> sw = new SwingWorker<>() {
       @Override
       protected Integer doInBackground() throws Exception {
          process.waitFor();
          return process.exitValue();
       }
   };
   sw.execute();                
   int exitValue = sw.get(1, TimeUnit.SECONDS);
   if (exitValue == 0) {
       //everything was fine
   } else {
       //process exited with issues
   } 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-10-05T13:21:44.270

我知道这是一个很老的帖子；我在一个类似的项目中需要一些帮助，所以我想我可以提供一些我工作过的代码和那些工作的代码。

```
long current = System.currentTimeMillis();

ProcessBuilder pb  = new ProcessBuilder(arguments);
try{
    pb.redirectErrorStream(true);
    process = pb.start();
    int c ;
    while((c = process.getInputStream().read()) != -1 )
        if(System.currentTimeMillis() - current < timeOutMilli) 
            result += (char)c;
        else throw new Exception();
    return result.trim();
    }catch(Exception e){
        e.printStackTrace();
    }
    return result; 
```

希望这对未来有所帮助：D

# c# - ASP NET 共享帐户中的安全错误

> ID：808281
> 
> 赞同：0
> 
> 时间：2009-04-30T18:03:37.380
> 
> 标签：c#, .net, asp.net, .net-3.5

这些行会导致 godaddy 帐户中的安全异常。有什么建议如何重写以使其正常工作？

```
File.Delete(PropsFileName);     // Clean up

TextWriter tw = new StreamWriter(PropsFileName);    // Create & open the file
tw.WriteLine(DateTime.Now);     // Write the date for reference
tw.WriteLine(TokenLine);        // Write the BinarySecurityToken
tw.WriteLine(ConvIdLine);       // Write the ConversationId
tw.WriteLine(ipccLine);     // Write the IPCC
tw.Close(); 
```

谢谢！

该信息正在写入临时目录中的 session.properties 变量。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T18:22:41.907

GoDaddy 设置为在中等信任下运行，要在 localhost 上模拟此操作，请将以下内容添加到您的 web.config：

```
<system.web>
    <trust level="Medium" />
</system.web> 
```

您可以尝试解决问题的方法是将以下内容添加到您的 AssemblyInfo.cs 下的 Project > Properties 在解决方案资源管理器中

```
[assembly: AllowPartiallyTrustedCallers] 
```

这里还有一篇文章可能会或可能不会帮助您和/或让您了解有关 NHibernate 的类似情况：[NHibernate in a Medium Trust Environment](http://www.gavaghan.org/blog/2007/08/21/nhibernate-in-a-medium-trust-environment/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T18:06:38.107

您应该向运行 ASP.NET 应用程序的用户授予 NTFS 权限。您的主机控制面板可能支持为文件夹分配 NTFS 权限。

# silverlight - 您是否希望查询字符串参数名称区分大小写？

> ID：808282
> 
> 赞同：4
> 
> 时间：2009-04-30T18:03:44.180
> 
> 标签：silverlight, query-string

Silverlight 对查询字符串参数区分大小写，因此以下代码将使用“callid=5”返回 false

```
string callId;
if (System.Windows.Browser.HtmlPage.Document.QueryString.TryGetValue("callId", out callId))
{
....
} 
```

微软通过引用 www.w3.org 规范为该决定辩护，但我认为这会导致人们试图链接到您或通过电话提供 URL 的体验不太友好。

看起来 Stackoverflow 不区分大小写： [https://stackoverflow.com/search?q=silverlight+bug](https://stackoverflow.com/search?q=silverlight+bug) [https://stackoverflow.com/search?Q=silverlight+bug](https://stackoverflow.com/search?Q=silverlight+bug)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T18:18:26.907

我认为你应该关注你的命名约定而不是标准的实现，确保避免类似的字段名称和混合大小写。例如，您可以使用可以通过电话读出的单词约定，说明“全部小写”或“全部大写”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-05-26T17:08:43.860

我这样做了。不知道有没有帮助。

```
var keyName = "";
if (!string.IsNullOrEmpty(keyName = someDictionary.SomeKeys.FirstOrDefault(k => k.ToLowerInvariant() == "size")))
{
    var someValue = someDictionary[keyName];
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T18:16:01.517

是的，我习惯了它区分大小写，因此已经为它编程了很长时间。我知道有些人已经实现了一些方法来进行中间解析以将它们全部转换为小写，或者服务器端的其他东西，这实际上取决于你具体使用的是什么。

至于可用性，是的，它更难阅读。但是，与此同时，电话上具有查询字符串的 URL 无论如何都不容易提供。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-27T07:53:17.447

此解决方法不会使用字典的强大功能，因为它将遍历所有键，但对于大多数情况来说，它可能是一个足够的解决方法。

```
var keyName = HtmlPage.Document.QueryString.Keys.SingleOrDefault(key => key.Equals("callid", StringComparison.OrdinalIgnoreCase));

string callid;
HtmlPage.Document.QueryString.TryGetValue(keyName, out callid) 
```

如果您有许多字典查找，您还可以使用不区分大小写的比较器将整个 QueryString 字典转换为新字典。

```
var insensitiveQueryString = HtmlPage.Document.QueryString.ToDictionary(pair => pair.Key, pair => pair.Value, StringComparer.OrdinalIgnoreCase); 
```

# wcf - 如何使用命名管道绑定从 Delphi 与 WCF 通信

> ID：808287
> 
> 赞同：4
> 
> 时间：2009-04-30T18:04:28.797
> 
> 标签：wcf, delphi, delphi-2007, netnamedpipebinding

我可以使用 Delphi 2007 与使用 netnamedpipebinding 的 WCF 服务进行通信吗？

如果是这样，那怎么办？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T21:15:01.663

是的，您应该能够做到这一点，只要您可以让 Delphi 2007 与 Windows 命名管道通信。

这是[Delphi 3000 上的一篇](http://www.delphi3000.com/articles/article_2918.asp?SK=)关于如何使用 Delphi 与命名管道通信的文章，包括一些代码示例。

由于命名管道是 Windows NT/XP/Vista 的基本核心功能，Delphi 应该能够与那些没有问题的通信（读 + 写）。

这些帮助有用？马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-15T17:09:17.577

我建议您使用 .NET（和 WCF！）为您的服务创建一个 COM 可见代理，然后像使用任何 COM 对象一样从 Delphi 使用它。

为侦听 NetNamedPipesBinding 端点的 WCF 服务实现本机客户端非常复杂的原因有很多。有关详细信息， 请参阅[http://blogs.charteris.com/blogs/chrisdi 。](http://blogs.charteris.com/blogs/chrisdi)

# c# - 在控件之间连接通用功能

> ID：808290
> 
> 赞同：1
> 
> 时间：2009-04-30T18:05:34.303
> 
> 标签：c#, interface

我不确定如何问这个问题。假设我有一个类需要访问控件的某些属性（例如，可见性和位置）。也许我想使用同一个类来访问具有相同名称的另一个项目的属性，但该类可能不是从 Control 派生的。所以我尝试制作一个界面：

```
public interface IThumbnail {

    bool    Visible     { get; set; }
    int     Height      { get; set; }
    int     Width       { get; set; }
    Image   Image       { get; set; }
    Point   Location    { get; set; }

    event EventHandler Click;
} 
```

请注意，例如，PictureBox 恰好实现了此接口。但是，因为类定义没有*说它*实现了 IThumbnail，所以我不能将 PictureBoxes 转换为 IThumbnails——我在运行时得到一个 InvalidCastException。但是为什么 CLR 不能“弄清楚”PictureBox 确实实现了 IThumbnail（它只是没有明确表示它确实实现了）。

另外，我应该怎么做才能处理这种情况？我想要一种方法来访问PictureBox 的*某些*属性，而无需让我的班级知道它正在修改 PictureBox。

谢谢，山姆

PS-我是接口编程的新手，所以如果这是一个愚蠢的问题，我深表歉意。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T18:19:59.290

这不是一个愚蠢的问题，这是一个很好的问题。:)

您在界面上要求的内容通常称为“ [duck-typing](http://en.wikipedia.org/wiki/Duck_typing) ”。目前不支持，但 C#4.0 将通过新的“ [`dynamic`](https://stackoverflow.com/questions/301479/show-me-the-way-to-use-new-dynamic-keyword-in-c-4-0)”关键字支持它。

在这一点上，您确实有三个选择：

1.  您可以上树，直到找到共同的祖先（可能[`Component`](http://msdn.microsoft.com/en-us/library/system.componentmodel.component.aspx)），然后向下转换为您支持的类型。如果向下转型失败，你会适当地抛出或处理。

    **优点：**最少的代码重复。

    **缺点：**您正在用编译时类型安全换取运行时类型安全。您必须为无效转换添加错误检查/处理。

    **代码：**

    ```
    public void UseThumbnail(Component c) 
    {
        PictureBox p = c as PictureBox;
        if(p != null) // do whatever
        // so forth
    } 
    ```

2.  您可以根据需要为实现此功能的所有内容复制功能。

    **优点：**维护编译时类型安全

    **缺点：**您正在为不同类型复制代码。这可能会成为重大的维护负担，尤其是在您处理两个以上类似的类时。

    **代码：**

    ```
    public void UsePictureBox(PictureBox p)
    {
        // Some code X
    }

    public void UseOtherControl(OtherControl p)
    {
        // Some code X
    } 
    ```

3.  您可以创建您的特殊接口并将您想要支持的类子类化以公开该通用功能。

    **优点：**您可以获得编译时安全性，并且可以针对您的新界面进行编程。

    **缺点：**您必须为您正在处理的所有内容添加一个空子类，并且您需要使用它们。

    **代码：**

    ```
    public class ThumbnailPictureBox : PictureBox, IThumbnail 
    { } 
    ```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T18:08:05.980

我想你必须让你自己的类派生自 PictureBox。这个新类也将实现 IThumbnail。

```
public class MyPictureBox : PictureBox, IThumbnail {

} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T18:23:25.477

CLR 无法确定 PictureBox 实现了与 IThumbnail 相同的方法签名，因为它尚不受支持。您在这里谈论的功能通常被称为[Duck Typing](http://en.wikipedia.org/wiki/Duck_typing)，它是 Ruby 等动态语言的一个功能 - 它应该在 .NET 和 C# 以及下一个版本 (C# 4) 和 DLR（动态语言运行时）中可用）。

要获得您现在需要的功能，您可以编写一个实现 IThumbnail 接口并封装 PictureBox 实例的类。

```
public class ThumbnailPictureBox
{
  private PictureBox _pictureBox;

  public ThumbnailPictureBox(PictureBox pictureBox)
  {
    _pictureBox = pictureBox;
  }

  public bool Visible
  {
    get { return _pictureBox.Visible; }
    set { _pictureBox.Visible = value; }
  }

 // etc...
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T18:18:08.890

您可以创建自己的类来实现接口并在幕后有一个 PictureBox

```
class MyPictureBox: IThumbnail
{
    private PictureBox _pictureBox = new PictureBox();

    bool Visible     
    { 
        get 
        { 
            return _pictureBox.Visible; 
        } 
        set 
        { 
            _pictureBox.Visible = value; 
        }
    }

    //implement the rest, you get the idea
} 
```

如果您想扩展第 3 方的密封“图片框”，这种模式也很有用，在这种情况下，您将无法从它扩展。

实际上，Derik Whittaker 刚刚在 dimecasts.net 上就这种模式做了一个不错的播[客](http://www.dimecasts.net/Casts/CastDetails/106)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T18:22:13.933

如果您有兴趣为其创建接口的类不是“密封的”，那么您可以创建一个新类并从非密封类继承，实现接口。

如果它*是*密封的（我不认为 PictureBox 是密封的），您可能想要构建一个包装类来实现您感兴趣的接口并包含一个 PictureBox 控件，只公开您感兴趣的成员.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T18:20:48.463

.net 运行时中有数百个接口。如果让接口隐式实现，编译器会自动将接口与类匹配，那么您编写的每个类都可能与您甚至不想要的接口匹配。

正如其他海报所建议的那样，您的情况正是 OO 要解决的问题；) 尝试扩展 PictureBox 来实现您的界面。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T18:29:52.607

您所描述的情况正是接口的用途

```
public interface IThumbnail
{
   bool Visible {get; set;}
   string FilePath {get; set;}
}

public class Bar : IFoo
{
   bool Visible {get; set;}
   int SomeNumber {get; set;}
   /* 
     rest of Bar functionality
   */
}

public class SomeClass
{
   public void DisplayThumbnail(IThumbnail thumb)
   {
      //Do Stuff to things.
   }
} 
```

一旦以这种方式实现，对于程序的任何方面，如果不应该访问任何 Bar 功能，但应该可以访问任何 IThumbnail 功能，只需向它们传递一个 IThumbnail 类型的对象

```
Bar bar = new Bar();

SomeClass someClass = new SomeClass();

someClass.DisplaySomething((IThumbnail) bar); 
```

现在 DisplaySomething 函数无法访问任何 Bar 专有功能。它只能访问它的 IThumbnail 特定部分。

**编辑**

这个问题处理同样的问题 [C#4.0 是否允许`dynamic`强制转换，如果没有，应该吗？](https://stackoverflow.com/questions/808384/will-c4-allow-dynamic-casting-if-not-should-c-support-it)

# vim - 如何将不可鼠标选择的行号添加到 vim？

> ID：808298
> 
> 赞同：32
> 
> 时间：2009-04-30T18:07:32.877
> 
> 标签：vim

所以我已经想出了如何将行号添加到 vim（：set no 或 :set number），但是我怎样才能做到这一点，以便当我在终端模拟器中使用鼠标选择一行行时，它也不会选择数字？

例如，假设我在 vim 中有三行看起来像这样：

```
1    First line
2    Second
3    Third 
```

如果我想用鼠标选择三行，我想要的是它只选择实际的文本。但最终发生的是它选择行号以及行号左右两侧的所有空间。

有没有办法改变这种行为？顺便说一句，我在 gnome 中使用 gnome 终端编辑器，如果这有所作为的话。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-05-01T13:53:26.350

使用以下内容：

```
:set mouse=a 
```

在所有模式下打开 xterm 风格的鼠标。这将允许你做你想做的事。请记住，如果 vim 是通过 ssh 远程访问的，则需要打开 X11 转发才能将选择发送到本地剪贴板。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-30T18:40:24.500

AFAIK，这是不可能的。

我现在唯一可以补充的是，你会更好

```
:set invnumber 
```

它将反转当前条件，因此您可以将其映射到一个键并切换它。这样您就不必记住两个命令。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-30T18:22:23.327

我同意第一个答案。如果您使用 gvim，您可以尝试使用`set mouse=n`and `set mouse=a`，这应该会改变行号选择行为。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-30T18:38:47.670

当我想在终端中选择文本时，我删除了行号。

```
:set nonu 
```

当我完成

```
:set nu 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-30T18:43:37.753

您可能不在 Macintosh 上，我不知道您的意思是要使用系统副本而不是 vim 的 yank。

但如果你是这两个东西，你可以使用选项拖动来选择文本。这会在文本上创建一个 2d 框，选择它下面的东西。它在功能上应该与“将行 y1 到 y2 的列 x1 到 x2”相同。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-30T18:16:53.447

我很确定这在终端 vim 中是不可能的。据我所知，没有公认的标准（例如 TTY 转义）来指示无法通过鼠标突出显示的字符块。

如果您想不惜一切代价做到这一点，我会使用**gvim 。**它的行为如你所描述。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-30T18:31:59.230

我的建议是习惯屏幕右上角的小框，里面有当前行数和字符位置信息。在我使用 vim 之前，我无法想象没有行号的生活，但从那以后我已经超越了这一点。屏幕上没有行号混乱可以无干扰地查看代码，您是否真的需要知道当前活动行上方的行号比当前行号少一，而下面的行多一？

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2017-02-27T13:53:26.987

没有鼠标的副本：

进入可视模式：定位光标，按***v***（对于完整行***V***）向上或向下移动直到所需位置

按**control + c**复制到剪贴板（如果*+clipboard*存在于*:ve*命令输出中）按**ESC并使用****control + v**将其粘贴到您想要的任何位置。

或按**y**拉入寄存器并按**p**将文本放在光标后

# c# - 在多线程应用程序中使用类变量是不是很糟糕？

> ID：808301
> 
> 赞同：1
> 
> 时间：2009-04-30T18:08:29.350
> 
> 标签：c#, multithreading, variables

我继承了一个需要多线程的项目。工作线程中使用了三个主要类。

BASE CLASS - 具有类级别的 SqlDataAdapter 和 DataTable。INHERITED CLASS ONE - 使用继承的 SqlDataAdapter 和 DataTable。INHERITED CLASS 2 - 使用继承的 SqlDataAdapter 和 DataTable。

每件事都可以正常工作，但我只有两个用户同时进行测试。

让 SqlDataAdapter 和 DataTable 成为类级变量是个坏主意吗？

**更新** 抱歉，它是 SqlDataAdapter 而不是 SqlTableAdapter。语言是 C#。SqlDataAdapter 和 DataTable 来自 System.Data.SqlClient 命名空间。

下面是一些基类：

```
public abstract class BaseSync
{
    #region Variables
    internal SqlDataAdapter stageDataAdapter;
    internal DataTable stageDataTable;
    #endregion //Variables
} 
```

**第二部分**

还有一个所有派生类都使用的单例实用程序类。不知道会不会出问题。它看起来像这样：

```
public class Utility
{ 
    private static readonly Utility _utility= new Utility();

    private Utility()
    { }

    public static Utility GetUtility()
    {
        return _utility;
    }

    public int GetAutoNumber(string tablename, string fieldname, string siteId)
    {
        string _tablename = tablename;
        string _fieldname = fieldname;
        ...
    }

    internal MissingInfo NormalizeRow(DataRow dataRow)
    {

        MissingInfo retVal = MissingInfo.None;

        //Num
        if (dataRow["Num"] == DBNull.Value)
        {
           retVal =MissingInfo.Num;
           dataRow["Num"] = 1;
        }
        ...
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T18:12:53.130

这取决于对象的访问级别。只要它们不是静态的（在 VB.NET 中共享）。只要每个线程都有自己的对象实例，将它们放在对象中应该没问题。

您遇到有趣情况的地方是所有实例共享的静态成员。

所以总而言之，我们需要查看代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T18:13:30.617

在没有同步的情况下由不同的线程修改变量总是一个*非常糟糕的主意*。

你没有提到是否是这种情况。如果你线程，你需要计划和检查你在做什么。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T18:15:45.573

关于变量的规则是，它们可能发生变化的地方越多，竞争条件的可能性就越大，尤其是在应用程序发展的情况下。

您的问题中没有太多信息，因此很难提供具体答案。类级别的变量（如果是公共的）通常可以被视为全局变量，因此可以从任何地方访问，从而增加了损坏的风险。

一种可能的方法可能是隐藏这些字段并通过类级函数提供访问。然后您可以做更多的事情，因为您已经创建了对这些变量的特定访问点。您需要小心确保您永远不会向应用程序提供对该对象的直接和可变引用，这可能需要进行一些重写，但这会使您的程序更安全。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T18:13:38.353

在多线程中共享非常量对象时，您应该始终考虑进行同步，否则有一天您会搞砸的……

所以，如果你想让它成为一个类变量是可以的，但记住要为它做一些锁定机制。

# asp.net - ASPX 的 XML 架构？

> ID：808305
> 
> 赞同：0
> 
> 时间：2009-04-30T18:10:13.417
> 
> 标签：asp.net, xsd, relaxng

这些天我在 Emacs 中编辑了很多 .aspx 文件。nxml-mode 可以使用模式（RELAX NG，但可能还有其他）来检测 XML 中的错误，我发现它对于其他事情非常方便。

*.aspx 文件是否有 RELAX NG 架构？

（我在搜索时遇到了麻烦，因为“aspx”不仅作为一种语言而且作为 URL 的一部分如此普遍。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-03T15:41:27.777

我不认为 ASPX 是一种 XML 格式。例如，我认为 <%@ 不是有效的 XML。

# java - 您可以从 Web 应用程序（flash、java）建立 http 客户端连接吗？

> ID：808309
> 
> 赞同：0
> 
> 时间：2009-04-30T18:10:48.563
> 
> 标签：java, flash, http, applet

在我双脚投入并浪费时间学习一些我无法满足我需求的东西之前，我必须问：

我可以从 java applet 或 flash 文件中与另一个网站建立 http 连接吗？

假设我有一个想要从谷歌加载结果的 java 小程序。JVM 会让我访问这样的调用吗？快闪呢？我已经阅读了有关 URLLoader 的信息，但对此感到困惑：

" * 如果调用文件在 local-with-file-system 沙箱中并且目标资源来自网络沙箱，则不允许数据加载。 * 如果调用文件来自网络沙箱并且目标资源是本地的。”

无论如何，如果不可能，它会默默地在用户身上失败还是会请求许可？

非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T18:17:15.070

当然，您可以在 Java 中做到这一点，也可以在 flash 中做到这一点。但是，某些浏览器和环境可能会通过强制安全级别来限制。

您发现的警告与本地<->远程有关。对于托管在网络上的 Web 应用程序，您通常可以访问其他网络资源。（好吧，有些人可能会限制您使用“其他”域 - 您需要检查安全模型）

但现代技术通常建议您结合 JavaScript 来做到这一点。谷歌搜索“Ajax”并搜索一些最符合您要求的框架——这将节省大量时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T18:17:44.413

是的，但问题是出于安全原因，许多浏览器只允许应用程序连接到应用程序来自的域。

例如，如果我访问网站 A 并且我的应用程序试图访问网站 B，它有时可能会被阻止（例如，为了避免垃圾邮件、攻击等）。如果您控制网站 A，解决方法是在网站 A 上创建一个“传递”脚本，将请求发送给 B。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T18:18:31.993

> 我可以从 java applet 或 flash 文件中与另一个网站建立 http 连接吗？

来自 Flash，是的。您确实需要阅读 Flash 安全模型，以确保您可以问什么，不可以问什么。大多数情况下，这是为了阻止未经授权的访问和/或 XSS 或类似攻击。例如，Flex（一项相关技术）不能让您访问磁盘，而 AIR 可以。任你选。

至于小程序，您将不得不等待其他人向您解释。但是 AFAIK，它也有一个安全模型，对用户构成的威胁最小。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T18:21:34.730

不轻松。根据定义，Java 沙箱不会让您的小程序调用它的来源以外的其他地方。您必须正确签署您的小程序。然后用户要么信任你的小程序，让它在别处调用，要么拒绝它——这取决于用户。您可以对您的小程序进行自签名，但我个人绝不允许在我的计算机上使用此类内容。这对测试和类似的东西很有用。因此，您可能需要从信誉良好的来源购买证书。与Flash相同，我相信这个想法是相同的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T18:24:22.027

Java、JavaScript、Flash 等实施某种形式的“同源”策略，只允许不受信任的代码从下载它的站点读取。自 6u10 以来，最新版本的 Flash 和 Java 在某种程度上支持此问题的一种方法是`crossdomain.xml`（Google it）。这允许站点允许通过其他站点下载的代码进行访问。请注意，这需要您要访问的站点授予您这样做的权限。

# asp.net - 如何将相似的 JavaScript 方法合二为一

> ID：808310
> 
> 赞同：0
> 
> 时间：2009-04-30T18:11:20.763
> 
> 标签：asp.net, javascript

我有一个 ASP.NET 代码隐藏页面，将几个复选框链接到 JavaScript 方法。我只想制作一种 JavaScript 方法来处理它们，因为它们是相同的逻辑，我该怎么做？

页面加载背后的代码：

```
checkBoxShowPrices.Attributes.Add("onclick", "return checkBoxShowPrices_click(event);");

checkBoxShowInventory.Attributes.Add("onclick", "return checkBoxShowInventory_click(event);"); 
```

ASPX 页面 JavaScript；显然，他们都为分配的复选框做同样的事情，但我认为这可以简化为一种方法：

```
function checkBoxShowPrices_click(e) {
    if (_hasChanged) {
        confirm(
            'All changes will be lost. Do you wish to continue?',    
            function(arg) {
                if (arg.toUpperCase() == 'YES') {
                    var checkBox = document.getElementById('<%=checkBoxShowPrices.UniqueID%
>');
                    checkBox.checked = !checkBox.checked;
                    eval("<%=base.GetPostBackEventReference(checkBoxShowPrices)%>");
                    _hasChanged = false;
                }
            });
            return false;
        } else {
            eval("<%=base.GetPostBackEventReference(checkBoxShowPrices)%>");
    }
}

function checkBoxShowInventory_click(e) {
    if (_hasChanged) {
        confirm(
            'All changes will be lost. Do you wish to continue?', 
            function(arg) {
                if (arg.toUpperCase() == 'YES') {
                    var checkBox = document.getElementById('<%
=checkBoxShowInventory.UniqueID%>');
                    checkBox.checked = !checkBox.checked;
                    eval("<%=base.GetPostBackEventReference(checkBoxShowInventory)%>");
                    _hasChanged = false;
                }
            });
            return false;
        } else {
            eval("<%=base.GetPostBackEventReference(checkBoxShowInventory)%>");
        }
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T18:22:18.943

将引发它的复选框添加到事件中：

```
checkBoxShoPrices.Attributes.Add("onclick", "return checkBox_click(this, event);"); 
```

之后在函数中声明它是这样的：

```
function checkBoxShowPrices_click(checkbox, e){ ...} 
```

并且您在复选框中有您需要的实例

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T18:19:16.517

您总是可以编写一个返回函数的函数：

```
function genF(x, y) {
    return function(z) { return x+y*z; };
};

var f1 = genF(1,2);
var f2 = genF(2,3);

f1(5);
f2(5); 
```

我认为这可能对你的情况有所帮助。（您的代码粘贴很难阅读..）

# ruby - 按可能为 nil 的属性对对象的 ruby 数组进行排序

> ID：808318
> 
> 赞同：45
> 
> 时间：2009-04-30T18:12:51.477
> 
> 标签：ruby, arrays, sorting

我有一个对象数组，我需要按可以是整数或 nil 的位置属性进行排序，并且我需要具有 nil 位置的对象位于数组的末尾。现在，我可以强制该位置返回某个值而不是 nil，这样 array.sort 就不会失败，但是如果我使用 0 作为默认值，那么它会将这些对象放在排序的前面。进行这种排序的最佳方法是什么？我是否应该将 nil 值设置为“几乎”总是保证在最后的一些可笑的高数字？还是有其他方法可以使 array.sort 方法将 nil 属性对象放在数组的末尾？代码如下所示：

```
class Parent
  def sorted_children
     children.sort{|a, b| a.position <=> b.position}
  end
end

class Child
  def position
    category ? category.position : #what should the else be??
  end
end 
```

现在，如果我将“else”设置为 1000000000，那么很可能会将它们放在数组的末尾，但我不喜欢这个解决方案，因为它是任意的

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-04-30T19:44:05.610

我只是调整你的排序，把`nil`项目放在最后。尝试这样的事情。

```
foo = [nil, -3, 100, 4, 6, nil, 4, nil, 23]

foo.sort { |a,b| a && b ? a <=> b : a ? -1 : 1 }

=> [-3, 4, 4, 6, 23, 100, nil, nil, nil] 
```

这就是说：如果 a 和 b 都不是 nil，则通常对它们进行排序，但如果其中一个为 nil，则返回一个将其排序更大的状态。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-30T18:32:35.203

如何`Child`定义`<=>`基于`category.position`if`category`存在，并且排序没有 a`category`的项目总是大于那些有 a 的项目`category`？

```
class Child
  # Not strictly necessary, but will define other comparisons based on <=>
  include Comparable   
  def <=> other
    return 0 if !category && !other.category
    return 1 if !category
    return -1 if !other.category
    category.position <=> other.category.position
  end
end 
```

然后`Parent`你就可以打电话了`children.sort`。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-04-30T19:51:20.740

我处理这样的事情：

```
 children.sort_by {|child| [child.position ? 0 : 1,child.position || 0]} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-30T18:21:44.140

公平地说，我对 Ruby 不是很熟悉，所以将其更多地视为一种算法思想，而不是代码……并将 ?: 运算符重写为 Ruby 所具有的任何更简洁的操作符。

你不能在比较中检查 nil 吗：

```
class Parent
  def sorted_children
     children.sort{|a,b|( a and b ) ? a <=> b : ( a ? -1 : 1 ) }
  end
end 
```

编辑为使用 Glenra 的代码，它实现了与我相同的东西，但代码量更小（并且可能更容易阅读）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-03-28T09:29:33.023

对我来说最简单的解决方案是

```
def sorted_children(children)
  children.sort_by { |child| child.position || -1}
end 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-30T18:20:25.623

我有一段时间没有做过 Ruby，但您可以将 null 检查与排序分开（只允许 Child#position 返回 null）：

```
def sorted_children
  children.reject{|c| c.position.nil?}.sort_by(&:position) +
    children.select{|c| c.position.nil?}
end 
```

诚然，这不是最有效的解决方案，但它没有任何神奇的数字。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-05-14T11:18:44.420

您可以通过定义新的比较方法来执行此操作，而无需覆盖 spaceship 运算符。

```
class Child
  include Comparable   
  def compare_by_category(other)
    return 0 if !category && !other.category
    return 1 if !category
    return -1 if !other.category
    category.position <=> other.category.position
  end
end 
```

该`sort`方法可以占用一个块，因此您可以使用这个新方法进行排序：

```
children.sort {|a,b| a.compare_by_category(b) } 
```

# javascript - 如何为选择字段重新填充动态生成的选项？

> ID：808328
> 
> 赞同：4
> 
> 时间：2009-04-30T18:16:00.190
> 
> 标签：javascript, jquery, jquery-plugins

**背景** 我有两个链接在一起的选择表单字段：持续时间和频率。当用户选择频率时，会动态插入持续时间选项。有默认选项，但这些只是为了在用户展开它时该字段不为空。

例如，频率选项是“day”、“other day”和“week”。如果我选择“天”，频率选项将更改为“5 天”、“15 天”和“30 天”。

**问题** 当用户提交带有错误的表单时，问题就出现了，返回表单时重新填充了所有表单字段，并且突出显示了错误（频率选择字段除外），其选项是动态生成的。它没有突出显示，它的选项是默认选项。

如果用户提交错误，有没有办法让我重新填充这些选项。我们正在做大量的 JavaScript 验证，所以这种情况不应该经常发生，但希望让用户尽可能轻松地获得错误体验。

**代码** 我正在使用 jquery 和一个名为 cascade 的 jquery 插件将两个字段链接在一起。（[http://plugins.jquery.com/project/cascade](http://plugins.jquery.com/project/cascade)）

这是我的自定义 JavaScript。

此脚本生成选项列表：

```
var list1 = [
    {'When':'86400','Value':' ','Text':' '},
    {'When':'172800','Value':' ','Text':' '},
    {'When':'604800','Value':' ','Text':' '},
    {'When':'86400','Value':'432000','Text':'5 days'},
    {'When':'86400','Value':'1296000','Text':'15 days'},
    {'When':'86400','Value':'2505600','Text':'30 days'},
    {'When':'172800','Value':'1296000','Text':'15 days'},
    {'When':'172800','Value':'2505600','Text':'30 days'},
    {'When':'172800','Value':'3888000','Text':'45 days'},
    {'When':'604800','Value':'2505600','Text':'4 weeks'},
    {'When':'604800','Value':'3715200','Text':'6 weeks'},
    {'When':'604800','Value':'4924800','Text':'8 weeks'}
];

function commonTemplate(item) {
    return "<option value='" + item.Value + "'>" + item.Text + "</option>"; 
};

function commonMatch(selectedValue) {
    return this.When == selectedValue; 
}; 
```

这是触发选择选项生成的脚本：

```
jQuery("#duration).cascade("#frequency",{
    list: list1,            
    template: commonTemplate,
    match: commonMatch          
}) 
```

**问题** 当表单返回到浏览器并出现错误时，如何获得动态生成的频率选项以重新填充有什么想法吗？可以使用我当前使用的级联插件或其他方法吗？

非常感谢您的帮助。:-)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T18:29:12.640

我不熟悉这个插件，但你不能只触发和/或document.ready的`change()`事件吗？`#duration``#frequency`

```
$(document).ready(function() {
    $('#duration').change();
    $('#frequency').change();
}); 
```

我很确定脚本所做的所有事情都是将内容绑定到 select 的 change 事件（至少默认情况下），这样应该会触发插件发挥它的魔力......

# database - 访问数据库循环 - 为一个表中的每条记录在另一个表中创建记录数组

> ID：808331
> 
> 赞同：1
> 
> 时间：2009-04-30T18:16:19.363
> 
> 标签：database, ms-access, nested-loops

是否可以在**Access DB**中创建一个嵌套循环查询来更新第三个表？

我有一个主（标题）表：

```
------------------------
masters
------------------------
num | modality | cost  |
------------------------
01  | thing    | 23.00 |
02  | thing    | 42.00 |
03  | thing    | 56.00 |
04  | apple    | 11.00 |
05  | apple    | 17.00 | 
```

和一个包含详细信息的临时表，我需要创建第三个（实际）**详细信息**表，该表将关闭**masters**表

这是临时详细信息表的示例。

```
----------------------------------
temps
----------------------------------
modelnumber | modality | priceEa |
----------------------------------
| 123       | thing    | 1.00    |
| 234       | apple    | 2.00    |
| 345       | apple    | 3.00    |
| 456       | apple    | 4.00    |
| 567       | thing    | 5.00    | 
```

基本上，我需要遍历**master**表中的每条记录。

**外环：**

对于 master 表中的每条记录，获取模态。

**内循环：**

然后对于 temps 表中的每条记录，其中方式匹配，在 details 表中创建一条记录（并在此过程中，根据 temps.priceEa 和 masters.cost 进行一些计算）。

这应该为 masters 表中的每条记录在 details 表中创建 (masters * temps) 数量的新记录。

详细信息表，最终应该看起来像

```
----------------------------------------------------------
details
----------------------------------------------------------
num  | modelnumber | modality | priceEa  |  adjustedCost |
----------------------------------------------------------
| 01 | 123         | thing     | 1.00    | (do calc here)
| 01 | 567         | thing     | 5.00    | (do calc here)
| 02 | 123         | thing     | 1.00    | (do calc here)
| 02 | 567         | thing     | 5.00    | (do calc here)
| 03 | 123         | thing     | 1.00    | (do calc here)
| 03 | 567         | thing     | 5.00    | (do calc here)
| 04 | 234         | apple     | 2.00    | (do calc here)
| 04 | 345         | apple     | 3.00    | (do calc here)
| 04 | 456         | apple     | 4.00    | (do calc here)
| 05 | 234         | apple     | 2.00    | (do calc here)
| 05 | 345         | apple     | 3.00    | (do calc here)
| 05 | 456         | apple     | 4.00    | (do calc here)
...etc 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T19:11:44.767

```
 SELECT m.num, t.modelnumber, m.modality, t.priceea
into myNewTempTable
from masters m  inner  join temp t on m.modality = t.modality
order by m.num, t.modelnumber 

```

# gtk - 如何找出 GTK+ 信号需要哪些 GDK 事件？

> ID：808338
> 
> 赞同：2
> 
> 时间：2009-04-30T18:17:01.683
> 
> 标签：gtk, glade, gdk

我将 Glade-3 用于我的 GUI 设计，但我一直遇到这个问题。我在 GTK+ 文档映射信号到事件或 Glade-3 (3.4.5) 中看不到任何内容。GTK+ 源代码中是否有地方可以找到这些信息？

注意：在这个问题中，重要的是要认识到事件和信号在 GTK 中不是一回事。

例子：

我有一个需要以下事件才能接收以下信号的事件框。如何确定给定信号需要哪些事件？

```
Events: GDK_ENTER_NOTIFY_MASK | GDK_LEAVE_NOTIFY_MASK | GDK_STRUCTURE_MASK
Signals: leave_notify_event, enter_notify_event 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-07T03:44:03.093

好的，我想我现在明白你的意思了，我发现这张表匹配了 gtk 信号和 gdk 事件。[在这里](http://developer.gnome.org/doc/GGAD/sec-gdkevent.html#TAB-WIDGETEVENTS)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-30T04:32:00.900

假设我已经正确解释了您的问题，您希望将 Glade 文件中指定的信号连接到源代码中的函数。你如何做到这一点取决于你是使用 libglade 来加载文件生成还是 GtkBuilder，两者都是相似的，但我将在 C 中给出示例以完成。

使用 libglade 你会这样做：

```
GladeXml *xml = glade_xml_new(filename, NULL, NULL); // Load the file
glade_xml_signal_autoconnect(xml); // Connect the signals 
```

使用 GtkBuilder 会是这样的：

```
GtkBuilder *xml = gtk_builder_new();
gtk_builder_add_from_file(xml, filename, NULL); // Load the file
gtk_builder_connect_signals(xml, NULL); // Connect the signals 
```

使用 GtkBuilder 时，信号连接函数中的第二个参数可以替换为指向数据的指针，然后将其传递给信号处理程序。

展望未来，我建议使用 GtkBuilder，因为 libglade 即将被弃用。

**链接**

以下是有关上述两个功能的相关文档的链接

*   [http://library.gnome.org/devel/libglade/stable/GladeXML.html#glade-xml-signal-autoconnect](http://library.gnome.org/devel/libglade/stable/GladeXML.html#glade-xml-signal-autoconnect)
*   [http://library.gnome.org/devel/gtk/stable/GtkBuilder.html#gtk-builder-connect-signals](http://library.gnome.org/devel/gtk/stable/GtkBuilder.html#gtk-builder-connect-signals)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-07T10:17:24.547

您可以使用以下方法捕获事件[`gdk_event_handler_set()`](http://developer.gnome.org/gdk/stable/gdk-Events.html#gdk-event-handler-set)

首先在启动时注册您自己的 GDK 事件处理程序：

```
gdk_event_handler_set(my_gdk_event_handler, NULL, NULL); 
```

...然后使用它打印出任何有用的信息，并且不要忘记将事件传递给 GTK+，`gtk_main_do_event()`如下所示：

```
void my_gdk_event_handler(GdkEvent *event, gpointer data)
{
    printf("Received GdkEvent of type %d", event->type);

    gtk_main_do_event(event); // Pass event to GTK+
} 
```

# php - 不使用 setter 和 getter 真的有那么错吗？

> ID：808348
> 
> 赞同：16
> 
> 时间：2009-04-30T18:19:15.970
> 
> 标签：php, oop

我是 PHP 的新手。出于某种原因，在其他类型的编程语言（如 JAVA）中，我对每个变量都使用 setter 和 getter 没有问题，但是当我在 PHP 中编程时，可能是因为它非常灵活，感觉有点浪费时间。大多数时候将类属性设置为公共并像那样操作它们感觉更简单。问题是，当我这样做时，我觉得我做错了什么并且违反了 OO 原则。

不使用 setter 和 getter 真的有那么错吗？为什么或者为什么不？你们大部分时间是怎么做的？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-30T18:31:19.560

不使用属性访问器的主要问题是，如果您发现以后需要将字段更改为属性——例如，使其成为子类中的计算属性——您将破坏 API 的客户端。对于已发布的图书馆，这是不可接受的；对于内部的，只是很多工作来解决问题。

对于私有代码或小型应用程序，直接使用它可能是可行的。IDE（或文本编辑器）将让您生成访问器样板并使用代码折叠将其隐藏。可以说，这使得在机械上使用 getter 和 setter 相当容易。

请注意，某些编程语言具有合成默认字段+getter+setter 的功能——Ruby 通过元编程实现，C# 具有自动实现的属性。Python 完全回避了这个问题，让您覆盖属性访问，让您将属性封装在需要它的子类中，而不必事先操心它。（这是我最喜欢的方法。）

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-30T18:22:32.170

getter 或 setter 的要点是，您仍然可以在一个地方而不是在您想要修改或检索该字段的每个地方为您对字段的修改添加逻辑。您还可以在班级级别控制该领域发生的事情。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-05-01T20:21:30.770

如果我们在这里严格讨论 PHP 而不是 C#、Java 等（编译器将在其中优化这些东西），我发现 getter 和 setter 浪费资源，您只需要代理私有字段的值并且什么也不做。

在我的设置中，我创建了两个蹩脚的类，一个有五个私有字段，由五个 getter/setter 对封装，代理该字段（看起来几乎*完全*像 java 代码，很有趣），另一个有五个公共字段，并调用 memory_get_usage()创建实例后结束。带有 getter/setter 的脚本使用了 59708 字节的内存，带有公共字段的脚本使用了 49244 字节。

在任何显着大小的类库的上下文中，例如网站框架，这些无用的 getter 和 setter 可以加起来形成一个巨大的内存黑洞。我一直在为我的雇主开发一个 PHP 框架（他们的选择，而不是我的。如果我有选择的话，我不会为此使用它，但话虽如此，PHP 并没有对我们施加任何不可逾越的限制），当我重构时类库使用公共字段而不是 getter/setter，整个 shebang 最终每个请求至少使用了 25% 的内存。

__get()、__set() 和 __call() 'magic' 方法在处理接口更改方面非常出色。当您需要将字段迁移到 getter/setter（或将 getter/setter 迁移到字段）时，它们可以使该过程对任何相关代码都是透明的。使用解释性语言，即使 Eclipse PDT 或 Netbeans 提供了对代码敏感性的相当好的支持，也很难找到字段或方法的所有用法，因此魔术方法对于确保旧接口仍然委托给新接口很有用功能。

假设我们有一个使用字段而不是 getter/setter 开发的对象，我们想将一个名为“field”的字段重命名为“fieldWithBetterName”，因为“field”不合适，或者不再准确描述使用，或者只是完全错误。假设我们想更改一个名为“field2”的字段，以便从数据库中延迟加载其值，因为最初使用 getter 并不知道它......

```
class Test extends Object {
    public $field;
    public $field2;
} 
```

变成

```
class Test extends Object {
    public $fieldWithBetterName = "LA DI DA";
    private $_field2;

    public function getField2() {
        if ($this->_field2 == null) {
            $this->_field2 = CrapDbLayer::getSomething($this->fieldWithBetterName);
        }
        return $this->_field2;
    }

    public function __get($name) {
        if ($name == 'field')) {
            Logger::log("use of deprecated property... blah blah blah\n".DebugUtils::printBacktrace());
            return $this->fieldWithBetterName;
        }
        elseif ($name == 'field2') {
            Logger::log("use of deprecated property... blah blah blah\n".DebugUtils::printBacktrace());
            return $this->getField2();
        }
        else return parent::__get($name);
    }
}
$t = new Test;
echo $t->field;
echo $t->field2; 
```

（作为旁注，“扩展对象”位只是我用于几乎所有具有 __get() 和 __set() 声明的基类，当访问未声明的字段时会引发异常）

您可以使用 __call() 向后退。这个例子很脆弱，但清理起来并不难：

```
class Test extends Object {
    public $field2;

    public function __call($name, $args) {
        if (strpos($name, 'get')===0) {
            $field = lcfirst($name); // cheating, i know. php 5.3 or greater. not hard to do without it though.
            return $this->$field;
        }
        parent::__call($name, $args);
    }
} 
```

Getter and setter methods in PHP are good if the setter has to do something, or if the getter has to lazy load something, or ensure something has been created, or whatever, but they're unnecessary and wasteful if they do nothing other than proxy the field, especially with a few techniques like the ones above to manage interface changes.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-30T18:51:08.357

我可能不会在这个问题上获得很多赞成票，但就我个人而言，getter 和 setter 对我来说就像是一种代码味道。设计应该是行为驱动的，而不是数据驱动的。当然，这只是一种看法。如果您有一个对象依赖于另一个对象的特定数据字段，这是非常紧密的耦合。相反，它应该取决于该对象的行为，该对象远没有其数据那么脆弱。

但是，是的，由于这个原因，像 getter 和 setter 这样的属性直接从对字段的依赖中提升了一步。它不那么脆弱并放松了对象之间的耦合。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-30T18:29:19.347

您是否考虑过使用魔术函数 __set/__get？使用它们，您可以轻松地将所有 getter/setter 函数合并到 2 个函数中！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-01T11:41:03.937

有一种方法可以在不实际使用 get/set 函数类的情况下模拟 get/set，因此您的代码保持整洁：

```
$person->name = 'bob';
echo $person->name; 
```

看看我编写的[这个类。](http://github.com/marioprudhomme/fractal-php/blob/85b9c8f14d6dc66837e36196458dcdeba188b6eb/public/core/library/model.php)

通常，在使用此类时，您会声明所有属性受保护（或私有）。如果您想在属性上添加行为，例如在“name”属性上说 strtolower() + ucfirst()，您需要做的就是在您的类中声明一个受保护的 set_name() 函数，然后该行为应该被自动拾取。使用 get_name() 也可以实现相同的目的。

```
// Somewhere in your class (that extends my class).
protected function set_name($value) { $this->name = ucfirst(strtolower($value)); }
//

// Now it would store ucfirst(strtolower('bob')) automatically.
$person->name = 'bob'; 
```

PS 另一个很酷的事情是你可以弥补不存在的领域，如

```
echo $person->full_name; 
```

没有这样的字段（只要有 get_full_name() 函数）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-30T18:36:01.157

如果您在脚本中访问这些变量很多时间并且如果您经常更新 yoru 类，您应该使用 setter 和 getter，因为但如果您不这样做，当您改进您的类时，您必须更新所有使用此变量的文件。

其次，你这样做的主要原因是你不应该直接访问变量，因为类结构可能会改变，并且可以以不同的方式提供这些数据。当你从类中获取数据时，你不应该关心这些数据是如何生成的。类必须关心这个数据处理，所以你只应该关心你会得到什么。

# jquery - 将文本附加到 jQuery 类中的匹配元素属性

> ID：808350
> 
> 赞同：0
> 
> 时间：2009-04-30T18:19:46.250
> 
> 标签：jquery, regex

我正在尝试将查询参数附加到类中文本块内的链接，例如

```
<div class="container">
consectetur <a href="foo.php?q=bar">adipisicing</a>
</div> 
```

?q=bar 附加在哪里。这是我的功能：

```
function appendRef(container,reftag) {
    var Link = $(container).attr("href");
    var afterLink = reftag; 

        $(container).attr({
            href: (Link + afterLink)
            });
}

appendRef(".container a", "?q=bar"); 
```

但是，这会将 div 中的每个链接转换为它看到的第一个链接返回的值，而不是唯一地处理它们。我还希望能够根据部分原始 url 过滤函数。就像是

```
if Link.match(/domain/) { //append the param 
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T19:19:53.500

正如在函数开头设置 Link 变量时已经指出的那样，它采用选择器返回的集合中第一个元素的值。在更新集合之前，您需要计算集合中每个元素的 href。

您可以通过调用 .each 并在闭包中使用 .attr 来执行此操作，或者您可以使用 attr 接受回调并允许您逐个元素执行逻辑的版本...

```
$(".container a").attr("href",
    function(idx) { //idx is the index of the element in the set
        return this.href.match(/domain/) ? this.href + afterLink : this.href;
    }
 ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T18:36:01.187

Yes, you are setting the *Link* variable to a static value (the one of the first href).

You'd have to store the query in a variable like this:

```
var links = $("." + container + " a"); 
```

so *links* would be an array, then you can loop through it and append the text to its href

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T18:41:06.667

I'm not a jQuery guy myself, but I know that css selector will return an array of results. The solution is just to loop through the elements and apply the changes you want. Also, if you want to limit the urls that are affected, I threw an optional `match` attribute into the function to test the `href` against.

```
function appendRef(container,reftag, match) {
        match = match || /.*/
        $(container).each(function() {
           if ($(this).attr('href').match(match)) {
              //do url magic here
           }
        })
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T19:47:34.417

厉害了，都 我在此基础上进行了构建，并对其进行了修改，因此如果原始链接已经有一个参数，它会将其剥离并替换为我们的新链接。

```
function appendRef(container, reftag, match) {
$(container).each(function() {

    if ($(this).attr('href').match(match)) {                
        var href = $(this).attr('href');                
        var href = href.replace(/\?.*$/,'');
        var href = (href + reftag);  
        $(this).attr('href', href);        

    }
});
}

appendRef(".container a", "?q=foo", "domain"); 
```

# sql - 如何在 T-SQL 中根据前几个月的数据确定缺失月份的值

> ID：808356
> 
> 赞同：2
> 
> 时间：2009-04-30T18:20:53.453
> 
> 标签：sql, sql-server, tsql, gaps-and-islands

我有一组在特定时间点发生的交易：

```
CREATE TABLE Transactions (
    TransactionDate Date NOT NULL,
    TransactionValue Integer NOT NULL
) 
```

数据可能是：

```
INSERT INTO Transactions (TransactionDate, TransactionValue)
VALUES ('1/1/2009', 1)
INSERT INTO Transactions (TransactionDate, TransactionValue)
VALUES ('3/1/2009', 2)
INSERT INTO Transactions (TransactionDate, TransactionValue)
VALUES ('6/1/2009', 3) 
```

假设 TransactionValue 设置了某种级别，我需要知道事务之间的级别。我需要在一组 T-SQL 查询的上下文中使用它，所以最好能得到这样的结果集：

```
Month   Value
1/2009  1
2/2009  1
3/2009  2
4/2009  2
5/2009  2
6/2009  3 
```

请注意，对于每个月，我们如何获取交易中指定的值，或者获取最新的非空值。

我的问题是我不知道如何做到这一点！我只是一个“中级”级别的 SQL 开发人员，我不记得以前见过这样的事情。自然地，我可以在程序中创建我想要的数据，或者使用游标，但我想知道是否有更好的、面向集合的方法来做到这一点。

我使用的是 SQL Server 2008，所以如果有任何新功能有帮助，我很想听听。

PS如果有人能想出一个更好的方式来陈述这个问题，甚至是一个更好的主题行，我将不胜感激。我花了很长时间才决定“传播”虽然很蹩脚，但却是我能想到的最好的。“涂抹”听起来更糟。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T22:47:10.350

我将首先构建一个数字表，其中包含从 1 到 100 万左右的连续整数。一旦你掌握了窍门，它们就会派上用场。

例如，以下是如何获得 2008 年每个月的 1 日：

```
select firstOfMonth = dateadd( month, n - 1, '1/1/2008')
from Numbers
where n <= 12; 
```

现在，您可以使用 OUTER APPLY 将其放在一起，以查找每个日期的最新交易，如下所示：

```
with Dates as (
    select firstOfMonth = dateadd( month, n - 1, '1/1/2008')
    from Numbers
    where n <= 12
)
select d.firstOfMonth, t.TransactionValue
from Dates d
outer apply (
    select top 1 TransactionValue
    from Transactions
    where TransactionDate <= d.firstOfMonth
    order by TransactionDate desc
) t; 
```

这应该可以为您提供所需的内容，但您可能需要在 Google 上搜索一下才能找到创建 Numbers 表的最佳方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T19:07:23.827

我无法通过手机访问 BOL，所以这是一个粗略的指南......

首先，您需要为没有数据的月份生成缺失的行。您可以使用外部联接到具有所需时间跨度的固定表或临时表，也可以从以编程方式创建的数据集（存储过程等）

其次，您应该查看新的 SQL 2008 '分析'函数，如 MAX(value) OVER ( partition 子句 ) 以获得先前的值。

（我知道 Oracle 可以做到这一点，因为我需要它来计算交易日期之间的复利计算 - 确实是同样的问题）

希望这能为您指明正确的方向...

（避免将它扔到临时表中并在上面移动。太粗糙了！！！）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T19:10:17.440

这就是我想出的

```
declare @Transactions table (TransactionDate datetime, TransactionValue int)

declare @MinDate datetime
declare @MaxDate datetime
declare @iDate datetime
declare @Month int
declare @count int
declare @i int
declare @PrevLvl int

insert into @Transactions (TransactionDate, TransactionValue)
select '1/1/09',1

insert into @Transactions (TransactionDate, TransactionValue)
select '3/1/09',2

insert into @Transactions (TransactionDate, TransactionValue)
select '5/1/09',3

select @MinDate = min(TransactionDate) from @Transactions
select @MaxDate = max(TransactionDate) from @Transactions

set @count=datediff(mm,@MinDate,@MaxDate)
set @i=1
set @iDate=@MinDate

while (@i<=@count)
begin

    set @iDate=dateadd(mm,1,@iDate)

    if (select count(*) from @Transactions where TransactionDate=@iDate) < 1
    begin

        select @PrevLvl = TransactionValue from @Transactions where TransactionDate=dateadd(mm,-1,@iDate)

        insert into @Transactions (TransactionDate, TransactionValue)
        select @iDate, @prevLvl

    end

    set @i=@i+1
end

select *
from @Transactions
order by TransactionDate 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T20:30:34.610

要以基于集合的方式执行此操作，您需要为所有数据或信息设置集合。在这种情况下，“有几月？”的数据被忽略了。在数据库中拥有“日历”表和“数字”表作为实用程序表非常有用。

这是使用其中一种方法的解决方案。第一段代码设置您的日历表。您可以使用光标或手动或其他方式填充它，并且您可以将其限制在您的业务所需的任何日期范围内（回到 1900-01-01 或只是回到 1970-01-01 以及尽可能远的未来想）。您还可以添加对您的业务有用的任何其他列。

```
CREATE TABLE dbo.Calendar
(
     date           DATETIME     NOT NULL,
     is_holiday     BIT          NOT NULL,
     CONSTRAINT PK_Calendar PRIMARY KEY CLUSTERED (date)
)

INSERT INTO dbo.Calendar (date, is_holiday) VALUES ('2009-01-01', 1)  -- New Year
INSERT INTO dbo.Calendar (date, is_holiday) VALUES ('2009-01-02', 1)
... 
```

现在，使用此表，您的问题变得微不足道：

```
SELECT
     CAST(MONTH(date) AS VARCHAR) + '/' + CAST(YEAR(date) AS VARCHAR) AS [Month],
     T1.TransactionValue AS [Value]
FROM
     dbo.Calendar C
LEFT OUTER JOIN dbo.Transactions T1 ON
     T1.TransactionDate <= C.date
LEFT OUTER JOIN dbo.Transactions T2 ON
     T2.TransactionDate > T1.TransactionDate AND
     T2.TransactionDate <= C.date
WHERE
     DAY(C.date) = 1 AND
     T2.TransactionDate IS NULL AND
     C.date BETWEEN '2009-01-01' AND '2009-12-31'  -- You can use whatever range you want 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-19T10:07:12.127

约翰·吉布（John Gibb）发布了一个很好的答案，已经被接受，但我想稍微扩展一下：

*   取消一年的限制，
*   以更明确的方式显示日期范围，以及
*   无需单独的数字表。

这种细微的变化使用[递归公用表表达式](http://msdn.microsoft.com/en-us/library/ms186243.aspx)来建立代表每个月的第一天或之后的日期集，该日期是在 DateRange 中定义的开始日期和结束日期。请注意使用 MAXRECURSION 选项来防止堆栈溢出 (!)；根据需要进行调整以适应预期的最大月数。此外，考虑添加替代 Dates 组装逻辑以支持周、季度甚至日常。

```
with 
DateRange(FromDate, ToDate) as (
  select 
    Cast('11/1/2008' as DateTime), 
    Cast('2/15/2010' as DateTime)
),
Dates(Date) as (
  select 
    Case Day(FromDate) 
      When 1 Then FromDate
      Else DateAdd(month, 1, DateAdd(month, ((Year(FromDate)-1900)*12)+Month(FromDate)-1, 0))
    End
  from DateRange
  union all
  select DateAdd(month, 1, Date)
  from Dates
  where Date < (select ToDate from DateRange)
)
select 
  d.Date, t.TransactionValue
from Dates d
outer apply (
  select top 1 TransactionValue
  from Transactions
  where TransactionDate <= d.Date
  order by TransactionDate desc
) t
option (maxrecursion 120); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-05T02:38:25.917

如果您经常进行此类分析，您可能会对我为此目的而组合的这个 SQL Server 函数感兴趣：

```
if exists (select * from dbo.sysobjects where name = 'fn_daterange') drop function fn_daterange;
go

create function fn_daterange
   (
   @MinDate as datetime,
   @MaxDate as datetime,
   @intval  as datetime
   )
returns table
--**************************************************************************
-- Procedure: fn_daterange()
--    Author: Ron Savage
--      Date: 12/16/2008
--
-- Description:
-- This function takes a starting and ending date and an interval, then
-- returns a table of all the dates in that range at the specified interval.
--
-- Change History:
-- Date        Init. Description
-- 12/16/2008  RS    Created.
-- **************************************************************************
as
return
   WITH times (startdate, enddate, intervl) AS
      (
      SELECT @MinDate as startdate, @MinDate + @intval - .0000001 as enddate, @intval as intervl
         UNION ALL
      SELECT startdate + intervl as startdate, enddate + intervl as enddate, intervl as intervl
      FROM times
      WHERE startdate + intervl <= @MaxDate
      )
   select startdate, enddate from times;

go 
```

这是对这个[问题](https://stackoverflow.com/questions/373490/insert-dates-in-the-return-from-a-query-where-there-is-none/373734#373734)的回答，它也有一些示例输出。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-04-20T11:21:23.323

**------替代方式-----**

```
select 
    d.firstOfMonth,
    MONTH(d.firstOfMonth) as Mon,
    YEAR(d.firstOfMonth) as Yr, 
    t.TransactionValue
from (
    select 
        dateadd( month, inMonths - 1, '1/1/2009') as firstOfMonth 
        from (
            values (1), (2), (3), (4), (5), (7), (8), (9), (10), (11), (12)
        ) Dates(inMonths)
) d
outer apply (
    select top 1 TransactionValue
    from Transactions
    where TransactionDate <= d.firstOfMonth
    order by TransactionDate desc
) t 
```

# asp.net - 为什么标签在 ASP.NET 图表中消失？

> ID：808363
> 
> 赞同：2
> 
> 时间：2009-04-30T18:22:19.270
> 
> 标签：asp.net, charts

Chart1 显示了所有标签，但是一旦我添加了第 10 个项目，一半的标签就会消失。

首先是标记：

```
 <asp:Chart ID="Chart1" runat="server" Width="700" Height="600">
        <series>
            <asp:Series Name="Series1" ChartType="Bar" />
        </series>
        <chartareas>
            <asp:ChartArea Name="ChartArea1" />
        </chartareas>
    </asp:Chart>

    <asp:Chart ID="Chart2" runat="server" Width="700" Height="600">
        <series>
            <asp:Series Name="Series1" ChartType="Bar" />
        </series>
        <chartareas>
            <asp:ChartArea Name="ChartArea1"/>
        </chartareas>
    </asp:Chart> 
```

我们添加一些数据...

```
 Dim labels As New System.Collections.Generic.Dictionary(Of String, Integer)

    labels.Add("1 thing", 24655)
    labels.Add("2 thing", 11355)
    labels.Add("3 thing", 6890)
    labels.Add("4 thing", 5815)
    labels.Add("5 thing", 5155)
    labels.Add("6 thing", 4160)
    labels.Add("7 thing", 2430)
    labels.Add("8 thing", 2055)
    labels.Add("9 thing", 1545)

    Chart1.Series("Series1").Points.DataBindXY(labels, "Key", labels, "Value")
    Chart1.DataBind()

    labels.Add("10 thing", 1530)

    Chart2.Series("Series1").Points.DataBindXY(labels, "Key", labels, "Value")
    Chart2.DataBind() 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T18:24:42.773

我只需要将轴的间隔设置为

```
Chart2.ChartAreas("ChartArea1").AxisX.Interval = 1 
```

# sql-server - SQL Server Reporting Services 移动视图

> ID：808369
> 
> 赞同：0
> 
> 时间：2009-04-30T18:23:01.157
> 
> 标签：sql-server, reporting-services

我即将创建一个报告，该报告将安排在每晚发送电子邮件更新。我们发送电子邮件是因为我们希望这些报告可以在公司防火墙之外的黑莓手机上使用。这意味着我们对功能进行了一定程度的限制（没有下钻、排序、高级过滤和只有一张表的数据）。有没有办法对这个报告进行版本控制，如果在手持设备上查看它具有最小的功能，但如果在桌面上的网络中查看它有所有的花里胡哨？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T18:34:06.497

好吧，您可以将订阅邮件发送出报告的精简版本，然后在该报告中添加一个链接，该链接指向网络上的全功能报告（基本上您将有 2 个不同的报告）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T18:52:13.893

黑莓有几个可以跳板的移动选项；就个人而言，我倾向于 PDF 导出，因为您已经说过您不需要所有的“花里胡哨”。您可以在 Report Manager 中设置订阅，并让这些订阅通过电子邮件将 PDF 发送给您的 Blackberry 用户。通过这种方式，他们可以随时随地通过适当的电子邮件地址获取数据。

不幸的是，没有办法（我听说过）为特定的用户代理剥离它......

# c# - 在 .NET 中从 xsd 创建 xml 文件

> ID：808378
> 
> 赞同：5
> 
> 时间：2009-04-30T18:25:37.827
> 
> 标签：c#, .net, xml, xsd

我想知道解决这个问题的最佳方法：我想从 xml 模式创建一个空白模板 xml。将创建所有必需的元素和属性，并且它们的值都是空字符串。

下一步是如何确定某个节点可能具有哪些子 xml 节点。例如。我会选择一个节点具有 minOccurs="0", maxOccurs="unbounded" 的一个子节点。我将能够确定关于那个孩子的一切、它的属性、它的名字、它的值类型等。

为了提供更多关于这种情况的上下文，我正在开发一种工具，该工具允许用户在更用户友好的设置中编辑 xml 文件。例如，他们可以向“account db”节点添加一个新帐户，他们会看到唯一可用的节点是一个帐户节点。接下来，当他们尝试将子节点添加到帐户节点时，选择将是名称节点（必需）、密码节点（必需）、设置节点（可选）等。我如何以编程方式确定帐户节点可用于哪些子节点它以及这些孩子的属性和设置是什么？

这是在带有 .NET 2.0 的 C# 2.0 中。

总之，我使用哪些类来读取模式并对其进行解析以获取用于创建 xml 的有用信息？在我的天真中，我曾希望由于 xsd 本身就是 xml，因此会有某种我可以遍历的 DOM 模型。

我希望这仅限于我的程序，因此不要使用 OxygenXml、VS、xsd.exe 等外部工具。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T20:54:18.157

我一直在用 MSDN 文档流血，我想我已经闻到了气味。使用 XmlSchema.Read 加载架构并编译它。Elements 属性将包含“顶级”元素的集合。您必须对根元素的限定名称或其他内容进行硬编码。然后就是这样。我还没有找到如何在给定的架构元素下找到“内容”。

编辑：我找到了更多的路径，但仍然不是很清楚。XmlSchemaElements 具有架构类型属性。这要么简单，要么复杂。xml 模式中的复杂类型可以具有属性、序列、组等。序列具有称为粒子的属性，它可以是一个元素。并且循环重复。但我认为实现中的难点在于确保涵盖所有可能的情况（简单类型、带有属性的复杂类型、带有属性和元素的复杂类型、扩展、整个 shebang）。

编辑：使用 XmlSchema 对象的 Element 属性来获取 XmlSchemaElement。使用 XmlSchemaElement 的 SchemaType 属性获取简单或复杂类型。使用 XmlSchemaComplexType 的 Attribute 属性获取属性或使用 ContentModel 获取“简单内容”/“复杂内容”或使用 Particle 获取“序列”/“选择”/“全部”。基本上有很多向下移动的属性，检查类型和左右转换对象，并检查所有可能的 xsd 对象排列。创建一个库会很长、很麻烦并且容易出错。这是使用 xml 模式，使用 dtds 我什至不想开始思考。哇，xml 模式是必要的，但为什么它们必须如此邪恶。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-01T16:40:23.640

听起来您想要做的是在大多数优秀的 XML 编辑器中复制 XML 智能感知背后的功能。即读取一个xml 模式并计算出接下来可以出现哪些元素和属性。

我们在前段时间从事的一个项目上做了非常相似的事情。生产大部分时间都有效的东西是很多工作，生产一直有效的东西是大量的工作！

基本上你需要加载 XSD（.net 中的 XmlSchema 对象允许你这样做）。但是他们公开的 SOM 对象模型非常原始，因此您需要做很多工作来解释它。如果您忽略替换组、complexType 扩展、变色龙模式和命名空间等概念，您应该能够相当轻松地浏览 SOM。

You next need to figure out where you are in the XML document with relation to your schema. Once you known were you are in the SOM you can then start to work out the available options.

To do this properly is 1,000' of lines of code and 4-12 man weeks of work. You may be able to get something basic together in a few weeks?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T20:04:48.353

您可以使用第三方工具，例如 XMLSPY ([链接](http://www.altova.com/features_dtdschema.html))。它会从 xsd 生成一个虚拟 xml，反之亦然。

您可以使用计算机上存在的 .NET 工具执行的一种真正迂回（但免费）的方法是使用 xsd.exe ( [link](http://msdn.microsoft.com/en-us/library/x6c1kb0s(VS.71).aspx) ) 生成架构使用以下内容定义的实体对象：

```
xsd /classes /language:CS XSDSchemaFile.xsd 
```

然后，当您拥有对象时，将它们加载到项目中并序列化它们。如果要添加一些虚拟数据，可以填充属性等。

# cmake - Cmake - 设置视觉工作室中间目录

> ID：808380
> 
> 赞同：3
> 
> 时间：2009-04-30T18:26:35.750
> 
> 标签：cmake

如何停止 CMake 将 .dir 添加到我的 IntermediateDirectory 的末尾？

例如：

```
IntermediateDirectory="libTea.dir\Debug" 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2015-04-01T11:34:37.090

没有变量或属性可以做到这一点。更改一些代码即可支持新属性 VS_INTERMEDIATE_DIRECTORY_(CONFIG)。[这](http://www.fjrun.com/?p=344)是一个分步指南。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-30T18:33:00.460

You probably want [`RUNTIME_OUTPUT_DIRECTORY`](http://www.cmake.org/cmake/help/cmake2.6docs.html#prop_tgt:RUNTIME_OUTPUT_DIRECTORY).

# c# - C#4 会允许“动态转换”吗？如果没有，C# 是否应该支持它？

> ID：808384
> 
> 赞同：6
> 
> 时间：2009-04-30T18:28:35.963
> 
> 标签：c#, dynamic, polymorphism, c#-4.0

我并不是指将较低的接口或基类转换为更派生的类的意义上的动态转换，我的意思是采用我创建的接口定义，然后动态地向该接口转换不是从该接口派生的不同对象接口但支持所有调用。

例如，

```
interface IMyInterface
{
   bool Visible
   {
      get;
   }
}

TextBox myTextBox = new TextBox();
IMyInterface i = (dynamic<IMyInterface>)myTextBox; 
```

对于已知类型，这可以在编译时实现，对于使用动态声明的实例，可以在运行时实现。接口定义是已知的，类型也是已知的（在本例中），因此编译器可以确定对象是否支持接口定义的调用，并为我们执行一些魔术来进行强制转换。

我的猜测是这在 C#4 中不受支持（我无法找到对它的引用），但我想确定。如果不是，我想讨论它是否应该包含在语言的未来变体中，以及支持和反对的原因。对我来说，这似乎是一个很好的补充，可以在代码中实现更大的多态性，而无需创建全新的类型来包装现有的框架类型。

**更新**
以免有人指责我抄袭，我不知道[Jon Skeet 已经提出了这个](http://msmvps.com/blogs/jon_skeet/archive/2008/10/30/c-4-0-dynamic-lt-t-gt.aspx)。然而，很高兴知道我们想到了非常相似的语法，这表明它至少可能是直观的。与此同时，“有一个原创的想法”在我的遗愿清单上又保留了一天。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T18:34:09.490

我认为 Jon Skeet 有过这样的提议（[http://msmvps.com/blogs/jon_skeet/archive/2008/10/30/c-4-0-dynamic-lt-t-gt.aspx](http://msmvps.com/blogs/jon_skeet/archive/2008/10/30/c-4-0-dynamic-lt-t-gt.aspx)），但到目前为止，我还没有听说 C# 4.0 会有它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T18:46:40.397

我认为这是有问题的。您正在引入两个未耦合的类之间的耦合。

考虑以下代码。

```
public interface IFoo
{
   int MethodA();
   int MethodB();
}

public class Bar
{
   int MethodA();
   int MethodB();
}

public class SomeClass
{
   int MethodFoo(IFoo someFoo);
} 
```

那么这应该是合法的吗？

```
int blah = someClass.MethodFoo((dynamic<IFoo>)bar); 
```

*看起来*它应该是合法的，因为编译器应该能够将 bar 动态类型为实现 IFoo 的东西。

但是，此时您正在通过代码中完全独立的部分中的调用来耦合 IFoo 和 Bar。

如果你编辑 Bar 因为它不再需要 MethodB，突然 someClass.MethodFood 不再工作，即使 Bar 和 IFoo 不相关。

同样，如果将 MethodC() 添加到 IFoo，即使 IFoo 和 Bar 表面上不相关，您的代码也会再次中断。

事实是，尽管这在您无法控制的对象之间存在相似性的特定情况下很有用，但接口必须显式附加到对象是有原因的，原因是编译器可以保证对象实现它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-09T21:07:12.343

C# 不需要支持这一点，因为它可以作为库非常干净地实现。

我见过三四个独立的实现（我在找到它们之前就开始自己写一个）。这是我见过的最彻底的治疗：

[http://bartdesmet.net/blogs/bart/archive/2008/11/10/introducing-the-c-ducktaper-bridging-the-dynamic-world-with-the-static-world.aspx](http://bartdesmet.net/blogs/bart/archive/2008/11/10/introducing-the-c-ducktaper-bridging-the-dynamic-world-with-the-static-world.aspx)

一旦将 DLR 集成到运行时中，它可能会更容易实现。

因为给定接口的wrapper/forwarder类可以生成一次然后缓存，然后给定类型未知的对象可以封装一次，调用站点等缓存的空间很大，所以性能应该是优秀的。

相比之下，我认为`dynamic`关键字是一种语言特征，而且是一个非常复杂的关键字，它是一种不必要且可能是灾难性的题外话，被硬塞进了一种以前有非常清晰的静态类型哲学的语言中，这给了它一个明显的方向以供将来改进。他们应该坚持这一点，让类型推断工作得越来越好，直到打字变得更加不可见。有很多领域他们可以在不破坏现有程序的情况下发展语言，但他们没有这样做，仅仅是由于资源限制（例如，`var`不能在更多地方使用的原因是因为他们必须重写编译器他们没有时间）。

他们仍然在 C# 4.0（方差特性）中做得很好，但还有很多其他工作要做，以使类型系统更智能、更自动化、更强大地在编译时检测问题。相反，我们本质上是在玩噱头。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-02-28T18:25:23.350

开源框架[Impromptu-Interface](http://code.google.com/p/impromptu-interface/)使用 C# 4 和 dlr 执行此操作。

```
using ImpromptuInterface;

interface IMyInterface
{
   bool Visible
   {
      get;
   }
}

TextBox myTextBox = new TextBox();
IMyInterface i = myTextBox.ActLike<IMyInterface>(); 
```

由于它使用 dlr，因此它也适用于 ExpandoObject 和 DynamicObject。

# c# - 在 session 或 DB 中存储 Viewstate 的陷阱是什么

> ID：808392
> 
> 赞同：2
> 
> 时间：2009-04-30T18:30:48.937
> 
> 标签：c#, asp.net

我读过你可以做到，但这真的会提高页面的性能，还是会带来更多的性能开销？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T19:52:53.887

这是 Scott Hanselman 写的一篇关于在 Session 对象中存储 ViewState 信息的好文章：

[将 ViewState 移至 Session 对象和更多错误](http://www.hanselman.com/blog/MovingViewStateToTheSessionObjectAndMoreWrongheadedness.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T21:34:26.610

Viewstate 数据是关于页面的信息，它被加密并序列化为页面上的隐藏标签。

如果您可以将其存储在会话中，这些是一些问题/陷阱：

*   信息仍然需要从内存中加密/解密和序列化/反序列化
*   如果您有很多用户并且您的会话数据存储在进程中甚至使用状态服务器，那么您将使用视图状态数据最大化这些服务器上的内存。
*   如果您将 SQL Server 用于会话状态，这显然会变得更糟（见下文）。

如果您可以将其存储在 SQL Server 中，这些将是一些问题：

*   同样，信息仍然需要序列化/反序列化（不一定要加密/解密，因为它不会输出到页面），但在这种情况下，它必须从 SQL DB 读取/写入。从/向 DB 读取/写入时，您将在与 DB 之间的传输和 I/O 中产生开销。

# java - 如何检查一个ArrayList的元素是否都包含在另一个ArrayList中

> ID：808394
> 
> 赞同：23
> 
> 时间：2009-04-30T18:30:57.767
> 
> 标签：java, arraylist, subset, containment

如何轻松检查一个 ArrayList 中的所有元素是否都是另一个 ArrayList 的所有元素？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-30T18:34:30.363

使用[Collection.containsAll()](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Collection.html#containsAll(java.util.Collection))：

```
boolean isSubset = listA.containsAll(listB); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T18:39:33.627

所有集合中都有一个 containsAll 方法。

# c++ - 成员模板专业化及其范围

> ID：808403
> 
> 赞同：4
> 
> 时间：2009-04-30T18:32:15.033
> 
> 标签：c++, templates, scope, specialization

在我看来，C++ 不允许在命名空间和全局范围以外的任何范围内进行成员模板特化（MS VSC++ 错误 C3412）。但对我来说，在派生类中专门化基类的主要成员模板是有意义的，因为这是派生类所做的——专门化基类中的东西。例如，考虑以下示例：

```
struct Base
{
  template <class T>
  struct Kind
  {
      typedef T type;
  };
};

struct Derived : public Base
{
  /* Not Allowed */
  using Base::Kind;
  template <>
  struct Kind <float> 
  {
    typedef double type;
  };
};

int main(void)
{
  Base::Kind<float>::type f;    // float type desired
  Derived::Kind<float>::type i; // double type desired but does not work.
} 
```

我的问题是为什么不允许？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T18:44:49.527

我明白你想做的事，但你做得不对。试试这个 ：

```
struct Base{};
struct Derived{};

// Original definition of Kind
// Will yield an error if Kind is not used properly
template<typename WhatToDo, typename T>
struct Kind
{
};

// definition of Kind for Base selector
template<typename T>
struct Kind<Base, T>
{
  typedef T type;
};

// Here is the inheritance you wanted
template<typename T>
struct Kind<Derived, T> : Kind<Base, T>
{
};

// ... and the specialization for float
template<>
struct Kind<Derived, float>
{
  typedef double type;
}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T18:34:17.900

> 我的问题是为什么不允许？

从我的草稿副本看来，以下内容提出了上述限制：

> 在类模板、类模板的成员或类成员模板的显式特化声明中，显式特化的类的名称应为 simple-template-id。

解决方法是专门化封闭类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T19:46:09.550

我将“忽略”标准规范并尝试一个合乎逻辑的论点：

如果你有两个类：

```
class A
{
   struct S { };

};

class B: public A
{
   struct S { };
}; 
```

A::S 和 B::S 是两种不同的类型。将逻辑扩展到模板特化，当您尝试通过派生类中的内部类来特化在基类中声明的内部类时，您实际上是在尝试定义具有相同名称（但另一个命名范围）的不同类型。

# asp.net - 我们可以使用 MSBuild 建立网站吗

> ID：808408
> 
> 赞同：23
> 
> 时间：2009-04-30T18:33:17.573
> 
> 标签：asp.net, msbuild, continuous-integration, cruisecontrol.net

我对持续集成非常陌生。谁能告诉我我们是否可以使用 MSbuild 建立一个网站？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-30T19:18:40.147

您可以使用 AspNetCompiler MSBuild 任务构建网站项目。

[http://msdn.microsoft.com/en-us/library/ms164291.aspx](http://msdn.microsoft.com/en-us/library/ms164291.aspx)

您的 MSBuild 文件可能如下所示：

```
<Project
        xmlns = "http://schemas.microsoft.com/developer/msbuild/2003"
        DefaultTargets = "PrecompileWeb">
        <Target Name = "PrecompileWeb">
                <AspNetCompiler
                        VirtualPath = "DeployTemp" 
                        PhysicalPath = "C:\ccnet\myProject\WebSite"
                        TargetPath = "C:\ccnet\myProject\PreCompiled"
                        Force = "true"
                        Debug = "true"
                        Updateable = "true"/>
        </Target>
</Project> 
```

然后在您的 ccnet.config 中，您将在项目的任务块中添加类似以下内容：

```
<msbuild>
    <executable>C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe</executable>
        <workingDirectory>C:\ccnet\myProject\</workingDirectory>
        <projectFile>C:\ccnet\myProject\myproject.msbuild</projectFile>
        <logger>C:\Program Files\CruiseControl.NET\server\ThoughtWorks.CruiseControl.MsBuild.dll</logger>
</msbuild> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-02-12T14:51:39.830

如果您有网站的 SLN 文件，则可以使用以下命令：

> msbuild YourSolutionFile.sln

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T18:58:49.963

是的，你可以——即使有一个“网站”。

您需要做的是添加“Web 部署项目”并进行设置，以便它从网站上抓取所有文件，编译它们，并使用 WiX 之类的东西，您可以为文件创建一个安装程序，以便能够轻松将您的网站及其所需的所有文件部署到客户的计算机上。

马克

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-30T18:40:40.927

不幸的是，如果您选择“网站”作为您不能的项目类型。但是，如果您选择“Web 应用程序”项目类型，您可以使用 MSBUILD 来构建它。创建“Web 应用程序”项目后，您可以右键单击它并选择“添加 Web 部署项目”，这会将 wdproj 文件添加到您的解决方案中，您可以在其中自定义设置。

您可以将此 wdproj 文件提供给项目的 ccnet 配置文件，该项目可以按照配置的计划运行此文件。一旦我在办公室，我可能会在明天之前为您提供在 cc.net 配置文件中配置所需的适当节点

# php - Getting database values into objects

> ID：808409
> 
> 赞同：4
> 
> 时间：2009-04-30T18:33:33.360
> 
> 标签：php, oop

The thing is that you have classes and then you have the database data. When you create an object how do you set the objects properties to contain the data in the database ?

I saw something like this and I'm wondering if this is really the best way to do it. I'm sure this is a fairly common issue, but I don't know what are the most accepted solutions on how to handle it.

In this example when the object is created you pass an id as a parameter and then you run a query to the database with the id and you assing the returned values to the object properties. I don't have much PHP experience and haven't seen this used much.

Is this an acceptable way to achieve this purpose ? Is there a better or more accepted way ?

```
public function __construct($id = null){
    if($id != null){
        $sql = "SELECT *
        FROM users
        WHERE user_id = $id";

        $res = Db::returnRow($sql);

        // $res contains an associative array with database columns and values

        if($res){
            $this->user_id = $res['user_id'];
            $this->user_name = $res['user_name'];
            //and so on...
        }
    }
} 
```

Could somebody provide some sample code or pseudocode to illustrate what is the correct way to do this ?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T18:40:38.990

It could be an acceptable way for a homework maybe. But architecturaly it is not.

Your class that is representing your business data (a user in your example) must be loosely coupled with your database access logic. In the end the PHP class acting as a user should not be aware that the data come from a database, a file or any other resource. Following that you will be able to reuse your user php class in other projects without having to change anything to it! If you have your data access logic inside it you are stuck.

Conclusion: I would suggest to read some resources on Design Pattern (in your situation take a look at DAO pattern) ;) Hint: the one from Head First series is extremely accessible and enjoyable.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T18:35:33.183

You could create a function to do this for you automatically, by looping over the associative array's key/value pairs. Or you could look into using an [ORM library](https://stackoverflow.com/questions/108699/good-php-orm-library).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T18:41:26.447

Yes, you can semi-automate this by having a parent class all objects inherit from. On load, it queries, "SHOW FIELDS FROM [my tablename]" and populates an associative array with the names. If an id has been passed in, it looks for a valid object in that table with that id and assigns the values to the array.

Side note: don't pass your id directly into your query like that. Parametize the sql and wrap a function around any user input to sanitize it.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-01T00:33:54.633

如果是mysql，你可以这样做：

```
$obj = mysql_fetch_object($query); 
```

PDO 能够使用任意类作为获取的目标，但要注意它们在运行构造函数*之前分配变量数据：*

```
$pdo->query($stmt, PDO::FETCH_CLASS, "MyClass", array('foo'=>'bar')); 
```

...其中最后一个参数包含您的类构造函数的参数。

# ant - 如何从 Ant 文件集中排除文件列表（保存在文件中）？

> ID：808413
> 
> 赞同：4
> 
> 时间：2009-04-30T18:34:29.490
> 
> 标签：ant

有没有办法让 Ant Fileset->IncludesFile 属性获取属性文件或任何其他包含要排除的 Java 类文件列表的文件？

例如：

文件 A.properties 或 A.java 包含列表

```
abc 类
mno.class
xyz类

```

有没有办法说将 excludesFile 指向文件 A.properties。

```
<fileset dir="...">
    <excludesFile file="A.properties" />
</fileset> 
```

我想要的行为是当 Java 运行时，它不包括此文件中列出的 Java 文件（A.properties）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-05T19:27:24.547

嗯...不确定它是否区分大小写。[http://ant.apache.org/manual/Types/fileset.html](http://ant.apache.org/manual/Types/fileset.html)上的文档显示“excludesfile”，全部小写，与其他 ant 指令一样。

我不确定你在问什么。如果您有一个包含要排除的文件的文件集，并且您想在外部文件中指定要排除的文件列表，则“excludesfile”是正确的方法。

# sqlite - 如何更新一个语句中的两列？

> ID：808418
> 
> 赞同：40
> 
> 时间：2009-04-30T18:35:15.730
> 
> 标签：sqlite

如何一次更新 2 列？

我尝试了以下语句，它不起作用：

```
UPDATE exercises
SET times_answered = times_answered + 1
AND av_answeringTime = av_answeringTime + ( (av_answeringTime / (times_answered) ) + ?) * (times_answered + 1)
WHERE name = ? 
```

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-04-30T18:36:09.970

使用逗号而不是“AND”：

```
UPDATE exercises
SET times_answered = times_answered + 1,
    av_answeringTime = av_answeringTime + ( (av_answeringTime / (times_answered) ) + ?) * (times_answered + 1)
WHERE name = ? 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-04-30T18:38:42.630

SQL UPDATE 语法是：

```
UPDATE table SET
  column1 = value1,
  column2 = value2
WHERE condition 
```

而不是 AND 你需要一个逗号

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-30T18:36:42.027

尝试这样的事情......

```
UPDATE exercises
SET times_answered = times_answered + 1,
av_answeringTime = av_answeringTime + ( (av_answeringTime / (times_answered) ) + ?) * (times_answered + 1)
WHERE name = ? 
```

# linux - 如果 Perl 试图对正在上传的文件调用 move() 会发生什么？

> ID：808419
> 
> 赞同：12
> 
> 时间：2009-04-30T18:35:23.670
> 
> 标签：linux, perl, ftp, inode

有人正在将一个 10Mb 大小的文件通过 FTP 传输到 linux 服务器上的文件夹中。当文件处于转换过程中时，一个 cron 会唤醒并触发一个 Perl 脚本，该脚本旨在查看 ftp 文件夹并将在那里找到的任何内容移动到某个备用文件夹。我正在使用[File::Copy](http://search.cpan.org/dist/File-Copy)`move()`中的函数。Perl 进程实际上将文件重命名为其任务的一部分。这有关系，还是 FTP 不在乎文件系统将文件描述为什么？

会`move()`成功并移动一个部分文件，让FTP做什么？还是会移动失败并返回 0？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-30T18:40:04.500

不，移动应该只是让在新位置上完成下载过程。您只是将 inode 从一个位置移动到另一个位置。下载程序的打开文件描述符仍应指向它。

我只想重复其他一些人提到的内容。这仅在移动操作在同一文件系统上时才有效。如果它作为另一个文件系统而不是 inode 无法传输，因为它始终属于同一个文件系统。最可能的情况是，当时的部分数据被复制到新位置，而程序仍然在旧的 inode 中下载，旧的 inode 不再附加到文件中，因此无法使用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-30T18:46:55.030

由于没有标准`move`，因此很难知道您的场景中发生了什么。如果你的意思是`rename`，那么你可能不会有任何问题，因为你的情况会出错的主要方式是如果你将文件从一个文件系统移动到另一个文件系统（因此进行复制和删除，而不是真正的move)，并且在大多数系统上，`rename`在这些情况下都会失败。（因此，如果您的设置完全有效，那就没问题了。）

如果您没有使用`rename`某些`move`功能，例如，将处理跨文件系统的移动，那么如果涉及多个文件系统，您很可能会得到一个部分文件。（这可能会成为一个非常讨厌的问题，例如，如果你现在都在一个文件系统上，但后来你上传的这些文件占用了大量空间，并且你添加了一个专门用于存储它们的驱动器——现在你正在做一个跨文件系统的移动。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T18:42:03.217

我不确定，但很可能不会发生任何错误。移动不会改变文件 inode 编号，因此 FTP 服务器根本不会注意到移动，并会继续写入新位置的文件。简而言之，`move()`将成功，上传将在新位置继续。

# web-services - API 与 Web 服务

> ID：808421
> 
> 赞同：210
> 
> 时间：2009-04-30T18:35:39.830
> 
> 标签：web-services, terminology

Web服务和API有什么区别？差异是否超过用于传输数据的协议？谢谢。

* * *

## 回答 #1

> 赞同：179
> 
> 时间：2009-04-30T18:45:03.880

API（应用程序编程接口）是第三方可以编写与其他代码接口的代码的方法。Web 服务是一种 API，几乎总是通过 HTTP 运行（尽管有些，如 SOAP，可以使用替代传输，如 SMTP）。W3C的[官方定义](http://www.w3.org/TR/ws-gloss/)提到 Web 服务不一定使用 HTTP，但这几乎总是如此，除非另有说明，否则通常是假定的。

有关 Web 服务的具体示例，请参阅[SOAP](http://en.wikipedia.org/wiki/SOAP)、[REST](http://en.wikipedia.org/wiki/REST)和[XML-RPC](http://en.wikipedia.org/wiki/XML-RPC)。有关另一种类型的 API 的示例，一种用 C 编写的用于本地计算机的 API，请参阅[Linux Kernel API](http://kernelbook.sourceforge.net/kernel-api.html/)。

就协议而言，Web 服务 API 几乎总是使用 HTTP（因此是 Web 部分），并且肯定涉及网络通信。API 通常可以使用它们希望的任何通信方式。例如，Linux 内核 API 使用[中断](http://en.wikipedia.org/wiki/Interrupt)来调用构成其 API 的系统调用，以用于来自用户空间的调用。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-04-30T18:37:20.357

基本上，Web 服务是两台机器之间的一种通信方法，而 API 是一个暴露层，允许您针对某些东西进行编程。

您很可能拥有一个 API，并且与该 API 交互的主要方法是通过 Web 服务。

技术定义（由维基百科提供）是：

## [API](http://en.wikipedia.org/wiki/API)

> 应用程序编程接口 (API) 是由库和/或操作系统服务提供的一组例程、数据结构、对象类和/或协议，以支持应用程序的构建。

## [网络服务](http://en.wikipedia.org/wiki/Web_service)

> W3C 将 Web 服务（也称为 Web 服务）定义为“旨在支持网络上可互操作的机器对机器交互的软件系统”

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2009-04-30T18:42:39.797

在一般意义上，Web 服务**是**基于 HTTP 的 API。他们经常使用 JSON 或 XML，但也有其他一些方法。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-30T19:03:12.260

API 是一个已发布的接口，它定义了组件 A 与组件 B 的通信方式。

例如，Doubleclick 有一个已发布的 Java API，它允许用户查询数据库表以获取有关其在线广告活动的信息。

例如调用 GetNumberClicks（用户名）

要实现 API，您必须将 Doubleclick .jar 文件添加到您的类路径中。呼叫是本地的。

Web 服务是 API 的一种形式，其中接口是通过 WSDL 定义的。这允许通过 HTTP 远程调用接口。

如果 Doubleclick 将他们的界面实现为 Web 服务，他们将使用在 Tomcat 中运行的类似 Axis2 的东西。

远程用户将调用 Web 服务

例如调用 GetNumberClicksWebService（用户名）

GetNumberClicksWebService 服务将在本地调用 GetNumberClicks。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-09-20T13:25:30.657

API（应用程序编程接口），完整的形式本身表明它是一个接口，它允许您在其他应用程序接口的帮助或支持下为您的应用程序编程，该接口公开了某种对您的应用程序有用的功能。

例如，在您的网站上显示更新的货币汇率将需要一些第三方接口来编程，除非您计划拥有自己的汇率数据库并定期更新。这组功能在其他人已经可用并且当他们想要与其他人共享时，他们必须有一个端点来与对此类交互感兴趣的其他人进行通信，因此他们通过 web-服务。这个端点只不过是他们应用程序的接口，您可以针对 API 进行编程。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-30T18:39:38.963

将 Web 服务视为 Web api。API 现在是一个通用术语，因此 Web 服务是功能的接口，通常与业务相关，您可以通过各种协议从网络访问它。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-09-20T13:15:05.973

API 是基于代码的集成，而 Web 服务是基于消息的集成，与具有诸如 WSDL 之类的合同的可互操作标准进行集成。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-07-06T07:11:22.430

检查这个[http://en.wikipedia.org/wiki/Web_service](http://en.wikipedia.org/wiki/Web_service)

正如链接中提到的那样，Web API 是 Web 服务的开发，很可能与 Web 2.0 相关，而基于 SOAP 的服务被基于 REST 的通信所取代。请注意，REST 服务不需要 XML、SOAP 或 WSDL 服务 API 定义，因此这与传统的 Web 服务有很大不同。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2011-09-01T22:39:49.410

另一个例子：google map api vs google direction api web service，前者向站点提供（传递）javascript文件（然后可以用作api来制作新功能），后者是传递数据的Rest web服务（ json 或 xml 格式），可以处理（但不能在 api 意义上使用）。

# windows - 适用于 Windows 的 Mac 风格“Dvorak - Qwerty 命令”键盘映射？

> ID：808422
> 
> 赞同：13
> 
> 时间：2009-04-30T18:35:55.977
> 
> 标签：windows, keyboard, dvorak, qwerty

我有兴趣切换到 Dvorak 键盘布局。大家遇到的问题是常见的编程*键盘快捷键，例如：

*   Ctrl+C
*   Ctrl+V
*   Ctrl+Z

将不再是键盘左下角的键，因为 Dvorak 布局在不同的位置有 C、V 和 Z。

Mac 通过使用名为*“Dvorak - Qwerty Command”*的键盘布局解决了这个问题，其中键盘通常处于 Dvorak 模式，但如果您按下命令键，则映射会暂时恢复为 Qwerty。

Windows 上是否存在这样的功能？有人建议可以使用[Microsoft 键盘布局创建](http://msdn.microsoft.com/en-us/goglobal/bb964665.aspx)器来完成这样的壮举，但我不会假装理解所有这些。

换句话说，Stackoverflow 用户，这是一个已经解决的问题吗？

* * *

* 笑话是最常见的编程任务是**Ctrl+C**，**Ctrl+V**。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-07-16T02:47:56.073

我现在只使用 Dvorak，包括所有快捷方式。以下是我到达现在的方式和原因：

我在 2.5 年前的圣诞假期不久就开始了这种改变。我有一段时间没有上学或工作，所以打字能力差不会对我的日常活动产生负面影响。我和自己约定：在我的 Dvorak 打字达到我目前的 QWERTY 能力之前，完全不要 QWERTY。这是迄今为止最好的也是最痛苦的决定。我每天花 2-3 个小时训练键盘。达到 50WPM 用了 3 周时间，出于某种原因，我花了 2 个月的时间才达到上限！我一直在训练，大约 3 个月后，我超过了使用 QWERTY 时的原始归一化效率（计数准确性）。现在我比使用 QWERTY 时快了一点，但最重要的是，我发现*在漫长的一天结束后我的手不再受伤*。它使世界变得与众不同。

规则：

*   不要重新排列键盘上的按键。这是触摸打字，别找了！移动按键会打乱关键的 f/j 提示并改变键盘的感觉，所有这些都是为了为您提供您永远不会使用的视觉信息。
*   在您最初学习 Dvorak 时不要切换回 QWERTY，“这样您可以更快地输入一些东西。”
*   每天使用在线打字软件练习。已经很久了，不幸的是我不记得我在哪里练习了。:(
*   最初在 Dvorak 上打字后你的手指会受伤。一开始我的钥匙有很多问题`l`，但那是因为我根本不习惯它，学习的压力让我很紧张。随着你的进步，事情会变得更好，在你知道之前，你会在 Dvorak 上比在 QWERTY 上更舒服。

建议：

*   不要像上面提到的那样使用 Dvorak/QWERTY 组合模式。[Dvorak 助手](http://www.clabs.org/blogki/index.cgi?page=/ComputersAndTechnology/DvAssist)可让您在任何地方使用 Dvorak，并为您个人在计算机之间保持一致的快捷方式，使用相同的快捷方式字符（在它们的新位置）。

观察：

*   既然人们首先学习德沃夏克要容易得多，而且它会减少以后生活中的伤害，我们到底*为什么不在我们的小学里教这个？？？*老实说，我认为向这些坐在 QWERTY 布局后面的学生教授“正确打字”是*不正确的。*最重要的是，班级已经在所有按键上贴了贴纸以防止偷看，那么教QWERTY真的有什么意义呢？我想我很沮丧，因为我在 QWERTY 上的指示式触摸打字是我后来花了这么长时间才学会在真正的键盘上打字的主要原因。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-02-05T11:57:17.573

这可以提供帮助：[https ://sourceforge.net/projects/dvorakqwerty/](https://sourceforge.net/projects/dvorakqwerty/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-02-06T00:27:20.617

我也遇到了同样的情况，所以我写了这个：

[http://dvorak-qwerty.googlecode.com](http://dvorak-qwerty.googlecode.com)

希望能帮助到你！

（也许使用键盘布局创建器会更好，但我也不想弄清楚！）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-03T11:59:24.617

[AutoHotKey](http://www.autohotkey.com/)来救援。这将在正常打字和按住 Shift 时使用 DVORAK。按住 Ctrl 或 Alt 时，QWERTY 行为会接管。

```
;Sorry about the messed up syntax highlighting.
;Disclaimer: may not work at all.
#UseHook
-::Send {Blind}[
=::Send {Blind}]

q::Send {Blind}'
w::Send {Blind}`,
e::Send {Blind}.
r::Send {Blind}p
t::Send {Blind}y
y::Send {Blind}f
u::Send {Blind}g
i::Send {Blind}c
o::Send {Blind}r
p::Send {Blind}l
[::Send {Blind}/
]::Send {Blind}=

a::Send {Blind}a
s::Send {Blind}o
d::Send {Blind}e
f::Send {Blind}u
g::Send {Blind}i
h::Send {Blind}d
j::Send {Blind}h
k::Send {Blind}t
l::Send {Blind}n
`;::Send {Blind}s
'::Send {Blind}-

z::Send {Blind}`;
x::Send {Blind}q
c::Send {Blind}j
v::Send {Blind}k
b::Send {Blind}x
n::Send {Blind}b
m::Send {Blind}m
,::Send {Blind}w
.::Send {Blind}v
/::Send {Blind}z

;capitalise

+-::Send {Blind}{{}
+=::Send {Blind}{}}
+q::Send {Blind}"
+w::Send {Blind}<
+e::Send {Blind}>
+r::Send {Blind}P
+t::Send {Blind}Y
+y::Send {Blind}F
+u::Send {Blind}G
+i::Send {Blind}C
+o::Send {Blind}R
+p::Send {Blind}L
+[::Send {Blind}?
+]::Send {Blind}{+}

+a::Send {Blind}A
+s::Send {Blind}O
+d::Send {Blind}E
+f::Send {Blind}U
+g::Send {Blind}I
+h::Send {Blind}D
+j::Send {Blind}H
+k::Send {Blind}T
+l::Send {Blind}N
+;::Send {Blind}S
+'::Send {Blind}_

+z::Send {Blind}:
+x::Send {Blind}Q
+c::Send {Blind}J
+v::Send {Blind}K
+b::Send {Blind}X
+n::Send {Blind}B
+m::Send {Blind}M
+,::Send {Blind}W
+.::Send {Blind}V
+/::Send {Blind}Z 
```

最终这可能会成为一个打击，因为它不能与 GNU/Linux 一起使用，所以如果你尝试过，可能需要另一个解决方案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-01T23:21:44.263

你是对的，AutoHotkey 不能帮助 GNU/Linux 用户……但是，如果你在 Windows 上，AutoHotkey 又一次出现了！除了代码应该更像这样：

```
^;::Send {Blind}z   ;Undo
^q::Send {Blind}x   ;Cut
^j::Send {Blind}c   ;Copy
^k::Send {Blind}v   ;Paste
^o::Send {Blind}s   ;Save
^r::Send {Blind}o   ;Open
^f::Send {Blind}y   ;Redo 
```

我有一种感觉，AHK 是答案，但我不知道如何去做。感谢您为我指明正确的方向！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-01-18T04:55:33.940

[Dvertkey](https://github.com/imathew/dvertkey)是一个 AutoHotKey 脚本，它比我使用过的任何其他 Windows 解决方案都适合更多的场景。

这是一个老问题，但多年来我一直回到这里，没有一个解决方案没有烦恼。感谢 ftvs 提供的 AutoHotKey 答案，激发了我编写这个脚本。

我成为 dvorak 用户已有 16 年了，多年来我一直在使用此线程中提到的各种替代键盘映射，但在使用 Microsoft 应用程序的一些最新版本时，它们都失败了，例如 Office 应用程序和SQL Server 管理工作室。在使用元键时，它们似乎忽略了 Windows 自己的键映射，从而使混合布局无用。AutoHotKey 解决了这个问题，以确保我在任何应用程序中都能得到我想要的。

虽然我同意 Sam Harwell 对新 dvorak 用户的建议的观点，但我不同意不更改快捷字符的建议。好的键盘快捷键更多的是关于它们在键盘上的*位置*，而不是代表它的字符。选择这些通常有充分的理由（例如，常见的 XCV 是剪切-复制-粘贴，一起在键盘底部），并且在移动到 Dvorak 时没有理由失去良好的快捷方式定位。这个脚本将保留它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-10-12T10:12:43.643

你可以试试这个[http://aming-blog.blogspot.com/2010/10/mac-style-dvorak-qwerty-control-layout.html](http://aming-blog.blogspot.com/2010/10/mac-style-dvorak-qwerty-control-layout.html)

# vb.net - vb.net - 使用来自对象的多个属性填充组合框

> ID：808431
> 
> 赞同：0
> 
> 时间：2009-04-30T18:37:02.353
> 
> 标签：vb.net, collections

使用 vb.net (vs2005)，我如何使用来自对象的多个属性值填充组合框？现在我正在迭代一个对象集合并将每个对象的名称属性添加到组合框中。我想将对象中的多个属性添加到列表中。现在，如果它们在列表中以逗号分隔，我会很高兴。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T19:13:27.947

```
Private _items As New List(Of Person)  'you will need to fill this with data!'

Private Sub Populate()

  For i As Integer = 0 To _items.count - 1
    lst.items.add(_items(i).Name & ", " & _items(i).Age)
  Next

End Sub 
```

这将填充您的列表框（我称之为 lst），如下所示：

```
Dave, 18
John, 21
Morgan, 23
Jen, 19 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T19:14:21.017

如果这是一个 winforms 环境，请覆盖 ToStirng() 方法，并简单地将整个对象添加到项目集合中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-01T16:26:06.577

您可以自己覆盖该方法。或者你像我一样懒惰。试试这个多列组合框
[http://demos.telerik.com/aspnet-ajax/combobox/examples/functionality/multicolumncombo/defaultcs.aspx](http://demos.telerik.com/aspnet-ajax/combobox/examples/functionality/multicolumncombo/defaultcs.aspx)

# math - 逆双线性插值？

> ID：808441
> 
> 赞同：40
> 
> 时间：2009-04-30T18:38:57.217
> 
> 标签：math, graphics, geometry, 2d, bilinear-interpolation

我有四个 2d 点，p0 = (x0,y0), p1 = (x1,y1) 等，它们形成一个四边形。就我而言，四边形不是矩形，但至少应该是凸的。

```
 p2 --- p3
  |      |
t |  p   |
  |      |
  p0 --- p1
     s 
```

我正在使用双线性插值。S 和 T 在 [0..1] 范围内，插值点由下式给出：

```
bilerp(s,t) = t*(s*p3+(1-s)*p2) + (1-t)*(s*p1+(1-s)*p0) 
```

这是问题所在。我有一个二维点 p，我知道它在四边形内。我想找到在使用双线性插值时会给我那个点的 s,t。

是否有一个简单的公式来反转双线性插值？

* * *

感谢您的解决方案。我将 Naaff 解决方案的实现发布为 wiki。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-01T16:21:51.173

我认为最容易将您的问题视为相交问题：点 p 与由 p0、p1、p2 和 p3 定义的任意二维双线性曲面相交的参数位置 (s,t) 是什么。

我将采取的解决这个问题的方法类似于 tspauld 的建议。

从关于 x 和 y 的两个方程开始：

```
x = (1-s)*( (1-t)*x0 + t*x2 ) + s*( (1-t)*x1 + t*x3 )
y = (1-s)*( (1-t)*y0 + t*y2 ) + s*( (1-t)*y1 + t*y3 ) 
```

求解 t：

```
t = ( (1-s)*(x0-x) + s*(x1-x) ) / ( (1-s)*(x0-x2) + s*(x1-x3) )
t = ( (1-s)*(y0-y) + s*(y1-y) ) / ( (1-s)*(y0-y2) + s*(y1-y3) ) 
```

我们现在可以设置这两个方程彼此相等以消除 t。将所有内容移至左侧并简化我们得到以下形式的方程：

```
A*(1-s)^2 + B*2s(1-s) + C*s^2 = 0 
```

在哪里：

```
A = (p0-p) X (p0-p2)
B = ( (p0-p) X (p1-p3) + (p1-p) X (p0-p2) ) / 2
C = (p1-p) X (p1-p3) 
```

请注意，我使用运算符 X 来表示[二维叉积](http://mathworld.wolfram.com/CrossProduct.html "二维叉积定义")（例如，p0 X p1 = x0*y1 - y0*x1）。我已将此方程格式化为二次[伯恩斯坦多项式](http://en.wikipedia.org/wiki/Bernstein_polynomial "伯恩斯坦多项式定义")，因为这使事情更优雅并且在数值上更稳定。s 的解是这个方程的根。我们可以使用 Bernstein 多项式的二次公式求根：

```
s = ( (A-B) +- sqrt(B^2 - A*C) ) / ( A - 2*B + C ) 
```

由于 +-，二次公式给出了两个答案。如果您只对 p 位于双线性曲面内的解感兴趣，那么您可以丢弃 s 不在 0 和 1 之间的任何答案。要找到 t，只需将 s 代入上面我们求解 t 的两个方程之一就 s 而言。

我应该指出一个重要的特殊情况。如果分母 A - 2*B + C = 0 那么你的二次多项式实际上是线性的。在这种情况下，您必须使用更简单的方程来找到 s：

```
s = A / (A-C) 
```

除非 AC = 0，否则这将为您提供一个解决方案。如果 A = C，那么您有两种情况：A=C=0 表示s 的*所有*值都包含 p，否则s 的值*不*包含 p。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2013-08-20T09:50:26.680

可以使用[**牛顿法**](https://en.wikipedia.org/wiki/Newton%27s_method#Nonlinear_systems_of_equations)迭代求解以下非线性方程组：

```
p = p0*(1-s)*(1-t) + p1*s*(1-t) + p2*s*t + p3*(1-s)*t. 
```

请注意，有两个方程（方程的 x 和 y 分量相等）和两个未知数（s 和 t）。

要应用牛顿法，我们需要[残差](https://en.wikipedia.org/wiki/Residual_(numerical_analysis))r，即：

```
r = p - (p0*(1-s)*(1-t) + p1*s*(1-t) + p2*s*t + p3*(1-s)*t), 
```

和[雅可比矩阵](https://en.wikipedia.org/wiki/Jacobian_matrix_and_determinant)J，它是通过对残差进行微分得到的。对于我们的问题，雅可比行列式是：

```
J(:,1) = dr/ds = -p0*(1-t) + p1*(1-t) + p2*t - p3*t   (first column of matrix)
J(:,2) = dr/dt =  -p0*(1-s) - p1*s + p2*s + p3*(1-s)    (second column). 
```

要使用牛顿法，首先要进行初始猜测 (s,t)，然后执行以下迭代几次：

```
(s,t) = (s,t) - J^-1 r, 
```

使用新的 s 和 t 值在每次迭代中重新计算 J 和 r。在每次迭代中，主要成本是将雅可比矩阵的逆应用于残差 (J^-1 r)，方法是求解一个 2x2 线性系统，其中 J 作为系数矩阵，r 作为右手边。

**该方法的直觉：**

直观地说，如果四边形是[平行](https://en.wikipedia.org/wiki/Parallelogram)四边形，解决问题会容易得多。牛顿的方法是用连续的平行四边形近似来解决四边形问题。在每次迭代中，我们

1.  使用点 (s,t) 处的局部导数信息用平行四边形逼近四边形。

2.  通过求解线性系统，在平行四边形近似下找到正确的 (s,t) 值。

3.  跳到这个新点并重复。

**该方法的优点：**

正如对牛顿型方法所预期的那样，收敛速度非常快。随着迭代的进行，不仅方法越来越接近真实点，而且局部平行四边形近似也变得更加准确，因此收敛速度本身也增加了（在迭代方法行话中，我们说牛顿法是[*二次收敛*](https://en.wikipedia.org/wiki/Rate_of_convergence)）。在实践中，这意味着每次迭代时正确数字的数量大约翻倍。

这是我进行的随机试验的迭代与错误的代表性表（代码见下文）：

```
Iteration  Error
1          0.0610
2          9.8914e-04
3          2.6872e-07
4          1.9810e-14
5          5.5511e-17 (machine epsilon) 
```

经过两次迭代后，误差小到足以有效地忽略不计，并且对于大多数实际目的来说足够好，并且经过 5 次迭代后，结果精确到[机器精度](https://en.wikipedia.org/wiki/Machine_epsilon)的极限。

如果您固定迭代次数（例如，对于大多数实际应用，3 次迭代，如果您需要非常高的准确度，则为 8 次迭代），那么该算法的逻辑非常简单明了，其结构非常适合高-性能计算。无需检查各种特殊的边缘情况*，并根据结果使用不同的逻辑。它只是一个包含一些简单公式的 for 循环。下面我强调了这种方法相对于在此处和互联网上的其他答案中找到的基于公式的传统方法的几个优点：

*   *易于编码*。只需创建一个 for 循环并输入一些公式。

*   *没有条件或分支*（if/then），这通常允许更好的[流水线效率](https://en.wikipedia.org/wiki/Instruction_pipelining#Branches)。

*   *没有平方根，*每次迭代只需要 1 个除法（如果写得好）。所有其他操作都是简单的加法、减法和乘法。平方根和除法通常比加法/乘法/乘法慢几倍，并且可能会破坏某些架构上的[缓存](https://en.wikipedia.org/wiki/Cache_(computing))效率（尤其是在某些嵌入式系统上）。实际上，如果您深入了解现代编程语言如何实际计算[平方根](https://en.wikipedia.org/wiki/Fast_inverse_square_root)和[除法](https://en.wikipedia.org/wiki/Division_algorithm#Fast_division_methods)，它们都使用牛顿方法的变体，有时在硬件中，有时在软件中，具体取决于架构。

*   *可以很容易地矢量化*以同时处理具有大量四边形的数组。有关如何执行此操作的示例，请参见下面的矢量化代码。

*   *扩展到任意维度*。该算法以一种直接的方式扩展到任意维数（2d、3d、4d、...）中的逆多线性插值。我在下面包含了一个 3D 版本，可以想象编写一个简单的递归版本，或者使用自动微分库去 n 维。牛顿方法通常表现出与维度无关的收敛速度，因此原则上该方法应该在当前硬件上可扩展到几千维（！）（在此之后，构建和求解 n×n 矩阵 J 可能是限制因素）。

当然，这些事情中的大多数还取决于硬件、编译器和许多其他因素，因此您的里程可能会有所不同。

**代码：**

无论如何，这是我的 Matlab 代码：（我将这里的所有内容发布到公共领域）

**基本 2D 版本：**

```
function q = bilinearInverse(p,p1,p2,p3,p4,iter)
%Computes the inverse of the bilinear map from [0,1]^2 to the convex
% quadrilateral defined by the ordered points p1 -> p2 -> p3 -> p4 -> p1.
%Uses Newton's method. Inputs must be column vectors.
    q = [0.5; 0.5]; %initial guess
    for k=1:iter
        s = q(1);
        t = q(2);
        r = p1*(1-s)*(1-t) + p2*s*(1-t) + p3*s*t + p4*(1-s)*t - p;%residual
        Js = -p1*(1-t) + p2*(1-t) + p3*t - p4*t; %dr/ds
        Jt = -p1*(1-s) - p2*s + p3*s + p4*(1-s); %dr/dt
        J = [Js,Jt];
        q = q - J\r;
        q = max(min(q,1),0);
    end
end 
```

示例用法：

```
% Test_bilinearInverse.m
p1=[0.1;-0.1]; 
p2=[2.2;-0.9]; 
p3=[1.75;2.3]; 
p4=[-1.2;1.1];

q0 = rand(2,1);
s0 = q0(1); 
t0 = q0(2);
p = p1*(1-s0)*(1-t0) + p2*s0*(1-t0) + p3*s0*t0 + p4*(1-s0)*t0;

iter=5;
q = bilinearInverse(p,p1,p2,p3,p4,iter);

err = norm(q0-q);
disp(['Error after ',num2str(iter), ' iterations: ', num2str(err)]) 
```

示例输出：

```
>> test_bilinearInverse
Error after 5 iterations: 1.5701e-16 
```

* * *

**快速矢量化 2D 版本：**

```
function [ss,tt] = bilinearInverseFast(px,py, p1x,p1y, p2x,p2y, p3x,p3y, p4x,p4y, iter)
%Computes the inverse of the bilinear map from [0,1]^2 to the convex
% quadrilateral defined by the ordered points p1 -> p2 -> p3 -> p4 -> p1,
% where the p1x is the x-coordinate of p1, p1y is the y-coordinate, etc.
% Vectorized: if you have a lot of quadrilaterals and 
% points to interpolate, then p1x(k) is the x-coordinate of point p1 on the
% k'th quadrilateral, and so forth.
%Uses Newton's method. Inputs must be column vectors.
    ss = 0.5 * ones(length(px),1);
    tt = 0.5 * ones(length(py),1);
    for k=1:iter
        r1 = p1x.*(1-ss).*(1-tt) + p2x.*ss.*(1-tt) + p3x.*ss.*tt + p4x.*(1-ss).*tt - px;%residual
        r2 = p1y.*(1-ss).*(1-tt) + p2y.*ss.*(1-tt) + p3y.*ss.*tt + p4y.*(1-ss).*tt - py;%residual

        J11 = -p1x.*(1-tt) + p2x.*(1-tt) + p3x.*tt - p4x.*tt; %dr/ds
        J21 = -p1y.*(1-tt) + p2y.*(1-tt) + p3y.*tt - p4y.*tt; %dr/ds
        J12 = -p1x.*(1-ss) - p2x.*ss + p3x.*ss + p4x.*(1-ss); %dr/dt
        J22 = -p1y.*(1-ss) - p2y.*ss + p3y.*ss + p4y.*(1-ss); %dr/dt

        inv_detJ = 1./(J11.*J22 - J12.*J21);

        ss = ss - inv_detJ.*(J22.*r1 - J12.*r2);
        tt = tt - inv_detJ.*(-J21.*r1 + J11.*r2);

        ss = min(max(ss, 0),1);
        tt = min(max(tt, 0),1);
    end
end 
```

为了加快速度，此代码隐含地使用以下公式计算 2x2 矩阵的逆：

```
[a,b;c,d]^-1 = (1/(ad-bc))[d, -b; -c, a] 
```

示例用法：

```
% test_bilinearInverseFast.m
n_quads = 1e6; % 1 million quads
iter = 8;

% Make random quadrilaterals, ensuring points are ordered convex-ly
n_randpts = 4;
pp_xx = zeros(n_randpts,n_quads);
pp_yy = zeros(n_randpts,n_quads);
disp('Generating convex point ordering (may take some time).')
for k=1:n_quads
    while true
        p_xx = randn(4,1);
        p_yy = randn(4,1);
        conv_inds = convhull(p_xx, p_yy);
        if length(conv_inds) == 5
            break
        end
    end
    pp_xx(1:4,k) = p_xx(conv_inds(1:end-1));
    pp_yy(1:4,k) = p_yy(conv_inds(1:end-1));
end

pp1x = pp_xx(1,:);
pp1y = pp_yy(1,:);
pp2x = pp_xx(2,:);
pp2y = pp_yy(2,:);
pp3x = pp_xx(3,:);
pp3y = pp_yy(3,:);
pp4x = pp_xx(4,:);
pp4y = pp_yy(4,:);

% Make random interior points
ss0 = rand(1,n_quads);
tt0 = rand(1,n_quads);

ppx = pp1x.*(1-ss0).*(1-tt0) + pp2x.*ss0.*(1-tt0) + pp3x.*ss0.*tt0 + pp4x.*(1-ss0).*tt0;
ppy = pp1y.*(1-ss0).*(1-tt0) + pp2y.*ss0.*(1-tt0) + pp3y.*ss0.*tt0 + pp4y.*(1-ss0).*tt0;
pp = [ppx; ppy];

% Run fast inverse bilinear interpolation code:
disp('Running inverse bilinear interpolation.')
tic
[ss,tt] = bilinearInverseFast(ppx,ppy, pp1x,pp1y, pp2x,pp2y, pp3x,pp3y, pp4x,pp4y, 10);
time_elapsed = toc;

disp(['Number of quadrilaterals: ', num2str(n_quads)])
disp(['Inverse bilinear interpolation took: ', num2str(time_elapsed), ' seconds'])

err = norm([ss0;tt0] - [ss;tt],'fro')/norm([ss0;tt0],'fro');
disp(['Error: ', num2str(err)]) 
```

示例输出：

```
>> test_bilinearInverseFast
Generating convex point ordering (may take some time).
Running inverse bilinear interpolation.
Number of quadrilaterals: 1000000
Inverse bilinear interpolation took: 0.5274 seconds
Error: 8.6881e-16 
```

* * *

**3D版本：**

包括一些代码来显示收敛进度。

```
function ss = trilinearInverse(p, p1,p2,p3,p4,p5,p6,p7,p8, iter)
%Computes the inverse of the trilinear map from [0,1]^3 to the box defined
% by points p1,...,p8, where the points are ordered consistent with
% p1~(0,0,0), p2~(0,0,1), p3~(0,1,0), p4~(1,0,0), p5~(0,1,1),
% p6~(1,0,1), p7~(1,1,0), p8~(1,1,1)
%Uses Gauss-Newton method. Inputs must be column vectors.
    tol = 1e-9;
    ss = [0.5; 0.5; 0.5]; %initial guess
    for k=1:iter
        s = ss(1);
        t = ss(2);
        w = ss(3);

        r = p1*(1-s)*(1-t)*(1-w) + p2*s*(1-t)*(1-w) + ...
            p3*(1-s)*t*(1-w)     + p4*(1-s)*(1-t)*w + ...
            p5*s*t*(1-w)         + p6*s*(1-t)*w + ...
            p7*(1-s)*t*w         + p8*s*t*w - p;

        disp(['k= ', num2str(k), ...
            ', residual norm= ', num2str(norm(r)),...
            ', [s,t,w]= ',num2str([s,t,w])])
        if (norm(r) < tol)
            break
        end

        Js = -p1*(1-t)*(1-w) + p2*(1-t)*(1-w) + ...
             -p3*t*(1-w)     - p4*(1-t)*w + ...
              p5*t*(1-w)     + p6*(1-t)*w + ...
             -p7*t*w         + p8*t*w;

         Jt = -p1*(1-s)*(1-w) - p2*s*(1-w) + ...
               p3*(1-s)*(1-w) - p4*(1-s)*w + ...
               p5*s*(1-w)     - p6*s*w + ...
               p7*(1-s)*w     + p8*s*w;

         Jw = -p1*(1-s)*(1-t) - p2*s*(1-t) + ...
              -p3*(1-s)*t     + p4*(1-s)*(1-t) + ...
              -p5*s*t         + p6*s*(1-t) + ...
               p7*(1-s)*t     + p8*s*t;

        J = [Js,Jt,Jw];
        ss = ss - J\r;
    end
end 
```

示例用法：

```
%test_trilinearInverse.m
h = 0.25;
p1 = [0;0;0] + h*randn(3,1);
p2 = [0;0;1] + h*randn(3,1);
p3 = [0;1;0] + h*randn(3,1);
p4 = [1;0;0] + h*randn(3,1);
p5 = [0;1;1] + h*randn(3,1);
p6 = [1;0;1] + h*randn(3,1);
p7 = [1;1;0] + h*randn(3,1);
p8 = [1;1;1] + h*randn(3,1);

s0 = rand;
t0 = rand;
w0 = rand;
p = p1*(1-s0)*(1-t0)*(1-w0) + p2*s0*(1-t0)*(1-w0) + ...
            p3*(1-s0)*t0*(1-w0)     + p4*(1-s0)*(1-t0)*w0 + ...
            p5*s0*t0*(1-w0)         + p6*s0*(1-t0)*w0 + ...
            p7*(1-s0)*t0*w0         + p8*s0*t0*w0;

ss = trilinearInverse(p, p1,p2,p3,p4,p5,p6,p7,p8);

disp(['error= ', num2str(norm(ss - [s0;t0;w0]))]) 
```

示例输出：

```
test_trilinearInverse
k= 1, residual norm= 0.38102, [s,t,w]= 0.5         0.5         0.5
k= 2, residual norm= 0.025324, [s,t,w]= 0.37896     0.59901     0.17658
k= 3, residual norm= 0.00037108, [s,t,w]= 0.40228     0.62124     0.15398
k= 4, residual norm= 9.1441e-08, [s,t,w]= 0.40218     0.62067     0.15437
k= 5, residual norm= 3.3548e-15, [s,t,w]= 0.40218     0.62067     0.15437
error= 4.8759e-15 
```

必须注意输入点的顺序，因为逆多线性插值仅在形状具有正体积时才明确定义，并且在 3D 中选择使形状从内向外翻转的点要容易得多。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-01T23:27:47.810

这是我作为社区 wiki 对 Naaff 解决方案的实现。再次感谢。

这是一个 C 实现，但应该适用于 c++。它包括一个模糊测试功能。

* * *

```
#include <stdlib.h>
#include <stdio.h>
#include <math.h>

int equals( double a, double b, double tolerance )
{
    return ( a == b ) ||
      ( ( a <= ( b + tolerance ) ) &&
        ( a >= ( b - tolerance ) ) );
}

double cross2( double x0, double y0, double x1, double y1 )
{
    return x0*y1 - y0*x1;
}

int in_range( double val, double range_min, double range_max, double tol )
{
    return ((val+tol) >= range_min) && ((val-tol) <= range_max);
}

/* Returns number of solutions found.  If there is one valid solution, it will be put in s and t */
int inverseBilerp( double x0, double y0, double x1, double y1, double x2, double y2, double x3, double y3, double x, double y, double* sout, double* tout, double* s2out, double* t2out )
{
    int t_valid, t2_valid;

    double a  = cross2( x0-x, y0-y, x0-x2, y0-y2 );
    double b1 = cross2( x0-x, y0-y, x1-x3, y1-y3 );
    double b2 = cross2( x1-x, y1-y, x0-x2, y0-y2 );
    double c  = cross2( x1-x, y1-y, x1-x3, y1-y3 );
    double b  = 0.5 * (b1 + b2);

    double s, s2, t, t2;

    double am2bpc = a-2*b+c;
    /* this is how many valid s values we have */
    int num_valid_s = 0;

    if ( equals( am2bpc, 0, 1e-10 ) )
    {
        if ( equals( a-c, 0, 1e-10 ) )
        {
            /* Looks like the input is a line */
            /* You could set s=0.5 and solve for t if you wanted to */
            return 0;
        }
        s = a / (a-c);
        if ( in_range( s, 0, 1, 1e-10 ) )
            num_valid_s = 1;
    }
    else
    {
        double sqrtbsqmac = sqrt( b*b - a*c );
        s  = ((a-b) - sqrtbsqmac) / am2bpc;
        s2 = ((a-b) + sqrtbsqmac) / am2bpc;
        num_valid_s = 0;
        if ( in_range( s, 0, 1, 1e-10 ) )
        {
            num_valid_s++;
            if ( in_range( s2, 0, 1, 1e-10 ) )
                num_valid_s++;
        }
        else
        {
            if ( in_range( s2, 0, 1, 1e-10 ) )
            {
                num_valid_s++;
                s = s2;
            }
        }
    }

    if ( num_valid_s == 0 )
        return 0;

    t_valid = 0;
    if ( num_valid_s >= 1 )
    {
        double tdenom_x = (1-s)*(x0-x2) + s*(x1-x3);
        double tdenom_y = (1-s)*(y0-y2) + s*(y1-y3);
        t_valid = 1;
        if ( equals( tdenom_x, 0, 1e-10 ) && equals( tdenom_y, 0, 1e-10 ) )
        {
            t_valid = 0;
        }
        else
        {
            /* Choose the more robust denominator */
            if ( fabs( tdenom_x ) > fabs( tdenom_y ) )
            {
                t = ( (1-s)*(x0-x) + s*(x1-x) ) / ( tdenom_x );
            }
            else
            {
                t = ( (1-s)*(y0-y) + s*(y1-y) ) / ( tdenom_y );
            }
            if ( !in_range( t, 0, 1, 1e-10 ) )
                t_valid = 0;
        }
    }

    /* Same thing for s2 and t2 */
    t2_valid = 0;
    if ( num_valid_s == 2 )
    {
        double tdenom_x = (1-s2)*(x0-x2) + s2*(x1-x3);
        double tdenom_y = (1-s2)*(y0-y2) + s2*(y1-y3);
        t2_valid = 1;
        if ( equals( tdenom_x, 0, 1e-10 ) && equals( tdenom_y, 0, 1e-10 ) )
        {
            t2_valid = 0;
        }
        else
        {
            /* Choose the more robust denominator */
            if ( fabs( tdenom_x ) > fabs( tdenom_y ) )
            {
                t2 = ( (1-s2)*(x0-x) + s2*(x1-x) ) / ( tdenom_x );
            }
            else
            {
                t2 = ( (1-s2)*(y0-y) + s2*(y1-y) ) / ( tdenom_y );
            }
            if ( !in_range( t2, 0, 1, 1e-10 ) )
                t2_valid = 0;
        }
    }

    /* Final cleanup */
    if ( t2_valid && !t_valid )
    {
        s = s2;
        t = t2;
        t_valid = t2_valid;
        t2_valid = 0;
    }

    /* Output */
    if ( t_valid )
    {
        *sout = s;
        *tout = t;
    }

    if ( t2_valid )
    {
        *s2out = s2;
        *t2out = t2;
    }

    return t_valid + t2_valid;
}

void bilerp( double x0, double y0, double x1, double y1, double x2, double y2, double x3, double y3, double s, double t, double* x, double* y )
{
    *x = t*(s*x3+(1-s)*x2) + (1-t)*(s*x1+(1-s)*x0);
    *y = t*(s*y3+(1-s)*y2) + (1-t)*(s*y1+(1-s)*y0);
}

double randrange( double range_min, double range_max )
{
    double range_width = range_max - range_min;
    double rand01 = (rand() / (double)RAND_MAX);
    return (rand01 * range_width) + range_min;
}

/* Returns number of failed trials */
int fuzzTestInvBilerp( int num_trials )
{
    int num_failed = 0;

    double x0, y0, x1, y1, x2, y2, x3, y3, x, y, s, t, s2, t2, orig_s, orig_t;
    int num_st;
    int itrial;
    for ( itrial = 0; itrial < num_trials; itrial++ )
    {
        int failed = 0;
        /* Get random positions for the corners of the quad */
        x0 = randrange( -10, 10 );
        y0 = randrange( -10, 10 );
        x1 = randrange( -10, 10 );
        y1 = randrange( -10, 10 );
        x2 = randrange( -10, 10 );
        y2 = randrange( -10, 10 );
        x3 = randrange( -10, 10 );
        y3 = randrange( -10, 10 );
        /*x0 = 0, y0 = 0, x1 = 1, y1 = 0, x2 = 0, y2 = 1, x3 = 1, y3 = 1;*/
        /* Get random s and t */
        s = randrange( 0, 1 );
        t = randrange( 0, 1 );
        orig_s = s;
        orig_t = t;
        /* bilerp to get x and y */
        bilerp( x0, y0, x1, y1, x2, y2, x3, y3, s, t, &x, &y );
        /* invert */
        num_st = inverseBilerp( x0, y0, x1, y1, x2, y2, x3, y3, x, y, &s, &t, &s2, &t2 );
        if ( num_st == 0 )
        {
            failed = 1;
        }
        else if ( num_st == 1 )
        {
            if ( !(equals( orig_s, s, 1e-5 ) && equals( orig_t, t, 1e-5 )) )
                failed = 1;
        }
        else if ( num_st == 2 )
        {
            if ( !((equals( orig_s, s , 1e-5 ) && equals( orig_t, t , 1e-5 )) ||
                   (equals( orig_s, s2, 1e-5 ) && equals( orig_t, t2, 1e-5 )) ) )
               failed = 1;
        }

        if ( failed )
        {
            num_failed++;
            printf("Failed trial %d\n", itrial);
        }
    }

    return num_failed;
}

int main( int argc, char** argv )
{
    int num_failed;
    srand( 0 );

    num_failed = fuzzTestInvBilerp( 100000000 );

    printf("%d of the tests failed\n", num_failed);
    getc(stdin);

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-01T04:01:54.260

由于您在 2D 中工作，因此您的`bilerp`函数实际上是 2 个方程，x 为 1，y 为 1。它们可以改写为以下形式：

```
x = t * s * A.x + t * B.x + s * C.x + D.x
y = t * s * A.y + t * B.y + s * C.y + D.y 
```

在哪里：

```
A = p3 - p2 - p1 + p0
B = p2 - p0
C = p1 - p0
D = p0 
```

重写第一个方程以获得`t`，`s`代入第二个方程，然后求解`s`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T21:15:38.057

如果您所拥有的只是 p 的单个值，使得 p 在正方形的四个角处的最小值和最大值之间，那么不，通常不可能找到一个单一的解决方案 (s,t)，使得双线性插值器将为您提供该值。

一般来说，正方形内会有无数个解 (s,t)。它们将沿着穿过正方形的弯曲（双曲线）路径。

如果您的函数是一个值为 1 的向量，那么您在正方形的某个未知点有两个已知值？给定正方形每个角的两个参数的已知值，则可能存在解决方案，但不能保证这一点。请记住，我们可以将其视为两个独立的问题。它们中的每一个的解决方案将位于穿过正方形的双曲线轮廓线。如果这对轮廓在正方形内交叉，则存在解决方案。如果它们不交叉，则不存在解决方案。

您还询问是否存在解决问题的简单公式。对不起，但不是我看到的。正如我所说，曲线是双曲线的。

一种解决方案是切换到不同的插值方法。因此，不是双线性，而是将正方形分成一对三角形。在每个三角形内，我们现在可以使用真正的线性插值。因此，现在我们可以求解每个三角形内 2 个未知数的 2 个方程的线性系统。每个三角形可能有一个解，除了一种罕见的退化情况，即相应的分段线性轮廓线恰好重合。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-30T22:10:54.837

有些回答稍微曲解了你的问题。IE。他们假设你得到了一个未知的插值函数的*值*，而不是你想要找到的 (s,t) 坐标的四边形内的插值位置 p(x,y)。这是一个更简单的问题，并且保证有一个解决方案是通过四边形的两条直线的交点。

其中一条线将穿过线段 p0p1 和 p2p3，另一条线将穿过 p0p2 和 p1p3，类似于轴对齐的情况。这些线由 p(x,y) 的位置唯一定义，并且显然会在该点相交。

仅考虑穿过 p0p1 和 p2p3 的线，我们可以想象这样的线族，对于我们选择的每个不同的 s 值，每条线都以不同的宽度切割四边形。如果我们固定一个 s 值，我们可以通过设置 t=0 和 t=1 找到两个端点。

所以首先假设该行具有以下形式： y = a0*x + b0

然后我们知道这条线的两个端点，如果我们固定一个给定的 s 值。他们是：

(1-s)p0 + (s)p1

(1-s)p2 + (s)p3

给定这两个端点，我们可以通过将它们代入线的方程来确定线族，并求解 a0 和 b0*作为 s 的函数*。设置 s 值会给出特定行的公式。我们现在需要的是找出这个族中的哪条线达到了我们的点 p(x,y)。只需将 p(x,y) 的坐标插入我们的直线公式，我们就可以求解 s 的目标值。

也可以采用相应的方法来找到 t。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-05-13T23:51:37.877

这是我的实现......我想它比 tfiniga 快

```
void invbilerp( float x, float y, float x00, float x01, float x10, float x11,  float y00, float y01, float y10, float y11, float [] uv ){

// substition 1 ( see. derivation )
float dx0 = x01 - x00;
float dx1 = x11 - x10;
float dy0 = y01 - y00;
float dy1 = y11 - y10;

// substitution 2 ( see. derivation )
float x00x = x00 - x;
float xd   = x10 - x00;
float dxd  = dx1 - dx0; 
float y00y = y00 - y;
float yd   = y10 - y00;
float dyd  = dy1 - dy0;

// solution of quadratic equations
float c =   x00x*yd - y00y*xd;
float b =   dx0*yd  + dyd*x00x - dy0*xd - dxd*y00y;
float a =   dx0*dyd - dy0*dxd;
float D2 = b*b - 4*a*c;
float D  = sqrt( D2 );
float u = (-b - D)/(2*a);

// backsubstitution of "u" to obtain "v"
float v;
float denom_x = xd + u*dxd;
float denom_y = yd + u*dyd;
if( abs(denom_x)>abs(denom_y) ){  v = -( x00x + u*dx0 )/denom_x;  }else{  v = -( y00y + u*dy0 )/denom_y;  }
uv[0]=u;
uv[1]=v;

/* 
// do you really need second solution ? 
u = (-b + D)/(2*a);
denom_x = xd + u*dxd;
denom_y = yd + u*dyd;
if( abs(denom_x)>abs(denom_y) ){  v = -( x00x + u*dx0 )/denom_x;  }else{  v2 = -( y00y + u*dy0 )/denom_y;  }
uv[2]=u;
uv[3]=v;
*/ 
} 
```

和推导

```
// starting from bilinear interpolation
(1-v)*(  (1-u)*x00 + u*x01 ) + v*( (1-u)*x10 + u*x11 )     - x
(1-v)*(  (1-u)*y00 + u*y01 ) + v*( (1-u)*y10 + u*y11 )     - y

substition 1:
dx0 = x01 - x00
dx1 = x11 - x10
dy0 = y01 - y00
dy1 = y11 - y10

we get:
(1-v) * ( x00 + u*dx0 )  + v * (  x10 + u*dx1  )  - x   = 0
(1-v) * ( y00 + u*dy0 )  + v * (  y10 + u*dy1  )  - y   = 0

we are trying to extract "v" out
x00 + u*dx0   + v*(  x10 - x00 + u*( dx1 - dx0 ) )  - x = 0
y00 + u*dy0   + v*(  y10 - y00 + u*( dy1 - dy0 ) )  - y = 0

substition 2:
x00x = x00 - x
xd   = x10 - x00
dxd  = dx1 - dx0 
y00y = y00 - y
yd   = y10 - y00
dyd  = dy1 - dy0 

// much nicer
x00x + u*dx0   + v*(  xd + u*dxd )  = 0
y00x + u*dy0   + v*(  yd + u*dyd )  = 0

// this equations for "v" are used for back substition
v = -( x00x + u*dx0 ) / (  xd + u*dxd  )
v = -( y00x + u*dy0 ) / (  yd + u*dyd  )

// but for now, we eliminate "v" to get one eqution for "u"  
( x00x + u*dx0 ) / (  xd + u*dxd )  =  ( y00y + u*dy0 ) / (  yd + u*dyd  )

put denominators to other side

( x00x + u*dx0 ) * (  yd + u*dyd )  =  ( y00y + u*dy0 ) * (  xd + u*dxd  )

x00x*yd + u*( dx0*yd + dyd*x00x ) + u^2* dx0*dyd = y00y*xd + u*( dy0*xd + dxd*y00y ) + u^2* dy0*dxd  

// which is quadratic equation with these coefficients 
c =   x00x*yd - y00y*xd
b =   dx0*yd  + dyd*x00x - dy0*xd - dxd*y00y
a =   dx0*dyd - dy0*dxd 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T18:56:57.003

好吧，如果 p 是一个二维点，是的，你可以很容易地得到它。在这种情况下，S 是 T 处四边形总宽度的分数分量，T 同样是 S 处四边形总高度的分数分量。

但是，如果 p 是标量，则不一定是可能的，因为双线性插值函数不一定是单片的。

# java - 如何在 Intellij 中进行结构搜索和替换

> ID：808443
> 
> 赞同：7
> 
> 时间：2009-04-30T18:39:31.647
> 
> 标签：java, intellij-idea, ide, structural-search

我正在将我的 Junit 测试从 Junit v3 迁移到 Junit v4。

我希望使用搜索并在结构上替换“srs”以在所有以 test.* 开头的方法之前添加一个 @Test 注释，使用我最喜欢的 IDE Intellij。

我只是不知道该怎么做...我可以创建一个查询，该查询将查找所有没有注释的方法（Intellij 中捆绑了一个示例），但是当用于替换时，我的类仅被该方法替换名称或没有找到。

也许正则表达式更容易:-)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T09:31:13.393

到目前为止，这是不可能的，但有人要求更换班级成员。

这是开始使用 ssr 的有用链接：[https ://www.jetbrains.com/idea/docs/ssr.pdf](https://www.jetbrains.com/idea/docs/ssr.pdf)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-07-12T13:50:46.663

我尝试使用以下 SSR，但我遇到的问题与您相同：

搜索模板：

```
public class $TestCase$ extends $TestCaseClazz$ {
  public void $testMethod$();
} 
```

替换模板：

```
@Test public void $testMethod$(); 
```

我在 testMethod 上检查“这个变量是搜索的目标”。预览看起来还可以，但 IntelliJ 实际上删除了整个方法:(

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-04T06:55:02.913

在路径中打开搜索 -> 替换
将目录设置为放置测试的目录
将搜索字符串设置为：public void test。
将替换字符串设置为：@Test\n\tpublic void test。
选中正则表达式框。

享受。

# c# - CustomValidator in a Repeater

> ID：808448
> 
> 赞同：2
> 
> 时间：2009-04-30T18:40:11.160
> 
> 标签：c#, asp.net, repeater

I have a custom validator inside a repeater

```
<asp:Repeater runat="server" ID="lstRepeater" >
    <ItemTemplate>
        <asp:CustomValidator ID="cvValid" runat="server" CssClass="error" EnableClientScript="False" ErrorMessage="Invalid."></asp:CustomValidator>
        <asp:TextBox runat="server" ID="tbCustomAnswer"></asp:TextBox>
    </ItemTemplate>
</asp:Repeater> 
```

As a test, I tried the following code on an OnClick event

```
 foreach(RepeaterItem item in lstRepeater.Items)
    {
        CustomValidator cvValid= (CustomValidator)item.FindControl("cvValid");
        cvValid.IsValid = false;
    } 
```

As would be assumed, the error message is not displayed on the page because I didn't databind the repeater. However, as soon as re-contruct the repeater and the datasource, I lose all the old values inside the repeater. Is there an easy way around this? I can't think of an elegant way of handling this problem.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T19:09:58.797

为什么不能只让 OnServerValidate 函数返回 false？

```
 <asp:CustomValidator ID="cvValid" runat="server" CssClass="error"EnableClientScript="False" ErrorMessage="Invalid."OnServerValidate="ServerValidation" /> 
```

```
void ServerValidation (object source, ServerValidateEventArgs args)
 {
    args.IsValid = false;
 } 
```

# javascript - 以前的 jQuery UI 对话框在打开新对话框后变得无响应

> ID：808454
> 
> 赞同：0
> 
> 时间：2009-04-30T18:41:18.100
> 
> 标签：javascript, jquery

我遇到了多个 jQuery 对话框的问题。第一个打开很好 - 可调整大小，可拖动等。但是，当我打开第二个时，第一个对拖动/移动/关闭没有响应，即使在第二个关闭之后也是如此。这是什么原因，如何解决？

根据 jQuery 文档，这应该可以正常工作（因为支持堆叠）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-01T23:27:31.960

似乎在这里完美地工作：

[http://jsbin.com/itira](http://jsbin.com/itira)

# apache-flex - Flex：有没有办法判断所有代码何时停止执行？

> ID：808461
> 
> 赞同：0
> 
> 时间：2009-04-30T18:42:58.470
> 
> 标签：apache-flex

每当用户执行某项操作时，一系列脚本正在执行，在一切都完成并且没有更多脚本正在运行之后，并且该应用程序本质上是“偶像”，有没有办法将其捕获为事件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T19:45:08.087

以最简单的形式，当您到达事件监听器的末尾时，您应该知道所有“动作”都已完成。

例如，如果您使用这样的单击处理程序创建按钮：

```
<mx:Button id="clickMeButton" label="Click me" click="clickMeButton_clickHandler();" /> 
```

您将拥有此事件侦听器功能：

```
private function clickMeButton_clickHandler():void
{
    // process your logic

    // process more logic

    // process even more logic

    // the event listener logic is complete here (right before the closing bracket)
} 
```

# c++ - C ++：行为类似于calloc的新调用？

> ID：808464
> 
> 赞同：40
> 
> 时间：2009-04-30T18:43:45.350
> 
> 标签：c++, new-operator, calloc

我可以打电话`new`让它像零内存一样`calloc`吗？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-04-30T18:59:31.397

与某些人在回答中所说的相反，这*是*可能的。

```
char * c = new char[N](); 
```

将零初始化所有字符（实际上，它称为值初始化。但值初始化将对其标量类型数组的所有成员进行零初始化）。如果那是你所追求的。

值得注意的是，它也适用于没有用户声明构造函数的（数组）类类型，在这种情况下，它们的任何成员都是值初始化的：

```
struct T { int a; };
T *t = new T[1]();
assert(t[0].a == 0);
delete[] t; 
```

这不是什么扩展什么的。它在 C++98 中的工作方式和行为方式也相同。就在那里，它被称为默认初始化而不是值初始化。然而，对于标量或标量或 POD 类型的数组，在这两种情况下都进行了零初始化。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-30T18:49:09.690

不，但是创建一个像 calloc 一样的新版本相当容易。它可以以与实现 new 的无抛出版本大致相同的方式完成。

一些文件.h

```
struct zeromemory_t{};
extern const zeromemory_t zeromemory;
void* __cdcel operator new(size_t cbSize, const zeromemory_t&); 
```

一些文件.cpp

```
const zeromemory_t zeromemory;

void* _cdecl operator new(size_t cbSize, const zeromemory_t&)
{
    void *mem = ::operator new(cbSize);
    memset(mem,0,cbSize);
    return mem;
} 
```

现在您可以执行以下操作以获取新的零内存

```
MyType* pMyType = new (zeromemory) MyType(); 
```

此外，您还需要做其他有趣的事情，例如定义 new[]，这也是相当简单的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-30T18:46:51.550

不，也不要考虑做类似的事情：

```
YourClass *var = new YourClass;
memset(var, 0, sizeof(YourClass)); 
```

您最终可能会破坏您的 VTABLE（如果您的班级有一个）。

我建议使用构造函数来清除类的内部存储器（变量）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T18:44:52.930

没有。它总是默认初始化分配的项目，在原语的情况下什么都不做。您必须通过 std::uninitialized_fill_n 调用或类似方法来跟进它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-30T18:50:00.030

您可以对运算符进行全局重载，`new`并让它从`calloc()`. 这样，在构造函数运行之前内存就会被擦除，所以那里没有问题。

任何自己覆盖 new 的类都不会获得您的 special `calloc()`-based `new`，但是该类无论如何都应该正确初始化自己。

不要忘记覆盖`new`and`delete`和数组版本......

就像是：

```
#include <exception> // for std::bad_alloc
#include <new>
#include <stdlib.h> // for calloc() and free()

void* operator new (size_t size)
{
 void *p=calloc(size, 1); 
 if (p==0) // did allocation succeed?
  throw std::bad_alloc(); 
 return p;
}

void operator delete (void *p)
{
 free(p); 
}

void* operator new[] (size_t size)
{
 void *p=calloc(size, 1); 
 if (p==0) // did allocation succeed?
  throw std::bad_alloc();
 return p;
}

void operator delete[] (void *p)
{
 free(p); 
} 
```

请注意，这些简单的版本并不完全是它们应该的样子——`new`操作员应该在一个循环中运行，调用`new_handler`（如果安装了），并且只有在`bad_alloc`没有`new_handler`. 或者类似的东西，我将不得不查找它并稍后更新。

哦，您可能还想覆盖该`no_throw`版本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-13T15:03:23.917

我使用宏：

```
#define newclear(TYPE) new(calloc(sizeof(TYPE), 1)) TYPE(); 
```

使用它：

```
Whatever* myWhatever = newclear(Whatever); 
```

（这里像其他一些解决方案一样使用“新位置”）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T18:46:06.497

不可以。您必须手动将内存归零。请记住，`new`不仅仅是分配内存，还包括通过构造函数进行初始化。这`calloc`在 C 语言中很方便（它没有初始化函数）。您可以自由地在`new`甚至使用上编写包装器`calloc`，但大多数时候对于非 POD 对象，这没有多大意义。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T18:50:08.500

如果你不坚持使用`new`，你可以简单地使用 vector:`vector<char> buffer; buffer.resize(newsize);`并且内容将被归零。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-30T18:51:39.120

是的。

```
int* p_scalar = new int(5);//Does not create 5 elements, but initializes to 5 
```

对于数组，您可以使用 memset 之类的东西。对于 Windows，请使用 ZeroMemory 或 SecureZeroMemory。

**编辑：**请参阅@litb 的帖子，他展示了如何使用上述非直接初始化将数组初始化为 0。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-30T18:52:01.663

```
class MyClass {
    public:
    void* operator new(size_t bytes) {
        return calloc(bytes, 1);
    }
} 
```

如果您愿意，您可以覆盖全局 new 运算符。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-30T18:54:43.903

你可以说：

```
vector <char> v( 100, 0 ); 
```

它使用 new 创建一个包含 100 个字符的连续数组，并将它们全部初始化为零。然后，您可以使用向量的 [] 运算符访问数组，或者执行以下操作：

```
char * p = &v[0];
p[3] = 42; 
```

请注意，这也使您不必调用 delete 来释放分配的内存。

# c# - 我可以在 GridView 中合并页脚吗？

> ID：808468
> 
> 赞同：4
> 
> 时间：2009-04-30T18:45:37.030
> 
> 标签：c#, .net, asp.net, html

我有一个与数据集绑定的 GridView。我有我的页脚，它由列线分隔。我想合并 2 列；我怎么做？

```
<asp:TemplateField HeaderText="Name" SortExpression="Name">
<ItemTemplate>
...  
</ItemTemplate>
<FooterTemplate >                    
Grand Total:
</div>
</FooterTemplate>
</asp:TemplateField>
<asp:TemplateField HeaderText="Age" SortExpression="Age">
<ItemTemplate>
...  
</ItemTemplate>
<FooterTemplate >                    
<%# GetTotal() %> 
</div>
</FooterTemplate>
</asp:TemplateField> 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2014-12-02T09:28:42.773

```
protected void GridView1_OnRowDataBound(object sender, System.Web.UI.WebControls.GridViewRowEventArgs e)
    {

        if (e.Row.RowType == DataControlRowType.Footer)
        {
           e.Row.Cells.RemoveAt(1);
           e.Row.Cells[0].ColumnSpan = 2;

        }

    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T19:08:00.470

未经测试的代码

第一个页脚模板应包含 <%# GetTotal() %>

第二个页脚模板应该为空

```
 Protected Sub Page_SaveStateComplete(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.SaveStateComplete
        Dim DG As GridView = GridView1
            Dim Tbl As Table = DG.Controls(0)
            Dim tr As GridViewRow
            Dim i As Integer
            Dim j As Integer

tr = Tbl.Rows(Tbl.Rows.Count - 1) 'this line assume last row is footer row

                    tr.Cells(0).ColumnSpan = 2 'if you have 3 columns then colspan = 3 instead

                    For j = 1 To 1 'if you have 3 columns then j = 1 To 2 instead
                        tr.Cells(j).Visible = False
                    Next

    End Sub 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-05T16:27:08.317

我正在做这样的事情 - 试图在页脚跨多个列中有一个按钮。

当我通过代码设置列跨度时遇到了问题，因为 a）我是菜鸟，b）它*没有*达到我的预期。我不记得所有的细节，但那里有某种陷阱——比如添加额外的列或其他东西。

这是我的解决方案。也许其中一些会很有用。我在gridview（gvDocs）的预渲染中做了。

它对我来说正常工作的原因是以编程方式删除页脚的单元格以及设置列跨度。

即使代码没有帮助，也许人们会对折磨我的健忘症感到好笑。它有时让我发笑。

```
 Protected Sub gvDocs_PreRender(ByVal sender As Object, ByVal e As System.EventArgs) Handles gvDocs.PreRender

        If gvDocs.Rows.Count > 0 Then

            Dim m As Integer = gvDocs.FooterRow.Cells.Count
            For i As Integer = m - 1 To 1 Step -1
                If i <> 8 Then '7 is the number of the column with the applychanges button in it.
                    gvDocs.FooterRow.Cells.RemoveAt(i)
                End If
            Next i
            gvDocs.FooterRow.Cells(1).ColumnSpan = 6 '6 is the number of visible columns to span.
        End If
    End Sub 
```

Fernando68 - 在 C# 中

```
protected void gvDocs_PreRender(object sender, System.EventArgs e)
{

    if (gvDocs.Rows.Count > 0) {

        int m = gvDocs.FooterRow.Cells.Count;
        for (int i = m - 1; i >= 1; i += -1) {
            //7 is the number of the column with the applychanges button in it.
            if (i != 8) {
                gvDocs.FooterRow.Cells.RemoveAt(i);
            }
        }
        gvDocs.FooterRow.Cells[1].ColumnSpan = 6;
        //6 is the number of visible columns to span.
    }
}

//=======================================================
//Service provided by Telerik (www.telerik.com)
//Conversion powered by NRefactory.
//Twitter: @telerik
//Facebook: facebook.com/telerik
//======================================================= 
```

已编辑 - 需要使用方括号按页脚行中的索引访问单元格

# sql - 如何在 MySQL 的左连接中获取关联行的计数？

> ID：808475
> 
> 赞同：21
> 
> 时间：2009-04-30T18:47:15.107
> 
> 标签：sql, mysql, select, join, subquery

我有两张表，一张`vehicle`有列的表：

*   `id`
*   `stock`
*   `year`
*   `make`
*   `model`

和一个`images`有列的表：

*   `id`
*   `vehicle_id`
*   `name`
*   `caption`
*   `default tinyint(1)`

我正在尝试列出车辆的信息、其默认图像以及车辆拥有的图像总数。目前我正在使用以下`SELECT`语句：

```
SELECT vehicle.id, vehicle.stock, vehicle.year,
    vehicle.make, vehicle.model, images.name,
    COUNT(images.id)
FROM vehicle
LEFT JOIN images
ON vehicle.id = images.vehicle_id 
```

我最初使用的是：

```
ON vehicle.id = images.vehicle_id AND images.default = 1 
```

但随后图像计数将仅为 1 或 0，具体取决于数据库中是否存在默认图像。我已经尝试过 using`UNION`和其他`SELECT`语句，但我仍然无法得到正确的结果。我需要使用两个`SELECT`语句还是有另一种方法来处理它`JOIN`？`UNION`

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-04-30T18:50:29.297

```
SELECT 
    `vehicle`.`id`, 
    `vehicle`.`stock`, 
    `vehicle`.`year`, 
    `vehicle`.`make`, 
    `vehicle`.`model`, 
    `images`.`name`,
    (
        SELECT COUNT(*) 
        FROM `images` 
        WHERE `vehicle_id` = `vehicle`.`id`
    ) AS `image_count`
FROM `vehicle`
LEFT JOIN `images`
ON `images`.`vehicle_id` = `vehicle`.`id`
WHERE `images`.`default` 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-10-08T09:52:50.307

以分析器建议的方式，您会得到“车辆”的重复值。更好的方法是将结果分组。尝试不使用 JOIN ：

```
SELECT 
    `vehicle`.`id`, 
    `vehicle`.`stock`, 
    `vehicle`.`year`, 
    `vehicle`.`make`, 
    `vehicle`.`model`, 
    `images`.`name`,
    (
        SELECT COUNT(*) 
        FROM `images` 
        WHERE `vehicle_id` = `vehicle`.`id`
    ) AS `image_count`
FROM `vehicle`

WHERE `images`.`default` 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2017-08-13T17:01:34.323

# 让我为大家说清楚！

**任务**：打印 3 列表格：

1.  **车辆**表中的车辆（标题）。
2.  **评论**表中每辆车的评论数量。
3.  **图像**表中每辆车的图像数量。

**预期输出（只是一个例子）**：

```
+----------------------+----------------+--------------+
|        title         | comments_count | images_count |
+----------------------+----------------+--------------+
| BMW X6               |             35 |            9 |
| Audi A6              |              3 |            5 |
| Volkswagen Passat B6 |             78 |            6 |
| Volkswagen Passat B5 |            129 |            4 |
+----------------------+----------------+--------------+ 
```

**解决方案**：

```
SELECT 
    vehicles.title,
    (SELECT COUNT(*) FROM comments WHERE vehicles.id = comments.vehicle_id) AS comments_count,
    (SELECT COUNT(*) FROM images WHERE vehicles.id = images.vehicle_id) AS images_count
FROM vehicles 
```

# google-app-engine - 是否有一种简单的方法可以更改 google app engine datstore 中记录的父级

> ID：808476
> 
> 赞同：8
> 
> 时间：2009-04-30T18:48:08.660
> 
> 标签：google-app-engine, google-cloud-datastore

给定

```
类类别（db.Model）：
   名称 = db.Stringproperty()

```

假设我有一个嵌套层次结构

```
-根
 |-a
 | |-b
 | |-c
 |-x
   |-y
     |-z1
     |-z2

```

其中`a`的父母是`root`,`b`的父母是`a`,`c`的父母是`b`等等。

有没有一种简单的方法可以让我将节点`y`从那里移动`x`到`b`这样的地方`z1`并`z2`继续保持孩子的身份`y`：

```
-根
 |-a
 | |-b
 | |-c
 | |-y
 | |-z1
 | |-z2
 |-x

```

这将意味着我只是改变`y`' 的父母。

但是，如果这不可能，则需要

1.  创造新纪录`ny = Category(parent=b, name=y)`并
2.  递归地为每个孩子`y`创建一个新记录，该记录具有`ny`作为父母和
3.  而不是删除`y`及其子项。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-01T09:36:15.860

父关系编码在实体的密钥中，并且密钥一旦创建就不可变，所以不，您不能更改现有实体的密钥。为此，您需要使用新密钥重新插入所有相关项目。

# domain-driven-design - 在领域驱动设计 (DDD) 中建模查找表的实用方法是什么？

> ID：808481
> 
> 赞同：49
> 
> 时间：2009-04-30T18:49:19.703
> 
> 标签：domain-driven-design, lookup

我刚刚学习 DDD（Eric Evans 的书在我面前打开），我遇到了一个我找不到答案的问题。当您只是想获得一个简单的查找记录列表时，您在 DDD 中会做什么？

前任。

员工 ID：123
员工姓名：John Doe
州：阿拉斯加（下拉）
县：瓦西拉（下拉 - 将根据州过滤）。

例如，假设您有一个 Employee 域对象、一个 IEmployeeRepository 接口和一个 EmployeeRepository 类。UI 将使用它来显示员工列表和个人详细信息。在 UI 中，您希望为员工居住的州和县使用下拉菜单。可用县将根据选择的州进行过滤。

不幸的是，数据库表和 UI 看起来非常不同。在 tblEmployees 中，它包含州代码=AK 和县代码=02130，而不是州和县名称。

旧方法（在我开始这个 DDD 任务之前）非常简单，只需创建 2 个查询并使用 DataReader 填充下拉列表。下拉菜单中显示的下方是值，该值会自动用于表单帖子。

但是，对于 DDD，我不确定您应该如何执行此操作。我首先创建了州和县对象以及存储库和存储库接口。但是，编写 4 个类 + 2 个接口和 hbm.xml 文件中的管道 + Employee 业务对象对于 2 个下拉列表的 2 个查询似乎有点过头了。必须有更好的方法，不是吗？我不会很快更改州或县表中的记录，即使我这样做了，也不会通过此应用程序进行。因此，如果没有必要，我真的不想为州和县创建业务对象。

我看到的最简单的解决方案是只使用返回字典的方法创建一个帮助类，例如 GetStatesAll()、GetState() 和 GetCounties() 和 GetCounty()，但从 DDD 的角度来看这感觉不对。

请帮忙。如何在不过度设计几个简单查找的情况下使用 DDD？

**最终解决方案** 我想我终于通过经验找到了答案，就是将 GetStates() 方法放入它自己的 Data Access 类中，尽管不是存储库类。由于我只进行只读访问，因此我将其放入结构 DTO 中。由于数据库很小，我将它们完全放在一个类中，就像下面描述的 Todd。

我的结论：

1.  查找表永远不是值对象，因为查找表总是有一个标识。如果他们没有身份，你就会有重复，这没有多大意义。
2.  只读查找表可以有一个存储库，但可能不需要一个。存储库的目标是通过强制仅通过聚合访问来降低复杂性。通过汇总为您提供了一种确保可以强制执行业务规则的方法，例如如果您没有汽车则不添加轮胎。
3.  如果您允许对查找表进行 CRUD 维护，那么查找表拥有自己的存储库是有意义的。
4.  我最终将代码存储为结构这一事实并没有使它们成为“值类型”。Fowler 在 POEAA 中说结构是一种值类型。没错，结构是不可变的，这就是 Fowler 说它们是“值类型”的原因，但我使用它们的方式不同。我使用结构作为一种轻量级的方式来传递我从未计划在初始创建后更改的 DTO。事实上，我使用的结构确实具有标识，但由于它们是只读的，它们作为结构工作。
5.  我一直在使用的一种我在其他地方看不到的模式是使主键字段不可变。它们由构造函数设置，但它们是只读的（不是私有访问器），一旦创建对象就不能更改。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-30T21:20:57.670

您可能想研究[Command Query Separation](http://devlicio.us/blogs/casey/archive/2009/02/12/ddd-command-query-separation-as-an-architectural-concept.aspx)的概念。我不会担心查找值的类型化存储库，但我仍然可能会在数据集等上使用 DTO 类型类......

您可能想花一些时间阅读 Greg Young 从[这篇](http://codebetter.com/blogs/gregyoung/archive/2009/01/13/dddd-master-detail-question.aspx)文章到现在的博客。他没有专门谈论填充查找数据，但他经常谈论不通过存储库上的类型化方法处理应用程序的读取/报告功能。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-30T21:12:41.573

使用 DDD 我有以下类似的东西：

```
interface IAddressService
{
  IList<Country> GetCountries ();
  IList<State> GetStatesByCountry (string country);
  IList<City> GetCitiesByState (string state);
  // snip
} 
```

Country、State 和 City 是来自数据库中查找表的值对象。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-02-26T12:47:16.777

好吧，我前段时间读了一篇[Mathias Verraes的文章，](http://verraes.net/)[在这里](http://verraes.net/2013/11/value-objects-and-user-interfaces/)谈到了这一点。他谈到了将模型中的值对象与服务于 UI 的概念分离。

当被问及是否将国家建模为实体或价值对象时，引用文章：

> 将国家建模为实体并将它们存储在数据库中并没有本质上的错误。但在大多数情况下，这过于复杂了。国家不会经常变化。当一个国家的名字改变时，实际上，从所有实际目的来看，它都是一个新的国家。如果有一天某个国家不再存在，您不能简单地更改所有地址，因为该国家可能被分成两个国家。

他提出了一种不同的方法来引入一个名为的新概念`AvailableCountry`：

> 这些可用的国家/地区可以是数据库中的实体、JSON 中的记录，甚至只是代码中的硬编码列表。（这取决于企业是否希望通过 UI 轻松访问它们。）

```
<?php

final class Country
{
    private $countryCode;

    public function __construct($countryCode)
    {
        $this->countryCode = $countryCode;
    }

    public function __toString()
    {
        return $this->countryCode;
    }
}

final class AvailableCountry
{
    private $country;
    private $name;

    public function __construct(Country $country, $name)
    {
        $this->country = $country;
        $this->name = $name;
    }

    /** @return Country */
    public function getCountry()
    {
        return $this->country;
    }

    public function getName()
    {
        return $this->name;
    }

}

final class AvailableCountryRepository
{
    /** @return AvailableCountry[] */
    public function findAll()
    {
        return [
            'BE' => new AvailableCountry(new Country('BE'), 'Belgium'),
            'FR' => new AvailableCountry(new Country('FR'), 'France'),
            //...
        ];
    }

    /** @return AvailableCountry */
    public function findByCountry(Country $country)
    {
        return $this->findAll()[(string) $country];
    }
} 
```

所以似乎有第三种解决方案是将查找表建模为值对象和实体。

顺便说一句，请确保您查看评论部分以了解有关该文章的[一些严肃讨论。](http://verraes.net/2013/11/value-objects-and-user-interfaces/#comment-1174666856)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T20:14:42.667

州和县不是实体，而是价值对象。它们不是您系统的主题。你说你以前处理这些的方式是可以的。根据域模型状态的变化，您何时会更改数据库中的州或县记录？不，所以这些不需要存储库。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-30T20:16:18.013

如果你想学习如何做 DDD 而又不使其过于复杂，那你就读错了书。:-)

您提出的最简单的解决方案可以满足您的需求。将地址数据封装在业务对象中可以根据您的应用程序需求简单或复杂。例如，State 对象与 County 具有一对多的关系，因此如果您选择以这种方式建模，那么 Employee 真的只需要引用一个 County。如果需要，我只会介绍这种复杂性。

此外，我认为为存储库定义接口不会有什么好处，除非确实有可能为您的对象拥有多个存储库。

# database - 将图像存储在数据库中并使用 nhibernate 映射它们

> ID：808484
> 
> 赞同：1
> 
> 时间：2009-04-30T18:50:06.253
> 
> 标签：database, nhibernate

如何将图像存储在数据库中并使用 nhibernate 映射它们

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T19:48:13.650

您可以使用二进制类型映射二进制数据，该类型相当于代码中的 byte[] 数组和数据库中的 varbinary。如果您加载许多包含二进制数据或大型对象的对象，这可能会导致性能问题，因为这些对象将保存在一级缓存的内存中。[本文](http://blog.calyptus.eu/seb/2009/03/large-object-storage-for-nhibernate-and-ddd-part-1-blobs-clobs-and-xlobs/)讨论了在这种情况下提高性能的技术。

# java - How to set a connection timeout when using JAXRPC-RI web services client?

> ID：808487
> 
> 赞同：8
> 
> 时间：2009-04-30T18:50:32.493
> 
> 标签：java, web-services, jakarta-ee, soap, jax-rpc

I'm working with a bit of a legacy component in which we interact with a SOAP web service (a technology which I absolutely, positively abhor) using some client code built using the JAXRPC-RI (reference implementation) library.

I'm interested in being able to set a timeout with the stubs so that in case the web services server does not reply within X seconds, the application isn't setting there forever waiting for a response.

I'm using to working with clients/stubs generated by Apache Axis, in which you can simply use `org.apache.axis.client.Stub.setTimeout()` to set a timeout.

For the life of me I can't figure out how to set a timeout when using Stubs created with JAXRPC-RI:

*   The port class I am instantiating extends `com.sun.xml.rpc.client.StubBase` and implements `javax.xml.rpc.Stub` and `com.sun.xml.rpc.spi.runtime.StubBase`.
*   The JavaDocs for none of these classes mention any sort of timeout or method to do this.
*   Trying code like `stub._setProperty("axis.connection.timeout", 1000);` results in an exception at runtime: `javax.xml.rpc.JAXRPCException: Stub does not recognize property: axis.connection.timeout`

Does anyone have any ideas on how to set/enforce a timeout when using a JAXRPC-RI client? Is it even possible?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-07T15:45:49.120

您可能有运气设置属性，例如`sun.net.client.defaultConnectTimeout`or `sun.net.client.defaultReadTimeout`，尽管这会引入系统范围的超时。

在代码中，属性值是使用字符串设置的：

```
System.setProperty("sun.net.client.defaultConnectTimeout", "1000");
System.setProperty("sun.net.client.defaultReadTimeout", "1000"); 
```

`JAVA_OPTS`对于快速测试，设置环境变量或使用命令行可能更容易：

```
java -Dsun.net.client.defaultConnectTimeout="1000" ... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-04T17:08:50.537

我不确定为什么这个特定的 JAXRPC 实现会特意使设置超时变得困难。也许，这是有充分理由的。其他实现，如 Axis 和我相信 JAX-WS，让您简单地调用 Stub 上的 setTimeout() 方法。经过一番痛苦，我想出了这个解决方案。希望这会有所帮助。您需要执行以下操作才能在基础 URLConnection 上设置超时：

1.  创建一个新的 ClientTransport 类。它应该扩展 com.sun.xml.rpc.client.http.HttpClientTransport 类。覆盖 createHttpConnection(String, SOAPMessageContext) 方法。调用 super.createHttpConnection() 将返回 HttpURLConnection 对象。在 HttpURLConnection 对象上，您可以调用 setReadTimeout() ，这将在 X 毫秒内强制客户端超时。完成后，返回修改后的 HttpURLConnection 对象。
2.  用您自己的扩展客户端 Stub 类。覆盖 _getTransport() 方法以返回您在步骤 (1) 中创建的 ClientTransport 类的新实例。
3.  用您自己的扩展客户端 _Impl 类。覆盖 get...Port() 方法，以便它使用您在步骤 (2) 中创建的存根，而不是生成的存根。
4.  修改您编写的调用 Web 服务的客户端代码，使其使用您在步骤 (2) 中创建的 Stub 和您在步骤 (3) 中创建的 _Impl。

注意：确保通过 wscompile（Ant 脚本？）调用生成存根的任何内容都不会覆盖您刚刚创建/修改的 3 个 Java 类。将它们移动到不同的包可能是有意义的，这样它们最终不会被覆盖。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-25T12:03:13.610

Yevgeniy Treyvus 的回答非常好，但会导致为每个 SOAP 调用创建一个新的 HTTPUrlConnection。我在测试他的方法时发现，可以设置一个 ClientTransportFactory。我现在使用 CustomClientTransportFactory 并将其设置在 Stub 上（将其转换为 StubBase ）。那么就不需要第2步和第3步了。

然后在第 4 步中设置他的新 ClientTransportFactory，如下所示： ((StubBase) myPort)._setTransportFactory(new CustomClientTransportFactory());

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-31T09:20:17.440

我知道您正在使用 Axis，但我很难为 Weblogic 找到相同的答案，并且由于您的问题标题和标签是通用的，这是我的解决方案。

在实现生成的 MyObject 接口的客户端类中，我已按如下方式调整了 getServicePort()（请注意，我这里也有安全性）。

```
protected MyObject getServicePort() throws java.rmi.RemoteException {
    if (port == null) {
        synchronized(this) {
            if (port == null) {
                try {
                    final MyObject_Impl service = new MyObject_Impl(wsdlURL);

                    // using a local variable until the object is completelly initialized
                    final MyObject localPort = service.getMyObjectPort();

                    // if username and password are provided: building a client which will include the 
                    // username and token
                    if (username != null && pwd != null) {
                        Stub localStub = ((Stub) localPort);

                        // We have UsernameToken Authentication too
                        localStub._setProperty(
                                WSSecurityContext.CREDENTIAL_PROVIDER_LIST, 
                                Collections.singletonList(
                                        new ClientUNTCredentialProvider(username.getBytes(), pwd.getBytes())));

                        if (timeout != null) {
                               log.debug("Setting timeout to " + timeout + " milliseconds");
                            localStub._setProperty("weblogic.wsee.transport.read.timeout", timeout);
                            localStub._setProperty("weblogic.wsee.transport.connection.timeout", timeout);
                        }
                    }

                    port = localPort;

                } catch (ServiceException e) {
                    throw new RemoteException("Could not initialize client to MyObject service", e);
                }
            }
        }
    }
    return port;
} 
```

Oracle 文档在这里：[http](http://docs.oracle.com/cd/E12840_01/wls/docs103/webserv_rpc/client.html#wp241849) ://docs.oracle.com/cd/E12840_01/wls/docs103/webserv_rpc/client.html#wp241849但它错误地指出超时以秒为单位。它实际上以毫秒为单位！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-07T16:49:48.630

射线，

感谢您的输入。听起来您的方法更优越，因为它将避免几个无关的步骤。我得看看。但是，除非我遗漏了什么，否则我不相信正在创建额外的 HttpConnection，因为 YourClientTransport.createHttpConnection(String s, SOAPMessageContext ctx) 应该覆盖 HttpClientTransport 之一：

```
public class YourClientTransport extends HttpClientTransport {
   @Override
   protected HttpUrlConnection createHttpConnection(String s, SOAPMessageContext ctx) throws IOException {
      HttpURLConnection httpURLConnection = super.createHttpConnection(s, ctx);
      httpURLConnection.setReadTimeout(1000);
      httpURLConnection.setConnectTimeout(1000);
      return httpURLConnection;
   }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-02T15:10:16.943

我只是要尝试获得赏金，所以如果我完全走错了路，请不要开枪:) 如果您的应用程序“永远设置在那里等待响应”，那么您可以单独执行请求线程，在产生你的之后，`requestThread`你可以说`requestThread.join(max_time_to_wait);`下一个调用会检查 requestThread 是否还活着，如果它那么尝试杀死它。

您的应用程序将在超时后继续运行，这不是最不雅的解决方案......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-09-22T10:22:01.070

这个问题可能有点晚了，但我今天遇到了这个问题。基于 Yevgeniy Treyvus 提出的解决方案（谢谢！）我想出了以下内容：

```
((com.sun.xml.rpc.client.StubBase)myRemoteStub)._setTransportFactory(new ClientTransportFactory() {
    @Override
    public ClientTransport create() {
        return new HttpClientTransport() {
            @Override
            protected HttpURLConnection createHttpConnection(String endpoint, SOAPMessageContext context) throws IOException {
                HttpURLConnection conn = super.createHttpConnection(endpoint, context);
                conn.setConnectTimeout(2000);
                conn.setReadTimeout(2000);
                return conn;
            }
        };
    }
}); 
```

它与 Yevgeniy 提出的基本相同，但覆盖性稍差（在连接工厂的帮助下）。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-08-26T13:59:55.070

你应该使用：

```
import javax.xml.rpc.Stub;

...

int timeout = <number of milliseconds>;

((Stub) port)._setProperty(
                "axis.connection.timeout",
                timeout); 
```

# iphone - JSON - iPhone SDK 上的框架错误

> ID：808489
> 
> 赞同：2
> 
> 时间：2009-04-30T18:50:51.323
> 
> 标签：iphone, xcode, json, frameworks

当我运行任何安装了[JSON-Framework](http://code.google.com/p/json-framework/)的项目时出现错误：

Xcode 找不到源文件：NSString+SBJSON.m（行：50）

我认为这意味着它找不到 sdk，奇怪的是项目构建并运行，直到我进行第一次 JSON 调用：

```
NSArray *data = [responseString JSONValue]; 
```

JSON 文件夹位于：~/Library/SDKs

我添加了额外的 sdks 参数：$HOME/Library/SDKs/JSON/$(PLATFORM_NAME).sdk

我还添加了链接器标志：-ObjC -ljson

为了确保我没有发疯，我在[这里](http://iphone.zcentric.com/2008/08/05/first-json-iphone-application/)运行了一个教程。本教程也出现同样的错误。（我也从移动果园跑了一个，结果相似，除了文件：SBJSON.m）

我一定是设置错了，有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-09T22:25:17.570

如上面评论中所说，我只是直接添加了源代码。不是理想的解决方案，但它有效。

我相信安装会变得更好......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-31T22:22:51.713

您可能希望获取有关文件的信息并确保路径类型设置为“相对于项目”。这解决了我的问题。

# java - Swing: How to create Events and dispatch them to a component?

> ID：808491
> 
> 赞同：7
> 
> 时间：2009-04-30T18:51:10.743
> 
> 标签：java, swing, events

I need to send some events to a component in Swing, so it is handled just like any user generated, standard Swing events.

Basically, something like a macro recorder, and then executor for JEditorPane. But I need more control over the generated events.

SO, assume I have an editor, I want to:

1.  capture all events sent to it, and at that point, i can store them in list, on disk, or whatver..
2.  Be able to later play those events
3.  Ideal situation, is to allow user to edit a commands which contains things like:
    "type key A, select line, delete-selection, cursor-up, line-start..."

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T19:41:56.940

显而易见的事情是获取`EventQueue`并发布事件。这只会将事件添加到队列中，该队列将在 EDT 上轮流调度。

```
java.awt.Toolkit.getDefaultToolkit().getSystemEventQueue().postEvent(event); 
```

昨天有人声称 Opera 和 Safari 做自己的事情，并且没有对不受信任的代码提供所需的权限。

一个直接的方法是调用`Component.dispatchEvent`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T18:57:20.950

如果您正在寻找标准的 GUI 事件，那么您需要[java.awt.Robot](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/Robot.html)

如果您希望定义自己的事件，您将不得不对需要接收这些事件的 GUI 类进行子类化（或者更好的是，为它们创建一个外部控制器），定义一个事件类，并分派事件。您可以使用[java.beans.EventHandler](http://java.sun.com/j2se/1.5.0/docs/api/java/beans/EventHandler.html)进行调度，创建自己的处理程序类（我发现在某些情况下更有用），或将您的事件（取决于它们如何继承）注入系统事件队列（找不到类来做到这一点......我认为它是工具包）。

但是，我不会做这些。您所描述的（宏记录器）应该使用一个控制器来实现，该控制器生成/接收一系列特定于应用程序的操作消息（查看命令模式）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T18:59:36.997

我相信你必须构造一个事件的实例，然后调用

```
java.awt.EventQueue.dispatchEvent(event) 
```

将事件源设置为所需的组件。

# search-engine - 我的面向公众的网站是否绝对需要 robots.txt 文件？

> ID：808492
> 
> 赞同：0
> 
> 时间：2009-04-30T18:51:18.640
> 
> 标签：search-engine

我正在审查我的几个网站，以确保我的 SEO 基础被覆盖。有问题的网站上没有私人页面，我们希望所有页面都被索引。是否包含 robots.txt 文件（即使不需要）也会让我的网站看起来更有信誉和对 Google 来说更重要？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-30T18:55:38.970

不管怎样，我只会包含一个空白，因为没有它，您的服务器仍在向请求者发送 404 消息。这可能比空白的 robots.txt 文件大。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T18:56:27.050

根据[Google](http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=40360)，这是个好主意。他们的说明/指南实际上非常详尽。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T18:55:33.277

只有谷歌可以为你回答。

根据[维基百科](http://en.wikipedia.org/wiki/Robots_exclusion_standard)，robots.txt 仅用于黑名单、速率限制和站点地图。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-04-29T10:43:35.043

这个问题已经回答了，但是答案都有点老了，而且这个问题在搜索结果中不断出现，事情已经发生了变化。

[Google 现在推荐](https://support.google.com/webmasters/answer/156449?rd=1)以下内容：

> 如果您希望搜索引擎为您网站中的所有内容编制索引，则不需要 robots.txt 文件（甚至不需要一个空文件）。

JohnMu（来自 Google）也提出[以下建议](https://productforums.google.com/d/msg/webmasters/DOKE2Mhpivk/AfiOw6-zH7YJ)：

> 我建议更进一步，也许完全删除 robots.txt 文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T18:55:00.703

不，它不会。

google有自己的规则来决定，不会依赖robots.txt的存在。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T18:58:14.300

搜索引擎将寻找 robots.txt 文件。如果它不存在，搜索引擎将得到一个 404。最好有一个，即使它是空白的。

# sqlite - SQLite 数据库文件使用什么扩展名是否重要？

> ID：808499
> 
> 赞同：227
> 
> 时间：2009-04-30T18:54:15.993
> 
> 标签：sqlite

用于 SQLite 数据库的文件扩展名有优点还是缺点？

SQLite 本身似乎不需要命名约定，但可能有其他原因导致特定扩展有用或有问题 - 例如，某些工具、编程语言、安装程序等。或最终用户考虑因素。

最常见的似乎是`.sqlite`、`.db`和`.db3`。

* * *

## 回答 #1

> 赞同：211
> 
> 时间：2009-04-30T18:58:07.467

很大程度上取决于个人选择。根据您存储的数据库方案使用扩展可能是有意义的；将您的数据库模式视为一种文件格式，而 SQLite 只是用于该文件格式的编码。因此，`.bookmarks`如果它正在存储书签，或者`.index`它被用作索引，您可能会使用它。

如果您想使用通用扩展，我会使用`.sqlite3`它，因为它最能描述使用数据库所需的 SQLite 版本。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-04-30T19:02:41.577

在可分发软件中，我不希望我的客户自己在数据库中捣乱。程序自行读取和写入。用户接触 DB 文件的唯一原因是获取备份副本。因此我将其命名为whatever_records.db

简单的 .db 扩展名告诉用户它是一个二进制数据文件，这就是他们必须知道的全部内容。调用它 .sqlite 邀请感兴趣的用户打开它并搞砸一些事情！

我想完全取决于你的使用场景。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-04-30T18:59:05.920

SQLite 没有为此定义任何特定的扩展，这是您自己的选择。就个人而言，我用`.sqlite`扩展名来命名它们，这样当我以后查看我的文件时就不会有任何歧义。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2017-11-03T13:23:53.030

如果您已经确定了一组特定的工具来访问/修改您的数据库，我会选择他们希望您使用的任何扩展。这将在执行开发任务时避免不必要的摩擦。

例如，[SQLiteStudio](https://sqlitestudio.pl/index.rvt) v3.1.1 默认查找具有以下扩展名的文件：

[![在此处输入图像描述](https://i.stack.imgur.com/Wmnt6.png)](https://i.stack.imgur.com/Wmnt6.png)

( `db|sdb|sqlite|db3|s3db|sqlite3|sl3|db2|s2db|sqlite2|sl2`)

如果需要部署，如果隐藏文件类型对您有用（正如其他一些答案所建议的那样），您的安装机制可以重命名文件。开发和部署的文件名要求可能不同。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2015-11-05T23:40:49.837

Emacs 在 sql-sqlite 模式的默认配置中需要 db、sqlite、sqlite2 或 sqlite3 之一。

# ios - UIButton: Making the hit area larger than the default hit area

> ID：808503
> 
> 赞同：193
> 
> 时间：2009-04-30T18:54:52.157
> 
> 标签：ios, cocoa-touch, uibutton, uikit

I have a question dealing with UIButton and its hit area. I am using the Info Dark button in interface builder, but I am finding that the hit area is not large enough for some people's fingers.

**Is there a way to increase the hit area of a button either programmatically or in Interface Builder without changing the size of the InfoButton graphic?**

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2012-10-25T11:08:58.353

由于我使用的是背景图像，因此这些解决方案都不适合我。这是一个解决方案，它做了一些有趣的 Objective-c 魔法，并提供了一个使用最少代码的解决方案。

首先，添加一个`UIButton`覆盖命中测试的类别，并添加一个用于扩展命中测试框架的属性。

***UIButton+Extensions.h***

```
@interface UIButton (Extensions)

@property(nonatomic, assign) UIEdgeInsets hitTestEdgeInsets;

@end 
```

***UIButton+Extensions.m***

```
#import "UIButton+Extensions.h"
#import <objc/runtime.h>

@implementation UIButton (Extensions)

@dynamic hitTestEdgeInsets;

static const NSString *KEY_HIT_TEST_EDGE_INSETS = @"HitTestEdgeInsets";

-(void)setHitTestEdgeInsets:(UIEdgeInsets)hitTestEdgeInsets {
    NSValue *value = [NSValue value:&hitTestEdgeInsets withObjCType:@encode(UIEdgeInsets)];
    objc_setAssociatedObject(self, &KEY_HIT_TEST_EDGE_INSETS, value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

-(UIEdgeInsets)hitTestEdgeInsets {
    NSValue *value = objc_getAssociatedObject(self, &KEY_HIT_TEST_EDGE_INSETS);
    if(value) {
        UIEdgeInsets edgeInsets; [value getValue:&edgeInsets]; return edgeInsets;
    }else {
        return UIEdgeInsetsZero;
    }
}

- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
    if(UIEdgeInsetsEqualToEdgeInsets(self.hitTestEdgeInsets, UIEdgeInsetsZero) || !self.enabled || self.hidden) {
        return [super pointInside:point withEvent:event];
    }

    CGRect relativeFrame = self.bounds;
    CGRect hitFrame = UIEdgeInsetsInsetRect(relativeFrame, self.hitTestEdgeInsets);

    return CGRectContainsPoint(hitFrame, point);
}

@end 
```

添加此类后，您需要做的就是设置按钮的边缘插图。请注意，我选择添加插图，因此如果要使命中区域更大，则必须使用负数。

```
[button setHitTestEdgeInsets:UIEdgeInsetsMake(-10, -10, -10, -10)]; 
```

注意：请记住在您的类中导入类别 ( `#import "UIButton+Extensions.h"`)。

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2011-04-22T13:44:21.247

只需在界面生成器中设置图像边缘插入值。

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2014-12-29T04:58:43.443

这是在 Swift 中使用 Extensions 的优雅解决方案。[根据 Apple 的人机界面指南 ( https://developer.apple.com/ios/human-interface-guidelines/visual-design/layout/](https://developer.apple.com/ios/human-interface-guidelines/visual-design/layout/) ) ，它为所有 UIButtons 提供了至少 44x44 点的命中区域

**斯威夫特 2：**

```
private let minimumHitArea = CGSizeMake(44, 44)

extension UIButton {
    public override func hitTest(point: CGPoint, withEvent event: UIEvent?) -> UIView? {
        // if the button is hidden/disabled/transparent it can't be hit
        if self.hidden || !self.userInteractionEnabled || self.alpha < 0.01 { return nil }

        // increase the hit frame to be at least as big as `minimumHitArea`
        let buttonSize = self.bounds.size
        let widthToAdd = max(minimumHitArea.width - buttonSize.width, 0)
        let heightToAdd = max(minimumHitArea.height - buttonSize.height, 0)
        let largerFrame = CGRectInset(self.bounds, -widthToAdd / 2, -heightToAdd / 2)

        // perform hit test on larger frame
        return (CGRectContainsPoint(largerFrame, point)) ? self : nil
    }
} 
```

**斯威夫特 3：**

```
fileprivate let minimumHitArea = CGSize(width: 100, height: 100)

extension UIButton {
    open override func hitTest(_ point: CGPoint, with event: UIEvent?) -> UIView? {
        // if the button is hidden/disabled/transparent it can't be hit
        if self.isHidden || !self.isUserInteractionEnabled || self.alpha < 0.01 { return nil }

        // increase the hit frame to be at least as big as `minimumHitArea`
        let buttonSize = self.bounds.size
        let widthToAdd = max(minimumHitArea.width - buttonSize.width, 0)
        let heightToAdd = max(minimumHitArea.height - buttonSize.height, 0)
        let largerFrame = self.bounds.insetBy(dx: -widthToAdd / 2, dy: -heightToAdd / 2)

        // perform hit test on larger frame
        return (largerFrame.contains(point)) ? self : nil
    }
} 
```

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2012-12-20T18:02:57.337

您还可以子类化`UIButton`或自定义`UIView`并使用以下内容覆盖`point(inside:with:)`：

**斯威夫特 3**

```
override func point(inside point: CGPoint, with _: UIEvent?) -> Bool {
    let margin: CGFloat = 5
    let area = self.bounds.insetBy(dx: -margin, dy: -margin)
    return area.contains(point)
} 
```

**Objective-C**

```
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
    CGFloat margin = 5.0;
    CGRect area = CGRectInset(self.bounds, -margin, -margin);
    return CGRectContainsPoint(area, point);
} 
```

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2015-08-14T04:12:27.550

这是 Swift 3.0 中 Chase 的 UIButton+Extensions。

```
 import UIKit

private var pTouchAreaEdgeInsets: UIEdgeInsets = .zero

extension UIButton {

    var touchAreaEdgeInsets: UIEdgeInsets {
        get {
            if let value = objc_getAssociatedObject(self, &pTouchAreaEdgeInsets) as? NSValue {
                var edgeInsets: UIEdgeInsets = .zero
                value.getValue(&edgeInsets)
                return edgeInsets
            }
            else {
                return .zero
            }
        }
        set(newValue) {
            var newValueCopy = newValue
            let objCType = NSValue(uiEdgeInsets: .zero).objCType
            let value = NSValue(&newValueCopy, withObjCType: objCType)
            objc_setAssociatedObject(self, &pTouchAreaEdgeInsets, value, .OBJC_ASSOCIATION_RETAIN)
        }
    }

    open override func point(inside point: CGPoint, with event: UIEvent?) -> Bool {
        if UIEdgeInsetsEqualToEdgeInsets(self.touchAreaEdgeInsets, .zero) || !self.isEnabled || self.isHidden {
            return super.point(inside: point, with: event)
        }

        let relativeFrame = self.bounds
        let hitFrame = UIEdgeInsetsInsetRect(relativeFrame, self.touchAreaEdgeInsets)

        return hitFrame.contains(point)
    }
} 
```

要使用它，您可以：

```
button.touchAreaEdgeInsets = UIEdgeInsets(top: -10, left: -10, bottom: -10, right: -10) 
```

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2009-05-04T04:24:52.417

我建议将自定义类型的 UIButton 放在信息按钮的中心。将自定义按钮的大小调整为您希望点击区域的大小。从那里你有两个选择：

1.  检查自定义按钮的“高亮显示触摸”选项。白光会出现在信息按钮上，但在大多数情况下，用户的手指会遮住它，他们只会看到外面的光。

2.  为信息按钮设置一个 IBOutlet，为自定义按钮设置两个 IBAction，一个用于“Touch Down”，一个用于“Touch Up Inside”。然后在 Xcode 中让 touchdown 事件将 info 按钮的 highlight 属性设置为 YES，touchupinside 事件将 highlight 属性设置为 NO。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2010-11-06T04:45:30.547

不要`backgroundImage`用你的图像设置属性，设置`imageView`属性。另外，请确保您已`imageView.contentMode`设置为`UIViewContentModeCenter`.

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2017-08-01T11:36:17.640

我在 Swift 3 上的解决方案：

```
class MyButton: UIButton {

    override open func point(inside point: CGPoint, with event: UIEvent?) -> Bool {
        let relativeFrame = self.bounds
        let hitTestEdgeInsets = UIEdgeInsetsMake(-25, -25, -25, -25)
        let hitFrame = UIEdgeInsetsInsetRect(relativeFrame, hitTestEdgeInsets)
        return hitFrame.contains(point)
    }
} 
```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2014-09-08T16:40:58.777

给出的答案没有错；但是我想扩展[jlarjlar 的答案](https://stackoverflow.com/questions/808503/uibutton-making-the-hit-area-larger-than-the-default-hit-area/13977921#13977921)，因为它具有惊人的潜力，可以为其他控件（例如 SearchBar）的相同问题增加价值。这是因为由于 pointInside 附加到 UIView，因此可以对**任何控件**进行子类化以改善触摸区域。该答案还显示了如何实施完整解决方案的完整示例。

为您的按钮（或任何控件）创建一个新的子类

```
#import <UIKit/UIKit.h>

@interface MNGButton : UIButton

@end 
```

接下来覆盖子类实现中的 pointInside 方法

```
@implementation MNGButton

-(BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event
{
    //increase touch area for control in all directions by 20
    CGFloat margin = 20.0;
    CGRect area = CGRectInset(self.bounds, -margin, -margin);
    return CGRectContainsPoint(area, point);
}

@end 
```

在您的故事板/xib 文件中选择有问题的控件并打开身份检查器并输入您的自定义类的名称。

![按钮](https://i.stack.imgur.com/PBRs4.png)

在包含按钮的场景的 UIViewController 类中，将按钮的类类型更改为子类的名称。

```
@property (weak, nonatomic) IBOutlet MNGButton *helpButton; 
```

将您的故事板/xib 按钮链接到属性 IBOutlet，您的触摸区域将被扩展以适合子类中定义的区域。

除了与[CGRectInset](https://developer.apple.com/library/mac/documentation/graphicsimaging/Reference/CGGeometry/Reference/reference.html#//apple_ref/doc/uid/TP30000955-CH1g-F17155)和[CGRectContainsPoint](https://developer.apple.com/library/mac/documentation/graphicsimaging/Reference/CGGeometry/Reference/reference.html#//apple_ref/doc/uid/TP30000955-CH1g-F17143)[方法](https://developer.apple.com/library/ios/documentation/uikit/reference/uiview_class/UIView/UIView.html#//apple_ref/doc/uid/TP40006816-CH3-SW2)一起覆盖 pointInside 方法之外，还应该花时间检查[CGGeometry](https://developer.apple.com/library/mac/documentation/graphicsimaging/Reference/CGGeometry/Reference/reference.html#//apple_ref/doc/uid/TP30000955-CH202-SW1)以扩展任何 UIView 子类的矩形触摸区域。您还可以在 NSHipster 找到有关 CGGeometry 用例的一些不错的[提示](http://nshipster.com/cggeometry/)。

例如，可以使用上面提到的方法使触摸区域变得不规则，或者简单地选择使宽度触摸区域是水平触摸区域的两倍：

```
CGRect area = CGRectInset(self.bounds, -(2*margin), -margin); 
```

注意：替换任何 UI 类控件在扩展不同控件（或任何 UIView 子类，如 UIImageView 等）的触摸区域时应该会产生类似的结果。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2010-05-12T08:24:42.740

这对我有用：

```
UIButton *button = [UIButton buttonWithType: UIButtonTypeCustom];
// set the image (here with a size of 32 x 32)
[button setImage: [UIImage imageNamed: @"myimage.png"] forState: UIControlStateNormal];
// just set the frame of the button (here 64 x 64)
[button setFrame: CGRectMake(xPositionOfMyButton, yPositionOfMyButton, 64, 64)]; 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2013-12-16T22:29:25.707

不要改变 UIButton 的行为。

```
@interface ExtendedHitButton: UIButton

+ (instancetype) extendedHitButton;

- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event;

@end

@implementation ExtendedHitButton

+ (instancetype) extendedHitButton {
    return (ExtendedHitButton *) [ExtendedHitButton buttonWithType:UIButtonTypeCustom];
}

- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
    CGRect relativeFrame = self.bounds;
    UIEdgeInsets hitTestEdgeInsets = UIEdgeInsetsMake(-44, -44, -44, -44);
    CGRect hitFrame = UIEdgeInsetsInsetRect(relativeFrame, hitTestEdgeInsets);
    return CGRectContainsPoint(hitFrame, point);
}

@end 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2012-11-20T14:11:34.127

我通过 swizzling 使用更通用的方法`-[UIView pointInside:withEvent:]`。这允许我修改任何的命中测试行为`UIView`，而不仅仅是`UIButton`.

通常，一个按钮被放置在一个容器视图中，这也限制了命中测试。例如，当一个按钮位于容器视图的顶部并且您想向上扩展触摸目标时，您还必须扩展容器视图的触摸目标。

```
@interface UIView(Additions)
@property(nonatomic) UIEdgeInsets hitTestEdgeInsets;
@end

@implementation UIView(Additions)

+ (void)load {
    Swizzle(self, @selector(pointInside:withEvent:), @selector(myPointInside:withEvent:));
}

- (BOOL)myPointInside:(CGPoint)point withEvent:(UIEvent *)event {

    if(UIEdgeInsetsEqualToEdgeInsets(self.hitTestEdgeInsets, UIEdgeInsetsZero) || self.hidden ||
       ([self isKindOfClass:UIControl.class] && !((UIControl*)self).enabled))
    {
        return [self myPointInside:point withEvent:event]; // original implementation
    }
    CGRect hitFrame = UIEdgeInsetsInsetRect(self.bounds, self.hitTestEdgeInsets);
    hitFrame.size.width = MAX(hitFrame.size.width, 0); // don't allow negative sizes
    hitFrame.size.height = MAX(hitFrame.size.height, 0);
    return CGRectContainsPoint(hitFrame, point);
}

static char hitTestEdgeInsetsKey;
- (void)setHitTestEdgeInsets:(UIEdgeInsets)hitTestEdgeInsets {
    objc_setAssociatedObject(self, &hitTestEdgeInsetsKey, [NSValue valueWithUIEdgeInsets:hitTestEdgeInsets], OBJC_ASSOCIATION_RETAIN);
}

- (UIEdgeInsets)hitTestEdgeInsets {
    return [objc_getAssociatedObject(self, &hitTestEdgeInsetsKey) UIEdgeInsetsValue];
}

void Swizzle(Class c, SEL orig, SEL new) {

    Method origMethod = class_getInstanceMethod(c, orig);
    Method newMethod = class_getInstanceMethod(c, new);

    if(class_addMethod(c, orig, method_getImplementation(newMethod), method_getTypeEncoding(newMethod)))
        class_replaceMethod(c, new, method_getImplementation(origMethod), method_getTypeEncoding(origMethod));
    else
        method_exchangeImplementations(origMethod, newMethod);
}
@end 
```

这种方法的好处是您甚至可以通过添加用户定义的运行时属性在 Storyboards 中使用它。可悲的是，`UIEdgeInsets`它不能直接作为一种类型使用，但由于`CGRect`它还包含一个带有四个的结构，`CGFloat`因此通过选择“Rect”并填写如下值可以完美地工作`{{top, left}, {bottom, right}}`：

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2015-06-23T12:51:04.657

我在 Swift 中使用以下类，还可以启用 Interface Builder 属性来调整边距：

```
@IBDesignable
class ALExtendedButton: UIButton {

    @IBInspectable var touchMargin:CGFloat = 20.0

    override func pointInside(point: CGPoint, withEvent event: UIEvent?) -> Bool {
        var extendedArea = CGRectInset(self.bounds, -touchMargin, -touchMargin)
        return CGRectContainsPoint(extendedArea, point)
    }
} 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2009-04-30T18:59:15.857

好吧，您可以将您的 UIButton 放在一个透明且稍大的 UIView 中，然后像在 UIButton 中一样在 UIView 实例上捕获触摸事件。这样，您仍然可以使用按钮，但触摸区域更大。如果用户触摸视图而不是按钮，您将必须手动处理按钮的选定和突出显示状态。

其他可能性涉及使用 UIImage 而不是 UIButton。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2009-10-13T23:55:17.617

我已经能够以编程方式增加信息按钮的点击区域。“i”图形不改变比例，并保持在新按钮框架的中心。

在 Interface Builder 中，信息按钮的大小似乎固定为 18x19[*]。通过将其连接到 IBOutlet，我能够在代码中更改其帧大小而不会出现任何问题。

```
static void _resizeButton( UIButton *button )
{
    const CGRect oldFrame = infoButton.frame;
    const CGFloat desiredWidth = 44.f;
    const CGFloat margin = 
        ( desiredWidth - CGRectGetWidth( oldFrame ) ) / 2.f;
    infoButton.frame = CGRectInset( oldFrame, -margin, -margin );
} 
```

[*]：更高版本的 iOS 似乎增加了信息按钮的点击区域。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2017-01-20T15:00:19.867

这是我的**Swift 3**解决方案（基于这篇博文：http: [//bdunagan.com/2010/03/01/iphone-tip-larger-hit-area-for-uibutton/](http://bdunagan.com/2010/03/01/iphone-tip-larger-hit-area-for-uibutton/)）

```
class ExtendedHitAreaButton: UIButton {

    @IBInspectable var hitAreaExtensionSize: CGSize = CGSize(width: -10, height: -10)

    override func hitTest(_ point: CGPoint, with event: UIEvent?) -> UIView? {

        let extendedFrame: CGRect = bounds.insetBy(dx: hitAreaExtensionSize.width, dy: hitAreaExtensionSize.height)

        return extendedFrame.contains(point) ? self : nil
    }
} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2019-09-22T20:00:17.173

# 就是这么简单：

```
class ChubbyButton: UIButton {
    override func point(inside point: CGPoint, with event: UIEvent?) -> Bool {
        return bounds.insetBy(dx: -20, dy: -20).contains(point)
    }
} 
```

# 这就是全部。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2016-06-17T22:22:43.620

通过覆盖继承的 UIButton 实现。

**斯威夫特 2.2**：

```
// don't forget that negative values are for outset
_button.hitOffset = UIEdgeInsets(top: -10, left: -10, bottom: -10, right: -10)
...
class UICustomButton: UIButton {
    var hitOffset = UIEdgeInsets()

    override func pointInside(point: CGPoint, withEvent event: UIEvent?) -> Bool {
        guard hitOffset != UIEdgeInsetsZero && enabled && !hidden else {
            return super.pointInside(point, withEvent: event)
        }
        return UIEdgeInsetsInsetRect(bounds, hitOffset).contains(point)
    }
} 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2016-09-16T14:58:22.367

基于上面 giaset 的回答（我找到了最优雅的解决方案），这里是 swift 3 版本：

```
import UIKit

fileprivate let minimumHitArea = CGSize(width: 44, height: 44)

extension UIButton {
    open override func hitTest(_ point: CGPoint, with event: UIEvent?) -> UIView? {
        // if the button is hidden/disabled/transparent it can't be hit
        if isHidden || !isUserInteractionEnabled || alpha < 0.01 { return nil }

        // increase the hit frame to be at least as big as `minimumHitArea`
        let buttonSize = bounds.size
        let widthToAdd = max(minimumHitArea.width - buttonSize.width, 0)
        let heightToAdd = max(minimumHitArea.height - buttonSize.height, 0)
        let largerFrame = bounds.insetBy(dx: -widthToAdd / 2, dy: -heightToAdd / 2)

        // perform hit test on larger frame
        return (largerFrame.contains(point)) ? self : nil
    }
} 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2016-06-16T17:48:29.990

Chase 的自定义命中测试实现为 UIButton 的子类。用Objective-C编写。

它似乎对构造函数都`init`有效。`buttonWithType:`对于我的需要，它是完美的，但由于子类化`UIButton`可能很麻烦，我很想知道是否有人对它有问题。

## CustomeHitAreaButton.h

```
#import <UIKit/UIKit.h>

@interface CustomHitAreaButton : UIButton

- (void)setHitTestEdgeInsets:(UIEdgeInsets)hitTestEdgeInsets;

@end 
```

## CustomHitAreaButton.m

```
#import "CustomHitAreaButton.h"

@interface CustomHitAreaButton()

@property (nonatomic, assign) UIEdgeInsets hitTestEdgeInsets;

@end

@implementation CustomHitAreaButton

- (instancetype)initWithFrame:(CGRect)frame {
    if(self = [super initWithFrame:frame]) {
        self.hitTestEdgeInsets = UIEdgeInsetsZero;
    }
    return self;
}

-(void)setHitTestEdgeInsets:(UIEdgeInsets)hitTestEdgeInsets {
    self->_hitTestEdgeInsets = hitTestEdgeInsets;
}

- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
    if(UIEdgeInsetsEqualToEdgeInsets(self.hitTestEdgeInsets, UIEdgeInsetsZero) || !self.enabled || self.hidden) {
        return [super pointInside:point withEvent:event];
    }
    CGRect relativeFrame = self.bounds;
    CGRect hitFrame = UIEdgeInsetsInsetRect(relativeFrame, self.hitTestEdgeInsets);
    return CGRectContainsPoint(hitFrame, point);
}

@end 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2014-06-06T16:50:09.150

永远不要覆盖类别中的方法。子类按钮和覆盖`- pointInside:withEvent:`。例如，如果您的按钮边小于 44 像素（推荐作为最小可点击区域），请使用：

```
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event
{
    return (ABS(point.x - CGRectGetMidX(self.bounds)) <= MAX(CGRectGetMidX(self.bounds), 22)) && (ABS(point.y - CGRectGetMidY(self.bounds)) <= MAX(CGRectGetMidY(self.bounds), 22));
} 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2012-08-03T02:09:28.303

WJBackgroundInsetButton.h

```
#import <UIKit/UIKit.h>

@interface WJBackgroundInsetButton : UIButton {
    UIEdgeInsets backgroundEdgeInsets_;
}

@property (nonatomic) UIEdgeInsets backgroundEdgeInsets;

@end 
```

WJBackgroundInsetButton.m

```
#import "WJBackgroundInsetButton.h"

@implementation WJBackgroundInsetButton

@synthesize backgroundEdgeInsets = backgroundEdgeInsets_;

-(CGRect) backgroundRectForBounds:(CGRect)bounds {
    CGRect sup = [super backgroundRectForBounds:bounds];
    UIEdgeInsets insets = self.backgroundEdgeInsets;
    CGRect r = UIEdgeInsetsInsetRect(sup, insets);
    return r;
}

@end 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2015-05-17T00:50:41.940

我为此目的制作了一个[图书馆](https://github.com/kgaidis/KGHitTestingViews)。

您可以选择使用`UIView`类别，**无需子类化**：

```
@interface UIView (KGHitTesting)
- (void)setMinimumHitTestWidth:(CGFloat)width height:(CGFloat)height;
@end 
```

或者您可以继承您的 UIView 或 UIButton 并设置`minimumHitTestWidth`和/或`minimumHitTestHeight`. 然后，您的按钮命中测试区域将由这 2 个值表示。

就像其他解决方案一样，它使用该`- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event`方法。该方法在 iOS 执行命中测试时被调用。[这篇](http://smnh.me/hit-testing-in-ios/)博文很好地描述了 iOS 命中测试的工作原理。

[https://github.com/kgaidis/KGHitTestingViews](https://github.com/kgaidis/KGHitTestingViews)

```
@interface KGHitTestingButton : UIButton <KGHitTesting>

@property (nonatomic) CGFloat minimumHitTestHeight; 
@property (nonatomic) CGFloat minimumHitTestWidth;

@end 
```

您也可以只继承并使用 Interface Builder 而无需编写任何代码： ![在此处输入图像描述](https://raw.githubusercontent.com/kgaidis/KGHitTestingViews/master/Images/InterfaceBuilderSubclassExample.png)

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2012-08-08T15:07:31.383

我对 tableviewcell.accessoryView 内的按钮使用这个技巧来扩大它的触摸区域

```
#pragma mark - Touches

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    UITouch *touch                  = [touches anyObject];
    CGPoint location                = [touch locationInView:self];
    CGRect  accessoryViewTouchRect  = CGRectInset(self.accessoryView.frame, -15, -15);

    if(!CGRectContainsPoint(accessoryViewTouchRect, location))
        [super touchesBegan:touches withEvent:event];
}

- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event
{
    UITouch *touch                  = [touches anyObject];
    CGPoint location                = [touch locationInView:self];
    CGRect  accessoryViewTouchRect  = CGRectInset(self.accessoryView.frame, -15, -15);

    if(CGRectContainsPoint(accessoryViewTouchRect, location) && [self.accessoryView isKindOfClass:[UIButton class]])
    {
        [(UIButton *)self.accessoryView sendActionsForControlEvents:UIControlEventTouchUpInside];
    }
    else
        [super touchesEnded:touches withEvent:event];
} 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2016-08-03T17:07:06.603

我刚刚在 swift 2.2 中移植了 @Chase[解决方案](https://stackoverflow.com/a/13067285/1728552)

```
import Foundation
import ObjectiveC

private var hitTestEdgeInsetsKey: UIEdgeInsets = UIEdgeInsetsZero

extension UIButton {
    var hitTestEdgeInsets:UIEdgeInsets {
        get {
            let inset = objc_getAssociatedObject(self, &hitTestEdgeInsetsKey) as? NSValue ?? NSValue(UIEdgeInsets: UIEdgeInsetsZero)
            return inset.UIEdgeInsetsValue()
        }
        set {
            let inset = NSValue(UIEdgeInsets: newValue)
            objc_setAssociatedObject(self, &hitTestEdgeInsetsKey, inset, objc_AssociationPolicy.OBJC_ASSOCIATION_RETAIN_NONATOMIC)
        }
    }

    public override func pointInside(point: CGPoint, withEvent event: UIEvent?) -> Bool {
        guard !UIEdgeInsetsEqualToEdgeInsets(hitTestEdgeInsets, UIEdgeInsetsZero) && self.enabled == true && self.hidden == false else {
            return super.pointInside(point, withEvent: event)
        }
        let relativeFrame = self.bounds
        let hitFrame = UIEdgeInsetsInsetRect(relativeFrame, hitTestEdgeInsets)
        return CGRectContainsPoint(hitFrame, point)
    }
} 
```

你可以这样使用

```
button.hitTestEdgeInsets = UIEdgeInsetsMake(-10, -10, -10, -10) 
```

有关任何其他参考，请参阅[https://stackoverflow.com/a/13067285/1728552](https://stackoverflow.com/a/13067285/1728552)

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2020-06-10T17:18:13.653

我看到很多解决方案要么没有达到目标，要么需要指定一些固定的插图来添加。这是一个简单`UIView`子类的解决方案，它将视图的命中矩形扩展到*至少*44 x 44；如果任一维度已经大于该维度，则它不会人为地填充该维度。

这可确保按钮始终具有建议的最小触摸尺寸 44 x 44，而无需任何手动配置、计算或图像填充：

```
override func point(inside point: CGPoint, with event: UIEvent?) -> Bool {
    let minimumTouchSize: CGFloat = 44.0
    let center: CGPoint = .init(x: self.bounds.midX, y: self.bounds.midY)

    let minimumHitRect: CGRect =
        .init(center: center, size: .zero)
        .insetBy(
            dx: -minimumTouchSize / 2.0,
            dy: -minimumTouchSize / 2.0
        )

    let fullHitRect = self.bounds.union(minimumHitRect)

    return fullHitRect.contains(point)
} 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2019-03-18T22:06:53.457

@antoine 为 Swift 4 格式化的答案

```
final class ExtendedHitButton: UIButton {

    override func point( inside point: CGPoint, with event: UIEvent? ) -> Bool {
        let relativeFrame = self.bounds
        let hitTestEdgeInsets = UIEdgeInsets(top: -44, left: -44, bottom: -44, right: -44) // Apple recommended hit target
        let hitFrame = relativeFrame.inset(by: hitTestEdgeInsets)
        return hitFrame.contains( point );
    }
} 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2019-02-22T02:41:03.603

与 Zhanserik 类似，具有可变扩展名并针对 Swift 4.2 进行了更新：

```
class ButtonWithExtendedHitArea: UIButton {

    var extention: CGFloat

    required init(extendBy: CGFloat) {
        extention = extendBy

        super.init(frame: .zero)
    }

    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }

    override open func point(inside point: CGPoint, with event: UIEvent?) -> Bool {
        let relativeFrame = self.bounds
        let hitTestEdgeInsets = UIEdgeInsets(top: -extention, left: -extention, bottom: -extention, right: -extention)
        let hitFrame = relativeFrame.inset(by: hitTestEdgeInsets)
        return hitFrame.contains(point)
    }

} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-11-06T18:29:38.640

我玩这个游戏太晚了，但想权衡一种可能解决您问题的简单技术。这是我的一个典型的编程 UIButton 片段：

```
UIImage *arrowImage = [UIImage imageNamed:@"leftarrow"];
arrowButton = [[UIButton alloc] initWithFrame:CGRectMake(15.0, self.frame.size.height-35.0, arrowImage.size.width/2, arrowImage.size.height/2)];
[arrowButton setBackgroundImage:arrowImage forState:UIControlStateNormal];
[arrowButton addTarget:self action:@selector(onTouchUp:) forControlEvents:UIControlEventTouchUpOutside];
[arrowButton addTarget:self action:@selector(onTouchDown:) forControlEvents:UIControlEventTouchDown];
[arrowButton addTarget:self action:@selector(onTap:) forControlEvents:UIControlEventTouchUpInside];
[arrowButton addTarget:self action:@selector(onTouchUp:) forControlEvents:UIControlEventTouchDragExit];
[arrowButton setUserInteractionEnabled:TRUE];
[arrowButton setAdjustsImageWhenHighlighted:NO];
[arrowButton setTag:1];
[self addSubview:arrowButton]; 
```

我正在为我的按钮加载一个透明的 png 图像并设置背景图像。我正在根据 UIImage 设置框架，并为视网膜缩放 50%。好吧，也许你同意或不同意，但如果你想让命中区域更大，让自己头疼：

我做什么，在 Photoshop 中打开图像，只需将画布大小增加到 120% 并保存。实际上，您刚刚使用透明像素使图像更大。

只有一种方法。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2013-04-12T15:07:28.053

我遵循了 Chase 的响应，它工作得很好，当你创建的区域太大时，一个问题是大于按钮被取消选择的区域（如果区域不是更大）它不会调用 UIControlEventTouchUpInside 事件的选择器.

我认为大小超过 200 任何方向或类似的东西。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2015-03-20T01:07:36.827

@jlajlar 上面的答案似乎很好而且很简单，但与 Xamarin.iOS 不匹配，因此我将其转换为 Xamarin。如果您在 Xamarin iOS 上寻找解决方案，这里有：

```
public override bool PointInside (CoreGraphics.CGPoint point, UIEvent uievent)
{
    var margin = -10f;
    var area = this.Bounds;
    var expandedArea = area.Inset(margin, margin);
    return expandedArea.Contains(point);
} 
```

您可以将此方法添加到要覆盖 UIView 或 UIImageView 的类中。这很好用:)

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2016-06-21T01:58:29.270

这个 Swift 版本允许你为所有 UIButtons 定义一个最小点击大小。至关重要的是，它还可以处理隐藏 UIButtons 的情况，许多答案都忽略了这一点。

```
extension UIButton {
    public override func hitTest(point: CGPoint, withEvent event: UIEvent?) -> UIView? {
        // Ignore if button hidden
        if self.hidden {
            return nil
        }

        // If here, button visible so expand hit area
        let hitSize = CGFloat(56.0)
        let buttonSize = self.frame.size
        let widthToAdd = (hitSize - buttonSize.width > 0) ? hitSize - buttonSize.width : 0
        let heightToAdd = (hitSize - buttonSize.height > 0) ? hitSize - buttonSize.height : 0
        let largerFrame = CGRect(x: 0-(widthToAdd/2), y: 0-(heightToAdd/2), width: buttonSize.width+widthToAdd, height: buttonSize.height+heightToAdd)
        return (CGRectContainsPoint(largerFrame, point)) ? self : nil
    }
} 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2016-04-13T08:10:18.860

没有一个答案对我来说是完美的，因为我在那个按钮上使用了背景图片和标题。此外，按钮将随着屏幕大小的变化而调整大小。

相反，我通过使 png 透明区域更大来扩大点击区域。

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2017-07-19T04:02:45.350

*   不覆盖类别或扩展
*   每个指南至少 44x44

我的看法：

```
open class MinimumTouchAreaButton: UIButton {
    open override func hitTest(_ point: CGPoint, with event: UIEvent?) -> UIView? {
        guard !self.isHidden, self.isUserInteractionEnabled, self.alpha > 0 else { return nil }
        let expandedBounds = bounds.insetBy(dx: min(bounds.width - 44, 0), dy: min(bounds.height - 44, 0))
        return expandedBounds.contains(point) ? self : nil
    }
} 
```

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2016-07-20T09:53:51.250

迅速：

```
override func viewWillAppear(animated: Bool) {
        self.sampleButton.frame = CGRectInset(self.sampleButton.frame, -10, -10);
    } 
```

* * *

## 回答 #36

> 赞同：-2
> 
> 时间：2017-05-24T16:50:45.890

```
override func point(inside point: CGPoint, with event: UIEvent?) -> Bool {
    let inset = UIEdgeInsets(top: -adjustHitY * 0.5, left: -adjustHitX * 0.5, bottom: -adjustHitY * 0.5, right: -adjustHitX * 0.5)
    return UIEdgeInsetsInsetRect(bounds, inset).contains(point)
} 
```

# oracle - Oracle 版本上的字母是什么意思？

> ID：808513
> 
> 赞同：8
> 
> 时间：2009-04-30T18:56:52.027
> 
> 标签：oracle

Oracle 版本上的字母是什么意思？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-30T19:00:31.127

我假设您指的是 i 或 g 他们代表互联网和网格。我个人认为它们主要是出于营销目的而不是任何特定的技术原因。

# java - Maven 和依赖模块

> ID：808516
> 
> 赞同：61
> 
> 时间：2009-04-30T18:57:04.910
> 
> 标签：java, maven-2, build-process

同事们一直在吹捧 maven 的奇迹及其神奇的依赖关系，但我发现它在我认为明显的用途上失败了。

假设我有一个带有主 POM 的根文件夹。

然后在下面我有一些项目，称它们为 A 和 B

B 需要 A，因此 B 文件夹中的 POM 中包含适当的依赖项

现在，回到根文件夹的配置文件中，我指定要构建 B。

当我执行通常的 mvn clean install 时，由于未构建 A 而失败。

我的朋友告诉我，我必须在根目录的主配置文件中同时指定 A 和 B。

但是，maven 看到 B 的依赖管理的全部重点不是转到 B POM 文件，在那里它看到了对 A 的依赖，因此它应该自动构建 A。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-04-30T19:02:41.387

使用主 POM：

### `~/scratch/pom.xml`

```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

    <modelVersion>4.0.0</modelVersion>

    <groupId>scratch</groupId>
    <artifactId>scratch</artifactId>
    <packaging>pom</packaging>
    <version>1.0-SNAPSHOT</version>

    <modules>
        <module>nipple</module>
        <module>cabbage</module>
    </modules>
</project> 
```

和模块 POM：

### `~/scratch/nipple/pom.xml`

```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

    <parent>
        <artifactId>scratch</artifactId>
        <groupId>scratch</groupId>
        <version>1.0-SNAPSHOT</version>
    </parent>

    <modelVersion>4.0.0</modelVersion>

    <groupId>scratch</groupId>
    <artifactId>nipple</artifactId>
    <version>1.0-SNAPSHOT</version>

</project> 
```

### `~/scratch/cabbage/pom.xml`

```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

    <parent>
        <artifactId>scratch</artifactId>
        <groupId>scratch</groupId>
        <version>1.0-SNAPSHOT</version>
    </parent>

    <modelVersion>4.0.0</modelVersion>

    <groupId>scratch</groupId>
    <artifactId>cabbage</artifactId>
    <version>1.0-SNAPSHOT</version>
    <dependencies>
        <dependency>
            <groupId>scratch</groupId>
            <artifactId>nipple</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
    </dependencies>

</project> 
```

`mvn package`清除本地存储库并最终构建所有模块后，我可以在根目录中发出问题。（进入空的 JAR，但已构建。）

Maven 似乎在存储库或正在进行的构建中寻找依赖项。当您只构建单个模块时，它不会自动遍历您的项目结构，因为您甚至不需要在计算机上拥有父项目，更不用说当前模块上方的一个目录。（父子关系甚至不是双射的。）

之所以如此，可能是因为模块位置可预测的目录布局绝不是强制性的。上面例子的布局是这样的，这甚至有点常见和可以接受：

```
projects
|
+--scratch
|  |
|  +--scratch-parent
|  |  |
|  |  +--pom.xml [The POM of scratch:scratch:1.0-SNAPSHOT]
|  |
|  +--nipple
|  |  |
|  |  +--pom.xml [The POM of scratch:mod1:1.0-SNAPSHOT]
|  |
|  +--cabbage
|  |  |
|  |  +--pom.xml [The POM of scratch:mod2:1.0-SNAPSHOT] 
```

在这种情况下，`<modules>`父 POM 的部分将是：

```
<modules>
    <module>../nipple</module>
    <module>../cabbage</module>
</modules> 
```

请注意，没有说明*哪个*工件 ID 在哪个模块中。它只是告诉 Maven 这些是文件系统位置，可以在其中搜索与此构建相关的其他工件。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-07-03T12:23:51.460

我能想到您想要的行为尚未实现的原因如下：

假设我正在处理项目 A 和 B。目前 A 已损坏。如果依赖解决如您所愿，我将永远无法构建 B，直到 A 被修复。所以我要么必须回滚对 A 的更改，要么首先专注于修复 A。无论哪种方式，都可能不是我现在想要关注的。

一般来说，B 希望使用 A 的“最后一个好”版本，而不是最新版本。使用存储库中的依赖项意味着它们至少可以编译（并且希望单元测试也可以运行）。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-07-14T01:42:47.403

看一下[Maven reactor 插件](http://maven.apache.org/plugins/maven-reactor-plugin/index.html)，特别是 reactor:make，它构建了一个模块以及它所依赖的所有模块。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-10-13T08:55:49.420

里奇是完全正确的。您所描述的通常不是预期的行为。但是，正如 derb 所说，*如果父 POM 知道模块*，则 Maven 反应器支持部分构建。

构建也`mvn install -pl B -am`应该*使*( `-am`) B 的依赖项（即 A）。

无论如何，模块 A*必须*是父 POM 的模块。

（请参阅[Maven 模块 + 构建单个特定模块](https://stackoverflow.com/questions/1114026/maven-modules-building-a-single-specific-module)）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-05-18T05:22:34.423

如果您使用 IntelliJ，他们在 Maven 运行配置中有一个小魔法复选框：“解决工作区工件”。因此无需从父级安装或构建。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-02-19T17:09:55.807

答案只是它不是 Maven 的工作方式。Maven 背后的想法是为开发人员提供一个逻辑的、简单的系统来控制依赖关系。从存储库中获取依赖项是关键。每个例外都会削弱这种控制和简单性。在父 POM 中添加 A 作为依赖项可以完全解决您的方案，而不会添加更多异常。使用批处理文件或 ant 脚本是解决方案的另一种方法。

# python - 使用 python 将 XML 打印成 HTML

> ID：808529
> 
> 赞同：0
> 
> 时间：2009-04-30T19:01:10.363
> 
> 标签：python, html, xml

我在 PyQt 中有一个 TextEdit 小部件，用于打印 HTML 中的日志。我使用 HTML，所以我可以将条目分成颜色类别（红色表示错误，黄色表示调试，蓝色表示消息等），但这会产生问题。大多数调试消息都是 XML。当我在小部件上使用 appendHtml 时，它会删除所有标签。

如何在 HTML 文档中漂亮地打印 XML？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T19:18:04.970

[`cgi.escape`](http://docs.python.org/library/cgi.html#cgi.escape)可以帮你。它将字符串中的字符`'&'`,`'<'`和转换`'>'`为 HTML 安全的序列。这足以防止对 xml 标记的解释。

```
>>> cgi.escape('<tag>')
'&lt;tag&gt; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T19:12:48.773

cdata 部分可能会有所帮助。

[http://reference.sitepoint.com/javascript/CDATASection](http://reference.sitepoint.com/javascript/CDATASection)

[http://en.wikipedia.org/wiki/CDATA](http://en.wikipedia.org/wiki/CDATA)

# hibernate - Glassfish 上的 Spring + JPA (Hibernate) --> ClassVisitor 问题

> ID：808530
> 
> 赞同：1
> 
> 时间：2009-04-30T19:02:02.530
> 
> 标签：hibernate, spring, jpa, spring-mvc, glassfish

我正在尝试使用 Spring 2.5（核心 + MVC）和 JPA（使用 Hibernate 作为持久性机制）编写一个简单的 Web 应用程序。每次部署时，我都会收到指向 ClassVisitor 的“找不到类异常”。

这是 asm 库的一个已知版本问题。在独立应用程序中，我可以确保正确的 asm 版本位于类路径中，但是当我将它们部署到服务器时，我仍然遇到问题。

有什么方法可以保证服务器使用正确的 jar 文件？

我正在为此撕毁我的头发，而且我没有头发可以失去。:)

谢谢你的帮助，

肯·库森 ken.kousen@kousenit.com

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-18T09:40:00.780

您可以将 jar 文件放入 Glassfish 域的“lib”文件夹中。

# xsd - XSD - xs:nonNegativeInteger 和以 .00 结尾的值

> ID：808532
> 
> 赞同：0
> 
> 时间：2009-04-30T19:02:33.243
> 
> 标签：xsd, integer, decimal

我意识到值 0.00 不是有效的非负整数，甚至也不是整数。不幸的是，数据是以这种格式出现的。如果它以 .0 结尾，我不想将其丢弃，但我也不想将类型更改为 Decimal 并且可能以 .1 结尾的值作为有效值。

有没有办法我的 XSD 可以验证数字，使它们只是正整数，因此 0.00、0、1、1.0、2.0000000 等值都被接受，但 -1、1.1、2.2、3.3333 都是无效的？

谢谢-c

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T19:06:30.460

您可以查看更改为小数并对小数点后的位置进行限制。特别是，您可能能够使用正则表达式方面。我从来没有尝试过这个，甚至不知道它是否有效，但这是一个值得关注的方向。您将限制词汇空间而不是值空间，但这就是您想要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T20:58:46.290

这可以满足我的需要，谢谢约翰

```
<xs:simpleType name="nonNegativeWholeDecimal">
    <xs:restriction base="xs:decimal">
        <xs:pattern value="[0-9]*(\.[0]*)?"/>
    </xs:restriction>
</xs:simpleType> 
```

# ruby - 如何在 Ruby 中将 Blowfish 编码的二进制字符串转换为 ASCII？

> ID：808536
> 
> 赞同：0
> 
> 时间：2009-04-30T19:02:42.230
> 
> 标签：ruby, encryption, blowfish

我想使用 Ruby 和[Crypt library](http://crypt.rubyforge.org/blowfish.html)对一些纯文本进行编码。然后，我想将此加密文本（连同其他一些数据）作为 ASCII 十六进制字符串传输到 XML 文件中。

我有以下代码片段：

```
require 'rubygems'
require 'crypt/blowfish'

plain = "This is the plain text"
puts plain

blowfish = Crypt::Blowfish.new("A key up to 56 bytes long")
enc = blowfish.encrypt_block(plain)
puts enc 
```

哪个输出：

```
这是纯文本
????;
```

我相信我需要调用`enc.unpack()`，但我不确定 unpack 方法调用需要哪些参数。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T19:20:46.273

如果你使用`decrypt_string`和它的对应物`encrypt_string`，它很容易输出。:)

```
 require 'rubygems'
require 'crypt/blowfish'

plain = "This is the plain text"
puts plain

blowfish = Crypt::Blowfish.new("A key up to 56 bytes long")
enc = blowfish.**encrypt_string**(plain)
p blowfish.**decrypt_string**(enc) 
```

还发现这篇博文讨论了使用 Crypt 库的速度问题，添加仅供参考。:)
[http://basic70tech.wordpress.com/2007/03/09/blowfish-decryption-in-ruby/](http://basic70tech.wordpress.com/2007/03/09/blowfish-decryption-in-ruby/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-01T15:30:20.937

当您说“ASCII 十六进制”时，您的意思是它只需要可读的 ASCII 还是需要严格的十六进制？

这是编码二进制数据的两种方法：

```
require 'rubygems'
require 'crypt/blowfish'

plain = "This is the plain text"
puts plain

blowfish = Crypt::Blowfish.new("A key up to 56 bytes long")
enc = blowfish.encrypt_string(plain)

hexed = ''
enc.each_byte { |c| hexed << '%02x' % c }

puts hexed
# => 9162f6c33729edd44f5d034fb933ec38e774460ccbcf4d451abf4a8ead32b32a

require 'base64'

mimed = Base64.encode64(enc)

puts mimed
# => kWL2wzcp7dRPXQNPuTPsOOd0RgzLz01FGr9Kjq0ysyo= 
```

# c# - 我不明白如何使用 SendMessage 或 PostMessage 调用

> ID：808540
> 
> 赞同：7
> 
> 时间：2009-04-30T19:04:15.347
> 
> 标签：c#, keypress, handler, sendmessage, postmessage

我需要在第三方应用程序中模拟按键。假设我有一个需要向计算器应用程序发送“8”的 C# 应用程序。我不能使用 .Net 的 SendKeys 或 win32 api 的 keybd_event ，因为它们都要求窗口是最活跃的窗口，而我的情况并非如此。

这样就剩下调用 sendMessage 和 postMessage 了。在过去的三个小时里，我一直在尝试获得一些结果，但现在我完全没有希望了。

我有以下内容：

```
 [DllImport("user32.dll")]
    public static extern int FindWindow(string lpClassName,string lpWindowName);
    [DllImport("user32.dll")]
    public static extern int SendMessage(int hWnd, uint Msg, int wParam, int lParam);

    [return: MarshalAs(UnmanagedType.Bool)]
    [DllImport("user32.dll", SetLastError = true)]
    public static extern bool PostMessage(int hWnd, uint Msg, int wParam, int lParam);

    private void button1_Click(object sender, EventArgs e)
    {
        const int WM_KEYDOWN = 0x100;
        const int WM_SYSCOMMAND = 0x018;
        const int SC_CLOSE = 0x053;

        int WindowToFind = FindWindow(null,"Calculator");

        int result = SendMessage(WindowToFind, WM_SYSCOMMAND, SC_CLOSE, 0);
        Boolean result2 = PostMessage(WindowToFind, WM_SYSCOMMAND, SC_CLOSE, 0);

        int result3 = SendMessage(WindowToFind, WM_KEYDOWN,((int)Keys.NumPad7), 0);
        Boolean result4 = PostMessage(WindowToFind, WM_KEYDOWN, ((int)Keys.NumPad7), 0);
    } 
```

如您所见，我进行了四次尝试与计算器进行通信。使用 sendMessage 和 PostMessage 关闭窗口并发送密钥 7\. 没有任何效果。FindWindow 方法有效，因为我得到了应用程序的处理程序（我什至尝试自己启动进程并使用 process.MainWindowHandler 访问它，但没有运气）。没有错误或异常，但它在计算器中没有任何作用。

我也用记事本尝试了完全相同的东西，也没有任何改变。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-30T19:07:42.577

你有没有机会在 64 位机器上运行它？如果是这样，我相信所有那些实际上是 hWnds 的“int”值（Send/Post 的第一个参数，FindWindow 的返回值）都需要是 IntPtr。

* * *

经过一番检查，看起来对于 SendMessage 和 PostMessage，第一个、第三个和第四个参数应该是 IntPtr 而不是 int（以及所有这些的返回值）

因此，正确的签名将是：

```
[DllImport("user32.dll")]
public static extern IntPtr FindWindow(string lpClassName,string lpWindowName);
[DllImport("user32.dll")]
public static extern IntPtr SendMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam);
[DllImport("user32.dll")]
public static extern IntPtr PostMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T19:19:09.633

CodeProject 上有一篇很好的文章：http: [//www.codeproject.com/KB/cs/SendKeys.aspx](http://www.codeproject.com/KB/cs/SendKeys.aspx)

SendKeys其实是正确的思路，但是需要获取目标窗口的HWND（窗口句柄）。[这个 MSDN 示例](http://msdn.microsoft.com/en-us/library/ms171548.aspx)展示了如何有效地使用 SendKeys，但没有展示如何发现除最顶层窗口之外的任何内容的 HWND。

结合这两种技术，使用 CodeProject 示例定位您要定位的应用程序的 HWND，然后使用 MSDN 文章使用 SendKeys 将击键（或鼠标事件）发送到目标应用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T19:23:11.323

`SendMessage`不是直接你的问题，而是和之间的区别`PostMessage`是`Send`阻塞调用，`Post`立即返回（在接收应用程序处理它之前）。

MSDN 解释了差异： http: [//msdn.microsoft.com/en-us/library/ms644950 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms644950(VS.85).aspx)

此外，如果您使用的是 vista 而不是 .NET 3.0，这也可能是一个问题：

> SendKeys 类已针对 .NET Framework 3.0 进行了更新，以使其能够在 Windows Vista 上运行的应用程序中使用。Windows Vista 的增强安全性（称为用户帐户控制或 UAC）会阻止以前的实现按预期工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-04T13:30:22.923

因为它是记事本窗口内的一个编辑子窗口。您应该将消息发送到右侧子窗口。这是 C 中的一个工作示例：

```
#include <windows.h>
#include <stdio.h>

void main(void) {
    STARTUPINFO si;
    PROCESS_INFORMATION pi;
    HWND mainwnd,editwnd;
    char c;
    si.cb=sizeof(si);
    si.lpReserved=NULL;
    si.lpDesktop=NULL;
    si.lpTitle=NULL;
    si.dwFlags=0;
    si.cbReserved2=0;
    si.lpReserved2=NULL;
    if(!CreateProcess("c:\\windows\\notepad.exe",NULL,NULL,NULL,FALSE,0,NULL,NULL,&si,&pi)) {
        printf("Failed to run app");
        return;
    }
    WaitForInputIdle(pi.hProcess,INFINITE);
    mainwnd=FindWindow(NULL,"Untitled - Notepad");
    if(!mainwnd) {
        printf("Main window not found");
        return;
    }
    editwnd=FindWindowEx(mainwnd,NULL,"Edit","");
    if(!editwnd) {
        printf("Edit window not found");
        return;
    }
    for(c='1';c<='9';c++) {
        PostMessage(editwnd,WM_CHAR,c,1);
        Sleep(100);
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-06-14T09:32:34.007

这里的解决方案帮助了我**，但**我不得不编辑它，现在它更短了：

[这里](http://www.kbdedit.com/manual/low_level_vk_list.html)还有一个有用的*虚拟键代码列表*

```
 [DllImport("user32.dll")]
        public static extern IntPtr FindWindow(string lpClassName, string lpWindowName);

        [DllImport("user32.dll")]
        static extern bool PostMessage(IntPtr hWnd, UInt32 Msg, int wParam, int lParam);

        private void button1_Click(object sender, EventArgs e)
        {
            const int WM_SYSKEYDOWN = 0x0104;

            IntPtr WindowToFind = FindWindow(null, "Calculator");

            PostMessage(WindowToFind, WM_SYSKEYDOWN, ((int)Keys.NumPad7), 0);
        } 
```

# c - 在 C 中使用 WEXITSTATUS 宏而不是在 exit() 状态下除以 256 有什么好处？

> ID：808541
> 
> 赞同：15
> 
> 时间：2009-04-30T19:04:24.940
> 
> 标签：c, exit, system-calls

我正在为大学做一个练习，我必须在退出时返回一个值，该值实际上是一个计数。这可能高于 255（exit() 无法处理），但老师建议使用计数永远不会超过该值的测试数据。

毕竟，我需要处理这个计数值，退出状态，我通过使用waitpid（）在主进程中获取了这个值。令我惊讶的是，如果子进程返回 1，则主进程中的“真实”值是 256，2 是 512，依此类推......

我需要打印这个值，所以我简单地将它除以 256 就完成了。但是，如果我使用 WEXITSTATUS() 宏，我也会以我想要的方式获得这个值......

我查看了 C 源代码，这就是我发现的：

```
#define __WEXITSTATUS(status) (((status) & 0xff00) >> 8) 
```

我知道这里发生了什么，例如，二进制的 512 是 10 0000 0000，向右移动 8 位将得到 00 0000 0010，即十进制的 2。我在这个宏中不明白的是 & 运算符以及 0xff00 似乎是一个随机数的事实（它可能不是，它来自哪里？）。这究竟是做什么的，为什么宏中有“& 0xff00”？没有它就不行吗？

这个主题的真正问题是，在我的代码中调用这个宏与除以 256 是一样的吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-30T20:50:58.570

> 这个主题的真正问题是，在我的代码中调用这个宏与除以 256 是一样的吗？

它可能总是在子进程正常终止的情况下工作（即，通过调用exit()，而不是通过分段错误、断言失败等）。

存储的状态`waitpid()`编码子进程终止的原因和退出代码。原因存储在最低有效字节中（由 获得`status & 0xff`），退出代码存储在下一个字节中（由 屏蔽`status & 0xff00`和提取`WEXITSTATUS()`）。当进程正常终止时，原因为0，因此`WEXITSTATUS`仅相当于移位8（或除以256）。但是，如果进程被信号（如 SIGSEGV）杀死，则没有退出代码，您必须使用`WTERMSIG`从原因字节中提取信号号。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-01T01:06:33.290

如果状态变量是一个有符号的 16 位整数（一个 'short'）在机器上 'int' 是一个 32 位数量，并且如果退出状态在 128..255 范围内，那么 WEXITSTATUS() 仍然给你一个正确的值，除以 256 或简单地向右移动会给你一个不正确的值。

这是因为 short 将被符号扩展为 32 位，并且屏蔽会撤消符号扩展，从而在结果中留下正确的（正）值。

如果机器使用 16 位整数，那么 WEXITSTATUS() 中的代码可能会先移位然后掩码以确保类似的行为：

```
#define WEXITSTATUS(status) (((status)>>8) & 0xFF) 
```

正是因为实现为您处理了这些细节，您应该使用 WEXITSTATUS() 宏。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-02-03T22:45:25.757

据我通过检查 Single Unix Spec 得知，*您的*系统恰好将退出状态存储在倒数第二个八位字节中，但我不相信[标准](http://pubs.opengroup.org/onlinepubs/9699919799/functions/wait.html)会这样做。因此，您应该至少出于以下几个原因使用宏：

*   他们是正确的。位移负数在不同的平台上做不同的事情。它是否按照您想要的方式工作？我不知道。
*   它们很简单。它立即清楚做什么`WEXITSTATUS`。其他方法则更少。如果你看到手卷版的`WIFSIGNALED`，你会认出来吗？需要多长时间`WIFSIGNALED`。
*   它们是便携式的。既然规范是这样说的，它就可以在每个系统上工作（至少几乎每个类 Unix 系统）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T19:29:36.907

这里 0xff00 是一个二进制掩码（[链接文本](http://en.wikipedia.org/wiki/Mask_(computing))）。将其与一个值进行与会将所有位设置为零，除了第二个字节（从右数）。

您应该只`WEXITSTATUS`在已知正常退出的进程上使用。该信息由`WIFEXITED`宏给出。

> 这个主题的真正问题是，在我的代码中调用这个宏与除以 256 是一样的吗？

该宏使代码更具可读性，并且保证可以在任何符合 Posix 的实现上工作。据我所知，Posix 没有指定状态的格式，所以你不能指望你的代码在任何地方都能工作。

# sql - Linq to SQL - 如何在 InsertOnSubmit() 之后查找 IDENTITY 列的值

> ID：808544
> 
> 赞同：18
> 
> 时间：2009-04-30T19:04:51.990
> 
> 标签：sql, linq, linq-to-sql, identity-column

我正在使用**LINQ to SQL**将简单数据插入到没有`stored procedure`. 该表有一个主键 ID 列，该`IDENTITY`列`SQL Server`在 my 和`DBML`.

首先我调用`InsertOnSubmit();`单行的数据，然后调用`SubmitChanges();`将行提交到数据库。但我认为必须有一种简单的方法来检索`IDENTITY`新插入行的行列值。我不希望向`IDENTITY`数据库提供列值，我希望它为我生成一个。

这个怎么处理最好？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-30T19:15:11.950

这是一个简单的代码片段

```
 Dim odb As New DataClassesDataContext
            Dim tst As New test
            tst.name = "abcd"
            odb.tests.InsertOnSubmit(tst)
            odb.SubmitChanges()
            Response.Write("id:" + tst.id.ToString) 
```

因此，基本上您在 InsertOnSubmit 中使用的对象将在数据库中创建记录后填充标识字段

# ms-access - 如何使用 ACCESS VBA 读取 mpp 文件

> ID：808545
> 
> 赞同：0
> 
> 时间：2009-04-30T19:05:06.593
> 
> 标签：ms-access, ms-project

有没有办法从 ACCESS VBA 读取 MS 项目（mpp 文件）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T20:25:52.170

呵呵，需要完整阅读。希望[这](http://support.microsoft.com/kb/97699)仍然会有所帮助。

# ruby-on-rails - 使用 Rails 的完全自定义验证错误消息

> ID：808547
> 
> 赞同：271
> 
> 时间：2009-04-30T19:05:29.587
> 
> 标签：ruby-on-rails

使用 Rails 我试图在保存时收到一条错误消息，例如“歌曲字段不能为空”。执行以下操作：

```
validates_presence_of :song_rep_xyz, :message => "can't be empty" 
```

... 只显示“Song Rep XYW can't be empty”，这不好，因为该字段的标题对用户不友好。如何更改字段本身的标题？我可以更改数据库中字段的实际名称，但我有多个“歌曲”字段，我确实需要有特定的字段名称。

我不想破解 Rails 的验证过程，我觉得应该有办法解决这个问题。

* * *

## 回答 #1

> 赞同：451
> 
> 时间：2010-05-18T16:43:10.650

现在，设置人性化名称和自定义错误消息的公认方法是[使用 locales](http://guides.rubyonrails.org/i18n.html#translations-for-active-record-models)。

```
# config/locales/en.yml
en:
  activerecord:
    attributes:
      user:
        email: "E-mail address"
    errors:
      models:
        user:
          attributes:
            email:
              blank: "is required" 
```

现在，“email”属性的人性化名称*和*存在验证消息已更改。

可以为特定模型+属性、模型、属性或全局设置验证消息。

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2012-03-05T16:42:59.703

在您的模型中：

```
validates_presence_of :address1, message: 'Put some address please' 
```

在你看来

```
<% m.errors.each do |attr, msg|  %>
 <%= msg %>
<% end %> 
```

如果你这样做

```
<%= attr %> <%= msg %> 
```

您会收到带有属性名称的错误消息

```
address1 Put some address please 
```

如果您想获取单个属性的错误消息

```
<%= @model.errors[:address1] %> 
```

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2009-04-30T20:03:05.767

试试这个。

```
class User < ActiveRecord::Base
  validate do |user|
    user.errors.add_to_base("Country can't be blank") if user.country_iso.blank?
  end
end 
```

我在[这里](http://lindsaar.net/2008/4/23/tip-14-custom-error-messages-in-validations)找到了这个。

Rails 3 到 6 的更新：

```
validate do |user|
  user.errors.add(:base, "Country can't be blank") if user.country_iso.blank?
end 
```

这是另一种方法。您所做的是在模型类上定义一个 human_attribute_name 方法。该方法将列名作为字符串传递，并返回要在验证消息中使用的字符串。

```
class User < ActiveRecord::Base

  HUMANIZED_ATTRIBUTES = {
    :email => "E-mail address"
  }

  def self.human_attribute_name(attr)
    HUMANIZED_ATTRIBUTES[attr.to_sym] || super
  end

end 
```

上面的代码来自[这里](http://henrik.nyh.se/2007/12/change-displayed-column-name-in-rails-validation-messages)

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2011-02-18T22:23:29.617

是的，有一种方法可以在没有插件的情况下做到这一点！但它不像使用提到的插件那样干净和优雅。这里是。

假设它是 Rails 3（我不知道它在以前的版本中是否不同），

将此保留在您的模型中：

```
validates_presence_of :song_rep_xyz, :message => "can't be empty" 
```

在视图中，而不是离开

```
@instance.errors.full_messages 
```

就像我们使用脚手架生成器时一样，输入：

```
@instance.errors.first[1] 
```

您将只获得您在模型中指定的消息，没有属性名称。

解释：

```
#returns an hash of messages, one element foreach field error, in this particular case would be just one element in the hash:
@instance.errors  # => {:song_rep_xyz=>"can't be empty"}

#this returns the first element of the hash as an array like [:key,"value"]
@instance.errors.first # => [:song_rep_xyz, "can't be empty"]

#by doing the following, you are telling ruby to take just the second element of that array, which is the message.
@instance.errors.first[1] 
```

到目前为止，我们只显示一条消息，总是针对第一个错误。如果您想显示所有错误，您可以在哈希中循环并显示值。

希望有帮助。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2011-08-18T13:34:15.730

带有完全本地化消息的 Rails3 代码：

在模型 user.rb 中定义验证

```
validates :email, :presence => true 
```

在 config/locales/en.yml

```
en:  
  activerecord:
    models: 
      user: "Customer"
    attributes:
      user:
        email: "Email address"
    errors:
      models:
        user:
          attributes:
            email:
              blank: "cannot be empty" 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2012-05-17T12:40:09.317

在自定义验证方法中使用：

`errors.add(:base, "Custom error message")`

因为 add_to_base 已被弃用。

`errors.add_to_base("Custom error message")`

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2016-10-26T05:17:30.063

与已[接受的答案](https://stackoverflow.com/a/2859275/365218)和[列表中的另一个答案](https://stackoverflow.com/a/809011/365218)相关：

我确认[nanamkim 的 custom-err-msg 分支](https://github.com/nanamkim/custom-err-msg)适用于 Rails 5 和语言环境设置。

您只需要使用插入符号开始区域设置消息，并且它不应该在消息中显示属性名称。

一个模型定义为：

```
class Item < ApplicationRecord
  validates :name, presence: true
end 
```

具有以下内容`en.yml`：

```
en:
  activerecord:
    errors:
      models:
        item:
          attributes:
            name:
              blank: "^You can't create an item without a name." 
```

`item.errors.full_messages`将显示：

```
You can't create an item without a name 
```

而不是通常的`Name You can't create an item without a name`

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2009-04-30T20:52:58.813

我建议安装最初由 David Easley 编写的[custom_error_message gem](https://github.com/jeremydurham/custom-err-msg)（或作为[插件）](http://github.com/gumayunov/custom-err-msg/tree/master)

它使您可以执行以下操作：

```
validates_presence_of :non_friendly_field_name, :message => "^Friendly field name is blank" 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2017-04-22T23:21:03.827

一种解决方案可能是更改 i18n 默认错误格式：

```
en:
  errors:
    format: "%{message}" 
```

默认为`format: %{attribute} %{message}`

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2015-10-22T23:35:13.023

这是另一种方式：

如果您使用此模板：

```
<% if @thing.errors.any? %>
  <ul>
    <% @thing.errors.full_messages.each do |message| %>
      <li><%= message %></li>
    <% end %>
  </ul>
<% end %> 
```

您可以像这样编写自己的自定义消息：

```
class Thing < ActiveRecord::Base

  validate :custom_validation_method_with_message

  def custom_validation_method_with_message
    if some_model_attribute.blank?
      errors.add(:_, "My custom message")
    end
  end 
```

这样，因为有下划线，完整的消息变成了“我的自定义消息”，但开头的多余空格并不明显。如果您真的不希望在开头有多余的空间，只需添加该`.lstrip`方法。

```
<% if @thing.errors.any? %>
  <ul>
    <% @thing.errors.full_messages.each do |message| %>
      <li><%= message.lstrip %></li>
    <% end %>
  </ul>
<% end %> 
```

String.lstrip 方法将摆脱由 ':_' 创建的额外空间，并保持任何其他错误消息不变。

或者更好的是，使用自定义消息的第一个单词作为键：

```
 def custom_validation_method_with_message
    if some_model_attribute.blank?
      errors.add(:my, "custom message")
    end
  end 
```

现在完整的消息将是“我的自定义消息”，没有多余的空间。

如果您希望完整消息以“URL 不能为空白”之类的大写单词开头，则无法完成。而是尝试添加一些其他单词作为键：

```
 def custom_validation_method_with_message
    if some_model_attribute.blank?
      errors.add(:the, "URL can't be blank")
    end
  end 
```

现在完整的消息将是“URL 不能为空”

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2011-11-24T14:26:12.427

只需按正常方式进行即可：

```
validates_presence_of :email, :message => "Email is required." 
```

但改为这样显示

```
<% if @user.errors.any? %>
  <% @user.errors.messages.each do |message| %>
    <div class="message"><%= message.last.last.html_safe %></div>
  <% end %>
<% end %> 
```

退货

```
"Email is required." 
```

本地化方法绝对是执行此操作的“正确”方法，但是如果您正在做一个小的非全局项目并且想要快速进行 - 这绝对比文件跳跃更容易。

我喜欢它能够将字段名称放在字符串开头以外的位置：

```
validates_uniqueness_of :email, :message => "There is already an account with that email." 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-06-23T15:05:28.807

如果您想将它们全部列出在一个不错的列表中，但不使用粗俗的非人类友好名称，您可以这样做......

```
object.errors.each do |attr,message|
  puts "<li>"+message+"</li>"
end 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-08-02T11:01:08.363

这是我的代码，如果您仍然需要它，它可能对您有用：我的模型：

```
validates :director, acceptance: {message: "^Please confirm that you are a director of the company."}, on: :create, if: :is_director? 
```

然后我创建了一个助手来显示消息：

```
module ErrorHelper
  def error_messages!
    return "" unless error_messages?
    messages = resource.errors.full_messages.map { |msg|
       if msg.present? && !msg.index("^").nil?
         content_tag(:p, msg.slice((msg.index("^")+1)..-1))
       else
         content_tag(:p, msg)
       end
    }.join

    html = <<-HTML
      <div class="general-error alert show">
        #{messages}
      </div>
    HTML

    html.html_safe
  end

  def error_messages?
    !resource.errors.empty?
  end
end 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-12-02T09:59:29.663

在你看来

```
object.errors.each do |attr,msg|
  if msg.is_a? String
    if attr == :base
      content_tag :li, msg
    elsif msg[0] == "^"
      content_tag :li, msg[1..-1]
    else
      content_tag :li, "#{object.class.human_attribute_name(attr)} #{msg}"
    end
  end
end 
```

当您想覆盖没有属性名称的错误消息时，只需在消息前面加上 ^ ，如下所示：

```
validates :last_name,
  uniqueness: {
    scope: [:first_name, :course_id, :user_id],
    case_sensitive: false,
    message: "^This student has already been registered."
  } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-12-03T23:08:35.507

我尝试了以下，为我工作:)

1 个工作.rb

```
class Job < ApplicationRecord
    validates :description, presence: true
    validates :title, 
              :presence => true, 
              :length => { :minimum => 5, :message => "Must be at least 5 characters"}
end 
```

2个jobs_controller.rb

```
def create
      @job = Job.create(job_params)
      if @job.valid?
        redirect_to jobs_path
      else
        render new_job_path
      end     
    end 
```

3 _form.html.erb

```
<%= form_for @job do |f| %>
  <% if @job.errors.any? %>
    <h2>Errors</h2>
    <ul>
      <% @job.errors.full_messages.each do |message|%>
        <li><%= message %></li>
      <% end %>  
    </ul>
  <% end %>
  <div>
    <%= f.label :title %>
    <%= f.text_field :title %>
  </div>
  <div>
    <%= f.label :description %>
    <%= f.text_area :description, size: '60x6' %>

  </div>
  <div>
    <%= f.submit %>
  </div>
<% end %> 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-11-22T10:20:13.683

> 我还没有看到任何人提到的独特方法！

我能够获得所有我想要的自定义的唯一方法是使用`after_validation`回调来允许我操纵错误消息。

1.  允许正常创建验证消息，您无需尝试在验证助手中更改它。

2.  创建一个`after_validation`回调，该回调将在后端中替换该验证消息，然后再到达视图。

3.  在该`after_validation`方法中，您可以对验证消息做任何您想做的事情，就像普通字符串一样！您甚至可以使用动态值并将它们插入到验证消息中。

* * *

```
#this could be any validation
validates_presence_of :song_rep_xyz, :message => "whatever you want - who cares - we will replace you later"

after_validation :replace_validation_message

def replace_validation_message
    custom_value = #any value you would like
    errors.messages[:name_of_the_attribute] = ["^This is the replacement message where 
    you can now add your own dynamic values!!! #{custom_value}"]
end 
```

after_validation 方法的范围比内置的 rails 验证助手要大得多，因此您将能够访问您正在验证的对象，就像您尝试使用 object.file_name 一样。这在您尝试调用它的验证助手中不起作用。

注意：`^`正如@Rystraum 指出引用这个[gem ，我们在验证开始时使用删除属性名称](https://github.com/nanamkim/custom-err-msg)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-01-16T20:21:08.730

graywh 的答案是最好的，如果它在显示字段名称时实际语言环境不同。在动态字段名称的情况下（基于要显示的其他字段），我会做这样的事情

```
<% object.errors.each do |attr, msg| %>
<li>
  <% case attr.to_sym %>
  <% when :song_rep_xyz %>
    <%= #display error how you want here %>
  <% else %>
    <%= object.errors.full_message(attr, msg) %>
  <% end %>
</li>
<% end %> 
```

else 上的 full_message 方法是 rails 在 full_messages 方法中使用的方法，因此它会在其他情况下给出正常的 Rails 错误（Rails 3.2 及更高版本）

# ruby-on-rails - 调试 Rails 控制器进行太多查询

> ID：808553
> 
> 赞同：1
> 
> 时间：2009-04-30T19:06:28.900
> 
> 标签：ruby-on-rails, ruby, debugging, logging

我有一个大约 3 岁的 Rails 应用程序，但我的页面查询过多时遇到问题。加载的每个页面都有几行如下所示：

```
ReqTdsLink Columns (1.0ms)   SHOW FIELDS FROM `req_tds_links` 
```

什么样的方法调用会在日志中导致此输出？我找不到任何之前的过滤器，或者应用程序控制器中可能导致这种情况的任何其他东西，但我还没有检查所有视图（数量上是天文数字）我想之前有一些特定的东西要查找我开始手动扫描每个文件以查找可能导致此问题的内容。

谢谢，

-C

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T21:28:47.637

您是在开发模式还是生产模式下运行？

`SHOW FIELDS FROM foo`正如您所指出的，由您的模型完成，因此它知道要生成哪些访问器方法。

在开发模式下，每个请求都会这样做，因此您不需要经常重新加载您的网络服务器，但在生产模式下，即使您运行的是三年前的 Rails 版本，这些信息也应该被缓存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T19:51:25.983

这由 ActiveRecord 从数据库中读取模型的属性来调用。它不会在生产中多次发生，但在开发模式下，Rails 每次都会查询表以了解可能发生的任何更改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-01T21:58:08.227

如果您再次遇到此类问题并且需要跟踪查询是如何被调用的，我建议您使用查询跟踪插件：http: [//github.com/ntalbott/query_trace/tree/master](http://github.com/ntalbott/query_trace/tree/master)。它将堆栈跟踪添加到每个 SQL 查询的日志中。非常便利。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T20:46:26.240

这条线实际上来自调用模型，我在应用程序控制器中有一个看起来像 [Model1, Model2, Model3] 的数组，我将它更改为看起来像 ['Model1','Model2', 'Model3'] 并且修复了所有额外的电话。

# java - SWT 布局问题 - 可以填充标签吗？

> ID：808556
> 
> 赞同：4
> 
> 时间：2009-04-30T19:07:01.173
> 
> 标签：java, user-interface, swt

我在我的 SWT GUI 应用程序中使用 GridLayout。我为每个网格单元定义了以下 GridData。网格单元本身只是一个标签。

```
 GridData gridData = new GridData();
    gridData.horizontalAlignment = GridData.FILL;
    gridData.grabExcessHorizontalSpace = true;
    gridData.grabExcessVerticalSpace = true;
    gridData.heightHint = 25;
    gridData.widthHint = 25;
    gridData.verticalAlignment = GridData.VERTICAL_ALIGN_CENTER;
    gridData.verticalIndent = 10; 
```

我像这样创建每个标签元素 -

```
 Label l = new Label(shell, SWT.BORDER);
    l.setAlignment(SWT.CENTER);
    l.setText("some text");
    l.setLayoutData( gridData ); 
```

现在我的问题是，尽管在标签本身上使用了 verticalAlignment 属性、verticalIndent 属性和 setAlignment，但我无法使文本相对于网格单元区域（ 25 x 25 ）垂直居中对齐。我想我错过了一些东西。如何在网格单元中实现垂直居中对齐？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-11-30T02:12:52.783

CL标签？你为什么不使用它？

```
CLabel cl = new CLabel(shell, SWT.CENTER);
cl.setBounds(0, 0, 100, 100);
cl.setText("Custom Label!!!"); 
```

甚至，您可以使用 leftMargin、rightMargin、topMargin、bottomMargin。

（三年后我很抱歉）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T23:37:03.240

Label 上没有 setVerticalAlignment() ，如果您使用 LayoutData 中的 heightHint 设置高度，它将成为控件的大小，并有效地阻止您将其设置在中间。一种解决方法是将 Label 放入具有所需大小的组合中，然后将控件居中。例如

```
Composite labelCell = new Composite(shell, SWT.BORDER);
GridData gridData = new GridData();
gridData.heightHint = 250;
gridData.widthHint = 250;
labelCell.setLayoutData(gridData);
labelCell.setLayout(new GridLayout());
Label l = new Label(labelCell , SWT.NONE);
l.setText("some text");
l.setLayoutData(new GridData(SWT.CENTER, SWT.CENTER, true, true)); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-03-12T08:20:11.577

这个问题我也纠结过。`Label`不支持填充。我最后`StyledText`改用了。

```
final StyledText text = new StyledText(parent, SWT.WRAP);
final int padding = 5;

text.setLeftMargin(padding);
text.setRightMargin(padding);
text.setTopMargin(padding);
text.setBottomMargin(padding);

text.setWordWrap(true);
text.setCaret(null); 
```

这对我有用。

# linux - 如何检测网线/连接器的物理连接状态？

> ID：808560
> 
> 赞同：154
> 
> 时间：2009-04-30T19:08:08.037
> 
> 标签：linux, networking, connection, detection

在 Linux 环境中，我需要检测 RJ45 连接器与其插座的物理连接或断开状态。最好只使用 BASH 脚本。

以下已在其他站点上提出的解决方案不适用于此目的：

1.  使用“ifconfig” - 因为可能连接了网络电缆，但网络未正确配置或当前未启动。
2.  Ping 主机 - 因为产品将在 LAN 中使用未知的网络配置和未知的主机。

/proc 文件系统中是否没有某些状态可以使用（其他所有内容都在其中）？

Linux 世界如何假设有他们自己版本的 Windows 气泡，它会从图标托盘中弹出，表明您刚刚拔掉了网络电缆？

* * *

**肯特弗雷德里克**和**洛塔尔**，你的两个答案都满足了我的需要......非常感谢！我会用哪一个……我还是不知道。

我想我不能把你们两个都当作正确答案？我确实选择了一个，这对你来说可能是公平的。我猜掷硬币？再次，谢谢！

* * *

## 回答 #1

> 赞同：241
> 
> 时间：2009-04-30T19:17:51.647

你想看看节点

```
/sys/类/网/

```

我用我的实验：

电线插入：

```
eth0/carrier:1
eth0/operstate:unknown 
```

拆线：

```
eth0/carrier:0
eth0/operstate:down 
```

再次插入电线：

```
eth0/carrier:1
eth0/operstate:up 
```

[小技巧：一次收获所有属性的简单方法：]

```
grep "" eth0/* 
```

这形成了一个很好的 `key:value`对列表。

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2009-04-30T19:17:07.797

您可以使用[ethtool](http://linux.about.com/od/commands/l/blcmdl8_ethtool.htm)：

```
$ sudo ethtool eth0
Settings for eth0:
    Supported ports: [ TP ]
    Supported link modes:   10baseT/Half 10baseT/Full
                            100baseT/Half 100baseT/Full
                            1000baseT/Full
    Supports auto-negotiation: Yes
    Advertised link modes:  10baseT/Half 10baseT/Full
                            100baseT/Half 100baseT/Full
                            1000baseT/Full
    Advertised auto-negotiation: Yes
    Speed: 1000Mb/s
    Duplex: Full
    Port: Twisted Pair
    PHYAD: 0
    Transceiver: internal
    Auto-negotiation: on
    Supports Wake-on: umbg
    Wake-on: g
    Current message level: 0x00000007 (7)
    Link detected: yes 
```

要仅获取链接状态，您可以使用 grep：

```
$ sudo ethtool eth0 | grep Link
    Link detected: yes 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2012-09-05T21:13:07.717

使用“ip monitor”获取实时链接状态更改。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2011-11-01T14:51:36.137

`cat /sys/class/net/ethX`是迄今为止最简单的方法。

接口必须启动，否则您将收到无效参数错误。

所以首先：

```
ifconfig ethX up 
```

然后：

```
cat /sys/class/net/ethX 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-11-01T15:25:10.450

在底层，可以使用[rtnetlink](http://www.kernel.org/doc/man-pages/online/pages/man7/rtnetlink.7.html)套接字捕获这些事件，无需任何轮询。旁注：如果您使用 rtnetlink，则必须与 udev 一起工作，否则当 udev 重命名新的网络接口时，您的程序可能会混淆。

使用 shell 脚本进行网络配置的问题在于**shell 脚本对于事件处理**（例如插入和拔出网络电缆）非常糟糕。如果您需要更强大的功能，请查看我的[NCD 编程语言](http://code.google.com/p/badvpn/wiki/NCD)，这是一种专为网络配置而设计的编程语言。

例如，一个简单的 NCD 脚本将打印“cable in”和“cable out”到标准输出（假设接口已经启动）：

```
process foo {
    # Wait for device to appear and be configured by udev.
    net.backend.waitdevice("eth0");
    # Wait for cable to be plugged in.
    net.backend.waitlink("eth0");
    # Print "cable in" when we reach this point, and "cable out"
    # when we regress.
    println("cable in");   # or pop_bubble("Network cable in.");
    rprintln("cable out"); # or rpop_bubble("Network cable out!");
                           # just joking, there's no pop_bubble() in NCD yet :)
} 
```

（内部`net.backend.waitlink()`使用 rtnetlink，`net.backend.waitdevice()`使用 udev）

NCD 的想法是您专门使用它来配置网络，因此通常配置命令会介于两者之间，例如：

```
process foo {
    # Wait for device to appear and be configured by udev.
    net.backend.waitdevice("eth0");
    # Set device up.
    net.up("eth0");
    # Wait for cable to be plugged in.
    net.backend.waitlink("eth0");
    # Add IP address to device.
    net.ipv4.addr("eth0", "192.168.1.61", "24");
} 
```

需要注意的重要部分是允许执行*倒退*；在第二个例子中，例如，如果电缆被拔出，IP 地址将自动被删除。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-08-29T23:27:41.303

存在两个检测这些事件的守护进程：

**ifplugd**和**netplugd**

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-08-19T05:59:54.303

我使用这个命令来检查电线是否连接：

```
cd /sys/class/net/
grep "" eth0/operstate 
```

如果结果将向上或向下。有时显示未知，则需要检查

```
eth0/carrier 
```

它显示 0 或 1

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-30T19:16:30.903

大多数现代 Linux 发行版为此使用[NetworkManager 。](http://projects.gnome.org/NetworkManager/)您可以使用 D-BUS 来监听事件。

如果你想要一个命令行工具来检查状态，你也可以使用`mii-tool`，因为你有以太网。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-11-18T13:38:22.887

### 一些精度和技巧

1.  我作为*普通用户*（不是*root*）做这一切

2.  从获取信息`dmesg`

    使用是查询系统**当前状态**`dmesg`的第一件事：

     **```
    dmesg | sed '/eth.*Link is/h;${x;p};d' 
    ```

    可以回答如下：

    ```
    [936536.904154] e1000e: eth0 NIC Link is Down 
    ```

    或者

    ```
    [936555.596870] e1000e: eth0 NIC Link is Up 100 Mbps Full Duplex, Flow Control: Rx/Tx 
    ```

    根据状态，消息可能会因使用的硬件和驱动程序而异。

    注意：这可以写`dmesg|grep eth.*Link.is|tail -n1`，但我更喜欢使用`sed`.

    ```
    dmesg | sed '/eth.*Link is/h;${x;s/^.*Link is //;p};d'
    Up 100 Mbps Full Duplex, Flow Control: Rx/Tx

    dmesg | sed '/eth.*Link is/h;${x;s/^.*Link is //;p};d'
    Down 
    ```** 
***   围绕`/sys`伪文件系统进行测试

    阅读或写作`/sys`可能会破坏您的系统，特别是如果以*root*身份运行！您已被警告；-)

    这是一种池化方法，而不是真正的*事件跟踪*。

    ```
    cd /tmp
    grep -H . /sys/class/net/eth0/* 2>/dev/null >ethstate
    while ! read -t 1;do
        grep -H . /sys/class/net/eth0/* 2>/dev/null |
            diff -u ethstate - |
            tee >(patch -p0) |
            grep ^+
      done 
    ```

    可以呈现类似的东西（一旦你拔掉并插回去，取决于）：

    ```
    +++ -   2016-11-18 14:18:29.577094838 +0100
    +/sys/class/net/eth0/carrier:0
    +/sys/class/net/eth0/carrier_changes:9
    +/sys/class/net/eth0/duplex:unknown
    +/sys/class/net/eth0/operstate:down
    +/sys/class/net/eth0/speed:-1
    +++ -   2016-11-18 14:18:48.771581903 +0100
    +/sys/class/net/eth0/carrier:1
    +/sys/class/net/eth0/carrier_changes:10
    +/sys/class/net/eth0/duplex:full
    +/sys/class/net/eth0/operstate:up
    +/sys/class/net/eth0/speed:100 
    ```

    （点击`Enter`退出循环）

    注意：这需要`patch`安装。

    *   好吧，这一定已经有什么东西了……

    根据*Linux 安装*，您可以添加能够对此类事件做出反应的脚本`if-up`。`if-down`

    *基于Debian*（如*Ubuntu*），您可以将脚本存储到

    ```
    /etc/network/if-down.d
    /etc/network/if-post-down.d
    /etc/network/if-pre-up.d
    /etc/network/if-up.d 
    ```

    查看`man interfaces`更多信息。** 

 *** * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-10-06T12:06:11.980

在拱 linux 上。（我不确定在其他发行版上）您可以查看操作状态。如果连接则显示，如果不存在则显示关闭

```
/sys/class/net/(interface name here)/operstate
#you can also put watch 
watch -d -n -1 /sys/class/net/(interface name here)/operstate 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-12-14T00:10:54.337

您*可以*使用 ifconfig。

```
# ifconfig eth0 up
# ifconfig eth0 
```

如果条目显示 RUNNING，则接口已物理连接。无论是否配置了接口，都会显示此信息。

这只是获取信息的另一种方式`/sys/class/net/eth0/operstate`。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-01-31T21:25:36.530

```
tail -f /var/log/syslog | grep -E 'link (up|down)' 
```

或者对我来说更快得到：

```
tail -f /var/log/syslog | grep 'link \(up\|down\)' 
```

它将监听 syslog 文件。

结果（如果断开连接并在 4 秒后再次连接）：

```
Jan 31 13:21:09 user kernel: [19343.897157] r8169 0000:06:00.0 enp6s0: link down
Jan 31 13:21:13 user kernel: [19347.143506] r8169 0000:06:00.0 enp6s0: link up 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-10-28T00:42:42.927

不知何故，如果您想检查以太网电缆是否在推荐后插入linux：“ifconfig eth0 down”。我找到了解决方案：使用 ethtool 工具。

```
#ethtool -t eth0
The test result is PASS
The test extra info:
Register test  (offline)         0
Eeprom test    (offline)         0
Interrupt test (offline)         0
Loopback test  (offline)         0
Link test   (on/offline)         0 
```

如果连接了电缆，则链路测试为 0，否则为 1。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-03-08T13:41:22.083

此命令在“ip a”命令的第二个界面中检查“状态 UP”。我已经检查了 2 台运行 wifi 的计算机，列出的第二台是有线以太网。如果您想检查不同的接口，只需将下面命令中的“2”更改为正确的索引位置。

```
astate=`ip a | grep -E -o -m 1 "2:.*state UP"`  
if [ -n "$astat" ]; then
   echo 'cable is on'
else
   echo 'cable is off'
fi 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-10-06T16:30:45.003

在 OpenWRT 上，至少对我而言，可靠地做到这一点的唯一方法是运行以下命令：

```
# Get switch name
swconfig list

# assuming switch name is "switch0"
swconfig dev switch0 show | grep link:

# Possible output
root@OpenWrt:~# swconfig dev switch0 show | grep link:
        link: port:0 link:up speed:1000baseT full-duplex txflow rxflow
        link: port:1 link:up speed:1000baseT full-duplex txflow rxflow eee100 eee1000 auto
        link: port:2 link:up speed:1000baseT full-duplex txflow rxflow eee100 eee1000 auto
        link: port:3 link:down
        link: port:4 link:up speed:1000baseT full-duplex eee100 eee1000 auto
        link: port:5 link:down
        link: port:6 link:up speed:1000baseT full-duplex txflow rxflow 
```

这将在交换机的每个端口上显示“link:down”或“link:up”。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2019-01-13T00:51:07.880

我将我的 OpenWRT 增强型设备用作中继器（它添加了虚拟以太网和无线局域网功能），发现 /sys/class/net/eth0 运营商和 opstate 值不可靠。我玩弄了 /sys/class/net/eth0.1 和 /sys/class/net/eth0.2 以及（至少在我的发现）没有可靠的方法来检测是否有东西被物理插入并正在谈论任何东西的以太网端口。我想出了一种粗略但看似可靠的方法来检测至少自上次重新启动/开机状态以来是否插入了任何东西（在我的情况下，这完全符合我的需要）。

```
ifconfig eth0 | grep -o 'RX packets:[0-9]*' | grep -o '[0-9]*' 
```

如果自上次开机或重新启动循环以来没有插入任何东西，则如果没有插入任何东西（即使已插入并且已移除），您将获得 0 和大于 0 的值。

希望这至少可以帮助某人！

# c# - 以编程方式触发 ListView.SelectedIndexChanged 事件？

> ID：808569
> 
> 赞同：4
> 
> 时间：2009-04-30T19:10:40.200
> 
> 标签：c#, winforms, listview, selectedindexchanged

如何以编程方式触发 ListView 的 SelectedIndexChanged 事件？

我打算让我的 ListView 中的第一项在用户完成某个操作后自动被选中。SelectedIndexChanged 事件中已存在用于突出显示所选项目的代码。不仅该项目无法突出显示，而且在 SelectedIndexChanged 中设置的断点也永远不会被命中。此外，Debug.WriteLine 无法产生输出，所以我相当确定该事件没有触发。

以下代码无法触发事件：

```
listView.Items[0].Selected = false;
listView.Items[0].Selected = true;
listView.Select();
Application.DoEvents(); 
```

额外的 .Select() 方法调用被包括在内以进行良好的测量。;) 取消选择 (.Selected = false) 用于取消选择 .Items 集合中的 ListViewItem，以防它可能已被默认选中，因此将其设置为“true”将无效。'Application.DoEvents()' 调用是另一种最后的方法。

上面的代码不应该导致 SelectedIndexChanged 事件触发吗？

我应该提到，当通过键盘或鼠标输入选择项目时，SelectedIndexChanged 事件会正确触发。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T19:17:48.420

为什么不能将当前在事件处理程序方法中的代码移动到可以从原始位置以及代码中调用的方法中？

像这样的东西：

```
class Foo
{
    void bar(Object o, EventArgs e)
    {
        // imagine this is something important
        int x = 2;
    }

    void baz()
    {
        // you want to call bar() here ideally
    }
} 
```

将被重构为：

```
class Foo
{
    void bar(Object o, EventArgs e)
    {
        bop();
    }

    void baz()
    {
        bop();
    }

    void bop()
    {
        // imagine this is something important
        int x = 2;
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T19:18:32.317

如果创建派生类`ListView`，则可以调用受保护的方法[`OnSelectedIndexChanged`](http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.onselectedindexchanged.aspx)。这将触发`SelectedIndexChanged`事件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T19:21:20.547

通过将其设置为 false 来取消选择它不会触发事件，但将其设置为 true 会。

```
 public Form1 ()
    {
        InitializeComponent();
        listView1.Items[0].Selected = false; // Doesn't fire
        listView1.Items[0].Selected = true; // Does fire.
    }

    private void listView1_SelectedIndexChanged (object sender, EventArgs e)
    {
        // code to run
    } 
```

你可能有其他事情发生。你在运行你的选择代码是什么事件？

# apache-flex - Flex：单步执行代码时无法监控应用程序

> ID：808572
> 
> 赞同：0
> 
> 时间：2009-04-30T19:12:12.630
> 
> 标签：apache-flex, debugging

能够在单步执行代码时监控我的应用程序对我来说非常有益，这样我就可以查明是哪个步骤导致屏幕上的某些事情发生了。但是，每当我单步执行代码时，浏览器看起来都是空白的。有谁知道在您逐步执行代码时是否可以查看您的应用程序？如果这很重要，我正在使用 Firefox。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T19:14:28.567

您的系统上是否安装了 Flash 播放器的调试版本（它可能已被覆盖/损坏）。您在使用 Flex Builder 吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-02T01:00:47.837

......这就是它的工作原理。您可能希望在查看应用程序的同时查看[KapInspect以获得一些调试支持。](http://labs.kapit.fr/display/kapinspect/Kap+Inspect)

# ruby-on-rails - 是否可以从您的代码中启动 Rails 控制台？

> ID：808580
> 
> 赞同：0
> 
> 时间：2009-04-30T19:13:45.200
> 
> 标签：ruby-on-rails, debugging, console

我知道 ruby​​ gem“ruby-debug”，它允许你在你的代码中放置一个**调试器**调用。使用它，您的代码中可能会有断点。

我在一些测试中使用了一些**脚本/控制台**，我想知道我是否可以从我的代码中调用它。

谢谢 ！

编辑：

这是一些示例红宝石代码

```
 require "ruby-debug"

[1,2,3,4,5].each do |item|
   if item == 2
      # this starts a irb-like shell from which you can step through your code
      debugger 
   end
end 
```

我想实现同样的目标，但使用 rails 控制台。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T19:18:44.140

在调试时，您可以键入`irb`以打开控制台。除此之外，我不确定我明白你的意思......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T08:09:10.400

我认为唯一的方法是在代码中添加**调试器**语句。

# sql-server - SQL Server 2005 和防病毒软件

> ID：808581
> 
> 赞同：-1
> 
> 时间：2009-04-30T19:13:45.527
> 
> 标签：sql-server, sql-server-2005, performance, antivirus

我们的网络人员坚持在所有服务器上安装防病毒 (eTrust) 软件，包括我们所有的 SQL Server 2005 机器。我怎样才能最好地证明这会损害性能？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T19:43:39.790

如果您失去了没有在计算机上安装 eTrust 的论点，我不会感到惊讶。

我建议而不是反对安装它，建议他们制定正确的排除规则，以便不会扫描极不可能感染病毒的数据库和进程。

这应该可以忽略 eTrust 对性能的影响。（如果它是一个好产品，我从未使用过它。）

请查看此文档，第 98 页：[eTrust antiVirus](http://www.colorado.edu/its/security/antivirus/files/AV_Implemenation_ENU.pdf)

这应该让您了解如何正确配置它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T19:23:19.823

首先，您必须确定它*正在*损害性能。当然，最清晰的方法是创建一个测试套件，您可以在其中评估 TPS 性能。如果没有多个应用程序运行相当苛刻的事务套件或多线程应用程序，您将很难做到这一点。你可能想谷歌 SQL Server、“测试”和“TPS”，看看是否有任何商业产品可以帮助你（我不知道有）。如果您正在推出自己的测试套件，我建议您从 redgate 软件获取“SQL 响应”的副本来进行性能监控。

防病毒软件本身将主要通过内存消耗和网络连接监控来影响性能。WRT 网络问题，许多防病毒包在端口 1433 上寻找 Helkorn 攻击（Helkorn 是一种流行的蠕虫 - 谷歌它 - 端口 1433 是 SQL Server 的侦听端口），因此您可能会看到一些您在其他地方看不到的防病毒网络问题。更重要的是，如果您想记录防病毒软件的缺点，我会寻找初始连接时间延迟。但是，您还应该记住，在*没有*防病毒的情况下飞行会使您更容易受到 Helkorn 的攻击，因此您需要采取措施降低风险。

在内存方面，SQL Server 在完全加载时非常消耗内存。在这里，您需要查看防病毒软件的内存占用是否有任何影响。老实说，我有我的怀疑。WRT CPU，我怀疑你会看到很多不同；特别是如果您在非工作时间安排全面扫描。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T20:01:14.710

一种比较快速的测试方法是使用 2 个虚拟盒子。事实上，您实际上可以将它们设置在同一个物理盒子上。让他们都开始某种冗长的 SQL 插入/查询/删除/等。看哪一个先完成。如果存在显着差异，则可以证明您的假设。

我的岳父是一名科学老师，我所听到的只是科学方法。做一个假设，检验你的假设。

让我们知道会发生什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T19:21:20.483

在运行 eTrust 之前和之后对服务器进行基准测试。您可以通过分析访问服务器的应用程序以及在服务器本身上运行的进程来做到这一点。创建可以在这两种情况下进行测试的查询。获得绩效矩阵后，您可以将其提交给管理/网络人员。

# html - 本地主机上的 w3c html 检查器

> ID：808587
> 
> 赞同：5
> 
> 时间：2009-04-30T19:14:46.240
> 
> 标签：html, css

我想知道是否有一个程序可以检查我是否有每个 html 标记项的开始和结束标记。我使用 Dreamweaver cs3，当标记出现问题时，标签会改变颜色，但它并不总是准确的。我想知道是否有某种方法可以将开始和结束标签放入树视图中，而不必在 Dreamweaver 的树视图中打开和关闭每个标签。

所以显示如下：

```
+<div id="abc">
| some html
| some html
| some html
| some html
+</div>

+<div id="def">
| some html
| some html
| some html
| some html
+</div> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T19:17:34.097

尝试将 Eclipse 与 Aptana 插件一起使用，它具有非常可靠的代码突出显示功能。

有点无关紧要，如果您正在进行 W3C 验证，请使用 FF Web 开发者插件并使用 ctrl+shift+a 作为快捷方式来验证本地代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T19:21:45.523

好吧，我不知道这是否是你想要的，但我个人使用这个“HTML Validator”Firefox 扩展。[https://addons.mozilla.org/en-US/firefox/addon/249](https://addons.mozilla.org/en-US/firefox/addon/249)

这将验证您的代码的开始和结束标记等等。它几乎可以根据 W3C 标准检查它是否有效。

如果你想要的是 HTML 语法高亮，NetBeans 有一个很好的，并且支持许多服务器端编程语言。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T19:40:08.270

[HTML 整洁](http://tidy.sourceforge.net/)？

你也可以在你的系统上[安装](http://validator.w3.org/docs/install.html)W3C 的验证器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T19:24:52.037

正如 Mike 提到的，Eclipse 可以很好地工作。我仍然更喜欢 linux 下的“VI 或 VIM”编辑器。缩进和格式化功能将非常有用。

如果您想在本地机器上安装 W3c 验证器，请尝试安装[Xampp 包](http://www.apachefriends.org/en/xampp-windows.html)（因为它与 Apache、Php、Mysql 捆绑在一起），然后安装[W3c 验证器](http://www.obsidianproject.co.uk/phpw3cvalidator)。它适用于任何操作系统。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T19:22:51.060

我不确定你在找什么。使用 Firefox 的[Firebug](http://getfirebug.com/)扩展将显示当前页面的树形视图。

如果您正在寻找具有语法突出显示的文本编辑器，则可以使用适用于 windows 的[Notepad++](http://notepad-plus.sourceforge.net/uk/site.htm)。对于 linux，gedit 具有语法高亮功能。当然 vim 和 emacs 可用于一切。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T19:29:53.617

我使用[HAML](http://haml.hamptoncatlin.com/)，现在我再也不用关闭标签了。此外，除了 Firefox 扩展之外，您还有用于 Safari 的[SafariTidy](http://zappatic.net/safaritidy/)插件，它将检查您的所有标签。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T19:40:13.747

你会发现[Tidy](http://tidy.sourceforge.net/)对你很有帮助。或者使用[w3c的在线](http://w3.org)[验证](http://validator.w3.org/)器。

# c# - 可编辑的列表视图

> ID：808588
> 
> 赞同：23
> 
> 时间：2009-04-30T19:14:49.033
> 
> 标签：c#, winforms, user-interface, listview

我希望在 C# winforms 应用程序中创建一个可编辑的 ListView，用户可以在其中双击单元格以更改其内容。如果有人可以为我提供一些指导和/或示例，那就太好了。我不打算使用任何商业产品。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-30T19:20:53.310

你问错问题了：）

ListView 不是正确的控件。使用[DataGridView](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.aspx)控件。它可以配置为看起来像 ListView，但它支持单元格的就地编辑。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T07:04:43.543

ObjectListView将完全[做到](http://objectlistview.sourceforge.net)这一点以及更多。它是一个普通的 .NET ListView 的包装器。它是开源的。

它的网站有一个[入门](http://objectlistview.sourceforge.net/cs/gettingStarted.html)帮助你开始，以及一个专门用于[单元格编辑的页面](http://objectlistview.sourceforge.net/cs/cellEditing.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T19:22:53.647

从它的声音来看，您可能需要考虑改用 DataGridView。

[数据网格视图 (MSDN)](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-20T20:46:04.750

您可以使用列表视图的 DoubleClick 事件，当它被调用时，您将打开一个新表单，用户将在其中输入所选项目的新值。然后，当用户按下确定时，您可以将特定项目的值编辑为用户输入的值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-27T16:31:47.680

DataGridView 是你的朋友 SourceGrid 是替代品

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-06T15:48:36.957

您可以使用 DataTemplate 指定该列包含文本框（如果可编辑）或文本块（如果不可编辑），然后将文本框绑定到绑定到列表视图项目源的源对象集合中的类属性。

```
<Window.Resources>
    <ResourceDictionary>
        <DataTemplate x:Key="NameHeader">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Name" VerticalAlignment="Center" Margin="10,0,0,0" />
            </StackPanel>
        </DataTemplate>
        <DataTemplate x:Key="NameCell">
            <StackPanel Orientation="Horizontal">
                <TextBox Text="{Binding Path=Name}" VerticalAlignment="Center" Margin="10,0,0,0" />
            </StackPanel>
        </DataTemplate>
    </ResourceDictionary>
</Window.Resources>

<Grid>
    <ListView x:Name="lvwList" Height="200" VerticalAlignment="Top" ItemsSource="{Binding Path=SourceObjectCollection}">
        <ListView.View>
            <GridView>
                <GridViewColumn Header="Name" HeaderTemplate="{StaticResource NameHeader}" CellTemplate="{StaticResource NameCell}" Width="140" />
            </GridView>
        </ListView.View>
    </ListView>
</Grid> 
```

尼克·汉肖

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-04-24T23:20:28.583

是的，使用 DataGridView。

您不仅可以编辑单元格，而且如果您声明一个通用列表，其中 T 是您要在网格中显示的类，您可以设置 DataSource=该列表，当您编辑 gridview 时，您实际上是在自动编辑列表！

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-04-30T20:00:23.107

也许这可以帮助你：

[msdn：如何使用可编辑单元格创建 ListView](http://msdn.microsoft.com/en-us/library/ms745183.aspx)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2013-03-20T17:38:00.867

我最近遇到了这个问题。在从 Simon Gillbee 那里得到提示后，可以将 DataGridView 配置为看起来很像 ListView，我搜索了一个明智的解决方案来实现这一点。以下代码对我来说效果很好。[来源在这里](http://social.msdn.microsoft.com/forums/en-US/winforms/thread/141aef69-b7c4-412f-a067-bc4bce011167/)。

```
class GridLineDataGridView : DataGridView
{
    public GridLineDataGridView()
    {
        this.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.Fill;
    }

    protected override void OnPaint(PaintEventArgs e)
    {
        base.OnPaint(e);

        int rowHeight = this.RowTemplate.Height;

        int h = this.ColumnHeadersHeight + rowHeight * this.RowCount;
        int imgWidth = this.Width - 2;
        Rectangle rFrame = new Rectangle(0, 0, imgWidth, rowHeight);
        Rectangle rFill = new Rectangle(1, 1, imgWidth - 2, rowHeight);
        Rectangle rowHeader = new Rectangle(2, 2, this.RowHeadersWidth - 3, rowHeight);

        Pen pen = new Pen(this.GridColor, 1);

        Bitmap rowImg = new Bitmap(imgWidth, rowHeight);
        Graphics g = Graphics.FromImage(rowImg);
        g.DrawRectangle(pen, rFrame);
        g.FillRectangle(new SolidBrush(this.DefaultCellStyle.BackColor), rFill);
        g.FillRectangle(new SolidBrush
           (this.RowHeadersDefaultCellStyle.BackColor), rowHeader);

        int w = this.RowHeadersWidth - 1;
        for (int j = 0; j < this.ColumnCount; j++)
        {
            g.DrawLine(pen, new Point(w, 0), new Point(w, rowHeight));
            w += this.Columns[j].Width;
        }

        int loop = (this.Height - h) / rowHeight;
        for (int j = 0; j < loop + 1; j++)
        {
            e.Graphics.DrawImage(rowImg, 1, h + j * rowHeight);
        }
    }
} 
```

只需继承`DataGridView`并覆盖该`OnPaint`方法。

您可以更改控件的各种属性以满足您的需要和偏好。

对于那些在将自定义控件合并到他们的项目中需要帮助的人，请看[这里](http://msdn.microsoft.com/en-us/library/7h62478z%28v=vs.80%29.aspx)。

# .net - 用于接收 .NET 平台的传真的库

> ID：808596
> 
> 赞同：0
> 
> 时间：2009-04-30T19:17:24.440
> 
> 标签：.net, api, fax

你能推荐一个可以接收传真的 .NET 库吗？窗口传真服务器是不够的 - 需要根据传入的呼叫者 ID 在收到传真后自动处理和路由传真。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T19:26:32.330

你能使用一个自动将传真路由到电子邮件的系统，然后让你的 .NET 代码只处理电子邮件吗？这会将您的处理与传真方面分开。除了其他任何事情之外，这将使测试变得更容易和更便宜。

它可能不是处理传真的最有效方式，但它很实用。

# php - 如何优化 ruby 中的网站加载时间？

> ID：808601
> 
> 赞同：0
> 
> 时间：2009-04-30T19:17:58.900
> 
> 标签：php, ruby-on-rails, ruby, cakephp, rubygems

我是一个新手，正在使用 RoR.i 计划使用来自 scriptalicious 库的效果以及用于照片显示和过渡效果的 jquery 创建一个用 cake php 框架编写的轻量级照片展示网站。

由于该网站的照片非常丰富，我可以采取哪些编程步骤来确保所有照片和其他页面都能快速加载？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T22:18:11.573

我认为你把事情搞混了一点。ror 与 php/cake 混合？

所以，关于性能。这主要取决于您认为您将拥有多少用户，这些用户是谁以及他们做什么。每小时 10 次还是每秒 100 次？他们是长时间看图像还是快速地从一页跳到另一页？

这里有一些技术性不太强的技巧。没有服务器配置优化，没有 memcached 等等。开始用常识思考性能——这不是圣杯！

*   **您的网站/应用程序是否太慢？**大多数情况下，情况并非如此。*加速它从来没有什么坏处，但人们通常过于*关心性能。永远记住：这不是关于快，而是关于*足够快*。没有人注意到一些额外的毫秒。如果您的页面需要一秒钟来加载，50% 的加速是显而易见的，但如果它只需要 100 毫秒，则几乎无关紧要。

*   要确定您的网站是否运行缓慢，请对其进行**基准测试**。有很多方法可以做到这一点，一种是自动化的，比如`ab`（apache benchmark）。它模拟了许多用户连接到您的网站，并为您提供了一个很好的总结，它需要多长时间才能响应。另一个是：使用它。而不是在本地网络中！如果你觉得它很慢，那就做点什么。

*   照片展示在很大程度上取决于图像。图片很大。因此，请确保您的服务器有足够的**带宽**来快速交付它们。

*   如果您缩放图像（这很可能），请不要在每个页面请求上调整图像大小，**缓存**缩放图像！也缓存缩略图。缓存一切。处理和交付静态文件比不断地进行所有处理要便宜得多。

*   考虑图像的质量。快速交付比高图像质量更重要吗？调整**图像大小**——更好的压缩意味着更小的文件大小、更低的质量和更快的交付。

*   想想**可用性**。如果没有缩略图页面，人们必须按顺序浏览您的图库，查看很多他们不想看到的照片。如果他们已经看到图像，他们可以直接跳转到那些重要的（降低带宽使用和每秒请求）。想想flickr：显示的图像的大小......它们就像邮票 - 500 像素宽，人们仍然很开心。如果他们需要更大的版本，他们无论如何都会点击“所有尺寸”链接。

*   **技巧，技巧，技巧**：早些时候，当用户使用模式冲浪时，有时会传输低分辨率/高压缩图像，因此用户在短时间内就有了一些东西。只有在加载第一张图像后，更大的版本开始。这已经不常见了，因为今天大多数用户都有宽带，所以发送额外的图像只是额外的工作量。

*   想想**观众**。他们会用 14.4k 调制解调器或宽带访问您的网站吗？他们是否习惯于缓慢加载网站（可能是摄影师）？检查您的统计数据以了解它们。

*   您的*后端脚本语言*很可能不是您的问题。php 不是很快，ruby 也不是很快 - 与 c 或 java 或 ocaml 相比。框架比手工优化的代码慢。调试您的代码以查看慢速部分在哪里。我猜？图像大小调整和数据库访问。切换到另一种语言或优化代码时，这不会改变。

### 关于网站的速度

涉及的因素很多。他们之中有一些是：

1.  服务器端处理：您的应用程序快吗，您的硬件快吗？

2.  交付：请求和文件从客户端传输到服务器的速度有多快，反之亦然？（取决于带宽）

3.  客户端渲染：他们的浏览器有多快，需要完成多少工作？

4.  用户习惯：客户端还需要速度吗？有时，慢速页面是没有问题的，例如，如果他们在那里呆了很长时间而没有点击。想想 Flash 游戏网站：如果您花一个小时玩 Flash 游戏，您可能甚至不会注意到页面是否在 3 或 5 秒内加载。

感知速度 - 所有四种的混合 - 是重要的指标。

如果你已经确认你真的太慢了​​，一定要优化正确的部分。如果服务器足够快，优化服务器端脚本是没有用的，但是页面需要很长时间才能在浏览器上呈现。如果您的带宽被阻塞，则无需优化渲染时间。

### 关于优化

在构建应用程序时，性能是不可或缺的一部分。如果你真的需要快速的东西，你必须从一开始就计划好速度。如果它不是为速度而设计的，则通常无法进行有效的优化。

对于 Web 应用程序来说并非总是如此，因为它们很容易水平扩展，这意味着：向它扔硬件。
所有事情都需要钱，如果钱对你（或你的老板）很重要，不要忘记它。两周优化应用程序的成本是多少？比如说，优化你（或你的老板）X 欧元（我是欧洲人）的薪水。现在，考虑购买另一台服务器：花费 Y 欧元（包括安装）。如果 Y < X，只需购买服务器就可以了。

### 随机流行语

最后但并非最不重要的一点是，我会向您抛出一些随机（无序）的流行语，也许有些东西可能会有所帮助。只是谷歌，这应该有帮助......

内容交付网络、（英特尔）SSD、精灵（组合图像以保存请求）、页面压缩（gzip、deflate）、memcached、APC（PHP 字节码缓存）、多个 CSS 和 JS 文件的压缩和合并、有意识地处理 HTTP状态代码（未更改），静态和动态内容分离（不同的服务器和域），通过 AJAX 逐步加载（重要内容优先），...

现在我没有想法了。

### 编辑/更新

我忘记的事情/技术：

*   实现一个进度条或类似的东西，让用户至少感觉到正在发生的事情。如果仅使用 javascript，则不能使用进度条，但至少显示某种动画沙漏或时钟。如果你使用flash，你可以显示一个真实的进度条。

*   您可以通过使用 AJAX 或 flash 来跳过完整的页面重新加载 - 只需加载您需要的数据。您经常会在 Flash 图片库中看到此功能。只需加载图像和描述。

*   预加载：如果用户长时间查看一个图像，您已经可以开始加载下一个图像，因此如果用户继续，它将被浏览器缓存。

### 免责声明

我从未实现过性能关键型应用程序（有 2 个例外），所以我上面写的大部分内容都是猜测和其他人的经验。今天，您阅读了有关成功初创公司的故事，以及他们如何应对（从性能方面）从每天 100 名到数十亿用户的情况，以及他们如何一直使用巧妙的技巧来解决所有这些问题。
但这会发生在你身上吗？可能不是。每个人都在谈论它，几乎没有人真正需要它*（但我承认，知道它仍然很好）*。

我的真实世界经验（是的，我喜欢写长答案）：

有一次我做了一个网站的一部分，每天有几千个独立访问者，由 cms (typo3) 提供支持并在一个专用的 samp-server 上运行（想想使用过的、十年前的 solaris 服务器，*而不是 ghz*！）。您可以搜索公寓，表格会告诉您通过重新加载 iframe *ON-CLICK*可以获得多少结果（例如 20-40 平方米：400 次点击，30-60 平方米：600 次点击） 。它非常非常慢（但用户仍然使用它）。持续 100% 负载。解决这个问题是我的工作。
我做了什么？首先，找出它为什么这么慢。我的第一个猜测是正确的，点击请求*也是*使用了typo3（当然，没有缓存）。通过用一个直接查询数据库的自定义脚本替换这个单个操作，绕过typo3，问题就解决了。负载几乎为零。花了我大约2个小时。

另一个项目每天有大约 1500 名唯一访问者，显示由 Oracle 数据库提供的数据，其中包含数百万行和需要永远（=几秒钟）运行的复杂连接。我在优化 oracle 方面没有太多经验，但我知道：数据库每周只更新一到两次。我的解决方案：我只是通过将 html 写入文件系统来缓存内容。更新后（在半夜）我清除了缓存并开始重建它。所以，我只需要廉价的文件系统读取，而不是昂贵的查询。问题解决了。

both examples taught me that performance in web developement is *not* rocket science. most of the time the solution is simple. and: there are other parts that are way more important 99% of the time: **developer cost** and **security**.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T19:50:08.077

这个问题很模糊。获取页面所花费的大部分时间通常是获取静态内容。以下是一些独立于语言或框架加快加载时间的经验法则：

1.  安装Firefox的[YSlow 插件](http://developer.yahoo.com/yslow/)
2.  使用 CSS 精灵
3.  有一个用于静态内容、[nginx](http://nginx.net/)或[lighttpd的轻量级 http 服务器](http://www.lighttpd.net/)
4.  在不同的域或子域上提供静态内容，这允许更多的同时 http 请求
5.  缩小 javascript 和 css
6.  尽可能多地缓存页面
7.  保持较低的 http 请求数
8.  在图像上运行[pngcrush](http://pmt.sourceforge.net/pngcrush/)或 jpegtran

当然，这只是冰山一角。这些是很好的第一步。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T19:38:28.743

减少库的数量，你确定要使用 jquery + scriptalicious。坚持简单的事情，不要寻找复杂的动画。

快速加载 => 缓存，带有照片的页面非常适合缓存。

如果您担心的是用户速度感觉，您可能希望在后台预加载图像以预期用户操作，但认为这可能会增加您的服务器负载。仅当您拥有良好的带宽合同时才执行此操作。

如果您能够制作一个非常静态的拇指首页，比如每天更改两次，您可以使用精灵技术来减少加载许多拇指的延迟，请参阅：

[http://websitetips.com/articles/css/sprites/](http://websitetips.com/articles/css/sprites/)

# c# - 我如何从我的主窗体访问课程？

> ID：808608
> 
> 赞同：0
> 
> 时间：2009-04-30T19:19:04.360
> 
> 标签：c#

我只是过去几天才接触 C# 事实上。我从大学得到了一个项目，所以我虽然使用 c# 的操作系统。

在这种情况下，我正在做的是**从手机中读取短信，然后将它们放入文本文件中。** 我了解到我必须创建一个用于编写文件的类，所以我做了并将该类添加到我的表单中。现在我想访问并将字符串发送到该类以将其写入文本文件中。但我不知道该怎么做。如果有人可以直接帮助我，那么我可以将我的代码发送给他，或者如果有人可以给我发送一些指南链接，我会很高兴。

谢谢xA

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T19:28:00.157

这要容易得多。假设您有自己的表单并添加了一个文本框和一个按钮。双击按钮获取点击事件并使其看起来像这样。

```
private void button1_Click (object sender, EventArgs e)
{
    System.IO.File.WriteAllText("C:\File.txt", textBox1.Text);
} 
```

这将调用您可以直接调用的已编写的 File 类的 WriteAllText 方法。写入文件的文本位于 textBox1.Text 属性中。这里有很多东西要填写，但这是最简单的工作。

# javascript - 在 Internet Explorer 7 中鼠标悬停时模糊触发

> ID：808609
> 
> 赞同：0
> 
> 时间：2009-04-30T19:19:06.607
> 
> 标签：javascript, jquery, html, internet-explorer-7, onblur

我有一个弹出搜索框，当用户将鼠标悬停在超链接上时会显示该搜索框，当用户将鼠标移出搜索框时，该框就会消失。这工作正常。当文本框有焦点时，搜索框应该保持可见，直到文本框失去焦点，此时如果光标不在框上方，框将隐藏。这适用于除 IE 之外的所有浏览器（具体为 IE7）。在 IE 中，文本框的 blur 事件在文本框的 mouseout 时触发，有效地隐藏了搜索框。这是我写的代码：

```
<script type="text/javascript">
    $(document).ready(function() {
         //add mouseover event to the search button to show the search box
        $(".search").mouseover(
            function() {
                $(".open").show();
            });

        //add mouseout event to the search button to show the hide box
        $(".search").mouseout(
            function() {
                $(".open").hide();
            });

        //add mouseover event to the search box so it doesnt hide when the user attempts to click the box
        $(".open").mouseover(
            function() {
                $(".open").show();
            });

        //add mouseout event to the search box so it doesnt hides when the users mouse exits the box
        $(".open").mouseout(
            function() {
                $(".open").hide();
            });

        //don't ever hide the search box when the textbox has focus
        $("#tbSearch").focus(
            function() {
                $(".open").mouseout(
                    function() {
                        $(".open").show();
                    });
            });

        //hide the search box when the textbox loses focus
        $("#tbSearch").blur(
            function() {
                $(".open").hide();
                $(".open").mouseout(
                    function() {
                        $(".open").hide();
                    });
            });

    });
</script> 
```

这是HTML：

```
<a class="search" href="#"><span>Search</span></a>
<div class="open">
    <input id="tbSearch" type="text" />
    <a class="go" href="#"><span>Go</span></a>
</div> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T22:04:41.403

问题似乎是您正在重新绑定事件而不取消绑定它们。因此，最终会有多个事件触发显示和隐藏框，具体取决于焦点和模糊事件发生的次数。我不确定为什么由于某种原因它在 IE 中失败，但该解决方案似乎有太多的移动部件，因此很难准确判断它在哪里失败。

通过使用维护文本框状态（聚焦或模糊）的属性，我过去能够让这种类型的东西工作。试试这个：

```
<script type="text/javascript">

$(function() {

var showBox = function() {
    $(".open").show();
};
var hideBox = function() {
    if (!$(".open").attr("searching")) {
        $(".open").hide();
    }
};

$(".search").hover(showBox, hideBox);
$(".open").hover(showBox, hideBox).hide();

    $("#tbSearch").focus(function() {
    $(".open").attr("searching", "true");
    }).blur(function() {
    $(".open").removeAttr("searching");
    $(".open").hide();
});
});

</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-01T15:03:02.283

```
<script type="text/javascript">
    $(document).ready(function() {
         //add mouseover event to the search button to show the search box
        $(".search").bind('mouseenter mouseleave',function(){
                $(".open").toggle();
         });

        //add mouseover event to the search box so it doesnt hide when the user attempts to click the box
        $(".open").bind('mouseenter mouseleave',function(){
                $(".open").toggle();
        });

        //don't ever hide the search box when the textbox has focus
        $("#tbSearch").focus(function() {
                $(".open").show();
        });

        //hide the search box when the textbox loses focus
        $("#tbSearch").blur(
             $(".open").hide();
        });

    });
</script> 
```

# sql - 每个日期的 SQL 计数

> ID：808611
> 
> 赞同：31
> 
> 时间：2009-04-30T19:19:24.717
> 
> 标签：sql, tsql

我有以下需求

我有一个记录表，记录每天生成的 som 线索。

现在我需要提取过去 10 天内每天的潜在客户数量的报告。

假设表格如下所示：

```
tbl_leads
id int,
first_name nvarchar(100),
last_name nvarchar(100),
created_date datetime 
```

我需要计算每天的潜在客户数量，总共 10 天。所以结果集应该是这样的：

```
counted_leads | count_date
5             | 2009-04-30
7             | 2009-04-29
5             | 2009-04-28
7             | 2009-04-27 
```

... 等等

任何人都知道如何以最好的方式做到这一点？我当前的解决方案是在 c# 中使用 foreach 进行迭代，但我非常希望将它交给 sql server 而不是在 sp 中。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-30T19:22:07.770

您可以使用：

```
Select
     count(created_date) as counted_leads,
     created_date as count_date
from
     table
group by
     created_date 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-30T19:29:45.473

您的 created_date 字段是`datetime`，因此如果您想按日期进行分组，则需要去掉分组工作之前的时间：

```
SELECT COUNT(created_date), created_date 
FROM table 
WHERE DATEDIFF(created_date, getdate()) < 10
GROUP BY convert(varchar, created_date, 101) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T20:26:43.697

通过整数进行聚合然后转换回日期时间以进行演示是最有效的。

```
select 
    cast(daybucket - 1 as datetime) as count_date,
    counted_leads
from 
    (select 
         cast(created_date as int) as DayBucket,
         count(*) as counted_leads
     from mytable
     group by cast(created_date as int) ) as countByDay 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-05T17:25:05.627

当您将 DateTime 转换为它在中午“截断”的 int 时，您可能希望像这样去掉这一天

```
cast(DATEADD(DAY, DATEDIFF(DAY, 0, created_date), 0) as int) as DayBucket 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-09-26T18:56:16.943

我有类似的问题，但是我的问题涉及一个列 Convert(date,mydatetime)。我不得不将最佳答案更改如下：

```
Select
     count(created_date) as counted_leads,
     Convert(date,created_date) as count_date 
from table
group by Convert(date,created_date) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-30T19:25:33.500

```
Select count(created_date) total
     , created_dt
  from table
group by created_date
order by created_date desc 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-12-23T13:42:00.357

```
CREATE PROCEDURE [dbo].[sp_Myforeach_Date]
    -- Add the parameters for the stored procedure here
    @SatrtDate as DateTime,
    @EndDate as dateTime,
    @DatePart as varchar(2),
    @OutPutFormat as int 
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    Declare @DateList Table
    (Date varchar(50))

    WHILE @SatrtDate<= @EndDate
    BEGIN
    INSERT @DateList (Date) values(Convert(varchar,@SatrtDate,@OutPutFormat))
    IF Upper(@DatePart)='DD'
    SET @SatrtDate= DateAdd(dd,1,@SatrtDate)
    IF Upper(@DatePart)='MM'
    SET @SatrtDate= DateAdd(mm,1,@SatrtDate)
    IF Upper(@DatePart)='YY'
    SET @SatrtDate= DateAdd(yy,1,@SatrtDate)
    END 
    SELECT * FROM @DateList
END 
```

只需输入此代码并以这种方式调用 SP

```
exec sp_Myforeach_Date @SatrtDate='03 Jan 2010',@EndDate='03 Mar 2010',@DatePart='dd',@OutPutFormat=106 
```

谢谢 **[Suvabrata Roy ICRA Online Ltd. 加尔各答](http://mailto%3asuvabrataroy@gmail.com)**

# sql - 在单个查询中连接选定的列？

> ID：808613
> 
> 赞同：1
> 
> 时间：2009-04-30T19:20:19.770
> 
> 标签：sql, sql-server, select, concatenation

我知道你可以这样做，因为我以前看过一次，但我忘记了在哪里，直到现在我不需要这样做。

我有一个名为Employees 的表，它有各种员工数据（duh）。我需要一个查询，它将对表中所有行的名字和姓氏进行选择，然后将它们全部连接成一个逗号分隔的字符串。

例如，我有几行（实际上比这多得多，但为了这个问题，只假设两行）看起来像这样的数据：

```
FName LName
-------- -----
理查德·普雷斯科特
吉尔森提瑞
卡罗尔·温格
```

我需要一个可以以这种形式返回上述数据的选择：

```
理查德·普雷斯科特、吉尔·森提耶里、卡罗尔·温格
```

预先感谢您的帮助！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-30T19:29:01.027

使用合并。像这样的东西：

```
DECLARE @Names varchar(1000)
SELECT @Names = COALESCE(@Names + ', ', '') + Name
FROM Employees 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T22:22:53.607

这是我发现的最有效的方法。它需要 SQL Server，但听起来这就是您正在使用的。

```
select stuff((
    select ', ' + fName + ' ' + lName
    from Employees
    order by lName, fName /* Optional */
    for xml path('')
), 1, 2, ''); 
```

这个想法是，您可以利用将空标记名称与 for xml path('') 一起使用的能力来获取跨行的字符串连接。stuff(...,1,2,'') 只是删除了前导逗号。

这真的很快。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T19:27:29.207

你可以写一个UDF来做到这一点

```
CREATE FUNCTION [dbo].[fnc_GetEmpList](
@CompId numeric
) RETURNS nvarchar(1000)
BEGIN

declare @str nvarchar(1000)
set @str =''

select  @str = @str + ',' + FirstName + ' ' + LastName from Employees

--remove the last comma
if(@str<>'')
    set @str = right(@str,len(@str)-1)

return @str

END 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T19:28:58.733

也许这会有所帮助。这个问题以前有人问过。 [如何创建 SQL Server 函数以将子查询中的多行“加入”到单个分隔字段中？](https://stackoverflow.com/questions/6899/is-there-a-way-to-create-a-mssql-function-to-join-multiple-rows-from-a-subquery)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T19:35:10.047

如果你使用 MySQL，他们有一个很棒的函数 GROUP_CONCAT 可以做到这一点。[http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat](http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T19:36:38.577

这并不完美，但它会让你大部分时间到达那里

```
declare @count int
declare @i int
declare @string nvarchar(max)
declare @name nvarchar(100)

declare @Employees (EmpName nvarchar(100), ID int identity(1,1)

insert into @Employees (EmpName)
select FirstName + ' ' + LastName
from Employees

select @count=count(*) from @Employees
set @i=1
set @string=''

while (@i<=@count)
begin

    select @name = EmpName from @Employees where ID=@i

    set @string = @string + ',' + @name

    set @i=@i+1
end 
```

# vbscript - VBScript For Each 不起作用

> ID：808614
> 
> 赞同：4
> 
> 时间：2009-04-30T19:20:27.880
> 
> 标签：vbscript

我无法在 VBScript 中使用以下函数。我正在尝试获取文件夹中的所有文件并遍历它们以获取编号最高的文件。（文件名格式为 log_XXX.txt） 我遇到的问题是代码永远不会进入我的`For Each`循环。我是 VBScript 的新手，但我似乎不明白为什么这不起作用。

```
Function GetFileNumber(folderspec)
   Dim fso, f, f1, fc, s, tempHighNum
   Set fso = CreateObject("Scripting.FileSystemObject")
   Set f = fso.GetFolder(folderspec)
   WScript.Echo f.Files.Count : rem prints 3
   Set fc = f.Files
   WScript.Echo fc.Count : rem prints 3
   Set tempHighNum = "000"
   For Each f1 in fc
      WScript.Echo f1.Size : rem does not print
      WScript.Echo f1.Type : rem does not print
      WScript.Echo f1.Name : rem does not print       
      s = Right(f1.name,3)
      IF NOT(ISNULL(s)) THEN
        IF (s > tempHighNum) THEN
            tempHighNum = s
        END IF
      END IF
   Next
   GetFileNumber = tempHighNum
End Function 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-30T19:27:12.343

更改此行：

```
Set tempHighNum = "000" 
```

到以下：

```
tempHighNum = "000" 
```

您正在尝试将 tempHighNum 变量设置为字符串类型。因此，您不应使用*Set*关键字。 仅在将对象类型分配给变量时才需要*设置。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-07-12T03:32:15.557

我不确定你的脚本是如何工作的，所以我为你整理了这个 HTML 应用程序。它使用一个名为`Dir.Bat`位于的批处理文件，`C:\Batch`该文件生成一个名为`Data.Txt`位于`c:\Temp`. 然后脚本接管。该脚本逐行读取文件 Data.Txt。在读取每一行时，使用两个拆分语句来分隔文本文件名称中的字符串。之后，`ListCol`当我测试越来越大的数字时，我将那些包含数字的字符串收集到变量中。我终于得到了我放在原始变量中的最大数字`tempHighNum`. 我将发布 HTA 文件和 Dir.Bat 文件。我知道我没有将脚本编写为使用参数的函数，因此如果您确实需要使用参数，我将尝试通过更改 HTA 文件来帮助您，以便在 TextBox 中输入路径和文件名。这应该使它易于更改和使用。我添加并更改了一两件事以使其运行更顺畅。我不确定你的脚本是如何工作的，所以我为你整理了这个 HTML 应用程序。它使用一个名为`Dir.Bat`位于的批处理文件，`C:\Batch`它使一个名为`Data.Txt`位于的文件`c:\Temp`. 然后脚本接管。该脚本逐行读取文件 Data.Txt。在读取每一行时，使用两个拆分语句来分隔文本文件名称中的字符串。之后，`ListCol`当我测试越来越大的数字时，我将那些包含数字的字符串收集到变量中。我终于得到了我放在原始变量中的最大数字`tempHighNum`。我将发布 HTA 文件和 Dir.Bat 文件。我知道我没有将脚本编写为使用参数的函数，因此如果您确实需要使用参数，我将尝试通过更改 HTA 文件来帮助您，以便在 TextBox 中输入路径和文件名。这应该使它易于更改和使用。我添加并更改了一两件事以使其运行更顺畅。

```
<HTML><!-- C:\HTML_and_HTA_CODE_EXAMPLES\ATest.Hta -->
    <HEAD>
        <TITLE>ATest.Hta</TITLE>
        <HTA:APPLICATION ID="HTA MyApp" 
          APPLICATIONNAME="Help4Saul Dolgin"
          BORDER         ="thick"
          BORDERSTYLE    ="complex"
          CAPTION        ="yes"
          CONTEXTMENU    ="no"
          ICON           ="http://Your URL/your icon.ico"
          INNERBORDER    ="yes"
          MAXIMIZEBUTTON ="yes"
          MINIMIZEBUTTON ="yes"
          NAVIGABLE      ="no"
          SCROLL         ="no"
          SHOWINTASKBAR  ="yes"
          SINGLEINSTANCE ="yes"
          SYSMENU        ="yes"
          VERSION        ="1.0"
          WINDOWSTATE    ="Normal"/>
    </HEAD>
    <style>
        .ExBt21    {background:"#E0E0E0";Color:"red";}/* For Exit Button */
        .Spn4      {font-family:"arial";font-weight:"bold";Color:"blue"}
        .Spn2      {Color:"red"}
        .tAr1      {font-family:"arial";font-weight:"bold";Color:"blue"}
    </style>
    <SCRIPT Language="VBScript">
        Sub GetFileNumber
            Dim FSO, f, fc, tempHighNum, strLine, objSHO, line
            Dim DataArr, Data1Arr, Data2Arr, ListCol
            fc=""
            ListCol=""
            tempHighNum=000
            Set objSHO=CreateObject("WScript.Shell")
            objSHO.run "C:\Batch\Dir.bat"
            Set FSO = CreateObject( "Scripting.FileSystemObject" )
            Set f = FSO.OpenTextFile("c:\Temp\Data.Txt", "1")
            Do Until f.AtEndOfStream
            fc = fc & f.ReadLine & vbLf
            Loop
            tArea1.innerHTML=fc
            Data1Arr = Split(fc,vbLf)
            Count=UBound(Data1Arr)
            For x=0 To Count
            DataArr = Split(Data1Arr(x),".")
            If x <= Count-1 Then
                Data2Arr = Split(DataArr(0),"_")
                ListCol = ListCol & Data2Arr(1) & vbLf
                If Data2Arr(1) > tempHighNum Then
                    tempHighNum = Data2Arr(1)
                End If
            End If
            Next 
            Span2.innerHTML=tempHighNum
        End Sub
        Sub ExtBtn:Window.close:End Sub' Exit Script For Window
    </SCRIPT>
    <BODY bgcolor="#D0D0D0">
        <button OnClick="GetFileNumber">Button To Press</button><br/>
        <span id="Span1" class="Spn1">The biggest No. is:&nbsp;</span><span id="Span2" class="Spn2"></span><br/><br/>
        <span Id="Span3" Class="Spn3">Dir.Bat looks in:&nbsp;</span><span Id="Span4" Class="Spn4">C:\Temp\Log_???.Txt</span><br/>
        <textarea Id="tArea1" class="tAr1" rows="10"></textarea><br/><br/>
        <input id="ExBtn21" class="ExBt21"  type="Button" name="ExitBtn21" OnClick="ExtBtn" value="&nbsp-Exit-&nbsp"/><!-- Exit Button -->
    </BODY>
</HTML> 
```

接下来是 Dir.Bat 文件：

```
@Echo Off
Dir/B c:\Temp\Log_???.Txt>c:\Temp\Data.Txt 
```

# algorithm - 排序算法稳定有什么好处？

> ID：808617
> 
> 赞同：45
> 
> 时间：2009-04-30T19:20:56.757
> 
> 标签：algorithm, sorting

如果排序保持具有相同键的元素的相对顺序，则称该排序是稳定的。我想我的问题是，保持这种相对顺序有什么好处？有人可以举个例子吗？谢谢。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-04-30T19:28:03.387

它使您的排序能够通过多个条件“链接”。

假设您有一张随机排列名字和姓氏的表格。如果您先按名字排序，然后按姓氏排序，则稳定的排序算法将确保具有相同姓氏的人按名字排序。

例如：

*   史密斯，阿尔弗雷德
*   史密斯，泽德

将保证按正确的顺序排列。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2009-04-30T19:25:51.630

> 如果排序算法保持重复键的顺序，则它是稳定的。
> 
> 好的，好的，但是为什么这很重要？好吧，当我们希望根据不同的键对相同的数据进行多次排序时，就会出现排序算法中的“稳定性”问题。
> 
> 有时数据项有多个键。例如，可能是一个（唯一的）主键，例如社会保险号或学生证号，以及一个或多个辅助键，例如居住城市或实验室部分。而且我们很可能希望根据不止一个键对这些数据进行排序。麻烦的是，如果我们按照一个key对相同的数据进行排序，然后再按照第二个key进行排序，那么第二个key可能会破坏第一个排序所达到的排序。但是，如果我们的第二个排序是稳定排序，则不会发生这种情况。

从[稳定的排序算法](http://cs.smu.ca/%7Eporter/csc/common_341_342/notes/sorts_stable.html)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-30T19:25:01.520

优先级队列就是一个例子。假设你有这个：

1.  （1，“鲍勃”）
2.  （3、“账单”）
3.  （1，“简”）

如果按从小到大的顺序排序，不稳定的排序可能会这样做。

1.  （1，“简”）
2.  （1，“鲍勃”）
3.  （3、“账单”）

...但随后“jane”领先于“bob”，尽管它应该是相反的。

通常，它们对于在多个步骤中对多个条目进行排序很有用。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-04-30T19:22:50.607

并非所有排序都基于整个值。考虑一份人员名单。我可能只想按他们的名字对他们进行排序，而不是他们的所有信息。使用稳定的排序算法，我知道如果我有两个名为“John Smith”的人，那么他们的相对顺序将被保留。

```
Last     First       Phone
-----------------------------
Wilson   Peter       555-1212
Smith    John        123-4567
Smith    John        012-3456
Adams    Gabriel     533-5574 
```

由于两个“John Smith”已经“排序”（它们按我想要的顺序排列），我不希望它们改变位置。如果我最后对这些项目进行排序，那么首先使用不稳定的排序算法，我最终可能会得到以下结果：

```
Last     First       Phone
-----------------------------
Adams    Gabriel     533-5574
Smith    John        123-4567
Smith    John        012-3456
Wilson   Peter       555-1212 
```

这就是我想要的，或者我可能会得到这个：

```
Last     First       Phone
-----------------------------
Adams    Gabriel     533-5574
Smith    John        012-3456
Smith    John        123-4567
Wilson   Peter       555-1212 
```

（您会看到两个“John Smith”交换了位置）。这不是我想要的。

如果我使用稳定的排序算法，我将保证得到第一个选项，这就是我所追求的。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-04-30T19:30:07.860

**一个例子：**

假设您有一个数据结构，其中包含成对的电话号码和打电话给他们的员工。每次通话后都会添加一个号码/员工记录。一些电话号码可能由几个不同的员工拨打。

此外，假设您想按电话号码对列表进行排序，并为拨打任何给定号码的前 2 个人提供奖金。

如果您使用不稳定的算法进行排序，您可能无法保留给定号码的呼叫者的顺序，并且可能会给错误的员工提供奖金。

稳定的算法可确保每个电话号码的正确 2 名员工获得奖金。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-04-30T19:27:54.150

这意味着如果您想按专辑和曲目编号排序，您可以先单击曲目编号，然后对其进行排序 - 然后单击专辑名称，曲目编号将保持每个专辑的正确顺序。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-04-30T19:27:40.407

一种情况是您想按多个键排序。例如，要对名字/姓氏对列表进行排序，您可以先按名字排序，然后按姓氏排序。

如果您的排序不稳定，那么您将失去第一种排序的好处。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-30T19:59:39.363

对多个键进行稳定排序的优势是可疑的，您始终可以使用一次比较所有键的比较。如果您一次对一个字段进行排序，这只是一个优势，例如单击列标题时 - [Joe Koberg](https://stackoverflow.com/questions/808617/what-is-the-benefit-for-a-sort-algorithm-to-be-stable/808658#808658)给出了一个很好的例子。

如果您有能力向记录添加序列号，并在出现等效键时将其用作平局断路器，则任何排序都可以转换为稳定排序。

当原始订单本身具有某种意义时，最大的优势就出现了。我想不出一个很好的例子，但我看到[JeffH](https://stackoverflow.com/questions/808617/what-is-the-benefit-for-a-sort-algorithm-to-be-stable/808668#808668)在我思考的时候这样做了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-06T06:05:08.773

您不能总是一次比较所有字段。举几个例子：（1）内存限制，你正在对一个大磁盘文件进行排序，主内存中没有空间容纳所有记录的所有字段；(2) 对基类指针列表进行排序，其中一些对象可能是派生的子类（您只能访问基类字段）。

此外，在给定相同输入的情况下，稳定排序具有确定性输出，这对于调试和测试非常重要。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-30T20:01:10.437

假设您正在对具有两个字段的输入集进行排序，并且您只对第一个字段进行排序。'|' 字符划分字段。

在输入集中，您有许多条目，但是，您有 3 个条目看起来像

. . . AAA|拖车。. . AAA|汽车租赁。. . AAA|管道。. .

现在，当您完成排序后，您希望其中包含 AAA 的所有字段都放在一起。

一个稳定的排序会给你：. . . AAA|拖车 AAA|汽车租赁 AAA|水暖。. .

即，具有相同排序键 AAA 的三个记录在输出中的顺序与它们在输入中的顺序相同。请注意，它们没有按第二个字段排序，因为您没有按记录中的第二个字段排序。

不稳定的排序会给你：. . . AAA|水暖 AAA|汽车租赁 AAA|拖车。. .

请注意，记录仍仅按第一个字段排序，并且第二个字段的顺序与输入顺序不同。

不稳定的排序有可能更快。稳定的排序倾向于模仿非计算机科学家/非数学人员在排序时的想法。即，如果您使用索引卡进行插入排序，您很可能会有一个稳定的排序。

# python - 使用 Python 解析文件

> ID：808621
> 
> 赞同：-3
> 
> 时间：2009-04-30T19:21:28.363
> 
> 标签：python, parsing, object

我应该使用哪种类型的 Python 对象来解析具有特定语法的文件？还有应该遵循什么样的循环才能通过文件。一次通过就足够了吗？二三？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T19:49:04.880

这取决于语法。您可以使用[pyparsing](http://pyparsing.wikispaces.com/)而不是实现自己的解析器。这是非常容易使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T19:27:09.830

你应该提供更多关于你的目标的信息......

*   什么样的文件
*   什么结构？制表符分开？XML - 像？
*   什么样的编码？
*   目标结构是什么？
*   您是否需要定期重新解析文件（如解释器）？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T19:25:32.970

语法有多复杂？你在发明一个新的吗？

对于复杂的语言，请考虑像 lex + pybison 这样的野牛绑定。

如果您可以决定使用什么语法，请尝试 YAML。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T19:27:21.267

如果您的解析器将有 1、2、3 或 n 遍，它不依赖于您的编程语言 (python)。这取决于您尝试解析的语法的语法。

如果语法足够复杂，我会推荐 LEX/YACC 组合，正如 Francis 所说。

# php - Gmail IMAP 电子邮件内容乱码

> ID：808631
> 
> 赞同：1
> 
> 时间：2009-04-30T19:23:46.797
> 
> 标签：php, gmail, imap

我有一个基于 Web 的自定义联系人管理系统，我们在 PHP 中构建它来跟踪联系人，并且最近开始使用 IMAP 检查我们的 Google 电子邮箱，然后，如果该联系人在我们的联系人管理系统中：

1.  将消息复制到与该联系人关联的 MySQL 数据库表中
2.  标记该联系人以在当天跟进
3.  在 Gmail 中归档邮件

一切似乎都运行良好，除了……每封这么多电子邮件，我们都会收到一条看起来像这样的非常乱码的消息：

FABRRRQAUUUUAJXDjxZrUtzNFa2UMwjYj5YnYgZ74Ndwa4bwfzqmpH3/wDZjTcl CnKdr2Fa7SJP+Ek8S/8AQJX/AMB5P8aZN4s162j33GmxxrnG54XUfqa6ysHxp/yA/wDtqv8AWuej jFUqKDgtSpQsr3L13r4tPDcOoShBcTxgog6FiP5CsrwtpjuzavekvcTZKFuwPf8AH+VZOlwS+Iby 1jlBFnZRKhGeDjt9Sf0Fd0qhVCqAABgA

我回去查看消息，它似乎只是文本，所以我不认为它是图像。知道如何防止这种情况吗？

提前致谢。

真挚地，

詹姆士

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T19:50:33.723

您提供的示例看起来像是 base64 编码的。电子邮件的标题将告诉您如何处理电子邮件的内容。

例如，以下定义了正文为纯文本的电子邮件消息，但其存储为 base64 编码。我已经“删除”了隐私敏感信息。

```
Received: from xxxxxxxxx ([xxx.xx.xx.xxx]) by xxxxxxxxxx.xxx.xxxxxxxxxxxxxxx.xxx with Microsoft SMTPSVC(6.0.3790.3959);
     Wed, 29 Apr 2009 21:29:16 +0000
Received: from xxxx-xxx-xxxxxx ([xxx.xx.xxx.xxxx]) by xxxxxxxx ; Wed, 29 Apr 2009 15:29:16
 -0600
Message-ID: <AADB29A7-AAED-4068-B4A8-300E3B0D93AB@localhost>
MIME-Version: 1.0
From: xxxxxxxxxx@xxxxxxxxxxxxxxx.com
To: xxxxxxxxxx@xxxxxxxxxxxxxxx.com
Date: 29 Apr 2009 15:29:16 -0600
Subject: xxxx Account Update
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: base64
Return-Path: xxxxxx@xxxxxxxx.com
X-OriginalArrivalTime: 29 Apr 2009 21:29:16.0374 (UTC) FILETIME=[8C63AF60:01C9C911] 
```

密切注意 Content-Type 和 Content-Transfer-Encoding 标头。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T19:55:59.810

我相信 IMAP 是通过 SSL 实现的，因此可能是与 IMAP 的连接不同步。我对此的最佳解决方案就是检查正文是否包含一个很长的单词。由于该乱码没有空格：

```
<?php
function wordlength($txt, $limit)
{
   $words = explode(' ', $txt);

   foreach($words as $v)
   {
       if(strlen($v) > $limit)
       {
            return false;
       }
   }

   return true;
}
?> 
```

用法：

```
<?php

$txt = "Message Body would be here";

if(!wordlength($txt, 45))
{
    //maybe try to pull the message again or
    //send an email to you telling you there is a problem
}

?> 
```

我选择了 45 个，以防有人在电子邮件中使用 Pneumonoultramicroscopicsilicovolcanoconiosis 这个词。:D

乔丹可能是对的。它可能只是 base64 编码。然后我会explode（）标题并搜索它，如果它在那里，一个简单的base64_decode（）就可以了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-04T22:07:22.167

这帮助我处理了一个乱码的电子邮件主题。 [http://php.net/manual/en/function.imap-header.php](http://php.net/manual/en/function.imap-header.php)

# android - Android - 停止循环 NEW_OUTGOING_CALL 事件？

> ID：808645
> 
> 赞同：3
> 
> 时间：2009-04-30T19:26:17.180
> 
> 标签：android, listener

我有一个`BroadcastReceiver`引人注目的`ACTION_NEW_OUTGOING_CALL`事件。

在`onReceive()`方法中，我将提供的号码发送到一个新`ListActivity`的，用户可以从列表中选择各种新的目的地号码。

当用户从列表中选择一个新号码时，我将`ACTION_CALL`在 URI 字段中使用新号码开始一个新的意图。或者，结果可能是原始数字。

无论新号码是什么，都必须立即拨打，而不是进一步处理。

我怎样才能`BroadcastReceiver`知道不应再次处理此结果数字？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-11-30T11:10:52.623

我通过在我的`BroadcastReceiver`. 如果我的客户端应用程序想直接呼叫一个号码，它只需在调用`ACTION_CALL`Intent 之前添加前缀。

如果拨打的号码具有（硬编码）前缀，则`BroadcastReceiver`去除前缀并允许呼叫正常进行：

```
public void onReceive(Context context, Intent intent)
{
    String action = intent.getAction();
    if (Intent.ACTION_NEW_OUTGOING_CALL.equals(action)) {
        String number = getResultData();
        if (number.startsWith(BYPASS_PREFIX)) {
             setResultData(number.substring(BYPASS_PREFIX.length()));
        } else {
             // do additional processing
        }
    }
} 
```

这一次性解决了两个问题 - 这不仅停止了呼叫循环，还为我提供了一种方法，通过将前缀存储在电话簿条目中来绕过特定号码的额外处理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-08-13T07:30:19.820

广播接收器中的 onReceive() 方法接收一个 Intent 作为参数。使用 Intent.getExtras() 从 Intent 中提取 Bundle。此 Bundle 包含 3 个键值对，如下所示：

1.  android.phone.extra.ALREADY_CALLED = null
2.  android.intent.extra.PHONE_NUMBER = **98xxxxxx98**
3.  android.phone.extra.ORIGINAL_URI = 电话：**98xxxxxx98**

**98xxxxxx98**是用户拨打的号码。

当再次调用 onReceive() 时，这个号码变为**98xxxxxx98***或**0*** 通过检查拨打号码末尾的星号(*)，可以推断是否是第一次调用 onReceive() 方法或接下来的时间。

# java - Lucene 性能：从 Searcher 中检索所有文档

> ID：808647
> 
> 赞同：1
> 
> 时间：2009-04-30T19:26:33.623
> 
> 标签：java, performance, lucene

我使用 NIOFSDirectory 索引了大约 1000 万个对象。

当我使用 MatchAllDocsQuery 检索文档时，性能明显低于其他类型的 Query，例如 BooleanQuery。我进行了一些测试，性能大约差了 100 倍。

因为无论如何我只对前 n 个文档感兴趣，有没有一种方法可以在不使用 MatchAllDocsQuery 的情况下从 Searcher 对象中检索它们？

我也在考虑在对象的随机属性上使用 WildcardQuery，但*Lucene in Action*声称存在与 WildcardQuery 相关的“性能下降”。

非常感谢您的建议！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-01T08:11:19.103

正如 Yuval 在评论中指出的那样，您没有指定获取顶级文档的标准。如果您打算检索随机文档，您可以简单地使用[IndexReader.document()](http://lucene.apache.org/java/2_1_0/api/org/apache/lucene/index/IndexReader.html#document(int))而无需进行搜索。如果您有一些条件，则可以使用 TermQuery（或 QueryParser 返回的查询）。

# ruby - 如何在 Ruby 中声明 NaN（不是数字）？

> ID：808653
> 
> 赞同：41
> 
> 时间：2009-04-30T19:27:24.933
> 
> 标签：ruby, nan

同样 "NaN".to_f 返回 0 而不是 NaN。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2013-09-24T23:17:55.170

由于 Ruby 1.9.3 有一个[常量](http://www.ruby-doc.org/core-1.9.3/Float.html#NAN)来获取 NaN 值

```
Float::NAN
=> NaN 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2012-01-04T10:41:05.223

如果您需要测试一个数字是否为 NaN，您可以使用`#nan?`它：

```
ruby-1.8.7-p352 :008 > (0/0.0).nan? #=> true 
ruby-1.8.7-p352 :009 > (0/1.0).nan? #=> false 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-30T19:41:39.967

最简单的方法是使用`0.0 / 0.0`. "NaN".to_f 不起作用，并且[在这个线程中](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/116271)有一些关于原因的讨论。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T19:40:25.027

`0.0 / 0.0`在 ruby​​ 1.8.6 上为我工作。

Pesto 链接的线程具有此功能，该功能应在根据 IEEE 754 实现浮点数的平台上工作：

```
def aNaN
    s, e, m = rand(2), 2047, rand(2**52-1)+1
    [sprintf("%1b%011b%052b", s,e,m)].pack("B*").unpack("G").first
end 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-08-01T09:36:36.780

这样就可以在 Rails 中分配一个变量（对单元测试很有用）：

```
o.amount = BigDecimal.new('NaN')
expect(o.valid?).to be false 
```

# ruby - 无法在 Windows 机器中安装 rmagick

> ID：808657
> 
> 赞同：3
> 
> 时间：2009-04-30T19:27:46.943
> 
> 标签：ruby

我是 rmagick 和 ruby​​ 的新手。我正在使用 ruby​​ 1.8.6 版本

实际上我下载了 rmagic2.9.0 win32 版本并解压缩并安装了 imageMagic-6.4.8。然后从命令提示符我给了 gem update --system。

```
C:\>gem update --system
Updating RubyGems
Nothing to update 
```

然后

```
C:\>gem install rmagick --local
ERROR:  could not find gem rmagick locally or in a repository 
```

然后尝试给予

```
C:\>gem list --remote --all rmagick

*** REMOTE GEMS ***

rmagick (2.9.1, 2.9.0, 2.8.0, 2.7.2, 2.7.1, 2.7.0, 2.6.0, 2.5.2, 2.5.1, 2.5.0, 2
.4.0, 2.3.0, 2.2.2, 2.2.0, 2.1.0, 2.0.0, 1.15.17, 1.15.16, 1.15.15, 1.15.14, 1.1
5.13, 1.15.12, 1.15.11, 1.15.10, 1.15.9, 1.15.8, 1.15.7, 1.15.6, 1.15.5, 1.15.4,
 1.15.3, 1.15.2, 1.15.1, 1.15.0, 1.14.1, 1.14.0, 1.13.0, 1.12.0, 1.11.1, 1.11.0,
 1.10.1, 1.10.0, 1.9.3, 1.9.2, 1.9.1, 1.9.0, 1.8.3, 1.8.2, 1.8.1, 1.8.0, 1.7.4,
1.7.3, 1.7.2, 1.7.1)
rmagick4j (0.3.7, 0.3.6, 0.3.5, 0.3.4, 0.3.3, 0.3.2, 0.3.1) 
```

然后

```
C:\>gem install rmagick -win32 -v 2.9.0
Building native extensions.  This could take a while...
ERROR:  Error installing rmagick:
        ERROR: Failed to build gem native extension.

c:/ruby/bin/ruby.exe extconf.rb
+----------------------------------------------------------------------------+
| This rmagick gem is for use only on Linux, BSD, OS X, and similar systems  |
| that have a gnu or similar toolchain installed. The rmagick-win32 gem is a |
| pre-compiled version of RMagick bundled with ImageMagick for use on        |
| Microsoft Windows systems. The rmagick-win32 gem is available on RubyForge.|
| See http://rmagick.rubyforge.org/install-faq.html for more information.    |
+----------------------------------------------------------------------------+
*** extconf.rb failed ***
Could not create Makefile due to some reason, probably lack of
necessary libraries and/or headers.  Check the mkmf.log file for more
details.  You may need configuration options.

Provided configuration options:
        --with-opt-dir
        --without-opt-dir
        --with-opt-include
        --without-opt-include=${opt-dir}/include
        --with-opt-lib
        --without-opt-lib=${opt-dir}/lib
        --with-make-prog
        --srcdir=.
        --curdir
        --ruby=c:/ruby/bin/ruby

Gem files will remain installed in C:/n32/gems/rmagick-2.9.0 for inspection.
Results logged to C:/n32/gems/rmagick-2.9.0/ext/RMagick/gem_make.out 
```

我无法安装 rmagick。任何人都可以帮我解决这个问题吗？提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T19:33:10.987

你的问题在这里：

> C:>gem install rmagick --local 错误：在本地或存储库中找不到 gem rmagick

该命令必须从您解压缩 rmagick-win32 下载的目录中运行。否则，gem 将无法找到它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-05T08:43:03.003

1.  卸载之前的任何 Image Magick 或 RMagick gem。

2.  [从http://rubyforge.org/frs/download.php/64917/RMagick-2.12.0-ImageMagick-6.5.6-8-Q8.zip](http://rubyforge.org/frs/download.php/64917/RMagick-2.12.0-ImageMagick-6.5.6-8-Q8.zip)下载具有 gem 和 ImageMagick 安装程序的 Windows 的 rmagick-win32

3.  解压您在上面下载的 rmagick-win32 zip 文件。

4.  从 zip 中的安装程序安装 ImageMagick，即运行 ImageMagick-6.5.6-8-Q8-windows-dll.exe。这将为您安装 ImageMagick。

5.  安装 zip 中的 rmagic gem，即 rmagick-2.12.0-x86-mswin32.gem。

# certificate - 将 CERT/PEM 证书转换为 PFX 证书

> ID：808669
> 
> 赞同：242
> 
> 时间：2009-04-30T19:30:16.097
> 
> 标签：certificate

我已经看到了一些关于如何将 PFX 转换为 cert 文件的问题，但我需要另辟蹊径。

我有两个文件：

> bob_cert.cert
> 
> bob_key.pem

我想将它们转换为单个 .pfx 文件。有没有一个工具可以做到这一点？

* * *

## 回答 #1

> 赞同：460
> 
> 时间：2009-04-30T19:56:14.753

```
openssl pkcs12 -inkey bob_key.pem -in bob_cert.cert -export -out bob_pfx.pfx 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2016-07-14T00:07:35.323

以下是在没有第三方工具的情况下在 Windows 上执行此操作的方法：

1.  **将证书导入证书存储。**在 Windows 资源管理器中，在上下文菜单中选择“安装证书”。 [![在此处输入图像描述](https://i.stack.imgur.com/0UVzD.png)](https://i.stack.imgur.com/0UVzD.png) 按照向导并接受默认选项“本地用户”和“自动”。

2.  **在证书存储中找到您的证书。**在 Windows 10 上运行“管理用户证书”MMC。在 Windows 2013 上，MMC 称为“证书”。默认情况下，在 Windows 10 上，您的证书应位于“个人”->“证书”节点下。

3.  **出口证书。**在上下文菜单中选择“导出...”菜单： [![在此处输入图像描述](https://i.stack.imgur.com/kEoVK.png)](https://i.stack.imgur.com/kEoVK.png)

    选择“是，导出私钥”： [![在此处输入图像描述](https://i.stack.imgur.com/wFL7t.png)](https://i.stack.imgur.com/wFL7t.png)

    您将看到在这种情况下启用了 .PFX 选项： [![在此处输入图像描述](https://i.stack.imgur.com/d2QZE.png)](https://i.stack.imgur.com/d2QZE.png)

    指定私钥的密码。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2017-01-08T10:52:05.810

我从 .key 和 .pem 文件创建了 .pfx 文件。

像这样`openssl pkcs12 -inkey rootCA.key -in rootCA.pem -export -out rootCA.pfx`

这不是直接的答案，但仍然可能对其他人有所帮助。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-10-11T07:46:35.630

`makecert.exe`如果您有在 Windows 机器上生成的自签名证书，您将获得两个文件：`cert.pvk`和`cert.cer`. 这些可以使用转换为 pfx`pvk2pfx`

`pvk2pfx`在相同的位置找到`makecert`（例如`C:\Program Files (x86)\Windows Kits\10\bin\x86`或类似的）

```
pvk2pfx -pvk cert.pvk -spc cert.cer -pfx cert.pfx 
```

# c# - 合并两个（或更多）PDF

> ID：808670
> 
> 赞同：89
> 
> 时间：2009-04-30T19:31:27.760
> 
> 标签：c#, .net, winforms, pdf

**背景：**我需要为我的销售人员提供每周报告包。这个包包含几个（5-10）水晶报告。

**问题：** 我想允许用户运行所有报告，也只运行一个报告。我想我可以通过创建报告然后执行以下操作来做到这一点：

```
List<ReportClass> reports = new List<ReportClass>();
reports.Add(new WeeklyReport1());
reports.Add(new WeeklyReport2());
reports.Add(new WeeklyReport3());
<snip>

foreach (ReportClass report in reports)
{
    report.ExportToDisk(ExportFormatType.PortableDocFormat, @"c:\reports\" + report.ResourceName + ".pdf");
} 
```

这将为我提供一个装满报告的文件夹，但我想通过电子邮件向每个人发送一份包含所有每周报告的 PDF。所以我需要把它们结合起来。

有没有一种简单的方法可以在不安装任何第三方控件的情况下做到这一点？我已经有了 DevExpress 和 CrystalReports，我不想再添加太多。

最好将它们组合在 foreach 循环中还是单独的循环中？（或另一种方式）

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2009-04-30T19:45:32.750

我不得不解决一个类似的问题，我最终做的是创建一个小型 pdfmerge 实用程序，该实用程序使用基本上是 MIT 许可的[**PDFSharp项目。**](http://www.pdfsharp.net/)

代码非常简单，我需要一个 cmdline 实用程序，因此与 PDF 合并相比，我有更多用于解析参数的代码：

```
using (PdfDocument one = PdfReader.Open("file1.pdf", PdfDocumentOpenMode.Import))
using (PdfDocument two = PdfReader.Open("file2.pdf", PdfDocumentOpenMode.Import))
using (PdfDocument outPdf = new PdfDocument())
{                
    CopyPages(one, outPdf);
    CopyPages(two, outPdf);

    outPdf.Save("file1and2.pdf");
}

void CopyPages(PdfDocument from, PdfDocument to)
{
    for (int i = 0; i < from.PageCount; i++)
    {
        to.AddPage(from.Pages[i]);
    }
} 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2014-02-20T00:58:40.803

这是一个使用 PDFSharp 合并 X 数量的 PDF 的函数

```
using PdfSharp;
using PdfSharp.Pdf;
using PdfSharp.Pdf.IO;

public static void MergePDFs(string targetPath, params string[] pdfs) {
    using(var targetDoc = new PdfDocument()){
        foreach (var pdf in pdfs) {
            using (var pdfDoc = PdfReader.Open(pdf, PdfDocumentOpenMode.Import)) {
                for (var i = 0; i < pdfDoc.PageCount; i++) 
                    targetDoc.AddPage(pdfDoc.Pages[i]);
            }
        }
        targetDoc.Save(targetPath);
    }
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-09-21T20:10:58.567

这是我使用 PdfSharp 想出并想与您分享的东西。

在这里，您可以将多个 Pdf 合并为一个，而无需输出目录（按照输入列表顺序）

```
 public static byte[] MergePdf(List<byte[]> pdfs)
    {
        List<PdfSharp.Pdf.PdfDocument> lstDocuments = new List<PdfSharp.Pdf.PdfDocument>();
        foreach (var pdf in pdfs)
        {
            lstDocuments.Add(PdfReader.Open(new MemoryStream(pdf), PdfDocumentOpenMode.Import));
        }

        using (PdfSharp.Pdf.PdfDocument outPdf = new PdfSharp.Pdf.PdfDocument())
        { 
            for(int i = 1; i<= lstDocuments.Count; i++)
            {
                foreach(PdfSharp.Pdf.PdfPage page in lstDocuments[i-1].Pages)
                {
                    outPdf.AddPage(page);
                }
            }

            MemoryStream stream = new MemoryStream();
            outPdf.Save(stream, false);
            byte[] bytes = stream.ToArray();

            return bytes;
        }           
    } 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-03-03T04:49:28.587

我使用 iTextsharp 和 c# 来组合 pdf 文件。这是我使用的代码。

```
string[] lstFiles=new string[3];
    lstFiles[0]=@"C:/pdf/1.pdf";
    lstFiles[1]=@"C:/pdf/2.pdf";
    lstFiles[2]=@"C:/pdf/3.pdf";

    PdfReader reader = null;
    Document sourceDocument = null;
    PdfCopy pdfCopyProvider = null;
    PdfImportedPage importedPage;
    string outputPdfPath=@"C:/pdf/new.pdf";

    sourceDocument = new Document();
    pdfCopyProvider = new PdfCopy(sourceDocument, new System.IO.FileStream(outputPdfPath, System.IO.FileMode.Create));

    //Open the output file
    sourceDocument.Open();

    try
    {
        //Loop through the files list
        for (int f = 0; f < lstFiles.Length-1; f++)
        {
            int pages =get_pageCcount(lstFiles[f]);

            reader = new PdfReader(lstFiles[f]);
            //Add pages of current file
            for (int i = 1; i <= pages; i++)
            {
                importedPage = pdfCopyProvider.GetImportedPage(reader, i);
                pdfCopyProvider.AddPage(importedPage);
            }

            reader.Close();
         }
        //At the end save the output file
        sourceDocument.Close();
    }
    catch (Exception ex)
    {
        throw ex;
    }

private int get_pageCcount(string file)
{
    using (StreamReader sr = new StreamReader(File.OpenRead(file)))
    {
        Regex regex = new Regex(@"/Type\s*/Page[^s]");
        MatchCollection matches = regex.Matches(sr.ReadToEnd());

        return matches.Count;
    }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-09-06T05:20:19.960

这是使用 iTextSharp 的示例

```
public static void MergePdf(Stream outputPdfStream, IEnumerable<string> pdfFilePaths)
{
    using (var document = new Document())
    using (var pdfCopy = new PdfCopy(document, outputPdfStream))
    {
        pdfCopy.CloseStream = false;
        try
        {
            document.Open();
            foreach (var pdfFilePath in pdfFilePaths)
            {
                using (var pdfReader = new PdfReader(pdfFilePath))
                {
                    pdfCopy.AddDocument(pdfReader);
                    pdfReader.Close();
                }
            }
        }
        finally
        {
            document?.Close();
        }
    }
} 
```

PdfReader 构造函数有许多重载。可以将参数类型替换为`IEnumerable<string>`，`IEnumerable<Stream>`它也应该可以工作。请注意，该方法不会关闭 OutputStream，而是将该任务委托给 Stream 创建者。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-30T19:42:09.437

[PDFsharp](http://www.pdfsharp.net)似乎允许将多个 PDF 文档合并为一个。

[ITextSharp](http://geekswithblogs.net/bsherwin/archive/2007/06/29/113566.aspx)也是如此。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-01T17:23:54.660

这里已经有一些很好的答案，但我想我可能会提到[pdftk](http://www.accesspdf.com/pdftk/ "PDF 工具包")可能对这项任务有用。您可以生成所需的每个 PDF，然后将它们组合在一起作为 pdftk 的后处理，而不是直接生成一个 PDF。这甚至可以在您的程序中使用 system() 或 ShellExecute() 调用来完成。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-06-27T09:01:16.433

`byte[]`使用 iTextSharp 最高版本 5.x结合两个：

```
internal static MemoryStream mergePdfs(byte[] pdf1, byte[] pdf2)
{
    MemoryStream outStream = new MemoryStream();
    using (Document document = new Document())
    using (PdfCopy copy = new PdfCopy(document, outStream))
    {
        document.Open();
        copy.AddDocument(new PdfReader(pdf1));
        copy.AddDocument(new PdfReader(pdf2));
    }
    return outStream;
} 
```

除了`byte[]`'s 之外，还可以传递`Stream`'s

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-12-12T18:25:32.783

我把上面两个结合起来了，因为我需要合并 3 个 pdfbytes 并返回一个字节

```
internal static byte[] mergePdfs(byte[] pdf1, byte[] pdf2,byte[] pdf3)
        {
            MemoryStream outStream = new MemoryStream();
            using (Document document = new Document())
            using (PdfCopy copy = new PdfCopy(document, outStream))
            {
                document.Open();
                copy.AddDocument(new PdfReader(pdf1));
                copy.AddDocument(new PdfReader(pdf2));
                copy.AddDocument(new PdfReader(pdf3));
            }
            return outStream.ToArray();
        } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-30T19:47:18.050

你可以试试[pdf-](http://sourceforge.net/projects/pdfshuffler/) [shuffler gtk-apps.org](http://www.gtk-apps.org/content/show.php/PDF-Shuffler?content=90610)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-30T20:32:38.287

我知道很多人都推荐了 PDF Sharp，但看起来该项目自 2008 年 6 月以来没有更新。此外，源不可用。

就个人而言，我一直在使用 iTextSharp，它非常易于使用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-05-30T02:50:01.590

以下方法获取一个PDF数组`List`的数组，然后返回一个数组。`byte``byte``byte`

```
using ...;
using PdfSharp.Pdf;
using PdfSharp.Pdf.IO;

public static class PdfHelper
{
    public static byte[] PdfConcat(List<byte[]> lstPdfBytes)
    {
        byte[] res;

        using (var outPdf = new PdfDocument())
        {
            foreach (var pdf in lstPdfBytes)
            {
                using (var pdfStream = new MemoryStream(pdf))
                using (var pdfDoc = PdfReader.Open(pdfStream, PdfDocumentOpenMode.Import))
                    for (var i = 0; i < pdfDoc.PageCount; i++)
                        outPdf.AddPage(pdfDoc.Pages[i]);
            }

            using (var memoryStreamOut = new MemoryStream())
            {
                outPdf.Save(memoryStreamOut, false);

                res = Stream2Bytes(memoryStreamOut);
            }
        }

        return res;
    }

    public static void DownloadAsPdfFile(string fileName, byte[] content)
    {
        var ms = new MemoryStream(content);

        HttpContext.Current.Response.Clear();
        HttpContext.Current.Response.ContentType = "application/pdf";
        HttpContext.Current.Response.AddHeader("content-disposition", $"attachment;filename={fileName}.pdf");
        HttpContext.Current.Response.Buffer = true;
        ms.WriteTo(HttpContext.Current.Response.OutputStream);
        HttpContext.Current.Response.End();
    }

    private static byte[] Stream2Bytes(Stream input)
    {
        var buffer = new byte[input.Length];
        using (var ms = new MemoryStream())
        {
            int read;
            while ((read = input.Read(buffer, 0, buffer.Length)) > 0)
                ms.Write(buffer, 0, read);

            return ms.ToArray();
        }
    }
} 
```

因此，`PdfHelper.PdfConcat`方法的结果被传递给`PdfHelper.DownloadAsPdfFile`方法。

PS：需要安装一个`NuGet`名为的包。`[PdfSharp][1]`所以在`Package Manage Console`窗口类型中：

> 安装包 PdfSharp

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-08-17T11:34:35.797

以下方法使用 iTextSharp 合并两个 pdf（f1 和 f2）。第二个 pdf 附加在 f1 的特定索引之后。

```
 string f1 = "D:\\a.pdf";
 string f2 = "D:\\Iso.pdf";
 string outfile = "D:\\c.pdf";
 appendPagesFromPdf(f1, f2, outfile, 3);

  public static void appendPagesFromPdf(String f1,string f2, String destinationFile, int startingindex)
        {
            PdfReader p1 = new PdfReader(f1);
            PdfReader p2 = new PdfReader(f2);
            int l1 = p1.NumberOfPages, l2 = p2.NumberOfPages;

            //Create our destination file
            using (FileStream fs = new FileStream(destinationFile, FileMode.Create, FileAccess.Write, FileShare.None))
            {
                Document doc = new Document();

                PdfWriter w = PdfWriter.GetInstance(doc, fs);
                doc.Open();
                for (int page = 1; page <= startingindex; page++)
                {
                    doc.NewPage();
                    w.DirectContent.AddTemplate(w.GetImportedPage(p1, page), 0, 0);
                    //Used to pull individual pages from our source

                }//  copied pages from first pdf till startingIndex
                for (int i = 1; i <= l2;i++)
                {
                    doc.NewPage();
                    w.DirectContent.AddTemplate(w.GetImportedPage(p2, i), 0, 0);
                }// merges second pdf after startingIndex
                for (int i = startingindex+1; i <= l1;i++)
                {
                    doc.NewPage();
                    w.DirectContent.AddTemplate(w.GetImportedPage(p1, i), 0, 0);
                }// continuing from where we left in pdf1 

                doc.Close();
                p1.Close();
                p2.Close();

            }
        } 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-06-14T15:22:07.990

为了解决类似的问题，我像这样使用 iTextSharp：

```
//Create the document which will contain the combined PDF's
Document document = new Document();

//Create a writer for de document
PdfCopy writer = new PdfCopy(document, new FileStream(OutPutFilePath, FileMode.Create));
if (writer == null)
{
     return;
}

//Open the document
document.Open();

//Get the files you want to combine
string[] filePaths = Directory.GetFiles(DirectoryPathWhereYouHaveYourFiles);
foreach (string filePath in filePaths)
{
     //Read the PDF file
     using (PdfReader reader = new PdfReader(vls_FilePath))
     {
         //Add the file to the combined one
         writer.AddDocument(reader);
     }
}

//Finally close the document and writer
writer.Close();
document.Close(); 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2009-04-30T19:45:49.833

[这是使用PDFSharp 和 ConcatenateDocuments](http://pdfsharp.com/PDFsharp/index.php?option=com_content&task=view&id=52&Itemid=45)的示例的链接

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-04-30T19:46:00.190

这里的解决方案[http://www.wacdesigns.com/2008/10/03/merge-pdf-files-using-c](http://www.wacdesigns.com/2008/10/03/merge-pdf-files-using-c) 它使用免费的开源 iTextSharp 库[http://sourceforge.net/projects/itextsharp](http://sourceforge.net/projects/itextsharp)

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2009-04-30T19:46:20.767

我已经用 PDFBox 做到了这一点。我想它的工作原理与 iTextSharp 类似。

# unit-testing - 单元测试电子邮件内容

> ID：808678
> 
> 赞同：4
> 
> 时间：2009-04-30T19:37:14.363
> 
> 标签：unit-testing, email

我通常会说任何一段代码，不管它做什么，特别是如果它在生产环境中运行应该被测试。但是，我一直想知道动态电子邮件内容是否应该是一个例外。它经常变化，并且通常很难正确和全面地测试，我不知道它是否值得。通常情况下，单元测试的内容无论如何都会被复制/粘贴（我知道这并不理想，但仍然会发生），所以除了告诉我们是否会严重爆炸之外，它并没有真正带来任何真正的好处，而且只是尝试发送电子邮件（不验证副本）的简单单元测试应该解决这个问题。

我希望从其他开发人员那里得到一些意见。让我知道你的想法。单元测试电子邮件内容与否？

编辑：澄清一下，我们已经为实际发送电子邮件进行了单独的单元/集成测试，这个问题仅指测试电子邮件的内容。目前我们只对动态内容进行单元测试，模板文本不在点击测试之外。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T19:56:20.353

您应该始终测试所有内容，是的，但您不能总是对所有内容进行*单元*测试。在这种情况下，尝试验证电子邮件模板是否已正确生成在集成和用户验收测试中可能会更好。

但是，您可以对您的程序如何构建电子邮件模板进行单元测试，这是我建议您采用的方法。

构建一个用于填充电子邮件模板的 API，一个具有以下方法的辅助类：

```
// using C# syntax returning strings for the example -- you could just as easily return
// System.Net.Mail.MailMessage or javax.mail.Message instead
string BuildPasswordChangeTemplate(string username, string newPassword, string email);
string BuildErrorTeplate(string methodName, string serviceName, Exception e); 
```

只要方法是在接口或虚拟（并且不是静态的）中定义的，您就可以模拟您的代码在适当的时间调用到适当的模板构建器中的帮助程序类和单元测试。然后，您可以将拼写和格式以及其他内容推送到用户验收测试，并认为您的工作已经完成。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T19:41:25.507

我将添加一个单元测试来验证内容是否可以从模板（或其他动态源）放置在电子邮件中。该内容可以特定于此单元测试，例如“这是给##USERNAME## 的测试电子邮件”或类似内容。如果模板发生变化，我不会用新的模板信息更新您的单元测试。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T19:58:32.283

我看到你想在这里测试的两个不同的东西。测试生成的电子邮件内容就是其中之一，您应该能够重构您的代码，以便您可以对这部分进行单元测试。您可以编写一个仅处理电子邮件生成的函数或类，然后针对您感兴趣的不同输入围绕它编写单元测试。

如果电子邮件内容是您代码的一部分，您应该围绕它进行某种测试。但也许您需要更多的完整性检查，而不是验证电子邮件内容是否完全匹配“恭喜{NAME}，您刚刚中了尼日利亚彩票......”。也许只是检查内容是否超过了一定的大小阈值，并且它在正文中的某处包含收件人的姓名（或插入的任何动态内容）？

第二件事是测试邮件发送机制。这不是严格意义上的单元测试。我认为这是一个功能或集成测试。如果您已经有一个 QA 团队或流程来处理这种类型的大规模测试，那么您可能可以放心地使用它。如果没有，编写一个小型 stub SMTP 服务器来接受传入的邮件并将其作为功能测试套件的一部分运行并不难。SMTP 是一个非常简单的协议，您只需要执行六个左右的命令即可接收邮件消息。我在大约一天前使用 Ruby 写了一篇。您需要能够重新配置应用程序使用的 SMTP 主机和端口，以便您可以设置一个用于测试，另一个用于生产。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T19:43:01.027

我的基本规则是：如果它影响应用程序的功能，请对其进行测试。（是的，这是一个定义非常松散的规则。）

因此，我注意到网站发送的许多电子邮件都是用户激活之类的东西。在这些情况下，我不会测试电子邮件本身的内容（那是内容，而不是功能），但我**会**验证它是否发送了正确的激活 URL。

我会将其扩展到由代码生成的任何动态电子邮件内容，这些内容不是硬编码的字符串消息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T19:43:23.427

当涉及到与您建议的系统类似的测试系统时，我的观点是您正在测试一个完整的系统，而不是一个逻辑代码块。我会编写单元测试来测试系统中较小的代码单元和一些连接的部分，并与用户一起使用功能测试来测试整个系统。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T19:58:58.240

单元测试以确保您的所有合并代码在它是一个有限集时都可以工作，或者如果它是动态的，则合并机制可以工作。以及模板文本是否适合合并文档的测试是有意义的。

之后测试每个模板不应该真正增加任何价值，但确实增加了一堆工作。

# objective-c - UILabel：在标签上使用 userInteractionEnabled 方法

> ID：808679
> 
> 赞同：9
> 
> 时间：2009-04-30T19:37:54.173
> 
> 标签：objective-c, cocoa-touch, uikit, uilabel

我想知道是否有人在 UILabel 上使用了 userInteractionEnabled 方法来允许标签像按钮一样工作（或者只是触发一个方法）。任何帮助将不胜感激。干杯!

更新（4/30/09 @1:07pm）澄清：我有一个标准的信息按钮，我想在它旁边放置一个带有文本“设置”的标签，我希望标签的功能类似于按钮（它可以翻转到设置屏幕。所以，基本上我需要将已经定义的 showSettinsView 绑定到“infoLabel”标签；用户单击 infoButton 或 infoLabel，该方法就会触发。

infoButton 已经在工作，并且正在使用 IBAction 来触发该方法。我想知道如何连接标签以实现相同的方法。就这些。干杯!

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-30T20:24:31.347

`userInteractionEnabled`不是方法而是属性。但我认为您会希望将其设置`YES`为允许事件进入`UIView`超级视图。

您可能想要做的是覆盖包含您的和子视图的`touchesBegan:withEvent:`方法。`UIView``UIButton``UILabel`

在此方法中，测试是否有任何`UITouch`触摸落在`UILabel`.

也就是说，元素是否与`CGPoint`元素`[touch locationInView]`相交？查看运行此测试的函数。`CGRect``[infoLabel bounds]``CGRectContainsPoint`

如果是这样，则触发一个`NSNotification`调用`IBAction`与`UIButton`.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-06-16T14:40:17.533

另一种解决方案可能是使用`UIButton`类型设置为自定义的 a 而不是`UILabel`. 这样，您的第二个按钮将看起来像一个`UILabel`，您可以将其配置为触发该`showSettingsView`方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-24T15:44:56.143

我同意 Alex 2009 年 4 月 30 日的观点，如果您不想使用 UIButton，我的建议只是对它的补充。我解决它的方法是通过创建一个 UILabel

```
- (id)initWithFrame:(CGRect)frame
{
    label = [[UILabel alloc] initWithFrame: CGRectMake(5, 5, 20, 20)];
    ...
    [label setUserInteractionEnabled: YES];
    [self addSubview: label];
} 
```

然后你可以覆盖 touches* 方法，比如 touchesBegan，touchesEnded 类似的东西

```
- (void) touchesBegan: (NSSet *) touches withEvent: (UIEvent *) event {
      UITouch *touch = [touches anyObject];
      if([touch view] == label) {
          NSLog(@"I've been touched");
       }
   } 
```

# c# - 为 .NET 应用程序创建交互式 shell，并将脚本语言（如 python/iron python）嵌入其中

> ID：808692
> 
> 赞同：13
> 
> 时间：2009-04-30T19:43:36.110
> 
> 标签：c#, python, .net, ironpython, python.net

我正在使用标准 python 安装附带的教程学习 python。作者所说的关于 python 的好处之一是“也许你已经编写了一个可以使用扩展语言的程序，而你不想为你的应用程序设计和实现一种全新的语言”——我的问题是如何我开始设计一个可以使用 Python 交互扩展的程序（使用 c#）（为了实现这一点，我想我需要为 .net 程序创建某种“shell”或“交互”模式) ?

是否有关于如何设计具有交互式外壳的 .NET 程序的任何指示。然后我想在 shell 中使用 python 脚本来“扩展”或与程序交互。

**编辑：**这个问题部分源于 Miguel de Icaza 在 PDC 2008 期间提供的演示，他展示了交互式 csharp 命令提示符，我认为 C# 4.0 也具有此“编译器即服务”功能。我看了看，想在 .NET 中设计一个具有交互式 shell 的 Windows 或 Web 程序是多么酷……并且可以使用像 python 这样的脚本语言来扩展程序提供的功能。

此外，在阅读了 Steve Yegge 的一篇文章后，我开始考虑这种功能，他谈到了永生的系统。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-30T19:45:40.223

这听起来像是[IronPython](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython)的一个很好的用途。

从 C# 设置一个简单的脚本主机以允许调用 IronPython 脚本以及允许 IronPython 调用您的 C# 代码是相当容易的。CodePlex 网站上的示例和示例展示了如何执行此操作。

另一个很好的示例和示例站点是[ironpython.info](http://www.ironpython.info/index.php/Main_Page)

这[是一个](http://www.voidspace.org.uk/ironpython/embedding.shtml)专门用于回答您的问题的示例的页面，尽管是以通用的以 DLR 为中心的方式——这将允许您托管 IronPython、IronRuby 或您想要支持的任何 DLR 语言。

过去我曾使用这些示例在[ScrewTurn Wiki](http://www.screwturn.eu/)的私有安装中创建IronPython 环境——它允许我创建非常富有表现力的Wiki 模板，并且总体上被证明非常有用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T20:53:52.930

我正在寻找相同问题的解决方案，并找到 IronTextBox： http: [//www.codeproject.com/KB/edit/irontextbox2.aspx](http://www.codeproject.com/KB/edit/irontextbox2.aspx)

它需要对当前版本进行一些调整，但似乎是我需要的一切。首先使其编译，然后将我想从 shell 访问的变量添加到范围。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T20:05:49.597

Python 作为一种扩展语言被称为“嵌入 Python”。

您可以通过基本调用 python 解释器从 c++ 调用 python 模块并让它执行 python 源代码。这称为[嵌入](http://www.python.org/doc/2.5.2/ext/embedding.html)。

它适用于 C 和 C++，并且可能也适用于 C#。

不，您不需要任何类型的“外壳”。虽然 Python 可以是交互式的，但这根本不是必需的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T20:15:16.737

这是一篇关于添加 IronRuby 以编写 C# 应用程序脚本的博客文章的链接。

[http://blog.jimmy.schementi.com/2008/11/adding-scripting-to-c-silverlight-app.html](http://blog.jimmy.schementi.com/2008/11/adding-scripting-to-c-silverlight-app.html)

这些原则也适用于使用 IronPython。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-27T11:33:14.207

如果您的目标是避免学习一门新语言，您可以使用[CSScript.Net](http://www.csscript.net)和用 C# 或 VB 编写的嵌入脚本到您的应用程序中。使用 CSScript，您可以完全访问 CLR。支持三种不同的脚本执行模型，以便您可以执行引用当前应用程序域中的对象的脚本、使用远程处理执行或作为 shell 执行。

目前，我使用 CCScript 作为“胶水”代码来配置应用程序对象，这有点类似于使用 Boo。

此[链接将](http://www.codeproject.com/KB/cs/cs-script_for_cp.aspx)引导您阅读代码项目文章，该文章提供了很好的概述。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T19:52:54.357

我不知道你是什么意思

> “扩展”或与程序交互

所以我无法回答你的问题。能给我举个例子吗？

Mono 中有一个开源的交互式 C# shell：[http ://www.mono-project.com/CsharpRepl](http://www.mono-project.com/CsharpRepl)

当你喜欢 python、.Net 和语言扩展时，你可能会喜欢[Boo](http://boo.codehaus.org/) over Iron python。Boo 也带有一个开源的交互式外壳。

我不同意

> “你不想为你的应用程序设计和实现一种全新的语言”

创建一个简单的 DSL 不像以前那么难了。实施不需要几天，只需几个小时。这可能是一个有趣的选择。

# c# - 标签编辑后的 C# Windows 窗体 TreeView 排序

> ID：808696
> 
> 赞同：6
> 
> 时间：2009-04-30T19:45:05.607
> 
> 标签：c#, winforms, sorting, treeview

在树中编辑节点的标签后，我尝试使用节点将更新的项目放置在正确的位置。我通过在 AfterLabelEdit 事件处理程序中调用 .Sort 来执行此操作，这会导致无限循环。

标签更改后，如何在树视图中使用节点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2012-10-18T14:34:53.477

将 BeginInvoke 与 MethodInvoker 委托一起使用，而不是声明您自己的委托。

```
private void treeView1_AfterLabelEdit(object sender, NodeLabelEditEventArgs e)
{
    treeView1.BeginInvoke(new MethodInvoker(treeView1.Sort));
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-30T20:10:41.397

使用 BeginInvoke：

```
 delegate void sort();

    private void treeView1_AfterLabelEdit(object sender, NodeLabelEditEventArgs e)
    {
        treeView1.BeginInvoke(new sort(treeView1.Sort));
    } 
```

# windows - 我可以在 COM 方法中传递 HWND 吗？

> ID：808706
> 
> 赞同：4
> 
> 时间：2009-04-30T19:46:54.153
> 
> 标签：windows, com, hwnd

是否有可能有一个通过的 COM 方法`HWND`？在我的对象中使用以下方法`CoCreateInstance`返回`DISP_E_BADVARTYPE`（`0x80020008`）：

```
STDMETHODIMP ShowDialog(HWND hWndParent); 
```

到目前为止，我通过传递一个`OLE_HANDLE`然后铸造它来解决这个问题，但感觉就像一个杂物：

```
STDMETHODIMP ShowDialog(OLE_HANDLE hWndParent); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T20:40:12.153

我认为 HWND 是一个指向结构的指针，这就是为什么你不能在 IDL 中使用它的原因。
如果您查看 Microsoft Typelibs，您将看到有关如何传递句柄的各种变化（从 int 到 long 到 HANDLE）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T21:50:00.237

您的界面可能注册为“双重”，而 HWND 不是 OLE 自动化支持的类型之一。您的界面是否需要与 IDispatch 兼容（您是否需要从脚本或后期绑定语言中调用它）？如果没有，从 IUnknown 而不是 IDispatch 派生并且不注册为双重将帮助您。

注意：只要您只使用过程中的方法，铸造就可以了。

# java - 这些 Java 注释有什么作用？

> ID：808711
> 
> 赞同：7
> 
> 时间：2009-04-30T19:47:41.980
> 
> 标签：java, annotations

我仍然不清楚Java中注释的目的。最初我认为它们只是用作文档。[但是从Google App Engine Datastore](http://code.google.com/appengine/docs/java/datastore/overview.html)看这个文档，我不太确定。**@PersistenceCapable(identityType = IdentityType.APPLICATION)**看起来更像是一个方法签名。

这种注释的目的是什么？它有什么作用？

```
import java.util.Date;
import javax.jdo.annotations.IdGeneratorStrategy;
import javax.jdo.annotations.IdentityType;
import javax.jdo.annotations.PersistenceCapable;
import javax.jdo.annotations.Persistent;
import javax.jdo.annotations.PrimaryKey;

@PersistenceCapable(identityType = IdentityType.APPLICATION)
public class Employee {
    @PrimaryKey
    @Persistent(valueStrategy = IdGeneratorStrategy.IDENTITY)
    private Long id;

    @Persistent
    private String firstName;

    @Persistent
    private String lastName;

    @Persistent
    private Date hireDate;

    public Employee(String firstName, String lastName, Date hireDate) {
        this.firstName = firstName;
        this.lastName = lastName;
        this.hireDate = hireDate;
    }

    // Accessors for the fields.  JDO doesn't use these, but your application does.

    public Long getId() {
        return id;
    }

    public String getFirstName() {
        return firstName;
    } 

    // ... other accessors...
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-30T19:51:27.590

它们是源级元数据。它们是向非代码代码添加信息的一种方式，并且很容易被机器处理。

在您的示例中，它们用于为该实体类型配置对象关系映射。例如，id 字段应该是该对象的主键，并且 firstName、lastName 和hireDate 应该存储在数据库中。（将这些字段与某些瞬态对象状态区分开来。）

GAE 对 JDO 的支持需要知道您将尝试在数据库中存储哪些对象。它通过查看代码中的类，查找带有@PersistenceCapable 注释的类来做到这一点。

通常，它们用于替换您之前使用外部配置文件的位置；Java 标准库具有读取代码中注释的工具，这使得它们比滚动您自己的配置文件管道更容易处理，并免费为您提供 IDE 支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T19:53:48.160

可以使用[注释处理工具 API 处理注释](http://java.sun.com/javase/6/docs/technotes/guides/apt/index.html)以自动生成样板代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T19:52:15.310

我认为这些来自[Java 数据对象](http://java.sun.com/jdo/index.jsp)API。它是一个在一定程度上与 EJB3 应该完成的 API 重叠的 API。相同的概念，不同的语法和工具。

如果您一般不熟悉注解，请查看[Java 教程。](http://java.sun.com/docs/books/tutorial/java/javaOO/annotations.html)

# iphone - UITableView 和 didSelectRowAtIndexPath 问题

> ID：808720
> 
> 赞同：0
> 
> 时间：2009-04-30T19:51:19.587
> 
> 标签：iphone

我有一个 UITableView 填充了基于位置的数据源。我打电话给[self updateView]；在找到工作正常的位置后手动刷新视图......但由于某种原因，没有调用 didSelectRowAtIndexPath 方法。关于为什么它不起作用的任何想法？

代码片段： http: [//pastie.org/464300](http://pastie.org/464300)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T21:12:50.700

确保设置了 tableView 的委托属性。

**slf 说：**

> 确保它在您的 .h 文件中定义。该协议首先执行“doesRespondToSelector”，如果您没有通过标题将其公开，则消息我失败

*-respondsToSelector：*将检测未在接口中公开的方法。

# emacs - 如何自定义 Emacs 编译输出解析？

> ID：808724
> 
> 赞同：1
> 
> 时间：2009-04-30T19:51:38.447
> 
> 标签：emacs, xemacs

我当前的编译输出没有在*编译*缓冲区中正确解析。我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T20:08:21.697

您可能必须修改变量`compilation-error-regexp-alist`。通过执行以下操作查看变量文档：

```
C-h v compilation-error-regexp-alist 
```

或信息页面：

```
C-h S compilation-error-regexp-alist 
```

# .net - 为什么 Linq Cast 当我定义了隐式强制转换时操作失败？

> ID：808725
> 
> 赞同：20
> 
> 时间：2009-04-30T19:51:50.910
> 
> 标签：.net, linq, casting

我创建了两个类，其中一个在它们之间有一个隐式转换：

```
public class Class1
{
    public int Test1;
}

public class Class2
{
    public int Test2;

    public static implicit operator Class1(Class2 item)
    {
        return new Class1{Test1 = item.Test2};
    }
} 
```

当我创建一种类型的新列表并尝试将 <T> 转换为另一种类型时，它失败并出现 InvalidCastException：

```
List<Class2> items = new List<Class2>{new Class2{Test2 = 9}};
foreach (Class1 item in items.Cast<Class1>())
{
    Console.WriteLine(item.Test1);
} 
```

但是，这可以正常工作：

```
foreach (Class1 item in items)
{
    Console.WriteLine(item.Test1);
} 
```

为什么使用 Cast<T> 时不调用隐式转换？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-30T20:03:32.520

因为，通过 Reflector 查看代码，Cast 不会尝试考虑任何隐式转换运算符（LINQ Cast 代码针对各种特殊情况进行了高度优化，但没有朝那个方向考虑）（因为许多 .NET 语言不会）。

在不涉及反射和其他事情的情况下，泛型不会提供任何开箱即用的方式来在任何情况下考虑这些额外的东西。

EDIT: In general, more complex facilities like implicit/explict, equality operators etc. are not generally handled by generic facilities like LINQ.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-10-21T00:17:24.437

You can also use this to do casting with conversions if needed:

```
public static IEnumerable<TDest> CastAll<TItem, TDest>(this IEnumerable<TItem> items)
{
 var p = Expression.Parameter(typeof(TItem), "i");
 var c = Expression.Convert(p, typeof(TDest));
 var ex = Expression.Lambda<Func<TItem, TDest>>(c, p).Compile();

 foreach (var item in items)
 {
    yield return ex(item);
 }
} 
```

From [http://adventuresdotnet.blogspot.com/2010/06/better-more-type-safe-alternative-to.html](http://adventuresdotnet.blogspot.com/2010/06/better-more-type-safe-alternative-to.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T20:48:10.823

Thanks for that I was about to use that exact case somewhere. You have saved me a pile of time. As a possible solution to your problem you could use ConvertAll<> instead, like so:

```
foreach (Class1 item in items.ConvertAll<Class1>((i) => (Class1)i))
{
     Console.WriteLine(item.Test1);
} 
```

EDIT: or if you want to be more explicit that the cast is implicit then this works too:

```
foreach (Class1 item in items.ConvertAll<Class1>(i => i))
{
     Console.WriteLine(item.Test1);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-15T23:38:43.257

A solution could be to use a bit of linq'ing here if you really need this kind of conversion:

```
List items = new List{new Class2{Test2 = 9}};
foreach (Class1 item in (from x in items select (Class1)x))
{
    Console.WriteLine(item.Test1);
}

```

# jquery - jquery合影悬停效果

> ID：808733
> 
> 赞同：0
> 
> 时间：2009-04-30T19:53:43.013
> 
> 标签：jquery, mouseover

我已经看到（或认为我看到了）一种在合影上使用 Jquery 的方法，以允许淡出照片的一个区域以外的所有区域并显示标题。这个想法是允许人们将鼠标悬停在合影中的特定面孔上并查看有关他们的信息。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T20:00:59.813

使用图像地图可能是您最好的选择？像这样的插件怎么样：

[http://drupal.org/project/jq_maphilight](http://drupal.org/project/jq_maphilight)

[jQuery 高亮插件](http://plugins.jquery.com/project/maphilight)

[插件演示](http://davidlynch.org/js/maphilight/docs/demo_usa.html)

# sql - PostgreSQL 如何创建数据库或模式的副本？

> ID：808735
> 
> 赞同：38
> 
> 时间：2009-04-30T19:53:55.460
> 
> 标签：sql, database, postgresql

有没有一种简单的方法可以在 PostgreSQL 8.1 中创建数据库或模式的副本？

我正在测试一些软件，它对数据库中的特定模式进行了大量更新，我想复制它，以便与原始模式进行一些比较。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-04-30T20:02:45.597

如果它在同一台服务器上，您只需使用带有 TEMPLATE 参数的 CREATE DATABASE 命令。例如：

```
CREATE DATABASE newdb WITH TEMPLATE olddb; 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-04-30T19:57:07.263

[`pg_dump`](http://www.postgresql.org/docs/current/static/app-pgdump.html)与`--schema-only`选项。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2014-03-26T09:26:14.037

如果您必须将模式从本地数据库复制到远程数据库，您可以使用以下两个选项之一。

**选项 A**

1.  将模式从本地数据库复制到转储文件。

    ```
    pg_dump -U postgres -Cs database > dump_file 
    ```

2.  将转储文件从本地服务器复制到远程服务器。

    ```
    scp localuser@localhost:dump_file remoteuser@remotehost:dump_file 
    ```

3.  连接到远程服务器。

    ```
    ssh remoteuser@remotehost 
    ```

4.  将模式从转储文件复制到远程数据库。

    ```
    psql -U postgres database < dump_file 
    ```

**选项 B**

直接将模式从本地数据库复制到远程数据库，而不使用中间文件。

```
pg_dump -h localhost -U postgres -Cs database | psql -h remotehost -U postgres database 
```

如果[您](http://alirazabhayani.blogspot.com/2014/03/postgresql-django-app-pgdump-to-copy-postgresql-database-from-remote-server.html)想了解更多关于使用`pg_dump`.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2019-05-23T17:40:45.590

这可以通过运行以下命令来完成：

```
CREATE DATABASE [Database to create] WITH TEMPLATE [Database to copy] OWNER [Your username]; 
```

一旦填写了您的数据库名称和用户名，这将创建指定数据库的副本。只要您要复制的数据库没有其他活动连接，这将起作用。如果还有其他活动连接，您可以先使用以下命令临时终止连接：

```
SELECT pg_terminate_backend(pg_stat_activity.pid) 
FROM pg_stat_activity 
WHERE pg_stat_activity.datname = '[Database to copy]' 
AND pid <> pg_backend_pid(); 
```

我为 Chartio 的数据学校写的一篇好文章更深入地介绍了如何做到这一点，可以在这里找到： [https ://dataschool.com/learn/how-to-create-a-copy-of-a -database-in-postgresql-使用-psql](https://dataschool.com/learn/how-to-create-a-copy-of-a-database-in-postgresql-using-psql)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T19:59:38.647

这是一些备份和恢复[示例的链接。](http://www.cyberciti.biz/tips/howto-backup-postgresql-databases.html)您可以使用备份恢复到不同的服务器或其他

# c# - 从 .NET 设置系统时区

> ID：808736
> 
> 赞同：18
> 
> 时间：2009-04-30T19:54:15.600
> 
> 标签：c#, .net, winapi, interop, timezone

有没有人有一些代码可以从 .NET 中获取 TimeZoneInfo 字段并执行互操作代码以通过 SetTimeZoneInformation 设置系统时区？我意识到它基本上是将 TimeZoneInfo 成员映射到 struct 成员，但在我看来，字段将如何精确映射或者我应该在偏差之外关心什么似乎并不明显。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2014-08-06T05:54:49.163

还有另一种方法可以做到这一点，诚然这有点小技巧，但在实践中效果很好：

```
public void SetSystemTimeZone(string timeZoneId)
{
    var process = Process.Start(new ProcessStartInfo
    {
        FileName = "tzutil.exe",
        Arguments = "/s \"" + timeZoneId + "\"",
        UseShellExecute = false,
        CreateNoWindow = true
    });

    if (process != null)
    {
        process.WaitForExit();
        TimeZoneInfo.ClearCachedData();
    }
} 
```

只需调用此方法并传递`TimeZoneInfo.Id`您希望设置的值。例如：

```
SetSystemTimeZone("Eastern Standard Time"); 
```

运行此代码不需要特殊权限，因为`tzutil.exe`已经具有适当的权限。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-30T22:26:27.357

我不知道这是否是您要查找的内容，但有一些关于如何使用 Win32 函数获取和设置时区信息的信息

[http://www.pinvoke.net/default.aspx/kernel32/GetTimeZoneInformation.html](http://www.pinvoke.net/default.aspx/kernel32/GetTimeZoneInformation.html)

以下示例代码的主要部分取自此站点。我只是添加了几行来实际调用 GetTimeZone() 方法，并修复了 SystemTime 结构的访问修饰符中的一个小错误，以使示例工作。

希望这可以帮助...

```
using System;
using System.Runtime.InteropServices;

namespace Stackoverflow
{
    class TimeZoneFunctionality
    {
        /// <summary>
        /// [Win32 API call]
        /// The GetTimeZoneInformation function retrieves the current time-zone parameters.
        /// These parameters control the translations between Coordinated Universal Time (UTC)
        /// and local time.
        /// </summary>
        /// <param name="lpTimeZoneInformation">[out] Pointer to a TIME_ZONE_INFORMATION structure to receive the current time-zone parameters.</param>
        /// <returns>
        /// If the function succeeds, the return value is one of the following values.
        /// <list type="table">
        /// <listheader>
        /// <term>Return code/value</term>
        /// <description>Description</description>
        /// </listheader>
        /// <item>
        /// <term>TIME_ZONE_ID_UNKNOWN == 0</term>
        /// <description>
        /// The system cannot determine the current time zone. This error is also returned if you call the SetTimeZoneInformation function and supply the bias values but no transition dates.
        /// This value is returned if daylight saving time is not used in the current time zone, because there are no transition dates.
        /// </description>
        /// </item>
        /// <item>
        /// <term>TIME_ZONE_ID_STANDARD == 1</term>
        /// <description>
        /// The system is operating in the range covered by the StandardDate member of the TIME_ZONE_INFORMATION structure.
        /// </description>
        /// </item>
        /// <item>
        /// <term>TIME_ZONE_ID_DAYLIGHT == 2</term>
        /// <description>
        /// The system is operating in the range covered by the DaylightDate member of the TIME_ZONE_INFORMATION structure.
        /// </description>
        /// </item>
        /// </list>
        /// If the function fails, the return value is TIME_ZONE_ID_INVALID. To get extended error information, call GetLastError.
        /// </returns>
        [DllImport( "kernel32.dll", CharSet = CharSet.Auto )]
        private static extern int GetTimeZoneInformation( out TimeZoneInformation lpTimeZoneInformation );

        /// <summary>
        /// [Win32 API call]
        /// The SetTimeZoneInformation function sets the current time-zone parameters.
        /// These parameters control translations from Coordinated Universal Time (UTC)
        /// to local time.
        /// </summary>
        /// <param name="lpTimeZoneInformation">[in] Pointer to a TIME_ZONE_INFORMATION structure that contains the time-zone parameters to set.</param>
        /// <returns>
        /// If the function succeeds, the return value is nonzero.
        /// If the function fails, the return value is zero. To get extended error information, call GetLastError.
        /// </returns>
        [DllImport( "kernel32.dll", CharSet = CharSet.Auto )]
        private static extern bool SetTimeZoneInformation( [In] ref TimeZoneInformation lpTimeZoneInformation );

        /// <summary>
        /// The SystemTime structure represents a date and time using individual members
        /// for the month, day, year, weekday, hour, minute, second, and millisecond.
        /// </summary>
        [StructLayoutAttribute( LayoutKind.Sequential )]
        public struct SystemTime
        {
            public short year;
            public short month;
            public short dayOfWeek;
            public short day;
            public short hour;
            public short minute;
            public short second;
            public short milliseconds;
        }

        /// <summary>
        /// The TimeZoneInformation structure specifies information specific to the time zone.
        /// </summary>
        [StructLayout( LayoutKind.Sequential, CharSet = CharSet.Unicode )]
        public struct TimeZoneInformation
        {
            /// <summary>
            /// Current bias for local time translation on this computer, in minutes. The bias is the difference, in minutes, between Coordinated Universal Time (UTC) and local time. All translations between UTC and local time are based on the following formula:
            /// <para>UTC = local time + bias</para>
            /// <para>This member is required.</para>
            /// </summary>
            public int bias;
            /// <summary>
            /// Pointer to a null-terminated string associated with standard time. For example, "EST" could indicate Eastern Standard Time. The string will be returned unchanged by the GetTimeZoneInformation function. This string can be empty.
            /// </summary>
            [MarshalAs( UnmanagedType.ByValTStr, SizeConst = 32 )]
            public string standardName;
            /// <summary>
            /// A SystemTime structure that contains a date and local time when the transition from daylight saving time to standard time occurs on this operating system. If the time zone does not support daylight saving time or if the caller needs to disable daylight saving time, the wMonth member in the SystemTime structure must be zero. If this date is specified, the DaylightDate value in the TimeZoneInformation structure must also be specified. Otherwise, the system assumes the time zone data is invalid and no changes will be applied.
            /// <para>To select the correct day in the month, set the wYear member to zero, the wHour and wMinute members to the transition time, the wDayOfWeek member to the appropriate weekday, and the wDay member to indicate the occurence of the day of the week within the month (first through fifth).</para>
            /// <para>Using this notation, specify the 2:00a.m. on the first Sunday in April as follows: wHour = 2, wMonth = 4, wDayOfWeek = 0, wDay = 1\. Specify 2:00a.m. on the last Thursday in October as follows: wHour = 2, wMonth = 10, wDayOfWeek = 4, wDay = 5.</para>
            /// </summary>
            public SystemTime standardDate;
            /// <summary>
            /// Bias value to be used during local time translations that occur during standard time. This member is ignored if a value for the StandardDate member is not supplied.
            /// <para>This value is added to the value of the Bias member to form the bias used during standard time. In most time zones, the value of this member is zero.</para>
            /// </summary>
            public int standardBias;
            /// <summary>
            /// Pointer to a null-terminated string associated with daylight saving time. For example, "PDT" could indicate Pacific Daylight Time. The string will be returned unchanged by the GetTimeZoneInformation function. This string can be empty.
            /// </summary>
            [MarshalAs( UnmanagedType.ByValTStr, SizeConst = 32 )]
            public string daylightName;
            /// <summary>
            /// A SystemTime structure that contains a date and local time when the transition from standard time to daylight saving time occurs on this operating system. If the time zone does not support daylight saving time or if the caller needs to disable daylight saving time, the wMonth member in the SystemTime structure must be zero. If this date is specified, the StandardDate value in the TimeZoneInformation structure must also be specified. Otherwise, the system assumes the time zone data is invalid and no changes will be applied.
            /// <para>To select the correct day in the month, set the wYear member to zero, the wHour and wMinute members to the transition time, the wDayOfWeek member to the appropriate weekday, and the wDay member to indicate the occurence of the day of the week within the month (first through fifth).</para>
            /// </summary>
            public SystemTime daylightDate;
            /// <summary>
            /// Bias value to be used during local time translations that occur during daylight saving time. This member is ignored if a value for the DaylightDate member is not supplied.
            /// <para>This value is added to the value of the Bias member to form the bias used during daylight saving time. In most time zones, the value of this member is –60.</para>
            /// </summary>
            public int daylightBias;
        }

        /// <summary>
        /// Sets new time-zone information for the local system.
        /// </summary>
        /// <param name="tzi">Struct containing the time-zone parameters to set.</param>
        public static void SetTimeZone( TimeZoneInformation tzi )
        {
            // set local system timezone
            SetTimeZoneInformation( ref tzi );
        }

        /// <summary>
        /// Gets current timezone information for the local system.
        /// </summary>
        /// <returns>Struct containing the current time-zone parameters.</returns>
        public static TimeZoneInformation GetTimeZone()
        {
            // create struct instance
            TimeZoneInformation tzi;

            // retrieve timezone info
            int currentTimeZone = GetTimeZoneInformation( out tzi );

            return tzi;
        }

        /// <summary>
        /// Oversimplyfied method to test  the GetTimeZone functionality
        /// </summary>
        /// <param name="args">the usual stuff</param>
        static void Main( string[] args )
        {
            TimeZoneInformation timeZoneInformation = GetTimeZone();

            return;
        }
    }
} 
```

在设置时区信息之前，您需要确保该进程具有适当的权限。如 SetTimeZoneInformation 的 MSDN 页面所述：

> 应用程序必须具有 SE_TIME_ZONE_NAME 权限才能使此功能成功。默认情况下禁用此权限。

以下是启用此权限的一些示例代码：

```
public class AdjustTokenPrivilegesFunctionality
{
  [StructLayout(LayoutKind.Sequential)]
  private struct LUID
  {
    public uint LowPart;
    public int HighPart;
  }

  [StructLayout(LayoutKind.Sequential)]
  private struct LUID_AND_ATTRIBUTES
  {
    public LUID Luid;
    public UInt32 Attributes;
  }

  private struct TOKEN_PRIVILEGES
  {
    public UInt32 PrivilegeCount;
    [MarshalAs(UnmanagedType.ByValArray, SizeConst = 1)]
    public LUID_AND_ATTRIBUTES[] Privileges;
  }

  public const string SE_TIME_ZONE_NAME = "SeTimeZonePrivilege";
  public const int TOKEN_ADJUST_PRIVILEGES = 0x00000020;
  public const int TOKEN_QUERY = 0x00000008;
  public const int SE_PRIVILEGE_ENABLED = 0x00000002;

  [DllImport("advapi32.dll", SetLastError = true)]
  [return: MarshalAs(UnmanagedType.Bool)]
  private static extern bool AdjustTokenPrivileges(IntPtr TokenHandle, bool DisableAllPrivileges, ref TOKEN_PRIVILEGES NewState, UInt32 Zero, IntPtr Null1, IntPtr Null2);

  [DllImport("advapi32.dll", SetLastError = true, CharSet = CharSet.Auto)]
  private static extern int OpenProcessToken(int ProcessHandle, int DesiredAccess, out IntPtr tokenhandle);

  [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
  private static extern int GetCurrentProcess();

  [DllImport("advapi32.dll", CharSet = CharSet.Auto)]
  private static extern int LookupPrivilegeValue(string lpsystemname, string lpname, [MarshalAs(UnmanagedType.Struct)] ref LUID lpLuid);

  static void EnableSetTimeZonePrivileges()
  {
    // We must add the set timezone privilege to the process token or SetTimeZoneInformation will fail
    IntPtr token;
    int retval = OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, out token);
    Assert.IsTrue(retval != 0, String.Format("OpenProcessToken failed. GetLastError: {0}", Marshal.GetLastWin32Error()));

    LUID luid = new LUID();
    retval = LookupPrivilegeValue(null, SE_TIME_ZONE_NAME, ref luid);
    Assert.IsTrue(retval != 0, String.Format("LookupPrivilegeValue failed. GetLastError: {0}", Marshal.GetLastWin32Error()));

    TOKEN_PRIVILEGES tokenPrivs = new TOKEN_PRIVILEGES();
    tokenPrivs.PrivilegeCount = 1;
    tokenPrivs.Privileges = new LUID_AND_ATTRIBUTES[1];
    tokenPrivs.Privileges[0].Luid = luid;
    tokenPrivs.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;
    Assert.IsTrue(AdjustTokenPrivileges(token, false, ref tokenPrivs, 0, IntPtr.Zero, IntPtr.Zero), String.Format("AdjustTokenPrivileges failed. GetLastError: {0}", Marshal.GetLastWin32Error()));
  }
} 
```

# programming-languages - 如何为应用程序创建计算机或脚本语言？

> ID：808737
> 
> 赞同：3
> 
> 时间：2009-04-30T19:54:24.180
> 
> 标签：programming-languages, scripting

副本：

*   [学习编写编译器](https://stackoverflow.com/questions/1669/learning-to-write-a-compiler)
*   [关于创建编程语言的文档](https://stackoverflow.com/questions/789093/documentation-on-creating-a-programming-language)
*   [解析器、解释器和编译器的学习资源](https://stackoverflow.com/questions/41785/learning-resources-on-parsers-interpreters-and-compilers)
*   [编写编程语言的建议？](https://stackoverflow.com/questions/453870/suggestions-for-writing-a-programming-language)
*   [编译器编程：最基本的成分是什么？](https://stackoverflow.com/questions/559025/compiler-programming-what-are-the-most-fundamental-ingredients)
*   [有没有一些关于编译器原理的在线资源？](https://stackoverflow.com/questions/461497/are-there-some-online-resources-about-compiler-principle)

还有其他我现在懒得找了。

* * *

我不是在问如何制作一种极其复杂的语言。我只是想了解基础知识。我会使用 c# 作为底层语言。我知道这很模糊。我希望有一些非常基本的东西来指导我。

我想我最感兴趣的是创建脚本语言。例如，我看到有人编写程序，但他们的应用程序有脚本语言。我不想重写 Windows 脚本语言。假设我有一个文本文件阅读器，出于某种原因想要一种脚本语言来自动化某些事情。我不知道怎么问。

谢谢你。

编辑 - 谢谢你的回答。我现在更多地关注学习而不是做事。我可能会使用 LUA，但我正在尝试更多地了解这个概念。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T19:57:11.787

你可以看看[LUA](http://www.lua.org/about.html) - 每次我问自己这个问题时，我都使用它取得了巨大的成功：“如何在此处自动插入*我**的应用程序之一*？”

编辑：这里有一些例子（取自[链接页面](http://lua-users.org/wiki/LuaLinks)，无可否认，笨拙的[Lua Wiki](http://lua-users.org/wiki/)）关于如何在你的应用程序中嵌入 Lua：

> *   [在 C 中嵌入 Lua：在 C 中使用 Lua](http://www.heavycoder.com/tutorials/lua_embed.php)
> *   [在 C/C++ 代码中嵌入脚本语言](http://www.debian-administration.org/articles/264)
> *   [使用 Lua 的可嵌入脚本](http://www.ibm.com/developerworks/linux/library/l-lua.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T19:57:33.753

您可以使用现有的语言，如 Python 或 Javascript。例如，对于 Javascript，Java 应用程序有[http://www.mozilla.org/rhino/](http://www.mozilla.org/rhino/)。因此，通常您不需要实际发明一种新语言，您只需为已经存在的语言提供自定义 API。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T20:00:29.657

首先你需要一个像 lex 这样的词法解析器，然后是像 bison 这样的语法解析器。

然后您可以使用语法解析器来创建一个解释器来“执行”语法结果。

大多数脚本语言就是这样做的。

ps：另一种方法是通过编写shell来练习——shell脚本（bash、csh或sh）是高度简化的脚本语言。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T20:06:19.067

一些术语是有序的。您可能在谈论[特定领域的语言](http://en.wikipedia.org/wiki/Domain-specific_programming_language)。将文本文件转换为“可执行文件”的两种基本方法：[编译器](http://en.wikipedia.org/wiki/Compiler)或[解释器](http://en.wikipedia.org/wiki/Interpreter_(computing))。解释器更适合脚本概念，因为它更容易一次构建和执行一行。请注意，除了一个非常简单的语言之外，编写一个像样的解析器或一个像样的解释器都不是微不足道的。关于口译员的经典著作是[SICP](http://mitpress.mit.edu/sicp/)，但这对于初学者来说是一本相当难的书。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T20:19:07.117

Scott Hanselman 在他[最新的 hanselminutes 播客](http://www.hanselminutes.com/default.aspx?showID=177)中提到，集成 IronPython 以允许对现有应用程序进行脚本编写非常容易。

如果您对让您的应用程序可编写脚本的最终目标感兴趣，那么您绝对应该考虑使用现有语言而不是尝试编写自己的语言。

如果您对编写自己的脚本语言的教育体验更感兴趣，那么您应该去做！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T19:57:08.747

无需创建新的脚本语言，例如。Rhino 是一种广泛使用的可嵌入 javascript ( [http://www.mozilla.org/rhino/](http://www.mozilla.org/rhino/) ) 或来自 MS 的 Jscript，您可以直接在您的产品中使用。

我已经按照您的要求进行了 - 我曾经创建了自己的方案解释器。这非常有效，但我们重新发明了很多技术，并没有真正获得很多额外的好处。如果只使用其中一种可用的方案，我们会好得多。我不会再做那个决定，即使它很有趣也很成功。

# javascript - 如何在包含 iframe 或仅包含框架的 HTML 文档中查找选择

> ID：808744
> 
> 赞同：4
> 
> 时间：2009-04-30T19:57:02.957
> 
> 标签：javascript, html, dhtml, iframe

如果文本可能在其中一个框架（或 iframe）内，有没有办法在 HTML 文档中找到选定的文本？

如果文档没有框架，这很简单：

```
var text;
if (document.getSelection) {
 // Firefox and friends
 text = document.getSelection();
} else if (document.selection) {
 // IE 
 text = document.selection.createRange();
}
if (text == undefined || text == '') {
 // Iterate over all textarea elements and see if one of them has selection
 var areas = document.getElementsByTagName('textarea');
 for(var i = 0; i = areas.length; i++) {
  if(areas[i].selectionStart != undefined && 
     areas[i].selectionStart != areas[i].selectionEnd){
   text = areas[i].value.substring(areas[i].selectionStart, a[i].selectionEnd);
   break;
  }   
 }   
}
// Now if document has selected text, it's in text 
```

所以这适用于跨浏览器（虽然不是很漂亮）。

问题是当文档包含框架或 iframe 时。框架有自己的文档，所以仅仅使用上面的代码是不够的。可能会遍历框架树并在其中一个中搜索选定的文本，但是通常框架可以包含来自不同域的内容，因此即使我要遍历搜索中的根文档的所有框架和所有子框架等选定的文本我没有权限访问他们的 HTML，对吧？所以我无法获得他们选择的文本。

即使页面包含框架，是否有一种（简单）可靠的方法可以在网页上找到所选文本？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T10:47:20.863

为了回答我自己的问题，经过更多调查：因此，如果框架属于不同的域，那么您无能为力，因为您无权访问它们的 dom。然而，在所有框架都在同一个域（例如gmail）的常见情况下，只需像树一样迭代主题。这是完成此操作的代码：

下面的代码用于计算所选文本的字符和单词的书签：

```
javascript:(function(){
  // Function: finds selected text on document d.
  // @return the selected text or null
  function f(d){
    var t;
    if (d.getSelection) t = d.getSelection();
    else if(d.selection) t = d.selection.createRange();
    if (t.text != undefined) t = t.text;
    if (!t || t=='') {
      var a = d.getElementsByTagName('textarea');
      for (var i = 0; i < a.length; ++i) {
        if (a[i].selectionStart != undefined && a[i].selectionStart != a[i].selectionEnd) {
          t = a[i].value.substring(a[i].selectionStart, a[i].selectionEnd);
          break;
        }
      }
    }
    return t;
  };
  // Function: finds selected text in document d and frames and subframes of d
  // @return the selected text or null
  function g(d){
    var t;
    try{t = f(d);}catch(e){};
    if (!t || t == '') {
      var fs = d.getElementsByTagName('frame');
      for (var i = 0; i < fs.length; ++i){
        t = g(fs[i].contentDocument);
        if(t && t.toString() != '') break;
      }
      if (!t || t.toString() == '') {
        fs = d.getElementsByTagName('iframe');
        for (var i = 0; i < fs.length; ++i){
          t = g(fs[i].contentDocument);
          if(t && t.toString() != '') break;
        }
      }
    }
    return t;
  };
  var t= g(document);
  if (!t || t == '') alert('please select some text');
  else alert('Chars: '+t.toString().length+'\nWords: '+t.toString().match(/(\S+)/g).length);
})() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-11T05:52:51.863

@Ran 对您自己的问题的出色回答。但是，如果 iframe 文档未定义，则该函数将失败。我添加了一个条件来检查这一点，现在它适用于我尝试过的每个网站，包括 Gmail。`if ((!t || t == '') && d)`再次感谢伟大的代码。

```
var getSelectedText = function(){
  // Function: finds selected text on document d.
  // @return the selected text or null
  function f(d){
    var t;
    if (d.getSelection) t = d.getSelection();
    else if(d.selection) t = d.selection.createRange();
    if (t.text != undefined) t = t.text;
    if (!t || t=='') {
      var a = d.getElementsByTagName('textarea');
      for (var i = 0; i < a.length; ++i) {
        if (a[i].selectionStart != undefined && a[i].selectionStart != a[i].selectionEnd) {
          t = a[i].value.substring(a[i].selectionStart, a[i].selectionEnd);
          break;
        }
      }
    }
    return t;
  };
  // Function: finds selected text in document d and frames and subframes of d
  // @return the selected text or null
  function g(d){
    var t;
    try{t = f(d);}catch(e){console.log('ERROR: ',e);};
    if ((!t || t == '') && d){
      var fs = d.getElementsByTagName('frame');
      for (var i = 0; i < fs.length; ++i){
        t = g(fs[i].contentDocument);
        if(t && t.toString() != '') break;
      }
      if (!t || t.toString() == '') {
        fs = d.getElementsByTagName('iframe');
        for (var i = 0; i < fs.length; ++i){
          t = g(fs[i].contentDocument);
          if(t && t.toString() != '') break;
        }
      }
    }
    return t;
  };
  var t= g(document);
  if (!t || t == '') ;
  else return t.toString();
} 
```

# python - Python - 线程和 While True 循环

> ID：808746
> 
> 赞同：10
> 
> 时间：2009-04-30T19:57:07.433
> 
> 标签：python, multithreading, loops

我有一个将行附加到 self.output 的线程和一个循环，直到 self.done 为 True （或达到最大执行时间）。

除了使用不断检查是否完成的while循环之外，是否有更有效的方法来做到这一点。while 循环导致 CPU 在运行时飙升至 100%。

```
time.clock()
while True:

    if len(self.output):
        yield self.output.pop(0)

    elif self.done or 15 < time.clock():
        if 15 < time.clock():
            yield "Maximum Execution Time Exceeded %s seconds" % time.clock()
        break 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-30T20:16:46.047

您的线程是否在此处附加到 self.output，而您的主要任务正在使用它们？如果是这样，这是为[Queue.Queue](http://docs.python.org/library/queue.html)量身定做的工作。您的代码应如下所示：

```
import Queue

# Initialise queue as:
queue = Queue.Queue()
Finished = object()   # Unique marker the producer will put in the queue when finished

# Consumer:
try:
    while True:
        next_item = self.queue.get(timeout=15)
        if next_item is Finished: break
        yield next_item

except Queue.Empty:
    print "Timeout exceeded" 
```

您的生产者线程将项目添加到队列中`queue.put(item)`

**[编辑]**原始代码在检查 self.done 时存在竞争问题（例如，在设置标志之前，可能会将多个项目附加到队列中，从而导致代码在第一个退出）。更新了来自 ΤZΩΤZΙΟΥ 的建议 - 生产者线程应该将一个特殊令牌（已完成）附加到队列以指示它已完成。

注意：如果您有多个生产者线程，则需要一种更通用的方法来检测它们何时全部完成。您可以使用相同的策略来完成此操作 - 每个线程都有一个 Finished 标记，并且消费者在看到 num_threads 标记时终止。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T20:04:28.790

使用信号量；让工作线程在完成后释放它，并阻止附加线程，直到工作线程完成信号量。

IE。在工人中，`self.done = threading.Semaphore()`在工作开始时和`self.done.release()`完成时做一些事情。在您上面提到的代码中，而不是忙循环，只需执行`self.done.acquire()`; 当工作线程完成时，控制权将返回。

编辑：不过，恐怕我没有解决您需要的超时值；这个[问题](http://bugs.python.org/issue850728)描述了标准库中信号量超时的需要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T20:01:13.977

使用 time.sleep(seconds) 在 while 循环的每次迭代后创建一个短暂的暂停以放弃 cpu。您必须根据完成后快速完成工作的重要性来设置每次迭代期间的睡眠时间。

例子：

```
time.clock()
while True:

    if len(self.output):
        yield self.output.pop(0)

    elif self.done or 15 < time.clock():
        if 15 < time.clock():
            yield "Maximum Execution Time Exceeded %s seconds" % time.clock()
            break

    time.sleep(0.01) # sleep for 10 milliseconds 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T20:02:55.767

您必须在此处使用同步原语。看这里：[http](http://docs.python.org/library/threading.html) ://docs.python.org/library/threading.html 。

事件对象看起来很简单，应该可以解决您的问题。您还可以使用条件对象或信号量。

我没有发布示例，因为我从未使用过 Event 对象，而且替代方案可能不那么简单。

* * *

**编辑：**我不确定我是否理解您的问题。如果线程可以等到某个条件得到满足，请使用同步。否则`sleep()`，有人发布的解决方案将占用过多的 CPU 时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T20:03:57.527

使用互斥模块或事件/信号量

# javascript - 自己的域之间的 AJAX 跨站点脚本

> ID：808748
> 
> 赞同：1
> 
> 时间：2009-04-30T19:57:09.587
> 
> 标签：javascript, ajax, xss

如果在没有代理黑客、JSONP、Flash 或浏览器安全更改的情况下允许两个自己的域之间的 AJAX？也许是 SSL 之类的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T20:01:17.877

一个签名的 Java 小程序也许可以做到这一点，但这与 Flash 的原理相同，因此可能无法满足您的要求。

[跨域请求](http://www.w3.org/TR/access-control/)有一个规范，但仍处于开发阶段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T20:37:03.267

据我所知，您最好的选择是创建一个服务器资源，您可以将 AJAX 调用定向到该服务器资源，该资源会将它们转发到不同域上的第二台服务器，然后将结果通过隧道返回到您的应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T21:39:55.440

您可以尝试一种称为['Ajast'](http://en.wikipedia.org/wiki/AJAST_(Programming))的技术。

`<script>`基本上，您在域 A 上的 javascript 会根据需要向页面添加额外的标签。这些脚本标签指向域 B 上的 javascript 文件（不必是静态 .js），允许您从域 B 加载数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T22:03:59.500

在我有类似的跨域工作需要的情况下，我通过使用与嵌入页面颜色相同的嵌入式无边框 iframe 来回避它。这是一种古老的技术，早于 AJAX 的广泛使用，现在由于“我们将使用 AJAX”的心态而经常被忽视。然而，你可以用这种方法做很多事情，如果你真的被卡住了，它可能就足够了。当然，您可以在嵌入页面和主页面之间编写一些相当复杂的交互，这在某种程度上可以提供与启用 AJAX 的页面类似的用户体验。

虽然确实发生了一个明显的想法，但我从未尝试过 - 是否可以在主页（即第一个域）内嵌入第二个域的 iframe，并通过嵌入的 iframe 从主页与第二个域进行通信?

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-05T22:15:21.897

只需使用[easyXDM](http://easyxdm.net)，它就可以轻松地在不同域的文档之间进行通信。看看其中一个例子，[http://consumer.easyxdm.net/current/example/methods.html](http://consumer.easyxdm.net/current/example/methods.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-22T20:28:17.633

是的，如果您使用的是 Apache，那么有一个简单的方法。更改 apache 的 httpd-vhosts.conf 文件中的设置（我使用的是 Apache 2.2）

```
<VirtualHost *:80>
ServerAdmin webmaster@dummy-host.com
DocumentRoot “C:/apache-tomcat-6.0.29/webapps/myApplication”
ServerName skill-guru.com
ErrorLog “logs/skg1-error.log”
CustomLog “logs/skg1-access.log” common

Header set Access-Control-Allow-Origin “*”

<Directory “C:/apache-tomcat-6.0.29/webapps/myApplication”&gt;
Options -Indexes FollowSymLinks
AllowOverride AuthConfig FileInfo
Order allow,deny
Allow from all
</Directory>

JkUnmount /*.jsp ajp13

</VirtualHost> 
```

[使用 Apache 编写跨站点脚本](http://www.skill-guru.com/blog/2011/02/04/adding-access-control-allow-origin-to-server-for-cross-domain-scripting/)

# .net - 十进制（20,0）的适当.Net数据类型

> ID：808756
> 
> 赞同：0
> 
> 时间：2009-04-30T19:59:37.023
> 
> 标签：.net, sql-server, ssis, types

我有一些 sql 返回一个 decimal(20,0) 数据类型。在 SSIS 中，我有一个带有 foreach 循环的包。在我的变量映射中，我会将它映射到什么类型的变量？我尝试过 Int32、Int64、double，但仍然收到错误“分配给变量“User::iID”的值的类型与当前变量类型不同...”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T20:01:34.070

你试过十进制了吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-22T07:41:56.207

在我的例子中，SSIS 变量设计器没有显示 Decimal 或 Numeric 数据类型以选择将我的 decimal(18,2) 值放入其中。

我将变量更改为 Object，并且能够从一个存储过程的结果集中读取 Decimal(18,2) 值，并将其作为 Money 类型的参数传递给第二个 SP。

因此，如果您在变量列表中找不到适合您的类型，我会使用“对象”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T20:13:09.207

SSIS 确实有 Decimal 和 Numeric 类型。您可以使用其中任何一个，它都会通过（可能在 Union All 上除外，您应该确保它们具有相同的精度和比例）。

[在此处](http://msdn.microsoft.com/en-us/library/ms141036.aspx)查看有关数据类型的更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T20:05:52.250

.NET decimal 有方法**decimal.ToInt64()**、**decimal.ToInt32()**等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T20:08:12.213

我的建议是浮点数或小数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T20:08:50.293

SQL decimal(20,0) 的精度为 20，相当于 13 个字节的存储空间。.Net 十进制是 16 个字节，应该可以工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-30T20:03:59.197

在将 SQL 数据类型放入 Int64 包变量之前，您需要将其转换为 Int64。

你是如何得到它的，作为一个输出参数？

在数据流中，您显然会将其读入十进制/数字，然后在数据转换组件中转换为 Int64。

如果您尝试直接从执行 SQL 命令任务映射输出参数，您可能必须使用临时对象包变量，然后在脚本任务中将其转换为真正的 Int64 包变量。

# .net - 线程化的图像缩放子仍然让 UI 陷入困境

> ID：808768
> 
> 赞同：1
> 
> 时间：2009-04-30T20:01:33.757
> 
> 标签：.net, vb.net, multithreading, graphics

我为我的老板创建了一个图像查看控件，其中包含平移、通过鼠标滚轮缩放和绘制一个框以进行缩放。该控件需要支持非常大的图像文件（即每边几千像素）。

一切正常，但每当代码缩放图像时，控制 UI 就会变得无响应。我的老板让我使用线程将缩放代码与 UI 分开。缩放代码现在肯定在一个单独的线程上，但 UI 仍然在缩放代码运行时陷入困境！谁能帮我解决这个问题？？

下面是缩放代码。如果这还不足以帮助我，请告诉我，我会发布您需要的任何代码！

更新：这是完整的控制代码。 [链接文本](http://www.2shared.com/file/5570562/25a25962/ZoomPictureBox.html)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T20:05:05.793

我怀疑由于缩放使用了 UI 陷入困境的所有 CPU。两个线程可能具有相同的优先级。

尝试降低缩放线程的优先级以允许 UI 响应。

```
Values for Thread Priority:

Above Normal -> Gives thread higher priority
Below Normal ->Gives thread lower priority
Normal -> Gives thread normal priority
Lowest -> Gives thread lowest priority
Highest -> Gives thread highest priority

so you would probably use:

Thread1.Priority=System.Threading.ThreadPriority.BelowNormal 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T20:19:44.090

尝试改用它。

```
Private Sub Worker(object o)
    Dim args as ScaleImageArguments
    args = CType(o, ScaleImageArguments) 
    ScaleImage(args)
End Sub

Private Sub RunScaleImageAsync(ByVal img As Image, ByVal scale As Double)
    System.Threading.ThreadPool.QueueUserWorkItem(Worker, _
                 New ScaleImageArguments(img.Clone, scale))
End Sub 
```

**ALTERNATIVE** - 使用异步模式。

```
Private Delegate Sub ScaleImageDelegate(ByRef arg As ScaleImageArguments)

Private Sub BeginScaleImage(ByRef img As Image, ByVal scale As Double)
    Dim d As ScaleImageDelegate
    d = New ScaleImageDelegate(AddressOf ScaleImage)

    d.BeginInvoke(New ScaleImageArguments(img.Clone, scale), _
                  New AsyncCallback(AddressOf EndScaleImage), d)        
End Sub

Private Sub EndScaleImage(ar As IAsyncResult)
    Dim d As ScaleImageDelegate
    d = CType(ar.AsyncState, ScaleImageDelegate)
    d.EndInvoke(ar)
End Sub 
```

然后只需调用 BeginScaleImage 即可异步运行它。

**编辑**- 请参阅上面的更正。EndScaleImage 上的 ar 参数应声明为 ByRef，并且还应声明 BeginScaleImage 的 img 参数。没有理由让它们通过 ByVal！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T20:22:15.720

您的 ImageScaled() 如何将图像显示回 UI？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-01T14:24:21.347

GDI+ API 中似乎存在一些全局锁定。为了测试，我根据以下函数创建了两个线程

```
静态无效测试线程（）
{
    位图 bmp = 新位图 (4000, 4000);
    图形 g = Graphics.FromImage( bmp );
    画笔 b = 画笔.红色；

    为了 （ ; ; ） {
        g.FillRectangle(b, 0, 0, bmp.Width, bmp.Height);
    }
}

```

如果无限循环留空，则 CPU 使用率超过 90%，因此他们使用了我 CPU 的两个内核。在存在 FillRectangle 的情况下，使用率略低于 50%，表明一次只能运行一个线程。

因此，在进行缩放时，您从 GUI 线程执行的任何 GDI+ 调用都可能会阻塞，直到缩放完成。

# c# - 在 C# 中进行 Windows 高亮搜索

> ID：808779
> 
> 赞同：3
> 
> 时间：2009-04-30T20:04:03.503
> 
> 标签：c#, windows, search, wds

是否有可能通过 c# 实际进行 Windows 搜索（您在 Vista 中从带有高亮显示的菜单中找到的搜索（例如，您编写 'fire' 并获得 'firefox'））。

谢谢 ：）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T20:50:27.790

是的，这可以通过 Windows 桌面搜索 (WDS) API 实现。您将需要[SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=645300AE-5E7A-4CE7-95F0-49793F8F76E8&displaylang=en)，如果我没记错的话，它甚至提供了一个 .Net 程序集。然后查看[文档](http://msdn.microsoft.com/en-us/library/bb266517(VS.85).aspx)了解如何查询 WDS 索引。这很简单，这是他们提供的 C# 示例：

```
OleDbConnection conn = new OleDbConnection(
    "Data Source=(local);Initial Catalog=Search.CollatorDSO;Integrated Security=SSPI;User ID=<username>;Password=<password>");

OleDbDataReader rdr = null;

conn.Open();

OleDbCommand cmd = new OleDbCommand("SELECT Top 5 System.ItemPathDisplay FROM SYSTEMINDEX", conn);

rdr = cmd.ExecuteReader();

while (rdr.Read())
{
    Console.WriteLine(rdr[0]);
}

rdr.Close();
conn.Close(); 
```

当我不久前在一个项目中使用它时，我使用的查询字符串是这样构建的：

```
CSearchManager SearchManager = new CSearchManager();
CSearchCatalogManager CatalogManager = SearchManager.GetCatalog("SystemIndex");
CSearchQueryHelper QueryHelper = CatalogManager.GetQueryHelper();
string connection_string = QueryHelper.ConnectionString; 
```

然后做一个简单的文件搜索：

```
QueryHelper.QueryWhereRestrictions = "AND scope='file:'";
QueryHelper.QuerySorting = "System.ItemNameDisplay ASC";
string sqlQuery = QueryHelper.GenerateSQLFromUserQuery(Filename); 
```

从文档中，您可以了解如何构建查询以获得所需的结果。

现在，一个简短的说明。我能够构建一个 Vista 开始搜索克隆，但是，我首先在 Vista 存储开始菜单链接的位置扫描链接文件（%appdata%\Microsoft\Windows\Start Menu & C:\ProgramData\Microsoft\Windows \Start Menu），然后在后台异步加载 WDS 结果，这比仅依赖 WDS 更好地复制开始搜索行为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T20:34:34.897

Windows 搜索使用索引通过在搜索字段中的文本更新时查询索引来获得结果。为了使其工作，引擎必须能够非常快速地返回结果，因此对于查找非常有效的集合是一个好主意。

然后，当搜索框中的文本发生更改时，您将查询哈希表。

# ruby - 使用 Apache 和 mod_ext_filter，需要根据查询字符串动态替换静态文件的值

> ID：808784
> 
> 赞同：0
> 
> 时间：2009-04-30T20:05:25.620
> 
> 标签：ruby, apache

我有一种情况，我需要根据传入的查询字符串参数之一来更改缓存文件的内容。我很想使用 sed 对基于所述的值进行简单的正则表达式替换争论，但我想不出那个。我可以使用 ruby​​ 脚本为我进行替换，但似乎无法访问脚本中请求的查询字符串。mod_ext_filter 的文档说：

> 除了标准的 CGI 环境变量之外，`DOCUMENT_URI`还将为程序设置 、`DOCUMENT_PATH_INFO`和。`QUERY_STRING_UNESCAPED`

嗯，是的，似乎无法访问这些。

有没有人有这方面的经验，或者有没有人有更好的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-01T17:37:46.187

嗬！看起来我只需要访问`ENV`ruby​​ 中的变量。我真傻。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T20:16:32.257

使用 PHP 脚本语言服务器功能，我们可以获取查询字符串值。 `echo $_SERVER['REQUEST_URI'];` 并将 URL 参数作为变量传递给文件并使其动态化。

参考：[PHP.net](http://in.php.net/reserved.variables.server)

# javascript - Jquery在悬停时淡出背景？

> ID：808790
> 
> 赞同：6
> 
> 时间：2009-04-30T20:07:46.053
> 
> 标签：javascript, jquery, css

有一个没有背景的链接和一个 css 规则，它在悬停时改变背景。

父 bg 为白色，悬停时链接 - 蓝色。

**我怎样才能慢慢地做一个悬停效果**，从白色到蓝色？

谢谢。

```
li a {}
li a:hover { background: blue; } 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-30T20:11:32.783

```
jQuery('a#theLink').hover(function(){
    $(this).stop().animate({backgroundColor: 'blue'});
}, function() {
    $(this).stop().animate({backgroundColor: 'white'});
}); 
```

为此，您需要下载 jQuery 的“**[颜色插件](http://plugins.jquery.com/project/color)**”。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-30T20:15:08.657

您不需要额外的颜色插件。你只需要在 jQuery 之上的 jQuery UI，它可以让你在颜色上做动画。（或者，如果您出于某种原因不想使用 jQuery UI，我想另一个插件可以解决问题。但我已经成功地尝试过，只包含 jQuery 核心和 jQuery UI。）

动画本身就像......

```
$("li").hover(function() {
  $(this).animate({
    backgroundColor: "#ffffff"
  }, 'slow');
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-23T14:55:32.673

bgFade 一个非常棒且简单的插件，可以为背景图像设置动画：

[http://www.isthatclear.com/jquery/bgFade/](http://www.isthatclear.com/jquery/bgFade/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T20:10:12.257

为了动画颜色，你需要[颜色插件](http://plugins.jquery.com/project/color)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T20:12:34.730

您需要使用插件，因为 JQuery 无法为开箱即用的颜色设置动画。

试试[颜色动画插件](http://plugins.jquery.com/project/color)

然后它会是这样的：

```
$(this).animate({ backgroundColor: "blue" }, 'slow'); 
```

# c# - 如何在 C# 中使用图像热点？

> ID：808801
> 
> 赞同：0
> 
> 时间：2009-04-30T20:11:53.717
> 
> 标签：c#, image

我正在尝试使用 C# 中的热点来检测鼠标点击投注表。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T20:16:51.770

您应该能够使用以下内容定义“热点”：

*   定义“边界框”左上角和右下角的两个点
*   定义边界框左上角位置的偏移量，因为它与图像左上角最远的点相关

如果这是一个 Windows 窗体应用程序，您应该能够在用户将鼠标悬停在该区域上时使用透明图像来“突出显示”该区域。在使用 javascript 的 Web 应用程序中还有其他技术。

# version-control - svk 校验和不匹配

> ID：808803
> 
> 赞同：0
> 
> 时间：2009-04-30T20:12:25.683
> 
> 标签：version-control, svk

在过去的 6 个月里，我一直在使用 SVK，没有任何问题。然后我尝试提交一个文件，但出现以下错误：

```
%> svk commit -m "Message" foo/bar/file.txt
Commit into mirrored path: merging back directly.
Merging back to mirror source file:///usr/local/svn/repo.
A checksum mismatch occurred: Base checksum mismatch on '/trunk/foo/bar/file.txt':
   expected:  9e421f7db5c4c0d6796c90524456d7f4
     actual:  ed4e76ccf3e54223908179735ecf1e89 
```

有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T20:22:39.153

只需要**svk up -s**，在这里找到答案：

[在多用户环境中使用 SVK](http://kbase.wincent.com/old/knowledge-base/Working_with_SVK_in_a_multi-user_environment.html)

> ... svk up 不足以确保您的软件仓库反映远程存储库中的最新更改。相反，您必须执行 svk 同步（有关选项的信息，请参阅 svk 帮助同步）以使本地软件仓库保持最新，或者将 -s 开关传递给 svk up 以实现相同的效果...

```
# alternative 1:
svk sync //mirrors/mirrored_repo_name
svk up

# alternative 2:
svk up -s 
```

# excel - Excel 问题 - 计算值作为单元格引用

> ID：808809
> 
> 赞同：4
> 
> 时间：2009-04-30T20:14:37.283
> 
> 标签：excel, reference, cell

我对 excel 编程比较陌生。我正在制作一个显示指数衰减的电子表格。我在每个单元格中使用 TRUNC(RAND()*10,0) 在 1 和 10 之间有一列 (A1:A1000) 的 1000 个随机数。下一列 (B1:B1000) 有一个逻辑掩码 =IF(A1=0,1,0) ，其中如果 A 单元格中的值为 0，则 B 单元格显示 1。接下来，要找到A 列中有 0，下一列取 B1:B1000 的总和，它返回第一列中出现的 0 的数量。我确信有一种更简单的方法可以做到这一点，但这似乎工作正常。

这是我的问题，希望很清楚我在问什么：

接下来，我想在计算 sum(B1:B1000) 的单元格下方的单元格中从 B1:B(1000- (B1:1000)) 中获取逻辑列 (B) 的总和。有没有办法在单元格公式中使用代数来引用单元格？更简单地说，如果我想引用 A3，例如，有没有办法输入 A(2+1) 之类的东西来获得 A3？这有意义吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-30T20:18:40.067

在 VBA 中，您可以很容易地做到：

```
ActiveCell.Formula = "=A" & (2+1) & "+15" 
```

在 Excel 中：

```
=INDIRECT(ADDRESS(2+1, COLUMN(A1)))+15 
```

这会将公式设置为“=A3+15”。一般来说，这最好用变量来完成，所以请记住这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-10-19T23:24:18.053

在 Excel 中，正如 Eric 所指出的，由于`INDIRECT()`函数，您可以像普通字符串一样编写对单元格的引用。

只需确保传递给的字符串`INDIRECT()`是有效的单元格引用。

例如 ：

`=SUM(INDIRECT("B" & 2+7*(H2-1)):INDIRECT("B"&(2+7*H2)-1))`

在这里，我每周总结 7 行 ( `H2`)。它给出`B2:B8`, `B9:B15`,`B16:B22`等的总和。

希望我的例子能帮助你弄清楚如何在实际情况下使用它。

# java - 为什么要“将类的实例作为实体存储在数据库中”？

> ID：808815
> 
> 赞同：2
> 
> 时间：2009-04-30T20:16:12.333
> 
> 标签：java, database, persistence, object-persistence

我试图从[Google Datastore API](http://code.google.com/appengine/docs/java/datastore/overview.html)中理解一行：

> JDO 使用 Java 类上的注释来描述类的实例如何作为实体存储在数据存储中，以及在从数据存储中检索实体时如何将实体重新创建为实例。

我敢肯定，对于大多数人来说，这是一个非常基本的问题。但我不明白为什么类对象需要存储在数据库中，然后再检索。为什么不改为定义您希望应用程序的数据存储看起来像什么，并根据需要仅存储类属性中的相关数据，而不是存储整个类或总是重复存储相同的属性？类的实例包含各种信息，在我看来，这些信息不需要在数据库中——方法、类变量、实例变量——我们在源代码中编写这些东西，我们不需要重现它在数据库中 - 我们只需要存储该类正在操作的某些相关数据。对？也许我不明白引用的陈述是什么意思。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T20:20:17.193

> 为什么不改为定义您希望应用程序的数据存储看起来像什么，并根据需要仅存储类属性中的相关数据，而不是存储整个类或总是重复存储相同的属性？

这正是您引用的实际含义：

> JDO 使用 Java 类上的注释来描述类的实例如何作为实体存储在数据存储中，以及在从数据存储中检索实体时如何将实体重新创建为实例。

您使用注释说“存储字段 X”、“忽略字段 Y”等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T20:20:32.107

Google Datastore 不是标准的关系数据库，如 SQL Server 或 Oracle。实体是根据它们的定义存储的，而不是传统的首先创建模式，然后将对象映射到模式的方法。我不认为私有成员或方法与数据一起存储，所以它不像整个对象，包括方法，被序列化到数据存储中。

# javascript - 脚本标签内的 HTML 注释是最佳实践吗？

> ID：808816
> 
> 赞同：102
> 
> 时间：2009-04-30T20:16:17.763
> 
> 标签：javascript, html

以下做法在我必须使用的内联 JavaScript 中相当普遍：

```
<script type="text/javascript">
   <!--
       // Code goes here
   //-->
</script> 
```

我知道重点是防止与 JavaScript 不兼容的浏览器呈现源代码，但这仍然是今天的最佳做法吗？今天使用的绝大多数浏览器都可以解释 JavaScript；即使是现代移动设备通常也没有问题。

至于'为什么不呢？问题：我最近不得不花费几个小时来调试一个问题，其中有人在深埋在某些页面中的脚本标签末尾的“-->”前面留下了“//”，这导致了神秘的 JavaScript错误。

你做什么工作？这仍然被认为是“最佳实践”吗？

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2009-04-30T20:23:02.397

The important thing is that nowadays, whether a particular browser supports JavaScript or not is irrelevant (clearly the great majority do) - it is irrelevant because almost *all* understand script blocks, which means that they know to ignore the JavaScript even if they can't interpret it.

Matt Kruse gives a slightly [more detailed explanation](http://www.javascripttoolbox.com/bestpractices/#comments) on his *JavaScript Toolbox* site for why specifically *not* to use HTML comments within script blocks.

Quoted from that page:

* * *

## Don't Use HTML Comments In Script Blocks

In the ancient days of javascript (1995), some browsers like Netscape 1.0 didn't have any support or knowledge of the script tag. So when javascript was first released, a technique was needed to hide the code from older browsers so they wouldn't show it as text in the page. The 'hack' was to use HTML comments within the script block to hide the code.

**Using HTML Comments In Script Is Bad**

```
// DON'T do this! Code is just representative on how things were done
<script language="javascript">
<!--
   // code here
//-->
</script> 
```

No browsers in common use today are ignorant of the <script> tag, so hiding of javascript source is no longer necessary. In fact, it can be considered harmful for the following reasons:

*   Within XHTML documents, the source will actually be hidden from all browsers and rendered useless
*   -- is not allowed within HTML comments, so any decrement operations in script are invalid

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-30T20:18:47.303

我已经停止这样做了。在某些时候，您只需要放开您的 NCSA Mosaic。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-30T20:37:38.197

As per **W3C Recommendation** it was mainly useful to hide the script data from USER AGENTS.

Quoted from the [W3c page](http://www.w3.org/TR/REC-html40/interact/scripts.html#h-18.3.2) :

*Commenting scripts in JavaScript The JavaScript engine allows the string `"<!--"` to occur at the start of a SCRIPT element, and ignores further characters until the end of the line. JavaScript interprets "//" as starting a comment extending to the end of the current line. This is needed to hide the string "-->" from the JavaScript parser.*

```
 <SCRIPT type="text/javascript">
<!--  to hide script contents from old browsers
  function square(i) {
    document.write("The call passed ", i ," to the function.","<BR>")
    return i * i
  }
  document.write("The function returned ",square(5),".")
// end hiding contents from old browsers  -->
</SCRIPT> 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-30T20:26:10.953

No, it is a hangover from a workaround used when the script element was first introduced. No browser fails to understand the script element today (even if it understands it as "Script that should be ignored because scripting is turned off or unsupported").

In XHTML, they are actively harmful.

I wrote something about [the history of it](http://dorward.me.uk/www/comments-cdata/) a while back.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-30T20:28:13.320

Stopped using this a while back. Also, according to [Douglas Crockford](http://www.crockford.com/), you can [drop the type attribute](http://www.sitepoint.com/blogs/2008/05/13/javascript-mime-type-damned-if-you-do-damned-if-you-dont/) from your script tags since the only scripting language available in most browsers is JavaScript.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-06T08:43:49.313

I would recommend using a CDATA section, as described in [this question](https://stackoverflow.com/questions/66837/javascript-cdata-tags).

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-30T20:21:41.510

如果您手动输入，我建议您始终使用外部 js 文件，这会很有帮助。

关于您的担忧：当今大多数浏览器都是 JavaScript 安全的。然而，有时人们可能会编写简单的解析器来直接获取 HTML ——我必须说，安全引用对那些客户真的很有帮助。此外，一些非 JS 客户端（如旧 Lynx）也会从中受益。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-01T02:27:04.643

If you do not include literal text between script tags- that is, if you load scripts from src files, you can forget about the comments.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-30T20:20:51.293

我很久以前就停止这样做了。在这个时代，你真的不需要它。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-30T20:21:17.470

我不这样做，但前几天我去 w3c 验证我的受密码保护的站点。所以我不得不使用他们的直接输入法。它抱怨我的javascript，所以我把评论放回去一切都很好。

# linux - 如何判断按钮是否在 OpenGL/Glut 中被按住？(Linux)

> ID：808825
> 
> 赞同：2
> 
> 时间：2009-04-30T20:17:10.553
> 
> 标签：linux, opengl, glut

这是一个类似的问题：通过调用 GetAsyncKeyState() 解决的[链接。](https://stackoverflow.com/questions/724156/keyboard-input-hesitation-when-held-down)
虽然一切都很好，但我需要一个 Linux 替代品。我需要知道按钮是否被*按住*，而不仅仅是被按下（因为键盘缓冲区延迟）。

OpenGL/Glut 库中是否存在类似的东西，还是我必须在别处寻找？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T20:29:49.197

我从来没有用过 Glut，但我知道很多人会说[SDL](http://www.libsdl.org/)更好。我使用过 SDL，我非常喜欢它。它完成了 Glut 所做的一切以及更多。在 SDL 中，您可以使用`SDL_PollEvent()`在没有键盘缓冲区延迟的情况下获取键状态。

编辑：我对 Glut 几乎一无所知，但看起来您可以[`glutKeyboardFunc`](http://www.opengl.org/resources/libraries/glut/spec3/node49.html)用来检测普通键，以及[`glutSpecialFunc`](http://www.opengl.org/resources/libraries/glut/spec3/node54.html)不生成 ASCII 字符的键（例如 shift）。我不确定是否有更好的方法，因为这看起来不太好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T20:20:47.783

您可以检测何时发生按键事件，记录该状态，然后侦听按键释放事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-31T12:11:33.340

如前所述，您必须制作自己的状态机，这很容易。但是我认为你还需要使用这个回调方法。

[http://pyopengl.sourceforge.net/documentation/manual/glutKeyboardUpFunc.3GLUT.xml](http://pyopengl.sourceforge.net/documentation/manual/glutKeyboardUpFunc.3GLUT.xml)

# javascript - 在画布标签上绘制箭头

> ID：808826
> 
> 赞同：60
> 
> 时间：2009-04-30T20:18:02.500
> 
> 标签：javascript, html5-canvas, drawing

我想使用画布标签 javascript 绘制一个箭头。我已经使用二次函数完成了它，但是我在计算箭头的旋转角度时遇到了问题......

有人对此有任何线索吗？

谢谢

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2011-06-13T17:13:28.853

尽可能简单。您必须自己添加 context.beginPath() 并添加 context.stroke() ：

```
ctx = document.getElementById("c").getContext("2d");
ctx.beginPath();
canvas_arrow(ctx, 10, 30, 200, 150);
canvas_arrow(ctx, 100, 200, 400, 50);
canvas_arrow(ctx, 200, 30, 10, 150);
canvas_arrow(ctx, 400, 200, 100, 50);
ctx.stroke();

function canvas_arrow(context, fromx, fromy, tox, toy) {
  var headlen = 10; // length of head in pixels
  var dx = tox - fromx;
  var dy = toy - fromy;
  var angle = Math.atan2(dy, dx);
  context.moveTo(fromx, fromy);
  context.lineTo(tox, toy);
  context.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
  context.moveTo(tox, toy);
  context.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
}
```

```
<html>

<body>
  <canvas id="c" width="500" height="500"></canvas>

</body>
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2014-09-28T00:27:06.113

好的，所以当我试图自己解决这个问题时，这个页面上的第一个答案对我有很大帮助，尽管正如其他人已经说过的，如果你的线宽大于 1px，你会得到有趣的形状。其他人建议的修复方法几乎奏效了，但是在尝试使用更粗的箭头时我仍然遇到了一些问题。在玩了几个小时之后，我能够将上述解决方案与我自己的一些修补程序结合起来，提出以下代码，可以在不扭曲箭头形状的情况下以你想要的任何厚度绘制箭头。

```
function drawArrow(fromx, fromy, tox, toy){
                //variables to be used when creating the arrow
                var c = document.getElementById("myCanvas");
                var ctx = c.getContext("2d");
                const width = 22;
                var headlen = 10;
                // This makes it so the end of the arrow head is located at tox, toy, don't ask where 1.15 comes from
                tox -= Math.cos(angle) * ((width*1.15));
                toy -= Math.sin(angle) * ((width*1.15));

                var angle = Math.atan2(toy-fromy,tox-fromx);

                //starting path of the arrow from the start square to the end square and drawing the stroke
                ctx.beginPath();
                ctx.moveTo(fromx, fromy);
                ctx.lineTo(tox, toy);
                ctx.strokeStyle = "#cc0000";
                ctx.lineWidth = width;
                ctx.stroke();

                //starting a new path from the head of the arrow to one of the sides of the point
                ctx.beginPath();
                ctx.moveTo(tox, toy);
                ctx.lineTo(tox-headlen*Math.cos(angle-Math.PI/7),toy-headlen*Math.sin(angle-Math.PI/7));

                //path from the side point of the arrow, to the other side point
                ctx.lineTo(tox-headlen*Math.cos(angle+Math.PI/7),toy-headlen*Math.sin(angle+Math.PI/7));

                //path from the side point back to the tip of the arrow, and then again to the opposite side point
                ctx.lineTo(tox, toy);
                ctx.lineTo(tox-headlen*Math.cos(angle-Math.PI/7),toy-headlen*Math.sin(angle-Math.PI/7));

                //draws the paths created above
                ctx.strokeStyle = "#cc0000";
                ctx.lineWidth = width;
                ctx.stroke();
                ctx.fillStyle = "#cc0000";
                ctx.fill();
            } 
```

现在这是我在程序中使用的代码。我发现消除失真问题的关键是继续从箭头的尖端到一侧点，到另一侧点，回到尖端，然后回到第一个侧点，然后做一个充满。这修正了箭头的形状。

希望这可以帮助！

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2016-04-23T01:22:34.210

这是另一种绘制箭头的方法。它使用此处的三角形方法：[https ://stackoverflow.com/a/8937325/1828637](https://stackoverflow.com/a/8937325/1828637)

一个小助手功能。

```
function canvas_arrow(context, fromx, fromy, tox, toy, r){
    var x_center = tox;
    var y_center = toy;

    var angle;
    var x;
    var y;

    context.beginPath();

    angle = Math.atan2(toy-fromy,tox-fromx)
    x = r*Math.cos(angle) + x_center;
    y = r*Math.sin(angle) + y_center;

    context.moveTo(x, y);

    angle += (1/3)*(2*Math.PI)
    x = r*Math.cos(angle) + x_center;
    y = r*Math.sin(angle) + y_center;

    context.lineTo(x, y);

    angle += (1/3)*(2*Math.PI)
    x = r*Math.cos(angle) + x_center;
    y = r*Math.sin(angle) + y_center;

    context.lineTo(x, y);

    context.closePath();

    context.fill();
} 
```

这是一个在行首和行尾绘制箭头的演示。

```
var can = document.getElementById('c');
var ctx = can.getContext('2d');

ctx.lineWidth = 10;
ctx.strokeStyle = 'steelblue';
ctx.fillStyle = 'steelbllue'; // for the triangle fill
ctx.lineJoin = 'butt';

ctx.beginPath();
ctx.moveTo(50, 50);
ctx.lineTo(150, 150);
ctx.stroke();

canvas_arrow(ctx, 50, 50, 150, 150, 10);
canvas_arrow(ctx, 150, 150, 50, 50, 10);

function canvas_arrow(context, fromx, fromy, tox, toy, r){
	var x_center = tox;
	var y_center = toy;

	var angle;
	var x;
	var y;

	context.beginPath();

	angle = Math.atan2(toy-fromy,tox-fromx)
	x = r*Math.cos(angle) + x_center;
	y = r*Math.sin(angle) + y_center;

	context.moveTo(x, y);

	angle += (1/3)*(2*Math.PI)
	x = r*Math.cos(angle) + x_center;
	y = r*Math.sin(angle) + y_center;

	context.lineTo(x, y);

	angle += (1/3)*(2*Math.PI)
	x = r*Math.cos(angle) + x_center;
	y = r*Math.sin(angle) + y_center;

	context.lineTo(x, y);

	context.closePath();

	context.fill();
}
```

```
<canvas id="c" width=300 height=300></canvas>
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-30T23:35:47.860

你可以做：

```
ctx.save();
ctx.translate(xOrigin, yOrigin);
ctx.rotate(angle);
 // draw your arrow, with its origin at [0, 0]
ctx.restore(); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2020-11-09T17:21:34.267

Typescript 版本，当行宽 >> 1 时有固定的箭头提示

```
function canvas_arrow( context, fromx, fromy, tox, toy ) {
    const dx = tox - fromx;
    const dy = toy - fromy;
    const headlen = Math.sqrt( dx * dx + dy * dy ) * 0.3; // length of head in pixels
    const angle = Math.atan2( dy, dx );
    context.beginPath();
    context.moveTo( fromx, fromy );
    context.lineTo( tox, toy );
    context.stroke();
    context.beginPath();
    context.moveTo( tox - headlen * Math.cos( angle - Math.PI / 6 ), toy - headlen * Math.sin( angle - Math.PI / 6 ) );
    context.lineTo( tox, toy );
    context.lineTo( tox - headlen * Math.cos( angle + Math.PI / 6 ), toy - headlen * Math.sin( angle + Math.PI / 6 ) );
    context.stroke();
} 
```

[![在此处输入图像描述](https://i.stack.imgur.com/VlAqy.png)](https://i.stack.imgur.com/VlAqy.png)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2017-10-03T01:35:29.600

```
var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');

ctx.clearRect(0, 0, canvas.width, canvas.height);	
arrow({x: 10, y: 10}, {x: 100, y: 170}, 10);
arrow({x: 40, y: 250}, {x: 10, y: 70}, 5);

function arrow (p1, p2, size) {
  var angle = Math.atan2((p2.y - p1.y) , (p2.x - p1.x));
  var hyp = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));

  ctx.save();
  ctx.translate(p1.x, p1.y);
  ctx.rotate(angle);

  // line
  ctx.beginPath();	
  ctx.moveTo(0, 0);
  ctx.lineTo(hyp - size, 0);
  ctx.stroke();

  // triangle
  ctx.fillStyle = 'blue';
  ctx.beginPath();
  ctx.lineTo(hyp - size, size);
  ctx.lineTo(hyp, 0);
  ctx.lineTo(hyp - size, -size);
  ctx.fill();

  ctx.restore();
}
```

```
<canvas id = "canvas" width = "300" height = "400"></canvas>
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-12-26T09:44:06.907

给定大小和起始位置，以下代码将为您绘制箭头。

```
function draw_arrow(context, startX, startY, size) {
  var arrowX = startX + 0.75 * size;
  var arrowTopY = startY - 0.707 * (0.25 * size);
  var arrowBottomY = startY + 0.707 * (0.25 * size);
  context.moveTo(startX, startY);
  context.lineTo(startX + size, startX);
  context.lineTo(arrowX, arrowTopY);
  context.moveTo(startX + size, startX);
  context.lineTo(arrowX, arrowBottomY);
  context.stroke();
}
window.onload = function() {
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  var startX = 50;
  var startY = 50;
  var size = 100;
  context.lineWidth = 2;
  draw_arrow(context, startX, startY, size);
};
```

```
body {
  margin: 0px;
  padding: 0px;
}

#myCanvas {
  border: 1px solid #9C9898;
}
```

```
<!DOCTYPE HTML>
<html>

<body onmousedown="return false;">
  <canvas id="myCanvas" width="578" height="200"></canvas>
</body>

</html>
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-04-23T14:20:37.890

这段代码类似于 Titus Cieslewski 的解决方案，也许箭头更好一些：

```
function canvasDrawArrow(context, fromx, fromy, tox, toy) {
    var headlen = 10.0;
    var back = 4.0;
    var angle1 = Math.PI / 13.0;
    var angle2 = Math.atan2(toy - fromy, tox - fromx);
    var diff1 = angle2 - angle1;
    var diff2 = angle2 + angle1;
    var xx = getBack(back, fromx, fromy, tox, toy);
    var yy = getBack(back, fromy, fromx, toy, tox);

    context.moveTo(fromx, fromy);
    context.lineTo(tox, toy);

    context.moveTo(xx, yy);
    context.lineTo(xx - headlen * Math.cos(diff1), yy - headlen * Math.sin(diff1));

    context.moveTo(xx, yy);
    context.lineTo(xx - headlen * Math.cos(diff2), yy - headlen * Math.sin(diff2));
}

function getBack(len, x1, y1, x2, y2) {
    return x2 - (len * (x2 - x1) / (Math.sqrt(Math.pow(y2 - y1, 2) + Math.pow(x2 - x1, 2))));
} 
```

这适用于`lineWidth > 1`. `x`画轴的时候可以派上`y`用场

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-12-23T08:59:17.663

```
function RTEShape()
{   
    this.x = 50;
  this.y = 50;
  this.w = 100; // default width and height?
  this.h = 100;
  this.fill = '#444444';
  this.text = "Test String";
  this.type;
  this.color;
  this.size = 6;    

    // The selection color and width. Right now we have a red selection with a small width
    this.mySelColor = '#CC0000';
    this.mySelWidth = 2;
    this.mySelBoxColor = 'darkred';// New for selection boxes
    this.mySelBoxSize = 6;
}

RTEShape.prototype.buildArrow = function(canvas)
{
    this.type = "arrow";

  // Make sure we don't execute when canvas isn't supported
  if (canvas.getContext){

    // use getContext to use the canvas for drawing
    var ctx = canvas.getContext('2d');           

    var oneThirdX = this.x + (this.w/3);             
    var twoThirdX = this.x + ((this.w*2)/3);

    var oneFifthY = this.y - (this.y/5);    
    var twoFifthY = this.y - ((this.y*3)/5);

    /**/
    //ctx.beginPath();
    ctx.moveTo(oneThirdX,this.y); // 125,125
    ctx.lineTo(oneThirdX,oneFifthY); // 125,105

    ctx.lineTo(this.x*2,oneFifthY); // 225,105      
    ctx.lineTo(this.x*2,twoFifthY); // 225,65

    ctx.lineTo(oneThirdX,twoFifthY); // 125,65      
    ctx.lineTo(oneThirdX,(this.y/5)); // 125,45

    ctx.lineTo(this.x,(this.y+(this.y/5))/2); // 45,85

        ctx.fillStyle = "green";
    ctx.fill();

    ctx.fillStyle = "yellow";
    ctx.fillRect(this.x,this.y,this.w,this.h);

  } else {
    alert('Error on buildArrow!\n'+err.description);
  }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-01-31T07:54:47.100

您好，非常感谢您的建议。

我可以建议你放弃笨重的 atan 吗？您也可以使用线性代数来增加或减少角度：

```
var cospix=0.866025404; //cosinus of pi/6

function canvas_arrow(context, fromx, fromy, tox, toy) {
ctx.strokeStyle = '#AA0000';
var headlen = 10; // length of head in pixels
var dx = tox - fromx;
var dy = toy - fromy;
var length = Math.sqrt(dy*dy + dx*dx); //length of arrow
var sina = dy/length, cosa = dx/length; //computing sin and cos of arrow angle
var cosp=cosa*cospix-0.5*sina, cosm=cosa*cospix+0.5*sina,
sinp=cosa*0.5+cospix*sina, sinm=cospix*sina-cosa*0.5;
//computing cos and sin of arrow angle plus pi/6, respectively minus pi/6
//(p for plus, m for minus at the end of variable's names)
context.moveTo(fromx, fromy);
context.lineTo(tox, toy);
context.lineTo(tox - headlen * cosm, toy - headlen * sinm); //computing coordinates using the cos and sin computed above
context.moveTo(tox, toy);
context.lineTo(tox - headlen * cosp, toy - headlen * sinp); //computing coordinates using the cos and sin computed above
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-30T21:29:29.803

你可以推动你的矩阵，旋转它，画你的箭头，然后弹出矩阵。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-10-26T11:19:14.900

我已经为此苦苦挣扎了一段时间。我需要在 javascript 和 c# 中都这样做。对于 javascript，我发现了一个不错的库[jCanvas](https://projects.calebevans.me/jcanvas/)。

我的主要问题是绘制漂亮的箭头，jCanvas 做得很好。对于我的 c# 项目，我对 jCanvas 代码进行了逆向工程。

希望这可以帮助某人

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2022-01-27T05:16:44.870

虽然这个问题大部分都得到了回答，但我发现答案很缺乏。最佳答案会产生难看的箭头，当使用 1 以外的宽度时，许多箭头会超出点，而其他的则有不必要的步骤。

这是最简单的答案，它绘制了一个漂亮的箭头（用颜色填充的适当三角形），并缩回箭头的点以考虑线条的宽度。

```
ctx = document.getElementById('canvas').getContext('2d');

/* Draw barrier */
ctx.beginPath();
ctx.moveTo(50, 30);
ctx.lineTo(450, 30);
ctx.stroke();

draw_arrow(50, 180, 150, 30);
draw_arrow(250, 180, 250, 30);
draw_arrow(450, 180, 350, 30);

function draw_arrow(x0, y0, x1, y1) {
  const width = 8;
  const head_len = 16;
  const head_angle = Math.PI / 6;
  const angle = Math.atan2(y1 - y0, x1 - x0);

  ctx.lineWidth = width;

  /* Adjust the point */
  x1 -= width * Math.cos(angle);
  y1 -= width * Math.sin(angle);

  ctx.beginPath();
  ctx.moveTo(x0, y0);
  ctx.lineTo(x1, y1);
  ctx.stroke();

  ctx.beginPath();
  ctx.lineTo(x1, y1);
  ctx.lineTo(x1 - head_len * Math.cos(angle - head_angle), y1 - head_len * Math.sin(angle - head_angle));
  ctx.lineTo(x1 - head_len * Math.cos(angle + head_angle), y1 - head_len * Math.sin(angle + head_angle));
  ctx.closePath();
  ctx.stroke();
  ctx.fill();
}
```

```
<canvas id="canvas" width="500" height="180"></canvas>
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-01-15T10:22:03.197

这是工作解决方案

```
function draw_arrow(ctx,fx,fy,tx,ty){ //ctx is the context
    var angle=Math.atan2(ty-fy,tx-fx);
    ctx.moveTo(fx,fy); ctx.lineTo(tx,ty);
    var w=3.5; //width of arrow to one side. 7 pixels wide arrow is pretty
    ctx.strokeStyle="#4d4d4d"; ctx.fillStyle="#4d4d4d";
    angle=angle+Math.PI/2; tx=tx+w*Math.cos(angle); ty=ty+w*Math.sin(angle);
    ctx.lineTo(tx,ty);
  //Drawing an isosceles triangle of sides proportional to 2:7:2
    angle=angle-1.849096; tx=tx+w*3.5*Math.cos(angle); ty=ty+w*3.5*Math.sin(angle);
    ctx.lineTo(tx,ty);
    angle=angle-2.584993; tx=tx+w*3.5*Math.cos(angle); ty=ty+w*3.5*Math.sin(angle);
    ctx.lineTo(tx,ty);
    angle=angle-1.849096; tx=tx+w*Math.cos(angle); ty=ty+w*Math.sin(angle);
    ctx.lineTo(tx,ty);
    ctx.stroke(); ctx.fill();
} 
```

# sql - 如何优化此查询？

> ID：808832
> 
> 赞同：0
> 
> 时间：2009-04-30T20:19:07.880
> 
> 标签：sql, mysql, database, select, join

如何优化此查询？似乎应该有一个更简单的方法来做到这一点。目标是它仍然可以很容易地变成删除语句。

```
SELECT * FROM team 
WHERE team_id IN (
                  SELECT team_id 
                  FROM (
                        SELECT team.team_id, (
                                              SELECT COUNT(*) 
                                              FROM signup 
                                              WHERE signup.team_id = team.team_id
                                             ) AS members 
                        FROM team, schedule, event 
                        WHERE team.schedule_id = schedule.schedule_id 
                        AND schedule.event_id = event.event_id
                        AND event.event_id =183) AS t 
                  WHERE members = 0
                 ) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T20:25:08.100

快速浏览一下这个查询给了我这个：

```
select
    t.*
from
    team t
    inner join schedule s on t.schedule_id = s.schedule_id
    inner join event e on s.event_id = e.event_id
    left outer join signup sp on t.team_id = sp.team_id
where
    e.event_id = 183
    and sp.team_id is null 
```

看起来您正在尝试查找参加活动但不在注册表中的所有团队。这是准确的吗？

另外，我想指出，与一堆子查询相比，连接会更快，特别是如果子查询依赖于每一行（在你的情况下，它们确实如此）。

干杯，
埃里克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T22:44:31.120

在此线程中评论 Eric 的查询时，我建议（从我的 mssqlserver 背景）改用存在性检查。这样做 (1) 使您的意图更加清晰，并且 (2) 使优化器有机会在找到第一个匹配的 team_id 后停止检查匹配的 team_id（因为 >=1 匹配行导致存在性检查为假）。例如

select t.* from team t inner join schedule s on t.schedule_id = s.schedule_id inner join event e on s.event_id = e.event_id where e.event_id = 183 and not exists (select * from signup where team_id = t. team_id)

但也许有 mysql 特定的性能问题。

# asp.net - ASP.NET 中的 Cookie

> ID：808846
> 
> 赞同：3
> 
> 时间：2009-04-30T20:22:17.967
> 
> 标签：asp.net, cookies

我正在寻找一个使用 ASP.NET 在 cookie 中存储数据的好例子。有人可以给我举个例子吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-30T20:24:41.660

MSDN 是你的好朋友：http: [//msdn.microsoft.com/en-us/library/78c837bd.aspx](http://msdn.microsoft.com/en-us/library/78c837bd.aspx)

直到那时 ：

```
C#:  
Response.Cookie["cookie_name"] = "value";

VB:  
Response.Cookie("cookie_name") = "value"; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-30T20:35:45.267

**如何创建 cookie**

```
HttpCookie mycookie = new HttpCookie("mycookie");
mycookie.Value = "chocolate chip please.";
Response.Cookies.Add(mycookie); 
```

**如何读取 cookie**

```
HttpCookie mycookie = Request.Cookies["mycookie"];
Response.Write("Your cookie is: " + mycookie.Value); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-30T20:24:31.050

看一下这个

[使用 Cookie 保存表单数据](http://msdn.microsoft.com/en-us/library/78c837bd.aspx/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T20:24:00.413

[谷歌说](http://www.google.co.uk/search?hl=en&q=asp.net%20write%20cookie)“[如何编写 Cookie](http://msdn.microsoft.com/en-us/library/78c837bd.aspx) ”

# c# - Windows 窗体文本在休假事件中更改

> ID：808847
> 
> 赞同：4
> 
> 时间：2009-04-30T20:22:24.987
> 
> 标签：c#, .net, winforms, events

也许我只是个白痴，但我似乎找不到一个会在离开的同时为文本框触发的事件，但只有在文本框的内容发生变化时才会触发。有点像 textchanged 和 leave 的组合。我不能使用 textchanged 因为它会在每次击键时触发。现在我将文本框的当前值存储在一个变量中，并在 leave 事件中进行比较，但这看起来真的很糟糕。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T20:23:49.617

您可以创建自己的（派生的）类来覆盖 OnEnter、OnLeave 和 OnTextChanged 以设置标志并触发“您的”事件。

像这样的东西：

```
 public class TextBox: System.Windows.Forms.TextBox {
        public event EventHandler LeaveWithChangedText;

        private bool textChanged;

        protected override void OnEnter(EventArgs e) {
            textChanged = false;
            base.OnEnter(e);
        }

        protected override void OnLeave(EventArgs e) {
            base.OnLeave(e);
            if (textChanged) {
                OnLeaveWithChangedText(e);
            }
        }

        protected virtual void OnLeaveWithChangedText(EventArgs e) {
            if (LeaveWithChangedText != null) {
                LeaveWithChangedText(this, e);
            }
        }

        protected override void OnTextChanged(EventArgs e) {
            textChanged = true;
            base.OnTextChanged(e);
        }
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-11-13T07:59:30.387

@Lucero 的答案几乎完美地完成了它的工作。
但是，当用户编辑文本并最终输入与以前相同的值时，它不会处理这种情况。因此，我为自己创建了一个类似的解决方案（在 C++/CLI 中，但您可以轻松地将其调整为 C#）：

```
public ref class EventArgsCTextBox1 : EventArgs
{
public:
  String^ PreviousText;
};

public ref class CTextBox1 : Windows::Forms::TextBox
{
public:
  virtual void OnEnter (EventArgs^ i_oEventArgs) override;
  virtual void OnLeave (EventArgs^ i_oEventArgs) override;

  delegate void EventHandlerCTextBox1 (Object^ i_oSender, EventArgsCTextBox1^ i_oEventArgs);
  event EventHandlerCTextBox1^ LeaveChanged;

private:
  String^ m_sValue;
};

void CTextBox1::OnEnter (System::EventArgs^ i_oEventArgs)
{
  TextBox::OnEnter (i_oEventArgs);
  m_sValue = this->Text;
}

void CTextBox1::OnLeave (System::EventArgs^ i_oEventArgs)
{
  TextBox::OnLeave (i_oEventArgs);
  if (m_sValue != this->Text)
  {
    EventArgsCTextBox1^ oEventArgs = gcnew EventArgsCTextBox1;
    oEventArgs->PreviousText = m_sValue;
    LeaveChanged (this, oEventArgs);
  }
} 
```

# django - ModelMultipleChoiceField 作为多列表

> ID：808852
> 
> 赞同：6
> 
> 时间：2009-04-30T20:23:22.147
> 
> 标签：django, forms

在 Django 中，如何将 ModelMultipleChoiceField 呈现为多列`<table>`？

```
fav = forms.ModelMultipleChoiceField(Show.objects.all(),
                                     widget=forms.CheckboxSelectMultiple) 
```

我希望这个字段呈现为一个多列表。最好的方法是什么？

澄清一下，我希望渲染采用 N 个对象并`<table>`在每个单元格中使用一个复选框渲染一个 HTML，例如每个单元格中的三列`<tr>`。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T20:51:01.720

Django 被硬编码为在`<ul>`这里使用 a 。请参阅[widgets.py](https://github.com/django/django/blob/9c487b5974ee7e7f196079611d7352364e8873ed/django/forms/widgets.py#L569)代码。

您可以子类化`CheckboxSelectMultiple`小部件类并使用表提供您自己的`.render()`方法。

# sql - 使用 Order by 进行 SQL 排序

> ID：808856
> 
> 赞同：0
> 
> 时间：2009-04-30T20:24:04.360
> 
> 标签：sql, oracle, plsql

你们能帮我解决这个问题吗？

目前，我有这个 SELECT 它返回以这种方式排序的数据

```
SELECT  DISTINCT gl.group_id,
        gl.group_name,
        gl.group_description,
        gl.status_code,
        gl.member_count,
        (
        SELECT  grpp.group_name
        FROM    test_group_relationship grel
        JOIN    test_group grpp
        ON      grel.parent_group_id = grpp.group_id
        WHERE   grel.child_group_id = gl.group_id
        ) AS parent_group_name,
        gl.group_name_key,
        gl.group_description_key
FROM    test_group gl
WHERE   gl.group_org_id = '3909'
        AND gl.group_name_key like '%' || 'GROUP' || '%'
ORDER BY
        gl.group_name_key, CONVERT(gl.group_name, 'WE8EBCDIC500') 
```

输出如下。我尝试缩进列以粘贴数据。

```
GROUP_NAME                         GROUP_NAME_KEY

Add Group Basic Flow               ADD GROUP BASIC FLOW
Administrative Group               ADMINISTRATIVE GROUP
Amy Group 33                       AMY GROUP 33
Amy Test Group 1                   AMY TEST GROUP 1
another add group test from matt   ANOTHER ADD GROUP TEST FROM MATT 
```

**我的问题在 FIELD GROUP_NAME--> 如何使用 ORDER BY 对数据进行排序，以便将小写字母排在大写字母之前。

预期输出是：-

值“another add group test from matt”必须排在第一位。这样，小写字母首先排序，然后是大写字母。

* * *

也可以看看：

*   [SQL ORDER BY 问题续](https://stackoverflow.com/questions/805568/sql-order-by-issue-continued-please-help/807323)
*   [PLSQL 按问题排序](https://stackoverflow.com/questions/804110/plsql-order-by-issue)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T20:36:16.280

将字段上的类型转换为区分大小写的排序规则，并按 asc 排序

在您的订单中添加

Group_Name COLLATE Latin1_General_CS_AS Asc

假设你的角色是英文的；否则用法语等代替。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T20:39:28.097

尝试：

ORDER BY UPPER (SUBSTR (GROUP_NAME, 1, 1)), SUBSTR (GROUP_NAME, 1, 1) DESC, UPPER(GROUP_NAME), GROUP_NAME DESC;

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T20:37:14.890

只需将 BINARY 添加到您的 ORDER BY。

```
ORDER BY BINARY gl.group_name_key 
```

您可能必须使用 DESC 否则大写字母将首先出现。但这也会对 za 进行排序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T20:38:09.677

我不是 Oracle 人，但根据您的 Oracle 版本，我相信有一些会话变量会为您确定这一点。您可以尝试以下方法：

更改会话集 nls_comp=二进制；

更改会话集 nls_sort=GENERIC_M_CI;

# svn - “svnlook 改变”编码

> ID：808859
> 
> 赞同：1
> 
> 时间：2009-04-30T20:24:18.167
> 
> 标签：svn, character-encoding

当我执行以下命令时：

`svnlook changed {path} -r {rev}`

其中 {path} 是存储库路径，{rev} 是修订号，我得到以下输出：

`U trunk/this/is/a/path/Mon fichier avec un nom accentu,.txt`

输出实际上应该是：

`U trunk/this/is/a/path/Mon fichier avec un nom accentué.txt`

“é”和其他重音字符未正确显示...

svnlook 有什么方法可以正确输出字符吗？

我知道我可以使用带有“--xml”选项的“svn log”来获得正确的编码，但我需要这个作为预提交钩子，svn.exe 只能从修订中获取信息，而不是从事务中获取信息。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T21:34:43.237

您在这里遇到的问题是您的预提交挂钩是由 Subversion 二进制文件运行的，出于安全原因，它会将一个空环境传递给挂钩脚本。空环境所做的事情之一是删除任何特定的语言环境设置，将您恢复为系统默认值（通常是“C”或类似的东西）。

要从中获得正确的输出`svnlook`，您需要在运行之前恢复您关心的环境。如果您的脚本是 bash，可能类似于：

```
#!/bin/bash

export LANG="en_US.UTF-8"
export PATH="/bin:/usr/bin"

# Run svnlook here and get UTF-8 encoded output 
```

一般来说，任何带有“.UTF-8”后缀的语言环境都可以。鉴于您似乎会说法语，“fr_FR.UTF-8”语言环境将是一个合理的设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T20:38:16.557

你应该尝试调用这个：

```
export LANG="fr_FR" 
```

（或任何您的开发人员的语言）在使用 svnlook 之前。您还可以在您的 shell 启动脚本中设置默认语言，这样您就不必每次都导出它。

# project-lifecycle - 团队开发套件的要素是什么？

> ID：808860
> 
> 赞同：1
> 
> 时间：2009-04-30T20:24:18.587
> 
> 标签：project-lifecycle

对于小型到大型的团队一起开发软件，使用什么工具来形成一个全面的团队开发框架？

具体来说，我正在寻找所有涉及的单个功能的综合列表（例如源代码控制、错误管理、测试工具、项目管理），而不是具体的产品推荐。我也没有将列表限制为特定的方法（例如 Scrum）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T20:31:41.063

您在帖子中遇到了主要问题：

*   IDE（集成开发环境）
*   编码指南（有时看过，但它仍然有很大帮助）
*   源代码控制
*   测试套件（单元测​​试、测试用例/测试脚本管理和跟踪）
*   问题跟踪/错误报告
*   构建管理

...我确定我遗漏了一些明显的东西，但这里有人会纠正我。

而我错过的那个...

*   绘图软件（IE Rational Software Modeler 等）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T20:31:52.640

*   源代码控制（显然）包括分支管理
*   问题跟踪（功能和错误），可能包括任务重新分配和转发，通常是屏幕录制等
*   个人任务管理，有时与问题跟踪系统集成
*   通讯软件。有些团队甚至在同一建筑物或推文中使用电子邮件和即时消息。代码中集成了一些工具，因此您可以“围绕一段代码聊天”。屏幕和应用程序共享也很有用。
*   良好的构建工具。
*   分布式结对编程工具（如果适用），否则共享编辑器。
*   案例工具中的类似支持。

不太常用但很有前途的工具（来自学术背景），有些现在有基于 IDE 的版本。

*   [实时感知](http://www.ics.uci.edu/~asarma/Palantir)（在实际编写代码之前让您知道有人正在处理同一个文件，从而防止神经冲突）

*   [代码内社交标记，](http://tagsea.sourceforge.net/)用于引导标记特定项目

*   [代码内契约通信工具](http://emoose.cs.cmu.edu)（例如，让调用者了解被调用方法中的特殊期望，以作为避免错误的一种方式）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-24T09:08:04.417

还有几个：

*   需求管理软件
*   [代码审查软件](https://stackoverflow.com/questions/457534/best-peer-code-review-software)
*   持续集成工具
*   文档存储库 - 例如 Wiki

# winforms - 在创建窗口句柄之前，不能对控件调用 Invoke 或 BeginInvoke

> ID：808867
> 
> 赞同：83
> 
> 时间：2009-04-30T20:25:32.093
> 
> 标签：winforms, multithreading

我有一个类似于[Greg D 在这里讨论](https://stackoverflow.com/questions/714666/is-it-appropriate-to-extend-control-to-provide-consistently-safe-invoke-begininvo)的 SafeInvoke Control 扩展方法（减去 IsHandleCreated 检查）。

我从 a 中调用它，`System.Windows.Forms.Form`如下所示：

```
public void Show(string text) {
    label.SafeInvoke(()=>label.Text = text);
    this.Show();
    this.Refresh();
} 
```

有时（此调用可能来自各种线程）这会导致以下错误：

> `System.InvalidOperationException`发生了
> 
> `Message`= "在创建窗口句柄之前，不能在控件上调用 Invoke 或 BeginInvoke。"
> 
> `Source`=“系统.Windows.Forms”
> 
> ```
> StackTrace:
> at System.Windows.Forms.Control.MarshaledInvoke(Control caller, Delegate method, Object[] args, Boolean synchronous)
> at System.Windows.Forms.Control.Invoke(Delegate method, Object[] args)
> at System.Windows.Forms.Control.Invoke(Delegate method)
> at DriverInterface2.UI.WinForms.Dialogs.FormExtensions.SafeInvoke[T](T control, Action`1 action) 
> in C:\code\DriverInterface2\DriverInterface2.UI.WinForms\Dialogs\FormExtensions.cs:line 16 
> ```

发生了什么事，我该如何解决？我知道这不是表单创建的问题，因为有时它会工作一次并在下一次失败，那么问题可能是什么？

PS。我真的很讨厌 WinForms，有没有人知道一系列很好的文章来解释整个模型以及如何使用它？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-04-30T21:28:15.110

您可能在错误的线程上创建控件。[考虑MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.invokerequired.aspx)中的以下文档：

> 这意味着如果不需要 Invoke（调用发生在同一线程上），或者**如果控件是在不同的线程上创建但尚未创建控件的句柄，则 InvokeRequired 可以返回 false。**
> 
> 在尚未创建控件句柄的情况下，不应简单地调用控件上的属性、方法或事件。这可能会导致在后台线程上创建控件的句柄，从而在没有消息泵的线程上隔离控件并​​使应用程序不稳定。
> 
> 当 InvokeRequired 在后台线程上返回 false 时，您还可以通过检查 IsHandleCreated 的值来防止这种情况。如果尚未创建控制句柄，则必须等到它创建完成后，才能调用 Invoke 或 BeginInvoke。通常，仅当在应用程序的主窗体的构造函数中创建后台线程时（如在 Application.Run(new MainForm()) 中，在显示窗体或调用 Application.Run 之前）才会发生这种情况。

让我们看看这对您意味着什么。（如果我们也看到您对 SafeInvoke 的实施，这将更容易推理）

假设您的实现与引用的实现相同，除了对[IsHandleCreated](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.ishandlecreated.aspx)的检查之外，让我们遵循以下逻辑：

```
public static void SafeInvoke(this Control uiElement, Action updater, bool forceSynchronous)
{
    if (uiElement == null)
    {
        throw new ArgumentNullException("uiElement");
    }

    if (uiElement.InvokeRequired)
    {
        if (forceSynchronous)
        {
            uiElement.Invoke((Action)delegate { SafeInvoke(uiElement, updater, forceSynchronous); });
        }
        else
        {
            uiElement.BeginInvoke((Action)delegate { SafeInvoke(uiElement, updater, forceSynchronous); });
        }
    }
    else
    {    
        if (uiElement.IsDisposed)
        {
            throw new ObjectDisposedException("Control is already disposed.");
        }

        updater();
    }
} 
```

考虑我们`SafeInvoke`从非 gui 线程调用未创建句柄的控件的情况。

`uiElement`不为空，所以我们检查`uiElement.InvokeRequired`. 根据 MSDN 文档（粗体）[`InvokeRequired`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.invokerequired.aspx)将返回`false`，因为即使它是在不同的线程上创建的，但尚未创建句柄！这将我们发送到`else`我们检查[`IsDisposed`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.isdisposed.aspx)或立即继续调用提交的操作的条件......**从后台线程**！

在这一点上，所有的赌注都被取消了：那个控制，因为它的句柄是在一个没有消息泵的线程上创建的，如第二段所述。也许这就是您遇到的情况？

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2012-06-15T06:00:15.047

我发现`InvokeRequired`不可靠，所以我只是使用

```
if (!this.IsHandleCreated)
{
    this.CreateHandle();
} 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2010-01-13T13:20:22.957

这是我对类似[问题的](https://stackoverflow.com/questions/246058/system-invalidoperationexception-the-object-is-currently-in-use-elsewhere-ho)[回答](https://stackoverflow.com/questions/246058/system-invalidoperationexception-the-object-is-currently-in-use-elsewhere-ho/246064#246064)：

> 我*认为*（尚未完全确定）这是因为如果控件尚未加载/显示，InvokeRequired 将始终返回 false。我已经做了一个暂时可行的解决方法，即在其创建者中简单地引用关联控件的句柄，如下所示：
> 
> ```
> var x = this.Handle; 
> ```
> 
> （见 [http://ikriv.com/en/prog/info/dotnet/MysteriousHang.html](http://ikriv.com/en/prog/info/dotnet/MysteriousHang.html)）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-30T20:40:24.053

在从未创建控件的线程调用控件的情况下，在检查控件的句柄是否已创建之前，您链接到调用`Invoke`/的帖子中的方法。`BeginInvoke`

因此，当您的方法从创建控件的线程以外的线程调用时，您将得到异常。这可能发生在远程事件或排队的工作用户项目中......

**编辑**

如果您在调用调用之前检查`InvokeRequired`并且`HandleCreated`不应该得到该异常。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-11-02T17:05:23.997

如果您要在使用`Control`显示或执行其他操作之前使用来自另一个线程的`Control`，请考虑在构造函数中强制创建其句柄。这是使用[`CreateHandle`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.createhandle%28v=VS.90%29.aspx)函数完成的。

在多线程项目中，“控制器”逻辑不在 WinForm 中，此函数有助于`Control`构造函数避免此错误。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-03-18T15:42:30.740

在调用方法调用之前添加：

```
while (!this.IsHandleCreated) 
   System.Threading.Thread.Sleep(100) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-02T23:53:35.667

在其创建者中引用关联控件的句柄，如下所示：

**注意**：请注意此解决方案。如果控件有句柄，则设置它的大小和位置等操作会慢得多。这使得**InitializeComponent**慢得多。更好的解决方案是在控件有句柄之前不做任何背景。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-01-01T23:54:36.237

```
var that = this; // this is a form
(new Thread(()=> {

    var action= new Action(() => {
       something
    }));

    if(!that.IsDisposed)
    {
        if(that.IsHandleCreated)
        {
            //if (that.InvokeRequired)
                that.BeginInvoke(action);
            //else
            // action.Invoke();
        }
        else
            that.HandleCreated+=(sender,event) => {
                action.Invoke();
            };
    }

})).Start(); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-01-24T16:12:07.903

我对这种简单的形式有这个问题：

```
public partial class MyForm : Form
{
    public MyForm()
    {
        Load += new EventHandler(Form1_Load);
    }

    private void Form1_Load(Object sender, EventArgs e)
    {
        InitializeComponent();
    }

    internal void UpdateLabel(string s)
    {
        Invoke(new Action(() => { label1.Text = s; }));
    }
} 
```

然后对于`n`我用来尝试调用 UI 线程的其他异步线程`new MyForm().UpdateLabel(text)`，但构造函数没有为 UI 线程实例提供句柄，因此其他线程获取其他实例句柄，它们是`Object reference not set to an instance of an object`or `Invoke or BeginInvoke cannot be called on a control until the window handle has been created`。为了解决这个问题，我使用了一个静态对象来保存 UI 句柄：

```
public partial class MyForm : Form
{
    private static MyForm _mf;        

    public MyForm()
    {
        Load += new EventHandler(Form1_Load);
    }

    private void Form1_Load(Object sender, EventArgs e)
    {
        InitializeComponent();
        _mf = this;
    }

    internal void UpdateLabel(string s)
    {
        _mf.Invoke((MethodInvoker) delegate { _mf.label1.Text = s; });
    }
} 
```

我想它工作正常，到目前为止......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-05-29T14:33:58.237

那这个呢 ：

```
 public static bool SafeInvoke( this Control control, MethodInvoker method )
    {
        if( control != null && ! control.IsDisposed && control.IsHandleCreated && control.FindForm().IsHandleCreated )
        {
            if( control.InvokeRequired )
            {
                control.Invoke( method );
            }
            else
            {
                method();
            }
            return true;
        }
        else return false;
    } 
```

# c# - 如何以编程方式（C#）从 POP3 邮件中获取附件？

> ID：808871
> 
> 赞同：4
> 
> 时间：2009-04-30T20:25:39.550
> 
> 标签：c#, winforms, email, pop3

此任务是否有任何 C# API？有什么建议么？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-04-30T20:36:05.237

我过去曾成功使用过[/n Software](http://www.nsoftware.com/ipworks/)。不是免费的，但是嘿，如果它不起作用，你会责怪别人！（换句话说，你得到了公司的技术支持）

他们也有免费试用。

# asp.net - asp.net 连续字符串换行

> ID：808875
> 
> 赞同：2
> 
> 时间：2009-04-30T20:26:19.237
> 
> 标签：asp.net, css

好吧，看来，出于某种原因（我可能做错了，显然），我在使用 Asp.net 包装连续行时遇到了一些问题。

假设我有 800 像素的“m”字符，好吧，我的表格单元格被扩展到那个长度。我不希望这样，我希望单元格在 300px 后自动断开连续线。

为此，我尝试应用 word-wrap:break-word css 样式。没用。怎么办？

我是否解析该行，在一定数量的字符后插入显式换行符？这对我来说似乎不是很干净。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T20:29:24.893

你真的有 800px 的“m”还是只是测试数据？如果那是真实数据，那么是的，您将不得不在某处创建一些空白。HTML 解析器不会对溢出元素的文本进行换行，除非该文本中包含允许对文本进行换行的空格。

如果 m 是测试字符串并且不反映真实数据，我建议您使用一些虚拟文本（如[Lorem Ipsum](http://www.lipsum.com/feed/html)）进行测试，因为它的间距更类似于常规文本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T20:36:37.807

您可以每隔几个 m 插入一个`<wbr>`（鲜为人知的 html 元素）。它不是 100% 兼容所有东西，但它适用于大多数浏览器：

> `<wbr>`(word break) 的意思是：“如果浏览器愿意，可以在此处插入换行符。” 如果浏览器认为不需要换行，则什么也不会发生。

所以你会做这样的事情：

```
mmmmmmmmm<wbr>mmmmmmmmmm<wbr>mmmmmmmmmmm<wbr> (etc.) 
```

这里有更多信息：[http ://www.quirksmode.org/oddsandends/wbr.html](http://www.quirksmode.org/oddsandends/wbr.html)

# git - 将 Git 提交修改为共享存储库

> ID：808877
> 
> 赞同：5
> 
> 时间：2009-04-30T20:26:52.450
> 
> 标签：git, version-control

我有一个本地 git 存储库，我最近对其进行了提交，然后推送到了共享存储库。只有在我将它推送到共享仓库之后，我才意识到我犯了一个丑陋的错误。在我修复了源代码后，我在本地对其进行了修改：

```
git commit -C HEAD -a --amend 
```

之后，我尝试了另一个 git push origin 并收到以下错误：

```
! [rejected]        mybranch -> mybranch (non-fast forward) 
```

纠正这种情况的最佳方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T20:41:34.253

git 不允许（默认情况下）将任何“倒回”分支提示的内容推送到分支。换句话说，如果当前分支头不是分支尖端的直接父级或祖先，则推送将被拒绝。

您可以尝试使用 to`-f`选项`git push`或使用带有前导“+”的 refspec 来尝试推送，例如`git push origin +mybranch:mybranch`.

通常远程存储库仍然不会让这种情况发生，因为如果不同的人可以不分青红皂白地推送不包括他们在本地没有的提交的分支提示，那么您就有丢失提交的风险。

您可以通过更改远程存储库上的配置参数来覆盖此行为`receive.denyNonFastForwards`（假设您具有对远程存储库的适当访问权限）。

如果您没有此类访问权限，*则可以*通过删除远程分支并重新创建它来实现此目的。

例如

```
git push origin :mybranch
git push origin mybranch 
```

请注意，最新版本的 git 包含一个配置参数`receive.denyDeletes`，如果设置了该参数，该参数将阻止这种潜在危险的解决方法起作用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-30T20:41:56.173

如果你想强制推送，你可以... ehm ...传递`--force`给`push`.

但是，在公共存储库上重写历史通常被认为是不好的形式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T20:54:35.223

在这种情况下，最好只对修复进行第二次提交。由于您已经更改了本地存储库中的原始第一次提交，因此您可能希望将其从共享存储库中拉出并移动 HEAD 以便可以对更改后的提交进行垃圾收集。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T20:44:04.623

假设您的共享存储库允许，只需在分支名称前加上加号即可强制非快进推送：

```
git push origin +mybranch 
```

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-04-30T20:40:44.007

怎么样`git reset`？

# asp.net - 更好的性能：OnDataBound 或迭代 PreRender

> ID：808878
> 
> 赞同：0
> 
> 时间：2009-04-30T20:27:15.803
> 
> 标签：asp.net, controls, asp.net-controls

我有一个菜单，可以在其中动态设置所选值。

在 DataBound 事件上设置值或在 PreRender 事件中迭代菜单时，我会有更好的性能吗？

性能特征是否可以推广到所有数据绑定控件（即菜单与网格视图会有所不同）吗？

除了出于性能原因之外，请随时告诉我为什么你会这样做。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T20:35:53.363

如果我明白你在说什么。我的猜测是，使用 OnDataBound 事件的性能会比对整个集合进行迭代要好一些。至少在许多情况下看时。

原因是您已经遍历了这些项目，并且触发了 OnDataBound 事件，因此您可以使用内部处理来发挥自己的优势。如果您随后进行自己的迭代，那么您将再次检查这些项目。

# javascript - Jquery在悬停时淡出？

> ID：808882
> 
> 赞同：0
> 
> 时间：2009-04-30T20:28:28.420
> 
> 标签：javascript, jquery, css

有一个没有背景的链接和一个 css 规则，它在悬停时改变背景。

**父背景为白色，悬停链接 - .png 背景图像。**

**我怎样才能慢慢地做一个悬停效果，从白色到我的背景图像？**

谢谢。

* * *

```
li a {}
li a:hover { background: url(image.png) 0 0 no-repeat; } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T20:38:47.770

# CSS

```
li {
  background: #FFF;
}

li a {
  opacity: 0;
  display:block;
  height:200px; /* Image height */
  width:200px; /* Image width */
  background:transparent url(image.png) top left no-repeat;
} 
```

# JavaScript

```
$(function(){
  $("li a").hover(function(){
    $(this).stop();
    $(this).animate({"opacity":1}, "slow");
  }, function(){
    $(this).stop();
    $(this).animate({"opacity":0}, "slow");
  });
}); 
```

请参阅[http://docs.jquery.com/Effects](http://docs.jquery.com/Effects)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-07T12:00:05.567

透明在 IE 中无效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T20:32:03.217

想到的一件事是策略性地将具有背景图像集的图层和具有纯色的图层彼此叠放，并在悬停时为正确事物的不透明度属性设置动画（如果顶部的事物变得透明，则底部的事物出现通过）。

# wpf - 确定是否继承了 WPF DependencyProperty 值

> ID：808883
> 
> 赞同：11
> 
> 时间：2009-04-30T20:28:50.370
> 
> 标签：wpf, inheritance, datacontext, dependency-properties

有谁知道如何确定 WPF 属性的值是否是继承的？特别是，我试图确定`DataContext`a`FrameworkElement`是从父级继承还是直接设置在元素本身上。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-30T22:48:25.387

[`DependencyPropertyHelper.GetValueSource`](http://msdn.microsoft.com/en-us/library/system.windows.dependencypropertyhelper.getvaluesource.aspx)会给你一个[`ValueSource`](http://msdn.microsoft.com/en-us/library/system.windows.valuesource.aspx)，其中包括一个用于检索[`BaseValueSource`](http://msdn.microsoft.com/en-us/library/system.windows.basevaluesource.aspx). `BaseValueSource`枚举告诉您从哪里获取`DependencyProperty`它的值，例如从父级继承、通过样式设置或在本地设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T20:54:55.940

**更多挖掘后更新**

有一种[`ReadLocalValue`](http://msdn.microsoft.com/en-us/library/system.windows.dependencyobject.readlocalvalue.aspx)方法是愚蠢的 Read 而不是 Get 在智能感知中很难发现。（我认为 Apress 的 WPF 书中实际上对此有注释。）如果尚未设置该值，它将返回[UnsetValue 。](http://msdn.microsoft.com/en-us/library/system.windows.dependencyproperty.unsetvalue.aspx)

```
if (ReadLocalValue(Control.DataContextProperty) != 
    DependencyProperty.UnsetValue)
{
    // Data context was set locally.
} 
```

如果由于某种原因需要获取*所有*本地设置的属性，则可以使用 LocalValueEnumerator。

```
LocalValueEnumerator enumerator = GetLocalValueEnumerator();
while (enumerator.MoveNext())
{
    if (enumerator.Current.Property == Control.DataContextProperty)
    {
        // DataContext was set locally
    }
} 
```

*而这两种方法真的让我很纳闷。在 ReadLocalValue 中读取而不是 Get 以及在 GetLocalValueEnumerator 中无法使用 foreach 迭代的集合。就像 .Net 具有 WPF 团队刚刚决定忽略的这些不错的标准内容。*

# subsonic - 将亚音速对象集合绑定到 Microsoft 报告 (rdlc)

> ID：808885
> 
> 赞同：0
> 
> 时间：2009-04-30T20:29:04.597
> 
> 标签：subsonic, rdlc

有没有人能够将 SubSonic 生成的集合用作 Microsoft 报告 (rdlc) 的“业务对象数据源”？我已经生成了 SubSonic 类代码，但由于某种原因，报告数据源窗口没有将该类视为潜在的对象集合数据源。

我需要做些什么才能使其正常工作吗？

在此先感谢...vsdotnetguy

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T20:38:22.750

我之前已经从业务对象加载了 Reporting Service 报告（通过 NHibernate 加载——这并不准确，但为了论证而足够接近）。

几个关键点： 1\. 在 List 中返回你的对象，即使你只返回一个对象。2\. 您需要 FLAT 业务对象。您可能必须通过 DTO 转换才能获得它。扁平化是指业务对象中最复杂的属性是字符串和数字（​​int、decimal、double）。如果您希望获取这样的值：myObject.Customer.Name，请忘记它。创建一个 CustomerName 属性。3\. 如果您需要来自多个地方的数据，请尝试将您的报告分解为子报告。您关闭数据源键以确定要返回报告的数据。

我会添加更多，因为我记得，我已经做了几个月了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T22:23:39.300

是的，我已经做到了，您只需要确保包含您的报告的项目引用您的 SubSonic 项目（显然 :)。

有时我还发现 Visual Studio 可能会有点无聊，需要重新启动才能使用 SubSonic 生成的对象重新填充数据源窗口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-03T21:36:02.910

谢谢克里斯和亚当，

这是我找到的答案。

就我而言，我想在运行时使用 SubSonic 对象集合动态设置主报表数据源和子报表数据源。但是，我还想通过拖放数据源列来设计报表布局。

但是我无法使用拖放来设计报告，因为我的 SubSonic 集合都没有出现在网站数据源中。

然而，后来当我使用 ObjectDataSource 控件进行一些控件绑定时，我注意到现在我的 SubSonic 集合显示在网站数据源窗口中，我可以拖放报告布局。

So if you are dynamically setting the report datasources at run time and ARE NOT using the ObjectDataSource control already in your project, you MUST add a dummy ObjectDataSource control to one of your aspx pages. This will then make the business object datasources show up in the report designer.

# java - XMPP Smack API RosterListener + 数据库更改

> ID：808886
> 
> 赞同：1
> 
> 时间：2009-04-30T20:29:14.487
> 
> 标签：java, xmpp, listener, smack

我正在使用 Smack API 在 Java 中编写 XMPP 客户端。

我为每个用户注册了一个名册监听器，Smack API 调用......

```
public void entriesAdded(Collection arg0) {} 
```

...每次它注意到一个花名册添加。

有谁知道如果数据库更改而不是通过 Smack API createEntry() 方法，是否会关闭此侦听器？

基本上，我想将 XMPP 客户端绑定到一个网站。当您将某人添加到网站好友列表时，我希望网站通知客户。与其设置套接字或使用 PHP 登录 XMPP 服务器，我希望只修改数据库就可以工作。

在客户端不断轮询数据库以进行更改的情况下，这是否可行，或者是否有其他方法可以处理此问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-01T15:11:22.747

更改数据库与 Smack 没有直接关系，因为它是一个客户端库。它没有数据库。数据库将由服务器使用和访问，并且根据服务器的不同，可能存在允许服务器在数据库更改时发布消息的功能。我不知道是否有任何 xmpp 服务器实际上具有此功能。

您应该检查您正在使用的服务器的功能，并可能使用服务器本身的扩展来添加名册条目。直接更改数据库听起来并不像要走的路，因为您很可能会让您的 XMPP 服务器和数据库不同步。

至于轮询数据库的客户端，如果 XMPP 服务器和您的网络服务器正在使用它，那么客户端能够直接访问数据库听起来不是一个好主意。

# asp.net - .net 将数据传递到 Crystal Report

> ID：808895
> 
> 赞同：0
> 
> 时间：2009-04-30T20:30:34.500
> 
> 标签：asp.net, crystal-reports

将数据传递到 ASP.NET 站点中的 Crystal Report 的最简单方法是什么？我已经推送了自定义集合和数据集。我有一个高级自定义集合，我真的只需要传入两个字段。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T20:35:49.713

您是否尝试过相当轻量级的 XML 文档？Crystal Reports 几乎可以从任何东西中提取数据

# c# - 如何找到给定数据库的所有者？

> ID：808899
> 
> 赞同：0
> 
> 时间：2009-04-30T20:31:45.323
> 
> 标签：c#, .net, sql

使用 .NET 的 DbConnection.GetSchema()，我如何找到给定数据库的所有者？

或者，如果您有另一个不与特定 SQL 实现耦合的解决方案，我也想听听。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T20:38:53.637

不幸的是，DbConnection 的 GetSchema 调用不会为您检索数据库所有者:-(

但是你可以在 SQL Server 上试试这个：

```
select 
    db.name, db.database_id, l.name, l.type 
from 
    sys.databases db
inner join
    sys.login_token l on db.owner_sid = l.sid 
```

如果您想从 .NET 连接到 SQL Server，您可以使用 SMO（SQL 管理对象）并像这样找到您的所有者：

```
 Server server = new Server("Your Server");

    Database db = server.Databases["Your Database"];

    Console.WriteLine("Database owner is: " + db.Owner); 
```

马克

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T20:45:32.857

我不相信 SQL-92 标准规定目录（数据库）必须有所有者。因此，我不知道您是否可以获得一种非特定于实现的方式来执行此操作。

# css - 处理css浏览器兼容性的正确方法是什么？

> ID：808902
> 
> 赞同：5
> 
> 时间：2009-04-30T20:32:34.167
> 
> 标签：css, browser, cross-browser

是为每个用户代理使用不同的 CSS 文件更好，还是使用只有某些浏览器才能看到的 CSS Hacks 更好？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T20:37:10.070

两者都不。

最好的方法是编写适用于所有浏览器的代码，而无需浏览器特定代码或 css hack。这当然不是那么容易完成，这就是为什么许多人使用其他方法。

关键是要避免某些浏览器（通常是 Internet Explorer）遇到的问题。其中之一是使用填充而不是边距，因为 IE 不能正确处理边距折叠。

一些处于被黑客攻击边界线的方法是使用不会影响正常工作的浏览器的代码，但会修复特定浏览器的问题。这可能是为通常不需要的元素指定高度，或者`display:inline`在浮动元素上指定高度。

页面[位置是一切](http://www.positioniseverything.net/)都有一些错误和建议修复的示例。（通常修复是某种黑客，所以你当然也应该考虑你是否可以完全避免这个问题。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T20:38:21.283

最好都不做。

一个好的 css-reset 和 css 在同一个跨浏览器上工作是一个更好的解决方案。

如果您的设计绝对排除了这种情况，那么（并且只有在那时）我会尝试 hacks 或 IE 条件注释。

我还没有看到需要多个 css 文件（除了通过条件注释解决的一些 IE6 更正之外）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T20:37:36.107

可能的话也不行。既然旧的 Netscape、IE <= 6 等已经不再使用了，我尝试使用在所有这些浏览器中都可以使用的功能（例如 FF >= 2、IE >= 7、Chrome、Opera）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T20:46:55.537

[对 Internet Explorer 问题的条件注释](http://www.quirksmode.org/css/condcom.html)似乎是常态。结合一点 JavaScript，例如[Dean Edward 的 ie7.js](http://www.charlescooke.me.uk/web/lab_notes/ie7_script.html)，您可以缓解大多数跨浏览器问题，而无需在 CSS 文件中使用 hack。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T21:00:52.650

最好为 Internet Explorer 6-7 使用不同的 css 文件（通过[条件注释](http://www.quirksmode.org/css/condcom.html "有条件的评论")包含它们），并为其他浏览器使用 hack。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T21:08:51.070

一种跟进是如何开发工作的单个文件。

我见过的最好的工作方法是从零开始，慢慢地构建它并通过更改检查它是否仍然兼容您的核心浏览器（尤其是有问题的浏览器）。

当你让它在一个浏览器上完全工作，然后说“是时候转换它了”，这就是痛苦真正开始的时候，也是你必须开始破解的时候。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-01T11:45:53.330

[我](http://reinholdweber.com/css/css-hacks-browser-version-detection-a-new-approach/)使用 PHP 类来检测操作系统、浏览器和浏览器版本的方法。您可以针对任何操作系统上的几乎任何浏览器的任何版本。

# html - html中的数据集

> ID：808905
> 
> 赞同：0
> 
> 时间：2009-04-30T20:33:41.450
> 
> 标签：html, asp.net, dataset

我正在使用 asp.net，我想在我的 html 代码中定义数据集的元素。问题是当我尝试使用：

```
<%@Using namespace="System.Data" %> 
```

这给了我一个错误

还

我在用

```
foreach (DataRow row in ds.Tables[0].Rows)
          {.....} 
```

DataSet ds 是从 sql 查询中获得的。我不相信有任何表格，所以上面的代码可以吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T20:37:20.973

如果在代码隐藏中定义了 ds 以使其在 .aspx 方面可用，则必须将其声明为受保护的，而不是私有的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-04T02:27:15.960

如果要在 aspx 页面中导入命名空间，请尝试以下操作：

```
<%@ Import Namespace="System.Data" %> 
```

如果您更具体地了解您的错误，我们也可以为您提供帮助！

# javascript - 如何在没有所有 HTML 的情况下将焦点设置到 HTML 输入元素？

> ID：808908
> 
> 赞同：0
> 
> 时间：2009-04-30T20:34:07.143
> 
> 标签：javascript, html, dom, tapestry

首先，背景：我正在使用 Tapestry 4，因此任何给定页面的 HTML 都是由分散在整个应用程序中的各种 HTML 片段拼接在一起的。对于我正在处理的组件，我没有`<body>`标签，所以我不能给它一个`onload`属性。

该组件有一个在页面加载时需要焦点的输入元素。有谁知道在页面加载时将焦点设置为文件输入（或任何其他文本类型输入）而不访问正文标记的方法？

我尝试将脚本插入到正文
`document.body.setAttribute('onload', 'setFocus()')`
中（其中 setFocus 是将焦点设置为文件输入元素的函数），但这不起作用。不过，我不能说我对此感到惊讶。

**编辑：**
如前所述，我确实需要使用页面组件来执行此操作。我最终将文件类型的输入添加到我们用来将焦点放在页面上的第一个可编辑和可见输入的脚本中。在研究这个问题时，我没有发现任何安全问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-04-08T10:52:44.720

```
<script>
window.onload = function()  {
     document.getElementById('search_query').select();
    //document.getElementById('search_query').value = ''; 
    // where 'search_query' will be the id of the input element
};
</script> 
```

我觉得一定有用！！！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T20:41:33.083

这对我来说效果很好：

```
<script>
  function getLastFormElem(){
    var fID = document.forms.length -1;
    var f = document.forms[fID];
    var eID = f.elements.length -1;
    return f.elements[eID];
  }
</script>

<input name="whatever" id="maybesetmaybenot" type="text"/>
<!-- any other code except more form tags -->

<script>getLastFormElem().focus();</script> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T20:45:34.603

你可以给窗口一个 onload 处理程序

```
window.onload = setFocus; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T20:49:51.363

我认为您的封装存在根本问题。尽管在大多数情况下，您可以将事件处理程序附加到 onload 事件 - 请参阅John Resig 的[http://ejohn.org/projects/flexible-javascript-events/](http://ejohn.org/projects/flexible-javascript-events/)了解如何执行此操作，但 setFocus 需要由页面组件管理因为您的页面上不能有两个组件要求它们在页面加载时获得焦点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T20:38:27.977

尝试使用[tabstop](http://www.google.com/search?q=html+tabstop&ie=utf-8&oe=utf-8)属性

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T20:53:41.620

首先，输入文件与其他输入文件不同，您需要记住这一点....这是出于安全原因。当输入文件获得焦点时，它应该是只读的，或者浏览器应该弹出一个对话框来选择一些文件。

现在，对于其他输入，您可以在某些元素上尝试一些 onload 事件...（不仅主体有 onload 事件），也可以在 html 中间使用内联 javascript。如果您放置 javascript 代码而不告诉它是一个函数，它会在浏览器读取它时执行。就像是：

```
<script type="text/javascript">

function yourFunction()
{
   ...;
};

alert('hello world!");

yourFunction();

</script> 
```

该函数将在浏览器读取警报后执行。

如果可以的话，你应该使用 jQuery 来做你的 javascript。它会让你的生活变得非常轻松...... :)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-04T18:33:43.873

使用[jQuery](http://jquery.com/)可以这样做：

```
$(function() {
    $("input:file").eq(0).focus()
}) 
```

使用普通的 javascript 可以这样做：

```
var oldWindowOnload = window.onload; // be nice with other uses of onload 
window.onload = function() {
    var form = document.forms[0];
    for(i=0; i < form.length; i++) {
        if (form[i].type == "file") {
            form[i].focus();
        }
    }
    oldWindowOnload();
} 
```

有关使用纯 javascript 的更详细的解决方案，请参阅在 CodeProject[上将焦点设置为网页上的第一个输入。](http://www.codeproject.com/KB/scripting/FocusFirstInput.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-05T13:23:56.603

Scunliffe 的解决方案具有可用性优势。

当页面脚本加载缓慢时，如果用户滚动页面，则从“onLoad”事件调用 focus() 会使一个非常讨厌的页面“跳转”。所以这是一种更加用户友好的方法：

```
<input id="..."></input>
... really small piece of HTML ...
<script>getTheDesiredInput().focus();</script> 
```

# sql-server - SQL Server 2005 存储过程在 SSMS 中快速从 VBA 慢

> ID：808914
> 
> 赞同：4
> 
> 时间：2009-04-30T20:35:20.633
> 
> 标签：sql-server, vba, stored-procedures

我有一个存储过程，当从 SQL Server Management Studio 运行时，像这样调用它时始终需要 5 秒才能运行。

```
exec dbo.MyStoredProc  '2009-04-30 00:00:00', '2009-04-30 20:00:00' 
```

通过 VBA 从 excel 电子表格调用时，需要 6 分钟以上（不包括将记录集复制到工作表所用的时间。仅使用 ADO 连接来返回记录集，VBA 并没有什么花哨的。不幸的是，Excel 方法是客户端要求我还不能摆脱。

```
Public Function GenerateSQL(strQueryName As String) As Recordset
Dim rs As Recordset, cm As Command, dbsConn As Connection

Set dbsConn = New ADODB.Connection
dbsConn.Open Configuration.Range("ConnectionString")
Set cm = New ADODB.Command

With cm
    .CommandText = strQueryName
    .CommandType = adCmdStoredProc
    .CommandTimeout = 300
    .ActiveConnection = dbsConn

    Set rs = .Execute()

End With

Set GenerateSQL = rs
End Function 
```

有谁知道为什么会发生这种情况，或者我如何开始追踪正在发生的事情？

谢谢，

史蒂夫

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-02-24T05:17:40.983

关于这个主题你需要知道的一切：[应用程序慢，SSMS 快？了解性能奥秘](http://www.sommarskog.se/query-plan-mysteries.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-11T09:58:04.413

我相信我和史蒂夫荷马有同样的问题。除了这个 SO 问题，我还在 eggheadcafe.com 上发现了这个线程[使用 .net 时 SP 执行速度非常慢 - 在 Management Studio 中非常快 - totico](http://www.eggheadcafe.com/conversation.aspx?messageid=34233534&threadid=34233534)

答案说这是关于参数嗅探以及它如何影响使用哪个执行计划。那里的答案特别提到了`arithabort`set 选项以及它如何影响计划的选择。

~~现在我只需要找出如何从 VBA 更改设置选项...~~

最后感谢[social.msdn.com 上的这个论坛条目，](http://social.msdn.microsoft.com/Forums/en-US/sqldataaccess/thread/f81fb2a7-5190-40e5-9541-26cb94172230/)我设法做到了。首先，将多个连接设置为 false：

```
connectionObject.Properties("Multiple Connections") = False 
```

然后在您的连接上使用以下功能将 arithabort 设置为...

```
Private Sub OptionSet(ByRef cnn As adodb.Connection)
  Dim cmd As adodb.Command

  Set cmd = New adodb.Command
  With cmd
    Set .ActiveConnection = cnn
    .CommandType = adodb.CommandTypeEnum.adCmdText
    .CommandText = "set arithabort on"
    Call .Execute
  End With
  Set cmd = Nothing
End Sub 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T20:46:53.337

使用**[SQL Server Profiler](http://msdn.microsoft.com/en-us/library/ms181091.aspx)**

*   在您的数据库上设置跟踪。
*   仅将跟踪限制到有问题的存储过程对象
*   限制为 VBA 代码使用的用户名

[SQL Server Profiler 简介](http://www.developer.com/db/article.php/3482216)

特别是，检查连接使用的[SET 选项](http://msdn.microsoft.com/en-us/library/ms190707(SQL.90).aspx)，并将这些选项与在 SSMS 中运行存储过程时使用的默认值进行比较。

我之前遇到过调用代码和 SSMS 中的 SET 选项不同并且性能差异很大的*场景*。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T21:13:51.930

谢谢，我会看看跟踪工具。

回复对原始问题的评论

**您是否使用完全相同的参数值？**

是的，完全一样。

**（大致）返回了多少数据 - 行数和列数（并且它们中的任何一个都特别大）？**

在 200 行以下，可能有 15 个字段主要是带有几个 20 个字符的 varchars 的整数。

**您可以运行 SQL 探查器并确认 sql 是问题还是 excel 中宏的剩余部分？**

SQL 非常丑陋，底层数据库模式也是如此，不幸的是它在 NDA 之下，所以我不能发布它。如果查询是问题所在，那么在管理工作室中会不会也很慢？

# c# - UpdatePanel 中的图像在 Firefox 中不起作用

> ID：808916
> 
> 赞同：2
> 
> 时间：2009-04-30T20:35:39.730
> 
> 标签：c#, asp.net, ajax, updatepanel, webchartcontrol

我有一个在 Ajax UpdatePanel 内自动生成的图像。此图像是从服务器端代码生成的图形。在谷歌搜索，我意识到这是一个 FF 的错误。有没有人有任何解决方案？

这是源代码（它还包含不需要的标签，我只是复制粘贴）

```
<div>
   <asp:UpdatePanel ID="UpdatePanelGraph" runat="server" UpdateMode="Conditional">
       <ContentTemplate>
           <asp:Panel ID="pnlGraph" runat="server" CssClass="container">
                <div id="chart">
                     <Web:ChartControl ID="chartExchange" runat="server" Width="300px" Height="200px" BorderStyle="None" GridLines="both" DefaultImageUrl="../images/noData.png" ShowTitlesOnBackground="False" BorderWidth="1px" Padding="1" HasChartLegend="False" BottomChartPadding="20" TopChartPadding="5" RightChartPadding="5" LeftChartPadding="20">
                            <Border Color="211, 224, 242"></Border>
                            <YAxisFont ForeColor="115, 138, 156" Font="Tahoma, 7pt" StringFormat="Far,Center,Character,LineLimit"></YAxisFont>
                            <XTitle ForeColor="115, 138, 156" StringFormat="Center,Near,Character,LineLimit">
                            </XTitle>
                            <XAxisFont ForeColor="115, 138, 156" StringFormat="Near,Near,Character,NoClip"></XAxisFont>
                            <Background Type="LinearGradient" Color="#C9DEFD" ForeColor="Transparent" EndPoint="500, 500">
                            </Background>
                            <ChartTitle ForeColor="51, 51, 51" Font="Verdana, 9pt, style=Bold" StringFormat="Near,Near,Character,LineLimit">
                            </ChartTitle>
                            <Charts>
                                <Web:SmoothLineChart Name="buy" Legend="Blen">
                                    <Line Color="ActiveCaption"></Line>
                                    <DataLabels>
                                        <Border Color="Transparent"></Border>
                                        <Background Color="Transparent"></Background>
                                    </DataLabels>
                                </Web:SmoothLineChart>
                                <Web:ColumnChart Name="avgChart">
                                </Web:ColumnChart>
                            </Charts>
                            <YTitle ForeColor="115, 138, 156" StringFormat="Center,Near,Word,LineLimit"></YTitle>
                    </Web:ChartControl>
                </div>                
            </asp:Panel>
        </ContentTemplate>
    </asp:UpdatePanel>
</div> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-01T23:30:21.517

您使用的是哪个版本的 .NET？3.5 框架有一个新的图形控件。我花了几天时间玩它，对它的强大感到惊讶。而且我还在 UpdatePanels 中使用它，没有任何问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-13T15:41:05.367

这也不是一个好的解决方案，将可缓存性设置为 nocache 解决了我的问题。我在我的页面加载中写了这个

```
 Response.Cache.SetCacheability(HttpCacheability.NoCache); 
```

它也可以通过设置此代码来工作

```
<script type="text/javascript">

      var prm = Sys.WebForms.PageRequestManager.getInstance();
      prm.add_pageLoaded(pageLoaded);
      var c = 0;
      function pageLoaded(sender, args)
      {
      var img = document.getElementById("ctl00_ctl00_MainContent_MainContent_chartExchange");
      c++;
      img.src = img.src + "?" + c;
      }

</script> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-03T06:18:12.743

在我看来，无论如何，您在 FF 或 IE 上都应该有同样的问题。

我在你的更新面板上注意到你有

```
UpdateMode="Conditional" 
```

但您没有指定任何触发器。这意味着更新面板的内容不会被我看不到的更新面板内的任何按钮以外的任何其他东西触发。尝试将 UpdateMode 更改为 Always 以进行调试，看看是否能解决您的问题，并从那里找出适当的触发器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T22:34:03.203

编辑：

你能控制图形名称/文件名如何被创建并呈现给浏览器吗？图片可以被浏览器缓存吗？我在使用 AJAX 调用的 Java/JSP 中进行图形打包时遇到问题。我必须将 GUID 附加到我的 AJAX url 查询字符串变量以修复缓存问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T16:00:45.413

[使用FireBug](http://getfirebug.com)进行一些挖掘后，我发现无论我选择 120 Ditë 或 30 Ditë 还是 mesataret，都会返回完全相同的图像 URL。看起来您的图表控件正在返回相同的图像 URL，即使它背后的数据发生变化也是如此。对我来说听起来像是控件中的错误。

您可以使用 WebCharts 目录中的 web.config 来设置从那里提供的图像的可缓存性，以使它们永远不会被缓存。

# java - (TIBCO BusinessWorks) 如何从 Java 代码活动访问 Java 全局实例方法？

> ID：808920
> 
> 赞同：0
> 
> 时间：2009-04-30T20:36:03.177
> 
> 标签：java, tibco, businessworks

TIBCO ActiveMatrix BusinessWorks 调色板参考指出：

“任何 Java 代码活动都可以通过调用配置的 Java 类的静态方法来访问共享的 Java 全局实例”，但是，我无法找到任何代码示例来执行此操作，或者自己找出正确的语法。

什么不起作用：

```
method();
Class.method(); 
```

有什么作用：

我不知道，这就是我在这里的原因:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-04T05:31:41.367

如果您在 AliasLibrary 中引用了以下类：

com.example.foo.Foo

它有一个静态方法 bar()，然后你可以在 Java 代码活动中调用它，只需使用：

com.example.foo.Foo.bar();

在您的 Java 代码活动中。确保在 Java 代码配置面板中引用 AliasLibrary。

您可以在不使用 Java 全局实例的情况下执行此操作。对于静态方法，这是您所期望的……您不需要对象引用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-01T05:20:16.193

1.  在您的项目中，从 General 面板添加 AliasLibrary 任务。将 jar 文件添加到包含要访问的类的 AliasLibrary。

2.  在 BusinessWorks 流程活动中，将“Java Method”任务拖到画布上。使用配置选项卡指定 AliasLibrary，然后使用查找器找到您希望调用的类和方法。“高级”选项卡为您提供了一些用于管理与此方法调用关联的 java 实例生命周期的选项。

或者，如果要实例化在多个作业/进程之间共享的全局 Java 实例，则使用 Java 面板中的“Java 全局实例”任务。在配置选项卡中，指向 AliasLibrary 并使用查找器找到要执行的类和静态方法。“Java 方法”任务可用于调用此全局实例上的方法。

如果您的 java 类上没有默认构造函数，则“Java 全局实例”也可能是必需的。

# c# - string.Format 在 HTML + javascript 上引发 System.Format 异常

> ID：808924
> 
> 赞同：7
> 
> 时间：2009-04-30T20:37:02.660
> 
> 标签：c#, .net, asp.net, string

我`string.Format`在一个包含一些 HTML + javascript 的只读字符串上运行，但我得到了一个`System.FormatException`。

这是我的格式字符串：

```
<script type="text/javascript">
    function {0}_showHideFieldWindow() {
        if ({0}.IsCustomizationWindowVisible()) {
            {0}.HideCustomizationWindow();
        } else {
            {0}.ShowCustomizationWindow();
        }
    }
</script> 
```

我所做的只是传递对象名称。像这样：

```
string.Format(javascript, "grid"); 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-30T20:41:01.963

由于字符串中有大括号，因此您需要通过将它们加倍 ( **`{{`**and **`}}`**) 来转义它们，以防止格式化程序认为它们是标记。

您的字符串初始化应如下所示：

```
String javascript = @"<script type=""text/javascript"">
            function {0}_showHideFieldWindow() {{
            if ({0}.IsCustomizationWindowVisible()) {{
                {0}.HideCustomizationWindow();
            }} else {{
                {0}.ShowCustomizationWindow();
            }}
        }}
    </script>"; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-30T20:42:29.993

`String.Format`需要转义额外的括号。你可能最好做这样的事情，如果你不需要所有`String.Format`的功能，这可能比转义每个括号更具可读性：

```
mystring.Replace("{0}","grid"); 
```

# perl - Perl 中获取 file1 中所有未出现在 file2 中的行的最快方法是什么？

> ID：808930
> 
> 赞同：4
> 
> 时间：2009-04-30T20:37:31.783
> 
> 标签：perl, algorithm

我有两个（非常大的）文本文件。就运行时间而言，创建第三个文件的最快方法是什么，该文件包含 file1 中未出现在 file2 中的所有行？

因此，如果 file1 包含：

```
莎莉  
乔  
汤姆  
苏西

```

file2 包含：

```
莎莉  
苏西  
哈利  
汤姆

```

那么输出文件应该包含：

```
乔

```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-30T20:45:23.870

创建一个包含文件 2 中每一行的 hashmap。然后对于文件 1 中的每一行，如果它不在 hashmap 中，则输出它。这将是 O(N)，这是您可以达到的最佳效率等级，因为您必须读取输入。

Perl 实现：

```
#!/usr/bin/env perl
use warnings;
use strict;
use Carp ();

my $file1 = 'file1.txt';
my $file2 = 'file2.txt';

my %map;
{
    open my $in, '<',$file2 or Carp::croak("Cant open $file2");
    while (<$in>) {
      $map{$_} = 1;
    }
    close($in) or Carp::carp("error closing $file2");
}
{
   open my $in,'<', $file1 or Carp::croak("Cant open $file1");
   while (<$in>) {
    if (!$map{$_}) {
      print $_;
    }
   }
   close $in or Carp::carp("error closing $file1");
} 
```

如果文件 2 太大以至于 hashmap 无法放入内存，那么我们手头就会遇到不同的问题。然后一个可能的解决方案是对文件 2 的块（小到足以放入内存）使用上述解决方案，将结果输出到临时文件。如果文件 1 和文件 2 之间有足够的匹配，那么总输出应该是合理的大小。为了计算最终结果，我们对临时文件中的行进行交集，即要在最终结果中出现一行，它必须出现在每个临时文件中。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-30T20:46:53.900

不是 Perl 但有效：

`diff <(sort file1) <(sort file2)`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-01T05:15:03.117

我很惊讶没有人提出最节省内存的方法，即分别对两个文件进行排序，然后执行列表合并。如果您在 Unix 上，以下 3 个简单的命令将快速完成您需要的操作：

```
sort < file1 > file1.sorted
sort < file2 > file2.sorted
comm -2 -3 file1.sorted file2.sorted > differences 
```

**如果文件太大以至于 Perl 必须分页 VM 以将所有行加载到哈希表中，那么这种技术会*快得多*。** 否则，基于哈希表的方法应该更快。

如果你在 Unix 上，最好使用系统的外部`sort`命令，因为它对内存使用很智能——使用 Perl`sort()`需要将文件的全部内容读入内存。

如果您使用的是 Windows，请注意提供的`sort`命令不区分大小写*，并且无法关闭！* Windows 上也没有`comm`命令，所以你需要自己动手——将上面的第三行替换为：

```
perl subtract_sets.pl file1.sorted file2.sorted > differences.txt 
```

## 减集.pl

```
#!/usr/bin/perl
open my $f1, '<', $ARGV[0] or die;
open my $f2, '<', $ARGV[1] or die;

my $x = <$f1>;
my $y = <$f2>;

while (defined $x && defined $y) {
    if ($x lt $y) {
        print $x;
        $x = <$f1>;
    } elsif ($y lt $x) {
        print $y;
        $y = <$f2>;
    } else {
        # Lines match
        $x = <$f1>;
        $y = <$f2>;
    }
}

while (defined $x) {
    print $x;
    $x = <$f1>;
}

while (defined $y) {
    print $y;
    $y = <$f2>;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-30T21:20:28.357

```
#!/usr/bin/perl                                                                 

use warnings; 
use strict;

open(my $alpha, '<', 'file1') || die "Couldn't open file1";
open(my $beta, '<' , 'file2') || die "Couldn't open file2";

my %data;
map {$data{$_} = 1} <$alpha>;
map {print $_ unless $data{$_}} <$beta>; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-30T20:47:44.553

什么对你来说很大？比你的内存还大？您的基本答案是使用哈希，如果文件大于您的 RAM，那么您需要使用[与 dbm 绑定的哈希](http://search.cpan.org/~nwclark/perl-5.8.9/lib/AnyDBM_File.pm)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-01T13:40:08.020

只是一些效率基准：

10k 行，每行最多 10 个字符的随机字符串。

```
 Rate slipset marcog
slipset 47.6/s      --   -16%
marcog  56.7/s     19%     -- 
```

100k 行，每行最多 10 个字符的随机字符串。

```
 Rate slipset marcog
slipset 3.02/s      --   -34%
marcog  4.60/s     52%     - 
```

1000k 行，每行最多 10 个字符的随机字符串。

```
 s/iter slipset marcog
slipset   4.09      --   -33%
marcog    2.75     49%     -- 
```

1k 行，每行最多 100 个字符的随机字符串。

```
 Rate  slipset marcog
slipset 379/s      --   -12%
marcog  431/s     14%     -- 
```

100k 行，每行最多 100 个字符的随机字符串

```
 Rate slipset  marcog
slipset 2.15/s      --    -30%
marcog  3.08/s     44%      -- 
```

1k 行，每行最多 1000 个字符的随机字符串

```
 Rate slipset  marcog
slipset 133/s      --    -10%
marcog  148/s     11%      -- 
```

100k 行，每行最多 1000 个字符的随机字符串

```
 Rate slipset  marcog
slipset 1.01/s      --    -18%
marcog  1.22/s     22%      -- 
```

**内存效率**

Marcog：100k 行，每行最多 1000 个字符的随机字符串：

```
Memory usage summary: heap total: 163_259_635, heap peak: 61_536_800, stack peak: 17_648
         total calls     total memory   failed calls
 malloc|     307_425      162_378_090              0
realloc|       1_461           96_878              0  (nomove:1_218, dec:1_026, free:0)
 calloc|      12_762          784_667              0
   free|     307_598      155_133_460 
```

Slipset：100k 行，每行最多 1000 个字符的随机字符串：

```
Memory usage summary: heap total: 647_103_469, heap peak: 118_445_776, stack peak: 17_648
         total calls     total memory   failed calls
 malloc|     508_089      186_752_811              0
realloc|     399_907      459_553_775              0  (nomove:334_169, dec:196_380, free:0)
 calloc|      12_765          796_883              0
   free|     507_584      256_315_688 
```

# assembly - 如何编译汇编例程以用于 C 程序（GNU 汇编器）？

> ID：808948
> 
> 赞同：10
> 
> 时间：2009-04-30T20:39:50.483
> 
> 标签：assembly, linker, x86, compilation

我有一组汇编函数，我想通过创建头文件在 C 程序中使用它们。例如，如果我有定义实际汇编例程的 asm_functions.s 和具有函数原型的 asm_functions.h 以及我需要的一些标准#define。我的目标是使用 C 程序，比如 test_asm.c 来调用汇编函数。

asm__functions.h:

```
 #define ASM_CONST_1    0x80
 #define ASM_CONST_2    0xaf

uint8_t asm_foo( int, int, int ); 
```

asm__functions.s:

```
 /* dont need this: #include "asm_functions.h" */

.section .text
 .type asm_foo, @function
 asm__foo:
   /* asm code with proper stack manipulation for C calling conventions */
   ret 
```

测试__asm.c：

```
 #include "asm_foo.h"

int main() {
      uint8_t res = asm_foo( 1, 2, 3);
      return 0;
 } 
```

在这种情况下，编译链接程序的正确方法是什么？我正在尝试这样的事情：

```
 gas -o asm_foo.o asm_foo.s
gcc -o test_asm test_asm.c 
```

但是我仍然收到来自 GCC 的链接器错误，说我的汇编程序未定义。我希望这个人为的例子足以解释这种情况。

谢谢！

编辑：

这是我使用单个命令编译时的输出片段：

```
 tja@tja-desktop:~/RIT/SP2/latest$ gcc -o test_pci pci_config.s test_pci.c
/tmp/ccY0SmMN.o: In function `_pci_bios_read_byte':
(.text+0x8): undefined reference to`PCI_FUNCTION_ID'
/tmp/ccY0SmMN.o: In function `_pci_bios_read_byte':
(.text+0xa): undefined reference to`READ_CONFIG_BYTE'
/tmp/ccY0SmMN.o: In function `_pci_bios_read_byte':
(.text+0x18): undefined reference to`PCI_BIOS_FUNCTION_INT'
/tmp/ccY0SmMN.o: In function `_pci_bios_read_byte':
(.text+0x1b): undefined reference to`BAD_REGISTER_NUMBER'
/tmp/ccY0SmMN.o: In function `_pci_bios_read_word':
(.text+0x30): undefined reference to`PCI_FUNCTION_ID'
... 
```

所有这些，例如 PCI_FUNCTION_ID，都在我的头文件中定义，该文件包含在 C 程序中。当我自己编译汇编代码时，没有错误。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-30T20:44:37.227

根据您问题中的文件，我设法对其进行了编译。我已经更改了文件名和文件内容。

asm_const.h：

```
#define ASM_CONST_1    0x80
#define ASM_CONST_2    0xaf 
```

asm_functions.h：

```
#include "asm_const.h"
unsigned char asm_foo( int, int, int ); 
```

asm_functions.S（尾随的 S 必须大写！#include 需要它）：

```
#include "asm_const.h"
.section .text
.globl asm_foo
.type asm_foo, @function
asm_foo:
  mov $ASM_CONST_1, %eax
  /* asm code with proper stack manipulation for C calling conventions */
  ret 
```

test_asm.c：

```
#include "asm_functions.h"
int main() {
  return asm_foo( 1, 2, 3);
} 
```

请注意，您需要带有大写 S 的程序集文件扩展名 .S。使用 .s，.s 文件将不会通过预处理器运行，因此 #include 不起作用，您将无法使用.s 文件中的 ASM_CONST_1。

使用单个命令编译：

```
gcc -o test_asm asm_functions.S test_asm.c 
```

或者，作为替代方案，使用多个命令进行编译，创建 .o 文件：

```
gcc -c asm_functions.S
gcc -c test_asm.c
gcc -o test_asm asm_functions.o test_asm.o 
```

单命令 gcc 负责使用 gas 编译 .S 文件，使用 GCC 的 C 编译器编译 .c 文件，并使用 ld 将生成的临时 .o 文件链接在一起。gcc 默认使用适当的标志运行所有这些命令。

在某些系统上（但不是在默认安装 GCC 的 Linux 上），您必须在 .S 文件（但不是 .c 或 .h 文件）中的导出函数名称前加上下划线。因此，所有实例都`asm_foo`将`_asm_foo`仅在 .S 文件中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T20:43:32.800

您是否考虑过[使用内联汇编](http://www.ibiblio.org/gferg/ldp/GCC-Inline-Assembly-HOWTO.html)？这比使用汇编文件要容易得多。

编辑：此外，您收到链接器错误的原因可能是因为 C 编译器在实际符号的标识符上添加了前导下划线。尝试在您的程序集文件中添加下划线。

# delphi - 德尔福的 FxCop/StyleCop？

> ID：808961
> 
> 赞同：12
> 
> 时间：2009-04-30T20:42:23.957
> 
> 标签：delphi, fxcop, stylecop

有谁知道 Delphi 的 FxCop/StyleCop 等价物？我真的很想在持续集成中自动检查样式等。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-30T22:09:34.090

有来自 Peganza 的 Pascal Analyzer：[http ://www.peganza.com/products_pal.htm](http://www.peganza.com/products_pal.htm)

我不知道这些功能与 FxCop 相比如何，因为我没有真正使用过任何一个。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-30T21:08:26.373

我见过的最接近的是[SOCK software 的 CodeHealer](http://www.socksoftware.com/codehealer.php)。我们使用它，并将它集成到我们的 FinalBuilder 构建中。它在一个重要方面与 FxCop 不同：它分析源代码，而不是生成的可执行文件。它也没有像 FxCop 那样检查那么多。但我认为这是 Delphi 在这个类别中可用的最好的东西。

Delphi 2009 支持还没有，但他们说他们正在努力。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-24T13:50:11.583

[Delphi Code Analyzer](http://sourceforge.net/projects/dca/)是另一种开源的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-27T16:42:25.653

[DGrok](http://dgrok.excastle.com/)项目始于几年前的 FxCop 之类的东西。解析器和分析部分仍然可用，请在“ [DGrok 0.8.1：多线程、默认选项、GPL](http://blog.excastle.com/2008/09/14/dgrok-081-multithreading-default-options-gpl/) ”中阅读更多内容 - 解析器是一个 .Net 项目，但

> DGrok 是一组用于解析 Delphi 源代码并告诉你有关它的东西的工具。在 DGrok 项目页面上阅读有关它的更多信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-07-10T19:13:06.523

Sonar有一个新的[Delphi 插件](http://docs.codehaus.org/display/SONAR/Delphi+Plugin)，它使用 Delphi 语法对源代码运行自动测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-04T12:35:46.930

我听说过一种叫做[Delforex](http://www.delphipages.com/result.cfm?ID=629)的东西，但我自己还没有使用过它（还）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-05T23:01:20.210

Delforex 非常适合实际格式化代码。尽管如此，它并没有做更多的事情。（我们已经/确实使用它）。

我会支持 Pascal Analyzer 或 Code Healer 的投票。

瓦卡诺

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-05T23:03:24.620

Delphi 不输出 .net 兼容的 IL 代码吗？我已经很久没有使用过它了，但我认为较新的版本会输出 .net 程序集。

如果是这样，那么我会认为 FXcop 会起作用，您可以随时添加一些您自己的自定义规则。Stylecop 不会工作，但你至少可以让 FXCop 运行。

# mysql - 查找“X”公里（或英里）内的城市

> ID：808963
> 
> 赞同：12
> 
> 时间：2009-04-30T20:43:13.720
> 
> 标签：mysql, gis, coordinates, distance, coordinate-systems

这可能不清楚，也可能不清楚，如果我不在基地，请给我留言，或者您需要更多信息。也许已经有一个解决方案可以满足我在 PHP 中的需求。

我正在寻找一个可以从经度或纬度值中添加或减去距离的函数。

原因：我有一个包含所有纬度和经度的数据库，并希望形成一个查询来提取 X 公里（或英里）内的所有城市。我的查询看起来像这样......

```
Select * From Cities Where (Longitude > X1 and Longitude < X2) And (Latitude > Y1 and Latitude < Y2)

 Where X1 = Longitude - (distance)
 Where X2 = Longitude + (distance)

 Where Y1 = Latitude - (distance)
 Where Y2 = Latitude + (distance) 
```

我正在使用 PHP，使用 MySql 数据库。

也欢迎任何建议！:)

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-01T13:18:36.387

这是一个 MySQL 查询，它将完全按照您的要求进行。请记住，这样的事情通常是近似值，因为地球不是完美的球形，也没有考虑到山脉、丘陵、山谷等。我们在[AcademicHomes.com](http://www.academichomes.com "AcademicHomes.com")上使用 PHP 和 MySQL 上的这段代码，它返回 $ 内的记录$latitude, $longitude 的半径英里。

```
$res = mysql_query("SELECT
    * 
FROM
    your_table
WHERE
    (
        (69.1 * (latitude - " . $latitude . ")) * 
        (69.1 * (latitude - " . $latitude . "))
    ) + ( 
        (69.1 * (longitude - " . $longitude . ") * COS(" . $latitude . " / 57.3)) * 
        (69.1 * (longitude - " . $longitude . ") * COS(" . $latitude . " / 57.3))
    ) < " . pow($radius, 2) . " 
ORDER BY 
    (
        (69.1 * (latitude - " . $latitude . ")) * 
        (69.1 * (latitude - " . $latitude . "))
    ) + ( 
        (69.1 * (longitude - " . $longitude . ") * COS(" . $latitude . " / 57.3)) * 
        (69.1 * (longitude - " . $longitude . ") * COS(" . $latitude . " / 57.3))
    ) ASC"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T21:07:42.960

编辑：如果您在某个地方拥有世界上所有城市及其纬度的列表。并且很长。值，您可以进行查找。在这种情况下，请参阅下面的第一个链接，了解计算纬度上一个经度宽度的公式![替代文字](https://upload.wikimedia.org/math/5/f/d/5fdb32644846e557c5c88dfc54307c03.png)：

![替代文字](https://upload.wikimedia.org/math/1/d/f/1df25c7c5a4a5eaf331c7376677ab3b5.png)

老实说，这个问题背后的复杂性是，你最好使用谷歌地图等服务来获取你的数据。具体来说，地球不是一个完美的球体，两度之间的距离会随着您离赤道的近/远而变化。

有关我的意思的示例，请参见[http://en.wikipedia.org/wiki/Geographic_coordinate_system](http://en.wikipedia.org/wiki/Geographic_coordinate_system)，并查看[Google Maps API](http://code.google.com/apis/maps/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-01T08:47:54.587

根据您包含的城市数量，您可以预先计算列表。我们在这里为一个内部应用程序执行此操作，其中 +100m 的不准确性对于我们的设置来说太大了。它的工作原理是有一个 location1、location2、distance 的两个键表。然后，我们可以非常快速地从 location1 拉回位置 x 距离。

此外，由于计算可以离线完成，它不会影响系统的运行。用户还可以获得更快的结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-07T14:30:36.897

我尝试使用上面的代码，当点之间的距离在 20-30 英里范围内时，答案偏离了太多，我可以接受几英里的错误。与我的一位制图伙伴交谈，我们想出了这个。代码是 python，但你可以很容易地翻译它。为了避免不断转换为弧度，我重新编写了我的数据库，将纬度/经度点从度数转换为弧度。关于这一点的好处是，数学的最大部分大多只完成一次。

```
ra = 3963.1906 # radius @ equator in miles, change to km  if you want distance in km
rb = 3949.90275  # radius @ poles in miles, change to km  if you want distance in km
ra2 = ra * ra
rb2 = rb * rb

phi = self.lat

big_ol_constant = (math.pow(ra2*math.cos(phi), 2) + pow(rb2*math.sin(phi), 2))/ (pow(ra*math.cos(phi), 2) + pow(rb*math.sin(phi), 2))

sqlWhere = "%(distance)g > sqrt((power(lat - %(lat)g,2) + power(lng-%(lng)g,2)) * %(big_ol_constant)g)" % {
    'big_ol_constant': big_ol_constant, 'lat': self.lat, 'lng': self.lng, 'distance': distance}

# This is the Django portion of it, where the ORM kicks in.  sqlWhere is what you would put after the WHERE part of your SQL Query.
qs = ZipData.objects.extra(where=[sqlWhere]); 
```

当距离很小时似乎非常准确，并且在距离增加到 200 英里时在 10 英里左右（当然，到那时，你会遇到“乌鸦飞翔”与“铺砌的道路”的问题）。

这是我上面提到的模型 ZipData。

```
class ZipData(models.Model):
    zipcode = ZipCodeField(null=False, blank=False, verbose_name="ZipCode", primary_key=True)
    city = models.CharField(max_length=32, null=False, blank=False)
    state = models.CharField(max_length=2)
    lat = models.FloatField(null=False, blank=False)
    lng = models.FloatField(null=False, blank=False) 
```

[额外说明一下，您可以在GeoNames.org](http://download.geonames.org/export/zip/)上获得大量与邮政编码相关的地理数据，他们甚至还有一些您可以使用的 Web 服务 API。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T20:48:35.190

有很多（不好的选择）

*   使用数学公式（将 X1-X2 和 Y1-Y2 视为向量）计算距离。

*   提前创建一个包含所有组合的查找表并保持距离。

*   考虑使用 MySQL 的 GIS 特定扩展。这是我发现的[一篇文章。](http://dev.mysql.com/tech-resources/articles/4.1/gis-with-mysql.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T20:58:47.583

lessthandot.com 实际上有 3 种不同的方法来做到这一点。您必须稍微滚动浏览博客，但它们就在那里。 [http://blogs.lessthandot.com/](http://blogs.lessthandot.com/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T21:30:29.660

下面的函数来自[nerddinner的（](http://nerddinner.com)[在 codeplex 上可用](http://nerddinner.codeplex.com/)的 ASP.NET MVC 示例应用程序）数据库 (MSSQL)。

```
ALTER FUNCTION [dbo].[DistanceBetween] (@Lat1 as real,
                @Long1 as real, @Lat2 as real, @Long2 as real)
RETURNS real
AS
BEGIN

DECLARE @dLat1InRad as float(53);
SET @dLat1InRad = @Lat1 * (PI()/180.0);
DECLARE @dLong1InRad as float(53);
SET @dLong1InRad = @Long1 * (PI()/180.0);
DECLARE @dLat2InRad as float(53);
SET @dLat2InRad = @Lat2 * (PI()/180.0);
DECLARE @dLong2InRad as float(53);
SET @dLong2InRad = @Long2 * (PI()/180.0);

DECLARE @dLongitude as float(53);
SET @dLongitude = @dLong2InRad - @dLong1InRad;
DECLARE @dLatitude as float(53);
SET @dLatitude = @dLat2InRad - @dLat1InRad;
/* Intermediate result a. */
DECLARE @a as float(53);
SET @a = SQUARE (SIN (@dLatitude / 2.0)) + COS (@dLat1InRad)
                 * COS (@dLat2InRad)
                 * SQUARE(SIN (@dLongitude / 2.0));
/* Intermediate result c (great circle distance in Radians). */
DECLARE @c as real;
SET @c = 2.0 * ATN2 (SQRT (@a), SQRT (1.0 - @a));
DECLARE @kEarthRadius as real;
/* SET kEarthRadius = 3956.0 miles */
SET @kEarthRadius = 6376.5;        /* kms */

DECLARE @dDistance as real;
SET @dDistance = @kEarthRadius * @c;
return (@dDistance);
END
```

我猜这可能会有所帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-01T09:50:13.547

您可以使用毕达哥拉斯定理来计算两对纬度/经度点的接近度。

如果您有两个位置（Alpha 和 Beta），您可以计算它们之间的距离：

```
SQRT( POW(Alpha_lat - Beta_lat,2) + POW(Alpha_lon - Beta_lon,2) ) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-01T10:17:01.833

使用来自以下 URL 的设置，我构建了下面的查询。（请注意我使用 codeIgnitor 来查询数据库）

[http://howto-use-mysql-spatial-ext.blogspot.com/2007/11/using-circular-area-selection.html](http://howto-use-mysql-spatial-ext.blogspot.com/2007/11/using-circular-area-selection.html)

```
function getRadius($point="POINT(-29.8368 30.9096)", $radius=2)
{
    $km = 0.009;
    $center = "GeomFromText('$point')";
    $radius = $radius*$km;
    $bbox = "CONCAT('POLYGON((',
        X($center) - $radius, ' ', Y($center) - $radius, ',',
        X($center) + $radius, ' ', Y($center) - $radius, ',',
        X($center) + $radius, ' ', Y($center) + $radius, ',',
        X($center) - $radius, ' ', Y($center) + $radius, ',',
        X($center) - $radius, ' ', Y($center) - $radius, '
    ))')";

    $query = $this->db->query("
    SELECT id, AsText(latLng) AS latLng, (SQRT(POW( ABS( X(latLng) - X({$center})), 2) + POW( ABS(Y(latLng) - Y({$center})), 2 )))/0.009 AS distance
    FROM crime_listing
    WHERE Intersects( latLng, GeomFromText($bbox) )
    AND SQRT(POW( ABS( X(latLng) - X({$center})), 2) + POW( ABS(Y(latLng) - Y({$center})), 2 )) < $radius
    ORDER BY distance
        ");

    if($query->num_rows()>0){
        return($query->result());
    }else{
        return false;
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-12-02T13:19:35.670

不要重新发明轮子。这是一个空间查询。使用[MySQL 内置的空间扩展](https://stackoverflow.com/questions/159255/what-is-the-ideal-data-type-to-use-when-storing-latitude-longitudes-in-a-mysql)，将经纬度坐标数据存储在[原生 MySQL 几何列类型](http://dev.mysql.com/doc/refman/5.0/en/creating-spatial-values.html)中。然后使用[距离](http://dev.mysql.com/doc/refman/5.0/en/functions-that-test-spatial-relationships-between-geometries.html#function_distance)函数查询彼此之间指定距离内的点。

免责声明：这是基于阅读文档，我自己没有尝试过。

# .net - 使用 jQuery 调用 .NET 页面方法的任何缺点或更好的替代方法？

> ID：808982
> 
> 赞同：0
> 
> 时间：2009-04-30T20:48:09.513
> 
> 标签：.net, jquery, ajax

我需要想出一种更智能/更简单的方式来在我们当前的 .net webforms 应用程序中进行 ajax 调用。我了解 jQuery 基础知识，我非常喜欢它。我正在考虑向我的团队建议使用 jQuery 直接调用 .net 页面方法，如此[处](http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/)所述。

有谁知道这种方法的任何问题/限制？有没有更简单的做事方式？MVC 不是一个选项。

谢谢

注意：您可以假设我对使用 JSON 感到满意。我基本上是在询问任何已知的缺陷。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T21:30:40.050

我想不出任何主要的缺点，除了传统的 .NET 应用程序的工作方式并非如此，因为必须在“表示层”中编写大量附加代码才能使其工作。

然而，除此之外，任何额外的学习/发展都不是问题，那就去做吧。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T23:25:13.380

我看到你看过 Dave Ward 关于 Encosia 的文章。我们在生产中使用了这些技术，它们解决了我们面临的一些主要架构障碍。您会发现无需使用 MVC 即可轻松地将这种技术应用到您的代码中。

如果您打算使用 jQuery 调用页面方法，我会考虑阅读 Dave[关于 micro-templates 的文章](http://encosia.com/2008/06/26/use-jquery-and-aspnet-ajax-to-build-a-client-side-repeater/)，因为这种技术是建立在页面方法方法之上的。这种方法的一个很好的副产品是，您可以更灵活地配置您的网站，因为对演示文稿的任何更改都不需要重新编译和重新部署。

# cocoa - 将文档保存为文件夹，例如 Pages、Numbers 等

> ID：808986
> 
> 赞同：1
> 
> 时间：2009-04-30T20:48:38.607
> 
> 标签：cocoa, macos

保存 Pages、Numbers 和其他 OSX 应用程序等数据的正确方法是什么？也就是说，它在用户看来像是一个文件，但实际上是一个包含各种东西的目录（一个包？）。我有一些相当复杂的数据，我想以同样的方式存储它们；特别是一些需要与视频文件关联的传感器数据。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T20:51:28.647

Apple[关于该主题的官方文档](http://developer.apple.com/DOCUMENTATION/CoreFoundation/Conceptual/CFBundles/Concepts/DocumentBundles.html#//apple_ref/doc/uid/20002128-BAJCGCFF)可能是一个很好的起点。

从 Pages Info.plist 文件中：

```
<key>CFBundleDocumentTypes</key>
<array>
    <dict>
        <key>CFBundleTypeExtensions</key>
        <array>
            <string>pages</string>
        </array>
        [...]
        <key>LSTypeIsPackage</key>
        <true/>
        [...]
    </dict>
</array> 
```

似乎有什么诀窍。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-01T01:38:49.050

它看起来也`NSFileWrapper`可能是答案的一部分： [基于文档的应用程序概述常见问题解答](http://developer.apple.com/documentation/Cocoa/Conceptual/Documents/Tasks/FAQ.html#//apple_ref/doc/uid/20000954-1081069-BAJHBHGJ)。

# php - PHP 登录表单

> ID：808987
> 
> 赞同：4
> 
> 时间：2009-04-30T20:48:55.907
> 
> 标签：php, session

```
 <form action="form.php" method="post">
    Username: <input type="text" name="user" maxlength="50" value="" />
    Password: <input type="password" name="pass" maxlength="20" value="" />
    <input type="submit" name="Submit" value="Submit" />
    </form>
    <?php
    $Accesstrys = 0;
    if($_POST['Submit'] == "Submit") {
    $Accesstrys++;
    if($Acesstrys == 3)
    {
    $ip = getenv("REMOTE_ADDR");
    $file = fopen("Loginlimit/$ip",'w');
    fwrite($file,"$Accesstrys:$ip");
    }   
    }
    ?> 
```

我试图编写一个 PHP 登录脚本，如果你失败了，给你 3 次尝试登录，当它冻结让我们说 10 分钟。

远未完成，但我对此进行了测试，但它没有用我的 ip 创建/写入文件。我出了什么问题

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T20:51:52.810

由于 PHP 是服务器端的，因此您的`$Accesstrys`变量在每次请求时都设置为 0。

关键是使用会话。尝试递增`$_SESSION["AccessTrys"]`而不是`$Accesstrys`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T20:54:35.550

PHP 与大多数专门用于 Web 应用程序的动态语言一样，在无状态环境中运行。为了跟踪 HTTP 请求之间的登录尝试，您需要为您的用户创建一个[会话：](http://us3.php.net/manual/en/features.sessions.php)

```
<?php

session_start();
if (!isset($_SESSION['Accesstrys'])) {
  $_SESSION['Accesstrys'] = 0;
}
$_SESSION['Accesstrys']++;
// ... your code goes here ... 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T20:59:29.970

据推测，登录用户名/密码组合并没有被硬编码到脚本中，而是从某种数据库中检索出来的。在这种情况下，为什么不为每个用户添加一个新列。这解决了如果用户只是在每 3 次尝试时删除会话 cookie 的问题。

该数据库还允许您在达到 3 次失败尝试时“锁定”帐户。

如果您真的需要安全性，您可以混合使用会话和数据库列，但将会话数据存储在数据库中。谷歌有很多例子说明如何使用 set_session_save_handler 函数来做到这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T21:05:07.130

您希望使用数据库来存储重试次数（按 IP 地址或更好的用户名），因为正如其他人所提到的，您的 $Accesstrys 将在每个请求上重置为零。

我很惊讶有这么多人建议使用会话来跟踪重试次数。那里有一个基本的安全漏洞 - 如果登录尝试来自试图破解帐户的自动机器人，则不会有 cookie（或 URL 会话 ID），并且您对访问尝试的会话跟踪将毫无用处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T20:52:37.910

乍一看，您似乎每次都用 0 覆盖@Accesstrys，最大为 1。您应该做的是将 $Accestrys 文件设置为 0，然后将变量设置为文件，增加变量，然后然后将文件设置为等于变量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-30T20:55:44.797

你采取的方法有很多问题。例如

1.  REMOTE_ADDR 对于每个用户来说不是唯一的
2.  除非您处理同时访问您的服务器的用户，否则将信息写入文件是行不通的
3.  $Accesstry++ 在每次使用时都会消失，因此它的值永远不会被保存。
4.  ETC..

您需要使用称为会话的功能并将信息存储在会话或数据库中。看看[http://us.php.net/manual/en/features.sessions.php](http://us.php.net/manual/en/features.sessions.php)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T20:51:42.687

每次发布尝试时，都会将访问尝试次数重置为 0。您需要将尝试次数存储在服务器端解决方案中，例如数据库或会话。

**编辑** 正如我在评论中提到的，我之前关于将此类信息放入 cookie 中的想法只是最糟糕的做法。感谢星星的社区编辑。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-04-30T21:07:31.913

我想在代码中再添加一个问题，而不是检查提交值是否等于它，而是使用 ISSET。

```
if(isset($_POST['Submit'])) {
// Action code
} 
```

查看如何有效开发登录表单的示例。
***请参阅以下链接：***
[登录表单示例代码](http://adriaanvm.com/archives/howto-create-a-login-form-in-php)
[文件打开和写入 - PHP 函数](http://in.php.net/manual/en/function.fwrite.php)
[会话以跟踪值，直到会话过期/浏览器关闭](http://www.tizag.com/phpT/phpsessions.php)

# java - 使用 Netbeans 6.5.1 访问 Web 应用程序上的数据库的 JApplet 出现问题

> ID：808988
> 
> 赞同：1
> 
> 时间：2009-04-30T20:48:58.120
> 
> 标签：java, database, web-applications, netbeans, applet

我使用访问数据库的 Netbeans 6.5.1 创建了一个 JApplet。当程序自行运行时，它运行完美。问题是当您尝试使用 Netbeans 中的 Web 应用程序使其联机时，它不会访问数据库。有人告诉我，问题在于 Java 安全性不允许您这样做。它是否正确？我该如何解决这个问题？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-02T06:29:32.883

如前所述，未签名的小程序只能与小程序起源的主机建立网络连接。但是，如果数据库托管在与原始小程序不同的服务器上，则您必须对小程序进行签名。如果应用程序不用于生产用途，您可以对小程序进行自签名（不适用于必须由受信任的证书颁发机构进行签名的生产用途。证书颁发机构通常会为验证其客户凭据的服务收取费用。 ) 但是，出于测试和演示目的，您可以创建自签名证书。使用自签名证书时，浏览器会向用户显示警告，指出自签名证书中提供的信息未经受信任的第三方（证书颁发机构）验证。

对于自签名小程序，请查看以下链接：

[http://java.sun.com/developer/onlineTraining/Programming/JDCBook/signed.html](http://java.sun.com/developer/onlineTraining/Programming/JDCBook/signed.html)

[http://www-personal.umich.edu/~lsiden/tutorials/signed-applet/signed-applet.html](http://www-personal.umich.edu/~lsiden/tutorials/signed-applet/signed-applet.html)

要记住的其他事项是要使用的 JDBC 驱动程序类型。Type-1 和 Type-2 驱动程序不适合在 applet 中使用，因为它们依赖于本地二进制代码。Type-3 和 Type-4 是您应该用来从小程序内连接到数据库的类型。

最好的解决方案是不要从小程序建立数据库连接（如果可能），而是使用服务器端应用程序代表小程序连接到数据库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-01T15:56:01.657

正如克林特所指出的，小程序只允许连接到它的源服务器。要解决此问题，您可以使用来自根授权的证书签署您的小程序，但证书费用为 200-400 美元/年。

# css - CSS 中的分页符属性应该如何工作？

> ID：808991
> 
> 赞同：3
> 
> 时间：2009-04-30T20:50:05.047
> 
> 标签：css, printing

现代浏览器应该在某种程度上[支持 CSS 分页符属性。](https://stackoverflow.com/questions/117772/which-browsers-support-page-break-manipulation-using-css-and-the-page-break-insid/117834#117834)但是，当我使用`avoid`、`widows`或`orphans`. 我做错了，还是浏览器支持不如宣传的那么可靠？

```
 h2 {
        page-break-after: avoid;
      }                         

      p {
        page-break-inside: avoid;   
        orphans: 2;
        widows: 2;
      } 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-30T20:57:08.757

浏览器对打印的支持很糟糕。不只是一点点，而是完全没有可比性。大约每隔一年（过去 10 年），我一直在玩这个，我总是得出同样的结论：不要依赖浏览器来处理良好的打印。

如果它绝对必须正确定位，请即时创建一个 pdf 文件并让用户打印。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T21:06:35.740

如果你想做一个分页符，我知道这是它至少在 Firefox 和 IE 中的工作方式。上次我检查这在 IE7 中有效。

```
Page 1

<br style="page-break-after:always" />

Page 2 
```

它*应该*将页面打印在单独的纸上，完全取决于浏览器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-02T02:53:08.567

我知道这将违背每个人所说的关于 html 开发的一切，但使用**表格**。把需要待在一起的内容放到一个表格中，这样页面就不会在表格中间被分割了。如果表格长于一页，那么它将在表格中间的某个位置被拆分，但使用表格是打印时保持内容在一起的好方法。

# sql - 单数还是复数数据库表名？

> ID：808992
> 
> 赞同：56
> 
> 时间：2009-04-30T20:50:08.430
> 
> 标签：sql, mysql, sql-server

### 完全重复

> [表命名困境：单数与复数名称](https://stackoverflow.com/questions/338156/table-naming-dilemma-singular-vs-plural-names)

使用单数或复数数据库表名更好吗？有公认的标准吗？

我听到了支持和反对它的论点，你们怎么看？

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-04-30T20:53:55.020

单数，因此您可以拥有：

*   顾客
*   客户地址
*   客户地址审计跟踪

等等

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2009-04-30T20:52:27.973

恕我直言，表名应该像客户一样是复数。

如果类名映射到客户表中的一行，则类名应该像客户一样是单数的。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-04-30T20:54:38.687

我喜欢单数的名字，但似乎是少数。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-04-30T20:52:57.800

我个人的理念是，使用复数数据库表名是多余的，除非您只计划表包含一行。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-04-30T20:52:19.800

我喜欢使用具有 PK 名称（例如 AgentID）的单数名称，例如 Agent。

但这只是我:o)

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-04-30T20:53:27.847

我喜欢使用复数形式，只是因为一张表包含多个实体，所以对我来说似乎更自然。

Linq to SQL 在创建数据实体时将复数形式的表名转换为单数形式。如果 Microsoft 认为表名的复数形式是不好的做法，我认为 Microsoft 不会实现此功能。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-04-30T20:55:13.583

在我目前的公司，我们使用复数作为表名。推理是这样的：如果我们有一个客户表，我们认为每一行都是客户，所以表本身就是客户的集合。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-04-30T20:56:28.180

好吧，显然您的数据库表名必须**以**“标准”方式命名，我将在此之前任意定义。

首先，所有表名都应以“t_”为前缀。在此之后，StudlyCaps 中的单数实体名称，例如“客户”。紧接着，这应包含在模式的第一个版本中创建的列数，出于历史目的，后跟下划线，以及数据的精确范式；BCNF 为“1”、“2”、“3”或“B”。任何更高的范式都应以“P”表示。

可接受名称的一些示例是：

```
t_Customer_6_3
t_Order_5_B
t_OrderLine_4_2 
```

我认为我的观点是，这**真的没关系**，只要名称具有合理的描述性并且命名是一致的。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-30T20:55:57.950

最重要的是在你的使用中保持一致。必须记住哪些表是复数形式，哪些不是复数形式，这很烦人。与您的字段名称相同，选择一个标准并使用它。不要让可怜的开发人员必须确定该表是否使用 person_id 或 personid 或 peopleid 或 person$id 等。当您没有标准试图记住哪个表使用时，您可以浪费的时间量是惊人的什么。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-04-30T20:56:08.027

没有应该或必须以这种方式或那种方式正确回答这个问题。这取决于数据库和软件的设计者。

至于我，我通常使用单数名称，因为当我做 ER 图表时，我有一个实体 Customer，而不是 Customers，所以我保持不变以免混淆。

当然，有些框架确实偏爱一种或另一种风格，所以当你注意到它们时，最好遵循这些做法。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-04-30T20:57:58.333

每个都有很多论据，但这一切都归结为你觉得舒服。两者都没有错。

What's really important is that you are consistent. Choose one standard and stick to it, which one you choose is of less importance.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-30T20:54:55.690

恕我直言，这并不重要，只要对您和使用数据库的人感到满意即可。

我想我会下意识地用 s 和“选择列表”或外键表和单数列出主要数据表。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-30T20:56:16.233

与许多此类问题一样，最佳答案通常是“一致的”。您可以争辩说该表表示单个实体，因此应该使用单数名称，或者它包含一个实体的多个实例，因此它应该是复数。我的建议是掷硬币并为整个数据库使用它（或坚持已经占多数的约定）。**