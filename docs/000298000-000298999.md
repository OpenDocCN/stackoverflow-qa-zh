# StackOverflow 问答 000298000-000298999

# java - python (jython) 归档库

> ID：298004
> 
> 赞同：1
> 
> 时间：2008-11-18T06:32:35.660
> 
> 标签：java, python, jython, archive

是否有一个简洁的归档库可以自动为您处理归档文件夹或目录？我正在使用 Jython，所以 Java 库也可以使用。-UPDATE- 我也在寻找时间戳归档。IE

存档目录/2008/11/16/zipfilebypreference.zip

然后第二天再次调用它，它会创建另一个文件夹。我确定互联网上有一些东西，谁知道？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T07:08:09.473

您有：

*   在 Jython servlet 中使用的 [gzip 库：](http://www.xhaus.com/alan/python/httpcomp.html)

```
import  javax.servlet.http.HttpServlet

import  cStringIO
import  gzip
import  string

def compressBuf(buf):
    zbuf = cStringIO.StringIO()
    zfile = gzip.GzipFile(mode = 'wb',  fileobj = zbuf, compresslevel = 6)
    zfile.write(buf)
    zfile.close()
    return zbuf.getvalue() 
```

*   或直接使用 java.util.zip ，如图所示[，](https://www.acm.org/crossroads/xrds6-3/ovp63.html)用于一个文件，或用于所有目录内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T06:59:56.510

您可以使用 java.util.zip，当我使用 Jython 时，python 中的内置 zip 库不起作用

# c# - 读取对象属性时忽略 NullReferenceException

> ID：298009
> 
> 赞同：6
> 
> 时间：2008-11-18T06:38:29.847
> 
> 标签：c#, .net, exception, language-features, serialization

有没有办法指示 C# 忽略`NullReferenceException`一组语句（或任何特定的例外）。这在尝试从可能包含许多空对象的反序列化对象中读取属性时很有用。有一个辅助方法来检查 null 可能是一种方法，但我在语句块级别寻找接近“On Error Resume Next”（来自 VB）的东西。

编辑：Try-Catch 将跳过有关异常的后续语句

```
try
{
   stmt 1;// NullReferenceException here, will jump to catch - skipping stmt2 and stmt 3
   stmt 2;
   stmt 3;
}
catch (NullReferenceException) { } 
```

例如：我正在将 XML 消息反序列化为对象，然后尝试访问类似的属性

```
Message.instance[0].prop1.prop2.ID 
```

现在 prop2 可能是一个空对象（因为它在 XML 消息中不存在 - XSD 中的一个可选元素）。现在我需要在访问叶元素之前检查层次结构中每个元素的 null 。即，在访问“ID”之前，我必须检查 instance[0]、prop1、prop2 是否不为空。

有没有更好的方法可以避免对层次结构中的每个元素进行空检查？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-18T06:40:37.923

简而言之：没有。在尝试使用它之前对引用进行空检查。这里一个有用的技巧可能是 C# 3.0 扩展方法......它们允许您在空引用*上*调用某些东西而不会出错：

```
string foo = null;
foo.Spooky();
...
public static void Spooky(this string bar) {
    Console.WriteLine("boo!");
} 
```

除此之外 - 也许使用条件运算符？

```
string name = obj == null ? "" : obj.Name; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-18T07:15:22.453

三元运算符和/或 ?? 运算符可能有用。

假设您正在尝试获取 myItem.MyProperty.GetValue() 的值，而 MyProperty 可能为空，并且您希望默认为空字符串：

```
string str = myItem.MyProperty == null ? "" : myItem.MyProperty.GetValue(); 
```

或者在 GetValue 的返回值为 null 的情况下，但您希望默认为：

```
string str = myItem.MyProperty.GetValue() ?? "<Unknown>"; 
```

这可以组合成：

```
string str = myItem.MyProperty == null 
    ? "" 
    : (myItem.MyProperty.GetValue()  ?? "<Unknown>"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-14T12:24:04.773

现在我正在使用委托和 NullReferenceException 处理

```
public delegate string SD();//declare before class definition

string X = GetValue(() => Message.instance[0].prop1.prop2.ID); //usage

//GetValue defintion
private string GetValue(SD d){
        try
        {
            return d();
        }
        catch (NullReferenceException) {
            return "";
        }

    } 
```

感谢 [Try-catch 没有单独的 try-catch 块](https://stackoverflow.com/questions/117173/c-try-catch-every-line-of-code-without-individual-try-catch-blocks) 的每一行代码的想法

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T06:42:17.187

```
try
{
   // exceptions thrown here...
}
catch (NullReferenceException) { } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T08:14:51.460

我会使用辅助方法。On Error Resume Next 只会导致疯狂。

# sql-server - 可以在不将所有人踢出数据库的情况下重置 DMV 视图吗？

> ID：298011
> 
> 赞同：0
> 
> 时间：2008-11-18T06:40:16.767
> 
> 标签：sql-server, sql-server-2005, performance

我看过帖子显示了三种重置 DMV 视图的方法：

1.  重置 SQL 服务
2.  分离数据库
3.  关闭数据库

所有这些方法似乎都需要让系统离线一段时间。有没有办法在不中断数据库使用的情况下按需重置统计信息？当我们在生产中出现奇怪的性能问题时，将 dmv 视图中的数据限制为在性能问题持续期间收集的数据很有用，以帮助描述性能问题期间的系统状态。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-12T08:53:15.600

您只能[重置 2 个 DMV](http://msdn.microsoft.com/en-us/library/ms189768(SQL.90).aspx)（BOL 链接）

```
sys.dm_os_latch_stats
sys.dm_os_wait_stats 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T13:03:58.727

据我所知，这些视图只会在实例重新启动时更新。

但是，对于某些视图，您可以在开始测量之前获取数据副本，然后再进行比较。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T04:59:52.460

我们最终对 DMV 视图进行快照以提取数据中的增量。我们正在研究我们假设做同样事情的 SQL Server 性能数据仓库。

# cocoa - 获取核心数据实体，但不获取子实体

> ID：298013
> 
> 赞同：4
> 
> 时间：2008-11-18T06:41:38.997
> 
> 标签：cocoa, core-data

假设我有以层次结构组织的实体，它们`Parent`是根实体并`Child`是`Parent`. 我想设置一个`NSArrayController`来仅获取 的实体`Parent`，但不获取`Child`。

如果在 Interface Builder 中将数组控制器的实体名称设置为，`Parent`它将获取所有实体。我最初尝试在 Interface Builder 中将数组控制器的 fetch 谓词设置为：`Parent``Child`

```
entity.name == "Parent" 
```

这适用于 XML 存储，但是当我切换到 SQLite 存储时，它不再有效。我收到以下错误：

```
keypath entity.name not found in entity <NSSQLEntity xxx> 
```

作为一种解决方法，我在我的中设置了一个过滤谓词（具有与上述相同的`entity.name`谓词）`awakeFromNib`来仅过滤父实体。显然，一旦实体在内存中，该谓词就有效，但您不能在 SQL 支持的提取谓词中使用它。

有没有办法只获取`Parent`实体，而不是`Child`使用与 SQLite 存储一起使用的获取谓词的实体？使用过滤谓词引入您只会忽略的实体似乎很浪费。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-18T08:10:24.170

为了这个目的， Leopard 将`includesSubentities`属性引入 NSFetchRequest。您必须继承您的 NSObjectController 或 NSArrayController 以提供它将通过其属性使用的获取请求，或者通过覆盖其方法`defaultFetchRequest`来更改它使用的获取请求。`-fetchWithRequest:...`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-20T02:59:24.933

我尝试使用`includesSubentities`，但最终无法完全正常工作。事实证明，如果您将“自动准备内容”设置为“是”，那么对子实体的更改会导致数组控制器的内容在不进行获取的情况下更新，从而绕过自定义获取谓词。回溯显示`setContent:`被调用以响应 MOC 通知。

我发现可靠地做到这一点的唯一方法是使用过滤谓词。

# rss - 浏览器处理提要以“友好”界面显示

> ID：298015
> 
> 赞同：2
> 
> 时间：2008-11-18T06:45:11.923
> 
> 标签：rss, feed

开发人员是否必须在提要的 XML 文件或超链接中的属性中放置某些/额外的元素，以便浏览器识别它是可以订阅的提要？或者只要 XML 验证，浏览器会自动执行此操作吗？

（向用户显示 Firefox 中的“使用...订阅此提要”界面或“您正在查看包含经常更新内容的提要。当您订阅提要时，...”Internet Explorer 上的界面等）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-19T17:12:52.903

大多数现代浏览器都足够智能，可以检查 XML 数据源和 HTTP 标头，并确定它是否代表联合提要（通常格式为 Atom 或 RSS）。但是，您可以做一些事情来改进网站内联合提要的自动发现以及动态生成联合提要时：

**自动发现网站提供的联合提要**

为 Web 浏览器提供提要[自动发现](http://www.rssboard.org/rss-autodiscovery)的既定方法是通过在网页头部使用*rel*属性值为**alternate的****链接**元素。您还应该使用链接的*类型*属性指定提要的 MIME 类型，并且可以使用*标题*属性指定提要的名称。大多数浏览器将支持发现多个提要（例如，当您以多种格式提供相同的联合内容时）。

 *****例子：

```
<html>
  <head>
    <title>My Web Site</title>
    <link rel="alternate" type="application/atom+xml" title="My Feed (Atom)" href="/feed.aspx?format=atom" />
    <link rel="alternate" type="application/rss+xml" title="My Feed (RSS)" href="/feed.aspx?format=rss" />
  </head>
  <body>
    <!-- page content -->
  </body>
</html> 
```

**明确指出联合内容的 HTTP MIME 类型**

如果您要动态生成联合内容，最好明确指出 MIME[内容类型](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.contenttype.aspx)。对于 Atom 提要，官方注册的 MIME 类型是**application/atom+xml**。虽然实际上没有正式注册的 RSS 提要 MIME 类型，但使用的事实上是**application/rss+xml**。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T06:53:18.397

提要不仅仅是 XML，还应遵循[ATOM Syndication Format](http://en.wikipedia.org/wiki/ATOM "ATOM 上的维基百科")或[RSS](http://en.wikipedia.org/wiki/RSS_(file_format) "RSS 上的维基百科")等格式。

浏览器可以检测指示这些提要格式之一的标题。

[旁注：HTML 页面可以使用适当的“替代”链接标签指向其相应的提要。这不是要检测*此*页面*是*提要，而是要检测此页面*有*提要。]

# visual-studio-2008 - 真的值得从 VC6 -> vc2005,2008 移植吗？

> ID：298016
> 
> 赞同：2
> 
> 时间：2008-11-18T06:47:41.637
> 
> 标签：visual-studio-2008, visual-c++, visual-studio-2005, visual-c++-6

您在这样做时预见到的所有问题是什么。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-24T16:24:43.200

1.  **Microsoft 不再**以任何方式支持 VC 6。如果出现问题并且无论出于何种原因我们无法编译，我们将完全靠我们自己无法从 Microsoft 获得任何帮助。似乎不太可能以这种方式出错，但如果有问题的代码是主要的收入来源，那么你就可以平衡事情了。
2.  **在 VC6 中编译 64 位代码是不可能的**。32 位程序在 64 位 Windows 上运行——至少现在是这样。但是，如果您需要利用创建本机 64 位产品的潜在速度和内存增益（例如，能够在单个进程中使用超过 3 GB 的 RAM），那么 VC6 就出局了。
3.  **VC9 具有更好的标准合规性**。VC6 的标准合规性非常差。这实际上既是移植的原因，也可能是不移植的原因。使用 VC6 的程序员习惯于以“错误的方式”做事，并且需要重构大部分代码才能在 VC9 中工作。

上面 #3 的一个简单示例是 for 循环：

```
for( int n = 0; n < someMax; ++n )
{
  // do stuff
}

printf("Did %d stuffs", n); 
```

此代码在 VC6 中有效，但在 VC9 中无效。它实际上是一个格式错误的程序——事实上 VC6 允许它是 VC6 中的一个缺陷。

从 VC6 移植到 VC9 的决定并不是一个灌篮高手。您必须考虑项目的难度，并与您获得的任何收益和避免的任何问题进行平衡。

在决定是否以及如何开展此项目时，您应该查看 Microsoft 的重大更改列表。第一个列表，从 VC6 到 VC7 的重大更改，是一个巨大的列表。相比之下，其他的要小得多。这表明如果你从 VC6 移植到任何东西，它应该至少是 2005。

*   [VC 2005 - 2008 的重大变化（VC 2005 -> VC 2008）](http://msdn.microsoft.com/en-us/library/bb531344.aspx)
*   [Visual C++ 2005 编译器中的重大更改 (VC 2003 -> VC 2005)](http://msdn.microsoft.com/en-us/library/ms177253.aspx)
*   [Visual C++ .NET 2003 (VC6 -> VC 2003) 中的重大变化](http://msdn.microsoft.com/en-us/library/ms177251(vs.80).aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T07:46:15.560

你说的代码库有多大？

移植一个小程序（主要是非模板化的 C++ 代码）应该是相当简单的。

然而，我曾经不得不将 100.000 行使用模板的代码从 VC6 转换为 VC2005，这是噩梦般的一周（工作 5 天），主要问题是我必须手动修复大约 30% 的问题（70 % 相当微不足道，可以通过搜索和替换来修复它们）。但更多的问题是旧代码没有测试用例和测试框架，所以即使我让应用程序编译并且没有段错误，看起来还不错（？），我不能保证它实际上工作的一切正如它应该是的那样。

所以实际上我的建议是考虑代码的大小和测试的可用性，还要考虑代码是否真的需要移植（在我的情况下是的，但并非总是如此，特别是如果软件很快就会淡出）

# c# - 创建 Web 服务 C# ASP.Net

> ID：298018
> 
> 赞同：2
> 
> 时间：2008-11-18T06:48:34.443
> 
> 标签：c#, asp.net, web-services

代码片段如下

```
namespace RecruiterWebService
{
    /// <summary>
    /// Summary description for Service1
    /// </summary>

    [WebService(Namespace = "http://tempuri.org/") ]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    [ToolboxItem(false)]
    public class **Service1** : System.Web.Services.WebService
    {

        [WebMethod]
        public XmlDocument Insert(XmlDocument Jobs)
        { }

        [WebMethod]
        public XmlDocument Update(XmlDocument Jobs)
        { }

        [WebMethod]
        public XmlDocument Delete(XmlDocument Jobs)
        { }

        [WebMethod]
        public XmlDocument Insert(string JobPath)
        { }

        [WebMethod]
        public XmlDocument Update(string JobPath)
        { }

        [WebMethod]
        public XmlDocument Delete(string JobPath)
        { }

        [WebMethod]
        public XmlDocument FeedBack(string UserName, string Password)
        { }

    }
} 
```

我的问题是：-

1.  如何将 WebService 的名称从 Service1 更改为 Jobs ..我尝试这样做，但是在添加 WebReference 时它给出了异常。

2.  在此 Web 服务中，我使用的是方法重载，但 aginb 在添加 WebReference 时使用我无法理解的消息属性抛出异常和建议。

3.  根据您的建议解决上述两个错误后..我遇到了返回类型的问题。我使用 XMLDocument 作为所有 WEBMethods 的返回类型，但是在将其作为 Web 引用添加到客户端之后，方法的返回类型更改为 XMLNode 我该如何解决这个问题

坐等大佬回复。。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T06:52:21.050

1：如果更改类名，还必须将 .asmx（或 WCF 的 .svc）页面更改为（文本）标记为`Service1`. 右键单击 asmx 和“查看标记” - 它应该类似于：

```
<%@ WebService Language="C#" CodeBehind="Service1.asmx.cs" Class="WebService1.Service1" %> 
```

更改`Class`and`CodeBehind`以匹配您当前的设置。

2：ws 1-1 不支持重载。您只需添加一个属性，为 SOAP 接口上的每个方法提供一个唯一名称。但是，请注意，这将成为您的代理将看到的方法名称。

例如，您可能会更改以下消息之一：

```
 [WebMethod(MessageName = "InsertXml")]
    public XmlDocument Insert(XmlDocument Jobs)
    { ... } 
```

现在更新客户端；你（如果你使用 wsdl.exe 等）可能会有一个`InsertXml(...)`方法。

# c++ - 如何调试使用 boost 而不会失去理智的代码？

> ID：298024
> 
> 赞同：12
> 
> 时间：2008-11-18T06:55:35.443
> 
> 标签：c++, visual-studio, boost, debugging

Boost 是一组很棒的库，它确实*提高*了生产力。但是调试使用它的代码完全是一场噩梦。当然，遍历两万个头文件可能是一项有价值的智力练习，但如果你需要一遍又一遍地做呢？

是否有一种开发人员友好的方式可以跳过提升部分并让调试器直接访问我的代码？

Visual Studio 有一个适用于 .NET 框架的[DebuggerStepThroughAttribute](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggerstepthroughattribute.aspx)。本机 C++ 有类似的东西吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-18T07:27:39.030

没有独立于平台/编译器的方式，但有人告诉我，您可以告诉调试器不要“进入”某些函数或类。您应该查找注册表项：`[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\8.0\NativeDE\StepOver]`并按照规则应应用的顺序创建一个名为数字的字符串值（我也对此有点困惑，但我猜这些规则只是按顺序排列的（可能是相反的）它们应该应用的方式）并将其设置为：“boost::.*=NoStepInto”。例如：

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\8.0\NativeDE\StepOver]
"10"="boost\:\:.*=NoStepInto" 
```

[你可以在这里](http://blogs.msdn.com/andypennell/archive/2004/02/06/69004.aspx)阅读更多内容。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-18T07:15:48.850

您可以使用[此处](http://through-the-interface.typepad.com/through_the_interface/2006/07/advanced_visual_1.html)描述的技术完全跳过 boost 命名空间。只需使用类似的东西：

`boost\:\:.*=NoStepInto`

...在相关的注册表项中。

但是，如果您的代码在 boost 中被调用（例如，通过 a`boost::function`或类似方法），那么您的代码也将被跳过！如果有人能想出一个很好的解决方案来解决*这个*问题，我会很感兴趣......

# ntfs - Windows XP 是否使用 NTFS 文件系统函数调用来读取/写入页面文件 (pagefile.sys)？

> ID：298031
> 
> 赞同：3
> 
> 时间：2008-11-18T07:08:25.637
> 
> 标签：ntfs, pagefile

如果是这样，那么您如何证明所产生的间接费用（日记等）是合理的？如果没有，那么页面文件怎么会碎片化？此外，增加集群大小会提高页面文件性能（集群松弛空间不是问题）吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T07:52:29.477

您可以查看 filemon 或 procmon (sysinternals.com) 以查看操作系统写入页面文件 - 因此它必须使用适当的文件系统语义。

如果您因为内存压力而进行交换，那么您已经输掉了性能战，并且开销不会显着增加损失（但它们将意味着您的文件系统保持未损坏）。如果交换不是性能关键，谁会关心日志记录的边际性能损失？

集群大小不太可能成为问题，因为它只是从磁盘上的索引->存储映射。页面文件很少改变大小，因此索引几乎不会改变。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-12T22:52:19.293

系统必须使用文件系统调用来访问页面文件。日记等的开销基本上为零。日志仅在文件系统结构更改时生效，而不是针对单个读取或写入。默认情况下，XP 使用半固定页面文件，其初始大小设置为物理内存大小的 1.5 倍。在正常情况下，页面文件永远不会小于这个值。如果此大小足够，并且 RAM 大小合理，几乎总是如此，页面文件将永远不会调整大小。只有在这种不太可能发生的情况下，才会为页面文件分配新的集群，并且可能会出现碎片。重新启动后，或更快，页面文件的所有扩展都将被释放，并将恢复为初始大小。在正常情况下不会发生碎片。

页面文件或多或少地用于保存很少使用的数据。这些写入发生在 CPU 和磁盘访问较低的时期，因此不会影响性能。由于所涉及的数据很少使用，因此页面文件访问很少会严重影响性能。页面文件不仅仅是内存不足时使用的溢出区域。在大多数情况下，页面文件通过将 RAM 从长时间处理静态数据的需要中解放出来来提高性能。

# database - 在 Grails 应用程序中在运行时更改数据库

> ID：298032
> 
> 赞同：3
> 
> 时间：2008-11-18T07:10:56.707
> 
> 标签：database, grails

我想知道是否有办法在运行时在 grails 中更改数据库 - 例如，在大多数商业/开源 CMS 中，它们允许将数据库服务器托管在其他地方，并且您可以在运行时在某些配置屏幕中指定地址。

由于 grails 使用 DataSource.groovy 配置数据库服务器，如何访问它的内部并更改数据库 url？还是数据库类型？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T13:27:15.777

请参阅 Grails 文档中的 [数据库和环境]( [http://grails.org/doc/1.0.x/guide/3.%20Configuration.html#3.3.1](http://grails.org/doc/1.0.x/guide/3.%20Configuration.html#3.3.1)数据源和环境)。

如果以上内容不能完全满足您的需求，另请参阅[外部化配置]( [http://grails.org/doc/1.0.x/guide/3.%20Configuration.html#3.4外部化配置)。](http://grails.org/doc/1.0.x/guide/3.%20Configuration.html#3.4)

只要可以通过 JDBC 访问数据库，Grails 并不关心数据库驻留在哪里，因此将数据库服务器放在别处不是问题，只是一个配置。

# python - 如何使simpleparse中的关键字可识别？

> ID：298034
> 
> 赞同：1
> 
> 时间：2008-11-18T07:12:39.247
> 
> 标签：python, parsing

我一直在尝试使用 simpleparse 创建解析器。我已经定义了这样的语法：

```
<w> := [ \n]*
statement_list := statement,(w,statement)?
statement := "MOVE",w,word,w,"TO",w,(word,w)+
word := [A-Za-z],[A-Za-z0-9]*,([-]+,[A-Za-z0-9]+)* 
```

现在如果我尝试解析一个字符串

```
MOVE ABC-DEF TO ABC
MOVE DDD TO XXX 
```

第二个语句被解释为第一个语句的参数......这很糟糕，显然不是我想要的。我已经能够使用这样的pyparsing来完成这项工作：

```
word = Word(alphas,alphanums+'-')
statement = "MOVE"+word+"TO"+word
statement_list = OneOrMore(statement.setResultsName('statement',True)) 
```

有什么方法可以让它在 simpleparse 中工作吗？

*编辑：下面的澄清*

我不是想实现基于行的语法。我希望看到被解析的是：

简单案例

```
MOVE AA TO BB 
```

更复杂的情况

```
MOVE AA TO BB 
           CC DD 
           EE FF 
```

以上几种说法

```
MOVE AA TO BB 
           CC
MOVE CC TO EE
MOVE EE TO FF 
           GG 
           HH IIJJK 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T11:30:03.097

语法目前是模棱两可的。在纸上，如果“MOVE A TO B MOVE C TO D”是两个语句，或者一个具有特定错误命名目的地的语句，您无法解析。

你有两个答案。你可能都不喜欢。

1.  您明确地使您的 WORD 不匹配任何保留字。也就是说，您明确禁止匹配 MOVE 或 TO。这相当于说“MOVE 不是有效的参数名称”。这使得“MOVE TL TO TM TN TO”成为错误。

2.  你修改你的语法，这样你就可以知道语句在哪里结束。您可以添加逗号“MOVE AA TO BB, CC MOVE TM TO TN, TO, TP”。您可以在语句末尾添加分号或空行。您可以要求 MOVE 缩进最少，如 Python。

# asp.net - 自定义控件

> ID：298039
> 
> 赞同：0
> 
> 时间：2008-11-18T07:16:38.753
> 
> 标签：asp.net, custom-controls

我有一个自定义控件，需要在另一个自定义控件中使用。我已经在服务器端编写了所有代码（没有 HTML）。谁能告诉我如何使用 htmlTextWriter 在后面的代码中编写下面的代码行以及如何注册此控件或如何在另一个从后面的代码编写 html 的地方编写自定义控件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T07:36:54.003

首先，构建一个简单的自定义 Web 控件：

```
namespace My.Controls
{
    public class InnerControl : Control
    {
        protected override void Render(HtmlTextWriter writer)
        {
            writer.WriteLine("<h1>Inner Control</h1>");
        }
    }
} 
```

然后构建包含并呈现第一个的第二个 Web 控件：

```
namespace My.Controls
{
    public class OuterControl : Control
    {
        protected override void Render(HtmlTextWriter writer)
        {
            writer.WriteLine("<h1>Outer Control</h1>");
            InnerControl innerControl = new InnerControl();
            innerControl.RenderControl(writer);
        }
    }
} 
```

最后，在您的页面上注册该控件，并显示它：

```
<%@ Register TagPrefix="c" Namespace="My.Controls" %>
<c:OuterControl runat="server" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T09:55:10.447

谢谢它有效..我只漏掉了一行——

innerControl.RenderControl(writer);

# sql-server-2005 - 哪个命令将首先执行，如果一个存储过程有单独的多个选择命令；

> ID：298040
> 
> 赞同：0
> 
> 时间：2008-11-18T07:16:41.343
> 
> 标签：sql-server-2005

哪个命令将首先执行，如果一个存储过程有单独的多个选择命令；

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T07:19:20.683

存储过程中的命令按照写入的顺序执行。

# emacs - 如何处理冲突的键绑定

> ID：298048
> 
> 赞同：11
> 
> 时间：2008-11-18T07:21:44.313
> 
> 标签：emacs, keyboard-shortcuts, elisp

[paredit](http://mumble.net/~campbell/emacs/paredit.el)绑定`M-<up>`and `M-<down>`，但我希望[windmove](http://www.emacswiki.org/emacs/WindMove)拥有这些键绑定。我将 paredit-mode 设置为仅在某些模式下激活，但 windmove 设置为全局运行。我希望 windmove 获胜，但 paredit 在加载时会窃取这些键绑定。

如何轻松阻止 paredit 踩踏 windmove 的键绑定？我一直在进入`paredit.el`并注释掉设置键绑定的行，但这远非理想（每次更新 paredit 时我都必须记住这样做）。

更一般地说，我可以在“保护”某些键绑定不被更改的同时加载一个 elisp 文件吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-18T13:14:44.007

您可以`eval-after-load`在加载 paredit 后使用它来配置它的行为，如其注释中所述：

```
;;; Customize paredit using `eval-after-load':
;;;
;;;   (eval-after-load 'paredit
;;;     '(progn ...redefine keys, &c....)) 
```

因此，例如：

```
(eval-after-load 'paredit
  '(progn
     (define-key paredit-mode-map (kbd "<M-up>") nil)
     (define-key paredit-mode-map (kbd "<M-down>") nil))) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-13T18:18:24.610

这个问题之前已经回答过：[Globally override key binding in Emacs](https://stackoverflow.com/questions/683425/globally-override-key-binding-in-emacs)

您可以使用首选键绑定创建自己的次要模式并全局启用它，以便它覆盖所有其他键绑定。

# javascript - 我可以从 JavaScript 访问 img 标签的数据文件吗

> ID：298049
> 
> 赞同：6
> 
> 时间：2008-11-18T07:22:33.267
> 
> 标签：javascript, html, image

我想从 JavaScript 访问作为变量加载为 img 标记中的图像的文件。

## 我不想访问它的名称，而是访问实际数据。

这样做的原因是我希望能够将它复制到变量中或从变量中复制出来，这样我就可以在不重新加载图像的情况下更改图像。

这可以做到吗？如果是这样，怎么做？

注意：我对*读取*数据比写入数据更感兴趣。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T09:02:12.957

```
// Download the image data using AJAX, I'm using jQuery
var imageData = $.ajax({ url: "MyImage.gif", async: false }).responseText;

// Image data updating magic
imageDataChanged = ChangeImage(imageData);

// Encode to base64, maybe try the webtoolkit.base64.js library
imageDataEncoded = Base64Encode(imageDataChanged);

// Write image data out to browser (FF seems to support this)
document.write('<img src="data:image/gif;base64,' + imageDataEncoded + '">'); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T21:00:02.213

如果您使用的是 Firefox（我认为是 Opera 和 Safari；我现在无法检查），您可以在画布元素上绘制图像并使用 getImageData。

它会像这样工作：

```
var img = document.getElementById("img_id");
var canvas = document.getElementById("canvas_id");
var context = canvas.getContext("2d");

var imageData = context.getImageData(0, 0, context.width, context.height);

// Now imageData is an object with width, height, and data properties.
// imageData.data is an array of pixel values (4 values per pixel in RGBA order)

// Change the top left pixel to red
imageData.data[0] = 255; // red
imageData.data[1] = 0;   // green
imageData.data[2] = 0;   // blue
imageData.data[3] = 255; // alpha

// Update the canvas
context.putPixelData(imageData, 0, 0); 
```

获得图像数据后，您可以计算每个像素的起始索引：

```
var index = (y * imageData.width + x) * 4; 
```

并为每个通道添加偏移量（红色为 0，绿色为 1，蓝色为 2，alpha 为 3）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T07:57:50.013

一些浏览器支持[Base64 编码的字符串作为 img src](http://www.greywyvern.com/code/php/binary2base64)，但不是全部。这看起来像：

```
<img src="data:image/gif;base64,R0lGODl......j5+g4JADs="> 
```

当你这样做时，你至少可以*伪造*访问实际数据，但正如我所说，它不是 100% 支持的。除此之外——没办法。

真正的问题是：你想达到什么目的？大多数情况下（95%，可能更多）重复的图像重新加载会被浏览器缓存捕获，在这种情况下，只需修改 img.src 具有相同的效果并且不会导致网络流量（如果您担心的话）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T08:23:39.853

您可以使用 canvas.drawImage 将 img 标签的图像绘制到 HTML 画布上

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T08:47:02.753

您可以尝试使用 AJAX 下载图像，但您可能会遇到跨域脚本限制。

我不知道其他访问图像数据的方法。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-18T07:24:21.967

试试这个：

```
img = new Image(); 
img.src = "imagefile.jpg"; 
```

# javascript - MySQL 有 JavaScript 绑定吗？

> ID：298057
> 
> 赞同：6
> 
> 时间：2008-11-18T07:32:24.917
> 
> 标签：javascript, mysql, firefox

我想直接从 Firefox 的 HTML 页面中的 JavaScript 代码访问 MySQL 数据库。

有这样的图书馆吗？

很清楚，**CGI+Ajax 是行不通的**

一些背景：我想为 MySQL 数据库创建类似于 GUI 前端的东西（这不是它的本质，但它已经足够接近了）。我正在考虑将其作为使用 JavaScript 的本地 HTML 页面来执行，但要使其正常工作，我需要 Firefox 下的 JavaScript 的 MySQL 绑定。我已经有一个不到 100 LOC 的工作原型，但它需要一个 Web 服务器，并且由于这个问题之外的原因，它不起作用。

注意：数据库和 JavaScript 代码都将在本地运行，而不是作为公共页面。事实上，HTML 文件将作为 file://// 文件加载。我使用 JavaScript 的唯一原因是它是唯一可用的系统，可以在我需要的地方执行 GUI 工作。

我愿意安装插件、DLL、依赖于 Windows 的东西或不使其工作的东西。

* * *

编辑：看起来答案是，“可以做到，但会很痛苦”。由于我的选择之一是将所有数据作为文件吐出（丑陋，而且不太灵活，但它会起作用），我想我不会追求这个。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T07:52:36.310

JavaScript 代码存在于浏览器中。它可以向外部发出 HTTP 请求，但实际上不多。因此，按照设计，您将无法绑定到本地运行的程序。如果 MySQL 确实公开了 HTTP 服务，那可能是可能的，但事实并非如此。

您也许可以找到一个将 MySQL API 暴露给 JavaScript 的 Firefox 插件，但我不知道任何这样的插件。

如果您不是特别需要 MySQL，而只是需要一个可从 JavaScript 代码访问的数据库，请查看[Google Gears](http://gears.google.com/)。它是一个 Firefox / Internet Explorer 插件，它公开了一个[SQLite](http://www.sqlite.org/)数据库和其他一些好东西。

如果您提供有关您正在尝试构建的内容的更多信息，我们也许可以为您提供更好的建议......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T08:37:44.207

不幸的是，您需要一台服务器。或者，如果您知道如何并准备好锁定平台/浏览器，您可以为您选择的浏览器编写一个插件（据我所知，Internet Explorer 没有 DLL，因此您需要自己编写一个）。

您可能想研究一个不需要设置的小型服务器。我修改了 Lua 的[Xavante](http://keplerproject.github.com/xavante/)服务器，原因与你的非常相似，所以它运行时没有外部依赖项，因此我可以通过一次复制/粘贴来安装/卸载应用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T22:02:44.487

Javascript 可以访问 MySQL...但通常只能在服务器上。我用 Rhino 完成了它，一个基于 java 的 javascript 解释器。只包括 MySQL 驱动程序，并且它可用。我想你也可以用一个小程序来做到这一点。

使用 Rhino，它会是这样的：

```
var DATABASE = {

    database: 'blog_development',
    host: 'localhost',
    username: 'dbuser',
    password: 'dbpass'

};

function ArticleModel(properties) {
  for (var p in properties) {
    this[p] = properties[p];
  }
}

ArticleModel.findAll = function() {
    var results = [];

    var jsConnectionObj = new Packages.MysqlConnection();
    c = jsConnectionObj.open(DATABASE.host,
                             DATABASE.database,
                             DATABASE.username,
                             DATABASE.password);

    if (c) {
      var s = c.createStatement();
      s.executeQuery("SELECT * FROM articles;");
      var rs = s.getResultSet();
      while (rs.next()) {
          results.push(new ArticleModel({
            id: rs.getInt("id"),
            title: rs.getString("title"),
            body: rs.getString("body")
          }));
      }
      rs.close();
      c.close();  
      return results;
    }

    throw new Error('could not connect to database');      
}; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T08:21:33.477

您需要的是一个 HTTP 服务，该服务公开您想要使用 JavaScript 获取的数据。

一个小型的面向 AJAX 的服务器端脚本（PHP、Perl、Ruby 等），它接受一些参数并执行 MySQL 查询，以 HTTP 和 JavaScript 友好的方式将数据发送到客户端（例如 image/jpeg 或JSON）。

您将无法设置使 MySQL 可用于 JavaScript 的任何有用的东西（一个有效的跨浏览器解决方案）。JavaScript 可以做 HTTP，仅此而已。适应服务器端。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T09:54:39.963

我不能给你完整的答案，但这里是你如何只用 MySQL + Internet Explorer + JavaScript（未经测试）来做到这一点的一般想法：

在 JavaScript 中，您可以通过使用调用 Windows 应用程序

```
var myshell = new ActiveXObject( "WScript.shell" );
myshell.run( program names ); 
```

所以想法是`mysql.exe`使用存储在 SQL 文件中的 SQL 语句进行调用，然后捕获并解析输出：

```
mysql.exe -h localhost -u root dbo < script.sql > output.txt 
```

这个想法并非没有挑战：

*   调用前需要修改SQL文件`mysql.exe`
*   您需要打开并解析输出文件

正如我上面提到的，我没有测试任何东西，所以整个想法甚至可能行不通......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T10:17:02.057

有趣的问题。但是您肯定会消除很多障碍，选择具有很多自愿限制的语言/环境来限制对底层系统的访问......

我喜欢罗伯特的建议，Xavante 真的很轻量级。

否则，我认为可行的解决方案是使用具有 JDBC 访问权限的 Java 小程序。我认为您需要签署小程序，这应该不是问题。

我在 Google 中搜索了*java applet jdbc*并看到了很多有前途的标题，IBM 提供了此类 applet 的源代码（用于 DB2 访问，但它应该很容易适应）。

[编辑] 还有另一种方法，用 XPCOM DLL 包装 mysqllib.dll，如[Native code in javascript 中](http://forums.mozillazine.org/viewtopic.php?f=19&t=930205&start=0 "javascript 中的本机代码 • mozillaZine 论坛")所述。不知道如何真正做到这一点，但也许它可以让你开始。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-28T04:26:36.100

当然，如果javascript可以调用服务器，它可以调用本地IP地址（192.168.xx）并且可以使用侦听特定端口的程序来处理它？那么程序所要做的就是与数据库交互，找到信息并将其传递回javascript？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-28T08:08:05.360

如果你使用 node.js，我想你可能想看看这个。 [http://nodejsdb.org/](http://nodejsdb.org/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-11-13T21:55:33.933

我知道这是一个旧线程，但我认为它仍然是相关的。

我在浏览器中使用了backbone.js 作为客户端库。这简化了（几乎是微不足道的）浏览器内的数据访问。

它依赖于服务器上的 RESTful 服务，这些服务很容易提供。例如，您可以使用 node.js、phpwebsockets 或 socket.io

高温高压

# winforms - 在 Visual Studio 中签名应用程序

> ID：298059
> 
> 赞同：2
> 
> 时间：2008-11-18T07:33:32.043
> 
> 标签：winforms

我有一个必须签名的 Windows 应用程序项目。我从客户那里收到了 .spc 和 .pfx 文件。我将这些文件转换为 .pfx 并通过右键单击程序集 - 属性 - 签名我指定了 .pfx 文件。一切正常，没有错误。问题是编译程序集后没有签名 - 单击“属性”时的“数字签名”选项卡不存在。我使用 VS 2008。我错过了什么吗？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T18:27:00.863

使用 StrongName 为您的程序集签名与为您的程序集提供数字签名不同。您在 Visual Studio 中执行的签名是前者而不是后者。

如果您搜索 Google（或您选择的搜索引擎），您可以找到许多讨论两者之间差异的地方。例如：

[http://blogs.msdn.com/b/ericlippert/archive/2009/09/03/what-s-the-difference-part-five-certificate-signing-vs-strong-naming.aspx](http://blogs.msdn.com/b/ericlippert/archive/2009/09/03/what-s-the-difference-part-five-certificate-signing-vs-strong-naming.aspx)

[http://msdn.microsoft.com/en-us/magazine/cc163583.aspx](http://msdn.microsoft.com/en-us/magazine/cc163583.aspx)

# c++ - 如果我使用 startDetached 启动 QProcess，我会得到一个完成的插槽吗

> ID：298060
> 
> 赞同：6
> 
> 时间：2008-11-18T07:36:36.997
> 
> 标签：c++, qt, qprocess

如果我使用 startDetached() 启动 QProcess，我会得到一个完成的信号吗？我正在尝试启动一个进程，但我需要能够在进程终止时获得一个事件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-19T02:36:00.693

不，当您使用 startDetached 时您无法获得信号，因为您没有对象。

startDetached 是一个静态函数，当您调用它时，进程会直接启动，而无需创建 QProcess 对象。因此，即使有信号，您也无法将其连接到任何东西，因为您没有可连接的对象。

如果你想要一个信号，你应该创建一个 QProcess 对象，然后在它上面调用 start。然后，当过程完成时，您将能够获得完成的信号。

# sql - MS访问数学

> ID：298063
> 
> 赞同：0
> 
> 时间：2008-11-18T07:37:31.457
> 
> 标签：sql, ms-access, calculated-columns

我在 MS Access 2007 中有一个包含 4 个字段的表。

*   人工成本
*   劳动时间
*   增值税
*   全部的

如何将“工时”乘以“劳动力成本”加上“增值税”并在“总计”中显示答案

我会将任何公式放在哪里？，在表格或查询或表格中？

非常感谢您的帮助

斯科特

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T09:39:50.977

也有假人（即不是 SQL）的方法来做到这一点：首先从你的表中删除你的总列，并在这个练习中假装你的表的名称是 "Labour" 。

现在创建一个新查询并在设计视图中查看它，从您的劳动力表中添加所有字段（以便您可以检查一切是否正常），选择一个空字段，右键单击并从下拉列表中选择“构建”。您现在应该有一个 Expression Builder 窗口。

输入计算字段的名称，例如 labourTotal，后跟冒号“:”，然后从 Expression Builder 窗口左下方的表中选择要添加的字段名称，然后双击每个字段名称。每个字段都将出现在“总计：”之后的表达式构建器中。现在用“+”替换每个“«Expr»”。您应该在表达式构建器中看到这一点：“labourTotal: [Labour]![Labour Cost] + [Labour]![Labour Hours] + [Labour]![Vat]”。单击确定并运行查询 - 如果一切正常，总列将显示结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T07:42:29.013

您完全不需要“总计”列。

您的查询或报告可能类似于以下内容：

```
SELECT [Total] = [Labour Cost] * [Labour Hours] + [VAT] 
```

您可以在表单或报表的控件中使用相同类型的公式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T07:53:02.160

如果确实需要更新 Total 列中的数据：

```
UPDATE YourTableName SET [Total] = [Labour Hours] * [Labour Cost] + [VAT] 
```

**但是**，更好的方法是从表中完全删除 Total 列并创建一个查询：

```
SELECT [Labour Cost], 
       [Labour Hours], 
       [VAT], 
       [Labour Hours] * [Labour Cost] + [VAT] AS [Total]
FROM YourTableName 
```

首选此方法的原因是因为它可以防止您不小心将错误信息放入“总计”列。一般来说，如果你不小心，数据很容易被破坏，而且修复起来会很痛苦（如果不是不可能的话）。我建议你谷歌“数据库规范化”并阅读一下它 - 这将对你有很大帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-19T02:27:01.943

1.  关于您的增值税百分比，我希望我不是在说显而易见的，但您应该输入小数，例如 0.175 是 17.5%

2.  您不能只添加一个百分比，它必须乘以某个值。并且您必须包括原始金额的 100%。所以如果要加17.5%，就需要乘以1.175。因此，假设：i) 您希望自动包含 100%（即您只需要输入 .175）并且 ii) 增值税应添加到整个金额中，并且 iii) 通过“指定”您的意思是您每次运行查询时都希望被提示输入增值税；那么你的公式应该是：

总计：（[一般费用]！[人工成本]*[一般费用]！[工时]+[材料成本]）*（1+[输入增值税为十进制金额？]）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T13:32:05.173

创建一个新查询。

添加你的表

将您的三个非总计字段添加到查询中

在新的字段类型中：

```
total: [VAT] + [Labour Hours] * [Labour Cost] 
```

运行查询

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T04:50:10.357

斯科特说：

> 基本上只是想进行计算，以便我可以在屏幕和报告中显示总数。

正如一些人建议的那样，您可以在保存的查询中进行计算，并将其用作报告和表单的记录源。

但我建议你不要那样做。我建议您在最晚的时间进行计算。对于报告，这意味着您可以控制您的报告，该报告将您想要执行的计算作为其控制源。这样，它只对在页面格式化时打印的行执行。

*除非*您想对总字段进行排序或过滤，否则我建议对表单进行相同的操作。表单上的计算字段不能用于排序/过滤，并且在某些情况下它们显示的速度可能很烦人。在这种情况下，您会忽略我的建议以避免将它们放入查询/记录源中，因为您有充分的理由在实际显示数据之前为所有行计算它。

但一般来说，不要将计算放在您不会作为一个组（过滤、排序、分组）进行操作的记录源中。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-18T08:55:10.223

您可以将其作为计算字段放入查询或表单中。只要有意义，就很简单，并且具有适当的可重用性。如果计算特定于数据的表单或视图，请在此处或查询中进行。

在这种情况下，您可以预见总计将是一个经常使用的值并在逻辑上应用于该行，因此将其设为计算字段是合适的。计算字段的优点是（在大多数系统中，不确定 MSAccess）它们可以设置为仅在数据更改时重新计算。

如果您正在计算数量与交货提前期的比率，那将是我在查询特定表格/报告中的更多内容，因为它永远不会被重复使用，并且可能是一个更繁重的计算。

我通常会选择在查询中进行计算，除非它依赖于另一个计算的结果，然后在查询中进行可能会有点混乱，所以在表单/代码中进行。

总而言之，只要适合该计算。

# ruby - Ruby 的子类化和 Qt 的信号/槽不能按预期一起工作

> ID：298064
> 
> 赞同：2
> 
> 时间：2008-11-18T07:37:58.710
> 
> 标签：ruby, qt, qtruby

当尝试在多个继承级别上使用 Qt 的信号/槽机制时，我遇到了一个问题：当我的类不直接从 QObject 继承时，信号和槽似乎不再工作了。

以下程序的输出说明了这种情况：

```
require 'Qt'

class A < Qt::Object
  signals 'mySignal()'
  slots 'mySlot()'

  def initialize
    super()
    puts "This is the c'tor of A and I am a #{self.class}"
    connect(self, SIGNAL('mySignal()'), self, SLOT('mySlot()'))
    emit mySignal()
  end

  def mySlot
    puts "Signal received and I am a #{self.class}"
  end
end

class B < A
  def initialize
    super()
  end
end

app = Qt::Application.new(ARGV)
A.new
B.new
app.exec 
```

该程序产生

```
这是A的c'tor，我是A
收到信号，我是 A
这是A的c'tor，我是B

```

但是，我希望

```
这是A的c'tor，我是A
收到信号，我是 A
这是A的c'tor，我是B
收到信号，我是 B

```

Qt 的[文档](http://doc.trolltech.com/4.3/moc.html)指出，它“[...] 假定第一个继承的类是QObject 的**子类**。”。由于 B < A < QObject，我希望这是真的。相应的 C++ 程序按预期运行（尽管您无法在 c++ 中识别对象的 c'tor 中的类型，但这不是这里的重点）。

问题是：为什么程序没有给出预期的输出？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T12:35:13.647

为了能够利用信号和槽——或者更重要的是 Qt 中的元对象系统，该类必须从 QObject 继承——并且它必须在多重继承中首先继承 QObject。另请参阅[http://doc.trolltech.com/4.4/moc.html](http://doc.trolltech.com/4.4/moc.html)以获得有关元对象系统的良好阅读

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-23T12:34:40.767

正如 Terence Simpson 所指出的，这是一个仍然存在于 Qt Ruby 1.4.9 中的错误。在此期间它得到了修复。

# c# - C# 中的代理异常

> ID：298067
> 
> 赞同：1
> 
> 时间：2008-11-18T07:40:08.630
> 
> 标签：c#, web-services, proxy

我们的项目有问题。我们使用 C# 和 Web 服务的客户端制作 Web 服务。在我们的办公室，客户工作正常，但在生产中，我们遇到了代理问题。代理在 Windows Internet 属性中配置。客户端必须连接到 http:\aaa.com 并且 http:\aaa.com 是代理异常。但是客户端没有连接。在代理日志中我们可以看到客户端通过代理并忽略代理异常。为什么客户端不接受 Internet 属性的例外？

编辑：很抱歉代理配置是 *.aaa.com 使用 Intenet Explorer 我可以访问 Web 服务

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T07:48:28.237

我不记得 .NET 使用了哪些设置（我怀疑是 WinHTTP），但可以尝试的一件简单的事情是（在命令行中）：

```
proxycfg -u 
```

这会将 Internet Explorer 代理设置导入 WinHTTP。

除此之外，您还可以通过`configuration/system.net/defaultProxy`节点的配置（app.config/web.config/machine.config/etc）调整代理设置。就个人而言，我会尽量避免这个（配置）选项——它只会增加你需要记住维护的东西的数量！

# .net - 自动下载 BusinessObjecs Web Intelligence 报告

> ID：298069
> 
> 赞同：0
> 
> 时间：2008-11-18T07:40:17.850
> 
> 标签：.net, business-objects

我的任务是自动检索几个[BusinessObjects Web Intelligence](http://www.businessobjects.com/product/catalog/web_intelligence/)报告并对其进行进一步处理。

我没有其他方法可以访问这些数据（这是我遵循的第一个途径），所以我*将*不得不做一些屏幕抓取。唉，界面似乎是*用户专用的*。呸！

有没有人这样做过？喜欢分享？

另外，有谁知道自动化网络浏览器的好库？我知道那里有一个可用于测试 Web 应用程序的 python 东西——不过我需要 .NET 中的东西......你最喜欢什么？

PS：我也检查了这个[线程（自动从网页获取报告）](https://stackoverflow.com/questions/189288/automate-getting-report-from-webpage)，但我希望有一个 Web Intelligence 特定的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T18:31:26.763

BO 作业计划程序可以设置为在给定时间自动运行报告并将它们导出为 Excel、CSV 等。报告可以转储到 Web 服务器上，这将比尝试进行更容易的屏幕抓取或下载BO 网络报告直接，因为网络报告是分页的。

我没有亲自做过这件事，但我曾与为我做过这件事的顾问一起工作。您最好的选择可能是请一位经验丰富的 BO 顾问为您进行设置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-14T10:06:13.543

如果您尝试复制 Web 浏览功能，那么 cURL 确实不会出错，从 .NET 程序调用 cURL 脚本不会有任何问题。

我不熟悉网络智能，但我们使用 cURL 每 2 秒运行 30 个实时报告，从自定义网络服务读取数据。Web 智能可以响应 HTTP POST 吗？例如，我们发布这样的参数：

```
c:\curl\bin\curl -X POST -F File=@[filename] -F "title=[title]" -F "notes=[notes]" "http://xxx/AddScannedImage?debtref=[filename]" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T00:11:01.917

您是否考虑过将 BusinessObjects Enterprise 支持的公共 API 用于此类目的？[SAP Developer Network 站点](https://www.sdn.sap.com/irj/boc/sdklibrary)上提供了所有文档。

具体来说，如果我使用 Java，我会结合使用 BusinessObjects Platform SDK 和 REBean API 来完成这项工作。或者，有一些 WS API 可以让您做很多相同的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T00:34:47.003

你看过 QaaWS 吗？（查询作为 Web 服务）——它应该允许您访问 WebI 报告正在使用的同一个 Universe 查询——但是如果您依赖 WebI 报告作为预处理器，这可能对您没有多大好处。只是一个想法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-27T17:25:22.503

您是否看过 Report Launch，它是一个基于 Web 的框架，它封装了 BOE，并为所有类型的调用提供了简单的 URL 调用，就像您描述的那样。

# design-patterns - 是否可以将方法添加到 Scala 中的内置类型？

> ID：298074
> 
> 赞同：11
> 
> 时间：2008-11-18T07:43:15.847
> 
> 标签：design-patterns, scala, infix-notation

我想为内置类型（例如 Double）添加一个方法，以便我可以使用`infix`运算符。那可能吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-18T07:50:53.413

是和不是。是的，你可以让它*看起来*好像你已经添加了一个方法到`double`. 例如：

```
class MyRichDouble(d: Double) {
  def <>(other: Double) = d != other
}

implicit def doubleToSyntax(d: Double) = new MyRichDouble(d) 
```

此代码将以前不可用的`<>`运算符添加到任何类型的对象`Double`。只要该`doubleToSyntax`方法在范围内，以便可以在没有限定的情况下调用它，以下将起作用：

```
3.1415 <> 2.68     // => true 
```

答案的“否”部分来自于你并没有真正在`Double`课堂上添加任何东西。相反，您正在创建从`Double`到新类型的转换，该类型确实定义了您想要的方法。这可能是一种比许多动态语言提供的开放类更强大的技术。它也恰好是完全类型安全的。:-)

您应该注意的一些限制：

*   此技术不允许您*删除*或*重新定义*现有方法，只需添加新方法
*   隐式转换方法（在这种情况下，`doubleToSyntax`）绝对必须在所需扩展方法可用的范围内

习惯上，隐式转换要么放在单例对象中并导入（例如`import Predef._`），要么放在特征中并继承（例如`class MyStuff extends PredefTrait`）。

顺便说一句：Scala 中的“中缀运算符”实际上是方法。`<>`允许它是中缀的方法没有任何魔法，解析器只是以这种方式接受它。如果您愿意，也可以使用“常规方法”作为中缀运算符。例如，`Stream`该类定义了一个`take`方法，该方法接受一个`Int`参数并返回一个新的`Stream`. 这可以通过以下方式使用：

```
val str: Stream[Int] = ...
val subStream = str take 5 
```

该`str take 5`表达式在字面上与 相同`str.take(5)`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T08:28:35.193

这个特性可以方便地实现一个执行错误估计的类：

```
object errorEstimation {
  class Estimate(val x: Double, val e: Double) {
    def + (that: Estimate) =
      new Estimate(this.x + that.x, this.e + that.e)
    def - (that: Estimate) =
      new Estimate(this.x - that.x, this.e + that.e)
    def * (that: Estimate) =
      new Estimate(this.x * that.x,
                   this.x.abs*that.e+that.x.abs*this.e+this.e*that.e)
    def / (that: Estimate) =
      new Estimate(this.x/that.x,
                   (this.x.abs*that.e+that.x.abs*this.e)/(that.x.abs*(that.x.abs-that.e)))
    def +- (e2: Double) =
      new Estimate(x,e+e2)
    override def toString =
      x + " +- " + e
  }
  implicit def double2estimate(x: Double): Estimate = new Estimate(x,0)
  implicit def int2estimate(x: Int): Estimate = new Estimate(x,0)

  def main(args: Array[String]) = {
    println(((x: Estimate) => x+2*x+3*x*x)(1 +- 0.1))
    // 6.0 +- 0.93
    println(((x: Estimate) => (((y: Estimate) => y*y + 2)(x+x)))(1 +- 0.1))
    // 6.0 +- 0.84
    def poly(x: Estimate) = x+2*x+3/(x*x)
    println(poly(3.0 +- 0.1))
    // 9.33333 +- 0.3242352
    println(poly(30271.3 +- 0.0001))
    // 90813.9 +- 0.0003
    println(((x: Estimate) => poly(x*x))(3 +- 1.0))
    // 27.037 +- 20.931
  }
} 
```

# jsf - 如何在 JSF 数据表中显示行索引

> ID：298116
> 
> 赞同：25
> 
> 时间：2008-11-18T08:07:38.013
> 
> 标签：jsf, datatable

在 JSF 数据表中，我想在行旁边显示行索引......比如：

```
Column A    Column B
1           xxx
2           yyy 
```

我认为我可以使用像 #{rowIndex} 这样的隐式 el 变量，但这不起作用。

我找到的一个解决方案是为数据表创建一个绑定并使用如下绑定：

```
<h:dataTable var="item" value="#{controller.items}" binding="#{controller.dataTable}">
    <h:column>#{controller.dataTable.rowIndex}</h:column>
    <h:column>value</h:column>
</h:dataTable> 
```

但是当我在一个页面中有许多嵌套的数据表时，这个解决方案很复杂并且不能很好地工作。

关于如何以更好的方式解决这个问题的任何想法？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2011-07-21T12:55:41.590

此解决方案由 Jamie Williams 在[CodeRanch](http://www.coderanch.com/t/211885/JSF/java/access-current-row-index-dataTable)上发布。他说它适用于战斧。我正在使用 primefaces，它也支持它。

```
<t:dataTable rowIndexVar="row" value="#{someBean.value}">  
    <h:column>  
        <h:outputText value="#{row + 1}"/>  
    </h:column>  
</t:dataTable> 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-18T12:35:29.890

现有的解决方案对我来说并不坏。只要您引用嵌套表的模型，rowIndex 就应该在嵌套表中工作。

```
 <h:dataTable border="1" value="#{nestedDataModel}" var="nested">
        <h:column>
            <h:dataTable border="1" value="#{nested}" var="item">
                <h:column>
                    <h:outputText value="#{nested.rowIndex}" />
                </h:column>
                <h:column>
                    <h:outputText value="#{item}" />
                </h:column>
            </h:dataTable>
        </h:column>
    </h:dataTable> 
```

样品型号：

```
public class NestedDataModel extends DataModel implements Serializable {

    private List<List<String>> nestedDataModel = populateModel();
    private int index;

    private List<List<String>> populateModel() {
        List<List<String>> list = new ArrayList<List<String>>();
        for(int x=0; x<3; x++) {
            List<String> nestedTableData = new ArrayList<String>();
            for(int y=0; y<3; y++) {
                nestedTableData.add("Foo x="+x+" y="+y);
            }
            list.add(nestedTableData);
        }
        return list;
    }

    @Override
    public int getRowCount() {
        return nestedDataModel.size();
    }

    @Override
    public Object getRowData() {
        List<String> list = nestedDataModel.get(index);
        return new ListDataModel(list);
    }

    @Override
    public int getRowIndex() {
        return index;
    }

    @Override
    public Object getWrappedData() {
        return nestedDataModel;
    }

    @Override
    public boolean isRowAvailable() {
        return index >= 0 && index < nestedDataModel.size();
    }

    @Override
    public void setRowIndex(int arg0) {
        index = arg0;
    }

    @Override
    public void setWrappedData(Object arg0) {
        throw new UnsupportedOperationException();
    }

} 
```

通常应避免嵌套 dataTables - 如果您不小心（例如，使它们成为表单的子级），这可能导致提交时生命周期的每个阶段的表子级传递 O(N^2) （并且生命周期中有 6 个阶段）。

* * *

对于模型外部的东西，您可以在托管 bean 中使用一个简单的计数器：

```
public class RowCounter implements Serializable {

    private transient int row = 0;

    public int getRow() {
        return ++row;
    }

} 
```

配置：

```
<managed-bean>
    <managed-bean-name>rowCounter</managed-bean-name>
    <managed-bean-class>tablerows.RowCounter</managed-bean-class>
    <managed-bean-scope>request</managed-bean-scope>
</managed-bean> 
```

看法：

```
<f:view>
    <h:dataTable border="1" value="#{tableDataBean.tableDataModel}"
        var="rowBean">
        <h:column>
            <h:outputText value="#{rowCounter.row}" />
        </h:column>
        <h:column>
            <h:outputText value="#{rowBean}" />
        </h:column>
    </h:dataTable>
</f:view> 
```

这是有效的，因为 bean 是请求范围的，并且绑定到表单外的只读控件。除非您希望行计数器对视图是全局的，否则它在嵌套数据表中不起作用。但是，我不相信行索引应该是视图的函数。

对于嵌套数据表，最好从行 bean 提供行索引。如果您也决定对数据集进行分页等操作，它会给您更多的控制权。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-06-20T11:28:32.803

在 RichFaces 中有一个类似于 Brent 的解决方案：

```
<rich:dataTable value="#{backingBean.list}" var="v" rowKeyVar="index">
    <rich:column>
        <f:facet name="header">Index</f:facet>
        <h:outputText value="#{index + 1}" />
    </rich:column>
    <rich:column>
        <f:facet name="header">Name</f:facet>
        <h:outputText value="#{v.name}" />
    </rich:column>
</rich:dataTable> 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-04-26T12:27:44.510

这对我有用

```
<h:dataTable var="item" value="#{controller.items}">
    <h:column>#{controller.items.indexOf(item)}</h:column>
    <h:column>value</h:column>
</h:dataTable> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-07-18T12:48:40.663

我只是依赖列表和 var 在此列表中的位置：

```
<h:column>
          <f:facet name="header">#</f:facet>
          #{bean.listValue.indexOf(varObject)+1}
</h:column> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-11-09T17:20:47.223

自 JSF 2.0（2009 年推出）以来[`UIComponent`](https://jakarta.ee/specifications/platform/9/apidocs/jakarta/faces/component/uicomponent)，视图中的当前实例可通过隐式 EL 变量获得`#{component}`。另请参阅[EL 中的 #{component} 到底是什么？](https://stackoverflow.com/questions/29035760/what-exactly-is-component-in-el)

该`<h:dataTable>`标签由[`UIData`](https://jakarta.ee/specifications/platform/9/apidocs/jakarta/faces/component/uidata)实现[`NamingContainer`](https://jakarta.ee/specifications/platform/9/apidocs/jakarta/faces/component/namingcontainer). 所以，`#{component.namingContainer}` 在上下文中的任何地方使用`<h:dataTable>`都会给你具体的`UIData`实例，通常是`HtmlDataTable`类的味道。

```
<h:dataTable value="#{['one', 'two', 'three']}" var="item">
    <h:column>This is the `UIData` component: #{component.namingContainer}</h:column>
</h:dataTable> 
```

> jakarta.faces.component.html.HtmlDataTable@cafebabe
> jakarta.faces.component.html.HtmlDataTable@cafebabe
> jakarta.faces.component.html.HtmlDataTable@cafebabe

该类`UIData`又具有该[`getRowIndex()`](https://jakarta.ee/specifications/platform/9/apidocs/jakarta/faces/component/uidata#getRowIndex--)方法，因此这应该足够了：

```
<h:dataTable value="#{['one', 'two', 'three']}" var="item">
    <h:column>Row index: #{component.namingContainer.rowIndex + 1}</h:column>
</h:dataTable> 
```

> 1
> 2
> 3

请注意，它是从零开始的，因此`+ 1`.

不需要`binding`或第 3 方标签或任何自定义支持 bean 逻辑。

# version-control - 在 CVS 中分支一个版本

> ID：298118
> 
> 赞同：4
> 
> 时间：2008-11-18T08:10:04.840
> 
> 标签：version-control, cvs, trunk

所以我有一个我想在 CVS 中清理的源代码树。

真正想要的是分支旧的东西，但永远不要合并回来。但是，如果我需要，我可以有一个 Eclipse 工作区来访问并进行一些更改。

然后我们清理主干（通过移除我们不再需要的东西）并继续开发。然后当我们发布一个新版本时，我们再次将其分支。

我不确定这在 CVS 中是如何工作的。因此，如果有人可以解释最好的解决方法，那就太好了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T08:13:11.790

如果您不再使用它，为什么不将其标记为版本，然后在 HEAD 中进行清理。

这就是我们在开发树中所做的。如果我们需要更正适用于旧版本的某些内容，我们只需在那个时候分支那个版本，而不是之前。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T21:00:57.983

使用 CVS，仅在需要进行更改时标记和处理分支要容易得多——这似乎是最佳实践。在我们切换到 SVN 之前，我发现有一个网站很有帮助：

[http://owen.sj.ca.us/rkowen/howto/cvs.html#branches](http://owen.sj.ca.us/rkowen/howto/cvs.html#branches)

# testing - 对部分模拟的期望 - NullReference 异常

> ID：298125
> 
> 赞同：0
> 
> 时间：2008-11-18T08:13:57.750
> 
> 标签：testing, rhino-mocks, partial-mocks

我在使用 Rhino Mocks 进行部分模拟时遇到问题：

```
var authentication = (FormsAuthenticationService)_mocks.PartialMock(
  typeof(FormsAuthenticationService));
Expect.Call( delegate{ authentication.SetAuthCookie(null, null); }).IgnoreArguments(); 
```

..我在“期望”上得到 NullReferenceException。线..

我将添加该`FormsAuthenticationService`工具`IAuthentication`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-19T15:11:23.943

您尝试模拟物理类而不是接口是否有充分的理由？我问这个是因为模拟 FormsAuthenticationService 存在 2 个潜在问题：

1.  该类可能没有默认的无参数构造函数（在这种情况下，您需要指定 mocks.PartialMock 的重载方法）。

2.  SetAuthCookie 必须是虚拟的。模拟框架通常只能模拟非密封类，并且只能模拟此类的虚拟成员。

为了解决这些问题，我建议改为模拟 IAuthentication。模拟接口没有这些限制。这是您要编写的代码：

```
var authentication = _mocks.DynamicMock<IAuthentication>();
Expect.Call(() => authentication.SetAuthCookie(null, null)).IgnoreArguments(); 
```

# tsql - 在 TSQL UPDATE 中使用 IF 语句

> ID：298138
> 
> 赞同：10
> 
> 时间：2008-11-18T08:26:25.230
> 
> 标签：tsql

我想更新表中的两列。第二列的值取决于第一列；如果第一个为 Null，则第二个的值为“假”，否则为“真”。
我可以在 TSQL 中执行此操作，还是需要事先在我的代码中单独计算出值并更改 SQL 以适应。我正在寻找类似的东西：

```
DECLARE @NewColumnValue as nvarchar(10);
SELECT @NewColumnValue = ColumnY From TableY
UPDATE TableX  
SET Column1 = @NewColumnValue,
Column2 = (IF (@NewColumnValue IS NULL) THEN 'False' ELSE 'True'); 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-18T08:31:59.820

您正在寻找[`CASE`](https://docs.microsoft.com/en-us/sql/t-sql/language-elements/case-transact-sql)表达式：

```
Column2 = CASE WHEN @NewColumnValue IS NULL THEN 'False' ELSE 'True' END 
```

# .net - 使用 Form.Controls 修改控件

> ID：298139
> 
> 赞同：0
> 
> 时间：2008-11-18T08:28:22.073
> 
> 标签：.net, c++, winforms

我正在将表单的引用传递给一个类。在这个类中，我相信我可以`formRef->Controls["controlName"]`用来访问控件上的属性。

这适用于一些标签，但在一个按钮上我收到“对象引用未设置为对象的实例”。当我尝试更改 Text 属性时。

帮助或解释表示赞赏...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T08:33:21.237

这表明未找到具有给定名称的控件。

不要忘记控件的名称不一定与其在设计器中的 ID 相同。对照您用来查找的名称检查实际名称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T09:40:08.433

我这样做了，它正在工作。可能更安全，因为我可以检查控件是否确实存在......

```
array<Control^>^ id = myForm->Controls->Find("myButton", true);
id[0]->Text = "new text"; 
```

我认为它中断的原因是该按钮位于另一个面板上。我发帖的时候没有想到。新的解决方案也将搜索所有孩子，所以这是一个改进。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-30T06:27:45.230

你总是可以尝试静态表格；D

# asp.net - 如何从 Javascript 将 TableRow/TableCell 添加到 ASP.NET 表？

> ID：298145
> 
> 赞同：1
> 
> 时间：2008-11-18T08:32:16.823
> 
> 标签：asp.net, javascript

从 Javascript 将 TableRows 和 TableCells 动态添加到 ASP.NET 表的最佳方法是什么？

谢谢，

杰夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T08:46:50.117

恐怕你的问题太模糊了，无法完全回答。如果您确实想要创建 TableRow 或 TableCell 对象，您当然需要回发（不需要 JavaScript）或对服务器端代码进行 AJAX 调用 (JavaScript)。无论哪种方式，它都不是真正的 JavaScript 在做这项工作。如果您只想动态地将一行添加到浏览器中显示的 HTML 表中，您可以在不需要 ASP.NET 的 TableRow/TableCell 抽象的情况下完成此操作。

要获得更完整的答案，您必须更具体地说明您要完成的工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T09:14:29.483

当然，除非您使用 javascript.net 作为服务器端脚本语言！-)

# .net - 使用嵌套 POCO 进行 LINQ To SQL 操作（插入/更新）所需的帮助

> ID：298162
> 
> 赞同：7
> 
> 时间：2008-11-18T08:40:33.657
> 
> 标签：.net, linq-to-sql, orm, poco

好吧，我一直在尝试将我的模型转换为使用 LINQ，但不想丢弃我当前的 DTO 及其分散在域中的接口。

我设法找到了这篇博客文章，它很好地概述了这个过程：

[在 LINQ To SQL 中实现 POCO](http://www.sidarok.com/web/blog/content/2008/10/14/achieving-poco-s-in-linq-to-sql.html)

我设法让对象的记录检索正常工作，但是，由于我的模型的嵌套性质，我似乎无法为子对象添加工作。也就是说，如果我创建一个子对象，并设置对所需父对象的引用，LINQ to SQL 仍然会引发异常，说明子对象对父对象的引用为空。如果我尝试添加一个普通的旧父对象，它会成功，但直接添加子对象会失败

这是我失败的测试：

```
 [Test]
    public void AddSelectionShouldAddSelectionToMarket()
    {
        Market market = (Market) new Repository().GetMarket(1);

        Selection selection = new Selection();
        selection.Market = market;

        new Repository().AddSelection(selection);

        Assert.IsTrue(selection.SID > 0);
    } 
```

这是错误消息：

System.InvalidOperationException：试图删除市场和选择之间的关系。但是，不能将关系的外键之一 (Selection.MID) 设置为 null。

2个对象的相关部分：

```
[DataContract]
public class Selection : ISelection
{
    private int mID;
    [DataMember]
    public int MID
    {
        get { return this.mID; }
        set { this.mID = value; }
    }

    private Market market;
    [DataMember]
    public Market Market
    {
        get { return this.market; }
        set
        {
            this.market = value;
            this.mID = value.MID;
        }
    }
}

[DataContract]
public class Market : IMarket
{
    private int mID;
    [DataMember]
    public int MID
    {
        get { return this.mID; }
        protected set { this.mID = value; }
    }

    private List<Selection> selections;
    [DataMember]
    public List<Selection> Selections
    {
        get { return this.selections; }
        set
        {
            this.selections = value;
            // For LINQ
            foreach (Selection selection in selections)
            {
                selection.MID = mID;
                selection.Market = this;
            }
        }
    }
} 
```

我的 DA 代码：

```
 MarketsDataContext context = new MarketsDataContext();

        DataLoadOptions options = new DataLoadOptions();
        options.LoadWith<Selection>(s => s.Prices);
        options.LoadWith<Market>(m => m.Selections);

        context.LoadOptions = options;
        return context; 
```

和;

```
 public void AddSelection(ISelection selection)
    {
        using (MarketsDataContext context = MarketsDataContext.GetContext())
        {
            context.Selections.InsertOnSubmit((Selection) selection);
            context.SubmitChanges();
        }
    } 
```

最后是我的 XML 映射：

```
 <Table Name="dbo.Markets" Member="Markets">
    <Type Name="Market">
      <Column Name="MID" Member="MID" Storage="mID" DbType="Int NOT NULL" IsPrimaryKey="true" IsDbGenerated="true" AutoSync="OnInsert" />
      <Association Name="FK_Market-Selections" Member="Selections" Storage="selections" ThisKey="MID" OtherKey="MID" DeleteRule="NO ACTION"  />
    </Type>
  </Table>

  <Table Name="dbo.Selections" Member="Selections">
    <Type Name="Selection">
      <Column Name="SID" Member="SID" Storage="sID" DbType="Int NOT NULL" IsPrimaryKey="true" IsDbGenerated="true" AutoSync="OnInsert" />
      <Column Name="MID" Member="MID" Storage="mID" DbType="Int NOT NULL" />
      <Association Name="FK_Market-Selections" Member="Market" Storage="market" ThisKey="MID" OtherKey="MID" IsForeignKey="true" />
    </Type>
  </Table> 
```

那么，谁能指出我正确的方向？我已经找了好几个小时了...

编辑：

这是我的测试失败的堆栈跟踪：

```
at System.Data.Linq.ChangeTracker.StandardChangeTracker.StandardTrackedObject.SynchDependentData()
at System.Data.Linq.ChangeProcessor.ValidateAll(IEnumerable`1 list)
at System.Data.Linq.ChangeProcessor.SubmitChanges(ConflictMode failureMode)
at System.Data.Linq.DataContext.SubmitChanges(ConflictMode failureMode)
at System.Data.Linq.DataContext.SubmitChanges()
at BetMax.DataModel.Repository.AddSelection(ISelection selection) in Repository.cs: line 68
at BetMax.DataModel.Test.ModelTest.AddSelectionShouldAddSelectionToMarket() in ModelTest.cs: line 65 
```

还有我的 GetMarket 方法：

```
 public IMarket GetMarket(int MID)
    {
        Market market;
        using (MarketsDataContext context = MarketsDataContext.GetContext())
        {
            market = context.Markets.Single(m => m.MID == MID);
        }
        return market;
    } 
```

编辑2：

好吧，添加

```
DeleteOnNull="true" 
```

XML 映射中的 Selections 外键已删除外键错误，但现在我在 Selections 的其中一个子对象上获得了一个空引用，说它对 Selections 的引用为空，即使在未设置任何变量的情况下初始化 Selections （外键之外）。我什至尝试创建一个子对象，并正确设置它的引用，但仍然收到此错误：

```
System.NullReferenceException: Object reference not set to an instance of an object.
at BetMax.DTO.Price.set_Selection(Selection value) in Price.cs: line 25
at System.Data.Linq.Mapping.PropertyAccessor.Accessor`3.SetValue(ref T instance, V value)
at System.Data.Linq.Mapping.MetaAccessor`2.SetBoxedValue(ref Object instance, Object value)
at System.Data.Linq.ChangeProcessor.ClearForeignKeysHelper(MetaAssociation assoc, Object trackedInstance)
at System.Data.Linq.ChangeProcessor.ClearForeignKeyReferences(TrackedObject to)
at System.Data.Linq.ChangeProcessor.PostProcessUpdates(List`1 insertedItems, List`1 deletedItems)
at System.Data.Linq.ChangeProcessor.SubmitChanges(ConflictMode failureMode)
at System.Data.Linq.DataContext.SubmitChanges(ConflictMode failureMode)
at System.Data.Linq.DataContext.SubmitChanges()
at BetMax.DataModel.Repository.AddSelection(ISelection selection) in Repository.cs: line 68
at BetMax.DataModel.Test.ModelTest.AddSelectionShouldAddSelectionToMarket() in ModelTest.cs: line 69 
```

价格是另一个对象，构造与选择与市场相关（1 个选择有很多价格，1 个市场有很多选择）等等。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T09:30:39.157

我想问题出在你的测试方法上。您使用 DataContext 创建了一个存储库，但您使用另一个存储库进行了提交。

```
[Test]
public void AddSelectionShouldAddSelectionToMarket()
{
    Market market = (Market) new Repository().GetMarket(1);

    Selection selection = new Selection();
    selection.Market = market;

    new Repository().AddSelection(selection);

    Assert.IsTrue(selection.SID > 0);
} 
```

创建一个存储库并在测试方法中使用它。

```
[Test]
public void AddSelectionShouldAddSelectionToMarket()
{
    Repository repository = new Repository();
    Market market = (Market) repository.GetMarket(1);

    Selection selection = new Selection();
    selection.Market = market;

    repository.AddSelection(selection);

    Assert.IsTrue(selection.SID > 0);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T09:32:26.640

只是一个猜测，但它可能就在这里

```
public Market Market
{
    get { return this.market; }
    set
    {
        this.market = value;
        this.mID = value.MID;
    }
} 
```

当您设置为 Market 的值为 null 时会发生什么？最后一行将无效，因为它无法解析 null.MID。也许你的二传手需要这个：

```
 set
    {
        this.market = value;
        this.mID = (value == null) ? null : value.MID;
    } 
```

此外，您的 MID 必须可以为空

```
int? MID 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T12:57:43.090

对于您的新问题；对 Price 的选择属性进行空分配时会出现问题。你是通过你的代码做到的吗？您能否再次给出您遇到异常的代码部分？我的意思是分配给价格实体...

根据评论编辑：我猜这是因为我们之前在 GeekyMonkeys 帖子中提到的空控制异常。在 Selection 类的初始化中，Price 属性需要设置为 null，但是当分配 null 时，它会抛出 null 引用。所以你必须在一组价格属性中做一个空控制。

```
private List<Price> prices
[DataMember]
public List<Price> Prices
{
    get { return this.prices; }
    set
    {
        if(value != null)
        {
          this.pricess = value;
          // For LINQ             
          foreach (Price price in prices)
          {
            price.MID = mID;
            price.Selection = this;
          }
       }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-04T23:39:48.647

我知道已经有一段时间了，您可能已经解决了这个问题，但也许还没有……

我假设您的数据结构与此类似：

```
Market
======
Market_ID      int not null identity (1, 1)

Selection
=========
Selection_ID   int not null identity (1, 1)
Market_ID      int (FK to Market)
Selection_Name varchar(50) 
```

同时添加新市场和新选择：

```
Selection selection = new Selection();
Market market = new Market();

market.Selections.Add(selection);
DataContext.Markets.InsertOnSubmit(market);
DataContext.SubmitChanges(); 
```

要将新选择添加到现有市场：

```
Selection selection = new Selection();
Market market = DataContext.Markets.Where(a => a.Market_ID == 7).Single();

market.Selections.Add(selection);
DataContext.SubmitChanges(); 
```

要更新市场中的第一个选择：

```
Selection selection = DataContext.Markets.Where(a => a.Market_ID == 7).Selections.First();

selection.Selection_Name = "New Name";
DataContext.SubmitChanges(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T09:29:51.170

我建议将您的代码发送给 Sidar Ok。他是个好人，会为你指明正确的方向。或者至少在他的博客上发表评论，指出他在这里的问题。

# excel - 用于检查 Excel 中的空白单元格的 SQL 查询

> ID：298165
> 
> 赞同：0
> 
> 时间：2008-11-18T08:42:35.990
> 
> 标签：excel

我在 Excel 表中有两列和 10 行的数据。第一列的某些行具有空白值。Excel 在将 aut 过滤器放在列上时将其显示为（空白）

我正在从 C# 2.0 查询 excel 表，以了解第一列是否包含空白。

select * from [Sheet1$] where [Myname] = \"\"";

上面的查询没有返回任何记录，所以我尝试了下面的查询。

select * from [Sheet1$] where [Myname] = \" \"";

这要么不返回任何行。我也尝试在 where 子句中使用 value NULL，但它也不起作用。

谁能帮我编写正确的查询来检查 excel 中的空白字段吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T09:32:13.927

```
select * from [Sheet1$] where [Myname] IS NULL 
```

使用 System.Data.OleDb 似乎可以正常工作。

# scala - Scala 中是否有用于在匿名函数中绑定值的语法糖？

> ID：298167
> 
> 赞同：6
> 
> 时间：2008-11-18T08:42:51.623
> 
> 标签：scala, anonymous-function, syntactic-sugar

而不是写

```
((x: Double) => (((y: Double) => y*y))(x+x))(3) 
```

我想写一些类似的东西

```
((x: Double) => let y=x+x in y*y)(3) 
```

Scala 中有没有类似这种语法糖的东西？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-18T16:41:41.110

确实有：它叫做“ `val`”。:-)

```
({ x: Double =>
  val y = x + x
  y * y
})(3) 
```

大括号在这里当然是可选的，我只是在定义函数时更喜欢它们而不是括号（毕竟，这不是 Lisp）。`val`关键字在当前词法范围内定义了一个新的绑定。与 Lisp 和 ML 等语言不同，Scala 不强制本地人定义自己的范围。

实际上，`var`它也适用于任何范围，但使用它被认为是不好的风格。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-19T02:44:17.197

好的，这是一个带装订的衬里：

```
 ({ x:Double => val y = x + x; y * y })(3) 
```

干杯

# installation - 为第 3 方软件创建答案文件（非操作系统安装）

> ID：298169
> 
> 赞同：1
> 
> 时间：2008-11-18T08:45:07.563
> 
> 标签：installation

好的，伙计们知道如何为 WinAmp 的无人值守安装创建答案文件吗？

到目前为止，我所有的研究都指向为 Windows 或其他一些操作系统进行无人值守安装。我想要做的是为第 3 方软件创建无人值守安装。有没有工具可以做到这一点？或者第三方软件的无人值守安装只是一个白日梦？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-19T01:30:39.577

您应该在谷歌上搜索的术语是“静默安装”而不是“无人值守安装”。

您很可能正在寻找基于 MSI 的安装，它可以通过以下方式静默安装

```
MSIEXEC /I file.msi /QUIET 
```

对于非 MSI 安装，您可以重新打包它们或按照特定产品的文档进行操作。

几乎任何软件公司都能够为您提供无人值守安装其产品的说明，最佳实践建议在尝试您自己的方法之前先联系供应商。您的“本土”解决方案可能未经过测试或支持，并且可能会出现问题。

最后一个 WinAmp 我不确定这个静默安装，我认为他们使用非 MSI 格式，所以我的说明不会有太大帮助:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T08:50:01.420

AFAIK，对于没有在安装程序中为您提供机制的软件来说，这只是一个白日梦。

如果你有一个宏实用程序，你可以记录你想要安装的鼠标和按键，并以这种方式自动化它。尝试[其中一些](http://www.google.co.uk/search?q=macro+tools)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T12:45:59.587

如果应用程序不支持无人值守安装，可以在[http://unattended.sourceforge.net/installers.php](http://unattended.sourceforge.net/installers.php)的“如果一切都失败”部分中找到一些信息 - 即可以手动安装并重新打包到做一个静默安装程序。它可能很混乱，但大多数时候它都有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-19T01:58:40.720

如前所述， http: [//unattended.sourceforge.net/installers.php](http://unattended.sourceforge.net/installers.php)（[及其 wiki ）是一个极好的资源。](http://ubertechnique.com/unattended/Scripts)[http://www.appdeploy.com/packages/](http://www.appdeploy.com/packages/)是另一个出色的站点，[WPKG wiki](http://wpkg.org/Category:Silent_Installers)也是如此。

# c# - C#成员变量初始化；最佳实践？

> ID：298183
> 
> 赞同：102
> 
> 时间：2008-11-18T08:51:01.980
> 
> 标签：c#, constructor, declaration

在声明时初始化类成员变量是否更好

```
private List<Thing> _things = new List<Thing>();
private int _arb = 99; 
```

还是在默认构造函数中？

```
private List<Thing> _things;
private int _arb;

public TheClass()
{
  _things = new List<Thing>();
  _arb = 99;
} 
```

这仅仅是风格问题还是存在性能权衡，一种或另一种方式？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-11-18T09:04:34.293

在性能方面，没有真正的区别；字段初始值设定项被实现为构造函数逻辑。唯一的区别是字段初始值设定项发生在任何“base”/“this”构造函数之前。

构造函数方法可以与自动实现的属性一起使用（字段初始值设定项不能） - 即

```
[DefaultValue("")]
public string Foo {get;set;}
public Bar() { // ctor
  Foo = "";
} 
```

除此之外，我更喜欢字段初始值设定项语法；我发现它可以使事情本地化-即

```
private readonly List<SomeClass> items = new List<SomeClass>();
public List<SomeClass> Items {get {return items;}} 
```

我不必四处寻找它被分配的位置......

明显的例外是您需要执行复杂的逻辑或处理构造函数参数 - 在这种情况下，基于构造函数的初始化是要走的路。同样，如果您有多个构造函数，则最好始终以相同的方式设置字段 - 因此您可能有如下 ctors：

```
public Bar() : this("") {}
public Bar(string foo) {Foo = foo;} 
```

编辑：作为旁注，请注意，在上面，如果有其他字段（未显示）具有字段初始化器，那么它们仅在调用的构造函数中直接初始化`base(...)`- 即`public Bar(string foo)`ctor。另一个构造函数*不*运行字段初始值设定项，因为它知道它们是由`this(...)`ctor 完成的。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-18T09:12:22.670

实际上，您演示的字段初始值设定项是一种方便的速记。编译器实际上将初始化代码复制到您为类型定义的每个实例构造函数的开头。

这有两个含义：首先，任何字段初始化代码在每个构造函数中都是重复的，其次，您在构造函数中包含的用于将字段初始化为特定值的任何代码实际上都会重新分配字段。

所以在性能方面，关于编译的代码大小，你最好将字段初始化器移动到构造函数中。

另一方面，性能影响和代码“膨胀”通常可以忽略不计，并且字段初始化语法具有降低您可能忘记在其中一个构造函数中初始化某些字段的风险的重要好处。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-03-18T17:22:37.073

字段初始值设定项的一个主要限制是无法将它们包装在 try-finally 块中。如果在字段初始化器中抛出异常，则在之前的初始化器中分配的任何资源都将被放弃；没有办法阻止它。构造中的其他错误可以通过让受保护的基础构造函数通过引用接受 IDisposable 并将其指向自身作为其第一个操作来处​​理，如果笨拙的话。然后可以避免调用构造函数，除非通过工厂方法，如果发生异常，工厂方法将在部分创建的对象上调用 Dispose。如果主类构造函数在“走私”对新对象的引用后失败，则此保护将允许清理在派生类初始化程序中创建的 IDisposables。不幸的是，有'

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-18T08:58:17.643

例如变量，主要是风格问题（我更喜欢使用构造函数）。对于静态变量，初始化内联有[性能优势](http://blogs.msdn.com/brada/archive/2004/04/17/115300.aspx)（当然，并非总是可能）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-18T09:45:15.583

使用字段初始值设定项或创建 Init() 函数。将这些东西放在构造函数中的问题在于，如果您需要添加第二个构造函数，最终会得到复制/粘贴代码（或者忽略它并最终得到未初始化的变量）。

我要么在声明的地方初始化。或者让构造函数调用 Init() 函数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-18T09:04:24.387

这真的取决于你。
我经常内联初始化它们，因为当我真的不需要构造函数时我不喜欢有一个构造函数（我喜欢小类！）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-02-06T11:46:58.190

On added point to the above - You always have a constructor when implementing classes that have an implementation. If you do not declare one then the default instructor is inferred by the compiler [public Foo(){}]; a constructor that takes no arguments.

Often times I like to offer both approaches. Allow constructors for those that wish to use them and allow the Field Initializers for situations where you wish to use a simplified or default implementation of your class / type. This adds flexibility to your code. Keep in mind that anyone can use the default field initializer if they choose ... be sure to declare it manually if you offer more than one constructor - public Foo(){}

# python - Google App Engine 代码优化

> ID：298185
> 
> 赞同：3
> 
> 时间：2008-11-18T08:51:41.917
> 
> 标签：python, google-app-engine, optimization

谷歌应用引擎告诉我优化这段代码。有人知道我能做什么吗？

```
def index(request):
    user = users.get_current_user()
    return base.views.render('XXX.html', 
                 dict(profiles=Profile.gql("").fetch(limit=100), user=user)) 
```

稍后在模板中我做：

```
{% for profile in profiles %}
  <a href="/profile/{{profile.user.email}}/"><img src="{{profile.gravatarUrl}}"></a>
  <a href="/profile/{{profile.user.email}}/">{{ profile.user.nickname }}</a>
  <br/>{{ profile.shortDisplay }} 
```

使用的方法是：

```
def shortDisplay(self):
    return "%s/day; %s/week; %s days" % (self.maxPerDay, self.maxPerWeek, self.days)

def gravatarUrl(self):
    email = self.user.email().lower()
    default = "..."
    gravatar_url = "http://www.gravatar.com/avatar.php?"
    gravatar_url += urllib.urlencode({'gravatar_id':hashlib.md5(email).hexdigest(), 
        'default':default, 'size':"64"})
    return gravatar_url 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-18T11:03:59.980

高 CPU 使用率是由于每个请求获取 100 个实体。您在这里有几个选择：

*   使用 Profile.all().fetch(100) 会稍微快一点，而且更容易阅读。
*   从 Profile 模型中删除任何无关的属性。反序列化实体的每个属性开销很大。
*   每页显示更少的用户。
*   将此页面的输出存储在 memcache 中，并尽可能从 memcache 中渲染。这样，您就不需要经常生成页面，所以如果它是高 CPU 也没关系。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T09:03:47.493

我猜想每次对每个项目执行 md5 哈希是非常昂贵的。最好将 gravatar 电子邮件哈希存储在某处。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-03T18:50:42.397

我遇到了一个问题，即大量 CPU 用于看似很少的工作，结果证明不是多次运行的查询。例如。在我的 Django 模板中，我执行了 post.comments.count，然后循环访问了 post.comments。这导致了两次执行——一次获得计数，一次获得实体。哎呀！

我还要说拿一份 Guido 的 Appstats。它对 Python 没有帮助，但是查看 API 调用所花费的时间（以及它们之间的时间——这通常表明你在哪里遇到了慢速 Python）非常有用。

您可以在此处获取该库：[https ://sites.google.com/site/appengineappstats/](https://sites.google.com/site/appengineappstats/)

我在我的博客上写了一篇关于它的文章（附有一些截图）：[http ://blog.dantup.com/2010/01/profiling-google-app-engine-with-appstats](http://blog.dantup.com/2010/01/profiling-google-app-engine-with-appstats)

[应用统计 http://blog.dantup.com/pi/appstats_4_thumb.png](http://blog.dantup.com/2010/01/profiling-google-app-engine-with-appstats)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T11:42:45.670

这取决于您在哪里收到过多 CPU 的警告。

是不是在dashboard里，大概是很多datastore CPU，不需要优化。

如果请求需要超过 10 秒，则需要优化。

如果您收到定期日志警告，指出某个请求的 x.xx 超过 CPU 限制，则意味着您的应用程序代码花费的时间太长。并且需要优化。

我发现很多 Django 模板的东西并不占用很多应用程序 CPU（50-100 Mcycle）。如果模板的所有字段都已预先计算。

# c# - 读取/写入程序文件时访问被拒绝

> ID：298187
> 
> 赞同：1
> 
> 时间：2008-11-18T08:53:29.480
> 
> 标签：c#, access-denied, elevation

我有一个小程序安装在程序文件的自定义文件夹中，但是当我尝试读取或写入操作所需的文件时，程序会引发访问被拒绝异常。当然，在用户许可的情况下，我如何提升程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T08:56:40.987

我猜你是在 Vista 下运行的？在 Vista 中，我认为您不允许读取/写入 Program Files 下的文件，您应该将数据文件放在 Documents and Settings 中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-11-23T09:53:30.787

解决读取时访问被拒绝的异常。请将文件访问指定为已读，这将解决读取时拒绝访问的异常

```
e.g. fs = new FileStream(fileName, FileMode.Open, FileAccess.Read); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T18:20:21.347

您可以使用**ClickOnce API**完成所需的一切。如果您有多个部分（例如，多个 EXE），那么您需要将它们包含在您的包中。

据我所知，唯一不支持的场景（ClickOnce）是验证代理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T20:30:54.440

ClickOnce 支持安装任意数量的可执行文件，但您可能需要手动将它们包含在清单定义中。

为了正确并在最少用户访问 (LUA) 和用户访问控制 (UAC) 的限制下正常运行，您的应用程序根本不应该写入程序文件夹，除非在安装期间。如果您必须这样做，您应该包含一个清单文件，该文件表明您的应用程序需要提升的权限才能运行。（如果您在 Vista 上运行，您还可以设置兼容模式。）

# delphi - 如何在 Delphi 中显示 Vista 风格的气球提示？

> ID：298190
> 
> 赞同：8
> 
> 时间：2008-11-18T08:54:45.967
> 
> 标签：delphi, winapi

在输入验证时，我使用气球提示而不是消息框。我的问题是，在 Vista 上，它们具有带有圆角的旧 XP 样式，而不是较新的更像矩形的外观。

我尝试使用 CreateWindowEx 创建它们，`tooltips_class32`或者使用 SendMessageW 和显示编辑的关联气球提示`EM_SHOWBALLOONTIP`，结果是相同的。在 Visual Studio 和 C# 中执行相同的操作会产生 Vista 样式的气球提示。

当您在密码编辑时切换 Caps Lock 时，您可以看到我需要的气球提示示例，例如 Windows 登录中的那个。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-18T10:01:13.337

如果您使用的是 Delphi 2009，那么添加气球提示相当简单，尽管文档很差。（惊喜，惊喜）

*   在您的表单上放置一个 TBalloonHint
*   如果需要，删除 TImageList 以包含图标。
*   将 TIMageList 链接到 TballoonHint
*   将表单的 CustomHint 属性设置为 TBalloonHint
*   确保 ShowHint 和 ParentCustomHint 为您的控件设置为 true。

下一点是[非常不明显的](http://qc.codegear.com/wc/qcmain.aspx?d=67445)：

*   将控件的“Hint”属性格式化为“Title|Hint|ImageIndex”

你完成了。这看起来不像 100% vista，可能是由于字体选择。但它非常接近。

[![德尔福 2009](https://i.stack.imgur.com/rvyYs.png)](https://i.stack.imgur.com/rvyYs.png)
[（来源：[codegear.com](http://dn.codegear.com/article/images/38757/0300000D.png)）] ，

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T09:03:45.573

正如可以在[Delphi 2009 审阅者指南](http://dn.codegear.com/article/38757)中阅读的那样，每个 VCL 组件现在都有一个 CustomHint 属性。它可以设置为 TCustomHint 的任何后代。

请务必在 Vista 中启用气球提示，否则它们将不会显示。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T16:51:17.767

Delphi 2009 中的 TCustomHint 有四个受保护的 ShowHint 重载，当调用它们时，您可以按需将 TCustomHint 放置在特定位置：

```
procedure ShowHint; overload;
procedure ShowHint(Point: TPoint); overload;
procedure ShowHint(Rect: TRect); overload;
procedure ShowHint(Control: TControl); overload; 
```

您需要做的就是以您想要的样式实现一个提示（或者如果它足够接近，则直接从 TBalloonHint 下降）并将这些方法公开，以便能够随时随地放置提示。

注意：更改 TCustomHint 的 Title 属性以更改显示的文本，除非您使用将 TControl 作为参数的 ShowHint。在这种情况下，它从控件的 Hint 属性中获取它（并将其放置在 TCustomHint 的 Title 属性中）。

# vb.net - 如何在 vb.net 中实现交易方式？

> ID：298194
> 
> 赞同：1
> 
> 时间：2008-11-18T08:59:06.737
> 
> 标签：vb.net, ms-access, transactions

我使用连接到 MS-Access 数据库的 VB.net (200%) 开发了一个应用程序，我使用 TableAdapter 和 Dataset 连接到 Access DB 文件。

我需要实现一个简单的事务方法（提交、回滚）来保存到数据库吗？

有没有办法做到这一点而无需使用内联 SQL 语句？

谢谢，

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-18T09:31:36.377

在我阅读 Microsoft Jet（Access DB 引擎）时，它支持事务。因此，您可以创建这样的事务（来自[CodeProject](http://www.codeproject.com/KB/database/transactions.aspx)的示例）：

```
 SqlConnection db = new SqlConnection("connstringhere");
      SqlTransaction transaction;

      db.Open();
      transaction = db.BeginTransaction();
      try 
      {
         new SqlCommand("INSERT INTO TransactionDemo " +
            "(Text) VALUES ('Row1');", db, transaction)
            .ExecuteNonQuery();
         new SqlCommand("INSERT INTO TransactionDemo " +
            "(Text) VALUES ('Row2');", db, transaction)
            .ExecuteNonQuery();
         new SqlCommand("INSERT INTO CrashMeNow VALUES " +
            "('Die', 'Die', 'Die');", db, transaction)
            .ExecuteNonQuery();
         transaction.Commit();
      } 
      catch (SqlException sqlError) 
      {
         transaction.Rollback();
      }
      db.Close(); 
```

一种更简单的方法是（来自[15 Seconds](http://www.15seconds.com/Issue/040914.htm)的示例）：

```
bool IsConsistent = false;

using (System.Transactions.TransactionScope ts = new System.Transactions.TransactionScope())

{

      SqlConnection cn = newSqlConnection(CONNECTION_STRING );

      string sql = "DELETE Categories";

      SqlCommand cmd = newSqlCommand(sql, cn);

      cn.Open();

      cmd.ExecuteNonQuery();

      cn.Close();

      //Based on this property the transaction will commit if

      //successful.  If it fails however, this property will

      //not be set and the transaction will not commit.

      ts.Consistent = IsConsistent;

} 
```

如果您使用的是*TransactionScope* ，则需要在您的机器上运行 MSDTC 。

不幸的是**TableAdapter 没有公开连接属性**，因此您需要一种解决方法。所以你需要一些解决方法：

***1）反射***（示例形式[CodeProject](http://www.codeproject.com/KB/database/TableAdapter-Transaction.aspx)）

```
conn = new SqlConnection(Properties.Settings.Default.NorthwindConnectionString);
conn.Open();
trans = conn.BeginTransaction();
1\. 
public SqlDataAdapter GetAdapter(object tableAdapter)
{
    Type tableAdapterType = tableAdapter.GetType();
    SqlDataAdapter adapter = (SqlDataAdapter)tableAdapterType.GetProperty("Adapter", BindingFlags.Instance | BindingFlags.NonPublic).GetValue(tableAdapter, null);
        return adapter;
}
2.
adapter.InsertCommand.Connection = trans.Connection;
adapter.UpdateCommand.Connection = trans.Connection;
adapter.DeleteCommand.Connection = trans.Connection;

3.
adapter.InsertCommand.Transaction = trans;
adapter.UpdateCommand.Transaction = trans;
adapter.DeleteCommand.Transaction = trans;

4\. 
-

5\. 
trans.commit(); 
```

反射可能很慢！

***2) TransactionScope*** ( [DevX.com](http://www.devx.com/codemag/Article/31666/0/page/4)示例)

```
 CustomersDataSet.CustomersDataTable customers = new CustomersDataSet.CustomersDataTable();
   CustomersDataSetTableAdapters.CustomersTableAdapter tblAdap = new 
      CustomersDataSetTableAdapters.CustomersTableAdapter();
   using (TransactionScope txScope = new TransactionScope())
   {
       tblAdap.Fill(customers);
       customers.Rows[0]["ContactName"] = "Maria Velasquez";
       tblAdap.Update(customers);
       txScope.Complete();
   } 
```

您将需要 MSDTC！

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-11-18T09:30:01.667

[您可以在http://www.asp.net/learn/data-access/](http://www.asp.net/learn/data-access/)找到一堆数据访问教程

# xhtml - 有语义版本 吗？

> ID：298218
> 
> 赞同：10
> 
> 时间：2008-11-18T09:13:00.673
> 
> 标签：xhtml, semantic-markup, underline

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-18T09:20:42.687

简而言之 - 不。

<b> 和 <i> 也没有真正的等价物。这都是关于内容和外观的分离。XHTML strict 的目标是应该使用 XHTML 标记来描述内容的*结构*。

<em> 标签用于表达*重点*，而 <strong> 标签用于**增强**内容的强度。碰巧的是，大多数浏览器中的默认样式表分别将它们等同于斜体和粗体。

在 XHTML 中有粗体、斜体和下划线的直接等效项将允许人们过于密切地指定内容的外观。理想情况下，您应该考虑为什么要让一段文本脱颖而出，在结构中定义它，然后让 CSS 男孩决定最终应该如何呈现它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-18T09:20:52.733

要获得等价物，您必须首先定义为什么要强调事物。如果这只是您强调文本的首选方式，请使用 <em> 并将其在 CSS 中的样式更改为下划线而不是斜体。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-18T09:28:12.327

您的问题是有缺陷的-“下划线”没有语义含义，与粗体或斜体一样（**strong**和**em**具有默认样式，但它们并不像您认为的那样硬连接到粗体或斜体）。

这里正确的方法是用一个`<span class="highlight">`（或其他一些合适的关键字 - 我不知道你的应用程序）进行标记，或者只是标记并覆盖 css，`<em>`如果这将是一个足够普遍的事件。

另外：以任何强调方式使用下划线*总是存在问题，因为有一个已建立的约定，即链接带有下划线。*我通常会认为非链接下划线是一个可用性问题，即使实际链接没有下划线。仔细想想你真的需要这个。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-03T17:01:02.873

```
<em style="text-decoration: underline"> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-18T09:20:27.053

不，也没有 <b> 或 <i> 的“语义等价物”。碰巧 <em> 和 <strong> （我假设这些是您的想法）在大多数浏览器中默认使用粗体和斜体实现。

当然，像下划线这样的排版应该使用 CSS 来实现。创建一个类并使用 <span>。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-18T09:17:05.283

据我所知没有。但是将 strong 视为 b 的等价物有点值得怀疑。

新标签的目的是将格式（粗体）与含义（更可见的文本）分离。默认外观为粗体，但您可以创建任何您喜欢的样式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-18T09:15:43.710

不，你必须使用带有文本装饰的css：下划线

# asp.net - 获取 .NET 中 Web 服务中的查询字符串（GET 请求数组）

> ID：298219
> 
> 赞同：9
> 
> 时间：2008-11-18T09:13:35.103
> 
> 标签：asp.net, web-services, get

我正在寻找一种方法来访问包含在 Web 服务内的标准 ASP.NET 请求对象中的 .net 查询字符串。换句话说，如果我将 SOAP Web 服务设置为此 url：

[http://localhost/service.asmx?id=2](http://localhost/service.asmx?id=2)

我可以访问 ID Get 变量吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-18T09:19:31.457

我只是在 asmx 文件中寻找上下文的“请求”，我看到了。但我不确定它是否正确。

```
this.Context.Request.QueryString["id"]; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-18T09:26:59.117

HttpContext.Current.Request.QueryString["id"]

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T09:20:51.437

既然你问，我猜没有 HttpContext.Current.Request ？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-19T05:35:10.827

在寻找相同问题的解决方案时，我决定采用不同的方法。我的查询字符串包含很多变量，因为我无法从 Web 服务访问查询字符串数据，而且我也不想将每个查询字符串变量作为单独的参数发送，所以我准备了我的 Web 方法来期待一个附加字符串参数。

该参数是.aspx 页面上的 javascript 函数中的**window.location （页面的整个 url）**

一旦我的网络服务中有 url，剩下的就很简单了

```
Uri myRef = new Uri(stringMyWindowLocationParameter);
System.Collections.Specialized.NameValueCollection mojQuery = HttpUtility.ParseQueryString(myRef.Query); 
```

现在我的查询字符串包含在**myRef**对象中，这就是我所说的

```
// Instead trying to request query string like this
string myId = HttpContext.Current.Request.QueryString["id"];

// ... I called it like this
string myId = myRef["id"]; 
```

也许这不是最优雅的方式，但它解决了我的问题。

# maven-2 - Maven、Hudson 和动态 Clearcase 视图

> ID：298228
> 
> 赞同：3
> 
> 时间：2008-11-18T09:19:21.487
> 
> 标签：maven-2, hudson, clearcase, nexus

这源于询问 Apache Maven 和 IBM Rational ClearCase 是否集成良好的问题。我想我应该写下我发现的东西——需要进行各种编辑，但我最终会按我希望的方式添加它。

## 环境

**ClearCase** - ClearCase 版本 7.0.1.2.

**Maven** - 所有这些，来自[Maven 网站](http://maven.apache.org)。

**Hudson** - 1.307 版直接从[Hudson 网站下载](http://hudson-ci.org/)

* * *

## 问题

*   Maven 是否从 VOB 运行？

我将所有版本的 Maven2 安装到 VOB 'stacked' 中，即我添加了 2.0 版本 - 标记它，锁定标签 - 然后在顶部添加 2.0.1。

为了防止出现无关文件，我在 clearfsimport 中使用了 -rnname 标志。

这样，我可以简单地使用标签在我的配置规范中指定我想要访问的 Maven 版本，但仍然为 maven 可执行文件保留相同的路径 - */maven/bin/mvn。*

*一旦安装了所有版本，我就可以通过动态*视图从那里运行 Maven 。存储库像往常一样从 Nexus 的内部安装下载到用户主目录 - 这可以避免签入和签出的任何问题。

将工具保留在源代码控制中的一个好处是您可以设置公司范围的设置（例如指向内部存储库） - 然后在任何平台上从 VOB 运行单个 Maven 实例，这会保留您最初设置的设置！

在 Maven 项目中，我只将 src 目录和 pom.xml 保留在源代码管理中，因为之后可以自动生成其他所有内容。

*   Hudson 是否与 ClearCase 一起使用？

我在设置 Hudson 以使用 ClearCase 动态视图运行时没有问题。所需要的只是从 Hudson 的工作目录到视图根目录（在本例中为 /view/xxx）的符号链接。ClearCase 插件成功运行**ct lshistory**以查找开发人员合并到的集成分支中是否有任何更改。

我确实编写了一个小脚本来设置作业的初始环境 - 只是 config.xml 和动态视图符号链接 - 以便在作业中列出正确的视图并且初始设置是正确的。之后用户所做的任何增强都是对默认模板的更改，而不是他们自己设置。

在 Hudson 的整体设置中，我使用了 $CLEARCASE_VIEW 环境变量来设置 Maven 可执行文件的路径。这样，Maven 的版本取决于配置规范中设置的版本——而不是他们在 Hudson 中选择的版本。

这为我（管理员）和我的用户节省了额外的管理。

*   您使用的是什么内部存储库管理器？

我将 Sonatype Nexus 设置为内部存储库管理器 - 主要是因为我在[Sonatype 博客](http://www.sonatype.com/people/?s=hudson+build+farm)中读到 Hudson 将与 Nexus 进行更多集成，我们不妨为未来的新增强功能做好准备。我还相信，当我设置并尝试它时，它更适合大型商业环境，因为您可以调整存储库管理器中的组以更加灵活 - 对于大量项目很有用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T09:57:29.023

我在 ClearCase 之外有一些 Maven 存储库，供一些第三方库参考。

但我从未将 Maven**与**ClearCase 一起使用，因为它们遵循不同的逻辑（Maven 需要文件的签名名称，例如 myfile-1.2.jar，而 ClearCase 只能存储 myfile.jar，并记录它的版本标记为 1.2）

[romaintaz](https://stackoverflow.com/questions/298228#298239)报告的[Maven2 ClearCase 插件](http://maven.apache.org/scm/clearcase.html)可能已经改变了这种情况，但是这个新产品中仍然存在一些错误，正如这个[线程](http://www.ibm.com/developerworks/forums/thread.jspa?messageID=14149440&#14149440)所示，当一个人在没有解开 pom 文件的情况下第二次运行它时。Maven 正在顺利完成结帐，但无论下一步是什么都无法完成。

```
INFO Checking out file: /opt/viewstore/common/maven/my_lf_ss/vobs/test_alm/LF_Build/pom.xml
INFO ERROR BUILD FAILURE
INFO INFO Unable to enable editing on the POM
Provider message:
The cleartool command failed.
Command output:
cleartool: Error: Element "/opt/viewstore/common/maven/my_lf_ss/vobs/test_alm/LF_Build/pom.xml" is already checked out to view "my_lf_ss". 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T09:23:18.703

我没有使用这个 SCM，但是有一个名为 SCM 的[Maven2 插件](http://maven.apache.org/scm/clearcase.html)可以处理 Clearcase。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T13:12:29.393

我有一个使用 Maven 2 构建的团队，并使用 Clearcase 作为版本控制系统。我们使用 Archiva 作为构建工件的存储库，因此开发团队不需要使用 SCM 插件。

但是，持续集成服务器是 Continuum，它依赖于 POM 中的 SCM 信息。我们遇到了 Clearcase SCM 使用分支策略抓取快照视图的问题。我的一位开发人员不得不调整 Clearcase SCM 代码以使其与我们的分支一起工作。在我们开始为他的修复做出贡献之前，我们都继续前进。

# java - String replace function

> ID：298231
> 
> 赞同：1
> 
> 时间：2008-11-18T09:20:29.520
> 
> 标签：java, string

I have following string

```
String str = "replace :) :) with some other string"; 
```

And I want to replace first occurance of `:)` with some other string

And I used `str.replaceFirst(":)","hi");`

it gives following exception

> "Unmatched closing ')'"

I tried using `replace` function but it replaced all occurance of `:)`.

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-18T09:23:47.080

The `replaceFirst` method takes a regular expression as its first parameter. Since `)` is a special character in regular expressions, you must quote it. Try:

```
str.replaceFirst(":\\)", "hi"); 
```

The double backslashes are needed because the double-quoted string also uses backslash as a quote character.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-18T09:26:16.730

The first argument to replaceFirst() is a regular expression, not just a character sequence. In regular expressions, the parantheses have special significance. You should escape the paranthesis like this:

```
str = str.replaceFirst(":\\)", "hi"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T09:23:50.277

[Apache Jakarta Commons](http://commons.apache.org/) are often the solution for this class of problems. In this case, I would have a look at [commons-lang](http://commons.apache.org/lang/), espacially [StringUtils.replaceOnce()](http://commons.apache.org/lang/api-2.3/org/apache/commons/lang/StringUtils.html#replaceOnce(java.lang.String,%20java.lang.String,%20java.lang.String)).

# svn - SVN Doubt - VMWARE Image / Install / Hosted 你会选择哪一个？

> ID：298235
> 
> 赞同：2
> 
> 时间：2008-11-18T09:20:59.940
> 
> 标签：svn, vmware, hosted

我对如何设置我的 SVN 东西有一些疑问。

首先是我的情况：程序员独自处理大多数事情，不需要外部访问（还）。

我想：

*   一个快速的 SVN，最好是免费的。
*   私人的
*   备份友好
*   有点无忧无虑
*   大量的存储。

我不想要：

*   将我的数据传输到另一个 comp / svn 安装时遇到问题。

我试过：Assembla 免费托管解决方案和其他一些免费托管解决方案，由于存储/项目限制，这些对我不起作用。

所以现在我有选择：

*   为 SVN 获取具有大量空间的共享主机。
*   只需将其安装在我的一个组合上（运行窗口）
*   将其安装在 vmware 映像上，这样可以更轻松地复制并可能简化备份过程。

在我的情况下你会怎么做，为什么？

编辑：

或者在这种情况下，GIT 是一个更好的选择，如果是，为什么？（请记住，我对这项技术没有经验）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T09:27:52.327

我会看看[VisualSVN Server](http://visualsvn.com/server/)。它可以在 Windows 上轻松安装并解决您的所有问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T09:38:39.390

安装到 VMWare 映像中意味着它可以在系统之间移植。只要您不需要从外部站点访问，我就会采用该解决方案。您可以使用预先构建的 VMWare 映像 [1] 或使用像 Ubuntu [2] 这样的 Linux 发行版非常简单地创建自己的映像。或者，您可以使用轻量级 Linux 解决方案[3][4] 并安装 SVN 运行所需的内容。

我个人在我家（即将搬到我的办公室）中设置了一台 Linux 服务器，用于托管我的 SVN 存储库 - 如果您可以牺牲一台旧机器，这是迄今为止最好的方法。

[1] [http://www.vmware.com/appliances/directory/308](http://www.vmware.com/appliances/directory/308)
[2] [https://help.ubuntu.com/8.10/serverguide/C/subversion.html](https://help.ubuntu.com/8.10/serverguide/C/subversion.html)
[3] [http://archlinux.org](http://archlinux.org)
[4] [http://damnsmalllinux.org](http://damnsmalllinux.org)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T09:44:51.747

我不是 SVN 专家，但我们是 windows 环境，我们最近切换到 SVN。

我们对（免费的）VisualSVn 服务器非常满意，它并没有做太多的事情，但确实使它对管理来说更像“windows”。

[http://www.visualsvn.com/server/](http://www.visualsvn.com/server/)

非常适合在这种环境中托管 - 就单独的 PC 或 vmware 映像而言 - 两者都可以工作；对于 windows 环境下的存储库备份，这有点痛苦，但我们使用了一些类似的东西：

[http://svn.haxx.se/users/archive-2007-07/0909.shtml](http://svn.haxx.se/users/archive-2007-07/0909.shtml)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T09:56:58.197

对于家庭项目，我使用的是[VisualSVN Server](http://www.visualsvn.com/server/)。它非常易于使用，而且设置非常简单，以至于我说服我的老板用它来替换 SourceSafe。从字面上看，它是在几分钟内设置好的。安全访问也轻而易举。[我们还从VisualSVN](http://www.visualsvn.com/visualsvn/)购买了 Visual Studio 插件，以允许我们直接从 IDE 提交和更新项目。这需要在客户端机器上安装[TortoiseSVN 。](http://tortoisesvn.tigris.org/)所有服务器配置都可以直接从 VisualSVN 管理控制台运行，该控制台也可以嵌入到 Windows 的计算机管理控制台中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T09:36:04.947

嗯，我敢打赌将它安装在您的机器上，在外部硬盘驱动器上。您将牺牲一点速度，但您将拥有存储空间（它有自己的 HDD）和备份友好性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T10:25:31.743

很抱歉给出您可能不想听到（阅读）的答案，但您的要求不只是大喊“ [GIT](http://git.or.cz/)！”吗？

它非常适合您只想使用版本控制系统而无需设置存储库的麻烦的情况。只是`git init`，你准备去...

# database-design - 名称值对和事实表

> ID：298251
> 
> 赞同：1
> 
> 时间：2008-11-18T09:31:05.143
> 
> 标签：database-design, entity-attribute-value, star-schema, fact-table, name-value

我正在研究用于分析已发布表单数据的星型模式。表单数据将发布到的站点实际上在托管表单的站点之外，因此只有表单中的数据可用。我将提供包含一些额外有用信息的选项，包括隐藏字段、原始推荐人、会话 ID 等。

我将能够使用正则表达式来匹配某些数据类型并将它们提取到特定维度，例如邮政编码。

我有一个解决维度的任意性质的解决方案，它不是一个很好的解决方案，但它会起作用。

我遇到的问题是我不知道我的事实表中会出现什么，它不像我可以聚合一个很好的数值。除了满足这些标准的“是的，有一个表单帖子”这一事实之外。

我想知道我是否以正确的方式处理这个问题？我是否使用了错误的工具来完成这项工作？还是我只是错过了什么？

西蒙。

更多细节：

有两个功能区域，根据标准过滤表单帖子，例如在两个时间戳之间。但就过滤而言，几乎所有东西都可以争夺。选定的表单帖子将用于生成 csv 文件以供导出。

另一个主要领域是分析，研究广告支出转化为客户线索是一个明显的起点。也有点开放式，取决于表单数据。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T17:24:17.250

您不是在设计星型模式。您正在设计一个[实体-属性-值](http://en.wikipedia.org/wiki/Entity-Attribute-Value_model)表，其中包含您要识别的所有问题。

如果你真的不知道你的数据会是什么样子，即存在哪些表单字段以及每个字段应该使用什么数据类型，那么关系数据库不是保存信息的正确工具。试试 XML、YAML 或 JSON。这些是结构化但动态的格式。您可以即时建立元数据。您可以将整个表单实例存储在文件中或数据库中的 BLOB 中。

另一种可以管理动态元数据的新兴技术是使用查询语言[SPARQL的](http://en.wikipedia.org/wiki/Resource_Description_Framework)[RDF](http://en.wikipedia.org/wiki/Resource_Description_Framework)。 [Sesame](http://www.openrdf.org/)是语义数据引擎的一个示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-03T22:51:27.647

没有测量的事实表是可以的——它们只是被称为“无事实的事实表”。但是您通常仍会在其中放置一个 row_count 列——即使它的值始终为 1——以轻松添加汇总表。您可能会在以后添加其他测量值 - 例如对术语情绪的测量。

而且我不会太担心这看起来不像是仓储 101 的例子——在很多极端情况下会发生奇怪的事情。您当然可以将 field_name 和 field_value 作为列，如果您没有 field_name，甚至可以只使用 field_value。这样可行。它提供了极大的灵活性。

但是你错过了一些重要的功能。由于给定的项目或对象实际上被拆分为多行 - 典型的 sql 过滤不会很好地工作。您通常需要将所有行拉入一个可以整体评估它们的小应用程序中 - 或者编写一些非常复杂的多步骤 sql，在其中将每行评估的布尔结果插入临时表，然后按 session_id 分组（或不管是什么），然后最终评估和/或逻辑。

另一种选择 - 走这条路，但逐渐开发您的 ETL 解析功能，以便随着时间的推移，您可以将其中的一些内容提取到更传统的维度中。也许这会成为您的暂存表或原始表，但您会尝试让大多数报告符合您更传统的星型模式。

最后一个选项 - 考虑一个非关系数据库。更面向文档的东西可能会为您提供更好的功能。

# c++ - ms c++获取当前进程的pid

> ID：298257
> 
> 赞同：31
> 
> 时间：2008-11-18T09:34:30.987
> 
> 标签：c++, windows, process, pid

我的应用程序的一部分是在 windows 下的 C++ 中。我需要当前进程的进程 ID。有什么想法吗？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-18T09:35:58.503

该[`GetCurrentProcessId`](http://msdn.microsoft.com/en-us/library/ms683180(VS.85).aspx)函数将执行此操作。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2015-01-28T03:05:48.980

我已经习惯了看到码码和码码来完成看似简单的任务，我对`GetCurrentProcessId`. 今天早些时候，我看到它在调试器中运行，当时我在例程中跟踪了一段新代码，该`DllMain`例程将进程 ID 与嵌入式 GUID 结合起来，为互斥体创建本地唯一名称。

以下是整个例程，所有三个机器指令。

```
mov         eax,fs:[00000018]
mov         eax,dword ptr [eax+20h]
ret 
```

顺便说一句，另外两个非常简单的 Windows API 函数是`GetLastError`和`SetLastError`; 确实，两者都与这个非常相似。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-09-06T18:04:57.133

您可以使用在库中定义的`getpid()`or 。`_getpid()``<process.h>`

[https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/getpid?view=vs-2019](https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/getpid?view=vs-2019)

# build-process - 寻找强大的构建管理系统

> ID：298259
> 
> 赞同：3
> 
> 时间：2008-11-18T09:34:53.000
> 
> 标签：build-process, build-automation

我的团队在开发一个中型产品，在单个双核机器上构建大约需要 2 个小时。作为提高生产力的努力的一部分，我正在寻找替代方案来改进我们的构建过程。

目前我们使用 VS2005 解决方案构建 C++ 代码和 .NET 代码，我们也有一些使用 makefile 构建的遗留代码，我们使用 installshield 打包产品。我们还有用 UnitTest++、Nunit、CPPUnit 编写的单元测试，以及一些我们自己编写的测试，没有任何测试框架。一切都由我们编写的一组 Perl 脚本协调。

我正在寻找一种产品、一套产品或一堆不相关的产品，它们可以让我执行以下操作：

1.  改善建造时间。我尝试使用 Incredibuild 并行化构建并取得了一些成功。我很乐意找到更多替代品（更便宜的？？？）

2.  改进构建过程定义。我需要一些东西来替换我们复杂的 perl 脚本，以使我能够轻松地定义构建过程。

3.  提高我们在构建中发现问题的能力（可能是一个用于查看构建输出、突出显示编译错误、收集构建时间和构建失败的统计数据等的 Web 界面。

4.  任何其他可以帮助我们改进构建管理的好功能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T09:42:39.350

考虑 NAnt：[http ://nant.sourceforge.net/，CruiseControl：](http://nant.sourceforge.net/) [http](http://en.wikipedia.org/wiki/CruiseControl) : //en.wikipedia.org/wiki/CruiseControl ，以及更快的构建系统。有一些 .NET 相关链接位于：[http ://confluence.public.thoughtworks.org/dashboard.action](http://confluence.public.thoughtworks.org/dashboard.action)

编辑：[Gradle](http://gradle.org/)可能是现在最好的选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T09:45:28.080

试试[FinalBuilder](http://www.finalbuilder.com/)，它是一个非常全面的构建管理工具

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-18T09:05:27.090

几年前，我在以前的工作中使用了[Automated QA 的 Automated Build Studio ，它非常好而且相当便宜。](http://www.automatedqa.com/products/abs/index.asp)从那以后我没有使用它，所以我只是建议你看看它。

如果您订阅了 MSDN，则应该查看 TFS。TFS Build 非常健壮，并集成到 Visual Studio 中，并与 Team System/TFS 源代码控制一起工作（您没有说您使用的是什么源代码控制）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T04:06:37.420

萨金，

我认为您可能正在寻找两种不同的工具——尽管有时您会发现它们打包在一起。

一种工具是构建管理系统，它可以安排构建、显示输出、收集统计数据等。FinalBuilder、CruiseControl 和[AnthillPro](http://www.anthillpro.com)等工具在该领域发挥作用。

另一种工具是将您的构建拆分为可并行化的部分并加速构建的工具。[Incredibuild](http://www.xoreax.com/main.htm)在这方面做得非常好，而且肯定比一些替代品便宜。一些开源工具（如 gmake）内置了免费选项，但我的理解是，您需要做一些非常认真的工作才能使其与解决方案文件一起使用。

你应该可以随意混搭。我们有客户将 Anthill 与 Incredibuild、gmake 和许多其他构建加速工具一起使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T04:16:55.543

我们有一个类似于你的过程，虽然它不是一个 VS 项目。直到最近，我们还使用 perl 脚本和 tinderbox 来构建和跟踪构建和单元测试的状态。我们最近跳到了哈德逊，它似乎工作得很好。

[https://hudson.dev.java.net/](https://hudson.dev.java.net/)

不要被 java 标签吓到，我们的项目是 c/c++ 并且工作正常。Hudson 可以执行 shell 命令，因此我们可以构建我们的项目（makefile）并正常运行我们的单元测试。现在我们将它设置为定时构建，当它完成时（如果成功）并行启动我们所有的单元测试。

这是一个很棒的系统，如果它是你正在寻找的，值得一试。它记录控制台输出并拥有大量出色的插件（日志和图表警告计数、磁盘空间使用大小、基于 CM 更改的构建）和一个供团队观看的漂亮 Web 界面。

哦，是的，它是免费的。。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-07T05:15:29.110

我不会建议哈德森 .. 没有必要吹嘘它..

哈德森是有限的工具，除了它可以做更多的事情并拥有更好的bui8lt核心架构

使用 anthillpro 和 incredibuild 的建议很好！

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-01-07T05:21:29.457

关于“Hudson 有广泛的插件.. 等等等等”，它真的是一个骗局..

hudson 无法实现的是它作为插件实现的核心架构

令人惊讶的是，如果我必须屏蔽密码或任何凭据，如果没有“密码屏蔽”插件，我将无法做到这一点..

理想情况下，如果一个系统是“企业可扩展的”，那么这个掩码应该内置到它的核心中

这只是一个例子..我对这些工具有清晰的分析，但无法在此处上传文档

移动到另一边

哈德森“外观和感觉”“漂亮可爱”并且重量相对较轻

# c# - 事件处理程序会阻止垃圾收集的发生吗？

> ID：298261
> 
> 赞同：193
> 
> 时间：2008-11-18T09:35:33.233
> 
> 标签：c#, .net, event-handling, garbage-collection

如果我有以下代码：

```
MyClass pClass = new MyClass();
pClass.MyEvent += MyFunction;
pClass = null; 
```

pClass 会被垃圾回收吗？或者它是否会在事件发生时仍然触发它的事件？为了允许垃圾收集，我需要执行以下操作吗？

```
MyClass pClass = new MyClass();
pClass.MyEvent += MyFunction;
pClass.MyEvent -= MyFunction;
pClass = null; 
```

* * *

## 回答 #1

> 赞同：226
> 
> 时间：2008-11-18T09:43:27.147

对于具体问题“PClass 是否会被垃圾回收”：事件订阅对 pClass 的收集没有影响（作为发布者）。

对于一般的 GC（特别是目标）：这取决于 MyFunction 是静态的还是基于实例的。

实例方法的委托（例如事件订阅）包括对实例的引用。所以是的，事件订阅将阻止 GC。但是，一旦发布事件的对象（上面的 pClass）符合收集条件，这将不再是问题。

请注意，这是单向的；即如果我们有：

```
publisher.SomeEvent += target.SomeHandler; 
```

那么“发布者”将使“目标”保持活动状态，但“目标”不会让“发布者”保持活动状态。

所以不：如果无论如何都要收集 pClass，则无需取消订阅侦听器。但是，如果 pClass 是长期存在的（比具有 MyFunction 的实例长），那么 pClass 可以使该实例保持活动状态，因此如果您希望收集目标，*则*必须取消订阅。

然而，由于这个原因，静态事件在与基于实例的处理程序一起使用时非常危险。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-18T09:49:23.563

是的，`pClass`将被垃圾收集。事件订阅并不意味着存在对 的任何引用`pClass`。

所以不，您不必为了`pClass`垃圾收集而分离处理程序。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-18T10:55:37.097

当一块内存不再被引用时，它就成为垃圾回收的候选对象。当您的类的实例超出范围时，您的程序将不再引用它。它不再使用，因此可以安全地收集。

如果您不确定是否会收集某些东西，请问自己以下问题：是否仍然存在对它的引用？事件处理程序由对象实例引用，而不是相反。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-07T13:31:51.600

`pClass`将被垃圾收集。但是，如果上面的代码片段在另一个类中，如果您不设置`pClass`为，则该类的实例可能不会被清除`null`。

# c# - 如何验证我的 LINQ-to-SQL 模型是否与数据库架构匹配？

> ID：298270
> 
> 赞同：2
> 
> 时间：2008-11-18T09:42:08.553
> 
> 标签：c#, sql-server, linq-to-sql

我是 .NET 世界的新手，从星期五开始使用 C#。不过，我对数据库应用程序有一些经验。

对于中等规模的项目，我们将使用 LINQ-to-SQL。我习惯于从类生成我的模式，并使用颠覆和 Ruby 迁移等价物来跟踪更改。显然，使用 LINQ本身[没有简单的方法可以做到这一点。](https://stackoverflow.com/questions/29145/generating-database-tables-from-object-definitions)

[所以我想用Castle Project 的 ActiveRecord](http://www.castleproject.org/activerecord/index.html)生成模式（并进行一些数据访问），并使用[Migrator.NET](http://code.google.com/p/migratordotnet/) [Tarantino](http://code.google.com/p/tarantino/wiki/DatabaseChangeManagement)或[dbdeploy.net](http://sourceforge.net/projects/dbdeploy-net/)进行模式更新。（对此有什么建议吗？）

我的主要问题是：**如何验证我的 LINQ 类仍然与数据库模式匹配？如果架构不匹配，LINQ 会抛出异常吗？我可以遍历所有 LINQ 类并调用一些验证方法吗？**

我已经发现[sqlmetal 是重新生成类的方法](https://stackoverflow.com/questions/40022/best-way-to-update-linq-to-sql-classes-after-database-schema-change)。

PS：我们将使用 SQL Server（2008 或 2005）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T09:59:36.023

这个[工具](http://blog.huagati.com/res/index.php/2008/07/17/tools-part-2-add-ins-dbml-synchronization-add-in-updated/)将帮助同步它们，但我不确定它是否会显示差异......不过可能会有一些用处。（：

编辑：正如[KristoferA](https://stackoverflow.com/users/11241/kristofera)在他的评论中所说，它确实支持比较（： - 感谢 KristoferA。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T08:52:22.477

至于：

> 我习惯于从类生成我的模式并跟踪更改

[我刚刚在Huagati DBML/EDMX Tools](http://www.huagati.com/dbmltools/)（版本 1.47，今天发布）中添加了 DDL 生成功能。它可以生成[DDL 差异脚本](http://blog.huagati.com/res/index.php/2008/11/21/tools-part-6-add-ins-model-first-in-linq-to-sql-and-entity-framework/)，以防您已将内容添加到 Linq-to-SQL 设计器但尚未将它们添加到数据库中。

# c# - 新的“动态”C# 4.0 关键字是否会弃用“var”关键字？

> ID：298277
> 
> 赞同：27
> 
> 时间：2008-11-18T09:43:40.690
> 
> 标签：c#, c#-4.0, dynamic-languages

[当 C# 4.0 出现时，我们有了Anders Hejlsberg 的精彩演讲](http://channel9.msdn.com/pdc2008/TL16/)中所描述的 dynamic 关键字，（C# 的发展速度比我跟上的要快。我没有太多时间来熟悉 var 关键字）

我还需要 var 关键字吗？有什么 var 可以做的..动态不能做的吗？

```
var x = SomeFunctionThatIKnowReturnsSomeKindOfList();
// do something with x

dynamic x = SomeFunctionThatIKnowReturnsSomeKindOfList();
// do something with x 
```

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-11-18T09:52:13.557

不，它们非常不同。

`var`意思是“在编译时推断变量的类型”——但它仍然完全是静态绑定的。

`dynamic`意思是“假设我可以用这个变量做任何我想做的事”——即编译器不知道有哪些操作可用，DLR 将在执行时计算出调用的*真正*含义。

我希望`dynamic`很少使用 - 只有当我真正想要动态行为时：

*   `var`让您在编译时捕获拼写错误等
*   静态绑定的代码总是比动态绑定的代码运行得更快（即使差异变得相当小）
*   静态绑定代码提供了更多的编译时支持，而不仅仅是错误：您可以找到调用层次结构，重构会更好，Intellisense 可用等

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-18T09:53:33.993

dynamic 和 var 代表了两种完全不同的想法。

**变量**

Var 本质上是要求编译器根据赋值语句右侧的表达式来确定变量的类型。然后该变量被完全视为就好像它被显式声明为表达式的类型一样。例如以下两个语句是等价的

```
var a = "foo";
string a = "foo"; 
```

这里要带走的关键是“var”是 100% 类型安全的，并且是编译时操作

**动态的**

动态在许多方面与 var 完全相反。使用动态本质上消除了特定变量的所有类型安全性。它在很多方面都没有类型。当您调用变量上的方法或字段时，如何调用该字段的决定发生在运行时。例如

```
dynamic d = SomeOperation();
d.Foo(); // Will this fail or not?  Won't know until you run the program 
```

这里要带走的关键是“动态”不是类型安全的，并且是运行时操作

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T09:55:14.707

是的，你仍然需要 var：

**Var**是一个*变量*，其类型将由编译器推断。
**动态**将在运行时分配其类型

所以：

```
Var i = "Hello World" 
```

这样做会将其类型推断为字符串类型，因此智能将为您提供字符串可以使用的所有方法，例如，

```
i.Split("/") 
```

然而：

```
dynamic i = "Hello World" 
```

直到运行时才会推断出它的类型，因为编译器还不知道它是什么类型，但仍然会让你这样做：

```
i.Split("/") 
```

但是当它调用您需要的方法时，它可能会失败，因为类型错误并且方法不存在。

# c# - 可以通过索引和键访问的内置列表

> ID：298281
> 
> 赞同：4
> 
> 时间：2008-11-18T09:47:15.737
> 
> 标签：c#, dictionary, list

是否可以创建一个可以通过索引或键访问的列表？

*我正在寻找一个已经存在但具有此功能的 Collection 类型，我想避免重新定义索引器*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T10:06:59.863

现有答案已经展示了如何添加您自己的索引器。

您可能想查看一些现有的基于键的集合，例如`SortedList<,>`，它的作用类似于`Dictionary<,>`，但允许使用键和位置索引器。

此外 - 您应该能够对大部分此类事情使用继承 - 例如，从`Collection<>`or继承`List<>`。请注意，如果您的集合实现`IList`/ `IList<T>`，我不推荐以下（我偶尔会看到）：

```
public SomeType this[int someId] {...} 
```

关键是，人们期望 an 的整数索引器`IList[<T>]`是位置的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T14:55:41.620

What [is the best data structure in .NET for lookup by string key or numeric index？](https://stackoverflow.com/questions/137753/what-is-the-best-data-structure-in-net-for-look-up-by-string-key-or-numeric-ind).

看看[KeyedCollection](http://msdn.microsoft.com/en-us/library/ms132438.aspx)：

```
class IndexableDictionary<TKey, TItem> : KeyedCollection<TKey, TItem>
 { Dictionary<TItem, TKey> keys = new Dictionary<TItem, TKey>();

   protected override TKey GetKeyForItem(TItem item) { return keys[item];}

   public void Add(TKey key, TItem item) 
    { keys[item] = key;
      this.Add(item);
    }
 } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T10:05:01.177

System.Collections.Specialized.NameValueCollection 可以做到这一点，但它只能将字符串存储为值。

```
 System.Collections.Specialized.NameValueCollection k = 
        new System.Collections.Specialized.NameValueCollection();

    k.Add("B", "Brown");
    k.Add("G", "Green");

    Console.WriteLine(k[0]);    // Writes Brown
    Console.WriteLine(k["G"]);  // Writes Green 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T09:55:53.753

```
public object this[int index]
{
    get { ... }
    set { ... }
} 
```

除了只做一个整数索引，您还可以提供您喜欢的任何其他类型的键

```
public object this[String key]
{
    get { ... }
    set { ... }
} 
```

如果您不想定义自己的集合，只需继承 from `List<T>`，或者只使用 type 的变量`List<T>`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T09:54:27.767

您可以通过将以下属性添加到您的集合来添加索引器：

```
public object this[int index]
{
    get { /* return the specified index here */ }
    set { /* set the specified index to value here */ }
} 
```

这可以通过键入*indexer*并按 [tab] [tab] 在 Visual Studio 中快速添加。

返回类型和索引器类型当然可以更改。您还可以添加多个索引器类型。

# asp.net - 限制由 sqldatasource 返回的记录，在 where 子句中使用会话变量

> ID：298286
> 
> 赞同：1
> 
> 时间：2008-11-18T09:50:25.653
> 
> 标签：asp.net

我有一个 Web 应用程序，它在后端有一个 Sql Server 数据库。由于站点将部署到不同的客户端（或 IIS 中的不同虚拟目录），因此站点的每个客户端派生都将使用相同的后端。

有一个管理页面，可以更改网站上的文本（在列表视图中输入文本，然后选择页面以选择该文本将显示的位置，您还可以在其他列表视图中查看公司特定的详细信息。因为这是共享数据库，这意味着客户端可以看到彼此的数据。

我想做的是存储accountId（从login_authenticate从数据库返回的guid），并将其粘贴到会话中。然后我在管理页面上检索它，我想使用这个值（但它总是 0000-0000 等）来限制列表视图中返回的记录。

有这样的例子吗？另外，我如何设置默认值（这是在 SqlDataSource 的 where 子句中），以编程方式设置帐户 ID 是什么（所以我可以给我所有记录 = 当前帐户 ID 是什么，或者登录名是什么 -这存储在帐户表中）。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T20:39:17.120

这是我尝试过的。

但是，我感到困惑的是，在使用会话对象时，where 子句是获取我编写的代码以从会话中检索的对象，还是我只添加但未检索到的对象。我在登录时获得了 accountID（通过介入验证 - 显然 - 否则登录将失败）。

当我刚刚检索到 accountid 变量时，我将再次尝试将对象存储在 session @ 登录页面中，然后在另一个页面上检索它。

出于某种原因，我一直得到 0，所以我会在我的应用程序中查看这个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T10:52:31.860

听起来你的方法应该有效。我会遵循一个调试过程：

1.  检查您是否从数据库中获取 accountID 值。第一次检索值后立即在屏幕上打印。
2.  如果这有效，请将值存储在 Session 中并立即检索它，并检查您是否正在获取该值。
3.  创建 2 个测试页面，一个用于设置 Session 变量，另一个用于检索它。

我知道这似乎很基本，但是在上述三个地方的某个地方引入了失败。如果您能找到哪个步骤失败，您将能够修复它。

# html - 使图片在图层中水平居中

> ID：298288
> 
> 赞同：1
> 
> 时间：2008-11-18T09:52:23.853
> 
> 标签：html, css

我有以下代码

```
<html>
<head>
<title>Test</title>
<style type="text/css">

<!--

body,td,th {

    color: #FFFFFF;

}

body {

    background-color: #000000;

}

#Pictures {

    position:absolute;

    width:591px;

    height:214px;

    z-index:1;

    left: 17%;

    top: 30%;

    text-align:center;

}

#Links {

    width:600px;

    height:30px;

    z-index:2;

    top: 184px;

    font-family: "Broadway", Broadway, monospace;

    font-size: 14px;

    color: #FFFFFF;

    text-align: center;

}

.links2 {

    font-family: Broadway;

    color: #FFFFFF;

    text-decoration: none;

}

a:links2, a:visited {

    color: #ffffff;

}

a:hover, a:active {

    color: #333333;

}

#Main {

    position:absolute;

    width:800px;

    height:600px;

    z-index:2;

    left: 15%;

    top: 10%;

    right: 15%;

    border-top-style: none;

    border-right-style: none;

    border-bottom-style: none;

    border-left-style: none;

}

#Logo {

    position:absolute;

    float: left;

    width:104px;

    height:100px;

    z-index:2;

}

</style>

</head>

<body>

<div id="Main">

<div id="Pictures">

<div>

<a href="1.html" ><img src="1.gif" alt="x" width="181" height="173" border="0" /></a>

<a href="1.html" class="links2">1</a>

</div>

<div>

<a href="2.html" class="links2"><img src="2.gif" alt="x" width="181" height="173" border="0" align="top" /></a>

<a href="2.html" class="links2">2</a>

</div>

<div>

<a href="3.html" class="links2"><img src="3.gif" alt="3" width="181" height="173" border="0" /></a>

<a href="3.html" class="links2">3</a> 

</div>

</div>

</div>

<div id="Logo"><img src="logo.gif" alt="x" width="104" height="100" border="0"/></div>

</div>

</body>

</html> 
```

这是垂直显示图片层。

我正在尝试使 3 张图像与下方居中的文本水平对齐。为什么他们默认为垂直，我可以改变这种行为吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T10:30:29.737

你实际上并不需要那么多代码来实现你所追求的。例如：

```
<style>
body {
background-color: #000;
color: #FFF;
}
a {
font-family: "Broadway", Broadway, monospace;
font-size: 14px;
color: #FFF;
}
#images a {
width: 24.99%;
display: block;
float: left;
text-align: center;
}
</style>

<div id="images">
<a href="1.html" >
    <img src="1.gif" alt="x" width="181" height="173" border="0" /><br />
    One
</a>
<a href="2.html" >
    <img src="2.gif" alt="x" width="181" height="173" border="0" /><br />
    Two
</a>
<a href="3.html" >
    <img src="3.gif" alt="x" width="181" height="173" border="0" /><br />
    Three
</a>
<a href="4.html" >
    <img src="4.gif" alt="x" width="181" height="173" border="0" /><br />
    Four
</a>
</div> 
```

使项目水平而不是垂直对齐的技巧是“浮动”容器（左或右）。通过设置要显示的链接：block; 您可以将它们用作容器，而不是将所有内容都包装在额外的 <div> 中。我已将宽度设置为 25%（或 24.99% 以避免某些浏览器中的舍入错误），以便它们在页面上均匀分布，但您可能需要使用边距/填充和/或轻松完成的不同对齐方式容器上的不同宽度。另请注意，当您在 body {} 上设置文本颜色时，您无需在除链接之外的其他地方再次指定它。字体系列也是如此，尽管这也由链接继承。祝项目顺利！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T10:35:02.880

查看这段代码并对其进行测试：您可以以更高效、语义和简洁的方式做同样的事情：

CSS：

```
div.imageBox {
  float: left;
  margin-right: 10px;
  }

div.imageBox p {
   text-align: center;
   } 
```

html:

```
<div class="imageBox">
  <a href="#">
  <img src="image1.gif" width="100" height="100"
  alt="image 1" /></a>
  <p><a href="#">1</a></p>
</div>

<div class="imageBox">
  <a href="#">
  <img src="image2.gif" width="100" height="100"
  alt="image 1" /></a>
  <p><a href="#">2</a></p>
</div>

<div class="imageBox">
  <a href="#">
  <img src="image3.gif" width="100" height="100"
  alt="image 1" /></a>
  <p><a href="#">3</a></p>
</div> 
```

这就是你所需要的！

* * *

如果你想保留你的代码，没有理由在 img 标签内使用属性 align。您可以使用 span 代替 div，但在这种情况下，最好继续使用 div 并给它们一个宽度：

```
div#Pictures div

    {
       float: left;
       margin-right: 5px;
    } 
```

这段代码：

```
a:links2 
```

没有意义。links2 是您制作的类，而不是伪类或伪元素。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T10:01:48.203

我认为`display: block;`你的`links2`班级应该正确地将链接放在图像下。

此外，要使图像水平排列，请在“图片”div 中使用`<span>`s 而不是s，并将它们向左浮动。`<div>`

```
#Pictures span
{
   float: left;
   margin-right: 5px;
} 
```

# c# - 如何向 LINQ 查询的结果添加其他对象？

> ID：298289
> 
> 赞同：0
> 
> 时间：2008-11-18T09:52:37.113
> 
> 标签：c#, linq-to-sql

我有以下代码，我需要在从数据库中检索结果后添加一个附加对象。关于我如何做到这一点的任何想法？

```
 public IEnumerable<ProdPriceDisplay> GetShopProductsPrices()
{

    //ProdPriceDisplay ProdPrice = new ProdPriceDisplay();
    var Products = from shop in db.SHOPs
                   select new ProdPriceDisplay
                   {
                       ProdPrice = shop.S_NAME + " - £" + shop.S_PRICE
                   };

    // *** Want to add something like this:-

    //  Products.Add new ProdPriceDisplay { ProdPrice = "some additional text"; }

    return Products;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T10:00:44.353

使用[`Enumerable.Concat`](http://msdn.microsoft.com/en-us/library/bb302894.aspx)：

```
public IEnumerable<ProdPriceDisplay> GetShopProductsPrices()
{
    var products = from shop in db.SHOPs
                   select new ProdPriceDisplay
                   {
                       ProdPrice = shop.S_NAME + " - £" + shop.S_PRICE
                   };

    return products.AsEnumerable()
                   .Concat(new [] { new ProdPriceDisplay 
                           { ProdPrice = "some additional text"; });
} 
```

与转换为列表相比，这样做的好处是结果仍然是流式传输的，因此您最终不会获取数据的完整副本。

编辑：如果你愿意，你可以使用而不是数组 - 但没有太多好处。[`Enumerable.Repeat`](http://msdn.microsoft.com/en-us/library/bb348899.aspx) `(new ProdPriceDisplay { ... }, 1)`

编辑：我添加了[`AsEnumerable()`](http://msdn.microsoft.com/en-us/library/bb335435.aspx)基本上说的调用，“此时，我们不想在数据库中执行其余操作 - 将它们设为本地。”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T09:57:01.707

这可能是一个解决方案；

```
var productsAsList = Products.ToList();
productsAsList.Add(new ProdPriceDisplay { ProdPrice = "some additional text"; });

return productsAsList; // As your return type is IEnumarable, that won't be a problem; 
```

# windows - 从 Windows 批处理脚本中的文件读取值

> ID：298292
> 
> 赞同：10
> 
> 时间：2008-11-18T09:54:13.337
> 
> 标签：windows, file, scripting, batch-file

我正在尝试从文件中读取一个值并在后续命令中使用它。

我有一个名为的文件`AppServer.pid`，其中包含我的应用服务器的进程 ID（只是数字，它不是属性文件或类似的东西）。

应用服务器挂起，所以我想取这个值并将其传递给 kill 命令。所以我的脚本会是这样的

```
SET VALUE_FROM_FILE=AppServer.pid # or something
taskkill /pid %VALUE_FROM_FILE% /f 
```

在 Windows 脚本中是否有方便的方法来执行此操作？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-18T10:45:00.923

这有效：

```
SET /P VALUE_FROM_FILE= < AppServer.pid
taskkill /pid %VALUE_FROM_FILE% /f 
```

与 SET 一起使用的 /P 参数允许您使用来自用户的输入（或者在这种情况下，来自文件的输入）设置参数的值

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T10:26:25.097

```
for /f %%G in (appid.txt) do (SET PID=%%G)
echo %PID%
taskkill etc here... 
```

这可能会有所帮助！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-07-19T00:40:12.830

如果您知道从 command 返回的进程的名称`tasklist`，那么您可以`taskkill`在进程名称上使用过滤器运行，即`/FI IMAGENAME eq %process_name%`.

例如，要杀死所有名为`nginx.exe`run 的进程：

```
 taskkill /F /FI "IMAGENAME eq nginx.exe" 
```

`/F`其中“以英文阅读”：杀死与过滤器`/FI`“IMAGENAME 等于 nginx.exe”匹配的所有任务（如果需要，通过 强制执行）。

# algorithm - 轮盘选择算法

> ID：298301
> 
> 赞同：22
> 
> 时间：2008-11-18T09:56:00.447
> 
> 标签：algorithm, genetic-algorithm, evolutionary-algorithm, roulette-wheel-selection

任何人都可以为轮盘赌选择功能提供一些伪代码吗？我将如何实现这个：我真的不明白如何阅读这个数学符号。我想要通用算法。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-11-26T14:06:31.217

其他答案似乎是假设您正在尝试实施轮盘赌游戏。我认为您是在询问进化算法中的轮盘赌选择。

下面是一些实现轮盘选择[的 Java 代码。](https://github.com/dwdyer/watchmaker/blob/master/framework/src/java/main/org/uncommons/watchmaker/framework/selection/RouletteWheelSelection.java)

假设您有 10 个项目可供选择，并且您通过生成 0 到 1 之间的随机数进行选择。您将 0 到 1 的范围划分为十个不重叠的段，每个段与十个项目之一的适应度成正比。例如，这可能如下所示：

```
0 - 0.3 is item 1
0.3 - 0.4 is item 2
0.4 - 0.5 is item 3
0.5 - 0.57 is item 4
0.57 - 0.63 is item 5
0.63 - 0.68 is item 6
0.68 - 0.8 is item 7
0.8 - 0.85 is item 8
0.85 - 0.98 is item 9
0.98 - 1 is item 10 
```

这是您的轮盘赌。您在 0 和 1 之间的随机数是您的旋转。如果随机数是 0.46，那么选择的项目是项目 3。如果是 0.92，那么它是项目 9。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-03-15T17:35:26.823

这是一些python代码：

```
def roulette_select(population, fitnesses, num):
    """ Roulette selection, implemented according to:
        <http://stackoverflow.com/questions/177271/roulette
        -selection-in-genetic-algorithms/177278#177278>
    """
    total_fitness = float(sum(fitnesses))
    rel_fitness = [f/total_fitness for f in fitnesses]
    # Generate probability intervals for each individual
    probs = [sum(rel_fitness[:i+1]) for i in range(len(rel_fitness))]
    # Draw new population
    new_population = []
    for n in xrange(num):
        r = rand()
        for (i, individual) in enumerate(population):
            if r <= probs[i]:
                new_population.append(individual)
                break
    return new_population 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-12-12T04:51:08.203

首先，生成您分配的百分比数组，`p[1..n]` 假设总数是所有百分比的总和。

然后得到一个介于 1 到总数之间的随机数，比如说`r`

现在，lua中的算法：

```
local  c  =  0
for i = 1,n do
    c = c + p[i]
    if r <= c then
        return i
    end
end 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-18T10:01:07.237

有两个步骤：首先创建一个包含轮子上所有值的数组。这可以是一个带有颜色和数字的二维数组，或者您可以选择将 100 添加到红色数字。

然后简单地生成一个介于 0 或 1 之间的随机数（取决于您的语言是从 0 还是 1 开始对数组索引进行编号）和数组中的最后一个元素。

大多数语言都有内置的随机数函数。在 VB 中，`VBScript`函数是`RND()`. 在 Javascript 中是`Math.random()`

从数组中的该位置获取值，您就有了随机轮盘赌号码。

**最后一点**：不要忘记播种随机数生成器，否则每次运行程序时都会得到相同的抽奖序列。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-03-23T03:22:01.550

这是使用 Java 中的流选择的一种非常快速的方法。它使用值作为权重来选择数组的索引。[由于数学特性](http://gregable.com/2007/10/reservoir-sampling.html)，不需要累积权重。

```
static int selectRandomWeighted(double[] wts, Random rnd) {
    int selected = 0;
    double total = wts[0];

    for( int i = 1; i < wts.length; i++ ) {
        total += wts[i];            
        if( rnd.nextDouble() <= (wts[i] / total)) selected = i;
    }

    return selected;        
} 
```

如果数组太大而无法立即初始化，则可以使用[Kahan 求和](http://en.wikipedia.org/wiki/Kahan_summation)或将双打作为可迭代读取来进一步改进。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-03-23T02:47:09.213

我也想要同样的东西，所以创建了这个独立的轮盘赌类。你给它一系列权重（以双数组的形式），它会根据加权随机选择从该数组中简单地返回一个索引。

我创建了一个类，因为你可以通过构造函数只进行一次累积加法来获得很大的速度。它是 C# 代码，但享受 C 一样的速度和简单性！

```
class Roulette
{
    double[] c;
    double total;
    Random random;

    public Roulette(double[] n) {
        random = new Random();
        total = 0;
        c = new double[n.Length+1];
        c[0] = 0;
        // Create cumulative values for later:
        for (int i = 0; i < n.Length; i++) {
            c[i+1] = c[i] + n[i];
            total += n[i];
        }
    }

    public int spin() {
        double r = random.NextDouble() * total;     // Create a random number between 0 and 1 and times by the total we calculated earlier.
        //int j; for (j = 0; j < c.Length; j++) if (c[j] > r) break; return j-1; // Don't use this - it's slower than the binary search below.

        //// Binary search for efficiency. Objective is to find index of the number just above r:
        int a = 0;
        int b = c.Length - 1;
        while (b - a > 1) {
            int mid = (a + b) / 2;
            if (c[mid] > r) b = mid;
            else a = mid;
        }
        return a;
    }
} 
```

初始权重由您决定。也许它可能是每个成员的适应度，或者与成员在“前 50 名”中的位置成反比的值。例如：第 1 名 = 1.0 权重，第 2 名 = 0.5，第 3 名 = 0.333，第 4 名 = 0.25 权重等等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-08-16T09:48:31.360

您可以使用这样的数据结构：

```
Map<A, B> roulette_wheel_schema = new LinkedHashMap<A, B>() 
```

其中 A 是一个整数，表示**轮盘赌的一个口袋**，B 是**一个索引，用于识别种群中的一条染色体**。口袋的数量与每条染色体的适应度成正比：

*口袋数 =（适应度成比例）·（比例因子）*

然后我们生成一个介于 0 和选择模式大小之间的随机数，并使用这个随机数从轮盘赌中获得染色体的索引。

我们计算每条染色体的适应度比例与被选择方案选择的概率之间的相对误差。

***getRouletteWheel***方法返回基于先前数据结构的选择方案。

```
private Map<Integer, Integer> getRouletteWheel(
        ArrayList<Chromosome_fitnessProportionate> chromosomes,
        int precision) {

    /*
     * The number of pockets on the wheel
     * 
     * number of pockets in roulette_wheel_schema = probability ·
     * (10^precision)
     */
    Map<Integer, Integer> roulette_wheel_schema = new LinkedHashMap<Integer, Integer>();
    double fitness_proportionate = 0.0D;
    double pockets = 0.0D;
    int key_counter = -1;
    double scale_factor = Math
            .pow(new Double(10.0D), new Double(precision));
    for (int index_cromosome = 0; index_cromosome < chromosomes.size(); index_cromosome++){

        Chromosome_fitnessProportionate chromosome = chromosomes
                .get(index_cromosome);
        fitness_proportionate = chromosome.getFitness_proportionate();
        fitness_proportionate *= scale_factor;
        pockets = Math.rint(fitness_proportionate);
        System.out.println("... " + index_cromosome + " : " + pockets);

        for (int j = 0; j < pockets; j++) {
            roulette_wheel_schema.put(Integer.valueOf(++key_counter),
                    Integer.valueOf(index_cromosome));
        }
    }

    return roulette_wheel_schema;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-26T13:41:40.813

好吧，对于美式轮盘，您需要生成一个介于 1 到 38 之间的随机整数。有 36 个数字，一个 0 和一个 00。

不过，要考虑的一件大事是，在美式轮盘赌中，可以进行许多不同的赌注。一次投注可以覆盖 1、2、3、4、5、6、两个不同的 12 或 18。您可能希望创建一个列表列表，其中每个数字都有额外的标志以简化它，或者在编程中完成所有操作.

如果我在 Python 中实现它，我只需创建一个 0、00 和 1 到 36 的元组，并为每次旋转使用 random.choice()。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-05-07T09:16:32.973

这假设某个类“分类器”只有一个字符串条件、字符串消息和双重强度。只要按照逻辑。

——保罗

```
public static List<Classifier> rouletteSelection(int classifiers) {
    List<Classifier> classifierList = new LinkedList<Classifier>();
    double strengthSum = 0.0;
    double probabilitySum = 0.0;

    // add up the strengths of the map
    Set<String> keySet = ClassifierMap.CLASSIFIER_MAP.keySet();
    for (String key : keySet) {
        /* used for debug to make sure wheel is working.
        if (strengthSum == 0.0) {
        ClassifierMap.CLASSIFIER_MAP.get(key).setStrength(8000.0);
        }
         */
        Classifier classifier = ClassifierMap.CLASSIFIER_MAP.get(key);
        double strength = classifier.getStrength();
        strengthSum = strengthSum + strength;
    }
    System.out.println("strengthSum: " + strengthSum);

    // compute the total probability. this will be 1.00 or close to it.
    for (String key : keySet) {
        Classifier classifier = ClassifierMap.CLASSIFIER_MAP.get(key);
        double probability = (classifier.getStrength() / strengthSum);
        probabilitySum = probabilitySum + probability;
    }
    System.out.println("probabilitySum: " + probabilitySum);

    while (classifierList.size() < classifiers) {
        boolean winnerFound = false;
        double rouletteRandom = random.nextDouble();
        double rouletteSum = 0.0;

        for (String key : keySet) {
            Classifier classifier = ClassifierMap.CLASSIFIER_MAP.get(key);
            double probability = (classifier.getStrength() / strengthSum);
            rouletteSum = rouletteSum + probability;
            if (rouletteSum > rouletteRandom && (winnerFound == false)) {
                System.out.println("Winner found: " + probability);
                classifierList.add(classifier);
                winnerFound = true;
            }
        }
    }
    return classifierList;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-10-19T20:25:28.563

我编写了一个类似于 Dan Dyer 的 Java 代码（前面提到过）。然而，我的轮盘赌根据概率向量（输入）选择单个元素并返回所选元素的索引。话虽如此，如果选择大小是单一的并且您不假设如何计算概率并且允许零概率值，则以下代码更合适。该代码是独立的，包括一个带有 20 轮旋转的测试（运行）。

```
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Random;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 * Roulette-wheel Test version.
 * Features a probability vector input with possibly null probability values.
 * Appropriate for adaptive operator selection such as Probability Matching 
 * or Adaptive Pursuit, (Dynamic) Multi-armed Bandit.
 * @version October 2015.
 * @author Hakim Mitiche
 */
public class RouletteWheel {

/**
 * Selects an element probabilistically.  
 * @param wheelProbabilities elements probability vector.
 * @param rng random generator object
 * @return selected element index
 * @throws java.lang.Exception 
 */
public int select(List<Double> wheelProbabilities, Random rng) 
        throws Exception{

    double[] cumulativeProba = new double[wheelProbabilities.size()];
    cumulativeProba[0] = wheelProbabilities.get(0);
    for (int i = 1; i < wheelProbabilities.size(); i++)
    {
        double proba = wheelProbabilities.get(i);
        cumulativeProba[i] = cumulativeProba[i - 1] + proba;
    }
    int last = wheelProbabilities.size()-1;
     if (cumulativeProba[last] != 1.0)
     {
            throw new Exception("The probabilities does not sum up to one ("
                    + "sum="+cumulativeProba[last]);
     }
    double r = rng.nextDouble();
    int selected = Arrays.binarySearch(cumulativeProba, r);
     if (selected < 0)
        {
            /* Convert negative insertion point to array index.
            to find the correct cumulative proba range index.
            */
            selected = Math.abs(selected + 1);
        }
     /* skip indexes of elements with Zero probability, 
        go backward to matching index*/  
    int i = selected; 
    while (wheelProbabilities.get(i) == 0.0){
        System.out.print(i+" selected, correction");
        i--;
        if (i<0) i=last;
    }
    selected = i;
    return selected;
}

   public static void main(String[] args){

   RouletteWheel rw = new RouletteWheel();
   int rept = 20;
   List<Double> P = new ArrayList<>(4);
   P.add(0.2);
   P.add(0.1);
   P.add(0.6);
   P.add(0.1);
   Random rng = new Random();
   for (int i = 0 ; i < rept; i++){
       try {
           int s = rw.select(P, rng);
           System.out.println("Element selected "+s+ ", P(s)="+P.get(s));
       } catch (Exception ex) {
           Logger.getLogger(RouletteWheel.class.getName()).log(Level.SEVERE, null, ex);
       }
   }
   P.clear();
   P.add(0.2);
   P.add(0.0);
   P.add(0.5);
   P.add(0.0);
   P.add(0.1);
   P.add(0.2);
   //rng = new Random();
   for (int i = 0 ; i < rept; i++){
       try {
           int s = rw.select(P, rng);
           System.out.println("Element selected "+s+ ", P(s)="+P.get(s));
       } catch (Exception ex) {
           Logger.getLogger(RouletteWheel.class.getName()).log(Level.SEVERE, null, ex);
       }
   }
}

 /**
 * {@inheritDoc}
 * @return 
 */
 @Override
 public String toString()
 {
    return "Roulette Wheel Selection";
 }
} 
```

下面是概率向量 P=[0.2,0.1,0.6,0.1]，WheelElements = [0,1,2,3] 的执行示例：

所选元素 3，P(s)=0.1

所选元素 2，P(s)=0.6

所选元素 3，P(s)=0.1

所选元素 2，P(s)=0.6

所选元素 1，P(s)=0.1

所选元素 2，P(s)=0.6

所选元素 3，P(s)=0.1

所选元素 2，P(s)=0.6

所选元素 2，P(s)=0.6

所选元素 2，P(s)=0.6

所选元素 2，P(s)=0.6

所选元素 2，P(s)=0.6

所选元素 3，P(s)=0.1

所选元素 2，P(s)=0.6

所选元素 2，P(s)=0.6

所选元素 2，P(s)=0.6

元素选择 0, P(s)=0.2

所选元素 2，P(s)=0.6

所选元素 2，P(s)=0.6

所选元素 2，P(s)=0.6

该代码还以零概率测试轮盘赌。

* * *

## 回答 #11

> 赞同：-4
> 
> 时间：2014-11-22T18:48:29.793

恐怕任何在所有编程语言中使用内置随机数生成器的人都必须意识到生成的数字不是 100% 随机的。因此应谨慎使用。

* * *

## 回答 #12

> 赞同：-5
> 
> 时间：2008-11-18T17:42:02.550

**随机数生成器伪代码**

*   向顺序计数器加一
*   获取顺序计数器的当前值
*   通过计算机滴答计数*或其他一些小间隔计时器值添加计数器值*
*   可选地添加加法数字，例如来自外部硬件（如等离子发生器）的数字或一些其他类型的有些随机现象
*   例如，将结果除以一个非常大的素数 *359334085968622831041960188598043661065388726959079837*
*   从结果的小数点最右边获取一些数字
*   使用这些数字作为随机数

使用随机数字为轮盘赌创建 1 到 38（或 37 欧洲）之间的随机数字。

# java - Java 泛型 - 将子类型集合传递给需要基类型集合的方法

> ID：298305
> 
> 赞同：5
> 
> 时间：2008-11-18T09:57:05.653
> 
> 标签：java, generics

如何在 Java 中执行此操作 - 将子类型集合传递给需要基类型集合的方法？

下面的例子给出：

```
The method foo(Map<String,List>) is not applicable for the arguments (Map<String,MyList>) 
```

我可以通过为类型化集合创建类层次结构来实现 - 但是否有可能？

```
public void testStackOverflow() {

    class MyList extends AbstractList {
        public Object get(int index) {
            return null;
        }
        public int size() {
            return 0;
        }           
    };

    Map <String, List>   baseColl = null;
    Map <String, MyList> subColl  = null;

    foo (subColl);              
}

private void foo (Map <String, List> in) {      
} 
```

编辑：从答案中可以看出，这需要“有界通配符”，因此添加此文本以进行搜索

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-18T10:09:07.797

更改`foo`为：

```
private void foo(Map <String, ? extends List> in) {
} 
```

这将限制您在 内可以做的事情`foo`，但这是合理的。您知道从地图中获取的任何值都将是一个列表，但您不知道将哪种值有效地放入地图中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T10:16:41.060

正如乔恩所说：

```
private void foo (Map <String, ? extends List> in { ... } 
```

将修复错误。你仍然会有警告。看看get-put原理：[http ://www.ibm.com/developerworks/java/library/j-jtp07018.html](http://www.ibm.com/developerworks/java/library/j-jtp07018.html)

# eclipse - 从 Eclipse 启动 JBoss

> ID：298312
> 
> 赞同：27
> 
> 时间：2008-11-18T10:00:25.553
> 
> 标签：eclipse, jboss

从 Eclipse Ganymede 中盯着 JBoss 服务器会出现以下问题：“本地主机上的服务器 JBoss v4.0 无法在 120 秒内启动。如果服务器需要更多时间，请尝试在服务器编辑器中增加超时时间。”

控制台显示 JBoss 已在某某几分钟内启动，但不久之后，如果出现上述消息，则会弹出一个窗口。我也可以从外部启动 JBoss。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-18T10:20:58.337

我有一个类似的问题，但它与 Tomcat 5.5 服务器有关。启动时间非常重要，所以我收到了这个错误。

为了解决这个问题，我做了以下步骤：在首选项，服务器中，我将属性“服务器超时延迟”更改为“无限制”。

**编辑：**

对于 Eclipse Ganymede，您必须这样做： 在服务器视图中，双击您的服务器 JBoss。在概述中，您有一个“超时”面板（默认情况下，它是折叠的）。您可以定义服务器启动和停止操作的超时时间。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-11-09T20:53:56.150

我有一个类似的问题。结果发现，`8080`当我的 JBoss 从`8180`.

通过在 Eclipse 中更改服务器的配置（双击服务器并编辑服务器属性），它起作用了。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-08-01T00:33:06.010

增加超时并不能解决问题。Eclipse 从来没有意识到服务器已经启动（不确定这是否是一个大问题），只是让我很生气。我有这个问题好几个星期了，最后发现（至少对我来说）主机名和地址必须相同。我有主机名：localhost；地址“127.0.0.1”，它不会工作。我都改成了 127.0.0.1，瞧！

像这样： ![在此处输入图像描述](https://i.stack.imgur.com/3XieV.png)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-08-31T17:17:41.753

在我的带有 Jboss 工具的 Eclipse 中，这也发生了，我将 JbossServer 的一般信息中的“主机名”从我的机器名更改为 127.0.0.1。

谢谢，这很好用！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-30T08:43:06.893

您必须更改 JBoss 配置面板中定义的端口。我曾经使用过 -`Djboss.service.binding.set=ports-01`升级端口号 - 忘记更改 Eclipse/JBoss 配置 - Eclipse 没有注意到 JBoss 已经在运行。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-03T15:35:21.740

当我将 JBoss 更改为在端口 8443 上通过 SSL 运行而不是在端口 8080 上未加密时，我已经看到了这种行为。我的理论是 Eclipse 插件正在检查端口 8080 以确认 JBoss 已启动，并且此检查是硬编码的，并且不尊重您对配置所做的更改以指定服务器在不同的端口上运行。

我们的解决方法是从调试下拉菜单中启动 JBoss，这显然会禁用超时。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-10-15T20:00:11.487

尝试以下操作：-

1.  检查通用信息中的端口 jboss 是否配置正确。它通常是 8080，除非你改变了它。

2.  我使用主机名作为 0.0.0.0，以便可以从网络上的其他计算机访问它。

3.  我在连接到 vpn 时遇到了问题，这导致了这个问题。关闭任何 VPN 连接。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-07-11T07:08:23.733

我遇到了同样的问题，并通过修改 jboss 文件夹中的“server.xml”文件来纠正它。

```
I modified  '<Connector port="8080"' by '<Connector port="server port defined in Eclipse"' 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-02-24T17:38:37.737

是的，我有类似的问题 Jboss 无法在默认的 50 秒内从 Eclipse Galileo 启动，所以只需通过双击控制台和错误日志附近的服务器窗口中的 Jboss 服务器图标来更改服务器启动时间（不在 windows->preferences->server 处）。它打开服务器编辑器，然后将启动时间增加到 300 它然后工作。！！！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-04T15:33:29.450

你在 Linux 上运行吗？如果是这样，请检查 jBoss 是否对 /tmp 有写权限...

我遇到了同样的问题，我修复了为用户、组和其他人创建具有 RW 权限的临时目录，并将这一行添加到 eclipse.ini

```
-Djava.io.tmpdir=yourTempDirectory 
```

您的临时目录是您创建的临时目录的绝对地址。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-02T21:14:17.110

双击服务器视图中的 jBoss 服务器图标。弹出一个窗口，其中“超时”已折叠。单击箭头并增加开始时间。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-18T10:12:37.667

您可以检查您运行的 Jboss 是 4.0.4 版还是 4.2.2 版。当您安装了 Jboss 4.2.2 但在 Eclipse 中配置了 Jboss 4.0.4 时，您可能会收到此错误。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-09-24T09:24:39.677

我遇到了同样的问题并找到了解释。对于 Eclipse，JBoss 应该支持 jboss-web 服务（tomcat.sar），这意味着在进程结束时打开一个 HTTP 端口。就我而言，由于禁用了此服务，因此在服务器运行时没有打开 HTTP 端口...

解决方案：只需在“服务器”面板中双击 jboss 服务器，然后将 JNDI 端口复制到“服务器属性”部分的“端口”字段。这使得它。

这样，不再需要将主机名更改为 127.0.0.1，你可以让它成为你想要的（例如 localhost 是默认值）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-04-09T10:47:29.127

在“服务器”窗口中右键单击“JBoss 4.2 at localhost”并选择打开，然后将端口号从 8080 更改为 8081 即可。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-07-29T13:21:42.007

我可以通过使用 Aboucabar Toure 的建议来修复它：在 Eclipse Indigo 下，我打开了 JBoss 服务器属性并编辑了服务器端口组以匹配我的 JBoss 端口配置（取消选中本地运行时框中的检测）。

然后一切正常！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-02-09T11:45:57.030

我是 EJB 的新手 - Jboss。我也遇到了同样的问题

> Jboss没有在给定时间内启动，增加启动超时]]

您提出的宝贵建议无法解决。

根据控制台：我的 Jboss-5.1.0.GA 服务器于 50:21、49:91 开始...依此类推。

但对给定的主机名没有很好的响应：`10.168.2.11` 服务器配置服务器：10.168.2.11，我喜欢在使用 ant 时执行。

解决方案：尽管它很好用

```
host Name: localhost
Server Name:localhost 
```

甚至增加端口即ports-02：导致http：端口8280

* * *

尝试了这里给出的每一个练习。这是我的。希望与 jboss 协作的 eclipse 社区提供正确的解决方案。

我不知道，但在这个建议中有点接地：[https ://stackoverflow.com/a/945444/1164686](https://stackoverflow.com/a/945444/1164686)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-12-05T22:15:26.477

如果您使用的是非默认端口，例如 8180。您应该将 eclipse 配置为在所需端口号处轮询服务器。看这张图片：

![在此处输入图像描述](https://i.stack.imgur.com/rHdlG.png)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-09-05T07:30:45.477

This also happened when you create the jboss with different server version. I was using JBoss AS 7.2.0 final but had no idea to use which server version in eclipse. I tried with WildFly but that leads to this error. With all the good tips in here didn't solve my problem. Thanks to this [post](https://developer.jboss.org/wiki/HowToCreateconfigurestartstopJBossAS720RuntimeServerWithEclipseIDE43keplerjbosstools41-EnglishVersion) i corrected that with correct version. I should have used Jboss Enterprise Application platform 6.1.

![enter image description here](https://i.stack.imgur.com/ZfT7j.png)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-04-17T02:05:03.653

我也面临同样的问题，在更改它对我有用的端口号后。

server.xml 中的端口号和 jboss 端口号应该相同。

转到-> jboss-4.0.3\server\default\deploy\jbossweb-tomcat55.sar\server.xml

连接器端口="9090"

goto -> 双击服务器并将端口号更改为您在 server.xml 中提供的端口号

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-03-14T09:48:50.517

删除调试视图中的所有eclipse断点，jboss会快速启动。

# git - 在 git repo 中查找超过 x 兆字节的文件，这些文件在 HEAD 中不存在

> ID：298314
> 
> 赞同：57
> 
> 时间：2008-11-18T10:00:44.710
> 
> 标签：git

我有一个 Git 存储库，我在其中存储随机的东西。主要是随机脚本、文本文件、我设计的网站等等。

随着时间的推移，我已经删除了一些大型二进制文件（通常为 1-5MB），它们正在增加存储库的大小，而我在修订历史记录中不需要这些文件。

基本上我希望能够做到..

```
me@host:~$ [magic command or script]
aad29819a908cc1c05c3b1102862746ba29bafc0 : example/blah.psd : 3.8MB : 130 days old
6e73ca29c379b71b4ff8c6b6a5df9c7f0f1f5627 : another/big.file : 1.12MB : 214 days old 
```

..然后能够检查每个结果，检查它是否不再需要然后删除它（可能使用`filter-branch`）

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-11-18T14:32:14.943

[这是我之前发布的`git-find-blob`脚本](https://stackoverflow.com/questions/223678/git-which-commit-has-this-blob#223890)的改编：

```
#!/usr/bin/perl
use 5.008;
use strict;
use Memoize;

sub usage { die "usage: git-large-blob <size[b|k|m]> [<git-log arguments ...>]\n" }

@ARGV or usage();
my ( $max_size, $unit ) = ( shift =~ /^(\d+)([bkm]?)\z/ ) ? ( $1, $2 ) : usage();

my $exp = 10 * ( $unit eq 'b' ? 0 : $unit eq 'k' ? 1 : 2 );
my $cutoff = $max_size * 2**$exp; 

sub walk_tree {
    my ( $tree, @path ) = @_;
    my @subtree;
    my @r;

    {
        open my $ls_tree, '-|', git => 'ls-tree' => -l => $tree
            or die "Couldn't open pipe to git-ls-tree: $!\n";

        while ( <$ls_tree> ) {
            my ( $type, $sha1, $size, $name ) = /\A[0-7]{6} (\S+) (\S+) +(\S+)\t(.*)/;
            if ( $type eq 'tree' ) {
                push @subtree, [ $sha1, $name ];
            }
            elsif ( $type eq 'blob' and $size >= $cutoff ) {
                push @r, [ $size, @path, $name ];
            }
        }
    }

    push @r, walk_tree( $_->[0], @path, $_->[1] )
        for @subtree;

    return @r;
}

memoize 'walk_tree';

open my $log, '-|', git => log => @ARGV, '--pretty=format:%T %h %cr'
    or die "Couldn't open pipe to git-log: $!\n";

my %seen;
while ( <$log> ) {
    chomp;
    my ( $tree, $commit, $age ) = split " ", $_, 3;
    my $is_header_printed;
    for ( walk_tree( $tree ) ) {
        my ( $size, @path ) = @$_;
        my $path = join '/', @path;
        next if $seen{ $path }++;
        print "$commit $age\n" if not $is_header_printed++;
        print "\t$size\t$path\n";
    }
} 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2011-10-30T13:35:56.830

更紧凑的 ruby​​ 脚本：

```
#!/usr/bin/env ruby -w
head, treshold = ARGV
head ||= 'HEAD'
Megabyte = 1000 ** 2
treshold = (treshold || 0.1).to_f * Megabyte

big_files = {}

IO.popen("git rev-list #{head}", 'r') do |rev_list|
  rev_list.each_line do |commit|
    commit.chomp!
    for object in `git ls-tree -zrl #{commit}`.split("\0")
      bits, type, sha, size, path = object.split(/\s+/, 5)
      size = size.to_i
      big_files[sha] = [path, size, commit] if size >= treshold
    end
  end
end

big_files.each do |sha, (path, size, commit)|
  where = `git show -s #{commit} --format='%h: %cr'`.chomp
  puts "%4.1fM\t%s\t(%s)" % [size.to_f / Megabyte, path, where]
end 
```

用法：

```
ruby big_file.rb [rev] [size in MB]
$ ruby big_file.rb master 0.3
3.8M  example/blah.psd  (aad2981: 4 months ago)
1.1M  another/big.file  (6e73ca2: 2 weeks ago) 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-04-11T04:03:30.093

Python 脚本做同样的事情（基于[这篇文章](https://stackoverflow.com/a/7945209/271376)）：

```
#!/usr/bin/env python

import os, sys

def getOutput(cmd):
    return os.popen(cmd).read()

if (len(sys.argv) <> 2):
    print "usage: %s size_in_bytes" % sys.argv[0]
else:
    maxSize = int(sys.argv[1])

    revisions = getOutput("git rev-list HEAD").split()

    bigfiles = set()
    for revision in revisions:
        files = getOutput("git ls-tree -zrl %s" % revision).split('\0')
        for file in files:
            if file == "":
                continue
            splitdata = file.split()
            commit = splitdata[2]
            if splitdata[3] == "-":
                continue
            size = int(splitdata[3])
            path = splitdata[4]
            if (size > maxSize):
                bigfiles.add("%10d %s %s" % (size, commit, path))

    bigfiles = sorted(bigfiles, reverse=True)

    for f in bigfiles:
        print f 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-01-13T17:06:05.147

哎呀……第一个脚本（亚里士多德写的）很慢。在 git.git 存储库中，查找大于 100k 的文件时，它会占用 CPU 大约 6 分钟。

它似乎还打印了几个错误的 SHA——通常会打印一个与下一行中提到的文件名无关的 SHA。

这是一个更快的版本。输出格式不同，但速度非常快，而且 - 据我所知 - 也是正确的。

该程序*有点*长，但很多都是冗长的。

```
#!/usr/bin/perl
use 5.10.0;
use strict;
use warnings;

use File::Temp qw(tempdir);
END { chdir( $ENV{HOME} ); }
my $tempdir = tempdir( "git-files_tempdir.XXXXXXXXXX", TMPDIR => 1, CLEANUP => 1 );

my $min = shift;
$min =~ /^\d+$/ or die "need a number";

# ----------------------------------------------------------------------

my @refs =qw(HEAD);
@refs = @ARGV if @ARGV;

# first, find blob SHAs and names (no sizes here)
open( my $objects, "-|", "git", "rev-list", "--objects", @refs) or die "rev-list: $!";
open( my $blobfile, ">", "$tempdir/blobs" ) or die "blobs out: $!";

my ( $blob, $name );
my %name;
my %size;
while (<$objects>) {
    next unless / ./;    # no commits or top level trees
    ( $blob, $name ) = split;
    $name{$blob} = $name;
    say $blobfile $blob;
}
close($blobfile);

# next, use cat-file --batch-check on the blob SHAs to get sizes
open( my $sizes, "-|", "< $tempdir/blobs git cat-file --batch-check | grep blob" ) or die "cat-file: $!";

my ( $dummy, $size );
while (<$sizes>) {
    ( $blob, $dummy, $size ) = split;
    next if $size < $min;
    $size{ $name{$blob} } = $size if ( $size{ $name{$blob} } || 0 ) < $size;
}

my @names_by_size = sort { $size{$b} <=> $size{$a} } keys %size;

say "
The size shown is the largest that file has ever attained.  But note
that it may not be that big at the commit shown, which is merely the
most recent commit affecting that file.
";

# finally, for each name being printed, find when it was last updated on each
# branch that we're concerned about and print stuff out
for my $name (@names_by_size) {
    say "$size{$name}\t$name";

    for my $r (@refs) {
        system("git --no-pager log -1 --format='%x09%h%x09%x09%ar%x09$r' $r -- $name");
    }
    print "\n";
}
print "\n"; 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-04-05T20:11:43.217

您想使用[BFG Repo-Cleaner](http://rtyley.github.com/bfg-repo-cleaner/)，这是一种更快、更简单的替代方案，`git-filter-branch`专门用于从 Git 存储库中删除**大文件。**

下载[BFG jar](http://rtyley.github.com/bfg-repo-cleaner/#download)（需要 Java 6 或更高版本）并运行以下命令：

```
$ java -jar bfg.jar  --strip-blobs-bigger-than 1M  my-repo.git 
```

任何大小超过 1M 的文件（不在您的*最新*提交中）都将从您的 Git 存储库的历史记录中删除。然后，您可以使用`git gc`清除死数据：

```
$ git gc --prune=now --aggressive 
```

BFG 通常比运行快[10-50](https://docs.google.com/spreadsheet/ccc?key=0AsR1d5Zpes8HdER3VGU1a3dOcmVHMmtzT2dsS2xNenc)`git-filter-branch`倍，并且这些选项是围绕以下两个常见用例量身定制的：

*   删除**疯狂的大文件**
*   删除**密码、凭证**和其他**私人数据**

*全面披露：我是 BFG Repo-Cleaner 的作者。*

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-18T22:41:39.667

亚里士多德的剧本会告诉你你想要什么。您还需要知道已删除的文件仍会占用存储库中的空间。

默认情况下，Git 会将更改保留 30 天左右，然后才能进行垃圾收集。如果您现在想删除它们：

```
$ git reflog expire --expire=1.minute refs/heads/master
     # all deletions up to 1 minute  ago available to be garbage-collected
$ git fsck --unreachable 
     # lists all the blobs(file contents) that will be garbage-collected 
$ git prune 
$ git gc 
```

旁注：虽然我是 Git 的忠实粉丝，但 Git 并没有为存储“随机脚本、文本文件、网站”和二进制文件的集合带来任何优势。Git 跟踪内容的变化，特别是许多文本文件之间协调变化的历史，并且非常有效和有效地这样做。正如您的问题所示，Git 没有用于跟踪单个文件更改的好工具。而且它不跟踪二进制文件中的更改，因此任何修订都会在 repo 中存储另一个完整副本。

当然，这种对 Git 的使用是熟悉其工作原理的绝佳方式。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-05-16T19:14:42.733

```
#!/bin/bash
if [ "$#" != 1 ]
then
  echo 'git large.sh [size]'
  exit
fi

declare -A big_files
big_files=()
echo printing results

while read commit
do
  while read bits type sha size path
  do
    if [ "$size" -gt "$1" ]
    then
      big_files[$sha]="$sha $size $path"
    fi
  done < <(git ls-tree --abbrev -rl $commit)
done < <(git rev-list HEAD)

for file in "${big_files[@]}"
do
  read sha size path <<< "$file"
  if git ls-tree -r HEAD | grep -q $sha
  then
    echo $file
  fi
done 
```

[来源](http://github.com/svnpenn/a/blob/66098b/misc/git-large.sh)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-09-06T21:41:35.450

此 bash“单线”显示存储库中大于 10 MiB 且不存在于`HEAD`从小到大排序的所有 blob 对象。

它*非常快速*、易于复制和粘贴，并且只需要标准的 GNU 实用程序。

```
git rev-list --objects --all \
| git cat-file --batch-check='%(objecttype) %(objectname) %(objectsize) %(rest)' \
| awk -v min_mb=10 '/^blob/ && $3 >= min_mb*2^20 {print substr($0,6)}' \
| grep -vFf <(git ls-tree -r HEAD | awk '{print $3}') \
| sort --numeric-sort --key=2 \
| cut -c 1-12,41- \
| $(command -v gnumfmt || echo numfmt) --field=2 --to=iec-i --suffix=B --padding=7 --round=nearest 
```

这将生成如下输出：

```
2ba44098e28f   12MiB path/to/hires-image.png
bd1741ddce0d   63MiB path/to/some-video-1080p.mp4 
```

有关更多信息，包括更适合进一步脚本处理的输出格式，请参阅我对类似问题的[原始答案。](https://stackoverflow.com/questions/10622179/how-to-find-identify-large-files-commits-in-git-history/42544963#42544963)

**macOS 用户**：由于`numfmt`在 macOS 上不可用，您可以省略最后一行并处理原始字节大小或`brew install coreutils`.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-04-27T00:35:27.950

[我对https://stackoverflow.com/a/10099633/131881](https://stackoverflow.com/a/10099633/131881)的 python 简化

```
#!/usr/bin/env python
import os, sys

bigfiles = []
for revision in os.popen('git rev-list HEAD'):
    for f in os.popen('git ls-tree -zrl %s' % revision).read().split('\0'):
        if f:
            mode, type, commit, size, path = f.split(None, 4)
            if int(size) > int(sys.argv[1]):
                bigfiles.append((int(size), commit, path))

for f in sorted(set(bigfiles)):
    print f 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-09-11T19:53:16.167

聚会有点晚了，但是[git-fat](https://github.com/cyaninc/git-fat)内置了这个功能。

只需使用 pip 安装它，然后`git fat -a find 100000`在末尾的数字以字节为单位的地方运行。

# mysql - 如何将一张表关联到许多不同的表？

> ID：298319
> 
> 赞同：3
> 
> 时间：2008-11-18T10:01:54.833
> 
> 标签：mysql, database, database-design

我有一个表格列表，即学生、教师、员工、部门。依此类推，每个表都有特定于它们的注释。现在，表中的一条记录可以有一个或多个注释，这表明它是从任何表到注释表的一对多关系。我不知道将评论表与每一个相关联的最佳方法是什么。如果我将评论表中的外键放入这些表中的每一个，它将像 40-50 个字段，具体取决于否。的表。其次，如果我将这些表中的每一个表中的外键添加到备注表中，就像为第二个备注外键重复整行一样？同样，如果我在每个表中只使用一个字段作为注释，我实际上将只在一个文本字段中存储行。关于如何实现有效解决方案的任何建议？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-18T10:10:11.277

让我们假设您的表（学生、教师、员工、部门）都有一个名为 Id 的 int 主键。

对于您的评论表，您可以创建一个表。

```
Id int
CommentType enum (student, teacher, staff, dept)
LinkId int
Comment 
```

评论中的一行可能如下所示

```
1,'Student',347,'text' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T10:21:35.340

由于这是一个多对多关系，您可能想看看使用关联表。

使用您的示例，它可能看起来像这样：

您可以**有**评论的表格：

```
+----------+------------+
| student  | student_id |
+----------+------------+
| Steve    |         12 |
| Larry    |         57 |
| Sunshine |         88 |
+----------+------------+

+--------+---------+
| dept   | dept_id |
+--------+---------+
| Math   |       2 |
| P.E.   |       5 |
| Drama  |      12 |
+--------+---------+ 
```

然后你需要跟踪实际的评论：

```
+-----------------------+------------+
| comment               | comment_id |
+-----------------------+------------+
| I love Math!          |          3 |
| Larry is my hero...   |          5 |
| Sunshine <3 Me!       |          6 |
+-----------------------+------------+ 
```

现在，您需要在这些表之间建立关联，这就是您的关联表发挥作用的地方。您现在关联哪些学生或部门有哪些评论，如下所示：

```
+------------+------------+
| student_id | comment_id |
+------------+------------+
|         57 |          5 |
|         57 |          6 |
+------------+------------+

+---------+------------+
| dept_id | comment_id |
+---------+------------+
|       2 |          3 |
+---------+------------+ 
```

这既有效又优雅。试一试！

*（也许可以为您节省另一个问题）*

如果您担心拥有如此多的关联表，您当然可以只使用一个关联表，但我建议不要这样做，因为它不那么整洁，并且消除了您可以使用第一个解决方案进行的引用完整性检查的一些可能性：

```
+-----------+------------+---------+
| entity_id | comment_id | entity  |
+-----------+------------+---------+
|        57 |          5 | student |
|        57 |          6 | student |
|         2 |          3 | dept    |
+-----------+------------+---------+ 
```

（这反过来会提示您为这些实体添加查找表......但我们不要去那里）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T10:15:11.203

您可以使用中间的“多对多”表。每个基表（学生、教授等）将有一个改变自我，存储基表的一个外键（例如 student_id）和评论表的一个外键。实际上，您的表格数量翻了一番，但您不需要修改现有表格，并且可以获得完全的灵活性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T10:15:45.523

如果要保留外键约束，则需要有一个表来处理每个将具有注释子项的表的映射。

这意味着，Comment 将有一个主键，对每个处理映射的表都有一个外键约束。

然后，在映射表中，您有 comment_id 和 ??????_id 以及对相应表的外键约束。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T10:15:58.597

您的评论表可能如下所示：

```
CommentID (int) - 主键
TableName (varchar(250)) - 注释相关的表
RecordID (int) - 引用的表中记录的 ID
评论（文本） - 实际评论

```

您当然可以添加可选字段，例如时间戳，它可以让您按照输入的顺序选择评论。

现在您可以使用此表来存储任何表的注释，并且可以通过过滤表名和记录 ID 来选择它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T10:11:59.867

是学生或老师或工作人员，而不仅仅是一种人..

所以你有一个人和一个人可以有很多评论吗？所以你有一个与那个人有关系的个人评论表，为什么有一个评论表..是一个评论而不仅仅是一种评论..

没有更深入的模式很难看到

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-27T20:34:00.047

我的 50 美分：Zoredache 解决方案绝对不错，但我不鼓励使用枚举；它们在 mysql 中不是很聪明：如果您指定未知值，则错误将用空字符串表示 - 即使指定了一些默认值。此外，如果您想修改或添加新类型，则 ALTER 非常长。unsigned tinyint 应该足以满足您的大部分需求......

# java - 如何从 iReport 调用存储过程？

> ID：298323
> 
> 赞同：2
> 
> 时间：2008-11-18T10:04:35.763
> 
> 标签：java, mysql, netbeans, ireport

我正在尝试**调用从 Netbeans 6.1 的 iReport 插件向导接收参数的存储过程**，如何才能成功完成此任务？

*其他技术细节是：使用 MySQL 5.0.51a-17 和 iReport Designer 1.0。*

谢谢！

更新：我投票结束这个问题，因为它是从 2008 年开始的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-02-20T00:42:15.770

直接编辑`myreport.jrmxl`文件：

```
<jasperReport ...>
    ...
    <parameter name="someParam" class="java.lang.String"/>
    <queryString>
       <![CDATA[call myproc($P{someParam})]]>
    </queryString>
    ...
</jasperReport> 
```

# asp.net - 如何从我的网站项目中删除未使用的 CSS 类？

> ID：298325
> 
> 赞同：13
> 
> 时间：2008-11-18T10:05:25.230
> 
> 标签：asp.net, css

我的项目在其开发过程中收集了 CSS 熵（未使用的类）。

现在为了保持 CSS 文件较小，我想删除所有未使用的 CSS 引用。但是手动执行此操作涉及搜索整个项目中的每个类。这需要时间。

你知道我可以采用什么方法/工具来找出我的项目中不再使用哪些 CSS 类并将其删除吗？

我在 ASP.NET 上编程。视觉工作室。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2014-07-15T07:24:07.387

在 Chrome 浏览器中，按 F12，转到 Audit 选项卡，选择“Reload page and audit on Load”选项，然后刷新页面。Chrome 会列出所有未使用的 CSS 规则。

如需在线解决方案，请访问[used-css.com](https://unused-css.com/)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-18T14:01:07.533

您可能会发现这个 Firefox 扩展很有用：[http ://www.sitepoint.com/dustmeselectors/](http://www.sitepoint.com/dustmeselectors/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-18T10:45:19.333

我写了一个工具，它可以让你在你的 aspx 源代码中找到所有的类和 CssClass 属性。

有关信息和下载，请参阅我的[博客条目](http://devio.wordpress.com/2008/04/21/checking-aspnet-source-code-with-graspx-part-2/)。

# ms-access - 使用 getstring 在 ADO 中选择特定列

> ID：298326
> 
> 赞同：0
> 
> 时间：2008-11-18T10:06:02.657
> 
> 标签：ms-access, vba, getstring

当我们使用 getstring 从记录集 (ADO) 中获取数据时，它会返回所有列。

如果只需要某些列，我们如何修改 getstring 语句？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T11:42:11.167

您可以退后一步，仅使用您想要的字段（列）构建记录集，例如：

```
strSQL="SELECT ID, FName, SName FROM Members"
rs.Open strSQL, cn

a=rs.GetString 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T10:16:01.450

你不能。GetString 返回全部或指定行数的所有列。您需要遍历记录集，明确获取所需的列。

这一切都在[文档](http://msdn.microsoft.com/en-us/library/ms676975(VS.85).aspx)中。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-18T15:53:42.407

您还可以结合使用 join 和 getrows

```
myString = join(rs.getrows( , , myColumn),";") 
```

*   rsGetrows 返回一个仅包含 myColumn 值的数组
*   Join 将在字符串中传输数组，例如“value1;value2; ...”

检查确切的语法，因为这是动态编写的

编辑：不幸的是，它不能那么直，因为 .getrows 将返回一个二维数组。是否有任何函数可以从二维数组中提取一维数组？它可以很容易地编写，不是吗？

# javascript - 如果封闭的 DIV 属性更改，Firefox 会重新启动 Flash 电影

> ID：298342
> 
> 赞同：9
> 
> 时间：2008-11-18T10:12:53.547
> 
> 标签：javascript, flash, firefox

我在某些 DIV 中嵌入了 Flash 电影。问题在于，当我动态更改封闭 DIV 的任何属性时，Firefox（而不是其他浏览器）会重新启动/重新初始化 Flash 电影，从而有效地重置整个进度（例如：上传文件的选择等）。

是否有某种解决方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-24T20:25:29.207

尝试隐藏它，`visibility:hidden`或者如果所有其他方法都失败了，`position:absolute;left:-9999px`.

我认为 Firefox 不想在不可见的 Flash 动画上浪费内存和 CPU，所以它会杀死它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-13T21:44:35.660

见[https://bugzilla.mozilla.org/show_bug.cgi?id=90268](https://bugzilla.mozilla.org/show_bug.cgi?id=90268)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-03T11:34:04.673

是的，Firefox 似乎杀死了不可见的 flash 实例。我在 Firefox 3.6.13 和 Flash Player 10.2.152 中遇到了同样的问题。我尝试了“可见性：隐藏”和“位置：绝对”，但即使使用“wmode = opaque”也无法正常工作。

对我来说，解决方案是将**"wmode" 设置为 opaque**、**"position:absolute"**和**"opacity:0"**，但不能将 "top" 属性设置为负数或任何 "position"、"overflow" 或“保证金”黑客。整部电影需要在页面中保留其“空间”以避免 Firefox 杀死它。我需要在两个相同大小的 Flash 电影之间切换可见性，所以，**属性提出主动之一。它工作得很好。**

 **# c# - .net 单击图像按钮在 Internet Explorer 但在 Firefox 中不起作用

> ID：298346
> 
> 赞同：0
> 
> 时间：2008-11-18T10:14:53.963
> 
> 标签：c#, asp.net

我已经为 ascx 编写了 C# 代码。我正在尝试通过单击图像按钮发送电子邮件，该按钮在 Mozilla Firefox 中有效，但在 Internet Explorer 中无效。

此函数在按钮单击时调用：

```
<%@ Control Language="C#" %>
<%@ Import Namespace="System" %>
<%@ Import Namespace="System.Web.UI.WebControls" %>
<%@ Import Namespace="System.Globalization" %>

<script language="c#" runat="server">
    protected void btnSubmit_Click(object sender, EventArgs e)
    {
        if (Page.IsValid)
        {
            string from = "manoj.singh@espireinfo.com";
            string to = "manoj.singh@espireinfo.com";
            string subject = "Keep me Updated";
            string sendguide = "";

            if (optsendguide.Checked)
            {
                sendguide = "Yes Please send me";

            }
            else
            {
                sendguide = "No Please don't send me";
            }

            // build up the body text
            string body = "<html><body>";
            body += String.Format("<div>Title: {0} </div>", title.Text);
            body += String.Format("<div>First Name: {0} </div>",firstname.Value);
            body += String.Format("<div>Sur Name: {0} </div>", surname.Value);
            body += String.Format("<div>Email address: {0} </div>", email.Value);
            body += String.Format("<div>Break Type: {0} </div>", breakTypeDescription.Text);
            body += String.Format("<div>Big weekends guide: {0} </div>", sendguide);
            body += "</body></html>";

            string error = Utilities.SendEmail(to, from, subject, body);
            if (error == "") // success
            {
                Response.Redirect("index.aspx");
            }
            else // error
            {
                Response.Write(error);
            }
        }
    }
</script> 
```

标记：

```
<div class="form_elm_button">
    <asp:ImageButton ID="SubmitButton"
                     runat="server"
                     Text="Submit"
                     ImageUrl="/images/17-6164button_submit.png"
                     OnClick="btnSubmit_Click"
                     CausesValidation="true"/>
</div> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T08:18:29.503

在后面的代码中只需更改受保护的 void btnSubmit_Click(object sender, EventArgs e)

带有受保护的 void btnSubmit_Click(object sender, ImageClickEventArgs e)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-10T18:26:10.610

你为什么使用 ImageButton ...为什么不使用常规按钮，并使用 CSS 更改背景。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-17T07:01:29.523

大家好，

此代码在 IE 而不是 mozilla 中工作，任何人都可以给出想法

document.onkeypress = KeyCheck; 功能 KeyCheck(e) {

```
 var KeyID = (window.event) ? event.keyCode : e.keyCode;
        if (KeyID == 0) {
            var image = document.getElementById("<%= imagetirukural.ClientID%>");
            var label = document.getElementById("<%= lbltirukural.ClientID%>");
            if (image != null) {

                document.getElementById("<%= imagetirukural.ClientID%>").style.display = "block";
                InitializeTimer();
            }
            else {
                document.getElementById("<%= lbltirukural.ClientID%>").style.display = "block";
                InitializeTimer();
            }
        }
        else if (KeyID != 0) {

            if (image != null) {
                document.getElementById("<%= imagetirukural.ClientID%>").style.display = "block";
            }
            else {
                document.getElementById("<%= lbltirukural.ClientID%>").style.display = "block";
            }

        }
    } 
```

# xml - 将 xml 加载到 IIS6 服务器上托管的 Flash 电影中，无法正常工作

> ID：298347
> 
> 赞同：0
> 
> 时间：2008-11-18T10:15:02.513
> 
> 标签：xml, flash, iis, iis-6

我有一个在运行时加载 XML 文件的 flash 文件。当`.swf`文件在本地或 Apache 服务器上运行时，它可以正常工作，但是当托管在基于 IIS6 的服务器上时，文件将无法加载。

有人能帮忙吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-18T13:49:57.167

您可能有文件权限问题。确保您的 xml 文件具有“网络服务”帐户（或 ASPNET 用户，如果您使用的是 XP）的读取权限

如果您尝试加载 FLV，您还需要在 IIS 中将其设置为 mime 类型。这通常不是默认设置的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T04:05:09.833

我遇到了同样的问题......一切都在本地加载正常，甚至在 Flash 中从我的本地机器引用 Web 服务器位置......当上传 swf 和相同的路径时，xml 图像路径没有加载......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T05:08:55.680

如果您从托管 SWF 的域以外的域加载 XML，您将遇到“跨域安全”问题。这里的一些文档：

[http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_14213&sliceId=2](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_14213&sliceId=2)

# mysql - 在备份中包含 ib_logfiles？

> ID：298350
> 
> 赞同：3
> 
> 时间：2008-11-18T10:15:36.163
> 
> 标签：mysql, backup

简短的问题：
在使用 InnoDB 引擎创建 MySQL 安装的定制备份时跳过 ib_logfile* 文件是否安全？

定制备份只是将所有（或部分）/var/lib/mysql + /etc/my.cnf 复制到安全的地方。

据我所知，ib_logfile* 文件是由 MySQL 在启动时重新创建的 + 这些文件非常大，因此将它们存储在备份中可能不明智。是的，假设 MySQL 在备份之前（正确地）停止了。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-19T02:23:05.820

以您描述的方式备份数据库是不安全的。

原因是您无法知道某些数据页是否仍在 MySQL 服务器的内存中，等待 I/O 刷新到磁盘。因此，无论您是否包含`ib_log`文件，复制文件都有很大的机会复制垃圾。

不要做你正在做的事情。使用`mysqlbackup`或 InnoDB 的[Hot Backup](http://www.innodb.com/hot-backup/)产品。

**编辑：**

[阅读 Farhan Mashraqi 的关于InnoDB 性能优化](http://mysqldatabaseadministration.blogspot.com/2007/04/innodb-performance-optimization.html)的博客文章，他说*如果你关闭了 MySQL 服务器*`ib_log`，你可以删除这些文件。

 *> InnoDB 日志调整大小：并不像更改选项和重新启动那么简单。您需要关闭 MySQL 服务器并确保它正常关闭（检查错误日志以确认错误）。然后移走 InnoDB 日志文件 ib_log*。然后启动 MySQL 服务器并检查错误日志文件，看看它是否成功创建了新的日志文件。

所以是的，您应该只能对文件进行文件系统副本`ibdata`。您不需要包含这些`ib_log`文件，因为它们应该在 MySQL 服务器启动时重新创建。但是，我重申，**我不建议使用文件系统副本备份数据库。**

假设您今天使用 MySQL 5.0 以这种方式备份数据库。有一天，您需要恢复备份，但到那时您将使用一些未来版本，例如 MySQL 6.5。这些`ib_data`文件在将来的版本中是否仍使用相同的内部格式？MySQL 6.5 会读取您今天备份的那些文件吗？你不能确定。备份格式旨在更便携。

# c# - c#如何在ListView中展开一个项目以占据多行？

> ID：298359
> 
> 赞同：1
> 
> 时间：2008-11-18T10:18:08.310
> 
> 标签：c#, wpf, winforms, listview

目前我有一个 ListView（使用详细信息视图）。我想实现这样的行为，即当用户选择单个项目（日志条目）时，日志条目会扩展（从一行到多行）以提供有关发生的错误的更详细信息。

我的问题是：这可能吗？如果是这样，是否有一个很好的资源可以用来帮助我？

编辑：

如果我必须使用*WPF*，那么我想我会使用带有控件的 ElementHost。但是，我完全不知道如何设计/编码/使用 WPF 组件。有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T13:27:58.053

编辑：对不起，这是 wpf

我用来实现相同目的的技巧是创建一个触发器来显示默认为折叠的辅助网格。

试试这个：

```
 <ListBox ItemsSource="{Binding}">
        <ListBox.ItemTemplate>
            <DataTemplate>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Height="20" >
                        <TextBlock Text="Not Selected"></TextBlock>
                    </Grid>
                    <Grid x:Name="selectedOnlyGrid" Grid.Row="1" Visibility="Collapsed">
                        <TextBlock Text="Selected"></TextBlock>
                    </Grid>

                </Grid>

                <DataTemplate.Triggers>
                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBoxItem}, AncestorLevel=1}, Path=IsSelected}" Value="True">
                        <Setter Property="Visibility" Value="Visible" TargetName="selectedOnlyGrid" />
                    </DataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>
        </ListBox.ItemTemplate>
    </ListBox> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T10:56:57.063

在此处阅读 CodeProject 上的帖子：[扩展列表框](http://www.codeproject.com/KB/miscctrl/ExtendedListBoxControl.aspx)

应该有你需要的所有信息:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T11:04:23.583

使用 ListView 执行此操作的一种方法是在选择“父级”时为您想要的每个额外行动态添加一个新的 ListViewItem。Similarly, you'll need to remove them when the selection changes to another item.

您可能还希望覆盖默认的向上/向下行为以跳过子项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T10:32:21.730

不是您问题的直接答案，但我认为在这种情况下您最好使用网格。

# c# - ASP.NET MVC Beta 1 - 它是否支持强类型视图数据？

> ID：298361
> 
> 赞同：3
> 
> 时间：2008-11-18T10:18:37.607
> 
> 标签：c#, asp.net-mvc, asp.net-mvc-beta1

在以前的版本中，有 3 种方法可以将数据从控制器传递到查看 AFAIK（如下所示）。

我想在 MVC Beta 1 中使用方法 (2)，但我找不到 renderView 方法。那么新语法是什么（如果仍然可能的话）？提前致谢。

本。

语法 #1：老式字典

```
ViewData["Name"] = "Moo-moo";
ViewData["Age"] = 6;
ViewData["HasFunnyFace"] = true;
RenderView("ShowCat"); 
```

语法 #2：显式类型的 ViewData 对象

```
RenderView("ShowCat", new ShowCatViewData {
    Name = "Moo-moo",
    Age = 6,
    HasFunnyFace = true
}); 
```

语法 #3：匿名类型对象

```
RenderView("ShowCat", new { 
    Name = "Moo-moo", 
    Age = 6, 
    HasFunnyFace = true 
}); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T10:30:36.897

在 beta 1 中，使用 View 方法：

```
return View ("ShowCat", <TYPED_DATA_SET_OR_OTHER_MODEL>); 
```

View 方法已经取代了 RenderView 方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T10:43:46.073

根据 Kieron 的评论，在 Visual Studio 2008（可能是 2005/VSE？）中，当您右键单击控制器操作时，您可以在上下文菜单顶部选择“添加视图”。

这会弹出一个小对话框，允许您通过指定它来创建强类型视图。

# c# - 如何使 SMTP 在 C# 中进行身份验证

> ID：298363
> 
> 赞同：79
> 
> 时间：2008-11-18T10:19:14.160
> 
> 标签：c#, authentication, smtp

我创建了使用 SMTP 发送消息的新 ASP.NET Web 应用程序。问题是 smtp 未从发送消息的人那里进行身份验证。

如何使 SMTP 在我的程序中进行身份验证？C# 是否有一个具有输入用户名和密码属性的类？

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2008-11-18T10:29:40.580

```
using System.Net;
using System.Net.Mail;

using(SmtpClient smtpClient = new SmtpClient())
{
    var basicCredential = new NetworkCredential("username", "password"); 
    using(MailMessage message = new MailMessage())
    {
        MailAddress fromAddress = new MailAddress("from@yourdomain.com"); 

        smtpClient.Host = "mail.mydomain.com";
        smtpClient.UseDefaultCredentials = false;
        smtpClient.Credentials = basicCredential;

        message.From = fromAddress;
        message.Subject = "your subject";
        // Set IsBodyHtml to true means you can send HTML email.
        message.IsBodyHtml = true;
        message.Body = "<h1>your message body</h1>";
        message.To.Add("to@anydomain.com"); 

        try
        {
            smtpClient.Send(message);
        }
        catch(Exception ex)
        {
            //Error, could not send the message
            Response.Write(ex.Message);
        }
    }
} 
```

您可以使用上面的代码。

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2015-01-12T07:11:15.907

确保您`SmtpClient.Credentials` **在**调用后设置`SmtpClient.UseDefaultCredentials = false`。

顺序很重要，因为设置`SmtpClient.UseDefaultCredentials = false`将重置`SmtpClient.Credentials`为空。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-18T10:32:23.070

在发送消息之前设置[Credentials属性。](http://msdn.microsoft.com/en-us/library/system.net.mail.smtpclient.credentials.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-11-01T09:15:48.637

要通过 TLS/SSL 发送消息，需要将 SmtpClient 类的 Ssl 设置为 true。

```
string to = "jane@contoso.com";
string from = "ben@contoso.com";
MailMessage message = new MailMessage(from, to);
message.Subject = "Using the new SMTP client.";
message.Body = @"Using this new feature, you can send an e-mail message from an application very easily.";
SmtpClient client = new SmtpClient(server);
// Credentials are necessary if the server requires the client 
// to authenticate before it will send e-mail on the client's behalf.
client.UseDefaultCredentials = true;
client.EnableSsl = true;
client.Send(message); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T10:30:34.370

你如何发送消息？

命名空间中的类`System.Net.Mail`（这可能是您应该使用的）完全支持身份验证，可以在 Web.config 中指定，也可以使用`SmtpClient.Credentials`属性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-06-18T08:43:13.740

在我的情况下，即使遵循上述所有内容。我不得不将我的项目从 .net 3.5 升级到 .net 4 以授权我们的内部 Exchange 2010 邮件服务器。

# java - 在不修改应用程序的情况下更改 Java 外观

> ID：298370
> 
> 赞同：3
> 
> 时间：2008-11-18T10:24:15.880
> 
> 标签：java, swing, look-and-feel

是否可以在不修改实际环境中的程序的情况下更改 Java 外观？

我知道理论上答案是肯定的。我还创建了演示应用程序，并在运行时更改了外观和感觉，并且效果很好。但是当我创建一个带有很多控件的真实应用程序时，外观变化并没有真正起作用：

*   不同的外观有不同的错误（或奇怪的功能）。例如，其中一些为 JTextField 和 JFormattedTextField 创建相同的样式，其中一些使用不同的样式。这种变化对用户来说可能很烦人。
*   控件大小不一样（使用不同的字体，不同的边框），所以有时候改变后的窗口看起来很难看。
*   键盘快捷键也可以不同。
*   ...

在外观更改后的应用程序中（实际上，我尝试使用具有不同皮肤的相同外观而不是更改外观）我总是必须修改应用程序。不是很大的修改，但是很多小的修改使得外观和感觉的改变变得困难。

我只是对我尝试的外观（目前使用[skinlf](http://www.l2fprod.com/skinlf/)）非常不走运，还是外观变化不像小型演示应用程序那样容易？

更新：我正在使用 Swing 并且现在无法更改为其他 GUI 库。

**UPDATE2**：在我看来，这个问题并不清楚。我确实知道如何改变外观。我的问题是：是否有可能创建一个真正的应用程序，其中更改外观（或外观的皮肤）是一件容易的事？目前，如果我更改外观，仅更改 2 或 3 行是不够的，我必须审查整个应用程序并修复相当多由外观更改引起的问题。dhiller 建议用更好的外观替换 skinlf。你能告诉我皮肤替换效果更好的可换肤外观吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T11:02:06.880

是的，有不同的方法可以在不修改应用程序代码的情况下以某种外观启动您的应用程序。一种简单的方法是在应用程序启动时设置系统属性。例如，如果您有一个 shell 脚本或批处理文件来启动您的应用程序，您只需将命令从

```
java -jar yourapp.jar 
```

至

```
java -Dswing.defaultlaf=com.sun.java.swing.plaf.gtk.GTKLookAndFeel -jar yourapp.jar 
```

-Dswing.defaultlaf=com.sun.java.swing.plaf.gtk.GTKLookAndFeel 将使用 GTKLookAndFeel 设置默认外观。

还有一种方法可以使用 Java 安装的 swing.properties 文件。有关更多详细信息，请查看[此](http://java.sun.com/docs/books/tutorial/uiswing/lookandfeel/plaf.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T11:39:56.680

一般来说，IMO 使用系统外观和感觉是一个好主意，以避免在用户已经习惯了平台外观时引入新外观来让用户感到困惑。平台外观可以通过以下代码实现。

```
 UIManager.setLookAndFeel( UIManager.getSystemLookAndFeelClassName() ); 
```

无论如何，请参阅[Change the Look and Feel After Startup (java tutorial)](http://java.sun.com/docs/books/tutorial/uiswing/lookandfeel/plaf.html#dynamic)，这可能会对您有所帮助。

顺便说一句：也许您使用了错误的布局管理器？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-15T23:52:23.893

您是否尝试过在 UIManager 上设置外观？只是在开玩笑。但是，说真的，如果您更改外观和感觉并且应用程序看起来不正确，那是因为您没有以正确的方式使用 LayoutManagers。最容易理解的示例是使用空布局管理器。这种方法不会跨平台（极端示例）。作为一种开发技术，您应该使用各种外观和感觉进行所有 Swing 概念测试。否则你会很想在你的应用程序中“让事情正常运行”，这不是重点。[真正了解布局可能是一项艰巨的工作。](http://madbean.com/anim/totallygridbag/)

也就是说，像键盘快捷键这样的东西总是需要特殊处理。Mac 上的菜单需要特殊处理。等等......然后是应用程序打包。

所以，是的，Java 在小型桌面演示中非常出色，并且需要努力才能使真正的应用程序完美。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T10:44:07.743

外观*应该*改变字体和行为，这就是外观系统的目的：它应该表现得像本机操作系统，不同的操作系统有不同的显示方式。我必须承认，“Java”的外观和感觉（称为金属或其他东西）通常比许多标准操作系统版本更漂亮（自从我上次使用 Java 以来，这可能已经改变了几年）。我建议您默认使用操作系统的外观，因为如果打开文件菜单的行为与其他程序中的行为不同（不幸的是，Windows 用户习惯于不一致的 gui，但 Mac 用户希望所有程序举止得体）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T14:56:19.030

如果您的最终目标是每个目标操作系统的本机外观，您可以查看[SWT](http://www.eclipse.org/swt/)。这将提供操作系统原生小部件，这些小部件将随着操作系统的外观和感觉而变化。

这样，用户不需要更改您的应用程序的选项，他们需要做的就是修改他们的操作系统主题，这些更改将自动传播到您的应用程序。

# delphi - 带有“可变参数”的函数如何检索堆栈的内容？

> ID：298373
> 
> 赞同：19
> 
> 时间：2008-11-18T10:26:24.923
> 
> 标签：delphi, variadic-functions

通常，在 Delphi 中，人们会使用 'array of const' 方法声明一个具有可变数量参数的函数。但是，为了与用 C 编写的代码兼容，可以将一个未知的“varargs”指令添加到函数声明中（我在阅读 Rudy 出色的“转换的[陷阱](http://rvelthuis.de/articles/articles-convert.html#varargs)”文档时了解到这一点）。

例如，可以在 C 语言中有一个函数，声明如下：

```
void printf(const char *fmt, ...) 
```

在 Delphi 中，这将变为：

```
procedure printf(const fmt: PChar); varargs; 
```

我的问题是：在实现使用 'varargs' 指令定义的方法时，如何获取堆栈的内容？

我希望存在一些用于此的工具，例如 va_start()、va_arg() 和 va_end() 函数的 Dephi 翻译，但我在任何地方都找不到。

请帮忙！

PS：请不要在关于“为什么”或“const 数组”替代方案的讨论中飘忽不定——我需要这个来为 Xbox 游戏中的函数编写类似 C 的补丁（参见 sourceforge 上的 Delphi Xbox 模拟器项目“Dxbx”详情）。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-18T12:32:14.017

好的，我在您的问题中看到了说明，这意味着您需要在 Delphi 中实现 C 导入。在这种情况下，您需要自己实现可变参数。

需要的基本知识是 x86 上的 C 调用约定：堆栈向下增长，C 将参数从右向左推送。因此，指向最后声明的参数的指针在增加最后声明的参数的大小后，将指向尾部参数列表。从那时起，只需读取参数并将指针增加适当的大小以深入堆栈。32 位模式下的 x86 堆栈通常是 4 字节对齐的，这也意味着字节和字作为 32 位整数传递。

无论如何，这里有一个演示程序中的帮助记录，它显示了如何读出数据。请注意，Delphi 似乎以一种非常奇怪的方式传递扩展类型。但是，您可能不必担心这一点，因为 10 字节浮点数通常不会在 C 中广泛使用，甚至在最新的 MS C、IIRC 中也没有实现。

```
{$apptype console}

type  
  TArgPtr = record
  private
    FArgPtr: PByte;
    class function Align(Ptr: Pointer; Align: Integer): Pointer; static;
  public
    constructor Create(LastArg: Pointer; Size: Integer);
    // Read bytes, signed words etc. using Int32
    // Make an unsigned version if necessary.
    function ReadInt32: Integer;
    // Exact floating-point semantics depend on C compiler.
    // Delphi compiler passes Extended as 10-byte float; most C
    // compilers pass all floating-point values as 8-byte floats.
    function ReadDouble: Double;
    function ReadExtended: Extended;
    function ReadPChar: PChar;
    procedure ReadArg(var Arg; Size: Integer);
  end;

constructor TArgPtr.Create(LastArg: Pointer; Size: Integer);
begin
  FArgPtr := LastArg;
  // 32-bit x86 stack is generally 4-byte aligned
  FArgPtr := Align(FArgPtr + Size, 4);
end;

class function TArgPtr.Align(Ptr: Pointer; Align: Integer): Pointer;
begin
  Integer(Result) := (Integer(Ptr) + Align - 1) and not (Align - 1);
end;

function TArgPtr.ReadInt32: Integer;
begin
  ReadArg(Result, SizeOf(Integer));
end;

function TArgPtr.ReadDouble: Double;
begin
  ReadArg(Result, SizeOf(Double));
end;

function TArgPtr.ReadExtended: Extended;
begin
  ReadArg(Result, SizeOf(Extended));
end;

function TArgPtr.ReadPChar: PChar;
begin
  ReadArg(Result, SizeOf(PChar));
end;

procedure TArgPtr.ReadArg(var Arg; Size: Integer);
begin
  Move(FArgPtr^, Arg, Size);
  FArgPtr := Align(FArgPtr + Size, 4);
end;

procedure Dump(const types: string); cdecl;
var
  ap: TArgPtr;
  cp: PChar;
begin
  cp := PChar(types);
  ap := TArgPtr.Create(@types, SizeOf(string));
  while True do
  begin
    case cp^ of
      #0: 
      begin
        Writeln;
        Exit;
      end;

      'i': Write(ap.ReadInt32, ' ');
      'd': Write(ap.ReadDouble, ' ');
      'e': Write(ap.ReadExtended, ' ');
      's': Write(ap.ReadPChar, ' ');
    else
      Writeln('Unknown format');
      Exit;
    end;
    Inc(cp);
  end;
end;

type
  PDump = procedure(const types: string) cdecl varargs;
var
  MyDump: PDump;

function AsDouble(e: Extended): Double;
begin
  Result := e;
end;

function AsSingle(e: Extended): Single;
begin
  Result := e;
end;

procedure Go;
begin
  MyDump := @Dump;

  MyDump('iii', 10, 20, 30);
  MyDump('sss', 'foo', 'bar', 'baz');

  // Looks like Delphi passes Extended in byte-aligned
  // stack offset, very strange; thus this doesn't work.
  MyDump('e', 2.0);
  // These two are more reliable.
  MyDump('d', AsDouble(2));
  // Singles passed as 8-byte floats.
  MyDump('d', AsSingle(2));
end;

begin
  Go;
end. 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T10:56:43.223

我发现[了这个](http://groups.google.de/group/borland.public.delphi.objectpascal/msg/22347fdb88dbf7bd)（来自我们认识的一个[人](https://stackoverflow.com/users/3712/barry-kelly):)）

> 要正确编写这些东西，您需要使用 BASM，Delphi 的内置汇编程序，并在 asm 中编写调用序列。希望您对需要做什么有一个很好的了解。如果您遇到困难，也许 .basm 组中的帖子会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T10:59:23.920

Delphi 不允许您实现可变参数例程。它仅适用于导入使用它的外部 cdecl 函数。

由于 varargs 基于 cdecl 调用约定，因此您基本上需要在 Delphi 中自己重新实现它，使用汇编和/或各种指针操作。

# asp.net - 确保成功的 ASP.NET 应用程序可伸缩性的关键因素是什么？

> ID：298377
> 
> 赞同：3
> 
> 时间：2008-11-18T10:28:03.673
> 
> 标签：asp.net, architecture, scalability

当启动一个新的 ASP.NET 应用程序时，知道在未来的某个时候它必须扩展，最重要的设计决策是什么，可以在不进行大规模重构的情况下实现未来的可扩展性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T10:35:42.270

我的前三个决定是

1.  在数据库中禁用或存储会话状态。
2.  在会话状态下尽可能少地存储。
3.  良好的 N 层架构。分离业务逻辑并使用 Web 服务而不是直接访问 DLL，确保您可以横向扩展业务层和表示层。您的数据库可能能够处理您扔给它的任何东西，尽管如果需要，您也可以将其集群化。

您也可以查看数据库中的分区数据。

我不得不承认，不管网站是否需要扩展，我都会这样做。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T22:08:00.320

这些是我们内部 ASP.Net 对大规模访问的 Web 应用程序的注意事项：

## 一般准则

*   不要使用会话 - SessionState=Off
*   完全禁用 ViewState - EnableViewState=False
*   不要使用任何复杂的 ASP.Net UI 控件，坚持基本（DataGrid vs. Simple repeater）
*   使用最快最短的数据访问机制（坚持使用前端站点的sqlreaders）

## 应用架构

*   创建一个带有抽象层的缓存管理器。这将允许您在将来开始扩展应用程序时用更复杂的分布式缓存解决方案替换简单的 System.Web.Cache。
*   创建一个具有抽象层的专用 I/O 管理器以支持未来的增长（S3 有人吗？）
*   在您可以打开和关闭的主要管道中构建时间跟踪，这将允许您在发生这种情况时检测到瓶颈。
*   使用后台处理机制并移动渲染当前页面不需要的任何内容以供其咀嚼。
*   更好的是 - 考虑从您的应用程序向其他应用程序触发事件，以便他们可以完成异步工作。
*   为数据库可扩展性做准备，放置您自己的层，以便您以后可以决定是否要对数据库进行分区，或者在主从场景中使用多个读取服务器。

最重要的是，从他人的成功和失败中学习并保持积极的态度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T11:14:19.587

确保您对瞬态/静态数据有可靠的缓存策略。数据库调用非常昂贵，尤其是使用单独的物理服务器时，因此请积极使用缓存。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T20:42:01.560

考虑因素太多了，可以写一本关于这个主题的书。事实上，有一本很棒的书而且它是免费的。;-)

Microsoft 已将《[提高 .NET 应用程序性能和可扩展性](http://www.microsoft.com/downloads/details.aspx?familyid=8A2E454D-F30E-4E72-B531-75384A0F1C47&displaylang=en)》作为 PDF 电子书发布。

如果您不介意滑稽的写作风格，那么值得一读。它不仅可以识别关键性能场景，还可以建立基准、衡量性能以及如何应用所学知识。

# design-patterns - 如何管理经常修改的生产代码？

> ID：298380
> 
> 赞同：5
> 
> 时间：2008-11-18T10:29:55.883
> 
> 标签：design-patterns, version-control, project-management

我的项目要求我对生产代码进行大量更改。需求不断出现，我需要尽快进行更改和部署。有时我最终会创建补丁工作类型的代码，因为某些要求不适合软件的整体设计。如何有效处理？任何设计模式来处理这个？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-18T10:57:42.240

我已经看到这种情况发生了很多次，它总是以泪水告终。上次客户在改进流程之前损失了数百万美元。

用户总是希望“尽快”提供新的需求，但他们不了解以与您相同的方式进行更改的风险。*他们看到了没有*该功能的成本，但他们没有预料到会发生什么，以及如果更改破坏了某些东西会损失多少钱。（我并不是说你不是一个优秀的开发人员，只是在任何不平凡的软件中都会存在错误，并且不受控制的更改可能会更快地暴露它们。）

所以，我认为你需要退后一步，尝试制定一个定期的发布时间表。会有阻力，但这样你可以更有效。当然，有时需要*立即*进行更改，但如果有时间表，那么用户将有责任证明为什么打破发布周期是有意义的。

哦，正如其他人所建议的那样，您需要技术基础设施，例如登台/测试系统、一键发布程序等。（请参阅[乔尔测试](http://www.joelonsoftware.com/articles/fog0000000043.html)。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-18T10:45:38.223

测试，您需要一个可靠的测试框架来确保您的修复不会破坏其他任何东西。

编辑：回答评论的问题。

不幸的是，除了花时间重构“黑客”之外，我想不出一个真正合理的模式/解决方案来保持架构完整。但是你可能已经没有多少时间了，因为你已经投入生产了。所以这并不容易...

然而更重要的是，如果架构因为您确实需要“破解”解决方案而被**破坏**，这实际上可能表明*原始设计不符合产品的实际需求*，因为如果是的话，您应该能够在架构的当前框架内修复/补丁。

因此，尝试对整个情况持积极态度，您应该注意您的修复，以及当前架构如何没有帮助/遵守，这样您就可以在以后的路上，当热修复开始解决时，有数据和提示重新设计架构中需要设计的任何部分，因为您在生产过程中发现了更准确的需求。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-18T13:28:09.067

这里的每个人都提出了很好的建议，比如测试等。但我想我应该指出你可能问错了问题。你在问是否有一个“模式”可以帮助解决这种情况。模式是解决设计问题的设计选择。你本质上是一个“过程”问题。

我会问“我可以使用什么过程来防止这种情况发生？”

不幸的是，（在我工作的地方也是如此）设计是开发人员和架构师的问题，但流程是经理的问题。实施良好的流程并坚持下去确实需要领导力。可悲的是，这往往是缺乏的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-18T10:41:11.993

答案可能过于基础，但我认为您应该对[敏捷软件开发](http://en.wikipedia.org/wiki/Agile_software_development)进行一些研究。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-18T11:58:05.863

我处于幸运的位置，我的 HEAD 几乎总是可以释放的。每周至少一次，我在 HEAD 中有代码，作为开发人员，我很乐意发布。这并不意味着每个可发布版本实际上都会发布，但它可以。在我的环境中，每周发布实际上非常实用，并且通常会制作...

在部署到登台之前，我将我的代码提升到发布分支。我总是将之前在登台测试过的相同代码部署到 live 中。

然后可以在发布分支中进行任何紧急修复，并在部署之前在 Staging 上进行测试。如果修复足够好，我可以将它合并回 HEAD。如果这是一个可怕的 hack，我可以稍后在 HEAD 中正确地重新实现它。

我有一套很好的开发人员测试，在每次签到时都会自动运行，这确认我没有破坏任何重要的东西。我的应用程序每次部署时都会运行内部测试，这再次让我充满信心。

事实上，运气并没有你想象的那么重要。这不是偶然发生的。我必须努力使之成为可能。我必须致力于编写和维护良好的自动化测试，并获得持续集成服务器和一键式构建和部署功能。

作为我正常开发活动的一部分，我经常花时间清理我的代码。这有两个好处。首先，这意味着我的代码库开始时比较干净，因此架构非常灵活。其次，这意味着我擅长重构，因为我一直都在这样做。我的意思是在对现有代码进行一系列单独的小转换的意义上进行重构，而不是在扔掉所有东西并重新实现的意义上（这有点危险）。

在我看来，这种“持续可发布性”是敏捷方法的最大好处。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-18T13:20:12.063

除了版本控制、单元测试和自动化构建系统这些显而易见的答案之外，听起来您还需要进行一些重度[重构](https://rads.stackoverflow.com/amzn/click/com/0201485672)。如果您的设计根据不断变化的需求不断变化，那么您应该尝试隔离在自己的模块中不断变化的代码部分。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-21T12:28:56.987

您需要对您的需求积压施加纪律。冒着听起来老派和古怪的风险，告诉人们不，他们需要和你坐在一起，了解具体的痛点和努力进行剧烈的设计更改。对于数据库，解释基数以及这如何导致心痛。把你的干草扔在笼子里，坚持一个预定的发布周期，那时你只会在每周二投入生产，但只有在用户接受之后。将每个请求分成 2,4 和 8 周的部分，并严格规定您将在这些时间范围内包含哪些内容。

如果您有明确的问题域及其解决方案，那么有许多设计模式可以为您提供帮助。特别回顾[命令模式](http://en.wikipedia.org/wiki/Command_pattern)、[策略模式](http://en.wikipedia.org/wiki/Strategy_pattern)和[插件架构](http://www.eclipse.org/articles/Article-Plug-in-architecture/plugin_architecture.html)，因为它们将帮助您更轻松地扩展您的解决方案集。如果您是 .Net 开发人员，请查看 Migeul Castro 在 DNRTV 上评论的插件[架构](http://www.dnrtv.com/default.aspx?showNum=69)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-18T10:43:50.130

您可以根据多个项目生命周期来设计您的方法。[这个网站](http://www.business-esolutions.com/islm.htm)列出了一些（听起来你正在使用“代码和修复”这个！），但这绝不是一个确定的列表，更大的列表可以在[这里](http://en.wikipedia.org/wiki/Category:Software_development_process)找到。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-18T10:50:53.207

正如罗伯特·古尔德（Robert Gould）指出的那样，您确实需要一个暂存平台来检查您在部署到 live 时不会破坏任何东西。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-18T12:23:06.670

两个明显的工具是版本控制和测试。尝试将发布系统与它们集成，这样您就可以在每一步提交您的更改，当所有测试通过（包括新需求的测试）时，发布系统会选择“已知良好”的版本，这将是新的.

我不了解其他系统，但是 monotone 有一些专门用于使测试标记提交的钩子，所以有一个命令可以“给我通过所有测试的最后一个版本”

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-18T12:52:48.763

显然，测试很重要。但对我来说，自动化甚至更多。您应该能够使用不到 3 个命令将整个项目从源代码控制部署到生产服务器。[Maven](http://maven.apache.org/)、[Ant](http://ant.apache.org/)、[Capistrano](http://www.capify.org/)等工具（在此处插入您最喜欢的工具 <...>）可以为您提供很多帮助。每次源代码控制发生变化时，拥有一个自动部署到测试或集成服务器的持续集成系统也会有所帮助。

第一次完成所有自动化操作需要时间...

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-20T18:24:20.417

这是一个过程的事情，而不是设计的事情。

您需要做的第一件事是教育您的用户，以便他们了解更改需求的成本。这并不是要阻止他们更改它们，而是要避免更改它们并要求尽快实施，除非有明确的业务需求。（我假设这是一个商业问题，在这种情况下，你的工作就是尽你最大的能力去做商业需要的事情，让人们知道你的能力是什么，以及在整体方案中的功能成本是多少事物。）

第二件事是建立快速修复的双修复流程。首先，您获得补丁以保持应用程序或多或少令人满意地运行，然后您需要一些时间并提出真正的修复。这可能还需要一些用户教育，您可能会发现“技术债务”的概念有助于解释这一点。

第三件事是确保你有资源。如果你跟不上这样的需求变化，你需要帮助，你需要说明原因。如果当权者决定不引进更多人，并且他们理解这限制了修改的数量，那也很好。

现在，您的用户可能无法受教，您无法让人们相信快速修复从长远来看非常昂贵，等等。在那种情况下，我推荐第四件事：润色你的简历，开始寻找新工作。现在，看起来你注定要失败，这是一个非常糟糕的地方。俗话说，要么换工作，要么换工作。

# flash - 获取 Flash 影片中的所有命名实例

> ID：298385
> 
> 赞同：0
> 
> 时间：2008-11-18T10:31:45.117
> 
> 标签：flash, actionscript-3, actionscript-2, instance

是否可以使用 actionscript 2 在 flash 电影中获取具有名称的所有实例的列表。就像包含所有命名文本区域或所有 movieClip 实例等的数组一样。我想得到这个，以便设计人员可以添加或删除文本区域等，并且动作脚本可以动态地找到这些并从单独的数据源中获取文本。

我想我想要的是 DOM 树之类的东西，甚至更好的是 getElementByName() 在 JavaScript 中的工作方式。并获取实例名称的字符串值，以便我可以在 xml 中找到它的文本值。

假设设计人员添加了一个名为“copyright”的新文本区域，我的代码应该（无需更改脚本）在 XML 文件中找到 ID 为“copyright”的数据（如果存在），并将值添加到文本区域。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T19:06:05.903

@Stein Gauslaa Strindhaug

这很粗糙，但它应该可以解决问题！

```
private function traceAllChildren(rootContainer:DisplayObjectContainer):void {
    for(var i=0; i < rootContainer.numChildren; i++) {
        var item:* = rootContainer.getChildAt(i);
        try {
            traceAllChildren(item);
        } catch (e:Error) {
            trace(e.toString());
        }
        trace(item.toString());
        // This is the block where you can affect
        // an 'item' depending on it's type, name, etc..
        // eg: 
        //      if (item.toString() == '[object TextField]') {
        //          item.text = "The text I want to insert";
        //      }
        // or
        //      if (item.name == myTextFieldNameVar) {
        //          item.text = "The text I want to insert";
        //      }
    }
} 
```

然后像这样调用它：traceAllChildren(this) 或 traceAllChildren(myParentMovieClip)。

我希望这会有所帮助，祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-19T03:23:33.747

简短的回答：没有“内置”方法可以做到这一点。您可以尝试查找类似于 getElementByName() 的功能，但它需要从`_root`内容开始并爬取 - 严格来说，影片剪辑开始时引用其子项，但它们可以在运行时删除，因此这可能会失败.

话虽如此，这是一个常见问题，并且有很多方法可以解决。您可能会发现更有用的一件事是创建一个附加到自定义类的自定义组件 - 例如“TextPlaceholder”，并让您的设计人员将其副本放在他们想要动态文本的位置。然后在运行时，该组件可以检查其`_name`属性或其他自定义组件参数，并根据这些参数创建适当大小、内容等的文本字段。这只是接近它的一种方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T17:56:45.500

自从我进行任何 AS2 编码以来已经有一段时间了，但也许您可以结合使用 MovieClip.getInstanceAtDepth() 和 this.getNextHighestDepth() 来找到电影中的最高深度，然后追溯每个较低的深度，直到找到 getInstanceAtDepth( ) 对应于您要填充新数据的剪辑。

我还注意到 AS2 文档中的这个示例代码。

以下代码跟踪舞台上所有影片剪辑实例的深度：

```
for (var i in this) {
    if (typeof (this[i]) == "movieclip") {
    trace("movie clip '"+this[i]._name+"' is at depth "+this[i].getDepth());
    }
} 
```

PS：我知道你可能不想听到这个，但在 AS3 中这是一个轻而易举的事，因为你可以遍历 this.children！

# asp.net - 类中的异常处理和 C# 的代码隐藏

> ID：298391
> 
> 赞同：1
> 
> 时间：2008-11-18T10:35:08.870
> 
> 标签：asp.net, postgresql, function, c#-3.0

我对我正在做的一个 asp.net 项目有点卡住了！我有一个从后面的代码中调用的类，它的许多函数没有返回类型，即 void。那么如何进行异常处理？？？此外，如果类中的函数确实具有返回类型，例如数据集，那么如何返回异常或指示发生了异常？我从我的类中附加了以下代码，这些代码是从后面的代码中引用的。

```
public void fnRecord(string []varList, string fnName)
    {
        try
        {
            String x;

            StringBuilder SQLParameters = new StringBuilder();

            SQLParameters.AppendLine("SELECT #{Function}(");
            {
                SQLParameters.Replace("#{Function}", fnName);
            }

            for (int i = 0; i < varList.Length; i++)
            {                   
                x = varList[i].ToString();
                SQLParameters.Append("'" + x + "',");
            }

            SQLParameters.Remove((SQLParameters.Length - 1), 1);
            SQLParameters.Append(")");

            string SQLCMD = SQLParameters.ToString();

            conn.Open();
            NpgsqlCommand command = new NpgsqlCommand(SQLCMD, conn);
            Object result = command.ExecuteScalar();
        }

        catch (NpgsqlException ne)
        {
            //return ne;
        }

        catch (Exception x)
        {
            //error code
        }

        finally
        {
            conn.Close();
        }
    } 
```

任何帮助，将不胜感激！

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T10:43:29.680

仅捕获您打算正确处理它们的异常。如果您想在 UI 中反映错误，请在 UI 中捕获它们。如果你想处理它们并尝试处理业务逻辑中的问题，那么抓住它们并在那个时候处理它们。

顺便说一句，您的代码容易受到[SQL 注入](http://en.wikipedia.org/wiki/SQL_injection)攻击。最好去学习一些关于[参数化查询](http://aspnet101.com/aspnet101/tutorials.aspx?id=1)的知识。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T10:46:02.577

你不返回异常。你扔它们。这就是异常的重点——您不希望异常处理弄乱您的方法签名！

在您的 catch 子句中，您实际上并没有做任何事情来处理异常。那么你根本不应该捕捉它们，只是让它们冒泡到你的代码隐藏，然后在那里捕捉它们 - 在方法调用周围放置一个 try-catch 。

或者，在您的方法中捕获您的 SQL 异常，然后抛出一个带有一些合理消息的新异常，将 SqlExceptions 添加为内部异常，如下所示

```
catch (NpgsqlException ne)
{
    throw new Exception("Your explanatory message here", ne);
}
finally
{
    ...
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T11:45:13.207

很酷，感谢您的回答...使用 obout 库，因此也必须尝试解决它们的异常处理功能。

# .net - 非托管代码使用的 .NET 组件的内存管理

> ID：298397
> 
> 赞同：0
> 
> 时间：2008-11-18T10:40:25.847
> 
> 标签：.net, com, garbage-collection, unmanaged

`new`在非托管世界中工作时，如果我们在堆上分配了内存（例如，在 C++ 中使用关键字），我们必须确保自己清理干净；我们还必须确保我们以后使用它`AddRef`创建的 COM 组件；也许是这样的：`CreateInstance``Release`

```
SomeNameSapce::IObjPtr obj;
HRESULT hr = obj.CreateInstance(L"SomeObject");
if (hr == S_OK)
{
    obj->AddRef();
    m_anotherObj= obj->GetObj();
    obj->Release();
} 
```

显然我们可以使用智能指针和其他类似的东西（在 C++ 中），但除此之外......

`AddRef/Release`对于从 COM 组件中获取的对象（如上例中的 m_anotherObj），我们是否也必须这样做？

更令人困惑的是，如果这个特定组件实际上是一个 .NET 组件，它通过 COM 接口暴露给非托管代码，会发生什么？垃圾收集器是否知道清理东西，还是必须在非托管世界中手动完成？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T11:25:35.537

`CreateInstance`会给你一个引用计数为 1 的对象，所以你不需要`AddRef`它。（您使用的智能指针将`Release`在对象被销毁时将其删除。）同样，您从方法接收的对象应该已经增加了引用计数，因此您不需要`AddRef`再次使用它们 - 但您确实需要`Release`它们，除非您是使用智能指针。

.NET 公开的 COM 组件与任何其他技术编写的 COM 组件没有什么不同。垃圾收集器不会收集从 COM 引用中引用的任何 .NET 对象。

# asp.net - 如何发布带有调试信息的 Asp.Net WebService？

> ID：298417
> 
> 赞同：0
> 
> 时间：2008-11-18T10:48:47.267
> 
> 标签：asp.net, debugging, publishing, remote-debugging

从 asp.net 2.0 开始，web.config 文件的编译部分中的 debug=true 决定是否使用调试信息编译网站/w​​ebservice。但是在 ASP.Net 临时文件下的编译输出是很多“乱码”。只有发布才能获得干净的输出，以便在 WebServer 下正确托管。但是即使 web.config 中的 debug=true，也没有 pdb 文件。我怎样才能让 web 服务编译干净（与发布一样）但也包含调试信息？我的目的是在远程生产网络服务器上发布调试输出并能够对其进行调试。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T12:12:02.993

“Web 部署项目”解决了我的问题。它插入 Visual Studio 并允许设置额外的部署选项，包括发布调试信息。

# x11 - 转储隐藏（或最小化）的 X11 窗口

> ID：298430
> 
> 赞同：1
> 
> 时间：2008-11-18T10:57:18.387
> 
> 标签：x11, capture

我想转储 X 窗口的内容。像这样：

xwd -id | 转换 - capture.png

...只要目标窗口没有隐藏（完全或部分在其他窗口后面）或最小化，它就可以很好地工作。

关于如何做到这一点的任何想法？

我想我们必须以某种方式向隐藏窗口发送一个“重绘”信号，然后捕获它的响应或其他东西...... :)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T00:09:38.377

你反对先把它带到前台吗？

如果没有，您可以使用[wmctrl](http://www.sweb.cz/tripie/utils/wmctrl/)之类的工具将窗口置于最前面（并将其最大化等），使用 xwd 捕获它，然后使用 wmctrl 将其发送回原来的位置。

# .net - 在 ASP.NET Web 安装项目中，我可以在 IIS 中禁用匿名访问吗？

> ID：298432
> 
> 赞同：4
> 
> 时间：2008-11-18T10:57:47.747
> 
> 标签：.net, iis, installation

我有一个非常简单的 ASP.NET Web 应用程序和一个将项目输出和内容文件部署到 IIS 中的虚拟目录的 Web 设置项目。

我想要的是让 MSI 自动禁用 IIS 中该虚拟文件夹的匿名访问。

我怀疑它可能可以通过在自定义操作 DLL 中编写一些代码来完成，这是可以接受的，但是有没有办法在 web 设置项目的设置中做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-24T12:32:45.387

我确定您知道您可以禁止未通过身份验证的用户`web.config`

```
<system.web>
<authentication mode="Windows"/>
<authorization>
  <deny users="?"/> 
</authorization>
</system.web> 
```

我认为会这样做。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-18T11:09:50.000

[取自技术网](http://www.microsoft.com/technet/security/guidance/identitymanagement/idmanage/P3ASPD_6.mspx?mfr=true)

> 遗憾的是，匿名访问的属性不能通过 Web 设置项目获得。因此，您必须：
> 
> 1.  编写自定义安装程序以启用或禁用匿名访问。
>     
>     
> 2.  在运行时将必要的参数从设置向导传递给安装程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-02-02T17:24:24.850

```
<configuration>
    <system.web>
        <compilation debug="true" targetFramework="4.0" />
      <authentication mode="Forms">
        <forms loginUrl="SignIn.aspx" defaultUrl="Welcome.aspx"  protection="All">
          <credentials passwordFormat="Clear">
            <user name="lee" password="lee12345"/>
            <user name="add" password="add12345"/>
          </credentials>
        </forms>
      </authentication>

        <authorization>
          <deny users="?" />     //deny acces to anonymous users
        </authorization>
    </system.web>

</configuration> 
```

# javascript - WSH 映射驱动器保留默认路径集

> ID：298435
> 
> 赞同：0
> 
> 时间：2008-11-18T10:59:36.043
> 
> 标签：javascript, wsh

我编写了以下 javascript 放入我的启动文件夹以解决映射驱动器的一些问题。不幸的是，它具有以 H:\ 作为当前目录启动命令提示符的副作用。我怎样才能解决这个问题？

```
var objNetwork = WScript.CreateObject("WScript.Network");

/* Remove Network Drives */
try {
    objNetwork.RemoveNetworkDrive("H:", true, true);
} catch (e) {}
try {
    objNetwork.RemoveNetworkDrive("Y:", true, true);
} catch (e) {}
try {
    objNetwork.RemoveNetworkDrive("Z:", true, true);
} catch (e) {}

/* Recreate Network Drives */
objNetwork.MapNetworkDrive ("H:", "\\\\server1\\home", false);
objNetwork.MapNetworkDrive ("Y:", "\\\\server2\\source", false, "user", "pass");
objNetwork.MapNetworkDrive ("Z:", "\\\\server3\\source", false, "user", "pass"); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T11:02:08.720

我实际上是从建议的替代问题中解决了这个问题，但它已经足够不同了，我认为我会完成发布并回答我自己的问题。

基本上，%HOMEDRIVE% 设置为 H:\，但由于在我编写脚本之前 H:\ 不存在，因此没有在命令提示符中设置它。

您可以将自动运行添加到命令提示符以在启动之前更改为 C:（或任何位置）。更多细节在这里： http: [//windowsxp.mvps.org/autoruncmd.htm](http://windowsxp.mvps.org/autoruncmd.htm)

# workflow - 我们的错误跟踪工作流程是否如此独特？

> ID：298441
> 
> 赞同：3
> 
> 时间：2008-11-18T11:03:07.860
> 
> 标签：workflow, redmine, bug-tracking, mantis

我们目前正在使用 Mantis 作为我们的 bugtracker，我们对此感到非常厌烦和厌倦。开发人员想要更多的 SVN 集成，客户想要更容易使用的系统。

因此，我们正在寻找一个新的 bugtracker，目前我们正在研究 Redmine。但是，在其默认设置中，它与我们所需的工作流程不匹配，或者至少不比 Mantis 好多少。

我们有以下工作流程，并希望有一个错误跟踪器来匹配它。

*   报告了一个错误（通常由客户），并被认为是“新的”。这些错误会定期审查并确认（这是错误）或标记为功能（客户通常需要付费）并延迟到财务部分解决后。
*   然后由开发人员分配和处理错误
*   完成后，它被标记为“准备审查”（由另一个开发人员）
*   审核时将其标记为“已审核”
*   当标记为“已审核”时，原始开发人员将新代码放置在暂存环境中并将错误标记为“准备好测试”（由错误报告者）
*   错误报告者将错误标记为“已解决”
*   当投入生产时，bug-reporter 会关闭 bug

当然，通常需要反馈，尤其是在早期阶段。我们正在寻找一种方法来区分谁需要进行下一步，以及将错误分配给谁（开发人员）。我们还希望客户使用简单的 gui 来执行此操作 - 要求他们将受让人从他们自己的帐户更改为开发人员，或者更困难：第三方（想想：设计机构）使用常规的要求太多了贵的。gui 应该向他们展示要做什么以及有哪些选项 - 而不是搜索它们。

有人对以这种方式工作的错误跟踪器有任何经验吗？我们的工作流程真的很古怪吗？您如何确保所有相关人员都了解错误所在的位置，以及需要谁采取哪一步？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T11:13:48.400

去年我们遇到了同样的问题，我们发现对我们来说最好的解决方案是[Jira](http://www.atlassian.com/software/jira/)。相对而言，我们的工作流程比您的工作流程更加稳健和复杂。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T11:22:50.253

我们使用 Redmine 和电子邮件集成管理的工作流程几乎相同。客户直接将错误记录到 Redmine。通知会发送给项目经理，他们决定哪个开发人员可以处理该错误。开发人员打开 bug 并将其置于 Investigating 状态。如果它是一个特征，他会回复它，说明原因并将其置于 Replied 状态，然后再重新访问。如果它是一个错误，那么开发人员开始开发。在此之前，他将 bug 置于 Coding 状态。编码完成后，他会在 Review 和同行评审发生时更改 bug 的状态。如果有任何返工，则开发人员将状态更改为返工。一切正常后，开发人员将状态更改为已交付。QA 验证错误并最终通过将状态更改为已关闭来关闭它。

我们已经在 Redmine 中定义了所有这些工作流程，并且一直在非常有效地使用它，没有任何麻烦。电子邮件集成使项目经理可以轻松跟踪任何错误更改其状态时的一切。您还可以创建和保存自定义报告，这也是一个很酷的功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T11:26:24.990

我一直在将 Trac 用于一个小型个人项目，在工作中我们使用了 Bugzilla。

您描述的工作流程听起来也像 Red Hat 如何利用 Bugzilla。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T12:22:34.910

正如其他人所说，Jira 非常好。我特别喜欢它创建自定义问题[工作流程的能力](http://www.atlassian.com/software/jira/features/workflow.jsp)

# python - 在 Django 表单中循环

> ID：298446
> 
> 赞同：0
> 
> 时间：2008-11-18T11:05:53.987
> 
> 标签：python, django

我刚刚开始在 Django 中构建原型应用程序。我从[Django 网站上的 Django 应用教程](http://docs.djangoproject.com/en/dev/intro/tutorial01/)开始学习，这对我很有帮助，并为我提供了入门所需的内容。现在我有几个我希望是非常简单的问题：

我想在views.py中放一个循环，循环从表单传入的一组变量。所以我在 HTML 表单中有很多项目，每个项目都有一个 SELECT 下拉列表，供人们选择 0-10 的分数，如下所示：

```
<select name="score1">
  <option value=0 SELECTED>No score</option>
  <option value=1>1</option>
  <option value=2>2</option>
  <option value=3>3</option>
  <option value=4>4</option>
  <option value=5>5</option>
  <option value=6>6</option>
  <option value=7>7</option>
  <option value=8>8</option>
  <option value=9>9</option>
  <option value=10>10</option>
</select> 
```

所以我有，比方说，这些变量中的 100 个，score1，score2，score3，...，score99，score100。提交表单时，我想遍历这些变量中的每一个并查看它是否已设置（即不是 0），如果是，我想将该值存储在数据库中的合适位置。我的问题是我不知道如何遍历这些变量。我猜我想要这样的东西：

```
for o in request.POST.all

endfor 
```

但后来我真的不知道该怎么办。

我不是在找人为我编写代码，真的：我只是想要一些关于如何在 python / Django 中编写这样的循环的指导，也许还有一些关于我可以看到的好的参考指南的指针在线或购买可以让我接触到这种东西。

此外，上面的选择对象几乎是手动创建的，我真的很希望能够使用循环首先在模板中生成它。我的模板目前有这个：

```
<table>
{% for movie in movie_list %}
  <tr>
  <td> {{ movie }} </td>
  <td>
       <select name="score{{ movie.id }}">
         <option value=0 SELECTED>No score</option>
         <option value=1>1</option>
         <option value=2>2</option>
         <option value=3>3</option>
         <option value=4>4</option>
         <option value=5>5</option>
         <option value=6>6</option>
         <option value=7>7</option>
         <option value=8>8</option>
         <option value=9>9</option>
         <option value=10>10</option>

       </select>
  </td></tr>

{% endfor %}
</table> 
```

我觉得必须有一种方法可以创建一个从 1 到 10 的简单循环，它会为我生成大部分选项，但我不知道该怎么做......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-18T11:27:21.197

您需要查看 Django[表单](http://docs.djangoproject.com/en/dev/topics/forms/#topics-forms-index)。

你永远不应该像那样构建自己的表单。

您应该声明一个包含[ChoiceField](http://docs.djangoproject.com/en/dev/ref/forms/fields/#choicefield)的 Form 类，并为该字段提供选择域。一切都会从那里自动发生。

顺便说一句，选择应该在您的模型中定义为该模型字段的值范围。

您的页面仅包含`{{form}}`. Django 使用选项构建表单并将选项解码为最终结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T11:33:58.237

> 我觉得必须有一种方法可以创建一个从 1 到 10 的简单循环，它会为我生成大部分选项，但我不知道该怎么做......

如果您不想使用 Django 表单（为什么是 btw？），请查看此[自定义范围标记](http://www.djangosnippets.org/snippets/779/)或将 range(1, 11) 对象传递到您的模板并在`{% for %}`循环中使用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T22:56:56.733

遵循 S.Lotts 关于表单的建议，从长远来看，现在以 Django 的方式进行操作会节省时间。对于您正在寻找的那个循环：

```
<select name="score{{ movie.id }}">
    <option value=0 SELECTED>No score</option>
  {% for i in range(1, 11) %}
    <option value={{ i }}>{{ i }}</option>
  {% endfor %}
</select> 
```

# information-theory - 斐波那契编码

> ID：298448
> 
> 赞同：0
> 
> 时间：2008-11-18T11:07:15.683
> 
> 标签：information-theory, universal-code

[任何人都可以推荐一本关于整数通用代码，尤其是斐波那契代码（在http://en.wikipedia.org/wiki/Fibonacci_code](http://en.wikipedia.org/wiki/Fibonacci_code)的意义上）的好书/论文/网站/背景读物吗？谢谢！

**编辑：**感谢到目前为止的答案和有用的链接！很抱歉，如果我没有完全清楚地说明自己：我不是在询问生成或计算斐波那契数的代码（如编写程序），而是询问使用的特定代码（如编码或压缩数据）斐波那契数列。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T11:19:01.480

[谷歌学术](http://scholar.google.com)发现一篇论文：

*   [数据压缩](http://radio-1.ee.dal.ca/~ilow/4540/readings/DataCompression.pdf)（DA Lelewer，DS Hirschberg - ACM Computing Surveys (CSUR)，1987 年）

我对这个主题不太熟悉，但通过简短的观察，这篇文章似乎相当不错。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T11:58:33.163

我发现麻省理工学院的在线讲座通常是一个很好的资源。他们详细介绍了斐波那契算法：http: [//www.catonmat.net/blog/mit-introduction-to-algorithms-part-two/](http://www.catonmat.net/blog/mit-introduction-to-algorithms-part-two/)

视频的相关片段：

[17:49] 计算斐波那契数 (FB) 的算法。
[19:04] 用于计算 FB 的朴素递归算法（指数时间）。
[22:45] 用于计算 FB 的自下而上算法。
[24:25] FB 的朴素递归平方算法（由于浮点舍入错误而不起作用）。
[27:00] FB 的递归平方算法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T11:20:39.883

[信息论、推理和学习算法](http://www.inference.phy.cam.ac.uk/mackay/itila/book.html)有一章是关于代码的。它有一个免费的pdf版本，请查看。

# asp.net - 当主要内容未填满页面时，如何在母版页上获取“页脚”内容以向下推

> ID：298449
> 
> 赞同：4
> 
> 时间：2008-11-18T11:07:58.507
> 
> 标签：asp.net, master-pages, footer

我的母版页有以下代码：

```
<%@ Master Language="C#" AutoEventWireup="true" CodeFile="MasterPage.master.cs" Inherits="MasterPage" %>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server" style="position:relative">
    <title>Masterpage</title>
    <asp:ContentPlaceHolder id="head" runat="server">
    </asp:ContentPlaceHolder>
</head>
<body>
    <form id="main" runat="server" style="position:relative">
    <div>
        <asp:ContentPlaceHolder id="MainContent" runat="server">
        </asp:ContentPlaceHolder>
    </div>
    </form>
    <br style="clear:both" />
    <form id="footer" style="position:relative">
    <div>
        <center style="font-size:small">Footer content</center>
    </div>    
    </form>
</body>
</html> 
```

我的问题是，当 MainContent 没有填满页面时，页脚不在页面底部。如果主要内容没有将页脚一直向下推，有没有办法强制页脚留在页面底部？当主要内容“足够大”时，它会将页脚与内容一起向下推，并在向下滚动时显示在底部，但如果它太小则不会。

有人知道如何解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T21:44:57.393

在您的 css 中为页脚 div 使用以下内容：

```
bottom:0px;
position:absolute; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T14:22:12.453

检查这些相关问题以获得解决方案：

*   [如何让页脚留在网页底部？](https://stackoverflow.com/questions/42294/how-do-you-get-the-footer-to-stay-at-the-bottom-of-a-web-page)
*   [无法让 CSS Sticky 页脚工作。我究竟做错了什么？](https://stackoverflow.com/questions/159487/can-not-get-css-sticky-footer-to-work-what-am-i-doing-wrong)

我会建议[zigdon 的回答](https://stackoverflow.com/questions/159487/can-not-get-css-sticky-footer-to-work-what-am-i-doing-wrong#159558)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T19:09:08.753

[好的文章](http://matthewjamestaylor.com/blog/keeping-footers-at-the-bottom-of-the-page)和演示也关于将页脚保持在底部

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T14:17:39.620

对包裹主要内容的 div 应用最小高度，例如 style="min-height:400px"

# c# - C#中的邮件合并n份

> ID：298456
> 
> 赞同：0
> 
> 时间：2008-11-18T11:10:54.647
> 
> 标签：c#, automation, merge, ms-word, email

我只想创建一个 C# 程序，它将读取一个 word 模板并使用邮件合并功能创建它的 n 个副本。要替换的数据是名称和地址，模板中的其余内容应该保持不变。谁能告诉我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T10:29:58.650

我在 Java 中做到了这一点 - （断开的链接）[工作示例here](http://dinoch.dyndns.org:7070/WordML/AboutWordML.jsp) with source code。

想法是这样的：使用 MS-Word 设计和构建您要发送的文档。将其保存为 XML（Word-ML 或新的 .docx 格式）。然后，使用文本编辑器，将文档中的字段替换为占位符标签，例如名称应该放在哪里的@@NAME，以及地址的 @@ADDRESS 等。标签名称无关紧要。

然后，构建替换逻辑 - 使用 XSLT 甚至简单的基于字符串的替换函数，并用实际数据值迭代替换标记。保存每个修改过的文档。

十分简单。

您可以在 C# 中使用相同的设计 - 实际上它会更容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T11:31:35.760

您可以使用 Aspose.Word 来处理 Word 对象模型，而无需在程序应该运行的地方安装办公室（使用互操作），我正在使用 Aspose.Word 生成 Word 文档。

链接到 Aspose：[http ://www.aspose.com/categories/file-format-components/aspose.words-for-.net-and-java/default.aspx](http://www.aspose.com/categories/file-format-components/aspose.words-for-.net-and-java/default.aspx)

它工作得相当不错:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-19T21:07:15.440

我不确定您是否希望运行邮件合并或复制模板。我无法用 c# 帮助你，但是这个 VBA 片段可能会给你一些想法。

```
 strDir = CurrentProject.Path  

 strMailmergeDataFilename = strDir & Format(Now, "yymmdd_hhnnss") & ".txt"

' Create CSV from database for use with mailmerge '
' This is a separate function that simply exports the sql '
' ExportSQLToCSV SQL, strMailmergeDataFilename '

'Open merge template '
Set objWordDoc = GetObject(strDir & MergeDocumentFilename, "Word.Document")

objWordDoc.Application.Visible = True      

'Format:=0 ''0 = wdOpenFormatAuto'
'Add the data source '
objWordDoc.MailMerge.OpenDataSource _
    Name:=strMailmergeDataFilename, ConfirmConversions:=False, _
    ReadOnly:=False, LinkToSource:=True, AddToRecentFiles:=False, _
    PasswordDocument:="", PasswordTemplate:="", WritePasswordDocument:="", _
    WritePasswordTemplate:="", Revert:=False, Format:=0, _
    Connection:="", SQLStatement:="", SQLStatement1:=""

'Type some text at a bookmark, you could use .range property ' 
Selection.Goto What:=wdGoToBookmark, Name:="signaturetext"
Selection.TypeText Text:="You are here"

'Run mailmerge '
objWordDoc.MailMerge.Destination = 0 '0 = wdSendToNewDocument'

objWordDoc.MailMerge.Execute

objWordDoc.Application.ActiveDocument.PrintPreview 
```

# c# - 使用 .Net Interop 从 Excel 获取 DateTime 值时缺少毫秒

> ID：298458
> 
> 赞同：2
> 
> 时间：2008-11-18T11:12:31.180
> 
> 标签：c#, .net, excel, com-interop

如果我使用通过 .Net COM Interop 将 DateTime 值放入 Excel 单元格`Range.set_value`，然后使用 检索同一单元格`Range.get_value`的值，则不会返回值的毫秒部分，尽管其他一切都是正确的。

这是一个错误吗？

解决方法是什么？我猜测使用 Value2 属性可能会有所帮助。有没有其他人试过这个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T11:15:40.550

如果您在 Excel 中手动设置具有毫秒值的日期/时间，它会保持它吗？我不知道 Excel 内部对象模型，但可以想象它只是不支持毫秒。

编辑：好的，现在我们知道设置失败（当然，get 也可能失败）......您可以在通过[DateTime.ToOADate()](http://msdn.microsoft.com/en-us/library/system.datetime.tooadate.aspx)转换后尝试将其设置为双精度。我并不是说我抱有*很大*希望，但值得一试......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T11:42:48.747

正如[Jon 建议](https://stackoverflow.com/questions/298458/milliseconds-missing-when-getting-a-datatime-value-from-excel-using-net-interop#298467)的那样，如果您使用 Range.Value2 属性设置值，则使用 DateTime.ToOADate（然后再次使用 DateTime.FromOADate）将 DateTime 转换为双精度值。

此属性的唯一问题是，如果您还不知道，它不会告诉您单元格应该被视为 DateTime。我想要解决这个问题，您需要使用两遍方法：使用 Range.get_Value 获取单元格值以确定它们的类型，然后，对于任何 DateTime 单元格，使用 Range.Value2 再次获取它们的值，然后使用 DateTime 进行转换.FromOAD 日期。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T11:42:52.587

这可能是因为[此知识库文章](http://support.microsoft.com/kb/875526)中描述的问题。

在这种情况下，设置 Value2 属性应该有效。

# javascript - 哪个 HTML 元素失去焦点？

> ID：298459
> 
> 赞同：1
> 
> 时间：2008-11-18T11:13:04.690
> 
> 标签：javascript, focus

在javascript中，当我收到焦点事件时，如何确定哪个元素失去了焦点？我试图避免在我的网页中的所有元素上放置一个 onblur 事件处理程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T11:35:22.447

@pbrodka：target/srcElement 属性将引用具有焦点的元素以用于 onfocus 事件

顺便说一句，我看不出有什么方法可以让这个缺少 onblur，或者如果你关心的对象集都有焦点方法，你可以存储对该对象的引用。事件冒泡也有可能让你出狱

不过，这一切都感觉有点像代码味道 - 也许您需要更详细地描述问题

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T11:35:23.833

这很难。您不能使用事件委托来找出哪个控件最后产生了模糊，因为焦点/模糊不会冒泡。已经有人尝试“修复”这个问题，但它们有问题，而且跨浏览器不灵活。我能否问您为什么需要此信息，因为也许有替代解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T11:40:28.037

不幸的是，onblur 事件不会冒泡，否则您可以在窗口级别处理它以始终知道元素何时失去焦点。

事实上，我确实相信，正如你所说，没有为所有元素添加一个 onblur 事件处理程序将很难做到（一个真正令人讨厌的解决方案；-）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-09T12:50:09.130

如果您遵循 PPK 的建议，可以在此处委派焦点和模糊事件： [http ://www.quirksmode.org/blog/archives/2008/04/delegating_the.html](http://www.quirksmode.org/blog/archives/2008/04/delegating_the.html)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-18T12:19:12.340

最简单的解决方案是编写一个函数，遍历所有表单，然后遍历表单中的所有元素，并为每个表单安装一个 onblur 处理程序（这可能会调用一些全局函数）。该处理程序将获得一个事件，该事件将包含您寻求的信息。

这样，您只需在 body.onload 中调用此方法一次，无论您的文档多么复杂，它都会起作用。

唯一的缺点是，如果您将表单动态添加到当前文档，则需要调用它。在这种情况下，您必须确保不要再次安装处理程序（否则您会得到虚假的重复事件）。

# css - Firefox CSS：给定 2 个 div，我如何使用静态定位将 *第二个 * 向右浮动？

> ID：298460
> 
> 赞同：2
> 
> 时间：2008-11-18T11:13:30.587
> 
> 标签：css, firefox, html, css-float

我正在开发一个[Youtube 用户样式脚本](http://userstyles.org/styles/12154)，它与视频并排显示评论，这样您就可以同时观看视频和阅读评论（多么奇妙的想法 - 呃）。你可以在截图中看到我已经走了多远。这意味着我只关心 Firefox，而 CSS3 也一样。

我遇到的问题是我想制作一个完全流畅的布局并让“其他视频”div 向右浮动，而中间 div（评论）伸展以填充左侧 div（播放的视频）之间的剩余空间和正确的 div（“其他视频”）。

翻译成CSS，问题是：给定div“main”、“rightnav”和“footer”，在文档中这个固定的顺序，我怎样才能让rightnav div向右浮动，而footer在它下面呢？我设法做的最好的事情是绝对定位“rightnav”（右：0），但是页脚位于“主”div下方，而不是它们两个下方。我已经看过[Use CSS to reorder DIVs](https://stackoverflow.com/questions/220273/css-positioning-div-above-another-div-when-not-in-that-order-in-the-html)了。负 'top' 值不存在，因为它们取决于 'main' div 的内容。

这是源代码：

```
<html lang="en-US">
<head>
<style type="text/css">

#main {
   border: 1px solid;
   float: left;
   margin-right: 410px;
}

#rightnav {
   background-color: yellow;
   opacity: 0.5;
   border: 1px dotted;
   width: 400px;
   float: right;
   position: absolute;
   right: 0;
}

#footer {
   clear: both;
}   

</style>
</head>
<body>

<div id="baseDiv" style="width: 100%">
  <div id="main">
  <script>for (var i=1; i<100; i++) document.write('main ');</script>
  </div>

  <div id="rightnav">
  <script>for (var i=1; i<200; i++) document.write('rightnav ');</script>
  </div>

  <div id="footer">
  <script>for (var i=1; i<100; i++) document.write('footer ');</script>
  </div>

</div>

</body>
</html> 
```

希望很清楚我想要实现的目标：两个 div 下方的“页脚”和“主”div 流体。

感谢您的任何想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T11:51:48.653

```
#main {
   border: 1px solid;
   width: 50%;
   float: left;
}

#rightnav {
   background-color: yellow;
   opacity: 0.5;
   border: 1px dotted;
   width: 48%;
   float: right;
}

#footer {
   clear: both;
} 
```

这样就行了

编辑：如果您说液体通常意味着基于百分比的尺寸，请开始在您的脑海中关联类似的东西

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-11T00:44:14.613

This may or may not solve your problem, 3 column sized by percents uses floats, containing div sizes verticly to accomadate the tallest of the 3 panels, floats must appear first inline before middle panel, IE works funny with this, thinks this layout is naturaly inline, IE hack can be seen in style.

This works good for lots of stuff, other center margined elements may appear (#mid_con) and will stack, only problem is if left and right panel heights are shorter than first middle panel the second middle panel will take up the whole #tub_con in width cuz is 100% appearing stacked directly under first middle div. This can be fixed by giving a static width to (#mid_con), it will then always center and stay same size no matter if IE is centering it in the remaining space after floats or centers it to full width. if given a static width IE hack not needed, play with it and have fun. Appears that float does not remove a div completely from normal flow in IE, seems it just pushes proceeding elements to appear and conform to the left and right of the two floats,

```
 <!--BEGIN HEADER-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

 <title>float3col demo</title>

 <style>
  #tub_con{
  display:block;
  position:relative;
  text-align:center;
  width:500px;
  height:auto;
  margin-left:auto;
  margin-right:auto;
  border: solid #000000;
  }

  #left_nav{
  display:block;
  position:relative;
  float:left;
  height:80px;
  width:30%;

  max-width:30%;
  border: solid #000000;
  }
  #right_nav{
  display:block;
  position:relative;
  float:right;
  height:80px;
  width:30%;
  border: solid #000000;
  }
  #mid_cont{
  display:block;
  position:relative;
  padding-top:5px;
  margin-left:auto;
  margin-right:auto;
  height:auto;
  width:35%;
  border: solid #f86fff;
  }
  *html #mid_cont{
  display:block;
  position:relative;
  padding-top:5px;
  margin-left:auto;
  margin-right:auto;
  height:auto;
  width:100%;
  border: solid #f86fff;
  }

 </style>
</head>

<body style="text-align:center;">
<div id="tub_con">
<div id="left_nav"></div>
<div id="right_nav">
</div>
<div id="mid_cont">
x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x 
</div>

<!--Test the stacking problem
      <div id="mid_cont">
x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x 
</div>-->

<div style="clear:both;"></div>
</div>

<p style="width:100px; border:solid #000000; margin-left:auto; margin-right:auto;">
x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x
</p>
</body> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T11:35:26.360

你不应该需要 position: absolute; 在你右手的 div 上，也不在右边：0；定位。将 div 浮动到另一个向左浮动的 div 旁边（并且设置了边距），它们应该最终位于浏览器窗口的任一侧，左侧 div 扩展以填充可用空间（除了由创建的 10px 间隙你的保证金）。当您“绝对”定位一个对象时，您实际上是将其从文档的正常流程中移除，并且它将不再占用任何空间（也不会“推动”其他对象）。我怀疑在保持清晰的同时简单地从右手 div 中删除定位：两者；在页脚将解决您的问题。您可能还需要在源代码中交换左右手 div 的顺序，以便 float: right; 项目在浮动之前：左；物品。

PS 一直让我很恼火的是，你不能在 YouTube 上同时观看视频和阅读评论！

# html - CSS2 选择器和样式覆盖

> ID：298463
> 
> 赞同：4
> 
> 时间：2008-11-18T11:14:03.440
> 
> 标签：html, css

这是 HTML：

```
<div id="testBlue">
    <span>hello</span>
    <span id="testGreen" class="testGreen">hello2</span>
</div> 
```

如果我在 CSS 中设置：

```
#testBlue span { color:Blue; }    
.testGreen, #testGreen { color:Green; } 
```

如何覆盖第二个 SPAN 中的一般样式？

我已经尝试了 id 和 class 选择器，但它没有覆盖它。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-18T11:21:10.960

在 CSS 中，具有更高特异性的选择器会覆盖更通用的选择器。

In your example you defined a style for a **span inside a div with id = "testBlue"**. This selector is **more specific** than the simple selector for the class or id **testGreen**, so it wins. You just need a selector more specific than **#testBlue span**, that is not difficult to find:

```
#testBlue span.testGreen {
    color: green;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-18T11:18:49.593

不要像这样使用重要的给它更多的重量

```
#testBlue span { color:Blue; } 
#testblue #testgreen{color:Red} 
```

编辑

我被教导使用 !important 是不好的做法

css 中的某些对象在决定应用规则时具有不同的权重

见[http://htmldog.com/guides/cssadvanced/specificity/](http://htmldog.com/guides/cssadvanced/specificity/)

我认为使用重要但更好的做法来使用加权来获得特异性并没有错

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-18T11:16:08.943

```
#testGreen { color: red !important;} 
```

或者

```
.testGreen { color: red !important;} 
```

要么将覆盖继承的规则，因为`!important`将更多的权重放在其他平等决定的一侧。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T11:52:02.240

```
span#testGreen
{
    color: green;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T11:20:37.827

你可以使用选择器

```
#testBlue * { color:Blue; } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-08-01T09:50:59.947

You can also use the standard CSS DOM selectors (so you can drop the class names) like this:

```
#testblue > span:first-child + span{} 
```

testblue span THAT IS DIRECT DESCENDANT && FIRST-CHILD NEXT SIBLING span

# winapi - 如何从 COM-Addin (Outlook <=2003) 内部打开 WordMail，可靠地确定给定 Outlook 检查器窗口的窗口句柄？

> ID：298466
> 
> 赞同：3
> 
> 时间：2008-11-18T11:15:38.023
> 
> 标签：winapi, outlook, add-in, hwnd

[此代码从`Inspector.Activate`事件处理程序（第一次调用）中调用，即在实际显示检查器窗口之前。]

对于“本地”邮件检查员，我可以简单地 QI`Inspector`接口`IOleWindow`并调用其`GetWindow`方法。但是，这不适用于 Word 检查器，它们实际上是带有特殊工具栏的 Word 实例并且不实现`IOleWindow`.

（临时）设置`Inspector.Caption`为某个唯一值，然后查找具有该标题的窗口也不起作用，因为`Inspector`在使用 WordMail 选项时，访问大多数属性对实际检查器窗口没有（立即）影响。调用`Activate`然后立即查询也不能`GetForegroundWindow`可靠地工作：当已经打开了多个检查器或存在实际的 Word 窗口时，这通常只会返回“最旧”的实例而不是最新的实例。

多年来，我尝试了许多其他方法，但最终都证明它们在某种程度上存在缺陷。是否有一个相对简单的解决方案，或者我是否必须采用更复杂的方法，例如通过系统挂钩保留我自己的已知窗口句柄列表并尝试以某种方式将它们与已知检查员匹配？（向[P Daddy](https://stackoverflow.com/questions/295996/is-the-order-in-which-handles-are-returned-by-enumwindows-meaningful#296014)提示有关使用 CBT 钩子的提示）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-03-03T13:25:02.337

我现在想出了一些我还不能打破的新东西，但它仍然感觉很像伏都教。通过观察，我发现我想要的窗口总是似乎是第一个返回的窗口，[`EnumWindows`](http://msdn.microsoft.com/en-us/library/ms633497.aspx)但它不（尚未）可见，即[`IsWindowVisible`](http://msdn.microsoft.com/en-us/library/ms633530%28VS.85%29.aspx)返回`False`（请记住，我是`Inspector.Activate`在检查器显示之前从事件的第一次发生内部调用此代码首次）。

如果有人知道更好的解决方案或有充分理由解释为什么这样做（最好带有权威文档的链接），请发表回复。

**更新：**所以，根据要求，这里有一些实际的（Delphi）代码。请注意，这不是我的工作代码，其中包含与此问题无关的其他一些内容，这些内容已在此处删除。

```
function GetWindowClassName(const AHandle: HWND): String;
var
  lClass: array[0..255] of Char;
begin
  if GetClassName(AHandle, lClass, SizeOf(lClass)) > 0 then
    Result := lClass
  else
    Result := '';
end;

type
  TWordSearchInfo = record
    Result: HWND;
  end;
  PWordSearchInfo = ^TWordSearchInfo;

function CheckWnd(AWnd: HWND; ASearchInfo: PWordSearchInfo): Boolean; stdcall;
begin
  Result := True;
  try
    if GetWindowClassName(AWnd) = 'OpusApp' then
      if not IsWindowVisible(AWnd) then
        begin
          ASearchInfo.Result := AWnd;
          Exit(False);
        end;
  except
    //plop!
  end;
end;

function GetNewestWordHandle: Cardinal;
var
  lSearchInfo: TWordSearchInfo;
begin
  lSearchInfo.Result := 0;
  EnumWindows(@CheckWnd, Integer(@lSearchInfo));
  Result := lSearchInfo.Result;
end; 
```

**注意：**我只在检查员的 -event 中使用此功能，`Activate`并且当 Outlook 主要版本 < 12 并且检查员的`IsWordMail`-property 为`True`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-14T12:53:03.317

我发现在自定义Inspector的Constructor上，可以使用下面的方法找到新建的Inspector。

C＃

`inspectorWindow = Win32.FindWindowEx(IntPtr.Zero, IntPtr.Zero, "OpusApp", "Microsoft Word");`

您必须在构造函数上执行此操作，然后标题成为消息的标题（新消息上的“无标题消息”）。我假设如果您已经打开了一条名为 Microsoft Word 的消息，则可能会因为歧义而出现错误，但发生这种情况的可能性有点低。

# ruby-on-rails - 什么缓存策略最适合这个问题？

> ID：298479
> 
> 赞同：1
> 
> 时间：2008-11-18T11:21:37.543
> 
> 标签：ruby-on-rails, caching

首先，让我说我对 Rails 很陌生，只使用了几天。

我的第一个应用程序与传统应用程序略有不同：在我的一个模型类中，我有一部分数据是从数据库中提取的，另一部分是通过对外部资源执行 HTTP REST 请求获取的。

我已经为“外部”资源实现了延迟加载，但是每次用户点击需要与该资源绑定的字段之一的页面时，我都会重新执行 HTTP 请求，这显然无法扩展。

我的问题是：对于这种情况，您认为哪种缓存策略值得？如何仅为通过 HTTP 延迟加载的数据提供缓存？我想实现一个缓存，它可以按时间（比如说 5 分钟）或当用户执行应该使当前缓存无效的操作时过期。

我该如何实现它以及保留这些缓存的内存权衡是什么？是否建议将该数据保存在会话中或服务器上的单独结构中？我应该考虑使用 GigaSpaces 等外部缓存框架之一吗？

提前感谢您针对此问题提供的任何提示。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T12:04:12.027

我会推荐以下两种策略之一：

1.  使用[memcached](http://www.danga.com/memcached/)，开源缓存守护进程。客户端库可用于几种流行的语言，它支持缓存数据的计划失效等。
2.  在数据库中包含一些字段以存储缓存数据，以及每次保存记录时更新的“cache_last_updated”字段。然后，当从数据库中获取记录时，如果该字段的值超过 5 分钟，您可以从 RESTful API 重新缓存数据（您没有使用 CouchDB 是吗？）并将其保存在数据库中，更新最后更新的时间戳，然后将此数据返回给用户。

我推荐第一个，因为坦率地说，否则您将在每个请求中对数据库进行多次读取和写入，从而导致显着的性能成本。

此外，这个问题可能适用于 Ruby on Rails 以外的其他事物——很多场景都涉及来自某些外部源的缓存。

# c# - 如何仅禁用一个控件而不是其子控件的视觉样式？

> ID：298486
> 
> 赞同：10
> 
> 时间：2008-11-18T11:25:56.317
> 
> 标签：c#, .net, winforms, tabcontrol

我在 TabControl 中有一个 TabControl。我希望外部 TabControl 在左侧显示其选项卡。但是，启用视觉样式后，左对齐的 TabControl 无法正确显示。我可以只为外部 TabControl 禁用视觉样式吗？

我知道第三方 TabControl 替代品 - 这不是我所追求的。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-18T20:15:46.153

向您的项目添加一个新类并粘贴如下所示的代码。建造。将新控件从工具箱顶部拖放到表单上。子控件的视觉样式被保留。

```
using System;
using System.Windows.Forms;
using System.Runtime.InteropServices;

public class FixedTabControl : TabControl {
  [DllImportAttribute("uxtheme.dll")]
  private static extern int SetWindowTheme(IntPtr hWnd, string appname, string idlist);

  protected override void OnHandleCreated(EventArgs e) {
    SetWindowTheme(this.Handle, "", "");
    base.OnHandleCreated(e);
  }
} 
```

# wpf - 在 activex 而不是 Win32 App 中托管 WPF 控件

> ID：298490
> 
> 赞同：2
> 
> 时间：2008-11-18T11:27:52.803
> 
> 标签：wpf, activex

我正在搜索包含 WPF 控件的 activex 示例。

我能够在测试activex容器中注册activex期间看到控件，但是当我实例化它时，我看不到WPF，但在OnDraw中编码了什么。

有什么提示或例子吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-06-16T23:40:10.437

根据“WPF 4 Unleashed”：

常见问题解答：反之亦然——将 WPF 控件公开为 ActiveX 控件？

除了 HWND 互操作性之外，没有对此的内置支持，因此最好的办法是使用您最喜欢的方法来创建非 WPF ActiveX 控件（例如，使用活动模板库 [ATL]）并在其中注入 WPF 内容它。

# c# - 当用户在表单窗口外单击时，如何关闭表单？

> ID：298491
> 
> 赞同：7
> 
> 时间：2008-11-18T11:29:20.943
> 
> 标签：c#, forms, click

如果用户单击它之外的任何位置，我想关闭 System.Windows.Forms.Form。我尝试过使用 IMessageFilter，但即便如此，也没有任何消息传递给 PreFilterMessage。如何接收表单窗口外的点击？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T11:36:51.803

在表单的 Deactivate 事件中，输入“this.Close()”。一旦您单击 Windows 中的其他任何位置，您的表单就会关闭。

更新：我认为您现在拥有的是一个音量按钮，在 Click 事件中，您创建了一个 VolumeSlider 表单的实例，并通过调用 ShowDialog() 使其出现，该方法会阻塞直到用户关闭弹出的表单。在下一行中，您读取用户选择的卷并在您的程序中使用它。

这没关系，但正如您所注意到的，它强制用户显式关闭弹出窗口以返回主程序。Show() 是您真正想在弹出表单上使用的方法，但 Show() 不会阻塞，这意味着主表单上的 Click 事件在不知道新卷应该是什么的情况下完成。

一个简单的解决方案是在主窗体上创建一个公共方法，如下所示：

```
public void SetVolume(int volume)
{
    // do something with the volume - whatever you did before with it
} 
```

然后，在音量按钮的 Click 事件中（也在主窗体上），使 VolumeSlider 看起来像这样：

```
VolumeSlider slider = new VolumeSlider();
slider.Show(this); // the "this" is needed for the next step 
```

在 VolumeSlider 表单中，当用户使用（我猜）滚动条时，您将此代码放在滚动条的 ValueChanged 事件中（我认为就是这样）：

```
MainForm owner = (MainForm)this.Owner;
owner.SetVolume(scrollbar.Value); 
```

然后在 VolumeSlider 表单的 Deactivate 事件中，您将 this.Close() 如上所述。然后，您的表单将按预期运行。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-19T08:57:51.983

感谢[p-daddy](https://stackoverflow.com/users/36388/p-daddy)在[这个问题](https://stackoverflow.com/questions/298626/what-do-these-wndproc-codes-mean)中，我找到了这个允许我使用 ShowDialog 的解决方案：

```
protected override void OnShown(EventArgs e)
{
    base.OnShown(e);
    this.Capture = true;
}

protected override void OnCaptureChanged(EventArgs e)
{
    if (!this.Capture)
    {
        if (!this.RectangleToScreen(this.DisplayRectangle).Contains(Cursor.Position))
        {
            this.Close();
        }
        else
        {
            this.Capture = true;
        }
    }

    base.OnCaptureChanged(e);
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-07-31T15:10:04.813

使用西蒙的解决方案，我遇到了诺姆描述的相同问题。使用以下代码，我避免了“点击通过”问题...

```
protected override void WndProc(ref Message m)
{    
    base.WndProc(ref m);

    // if click outside dialog -> Close Dlg
    if (m.Msg == NativeConstants.WM_NCACTIVATE) //0x86
    {
        if (this.Visible)
        {
            if (!this.RectangleToScreen(this.DisplayRectangle).Contains(Cursor.Position))
                this.Close();
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-08-27T02:43:36.977

您应该使用**Deactivate**：
我有一个名为**Form2**的表单。
在“**属性**”窗口的“**停用**”部分。 您声明名称**Form2_Deactivate**。 在**Form2.cs**文件中：

 ******```
private void Form2_Deactivate(object sender, EventArgs e)
{
    this.Close();
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T11:32:09.377

如果它是 MDI 应用程序中的子窗体，则可以在父窗体中捕获单击，否则解决方案会很混乱。

无论如何，我不相信您的建议代表直观的 UI 行为。你确定这是最好的设计吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T12:18:47.693

如果您尝试制作一个行为有点像菜单的弹出窗口，除了它允许您与控件交互之外，您可以尝试在工具条下拉列表中托管用户控件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-12-16T18:35:11.677

简单的方法：在 Form1 上使用此代码调用 form2：

```
Private Sub Button1_Click(sender As Object, e As EventArgs) Handles     Button1.Click
    Form2.Owner = Me
    Form2.Show()
End Sub 
```

然后再次在 form1 上使用此代码：

```
Private Sub Form1_MouseClick(sender As Object, e As MouseEventArgs) Handles Me.MouseClick
    If Form2.IsHandleCreated = True Then
        Form2.Close()
    End If
End Sub 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-03-17T11:13:03.910

这很简单：

```
private void button1_Click(object sender, EventArgs e)
    {
        Form f = new Form();
        f.LostFocus +=new EventHandler(f_LostFocus);
        f.Show();
    }

    void f_LostFocus(object sender, EventArgs e)
    {
        Form f = sender as Form;
        f.Close();
        f.Dispose();
    } 
```

# sql-server - 将 NVARCHAR 转换为 INT 跳过不可转换

> ID：298493
> 
> 赞同：0
> 
> 时间：2008-11-18T11:30:47.337
> 
> 标签：sql-server, tsql

我需要查询一个设计的数据库，以便 NVARCHAR 列保持客户的年龄。我希望组客户使用

```
GROUP BY age / 10 
```

但是当引擎遇到像'20.10.1984'这样的字符串时（有人输入了他的生日而不是年龄），我的查询失败了。

“坏”年龄的百分比非常小，所以我只想跳过年龄不能转换为 INT 的记录。

有没有简单的方法来做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T11:51:17.547

添加一个 WHERE IsNumeric(age) = 1

像这样：

```
CREATE TABLE #temp (age NVARCHAR(20))

INSERT INTO #temp
    SELECT '22'
    UNION
SELECT '24'
    UNION
SELECT '20.10.1984'
    UNION
SELECT '50'

SELECT age/10, COUNT(*)
    FROM #temp
    WHERE ISNUMERIC(age) = 1
    GROUP BY age/10

DROP TABLE #temp 
```

# sql - 如何批量修改所有 sql server 代理作业中的作业步骤命令

> ID：298494
> 
> 赞同：6
> 
> 时间：2008-11-18T11:31:05.527
> 
> 标签：sql, sql-server, sql-server-2005, sql-server-agent

我有许多工作需要将 1 封特定电子邮件发送到人员列表。该收件人列表在 step 命令中是硬编码的，我需要在所有作业中从该列表中删除一个人。

如何循环遍历 Sql Server 代理中的所有作业并修改命令文本以查找+替换特定的文本。

我正在使用 sql server 2005 并且已经查看了 sp_update_jobStep 但似乎并不是我想要的。

干杯。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-18T14:00:14.757

您可以尝试直接更新保存 SQL 服务器作业信息的系统表。与您相关的将是：

```
msdb.dbo.SysJobs
msdb.dbo.SysJobSteps 
```

如果您有特定的电子邮件地址要删除，您可以使用单个 UPDATE 语句更新**SysJobSteps表中的****Command**字段。

 **```
UPDATE SJS SET
    Command = REPLACE(Command, 'EmailAddress&TestDomain.Com', '')
FROM msdb.dbo.SysJobs SJ
INNER JOIN msdb.dbo.SysJobSteps SJS
    ON SJS.Job_Id = SJ.Job_Id
WHERE SJ.Originating_server = ..... -- Your server here
    AND SJS.Command LIKE '%EmailAddress@TestDomain.Com%' 
```

建议首先将上述查询作为 SELECT 语句运行，以测试它仅返回您期望更新的作业步骤。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-04-02T15:54:18.910

如果有人还在寻找这个，那么下面应该做。不是最好的代码，但可以完成工作。

```
/*
Replace the below statement with the actual keyword to be replaced:
INSERT INTO SP_Keyword VALUES
('sys.databases3', 'sys.databases5')
,('sysjobs3', 'sysjobs5')

Here we are replacing sys.databases3 and sysjobs3 
with sys.databases5 and sysjobs5 respectively.

Script only searches in 'TSQL', 'Powershell', 'CMDEXEC' job type.
*/

SET NOCOUNT ON

use msdb
GO

DECLARE @OldV VARCHAR(max) 
DECLARE @NEWV VARCHAR(max)
DECLARE @job_id2 varchar(max)
DECLARE @step_id2 varchar(10)
DECLARE @command2 varchar(max)
DECLARE @command3 varchar(300)

--CLEANUP TASKS
IF EXISTS(SELECT * FROM sys.tables where name = 'SP_Keyword')
    DROP TABLE SP_Keyword

CREATE TABLE SP_Keyword
(
old_keyword varchar(200),
new_keyword varchar(200)
)

--DEBUG STATEMENT
--PRINT 'SP_Keyword TABLE CREATED'

INSERT INTO SP_Keyword VALUES
('sys.databases3', 'sys.databases5')
,('sysjobs3', 'sysjobs5')

--DEBUG STATEMENT
--PRINT 'VALUES INSERTED FOR KEYWORD'

CREATE TABLE #jobs(
    [name] [sysname] ,
    [step_name] [sysname] ,
    [subsystem] [varchar](40) ,
    [command] [varchar](max) ,
    [keyword] [varchar](200) ,
    [database_name] [sysname] ,
    [enabled] [tinyint] ,
    [description] [varchar](512) ,
    [date_created] [datetime] ,
    [job_id] [uniqueidentifier] ,
    [step_id] [int]     
)

DECLARE db_cursor3 CURSOR FOR  
SELECT old_keyword FROM SP_Keyword
    OPEN db_cursor3   
    FETCH NEXT FROM db_cursor3 INTO @OldV

    WHILE @@FETCH_STATUS = 0   
    BEGIN   
        INSERT INTO #jobs
        SELECT a.name as job_name, b.step_name, b.subsystem, 
        b.command, @OldV as 'keyword', b.database_name, a.enabled, 
        a.description, a.date_created, b.job_id, b.step_id
        FROM [dbo].[sysjobsteps] as b
        INNER JOIN sysjobs as a
        ON a.job_id = b.job_id
        WHERE [command] LIKE '%'+@OldV+'%'
        AND [subsystem] IN ('TSQL', 'Powershell', 'CMDEXEC')

        FETCH NEXT FROM db_cursor3 INTO @OldV
    END   

    CLOSE db_cursor3   
    DEALLOCATE db_cursor3

IF NOT EXISTS(SELECT * FROM #jobs)
    BEGIN
    PRINT 'NO JOBS FOUND TO BE REPLACED'
    GOTO SKIPPER
    END
--SELECT name as job_name, step_name, command, keyword, database_name, enabled, description, date_created FROM #jobs

    DECLARE db_cursor3 CURSOR FOR  
    SELECT * FROM SP_Keyword

    OPEN db_cursor3   
    FETCH NEXT FROM db_cursor3 INTO @OldV,@newV

    WHILE @@FETCH_STATUS = 0   
    BEGIN   
        UPDATE #jobs SET command=REPLACE(command,@oldV,@NewV)
          WHERE command LIKE '%'+@OldV+'%'
           FETCH NEXT FROM db_cursor3 INTO @oldV,@NewV
    END   

    CLOSE db_cursor3   
    DEALLOCATE db_cursor3

    print 'COMMAND TO REPLACE JOB STEPS IS BEING EXECUTED'

    DECLARE db_cursor3 CURSOR FOR  
    SELECT job_id, step_id, command FROM #jobs

    OPEN db_cursor3   
    FETCH NEXT FROM db_cursor3 INTO @job_id2,@step_id2, @command2

    WHILE @@FETCH_STATUS = 0   
    BEGIN   
        SET @command3 = 'sp_update_jobstep @job_id = '''+@job_id2+''' ,@step_id = '+@step_id2+', @command = '''+@command2+''''
        PRINT @command3
        EXEC(@command3)
        FETCH NEXT FROM db_cursor3 INTO @job_id2,@step_id2, @command2
    END   

    CLOSE db_cursor3   
    DEALLOCATE db_cursor3

SKIPPER:
DROP TABLE #jobs
DROP TABLE SP_Keyword
PRINT 'CLEANUP DONE'
PRINT 'PROGRAM COMPLETE' 
```

# flash - 使用 Flash CS4 开发和调试 FLA 文件中的组件

> ID：298502
> 
> 赞同：1
> 
> 时间：2008-11-18T11:34:56.923
> 
> 标签：flash, actionscript-3

我创建了一个小型 Flash CS4 项目，其中包含一些自定义组件（AS 3），可以相互通信。

是否可以制作一个以源格式（作为 .AS 文件）指向这些组件的 FLA 文件，而无需首先单独编译这些组件并复制到 /flash/components 文件夹？

我想要一种在开发/调试时更改组件源代码的简单方法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-19T23:56:50.840

简单的答案是否定的......假设这些类没有在同一个文件中编译（单个引用就足以自动这样做）。

如果您将组件放在单独的 SWF 中，我猜问题是您不想每次都手动编译所有内容？如果是这样，ANT 是一个很好的自动化编译工具，等等。它不完全适合初学者，但通过一些谷歌搜索，您会发现大量信息。ANT 也非常适合其他耗时的重复性任务，例如，您可以自动压缩内容或提交到 svn。使用（例如）[BigSource](http://blog.bigsource.de/)，您也可以使用 Flex SDK 中的 FCSH，这将使编译*速度*更快。

另一个更简单但不太灵活的替代方案是 flash 项目（假设所有组件都有自己的 fla）。有了它，您可以简单地批量编译一个项目中的所有 fla。你可能很快就会碰壁并意识到 ANT 更好，但这是一个开始；）

# javascript - 如何使用 JavaScript 检查 URL 中的#hash？

> ID：298503
> 
> 赞同：866
> 
> 时间：2008-11-18T11:35:02.087
> 
> 标签：javascript, jquery, anchor, fragment-identifier

我有一些 jQuery/JavaScript 代码，我只想`#`在 URL 中有哈希 () 锚链接时运行。如何使用 JavaScript 检查这个字符？我需要一个简单的包罗万象的测试来检测这样的 URL：

*   `example.com/page.html#anchor`
*   `example.com/page.html#anotheranchor`

基本上是这样的：

```
if (thereIsAHashInTheUrl) {        
    do this;
} else {
    do this;
} 
```

如果有人能指出我正确的方向，那将不胜感激。

* * *

## 回答 #1

> 赞同：1556
> 
> 时间：2008-11-18T11:37:00.617

[位置哈希](https://developer.mozilla.org/en-US/docs/Web/API/Location/hash)的简单使用：

```
if(window.location.hash) {
  // Fragment exists
} else {
  // Fragment doesn't exist
} 
```

* * *

## 回答 #2

> 赞同：370
> 
> 时间：2011-07-13T16:46:34.490

```
 if(window.location.hash) {
      var hash = window.location.hash.substring(1); //Puts hash in variable, and removes the # character
      alert (hash);
      // hash found
  } else {
      // No hash found
  } 
```

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2008-11-18T11:41:10.123

放置以下内容：

```
<script type="text/javascript">
    if (location.href.indexOf("#") != -1) {
        // Your code in here accessing the string like this
        // location.href.substr(location.href.indexOf("#"))
    }
</script> 
```

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2012-03-08T10:42:21.000

如果 URI 不是文档的位置，则此代码段将执行您想要的操作。

```
var url = 'example.com/page.html#anchor',
    hash = url.split('#')[1];

if (hash) {
    alert(hash)
} else {
    // do something else
} 
```

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2008-11-18T11:37:01.270

你试过这个吗？

```
if (url.indexOf('#') !== -1) {
    // Url contains a #
} 
```

`url`（显然，您要检查的 URL在哪里。）

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2011-08-31T13:44:31.440

```
$('#myanchor').click(function(){
    window.location.hash = "myanchor"; //set hash
    return false; //disables browser anchor jump behavior
});
$(window).bind('hashchange', function () { //detect hash change
    var hash = window.location.hash.slice(1); //hash to string (= "myanchor")
    //do sth here, hell yeah!
}); 
```

这将解决问题;）

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2013-04-27T18:31:45.743

```
window.location.hash 
```

将返回哈希标识符

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2012-04-19T13:18:42.103

...或者有一个 jquery 选择器：

```
$('a[href^="#"]') 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2010-07-05T22:23:38.627

您可以执行以下操作来定期检查哈希值的变化，然后调用函数来处理哈希值。

```
var hash = false; 
checkHash();

function checkHash(){ 
    if(window.location.hash != hash) { 
        hash = window.location.hash; 
        processHash(hash); 
    } t=setTimeout("checkHash()",400); 
}

function processHash(hash){
    alert(hash);
} 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-06-07T23:58:31.510

```
function getHash() {
  if (window.location.hash) {
    var hash = window.location.hash.substring(1);

    if (hash.length === 0) { 
      return false;
    } else { 
      return hash; 
    }
  } else { 
    return false; 
  }
} 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2013-09-05T17:32:24.833

大多数人都知道 document.location 中的 URL 属性。如果您只对当前页面感兴趣，那就太好了。但问题是关于能够解析页面上的锚点而不是页面本身。

大多数人似乎错过的是，这些相同的 URL 属性也可用于锚元素：

```
// To process anchors on click    
jQuery('a').click(function () {
   if (this.hash) {
      // Clicked anchor has a hash
   } else {
      // Clicked anchor does not have a hash
   }
});

// To process anchors without waiting for an event
jQuery('a').each(function () {
   if (this.hash) {
      // Current anchor has a hash
   } else {
      // Current anchor does not have a hash
   }
}); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2013-07-06T10:37:35.383

```
var requestedHash = ((window.location.hash.substring(1).split("#",1))+"?").split("?",1); 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-02-20T22:42:13.173

上面的 Partridge 和 Gareths 的评论很棒。他们应该得到一个单独的答案。显然，任何 html Link 对象都可以使用 hash 和 search 属性：

```
<a id="test" href="foo.html?bar#quz">test</a>
<script type="text/javascript">
   alert(document.getElementById('test').search); //bar
   alert(document.getElementById('test').hash); //quz
</script> 
```

或者

```
<a href="bar.html?foo" onclick="alert(this.search)">SAY FOO</a> 
```

如果您需要在常规字符串变量上使用它并且碰巧有 jQuery，这应该可以工作：

```
var mylink = "foo.html?bar#quz";

if ($('<a href="'+mylink+'">').get(0).search=='bar')) {
    // do stuff
} 
```

（但它可能有点过头了..）

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2013-09-10T13:58:13.893

在这里将其作为一种从任意类似 URI 的字符串中抽象位置属性的方法。虽然`window.location instanceof Location`是真的，但任何调用尝试`Location`都会告诉你它是一个非法的构造函数。您仍然可以通过将字符串设置为DOM 锚元素的属性来获得诸如`hash`,`query`等内容，然后它将与.`protocol``href``window.location`

最简单的方法是：

```
var a = document.createElement('a');
a.href = string;

string.hash; 
```

为方便起见，我编写了一个小库，利用它来替换原生`Location`构造函数，它可以接受字符串并生成`window.location`类似对象：[Location.js](https://gist.github.com/barneycarroll/5310151)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-06-20T18:18:19.180

通常点击先于位置更改，因此在点击后设置TimeOut 以获取更新的window.location.hash 是一个好主意

```
$(".nav").click(function(){
    setTimeout(function(){
        updatedHash = location.hash
    },100);
}); 
```

或者您可以通过以下方式收听位置：

```
window.onhashchange = function(evt){
   updatedHash = "#" + evt.newURL.split("#")[1]
}; 
```

我写了一个[jQuery 插件](https://github.com/rgarro/Route32)，它可以做你想做的事情。

这是一个简单的锚路由器。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-11-29T11:22:07.160

这是一个返回`true`或`false`（有/没有标签）的简单函数：

```
var urlToCheck = 'http://www.domain.com/#hashtag';

function hasHashtag(url) {
    return (url.indexOf("#") != -1) ? true : false;
}

// Condition
if(hasHashtag(urlToCheck)) {
    // Do something if has
}
else {
    // Do something if doesn't
} 
```

`true`在这种情况下返回。

基于@jon-skeet 的评论。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-10-13T11:32:50.127

[您可以使用现代 JS](https://developer.mozilla.org/en-US/docs/Web/API/URL/URL)解析 url ：

```
var my_url = new URL('http://www.google.sk/foo?boo=123#baz');

my_url.hash; // outputs "#baz"
my_url.pathname; // outputs "/moo"
​my_url.protocol; // "http:"
​my_url.search; // outputs "?doo=123" 
```

没有哈希的 url 将返回空字符串。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-07-18T09:31:01.870

这是测试当前页面 URL 的简单方法：

```
 function checkHash(){
      return (location.hash ? true : false);
  } 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-04-15T01:17:23.103

我注意到所有这些答案都主要检查 window.location.hash 并且难以编写测试。

```
 const hasHash = string => string.includes('#') 
```

您还可以从 url 中删除哈希，如下所示：

```
const removeHash = string => {
 const [url] = string.split('#')
 return url
} 
```

最后，您可以将逻辑组合在一起：

```
if(hasHash(url)) {
 url = removeHash(url)
} 
```

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2014-10-27T08:45:24.113

有时您会得到完整的查询字符串，例如“#anchorlink?firstname=mark”

这是我获取哈希值的脚本：

```
var hashId = window.location.hash;
hashId = hashId.match(/#[^?&\/]*/g);

returns -> #anchorlink 
```

# javascript - 我在哪里可以获得 JSONRequestError 代码？

> ID：298507
> 
> 赞同：0
> 
> 时间：2008-11-18T11:35:57.483
> 
> 标签：javascript, ajax, json

按照[JSONRequest 提议](http://www.json.org/JSONRequest.html)，我找到[了 JSONRequest 对象的代码](http://www.devpro.it/code/153.html)。但是，此对象依赖于 JSONRequestError，并且找不到该对象的代码。

有人知道我在哪里可以找到代码吗？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-01-01T22:05:06.243

对于这样一个备受推崇且记录良好的库，找到下载链接是荒谬的，但这里有：

*   [JSONRequest.javascript](http://devpro.it/javascript_id_152.html)
*   [JSONRequestError.javascript](http://devpro.it/javascript_id_153.html)

（第二个，正如那家伙以一种难以理解的方式所说的那样——所有的编码人员似乎都解释了一半！）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T12:49:27.413

我在 Google 中使用了请求`JSONRequestError site:devpro.it`，这是一个有用的提示... ^_^

找到解释 API 的[JSONRequestError.js](http://www.devpro.it/JSON/files/JSONRequestError-js.html "JSONRequestError.js")，而且……嗯，没有源代码！

刚刚戳了一下神奇的数字 153，很幸运：[JSONRequestError.js](http://www.devpro.it/code/152.html "JSONRequestError.js") :-D

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-17T04:37:30.190

该站点有点迟钝，但是您可以在以下位置找到该人编写的所有内容（相当有用的东西）
：
[http](http://devpro.it/) ://devpro.it/ 实际的 json 代码在这里：
[http ://devpro.it/javascript_9 .html](http://devpro.it/javascript_9.html)
（也是所有文件的打包版本！非常方便）

# c - 如何在 C 程序中获取当前目录？

> ID：298510
> 
> 赞同：196
> 
> 时间：2008-11-18T11:36:29.043
> 
> 标签：c, unix, working-directory

我正在制作一个 C 程序，我需要在其中获取程序启动的目录。该程序是为 UNIX 计算机编写的。我一直在看`opendir()`and `telldir()`，但`telldir()`返回 a `off_t (long int)`，所以它真的对我没有帮助。

如何获取字符串（字符数组）中的当前路径？

* * *

## 回答 #1

> 赞同：349
> 
> 时间：2008-11-18T11:38:24.747

你看过[`getcwd()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/getcwd.html)吗？

```
#include <unistd.h>
char *getcwd(char *buf, size_t size); 
```

简单的例子：

```
#include <unistd.h>
#include <stdio.h>
#include <limits.h>

int main() {
   char cwd[PATH_MAX];
   if (getcwd(cwd, sizeof(cwd)) != NULL) {
       printf("Current working dir: %s\n", cwd);
   } else {
       perror("getcwd() error");
       return 1;
   }
   return 0;
} 
```

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-11-18T11:37:30.257

查找手册页`getcwd`。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2015-07-18T02:39:43.273

虽然这个问题被标记为 Unix，但当他们的目标平台是 Windows 时，人们也可以访问它，而 Windows 的答案是[`GetCurrentDirectory()`](https://msdn.microsoft.com/en-us/library/windows/desktop/aa364934%28v=vs.85%29.aspx)函数：

```
DWORD WINAPI GetCurrentDirectory(
  _In_  DWORD  nBufferLength,
  _Out_ LPTSTR lpBuffer
); 
```

这些答案适用于 C 和 C++ 代码。

^([user4581301](https://stackoverflow.com/users/4581301/user4581301)在对另一个问题的[评论](https://stackoverflow.com/questions/31487046/getting-the-output-of-cd-or-simply-getting-the-current-directory#comment50938605_31487046)中建议的链接，并通过 Google 搜索“site:microsoft.com getcurrentdirectory”验证为当前首选。)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-12-18T22:39:39.670

```
#include <stdio.h>  /* defines FILENAME_MAX */
//#define WINDOWS  /* uncomment this line to use it for windows.*/
#ifdef WINDOWS
#include <direct.h>
#define GetCurrentDir _getcwd
#else
#include <unistd.h>
#define GetCurrentDir getcwd
#endif

int main(){
  char buff[FILENAME_MAX];
  GetCurrentDir( buff, FILENAME_MAX );
  printf("Current working dir: %s\n", buff);
  return 1;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-10-23T19:01:58.460

请注意， Microsoft 的 libc: [getcwd(3)](https://msdn.microsoft.com/en-us/library/sf98bd4y(v=vs.90).aspx)`getcwd(3)`也提供了它，并且工作方式与您期望的相同。

必须与`-loldnames`（oldnames.lib，在大多数情况下自动完成）链接，或使用`_getcwd()`. 无前缀版本在 Windows RT 下不可用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-02-04T13:25:43.187

要获取当前目录（执行目标程序的位置），您可以使用以下示例代码，该代码适用于 Visual Studio 和 Linux/MacOS(gcc/clang)，适用于 C 和 C++：

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#if defined(_MSC_VER)
#include <direct.h>
#define getcwd _getcwd
#elif defined(__GNUC__)
#include <unistd.h>
#endif

int main() {
    char* buffer;

    if( (buffer=getcwd(NULL, 0)) == NULL) {
        perror("failed to get current directory\n");
    } else {
        printf("%s \nLength: %zu\n", buffer, strlen(buffer));
        free(buffer);
    }

    return 0;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-12-22T19:05:06.533

使用 **getcwd**

```
#include <stdio.h>  /* defines FILENAME_MAX */
//#define WINDOWS  /* uncomment this line to use it for windows.*/
#ifdef WINDOWS
#include <direct.h>
#define GetCurrentDir _getcwd
#else
#include <unistd.h>
#define GetCurrentDir getcwd
#endif

int main(){
  char buff[FILENAME_MAX];
  GetCurrentDir( buff, FILENAME_MAX );
  printf("Current working dir: %s\n", buff);
  return 1;
} 
```

或者

```
#include<stdio.h>
#include<unistd.h> 
#include<stdlib.h>

main() {
char *buf;
buf=(char *)malloc(100*sizeof(char));
getcwd(buf,100);
printf("\n %s \n",buf);
} 
```

# c# - 当 Web 服务 URL 无法访问时，如何在 Windows Mobile 中显示“无法连接”对话框？

> ID：298511
> 
> 赞同：5
> 
> 时间：2008-11-18T11:36:35.517
> 
> 标签：c#, .net, windows-mobile, compact-framework, mobile

在没有互联网连接的 Windows Mobile 上，当我尝试使用 Internet Explorer 浏览网页时，我得到无法连接屏幕顶部的信息。它说无法连接当前的连接设置。要更改连接设置，请点按设置。我可以点击设置并设置网络连接。如何以编程方式显示无法连接信息？当我无法使用我的应用程序连接到 Web 服务时，我想显示相同的信息并让用户设置网络连接。我使用紧凑框架 2.0 和 csharp。

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-18T15:03:16.737

通过启用第三方程序的通知

```
"Start > Settings > Sounds & Notifications" 
```

可能会有所帮助（至少如果您使用 ConnectionManager，例如通过 HttpWebRequest）。

问候，坦伯格

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T12:58:32.963

这不是最好的答案，我希望有人有更好的答案，但是：当您的应用程序无法访问 Web 服务时，您可以做的一件事是使用 Process 类（在 System.Diagnostics 中）启动您的 Web 服务 URL在 Internet Explorer 中（又名“脱壳”）。

这将导致 IE 出现，并且由于它也看不到 web 服务，它将显示您需要的设置对话框。一旦您更改设置以便可以看到 Web 服务，您只需关闭 IE，现在您就回到了您的应用程序（现在可以看到 Web 服务）。

# asp.net - 支持拖放的 ASP.NET Treeview 控件？

> ID：298519
> 
> 赞同：3
> 
> 时间：2008-11-18T11:38:27.057
> 
> 标签：asp.net, custom-server-controls

任何人都可以为 ASP.NET 推荐一个支持拖放的树视图组件（在它自己的节点之间 - 它用于内容管理系统重新排列页面）。不要介意它是开源的还是商业的（虽然不能完全延伸到[Telerik 的树视图](http://demos.telerik.com/ASPNET/Prometheus/Treeview/Examples/Functionality/DragAndDropNodes/DefaultCS.aspx)）。耻辱..

还有其他选择吗？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T11:43:04.583

如果您可以扩展到包括 jQuery（免费），那么有一个客户端树可以拖放[jstree](http://jstree.com/jsTree/examples/_opers/moving.html)。您只需要实现 ajax 挂钩来处理树结构的数据库更新。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T12:52:11.103

[Obout.com 的树视图看起来很漂亮](http://www.obout.com/t2/edraganddrop.aspx)。没用过，但是想了很多次。。。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-17T17:25:20.100

Telerik 是前进的方向，我的朋友！您还没有从 NxtGenUG 获得副本吗？

# java - tomcat 5.5 - 读取资源文件的问题

> ID：298521
> 
> 赞同：8
> 
> 时间：2008-11-18T11:39:47.427
> 
> 标签：java, tomcat, servlets, resources

我使用 Tomcat 5.5 作为我的 servlet 容器。我的 Web 应用程序通过 .jar 部署，并且在其 WEB-INF 目录下有一些资源文件（带有字符串和配置参数的文本文件）。Tomcat 5.5 在 ubuntu linux 上运行。使用文件阅读器读取资源文件：
`fr = new FileReader("messages.properties");`

问题是有时 servlet 找不到资源文件，但如果我重新启动它几次它可以工作，然后再过一段时间它会停止工作。有人可以建议从 servlet 读取资源字符串的最佳方法是什么？或者这个问题的解决方法？将资源文件放在 WEB-INF/classes 下也无济于事。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-19T23:44:57.027

如果您尝试从可识别 Servlet 的类（例如 ContextListener 或其他生命周期侦听器）访问此文件，则可以使用 ServletContext 对象来获取资源的路径。

这三个大致相当。（不要将 getResourceAsStream 与`ClassLoader`类提供的相同混淆。它们的行为非常不同）

```
void myFunc(ServletContext context) {
   //returns full path. Ex: C:\tomcat\5.5\webapps\myapp\web-inf\message.properties 
   String fullCanonicalPath = context.getRealPath("/WEB-INF/message.properties");

   //Returns a URL to the file. Ex: file://c:/tomcat..../message.properties
   URL urlToFile = context.getResource("/WEB-INF/message.properties");

   //Returns an input stream. Like calling getResource().openStream();
   InputStream inputStream = context.getResourceAsStream("/WEB-INF/message.properties");
   //do something
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-18T12:15:55.560

我猜问题是你试图使用相对路径来访问文件。使用绝对路径应该会有所帮助（即“/home/tomcat5/properties/messages.properties”）。

但是，通常解决这个问题的方法是使用 ClassLoader 的 getResourceAsStream 方法。将属性文件部署到“WEB-INF/classes”将使其可用于类加载器，您将能够访问属性流。

未经测试的原型代码：

```
Properties props = new Properties();

InputStream is =
getClass().getClassLoader().getResourceAsStream("messages.properties");

props.load(is); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T14:28:35.980

如果你使用

```
new FileReader("message.properties"); 
```

然后 FileReader 将尝试从基本目录读取该文件 - 在 Tomcat 中可能是 /bin 文件夹。

正如 diciu 提到的，使用绝对路径或将其作为资源加载到类加载器中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-03T13:45:24.243

我使用以下代码从 servlet 中加载属性文件：

```
public void init(ServletConfig config) throws ServletException {
    String pathToFile = config.getServletContext().getRealPath("")
        + "/WEB-INF/config.properties";
    Properties properties = new Properties();
    properties.load(new FileInputStream(pathToPropertiesFile));
} 
```

这适用于 Tomcat 6.0

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-11T02:08:00.273

我确实用于 Jboss Seam：

`ServletLifecycle.getServletContext().getRealPath("")`

# .net - Winforms 中的 WPF UC 偶尔会在左侧出现奇怪的边框/视觉上已损坏

> ID：298524
> 
> 赞同：1
> 
> 时间：2008-11-18T11:40:48.190
> 
> 标签：.net, wpf, winforms, user-controls

我创建了一个 WPF 用户控件，用于在我的 UI 中显示任务的状态。我得到一个奇怪的报告，说控件有时在左边有一个令人讨厌的边框，我无法重现它。

控件看起来像这样（工作时）（灰色刻度=未运行，绿色=OK，红十字=失败，沙漏=运行）；

[替代文字 http://img504.imageshack.us/img504/1772/wpfgoodpw9.png](http://img504.imageshack.us/img504/1772/wpfgoodpw9.png)

出现问题时是这样的；

[替代文字 http://img369.imageshack.us/img369/4201/wpfbadar6.png](http://img369.imageshack.us/img369/4201/wpfbadar6.png)

它可能与这些图标的分层有关，当状态更改时，其他图标将变为不可见，相关图标变为可见。四个图标都堆叠在一起。

它也可能是理论上的背景，我将在接下来看看。平板和 CRT 显示器都报告了问题。

非常感谢任何指导。

更新：1) SnapsToDevicePixels 不影响该问题。2）不使用网格，仅使用画布。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T11:49:00.390

它可能与[像素捕捉](http://msdn.microsoft.com/en-us/library/aa970908.aspx)有关吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-19T01:43:18.397

它们在网格中吗？它可能与[WPF：消除](https://stackoverflow.com/questions/267364/wpf-eliminate-transparency-between-grid-cells#267954)我们从未真正解决的网格单元之间的透明度有关。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-12T23:04:30.343

您可以让您的一位精通技术的用户在问题出现时运行[Snoop](http://snoopwpf.codeplex.com/)，然后：

1.  点击望远镜
2.  将鼠标放在工件（垂直条）上，然后按 Shift-Ctrl
3.  查看 Snoop 窗口并告诉您突出显示的项目

这将准确告诉您是什么控件产生了您在工件中看到的颜色，这可能是修复它的重要线索。

# php - 什么是我可以用作投票的好的 PHP 脚本？

> ID：298529
> 
> 赞同：1
> 
> 时间：2008-11-18T11:42:49.810
> 
> 标签：php

什么是一个很好的免费 PHP 脚本可以用作网站投票？我需要一个简单的脚本来在网页上显示标准的多选项投票+条形图。还需要一个带有添加/编辑/删除投票的管理界面。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T11:44:44.783

我已经使用了相当多的[Advanced Poll](http://www.proxy2.de/scripts.php)，发现它非常好，并且几乎完全按照您的描述进行。

本

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T09:15:39.170

[Presto Poll](http://prestopoll.sourceforge.net/)有点受欢迎。它支持用于数据存储的数据库和平面文件，并有一个简单而全面的管理部分。

# java - 如何通过 Eclipse 为 Websphere Application Server 构建 EAR/WAR？

> ID：298534
> 
> 赞同：4
> 
> 时间：2008-11-18T11:45:49.413
> 
> 标签：java, jakarta-ee, websphere

IBM Rational Application Developer 非常慢并且有很多问题。

我尝试使用 ant 脚本为 Websphere Application Server 构建 EAR/WAR 文件，但它不起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T15:45:58.087

如果 Ant 找不到 WAS 任务，那么很可能是 Ant 类路径中缺少 WAS API。

有关其他示例脚本和建议，请参阅[此问题](https://stackoverflow.com/questions/4046/can-someone-give-me-a-working-example-of-a-buildxml-for-an-ear-that-deploys-in)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T21:47:55.500

您需要确保包含 的 jar 文件`com.ibm.websphere.ant.tasks.WSDL2Java`在您的`lib.path`类路径中。

```
<taskdef name="wsdl2java"
    classname="com.ibm.websphere.ant.tasks.WSDL2Java">
    <classpath refid="lib.path"/>
</taskdef> 
```

如果您使用的是 UNIX，则可以使用类似于以下内容的代码扫描此类：

```
find . -type f -name "*.jar" | while read file
do
    jar tvf $file | grep WSDL2Java && echo $file
done 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-18T08:00:22.157

如果 RAD 很慢，请尝试升级到可用的最新 FixPack。- 阅读以下文章[https://www.ibm.com/developerworks/wikis/download/attachments/113606723/radtipsv754.pdf?version=1](https://www.ibm.com/developerworks/wikis/download/attachments/113606723/radtipsv754.pdf?version=1)

或者联系支持并更具体地解释问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T13:15:16.643

我的理解是您构建 EAR/WAR，然后打开浏览器，登录到管理控制台，然后部署您的应用程序。

如果我的理解是正确的，只需将 WAS 服务器的一个实例添加到您的工作区，然后右键单击该服务器，选择 Add/Remove Projects 并添加您的项目。这样，您根本不必构建 EAR/WAR 文件……构建您的项目就足够了。如果构建成功，那么 RAD 会自动构建 EAR/WAR 并将文件发布到服务器。

至少我们就是这样做的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-24T20:52:47.523

If you're using a brand new version of Eclipse (like Helios or Indigo) that has the Marketplace, then there is the possibility of deploying directly to Websphere. Here's a link about it: [Announcing the new WebSphere Application Server Developer Tools for Eclipse V8.0.4](https://www.ibm.com/developerworks/mydeveloperworks/blogs/wasdev/entry/announcing_the_new_websphere_application_server_developer_tools_for_eclipse_v8_0_42?lang=en)

# php - PHP 的新 input_filter 不读取 $_GET 或 $_POST 数组

> ID：298535
> 
> 赞同：12
> 
> 时间：2008-11-18T11:47:44.073
> 
> 标签：php, security, filter-input

在 PHP 5.2 中添加了一个很好的安全功能，称为“input_filter”，所以不要说：

```
$name = $_GET['name']; 
```

你现在可以说：

```
$name = filter_input (INPUT_GET, 'name', FILTER_SANITIZE_STRING); 
```

它会自动清理您的字符串，还有：

*   `FILTER_SANITIZE_ENCODED`
*   `FILTER_SANITIZE_NUMBER_INT`
*   `FILTER_SANITIZE_EMAIL`
*   `FILTER_SANITIZE_URL`

等等，所以这是一个非常方便使用的安全功能，我想完全切换到它。

**问题是......**我经常在处理 $_GET 和 $_POST 数组之前对其进行操作，如下所示：

$_GET['name'] = '（默认名称）';

但似乎 filter_input 无法访问 $_GET 中的更改，因为它读取的是 int (?) 类型的“INPUT_GET”。如果我可以让 filter_input 改为读取 $_GET 那就太好了，但是：

```
$name = filter_input ( $_GET, 'name', FILTER_SANITIZE_STRING ); 
```

给我错误：

```
Warning: filter_input() expects parameter 1 to be long, array given. 
```

谁能想到我可以的方法：

*   操纵`INPUT_GET`（无论它在哪里）的源，以便我可以在 filter_input 读取它们之前更改它的值
*   让 filter_input 读取`$_GET`

`ADDENDUM:`

* * *

Rich 问道：“你为什么要改变数组，你肯定希望它们成为输入，而不是你以编程方式插入的东西。”

它只是一个非常方便的地方来预处理传入的变量，例如为了：

*   设置默认值（如果 $_GET['state'] = '' 那么 $_GET['state'] = 'AL'）
*   进行手动处理（删除所有空格等）
*   安全性（其中一些现在将由 filter_input 完成）

然后我知道当我得到传入变量时，它是安全有效的。当然，我可以将 $_GET 数组复制到另一个数组并处理该数组，但这只是一个不必要的步骤，因为我 $_GET 已经是一个正常工作的数组，所以对这些已经存在的系统数组进行操作是有意义的。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-18T12:08:50.910

[您可以使用filter_var](http://uk3.php.net/manual/en/function.filter-var.php)和[filter_var_array](http://uk3.php.net/manual/en/function.filter-var-array.php)手动强制它再次读取数组

```
$name = filter_var ( $_GET['name'], FILTER_SANITIZE_STRING ); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-08-24T04:06:19.290

在不修改全局数组的情况下执行此操作的便捷方法：

```
if (!($name = filter_input(INPUT_GET, 'name'))) {
    $name = 'default_value';
} 
```

或者使用三元运算符：

```
$name = ($name = filter_input(INPUT_GET, 'name')) ? $name : 'default_value'; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T11:55:17.913

如果您手动更改阵列，那么您肯定不需要清理它吗？你为什么要更改数组，当然你希望它们成为输入，而不是你以编程方式插入的东西。

也许更多的代码/上下文会有所帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-12-07T22:28:09.617

正如 Jrngs 所建议的：

## 跳过以编程方式修改超全局请求变量并定义和使用新的普通变量。

不仅创建新变量比访问和修改关联数组（带有字符串索引的数组）中的值要快得多，而且通常也是一种更好的做法。

**filter_input**函数的重点是最终删除超全局变量的使用，因为它们是所有 PHP 脚本中最危险的一点，也是最常见的安全漏洞（XSS 和 SQL 注入）以及错误和混乱的原因，尤其是在大型项目中。

**例如，$_GET 和 $_REQUEST 变量应该为同一个键返回相同的值，但是：**

```
.../?var=1
var_dump($_GET['var']); ---> string '1' (length=1)
var_dump($_REQUEST['var']); ---> string '1' (length=1)
$_GET['var'] = 2;
var_dump($_GET['var']); ---> int 2
var_dump($_REQUEST['var']; ---> string '1' (length=1) 
```

*更不用说超全局变量在面向对象的代码中几乎没有任何意义。*

因此，如果 filter_input 函数访问 $_GET/$_POST/$_REQUEST 超全局变量，那将完全违背该函数的意义。你绝对**不应该**为此使用建议的**filter_var**函数：

```
filter_var($_GET['var'],FILTER_SANITIZE_STRING); ---> JUST NO! 
```

**创建filter_var**函数是为了也为非请求变量提供过滤/清理功能，而不是为这种“hack” 。您所做的实际上是从**filter_input**函数中获取过滤器，该函数最初是为了提供对请求数据的更好和更安全的访问而创建的，完全绕过函数本身，以创建**filter_input**来替换的方式访问请求数据，并应用过滤器由**filter_input**对请求数据提供。这是完全错误的。:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T12:07:30.587

INPUT_GET 位只是一个标识符（数字），告诉 PHP 它需要从 $_GET 获取值。

如果你想在整个数组上使用 filter_input，你需要遍历它，将每个数组键发送到 filter_input，然后将结果放回 $_GET 中。

编写一个对自己进行清理的函数可能同样容易，并且还应该允许您处理数组中的数组（看起来 filter_input 不会这样做）。PHP.net 文档注释中有几个这样的示例函数，它们可以执行诸如删除“魔术引号”之类的操作。有关示例，请参见[此处。](http://dk.php.net/manual/en/security.magicquotes.php)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-28T05:22:11.177

PHP 的新 input_filter 不读取`$_GET`或`$_POST`数组。如果您要覆盖 Global 的（如 , `$_GET`），`$_POST`则不要使用 filter_input。而是`filter_var ( $_GET['name'], FILTER_SANITIZE_STRING )`通过手动传递变量来使用。

# php - 使用 PHP 生成缩略图会导致图像质量不佳

> ID：298554
> 
> 赞同：0
> 
> 时间：2008-11-18T12:00:53.703
> 
> 标签：php, gdlib

```
$sourcePath = 'images/'; // Path of original image
$sourceUrl = '';
$sourceName = 'photo1.jpg'; // Name of original image
$thumbPath = 'thumbs/'; // Writeable thumb path
$thumbUrl = 'thumbs/';
$thumbName = "test_thumb.jpg"; // Tip: Name dynamically
$thumbWidth = 100; // Intended dimension of thumb

// Beyond this point is simply code.
$sourceImage = imagecreatefromjpeg("$sourcePath/$sourceName");
$sourceWidth = imagesx($sourceImage);
$sourceHeight = imagesy($sourceImage);

$targetImage = imagecreate($thumbWidth,$thumbWidth);
imagecopyresized($targetImage,$sourceImage,0,0,0,0,$thumbWidth,$thumbWidth,imagesx($sourceImage),imagesy($sourceImage));
imagejpeg($targetImage, "$thumbPath/$thumbName");

// By now, the thumbnail is copied into the $thumbpath
// as the file name specified in $thumbName, so display
echo "<img src='$thumbUrl$thumbName' alt=''>"; 
```

上面的代码给了我一个缩略图，这很棒，但是图像质量很糟糕。看起来图像的颜色反转了，看起来像是被压扁了。做这个我整天头疼。有人有想法么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-18T12:07:27.793

使用[imagecreatetruecolor](http://pl2.php.net/manual/en/function.imagecreatetruecolor.php)代替 imagecreate 和[imagecopyresampled](http://pl2.php.net/manual/en/function.imagecopyresampled.php)代替 imagecopyresized。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-18T12:12:59.547

正如 Dominic 所指出的，第三个参数值得包括在内。它指定 jpeg 质量。

关于“它看起来像是被压扁了”的问题，请记住，您正在从源图像制作方形缩略图，该图像本身可能是方形的，也可能不是方形的。

解决此问题的一种方法是使用源尺寸来计算出从源复制的全宽或全高（取决于图像是纵向还是横向）正方形。这意味着用动态计算的东西替换 imagecopyresized() 参数中的“0,0,0,0”。

（编辑：示例）

```
function makeSquareThumb($srcImage, $destSize, $destImage = null) {
    //I'm sure there's a better way than this, but it works...
    //I don't like my folder and file checking in the middle, but need to illustrate the need for this. 

    $srcFolder = dirname($srcImage); //source folder
    $srcName = basename($srcImage); //original image filename

    //the IF ELSEIF ELSE below is NOT comprehensive - eg: what if the dest folder is the same as the source?
    //writeable nature of the destination is not checked!
    if(!destImage) {
        $destFolder = $srcFolder.'/thumbs/';
        if(!is_dir($destFolder)) {
            //make the thumbs folder if there isn't one!
            mkdir($destFolder);
        }
        $destImage = $destFolder.$srcName;
    } elseif (is_dir($destImage)) {
        $destFolder = $destImage;
        $destImage = $destFolder.'/'.$srcName;
    } else {
        $destFolder = dirname($destImage);
    }

    //Now make it!
    $srcCanvas = imagecreatefromjpeg($srcImage);
    $srcWidth = imagesx($srcCanvas);
    $srcHeight = imagesy($srcCanvas);

    //this let's us easily sample a square from the middle, regardless of apsect ratio.
    $shortSide = array($srcWidth,$srcHeight);
    sort($shortSide);

    $src_x = $srcWidth/2 - $shortSide[0]/2;
    $src_y = $srcHeight/2 - $shortSide[0]/2;

    //do it!
    $destCanvas = imagecreatetruecolor($destSize, $destSize);
    imagecopyresampled($destCanvas,$srcCanvas,0,0,$src_x,$src_y,$destSize,$destSize,$shortSide[0],$shortSide[0]);
    imagejpeg($destCanvas, $destImage);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T12:03:32.920

尝试：

```
imagejpeg($targetImage, "$thumbPath/$thumbName", 100); 
```

# .net - SQLMembershipProvider - 源代码

> ID：298556
> 
> 赞同：4
> 
> 时间：2008-11-18T12:02:45.230
> 
> 标签：.net, .net-2.0, sqlmembershipprovider

在哪里可以找到 SQLMembershipProvider (.NET2.0) 的源代码？是可用的么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-18T12:36:01.480

源代码已经发布。[有关详细信息，请参阅 ScottGu 的博客](http://weblogs.asp.net/scottgu/archive/2006/04/13/442772.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T12:47:51.237

源代码可以在[这里](http://download.microsoft.com/download/a/b/3/ab3c284b-dc9a-473d-b7e3-33bacfcc8e98/ProviderToolkitSamples.msi)找到它是 .msi 安装程序。

它将在 c:\Program Files\ASP.NET Provider Toolkit SQL Samples\ 中安装代码示例

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T12:28:46.690

我想它不是免费提供的。但只要它只是用于教育目的并且您不想从中赚钱，如果您使用反射器查看它，微软不会起诉您;）

# asp.net - 基于 Ajax 的用户名可用性检查

> ID：298557
> 
> 赞同：3
> 
> 时间：2008-11-18T12:03:14.980
> 
> 标签：asp.net, ajax

任何人都有创建新用户注册表单的示例，其中 Web 应用程序通过在表单上进行 ajax 调用并在没有整页帖子的情况下在同一页面上返回可用或不可用来检查用户名可用性？类似于 Hotmail 上的新用户注册。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T12:40:57.413

[这似乎是一个非常简单的教程。](http://weblogs.asp.net/traviscollins/archive/2008/02/12/check-username-availability-with-asp-net-ajax.aspx) 它真的没有那么多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T12:37:52.867

我写的这篇文章有一个示例项目。这可以帮助您入门：[使用 ASP.NET AJAX 的成员资格](http://www.singingeels.com/Articles/Membership_Using_ASPNET_AJAX.aspx)

# windows - Windows XP 或更高版本 Windows：如何在不显示窗口的情况下在后台运行批处理文件？

> ID：298562
> 
> 赞同：126
> 
> 时间：2008-11-18T12:05:25.537
> 
> 标签：windows, batch-file, cmd, wsh

我知道我已经回答了一个类似的问题（[Windows 启动时在后台运行批处理文件](https://stackoverflow.com/questions/289498)），但是这次我需要启动一个批处理：

*   从另一批，
*   没有显示任何控制台窗口，
*   *将所有参数*传递给不可见的批处理。

第一批在控制台窗口中执行。但是，我不希望第二批（由第一批以**异步方式**启动）也显示控制台窗口。

我想出了一个 VBScript 脚本，它就是这样做的，我把这个脚本作为[其他人参考的答案](https://stackoverflow.com/questions/298562#298564)，但如果你有其他想法/解决方案，请随时贡献。

注意：Windows 命令处理器的控制台窗口被很多人命名为不正确的 DOS 窗口。

* * *

谢谢大家的回答。据我了解，如果我需要异步调用脚本以在不可见模式下运行：

*   从已经在控制台窗口中的第二个脚本中，**`start /b`**就足够了。
*   在 Windows 中，*在不触发第二个窗口的情况下*，我的解决方案仍然有效。

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2008-11-18T12:05:40.857

这是一个可能的解决方案：

从您的第一个脚本中，使用以下行调用您的第二个脚本：

```
wscript.exe invis.vbs run.bat %* 
```

实际上，您正在调用一个 vbs 脚本：

*   你的脚本的 [path]\name
*   脚本所需的所有其他参数 ( `%*`)

然后，invis.vbs 将使用[Windows Script Host Run() 方法](http://msdn.microsoft.com/en-us/library/d5fk67ky(VS.85).aspx)调用您的脚本，该方法需要：

*   intWindowStyle : 0 表示“不可见的窗口”
*   bWaitOnReturn : false 表示您的第一个脚本不需要等待您的第二个脚本完成

这是 invis.vbs：

```
set args = WScript.Arguments
num = args.Count

if num = 0 then
    WScript.Echo "Usage: [CScript | WScript] invis.vbs aScript.bat <some script arguments>"
    WScript.Quit 1
end if

sargs = ""
if num > 1 then
    sargs = " "
    for k = 1 to num - 1
        anArg = args.Item(k)
        sargs = sargs & anArg & " "
    next
end if

Set WshShell = WScript.CreateObject("WScript.Shell")

WshShell.Run """" & WScript.Arguments(0) & """" & sargs, 0, False 
```

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2008-11-18T12:48:48.130

你需要第二个批处理文件来异步运行吗？通常，一个批处理文件与命令同步运行另一个批处理文件`call`，第二个批处理文件将共享第一个批处理文件的窗口。

您**可以**使用`start /b` *second.bat从您的第***一个**同步启动第二个批处理文件，该文件共享您的第一个窗口。如果两个批处理文件同时写入控制台，则输出将重叠并且可能难以辨认。此外，您需要`exit`在第二个批处理文件的末尾放置一个命令，或者`cmd`一旦一切完成，您将在第二个 shell 中。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-18T14:26:23.833

将批处理文件转换为 exe。尝试[Bat To Exe Converter](http://www.f2ko.de/programs.php?lang=en&pid=b2e)或[Online Bat To Exe Converter](http://www.f2ko.de/programs.php?lang=en&pid=ob2e)，然后选择将其作为幽灵应用程序运行的选项，即无窗口。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2014-01-15T06:17:16.197

我认为这是在不打开 DOS 窗口的情况下运行批处理文件的最简单和最短的解决方案，当您想要安排一组命令定期运行时，它可能会非常分散注意力，因此 DOS 窗口不断弹出，这是您的解决方案. 使用 VBS 脚本调用批处理文件...

```
Set WshShell = CreateObject("WScript.Shell" ) 
WshShell.Run chr(34) & "C:\Batch Files\ mycommands.bat" & Chr(34), 0 
Set WshShell = Nothing 
```

将上面的行复制到编辑器并使用 .VBS 扩展名保存文件。相应地编辑 .BAT 文件名和路径。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-10-15T15:21:52.240

对于自我隐藏，您可以使用[getCmdPID.bat](https://github.com/npocmaka/batch.scripts/blob/master/hybrids/.net/getCmdPID.bat)和[windowMode.bat](https://github.com/npocmaka/batch.scripts/blob/master/hybrids/.net/c/windowMode.bat)：

```
@echo off

echo --- self hiding bat ----
pause
call getCmdPid.bat
set PID=%errorlevel%
call windowMode.bat -pid %PID% -mode hidden 
```

* * *

这是我实现这一目标的方法集合 - 甚至更多 - 我可能尝试返回已启动进程的 PID（所有链接的脚本都可以下载并以您认为方便的任何名称保存）：

1.  IEXPRESS**[解决](https://github.com/npocmaka/batch.scripts/blob/master/hybrids/iexpress/hidder.bat)**方案甚至可以在旧的 win 95/98 机器上使用。Iexpress 是一个非常古老的工具，仍然与 Windows 一起打包 - 因为参数只接受命令及其参数。

示例用法：

```
call IEXPhidden.bat "cmd /c myBat.bat"  "argument" 
```

2.  **[SCHTASKS](https://github.com/npocmaka/batch.scripts/blob/master/ProcessesUtils/startHidden.bat)** - 再次只接受两个参数 - 命令和参数。还检查它是否以提升的权限启动，如果可能，使用 WEVTUTIL 获取进程的 PID（可从 Vista 及更高版本获得，因此较新版本的 windows 将接收 PID）命令。

示例用法：

```
call SCHPhidden.bat "cmd /c myBat.bat"  "argument" 
```

3.  **['WScript.Shell'](https://github.com/npocmaka/batch.scripts/blob/master/hybrids/jscript/ShellRunJS.bat)** - 脚本是 'WScript.Shell' 的完整包装，每个可能的选项都可以通过命令行选项设置。它是 jscript/batch 混合体，可以称为 bat。

示例用法（有关更多信息，请使用“-h”打印帮助）：

```
call ShellRunJS.bat "notepad.exe" -style 0 -wait no 
```

4.  **['Win32_ProcessStartup'](https://github.com/npocmaka/batch.scripts/blob/master/hybrids/wsh/win32process.bat)** - 再次完整的包装器和所有选项都可以通过命令行参数访问。这次它是 WSF/批处理混合了一些 Jscript 和一些 VBScript 代码片段 - 但它返回已启动进程的 PID。如果进程没有隐藏可以使用一些选项，如 X/Y 坐标（不适用于每个可执行文件 - 但例如 cmd.exe 接受坐标）。

示例用法（有关更多信息，请使用“-h”打印帮助）：

```
call win32process.bat "notepad" -arguments "/A openFile.txt"  -showWindows 0 -title "notepad" 
```

5.  这 。**[网络解决方案](https://github.com/npocmaka/batch.scripts/blob/master/hybrids/.net/ProcessStartJS.bat)**。ProcessStartInfo选项的大部分选项都使用了（但最后我太累了，无法包含所有内容）：

示例用法（有关更多信息，请使用“-h”打印帮助）：

```
call ProcessStartJS.bat "notepad" -arguments "/A openFile.txt"  -style Hidden -directory "." -title "notepad" -priority Normal 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-18T14:40:09.077

在不同的用户名下运行它，使用“runas”或通过在 Windows 计划任务中的不同用户下安排它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-18T13:15:31.387

在另一个问题中，我建议[使用 autoexnt](http://support.microsoft.com/kb/243486)。在这种情况下也是可能的。只需将服务设置为手动运行（即在启动时不自动运行）。当您要运行批处理时，修改 autoexnt.bat 文件以调用所需的批处理文件，然后启动 autoexnt 服务。

启动它的批处理文件看起来像这样（未经测试）：

```
echo call c:\path\to\batch.cmd %* > c:\windows\system32\autoexnt.bat
net start autoexnt 
```

请注意，以这种方式启动的批处理文件以系统用户身份运行，这意味着您无法自动访问网络共享。但是您可以使用*net use*连接到远程服务器。

您必须[下载 Windows 2003 Resource Kit](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd&displaylang=en)才能获得它。Resource Kit 也可以安装在其他版本的 Windows 上，例如 Windows XP。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2021-07-04T13:49:48.673

我知道这已经有了答案，但如果有人偶然发现这个问题，这可能会有所帮助：

这是在后台完全运行它的好方法，没有任何方法可以看到它。您可以与之交互的唯一方法是使用 taskmgr 或 Process Hacker 终止它。

这使用了一个名为 NirCmd 的第三方工具。

1.  制作一个包含以下代码的脚本：

```
@echo off
nircmd exec hide "MainScript.bat" 
```

2.  将其保存为您喜欢的任何内容。“MainScript.bat”可以是任何东西，但请稍后注意。

3.  现在，使用您之前记下的名称制作另一个脚本。例如，我将其命名为 MainScript.bat 并为其提供以下代码：

```
@echo off
echo Can you see me now?
pause 
exit 
```

4.  这将是您要在后台执行的代码。

5.  确保它们在同一目录中，并将 NirCmd 下载到同一目录中。

以下是这些脚本的结果：

![演示 GIF](https://i.imgur.com/wR59Ict.gif)

[NirCmd 下载链接](https://github.com/imrolii/SiteDownloads/raw/main/nircmd.exe)

[演示 ZIP 文件](https://github.com/imrolii/SiteDownloads/raw/main/Invisible-Batch-Script-Demo.zip)

注意：NirCmd 不是我的工具，但它仍然有用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-01-31T12:57:33.527

您可以通过 .vbs 文件运行 .bat 文件
将以下代码复制到 .vbs 文件中：

```
Dim WshShell
Dim obj
Set WshShell = WScript.CreateObject("WScript.Shell") 
obj = WshShell.Run("C:\Users\file1.bat", 0) 
obj = WshShell.Run("C:\Users\file2.bat", 0)  and so on
set WshShell = Nothing 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-03-13T13:10:31.043

你也可以使用

```
start /MIN notepad.exe 
```

PS：不幸的是，最小化的窗口状态取决于要运行的命令。VG 不工作

```
start /MIN calc.exe 
```

# c# - C# 中的文字自动化。使用另存为时出错

> ID：298563
> 
> 赞同：3
> 
> 时间：2008-11-18T12:05:28.873
> 
> 标签：c#, .net, ms-word, office-interop

`Save as Document Object`尝试在 C# 中实现单词自动化时出现以下错误：

> ```
> System.Runtime.InteropServices.COMException 
> ```
> 
> (0x80020005)：类型不匹配。（来自 HRESULT 的异常：0x80020005 (DISP_E_TYPEMISMATCH)）
> 
> ```
>  at Microsoft.Office.Interop.Word.DocumentClass.SaveAs(Object& 
> ```
> 
> FileName, Object& FileFormat, Object& LockComments, Object& Password, Object& AddToRecentFiles, Object& WritePassword, Object& ReadOnlyRecommended, Object& EmbedTrueTypeFonts, Object& SaveNativePictureFormat, Object& SaveFormsData, Object& SaveAsAOCELetter, Object& Encoding, Object& InsertLineBreaks, Object& AllowSubstitutions, Object& LineEnding, Object& AddBiDiMarks)
> 
> ```
>  at TestWordAutomation.Form1.SaveAs(String 
> ```
> 
> 文件名）在 D:\dotnet\WordAutomation\TestWordAutomation\TestWordAutomation\Form1.cs:line 246
> 
> ```
>  at TestWordAutomation.Form1.button4_Click(Object 
> ```
> 
> 发件人，EventArgs e) 在 D:\dotnet\WordAutomation\TestWordAutomation\TestWordAutomation\Form1.cs:line 557

我这样调用`Save As`方法：

```
MySaveAs("Doc1.doc");
MySaveAs("Doc2.doc");
MySaveAs("Doc3.doc");

//I have a MySaveAs function
 public void  MySaveAs(string fileName)
        {
            object FileName = null, FileFormat = null, LockComments = null, _Password = null, AddToRecentFiles = null, _WritePassword = null, _ReadOnlyRecommended = null, _EmbedTrueTypeFonts = null, SaveNativePictureFormat = null, _SaveFormsData = null, SaveAsAOCELetter = null, Encoding = null, InsertLineBreaks = null, AllowSubstitutions = null, LineEnding = null, AddBiDiMarks = null;
            FileName = (object) fileName;
            oDoc.SaveAs(ref FileName, ref FileFormat, ref LockComments, ref _Password, ref AddToRecentFiles,
                        ref _WritePassword, ref _ReadOnlyRecommended, ref _EmbedTrueTypeFonts,
                        ref SaveNativePictureFormat, ref _SaveFormsData, ref SaveAsAOCELetter, ref Encoding,
                        ref InsertLineBreaks, ref AllowSubstitutions, ref LineEnding, ref AddBiDiMarks);
        } 
```

谁能帮我解决这个问题？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T12:21:27.767

很痛苦。我记得使用 Word/Excel 互操作来实现这一点。不要轻率，但其中一个参数的类型不正确。希望以下内容有所帮助，但我做了许多此类定义。

```
static object s_missing = System.Reflection.Missing.Value;
static object s_true = true;
static object s_false = false;
static object s_forcesave = Word.WdSaveOptions.wdSaveChanges;

static Word._Application s_app = null;
...
return s_app.Documents.Open ( ref filename,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing,
   ref s_missing ); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-12T19:57:05.333

您不能将 null 传递给任何互操作函数调用 - 请改用 Missing.Value（如 Kenny 所建议）

# mysql - MySQL 在导入时不会维护字符信息

> ID：298568
> 
> 赞同：0
> 
> 时间：2008-11-18T12:11:33.387
> 
> 标签：mysql, encoding, migration

我正在尝试导入一个大型 SQL 文件；由一台服务器上的mysqldump创建，然后用iconv转换；使用这些命令：

```
$ mysqldump -uxxx -p xxx > data.sql
$ iconv -f UTF-8 -t ISO-8859-1//TRANSLIT data.sql data.iconv.sql 
```

我注意到数据库中的“\x91”在转储中变成了“\xc3\x82\xc2\x91”，因为 mysqldump 试图将所有内容都转换为 utf-8。我用 iconv 将它转换回“\x91”。如果我不转换它们，它们最终会在新服务器上成为“\xc2\x3f”；而不是我们现在的“\x3f”。

因此，如前所述，cp1252 编码有一些独特的字符，例如“\x91”和“\x92”。这两个字符在新数据库中都变成了“\x3f”；这是我用来导入的命令：

```
$ /opt/mysql5/bin/mysql -uxxx -p -Dxxx < data.iconv.sql 
```

任何人都知道这是怎么发生的以及如何防止它发生？知道了这一点，我应该能够完全按原样迁移数据。

额外的信息：

我[将此来源](http://www.outofcontrol.ca/2006/05/31/mysql-exportimport-and-charset-problems/)用于 iconv-things。如您所见，在此页面上，另一个人也遇到了 cp1252 的问题；也许这就是原因。

服务器版本是：

旧主机：Ver 10.10 Distrib 5.0.18，适用于 pc-linux-gnu (i486) 新主机：Ver 10.11 Distrib 5.0.51，适用于 pc-linux-gnu (i686)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-06T14:54:47.683

在我的系统上，mysqld 默认使用瑞典排序规则将数据保存在 latin1 中。同样，mysql 命令行客户端默认提供 latin1 格式的数据。另一方面，mysqldump 默认为 utf-8。

这在通过 mysqldump 导出数据然后使用 mysql 命令行客户端导入时会导致问题 - 这两个字符集不常见的字符会发生突变。

解决方案是让 mysqldump 使用可以正确设置 mysql 客户端字符集的附加命令来装饰数据：

```
mysqldump --set-charset ... 
```

默认情况下，这将`set name = utf-8`在转储数据中添加“”。这现在可以由 mysql 客户端干净地导入。

附加选项“ `--default-character-set=xxx`”可以与 mysqldump 一起使用，以将转储转换为 utf-8 以外的内容。

使用该`-set-charset`选项应该可以让您完全不必使用 iconv。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T12:19:23.993

如果您的数据是 cp1252，为什么要告诉 iconv 它的 utf-8？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T14:15:16.240

你用的是什么版本的mysqldump？

最近的版本 5 发布了使用设置字符集的命令包装表转储，例如：

```
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;

CREATE TABLE ...
...
...
SET character_set_client = @saved_cs_client; 
```

这些的存在/不存在会影响您的进口吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-19T14:32:03.663

我还没有找到可行的解决方案；我们将尝试使用建立 2 个连接并简单地从一个连接中选择并更新另一个连接的脚本进行迁移...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-19T15:22:37.150

如果 mysql 正在转换为 utf-8，那么您需要：

```
iconv -f utf-8 -t IBM-1252 xxxx 
```

这应该将打开的报价转换回 x"91"。“xc291”确实是用于公开报价的 utf-8。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-19T15:12:08.170

尝试：-

iconv -f IBM-1252 -t ISO-8859-1

不知道为什么我之前的回复被标记了。utf-8 不是 ASCII！所有 7 位 utf 字符都与 7 位 ASCI 字符集相同，但第一位 b'1000000' 在 UTF-8 中具有特殊含义，表示该字符是 unicode 两个三字节或四字节字符。

# .net - .NET Framework 可以在 Win98 上使用吗？

> ID：298569
> 
> 赞同：8
> 
> 时间：2008-11-18T12:12:02.153
> 
> 标签：.net, .net-2.0, legacy, windows-98

我需要为客户编写一个在 Windows 98 上运行的小工具。由于这是一个非常小的项目，我希望我可以避免使用原生 C++ 并使用 C#。

[.net Framework 2.0 下载](http://www.microsoft.com/downloads/details.aspx?FamilyID=0856eacb-4362-4b0d-8edd-aab15c5e04f5)声称支持 Windows 98。在安装或编码时是否需要注意任何警告或问题？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-18T12:34:27.070

Win98 不支持一些功能，例如表单不透明度和气球工具提示。如果您使用任何 P/Invoke，您必须确保支持 ANSI 版本的函数（使用`CharSet.Auto`），并且您必须检查 MSDN 以确保您使用的 API 函数在 Win98 上受支持。它*会*起作用，但如果可能，您应该在交付给客户之前在 Win98 上进行测试。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-18T12:34:58.923

它是可用的，但请务必阅读您最终使用的类的文档。其中一些在 Win98 上不受支持，例如 Nick Baldwin 提到的 EventLog。

此外，它可能不是一个简单的安装（至少根据我的经验）。如果我是你，我会在开始项目之前检查客户端是否能够安装 .NET 2.0。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-18T12:31:47.463

.NET 2.0 支持 Windows 98，但您无法访问某些基本库类，例如 EventLog。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-18T12:35:06.927

我编写了几个我亲自在 Win98 上运行的“小工具”。我建议你创建一个虚拟机并在每次重大构建后测试你的应用程序。

我看到的问题几乎完全与 UI 相关（事情的大小*确实*不正确）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-18T13:06:18.220

您也可以使用 express 版本来定位 .NET 2.0。在 C# express 中，您可以在项目属性中更改框架。您必须先保存项目。

# ms-word - 我可以将 AddIn 写入打开另一个 AddIn 的 MS Word 吗？

> ID：298571
> 
> 赞同：0
> 
> 时间：2008-11-18T12:13:28.703
> 
> 标签：ms-word, vsto, add-in

我的自定义插件有问题，因为有时 MS Word 禁用了我的插件，我需要编写另一个插件，该插件可以打开/关闭我的第一个插件。可能吗？

对不起我的英语不好 ：（

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T17:36:20.230

我同意 divo，您的第一步是添加一些异常处理/日志记录，以防止插件被禁用。你也可以参考这篇文章

[应用级项目中的调试](http://msdn.microsoft.com/en-us/library/ms269003(VS.80).aspx)

但是，我也遇到了插件以某种方式被禁用而没有抛出任何异常的问题。如果上述方法不起作用，您可以随时让另一个程序将插件的 LoadBehavior 从 2 强制设置为 3，这应该重新启用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T14:19:30.987

您使用的是哪种加载项技术？威斯托？您使用的是哪个版本的 Office？

一般来说，你可以做你想做的事。但是，Office 禁用加载项的原因是加载项引发了未处理的异常。在这种情况下，Office 会将`LoadBehavior`注册表中的值设置为 2。

也许分析和处理导致异常的潜在问题会更好。

# c++ - 覆盖 C++ 中的成员变量

> ID：298577
> 
> 赞同：8
> 
> 时间：2008-11-18T12:18:10.550
> 
> 标签：c++, oop

我在一些 C++ 代码中遇到了一些棘手的问题，这很容易使用代码来描述。我有类似的课程：

```
class MyVarBase
{
}

class MyVar : public MyVarBase
{
    int Foo();
}

class MyBase
{
public: 
    MyBase(MyVarBase* v) : m_var(v) {}
    virtual MyVarBase* GetVar() { return m_var; }
private:
    MyVarBase* m_var;
} 
```

我还有一个 MyBase 的子类，它需要有一个 MyVar 类型的成员，因为它需要调用 Foo。将 Foo 函数移动到 MyVarBase 不是一种选择。这样做是否有意义：

```
class MyClass : public MyBase
{
public:
    MyClass(MyVar* v) : MyBase(v), m_var(v) {}
    MyVar* GetVar() { return m_var; }
private:
    MyVar* m_var;
} 
```

这似乎可行，但看起来真的很糟糕，我不确定它是否会导致内存泄漏或破坏复制构造函数。我的其他选择可能是将 MyClass 中的 MyVar 变量命名为其他名称，但让它等于基中的 m_var 指针，或者在 MyVar 类型上模板化 MyBase。

所有这些选项似乎都不理想，所以我想知道是否有其他人遇到过这样的情况，以及是否有一种好的方法可以让它发挥作用。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-18T12:23:13.003

正确的方法是只在基类中使用变量。由于派生类知道它必须是动态类型`MyVar`，这是完全合理的：

```
class MyClass : public MyBase
{
public:
    MyClass(MyVar* v) : MyBase(v) {}
    MyVar* GetVar() { return static_cast<MyVar*>(MyBase::GetVar()); }
} 
```

由于 MyVar 是从 MyVarBase 派生的，`GetVar`如果 GetVar 是虚拟的，不同的返回类型仍然可以工作（就像这里的情况一样）。请注意，使用该方法，`MyBase`显然不能有任何函数可以将指针重置为不同的东西。

请注意，`static_cast`在这种情况下，这是正确的演员阵容。使用`dynamic_cast`，正如一位评论者所建议的那样，将告诉 GetVar 的读者和用户`MyBase::GetVar()`可以返回指向非 MyVar 类型的对象的指针。但这并不反映我们的意图，因为您只通过 MyVar。结果是软件开发中最重要的事情。你*可以*做的是断言它是非空的。它将在运行时中止，并在项目的调试版本中显示错误消息：

```
MyVar* GetVar() { 
    assert(dynamic_cast<MyVar*>(MyBase::GetVar()) != 0);
    return static_cast<MyVar*>(MyBase::GetVar()); 
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T12:54:40.600

在不了解更多上下文的情况下，很难确定，但我会重新考虑您是否首先需要这个类层次结构。你真的需要 MyVarBase 和 MyBase 类吗？你能摆脱组合而不是继承吗？如果您将与上述类一起使用的函数和类模板化，那么您可能根本不需要类层次结构。也许 CRTP 也可以提供帮助。在 C++ 中使用虚函数（在某种程度上，通常是继承）有很多替代方法。

无论如何，您自己建议的解决方案当然不应该泄漏任何内存（因为它不分配任何内存），也不会破坏默认的复制构造函数（因为它只是执行一个成员复制。现在你只需要一个额外的派生类中的成员，但也会被复制）。当然，你会遇到保持两个变量同步的额外问题，所以我仍然不太喜欢这个解决方案。

或者，您可以从基类中删除该变量。使 GetVar() 函数成为纯虚函数，因此它只在派生类中实现，派生类可以以任何他们喜欢的方式定义成员变量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T14:16:21.870

我认为您提到模板可能是一个不错的选择，例如：

```
class MyVarBase
{
};

class MyVar : public MyVarBase
{
  int Foo();
};

template <class T> class MyBase
{
public: 
  MyBase(T* v) : m_var(v) {}
  T* GetVar() { return m_var; }

private:
  T* m_var;
};

class MyClass : public MyBase<MyVar>
{
public:
  MyClass(MyVar* v) : MyBase(v) {}
}; 
```

但是，这将取决于您实际上可以更改哪些类。此外，“MyClass”定义可能是多余的，除非它在 ​​MyBase 类之外还有其他成员。

# c# - 亚音速加入问题

> ID：298580
> 
> 赞同：0
> 
> 时间：2008-11-18T12:18:58.240
> 
> 标签：c#, asp.net, sql, subsonic

对于那些在亚音速方面表现不错的人！

```
 TblNewsCollection col =
            new Select().From(Tables.TblNews)
                .InnerJoin(Tables.TblContent)
                .Paged(currentPage, pageSize)
                .OrderDesc(TblContent.Columns.PubDate)
                .ExecuteAsCollection<TblNewsCollection>(); 
```

以上工作，没问题，但是当我尝试添加 where 子句时

```
 TblNewsCollection col =
            new Select().From(Tables.TblNews)
                .InnerJoin(Tables.TblContent)
                .Where(TblContent.Columns.UserFK)
                .IsEqualTo(guidUserFK)
                .Paged(currentPage, pageSize)
                .OrderDesc(TblContent.Columns.PubDate)
                .ExecuteAsCollection<TblNewsCollection>(); 
```

我收到这条消息

```
System.InvalidCastException: Object must implement IConvertible.
at System.Convert.ChangeType(Object value, Type conversionType, IFormatProvider provider)
at System.Data.SqlClient.SqlParameter.CoerceValue(Object value, MetaType destinationType) 
System.InvalidCastException: Failed to convert parameter value from a Guid to a String. 
```

我已经从其他字段尝试过，例如数据库中的一个位字段，它说它不能从布尔转换为位！

似乎只是连接后 where 语句的问题

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T06:25:47.857

我发现使用上面的 Northwind 示例中的 TableColumnSchema 而不是列名可以更好地进行连接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T12:33:24.653

```
Northwind.CustomerCollection customersByCategory = new Select()
    .From(Northwind.Customer.Schema)
    .InnerJoin(Northwind.Order.Schema)
    .InnerJoin(Northwind.OrderDetail.OrderIDColumn, Northwind.Order.OrderIDColumn)
    .InnerJoin(Northwind.Product.ProductIDColumn, Northwind.OrderDetail.ProductIDColumn)
    .Where("CategoryID").IsEqualTo(5)
    .ExecuteAsCollection<Northwind.CustomerCollection>(); 
```

有一个应该有效的例子。如果这有助于任何人帮助我！

# checksum - 我怎么能猜到校验和算法？

> ID：298588
> 
> 赞同：5
> 
> 时间：2008-11-18T12:22:45.173
> 
> 标签：checksum, crc

如果给出了给定的代码 + CRC 字符串，我如何找出 CRC 算法？

我有几个由代码 + 匹配的 CRC 组成的字符串，但不知道如何计算有问题的 CRC，以便我可以生成更多代码字符串。以下是一些示例（16 位代码 + 4 位 CRC）：

```
0010101000011101 + 0000
0010101000011111 + 0001
1000110011101101 + 0001
0000000000000100 + 0010
0011100011001110 + 0011
1000110011101110 + 0100
0001011110101100 + 0100
0010101000011110 + 0101
0011100011001101 + 0110
0001011110101111 + 0111
0011100011001100 + 1001
0011100011001111 + 1010
0001011110101101 + 1011
0000000000001000 + 1011
0000111100001101 + 1100
0000000000001100 + 1100
1111111111111111 + 1101
1000110011101111 + 1101
1000110011101100 + 1110
0001011110101110 + 1110
1111111100001101 + 1110
0010101000011100 + 1111

```

这些代码来自像 X10 产品这样的射频 (433MHz) 发送器。

我不确定这是 CRC 还是它是什么，但至少它以某种方式从这些代码字符串中计算出来。

## 更新

RE：找到我也认为是最好的解决方案的规范，但由于这不是选项，我需要以某种方式强制校验和计算。

这就是问题所在，我没有规格，也无法在任何地方得到它们。我已经尝试了几种不同的校验和计算方法而没有结果，有没有办法比较输入字符串找出它们的共同点，这样就可以得到算法

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T13:18:54.577

是什么让您认为它是 CRC？通常 CRC 不用于这么小的数据。

在我看来，这更像是某种奇偶校验、ECC（实际上是[FEC](http://en.wikipedia.org/wiki/Forward_error_correction)）或[Reed-Solomon](https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction)代码。可能是[汉明码](http://en.wikipedia.org/wiki/Hamming_code)- 汉明码广泛用于工业和电信。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T12:29:51.697

猜测是非常正确的词。如果此 RF 设备不是专有的，请尝试阅读**规格**！这将是最简单的方法。

猜测所有可能的 CRC（或散列算法）看起来并不太乐观。看看[这里](http://en.wikipedia.org/wiki/Cyclic_redundancy_check)。

第三种可能性是对用于生成校验和的代码进行逆向工程。

祝你好运 ：）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T20:07:52.613

[@mecki](https://stackoverflow.com/questions/298588/how-could-i-guess-a-checksum-algorithm#298694)可能是正确的，但很难知道。您可以尝试[X-10 无线单元的数据格式](http://idobartana.com/hakb/x10rf.htm)和[X-10 常见问题解答](http://www.nomad.ee/micros/x10faq.html)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-18T20:12:48.083

```
['0010101000011101', '0000', '0'] ['0010101000011110', '0101', '5'] [1, 3]
['1000110011101101', '0001', '1'] ['1000110011101110', '0100', '4'] [1, 3]
['0000000000000100', '0010', '2'] ['0000000000001000', '1011', 'b'] [0, 3]
['0011100011001110', '0011', '3'] ['0011100011001101', '0110', '6'] [1, 3]
['0001011110101100', '0100', '4'] ['0001011110101111', '0111', '7'] [2, 3]
['0011100011001100', '1001', '9'] ['0011100011001111', '1010', 'a'] [2, 3]
['0001011110101101', '1011', 'b'] ['0001011110101110', '1110', 'e'] [1, 3]
['1000110011101111', '1101', 'd'] ['1000110011101100', '1110', 'e'] [2, 3] 
```

差异“分析”的结果，这看起来不像 crc，参考： http: [//www.cosc.canterbury.ac.nz/greg.ewing/essays/CRC-Reverse-Engineering.html](http://www.cosc.canterbury.ac.nz/greg.ewing/essays/CRC-Reverse-Engineering.html)

我也怀疑它是汉明码，因为 4 个奇偶校验位只允许 11 个数据位，而不是 16 个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T13:41:32.893

可能它不是 CRC，但我仍然无法找出纠错/冗余算法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T12:40:55.090

有太多 CRC 算法的可能性无法有效猜测。您可以采取简单的方法，即为您的设备找到规格。或者您可以采用蛮力方法，即计算每个可能输入的 CRC，并创建一个生成相同结果的算法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-18T13:27:38.507

一个好的校验和算法的全部意义在于它与输入文本*没有*任何共同之处。您可以更改输入中的单个字符。并且*整个*校验和输出将会改变。所以走另一条路的唯一方法是，是的，猜测。如果您知道输入和输出字符串是什么，您可以尝试一些常见的校验和算法，看看它们中的任何一个是否给出了正确的输出。除此之外，不，这是不可能的。

或者，正如其他人所建议的那样，它可能根本不是校验和，而是某种纠错/冗余代码，这可能更容易弄清楚。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-18T12:50:35.850

您可以尝试一些常见的 CRC 方法并希望幸运，但 Mana 的答案（寻找规格）将是最佳选择。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-18T20:21:19.653

从字符串的长度与校验和的长度来看，我会说这是一个简单的 1 错误纠正校验和。它可能是使用汉明距离的简单方法之一。我不记得它是如何工作的，而且我没有任何信息论/线性代数教科书。

# .net - 检测是否安装了 COM 组件的最佳方法是什么

> ID：298592
> 
> 赞同：2
> 
> 时间：2008-11-18T12:25:01.143
> 
> 标签：.net, com

我有一个 COM 互操作程序集，我想从 .NET 应用程序中检查我要创建的组件是否安装在机器上。

如果未安装，我想提供一个很好的错误消息。

将实例化放入 try-catch 对我来说不是一个好的解决方案，因为我想区分丢失的安装和可能发生的其他错误。

我的想法是检查*HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Interface*路径下的注册表中是否存在具有 COM 类 id 的节点。但是有更好的方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-18T12:37:30.917

不幸的是，我认为最好的方法是尝试实例化它。签入注册表并不能保证组件确实存在（例如，在注册后文件可能已被删除或移动）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T12:43:58.593

除了[Eyvind 提到的问题](https://stackoverflow.com/questions/298592/what-is-the-best-way-to-detect-if-a-com-component-is-installed#298616)之外，在执行注册表检查时，还有一些其他的事情需要考虑：

*   可能（不常见，但可能）在 HKCU\Software\Classes 中有（部分）COM 注册，因此您也必须检查它。
*   还有[无注册 COM](http://msdn.microsoft.com/en-us/library/ms973913.aspx)，您不会在注册表中找到任何内容，但仍然可以实例化 COM 对象......

以上两种情况都不常见，但还是要注意这一点。

Eyvind 的场景可能是您经常遇到的情况：有人从磁盘中删除了您的 COM 服务器，而没有先取消注册它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-09T12:56:36.960

`Type.GetTypeFromProgID("MyProgID") != null`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T12:33:10.613

您还可以在 try/catch 块中实例化要检查的 com 类的对象，以便在 catch 块中警告用户。直截了当的解决方案，我同意。

检查注册表对我来说似乎是最合理的方法，因为未注册的 com 组件毫无用处。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-08T15:34:51.223

您可以[免费使用](http://www.itripoli.com/itlv.asp)[iTripoli**类型库查看器**](http://www.itripoli.com/itlv.asp)。使用上述方法，**打开**有问题的**EXE/DLL**。然后，您会发现**GUID**。打开**regedit**，转到 KEY：HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID。使用上述 GUID**搜索/查找。**

# java - Java：`静态`方法

> ID：298593
> 
> 赞同：5
> 
> 时间：2008-11-18T12:26:59.737
> 
> 标签：java, static, methods

当我调用静态方法时：

```
Something.action(); 
```

由于没有创建实例，静态方法的类将在内存中保存多长时间？

如果我调用相同的方法，是否会为每个调用重新加载类，因为不存在实例？

并且在调用时是否仅加载单个静态方法，或者即使只使用一个静态方法，一个类的所有方法和静态方法是否都加载到内存中？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-18T12:30:31.600

除非您配置了 permgenspace 的垃圾收集，否则该类将保留在内存中，直到 vm 退出。整个类加载了所有静态方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-18T12:35:23.090

该类一直保留在内存中，直到加载该类的类加载器保留在内存中。因此，如果该类是从系统类加载器加载的，则据我所知，该类永远不会被卸载。

如果你想卸载一个类，你需要：

1.  使用自定义类加载器加载类和引用该类的所有类
2.  完成该类后，释放对该类的所有引用 - 即确保周围没有该类的对象实例
3.  通过释放加载这些类的自定义类加载器实例来卸载类和所有引用它的类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T12:46:03.097

在某些配置中，甚至在您进行调用之前就已加载该类。我们使用了 BES（Borland Enterprise Server），但我们的 Solaris 生产服务器存在问题，其中所有引用的类在我们的应用程序启动时递归加载。这意味着，当我们的应用程序的主类被加载时，应用程序服务器会加载该类的导入部分中引用的所有类......递归。

作为旁注，除非您在非常内存限制的环境中运行，或者如果您正在加载大量不必要的类，您不应该太关心加载到内存中的类的内存使用情况。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T12:35:32.497

加载调用者类时应该加载*Something类。*正如 krosenvold 所说，它一直存在直到 VM 退出。

# css - CSS Best Practice about ID and Class?

> ID：298607
> 
> 赞同：39
> 
> 时间：2008-11-18T12:33:50.207
> 
> 标签：css

I've been dipping into SitePoint book concerning CSS.

The thing that struck me about the examples was the use of ID as a CSS selector.

Some bits of CSS design I've done, I've always found it easier and more versatile to use Class as the selector.

Maybe its a .Net thing as we don't always have control of the ID of an element...

Is the best practice here to use CLASS or ID as the selector?

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-11-18T12:47:17.480

I guess they always use the id in examples because it's less ambiguous. You know that they're talking specifically about *that* one element and its styles.

In general, the rule of thumb is that you should ask yourself: "is there more than one element which requires the same style, now or at any time in the future?", and the answer is even "maybe", then make it a class.

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-18T14:44:44.340

Don't forget that **class** and **ID** are not mutually exclusive. There is nothing to stop you from having both! This is sometimes very useful as it allows an item to inherit common styling along with other elements of the same class as well as giving you precise control of that specific item. Another handy technique is to apply multiple classes to the same object (yes, `class="someClass someOtherClass"` is perfectly valid) For example:

```
<style>
div.box {
float: left;
border: 1px solid blue;
padding: 1em;
}

div.wide {
width: 40em; 
}

div.narrow {
width: 10em; 
}

div#oddOneOut {
float: right;
}
</style>

<div class="box wide">a wide box</div>
<div class="box narrow">a narrow box</div>
<div class="box wide" id="oddOneOut">an odd box</div> 
```

In theory it is also possible to get CSS to only apply to items that belong to several classes, e.g. `div.box.narrow {something: somevalue;}` but unfortunately this is not supported in all browsers. **Update 2011:** Multiple class selectors now have near universal browser support so go ahead and use them!

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-11-18T15:25:00.483

Don't forget that you can **link to an element that has an ID**. This can be very important for accessibility, among the other benefits. This is a good reason why for layout elements like header, navigation, main content, footer, search form and so on, you should always use an ID instead of a Class (or together with a Class).

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-19T05:48:55.593

Another useful resource is the [W3C spec on Cascading Order](http://www.w3.org/TR/CSS1/#cascading-order): `id` selectors are given *ten times* the weight of `class` selectors. This is especially important if you plan to override styles depending on different scenarios or state changes. The more specific the initial selector, the more work you have to do to override it in additional declarations.

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-18T12:48:43.857

The practice depends on the 'resolution' of what you're trying to select.

I use classes when I want to change a whole swag of elements. IDs give me a much more fine-grained control which is sometimes necessary.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-18T12:47:39.787

ID selectors have a high specificity, which is often what you need in CSS. The tighter you can get the CSS to apply to exactly what it needs to the less work the CSS renderer has to do in establishing rules.

Design to task, and do so in an OO manner - use classes where the objects *are* classlike, IDs where you mean to target instances, and treat tag refs as something like interfaces (and beware when you do so!). That's the best practice I can think of.

edit: and yeah MS really shafted CSS with ASP.NET thanks guys!

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-18T12:49:21.827

You should use an "id" when you're always talking about a single (and will always be single) seciton of your site.

Basically, it comes down to semantics.

```
div.header 
```

That's tells me that you allow multiple "headers" in your site. Perhaps these are sub headers.

```
div#header 
```

That tells me that you're talking about the single "header section" of your site layout.

EDIT: Here's a semi-old article about a Pure CSS design... if you just scan the CSS examples, you'll see why I use ID's in there: [How To: Pure CSS Design](http://www.singingeels.com/Articles/How_To_Pure_CSS_Design.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-18T15:55:32.827

IDs are for uniquely identifying elements, Classes are for identifying an element as being part of a class of elements.

In practical terms, id attributes should only be used one per document, class attributes can be used on more than one element on a document.

Check the [W3C spec](http://www.w3.org/TR/REC-html40/struct/global.html#h-7.5.2) and also the [CSS-Discuss](http://css-discuss.incutio.com/?page=ClassesVsIds) page on this issue.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-18T12:42:18.877

I prefer to use Class as the selector, so I can use it with more than one element at the same page. Using the id as the selector, does not allow this, since the id must be unique.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-12-30T06:31:54.220

Please refer to:

Don’t use ID selectors in CSS: [http://screwlewse.com/2010/07/dont-use-id-selectors-in-css/](http://screwlewse.com/2010/07/dont-use-id-selectors-in-css/)

Don’t use IDs in CSS selectors?: [http://oli.jp/2011/ids/](http://oli.jp/2011/ids/)

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2010-03-09T22:32:57.703

Use only classes, almost never use IDs if you don't have to worry about speed or compatibility.

Using IDs is bad just like using global variables in Visual Basic code. The reason is that IDs have to be unique which introduces unnecessary and bad dependency between different independent parts of your code. Using something like .page1 .tab1>.field1 is better because you don't have to worry about uniqueness of field1 inside tab1 or uniqueness of tab1 inside page1\. With IDs you have to keep registry of your IDs to keep control and avoid collisions.

Use IDs only if you have to, for example href='#name' or if some library requires you to.

# c# - 这些 WndProc 代码是什么意思？

> ID：298626
> 
> 赞同：1
> 
> 时间：2008-11-18T12:44:53.757
> 
> 标签：c#, wndproc

我正在尝试制作[一个在您在外部单击时关闭的窗口，](https://stackoverflow.com/questions/298491/how-do-i-receive-clicks-outside-a-forms-window)目前我正在考虑通过处理 WndProc 函数来实现这一点。

到目前为止，我收到的所有消息似乎都没有用，但有一些我根本不明白。代码 0x0118、0xC123、0xC128 和 0xC12E 代表什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T13:22:55.597

0x0118：WM_SYSTIMER（未记录）用于插入符号闪烁

其他三个应该是应用程序定义的消息（0xC000 到 0xFFFF 范围内的任何消息），因此您不会在任何地方找到那些定义的消息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T12:55:54.123

一个简单的方法是只捕获鼠标。当您捕获鼠标时，您会在窗口外获得一个单击事件，然后捕获被关闭。

更难的方法是设置低级鼠标窗口挂钩。要进行全局挂钩，您必须将挂钩代码放在非托管 DLL 中。

一个*非常*简单的方法是在停用时关闭您的表单。

**编辑**：

哎呀。我刚刚意识到我没有回答您关于消息 ID 的直接问题。消息 0x118 未在 winuser.h 中定义，因此我假设它是未记录的消息 ID。0xC000 到 0xFFFF 范围内的消息 ID 是应用程序定义的消息。这些 ID 由`RegisterWindowMessage`.

# windows - Visual Studio 2008 中的“符号浏览器”是什么/在哪里？

> ID：298638
> 
> 赞同：5
> 
> 时间：2008-11-18T12:49:24.900
> 
> 标签：windows, visual-studio, ide

好的，这就是背景...我将手动修复我们项目中的多个资源头文件。这涉及修复此值，除其他外：`#define _APS_NEXT_SYMED_VALUE`...自动写入 in (normally) `resource.h`。

它被记录为具有此目的：

> _APS_NEXT_SYMED_VALUE 是您在符号浏览器中使用新建命令手动分配符号值时将发出的下一个符号值。

但是*符号*浏览器在哪里！？我想知道，因为我想知道我设置这些值是为了什么。我知道*类*浏览器/视图是什么，我知道*对象*浏览器是什么，但这让我抓狂。:-D 我什至用谷歌搜索过`"visual studio" "symbol browser"`，但没有找到有关浏览器的文档。如果那里有“新建”命令，我知道我来对地方了，我可以在其中手动分配一个符号值。唔...

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-18T13:18:03.813

在 Visual Studio 中，选择**View** / **Resource View**菜单选项，然后在**Resource View**中，右键单击 .rc 文件并选择**Resource Symbols**。

可以[在](http://msdn.microsoft.com/en-us/library/c7h5sz68.aspx)MSDN 上找到文档。

# ruby-on-rails - 如何使用 mongrel 压缩 http 响应

> ID：298644
> 
> 赞同：3
> 
> 时间：2008-11-18T12:50:56.537
> 
> 标签：ruby-on-rails, performance

我有一个使用大量 js 的 rails 应用程序（总共超过 1MB）。我想压缩它们以减少网站的整体加载时间。

我进行了快速搜索，发现大多数浏览器都接受压缩内容。

我想知道如何使我的 rails 应用程序发送压缩内容，从而改善用户体验。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T13:08:39.277

您应该始终让代理到您的杂种的 Web 服务器处理静态内容的服务及其压缩。永远不要将静态内容的请求传递给杂种。

例如，使用 nginx 只需将 gzip 指令添加到您的配置文件即可。

[http://topfunky.net/svn/shovel/nginx/conf/nginx.conf](http://topfunky.net/svn/shovel/nginx/conf/nginx.conf)

```
# 输出压缩节省带宽
  gzip打开；
  gzip_http_version 1.0；
  gzip_comp_level 2；
  gzip_proxied 任何；
  gzip_types text/plain text/html text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T15:34:20.623

已经提出并回答了两个类似的问题。希望那里的内容也会有所帮助。

[如何在 Apache 2.x 中使用 mod_deflate 预压缩文件？](https://stackoverflow.com/questions/75482/how-can-i-pre-compress-files-with-moddeflate-in-apache-2x)

[如何使用 Rails 压缩网页输出？](https://stackoverflow.com/questions/250566/how-do-i-gzip-webpage-output-with-rails)

# html - Oracle 到 Excel - PL/SQL 导出过程

> ID：298648
> 
> 赞同：11
> 
> 时间：2008-11-18T12:52:35.347
> 
> 标签：html, oracle, excel, vbscript, plsql

我正在编写将数据从 Oracle 导出到 Excel 的 pl/sql 过程。我需要数据格式，所以我不能使用 CSV。我已经尝试过使用 XML，但是当我想导出例如 70000 行和 50 列（几乎 300 MB ！！！）时，它会生成太大的文件。

这就是为什么我决定使用 HTML 标签来生成 XLS 文件的原因——它比 XML 小，我必须直接定义一些特殊列的格式（字符串、数字和日期由 Excel 自动格式化）。它非常简单方便，但我不能定义多个工作表。

您知道如何在使用 HTML 编写的 excel 文件中添加/定义多个工作表吗？我尝试使用像 <% ActiveWorkbook.Worksheet.Add %> 这样的 VBScript 公式，但它不起作用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T13:40:30.757

您可以通过 ODBC 或 OLEDB 将 Oracle 数据提取到现有的 Excel 文档，而不是在 Oracle 服务器上创建 Excel 或 HTML 文件。缺点是，您应该小心用户权限。

[https://www.youtube.com/watch?v=Adz0zZFePf8](https://www.youtube.com/watch?v=Adz0zZFePf8)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T19:16:42.697

我遇到过类似的问题，最终用一些 VBA 代码制作了一个电子表格，为我查询并填充了电子表格。我的任务是导出一系列表格，每个表格都在不同的工作表上，但任何标志都可以用来切换到新工作表。无论如何，如果您想查看代码，请告诉我。这是一个可以帮助你的块。只需将 TableSQL 字符串更改为您选择的任何内容。返回的每条记录将作为一行插入工作表中。然后，根据您决定的任何标志，您可以创建并移动到下一张表。如果您需要更多信息，请告诉我（因为这个特定的例子并不是您在做什么）

```
Private Sub getMyRows(inSchema As String, InTable As String)
    Dim RS As Object
    Dim TableSQL As String
    Dim DataType As String
    Dim DataLength As String
    Dim DataPrecision As String
    Dim DataScale As String
    Dim ColCount As Integer
    Dim WS As Worksheet
' create a sheet with the current table as name
    Worksheets.Add().Name = InTable
    Set RS = CreateObject("ADODB.recordset")
    TableSQL = "Select * from " & inSchema & "." & InTable
' grab the data
    RS.Open TableSQL, conn, adOpenStatic
    For ColCount = 0 To RS.Fields.Count - 1
' set column headings to match table
       ActiveSheet.Cells(1, ColCount + 1).Value = RS.Fields(ColCount).Name
    Next

' copy table data to sheet
     With Worksheets(InTable).Range("A2")
        .CopyFromRecordset RS
    End With
    RS.Close

  End Sub 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-13T08:42:51.677

还有另一个项目 ORA_EXCEL ( [www.oraexcel.com](http://www.oraexcel.com) ) 可以仅使用 PL/SQL 从 Oracle 数据库生成 Excel 文档。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-19T05:17:13.737

您可以获得 Tom Kyte 的[OWA-SYLK](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:728625409049)实用程序，它支持 .xls 格式功能的子集。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-04T13:24:41.557

ExcelDocumentType 是一个很好的解决方案。它允许您使用 PL/SQL 生成功能齐全的多页 Excel 文档。你可以在这里找到它：

[http://radio.weblogs.com/0137094/2006/10/26.html](http://radio.weblogs.com/0137094/2006/10/26.html)

[http://radio.weblogs.com/0137094/2009/01/02.html](http://radio.weblogs.com/0137094/2009/01/02.html)

（Jason Bennett 的开发者专区）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-22T03:35:51.493

我在网上找到了这个解决方案（不是我发明的），使用 SQL plus：

```
set feed off markup html on spool on
spool c:\table1.xls
select * from table1;
spool off
set markup html off spool off 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-04-18T08:14:20.943

来自：[MSDN](http://msdn.microsoft.com/en-us/library/ms807027.aspx)。如果您希望您的工作表是可移植的并且不依赖于系统 DSN，您可以使用如下连接字符串进行连接：

```
Dim cnn As ADODB.Connection
Set cnn = New ADODB.Connection

cnn.ConnectionString = "Provider=OraOLEDB.Oracle.1;Password=<PASSWORD>;Persist Security Info=True;User ID=<USER ID>;Data Source=<DATABASE NAME>"
cnn.Open 
```

...然后使用[Moleboy 的解决方案](https://stackoverflow.com/a/927673/638471)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-01T15:34:24.763

我们使用 OOXML 方法。我们最初是在 PL/SQL 中编写自己的方法，但一位同事发现了这个名为 Excellant 的产品。它是你传入一个带有列映射和样式/公式的 xml 规范（几乎所有 excel 公式都有效），查询它会给你一个回滚。因此，如果你想让它更小，你可以在 clob 上运行 gzip。该产品非常便宜，我的经理用 pcard 购买了它。

该网站是 www.peak42solutions.com。我们不能使用 ODBC，因为网络人员不允许直接访问数据库。我们现在正在通过电子邮件将 Excel 发票发送给客户。

谢谢，

账单

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-18T19:50:15.097

您可以在 Excel 中将（小）Excel 工作表另存为 html，然后重现该格式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-30T21:04:25.877

There is a product called SQL*XL which allows you to run sql queries from within Excel, and the results appear within the worksheet (it can also update).

It is commercial, not free, but is only about €50, so not expensive. I use it quite a lot

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-12-28T05:59:57.420

您的问题似乎类似于 SO 中的一个线程（[在 ExcelSheet 中使用 Oracle 中的 UTL_FILE 包编写](https://stackoverflow.com/questions/8414050/writing-in-excelsheet-using-utl-file-package-in-oracle/41356098#41356098)。），我最近能够找到一个简单的解决方案来解决这个问题。我使用了一个名为`as_xlsx`Anton Scheffer 创建的包（[使用 PL/SQL 创建 Excel 文件](https://technology.amis.nl/2011/02/19/create-an-excel-file-with-plsql/ "使用 PL/SQL 创建 Excel 文件")）并进行了一些修改，因此它通过循环在单个 Excel 工作簿中创建了多个工作表。它还支持一些基本格式，如单元格颜色、字体样式、字体大小、边框等。它非常漂亮。（[使用 PL/SQL 创建 Excel 文件 (.xlsx)](https://stackoverflow.com/questions/41299024/create-an-excel-file-xlsx-using-pl-sqla)）。

希望这可以帮助！

# asp.net - 从 Session_End 上的缓存中删除特定用户数据

> ID：298653
> 
> 赞同：1
> 
> 时间：2008-11-18T12:55:33.377
> 
> 标签：asp.net, caching, session-timeout

当用户登录时，我在缓存中插入一些东西。

现在我想在用户会话到期时从缓存中删除它。HttpContext 为 null .. 所以我不知道会话为哪个用户过期。我怎样才能找到这个？

**编辑：**不幸的是 SessionID 并没有给我太多。在这种特殊情况下，我正在做的是使用处理 AuthorizeRequest 的 HttpModule 将当前用户名插入缓存中，以确保来自另一台机器的另一个用户无法登录。但是 HttpModule 中的 Session 为空。所以我不能用那个。还有其他建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T13:12:08.193

处理 global.asax 中的 Session_End 事件。在这里，您应该可以访问 SessionID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T13:45:54.787

您可以在 HttpModule 中进入会话，您只需要等到它被初始化，即 AcquireRequestState 事件 ( [http://msdn.microsoft.com/en-au/system.web.httpapplication.acquirerequeststate.aspx](http://msdn.microsoft.com/en-au/system.web.httpapplication.acquirerequeststate.aspx) )

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T14:26:44.330

假设您正在访问每个页面上的缓存项目，您可以将缓存项目设置为具有滑动到期。将过期时间设置为与会话超时时间相同。使用滑动过期，缓存将在每次访问对象时刷新，如果在该时间内未访问，则将其丢弃。

有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/4y13wyk9.aspx](http://msdn.microsoft.com/en-us/library/4y13wyk9.aspx)。

# c# - SqlMembershipProvider 管理

> ID：298659
> 
> 赞同：2
> 
> 时间：2008-11-18T12:59:36.753
> 
> 标签：c#, sqlmembershipprovider

在我开始为这个问题编写自己的解决方案之前，谁能指出我在使用 SqlMembershipProvider 时管理标准用户详细信息的预构建解决方案？我通过 Google 找到的解决方案似乎要么是半生不熟的“示例解决方案”，要么不适合日常使用。

问候理查德

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T13:30:26.347

[Peter Kellner](http://peterkellner.net)有一系列关于创建使用管理控制台作为主要示例的 Membership ObjectDataSource 的好文章。[您可以在http://peterkellner.net/2006/03/02/ajaxmeetsaspnet20/](http://peterkellner.net/2006/03/02/ajaxmeetsaspnet20/)找到最完整的示例。

# .net - 从 MS SQL 数据库获取 XML 架构

> ID：298660
> 
> 赞同：12
> 
> 时间：2008-11-18T13:00:05.440
> 
> 标签：.net, database, sql-server-2005, xsd, ndbunit

是否可以使用 .Net 和 C# 以编程方式生成数据库的 XML 模式？我想研究 NDbUnit，但对于大型数据库，手动制作 Schema 真的不可行吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-18T14:24:39.670

> 是否可以从数据库生成 XML 模式？

可以肯定的是，[XMLSpy](http://www.altova.com/dev_portal_xml_schema.html)可以从数据库生成 XML Schema。

还有[另一种方法](http://dwightrau.blogspot.com/2008/02/generate-or-create-xsd-schema-from.html)，虽然我从未测试过：

```
create table Person
(
Age int not NULL check( Age > 0) ,
Height numeric(10,2) not NULL check( Height > 5),
Gender varchar(5) not null check( Gender in ('M', 'F', 'O')),
BirthDate datetime null,
)

DECLARE @schema xml
SET @schema = (SELECT * FROM Person FOR XML AUTO, ELEMENTS, XMLSCHEMA('PersonSchema'))
select @schema 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T14:44:03.407

我可以这样做：

```
DataSet results = new DataSet();

SqlCommand command = new SqlCommand("SELECT * FROM table", new SqlConnection(connectionString));

SqlDataAdapter sqlAdapter = new SqlDataAdapter(command);

sqlAdapter.FillSchema(results, SchemaType.Mapped);//Fills dataset with schema from query
results.WriteXmlSchema(mySchema); 
```

问题是，我如何调整这种方法以便它可以用于不确定数量的表？没有建立一个字符串虽然不是很理想的连接！

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-07T11:11:31.660

使用 MyGeneration 的 typed-dataset-template 自动生成 XSD ( [http://www.mygenrationssoftware.com](http://www.mygenrationssoftware.com) )。它是免费的 OSS，而且效果很好。此外，NDbUnit 团队目前正在开发 NDbUnit 的附加工具，该工具不仅可以从数据库中提取模式，还可以编辑随附 XML 数据集中包含的测试数据。此工具的预计到达时间约为 7 月中旬。

# c# - 关于“onCallbackError”问题

> ID：298661
> 
> 赞同：0
> 
> 时间：2008-11-18T13:00:50.883
> 
> 标签：c#, asp.net, obout

我在 c# 中使用 obout 网格控件，但不确定如何从后面的代码中抛出错误！

我正在使用我从数据库中故意创建的 try catch 块（我可以看到它在 Visual Studio 中使用断点执行）捕获代码中的错误（创建具有相同标识符的另一条记录），但似乎无法让它弹出一个错误的消息框！

这是我正在使用的代码：

```
 void InsertRecord(object sender, GridRecordEventArgs e)
     {            
        try
        {
            string[] value = new string[] {/*records to be added */};

            connClass func = new connClass();

            func.fnRecord(value, "rm_category_add");

        }

        catch (Exception ne)
        {

             //here's the problem!!!!!!              
        }

    } 
```

如您在此处看到的，我还将 onCallbackerror 设置为 true：

```
 protected void Page_Load(object sender, EventArgs e)
    {
        grid1.ID = "grid1";
        grid1.CallbackMode = true;
        grid1.Serialize = true;
        grid1.AutoGenerateColumns = false;
        grid1.AllowAddingRecords = true;
        grid1.ShowLoadingMessage = true;
        grid1.FolderStyle = "../css/style_13";
        grid1.ClientSideEvents.OnClientCallback = "OnClientCallback";
        grid1.ClientSideEvents.OnClientCallbackError = "onCallbackError";            
        grid1.ClientSideEvents.OnClientDblClick = "fn_UpdateRecord";             
     } 
```

任何帮助，将不胜感激：）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T02:46:54.763

我不确定您是否可以在回调模式下执行此操作。

但是您可以使用 callbackerror 函数在 javascript 中捕获并显示错误。您可以将错误消息设置为显示在客户端的 div 中。我认为 obout 在这里有一个示例[http://www.obout.com/grid/KnowledgeBase.aspx?id=256](http://www.obout.com/grid/KnowledgeBase.aspx?id=256)

我不确定这是否正是您正在寻找的，但希望它有所帮助。

```
<script type"text/javascript">
    function onCallbackError(errorMessage, commandType, recordIndex, data) {
      alert(errorMessage);
    }
    </script> 
```

# .net - 如何在运行时找到作为 Windows 服务运行的 exe 的位置？

> ID：298669
> 
> 赞同：2
> 
> 时间：2008-11-18T13:06:40.093
> 
> 标签：.net, windows-services

如何在运行时找到作为 Windows 服务运行的 exe 的位置？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-18T14:09:14.617

使用注册表查找：

例如

```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\' + ServiceDisplayName; 
```

然后读取`ImagePath`值。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-18T13:41:50.927

以编程方式还是使用工具？

在后一种情况下，我建议使用 Sysinternals 的[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx "进程浏览器")：它显示所有正在运行的进程，包括服务，其中一个字段是用于运行进程的命令行，包括完整路径。

他们的命令行实用程序[PsService](http://technet.microsoft.com/en-us/sysinternals/bb897542.aspx "服务")也很有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T13:33:13.737

.NET - `Assembly.GetExecutingAssembly().Location`（其他人建议`Application.ExecutablePath`，但这需要引用`System.Windows.Forms`，服务通常不需要）

本国的 -`GetModuleFileName(NULL, ...)`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T13:11:17.073

如果这是 .NET，您需要**Application.ExecutablePath**（如果您尝试获取正在运行的 Windows 服务自己的应用程序路径）。如果您试图获取其他一些正在运行的 Windows 服务的路径，那就另当别论了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T13:09:42.847

如果您的可执行文件将自身附加到特定端口，您可以解析输出

```
netstat -ab 
```

可能不是最有吸引力的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T14:50:45.920

如果您不使用 .NET，最直接的方法是使用 Win32 的[::QueryServiceConfig()](http://msdn.microsoft.com/en-us/library/ms684932(VS.85).aspx)函数。这将为您提供路径名称、显示名称以及有关服务的各种其他信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-12T17:09:32.840

对于本机 Windows 代码：EXE 中的 GetModuleFileName(NULL...)（例如，不在服务加载的 DLL 中）。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-11-18T13:21:26.973

通常它们在 windows\system32 下运行，即使您可能已将其安装在另一个驱动器上

# c# - 用于分割、遍历和跟踪对象的模式

> ID：298677
> 
> 赞同：1
> 
> 时间：2008-11-18T13:10:12.643
> 
> 标签：c#, design-patterns

任何人都可以帮我找到一个用于拆分、遍历和跟踪对象的优雅设计。

下图显示了一个初始大小为 100 的对象，该对象被拆分为两个 (50, 75)，然后其中一个子对象 (75) 随后被拆分为三个 (25, 25 ,25)。

我的问题是，谁能想到一个优雅的设计，它允许我从**任何对象**遍历整个树（例如从任何后续子对象中识别根父对象）？

我当前的尝试（参见下面的代码）使用实例字段 Parent 和 Children 来跟踪对象，但它显然没有给我所需的功能——从 Obj [Id:6] 我无法递归地找到根父级。

谁能想到解决方案？我不认为双链表会起作用，因为溢出的参数不仅限于两个。

```
 Obj [Id:1, Size:100]
                             |
                    Split operation (50, 75)
                             <>
       Obj [Id:2, Size:25]      Obj [Id:2, Size:75]
                                          |
                              Split operation (25, 25, 25)
                                          <>
         Obj [Id:4, Size:25]     Obj [Id:5, Size:25]       Obj [Id:6, Size:25]

public class SplitableObj : IEquatable<SplitableObj>
{
    private Guid _id = Guid.NewGuid();
    private int _size;
    private SplitableObj _parent;
    private List<SplitableObj> _childern;

    public SplitableObj(int size)
    {
        _size = size;
    }
    public Guid id
    {
        get { return _id; }
        set { _id = value; }
    }

    public SplitableObj Parent
    {
        get { return _parent; }
        set { _parent = value; }
    }

    public List<SplitableObj> Children
    {
        get { return _childern; }
        set { _childern = value; }
    }

    public int Size
    {
        get { return _size; }
        set { _size = value; }
    }

    public IEnumerable<SplitableObj> Split(params int[] splits)
    {
        if (splits.Length < 2)
        {
            throw new ApplicationException("splits must be least 2.");
        }

        int totalSplits = 0;
        foreach (int split in splits)
        {
            totalSplits += split;
        }

        if (_size != totalSplits)
        {
            throw new ApplicationException("Total splits must equal Size.");
        }

        foreach (int split in splits)
        {
            SplitableObj splitAmount = new SplitableObj(split);
            splitAmount.Parent = this;
            this.Children.Add(splitAmount);
            yield return splitAmount;
        }
    }

    public bool Equals(SplitableObj splitableObj)
    {
        if (splitableObj == null) return false;
        return Equals(_id, splitableObj._id);
    }
    public override bool Equals(object obj)
    {
        if (ReferenceEquals(this, obj)) return true;
        return Equals(obj as SplitableObj);
    }
    public override int GetHashCode()
    {
        return _id.GetHashCode();
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T14:57:57.950

家庭作业？

```
set RootObject to the current object.
while the parent of RootObject is not undefined, set RootObject to its parent.
Finally, return RootObject. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T13:13:38.190

为什么你很难找到根？从父级到父级，直到父级未设置。

顺便说一句，您是在谈论 B+ 树吗？他们使用在超过阈值时拆分的子块自动平衡查看维基百科中的此图像[![图片](https://web.archive.org/web/20100305054914/http://upload.wikimedia.org:80/wikipedia/commons/f/fe/Btree.svg)](https://web.archive.org/web/20100305054914/http://upload.wikimedia.org:80/wikipedia/commons/f/fe/Btree.svg)

# c# - GetModifiedMembers 返回空数组

> ID：298689
> 
> 赞同：1
> 
> 时间：2008-11-18T13:16:13.507
> 
> 标签：c#, .net, linq-to-sql

下面的代码总是返回一个空数组，`GetModifiedMembers(object)` 但`dx.GetChangeSet().Updates.Contains( foo )`返回 true。

```
DataContext dx = new DataContext( string.Empty );
MockLinqDataObject foo = new MockLinqDataObject();
dx.GetTable( foo.GetType() ).Attach( foo );

foo.PK = Guid.NewGuid();

// always returns empty array
ModifiedMemberInfo[] arr_Result = dx.GetTable( foo.GetType() ).GetModifiedMembers( foo );
bool isOk = ( arr_Result.Length == 1 );
return isOk; 
```

有谁知道有什么问题？

提前致谢？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T22:54:42.080

我知道这不是答案，但我无法复制您的问题。

在控制台应用程序中使用以下代码，我得到一个长度为 1 的数组：

```
testdbDataContext db = new testdbDataContext();
Address a = new Address();
db.GetTable(a.GetType()).Attach(a);
a.Address1 = "simple change";

var result = db.GetTable(a.GetType()).GetModifiedMembers(a);
Console.WriteLine(result.Length);
Console.ReadKey(); 
```

控制台输出是`1`.

尝试修改 foo 对象上的另一个属性，看看您的结果是否不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-10-13T14:06:22.130

如果您在 SubmitChanges 之后检查长度，那么您将得到长度为 0，因为数据上下文中的更改在提交更改后被清除。

# jquery - 带有 jQ uery 验证的 ASP.Net MVC Ajax 表单

> ID：298691
> 
> 赞同：31
> 
> 时间：2008-11-18T13:18:07.450
> 
> 标签：jquery, asp.net-mvc, ajax, validation

我有一个 MVC 视图，其中包含使用 Ajax.BeginForm() 辅助方法构建的表单，并且我正在尝试使用[jQuery Validation plugin](http://docs.jquery.com/plugins/validation "jQuery 验证插件")验证用户输入。我让插件突出显示输入数据无效的输入，但尽管输入无效，但表单仍会发布到服务器。

如何阻止这种情况，并确保仅在表单验证时才发布数据？

我的代码

* * *

表格：

```
<fieldset>
    <legend>leave a message</legend>
        <% using (Ajax.BeginForm("Post", new AjaxOptions
           {
               UpdateTargetId = "GBPostList",
               InsertionMode = InsertionMode.InsertBefore,
               OnSuccess = "getGbPostSuccess",
               OnFailure = "showFaliure"
           }))
           { %>
        <div class="column" style="width: 230px;">
            <p>
                <label for="Post.Header">
                    Rubrik</label>
                <%= Html.TextBox("Post.Header", null, new { @style = "width: 200px;", @class="text required" }) %></p>
            <p>
                <label for="Post.Post">
                    Meddelande</label>
                <%= Html.TextArea("Post.Post", new { @style = "width: 230px; height: 120px;" }) %></p>
        </div>
        <p>
            <input type="submit" value="OK!" /></p>
    </fieldset> 
```

* * *

JavaScript 验证：

```
$(document).ready(function() {
    // for highlight
    var elements = $("input[type!='submit'], textarea, select");
    elements.focus(function() {
        $(this).parents('p').addClass('highlight');
    });
    elements.blur(function() {
        $(this).parents('p').removeClass('highlight');
    });

    // for validation
    $("form").validate();   
}); 
```

**编辑：**当我因发布后续问题及其在答案中的解决方案而遭到否决时，这也是有效的验证方法......

```
function ajaxValidate() {
    return $('form').validate({
    rules: {
        "Post.Header": { required: true },
        "Post.Post": { required: true, minlength: 3 }
    },
    messages: {
        "Post.Header": "Please enter a header",
        "Post.Post": {
            required: "Please enter a message",
            minlength: "Your message must be 3 characters long"
            }
        }
    }).form();
} 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-18T13:37:25.990

尝试将 OnBegin 回调添加到 AjaxOptions 并从回调中返回 $('form').validate().form() 的值。查看[源代码](http://www.codeplex.com/aspnet)似乎这应该有效。

```
function ajaxValidate() {
   return $('form').validate().form();
}

<% using (Ajax.BeginForm("Post", new AjaxOptions
       {
           UpdateTargetId = "GBPostList",
           InsertionMode = InsertionMode.InsertBefore,
           OnBegin = "ajaxValidate",
           OnSuccess = "getGbPostSuccess",
           OnFailure = "showFaliure"
       }))
       { %> 
```

**EDIT**更新了正确的回调名称。

# iis - Windows XP 上的 IIS 是否有任何限制？

> ID：298692
> 
> 赞同：2
> 
> 时间：2008-11-18T13:18:32.627
> 
> 标签：iis, windows-xp

对于我正在处理的项目，我注意到如果我使用 IIS FTP 和 HTTP 服务，文件传输* 速度真的很差。我知道我最不应该想到的是“这是一个 Windows 错误”，但事实上，仅通过在 Windows Server 上使用 IIS 或将 Windows XP 机器上的 IIS 更改为 FileZilla 和 LightHTTPd，我的文件传输速度从原来的配置，让我“嗯”了一声。

在 Windows XP 上运行 IIS 是否有任何限制？任何文件传输限制或类似的东西？

**文件传输是使用一个连接到一个文件来完成的。我的文件传输客户端是唯一一个连接到 PC 的客户端。**

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-10T07:21:30.767

正如其他人所说，默认情况下，Win XP 中的 IIS 5 有 10 个同时连接限制。这可以通过元数据库变量设置脚本增加到最多 40 个。

```
 cd \inetpub\adminscripts  
   cscript adsutil.vbs set w3svc/MaxConnections 40  
   iisreset 
```

第一个命令将目录更改为 IIS adminscripts 文件夹。第二个命令运行一个脚本，将 IIS 元数据库中的 MaxConnections 值设置为 40（允许的最大值）。第三个命令 (iisreset) 关闭然后重新启动 IIS。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T13:20:09.300

有十个并发连接的限制。使用 IIS 元数据库编辑工具可以将其增加到 30。

使用 LightHTTPd 可能会更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T13:20:21.437

有 10 个同时连接的限制...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T14:39:48.593

一个站点也有限制。请注意，站点！= 到虚拟目录/应用程序，因此对于程序员来说这很少是问题。

# c# - Windows 工具栏可停靠应用程序

> ID：298702
> 
> 赞同：2
> 
> 时间：2008-11-18T13:22:54.333
> 
> 标签：c#, .net, dockable

如何在 .NET 中创建 Windows 工具栏可停靠应用程序 - 如[Winamp Desk Band](http://www.winamp.com/plugins/details/82271)？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T13:57:09.320

听起来您想创建一个**AppBar**。

我建议您首先查看[Genghis 包](http://www.sellsbrothers.com/tools/genghis/)中包含的 AppBar 实现。我不能说它是否有任何好处，因为我从未使用过它，但它看起来很有希望。

手动，您将不得不使用一些 Win32 API 调用来保留/释放屏幕空间并实现您正在寻找的效果，如[本文所述](http://www.codeproject.com/KB/dotnet/AppBar.aspx)。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T22:11:25.663

# C# 做 Shell，第 3 部分

[http://www.codeproject.com/KB/shell/csdoesshell3.aspx](http://www.codeproject.com/KB/shell/csdoesshell3.aspx)

# 使用 C# 的 AppBar

[http://www.codeproject.com/KB/dotnet/AppBar.aspx](http://www.codeproject.com/KB/dotnet/AppBar.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-13T05:08:43.360

作为商业替代品，请参阅支持所有案例和条件的即用型[ShellAppBar](http://www.ssware.com/shlobj/shlobj.htm)组件，例如停靠在左侧、右侧、顶部、底部边缘的任务栏、支持多显示器、拖放停靠、自动隐藏等。

# sql-server - 事务复制

> ID：298704
> 
> 赞同：1
> 
> 时间：2008-11-18T13:22:59.873
> 
> 标签：sql-server, sql-server-2005, sql-server-2000, replication

可以在同一数据库服务器本身的一个数据库上创建的最大**发布者数量是多少？**

此外，反之亦然，

在同一数据库服务器本身的一个数据库上可以创建的最大**订阅者数量是多少？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T13:40:28.963

为什么要将订阅者放在同一个数据库服务器上？为什么一个数据库需要多个发布者？也许您应该解释您要解决的问题。

每个数据库只需要一个发布者。一个分发代理可以分发给许多订阅者。分发代理通常与发布者位于不同的服务器上；订阅者可以与分销商位于同一台服务器上。

订阅者的最大数量主要受网络带宽和发布者事务日志文件所在驱动器的能力限制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T15:59:09.260

我还没有听说过对出版物/订阅的“逻辑”限制。[正如@Mitch](https://stackoverflow.com/questions/298704/transactional-replication#298737)所指出的，您的限制将与许可（某些 SQL 版本对出版物的权利有限）或硬件问题相关联

# c++ - 在 Visual Studio 中使用命令行参数进行调试

> ID：298708
> 
> 赞同：571
> 
> 时间：2008-11-18T13:27:26.323
> 
> 标签：c++, visual-studio, debugging, command-line

我正在 Visual Studio 中开发 C++ 命令行应用程序，需要使用命令行参数对其进行调试。目前我只是用我需要的参数运行生成的 EXE 文件（像这样`program.exe -file.txt`），但是这样我无法调试。有没有可以指定调试参数的地方？

* * *

## 回答 #1

> 赞同：837
> 
> 时间：2008-11-18T13:28:30.547

是的，它位于项目属性页面的*调试*部分。

自 2008 年以来在 Visual Studio 中：右键单击*project*，选择*Properties*，转到*Debugging*部分——有一个“Command Arguments”框。（提示：不是解决方案，而是项目）。

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2009-01-06T19:19:01.067

关于在 Windows 上调试 Mozilla的[Mozilla.org 常见问题解答在](https://developer.mozilla.org/en/Debugging_Mozilla_on_Windows_FAQ)这里很有趣。

简而言之，可以从命令行对程序调用 Visual Studio 调试器，允许在调用命令行程序时直接在命令行上指定命令行参数。

这对于 Visual Studio 8 或 9（分别为 Visual Studio 2005 或 Visual Studio 2008）如下所示

```
  devenv /debugexe '程序名称' '程序参数'

```

也可以在 Visual Studio 调试器中使用资源管理器[操作](https://web.archive.org/web/20160606182914/http://www.olegsych.com:80/2007/08/debugexe-command-line-switch-in-visual-studio/)来启动程序。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-11-18T13:32:06.797

即使您确实在 Visual Studio 之外启动了可执行文件，您仍然可以使用“附加”命令将 Visual Studio 连接到您已经运行的可执行文件。例如，当您的应用程序在另一个应用程序中作为插件运行时，这可能很有用。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2015-02-12T11:12:39.510

微软 Visual Studio 终极版 2013。

您可以转到 DEBUG 菜单 → *Main Properties* → *Configuration properties* → *Debugging*，然后您将看到命令行参数框。

实际上，您可以为所有不同的配置设置相同的输入参数，而不仅仅是调试。

从配置的下拉菜单中选择：所有配置并插入输入参数（每个参数用空格分隔）。

现在，您可以在不同的模式下执行程序，而不必每次都更改输入参数。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2019-06-16T20:22:22.320

在 VS 2015 及更高版本中，使用[智能命令行参数](https://marketplace.visualstudio.com/items?itemName=MBulli.SmartCommandlineArguments)扩展。这个插件添加了一个窗口，允许您打开和关闭参数：

![智能命令行参数界面](https://mbulli.gallerycdn.vsassets.io/extensions/mbulli/smartcommandlinearguments/2.1.2/1554395906327/vsix_preview_image.png)

该扩展还将参数存储在 JSON 文件中，允许您将它们提交到源代码控制。除了确保您不必每次都输入所有参数之外，这还可以作为文档的有用补充，以供其他开发人员发现可用选项。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-05-07T08:02:37.307

在带有[.NET Core](https://en.wikipedia.org/wiki/.NET_Core)控制台应用程序的 Visual Studio 2017 中，执行以下操作：

右键单击*解决方案*窗口中的项目，选择“属性”，*调试*（在左侧），然后在*“应用程序参数”*字段中输入参数。

请注意，它们应该是空格分隔的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-02-17T21:57:51.053

右键单击Visual Studio*解决方案窗口中的项目，选择**“调试”*（在左侧），然后在*“命令参数”*字段中输入参数：

[![在此处输入图像描述](https://i.stack.imgur.com/eMjKA.jpg)](https://i.stack.imgur.com/eMjKA.jpg)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-05-25T13:45:50.043

这可能会帮助一些仍然有问题的人。我使用 Visual Studio 2015，只有在更改`argv`.

代替

```
int main(int argc, char **argv){
} 
```

我不得不使用

```
int main(int argc, char *argv[]){
} 
```

我不知道为什么它是必要的，但它有效。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-01-03T05:53:51.933

在 Visual Studio 2010 中，右键单击该项目，选择*Properties*，单击左窗格上的配置属性部分，然后单击*Debugging*，然后在右窗格中有一个命令参数框。

在其中输入命令行参数。你已准备好出发。现在调试并查看结果。如果您厌倦了更改属性，请暂时直接在程序中输入。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2022-02-05T05:50:48.673

在 VS 2022 中，可以调试任何可执行文件。打开包含 .exe 文件的文件夹

*   右键单击 .exe 文件，然后单击“设置为启动项”
*   再次右键单击 .exe 文件，然后单击“打开调试和启动设置”
*   将**args**添加到*launch_schema.json*，例如

```
{
  "version": "0.2.1",
  "defaults": {},
  "configurations": [
    {
      "type": "default",
      "project": "ffprobe.exe",
      "projectTarget": "",
      "name": "ffprobe.exe",
      "args": [ "C:\\Temp\\test-file" ]
    }
  ]
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-03-11T08:38:11.173

我发现一些旧的命令行参数存储在`MyStartUpProject.csproj.user`我的启动项目源文件夹下的文件中。删除此文件无效，Visual Studio 将其带回给我。我不得不编辑文件中的参数。

文件中的值没有显示在 VS、项目属性、调试中。在那里输入值会将它们附加到神秘`MyStartUpProject.csproj.user`文件中的值中。

# windows - 适用于 Windows 的最佳 CVS 客户端是什么？

> ID：298712
> 
> 赞同：24
> 
> 时间：2008-11-18T13:28:16.383
> 
> 标签：windows, cvs, wincvs

我们目前正在使用 WinCVS，但它很慢并且没有合并对话框。我正在寻找类似 Eclipse 的 Team Synchronize 的东西（这样人们就可以在更新之前看到他们会得到什么）。

你有什么建议？[TortoiseCVS](http://www.tortoisecvs.org/)与[WinMerge](http://winmerge.org/)？

注意：首选 OSS :)

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-18T13:36:42.107

在 Windows 上，使用 Tortoise CVS 和 WinMerge 肯定会满足您的需求。我也认为学习如何使用命令行进行一些操作也是一个好主意。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-19T14:22:27.817

第一：严格来说，到目前为止，这里引用的工具都不是 CVS**客户端**。它们都是 CVSNT 命令行客户端之上的“只是”GUI 前端（IIRC 只有 SmartCvs 使用普通的 CVS 客户端）。

所以，我很想听听您认为 WinCvs 中哪些特定操作很慢。真正的瓶颈通常是 CVS 协议本身，无论您使用哪个 GUI 前端，它的行为都是一样的。

另外，“没有合并对话框”到底是什么意思？
WinCvs 与 WinMerge（也作为冲突编辑器）很好地集成。
如果您正在谈论执行合并操作，您可以使用具有“合并选项”选项卡的更新命令......

对于预览更新，在 WinCvs 中也有几种方法：如果`cvs -n up`您只想查看哪些文件将被更新，您可以使用查询更新命令 (`HEAD`多个文件和文件夹）。

我已经安装了 Tortoise 和 WinCvs 多年，但通常发现我不使用 Tortoise，除非我因为没有得到所有大惊小怪而感到内疚...... ;)

我猜这完全是个人喜好问题，尤其是你是否更喜欢一个尽量不妨碍你的集成解决方案，而不是一个迫使你对版本控制任务做出有意识决定的独立应用程序。
WinCvs 对我来说可以满足我的所有需求，甚至更多，但我可能被认为是一个高级用户，并且在这方面有很大的偏见，因为我曾经是一个 cvsgui 邮件列表版主和常见问题解答作者，并且还编写了许多股票宏。

再说一次，对于 quuuuiiiite，WinCvs 上确实没有任何积极的开发...... :(

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-18T13:30:10.467

带有 WinMerge 的 TortoiseCVS 也是我对**CVS**的选择。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-11-18T13:44:34.760

[SmartCVS](http://www.syntevo.com/smartcvs/index.html)是 CVS 的另一个不错的选择。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-04-07T05:09:04.883

我目前也在寻找这个。我关注 WinCVS，我喜欢它。但对于我的java项目，我更喜欢满足我所有需求的eclipse..

编辑..我的坏..没看到日期:(

# asp.net - 创建 ASP.NET 移动 Web 应用程序时要记住的事项

> ID：298718
> 
> 赞同：4
> 
> 时间：2008-11-18T13:30:54.427
> 
> 标签：asp.net, mobile

我正在使用 asp.net 创建一个移动 Web 应用程序。应用程序必须支持 iPhone、Blackberry 和 Windows Mobile 平台。开发这个应用程序时应该注意哪些低级的事情。是否有任何可用的最佳实践列表？

**概括：**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T14:59:09.443

您可以添加更多信息吗？如果您正在为所有这些平台开发应用程序，我猜您是在创建某种 Web 服务还是只是一个“标准”Web 应用程序？

如果它只是一个标准的 web 应用程序，我认为很难确保良好的兼容性，因为广泛用于 web 应用程序的 javascript 并不总是在手机浏览器中实现......是的，如果你有 Opera，而不是 Pocket Internet Explorer，它会好一点。谈到黑莓，我不太确定浏览器的性能如何。

另一方面，Iphone 的开发可能“容易”，因为它的默认浏览器可能擅长 javascript - 就像 Opera mini 一样。

此外 - 由于许多 Windows Mobile 设备的分辨率较低而导致的其他图形问题也应考虑在内，但随着新设备的发布，这最终会变得更好:)（如 Touch HD、Omnia、Diamond 等）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-19T13:08:43.550

我认为您应该检查 asp.net 是否正在呈现 xHtml Mobile。移动设备检测非常旧，它不​​能正确检测某些设备。您应该将其更改为其他（如 WURFL）。

和一般的移动网络开发。

*   [w3c 移动网络最佳实践](http://www.w3.org/TR/mobile-bp/)
*   [dotmobi 移动 Web 开发人员指南](http://mobiforge.com/starting/story/dotmobi-mobile-web-developers-guide)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-19T05:15:42.010

使用[System.Web.Mobile](http://msdn.microsoft.com/en-us/library/system.web.mobile.aspx)命名空间

# algorithm - 请打破这个同步算法

> ID：298721
> 
> 赞同：2
> 
> 时间：2008-11-18T13:32:43.643
> 
> 标签：algorithm, synchronization, cluster-computing

P1 和 P2 是集群中的进程或节点。f1 和 f2 是他们的标志。假设强大的内存模型，并且两个进程都可能在任何时候重新启动，并且重新启动一个进程会清除它的标志，这是我想出的一个算法，但还不能破坏，但这让我很困扰，因为它在理论上没有得到证明并且与彼得森的相比，看起来太简单了。

```
P1 start:
set f1
if f2 set then clear f1, wait some, goto start
else enter critical section
do whatever
clear f1

P2 start:
set f2
if f1 set then clear f2, wait some, goto start
else enter critical section
do whatever
clear f2 
```

有人能看到流量吗？除了其中一个进程可能会通过快速重新进入该部分而使另一个进程挨饿吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T13:45:13.510

如果“如果 X 设置然后清除 Y”操作不是原子操作，则存在潜在的竞争条件，可能会阻止其中任何一个进入临界区。我试图概述下面的流程：

```
P1: set f1
P2: set f2
P1: is f2 set?
P2: is f1 set?
P1: yes, clear f1
P2: yes, clear f2
P1: start wait
P2: start wait
P1: end wait
P2: end wait
P1: goto start
P2: goto start 
```

这可能会永远持续下去，直到任务调度程序完成的分配有所不同，或者两个 P 的等待时间彼此不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T14:08:42.387

好吧，除了饥饿问题，我没有看到任何其他问题。

然而，彼得森的算法保证了公平性——每个进程都保证在下一次可用时立即获得关键部分——你的算法没有提供。

不过，我很好奇您为什么认为彼得森的算法不那么简单；它与你所拥有的并没有什么不同。

```
P1 start:
set f1
x = 2
while f2 and (x == 2) wait
enter critical section, etc.
clear f1 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T17:13:28.440

很容易证明这个算法保证了互斥。如果两个进程同时处于临界区，则表示两个标志都已设置且 F1 已设置在 F2 之前（来自 P1 的代码），并且 F2 已设置在 F1 之前（来自 P2 的代码）。这是不可能的，所以互斥是有保证的。

它比彼得森的简单，因为它不能保证有界等待 - 来自另一个答案的场景可以无限重复多次，尽管概率很快收敛到零（假设等待期的随机性很好）。

# linq - LINQ 中的多个“排序依据”

> ID：298725
> 
> 赞同：1721
> 
> 时间：2008-11-18T13:34:11.770
> 
> 标签：linq, sql-order-by

我有两个表，`movies`and ，我想先按**categoryID**`categories`获得有序列表，然后按**Name**。

 ****电影表有三列**ID、Name 和 CategoryID**。类别表有两列**ID 和 Name**。

我尝试了以下类似的方法，但没有奏效。

```
var movies = _db.Movies.OrderBy( m => { m.CategoryID, m.Name }) 
```

* * *

## 回答 #1

> 赞同：3049
> 
> 时间：2008-11-18T13:41:32.987

这应该适合你：

```
var movies = _db.Movies.OrderBy(c => c.Category).ThenBy(n => n.Name) 
```

* * *

## 回答 #2

> 赞同：620
> 
> 时间：2010-09-30T14:49:34.210

使用非 lambda 查询语法 LINQ，您可以执行以下操作：

```
var movies = from row in _db.Movies 
             orderby row.Category, row.Name
             select row; 
```

[编辑地址注释] 要控制排序顺序，请使用关键字`ascending`（这是默认的，因此不是特别有用）或`descending`，如下所示：

```
var movies = from row in _db.Movies 
             orderby row.Category descending, row.Name
             select row; 
```

* * *

## 回答 #3

> 赞同：79
> 
> 时间：2011-06-22T14:27:59.983

添新”：

```
var movies = _db.Movies.OrderBy( m => new { m.CategoryID, m.Name }) 
```

这适用于我的盒子。它确实返回了一些可以用来排序的东西。它返回一个具有两个值的对象。

与按组合列排序类似，但不同，如下所示。

```
var movies = _db.Movies.OrderBy( m => (m.CategoryID.ToString() + m.Name)) 
```

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2016-02-18T21:03:17.117

在您的 DataContext 上使用以下行将 DataContext 上的 SQL 活动记录到控制台 - 然后您可以准确地看到您的 linq 语句从数据库请求什么：

```
_db.Log = Console.Out 
```

以下 LINQ 语句：

```
var movies = from row in _db.Movies 
             orderby row.CategoryID, row.Name
             select row; 
```

和

```
var movies = _db.Movies.OrderBy(m => m.CategoryID).ThenBy(m => m.Name); 
```

生成以下 SQL：

```
SELECT [t0].ID, [t0].[Name], [t0].CategoryID
FROM [dbo].[Movies] as [t0]
ORDER BY [t0].CategoryID, [t0].[Name] 
```

而在 Linq 中重复 OrderBy 似乎会反转生成的 SQL 输出：

```
var movies = from row in _db.Movies 
             orderby row.CategoryID
             orderby row.Name
             select row; 
```

和

```
var movies = _db.Movies.OrderBy(m => m.CategoryID).OrderBy(m => m.Name); 
```

生成以下 SQL（名称和 CategoryId 已切换）：

```
SELECT [t0].ID, [t0].[Name], [t0].CategoryID
FROM [dbo].[Movies] as [t0]
ORDER BY [t0].[Name], [t0].CategoryID 
```

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2017-06-08T14:49:19.860

我创建了一些扩展方法（如下），因此您不必担心是否已经订购了 IQueryable。如果您想按多个属性排序，请按以下方式进行：

```
// We do not have to care if the queryable is already sorted or not. 
// The order of the Smart* calls defines the order priority
queryable.SmartOrderBy(i => i.Property1).SmartOrderByDescending(i => i.Property2); 
```

**如果您从要排序的属性列表中动态创建排序，这将特别有用。**

```
public static class IQueryableExtension
{
    public static bool IsOrdered<T>(this IQueryable<T> queryable) {
        if(queryable == null) {
            throw new ArgumentNullException("queryable");
        }

        return queryable.Expression.Type == typeof(IOrderedQueryable<T>);
    }

    public static IQueryable<T> SmartOrderBy<T, TKey>(this IQueryable<T> queryable, Expression<Func<T, TKey>> keySelector) {
        if(queryable.IsOrdered()) {
            var orderedQuery = queryable as IOrderedQueryable<T>;
            return orderedQuery.ThenBy(keySelector);
        } else {
            return queryable.OrderBy(keySelector);
        }
    }

    public static IQueryable<T> SmartOrderByDescending<T, TKey>(this IQueryable<T> queryable, Expression<Func<T, TKey>> keySelector) {
        if(queryable.IsOrdered()) {
            var orderedQuery = queryable as IOrderedQueryable<T>;
            return orderedQuery.ThenByDescending(keySelector);
        } else {
            return queryable.OrderByDescending(keySelector);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2015-04-03T14:07:07.250

使用 LINQ 至少还有一种方法可以做到这一点，尽管不是最简单的。您可以使用`OrberBy()`使用`IComparer`. 首先，您需要`IComparer`为这样的`Movie`类实现一个：

```
public class MovieComparer : IComparer<Movie>
{
    public int Compare(Movie x, Movie y)
    {
        if (x.CategoryId == y.CategoryId)
        {
            return x.Name.CompareTo(y.Name);
        }
        else
        {
            return x.CategoryId.CompareTo(y.CategoryId);
        }
    }
} 
```

然后您可以使用以下语法订购电影：

```
var movies = _db.Movies.OrderBy(item => item, new MovieComparer()); 
```

如果您需要将其中一项的排序切换为降序，只需在相应的`Compare()` 方法中切换 x 和 y 即可`MovieComparer`。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2018-07-17T14:29:42.083

如果使用通用存储库

```
> lstModule = _ModuleRepository.GetAll().OrderBy(x => new { x.Level,
> x.Rank}).ToList(); 
```

别的

```
> _db.Module.Where(x=> ......).OrderBy(x => new { x.Level, x.Rank}).ToList(); 
```

# c# - 使用 C# 访问 Excel 电子表格偶尔会为某些单元格返回空白值

> ID：298726
> 
> 赞同：11
> 
> 时间：2008-11-18T13:35:20.440
> 
> 标签：c#, excel, visual-studio-2008, oledb

我需要访问一个 Excel 电子表格并将电子表格中的数据插入 SQL 数据库。然而，主键是混合的，大多数是数字的，有些是字母数字的。

我遇到的问题是，当数字和字母数字键位于同一个电子表格中时，字母数字单元格返回空白值，而所有其他单元格返回它们的数据没有问题。

我正在使用 OleDb 方法来访问 Excel 文件。使用命令字符串检索数据后，我将数据放入 DataAdapter，然后填充 DataSet。我遍历 DataSet 中第一个 DataTable 中的所有行 (dr)。

我使用 dr["..."].ToString() 引用列

如果我在 Visual Studio 2008 中调试项目并查看“扩展属性”，通过将鼠标悬停在“dr”上，我可以查看 DataRow 的值，但应该是字母数字的主键是 {}。其他值用引号括起来，但空白值带有大括号。

这是 C# 问题还是 Excel 问题？

有没有人以前遇到过这个问题，或者可能找到了解决方法/修复？

提前致谢。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-08-10T04:41:57.913

解决方案：

连接字符串：

> Provider=Microsoft.Jet.OLEDB.4.0;Data Source=FilePath;Extended Properties="Excel 8.0;HDR=Yes;IMEX=1";

1.  `HDR=Yes;`表示第一行包含列名，而不是数据。`HDR=No;`表示相反。

2.  `IMEX=1;`告诉驱动程序始终将“混合”（数字、日期、字符串等）数据列作为文本读取。请注意，此选项可能会对 excel 工作表写入访问产生负面影响。

SQL 语法`SELECT * FROM [sheet1$]`。即excel工作表名称后跟a`$`并用`[` `]`括号括起来。

重要的：

*   查看位于注册表 REG_DWORD "TypeGuessRows" 的 [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Jet\4.0\Engines\Excel]。这是不让 Excel 仅使用前 8 行来猜测列数据类型的关键。将此值设置为 0 以扫描所有行。这可能会损害性能。

*   如果 Excel 工作簿受密码保护，则无法打开它进行数据访问，即使提供正确的密码和连接字符串也是如此。如果您尝试，您会收到以下错误消息：“无法解密文件”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T16:47:36.813

Excel 数据源为整个列选择一种列类型。如果其中一个单元格与该类型不完全匹配，则会留下这样的空白。我们遇到的问题是，我们的打字员在数字列中输入了“8”（数字前有一个空格，因此 Excel 将其转换为该单元格的字符串）。对我来说，尝试使用 .Net Parse 方法是有意义的，因为它们更健壮，但我想这不是 Excel 驱动程序的工作方式。

由于我们使用数据库导入服务，我们的解决方法是记录所有以这种方式“失败”的行。然后，我们返回 XLS 文档并重新键入这些单元格，以确保基础类型正确。（我们发现仅仅删除空格并不能解决问题——我们必须先清除整个单元格，而不是重新输入“8”。）感觉 hacky 并且不是 elagent，但这是我们找到的最佳方法。如果 Excel 驱动程序无法自行正确读取它，那么一旦您进入 .Net，您就无法从那里获取这些数据。

Office 以简单的名义向用户隐藏重要细节的另一种情况，因此在您必须准确使用电源时变得更加困难。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T14:35:42.377

{} 表示这是某种空对象，而不是字符串。当您将鼠标悬停在对象上时，您应该能够看到它的类型。同样，当您使用 quickwatch 查看 dr["..."] 时，您应该看到对象类型。您收到的对象是什么类型的？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-09T16:18:10.303

[我在这里](https://stackoverflow.com/questions/429853/scientific-notation-when-importing-from-excel-in-net)回答了一个类似的问题。为了您的方便，我在这里复制并粘贴了相同的答案：

我遇到了同样的问题，但无需借助 Excel COM 接口或第 3 方软件即可解决此问题。它涉及一些处理开销，但似乎对我有用。

1.  首先读入数据得到列名
2.  然后使用这些列中的每一个创建一个新的 DataSet，将它们的每个 DataTypes 设置为字符串。
3.  再次将数据读入这个新数据集中。瞧——科学记数法现在消失了，一切都以字符串的形式读入。

这是一些说明这一点的代码，作为额外的奖励，它甚至是 StyleCopped！

```
public void ImportSpreadsheet(string path)
{
    string extendedProperties = "Excel 12.0;HDR=YES;IMEX=1";
    string connectionString = string.Format(
        CultureInfo.CurrentCulture,
        "Provider=Microsoft.ACE.OLEDB.12.0;Data Source={0};Extended Properties=\"{1}\"",
        path,
        extendedProperties);

    using (OleDbConnection connection = new OleDbConnection(connectionString))
    {
        using (OleDbCommand command = connection.CreateCommand())
        {
            command.CommandText = "SELECT * FROM [Worksheet1$]";
            connection.Open();

            using (OleDbDataAdapter adapter = new OleDbDataAdapter(command))
            using (DataSet columnDataSet = new DataSet())
            using (DataSet dataSet = new DataSet())
            {
                columnDataSet.Locale = CultureInfo.CurrentCulture;
                adapter.Fill(columnDataSet);

                if (columnDataSet.Tables.Count == 1)
                {
                    var worksheet = columnDataSet.Tables[0];

                    // Now that we have a valid worksheet read in, with column names, we can create a
                    // new DataSet with a table that has preset columns that are all of type string.
                    // This fixes a problem where the OLEDB provider is trying to guess the data types
                    // of the cells and strange data appears, such as scientific notation on some cells.
                    dataSet.Tables.Add("WorksheetData");
                    DataTable tempTable = dataSet.Tables[0];

                    foreach (DataColumn column in worksheet.Columns)
                    {
                        tempTable.Columns.Add(column.ColumnName, typeof(string));
                    }

                    adapter.Fill(dataSet, "WorksheetData");

                    if (dataSet.Tables.Count == 1)
                    {
                        worksheet = dataSet.Tables[0];

                        foreach (var row in worksheet.Rows)
                        {
                            // TODO: Consume some data.
                        }
                    }
                }
            }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-19T04:48:56.743

ItemArray 是一个对象数组。所以我假设我试图引用的 DataRow 中的“列”是对象类型。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T15:49:51.520

为了兼容 VISTA，您可以在连接字符串中使用 EXCEL 12.0 驱动程序。这应该可以解决您的问题。它做到了我的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-03T09:53:14.103

解决方案：

1.  您输入 HDR=No 以便第一行不被视为列标题。连接字符串：Provider=Microsoft.Jet.OLEDB.4.0;Data Source=FilePath;Extended Properties="Excel 8.0;HDR=No;IMEX=1";
2.  您忽略第一行并通过任何您想要的方式访问数据（DataTable、DataReader 等）。您通过数字索引而不是列名访问列。

它对我有用。这样您就不必修改寄存器！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-10-25T16:40:03.750

通过 ascii 代码以降序对 xls 文件中的记录进行排序，以便字母数字字段将出现在标题行下方的顶部。这确保了读取的第一行数据将数据类型定义为“varchar”或“nvarchar”

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-16T19:49:53.693

这不完全正确！显然，如果前 8 行为空，则 Jet/ACE 总是假定字符串类型，而不管 IMEX=1。即使我在注册表中将行读取为 0，我仍然遇到同样的问题。这是让它工作的唯一可靠的方法：

 `````
try
{
    Console.Write(wsReader.GetDouble(j).ToString());
}
catch   //Lame unfixable bug
{
    Console.Write(wsReader.GetString(j));
} 
````  `* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-05-13T08:48:35.433

嗨，所有这些代码也是获取字母数字值

```
using System.Data.OleDb;

string ConnectionString = @"Provider=Microsoft.Jet.OLEDB.4.0;" + "Data Source=" + filepath + ";" + "Extended Properties="+(char)34+"Excel 8.0;IMEX=1;"+(char)34;

string CommandText = "select * from [Sheet1$]";

OleDbConnection myConnection = new OleDbConnection(ConnectionString);
myConnection.Open();

OleDbDataAdapter myAdapter = new OleDbDataAdapter(CommandText, myConnection);

ds = null;
ds = new DataSet();
myAdapter.Fill(ds); 
```

# java - java.util.List 是一个接口，JAXB 不能处理接口

> ID：298733
> 
> 赞同：50
> 
> 时间：2008-11-18T13:39:59.417
> 
> 标签：java, web-services, jakarta-ee, jaxb, jbossws

尝试部署我的应用程序时，我似乎遇到了以下异常：

```
Caused by: com.sun.xml.bind.v2.runtime.IllegalAnnotationsException: 2 counts of     IllegalAnnotationExceptions
java.util.List is an interface, and JAXB can't handle interfaces.
this problem is related to the following location:
    at java.util.List
    at private java.util.List     foobar.alkohol.register.webservice.jaxws.GetRelationsFromPersonResponse._return
    at     foobar.alkohol.register.webservice.jaxws.GetRelationsFromPersonResponse
java.util.List does not have a no-arg default constructor.
    this problem is related to the following location:
        at java.util.List
        at private java.util.List foobar.alkohol.register.webservice.jaxws.GetRelationsFromPersonResponse._return
    at     foobar.alkohol.register.webservice.jaxws.GetRelationsFromPersonResponse 
```

 **我的代码运行良好，直到我将返回类型从 List 更改为 List<List<RelationCanonical>>**

这是部分网络服务：

```
 @Name("relationService")
@Stateless
@WebService(name = "RelationService", serviceName = "RelationService")
@SOAPBinding(style = SOAPBinding.Style.DOCUMENT, use = SOAPBinding.Use.LITERAL, parameterStyle = SOAPBinding.ParameterStyle.WRAPPED)
public class RelationService implements RelationServiceLocal {

    private boolean login(String username, String password) {
        Identity.instance().setUsername(username);
        Identity.instance().setPassword(password);
        Identity.instance().login();
        return Identity.instance().isLoggedIn();
    }

    private boolean logout() {
        Identity.instance().logout();
        return !Identity.instance().isLoggedIn();
    }

    @WebMethod
    public List<List<RelationCanonical>> getRelationsFromPerson(@WebParam(name = "username")
    String username, @WebParam(name = "password")
    String password, @WebParam(name = "foedselsnummer")
    String... foedselsnummer) {

......
......
......
} 
```

**我也尝试过删除@SOAPBinding 并尝试默认值，但结果相同。感谢任何帮助**

**更新**

我想说明一些事情。我把所有的List都改成了ArrayList，然后编译了。我之所以说已编译但无法正常工作是因为它的行为很奇怪。我得到一个类型的对象：RelationServiceStub.ArrayList，但该对象没有 get 方法或也不像 List 一样。我也尝试将其转换为列表，但没有奏效。

请注意，这是在我使用了 Axis 2 和 wsdl2java 之后，所以是的，现在它可以编译了，但我不知道如何获取数据。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-18T14:39:50.123

据我了解，您将无法`List`通过 JAXB 处理纯文本，因为 JAXB 不知道如何将其转换为 XML。

相反，您需要定义一个 JAXB 类型，该类型包含 a `List<RelationCanonical>`（我将其称为`Type1`），然后再定义一个包含这些类型的列表（当您处理 a 时`List<List<...>>`，我将其称为此类型`Type2`） .

结果可能是这样的 XML 输出：

```
<Type2 ...>
    <Type1 ...>
        <RelationCanonical ...> ... </RelationCanonical>
        <RelationCanonical ...> ... </RelationCanonical>
        ...
    </Type1>
    <Type1>
        <RelationCanonical ...> ... </RelationCanonical>
        <RelationCanonical ...> ... </RelationCanonical>
        ...
    </Type1>
    ...
</Type2> 
```

如果没有两个封闭的 JAXB 注释类型，JAXB 处理器不知道要生成什么标记，因此会失败。

- 编辑：

我的意思应该看起来像这样：

```
@XmlType
public class Type1{

    private List<RelationCanonical> relations;

    @XmlElement
    public List<RelationCanonical> getRelations(){
        return this.relations;
    }

    public void setRelations(List<RelationCanonical> relations){
        this.relations = relations;
    }
} 
```

和

```
@XmlRootElement
public class Type2{

    private List<Type1> type1s;

    @XmlElement
    public List<Type1> getType1s(){
        return this.type1s;
    }

    public void setType1s(List<Type1> type1s){
        this.type1s= type1s;
    }
} 
```

您还应该查看[J5EE 教程](http://java.sun.com/javaee/5/docs/tutorial/doc/bnazf.html)和[非官方 JAXB 指南](http://jaxb.java.net/guide/Mapping_interfaces.html)中的 JAXB 部分。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-07-13T12:48:31.783

如果这适合您的目的，您始终可以像这样定义一个数组：

```
YourType[] 
```

JAXB 当然可以弄清楚那是什么，您应该能够立即在客户端使用它。我也建议您这样做，因为您不应该能够修改通过 List 而是通过 Web 服务提供的方法从服务器检索到的数组

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-31T23:35:23.517

如果您想为任何课程执行此操作。

```
return items.size() > 0 ? items.toArray((Object[]) Array.newInstance(
            items.get(0).getClass(), 0)) : new Object[0]; 
```

* * *

## 回答 #4

> 赞同：-5
> 
> 时间：2013-09-12T01:49:16.163

您可以使用“ArrayList”而不是内部“List”

# database - 模式与表和数据库之间有什么区别？

> ID：298739
> 
> 赞同：190
> 
> 时间：2008-11-18T13:41:27.667
> 
> 标签：database, schema, definition, database-table

这可能是一个 n00blike（或更糟）的问题。但我一直将模式视为数据库中的表定义。这是错误的或不完全正确的。我不太记得我的数据库课程。

* * *

## 回答 #1

> 赞同：274
> 
> 时间：2008-11-18T13:45:13.447

**架构**-> 平面图

**数据库**-> 房子

**桌子**-> 房间

* * *

## 回答 #2

> 赞同：142
> 
> 时间：2008-11-18T13:49:56.043

*关系模式*是表的逻辑定义——它定义了表的名称是什么，以及每列的名称和类型是什么。这就像一个计划或蓝图。*数据库模式*是整个数据库的关系模式的集合。

*表*是具有一堆行（也称为“元组”）的结构，每个行都具有模式定义的属性。表上可能还有索引，以帮助查找某些列上的值。

从形式上讲，*数据库*是任何数据的集合。在这种情况下，数据库将是表的集合。*DBMS*（数据库管理系统）是管理和运行数据库的软件（如 MySQL、SQL Server、Oracle 等）。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-11-18T13:48:45.607

简而言之，模式是整个数据库的定义，因此它包括表、视图、存储过程、索引、主键和外键等。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-11-18T13:52:18.893

已显示此特定帖子仅与 Oracle 相关，并且在另一个 DB 的上下文中，Schema 的定义会发生变化。

可能只是谷歌搜索，但仅供参考的术语似乎在定义上有所不同，这是最烦人的事情:)

在 Oracle 中，数据库就是数据库。在您的脑海中，将其视为数据文件和重做日志以及数据库本身（即不是实例）磁盘上的实际物理存在

Schema 实际上是一个用户。更具体地说，它是用户拥有的一组表/过程/索引等。另一个用户有不同的架构（他/她拥有的表），但是用户也可以看到他们拥有选择权限的任何架构。所以一个数据库可以包含数百个模式，每个模式有数百个表。您可以在同一数据库中的不同模式中拥有具有相同名称的表。

表是一个表，一组包含数据的行和列，并且包含在模式中。

例如，SQL Server 中的定义可能不同。我不知道这一点。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2012-02-15T09:40:00.600

Schema 的行为看起来像 OOP 世界中的父对象。所以它不是数据库本身。也许[这个链接](http://www.sql.org/sql-database/postgresql/manual/sql-createschema.html)很有用。

但是，在 MySQL 中，两者是等价的。无论出现在何处，关键字 DATABASE 或 DATABASES 都可以替换为 SCHEMA 或 SCHEMAS。例子：

*   创建数据库 <=> 创建模式
*   显示数据库 <=> 显示模式

[MySQL的文档](http://dev.mysql.com/doc/refman/5.0/en/create-database.html)

SCHEMA & DATABASE 术语依赖于 DBMS。

**表**是一组数据元素（值），使用垂直列（由其名称标识）和水平行的模型进行组织。数据库包含一个或多个（通常）**Tables**。您将数据存储在这些表中。这些表可能相互关联（[参见此处](http://www.sql-tutorial.com/relations-keys-normalization-sql-tutorial/)）。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2019-10-04T05:47:28.590

从[PostgreSQL 文档](https://www.postgresql.org/docs/9.1/ddl-schemas.html)：

> 数据库包含一个或多个命名模式，这些模式又包含表。模式还包含其他类型的命名对象，包括数据类型、函数和运算符。相同的对象名称可以在不同的模式中使用而不会发生冲突；例如，两者`schema1`和`myschema`都可以包含名为`mytable`. 与数据库不同，模式不是严格分开的：用户可以访问他连接到的数据库中任何模式中的对象，如果他有权限这样做的话。
> 
> 使用模式有几个原因：
> 
> *   允许多个用户使用一个数据库而不互相干扰。
>     
>     
> *   将数据库对象组织成逻辑组以使其更易于管理。
>     
>     
> *   第三方应用程序可以放入单独的模式中，这样它们就不会与其他对象的名称发生冲突。
>     
>     
> 
> 模式类似于操作系统级别的目录，只是模式不能嵌套。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2021-04-01T09:40:41.477

[![在此处输入图像描述](https://i.stack.imgur.com/4jDwG.jpg)](https://i.stack.imgur.com/4jDwG.jpg)

根据[https://www.informit.com/articles/article.aspx?p=30669](https://www.informit.com/articles/article.aspx?p=30669)

> 所有对象的名称在某个范围内必须是唯一的。每个数据库都必须有一个唯一的名称；架构名在单个数据库范围内必须唯一，表名在单个架构范围内必须唯一，列名在表内必须唯一。索引的名称在数据库中必须是唯一的。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-03-14T18:51:04.900

与上述一些答案相反，这是我基于对每个答案的经验的理解：

*   MySQL：`database/schema :: table`
*   SQL 服务器：`database :: (schema/namespace ::) table`
*   甲骨文：`database/schema/user :: (tablespace ::) table`

请纠正我在 Oracle 中表空间是否是可选的，自从我记得使用它们以来已经很长时间了。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-04-12T02:50:26.187

正如MusiGenesis 所说，在大多数数据库中：

> 架构：数据库：表：：平面图：房屋：房间

但是，在 Oracle 中可能更容易想到：

架构：数据库：表：：所有者：房子：房间

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-18T20:46:41.740

更多关于模式：

在 SQL 2005 中，模式是对对象进行分组的一种方式。它是一个可以放入对象的容器。人们可以拥有这个对象。您可以授予对架构的权限。

在 2000 年，架构相当于一个用户。现在它已经摆脱了束缚并且非常有用。您可以将所有用户 procs 放入某个架构中，并将您的 admin procs 放入另一个架构中。将 EXECUTE 授予适当的用户/角色，您就可以在特定过程上授予 EXECUTE。好的。

点符号将如下所示：

Server.Database.Schema.Object

或者

myserver01.Adventureworks.Accounting.Beans

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-07-03T07:09:49.703

A`Schema`是包含逻辑结构的数据库对象的集合。它具有拥有它的用户的名称。A`database`可以有任意数量的 Schema。数据库中的一个表可以出现在两个不同的同名模式中。用户可以查看为其分配了选择权限的任何架构。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-02-09T06:04:28.327

oracle中的Schema是一个数据库下的一个用户，例如scott就是数据库orcl中的一个schema。在一个数据库中，我们可能有许多类似 scott 的模式

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-12-04T16:02:42.887

模式包含数据库。

数据库是模式的一部分。

因此，模式 > 数据库。

Schemas 包含视图、存储过程、数据库、触发器等。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-03-27T16:01:43.047

模式不是整个数据库的计划。它是数据库内对象子集（例如表）的计划/容器。

这就是说，您可以在一个数据库中拥有多个对象（例如表），这些对象不一定属于同一功能类别。因此，您可以将它们分组到各种架构下，并赋予它们不同的用户访问权限。

也就是说，我不确定您是否可以在多个模式下拥有一个表。Management Studio UI 提供了一个下拉菜单以将架构分配给表，因此可以只选择一个架构。我想如果你用 TSQL 来做，它可能会创建 2 个（或多个）具有不同对象 ID 的不同对象。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-10-18T09:11:42.593

数据库**模式**是一种对对象进行逻辑分组的方法，例如表、视图、存储过程等。将模式视为对象的容器。表格是行和列的集合。所有表的组合构成一个数据库。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-08-07T14:41:56.520

我尝试根据我对以下类比的理解来回答：

*   数据库**就像**房子
*   房子里有几种类型的房间。假设你住在一个非常大的房子里。你真的不希望你的客厅、卧室、浴室、夹层楼、树屋等看起来一样。他们每个人都需要一个蓝图来说明如何构建/使用它们。换句话说，例如，他们每个人都需要一个**模式**来说明如何建造/使用浴室。
*   当然，您可能有几间卧室，每间看起来都略有不同。您和您妻子/丈夫的卧室与您孩子的卧室略有不同。每间卧室都类似于数据库中的一张**桌子**。
*   **DBMS**就像家中的管家。从字面上看，他管理着一切。

# javascript - 如何通过 JavaScript 发送跨域 POST 请求？

> ID：298745
> 
> 赞同：602
> 
> 时间：2008-11-18T13:43:53.870
> 
> 标签：javascript, ajax, cross-domain

如何通过 JavaScript 发送跨域 POST 请求？

注意 - 它不应该刷新页面，之后我需要抓取并解析响应。

* * *

## 回答 #1

> 赞同：399
> 
> 时间：2011-09-30T01:34:23.913

**更新：**在继续之前，每个人都应该阅读并理解 CORS 上的[html5rocks 教程](http://www.html5rocks.com/en/tutorials/cors/)。这很容易理解并且非常清楚。

如果您控制正在发布的服务器，只需通过在服务器上设置响应标头来利用“跨源资源共享标准”。这个答案在这个线程的其他答案中讨论过，但在我看来不是很清楚。

简而言之，这是您如何完成从 from.com/1.html 到 to.com/postHere.php 的跨域 POST（以 PHP 为例）。注意：您只需要`Access-Control-Allow-Origin`为 NON`OPTIONS`请求设置 - 此示例始终为较小的代码片段设置所有标头。

1.  在 postHere.php 中设置以下内容：

    ```
    switch ($_SERVER['HTTP_ORIGIN']) {
        case 'http://from.com': case 'https://from.com':
        header('Access-Control-Allow-Origin: '.$_SERVER['HTTP_ORIGIN']);
        header('Access-Control-Allow-Methods: GET, PUT, POST, DELETE, OPTIONS');
        header('Access-Control-Max-Age: 1000');
        header('Access-Control-Allow-Headers: Content-Type, Authorization, X-Requested-With');
        break;
    } 
    ```

    这允许您的脚本进行跨域 POST、GET 和 OPTIONS。当您继续阅读时，这将变得清晰......

2.  从 JS 设置跨域 POST（jQuery 示例）：

    ```
    $.ajax({
        type: 'POST',
        url: 'https://to.com/postHere.php',
        crossDomain: true,
        data: '{"some":"json"}',
        dataType: 'json',
        success: function(responseData, textStatus, jqXHR) {
            var value = responseData.someKey;
        },
        error: function (responseData, textStatus, errorThrown) {
            alert('POST failed.');
        }
    }); 
    ```

当您在步骤 2 中执行 POST 时，您的浏览器将向服务器发送一个“OPTIONS”方法。这是浏览器的“嗅探”，以查看服务器是否适合您向其发布。如果请求来自“ [http://from.com](http://from.com) ”或“ [https://from.com](https://from.com) ”，服务器会以“Access-Control-Allow-Origin”响应，告诉浏览器可以 POST|GET|ORIGIN。由于服务器没有问题，浏览器将发出第二个请求（这次是 POST）。让您的客户端设置它发送的内容类型是一种很好的做法——因此您也需要允许这样做。

MDN 有一篇关于[HTTP 访问控制](https://developer.mozilla.org/en/http_access_control)的精彩文章，详细介绍了整个流程的工作原理。根据他们的文档，它应该“在支持跨站点 XMLHttpRequest 的浏览器中工作”。然而，这有点误导，因为我*认为*只有现代浏览器允许跨域 POST。我只验证了这适用于 safari、chrome、FF 3.6。

如果您这样做，请记住以下几点：

1.  您的服务器每次操作必须处理 2 个请求
2.  您将不得不考虑安全隐患。在执行“Access-Control-Allow-Origin: *”之类的操作之前要小心
3.  这不适用于移动浏览器。根据我的经验，他们根本不允许跨域 POST。我测试过安卓、iPad、iPhone
4.  FF < 3.6 中有一个相当大的错误，如果服务器返回非 400 响应代码并且有响应正文（例如验证错误），则 FF 3.6 不会获得响应正文。这是一个巨大的痛苦，因为您不能使用良好的 REST 实践。[请参阅此处](http://bugs.jquery.com/ticket/7868#comment:11)的错误（它在 jQuery 下提交，但我猜它是一个 FF 错误 - 似乎已在 FF4 中修复）。
5.  始终返回上面的标头，而不仅仅是 OPTION 请求。FF 在 POST 的响应中需要它。

* * *

## 回答 #2

> 赞同：124
> 
> 时间：2011-05-29T18:50:30.857

如果您控制远程服务器，[您可能应该使用 CORS，如本答案中所述](https://stackoverflow.com/a/7605119/)；它在 IE8 及更高版本以及所有最新版本的 FF、GC 和 Safari 中都受支持。（但在 IE8 和 9 中，CORS 不允许您在请求中发送 cookie。）

因此，如果您*不*控制远程服务器，或者如果您必须支持 IE7，或者如果您需要 cookie 而您必须支持 IE8/9，您可能需要使用 iframe 技术。

1.  创建一个具有唯一名称的 iframe。（iframe 为整个浏览器使用全局命名空间，因此请选择其他网站不会使用的名称。）
2.  构造一个带有隐藏输入的表单，以 iframe 为目标。
3.  提交表格。

这是示例代码；我在IE6、IE7、IE8、IE9、FF4、GC11、S5上测试过。

```
function crossDomainPost() {
  // Add the iframe with a unique name
  var iframe = document.createElement("iframe");
  var uniqueString = "CHANGE_THIS_TO_SOME_UNIQUE_STRING";
  document.body.appendChild(iframe);
  iframe.style.display = "none";
  iframe.contentWindow.name = uniqueString;

  // construct a form with hidden inputs, targeting the iframe
  var form = document.createElement("form");
  form.target = uniqueString;
  form.action = "http://INSERT_YOUR_URL_HERE";
  form.method = "POST";

  // repeat for each parameter
  var input = document.createElement("input");
  input.type = "hidden";
  input.name = "INSERT_YOUR_PARAMETER_NAME_HERE";
  input.value = "INSERT_YOUR_PARAMETER_VALUE_HERE";
  form.appendChild(input);

  document.body.appendChild(form);
  form.submit();
} 
```

谨防！您将无法直接读取 POST 的响应，因为 iframe 存在于单独的域中。不允许来自不同域的帧相互通信；这是[同源策略](http://en.wikipedia.org/wiki/Same-origin_policy)。

如果您控制远程服务器但不能使用 CORS（例如，因为您在 IE8/IE9 上并且需要使用 cookie），则有一些方法可以解决同源策略，例如使用[`window.postMessage`](https://developer.mozilla.org/en/DOM/window.postMessage)和/或允许您在旧版浏览器中发送跨域跨帧消息的众多库之一：

*   [舷窗](https://github.com/ternarylabs/porthole/)
*   [XSS接口](http://code.google.com/p/xssinterface/)
*   [EasyXDM](http://easyxdm.net/)
*   [jQuery PostMessage 插件](http://benalman.com/projects/jquery-postmessage-plugin/)

如果您不控制远程服务器，则无法读取 POST 期间的响应。否则会导致安全问题。

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2008-11-18T13:49:36.293

1.  创建一个 iFrame，
2.  在其中放置一个带有隐藏输入的表单，
3.  将表单的操作设置为 URL，
4.  将 iframe 添加到文档
5.  提交表格

伪代码

```
 var ifr = document.createElement('iframe');
 var frm = document.createElement('form');
 frm.setAttribute("action", "yoururl");
 frm.setAttribute("method", "post");

 // create hidden inputs, add them
 // not shown, but similar (create, setAttribute, appendChild)

 ifr.appendChild(frm);
 document.body.appendChild(ifr);
 frm.submit(); 
```

您可能想要设置 iframe 的样式，使其隐藏并绝对定位。不确定浏览器是否允许跨站点发布，但如果是这样，这就是如何做到的。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2014-10-03T17:01:45.480

把事情简单化：

1.  ***跨域 POST：***
    使用`crossDomain: true,`

2.  ***不应该刷新页面：***
    不，它不会刷新页面，因为当服务器发回响应时将调用`success`或`error`

* * *

### 示例脚本：

```
$.ajax({
        type: "POST",
        url: "http://www.yoururl.com/",
        crossDomain: true,
        data: 'param1=value1&param2=value2',
        success: function (data) {
            // do something with server response data
        },
        error: function (err) {
            // handle your error logic here
        }
    }); 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2011-01-22T00:40:05.317

如果您有权访问所有涉及的服务器，请将以下内容放在其他域中请求的页面的回复标题中：

PHP：

```
header('Access-Control-Allow-Origin: *'); 
```

例如，在 Drupal 的 xmlrpc.php 代码中，您可以这样做：

```
function xmlrpc_server_output($xml) {
    $xml = '<?xml version="1.0"?>'."\n". $xml;
    header('Connection: close');
    header('Content-Length: '. strlen($xml));
    header('Access-Control-Allow-Origin: *');
    header('Content-Type: application/x-www-form-urlencoded');
    header('Date: '. date('r'));
    // $xml = str_replace("\n", " ", $xml); 

    echo $xml;
    exit;
} 
```

这可能会造成安全问题，您应该确保采取适当的措施来验证请求。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2010-02-24T22:03:35.440

检查[http://taiyolab.com/mbtweet/scripts/twitterapi_call.js](http://taiyolab.com/mbtweet/scripts/twitterapi_call.js)`post_method`中的函数- 上面描述的 iframe 方法的一个很好的例子。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-03-09T15:13:12.710

1.  创建两个隐藏的 iframe（在 css 样式中添加“display: none;”）。使您的第二个 iframe 指向您自己域上的某些内容。

2.  创建一个隐藏表单，使用 target = 你的第一个 iframe 将其方法设置为“post”，并可选择将 enctype 设置为“multipart/form-data”（我想你想做 POST，因为你想发送像图片这样的多部分数据?)

3.  准备好后，将表单 submit() 设置为 POST。

4.  如果您可以让其他域返回将与 iframe 进行跨域通信的 javascript ( [http://softwareas.com/cross-domain-communication-with-iframes](http://softwareas.com/cross-domain-communication-with-iframes) )，那么您很幸运，您可以捕获响应也是。

当然，如果你想使用你的服务器作为代理，你可以避免这一切。只需将表单提交到您自己的服务器，该服务器会将请求代理到其他服务器（假设其他服务器未设置为通知 IP 差异），获取响应并返回您喜欢的任何内容。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2012-01-25T17:13:33.303

One more important thing to note!!! In [example](https://stackoverflow.com/a/7605119/411671) above it's described how to use

```
$.ajax({
    type     : 'POST',
    dataType : 'json', 
    url      : 'another-remote-server',
    ...
}); 
```

JQuery 1.6 and lower has a bug with cross-domain XHR. According to Firebug no requests except OPTIONS were sent. No POST. At all.

Spent 5 hours testing/tuning my code. Adding a lot of headers on the remote server (script). Without any effect. But later, I've updated JQuery lib to 1.6.4, and everything works like a charm.

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-05-06T17:32:46.333

如果您想在 ASP.net MVC 环境中使用 JQuery AJAX 执行此操作，请按照以下步骤操作：（这是[此](https://stackoverflow.com/questions/9010457/cross-domain-posts-to-asp-net-mvc-app)线程提供的解决方案的摘要）

假设“caller.com”（可以是任何网站）需要发布到“server.com”（一个 ASP.net MVC 应用程序）

1.  在“server.com”应用程序的 Web.config 中添加以下部分：

    ```
     <httpProtocol>
          <customHeaders>
              <add name="Access-Control-Allow-Origin" value="*" />
              <add name="Access-Control-Allow-Headers" value="Content-Type" />
              <add name="Access-Control-Allow-Methods" value="POST, GET, OPTIONS" />
          </customHeaders>
      </httpProtocol> 
    ```

2.  在“server.com”上，我们将在我们将发布到的控制器（称为“Home”）上执行以下操作：

    ```
    [HttpPost]
    public JsonResult Save()
    {
        //Handle the post data...

        return Json(
            new
            {
                IsSuccess = true
            });
    } 
    ```

3.  然后从“caller.com”，将数据从表单（html id 为“formId”）发布到“server.com”，如下所示：

    ```
    $.ajax({
            type: "POST",
            url: "http://www.server.com/home/save",
            dataType: 'json',
            crossDomain: true,
            data: $(formId).serialize(),
            success: function (jsonResult) {
               //do what ever with the reply
            },
            error: function (jqXHR, textStatus) {
                //handle error
            }
        }); 
    ```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-06-28T06:23:14.157

还有另一种方法（使用 html5 功能）。您可以使用托管在该其他域上的代理 iframe，使用 postMessage 向该 iframe 发送消息，然后该 iframe 可以执行 POST 请求（在同一域上）并将 postMessage 返回到父窗口。

sender.com 上的父母

```
var win = $('iframe')[0].contentWindow

function get(event) {
    if (event.origin === "http://reciver.com") {
        // event.data is response from POST
    }
}

if (window.addEventListener){
    addEventListener("message", get, false)
} else {
    attachEvent("onmessage", get)
}
win.postMessage(JSON.stringify({url: "URL", data: {}}),"http://reciver.com"); 
```

reciver.com 上的 iframe

```
function listener(event) {
    if (event.origin === "http://sender.com") {
        var data = JSON.parse(event.data);
        $.post(data.url, data.data, function(reponse) {
            window.parent.postMessage(reponse, "*");
        });
    }
}
// don't know if we can use jQuery here
if (window.addEventListener){
    addEventListener("message", listener, false)
} else {
    attachEvent("onmessage", listener)
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-08-19T18:39:46.033

高级...。您需要在服务器上设置 cname，以便 other-serve.your-server.com 指向 other-server.com。

您的页面动态创建一个不可见的 iframe，它充当您到 other-server.com 的传输。然后，您必须通过 JS 从您的页面与 other-server.com 进行通信，并通过回调将数据返回到您的页面。

可能，但需要 your-server.com 和 other-server.com 的协调

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-10-04T09:49:18.667

我认为最好的方法是使用 XMLHttpRequest（例如 jQuery 中的 $.ajax()、$.post()）和跨域资源共享 polyfill 之一[https://github.com/Modernizr/Modernizr/wiki/HTML5-跨浏览器-Polyfills#wiki-CORS](https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills#wiki-CORS)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-09-23T17:58:06.353

这是一个老问题，但一些新技术可能会帮助某人。

如果您对另一台服务器具有管理权限，那么您可以使用开源 Forge 项目来完成您的跨域 POST。Forge 提供了一个跨域 JavaScript XmlHttpRequest 包装器，它利用了 Flash 的原始套接字 API。POST 甚至可以通过 TLS 完成。

您需要对要发布到的服务器的管理访问权限的原因是您必须提供允许从您的域进行访问的跨域策略。

[http://github.com/digitalbazaar/forge](http://github.com/digitalbazaar/forge)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-03-06T19:15:41.740

我知道这是一个老问题，但我想分享我的方法。我使用 cURL 作为代理，非常简单且一致。创建一个名为 submit.php 的 php 页面，并添加以下代码：

```
<?

function post($url, $data) {
$header = array("User-Agent: " . $_SERVER["HTTP_USER_AGENT"], "Content-Type: application/x-www-form-urlencoded");
$curl = curl_init();
curl_setopt($curl, CURLOPT_URL, $url);
curl_setopt($curl, CURLOPT_HTTPHEADER, $header);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($curl, CURLOPT_POST, 1);
curl_setopt($curl, CURLOPT_POSTFIELDS, $data);
$response = curl_exec($curl);
curl_close($curl);
return $response;
}

$url = "your cross domain request here";
$data = $_SERVER["QUERY_STRING"];
echo(post($url, $data)); 
```

然后，在你的 js 中（这里是 jQuery）：

```
$.ajax({
type: 'POST',
url: 'submit.php',
crossDomain: true,
data: '{"some":"json"}',
dataType: 'json',
success: function(responseData, textStatus, jqXHR) {
    var value = responseData.someKey;
},
error: function (responseData, textStatus, errorThrown) {
    alert('POST failed.');
}
}); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-08-24T15:59:49.930

应该可以使用 YQL 自定义表 + JS XHR，看看：http: [//developer.yahoo.com/yql/guide/index.html](http://developer.yahoo.com/yql/guide/index.html)

我用它来做一些客户端（js）html抓取，工作正常（我有一个完整的音频播放器，可以搜索互联网/播放列表/歌词/last fm信息，所有客户端js + YQL）

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-09-11T21:27:32.640

如果您可以访问跨域服务器并且不想在服务器端进行任何代码更改，您可以使用一个名为“xdomain”的库。

这个怎么运作：

步骤1：服务器1：包含xdomain库并将跨域配置为slave：

```
<script src="js/xdomain.min.js" slave="https://crossdomain_server/proxy.html"></script> 
```

第 2 步：在跨域服务器上，创建一个 proxy.html 文件并将服务器 1 包含为主服务器：

```
proxy.html:
<!DOCTYPE HTML>
<script src="js/xdomain.min.js"></script>
<script>
  xdomain.masters({
    "https://server1" : '*'
  });
</script> 
```

第 3 步：

现在，您可以从 server1 作为端点对 proxy.html 进行 AJAX 调用。这是绕过 CORS 请求。该库在内部使用 iframe 解决方案，该解决方案可与凭据和所有可能的方法一起使用：GET、POST 等。

查询ajax代码：

```
$.ajax({
        url: 'https://crossdomain_server/proxy.html',
        type: "POST",
        data: JSON.stringify(_data),
        dataType: "json",
        contentType: "application/json; charset=utf-8"
    })
    .done(_success)
    .fail(_failed) 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-01-19T14:44:34.993

CORS 适合您。CORS是“Cross Origin Resource Sharing”，是一种跨域请求的发送方式。现在XMLHttpRequest2和Fetch API都支持CORS，可以发送POST和GET请求

但它有其局限性。服务器需要具体声明**Access-Control-Allow-Origin**，并且不能设置为'*'。

并且如果您希望任何来源都可以向您发送请求，则需要 JSONP（还需要设置**Access-Control-Allow-Origin**，但可以是 '*'）

对于很多请求方式，如果你不知道如何选择，我认为你需要一个功能齐全的组件来做到这一点。让我介绍一个简单的组件**[https://github.com/Joker-Jelly/catta](https://github.com/Joker-Jelly/catta)**

* * *

如果您使用的是现代浏览器（> IE9、Chrome、FF、Edge等），非常推荐您使用简单但美观的组件**[https://github.com/Joker-Jelly/catta](https://github.com/Joker-Jelly/catta)**。它没有依赖，Less大于 3KB，它支持 Fetch、AJAX 和 JSONP，具有相同的致命示例语法和选项。

```
catta('./data/simple.json').then(function (res) {
  console.log(res);
}); 
```

它还支持一直导入到您的项目中，例如 ES6 模块、CommonJS 甚至`<script>`是 HTML。

# javascript - 如何使用 jQuery 选择文本节点？

> ID：298750
> 
> 赞同：399
> 
> 时间：2008-11-18T13:45:09.390
> 
> 标签：javascript, jquery, dom

我想获取一个元素的所有后代文本节点，作为一个 jQuery 集合。最好的方法是什么？

* * *

## 回答 #1

> 赞同：268
> 
> 时间：2010-12-09T15:13:26.867

jQuery 没有为此提供方便的功能。您需要 combine `contents()`，这将只给出子节点，但包括文本节点， with `find()`，它给出所有后代元素但没有文本节点。这是我想出的：

```
var getTextNodesIn = function(el) {
    return $(el).find(":not(iframe)").addBack().contents().filter(function() {
        return this.nodeType == 3;
    });
};

getTextNodesIn(el); 
```

**注意：如果您使用的是 jQuery 1.7 或更早版本，上面的代码将不起作用。要解决此问题，请替换[`addBack()`](http://api.jquery.com/addBack/)为[`andSelf()`](http://api.jquery.com/andSelf/). 从 1.8 开始`andSelf()`不推荐使用。`addBack()`**

与纯 DOM 方法相比，这有点低效，并且必须包含一个[丑陋的解决方法，用于 jQuery 重载其`contents()`函数](http://bugs.jquery.com/ticket/11275)（感谢注释中的@rabidsnail 指出），所以这里是使用简单递归函数的非 jQuery 解决方案。该`includeWhitespaceNodes`参数控制空白文本节点是否包含在输出中（在 jQuery 中它们会被自动过滤掉）。

更新：修复了 includeWhitespaceNodes 错误时的错误。

```
function getTextNodesIn(node, includeWhitespaceNodes) {
    var textNodes = [], nonWhitespaceMatcher = /\S/;

    function getTextNodes(node) {
        if (node.nodeType == 3) {
            if (includeWhitespaceNodes || nonWhitespaceMatcher.test(node.nodeValue)) {
                textNodes.push(node);
            }
        } else {
            for (var i = 0, len = node.childNodes.length; i < len; ++i) {
                getTextNodes(node.childNodes[i]);
            }
        }
    }

    getTextNodes(node);
    return textNodes;
}

getTextNodesIn(el); 
```

* * *

## 回答 #2

> 赞同：216
> 
> 时间：2008-11-18T13:47:45.830

Jauco 在评论中发布了一个很好的解决方案，所以我在这里复制它：

```
$(elem)
  .contents()
  .filter(function() {
    return this.nodeType === 3; //Node.TEXT_NODE
  }); 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2011-10-19T16:07:40.993

```
$('body').find('*').contents().filter(function () { return this.nodeType === 3; }); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2014-01-19T10:29:22.547

[**`jQuery.contents()`**](http://api.jquery.com/contents/)可用于[**`jQuery.filter`**](http://api.jquery.com/filter/)查找所有子文本节点。稍加改动，您也可以找到孙子文本节点。不需要递归：

```
$(function() {
  var $textNodes = $("#test, #test *").contents().filter(function() {
    return this.nodeType === Node.TEXT_NODE;
  });
  /*
   * for testing
   */
  $textNodes.each(function() {
    console.log(this);
  });
});
```

```
div { margin-left: 1em; }
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<div id="test">
  child text 1<br>
  child text 2
  <div>
    grandchild text 1
    <div>grand-grandchild text 1</div>
    grandchild text 2
  </div>
  child text 3<br>
  child text 4
</div>
```

[**jsFiddle**](http://jsfiddle.net/salman/GPsR2/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-10-13T18:03:57.293

我得到了很多带有接受的过滤器功能的空文本节点。如果您只对选择包含非空格的文本节点感兴趣，请尝试向`nodeValue`您的函数添加条件`filter`，例如简单的`$.trim(this.nodevalue) !== ''`：

```
$('element')
    .contents()
    .filter(function(){
        return this.nodeType === 3 && $.trim(this.nodeValue) !== '';
    }); 
```

[http://jsfiddle.net/ptp6m97v/](http://jsfiddle.net/ptp6m97v/)

或者为了避免内容看起来像空格但不是的奇怪情况（例如软连`&shy;`字符、换行符`\n`、制表符等），您可以尝试使用正则表达式。例如，`\S`将匹配任何非空白字符：

```
$('element')
        .contents()
        .filter(function(){
            return this.nodeType === 3 && /\S/.test(this.nodeValue);
        }); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-04-20T14:52:19.700

**如果您可以假设所有子节点都是元素节点或文本节点，那么这是一种解决方案。**

要将所有子文本节点作为 jquery 集合获取：

```
$('selector').clone().children().remove().end().contents(); 
```

要获取删除了非文本子元素的原始元素的副本：

```
$('selector').clone().children().remove().end(); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-02-16T05:16:35.703

由于某种原因`contents()`对我不起作用，所以如果它对您不起作用，这是我制作的解决方案，我创建`jQuery.fn.descendants`了包含或不包含文本节点的选项

**用法**

* * *

获取所有后代，包括文本节点和元素节点

```
jQuery('body').descendants('all'); 
```

* * *

获取仅返回文本节点的所有后代

```
jQuery('body').descendants(true); 
```

* * *

获取仅返回元素节点的所有后代

```
jQuery('body').descendants(); 
```

* * *

**咖啡脚本原件**：

```
jQuery.fn.descendants = ( textNodes ) ->

    # if textNodes is 'all' then textNodes and elementNodes are allowed
    # if textNodes if true then only textNodes will be returned
    # if textNodes is not provided as an argument then only element nodes
    # will be returned

    allowedTypes = if textNodes is 'all' then [1,3] else if textNodes then [3] else [1]

    # nodes we find
    nodes = []

    dig = (node) ->

        # loop through children
        for child in node.childNodes

            # push child to collection if has allowed type
            nodes.push(child) if child.nodeType in allowedTypes

            # dig through child if has children
            dig child if child.childNodes.length

    # loop and dig through nodes in the current
    # jQuery object
    dig node for node in this

    # wrap with jQuery
    return jQuery(nodes) 
```

**插入 Javascript 版本**

```
var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1}; /* indexOf polyfill ends here*/ jQuery.fn.descendants=function(e){var t,n,r,i,s,o;t=e==="all"?[1,3]:e?[3]:[1];i=[];n=function(e){var r,s,o,u,a,f;u=e.childNodes;f=[];for(s=0,o=u.length;s<o;s++){r=u[s];if(a=r.nodeType,__indexOf.call(t,a)>=0){i.push(r)}if(r.childNodes.length){f.push(n(r))}else{f.push(void 0)}}return f};for(s=0,o=this.length;s<o;s++){r=this[s];n(r)}return jQuery(i)} 
```

> 未缩小的 Javascript 版本：[http ://pastebin.com/cX3jMfuD](http://pastebin.com/cX3jMfuD)

**这是跨浏览器，代码中包含一个小的`Array.indexOf`polyfill。**

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-06-19T11:24:08.290

也可以这样做：

```
var textContents = $(document.getElementById("ElementId").childNodes).filter(function(){
        return this.nodeType == 3;
}); 
```

上面的代码从给定元素的直接子子节点中过滤 textNodes。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-06-22T18:36:14.277

如果你想剥离所有标签，那么试试这个

**功能：**

```
String.prototype.stripTags=function(){
var rtag=/<.*?[^>]>/g;
return this.replace(rtag,'');
} 
```

**用法：**

```
var newText=$('selector').html().stripTags(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-07-30T17:47:35.493

我遇到了同样的问题并通过以下方式解决了它：

代码：

```
$.fn.nextNode = function(){
  var contents = $(this).parent().contents();
  return contents.get(contents.index(this)+1);
} 
```

用法：

```
$('#my_id').nextNode(); 
```

is like`next()`还返回文本节点。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-08-23T14:41:21.747

对我来说，普通的旧`.contents()`版本似乎可以返回文本节点，只需要小心你的选择器，这样你就知道它们将是文本节点。

例如，这将我表中 TD 的所有文本内容都用`pre`标签包裹起来，没有任何问题。

```
jQuery("#resultTable td").content().wrap("<pre/>") 
```

# javascript - 正则表达式比较两个数字

> ID：298753
> 
> 赞同：1
> 
> 时间：2008-11-18T13:45:36.830
> 
> 标签：javascript, regex, numbers, compare

我可以以某种方式比较正则表达式中的两个数字吗？我想要对 10-12 正确但对 12-10 不正确的正则表达式。我的意思是 10 必须小于 12。我想用 Javascript 来做。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-18T13:49:09.430

如果输入始终是 XY 的形式，那么为什么不使用 split() 函数以 '-' 作为分隔符，然后将两部分与 > 进行比较

您无法使用 RegExps 比较数值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T13:48:13.427

我不会为此使用正则表达式。我会在运算符上拆分字符串，然后根据我找到的运算符比较两个结果数字（我假设`10+12`并且`12+10`都是合法的）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T14:10:46.343

这里的问题是您试图将两个问题合二为一。

正则表达式擅长语法（即识别数字），但不擅长语义（即识别含义）。所以正则表达式肯定会帮助你识别`x-y`，但是你要求太多，然后继续推理和之间的`x`关系`y`。

正如经常引用的那样；

> 有些人在遇到问题时会想“我知道，我会使用正则表达式”。现在他们有两个问题。( [JWZ](http://www.jwz.org) )

或者更确切地说，你现在有三个。

# linux - 如何确保应用程序继续在 Linux 上运行

> ID：298760
> 
> 赞同：90
> 
> 时间：2008-11-18T13:48:42.893
> 
> 标签：linux

我试图确保脚本在开发服务器上保持运行。它整理统计数据并提供 Web 服务，因此它应该会持续存在，但一天有几次，它会因未知原因而死掉。当我们注意到我们只是再次启动它时，它是一个痛苦的后方，一些用户没有权限（或专有技术）来启动它。

我的程序员想花几个小时来找出问题的根源，但我忙碌的人认为必须有一种简单的方法来检测应用程序是否没有运行，然后重新启动它。

我知道我*可以*通过 grep cron-script ps：

```
ps -A | grep appname 
```

但是再一次，我又浪费了一个小时来做​​一些必须已经存在的事情......难道没有一个预制的应用程序可以传递一个可执行文件（可选地带有参数）并且可以让一个进程无限期地运行吗？

如果有什么不同，那就是 Ubuntu。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-05-26T14:57:41.253

我使用了一个带有 cron 的简单脚本来确保程序正在运行。如果不是，那么它将启动它。这可能不是您正在寻找的完美解决方案，但它很简单并且效果很好。

```
#!/bin/bash
#make-run.sh
#make sure a process is always running.

export DISPLAY=:0 #needed if you are running a simple gui app.

process=YourProcessName
makerun="/usr/bin/program"

if ps ax | grep -v grep | grep $process > /dev/null
then
    exit
else
    $makerun &
fi

exit 
```

然后每分钟或每 5 分钟添加一个 cron 作业。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-11-18T13:51:53.683

[Monit](http://mmonit.com/monit/)非常适合这个:)

您可以编写简单的配置文件，告诉monit 监视例如TCP 端口、PID 文件等

当监视的进程不可用/使用太多内存/与 CPU 挂钩的时间过长/等时，monit 将运行您指定的命令。它还会弹出一封电子邮件警报，告诉您发生了什么以及它是否可以做任何事情。

我们使用它来保持我们网站的负载运行，同时在出现问题时向我们提供早期警告。

-- 您忠实的员工，Monit

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2008-11-18T14:49:41.273

注意：Upstart 处于维护模式，被使用 systemd 的 Ubuntu[放弃。](https://www.linuxjournal.com/content/ubuntu-ditches-upstart)有关如何编写服务定义的详细信息，应查看 systemd[手册。](https://www.freedesktop.org/software/systemd/man/systemd.service.html)

由于您使用的是 Ubuntu，您可能对[Upstart](http://upstart.ubuntu.com/)感兴趣，它已经取代了传统的[sysV init](http://en.wikipedia.org/wiki/Init)。一个关键功能是，如果服务意外死亡，它可以重新启动服务。Fedora 已成为新贵，而 Debian 处于实验阶段，因此可能值得研究。

不过，对于这种情况，这可能有点过头了，因为[cron](http://en.wikipedia.org/wiki/Cron)脚本需要 2 分钟才能实现。

```
#!/bin/bash
if [[ ! `pidof -s yourapp` ]]; then
    invoke-rc.d yourapp start
fi 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2015-12-17T11:43:59.643

如果您使用基于 systemd 的发行版，例如 Fedora 和最近的 Ubuntu 版本，您可以使用 systemd 的[“重新启动”](http://www.freedesktop.org/software/systemd/man/systemd.service.html#Restart=)服务功能。如果它需要由特定用户管理并作为特定用户运行，它可以设置为系统服务或用户服务，这在 OP 的特定情况下更可能是这种情况。

重新启动选项[采用](http://www.freedesktop.org/software/systemd/man/systemd.service.html#Restart=) `no`、`on-success`、`on-failure`、`on-abnormal`、`on-watchdog`、`on-abort`或之一`always`。

要以用户身份运行它，只需将如下文件放入`~/.config/systemd/user/something.service`：

```
[Unit]
Description=Something

[Service]
ExecStart=/path/to/something
Restart=on-failure

[Install]
WantedBy=graphical.target 
```

然后：

```
systemctl --user daemon-reload
systemctl --user [status|start|stop|restart] something 
```

无需 root 权限/修改系统文件，无需 cron 作业，无需安装，非常灵活（请参阅文档中的所有相关服务选项）。

有关使用每用户 systemd 实例的更多信息，另请参阅[https://wiki.archlinux.org/index.php/Systemd/User](https://wiki.archlinux.org/index.php/Systemd/User)。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-12-30T11:53:52.120

我从 cron 中使用过“killall -0 programname || /etc/init.d/programname start”。如果进程不存在， kill 将出错。如果它确实存在，它将向进程传递一个空信号（内核将忽略它并且不会打扰传递。）

这个成语很容易记住（恕我直言）。通常我会在我仍在尝试发现服务本身失败的原因时使用它。恕我直言，一个程序不应该只是意外消失:)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-18T13:54:47.093

将你的运行置于一个循环中 - 所以当它退出时，它会再次运行...... while(true){ run my app.. }

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-07-11T10:18:40.537

由于某种原因，我无法让**Chris Wendt**解决方案工作，而且很难调试。这几乎相同，但更容易调试，从模式匹配中排除 bash。要调试只需运行：`bash ./root/makerun-mysql.sh`. `process`在以下使用 mysql-server 的示例中，只需`makerun`为您的进程替换变量的值。

*   创建一个像这样 ( `nano /root/makerun-mysql.sh`) 的 BASH 脚本：

```
#!/bin/bash
process="mysql"
makerun="/etc/init.d/mysql restart"
if ps ax | grep -v grep | grep -v bash | grep --quiet $process
then
    printf "Process '%s' is running.\n" "$process"
    exit
else
    printf "Starting process '%s' with command '%s'.\n" "$process" "$makerun"
    $makerun
fi
exit 
```

*   通过添加适当的文件权限确保它是可执行的（即`chmod 700 /root/makerun-mysql.sh`）

*   然后将其添加到您的 crontab ( `crontab -e`)：

```
# Keep processes running every 5 minutes
*/5 * * * * bash /root/makerun-mysql.sh 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-06-11T17:00:21.893

`supervise`工具 from将`daemontools`是我的偏好——但 Dan J Bernstein 所写的一切都是我的偏好 :)

[http://cr.yp.to/daemontools/supervise.html](http://cr.yp.to/daemontools/supervise.html)

您必须为您的应用程序启动脚本创建一个特定的目录结构，但使用起来非常简单。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-18T13:52:40.857

这是 DMD（守护进程监视守护进程）的工作。周围有几个；但我通常只是编写一个脚本来检查守护进程是否正在运行，如果没有运行，则将其放入 cron 中以每分钟运行一次。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-18T13:53:50.667

首先，你如何启动这个应用程序？它会将自己分叉到后台吗？它是从 nohup .. & 等开始的吗？如果是后者，检查它为什么在 nohup.out 中死亡，如果是第一个，则构建日志记录。

至于您的主要问题：您可以 cron 它，或在后台运行另一个进程（不是最佳选择）并在 bashscript 中使用 pidof，这很容易：

```
if [ `pidof -s app` -eq 0 ]; then
    nohup app &
fi 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-18T13:55:13.583

您可以使它成为从 inittab 启动的服务（尽管一些 Linux 已经转移到 /etc/event.d 中的更新内容）。这些内置系统可确保您的服务继续运行，而无需编写自己的脚本或安装新的东西。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-18T14:41:01.667

查看[“Unix Hater 手册”](http://web.mit.edu/~simsong/www/ugh.pdf)（该书的几个 PDF 来源之一`nanny`）第 9 章（p197 或附近）中引用的 ' ' 。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-12-14T00:42:31.867

一个很好，简单的方法如下：

1.  如果服务器无法侦听它期望的端口，则将其写入死机
2.  设置一个 cronjob 以尝试每分钟启动一次服务器

如果它没有运行，它将启动，如果它正在运行，则不会。无论如何，您的服务器将始终处于运行状态。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-11-25T13:57:58.020

我认为更好的解决方案是您也测试该功能。例如，如果您必须测试 apache，仅测试系统上是否存在“apache”进程是不够的。

如果您想测试 apache OK 是否正常，请尝试下载一个简单的网页，并测试您的唯一代码是否在输出中。

如果没有，请使用 -9 杀死 apache，然后重新启动。并将邮件发送到根目录（这是一个转发到公司/服务器/项目根目录的邮件地址）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-07-01T09:44:20.487

它甚至更简单：

```
#!/bin/bash

export DISPLAY=:0

process=processname
makerun="/usr/bin/processname"

if ! pgrep $process > /dev/null
then
    $makerun &
fi 
```

您必须记住，以确保 processname 是唯一的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-11-11T23:01:52.120

可以像这样安装详细监控 cronjob：

> crontab -l > crontab;echo -e '* * * * * export DISPLAY=":0.0" && for app in "eiskaltdcpp-qt" "transmission-gtk" "nicotine";do ps aux|grep -v grep|grep "$app";done||"$app" &' >> crontab;crontab crontab

缺点是您输入的应用程序名称必须在`ps aux|grep "appname"`输出中找到，同时能够使用该名称启动：`"appname" &`

# javascript - Django 模板变量和 Javascript

> ID：298772
> 
> 赞同：268
> 
> 时间：2008-11-18T13:52:31.717
> 
> 标签：javascript, python, django, google-app-engine, django-templates

当我使用 Django 模板渲染器渲染页面时，我可以传入一个包含各种值的字典变量，以便在页面中使用`{{ myVar }}`.

有没有办法在 Javascript 中访问相同的变量（也许使用 DOM，我不知道 Django 如何使变量可访问）？我希望能够根据传入的变量中包含的值使用 AJAX 查找来查找详细信息。

* * *

## 回答 #1

> 赞同：365
> 
> 时间：2008-11-18T14:00:58.737

被`{{variable}}`直接替换到 HTML 中。做一个视图源；它不是“变量”或类似的东西。它只是呈现的文本。

话虽如此，您可以将这种替换放入您的 JavaScript 中。

```
<script type="text/javascript"> 
   var a = "{{someDjangoVariable}}";
</script> 
```

这为您提供了“动态”javascript。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2014-08-28T00:14:04.210

**小心**检查票[#17419](https://code.djangoproject.com/ticket/17419)以讨论在 Django 核心中添加类似标签以及使用此模板标签和用户生成的数据可能引入的 XSS 漏洞。[amacneil 的评论](https://code.djangoproject.com/ticket/17419#comment:27)讨论了票中提出的大部分问题。

* * *

我认为最灵活、最方便的方法是为要在 JS 代码中使用的变量定义模板过滤器。这使您可以确保您的数据被正确转义，并且您可以将其用于复杂的数据结构，例如`dict`和`list`。这就是为什么我写这个答案，尽管有很多赞成的答案。

这是模板过滤器的示例：

```
// myapp/templatetags/js.py

from django.utils.safestring import mark_safe
from django.template import Library

import json

register = Library()

@register.filter(is_safe=True)
def js(obj):
    return mark_safe(json.dumps(obj)) 
```

此模板过滤器将变量转换为 JSON 字符串。你可以像这样使用它：

```
// myapp/templates/example.html

{% load js %}

<script type="text/javascript">
    var someVar = {{ some_var | js }};
</script> 
```

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2011-12-13T01:15:07.260

对我有用的解决方案是使用模板中的隐藏输入字段

```
<input type="hidden" id="myVar" name="variable" value="{{ variable }}"> 
```

然后以这种方式在javascript中获取值，

```
var myVar = document.getElementById("myVar").value; 
```

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2019-01-19T19:53:55.890

从 Django 2.1 开始，专门为此用例引入了一个新的内置模板标签：`json_script`.

[https://docs.djangoproject.com/en/3.0/ref/templates/builtins/#json-script](https://docs.djangoproject.com/en/3.0/ref/templates/builtins/#json-script)

新标签将安全地序列化模板值并防止 XSS。

Django 文档摘录：

> 将 Python 对象安全地输出为 JSON，包装在标签中，可与 JavaScript 一起使用。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-03-13T12:31:04.067

这是我正在做的非常容易的事情：我为我的模板修改了我的 base.html 文件并将其放在底部：

```
{% if DJdata %}
    <script type="text/javascript">
        (function () {window.DJdata = {{DJdata|safe}};})();
    </script>
{% endif %} 
```

然后，当我想在 javascript 文件中使用变量时，我创建了一个 DJdata 字典，并通过 json 将其添加到上下文中：`context['DJdata'] = json.dumps(DJdata)`

希望能帮助到你！

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2017-03-07T19:25:23.320

对于以文本形式存储在 Django 字段中的 JavaScript 对象，它需要再次成为动态插入到页面脚本中的 JavaScript 对象，您需要同时使用`escapejs`和`JSON.parse()`：

```
var CropOpts = JSON.parse("{{ profile.last_crop_coords|escapejs }}"); 
```

Django`escapejs`正确处理引用，`JSON.parse()`并将字符串转换回 JS 对象。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2020-07-20T07:33:58.213

使用内置模板标签[json_script](https://docs.djangoproject.com/en/3.0/ref/templates/builtins/#json-script)从 Django 2.1+ 实现了一种非常简单的方法。一个简单的例子是：

在模板中声明变量：

`{{ variable|json_script:'name' }}`

`<script>`然后在您的Javascript中调用该变量：

`var js_variable = JSON.parse(document.getElementById('name').textContent);`

对于更复杂的变量，如“用户”，使用 Django 的内置序列化程序，您可能会收到“用户类型的对象不是 JSON 可序列化”之类的错误。在这种情况下，您可以使用 Django Rest Framework 来允许更复杂的变量。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-11-20T08:19:31.700

对于字典，最好先编码为 JSON。您可以使用 simplejson.dumps()，或者如果您想从 App Engine 中的数据模型进行转换，您可以使用 GQLEncoder 库中的 encode()。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2020-12-14T09:19:53.337

新[文档](https://docs.djangoproject.com/en/3.0/ref/templates/builtins/#json-script)说用于`{{ mydata|json_script:"mydata" }}`防止代码注入。

[这里](https://adamj.eu/tech/2020/02/18/safely-including-data-for-javascript-in-a-django-template/)给出了一个很好的例子：

```
{{ mydata|json_script:"mydata" }}
<script>
    const mydata = JSON.parse(document.getElementById('mydata').textContent);
</script> 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2015-10-07T17:03:39.777

我面临着类似的问题，S.Lott 建议的答案为我工作。

```
<script type="text/javascript"> 
   var a = "{{someDjangoVariable}}"
</script> 
```

但是，我想在这里指出**主要的实现限制**。如果您打算将您的 javascript 代码放在不同的文件中，并将该文件包含在您的模板中。这行不通。

这仅在您的主模板和 javascript 代码位于同一文件中时才有效。可能 django 团队可以解决这个限制。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2018-10-16T03:57:34.590

请注意，如果要将变量传递给外部 .js 脚本，则需要在脚本标记之前加上另一个声明全局变量的脚本标记。

```
<script type="text/javascript">
    var myVar = "{{ myVar }}"
</script>

<script type="text/javascript" src="{% static "scripts/my_script.js" %}"></script> 
```

`data`像往常一样在视图中定义`get_context_data`

```
def get_context_data(self, *args, **kwargs):
    context['myVar'] = True
    return context 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2018-11-09T23:08:31.817

我也一直在为此苦苦挣扎。从表面上看，上述解决方案似乎应该有效。但是，django 架构要求每个 html 文件都有自己的渲染变量（即`{{contact}}`渲染到`contact.html`，而`{{posts}}`转到 eg`index.html`等）。另一方面，`<script>`标签出现在`{%endblock%}`in `base.html`from which`contact.html`和`index.html`inherit 之后。这基本上意味着任何解决方案，包括

```
<script type="text/javascript">
    var myVar = "{{ myVar }}"
</script> 
```

必然会失败，因为变量和脚本不能共存于同一个文件中。

我最终想出并为我工作的简单解决方案是简单地用带有 id 的标签包装变量，然后在 js 文件中引用它，如下所示：

```
// index.html
<div id="myvar">{{ myVar }}</div> 
```

进而：

```
// somecode.js
var someVar = document.getElementById("myvar").innerHTML; 
```

并像往常一样包含在内`<script src="static/js/somecode.js"></script>`。`base.html`当然，这只是关于*获取*内容。关于安全性，只需遵循其他答案即可。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2020-04-16T17:51:05.423

我在 Django 2.1 中使用这种方式并为我工作，这种方式是安全的[（参考）](https://adamj.eu/tech/2020/02/18/safely-including-data-for-javascript-in-a-django-template/)：

Django方面：

```
def age(request):
    mydata = {'age':12}
    return render(request, 'test.html', context={"mydata_json": json.dumps(mydata)}) 
```

html端：

```
<script type='text/javascript'>
     const  mydata = {{ mydata_json|safe }};
console.log(mydata)
 </script> 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2020-07-17T12:25:33.623

我发现我们可以将 Django 变量传递给 javascript 函数，如下所示：-

```
<button type="button" onclick="myJavascriptFunction('{{ my_django_variable }}')"></button>
<script>
    myJavascriptFunction(djangoVariable){
       alert(djangoVariable);
    }
</script> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-08-12T18:58:39.780

您可以组装整个脚本，其中您的数组变量在字符串中声明，如下所示，

> 视图.py

```
 aaa = [41, 56, 25, 48, 72, 34, 12]
    prueba = "<script>var data2 =["
    for a in aaa:
        aa = str(a)
        prueba = prueba + "'" + aa + "',"
    prueba = prueba + "];</script>" 
```

这将生成一个字符串，如下所示

```
prueba = "<script>var data2 =['41','56','25','48','72','34','12'];</script>" 
```

获得此字符串后，您必须将其发送到模板

> 视图.py

```
return render(request, 'example.html', {"prueba": prueba}) 
```

在模板中，您收到它并以文学方式将其解释为 htm 代码，就在您需要它的 javascript 代码之前，例如

> 模板

```
{{ prueba|safe  }} 
```

下面是代码的其余部分，请记住，示例中使用的变量是 data2

```
<script>
 console.log(data2);
</script> 
```

这样你就可以保留数据的类型，在这种情况下是一种安排

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-03-29T17:21:57.260

在 Javascript 中有两件事对我有用：

```
'{{context_variable|escapejs }}' 
```

和其他：在views.py中

```
from json import dumps as jdumps

def func(request):
    context={'message': jdumps('hello there')}
    return render(request,'index.html',context) 
```

在html中：

```
{{ message|safe }} 
```

# asp.net-mvc - 当身份验证超时时，使ajax重定向主页以登录

> ID：298777
> 
> 赞同：3
> 
> 时间：2008-11-18T13:55:06.780
> 
> 标签：asp.net-mvc, ajax

我正在使用 ASP.Net MVC beta 1，并且正在使用带有标准身份验证控制器的 asp.net 成员资格提供程序来限制对我的站点的访问。

我正在使用 ajax 功能通过使用 jQuery $.get/$.ajax 或 Ajax.Actionlink MVC 帮助器将部分视图加载到 div 来提供值的编辑。这在大多数情况下都可以正常工作。

一旦登录超时并且您单击其中一个 ajax 编辑链接，我的问题就出现了 - ajax 调用返回登录页面，该页面被放入通常用于编辑表单的 div 中。

当身份验证超时并单击 ajax 链接时，我想找到一种将整个页面重定向到登录表单的方法。

我能想到的一种方法是在响应回调中查看从 ajax 调用返回的 html，并搜索“登录”文本或表单字段并从那里进行重定向 - 但这感觉不太干净 - 是否有更好的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T15:06:07.323

这可能会有所帮助：

[绕过表单身份验证自动重定向到登录，如何？](https://stackoverflow.com/questions/35322/bypass-forms-authentication-auto-redirect-to-login-how-to)

从上面的答案看来，表单身份验证没有拦截 http 403，因此您可以滚动自己的 ActionFilter，如果 Ajax 请求和授权失败，则返回 http 403 响应。

在客户端，您可以检查 403 的响应代码，并重定向到适当的登录 url。

可能还有其他方法可以做到这一点！

# python - 表单（或表单集？）在 Django 中处理多个表行

> ID：298779
> 
> 赞同：3
> 
> 时间：2008-11-18T13:55:17.280
> 
> 标签：python, django

我正在开发我的第一个 Django 应用程序。简而言之，它需要做的是显示一个电影片名列表，并允许用户给每部电影打分（满分 10 分）。我已经能够在模板中使用 {{ form }} 和 {{ formset }} 语法来生成一个表单，它可以让您一次评价一部电影，它对应于 MySQL 表中的一行，但是如何我生成了一个表单，它遍历数据库中的所有电影标题，并生成一个表单，让您一次对很多电影进行评分？

起初，我认为这就是表单集的用途，但如果您明白我的意思，我看不出有任何方法可以自动迭代数据库表的内容以生成要进入表单的项目。

目前，我的 views.py 有这个代码：

```
def survey(request):
        ScoreFormSet = formset_factory(ScoreForm)
        if request.method == 'POST':
                formset = ScoreFormSet(request.POST, request.FILES)
                if formset.is_valid():
                        return HttpResponseRedirect('/')
        else:
                formset = ScoreFormSet()
        return render_to_response('cf/survey.html', {
                'formset':formset,
        }) 
```

我的survey.html有这个：

```
<form action="/survey/" method="POST">
<table>
{{ formset }}
</table>
  <input type = "submit" value = "Submit">
</form> 
```

哦，models.py中对ScoreForm和Score的定义是：

```
class Score(models.Model):
        movie = models.ForeignKey(Movie)
        score = models.IntegerField()
        user = models.ForeignKey(User)

class ScoreForm(ModelForm):
        class Meta:
                model = Score 
```

因此，如果上述内容不清楚，我的目标是制作一个表格，每部电影有一行，每一行显示一个标题，并有一个框允许用户输入他们的分数。

如果有人能指出我正确的方法，我将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T14:12:17.307

“起初，我认为这就是表单集的用途，但如果你明白我的意思，我看不出有任何方法可以自动迭代数据库表的内容以生成要进入表单的项目。”

您需要获取一个查询集。您需要将该查询集作为初始数据提供给您的表单。请参阅[将初始数据与](http://docs.djangoproject.com/en/dev/topics/forms/formsets/#using-initial-data-with-a-formset)代码集一起使用。

```
initial = [ list of { dictionaries }, one per form ] 
```

有趣的是，这是模型 API 通过查询集的`values`方法的直接特征。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T08:22:07.340

我找到了答案，使用 modelformset_factory 代替 formset_factory 解决了问题，谢谢...

# jquery - 如何对子域进行 jquery ajax 调用？

> ID：298780
> 
> 赞同：2
> 
> 时间：2008-11-18T13:55:49.137
> 
> 标签：jquery, ajax, subdomain

我可以调用同一域内的页面，但由于安全问题，当我调用子域中的页面时它不起作用。我必须做什么？帮我！！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T14:09:41.197

您可以设置 document.domain 但如果我没记错的话，一些浏览器（Opera）甚至不允许这样做。恐怕您的答案是在您可以交谈的子域上创建某种代理

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-10T20:08:39.030

使用脚本标签，响应应该是 javascript 回调。

前任：

代替：

```
<script type="text/javascript">
jQuery.ajax({
    success: function(data) {
        alert(data.field);
    },
    dataType: 'json'
});
</script> 
```

做：

```
<script src="http://sub.domain.com/file"></script> 
```

这将产生以下内容：

```
data = {'field': 'bleh'}
alert(data.field); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-19T09:58:15.073

由于安全原因，大多数浏览器不允许对不同域的 ajax 请求。据我所知，你将无法做到这一点。

# .net - 使用最终用户设计器在 .net winforms 中报告

> ID：298781
> 
> 赞同：2
> 
> 时间：2008-11-18T13:55:55.827
> 
> 标签：.net, reporting, designer

你们在 .net 中使用什么作为报告引擎，**具有最终用户设计功能**？

我尝试了 DevExpress XtraReports，但我无法成功获得一致的结果。（例如，我尝试显示某个联系人的已售机器的详细报告-> 第一个字段工作正常，其他字段不工作；其中没有数据。无论我做什么）这种莫名其妙的行为是不能容忍的在企业环境中，所以我很好奇其他解决方案是什么......

更新：应该注意，这里的重点是最终用户设计器部分。客户应该能够修改报告的布局和字段（在限制范围内），而无需广泛的 IT 知识。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T13:59:14.183

SQL server 报告服务用于生成的任何动态报告或报告生成器用于临时报告。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T14:07:21.547

Data Dynamics Active Reports .Net... 与 Visual Studio 完全集成，可以使用 C# 或 VB.net，并且不需要单独的“报告服务器”，因此它生成的 dll 是在您的托管代码中工作的托管代码程序集可执行文件，并且可以与您的可执行文件或 Web 应用程序一起部署为依赖程序集，就像您编写的任何其他已部署应用程序一样，跨应用程序场或 Web 场部署，无需额外的许可费用...

还包括 pdf、文本 xls 和其他自动报告生成器和查看器，以及最终用户自定义报告生成工具。（以便最终用户可以修改报告布局、过滤和排序选项...）

[http://www.datadynamics.com/Products/ProductFeatures.aspx?Product=ARNET3&Topic=End-User%20Report%20Designer](http://www.datadynamics.com/Products/ProductFeatures.aspx?Product=ARNET3&Topic=End-User%20Report%20Designer)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-30T15:32:52.813

请查看[迎风报告](http://www.windwardstudios.com/)。使用 Windward，您可以在 Microsoft Word、Excel 或 PowerPoint 中设计报告 - 因此您的最终用户没有学习曲线。（免责声明 - 我是 Windward 的 CTO。）

至于您在某些领域没有取回数据的问题，这更有可能是您精心制作的选择的问题 - 我没有听说过任何报告系统删除数据，特别是 DevExpress 编写了可靠的代码。

# python - Python xml.dom.minidom.parse() 函数忽略 DTD

> ID：298782
> 
> 赞同：4
> 
> 时间：2008-11-18T13:56:04.423
> 
> 标签：python, xml

我有以下 Python 代码：

```
import xml.dom.minidom
import xml.parsers.expat

try:
    domTree = ml.dom.minidom.parse(myXMLFileName)
except xml.parsers.expat.ExpatError, e:
    return e.args[0] 
```

我用来解析 XML 文件。尽管它很高兴地发现了简单的 XML 错误，例如不匹配的标签，但它完全忽略了 XML 文件顶部指定的 DTD：

```
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE ServerConfig SYSTEM "ServerConfig.dtd"> 
```

因此，例如，当缺少必需元素时，它不会注意到。如何打开 DTD 检查？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T14:11:14.127

看到[这个问题](https://stackoverflow.com/questions/15798/how-do-i-validate-xml-against-a-dtd-file-in-python)- 接受的答案是使用[lxml 验证](http://codespeak.net/lxml/validation.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T15:04:18.670

只是作为解释：Python xml.dom.minidom 和 xml.sax 默认使用 expat 解析器，这是一个非验证解析器。它可能会读取 DTD 以进行实体替换，但不会针对 DTD 进行验证。

[gimel](/users/6491/gimel)和[Tim](/users/20670/tim)推荐 lxml，它是 libxml2 和 libxslt 库的一个很好的 Pythonic 绑定。它支持针对 DTD 的验证。我一直在使用lxml，我非常喜欢它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T16:33:11.453

仅作记录，这就是我的代码现在的样子：

```
from lxml import etree

try:
    parser = etree.XMLParser(dtd_validation=True)
    domTree = etree.parse(myXMLFileName, parser=parser)
except etree.XMLSyntaxError, e:
    return e.args[0] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T14:20:30.553

我推荐 lxml 而不是 xmlproc，因为 PyXML 包（包含 xmlproc）不再被开发；PyXML 可以使用的最新 Python 版本是 2.4。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T14:09:52.790

我相信您需要从 expat 切换到 xmlproc。
见： [http ://code.activestate.com/recipes/220472/](http://code.activestate.com/recipes/220472/)

# css - 在css中垂直居中具有固定高度的标题

> ID：298786
> 
> 赞同：1
> 
> 时间：2008-11-18T13:56:48.120
> 
> 标签：css, vertical-alignment

我有一个标题

```
<h1>My Header</h1> 
```

它有一个高度`150px`和一个`font-size`说`1.3em;` 我如何使标题文本垂直居中与 CSS。我宁愿不将它包装在容器 DIV 中（包装 div 真的破坏了整个 CSS 想法）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T14:10:43.753

如果标题的高度是 150px，你也可以设置`line-height`为 150px 吗？

```
h1
{
    font-size: 1.3em;
    line-height: 150px;
    height: 150px;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T14:26:58.497

最好的方法是添加此规则：

```
h1 {
    line-height: 150px;
} 
```

不需要设置高度值，字体大小不影响垂直对齐。

# macos - 在 OS X 终端中保存元数据

> ID：298788
> 
> 赞同：1
> 
> 时间：2008-11-18T13:57:43.640
> 
> 标签：macos, emacs, terminal, meta-key

自从终端出现以来，我已将修改后的 stock .term 文件保存为 ~/mySrvr.term，该文件打开以执行到远程服务器的 ssh 并修改外观。我无法为 emacs-ery 保存“使用选项键作为元”；术语文件中没有它的位置，我不愿意与键盘字典文件搏斗。我错过了一些简单的东西吗？如何让 option-as-meta 在会话之间保持不变？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T15:16:50.767

如果您使用 Leopard，请在 Terminal.app 中打开首选项。有一个名为“设置”的选项卡，它实际上是针对不同样式的终端窗口的设置。复制一份 Apple 的默认设置并将其更改为您喜欢的，并确保在此处选择 option-as-meta 单选按钮。

我现在什至不费心打开术语文件，在 Leopard 下，您可以通过 Windows 菜单保存任何一组窗口，它会保存它们的所有设置，并且您可以通过同一菜单打开这些备份。例如，我有一个窗口组，它在两个选项卡中通过 ssh 进入服务器，第三个选项卡启动 ssh 隧道。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T14:33:52.100

不确定这是否有帮助，但是当我转到 Shell -> Export Settings 并将文件保存为 .terminal 文件时，有几行可以保存我的 option-as-meta 首选项：

```
<key>useOptionAsMetaKey</key>
<true/> 
```

这些行是针对 .terminal 首选项文件的，而不是针对 .term （这对 Google 来说很难），因此它们可能不是您要查找的内容。

# asp.net - 文件传输

> ID：298791
> 
> 赞同：0
> 
> 时间：2008-11-18T14:00:05.977
> 
> 标签：asp.net, iis

我在 serverA 上有一个 IIS

我在 locationA 有 userA，他打开了一个内容管理系统站点，托管在 serverA 上。

该系统的特点之一是它允许用户将文件移动到 LocationB，所有这些都在同一个网络内。现在，当发生此移动时，由于带宽限制，该文件是否会从 LocationA 移动到 serverA 到 LocationB，或者有没有办法让我将文件从 LocationA 移动到 LocationB 而无需通过 serverA，即使用 serverA 上的本地内存

我目前没有使用 BITS。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T16:50:07.863

要跟进 Ian 直接发布到 server2 的建议，您将需要某种网络服务器（可能是 IIS，但您可以自定义编写一个，它只接受 CMS 表单提交并将文件放在需要的位置）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T16:37:54.237

userA 是从他们的机器上传文件吗？如果是这样，您可以通过在表单上设置 action 属性来做到这一点：

```
<form method="post" action="http://serverB/locationB" enctype="multipart/form-data">
    ...
    <input type="file" ... />
    ...
</form> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T14:09:10.810

这完全取决于 CMS 的工作方式——如果它`scp`在后台运行，那么答案是肯定的——它会跳过本地机器。

如果它使用 http 将其传输到用户的机器然后退出，答案是“否”。

# visual-studio-2008 - Visual Studio 项目未保存

> ID：298799
> 
> 赞同：13
> 
> 时间：2008-11-18T14:03:13.723
> 
> 标签：visual-studio-2008

有人**请**告诉我在 VS 崩溃后可以恢复 Visual Studio 源代码！

我刚刚花了 5 个小时编写了一个新的实用程序应用程序，并在打开“构建前保存”选项以及每 5 分钟自动恢复的情况下运行它。但是在 VS 崩溃之后，除了一个空的项目文件夹之外，我找不到任何东西！！！我不敢相信文件只是“保存”到内存中？！？这不可能！那 5 个小时的工作必须在磁盘上的**某个地方？**

我试图通过创建一个垃圾项目，运行它，然后使用任务管理器杀死 VS 来重现该场景。这与实际弹出一个对话框要求保存项目的情况并不完全相同。我忽略了这一点，继续杀戮。然后我能够按照建议在 C:\Users{Username}\AppData\Local\Temporary Projects 中找到垃圾源 - 但不是我之前的项目。

我认为它已经消失了。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-18T14:35:16.170

为了确保以后不会再发生这种情况，您可以访问

**工具**>**选项**>**项目和解决方案**

并检查项目

**创建时保存新项目**

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-24T13:00:40.083

我遇到了和海报一样的问题。我多次运行（并因此隐式保存）该项目，但显然源已消失。

```
C:\Users\<username>\Documents\Visual Studio 2008\Backup Files\<ProjectName>\ 
```

仅包含带有项目名称的空文件夹

```
C:\Users{Username}\AppData\Local 
```

甚至不包含名为*Temporary Projects的文件夹*

我搜索了所有 C: 并没有发现任何相关内容。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-18T14:08:11.763

在您真正点击保存解决方案之前，该项目将保存在一个临时目录中。这使您可以快速创建临时项目，而不会弄乱您的项目文件夹。希望它还没有被清理，但如果没有，它将在您的应用程序数据目录中。在 Vista 上，即

```
C:\Users\{Username}\AppData\Local\Temporary Projects 
```

抱歉，我忘记了 XP 上的内容。

故事的寓意，如果不是临时项目，请尽早保存项目。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-07T17:57:52.217

对于 Visual 2010 C# ...我制作了一个简单的 WPF 项目，并在我重新启动计算机后将其移至 C:\Documents and Settings\scharusaengrit\My Documents\Visual Studio 2010\Backup Files。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T15:04:07.500

我恢复了保存在

C:\Users\<用户名>\Documents\Visual Studio 2008\Backup Files\<项目名>\

（这是在 Vista 上）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-18T15:51:19.090

grep/搜索您的整个驱动器以查找 sln、proj 和 cpp（或任何语言）文件。

祝你好运。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-11T17:43:13.857

如果您想要 VS Management Studio 文件，我只是在文件中找到了我的`C:\Users\<<User>>Documents\SQL Server Management Studio\Backup Files\Solution1\`文件`~AutoRecover%`...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-04-29T06:40:28.787

在我没有保存的 WIP 项目断电后，我遇到了同样的问题！你认为我们现在应该知道得更多了！

这个很棒的软件，[Recuva](https://www.piriform.com/recuva)扫描了我的磁盘，我在过滤 *.cs 后设法取回了我的文件。呸！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-04-21T10:44:59.407

当您从 Visual Studio 打开网站时会发生这种情况。

只需将您的项目保存到另一个位置..

文件>另存为>“您的位置”

就是这样

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-11-18T14:08:30.450

确实如此。检查您的两个项目文件夹。两者都可能包含您的项目，但其中一个是一个文件夹，其中只有一个 .sln 文件。

我非常有信心您的工作在您的文档文件夹中的某个磁盘上:)。如果全部设置为默认值。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2012-01-12T10:50:27.503

显然，某些版本的 Windows 存储文件的备份。如果以上建议都不适合你，你可以试试[这个](http://weblogs.asp.net/jgalloway/archive/2008/05/21/using-vista-previous-versions-to-restore-files-you-thought-you-d-lost.aspx)。

# wpf - 为什么我在从控件模板绑定到图像时遇到问题？

> ID：298811
> 
> 赞同：1
> 
> 时间：2008-11-18T14:06:08.163
> 
> 标签：wpf, image, binding, styles

我有一个项目控件的样式，它绑定到目标中的图像，它只有在目标**也**绑定到图像时才会出现，我不知道为什么..任何人都可以为我阐明它吗？

我的风格的简化版本：

```
<Style x:Key="testStyle" TargetType="ItemsControl">
    <Setter Property="Control.Template">
        <Setter.Value>
            <ControlTemplate>
                <DockPanel HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Width="Auto" Height="Auto" LastChildFill="True">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="32"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0" DockPanel.Dock="Top" MinHeight="25" SnapsToDevicePixels="True">
                                <StackPanel Orientation="Horizontal">
                                    <Image Margin="10,0,10,0" VerticalAlignment="Stretch" Height="24" Width="24"  Source="{Binding Path=HeaderImage}" />
                                    <TextBlock FontFamily="Tahoma" VerticalAlignment="Center" Text="{Binding Path=HeaderInfo}" />
                                </StackPanel>
                                <Line VerticalAlignment="Bottom" Stretch="Fill"/>
                            </Grid>
                            <ItemsPresenter Grid.Row="1"/>
                        </Grid>
                    </DockPanel>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

我的用户控制：

```
<UserControl x:Class="StartPageView"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" >
<ItemsControl Style="{DynamicResource testStyle}">
    <Grid HorizontalAlignment="Stretch" >
        <StackPanel>
        <GroupBox Header="Information"  Margin="0,0,0,10" >
            <Label Margin="10,10,10,110">some useful information, dynamically updated</Label>
        </GroupBox>
        <GroupBox Header="Available actions" Margin="0,10,0,10">
            <StackPanel>
                <Label Margin="10,10,10,10">action 1</Label>
                <Label Margin="10,10,10,10">action 2</Label>
                <Label Margin="10,10,10,10">action 3</Label>
                    <!--<Image Width="0" Height="0" Source="{Binding HeaderImage}"/>-->
                </StackPanel>
        </GroupBox>
        </StackPanel>
    </Grid>
</ItemsControl> 
```

还有我的模型代码（设置为我的用户控件的数据上下文）

```
internal class StartPageViewPresentationModel : IStartPageViewPresentationModel
{
    public StartPageViewPresentationModel(IStartPageView view)
    {
        HeaderImage = new BitmapImage(new Uri(@"Images/home_16.png", UriKind.Relative)) { CacheOption = BitmapCacheOption.Default };

        HeaderInfo = "Start Page";

        View = view;
        View.Model = this;
    }

    public BitmapImage HeaderImage { get; set; }

    public string HeaderInfo { get; set; }

    public IStartPageView View { get; set; }
} 
```

如果我取消注释用户控件中的标记，则图像会同时显示在控件和模板区域中，如果我注释它，它不会出现在任何一个中。模板中的文本绑定工作正常

我很困惑。。

谢谢

特雷弗

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T14:21:14.543

几个建议：

1.  您是否尝试过图像的绝对 URI？
2.  `HeaderImage`可以是类型`ImageSource`而不是更严格的`BitmapImage`。

我怀疑正在发生的事情是`UserControl`有效的，因为路径是相对且正确的，基于`UserControl`. 因此，图像被缓存并从模板中工作。

但是，当您评论出图像是从 的位置解析时`Style`，这可能不正确？

# oop - 如何将非规范化值引入业务对象？

> ID：298812
> 
> 赞同：0
> 
> 时间：2008-11-18T14:06:27.133
> 
> 标签：oop, architecture, class-design

我有两张桌子。

订单 - 包含列 OrderID、OrderStatusID
OrderStatus - 包含列 OrderStatusID、说明

我有一个 Order 对象，它调用数据库并填充其属性以在我的代码中使用。现在我可以访问 Order.OrderStatusID，但在我的应用程序中，我确实需要访问“描述”字段。

您如何通过良好的 OO 设计优雅地处理这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T14:39:21.357

通常我更喜欢将查找作为[值对象](http://martinfowler.com/bliki/ValueObject.html)来处理。我也使用[空对象模式](http://en.wikipedia.org/wiki/Null_Object_pattern)。

```
public class Order {
  private int statusID;

  public OrderStatus Status {
    get {
      return OrderStatus.Resolve(statusID);
    }
    set {
      statusID = value != null ? value.ID : null;
    }
  }
}

public class OrderStatus {
   public static OrderStatus Resolve(int statusID)
   {
     OrderStatus status = null;
     // read from cache or DB
     ...
     // if not found return Null object
     if (status == null)
       status = new OrderStatus(null, string.Empty);
     return status;
   }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T14:27:34.860

我目前正在使用的系统创建另一个业务对象的实例并设置 Id。然后在使用另一个业务对象时检索它。例如

订单属性

```
int OrderId = 5
int OrderStatusId = 3
OrderStatus OrderStatus_ref
{
get
{
    if OrderStatus_ref == null
        OrderStatus_ref = new OrderStatus(OrderStatusId)
    return OrderStatus_ref
}
} 
```

无论如何，这是一般的想法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T14:17:12.197

您可以将 SQL 选择语句与 OrderStatus 表的连接一起使用，并包含每个表中您想要的列...

```
Select O.OrderId, O.OrderStatusId, S.Descriptiuon
From Order O
    Join OrderStatus S 
        On S.OrderStatusId = O.OrderStatusId
Where OrderId = 23 -- or whatever 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T14:18:10.947

Order 和 OrderStatus 之间是一对一的关系吗？我想这取决于你为什么会有一个 OrderStatus 表的目的，因为我认为实际上不需要单独的 OrderStatus 表？

基本上，该表为您提供的只是更改订单状态描述的能力。然后，您将在代码中根据预定义的 OrderStatusID（来自种子数据？）或通过描述编写代码。如果是这种情况，那么为什么不让 Order 表包含一个 OrderStatus 列，它是一个整数并且可以映射到一个枚举类型？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T14:29:44.513

我的 Order 对象可能包括状态描述字段（只读 [对非内部类]），以及任何其他类似字段。

在后台，我的 getter（例如 LoadByID、LoadAll 等）可能会使用包含所有这些描述性字段的视图（例如 OrdersView）。这些描述字段是只读的，因此您不会意外设置这些字段，以为您可以将更改保存到数据库。

# python - Python Distutils

> ID：298828
> 
> 赞同：0
> 
> 时间：2008-11-18T14:10:22.243
> 
> 标签：python, mingw, distutils, cython

由于[Distutils的](http://www.python.org/doc/2.5.2/dist/dist.html)[严格版本编号类](http://epydoc.sourceforge.net/stdlib/distutils.version.StrictVersion-class.html)，我无法安装[cython](http://cython.org/)。例如 binutils-2.18.50-20080109-2.tar.gz 不能与[MinGW](http://mingw.org/)一起用于安装 cython。[源代码文档](http://epydoc.sourceforge.net/stdlib/distutils.version.StrictVersion-class.html)说“这个版本编号系统的基本原理将在 distutils 文档中解释。” 我找不到理由。

我的问题：这个版本编号系统的基本原理是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-04T11:04:31.703

这只是 distutils 的另一个愚蠢之处。我个人在我必须使用的每台 Windows 机器上的 distutils 安装中删除了这个烦人的检查。

只要通过版本检查，安装另一个 mingw 版本就可以工作 - 但实际上，检查工具版本的整个想法没有多大意义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-10-10T16:06:42.837

我想这个想法是建议项目使用与 StrictVersion 类兼容的版本号以便于排序（即比较版本，以了解 1.0 比 1.0b 更新）。问题是它从未真正起飞，distutils 的原作者转向了其他项目。当 setuptools 作为 distutils 的一组新功能和猴子补丁启动时，它没有使用 Version 类，而是定义了一种算法来将任何版本号转换为可排序的表示。几年前，Tarek Ziadé 接管了 distutils 的维护和开发工作，并与 distutils 社区合作制定了一个 PEP，以定义新的版本号规范。这个 PEP，PEP 386，已经在 distutils2 中被接受和实施。它的定义目标是支持社区使用的功能（例如 alpha/beta/候选版本、发布后标记），并且仍然允许排序。它也比 setuptools 更受限制，但比 StrictVersion 和 LooseVersion 更有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T18:01:24.740

你可以试试[这个](http://www.develer.com/oss/GccWinBinaries)非官方的 MinGW 发行版，它有一个简单的安装过程，可以设置 distutils 以使用它来编译扩展。

# pdf - 如何在完全下载之前在网络浏览器中显示 pdf

> ID：298829
> 
> 赞同：3
> 
> 时间：2008-11-18T14:10:27.467
> 
> 标签：pdf, iis-6

我有一个客户一直在努力在网络上加载缓慢的 pdf 文件。我的客户有一些非常大的 pdf 文件，几乎 10 Mb。下载它们需要 3-4 分钟以上。在加载整个文件之前，这些文件不会显示。我们和他们已经看到其他网站的 pdf 一次加载一页，因此最终用户可以开始查看文件，因为页面的其余部分仍在后台加载。给人一种页面加载速度更快的错觉。

根据他们看到的文档，如果在创建 pdf 文件时选中了“针对快速 Web 视图进行优化”，IIS 6 应该会自动执行此操作。它被选中，文件仍然不会一次加载页面。

他们已经搜索并发现如果文件保存正确，除了 IIS 之外没有任何东西会自动执行此操作。

他们如何“流式传输”pdf？这是因为 pdf 是以特殊方式保存的吗？这是一个处理下载的java脚本吗？或者是否需要在 IIS 中进行更改？

谢谢

更新：文件开始是这样的：

```
%PDF-1.4
%âãÏÓ
171 0 obj << 0/Linearized 1 
```

线性化？

PDF 文档不是从 aspx/asp 页面提供的。（它只是直接发布到该站点并链接到）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T14:17:20.107

是否可以使用第三方服务，例如[Scribd](http://www.scribd.com/)？如果你走这条路，你可以将他们的流媒体查看器嵌入到你客户的网站上。只是一个想法，虽然我知道它并不适合所有类型的业务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T14:40:20.480

如果您从 aspx 页面提供 PDF，则可能会发生这种情况，为了获得线性化 pdf 需要直接提供页面的字节服务，或者您需要提供来自 aspx 代码的字节服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T15:07:49.957

您需要对 PDF 进行线性化，而不是信任 IIS 为您执行此操作。

有许多应用程序可以为您执行此操作。我用过 CVision（他们的压缩比没有，但许可和 SDK 很痛苦），这里也有一些更便宜的替代品[，](http://www.softlist.net/products/linearize_pdf.html)但我不知道它们的效果如何。

为了澄清托尼的观点......（我认为）

如果您实际使用过这些工具并且您的 pdf 是线性化的，请尝试将 PDF 转换为字节数组并 Response.Write() 将字节数组（带有内容标题等）发送到客户端（在新的浏览器窗口或框架中）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T15:27:49.607

保存其中一个文件并在文本编辑器中打开它。如果你没有看到类似的东西

```
<< /Linearized 1.0 /L <number> /H [<number> <number>] /O <number> /E <number> ... 
```

在前几百个字节左右，那么您就没有得到线性化（即快速网络）PDF。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T15:40:31.547

首先，文档需要“线性化”，正如其他人所解释的那样；[您可以在 Acrobat 或使用Ghostscript](http://pages.cs.wisc.edu/~ghost/)中的 pdfopt 对其进行线性化。其次，Web 服务器必须能够提供字节范围（即支持 Range 标头）；我不知道如何为此配置 IIS，但即使文档是线性化的，客户端也必须能够读取特定的字节范围。

# c# - 在 C# 中将包含命令行参数的字符串拆分为 string[]

> ID：298830
> 
> 赞同：96
> 
> 时间：2008-11-18T14:10:30.150
> 
> 标签：c#, command-line, text-parsing

我有一个字符串，其中包含要传递给另一个可执行文件的命令行参数，我需要提取包含各个参数的字符串 []，就像在命令行上指定命令时 C# 一样。当通过反射执行另一个程序集入口点时，将使用 string[]。

这有标准功能吗？或者是否有正确拆分参数的首选方法（正则表达式？）？它必须正确处理可能包含空格的 '"' 分隔字符串，所以我不能只在 ' ' 上拆分。

示例字符串：

```
string parameterString = @"/src:""C:\tmp\Some Folder\Sub Folder"" /users:""abcdefg@hijkl.com"" tasks:""SomeTask,Some Other Task"" -someParam foo"; 
```

示例结果：

```
string[] parameterArray = new string[] { 
  @"/src:C:\tmp\Some Folder\Sub Folder",
  @"/users:abcdefg@hijkl.com",
  @"tasks:SomeTask,Some Other Task",
  @"-someParam",
  @"foo"
}; 
```

我不需要命令行解析库，只是一种获取应该生成的 String[] 的方法。

**更新**：我必须更改预期结果以匹配 C# 实际生成的结果（删除了拆分字符串中的额外“”）

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-11-18T15:06:58.367

令我烦恼的是，没有基于检查每个字符的函数来拆分字符串的函数。如果有，你可以这样写：

```
 public static IEnumerable<string> SplitCommandLine(string commandLine)
    {
        bool inQuotes = false;

        return commandLine.Split(c =>
                                 {
                                     if (c == '\"')
                                         inQuotes = !inQuotes;

                                     return !inQuotes && c == ' ';
                                 })
                          .Select(arg => arg.Trim().TrimMatchingQuotes('\"'))
                          .Where(arg => !string.IsNullOrEmpty(arg));
    } 
```

虽然已经写了，为什么不写必要的扩展方法。好吧，你说服了我...

首先，我自己的 Split 版本采用一个必须决定指定字符是否应该拆分字符串的函数：

```
 public static IEnumerable<string> Split(this string str, 
                                            Func<char, bool> controller)
    {
        int nextPiece = 0;

        for (int c = 0; c < str.Length; c++)
        {
            if (controller(str[c]))
            {
                yield return str.Substring(nextPiece, c - nextPiece);
                nextPiece = c + 1;
            }
        }

        yield return str.Substring(nextPiece);
    } 
```

根据情况，它可能会产生一些空字符串，但也许这些信息在其他情况下会很有用，所以我不会删除这个函数中的空条目。

其次（更普通的）一个小助手，它将从字符串的开头和结尾修剪一对匹配的引号。它比标准的 Trim 方法更繁琐——它只会从每一端修剪一个字符，并且不会只从一端修剪：

```
 public static string TrimMatchingQuotes(this string input, char quote)
    {
        if ((input.Length >= 2) && 
            (input[0] == quote) && (input[input.Length - 1] == quote))
            return input.Substring(1, input.Length - 2);

        return input;
    } 
```

我想你也会想要一些测试。好吧，那好吧。但这绝对是最后一件事！首先是一个辅助函数，它将拆分结果与预期的数组内容进行比较：

```
 public static void Test(string cmdLine, params string[] args)
    {
        string[] split = SplitCommandLine(cmdLine).ToArray();

        Debug.Assert(split.Length == args.Length);

        for (int n = 0; n < split.Length; n++)
            Debug.Assert(split[n] == args[n]);
    } 
```

然后我可以编写这样的测试：

```
 Test("");
        Test("a", "a");
        Test(" abc ", "abc");
        Test("a b ", "a", "b");
        Test("a b \"c d\"", "a", "b", "c d"); 
```

这是针对您的要求的测试：

```
 Test(@"/src:""C:\tmp\Some Folder\Sub Folder"" /users:""abcdefg@hijkl.com"" tasks:""SomeTask,Some Other Task"" -someParam",
             @"/src:""C:\tmp\Some Folder\Sub Folder""", @"/users:""abcdefg@hijkl.com""", @"tasks:""SomeTask,Some Other Task""", @"-someParam"); 
```

请注意，该实现具有额外的功能，即如果有意义，它将删除参数周围的引号（感谢 TrimMatchingQuotes 函数）。我相信这是正常命令行解释的一部分。

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2009-04-14T22:55:23.117

除了[Earwicker](https://stackoverflow.com/users/27423/earwicker)提供的[良好且纯托管的解决方案](https://stackoverflow.com/questions/298830/split-string-containing-command-line-parameters-into-string-in-c/298990#298990)之外，为了完整起见，可能值得一提的是，Windows 还提供了将字符串分解为字符串数组的功能：[`CommandLineToArgvW`](http://msdn.microsoft.com/en-us/library/bb776391.aspx)

> ```
> LPWSTR *CommandLineToArgvW(
>     LPCWSTR lpCmdLine, int *pNumArgs); 
> ```
> 
> 以类似于标准 C 运行时 argv 和 argc 值的方式解析 Unicode 命令行字符串并返回指向命令行参数的指针数组以及此类参数的计数。

从 C# 调用此 API 并在托管代码中解压缩生成的字符串数组的示例可在以下位置找到：“<a href="http://intellitect.com/converting-command-line-string-to-args-using- commandlinetoargvw-api/" rel="noreferrer">使用 CommandLineToArgvW() API 将命令行字符串转换为 Args[]。” 下面是相同代码的稍微简单的版本：

```
[DllImport("shell32.dll", SetLastError = true)]
static extern IntPtr CommandLineToArgvW(
    [MarshalAs(UnmanagedType.LPWStr)] string lpCmdLine, out int pNumArgs);

public static string[] CommandLineToArgs(string commandLine)
{
    int argc;
    var argv = CommandLineToArgvW(commandLine, out argc);        
    if (argv == IntPtr.Zero)
        throw new System.ComponentModel.Win32Exception();
    try
    {
        var args = new string[argc];
        for (var i = 0; i < args.Length; i++)
        {
            var p = Marshal.ReadIntPtr(argv, i * IntPtr.Size);
            args[i] = Marshal.PtrToStringUni(p);
        }

        return args;
    }
    finally
    {
        Marshal.FreeHGlobal(argv);
    }
} 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-11-18T15:00:58.270

Windows 命令行解析器的行为就像你说的那样，在空格上拆分，除非它前面有一个未闭合的引号。我建议自己编写解析器。可能是这样的：

```
 static string[] ParseArguments(string commandLine)
    {
        char[] parmChars = commandLine.ToCharArray();
        bool inQuote = false;
        for (int index = 0; index < parmChars.Length; index++)
        {
            if (parmChars[index] == '"')
                inQuote = !inQuote;
            if (!inQuote && parmChars[index] == ' ')
                parmChars[index] = '\n';
        }
        return (new string(parmChars)).Split('\n');
    } 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2010-01-25T11:53:30.843

我[从 Jeffrey L Whitledge 那里得到了答案，](https://stackoverflow.com/questions/298830/split-string-containing-command-line-parameters-into-string-in-c-sharp/298968#298968)并对其进行了一些改进。

它现在支持单引号和双引号。您可以通过使用其他类型的引号在参数本身中使用引号。

它还从参数中去除引号，因为这些对参数信息没有贡献。

```
 public static string[] SplitArguments(string commandLine)
    {
        var parmChars = commandLine.ToCharArray();
        var inSingleQuote = false;
        var inDoubleQuote = false;
        for (var index = 0; index < parmChars.Length; index++)
        {
            if (parmChars[index] == '"' && !inSingleQuote)
            {
                inDoubleQuote = !inDoubleQuote;
                parmChars[index] = '\n';
            }
            if (parmChars[index] == '\'' && !inDoubleQuote)
            {
                inSingleQuote = !inSingleQuote;
                parmChars[index] = '\n';
            }
            if (!inSingleQuote && !inDoubleQuote && parmChars[index] == ' ')
                parmChars[index] = '\n';
        }
        return (new string(parmChars)).Split(new[] { '\n' }, StringSplitOptions.RemoveEmptyEntries);
    } 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2020-10-07T02:41:10.790

因为我想要与 OP 相同的行为（拆分字符串与 windows cmd 完全相同）我写了一堆测试用例并测试了这里发布的答案：

```
 Test( 0, m, "One",                    new[] { "One" });
    Test( 1, m, "One ",                   new[] { "One" });
    Test( 2, m, " One",                   new[] { "One" });
    Test( 3, m, " One ",                  new[] { "One" });
    Test( 4, m, "One Two",                new[] { "One", "Two" });
    Test( 5, m, "One  Two",               new[] { "One", "Two" });
    Test( 6, m, "One   Two",              new[] { "One", "Two" });
    Test( 7, m, "\"One Two\"",            new[] { "One Two" });
    Test( 8, m, "One \"Two Three\"",      new[] { "One", "Two Three" });
    Test( 9, m, "One \"Two Three\" Four", new[] { "One", "Two Three", "Four" });
    Test(10, m, "One=\"Two Three\" Four", new[] { "One=Two Three", "Four" });
    Test(11, m, "One\"Two Three\" Four",  new[] { "OneTwo Three", "Four" });
    Test(12, m, "One\"Two Three   Four",  new[] { "OneTwo Three   Four" });
    Test(13, m, "\"One Two\"",            new[] { "One Two" });
    Test(14, m, "One\" \"Two",            new[] { "One Two" });
    Test(15, m, "\"One\"  \"Two\"",       new[] { "One", "Two" });
    Test(16, m, "One\\\"  Two",           new[] { "One\"", "Two" });
    Test(17, m, "\\\"One\\\"  Two",       new[] { "\"One\"", "Two" });
    Test(18, m, "One\"",                  new[] { "One" });
    Test(19, m, "\"One",                  new[] { "One" });
    Test(20, m, "One \"\"",               new[] { "One", "" });
    Test(21, m, "One \"",                 new[] { "One", "" });
    Test(22, m, "1 A=\"B C\"=D 2",        new[] { "1", "A=B C=D", "2" });
    Test(23, m, "1 A=\"B \\\" C\"=D 2",   new[] { "1", "A=B \" C=D", "2" });
    Test(24, m, "1 \\A 2",                new[] { "1", "\\A", "2" });
    Test(25, m, "1 \\\" 2",               new[] { "1", "\"", "2" });
    Test(26, m, "1 \\\\\" 2",             new[] { "1", "\\\"", "2" });
    Test(27, m, "\"",                     new[] { "" });
    Test(28, m, "\\\"",                   new[] { "\"" });
    Test(29, m, "'A B'",                  new[] { "'A", "B'" });
    Test(30, m, "^",                      new[] { "^" });
    Test(31, m, "^A",                     new[] { "A" });
    Test(32, m, "^^",                     new[] { "^" });
    Test(33, m, "\\^^",                   new[] { "\\^" });
    Test(34, m, "^\\\\",                  new[] { "\\\\" });
    Test(35, m, "^\"A B\"",               new[] { "A B" });

    // Test cases Anton

    Test(36, m, @"/src:""C:\tmp\Some Folder\Sub Folder"" /users:""abcdefg@hijkl.com"" tasks:""SomeTask,Some Other Task"" -someParam foo", new[] { @"/src:C:\tmp\Some Folder\Sub Folder", @"/users:abcdefg@hijkl.com", @"tasks:SomeTask,Some Other Task", @"-someParam", @"foo" });

    // Test cases Daniel Earwicker 

    Test(37, m, "",            new string[] { });
    Test(38, m, "a",           new[] { "a" });
    Test(39, m, " abc ",       new[] { "abc" });
    Test(40, m, "a b ",        new[] { "a", "b" });
    Test(41, m, "a b \"c d\"", new[] { "a", "b", "c d" });

    // Test cases Fabio Iotti 

    Test(42, m, "this is a test ",    new[] { "this", "is", "a", "test" });
    Test(43, m, "this \"is a\" test", new[] { "this", "is a", "test" });

    // Test cases Kevin Thach

    Test(44, m, "\"C:\\Program Files\"",                       new[] { "C:\\Program Files" });
    Test(45, m, "\"He whispered to her \\\"I love you\\\".\"", new[] { "He whispered to her \"I love you\"." }); 
```

“预期”值来自在我的机器（Win10 x64）上使用 cmd.exe 和一个简单的打印程序直接测试它：

```
static void Main(string[] args) => Console.Out.WriteLine($"Count := {args.Length}\n{string.Join("\n", args.Select((v,i) => $"[{i}] => '{v}'"))}"); 
```

这些是结果：

```
 Solution                      | Failed Tests
------------------------------|------------------------------------- 
Atif Aziz (749653)            | 2, 3, 10, 11, 12, 14, 16, 17, 18, 26, 28, 31, 32, 33, 34, 35, 36, 37, 39, 45
Jeffrey L Whitledge (298968)  | 1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 31, 32, 33, 34, 35, 36, 37, 39, 40, 41, 42, 43, 44, 45
Daniel Earwicker (298990)     | 10, 11, 12, 14, 16, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 31, 32, 33, 34, 35, 36, 45
Anton (299795)                | 12, 16, 17, 18, 19, 21, 23, 25, 26, 27, 28, 31, 32, 33, 34, 35, 45
CS. (467313)                  | 12, 18, 19, 21, 27, 31, 32, 33, 34, 35
Vapour in the Alley (2132004) | 10, 11, 12, 14, 16, 17, 20, 21, 22, 23, 25, 26, 27, 28, 29, 31, 32, 33, 34, 35, 36, 45
Monoman (7774211)             | 14, 16, 17, 20, 21, 22, 23, 25, 26, 27, 28, 31, 32, 33, 34, 35, 45
Thomas Petersson (19091999)   | 2, 3, 10, 11, 12, 14, 16, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 31, 32, 33, 34, 35, 36, 39, 45
Fabio Iotti (19725880)        | 1, 2, 3, 7, 10, 11, 12, 13, 14, 15, 16, 17, 19, 21, 22, 23, 25, 26, 28, 29, 30, 35, 36, 37, 39, 40, 42, 44, 45
ygoe (23961658)               | 26, 31, 32, 33, 34, 35
Kevin Thach (24829691)        | 10, 11, 12, 14, 18, 19, 20, 21, 22, 23, 26, 27, 31, 32, 33, 34, 35, 36
Lucas De Jesus (31621370)     | 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45
HarryP (48008872)             | 24, 26, 31, 32, 33, 34, 35
TylerY86 (53290784)           | 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 31, 32, 33, 34, 35, 36, 41, 43, 44, 45
Louis Somers (55903304)       | 2, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 31, 32, 33, 34, 35, 36, 39, 41, 43, 44, 45
user2126375 (58233585)        | 5, 6, 15, 16, 17, 31, 32, 33, 34, 35
DilipNannaware (59131568)     | 1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 31, 32, 33, 34, 35, 36, 37, 39, 40, 41, 42, 43, 44, 45
Mikescher (this)              | - 
```

因为没有答案似乎是正确的（至少基于我的用例）这是我的解决方案，它目前通过了所有测试用例（但如果有人有其他（失败）极端情况，请发表评论）：

```
public static IEnumerable<string> SplitArgs(string commandLine)
{
    var result = new StringBuilder();

    var quoted = false;
    var escaped = false;
    var started = false;
    var allowcaret = false;
    for (int i = 0; i < commandLine.Length; i++)
    {
        var chr = commandLine[i];

        if (chr == '^' && !quoted)
        {
            if (allowcaret)
            {
                result.Append(chr);
                started = true;
                escaped = false;
                allowcaret = false;
            }
            else if (i + 1 < commandLine.Length && commandLine[i + 1] == '^')
            {
                allowcaret = true;
            }
            else if (i + 1 == commandLine.Length)
            {
                result.Append(chr);
                started = true;
                escaped = false;
            }
        }
        else if (escaped)
        {
            result.Append(chr);
            started = true;
            escaped = false;
        }
        else if (chr == '"')
        {
            quoted = !quoted;
            started = true;
        }
        else if (chr == '\\' && i + 1 < commandLine.Length && commandLine[i + 1] == '"')
        {
            escaped = true;
        }
        else if (chr == ' ' && !quoted)
        {
            if (started) yield return result.ToString();
            result.Clear();
            started = false;
        }
        else
        {
            result.Append(chr);
            started = true;
        }
    }

    if (started) yield return result.ToString();
} 
```

我用来生成测试结果的代码可以在[这里找到](https://gist.github.com/Mikescher/a1450d13980f4363b47cdab5430b411a)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-07-18T16:20:42.547

[Earwicker](https://stackoverflow.com/users/27423/earwicker)的[良好且纯粹的托管解决方案](https://stackoverflow.com/questions/298830/split-string-containing-command-line-parameters-into-string-in-c/298990#298990)未能处理这样的论点：

```
Test("\"He whispered to her \\\"I love you\\\".\"", "He whispered to her \"I love you\"."); 
```

它返回了 3 个元素：

```
"He whispered to her \"I
love
you\"." 
```

所以这里有一个修复来支持“quoted \"escape\" quote”：

```
public static IEnumerable<string> SplitCommandLine(string commandLine)
{
    bool inQuotes = false;
    bool isEscaping = false;

    return commandLine.Split(c => {
        if (c == '\\' && !isEscaping) { isEscaping = true; return false; }

        if (c == '\"' && !isEscaping)
            inQuotes = !inQuotes;

        isEscaping = false;

        return !inQuotes && Char.IsWhiteSpace(c)/*c == ' '*/;
        })
        .Select(arg => arg.Trim().TrimMatchingQuotes('\"').Replace("\\\"", "\""))
        .Where(arg => !string.IsNullOrEmpty(arg));
} 
```

用另外 2 个案例进行了测试：

```
Test("\"C:\\Program Files\"", "C:\\Program Files");
Test("\"He whispered to her \\\"I love you\\\".\"", "He whispered to her \"I love you\"."); 
```

还注意到使用[CommandLineToArgvW](http://msdn.microsoft.com/en-us/library/bb776391.aspx)的[Atif Aziz](https://stackoverflow.com/users/6682/atif-aziz)[接受的答案](https://stackoverflow.com/questions/298830/split-string-containing-command-line-parameters-into-string-in-c-sharp/749653#749653)也失败了。它返回了 4 个元素：

```
He whispered to her \ 
I 
love 
you". 
```

希望这对将来寻找此类解决方案的人有所帮助。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-10-14T22:24:37.937

我喜欢迭代器，现在[LINQ](http://en.wikipedia.org/wiki/Language_Integrated_Query)就像字符串数组一样容易`IEnumerable<String>`使用，所以我遵循[Jeffrey L Whitledge 的回答](https://stackoverflow.com/questions/298830/split-string-containing-command-line-parameters-into-string-in-c-sharp/298968#298968)的精神是（作为 的扩展方法`string`）：

```
public static IEnumerable<string> ParseArguments(this string commandLine)
{
    if (string.IsNullOrWhiteSpace(commandLine))
        yield break;

    var sb = new StringBuilder();
    bool inQuote = false;
    foreach (char c in commandLine) {
        if (c == '"' && !inQuote) {
            inQuote = true;
            continue;
        }

        if (c != '"' && !(char.IsWhiteSpace(c) && !inQuote)) {
            sb.Append(c);
            continue;
        }

        if (sb.Length > 0) {
            var result = sb.ToString();
            sb.Clear();
            inQuote = false;
            yield return result;
        }
    }

    if (sb.Length > 0)
        yield return sb.ToString();
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-18T15:08:56.227

[Environment.GetCommandLineArgs()](http://msdn.microsoft.com/en-us/library/system.environment.getcommandlineargs.aspx)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-09-30T10:33:39.133

在您的问题中，您要求使用正则表达式，而我是它们的忠实粉丝和用户，因此当我需要与您进行相同的论点拆分时，我在谷歌搜索并没有找到简单的解决方案后编写了自己的正则表达式。我喜欢简短的解决方案，所以我做了一个，它是：

```
 var re = @"\G(""((""""|[^""])+)""|(\S+)) *";
            var ms = Regex.Matches(CmdLine, re);
            var list = ms.Cast<Match>()
                         .Select(m => Regex.Replace(
                             m.Groups[2].Success
                                 ? m.Groups[2].Value
                                 : m.Groups[4].Value, @"""""", @"""")).ToArray(); 
```

它处理引号内的空格和引号，并将封闭的“”转换为“。随意使用代码！

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-11-13T23:00:20.637

哦，见鬼。这一切……哎呀。[但这是合法的官方。](https://github.com/dotnet/corert/blob/master/src/System.Private.CoreLib/src/System/Runtime/CommandLine.Windows.cs)来自 Microsoft 的 C# for .NET Core，可能仅适用于 Windows，也可能是跨平台的，但已获得 MIT 许可。

精选花絮、方法声明和值得注意的评论；

```
internal static unsafe string[] InternalCreateCommandLine(bool includeArg0)
private static unsafe int SegmentCommandLine(char * pCmdLine, string[] argArray, bool includeArg0)
private static unsafe int ScanArgument0(ref char* psrc, char[] arg)
private static unsafe int ScanArgument(ref char* psrc, ref bool inquote, char[] arg) 
```

-

```
// First, parse the program name (argv[0]). Argv[0] is parsed under special rules. Anything up to 
// the first whitespace outside a quoted subtring is accepted. Backslashes are treated as normal 
// characters. 
```

-

```
// Rules: 2N backslashes + " ==> N backslashes and begin/end quote
//      2N+1 backslashes + " ==> N backslashes + literal "
//         N backslashes     ==> N backslashes 
```

这是从 .NET Framework 移植到 .NET Core 的代码，我假设是 MSVC C 库或`CommandLineToArgvW`.

这是我用正则表达式处理一些恶作剧并忽略零位参数的半心半意尝试。这有点神奇。

```
private static readonly Regex RxWinArgs
  = new Regex("([^\\s\"]+\"|((?<=\\s|^)(?!\"\"(?!\"))\")+)(\"\"|.*?)*\"[^\\s\"]*|[^\\s]+",
    RegexOptions.Compiled
    | RegexOptions.Singleline
    | RegexOptions.ExplicitCapture
    | RegexOptions.CultureInvariant);

internal static IEnumerable<string> ParseArgumentsWindows(string args) {
  var match = RxWinArgs.Match(args);

  while (match.Success) {
    yield return match.Value;
    match = match.NextMatch();
  }
} 
```

对古怪的生成输出进行了相当多的测试。它的输出与猴子输入和运行的内容的相当比例相匹配`CommandLineToArgvW`。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-10-26T21:21:29.883

有一个 NuGet 包，其中包含您需要的功能：

[Microsoft.CodeAnalysis.Common](https://www.nuget.org/packages/Microsoft.CodeAnalysis.Common/)包含具有方法[SplitCommandLineIntoArguments](https://docs.microsoft.com/de-de/dotnet/api/microsoft.codeanalysis.commandlineparser.splitcommandlineintoarguments?view=roslyn-dotnet)的类[CommandLineParser](https://docs.microsoft.com/de-de/dotnet/api/microsoft.codeanalysis.commandlineparser?view=roslyn-dotnet)。

你像这样使用它：

```
using Microsoft.CodeAnalysis;
// [...]
var cli = @"/src:""C:\tmp\Some Folder\Sub Folder"" /users:""abcdefg@hijkl.com"" tasks:""SomeTask,Some Other Task"" -someParam foo";
var cliArgs = CommandLineParser.SplitCommandLineIntoArguments(cli, true);

Console.WriteLine(string.Join('\n', cliArgs));
// prints out:
// /src:"C:\tmp\Some Folder\Sub Folder"
// /users:"abcdefg@hijkl.com"
// tasks:"SomeTask,Some Other Task"
// -someParam
// foo 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-18T14:23:04.620

这篇[The Code Project 文章](http://www.codeproject.com/KB/recipes/command_line.aspx)是我过去使用的。这是一段很好的代码，但它可能会起作用。

这篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/96s74eb0.aspx)是我能找到的唯一一篇解释 C# 如何解析命令行参数的文章。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-11-01T11:29:26.337

采用：

```
public static string[] SplitArguments(string args) {
    char[] parmChars = args.ToCharArray();
    bool inSingleQuote = false;
    bool inDoubleQuote = false;
    bool escaped = false;
    bool lastSplitted = false;
    bool justSplitted = false;
    bool lastQuoted = false;
    bool justQuoted = false;

    int i, j;

    for(i=0, j=0; i<parmChars.Length; i++, j++) {
        parmChars[j] = parmChars[i];

        if(!escaped) {
            if(parmChars[i] == '^') {
                escaped = true;
                j--;
            } else if(parmChars[i] == '"' && !inSingleQuote) {
                inDoubleQuote = !inDoubleQuote;
                parmChars[j] = '\n';
                justSplitted = true;
                justQuoted = true;
            } else if(parmChars[i] == '\'' && !inDoubleQuote) {
                inSingleQuote = !inSingleQuote;
                parmChars[j] = '\n';
                justSplitted = true;
                justQuoted = true;
            } else if(!inSingleQuote && !inDoubleQuote && parmChars[i] == ' ') {
                parmChars[j] = '\n';
                justSplitted = true;
            }

            if(justSplitted && lastSplitted && (!lastQuoted || !justQuoted))
                j--;

            lastSplitted = justSplitted;
            justSplitted = false;

            lastQuoted = justQuoted;
            justQuoted = false;
        } else {
            escaped = false;
        }
    }

    if(lastQuoted)
        j--;

    return (new string(parmChars, 0, j)).Split(new[] { '\n' });
} 
```

根据[Alley](https://stackoverflow.com/a/2132004/1377267)的回答中的 Vapor ，这个也支持 ^ 转义。

例子：

*   这是一个测试
    *   这
    *   是
    *   一种
    *   测试
*   这是一个测试
    *   这
    *   是一个
    *   测试
*   这个 ^"is a^" 测试
    *   这
    *   “是
    *   一种”
    *   测试
*   这个“”“是一个^^测试”
    *   这
    *   ​​​
    *   是一个 ^ 测试

它还支持多个空格（每个空格块只中断一次参数）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-05-30T18:59:01.787

**纯托管**的解决方案可能会有所帮助。WINAPI 函数的“问题”注释太多，在其他平台上不可用。这是我的代码，它具有明确定义的行为（您可以根据需要进行更改）。

它应该与 .NET/Windows 在提供该参数时所做的相同`string[] args`，并且我已经将它与许多“有趣”的值进行了比较。

这是一个经典的状态机实现，它从输入字符串中获取每个单个字符并将其解释为当前状态，产生输出和新状态。状态在变量`escape`、和中定义`inQuote`，输出收集在和中。`hadQuote``prevCh``currentArg``args`

我在真实命令提示符（Windows 7）上通过实验发现的一些特性：`\\`produces `\`、`\"`produces `"`、`""`在引用范围内produces `"`。

这个`^`角色似乎也很神奇：它总是在不加倍时消失。否则它对真正的命令行没有影响。我的实现不支持这一点，因为我还没有找到这种行为的模式。也许有人对此了解更多。

不适合这种模式的是以下命令：

```
cmd /c "argdump.exe "a b c"" 
```

该`cmd`命令似乎捕获了外部引号并逐字记录其余部分。这里面一定有什么特殊的魔法酱。

我没有对我的方法进行基准测试，但认为它相当快。它不使用`Regex`也不做任何字符串连接，而是使用 a`StringBuilder`来收集参数的字符并将它们放在一个列表中。

```
/// <summary>
/// Reads command line arguments from a single string.
/// </summary>
/// <param name="argsString">The string that contains the entire command line.</param>
/// <returns>An array of the parsed arguments.</returns>
public string[] ReadArgs(string argsString)
{
    // Collects the split argument strings
    List<string> args = new List<string>();
    // Builds the current argument
    var currentArg = new StringBuilder();
    // Indicates whether the last character was a backslash escape character
    bool escape = false;
    // Indicates whether we're in a quoted range
    bool inQuote = false;
    // Indicates whether there were quotes in the current arguments
    bool hadQuote = false;
    // Remembers the previous character
    char prevCh = '\0';
    // Iterate all characters from the input string
    for (int i = 0; i < argsString.Length; i++)
    {
        char ch = argsString[i];
        if (ch == '\\' && !escape)
        {
            // Beginning of a backslash-escape sequence
            escape = true;
        }
        else if (ch == '\\' && escape)
        {
            // Double backslash, keep one
            currentArg.Append(ch);
            escape = false;
        }
        else if (ch == '"' && !escape)
        {
            // Toggle quoted range
            inQuote = !inQuote;
            hadQuote = true;
            if (inQuote && prevCh == '"')
            {
                // Doubled quote within a quoted range is like escaping
                currentArg.Append(ch);
            }
        }
        else if (ch == '"' && escape)
        {
            // Backslash-escaped quote, keep it
            currentArg.Append(ch);
            escape = false;
        }
        else if (char.IsWhiteSpace(ch) && !inQuote)
        {
            if (escape)
            {
                // Add pending escape char
                currentArg.Append('\\');
                escape = false;
            }
            // Accept empty arguments only if they are quoted
            if (currentArg.Length > 0 || hadQuote)
            {
                args.Add(currentArg.ToString());
            }
            // Reset for next argument
            currentArg.Clear();
            hadQuote = false;
        }
        else
        {
            if (escape)
            {
                // Add pending escape char
                currentArg.Append('\\');
                escape = false;
            }
            // Copy character from input, no special meaning
            currentArg.Append(ch);
        }
        prevCh = ch;
    }
    // Save last argument
    if (currentArg.Length > 0 || hadQuote)
    {
        args.Add(currentArg.ToString());
    }
    return args.ToArray();
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-18T19:10:46.753

目前，这是我拥有的代码：

```
 private String[] SplitCommandLineArgument(String argumentString)
    {
        StringBuilder translatedArguments = new StringBuilder(argumentString);
        bool escaped = false;
        for (int i = 0; i < translatedArguments.Length; i++)
        {
            if (translatedArguments[i] == '"')
            {
                escaped = !escaped;
            }
            if (translatedArguments[i] == ' ' && !escaped)
            {
                translatedArguments[i] = '\n';
            }
        }

        string[] toReturn = translatedArguments.ToString().Split(new char[] { '\n' }, StringSplitOptions.RemoveEmptyEntries);
        for(int i = 0; i < toReturn.Length; i++)
        {
            toReturn[i] = RemoveMatchingQuotes(toReturn[i]);
        }
        return toReturn;
    }

    public static string RemoveMatchingQuotes(string stringToTrim)
    {
        int firstQuoteIndex = stringToTrim.IndexOf('"');
        int lastQuoteIndex = stringToTrim.LastIndexOf('"');
        while (firstQuoteIndex != lastQuoteIndex)
        {
            stringToTrim = stringToTrim.Remove(firstQuoteIndex, 1);
            stringToTrim = stringToTrim.Remove(lastQuoteIndex - 1, 1); //-1 because we've shifted the indicies left by one
            firstQuoteIndex = stringToTrim.IndexOf('"');
            lastQuoteIndex = stringToTrim.LastIndexOf('"');
        }
        return stringToTrim;
    } 
```

它不适用于转义引号，但它适用于我迄今为止遇到的情况。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-21T22:28:40.253

这是对 Anton 代码的回复，该代码不适用于转义引号。我修改了3个地方。

1.  *SplitCommandLineArguments*中*StringBuilder*的**构造函数**，将任何*\"*替换为*\r*
****   *在SplitCommandLineArguments*的**for 循环**中，我现在将*\r*字符替换回*\"*。****   将*SplitCommandLineArgument*方法从**private**更改为**public static**。******

 *** * *

```
public static string[] SplitCommandLineArgument( String argumentString )
{
    StringBuilder translatedArguments = new StringBuilder( argumentString ).Replace( "\\\"", "\r" );
    bool InsideQuote = false;
    for ( int i = 0; i < translatedArguments.Length; i++ )
    {
        if ( translatedArguments[i] == '"' )
        {
            InsideQuote = !InsideQuote;
        }
        if ( translatedArguments[i] == ' ' && !InsideQuote )
        {
            translatedArguments[i] = '\n';
        }
    }

    string[] toReturn = translatedArguments.ToString().Split( new char[] { '\n' }, StringSplitOptions.RemoveEmptyEntries );
    for ( int i = 0; i < toReturn.Length; i++ )
    {
        toReturn[i] = RemoveMatchingQuotes( toReturn[i] );
        toReturn[i] = toReturn[i].Replace( "\r", "\"" );
    }
    return toReturn;
}

public static string RemoveMatchingQuotes( string stringToTrim )
{
    int firstQuoteIndex = stringToTrim.IndexOf( '"' );
    int lastQuoteIndex = stringToTrim.LastIndexOf( '"' );
    while ( firstQuoteIndex != lastQuoteIndex )
    {
        stringToTrim = stringToTrim.Remove( firstQuoteIndex, 1 );
        stringToTrim = stringToTrim.Remove( lastQuoteIndex - 1, 1 ); //-1 because we've shifted the indicies left by one
        firstQuoteIndex = stringToTrim.IndexOf( '"' );
        lastQuoteIndex = stringToTrim.LastIndexOf( '"' );
    }
    return stringToTrim;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-04-26T10:53:25.770

你可以看看我昨天发布的代码：

*[[C#] 路径和参数字符串](http://social.msdn.microsoft.com/Forums/fr-FR/netfx64bit/thread/2dfe45f5-7940-48cd-bd57-add8f3d94102)*

它将文件名 + 参数拆分为字符串 []。处理短路径、环境变量和丢失的文件扩展名。

（最初是用于注册表中的 UninstallString。）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-07-24T23:46:07.370

试试这个代码：

```
 string[] str_para_linha_comando(string str, out int argumentos)
    {
        string[] linhaComando = new string[32];
        bool entre_aspas = false;
        int posicao_ponteiro = 0;
        int argc = 0;
        int inicio = 0;
        int fim = 0;
        string sub;

        for(int i = 0; i < str.Length;)
        {
            if (entre_aspas)
            {
                // Está entre aspas
                sub = str.Substring(inicio+1, fim - (inicio+1));
                linhaComando[argc - 1] = sub;

                posicao_ponteiro += ((fim - posicao_ponteiro)+1);
                entre_aspas = false;
                i = posicao_ponteiro;
            }
            else
            {
            tratar_aspas:
                if (str.ElementAt(i) == '\"')
                {
                    inicio = i;
                    fim = str.IndexOf('\"', inicio + 1);
                    entre_aspas = true;
                    argc++;
                }
                else
                {
                    // Se não for aspas, então ler até achar o primeiro espaço em branco
                    if (str.ElementAt(i) == ' ')
                    {
                        if (str.ElementAt(i + 1) == '\"')
                        {
                            i++;
                            goto tratar_aspas;
                        }

                        // Pular os espaços em branco adiconais
                        while(str.ElementAt(i) == ' ') i++;

                        argc++;
                        inicio = i;
                        fim = str.IndexOf(' ', inicio);
                        if (fim == -1) fim = str.Length;
                        sub = str.Substring(inicio, fim - inicio);
                        linhaComando[argc - 1] = sub;
                        posicao_ponteiro += (fim - posicao_ponteiro);

                        i = posicao_ponteiro;
                        if (posicao_ponteiro == str.Length) break;
                    }
                    else
                    {
                        argc++;
                        inicio = i;
                        fim = str.IndexOf(' ', inicio);
                        if (fim == -1) fim = str.Length;

                        sub = str.Substring(inicio, fim - inicio);
                        linhaComando[argc - 1] = sub;
                        posicao_ponteiro += fim - posicao_ponteiro;
                        i = posicao_ponteiro;
                        if (posicao_ponteiro == str.Length) break;
                    }
                }
            }
        }

        argumentos = argc;

        return linhaComando;
    } 
```

它是用葡萄牙语写的。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-04-07T23:15:51.513

这是完成工作的一条线（请参阅在 BurstCmdLineArgs(...) 方法中完成所有工作的一条线）。

不是我所说的最易读的代码行，但为了可读性，你可以把它分开。这很简单，并且不适用于所有参数情况（例如其中包含拆分字符串字符分隔符的文件名参数）。

该解决方案在我使用它的解决方案中运行良好。就像我说的那样，它可以在没有大量代码的情况下完成工作，以处理所有可能的参数格式 n 阶乘。

```
using System;
using System.Collections.Generic;
using System.Linq;

namespace CmdArgProcessor
{
    class Program
    {
        static void Main(string[] args)
        {
            // test switches and switches with values
            // -test1 1 -test2 2 -test3 -test4 -test5 5

            string dummyString = string.Empty;

            var argDict = BurstCmdLineArgs(args);

            Console.WriteLine("Value for switch = -test1: {0}", argDict["test1"]);
            Console.WriteLine("Value for switch = -test2: {0}", argDict["test2"]);
            Console.WriteLine("Switch -test3 is present? {0}", argDict.TryGetValue("test3", out dummyString));
            Console.WriteLine("Switch -test4 is present? {0}", argDict.TryGetValue("test4", out dummyString));
            Console.WriteLine("Value for switch = -test5: {0}", argDict["test5"]);

            // Console output:
            //
            // Value for switch = -test1: 1
            // Value for switch = -test2: 2
            // Switch -test3 is present? True
            // Switch -test4 is present? True
            // Value for switch = -test5: 5
        }

        public static Dictionary<string, string> BurstCmdLineArgs(string[] args)
        {
            var argDict = new Dictionary<string, string>();

            // Flatten the args in to a single string separated by a space.
            // Then split the args on the dash delimiter of a cmd line "switch".
            // E.g. -mySwitch myValue
            //  or -JustMySwitch (no value)
            //  where: all values must follow a switch.
            // Then loop through each string returned by the split operation.
            // If the string can be split again by a space character,
            // then the second string is a value to be paired with a switch,
            // otherwise, only the switch is added as a key with an empty string as the value.
            // Use dictionary indexer to retrieve values for cmd line switches.
            // Use Dictionary::ContainsKey(...) where only a switch is recorded as the key.
            string.Join(" ", args).Split('-').ToList().ForEach(s => argDict.Add(s.Split()[0], (s.Split().Count() > 1 ? s.Split()[1] : "")));

            return argDict;
        }
    }
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-12-28T14:00:57.410

我认为 C# 应用程序没有单引号或 ^ 引号。以下功能对我来说很好用：

```
public static IEnumerable<String> SplitArguments(string commandLine)
{
    Char quoteChar = '"';
    Char escapeChar = '\\';
    Boolean insideQuote = false;
    Boolean insideEscape = false;

    StringBuilder currentArg = new StringBuilder();

    // needed to keep "" as argument but drop whitespaces between arguments
    Int32 currentArgCharCount = 0;                  

    for (Int32 i = 0; i < commandLine.Length; i++)
    {
        Char c = commandLine[i];
        if (c == quoteChar)
        {
            currentArgCharCount++;

            if (insideEscape)
            {
                currentArg.Append(c);       // found \" -> add " to arg
                insideEscape = false;
            }
            else if (insideQuote)
            {
                insideQuote = false;        // quote ended
            }
            else
            {
                insideQuote = true;         // quote started
            }
        }
        else if (c == escapeChar)
        {
            currentArgCharCount++;

            if (insideEscape)   // found \\ -> add \\ (only \" will be ")
                currentArg.Append(escapeChar + escapeChar);       

            insideEscape = !insideEscape;
        }
        else if (Char.IsWhiteSpace(c))
        {
            if (insideQuote)
            {
                currentArgCharCount++;
                currentArg.Append(c);       // append whitespace inside quote
            }
            else
            {
                if (currentArgCharCount > 0)
                    yield return currentArg.ToString();

                currentArgCharCount = 0;
                currentArg.Clear();
            }
        }
        else
        {
            currentArgCharCount++;
            if (insideEscape)
            {
                // found non-escaping backslash -> add \ (only \" will be ")
                currentArg.Append(escapeChar);                       
                currentArgCharCount = 0;
                insideEscape = false;
            }
            currentArg.Append(c);
        }
    }

    if (currentArgCharCount > 0)
        yield return currentArg.ToString();
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-04-29T12:22:14.917

在这里找不到我喜欢的东西。我讨厌用一个小命令行的 yield 魔法来搞乱堆栈（如果它是一个 TB 的流，那就是另一回事了）。

这是我的看法，它支持带双引号的引号转义，如下所示：

> param="a 15"" 屏幕还不错" param2='a 15" 屏幕还不错' param3="" param4= /param5

结果：

> param="a 15" 屏幕还不错"
> 
> param2='15" 屏幕还不错'
> 
> 参数 3=""
> 
> 参数4=
> 
> /参数5

```
public static string[] SplitArguments(string commandLine)
{
    List<string> args         = new List<string>();
    List<char>   currentArg   = new List<char>();
    char?        quoteSection = null; // Keeps track of a quoted section (and the type of quote that was used to open it)
    char[]       quoteChars   = new[] {'\'', '\"'};
    char         previous     = ' '; // Used for escaping double quotes

    for (var index = 0; index < commandLine.Length; index++)
    {
        char c = commandLine[index];
        if (quoteChars.Contains(c))
        {
            if (previous == c) // Escape sequence detected
            {
                previous = ' '; // Prevent re-escaping
                if (!quoteSection.HasValue)
                {
                    quoteSection = c; // oops, we ended the quoted section prematurely
                    continue;         // don't add the 2nd quote (un-escape)
                }

                if (quoteSection.Value == c)
                    quoteSection = null; // appears to be an empty string (not an escape sequence)
            }
            else if (quoteSection.HasValue)
            {
                if (quoteSection == c)
                    quoteSection = null; // End quoted section
            }
            else
                quoteSection = c; // Start quoted section
        }
        else if (char.IsWhiteSpace(c))
        {
            if (!quoteSection.HasValue)
            {
                args.Add(new string(currentArg.ToArray()));
                currentArg.Clear();
                previous = c;
                continue;
            }
        }

        currentArg.Add(c);
        previous = c;
    }

    if (currentArg.Count > 0)
        args.Add(new string(currentArg.ToArray()));

    return args.ToArray();
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-10-04T09:28:30.440

我已经实现了状态机以具有相同的解析器结果，就好像 args 将被传递到 .NET 应用程序并在`static void Main(string[] args)`方法中处理一样。

```
 public static IList<string> ParseCommandLineArgsString(string commandLineArgsString)
    {
        List<string> args = new List<string>();

        commandLineArgsString = commandLineArgsString.Trim();
        if (commandLineArgsString.Length == 0)
            return args;

        int index = 0;
        while (index != commandLineArgsString.Length)
        {
            args.Add(ReadOneArgFromCommandLineArgsString(commandLineArgsString, ref index));
        }

        return args;
    }

    private static string ReadOneArgFromCommandLineArgsString(string line, ref int index)
    {
        if (index >= line.Length)
            return string.Empty;

        var sb = new StringBuilder(512);
        int state = 0;
        while (true)
        {
            char c = line[index];
            index++;
            switch (state)
            {
                case 0: //string outside quotation marks
                    if (c == '\\') //possible escaping character for quotation mark otherwise normal character
                    {
                        state = 1;
                    }
                    else if (c == '"') //opening quotation mark for string between quotation marks
                    {
                        state = 2;
                    }
                    else if (c == ' ') //closing arg
                    {
                        return sb.ToString();
                    }
                    else
                    {
                        sb.Append(c);
                    }

                    break;
                case 1: //possible escaping \ for quotation mark or normal character
                    if (c == '"') //If escaping quotation mark only quotation mark is added into result
                    {
                        state = 0;
                        sb.Append(c);
                    }
                    else // \ works as not-special character
                    {
                        state = 0;
                        sb.Append('\\');
                        index--;
                    }

                    break;
                case 2: //string between quotation marks
                    if (c == '"') //quotation mark in string between quotation marks can be escape mark for following quotation mark or can be ending quotation mark for string between quotation marks
                    {
                        state = 3;
                    }
                    else if (c == '\\') //escaping \ for possible following quotation mark otherwise normal character
                    {
                        state = 4;
                    }
                    else //text in quotation marks
                    {
                        sb.Append(c);
                    }

                    break;
                case 3: //quotation mark in string between quotation marks
                    if (c == '"') //Quotation mark after quotation mark - that means that this one is escaped and can added into result and we will stay in string between quotation marks state
                    {
                        state = 2;
                        sb.Append(c);
                    }
                    else //we had two consecutive quotation marks - this means empty string but the following chars (until space) will be part of same arg result as well
                    {
                        state = 0;
                        index--;
                    }

                    break;
                case 4: //possible escaping \ for quotation mark or normal character in string between quotation marks
                    if (c == '"') //If escaping quotation mark only quotation mark added into result
                    {
                        state = 2;
                        sb.Append(c);
                    }
                    else
                    {
                        state = 2;
                        sb.Append('\\');
                        index--;
                    }

                    break;
            }

            if (index == line.Length)
                return sb.ToString();
        }
    } 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-12-02T01:28:47.970

这是将空格（单个或多个空格）视为命令行参数分隔符并返回真正的命令行参数的解决方案：

```
static string[] ParseMultiSpacedArguments(string commandLine)
{
    var isLastCharSpace = false;
    char[] parmChars = commandLine.ToCharArray();
    bool inQuote = false;
    for (int index = 0; index < parmChars.Length; index++)
    {
        if (parmChars[index] == '"')
            inQuote = !inQuote;
        if (!inQuote && parmChars[index] == ' ' && !isLastCharSpace)
            parmChars[index] = '\n';

        isLastCharSpace = parmChars[index] == '\n' || parmChars[index] == ' ';
    }

    return (new string(parmChars)).Split('\n');
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-03-07T02:55:03.903

我写了一个方法来分离文件名和它的参数，使用`ProcessStartInfo`它需要分离文件名和参数字符串。

例如`"C:\Users\Me\Something.exe" -a` 会给出`{ "C:\Users\Me\Something.exe", "-a" }`结果

下面的代码：

```
 public static string[] SplitCommandFromArgs(string commandLine)
    {
        commandLine = commandLine.Trim();
        if (commandLine[0] == '"')
        {
            bool isEscaped = false;
            for (int c = 1; c < commandLine.Length; c++)
            {
                if (commandLine[c] == '"' && !isEscaped)
                {
                    return new string[] { commandLine.Substring(1, c - 1), commandLine.Substring(c + 1).Trim() };
                }
                isEscaped = commandLine[c] == '\\';
            }
        }
        else
        {
            for (int c = 1; c < commandLine.Length; c++) {
                if (commandLine[c] == ' ')
                {
                    return new string[] { commandLine.Substring(0, c), commandLine.Substring(c).Trim() };
                }
            }
        }
        return new string[] { commandLine, "" };
    } 
```

* * *

## 回答 #25

> 赞同：-2
> 
> 时间：2008-11-18T14:20:17.947

我不确定我是否理解您，但是用作分隔符的字符是否也可以在文本中找到？（除了它用双“？”转义）

如果是这样，我会创建一个`for`循环，并用 <|> （或另一个“安全”字符，但确保它只替换 <"> 而不是 <"">

在迭代字符串之后，我会像之前发布的那样，拆分字符串，但现在在字符 <|> 上。

* * *

## 回答 #26

> 赞同：-5
> 
> 时间：2008-11-18T14:14:05.853

是的，字符串对象有一个名为的内置函数`Split()`，该函数接受一个参数，指定要查找的字符作为分隔符，并返回一个字符串数组 (string[])，其中包含各个值。

# xml - 次要事件的 XML 序列化问题

> ID：298840
> 
> 赞同：1
> 
> 时间：2008-11-18T14:14:34.887
> 
> 标签：xml, xml-serialization

我有一个使用基于 Java 的 Web 服务的 .NET Web 应用程序。其中一个名为 Optional 的对象包含搜索条件字段。架构如下：

```
<xsd:complexType name="Optional">
 <xsd:sequence>
  <xsd:element name="FromAmount" nillable="true" type="xsd:float" minOccurs="0" /> 
  <xsd:element name="ToAmount" nillable="true" type="xsd:float" minOccurs="0" /> 
  <xsd:element name="FromDate" nillable="true" type="xsd:dateTime" minOccurs="0" /> 
  <xsd:element name="ToDate" nillable="true" type="xsd:dateTime" minOccurs="0" /> 
  <xsd:element name="FromCheckNumber" nillable="true" type="xsd:long" minOccurs="0" /> 
  <xsd:element name="ToCheckNumber" nillable="true" type="xsd:long" minOccurs="0" /> 
 </xsd:sequence>
</xsd:complexType> 
```

我遇到的问题是即使在 Web 应用程序中为它们分配了值，子元素也不会序列化。如果我删除 minOccurs 属性，那么一切都很好。

如何使这些元素成为可选元素，但在为其分配值时进行序列化？

在此先感谢您的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T19:26:13.880

在 .NET WS 中，对于在架构中标记为可选的不可空类型（在 .NET 中），会为它们生成一个额外的指定属性，用于控制元素是否出现。非常烦人的是，值的设置器没有设置额外的指定标志，所以你需要这样做。

```
x.ToAmmount = 24.0f;
x.ToAmmountSpecified = true;
// etc for the rest of the poperties 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-19T04:31:51.643

此模式未定义任何 xml 文档类型。它只是为名为“可选”的复合类型提供了一个声明，但没有从任何地方引用此类型。

正在定义的 xml 文档必须至少有一个顶部元素。这个顶级元素需要在某个地方（在全局范围内）定义。提供的架构中没有这样的定义。

xml 模式的一个最小示例，类似于提供的模式，但确实定义了一个 xml 文档，如下所示：

```
<?xml 版本="1.0" 编码="utf-8"?>
<xsd:模式
    elementFormDefault="合格"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
>
  <xsd:element name="可选" type="可选"/>
  <xsd:complexType name="可选">
    <xsd:序列>
      <xsd:element name="FromAmount" nillable="true" type="xsd:float" minOccurs="0" />
      <xsd:element name="ToAmount" nillable="true" type="xsd:float" minOccurs="0" />
      <xsd:element name="FromDate" nillable="true" type="xsd:dateTime" minOccurs="0" />
      <xsd:element name="ToDate" nillable="true" type="xsd:dateTime" minOccurs="0" />
      <xsd:element name="FromCheckNumber" nillable="true" type="xsd:long" minOccurs="0" />
      <xsd:element name="ToCheckNumber" nillable="true" type="xsd:long" minOccurs="0" />
    </xsd:sequence>
  </xsd:complexType>
</xsd:schema>
```

并且可以针对此架构成功验证的最简单的 xml 文档只是

    `<Optional/>`

（因为顶部元素的所有子元素都定义为可选）。

希望这有帮助。

干杯，

迪米特·诺瓦切夫

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T14:03:51.317

我的理解是，如果值不存在，nillable="true" 会在值 XML 中生成 xsi:nil="true"，这意味着始终创建元素，即使值为 null。

尝试删除 nillable 属性并保留 minOccurs="0"。虽然没试过。

# wix - 如何以编程方式读取 MSI 文件中的属性？

> ID：298841
> 
> 赞同：7
> 
> 时间：2008-11-18T14:14:55.213
> 
> 标签：wix, installation, windows-installer, dtf

有没有办法读取[MSI](https://en.wikipedia.org/wiki/Windows_Installer)文件中的属性？

例如，给定一个名为*Testpackage.msi*的 MSI 文件，我需要找到

```
productName
PackageCode
version 
```

我将在 WMI 卸载中使用它

```
string objPath = string.Format("Win32_Product.IdentifyingNumber='{0}', Name='{1}', Version='{2}'", "{AC9C1263-2BA8-4863-BE18-01232375CE42}", "testproduct", "10.0.0.0"); 
```

如果可以通过编程方式实现，使用[Orca是一个不错的选择。](http://msdn.microsoft.com/en-us/library/aa370557(v=vs.85).aspx)然后我可以使用它来生成自动发行说明。并且在卸载程序中也是如此。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-30T10:32:20.213

您可以使用[基于 COM 的 API 来处理 MSI](http://msdn.microsoft.com/en-us/library/aa367810(VS.85).aspx)，并执行类似的操作

```
Function GetVersion(ByVal msiName)

    Const msiOpenDatabaseModeReadOnly = 0
    Dim msi, db, view

    Set msi = CreateObject("WindowsInstaller.Installer")
    Set db = msi.OpenDataBase(msiName, msiOpenDatabaseModeReadOnly)
    Set view = db.OpenView("SELECT `Value` FROM `Property` WHERE `Property` = 'ProductVersion'")
    Call view.Execute()

    GetVersion = view.Fetch().StringData(1)

End Function 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-30T03:40:31.530

> ***WiX 工具集***： [***WiX 快速入门技巧***](https://stackoverflow.com/questions/25004226/msi-vs-nuget-packages-which-are-is-better-for-continuous-delivery/25005864#25005864)（资源链接的集合）。WiX 安装 DTF。

* * *

我只想提一下，现在事情变得更加容易了。**Windows Installer 对象模型有一个完整的 .NET 包装器，因此您可以避免任何 COM 互操作的笨拙**。

> ***DTF - 入门***：主文件：**`Microsoft.Deployment.WindowsInstaller.dll`**
> 
> 1.  [下载并安装 WiX 工具包](https://wixtoolset.org/releases/)
> 2.  **`WixInstallPath\SDK`**在目录中找到以下文件

包装器称为“**部署工具基础**”(DTF)，基本描述如下：“*部署工具基础是一组丰富的 .NET 类库和相关资源，它们将 Windows 部署平台技术带入 .NET 世界。它旨在大大简化与部署相关的开发任务，同时仍然公开底层技术的完整功能*”。

**这是一个精简的动手示例**：

```
using (var db = new Database(FullPath, DatabaseOpenMode.ReadOnly))
{    
  PackageCode = db.SummaryInfo.RevisionNumber;
  AppVendor = db.SummaryInfo.Author;
  AppName = db.SummaryInfo.Title;
  ProductName = db.SummaryInfo.Subject;
  ProductCode = (string)db.ExecuteScalar("SELECT `Value` FROM "+
                 "`Property` WHERE `Property` = 'ProductCode'");
  AppVersion = (string)db.ExecuteScalar("SELECT `Value` FROM "+
                 "`Property` WHERE `Property` = 'ProductVersion'");
  UpgradeCode = (string)db.ExecuteScalar("SELECT `Value` FROM "+
                 " `Property` WHERE `Property` = 'UpgradeCode'");
} 
```

**主要 DTF 文件**（后两个是最常用的）：

*   **Microsoft.Deployment.Compression.dll** - 用于归档打包和解包的框架。
*   **Microsoft.Deployment.Compression.Cab.dll** - 实现文件柜归档打包和解包。
*   **Microsoft.Deployment.Resources.dll** - 用于在可执行文件中读取和写入资源数据的类。
*   **Microsoft.Deployment.WindowsInstaller.dll** - 完整的基于 .NET 的 Windows Installer API 类库。
*   **Microsoft.Deployment.WindowsInstaller.Package.dll** - 用于处理 Windows Installer 安装和补丁包的扩展类。

只需创建一个 C# 项目，引用这些文件，并使用您想要和需要的任何控件编写您自己的部署应用程序。目前我还没有设置 DTF 工具，但请参阅[**此示例**](https://stackoverflow.com/a/12494760/129130)以大致了解 C# 程序如何工作。

*   DTF 包含在 WIX 中。[**从这里下载 WiX**](http://wixtoolset.org/)。
*   DTF dll 位于主 WiX 安装文件夹的 SDK 文件夹中（默认位置为：%ProgramFiles(x86)%\WiX Toolset v3.10\SDK）。当您看到此内容时，版本号可能会有所不同。只需在 %ProgramFiles(x86)% 下查找 WiX 文件夹。
*   在“doc”文件夹中查找**DTF 帮助文件。****DTF.chm**和**DTFAPI.chm**。对象模型及其用法的绝对优秀文档。
*   有关更多 DTF 详细信息，请参阅[**此 serverfault.com 帖子**](https://serverfault.com/a/596519/20599)
*   [使用 WiX 的一些入门建议](https://stackoverflow.com/questions/25004226/msi-vs-nuget-packages-which-are-is-better-for-continuous-delivery/25005864#25005864)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-18T14:23:14.713

您可以使用[Microsoft 的 Orca.exe](http://msdn.microsoft.com/en-us/library/aa370557.aspx)。Orca 将允许您打开 MSI 并编辑/查看其中的所有表格。您必须下载整个[Windows SDK](http://msdn.microsoft.com/en-us/library/aa370834(VS.85).aspx)才能获得它，但幸运的是它是免费的。

一种替代方法（由于 SDK 的下载大小可能会更快）是使用来自[WiX 项目](http://wix.sourceforge.net/)的 dark.exe 。Dark 是一个 MSI 反编译器，它将所有内容导出到 XML 文件和资源集合中。它输出的 XML 将包含您要查找的信息。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-30T13:00:39.237

这是 VBScript 中的一个类似示例，我将其用作创建引导程序可执行文件的构建过程的一部分...

```
Option Explicit
Const MY_MSI = "product.msi"

Dim installer, database, view, result, sumInfo, sPackageCode

Set installer = CreateObject("WindowsInstaller.Installer")
Set database = installer.OpenDatabase (MY_MSI, 0)

Set sumInfo = installer.SummaryInformation(MY_MSI, 0)
sPackageCode =  sumInfo.Property(9) ' PID_REVNUMBER = 9, contains the package code.

WScript.Echo "ProductVersion=" & getproperty("ProductVersion")
WScript.Echo "ProductCode=" & getproperty("ProductCode") 
WScript.Echo "PackageCode=" & sPackageCode 
WScript.Echo "ProductName=" & getproperty("ProductName") 

Function getproperty(property)

    Set view = database.OpenView ("SELECT Value FROM Property WHERE Property='" & property & "'")
    view.Execute
    Set result = view.Fetch
    getproperty = result.StringData(1)

End Function 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-02T22:33:28.050

[我在lessmsi](http://code.google.com/p/lessmsi/)中找到了一个轻量级的非编程解决方案。它显然使用 wix 并将整个 .msi 分解到指定的文件夹中。（它也有一个用户界面，但它在 Win7 上对我来说不是很好）。

# c# - 来自 C# 类的 JavaScript 警报

> ID：298850
> 
> 赞同：0
> 
> 时间：2008-11-18T14:19:14.080
> 
> 标签：c#, asp.net, javascript

我有一个 5 ASPX 页面`wizard`。每个都包含一个`SaveAndExit`按钮，用于在公共静态类上执行 C# 函数。保存后，C# 代码重定向到另一个页面。

有没有办法`javascript: alert('Data Saved');` 在保存之后和加载新页面之前运行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T14:22:34.883

您必须在回发时注册一个启动脚本才能发出警报。然后在警报后通过 javascript 重定向。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T14:35:52.393

你不能完全按照你的意愿去做。

在页面已经回发并从浏览器卸载之前，C# 代码（服务器端）无法运行。因此，当您的服务器端代码运行时，就浏览器而言，页面甚至不再存在，运行您的 javascript 代码为时已晚。即使在回发的中间也是如此，即使回发的结果将是同一页。这就是为什么在某些情况下，ASP.Net 页面在回发期间会出现闪烁。

因此，如果不通过某种 ajax 回调进行保存，就不能在保存数据后强制发出 javascript 警报——这当然是一种选择。另一种选择是让您重定向到的页面在某些情况下显示某种“数据已保存”消息；使用简单的东西来触发它，例如会话变量或加载时隐藏输入的值，因此对用户来说并不明显。

但我认为最好的办法可能就是什么都不做。听起来如果保存失败，您将不会重定向。您甚至可能会显示某种错误。如果您的用户对您的应用没有足够的信心，以至于即使没有错误消息并且将其移至下一步，他们也不信任它，那么您就有麻烦了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T17:23:12.057

维克，除非这是一个家庭作业，否则我强烈建议你不要这样做。

正如 Joel Coehoorn 所解释的那样，JavaScript 警报对大多数用户来说非常烦人，在这种情况下似乎完全没用。

`if`如果您坚持在保存时显示一条消息，那么考虑添加一个会话变量并在重定向页面上显示会话变量顶部的“数据已保存”消息，`exist`然后删除会话变量。

不过，正如 Joel Coehoorn 所说，如果出现错误，您绝对应该显示一条消息，但重定向应该是他们需要保存数据的所有“证据”。

# asp.net-membership - 运行 aspnet_regsql.exe 后，我必须用数据初始化数据库吗？如何？

> ID：298856
> 
> 赞同：2
> 
> 时间：2008-11-18T14:21:29.553
> 
> 标签：asp.net-membership

我运行 aspnet_regsql.exe 来设置 .net 成员表等。

我要运行什么来创建我的应用程序，以便我可以添加用户等？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T14:28:52.283

在您的 Visual Studio 中，转到“网站 -> ASP.NET 配置”，然后将启动一个 Web 应用程序。在那里你可以添加用户等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T14:28:16.573

您可以以编程方式执行此操作。ScottGu 有一篇关于这个主题的好博文（带有可下载的示例代码[）](http://weblogs.asp.net/scottgu/archive/2005/10/18/427754.aspx)。

# java - 是否有易于集成的基于 java 的论坛软件可用

> ID：298864
> 
> 赞同：3
> 
> 时间：2008-11-18T14:23:39.640
> 
> 标签：java, forum

通过 Hibernate、Acegi、Spring、Tiles 集成将是极好的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T20:58:28.503

我喜欢[JForum](http://jforum.net/)请参阅[功能列表](http://jforum.net/features.jsp)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T15:48:11.203

你可以使用[JavaBB](http://www.javabb.org/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-27T07:39:12.587

只需将它们进行比较[JavaBB vs JForum vs MVN Forum vs Yazd](http://www.forum-software.org/forum-comparator/javabb-vs-jforum-vs-mvn-forum-vs-yazd)。

但是，我个人的选择是[JForum](http://www.forum-software.org/jforum/review)，它的功能要强大得多。

# c# - Outlook/Exchange - 如何以编程方式导出分发列表中的用户？

> ID：298867
> 
> 赞同：2
> 
> 时间：2008-11-18T14:25:04.850
> 
> 标签：c#, email, outlook, exchange-server, office-automation

如何使用代码从 Outlook 中的通讯组列表中导出所有姓名和电子邮件地址？我可以访问 Outlook 2000 或 Outlook 2007 客户端。理想情况下，我希望代码在 C# 中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T15:20:40.463

我知道您询问了 c#，但来自 [http://www.microsoft.com/technet/scriptcenter/resources/officetips/may05/tips0524.mspx](http://www.microsoft.com/technet/scriptcenter/resources/officetips/may05/tips0524.mspx)的以下脚本可能有一些用处。

```
Const olFolderContacts = 10

Set objOutlook = CreateObject("Outlook.Application")
Set objNamespace = objOutlook.GetNamespace("MAPI")

Set colContacts = objNamespace.GetDefaultFolder(olFolderContacts).Items
intCount = colContacts.Count

For i = 1 To intCount
    If TypeName(colContacts.Item(i)) = "DistListItem" Then
        Set objDistList = colContacts.Item(i)
        Wscript.Echo objDistList.DLName
        For j = 1 To objDistList.MemberCount
    Wscript.Echo objDistList.GetMember(j).Name & " -- " & _
               objDistList.GetMember(j).Address
        Next 
        Wscript.Echo
    End If
Next 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-18T14:30:32.933

使用 Outlook 组件模型 [http://www.dotnetjunkies.ddj.com/Tutorial/2E1EEEAF-C78A-4A38-A830-AC204B12DF83.dcik](http://www.dotnetjunkies.ddj.com/Tutorial/2E1EEEAF-C78A-4A38-A830-AC204B12DF83.dcik)

# c# - 综合安全

> ID：298872
> 
> 赞同：2
> 
> 时间：2008-11-18T14:26:30.167
> 
> 标签：c#, remoting, windows-authentication

是否有一种托管代码（不添加 COM 组件或包装调用 C++ 例程）的方式来向 C# 托管代码程序集添加集成安全性？

即我想编写一个客户端-服务器系统，其中服务器使用 Remoting 而不是 IIS，但我希望客户端自动将其凭据传递给服务器，就像浏览器在与启用了集成安全性的 IIS 服务器通信时所做的那样。 .

这可以做到吗？如果是这样，哪里有一些例子？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T15:24:59.330

[否 - SSPI](http://msdn.microsoft.com/en-us/library/aa380493(VS.85).aspx)没有纯托管接口。但是，有一个 MSDN 示例[为您包装 SSPI](http://msdn.microsoft.com/en-us/library/ms973911.aspx)，然后[使用包装器进行远程处理](http://msdn.microsoft.com/en-us/library/ms973909.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-28T12:21:39.303

.NET 2 具有 NegotiateStream，TCP 远程处理使用它来提供 SSPI。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-28T13:21:39.947

有 WCF 和所有 .net 库供您实现类似的东西。我用过这样的东西

[http://www.theproblemsolver.nl/usingthemembershipproviderinwinforms.htm](http://www.theproblemsolver.nl/usingthemembershipproviderinwinforms.htm)

对于服务器部分

[http://weblogs.asp.net/dwahlin/archive/2007/02/03/video-creating-a-service-with-windows-communication-service-wcf.aspx](http://weblogs.asp.net/dwahlin/archive/2007/02/03/video-creating-a-service-with-windows-communication-service-wcf.aspx)

这两个步骤很好地开始了自己实施的安全集成。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-18T14:39:58.063

当您说“远程而不是 IIS”时，您究竟是什么意思？远程端点（服务器端）通常托管在 IIS 中，因为这可以免费为您提供很多东西，例如身份验证、通过负载平衡进行扩展 - 特别是对于单调用类型的对象 - 也就是说，您不想保持状态用于对端点的连续调用。

您可以在客户端应用程序中使用 http 堆栈托管远程端点，也可以在 xp/sp2 中以及直接使用 http.sys 驱动程序（顺便说一句，它会自动为您处理）。

无论如何，对于使用 NTLM 凭据的自动登录，我建议您在 IIS 中托管远程处理，并使用 System.Net.CredentialCache.DefaultCredentials 作为您的客户端应用程序的客户端凭据。这会将上下文凭据传递给服务器应用程序，假设当前安全区域（intranet/internet/trusted/etc）允许它。

-Oisin

# java - 如何使用 Java 检测同步违规

> ID：298873
> 
> 赞同：9
> 
> 时间：2008-11-18T14:26:37.140
> 
> 标签：java, multithreading, synchronization, error-detection

我想知道有什么好的方法可以断言同步或其他东西，以便我可以检测同步违规（在测试时）。

例如，这将用于我有一个不是线程安全的类并且不会是线程安全的类的情况。以某种方式，如果从多个线程调用它的某些方法，我会有一些断言会通知我（日志或其他东西）。

我渴望可以为 AWT 调度线程制作类似的东西，如下所示：

```
public static void checkDispatchThread() {
    if(!SwingUtilities.isEventDispatchThread()) {
        throw new RuntimeException("GUI change made outside AWT dispatch thread");
    }
} 
```

我只想要更一般的东西。问题描述不是很清楚，但我希望有人有一些好的方法=）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T14:37:40.173

你在寻找圣杯，我想。AFAIK 它不存在，Java 不是一种允许轻松创建这种方法的语言。

“Java Concurrency in Practice”有一节是关于测试线程问题的。它特别注意做起来有多难。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T14:41:24.910

当 Java 中的线程出现问题时，它通常与死锁检测有关，而不仅仅是监视哪些线程同时访问同步部分。[从 1.5 开始添加到 JRE 的JMX](http://java.sun.com/javase/technologies/core/mntr-mgmt/javamanagement/)扩展可以帮助您检测这些死锁。事实上，我们在我们自己的软件中使用 JMX 来自动检测死锁并跟踪发现死锁的位置。

这是有关如何使用它的[示例。](http://www.javaspecialists.co.za/archive/Issue093.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T19:27:29.403

[IntelliJ IDEA](http://www.jetbrains.com/idea/index.html)有很多有用的并发[检查](http://www.jetbrains.com/idea/documentation/inspections.jsp)。例如，当您从同步和非同步上下文访问同一个对象时，当您在非最终对象上同步时，它会向您发出警告等等。

同样，[FindBugs](http://findbugs.sourceforge.net/)也有许多类似的[检查](http://findbugs.sourceforge.net/bugDescriptions.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T14:56:49.637

除了@Fernando 提到的线程死锁之外，多线程的另一个问题是并发修改及其可能导致的问题。

Java 在内部做的一件事是集合类记录它被更新的次数。然后迭代器检查每个 .next() 上的值与创建交互器时的值，以查看在迭代时集合是否已更新。我认为这个原则可以更普遍地使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T15:13:40.337

试试[ConTest](http://www.ibm.com/developerworks/java/library/j-contest.html)或[Covertity](http://www.coverity.com/html/coverity-thread-analyzer-java.html)

这两个工具都会分析代码以确定哪些部分数据可能在线程之间共享，然后它们检测代码（向已编译的类添加额外的字节码）以检查当两个线程尝试同时更改某些数据时它是否中断. 然后这两个线程一遍又一遍地运行，每次都以稍微不同的时间偏移量启动它们，以获得许多可能的访问模式组合。

另外，检查这个问题：[单元测试多线程应用程序？](https://stackoverflow.com/questions/111676/unit-testing-a-multithreaded-application)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-18T15:59:24.173

您可能对 Peter Veentjer 在博客中提到的一种方法感兴趣，他称之为[并发检测器](http://pveentjer.wordpress.com/2008/05/26/the-concurrency-detector/)。我不相信他已经开源了这个，但正如他所描述的那样，基本思想是使用 AOP 来检测您对分析感兴趣的代码，并记录哪个线程已经触及了哪个字段。之后是手动或自动解析生成的日志的问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-18T16:00:42.253

如果您可以识别线程不安全的类，静态分析可能会告诉您它们是否曾经“逃逸”以对多个线程可见。通常情况下，程序员会在头脑中这样做，但显然他们在这方面容易出错。一个工具应该能够使用类似的方法。

也就是说，从您描述的用例来看，这听起来像记住一个线程并对其进行断言这样简单的事情可能足以满足您的需求。

```
class Foo {

  private final Thread owner = Thread.currentThread();

  void x() {
    assert Thread.currentThread() == owner;
    /* Implement method. */
  }

} 
```

即使断言被禁用，所有者引用仍然被填充，因此它不是完全“免费”的。我也不想用这个样板把我的许多课程弄得乱七八糟。

Thread.holdsLock [(Object)](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.html#holdsLock(java.lang.Object))方法也可能对您有用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-18T14:33:54.207

对于您给出的具体示例，SwingLabs 有一些帮助代码来检测事件线程违规和挂起。 [https://swinghelper.dev.java.net/](https://swinghelper.dev.java.net/)

不久前，我使用了 JProbe java 分析工具。他们的工具之一（threadalyzer？）寻找线程同步违规。查看他们的网页，我没有看到同名的工具或我记得的工具。但你可能想看看。 [http://www.quest.com/jprobe/performance-home.aspx](http://www.quest.com/jprobe/performance-home.aspx)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-11-18T15:44:43.533

您可以使用[Netbeans 分析器](http://profiler.netbeans.org/)或[JConsole](http://java.sun.com/developer/technicalArticles/J2SE/jconsole.html)深入检查线程状态

# debugging - 如何逐步完成 foreach 循环任务？

> ID：298884
> 
> 赞同：0
> 
> 时间：2008-11-18T14:30:06.710
> 
> 标签：debugging, ssis

在 SSIS 中，如何在调试中逐步执行 foreach 循环以单独查看其中的每个步骤？我添加了断点，但它们似乎并没有在调试中中断？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-24T08:32:20.160

我会将 OnPreExecute 断点添加到 foreach 循环内的第一个任务。

# .net - 连接到 POP3 服务器

> ID：298886
> 
> 赞同：2
> 
> 时间：2008-11-18T14:30:44.650
> 
> 标签：.net, pop3

.NET 是否有办法从 POP3 服务器中提取电子邮件，或者您必须编写/购买第 3 方组件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T18:12:11.497

您可以查看[Mail.dll .NET 邮件组件](http://www.limilabs.com/mail)，它具有 SSL 支持、unicode 和多国电子邮件支持：

```
using(Pop3 pop3 = new Pop3())
{
    pop3.Connect("mail.host.com");      // Connect to server
    pop3.Login("user", "password");

    foreach(string uid in pop3.GetAll())
    {
        IMail email = new MailBuilder()
            .CreateFromEml(pop3.GetMessageByUID(uid));
          Console.WriteLine( email.Subject );
    }
    pop3.Close(false);      
} 
```

您可以在此处下载：[http](http://www.limilabs.com/mail) ://www.limlabs.com/mail 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T14:37:47.710

3rd 方组件是必经之路；比使用 NetStreams 发送原始 POP3 命令的替代方法要好得多 [颤抖]

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-01T15:51:23.940

.NET 框架不支持 POP3。

连接到 POP3 服务器是一项简单的工作。该协议非常简单。问题是正确解析消息。您将需要一个体面的 MIME 或 S/MIME 解析器，它可以处理 unicode、vierd 格式的附件、Outlook 生成的非标准 WinMail.dat 中的邮件正文、国际化问题。一个可以修复常见邮件客户端错误和 RFC 违规等的解析器。有相当多的第三方 POP3 库。[在 codeproject 上](http://www.codeproject.com/KB/IP/despop3client.aspx)也有一些免费的POP3 库。

你可以试试我们的[Rebex POP3 for .NET](http://www.rebex.net/secure-mail.net/)

```
// create client, connect and log in  
Pop3 client = new Pop3();
client.Connect("pop3.example.org");
client.Login("username", "password");

// get message list - full headers  
Pop3MessageCollection messages = client.GetMessageList(Pop3ListFields.FullHeaders);

// display info about each message  
Console.WriteLine("UID | From | To | Subject");
foreach (Pop3MessageInfo message in messages)
{
    Console.WriteLine
    (
        "{0} | {1} | {2} | {3}",
        message.UniqueId,
        message.From,
        message.To,
        message.Subject
    );
}

client.Disconnect(); 
```

代码取自[www.rebex.net/secure-mail.net/tutorial-pop3.aspx](http://www.rebex.net/secure-mail.net/tutorial-pop3.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T14:34:24.470

查看[Quiksoft](http://www.quiksoft.com)的 EasyMail 对象。它们非常易于使用，并且支持非常好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T14:55:29.063

我个人喜欢[serverintellect 组件](http://www.aspnetpop3.com/)。

# asp.net - 使用 ASP.NET Mobile 有什么真正的理由吗？

> ID：298897
> 
> 赞同：3
> 
> 时间：2008-11-18T14:34:53.080
> 
> 标签：asp.net, mobile-website

我一直在整理一个小型网络表单，供我们的技术人员在现场通过手机使用。但是，我在使用 ASP.NET Mobile 进行工作时遇到了很多麻烦，而且似乎很少有资源可以帮助学习这些东西。我也很难[获得帮助](https://stackoverflow.com/questions/291638/how-do-you-get-the-value-of-a-bound-mobilelistitem "获得帮助")。

所以问题是，我真的需要使用移动控件吗？这些手机都会有网络浏览器，所以我在想，如果我对界面小心，我可以获得与使用移动控件一样好的或更好的结果。

我唯一想要的移动控件是 PhoneCall 控件......所以后续问题是：我可以在不使用 PhoneCall 控件的情况下获得它的功能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T20:25:48.953

取决于您的客户将使用哪些手机。并非所有手机都支持由经典 ASP.NET 控件生成的完整且丰富的 HTML。移动控件倾向于为设备生成更简单和特定的内容。当然，控件存在限制，但这是由于终端设备的限制。

因此，在执行移动版本之前，请测试经典的 ASP.NET 页面是否适用于您的目标设备。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T12:59:53.767

您始终可以在需要时导航到具有这些电话控件的页面

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T16:19:36.147

使用移动控件具有与 Web 中的 Web 控件相同的优点。使用 Mobile Controls + Controls Adapters + WURFL 有助于对许多设备进行非常快速的开发。

是的，您可以使用 WML 的 WTAI 原语：`<a ref="wtai://wp/mc;34123456789">Call</a>`

# java - Java 断言未得到充分利用

> ID：298909
> 
> 赞同：67
> 
> 时间：2008-11-18T14:38:50.093
> 
> 标签：java, assertion

我想知道为什么这个`assert`关键字在 Java 中没有得到充分利用？我几乎从未见过它们被使用过，但我认为它们是个好主意。我当然更喜欢简洁：

```
assert param != null : "Param cannot be null"; 
```

详细程度：

```
if (param == null) {
    throw new IllegalArgumentException("Param cannot be null");
} 
```

我怀疑它们没有得到充分利用，因为

*   他们来得比较晚（Java 1.4），那时很多人已经建立了他们的 Java 编程风格/习惯
*   它们在运行时默认关闭

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-11-18T14:45:16.243

*理论上，断言*是用于测试[不变量](http://en.wikipedia.org/wiki/Invariant_(computer_science))的假设，这些假设**必须**为真，才能使代码正确完成。

显示的示例是测试有效输入，这不是断言的典型用法，因为它通常是用户提供的。

断言通常不用于生产代码，因为存在开销，并且假设在开发和测试期间不变量失败的情况已被捕获为编码错误。

你关于他们“迟到”到java的观点也是他们没有被更广泛地看到的一个原因。

此外，单元测试框架允许将编程断言的某些需求置于被测试代码的外部。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2008-11-18T15:03:12.587

使用断言来测试用户输入是滥用断言。抛出一个`IllegalArgumentException`无效输入更正确，因为它允许调用方法捕获异常，显示错误，并做它需要做的任何事情（再次请求输入，退出等等）。

如果该方法是您的一个类中的私有方法，则断言很好，因为您只是想确保您不会不小心将空参数传递给它。您使用断言进行测试，并且当您测试了所有通过的路径并且没有触发断言时，您可以将它们关闭，这样您就不会在它们上浪费资源。它们也像注释一样有用。方法的`assert`开头是维护人员的良好文档，说明他们应该遵循某些先决条件，而`assert`结尾的后置条件则记录了该方法应该做什么。它们和评论一样有用；此外，因为有了断言，他们实际上测试了他们记录的内容。

断言用于测试/调试，而不是错误检查，这就是它们默认关闭的原因：阻止人们使用断言来验证用户输入。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-11-18T15:01:32.590

从[使用断言编程](http://java.sun.com/j2se/1.4.2/docs/guide/lang/assert.html#enable-disable)

> 默认情况下，断言在运行时被禁用。两个命令行开关允许您有选择地启用或禁用断言。

这意味着，如果您无法完全控制运行时环境，您甚至无法保证断言代码会被调用。断言旨在用于测试环境，而不是用于生产代码。您不能用断言替换异常处理，因为如果用户在禁用断言（*默认*）的情况下运行您的应用程序，您的所有错误处理代码都会消失。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-11-18T18:21:25.667

在*“Effective Java”*中，Joshua Bloch 建议（在“检查参数的有效性”主题中）（有点像采用的简单规则），对于公共方法，我们将验证参数并在发现无效时抛出必要的异常，对于非公共方法（未公开，您作为它们的用户应该确保它们的有效性），我们可以使用断言来代替。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-20T13:14:05.060

@Don，您对默认情况下关闭断言感到沮丧。我也是，因此编写了这个内联它们的小 javac 插件（即发出字节码`if (!expr) throw Ex`而不是这个愚蠢的断言字节码。

如果在编译 Java 代码时在类路径中包含[fa.jar](http://smallwiki.unibe.ch/adriankuhn/javacompiler/forceassertions/)，它会发挥它的魔力，然后告诉

```
Note: %n assertions inlined. 
```

@see [http://smallwiki.unibe.ch/adriankuhn/javacompiler/forceassertions](http://smallwiki.unibe.ch/adriankuhn/javacompiler/forceassertions/)或者在 github [https://github.com/akuhn/javac](https://github.com/akuhn/javac)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-11-09T13:40:50.203

我不确定您为什么要费心编写断言然后用标准的 if then 条件语句替换它们，为什么不首先将条件编写为 ifs 呢？

断言仅用于测试，它们有两个副作用：启用时更大的二进制文件和性能下降（这就是你可以关闭它们的原因！）

不应使用断言来验证条件，因为这意味着在启用/禁用断言时，您的应用程序的行为在运行时会有所不同——这是一场噩梦！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-07-29T08:12:43.420

断言很有用，因为它们：

*   尽早发现编程错误
*   使用代码的文档代码

将它们视为代码自我验证。如果它们失败了，则意味着您的程序已损坏并且必须停止。在单元测试时始终打开它们！

在[The Pragmatic Programmer](http://en.wikipedia.org/wiki/The_Pragmatic_Programmer)中，他们甚至建议让它们在生产环境中运行。

> 打开断言
> 
> 使用断言来防止不可能的事情。

请注意，如果断言失败，则断言会抛出 AssertionError，因此不会被 catch Exception 捕获。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-02-20T03:25:26.777

# tl;博士

*   **是的，在有意义**的生产环境中使用断言测试。****
***   如果您愿意，可以使用其他库（[*JUnit*](https://en.wikipedia.org/wiki/JUnit)、[*AssertJ*](http://joel-costigliola.github.io/assertj/)、[*Hamcrest*](https://en.wikipedia.org/wiki/Hamcrest)等）而不是内置工具。`assert`**

 **此页面上的大多数其他答案都推动了格言“断言通常不用于生产代码”。虽然在诸如文字处理器或电子表格之类的生产力应用程序中是正确的，但在 Java 如此常用的自定义业务应用程序中，断言 -生产中的测试非常有用，而且很常见。

就像编程世界中的许多格言一样，在一种情况下开始正确的东西会被误解，然后在其他情况下被误用。

# 生产力应用

“断言通常不用于生产代码”这句格言虽然很常见，但却是不正确的。

形式化的断言测试起源于诸如[Microsoft Word](https://en.wikipedia.org/wiki/Microsoft_Word)之类的文字处理器或[Microsoft Excel](https://en.wikipedia.org/wiki/Microsoft_Excel)之类的电子表格之类的应用程序。*这些应用程序可能会在用户每次击键*时调用一系列断言测试断言。这种*极端的*重复严重影响了性能。因此，只有在有限分发中的此类产品的 beta 版本才启用断言。因此格言。

# 商业应用

相比之下，在面向业务的数据输入、数据库或其他数据处理应用程序中，在生产环境中使用断言测试非常有用。对性能的微不足道的影响使它非常实用 - 并且很常见。

## 测试业务规则

在生产运行时验证您的业务规则是完全合理的，应该受到鼓励。例如：

*   如果发票必须始终具有一个或多个行项目，则编写一个断言测试，而不是发票行项目的计数大于零。
*   如果产品名称必须至少包含 3 个字符或更多字符，请编写一个测试字符串长度的断言。
*   在计算现金分类帐的余额时，您知道结果永远不会是负数，因此请检查是否存在负数，表明数据或代码存在缺陷。

此类测试对生产性能没有显着影响。

## 运行时条件

如果您的应用程序期望某些条件在您的应用程序在生产中运行时始终为真，请将这些期望作为断言测试写入您的代码中。

如果您期望这些条件有时会合理地失败，那么不要*编写*断言测试。也许抛出某些异常。然后在可能的情况下尝试恢复。

## 健全性检查

在生产运行时进行[健全性检查也是完全合理的，应该受到鼓励。](https://en.wikipedia.org/wiki/Sanity_check#Software_development)当一些奇怪的事情发生时，测试一些人们无法想象是不真实的任意条件已经在无数情况下拯救了我的培根。

[例如，在某个库中测试将镍 (0.05) 四舍五入导致镍 (0.05) 有助于我成为第一批发现 Apple 在其Rosetta](https://en.wikipedia.org/wiki/Rosetta_(software))库中发布的浮点技术缺陷的人之一。PowerPC 到 Intel 的过渡。这样的缺陷传播到公众似乎是不可能的。但令人惊讶的是，该漏洞并未引起原始供应商 Transitive 和 Apple 以及对 Apple 测试版进行测试的早期开发人员的注意。

（顺便说一句，我应该提一下......永远不要使用[浮点数来赚钱](https://en.wikipedia.org/wiki/Floating-point_arithmetic#Accuracy_problems)，使用[`BigDecimal`](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/math/BigDecimal.html)。）

## 框架的选择

`assert`您可能需要考虑使用另一个断言框架，而不是使用内置工具。您有多种选择，包括：

*   [*JUnit*](https://en.wikipedia.org/wiki/JUnit)
    请参阅：[`org.junit.jupiter.api.Assertions`](https://junit.org/junit5/docs/current/api/org/junit/jupiter/api/Assertions.html).
*   [*AssertJ*](http://joel-costigliola.github.io/assertj/)
    以其流畅[流畅的界面](https://en.wikipedia.org/wiki/Fluent_interface)而闻名。
*   [*Hamcrest*](https://en.wikipedia.org/wiki/Hamcrest)
    用于多种语言（Java、Python、Ruby、Swift 等）。

或者自己动手。制作一个小类以在您的项目中使用。像这样的东西。

```
package work.basil.example;

public class Assertions {
    static public void assertTrue ( Boolean booleanExpression , CharSequence message ) throws java.lang.AssertionError {
        if ( booleanExpression ) {
            // No code needed here.
        } else { // If booleanExpression is false rather than expected true, throw assertion error.
            // FIXME: Add logging.
            throw new java.lang.AssertionError( message.toString() );
        }
    }

} 
```

示例用法：

```
Assertions.assertTrue( 
    localTime.isBefore( LocalTime.NOON ) , 
    "The time-of-day is too late, after noon: " + localTime + ". Message # 816a2a26-2b95-45fa-9b0a-5d10884d819d." 
) ; 
```

# 你的问题

> 他们来得比较晚（Java 1.4），那时很多人已经建立了他们的 Java 编程风格/习惯

是的，这是完全正确的。许多人对 Sun/JCP 为断言测试开发的 API 感到失望。与现有图书馆相比，它的设计乏善可陈。如此多的人忽略了新的 API，并坚持使用已知的工具（第 3 方工具或滚动您自己的迷你库）。

> 默认情况下，它们在运行时关闭，WHY OH WHY??

在最早的几年里，Java 因性能速度差而受到诟病。具有讽刺意味的是，[Java 迅速发展](https://en.wikipedia.org/wiki/HotSpot)成为性能最佳的平台之一。但糟糕的说唱就像一股臭味。因此，Sun 对任何可能以任何可衡量的方式影响性能的事情都非常警惕。因此，从这个角度来看，将禁用断言测试设为默认值是有意义的。

另一个默认禁用的原因可能与 Sun 在添加新的断言工具时劫持了单词`assert`. 这*不是*以前保留的关键字，并且需要对 Java 语言进行的少数更改之一。该方法名称`assert`已被许多库和许多开发人员在他们自己的代码中使用。有关此历史转变的一些讨论，请阅读此旧文档[*Programming With Assertions*](https://docs.oracle.com/javase/7/docs/technotes/guides/language/assert.html)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-18T14:57:00.977

断言非常有限：您只能测试布尔条件，并且每次都需要编写代码以获得有用的错误消息。将此与 JUnit 的 assertEquals() 进行比较，后者允许从输入生成有用的错误消息，甚至在 JUnit 运行器中的 IDE 中并排显示两个输入。

此外，您无法在我迄今为止看到的任何 IDE 中搜索断言，但每个 IDE 都可以搜索方法调用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-18T14:44:23.030

事实上，它们是在 Java 1.4 中出现的。

我认为主要问题是，当您在不直接管理 JVM 选项的环境中编码时，例如在[Eclipse](https://en.wikipedia.org/wiki/Eclipse_%28software%29)或 J2EE 服务器中（在这两种情况下都可以更改 JVM 选项，但您需要深入搜索以找到它可以做到），更容易（我的意思是它需要更少的努力）使用`if`和异常（或者更糟糕的是不使用任何东西）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-04-06T17:28:23.867

正如其他人所说：断言不适合验证用户输入。

如果您担心冗长，我建议您查看我编写的库：[https](https://github.com/cowwoc/requirements.java/) ://github.com/cowwoc/requirements.java/ 。它允许您使用很少的代码来表达这些检查，它甚至会代表您生成错误消息：

```
requireThat("name", value).isNotNull(); 
```

如果你坚持使用断言，你也可以这样做：

```
assertThat("name", value).isNotNull(); 
```

输出将如下所示：

```
java.lang.NullPointerException: name may not be null 
```

# performance - 提高 Sharepoint 2007 性能的最佳方法？

> ID：298917
> 
> 赞同：4
> 
> 时间：2008-11-18T14:40:10.607
> 
> 标签：performance, sharepoint, moss, vmware

好的，我们已经走到了尽头，我非常感谢来自 SO 社区的反馈。

我们的基本问题是基于 MOSS 的 Intranet 性能缓慢——

一些环境信息：

我们有一个基于协作的站点的 MOSS 标准版本。

*   站点数据库为 29 Gb
*   我们有两个基于 VMWare 的前端服务器。（每个 2 个 32 位 CPU）
*   不到 1000 个用户分布在所有时区
*   我们有一个带有子网站的大型网站集。

**一般症状：** 加载首页和已“预热”的页面相当不错 - 但人迹罕至的页面/站点加载速度非常慢。

我们看到峰值，一个页面突然需要 30 秒才能加载，而更正常的 2

这是我们已经完成的工作：

*   在爬行时按比例缩小
*   启用对象和 blob 缓存
*   优化的 VMware 设置
*   遵循关于 MOSS 共享点最佳实践的 Microsoft IT 白皮书（尤其是列表大小等）

我不知道这里还能做什么 - 拆分为多个网站集？

切换到 64 位前端服务器？

很高兴听到其他处于类似情况的人的来信。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T14:44:58.320

你没有说你的前端服务器有多少内存——考虑到它们是 32 位的，我假设每个工作进程的最大值约为 2gb + 变化。

我的建议？切换到 64 位，添加更多内存，并检查每个前端是否只使用一个 w3wp 工作进程。深入了解“网络花园”，也就是说，您在每个前端配置多个 w3wp 进程的位置。首先，从每个前端的两个工作进程开始，看看效果如何。还要确保它们被设置为回收，并且每对工作进程的回收不重叠 - 拥有两个以上的工作人员意味着他们可以轮流回收而不切断访问权限。

只是我的 0.02。

-Oisin

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T16:03:18.100

我认为您的首要任务是确定问题实际出在哪里 - 直到您知道您正在浪费时间更改事物。

*   数据库服务器是在单独的服务器上还是在您的 Web 服务器上？

*   您是否在前端或数据库服务器上看到 CPU/磁盘瓶颈？

*   这听起来像你的世界。您是否从靠近服务器的网络中看到相同的性能问题 - 是 WAN 问题吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T16:36:24.850

感谢大家提供一些有用的建议，我刚刚学到的一件事是我们的对象缓存基本上没有做任何事情！这是因为它的工作方式似乎是，如果您有权在网站集的任何位置进行编辑，则默认情况下会禁用跨门户的对象缓存。由于所有用户都至少拥有某些权限，这意味着缓存基本上什么都不做！

我们通过启用缓存调试发现了这一点，它在 html 中添加了一个关于正在使用的缓存的小注释。在经过身份验证的缓存配置文件中更改设置“允许作者查看缓存的内容”后，

我们正在看到这对编辑有什么影响，但对于普通观众来说，轶事证据表明它正在产生巨大的影响！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-19T21:57:26.260

是的，缓存是减少系统负载的最佳方式。向 SQL 服务器添加 RAM 也很好。（对于您的 SQL 服务器来说，64 位确实是必须的，WFE 并不那么重要）。

不确定您是否要回收这些流程。我没有证据证明这一点，除了与某人的谈话说回收过程看起来已经解决了一个性能问题，但正在介绍其他问题。

我提到缓存了吗？

SQL 服务器应处理高达 100Gb 的数据库，但在这种大小下，它们将难以管理以进行备份等，因此您现在可能需要计划将您的站点拆分为相关的站点集合，但这可能不相关性能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T15:50:33.663

您是否看过[规划软件边界 (Office SharePoint Server)](http://technet.microsoft.com/en-us/library/cc262787.aspx)？

乍一看，您的服务器*符合*他们推荐的设置。

为了提高性能，您应该看看：

*   64 位服务器
*   限制文档列表中显示的项目数量 [（来源：][[microsoft.com](http://i.technet.microsoft.com/Cc262787.1951d88d-7814-41a2-97fc-65e6fab351f7(en-us,TechNet.10).gif)][）][![限制显示的项目数量](https://i.stack.imgur.com/cBHT1.gif)](https://i.stack.imgur.com/cBHT1.gif)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T01:50:49.863

一定要检查磁盘使用情况。如果您有两个虚拟机并且它们运行相同的磁盘/SAN，请确保它不太忙。过载的 SAN 会降低性能

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-20T04:21:50.510

我会把我的帽子扔进戒指并推荐64位。也许不是立即修复，但展望未来，我会将迁移到 64 位作为您整个农场的目标。

我也会对 Nat 的评论提出一些问题，即在 Web 前端并不重要。我不会争论基准或争论内存可寻址性。它真的比这更简单。

Microsoft 已公开表示 2007 是最后一个将在 32 位服务器上运行的 SharePoint 版本。向前发展 64 位将成为一项要求 - 所以就像 FRAM 机油滤清器的人所说 - “现在付钱给我，或者以后付钱给我”......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-30T12:22:11.733

我们也有性能问题。我们在 win 2008 64bit 女巫上升级了一些差异，但没有预期的那么多。

bih 的提升让我们从 NTLM 认证更改为 Kerberos。这是我们的重大改进。

希望这对某人有帮助

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-03-09T19:47:53.880

我运行了一个非常相似的设置，但是我们有超过 400GB 的空间分布在 3 个网站集上。在进入 64 位路径之前，您还可以尝试其他一些事情。

*   确保数据库服务器和 Web 前端之间没有磁盘或带宽问题。数据库服务器的网络速度至关重要。
*   检查数据库服务器本身，如果磁盘在 SAN 上，如果 SAN 上的物理驱动器存在争用，则可能会出现性能问题。RAM 也很重要，它可以缓存到内存的越多，等待磁盘响应的时间就越少。
*   安排爬网作业在正常工作时间之外运行
*   您已经启用了对象缓存，这可能会有很大帮助，请确保也启用了压缩！对于较低带宽的用户，sharepoint 会向用户发送大量 CSS 信息，如果启用压缩，这些信息会压缩到其大小的 1/10。
*   这是另一个大问题，确保您公司的 DNS 在其他位置正常工作，并检查此问题是否与外部来源有关。IE 我们有一个 sonicwall 防火墙，它对通过它连接的办公室的响应时间非常苛刻。
*   Micrsoft 有一份关于性能计数器监控的白皮书。它非常彻底，将帮助您缩小 CPU/RAM/网络/HD IO 之间的问题。

希望这可以帮助！

# .net - .aspx 页面后面代码的自定义命名空间

> ID：298920
> 
> 赞同：3
> 
> 时间：2008-11-18T14:41:15.487
> 
> 标签：.net, .net-2.0, namespaces

我正在使用.NET2.0。假设一个带有 txtInput 和 btnSomeAction 的简单 aspx 表单

```
 <asp:TextBox ID="txtInput" runat="server"></asp:TextBox>
   <asp:Button ID="btnSomeAction" runat="server" CommandName="SomeAction" Text="Do"/> 
```

然后在我的表格后面的代码中

```
Protected Sub btnSomeAction_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnSomeAction.Click
    Dim s As String
    s = txtInput.Text
End Sub 
```

一切正常。

然后我想将代码添加到自定义命名空间，如

```
Namespace mycustomnamespace 
```

这样做时，我会得到一个编译器错误：

***名称 'txtInput' 未声明*** - 好像代码不再连接到页面

我需要修改 aspx 页面以包含命名空间吗？部分类呢？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-18T14:44:09.147

> 我需要修改 aspx 页面以包含命名空间吗？部分类呢？

是的。在您的 aspx 文件的顶部，您应该会看到类似

> ```
> <%@ Page AutoEventWireup="false" Inherits="Blah.Foo.Bar" %> 
> ```

其中 bar 是代码隐藏中类的名称，而 Blah.Foo 是它的命名空间。您需要将其更改为

> ```
> <%@ Page AutoEventWireup="false" Inherits="mycustomnamespace.Bar" %> 
> ```

# database - NHibernate IInterceptor 实现（将属性添加到原始域类没有的数据库表）

> ID：298921
> 
> 赞同：5
> 
> 时间：2008-11-18T14:41:17.593
> 
> 标签：database, nhibernate, iinterceptor

当通过 NHibernate 更新/插入实体而不扩展具有特殊属性的域类时，如何设置一些特殊的列值？

例如：在我的情况下，我想获取对象，并在更新/插入数据库之前使用 IInterceptor 向该对象添加一些附加信息（如用户 ID 或计算机名称）。换句话说，我想在数据库表中添加几列而不在原始对象的类中指定新属性。在这种情况下，我是否必须配置/更改/添加到我的`Object.hbm.xml`或 App.config 中？

问题是我无法更改我的原始对象和基类。所以我必须弄清楚是否可以在不更改原始对象的情况下向 DB 表添加信息（甚至没有从任何基类继承）

例子：

原始对象有：`FirstName ,LastName,Birthday,Address properties`

`Customer.hbm.xml`有：

```
<property name="FirstName" column="FirstName" type="string" not-null="true" length="64" />
<property name="LastName" column="LastName" type="string" not-null="true" length="64" />
<property name="Birthday" column="Birthday" type="DateTime" not-null="true"  />
<property name="Address" column="Address" type="string" not-null="true"  /> 
```

我的拦截器类有方法：

```
public bool OnSave(object entity, object id, object[] state, string[] propertyNames, NHibernate.Type.IType[] types) 
```

在那一刻，甚至可能在保存之前，我必须在 DB Customer 表中添加额外的 2 列（例如计算机名和用户名），`propertyNames[]`并且`state[]`参数从一开始就没有它们，所以应该即时完成。

MY DB Customer 表包含我上面描述的所有列。

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-01-16T00:15:09.997

我还没有尝试过，但是您应该能够在创建工厂之前将动态属性添加到配置中。然后你可以在你的拦截器中填充这些值。

例如，从 config.ClassMappings 中检索相关的 PersistentClass，然后将您的属性添加到其中。

```
private void AddProperty(
        PersistentClass pc, 
        string propertyName, 
        string columnName, 
        IType dataType)
    {
        SimpleValue val = new SimpleValue(pc.Table);
        Column col = new Column(dataType, 0);
        col.Name = columnName;
        val.AddColumn(col);
        val.Type = dataType;
        Property prop = new Property(val);
        prop.IsUpdateable = true;
        prop.Name = propertyName;
        prop.PropertyAccessorName = "nosetter.camelcase";
        prop.Cascade = "none";
        pc.AddNewProperty(prop);
    } 
```

# .net - 哈希表如何绑定到下拉列表？

> ID：298926
> 
> 赞同：3
> 
> 时间：2008-11-18T14:43:22.237
> 
> 标签：.net, vb.net, data-binding, drop-down-menu, hashtable

在 vb.net / winforms 中，如何将哈希表绑定到下拉列表或任何其他数据源驱动的控件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-18T14:46:16.040

只需使用下拉列表的 Datasource 属性

```
 DropDownList dd = new DropDownList();
   Hashtable mycountries = New Hashtable();
   mycountries.Add("N","Norway");
   mycountries.Add("S","Sweden");
   mycountries.Add("F","France");
   mycountries.Add("I","Italy");
   dd.DataSource=mycountries;
   dd.DataValueField="Key";
   dd.DataTextField="Value";
   dd.DataBind(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-18T15:08:05.713

这是winforms、wpf还是asp.net？[更新：啊……winforms ;-p]

winforms 希望 data 是`IList`（或间接地 via `IListSource`） - 所以我猜测（从评论中）你正在使用 winforms。内置的类字典集合都没有实现`IList`，但老实说，这并不重要：如果您是数据绑定，则体积可能相当小，因此常规列表应该没问题。

最好的选择是类似于`List<T>`or的东西`BindingList<T>`，其中`T`包含您要绑定的所有属性。这是一个选项吗？如果您坚持使用 1.1（因为您提到`HashTable`而不是`Dictionary<,>`），请使用`ArrayList`.

示例（在 C# 中）：

```
class MyData
{
    public int Key { get; set; }
    public string Text { get; set; }
}
[STAThread]
static void Main()
{
    var data = new List<MyData>
    {
        new MyData { Key = 1, Text = "abc"},
        new MyData { Key = 2, Text = "def"},
        new MyData { Key = 3, Text = "ghi"},
    };
    ComboBox cbo = new ComboBox
    {
            DataSource = data,
            DisplayMember = "Text",
            ValueMember = "Key"
    };
    cbo.SelectedValueChanged += delegate {
        Debug.WriteLine(cbo.SelectedValue);
    };
    Application.Run(new Form {Controls = {cbo}});
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-22T18:34:28.590

名为 Order 的给定对象的示例：

```
List<Order> list = new List<Order>{};

foreach (Order o in OOS.AppVars.FinalizedOrders.Values)
{
  list.Add(o);
}

this.comboBox_Orders.DataSource = list;
this.comboBox_Orders.DisplayMember = "Description"; 
```

这很酷的是，您可以将数据作为原始对象从列表中取回（而不仅仅是 asp.net 中的值字段）。

```
Order order = (Order)this.comboBox_Orders.SelectedValue; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-18T14:49:05.003

```
myCtrl.DataSource = myHashtable
myCtrl.DataBind() 
```

可绑定控件的示例源：

```
<itemtemplate>
    <%# DataBinder.Eval(Container.DataItem, "Key", "<td>{0}</td>") %>
    <%# DataBinder.Eval(Container.DataItem, "Value", "<td>${0:f2}</td>") %>
</itemtemplate> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-13T15:56:20.643

而且，如果您碰巧使用 Dictionary 作为数据源，您可以使用

```
MyDDL.Datasouce = myDict.ToList(); 
```

它会将其转换为列表类型。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-09-14T11:58:57.353

使用 .tolist。它也适用于您从实体框架中的视图/存储过程中获得的返回复杂类型

# mshtml - 将焦点设置到嵌入式 MSHTML

> ID：298932
> 
> 赞同：3
> 
> 时间：2008-11-18T14:45:11.593
> 
> 标签：mshtml

在我的应用程序中，我有一个嵌入式 MSHTML 控件。问题是我无法将焦点设置在此控件上。我可以单击、选择、按下按钮等，但结果是它不接受键盘输入和鼠标滚轮通知。即使左键单击控件也不会设置焦点。（这个问题与[这个问题有关。](https://stackoverflow.com/questions/296548/embedded-mshtml-mouse-wheel-ignored)）

最终，我尝试了 4 种方法。（为简洁起见，此处省略了错误处理。）首先是向控件发送 WM_SETFOCUS。

```
HWND iehwnd = ::FindWindowEx (m_oleObjectHWND, NULL, 
     L"Shell DocObject View", NULL);
if(iehwnd != NULL)
{
    iehwnd = ::FindWindowEx (iehwnd, NULL, L"Internet Explorer_Server", NULL);
    if(iehwnd != NULL)
    {
        ::PostMessage(iehwnd, WM_SETFOCUS, (WPARAM)GetHWND(), NULL);
    }
} 
```

使用 Winspector，我确保消息通过控件的窗口，但它似乎忽略了它们。

二是调用IHtmlWindow2的focus()方法。

```
 IHTMLDocument2* pHTMLDoc2 = NULL;
    m_webBrowser->get_Document((IDispatch**)&pHTMLDoc2);

    IHTMLWindow2* pWindow = 0;
    pHTMLDoc2->get_parentWindow(&pWindow);
    pWindow->focus(); 
```

这一次，我从 focus() 得到 E_FAIL。

MSDN 说，当文档尚未加载时，调用可能会失败，但 pHTMLDoc2->get_readyState() 返回“完成”。所以事实并非如此。

第三个是做 UIACTIVATE 动词。

```
 hret = m_oleObject->DoVerb(OLEIVERB_UIACTIVATE, NULL, 
        clientSite, 0, (HWND)GetHWND(), &posRect); 
```

这似乎一无所获。

第四种是调用IHtmlDocument4 的focus()。

```
 IDispatch* pdisp = NULL;
    m_webBrowser->get_Document((IDispatch**)&pdisp);

    IHTMLDocument4* pHTMLDoc4 = NULL;
    pdisp->QueryInterface(IID_IHTMLDocument4, (void**)(&pHTMLDoc4));

    pHTMLDoc4->focus(); 
```

什么也没做。

我已经花了一整天的时间，现在已经牢记谷歌的链接 :) 希望专家的提示。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-09-24T13:45:40.180

终于找到了。

我的代码中的这个函数（或者更确切地说是 wxWidgets 库的 IEHtmlWin 组件）返回 S_FALSE。我将返回码更改为 S_OK - 瞧……

HRESULT FS_IOleInPlaceSiteWindowless::RequestUIActivate() { return S_OK; }

# vb6 - 如何让非管理员用户从 VB6 ActiveX Exe 实例化对象？

> ID：298952
> 
> 赞同：0
> 
> 时间：2008-11-18T14:54:12.137
> 
> 标签：vb6, permissions, dcom, activex-exe

问题真的说明了一切......

我尝试更改属性页上的“允许非管理员用户运行此程序”设置，并且还为有问题的非管理员用户提供了组件服务-> DCOM 配置中的正确权限。

还有什么我可以做的吗？

这是在 Server2003 顺便说一句。

谢谢

马特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T02:39:29.593

[http://support.microsoft.com/kb/183607](http://support.microsoft.com/kb/183607)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T18:07:09.457

几天前我看到了你的问题，但没有回答，因为我只有一些东西让你尝试。我希望其他有知识的人回答，但由于你仍然没有答案，我会告诉你我知道的一点点。当我们的技术支持部门将我们的应用程序安装到运行 XP 或 Vista 的计算机上时，他们第一次运行应用程序时会使用管理员帐户登录。显然，这使得 ActiveX DLL 需要发生的任何事情都可以正常工作。之后，用户可以使用他们的常规帐户登录，并且该应用程序仍然很开心。

# linq - LINQ To SQL 实体对象作为域对象

> ID：298962
> 
> 赞同：11
> 
> 时间：2008-11-18T14:58:30.647
> 
> 标签：linq, linq-to-sql, dns, data-access

显然，关注点分离是我们代码中的一个理想特征，大多数人采取的第一个明显步骤是将数据访问与表示分离。在我的情况下，LINQ To SQL 正在数据访问对象中用于数据访问。

我的问题是，实体对象的使用应该在哪里停止？澄清一下，我可以将实体对象传递到域层，但我觉得实体对象不仅仅是一个数据对象——这就像将一些 DAL 传递到下一层一样。

假设我有一个 UserDAL 类，它应该在调用 GetByID() 方法时将实体 User 对象暴露给域，还是应该吐出一个纯数据对象，纯粹用于存储数据，仅此而已？（在这种情况下似乎是浪费的重复）

在同样的情况下，你们做了什么？有替代方法吗？

希望这不是太模糊。

非常感谢，

马丁。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-18T15:12:00.200

我从我的 DAL（使用 LINQ2SQL）返回 POCO 的 IQueryable，因此没有 Linq 实体对象离开 DAL。这些 POCO 返回到服务和 UI 层，也用于将数据传回 DAL 进行处理。Linq 处理得很好：

```
 IQueryable<MyObjects.Product> products = from p in linqDataContext.Products 
                                          select new MyObjects.Product //POCO
                                          {
                                              ProductID = p.ProductID
                                          };
 return products; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-24T14:58:13.203

对于大多数项目，我们使用 LINQ to SQL 实体作为我们的业务对象。

LINQ to SQL 设计器允许您控制它生成的类和属性的可访问性，因此您可以限制对任何允许消费者违反业务规则的访问，并提供合适的公共替代方案（尊重业务规则）部分类。

MSDN上甚至还有一篇关于以这种方式[实现业务逻辑的文章。](http://msdn.microsoft.com/en-us/library/bb882671.aspx)

这使您免于编写*大量*繁琐的样板代码，如果您想从 Web 服务返回它们，您甚至可以[使您的实体可序列化。](http://msdn.microsoft.com/en-us/library/bb546185.aspx)

是否为业务逻辑创建单独的层实际上取决于项目的大小（较大的项目通常在业务逻辑和数据访问层之间具有更大的变化）。

我相信 LINQ to Entities 试图通过维护两个独立的模型（业务逻辑的[概念架构](http://msdn.microsoft.com/en-us/library/bb399292.aspx)和数据访问的[存储架构](http://msdn.microsoft.com/en-us/library/bb399559.aspx)）来为这个难题提供一站式解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-18T15:13:38.353

我个人不喜欢我的实体跨层传播。我的 DAL 返回 POCO（当然，这通常意味着额外的工作，但我发现这更干净 - 也许在下一个 .NET 版本中这会更简单;-)）。

这个问题并不那么简单，对这个主题有很多不同的想法（我一直问自己和你一样的问题）。

也许您可以看一下[MVC Storefront 示例应用程序](http://www.codeplex.com/mvcsamples)：我喜欢这个概念的本质（尤其是在数据层中发生的映射）。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T15:16:20.767

[这里](https://stackoverflow.com/questions/222895/can-linq-to-sql-generated-objects-be-decoupled#229905)有一个类似的帖子，但是，我看到你的问题更多的是关于你应该做什么，而不是你应该怎么做。

在小型应用程序中，我发现第二个 POCO 实现很浪费，在大型应用程序（特别是那些实现 Web 服务的应用程序）中，POCO 对象（通常是数据传输对象）很有用。

如果您的应用属于后一种情况，您可能需要查看[ADO.Net Data Services](http://msdn.microsoft.com/en-us/data/bb931106.aspx)。

希望有帮助！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-24T15:10:33.320

实际上，我也为此苦苦挣扎。使用普通的 LINQ to SQL，我很快放弃了 DBML 工具，因为它将实体紧密地绑定到 DAL。我一直在争取更高水平的持久性无知，尽管微软并没有让它变得很容易。

我最终做的是通过让 DAL 从我的 POCO 继承来手写持久性无知层。继承的对象暴露了它继承的 POCO 的相同属性，因此在持久性无知层内，我可以使用属性映射到对象。然后被调用者可以将继承的对象转换回其基本类型，或者让 DAL 为它们执行此操作。我更喜欢后一种情况，因为它减少了需要完成的铸造量。诚然，这主要是只读实现，因此我将不得不重新访问它以应对更复杂的更新场景。

为此手动编码的数量相当大，因为除了对象继承和映射之外，我还必须手动维护（在编码之后，开始）每个数据源的上下文和提供程序。如果该项目被弃用，我肯定会转向更强大的解决方案。

期待 Entity Framework，根据 EF 团队的设计博客，持久性无知是一个普遍要求的功能。同时，如果您决定走 EF 路线，您可以随时查看预先推出的持久性无知工具（例如 MSDN 上的[EFPocoAdapter](http://code.msdn.microsoft.com/EFPocoAdapter)项目）来提供帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T19:42:38.107

我使用了一个基于我在 Internet 上找到的自定义 LinqToSQL 生成器来代替默认的 MSLinqToSQLGenerator。为了使我的上层独立于此类 Linq 对象，我创建接口来表示它们中的每一个，然后在这些层中使用此类接口。例子：

```
 public interface IConcept {
    long Code { get; set; }
    string Name { get; set; }
    bool IsDefault { get; set; }
} 
```

```
 public partial class Concept : IConcept { } 
```

```
 [Table(Name="dbo.Concepts")]
public partial class Concept
{
    private long _Code;
    private string _Name;
    private bool _IsDefault;
    partial void OnCreated();
    public Concept() { OnCreated(); }
    [Column(Storage="_Code", DbType="BigInt NOT NULL IDENTITY", IsPrimaryKey=true)]
    public long Code
    {
             //***
    }
    [Column(Storage="_Name", DbType="VarChar(50) NOT NULL")]
    public string Name
    {
             //***
    }
    [Column(Storage="_IsDefault", DbType="Bit NOT NULL")]
    public bool IsDefault
    {
             //***
    }
} 
```

当然还有更多的东西，但这就是想法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-26T19:50:12.520

请记住，Linq to SQL 不是一项前瞻性技术。它已经发布，玩起来很有趣，但微软并没有把它带到任何地方。我有一种感觉，它也不会永远被支持。看看 Microsoft 的实体框架 (EF)，它结合了一些 Linq to SQL 的优点。

# sql - 查询不同表中的数据

> ID：298972
> 
> 赞同：0
> 
> 时间：2008-11-18T15:02:44.553
> 
> 标签：sql, postgresql

我在我的 postgres 数据库上使用这样的查询：

```
SELECT TableA.id FROM TableA , TableB WHERE TableA.id = 100; 
```

每个 TableA.id 都是唯一的（它是一个自动增量），我得到的结果不止一个。我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-18T15:05:13.550

您需要加入：

```
SELECT TableA.ID from TableA
INNER JOIN TableB 
ON TableB.TableAID = TableA.ID 
WHERE TableA.ID = 100 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-18T15:04:55.017

您正在执行交叉连接 - 有效地将 TableB 中的每一行与 TableA 中的单行相对。如果您也从 TableB 中选择了一些东西，这将更加明显:) 您当前没有从 TableB 中选择任何东西的事实并不能阻止 (TableA, TableB) 对在投影之前成为连接的结果.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-18T15:05:53.377

您从 中获取一行，`TableA`但从`TableB`. 也许你的意思是：

```
SELECT TableA.id FROM TableA, TableB WHERE TableA.id=TableB.id AND TableA.id = 100 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T15:05:17.827

TableA和TableB之间的关系是什么？

你可能需要做这样的事情

其中 TableA.id = 100 和 TableB.TableA_Id = TableA.id

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T16:34:43.183

您需要在 where 子句之前加入：

```
INNER JOIN TableB ON TableA.Id = TableB.Id 
```

# c# - 有没有比这更好的选择来“打开类型”？

> ID：298976
> 
> 赞同：371
> 
> 时间：2008-11-18T15:04:04.660
> 
> 标签：c#, switch-statement, system.type

看到 C# 不能`switch`在类型上使用（我认为没有将其添加为特例，因为`is`关系意味着可能应用多个不同`case`的类型），除此之外还有更好的方法来模拟打开类型吗？

```
void Foo(object o)
{
    if (o is A)
    {
        ((A)o).Hop();
    }
    else if (o is B)
    {
        ((B)o).Skip();
    }
    else
    {
        throw new ArgumentException("Unexpected type: " + o.GetType());
    }
} 
```

* * *

## 回答 #1

> 赞同：365
> 
> 时间：2008-11-18T15:08:41.907

[使用 Visual Studio 2017 (Release 15.*) 附带的 C# 7](https://blogs.msdn.microsoft.com/dotnet/2016/08/24/whats-new-in-csharp-7-0/)，您可以在`case`语句中使用类型（模式匹配）：

```
switch(shape)
{
    case Circle c:
        WriteLine($"circle with radius {c.Radius}");
        break;
    case Rectangle s when (s.Length == s.Height):
        WriteLine($"{s.Length} x {s.Height} square");
        break;
    case Rectangle r:
        WriteLine($"{r.Length} x {r.Height} rectangle");
        break;
    default:
        WriteLine("<unknown shape>");
        break;
    case null:
        throw new ArgumentNullException(nameof(shape));
} 
```

使用 C# 6，您可以使用带有[nameof() 运算符](https://msdn.microsoft.com/en-us/library/dn986596.aspx)的 switch 语句（感谢@Joey Adams）：

```
switch(o.GetType().Name) {
    case nameof(AType):
        break;
    case nameof(BType):
        break;
} 
```

对于 C# 5 及更早版本，您可以使用 switch 语句，但您必须使用包含类型名称的魔术字符串......这不是特别友好的重构（感谢@nukefusion）

```
switch(o.GetType().Name) {
  case "AType":
    break;
} 
```

* * *

## 回答 #2

> 赞同：286
> 
> 时间：2008-11-18T15:44:53.563

C# 中肯定缺少切换类型（**更新：在 C#7 / VS 2017 中支持切换类型 -[请参阅 Zachary Yates 的回答](https://stackoverflow.com/questions/298976/is-there-a-better-alternative-than-this-to-switch-on-type/299001#299001)**）。为了在没有大型 if/else if/else 语句的情况下执行此操作，您需要使用不同的结构。不久前我写了一篇博文，详细介绍了如何构建 TypeSwitch 结构。

[https://docs.microsoft.com/archive/blogs/jaredpar/switching-on-types](https://docs.microsoft.com/archive/blogs/jaredpar/switching-on-types)

短版：TypeSwitch 旨在防止冗余转换并提供类似于普通 switch/case 语句的语法。例如，这是 TypeSwitch 在标准 Windows 窗体事件中的作用

```
TypeSwitch.Do(
    sender,
    TypeSwitch.Case<Button>(() => textBox1.Text = "Hit a Button"),
    TypeSwitch.Case<CheckBox>(x => textBox1.Text = "Checkbox is " + x.Checked),
    TypeSwitch.Default(() => textBox1.Text = "Not sure what is hovered over")); 
```

TypeSwitch 的代码实际上非常小，可以很容易地放入您的项目中。

```
static class TypeSwitch {
    public class CaseInfo {
        public bool IsDefault { get; set; }
        public Type Target { get; set; }
        public Action<object> Action { get; set; }
    }

    public static void Do(object source, params CaseInfo[] cases) {
        var type = source.GetType();
        foreach (var entry in cases) {
            if (entry.IsDefault || entry.Target.IsAssignableFrom(type)) {
                entry.Action(source);
                break;
            }
        }
    }

    public static CaseInfo Case<T>(Action action) {
        return new CaseInfo() {
            Action = x => action(),
            Target = typeof(T)
        };
    }

    public static CaseInfo Case<T>(Action<T> action) {
        return new CaseInfo() {
            Action = (x) => action((T)x),
            Target = typeof(T)
        };
    }

    public static CaseInfo Default(Action action) {
        return new CaseInfo() {
            Action = x => action(),
            IsDefault = true
        };
    }
} 
```

* * *

## 回答 #3

> 赞同：103
> 
> 时间：2008-11-18T15:07:42.143

一种选择是有一本 from `Type`to `Action`（或其他一些代表）的字典。根据类型查找动作，然后执行。我以前在工厂里用过这个。

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2012-04-05T08:46:31.337

有了[JaredPar 的回答](https://stackoverflow.com/a/299120/146622)，[我写](https://web.archive.org/web/20130824123510/http://blog.16tonweight.com/index.php/2012/04/05/c-sharp-switching-on-types/)了一个他的类的变体，`TypeSwitch`它使用类型推断来获得更好的语法：

```
class A { string Name { get; } }
class B : A { string LongName { get; } }
class C : A { string FullName { get; } }
class X { public string ToString(IFormatProvider provider); }
class Y { public string GetIdentifier(); }

public string GetName(object value)
{
    string name = null;
    TypeSwitch.On(value)
        .Case((C x) => name = x.FullName)
        .Case((B x) => name = x.LongName)
        .Case((A x) => name = x.Name)
        .Case((X x) => name = x.ToString(CultureInfo.CurrentCulture))
        .Case((Y x) => name = x.GetIdentifier())
        .Default((x) => name = x.ToString());
    return name;
} 
```

请注意，`Case()`方法的顺序很重要。

* * *

[获取我的`TypeSwitch`课程](https://gist.github.com/Virtlink/8722649)的完整和注释代码。这是一个工作的缩写版本：

```
public static class TypeSwitch
{
    public static Switch<TSource> On<TSource>(TSource value)
    {
        return new Switch<TSource>(value);
    }

    public sealed class Switch<TSource>
    {
        private readonly TSource value;
        private bool handled = false;

        internal Switch(TSource value)
        {
            this.value = value;
        }

        public Switch<TSource> Case<TTarget>(Action<TTarget> action)
            where TTarget : TSource
        {
            if (!this.handled && this.value is TTarget)
            {
                action((TTarget) this.value);
                this.handled = true;
            }
            return this;
        }

        public void Default(Action<TSource> action)
        {
            if (!this.handled)
                action(this.value);
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2019-01-25T21:40:38.333

您可以在 C# 7 或更高版本中使用模式匹配：

```
switch (foo.GetType())
{
    case var type when type == typeof(Player):
        break;
    case var type when type == typeof(Address):
        break;
    case var type when type == typeof(Department):
        break;
    case var type when type == typeof(ContactType):
        break;
    default:
        break;
} 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-11-18T15:07:58.227

创建一个超类（S）并让 A 和 B 继承它。然后在 S 上声明一个每个子类都需要实现的抽象方法。

这样做，“foo”方法还可以将其签名更改为 Foo(S o)，使其类型安全，并且您不需要抛出那个丑陋的异常。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2017-04-05T13:53:57.767

是的，感谢 C# 7 可以实现。这是它的完成方式（使用[表达式模式](https://blogs.msdn.microsoft.com/dotnet/2017/03/09/new-features-in-c-7-0/#gist45559092)）：

```
switch (o)
{
    case A a:
        a.Hop();
        break;
    case B b:
        b.Skip();
        break;
    case C _: 
        return new ArgumentException("Type C will be supported in the next version");
    default:
        return new ArgumentException("Unexpected type: " + o.GetType());
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-11-19T15:22:38.897

如果您使用的是 C# 4，则可以利用新的动态功能来实现一个有趣的替代方案。我并不是说这更好，事实上它似乎很可能会更慢，但它确实有一定的优雅。

```
class Thing
{

  void Foo(A a)
  {
     a.Hop();
  }

  void Foo(B b)
  {
     b.Skip();
  }

} 
```

以及用法：

```
object aOrB = Get_AOrB();
Thing t = GetThing();
((dynamic)t).Foo(aorB); 
```

这样做的原因是 C# 4 动态方法调用在运行时而不是编译时解决其重载。[我最近](http://paulbatum.blogspot.com/2008/11/no-visitors.html)写了更多关于这个想法的文章。再一次，我想重申一下，这可能比所有其他建议的表现都差，我只是出于好奇而提供它。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-11-18T15:16:34.697

你真的应该重载你的方法，而不是试图自己消除歧义。到目前为止，大多数答案都没有考虑到未来的子类，这可能会在以后导致非常糟糕的维护问题。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2013-11-15T19:45:16.707

对于内置类型，您可以使用 TypeCode 枚举。请注意 GetType() 有点慢，但在大多数情况下可能不相关。

```
switch (Type.GetTypeCode(someObject.GetType()))
{
    case TypeCode.Boolean:
        break;
    case TypeCode.Byte:
        break;
    case TypeCode.Char:
        break;
} 
```

对于自定义类型，您可以创建自己的枚举，以及具有抽象属性或方法的接口或基类...

属性的抽象类实现

```
public enum FooTypes { FooFighter, AbbreviatedFool, Fubar, Fugu };
public abstract class Foo
{
    public abstract FooTypes FooType { get; }
}
public class FooFighter : Foo
{
    public override FooTypes FooType { get { return FooTypes.FooFighter; } }
} 
```

方法的抽象类实现

```
public enum FooTypes { FooFighter, AbbreviatedFool, Fubar, Fugu };
public abstract class Foo
{
    public abstract FooTypes GetFooType();
}
public class FooFighter : Foo
{
    public override FooTypes GetFooType() { return FooTypes.FooFighter; }
} 
```

属性的接口实现

```
public enum FooTypes { FooFighter, AbbreviatedFool, Fubar, Fugu };
public interface IFooType
{
    FooTypes FooType { get; }
}
public class FooFighter : IFooType
{
    public FooTypes FooType { get { return FooTypes.FooFighter; } }
} 
```

方法的接口实现

```
public enum FooTypes { FooFighter, AbbreviatedFool, Fubar, Fugu };
public interface IFooType
{
    FooTypes GetFooType();
}
public class FooFighter : IFooType
{
    public FooTypes GetFooType() { return FooTypes.FooFighter; }
} 
```

我的一位同事也刚刚告诉我：这样做的好处是您可以将它用于几乎任何类型的对象，而不仅仅是您定义的对象。它的缺点是体积更大，速度更慢。

首先定义一个像这样的静态类：

```
public static class TypeEnumerator
{
    public class TypeEnumeratorException : Exception
    {
        public Type unknownType { get; private set; }
        public TypeEnumeratorException(Type unknownType) : base()
        {
            this.unknownType = unknownType;
        }
    }
    public enum TypeEnumeratorTypes { _int, _string, _Foo, _TcpClient, };
    private static Dictionary<Type, TypeEnumeratorTypes> typeDict;
    static TypeEnumerator()
    {
        typeDict = new Dictionary<Type, TypeEnumeratorTypes>();
        typeDict[typeof(int)] = TypeEnumeratorTypes._int;
        typeDict[typeof(string)] = TypeEnumeratorTypes._string;
        typeDict[typeof(Foo)] = TypeEnumeratorTypes._Foo;
        typeDict[typeof(System.Net.Sockets.TcpClient)] = TypeEnumeratorTypes._TcpClient;
    }
    /// <summary>
    /// Throws NullReferenceException and TypeEnumeratorException</summary>
    /// <exception cref="System.NullReferenceException">NullReferenceException</exception>
    /// <exception cref="MyProject.TypeEnumerator.TypeEnumeratorException">TypeEnumeratorException</exception>
    public static TypeEnumeratorTypes EnumerateType(object theObject)
    {
        try
        {
            return typeDict[theObject.GetType()];
        }
        catch (KeyNotFoundException)
        {
            throw new TypeEnumeratorException(theObject.GetType());
        }
    }
} 
```

然后你可以像这样使用它：

```
switch (TypeEnumerator.EnumerateType(someObject))
{
    case TypeEnumerator.TypeEnumeratorTypes._int:
        break;
    case TypeEnumerator.TypeEnumeratorTypes._string:
        break;
} 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2020-01-14T08:50:19.773

C# 8 对模式匹配的增强使得这样做成为可能。在某些情况下，它可以完成工作并且更简洁。

```
 public Animal Animal { get; set; }
        ...
        var animalName = Animal switch
        {
            Cat cat => "Tom",
            Mouse mouse => "Jerry",
            _ => "unknown"
        }; 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2013-06-18T15:59:46.770

我喜欢 Virtlink[使用隐式类型](https://stackoverflow.com/a/10025398/14582)来使开关更具可读性，但我不喜欢提前退出是不可能的，而且我们正在做分配。让我们把性能调高一点。

```
public static class TypeSwitch
{
    public static void On<TV, T1>(TV value, Action<T1> action1)
        where T1 : TV
    {
        if (value is T1) action1((T1)value);
    }

    public static void On<TV, T1, T2>(TV value, Action<T1> action1, Action<T2> action2)
        where T1 : TV where T2 : TV
    {
        if (value is T1) action1((T1)value);
        else if (value is T2) action2((T2)value);
    }

    public static void On<TV, T1, T2, T3>(TV value, Action<T1> action1, Action<T2> action2, Action<T3> action3)
        where T1 : TV where T2 : TV where T3 : TV
    {
        if (value is T1) action1((T1)value);
        else if (value is T2) action2((T2)value);
        else if (value is T3) action3((T3)value);
    }

    // ... etc.
} 
```

嗯，这让我的手指受伤。让我们在 T4 中进行：

```
<#@ template debug="false" hostSpecific="true" language="C#" #>
<#@ output extension=".cs" #>
<#@ Assembly Name="System.Core.dll" #>
<#@ import namespace="System.Linq" #> 
<#@ import namespace="System.IO" #> 
<#
    string GenWarning = "// THIS FILE IS GENERATED FROM " + Path.GetFileName(Host.TemplateFile) + " - ANY HAND EDITS WILL BE LOST!";
    const int MaxCases = 15;
#>
<#=GenWarning#>

using System;

public static class TypeSwitch
{
<# for(int icase = 1; icase <= MaxCases; ++icase) {
    var types = string.Join(", ", Enumerable.Range(1, icase).Select(i => "T" + i));
    var actions = string.Join(", ", Enumerable.Range(1, icase).Select(i => string.Format("Action<T{0}> action{0}", i)));
    var wheres = string.Join(" ", Enumerable.Range(1, icase).Select(i => string.Format("where T{0} : TV", i)));
#>
    <#=GenWarning#>

    public static void On<TV, <#=types#>>(TV value, <#=actions#>)
        <#=wheres#>
    {
        if (value is T1) action1((T1)value);
<# for(int i = 2; i <= icase; ++i) { #>
        else if (value is T<#=i#>) action<#=i#>((T<#=i#>)value);
<#}#>
    }

<#}#>
    <#=GenWarning#>
} 
```

稍微调整一下 Virtlink 的例子：

```
TypeSwitch.On(operand,
    (C x) => name = x.FullName,
    (B x) => name = x.LongName,
    (A x) => name = x.Name,
    (X x) => name = x.ToString(CultureInfo.CurrentCulture),
    (Y x) => name = x.GetIdentifier(),
    (object x) => name = x.ToString()); 
```

可读且快速。现在，正如每个人都在他们的答案中不断指出的那样，并且考虑到这个问题的性质，顺序在类型匹配中很重要。所以：

*   首先放置叶子类型，然后放置基本类型。
*   对于对等类型，将更可能的匹配放在首位以最大化性能。
*   这意味着不需要特殊的默认情况。相反，只需使用 lambda 中最基础的类型，并将其放在最后。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2011-05-06T11:56:37.893

鉴于继承有助于将对象识别为多个类型，我认为切换可能会导致歧义。例如：

**情况1**

```
{
  string s = "a";
  if (s is string) Print("Foo");
  else if (s is object) Print("Bar");
} 
```

**案例2**

```
{
  string s = "a";
  if (s is object) Print("Foo");
  else if (s is string) Print("Bar");
} 
```

因为 s 是一个字符串**和**一个对象。我认为，当您编写 a 时，`switch(foo)`您希望 foo 匹配一个且仅一个`case`语句。使用 switch 类型，你编写 case 语句的顺序可能会改变整个 switch 语句的结果。我认为那是错误的。

您可以考虑对“typeswitch”语句的类型进行编译器检查，检查枚举类型是否相互继承。但这并不存在。

`foo is T`不一样`foo.GetType() == typeof(T)`！！

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-11-18T15:12:30.197

我要么

*   使用方法重载（就像[x0n](https://stackoverflow.com/users/6920/x0n)一样），或者
*   使用子类（就像[Pablo](https://stackoverflow.com/users/7595/pablo-fernandez)一样），或者
*   应用[访问者模式](http://www.dofactory.com/Patterns/PatternVisitor.aspx)。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-11-18T15:57:21.370

另一种方法是定义一个接口 IThing ，然后在两个类中实现它，这是代码片段：

```
public interface IThing
{
    void Move();
}

public class ThingA : IThing
{
    public void Move()
    {
        Hop();
    }

    public void Hop(){  
        //Implementation of Hop 
    }

}

public class ThingA : IThing
{
    public void Move()
    {
        Skip();
    }

    public void Skip(){ 
        //Implementation of Skip    
    }

}

public class Foo
{
    static void Main(String[] args)
    {

    }

    private void Foo(IThing a)
    {
        a.Move();
    }
} 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2018-09-12T14:51:56.607

根据 C# 7.0 规范，您可以在 a`case`的 a中声明一个局部变量`switch`：

```
object a = "Hello world";
switch (a)
{
    case string myString:
        // The variable 'a' is a string!
        break;
    case int myInt:
        // The variable 'a' is an int!
        break;
    case Foo myFoo:
        // The variable 'a' is of type Foo!
        break;
} 
```

* * *

这是做这种事情的最好方法，因为它只涉及强制转换和压栈操作，这是解释器在按位操作和`boolean`条件之后可以运行的最快操作。

将其与 a 进行比较`Dictionary<K, V>`，内存使用量要少得多：保存字典需要更多的 RAM 空间，并且 CPU 需要更多的计算来创建两个数组（一个用于键，另一个用于值）并收集要放置的键的哈希码值到各自的键。

`if`因此，据我所知，除非您只想对运算符使用--块，否则我认为不会存在更快的方法`then`，如下所示：`else``is`

```
object a = "Hello world";
if (a is string)
{
    // The variable 'a' is a string!
} else if (a is int)
{
    // The variable 'a' is an int!
} // etc. 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2013-01-04T12:30:56.557

您可以创建重载方法：

```
void Foo(A a) 
{ 
    a.Hop(); 
}

void Foo(B b) 
{ 
    b.Skip(); 
}

void Foo(object o) 
{ 
    throw new ArgumentException("Unexpected type: " + o.GetType()); 
} 
```

并将参数转换为[`dynamic`](http://msdn.microsoft.com/en-us/library/dd264736.aspx)type 以绕过静态类型检查：

```
Foo((dynamic)something); 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2019-04-04T12:56:32.937

应该与

```
case type _: 
```

像：

```
int i = 1;
bool b = true;
double d = 1.1;
object o = i; // whatever you want

switch (o)
{
    case int _:
        Answer.Content = "You got the int";
        break;
    case double _:
        Answer.Content = "You got the double";
        break;
    case bool _:
        Answer.Content = "You got the bool";
        break;
} 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-11-18T15:14:04.203

在这种情况下，我通常会得到一个谓词和动作列表。这些方面的东西：

```
class Mine {
    static List<Func<object, bool>> predicates;
    static List<Action<object>> actions;

    static Mine() {
        AddAction<A>(o => o.Hop());
        AddAction<B>(o => o.Skip());
    }

    static void AddAction<T>(Action<T> action) {
        predicates.Add(o => o is T);
        actions.Add(o => action((T)o);
    }

    static void RunAction(object o) {
        for (int i=0; o < predicates.Count; i++) {
            if (predicates[i](o)) {
                actions[i](o);
                break;
            }
        }
    }

    void Foo(object o) {
        RunAction(o);
    }
} 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-11-18T15:26:02.543

创建一个接口`IFooable`，然后让你`A`和`B`类实现一个通用方法，然后调用你想要的对应方法：

```
interface IFooable
{
    public void Foo();
}

class A : IFooable
{
    //other methods ...

    public void Foo()
    {
        this.Hop();
    }
}

class B : IFooable
{
    //other methods ...

    public void Foo()
    {
        this.Skip();
    }
}

class ProcessingClass
{
    public void Foo(object o)
    {
        if (o == null)
            throw new NullRefferenceException("Null reference", "o");

        IFooable f = o as IFooable;
        if (f != null)
        {
            f.Foo();
        }
        else
        {
            throw new ArgumentException("Unexpected type: " + o.GetType());
        }
    }
} 
```

请注意，最好`as`先检查，`is`然后再进行转换，因为这样可以进行 2 次转换，因此成本更高。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2017-08-02T08:52:05.103

您正在寻找`Discriminated Unions`哪些是 F# 的语言功能，但是您可以通过使用我制作的名为 OneOf 的库来实现类似的效果

[https://github.com/mcintyre321/OneOf](https://github.com/mcintyre321/OneOf)

`switch`(and `if`and )的主要优点`exceptions as control flow`是它是编译时安全的 - 没有默认处理程序或失败

```
void Foo(OneOf<A, B> o)
{
    o.Switch(
        a => a.Hop(),
        b => b.Skip()
    );
} 
```

如果将第三项添加到 o，则会出现编译器错误，因为您必须在 switch 调用中添加处理程序 Func。

您还可以执行 a `.Match`which 返回一个值，而不是执行一条语句：

```
double Area(OneOf<Square, Circle> o)
{
    return o.Match(
        square => square.Length * square.Length,
        circle => Math.PI * circle.Radius * circle.Radius
    );
} 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2019-04-08T12:42:35.213

如果您知道您期望的课程，但您仍然没有对象，您甚至可以这样做：

```
private string GetAcceptButtonText<T>() where T : BaseClass, new()
{
    switch (new T())
    {
        case BaseClassReview _: return "Review";
        case BaseClassValidate _: return "Validate";
        case BaseClassAcknowledge _: return "Acknowledge";
        default: return "Accept";
    }
} 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2020-02-25T02:08:10.330

从 C# 8 开始，您可以使用新开关使其更加简洁。并且使用 discard 选项 _ 您可以避免在不需要时创建不必要的变量，如下所示：

```
 return document switch {
            Invoice _ => "Is Invoice",
            ShippingList _ => "Is Shipping List",
            _ => "Unknown"
        }; 
```

Invoice 和 ShippingList 是类，而 document 是可以是其中任何一个的对象。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-11-18T15:22:43.907

在比较了此处提供的 F# 功能的选项后，我发现 F# 对基于类型的切换有更好的支持（尽管我仍然坚持使用 C#）。
你可能想看看[这里](https://stackoverflow.com/questions/156467/switch-pattern-matching-idea)和[这里](http://community.bartdesmet.net/blogs/bart/default.aspx)。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2018-11-08T17:19:55.410

我将创建一个对您的开关有意义的名称和方法名称的接口，让我们分别调用它们：`IDoable`告诉实现`void Do()`.

```
public interface IDoable
{
    void Do();
}

public class A : IDoable
{
    public void Hop() 
    {
        // ...
    }

    public void Do()
    {
        Hop();
    }
}

public class B : IDoable
{
    public void Skip() 
    {
        // ...
    }

    public void Do()
    {
        Skip();
    }
} 
```

并将方法更改如下：

```
void Foo<T>(T obj)
    where T : IDoable
{
    // ...
    obj.Do();
    // ...
} 
```

至少在编译时你是安全的，我怀疑在性能方面它比在运行时检查类型更好。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-11-18T15:23:21.470

我同意 Jon 关于对类名进行操作的哈希。如果您保留您的模式，您可能需要考虑使用“as”构造来代替：

```
A a = o as A;
if (a != null) {
    a.Hop();
    return;
}
B b = o as B;
if (b != null) {
    b.Skip();
    return;
}
throw new ArgumentException("..."); 
```

不同之处在于，当您使用模式时 if (foo is Bar) { ((Bar)foo).Action(); 你正在做两次类型转换。现在也许编译器会优化并且只做一次 - 但我不会指望它。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-01-03T03:44:53.763

正如 Pablo 所建议的，接口方法几乎总是处理这个问题的正确方法。要真正利用 switch，另一种选择是在你的类中使用一个自定义枚举来表示你的类型。

```
enum ObjectType { A, B, Default }

interface IIdentifiable
{
    ObjectType Type { get; };
}
class A : IIdentifiable
{
    public ObjectType Type { get { return ObjectType.A; } }
}

class B : IIdentifiable
{
    public ObjectType Type { get { return ObjectType.B; } }
}

void Foo(IIdentifiable o)
{
    switch (o.Type)
    {
        case ObjectType.A:
        case ObjectType.B:
        //......
    }
} 
```

这也是在 BCL 中实现的。一个例子是[MemberInfo.MemberTypes](https://stackoverflow.com/questions/15921608/getting-the-type-of-a-memberinfo-with-reflection/16043551#16043551)，另一个是`GetTypeCode`原始类型，比如：

```
void Foo(object o)
{
    switch (Type.GetTypeCode(o.GetType())) // for IConvertible, just o.GetTypeCode()
    {
        case TypeCode.Int16:
        case TypeCode.Int32:
        //etc ......
    }
} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-08-23T10:59:41.593

这是一个替代答案，混合了 JaredPar 和 VirtLink 答案的贡献，具有以下约束：

*   switch 构造的**行为类似于 function**，并接收**函数作为**case 的参数。
*   确保它被正确构建，并且始终存在一个**默认函数**。
*   它**在第一次匹配后返回**（JaredPar 答案为真，VirtLink 答案不为真）。

用法：

```
 var result = 
   TSwitch<string>
     .On(val)
     .Case((string x) => "is a string")
     .Case((long x) => "is a long")
     .Default(_ => "what is it?"); 
```

代码：

```
public class TSwitch<TResult>
{
    class CaseInfo<T>
    {
        public Type Target { get; set; }
        public Func<object, T> Func { get; set; }
    }

    private object _source;
    private List<CaseInfo<TResult>> _cases;

    public static TSwitch<TResult> On(object source)
    {
        return new TSwitch<TResult> { 
            _source = source,
            _cases = new List<CaseInfo<TResult>>()
        };
    }

    public TResult Default(Func<object, TResult> defaultFunc)
    {
        var srcType = _source.GetType();
       foreach (var entry in _cases)
            if (entry.Target.IsAssignableFrom(srcType))
                return entry.Func(_source);

        return defaultFunc(_source);
    }

    public TSwitch<TResult> Case<TSource>(Func<TSource, TResult> func)
    {
        _cases.Add(new CaseInfo<TResult>
        {
            Func = x => func((TSource)x),
            Target = typeof(TSource)
        });
        return this;
    }
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2018-10-29T12:05:17.510

是的 - 只需使用从 C#7 向上命名的稍微奇怪的“模式匹配”来匹配类或结构：

```
IObject concrete1 = new ObjectImplementation1();
IObject concrete2 = new ObjectImplementation2();

switch (concrete1)
{
    case ObjectImplementation1 c1: return "type 1";         
    case ObjectImplementation2 c2: return "type 2";         
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2018-11-28T23:04:51.680

我用

```
 public T Store<T>()
    {
        Type t = typeof(T);

        if (t == typeof(CategoryDataStore))
            return (T)DependencyService.Get<IDataStore<ItemCategory>>();
        else
            return default(T);
    } 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2020-07-14T11:25:27.173

试着走这条路：

```
public void Test(BaseType @base)
{
    switch (@base)
    {
        case ConcreteType concrete:
            DoSomething(concrete);
            break;

        case AnotherConcrete concrete:
            DoSomething(concrete);
            break;
    }
} 
```

# xslt - 如何从文档中删除

> ID：298981
> 
> 赞同：1
> 
> 时间：2008-11-18T15:04:55.110
> 
> 标签：xslt, xpath

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T15:20:04.723

[dsteinweg](https://stackoverflow.com/users/418/dsteinweg)让我走上了正轨……我最终做了：

```
<xsl:template match="b">
    <xsl:if test="./* or ./text()">
        <xsl:element name="b">
            <xsl:apply-templates/>
        </xsl:element>
    </xsl:if>
</xsl:template> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-18T20:48:34.403

此转换忽略任何没有任何子节点的 <b> 元素。在此上下文中的节点是指元素、文本、注释或处理指令节点。

```
<xsl:stylesheet 版本="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:输出省略-xml-declaration="yes"/>
    <xsl:template match="node()|@*">
      <xsl:复制>
         <xsl:apply-templates select="node()|@*"/>
      </xsl:copy>
    </xsl:模板>

    <xsl:template match="b[not(node()]"/>
</xsl:样式表>
```

请注意，这里我们使用了最基本的 XSLT 设计模式之一——使用[**身份转换**](http://www.dpawson.co.uk/xsl/sect2/identity.html)并为特定节点覆盖它。

将只为名为“b”的元素且没有（任何节点）子节点的节点选择覆盖模板。这个模板是空的（没有任何内容），所以其应用的效果是匹配节点被忽略/丢弃，并且不在输出中重现。

这种技术非常强大，被广泛用于此类任务，也可用于重命名、更改内容或属性、将子节点或兄弟节点添加到任何可以匹配的特定节点（可以使用除命名空间节点之外的任何类型的节点作为 <xsl:template/> 的“匹配”属性中的匹配模式

希望这有帮助。

干杯，

迪米特·诺瓦切夫

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-18T15:08:03.857

我想知道这是否可行？

```
<xsl:template match="b">
  <xsl:if test="b/text()">
    ... 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-18T15:22:32.597

看看这是否可行。

```
<xsl:template match="b">
  <xsl:if test=".!=''">
    <xsl:element name="b">
     <xsl:apply-templates/>
    </xsl:element>
  </xsl:if>
</xsl:template> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-18T16:33:21.890

另一种方法是执行以下操作：

```
<xsl:template match="b[not(text())]" />

<xsl:template match="b">
  <b>
    <xsl:apply-templates/>
  </b>
</xsl:template> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-18T17:24:35.720

您可以将所有逻辑放在谓词中，并设置一个模板以仅匹配您想要的内容并将其删除：

```
<xsl:template match="b[not(node())] /> 
```

这假设您稍后在转换中有一个身份模板，听起来就像您所做的那样。这将自动复制任何带有内容的“b”标签，这就是你想要的：

```
<xsl:template match="@*|node()">
    <xsl:copy>
        <xsl:apply-templates select="@*|node()"/>
    </xsl:copy>
</xsl:template> 
```

**编辑：**现在像下面的 Dimitri 一样使用 node()。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-18T15:30:15.577

如果您有权更新原始 XML，则可以尝试在根元素上使用**xml:space=preserve**

```
<html xml:space="preserve">
...
</html> 
```

这样，空的 <b> </b> 标记中的空间被保留，因此可以与 XSLT 中的 <b /> 区分开来。

```
<xsl:template match="b">
   <xsl:if test="text() != ''">
   ....
   </xsl:if>
</xsl:template> 
```

# java - 处理方法：通讯链路故障

> ID：298988
> 
> 赞同：4
> 
> 时间：2008-11-18T15:06:00.273
> 
> 标签：java, hibernate, spring, database-connection, connection-pooling

我们正在使用 Spring 2.5.4/Hibernate 3.2/Websphere Application Server 6.1.0.17。我们已经在 AIX 机器上部署了应用程序。第二天当我进来时，我尝试登录应用程序。我在页面上得到这个异常：

`Error 500: Request processing failed; nested exception is org.springframework.dao.DataAccessResourceFailureException: could not execute query; nested exception is org.hibernate.exception.JDBCConnectionException: could not execute query`

我检查了[System.Out](http://pastebin.com/f24fbcdf3)日志并查看更多详细信息。（使用 pastebin 是因为日志格式真的搞砸了页面布局）

* * *

导致我们异常的代码行是：

```
List loginList = getHibernateTemplate().find("from Login  
    where storeId =" + id + " and password ='" + password + "'"); 
```

我们在 Spring 的 applicationContext.xml 中连接连接。我们知道 AS400 上的连接有时会断开（他们可能会在一夜之间重新启动系统——我不确定）。但是，当我们在 applicationContext 中连接所有内容时，我们最好不要打开新连接。

无论使用 DataSource/JNDI 或 JDBC，都会出现此问题

有谁知道要添加到 Spring 或 Hibernate 以检查连接是否过时，如果是，删除它并创建一个新的设置？或任何其他想法来解决这个问题？如果您需要更多信息/代码，请告诉我。

非常感激，

克里斯

### 更新：

查看了 Spring 社区论坛上的一些帖子，我已经使用 commons-dbcp 实现了我的 DataSource，它具有一些属性，如“testWhileIdle”和“validationQuery”。我将让应用程序运行并在上午再次检查它。将发布结果的更新。

### 更新#2：

使用 dbcp-commons BasicDataSource 似乎可以纠正这个问题，这似乎是一个网络问题。Websphere 具有池连接，如果 AS400 端出现网络问题，它会尝试使用它拥有的连接，但它不知道该连接是否“陈旧”。使用具有时间间隔的validationQuery 是解决此问题的一种廉价（但有效）的方法——但在Websphere 端，在配置下可能有更好的方法。但是，最好不要改变没有破坏的东西，所以在这失败之前，这可能是我们前进的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T19:25:37.877

啊，这就是我要说的......问题必须在连接池中解决，通过在返回连接之前验证连接。DBCP有validationQuery，JBoss也有类似的；我确信 Websphere 在其连接池中必须有类似的东西来验证连接，然后再分发它们。即使您不使用 testWhileIdle，如果发现连接无效，池也会创建一个新的连接，而不是无效的连接。****``********************