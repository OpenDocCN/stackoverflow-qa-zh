# StackOverflow 问答 000469000-000469999

# visual-studio - 使用增量重建在 Visual C++ 中生成发布版本是否安全？

> ID：469000
> 
> 赞同：1
> 
> 时间：2009-01-22T12:54:26.450
> 
> 标签：visual-studio, build-process, build-automation, incremental-build

我有时会在 Visual C++（目前是 2003 年）上进行增量重建时遇到问题。有些依赖项似乎没有正确检查，有些文件没有在应该构建的时候构建。我想这些问题来自增量重建的时间戳方法。

在我的办公桌上构建调试版本时，我不认为这是一个大问题，但是对于可分发的构建，这是一个问题。

对构建服务器使用增量构建是否安全，还是需要完整构建？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T12:59:58.030

如果用户遇到需要调查的问题，您需要一个您分发的构建以便再次重新创建。

我不会依赖增量构建。此外，我总是会从构建机器中删除所有源代码，并在构建版本之前从源代码控制系统中从头开始获取它。这样，您就知道可以通过获取相同的源代码再次重复构建过程。

如果您使用增量构建，则每次构建都会有所不同，因为只需要构建系统的一个子集。我认为尽可能多地消除发布版本之间的差异是一件好事。因此，出于这个原因，增量构建已经结束。

用构建的版本号标记或以某种方式标记源代码控制系统中每个源文件的版本是一个好主意。这使您能够跟踪构建版本的确切来源。有了一个体面的源代码控制系统，标签可以用来追踪在一个版本和下一个版本之间对代码所做的所有更改。当您试图追踪您知道在两个版本之间引入的错误时，这可能是一个真正的帮助。

当您不分发构建时，增量构建在开发机器上仍然有用，只是为了在代码/调试/测试/重复开发周期中节省时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T13:02:05.577

如果没有别的，我总是更愿意为任何版本做一个完整的清理和重建，以便让您高枕无忧。假设您谈论的是外部发布的构建，而不仅仅是使用 Release 配置的构建，这些构建相对不频繁的事实意味着从长远来看，任何时间节省都将是最小的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T13:13:47.783

我认为你应该避免“它是否安全”的问题。根本不值得研究。

增量构建的优点是节省成本。每个构建很小，它为开发人员通常制作的所有调试构建加起来，然后为您团队中的所有开发人员进一步加起来。

另一方面，发布版本很少见。发布构建的成本不在于等待它们的开发人员，而是在需要验证它的测试人员团队中发现更多。

出于这个原因，我发现增量构建无疑可以节省调试构建的成本，但我拒绝花任何时间计算我从增量构建发布构建中获得的小额节省。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T12:56:48.177

使用增量构建功能构建的二进制文件将变得更大更慢，即使对于发布版本也是如此，因为它们必须包含脚手架以启用对于完全优化的构建而言并非必需的增量构建。出于这个原因，我建议您不要使用增量构建。

# sql - 你能在一个语句中访问 MySQL 中的自动增量值吗？

> ID：469009
> 
> 赞同：23
> 
> 时间：2009-01-22T12:57:20.623
> 
> 标签：sql, mysql, insert, auto-increment

我有一个包含用户表的 MySQL 数据库。表的主键是“userid”，设置为自动递增字段。

我想做的是，当我将新用户插入表中时，使用与自动增量在不同字段“default_assignment”的“userid”字段中创建的相同值。

例如

我想要这样的声明：

```
INSERT INTO users ('username','default_assignment') VALUES ('barry', value_of_auto_increment_field()) 
```

所以我创建了用户“Barry”，“userid”生成为 16（例如），但我也希望“default_assignment”具有相同的值 16。

请问有什么办法可以实现吗？

谢谢！

*更新：*

感谢您的回复。default_assignment 字段不是多余的。default_assigment 可以引用 users 表中的任何用户。创建用户时，我已经有一个允许选择另一个用户作为 default_assignment 的表单，但是在某些情况下需要将其设置为同一用户，因此我的问题是。

*更新：*

好的，我已经尝试了更新触发建议，但仍然无法使其正常工作。这是我创建的触发器：

```
CREATE TRIGGER default_assignment_self BEFORE INSERT ON `users`  
FOR EACH ROW BEGIN
SET NEW.default_assignment = NEW.userid;
END; 
```

但是，当插入新用户时，default_assignment 始终设置为 0。

如果我手动设置用户 ID，则 default_assignment 确实设置为用户 ID。

因此，自动分配生成过程显然发生在触发器生效之后。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2010-07-26T11:46:27.727

不需要创建另一个表，max() 根据表的 auto_increment 值会有问题，这样做：

```
CREATE TRIGGER trigger_name BEFORE INSERT ON tbl FOR EACH ROW
BEGIN
   DECLARE next_id;
   SET next_id = (SELECT AUTO_INCREMENT FROM information_schema.TABLES WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME='tbl');
   SET NEW.field = next_id;
END 
```

我声明了 next_id 变量，因为通常它会以其他方式使用（*），但您可以直接执行 new.field=(select ...)

```
CREATE TRIGGER trigger_name BEFORE INSERT ON tbl FOR EACH ROW
BEGIN
   SET NEW.field=(SELECT AUTO_INCREMENT FROM information_schema.TABLES WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME='tbl');
END 
```

同样在（SELECT 字符串字段）的情况下，您可以使用 CAST 值；

```
CREATE TRIGGER trigger_name BEFORE INSERT ON tbl FOR EACH ROW
BEGIN
   SET NEW.field=CAST((SELECT aStringField FROM information_schema.TABLES WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME='tbl') AS UNSIGNED);
END 
```

(*) 自动命名图像：

```
SET NEW.field = CONCAT('image_', next_id, '.gif'); 
```

(*) 创建哈希：

```
SET NEW.field = CONCAT( MD5( next_id ) , MD5( FLOOR( RAND( ) *10000000 ) ) ); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-04-24T07:31:02.120

试试这个

```
INSERT INTO users (default_assignment) VALUES (LAST_INSERT_ID()+1); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T13:16:13.147

看到这`last_insert_id()`在这种情况下不起作用，是的，触发器将是实现这一目标的唯一方法。

我确实问自己：你需要这个功能做什么？为什么将用户 ID 存储两次？就个人而言，我不喜欢像这样存储冗余数据，我可能会在应用程序代码中解决这个问题，方法是将该不祥`default_assignment`的列设为 NULL，并在我的应用程序代码中使用用户 ID（如果`default_assignment`为 NULL）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-27T09:20:04.383

实际上，我只是尝试做与上面建议的相同的事情。但似乎 Mysql 在实际提交该行之前不会生成插入的 ID。因此 NEW.userid 在插入前触发器中将始终返回 0。

除非它是 BEFORE INSERT 触发器，否则上述内容也不会起作用，因为您无法更新 AFTER INSERT 查询中的值。

来自 Mysql 论坛帖子似乎处理此问题的唯一方法是使用附加表作为序列。这样您的触发器就可以从外部源中提取值。

```
CREATE TABLE `lritstsequence` (
  `idsequence` int(11) NOT NULL auto_increment,
  PRIMARY KEY  (`idsequence`)
) ENGINE=InnoDB;

CREATE TABLE `lritst` (
`id` int(10) unsigned NOT NULL auto_increment,
`bp_nr` decimal(10,0) default '0',
`descr` varchar(128) default NULL,
PRIMARY KEY (`id`),
UNIQUE KEY `dir1` (`bp_nr`)
) ENGINE=InnoDB;

DELIMITER $$

DROP TRIGGER /*!50032 IF EXISTS */ `lritst_bi_set_bp_nr`$$

CREATE TRIGGER `lritst_bi_set_bp_nr` BEFORE INSERT ON `lritst`
FOR EACH ROW
BEGIN
    DECLARE secuencia INT;
    INSERT INTO lritstsequence (idsequence) VALUES (NULL);
    SET secuencia = LAST_INSERT_ID();
    SET NEW.id = secuencia;
    SET NEW.bp_nr = secuencia;
END;$$

DELIMITER ;

INSERT INTO lritst (descr) VALUES ('test1');
INSERT INTO lritst (descr) VALUES ('test2');
INSERT INTO lritst (descr) VALUES ('test3');

SELECT * FROM lritst;

Result:

    id   bp_nr  descr 
------  ------  ------
     1       1  test1 
     2       2  test2 
     3       3  test3 
```

这是从 forums.mysql.com/read.php?99,186171,186241#msg-186241 复制的，但我还不允许发布链接。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-03T22:17:34.467

我发现唯一可以在没有额外表格的情况下解决此问题的方法是计算 self 下一个数字并将其放入所需的字段中。

```
CREATE TABLE `Temp` (
  `id` int(11) NOT NULL auto_increment,
  `value` varchar(255) ,
  PRIMARY KEY  (`idsequence`)
) ENGINE=InnoDB;

CREATE TRIGGER temp_before_insert BEFORE INSERT ON `Temp`
FOR EACH ROW 
BEGIN
    DECLARE m INT;

    SELECT IFNULL(MAX(id), 0) + 1 INTO m FROM Temp;
    SET NEW.value = m;
    -- NOT NEEDED but to be safe that no other record can be inserted in the meanwhile
    SET NEW.id = m;   
END; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-13T09:12:40.623

基本上，解决方案就像**Resegue**所说的那样。
但是，如果您想在一个语句中使用它，您将使用以下方法之一：

**1.**长篇大论：

```
INSERT INTO `t_name`(field) VALUES((SELECT AUTO_INCREMENT FROM information_schema.TABLES WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME='t_name')) 
```

或带有数字的文本：

```
INSERT INTO `t_name`(field) VALUES(CONCAT('Item No. ',CONVERT((SELECT AUTO_INCREMENT FROM information_schema.TABLES WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME='t_name') USING utf8))) 
```

它在 PHP 中看起来更清晰：

```
$pre_name='Item No. ';
$auto_inc_id_qry = "(SELECT AUTO_INCREMENT FROM information_schema.TABLES
    WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME='$table')";
$new_name_qry = "CONCAT('$pre_name',CONVERT($auto_inc_id_qry USING utf8))";
mysql_query("INSERT INTO `$table`(title) VALUES($new_name_qry)"); 
```

**2.**使用功能：（未测试）

```
CREATE FUNCTION next_auto_inc(table TINYTEXT) RETURNS INT
BEGIN
DECLARE next_id INT;
SELECT AUTO_INCREMENT FROM information_schema.TABLES
    WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME=table INTO next_id;
RETURN next_id;
END

INSERT INTO users ('username','default_assignment')
    VALUES ('barry', next_auto_inc('users')) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-07-27T03:11:07.290

```
$ret = $mysqli->query("SELECT Auto_increment FROM information_schema.tables WHERE table_schema = DATABASE() ");l
while ($row = mysqli_fetch_array($ret)) {
    $user_id=$row['Auto_increment'];
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-09-19T12:33:00.847

您可以使用简单的子查询可靠地做到这一点：

```
INSERT INTO users ('username','default_assignment')
    SELECT 'barry', Auto_increment FROM information_schema.tables WHERE TABLE_NAME='users' 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-02-10T03:51:54.830

我用 10 个并发线程进行插入测试了上述触发想法，在插入约 25k 后，我得到了超过 1000 个 2 或 3 个重复的案例。

```
DROP TABLE IF EXISTS test_table CASCADE;

CREATE TABLE `test_table` (
  `id`             INT         NOT NULL  AUTO_INCREMENT,
  `update_me`      VARCHAR(36),
  `otherdata`      VARCHAR(36) NOT NULL,

  PRIMARY KEY (`id`)
)
  ENGINE = InnoDB
  DEFAULT CHARSET = utf8
  COMMENT 'test table for trigger testing';

delimiter $$

DROP TRIGGER IF EXISTS setnum_test_table;
$$
CREATE TRIGGER setnum_test_table
BEFORE INSERT ON test_table FOR EACH ROW
-- SET OLD.update_me = CONCAT(NEW.id, 'xyz');

BEGIN
   DECLARE next_id INT;
   SET next_id = (SELECT AUTO_INCREMENT FROM information_schema.TABLES WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME='test_table' LOCK IN SHARE MODE );
--    SET NEW.update_me = CONCAT(next_id, 'qrst');
    SET NEW.update_me = next_id;
END

$$

delimiter ;

-- SELECT AUTO_INCREMENT FROM information_schema.TABLES WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME='test_table'

INSERT INTO test_table (otherdata) VALUES ('hi mom2');

SELECT count(*) FROM test_table;
SELECT * FROM test_table;

-- select count(*) from (
select * from (
SELECT count(*) as cnt ,update_me FROM test_table group by update_me) q1
where cnt > 1
order by cnt desc 
```

我用了 10 个：

```
while true ; do echo "INSERT INTO test_table (otherdata) VALUES ('hi mom2');" | mysql --user xyz testdb ; done & 
```

并运行最后一个查询以查看重复项

示例输出：'3', '4217' '3', '13491' '2', '10037' '2', '14658' '2', '5080' '2', '14201' ...

注意“锁定共享模式”没有改变任何东西。有和没有以大致相同的速度给出重复。似乎 MySQL AUTO_INCREMENT 不像 Postgres 的 next_val() 那样工作，并且不是并发安全的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-08-20T19:35:10.120

我知道这篇文章是 2010 年的，但我找不到一个好的解决方案。我通过创建一个包含计数器的单独表解决了这个问题。当我需要为列生成唯一标识符时，我只需调用存储过程：

```
CREATE DEFINER=`root`@`localhost` PROCEDURE `IncrementCounter`(in id varchar(255))
BEGIN
declare x int;
-- begin;
start transaction;
-- Get the last counter (=teller) and mark record for update.
select Counter+1 from tabel.Counter where CounterId=id into x for update;
-- check if given counter exists and increment value, otherwise create it.
if x is null then
    set x = 1;
    insert into tabel.Counters(CounterId, Counter) values(id, x);
else
    update tabel.Counters set Counter = x where CounterId = id;
end if;
-- select the new value and commit the transaction
select x;
commit;
END 
```

'for update' 语句锁定计数器表中的行。这避免了多个线程进行重复。

# asp.net - 每个带有 runat=server 的元素都应该有一个 id 属性吗？

> ID：469018
> 
> 赞同：0
> 
> 时间：2009-01-22T13:01:26.733
> 
> 标签：asp.net

我继承了一个asp.net网站来维护

查看 aspx 页面时，几乎每个带有 runat=server 的元素都没有定义 id 属性。

我应该遍历每个元素并添加一个吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T13:09:00.570

除非控件位于重复控件中，否则它应该具有分配给它的唯一 ID 属性。这是一些关于如何将服务器控件添加到 ASPX 页面的[MSDN 文档。](http://msdn.microsoft.com/en-us/library/zzhfb89h.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T13:21:11.280

如果您要在代码中引用它们，您只需要给它们 id。如果您根本没有引用它们，您可能想知道为什么它们是 .net 控件而不仅仅是 html 元素。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T13:24:39.713

如果您不这样做，ASP 将分配一个唯一的 ID。有时，当我不会操纵它时，我不会打扰。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T13:33:27.993

具体到您继承应用程序的情况，这不是一个紧迫的问题。ASP.NET 将在运行时自动为它们生成 ID。

通常，旨在用 HTML 元素替换这些控件（正如其他人提到的）是一个好主意。不过要小心。仅仅因为一个元素没有 ID 并不意味着它在运行时没有在服务器端被引用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T15:32:03.527

您无需为未引用的控件设置 ID。ASP.NET 将为您完成。就是这样。

这并不意味着它们可以被 HTML 控件替换。在没有设置 ID 的情况下使用 runat="server" 进行控制是完全合理的。例如：

```
<asp:ListView runat="server" DataSourceID="someDataSource"> 
```

# sql - 光标内的光标

> ID：469019
> 
> 赞同：35
> 
> 时间：2009-01-22T13:01:44.237
> 
> 标签：sql, sql-server, tsql, sql-server-2005, database-cursor

主要问题是将行的索引更改为 1,2,3.. 其中联系人 ID 和类型相同。但是所有列都可以包含完全相同的数据，因为一些前雇员搞砸了，并通过联系 ID 和类型更新了所有行。不知何故，有些行没有弄乱，但索引行是相同的。这是完全的混乱。

我尝试将内部光标与来自外部光标的变量一起使用。但它似乎卡在内部光标中。

查询的一部分如下所示：

```
Fetch NEXT FROM OUTER_CURSOR INTO @CONTACT_ID,  @TYPE
While (@@FETCH_STATUS <> -1)
BEGIN
IF (@@FETCH_STATUS <> -2)

    DECLARE INNER_CURSOR Cursor 
    FOR 
    SELECT * FROM CONTACTS
    where CONTACT_ID = @CONTACT_ID
    and TYPE = @TYPE 

    Open INNER_CURSOR 

    Fetch NEXT FROM INNER_CURSOR 
    While (@@FETCH_STATUS <> -1)
    BEGIN
    IF (@@FETCH_STATUS <> -2) 
```

可能是什么问题？@@FETCH_STATUS 是模棱两可的还是什么？

编辑：如果我不在内部光标内使用此代码，一切看起来都很好：

```
UPDATE CONTACTS
SET INDEX_NO = @COUNTER
where current of INNER_CURSOR 
```

编辑：这是大图：

```
BEGIN TRAN

DECLARE @CONTACT_ID VARCHAR(15)
DECLARE @TYPE VARCHAR(15)
DECLARE @INDEX_NO  SMALLINT
DECLARE @COUNTER SMALLINT
DECLARE @FETCH_STATUS INT 

DECLARE OUTER_CURSOR CURSOR 

FOR 

SELECT CONTACT_ID, TYPE, INDEX_NO FROM CONTACTS
WHERE  
CONTACT_ID IN (SELECT CONTACT_ID FROM dbo.CONTACTS
WHERE CONTACT_ID IN(...)
GROUP BY CONTACT_ID, TYPE, INDEX_NO
HAVING COUNT(*) > 1

OPEN OUTER_CURSOR 

FETCH NEXT FROM OUTER_CURSOR INTO @CONTACT_ID,  @TYPE, @INDEX_NO
WHILE (@@FETCH_STATUS <> -1)
BEGIN
IF (@@FETCH_STATUS <> -2)

SET @COUNTER = 1

        DECLARE INNER_CURSOR CURSOR 
        FOR 
        SELECT * FROM CONTACTS
        WHERE CONTACT_ID = @CONTACT_ID
        AND TYPE = @TYPE 
        FOR UPDATE 

        OPEN INNER_CURSOR 

        FETCH NEXT FROM INNER_CURSOR 

        WHILE (@@FETCH_STATUS <> -1)
        BEGIN
        IF (@@FETCH_STATUS <> -2)

        UPDATE CONTACTS
        SET INDEX_NO = @COUNTER
        WHERE CURRENT OF INNER_CURSOR

        SET @COUNTER = @COUNTER + 1

        FETCH NEXT FROM INNER_CURSOR 
        END
        CLOSE INNER_CURSOR
        DEALLOCATE INNER_CURSOR

FETCH NEXT FROM OUTER_CURSOR INTO @CONTACT_ID,  @TYPE, @INDEX_NO
END
CLOSE OUTER_CURSOR
DEALLOCATE OUTER_CURSOR

COMMIT TRAN 
```

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-01-22T13:18:36.917

你有各种各样的问题。首先，为什么要使用特定的 @@FETCH_STATUS 值？它应该只是@@FETCH_STATUS = 0。

其次，你没有选择你的内部光标*到*任何东西。而且我想不出你会以这种方式选择所有字段的任何情况——把它们拼出来！

这是一个示例。文件夹有一个主键“ClientID”，它也是Attend 的外键。我只是打印所有的参加 UID，按文件夹 ClientID 细分：

```
Declare @ClientID int;
Declare @UID int;

DECLARE Cur1 CURSOR FOR
    SELECT ClientID From Folder;

OPEN Cur1
FETCH NEXT FROM Cur1 INTO @ClientID;
WHILE @@FETCH_STATUS = 0
BEGIN
    PRINT 'Processing ClientID: ' + Cast(@ClientID as Varchar);
    DECLARE Cur2 CURSOR FOR
        SELECT UID FROM Attend Where ClientID=@ClientID;
    OPEN Cur2;
    FETCH NEXT FROM Cur2 INTO @UID;
    WHILE @@FETCH_STATUS = 0
    BEGIN
        PRINT 'Found UID: ' + Cast(@UID as Varchar);
        FETCH NEXT FROM Cur2 INTO @UID;
    END;
    CLOSE Cur2;
    DEALLOCATE Cur2;
    FETCH NEXT FROM Cur1 INTO @ClientID;
END;
PRINT 'DONE';
CLOSE Cur1;
DEALLOCATE Cur1; 
```

最后，您*确定*要在存储过程中执行类似的操作吗？滥用存储过程非常容易，并且在描述您的问题时经常会反映出问题。例如，我给出的示例可以使用标准的 select 调用更容易完成。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-22T13:57:48.227

您还可以通过完全避免游标来回避嵌套游标问题、一般游标问题和全局变量问题。

```
declare @rowid int
declare @rowid2 int
declare @id int
declare @type varchar(10)
declare @rows int
declare @rows2 int
declare @outer table (rowid int identity(1,1), id int, type varchar(100))
declare @inner table (rowid int  identity(1,1), clientid int, whatever int)

insert into @outer (id, type) 
Select id, type from sometable

select @rows = count(1) from @outer
while (@rows > 0)
Begin
    select top 1 @rowid = rowid, @id  = id, @type = type
    from @outer
    insert into @innner (clientid, whatever ) 
    select clientid whatever from contacts where contactid = @id
    select @rows2 = count(1) from @inner
    while (@rows2 > 0)
    Begin
        select top 1 /* stuff you want into some variables */
        /* Other statements you want to execute */
        delete from @inner where rowid = @rowid2
        select @rows2 = count(1) from @inner
    End  
    delete from @outer where rowid = @rowid
    select @rows = count(1) from @outer
End 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T13:17:35.343

你有没有更多的提取？你也应该展示这些。你只向我们展示了一半的代码。

它应该看起来像：

```
FETCH NEXT FROM @Outer INTO ...
WHILE @@FETCH_STATUS = 0
BEGIN
  DECLARE @Inner...
  OPEN @Inner
  FETCH NEXT FROM @Inner INTO ...
  WHILE @@FETCH_STATUS = 0
  BEGIN
  ...
    FETCH NEXT FROM @Inner INTO ...
  END
  CLOSE @Inner
  DEALLOCATE @Inner
  FETCH NEXT FROM @Outer INTO ...
END
CLOSE @Outer
DEALLOCATE @Outer 
```

此外，请确保您不要将游标命名为相同的名称......并且任何被调用的代码（检查您的触发器）都不会使用名称相同的游标。我已经看到人们在堆栈的多个层中使用“theCursor”的奇怪行为。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T13:58:46.100

这闻起来应该用 JOIN 代替。你能和我们分享更大的问题吗？

* * *

嘿，我应该可以把它归结为一个语句，但我今天还没有时间进一步研究它，可能无法做到。同时，您应该能够使用[ROW_NUMBER()](http://msdn.microsoft.com/en-us/library/ms186734.aspx)函数编辑内部游标的查询以创建行号作为查询的一部分。从那里，您可以通过对其执行 INNER JOIN 将内部光标折叠到外部光标（您可以加入子查询）。最后，任何 SELECT 语句都可以使用此方法转换为 UPDATE：

```
UPDATE [YourTable/Alias]
   SET [Column] = q.Value
FROM
(
   ... complicate select query here ...
) q 
```

`[YourTable/Alias]`选择查询中使用的表或别名在哪里。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-02-17T16:34:44.670

我有同样的问题，

您要做的就是将第二个游标声明为： DECLARE [second_cursor] Cursor LOCAL For

你看到“CURSOR LOCAL FOR”而不是“CURSOR FOR”

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T07:50:58.527

我不完全理解*“更新当前游标”*的问题是什么，但通过对内部游标使用两次 fetch 语句来解决它：

```
FETCH NEXT FROM INNER_CURSOR

WHILE (@@FETCH_STATUS <> -1)
BEGIN

UPDATE CONTACTS
SET INDEX_NO = @COUNTER
WHERE CURRENT OF INNER_CURSOR

SET @COUNTER = @COUNTER + 1

FETCH NEXT FROM INNER_CURSOR
FETCH NEXT FROM INNER_CURSOR
END 
```

# sql-server - 如何将数据集合传递到 SQL Server 2003 中的 T-SQL 存储过程

> ID：469026
> 
> 赞同：2
> 
> 时间：2009-01-22T13:04:15.620
> 
> 标签：sql-server

我有一个存储过程，理想情况下应该能够接受来自数据库客户端的 NVARCHAR 列表/表。我知道 SQL Server 2008 中的表参数，但我坚持运行 SQL Server 2003。

目前，我在客户端用分隔符连接字符串，将结果字符串作为 NVARCHAR 参数传递，然后在进入存储过程时将字符串分开，但这还有很多不足之处。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T13:20:22.823

你看过 XML 的传递吗？

所以，对于 XML 有点像：

```
<ArrayOfService xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Service Id="2" Name="AUSTRALIA" Code="AUS" />
  <Service Id="10" Name="FAR EAST" Code="FEE" />
</ArrayOfService> 
```

在 SQL Server 2005 中，您可以执行以下操作：

```
-- Lookup Services
DECLARE @ServiceXml AS XML

CREATE TABLE #Service
(
    Id INT,
    [Name] VARCHAR( 50 ),
    Code VARCHAR( 10 )
)

INSERT INTO #Service
(
    Id,
    [Name],
    Code
)
SELECT
    CASE
        WHEN LegsTbl.rows.value('@Id', 'nvarchar(255)') = '' THEN NULL
        WHEN LegsTbl.rows.value('@Id', 'int') = 0 THEN NULL
        ELSE LegsTbl.rows.value('@Id', 'int')
    END AS Id,
    LegsTbl.rows.value('@Name', 'varchar(50)') AS [Name],
    LegsTbl.rows.value('@Code', 'varchar(50)') AS TopazCode
FROM
    @ServiceXml.nodes('/ArrayOfService/Service') LegsTbl(rows) 
```

或 SQL Server 2000：

```
DECLARE @ServiceXml AS NTEXT
DECLARE @iServiceXml AS INT

--Create an internal representation of the XML document.
EXEC sp_xml_preparedocument @iServiceXml OUTPUT, @ServiceXml

CREATE TABLE #Service
(
    Id INT,
    [Name] VARCHAR( 50 ),
    Code VARCHAR( 10 )
)

INSERT INTO #Service
(
    Id,
    [Name],
    Code
)
SELECT
    Id,
    Name,
    Code
FROM
OPENXML( @iServiceXml, '/ArrayOfService/Service', 3)
    WITH (Link8Id   int '@Id',
          Name  varchar(50) '@Name',
          Code  varchar(10) '@TopazCode') 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T13:23:14.597

在 SQL2005 中（我假设你的意思是？）我建立了一个 XML 字符串并传递它

```
CREATE PROCEDURE dbo.ig_SelectRecentConfigurableAppsByMakes
(
    @MakesXML       XML,    -- <makes><value>GMC</value>...</makes>
    @TopN           INT
)
AS
    DECLARE @Makes TABLE (Make NVARCHAR(30))
    INSERT INTO @Makes
    SELECT ParamValues.make.value('.','NVARCHAR(30)')
      FROM @MakesXML.nodes('makes/value') AS ParamValues(make)
    ; 
```

# c# - 如何处理不允许在c#中的接口中定义类型

> ID：469028
> 
> 赞同：2
> 
> 时间：2009-01-22T13:05:39.767
> 
> 标签：c#

我经常发现需要按照以下方式做一些事情：

```
public class OperationResult
{
  bool succes;
  SomeOtherObject someobject;
}

public interface ICanDoSomethingWeird
{
  OperationResult DoMyThing();
} 
```

其中 OperationResult 确实是一个属于 ICanDoSomethingWeird 接口的类。我觉得很烦人，我不能把它放在接口的命名空间中。我想知道其他人如何处理这个问题。您只是将其粘贴在全局名称空间中吗？还是从接口所在的命名空间上移一个命名空间？

我目前的方法是将 OperationResult 类重命名为 ICanDoSomethingWeird_OperationResult，但对它的漂亮印象并不深刻:)

有人有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-22T13:11:50.673

如果`OperationResult`是 仅由`ICanDoSomethingWeird`和 的客户使用的类型`ICanDoSomethingWeird`，则它属于与 相同的“上下文” `ICanDoSomethingWeird`。也就是说，它*属于*与以下*相同*的命名空间`ICanDoSomethingWeird`：

```
namespace MyNamespace
{
    public class OperationResult {}

    public interface ICanDoSomethingWeird
    {
        OperationResult DoMyThing();
    }
} 
```

考虑客户端代码。你更喜欢这个：

```
using MyNamespace;

ICanDoSomethingWeird myWeirdThing = ...;
ICanDoSomethingWeird.OperationResult result = myWeirdThing.DoMyThing(); 
```

或这个：

```
using MyNamespace;

ICanDoSomethingWeird myWeirdThing = ...;
OperationResult result = myWeirdThing.DoMyThing(); 
```

后者对我来说更有意义，并且是涉及接口的唯一选择。您不能在接口中声明内部类型。请注意有关嵌套类型的[一般建议：](http://en.csharp-online.net/.NET_Type_Design_Guidelines%E2%80%94Nested_Types)

> 如果类型可能在包含类型之外被引用，则不要使用嵌套类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T13:18:46.243

接口不定义任何实现。通过包含一个类，您的接口实际上包含了一些实现。嵌套类的目的是帮助定义它的类实现。

不应使用嵌套类，就好像该类在与包含类一起使用之外具有其他优点。不应将类用作命名空间的代理来定义其他类。

如果一个接口定义了一些需要使用一个尚不存在的类的行为，那么在该接口所属的同一个命名空间中创建该类是有意义的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T13:17:05.937

您可以将接口定义为抽象类，然后定义公共内部类。

```
 public interface ICanDoSomething

 public abstract class AbstractCanDoSomething
 {
     public class OperationResult
     {
          public bool SomeValue { get; set; }
          public int SomeOherVAlue { get; set; }
     }

     public abstract OperationResult DoMyThing();
 } 
```

# c# - 如果一个程序的一个副本正在运行另一个将无法打开，如何做到这一点？

> ID：469030
> 
> 赞同：4
> 
> 时间：2009-01-22T13:06:00.140
> 
> 标签：c#, .net

如果一个程序的一个副本正在运行另一个将无法打开，如何做到这一点？

或者更好的是，如何做到这一点，如果一个副本已经在运行，那么尝试运行另一个副本就像您最大化原始进程一样？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T13:09:30.320

Scott Hanselman 写[了一篇关于做这种事情的帖子](http://www.hanselman.com/blog/TheWeeklySourceCode31SingleInstanceWinFormsAndMicrosoftVisualBasicdll.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T13:11:24.730

本文

[真正的单实例应用程序 - WinForms.NET](http://www.openwinforms.com/single_instance_application.html)

解释了如何创建一个*真正*的单一实例：

> 本文简单地解释了如何创建一个可以控制其实例数量或仅运行单个实例的 Windows 应用程序。这是业务应用程序非常典型的需求。已经有很多其他可能的解决方案来控制这一点。
> 
> 例如，使用我们的应用程序名称检查进程列表。但是这种方法似乎不是一个很好的方法，因为一切都是根据应用程序名称决定的，应用程序名称可能是唯一的，也可能不是唯一的。

```
using System;
using Microsoft.VisualBasic.ApplicationServices;

namespace Owf
{
  public class SingleInstanceController
    : WindowsFormsApplicationBase
  {
    public SingleInstanceController()
    {
      // Set whether the application is single instance
      this.IsSingleInstance = true;

      this.StartupNextInstance += new 
        StartupNextInstanceEventHandler(this_StartupNextInstance);
    }

    void this_StartupNextInstance(object sender, 
                      StartupNextInstanceEventArgs e)
    {
      // Here you get the control when any other instance is 
      // invoked apart from the first one. 
      // You have args here in e.CommandLine.

      // You custom code which should be run on other instances
    }

    protected override void OnCreateMainForm()
    {
      // Instantiate your main application form
      this.MainForm = new Form1();
    }
  }
} 
```

以这种方式更改您的主要功能：

```
[STAThread]
static void Main()
{
  string[] args = Environment.GetCommand
  SingleInstanceController controller = new SingleInstanceController();
  controller.Run(args);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T13:12:21.717

您最好的选择是使用命名互斥体。这些文章很好地解释了设计并提供了所有必要的代码：

[http://sanity-free.org/143/csharp_dotnet_single_instance_application.html](http://sanity-free.org/143/csharp_dotnet_single_instance_application.html)

[http://iridescence.no/post/CreatingaSingleInstanceApplicationinC.aspx](http://iridescence.no/post/CreatingaSingleInstanceApplicationinC.aspx)

扩展它以最大化正在运行的应用程序的主窗口应该是对所提供的任何一个示例的简单更改。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-22T13:09:41.910

您可以使用[Mutex](http://msdn.microsoft.com/en-us/library/system.threading.mutex(VS.71).aspx)使您的应用程序成为单例。有很多[例子](http://www.codeproject.com/KB/cs/singleinstanceapplication.aspx)如何做到这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T13:11:38.990

Microsoft.VisualBasic.dll 程序集包含一个类“WinformsFormsApplicationBase”，其中包含一些您想要的功能。您也可以在 C# 应用程序中使用此类。

只需创建一个继承自此类的类。将 SingleInstance 属性设置为 true 并覆盖必要的方法。

当然，这意味着您引用了 VisualBasic.dll 程序集，这可能被视为一个缺点，但是，我认为这是迄今为止最简单和最简单的解决方案。

更多信息可以在[这里找到](http://www.openwinforms.com/single_instance_application.html)

# php - Why won't my Gmail login work using PHP and CURL?

> ID：469047
> 
> 赞同：1
> 
> 时间：2009-01-22T13:11:33.700
> 
> 标签：php, authentication, curl

I'm implementing one project using PHP, in that I want to login into a page automatically . The code is below.

```
$ch = curl_init();
$postdata="Email=$username&Passwd=$password&continue=https://www.mail.google.com";
curl_setopt ($ch, CURLOPT_URL,"https://www.google.com");
curl_setopt ($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt ($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.6) Gecko/20070725 Firefox/2.0.0.6");
curl_setopt ($ch, CURLOPT_TIMEOUT, 60);
curl_setopt ($ch, CURLOPT_FOLLOWLOCATION, 1);
curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt ($ch, CURLOPT_COOKIEJAR, $gacookie);
curl_setopt ($ch, CURLOPT_COOKIEFILE, $gacookie);
curl_setopt ($ch, CURLOPT_REFERER, 'https://www.google.com');
curl_setopt ($ch, CURLOPT_POSTFIELDS, $postdata);
curl_setopt ($ch, CURLOPT_POST, 1);
$AskApache_result = curl_exec ($ch);
curl_close($ch);
echo $AskApache_result;
unlink($gacookie);
?> 
```

But it won't work. Any ideas?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-22T13:20:09.220

首先：“它不起作用”并没有给我们提供太多信息和上下文来帮助您解决问题。

要回答您的问题，请尝试提供**详细信息**，例如：

*   哪个特定部分不起作用？
*   您收到任何错误消息吗？
*   您的代码在什么操作系统上运行？

它还有助于使用更具**描述性的问题标题**。“PHP 和 CURL”并没有给我们太多相关信息，而“执行 CURL 请求时如何解决错误 x123”会更有帮助。

反正。查看您的代码，至少有**一个**错误：

```
curl_setopt ($ch, CURLOPT_REFERER, 'https://www.google.com"); 
```

应该：

```
curl_setopt ($ch, CURLOPT_REFERER, "https://www.google.com"); 
```

**澄清：**第三个参数以单引号开始，以双引号结束。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-08-23T01:17:38.133

```
curl_setopt ($ch, CURLOPT_FOLLOWLOCATION, 1); 
```

最有可能的问题是，在大多数共享（和免费）网络主机上禁用该选项，因为它会带来安全风险。

# algorithm - 排序值，但前提是它们比当前顺序多 X

> ID：469055
> 
> 赞同：4
> 
> 时间：2009-01-22T13:13:12.730
> 
> 标签：algorithm, delphi, sorting

我一直在搜索谷歌（当然还有堆栈溢出！），寻找一种按值对整数列表进行排序的方法，但也按一个额外的因素。我想我正在寻找某种算法来实现。到目前为止，我在 Delphi 2007 中有一个数组，它对值从最大到最小进行排序，但现在我希望它对列表中仅比前一个数字多 X 的值进行排序。

例如，值 5、7、25、15 目前排序为 25、15、7、5。我现在尝试得到的顺序，X 值为 5，是 25、15、5、7。如您可以看到，5 和 7 没有交换位置，因为它们之间的差异不超过 5。

不确定我是否解释得特别好，但这是一般的想法。

另一个例子是值 10、40、18、20、16、28。排序后，它们应该是 40、28、18、20、16、10。18、20 和 16 没有移动，因为再次，那里每个数字之间不超过5。

其背后的想法是，与数字相关的项目（例如订购某物的次数）不会因为只有 1 或 2 的差异而一直在变化。例如，如果最频繁订购的纸张按购买频率显示在网页上，那么只有当用户订购的特定类型纸张的订购量是下一个最频繁订购量的五倍以上时，它才会改变用户的顺序。

希望这是有道理的，并感谢您的时间！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T19:34:36.923

至少您需要使用稳定的排序，即保留等效值排序的排序。

一旦你有了它，你可能应该将你的比较定义为 if `abs(a - b)<5`， equals ，否则，进行正常比较。这使得`compare(a, b)==compare(b, a)`，这是大多数优秀的排序实现都应该断言的。

如果您使用的是 C++，您可以使用它`std::stable_sort`来执行此操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T13:51:39.877

我认为您的要求会导致非常奇怪的结果。最终，您可以有一个排序顺序，其中项目的排序方式完全错误，它们的排序方式取决于它们的变化方式。

我认为您需要建立值的“类别”（使用百分位数？），然后在每个类别中按字母顺序对报纸进行排序。

例如：几乎没有排序（90% 的论文的排序比这一篇多）、低于中位数（50% 的报纸的排序多于这些）、高于中位数、排序前 10 名（当然按订单数排序）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T13:19:31.767

再考虑一下，我认为冒泡排序是唯一可行的排序类型。这是因为在冒泡排序中，数字必须显式大于（或在本例中大于 5）高于其上方的数字，以便它们改变位置。这正是您所要求的。

从高层次的角度来看，我认为你需要的是：

1.  采用自定义比较函数的冒泡排序实现。

2.  如果差值小于 5，则返回 equal 的比较函数。

合并这两件事应该会让你得到你所追求的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T09:02:19.413

有两件事情对这个工作很重要：

*   1）您需要一个稳定的排序算法（虽然它不需要是冒泡排序，但它可能不应该），这意味着如果比较器返回 0（=equal），它会保留原始顺序。请参阅[维基百科对排序算法的比较](http://en.wikipedia.org/wiki/Sorting_algorithm#List_of_sorting_algorithms)以获得很好的概述。*   2）您需要一个自定义比较器，在您提到的那些情况下返回 0。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T22:29:03.060

我认为这需要两次通过。在第一遍中，识别任何需要排序的值，在第二遍中，实际上只移动那些被识别的值。在您的第二个示例中，使用 Y/N 数组，其中 Y 进行排序，您最终会得到 [ Y, Y, N, N, N, Y ]，然后仅对值 Y 进行排序，N 将是“忽略不符合排序条件”，您将得到 [40, 28, 18, 20, 16, 10] 的结果列表。N 的组（将始终是基于定义的组）应与其组中最高的值进行比较。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-23T08:44:18.077

将排序原则应用于几乎排序的列表可能是有意义的，但您应该意识到它违反了一般排序算法的基本假设：要排序的元素形成一个总顺序。这大致意味着 < 运算符的行为方式与实数的行为方式相同。如果你违反了这条规则，那么你会得到奇怪的效果，并且库算法甚至可能不会终止（甚至崩溃，我已经看到这种情况发生在 C++ 中的 std::sort 中）。

修改您的想法以使其成为总订单的一种方法是对每个数字进行排序，向下舍入到最接近的 5 倍数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-24T00:09:54.777

TList.Sort 不起作用，因为它使用了 mghie 评论的快速排序算法。

冒泡排序算法不是那么快，这里有实现，所以你可以试试，这次是帕斯卡。

```
var I,N,T,D:Integer ;
    A:array of Integer;
    Change:Boolean;
begin

  SetLength(A, 4);
  A[0] := 5;
  A[1] := 7;
  A[2] := 25;
  A[3] := 15;

  Change := True;
  N := High(A);

  while Change do
  begin
    Change := false;

    for I := 1 to N do
    begin
       D := A[I]-A[I-1];

       if  (D > 5)  then
       begin
          T := A[I-1];
          A[I-1] := A[I];
          A[I] := T;
          Change := true;
       end;
    end;
  end;
end; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-22T23:48:26.147

尝试使用自定义比较函数进行排序，如果将 TList 填充为数字并调用 MyList.Sort(myCompareFunc); 可以快速尝试。

```
function  myCompareFunc(item1,item2:Pointer):Integer;
var 
 v1,v2:Integer;
begin

  v1 := (integer)item1;
  v2 := (integer)item2;

  if v1 > v2 then 
       result := 1
  else if (v1 < v2 )
       result := -1
  else 
       result := 0

  //most important
  if abs(v1-v2) < 5 result := 0 ; 

end; 
```

# html - 与.. 使用哪个？

> ID：469059
> 
> 赞同：1801
> 
> 时间：2009-01-22T13:14:11.357
> 
> 标签：html, html-input

在查看大多数网站（包括 SO）时，他们中的大多数使用：

```
<input type="button" /> 
```

代替：

```
<button></button> 
```

*   如果有的话，两者之间的主要区别是什么？
*   是否有正当理由使用其中一个而不是另一个？
*   有正当理由使用组合它们吗？
*   使用是否`<button>`带有兼容性问题，看到它不是很广泛使用？

* * *

## 回答 #1

> 赞同：708
> 
> 时间：2009-01-22T13:20:02.687

*   [这是一个](http://web.archive.org/web/20110721191046/http://particletree.com/features/rediscovering-the-button-element/)描述差异的页面（基本上你可以将 html 放入 a `<button></button>`）
*   [另一个页面](http://www.peterbe.com/plog/button-tag-in-IE)描述了人们为什么避免`<button></button>`（提示：IE6）

使用时的另一个 IE 问题`<button />`：

> 当我们谈论 IE 时，它有几个与按钮宽度相关的错误。当您尝试添加样式时，它会神秘地添加额外的填充，这意味着您必须添加一个小技巧来控制事情。

* * *

## 回答 #2

> 赞同：376
> 
> 时间：2012-04-09T20:13:44.607

就像旁注一样，`<button>`将隐式提交，如果您想在表单中使用按钮而不提交，这可能会导致问题。因此，另一个使用`<input type="button">`(or `<button type="button">`)的理由

**编辑**-*更多细节*

如果没有类型，[`button`则隐式接收`submit`](https://www.w3.org/wiki/HTML/Elements/button). 无论表单中有多少提交按钮或输入，其中任何一个显式或隐式键入为提交时，单击时都会提交表单。

按钮支持 3 种类型

```
submit ||  "submits the form when clicked (default)"
reset  ||  "resets the fields in the form when clicked"
button ||  "clickable, but without any event handler until one is assigned" 
```

* * *

## 回答 #3

> 赞同：185
> 
> 时间：2009-01-22T13:19:04.683

[这篇文章](http://web.archive.org/web/20110721191046/http://particletree.com/features/rediscovering-the-button-element/)似乎很好地概述了这种差异。

从页面：

> 使用 BUTTON 元素创建的按钮功能与使用 INPUT 元素创建的按钮一样，但它们提供了更丰富的呈现可能性：BUTTON 元素可能具有内容。例如，包含图像的 BUTTON 元素的功能类似于并且可能类似于类型设置为“图像”的 INPUT 元素，但 BUTTON 元素类型允许内容。
> 
> *按钮元素 - W3C*

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2012-03-28T04:27:58.623

您可以在`<button>`元素内放置内容，例如文本或图像。

```
<button type="button">Click Me!</button> 
```

这是此元素与使用该元素创建的按钮之间的区别`<input>`。

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2009-01-22T13:18:19.210

引用

> 重要提示：如果您在 HTML 表单中使用按钮元素，不同的浏览器将提交不同的值。Internet Explorer 将提交`<button>`and`</button>`标记之间的文本，而其他浏览器将提交 value 属性的内容。使用 input 元素在 HTML 表单中创建按钮。

来自：[http ://www.w3schools.com/tags/tag_button.asp](http://www.w3schools.com/tags/tag_button.asp)

如果我理解正确，答案是浏览器之间的兼容性和输入一致性

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2014-11-08T14:31:26.827

我将引用文章[锚点、输入和按钮之间的区别](http://davidwalsh.name/html5-buttons)：

**锚点**（`<a>`元素）代表超链接，一个人可以在浏览器中导航或下载的资源。如果您想允许您的用户移动到新页面或下载文件，请使用锚点。

一个**输入**( `<input>`) 代表一个数据字段：因此您打算将一些用户数据发送到服务器。有几种与按钮相关的输入类型：

*   `<input type="submit">`
*   `<input type="image">`
*   `<input type="file">`
*   `<input type="reset">`
*   `<input type="button">`

它们中的每一个都有一个含义，例如“ *file* ”用于上传文件，“ *reset* ”用于清除表单，“ *submit* ”用于将数据发送到服务器。检查[MDN](https://developer.mozilla.org/docs/Web/HTML/Element/Input)或[W3Schools](http://www.w3schools.com/tags/tag_input.asp)上的 W3 参考。

**按钮**(`<button>)`元素非常通用：

*   您可以在按钮中嵌套元素，例如图像、段落或标题；
*   按钮也可以包含伪元素`::before`；`::after`
*   按钮支持该`disabled`属性。这使得打开和关闭它们变得容易。

再次，检查[MDN](https://developer.mozilla.org/docs/Web/HTML/Element/Button)或[W3Schools](http://www.w3schools.com/tags/tag_button.asp)`<button>`上的标记的 W3 参考。

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2009-01-22T13:19:21.563

引用HTML 手册中的[表单页面：](http://www.w3.org/TR/html401/interact/forms.html#h-17.5)

> 使用 BUTTON 元素创建的按钮功能与使用 INPUT 元素创建的按钮一样，但它们提供了更丰富的呈现可能性：BUTTON 元素可能具有内容。例如，包含图像的 BUTTON 元素的功能类似于并且可能类似于类型设置为“图像”的 INPUT 元素，但 BUTTON 元素类型允许内容。

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2011-03-01T08:17:00.687

如果要在表单中创建按钮，请使用输入元素中的按钮。如果要为操作创建按钮，请使用按钮标记。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2017-10-31T08:46:43.643

```
<button> 
```

*   默认情况下，它的行为就像它具有“type="submit" 属性
*   可以在没有表格的情况下使用，也可以在表格中使用。
*   允许文本或 html 内容
*   允许使用 css 伪元素（例如 :before）
*   标签名称通常对单个表单是唯一的

对比

```
<input type='button'> 
```

*   type 应设置为 'submit' 以充当提交元素
*   只能在表格中使用。
*   只允许文本内容
*   没有 CSS 伪元素
*   与大多数表单元素（输入）相同的标签名称

--
在现代浏览器中，这两个元素都可以使用 css 轻松设置样式，但在大多数情况下，`button`元素是首选，因为您可以使用内部 html 和伪元素设置更多样式

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2020-03-11T14:54:47.677

尽管这是一个非常古老的问题，可能不再相关，但请记住，`<button>`标签过去存在的大多数问题不再存在，因此强烈建议使用它。

如果由于各种原因您不能这样做，请记住在您的标签中添加属性 role=”button” 作为可访问性。这篇文章信息量很大：[https ://www.deque.com/blog/accessible-aria-buttons/](https://www.deque.com/blog/accessible-aria-buttons/)

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2015-07-30T04:33:46.410

就 CSS 样式而言，`<button type="submit" class="Btn">Example</button>`它更好，因为它使您能够使用 CSS`:before`和可以提供帮助的`:after` [伪类。](https://developer.mozilla.org/en/docs/Web/CSS/content)

由于在某些情况下`<input type="button">`视觉呈现与类不同`<a>`或`<span>`在使用类样式时，我避免使用它们。

值得注意的是，[当前的最佳答案](https://stackoverflow.com/questions/469059/button-vs-input-type-button-which-to-use/469084#469084)是在 2009 年编写的。IE6 现在不是问题，所以`<button type="submit">Wins</button>`在我看来，样式一致性是最重要的。

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2017-06-19T10:20:24.840

我只想在这里的其余答案中添加一些内容。输入元素被认为是空或空元素（其他空元素是 area 、 base 、 br 、 col 、 hr 、 img 、 input 、 link 、 meta 和 param 。您也可以[在这里查看](https://developer.mozilla.org/en-US/docs/Glossary/Empty_element)），这意味着它们不能有任何内容。除了没有任何内容之外，空元素**不能有任何伪元素，如 ::after 和 ::before**，我认为这是一个主要缺点。

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2015-12-21T17:12:30.830

如果您使用 jQuery，则会有很大的不同。jQuery 知道输入事件比按钮事件多。在按钮上，jQuery 只知道“点击”事件。在输入上，jQuery 知道 'click'、'focus' 和 'blur' 事件。

您总是可以根据需要将事件绑定到您的按钮，但请注意 jQuery 自动识别的事件是不同的。例如，如果您创建了一个在页面上有“focusin”事件时执行的函数，则输入会触发该函数，但按钮不会。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2014-06-27T22:51:11.147

`<button>`很灵活，因为它可以包含 HTML。此外，使用 CSS 设置样式要容易得多，并且样式实际上可以应用于所有浏览器。但是，Internet Explorer 也有一些缺点（Eww！IE！）。Internet Explorer 未正确检测 value 属性，使用标记的内容作为值。无论按钮是否被点击，表单中的所有值都会发送到服务器端。这使得使用它`<button type="submit">`变得既棘手又痛苦。

`<input type="submit">`另一方面，没有任何价值或检测问题，但是您不能像使用`<button>`. 样式也更难，并且样式并不总是在所有浏览器中都能很好地响应。希望这有帮助。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2016-01-02T08:23:22.450

此外，差异之一可能来自库的提供者，以及他们编码的内容。例如，这里我将cordova平台与移动角度用户界面结合使用，虽然输入/div/etc标签与ng-click配合得很好，但该按钮可能会导致Visual Studio调试器崩溃，这肯定是由于程序员造成的差异；请注意，MattC 的回答指向了同样的问题，jQuery 只是一个库，并且提供者没有想到一个元素上的某些功能，而他/她在另一个元素上提供了这些功能。因此，当您使用库时，您可能会遇到一个元素的问题，而您不会遇到另一个元素。简单来说，流行的喜欢`input`，将主要是固定的，只是因为它更受欢迎。

# sql - 如何在存储过程之间共享数据

> ID：469062
> 
> 赞同：5
> 
> 时间：2009-01-22T13:15:38.793
> 
> 标签：sql, sql-server, stored-procedures

在 MS SqlServer 中，存在许多与在另一个存储过程中共享一个存储过程的数据结果相关的问题。

根据 SQL Server 的版本，人们会建议使用临时表、xml (SQLServer 2005) 或表变量 (SQL Server 2008)。

[Erland Sommarskog](http://www.sommarskog.se)写了一篇很棒的文章，提供了全面的答案并列出了不同版本的 SQL 中可用的所有选项：

*   [如何在存储过程之间共享数据](http://www.sommarskog.se/share_data.html)

我觉得值得分享。

*[我在阅读 deevus](https://stackoverflow.com/questions/464191/assign-function-result-to-a-table-variable#464198)建议使用[INSERT-EXEC Statement](http://www.sommarskog.se/share_data.html#INSERTEXEC)的答案时遇到了那篇文章，这是我以前并不熟悉的东西*

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-22T13:15:59.743

[Erland Sommarskog](http://www.sommarskog.se)写了一篇很棒的文章，提供了全面的答案并列出了不同版本的 SQL 中可用的所有选项：

*   [如何在存储过程之间共享数据](http://www.sommarskog.se/share_data.html)

> 本文解决了两个相关问题：
> 
> *   如何在另一个存储过程中使用结果集，也表示为如何在 SELECT 语句中使用存储过程中的结果集？
> *   如何将表作为参数从一个存储过程传递到另一个存储过程？
> 
> 在本文中，我将讨论一些方法，并指出它们的优缺点。某些方法仅在您想要重用结果集时适用，而其他方法则适用于这两种情况。在您想要重用结果集的情况下，大多数方法都要求您以一种或另一种方式重写存储过程，但也有一些方法不需要。

# ruby-on-rails - 有没有一种 RESTful 方式来为 habtm 配置路由？

> ID：469067
> 
> 赞同：8
> 
> 时间：2009-01-22T13:16:42.647
> 
> 标签：ruby-on-rails, ruby, rest, routes, has-and-belongs-to-many

在 Rails 中，您可以使用嵌套路由为 has_one 和 has_many 关系创建 RESTful 路由。示例可以在[Rails 指南中找到](http://guides.rails.info/routing_outside_in.html#_nested_resources)

我想问一下是否有一种为habtm关系配置RESTful路由的好方法？例如，如果我有一个关系 A-habtm-B，我的想法是为 A has_many B 配置嵌套路由，为 B has_many A 配置嵌套路由。这样行吗？或者，还有更好的方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T14:48:19.730

由于 HABTM 是双向`has_many`关联，因此您的方法是正确的，并且双方的嵌套资源都可以正常工作。除此之外，我会重新考虑使用`has_many :through`关联而不是 HABTM，因为它更通用。

# c# - 每当在树视图中添加新节点时创建事件处理程序

> ID：469072
> 
> 赞同：2
> 
> 时间：2009-01-22T13:18:01.877
> 
> 标签：c#, asp.net

我想编写一个自定义类，当我在树视图中添加一个节点时，它应该调用一个事件。这样我就可以递归地运行它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T14:32:56.640

我很少使用TreeView，但乍一看这是我的第一印象。由于不能继承 TreeViewCollection，您可能必须在新类上创建一个单独的方法，该方法将实际添加到 Nodes 集合中。这将允许您参加一个活动。在你的继承类中是这样的：

```
public event EventHandler NodeAdded;

public void AddNode(TreeViewNode node)
{
    Nodes.Add(node);
    if (NodeAdded != null)
    {
        NodeAdded(this, EventArgs.Empty);
    }
} 
```

然后，您可以创建一个自定义 EventArgs 类并包含您可能想要使用的任何信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T15:03:54.347

不幸的是，由于 TreeNodeCollection 实际上是一棵树，我认为您将需要从头开始实现自己的树视图控件，使用带有事件的自定义树数据结构，或者找到第三方或开源的使用。

如果它是一个简单的集合，我会说只是将框架 TreeView 控件包装在自定义用户控件中，并隐藏 Nodes 属性，只公开您想要的访问器和修改器。然后，您可以在将调用传递到底层 TreeView 控件之前和/或之后触发控件的事件。但是，这只会在第一层节点上为您提供事件。

使用 mutator 事件创建 List 或 Dictionary 类很容易，因为您可以像这样包装它们。但是树是必须实现的皇家痛苦，特别是如果您要分发或出售使用它的代码。不幸的是，我们基本上没有从 .NET 框架中获得任何帮助。由于实现树结构的所有复杂性，我**强烈**建议尝试找到一个预制的解决方案，无论是第三方的还是开源的。

# mfc-feature-pack - MFC DockablePane 不浮动或隐藏

> ID：469083
> 
> 赞同：0
> 
> 时间：2009-01-22T13:19:52.483
> 
> 标签：mfc-feature-pack, dockable

有什么方法可以使停靠在无法浮动或隐藏的窗口中的 MFC DockablePane（来自新功能包）无法浮动或隐藏（甚至禁用允许用户选择状态的上下文菜单 - 可停靠、浮动、隐藏ETC。）

我基本上想要的是在一个窗口上有3个窗格，可以改变它们的水平尺寸，但不能改变它们在窗口内的位置。有什么建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T11:14:23.527

解决方案是扩展 CDockablePane 并在此类中覆盖以下事件：

```
virtual BOOL CanFloat() const;
virtual BOOL CanBeClosed() const;
virtual BOOL CanAutoHide() const; 
```

使他们返回 FALSE；

有关详细信息，请参阅[MFC 扩展的 MSDN 自定义提示](http://msdn.microsoft.com/en-us/library/cc137828.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T16:53:02.987

尝试在创建窗口时更改 dwControlBarStyle（使用 CDockablePane::Create）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-10T08:47:47.797

另一个解决方案是，只需调用

```
CBasePane::SetControlBarStyle(AFX_CBRS_RESIZE|AFX_CBRS_CLOSE); 
```

# java - BlockingQueue：put() 和 isEmpty() 不能一起工作？

> ID：469089
> 
> 赞同：0
> 
> 时间：2009-01-22T13:21:09.390
> 
> 标签：java, multithreading, collections, producer-consumer

我想要一个`SynchronousQueue`从一个线程插入元素的地方`put()`，所以输入被阻塞，直到元素被另一个线程接收。

在另一个线程中，我执行大量计算，并且不时想要检查一个元素是否已经可用，并使用它。但似乎`isEmpty()`总是返回 true，即使另一个线程正在等待`put()`调用。

这怎么可能？这是示例代码：

```
@Test
public void testQueue() throws InterruptedException {
    final BlockingQueue<Integer> queue = new SynchronousQueue<Integer>();

    Thread t = new Thread(new Runnable() {
        @Override
        public void run() {
            while (true) {
                if (!queue.isEmpty()) {
                    try {
                        queue.take();
                        System.out.println("taken!");
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
                // do useful computations here (busy wait)
            }
        }
    });
    t.start();

    queue.put(1234);
    // this point is never reached!
    System.out.println("hello");
} 
```

**编辑：** isEmpty() 和 peek() 都不起作用，必须使用 poll()。谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-22T13:32:32.317

来自[http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/SynchronousQueue.html#put(E)](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/SynchronousQueue.html#put(E))：

**isEmpty**
public boolean isEmpty()
总是返回真。SynchronousQueue 没有内部容量。

（尚未对此进行详细研究，但您可能想看看*poll*或*take*代替）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T13:36:05.897

除了蒂姆的回答——你在消费者线程中什么都不做，而是在一个紧密的循环中不断地调用 isEmpty() 。与其要求操作系统在有一些有用的事情要做之前不要运行它，而是消费者线程一直很忙。即使 isEmpty 正常工作，生产者线程也很少有机会运行。

您可以（如果 isEmpty() 确实有效，或者您切换到使用 poll()）在队列为空时让消费者在测试之间休眠一段时间，以便让生产者有机会运行，或者（最好）只是取出isEmpty() 测试并让线程以合理的方式阻塞在 take() 内的互斥锁上，而不是轮询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T14:59:18.663

您的代码看起来像您正在尝试进行民意调查。为什么不直接调用 poll() 方法呢？

# multithreading - 同一进程内的线程有多独立？

> ID：469092
> 
> 赞同：3
> 
> 时间：2009-01-22T13:21:39.017
> 
> 标签：multithreading, language-agnostic

现在，这可能是一个非常新手的问题，但我并没有真正的多线程编程经验，而且与进程相比，我还没有完全理解线程是如何工作的。

当我机器上的一个进程挂起时，比如说它正在等待一些永远不会到来的 IO 或类似的东西，我可以杀死并重新启动它，因为其他进程不受影响并且例如仍然可以操作我的终端。当然，这是非常明显的。

我不确定进程内的线程是否相同：如果一个挂起，其他的不受影响吗？换句话说，我可以运行一个“看门狗”线程来监督其他线程，例如杀死并重新创建挂起的线程吗？例如，如果我有一个线程池，我不想因为偶尔的挂断而耗尽精力。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T13:36:07.317

线程是独立的，但是进程和线程之间是有区别的，那就是在进程的情况下，操作系统不仅仅是“杀死”它。它也会在它之后清理。

如果您开始杀死似乎挂起的线程，很可能您会锁定资源和类似情况，如果您对进程执行相同操作，操作系统会为您关闭。

因此，例如，如果您打开一个文件进行写入，并开始生成数据并将其写入文件，并且该线程现在挂起，无论出于何种原因，终止该线程将使文件仍然打开，并且很可能被锁定，直到你关闭整个程序。

因此，您问题的真正答案是：不，您不能以艰难的方式杀死线程。

如果你只是要求一个线程关闭，那是不同的，因为线程仍然处于控制之中，并且可以在终止之前清理和关闭资源，但是调用像“KillThread”或类似的 API 函数是不好的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T13:24:45.903

如果一个线程挂起，其他线程将继续执行。但是，如果挂起的线程锁定了一个信号量、临界区或其他类型的同步对象，而另一个线程试图锁定同一个同步对象，那么您现在就会有两个死线程的死锁。

可以从一个线程监视其他线程。根据您的平台，有一些适用的 API：我指的是那些您没有说明您正在编写的操作系统的 API。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T13:24:51.427

你没有提到平台，但就我而言，NT内核调度线程，而不是进程并以这种方式独立地威胁它们。这在其他平台上可能不是，也不是真的（某些平台，如 Windows 3.1，不使用抢占式多线程，如果一个线程进入无限循环，一切都会受到影响）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T13:27:41.797

简单的答案是肯定的。

通常，尽管线程中的代码将自己处理这种可能的引擎盖。大多数情况下，许多执行可能挂起的操作的 API 都有自己的超时功能。

或者，线程不仅会等待可能挂起的操作，还会等待计时器。如果计时器首先发出信号，则假定操作已挂起。

因为要在这种情况下使用看门狗线程，需要与其他线程中的代码进行一些合作，让线程本身设置超时比看门狗更有意义。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T13:32:14.487

线程彼此独立调度。所以你确实可以停止并重新启动挂起的线程。线程不在单独的地址空间中运行，因此行为不端的线程仍然可以覆盖内存或获取同一进程中其他线程所需的锁。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-24T04:34:04.900

Java 文档中对杀死和挂起线程的一些陷阱进行了很好的概述，解释了为什么不推荐使用执行此操作的方法。基本上，如果你希望能够杀死一个线程，你必须非常非常小心地让它工作而不会出现某种损坏。如果一个线程被挂起，它可能是因为一个错误......在这种情况下，杀死它可能会导致损坏。

[http://java.sun.com/j2se/1.4.2/docs/guide/misc/threadPrimitiveDeprecation.html](http://java.sun.com/j2se/1.4.2/docs/guide/misc/threadPrimitiveDeprecation.html)

如果您需要能够杀死事物，请使用进程。

# .net - .Net 3.5 中的 XMLSerialization 是否仍然存在已知的内存泄漏？

> ID：469098
> 
> 赞同：5
> 
> 时间：2009-01-22T13:23:21.790
> 
> 标签：.net, memory-leaks

Tess Ferrandez 的这篇文章[http://blogs.msdn.com/tess/archive/2006/02/15/532804.aspx概述了为什么使用 XMLSerialization 会导致内存泄漏。](http://blogs.msdn.com/tess/archive/2006/02/15/532804.aspx)

泄漏是对象如何在内存中作为程序集实例化的结果，而不是对象，因此不是垃圾收集器的目标。

这篇文章最初是写在 1.0/1.1 CLR 上的，但是关于 2.0 CLR 的更新还不清楚。

我在一个仍处于测试阶段的 Web 应用程序中广泛使用 XMLSerialization/Deserialization 来进行 UI/服务器交换。对象只是 DTO（只有属性的对象）。

先感谢您！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-22T13:41:08.837

实际上导致泄漏的部分是 XML 引擎为序列化目的生成的程序集从未被收集。从 CLR 2.0SP1 (.Net 3.5) 开始，情况仍然如此。一旦程序集被加载到进程中，它将不会被删除，直到包含该程序集的 AppDomain 也被卸载。

但是，如果您在文章的底部注意到，她提到了一种让 XML 引擎重用程序集的方法，这样内存就不会失控。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T13:38:50.323

它在很大程度上是通过 .NET 2.0 DynamicMethod 解决的。但是，如果不使用 [XmlRoot] 属性，仍然会出现故障模式。查看[这篇文章](http://web.archive.org/web/20110303124832/http://msdn.microsoft.com/en-us/magazine/cc163491.aspx)了解详情。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T13:38:56.610

我在 2.0 中遇到了同样的问题，所以我可以确认内存泄漏仍然存在，但我没有使用 3.5 的经验。只要您只使用构造函数 XmlSerializer(type) 和 XmlSerializer(type, defaultNameSpace) 就应该是安全的，因为 XmlSerializer 将被自动缓存。如果您使用任何其他构造函数，则必须创建自己的缓存。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T18:56:50.260

谢谢你。似乎关键是使用 XmlSerializer(type) 并允许内存中的实例保持缓存。看来，如果您为类名设置别名，则缓存不起作用并且泄漏随之而来..我将不得不测试和监视以确定我们是否无泄漏。-达斯汀

# python - 在 Django 中，我如何返回与模型相关的项目总数？

> ID：469110
> 
> 赞同：1
> 
> 时间：2009-01-22T13:26:22.377
> 
> 标签：python, django

在 Django 中，我如何返回与另一个模型相关的项目总数（计数），例如，stackoverflow 执行问题列表的方式，然后在侧面显示与该问题相关的答案的计数。

如果我得到 questionid，这很容易，我可以返回与该问题相关的所有答案，但是当我显示整个问题列表时，在侧面显示显示总计数的计数变得有点棘手。

我不知道是否清楚，但想想stackoverflow如何显示它的问题和答案，每个问题旁边的视图计数！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T14:56:38.247

[查询集.count()](http://docs.djangoproject.com/en/dev/ref/models/querysets/#count)

另请参阅如何构建相关模型的查询集的[示例。](http://docs.djangoproject.com/en/dev/topics/db/queries/#following-relationships-backward)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T18:24:37.750

如果您愿意使用主干，您可以利用一周前添加的全新 annotate() QuerySet 方法，它解决了这个确切的问题：

[http://docs.djangoproject.com/en/dev/topics/db/aggregation/](http://docs.djangoproject.com/en/dev/topics/db/aggregation/)

如果您想坚持使用 Django 1.0，您可以使用 extra() QuerySet 方法的 select 参数以稍微不那么优雅的方式实现这一点。有一个例子说明你在这里使用 extra() 所谈论的内容：

[http://docs.djangoproject.com/en/dev/ref/models/querysets/#extra-select-none-where-none-params-none-tables-none-order-by-none-select-params-none](http://docs.djangoproject.com/en/dev/ref/models/querysets/#extra-select-none-where-none-params-none-tables-none-order-by-none-select-params-none)

最后，如果您需要它具有真正的高性能，您可以将计数非规范化到单独的列中。我在这里的演示文稿的单元测试部分中提供了一些如何执行此操作的示例：

[http://www.slideshare.net/simon/advanced-django](http://www.slideshare.net/simon/advanced-django)

# c# - 使用 C# 配置 Wifi 设置

> ID：469113
> 
> 赞同：2
> 
> 时间：2009-01-22T13:26:58.553
> 
> 标签：c#, windows-mobile, wifi

如何使用 C#（紧凑框架）为 Win Mobile 应用程序配置 Wifi 设置？

所以交易是：

*   配置网络（隐藏 AP 的 SSID）
*   使用 TKIP 进行 WPA 身份验证
*   强制用户和密码（不会提示最终用户进行身份验证）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T13:36:48.627

看看[智能设备框架](http://www.smartdeviceframework.com)。它有一个包含大量 WZC 功能的 NetworkInformation 命名空间。我知道它将使用 TKIP（以及开放）执行 WEP 和 WPA。它允许您传递密钥材料，设置大多数选项等。

具体看一下[WirelessZeroConfigNetworkInterface 类](http://www.opennetcf.com/library/sdf/html/e7233249-6758-6bec-b816-c2c0ad7f46b5.htm)和它的 AddPreferredNetwork 方法。

**编辑**：如果您对直接使用的 API 感到好奇，[请从这里开始](http://msdn.microsoft.com/en-us/library/aa930813.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T13:37:37.423

我不确定是否可以以编程方式更改这些设置。

配置服务提供商通常用于为设备提供此类设置（例如，它也用于 GPRS 设置）。

您所做的是创建一个包含特殊 _setup.xml 的特殊 CAB 文件，Windows Mobile 将使用该文件更改设置。

[在 MSDN 上](http://msdn.microsoft.com/en-us/library/ms889540.aspx)阅读它（这里是特定的[Wifi 配置](http://msdn.microsoft.com/en-us/library/aa455986.aspx)）。

另请注意，根据设备，您的 cab 文件需要由设备制造商签名（祝您好运……）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T13:59:54.057

或者，您可以使用[Connection Manager API](http://msdn.microsoft.com/en-us/library/aa457273.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-02-16T20:33:20.387

用户名和密码必须直接在注册表中设置。他们在`[HKCU]\Comm\Eapol\<ssid>\Identity`和`[HKCU]\Comm\Eapol\<ssid>\Password`。用户名是明文，密码是加密的。这些位置在平台构建器标头中定义`eapol.h`。

-保罗H

# virtualization - 对象模型设计中的重要规则是什么

> ID：469122
> 
> 赞同：5
> 
> 时间：2009-01-22T13:32:09.603
> 
> 标签：virtualization

我们正在为 GIS 应用程序开发一个扩展（在 C# .NET 环境中），它将具有用于建模现实世界对象的预定义类型，从**GenericObject**开始，并使用其详细的属性和方法进入更具体的类型，如**Pipe**和**Road**像 BottomOfPipe、Diameter 等。

当然，TypeLibrary 中会有**Object Model**、**Interface**、**Inheritance**和许多其他重要部分，现在我们已经修复了其中的一些。但是您可能知道，设计对象模型是一项非常模糊的工作，并且（据我所知）可以通过许多不同的方式完成，并且可以通过许多不同的结果和弱点来完成。

**在设计OM**时是否有任何不同的规则：**层次结构**、定义**Interface** s、**abstract**和**coclasse** s **enum**的方式？

有什么建议、参考或实践吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T13:37:01.170

几个不错的：

坚硬的

**单一责任原则开放**/**封闭原则**L**
**iskoff**替换原则接口隔离原则**依赖****倒置**原则** 

 ******更多信息和更多原则在这里： http: [//mmiika.wordpress.com/oo-design-principles/](http://mmiika.wordpress.com/oo-design-principles/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T13:47:18.620

查看[领域驱动设计：解决软件核心的复杂性](https://rads.stackoverflow.com/amzn/click/com/0321125215)。我想它会回答你的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-24T16:21:38.760

他们所说的，加上看起来你正在为现实世界的实体建模，所以：

*   将您的对象模型限制为与现实世界的实体完全匹配。

您可以使用继承和组件来减少代码/模型，但只能以对底层域有意义的方式。

例如，具有 Diameter 属性的 Pipe 类将有意义，而具有 GeometryType.Pipe 的 GeometryType 属性的 DiameterizedObject 类（具有 Diameter 属性）则没有意义。两种模型都可以工作，但前者显然对应于问题域，而后者实现了人工（非现实世界）视角。

一个额外的线索：当你发现自己在代码中发现了你从一开始就没有计划的新特性时，你就知道你的模型是正确的——它们只是“自然地”从模型中消失了。例如，您的模型可能有 Pipe 和 Junction 类（作为连接适配器）足以解决（例如）将不同直径的管道相互连接并计算流速、最大压力和结构完整性的直接问题。您后来意识到，由于您准确地建模了管道和连接点的结构和连接属性（在域的要求范围内），您还可以从连接的管道创建一个 JungleGym 对象，并正确计算它将承受多少结构负载。

这是一个极端的例子，但它应该明白这一点：正确的对象模型支持扩展，并且经常表现出有益的意外属性和特性（而不是错误！）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-24T16:40:03.733

[Liskov 替换原则](http://www.objectmentor.com/resources/articles/lsp.pdf)，通常用“is-a”来表达。OOP 的许多示例最好使用“has-a”（在 c++ 私有继承或显式组合中）而不是公共继承（“is-a”）

获得正确的继承权是**困难**的。使用接口（纯虚拟类）这样做通常比基类/子类更容易

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T13:36:25.087

查看面向对象设计的“原则”。这些对您提出的所有问题都有指导方针。

参考：

*   罗伯特·马丁的“面向对象的软件构建”
*   [http://www.objectmentor.com/resources/publishedArticles.html](http://www.objectmentor.com/resources/publishedArticles.html)

查看上述网站上的“设计原则”文章。它们是可用的最佳参考。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T13:41:53.077

“管底”？这是另一种说法，即道路下方管道的深度？

任何一种设计都是困难的，可以通过不同的方式完成。无法保证您的设计在创建时会起作用。

设计滚珠轴承等的人的优势是多年的经验和数据来确定哪些有效，哪些无效。软件没有那么多时间或硬数据。

这里有一些建议：

1.  继承意味着 IS-A。如果这不成立，请不要使用继承。
2.  深层次的等级可能是麻烦的征兆。
3.  来自[Scott Meyers](http://www.aristeia.com/ddjpaper1.html)：使非叶类接口或抽象。
4.  更喜欢组合而不是继承。

# xslt - 如何测试 XSL 中缺少的属性？

> ID：469126
> 
> 赞同：6
> 
> 时间：2009-01-22T13:32:58.447
> 
> 标签：xslt, xpath

我所拥有的如下：

```
<xsl:variable name="myvar" select=".//spss:category[((not @varName) or @varName=$colVarName) and @text=$series]/spss:cell/@text"/> 
```

它*应该*做的是选择`spss:cell`'s text-Attribute 的文本，只要它是 a 的子`spss:category`级

*   一个`varName`属性值等于`$colVarName`
*   *或者*根本没有`varName`属性

发生的事情*是*以下错误消息（抱歉在这里翻译，所以只是它的要点）：

> 预期令牌')'。找到令牌'@'。
> .//spss:category[((不是-->@<-- varName) 或@varName=$colVarName...

**问题解决了！**（见下文）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-22T13:35:59.500

好的，我想我发现了错误：

`not`必须与括号一起使用，所以而不是

```
(not @varName) or @varName=$colVarName 
```

应该是

```
not(@varName) or @varName=$colVarName 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T21:07:17.420

实际上 -`not()`是一个函数，它返回与括号之间的任何内容相反的布尔值。如有必要 - 它会将其参数转换为布尔值。在这种情况下，空节点集会自动转换为 false，因此如果`@varName`给您一个空节点集，则为`not(@varName)`true。

# user-interface - 是否有可用于创意的优秀应用程序 UI 库？

> ID：469128
> 
> 赞同：6
> 
> 时间：2009-01-22T13:33:27.137
> 
> 标签：user-interface, gallery

我正在寻找展示具有出色 UI 设计的应用程序屏幕截图的网站。我正在编写一个应用程序，并且正在花时间考虑 UI 应该是什么样子。我的听众不是企业而是家人。

我以前的 UI 设计经验（和舒适度）是使用 Windows 窗体，所以我通常会使用标准列表框、按钮、选项卡等。现在我正在尝试 WPF，并且正在寻找更多......有吸引力的......界面（只要它仍然满足应用程序的需求并增强 - 而不是减损 - 其目的）。

对具有出色 UI 设计的*画廊或应用程序的具体示例*有何想法？

**编辑：**我还将采用您认为制作出色、直观设计的单个应用程序。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-22T13:40:33.953

对于网络，请查看此链接：

[http://designingwebinterfaces.com/designing-web-interfaces-12-screen-patterns](http://designingwebinterfaces.com/designing-web-interfaces-12-screen-patterns)

对于 Windows 窗体，没有这样的站点（至少据我所知）。我所做的是模仿我喜欢的应用程序的行为（例如，Visual Studio 中的停靠面板、Office 中的一些其他 GUI 等等。

媒体播放器（例如 DVD 或音频播放器）也有一些非常酷的 GUI，因此您可以从不同的供应商下载几个演示并查看他们的 GUI。

最后一个示例是访问 www.codeguru.com 或 www.codeproject.com 之类的网站，然后查看那里的 winforms/MFC 部分。他们有一些非常酷的自定义控件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-23T19:21:57.827

通用用户界面

*   [patterntap.com](http://patterntap.com/)
*   [konigi.com](http://www.konigi.com/showcase/latest)

移动用户界面

*   [ptrns.com](http://pttrns.com/)
*   [可爱的ui.com](http://www.lovelyui.com/)
*   [mobile-patterns.com](http://mobile-patterns.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T14:11:32.817

我找到了以下站点，其中包含一些适用于 WPF 的很酷的东西：

[http://windowsclient.net/community/showcase.aspx](http://windowsclient.net/community/showcase.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T14:49:03.393

它不是画廊，但 Joel Spolsky 写了一本关于[程序员用户界面设计的](https://rads.stackoverflow.com/amzn/click/com/1893115941)好书。

# tfs - DependencyReplicator.xml 文件是什么样的？

> ID：469132
> 
> 赞同：1
> 
> 时间：2009-01-22T13:35:09.673
> 
> 标签：tfs, build

我正在尝试开始使用 Dependency Replicator [http://www.codeplex.com/tfsdepreplicator](http://www.codeplex.com/tfsdepreplicator)。没有适当的文档，因此没有我需要的 DependencyReplicator.xml 文件的示例，以便进一步进行实验。任何人都可以使用 Dependency Replicator 提供演示 .xml 文件吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T09:37:07.097

In the buildtype create a DependencyReplication.xml file and use something like the following:

```
<?xml version="1.0" encoding="utf-16"?>
<DependencyReplication  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://schemas.readify.net/tfsintegrator/dependencyreplication/20060725">
  <TeamProject TeamProject="AcmeAnvils" RootFolder="$/AcmeAnvils">
    <Dependency TeamProject="AcmeAnvils" BuildType="AcmeAnvilsContinuousBuild" >
      <File Source="Release/AcmeAnvils.Common.dll" Destination="$/AcmeAnvils/AcmeAnvil_Services/AcmeAnvils.Common.dll" />
      <File Source="Release/AcmeAnvils.Common.dll" Destination="$/AcmeAnvils/Dogfood/Dependencies/AcmeAnvils.Common.dll" />
    </Dependency>
  </TeamProject>  
</DependencyReplication> 
```

# ms-access - 自动运行访问宏

> ID：469138
> 
> 赞同：1
> 
> 时间：2009-01-22T13:36:17.660
> 
> 标签：ms-access, macros, scheduled-tasks

我有一个访问宏，我想从批处理文件中自动运行，该批处理文件将使用 Windows 计划任务进行计划。然而，目前批处理文件将不会继续，直到我在完成后关闭访问窗口。有没有办法可以默默地做到这一点？

我正在使用的线路是

```
"c:\Programme\Microsoft Office\OFFICE11\MSACCESS.EXE" "c:\Dokumente und Einstellungen\hom\Anwendungsdaten\BayWotch4\baywotch.db5" /excl /X Makro1 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T13:51:42.123

为什么不向宏添加“退出”操作，或者添加运行带有“DoCmd.Quit”的函数的 RunCode？

# php - 编译 swig 界面后缺少符号

> ID：469142
> 
> 赞同：2
> 
> 时间：2009-01-22T13:36:51.560
> 
> 标签：php, c++, swig, php-extension, php-internals

我试图为我的 linux 共享对象编译一个 php 接口，并且我已经设法使用 swig 的输出让它编译得很好，但是当我尝试加载它时，它抱怨缺少符号：

```
error: undefined symbol: zend_register_long_constant 
```

现在我看了一下zend，它似乎是一个php框架。我想我缺少一个要链接的库，但我不知道哪个库。

有其他人以前做过这个并让它工作吗？

编辑：

```
 ldd xxxx.so 
    linux-gate.so.1 =>  (0xb7fdb000)
    libcurl-gnutls.so.4 => /usr/lib/libcurl-gnutls.so.4 (0xb7f0a000)
    libboost_date_time-gcc42-1_34_1.so.1.34.1 => /usr/lib/libboost_date_time-gcc42-1_34_1.so.1.34.1 (0xb7efb000)
    libboost_thread-gcc42-mt-1_34_1.so.1.34.1 => /usr/lib/libboost_thread-gcc42-mt-1_34_1.so.1.34.1 (0xb7eed000)
    libboost_filesystem-gcc42-1_34_1.so.1.34.1 => /usr/lib/libboost_filesystem-gcc42-1_34_1.so.1.34.1 (0xb7ee1000)
    libcrypt.so.1 => /lib/tls/i686/cmov/libcrypt.so.1 (0xb7eaf000)
    libresolv.so.2 => /lib/tls/i686/cmov/libresolv.so.2 (0xb7e9b000)
    librt.so.1 => /lib/tls/i686/cmov/librt.so.1 (0xb7e92000)
    libxml2.so.2 => /usr/lib/libxml2.so.2 (0xb7d55000)
    libdl.so.2 => /lib/tls/i686/cmov/libdl.so.2 (0xb7d51000)
    libnsl.so.1 => /lib/tls/i686/cmov/libnsl.so.1 (0xb7d38000)
    libstdc++.so.6 => /usr/lib/libstdc++.so.6 (0xb7c49000)
    libm.so.6 => /lib/tls/i686/cmov/libm.so.6 (0xb7c23000)
    libgcc_s.so.1 => /lib/libgcc_s.so.1 (0xb7c14000)
    libc.so.6 => /lib/tls/i686/cmov/libc.so.6 (0xb7ab5000)
    libidn.so.11 => /usr/lib/libidn.so.11 (0xb7a83000)
    libldap_r-2.4.so.2 => /usr/lib/libldap_r-2.4.so.2 (0xb7a41000)
    libkrb5.so.3 => /usr/lib/libkrb5.so.3 (0xb79af000)
    libk5crypto.so.3 => /usr/lib/libk5crypto.so.3 (0xb798b000)
    libcom_err.so.2 => /lib/libcom_err.so.2 (0xb7987000)
    libgssapi_krb5.so.2 => /usr/lib/libgssapi_krb5.so.2 (0xb795c000)
    libgnutls.so.26 => /usr/lib/libgnutls.so.26 (0xb78bf000)
    libtasn1.so.3 => /usr/lib/libtasn1.so.3 (0xb78ad000)
    libz.so.1 => /usr/lib/libz.so.1 (0xb7897000)
    libgcrypt.so.11 => /lib/libgcrypt.so.11 (0xb782e000)
    libpthread.so.0 => /lib/tls/i686/cmov/libpthread.so.0 (0xb7814000)
    /lib/ld-linux.so.2 (0xb7fdc000)
    liblber-2.4.so.2 => /usr/lib/liblber-2.4.so.2 (0xb7806000)
    libsasl2.so.2 => /usr/lib/libsasl2.so.2 (0xb77ee000)
    libkrb5support.so.0 => /usr/lib/libkrb5support.so.0 (0xb77e5000)
    libkeyutils.so.1 => /lib/libkeyutils.so.1 (0xb77e1000)
    libgpg-error.so.0 => /lib/libgpg-error.so.0 (0xb77dc000) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T18:06:26.427

如果您在链接阶段丢失了一个库，那么您将无法编译和链接它。

您能否 ldd 共享对象并发布结果？

编辑：

构建时不会出现链接错误？我相信那里应该有一个指向 libphp 的链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T17:34:35.710

从 ldd 输出来看，您似乎没有动态链接到 libphp。这可能是 Swig 生成的 Makefile 的错误。

您可能想研究使用正确的工具集来构建 PHP 扩展，而不是使用 Swig。这个过程因 PHP 的版本而异。这通常从使用您正在使用的 PHP 发行版附带的工具“phpize”开始——这会从您将要构建的一组文件创建一个骨架构建。

# c++ - XML树打印机？

> ID：469151
> 
> 赞同：1
> 
> 时间：2009-01-22T13:40:01.990
> 
> 标签：c++, xml, data-structures, tree

有没有一个程序可以从 XML 数据中打印出格式良好的树？

我正在为班级做 B+ 树编程作业，如果我能将树可视化，那将有很大帮助。如果有一个程序可以渲染它，将我的内部数据结构输出到 XML（见下文）不会太难。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T13:54:50.947

我建议您改为以[Graphviz](http://www.graphviz.org/)格式（称为[DOT](http://www.graphviz.org/doc/info/lang.html)）输出。这可以产生[非常漂亮的结果](http://www.graphviz.org/Gallery/directed/fsm.html)，并且在其布局例程上花费了很多精力。更通用的 XML 可视化器可能没有。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T13:48:33.003

你追求什么样的可视化？如果您只想能够通过语法高亮来展开和折叠元素，那么任何 XML 查看器/编辑器都会为您提供该功能（见鬼，甚至 IE 也可以本机执行此操作）。

此外，如果您可以转换为 XML，您可能会考虑转换为 HTML 并以这种方式可视化数据。

# c++ - 使用 ShellExecuteEx 并捕获标准输入/输出/错误

> ID：469152
> 
> 赞同：10
> 
> 时间：2009-01-22T13:40:18.977
> 
> 标签：c++, c, windows, winapi

我`ShellExecuteEx`用来在 C 中执行命令。有没有办法使用`ShellExecuteEx`和捕获标准输入/输出/错误？

注意：我不想使用`CreateProcess`.

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-02T06:33:28.997

我曾经像你一样发现问题。

假设，您想从 STDOUT 中捕获由**dir**命令生成的输出，并将捕获的结果保存到**out.txt**中。

1.  使用文本编辑器并输入**dir > out.txt**并使用**mybat.bat**保存（*.bat，不要 *.txt）

2.  在您的 c/c++ 程序中，键入**WinExec("mybat.bat", SW_HIDE);** 并运行您的应用程序。

3.  打开**out.txt**，您将看到当前目录中的文件夹和文件的名称。

此外，您可以按照以下相同的方式运行任何可执行文件 (*.exe)。

**xxx.exe > out.txt**

我希望它可以帮助你。对不起，我的英语真的不好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-22T13:44:15.023

那是不可能的。`ShellExecute`( `Ex`) 基本上在 shell 的上下文中执行应用程序 - 所以你基本上是在做 explorer 所做的事情。

捕获 STDIN 和 STDOUT 是 shell 通常不做的事情，你将不得不走这`CreateProcess`条路（毕竟，`ShellExecute`如果要执行的文件是一个程序并且动词是“打开”，那么最终会调用它）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-22T13:52:10.827

不，唯一的方法是使用`CreatePipe`and `CreateProcess`。[请参阅此处](http://msdn.microsoft.com/en-us/library/ms682499(VS.85).aspx)的 MSDN 文章

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-22T23:39:56.757

正如 pilif 和 Bob 所提到的，您需要使用`CreateProcess`.

如果您想要为您打包的代码，我确实有一个针对这个确切问题的课程：

[http://code.google.com/p/kgui/source/browse/trunk/kguithread.cpp](http://code.google.com/p/kgui/source/browse/trunk/kguithread.cpp)。

类 ( `kGUICallThread`) 处理 Linux、macOS 和 Windows 版本。该代码已获得 LGPL 许可。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-30T19:46:26.917

CreateProcess 是大多数人使用的。

您可能还想考虑使用 _popen

[http://msdn.microsoft.com/en-us/library/96ayss4b%28VS.80%29.aspx](http://msdn.microsoft.com/en-us/library/96ayss4b%28VS.80%29.aspx)

# linux - 在 linux 中显示磁盘活动的类似 htop 的工具

> ID：469159
> 
> 赞同：173
> 
> 时间：2009-01-22T13:41:31.737
> 
> 标签：linux, command-line, io

我正在寻找可以报告磁盘 IO 活动的 Linux 命令行工具。类似的东西`htop`会很酷。有人听说过这样的事情吗？

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2009-01-22T13:51:36.617

你可以使用[iotop](http://guichaz.free.fr/iotop/)。它不依赖于内核补丁。它适用于股票 Ubuntu 内核

在 Ubuntu 存储库中有一个包。您可以使用安装它

```
sudo apt-get install iotop 
```

![iotop](https://i.stack.imgur.com/MfDA5.png)

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2009-05-15T01:17:03.557

[nmon](http://www.ibm.com/developerworks/aix/library/au-analyze_aix/)很好地显示了每个设备的磁盘活动。它可用于 linux。

```
? 磁盘 I/O ???????(/proc/diskstats)????????所有数据都是每秒千字节???????????????????????? ?????????????????????????????????????????????
?DiskName Busy Read WriteKB|0 |25 |50 |75 100| ?
?sda 0% 0.0 127.9|> | ?
?sda1 1% 0.0 127.9|> | ?
?sda2 0% 0.0 0.0|> | ?
?sda5 0% 0.0 0.0|> | ?
?sdb 61% 385.6 9708.7|WWWWWWWWWWWWWWWWWWWWWWWWWWWWR> | ?
?sdb1 61% 385.6 9708.7|WWWWWWWWWWWWWWWWWWWWWWWWWWWWR> | ?
?sdc 52% 353.6 9686.7|WWWWWWWWWWWWWWWWWWWWWWWWR > | ?
?sdc1 53% 353.6 9686.7|WWWWWWWWWWWWWWWWWWWWWWWWR > | ?
?sdd 56% 359.6 9800.6|WWWWWWWWWWWWWWWWWWWWWWWWWW> | ?
?sdd1 56% 359.6 9800.6|WWWWWWWWWWWWWWWWWWWWWWWWWW> | ?
?sde 57% 371.6 9574.9|WWWWWWWWWWWWWWWWWWWWWWWWWWR> | ?
?sde1 57% 371.6 9574.9|WWWWWWWWWWWWWWWWWWWWWWWWWWR> | ?
?sdf 53% 371.6 9740.7|WWWWWWWWWWWWWWWWWWWWWWWWR > | ?
?sdf1 53% 371.6 9740.7|WWWWWWWWWWWWWWWWWWWWWWWWR > | ?
?md0 0% 1726.0 2093.6|>磁盘忙不可用 | ?
??????????????????????????????????????????????????? ??????????????????????????????????????????????????? ????????????????????????????????????

```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-22T13:48:46.387

它不像 htop，但您可以使用[atop](http://www.atcomputing.nl/Tools/atop/)。~~但是，要显示每个进程的磁盘活动，它需要一个内核补丁（可从该站点获得）。~~这些内核补丁现在[已经过时](http://www.atoptool.nl/downloadpatch.php)，只是为了显示每个进程的网络活动，提供了一个可选模块。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-30T20:46:44.747

使用`collectl`具有广泛的进程 I/O 监控，包括监控线程。

请注意，有 I/O 计数器用于将 I/O 写入缓存和将 I/O 写入磁盘。 `collectl`分别报告它们。如果你不小心，你可能会误解数据。见[http://collectl.sourceforge.net/Process.html](http://collectl.sourceforge.net/Process.html)

当然，它显示的不仅仅是流程统计信息，因为您想要一个工具来提供所有内容，而不是一堆不同的工具以不同的格式显示所有内容，对吧？

# api - 你如何定义好的或坏的 API？

> ID：469161
> 
> 赞同：64
> 
> 时间：2009-01-22T13:42:12.390
> 
> 标签：api, api-design

### 背景：

我正在我的大学上一门名为“软件约束”的课程。在第一堂课中，我们学习了如何构建好的 API。

我们得到的一个非常糟糕的 API 函数的一个很好的例子是`public static void Select(IList checkRead, IList checkWrite, IList checkError, int microseconds);`C# 中的套接字。该函数接收 3 个套接字列表，并销毁它们，使用户必须克隆所有套接字，然后再将它们送入`Select()`. 它还有一个超时（以微秒为单位），它是一个 int，它设置服务器可以等待套接字的最长时间。这个限制是 +/-35 分钟（因为它是一个整数）。

* * *

### 问题：

1.  您如何将 API 定义为“坏”？
2.  您如何将 API 定义为“好”？

* * *

### 需要考虑的要点：

*   难以记住的函数名称。
*   难以理解的函数参数。
*   糟糕的文档。
*   一切都如此相互关联，以至于如果您需要更改 1 行代码，您实际上需要在其他地方更改数百行代码。
*   破坏其参数的函数。
*   由于“隐藏”的复杂性，可扩展性差。
*   用户/开发人员需要围绕 API 构建包装器，以便可以使用它。

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2009-01-22T13:52:17.767

在 API 设计中，我一直觉得这个主题演讲非常有帮助：
[如何设计一个好的 API 以及为什么它很重要——作者 Joshua Bloch](http://www.google.nl/search?q=How+to+Design+a+Good+API+and+Why+it+Matters)

这是摘录，我建议阅读整篇文章/观看视频。

> 二、一般原则
> 
> *   API 应该做一件事并做好
>     
> *   API 应该尽可能小，但不能更小
>     
> *   实施不应影响 API
>     
> *   最小化一切的可访问性
>     
> *   名称很重要——API 是一种小语言
>     
> *   文件事宜
>     
> *   虔诚地记录
>     
> *   考虑 API 设计决策的性能后果
>     
> *   API 设计决策对性能的影响是真实且永久的
>     
> *   API 必须与平台和平共处
> 
> 三、班级设计
> 
> *   最小化可变性
>     
> *   仅在有意义的地方子类
>     
> *   设计和文档继承或禁止它
> 
> 四。方法设计
> 
> *   不要让客户端做模块可以做的任何事情
>     
> *   不要违反最小惊讶原则
>     
> *   快速失败 - 错误发生后尽快报告
>     
> *   提供对字符串形式的所有可用数据的编程访问
>     
> *   小心超载
>     
> *   使用适当的参数和返回类型
>     
> *   跨方法使用一致的参数排序
>     
> *   避免长参数列表
>     
> *   避免需要异常处理的返回值

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-01-22T14:12:12.067

您无需阅读文档即可正确使用它。

一个很棒的 AP​​I 的标志。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-01-22T13:54:27.560

许多编码标准和[更长的文档](http://msdn.microsoft.com/en-us/library/czefa0ke.aspx)甚至[书籍（框架设计指南）](https://rads.stackoverflow.com/amzn/click/com/0321246756)都已针对此主题编写，但其中大部分仅在相当低的水平上有所帮助。

还有一个口味问题。API 可能会遵守任何规则手册中的每条规则，但仍然很糟糕，因为它们盲目地坚持各种流行的意识形态。最近的一个罪魁祸首是面向模式，其中单例模式（比初始化的全局变量多一点）和工厂模式（一种参数化构造的方式，但通常在不需要时实现）被过度使用。最近，控制反转 (IoC) 和相关的微型接口类型数量的激增更有可能为设计增加了冗余的概念复杂性。

品味的最佳导师是模仿（阅读大量代码和 API，找出有效和无效的方法）、经验（犯错误并从中学习）和思考（不要只为时尚而做，三思而后行）。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-01-22T13:48:38.947

*   有用 - 它解决了尚未满足的需求（或改进现有需求）
*   易于解释 - 对它的作用的基本理解应该很容易掌握
*   遵循某些问题域或现实世界的某些对象模型。它使用有意义的结构
*   正确使用同步和异步调用。（不要因为需要时间的事情而阻塞）
*   良好的默认行为 - 在可能的情况下允许可扩展性和调整，但为简单案例所需的所有内容提供默认值
*   示例使用和工作示例应用程序。这可能是最重要的。
*   优秀的文档
*   吃自己的狗粮（如果适用）
*   保持小或分段，使其不是一个巨大的污染空间。保持功能集不同且隔离，几乎没有依赖关系。

还有更多，但这是一个好的开始

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-22T14:12:07.900

**一个好的 API 有一个与它所描述的事物相近的语义模型。**

例如，用于创建和操作 Excel 电子表格的 API 将具有 、 和 之类的类`Workbook`，`Sheet`以及 和之类的`Cell`方法。`Cell.SetValue(text)``Workbook.listSheets()`

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-01-22T15:32:08.083

一个好的 API 可以让客户做他们需要做的几乎所有事情，但不需要他们做很多盲目的忙碌工作。“无心的忙碌工作”的例子是初始化数据结构字段，以从不改变的顺序调用多个例程，中间没有真正的自定义代码，等等。

一个糟糕的 API 最可靠的迹象是，如果你的客户都想用他们自己的帮助代码包装它。至少，您的 API 应该提供该帮助程序代码。最有可能的是，它应该被设计为提供更高级别的抽象，客户每次都自行滚动。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-22T14:59:25.060

糟糕的 API 是其目标受众未使用的 API。

一个好的 API 是由其目标受众用于其设计目的的 API。

一个优秀的 API 既可以被其预期受众用于其预期目的，也可以被非预期受众用于其设计者未预料到的原因。

如果亚马逊将其 API 发布为 SOAP 和 REST，并且 REST 版本胜出，这并不意味着底层 SOAP API 不好。

我想你也一样。您可以阅读有关设计的所有内容并尽力而为，但将使用酸性测试。花一些时间建立方法以获得关于哪些有效和哪些无效的反馈，并准备好根据需要进行重构以使其更好。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-05T18:01:34.317

一个好的 API 可以使简单的事情变得简单（做最常见的事情的最小样板和学习曲线）和可能的复杂事情（最大的灵活性，尽可能少的假设）。一个平庸的 API 可以很好地完成其中之一（要么非常简单，但前提是您尝试做非常基本的事情，或者非常强大，但学习曲线非常陡峭，等等）。一个糟糕的 API 就是不能很好地完成这两个方面的事情。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-06-05T18:14:00.787

已经有其他几个很好的答案了，所以我想我只是添加一些我没有看到提到的链接。

文章

1.  [奇趣科技的 Jasmin Blanchette 撰写的“API 设计小手册”](http://chaos.troll.no/~shausman/api-design/api-design.pdf)
2.  [“定义 QT 风格的 C++ API”也是奇趣科技](http://doc.trolltech.com/qq/qq13-apis.html)

图书：

1.  [Joshua Bloch 的《有效的 Java》](https://rads.stackoverflow.com/amzn/click/com/0321356683)
2.  [Kernighan 和 Pike 的“编程实践”](https://rads.stackoverflow.com/amzn/click/com/020161586X)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-22T14:41:11.337

我认为一个好的 API 应该允许自定义 IO 和内存管理钩子（如果适用的话）。

一个典型的例子是，您在磁盘上有自定义压缩归档格式的数据，而具有不良 api 的第三方库想要访问磁盘上的数据，并希望有一个可以加载其数据的文件的路径。

这个链接有一些好处： http: [//gamearchitect.net/2008/09/19/good-middleware/](http://gamearchitect.net/2008/09/19/good-middleware/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-05T01:37:02.677

如果 API 产生错误消息，请确保消息和诊断有助于开发人员找出问题所在。

我的期望是 API 的调用者传入正确的输入。开发人员是 API 产生的任何错误消息的消费者（而不是最终用户），针对开发人员的消息帮助开发人员调试他们的调用程序。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-22T14:01:21.963

当 API**记录不充分时，它就是不好的**。

当 API 有**良好的文档并遵循编码标准时，它就是好的**。

现在这是两个非常简单但也非常难遵循的点，这将一个带入软件架构领域。您需要一个优秀的架构师来构建系统并帮助框架遵循自己的指导方针。

注释代码，为 API 编写解释清楚**的手册是强制性的。**

如果一个 API 有一个很好的文档来解释如何使用它，它就会很好。但是，如果代码是干净的、良好的并且本身遵循一个标准，那么它是否有一个像样的文档并不重要。

我在这里写了一些关于编码结构[的文章](http://fekberg.wordpress.com/2008/08/22/importance-of-good-architecture-structure-and-patterns/)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-22T14:01:37.703

我认为最重要的是可读性，我的意思是让大多数程序员在尽可能短的时间内理解代码在做什么的质量。但是判断哪个软件可读，哪个不可读具有难以形容的人性：模糊性。您提到的几点确实部分成功地使其具体化。但是，总体而言，它必须保持逐案处理，并且很难提出普遍的规则。

# vb.net - 如何在windows XP中设置默认编码？

> ID：469163
> 
> 赞同：7
> 
> 时间：2009-01-22T13:43:02.653
> 
> 标签：vb.net, file-io, windows-xp

我试图使用 StreamReader 打开文件并设置编码，但我希望它采用默认 Windows 编码...如何更改我的 Windows 编码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T13:48:37.777

区域和语言选项控制面板项；高级选项卡。

影响整个计算机。

# visual-studio - 哪些消息传递/通信程序可以嵌入到 Visual Studio 中？

> ID：469164
> 
> 赞同：1
> 
> 时间：2009-01-22T13:43:22.233
> 
> 标签：visual-studio, communication, messaging, collaboration, extensibility

有没有人有将消息或邮件程序嵌入 VS 的经验？我对嵌入 Skype 或 Instant Messenger 之类的工具窗口感兴趣。如果您使用（或曾经使用过）这样的东西，它对您的工作效率有何影响？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T01:52:12.533

I'm not sure why you want to do this? I find I already have too little space in VS.

That aside, almost every dev team I have been on now communicated via a combination of IRC, MSN, Skype etc. We have always found that a flashing toolbar is a much smaller distraction to your programming zone than a tap on the shoulder. It also means we can stick our headphones on, and faze out into focused programming land, aka "The Zone", without concern for missing co-workers trying to get your attention.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-03T00:59:13.517

我同意我会觉得这很烦人的事实；我更喜欢自己阅读信息，而不是当有人想给我发一些东西时，然后被迫分散我的注意力。

也就是说，您可以相当简单地在 VS 的选项卡中托管某种消息传递网站（也许是 Twitter，或任何其他网站）。我不会，但你可以。

# wpf - ValidatesOnExceptions 触发但它不显示异常消息

> ID：469168
> 
> 赞同：1
> 
> 时间：2009-01-22T13:44:21.170
> 
> 标签：wpf, validation, binding

我有一个绑定到 ViewModel 属性的 TextBox.TextProperty。在绑定中，我已将**ValidatesOnExceptions**明确设置为**True**。

在资源中，TextBox 有这个触发器：

```
<Trigger Property="Validation.HasError" Value="true">
   <Setter 
      Property="ToolTip"
      Value="{Binding RelativeSource={RelativeSource Self}, Path=(Validation.Errors)[0].ErrorContent}"/>
   <Setter TargetName="Border" Property="Background" Value="Crimson"/> 
```

不幸的是，我的实现不能完美运行，因为当我遇到异常时，TextBox 背景会以**深红色**突出显示，但工具提示文本包含**“调用目标已引发异常”。**而不是我在异常构造函数中写的消息。

你有什么建议吗？

提前谢谢你，马可

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T13:56:11.380

这是因为验证代码是通过反射调用的。任何捕获的异常都将包含在[TargetInvocationException](http://msdn.microsoft.com/en-us/library/system.reflection.targetinvocationexception.aspx)实例中。原始异常将存储为此异常的[InnerException](http://msdn.microsoft.com/en-us/library/system.exception.innerexception.aspx)。

* * *

如果绑定到[ValidationError.Exception](http://msdn.microsoft.com/en-us/library/system.windows.controls.validationerror.exception.aspx)属性而不是[ValidationError.ErrorContext](http://msdn.microsoft.com/en-us/library/system.windows.controls.validationerror.errorcontent.aspx)会发生什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-23T10:59:41.460

我遇到了同样的问题，我不明白为什么在我的案例中验证是通过反射调用的。我正在考虑两种解决方案之一。

首先，我正在考虑实现一个转换器，以便在必要时从 ValidationError.Exception 中提取 InnerException。像这样的东西：

```
[ValueConversion(typeof(ValidationError), typeof(string))]
public class ErrorContentConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        var validationError = (ValidationError)value;

        if ((validationError.Exception == null) || (validationError.Exception.InnerException == null))
            return validationError.ErrorContent;
        else
            return validationError.Exception.InnerException.Message;
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        throw new NotSupportedException();
    }
} 
```

我在工具提示消息上使用转换器：

```
<Trigger Property="Validation.HasError" Value="true">
    <Setter Property="ToolTip"
        Value="{Binding RelativeSource={x:Static RelativeSource.Self},
        Path=(Validation.Errors).CurrentItem, Converter={StaticResource ErrorContentConverter}}"/>
</Trigger> 
```

或者，我想在 Binding 上使用 UpdateSourceExceptionFilter。我已经实现了一个过滤器，如下所示。这个解决方案使用起来有点麻烦，因为您必须在后面的代码中设置 UpdateSourceExceptionFilter 属性。

```
object InnerExceptionFilter(object bindingExpression, Exception exception)
{
    if (exception.InnerException != null)
    {
        var be = (System.Windows.Data.BindingExpression)bindingExpression;
        var rule = be.ParentBinding.ValidationRules.First(x=>x is ExceptionValidationRule);
        return new ValidationError(rule, be, exception.InnerException.Message, exception.InnerException);
    }
    else
        return exception;
}    
usage:
public MyConstructor()
{
    myTextBox.GetBindingExpression(TextBox.TextProperty).ParentBinding.UpdateSourceExceptionFilter
        = new UpdateSourceExceptionFilterCallback(InnerExceptionFilter);
} 
```

转换器很简单，但只会更改显示的消息。过滤器是一个更完整的解决方案，但对每个绑定都不友好。任何意见将**不胜**感激！

谢谢

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T16:10:31.883

Path=(Validation.Errors)[0].Exception.InnerException.Message}

# javascript - IE 缓存动态添加的 iframe。为什么，我该如何预防？

> ID：469177
> 
> 赞同：3
> 
> 时间：2009-01-22T13:47:49.150
> 
> 标签：javascript, html, internet-explorer, dom, cross-browser

我有以下 HTML / JS：

```
<html>
  <body>
    <script>
      function foo(){
        var html = "<iframe src=\"foo.html\" />";
        document.getElementById('content').innerHTML=html;
      }

      function bar(){
        var html = "<iframe src=\"bar.html\" />";
        document.getElementById('content').innerHTML=html;
      }

      function show(){
        alert(document.getElementById('content').innerHTML);
      }
    </script>
    <button onclick="foo()">foo</button><br />
    <button onclick="bar()">bar</button><br />
    <button onclick="show()">test</button><br />    

    <div id="content"></div>
  </body>
</html> 
```

这种工作按预期工作，即使在 IE 中也是如此。直到我按下F5。当我第一次单击*foo*时，我得到一个 iframe，其内容`foo.html`如预期的那样。然后我刷新，然后点击*bar*。我没有得到 的内容`bar.html`，而是看到 的内容`foo.html`。奇怪的是，当我单击*test*时，它`alert()`告诉我`src`iframe 的属性已正确设置为`bar.html`. Firefox 没有这样的问题。

为什么会发生这种情况，我该如何预防？

***编辑：***我忘了提到的是我不能放入 iframe 并更改 src 属性。在我的实际情况中，有时我需要一个`<img>`而不是一个`<iframe>`.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T14:08:41.683

使用这个 DOM

```
<div id="content" style='display:none;'>

  <iframe id='contentFrame' src='' />

</div> 
```

这作为你的脚本

```
function foo() {
  var contentDiv = document.getElementById('content');
  var contentFrame = document.getElementById('contentFrame');

  contentFrame.src = 'foo.html';
  contentDiv.style.display='block';
} 
```

我注意到 IE 和使用 innerHTML 的一些奇怪行为。我只会用它来清除内容（innerHTML = ""）。如果我想添加任何东西，我使用 HTMLElement.appendChild(); 它对我来说还没有失败。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T14:07:09.737

设置 Iframe 的 SRC，而不是更改其容器的 innerHTML：

html:

```
<iframe id="myFrame" src="about:blank" /> 
```

脚本：

```
document.getElementById('myFrame').src='foo.html' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T14:20:48.630

您是否尝试过更改生成的 iframe 中的 url？例如

```
var randomNum = Math.random();
var html = "<iframe src=\"bar.html?rand="+randomNum+"\" />"; 
```

更好的是，将它与 geowa4 的 appendChild() 建议结合起来。

# .net - 服务停止工作，web.config 中出现错误：无法添加类型为“add”且唯一键名称设置为“scripthandlerfactory”的重复集合条目

> ID：469188
> 
> 赞同：1
> 
> 时间：2009-01-22T13:51:39.097
> 
> 标签：.net, wcf

我的网络服务 (wcf) 突然停止工作。

我将我的 web.config 与旧版本进行了比较，它们都具有完全相同的元素，所以我很困惑为什么我突然收到此错误消息。

你们中有人遇到过这个问题吗？

> 文件名：web.config 行号 151 错误：无法添加类型为“add”且唯一键属性“name”设置为“ScriptHandlerFactory”的重复集合条目？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T15:49:56.107

我总是在部署时被这个烧伤，而不是我的 web.config。99% 的时间都与父网站 web.config 被继承到子 web 应用程序有关。有什么改变吗？

我通常做的是`<remove>`为任何给我错误的部分添加一个标签，但对于一些无法完成的部分（我认为组部分），只需要给一个不同的名称。

# .net - 用于代码生成的字符串实用程序库

> ID：469199
> 
> 赞同：0
> 
> 时间：2009-01-22T13:56:18.697
> 
> 标签：.net, string, code-generation

CodeSmith 有一个不错的 StringUtils 类，可用于将数据库对象名称更改为单数、复数、驼峰式、帕斯卡式等...对于在其代码生成工具中创建数据访问层非常有用。

我正在尝试将一些 CodeSmith 模板移植到 Visual Studio 使用的 T4 模板文件中，并且我正在尝试找到一个类似的库来执行这些操作。

*T4*中一定有一个，因为那是用来生成 LINQ to SQL 类的东西，它在复数/单数化方面做得很好。

有谁知道这个库存在哪里，或者某个地方是否存在具有类似功能的免费库？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-22T14:12:12.860

我已经将 CodeSmith 与 .netTiers 以及最近的 T4 一起使用。我不确定 Linq to SQL 使用的细节，但是使用 T4，您基本上可以在 .NET 框架中使用代码执行任何操作。

为此，为什么不制作您自己的 StringUtils 类（有很多现有的开源项目提供了许多预先编写的方法库），并将这些实用程序包含在外部 T4 文件中。然后，您可以将此文件作为父文件包含到您正在创建的子模板中。您可以使用 include 指令来执行此操作，如下所示：

```
<#@ include file="Utilities.tt" #> 
```

# python - 任何 Python OLAP/MDX ORM 引擎？

> ID：469200
> 
> 赞同：7
> 
> 时间：2009-01-22T13:56:23.970
> 
> 标签：python, django, orm, olap, mdx

我是 MDX/OLAP 的新手，我想知道是否有任何类似于 Django ORM for Python 的 ORM 可以支持 OLAP。

我是一名 Python/Django 开发人员，如果有一些东西可以与 Django 进行某种程度的集成，我会非常有兴趣了解更多关于它的信息。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-23T02:24:53.600

Django 有一些即将发布的 OLAP 功能。

阅读[http://www.eflorenzano.com/blog/post/secrets-django-orm/](http://www.eflorenzano.com/blog/post/secrets-django-orm/)

[http://doughellmann.com/2007/12/30/using-raw-sql-in-django.html](http://doughellmann.com/2007/12/30/using-raw-sql-in-django.html)，也

如果您首先有适当的星型模式设计，那么一维结果可以具有以下形式。

```
from myapp.models import SomeFact
from collections import defaultdict

facts = SomeFact.objects.filter( dimension1__attribute=this, dimension2__attribute=that )
myAggregates = defaultdict( int )
for row in facts:
    myAggregates[row.dimension3__attribute] += row.someMeasure 
```

如果要创建二维摘要，则必须执行以下操作。

```
facts = SomeFact.objects.filter( dimension1__attribute=this, dimension2__attribute=that )
myAggregates = defaultdict( int )
for row in facts:
    key = ( row.dimension3__attribute, row.dimension4__attribute )
    myAggregates[key] += row.someMeasure 
```

要计算多个 SUM 和 COUNT 等等，你必须做这样的事情。

```
class MyAgg( object ):
    def __init__( self ):
        self.count = 0
        self.thisSum= 0
        self.thatSum= 0

myAggregates= defaultdict( MyAgg )
for row in facts:
    myAggregates[row.dimension3__attr].count += 1
    myAggregates[row.dimension3__attr].thisSum += row.this
    myAggregates[row.dimension3__attr].thatSum += row.that 
```

这——乍一看——似乎效率低下。您正在浏览返回大量行的事实表，然后您将这些行汇总到您的应用程序中。

在某些情况下，这可能比 RDBMS 的本机 sum/group_by*更快。*为什么？您使用的是简单的映射，而不是 RDBMS 经常为此使用的更复杂的基于排序的分组操作。是的，你得到了很多行；但你在得到它们方面做得更少。

这样做的缺点是它不像我们想要的那样具有声明性。它的优点是它是纯 Django ORM。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-07T12:53:01.390

和*kpw 一样*，我自己写东西，除了它是专门为 Django 写的：

[https://code.google.com/p/django-cube/](https://code.google.com/p/django-cube/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-10-30T13:35:23.973

还有[http://cubes.databrewery.org/](http://cubes.databrewery.org/)。python中的轻量级OLAP引擎。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-21T13:33:32.867

我也有类似的需求——不是完整的 ORM，而是 Python 中一个简单的类似 OLAP 的数据存储。在对现有工具进行干搜索后，我写了这个小技巧：

[https://github.com/kpwebb/python-cube/blob/master/src/cube.py](https://github.com/kpwebb/python-cube/blob/master/src/cube.py)

即使它不能解决您的确切需求，它也可能是编写更复杂的东西的良好起点。

# c# - 从 .NET 字典中删除与谓词匹配的多个项目的最佳方法？

> ID：469202
> 
> 赞同：66
> 
> 时间：2009-01-22T13:57:27.913
> 
> 标签：c#, .net, linq, collections, dictionary

我需要从字典中删除多个项目。一个简单的方法如下：

```
 List<string> keystoremove= new List<string>();
  foreach (KeyValuePair<string,object> k in MyCollection)
     if (k.Value.Member==foo)
        keystoremove.Add(k.Key);
  foreach (string s in keystoremove)
        MyCollection.Remove(s); 
```

我不能直接删除foreach块中的项目的原因是这会抛出异常（“集合已修改......”）

我想做以下事情：

```
 MyCollection.RemoveAll(x =>x.Member==foo) 
```

但是 Dictionary<> 类没有像 List<> 类那样公开 RemoveAll(Predicate<> Match) 方法。

做到这一点的最佳方法是什么（无论是性能方面还是优雅方面）？

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-01-22T14:06:43.310

这是另一种方式

```
foreach ( var s in MyCollection.Where(kv => kv.Value.Member == foo).ToList() ) {
  MyCollection.Remove(s.Key);
} 
```

将代码直接推送到列表中可以避免“枚举时删除”问题。这`.ToList()`将在 foreach 真正开始之前强制枚举。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-01-22T14:15:03.883

您可以创建一个[扩展方法](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods)：

```
public static class DictionaryExtensions
{
    public static void RemoveAll<TKey, TValue>(this IDictionary<TKey, TValue> dict, 
        Func<TValue, bool> predicate)
    {
        var keys = dict.Keys.Where(k => predicate(dict[k])).ToList();
        foreach (var key in keys)
        {
            dict.Remove(key);
        }
    }
}

...

dictionary.RemoveAll(x => x.Member == foo); 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-22T15:08:15.900

而不是删除，只是做相反的事情。从仅包含您感兴趣的元素的旧字典创建一个新字典。

```
public Dictionary<T, U> NewDictionaryFiltered<T, U>
(
  Dictionary<T, U> source,
  Func<T, U, bool> filter
)
{
return source
  .Where(x => filter(x.Key, x.Value))
  .ToDictionary(x => x.Key, x => x.Value);
} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-08-22T13:44:54.593

Aku 的扩展方法解决方案的修改版本。主要区别在于它允许谓词使用字典键。一个小的区别是它扩展了 IDictionary 而不是 Dictionary。

```
public static class DictionaryExtensions
{
    public static void RemoveAll<TKey, TValue>(this IDictionary<TKey, TValue> dic,
        Func<TKey, TValue, bool> predicate)
    {
        var keys = dic.Keys.Where(k => predicate(k, dic[k])).ToList();
        foreach (var key in keys)
        {
            dic.Remove(key);
        }
    }
}

. . .

dictionary.RemoveAll((k,v) => v.Member == foo); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-07-26T08:35:05.850

最快的删除方法是：

```
public static void RemoveAll<TKey, TValue>(this IDictionary<TKey, TValue> idict, Func<KeyValuePair<TKey, TValue>, bool> predicate)
    {
        foreach (var kvp in idict.Where(predicate).ToList())
        {
            idict.Remove(kvp.Key);
        }
    } 
```

或者

```
public static void RemoveAll<T>(this ICollection<T> icollection, Predicate<T> predicate)
{
    var nonMatchingItems = new List<T>();

    // Move all the items that do not match to another collection.
    foreach (var item in icollection) 
    {
        if (!predicate(item))
        {
            nonMatchingItems.Add(item);
        }
    }

    // Clear the collection and then copy back the non-matched items.
    icollection.Clear();
    foreach (var item in nonMatchingItems)
    {
        icollection.Add(item);
    }
} 
```

取决于您是否有更多的谓词返回 true 的情况。两者本质上都是 O(N) ，但是如果“删除/查找”的情况非常少，第一种方法会更快，如果集合中的项目在大多数情况下都符合条件，则第二种方法会更快。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T14:06:11.500

你能改变你的循环来使用一个索引（即FOR而不是FOREACH）吗？当然，您必须向后循环，即 count-1 减至零。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-22T14:07:11.543

而不是删除只是做相反的事情（从旧字典创建一个只包含您感兴趣的元素的新字典）并让垃圾收集器处理旧字典：

```
var newDictionary = oldDictionary.Where(x => x.Value != foo); 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2021-04-18T08:45:14.247

使用 LINQ 很简单。只需执行以下操作:)

```
MyCollection = MyCollection.Where(mc => !keystoremove.Contains(mc.Key))
.ToDictionary(d => d.Key, d => d.Value); 
```

# windows - 以编程方式调整 Windows OnScreen 键盘的大小

> ID：469209
> 
> 赞同：1
> 
> 时间：2009-01-22T13:59:04.447
> 
> 标签：windows

我想知道是否可以在我的程序中调整 Windows OnScreen 键盘的大小？为此使用什么 Windows 方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T14:57:26.297

只需使用标准的 Win32 api。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-25T10:29:34.530

*我知道这个问题很老，但给出的答案真的很短。为了增加这个主题的价值，我忍不住添加以下信息：*

你可以这样做，标志 SWP_NOREPOSITION 应该使 iPosX 和 iPosY 被 SetWindowPos 忽略。所以只有宽度和高度应该改变。我还没有测试过这段代码。

```
HWND hWndOSK = FindWindow("IPTip_Main_Window", null); //Only the class is known, the window has no name
int iPosX=0;
int iPosY=0;
int iWidth=1000;
int iHeight=600;
if(hWndOSK != NULL)
{
    //Window is up
    if(!SetWindowPos(hWndOSK, HWND_TOPMOST, iPosX, iPosY, iWidth, iHeight, SWP_NOREPOSITION))
    {
        //Something went wrong do some error handling
    }
} 
```

设置窗口位置：http : [//msdn.microsoft.com/en-us/library/ms633545.aspx](http://msdn.microsoft.com/en-us/library/ms633545.aspx)

FindWindow： http: [//msdn.microsoft.com/en-us/library/windows/desktop/ms633499 (v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/ms633499(v=vs.85).aspx)

# sql-server - 如何连接到 SQL Server 2008

> ID：469215
> 
> 赞同：0
> 
> 时间：2009-01-22T14:01:12.603
> 
> 标签：sql-server, windows, configuration

我有台式机和笔记本电脑。台式机配备 Windows 7 64 位，笔记本电脑配备 Vista Ultimate 32 位。在两台机器上，我都安装了 SQL Server 2008 Standard。在笔记本电脑上，我打开 SQL Management Studio 并尝试连接到桌面上的 SQL Server。它超时。

使用 SQL Server 配置管理器，我为客户端协议启用了 TCP/IP 和命名管道。

在 SQL Management Studio 中，我右键单击数据库引擎，转到属性，并允许远程连接。我还创建了一个名为“testuser”的 sql server 登录名和一个密码。然后我将该用户添加为我的数据库的登录名，并使他们成为数据库所有者。

我不知道如何允许连接到我的数据库抛出 Windows 防火墙，所以我将其关闭。

我错过了什么？我在笔记本电脑上进行了相同的更改，我可以从桌面连接到 Management Studio 中的笔记本电脑吗？

你有清单吗？谢谢。

更新：我关闭了防病毒软件。Ran NetStat -a 并且听者正在听。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T14:18:15.283

如果您的登录尝试需要大约 30 秒才能超时，那么这是某种网络连接问题（或 SQL 没有正确监听）。权限问题会在几秒钟后再次出现，所以长时间的等待表明它与连接有关。

如果您在服务器上运行“NETSTAT -a”，那么您会看到 SQL Server 在端口 1433 上侦听吗？如果没有，那么可能是服务器上的 SQL TCP 侦听器没有正确配置 - 当 SQL 服务启动时，Windows 事件日志中应该有事件发生这种情况。

请用结果编辑您的问题，我们可以从那里开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T23:05:04.407

尝试使用 Telnet 来查看笔记本电脑是否可以通过端口 1433 看到桌面。

在笔记本电脑上打开命令提示符并输入：

```
telnet DesktopNameOrIPAddress 1433 
```

按 Enter，您应该会看到连接失败错误或空白屏幕。如果出现空白屏幕，则表示已建立连接。按 CTRL-] 退出，然后输入“quit”并回车退出。

如果连接失败，请在使用 SQL Server 工具之前尝试解决端口 1433 的一般网络问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T14:03:51.427

如果您正在运行任何其他防病毒软件，它也可能内置了防火墙。例如，我知道 McAfee 就是这样做的。检查一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T15:07:36.027

您可能已经想到了这一点，但您是否检查过服务器配置为允许混合模式身份验证？我没有访问 2008，但我似乎记得至少有一个以前的版本默认配置为禁止 sql 登录。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T15:17:40.403

我假设您已经在操作系统级别完成了您必须做的事情。或者可能尝试链接服务器以查看您是否可以真正遍历您的网络。让我建议一个快速测试。检查您是否可以通过创建通用数据链路来实际测试连接性。如果您不知道如何执行此操作，请在您的桌面（或任何地方）中创建一个新的文本文件，并将 .txt 文件扩展名更改为 .udl；然后打开它。查看您的其他服务器是否可以通过网络“查看”（不要忘记将提供程序更改为 SQL Server 的 OLE DB 提供程序）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T17:05:58.250

SQL Browser 服务是否在您尝试访问的服务器上运行？（默认情况下这是禁用的，你需要它来远程访问 SQL Server）

# python - 将滚动条添加到 pythoncard 应用程序

> ID：469219
> 
> 赞同：2
> 
> 时间：2009-01-22T14:02:18.980
> 
> 标签：python, wxpython, scroll, pythoncard

pythoncard 尚不支持将滚动窗口作为应用程序的主框架。如何将滚动条添加到主框架（背景）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T07:43:20.037

我从未使用过pythoncard，但在纯wxpython中，您可以在框架内放置一个ScrolledWindow，然后使用sizer来控制滚动条（假设sizer的内容不适合窗口）。例如，这个简短的代码片段会给你一个带有垂直滚动条的窗口。

```
class Scrolled(wx.ScrolledWindow):
    def __init__(self, parent):
        wx.ScrolledWindow.__init__(self, parent, size=(200,200))
        self.SetScrollRate(0, 10);
        sizerV = wx.BoxSizer(wx.VERTICAL)
        #create a bunch of stuff in the sizer which doesnt fit
        for i in range(0,50):
            text = "Line: " + str(i)
            sizerV.Add(wx.StaticText(self, label=text), 0)

        self.SetSizer(sizerV)

class Frame(wx.Frame):
    def __init__(self, parent):
        wx.Frame.__init__(self, parent, size=(200,200), Scrolled(self)
            title="Scroll Bars", style=wx.CAPTION) 
```

# sql-server-2008 - 如何在 SSAS 2008 中使用服务器别名？

> ID：469223
> 
> 赞同：2
> 
> 时间：2009-01-22T14:05:00.707
> 
> 标签：sql-server-2008, ssas

我无法让 Microsoft Analysis Services 2008 识别我创建的主机别名（即使数据库引擎识别它）。

事情是这样的：我们有一些代码可以查找名为 PRODUCTION 的分析服务服务器。出于测试目的，我们希望 PRODUCTION 指向 localhost。在 SQL Server 2000 和 2005 下，我们通过以下方式实现了这一点：

1.  在我的本地计算机上的 C:\Windows\system32\drivers\etc\hosts 文件中添加一个条目以读取：127.0.0.1 PRODUCTION

2.  在 Sql Server 配置管理器中启用 TCP/IP

3.  在 Sql Server 配置管理器中为 PRODUCTION 创建别名

这对数据库引擎非常有用。我可以将 SQL Server Management Studio 连接到服务器“PRODUCTION”，它会在我的本地计算机上启动一个。我可以 ping 生产，它工作正常：

> 使用 32 字节数据 Ping PRODUCTION [127.0.0.1]：
> 
> 来自 127.0.0.1 的回复：字节=32 时间<1ms TTL=128 来自 127.0.0.1 的回复：字节=32 时间<1ms TTL=128 来自 127.0.0.1 的回复：字节=32 时间<1ms TTL=128 来自 127.0.0.1 的回复: 字节=32 时间<1ms TTL=128
> 
> 127.0.0.1 的 Ping 统计信息：数据包：发送 = 4，接收 = 4，丢失 = 0（丢失 0%），

但它不适用于分析服务——就像它找不到服务器一样。在 Management Studio 中，我可以很好地连接到“localhost”作为分析服务服务器，但是当我使用“PRODUCTION”作为服务器时，我从“连接到服务器”对话框中收到以下错误：

> “无法建立连接。确保服务器正在运行......无法从传输连接读取数据：现有连接被远程主机强行关闭”。

如果我只键入我知道服务器不存在的主机，则此错误与我得到的错误略有不同：

> “无法建立连接。确保服务器正在运行......不知道这样的主机”

这让我觉得有些东西被禁用了。或者我还需要像上面的步骤 2 和 3 那样启用其他功能吗？

或者他们是否将 Analysis Services 2008 更改为不使用 DNS 来解析名称？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-07-22T07:42:13.977

有关于此问题的错误引用：[创建 Analysis Services 2005/2008 的（命名）实例并为其命名](https://connect.microsoft.com/SQLServer/feedback/details/432644/create-and-alias-to-a-named-instance-of-analysis-services-2005-8)

正如 darren 所说，您必须创建一个 DNS 别名。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T06:05:41.497

您可以尝试更改 HOSTS 文件中的条目以指向服务器的实际 IP 地址，而不是特殊的 localhost 环回地址。

使用 AS 2000，我们过去必须使用[以下过程](http://support.microsoft.com/default.aspx?kbid=888526&SD=tech)才能使 DNS 别名正常工作。但我不知道您是否还需要为 SSAS 2005/2008 这样做

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-01T15:54:33.543

就像达伦说的，你必须先禁用严格的名称检查。但是，您还必须在注册表中的 BackConnectionHostNames 列表中添加一个与您要使用的别名匹配的条目。[有关同时执行这两种操作的详细信息，请参阅本文](http://support.microsoft.com/kb/983444)的解决方法 #1 （不要担心本文适用于 SharePoint；该过程适用于任何使用环回检查进行身份验证的应用程序，包括 SSAS 2005/2008）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-11T21:31:48.717

你检查2008 AS服务器的权限了吗？

# scalability - 您将如何为用户实现“最后一次看到”功能？

> ID：469224
> 
> 赞同：6
> 
> 时间：2009-01-22T14:05:10.037
> 
> 标签：scalability, user-tracking

在 Stack Overflow 上，个人资料页面列出了“最后一次看到”的属性。这似乎并没有在每个页面视图上更新（显然是出于性能原因）。您将如何在流量大的 Web 应用程序中实现它？你会只在某些页面上更新它吗？或者缓存您上次记录用户上次访问的时间并在更新数据库之前等待特定的时间？还是完全不同的东西？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-22T14:17:57.593

在 Stack Overflow 等流量大的网站上，我只会在用户实际执行某项操作时更新“最后一次看到”*变量*。潜伏并阅读问题和答案不应算作系统“看到”的用户。提问和回答问题或对其进行投票应该是在用户最后一次出现时更新的操作。

我不会谈论实现细节，因为其他答案已经涵盖了这一点（我可能会弄错）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T14:09:50.137

您可能会发现[“您将使用什么策略来跟踪用户最近的活动？”](https://stackoverflow.com/questions/174248/what-strategy-would-you-use-for-tracking-user-recent-activity) 乐于助人。问题类似。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-22T14:11:18.760

我会使用一个会话。并且仅将其设置为会话的第一次访问。如果人们让浏览器保持打开状态，也每隔一小时左右重置一次。在 php 中是这样的：

```
if(!isset(!_SESSION['lastSeen'])){
 $_SESSION['lastSeen'] = time();
 updateLastSeenInDatabaseOrSomething();
}
else{
 if($_SESSION['lastSeen'] < time() + 2 * 60 * 60){ //2 hours
  $_SESSION['lastSeen'] = time();
  updateLastSeenInDatabaseOrSomething();   
 }
} 
```

类似的事情，但随后使用 OO 而不是两次做同样的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T14:18:56.653

考虑为此使用“命令”设计模式。它将通过两种方式帮助您 - 回答手头的问题并实现“撤消/重做”功能。您应该维护一个根据该模式设计的命令对象列表。

# delphi - 更换功能单元

> ID：469237
> 
> 赞同：5
> 
> 时间：2009-01-22T14:08:46.223
> 
> 标签：delphi, unit-testing

我正在为大型 Delphi 代码库编写单元测试基础架构。我想将调用链接到 SysUtils.FileExists 中的纯函数，例如链接到“MockSysUtils.FileExists”。

编译器不喜欢创建具有相同接口的 SysUtils 单元。

我在想的是在运行时挂钩我的模拟函数。这在当今可能吗？

还有其他建议吗？

问候，

彼得

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-22T14:30:24.557

**在运行时**替换函数很困难，但通常在技术上是可行的。您需要做的“所有”是：

*   获取相关函数的地址
*   反汇编前 5 个字节左右（检查 RET 指令 - 非常小的例程可能与另一个例程相邻，阻止您替换它）
*   将其页面保护（使用[`VirtualProtect`](http://msdn.microsoft.com/en-us/library/aa366898(VS.85).aspx)）更改为可写
*   用 JMP rel32 指令重写前 5 个字节（即 E9 <offset-to-your-func>）
*   正常实现您的版本函数，确保它具有与您正在模拟的函数相同的参数和调用约定

一种更简单的方法是链接到不同版本的 SysUtils.pas。这将要求您还重新编译 RTL 和 VCL 中依赖于 SysUtils.pas 的所有单元，但它可能比上述函数插入方法容易得多。

最简单的方法是语言级别的方法，您要么根本不直接依赖 SysUtils（因此可以切换到更高级别），要么修改`uses`声明以有条件地引用不同的单元。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-22T15:30:53.920

你可以用[MadCodeHook](http://www.madshi.net/madCodeHookDescription.htm)做到这一点。使用`HookCode`函数，给它你要替换的函数的地址和你要调用的函数的地址。它会给你一个函数指针，你可以使用它来调用原始函数并在之后取消挂钩。本质上，它实现了巴里描述的中间三个步骤。

我认为 MadCodeHook 是免费供个人使用的。如果您正在寻找比这更自由的东西，您可以尝试找到[旧版本的 Tnt Unicode 控件](http://mh-nexus.de/en/tntunicodecontrols.php)。它使用相同的挂钩技术将 Unicode 支持注入到一些 VCL 的代码中。您将需要旧版本，因为更新的版本不再免费。*在TntSystem.pas*中找到该`OverwriteProcedure`函数，您还可以在其中找到如何使用它的示例。

 *代码挂钩很好，因为它不需要您重新编译 RTL 和 VCL，并且它不涉及条件编译来控制哪些函数在范围内。您可以从单元测试设置过程中挂钩代码，原始代码永远不会知道其中的区别。它会认为它正在调用原始`FileExists`函数（因为它是），但是当它到达那里时，它会立即跳转到您的模拟版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T17:04:11.033

您也可以只添加一个仅包含要模拟的功能到测试单元的使用子句的单元。Delphi 将始终使用最后列出的单元中的函数。不幸的是，这需要您更改要测试的单元。

您的 Mock-Sysutils 单元：

```
unit MockSysutils;

interface

function FileExists(...) ...
...
end. 
```

你的单位，你想测试：

```
unit UnitTotest;

interface

uses
  Sysutils,
  MockSysUtils;

...

  if FileExists(...) then 
```

FileExists 现在将从 MockSysutils 而不是 Sysutils 调用版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T16:49:13.387

This is slightly way out there but here is another alternative.

When building your unit tests and your main codebase to go with it, you could grep all the functions you wish to replace and specify the unit to use

Instead of

```
fileexists(MyFilename); 
```

you could grep fileexists and replace with

```
MockTests.fileexists(MyFileName); 
```

If you did this at build time (using automated build tools) it could easily be done and would provide you with the greatest flexibility. You could simply have a config file that listed all the functions to be replaced.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T15:19:42.803

谢谢，

是的，如果有 TSysUtils 类而不是我可以用我的 MockSysUtils 继承，那就太好了。但是，事实并非如此，代码库很大。它将被一点一点地替换，但我想知道是否有一个快速启动的解决方案。

第一种方法可能适用于一个功能，但我猜在这种情况下不行。

我会选择第二种方法。

# python - 如何在 Python 中侦听 Linux 中的“插入 USB 设备”事件？

> ID：469243
> 
> 赞同：37
> 
> 时间：2009-01-22T14:09:59.667
> 
> 标签：python, linux, usb

我想在 Linux 中为 Amarok 编写一个 Python 脚本，以自动将 stackoverflow 播客复制到我的播放器。当我插入播放器时，它会安装驱动器，复制任何待处理的播客，然后弹出播放器。如何收听“插入”事件？我已经浏览了一遍，但找不到一个很好的例子。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-01-22T22:27:58.820

**更新**：正如评论中所说，Hal 在最近的发行版中不受支持，现在的标准是 udev，这是一个使用 glib 循环和**udev**的小例子，出于历史原因，我保留了 Hal 版本。

这基本上是[pyudev 文档中的示例](http://pyudev.readthedocs.org/en/latest/api/pyudev.glib.html#pyudev.glib.MonitorObserver)，适用于旧版本，并且使用 glib 循环，请注意过滤器应根据您的特定需要进行定制：

```
import glib

from pyudev import Context, Monitor

try:
    from pyudev.glib import MonitorObserver

    def device_event(observer, device):
        print 'event {0} on device {1}'.format(device.action, device)
except:
    from pyudev.glib import GUDevMonitorObserver as MonitorObserver

    def device_event(observer, action, device):
        print 'event {0} on device {1}'.format(action, device)

context = Context()
monitor = Monitor.from_netlink(context)

monitor.filter_by(subsystem='usb')
observer = MonitorObserver(monitor)

observer.connect('device-event', device_event)
monitor.start()

glib.MainLoop().run() 
```

***带有 Hal 和 d-bus 的旧版本：***

您可以使用 D-Bus 绑定并收听`DeviceAdded`和`DeviceRemoved`发出信号。您必须检查已添加设备的功能才能仅选择存储设备。

这是一个小例子，您可以删除评论并尝试一下。

```
import dbus
import gobject

class DeviceAddedListener:
    def __init__(self): 
```

您需要使用系统总线连接到 Hal Manager。

```
 self.bus = dbus.SystemBus()
        self.hal_manager_obj = self.bus.get_object(
                                              "org.freedesktop.Hal", 
                                              "/org/freedesktop/Hal/Manager")
        self.hal_manager = dbus.Interface(self.hal_manager_obj,
                                          "org.freedesktop.Hal.Manager") 
```

在这种情况下，您需要将侦听器连接到您感兴趣的信号`DeviceAdded`。

```
 self.hal_manager.connect_to_signal("DeviceAdded", self._filter) 
```

我正在使用基于功能的过滤器。如果您可以阅读 Hal 文档以找到更适合您需求的查询或有关 Hal 设备属性的更多信息，它将接受任何`volume`并调用。`do_something`

```
 def _filter(self, udi):
        device_obj = self.bus.get_object ("org.freedesktop.Hal", udi)
        device = dbus.Interface(device_obj, "org.freedesktop.Hal.Device")

        if device.QueryCapability("volume"):
            return self.do_something(device) 
```

显示有关卷的一些信息的示例函数：

```
 def do_something(self, volume):
        device_file = volume.GetProperty("block.device")
        label = volume.GetProperty("volume.label")
        fstype = volume.GetProperty("volume.fstype")
        mounted = volume.GetProperty("volume.is_mounted")
        mount_point = volume.GetProperty("volume.mount_point")
        try:
            size = volume.GetProperty("volume.size")
        except:
            size = 0

        print "New storage device detectec:"
        print "  device_file: %s" % device_file
        print "  label: %s" % label
        print "  fstype: %s" % fstype
        if mounted:
            print "  mount_point: %s" % mount_point
        else:
            print "  not mounted"
        print "  size: %s (%.2fGB)" % (size, float(size) / 1024**3)

if __name__ == '__main__':
    from dbus.mainloop.glib import DBusGMainLoop
    DBusGMainLoop(set_as_default=True)
    loop = gobject.MainLoop()
    DeviceAddedListener()
    loop.run() 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-22T14:59:36.277

我自己没有尝试过编写这样的程序，但是我只是查看了以下两个链接（感谢 Google！），我认为这会有所帮助：

*   [dbus-python 教程](http://dbus.freedesktop.org/doc/dbus-python/doc/tutorial.html)（讲述如何使用 Python 访问 D-Bus）
*   [HAL 0.5.10 规范](http://www.marcuscom.com/hal-spec/hal-spec.html#interfaces)（讨论了 HAL 如何将事件发布到 D-Bus）

特别是，阅读有关`org.freedesktop.Hal.Manager`接口及其事件`DeviceAdded`的信息。`DeviceRemoved`:-)

希望这可以帮助！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-09-02T09:13:16.737

这是5行的解决方案。

```
import pyudev

context = pyudev.Context()
monitor = pyudev.Monitor.from_netlink(context)
monitor.filter_by(subsystem='usb')

for device in iter(monitor.poll, None):
    if device.action == 'add':
        print('{} connected'.format(device))
        # do something very interesting here. 
```

将此保存到文件`usb_monitor.py`中，例如运行`python monitor.py`。插入任何 USB，它将打印设备详细信息

```
→ python usb_monitor.py 
Device('/sys/devices/pci0000:00/0000:00:14.0/usb1/1-6/1-6:1.0') connected
Device('/sys/devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1:1.0') connected 
```

在 Python 3.5 上使用`pyudev==0.21.0`.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-22T15:15:46.133

我认为 D-Bus 会像 Chris 提到的那样工作，但如果您使用 KDE4，您可能会以类似于 KDE4“新设备通知程序”小程序的方式使用 Solid 框架。

该小程序的 C++ 源代码在[这里](http://kollide.net:8060/browse/Plasma/applets/devicenotifier/devicenotifier.cpp?r=21574)，它展示了如何使用 Solid 来检测新设备。[使用 PyKDE4 将 Python 绑定到这些库，如此处](http://techbase.kde.org/Development/Languages/Python/Using_PyKDE_4)所示。

# java - Class.getResourceAsStream() 问题

> ID：469249
> 
> 赞同：3
> 
> 时间：2009-01-22T14:12:09.350
> 
> 标签：java

我有一个带有 java 类的 JAR 存档。其中之一使用嵌入到同一个 JAR 中的一些资源。为了加载我使用的资源

```
MyClass.class.getResourceAsStream(myResourceName); 
```

困扰我的一件事是，是否可以保证从同一个 JAR 中加载所需的资源。“getResourceAsStream()”方法（以及相应的 ClassLoader 方法）的文档对我来说并不是很清楚。

如果在我的 JAR 之前的 JVM 类路径中某处有同名的资源会发生什么？是否会加载该资源而不是我的 JAR 中嵌入的资源？有没有其他方法可以替代 JAR 中嵌入的资源？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T14:17:04.100

是的。返回在类路径上找到的第一个匹配资源，就像可执行搜索路径一样。这就是为什么资源通常通过将它们放在镜像库或应用程序的包结构的目录中来“命名空间”。

在存在自定义类加载器（例如在 OSGi 中）的情况下，这种行为可能会略有不同，但对于普通 Java 应用程序，情况就是如此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T22:45:49.580

指定包。假设您使用 com.yourcompany.file 它应该是唯一的。（除非有人想通过类路径覆盖你的配置文件。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T22:58:16.417

如果您只想从特定 JAR 中读取文件，您可以打开 JarFile 并直接读取它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-22T14:54:44.180

它的工作方式与查找类文件的方式大致相同。因此，首先尝试父类加载器（递归地），然后执行类加载器实现所做的任何事情来查找文件。

没有检查直接调用者类加载器（如- 请参阅[Java Secure Coding Guidelines](http://java.sun.com/security/seccodeguide.html)`ResourceBundle`的第 6.3 节）。但是，您确实需要权限才能打开,就像在默认实现中调用一样。`URL``ClassLoader.getResourceAsStream``URL.openStream`

# multithreading - NSPR 锁定超时

> ID：469255
> 
> 赞同：0
> 
> 时间：2009-01-22T14:13:06.667
> 
> 标签：multithreading, nspr

我使用 NSPR 作为我的跨平台线程库并使用这些锁：PRLock 和 PRRWLock。我想要锁定功能超时。因此，它应该等待 45 秒，如果在这段时间内无法获得锁，调用应该会出现错误。

然后我们可以在 45 秒内向用户报告错误。

我该怎么做？

实际上，我正在锁内执行一些 SQLite 操作，如果数据库很大（~1.9 GB），有时需要很长时间才能完成。如果获取锁定失败，我想在那个时候向用户提出错误。请帮忙。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-24T10:07:45.363

我自己没有使用过这个库，但大多数等待通常都会超时。

但是当我快速查看文档时，我发现 PRLock “获取锁不是可中断的操作，**也没有任何超时机制**。”。

[关联](https://developer.mozilla.org/en/PR_Lock)

# asp.net - ASP Web 服务可以返回 ZIP 文件吗？

> ID：469263
> 
> 赞同：3
> 
> 时间：2009-01-22T14:15:18.113
> 
> 标签：asp.net, web-services, zip

我希望这成为可能！

你能编写一个返回 ZIP 文件的 Web 服务（使用 C# 和 asmx）吗？

如果是这样，你能举一个简单的例子吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T14:17:30.603

当然，

无论是 ZIP、DOC、PDF。我们在 SOAP 世界中称之为[MTOM](http://en.wikipedia.org/wiki/MTOM)

[自己看这个例子](http://www.codeproject.com/KB/XML/MTOMWebServices.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T14:21:46.117

我不确定您是否可以将 MTOM 与 vanilla .NET asmx 服务一起使用（[请参阅此处](http://msdn.microsoft.com/en-us/library/bb552900.aspx)）。我知道如果使用 WCF 是可能的。

作为一种（较差的）替代方案，您可以编写一个 Web 方法，将压缩数据作为 base64 编码的字符串返回（根据文件的大小，这可能会很长，因此仅对小型数据集有用）。然后在客户端解码字符串以获取原始数据。

# security - 好的，所以我已经加密了我的数据现在我在哪里隐藏密钥？

> ID：469267
> 
> 赞同：9
> 
> 时间：2009-01-22T14:15:45.367
> 
> 标签：security, encryption, encryption-asymmetric

我有一个包含敏感信息的数据库。我可以对读写操作中的数据进行加密/解密。问题是我需要将密钥存储在应用程序中。如果有人入侵了他们可以访问数据库的方式，那么他们还可以获取应用程序（java）对其进行反编译并提取密钥。

这似乎充其量只是一个减速带。还有哪些其他解决方案可用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T14:23:40.263

您唯一能做的就是难以从应用程序中提取密钥。你不能让它成为不可能。如果您给某人一个包含您要保护的内容的盒子，如果您希望他们能够访问内容，则必须给他们密钥。一旦你给了他们钥匙，他们就可以为所欲为……如果他们不厌其烦地找到钥匙。

这是 Bob 和 Eve 是同一个人的情况，您想授予 Bob 访问权限但阻止 Eve 看到它。

这是 DRM，它不起作用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T14:20:51.393

我假设您有某种方法可以在允许用户访问数据库之前验证用户的凭据？

通常这类事物的架构如下：

*   数据库
*   服务器
*   客户

客户端连接到服务器，然后服务器连接到数据库。服务器确保客户端在允许他们访问敏感信息之前正确地进行身份验证。解密密钥仅存储在服务器上。没有人应该有权访问服务器，尤其是包含密钥的文件。这样，客户端就不必进行任何加密/解密，也不必存储任何密钥。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-22T14:21:02.953

阅读密钥库。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T14:18:07.950

要求用户输入密码才能访问他们的数据。将密钥埋在代码中是默默无闻的安全性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-22T14:35:04.017

将密钥存储在 CSP 容器中。考虑[这里的 Java CSP](http://www.cs.kent.ac.uk/projects/ofa/jcsp/jcsp-1.1-rc4/jcsp-doc/overview-summary.html)。

这是 IMO 最安全的方式。但是您也可以考虑将密钥存储在受操作系统使用某种 ACL 保护的文件中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-22T15:08:16.600

要求用户使用强密码登录；使用密码作为对称加密算法的密钥来解密非对称数据库密钥

在应用程序运行时将 db 密钥保存在安全内存中（如果这是一个选项）

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-01-22T14:18:17.123

加密密钥（使用 DPAPI），将其放入文件中，在该文件上放置 ACL 等...

# windows-vista - Windows Vista 中的安装文件名

> ID：469270
> 
> 赞同：2
> 
> 时间：2009-01-22T14:17:03.770
> 
> 标签：windows-vista, installation

我在这篇文章中读到：

[http://technet.microsoft.com/en-us/library/cc709628.aspx](http://technet.microsoft.com/en-us/library/cc709628.aspx)

Windows 通过文件名检测安装程序，遵循此提示，是否最好在安装程序的文件名中包含 setup

我的意思是 ProductSetup.msi 比 Product.msi 好？？？

很难想象 Windows 会进行这种检测 :-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T14:27:18.417

这仅适用于 EXE 文件。如果您有 MSI 文件，则由 MSI 文件指定 MSI 的哪些部分需要提升或不需要。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T14:27:24.657

这对我来说是个新闻，但是当 Windows Vista 以不同的方式处理文件时，它们的名称中包含“setup”。如果它检测到它是安装程序，它可能只会提示您预先提供管理权限，这正是您想要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T22:19:52.237

另外值得一读的是[用户帐户控制如何影响您的应用程序](http://msdn.microsoft.com/en-us/library/bb384608.aspx)，以确保您的设置以管理员身份运行，将正确的清单嵌入到设置 EXE 中。这样，您的安装名称（对 Vista 而言）无关紧要。

但是，如果您希望将应用程序安装在终端服务器上，那么如果您的安装程序被称为`SETUP.EXE`或`INSTALL.EXE`终端服务器将自动进入“安装模式”。应该让那些不知道他们应该首先处于安装模式，或者选择不通过添加/删除程序进行安装的客户（这也会自动启动安装模式）为您省去一些麻烦

# c# - C# 与 Java 枚举（适用于 C# 新手）

> ID：469287
> 
> 赞同：193
> 
> 时间：2009-01-22T14:19:13.220
> 
> 标签：c#, java, enums, language-comparisons

我已经用 Java 编程了一段时间，刚刚被扔到一个完全用 C# 编写的项目中。我试图加快 C# 的速度，并注意到在我的新项目中的几个地方使用了枚举，但乍一看，C# 的枚举似乎比 Java 1.5+ 实现更简单。谁能列举 C# 和 Java 枚举之间的差异，以及如何克服这些差异？（我不想引发语言火焰大战，我只想知道如何在 C# 中做一些我以前在 Java 中做的事情）。例如，有人可以发布 C# 对应 Sun 著名的 Planet 枚举示例吗？

```
public enum Planet {
  MERCURY (3.303e+23, 2.4397e6),
  VENUS   (4.869e+24, 6.0518e6),
  EARTH   (5.976e+24, 6.37814e6),
  MARS    (6.421e+23, 3.3972e6),
  JUPITER (1.9e+27,   7.1492e7),
  SATURN  (5.688e+26, 6.0268e7),
  URANUS  (8.686e+25, 2.5559e7),
  NEPTUNE (1.024e+26, 2.4746e7),
  PLUTO   (1.27e+22,  1.137e6);

  private final double mass;   // in kilograms
  private final double radius; // in meters
  Planet(double mass, double radius) {
      this.mass = mass;
      this.radius = radius;
  }
  public double mass()   { return mass; }
  public double radius() { return radius; }

  // universal gravitational constant  (m3 kg-1 s-2)
  public static final double G = 6.67300E-11;

  public double surfaceGravity() {
      return G * mass / (radius * radius);
  }
  public double surfaceWeight(double otherMass) {
      return otherMass * surfaceGravity();
  }
}

// Example usage (slight modification of Sun's example):
public static void main(String[] args) {
    Planet pEarth = Planet.EARTH;
    double earthRadius = pEarth.radius(); // Just threw it in to show usage

    // Argument passed in is earth Weight.  Calculate weight on each planet:
    double earthWeight = Double.parseDouble(args[0]);
    double mass = earthWeight/pEarth.surfaceGravity();
    for (Planet p : Planet.values())
       System.out.printf("Your weight on %s is %f%n",
                         p, p.surfaceWeight(mass));
}

// Example output:
$ java Planet 175
Your weight on MERCURY is 66.107583
Your weight on VENUS is 158.374842
[etc ...] 
```

* * *

## 回答 #1

> 赞同：232
> 
> 时间：2011-01-24T03:30:49.120

在 C# 中，您可以在枚举上定义[扩展方法](http://msdn.microsoft.com/en-us/library/bb383977.aspx)，这弥补了一些缺失的功能。

您可以定义`Planet`为枚举，也可以具有等效于`surfaceGravity()`and的扩展方法`surfaceWeight()`。

我使用了[Mikhail](https://stackoverflow.com/questions/469287/c-vs-java-enum-for-those-new-to-c/1416184#1416184)建议的自定义属性，但同样可以使用 Dictionary 来实现。

```
using System;
using System.Reflection;

class PlanetAttr: Attribute
{
    internal PlanetAttr(double mass, double radius)
    {
        this.Mass = mass;
        this.Radius = radius;
    }
    public double Mass { get; private set; }
    public double Radius { get; private set; }
}

public static class Planets
{
    public static double GetSurfaceGravity(this Planet p)
    {
        PlanetAttr attr = GetAttr(p);
        return G * attr.Mass / (attr.Radius * attr.Radius);
    }

    public static double GetSurfaceWeight(this Planet p, double otherMass)
    {
        return otherMass * p.GetSurfaceGravity();
    }

    public const double G = 6.67300E-11;

    private static PlanetAttr GetAttr(Planet p)
    {
        return (PlanetAttr)Attribute.GetCustomAttribute(ForValue(p), typeof(PlanetAttr));
    }

    private static MemberInfo ForValue(Planet p)
    {
        return typeof(Planet).GetField(Enum.GetName(typeof(Planet), p));
    }

}

public enum Planet
{
    [PlanetAttr(3.303e+23, 2.4397e6)]  MERCURY,
    [PlanetAttr(4.869e+24, 6.0518e6)]  VENUS,
    [PlanetAttr(5.976e+24, 6.37814e6)] EARTH,
    [PlanetAttr(6.421e+23, 3.3972e6)]  MARS,
    [PlanetAttr(1.9e+27,   7.1492e7)]  JUPITER,
    [PlanetAttr(5.688e+26, 6.0268e7)]  SATURN,
    [PlanetAttr(8.686e+25, 2.5559e7)]  URANUS,
    [PlanetAttr(1.024e+26, 2.4746e7)]  NEPTUNE,
    [PlanetAttr(1.27e+22,  1.137e6)]   PLUTO
} 
```

* * *

## 回答 #2

> 赞同：226
> 
> 时间：2009-01-22T14:25:03.130

CLR 中的枚举只是命名为常量。基础类型必须是整数。在 Java 中，枚举更像是一个类型的命名实例。该类型可能非常复杂，并且 - 如您的示例所示 - 包含各种类型的多个字段。

要将示例移植到 C#，我只需将枚举更改为不可变类并公开该类的静态只读实例：

```
using System;
using System.Collections.Generic;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            Planet planetEarth = Planet.MERCURY;

            double earthRadius = pEarth.Radius; // Just threw it in to show usage
            double earthWeight = double.Parse("123");
            double earthMass   = earthWeight / pEarth.SurfaceGravity();

            foreach (Planet p in Planet.Values)
                Console.WriteLine($"Your weight on {p} is {p.SurfaceWeight(mass)}");

            Console.ReadKey();
        }
    }

    public class Planet
    {
        public static readonly Planet MERCURY = new Planet("Mercury", 3.303e+23, 2.4397e6);
        public static readonly Planet VENUS   = new Planet("Venus", 4.869e+24, 6.0518e6);
        public static readonly Planet EARTH   = new Planet("Earth", 5.976e+24, 6.37814e6);
        public static readonly Planet MARS    = new Planet("Mars", 6.421e+23, 3.3972e6);
        public static readonly Planet JUPITER = new Planet("Jupiter", 1.9e+27, 7.1492e7);
        public static readonly Planet SATURN  = new Planet("Saturn", 5.688e+26, 6.0268e7);
        public static readonly Planet URANUS  = new Planet("Uranus", 8.686e+25, 2.5559e7);
        public static readonly Planet NEPTUNE = new Planet("Neptune", 1.024e+26, 2.4746e7);
        public static readonly Planet PLUTO   = new Planet("Pluto", 1.27e+22, 1.137e6);

        public static IEnumerable<Planet> Values
        {
            get
            {
                yield return MERCURY;
                yield return VENUS;
                yield return EARTH;
                yield return MARS;
                yield return JUPITER;
                yield return SATURN;
                yield return URANUS;
                yield return NEPTUNE;
                yield return PLUTO;
            }
        }

        public string Name   { get; private set; }
        public double Mass   { get; private set; }
        public double Radius { get; private set; }

        Planet(string name, double mass, double radius) => 
            (Name, Mass, Radius) = (name, mass, radius);

        // Wniversal gravitational constant  (m3 kg-1 s-2)
        public const double G = 6.67300E-11;
        public double SurfaceGravity()            => G * mass / (radius * radius);
        public double SurfaceWeight(double other) => other * SurfaceGravity();
        public override string ToString()         => name;
    }
} 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2009-09-12T21:27:37.823

在 C# 中，属性可以与枚举一起使用。这种编程模式的详细描述的好例子是[here](http://www.codeproject.com/Articles/38666/Enum-Pattern.aspx)（Codeproject）

```
public enum Planet
{
   [PlanetAttr(3.303e+23, 2.4397e6)]
   Mercury,
   [PlanetAttr(4.869e+24, 6.0518e6)]
   Venus
} 
```

**编辑：**这个问题最近被 Jon Skeet 再次提出并回答：[C# 中 Java 的枚举相当于什么？](https://stackoverflow.com/questions/1376312/whats-the-equivalent-of-javas-enum-in-c) [C# 中的私有内部类 - 为什么不经常使用它们？](https://stackoverflow.com/questions/454218/private-inner-classes-in-c-why-arent-they-used-more-often)

**编辑 2：**查看已[接受的答案](https://stackoverflow.com/a/4778347/136967)，它以非常出色的方式扩展了这种方法！

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-01-22T14:28:48.617

Java 枚举实际上是完整的类，可以具有私有构造函数和方法等，而 C# 枚举只是命名为整数。IMO Java 的实现要好得多。

[在学习来自 java 阵营的 c# 时，此页面应该对您有很大帮助。](http://www.25hoursaday.com/CsharpVsJava.html#enums)（链接指向关于枚举的差异（向上/向下滚动查看其他内容）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-22T14:40:06.533

我认为是这样的：

```
public class Planets 
{
    public static readonly Planet MERCURY = new Planet(3.303e+23, 2.4397e6);
    public static readonly Planet VENUS = new Planet(4.869e+24, 6.0518e6);
    public static readonly Planet EARTH = new Planet(5.976e+24, 6.37814e6);
    public static readonly Planet MARS = new Planet(6.421e+23, 3.3972e6);
    public static readonly Planet JUPITER = new Planet(1.9e+27,   7.1492e7);
    public static readonly Planet SATURN = new Planet(5.688e+26, 6.0268e7);
    public static readonly Planet URANUS = new Planet(8.686e+25, 2.5559e7);
    public static readonly Planet NEPTUNE = new Planet(1.024e+26, 2.4746e7);
    public static readonly Planet PLUTO = new Planet(1.27e+22,  1.137e6);
}

public class Planet
{
    public double Mass {get;private set;}
    public double Radius {get;private set;}

    Planet(double mass, double radius)
    {
        Mass = mass;
        Radius = radius;
    }

    // universal gravitational constant  (m3 kg-1 s-2)
    private static readonly double G = 6.67300E-11;

    public double SurfaceGravity()
    {
        return G * Mass / (Radius * Radius);
    }

    public double SurfaceWeight(double otherMass)
    {
        return otherMass * SurfaceGravity();
    }
} 
```

或者将常量组合到`Planet`上面的类中

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2019-08-02T14:58:58.453

我们刚刚为 c# [https://github.com/simonmau/enum_ext做了一个枚举扩展](https://github.com/simonmau/enum_ext)

它只是 typesafeenum 的一个实现，但它工作得很好，所以我们制作了一个包来分享 - 玩得开心

```
public sealed class Weekday : TypeSafeNameEnum<Weekday, int>
{
    public static readonly Weekday Monday = new Weekday(1, "--Monday--");
    public static readonly Weekday Tuesday = new Weekday(2, "--Tuesday--");
    public static readonly Weekday Wednesday = new Weekday(3, "--Wednesday--");
    ....

    private Weekday(int id, string name) : base(id, name)
    {
    }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-06-22T13:59:32.143

这是另一个有趣的想法，它迎合了 Java 中可用的自定义行为。我想出了以下`Enumeration`基类：

```
public abstract class Enumeration<T>
    where T : Enumeration<T>
{   
    protected static int nextOrdinal = 0;

    protected static readonly Dictionary<int, Enumeration<T>> byOrdinal = new Dictionary<int, Enumeration<T>>();
    protected static readonly Dictionary<string, Enumeration<T>> byName = new Dictionary<string, Enumeration<T>>();

    protected readonly string name;
    protected readonly int ordinal;

    protected Enumeration(string name)
        : this (name, nextOrdinal)
    {
    }

    protected Enumeration(string name, int ordinal)
    {
        this.name = name;
        this.ordinal = ordinal;
        nextOrdinal = ordinal + 1;
        byOrdinal.Add(ordinal, this);
        byName.Add(name, this);
    }

    public override string ToString()
    {
        return name;
    }

    public string Name 
    {
        get { return name; }
    }

    public static explicit operator int(Enumeration<T> obj)
    {
        return obj.ordinal;
    }

    public int Ordinal
    {
        get { return ordinal; }
    }
} 
```

它基本上有一个类型参数，因此序数可以在不同的派生枚举中正常工作。Jon Skeet 的`Operator`例子来自他对另一个问题的回答（http://stackoverflow.com/questions/1376312/whats-the-equivalent-of-javas-enum-in-c）然后变成：

```
public class Operator : Enumeration<Operator>
{
    public static readonly Operator Plus = new Operator("Plus", (x, y) => x + y);
    public static readonly Operator Minus =  new Operator("Minus", (x, y) => x - y);
    public static readonly Operator Times =  new Operator("Times", (x, y) => x * y);
    public static readonly Operator Divide = new Operator("Divide", (x, y) => x / y);

    private readonly Func<int, int, int> op;

    // Prevent other top-level types from instantiating
    private Operator(string name, Func<int, int, int> op)
        :base (name)
    {
        this.op = op;
    }

    public int Execute(int left, int right)
    {
        return op(left, right);
    }
} 
```

这带来了一些优势。

*   序数支持
*   转换为`string`并使`int`switch 语句可行
*   GetType() 将为派生的 Enumeration 类型的每个值提供相同的结果。
*   可以将来自的静态方法`System.Enum`添加到基本 Enumeration 类以实现相同的功能。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-22T14:27:15.640

Java 枚举是以 OO 方式呈现枚举的语法糖。它们是在 Java 中扩展 Enum 类的抽象类，每个 enum 值就像 enum 类的静态最终公共实例实现。查看生成的类，对于具有 10 个值的枚举“Foo”，您将看到生成的“Foo$1”到“Foo$10”类。

虽然我不知道 C#，但我只能推测该语言中的枚举更像 C 风格语言中的传统枚举。我从快速的 Google 搜索中看到，它们可以保存多个值，因此它们可能以类似的方式实现，但限制比 Java 编译器允许的要多得多。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-23T09:34:11.503

Java 枚举允许使用编译器生成的 valueOf 方法从名称进行简单的类型安全转换，即

```
// Java Enum has generics smarts and allows this
Planet p = Planet.valueOf("MERCURY"); 
```

C# 中原始枚举的等价物更加冗长：

```
// C# enum - bit of hoop jumping required
Planet p = (Planet)Enum.Parse(typeof(Planet), "MERCURY"); 
```

但是，如果您遵循 Kent 建议的路线，您可以轻松地`ValueOf`在枚举类中实现一个方法。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-06-04T19:48:50.767

我怀疑 C# 中的枚举只是 CLR 内部的常量，但对它们并不熟悉。我已经用 Java 反编译了一些类，我可以告诉你，一旦你转换了 Enums。

Java 做了一些鬼鬼祟祟的事情。它将枚举类视为普通类，在引用枚举值时使用大量宏，尽我所能。如果 Java 类中有一个使用枚举的 case 语句，它会将枚举引用替换为整数。如果您需要转到字符串，它会创建一个由它在每个类中使用的序数索引的字符串数组。我怀疑节省拳击。

如果你下载这个反编译器，你会看到它是如何创建它的类并集成它的。说实话比较吸引人。我以前不使用 enum 类，因为我认为它对于一个常量数组来说是臃肿的。比起在 C# 中使用它们的有限方式，我更喜欢它。

[http://members.fortunecity.com/neshkov/dj.html](http://members.fortunecity.com/neshkov/dj.html) -- Java 反编译器

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-01-19T21:01:52.033

Java 中的枚举比 C# 枚举复杂得多，因此更强大。由于它只是另一种编译时语法糖，我想知道是否真的值得包含该语言，因为它在现实生活应用程序中的使用有限。有时，将内容排除在语言之外比放弃包含次要功能的压力更难。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-06-27T06:15:01.050

```
//Review the sample enum below for a template on how to implement a JavaEnum.
//There is also an EnumSet implementation below.

public abstract class JavaEnum : IComparable {
    public static IEnumerable<JavaEnum> Values {
        get {
            throw new NotImplementedException("Enumeration missing");
        }
    }

    public readonly string Name;

    public JavaEnum(string name) {
        this.Name = name;
    }

    public override string ToString() {
        return base.ToString() + "." + Name.ToUpper();
    }

    public int CompareTo(object obj) {
        if(obj is JavaEnum) {
            return string.Compare(this.Name, ((JavaEnum)obj).Name);
        } else {
            throw new ArgumentException();
        }
    }

    //Dictionary values are of type SortedSet<T>
    private static Dictionary<Type, object> enumDictionary;
    public static SortedSet<T> RetrieveEnumValues<T>() where T : JavaEnum {
        if(enumDictionary == null) {
            enumDictionary = new Dictionary<Type, object>();
        }
        object enums;
        if(!enumDictionary.TryGetValue(typeof(T), out enums)) {
            enums = new SortedSet<T>();
            FieldInfo[] myFieldInfo = typeof(T).GetFields(BindingFlags.Static | BindingFlags.DeclaredOnly | BindingFlags.Public);
            foreach(FieldInfo f in myFieldInfo) {
                if(f.FieldType == typeof(T)) {
                    ((SortedSet<T>)enums).Add((T)f.GetValue(null));
                }
            }
            enumDictionary.Add(typeof(T), enums);
        }
        return (SortedSet<T>)enums;
    }
}

//Sample JavaEnum
public class SampleEnum : JavaEnum {
    //Enum values
    public static readonly SampleEnum A = new SampleEnum("A", 1);
    public static readonly SampleEnum B = new SampleEnum("B", 2);
    public static readonly SampleEnum C = new SampleEnum("C", 3);

    //Variables or Properties common to all enums of this type
    public int int1;
    public static int int2 = 4;
    public static readonly int int3 = 9;

    //The Values property must be replaced with a call to JavaEnum.generateEnumValues<MyEnumType>() to generate an IEnumerable set.
    public static new IEnumerable<SampleEnum> Values {
        get {
            foreach(var e in JavaEnum.RetrieveEnumValues<SampleEnum>()) {
                yield return e;
            }
            //If this enum should compose several enums, add them here
            //foreach(var e in ChildSampleEnum.Values) {
            //    yield return e;
            //}
        }
    }

    public SampleEnum(string name, int int1)
        : base(name) {
        this.int1 = int1;
    }
}

public class EnumSet<T> : SortedSet<T> where T : JavaEnum {
    // Creates an enum set containing all of the elements in the specified element type.
    public static EnumSet<T> AllOf(IEnumerable<T> values) {
        EnumSet<T> returnSet = new EnumSet<T>();
        foreach(T item in values) {
            returnSet.Add(item);
        }
        return returnSet;
    }

    // Creates an enum set with the same element type as the specified enum set, initially containing all the elements of this type that are not contained in the specified set.
    public static EnumSet<T> ComplementOf(IEnumerable<T> values, EnumSet<T> set) {
        EnumSet<T> returnSet = new EnumSet<T>();
        foreach(T item in values) {
            if(!set.Contains(item)) {
                returnSet.Add(item);
            }
        }
        return returnSet;
    }

    // Creates an enum set initially containing all of the elements in the range defined by the two specified endpoints.
    public static EnumSet<T> Range(IEnumerable<T> values, T from, T to) {
        EnumSet<T> returnSet = new EnumSet<T>();
        if(from == to) {
            returnSet.Add(from);
            return returnSet;
        }
        bool isFrom = false;
        foreach(T item in values) {
            if(isFrom) {
                returnSet.Add(item);
                if(item == to) {
                    return returnSet;
                }
            } else if(item == from) {
                isFrom = true;
                returnSet.Add(item);
            }
        }
        throw new ArgumentException();
    }

    // Creates an enum set initially containing the specified element(s).
    public static EnumSet<T> Of(params T[] setItems) {
        EnumSet<T> returnSet = new EnumSet<T>();
        foreach(T item in setItems) {
            returnSet.Add(item);
        }
        return returnSet;
    }

    // Creates an empty enum set with the specified element type.
    public static EnumSet<T> NoneOf() {
        return new EnumSet<T>();
    }

    // Returns a copy of the set passed in.
    public static EnumSet<T> CopyOf(EnumSet<T> set) {
        EnumSet<T> returnSet = new EnumSet<T>();
        returnSet.Add(set);
        return returnSet;
    }

    // Adds a set to an existing set.
    public void Add(EnumSet<T> enumSet) {
        foreach(T item in enumSet) {
            this.Add(item);
        }
    }

    // Removes a set from an existing set.
    public void Remove(EnumSet<T> enumSet) {
        foreach(T item in enumSet) {
            this.Remove(item);
        }
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-08-28T23:41:56.697

您还可以为每个枚举类型使用一个实用程序类，该类为每个枚举值保存一个包含高级数据的实例。

```
public enum Planet
{
    MERCURY,
    VENUS
}

public class PlanetUtil
{
    private static readonly IDictionary<Planet, PlanetUtil> PLANETS = new Dictionary<Planet, PlanetUtil();

    static PlanetUtil()
    {
        PlanetUtil.PLANETS.Add(Planet.MERCURY, new PlanetUtil(3.303e+23, 2.4397e6));
        PlanetUtil.PLANETS.Add(Planet.VENUS, new PlanetUtil(4.869e+24, 6.0518e6));
    }

    public static PlanetUtil GetUtil(Planet planet)
    {
        return PlanetUtil.PLANETS[planet];
    }

    private readonly double radius;
    private readonly double mass;

    public PlanetUtil(double radius, double mass)
    {
        this.radius = radius;
        this.mass = mass;
    }

    // getter
} 
```

# c# - 自定义游标中的内存泄漏

> ID：469314
> 
> 赞同：2
> 
> 时间：2009-01-22T14:24:34.910
> 
> 标签：c#, winforms, cursors

我正在尝试追踪内存泄漏，我认为这与正在使用的自定义光标图像有关。每次在表单上拖动某个对象时，似乎都会创建并显示一个新光标，但我无法找到它正在处理的任何地方。

我读过它需要被销毁，但我不知道该怎么做。更改光标时不应该自动处理它吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T14:29:17.147

永远不要假设任何事情都会自动发生。=)

这是我使用的一些代码，希望它是您正在寻找的。我只是挑选了它的jist，如果您需要更多详细信息，请告诉我。

```
 [DllImport("user32.dll")]
    private static extern bool DestroyIcon(IntPtr handle);
    private Cursor moveCursor;

    private void DestroyCursor()
    {
        if (this.moveCursor != null)
        {
            DestroyIcon(this.moveCursor.Handle);
        }
    } 
```

# c# - WPF/C#中的内存泄漏

> ID：469316
> 
> 赞同：6
> 
> 时间：2009-01-22T14:26:05.983
> 
> 标签：c#, wpf

请注意，这是在`WPF/C#`而不是在`.net2.0` `Winforms`

我有一个 ListBox ，其中包含 say 的对象`Class X`。X 类包含一个`BitmapSource`显示在列表框中的对象，因此它的显示类似于`[Image] [Text]`

这是通过使用加载的`CreateBitmapSourceFromHBitmap`- 注意我在调用期间调用`DeleteHBitmap`删除句柄`HBitmap`，这是众所周知的从我在 google/etc 上看到的帖子

`ListBox`我有一棵树，其中每个都包含所说的内容`TreeViewItem`-通常该树加载了几个项目。用户可以将这些图像拖放到不同的 TreeViewItems 中。为了处理这些操作，我手动调用操作：

```
<code>
    ItemCollection.RemoveAt
</code>

<code>
    ItemCollection.Insert
</code> 
```

到`move`ListBox 项目集合中的图像，请注意，当我插入时，我会创建一个新`Class X`对象以插入到`ListBox`项目集合中

我注意到在 5-10 分钟的一致拖放空间内，多次调用此类操作会导致一致的内存泄漏。

我的问题是：

我`BitmapSource`是否正确处理 's 的移动？有什么我正在做的事情导致图像不能完全从`ItemCollection`?

还是我错过了一些基本的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T16:25:14.763

在 ClassX 中保存图像的变量的定义是什么？？？问题可能在于您正在创建一个新的 ClassX，而旧的 ClassX 没有被 GC 删除，从而使头部有两个不同的 ClassX 实例。

由于您使用的是未管理的代码（CreateBitmapSourceFromHBitmap），您应该检查是否正确调用了所有 finalize 方法（尽管可能关闭或处置）并且没有可以指向您的 ClassX 的静态引用。

请记住，如果您的 ClassX 未删除，则 Bitmap 实例将在 GC 生成的图中可访问，因此不会将其从堆中删除。

我建议使用 perfmon 并添加 .Net 内存对象以查看是否有任何对象在 finalize 或 pinned 对象中幸存下来，这些是您可能对内存泄漏感兴趣的对象。

我希望它有帮助：P，但如果你把 ClassX 的代码放在上面会更好。

# sql - T-SQL，在一次选择中更新多个变量

> ID：469318
> 
> 赞同：56
> 
> 时间：2009-01-22T14:26:32.893
> 
> 标签：sql, sql-server, tsql

是否可以在一次选择中更新多个局部变量？

就像是：

```
set
    @variableOne = avg(someColumn),
    @variableTwo = avg(otherColumn)
    from tblTable 
```

为像这个任务这样微不足道的事情做两个单独的选择操作似乎有点浪费：

```
set @variableOne = ( select avg(someColumn) from tblTable )
set @variableTwo = ( select avg(otherColumn) from tblTable ) 
```

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-01-22T14:28:22.703

像这样的东西：

```
select @var1 = avg(someColumn), @var2 = avg(otherColumn) 
from theTable 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-22T15:00:22.903

您可以使用 SELECT 赋值来分配多个变量。此代码生成单行常量并将每个常量分配给一个变量。

```
SELECT
  @var1 = 1,
  @var2 = 'Zeus' 
```

您甚至可以通过这种方式查询表并进行分配：

```
SELECT
  @var1 = c.Column1,
  @var2 = c.Column2,
FROM
  Customers c
WHERE c.CustomerID = @CustomerID 
```

注意：此代码的运行方式类似于 while 循环。

*   如果有多行，每一行都将分配给变量，最后一行将是剩下的那一行。如果您没有指定排序，则您放弃了对哪一行将是最后一行的控制。
*   如果没有行，则根本不会分配变量。变量不会设置为 null - 它们将保持不变。如果赋值是在循环中完成的（通常会导致无限循环，因为变量永远不会改变），这是一个关键问题。

优先使用 SET 分配而不是 SELECT 分配。仅在考虑上述两种情况时才使用 SELECT 分配。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T14:30:27.613

怎么样

```
SELECT  @variableOne = avg(someColumn),  @variableTwo = avg(otherColumn) from tblTable 
```

它对我有用。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2019-12-10T22:45:49.193

```
SELECT DISTINCT 
@Var1 = Column1,
@Var2 = Column2
FROM MyTable 
WHERE Columnx = @Parm1 
```

# msbuild - 如何解决“只能指定一个项目”错误 CruiseControl.NET 中的任务

> ID：469330
> 
> 赞同：6
> 
> 时间：2009-01-22T14:28:47.227
> 
> 标签：msbuild, cruisecontrol.net

我正在尝试使用 CruiseControl.NET 版本 1.3.0.2918 中的任务，并且相当简单：

```
 <project name="AppBuilder 1.0 (Debug)">
    <workingDirectory>c:\depot\AppBuilder\1.0\</workingDirectory>
    <triggers/>
    <tasks>
      <msbuild/>
    </tasks>
   </project> 
```

但是，当项目运行时，它会在构建日志中显示以下信息：

> MSBUILD : 错误 MSB1008: 只能指定一个项目。开关：1.0
> 
> 对于切换语法，键入“MSBuild /help”

当我查看 ccnet.log 文件时，我发现：

> 使用参数 [/nologo "/p:CCNetArtifactDirectory=C:\Program 在工作目录 [c:\depot\AppBuilder\1.0] 中启动进程 [C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\MSBuild.exe] Files\CruiseControl.NET\server\AppBuilder 1.0（调试）\Artifacts;CCNetBuildCondition=ForceBuild;CCNetBuildDate=2009-01-22;CCNetBuildTime=09:25:55;CCNetIntegrationStatus=Unknown;CCNetLabel=3;CCNetLastIntegrationStatus=Failure;CCNetNumericLabel= 3;CCNetProject=AppBuilder 1.0 (调试);CCNetProjectUrl= [http://CISERVER01/ccnet;CCNetRequestSource=jstong](http://CISERVER01/ccnet;CCNetRequestSource=jstong) ; CCNetWorkingDirectory=c:\depot\AppBuilder\1.0\" ""/l:ThoughtWorks.CruiseControl.MsBuild.XmlLogger,ThoughtWorks. CruiseControl.MsBuild.dll;C:\Program Files\CruiseControl.NET\server\AppBuilder 1.0 (Debug)\Artifacts\msbuild-results.xml"]

从中我推断 msbuild 在正确的工作目录中运行，并且传递给它的命令行是：

> /nologo "/p:CCNetArtifactDirectory=C:\Program Files\CruiseControl.NET\server\AppBuilder 1.0 (Debug)\Artifacts;CCNetBuildCondition=ForceBuild;CCNetBuildDate=2009-01-22;CCNetBuildTime=09:25:55;CCNetIntegrationStatus=未知；CCNetLabel=3；CCNetLastIntegrationStatus=Failure；CCNetNumericLabel=3；CCNetProject=AppBuilder 1.0（调试）；CCNetProjectUrl= [http://CISERVER01/ccnet；CCNetRequestSource=jstong](http://CISERVER01/ccnet;CCNetRequestSource=jstong)；CCNetWorkingDirectory=c:\depot\AppBuilder\1.0\""/ l:ThoughtWorks.CruiseControl.MsBuild.XmlLogger,ThoughtWorks.CruiseControl.MsBuild.dll;C:\Program Files\CruiseControl.NET\server\AppBuilder 1.0 (Debug)\Artifacts\msbuild-results.xml"

如果我在命令行手动运行它，我会得到一个类似的错误。

在我看来，没有将正确的命令行传递给 MSBuild 可执行文件。

你能发现我的错误吗？或者这个版本的 CruiseControl.NET (1.3.0.2918) 是否与任务有关？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-22T20:22:53.313

我想这可能是你在工件目录路径中的空间。MSBuild 真的不喜欢空格，因为它认为它是参数之间的中断。您可以尝试从该路径中删除空间，看看会发生什么？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T14:34:04.360

为什么你的 msbuild 标签是空的？它应该类似于：

```
<msbuild>
  <executable>C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\MSBuild.exe</executable>
  <workingDirectory>C:\dev\ccnet</workingDirectory>
  <projectFile>CCNet.sln</projectFile>
  <buildArgs>/noconsolelogger /p:Configuration=Debug /v:diag</buildArgs>
  <targets>Build;Test</targets>
  <timeout>900</timeout>
  <logger>C:\Program Files\CruiseControl.NET\server\ThoughtWorks.CruiseControl.MsBuild.dll</logger>
</msbuild> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T19:07:58.800

没有更多细节，因为您似乎没有指定一个项目/解决方案文件，这让 MSBuild 假设一个。如果您在该目录中有多个 MSBuild 能够用作项目文件的文件，这可能会导致您的问题。您是否有一个 MSbuild .proj 和一个 .sln 文件？还是两个解决方案文件？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-16T18:23:48.673

我有一个类似的问题，（亚历克斯所说）删除我的空间确实解决了这个问题。然而，我确实遇到了另一种情况，即无法从名称中删除空格。在这种情况下，在名称周围添加引号解决了我的问题。

# mysql - 从 MySQL 中的另一个表中获取最新行

> ID：469338
> 
> 赞同：0
> 
> 时间：2009-01-22T14:30:12.717
> 
> 标签：mysql

假设我有两张表，新闻和评论。

```
news (
  id,
  subject,
  body,
  posted
)

comments (
  id,
  parent,  // points to news.id
  message,
  name,
  posted
) 
```

我想创建一个查询，以获取最新的 x # 条新闻以及每个新闻帖子的*最新评论的名称和发布日期。*

就选择子查询中的所有注释而言，速度很重要，这不是一个选项。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T17:39:33.363

我刚刚意识到，如果新闻表没有附加评论，查询不会返回结果，这是修复以及为帖子总数添加的列：

```
SELECT news.*, comments.name, comments.posted, (SELECT count(id) FROM comments WHERE comments.parent = news.id) AS numComments
FROM news
LEFT JOIN comments
ON news.id = comments.parent
AND comments.id = (SELECT max(id) FROM comments WHERE parent = news.id) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T14:48:29.887

如果速度那么重要，为什么不创建一个包含最近评论的 id 和父 id 的 recent_comment 表呢？每次在新闻帖子上发布评论时，替换该新闻 ID 的最新评论 ID。在新表的新闻 id 列上创建索引，您的连接将很快。

你会用写入速度换取读取速度，但不是很多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T15:02:21.497

假设发布是一个唯一的时间戳，否则选择一个唯一的自动编号

```
select c.id, c.parent, c.message, c.name, c.posted

  c.message, c.name, 

  c.posted -- same as comment_latest.recent

from comments c
join
(
    select parent, max(posted) as recent
    from comments
    group by parent
) as comment_latest
on c.parent = comment_latest.parent
and c.posted = comment_latest.recent 
```

* * *

完成（显示新闻信息）：

```
select 

  n.id as news_id, n.subject, n.body, n.posted as news_posted_date

  c.id as comment_id, 
  c.message, c.name as commenter_name, c.posted as comment_posted_date

from comments c
join
(
    select r.parent, max(r.posted) as recent
    from comments r
    join 
    (
       select id from news order by id desc limit $last_x_news
    ) news l
    on r.parent = l.id
    group by r.parent
) as comment_latest
on c.parent = comment_latest.parent
and c.posted = comment_latest.recent

join news n on c.parent = n.id 
```

* * *

**笔记：**

上面的代码不是子查询，是表派生查询。它比子查询快。这是子查询（慢）：

```
select 
  id,
  subject,
  body,
  posted as news_posted_date,
  (select id from comments where parent = news.id order by posted desc limit 1) as comment_id,
  (select message from comments where parent = news.id order by posted desc limit 1) as message,
  (select name from comments where parent = news.id order by posted desc limit 1) as name,
  (select posted from comments where parent = news.id order by posted desc limit 1) as comment_posted_date,
from news 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-22T15:50:56.937

```
SELECT news.subject, news.body, comments.name, comments.posted
FROM news
INNER JOIN comments ON
(comments.parent = news.id)
WHERE comments.parent = news.id
AND comments.id = (SELECT MAX(id)
FROM comments
WHERE parent = news.id)
ORDER BY news.id 
```

这将获取所有新闻项目，以及具有最高 id 值的相关评论，理论上应该是最新的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-22T16:16:52.937

我的解决方案与*J*类似，但我认为他添加了一行不必要的内容：

```
SELECT news.*, comments.name, comments.posted FROM news INNER JOIN comments ON news.id = comments.parent WHERE comments.id = (SELECT max(id) FROM comments WHERE parent = news.id ) 
```

不过，不确定在一张非常大的桌子上的速度。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T15:05:06.687

鉴于我在其他答案的评论中发现的限制条件，我有一个新想法，在实践中可能有意义，也可能没有意义。

使用以下定义创建一个视图（或更合适的函数），称为recent_comments：

```
SELECT MAX(id), parent
FROM comments
GROUP BY parent 
```

如果您在父列上有一个聚集索引，这可能是一个相当快的查询，但即便如此它仍然是一个瓶颈。

使用它，您需要得到答案的查询类似于，

```
SELECT news.*, comments.*
FROM news
INNER JOIN recent_comments
ON news.id = recent_comments.parent
INNER JOIN comments
ON comments.id = recent_comments.id 
```

加上尚未有任何评论的新闻帖子的注意事项。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-01T06:54:44.157

我认为@Jan 提供的解决方案是最好的。即创建“视图”并将其与 SQL 语句内部连接。

它肯定会减少提取数据的时间。我测试了它，它可以 100% 工作。

# xml - DataSet.WriteToXml 中缺少根命名空间

> ID：469341
> 
> 赞同：0
> 
> 时间：2009-01-22T14:30:22.420
> 
> 标签：xml, dataset, namespaces

1）我做一个 Dataset.WriteToXml（内存流对象） 2）然后我创建一个 XMLDocument 对象 3）然后我 XMLDocument.Load（内存流对象）

我收到“未找到 XML 根命名空间”异常。

数据集 XML 是否不包含所需的命名空间？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T14:51:55.090

您是否在尝试将内存流加载到 XmlDocument 之前重新定位它？

```
DataSet ds = new DataSet();
using (SqlConnection connection = new SqlConnection("some connection string"))
using (SqlCommand command = new SqlCommand("select * from mytable", connection))
using (SqlDataAdapter adapter = new SqlDataAdapter(command))
{
    adapter.Fill(ds);
}

XmlDocument xml = new XmlDocument();
using (Stream stream = new MemoryStream())
{
    ds.WriteXml(stream);
    // We must reposition the memory stream before loading the xml
    stream.Position = 0;
    xml.Load(stream);
} 
```

# vba - VBA中是否有等效于 Thread.Sleep()

> ID：469347
> 
> 赞同：45
> 
> 时间：2009-01-22T14:32:46.830
> 
> 标签：vba, ms-access, sleep

`Thread.Sleep()`Access VBA中是否有等价物？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-01-22T14:36:20.923

```
Declare Sub Sleep Lib "kernel32" Alias "Sleep" _
(ByVal dwMilliseconds As Long) 
```

使用以下语法调用 Sleep 函数：

```
Sub Sleep()
Sleep 1000 'Implements a 1 second delay
End Sub 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-10-17T23:27:59.423

不使用 kernel32 的另一种方法：

```
Dim started As Single: started = Timer

Do: DoEvents: Loop Until Timer - started >= 1 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-11-10T14:44:21.127

需要进行一些修改才能使代码正常工作。下面的代码是更正后的版本。

```
Declare Sub Sleep Lib "kernel32" Alias "Sleep" (ByVal dwMilliseconds As Long)

Sub SleepVBA() 
Sleep 1000 'Implements a 1 second delay 
End Sub 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-01-16T18:59:51.463

使 Excel 等待的所有其他方法都会导致 Excel 完全无响应。在确保响应式 UI 的同时让 Excel 等待的解决方案是使用等待秒数调用此等待 Sub。

```
 Sub Wait(seconds As Integer)
      Dim now As Long
      now = Timer()
      Do
          DoEvents
      Loop While (Timer < now + seconds)
    End Sub 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-03-01T17:15:31.317

我在 Excel 中使用它，效果很好：

```
Application.Wait DateAdd("s", 1, Now()) 
```

DateAdd() 是一个设置时间的函数，相对于`Now()`（在这种情况下 - 您可以使用其他值作为参数），`"s"`是时间度量（在这种情况下为秒），增量为 1。所以在这里，函数call 告诉应用程序等待 1 秒。

[**有关该功能的使用的更多详细信息，**另请参阅**`DateAdd`。**](http://msdn.microsoft.com/en-us/library/hcxe65wz%28v=vs.80%29.aspx)

 *** * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-12-01T16:18:00.343

如果您使用`Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)`，您可能会在对象模块中收到此错误。

[![在此处输入图像描述](https://i.stack.imgur.com/4RsY5.png)](https://i.stack.imgur.com/4RsY5.png)

如果是这样，您可以将其声明为私有：

`Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)`

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-02-11T16:16:32.000

可以使用 Access VBA 中的 Excel Wait() 过程。

第一步是确保您的项目引用了 Excel 库。

完成后，以下代码将等待十秒钟：

```
Call Excel.Application.Wait(Time:=DateAdd("s",10,Now())) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-10-20T17:57:42.983

添加

```
Declare Sub Sleep Lib "kernel32" Alias "Sleep" (ByVal dwMilliseconds As Long) 
```

不知何故在我的代码中的其他地方产生了额外的问题。我最终使用了我在另一个论坛上找到的这个功能，并稍微调整了一下：

```
Function WaitTime(n As Double)
'Function that wait an amount of time n in seconds
TWait = Time
TWait = DateAdd("s", n, TWait)
Do Until TNow >= TWait
     TNow = Time
Loop
End Function 
```

希望这可以帮助 ：）

# winapi - VerQueryValue 文件版本与 Windows Shell 不匹配

> ID：469350
> 
> 赞同：0
> 
> 时间：2009-01-22T14:33:23.707
> 
> 标签：winapi, dll, versioninfo

我正在使用[VerQueryValue](http://www.google.co.uk/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fms647464(VS.85).aspx&ei=V4N4SbfNGNzFjAfoq4mzAQ&usg=AFQjCNGKeUAmRnuBiua6Y8uBzbkBFRGQxg&sig2=yInI3Sqsq-PRMuIMPmfGSA)从 DLL 的 VersionInfo 中检索字符串。

一切正常，除了资源管理器显示的 FileVersion（右键单击文件、属性、详细信息、“文件版本”）与我从 VerQueryValue 获得的字符串不匹配。

我对 VerQueryValue 的所有其他调用都运行良好，但 FileVersion 似乎检索到与 ProductVersion 相同的数据。我已经尝试过用不同语言（C++ 和 Delphi）编写的两种不同的“版本信息”组件，并且都表现出这种行为，所以我认为这不是我（或他们的）代码中的错误。

我能想到的两种可能：

*   VerQueryValue 中的一个错误
*   或者，Windows shell 实际上显示的不是 FileVersion 字符串。

有人知道它可能是哪个吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T15:35:06.157

VerQueryValue 的 lpSubBlock 参数（第二个参数）是否设置为您所在区域设置的正确值？对于*英语 - 英国*，这将是：

```
StringFileInfo\080904E4\FileVersion 
```

[这个页面](http://techsupt.winbatch.com/TS/T000001050F49.html)有更多的语言/字符集标识符。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2010-11-10T06:48:08.093

Read this [KB160042](http://support.microsoft.com/kb/160042), i think you will find your answer.

# javascript - HTML 文本输入只允许数字输入

> ID：469357
> 
> 赞同：1018
> 
> 时间：2009-01-22T14:36:17.960
> 
> 标签：javascript, jquery, html

有没有一种快速的方法可以将 HTML 文本输入 ( `<input type=text />`) 设置为只允许数字键击（加 '.'）？

* * *

## 回答 #1

> 赞同：1286
> 
> 时间：2009-01-22T14:37:57.037

^(**注意：**这是一个更新的答案。下面的评论指的是一个乱码的旧版本。)

# JavaScript

**[在 JSFiddle 上](https://jsfiddle.net/emkey08/zgvtjc51)自己尝试一下。**

`<input>`您可以使用以下功能过滤文本的输入值`setInputFilter`（支持复制+粘贴、拖放、键盘快捷键、上下文菜单操作、不可键入的键、插入符号位置、不同的键盘布局以及[自 IE 9 以来的所有浏览器](https://caniuse.com/#feat=input-event)） ：

```
// Restricts input for the given textbox to the given inputFilter function.
function setInputFilter(textbox, inputFilter) {
  ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function(event) {
    textbox.addEventListener(event, function() {
      if (inputFilter(this.value)) {
        this.oldValue = this.value;
        this.oldSelectionStart = this.selectionStart;
        this.oldSelectionEnd = this.selectionEnd;
      } else if (this.hasOwnProperty("oldValue")) {
        this.value = this.oldValue;
        this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
      } else {
        this.value = "";
      }
    });
  });
} 
```

您现在可以使用该`setInputFilter`功能安装输入过滤器：

```
setInputFilter(document.getElementById("myTextBox"), function(value) {
  return /^\d*\.?\d*$/.test(value); // Allow digits and '.' only, using a RegExp
}); 
```

有关更多输入过滤器示例，请参阅[JSFiddle 演示](https://jsfiddle.net/emkey08/zgvtjc51)。另请注意，您仍然**必须进行服务器端验证！**

# 打字稿

这是一个 TypeScript 版本。

```
function setInputFilter(textbox: Element, inputFilter: (value: string) => boolean): void {
    ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function(event) {
        textbox.addEventListener(event, function(this: (HTMLInputElement | HTMLTextAreaElement) & {oldValue: string; oldSelectionStart: number | null, oldSelectionEnd: number | null}) {
            if (inputFilter(this.value)) {
                this.oldValue = this.value;
                this.oldSelectionStart = this.selectionStart;
                this.oldSelectionEnd = this.selectionEnd;
            } else if (Object.prototype.hasOwnProperty.call(this, 'oldValue')) {
                this.value = this.oldValue;
                if (this.oldSelectionStart !== null &&
                    this.oldSelectionEnd !== null) {
                    this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                }
            } else {
                this.value = "";
            }
        });
    });
} 
```

# jQuery

还有一个 jQuery 版本。看到[这个答案](https://stackoverflow.com/a/995193/1070129)。

# HTML 5

HTML 5 有一个原生解决方案`<input type="number">`（参见[规范](https://www.w3.org/TR/html/sec-forms.html#number-state-typenumber)），但请注意浏览器支持各不相同：

*   大多数浏览器只会在提交表单时验证输入，而不是在输入时。
*   [大多数移动浏览器](https://caniuse.com/#feat=input-number)不支持`step`,`min`和`max`属性。
*   Chrome（版本 71.0.3578.98）仍然允许用户输入字符`e`并`E`进入字段。另请参阅[此问题](https://stackoverflow.com/q/31706611)。
*   Firefox（64.0 版）和 Edge（EdgeHTML 17.17134 版）仍然允许用户在字段中输入*任何*文本。

[在 w3schools.com 上](http://www.w3schools.com/html/tryit.asp?filename=tryhtml5_input_type_number)亲自尝试。

* * *

## 回答 #2

> 赞同：314
> 
> 时间：2009-01-22T14:55:54.770

使用这个 DOM

```
<input type='text' onkeypress='validate(event)' /> 
```

而这个脚本

```
function validate(evt) {
  var theEvent = evt || window.event;

  // Handle paste
  if (theEvent.type === 'paste') {
      key = event.clipboardData.getData('text/plain');
  } else {
  // Handle key press
      var key = theEvent.keyCode || theEvent.which;
      key = String.fromCharCode(key);
  }
  var regex = /[0-9]|\./;
  if( !regex.test(key) ) {
    theEvent.returnValue = false;
    if(theEvent.preventDefault) theEvent.preventDefault();
  }
} 
```

* * *

## 回答 #3

> 赞同：180
> 
> 时间：2015-03-03T18:05:55.330

这是一个简单的，它只允许一个小数，但不能再多了：

```
<input type="text" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1');" />
```

* * *

## 回答 #4

> 赞同：161
> 
> 时间：2010-08-04T09:00:36.440

我一直在努力寻找一个好的答案，我们迫切需要`<input type="number"`，但除此之外，这两种方法是我能想到的最简洁的方法：

```
<input type="text" 
       onkeyup="this.value=this.value.replace(/[^\d]/,'')"> 
```

如果您不喜欢在被擦除之前显示一秒钟的未接受字符，以下方法是我的解决方案。请注意许多附加条件，这是为了避免禁用各种导航和热键。如果有人知道如何压缩它，请告诉我们！

```
<input type="text" 
onkeydown="return ( event.ctrlKey || event.altKey 
                    || (47<event.keyCode && event.keyCode<58 && event.shiftKey==false) 
                    || (95<event.keyCode && event.keyCode<106)
                    || (event.keyCode==8) || (event.keyCode==9) 
                    || (event.keyCode>34 && event.keyCode<40) 
                    || (event.keyCode==46) )"> 
```

* * *

## 回答 #5

> 赞同：63
> 
> 时间：2015-04-27T17:30:36.747

**这里的大多数答案都有使用键事件的弱点**。

许多答案会限制您使用键盘宏、复制+粘贴和更多不需要的行为进行文本选择的能力，其他答案似乎依赖于特定的 jQuery 插件，这正在用机枪杀死苍蝇。

这个简单的解决方案似乎最适合我跨平台，无论输入机制如何（击键、复制+粘贴、右键复制+粘贴、语音到文本等）。所有文本选择键盘宏仍然可以工作，甚至会限制通过脚本设置非数字值的能力。

```
function forceNumeric(){
    var $input = $(this);
    $input.val($input.val().replace(/[^\d]+/g,''));
}
$('body').on('propertychange input', 'input[type="number"]', forceNumeric); 
```

* * *

## 回答 #6

> 赞同：58
> 
> 时间：2009-01-22T18:09:35.613

HTML5 有`<input type=number>`，这听起来很适合你。目前，只有 Opera 原生支持它，但有[一个项目](http://code.google.com/p/webforms2/)有 JavaScript 实现。

* * *

## 回答 #7

> 赞同：57
> 
> 时间：2010-05-22T14:39:39.800

还有一个例子，它对我很有用：

```
function validateNumber(event) {
    var key = window.event ? event.keyCode : event.which;
    if (event.keyCode === 8 || event.keyCode === 46) {
        return true;
    } else if ( key < 48 || key > 57 ) {
        return false;
    } else {
        return true;
    }
}; 
```

还附加到按键事件

```
$(document).ready(function(){
    $('[id^=edit]').keypress(validateNumber);
}); 
```

和 HTML：

```
<input type="input" id="edit1" value="0" size="5" maxlength="5" /> 
```

[这是一个 jsFiddle 示例](http://jsfiddle.net/awkbng0w/471/)

* * *

## 回答 #8

> 赞同：50
> 
> 时间：2011-09-02T12:52:52.380

HTML5 支持正则表达式，所以你可以使用这个：

```
<input id="numbersOnly" pattern="[0-9.]+" type="text"> 
```

警告：一些浏览器还不支持这个。

* * *

## 回答 #9

> 赞同：43
> 
> 时间：2013-03-12T19:41:58.997

我选择使用这里提到的两个答案的组合，即

`<input type="number" />`

和

```
function isNumberKey(evt){
    var charCode = (evt.which) ? evt.which : evt.keyCode
    return !(charCode > 31 && (charCode < 48 || charCode > 57));
} 
```

`<input type="text" onkeypress="return isNumberKey(event);">`

* * *

## 回答 #10

> 赞同：22
> 
> 时间：2012-08-27T13:21:04.457

JavaScript

```
function validateNumber(evt) {
    var e = evt || window.event;
    var key = e.keyCode || e.which;

    if (!e.shiftKey && !e.altKey && !e.ctrlKey &&
    // numbers   
    key >= 48 && key <= 57 ||
    // Numeric keypad
    key >= 96 && key <= 105 ||
    // Backspace and Tab and Enter
    key == 8 || key == 9 || key == 13 ||
    // Home and End
    key == 35 || key == 36 ||
    // left and right arrows
    key == 37 || key == 39 ||
    // Del and Ins
    key == 46 || key == 45) {
        // input is VALID
    }
    else {
        // input is INVALID
        e.returnValue = false;
        if (e.preventDefault) e.preventDefault();
    }
} 
```

另外，您可以添加逗号、句点和减号 (,.-)

```
 // comma, period and minus, . on keypad
  key == 190 || key == 188 || key == 109 || key == 110 || 
```

HTML

```
<input type="text" onkeydown="validateNumber(event);"/ > 
```

* * *

## 回答 #11

> 赞同：17
> 
> 时间：2009-01-22T14:46:46.473

2个解决方案：

使用表单验证器（例如使用[jQuery 验证插件](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)）

在输入字段的 onblur（即用户离开字段）事件期间使用正则表达式进行检查：

```
<script type="text/javascript">
function testField(field) {
    var regExpr = new RegExp("^\d*\.?\d*$");
    if (!regExpr.test(field.value)) {
      // Case of error
      field.value = "";
    }
}

</script>

<input type="text" ... onblur="testField(this);"/> 
```

* * *

## 回答 #12

> 赞同：17
> 
> 时间：2012-12-12T04:47:28.357

**// 在 JavaScript 函数中（可以使用 HTML 或 PHP）。**

```
function isNumberKey(evt){
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode > 31 && (charCode < 48 || charCode > 57))
        return false;
    return true;
} 
```

**在您的表单输入中：**

```
<input type=text name=form_number size=20 maxlength=12 onkeypress='return isNumberKey(event)'> 
```

最大输入 （以上允许 12 位数字）

* * *

## 回答 #13

> 赞同：15
> 
> 时间：2011-11-15T18:23:32.440

一种更安全的方法是检查输入的值，而不是劫持按键并尝试过滤键码。

这样，用户可以自由使用键盘箭头、修改键、退格、删除、使用非标准键盘、使用鼠标粘贴、使用拖放文本，甚至使用辅助输入。

下面的脚本允许正数和负数

```
1
10
100.0
100.01
-1
-1.0
-10.00
1.0.0 //not allowed 
```

```
var input = document.getElementById('number');
input.onkeyup = input.onchange = enforceFloat;

//enforce that only a float can be inputed
function enforceFloat() {
  var valid = /^\-?\d+\.\d*$|^\-?[\d]*$/;
  var number = /\-\d+\.\d*|\-[\d]*|[\d]+\.[\d]*|[\d]+/;
  if (!valid.test(this.value)) {
    var n = this.value.match(number);
    this.value = n ? n[0] : '';
  }
}
```

```
<input id="number" value="-3.1415" placeholder="Type a number" autofocus>
```

编辑：我删除了我的旧答案，因为我认为它现在已经过时了。

* * *

## 回答 #14

> 赞同：14
> 
> 时间：2013-12-27T09:33:54.607

您可以为此使用模式：

```
<input id="numbers" pattern="[0-9.]+" type="number"> 
```

[在这里可以看到完整的手机网站界面提示](http://javacourseblog.blogspot.in/2013/12/how-to-make-user-friendly-interface-for.html)。

* * *

## 回答 #15

> 赞同：13
> 
> 时间：2017-08-03T08:58:53.477

请找到下面提到的解决方案。在这个用户中只能输入值，`numeric`用户也不能在输入中输入`copy`、、和。`paste``drag``drop`

> **允许的字符**

```
0,1,2,3,4,5,6,7,8,9 
```

> **不允许角色和角色通过事件**

*   **字母值**
*   **特殊的角色**
*   **复制**
*   **粘贴**
*   **拖**
*   **降低**

```
$(document).ready(function() {
  $('#number').bind("cut copy paste drag drop", function(e) {
      e.preventDefault();
  });     
});
function isNumberKey(evt) {
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode > 31 && (charCode < 48 || charCode > 57))
        return false;
    return true;
}
```

```
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<input type="text" class="form-control" name="number" id="number" onkeypress="return isNumberKey(event)" placeholder="Enter Numeric value only">
```

让我知道它是否不起作用。

* * *

## 回答 #16

> 赞同：13
> 
> 时间：2017-09-04T16:46:54.820

还有一个例子，你**可以**在输入字段中只添加数字，**不能**添加字母

```
<input type="text" class="form-control" id="phone" name="phone" placeholder="PHONE" spellcheck="false" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"> 
```

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2010-07-29T17:31:18.470

如果您想在字母或数字之间向设备（可能是手机）建议，您可以使用`<input type="number">`.

* * *

## 回答 #18

> 赞同：10
> 
> 时间：2011-05-23T10:41:54.367

使用 jQuery 和 replace() 而不是查看 event.keyCode 或 event.which 的简短而甜蜜的实现：

```
$('input.numeric').live('keyup', function(e) {
  $(this).val($(this).val().replace(/[^0-9]/g, ''));
}); 
```

只有小的副作用是输入的字母会暂时出现，并且 CTRL/CMD + A 似乎表现得有点奇怪。

* * *

## 回答 #19

> 赞同：10
> 
> 时间：2017-11-23T05:54:35.110

现在只需使用**type="number"**这个属性在大多数浏览器中都支持

```
<input type="number" maxlength="3" ng-bind="first"> 
```

* * *

## 回答 #20

> 赞同：10
> 
> 时间：2019-01-06T14:15:58.293

解决此问题的一种简单方法是实现一个 jQuery 函数，以使用正则表达式验证在文本框中键入的字符，例如：

你的html代码：

```
<input class="integerInput" type="text"> 
```

以及使用jQuery的js函数

```
$(function() {
    $('.integerInput').on('input', function() {
      this.value = this.value
        .replace(/[^\d]/g, '');// numbers and decimals only

    });
}); 
```

```
$(function() {
        $('.integerInput').on('input', function() {
          this.value = this.value
            .replace(/[^\d]/g, '');// numbers and decimals only

        });
    });
```

```
<script
			  src="https://code.jquery.com/jquery-2.2.4.min.js"
			  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
			  crossorigin="anonymous">
</script>

<input type="text" class="integerInput"/> 
```

* * *

## 回答 #21

> 赞同：9
> 
> 时间：2012-05-01T15:52:54.457

JavaScript 代码：

```
function validate(evt)
{
    if(evt.keyCode!=8)
    {
        var theEvent = evt || window.event;
        var key = theEvent.keyCode || theEvent.which;
        key = String.fromCharCode(key);
        var regex = /[0-9]|\./;
        if (!regex.test(key))
        {
            theEvent.returnValue = false;

            if (theEvent.preventDefault)
                theEvent.preventDefault();
            }
        }
    } 
```

HTML 代码：

```
<input type='text' name='price' value='0' onkeypress='validate(event)'/> 
```

完美工作，因为退格键码是 8 并且正则表达式不允许它，所以这是绕过错误的简单方法:)

* * *

## 回答 #22

> 赞同：9
> 
> 时间：2013-12-20T13:09:55.970

`input type="number"`是一个 HTML5 属性。

在另一种情况下，这将帮助您：

```
function isNumberKey(evt){
    var charCode = (evt.which) ? evt.which : evt.keyCode
    if (charCode > 31 && (charCode < 48 || charCode > 57))
        return false;
    return true;
}

<input type="number" name="somecode" onkeypress="return isNumberKey(event)"/> 
```

* * *

## 回答 #23

> 赞同：8
> 
> 时间：2012-02-23T17:21:15.043

只是使用 jQuery 的另一个变体

```
$(".numeric").keypress(function() {
    return (/\d/.test(String.fromCharCode(event.which) ))
}); 
```

* * *

## 回答 #24

> 赞同：7
> 
> 时间：2019-04-11T12:17:21.060

我看到了一些很棒的答案，但是我喜欢它们尽可能小和简单，所以也许有人会从中受益。我会使用这样的javascript`Number()`和`isNaN`功能：

```
if(isNaN(Number(str))) {
   // ... Exception it is NOT a number
} else {
   // ... Do something you have a number
} 
```

希望这可以帮助。

* * *

## 回答 #25

> 赞同：6
> 
> 时间：2011-11-22T10:38:59.687

您还可以将输入值（默认情况下被视为字符串）与强制为数字的自身进行比较，例如：

```
if(event.target.value == event.target.value * 1) {
    // returns true if input value is numeric string
} 
```

但是，您需要将其绑定到 keyup 等事件。

* * *

## 回答 #26

> 赞同：6
> 
> 时间：2013-06-06T20:46:06.960

```
<input name="amount" type="text" value="Only number in here"/> 

<script>
    $('input[name=amount]').keyup(function(){
        $(this).val($(this).val().replace(/[^\d]/,''));
    });
</script> 
```

* * *

## 回答 #27

> 赞同：5
> 
> 时间：2010-12-04T16:24:15.420

这是一个改进的功能：

```
function validateNumber(evt) {
  var theEvent = evt || window.event;
  var key = theEvent.keyCode || theEvent.which;
  if ((key < 48 || key > 57) && !(key == 8 || key == 9 || key == 13 || key == 37 || key == 39 || key == 46) ){
    theEvent.returnValue = false;
    if (theEvent.preventDefault) theEvent.preventDefault();
  }
} 
```

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2013-03-03T06:11:17.173

使用这个 DOM：

```
<input type = "text" onkeydown = "validate(event)"/> 
```

这个脚本：

```
validate = function(evt)
{
    if ([8, 46, 37, 39, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 35, 36].indexOf(evt.keyCode || evt.which) == -1)
    {
        evt.returnValue = false;
        if(evt.preventDefault){evt.preventDefault();}
    }
} 
```

...或此脚本，没有 indexOf，使用两个`for`...

```
validate = function(evt)
{
    var CharValidate = new Array("08", "046", "039", "948", "235");
    var number_pressed = false;
    for (i = 0; i < 5; i++)
    {
        for (Ncount = 0; Ncount < parseInt(CharValidate[i].substring(0, 1)) + 1; Ncount++)
        {
            if ((evt.keyCode || evt.which) == parseInt(CharValidate[i].substring(1, CharValidate[i].lenght)) + Ncount)
            {
                number_pressed = true;
            }
        }
    }
    if (number_pressed == false)
    {
        evt.returnValue = false;
        if(evt.preventDefault){evt.preventDefault();}
    }
} 
```

我使用了onkeydown 属性而不是onkeypress，因为onkeydown 属性在onkeypress 属性之前被检查。问题出在 Google Chrome 浏览器中。

使用属性“onkeypress”，TAB 将在谷歌浏览器上使用“preventDefault”无法控制，但是，使用属性“onkeydown”，TAB 变得可控！

TAB 的 ASCII 码 => 9

第一个脚本的代码比第二个少，但是，ASCII 字符数组必须包含所有键。

第二个脚本比第一个大得多，但数组不需要所有键。数组每个位置的第一个数字是每个位置将被读取的次数。对于每个读数，将递增 1 到下一个读数。例如：

NCount = 0

48 + NCount = 48

NCount + +

48 + NCount = 49

NCount + +

...

48 + NCount = 57

在数字键只有 10 (0 - 9) 的情况下，但如果它们是 100 万，则使用所有这些键创建一个数组是没有意义的。

ASCII码：

*   8 ==>（退格）；
*   46 =>（删除）；
*   37 =>（左箭头）；
*   39 =>（右箭头）；
*   48 - 57 =>（数字）；
*   36 => (家);
*   35 =>（结束）；

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2017-04-05T04:17:04.323

我的解决方案以获得更好的用户体验：

> HTML

```
<input type="tel"> 
```

> jQuery

```
$('[type=tel]').on('change', function(e) {
  $(e.target).val($(e.target).val().replace(/[^\d\.]/g, ''))
})
$('[type=tel]').on('keypress', function(e) {
  keys = ['0','1','2','3','4','5','6','7','8','9','.']
  return keys.indexOf(event.key) > -1
}) 
```

**细节：**

首先，*输入类型*：

`number`显示缩小实际输入空间的向上/向下箭头，我发现它们很难看，并且仅在数字代表数量时才有用（电话，区号，ID ......不需要它们） `tel`提供类似的浏览器验证数字没有箭头

使用 [number / tel] 还有助于在移动设备上显示数字键盘。

对于 JS 验证，我最终需要 2 个函数，一个用于普通用户输入（按键），另一个用于复制+粘贴修复（更改），其他组合会给我带来糟糕的用户体验。

我使用*更可靠的* [KeyboardEvent.key](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key)而不是*现在已弃用的* [KeyboardEvent.charCode](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/charCode)

根据您的浏览器支持，您可以考虑使用[Array.prototype.includes()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes)而不是名称不佳的[Array.prototype.indexOf()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)（对于真/假结果）

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2021-06-20T04:16:30.803

**这是我仅针对 React 用户**的简单解决方案，我找不到更好的解决方案并自己制作。3个步骤。

首先，创建一个状态。

```
const [tagInputVal, setTagInputVal] = useState(""); 
```

然后，使用状态作为输入值 ( `value={tagInputVal}`) 并将事件传递给`onChange`处理程序。

```
<input id="tag-input" type="text" placeholder="Add a tag" value={tagInputVal} onChange={(e) => onChangeTagInput(e)}></input> 
```

然后，在`onChange`处理程序中设置事件的值。

```
function onChangeTagInput(e) {
    setTagInputVal(e.target.value.replace(/[^\d.]/ig, ""));
} 
```

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2012-07-13T15:51:31.180

这是[geowa4 解决方案](https://stackoverflow.com/a/469419/669677)的扩展版本。支持`min`和`max`属性。如果数字超出范围，将显示之前的值。

[你可以在这里测试它。](http://jsbin.com/utikec)

用法：`<input type=text class='number' maxlength=3 min=1 max=500>`

```
function number(e) {
var theEvent = e || window.event;
var key = theEvent.keyCode || theEvent.which;
if(key!=13&&key!=9){//allow enter and tab
  key = String.fromCharCode( key );
  var regex = /[0-9]|\./;
  if( !regex.test(key)) {
    theEvent.returnValue = false;
    if(theEvent.preventDefault) theEvent.preventDefault();
    }   
  }
}

$(document).ready(function(){
    $("input[type=text]").filter(".number,.NUMBER").on({
        "focus":function(e){
         $(e.target).data('oldValue',$(e.target).val());
            },
        "keypress":function(e){
                e.target.oldvalue = e.target.value;
                number(e);
            },
        "change":function(e){
            var t = e.target;
            var min = $(t).attr("min");
            var max = $(t).attr("max");
            var val = parseInt($(t).val(),10);          
            if( val<min || max<val)
                {
                    alert("Error!");
                    $(t).val($(t).data('oldValue'));
                }

            }       
    });     
}); 
```

如果输入是动态的，请使用：

```
$(document).ready(function(){
    $("body").on("focus","input[type=text].number,.NUMBER",function(e){
        $(e.target).data('oldValue',$(e.target).val());
    }); 
    $("body").on("keypress","input[type=text].number,.NUMBER",function(e){
        e.target.oldvalue = e.target.value;
        number(e);
    }); 
    $("body").on("change","input[type=text].number,.NUMBER",function(e){
        var t = e.target
        var min = $(t).attr("min");
        var max = $(t).attr("max");
        var val = parseInt($(t).val());         
        if( val<min || max<val)
            {
                alert("Error!");
                $(t).val($(t).data('oldValue'));
            }
    }); 
}); 
```

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2012-08-01T07:07:20.950

最好的方法（允许所有类型的数字 - 实数负数、实数正数、整数负数、整数正数）是：

```
$(input).keypress(function (evt){
    var theEvent = evt || window.event;
    var key = theEvent.keyCode || theEvent.which;
    key = String.fromCharCode( key );
    var regex = /[-\d\.]/; // dowolna liczba (+- ,.) :)
    var objRegex = /^-?\d*[\.]?\d*$/;
    var val = $(evt.target).val();
    if(!regex.test(key) || !objRegex.test(val+key) || 
            !theEvent.keyCode == 46 || !theEvent.keyCode == 8) {
        theEvent.returnValue = false;
        if(theEvent.preventDefault) theEvent.preventDefault();
    };
}); 
```

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2021-09-17T12:36:58.763

如果我有你的问题，那基本上就是答案

```
<input type="number"> 
```

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2012-03-05T12:10:54.900

您可以将 Shurok 函数替换为：

```
$(".numeric").keypress(function() {
    return (/[0123456789,.]/.test(String.fromCharCode(Event.which) ))
}); 
```

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2014-12-22T18:48:41.533

采用：

```
<script>
    function onlyNumber(id){ 
        var DataVal = document.getElementById(id).value;
        document.getElementById(id).value = DataVal.replace(/[^0-9]/g,'');
    }
</script>
<input type="text" id="1" name="1" onChange="onlyNumber(this.id);"> 
```

如果你想在按键后更新一个值，你可以改变**onChange**为**onKeypress**，**onKeyDown**或**onKeyup**。*但是事件 onKeypress 不在任何浏览器中运行。*

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2015-05-19T16:51:32.603

下面的代码还将检查**PASTE**事件。
取消注释“ *ruleSetArr_4* ”并添加（连接）到“ *ruleSetArr* ”以允许**FLOAT**数字。
简单的复制/粘贴功能。使用参数中的输入元素调用它。
例子：`inputIntTypeOnly($('input[name="inputName"]'))`

```
function inputIntTypeOnly(elm){
    elm.on("keydown",function(event){
        var e = event || window.event,
            key = e.keyCode || e.which,
            ruleSetArr_1 = [8,9,46], // backspace,tab,delete
            ruleSetArr_2 = [48,49,50,51,52,53,54,55,56,57],	// top keyboard num keys
            ruleSetArr_3 = [96,97,98,99,100,101,102,103,104,105], // side keyboard num keys
            ruleSetArr_4 = [17,67,86],	// Ctrl & V
          //ruleSetArr_5 = [110,189,190], add this to ruleSetArr to allow float values
            ruleSetArr = ruleSetArr_1.concat(ruleSetArr_2,ruleSetArr_3,ruleSetArr_4);	// merge arrays of keys

            if(ruleSetArr.indexOf() !== "undefined"){	// check if browser supports indexOf() : IE8 and earlier
                var retRes = ruleSetArr.indexOf(key);
            } else { 
                var retRes = $.inArray(key,ruleSetArr);
            };
            if(retRes == -1){	// if returned key not found in array, return false
                return false;
            } else if(key == 67 || key == 86){	// account for paste events
                event.stopPropagation();
            };

    }).on('paste',function(event){
        var $thisObj = $(this),
            origVal = $thisObj.val(),	// orig value
            newVal = event.originalEvent.clipboardData.getData('Text');	// paste clipboard value
        if(newVal.replace(/\D+/g, '') == ""){	// if paste value is not a number, insert orig value and ret false
            $thisObj.val(origVal);
            return false;
        } else {
            $thisObj.val(newVal.replace(/\D+/g, ''));
            return false;
        };

    });
};

var inptElm = $('input[name="inputName"]');

inputIntTypeOnly(inptElm);
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<input type="text" name="inputName" value="1">
```

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2017-10-12T19:38:13.433

这是我喜欢使用的一个很好的简单解决方案：

```
function numeric_only (event, input) {
    if ((event.which < 32) || (event.which > 126)) return true; 
    return jQuery.isNumeric ($(input).val () + String.fromCharCode (event.which));
}// numeric_only;

<input type="text" onkeypress="return numeric_only (event, this);" /> 
```

解释：

使用“event.which” - 首先确定它是否是可打印字符。如果不是，则允许它（例如删除和退格）。否则，将字符连接到字符串的末尾并使用 jQuery "isNumeric" 函数对其进行测试。这使所有单调乏味的测试不再需要测试每个单独的角色，并且也适用于剪切/粘贴场景。

如果你想变得非常可爱，那么你可以创建一个新的 HTML 输入类型。让我们称它为“数字”，以便您可以拥有标签：

```
<input type="numeric" /> 
```

这将只允许数字字符。只需添加以下“document.ready”命令：

```
$(document).ready (function () {
    $("input[type=numeric]").keypress (function (event) {
        if ((event.which < 32) || (event.which > 126)) return true; 
        return jQuery.isNumeric ($(this).val () + String.fromCharCode (event.which));
    });// numeric.keypress;
});// document.ready; 
```

HTML 不关心你使用什么类型的名字——如果它不能识别它，那么它会默认使用一个文本框，所以你可以这样做。你的编辑可能会抱怨，但是，嘿，这就是它的问题。毫无疑问，清教徒会吓坏了，但它很有效，很简单，到目前为止它对我来说非常强大。

* * *

## 回答 #38

> 赞同：3
> 
> 时间：2018-03-22T07:18:44.023

这是简单的解决方案

将 .price-input input.quantity 替换为您的输入字段的类

```
$(".price-input input.quantity").on("keypress keyup blur",function (event) {    
       $(this).val($(this).val().replace(/[^\d].+/, ""));
        if ((event.which < 48 || event.which > 57)) {
            event.preventDefault();
        }
    }); 
```

* * *

## 回答 #39

> 赞同：3
> 
> 时间：2019-01-15T12:38:21.993

这也适用于波斯和阿拉伯数字:)

```
 setNumericInput: function (event) {
          var key = window.event ? event.keyCode : event.which
          if (event.keyCode === 8 ||
        (key >= 48 && key <= 57) ||
        (key >= 1776 && key <= 1785)) {
            return true
          } else {
            event.preventDefault()
          }
        } 
```

* * *

## 回答 #40

> 赞同：3
> 
> 时间：2020-05-01T09:08:26.447

如果您正在尝试角度，这可能会有所帮助

要将输入作为数字（带小数点）然后

```
<input [(ngModel)]="data" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"> 
```

现在这不会正确更新模型中的值以显式更改模型的值也添加这个

```
<input [(ngModel)]="data" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" (change)="data = $event.target.value"> 
```

change 事件将在模型中的值更新后触发，因此它也可以与响应式表单一起使用。

* * *

## 回答 #41

> 赞同：2
> 
> 时间：2009-01-22T14:47:43.367

您可以尝试使用 '''onkeydown''' 事件并在它不是允许的键之一时取消该事件（event.preventDefault 或类似的东西）。

* * *

## 回答 #42

> 赞同：2
> 
> 时间：2009-01-22T14:55:09.793

您可以附加到按键按下事件，然后根据您的需要过滤按键，例如：

```
<input id="FIELD_ID" name="FIELD_ID" onkeypress="return validateNUM(event,this);"  type="text"> 
```

实际的 JavaScript 处理程序将是：

```
function validateNUM(e,field)
{
    var key = getKeyEvent(e)
    if (specialKey(key)) return true;
    if ((key >= 48 && key <= 57) || (key == 46)){
        if (key != 46)
            return true;
        else{
            if (field.value.search(/\./) == -1 && field.value.length > 0)
                return true;
            else
                return false;
        }
    }

function getKeyEvent(e){
    var keynum
    var keychar
    var numcheck
    if(window.event) // IE
        keynum = e.keyCode
    else if(e.which) // Netscape/Firefox/Opera
        keynum = e.which
    return keynum;
} 
```

* * *

## 回答 #43

> 赞同：2
> 
> 时间：2009-01-22T15:03:14.553

记住地区差异（欧元使用句号和逗号与美国人相反），加上减号（或用括号括起来表示负数的惯例），加上指数符号（我正在使用那个）。

* * *

## 回答 #44

> 赞同：2
> 
> 时间：2012-10-18T18:07:00.727

这会立即删除任何坏字符，只允许一个点，很短，并允许退格等：

```
$('.numberInput').keyup(function () {
    s=$(this).val();
    if (!/^\d*\.?\d*$/.test(s)) $(this).val(s.substr(0,s.length-1));
}); 
```

* * *

## 回答 #45

> 赞同：2
> 
> 时间：2014-11-06T15:07:39.993

我使用可以从[NuGet](http://en.wikipedia.org/wiki/NuGet)下载的 jquery.inputmask.js 库。更具体地说，我使用它附带的 jquery.inputmask.regex.extensions.js。

我给输入元素一个类，在这种情况下`reg`：

```
<input type="number" id="WorkSrqNo" name="WorkSrqNo" maxlength="6" class="reg"/> 
```

然后在 JavaScript 中设置掩码：

```
var regexDigitsOnly = "^[0-9]*$";
$('input.reg').inputmask('Regex', { regex: regexDigitsOnly }); 
```

这仅适用于数字，但您可以更改正则表达式以接受“.”。

通过使用它，不可能输入不是数字的字符。将这些输入掩码库用于一般格式化很有用。

* * *

## 回答 #46

> 赞同：2
> 
> 时间：2014-12-19T07:49:57.007

如果您可以使用插件，这是我测试过的一个。除了粘贴，它工作得很好。

[数字输入](https://github.com/joshuadeleon/NumericInput)

这是一个演示[http://jsfiddle.net/152sumxu/2](http://jsfiddle.net/152sumxu/2)

下面的代码（Lib 内嵌粘贴）

```
<div id="plugInDemo" class="vMarginLarge">
    <h4>Demo of the plug-in    </h4>
    <div id="demoFields" class="marginSmall">
        <div class="vMarginSmall">
            <div>Any Number</div>
            <div>
                <input type="text" id="anyNumber" />
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    //    Author: Joshua De Leon - File: numericInput.js - Description: Allows only numeric input in an element. - If you happen upon this code, enjoy it, learn from it, and if possible please credit me: www.transtatic.com
    (function(b) {
        var c = { allowFloat: false, allowNegative: false};
        b.fn.numericInput = function(e) {
            var f = b.extend({}, c, e);
            var d = f.allowFloat;
            var g = f.allowNegative;
            this.keypress(function(j) {
                var i = j.which;
                var h = b(this).val();
                if (i>0 && (i<48 || i>57)) {
                    if (d == true && i == 46) {
                        if (g == true && a(this) == 0 && h.charAt(0) == "-") {
                            return false
                        }
                        if (h.match(/[.]/)) {
                            return false
                        }
                    }
                    else {
                        if (g == true && i == 45) {
                            if (h.charAt(0) == "-") {
                                return false
                            }
                            if (a(this) != 0) {
                                return false
                            }
                        }
                        else {
                            if (i == 8) {
                                return true
                            }
                            else {
                                return false
                            }
                        }
                    }
                }
                else {
                    if (i>0 && (i >= 48 && i <= 57)) {
                        if (g == true && h.charAt(0) == "-" && a(this) == 0) {
                            return false
                        }
                    }
                }
            });
            return this
        };
        function a(d) {
            if (d.selectionStart) {
                return d.selectionStart
            }
            else {
                if (document.selection) {
                    d.focus();
                    var f = document.selection.createRange();
                    if (f == null) {
                        return 0
                    }
                    var e = d.createTextRange(), g = e.duplicate();
                    e.moveToBookmark(f.getBookmark());
                    g.setEndPoint("EndToStart", e);
                    return g.text.length
                }
            }
            return 0
        }
    }(jQuery));

    $(function() {
       $("#anyNumber").numericInput({ allowFloat: true, allowNegative: true });
    });
</script> 
```

* * *

## 回答 #47

> 赞同：2
> 
> 时间：2016-01-22T11:05:35.640

给输入字段一个类 ( `<input class="digit" ...>`) 并使用 jquery，如下所示。

```
jQuery(document).ready(function () {
            jQuery('input.digit').live('input keyup',function(e){ jQuery(this).val(jQuery(this).val().replace( /[^\d]/g ,'')); });
}); 
```

上面的代码还可以禁用`Ctrl+V`笔画和`right click`笔画中的特殊字符。

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2016-06-03T14:01:54.493

我可能有另一个（简单的）解决方法...

由于 String.fromCharCode(key) 在 QWERTY 键盘上返回奇怪的东西（数字键盘返回代码为 g 表示 1，1 表示 & 字符..

我已经意识到在输入中捕获 keyup 的最终值以将其重置为任意值是一种更简单、轻量级且防错误的方法（也可以通过一些正则表达式来完成......以保留小数等等......不要'不必过滤其他 Ctrl、Home、Del 和 Enter 事件...）

与 jq 一起使用：

```
<input class='pn'>
<script>
function pn(el){nb=el.value;if(isNaN(nb) || nb<1)el.value=1;}
jQuery('.pn').keyup(function(){pn(this);});
</script> 
```

Onkeyup 属性：

```
<input onkeyup='positiveNumericInput(this)'>
<script>function positiveNumericInput(el){nb=el.value;if(isNaN(nb) || nb<1)el.value=1;}</script> 
```

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2019-05-22T15:31:08.753

我用完了这个功能：

```
onkeypress="if(event.which < 48 || event.which > 57 ) if(event.which != 8) return false;" 
```

这在 IE 和 Chrome 中运行良好，我不知道为什么它在 Firefox 中也无法正常运行，此功能会阻止 Firefox 中的 tab 键。

对于 tab 键在 Firefox 中可以正常工作，请添加以下内容：

```
onkeypress="if(event.which < 48 || event.which > 57 ) if(event.which != 8) if(event.keyCode != 9) return false;" 
```

* * *

## 回答 #50

> 赞同：2
> 
> 时间：2020-12-25T18:30:07.630

```
var userName = document.querySelector('#numberField');

userName.addEventListener('input', restrictNumber);
function restrictNumber (e) {  
  var newValue = this.value.replace(new RegExp(/[^\d]/,'ig'), "");
  this.value = newValue;
}
```

```
<input type="text" id="numberField">
```

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2021-03-18T13:15:49.410

以前没有人提到过更简单的解决方案：

```
inputmode="numeric" 
```

阅读更多：[https ://css-tricks.com/finger-friendly-numerical-inputs-with-inputmode/](https://css-tricks.com/finger-friendly-numerical-inputs-with-inputmode/)

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2021-12-14T00:25:13.073

有一个很好的解决方案。删除前导零，设置自然和小数位数的最大数量，处理复制粘贴，确保它是一个数值。

```
this.value = this.value
    .replace(/\b0+/g, '')
    .replace(/[^0-9.]/g, '')
    .replace(/(\..*?)\..*/g, '$1')
    .replace(/([0-9]{0,6}(\.[0-9]{0,2})?).*/g, '$1') 
```

最后`replace`设置小数和自然位的长度。只需将标记替换为您的首选值。

`.replace(/([0-9]{0,<max_natural>}(\.[0-9]{0,<max_decimal>})?).*/g, '$1')`

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2012-10-04T05:15:11.193

使用 jQuery 的另一种简单方法：

```
$('.Numeric').bind('keydown',function(e){
    if (e.which < 48 || e.which > 57)
        return false;
    return true;
}) 
```

现在只需将每个输入类设置为数字，例如：

```
<input type="text" id="inp2" name="inp2" class='Numeric' /> 
```

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2014-06-17T14:57:40.623

```
function digitsOnly(obj) {
   obj.value = obj.value.replace(/\D/g, "");
} 
```

并且在元素中

```
<input type="text" onkeyup="digitsOnly(this);" /> 
```

* * *

## 回答 #55

> 赞同：1
> 
> 时间：2014-08-26T09:09:52.003

是的，HTML5 可以。试试这个代码（[w3school](http://www.w3schools.com/html/tryit.asp?filename=tryhtml5_input_type_number)）：

```
<!DOCTYPE html>
<html>
<body>

<form action="">
  Quantity (between 1 and 5): <input type="number" name="quantity" min="1" max="5" />
  <input type="submit" />
</form>

</body>
</html> 
```

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2015-07-02T17:01:46.640

对于那些喜欢**单线的人**。

```
string.replace(/[^\d\.]/g, '').replace(/^\.*/, '').replace(/(\.\d{0,2})(.*)/, '$1'); 
```

我在输入类型=“文本”上使用此代码，并使用 AngularJS 在按键上激活，但如果愿意，您可以使用 jQuery。只需将此代码放入以某种方式在按键上激活的函数中即可。

它只允许数字，数字+小数，数字+小数+数字。

**代码**

```
YourString.replace(/[^\d\.]/g, '').replace(/^\.*/, '').replace(/(\.\d{0,2})(.*)/, '$1');

testOne = "kjlsgjkl983724658.346.326.326..36.346"
=> "983724658.34";

testTwo = ".....346...3246..364.3.64.2346......"
=> "346.";

testThree = "slfdkjghsf)_(*(&^&*%^&%$%$%^KJHKJHKJKJH3"
=> "3";

testFour = "622632463.23464236326324363"
=> "622632463.23"; 
```

这是为美国货币构建的，但可以更改为允许小数点后两位以上的小数点，如下所示...

**更改代码**

```
YourString.replace(/[^\d\.]/g, '').replace(/^\.*/, '').replace(/(\.\d*)(.*)/, '$1');

testFour = "dfskj345346346.36424362jglkjsg....."
=> "345346346.36424362"; 
```

:)

* * *

## 回答 #57

> 赞同：1
> 
> 时间：2015-10-13T15:49:43.043

我正在寻找一种方法来阻止输入数字，然后，由于我没有在答案中找到它，所以这段代码对我来说很好。

我只需要在 onkeypress 事件中输入它。

如果您只需要阻止输入数字，我相信这会很好。

```
onkeypress="if(event.which &lt; 48 || event.which &gt; 57 ) if(event.which != 8) if(e.keyCode != 9) return false;" 
```

* * *

## 回答 #58

> 赞同：1
> 
> 时间：2018-09-10T00:54:53.680

这是一个非常简短的解决方案，它不使用已弃用的`keyCode`or `which`，不阻止任何非输入键，并使用纯 JavaScript。（在 Chromium 70.0.3533、Firefox 62.0 和 Edge 42.17134.1.0 中测试）

HTML：

```
<input type="text" onkeypress="validate(event)"> 
```

JS：

```
function validate(ev) {
    if (!ev) {
        ev = window.event;
    }

    if (!ev.ctrlKey && ev.key.length === 1 && (isNaN(+ev.key) || ev.key === " ")) {
        return ev.preventDefault();
    }
} 
```

* * *

## 回答 #59

> 赞同：1
> 
> 时间：2021-01-03T16:17:01.030

我找不到一个明确的答案，它不会每次都遍历整个字符串，所以在这里：

```
document.querySelectorAll("input").forEach(input => {
  input.addEventListener("input", e => {
    if (isNaN(Number(input.value[input.value.length-1])) && input.value[input.value.length-1] != '.') {
      input.value = input.value.slice(0, -1);
    }
  })
}); 
```

没有正则表达式，每次键入时都会遍历最后一个字符，如果它不是数字或句点，则对其进行切片。

* * *

## 回答 #60

> 赞同：1
> 
> 时间：2021-01-06T08:34:24.307

```
<input type="tel" 
          onkeypress="return onlyNumberKey(event)"> 
```

在脚本标签中

```
function onlyNumberKey(evt) { 

      // Only ASCII charactar in that range allowed 
      var ASCIICode = (evt.which) ? evt.which : evt.keyCode 
      if (ASCIICode > 31 && (ASCIICode < 48 || ASCIICode > 57)) 
          return false; 
      return true; 
} 
```

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2010-03-06T14:26:14.020

谢谢大家，这真的帮助了我！

我发现 perfert 对数据库非常有用。

```
function numonly(root){
    var reet = root.value;    
    var arr1=reet.length;      
    var ruut = reet.charAt(arr1-1);   
        if (reet.length > 0){   
        var regex = /[0-9]|\./;   
            if (!ruut.match(regex)){   
            var reet = reet.slice(0, -1);   
            $(root).val(reet);   
            }   
        }  
 } 
```

然后添加事件处理程序：

```
onkeyup="numonly(this);" 
```

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2012-03-15T15:25:07.750

我意识到一个旧帖子，但我认为这可以帮助某人。最近我不得不将文本框限制在小数点后 5 位。在我的情况下，用户输入也必须小于 0.1

```
<input type="text" value="" maxlength=7 style="width:50px" id="fmargin" class="formText"  name="textfield" onkeyup="return doCheck('#fmargin',event);"> 
```

这是 doCheck 函数

```
function doCheck(id,evt)
{
    var temp=parseFloat($(id).val());

    if (isNaN(temp))
        temp='0.0';
    if (temp==0)
        temp='0.0';

    $(id).val(temp);
} 
```

这是相同的功能，除了强制整数输入

```
function doCheck(id,evt)
{
    var temp=parseInt($(id).val());

    if (isNaN(temp))
        temp='0';

    $(id).val(temp);
} 
```

希望对某人有所帮助

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2012-09-03T15:45:33.557

我对其进行了一些调整，但它需要做更多的工作才能符合 JavaScript 的怪异方式。

```
function validateNumber(myEvent,decimal) {
    var e = myEvent || window.event;
    var key = e.keyCode || e.which;

    if (e.shiftKey) {
    } else if (e.altKey) {
    } else if (e.ctrlKey) {
    } else if (key === 48) { // 0
    } else if (key === 49) { // 1
    } else if (key === 50) { // 2
    } else if (key === 51) { // 3
    } else if (key === 52) { // 4
    } else if (key === 53) { // 5
    } else if (key === 54) { // 6
    } else if (key === 55) { // 7
    } else if (key === 56) { // 8
    } else if (key === 57) { // 9

    } else if (key === 96) { // Numeric keypad 0
    } else if (key === 97) { // Numeric keypad 1
    } else if (key === 98) { // Numeric keypad 2
    } else if (key === 99) { // Numeric keypad 3
    } else if (key === 100) { // Numeric keypad 4
    } else if (key === 101) { // Numeric keypad 5
    } else if (key === 102) { // Numeric keypad 6
    } else if (key === 103) { // Numeric keypad 7
    } else if (key === 104) { // Numeric keypad 8
    } else if (key === 105) { // Numeric keypad 9

    } else if (key === 8) { // Backspace
    } else if (key === 9) { // Tab
    } else if (key === 13) { // Enter
    } else if (key === 35) { // Home
    } else if (key === 36) { // End
    } else if (key === 37) { // Left Arrow
    } else if (key === 39) { // Right Arrow
    } else if (key === 190 && decimal) { // decimal
    } else if (key === 110 && decimal) { // period on keypad
    // } else if (key === 188) { // comma
    } else if (key === 109) { // minus
    } else if (key === 46) { // Del
    } else if (key === 45) { // Ins
    } else {
        e.returnValue = false;
        if (e.preventDefault) e.preventDefault();
    }
} 
```

然后通过以下方式调用它：

```
$('input[name=Price]').keydown(function(myEvent) {
    validateNumber(myEvent,true);
}); 
```

* * *

## 回答 #64

> 赞同：0
> 
> 时间：2013-03-06T23:13:45.937

准备好验证任何内容时调用此函数。我在这里使用了一个文本框

在我的 HTML 中：

```
<input type="button" value="Check IT!" onclick="check(document.getElementById('inputboxToValidate').value);" /> 
```

在我的 JavaScript 代码中：

```
function check(num){
    var onlynumbers = true
    for (var i = 0; i < (num.length - 1); i++) {
        if (num.substr(i, 1) != "0" || num.substr(i, 1) != "1" || num.substr(i, 1) != "2" || num.substr(i, 1) != "3" || num.substr(i, 1) != "4" || num.substr(i, 1) != "5" || num.substr(i, 1) != "6" || num.substr(i, 1) != "7" || num.substr(i, 1) != "8" || num.substr(i, 1) != "9") {
            alert("please make sure that only numbers have been entered in the Quantaty box");
            onlynumbers = false
        }
    }
    if (onlynumbers == true) {

        //Execute Code
    }
} 
```

* * *

## 回答 #65

> 赞同：0
> 
> 时间：2013-11-18T15:32:45.180

正则表达式和 match 函数可以很好地适用于这种情况。例如，我使用以下内容验证了 4 个输入框，它们用作图形上的坐标。它工作得相当好。

```
function validateInput() {
   if (jQuery('#x1').val().toString().match(/^[-]?[0-9]+[\.]?[0-9]*$/) == null || 
       jQuery('#x2').val().toString().match(/^[-]?[0-9]+[\.]?[0-9]*$/) == null || 
       jQuery('#y1').val().toString().match(/^[-]?[0-9]+[\.]?[0-9]*$/) == null ||
       jQuery('#y2').val().toString().match(/^[-]?[0-9]+[\.]?[0-9]*$/) == null) {
         alert("A number must be entered for each coordinate, even if that number is 0\. Please try again.");
         location.reload();
   }
} 
```

* * *

## 回答 #66

> 赞同：0
> 
> 时间：2016-07-30T10:31:26.480

当谈到万无一失的用户体验时，应该始终尝试为“用户的智能”保留一个参考点。

虽然忽略除数字之外的所有内容，点和连字符似乎是完美的选择，但您还应该考虑让他们**输入任何内容，并在完成后净化输入；如果不是有效数字，则显示错误**。此方法将确保无论用户设法做什么，结果都将始终有效。如果用户太天真以至于无法理解警告和错误消息，那么按下按钮并看到什么都没有发生（如在键码比较中）只会让他/她更加困惑。

此外，对于表单，验证和错误消息显示几乎是必需的。因此，这些规定可能已经存在。这是算法：

> 1.  在失去焦点或提交表单时，请执行以下操作。
>     
>     
>     
>     1.1。从输入中读取内容并将 parseFloat 应用于结果
>     
>     
>     
>     1.2\. 如果结果是不可访问数字 (NaN)，请重置输入字段并弹出**错误消息**：“请输入有效数字：例如 235 或 -654 或 321.526 或 -6352.646584”。
>     
>     
>     
>     1.3\. 否则，如果 String(result)!==(content from input)，将字段的值更改为 result 并显示**警告消息**：“您输入的值已被修改。输入必须是有效数字：例如 235 或 -654或 321.526 或 -6352.646584"。对于不允许任何未确认值的字段，则可以将此条件添加到步骤 1.2。
>     
>     
>     
>     1.4\. 否则，什么也不做。

如果需要，此方法还为您提供了基于**最小值、最大值、小数位等**执行验证的额外优势。只需对步骤 1.2 之后的结果进行这些操作。

**缺点：**

1.  输入将允许用户输入任何值，直到失去焦点或提交表单。但是，如果填写字段的说明足够清楚，在 90% 的情况下，这可能不会出现。

2.  如果步骤 1.3 用于显示警告，则可能会被用户忽略，并可能导致无意的输入提交。抛出错误或正确显示警告将解决此问题。

3.  速度。这可能比正则表达式方法慢（以微秒计）。

**优点：** 假设用户具备基本知识阅读理解，

1.  高度可定制的选项。

2.  跨浏览器工作且独立于语言。

3.  利用表单中已有的功能来显示错误和警告。

* * *

## 回答 #67

> 赞同：0
> 
> 时间：2017-01-28T03:06:45.550

希望我不是在这里用丑陋的棍子打死马，但我用它来输入我的网站数量，它只允许从 1 到 99 的数字。

试试看： [https ://jsfiddle.net/83va5sb9/](https://jsfiddle.net/83va5sb9/)

```
 <input min="1" type="text" id="quantity" name="quantity" value="1"
      onKeyUp="numbersonly()">

      <script>
    function numbersonly() {
      var str = document.getElementById("quantity").value
      var newstr = ""
      for (i = 0; i < str.length; i++) {
        for (ii = 1; ii < 10; ii++) {
          if (str.charAt(i).indexOf(ii) > -1) {
            newstr += str.charAt(i)
          }
        }
      }
      if (newstr == "") {
        newstr = 1
      }
      if (parseInt(newstr) > 99) {
        newstr = 99
      }
      document.getElementById("quantity").value = newstr
    }

    </script> 
```

* * *

## 回答 #68

> 赞同：0
> 
> 时间：2021-05-12T10:00:01.303

上面的一些答案使用了过时的内容，比如使用[which](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/which)。

要检查按下的键是否为数字，您可以使用`keyup`eventListener 来读取`event.key`. 如果字符不是数字，则只需阻止输入字符。您可以将其他密钥列入白名单。例如，允许用户使用箭头在输入字段中向后或向前导航，或者按退格键并删除输入的数字。

```
validate (event) {
  const isNumber = isFinite(event.key)
  const whitelist = ['Backspace','Delete','ArrowDown','ArrowUp','ArrowRight','ArrowLeft']
  const whitelistKey = whitelist.includes(event.key)

  if (!isNumber && !whitelistKey) {
    event.preventDefault()
  }
} 
```

* * *

## 回答 #69

> 赞同：0
> 
> 时间：2021-12-12T22:10:20.227

我见过很多用javascript回答这个问题的问题，但最好的答案是使用`type="number"`css并删除旋转按钮，需要这样做的大部分原因是旋转按钮`change`在使用时不会发出事件。

解决方案： `HTML`

```
`<input type="number" class="input-class">` 
```

`CSS`

```
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Firefox */
input[type=number] {
  -moz-appearance: textfield;
} 
```

* * *

## 回答 #70

> 赞同：0
> 
> 时间：2022-03-05T21:35:23.357

[这是emkey08 的 JavaScript Wiki 答案](https://stackoverflow.com/a/469362/7939871)的面向对象的重新实现，它使用`EventListener`对象实现。（参见：[MDN 网络文档`EventListener`](https://developer.mozilla.org/en-US/docs/web/api/eventlistener)）

在某种程度上，它可以防止为每个过滤的输入元素重复匿名事件处理函数声明，同时仍然允许它通过可选的回调。

```
/**
 * Base input {@see Element} {@see EventListener} filter abstract class
 *
 * @implements EventListener
 */
class AbstractInputFilter {

  /**
   * Attach the input filter to the input {@see Element}
   *
   * @param inputElement The input {@see Element} to filter
   * @param isValid - The callback that determines if the input is valid.
   * @throws Error
   */
  constructor(inputElement, isValid = null) {
    // Abstract class
    if (this.constructor === AbstractInputFilter) {
      throw new Error("Object of Abstract Class cannot be created");
    }

    if (typeof isValid === "function") {
      this.isValid = isValid;
    }

    for (const event of ["input", "keydown", "keyup",
        "mousedown", "mouseup", "select", "contextmenu", "drop"]) {
      inputElement.addEventListener(event, this);
    }
  }

  /**
   * Checks the value is valid
   *
   * @callback isValid default call-back that will throw
   * an {Error} if not implemented by extending this 
   * {AbstractInputFilter} class.
   *
   * @param value The value to check
   * @returns {boolean}
   * @throws Error
   */
  isValid(value) {
    throw new Error('must be implemented by callback!');
  }

  /**
   * Handles the {@see event} dispatched by
   * the {@see EventTarget} object from the input {@see Element}
   * to filter its contant while it is being filled.
   *
   * @param event the {@see event} dispatched by
   * the {@see EventTarget} input {@see Element}
   * @override
   */
  handleEvent(event) {
    const inputElement = event.currentTarget;
    if (this.isValid(inputElement.value)) {
      inputElement.oldValue = inputElement.value;
      inputElement.oldSelectionStart = inputElement.selectionStart;
      inputElement.oldSelectionEnd = inputElement.selectionEnd;
    } else if (inputElement.hasOwnProperty("oldValue")) {
      inputElement.value = inputElement.oldValue;
      inputElement.setSelectionRange(
        inputElement.oldSelectionStart, inputElement.oldSelectionEnd);
    } else {
      this.value = "";
    }
  }
}

/**
 * Generic Input element {@see EventListener} filter
 *
 * @extends AbstractInputFilter
 * It needs the {@see AbstractInputFilter~isValid} callback
 * to determine if the input is valid.
 */
class InputFilter extends AbstractInputFilter {}

/**
 * Unsigned Integer Input element {@see EventListener} filter
 * @extends AbstractInputFilter
 */
class UIntInputFilter extends AbstractInputFilter {
  isValid(value) {
    return /^\d*$/.test(value);
  }
}

/**
 * Unsigned Float Input element {@see EventListener} filter
 * @extends AbstractInputFilter
 */
class UFloatInputFilter extends AbstractInputFilter {
  isValid(value) {
    return /^\d*\.?\d*$/.test(value);
  }
}

// Filter with pre-made InputFilters (re-use the filter)
new UIntInputFilter(document.getElementById("UInt"));
new UFloatInputFilter(document.getElementById("UFloat"));

// Filter with custom callback filter anonymous function
new InputFilter(document.getElementById("AlNum"), function(value) {
  return /^\w*$/.test(value);
});
```

```
<label>Unsigned integer: </label><input id="UInt"><br/>
<label>Unsigned float: </label><input id="UFloat"><br/>
<label>AlphaNumeric (no special characters): </label><input id="AlNum">
```

* * *

## 回答 #71

> 赞同：-2
> 
> 时间：2016-05-25T13:16:40.927

我个人建议使用来自[http://www.decorplanit.com/plugin/](http://www.decorplanit.com/plugin/)的 autoNumeric 插件- 它支持所有不同的变体，如前缀/后缀处理、货币处理、负值格式、最小值、最大值等。

* * *

## 回答 #72

> 赞同：-3
> 
> 时间：2020-06-15T22:48:33.007

下面的函数将检查每个输入字符是否为数字。

```
numeric: value => {
    let numset = new Set(['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']);
    console.log(numset.has(value.substring(value.length - 1, value.length)));
} 
```

# asp.net - 如何同时运行同一个 WebSolution 的 2 个或多个副本？

> ID：469374
> 
> 赞同：1
> 
> 时间：2009-01-22T14:42:14.407
> 
> 标签：asp.net, version-control, configuration, debugging

我有一个包含 8 个单独的 Web 应用程序的解决方案，这些应用程序有时需要相互重定向/链接。

我也使用 Subversion 作为我的 sourceControl 并在一个分支中进行开发并在另一个分支中进行错误修复。

因此，我的机器上可以同时拥有多个 Web 套件的副本。

出于这个问题的目的，假设它们位于目录 DEV 和 FIX

我想将这两种解决方案加载到单独的 VS 副本中，并让每个解决方案都能够独立运行而不会发生冲突。

我还需要能够快速分支源并再次启动系统的第三或第四个副本而不会发生冲突。

那么实现这一目标的最佳方法是什么？（IIS、Visual Studio 开发服务器、自定义 WebServer）

我可以设置一个解决方案以在单个端口上运行其所有 Web 应用程序并在同一个位置配置该端口吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T15:01:18.317

作为 Visual Studio 的一部分提供的 ASP.NET 开发人员服务器将完成此操作。还有一个 hack 允许在个人版本的 IIS 中配置多个站点，但是在它们之间切换仍然很痛苦。

本文解释了如何使用我提到的技巧在 XP Pro 上设置多个虚拟服务器：http: [//www.developerfusion.com/code/4645/multiple-iis-virtual-servers-on-xp-pro/](http://www.developerfusion.com/code/4645/multiple-iis-virtual-servers-on-xp-pro/)

*就个人而言，除非您需要*IIS 特定功能，否则我只会选择使用 ASP.NET 开发人员服务器。

# sql - 条件连接 - 动态 SQL

> ID：469381
> 
> 赞同：2
> 
> 时间：2009-01-22T14:45:08.457
> 
> 标签：sql, sql-server, join, dynamic-sql

在这里工作的 DBA 正试图将我简单的存储过程变成一个动态的 sql 怪物。诚然，我的存储过程可能没有他们想要的那么快，但我不禁相信有一种足够的方法来执行基本上是条件连接的操作。

这是我的存储过程的示例：

```
SELECT 
*
FROM
table
WHERE
(
    @Filter IS NULL OR table.FilterField IN 
    (SELECT Value FROM dbo.udfGetTableFromStringList(@Filter, ','))
) 
```

UDF 将逗号分隔的过滤器列表（例如银行名称）转换为表格。

显然，在 where 子句中包含过滤条件并不理想。欢迎任何关于基于存储的 proc 参数有条件地加入的更好方法的建议。除此之外，是否有人对动态 sql 方法有任何建议或反对？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T14:50:21.520

您可以在从 UDF 返回的表上进行 INNER JOIN，而不是在 IN 子句中使用它

您的 UDF 可能类似于

```
CREATE FUNCTION [dbo].[csl_to_table] (@list varchar(8000) )
RETURNS @list_table TABLE ([id] INT)
AS
BEGIN
    DECLARE     @index INT,
            @start_index INT,
            @id INT

    SELECT @index = 1 
    SELECT @start_index = 1
    WHILE @index <= DATALENGTH(@list)
    BEGIN

        IF SUBSTRING(@list,@index,1) = ','
        BEGIN

            SELECT @id = CAST(SUBSTRING(@list, @start_index, @index - @start_index ) AS INT)
            INSERT @list_table ([id]) VALUES (@id)
            SELECT @start_index = @index + 1
        END
        SELECT @index  = @index + 1
    END
    SELECT @id = CAST(SUBSTRING(@list, @start_index, @index - @start_index ) AS INT)
    INSERT @list_table ([id]) VALUES (@id)
    RETURN
END 
```

然后在返回的表中的 id 上进行 INNER JOIN。此 UDF 假定您在逗号分隔列表中传递 INT

**编辑：**

为了处理为@filter 传入的空值或没有值，我能看到的最直接的方法是在存储过程中基于@filter 值执行不同的查询。我不确定这将如何影响缓存的执行计划（如果有人可以确认，将更新）或者最终结果是否会比您的原始存储过程更快，我认为这里的答案在于测试。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T15:07:17.663

看起来代码的重写正在另一个答案中得到解决，但是在存储过程中反对动态 SQL 的一个很好的论点是它破坏了所有权链。

也就是说，当你正常调用一个存储过程时，它在存储过程所有者的权限下执行，除了使用execute命令执行动态SQL时，对于动态SQL的上下文，它恢复到调用者的权限，这可能取决于您的安全模型。

最后，您最好妥协并重写它以解决 DBA 的问题，同时避免动态 SQL。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T15:53:18.867

我认为您的方法没有任何问题。老实说，根据@Filter 是否为空，重写它以使用动态 SQL 执行两个不同的查询对我来说似乎很愚蠢。

我能看到你所拥有的唯一潜在的缺点是它可能会在确定一个好的执行计划时造成一些困难。但是，如果性能足够好，就没有理由改变它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T15:39:23.980

我不确定我是否理解您对动态 SQL 的厌恶。也许是因为您的 UDF 已经很好地抽象出了一些混乱的问题，并且您觉得动态 SQL 将把它带回来。好吧，考虑到大多数（如果不是全部）DAL 或 ORM 工具将广泛依赖于动态 SQL，我认为您的问题可以重述为“我怎样才能很好地抽象出动态 SQL 的混乱”。

就我而言，动态 SQL 准确地为我提供了我想要的查询，以及我正在寻找的性能和行为。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T15:01:05.247

不管你做什么（这里的答案都有好处），一定要比较每个选项的性能和执行计划。

有时，如果手动优化会影响您的代码可维护性并且实际上不会对代码的执行方式产生任何影响，那么它就毫无意义。

我首先会简单地查看将其更改`IN`为简单`LEFT JOIN`的 with `NULL`check （这不会摆脱你的 udf，但它应该只被调用一次）：

```
SELECT *
FROM table
LEFT JOIN dbo.udfGetTableFromStringList(@Filter, ',') AS filter
    ON table.FilterField = filter.Value
WHERE @Filter IS NULL
    OR filter.Value IS NOT NULL 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-19T07:49:30.597

您似乎正在尝试编写一个查询来处理两种情况：
1\. @filter = "x,y,z"
2\. @filter IS NULL

为了优化场景 2，我会在 UDF 上进行 INNER JOIN，而不是使用 IN 子句......

```
SELECT * FROM table
INNER JOIN dbo.udfGetTableFromStringList(@Filter, ',') AS filter
  ON table.FilterField = filter.Value 
```

为了针对场景 2 进行优化，我不会尝试调整现有查询，而是故意将这些情况分开，使用 IF 语句或 UNION 并使用 WHERE 子句模拟 IF...

**TSQL 中频**

```
IF (@filter IS NULL)
  SELECT * FROM table
ELSE
  SELECT * FROM table
  INNER JOIN dbo.udfGetTableFromStringList(@Filter, ',') AS filter
    ON table.FilterField = filter.Value 
```

**UNION 模拟 IF**

```
SELECT * FROM table
  INNER JOIN dbo.udfGetTableFromStringList(@Filter, ',') AS filter
    ON table.FilterField = filter.Value

UNION ALL

SELECT * FROM table WHERE @filter IS NULL 
```

这种设计的优点是每个案例都很简单，确定哪个简单是它自己简单的。然而，将两者结合到一个查询中会导致妥协，例如 LEFT JOIN，因此会给每个查询带来显着的性能损失。

# java - 如何在防火墙后将 RMI 与小程序客户端一起使用？

> ID：469383
> 
> 赞同：7
> 
> 时间：2009-01-22T14:45:42.420
> 
> 标签：java, applet, rmi, firewall

如何将 RMI 与防火墙后面的小程序客户端一起使用？

如何将 RMI 与防火墙服务器和防火墙 applet 客户端一起使用？（如果可能的话）

我知道 RMI 服务器使用端口 1099（默认情况下，但这是可配置的）；但是在此之后，通信需要在不同的随机端口上使用新的套接字。我也知道您可以在客户端上为 RMI over HTTP 隧道设置代理，这在理论上应该可以解决我的问题。但我无法让它工作（我尝试在我的 XP 客户端上设置环境属性，但 Internet Explorer 一直忽略它们）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-01T11:02:58.793

请参阅[http://java.sun.com/javase/6/docs/technotes/guides/rmi/faq.html#firewall](http://java.sun.com/javase/6/docs/technotes/guides/rmi/faq.html#firewall)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-02T11:30:51.860

如果服务器代码在您手中，您还可以通过提供自定义 RMISocketFactory 来限制 RMI 使用预定义端口，如下所述：http: [//insidecoffe.blogspot.com/2012/02/firewall-friently-rmi-port-fixing .html](http://insidecoffe.blogspot.com/2012/02/firewall-friently-rmi-port-fixing.html)

（特别注意如果并行使用 JMX 可能会导致问题的提示）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T11:11:11.770

还没有深入了解我自己，但是在四处寻找我目前正在做的项目时，我遇到了[LipeRMI](http://lipermi.sourceforge.net/)。

你可能想看看它，因为它面向互联网使用，并提到“以这样的方式隐藏客户端，它们可以位于本地网络、路由器或防火墙后面；”

编辑：

记得我不久前遇到的另一个实现，称为[RMI Doves 1.0：Java RMI 防火墙问题的解决方案，](http://ca.geocities.com/rmi_doves/)您可能也想看看那个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-19T00:57:53.077

在您的服务器中输入如下代码：

```
RmiInterface stub = (RmiInterface) UnicastRemoteObject.exportObject(rmi, 35400);
LocateRegistry.createRegistry(1099);
Naming.rebind("//192.168.102.128:1099/rmi", stub); 
```

# .net - ConfigurationManager.AppSettings 为空？

> ID：469384
> 
> 赞同：3
> 
> 时间：2009-01-22T14:45:43.573
> 
> 标签：.net, configuration, web-config

我有一个 VS2008 ASP.NET Web 服务应用程序在我的 XP 机器的本地 IIS 上运行。同一解决方案中的一个单独项目使用测试方法来调用 WS 调用并运行它们的流程。

当我在 WS App 中添加 web 引用时，VS2008 在 Properties 文件夹中创建了一个 Settings.settings 文件来存储 web 引用的地址。此过程还在 Web.config 文件中创建了一个名为 applicationSettings 的新部分，用于存储来自 Settings.settings 的值

当我的应用程序尝试通过 ConfigurationManager.AppSettings[key] 从 Web.config 文件的 appSettings 部分检索配置值时，所有值都为 null 并且 AppSettings.AllKeys.Length 始终为零。

我什至将 Web.config 文件恢复到添加 Web 引用之前的状态，并确保它与系统生成的 web.config 文件完全相同，用于正常工作的新项目。在比较了还原的 Web.config 和新的 Web.config 之后，我在 appSettings 部分添加了一个简单的值，但 ConfigurationManager.AppSettings[key] 仍然没有运气。

这是无法读取的还原的 Web.config

```
 <?xml version="1.0"?>

<configuration>
  <configSections>
    <sectionGroup name="system.web.extensions" type="System.Web.Configuration.SystemWebExtensionsSectionGroup, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35">
      <sectionGroup name="scripting" type="System.Web.Configuration.ScriptingSectionGroup, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35">
        <section name="scriptResourceHandler" type="System.Web.Configuration.ScriptingScriptResourceHandlerSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" requirePermission="false" allowDefinition="MachineToApplication"/>
        <sectionGroup name="webServices" type="System.Web.Configuration.ScriptingWebServicesSectionGroup, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35">
          <section name="jsonSerialization" type="System.Web.Configuration.ScriptingJsonSerializationSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" requirePermission="false" allowDefinition="Everywhere" />
          <section name="profileService" type="System.Web.Configuration.ScriptingProfileServiceSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" requirePermission="false" allowDefinition="MachineToApplication" />
          <section name="authenticationService" type="System.Web.Configuration.ScriptingAuthenticationServiceSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" requirePermission="false" allowDefinition="MachineToApplication" />
          <section name="roleService" type="System.Web.Configuration.ScriptingRoleServiceSection, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" requirePermission="false" allowDefinition="MachineToApplication" />
        </sectionGroup>
      </sectionGroup>
    </sectionGroup>
  </configSections>

  <appSettings>
    <add key="testkey" value="testvalue"/>
  </appSettings>

  <connectionStrings/>

  <system.web>
      <!-- 
          Set compilation debug="true" to insert debugging 
          symbols into the compiled page. Because this 
          affects performance, set this value to true only 
          during development.
      -->
      <compilation debug="false">

        <assemblies>
          <add assembly="System.Core, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>
          <add assembly="System.Data.DataSetExtensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>
          <add assembly="System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
          <add assembly="System.Xml.Linq, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>
        </assemblies>

      </compilation>
      <!--
          The <authentication> section enables configuration 
          of the security authentication mode used by 
          ASP.NET to identify an incoming user. 
      -->
      <authentication mode="Windows" />
      <!--
          The <customErrors> section enables configuration 
          of what to do if/when an unhandled error occurs 
          during the execution of a request. Specifically, 
          it enables developers to configure html error pages 
          to be displayed in place of a error stack trace.

      <customErrors mode="RemoteOnly" defaultRedirect="GenericErrorPage.htm">
          <error statusCode="403" redirect="NoAccess.htm" />
          <error statusCode="404" redirect="FileNotFound.htm" />
      </customErrors>
      -->

    <pages>
      <controls>
        <add tagPrefix="asp" namespace="System.Web.UI" assembly="System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
        <add tagPrefix="asp" namespace="System.Web.UI.WebControls" assembly="System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
      </controls>
    </pages>

    <httpHandlers>
      <remove verb="*" path="*.asmx"/>
      <add verb="*" path="*.asmx" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
      <add verb="*" path="*_AppService.axd" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
      <add verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" validate="false"/>
    </httpHandlers>
    <httpModules>
      <add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
    </httpModules>

  </system.web>

  <system.codedom>
    <compilers>
      <compiler language="c#;cs;csharp" extension=".cs" warningLevel="4"
                type="Microsoft.CSharp.CSharpCodeProvider, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">
        <providerOption name="CompilerVersion" value="v3.5"/>
        <providerOption name="WarnAsError" value="false"/>
      </compiler>
    </compilers>
  </system.codedom>

  <!-- 
      The system.webServer section is required for running ASP.NET AJAX under Internet
      Information Services 7.0\.  It is not necessary for previous version of IIS.
  -->
  <system.webServer>
    <validation validateIntegratedModeConfiguration="false"/>
    <modules>
      <remove name="ScriptModule" />
      <add name="ScriptModule" preCondition="managedHandler" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
    </modules>
    <handlers>
      <remove name="WebServiceHandlerFactory-Integrated"/>
      <remove name="ScriptHandlerFactory" />
      <remove name="ScriptHandlerFactoryAppServices" />
      <remove name="ScriptResource" />
      <add name="ScriptHandlerFactory" verb="*" path="*.asmx" preCondition="integratedMode"
           type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
      <add name="ScriptHandlerFactoryAppServices" verb="*" path="*_AppService.axd" preCondition="integratedMode"
           type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
      <add name="ScriptResource" preCondition="integratedMode" verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
    </handlers>
  </system.webServer>

  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Extensions" publicKeyToken="31bf3856ad364e35"/>
        <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="3.5.0.0"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Extensions.Design" publicKeyToken="31bf3856ad364e35"/>
        <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="3.5.0.0"/>
      </dependentAssembly>
    </assemblyBinding>
  </runtime>
</configuration> 
```

有没有人遇到过这种情况，或者知道如何解决这个问题？

TIA

-马特

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T14:59:53.170

当您在 VS 项目中添加 *.Settings 文件时，其内容不会转到 app.config 文件。

VS 自动创建一个类（在您的情况下称为**Settings**），该类继承自**ApplicationSettingsBase**并在构建期间自动嵌入到您的 dll/exe 中。

为了获取存储的设置，您只需在代码中创建 Settings 类的实例并从其公共属性中获取值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T14:54:38.923

您的 Web.config 中没有“AppSettings”部分

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-04-06T20:46:09.223

您必须在文件中添加 `<appSettings>`部分，然后您可以使用 示例`App.config`检索值 ：`ConfigurationManager.AppSettings["<Key name>"];`

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <startup> 
        <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.7.2" />      
    </startup>

   <appSettings>
    <add key ="IntervalSeconds" value ="60000"/>        </appSettings>
</configuration> 
```

从 检索值`App.Config`：

```
 string intervalSeconds = ConfigurationManager.AppSettings["IntervalSeconds"]; 
```

# php - PHP 对象创建和内存使用

> ID：469386
> 
> 赞同：2
> 
> 时间：2009-01-22T14:46:50.000
> 
> 标签：php, object, memory

一个基本的虚拟类：

```
class foo
{
    var $bar = 0;
    function foo() {}
    function boo() {}
}
echo memory_get_usage();
echo "\n";
$foo = new foo();
echo memory_get_usage();
echo "\n";
unset($foo);
echo memory_get_usage();
echo "\n";
$foo = null; 
echo memory_get_usage();
echo "\n"; 
```

输出：

```
$ php test.php
353672
353792
353792
353792 
```

现在，我知道 PHP 文档说在需要之前不会释放内存（达到上限）。然而，我把它写成一个小测试，因为我有一个更长的任务，使用一个更大的对象，以及该对象的许多实例。内存只会攀升，最终耗尽并停止执行。即使这些大对象确实占用了内存，因为我在完成每个（串行）之后销毁它们，它不应该耗尽内存（除非单个对象耗尽了整个内存空间，情况并非如此）。

想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T18:34:26.920

PHP 对对象和类的支持在 5.2 版中效率不高（过去也不是这样），但即将到来的 5.3 和 6.0 对类和对象的使用进行了重大改革，您将看到速度和内存的改进他们俩。

我还在 PHP 5.2.x 中编写了一些基本框架，发现内存使用量也非常臃肿。尽管考虑到强大的多核 CPU 和内存是多么便宜，但我想说的是，以对您最有意义的方式进行编码并创建更 RAD 设置。

如果使用 Smarty 或 Drupal 可以让您的工作项目更快地完成，那么请使用它们，或者您做任何自定义的东西。不要让今天糟糕的内存/速度使用让您对 OOP 或框架感到厌烦，因为明天的版本有一些值得注意的改进（现实世界的基准测试显示相同代码的速度提高了 30%）。

PS：你的设置有问题，我在 Windows XP 上的 Apache /w PHP 5.2.8 上运行了相同的代码，得到：60872 61080 61080 61080

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-24T18:32:07.447

这是一个带有循环引用的修订示例：

```
<?php
class foo
{
    public $bar = 0;
    function foo(){}
    function boo(){}
}

echo memory_get_usage() . "\n";

$foo = new foo();
unset($foo);

echo memory_get_usage() . "\n";

$arr = array(new foo());

for ($i = 1; $i < 1000000; $i += 2)
{
    $arr[$i] = new foo();
    $arr[$i - 1] = new foo();
    unset($arr[$i], $arr[$i - 1]);
}

echo memory_get_usage() . "\n";

for ($i = 1; $i < 1000000; $i += 2)
{
    $arr[$i] = new foo();
    $arr[$i - 1] = new foo();
    $arr[$i]->bar = $arr[$i-1];
    $arr[$i-1]->bar = $arr[$i];
    unset($arr[$i], $arr[$i - 1]);
}

echo memory_get_usage() . "\n"; 
```

PHP 5.3.6 (cli) 的输出：

```
644392
644392
644848
1628592 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T15:08:11.203

您是否有任何循环引用可以阻止垃圾收集器执行其任务？

我进行了快速测试，创建了 1,000,000 个对象，但内存没有被耗尽：

```
class foo
{
    var $bar = 0;
    function foo() {}
    function boo() {}
}

echo memory_get_usage() . "\n";

$foo = new foo();
unset($foo);

echo memory_get_usage() . "\n";

for ($i = 0; $i < 1000000; $i++)
{
    $var = 'foo' . $i; // Use a different variable name each time
    $$var = new foo();
    unset($$var);
}

echo memory_get_usage() . "\n"; 
```

65080 65384 65568 <--创建和销毁的 1,000,000 个对象的增加非常小

# msbuild - 使用 MSBuild 和 Microsoft.Sdc.Tasks 安装 win32 服务

> ID：469397
> 
> 赞同：5
> 
> 时间：2009-01-22T14:49:14.363
> 
> 标签：msbuild, windows-services, microsoft.sdc.tasks

我正在尝试使用 Microsoft.Sdc.Tasks 库安装 Windows 服务。

```
<ControlService Action="Install"
    ServiceName="Service1"
    User="XXX
    Password="XXX"
    ServiceExePath="$(DeployFolder)\XXX.exe"/> 
```

***但是我一直提示输入用户名和密码！***这将不起作用，因为我希望将其作为构建服务器上的自动构建。我的意思是，我想在其下运行服务的用户名和密码在实际目标中。如何让它使用配置的用户和密码安装服务而不提示它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T15:48:14.243

找到[这篇文章](http://blogs.msdn.com/jmanning/archive/2008/04/06/localsystem-root-localservice-nobody.aspx)，因为我的所有服务都是在本地文件中写入和读取，所以我应该可以在本地服务帐户而不是特定用户下运行。即使更新了服务安装程序，*ControlService* -target 也需要用户和密码才能运行，但***实际上我并没有***提示我输入用户和密码。但是我不想运行特定用户，并且当配置中没有提供用户和密码时，目标会失败......奇怪。

我改为使用 InstallUtil.exe 解决了问题。将我设置的服务安装程序设置为作为本地服务帐户运行后，效果很好。

```
<Exec WorkingDirectory="C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727"
            Command="InstallUtil.exe -i XXX.exe" /> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-09T15:32:22.633

仅供参考，要安装到远程服务器，您应该使用此处列出的 SericeController 任务：

[http://weblogs.asp.net/scottgu/archive/2006/02/12/438061.aspx](http://weblogs.asp.net/scottgu/archive/2006/02/12/438061.aspx)

# asp.net - 适用于 Windows Server 2008 64 位机器的 ASP.NET AJAX

> ID：469398
> 
> 赞同：0
> 
> 时间：2009-01-22T14:49:32.020
> 
> 标签：asp.net

我有一个使用 ASP.NET AJAX 控件的 Web 解决方案，并且在 Windows Server 2008 32 位机器上运行得很好。

现在服务器管理员想把这个网站移到一个新的 Windows Server 2008 64 位机器上，我只是想知道 ASP.NET AJAX 是否与这个系统兼容，我似乎无法通过谷歌搜索找到任何关于这个问题的信息（也许我没有问正确的问题:)）。我必须专门为 64 位机器构建 .dll 吗？安装了 .NET framework 3.0 的机器是否包含 AJAX（我的解决方案在 .NET 3.0 中）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T14:57:47.357

不，您不必为 64 位机器构建特殊版本，这就是托管代码的美妙之处，因为它不会为特定平台编译，直到它实际由 VM 运行。

此外，AJAX 3.5 包含在 .NET Framework 3.5 中，因此您可能需要安装它。

[这是一篇涵盖此问题的博客文章。](http://weblogs.asp.net/scottgu/archive/2007/07/30/asp-net-Ajax-in-net-3-5-and-vs-2008.aspx)

# c++ - C++ 中的惰性对象创建，或如何进行零成本验证

> ID：469401
> 
> 赞同：2
> 
> 时间：2009-01-22T14:50:04.640
> 
> 标签：c++, validation

我偶然发现了[这篇](http://blog.getpaint.net/2008/12/06/a-fluent-approach-to-c-parameter-validation/)关于在 C# 中验证参数的好文章，现在我想知道如何在 C++ 中实现类似的东西。我喜欢这个东西的主要一点是它在第一次验证失败之前不需要任何费用，因为`Begin()`函数返回`null`，其他函数会检查这个。

显然，我可以在 C++ 中使用类似的东西，`Validate* v = 0; IsNotNull(v, ...).IsInRange(v, ...)`并让它们中的每一个都传递`v`指针，并返回一个代理对象，我为其复制所有函数。

现在我想知道是否有类似的方法可以在没有临时对象的情况下实现这一点，直到第一次验证失败。虽然我猜想`std::vector`在堆栈上分配类似 a 的东西应该是免费的（这真的是真的吗？我怀疑一个空向量不会在堆上分配，对吧？）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T16:26:54.430

除了 C++ 没有扩展方法（这会阻止能够轻松添加新验证）这一事实之外，它应该太难了。

```
class Validation
{
    vector<string> *errors;
    void AddError(const string &error)
    {
       if (errors == NULL) errors = new vector<string>();
       errors->push_back(error);
    }

public:
    Validation() : errors(NULL) {}
    ~Validation() { delete errors; }

    const Validation &operator=(const Validation &rhs)
    {
        if (errors == NULL && rhs.errors == NULL) return *this;
        if (rhs.errors == NULL)
        {
            delete errors;
            errors = NULL;
            return *this;
        }
        vector<string> *temp = new vector<string>(*rhs.errors);
        std::swap(temp, errors);
    }

    void Check()
    { 
         if (errors)
             throw exception();
    }

    template <typename T>
    Validation &IsNotNull(T *value)
    {
        if (value == NULL) AddError("Cannot be null!");
        return *this;
    }

    template <typename T, typename S>
    Validation &IsLessThan(T valueToCheck, S maxValue)
    {
        if (valueToCheck < maxValue) AddError("Value is too big!");
        return *this;
    }

    // etc..

};

class Validate
{
public:
    static Validation Begin() { return Validation(); }
}; 
```

采用..

```
Validate::Begin().IsNotNull(somePointer).IsLessThan(4, 30).Check(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T14:58:24.187

不能对问题的其余部分说太多，但我确实想指出这一点：

> 虽然我猜想在堆栈上分配像 std::vector 这样的东西应该是免费的（这真的是真的吗？我怀疑一个空向量不会在堆上分配，对吧？）

不。您仍然必须在向量中分配任何其他变量（例如存储长度），我相信如果它们在构造时为向量元素预先分配任何空间，则取决于实现。无论哪种方式，您都在分配一些东西，尽管分配可能不多，但永远不会“免费”，无论发生在堆栈或堆上。

话虽如此，我想做这些事情所花费的时间会非常少，只有当你快速连续地多次做这件事时才真正重要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:31:02.623

我建议查看[Boost.Exception](http://www.boost.org/doc/libs/1_37_0/libs/exception/doc/boost-exception.html)，它提供了基本相同的功能（将任意详细的异常信息添加到单个异常对象）。

当然，您需要编写一些实用方法，以便获得您想要的接口。但要注意：在 C++ 中取消引用空指针会导致未定义的行为，甚至不能存在空引用。因此，您不能以某种方式返回空指针，因为您的链接示例在 C# 扩展方法中使用空引用。

对于零成本的事情：简单的堆栈分配非常便宜，并且`boost::exception`对象本身不会进行任何堆分配，但前提是您将任何 error_info<> 对象附加到它。所以它并不是完全*零*成本，而是几乎尽可能便宜（一个 vtable-ptr 用于异常对象，加上 sizeof(intrusive_ptr<>)）。

因此，这应该是尝试进一步优化的最后一部分......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T15:49:16.347

重新链接文章：显然，在 C# 中创建对象的开销是如此之大，以至于相比之下函数调用是免费的。

我个人会提出类似的语法

```
Validate().ISNOTNULL(src).ISNOTNULL(dst); 
```

Validate() 构造一个临时对象，它基本上只是一个 std:: 问题列表。空列表非常便宜（无节点，大小 = 0）。~Validate 如果列表不为空，将抛出。如果分析显示即使这太昂贵，那么您只需将 std::list 更改为手动列表。请记住，指针也是对象。您不会仅仅通过坚持原始指针的不幸语法来保存对象。相反，用漂亮的语法包装原始指针的开销纯粹是编译时的代价。

PS。`ISNOTNULL(x)`将是一个`#define`for `IsNotNull(x,#x)`- 类似于 assert() 如何打印出失败的条件，而不必重复它。

# apache-flex - flex3 函数没有正确返回字符串

> ID：469402
> 
> 赞同：0
> 
> 时间：2009-01-22T14:50:21.147
> 
> 标签：apache-flex, actionscript, return

我试图从我的脚本标签内的方法返回一个字符串值，但是它总是返回一个对象，我无法获得字符串值。

这是代码：

我检索从 web 服务调用返回的对象；；

```
 private function getNameResults(e:ResultEvent):String{
     var name:Array = new Array(e.result);
     var site:String = site_names[0].toString();
     Alert.show("site - " +site);
     return site;
} 
```

警报可以很好地打印出名称，但是当我尝试在下一个方法（调用调用 getNameResults 的 Web 服务）中使用该值时，我得到了对象标签

```
private function getInfo(roomName:String):String{
    var site:String =userRequest.getRoomZoneInfo(roomName);
    return site;
} 
```

但是这里返回的值是 [object AsyncToken]

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T16:16:08.460

您将结果设置为`getRoomZoneInfo()`变量站点，但您将其转换为字符串。 `getRoomZoneInfo`正在返回一个对象，并且因为您要插入它的变量是一个字符串，所以它就像调用`.toString()`对象一样，这会产生 [object `AsyncToken`]。

基本上，如果`getRoomZoneInfo`是网络服务调用，您无法在此处获取您要查找的信息，您必须等到结果返回并在此处获取您要查找的字符串。有道理？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T14:56:30.977

您的 getInfo() 方法没有调用 getNameResults()。它正在调用 getRoomZoneInfo()。我不知道那个方法是做什么的，但我猜它返回的是一个对象，而不是一个字符串。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-06T10:32:06.453

我在变量 a 而不是字符串中得到 [ `ObjectAsyncToken`]，因为我正在从数据库中检索数据

```
private function init():void
{
   ro.initView();
   var a:String=String(ro.getID());
} 
```

数据库功能：

```
public void initView()
{
  try
  {
    Class.forName("sun.jdbc.odbc.JdbcOdbcDriver");
    Connection conn = DriverManager.getConnection("jdbc:odbc:alarmdsn"," "," ");
    Statement s = conn.createStatement();
    ResultSet r = s.executeQuery("select * from alarm");
    while(r.next()) {
      a = r.getString(1);             
    }
  }
  catch(Exception e) {}
}

public String getID() {
   return a;
} 
```

# .net - 将 DateTime 解析为 SQL Server 的最佳方法

> ID：469417
> 
> 赞同：6
> 
> 时间：2009-01-22T14:55:18.903
> 
> 标签：.net, sql, sql-server, tsql, datetime

我想知道将 DateTime 对象解析到 SQL 服务器的最佳方法是什么。

在代码中生成 SQL 的位置。

我一直使用类似的东西`DateTime.Now.TolongDateString()`并取得了很好的效果，除了今天我出错了，这让我思考。

```
System.Data.SqlClient.SqlException: Conversion failed when converting datetime from character string 
```

那么每个人的想法和建议是什么，无论有什么设置，都可以在所有 SQL 服务器上工作。

也许像`DateTime.Now.ToString("yyyy/MM/dd")`

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-22T15:10:22.463

只有 2 种安全格式

ISO和ISO8601

ISO = 年月日

ISO8601 = yyyy-mm-dd Thh:mm:ss:mmm（无空格）（注意 T）

另请参阅：[为 SQL Server 设置标准 DateFormat](http://blogs.lessthandot.com/index.php/DataMgmt/DataDesign/setting-a-standard-dateformat-for-sql-se)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-22T15:02:51.887

为什么不参数化查询并将 DateTime 值作为 SQL DateTime 输入参数传递？

例如`INSERT INTO SomeTable (Blah, MyDateTime) VALUES (1, @MyDateTime)`

然后你就可以确定了。即使您正在生成 SQL，您也应该能够专门处理这个问题？

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-06-24T12:02:23.937

我发现需要这种特定格式：

```
DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fff") 
```

注意大小写和没有任何空格。这是根据[Robyn Page](http://www.simple-talk.com/sql/learn-sql-server/robyn-pages-sql-server-datetime-workbench/#inputtingdates)的通用方式。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-22T15:17:27.783

您真的应该为此使用参数化查询，并将您的**DateTime**对象作为**SQL DateTime**参数传递。

如果您将**DateTime**解析为**String**，您将不得不在应用程序服务器和数据库服务器上处理本地化设置。这可能会导致一些令人讨厌的意外，例如一方面将日期视为美国格式，另一方面将其视为英国格式。字符串 9/12/2000 可以是 9 月 12 日或 12 月 9 日。因此，在应用程序和数据库之间进行交换时，请将数据保留在**DateTime对象/类型中。**

将**DateTime**解析为**String**的唯一时间是在显示数据 (GUI) 时。但是你应该确保在解析时使用正确的本地化设置以用户期望的格式显示它。

同样的原则也适用于其他数据类型，例如**浮点数**。它的字符串表示形式因语言环境而异，我想您在将**浮点数**传递给数据库时不会将其解析为**字符串**，那么为什么要使用**DateTime**呢？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-22T14:58:21.363

这个永远不会失败： DateTime.Now.ToString("yyyyMMdd HH:mm:ss.fff")

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-22T15:08:58.503

注意日期是否为 DateTime.Min，因为 SQL Server 使用 1700s 作为时间本身的开始。我会使用 ISO 日期时间格式： DateTime.ToString("s") 但我没有在非西方安装上尝试过。

例如

```
DateTime.Now.ToString("c") 
```

是

```
insert into testtable values ('2009-01-22T15:08:13') 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-22T14:58:06.310

使用 DateTime.ToString("yyyy-MM-dd HH:mm:ss:fff") 进行格式化将匹配 MS SQL Server 日期/时间格式。（我相信 SQL Server 在识别外观略有不同的格式方面相当“智能”，例如使用斜线，但我个人已经成功地使用了那个格式。）

编辑：正如评论者所指出的，这可能会在某些地区被破坏。

# c# - C# 正则表达式替换意外行为

> ID：469418
> 
> 赞同：2
> 
> 时间：2009-01-22T14:55:52.227
> 
> 标签：c#, .net, regex

给定`$displayHeight = "800";`，`800`用 int value替换任何数字`y_res`。

```
resultString = Regex.Replace(
    im_cfg_contents, 
    @"\$displayHeight[\s]*=[\s]*""(.*)"";", 
    Convert.ToString(y_res)); 
```

在 Python 中，我会使用 re.sub 并且它会工作。在 .NET 中，它替换整行，而不是匹配的组。

什么是快速修复？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T20:40:19.723

基于已经发布的几个答案。零宽度断言允许您进行正则表达式匹配，而无需将这些字符放在匹配中。通过将字符串的第一部分放在一个组中，我们将它与您要替换的数字分开。然后通过在该组中使用零宽度的lookbehind 断言，我们允许正则表达式正常进行，但在匹配中省略该组中的字符。同样，我们将字符串的最后一部分放在一个组中，并使用了零宽度的前瞻断言。[MSDN 上的 Grouping Constructs](http://msdn.microsoft.com/en-us/library/bs2twtah.aspx "分组构造 MSDN")显示了组以及断言。

```
resultString = Regex.Replace(
    im_cfg_contents, 
    @"(?<=\$displayHeight[\s]*=[\s]*"")(.*)(?="";)", 
    Convert.ToString(y_res)); 
```

另一种方法是使用以下代码。对正则表达式的修改只是将第一部分放在一个组中，将最后一部分放在一个组中。然后在替换字符串中，我们添加回第一组和第三组。不如第一种方法好，但也没有写出 $displayHeight 部分那么糟糕。[MSDN 上的 Substitutions](http://msdn.microsoft.com/en-us/library/ewy2t5e0.aspx "MSDN 上的替换")显示了 $ 字符的工作原理。

```
resultString = Regex.Replace(
    im_cfg_contents, 
    @"(\$displayHeight[\s]*=[\s]*"")(.*)("";)", 
    "${1}" + Convert.ToString(y_res) + "${3}"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T15:16:10.797

试试这个：

```
resultString = Regex.Replace(
    im_cfg_contents,
    @"\$displayHeight[\s]*=[\s]*""(.*)"";",
    @"\$displayHeight = """ + Convert.ToString(y_res) + @""";"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:23:15.853

你也可以试试这个，虽然我认为它比我的其他方法慢一点：

```
resultString = Regex.Replace(
    im_cfg_contents,
    "(?<=\\$displayHeight[\\s]*=[\\s]*\").*(?=\";)",
    Convert.ToString(y_res)); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T15:25:41.917

它替换了整个字符串，因为您已经匹配了整个字符串 - 此语句没有告诉 C# 仅替换匹配的组，它肯定会找到并存储匹配的组，但它仍然匹配整个字符串。

您可以将替换器更改为：

```
@"\$displayHeight = """ + Convert.ToString(y_res) + @""";" 
```

..或者您可以更改您的模式以匹配数字，即：

```
@"[0-9]+" 
```

..或者您可以查看 C# 正则表达式是否支持环视（我不确定它是否会临时）并相应地更改您的匹配。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T18:03:54.063

看看这个模式

```
(?<=(\$displayHeight\s*=\s*"))\d+(?=";) 
```

关于“[环视](http://www.regular-expressions.info/lookaround.html)”的一句话。

# visio - 在哪里可以找到用于软件开发的 visio 形状？

> ID：469421
> 
> 赞同：11
> 
> 时间：2009-01-22T14:56:14.630
> 
> 标签：visio, shapes, diagrams

任何人都对在哪里获得非常好的 visio 形状集合有任何想法，例如，出于以下目的：

*   网络图
*   显示解决方案部署的形状
*   任何其他用于软件开发的精美图表？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T15:05:59.367

[Pavel Hruby](http://phruby.com/)在他的网站上有一些很好的 UML 和 SysML 模板。我一直使用 UML 模板，因为它们比 visio 提供的模板更容易使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-18T17:14:46.383

(1) [http://www.microsoft.com/downloads/details.aspx?FamilyID=6297CF81-C071-4BEA-BD9D-FDE692536E5A&amp;displaylang=f&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=6297CF81-C071-4BEA-BD9D-FDE692536E5A&amp;displaylang=f&displaylang=en)

The above URL now redirects to:

[https://www.microsoft.com/en-us/download/details.aspx?id=25110](https://www.microsoft.com/en-us/download/details.aspx?id=25110)

The above URLS (at the time of writing) take me to a page titled:

**"Software and Database Shapes for Microsoft Visio"**

Below is another option. Some are "for pay".

(2) [http://www.visiocafe.com/microsoft.htm](http://www.visiocafe.com/microsoft.htm)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T15:11:54.847

[这里](http://code.msdn.microsoft.com/MSCRM3/Release/ProjectReleases.aspx?ReleaseId=188)有很多用于 gui 模型的 visio 形状。

# ms-office - 在不同页面上将多个图像加载到 PowerPoint 中的自动化方法？

> ID：469424
> 
> 赞同：2
> 
> 时间：2009-01-22T14:56:47.560
> 
> 标签：ms-office, powerpoint

我需要将大约 60 张图片加载到 PowerPoint 中，每张图片都在不同的页面上。

有谁知道这样做的“自动化”方式。我不想逐张幻灯片浏览，并且必须在每张幻灯片上单击“加载图像”。

如果这是一次性的事情，我不会担心，但我们正在总结一些正在进行的分析的结果，我们将不得不做很多次。

谢谢。

编辑：经过与同事的简短讨论，“插入-> 相册”似乎很容易做到这一点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T16:52:36.297

从[PPTools](http://www.pptfaq.com/FAQ00050.htm)：插入 -> 相册在 PPT 2007 中运行良好。在旧版本中存在一些问题，因为图像是链接的，如果您没有选择正确的设置，则不会嵌入。

上面提到的网站还[提供了一个宏](http://www.pptfaq.com/FAQ00352.htm)来执行此操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-19T12:52:53.153

有几个开源程序都托管在 sourceforge.net 上，它们是为您描述的情况而开发的。他们是：

[Powerpoint 图片插入命令行界面](http://p3icli.sourceforge.net/)（一个控制台程序），也称为 P3ICLI。

还有一个 P3ICLI 的 GUI 包装器，称为 Powerpoint Picture Insert，或简称 P3I（由于论坛发帖限制，我无法链接到它）。如果要使用 GUI，还必须安装 P3ICLI。

==================

FWIW，我的妻子从 JMP（一个统计数据包）调用 P3ICLI 将多个图表转储到一个 PPT 演示文稿中……无需点击即可。

# ms-access - MS Access 作为企业软件？

> ID：469436
> 
> 赞同：19
> 
> 时间：2009-01-22T15:00:07.973
> 
> 标签：ms-access

我的用户经常遇到的事情是他们希望快速获得解决方案，这意味着他们有时会说“哎呀，我会卷起袖子在 Access 中做这件事——它安装在我的桌面上”。

有时，我们很幸运，创建 Access 数据库的人将其后端到 SQL Server，因此至少经常出现的 mdb 文件问题不是问题。

但是，我认为将 Access 前端部署到 SQL Server 数据库作为具有数千个用户和数十万行的企业解决方案仍然存在问题。

您对此有何看法？有哪些潜在的陷阱？

或者

这是一个完全可以接受、稳定、可维护和健壮的解决方案吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-22T17:32:30.523

我已经在这种情况下做了很多工作。事实上，作为一名顾问/开发人员，访问前端 SQL Server 后端一直是我过去 10 年的主要工作。这并不意味着我*喜欢*Access ;-)

在 AJAX 被普遍采用之前，它是一个完全合理的解决方案。仍然有大量的中小型应用程序放在 Access 中，它们可以完美地运行定制的业务系统，我怀疑它会在未来 10 年或更长时间内消失 - 事实上，Access/SQL 可能会成为21 世纪的 Cobol。如果您在“绿地”站点上工作，那么现在几乎没有任何理由在从头开始构建时部署 Access - 但如果您确实继承了现有应用程序，那么重写的成本可能不值得并且难以通过用户。

Access 确实具有一些仍然很重要的优势 - 如果提议转换为 Web 应用程序，可能会出现问题

1.  很快。对于简单的 CRUD 工作，它的编写和部署速度与任何其他现实解决方案一样快。
2.  鉴于系统，内置报告易于运行并且非常强大。按需为用户创建和部署新报告通常非常容易。
3.  它与 Office 很好地集成在一起。当希望将 Access 应用程序移至 Web 应用程序时，这一点往往会成为阻碍。“部门规模”的 Access 应用程序与 Outlook、Word 或 Excel**紧密**集成是非常常见的 - 通常是三者。这是处理现实世界情况时**的主要问题。**编码人员很容易低估这一点对于此类系统的日常使用的重要性，即使是对用户施加很小程度的额外麻烦，通常也会遇到很大的阻力 - 通常足以完全破坏项目。
4.  如果你在一个规模合理的部门工作——十几个人——办公室里有人把自己想象成一个计算机巫师是很常见的。如果处理不当，这些人可能是一大痛苦，但同样可能是一项重要资产。*如果我有这样的人，我会尝试让管理层向他们发送一两个 Access 课程，以便他们可以编写简单的查询和报告，并为他们*设置一个单独的 Access 应用程序*它具有对 SQL 数据库的适当（受限）访问权限。然后，您可以信任此人为他们的同事处理生成简单的报告等。这可能是一个真正的双赢——你得到了一个站在你这边的人，并将把你当作导师——在部门里为你提供现成的倡导者——他们让你不必担心繁重的报告工作。他们获得了很多荣誉和工作满意度——甚至是潜在的职业道路。用除 Access 之外的任何其他系统来做这种事情要困难得多，几乎不可能。*

 *主要的实际缺点

1.  部署可能是一场噩梦。通常，如果您有一个定义非常严格的环境 - 一家小公司、单个部门、基于 citrix 或分布在一个密切控制其 PC 的 IT 部门，那么您就可以了。部署为跨多个公司的商业应用程序 - 只有在您可以收取大量维护费用（去过那里）的情况下。
2.  代码无法扩展。访问 VBA 代码，即使是由专业人士编写的，也很容易腐烂成腐烂的意大利面条。最终得到一个易于维护的 Access 应用程序是很常见的，但随着依赖项的增加逐渐变得不可维护。

所以我想说 Access 仍然有一席之地，它的使用在许多现实世界的情况下都是可以辩护的，但如果情况允许，最好选择更现代的解决方案。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-23T03:21:36.607

我们已经构建了这样一个解决方案（Access 前端、SQL 后端），现在大约有 80 个用户，在不同国家/地区之间复制了数百万行，每月更新超过 100 000 次。它工作正常。我认为 Access 的主要错误在于将其视为业余爱好者开发应用程序的工具。它可以以这种方式工作，但请记住，业余开发将为您提供业余应用程序，而专业开发将为您带来专业成果。

其优点、问题和限制的快速列表：

*   由于 msAccess 运行时，它对最终用户是免费的
*   它适用于免费的 SQLServer Express，而不是那么昂贵的 SQL Server Enterprise。
*   它很快，特别是在处理表单时
*   它可以非常轻松地与其他仍属于企业标准的 Office 应用程序通信
*   [您可以将其界面管理为非常接近 Office 标准，使用它可以非常直观，让人开心（我在博客](http://thebis.blogspot.com/)上谈到了一点，需要更新！）
*   在大规模上，您必须考虑将其分发给用户的最佳方式。正如#Cruachan 所指出的，这个问题可能会变成一场噩梦，但它可以通过构建和分发 msi 包来解决。此类 msi 包还可以包含所有外部引用，例如“添加”的 dll、ocx、tlb 文件（报告 dll、activeX 扫描仪控件等）。我们在[这里谈了几句](https://stackoverflow.com/questions/378264/access-2007-engine-how-do-i-include-it-in-my-msi-installer#380770)。
*   在分发 mdb 文件的更新版本时，您可以拥有一个公共网络文件夹，其中包含客户端将在启动时检查/更新的新 mdb/压缩文件。您的客户应该可以重新安装以前版本的 mdb 文件。升级变得比安装新的 .exe 文件更容易。
*   您必须设置版本控制系统。请[在此处](https://stackoverflow.com/questions/247292/working-with-multiple-programmers-on-ms-access#250852)查看详细信息。
*   你必须对你的代码组织非常严格。例如，我们的基本规则之一是在表单级别没有任何特定代码。请[在此处](https://stackoverflow.com/questions/47400/best-way-to-test-a-ms-access-application#70572)查看此主题。
*   正如#Cruachan 所指出的，我没有发现 VBA 代码缩放有任何问题。如果实施专业的编码规则，则不会出现任何异常的代码缩放问题。举个例子，我们的应用程序现在可以在 180 多种不同的表单中正常工作，并且还在毫无问题地增长。

作为结论，我们对 Access 的主要问题是图像问题，Microsoft 仍然让人们认为 Access 的存在是为了让他们有可能在 10 节课内开发真正的软件……而知道这是不可能的专业人士认为它作为业余开发的业余工具，将 ms-access 用户视为无聊的低智商红脖子。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-23T03:16:38.910

我认识不少专业的 Access 开发人员，他们使用 Access 作为前端（MDB 或 ADP）开发和维护企业级应用程序，并支持数百个用户群（甚至在少数情况下，数千个）。

与任何企业级应用程序开发一样，它需要更高水平的编程技能，而不是为您的 5 人部门构建一个小型 Access 数据库。

奇怪的是，高效的企业级应用程序的设计原则也使工作组级的 Access 应用程序更加高效。

我认为大多数在此线程中发帖的人无法将其视为一个好的解决方案的原因仅仅是因为他们从未见过它做得正确，或者他们自己对 Access 使用的开发模型不感兴趣。

是的，很难做到正确。

但在那个层面上，所有其他开发平台也是如此——所有这些平台都需要规划、经验和高水平的技能组合。

而且您可以在没有所有这些（企业或非企业）的人开发的 Access 应用程序上大吃一惊，但坦率地说，我遇到了一大堆实施非常糟糕的各种非 Access 数据库应用程序。

鲟鱼定律适用于任何地方，没有理由假设 Access 开发会有所不同。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-22T16:04:53.383

我开始使用 JET 后端在 Access 中开发桌面应用程序。我开始使用带有 Access 的 SQL Server/MSDE 作为前端，然后是 VB6 和一些经典的 ASP。

使用像 Visual Studio 这样的“真正的”开发工具有很多“企业”的理由。对于您询问的规模，成千上万的用户，我认为这些原因可能适用。

也就是说，我认为在某些情况下仍然可以使用 Access。以我自己的经验，当我被要求在很短的时间内提出一个企业解决方案时，我又回到了使用 SQL 数据库的 Access，尽管是针对一个小得多的企业。推动我做出决定的主要原因是时间。我可以在 Access 中组合一个数据库 UI，比在任何其他工具中都快得多。其中一些是对该工具的熟悉，但其中很多是 Access 只是为您提供了更多特定于数据库目的的位，以便开箱即用。Access UI 也可以进行调整，使其外观和操作与标准 WinForms 应用程序非常相似。

许多人在企业场景中遇到的障碍是将 Access 和应用程序 MDB/MDE 推向大众。这很容易通过在 Windows 终端服务器上进行设置来解决，它也可以被操纵成几乎像客户端计算机上的另一个应用程序窗口一样运行，并具有正确的 RDP 文件参数。但即使是这种方法也有其局限性。我不认为它会很好地扩展到数千个，但是对于几十个用户，我发现它工作得很好并且赢得了足够的时间来满足我必须使用的时间限制，因此可以在时间的时候实现 Web 界面允许。

对于知道自己在 SQL 数据库中做什么的专业人士来说，Access 前端不一定是不可原谅的罪过，尤其是当任务便宜且快速且不涉及宗教纯粹主义时。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-22T15:12:27.683

如果你有选择，不。
话虽如此，在某些情况下它可能还可以。一种情况是，如果您从未计划过更新访问应用程序。如果它是为成千上万的用户安装的，您可能会在更新所有客户端应用程序时遇到问题。
制作 Web 前端会好得多……尽管 Access 使多个主从表单比我见过的任何东西都更容易。即使是打算与 Access 竞争的 Oracle Application Express，也无法做到 Access 所做的一切。
我的建议是，如果您是一名程序员，您可以制作一个 asp.net 应用程序，该应用程序将以更具可扩展性、可维护性的性质完成相同的工作。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-22T15:18:55.097

对于很多 CRUD（创建读取更新删除）工作，MS Access 是可以的。如果数据在另一个引擎（MSSQL/Oracle/MySQL）中，我对此更有信心。但是，大多数时候我在使用 MS Access 数据库时遇到问题，这是因为：

1.  它是由桌面用户（不是程序员/IT 专业人士）自行开发的，并且没有提前计划未来的开发（因此，如果有专业人士参与，添加通常会更痛苦）
2.  它充满了非规范化表、无常变量和无键表。

我的解决方案。将 MS Access 限制为专业人士，并将运行时版本部署到用户桌面。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-11-25T08:31:15.777

对于多用户/高数据量的情况，我使用 Access 前端和 MySQL 后端。我必须说，在客户端-服务器情况下，尤其是在 LAN 上，MS Access 和它们一样好。就我个人而言，我发现 MS Access 的开发速度比 Visual Studio 快得多，尤其是在数据库驱动的应用程序方面。Access 报表与行业标准 Crystal Reports 一样好，甚至更好。我看到 Access 的唯一缺点是在非 LAN 情况下，您必须将应用程序分发给跨越广泛地理区域的用户。但同样，Web 应用程序本身也有一个主要缺点 - 处理一对多关系，访问通过其子表单、子报告功能可以很好地处理。而且更重要的是，Access 有一个大多数应用程序无法比拟的非常强大的事件模型。就个人而言，我可以在 Access 上做任何事情！所以，我的结论是，MS Access 有许多优点，使其成为一种称职的开发工具，尤其是在 LAN 环境中。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-22T15:13:50.990

可悲的是，我对此有相当多的经验。我们围绕与 SQL 数据库绑定的 Access Forms 构建了一个完整的产品。老实说，性能不是问题——它确实是任何客户端/服务器应用程序都必须关注的正常数据库连接类型场景。在我们的例子中，最初的开发人员知道 Access 中的大量“技巧”，并且做了诸如数据绑定下拉到存储过程之类的事情。哦，还有可怕的触发器。可怕。如，每次更新触发 45 个触发器很糟糕。

我们使用的表确实有数百万行数据，但通常推出给数十或数百名用户。我想为成千上万的用户付出的任何努力都会从定制开发中受益更多，这样您就可以正确地构建软件，从性能和开发的角度支持它，以及构建自动化部署选项（MSI 或 ClickOnce ， 例如）。

所以，我不会说它是一个完全可以接受、稳定、可维护或健壮的解决方案。它对我们有用，因为我们在那里支持它（并最终用 .NET 重写它），但我不会向任何人推荐它。然而，我曾在政府工作过，试图从“IT”（我参与其中）完成任何工作，但繁文缛节和文书工作充满了繁文缛节，以至于部门通常只做 Access 解决方案。

最终，如果您处于这种情况——部门根本无法访问 IT 资源——那么至少向他们展示一些关于如何最终扩展应用程序的最佳实践会很有帮助。只要在你展示他们之后，你就把你的简历拿出来找一份更好的工作。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-22T15:13:21.270

12-15 年前，这可能是一种可以接受的做法（不是真正可取的，但可以接受），但现在它是不可原谅的。有这么多可扩展和可分发的解决方案，Access 应该是人们最不会想到的事情。

当您说 Access 作为解决方案时，我想到的是一个简单的 2-3 表应用程序，由一些营销人员而非真正的开发人员组合而成。如果营销人员有一个非常好的主意，那么也许开发团队应该看看它（我假设您表示可能有成千上万的用户），将其重构为更好的平台（通过 ClickOnce 分发的 Intranet 或 winform等），然后部署它。

早在 90 年代初期，我是一名 Access 开发人员——甚至获得了 MS 认证。我构建了几十个“企业”应用程序（意味着 10-15 人使用它们）。那些日子已经一去不复返了，IMO。现在有更容易构建、部署和维护的解决方案。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-22T15:14:40.987

我很不幸像您描述的那样在 Access 前端工作，这里有一些非企业参数。

**编程很简单！**在访问中创建表单面向非开发人员。例如，如果下拉列表中有多个列，是否有列表字段和数据字段。没门！您只需将您不想看到的事物的宽度设置为 0"。因此，您查看的表格要么由非开发人员拼凑在一起，要么会让大多数必须处理它们的人感到厌烦。

**版本控制？谁需要版本控制？，只需发送附件**如果需要对前端进行更改，重新部署既耗时又容易出错。

**这种形式，我认为洋红色**前端没有很好地锁定，因此最终用户可以发挥创意。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-22T15:17:25.133

随着 Microsoft 在每个版本中“赠送” SQL Server 引擎的免费版本（MSDE，或 2005 年以后的 SQL Express），实际上不再需要使用 Access。尽管这些免费版本没有可视化前端，这会使开发更加困难，但您只需要良好的 SQL 知识。

# c# - 如何将服务引用移动到他们自己的程序集？

> ID：469440
> 
> 赞同：1
> 
> 时间：2009-01-22T15:00:50.720
> 
> 标签：c#, .net, asp.net, vb.net, web-services

一点背景：

我正在创建一组适配器以允许通过不同的蜂窝网络与移动设备进行通信。这将使用类工厂模式来实现。至少其中一个网络需要服务引用才能通过 Web 服务与其设备进行通信。

到目前为止，我有 3 个程序集，它们代表：

*   一个包含主适配器库的程序集：这包含
    *   每个适配器的接口定义
    *   基类
    *   在运行时实例化指定适配器的类工厂。
*   每个网络适配器实现的程序集。
*   包含我的主要应用程序的程序集。

鉴于我不想将服务引用及其配置添加到主应用程序程序集[因为这与主应用程序无关]，我如何强制每个程序集的服务引用从其自己的 app.config 中获取其配置？

如果我在主 app.config 中有服务引用配置，一切正常，但如果我将配置移动到适配器的 app.config，一切都会停止工作，在我新建 Soap1Client 时抛出以下异常。

> “在 ServiceModel 客户端配置部分中找不到引用合同‘MobileService.Service1Soap’的默认端点元素。这可能是因为找不到您的应用程序的配置文件，或者因为在客户端元素中找不到与此合同匹配的端点元素。”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T20:58:15.380

最后，我只是删除了服务引用并添加了一个 Web 引用 [即使用 2.0 方式进行的]。出于某种原因，Web 引用将访问它自己的 app.config，而不是主应用程序的 app.config。

比替代方案容易得多...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T16:12:02.027

您可以以编程方式设置所有选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:59:24.517

我不相信有一种内置的.NET 方式来实现这一点。但是，您应该能够通过编写一些代码来解析每个引用程序集的 .config 文件来完成它。

这是一个使用程序集特定配置文件的示例，它应该为您指明正确的方向： [http](http://www.bearcanyon.com/dotnet/#AssemblySettings) ://www.bearcanyon.com/dotnet/#AssemblySettings 。

我在 .NET Winforms 应用程序中做过类似的事情，效果很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-07-22T23:34:56.283

如果您必须让库从配置文件中读取服务的配置，那么您可能不走运。库成为流程的一部分，流程使用启动流程的应用程序的配置。

但是，在您的库中，您可以在实例化服务引用时使用服务引用代理类构造函数重载之一来动态设置配置。然后您不必在任何配置文件中都有服务引用绑定配置。我使用的重载需要两个参数：System.ServiceModel.Channels.Binding 绑定和 System.ServiceModel.EndpointAddress 远程地址。请注意，Binding 类是一个抽象类，您必须使用从它继承的类之一 - 您可以在此处找到它们的列表：[https://msdn.microsoft.com/en-us/library/system。 servicemodel.channels.binding(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/system.servicemodel.channels.binding(v=vs.110).aspx)。

对于简单的 http 服务引用，我使用 BasicHttpBinding 类的默认实例，并使用我引用的服务的 URL 创建 EndpointAddress 类的实例。显然，您必须修改它以使用 https 或安全服务等。

当然，这仍然引出了一个问题，如果您不想在库中对其进行硬编码，那么库如何获得正确的服务 URL？有几种方法是从数据库或已知文件位置读取它。

# .net - SqlDataAdapter.Dispose 是否真的关闭了关联的 SqlConnection？

> ID：469459
> 
> 赞同：10
> 
> 时间：2009-01-22T15:05:07.683
> 
> 标签：.net, ado.net

有谁知道 SqlDataAdapter.Dispose 方法是否实际关闭或处置任何 SqlConnections？我加载了 Reflector，我看到 SqlDataAdapter 继承自 DbDataAdapter。如果我反汇编并查看该类中的 dispose 方法，似乎没有任何 SqlConnections 的处置。我想我可以为此编写一个测试，但我想我会问是否有人对此有任何见解。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-22T15:48:07.677

首先要注意的是 DataAdapter 在某些情况下会管理和关闭您的连接。例如，如果您正在使用 DataAdapter，您可能正在使用`.Fill()`和`.Update()`函数对 DataTable/DataSet 进行操作。

从[`.Fill()`文档](https://docs.microsoft.com/en-us/dotnet/api/system.data.common.dataadapter.fill)：

> 与 SELECT 语句关联的连接对象必须有效，但不需要打开。如果在调用 Fill 之前关闭连接，则打开它以检索数据，然后关闭。如果在调用 Fill 之前连接已打开，则它保持打开状态。

[`.Update()`文档](https://docs.microsoft.com/en-us/dotnet/api/system.data.common.dataadapter.update)根本没有提及有关连接的任何内容，因此我希望需要手动管理它。

您专门询问了该`Dispose()`方法。就像`Update()`，[`Dispose()`文档](http://msdn.microsoft.com/en-us/library/3cc9y48w.aspx)没有特别提到连接，所以我希望需要手动关闭它。

最后，我们可以稍微改进一下 Bob King 的代码，如下所示：

```
Using conn as New SqlConnection(""), _
      adapter as New SqlDataAdapter() With {.Connection = conn}
    ' Do stuff
End Using 
```

或者在 C# 中：

```
using (SqlConnection conn = new SqlConnection(""))
using (SqlDataAdapter adapter = new SqlDataAdapter() {Connection = conn})
{
    // Do stuff
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T15:09:47.847

据我所知没有。我使用嵌套的 Using 语句来实现这一点，首先创建连接，然后创建适配器，并且作为 using 语句“pop”，适配器是 Disposed，然后连接是 Disposed，这**会**触发关闭：

```
Using conn as New SqlConnection("")
    Using adapter as New SqlDataAdapter() With {.Connection = conn}
        'Do stuff'
    End Using
End Using 
```

C# 的语法几乎相同，如果这是您选择的语言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:09:32.700

不，它不会处理连接。我相信不应该。您可能想在其他地方使用它。

# sql - 如何更改 PostgreSQL 表并使列唯一？

> ID：469471
> 
> 赞同：237
> 
> 时间：2009-01-22T15:07:21.283
> 
> 标签：sql, postgresql, unique-constraint

我在 PostgreSQL 中有一个表，其架构如下所示：

```
CREATE TABLE "foo_table" (
    "id" serial NOT NULL PRIMARY KEY,
    "permalink" varchar(200) NOT NULL,
    "text" varchar(512) NOT NULL,
    "timestamp" timestamp with time zone NOT NULL
) 
```

现在我想通过`ALTER`-ing 表格使永久链接在表格中唯一。

* * *

## 回答 #1

> 赞同：350
> 
> 时间：2009-01-22T15:22:19.710

我从 PostgreSQL 文档中弄清楚了，确切的语法是：

```
ALTER TABLE the_table ADD CONSTRAINT constraint_name UNIQUE (thecolumn); 
```

谢谢弗雷德。[_](https://stackoverflow.com/users/55774/frederik-gheysels)

* * *

## 回答 #2

> 赞同：296
> 
> 时间：2011-09-04T03:26:35.203

或者，让数据库使用以下命令自动分配约束名称：

```
ALTER TABLE foo ADD UNIQUE (thecolumn); 
```

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2016-11-16T09:55:06.840

也可以创建超过 1 列的唯一约束：

```
ALTER TABLE the_table 
    ADD CONSTRAINT constraint_name UNIQUE (column1, column2); 
```

# c++ - 在向量中查找最近的点

> ID：469477
> 
> 赞同：8
> 
> 时间：2009-01-22T15:07:50.657
> 
> 标签：c++, stl

给定一个带有多个值的排序向量，如下例所示：

```
std::vector<double> f;
f.pushback(10);
f.pushback(100);
f.pushback(1000);
f.pushback(10000); 
```

我正在寻找最优雅的方式来检索任何 double d 紧邻它的两个值。例如，给定值“45”，我希望它返回“10”和“100”。

我在看lower_bound 和upper_bound，但他们没有做我想做的事。你能帮我吗？

编辑：我决定发布我自己的分析器，因为它在某种程度上是我在这个线程中得到的所有有用答案的组合。我投票赞成那些我认为最有帮助的答案。

谢谢大家，

戴夫

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-22T15:21:57.743

您可以使用 STL 的 lower_bound 在几行代码中获得您想要的。lower_bound 在后台使用二进制搜索，因此您的运行时间为 O(log n)。

```
double val = 45;
double lower, upper;
std::vector<double>::iterator it;
it = lower_bound(f.begin(), f.end(), val);
if (it == f.begin()) upper = *it; // no smaller value  than val in vector
else if (it == f.end()) lower = *(it-1); // no bigger value than val in vector
else {
    lower = *(it-1);
    upper = *it;
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-22T16:40:56.197

您可以使用 equal_range() 在一次调用中获取两个值（如果它们存在）。它返回一个 std::pair 迭代器，第一个是第一个位置，第二个是最后一个位置，您可以在其中插入传递的值而不会违反排序。为了严格满足您的标准，您必须先减少迭代器，然后验证它不等于向量的 begin()。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-22T15:34:16.877

您可以简单地使用[二进制搜索](http://en.wikipedia.org/wiki/Binary_search)，它将在 O(log(n)) 中运行。

这是一个 Lua 片段（我没有时间在 C++ 中做，抱歉），它可以满足您的要求，除了限制条件（无论如何您都没有定义）：

```
function search(value, list, first, last)
    if not first then first = 1; last = #list end

    if last - first < 2 then
        return list[first], list[last]
    end

    local median = math.ceil(first + (last - first)/2)

    if list[median] > value then
        return search(value, list, first, median)
    else
        return search(value, list, median, last)
    end
end

local list = {1,10,100,1000}

print(search(arg[1] + 0, list)) 
```

它需要从命令行搜索的值：

```
$ lua search.lua 10 # didn't know what to do in this case
10  100
$ lua search.lua 101
100 1000
$ lua search.lua 99
10  100 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-23T09:27:55.883

我将发布我自己的分析器，并投票给任何帮助我达到它的人，因为这是我最终将使用的，你们都帮助我得出了这个结论。欢迎评论。

```
std::pair<value_type, value_type> GetDivisions(const value_type& from) const
{
    if (m_divisions.empty())
        throw 0; // Can't help you if we're empty.

    std::vector<value_type>::const_iterator it = 
        std::lower_bound(m_divisions.begin(), m_divisions.end(), from);

    if (it == m_divisions.end())
        return std::make_pair(m_divisions.back(), m_divisions.back());
    else if (it == m_divisions.begin())
        return std::make_pair(m_divisions.front(), m_divisions.front());
    else
        return std::make_pair(*(it - 1), *(it));
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-22T15:18:30.310

如果（在您的情况下） d 小于第一个元素或大于最后一个元素怎么办？以及如何处理负值？顺便说一句：保证你的“d”在你的向量的第一个和最后一个值之间，你可以这样做：

```
// Your initializations
std::vector<double>::const_iterator sit = f.begin();
double upper, lower; 
```

这是其余的：

```
while ( *sit < d )         // if the element is still less than your d
    ++sit;                 // increase your iterator

upper = *sit;              // here you get the upper value
lower = *(--sit);          // and here your lower 
```

够优雅吗？：/

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T15:12:31.367

您可以在向量中搜索您的值（如果它在向量中，它将告诉您值在哪里），然后返回该位置之前和之后的值。所以搜索 45 会告诉你它应该在 index=1 然后你会返回 0 和 1 （取决于你的搜索实现，你会得到较小值的索引或较大值的索引，但这很容易通过几个边界条件来检查）。这应该能够在 O(log n) 中运行，其中 n 是向量中的元素数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-22T16:23:30.973

我会写这样的东西，没有测试它是否编译，但你明白了：

```
template <typename Iterator>
std::pair<Iterator, Iterator> find_best_pair(Iterator first, Iterator last, const typename Iterator::value_type & val)
{
    std::pair<Iterator, Iterator> result(last, last);

    typename Iterator::difference_type size = std::distance(first, last);

    if (size == 2)
    {
        // if the container is of size 2, the answer is the two elements 
        result.first = first;
        result.first = first;
        ++result.first;
    }
    else
    {

        // must be of at lease size 3
        if (size > 2)
        {
            Iterator second = first;
            ++second;
            Iterator prev_last = last;
            --prev_last;
            Iterator it(std::lower_bound(second, last, val));

            if (it != last)
            {

                result.first = it;
                result.second = it;

                if (it != prev_last)
                {
                    // if this is not the previous last
                    // then the answer is (it, it + 1)
                    ++result.second;
                }
                else
                {
                    // if this the previous last
                    // then the answer is (it - 1, it)
                    --result.first;
                }

            }

        }

    }

    return result;

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-23T16:21:10.807

我写了这个小函数，它似乎适合你想要的更一般的情况。我还没有完全测试过，但我确实写了一点测试代码（包括在内）。

```
#include <algorithm>
#include <iostream>
#include <vector>

template <class RandomAccessIt, class Container, class T>
std::pair<RandomAccessIt, RandomAccessIt> bracket_range(RandomAccessIt begin, RandomAccessIt end, Container& c, T val)
{
    typename Container::iterator first;
    typename Container::iterator second;

    first = std::find(begin, end, val);
    //Find the first value after this by iteration
    second = first;
    if (first == begin){ // Found the first element, so set this to end to indicate no lower values
    first = end;
    }
    else if (first != end && first != begin) --first; //Set this to the first value before the found one, if the value was found
    while (second != end && *second == val) ++second;
    return std::make_pair(first,second);
}

int main(int argc, _TCHAR* argv[])
{
    std::vector<int> values;
    std::pair<std::vector<int>::iterator, std::vector<int>::iterator> vals;

    for (int i = 1; i < 9; ++i) values.push_back(i);

    for (int i = 0; i < 10; ++i){
        vals = bracket_range(values.begin(), values.end(),values, i);
        if (vals.first == values.end() && vals.second == values.end()){ // Not found at all
            std::cout << i << " is not in the container." << std::endl;
        }
        else if (vals.first == values.end()){ // No value lower
            std::cout << i << ": " << "None Lower," << *(vals.second) << std::endl;
        }
        else if (vals.second == values.end()) { // No value higher
            std::cout << i << ": " << *(vals.first) << ", None Higher" << std::endl;
        }
        else{
        std::cout << i << ": " << *(vals.first) << "," << *(vals.second) << std::endl;
        }
    }
    return 0;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-03T02:45:58.867

根据 tunnuz 发布的代码，您可以在此处对边界检查进行一些改进：

```
template<typename T>
void find_enclosing_values(const std::vector<T> &vec, const T &value, T &lower, T &upper, const T &invalid_value)
{
    std::vector<T>::const_iterator it = vec.begin();

    while (it != vec.end() && *it < value)
        ++it;

    if(it != vec.end())
        upper = *it;
    else
        upper = invalid_value;

    if(it == vec.begin())
        lower = invalid_value;
    else
        lower = *(--it);

} 
```

使用示例：

```
std::vector<int> v;

v.push_back(3);
v.push_back(7);
v.push_back(10);

int lower, upper;

find_enclosing_values(v, 4, lower, upper, -1);

std::cout<<"lower "<<lower<<" upper "<<upper<<std::endl; 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-01-22T16:07:13.020

如果您有能力使用其他数据结构（不是向量），我建议您使用[B-tree](http://en.wikipedia.org/wiki/B-tree)。如果您的数据不变，我相信您可以在恒定时间内检索结果（最糟糕的是对数时间）。

# delphi - 如何从 Delphi 中的服务名称/句柄中找到进程 ID？

> ID：469494
> 
> 赞同：4
> 
> 时间：2009-01-22T15:10:29.343
> 
> 标签：delphi, windows-services

我在delphi中有一个windows服务的服务名称，我也知道如何从中获取句柄。我需要做的是停止服务，如果由于某种原因停止失败，我需要终止与服务关联的进程。问题是我有多个服务从同一个可执行文件运行，所以我不能使用可执行文件名称来终止进程。这意味着我需要进程 ID 来终止正确的关联进程。如何获取此 ID 或以某种方式从服务名称或句柄中终止正确的进程？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-22T15:29:35.700

[`QueryServiceStatusEx`](http://msdn.microsoft.com/en-us/library/ms684941(VS.85).aspx)?

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-22T16:27:28.063

请注意，我只接受了这个解决方案，因此接受了完整的 delphi 代码解决方案，这一切都归功于 Jk 为我指出了正确的路径。

--

好的，我已经能够弄清楚如何使用 Jk 的答案，并在 delphi 中提出了这个解决方案。

作为参考，这是Jk提供的链接：

[QueryServiceStatusEx](http://msdn.microsoft.com/en-us/library/ms684941(VS.85).aspx)

我的解决方案：

```
unit Demo;

interface

uses
  Windows, Forms, SysUtils,
  StdCtrls, WinSvc, Controls, Classes;

type

  //Form for basic demo usage
  TForm6 = class(TForm)
    Button1: TButton;
    Memo1: TMemo;
    procedure Button1Click(Sender: TObject);
  end;

  //Record defined for use as return buffer
  _SERVICE_STATUS_PROCESS = record
    dwServiceType: DWORD;
    dwCurrentState: DWORD;
    dwControlsAccepted: DWORD;
    dwWin32ExitCode: DWORD;
    dwServiceSpecificExitCode: DWORD;
    dwCheckPoint: DWORD;
    dwWaitHint: DWORD;
    dwProcessId: DWORD;
    dwServiceFlags: DWORD;
  end;
  //Function Prototype
  function QueryServiceStatusEx(
  SC_HANDLE: SC_Handle;
  SC_STATUS_TYPE: Cardinal;
  out lpBuffer: _SERVICE_STATUS_PROCESS;
  cbBufSize: DWORD;
  out pcbBytesNeeded: LPDWORD
  ): BOOL; stdcall;

  //internal setup function
  function GetPid(sService: String; sMachine: String = '') : Cardinal;
var
  Form6: TForm6;

implementation

{$R *.dfm}
const
  // windows api library
  advapi32 = 'advapi32.dll';
  //define the api call
  function QueryServiceStatusEx;   external advapi32 name 'QueryServiceStatusEx';

//for demo usage
procedure TForm6.Button1Click(Sender: TObject);
begin
  Memo1.Lines.Add(IntToStr(Integer(GetPid('Service'))))
end;

function GetPid(sService: String; sMachine: String = '') : Cardinal;
var
  schm,
  schs: SC_Handle;
  SC_STATUS_TYPE: Cardinal;
  lpBuffer: _SERVICE_STATUS_PROCESS;
  cbBufSize: DWORD;
  pcbBytesNeeded: LPDWORD;
begin
  //open the service manager  (defined in WinSvc)
  schm := OpenSCManager(PChar(sMachine), nil, SC_MANAGER_CONNECT);
  //set the status type to SC_STATUS_PROCESS_INFO
  //this is currently the only value supported
  SC_STATUS_TYPE := $00000000;
  //set the buffer size to the size of the record
  cbBufSize := sizeof(_SERVICE_STATUS_PROCESS);
  if (schm>0) then
  begin
    //grab the service handle
    schs := OpenService(schm, PChar(sService), SERVICE_QUERY_STATUS);
    if (schs>0) then
    begin
      //call the function
      QueryServiceStatusEx(
      schs,
      SC_STATUS_TYPE,
      lpBuffer,
      cbBufSize,
      pcbBytesNeeded);
      CloseServiceHandle(schs);
    end;
    CloseServiceHandle(schm);
  end;
  Result := lpBuffer.dwProcessId;
end;

end. 
```

请注意，并非所有外部命名和其他必需品都包括在内。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T14:57:14.657

[或者将 DSiWin32 用于许多有用的功能](http://17slon.com/gp/gp/dsiwin32.htm)，包括 DSiGetProcessID。此代码由[StackOverflow 用户（和程序员）Gabr 编写。](https://stackoverflow.com/users/4997/gabr)

下面是函数，供大家参考。它会给你你正在寻找的东西：

```
//Retrieves ID of the specified process. Requires Toolhelp API.
//  @returns False if ID cannot be retrieved. Check GetLastError - if it is 0, process
//       doesn't exist; otherwise it contains the Win32 error code.
//  @author  gabr
//  @since   2004-02-12
//
  function DSiGetProcessID(const processName: string; var processID: DWORD): boolean;
  var
    hSnapshot: THandle;
    procEntry: TProcessEntry32;
  begin
    Result := false;
    hSnapshot := CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
    if hSnapshot = 0 then
      Exit;
    try
      procEntry.dwSize := Sizeof(procEntry);
      if not Process32First(hSnapshot, procEntry) then
        Exit;
      repeat
        if AnsiSameText(procEntry.szExeFile, processName) then begin
          processID := procEntry.th32ProcessID;
          Result := true;
          break; // repeat
        end;
      until not Process32Next(hSnapshot, procEntry);
    finally DSiCloseHandleAndNull(hSnapshot); end;
  end; { DSiGetProcessID } 
```

# c# - 如何在 WPF 中使用不同的坐标系？（仅缩放）

> ID：469495
> 
> 赞同：8
> 
> 时间：2009-01-22T15:10:29.483
> 
> 标签：c#, wpf, font-size, dpi

（让我给你一些背景信息）我目前正在设计一个应用程序，它应该根据一些数据生成一个可打印的 A4 页面。当然，WPF 的设备无关像素（96 像素/英寸）在纸质世界中并不是一个非常自然的度量单位。像毫米这样的东西会更合适。所以我拿出我的计算器，得到一个大约 3.779 的比例因子。

事实证明，简单地将应该在页面上显示的所有内容都放在 a`ScaleTransform`中会产生一个令人讨厌的副作用：**字体大小也会**（自然地）缩放。然而，这不是我想要的。我希望 12pt Arial 像 12pt Arial 正常渲染一样渲染。

有没有其他方法可以**更改坐标系，而无需调用扩展**或任何其他方法来转换每个坐标、长度、厚度等？- 或 - 有没有办法**即时映射字体大小，即**DependencyProperties？通过一个包含所有纸张内容的自定义控件，也许吧？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-07-17T15:51:08.353

对于概述的要求，您根本不需要做任何特别的事情，只需继续使用厘米作为 WPF 元素本身的测量单位（即没有任何转换） - WPF 设备独立性的本质允许您执行以下操作：

```
<Window x:Class="WpfApplication1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="29.7cm" Width="21cm" FontSize="16pt">
    <Grid>
        <TextBlock Text="Sample" Height="1in" Width="1in" FontSize="12pt" 
            HorizontalAlignment="Center" VerticalAlignment="Center" 
            TextAlignment="Center"/>
    </Grid>
</Window> 
```

即：您将获得一个在“ ”中指定的 A4 窗口，其中在“ `cm`”中指定了一个居中的方形文本框，在“ `in`”中指定了一个字体`pt`。如果需要，所有这些都将通过您可能额外应用的任何变换正确缩放（例如，通过用户视口的缩放滑块），尊重它们的相对大小，而不管每个都使用不同的单位指定（即随意混合使用）。

Available units are `px` (default), `in`, `cm` and `pt`, see for example [FrameworkElement.Height](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.height.aspx) for details on their specification.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-17T11:29:10.913

您还可以以磅 (FontSize="10pt")、英寸 (FontSize="10in") 或厘米 (FontSize="10cm") 为单位设置大小。当然，在这种情况下，实际大小取决于 Windows 的 DPI 设置以及显示器或打印机的 DPI。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-17T11:24:31.250

只需[将字体大小设置](http://msdn.microsoft.com/en-us/library/system.windows.documents.textelement.fontsize.aspx)为`12 / 3.779 = 3.175`，不是吗？将它分配给包含对象，它应该会向下渗透到所有子对象。

# web-applications - 用于 Intranet 应用程序的 Chrome 或 Firefox（或与浏览器无关）？

> ID：469496
> 
> 赞同：7
> 
> 时间：2009-01-22T15:10:32.430
> 
> 标签：web-applications, google-chrome, intranet, firefox-3, lock-in

如果您正在为小型企业设计核心业务 Intranet 应用程序，并希望它尽可能具有响应性，员工对卡在某个浏览器无动于衷，您会为 Firefox、Chrome 设计还是测试更多？比你需要的范围更广，只是为了避免锁定？在将所有鸡蛋放入一个浏览器篮之前，您是否还需要考虑其他因素？

例如，Chrome 是否具有其他浏览器缺乏的与速度相关的功能，需要以跨浏览器不友好的方式定位 Chrome，如果有，是否值得围绕它们进行设计？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-22T15:13:00.493

与浏览器无关。不知道什么时候有人会强制使用某个浏览器，并且您将不得不重做某个模块，因为它使用了一个特殊的插件或功能，只有现在已经过时的浏览器才可用。

从技术上讲，我们在这里是一家 IE 商店，但我确保我的所有应用程序至少在 IE 和 Firefox 上都能正常运行，而且我也在 Chrome 中进行更多测试。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T17:34:21.970

企业对浏览器的 IT 政策是什么？看起来这将决定你写它的目的。如果您客户公司的每台计算机都安装了 IE6，为什么还要为它们编写它呢？锁定对公司来说不是问题，因为他们可以决定人们在计算机上使用和必须拥有的内容的政策。

Speedwise，除非您正在执行发挥其优势的特定任务（例如，查看基准测试的范围，一些谷歌测试的 chrome 速度快数百倍，而其他有 Firefox 跳动 chrome）。

理想情况下，您希望它是不可知的，但如果您必须选择一个，我会选择 Firefox，因为它是一个更成熟的浏览器。我不愿意将应用程序定位为只有几个月大的浏览器，尤其是刚刚达到 1.0 的浏览器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T17:25:01.193

虽然符合标准当然有很多优势，但如果您的应用程序 UI 很重，并且您不想为缺少 HTML 小部件而苦恼，我建议使用基于 Gecko 的浏览器，您可以使用所有熟悉的功能更快地在 XUL 中构建 UI桌面应用程序比 HTML 从头开始​​。由于 Gecko 是开源且积极开发的，因此如果您使用专有的东西，您不会冒被卡住的风险。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-22T15:27:09.747

始终正确编写 - 即跨浏览器 - 因为您永远不知道新版本的浏览器何时可能会改变旧的行为。

但是，使用 Chrome 的 Web 应用程序“应用程序化”对于 Intranet 来说是一个不错的选择。（特别是如果它有助于阻止用户说“我的浏览器坏了”）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-22T18:13:21.237

*“如果您正在为一家小型企业设计一个核心业务 Intranet 应用程序，并希望它尽可能地具有响应性，那么员工对于被某个浏览器卡住是无所谓的。”*

**铬合金。** 您可以制作无 chrome 的 Web 应用程序，因此您可以使您的 Intranet 应用程序看起来像桌面应用程序（快速 Javascript 在这里有很大帮助）。您甚至可以使用 Chrome 制作应用程序快捷方式，这样就不会再显示地址栏，而是会占用更多屏幕空间。

Chrome 的启动速度也比其他浏览器快一点，每次我想立即阅读 Stackoverflow 上的内容时，我都会使用 Chrome。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T15:25:27.660

最便宜的方法是根据组织的标准定制 Intranet 应用程序。如果他们按小时付钱给你，那真的是他们决定你把时间花在什么上面。如果他们说它只是 FireFox，那么这就是它应该做的方式。如果是固定出价，那么您可能有一些回旋余地，但最终这是他们的决定。他们可能有他们不希望它与 chrome 一起使用的原因（我想不出一个原因，但这并不意味着没有一些原因。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-22T15:37:35.560

“并希望它尽可能有响应的感觉，员工对被某个浏览器卡住无动于衷”

听起来您需要一个智能客户端应用程序。

编辑：智能客户端是指从浏览器单独运行并使用 Web 服务与服务器通信的应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-22T15:41:58.203

与浏览器无关。

我的经验是，虽然科技社区对（类似的）浏览器有强烈的偏好，但实际的用户群体并没有真正打扰......或者换句话说，现代浏览器之间没有显着差异对最终用户很重要。

我认为 IE 和 Firefox（尤其是 IE）是为符合标准而设计的，而 Chrome 可能是宽松的，尤其是与本身并不真正符合 w3c 规范的 Google 应用程序一起工作时效果很好。

一个安全的选择是按照 w3c 标准设计您的应用程序，并确保它在大多数浏览器中都能正常工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-22T15:42:31.633

为了在政治上正确，网络标准，你必须让它在主流浏览器中呈现出来，以及所有关于现有公司配置的爵士乐。但是，将 Chrome 与 Gears 一起使用的优势是什么？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-22T18:21:06.853

我会尽可能地与浏览器无关。我们有几个这样的系统，从*技术上讲*，它们只支持一个浏览器，但我们确实确保它们至少可以在 IE - Gecko - WebKit 世界中运行（即使它们不漂亮）。

（另一方面，如果我今天要从头开始其中一个，针对 Chrome 而不是 IE 进行优化会非常非常诱人。）

# cocoa-touch - 如何使用某些 CGContext 函数重置以标识“当前转换矩阵”？

> ID：469505
> 
> 赞同：10
> 
> 时间：2009-01-22T15:12:41.647
> 
> 标签：cocoa-touch, matrix, core-graphics

我正在 CTM 上进行一系列平移和旋转，在某些时候我需要将其重置为身份，然后再进一步进行转换。

我找不到任何合适的方法来做到这一点（显然，应该有一个名为 CGContextSetCTM 左右的函数）并且由于效率是关键，我不想使用 CGContextSaveGState/CGContextRestoreGState ...

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-07T00:57:40.677

[通过CGContextGetCTM](http://developer.apple.com/documentation/GraphicsImaging/Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextGetCTM)获取当前变换矩阵，用[CGAffineTransformInvert](http://developer.apple.com/documentation/GraphicsImaging/Reference/CGAffineTransform/Reference/reference.html#//apple_ref/c/func/CGAffineTransformInvert)反转它，然后用[CGContextConcatCTM](http://developer.apple.com/documentation/GraphicsImaging/Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextConcatCTM)将当前矩阵乘以反转的矩阵（这很重要！）。CTM 现在是身份。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-25T14:57:29.027

保存/恢复操作可能是与单位矩阵大小（大小的两倍或三倍）相当的内存区域的单个内存副本。它可能只发生在保存操作中。考虑到这可能并不比 nop FUNCTION 调用慢多少。每个图形运算都在几个乘法运算的范围内，我猜这在每个保存/恢复周期的代码中都会发生不止一次。一个图形操作的时间可能大于单个保存/恢复周期。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-06-01T07:57:08.827

请注意，如果您当前的 CTM 是单数，则使用 CGAffineTransformInvert 反转当前 CTM 不起作用。

显而易见的情况是，如果先前使用矩阵 CGAffineTransformMake(0, 0, 0, 0, 0, 0) 执行 CGContextConcatCTM。

# mysql - 设置行等于mysql中的其他行？

> ID：469506
> 
> 赞同：7
> 
> 时间：2009-01-22T15:12:45.873
> 
> 标签：mysql

这是我的表的当前状态：

```
mysql> select * from page;
+----+----------+----------------+------+---------+
| id | title    | body           | page | visible |
+----+----------+----------------+------+---------+
|  1 | my title | my body        | NULL |       1 | 
|  2 | my title | my body edited |    1 |       0 | 
+----+----------+----------------+------+---------+
2 rows in set (0.00 sec) 
```

我希望第 1 行包含第 2 行的值。基本上，我想做：

```
UPDATE page SET page.* = (SELECT * FROM page WHERE id = 2) WHERE id = 1; 
```

这样的事情可能吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-22T16:16:09.600

> 插入页面（id、标题、正文、页面、可见） 选择 2、标题、正文、页面、可见

可以通过使用 ON DUPLICATE KEY UPDATE 在没有 DELETE 的情况下完成（仅在 MySQL 中）：

```
INSERT
    INTO page (id, title, body, page, visible)
    SELECT 1, title, body, page, visible FROM page WHERE id=2
    ON DUPLICATE KEY UPDATE
        title= VALUES(title), page= VALUES(page), visible= VALUES(visible); 
```

然而，也可以通过自联接以符合 ANSI 的方式完成（也许更好）：

```
UPDATE page AS page1 JOIN page AS page2 ON page1.id=1 AND page2.id=2
SET page1.title=page2.title, page1.body= page2.body, page1.page= page2.page, page1.visible=page2.visible 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T16:19:35.863

应该可以编写一个存储过程来查看相关表的元数据，并构造必要的 SQL 以从另一行更新一行，而无需对其进行硬编码。（获取所有列的集合，对其进行循环等）但这似乎是一项非常艰巨的工作。

如果您无法使用 sprocs 完成它，您也可以在应用程序代码（PHP、Perl、C# 或其他）中做同样的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:19:40.557

你可以用两个语句来做到这一点。

```
Delete from page where id = 2
insert into page (id, title, body, page, visible) Select 2, title, body, page, visible
from page where id = 1 
```

或者，您可以将表连接回自身并显式更新值。即设置derivedtable.field = page.field

# c++ - Visual Studio 编译器警告 C4250（'class1'：通过支配继承 'class2::member'）

> ID：469508
> 
> 赞同：11
> 
> 时间：2009-01-22T15:13:10.133
> 
> 标签：c++, visual-studio-2008, warnings, multiple-inheritance

以下代码生成警告 C4250。我的问题是，最好的解决方案是什么？

```
class A
{
  virtual void func1();
}

class B : public A
{
}

class C : public A
{
  virtual void func1();
}

class D : public B, public C
{
}

int main()
{
  D d;
  d.func1(); // Causes warning
} 
```

根据我所阅读的内容，应该可以这样做：

```
class D : public B, public C
{
  using B::func1();
} 
```

但是，这实际上并没有做任何事情。我目前解决的方法是：

```
class D : public B, public C
{
  virtual void func1() { B::func1(); }
} 
```

大家对此有何看法？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-01T07:29:20.220

我对以下代码有同样的警告：

```
class Interface
{
public:
    virtual void A() = 0;
};

class Implementation : public virtual Interface
{
public:
    virtual void A() {};
};

class ExtendedInterface : public virtual Interface
{
    virtual void B() = 0;
};

class ExtendedImplementation : public ExtendedInterface , public Implementation
{
public:
    virtual void B() {};
}; 
```

This [bug report](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=101259) for Visual C++ 2005 in msdn suggests that this is a known bug that was considered not important enough to fix... They suggest to disable the warning in this case by using a pragma. I think it is safe also in your case, but you should use virtual inheritance as shown in the answer by Gal Goldman.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-22T15:41:23.743

您是否尝试从 A 类继承 public virtual ？我认为它应该解决它。

```
 class B :public virtual A;
    class C :public virtual A;
    class D : public virtual B, public virtual C; 
```

虚拟继承假设解决了歧义。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-08-03T21:11:41.693

[A comment really, but I don't have enough rep...]

David Segonds identified this as a known bug in VS 2005, just tried his example code in VS 2008 and it exhibits the same problem.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T15:54:32.717

我认为您正在使用的解决方案可能是要走的路，很抱歉。我能想到的唯一可能会有所帮助的是，如果您能够使 A 的 func1 成为纯虚拟的。不过，这在您的实际程序中可能不可行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-30T07:33:49.627

Easy solve

```
class A
{
  virtual void func1();
}

class B : public A
{
}

class C : public A
{
  virtual void func1();
}

class D : public B, public C
{
  virtual void func1()
  {
    C::func1(); 
  }
}

int main()
{
  D d;
  d.func1(); // Causes warning
} 
```

# regex - RegEx(?) - 如何从文本中解析邮政编码？

> ID：469515
> 
> 赞同：1
> 
> 时间：2009-01-22T15:14:24.310
> 
> 标签：regex, zipcode

我有一个包含城市、州和邮政编码的文件。例子：

> 芒森 11010 Shelter Island Heights。. . .. 11965 布伦特伍德 11717 硬卤石 11743

我需要从该文本中获取所有邮政编码。它们只有 5 位数字（没有 5+4），除了拉链之外没有其他数字。这似乎是一个非常简单的正则表达式，但我根本不知道如何表达。

如果可能的话，我知道一些 PHP，所以这是我的首选语言。理想情况下，我希望它显示输出 1-zip-per-line，以便我可以复制/粘贴到 Excel 之类的文件中。

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T15:18:28.623

```
preg_match_all('[^0-9]([0-9]{5})[^0-9]', $input, $out);
foreach($out as $val)
    echo $val[1] . "\n"; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T15:21:02.050

以下代码应该向您发送正确的方向：

```
<?php
$str = 'Munson 11010 Shelter Island Heights. . . .. 11965 Brentwood 11717 Halesite 11743 ';

preg_match_all("/\d{5}/", $str, $matches);

print_r($matches);
?> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:33:47.190

伟大的！非常感谢 - 这是我最终使用的：

```
preg_match_all("/\d{5}/", $input, $matches);

foreach($matches[0] as $zip){
    echo $zip.'<br/>';
    }; 
```

# sql-server-2005 - 删除 SQL Server 2005 全文索引中的干扰词

> ID：469516
> 
> 赞同：3
> 
> 时间：2009-01-22T15:14:26.947
> 
> 标签：sql-server-2005, full-text-search

在一个非常典型的场景中，我的 Web 应用程序上有一个“搜索”文本框，该文本框将用户输入直接传递给存储过程，然后使用全文索引搜索两个表中的两个字段，这些字段使用适当的键连接。

我正在使用 CONTAINS 谓词来搜索字段。在传递搜索字符串之前，我执行以下操作：

```
SET @ftQuery = '"' + REPLACE(@query,' ', '*" OR "') + '*"' 
```

*例如，将城堡*更改为*"the*" OR "castle*"*。这是必要的，因为我希望人们能够搜索*cas*并获得*castle*的结果。

```
WHERE CONTAINS(Building.Name, @ftQuery) OR CONTAINS(Road.Name, @ftQuery) 
```

问题是，既然我已经在每个单词的末尾附加了一个通配符，干扰词（例如*the*）也附加了一个通配符，因此似乎不再被丢弃。这意味着搜索*城堡*将返回带有诸如*剧院*等单词的项目。

将 OR 更改为 AND 是我的第一个想法，但如果随后在查询中使用干扰词，这似乎只是不返回任何匹配项。

我想要实现的只是允许用户输入多个空格分隔的单词，这些单词代表他们正在搜索的单词的全部或前缀，以任何顺序 - 并从他们的输入中删除诸如*the 之*类的噪声词（否则当他们搜索*城堡*时，他们会得到一个很大的项目列表，他们需要的结果位于列表中间的某个位置。

我可以继续实现我自己的噪声词去除程序，但这似乎是全文索引应该能够处理的事情。

感谢您的帮助！

杰米

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-28T17:46:42.713

在存储索引之前去除噪声词。因此，不可能编写一个搜索停用词的查询。如果您真的想要启用此行为，则需要编辑停用词列表。( [http://msdn.microsoft.com/en-us/library/ms142551.aspx](http://msdn.microsoft.com/en-us/library/ms142551.aspx) ) 然后重新构建索引。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T00:12:39.790

我有同样的问题，经过彻底的搜索，我得出的结论是没有好的解决方案。

作为妥协，我正在实施蛮力解决方案：

1) 打开 C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\FTData\noiseENU.txt 并复制其中的所有文本。

2）粘贴到应用程序的代码文件中，用“，”替换换行符以获得这样的列表初始化程序：

```
public static List<string> _noiseWords = new List<string>{ "about", "1", "after", "2", "all", "also", "3", "an", "4", "and", "5", "another", "6", "any", "7", "are", "8", "as", "9", "at", "0", "be", "$", "because", "been", "before", "being", "between", "both", "but", "by", "came", "can", "come", "could", "did", "do", "does", "each", "else", "for", "from", "get", "got", "has", "had", "he", "have", "her", "here", "him", "himself", "his", "how", "if", "in", "into", "is", "it", "its", "just", "like", "make", "many", "me", "might", "more", "most", "much", "must", "my", "never", "no", "now", "of", "on", "only", "or", "other", "our", "out", "over", "re", "said", "same", "see", "should", "since", "so", "some", "still", "such", "take", "than", "that", "the", "their", "them", "then", "there", "these", "they", "this", "those", "through", "to", "too", "under", "up", "use", "very", "want", "was", "way", "we", "well", "were", "what", "when", "where", "which", "while", "who", "will", "with", "would", "you", "your", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z" }; 
```

3）在提交搜索字符串之前，将其分解为单词并删除噪声单词中的任何单词，如下所示：

```
List<string> goodWords = new List<string>();
string[] words = searchString.Split(' ');
foreach (string word in words)
{
   if (!_noiseWords.Contains(word))
      goodWords.Add(word);
} 
```

不是一个理想的解决方案，但只要干扰词文件不改变就应该可以工作。多语言支持将使用按语言列出的字典。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-22T22:10:53.073

这是一个工作函数。该文件`noiseENU.txt`按原样从`\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\FTData`.

```
 Public Function StripNoiseWords(ByVal s As String) As String
        Dim NoiseWords As String = ReadFile("/Standard/Core/Config/noiseENU.txt").Trim
        Dim NoiseWordsRegex As String = Regex.Replace(NoiseWords, "\s+", "|") ' about|after|all|also etc.
        NoiseWordsRegex = String.Format("\s?\b(?:{0})\b\s?", NoiseWordsRegex)
        Dim Result As String = Regex.Replace(s, NoiseWordsRegex, " ", RegexOptions.IgnoreCase) ' replace each noise word with a space
        Result = Regex.Replace(Result, "\s+", " ") ' eliminate any multiple spaces
        Return Result
    End Function 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-25T10:26:20.187

您还可以在进行查询之前删除干扰词。语言 ID 列表：http: [//msdn.microsoft.com/en-us/library/ms190303.aspx](http://msdn.microsoft.com/en-us/library/ms190303.aspx)

将 queryTextWithoutNoise 调暗为 String = removeNoiseWords(queryText, ConnectionString, 1033)

公共函数 removeNoiseWords(ByVal inputText As String, ByVal cnStr As String, ByVal languageID As Integer) As String

```
 Dim r As New System.Text.StringBuilder
    Try
        If inputText.Contains(CChar("""")) Then
            r.Append(inputText)
        Else
            Using cn As New SqlConnection(cnStr)

                Const q As String = "SELECT display_term,special_term FROM sys.dm_fts_parser(@q,@l,0,0)"
                cn.Open()
                Dim cmd As New SqlCommand(q, cn)
                With cmd.Parameters
                    .Add(New SqlParameter("@q", """" & inputText & """"))
                    .Add(New SqlParameter("@l", languageID))
                End With
                Dim dr As SqlDataReader = cmd.ExecuteReader
                While dr.Read
                    If Not (dr.Item("special_term").ToString.Contains("Noise")) Then
                        r.Append(dr.Item("display_term").ToString)
                        r.Append(" ")
                    End If
                End While
            End Using
        End If
    Catch ex As Exception
        ' ...        
    End Try
    Return r.ToString

End Function 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-04T14:43:09.157

类似于我的方法。

虽然我希望使用全文索引来执行词干提取、速度和多词搜索等，但实际上我只在两个表中索引了几个 nvarchar(100) 字段。每个表很容易保持在 50,000 行以下。

我的解决方案是从文本文件中删除所有干扰词，并允许索引器编译包含所有词的索引。它仍然只包含几千个条目。

然后，我按照我的原始帖子中的描述对搜索字符串中的空格进行替换，以使 CONTAINS 能够处理多个单词，并分别对单词进行词干处理。

似乎工作得很好，但我会密切关注性能。

# assembly - x86: ZF 不总是由 AND 更新？

> ID：469542
> 
> 赞同：7
> 
> 时间：2009-01-22T15:19:18.170
> 
> 标签：assembly, x86

我正在 x86 上调试我的代码，如果结果不为零，则问题可以追溯到 AND 指令有时不会清除 ZF 标志。这是有问题的代码段：

```
0257A9F9 mov edx,dword ptr [ecx+18h]
0257A9FC 和 edx,80000h
0257AA02 整数 3    
0257AA03 0257AA2A

```

我在 AND 之后添加了一个断点进行调试。当它在断点 EDX==0x80000 和 ZF==1 处停止时。但是如果 EDX!=0，ZF 应该被清除。该代码在调试器中单步运行时运行良好，但在正常运行期间始终失败。

这是调试器会话的[屏幕截图](http://picasaweb.google.com/dayawaska/Hidden?authkey=3IsqnLvGcq0&feat=directlink#5294113850486026818)。

有什么提示吗？

如果这很重要，代码是由 JIT 生成的，所以我正在执行数据。

先感谢您。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T15:45:23.063

感谢大家。是我的错，打扰你了。从另一个地方到“int 3”有一个分支。这就是标志与“int 3”之前的指令不一致的原因。在这一点上总是有 edx==0x80000 让我感到困惑。再次抱歉。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T15:27:34.410

您可以轻松地检查 int 3 处理程序以查看它是否返回`iret`（即弹出调用者标志）或是否返回`retf 2`（即保留来自处理程序的标志）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T15:23:25.900

根据 Intel 指令集参考，ZF 总是根据结果设置。int 3 处理程序中的某些东西可以操纵这个吗？

编辑：在进一步挖掘手册之后（感谢上帝让英特尔发送了免费副本！），我唯一的想法是它要么是 int 3 处理程序以某种方式设置它，要么是处理器在设置标志时只查看 dx 而不是 edx。两者似乎都不太可能，但后者似乎完全不可信。你在什么模式下运行？（真实的、受保护的、不真实的、长的？）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T15:30:06.697

可能是您的调试器正在做一些特殊的事情，例如同步内存和寄存器。当您在没有调试器的情况下运行它时，您会说它失败了吗？

# vb.net - 记住最近输入的值并可以自动完成的组合框

> ID：469548
> 
> 赞同：1
> 
> 时间：2009-01-22T15:20:36.217
> 
> 标签：vb.net, combobox, autocomplete

我正在 VB.NET 中开发桌面搜索引擎我正在使用 ComboBox 来指定搜索查询（字符串）。我希望 ComboBox 记住并显示最近的查询。我还希望 ComboBox 在用户键入时尝试自动完成查询。

实现这一点的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T16:08:32.063

毫无疑问，这可以做得更优雅，但这是基本原则（对任何语法问题表示歉意，我不是一个 VB 人）：

在 KeyUp 事件中：

1.  确保键不是导航键：

    ```
    如果 e.KeyCode <> Keys.Back [...]

    ```

2.  在项目列表中搜索键入的文本：

    ```
    idx = myCombo.FindString(myCombo.Text)

    ```

3.  拿组合的找到的项目：

    ```
    s = myCombo.GetItemText(idx) 

    ```

4.  将其插入 .Text 属性：

    ```
    myCombo.Text = s

    ```

请注意，这将覆盖用户输入的所有内容（破坏案例）。您可以通过附加“缺失”部分来改进这一点：

```
stringToAppend = s.SubString(myCombo.Text.Length)
myCombo.Text = myCombo.Text + stringToAppend

```

最后，选择新文本，以便他们继续输入：

```
myCombo.SelectionStart = myCombo.Text.Length - stringToAppend.Length
myCombo.SelectionLength = stringToAppend.Length

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T19:22:10.593

您可能还想从 vbAccelerator.com中查看[此内容，它是 VB.NET 中自动完成的基本起点。](http://www.vbaccelerator.com/home/net/Code/Controls/ListBox_and_ComboBox/Reusing_the_Combo_Dropdown/article.asp)vbAccelerator 代码通常质量很高。

# build-process - 对于小型项目，持续集成值得吗？

> ID：469551
> 
> 赞同：19
> 
> 时间：2009-01-22T15:21:44.983
> 
> 标签：build-process, continuous-integration, build-automation, methodology

自从我 5 个月前加入公司以来，我一直在推动持续集成，但是在看到我们工作的应用程序类型后，我开始认为为每个项目都设置工作可能不值得持续集成。

如果您在开发部门工作，平均项目需要 2-3 周，并且一旦部署，您很少需要担心，那么持续集成是否值得设置它的麻烦？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-22T15:27:34.783

可能取决于你的过程。如果您有涵盖代码的单元测试，那么持续集成是值得的。我假设你们都在一个工作模块上工作，因为这些项目需要 2-3 周。

我不认为人们会为他们的每一个提交运行每一个测试，并且持续集成在这里有很大帮助。

另一个原因是您的项目是否高度模块化。我曾在有很多模块的系统中工作过，开发人员在提交之前不会对整个网站进行功能测试。事情甚至可能无法正确编译，因为开发人员没有检查完整的代码，甚至无法构建其他模块。

无论如何，我建议持续集成。使用像 Hudson 和 Cruisecontrol 这样的设置，它不需要很多时间来设置并很快收回成本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T15:34:25.817

就个人而言，我认为 CI 及其鼓励的各种流程总是有用的。一旦你自己设置了服务器，获得 CI 设置就相当简单了。你基本上只是从一个项目中复制一个配置文件，编辑它，然后创建一个新项目。由于“设置每个项目的努力”，我不会使用 CI。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T15:28:33.423

持续集成不仅仅是一个工具的问题，也是一套流程（定期提交，有一个版本控制系统......）。

关于 IC 软件，您可以在不到 10 分钟的时间内安装、配置并开始使用[Hudson ！](http://hudson-ci.org/)那么，为什么你会不使用任何 IC 系统呢？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-16T19:23:42.347

这实际上取决于您可以多快地设置自动构建，然后将其连接到 CI 服务器。

**。网**

我已经看到我们使用 UppercuT 在几分钟内从没有自动构建到项目的自动化构建。我们使用它和 CruiseControl.NET（在配置中，我们为每个项目添加一行 b/c 我们利用预处理器）。

[http://code.google.com/p/uppercut/](http://code.google.com/p/uppercut/)

这里有一些很好的解释：[Uppercut](http://ferventcoder.com/category/uppercut.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T15:35:29.057

如果您的许多应用程序共享任何常见的组件或模块，CI 和测试可能会帮助您发现某些问题。如果它们真的都是扔掉的、自包含的脚本，那么你可能不需要 CI，但这是一个艰难的决定。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T15:35:51.100

正如其他人指出的那样，一旦设置了 CI，然后添加一个新项目就很简单了，所以我会说去吧。您将看到的一个好处是，如果您的任何项目*确实*发生了变化，您已经有了 CI，并且希望您的单元测试准备好进行，这样您就不会得到任何令人讨厌的惊喜！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T13:36:51.003

持续集成不仅确保工作正常，还允许您记录和测试发布过程，就像新开发人员所做的那样。

这确保了客户得到的是经过测试的东西，而不是开发人员从他的硬盘中随便扔掉的东西。

这对于维护目的可能非常重要。

# ado.net - .net 中是否有类似 RDS（远程数据服务）的概念？

> ID：469554
> 
> 赞同：0
> 
> 时间：2009-01-22T15:22:25.700
> 
> 标签：ado.net, ado, rds

.net中有没有像RDS（远程数据服务）这样的概念？？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T15:58:05.220

WCF（Windows 通信基础）.Net Remoting ASP.NET Ajax。

这些是您的选择，其中任何一个都比 RDS 领先一光年。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T16:07:14.407

如果你的意思是VB6的RDS.DataSpace。在 .NET 中，您可以使用 WebServices（基于 http，更类似于 RDS）或 Remoting（基于 tcpip，更类似于 DCOM，没有端口的多个开放）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:34:09.497

看看 ASP.NET AJAX 和脚本服务：

[http://www.asp.net/learn/ajax/tutorial-05-cs.aspx](http://www.asp.net/learn/ajax/tutorial-05-cs.aspx)

浏览器中的 Javascript 调用服务器上的 Web 服务可能是最接近 RDS 的东西。Web 服务不一定必须是 XML Web 服务，您可以使用 JSON 作为替代方案。

# visual-studio - Visual Studio 2008，当我退格而不是空格时，如何设置它以删除选项卡？

> ID：469556
> 
> 赞同：4
> 
> 时间：2009-01-22T15:22:45.853
> 
> 标签：visual-studio, visual-studio-2008, editor, tabs

在 Visual Studio 2008 中，似乎当我在一行上制表时，它会插入 4 个空格或一个制表符，但是 - 当我退格时，它会删除一个制表符，就好像它是 4 个空格，一次一个空格。

我检查了工具中的文本编辑器设置.. 尝试使用空格和使用制表符，似乎都不起作用。

有任何想法吗？

提前致谢。皮特

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-22T15:42:33.023

也许我只是疯了，但如果你想摆脱标签，为什么不按**Shift + Tab而不是退格呢？**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-22T15:29:22.440

啊哈！！嗨罗伯特，这就是我尝试过的。但是，我需要在“所有语言”部分更改此设置，以便它适用于每种类型的页面。

“保持标签”

谢谢皮特

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T15:26:45.550

好吧，当您按下制表符时，它可能不会将制表符转换为空格。选项中有一个设置告诉VS在按下制表符时要插入多少个空格，也许您可​​以将其设置为实际插入制表符，然后退格键会删除制表符。我听说使用空格而不是制表符很常见，这就是我猜它内置在 VS 中的原因。

# vim - vim：希望它只为某些文件类型打开设置

> ID：469564
> 
> 赞同：21
> 
> 时间：2009-01-22T15:24:34.743
> 
> 标签：vim, text-files

我看过[这个](https://stackoverflow.com/questions/158968/changing-vim-indentation-behavior-by-file-type)，但没有太大帮助。可能我没读好。

基本上我想要的是当我打开一个 .txt 文件时的设置：

```
set wrap
set linebreak 
```

开启。我该怎么做呢？

提前致谢。

另外，我用的是XP。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-22T15:28:10.977

我对这个问题的回答仍然适用：

根据 ~/.vimrc 中的文件后缀放置 autocmd 命令

```
autocmd BufRead,BufNewFile   *.txt set wrap linebreak 
```

正如 Luc 所说，您可能更喜欢

```
autocmd BufRead,BufNewFile   *.txt setlocal wrap linebreak 
```

如果您可能同时打开 txt 和非 txt 文件。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-24T00:17:37.023

将其放入 ~/.vim/ftdetect/text.vim （此路径在 Windows 上会略有不同）：

```
autocmd BufRead,BufNewFile *.txt setfiletype text 
```

然后把它放到 ~/.vim/ftplugin/text.vim 中：

```
setlocal wrap
setlocal linebreak 
```

最好只对文件类型执行一次 autocmd，并将其与 vimrc 文件分开。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-25T20:37:32.353

一个很好的解决方案是“之后”目录。你可以为任何你想要的东西添加一个 rc 文件，语法高亮，文件类型等。这些配置在所有其他配置运行之后运行，所以在系统配置之后和你的 .vimrc 之后。因此，您可以在 unix 类型系统上创建一个名为 ~/.vim/after/ftplugin/text.vim 的文件，并在其中添加您想要的两行。它们的选项将为*文本*文件类型设置，但不为其他文件类型设置。对于其他文件类型，您可以在每个目录中拥有不同的文件，例如 perl.vim。

由于您不在 unix 环境中，您需要通过检查 [runtimepath][2] 选项来找到您的 [runtime directory][1]。您将在其中创建“之后”目录和文件。

笔记：

链接对我不起作用，可能是因为锚点：

*   在此处简要提及目录后：http: [//www.vim.org/htmldoc/usr_43.html#43.2](http://www.vim.org/htmldoc/usr_43.html#43.2)
*   运行时目录： http: [//www.vim.org/htmldoc/usr_43.html#your-runtime-dir](http://www.vim.org/htmldoc/usr_43.html#your-runtime-dir)
*   运行时路径： http: [//www.vim.org/htmldoc/options.html#](http://www.vim.org/htmldoc/options.html#) 'runtimepath'

# sharepoint - MOSS FBA 从不要求信用

> ID：469571
> 
> 赞同：0
> 
> 时间：2009-01-22T15:26:47.907
> 
> 标签：sharepoint, iis, moss, forms-authentication

我已经在扩展站点上设置了 FBA，添加了一个用户，验证了中央管理员可以读取用户（人员选择器工作正常）。

问题是无论我尝试什么，我都不会被要求提供凭据，只是得到一个“您无权查看此页面”。我感觉它在 IIS 中有些东西，但我已经添加了我能想到的所有匿名帐户。

如果我将身份验证类型切换回 Windows，它可以正常工作。

我已经阅读了无数的操作指南，我认为我没有错过任何一步，它们都以“你现在应该看到登录页面”结束，但我被拒绝了。

有小费吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T16:17:22.343

我下载了[http://www.microsoft.com/downloads/details.aspx?FamilyID=e90fe777-4a21-4066-bd22-b931f7572e9a&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=e90fe777-4a21-4066-bd22-b931f7572e9a&DisplayLang=en)并在我的网站上运行它，确定有人（@#$@#$）改变了IUSR 密码并且从未记录或更新它现在工作的任何一种方式，我推荐这个工具，因为它在两秒钟内解决了我的问题！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T15:29:35.497

如果这是在 IE 中，请检查 Internet 选项中当前区域的用户身份验证设置（一直在底部）。当设置为使用当前用户 ID 和密码自动登录，而不是提示输入用户名和密码时，就会发生这种情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T19:34:54.567

在 FBA 商店中创建用户是一回事，在 SharePoint 中授予该用户访问权限是另一回事。您是否让用户成为您尝试访问的网站的所有者？

# networking - 在互联网上实现游戏服务器和游戏代理之间通信的最佳方式是什么？

> ID：469585
> 
> 赞同：5
> 
> 时间：2009-01-22T15:29:38.930
> 
> 标签：networking

我计划创建一个网站，为自己编写的游戏代理提供几款游戏。

例如，会有井字游戏（当然还有一些更复杂的游戏）。程序员可以注册他们的代理，并且不时会有锦标赛。游戏服务器将联系注册代理，展示棋盘并请求移动。

我的基本问题是：游戏服务器与代理通信的好方法是什么？

*   无通信：代理的一种特殊脚本语言，可以在服务器本身上提交和解释。这完全避免了这个问题，但如果每个人都可以使用他最喜欢的语言会更有趣。
*   REST：这在一个方向上有点稀疏。
*   肥皂？
*   用 POST 休息？

如果您参加这样的游戏，您希望采用哪种连接方式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T15:46:47.740

我会使用服务器状态支持的 REST 形式，SOAP 太不人道了。如果您使用 REST，人们甚至可以使用 cUrl 制作机器人，因此您将拥有最广泛的受众

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T15:34:37.220

[我使用Twisted](http://twistedmatrix.com/trac/)取得了巨大的成功，并以此为基础开发了我自己的应用程序协议。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:31:18.363

我会使用私有协议，让您可以选择以不同语言实现服务器和客户端。您也可以添加自己喜欢的加密模式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T15:33:18.953

脚本语言绝对是最容易编写的东西。就个人而言，只要您在网站上准确指定协议，并给出格式化消息的示例，任何编写脚本的人都应该能够使用您选择的任何格式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T16:11:14.320

对于 Go，已经有现有的[Go Text Protocol](http://www.lysator.liu.se/~gunnar/gtp/)。我会为其他游戏使用类似的协议。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-22T15:35:01.820

为您的游戏提供一组自定义命令的普通旧 TCP？

# c# - c# 通过 LDAP 针对 Active Directory

> ID：469588
> 
> 赞同：3
> 
> 时间：2009-01-22T15:30:22.063
> 
> 标签：c#, active-directory, ldap

我正在针对 Active Directory 编写一些 c# 代码，并且无休止地尝试让它工作无济于事。以下代码有效，后面的代码无效：

下面的代码使用 "WinNT://" + Environment.MachineName + ",Computer" 进行连接并且工作正常。

```
 DirectoryEntry localMachine = new DirectoryEntry
        ("WinNT://" + Environment.MachineName + ",Computer");

    DirectoryEntry admGroup = localMachine.Children.Find
        ("Administrators", "group");

    object members = admGroup.Invoke("members", null);

    foreach (object groupMember in (IEnumerable)members)
    {
        DirectoryEntry member = new DirectoryEntry(groupMember);
        output.RenderBeginTag("p");
        output.Write(member.Name.ToString());
        output.RenderBeginTag("p");
    }

    base.Render(output); 
```

我现在正在尝试更改线路：

```
"WinNT://" + Environment.MachineName + ",Computer" 
```

到

```
"LDAP://MyDomainControllerName" 
```

但似乎无论我尝试什么值来代替值“MyDomainControllerName”，它都不会起作用。

要获取“MyDomainControllerName”值，我右键单击 MyComputer 并按照其他地方的建议复制计算机名称值，但这不起作用。

* * *

当我尝试使用上面的 LDAP://RootDSE 选项时，会导致以下错误：

位于路径 LDAP://RootDSE 的 Active Directory 对象不是容器

这是您提到的成员方法的问题吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-31T22:18:16.200

是的 - RootDSE 不是一个容器 - 但它包含许多您可以查询的有趣属性 - 例如您的域控制器的名称。

您可以使用如下代码检查这些：

```
DirectoryEntry deRoot = new DirectoryEntry("LDAP://RootDSE");

if (deRoot != null)
{
  Console.WriteLine("Default naming context: " + deRoot.Properties["defaultNamingContext"].Value);
  Console.WriteLine("Server name: " + deRoot.Properties["serverName"].Value);
  Console.WriteLine("DNS host name: " + deRoot.Properties["dnsHostName"].Value);

  Console.WriteLine();
  Console.WriteLine("Additional properties:");
  foreach (string propName in deRoot.Properties.PropertyNames)
    Console.Write(propName + ", ");
  Console.WriteLine();
} 
```

或者省去麻烦，去拿我的 C# 源代码中的“ [Beavertail ADSI 浏览器](http://adsi.mvps.org/adsi/CSharp/beavertail.html)”——详细展示了如何连接到 RootDSE 及其提供的功能。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-22T15:42:18.950

使用 .NET Framework 连接到 AD 时，您可以使用“无服务器”绑定，也可以指定每次都使用的服务器（服务器绑定）。

这是使用两者的示例：

```
// serverless
DirectoryEntry rootConfig = new DirectoryEntry("LDAP://dc=domainname,dc=com");

// server bound
DirectoryEntry rootEntry = new DirectoryEntry("LDAP://domainControllerName/dc=domainName,dc=com"); 
```

我认为您误入歧途的地方是您最后忘记了包含您的域的 FQDN。希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:35:02.273

您需要向它传递一个授权的用户名和密码。
尝试设置：DirectoryEntry.Username 和 DirectoryEntry.Password

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T15:37:00.380

您是否尝试过指定端口号和其他参数？

我们的 ldap 字符串如下所示：LDAP://myserver:1003/cn=admin@xyz.com|1,ou=Members,o=mdhfw2

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T16:26:27.787

看起来您需要获取 LDAP 连接信息。您可以调用 LDAP://RootDSE 来获取信息，如[ASP.NET Wiki](http://wiki.asp.net/page.aspx/462/how-to-query-active-directory-without-hard-coding-the-domain-name/)中所示。

请记住，LDAP 对象没有与 WINNT 对象相同的成员方法和属性，因此不要期望 group.Invoke("members") 和其他函数完全相同。您还应该阅读使用 LDAP的[DirectoryServices 文档。](http://msdn.microsoft.com/en-us/library/system.directoryservices(VS.80).aspx)

# .net - 如何在 winforms 中创建自动 UI 事件跟踪？

> ID：469594
> 
> 赞同：1
> 
> 时间：2009-01-22T15:31:37.583
> 
> 标签：.net, winforms, user-interface, logging, events

我需要使用**现有的 winforms 应用程序**并进入**事件跟踪模式**，希望尽可能减少摩擦。

我希望将用户采取的每一个操作都视为一个简单的堆栈跟踪：

```
MainForm.LaunchThing_Click
ThingWindow.NameInput_Focus
ThingWindow.NameInput_TextChanged
ThingWindow.AddressInput_Focus
ThingWindow.OKButton_Click 
```

等等。

*   如果这是一个 WPF 应用程序，我会做一些事情，比如在 ETW 中过滤所有 WClientInputMessage 类型的事件。
*   我不能简单地转储堆栈跟踪，因为这不会捕获用户之前的操作。
*   我可以将日志记录添加到每个事件中[使用[本讨论](https://stackoverflow.com/questions/35849/what-logging-is-good-logging-for-your-app)中的推荐做法]，但这是一个包含太多事件的现存应用*程序*。另外，我很懒。应该是更好的方法。
*   我无法附加调试器，我希望将这些信息自动附加到来自现场测试用户的错误报告中，因为*[事实证明......]*没有人能准确地记住他们点击的事情的顺序是什么。

所以我想知道是否有人有任何好的技巧，也许使用子类化或反射来锁定 UI 事件。

性能并不是真正的问题。而且，如果我能参与到每个事件中，那就足够了；我可以很容易地将它们过滤到相关的集合中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T16:12:59.590

观察者模式怎么样？创建一个 EventLogger 类，其中包含一组执行日志记录的重载 Log 方法（每个事件方法签名一个）。在应用程序启动时实例化它并订阅每个 UI 事件。

甚至应该可以通过反射自动进行订阅——尽管我认为对于任何大小合理的应用程序，设置它比手动进行订阅更费力。此外，您仍然必须确保您的 EventLogger 类对每个可能的事件处理程序方法签名都有一个 Log 方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T16:09:46.307

您有多少种不同的控制类型？如果您只有少数要跟踪的控件类型，那么将它们子类化并在您的项目上进行查找和替换以将它们更改为您的子类可能是值得的。这应该只需要一两分钟。

在您的子类控件中，您可以覆盖一小部分方法，在调用基本方法之前添加跟踪。

# c++ - C++中静态对象的销毁顺序

> ID：469597
> 
> 赞同：57
> 
> 时间：2009-01-22T15:32:42.090
> 
> 标签：c++, static, destruction

我可以控制静态对象被破坏的顺序吗？有什么方法可以强制执行我想要的订单吗？例如，以某种方式指定我希望某个对象最后被销毁，或者至少在另一个静态对象之后被销毁？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-01-22T15:35:17.890

静态对象以与构造相反的顺序被破坏。而且施工顺序很难控制。您唯一可以确定的是，在同一个编译单元中定义的两个对象将按照定义的顺序构造。其他任何事情或多或少都是随机的。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-01-22T19:49:05.927

对此的其他答案坚持认为这是不可能的。根据规范，他们是对的——但是有*一个*技巧可以让你做到这一点。

只创建一个类或结构的*单个*静态变量，其中包含您通常会创建静态变量的所有其他内容，如下所示：

```
class StaticVariables {
    public:
    StaticVariables(): pvar1(new Var1Type), pvar2(new Var2Type) { };
    ~StaticVariables();

    Var1Type *pvar1;
    Var2Type *pvar2;
};

static StaticVariables svars; 
```

您可以按您需要的任何顺序创建变量，更重要的是，在构造函数和析构函数中以您需要的任何顺序*销毁*`StaticVariables`它们。为了使其完全透明，您也可以创建对变量的静态引用，如下所示：

```
static Var1Type &var1(*svars.var1); 
```

瞧——完全控制。:-) 也就是说，这是额外的工作，通常是不必要的。但是当*有*必要时，了解它是非常有用的。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-01-22T15:46:49.690

静态对象的销毁顺序与它们构造的相反（例如，第一个构造的对象最后销毁），您可以使用条款 47 中描述的技术来控制静态对象的构造顺序，Meyers 的《*Effective C++* 》一书中的“**确保在使用全局对象之前对其进行初始化**” 。

 *> 例如，以某种方式指定我希望某个对象最后被销毁，或者至少在另一个静态对象之后被销毁？

确保它在其他静态对象之前构造。

> 如何控制施工顺序？并非所有的静态都在同一个 dll 中。

我将忽略（为简单起见）它们不在同一个 DLL 中的事实。

我对 Meyers 的第 47 条（长 4 页）的解释如下。假设你的全局是在这样的头文件中定义的......

```
//GlobalA.h
extern GlobalA globalA; //declare a global 
```

...像这样向该包含文件添加一些代码...

```
//GlobalA.h
extern GlobalA globalA; //declare a global
class InitA
{
  static int refCount;
public:
  InitA();
  ~InitA();
};
static InitA initA; 
```

这样做的效果是任何包含 GlobalA.h 的文件（例如，定义第二个全局变量的 GlobalB.cpp 源文件）都将定义 InitA 类的静态实例，该实例将在该类中的任何其他内容之前构建源文件（例如在你的第二个全局变量之前）。

这个 InitA 类有一个静态引用计数器。当第一个 InitA 实例被构造时，现在保证在你的 GlobalB 实例被构造之前，InitA 构造函数可以做它必须做的任何事情来确保 globalA 实例被初始化。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-01-22T15:36:21.070

简短的回答：一般来说，不会。

稍微长一点的答案：对于单个翻译单元中的全局静态对象，初始化顺序是从上到下，销毁顺序正好相反。几个翻译单元之间的顺序是不确定的。

如果您确实需要特定订单，则需要自己制作。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-05-05T12:42:18.720

在标准 C++ 中没有办法做到这一点，但如果您对特定的编译器内部有很好的工作知识，它可能可以实现。

在 Visual C++ 中，指向静态初始化函数的指针位于`.CRT$XI`段（对于 C 类型静态初始化）或`.CRT$XC`段（对于 C++ 类型静态初始化）。链接器收集所有声明并按字母顺序合并它们。您可以通过使用在适当的段中声明对象来控制静态初始化发生的顺序

```
#pragma init_seg 
```

例如，如果您希望在文件 B 之前创建文件 A 的对象：

文件 A.cpp：

```
#pragma init_seg(".CRT$XCB")
class A{}A; 
```

文件 B.cpp：

```
#pragma init_seg(".CRT$XCC")
class B{}B; 
```

`.CRT$XCB`之前被合并`.CRT$XCC`。当 CRT 遍历静态 init 函数指针时，它将在文件 B 之前遇到文件 A。

在 Watcom 中，段是 XI，#pragma initialize 的变化可以控制构造：

```
#pragma initialize before library
#pragma initialize after library
#pragma initialize before user 
```

...有关更多信息，请参阅文档

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-22T20:31:51.567

阅读：
[SO 初始化顺序](https://stackoverflow.com/questions/211237/c-static-variables-initialisation-order#211307)

[SO解决初始化问题的顺序](https://stackoverflow.com/questions/335369/finding-c-static-initialization-order-problems#335746)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-22T15:35:14.567

不，你不能。您永远不应该依赖静态对象的构造/破坏。

您始终可以使用单例来控制全局资源的构建/销毁顺序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-02-18T10:41:45.583

你真的需要之前初始化变量`main`吗？

如果您不这样做，您可以使用一个简单的习语来轻松地实际控制构造和销毁的顺序，请参见此处：

```
#include <cassert>

class single {
    static single* instance;

public:
    static single& get_instance() {
        assert(instance != 0);
        return *instance;
    }

    single()
    // :  normal constructor here
    {
        assert(instance == 0);
        instance = this;
    }

    ~single() {
        // normal destructor here
        instance = 0;
    }
};
single* single::instance = 0;

int real_main(int argc, char** argv) {
    //real program here...

    //everywhere you need
    single::get_instance();
    return 0;
}

int main(int argc, char** argv) {
    single a;
    // other classes made with the same pattern
    // since they are auto variables the order of construction
    // and destruction is well defined.
    return real_main(argc, argv);
} 
```

它不会阻止您实际尝试创建该类的第二个实例，但如果您这样做，断言将失败。根据我的经验，它工作正常。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-11-25T19:45:01.257

您可以通过使用 a`static std::optional<T>`而不是`T`. 只需像使用变量一样初始化它，使用间接并通过分配`std::nullopt`（或对于 boost, `boost::none`）来销毁它。

它与具有预分配内存的指针不同，我猜这就是您想要的。因此，如果您销毁它并（可能在很久以后）重新创建它，您的对象将具有相同的地址（您可以保留），并且您当时无需支付动态分配/释放的成本。

`boost::optional<T>`如果您没有`std::`/ ，请使用`std::experimental::`。

# c# - 跨会话保留文本字段的.NET 表单？

> ID：469617
> 
> 赞同：1
> 
> 时间：2009-01-22T15:36:20.880
> 
> 标签：c#, .net, winforms, user-interface

它是一个简单的配置应用程序，带有 4 个复选框和 5 个文本框，所有值都必须跨会话保持不变。

我必须序列化字段并手动恢复它们吗？我真的不知道解决这个问题的最佳方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T15:48:26.910

您可以使用**用户设置**，在加载时读取值并在退出时保存。

[您可以在此处](http://msdn.microsoft.com/en-us/library/aa730869(VS.80).aspx)找到有关设置以及如何在运行时检索和保存它的信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T15:59:59.710

如果您正在谈论一个理想的解决方案，您应该考虑使用[MVC](http://en.wikipedia.org/wiki/Model-view-controller)（win forms 不鼓励），以便您关心的所有数据都包含在一个封装的、非 UI 绑定对象（即模型）中。UI 表单从数据中填充自己，当表单被拆除时，应用程序可以检索数据。如果数据对象实现了 ISerializable，那么你就大功告成了。

如果你说的是权宜之计，并且绝对确定它永远不需要增长或改变（这永远不会发生 - 我只在一次性应用程序中这样做），那么我会刮掉表单内容并将它们写入适当的位置（用户设置、数据文件等）。

如果您正在谈论构建一些使这变得尽可能简单的东西，并且永远不必担心它，我会看到使用[数据绑定](http://www.codeproject.com/KB/database/databindingconcepts.aspx)，或者创建一个了解如何映射的映射对象数据从对象到 UI 元素并再次输出（例如，您可以将主要表单元素子类化以包含名称字段或使用初始文本字段来找出在可序列化哈希表中查找的键或可序列化中的属性名称目的）。

# asp.net - 更改 asp.net mvc 框架自动生成的数据库的坏主意？

> ID：469622
> 
> 赞同：0
> 
> 时间：2009-01-22T15:37:16.980
> 
> 标签：asp.net, visual-studio-2008, asp.net-mvc-beta1

将 aa 列添加到自动生成的 asp.net（ASPNETDB.MDF，Visual Studio 2008，mvc 框架）“用户角色 - 数据库”是一个坏主意（如果为什么？）？

（例如，我想将 RealName 和 LastName 列添加到数据库中的 aspnet_Users 表中。）

我想添加一列而不是创建一个完整的新表的原因是为了避免双重维护问题和不必要的冗余

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T15:45:16.260

使用了两种生成方案（来自[Pragmatic Programmer](https://rads.stackoverflow.com/amzn/click/com/020161622X)）：

*   那些用于生成代码的那些
*   那些一直用来同步一些代码的

用于同步的结果不应被修改，因为它们可能会在以后再次完成生成时被覆盖。

对于您生成的 asp.net 数据库，您没有理由重新运行生成，因此可以对其进行编辑。

重新运行 db 生成的唯一情况是，如果 microsoft 发布了新版本的 users 数据库并且您想使用新版本（在这种情况下，您可能需要编辑应用程序的某些部分，因此您可以读取这两个字段），或者如果您想使用不同的选项重新生成数据库。如果您对当前的数据库不满意，这两种情况都会发生。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T15:41:11.607

在我看来，自动生成的数据库应该被应用程序数据库中的普通表替换，或者至少应该有一个官方的解决方案来解决这个问题。

我听说这是一个很好的解决方案：[http ://www.asp.net/downloads/sandbox/table-profile-provider-samples/](http://www.asp.net/downloads/sandbox/table-profile-provider-samples/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:43:24.440

你为什么不创建一个带有外键约束的新表？向 aspnetdb 添加一列似乎是个坏主意……如果您需要重新创建数据库，那将是一场噩梦……

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T15:48:55.800

首先，这些表并不是 MVC 所特有的：它们是由默认的 AspNetSqlMembershipProvider 创建的/为默认的[AspNetSqlMembershipProvider](http://msdn.microsoft.com/en-us/library/system.web.security.sqlmembershipprovider.aspx)创建的。（也适用于其他类型的 ASP.NET 应用程序。）

您可能可以安全地添加新列，但成员资格提供者不会“看到”它们。它确实提供了它的配置文件机制来存储额外的信息（这些信息被序列化并存储在 aspnet_Profiles 表中）。

如果您需要存储有关用户的大量附加信息，您还可以查看[此示例成员资格提供程序](http://www.asp.net/downloads/sandbox/table-profile-provider-samples/)，它将个人资料信息存储在一流的表中，而不是存储在个人资料 blob 中。

# c++ - WAV 压缩帮助

> ID：469628
> 
> 赞同：2
> 
> 时间：2009-01-22T15:40:27.050
> 
> 标签：c++, audio, compression, format, wav

如何以编程方式将 WAV 文件压缩为另一种格式（PCM、11,025 KHz 采样率等）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T15:48:22.277

我会考虑大胆...我很确定他们没有可以做到这一点的命令行实用程序，但他们可能有一个库...

更新：

看起来他们使用的是在 LGPL 下发布的[libsndfile 。](http://www.mega-nerd.com/libsndfile/)我是一个，可能会尝试使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T16:26:53.743

Use [sox](http://sox.sourceforge.net/) (Sound eXchange : universal sound sample translator) in Linux: SoX is a command line program that can convert most popular audio files to most other popular audio file formats. It can optionally change the audio sample data type and apply one or more sound effects to the file during this translation.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T22:09:58.077

在 Windows 中，您可以使用音频压缩管理器在文件之间进行转换（acm... 函数）。您还需要 WAVEFORMAT 结构和 WAV 文件格式的工作知识。不幸的是，自己编写所有这些需要一些时间，这就是为什么研究其他人建议的一些开源选项可能是个好主意。

我编写了一个我自己的开源 .NET 音频库，名为[NAudio](http://www.codeplex.com/naudio)，它可以利用安装在您机器上的 ACM 编解码器将 WAV 文件从一种格式转换为另一种格式。我知道你已经用 C++ 标记了这个问题，但是如果 .NET 是可以接受的，那么这可能会为你节省一些时间。查看 NAudioDemo 项目以获取转换文件的示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T16:27:31.667

If you mean how do you compress the PCM data to a different audio format then there are a variety of libraries you can use to do this, depending on the platform(s) that you want to support. If you just want to change the sample rate of the PCM data then you need a sample rate conversion algorithm instead, which is a completely different problem. Can you be more specific in your requirements?

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T18:13:40.800

你问的是*resampling*，更具体地说是**downsampling**，而不是压缩。虽然这两个过程都是有损的（意味着您将遭受信息丢失），但下采样适用于原始样本而不是频域。

如果您对压缩感兴趣，那么您应该查看 lame 或 OGG vorbis 库；您无疑熟悉 MP3 和 OGG 技术，尽管我从您的问题中感觉到您有兴趣以较低的采样率取回 PCM 文件。

在这种情况下，您需要一个重采样库，其中有一些可能性。最广为人知的是[libsamplerate](http://www.mega-nerd.com/SRC/)，老实说，我不推荐它，因为不仅在生成的音频文件中存在质量问题，而且在库本身中使用的代码的稳定性也是如此。正如其他一些人提到的那样，另一种非商业可能性是[sox 。](http://sox.sourceforge.net/)根据程序的性质，您可以将 sox 作为单独的进程执行，也可以通过将其用作库从自己的代码中调用它。我个人没有尝试过这种方法，但我现在正在开发一个使用 sox 的产品（实际上是用于上采样），我们对结果非常满意。

另一种选择是编写自己的采样率转换库，这可能是一项重大任务，**但是**，如果您只对使用整数因子进行转换（即从 44.1kHz 到 22kHz，或从 44.1kHz 到 11kHz）感兴趣，那么它实际上非常容易，因为您只需要去除每第 N 个样本。

# jquery - jQuery 最大日期选择器数量

> ID：469629
> 
> 赞同：2
> 
> 时间：2009-01-22T15:40:51.060
> 
> 标签：jquery, datepicker

我有一个相当令人沮丧的问题，其中一页上可用的 DatePicker 的最大数量似乎是 20。我找不到任何与此相关的文档。

如果我有一个包含 100 个文本框的页面，并执行以下操作：

```
$(document).ready(function() {
    $(".datepicker").datepicker({ duration: '', dateFormat: 'dd/mm/yy' });
}); 
```

然后前 20 个文本框有 DatePicker，但是，当您选择一个输入框之后，DatePicker 会针对日期的第二十个输入框弹出。

这是在 IE7 下完成的。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T15:58:37.420

我在 Ubuntu 上的 Firefox 3 下测试了以下代码，所有文本框都有一个与之关联的 DatePicker。恕我直言，不应该有任何限制。你能在你的设置上测试我的代码，看看它是否有效吗？

```
<html>
<head>
<script type='text/javascript' src='jquery.js'></script>
<script type='text/javascript' src='date.js'></script>
<script type='text/javascript' src='jquery.datePicker.js'></script>
<link rel='stylesheet' type='text/css' href='datePicker.css' />
</head>
<body>
<form>
<input type='text' class='asdf' name='test1' id='text1' />
<input type='text' class='asdf' name='test2' id='text2' />
<input type='text' class='asdf' name='test3' id='text3' />
<input type='text' class='asdf' name='test4' id='text4' />
<input type='text' class='asdf' name='test5' id='text5' />
<input type='text' class='asdf' name='test6' id='text6' />
<input type='text' class='asdf' name='test7' id='text7' />
<input type='text' class='asdf' name='test8' id='text8' />
<input type='text' class='asdf' name='test9' id='text9' />
<input type='text' class='asdf' name='test10' id='text10' />
<input type='text' class='asdf' name='test11' id='text11' />
<input type='text' class='asdf' name='test12' id='text12' />
<input type='text' class='asdf' name='test13' id='text13' />
<input type='text' class='asdf' name='test14' id='text14' />
<input type='text' class='asdf' name='test15' id='text15' />
<input type='text' class='asdf' name='test16' id='text16' />
<input type='text' class='asdf' name='test17' id='text17' />
<input type='text' class='asdf' name='test18' id='text18' />
<input type='text' class='asdf' name='test19' id='text19' />
<input type='text' class='asdf' name='test20' id='text20' />
<input type='text' class='asdf' name='test21' id='text21' />
<input type='text' class='asdf' name='test22' id='text22' />
</form>
<script type="text/javascript">

$(document).ready(function() {
    $(".asdf").datePicker({ duration: '', dateFormat: 'dd/mm/yy' });
});

</script>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T11:50:57.730

该代码受 NDA 约束（不像在秘密服务 NDA 中那样，因为它是与工作相关的 NDA ;)）所以我不能显示实际代码，但是我可以说它是自动生成的 XSLT 页面的一部分田野。

我有这样的输入

```
<input class="datepicker" name="{UNIQUE}-date" type="text" />
<a href="javascript:MyFunctionCall('linktype', '{UNIQUE}')">go</a> 
```

这样，在提交表单时，一旦我使用“-date”标识符对其进行后期修复，我就知道唯一字段，并且可以从 HTML 输入字段中获取数据。MyFunctionCall 只提交两个表单值，这样在我的代码中我可以检查“linktype”的表单值，这样我就知道如何处理该表单提交。在同一个表单中区分不同*类型*的表单提交是一个小技巧。

如前所示：

```
$(document).ready(function() {
  $(".datepicker").datepicker({ duration: '', dateFormat: 'dd/mm/yy' });
}); 
```

这样它就可以获取所有具有该类类型的输入。

**编辑**正如我所说，这针对许多领域，总共大约 100 个。

# jquery - jquery追加到列表的前面/顶部

> ID：469640
> 
> 赞同：110
> 
> 时间：2009-01-22T15:43:12.973
> 
> 标签：jquery

我有这个无序列表

```
<ul>
   <li>two</li>
   <li>three</li>
</ul> 
```

有没有办法可以在无序列表前面加上这样的结果？

```
<ul>
   <li>ONE</li>
   <li>two</li>
   <li>three</li>
</ul> 
```

请注意，“ONE”被添加到列表的 FRONT/TOP 中。

* * *

## 回答 #1

> 赞同：258
> 
> 时间：2009-01-22T15:45:58.397

```
$("ul").prepend("<li>ONE</li>"); 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-01-22T15:46:48.990

像这样简单的东西应该可以工作：

```
$("ul").prepend("<li>ONE</li>");
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-07-04T09:22:50.983

使用 append 的 prepend instread

```
<h2>Greetings</h2>    
<div class="container">
<div class="inner">Hello</div>
<div class="inner">Goodbye</div>
</div>

$('.container').prepend('<p>Test</p>'); 
```

请参阅[http://api.jquery.com/prepend/](http://api.jquery.com/prepend/)了解更多信息。

# sql - 任何 SQL 数据库：什么时候获取整个表而不是查询特定行更好？

> ID：469647
> 
> 赞同：3
> 
> 时间：2009-01-22T15:44:59.867
> 
> 标签：sql, database

我有一个可能包含 10k 到 100k 行的表，我需要最多 1 或 2000 行的不同集合，但通常足够少。我希望这些查询尽可能快，我想知道哪种方法通常更聪明：

1.  始终使用始终不同的 WHERE 子句准确查询我需要的行。
2.  将整个表加载到我的应用程序内存中的缓存中并在那里搜索，定期同步缓存
3.  始终查询整个表（没有 WHERE 子句），让 SQL 服务器处理缓存（它始终是同一个查询，因此它可以缓存结果）并根据需要过滤输出

我现在想对特定的数据库引擎不可知论。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-22T15:48:40.747

有 10K 到 100K 行，1 号对我来说是明显的赢家。如果它小于 1K，我可能会说将其缓存在应用程序中，但是对于这么多行，让数据库执行它的设计目的。使用适当的索引，1 号将是最好的选择。

如果您每次都在提取相同的数据集，那么缓存结果也可能是一个更好的选择，但是当您一直有不同的位置时，最好让数据库来处理它。

就像我说的那样，只要确保您在所有适当的字段上都建立了良好的索引。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-22T15:49:07.673

在我看来，一个*专*为快速搜索、切片和切割信息而设计的系统将比普通开发人员的代码快得多。另一方面，您未提及的一些因素包括数据库服务器相对于应用程序的位置或潜在位置 - 通过较慢的网络返回大型数据集肯定会倾斜天平，有利于“抓住一切并本地搜索”选项。我认为，在“一般”情况下，我建议查询您想要的内容，但在特殊情况下，其他选项可能会更好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-22T15:48:43.197

我坚信在初始情况下应该首选选项 1。当您遇到性能问题时，您可以查看如何使用缓存对其进行优化。（预优化是万恶之源，Dijkstra 曾经说过）。

另外，请记住，如果您选择选项 3，您还将通过网络发送完整的表格内容。这对性能也有影响。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T15:47:55.227

根据我的经验，最好查询您想要的内容，然后让数据库找出最好的方法。您可以检查查询计划以查看是否有任何瓶颈也可以通过索引得到帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-22T16:10:09.363

首先，让我们忽略#2。搜索表是数据服务器存在的原因，而且它们几乎肯定会比您制作的任何临时搜索做得更好。

对于＃3，您只需说“根据需要过滤输出”而不说明过滤器的完成位置。如果它在＃2中的应用程序代码中，那么与＃2一样，您将遇到与＃2相同的问题.

数据库是专门为处理这个确切的问题而创建的。他们非常擅长。让他们去做。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-22T16:09:49.130

使用选项 1 以外的任何内容的*唯一*`WHERE`原因是子句本身是否很大（即，如果您的`WHERE`子句单独标识每一行，例如`WHERE id = 3 or id = 4 or id = 32 or ...`）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-22T16:13:34.287

还有什么改变你的数据吗？让 SQL 引擎以最佳方式切分和切块的观点很好。但是，如果您正在使用数据库并且没有“其他人”更改数据的可能性，那将是令人惊讶的。如果可以在其他地方进行更改，您当然希望经常重新查询。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-24T05:46:37.437

相信 SQL 服务器在缓存和过滤方面的表现会比你自己负担得起的要好（除非性能测试表明不是这样。）

请注意，我说的是“负担得起”，而不仅仅是“做”。您可能会做得更好，但您（大概）获得报酬是为了提供功能而不是缓存。

问问自己……花时间编写缓存管理代码是否有助于您完成需求文档？

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-01-22T16:05:18.810

如果你这样做：

```
SELECT * FROM users; 
```

mysql 应该执行两个查询：一个是知道表中的字段，另一个是带回您要求的数据。

正在做

```
SELECT id, email, password FROM users; 
```

mysql 只访问数据，因为字段是显式的。

关于限制：总是最好查询您需要的行数，不多不少。更多数据意味着更多时间来驱动它

# java - String.lastIndexOf() 字符和具有单个字符的字符串之间有区别吗？

> ID：469657
> 
> 赞同：5
> 
> 时间：2009-01-22T15:47:33.450
> 
> 标签：java, performance, optimization

只是想知道是否有人知道执行以下操作是否有很大不同：

```
String wibble = "<blah> blah blah </blah>.... <wibble> blah wibble blah </wibble> some more test here";

int i = wibble.lastIndexOf(">");
int j = wibble.lastIndexOf('>'); 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-22T16:16:42.610

意见很好，但数据更好。我写了一个快速基准：

## 测试代码

```
public static void main(String[] args)
{
  System.out.println("Starting perfo test");

  final long NUM_TESTS = 100000000L;

  String wibble = "<blah> blah blah </blah>.... <wibble>"
                + " blah wibble blah </wibble> some more test here";
  int x = -1;
  Stopwatch sw = new Stopwatch();

  System.out.println("--perfo test with " + NUM_TESTS + " iterations--");

  sw.start();
  for(long i = 0; i < NUM_TESTS; i++)
    x = wibble.lastIndexOf(">");
  sw.stop();
  System.out.println("String first pass: " + sw + " seconds");

  sw.start();
  for(long i = 0; i < NUM_TESTS; i++)
    x = wibble.lastIndexOf('>');
  sw.stop();
  System.out.println("Char first pass: " + sw + " seconds");

  sw.start();
  for(long i = 0; i < NUM_TESTS; i++)
    x = wibble.lastIndexOf('>');
  sw.stop();
  System.out.println("Char second pass: " + sw + " seconds");

  sw.start();
  for(long i = 0; i < NUM_TESTS; i++)
    x = wibble.lastIndexOf(">");
  sw.stop();
  System.out.println("String second pass: " + sw + " seconds");

  //Compiler warning said x was never read locally.. this is to
  //ensure the compiler doesn't optimize "x" away..
  System.out.println(x); 
} 
```

## 输出

```
开始性能测试
--perfo 测试 100000000 次迭代--
字符串第一遍：8.750 秒
Char第一次通过：6.500秒
字符秒传：6.437秒
字符串第二遍：8.610 秒
63
```

## 结论

带有 char 的版本大约快 25%，但两个版本的执行速度都非常快，因此它可能永远不会成为代码中的瓶颈。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-22T15:54:36.897

您实际上可以查看 String 类的源代码。似乎 lastIndex(char) 和 lastIndex(String) 实际上是分开编写的。String 类也应该有开销。所以 char 版本可能会快一点，但我怀疑会有任何显着性能差异的情况。

[http://www.docjar.com/html/api/java/lang/String.java.html](http://www.docjar.com/html/api/java/lang/String.java.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-22T15:49:14.460

在性能方面，可能会有细微差别。对于搜索单个字符，使用`char`而不是`String`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T15:57:13.460

在可读性没有差异的情况下（如本例所示），最好使用仅搜索字符的版本。lastIndexOf 要做的工作更少 - 在列表中查找单个元素比查找子列表更容易*（*这实际上是搜索字符串所要做的）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T15:52:23.033

字符串有额外的开销，无论它的长度是多少（除非你有一个非常聪明的编译器，它可以将单个字符串文字优化为字符常量:)），所以如果你只搜索单个字符串，你应该更喜欢 char 版本人物。这不是一个邪恶的优化，因为它在任何一种方式上都是可读的。

# .net - 使用 WPF 和 ASP.NET MVC 的 SQLite 最佳实践？

> ID：469676
> 
> 赞同：3
> 
> 时间：2009-01-22T15:49:55.863
> 
> 标签：.net, sqlite

在 WPF 和 ASP.NET MVC 中使用 SQLite 的正确方法是什么？

*   在 WPF 中，我在名为 App_Data 的目录中有一个 test.sqlite 文件，但是当我编译并运行它时，它不会将数据库复制到 ../bin/Debug 所以它当然找不到它。但是如果我手动将 test.sqlite 文件复制到 ../bin/Debug 中，那么它可以工作。但这不可能是开发具有可读写的本地数据库的应用程序的方式，对吗？如何将数据库标记为“应用程序的一部分”，以便在编译和运行时将其复制并可以使用？或者这是开发/发布过程的一部分？我在这里缺少什么，我想我在这里有一个网络隐喻，它不适用于 Windows 应用程序的处理方式。

*   在 ASP.MVC 中，我复制了在 WPF 中访问数据库的相同代码，但它在 connection.Open() 行上一直说“无法打开数据库”。我有“../App_Data/test.sqlite”，据我了解，这是访问文件的正确位置。但是，我尝试将文本文件写入“../App_data”并得到 UnauthorizedAccessException”，所以我认为问题是我无权在这里读/写。我该如何更改？

    ```
     private string getData()
    {
        StringBuilder sb = new StringBuilder();
        //string fullPathAndFileName = Server.MapPath("App_Data/testnew.sqlite");
        using (SQLiteConnection conn = 
              new SQLiteConnection(@"Data Source=" + Server.MapPath("App_Data/testnew.sqlite")))
        {
            StringBuilder query = new StringBuilder();
            query.Append("SELECT * ");
            query.Append("FROM members ");
            query.Append("ORDER BY firstName");
            using (SQLiteCommand cmd = new SQLiteCommand(query.ToString(), conn))
            {
                conn.Open();
                using (SQLiteDataReader dr = cmd.ExecuteReader())
                {
                    while (dr.Read())
                    {
                        //Console.WriteLine(dr.GetValue(0) + " " + dr.GetValue(1));  
                        string id = dr.GetValue(0).ToString();
                        string firstName = dr.GetValue(1).ToString();
                        sb.Append(firstName + ", ");

                    }
                }
            }
        }
        return sb.ToString();

    } 
    ```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T15:58:44.457

您可以将 test.sqlite 文件添加到您的 WPF 项目中，并在属性窗口中指定“复制到输出目录”：“始终复制”。这样每次编译项目时，文件都会自动复制到输出目录。

关于您的 UnauthorizedAccessException，您是否尝试为 ASP.Net 服务帐户授予对 App_Data 文件夹的读取和写入权限？要找出用于运行应用程序池的帐户，您可以编写一个简单的 test.aspx 页面：

```
<%@ Page Language="C#" %>
<script runat="server">
  protected override void OnLoad(EventArgs e)
  {
      Response.Write(System.Security.Principal.WindowsIdentity.GetCurrent().Name);
      base.OnLoad(e);
  }
</script> 
```

# reporting-services - 如何在 SSRS 中获取时区值

> ID：469685
> 
> 赞同：2
> 
> 时间：2009-01-22T15:52:26.030
> 
> 标签：reporting-services, timezone

我有 SSRS 报告，每次运行报告时都会显示执行时间。我想在它旁边显示时区值。我怎么得到那个。

谢谢，贾兹

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T18:49:29.197

要获取服务器上的时区，请使用：

```
TimeZone.CurrentTimeZone.StandardName
TimeZone.CurrentTimeZone.GetUtcOffset(Now()).ToString() 
```

# java - 在 Java 中解码 Base64 数据

> ID：469695
> 
> 赞同：517
> 
> 时间：2009-01-22T15:55:18.613
> 
> 标签：java, base64

我有一张经过 Base64 编码的图像。在 Java 中解码的最佳方法是什么？希望只使用 Sun Java 6 中包含的库。

* * *

## 回答 #1

> 赞同：436
> 
> 时间：2013-03-26T20:35:05.810

从**Java 8**开始，有一个官方支持的用于 Base64 编码和解码的 API。随着时间的推移，这可能会成为默认选择。

API 包括类[`java.util.Base64`](http://docs.oracle.com/javase/8/docs/api/java/util/Base64.html)及其嵌套类。它支持三种不同的风格：基本、URL 安全和 MIME。

使用“基本”编码的示例代码：

```
import java.util.Base64;

byte[] bytes = "Hello, World!".getBytes("UTF-8");
String encoded = Base64.getEncoder().encodeToString(bytes);
byte[] decoded = Base64.getDecoder().decode(encoded); 
```

的[文档`java.util.Base64`](http://docs.oracle.com/javase/8/docs/api/java/util/Base64.html)包括更多用于配置编码器和解码器以及使用不同类作为输入和输出（字节数组、字符串、ByteBuffers、java.io 流）的方法。

* * *

## 回答 #2

> 赞同：424
> 
> 时间：2010-01-13T03:42:00.867

从 v6 开始，Java SE 附带 JAXB。[`javax.xml.bind.DatatypeConverter`](http://download.oracle.com/javase/6/docs/api/javax/xml/bind/DatatypeConverter.html)具有使这变得容易的静态方法。见[`parseBase64Binary()`](http://download.oracle.com/javase/6/docs/api/javax/xml/bind/DatatypeConverter.html#parseBase64Binary(java.lang.String))和[`printBase64Binary()`](http://download.oracle.com/javase/6/docs/api/javax/xml/bind/DatatypeConverter.html#printBase64Binary%28byte%5B%5D%29)。

**更新**：JAXB 不再随 Java 一起提供（自 Java 11 起）。如果您的项目需要 JAXB，则需要通过依赖项管理系统（例如 Maven）配置相关库。如果您需要编译器 ( `xjc.exe`)，您还需要单独下载。

* * *

## 回答 #3

> 赞同：104
> 
> 时间：2009-01-22T16:05:37.407

无需使用公共资源——Sun 提供了一个带有 Java 的 base64 编码器。您可以这样导入它：

```
import sun.misc.BASE64Decoder; 
```

然后像这样使用它：

```
BASE64Decoder decoder = new BASE64Decoder();
byte[] decodedBytes = decoder.decodeBuffer(encodedBytes); 
```

`encodedBytes`a`java.lang.String`或 a在哪里`java.io.InputStream`。请注意，`sun.*`Sun 并未“正式支持”这些类。

**编辑：**谁知道这将是我发布过的最具争议的答案？我确实知道 sun.* 软件包不受支持或保证继续存在，而且我确实了解 Commons 并一直使用它。但是，发帖人要求提供一个“包含在 Sun Java 6 中”的类，而这正是我试图回答的问题。我同意 Commons 通常是最好的方法。

**编辑 2：**正如 amir75 在下面指出的那样，Java 6+ 附带 JAXB，其中包含支持的代码来编码/解码 Base64。请参阅下面[的杰里米罗斯的回答](https://stackoverflow.com/a/2054226/33311)。

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2009-01-22T16:01:02.237

特别是在[Commons Codec](http://commons.apache.org/codec/)中：class [`Base64`](http://commons.apache.org/codec/apidocs/org/apache/commons/codec/binary/Base64.html)to `decode(byte[] array)`or`encode(byte[] array)`

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2012-12-17T19:12:03.010

Guava 现在内置了 Base64 解码。

使用[BaseEncoding.base64().decode()](http://google.github.io/guava/releases/snapshot-jre/api/docs/com/google/common/io/BaseEncoding.html)

至于处理输入使用中可能的空白

`BaseEncoding.base64().decode(CharMatcher.WHITESPACE.removeFrom(...));`

有关更多信息，请参阅[此讨论](https://github.com/google/guava/issues/1252)

* * *

## 回答 #6

> 赞同：36
> 
> 时间：2010-11-24T09:57:12.043

我的解决方案是最快和最简单的。

```
public class MyBase64 {

    private final static char[] ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".toCharArray();

    private static int[]  toInt   = new int[128];

    static {
        for(int i=0; i< ALPHABET.length; i++){
            toInt[ALPHABET[i]]= i;
        }
    }

    /**
     * Translates the specified byte array into Base64 string.
     *
     * @param buf the byte array (not null)
     * @return the translated Base64 string (not null)
     */
    public static String encode(byte[] buf){
        int size = buf.length;
        char[] ar = new char[((size + 2) / 3) * 4];
        int a = 0;
        int i=0;
        while(i < size){
            byte b0 = buf[i++];
            byte b1 = (i < size) ? buf[i++] : 0;
            byte b2 = (i < size) ? buf[i++] : 0;

            int mask = 0x3F;
            ar[a++] = ALPHABET[(b0 >> 2) & mask];
            ar[a++] = ALPHABET[((b0 << 4) | ((b1 & 0xFF) >> 4)) & mask];
            ar[a++] = ALPHABET[((b1 << 2) | ((b2 & 0xFF) >> 6)) & mask];
            ar[a++] = ALPHABET[b2 & mask];
        }
        switch(size % 3){
            case 1: ar[--a]  = '=';
            case 2: ar[--a]  = '=';
        }
        return new String(ar);
    }

    /**
     * Translates the specified Base64 string into a byte array.
     *
     * @param s the Base64 string (not null)
     * @return the byte array (not null)
     */
    public static byte[] decode(String s){
        int delta = s.endsWith( "==" ) ? 2 : s.endsWith( "=" ) ? 1 : 0;
        byte[] buffer = new byte[s.length()*3/4 - delta];
        int mask = 0xFF;
        int index = 0;
        for(int i=0; i< s.length(); i+=4){
            int c0 = toInt[s.charAt( i )];
            int c1 = toInt[s.charAt( i + 1)];
            buffer[index++]= (byte)(((c0 << 2) | (c1 >> 4)) & mask);
            if(index >= buffer.length){
                return buffer;
            }
            int c2 = toInt[s.charAt( i + 2)];
            buffer[index++]= (byte)(((c1 << 4) | (c2 >> 2)) & mask);
            if(index >= buffer.length){
                return buffer;
            }
            int c3 = toInt[s.charAt( i + 3 )];
            buffer[index++]= (byte)(((c2 << 6) | c3) & mask);
        }
        return buffer;
    } 

} 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2009-01-23T15:09:46.037

作为非核心库的替代品`sun.misc.BASE64Decoder`或非核心库，请查看`javax.mail.internet.MimeUtility.decode()`.

```
public static byte[] encode(byte[] b) throws Exception {
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    OutputStream b64os = MimeUtility.encode(baos, "base64");
    b64os.write(b);
    b64os.close();
    return baos.toByteArray();
}
public static byte[] decode(byte[] b) throws Exception {
    ByteArrayInputStream bais = new ByteArrayInputStream(b);
    InputStream b64is = MimeUtility.decode(bais, "base64");
    byte[] tmp = new byte[b.length];
    int n = b64is.read(tmp);
    byte[] res = new byte[n];
    System.arraycopy(tmp, 0, res, 0, n);
    return res;
} 
```

链接完整代码：[编码/解码到/从 Base64](http://www.rgagnon.com/javadetails/java-0598.html)

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2012-05-24T10:59:18.090

这是我自己的实现，如果它对某人有用：

```
public class Base64Coder {

    // The line separator string of the operating system.
    private static final String systemLineSeparator = System.getProperty("line.separator");

    // Mapping table from 6-bit nibbles to Base64 characters.
    private static final char[] map1 = new char[64];
       static {
          int i=0;
          for (char c='A'; c<='Z'; c++) map1[i++] = c;
          for (char c='a'; c<='z'; c++) map1[i++] = c;
          for (char c='0'; c<='9'; c++) map1[i++] = c;
          map1[i++] = '+'; map1[i++] = '/'; }

    // Mapping table from Base64 characters to 6-bit nibbles.
    private static final byte[] map2 = new byte[128];
       static {
          for (int i=0; i<map2.length; i++) map2[i] = -1;
          for (int i=0; i<64; i++) map2[map1[i]] = (byte)i; }

    /**
    * Encodes a string into Base64 format.
    * No blanks or line breaks are inserted.
    * @param s  A String to be encoded.
    * @return   A String containing the Base64 encoded data.
    */
    public static String encodeString (String s) {
       return new String(encode(s.getBytes())); }

    /**
    * Encodes a byte array into Base 64 format and breaks the output into lines of 76 characters.
    * This method is compatible with <code>sun.misc.BASE64Encoder.encodeBuffer(byte[])</code>.
    * @param in  An array containing the data bytes to be encoded.
    * @return    A String containing the Base64 encoded data, broken into lines.
    */
    public static String encodeLines (byte[] in) {
       return encodeLines(in, 0, in.length, 76, systemLineSeparator); }

    /**
    * Encodes a byte array into Base 64 format and breaks the output into lines.
    * @param in            An array containing the data bytes to be encoded.
    * @param iOff          Offset of the first byte in <code>in</code> to be processed.
    * @param iLen          Number of bytes to be processed in <code>in</code>, starting at <code>iOff</code>.
    * @param lineLen       Line length for the output data. Should be a multiple of 4.
    * @param lineSeparator The line separator to be used to separate the output lines.
    * @return              A String containing the Base64 encoded data, broken into lines.
    */
    public static String encodeLines (byte[] in, int iOff, int iLen, int lineLen, String lineSeparator) {
       int blockLen = (lineLen*3) / 4;
       if (blockLen <= 0) throw new IllegalArgumentException();
       int lines = (iLen+blockLen-1) / blockLen;
       int bufLen = ((iLen+2)/3)*4 + lines*lineSeparator.length();
       StringBuilder buf = new StringBuilder(bufLen);
       int ip = 0;
       while (ip < iLen) {
          int l = Math.min(iLen-ip, blockLen);
          buf.append (encode(in, iOff+ip, l));
          buf.append (lineSeparator);
          ip += l; }
       return buf.toString(); }

    /**
    * Encodes a byte array into Base64 format.
    * No blanks or line breaks are inserted in the output.
    * @param in  An array containing the data bytes to be encoded.
    * @return    A character array containing the Base64 encoded data.
    */
    public static char[] encode (byte[] in) {
       return encode(in, 0, in.length); }

    /**
    * Encodes a byte array into Base64 format.
    * No blanks or line breaks are inserted in the output.
    * @param in    An array containing the data bytes to be encoded.
    * @param iLen  Number of bytes to process in <code>in</code>.
    * @return      A character array containing the Base64 encoded data.
    */
    public static char[] encode (byte[] in, int iLen) {
       return encode(in, 0, iLen); }

    /**
    * Encodes a byte array into Base64 format.
    * No blanks or line breaks are inserted in the output.
    * @param in    An array containing the data bytes to be encoded.
    * @param iOff  Offset of the first byte in <code>in</code> to be processed.
    * @param iLen  Number of bytes to process in <code>in</code>, starting at <code>iOff</code>.
    * @return      A character array containing the Base64 encoded data.
    */
    public static char[] encode (byte[] in, int iOff, int iLen) {
       int oDataLen = (iLen*4+2)/3;       // output length without padding
       int oLen = ((iLen+2)/3)*4;         // output length including padding
       char[] out = new char[oLen];
       int ip = iOff;
       int iEnd = iOff + iLen;
       int op = 0;
       while (ip < iEnd) {
          int i0 = in[ip++] & 0xff;
          int i1 = ip < iEnd ? in[ip++] & 0xff : 0;
          int i2 = ip < iEnd ? in[ip++] & 0xff : 0;
          int o0 = i0 >>> 2;
          int o1 = ((i0 &   3) << 4) | (i1 >>> 4);
          int o2 = ((i1 & 0xf) << 2) | (i2 >>> 6);
          int o3 = i2 & 0x3F;
          out[op++] = map1[o0];
          out[op++] = map1[o1];
          out[op] = op < oDataLen ? map1[o2] : '='; op++;
          out[op] = op < oDataLen ? map1[o3] : '='; op++; }
       return out; }

    /**
    * Decodes a string from Base64 format.
    * No blanks or line breaks are allowed within the Base64 encoded input data.
    * @param s  A Base64 String to be decoded.
    * @return   A String containing the decoded data.
    * @throws   IllegalArgumentException If the input is not valid Base64 encoded data.
    */
    public static String decodeString (String s) {
       return new String(decode(s)); }

    /**
    * Decodes a byte array from Base64 format and ignores line separators, tabs and blanks.
    * CR, LF, Tab and Space characters are ignored in the input data.
    * This method is compatible with <code>sun.misc.BASE64Decoder.decodeBuffer(String)</code>.
    * @param s  A Base64 String to be decoded.
    * @return   An array containing the decoded data bytes.
    * @throws   IllegalArgumentException If the input is not valid Base64 encoded data.
    */
    public static byte[] decodeLines (String s) {
       char[] buf = new char[s.length()];
       int p = 0;
       for (int ip = 0; ip < s.length(); ip++) {
          char c = s.charAt(ip);
          if (c != ' ' && c != '\r' && c != '\n' && c != '\t')
             buf[p++] = c; }
       return decode(buf, 0, p); }

    /**
    * Decodes a byte array from Base64 format.
    * No blanks or line breaks are allowed within the Base64 encoded input data.
    * @param s  A Base64 String to be decoded.
    * @return   An array containing the decoded data bytes.
    * @throws   IllegalArgumentException If the input is not valid Base64 encoded data.
    */
    public static byte[] decode (String s) {
       return decode(s.toCharArray()); }

    /**
    * Decodes a byte array from Base64 format.
    * No blanks or line breaks are allowed within the Base64 encoded input data.
    * @param in  A character array containing the Base64 encoded data.
    * @return    An array containing the decoded data bytes.
    * @throws    IllegalArgumentException If the input is not valid Base64 encoded data.
    */
    public static byte[] decode (char[] in) {
       return decode(in, 0, in.length); }

    /**
    * Decodes a byte array from Base64 format.
    * No blanks or line breaks are allowed within the Base64 encoded input data.
    * @param in    A character array containing the Base64 encoded data.
    * @param iOff  Offset of the first character in <code>in</code> to be processed.
    * @param iLen  Number of characters to process in <code>in</code>, starting at <code>iOff</code>.
    * @return      An array containing the decoded data bytes.
    * @throws      IllegalArgumentException If the input is not valid Base64 encoded data.
    */
    public static byte[] decode (char[] in, int iOff, int iLen) {
       if (iLen%4 != 0) throw new IllegalArgumentException ("Length of Base64 encoded input string is not a multiple of 4.");
       while (iLen > 0 && in[iOff+iLen-1] == '=') iLen--;
       int oLen = (iLen*3) / 4;
       byte[] out = new byte[oLen];
       int ip = iOff;
       int iEnd = iOff + iLen;
       int op = 0;
       while (ip < iEnd) {
          int i0 = in[ip++];
          int i1 = in[ip++];
          int i2 = ip < iEnd ? in[ip++] : 'A';
          int i3 = ip < iEnd ? in[ip++] : 'A';
          if (i0 > 127 || i1 > 127 || i2 > 127 || i3 > 127)
             throw new IllegalArgumentException ("Illegal character in Base64 encoded data.");
          int b0 = map2[i0];
          int b1 = map2[i1];
          int b2 = map2[i2];
          int b3 = map2[i3];
          if (b0 < 0 || b1 < 0 || b2 < 0 || b3 < 0)
             throw new IllegalArgumentException ("Illegal character in Base64 encoded data.");
          int o0 = ( b0       <<2) | (b1>>>4);
          int o1 = ((b1 & 0xf)<<4) | (b2>>>2);
          int o2 = ((b2 &   3)<<6) |  b3;
          out[op++] = (byte)o0;
          if (op<oLen) out[op++] = (byte)o1;
          if (op<oLen) out[op++] = (byte)o2; }
       return out; }

    // Dummy constructor.
    private Base64Coder() {}
} 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2012-05-22T14:56:40.917

另一个较晚的答案，但我的基准测试表明[Jetty 的 Base64](http://download.eclipse.org/jetty/stable-7/apidocs/org/eclipse/jetty/util/B64Code.html)编码器的实现非常快。不如[MiGBase64](http://migbase64.sourceforge.net/)快，但比[iHarder Base64](http://iharder.sourceforge.net/current/java/base64/)快。

```
import org.eclipse.jetty.util.B64Code;

final String decoded = B64Code.decode(encoded, "UTF-8"); 
```

我还做了一些基准测试：

```
 library     |    encode    |    decode   
------------------+--------------+-------------
 'MiGBase64'      |  10146001.00 |  6426446.00
 'Jetty B64Code'  |   8846191.00 |  3101361.75
 'iHarder Base64' |   3259590.50 |  2505280.00
 'Commons-Codec'  |    241318.04 |   255179.96 
```

这些是运行/秒，所以越高越好。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2015-02-14T10:14:31.057

给定一个[javax.xml.bind.DatatypeConverter的](http://download.oracle.com/javase/6/docs/api/javax/xml/bind/DatatypeConverter.html)**测试**编码/解码示例，使用方法[parseBase64Binary()](http://download.oracle.com/javase/6/docs/api/javax/xml/bind/DatatypeConverter.html#parseBase64Binary%28java.lang.String%29)和[printBase64Binary()](http://download.oracle.com/javase/6/docs/api/javax/xml/bind/DatatypeConverter.html#printBase64Binary%28byte%5B%5D%29)引用 @jeremy-ross 和 @nightfirecat 答案。

```
@Test
public void EncodeDecode() {
    //ENCODE
    String hello = "Hello World";
    byte[] helloBytes = hello.getBytes(StandardCharsets.UTF_8);
    String encodedHello = DatatypeConverter.printBase64Binary(helloBytes);
    LOGGER.info(hello + " encoded=> " + encodedHello);

    //DECODE
    byte[] encodedHelloBytes = DatatypeConverter.parseBase64Binary(encodedHello);
    String helloAgain = new String(encodedHelloBytes, StandardCharsets.UTF_8) ;
    LOGGER.info(encodedHello + " decoded=> " + helloAgain);

    Assert.assertEquals(hello, helloAgain);
} 
```

结果：

```
INFO - Hello World encoded=> SGVsbG8gV29ybGQ=
INFO - SGVsbG8gV29ybGQ= decoded=> Hello World 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2019-06-10T14:54:46.303

使用 Java 8 -

```
 public static String encodeString(String plainString) {
        return  Base64.getEncoder().encodeToString(plainString.getBytes());
    }

    public static String decodeString(String encodedString) {
        byte[] bytes = Base64.getDecoder().decode(encodedString);
        return new String(bytes);
    } 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2012-02-20T15:34:39.043

如果您更喜欢基于性能的解决方案，那么您可以使用“MiGBase64”

[http://migbase64.sourceforge.net/](http://migbase64.sourceforge.net/)

```
public class Base64Test {
    public static void main(String[] args) {
    String encodeToString = Base64.encodeToString("JavaTips.net".getBytes(), true);
    System.out.println("encodeToString " + encodeToString);
    byte[] decodedBytes = Base64.decode(encodeToString.getBytes());
    System.out.println("decodedBytes " + new String(decodedBytes));
    }
} 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2019-10-18T10:58:14.930

你可以简单地试试这个。

```
byte[] data = Base64.getDecoder().decode(base64fileContent); 
```

`Base64.getDecode()`返回一个可以解码的 Base64 解码器。然后你需要使用`.decode(<your base64>)`.

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2011-09-26T05:35:55.317

这是一个**迟到**的答案，但 Joshua Bloch在包`Base64`下完成了他的课程（当他为 Sun、ahem、Oracle 工作时） 。`java.util.prefs`这个类从 JDK 1.4 开始就存在了。

例如

```
String currentString = "Hello World";
String base64String = java.util.prefs.Base64.byteArrayToBase64(currentString.getBytes("UTF-8")); 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-12-05T04:25:55.360

希望这可以帮助你：

```
import com.sun.org.apache.xml.internal.security.utils.Base64;
String str="Hello World";
String base64_str=Base64.encode(str.getBytes("UTF-8")); 
```

或者：

```
String str="Hello World";
String base64_str="";
try
   {base64_str=(String)Class.forName("java.util.prefs.Base64").getDeclaredMethod("byteArrayToBase64", new Class[]{byte[].class}).invoke(null, new Object[]{str.getBytes("UTF-8")});
   }
catch (Exception ee) {} 
```

`java.util.prefs.Base64`在本地工作`rt.jar`，

但它不在[JRE 类白名单中](http://code.google.com/appengine/docs/java/jrewhitelist.html)

并且不在[GAE/J 白名单中未列出的可用类中](http://blog.stringbuffer.com/2009/04/available-classes-in-google-app-enginej.html)

太遗憾了！

PS。在 android 中，这很容易，因为`android.util.Base64`从 Android API Level 8 开始就包含了它。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2015-11-30T09:24:47.610

您可以从编码的 Base64 字符串写入或下载文件：

```
Base64 base64 = new Base64(); 
String encodedFile="JVBERi0xLjUKJeLjz9MKMSAwIG9iago8PCAKICAgL1R5cGUgL0NhdGFsb2cKICAgL1BhZ2VzIDIgMCBSCiAgIC9QYWdlTGF5b3V0IC9TaW5"; 
              byte[] dd=encodedFile.getBytes();
            byte[] bytes = Base64.decodeBase64(dd);

 response.setHeader("Content-disposition", "attachment; filename=\""+filename+"\"");
            response.setHeader("Cache-Control", "no-cache");
            response.setHeader("Expires", "-1");

            // actually send result bytes
            response.getOutputStream().write(bytes); 
```

为我工作，希望也为你工作......

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-06-21T01:05:05.780

Java 8 实现`java.util.Base64`不依赖于其他 Java 8 特定类。

我不确定这是否适用于 Java 6 项目，但可以将`Base64.java`文件复制并粘贴到 Java 7 项目中，并且除了导入 java.util.Arrays 和`java.util.Objects`.

注意 Base64.java 文件被 GNU GPL2 覆盖

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2017-08-23T08:22:52.980

我用`android.util.base64`它工作得很好，没有任何依赖：

*用法：*

```
byte[] decodedKey = Base64.decode(encodedPublicKey, Base64.DEFAULT); 
```

* * *

包 com.test;

```
import java.io.UnsupportedEncodingException;

/**
 * Utilities for encoding and decoding the Base64 representation of
 * binary data.  See RFCs <a
 * href="http://www.ietf.org/rfc/rfc2045.txt">2045</a> and <a
 * href="http://www.ietf.org/rfc/rfc3548.txt">3548</a>.
 */
public class Base64 {

    public static final int DEFAULT = 0;

    public static final int NO_PADDING = 1;

    public static final int NO_WRAP = 2;

    public static final int CRLF = 4;

    public static final int URL_SAFE = 8;

    public static final int NO_CLOSE = 16;

    //  --------------------------------------------------------
    //  shared code
    //  --------------------------------------------------------

    /* package */ static abstract class Coder {
        public byte[] output;
        public int op;

        public abstract boolean process(byte[] input, int offset, int len, boolean finish);

        public abstract int maxOutputSize(int len);
    }

    //  --------------------------------------------------------
    //  decoding
    //  --------------------------------------------------------

    public static byte[] decode(String str, int flags) {
        return decode(str.getBytes(), flags);
    }

    public static byte[] decode(byte[] input, int flags) {
        return decode(input, 0, input.length, flags);
    }

    public static byte[] decode(byte[] input, int offset, int len, int flags) {
        // Allocate space for the most data the input could represent.
        // (It could contain less if it contains whitespace, etc.)
        Decoder decoder = new Decoder(flags, new byte[len*3/4]);

        if (!decoder.process(input, offset, len, true)) {
            throw new IllegalArgumentException("bad base-64");
        }

        // Maybe we got lucky and allocated exactly enough output space.
        if (decoder.op == decoder.output.length) {
            return decoder.output;
        }

        // Need to shorten the array, so allocate a new one of the
        // right size and copy.
        byte[] temp = new byte[decoder.op];
        System.arraycopy(decoder.output, 0, temp, 0, decoder.op);
        return temp;
    }

   static class Decoder extends Coder {       
        private static final int DECODE[] = {
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63,
            52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -2, -1, -1,
            -1,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14,
            15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1,
            -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
            41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
        };

        /**
         * Decode lookup table for the "web safe" variant (RFC 3548
         * sec. 4) where - and _ replace + and /.
         */
        private static final int DECODE_WEBSAFE[] = {
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1,
            52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -2, -1, -1,
            -1,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14,
            15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, 63,
            -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
            41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
            -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
        };

        /** Non-data values in the DECODE arrays. */
        private static final int SKIP = -1;
        private static final int EQUALS = -2;

        private int state;   // state number (0 to 6)
        private int value;

        final private int[] alphabet;

        public Decoder(int flags, byte[] output) {
            this.output = output;

            alphabet = ((flags & URL_SAFE) == 0) ? DECODE : DECODE_WEBSAFE;
            state = 0;
            value = 0;
        }

        public int maxOutputSize(int len) {
            return len * 3/4 + 10;
        }

        /**
         * Decode another block of input data.
         *
         * @return true if the state machine is still healthy.  false if
         *         bad base-64 data has been detected in the input stream.
         */
        public boolean process(byte[] input, int offset, int len, boolean finish) {
            if (this.state == 6) return false;

            int p = offset;
            len += offset;

            int state = this.state;
            int value = this.value;
            int op = 0;
            final byte[] output = this.output;
            final int[] alphabet = this.alphabet;

            while (p < len) {                
                if (state == 0) {
                    while (p+4 <= len &&
                           (value = ((alphabet[input[p] & 0xff] << 18) |
                                     (alphabet[input[p+1] & 0xff] << 12) |
                                     (alphabet[input[p+2] & 0xff] << 6) |
                                     (alphabet[input[p+3] & 0xff]))) >= 0) {
                        output[op+2] = (byte) value;
                        output[op+1] = (byte) (value >> 8);
                        output[op] = (byte) (value >> 16);
                        op += 3;
                        p += 4;
                    }
                    if (p >= len) break;
                }

                int d = alphabet[input[p++] & 0xff];

                switch (state) {
                case 0:
                    if (d >= 0) {
                        value = d;
                        ++state;
                    } else if (d != SKIP) {
                        this.state = 6;
                        return false;
                    }
                    break;

                case 1:
                    if (d >= 0) {
                        value = (value << 6) | d;
                        ++state;
                    } else if (d != SKIP) {
                        this.state = 6;
                        return false;
                    }
                    break;

                case 2:
                    if (d >= 0) {
                        value = (value << 6) | d;
                        ++state;
                    } else if (d == EQUALS) {
                        // Emit the last (partial) output tuple;
                        // expect exactly one more padding character.
                        output[op++] = (byte) (value >> 4);
                        state = 4;
                    } else if (d != SKIP) {
                        this.state = 6;
                        return false;
                    }
                    break;

                case 3:
                    if (d >= 0) {
                        // Emit the output triple and return to state 0.
                        value = (value << 6) | d;
                        output[op+2] = (byte) value;
                        output[op+1] = (byte) (value >> 8);
                        output[op] = (byte) (value >> 16);
                        op += 3;
                        state = 0;
                    } else if (d == EQUALS) {
                        // Emit the last (partial) output tuple;
                        // expect no further data or padding characters.
                        output[op+1] = (byte) (value >> 2);
                        output[op] = (byte) (value >> 10);
                        op += 2;
                        state = 5;
                    } else if (d != SKIP) {
                        this.state = 6;
                        return false;
                    }
                    break;

                case 4:
                    if (d == EQUALS) {
                        ++state;
                    } else if (d != SKIP) {
                        this.state = 6;
                        return false;
                    }
                    break;

                case 5:
                    if (d != SKIP) {
                        this.state = 6;
                        return false;
                    }
                    break;
                }
            }

            if (!finish) {
                // We're out of input, but a future call could provide
                // more.
                this.state = state;
                this.value = value;
                this.op = op;
                return true;
            }

            switch (state) {
            case 0:
                break;
            case 1:
                this.state = 6;
                return false;
            case 2:
                output[op++] = (byte) (value >> 4);
                break;
            case 3:
               output[op++] = (byte) (value >> 10);
                output[op++] = (byte) (value >> 2);
                break;
            case 4:
                this.state = 6;
                return false;
            case 5:
                break;
            }

            this.state = state;
            this.op = op;
            return true;
        }
    }

    //  --------------------------------------------------------
    //  encoding
    //  --------------------------------------------------------    
    public static String encodeToString(byte[] input, int flags) {
        try {
            return new String(encode(input, flags), "US-ASCII");
        } catch (UnsupportedEncodingException e) {
            // US-ASCII is guaranteed to be available.
            throw new AssertionError(e);
        }
    }

    public static String encodeToString(byte[] input, int offset, int len, int flags) {
        try {
            return new String(encode(input, offset, len, flags), "US-ASCII");
        } catch (UnsupportedEncodingException e) {
            // US-ASCII is guaranteed to be available.
            throw new AssertionError(e);
        }
    }

    public static byte[] encode(byte[] input, int flags) {
        return encode(input, 0, input.length, flags);
    }

    public static byte[] encode(byte[] input, int offset, int len, int flags) {
        Encoder encoder = new Encoder(flags, null);

        // Compute the exact length of the array we will produce.
        int output_len = len / 3 * 4;

        // Account for the tail of the data and the padding bytes, if any.
        if (encoder.do_padding) {
            if (len % 3 > 0) {
                output_len += 4;
            }
        } else {
            switch (len % 3) {
                case 0: break;
                case 1: output_len += 2; break;
                case 2: output_len += 3; break;
            }
        }

        // Account for the newlines, if any.
        if (encoder.do_newline && len > 0) {
            output_len += (((len-1) / (3 * Encoder.LINE_GROUPS)) + 1) *
                (encoder.do_cr ? 2 : 1);
        }

        encoder.output = new byte[output_len];
        encoder.process(input, offset, len, true);

        assert encoder.op == output_len;

        return encoder.output;
    }

    /* package */ static class Encoder extends Coder {
        /**
         * Emit a new line every this many output tuples.  Corresponds to
         * a 76-character line length (the maximum allowable according to
         * <a href="http://www.ietf.org/rfc/rfc2045.txt">RFC 2045</a>).
         */
        public static final int LINE_GROUPS = 19;

        /**
         * Lookup table for turning Base64 alphabet positions (6 bits)
         * into output bytes.
         */
        private static final byte ENCODE[] = {
            'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
            'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
            'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
            'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', '/',
        };

        /**
         * Lookup table for turning Base64 alphabet positions (6 bits)
         * into output bytes.
         */
        private static final byte ENCODE_WEBSAFE[] = {
            'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
            'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
            'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
            'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '-', '_',
        };

        final private byte[] tail;
        /* package */ int tailLen;
        private int count;

        final public boolean do_padding;
        final public boolean do_newline;
        final public boolean do_cr;
        final private byte[] alphabet;

        public Encoder(int flags, byte[] output) {
            this.output = output;

            do_padding = (flags & NO_PADDING) == 0;
            do_newline = (flags & NO_WRAP) == 0;
            do_cr = (flags & CRLF) != 0;
            alphabet = ((flags & URL_SAFE) == 0) ? ENCODE : ENCODE_WEBSAFE;

            tail = new byte[2];
            tailLen = 0;

            count = do_newline ? LINE_GROUPS : -1;
        }

        /**
         * @return an overestimate for the number of bytes {@code
         * len} bytes could encode to.
         */
        public int maxOutputSize(int len) {
            return len * 8/5 + 10;
        }

        public boolean process(byte[] input, int offset, int len, boolean finish) {
            // Using local variables makes the encoder about 9% faster.
            final byte[] alphabet = this.alphabet;
            final byte[] output = this.output;
            int op = 0;
            int count = this.count;

            int p = offset;
            len += offset;
            int v = -1;

            // First we need to concatenate the tail of the previous call
            // with any input bytes available now and see if we can empty
            // the tail.

            switch (tailLen) {
                case 0:
                    // There was no tail.
                    break;

                case 1:
                    if (p+2 <= len) {
                        // A 1-byte tail with at least 2 bytes of
                        // input available now.
                        v = ((tail[0] & 0xff) << 16) |
                            ((input[p++] & 0xff) << 8) |
                            (input[p++] & 0xff);
                        tailLen = 0;
                    };
                    break;

                case 2:
                    if (p+1 <= len) {
                        // A 2-byte tail with at least 1 byte of input.
                        v = ((tail[0] & 0xff) << 16) |
                            ((tail[1] & 0xff) << 8) |
                            (input[p++] & 0xff);
                        tailLen = 0;
                    }
                    break;
            }

            if (v != -1) {
                output[op++] = alphabet[(v >> 18) & 0x3f];
                output[op++] = alphabet[(v >> 12) & 0x3f];
                output[op++] = alphabet[(v >> 6) & 0x3f];
                output[op++] = alphabet[v & 0x3f];
                if (--count == 0) {
                    if (do_cr) output[op++] = '\r';
                    output[op++] = '\n';
                    count = LINE_GROUPS;
                }
            }

            // At this point either there is no tail, or there are fewer
            // than 3 bytes of input available.

            // The main loop, turning 3 input bytes into 4 output bytes on
            // each iteration.
            while (p+3 <= len) {
                v = ((input[p] & 0xff) << 16) |
                    ((input[p+1] & 0xff) << 8) |
                    (input[p+2] & 0xff);
                output[op] = alphabet[(v >> 18) & 0x3f];
                output[op+1] = alphabet[(v >> 12) & 0x3f];
                output[op+2] = alphabet[(v >> 6) & 0x3f];
                output[op+3] = alphabet[v & 0x3f];
                p += 3;
                op += 4;
                if (--count == 0) {
                    if (do_cr) output[op++] = '\r';
                    output[op++] = '\n';
                    count = LINE_GROUPS;
                }
            }

            if (finish) {

                if (p-tailLen == len-1) {
                    int t = 0;
                    v = ((tailLen > 0 ? tail[t++] : input[p++]) & 0xff) << 4;
                    tailLen -= t;
                    output[op++] = alphabet[(v >> 6) & 0x3f];
                    output[op++] = alphabet[v & 0x3f];
                    if (do_padding) {
                        output[op++] = '=';
                        output[op++] = '=';
                    }
                    if (do_newline) {
                        if (do_cr) output[op++] = '\r';
                        output[op++] = '\n';
                    }
                } else if (p-tailLen == len-2) {
                    int t = 0;
                    v = (((tailLen > 1 ? tail[t++] : input[p++]) & 0xff) << 10) |
                        (((tailLen > 0 ? tail[t++] : input[p++]) & 0xff) << 2);
                    tailLen -= t;
                    output[op++] = alphabet[(v >> 12) & 0x3f];
                    output[op++] = alphabet[(v >> 6) & 0x3f];
                    output[op++] = alphabet[v & 0x3f];
                    if (do_padding) {
                        output[op++] = '=';
                    }
                    if (do_newline) {
                        if (do_cr) output[op++] = '\r';
                        output[op++] = '\n';
                    }
                } else if (do_newline && op > 0 && count != LINE_GROUPS) {
                    if (do_cr) output[op++] = '\r';
                    output[op++] = '\n';
                }

                assert tailLen == 0;
                assert p == len;
            } else {
                // Save the leftovers in tail to be consumed on the next
                // call to encodeInternal.

                if (p == len-1) {
                    tail[tailLen++] = input[p];
                } else if (p == len-2) {
                    tail[tailLen++] = input[p];
                    tail[tailLen++] = input[p+1];
                }
            }

            this.op = op;
            this.count = count;

            return true;
        }
    }

    private Base64() { }   // don't instantiate
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-10-20T04:11:17.410

在使用 Java 7 编译但可能在更高 Java 版本中运行的代码中，检测`java.util.Base64`类的存在并使用最适合此处其他问题中提到的给定 JVM 的方法似乎很有用。

我使用了这段代码：

```
private static final Method JAVA_UTIL_BASE64_GETENCODER;

static {
    Method getEncoderMethod;
    try {
        final Class<?> base64Class = Class.forName("java.util.Base64");
        getEncoderMethod = base64Class.getMethod("getEncoder");
    } catch (ClassNotFoundException | NoSuchMethodException e) {
        getEncoderMethod = null;
    }
    JAVA_UTIL_BASE64_GETENCODER = getEncoderMethod;
}

static String base64EncodeToString(String s) {
    final byte[] bytes = s.getBytes(StandardCharsets.ISO_8859_1);
    if (JAVA_UTIL_BASE64_GETENCODER == null) {
        // Java 7 and older // TODO: remove this branch after switching to Java 8
        return DatatypeConverter.printBase64Binary(bytes);
    } else {
        // Java 8 and newer
        try {
            final Object encoder = JAVA_UTIL_BASE64_GETENCODER.invoke(null);
            final Class<?> encoderClass = encoder.getClass();
            final Method encodeMethod = encoderClass.getMethod("encode", byte[].class);
            final byte[] encodedBytes = (byte[]) encodeMethod.invoke(encoder, bytes);
            return new String(encodedBytes);
        } catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {
            throw new IllegalStateException(e);
        }
    }
} 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2020-05-29T16:27:45.307

```
import java.io.UnsupportedEncodingException;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.Arrays;
import java.util.Base64;

import javax.crypto.Cipher;
import javax.crypto.spec.SecretKeySpec;
/***
 * 
 * @author Vaquar khan
 * 
 *
 */
public class AES {

    private static SecretKeySpec secretKey;
    private static final String VK_secretKey = "VaquarKhan-secrate-key!!!!";
    private static byte[] key;

    /**
     * 
     * @param myKey
     */
    public static void setKey(String myKey) {
        MessageDigest sha = null;
        try {
            key = myKey.getBytes("UTF-8");
            sha = MessageDigest.getInstance("SHA-1");
            key = sha.digest(key);
            key = Arrays.copyOf(key, 16);
            secretKey = new SecretKeySpec(key, "AES");
        } catch (NoSuchAlgorithmException e) {
            e.printStackTrace();
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
    }
/**
 * encrypt
 * @param strToEncrypt
 * @param secret
 * @return
 */
    public static String encrypt(String strToEncrypt, String secret) {
        try {
            setKey(secret);
            Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5Padding");
            cipher.init(Cipher.ENCRYPT_MODE, secretKey);
            return Base64.getEncoder().encodeToString(cipher.doFinal(strToEncrypt.getBytes("UTF-8")));
        } catch (Exception e) {
            System.out.println("Error while encrypting: " + e.toString());
        }
        return null;
    }
/**
 * decrypt
 * @param strToDecrypt
 * @param secret
 * @return
 */
    public static String decrypt(String strToDecrypt, String secret) {
        try {
            setKey(secret);
            Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5PADDING");
            cipher.init(Cipher.DECRYPT_MODE, secretKey);
            return new String(cipher.doFinal(Base64.getDecoder().decode(strToDecrypt)));
        } catch (Exception e) {
            System.out.println("Error while decrypting: " + e.toString());
        }
        return null;
    }

    public static void main(String[] args) {
        final String secretKey = VK_secretKey;
        String password = "VKhan@12";
        //
        String encryptedString = AES.encrypt(password, secretKey);
        String decryptedString = AES.decrypt(encryptedString, secretKey);
        //
        System.out.println(password);
        System.out.println(encryptedString);
        System.out.println(decryptedString);
    }

} 
```

# sql - 需要子查询帮助

> ID：469707
> 
> 赞同：1
> 
> 时间：2009-01-22T15:58:58.153
> 
> 标签：sql, subquery

我需要得到 2 个汇总数字，但是我遇到了问题，因为一个是针对总订单的，一个是针对不完整的订单的。这些使用相同的初始查询，但是未完成的订单有一个额外的 where 子句。可以将这些放入查询中，以便我只获得 2 列。我以前做过内部查询，但我从来没有用 2 个不同的 where 子句做过一个？！任何想法都非常受欢迎

用于总订单的查询即时消息是：

```
SELECT  Count(TBL_PROPERTY.PROPREF) AS TotalOrders

FROM    TBL_PROPERTY INNER JOIN 
        TBL_REPAIR_ORDER ON TBL_PROPERTY.PROPREF = TBL_REPAIR_ORDER.PROPREF INNER JOIN 
        TBL_REPAIR_VISIT ON TBL_REPAIR_ORDER.ORDERID = TBL_REPAIR_VISIT.ORDERID INNER JOIN
        tbl_contract ON tbl_repair_order.CONTRACT = tbl_contract.CONTRACT

WHERE   (TBL_CONTRACT.CONTRACT IN ('STE')) AND
        (TBL_REPAIR_ORDER.RAISEDDATE  BETWEEN '01/12/2008' AND DATEADD(hh,23,'01/01/2009')) 
```

使用订单不完整查询即时消息：

```
SELECT  Count(TBL_PROPERTY.PROPREF) AS TotalOrders

FROM    TBL_PROPERTY INNER JOIN 
        TBL_REPAIR_ORDER ON TBL_PROPERTY.PROPREF = TBL_REPAIR_ORDER.PROPREF INNER JOIN 
        TBL_REPAIR_VISIT ON TBL_REPAIR_ORDER.ORDERID = TBL_REPAIR_VISIT.ORDERID INNER JOIN
        tbl_contract ON tbl_repair_order.CONTRACT = tbl_contract.CONTRACT

WHERE   (TBL_CONTRACT.CONTRACT IN ('STE')) AND
        (TBL_REPAIR_ORDER.RAISEDDATE  BETWEEN '01/12/2008' AND DATEADD(hh,23,'01/01/2009')) AND
 TBL_REPAIR_ORDER.STATUS <> 'Completed') 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T16:06:29.730

```
SELECT  Count(TBL_PROPERTY.PROPREF) AS TotalOrders
      , SUM( CASE WHEN TBL_REPAIR_ORDER.STATUS <> 'Completed' THEN 1 ELSE 0 END ) AS TotalNotCompleted 
```

也从 WHERE 子句中删除 TBL_REPAIR_ORDER.STATUS <> 'Completed'。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-01-22T16:07:20.290

将您拥有的两个查询用作主查询中的表/列。

# .net - 在游戏开发和 VirtualBox 等应用程序方面，C++ 比 .NET 有什么优势

> ID：469722
> 
> 赞同：9
> 
> 时间：2009-01-22T16:02:17.913
> 
> 标签：.net, c++

这是试图改写我之前提出的问题。我想知道为什么 C++ 似乎是某些胖客户端应用程序的首选语言。我能想到的最简单的例子是视频游戏和我最喜欢的应用 VirtualBox。

请不要关闭这篇文章我只是想了解为什么会这样。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-22T16:27:40.327

作为一名从事 AAA 级游戏的专业游戏开发者，我可以告诉你。原因 1 是 C++，C 可以在任何平台上编译和运行，比如 PS3 或 NDS。Next 平台制造商只提供强大的 C 库来与硬件接口。这背后的原因是 C 和 C++ 是免费的，并且不属于一家公司，并且因为它们是为接近金属低级编程而设计的。这意味着游戏开发者需要了解形成反馈循环的 C/C++。然而，现在许多开发人员使用 C# 或 Java 制作他们的工具集，但那是因为性能并不重要。

现在这种姿势对于大多数 Web 开发者来说可能看起来很狂热，但是游戏需要处理整个复杂模拟的切片并渲染高达每秒 60 次，很少有 Web 应用程序必然会保持在该延迟率内，因此需求是不同的。同样的原因很少有 Web 服务是用 C++ 生成的。

然而，由于开发速度的提高和微调游戏的能力，高级人工智能和游戏玩法（规则）是脚本化的。也因为这大约占资源的 15%，所以我们可以在这里挥霍一下，让设计师完成他们的工作。另请注意，即使在 C++ 中完成，编写灵活的规则系统也将占用相同的资源。哦，并不是所有的平台都允许使用 Jit 代码，这很好:)

当然，正如前面提到的内存控制，如果您使用的内存比硬件提供的多 1 个字节，它也不会像 PC 那样变慢。它崩溃了。所以我们喜欢我们的裸指针、自定义分配器和 RAII。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-22T16:05:44.050

有很多潜在的原因：

*   速度增加无论是感知的还是真实的。
*   以前的知识。有很多人已经编写 C++ 20 多年了。C# 并非如此。
*   现有代码。确实，.Net 在框架中包含了很多功能。即便如此，它仍然无法与 C++ 存在的数十年库相比。
*   跨平台开发。C++ 更容易移植。
*   决定论。我会无耻地窃取 ctacke 的答案。他总结得最好，但是能够准确地确定在非常低的级别时会发生什么对于编写诸如时间紧迫的游戏之类的东西是非常必要的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-22T16:10:33.667

对于大量应用程序，它归结为速度和确定性。

本机代码运行得更快，因为您有一个编译器，它可以花时间在创建机器语言方面做最好的工作。唯一需要等待的是开发商。托管代码在运行时必须从 IL 转换为机器语言。快速完成它比以最好的形式完成它更重要，因为用户必须等待它发生。更好的速度 == 更好的用户体验。

确定性是许多事情（如游戏）的关键，因为您想确切地知道需要时间的事情何时会发生。当我进行内存分配或释放时，需要时间。我希望当我们加载一个新的游戏关卡并且没有人会注意到时发生这种情况，而不是当用户在一场终极死亡比赛中被他的朋友射中的时候左扫射。那里的口吃最终伴随着咒骂和房间另一侧的游戏控制器。使用本机代码，您可以明确控制这些事情何时发生。使用托管代码时，GC 决定何时发生，并且无法准确知道何时或多长时间。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-22T16:04:46.130

使用 c++ 制作应用程序跨平台比使用 .net 更容易（在我看来这是巨大的优势，例如，您也可以将游戏瞄准 Mac 用户）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-22T16:05:49.357

主要原因可能是：

1.  表现
2.  对低级事物的更高级别的控制
3.  现有的代码库

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-22T17:52:33.103

在您提到的情况下，主要原因是更容易访问低级系统 API、速度和可移植性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T19:22:01.753

在我看来，这是对答案的很好总结：

1.  更精细地控制代码的执行方式
2.  可移植性
3.  语言方面的知识和经验
4.  运行代码更接近裸机
5.  效率
6.  在任何东西上运行
7.  语言不属于任何特定组织

# c# - 如何使用 tfs api 列出团队项目的文件？

> ID：469732
> 
> 赞同：10
> 
> 时间：2009-01-22T16:04:56.283
> 
> 标签：c#, api, tfs

我想知道是否有办法列出 tfs 团队项目中包含的所有“文件”。我的目标是搜索特定名称的文件，这些文件在 TFS 中没有由分支引起的固定路径（$/MyTeamProject/Main/Build/instruction.xml 和 $/MyTeamProject/Branches/Release_1.0）。找到文件后，我想对其进行操作。

我想当涉及到包含在团队项目中的实体而不是传统文件时，我们正在谈论项目，因此这可能有点棘手？

我已经看到了一些用于操作文件的示例，但到目前为止所有示例都有固定的路径。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2011-12-06T18:23:05.627

这不是一个不同的答案，而只是 Vengafoo 代码的升级。TeamFoundationServer 类在 2011 年已过时（不确定何时发生，我只知道它现在已过时）。Vengafoo 的代码来自 2009 年，所以这是有道理的。将 TfsTeamProjectCollection 类与 TfsTeamProjectCollectionFactory 工厂类一起使用。

这是升级，只需更改一行：

```
//TeamFoundationServer server = new TeamFoundationServer("server");
TfsTeamProjectCollection server = TfsTeamProjectCollectionFactory.GetTeamProjectCollection(new Uri("http://tfsServerURI:8080/tfs/"));

VersionControlServer version = server.GetService(typeof(VersionControlServer)) as VersionControlServer;

ItemSet items = version.GetItems(@"$\ProjectName", RecursionType.Full);
//ItemSet items = version.GetItems(@"$\ProjectName\FileName.cs", RecursionType.Full);

foreach (Item item in items.Items)
{
    System.Console.WriteLine(item.ServerItem);
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-23T20:33:13.590

以下是我想出如何列出 TFS 项目的所有文件的方法：

添加 Microsoft.TeamFoundation.Client 和 Microsoft.TeamFoundation.VersionControl.Client 作为对项目的引用。

为 Microsoft.TeamFoundation.Client 和 Microsoft.TeamFoundation.VersionControl.Client 添加使用

```
TeamFoundationServer server = new TeamFoundationServer("server");
VersionControlServer version = server.GetService(typeof(VersionControlServer)) as VersionControlServer;

ItemSet items = version.GetItems(@"$\ProjectName", RecursionType.Full);
ItemSet items = version.GetItems(@"$\ProjectName\FileName.cs", RecursionType.Full);

foreach (Item item in items.Items)
{
    System.Console.WriteLine(item.ServerItem);
} 
```

第二个 GetItems 会将找到的项目限制为特定文件名的项目。我只是有这个示例输出所有找到的文件的服务器路径。

# .net - WCF 安全模式是 TransportWithMessageCredential 使用 UserName，在哪里验证？

> ID：469733
> 
> 赞同：3
> 
> 时间：2009-01-22T16:05:01.743
> 
> 标签：.net, wcf, security

这是我的 WCF 服务的 web.config 的一部分：

```
<bindings>
      <basicHttpBinding>
        <binding name="sslBinding">
          <security mode="TransportWithMessageCredential">
            <message clientCredentialType="UserName" algorithmSuite="Default" />
            <transport />
          </security>
        </binding>
      </basicHttpBinding>
    </bindings> 
```

当客户端尝试使用我的服务时，我究竟在哪里检查用户名？有没有我必须重写的方法来验证用户名？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-22T16:21:59.120

```
<behaviors>
        <serviceBehaviors>
          <behavior name="behavior">
            <serviceCredentials>
              <userNameAuthentication customUserNamePasswordValidatorType="myType, assembly" userNamePasswordValidationMode="Custom"/>
            </serviceCredentials>
          </behavior>
        </serviceBehaviors> 
```

# linq - LINQ to SQL 无法识别新关联？

> ID：469735
> 
> 赞同：3
> 
> 时间：2009-01-22T16:05:12.960
> 
> 标签：linq, linq-to-sql

我有两个项目使用旧数据库，表之间没有关联。一方面，如果我在 DBML 文件中创建关联，我可以像这样在 LINQ 中引用关联：

```
From c In context.Cities Where c.city_name = "Portland" _
Select c.State.state_name 
```

（假设我在 DBML 文件中添加了 from `City.state_abbr`to的链接。）`State.state_abbr`

在使用不同数据库的不同项目中，手动添加关联似乎并没有给我这个功能，我不得不像这样编写 LINQ 查询：

```
From c In context.Cities Where c.city_name = "Portland" _
Join s In context.States On c.state_abbr = s.state_abbr _
Select s.state_name 
```

知道我在第二个项目中可能缺少什么吗？

注意：这些完全是人为的例子——真正的源表彼此完全不同，而且非常神秘。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-06T12:25:49.540

检查您的[错误列表](http://msdn.microsoft.com/en-us/library/33df3b7a(VS.80).aspx)页面。你可能有类似下面的内容：

> DBML1062：类型元素“ChildTable”的关联元素“ParentTable_ChildTable”的类型属性“[ParentTable]”没有主键。不会为关联生成代码。

在这种情况下，您需要做的就是确保两个表都设置了主键并重新保存 dbml 文件。这将调用自定义工具，该工具将依次更新 Designer.cs 文件并为关联创建代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T13:43:33.317

看起来我的问题是我的表在第二个项目中没有主键。就像我说的那样，这些是遗留表，所以我不得不在数据库上下文中而不是数据库本身中进行链接和主键的工作，而且我第二次忘记指定主键了。当你没有发现它时令人沮丧，但现在它是有道理的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-03-03T14:07:52.630

有时，当一切配置正确但仍无法正常工作时，解决方案可以像重新启动 Visual Studio 一样简单。

我不知道为什么有时会发生这种情况，但我想我应该添加这个答案，因为我自己已经做了一些寻找解决方案的工作，似乎还没有人提出这个建议......

# .net - 用户模式 .NET 设置存储在哪里？

> ID：469742
> 
> 赞同：37
> 
> 时间：2009-01-22T16:05:50.823
> 
> 标签：.net, settings

我想知道 .NET 中 .settings 文件背后的魔力是什么。想象一下，您创建了一个在此示例中调用的程序集`SettingsHolder`，您创建了您的设置类，该类在用户模式下是公共的，其中包含一个字符串，然后您进行编译。

现在您在 MyApp 中引用您的程序集，然后进行编译，然后您可以使用生成的设置类更改您的设置的应用程序中的值`SettingsHolder`并保留它们。

现在进入 MyApp 的输出目录，您的设置没有任何痕迹（应用程序配置文件中没有任何内容，程序集中没有任何内容，什么都没有！）。

到底是怎么回事？！（我试图在 .NET 源代码中进行源步骤调试，并使用反射器来查看发生了什么，.NET 似乎在使用`LocalFileSettingsProvider`（但对我来说似乎很奇怪，因为`MyApp.exe.config`输出目录中没有任何内容）。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-01-22T16:23:40.553

对于每个用户，设置文件存储在不同的位置。要找到它们，请单击开始菜单，单击运行，然后粘贴：

```
%USERPROFILE%\Local Settings\Application Data\ 
```

然后按回车。将有一个包含您的“公司名称”的文件夹（无论它在您的程序集中设置为什么），然后是更多的子文件夹。设置存储在 user.config 中。

完整路径：

```
%USERPROFILE%\Local Settings\Application Data\<Company Name>\
<appdomainname>_<eid>_<hash>\<verison>\user.config. 
```

在 Windows Vista 和更新版本中，这些存储在：

```
%USERPROFILE%\AppData\Local\ 
```

更多信息：

*   [http://www.codeproject.com/KB/vb/appsettings2005.aspx](http://www.codeproject.com/KB/vb/appsettings2005.aspx)
*   [http://www.google.com/search?q=.net+user.config](http://www.google.com/search?q=.net+user.config)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-01-21T11:23:23.320

在 OS >= **Vista**上，我将声明它位于此处的用户设置文件：

> %LOCALAPPDATA%\ *yourcompany* \ *app-name* \..\user.config

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2009-01-22T16:07:10.867

设置文件包含在编译的程序集中。

### 编辑：

只是为了澄清一点。文件中的代码`get`和`set`设置被编译到程序集中。值本身被移动到应用程序名称所在的`Program.exe.config`位置。`Program`反射器将让您查看获取和设置值的代码，包括配置文件的硬编码键。配置文件本身将向您显示该值并允许您在构建应用程序后对其进行更改。

# php - php 和 MySQL：2 个请求还是 1 个请求？

> ID：469746
> 
> 赞同：0
> 
> 时间：2009-01-22T16:06:44.800
> 
> 标签：php, mysql

我正在使用 MySQL 作为我的数据库在 php 中构建一个网页。

哪种方式更快？

1.  使用以下查询向 MySQL 发出 2 个请求。

    从数据中选择点；
    从数据中选择总和（点）；

2.  对 MySQL 的 1 个请求。将结果保存在一个临时数组中并计算 php.ini 中的总和。

    $data = 从数据中选择点；

编辑——数据约为 200-500 行

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T16:11:29.780

这真的取决于很多不同的因素。我建议尝试这两种方法，看看哪一种更快。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T16:13:15.097

由于 Phill 和 Kibbee 已经非常有效地回答了这个问题，我想指出过早的优化是一件坏事 (TM)。写出对你来说最简单的东西和个人资料，个人资料，个人资料。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T16:09:28.863

我们在谈论多少数据？我想说 MySQL 在大多数情况下执行这些操作可能更快。

编辑：对于您正在谈论的那种数据，它可能不会产生重大影响。但是数据库往往会针对这些查询进行优化，而 PHP 则不然。我认为第二个数据库查询可能是值得的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T00:24:34.250

如果您想在一行中执行此操作，请使用如下运行总计：

设置@total=0；
SELECT points, @total:=@total+points AS RunningTotal FROM data;

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T00:43:44.493

在我遇到性能问题之前，我不会担心它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-29T01:05:47.023

如果您使用两个单独的查询，则需要注意数据在获取行和获取总和之间发生变化的可能性。在出现可观察到的性能问题之前，我会坚持自己总结以保持页面一致。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-22T16:33:16.743

使用 mySQL 提高效率的一般经验法则是尽量减少 SQL 请求的数量。对数据库的每次调用都会增加开销，并且在所需时间方面是“昂贵的”。

mySQL 做的优化是相当不错的。它可以接受具有许多连接、嵌套和计算的非常复杂的请求，并使其高效运行。

但它只能优化个别请求。它无法检查两个不同 SQL 语句之间的关系并在它们之间进行优化。

在您的示例 1 中，这两条语句将向数据库发出两次请求，并且该表将被扫描两次。

您保存结果并自己计算总和的示例 2 将比 1 快。这只是一次数据库调用，并且在 PHP 中循环数据以获取总和比第二次调用数据库要快。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-29T01:12:00.707

就是图个好玩儿。

```
SELECT COUNT(points) FROM `data`
UNION
SELECT points FROM `data` 
```

第一行是总数，下一行是数据。

**注意：联合可能很慢，但它是一种选择。**

还可以做更多的乐趣，这支持你对行进行排序。

```
SELECT 'total' AS name, COUNT(points) FROM `data`
UNION
SELECT 'points' AS name, points FROM `data` 
```

然后通过PHP选择

```
while($row = mysql_fetch_assoc($query))
{
    if($row["data"] == "points")
    {
        echo $row["points"];
    }

    if($row["data"] == "total")
    {
        echo "Total is: ".$row["points"];
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-29T01:35:04.717

您可以像这样使用联合：

(select points, null as total from data) union (select null, sum(points) from data group by points);

结果将如下所示：

```
  总分
   2 空
   5 空
   ...
   空                  7

```

你可以弄清楚如何处理它。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-01-22T17:06:37.033

用 mySQL 的方式来做。让数据库管理器完成它的工作。mySQL 针对此类任务进行了优化

# c++ - Winform 不显示在设计器中

> ID：469751
> 
> 赞同：0
> 
> 时间：2009-01-22T16:07:22.223
> 
> 标签：c++, winforms, .net-2.0

我有一个托管 C++ WinForm，它突然停止在 VS 2005 设计器中显示。它显示的错误是

> 找不到类型“int”。请确保引用了包含此类型的程序集。如果此类型是您的开发项目的一部分，请确保该项目已成功构建。

我什至不知道从哪里开始。设计者在渲染表单时是否只访问 InitializeComponent(void) 方法？所以我的问题是：你从哪里开始解决设计器错误？

编辑：我忘了提到这段代码可以完美地构建和运行。它仅在 Windows 窗体设计器中显示错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T17:58:28.067

这是 C# 的故障排除，但我认为这里提到的几点会有所帮助。

[《视觉传承》玩的什么状态](https://stackoverflow.com/questions/49458/whats-the-state-of-play-with-visual-inheritance#49526)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T17:41:06.590

这通常是由于代码中某处的语法错误导致设计人员无法运行表单来呈现它。遗憾的是，最好的方法通常只是阅读代码以查找问题额外大括号、缺少字符串等。好消息是它很可能很容易找到，因为您知道它在错误消息中的 INT 之前。

一些可能性： * 我通常是通过不小心敲击键盘并在文件顶部放置一些额外字符 * 导致类无法编译的额外大括号 - 缺少引号、分号 * 在顶部键入的东西弄乱了一个常见的包含/使用语句

诊断 * 有时，您可以通过构建构建并查看标记有错误的 lione，然后环顾四周来找到它。* 更多时候，我不必只打开源文件并扫描它以查找问题。

# iphone - 将 UIWebView 渲染到 ImageContext

> ID：469764
> 
> 赞同：9
> 
> 时间：2009-01-22T16:10:08.630
> 
> 标签：iphone, cocoa-touch, uiwebview

我正在尝试捕获 UIWebView 的内容，包括对用户不可见的内容。即整个网页，即使用户只看顶部。

环顾四周，我发现捕获 UIView 的最佳方法是检索其层并使用 renderInContext。

然而，UIWebView 似乎在使用它自己的 CALayer 实现，它的行为更像 CATiledLayer，尽管它仍然声称是标准的 CALayer。当我调用 renderInContext 时，我只得到网页的一部分，最多向下 940 像素，而不是整个页面。

有没有人有任何想法：强制 UIWebView 向下滚动另一个 940px（显然这远非理想），或者当我要求它时告诉它支持 WebView 的任何种类的 CALayer 来呈现其所有内容。

干杯

编辑：我应该补充一点，当前更改 webview 的框架以适应通过 javascript 检索的页面的大小。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-08-05T02:07:09.277

我已经发布了一个应用程序（[Web2Pic](http://itunes.apple.com/us/app/mammoth-web2pic-webpage-full/id450749975?mt=8)），请相信我***UIGraphicsBeginImageContext(webView.frame.size);*** 除了从我们的 UIWebView 的可见区域获取一个小图像之外，什么也做不了；-(

正确的方法有点复杂，但它确实有效：

1.在我们的 UIWebView 中**使用 JavaScript**来获取这些浮点值：

```
 //Whole page size in HTML coordinate
   document.body.scrollWidth
   document.body.scrollHeight
   //UIWebView visible size in HTML coordinate
   window.innerWidth
   window.innerHeight 
```

2.现在我们可以将整个页面“切割”成几十个 UIWebView 大小的小块。然后我们可以单独捕获每个小块并将它们保存到我们的缓存中。我通过计算页面偏移量并使用**UIGraphicsBeginImageContext(webView.frame.size);来实现这一点。**获取图像数组。此外，您应该将图像数组缓存到文件系统中，否则应用程序最终会崩溃！

3.当我们最终得到所有小块时，我们可以启动一个全分辨率上下文：**UIGraphicsBeginImageContext(CGSizeMake(document.body.scrollWidth,document.body.scrollHeight));**

4.根据坐标将每个小图像渲染到大上下文中。并**注意角落**，每行/行中的最后一张图像可能不是完整的图像。

5.还有一步：保存大图。**请勿将其保存到 PhotoAlbum**中，因为 iOS 会自动降低相册中图像的分辨率。相反，我们可以将其保存到文件系统中并启用应用程序的**iTunes 文件共享**支持，甚至可以编写一个简单的应用程序内照片管理器。

希望这些可以帮助;-)

易潮峰姬

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-08-07T12:42:26.417

将的高度设置`webview`为`contentsize`的`scrollview`。`webview`

```
-(UIImage *)captureImage:(UIWebView *)webvw
{
    webvw.frame=CGRectMake(webvw.frame.origin.x, webvw.frame.origin.y, webvw.frame.size.width, webvw.scrollView.contentSize.height);
    UIGraphicsBeginImageContextWithOptions(webvw.frame.size, NO, 0.0f);
    [webvw.layer renderInContext:UIGraphicsGetCurrentContext()];
    UIImage *screenshot = UIGraphicsGetImageFromCurrentImageContext();
    return screenshot;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T22:59:26.633

在我看来，UIWebView 是按需呈现的（当您在大页面上快速向下滚动时，可以看到棋盘），因此在用户向下滚动之前，您可以到达的图层下方的部分不会有任何内容。该图层将无法写出它没有的内容，因此我认为您无法捕获整个区域。

就滚动而言，我想不出任何明显的公开 API 方法可以将其向下移动。Web 视图似乎托管了一个 UIScrollView 或类似的东西，您可以尝试通过遍历视图层次结构并使用它的 scrollRectToVisible:animated: 来访问它，但这听起来不是一个好的长期解决方案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T09:52:08.703

只是为了回答我的一个问题，您可以使用 javascript 滚动视图。

因此，您使用`stringByEvaluatingJavaScriptFromString:`javascript `window.scrollTo(0,%i);`，其中 %i 是您要滚动到的位置。您还可以使用`scrollY`来检索当前滚动值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-02-19T15:56:47.983

调整 Webview 的大小是我解决它的方法。如果你想要一个更大的图像和更多的细节，你只需要在调用这个方法之前放大。请注意，大尺寸可能会影响性能。

```
- (UIImage*) imageFromWebview:(UIWebView*) webview{

//store the original framesize to put it back after the snapshot
CGRect originalFrame = webview.frame;

//get the width and height of webpage using js (you might need to use another call, this doesn't work always)
int webViewHeight = [[webview stringByEvaluatingJavaScriptFromString:@"document.body.scrollHeight;"] integerValue];
int webViewWidth = [[webview stringByEvaluatingJavaScriptFromString:@"document.body.scrollWidth;"] integerValue];

//set the webview's frames to match the size of the page
[webview setFrame:CGRectMake(0, 0, webViewWidth, webViewHeight)];

//make the snapshot
UIGraphicsBeginImageContextWithOptions(webview.frame.size, false, 0.0);
[webview.layer renderInContext:UIGraphicsGetCurrentContext()];
UIImage *image = UIGraphicsGetImageFromCurrentImageContext();
UIGraphicsEndImageContext();

//set the webview's frame to the original size
[webview setFrame:originalFrame];

//and VOILA :)
return image; 
```

}

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-04T10:07:55.127

所有 UIView 的大小限制为 1024x1024，因此您可能会以编程方式滚动，以块的形式捕获页面，并以某种方式将它们拼接在一起。

# c# - C# 中扩展方法背后的设计动机是什么

> ID：469772
> 
> 赞同：1
> 
> 时间：2009-01-22T16:11:41.903
> 
> 标签：c#, .net-3.5, c#-3.0

我想知道 C# 中扩展方法背后的设计动机是什么

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-22T16:16:40.393

它允许您在不编辑原始代码的情况下为现有代码库创建新功能。

[http://weblogs.asp.net/scottgu/archive/2007/03/13/new-orcas-language-feature-extension-methods.aspx](http://weblogs.asp.net/scottgu/archive/2007/03/13/new-orcas-language-feature-extension-methods.aspx)

**“扩展方法允许开发人员向现有 CLR 类型的公共合同添加新方法，而无需对其进行子类化或重新编译原始类型。扩展方法有助于将当今动态语言中流行的“鸭子类型”支持的灵活性与强类型语言的性能和编译时验证。扩展方法支持各种有用的场景，并帮助实现真正强大的 LINQ 查询框架，该框架作为“Orcas”版本的一部分与 .NET 一起引入。**

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T16:15:09.663

它们存在的主要原因是能够以某种方式向类型添加特性，而无需从它继承。

这是提供`Where`, `Select`, ... 方法以在 LINQ 中用于没有集合的方法所必需的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T16:21:57.717

它通过后门提供多重继承。

它支持从许多类继承的C++等语言，不需要扩展方法。然而多重继承有很多问题，所以现代语言已经放弃了它。然而，扩展方法是多继承有用的用例。不过，C# 设计者并没有重新引入多重继承，而是创建了扩展方法（这是解决问题的一个非常巧妙的解决方案）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-22T16:21:44.037

很多时候，我们最终会为自己编写有用的小实用静态类，这些静态类在类型上执行通用功能。我知道有很多次我希望我可以简单地继承一个类来添加一个特性，但是那个类是密封的。我很高兴虽然他们被封印了，但毫无根据的继承是一件坏事。

扩展方法允许这些静态方法看起来是该类型的新实例方法，从而使代码看起来更直观。

它们还具有不污染类型的实际成员命名空间并允许您通过`using`关键字选择加入它们的优点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-10T00:14:13.067

扩展方法的存在很可能是因为微软需要在`IEnumerable`不改变接口的情况下添加功能。如果他们向接口添加方法，那么每个现有的实现`IEnumerable`（包括微软的）都将不再编译。

更改的替代方法`IEnumerable`是创建一个实用程序类（称为`Enumerable`），它具有对 的实例执行转换的方法`IEnumerable`。这可行，除了用户体验与从现有`IEnumerable`实例调用方法不同。例如，比较以下等效语句。

```
IEnumerable<string> strings = myIntList.Select(num => num.ToString())
                                       .Where(num => num.StartsWith('T'));

IEnumerable<string> strings =
    Enumerable.Where(
        Enumerable.Select(myIntList, num => num.ToString()),
        num => num.StartsWith('T')); 
```

为了实现两全其美，C# 编译器团队添加了对扩展方法的支持，允许`Enumerable`使用特殊语法创建类，并保持与一`IEnumerable`开始就添加方法相同的用户体验。

# mysql - 在 MySQL 数据库中为表创建触发器（语法错误）

> ID：469784
> 
> 赞同：17
> 
> 时间：2009-01-22T16:14:56.997
> 
> 标签：mysql, sql, triggers

我无法为 MySQL 数据库定义触发器。我想在插入新行之前更改文本字段（在给定条件下）。这是我尝试过的：

```
CREATE TRIGGER add_bcc
BEFORE INSERT ON MailQueue
FOR EACH ROW BEGIN
  IF (NEW.sHeaders LIKE "%support@mydomain.com%") THEN
    SET NEW.sHeaders = NEW.sHeaders + "BCC:internal@mydomain.com";
  END IF;
END; 
```

但我总是收到错误“错误的语法”。我被卡住了，我做错了什么？我正在使用**MySQL 5.0.51a-community**

顺便说一句：像这样创建一个空触发器可以正常工作：

```
CREATE TRIGGER add_bcc
BEFORE INSERT ON MailQueue
FOR EACH ROW BEGIN
END; 
```

但这也失败了：

```
CREATE TRIGGER add_bcc
BEFORE INSERT ON MailQueue 
FOR EACH ROW BEGIN
  IF 1=1 THEN
  END IF; 
END; 
```

这是我第一次使用 stackoverflow.com，所以如果在这里发布一些东西有帮助，我会非常兴奋 :-)

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-22T16:38:27.637

您需要[更改分隔符](http://dev.mysql.com/doc/refman/5.0/en/create-procedure.html)- MySQL 看到第一个“;” 作为 CREATE TRIGGER 语句的结尾。

试试这个：

```
/* Change the delimiter so we can use ";" within the CREATE TRIGGER */
DELIMITER $$

CREATE TRIGGER add_bcc
BEFORE INSERT ON MailQueue
FOR EACH ROW BEGIN
  IF (NEW.sHeaders LIKE "%support@mydomain.com%") THEN
    SET NEW.sHeaders = NEW.sHeaders + "BCC:internal@mydomain.com";
  END IF;
END$$
/* This is now "END$$" not "END;" */

/* Reset the delimiter back to ";" */
DELIMITER ; 
```

# web-services - RPC/Literal wsdl 中的数组

> ID：469792
> 
> 赞同：2
> 
> 时间：2009-01-22T16:16:15.043
> 
> 标签：web-services, soap

我想知道是否有人有一个关于 RPC/literal wsdl 中数组的示例？我有一个 rpc 编码的 WSDL，我试图将其转换为 rpc/literal，而症结在于数组。

你会如何转换

到等效的 rpc/literal 类型（假设您创建了 AttributeArray 类型）？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T17:57:39.407

首先，我对 SOAP 的经验很少。但也许[MSDN 上的这篇文章](http://msdn.microsoft.com/en-us/library/ms996466.aspx)正是你所需要的。查找“描述 RPC/文字消息”部分。有一个包含客户数组的 WSDL 示例。

# iphone - 有谁知道收件人/主题控制 a'la iPhone 的邮件和短信应用程序？

> ID：469797
> 
> 赞同：3
> 
> 时间：2009-01-22T16:17:15.527
> 
> 标签：iphone

我想展示一个带有“收件人：”字段和“主题：”字段的小部件，就像邮件应用程序和 SMS 应用程序部分一样（它没有主题字段）。例如，当输入一个人名的几个字母时，会显示一个表格，其中包含地址簿中的相关命中。收件人被封装在一个蓝色气泡中。等等...

有没有人将 MobileMail.app 或 MobileSMS.app 颠倒过来并将其封装在一个易于使用的类中？那是我的梦想;-)

提前致谢！/约翰

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-28T13:35:50.637

查看 Joe Hewitt [three20](http://github.com/joehewitt/three20/)项目，它包括一个消息编写器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T17:31:16.733

它可能比你想要的更多，因为我不确定你的问题是你想用这个视图做什么。但是有 skpsmtpmessage，一个包含 UI 的开源 SMTP 发送器。它可以在[http://code.google.com/p/skpsmtpmessage/](http://code.google.com/p/skpsmtpmessage/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T17:06:24.613

这是一个非答案，但我也寻找过这个，但没有找到任何东西。我最终用我的想法做了一些不同的事情，不需要直接输入这些字段。我想你必须自己动手。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-28T14:10:01.553

catlan 指向一个很好的图书馆，里面有three20。

同样在 3.0 中还有[新的 MessageUI 框架](http://developer.apple.com/iphone/prerelease/library/documentation/MessageUI/Reference/MessageUI_Framework_Reference/index.html#//apple_ref/doc/uid/TP40008274)

克里斯。

# c# - C# 中的科乐美代码

> ID：469798
> 
> 赞同：24
> 
> 时间：2009-01-22T16:17:17.740
> 
> 标签：c#, .net, winforms

我希望有一个 C# 应用程序实现 Konami 代码来显示复活节彩蛋。 [http://en.wikipedia.org/wiki/Konami_Code](http://en.wikipedia.org/wiki/Konami_Code)

做这个的最好方式是什么？

这是在标准 C# windows 窗体应用程序中。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-22T17:02:02.067

在 Windows 窗体中，我将有一个知道序列是什么并保存您在序列中的状态的类。像这样的事情应该这样做。

```
using System;
using System.Collections.Generic;
using System.Windows.Forms;

namespace WindowsFormsApplication3 {
    public class KonamiSequence {

        List<Keys> Keys = new List<Keys>{System.Windows.Forms.Keys.Up, System.Windows.Forms.Keys.Up, 
                                       System.Windows.Forms.Keys.Down, System.Windows.Forms.Keys.Down, 
                                       System.Windows.Forms.Keys.Left, System.Windows.Forms.Keys.Right, 
                                       System.Windows.Forms.Keys.Left, System.Windows.Forms.Keys.Right, 
                                       System.Windows.Forms.Keys.B, System.Windows.Forms.Keys.A};
        private int mPosition = -1;

        public int Position {
            get { return mPosition; }
            private set { mPosition = value; }
        }

        public bool IsCompletedBy(Keys key) {

            if (Keys[Position + 1] == key) {
                // move to next
                Position++;
            }
            else if (Position == 1 && key == System.Windows.Forms.Keys.Up) {
                // stay where we are
            }
            else if (Keys[0] == key) {
                // restart at 1st
                Position = 0;
            }
            else {
                // no match in sequence
                Position = -1;
            }

            if (Position == Keys.Count - 1) {
                Position = -1;
                return true;
            }

            return false;
        }
    }
} 
```

要使用它，您需要在表单代码中响应按键事件。这样的事情应该这样做：

```
 private KonamiSequence sequence = new KonamiSequence();

    private void Form1_KeyUp(object sender, KeyEventArgs e) {
        if (sequence.IsCompletedBy(e.KeyCode)) {
            MessageBox.Show("KONAMI!!!");
        }
    } 
```

希望这足以满足您的需求。对于 WPF，您需要的细微差别非常相似（请参阅编辑历史记录 #1）。

编辑：更新为 winforms 而不是 wpf。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-01T20:48:46.820

正确的顺序，与 Konami 本身实现它的方式相同：

*   获得输入
*   如果输入等于代码数组索引处的字节，则增加索引
    *   否则，清除索引
*   如果索引大于代码长度，代码是正确的

以下是不这样做的方法：

*   累积击键缓冲区，然后进行逐字节字符串比较。效率低下，充其量。您正在为表单上的每个按键调用字符串解析例程，与可以采取一些简单的步骤以获得相同的确切效果相比，这些例程既慢又笨重。

*   如果您在代码中重复序列，每次都会中断的有限状态机。

*   具有“特殊情况”硬编码的有限状态机。现在，您不能在一处进行修改。您必须更改代码字符串并添加新代码来处理您不恰当地实现的状态机。

*   实例化一个 List 对象来保存一些简单的东西，比如一个字符列表。

*   涉及字符串对象。

所以，这里是如何做到的：

```
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    public class KonamiSequence
    {
        readonly Keys[] _code = { Keys.Up, Keys.Up, Keys.Down, Keys.Down, Keys.Left, Keys.Right, Keys.Left, Keys.Right, Keys.B, Keys.A };

        private int _offset;
        private readonly int _length, _target;

        public KonamiSequence()
        {
            _length = _code.Length - 1;
            _target = _code.Length;
        }

        public bool IsCompletedBy(Keys key)
        {
            _offset %= _target;

            if (key == _code[_offset]) _offset++;
            else if (key == _code[0])  _offset = 2;  // repeat index

            return _offset > _length;
        }
    }
} 
```

现在，它速度很快，不用担心字符串或实例化任何比数组更大的东西，而且对代码的更改就像修改数组一样简单。

构造函数中的字段初始化代替了与所需值等效的硬编码常量。如果我们使用常量，我们可以将代码缩短 6 左右“行”。这有点浪费，但允许类尽可能容易地适应新代码——您只需要更改数组列表。另外，所有的“批量”都是在实例化的时候处理的，所以它不会影响我们目标方法的效率。

乍一看，这段代码可以变得更简单。只要您在正确的代码输入上重置值，就不需要模数。

核心逻辑实际上可以写成一行代码：

```
_sequenceIndex =  (_code[_sequenceIndex] == key) ? ++_sequenceIndex : 0; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-22T16:37:01.710

在正常处理它们之前将按键捕获到 13（或代码的任何子集，因为您可能不想包含 START 键）-字符列表/数组/字符串/任何内容。每次添加键时，如果（且仅当）它是系列中的最后一个键，则将缓冲区与正确的 konami 代码匹配。

我的建议是，如果他们按下箭头键，将其映射到合理的字母......然后也映射 B 和 A，只需清除缓冲区以进行任何其他按键操作。

然后，将缓冲区设为字符串，将其与：“UUDDLRLRBABA”进行比较

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-01T21:35:26.893

根据要求，这是一个解决“问题”的类，即能够太慢地输入序列而不能成为“类似秘密代码”的“问题”。;)

NES 盒中的原始代码将在帧例程中调用，因此将通过计算执行次数来跟踪时间。

由于我们被降级为事件驱动、面向对象的编程，我们将不得不涉及事件。由于这些事件需要强制“过期”，我们将不得不涉及一个 Timer 对象。

```
using System;
using System.Windows.Forms;
using Timer=System.Timers.Timer;

namespace WindowsApplication1
{
    public class KonamiSequence
    {
        readonly Keys[] _code = { Keys.Up, Keys.Up, Keys.Down, Keys.Down, Keys.Left, Keys.Right, Keys.Left, Keys.Right, Keys.B, Keys.A };

        private int _sequenceIndex;

        private readonly int _codeLength;
        private readonly int _sequenceMax;

        private readonly Timer _quantum = new Timer();

        public KonamiSequence()
        {
            _codeLength = _code.Length - 1;
            _sequenceMax = _code.Length;

            _quantum.Interval = 3000; //ms before reset
            _quantum.Elapsed += timeout;
        }

        public bool IsCompletedBy(Keys key)
        {   
            _quantum.Start();      

            _sequenceIndex %= _sequenceMax;
            _sequenceIndex = (_code[_sequenceIndex] == key) ? ++_sequenceIndex : 0;

            return _sequenceIndex > _codeLength;
        }

        private void timeout(object o, EventArgs e)
        {
            _quantum.Stop();
            _sequenceIndex = 0;

        }
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-22T16:57:03.980

我建议您将其实现为搜索事件列表和指向该列表元素的“捕获”引用指针。

从概念上讲，您开始捕获指向搜索列表的第一个元素的指针。如果下一个事件与搜索元素匹配，则捕获指针递增到下一个元素。否则，它会重置到开头。

如果指针在最后一个元素之后递增，则表示完全匹配。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-06-12T12:31:16.500

这是一个相当简单有效的解决方案：

```
public class KonamiSequence
{
    private static readonly Keys[] KonamiCode = { Keys.Up, Keys.Up, Keys.Down, Keys.Down, Keys.Left, Keys.Right, Keys.Left, Keys.Right, Keys.B, Keys.A };

    private readonly Queue<Keys> _inputKeys = new Queue<Keys>();

    public bool IsCompletedBy(Keys inputKey)
    {
        _inputKeys.Enqueue(inputKey);

        while (_inputKeys.Count > KonamiCode.Length)
            _inputKeys.Dequeue();

        return _inputKeys.SequenceEqual(KonamiCode);
    }
} 
```

示例用法：

```
private readonly KonamiSequence _konamiSequence = new KonamiSequence();

private void KonamiForm_KeyDown(object sender, KeyEventArgs e)
{
    if (_konamiSequence.IsCompletedBy(e.KeyCode))
        MessageBox.Show("Konami!");
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-11-26T01:33:29.083

这是另一个实现，基于[James 的回答](https://stackoverflow.com/questions/469798/konami-code-in-c-sharp#813201)和评论：

```
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    public class KonamiSequence
    {
        private readonly Keys[] _code = { Keys.Up, Keys.Up, Keys.Down, Keys.Down, Keys.Left, Keys.Right, Keys.Left, Keys.Right, Keys.B, Keys.A };
        private int _index = 0;

        public bool IsCompletedBy(Keys key)
        {
            if (key == _code[_index]) {
                if (_index == _code.Length - 1) {
                    _index = 0;
                    return true;
                }
                ++_index;
            } else {
                _index = 0;
            }

            return false;
        }
    }
} 
```

*   不打扰缓存`_code.Length`（[请参阅本文](http://jacksondunstan.com/articles/3577)），但请注意，只有在键入序列中的键时才能访问它。
*   接受大小写“UUUUUUUUUDDLRLRBA”。
*   当然，如果键入错误的键，则会重置序列。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-09-24T15:17:14.967

我正在寻找同样的东西，我想出了一个非常简单的代码。Keypreview 必须在表单上为 True 在表单上声明一个名为“konami”的字符串

```
Private Sub frm_KeyPress(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles Me.KeyUp
    Dim i As String = "UpUpDownDownLeftRightLeftRightBA"
    If (e.KeyCode.ToString = "Up") And (konami <> "Up") Then konami = ""
    konami = konami & e.KeyCode.ToString
    'Debug.Print(konami)
    If konami = i Then '' << INSERT YOUR MESSAGE HERE >>  ''
    If e.KeyCode.ToString = "Return" Then konami = ""
    If konami.Length > 60 Then konami = ""
End Sub 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-04-22T20:47:50.043

我已经阅读了所有答案，发现重复输入序列的初始值是实现的常见问题。下面是一个简单的实现，不会遇到初始问题的重复。没有特殊情况，没有什么是真正硬编码的，类中指定的整数仅用于默认值。

```
public partial class KonamiCode {
    public bool IsCompletedBy(int keyValue) {
        for(var i=sequence.Count; i-->0; ) {
            if(sequence[i]!=keyValue) {
                if(0==i)
                    count=0;

                continue;
            }

            if(count!=i)
                continue;

            ++count;
            break;
        }

        var isCompleted=sequence.Count==count;
        count=isCompleted?0:count;
        return isCompleted;
    }

    public KonamiCode(int[] sequence=default(int[])) {
        this.sequence=
            sequence??new[] { 38, 38, 40, 40, 37, 39, 37, 39, 66, 65 };
    }

    int count;
    IList<int> sequence;
    public static readonly KonamiCode Default=new KonamiCode();
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-02-28T22:57:47.157

答案可以在[Reactive Extensions](http://www.introtorx.com/uat/content/v1.0.10621.0/17_SequencesOfCoincidence.html)中找到。为此，您需要一个滑动缓冲区。这意味着您必须将最近的十次击键与 Konami 代码进行比较。这使用两个不同的语句

*   获取流的窗口（最终导致 10 个同时流）
*   将每个流汇总为 IList 的缓冲区

RX 中的缓冲区为我们完成了这两项任务。缓冲最后 10 个项目并跳过 1 个（因此有效地创建了 10 个缓冲区）。

```
 var keysIO = Observable.FromEventPattern<KeyEventArgs>(this, "KeyDown")
                                    .Select(arg => arg.EventArgs.Key)
                                    .Buffer(10, 1)
                                    .Select(keys => Enumerable.SequenceEqual(keys, _konamiArray))
                                    .Where(result => result)
                                    .Subscribe(i =>
                                                    {
                                                        Debug.WriteLine("Found Konami");
                                                    }); 
```

编辑：删除了定时解决方案。，太复杂了

编辑二：我也破解了超时解决方案。SelectMany 的美丽 :-)

```
 var keysIO = Observable.FromEventPattern<KeyEventArgs>(this, "KeyDown")
                            .Select(e => e.EventArgs.Key)
                            .Window(10, 1)
                            .SelectMany(obs => obs.Buffer(TimeSpan.FromSeconds(10), 10))
                            .Where(keys => Enumerable.SequenceEqual(_konamiArray, keys))
                            .Subscribe(keys => Debug.Write("Found Konami")); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-04-08T14:33:30.617

我知道这是一个老问题，但我在 VB 中开始了同样的旅程。我为它创建了一个类：

```
Public Class Konami
    ' Here is the pattern to match
    Property KonamiOrder As List(Of Keys) = New List(Of Keys) From {Keys.Up, Keys.Up, Keys.Down, Keys.Down, Keys.Left, Keys.Right, Keys.Left, Keys.Right, Keys.B, Keys.A}

    ' Just calling these out ahead of time
    Property sequence As List(Of Boolean)
    Property ix As Integer = 0

    ' Hey new object, better set the important bits
    Public Sub New()
        me.reset()
    End Sub

    ' Reset on pattern failure, or completion
    Public Function reset() As Boolean
        Me.sequence = New List(Of Boolean) From {False, False, False, False, False, False, False, False, False, False}
        ix = 0

    End Function

    ' Here's where all the action happens
    Public Function checkKey(keycode As Keys)
        'Check to see what they pressed
        If sequence(ix) = False And keycode = KonamiOrder(ix) Then
            ' Hurray, they pressed the right key, better keep track of it
            sequence(ix) = True
            ix += 1
        Else
            ' Nope, reset
            Me.reset()
        End If

        'Is the code complete and correct?
        If sequence.Contains(False) Then
            ' Nope, send back failure
            Return False
        Else
            'Yep, reset so it can be used again and send back a success
            Me.reset()
            Return True
        End If
    End Function
End Class 
```

这只是关于使用 konami 类的示例表单代码。

```
Public Class Form1
    Private oKonami As New Konami

    Private Sub Form1_KeyUp(sender As Object, e As KeyEventArgs) Handles Me.KeyUp
        ' Send the Key press on its way, and get some logic going
        If oKonami.checkKey(e.KeyCode) Then
            ' Congrats, pattern match
            MsgBox("Konami Code Entered")
        End If
    End Sub

    Private Sub Form1_Load(sender As Object, e As EventArgs) Handles Me.Load
        ' This will intercept the key events on this form
        Me.KeyPreview = True
    End Sub
End Class 
```

[https://github.com/the1337moderator/KonamiCodeforVB.net](https://github.com/the1337moderator/KonamiCodeforVB.net)

# c# - .NET2.0 C# 互操作：如何从 C# 调用 COM 代码？

> ID：469802
> 
> 赞同：3
> 
> 时间：2009-01-22T16:17:24.950
> 
> 标签：c#, com, interop, .net-2.0, idispatch

在我上一个开发环境中，我能够轻松地与 COM 交互，调用 COM 对象上的方法。这是原始代码，翻译成 C# 样式代码（以掩盖原始语言）：

```
public static void SpawnIEWithSource(String szSourceHTML)
{
    OleVariant ie; //IWebBrowser2
    OleVariant ie = new InternetExplorer();
    ie.Navigate2("about:blank");

    OleVariant webDocument = ie.Document;
    webDocument.Write(szSourceHTML);
    webDocument.close;

    ie.Visible = True;
} 
```

现在开始尝试从托管代码与 COM 互操作的乏味、痛苦的过程。

PInvoke.net 已经包含[IWebBrower2 翻译](http://pinvoke.net/default.aspx/Interfaces/IWebBrowser2.html)，其相关部分是：

```
[ComImport, 
   DefaultMember("Name"), 
   Guid("D30C1661-CDAF-11D0-8A3E-00C04FC9E26E"), 
   InterfaceType(ComInterfaceType.InterfaceIsIDispatch), 
   SuppressUnmanagedCodeSecurity]
public interface IWebBrowser2
{
    [DispId(500)]
    void Navigate2([In] ref object URL, [In] ref object Flags, [In] ref object TargetFrameName, [In] ref object PostData, [In] ref object Headers);

    object Document { [return: MarshalAs(UnmanagedType.IDispatch)] [DispId(0xcb)] get; }
} 
```

我创建了 COM 类：

```
[ComImport]
[Guid("0002DF01-0000-0000-C000-000000000046")]
public class InternetExplorer
{
} 
```

所以现在是我实际的 C# 事务的时候了：

```
public static void SpawnIEWithSource(String szHtml)
{
    PInvoke.ShellDocView.IWebBrowser2 ie;
    ie = (PInvoke.ShellDocView.IWebBrowser2)new PInvoke.ShellDocView.InternetExplorer();

    //Navigate to about:blank to initialize the browser
    object o = System.Reflection.Missing.Value;
    String url = @"about:blank";
    ie.Navigate2(ref url, ref o, ref o, ref o, ref o);

    //stuff contents into the document
    object webDocument = ie.Document;
    //webDocument.Write(szHtml);
    //webDocument.Close();

    ie.Visible = true;
} 
```

细心的读者注意到 IWebBrowser2.Document 是一个后期绑定的 IDispatch。我们在我们和我们客户的机器上使用 Visual Studio 2005 和 .NET 2.0。

那么 .NET 2.0 调用对象上的方法的方法是什么，在某种程度上，它只支持后期绑定的 IDispatch？

快速搜索 Stack Overflow 以使用 C# 中的 IDispatch 出现[这篇文章](https://stackoverflow.com/questions/403218/does-c-net-support-idispatch-late-binding)，说我想要的在 .NET 中是不可能的。

那么是否可以从 C# .NET 2.0 使用 COM？

* * *

问题是我想在 C#/.NET 中使用一种公认的设计模式。它涉及在进程外启动 Internet Explorer，并为其提供 HTML 内容，同时不使用临时文件。

一个被拒绝的设计想法是在 WinForm 上托管 Internet Explorer。

一个可接受的替代方法是启动系统注册的 Web 浏览器，使其显示 HTML，而不使用临时文件。

绊脚石是继续在 .NET 世界中使用 COM 对象。具体问题涉及在不需要 C# 4.0 的情况下执行对 IDispatch 的后期绑定调用。（即在使用 .NET 2.0 时）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T04:04:47.813

> **更新：**根据问题更新，我删除了与问题不再相关的部分答案。但是，如果其他读者正在寻找一种在 winforms 应用程序中生成 HTML 并且不需要进程内 IE 的快速而肮脏的方法，我将留下以下内容：

**可能的场景 1：最终目标是简单地向最终用户显示 HTML 并使用 Windows 窗体**

`System.Windows.Forms.WebBrowser`是您尝试手动实现的接口的非常简单的 .NET 包装器。要获得它，将该对象的一个​​实例从您的工具栏（在“所有 Windows 窗体”部分下列为“Web 浏览器”）拖放到您的表单上。然后，在一些合适的事件处理程序上：

```
webBrowser1.Navigate("about:blank");
webBrowser1.Document.Write("<html><body>Hello World</body></html>"); 
```

在我的测试应用程序上，这正确地显示了我们都学会恐惧和厌恶的令人难以忘怀的信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T19:28:49.257

后期绑定的 IDispatch 调用在 .NET 中相对容易，虽然很糟糕：

```
public static void SpawnIEWithSource(String szHtml)
{
    // Get the class type and instantiate Internet Explorer.
    Type ieType = Type.GetTypeFromProgID("InternetExplorer.Application");
    object ie = Activator.CreateInstance(ieType);

    //Navigate to the blank page in order to make sure the Document exists
    //ie.Navigate2("about:blank");
    Object[] parameters = new Object[1];
    parameters[0] = @"about:blank";
    ie.GetType().InvokeMember("Navigate2", BindingFlags.InvokeMethod | BindingFlags.IgnoreCase, null, ie, parameters);

    //Get the Document object now that it exists
    //Object document = ie.Document;
    object document = ie.GetType().InvokeMember("Document", BindingFlags.GetProperty | BindingFlags.IgnoreCase, null, ie, null);

    //document.Write(szSourceHTML);
    parameters = new Object[1];
    parameters[0] = szHtml;
    document.GetType().InvokeMember("Write", BindingFlags.InvokeMethod | BindingFlags.IgnoreCase, null, document, parameters);

    //document.Close()
    document.GetType().InvokeMember("Close", BindingFlags.InvokeMethod | BindingFlags.IgnoreCase, null, document, null);

    //ie.Visible = true;
    parameters = new Object[1];
    parameters[0] = true;
    ie.GetType().InvokeMember("Visible", BindingFlags.SetProperty | BindingFlags.IgnoreCase, null, ie, parameters);
} 
```

最初说“在 C# 4.0 之前不可能”的引用 SO 问题已被修改，以显示在 .NET 2.0 中它是如何实现的。

[C# .NET 是否支持 IDispatch 后期绑定？](https://stackoverflow.com/questions/403218/does-c-net-support-idispatch-late-binding)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T18:49:06.200

您链接到的帖子中的答案实际上是不正确的。在 .Net 中处理基于 IDispatch 的对象通常非常容易。基本上你会经历三个步骤：

大多数作为 IDispatch 接口公开的自动化对象（可能超过 90%）都有其他接口可供非脚本类型 COM 客户端使用（IDispatch 接口实际上是从 IDispatch 派生的完整 COM 接口，或者对象支持一个或更多其他 IUnknown 派生接口）。在这种情况下，您只需导入适当的 COM 接口定义，然后将对象转换为适当的接口。演员在幕后调用 QueryInterface 并返回对所需接口的包装引用。

这是您将在上面介绍的场景中使用的技术。从 IE 自动化对象返回的 Document 对象支持 IHTMLDocument、IHTMLDocument2、IHTMLDocument3、IHTMLDocument4 和 IHTMLDocument5 接口（取决于您使用的 IE 版本）。您应该转换到适当的接口，然后调用适当的方法。例如：

```
IHTMLDocument2 htmlDoc = (IHTMLDocument2)webDocument;
htmlDoc.Write(htmlString);
htmlDoc.Close(); 
```

在自动化对象不支持替代接口的极少数情况下。然后你应该使用 VB.Net 来包装那个接口。将 Option Strict 设置为关闭（仅适用于包装类），您可以使用 VB 对后期绑定调用的内置支持来简单地调用适当的 IDispatch 方法。在极少数情况下，具有不寻常的参数类型，您可能需要对调用进行一些调整，但通常在 VB 中您可以做到！即使对 C# v4 VB 进行了动态添加，也可能对后期绑定的 COM 调用有更好的支持。

如果由于某种原因您不能使用 VB 来包装自动化接口，那么您仍然可以使用反射从 C# 进行任何必要的调用。我不会详细介绍，因为这个选项基本上不应该被使用，但这里是一个[涉及 Office 自动化的小例子](http://support.microsoft.com/kb/302902)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T11:53:04.987

见这篇文章： http: [//www.codeproject.com/KB/cs/IELateBindingAutowod.aspx](http://www.codeproject.com/KB/cs/IELateBindingAutowod.aspx)

Internet Explorer 后期绑定自动化 By yincekara

使用后期绑定的 Internet Explorer 自动化示例代码，没有 Microsoft.mshtml 和 shdocvw 依赖项。

对于 htmlDoc.write(htmlString); 调整

```
 [Guid("332C4425-26CB-11D0-B483-00C04FD90119")]
    [ComImport]
    [TypeLibType((short)4160)]
    [InterfaceTypeAttribute(ComInterfaceType.InterfaceIsIDispatch)]
    internal interface IHTMLDocument2
    {
        [DispId(1054)]
        void write([MarshalAs(UnmanagedType.BStr)] string psArray);
        //void write([MarshalAs(UnmanagedType.SafeArray, SafeArraySubType = VarEnum.VT_VARIANT)] object[] psarray); 
```

# php - 函数functionName（这里的if子句）可能吗？

> ID：469803
> 
> 赞同：0
> 
> 时间：2009-01-22T16:17:35.823
> 
> 标签：php, if-statement

```
函数 getTemplate($tpl if ($vars) echo ", $vars";)...函数
```

这有可能吗？以上是行不通的。

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-22T16:30:20.493

## Optional arguments with default values

It looks like you want an optional argument, which you can accomplish by defining a default value in the function definition:

```
function getTemplate($tpl, $vars=null)   
{

} 
```

You can call this function as getTemplate($foo) or getTemplate($foo,$bar). See the [PHP manual page on function arguments](http://www.php.net/manual/en/functions.arguments.php) for more details.

## Variable numbers of arguments

It's also possible to write functions which take a variable number of arguments, but you need to use [func_num_args](http://php.net/func_num_args), [func_get_arg](http://php.net/func_get_arg) and [func_get_args](http://php.net/func_get_args) functions to get at them. Here's an example from the manual

```
<?php
function foo() 
{
   $numargs = func_num_args();
   echo "Number of arguments: $numargs<br />\n";
   if ($numargs >= 2) {
       echo "Second argument is: " . func_get_arg(1) . "<br />\n";
   }
   $arg_list = func_get_args();
   for ($i = 0; $i < $numargs; $i++) {
       echo "Argument $i is: " . $arg_list[$i] . "<br />\n";
   }
} 

foo(1, 2, 3);
?> 
```

## Calling a function with a variable number of parameters

To round off this answer even more, suppose you'd build an array of 1..n values and wanted to pass it to the foo() function defined above? You'd use [call_user_func_array](http://php.net/call_user_func_array)

```
$values=(1,2,3,4);
call_user_func_array('foo', $values); 
```

This is the equivalent of calling

```
foo(1,2,3,4); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T16:23:26.277

What's so bad about

```
function getTemplate($tpl, $vars=null)   {} 
```

?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T16:19:40.497

```
if ($vars) { getTemplate($tpl, $vars); }
else {{ getTemplate($tpl, null); } 
```

（半伪代码）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T16:22:26.607

或者：

```
getTemplate($tpl, ($vars)?$vars:null); // not sure

getTemplate($tpl, (!empty($vars))?$vars:null); 
```

另外，如果您想要类似于 echo 的技术：

```
$code = "getTemplate($pl";
if ( $vars ) { $code = $code . ", $vars);"; }
else { $code = $code . ");"; }
$ret = eval($code); 
```

虽然这通常被认为是不好的做法（永远不要说永远）。请注意，所有发送到 eval 的代码*都将*被直接执行。所以不要将用户输入放在 eval() 调用中。

# sql - 编写 SQL 代码：与 Yell.com 相同的功能

> ID：469806
> 
> 赞同：0
> 
> 时间：2009-01-22T16:18:41.983
> 
> 标签：sql, sql-server-2005

任何人都可以帮助我尝试编写 SQL（MS SqlServer） - 我必须承认这不是最好的技能。

[我想做的是与Yell 网站](http://www.yell.com/)的搜索框显示的功能完全相同， 即

*   搜索公司类型

*   和/或公司名称

*   和/或输入公司名称

*   在一个位置

如果有人可以建议您需要编写的**SQL 代码以获得与 Yell 相同的功能，那就太好了。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T16:26:39.813

通常，一个人会做这样的事情：

```
-- All these are NULL unless provided
DECLARE @CompanyType AS varchar
DECLARE @CompanyName AS varchar
DECLARE @Town AS varchar

SELECT *
FROM TABLE_NAME
WHERE (@CompanyType IS NULL OR COMPANY_TYPE_COLUMN LIKE '%' + @CompanyType  + '%')
    AND (@CompanyName IS NULL OR COMPANY_NAME_COLUMN LIKE '%' + @CompanyName + '%')
    AND (@Town IS NULL OR TOWN_COLUMN LIKE '%' + @Town + '%') 
```

或者这个（只匹配带有通配符的列的开头）：

```
-- All these are NULL unless provided
DECLARE @CompanyType AS varchar
DECLARE @CompanyName AS varchar
DECLARE @Town AS varchar

SELECT *
FROM TABLE_NAME
WHERE (@CompanyType IS NULL OR COMPANY_TYPE_COLUMN LIKE @CompanyType  + '%')
    AND (@CompanyName IS NULL OR COMPANY_NAME_COLUMN LIKE @CompanyName + '%')
    AND (@Town IS NULL OR TOWN_COLUMN LIKE @Town + '%') 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T16:21:16.500

你能提供 sql 运行的数据库布局（模式）吗？有必要给你一个准确的结果。

但一般来说，你正在寻找的是

```
SELECT * FROM tablename WHERE companyType = 'type' OR companyName = 'companyName' 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T16:21:27.623

您首先需要的不是 SQL 代码，而是数据库设计。只有这样，开始编写 SQL 才有意义。

与 Yell 的功能相匹配的简单表模式可能类似于：

```
CREATE TABLE Company (
    company_id INT NOT NULL PRIMARY KEY IDENTITY(1,1),
    company_name VARCHAR(255) NOT NULL,
    location VARCHAR(255) NOT NULL
) 
```

然后你会用 SQL 的名字来搜索它，比如：

```
SELECT * FROM Company WHERE company_name like '%text%' 
```

或按位置，如：

```
SELECT * FROM Company WHERE location = 'Location' 
```

当然，真实世界的位置搜索必须使用确切的城市和州，或邮政编码查找，或它们的某种智能组合。然后一个真正的表会有更多的字段，比如描述等。但这是基本的想法。

# wpf - “属性‘路径’没有值”

> ID：469810
> 
> 赞同：1
> 
> 时间：2009-01-22T16:20:22.087
> 
> 标签：wpf, data-binding, datacontext

我正在使用以下 xaml 来填充 dataContext：

```
DataContext="{Binding RelativeSource={RelativeSource TemplatedParent}}" 
```

该应用程序运行良好，但 Cider 抱怨我必须设置 Path 属性。我对整个对象感兴趣，而不是对特定属性感兴趣。

我希望有办法让设计师支持回来！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T16:30:21.257

在此处查看第 2.3.8.7 节（您需要向下滚动一点）：

[Visual Studio 2008 Service Pack 1 (SP1) 自述文件](http://download.microsoft.com/download/A/2/8/A2807F78-C861-4B66-9B31-9205C3F22252/VS2008SP1Readme.htm#Windows%20Presentation%20Foundation%20(WPF)%20Designer%20for%20Visual%20Studio)

尝试将您的标签更改为

```
DataContext="{Binding RelativeSource={RelativeSource TemplatedParent},Path=.}" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T19:55:54.307

谢谢，这正是我需要让我的 RD 工作，修复来自：

```
CommandTarget="{Binding RelativeSource={RelativeSource TemplatedParent}}" 
```

到：

```
CommandTarget="{Binding RelativeSource={RelativeSource TemplatedParent},Path=.}" 
```

# php - Has anyone ever created a shopping cart on the Expression Engine?

> ID：469842
> 
> 赞同：5
> 
> 时间：2009-01-22T16:27:44.927
> 
> 标签：php, expressionengine

Well I'm building a site for a client on the [Expression Engine CMS](http://expressionengine.com/) and just wondering if anyone had any experience building a shopping cart on it, either custom or via a plug in.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-10-24T14:09:38.907

现在有 3 款出色的 Expression Engine 购物车可供您选择。

[Exp:presso 商店](http://devot-ee.com/add-ons/expresso-store)

[购物车Throb](http://devot-ee.com/add-ons/cartthrob-2)

[辉煌零售](http://devot-ee.com/add-ons/brilliantretail)

我使用的是 CartThrob，我发现它非常易于使用，并且支持也非常好。Exp:presso Store 在 2012 年 4 月 30 日还整理了一张[出色的对比图表](https://exp-resso.com/store/comparison)——但不确定从那以后它是否已更新。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-30T02:11:26.773

Expression Engine 带有[简单的商务模块](http://expressionengine.com/downloads/details/simple_commerce_module/ "表达引擎：简单商务模块")，可以满足最常见的购物车需求。它利用 Paypal IPN 服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T09:48:35.703

还可以查看[Mark Bowen 的 Shopping Cart 插件](http://expressionengine.com/forums/viewthread/109491/)，它与 EE 的 Simple Commerce Module 一起使用并提供额外的功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-20T03:42:18.387

我在这个网站上使用了 Foxee 和 Expression Engine 和 Foxycart：http://prints995.com，[效果](http://prints995.com)很好。最新版本的 FoxEE 相当不错。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-19T11:57:19.510

我在生产网站 (http://cartthrob.com/) 上使用了 CartThrob。它是非常可定制的——我添加了一个 PayPal Payments Pro UK 支付网关和一个完全 AJAX 的购物车。供参考的网站是[http://two-zero.co.uk](http://two-zero.co.uk)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-12T01:59:59.670

我刚刚开始使用与 FoxyCart 相关的 FoxEE 模块 ( [http://www.hccdevelopment.com/Web-Based-Software/Product/FoxEE/](http://www.hccdevelopment.com/Web-Based-Software/Product/FoxEE/) ) 进行 EE/Ecommerce 项目。它看起来是电子商务的一个非常全面的选择。比简单商务模块好得多。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-16T09:47:33.963

最近发布了一个新的，名为[Cartthrob](http://cartthrob.com) - 它允许您以与 EE 的其余部分相同的灵活性来构建您的商店。它在交付时不假设您的设置和愿望，并且包含一组 EE 标签。

# xslt - 使用 xslt 将 xhtml 转换为 wiki 语法

> ID：469844
> 
> 赞同：3
> 
> 时间：2009-01-22T16:29:04.427
> 
> 标签：xslt, xhtml, syntax, wiki

我想**使用 xslt 将 xhtml 转换为 dokuwiki 语法**。

现在，我似乎无法解决的一件事是如何处理嵌套列表。dokuwiki 语法对列表项使用星号 (*)，每个嵌套级别前面有两个空格（参见[wiki 语法](http://www.dokuwiki.org/syntax#lists)）。

**我的问题：**在以下示例中，与列表**项 2.1.1匹配的****<xsl:template mach="li">**如何知道它的**嵌套级别**，以便预先添加适量的空格？

 ****```
* list item 1
* list item 2
  * list item 2.1
    * list item 2.1.1
  * list item 2.2
  * list item 2.3
* list item 3 
```

对应于

*   清单项目 1
*   清单项目 2
    *   清单项目 2.1
        *   清单项目 2.1.1
    *   清单项目 2.2
    *   清单项目 2.3
*   清单项目 3

这就是以下 html 的显示方式：

```
<ul>
    <li>
        list item 1
    </li>
    <li>
        list item 2
        <ul>
            <li>
                list item 2.1
                <ul>
                    <li>list item 2.1.1</li>
                </ul>
            </li>
            <li>list item 2.2</li>
            <li>list item 2.3</li>
        </ul>
    </li>
    <li>
        list item 3
    </li>
</ul> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T23:45:41.410

**以下转换**：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output method="text"/>

 <xsl:strip-space elements="*"/>

 <xsl:variable name="vBlanks"
  select="'                                        '"/>
 <xsl:variable name="vnNestSpaces" select="2"/>

    <xsl:template match="li">
      <xsl:variable name="vNestLevel"
           select="count(ancestor::li)"/>
      <xsl:value-of select=
       "concat('&#xA;',
               substring($vBlanks,1,$vnNestSpaces*$vNestLevel),
               '*  ', normalize-space(text()[1])
               )"/>
      <xsl:apply-templates select="*"/>
    </xsl:template>
</xsl:stylesheet> 
```

**应用于原始 XML 文档时**：

```
<ul>
    <li> list item 1
    </li>
    <li> list item 2        
        <ul>
            <li> list item 2.1                
                <ul>
                    <li>list item 2.1.1</li>
                </ul>
            </li>
            <li>list item 2.2</li>
            <li>list item 2.3</li>
        </ul>
    </li>
    <li> list item 3    </li>
</ul> 
```

**产生所需的结果**：

```
*  list item 1
*  list item 2
  *  list item 2.1
    *  list item 2.1.1
  *  list item 2.2
  *  list item 2.3
*  list item 3 
```

**请注意以下几点**：

1.  所需的缩进由 的值决定`count(ancesstor::li)`。

2.  **缩进的空间直接**取自一个足够大的空白行（包含足够的空白以进行 20 层嵌套）。**无需逐个递归输出**空格。

3.  **由于上述 2.，转换效率**更高。

4.  注意 XPath[**`substring()`**](http://www.w3.org/TR/xpath#function-substring)函数的使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T17:45:02.930

这是我如何让它工作的：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output method="text"/>
    <xsl:strip-space elements="*"/>
    <xsl:template match="//li">
        <xsl:call-template name="loop">
            <xsl:with-param name="maxcount" select="count(ancestor::li)"/>
            <xsl:with-param name="initial-value" select="0"/>
        </xsl:call-template>
        <xsl:text>* </xsl:text>
        <xsl:value-of select="normalize-space(text())"/>
        <xsl:text>&#xd;</xsl:text>
        <xsl:apply-templates select="ul/li" />
    </xsl:template>
    <xsl:template name="loop">
        <xsl:param name="maxcount"/>
        <xsl:param name="initial-value"/>
        <xsl:if test="$initial-value &lt; $maxcount">
            <xsl:text>&#x9;</xsl:text>
            <xsl:call-template name="loop">
                <xsl:with-param name="maxcount" select="$maxcount"/>
                <xsl:with-param name="initial-value" select="$initial-value+1"/>
            </xsl:call-template>
        </xsl:if>
    </xsl:template>
</xsl:stylesheet> 
```

以下是它的分解方式：

```
<xsl:output method="text"/>
<xsl:strip-space elements="*"/> 
```

您需要确保 XSLT 的输出是文本，并且您还希望去除任何现有的空白。

```
<xsl:template match="//li">
    ...
</xsl:template> 
```

这是您的主要模板，将匹配文档中的每个模板`<li>`。此模板的第一步是输出适当数量的制表符（随意调整为空格或任何您需要的）。这样做的方法是调用一个自定义`loop`模板，该模板将递归调用自身，从`initial-value`to循环，在每次迭代`maxcount`时输出一个制表符 ( )。`&#x9;`

```
<xsl:text>* </xsl:text>
<xsl:value-of select="normalize-space(text())"/>
<xsl:text>&#xd;</xsl:text> 
```

该块仅输出`*`前面带有换行符 ( `&#xd;`) 的文本。请注意，我使用`text()`函数而不是`.`检索节点的值。如果您不这样做，则父节点的输出将（根据 W3C 建议应如此）将所有子文本节点与父节点连接起来。

```
<xsl:apply-templates select="ul/li" /> 
```

最后，我们递归调用当前模板，但显式引用下一个`<li>`是 a 的直接子级的`<ul>`模板——这可以防止我们在同一个父元素上意外调用模板两次。

# php - MySQL 中各种日期/时间字段类型的优缺点是什么？

> ID：469846
> 
> 赞同：2
> 
> 时间：2009-01-22T16:30:13.237
> 
> 标签：php, mysql, datetime, timestamp, lamp

MySQL 中的日期和时间可以存储为 DATETIME、TIMESTAMP 和 INTEGER（自 1970 年 1 月 1 日以来的秒数）。每种方法的优缺点是什么，尤其是在 LAMP 堆栈下开发时？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-22T16:44:41.557

*   TIMESTAMP 存储在 MySQL 专有方法中（尽管它基本上只是一个由年、月、日、小时、分钟和秒组成的字符串），此外，只要插入或更改记录，TIMESTAMP 类型的字段就会自动更新，并且没有显式给定字段值：

    ```
    mysql> create table timestamp_test(
        id integer not null auto_increment primary key, 
        val varchar(100) not null default '', ts timestamp not null); 
    Query OK, 0 rows affected (0.00 sec)

    mysql> insert into timestamp_test (val) values ('foobar');
    Query OK, 1 row affected (0.00 sec)

    mysql> select * from timestamp_test;
    +----+--------+----------------+
    | id | val    | ts             |
    +----+--------+----------------+
    |  1 | foobar | 20090122174108 |
    +----+--------+----------------+
    1 row in set (0.00 sec)

    mysql> update timestamp_test set val = 'foo bar' where id = 1;
    Query OK, 1 row affected (0.00 sec)
    Rows matched: 1  Changed: 1  Warnings: 0

    mysql> select * from timestamp_test;
    +----+---------+----------------+
    | id | val     | ts             |
    +----+---------+----------------+
    |  1 | foo bar | 20090122174123 |
    +----+---------+----------------+
    1 row in set (0.00 sec)

    mysql> 
    ```

*   DATETIME 是日期和时间的标准数据类型，它与 MySQL 中的日期和时间函数一起使用。我可能会在实践中使用它

*   不建议以 INTEGER 格式存储日期，因为由于时区、闰年等有趣的问题，您正在打开一个真正的蠕虫罐 - 至少如果您打算根据存储在该字段中的特定日期查询数据库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T16:44:30.807

我会使用 MySQL 中的 DATETIME 或 DATE 字段来保存数据。至少，如果您要将日期值存储到 2038 年：[http](http://en.wikipedia.org/wiki/Year_2038_problem) ://en.wikipedia.org/wiki/Year_2038_problem 。如果您在以不同方式存储整数的系统上，您可能不会遇到此问题。

比较日期值甚至时间戳仍然很容易。

```
SELECT * FROM myTable WHERE startDate > '2009-01-01'
SELECT * FROM myTable WHERE UNIX_TIMESTAMP(startDate) > 1232541482 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T16:40:49.410

好吧，我想以下内容将有助于澄清。

日期和时间可以存储在 mysql 的 DATETIME 字段中。

如果您希望在创建行时添加时间戳，则使用 TIMESTAMP - 该字段将在创建时自动填写。

对 Date 使用整数有点矫枉过正，因为这本质上是 DATETIME 所做的，但会为您完成所有耗时的转换。

您是否有兴趣了解某个特定的优点或缺点？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T16:41:59.470

mysql 中的时间戳可能非常棘手。如果没有仔细声明，您最终可能会得到在每次更新行时自动更改其值的字段（即使您没有明确更新它）。

[http://dev.mysql.com/doc/refman/5.0/en/timestamp.html](http://dev.mysql.com/doc/refman/5.0/en/timestamp.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T16:44:39.667

如果您需要时间戳的毫秒保真度，则需要将其保存为整数。不过要小心，这会使事情复杂化。

# c++ - 使用 STL 迭代器而不初始化它

> ID：469849
> 
> 赞同：2
> 
> 时间：2009-01-22T16:30:34.627
> 
> 标签：c++, stl, scope, iterator

我想做这样的事情：

```
container::iterator it = NULL;

switch ( eSomeEnum )
{
case Container1:
it = vecContainer1.begin();
break;

case Container2:
it = vecContainer2.begin();
break;
...

}

for( ; it != itEnd ; ++it )
{ 
..
} 
```

但我无法创建迭代器并将其初始化为 NULL。有什么办法可以做到这一点吗？理想情况下，我会在交换机中创建并分配迭代器，但它会立即超出范围。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-22T16:34:27.410

您根本不需要初始化它，因为迭代器是 DefaultConstructible。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-22T16:41:28.177

你需要做的就是改变

```
container::iterator it = NULL; 
```

到

```
container::iterator it; 
```

我认为您的代码将按预期工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-22T18:22:11.920

您实际上需要一个范围，而不仅仅是开始迭代器。请注意，您无法比较来自不同容器的迭代器，因此您最好选择范围，而不是迭代器。您可以使用[Boost.Range](http://www.boost.org/doc/libs/1_37_0/libs/range/index.html)来实现它：

```
#include <boost/range.hpp>
#include <boost/foreach.hpp>

boost::iterator_range< container::iterator > r;
switch( e )
{
    case Container1:
        r = boost::make_iterator_range( vecContainer1 );
    break;

    case Container2:
        r = boost::make_iterator_range( vecContainer2 );
    break;

    ...
}

BOOST_FOREACH( container::value_type value, r )
{
    ...
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-22T17:18:58.677

当循环测试结束时，您应该构造它以评估什么`itEnd`值。

# javascript - Loading Flexigrid for jQuery with JSON String

> ID：469852
> 
> 赞同：9
> 
> 时间：2009-01-22T16:32:05.013
> 
> 标签：javascript, json

I am trying to load the Flexigrid by using a JSON String which is returned by a WCF Service.

My Service has a `public string GetContacts(string CustomerID)` method and it returns a Json string.

That JSON string is created from a List object by using `System.Web.Script.Serialization.JavaScriptSerializer` class. So, my aim is to bind the JSON string to the my Flexigrid as objects. I convert the web service result to objects using

```
var customer = eval("("+result+")"); 
```

The result is the JSON string being returned from service. Is there any way to bind customer objects to Flexigrid?

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-24T14:35:13.803

Flexigrid在json中需要如下格式

**编辑**感谢 EAMann 的格式更新。

```
 total: (no of rec)
 page : (page no)
 rows : [{cell: [ (col1 value) , (col2 value) ,.. ] },
        {cell: [ (col1 value) , (col2 value) ,.. ] }] 
```

为了将数据绑定到网格，我更喜欢通过网络发送数据，然后在客户端上对其进行格式化，但这只是我这里的一个例子

```
function formatCustomerResults(Customers) {
  var rows = Array();

  for (i = 0; i < Customers.length; i++) {
    var item = Customers[i];
    //Do something here with the link
    var link = "alert('opening item " + item.DealGuid + "');"

    rows.push({
      cell: [item.DealId,
        item.Created,
        item.CurrentStatus,
        item.LastNote,
        '<a href="javascript:void(0);" onclick="' + link + '" >view</a>'
      ]
    });
  }

  return {
    total: Customers.length,
    page: 1,
    rows: rows
  };
} 
```

然后你只需要

```
$("#FlexTable").flexAddData(formatCustomerResults(eval(data))); 
```

ps这最后一点是jquery语法

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-12-02T18:32:00.943

这是一篇较旧的帖子，但我想我会添加另一种方法来使用 almog.ori 提供的出色脚本。

OP 说他的数据是从 WCF 服务返回的。如果您将操作合同主体样式标记为裸露，您可以使用 preProcess 属性添加您的 formatCustomerResults（或其他函数）函数以初始加载网格。

像这样：

```
$("#gridContainer").flexigrid({
url: '/YourService.svc/..',
method: 'GET',
dataType: 'json',
preProcess: formatCustomerResults,
...
});
function formatCustomerResults(data){
... 
```

希望这可以帮助某人。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-08-13T18:11:35.173

almog.ori 的答案几乎是完美的。事实上，这就是我在尝试谷歌解决方案之前构建东西的方式。不过有一个例外。

JSON 对象应该是：

```
total: (no of rec),
page : (page no),
rows : [{cell: [ (col1 value) , (col2 value) ,.. ] },
        {cell: [ (col1 value) , (col2 value) ,.. ] }] 
```

如果你忽略了`rows`元素的数组格式，你最终会阻塞 Flexigrid 并抛出各种错误。但我已经验证，只要您记住脚本的哪些部分采用 JSON 对象，哪些部分采用 JSON 对象数组，它就可以*完美地工作。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-06T16:11:41.023

我建议您按照此示例解析您的 JSON 代码并向服务器发出请求：

第 1 步：使用函数解析

```
function parsedForm(json)
{
var h = "";

if (json.post.val1)
    h += "<b>Value 1</b>: " + json.post.val1 + "<br />";

h += "<b>Value 2</b>: " + json.post.val2 + "<br />";
h += "<b>Value 3</b>: " + json.post.val3 + "<br />";

if (json.post.val4)
    h += "<b>Value 4</b>: " + json.post.val4 + "<br />";

$('#fdata').empty().html(h);
$('.formdata').slideDown();

return json;
} 
```

第 2 步：flexigrid 视图代码

```
$("#flex1").flexigrid({
    url: 'post2.php',
    dataType: 'json',
    colModel : [
        {display: 'ISO', name : 'iso', width : 40, sortable : true, align: 'center'},
        {display: 'Name', name : 'name', width : 180, sortable : true, align: 'left'},
        {display: 'Printable Name', name : 'printable_name', width : 120, sortable : true, align: 'left'},
        {display: 'ISO3', name : 'iso3', width : 130, sortable : true, align: 'left', hide: true},
        {display: 'Number Code', name : 'numcode', width : 80, sortable : true, align: 'right'}
        ],
    searchitems : [
        {display: 'ISO', name : 'iso'},
        {display: 'Name', name : 'name', isdefault: true}
        ],
    sortname: "iso",
    sortorder: "asc",
    usepager: true,
    title: 'Countries',
    useRp: true,
    rp: 15,
    showTableToggleBtn: true,
    width: 700,
    onSubmit: addFormData,
    preProcess: parsedForm,
    height: 200
}); 
```

第 3 步：此外，您可以验证或序列化数据以请求服务器

```
function addFormData(){
    //passing a form object to serializeArray will get the valid data from all the objects, but, if the you pass a non-form object, you have to specify the input elements that the data will come from
    var dt = $('#sform').serializeArray();
    $("#flex1").flexOptions({params: dt});
    return true;
}

$('#sform').submit(function (){
    $('#flex1').flexOptions({newp: 1}).flexReload();
    return false;
}); 
```

我希望它会有所帮助！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-18T14:51:47.763

Make sure you have the dataType option set to json.

```
$('#gridContainer').flexigrid({
  singleSelect: true,
  showToggleBtn: false,
  dataType: 'json'
}); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-02T17:24:15.040

还要确保您使用的是正确的 HTTP 方法，默认为 POST

要使用 GET：

```
 $("#gridContainer").flexigrid({
    url: '/json/files.json',
    method: 'GET',
    dataType: 'json', 
```

...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-03-09T09:37:35.793

**nameEqualsPNamePrubeGoldberg 的preProcess**解决方案完美运行。

这就是我的 preProcess 自定义函数的样子。

```
var rows = Array();
$.each(data.rows,function(i,row){
    rows.push({id:row.val1, cell:[row.val2,row.val3]});
});

return {
      total:data.total,
      page:data.page,
      rows:rows
}; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-04-16T18:56:31.127

尝试使您的 JSON 字符串中的第一个元素像这样。

```
`{"total" : 2,"page":1,"rows":[ {"cell" : ["226 CLAVEN LN", "312"]},{"cell" : ["1377 FAIRFAX PIKE","280"]}]}` 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-05-02T16:57:42.840

我相信最新的 flex 代码使用 preProcess 打破了解决方案。

```
 addData: function (data) { //parse data

            if (p.dataType == 'json') {
                data = $.extend({rows: [], page: 0, total: 0}, data);
            }
            if (p.preProcess) {
                data = p.preProcess(data);
            } 
```

您需要翻转它，以便 preProcess if 位于 JSON if 类型之前。否则，作为答案列出的功能将无法正常工作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-07-30T00:34:34.477

它很旧，我知道......但这是一个有效的 json 示例：

```
{
    "total": 5,
    "page": "1",
    "rows": [
        {"cell": [1, "asd", "dsa", "2013-07-30"]},
        {"cell": [2, "asd", "dsa", "2013-07-30"]},
        {"cell": [3, "asd", "dsa", "2013-07-30"]},
        {"cell": [4, "asd", "dsa", "2013-07-30"]},
        {"cell": [5, "asd", "dsa", "2013-07-30"]}
    ]
} 
```

（总共 5 个结果；第一页（它们不是从零开始的）；5 行数据，每行包含 { ID, "asd", "dsa", "a date" } ）

# asp.net - css、div 和 asp 的不透明度问题：图像

> ID：469854
> 
> 赞同：0
> 
> 时间：2009-01-22T16:32:59.940
> 
> 标签：asp.net, css

我有一个`opacity`设置为 60 的 div。在 div 中，我有一个 asp:Image。看起来不透明度`div`也在设置图像的不透明度。我尝试为图像创建一个单独的类并将其设置`opacity`为 100，但这似乎不起作用。有没有人有办法解决吗？

```
<div id="PleaseWait" class="Splash">
    <asp:Image ID="Logo" runat="server" ImageUrl="logo.png" CssClass="imgOpac" />

<div style="color: White; font-size: medium;">
    Please wait, searching spectrum listings ...</div>
</div>

<style id="splash" type="text/css">
    .Splash
    {
        padding-top:200px;
        display: none;
        text-align: center;
        color: White;
        vertical-align: top;
        width: 100%;
        height: 100%; 
        filter:alpha(opacity = 60);
        -moz-opacity:0.6;
        background-color:#000000;
        position:absolute;
        z-index:500;
        top:0%;
        left:0%;
    } 
    .imgOpac
    {
        filter:alpha(opacity = 100);
        -moz-opacity:1.0;
    }
    </style> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T16:36:44.677

这就是css继承的工作原理。您的图像正在从其父 div 继承其不透明度设置。所以 60% 的 100% 仍然是 60%。

有关一般解决方法（查看源代码），请参阅[http://www.hedgerwow.com/360/dhtml/css-opacity-inherit.html 。](http://www.hedgerwow.com/360/dhtml/css-opacity-inherit.html)基本技巧是堆叠元素，一个不透明的元素在下面，一个没有。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T18:14:11.797

试试这个：

```
.Splash .imgOpac
{
    filter:alpha(opacity = 100);
    -moz-opacity:1.0;
} 
```

那应该覆盖 Splash 类。

# c# - How do I convert from a possibly Windows 1252 'ANSI' encoded uploaded file to UTF8 in .NET?

> ID：469859
> 
> 赞同：3
> 
> 时间：2009-01-22T16:34:15.303
> 
> 标签：c#, asp.net, vb.net, unicode

I've got a `FileUpload` control in an ASP.NET web page which is used to upload a file, the contents of which (in a stream) are processed in the C# code behind and output on the page later, using `HtmlEncode`.

But, some of this output is becoming mangled, specifically the symbol '£' is output as the Unicode FFFD REPLACEMENT CHARACTER. I've tracked this down to the input file, which is Windows 1252 ('ANSI') encoded.

The question is,

1.  How do I determine whether the file is encoded as 1252 or UTF8? It could be either, and

2.  How do I convert it to UTF8 if it is in Windows 1252, preserving the symbol £ etc?

I've looked online but cannot find a satisfactory answer.

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-22T16:54:47.353

If you know that the file is encoded with Windows 1252, you can open the file with a StreamReader and pass the proper encoding. That is:

```
StreamReader reader = new StreamReader("filename", Encoding.GetEncoding("Windows-1252"), true); 
```

The "true" tells it to set the encoding based on the byte order marks at the front of the file, if they're there. Otherwise it opens it as Windows-1252.

You can then read the file and, if you want to convert to UTF-8, write to a file that you've opened with that endcoding.

The short answer to your first question is that there isn't a 100% satisfactory way to determine the encoding of a file. If there are byte order marks, you can determine what flavor of Unicode it is, but without the BOM, you're stuck with using heuristics to determine the encoding.

I don't have a good reference for the heuristics. You might search for "how does Notepad determine the character set". I recall seeing something about that some time ago.

In practice, I've found the following to work for most of what I do:

```
StreamReader reader = new StreamReader("filename", Encoding.Default, true); 
```

Most of the files I read are those that I create with .NET's StreamWriter, and they're in UTF-8 with the BOM. Other files that I get are typically written with some tool that doesn't understand Unicode or code pages, and I just treat it as a stream of bytes, which Encoding.Default does well.

# c# - 在 .NET 应用程序的重定向控制台输出中检测封闭管道

> ID：469860
> 
> 赞同：11
> 
> 时间：2009-01-22T16:34:26.770
> 
> 标签：c#, .net, stream, pipe, redirect

当应用程序将其输出通过管道传输到另一个程序并且另一个程序在应用程序完成之前终止或关闭管道时，.NET`Console`类及其默认`TextWriter`实现（可`Console.Out`在 eg 中隐含地使用`Console.WriteLine()`）不会发出任何错误信号。这意味着应用程序可能会运行比必要的更长的时间，将输出写入黑洞。

**如何检测重定向管道另一端的关闭？**

更详细的解释如下：

下面是一对演示该问题的示例程序。`Produce`相当慢地打印大量整数，以模拟计算的效果：

```
using System;
class Produce
{
    static void Main()
    {
        for (int i = 0; i < 10000; ++i)
        {
            System.Threading.Thread.Sleep(100); // added for effect
            Console.WriteLine(i);
        }
    }
} 
```

`Consume`只读取前 10 行输入然后退出：

```
using System;
class Consume
{
    static void Main()
    {
        for (int i = 0; i < 10; ++i)
            Console.ReadLine();
    }
} 
```

如果这两个程序被编译，并且第一个的输出通过管道传输到第二个，如下所示：

```
Produce | Consume 
```

...可以观察到，在终止`Produce`后很长时间仍会继续运行。`Consume`

实际上，我的`Consume`程序是 Unix 风格`head`的，我的`Produce`程序打印的数据计算成本很高。我想在管道的另一端关闭连接时终止输出。

我怎样才能在.NET 中做到这一点？

（我知道一个明显的替代方法是传递一个命令行参数来限制输出，这确实是我目前正在做的事情，但我仍然想知道如何做到这一点，因为我希望能够做出更多关于何时终止读取的可配置判断；例如管道通过`grep`before `head`。）

**更新：**看起来很可怕`System.IO.__ConsoleStream`，.NET 中的实现被硬编码以忽略错误 0x6D ( `ERROR_BROKEN_PIPE`) 和 0xE8 ( `ERROR_NO_DATA`)。这可能意味着我需要重新实现控制台流。叹...）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-23T15:24:40.453

为了解决这个问题，我必须在 Win32 文件句柄上编写自己的基本流实现。这并不是很困难，因为我不需要实现异步支持、缓冲或搜索。

不幸的是，需要使用不安全的代码，但这对于将在本地运行并完全信任的控制台应用程序通常不是问题。

这是核心流：

```
class HandleStream : Stream
{
    SafeHandle _handle;
    FileAccess _access;
    bool _eof;

    public HandleStream(SafeHandle handle, FileAccess access)
    {
        _handle = handle;
        _access = access;
    }

    public override bool CanRead
    {
        get { return (_access & FileAccess.Read) != 0; }
    }

    public override bool CanSeek
    {
        get { return false; }
    }

    public override bool CanWrite
    {
        get { return (_access & FileAccess.Write) != 0; }
    }

    public override void Flush()
    {
        // use external buffering if you need it.
    }

    public override long Length
    {
        get { throw new NotSupportedException(); }
    }

    public override long Position
    {
        get { throw new NotSupportedException(); }
        set { throw new NotSupportedException(); }
    }

    static void CheckRange(byte[] buffer, int offset, int count)
    {
        if (offset < 0 || count < 0 || (offset + count) < 0
            || (offset + count) > buffer.Length)
            throw new ArgumentOutOfRangeException();
    }

    public bool EndOfStream
    {
        get { return _eof; }
    }

    public override int Read(byte[] buffer, int offset, int count)
    {
        CheckRange(buffer, offset, count);
        int result = ReadFileNative(_handle, buffer, offset, count);
        _eof |= result == 0;
        return result;
    }

    public override void Write(byte[] buffer, int offset, int count)
    {
        int notUsed;
        Write(buffer, offset, count, out notUsed);
    }

    public void Write(byte[] buffer, int offset, int count, out int written)
    {
        CheckRange(buffer, offset, count);
        int result = WriteFileNative(_handle, buffer, offset, count);
        _eof |= result == 0;
        written = result;
    }

    public override long Seek(long offset, SeekOrigin origin)
    {
        throw new NotSupportedException();
    }

    public override void SetLength(long value)
    {
        throw new NotSupportedException();
    }

    [return: MarshalAs(UnmanagedType.Bool)]
    [DllImport("kernel32", SetLastError=true)]
    static extern unsafe bool ReadFile(
        SafeHandle hFile, byte* lpBuffer, int nNumberOfBytesToRead,
        out int lpNumberOfBytesRead, IntPtr lpOverlapped);

    [return: MarshalAs(UnmanagedType.Bool)]
    [DllImport("kernel32.dll", SetLastError=true)]
    static extern unsafe bool WriteFile(
        SafeHandle hFile, byte* lpBuffer, int nNumberOfBytesToWrite, 
        out int lpNumberOfBytesWritten, IntPtr lpOverlapped);

    unsafe static int WriteFileNative(SafeHandle hFile, byte[] buffer, int offset, int count)
    {
        if (buffer.Length == 0)
            return 0;

        fixed (byte* bufAddr = &buffer[0])
        {
            int result;
            if (!WriteFile(hFile, bufAddr + offset, count, out result, IntPtr.Zero))
            {
                // Using Win32Exception just to get message resource from OS.
                Win32Exception ex = new Win32Exception(Marshal.GetLastWin32Error());
                int hr = ex.NativeErrorCode | unchecked((int) 0x80000000);
                throw new IOException(ex.Message, hr);
            }

            return result;
        }
    }

    unsafe static int ReadFileNative(SafeHandle hFile, byte[] buffer, int offset, int count)
    {
        if (buffer.Length == 0)
            return 0;

        fixed (byte* bufAddr = &buffer[0])
        {
            int result;
            if (!ReadFile(hFile, bufAddr + offset, count, out result, IntPtr.Zero))
            {
                Win32Exception ex = new Win32Exception(Marshal.GetLastWin32Error());
                int hr = ex.NativeErrorCode | unchecked((int) 0x80000000);
                throw new IOException(ex.Message, hr);
            }
            return result;
        }
    }
} 
```

`BufferedStream`如果需要，可以围绕它进行缓冲，但对于控制台输出，`TextWriter`无论如何都会进行字符级缓冲，并且只刷新换行符。

流滥用`Win32Exception`以提取错误消息，而不是调用`FormatMessage`自身。

基于这个流，我能够为控制台 I/O 编写一个简单的包装器：

```
static class ConsoleStreams
{
    enum StdHandle
    {
        Input = -10,
        Output = -11,
        Error = -12,
    }

    [DllImport("kernel32.dll", SetLastError = true)]
    static extern IntPtr GetStdHandle(int nStdHandle);  

    static SafeHandle GetStdHandle(StdHandle h)
    {
        return new SafeFileHandle(GetStdHandle((int) h), true);
    }

    public static HandleStream OpenStandardInput()
    {
        return new HandleStream(GetStdHandle(StdHandle.Input), FileAccess.Read);
    }

    public static HandleStream OpenStandardOutput()
    {
        return new HandleStream(GetStdHandle(StdHandle.Output), FileAccess.Write);
    }

    public static HandleStream OpenStandardError()
    {
        return new HandleStream(GetStdHandle(StdHandle.Error), FileAccess.Write);
    }

    static TextReader _in;
    static StreamWriter _out;
    static StreamWriter _error;

    public static TextWriter Out
    {
        get
        {
            if (_out == null)
            {
                _out = new StreamWriter(OpenStandardOutput());
                _out.AutoFlush = true;
            }
            return _out;
        }
    }

    public static TextWriter Error
    {
        get
        {
            if (_error == null)
            {
                _error = new StreamWriter(OpenStandardError());
                _error.AutoFlush = true;
            }
            return _error;
        }
    }

    public static TextReader In
    {
        get
        {
            if (_in == null)
                _in = new StreamReader(OpenStandardInput());
            return _in;
        }
    }
} 
```

最终结果是在管道的另一端终止连接后写入控制台输出会导致消息出现一个很好的异常：

> 管道正在关闭

通过捕捉并忽略`IOException`最外层的，看起来我很高兴。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T18:43:56.930

我同意，如果不报告 ERROR_BROKEN_PIPE 和 ERROR_NO_DATA 错误，__ConsoleStream 对您毫无用处。我很好奇他们为什么选择将其排除在外。

对于那些想要跟进的人，请查看以下链接以获取相当古老但仍然相关的 __ConsoleStream 列表...

[http://www.123aspx.com/Rotor/RotorSrc.aspx?rot=42958](http://www.123aspx.com/Rotor/RotorSrc.aspx?rot=42958)

# gridview - Updating a gridview based on dundas chart callback

> ID：469864
> 
> 赞同：0
> 
> 时间：2009-01-22T16:35:06.597
> 
> 标签：gridview, asp.net-ajax, asp.net-2.0, dundas

I have a dundas pie chart which when clicked issues a client callback which updates another chart associated with it. Basically its like a drill down thing. I also want to update my gridview based on the user's selection of the pie. But since the update of chart is being done using dundas client callback I'm unable to rebind my Gridview. Is there any way to do it? .

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-17T16:11:13.043

我认为“解决”它的唯一方法是使用 OnClick ajax 回调和 yourChart.CallbackManager.UpdateClientControl(yourGrid) 方法。

但是网格可能会在回发时恢复。原因是当涉及到非标准场景时，Dundas Charts 是一团糟，他们的支持对你没有帮助。如果可以，请不要使用它。

# string - 将域名的“主体”与扩展名分开 - DOS shell

> ID：469865
> 
> 赞同：-1
> 
> 时间：2009-01-22T16:35:12.057
> 
> 标签：string, batch-file

我尽了一切可能，但仍然失败。我以为我在我将发布
的最后一次尝试中得到了它，但仍然不够好[足够]。

一个脚本被传递了三个参数。域名、用户名和密码。
但问题是我需要以“域”+“.com”格式分隔域。两个变量。
我尝试使用 name.extension 作弊来拆分它，但效果不太好。

检查简单的代码：

```
@echo off
echo.
set domain=%~n1
set ext=%~x1
echo %DOMAIN%
echo %EXT%
echo. 
```

当你尝试它时，你会得到：

```
D:\Scripts\test>test.bat domain.com

domain
.com

D:\Scripts\test>test.bat domain.co.uk

domain.co
.uk 
```

首先显然确实有效，但这只是因为我能够作弊。
DOS Shell 中的字符串操作让人头疼。我也许可以说服
脚本编写者向我传递 4 个参数而不是 3 个……但万一失败了……帮助！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T11:26:03.803

如果您想自动化某些事情（如另一个答案中所述），我的解决方案是使用适当的工具。安装 Perl 运行时或其他您喜欢的东西。或使用 Windows 电源外壳

此外，除非您为脚本提供有效顶级域的列表，否则您的脚本无法以任何语言决定 test.co.uk 是否应拆分为 text 和 co.uk 或 test.co 和英国。唯一可行的可能性是确保您只获得没有子域部分的二级域。在这种情况下，只需在第一个点处拆分即可。

顺便说一句：我很好奇您为什么要在 Windows shell 脚本中自动创建网站。你没有做任何令人讨厌的事情，是吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T12:46:59.490

Windows 附带 Windows Scripting Host，可让您运行 javascript。

将批处理文件更改为：

```
@echo off
cscript //Nologo test.js %* 
```

创建 test.js：

```
if (WScript.Arguments.Length > 0) {
    var arg = WScript.Arguments.Item(0);
    var index = arg.indexOf('.');
    if (index != -1) {
        var domain = arg.substring(0, index);
        var ext = arg.substring(index);
        WScript.Echo(domain);
        WScript.Echo(ext);
    } else WScript.Echo("Error: Argument has no dots: " + arg);
} else WScript.Echo("Error: No argument given"); 
```

你可以使用它：

```
C:\Documents and Settings\Waqas\Desktop>test.bat domain.com
domain
.com

C:\Documents and Settings\Waqas\Desktop>test.bat domain.co.uk
domain
.co.uk 
```

这就是我认为你想要的。

# java - 如何正确解码传递给 servlet 的 unicode 参数

> ID：469874
> 
> 赞同：36
> 
> 时间：2009-01-22T16:39:17.870
> 
> 标签：java, unicode, servlets

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-01-22T18:36:34.543

你快到了。EncodeURIComponent 正确编码为 UTF-8，这是您今天应该始终在 URL 中使用的内容。

问题是提交的查询字符串在进入服务器端脚本的过程中被破坏了，因为 getParameter() 使用 ISO-8559-1 而不是 UTF-8。这源于古代网络在 URI/IRI 上采用 UTF-8 之前的时代，但遗憾的是 Servlet 规范没有更新以匹配现实，或者至少为其提供可靠的、受支持的选项。

（Servlet 2.3 中有 request.setCharacterEncoding，但它不影响查询字符串解析，如果之前读取过单个参数，可能是由其他框架元素读取的，它根本不起作用。）

因此，您需要使用特定于容器的方法来获得正确的 UTF-8，通常涉及 server.xml 中的内容。这对于分发应该可以在任何地方工作的 Web 应用程序来说是非常糟糕的。对于 Tomcat，请参阅[https://cwiki.apache.org/confluence/display/TOMCAT/Character+Encoding](https://cwiki.apache.org/confluence/display/TOMCAT/Character+Encoding)以及Tomcat[的“URIEncoding”、编码过滤器和 request.setCharacterEncoding 之间的区别](https://stackoverflow.com/questions/26944802/whats-the-difference-between-uriencoding-of-tomcat-encoding-filter-and-reque)。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-03-31T14:58:23.163

我遇到了同样的问题，并通过`Request.getQueryString()`使用 URLDecoder() 解码并在提取参数后解决了它。

```
String[] Parameters = URLDecoder.decode(Request.getQueryString(), 'UTF-8')
                       .splitat('&'); 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2012-10-06T21:04:27.593

有办法在java中做到这一点（不要摆弄`server.xml`）

不工作 ：

```
protected static final String CHARSET_FOR_URL_ENCODING = "UTF-8";

String uname = request.getParameter("name");
System.out.println(uname);
// ÏÎ·Î³ÏÏÏÏÎ·
uname = request.getQueryString();
System.out.println(uname);
// name=%CF%84%CE%B7%CE%B3%CF%81%CF%84%CF%83%CF%82%CE%B7
uname = URLDecoder.decode(request.getParameter("name"),
        CHARSET_FOR_URL_ENCODING);
System.out.println(uname);
// ÏÎ·Î³ÏÏÏÏÎ· // !!!!!!!!!!!!!!!!!!!!!!!!!!!
uname = URLDecoder.decode(
        "name=%CF%84%CE%B7%CE%B3%CF%81%CF%84%CF%83%CF%82%CE%B7",
        CHARSET_FOR_URL_ENCODING);
System.out.println("query string decoded : " + uname);
// query string decoded : name=τηγρτσςη
uname = URLDecoder.decode(new String(request.getParameter("name")
        .getBytes()), CHARSET_FOR_URL_ENCODING);
System.out.println(uname);
// ÏÎ·Î³ÏÏÏÏÎ· // !!!!!!!!!!!!!!!!!!!!!!!!!!! 
```

~~作品~~：

```
final String name = URLDecoder
        .decode(new String(request.getParameter("name").getBytes(
                "iso-8859-1")), CHARSET_FOR_URL_ENCODING);
System.out.println(name);
// τηγρτσςη 
```

工作，但[如果默认编码会中断！= utf-8](https://stackoverflow.com/questions/12913264/eclipse-vs-tomcat-deployment-exported-war-partially-fails-while-the-project) - 试试这个（省略对 decode() 的调用，它不需要）：

```
final String name = new String(request.getParameter("name").getBytes("iso-8859-1"),
        CHARSET_FOR_URL_ENCODING); 
```

* * *

正如我上面所说，如果它`server.xml`被弄乱了：

```
<Connector connectionTimeout="20000" port="8080" protocol="HTTP/1.1"
                     redirectPort="8443"  URIEncoding="UTF-8"/> 
```

（注意*`URIEncoding="UTF-8"`*）上面的代码会中断（因为`getBytes("iso-8859-1")`应该读`getBytes("UTF-8")`）。因此，对于防弹解决方案，您必须获取`URIEncoding`属性的值。不幸的是，这似乎是特定于容器的 - 更糟糕的是特定于容器版本。对于tomcat 7，您需要类似：

```
import javax.management.AttributeNotFoundException;
import javax.management.InstanceNotFoundException;
import javax.management.MBeanException;
import javax.management.MBeanServer;
import javax.management.MBeanServerFactory;
import javax.management.MalformedObjectNameException;
import javax.management.ObjectName;
import javax.management.ReflectionException;

import org.apache.catalina.Server;
import org.apache.catalina.Service;
import org.apache.catalina.connector.Connector;

public class Controller extends HttpServlet {

    // ...
    static String CHARSET_FOR_URI_ENCODING; // the `URIEncoding` attribute
    static {
        MBeanServer mBeanServer = MBeanServerFactory.findMBeanServer(null).get(
            0);
        ObjectName name = null;
        try {
            name = new ObjectName("Catalina", "type", "Server");
        } catch (MalformedObjectNameException e1) {
            e1.printStackTrace();
        }
        Server server = null;
        try {
            server = (Server) mBeanServer.getAttribute(name, "managedResource");
        } catch (AttributeNotFoundException | InstanceNotFoundException
                | MBeanException | ReflectionException e) {
            e.printStackTrace();
        }
        Service[] services = server.findServices();
        for (Service service : services) {
            for (Connector connector : service.findConnectors()) {
                System.out.println(connector);
                String uriEncoding = connector.getURIEncoding();
                System.out.println("URIEncoding : " + uriEncoding);
                boolean use = connector.getUseBodyEncodingForURI();
                // TODO : if(use && connector.get uri enc...)
                CHARSET_FOR_URI_ENCODING = uriEncoding;
                // ProtocolHandler protocolHandler = connector
                // .getProtocolHandler();
                // if (protocolHandler instanceof Http11Protocol
                // || protocolHandler instanceof Http11AprProtocol
                // || protocolHandler instanceof Http11NioProtocol) {
                // int serverPort = connector.getPort();
                // System.out.println("HTTP Port: " + connector.getPort());
                // }
            }
        }
    }
} 
```

而且您仍然需要针对多个连接器进行调整（检查注释掉的部分）。然后你会使用类似的东西：

```
new String(parameter.getBytes(CHARSET_FOR_URI_ENCODING), CHARSET_FOR_URL_ENCODING); 
```

如果使用 CHARSET_FOR_URI_ENCODING 解码已损坏，因此这可能会失败（[IIUC](https://stackoverflow.com/questions/2544965/why-new-stringbytes-enc-getbytesenc-does-not-return-the-original-byte-array)）`parameter = request.getParameter("name");`，因此我使用 getBytes() 获得的字节不是原始字节（这就是默认使用“iso-8859-1”的原因 -[它会保留字节](https://stackoverflow.com/questions/15925458/iso-8859-1-encoding-and-binary-data-preservation)）。您可以通过手动解析以下行中的查询字符串来摆脱这一切：

```
URLDecoder.decode(request.getQueryString().split("=")[1],
        CHARSET_FOR_URL_ENCODING); 
```

[我仍在寻找文档中提到`request.getParameter("name")`调用`URLDecoder.decode()` 而不是返回`%CF%84%CE%B7%CE%B3%CF%81%CF%84%CF%83%CF%82%CE%B7`字符串的地方？源中的链接将不胜感激。
~~另外，我怎样才能将字符串作为参数的值传递，比如`%CE`？~~=> 见评论：`parameter=%25CE`]

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T17:16:17.187

我怀疑数据破坏发生在请求中，即请求的声明编码与实际用于数据的编码不匹配。

返回什么`request.getCharacterEncoding()`？

我真的不知道 JavaScript 如何处理编码或如何使它使用特定的编码。

您需要确保在所有阶段都正确使用了编码——不要试图通过在已经被错误编码的地方`new String()`使用“修复”数据。`getBytes()`

**编辑：**将原始页面（带有 Javascript 的页面）也以 UTF-8 编码并在其 Content-Type 中声明可能会有所帮助。然后我相信 Javascript 可能会默认使用 UTF-8 作为其请求 - 但这不是确定的知识，只是猜测。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T17:13:24.523

您总是可以使用 javascript 来进一步操作文本。

```
<div id="test">a</div>
<script>
var a = document.getElementById('test');
alert(a.innerHTML);
a.innerHTML = decodeURI("Yahoo!%E2%84%A2");
alert(a.innerHTML);
</script> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T18:22:34.370

我想我可以让以下工作：

```
encodeURIComponent(escape(lnk.title)) 
```

这给了我`%25u2122`(for ™) 或`%25AE`(for ®)，它们将分别解码到`%u2122`和`%AE`在 servlet 中。

然后，我应该能够将 %u2122`'\u2122'`和 %AE`'\u00AE'`相对容易地`(char) (base-10 integer value of %uXXXX or %XX)`在匹配中使用并使用正则表达式替换循环。

即 - match `/%u([0-9a-f]{4})/i`，提取匹配的子表达式，将其转换为 base-10，将其转换为 char 并将其附加到输出中，然后执行相同的操作`/%([0-9a-f]{2})/i`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-11-18T17:16:43.450

在某些版本的 Jetty 中存在一个错误，它会错误地解析更高数量的 UTF-8 字符。如果您的服务器正确接受阿拉伯字母但不接受表情符号，则表明您的版本存在此问题，因为阿拉伯语不在 ISO-8859-1 中，而是在 UTF-8 字符的较低范围内（“较低”表示 java将以单个字符表示）。

我从版本 7.2.0.v20101020 更新到版本 7.5.4.v20111024，这解决了问题；我现在可以使用 getParameter(String) 方法，而不必自己解析它。

如果你真的很好奇，你可以深入研究你的 org.eclipse.jetty.util.Utf8StringBuilder.append(byte) 版本，看看当 utf-8 代码足够高时它是否正确地将多个字符添加到字符串中，或​​者如果，就像在 7.2.0 中一样，它只是将一个 int 转换为一个 char 并附加。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-05-15T17:43:19.907

感谢我了解有关在 tomcat、码头中使用的默认字符集的编码解码的所有信息，我使用这种方法使用 google guava 解决我的问题

```
 String str = URLDecoder.decode(request.getQueryString(), StandardCharsets.UTF_8.name());
        final Map<String, String> map = Splitter.on('&').trimResults().withKeyValueSeparator("=").split(str);
        System.out.println(map);
        System.out.println(map.get("aung"));
        System.out.println(map.get("aa")); 
```

# jquery - 如何使用jquery在表中查找行的索引

> ID：469883
> 
> 赞同：22
> 
> 时间：2009-01-22T16:42:42.917
> 
> 标签：jquery

我正在尝试在表中查找行的索引。我正在尝试使用以下代码，但我似乎得到了 -1 的索引。

```
$(document).ready(function()
{
    $("tr").click(function (){
        var index = $("table").index($(this));
        $("span").text("That was row index #" + index);
    });
}); 
```

使用看起来像这样的html；

```
<table>
<tbody>
    <tr><td>click</td></tr>
    <tr><td>click</td></tr>
    <tr><td>click</td></tr>
    <tr><td>click</td></tr>
</tbody> 
```

谢谢

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-22T16:50:03.197

你有没有尝试过：

```
$("tr").index(this) 
```

文档显示只是通过了这一点，并且前面的选择应该是找到节点的位置。如果您需要在特定表中找到它（并且有多个），您可能需要提供一些上下文：

```
// haven't tested this
$("tr", $(this).closest("table")).index(this) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-22T16:49:07.850

尝试：

```
var index = $("table tr").index(this); 
```

的文档`index()`说：

> 在每个匹配的元素中搜索对象并返回元素的索引（如果找到），从零开始。如果传递了 jQuery 对象，则仅检查第一个元素。

您需要调用元素`index()`集合`<tr>`，而不是父元素`<table>`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-01-04T15:42:58.590

基于 Rob 在特定表中查找索引的答案，这对我有用。

```
var index = $('tr', $(this).closest("table")).index(this); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-05-19T03:57:36.970

我刚刚发现了一个有趣的技巧，它基本上包括计算以前的兄弟姐妹：

```
var tr = $(some_selector);
var rowIndex = tr.prevAll().length; 
```

这样，如果这是第一个，您将获得 0 `tr`，如果这是第四个，您将获得 3，依此类推`tr`。

只是为了它，另一个选项 using `index()`，它使您不必知道如何选择包含表：

```
var rowIndex = tr.parent().children().index(tr); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-07-22T11:22:47.070

获取td对象，其父索引为tr index

```
$(this).parent().index() 
```

# java - Java 中是否有类似 cron 的 ScheduledExecutorService 实现？

> ID：469884
> 
> 赞同：8
> 
> 时间：2009-01-22T16:42:50.747
> 
> 标签：java, scheduler

Java 中的 ScheduledExecutorService 对于以固定间隔或固定延迟重复任务非常方便。我想知道是否有类似于现有的 ScheduledExecutorService 的东西，它可以让您指定一天中的某个时间来安排任务，而不是一个时间间隔，即“我希望这个任务在每天上午 10 点触发”。

我知道你可以使用 Quartz 来实现这一点，但如果可能的话，我宁愿不使用那个库（这是一个很棒的库，但出于一些原因我宁愿没有依赖）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2017-03-26T18:41:54.657

ThreadPoolTask​​Scheduler，可以在不需要外部线程管理时使用。在内部，它委托给一个*ScheduledExecutorService*实例。*ThreadPoolTask​​Scheduler*也 实现了 Spring 的*TaskExecutor*接口，因此单个实​​例可以用于异步执行以及计划的和可能重复的执行。

CronTrigger() 在哪里接受 cronExpression [http://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/support/CronSequenceGenerator.html](http://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/support/CronSequenceGenerator.html)

有关此解决方案的更多信息，请参阅 Spring 文档：[https ://docs.spring.io/spring/docs/current/spring-framework-reference/html/scheduling.html](https://docs.spring.io/spring/docs/current/spring-framework-reference/html/scheduling.html)

```
import org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;
import org.springframework.scheduling.support.CronTrigger;
import java.util.Date;

public class CronTriggerSpringTest{
public static void main(String args[]){
    String cronExpression = "0/5 * * * * *";
    ThreadPoolTaskScheduler scheduler = new ThreadPoolTaskScheduler();
    scheduler.initialize();
    scheduler.schedule(new Runnable() {
        @Override
        public void run() {
            System.out.println("Hello Date:"+new Date());
        }
    }, new CronTrigger(cronExpression));
}
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-23T11:26:17.563

HA-JDBC 中的[CronExecutorService](http://ha-jdbc.github.io/apidocs/net/sf/hajdbc/util/concurrent/cron/CronExecutorService.html)出现了更多搜索。有趣的是，它的[CronExpression](http://quartz-scheduler.org/api/2.2.0/org/quartz/CronExpression.html)类依赖于 Quartz，但仅此而已。这还不错。

更新：我已经修复了指向新版本的断开链接，但我不知道这是否是唯一的依赖项了

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-22T16:46:21.613

您可以使用[Timer](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Timer.html)类。具体来说，scheduleAtFixedRate(TimerTask task, Date firstTime, long period)。您可以在其中将任务设置为在特定日期的上午 10 点开始，并每 24 小时重复一次。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T20:26:32.980

当您使用 scheduleAtFixedRate 时，您会提供延迟。所以延迟可能是上午 10 点的差异，周期是 24 小时。即使使用计时器，这也可能会有些偏差，因此您可以安排一个任务，该任务每次都会以适当的延迟将自身添加到 ScheduledExecutorService。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-22T23:28:06.653

JT 克罗恩

[http://jarretttaylor.com/java/jt-cron.html](http://jarretttaylor.com/java/jt-cron.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-01-29T14:34:21.147

有[CronScheduler](https://github.com/TimeAndSpaceIO/CronScheduler)解决了时钟漂移问题，`ScheduledThreadPoolExecutor`当后者用于根据 UTC 时间、Unix 时间或系统时间进行实际调度时，而不是由`System.nanoTime`.

CronScheduler 还提供[`scheduleAtRoundTimesInDay`](https://javadoc.io/doc/io.timeandspace/cron-scheduler/latest/io/timeandspace/cronscheduler/CronScheduler.html#scheduleAtRoundTimesInDay-java.time.Duration-java.time.ZoneId-io.timeandspace.cronscheduler.CronTask-)处理时区人员和夏令时更改的功能。

```
Duration syncPeriod = Duration.ofMinutes(1);
CronScheduler cron = CronScheduler.create(syncPeriod);
ZoneId myTZ = ZoneId.systemDefault();
cron.scheduleAtRoundTimesInDay(Duration.ofHours(2), myTZ, runTimeMillis -> {
    // Do the task
}); 
```

# .net - 在从网络共享运行的应用程序的 UAC 提升提示上显示应用程序图标

> ID：469885
> 
> 赞同：11
> 
> 时间：2009-01-22T16:43:25.863
> 
> 标签：.net, windows-vista, icons, uac

我已经使用应用程序清单配置了我的 .NET 应用程序以请求管理员权限。我还使用 signtool 对程序集进行了签名。一切都很好——当你启动应用程序时，你会收到带有应用程序名称和签名证书名称的漂亮 UAC 提示。

但是，*当我从网络共享运行应用程序时*，提升提示会显示通用可执行图标，而不是我的应用程序的图标。如何让 UAC 提示显示我的应用程序图标？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-05-23T18:14:46.713

我大概发现了。

UAC 在服务之上运行，我们看到的对话框在桌面快照之上。该服务只会显示对话框，就好像它在桌面上一样。

正如我们所知，服务在 SYSTEM 帐户上运行（除其他外）。这意味着它需要 SYSTEM 对我们正在启动的可执行文件拥有权限。我只为自己分配了安全性（剥离了 SYSTEM）。

一旦我授予 SYSTEM 权限（只读权限！），并启动应用程序 - 它显示应用程序图标！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T20:22:46.857

是否与以下问题有关：[为什么我的 .NET 应用程序从网络驱动器运行时会崩溃？](https://stackoverflow.com/questions/148879/why-does-my-net-application-crash-when-run-from-a-network-drive)

您的 .net 应用程序在网络共享上拥有除本地磁盘之外的其他权限。更新到 3.5 SP1 通常会消除此问题。否则，请检查 .net 的远程代码策略。

您也可以尝试其他非 .net 应用程序（例如 procmon），该应用程序需要提升才能将其放在同一目录中，看看会发生什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T21:09:49.587

显然这不是 .net 的东西，而是 UAC 的东西。

我通过将 systinternals 中的 procmon 放置在网络共享上来重现该行为，并看到了相同的差异。

当切换到使用另一个用户的提升会话时，它可能与此有关。网络映射是在普通用户上完成的，所以在提升的会话中找不到应用程序，因此无法显示图标？

您可以尝试执行以下操作以强制连接在提升的会话中有效：

*   启动提升的命令提示符
*   净使用`\\your-network-location\share /user:<username> <password>`
*   现在转到开始->运行并开始`\\your-network-location\share\procmon.exe`（为了安全起见，请避免映射驱动器）并查看 UAC 提示是否有所改善？

# language-agnostic - 程序员应该在一个文件中放入多少个类？

> ID：469887
> 
> 赞同：17
> 
> 时间：2009-01-22T16:44:02.757
> 
> 标签：language-agnostic, oop, file, class

在您的面向对象语言中，您遵循哪些准则将类分组到单个文件中？你总是给每个班级一个单独的文件吗？你把紧密耦合的类放在一起吗？您是否曾经在一个文件中指定了几个接口的实现？你是根据实现可能有多少行代码，或者它对类的用户来说看起来有多“混乱”？还是用户更愿意将所有东西都放在一个地方？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-22T16:47:34.793

就个人而言，我建议每个文件一个类，*除非*辅助类对文件中的主类是私有的。例如，C# 中的嵌套类将保留在父类文件中，但在其他地方*可能*有用的实用程序类会被分解到它们自己的文件甚至命名空间中。

关键是要了解您的环境以及人们会在哪里寻找东西。如果有既定的方法论，请在破坏它之前仔细考虑。如果您的同事期望相关的、紧密绑定的类将位于单个文档中，那么必须搜索它们可能会很烦人（尽管使用现代 IDE 应该不成问题）。

将内容分解为更多文件而不是更少文件的另一个原因是版本控制。如果你做了一个小的改变，它应该尽可能只改变一个小文件。如果您进行彻底的更改，很明显会查看日志，因为所有受影响的文件（以及间接的类）都会被记录下来。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-22T16:47:02.423

我认为我曾经使用过的所有 OO 语言的最佳实践是在一个文件中包含一个类。我相信某些语言可能需要这样做，但我不确定这一事实。但是我会说每个文件一个类，并且文件的名称与类的名称相匹配（以及大部分与包结构相匹配的目录结构）是最佳实践。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-22T17:04:03.340

1 类 = 2 个文件。一个 .h 和一个 .c，你们这些孩子真幸运 :)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-22T16:59:17.407

**没有必须始终遵循的硬性规定（除非特定语言强制执行）。一个文件中只有一个类或多个类是有充分理由的。它确实取决于语言。**

在 C# 和 Java 中，人们倾向于坚持每个类一个文件。

尽管我经常将多个类放在一个文件中，但我会用 C++ 说。通常这些类很小并且非常相关。例如。某些通信协议中的每条消息都有一个类。在这种情况下，每个文件都意味着很多文件，并且实际上使维护和读取代码比将它们放在一个文件中更加困难。

在 C++ 中，类的实现与类定义是分开的，因此每个类 { / *body* / } 比其他语言中的要小，这意味着类的大小可以更方便地组合在一个文件中。

在 C++ 中，如果您正在编写一个库（例如标准模板库），您可以将所有类放在一个文件中。用户只需要包含一个头文件，然后他们就可以获得所有的类，因此他们更容易使用。

有一个平衡。答案是最容易理解和维护的。默认情况下，每个文件有一个类是有意义的，但是在很多情况下，如果在一个文件中定义了一组相关的类，则使用它们会更实际。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-22T16:55:43.187

如果出于技术或美学原因，如果它们属于一起，我会将它们放入同一个文件中。例如，在一个提供插件接口的应用程序中，插件类（**插件**的基类）和插件管理器**我**通常会放在同一个文件中。但是，如果文件对我的口味来说太大了，我会将它们拆分为单独的文件。

我注意到我目前主要用 Python 编写代码，这影响了我的设计。Python 在我如何将内容划分为模块方面非常灵活，并且有很好的工具来管理事物的名称空间。例如，我通常将应用程序的所有代码放在 Python 模块（带有 的目录`__init__.py`）中，并让模块从子模块中导入特定名称。然后 API 类似于`applib.PluginManager`而不是`applib.pluginstuff.PluginManager`.

这使得移动东西变得容易，这也让我在创建设计时不会那么挑剔：我总是可以在以后修复东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-22T16:47:41.173

一个类=一个文件。总是。除了一个类= C#中的多个文件，或者一个类当然包含内部类等；）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-22T16:47:53.500

每个文件一个是我们的标准。唯一的例外是对于一个类和它的类型化集合，我们将它们放在一起。

随着时间的推移，我开始意识到，“小班”总是会增长。然后你会想把它们分开，让团队中的其他人（和你自己）感到困惑。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-22T16:56:28.787

我尝试为每个文件保留一个类（如上面的大多数），除非它们是小类。如果它们很多，我可以将它们分成不同的主题。但通常我只是将它们全部保存在一个文件中，并在编辑器中进行代码折叠。对于我的私人黑客，这对我来说是不值得的（最小的）努力。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-22T16:59:55.127

每个文件一个类似乎是标准。这也是我通常的做法。

有几次我偏离了这一点。特别是当一个较小的类是另一个类的成员时。例如，在设计数据结构时，我可能会在与“bigstructure”类相同的文件中实现“node”类。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-22T17:30:48.077

> 在您的面向对象语言中，您遵循哪些准则将类分组到单个文件中？

这取决于。在团队工作中，我尽量遵循团队标准；在独奏作品中，我更倾向于随心所欲。

在独奏作品中，然后...

> 你总是给每个班级一个单独的文件吗？你把紧密耦合的类放在一起吗？您是否曾经在一个文件中指定了几个接口的实现？

不，有时。是的。

> 你是根据实现可能有多少行代码，或者它对类的用户来说看起来有多“混乱”？还是用户更愿意将所有东西都放在一个地方？

它主要基于：

*   导航有多容易？包含许多类的巨大长源文件更加困难。
*   编辑有多容易？在编辑多个简短的相关类时，如果它们都在一个带有拆分器的源文件中，可能比它们在多个源文件中更容易，因为我运行我的文本编辑器时最大化一次显示一个源文件.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-24T05:40:00.897

除非内部类完全是私有的，否则我更喜欢 1 到 1 的类。即便如此，我通常还是将其拆分出来以便于查找和跟踪 SVN 中的更改。

# c++ - C++ 为什么这个按引用传递的数组会产生运行时错误？

> ID：469892
> 
> 赞同：0
> 
> 时间：2009-01-22T16:45:12.193
> 
> 标签：c++, pass-by-reference

```
void pushSynonyms (string synline,  char  matrizSinonimos [1024][1024]){

             stringstream synstream(synline);

             vector<int> synsAux;

             int num;

             while (synstream >> num) {synsAux.push_back(num);}

             int index=0;
             while (index<(synsAux.size()-1)){

                   int primerSinonimo=synsAux[index];
                   int segundoSinonimo=synsAux[++index];
                   matrizSinonimos[primerSinonimo][segundoSinonimo]='S';
                   matrizSinonimos [segundoSinonimo][primerSinonimo]='S';

                   }

           } 
```

和电话..

```
char matrizSinonimos[1024][1024];
     pushSynonyms("1 7", matrizSinonimos) 
```

`matrizSinonimos`通过引用传递对我来说很重要。

编辑：从`&matrizSinonimos`.

编辑：运行时错误是：

```
An unhandled win32 exception occurred in program.exe [2488]![alt text][1] 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T19:20:02.770

### 它出什么问题了

你在那里的代码 - 我找不到错误。我发现的唯一问题是，如果您根本不提供号码，那么这部分会造成伤害：

```
(synsAux.size()-1) 
```

它将从 0u 中减去一个。这将环绕，因为`size()`返回一个无符号整数类型。你最终会得到一个非常大的值，大约是 2^16 或 2^32。您应该将整个 while 条件更改为

```
while ((index+1) < synsAux.size()) 
```

您可以尝试在呼叫方周围寻找错误。通常情况下，在此之前某处发生缓冲区溢出或堆损坏，因此程序在程序的稍后时间点崩溃。

### 其中的参数和参数的东西

关于数组及其传递方式，我认为您做得很好。虽然，您仍然按值传递数组。也许你已经知道了，但我会重复一遍。你真的传递了一个指向这个数组的第一个元素的指针：

```
char matrizSinonimos[1024][1024]; 
```

二维数组实际上是一个数组数组。该数组的第一个元素是一个数组，指向它的指针就是一个指向数组的指针。在这种情况下，它是

```
char (*)[1024] 
```

即使在参数列表中您说您接受一个数组数组，编译器也会一如既往地对其进行调整并使其成为指向此类数组第一个元素的指针。所以实际上，在编译器对参数类型的调整完成后，你的函数就有了原型：

```
void pushSynonyms (string synline,  char (*matrizSinonimos)[1024]); 
```

尽管经常建议，**您不能将该数组作为 a 传递`char**`**，因为被调用的函数需要内部维度的大小，才能正确处理正确偏移处的子维度。在被调用函数中使用 a `char**`，然后编写类似`matrizSinonimos[0][1]`的内容，它将尝试将该数组的第一个 sizeof(char**) 字符解释为指针，并尝试取消引用随机内存位置，然后再执行该操作时间，如果它没有在两者之间崩溃。*不要那样做*。您在该数组的外部维度中写入的大小也无关紧要。它合理化了。现在，通过引用传递数组并不重要。但如果你愿意，你必须把整个事情改成

```
void pushSynonyms (string synline,  char (&matrizSinonimos)[1024][1024]); 
```

通过引用传递不会传递指向第一个元素的指针：所有维度的所有大小都被保留，并且传递的是数组对象本身，而不是一个值。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-22T16:51:52.320

数组作为指针传递——不需要对它们进行传递引用。如果你声明你的函数是：

```
void pushSynonyms(string synline, char matrizSinonimos[][1024]); 
```

您对数组的更改将持续存在 - 数组*永远不会*按值传递。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-22T18:55:23.383

异常可能是`0xC00000FD`，或者堆栈溢出！

问题是您正在堆栈上创建一个 1 MB 数组，这可能太大了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T18:46:02.183

（**编辑 1**）我忘了回答你的实际问题。好吧：在您更正了代码以正确方式传递数组之后（不再有不正确的间接），在我看来，您最有可能没有检查您的输入是否正确。您从流中读取，将其保存到向量中，但您从未检查过您获得的所有数字是否实际上都在正确的范围内。（**结束编辑1**）

*第一*：使用原始数组可能不是您真正想要的。有`std::vector`，或`boost::array`。后者是像原始数组一样的编译时固定大小数组，但提供了 C++ 集合类型定义和方法，这对于通用（阅读：模板化）代码很实用。

而且，使用这些类可能会减少关于类型安全、按引用传递、按值传递或传递指针的混淆。

*第二*：数组作为指针传递，指针本身是按值传递的。

*第三*：你应该在堆上分配这么大的对象。在这种情况下，堆分配的开销是微不足道的，它将减少堆栈空间用完的机会。

*第四*：

```
void someFunction(int array[10][10]); 
```

真的是：

（**编辑 2**）感谢评论：

~~void someFunction(int** array);~~

```
void someFunction(int (*array)[10]); 
```

希望我没有在其他地方搞砸......（**结束编辑2**）

10x10 数组的类型信息丢失。要了解您可能的意思，您需要编写：

```
void someFunction(int (&array)[10][10]); 
```

这样编译器可以检查调用方的数组实际上是一个 10x10 的数组。然后，您可以像这样调用该函数：

```
int main() {
  int array[10][10] = { 0 };
  someFunction(array);
  return 0;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-22T19:23:44.917

尝试将其声明为：

```
void pushSynonyms (const string & synline,  char  *matrizSinonimos[1024] ) 
```

我相信这会做你想做的事。正如其他人所说，您拥有它的方式在堆栈上创建了一个 1MB 数组。此外，将 synline 从 更改`string`为`const string &`消除了将完整的字符串副本推入堆栈。

另外，我会使用某种类来封装 matrizSinonimos。就像是：

```
class ms
{
    char m_martix[1024][1024];
    public:
    pushSynonyms( const string & synline );
} 
```

那么你根本不必通过它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T19:44:48.697

我不知道上面的代码有什么问题，但如果你不能让数组语法工作，你总是可以这样做：

```
void pushSynonyms (string synline,  char  *matrizSinonimos, int rowsize, int colsize )
{
   // the code below is equivalent to 
   // char c = matrizSinonimos[a][b];
   char c = matrizSinonimos( a*rowsize + b );
   // you could also Assert( a < rowsize && b < colsize );
}

pushSynonyms( "1 7", matrizSinonimos, 1024, 1024 ); 
```

如果在编译时已知，您还可以将 rowsize 和 colsize 替换为 #define SYNONYM_ARRAY_DIMENSION 1024，这将使乘法步骤更快。

# tfs - 如何确定我们正在使用哪种编程方法（如果有）？

> ID：469893
> 
> 赞同：3
> 
> 时间：2009-01-22T16:45:26.373
> 
> 标签：tfs, methodology

我的小组即将迁移到 Team Foundation Server。事实上，我正在努力。

您要决定的一件事是您使用哪种方法 - 敏捷、CMMI 等。

问题是 - 我不知道我们使用什么方法。我的意思是，我们没有积极使用一个。而且我对敏捷或其他方法还不够熟悉，不知道哪种方法（如果有的话）恰好适用于我们的工作方式。

有一些默认的方法吗？例如，如果我们经历一些非常生硬的过程（获取需求、代码、测试、推送到 QA、进行 QA 测试、推送到生产），它还有名字吗？

作为奖励，对于 TFS，一开始就选错了会受到什么惩罚？如果我们决定采用敏捷或其他方式，以后换档有多难？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T17:00:38.810

切换方法没有重大损失——您只需在安装时选择一个默认方法，您可以选择用于任何给定项目的方法。事实上，它只与 TFS 最初如何配置 Sharepoint 项目页面有关 - 您可以在页面创建后添加任何您想要的内容，因此如果您决定更改项目的方法，这并不难。

对于 TFS 开箱即用的两个（Agile 和 SCCM/Waterfall），这确实是您的流程问题 - 您是“尽早且经常”发布，随着错误的出现而发布较小的包，还是运行您的项目在大型迭代中，发布的频率要低得多，但具有明显的里程碑发布？

一个要问的问题（虽然不完全准确，但总是对我有帮助）：产品是否有对最终用户有意义的版本号？例如，许多网站都是敏捷的，因为它们不断发布改进和补丁，并且通常不会有巨大的改进/大修，而像 MS Office 这样的产品有一个有意义的版本号（2003、2007 等），即更可能是 SCCM。

如果您没有明确的方法，那么现在是开发方法的好时机 - 确定哪个发布周期对您有意义，在每个发布周期中创建一个项目并查看 TFS 自动为您设置的内容 - 执行进度指示器和 Sharepoint 页面感觉？有什么明显的缺失吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T16:56:37.397

如果您无法辨别方法，那么您正在使用临时方法。它可能类似于现有的方法（偶然）。但是请注意，遵循一种方法并不等于成功。我已经看到很多方法论繁重的项目都失败了，并且很多“裤子座位”项目取得了巨大的成功（如果尘埃落定后可能需要进行一些重构）。

改变方法最取决于你的文化。机构往往抵制变革，而做一些个人。然而，这又取决于情况：如果现有情况明显被打破，一个机构有时可以做出让所有人都感到惊讶的快速改变。

有些方法比其他方法“更重”：那些更难改变或改变。即使是测试驱动开发也很“繁重”，因为事后采用它意味着向旧代码添加*大量测试。*大多数现实世界的过渡只是添加测试，因为文件是出于其他原因编辑的。同样，从 TDD 迁移到某种瀑布式风格将需要在大型废弃活页夹中记录大量代码*。*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T16:46:56.073

最基本的方法往往是您的迭代或“瀑布方法”，因为您只是一步一步地进行。不过，它似乎不再那么受欢迎了。

# c# - 如何将自定义类型数据绑定到 TextBox.Text？

> ID：469899
> 
> 赞同：7
> 
> 时间：2009-01-22T16:46:44.000
> 
> 标签：c#, winforms, data-binding, textbox, typeconverter

我有一个自定义的 c# 类型，比如（只是一个例子）：

```
public class MyVector
{ 
   public double X {get; set;} 
   public double Y {get; set;} 
   public double Z {get; set;} 
   //...
} 
```

我希望它数据绑定到 TextBox.Text：

```
TextBox textBox;
public MyVector MyVectorProperty { get; set;}
//...
textBox.DataBindings.Add("Text", this, "MyVectorProperty"); 
```

本质上，我需要为我的自定义值类型转换为字符串和从字符串转换。在文本框中，我想要“x, y, z”之类的内容，可以对其进行编辑以更新矢量类型。我假设我可以通过添加`TypeConverter`派生类来做到这一点：

```
public class MyVectorConverter : TypeConverter
{
    public override bool CanConvertFrom(ITypeDescriptorContext context, 
                                        Type sourceType)
    {
        if (sourceType == typeof(string))
            return true;
        //...
        return base.CanConvertFrom(context, sourceType);
    }

    public override bool CanConvertTo(ITypeDescriptorContext context, 
                                      Type destinationType)
    {
        if (destinationType == typeof(string))
            return true;
        //...
        return base.CanConvertTo(context, destinationType);
    }

    public override object ConvertFrom(ITypeDescriptorContext context, 
                                       System.Globalization.CultureInfo culture,
                                       object value)
    {
        if (value is string)
        {
            MyVector MyVector;
            //Parse MyVector from value
            return MyVector;
        }
        return base.ConvertFrom(context, culture, value);
    }

    public override object ConvertTo(ITypeDescriptorContext context,
                                     System.Globalization.CultureInfo culture, 
                                     object value, 
                                     Type destinationType)
    {
        if (destinationType == typeof(string))
        {
            string s;
            //serialize value to string s
            return s;
        }
        //...
        return base.ConvertTo(context, culture, value, destinationType);
    }
} 
```

并将其与我的结构相关联：

```
[TypeConverter(typeof(MyVectorConverter))]
public class MyVector { //... } 
```

这似乎完成了一半的战斗。我可以看到`MyVectorConverter`被召唤，但有些不对劲。调用它看它是否知道如何转换为字符串，然后调用它转换为字符串。但是，永远不会查询它是否可以转换 FROM 字符串，也不会实际进行转换。此外，在文本框中进行编辑后，旧值立即被替换（另一个 CanConvertTo 和 ConvertTo 序列，恢复旧值）。最终结果是文本框中新键入的条目在应用后立即恢复。

我觉得好像只是缺少一些简单的东西。有没有？这整个项目/方法注定要失败吗？还有其他人尝试这种疯狂吗？如何将自定义的多部分类型双向绑定到基于字符串的控件？

**解决方案：**奇怪的是，只需要在 Binding 对象上启用“格式化”即可。（谢谢，乔恩斯基特）：

```
textBox.DataBindings.Add("Text", this, "MyVectorProperty"); //FAILS
textBox.DataBindings.Add("Text", this, "MyVectorProperty", true); //WORKS! 
```

奇怪的是，我的 MSDN 提到的关于这个参数（formattingEnabled）的所有内容都是：

> "true 以格式化显示的数据；否则为 false"

它没有提到它是从控件返回数据的要求（在这些条件下）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-22T17:03:58.863

**知道了！**

将[`Binding.FormattingEnabled`](http://msdn.microsoft.com/en-us/library/system.windows.forms.binding.formattingenabled.aspx)属性设置为 true。这似乎使一切正常。[`ControlBindingsCollection.Add`](http://system.windows.forms.controlbindingscollection.add)您可以通过对最后采用布尔参数的方法进行重载来做到这一点。奇怪的是它以一种方式工作，但以前不是另一种，但我的测试应用程序现在可以工作了......

（下面的旧答案）

如果你有一个结构而不是一个类这一事实在这里很重要 - 以及你使用字段而不是属性的方式，我一点也不感到惊讶。

尝试使用使用自动实现的属性的类：

```
public class MyClass
{ 
   public int IntPart { get; set; } 
   public string StringPart { get; set; }
   //...
} 
```

这很可能不是问题的根源，但是使用带有公共字段的可变结构只是自找麻烦 IMO。

编辑：正如评论中提到的，我现在已经启动并运行了一个示例。Binding.Parse 正在以正确的值引发。现在找出为什么没有调用 TypeConverter ......

编辑：我发现了[一篇有用的文章](http://www.freeweb.hu/noiseehc/SimpleBind.html)，它更详细地描述了绑定。似乎表明类型转换器仅用于将“转换为”另一种类型-因此您需要类型转换器`string`才能知道如何转换为自定义类型。诚然，这对我来说似乎很奇怪，但还有其他两种选择：

*   使用 Binding 的 Format 和 Parse 事件进行转换
*   使类型实现 IConvertible

这些都不是以完全相同的方式吸引人的，但它们*可能*足以解决您的问题。我确信有一种方法可以使用 TypeConverters 让它工作，但如果我现在能看到它，我会感到震惊。

# c# - 使用正则表达式在某些标签中查找值

> ID：469902
> 
> 赞同：0
> 
> 时间：2009-01-22T16:47:27.993
> 
> 标签：c#, regex

我有一个示例字符串：

```
<num>1.</num> <Ref>véase anomalía de Ebstein</Ref> <num>2.</num> <Ref>-> vascularización</Ref> 
```

我希望用 ref 标签内的值制作一个逗号分隔的字符串。

我尝试了以下方法：

```
 Regex r = new Regex("<ref>(?<match>.*?)</ref>");
            Match m = r.Match(csv[4].ToLower());
            if (m.Groups.Count > 0)
            {
                if (m.Groups["match"].Captures.Count > 0)
                {
                    foreach (Capture c in m.Groups["match"].Captures)
                    {
                        child.InnerText += c.Value + ", ";       
                    }
                    child.InnerText = child.InnerText.Substring(0, child.InnerText.Length - 2).Replace("-> ", "");
                }
            } 
```

但这似乎只能在第一个 ref 标签内找到值。

我哪里错了？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T16:53:40.053

您希望使用 Matches 而不是 match 来获取发生的所有匹配项，例如：

```
Regex r = new Regex("<ref>(?<match>.*?)</ref>");
foreach (Match m in r.Matches(csv[4]))
{
    if (m.Groups.Count > 0)
    {
        if (m.Groups["match"].Captures.Count > 0)
        {
            foreach (Capture c in m.Groups["match"].Captures)
            {
                child.InnerText += c.Value + ", ";
            }
            child.InnerText = child.InnerText.Substring(0, child.InnerText.Length - 2).Replace("-> ", "");
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T20:02:49.923

我强烈建议使用 XPath 而不是正则表达式来搜索 XML 文档。

```
string xml = @"<test>
    <num>1.</num> <Ref>véase anomalía de Ebstein</Ref> <num>2.</num> <Ref>-> vascularización</Ref>
</test>";

XmlDocument d = new XmlDocument();
d.LoadXml(xml);

var list = from XmlNode n in d.SelectNodes("//Ref") select n.InnerText;
Console.WriteLine(String.Join(", ", list.ToArray())); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T16:58:05.413

正则表达式通常很饿，因此它会从第一个标签匹配到最后一个标签。如果您的 XML 格式正确，您可以将正则表达式更改为：

```
Regex r = new Regex("<ref>(?<match>[^<]*?)</ref>"); 
```

搜索除 <

# sql-server - 对小型桌面应用程序使用变更数据捕获？

> ID：469903
> 
> 赞同：2
> 
> 时间：2009-01-22T16:47:34.607
> 
> 标签：sql-server, sql-server-2008, change-data-capture

我的一个新客户有一个 2002 年编写的小型 VB/Access 数据库应用程序，他希望对其进行重写以使其更新并支持他一直想要的新功能。因此，我将把它转换为在本地计算机上使用 C#.NET 2008 和 SQL Server Express 2008，并能够扩展到在远程服务器上使用 WCF 和 SQL Server 2008。

他感兴趣的新功能之一是维护和报告一段时间内数据更改的完整历史记录。过去，我通过使用触发器和存储过程来做到这一点，这对@!#$ 来说很痛苦。

我最近很想弄乱 SQL Server 2008 的变更数据捕获功能。在我最初使用它的一个小时内，我意识到它在 SQL 代理中创建了一个默认情况下每 5 秒运行一次的作业。当我需要更改捕获表的架构时，这似乎也有点痛苦。除此之外，它似乎比我原来的方法更容易实现。所以，这些是我的问题：

1.  对于最终可能会或可能不会迁移到远程服务器的小型桌面应用程序来说，这是否有点矫枉过正？
2.  在性能方面我应该期待什么？随着他的数据库大小增加，我是否会接到更多来自他的电话，说他的计算机运行缓慢？
3.  我应该从目前在生产中使用它的任何人那里了解 CDC 的任何其他问题吗？
4.  有没有人有任何链接指向他们最喜欢的随时间跟踪变化的方式，这可能更适合小型桌面应用程序？

谢谢，

马克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T17:09:29.743

CDC 仅在 SQL Server 企业版中可用。所以如果你有快递，你就不能使用它，你必须继续使用触发器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T17:18:14.840

虽然触发器在很多方面都很难使用，但您可以通过编写实际自动**生成**触发器和历史表的脚本，在透明的数据审计历史机制上使用它们，而不会对主代码库产生任何影响。这是一项相当多的工作，我不知道有谁做过这样的事情并将其开源，但这可能是一个有趣的项目。至少这样，您可以编写一个生成器过程，然后不必再与单个触发器混为一谈。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-11T03:41:14.053

我使用我自己的更改数据跟踪系统，在我的更改表中使用 XML 列，使其更加灵活。也使触发器相当通用。

假设您已经有触发器来创建审计行，并且您的源表有一个名为“Version”的 ROWVERSION 类型的列：

```
INSERT INTO [Changes].Sites
(
    SiteID,
    Operation,
    Version,
    ModifiedOn,
    DataChange
)
SELECT
    IsNull( I.SiteID, D.SiteID ),
    CASE
        WHEN D.[Version] IS NULL      AND I.[Version] IS NOT NULL  THEN 'I'
        WHEN D.[Version] IS NOT NULL  AND I.[Version] IS NOT NULL  THEN 'U'
        WHEN D.[Version] IS NOT NULL  AND I.[Version] IS NULL      THEN 'D'
        ELSE '?'
    END,
    IsNull( I.Version, D.Version ),
    SysDateTimeOffset(),
    (
        SELECT
            [Deleted] = ( SELECT * FROM deleted D1 WHERE D1.SiteID = D.SiteID FOR XML PATH(''), TYPE ),
            [Inserted] = ( SELECT * FROM inserted I1 WHERE I1.SiteID = I.SiteID FOR XML PATH(''), TYPE )
        FOR XML PATH('Changes')
    )
FROM deleted D
FULL JOIN inserted I
    ON D.SiteID = I.SiteID 
```

该查询中唯一特定于我的表的是主键。生成模板来创建这些查询将相当简单（甚至可以使用 sys.tables 等在 SQL 中完成）。

# ruby-on-rails - Rails 忽略了我的 datetime 列的时间部分

> ID：469906
> 
> 赞同：0
> 
> 时间：2009-01-22T16:47:41.563
> 
> 标签：ruby-on-rails, datetime

出于某种原因，我无法为 MySQL 节省时间。我的专栏是一个日期时间，我在测试时也尝试过使用时间戳。下面是我的控制台会话：

```
$ ./脚本/控制台
加载开发环境（Rails 2.1.0）
>> Event.find 1
# 事件 id: 1, name: "会议在 XXX", start_date: "2009-01-17"
>> e.start_date = Time.now
=> 2009 年 1 月 22 日星期四 16:40:01 0000
>> e.保存
=> 真
>> e.start_date
=> 2009 年 1 月 22 日星期四 16:40:01 0000
>> e.重新加载
# 事件 id: 1, name: "会议在 XXX", start_date: "2009-01-22"

```

时间部分只是在更新和查询中被忽略。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-22T23:15:48.660

原来这是由 Rails 1 或更低版本的旧代码引起的。

```
ActiveSupport::CoreExtensions::Date::Conversions::DATE_FORMATS.merge!(
  :date_month => "%d %b",
  :dd_mm_yyyy => "%d/%m/%y",
  :yyyy_mm_dd  => "%Y-%m-%d"
)

ActiveSupport::CoreExtensions::Time::Conversions::DATE_FORMATS.merge!(
    ActiveSupport::CoreExtensions::Date::Conversions::DATE_FORMATS
) 
```

删除它解决了问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-02-27T21:29:21.020

我有一个类似的问题，列的日期部分没有被保存。这是因为类型 was`time`和 not `datetime`。

# regex - Regular Expressions: Is there an AND operator?

> ID：469913
> 
> 赞同：866
> 
> 时间：2009-01-22T16:49:14.057
> 
> 标签：regex, lookahead

Obviously, you can use the `|` (pipe?) to represent `OR`, but is there a way to represent `AND` as well?

Specifically, I'd like to match paragraphs of text that contain ALL of a certain phrase, but in no particular order.

* * *

## 回答 #1

> 赞同：451
> 
> 时间：2009-01-22T16:58:53.587

使用非消耗正则表达式。

典型的（即 Perl/Java）表示法是：

`(?=`*表达式*`)`

这意味着“匹配*expr*，但之后在原始匹配点继续匹配”。

您可以随心所欲地执行这些操作，这将是一个“和”。例子：

`(?=match this expression)(?=match this too)(?=oh, and this)`

如果您需要在其中保存一些数据，您甚至可以在非消费表达式中添加捕获组。

* * *

## 回答 #2

> 赞同：411
> 
> 时间：2009-01-22T20:04:11.200

您需要像其他一些响应者所说的那样使用前瞻，但前瞻必须考虑其目标词和当前匹配位置之间的其他字符。例如：

```
(?=.*word1)(?=.*word2)(?=.*word3) 
```

在`.*`第一个前瞻中，它可以匹配在到达“word1”之前需要的任意多个字符。然后匹配位置被重置，第二个前瞻寻找“word2”。再次重置，最后部分匹配“word3”；因为它是您要检查的最后一个单词，所以没有必要将它放在前瞻中，但这并没有什么坏处。

为了匹配整个段落，您需要在两端锚定正则表达式并添加一个final`.*`来消耗剩余的字符。使用 Perl 风格的表示法，这将是：

```
/^(?=.*word1)(?=.*word2)(?=.*word3).*$/m 
```

'm' 修饰符用于多线模式；它让`^`and`$`匹配段落边界（正则表达式中的“行边界”）。在这种情况下，您必须**不要**使用 's' 修饰符，它可以让点元字符匹配换行符以及所有其他字符。

最后，您要确保匹配整个单词，而不仅仅是较长单词的片段，因此您需要添加单词边界：

```
/^(?=.*\bword1\b)(?=.*\bword2\b)(?=.*\bword3\b).*$/m 
```

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2011-04-20T12:11:40.323

看这个例子：

我们有 2 个正则表达式 A 和 B，我们想匹配它们，所以在伪代码中它看起来像这样：

```
pattern = "/A AND B/" 
```

它可以不使用 AND 运算符来编写，如下所示：

```
pattern = "/NOT (NOT A OR NOT B)/" 
```

在 PCRE 中：

```
"/(^(^A|^B))/"

regexp_match(pattern,data) 
```

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2014-06-30T11:25:56.810

AND 运算符**隐含**在 RegExp 语法中。
OR 运算符必须用管道指定。
以下正则表达式：

```
var re = /ab/; 
```

表示字母`a` **和**字母`b`。
它也适用于组：

```
var re = /(co)(de)/; 
```

这意味着组`co` **和**组`de`。
用 OR 替换（隐式）AND 需要以下几行：

```
var re = /a|b/;
var re = /(co)|(de)/; 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2009-01-22T18:07:04.837

你可以用一个正则表达式来做到这一点，但可能你会想要其他的。例如，使用几个正则表达式并将它们组合在一个 if 子句中。

您可以使用标准正则表达式枚举所有可能的排列，如下所示（以任意顺序匹配 a、b 和 c）：

```
(abc)|(bca)|(acb)|(bac)|(cab)|(cba) 
```

但是，如果您有多个术语，这会导致非常长且可能效率低下的正则表达式。

如果您使用一些扩展的正则表达式版本，例如 Perl 或 Java，他们有更好的方法来做到这一点。其他答案建议使用积极的前瞻操作。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-01-22T16:57:52.760

Is it not possible in your case to do the AND on several matching results? in pseudocode

```
regexp_match(pattern1, data) && regexp_match(pattern2, data) && ... 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2013-12-27T13:49:46.337

为什么不使用awk？
使用 awk 正则表达式 AND，OR 很简单

```
awk '/WORD1/ && /WORD2/ && /WORD3/' myfile 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-01-22T16:59:30.543

如果你使用 Perl 正则表达式，你可以使用积极的前瞻：

例如

```
(?=[1-9][0-9]{2})[0-9]*[05]\b 
```

将是大于 100 且可被 5 整除的数字

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2015-11-13T11:30:56.370

**除了接受的答案**

我将为你们提供一些实际的例子，让你们中的一些人更清楚。例如，假设我们有这三行文本：

```
[12/Oct/2015:00:37:29 +0200] // only this + will get selected
[12/Oct/2015:00:37:x9 +0200]
[12/Oct/2015:00:37:29 +020x] 
```

**在此处查看演示** **[DEMO](https://regex101.com/r/bC8cD0/2)**

我们在这里要做的是选择 + 号，但前提是它在两个带空格的数字之后并且在四个数字之前。这些是唯一的限制。我们将使用这个正则表达式来实现它：

```
'~(?<=\d{2} )\+(?=\d{4})~g' 
```

请注意，如果您将表达式分开，它将给您不同的结果。

或者也许您想在标签之间选择一些文本......但不是标签！然后你可以使用：

```
'~(?<=<p>).*?(?=<\/p>)~g' 
```

对于这个文本：

```
<p>Hello !</p> <p>I wont select tags! Only text with in</p> 
```

**在此处查看演示** **[DEMO](https://regex101.com/r/xK2wX0/2)**

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2009-01-22T16:56:05.853

The order is always implied in the structure of the regular expression. To accomplish what you want, you'll have to match the input string multiple times against different expressions.

What you want to do is *not* possible with a single regexp.

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2014-11-20T21:36:21.873

您可以将输出通过管道传输到另一个正则表达式。使用 grep，您可以这样做：

`grep A | grep B`

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2011-09-09T18:13:04.763

在正则表达式之外使用 AND。在 PHP 中，前瞻运算符似乎对我不起作用，而是我使用了这个

```
if( preg_match("/^.{3,}$/",$pass1) && !preg_match("/\s{1}/",$pass1))
    return true;
else
    return false; 
```

如果密码长度为 3 个或更多字符并且密码中没有空格，则上述正则表达式将匹配。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2020-11-25T10:16:08.287

`((yes).*(no))|((no).*(yes))`

`yes`将匹配同时具有这两者的句子`no`，而不管它们出现的顺序：

`Do i like cookies? **Yes**, i do. But milk - **no**, definitely no.`

`**No**, you may not have my phone. **Yes**, you may go f yourself.`

两者都匹配，忽略大小写。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-05-06T09:22:28.423

这是“and”运算符的一种可能的“形式”：

以下面的正则表达式为例：

如果我们想匹配没有“e”字符的单词，我们可以这样做：

```
/\b[^\We]+\b/g 
```

*   `\W`表示不是“单词”字符。
*   `^\W`表示“单词”字符。
*   `[^\We]`表示“word”字符，但不是“e”。

实际操作：[没有 e 的单词](https://regexr.com/5s72r)

## 正则表达式的“and”运算符

我认为这种模式可以用作正则表达式的“**和”运算符。**

一般来说，如果：

*   `A = not a`
*   `B = not b`

然后：

```
[^AB] = not(A or B) 
      = not(A) and not(B) 
      = a and b 
```

## 差异集

所以，如果我们想在正则表达式中实现[差异集的概念，我们可以这样做：](https://en.wikipedia.org/wiki/Difference_set)

```
a - b = a and not(b)
      = a and B
      = [^Ab] 
```

# html - 通过 XSL 交替行颜色的 HTML 表格

> ID：469917
> 
> 赞同：16
> 
> 时间：2009-01-22T16:51:16.020
> 
> 标签：html, xslt, html-table

在 HTML 表格中交替行颜色的最简单方法是什么（也称为条带化）。我的大多数表都是在 XSL 模板中创建的，如下所示，表、thead 等在另一个模板中定义。

```
<xsl:template match="typ:info">
  <tr>
    <td>
      <xsl:value-of select="typ:dateAccessed" />
    </td>
    <td>
      <xsl:value-of select="typ:loginId" />
    </td>
  </tr>
</xsl:template> 
```

我的偏好是在元素上使用交替类。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-22T17:01:53.813

如果您必须在 HTML 中生成硬编码颜色：

```
<xsl:template match="typ:info">
  <xsl:variable name="css-class">
    <xsl:choose>
      <xsl:when test="position() mod 2 = 0">even</xsl:when>
      <xsl:otherwise>odd</xsl:otherwise>
    </xsl:choose>
  </xsl:variable>
  <tr class="{$css-class}">
    <td>
      <xsl:value-of select="typ:dateAccessed" />
    </td>
    <td>
      <xsl:value-of select="typ:loginId" />
    </td>
  </tr>
</xsl:template> 
```

在当今的浏览器中，使用 CSS 和`tr:nth-child(odd)`.

这导致 XSLT 方面的麻烦更少，HTML 标记更清晰 - 并且它与客户端表格排序和过滤兼容。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-05-01T11:40:40.300

您也可以使用 css3。

```
tr:nth-child(odd) { background: #ff0000; } 
```

所有其他浏览器在相当长的一段时间内都支持 IE9。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T17:03:54.607

使用 XSL:When 并比较位置 mod 2 以获得奇数行或偶数行以在需要时更改类，例如：

```
<xsl:choose>
    <xsl:when test="position() mod 2 = 1">
        <td class="odds">blah</td>
    </xsl:when>
    <xsl:otherwise>
        <td class="even">blah</td>
    </xsl:otherwise>
</xsl:choose> 
```

**编辑：**让我的奇数/偶数以正确的方式*叹息*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-04T20:09:07.400

可能我们只想更改类名，什么时候可以在变量内部选择以启用更改其内部值。像这样的东西：

```
<xsl:variable name="myDemoClass" >
   <xsl:choose>
     <xsl:when test="position() mod 2 = 0">
       <xsl:text>myDemoClass</xsl:text>
     </xsl:when>
     <xsl:otherwise>
       <xsl:text>myDemoClass otherClass</xsl:text>
     </xsl:otherwise>
   </xsl:choose>
</xsl:variable> 
```

有了这个，我们可以更改变量名称，然后我们可以更改例如 div 类的内容。

```
<div class="{$myDemoClass}"> 
```

问候！

# sql-server - 您如何使用 SQL Server CE 和 SQL Server 2008 Express？

> ID：469929
> 
> 赞同：2
> 
> 时间：2009-01-22T16:53:52.940
> 
> 标签：sql-server, visual-studio-2008, sql-server-2008, sql-server-ce

我已经安装了：

*   Visual C# 2008 速成版
*   视觉 Web 开发者 2008 速成版
*   视觉工作室 2008
*   SQL Server 2008 速成版
*   SQL Server 管理工作室

在 Visual C# 2008 Express 中，我可以“添加项目”并创建“本地数据库”（.sdf 文件）或“基于服务的数据库”（.mdf 文件）。

Visual Studio 2008 与用于应用程序的 Visual C# 2008 相同，但在网站中，我可以创建 .sdf 或 .mdf 文件的唯一方法是通过数据库资源管理器。

然而，在 Visual Web Developer 2008 Express 中，我可以“添加项目”并且只创建一个“SQL Server 数据库”（.mdf 文件）。甚至 Database Explorer 也不提供创建 SQL CE 数据库的功能。

问题：

*   为什么应用程序之间存在差异，这是正常现象还是我的安装出了问题？
*   我从来没有“安装过 SQL CE”，它是从哪里来的，我是如何创建 .sdf 文件的？
*   您如何在日常项目中使用这些，您是使用 Visual Studio 编辑数据库还是使用 SQL Server Management Studio？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T01:46:53.400

我相信只有 Professional 和更高版本可以创建 MSSQL CE 数据库。

SQL CE 与 2008 studio 一起安装，我自己看到它很惊讶，并没有看到排除它的选项。

我个人使用 VS 2008 将项目添加到我的项目数据库中。因为它无论如何都是开放的，所以我只是使用它。它提供与 Management Studio 相同的大部分功能。如果我在做单独的数据库工作，我通常在 Management Studio 中做。

CE 数据库非常没用。它们具有有限的类型和功能子集。它们不支持视图或存储过程。基本上他们只存储表格；我没有尝试在其中创建外键。

无法重命名表或列。您必须创建一个新表。

创建数据库后，必须手动将其添加到项目中。

您不能直接在 CE 数据库上的 VS2008 中创建 LINQ to SQL 类。您需要使用命令行工具 sqlmetal（从 .NET 控制台调用）为您创建类。

我遇到了为 CE 数据库创建的类不像为常规 SQL 数据库构建的类那样工作的问题。因此，我放弃了一起使用 CE 数据库。

[如果有一种可靠的方法可以在SQLite](http://www.sqlite.org)数据库上使用 Linq to SQL，那就太好了。SQLite 是一个很棒的独立数据库，不需要任何类型的外部引擎。

抱歉，我没有 SQL CE 数据库的任何性能统计信息。

我希望这有点帮助。

布雷特

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T22:27:14.947

好的，现在注册，不知道为什么对以前的答案投了-1票，但会扩大。

Web Developer Express 2008 不创建或使用 Sql Server CE 仅仅是因为 SQL Server CE 不是为在 Web 服务器上工作而设计的。

当你加载 c# express 或 vb express。提供安装sql server express 2008。未安装 SQL CE。如果你去添加一个我知道的两个数据源，Microsoft SQL Server Compact 3.5（Microsoft SQL Server Compact 3.5 的.NET Framework Data Provider）和Microsoft SQL Server Database File（SqlClient），访问客户端可能在那里还。

应该注意默认的 Express 设置，如果您选择使用 sql server compact 的数据提供程序，即使它是一个选项，它也会失败。您必须单独下载 sql server ce 才能创建 sdf 数据库。

此外，Express 版本针对不同的受众，并且没有与 main vs sku 相同的 ui 设置。例如，数据库设置中的 Web express 甚至不提供使用 sql server ce 的选择。而在 VS 中，它是从数据菜单中选择的，主要是因为 VS 支持的不仅仅是 Web 开发人员。

现在你说你加载了VS 2008（没有说什么版本但没关系，因为这会影响标准及更高版本）

vs 2008 的默认安装将安装 Sql server ce（并且如之前的回答所述，3.1 与 rtm 一起使用，3.5 与 sp1 一起使用）。你可以提前关闭它的选项。

我担心的一个问题是您提到您无法在 vs on web 项目中创建数据库。您使用的是哪个模板。您应该能够在添加项目中创建基于服务器的数据库项目，并在数据选项卡中创建本地和服务器数据库对象。

所以在夏天。

在基于客户端的快速 skus 和基于客户端的项目上，您应该能够从添加项目和数据选项卡创建本地或基于服务器的数据库。

由于 sql CE 在 Web 服务器上不受官方支持。在添加项目的网络 skus 上，您应该只能访问创建基于服务器的数据库。在快递上，因为它是专用的 sku CE 不是数据选项卡或添加项目中的选项。在 vs 上，您可以从“数据”选项卡创建 CE 数据库。并且您应该有权在添加项目中创建服务器数据库。

sql server management studio 不关心源在哪里。因此它将与所有人一起使用并创建数据库。

我使用列出的所有选项只是取决于我当时在哪里或在哪里。如前所述，桌面上的 CE 主要是一个缓存数据库，非常适合离线数据库支持。但确实有其局限性，此外确实需要更好的集成。一旦我创建或使用支持数据库，我主要使用管理工作室。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T17:02:10.833

这很正常。Visual Studio 设计器支持的数据库类型因版本而异。请注意，任何版本的 Visual Studio 都可以编写和使用连接到任何这些数据库的代码。只是 IDE 中包含的可视化“向导”工具可以引导您完成每个版本的不同。

SQL CE 是 sql server 的精简版。它旨在用于智能手机等便携式设备或作为桌面应用程序中本地数据存储的 Access 替代品。它非常便携：只有 2 个 dll 的磁盘空间小于 1Mb，并且可能包含在至少一个 Visual Studio 包中，可能全部包含在其中。

我通常在 Management Studio 中完成所有数据库工作，但这是个人喜好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T18:01:42.430

无法从 Web express 访问 CE 的关键在于 Web 服务器不支持 CE。

道格拉斯

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-22T17:00:51.460

这种差异很奇怪，但由于 SQL CE 是一个插件项目，很可能是团队没有测试所有可能的场景，并且一些应用程序根本没有获得他们需要知道它存在的信息。我并不是说出了什么问题——它可能只是 SQL CE 团队从未测试过的场景。

SQL CE 是随 Studio 一起安装的（暂时想不起来，但我认为 RTM 附带了 3.1，SP1 附带了 3.5）。

我总是使用 Management Studio 进行数据库修改（直接在代码中完成的除外）。

# python - deleting rows of a numpy array based on uniqueness of a value

> ID：469931
> 
> 赞同：4
> 
> 时间：2009-01-22T16:54:05.780
> 
> 标签：python, arrays, numpy, unique

let's say I have a bi-dimensional array like that

```
numpy.array(
    [[0,1,1.2,3],
    [1,5,3.2,4],
    [3,4,2.8,4], 
    [2,6,2.3,5]]) 
```

I want to have an array formed eliminating whole rows based on uniqueness of values of last column, selecting the row to keep based on value of third column. e.g. in this case i would like to keep only one of the rows with 4 as last column, and choose the one which has the minor value of third column, having something like that as a result:

```
array([0,1,1.2,3],
      [3,4,2.8,4],
      [2,6,2.3,5]) 
```

thus eliminating row [1,5,3.2,4]

which would be the best way to do it?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T19:41:26.427

我的 numpy 已经过时了，但这应该可行：

```
#keepers is a dictionary of type int: (int, int)
#the key is the row's final value, and the tuple is (row index, row[2])
keepers = {}
deletions = []
for i, row in enumerate(n):
    key = row[3]
    if key not in keepers:
        keepers[key] = (i, row[2])
    else:
        if row[2] > keepers[key][1]:
            deletions.append(i)
        else:
            deletions.append(keepers[key][0])
            keepers[key] = (i, row[2])
o = numpy.delete(n, deletions, axis=0) 
```

我已经从我的声明式解决方案中大大简化了它，这变得非常笨拙。希望这更容易理解；我们所做的只是维护一个我们想要保留的值的字典和一个我们想要删除的索引列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-12-10T14:16:41.920

这可以通过组合在 Numpy 中有效地实现`lexsort`，`unique`如下所示

```
import numpy as np

a = np.array([[0, 1, 1.2, 3], 
              [1, 5, 3.2, 4],
              [3, 4, 2.8, 4], 
              [2, 6, 2.3, 5]])

# Sort by last column and 3rd column when values are equal
j = np.lexsort(a.T)

# Find first occurrence (=smallest 3rd column) of unique values in last column
k = np.unique(a[j, -1], return_index=True)[1]

print(a[j[k]]) 
```

这将返回所需的结果

```
[[ 0\.   1\.   1.2  3\. ]
 [ 3\.   4\.   2.8  4\. ]
 [ 2\.   6\.   2.3  5\. ]] 
```

# java - MPI implementation for Java

> ID：469932
> 
> 赞同：9
> 
> 时间：2009-01-22T16:54:20.943
> 
> 标签：java, mpi, openmpi

Is there a current Java MPI implementation. I have programmed in MPI a bit, and I enjoy programming in Java. I have seen [this](http://aspen.ucs.indiana.edu/pss/HPJava/mpiJava.html) implementation in Java, but it seems dated. Is there a more up to date Java implementation that is being kept up?

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-10T22:57:24.583

看看[MPJ](http://mpj-express.org/)

您可以在 Wikipedia中阅读此[部分。](http://en.wikipedia.org/wiki/Message_Passing_Interface#Java)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-05-26T19:58:06.903

Open MPI 在其 SVN 开发主干上包含第一组 java 绑定；它们将成为 v1.7 版本的一部分。

如果您需要更多支持，请发布到 Open MPI 用户的邮件列表并告诉我们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-01-31T17:30:36.543

更新说明：目前最相关的 3 个实现是[FastMPJ](http://gac.udc.es/~rreye/fastmpj/)、[MPJ Express](http://mpj-express.org/)和 Open MPI 的 Java 绑定。这三个正在更新，应该可以在 OSX 上运行，尤其是 100% 纯 Java 实现，例如 FastMPJ 和 MPJ Express。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T15:43:31.177

不久前我研究了 MPJ，虽然它仍处于测试阶段，但它看起来相当不错，并且仍在开发中。您提到这在 OSX 检查文档时不起作用，有一节介绍了如何使其正常工作：-

PPC32 Mac OS X

```
 a. Edit $MPJ_HOME/bin/mpjboot and $MPJ_HOME/bin/mpjhalt
  b. Comment the line ssh $host "cd $MPJ_HOME/bin;./mpjdaemon_linux_x86_32 start;"
  c. Uncomment the line #ssh $host "cd $MPJ_HOME/bin;./mpjdaemon_macosx_ppc_32 start;"
  d. cd $MPJ_HOME/lib
  e. cp libwrapper.jnilib_macosx_ppc_32 libwrapper.jnilib 
```

请参阅： http: [//mpj-express.org/docs/readme/README.html#dmnvarplats](http://mpj-express.org/docs/readme/README.html#dmnvarplats)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-18T23:25:54.167

[http://fastmpj.com](http://fastmpj.com)是最近的另一个不错的选择。您可以根据要求获得。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-03T16:41:58.877

我在 open dash mpi dot org 邮件列表中向用户发布了一组关于在 Mac OSX 上构建和使用 OpenMPI java 绑定的说明： [http ://www.open-mpi.org/community/lists/users/2013/01 /21067.php](http://www.open-mpi.org/community/lists/users/2013/01/21067.php) 希望这可以帮助像 Milhous 和我这样喜欢我们在 Java 中传递消息的人！

查克

# vb.net - Running NUnit summary after completion of NUnit tests in a batch file

> ID：469937
> 
> 赞同：0
> 
> 时间：2009-01-22T16:55:37.990
> 
> 标签：vb.net, nunit, watin

I want to to run [NUnit](http://en.wikipedia.org/wiki/NUnit) summary.exe after successful completion of a NUnit Tests assembly. I am calling NUnit from a batch file and then I want to call NUnit summary. How to do this?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-12T20:36:52.427

只需在批处理文件中调用 nunit.console.exe 后添加 nunit summary.exe。如果您想要更多的控制权，您应该检查 Powershell，这将更容易在测试运行后检查 results.xml 文件是否存在。

# perl - 如何在命令行中使用 Perl 搜索其他程序的输出？

> ID：469941
> 
> 赞同：6
> 
> 时间：2009-01-22T16:56:25.260
> 
> 标签：perl, unix, command-line

据我了解（Perl 对我来说是新的）Perl 可用于针对 Unix 命令行编写脚本。我想要做的是运行（硬编码）命令行调用，并在这些调用的输出中搜索 RegEx 匹配项。有没有办法在 Perl 中简单地做到这一点？如何？

编辑：这里的顺序是：-调用另一个程序。- 对其输出运行正则表达式。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-22T17:21:41.200

```
my $command = "ls -l /";
my @output = `$command`;
for (@output) {
    print if /^d/;
} 
```

准引用运算符（反引号是一种快捷方式）是从 shell 语法中窃取的`qx//`：在新 shell 中将字符串作为命令运行，并返回其输出（作为字符串或列表，取决于上下文）。详情请参阅`perlop`。

您还可以打开管道：

```
open my $pipe, "$command |";
while (<$pipe>) {
    # do stuff
}
close $pipe; 
```

这允许您 (a) 避免一次将整个命令的输出收集到内存中，并且 (b) 让您可以更好地控制命令的运行。例如，您可以避免命令被 shell 解析：

```
open my $pipe, '-|', @command, '< single argument not mangled by shell >'; 
```

有关`perlipc`详细信息，请参阅。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-22T22:48:41.790

正如其他人所提到的，没有 Perl 你也许可以逃脱。但是，如果您需要一些 Perl 功能，例如扩展的正则表达式功能或额外的文本操作，您可以通过管道输出`perl`然后执行您需要的操作。Perl 的`-e`开关让我们在命令行上指定 Perl 程序：

```
command | perl -ne 'print if /.../' 
```

您可以将其他几个开关传递给 perl 以使其在命令行上非常强大。这些记录在[perlrun](http://perldoc.perl.org/perlrun.html)中。还可以查看[Randal Schwartz 的 Unix Review 专栏](http://www.stonehenge.com/merlyn/UnixReview/)中的一些文章，尤其是他的[第一篇文章](http://www.stonehenge.com/merlyn/UnixReview/col01.html)。你也可以用谷歌搜索[Perl one liner](http://www.google.com/search?q=perl+one+liners)来找到很多例子。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T16:59:39.263

```
#!/usr/bin/perl

sub my_action() {
        print "Implement some action here\n";
}

open PROG, "/path/to/your/command|" or die $!;
while (<PROG>) {
        /your_regexp_here/ and my_action();
        print $_;
}
close PROG; 
```

这将扫描您的命令的输出，匹配正则表达式并执行一些操作（现在正在打印该行）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-22T17:10:53.280

你需要 Perl 吗？怎么样

```
command -I use | grep "myregexp" && dosomething 
```

就在壳里？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-22T17:18:34.340

在 Perl 中，您可以使用反引号在 shell 上执行命令。这是[关于使用反引号的文档](http://novosial.org/perl/backticks/)。我不确定如何捕获输出，但我确信**有不止一种方法可以做到这一点**。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-20T12:57:07.743

在这种情况下，您确实使用了单线。我最近编写了一个代码，我使用它来生成输出，其中列出了 .zip 存档中存在的目录结构（每行一个目录条目）。因此，使用该输出作为我们想要过滤的命令输出的示例，我们可以放入一个管道，然后使用带有`-n -e`标志的 perl 来过滤传入的数据（和/或用它做其他事情）：

```
[command_producing_text_output] | perl -MFile::Path -n -e \
   "BEGIN{@PTM=()} if (m{^perl/(bin|lib(?!/site))}) {chomp;push @PTM,$_}" ^
-e "END{@WDD=mkpath (\@PTM,1);" ^
-e "printf qq/Created %u dirs to reflect part of structure present in the .ZIP file\n/, scalar(@WDD);}" 
```

*使用的 shell 语法，包括：perl 代码的引用和换行符的转义，反映了 CMD.exe 在类似 Windows NT 的控制台中的使用。如果需要，请在适当的位置将“^”替换为“\”，将“替换为 '。*

上面的单行代码只添加以“perl/bin”或“perl/lib”开头的目录名（不跟“/site”）；然后它创建这些目录。你最终得到一个（空）树，你可以用于任何你想要的邪恶目的。

重点是说明有可用的标志（`-n`, `-p`）允许 perl 循环遍历每个输入记录（行），并且您可以做的事情在复杂性方面是无限的。

# html - 为什么 www.linux.org.il 在 MSIE 7 中看起来不正确？

> ID：469945
> 
> 赞同：0
> 
> 时间：2009-01-22T16:57:20.780
> 
> 标签：html, css, internet-explorer, internet-explorer-7

我是[http://www.linux.org.il/](http://www.linux.org.il/)的维护者，它在 Microsoft Internet Explorer 7 中看起来不正确。我看到的问题是导航栏出现在页面正文的顶部的右侧，就像在 Firefox 中一样。有谁知道如何在 MSIE 7 中修复它（如果可能的话——也在 MSIE 6 中）？

我应该注意到，在 Firefox 和其他浏览器中，导航栏在页面滚动时保持在原位，但我不介意在 MSIE 中它会与页面的其余部分一起移动。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-22T17:02:10.240

在侧边栏 div 上添加 float:right。这将导致内容被拉起。不确定对 Firefox 会有什么影响；-)

我使用 IE 开发人员工具栏对此进行了测试，我会提醒您，当您通过此工具进行修改时，我已经看到一些更改有效，但在包含在原始标记中时无效。希望这对你有用

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T16:59:48.810

`position: fixed`MSIE在 CSS 中具有片状支持。如果这是您正在做的事情，那么您必须使用 JavaScript。如果您已经在使用 JavaScript，请检查您正在使用的变量。见[这里](http://www.howtocreate.co.uk/tutorials/javascript/browserwindow)。

# winapi - 打印时 StretchBlt 失败

> ID：469946
> 
> 赞同：2
> 
> 时间：2009-01-22T16:57:51.683
> 
> 标签：winapi, printing, gdi

我有一个图表（位图格式），我正在尝试使用`StretchBlt`. 绘制到屏幕时，`StretchBlt`工作正常。绘制到 CutePDF 打印机时，它返回 0，将最后一个错误设置为`ERROR_INVALID_HANDLE`，并且仍然可以工作。绘制到 PDF995 打印机或物理 HP 打印机时，它返回 0，将最后一个错误设置为`ERROR_INVALID_HANDLE`，并且无法绘制任何内容。

什么会导致`StretchBlt`某些设备出现故障？我已经验证了源位图是一个 DIB 并且目标支持`StretchBlt`通过调用`GetDeviceCaps`.

这是我的代码，以防相关：（它是用 C++Builder 编写的，所以它使用 Delphi 的 VCL；TCanvas 包装了 HDC，TBitmap 包装了 HBITMAP。VCL 提供了自己的`StretchDraw`函数，不支持 HALFTONE；我得到了同样的问题。）

```
void PrettyStretchDraw(TCanvas *dest, const TRect& rect, TGraphic *source)
{
  if (dynamic_cast<Graphics::TBitmap*>(source) && !source->Transparent) {
    POINT pt;
    GetBrushOrgEx(dest->Handle, &pt);
    SetStretchBltMode(dest->Handle, HALFTONE);
    SetBrushOrgEx(dest->Handle, pt.x, pt.y, NULL);
    StretchBlt(
      dest->Handle,
      rect.Left,
      rect.Top,
      rect.Width(),
      rect.Height(),
      dynamic_cast<Graphics::TBitmap*>(source)->Canvas->Handle,
      0,
      0,
      source->Width,
      source->Height,
      SRCCOPY);
  } else {
    DrawItSomeOtherWay(dest, rect, source);
  }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T17:18:15.403

`StretchBlt`在某些打印机驱动程序上损坏（PDF995 是一个显着的例子）。

我曾经遇到过这个错误只发生在 Windows 2003 Server 上（它在 XP 上工作）。

尝试在其他操作系统上重现该问题，但事实并非如此，将其视为特定于操作系统并`StretchDIBits`在此操作系统上使用。

# asp.net - 病毒上传扫描asp.net

> ID：469949
> 
> 赞同：1
> 
> 时间：2009-01-22T16:58:42.370
> 
> 标签：asp.net, upload, virus

您如何防止人们将病毒上传到您的 asp.net windows 网站？我将显示的唯一用户内容是图像、声音和视频，这些内容会包含病毒吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T17:03:45.150

某些客户端/浏览器可以使用特制图像（咳咳…… IE）加以利用。只要*您*编写 <object> 标记并[清理数据库输入](http://xkcd.com/327/)，我会说您基本上没问题。

另外，如果您想对用户内容进行病毒扫描，可以使用命令行扫描程序，例如 NOD32 提供的扫描程序等，但我认为这对于网站来说过于占用处理器资源。

# python - 在 with_statement 中使用实例的问题

> ID：469950
> 
> 赞同：4
> 
> 时间：2009-01-22T16:58:42.760
> 
> 标签：python, with-statement

我最近开始学习 python ，并且达到了**with**语句。我尝试将它与类实例一起使用，但我认为我做错了什么。这是代码：

```
 from __future__ import with_statement
import pdb

class Geo:

  def __init__(self,text):
    self.text = text

  def __enter__(self):
    print "entering"

  def __exit__(self,exception_type,exception_value,exception_traceback):
    print "exiting"

  def ok(self):
    print self.text

  def __get(self):
    return self.text

with Geo("line") as g :
  g.ok() 
```

问题是，当解释器到达 with 语句中的**ok**方法时，会引发以下异常：

```
 Traceback (most recent call last):
  File "dec.py", line 23, in 
    g.ok()
AttributeError: 'NoneType' object has no attribute 'ok' 
```

为什么 g 对象的类型为 NoneType ？如何使用带有**with**语句的实例？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-22T17:08:38.060

您的`__enter__`方法需要返回应该用于`as g`with 语句的 " " 部分的对象。请参阅[文档](http://docs.python.org/reference/compound_stmts.html#with)，其中指出：

*   如果目标包含在 with 语句中，则将返回值 from`__enter__()`分配给它。

目前，它没有 return 语句，所以 g 被绑定到`None`（默认返回值）

# silverlight - 我可以解决 IE7/8 中的 Silverlight 显色差异吗？

> ID：469961
> 
> 赞同：3
> 
> 时间：2009-01-22T17:00:28.683
> 
> 标签：silverlight, internet-explorer, firefox, rendering

我有一个 Silverlight 控件，它试图与底层 div 具有相同的背景，但我在 IE7/8 中面临色差问题：

[![IE7/8](https://i.stack.imgur.com/cyRp1.png)](https://i.stack.imgur.com/cyRp1.png)

这对 Firefox 来说似乎不是问题。

[![法郎](https://i.stack.imgur.com/rRLtA.png)](https://i.stack.imgur.com/rRLtA.png)

有没有人有提示如何解决这个问题？我尽量避免在 Silverlight 和 alpha 透明度中使用无窗口模式，因为第一个）它更慢，第二个）当您在 Firefox 中单击控件时显示一个边界选择框。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T17:30:53.507

幸运的是我设法解决了这个问题。似乎这是一个伽马校正问题。PNG 文件允许您设置伽玛校正信息，Silverlight 和 IE 似乎以不同的方式处理它。

[此](http://hsivonen.iki.fi/png-gamma/)页面解释了问题并挽救了这一天。[此](http://entropymine.com/jason/tweakpng/)工具也是从 PNG 中删除伽马信息所必需的。

希望这些信息对某人有用。

# php - 无法通过 PHP 连接到 msSQL 数据库

> ID：469964
> 
> 赞同：4
> 
> 时间：2009-01-22T17:01:10.150
> 
> 标签：php, sql, sql-server, sql-server-2005, connection

我正在使用当前代码尝试访问 msSQL 2005 db：

```
<?php
$myServer = "[server]";
$myUser = "[username]";
$myPass = "[password]";
$myDB = "[db]";

//connection to the database
$dbhandle = mssql_connect($myServer, $myUser, $myPass)
  or die("Couldn't connect to SQL Server on $myServer");

//select a database to work with
$selected = mssql_select_db($myDB, $dbhandle)
  or die("Couldn't open database $myDB");

//declare the SQL statement that will query the database
$query = "SELECT id, name, year ";
$query .= "FROM cars ";
$query .= "WHERE name='BMW'";

//execute the SQL query and return records
$result = mssql_query($query);

$numRows = mssql_num_rows($result);
echo "<h1>" . $numRows . " Row" . ($numRows == 1 ? "" : "s") . " Returned </h1>";

//display the results
while($row = mssql_fetch_array($result))
{
  echo "<li>" . $row["id"] . $row["name"] . $row["year"] . "</li>";
}
//close the connection
mssql_close($dbhandle);
?> 
```

它返回以下内容：

```
Warning: mssql_connect() [function.mssql-connect]: Unable to connect to server: XXXXXXX in D:\xxxxx.xxx\xxxx.php on line 16
Couldn't connect to SQL Server on XXXXXXX 
```

你认为问题是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T17:19:02.360

在我看来，您的 DLL 之一是错误的版本。从 SQL2000 迁移到 SQL2005 存在某种问题，PHP 的创建者并没有自己解决。这里有各种关于它的帖子： [以下链接](http://ca3.php.net/manual/en/function.mssql-connect.php)

我相信 DLL 是 ntwdblib.dll 并且版本至少需要是 2000.80.194.0 版本。如果您正在运行 Apache 或 WampServer，则存储 Apache DLL 的相同 dll 需要被覆盖。

注意：几天前我遇到了这个问题，找到正确的 DLL 并覆盖两者都允许它工作。

另外：您可能需要设置远程连接。Sql Server 2005 默认禁用远程连接。您可以通过运行 SQL 外围应用配置实用程序来允许远程连接。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-22T17:12:37.037

尝试调用[`mssql_get_last_message()`](http://www.php.net/mssql_get_last_message)以获取最后一条错误消息：

```
$dbhandle = mssql_connect($myServer, $myUser, $myPass)
  or die("Couldn't connect to SQL Server on $myServer. Error: " . mssql_get_last_message()); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-03-07T18:31:16.890

停止使用

> mssql_connect

并开始使用

> sqlsrv_connect

这将为您省去很多麻烦。另外，函数 *mssql_connect* 已被弃用。

要使用 sqlsrv_connect，您必须下载驱动程序并将其安装为 PHP 的扩展，以识别*sqlsrv*函数。从 Microsoft 下载中心下载驱动程序（搜索“sql server php driver”），在本文发布时，下载地址为： [//www.microsoft.com/en-us/download/details.aspx?id =20098](http://www.microsoft.com/en-us/download/details.aspx?id=20098)

[Microsoft 自己在http://www.microsoft.com/en-us/download/details.aspx?id=20098](http://www.microsoft.com/en-us/download/details.aspx?id=20098)上清楚地解释了正确的安装步骤

1.  下载驱动程序。2.放到PHP ext文件夹中。3.更新php.ini 4.重启服务器。

安装 sql server 驱动程序后，只需按照 [http://www.php.net/manual/en/function.sqlsrv-connect.php](http://www.php.net/manual/en/function.sqlsrv-connect.php)中的说明进行操作。下面是一个快速片段：

```
<?php
$serverName = "serverName\sqlexpress"; //serverName\instanceName

// Since UID and PWD are not specified in the $connectionInfo array,
// The connection will be attempted using Windows Authentication.
$connectionInfo = array( "Database"=>"dbName");
$conn = sqlsrv_connect( $serverName, $connectionInfo);

if( $conn ) {
     echo "Connection established.<br />";
}else{
     echo "Connection could not be established.<br />";
     die( print_r( sqlsrv_errors(), true));
}
?> 
```

投票！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T17:11:52.700

凭据无效，如果您不使用 localhost，请确保将服务器的 ip 添加到安全列表中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-26T18:27:00.520

I had some difficulties with this a few months ago, and I found that the only way to make it work was to include the instance name when specifying the server. For example:

```
$myServer = "SERVER\INSTANCENAME"; 
```

Specifying just the server would not work, even with TCP/IP enabled.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-16T23:27:42.190

首先尝试`phpinfo()`在您的浏览器上执行类似操作，而不是查看允许哪些数据库。

如果你没有看到类似的东西，`mssql`那么它没有配置。所以使用`odbc_connect()`which 将被配置...您的连接字符串将是这样的：

```
$server = '';
$user = '';
$password = '';
$database = '';
$connection = odbc_connect("Driver={SQL Server Native Client `11.0};Server=$server;Database=$database;", $user, $password);` 
```

如果您使用的是 mssql 2005 或 2008，则将 d 11.0 更改为 10.0，对于其他版本，只需更改为您的 mssql 版本。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-06-27T09:48:09.637

在此站点[http://www.microsoft.com/en-us/download/details.aspx?id=20098](http://www.microsoft.com/en-us/download/details.aspx?id=20098)下载驱动程序，然后打开您的 php.ini 文件并添加您下载的 DLL。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-11-20T10:45:21.227

迟到的回应，但它可能会帮助某人。我们快到了，这是您的连接参数的问题，可能您需要将 servername 指定为`IP:port`

**servername::** MS SQL 服务器。例如`hostname:port (Linux), or hostname,port (Windows).`

服务器名称应该是“server\instance” 一个实例只不过是不同于 1433 的特定端口地址......所以只需在 mssql 服务器上发现该端口，然后尝试使用以下方式进行连接：`ip:port`

对我来说完全没问题的示例代码::

```
 ini_set('display_errors', '1');
    // $myServer = "winsrv22.somedns.co.uk:22320";//this style works as well
    $servername = "123.21.47.23:22320";
    $myUser = "UserName";
    $myPass = 'xxxxxxxx';
    $myDB = "[database]"; 

    //connection to the database
    $dbhandle = mssql_connect($servername, $myUser, $myPass)
        or die("Couldn'tt connect to SQL Server on $myServer"); 
    if($dbhandle) {
     echo "Success, Connected\r\n";
    } else {
        echo "problem :( \r\n";
    } 
```

希望这对某人有所帮助:) 编码快乐！

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2020-07-24T16:46:34.650

如果您使用的是 Windows 10。

步骤 1\. 点击开始按钮

step 2\. 输入Service并输入（打开App Services）

步骤 3\. 查找 - SQL Server (MSSQLSERVER)

步骤 4\. 右键单击​​ -> 选择属性

步骤 5\. 显示弹出窗口。您选择第二个选项卡（登录）

步骤 6\. 选择本地系统帐户

步骤 7\. 并检查允许服务与桌面交互

步骤 8\. 最后点击确定。

现在已连接 1 次刷新。我希望它非常有用

# hibernate - Hibernate/Spring 应用程序 - 导出到 CSV

> ID：469969
> 
> 赞同：2
> 
> 时间：2009-01-22T17:01:54.080
> 
> 标签：hibernate, csv, export

我正在使用 Spring/Hibernate 编写一个向用户显示报告的 Web 应用程序，我希望允许用户将结果导出到 CSV 文件。

谁能建议一种将 Hibernate 查询结果输出到 CSV 文件的有效方法？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T17:28:27.240

Hibernate 用于对象关系映射。如果另一端没有对象，那有什么意义呢？

Spring 不禁止混合和匹配 JDBC 和 Hibernate。对手头的问题使用最佳方法。在您的情况下，直接 JDBC 听起来最好。

另外，如果这是一个 Web 应用程序，请查看 Spring 的 AbstractJExcelView。也许您可以编写一个直接的 DAO 来获取数据，将其发送回控制器，然后让它将 JExcelView 呈现回浏览器。用户将在浏览器中将数据视为 Excel 电子表格。他们可以选择从浏览器将其保存为 .csv 文件。干净整洁。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T17:16:57.323

如果您使用的是 Hibernate，则查询的结果将是一个对象列表，我将遍历该列表并使用实用程序类将这些对象作为 csv 打印到 StringBuffer。

让 Hibernate 实例化一个（大？）对象列表及其依赖项，只是为了在实例化后立即将它们序列化为字符串数据，从时钟周期和 RAM 的角度来看，这当然不是很有效，但是从开发人员的角度来看可能是这样 -小时观点。如果您担心您的处理器和 RAM，我建议您运行一个普通的 JDBC SQL 查询并将其直接处理到 csv。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T17:49:08.710

我想 Hibernate 在这里被用作更大应用程序的一部分，其中一部分是将某些内容导出到 CSV。在整个应用程序中使用 Hibernate 时，将 JDBC 用于这一块可能不合适。

如果我的假设不正确，那么 JDBC 是正确的选择，否则您可能需要遍历 Hibernate 的集合来构建您的 CSV。

有时在构建 CSV 时会有一些刺激因素，例如在列值中使用双引号等。这是一个很好的库，可以帮助你：

[http://ostermiller.org/utils/download.html](http://ostermiller.org/utils/download.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-21T03:41:37.627

尝试使用 HibernateTools 查询导出器 [http://docs.jboss.org/tools/4.1.0.Final/en/hibernatetools/html_single/#d0e5010](http://docs.jboss.org/tools/4.1.0.Final/en/hibernatetools/html_single/#d0e5010)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-04-06T04:45:40.647

我使用 FileWriter 将我的 hql（我正在使用带有 struts2 的 Hibernate）结果集导出到 csv，这也可能对您有帮助。我将 hql 结果集存储到 List（转换为 MYPojo）并使用 for 循环将数据写入文件并将其导出为 csv。它适用于我的应用程序。你可以访问 [http://www.mkyong.com/java/how-to-export-data-to-csv-file-java/](http://www.mkyong.com/java/how-to-export-data-to-csv-file-java/)

# c# - 你将如何改进这个浅拷贝类？

> ID：469982
> 
> 赞同：5
> 
> 时间：2009-01-22T17:04:38.427
> 
> 标签：c#, reflection, shallow-copy

我用一个静态方法编写了一个类，该方法将属性值从一个对象复制到另一个对象。它不关心每个对象是什么类型，只关心它们具有相同的属性。它可以满足我的需要，因此我不会对其进行进一步设计，但是您会做出哪些改进？

这是代码：

```
public class ShallowCopy
{
    public static void Copy<From, To>(From from, To to)
        where To : class
        where From : class
    {
        Type toType = to.GetType();
        foreach (var propertyInfo in from.GetType().GetProperties(BindingFlags.GetProperty | BindingFlags.Public | BindingFlags.Instance))
        {
            toType.GetProperty(propertyInfo.Name).SetValue(to, propertyInfo.GetValue(from, null), null);
        }
    }
} 
```

我使用它如下：

```
EmployeeDTO dto = GetEmployeeDTO();
Employee employee = new Employee();
ShallowCopy.Copy(dto, employee); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-22T17:09:43.033

你的 DTO 是可序列化的吗？我希望如此，在这种情况下：

```
MemberInfo[] sm = FormatterServices.GetSerializableMembers(typeof(From));
object[] data = FormatterServices.GetObjectData(from, sm);
FormatterServices.PopulateObjectMembers(to, sm, data); 
```

但请注意，我并不真正同意这种一般方法。我希望签订一份强有力的合同，以便在每个 DTO 实施的 DTO 上进行复制。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-22T17:22:25.753

*   Change your type parameter names to comply with naming conventions, e.g. TFrom and TTo, or TSource and TDest (or TDestination).

*   Do most of your work in a generic type instead of in just a generic method. That allows you to cache the properties, as well as allowing type inference. Type inference is important on the "TFrom" parameter, as it will allow anonymous types to be used.

*   You could potentially make it blindingly fast by dynamically generating code to do the property copying and keeping it in a delegate which is valid for the "from" type. Or potentially generate it for every from/to pair, which would mean the actual copying wouldn't need to use reflection at all! (Preparing the code would be a one-time hit per pair of types, but hopefully you wouldn't have too many pairs.)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T17:07:17.377

在返回之前创建新实例`To`并调用该`Copy()`方法的新方法可能很有用。

像这样：

```
public static To Create<From, To>(From from)
    where To : class, new()
    where From : class
{
    var to = new To();
    Copy(from, to);
    return to;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-22T17:14:28.110

Decide what you want to do if passed objects of types that share some properties but not all. Check for the existence of the property in the `From` object in the `To` object before trying to set it's value. Do the "right thing" when you come to a property that doesn't exist. If all of the public properties need to be identical, then you will need to check if you've set all of them on the `To` object and handle the case where you haven't appropriately.

I'd also suggest that you may want to use attributes to decorate the properties that need to be copied and ignore others. This would allow you to go back and forth between the two different objects more easily and continue to maintain some public properties that are derived rather than stored on your business object.

# .net - 每个版本（1.0、1.1、2.0、3.0、3.5），.NET 框架中有多少类？

> ID：469984
> 
> 赞同：2
> 
> 时间：2009-01-22T17:05:21.887
> 
> 标签：.net, statistics

每个版本（1.0、1.1、2.0、3.0、3.5），.NET 框架中有多少类？

我正在寻找我要为我的硕士课程中的一门课做的演示文稿的信息。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-22T17:11:32.093

请参阅 Brad Abrams 的博客文章*[Number of Types in the .NET Framework](http://blogs.msdn.com/brada/archive/2008/03/17/number-of-types-in-the-net-framework.aspx)*。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-03-01T11:21:30.967

不要用like来回答，如果链接失败的人找不到答案，我会从博客中复制答案

有时我会被问到 .NET Framework 对开发人员来说有多大的表面积。您可能会猜到这是我们跟踪的内容。如您所见，在每个版本中，我们都添加了新功能，以便更轻松地构建 .NET 应用程序。.NET Framework 中的类型数量为 11,417！对 .NET Framework 4.0 中有多少种类型有任何猜测吗？

![在此处输入图像描述](https://i.stack.imgur.com/REKuI.png)

![在此处输入图像描述](https://i.stack.imgur.com/JwQZO.png)

![在此处输入图像描述](https://i.stack.imgur.com/E3uX2.png)

![在此处输入图像描述](https://i.stack.imgur.com/l8Oo6.png)

# ruby-on-rails - Rails：多个参数之前呢？

> ID：469991
> 
> 赞同：4
> 
> 时间：2009-01-22T17:08:25.640
> 
> 标签：ruby-on-rails, ruby, syntax

我有这个有效的语法（因为它几乎来自API）

```
 <% form_tag :action => "whatever" do -%>
    <div><%= submit_tag 'Save' %></div>
  <% end -%> 
```

而这个，它的工作原理

```
<%=  form_tag({:action => "whatever"}, {:method => "get"})%> 
```

现在我尝试将它们组合起来，猜测语法。“get”没有像我希望的那样被添加为表单方法。这应该怎么读？

```
 <% form_tag :action => "whatever",:method => "get"  do -%>
    <div><%= submit_tag 'Save' %></div>
  <% end -%> 
```

表单标签应为：

```
<form action="hello/whatever" method="get"/> 
```

不是

```
<form action="hello/whatever?method=get" /> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-22T17:10:51.643

```
<% form_tag({:action => 'whatever'}, :method => "get")  do -%>
      <div><%= submit_tag 'Save' %></div>
<% end -%> 
```

查看[API 文档](http://apidock.com/rails/ActionView/Helpers/FormTagHelper/form_tag)，问题是`:method`需要进入`options`散列和`:action`散列`url_for_options`，并且您需要额外的大括号，以便解释器知道它们是不同的散列。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-23T04:57:03.683

我想说做到这一点的最好方法是不使用匿名路由名称并使用命名路由。这样更好更清洁，例如

```
<% form_tag discussions_path, :method => 'get' do %>
  <div><%= submit_tag 'Save' %></div>
<% end %> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T17:20:58.580

你有没有尝试过

```
<% form_tag(:action => "whatever", :method => "get")  do -%>
    <div><%= submit_tag 'Save' %></div>
<% end -%> 
```

`ri form_tag`也给你例子。

# windbg - 如何使用 windbg 从挂起转储中找到句柄所有者？

> ID：469993
> 
> 赞同：8
> 
> 时间：2009-01-22T17:08:47.467
> 
> 标签：windbg, deadlock, handle

如何在windbg中找出哪个线程是我的事件句柄的所有者：

我在跑

```
!handle 00003aec f 
```

并得到

```
Handle 00003aec
  Type          Event
  Attributes    0
  GrantedAccess 0x1f0003:
     Delete,ReadControl,WriteDac,WriteOwner,Synch
     QueryState,ModifyState
  HandleCount   2
  PointerCount  4
  Name          <none>
  No object specific information available 
```

回来，因为没有名字我还没想出如何让所有者证明我的线程正在等待哪个线程

[编辑] 我必须处理转储，因为需要在用户机器上重新启动原始进程，因此无法调试实时会话

到目前为止我发现的关于这个主题的最佳讨论是在[这个博客上](http://www.codeproject.com/KB/debug/cdbntsd7.aspx)，但不幸的是我们最终使用了不同的锁定方法（我最终使用了 WaitForMultipleObjectsEx，描述是针对 WaitForSingleObject），而且他似乎可以访问实时进程

我的线程的堆栈跟踪（在某事上被阻塞并且我正在寻找当前所有者的线程）是：

```
0:045> k9
ChildEBP RetAddr 
1130e050 7c90e9ab ntdll!KiFastSystemCallRet
1130e054 7c8094e2 ntdll!ZwWaitForMultipleObjects+0xc
1130e0f0 79ed98fd kernel32!WaitForMultipleObjectsEx+0x12c
1130e158 79ed9889 mscorwks!WaitForMultipleObjectsEx_SO_TOLERANT+0x6f
1130e178 79ed9808 mscorwks!Thread::DoAppropriateAptStateWait+0x3c
1130e1fc 79ed96c4 mscorwks!Thread::DoAppropriateWaitWorker+0x13c
1130e24c 79ed9a62 mscorwks!Thread::DoAppropriateWait+0x40
1130e2a8 79e78944 mscorwks!CLREvent::WaitEx+0xf7
1130e2bc 7a162d84 mscorwks!CLREvent::Wait+0x17
1130e33c 7a02fd94 mscorwks!CRWLock::RWWaitForSingleObject+0x6d
1130e364 79ebd3af mscorwks!CRWLock::StaticAcquireWriterLock+0x12e
1130e410 00f24557 mscorwks!CRWLock::StaticAcquireWriterLockPublic+0xc9 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T00:23:35.350

查看调用堆栈，似乎有问题的堆栈正在使用 ReaderWriterLock 锁定机制。

```
1130e410 00f24557 mscorwks!CRWLock::StaticAcquireWriterLockPublic+0xc9 
```

切换到线程 9 并使用**sos.dll**运行**!dso**转储出托管的 ReaderWriterLock 对象。然后在 ReaderWriterLock 对象上运行 !do。我相信您可以查询一个拥有的线程字段。我会测试一下看看。

确定这一点的老派方法是运行**~*e !clrstack**并检查正在等待读写器锁的所有托管线程，然后查看是否可以找到进入相同函数但通过锁的线程（即不同的偏移量）

谢谢，亚伦

注意：不确定是否有链接帖子的方法，但这与
[如何在 Windbg 中找到我的 ReaderWriterLock 的锁持有者（阅读器）非常相似](https://stackoverflow.com/questions/316894/how-do-i-find-the-lockholder-reader-of-my-readerwriterlock-in-windbg)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-19T16:24:38.973

使用`!htrace`命令获取线程 ID。您必须首先（可能在程序开始时）使用`!htrace -enable`.

```
0:001> !htrace 00003aec
--------------------------------------
句柄 = 0x00003aec - 打开
线程 ID = *0x00000b48*，进程 ID = 0x000011e8

...

```

上面的输出是虚构的，对于您的系统会有所不同。但它会为您提供所需的信息——线程 ID（在我的示例中为 0x00000b48）。

> 我必须处理转储，因为需要在用户机器上重新启动原始进程，因此无法调试实时会话。

我不是 100% 确定，但我认为这会奏效：

1.  附加到进程并运行`!htrace -enable`
2.  与进程分离`qd`。可执行文件将继续。
3.  您现在可以获取转储文件并使用上述命令 - 我认为您将获得所描述的结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T17:43:48.207

您可以从内核转储中挖掘出来。

现在，就内核调试而言，来自 sysinternals 的 livekd 应该就足够了，但不幸的是，它只能在正在运行的系统上使用。

还有一个内核模式[内存获取工具](http://win32dd.msuiche.net)，可用于（代替windbg）进行转储以供以后检查。

否则，启用句柄跟踪（！htrace -enable）和（如果代码对特定线程唯一），可以从堆栈跟踪中得出句柄所有权。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-23T11:34:19.533

这是我找到的明确答案。从来没有试过自己。不过，您需要进行实时调试才能确定所有者。但这很快。 [http://weblogs.thinktecture.com/ingo/2006/08/who-is-blocking-that-mutex---fun-with-windbg-cdb-and-kd.html](http://weblogs.thinktecture.com/ingo/2006/08/who-is-blocking-that-mutex---fun-with-windbg-cdb-and-kd.html)***************