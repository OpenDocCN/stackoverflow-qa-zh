# StackOverflow 问答 000352000-000352999

# sharepoint - Really strange IE 8 Beta 2 behaviour

> ID：352001
> 
> 赞同：-1
> 
> 时间：2008-12-09T06:58:49.017
> 
> 标签：sharepoint, moss, internet-explorer-8

PLEASE DON'T CLOSE -- IT'S PROGRAMMING-RELATED (BUT NO CODE INCLUDED)

I develop MOSS sites, and I need to make sure my sites are compatible with IE 7,8 and FireFox.

I have an external testing site (Windows 2003, IIS 6) and when I browse to this MOSS site, I can authenticate without any problems using IE8\.

When I browse to my local installation of MOSS (Windows 2008 Server, IIS 7), I can't authenticate, instead it prompts for username+password, then 3 tries later a blank page comes up.

Any idea why this is? At the moment I can't test my MOSS installation locally using IE 8, because of this, and Microsoft don't provide support for beta products.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T07:01:55.843

You should try some network sniffing to see exactly what is happening over the wire. [WireShark](http://www.wireshark.org/) is pretty good.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T15:30:58.043

尝试使用[Fiddler](http://www.fiddlertool.com/fiddler/)查看 IIS 返回给您的状态代码。

# web-services - Server did not recognize the value of HTTP Header SOAP

> ID：352004
> 
> 赞同：1
> 
> 时间：2008-12-09T06:59:26.003
> 
> 标签：web-services, soap

Here you can find the WSDL for my Jobs.asmx webService. [http://recpushdata.cyndigo.com/jobs.asmx](http://recpushdata.cyndigo.com/jobs.asmx)

The Thing is I have created a HTML page at [http://bugmusic.cyndigo.com/CallWebService.html](http://bugmusic.cyndigo.com/CallWebService.html)

and its returning an Error Server did not recognize the value of HTTP Header SOAP.

I am not able to find the bug.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-09T07:10:44.593

add or remove the httppost, httpget protocols. like below:

in your Web.config

```
&lt;webServices&gt;<br>
&lt;protocols&gt;<br>
&lt;add name=&quot;HttpPost&quot;/&gt; <br>
&lt;add name=&quot;HttpGet&quot;/&gt; <br>
&lt;/protocols&gt;<br>
&lt;/webServices&gt;<br>

in your machine.config:<br>
&lt;system.web&gt;<br>
    ...<br>
    &lt;webServices&gt;<br>
        &lt;protocols&gt;<br>
              &lt;add name="HttpSoap"/&gt;<br>
              &lt;add name="HttpPost"/&gt;<br>
              &lt;add name="HttpGet"/&gt;<br>
              &lt;add name="Documentation"/&gt;<br>
              &lt;add name="HttpPostLocalhost"/&gt;<br>
        &lt;/protocols&gt;<br>
    &lt;/webServices&gt;<br>
    ...<br>
&lt;/system.web<br> 
```

# installation - ASP.NET Web Setup

> ID：352010
> 
> 赞同：1
> 
> 时间：2008-12-09T07:06:03.993
> 
> 标签：installation

I have 3 web projects in a Visual studio solution.I want to create a single web setup project which should install all 3 web projects in their virtual directories.So how to create a single web setup project which supports multiple web application installation?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T15:08:43.977

您可以通过创建一个 Web 设置项目来做到这一点。在文件系统中，根据需要添加任意数量的 Web 自定义文件夹。

只有主 Web 应用程序文件夹会有安装对话框，因此如果您想自定义虚拟目录名称，则需要添加一个屏幕并将 Web 自定义文件夹的属性设置为与屏幕上的字段名称相同添加。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T07:39:09.637

I never found the whole "web setup project" concept to work well. For starters, I've never managed a web server where the only site configuration was the default web site, so the "out of the box" functionality of defining a virtual directory to be created on the default site never worked for me, and it doesn't sound like it would be very useful to you either.

The best option I've found is to create a standard setup project that installs the output + content files of each web site into a \\Website path (or similar) and write a custom installer action with a supporting GUI that allows the installer (user) to select the proper web site and specify the name of the virtual directory to be used.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-20T08:12:16.297

正如 John Hunter 所说，可以在默认的 Web 应用程序文件夹旁边添加多个 Web 自定义文件夹。但是你需要知道一些关于事情如何叠加的细节。

需要注意的一件事是，`Property`您为附加文件夹设置的名称将是安装的物理路径。但是，这在您的设置逻辑中是只读的，因为它稍后会自动设置为 IIS 默认路径（通常为 ）的位置，并添加了在文件夹属性`C:\intepub\wwwroot\`中指定的值。`VirtualDirectory`因此，您需要在添加的自定义屏幕中设置的不是`Property`文件夹上定义的名称，而是用于虚拟目录的属性名称。这是`Property`您指定的名称附加“VDIR”。因此，如果您为 Web 文件夹指定的属性名称是“WEBSITE1”，那么虚拟文件夹的属性名称将是“WEBSITE1VDIR”。在您的自定义屏幕中，您需要将您使用的文本字段的属性名称设置为“WEBSITE1VDIR”，此文本框中的默认值将自动填充为您在文件夹中指定的默认 VirtualDirectory 值。

如果您选择删除默认`Installation Address`对话框，以便在与其他人相同的页面上的自定义文本框中同时指定主网站，您需要知道物理路径的属性名称（如您看到的灰色）固定为“ `Property`“Web 应用程序文件夹”的名称中的 TARGETDIR ”。但是，虚拟路径的属性不是“TARGETDIRVDIR”，如果它遵循与另一个相同的名称约定，则它是“TARGETVDIR”。
但是，如果您确实删除了默认`Installation Address`对话框，您将失去选择要使用的网站（通常是“默认网站”）和应用程序池的选项，该下拉菜单会显示可用的内容。

# telephony - IVRS Models

> ID：352025
> 
> 赞同：1
> 
> 时间：2008-12-09T07:26:33.657
> 
> 标签：telephony, ivr

IVR Systems are so expensive and proprietary.

The vendor systems I've used are all pretty weak... What is a good alternative to Genesys, Intervoice, etc.?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T07:31:42.617

[Asterisk](http://www.asterisk.org/) is open source and it includes the capability of defining and running IVR interactions.

They have proprietary hardware for interaction with the PSTN or you can build services on top of VoiceOverIP protocols such as SIP (i.e. IP only).

See the [Asterisk Gateway Interface](http://www.voip-info.org/wiki-Asterisk+AGI) wiki page - this describes the primitives you would use in the IVR script.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T19:04:46.607

我将 Asterisk 用于 IVR 实现。我不认为学习曲线太陡峭，特别是考虑到我并不真正进入电信领域，而且我使用它的效果非常好。我目前有一个带有 8 个 E1 链接（240 个通道）的 IVR，带有 Asterisk 和一个 Sangoma 卡，效果很好。而且测试新功能很容易，因为我可以在我的机器上运行它，只需要 VoIP，在 Asterisk 中设置 SIP 并使用 X-Lite 软电话。

[我在 Java 端使用 FastAGI 和JAGIServer](http://sf.net/projects/JAGIServer) / [OrderlyCalls](http://orderlycalls.sourceforge.net/)将 Asterisk 与我的 Java 应用程序连接起来。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-28T21:19:02.110

我会推荐 Katalina 'VoiceGuide' - 一个基于 Windows 的 CTI、IVR 和拨号系统，价格合理，支持传统的 POTS/ISDN 电话卡和 VoIP。见：www.voiceguide.com

# programming-languages - 您尝试使代码功能化的所有方式是什么？

> ID：352029
> 
> 赞同：0
> 
> 时间：2008-12-09T07:31:47.670
> 
> 标签：programming-languages, concurrency, functional-programming

以便您将来可以轻松地使您的程序并发。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T07:45:28.843

我专注于使项目不可变。不可变对象允许您比“线程安全”对象更容易地推理多线程代码。该对象具有一种可见状态，可以在线程之间传递而无需任何同步。它消除了多线程编程的思想。

如果你有兴趣，我已经发表了很多关于不可变对象的作品，特别是代码库上的不可变集合。该项目的名称是[RantPack](http://code.msdn.microsoft.com/RantPack)。在我的收藏区

*   不可变集合<T>
*   不可变映射<TKey,TValue>
*   不可变的AvlTree<T>
*   不可变的LinkedList<T>
*   不可变数组<T>
*   不可变堆栈<T>
*   不可变队列<T>

还有一个额外的填充层（CollectionUtility），它将生成实现 BCL 接口（例如 IList<T> 和 ICollection<T>）的包装器对象。它们不能完全实现接口，因为它们是不可变的，但所有可能的方法都已实现。

包含单元测试的源代码 (C#) 也可以在该站点上找到。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T07:47:58.387

我主要用Java编程。我正在耐心等待将关闭添加到语言中的那一天。但是由于我仍然停留在 Java 1.4.2 上，即使它们被添加，这对我来说也不会持续很长时间！

也就是说，我的主要“函数式”编程方式是大量使用“final”关键字。我尝试让尽可能多的类完全不可变，而其余的类则明确区分什么是瞬态的和什么是不可变的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T07:46:24.753

不要使用成员变量或全局变量。使用函数/方法的本地堆栈。当一个方法仅使用内部范围的变量和调用参数并使用 out/inout/reference 参数或返回值返回所有信息时，它是函数式的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T07:48:44.500

使一切异步。使用不可变对象、消息等。通过队列进行通信。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T18:44:46.253

这是关于 ruby​​conf 2008 的一个关于该主题的演讲，它主要以 ruby​​ 为中心，但有几个概念仍然有效。

[http://rubyconf2008.confreaks.com/better-ruby-through-functional-programming-2.html](http://rubyconf2008.confreaks.com/better-ruby-through-functional-programming-2.html)

# .net - Skipping a column in FileHelper

> ID：352030
> 
> 赞同：10
> 
> 时间：2008-12-09T07:32:48.933
> 
> 标签：.net, csv, filehelpers

Using the [FileHelper](http://www.filehelpers.net/) library for .Net, can I somehow skip a number of columns from the source file?

According to docs and samples, I have to add fields for all columns. Alas, I have an excel sheet with 216 columns to import, from which as few as 13 are necessary.

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-08-03T21:55:29.957

我也有同样的情况，还有疑问。在 filehelpers.net 的论坛中搜索，我发现了这个[线程](http://www.filehelpers.net/forums/viewtopic.php?t=394)（从 2007 年开始？！），马科斯本人做出了回应：

问题：

> 在分隔长度布局中，是否可以跳过某些字段？例如：
> ExternalSysId|ExportDate|FirstName|LastName
> 我只需要 FirstName 和 LastName，并且不想用“虚拟”字段混淆我的代码？

回复：

> 该库没有为此的内置功能。
> 
> 您可以将字段设为私有，库将读取这些值，但您不会从代码中看到它们 =) 如果将来您需要这些字段，您可以将它们公开

因此，使用记录类向导来减少所需的输入量，然后将不必要的字段设为私有，这似乎是目前最好的选择。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-08-03T13:32:27.433

您必须将字段添加为私有，并且还可以使用属性

[字段值丢弃](http://www.filehelpers.net/docs/html/T_FileHelpers_FieldValueDiscardedAttribute.htm)

避免库将读取的值存储在字段中

# math - 帮助！Math.PI 在 F# CTP 中去了哪里？

> ID：352032
> 
> 赞同：3
> 
> 时间：2008-12-09T07:35:38.957
> 
> 标签：math, f#

我只是想用 F# 编写简单的脚本，而 Math.PI 似乎已经“消失”了。我引用了 FSharp.PowerPack.dll，但还是找不到。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-09T07:43:59.270

常量 pi 是 System.Math.PI，如果你想使用，Math.PI 只需打开 System，在你的 fsharp 文件中：

```
open System
Math.PI 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T07:39:45.923

我不确定也不能现在测试它，但看看 Microsoft.FSharp.Math。

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2008-12-09T07:40:23.020

你知道，你可以这样做：

```
let PI = 3.141592653589 
```

# flash - Sites which support crossdomain.xml to allow Flash and Silverlight access

> ID：352039
> 
> 赞同：6
> 
> 时间：2008-12-09T07:40:11.227
> 
> 标签：flash, silverlight

Please list **one** site which allows Flash/Silverlight access via crossdomain.xml file. Vote for your favorite sites.

The goal is to build an up to date list of sites which can be directly accessed via Flash/Silverlight without a server-side proxy.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T07:49:01.410

The feeds a [http://www.feedburner.com](http://www.feedburner.com/fb/a/home) are accessable via the [CrossDomain](http://feeds.feedburner.com/crossdomain.xml) file. All rss feeds can be read with Silverlight.

(This may help the search a bit: [googlesearch](http://www.google.nl/search?hl=nl&q=filetype%3Axml+crossdomain))

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T08:21:36.493

Flickr 在这里有一个：

[http://api.flickr.com/crossdomain.xml](http://api.flickr.com/crossdomain.xml)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T15:08:44.633

[http://services.digg.com/crossdomain.xml](http://services.digg.com/crossdomain.xml)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T16:17:52.847

Photobucket.com：http://api.photobucket.com/crossdomain.xml [_](http://api.photobucket.com/crossdomain.xml)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-10T15:56:53.530

[http://flash-world.ru/crossdomain.xml](http://flash-world.ru/crossdomain.xml)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-09-08T21:50:41.043

通过使用浏览器的限制较少的安全模型而不是 Flash 的安全模型，Flash 可以被“入侵”以使用来自任何域的 Web 服务。

我在 ActionScript 3 中编写了一个，并通过回调将 JSON 传递给浏览器，将本机 JSON 对象返回给 Flash。不需要服务器代理或外部 javascript。

JSONP.as - [http://gist.github.com/1204728](http://gist.github.com/1204728)

在 ActionScript 调用中：

```
JSONP.get("http://api.twitter.com/statuses/user_timeline.json", 
        "{screen_name:'puppybits', count:'1'}", 
         function(data):void{ 
          trace('flash received cross-domain json:'+data)
        }); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T16:08:03.210

Amazon SimpleDB 目前不支持 crossdomain.xml 或 clientaccesspolicy.xml ......在我看来这是一个巨大的失败......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-10T02:16:18.227

Yahoo Pipes ( [http://pipes.yahoo.com/pipes/](http://pipes.yahoo.com/pipes/) ) 允许访问许多没有 crossdomain.xml 文件的页面和提要。它只会访问任何允许索引的页面（robots.txt）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-14T05:27:22.423

[http://johndyer.name/crossdomain.xml](http://johndyer.name/crossdomain.xml)已打开。

Jon，你如何使用 Silverlight 的 Yahoo Pipes，因为它的 crossdomain.xml 是限制性的？

# shell - 在 bourne shell 的用户定义函数中使用 getopts

> ID：352044
> 
> 赞同：4
> 
> 时间：2008-12-09T07:46:14.007
> 
> 标签：shell, sh, getopts

是否可以将命令行参数从 bourne 脚本中传递到函数中，以允许 getopts 处理它们。

我的脚本的其余部分很好地打包成函数，但看起来我必须将参数处理移动到主逻辑中。

下面是现在的写法，但是不行：

```
进程参数（）
{
  而 getopts j:f: arg
  做
  回声“${arg}——${OPTARG}”
     案例“${arg}”在
       j) 如果 [ -z "${filename}" ]; 然后
           工作编号=$OPTARG
           别的
              echo "文件名 ${filename} 已设置。"
              echo "作业号 ${OPTARG} 将被忽略。
           菲;;
       f) 如果 [ -z "${job_number}" ]; 然后
              文件名=$OPTARG
           别的
              echo "已设置工作编号 ${job_number}。"
              echo "文件名 ${OPTARG} 将被忽略。"
           菲;;
     经社理事会
  完毕
}

做东西1
过程参数
做东西2

```

是否有可能以可以读取脚本参数的方式定义函数？这可以通过其他方式完成吗？我喜欢 getopts 的功能，但看起来在这种情况下我将不得不牺牲代码的美感来获得它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T08:02:30.150

您可以在变量之后为 getopts 提供 args。默认值为 $@，但这也是 shell 函数用来表示*其*参数的。解决方案是将“$@”（将脚本的所有命令行参数表示为单独的字符串）传递给 processArgs：

```
processArgs "$@"

```

将其添加到您的脚本中（并修复第 11 行中的引用），并尝试一些乱码测试参数：

```
$ ./try -j asdf -f fooo -fasdfasdf -j424pyagnasd
j -- asdf
f--foo
作业号 asdf 已设置。
文件名 fooo 将被忽略。
f——asdfasdf
作业号 asdf 已设置。
文件名 asdfasdf 将被忽略。
j -- 424pyagnasd

```

# php - PHP simplexml：为什么 xpath 停止工作？

> ID：352052
> 
> 赞同：12
> 
> 时间：2008-12-09T07:51:29.737
> 
> 标签：php, xml, xpath, simplexml

在供应商稍微更改了 XML 标头后，发生了一件奇怪的事情。我以前可以使用 xpath 读取内容，但现在我什至无法得到回复

```
$xml->xpath('/'); 
```

他们从这里改变了它......

```
<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE NewsML SYSTEM "http://www.newsml.org/dl.php?fn=NewsML/1.2/specification/NewsML_1.2.dtd" [
<!ENTITY % nitf SYSTEM "http://www.nitf.org/IPTC/NITF/3.4/specification/dtd/nitf-3-4.dtd">
%nitf;
]>
<NewsML>
... 
```

对此：

```
<?xml version="1.0" encoding="iso-8859-1"?>
<NewsML
  xmlns="http://iptc.org/std/NewsML/2003-10-10/"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://iptc.org/std/NewsML/2003-10-10/ http://www.iptc.org/std/NewsML/1.2/specification/NewsML_1.2.xsd http://iptc.org/std/NITF/2006-10-18/   http://contentdienst.pressetext.com/misc/nitf-3-4.xsd"
>
... 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-09T08:27:28.337

这很可能是因为他们在`xmlns="http://iptc.org/std/NewsML/2003-10-10/"`文档中引入了默认命名空间 ( )。委婉地说，SimpleXML 对默认名称空间的支持不是很好。

您可以尝试显式注册名称空间前缀吗：

```
$xml->registerXPathNamespace("n", "http://iptc.org/std/NewsML/2003-10-10/");
$xml->xpath('/n:NewsML'); 
```

您必须调整 XPath 表达式以在*每个*元素上使用`"n:"`前缀。这是一些附加信息： http: [//people.ischool.berkeley.edu/~felix/xml/php-and-xmlns.html](http://web.archive.org/web/20090414184326/http://people.ischool.berkeley.edu/~felix/xml/php-and-xmlns.html)。

 *编辑：根据[规范](http://php.net/manual/function.simplexml-element-registerXPathNamespace.php)：

> [该`registerXPathNamespace()`函数](http://php.net/manual/function.simplexml-element-registerXPathNamespace.php)为下一个 XPath 查询创建一个前缀/ns 上下文。

这意味着必须在每个 XPath 查询之前调用它，因此包装 XPath 查询的函数将是很自然的事情：

```
function simplexml_xpath_ns($element, $xpath, $xmlns)
{
    foreach ($xmlns as $prefix_uri)
    {
        list($prefix, $uri) = explode("=", $prefix_uri, 2);
        $element->registerXPathNamespace($prefix, $uri);
    }
    return $element->xpath($xpath);
} 
```

用法：

```
$xmlns = ["n=http://iptc.org/std/NewsML/2003-10-10/"];
$result = simplexml_xpath_ns($xml, '/n:NewsML', $xmlns); 
```

# c - 在 C 中去除前导和尾随空格的最佳算法

> ID：352055
> 
> 赞同：8
> 
> 时间：2008-12-09T07:51:33.560
> 
> 标签：c, string, trim

在 C 中去除前导和尾随空格的最佳方法是什么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-09T08:27:30.663

以下是 linux 内核如何进行修剪，称为 strstrip()：

```
char *strstrip(char *s)
{
    size_t size;
    char *end;

    size = strlen(s);

    if (!size)
        return s;

    end = s + size - 1;
    while (end >= s && isspace(*end))
        end--;
    *(end + 1) = '\0';

    while (*s && isspace(*s))
        s++;

    return s;
} 
```

它基本上是前张海报所说的格式更好且经过错误检查的版本。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-09T08:03:24.173

这个问题看起来好像是一个家庭作业问题，所以我会斜着回答：查找 isspace(3) 和 strlen(3) 的手册页并使用指针算法。此外，根据手头的问题，您可能需要 malloc(3) 为结果保留空间。

不要忘记 C 字符串的表示包括一个尾随 0 字节，通常写为 '\0'，它不计入字符串长度的一部分。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-09T08:52:53.747

这是使用 isspace 的版本：

```
char * trim(char *c) {
    char * e = c + strlen(c) - 1;
    while(*c && isspace(*c)) c++;
    while(e > c && isspace(*e)) *e-- = '\0';
    return c;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-09T08:32:46.097

您可以完全就地执行此操作。

```
 void stripLeadingAndTrailingSpaces(char* string){

     assert(string);

     /* First remove leading spaces */

     const char* firstNonSpace = string;

     while(*firstNonSpace != '\0' && isspace(*firstNonSpace))
     {
          ++firstNonSpace;
     }

     size_t len = strlen(firstNonSpace)+1;         

     memmove(string, firstNonSpace, len);

     /* Now remove trailing spaces */

     char* endOfString = string + len;

     while(string < endOfString  && isspace(*endOfString))
     {
          --endOfString ;
     }

     *endOfString = '\0';

} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-09T09:19:24.817

```
char *strstrip(char *s)
{
    char *end;

    while ( (*s) && isspace( *s))
        s++;

    if(!( *s) )
        return s;
    end = s;

    while( ! *end)
        end++;
    end--;

    while (end ! = s && isspace( *end))
        end--;
    *(end + 1) = '\0';

    return s;
} 
```

它基本上是一个更优化的代码（在速度和代码大小方面）。

如果我们需要保留内存空间，

```
void strstrip(char *s)
{
    char *start;
    char *end;

    start = s; 
    while ( (*start) && isspace( *start))
        start++;

    if(!( *start) ) 
    {
        *s='\0';
        return ;
    }
    end = start;

    while( ! *end)
        end++;
    end--;

    while (end ! = start && isspace( *end))
        end--;
    *(end + 1) = '\0';

    memmove(s, start, end-start+1);

    return;
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-05T09:52:36.390

这是 lakshmanaraj 的第一个函数的更简洁和更安全的版本：

```
#include <ctype.h>
char *mytrim(char *s)
{
    if(s) { /* Don't forget to check for NULL! */
        while(*s && isspace(*s))
            ++s;
        if(*s) {
            register char *p = s;
            while(*p)
                ++p;
            do {
                --p;
            } while((p != s) && isspace(*p));
            *(p + 1) = '\0';
        }
    }
    return(s);
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-01-06T03:20:27.397

对上面另一篇文章的改进。

```
void  strstrip( char *s )
{
  char *start;
  char *end;

  // Exit if param is NULL pointer
  if (s == NULL)
    return;

  // Skip over leading whitespace
  start = s;
  while ((*start) && isspace(*start))
    start++;      

  // Is string just whitespace?
  if (!(*start)) 
  {         
    *s = 0x00; // Truncate entire string
    return;     
  }     

  // Find end of string
  end = start;
  while (*end)         
    end++;     

  // Step back from NUL
  end--;      

  // Step backward until first non-whitespace
  while ((end != start) && isspace(*end))         
    end--;     

  // Chop off trailing whitespace
  *(end + 1) = 0x00;

  // If had leading whitespace, then move entire string back to beginning
  if (s != start)
    memmove(s, start, end-start+1);      

  return; 
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-06-26T00:10:34.073

对于那些希望看到递归解决方案的人，我提供：

```
static char* trim_left_ptr(char* str)
{
    if (*str == 0)
    {
        // no more in string. It is an empty string
        return str;
    }

    if (*str == ' ' || *str == '\t')
    {
        // it is space or tab. Try next.
        return trim_left_ptr(str + 1);
    }

    // found left side of string
    return str;
}

static char* trim_right_ptr(char* str)
{
    if (*str == 0)
    {
        // found end of string
        return str;
    }

    // try next (recursion)
    char* ptr = trim_right_ptr( str + 1 );

    // on the return from recursion.
    // ptr == str until a nonspace/nontab is found.
    if (*(ptr - 1) == ' ' || *(ptr - 1) == '\t')
    {
        // is space or tab. Have not yet found right side
        return ptr - 1;
    }

    // found right side of string
    return ptr;
}

char* trim(char* str)
{
    char* L_Ptr = trim_left_ptr(str);
    char* R_Ptr = trim_right_ptr(str);

    // calculate characters to store in new buffer
    _int32 sz = R_Ptr - L_Ptr;

    // allocate buffer
    char* newstr = (char*) malloc(sz + 1);

    // copy trimmed string
    memcpy(newstr, L_Ptr, sz);

    // terminate string
    *(newstr + sz) = 0;

    return newstr;
} 
```

当然，它不是唯一可能的递归解决方案。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-08-10T17:41:17.880

为已经拥挤的领域添加另一个答案，但是……我相信有充分的理由。具体来说，[AlfaZulu](https://stackoverflow.com/users/44060/alfazulu)的（当前接受的）[答案](https://stackoverflow.com/a/352119)既没有去除尾随空白，也没有正确尊重数组的边界。 当源字符串为空字符串时，[Valgrind会报告越界读取和写入。](http://valgrind.org/)

`stripLeadingAndTrailingSpaces()`这是来自 AlfaZulu 逐字回答的函数的示例代码（包括尾随空格）——只是`static`在它之前添加了符合我的偏见。（我使用编译器选项来阻止代码编译，除非函数有原型或者函数是静态的）。还有一个函数`str_strip()`是 AlfaZulu 函数的固定版本。测试工具使这两个功能发挥作用。该代码假定了一个足够类似于 POSIX 的环境，因此`strdup()`可用于分配字符串的副本。

请注意，该名称`str_strip()`避免与标准 C 库的保留名称冲突：

> ### 7.31.13 字符串处理`<string.h>`
> 
> `str`1 以、`mem`或和小写字母开头的函数名称`wcs`可以添加到`<string.h>`标头中的声明中。

```
#include <assert.h>
#include <stdlib.h>
#include <ctype.h>
#include <stdio.h>
#include <string.h>

/* Code verbatim from answer by AlfaZulu (except for static) — which has problems */
static
void stripLeadingAndTrailingSpaces(char* string){

     assert(string);

     /* First remove leading spaces */

     const char* firstNonSpace = string;

     while(*firstNonSpace != '\0' && isspace(*firstNonSpace))
     {
          ++firstNonSpace;
     }

     size_t len = strlen(firstNonSpace)+1;

     memmove(string, firstNonSpace, len);

     /* Now remove trailing spaces */

     char* endOfString = string + len;

     while(string < endOfString  && isspace(*endOfString))
     {
          --endOfString ;
     }

     *endOfString = '\0';

}

static void str_strip(char *string)
{
    assert(string);
    //printf("-->> %s(): [%s]\n", __func__, string);

    /* First remove leading spaces */
    const char *firstNonSpace = string;

    while (isspace((unsigned char)*firstNonSpace))
        ++firstNonSpace;
    //printf("---- %s(): [%s]\n", __func__, firstNonSpace);

    size_t len = strlen(firstNonSpace) + 1;
    memmove(string, firstNonSpace, len);
    //printf("---- %s(): [%s]\n", __func__, string);

    /* Now remove trailing spaces */
    char *endOfString = string + len - 1;
    //printf("---- %s(): EOS [%s]\n", __func__, endOfString);

    while (string < endOfString && isspace((unsigned char)endOfString[-1]))
        --endOfString;
    *endOfString = '\0';
    //printf("<<-- %s(): [%s]\n", __func__, string);
}

static void chk_stripper(const char *str)
{
    char *copy1 = strdup(str);
    printf("V1 Before: [%s]\n", copy1);
    stripLeadingAndTrailingSpaces(copy1);
    printf("V1 After:  [%s]\n", copy1);
    free(copy1);
    fflush(stdout);

    char *copy2 = strdup(str);
    printf("V2 Before: [%s]\n", copy2);
    str_strip(copy2);
    printf("V2 After:  [%s]\n", copy2);
    free(copy2);
    fflush(stdout);
}

int main(void)
{
    char *str[] =
    {
        "    \t    ABC   DEF    \t  ",
        "    \t                 \t  ",
        " ",
        "",
    };
    enum { NUM_STR = sizeof(str) / sizeof(str[0]) };
    for (int i = 0; i < NUM_STR; i++)
        chk_stripper(str[i]);
    return 0;
} 
```

在 Valgrind 下运行时，我得到输出：

```
$ valgrind --suppressions=etc/suppressions-macos-10.12.5 -- ./slts59
==26999== Memcheck, a memory error detector
==26999== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==26999== Using Valgrind-3.13.0.SVN and LibVEX; rerun with -h for copyright info
==26999== Command: ./slts59
==26999== 
V1 Before: [            ABC   DEF         ]
V1 After:  [ABC   DEF         ]
V2 Before: [            ABC   DEF         ]
V2 After:  [ABC   DEF]
V1 Before: [                              ]
V1 After:  []
V2 Before: [                              ]
V2 After:  []
V1 Before: [ ]
V1 After:  []
V2 Before: [ ]
V2 After:  []
==26999== Invalid read of size 1
==26999==    at 0x100000B81: stripLeadingAndTrailingSpaces (slts59.c:28)
==26999==    by 0x100000CB0: chk_stripper (slts59.c:67)
==26999==    by 0x100000DA2: main (slts59.c:91)
==26999==  Address 0x100b7df01 is 0 bytes after a block of size 1 alloc'd
==26999==    at 0x100096861: malloc (vg_replace_malloc.c:302)
==26999==    by 0x1002DC938: strdup (in /usr/lib/system/libsystem_c.dylib)
==26999==    by 0x100000C88: chk_stripper (slts59.c:65)
==26999==    by 0x100000DA2: main (slts59.c:91)
==26999== 
==26999== Invalid write of size 1
==26999==    at 0x100000B96: stripLeadingAndTrailingSpaces (slts59.c:33)
==26999==    by 0x100000CB0: chk_stripper (slts59.c:67)
==26999==    by 0x100000DA2: main (slts59.c:91)
==26999==  Address 0x100b7df01 is 0 bytes after a block of size 1 alloc'd
==26999==    at 0x100096861: malloc (vg_replace_malloc.c:302)
==26999==    by 0x1002DC938: strdup (in /usr/lib/system/libsystem_c.dylib)
==26999==    by 0x100000C88: chk_stripper (slts59.c:65)
==26999==    by 0x100000DA2: main (slts59.c:91)
==26999== 
V1 Before: []
V1 After:  []
V2 Before: []
V2 After:  []
==26999== 
==26999== HEAP SUMMARY:
==26999==     in use at exit: 34,572 bytes in 162 blocks
==26999==   total heap usage: 186 allocs, 24 frees, 40,826 bytes allocated
==26999== 
==26999== LEAK SUMMARY:
==26999==    definitely lost: 0 bytes in 0 blocks
==26999==    indirectly lost: 0 bytes in 0 blocks
==26999==      possibly lost: 0 bytes in 0 blocks
==26999==    still reachable: 0 bytes in 0 blocks
==26999==         suppressed: 34,572 bytes in 162 blocks
==26999== 
==26999== For counts of detected and suppressed errors, rerun with: -v
==26999== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 2 from 2)
$ 
```

显示的`str_strip()`功能正常工作。它具有或多或少的最小更改集，`stripLeadingAndTrailingSpaces()`以干净地工作（加上注释掉在检查过程中使用的调试代码——现在可以去）。

我观察到虽然语义略有不同，但[Tuminoid](https://stackoverflow.com/users/40657/tuminoid)的[答案](https://stackoverflow.com/a/352109/15168)`strstrip()`中基于 Linux 的函数也很干净——没有内存访问错误，并且它删除了尾随空格（不移动第一个和最后一个非空格之间的字符串部分人物）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-09T08:04:30.537

```
int i = strlen(s) - 1;
while (isspace(s[i]))
    s[i--] = '\0';
while (isspace(*s))
    s++; 
```

只要您不关心疯狂地破坏字符串并且不关心内存泄漏，那应该可以解决问题！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-09T08:10:00.667

您应该能够就地完成；剥离空格永远不会导致字符串增长。您可能无需先检查字符串的长度就可以做到这一点，但这样做可能是不必要的“聪明”。`memmove()`除了@Norman Ramsey 提到的功能之外，您还应该研究该功能。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-05T06:08:33.457

如果您在 Linux/Windows 上并且将库 glib 链接到您的程序中，则可以使用例程[`g_strstrip()`](http://library.gnome.org/devel/glib/2.16/glib-String-Utility-Functions.html#g-strstrip).

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-01-17T19:26:43.000

```
char *strip(char *string)
{
    char *start = string;
    while(isblank(*start)) start++;
    int end = strlen(start);
    if(start != string) {
        memmove(string, start, end);
        string[end] = '\0';
    }
    while(isblank(*(string+end-1))) end--;
    string[end] = '\0';
    return string;
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-04-22T23:22:55.790

来自 fpsgamer 的更正算法（也适用于 ISO C90）：

```
void trimWhitespace(char *string) {
    const char* firstNonSpace = string;
    char* endOfString;
    size_t len;

    if (string[0] == '\0') {
        return;
    }

    /* First remove leading spaces */
    while(*firstNonSpace != '\0' && isspace(*firstNonSpace)) {
        ++firstNonSpace;
    }
    len = strlen(firstNonSpace) + 1;
    memmove(string, firstNonSpace, len);

    /* Now remove trailing spaces */
    endOfString = string + len;

    while(string < endOfString && (isspace(*endOfString) || *endOfString == '\0')) {
        --endOfString ;
    }

    *(endOfString + 1) = '\0';
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-10-16T20:27:49.887

对于尾随空格，请使用 strtok。设置分隔符 = "" 并在运行时丢弃分隔符字节并将 char * 返回给令牌

```
char *x;
char *y = "somestring "; 

x = strtok(y," "); 
```

结果 x = 指向“somestring”而不是“somestring”的指针

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-02-25T02:05:15.373

编辑：根据最新版本的[zString 库](https://github.com/fnoyanisi/zString)更新了代码。

这段代码不依赖库，只依赖指针算术和整数。共有三个功能：修剪，左修剪和右修剪。（我应该将所有这些函数添加到[zString 库](https://github.com/fnoyanisi/zString)中:)）

*   `char *zstring_trim(char *s)`删除前导和尾随空格

*   `char *zstring_ltrim(char *s)`删除前导空格

*   `char *zstring_ltrim(char *s)`删除尾随空格

所有这些函数都会修改原始字符串

```
/* trim */
char *zstring_trim(char *str){
    char *src=str;  /* save the original pointer */
    char *dst=str;  /* result */
    char c;
    int is_space=0;
    int in_word=0;  /* word boundary logical check */
    int index=0;    /* index of the last non-space char*/

    /* validate input */
    if (!str)
        return str;

    while ((c=*src)){
        is_space=0;

        if (c=='\t' || c=='\v' || c=='\f' || c=='\n' || c=='\r' || c==' ')
            is_space=1;

        if(is_space == 0){
         /* Found a word */
            in_word = 1;
            *dst++ = *src++;  /* make the assignment first
                               * then increment
                               */
        } else if (is_space==1 && in_word==0) {
         /* Already going through a series of white-spaces */
            in_word=0;
            ++src;
        } else if (is_space==1 && in_word==1) {
         /* End of a word, dont mind copy white spaces here */
            in_word=0;
            *dst++ = *src++;
            index = (dst-str)-1; /* location of the last char */
        }
    }

    /* terminate the string */
    *(str+index)='\0';

    return str;
}

/* right trim */
char *zstring_rtrim(char *str){
    char *src=str;  /* save the original pointer */
    char *dst=str;  /* result */
    char c;
    int is_space=0;
    int index=0;    /* index of the last non-space char */

    /* validate input */
    if (!str)
        return str;

    /* copy the string */
    while(*src){
        *dst++ = *src++;
        c = *src;

        if (c=='\t' || c=='\v' || c=='\f' || c=='\n' || c=='\r' || c==' ')
            is_space=1;
        else
            is_space=0;

        if (is_space==0 && *src)
            index = (src-str)+1;
    }

    /* terminate the string */
    *(str+index)='\0';

    return str;
}

/* left trim */
char *zstring_ltrim(char *str){
    char *src=str;  /* save the original pointer */
    char *dst=str;  /* result */
    char c;
    int index=0;    /* index of the first non-space char */

    /* validate input */
    if (!str)
        return str;

    /* skip leading white-spaces */
    while((c=*src)){ 
        if (c=='\t' || c=='\v' || c=='\f' || c=='\n' || c=='\r' || c==' '){
            ++src;
            ++index;
        } else
            break;
    }

    /* copy rest of the string */
    while(*src)
        *dst++ = *src++;

    /* terminate the string */
    *(src-index)='\0';

    return str;
} 
```

# database - 如何最好地匹配两个字符串？

> ID：352059
> 
> 赞同：3
> 
> 时间：2008-12-09T07:55:23.520
> 
> 标签：database, algorithm, string, matching

你知道有什么好的算法可以匹配两个字符串，然后返回这两个字符串匹配的百分比吗？

还有一些也可以与数据库一起使用吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-09T08:05:59.303

列文[斯坦距离](http://en.wikipedia.org/wiki/Levenshtein_distance)就是这样一种度量。它基本上告诉您从第一个字符串到第二个字符串需要编辑、删除或添加多少个字符。我不确定某些数据库系统是否支持这一点。

但我确信在某些数据库系统中支持一种更简化的算法，称为[Soundex 。](http://en.wikipedia.org/wiki/Soundex)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T14:25:00.753

这取决于您的相似性标准。其他人已经向您推荐了 Levenstein 距离（编辑距离是一回事）。这通常非常好，而且肯定比 soundex 之类的更独立于语言。但是，请注意 Levenstein 差异不能很好地处理转置。因此：

```
Levenstein("copy", "cpoy") == 2 
```

如果您尝试处理人工输入，则换位相当普遍。这是否是一个问题取决于您的相似性指标。

已经有一段时间了，但我相信 Postgresql`levenstein()`要么是内置的，要么可以作为`contrib`C 模块使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T08:06:04.887

我认为您正在寻找的问题称为[Edit Distance](http://en.wikipedia.org/wiki/Edit_distance)。一般来说，计算成本很高，但如果您正在寻找其他字符串的编辑距离较小的字符串，那还不错。维基百科文章中有更多信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-17T16:17:29.330

如何最好地匹配两个字符串？让他们出去喝咖啡，如果他们一拍即合，就吃晚饭和看电影。或者也许他们可以做一些对等编程？这取决于弦，真的。即使是咖啡也常常很棘手。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T08:07:41.577

这会有帮助吗？我刚碰到它。[比较两个字符串产生一个数字增量](https://stackoverflow.com/questions/188476/comparing-two-strings-producing-a-numeric-delta)

# c++ - Finding the type of an unknown object in C++

> ID：352066
> 
> 赞同：4
> 
> 时间：2008-12-09T08:01:28.267
> 
> 标签：c++, memory-leaks, rtti

There are many ways to check programs for memory leaks. You end up with that list of pointers to leaked memory blocks, but is there a good way to find out more information for each block? For example: if I know that the object was a string, the actual string value could make finding the leak a lot easier.

Is there a backdoor into RTTI that makes that possible?

Problems to solve would be that by the time you get the pointers the runtime system is already in a state of shutdown and you get raw memory block pointers instead of pointers to objects (though in many cases that might be the same).

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-09T08:15:48.643

RTTI 可能对您没有帮助。RTTI 仅在类具有虚拟方法时才有效，并且并非所有分配都是具有虚拟方法的对象。

您真正需要做的是有一些方法将堆栈跟踪附加到您的分配中。然后，您可以获得有关内存分配位置的信息。如果是泄漏内存的对象，您将寻找一个类构造函数。

无论如何，那里有这样的东西吗？是的。一个免费的 Windows 库是[Visual Leak Detector](http://www.codeproject.com/KB/applications/visualleakdetector.aspx)。有更多功能齐全的商业产品（如 Bounds Checker 和 IBM 的 Rational Purify），但 VLD 效果很好。它无数次帮助我发现内存泄漏。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-09T08:17:58.047

我使用 valgrind --leak-check=full，它会给我每个泄漏块**的分配站点的堆栈跟踪。**这些信息比类型信息更有用 *。*[valgrind](http://valgrind.org/)（发音像“Val grinned”）*摇滚*！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T12:27:08.213

像诺曼一样，我提倡**valgrind**。这对于分析堆栈跟踪确实是一个很好的建议！

我在 KDevelop 中使用它。

# python - 用于映射一系列语句的大多数 Pythonic 形式？

> ID：352076
> 
> 赞同：0
> 
> 时间：2008-12-09T08:06:41.187
> 
> 标签：python, coding-style, idioms

这是困扰我一段时间的事情。我在学习 Python 之前学习了 Haskell，所以我一直喜欢将许多计算视为列表的映射。列表理解很好地表达了这一点（我在这里给出了pythonic版本）：

```
result = [ f(x) for x in list ] 
```

但在许多情况下，我们希望在 x 上执行多个语句，例如：

```
result = [ f(g(h(x))) for x in list ] 
```

这很快就会变得笨重，难以阅读。

我对此的正常解决方案是将其扩展回 for 循环：

```
result = []
for x in list:
  x0 = h(x)
  x1 = g(x0)
  x2 = f(x1)
  result.append(x2) 
```

关于这一点让我无休止的一件事是必须初始化空列表“结果”。这是一件小事，但它让我不开心。我想知道是否有任何替代的等效形式。一种方法可能是使用本地函数（这就是它们在 Python 中的调用方式吗？）

```
def operation(x):
  x0 = h(x)
  x1 = g(x0)
  x2 = f(x1)
  return x2
result = [ operation(x) for x in list ] 
```

上述两种形式中的任何一种都有什么特别的优点/缺点吗？还是有更优雅的方式？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T15:11:15.917

您可以轻松地在 Python 中进行函数组合。

这里演示了一种创建新函数的方法，该函数是现有函数的组合。

```
>>> def comp( a, b ):
    def compose( args ):
        return a( b( args ) )
    return compose

>>> def times2(x): return x*2

>>> def plus1(x): return x+1

>>> comp( times2, plus1 )(32)
66 
```

[这是一个更完整的函数组合](http://code.activestate.com/recipes/52902/)配方。这应该使它看起来不那么笨重。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T09:25:04.947

遵循最符合您口味的风格。
我不会担心性能；只有当你真的看到一些问题时，你才能尝试转向不同的风格。

除了您的建议之外，这里还有一些其他可能的建议：

```
result = [f(
              g(
                h(x)
                )
              )
            for x in list] 
```

使用渐进式列表推导：

```
result = [h(x) for x in list]
result = [g(x) for x in result]
result = [f(x) for x in result] 
```

同样，这只是风格和品味的问题。选择你最喜欢的那个，然后坚持下去:-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T15:35:13.887

如果这是你经常做的事情，并且有几个不同的陈述，你可以写类似的东西

```
def seriesoffncs(fncs,x):
    for f in fncs[::-1]:
        x=f(x)
    return x 
```

其中 fncs 是函数列表。所以 seriesoffncs((f,g,h),x) 将返回 f(g(h(x)))。这样，如果您稍后在代码中需要锻炼 h(q(g(f(x)))) 您只需执行 seriesoffncs((h,q,g,f),x) 而不是为每个功能组合。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T08:34:29.090

如果您只关心最后的结果，那么您的最后一个答案是最好的。任何看到它的人都清楚你在做什么。

我经常将任何开始变得复杂的代码移到一个函数中。这基本上用作该代码块的注释。（无论如何，任何复杂的代码都可能需要重新编写，并将其放入一个函数中，我可以稍后再回去处理）

```
def operation(x):
  x0 = h(x)
  x1 = g(x0)
  x2 = f(x1)
  return x2
result = [ operation(x) for x in list] 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T18:20:06.177

[dagw.myopenid.com](https://stackoverflow.com/questions/352076/most-pythonic-form-for-mapping-a-series-of-statements#353147)功能的变体：

```
def chained_apply(*args):
    val = args[-1]
    for f in fncs[:-1:-1]:
        val=f(val)
    return val 
```

而不是 seriesoffncs((h,q,g,f),x) 现在您可以调用：

```
result = chained_apply(foo, bar, baz, x) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-02T14:41:29.913

据我所知，Python 中没有用于组合的内置/本机语法，但是您可以编写自己的函数来组合内容而不会太麻烦。

```
def compose(*f):
    return f[0] if len(f) == 1 else lambda *args: f[0](compose(*f[1:])(*args))

def f(x): 
    return 'o ' + str(x)

def g(x): 
    return 'hai ' + str(x)

def h(x, y): 
    return 'there ' + str(x) + str(y) + '\n'

action = compose(f, g, h)
print [action("Test ", item) for item in [1, 2, 3]] 
```

当然，不需要在理解之外进行写作。

```
print [compose(f, g, h)("Test ", item) for item in [1, 2, 3]] 
```

这种组合方式适用于任何数量的函数（嗯，直到递归限制），内部函数具有任意数量的参数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-09T08:26:04.160

在某些情况下，最好回到 for 循环，是的，但更多时候我更喜欢以下方法之一：

使用适当的换行符和缩进来保持可读性：

```
result = [blah(blah(blah(x)))
          for x in list] 
```

正如您所提到的，或者将（足够的）逻辑提取到另一个函数中。但不一定是本地的；如果你能找到一种合理的方式来分解功能，Python 程序员更喜欢平面结构而不是嵌套结构。

我也是从函数式编程世界来到 Python 的，并且和你一样有偏见。

# python - 如何在 Appengine 的 webapp 框架中添加中间件？

> ID：352079
> 
> 赞同：3
> 
> 时间：2008-12-09T08:09:07.550
> 
> 标签：python, django, google-app-engine, middleware, django-middleware

我正在使用 appengine webapp 框架（[链接](http://code.google.com/appengine/docs/webapp/)）。是否可以添加 Django 中间件？我找不到任何例子。我目前正在尝试让 FirePython 中间件工作（[链接](http://github.com/woid/firepython/tree/master)）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-14T12:49:37.677

这很简单：您按照正常方式创建 WSGI 应用程序，然后在执行之前将该应用程序包装在您的 WSGI 中间件中。

请参阅Bloog 中的[此代码](http://github.com/Arachnid/bloog/blob/bb777426376d298765d5dee5b88f53964cc6b5f3/main.py#L71)，了解如何将 firepython 添加为中间件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T21:04:44.230

GAE webapp 框架不会一对一地映射到 Django 框架。如果不自己实现某种适配器，就很难做你想做的事，我不知道有任何第三方处理程序适配器可以做到这一点。

也就是说，我通常使用 app-engine-patch，因此我可以将最新的 1.0.2 Django 版本与 AppEngine 一起使用，然后您可以将 Django 中间件以正常方式包含在 setup.py 文件中。如果需要，您可能可以查看 app-engine-patch 的适配器以了解它们是如何做到的，然后将其作为框架开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-14T10:04:13.317

Django 理解的“中间件”是一种请求/响应处理器，与 WSGI 所说的“中间件”完全不同。想一想：类 django 的中间件会`session`根据 Beaker（WSGI 中间件）放入的内容为请求对象添加属性`environ['beaker.session']`。虽然将 WSGI 中间件添加到堆栈应该很简单（您已经在 WSGI 级别上工作`main.py`），但添加请求/响应处理器取决于如何从 WSGI 抽象请求和响应。

[Werkzeug 的 wiki](http://dev.pocoo.org/projects/werkzeug/wiki/RequestResponseProcessor)及其[contrib 模块](http://dev.pocoo.org/projects/werkzeug/browser/werkzeug/contrib/kickstart.py#L89)之一中描述了如何使用[Werkzeug](http://werkzeug.pocoo.org/)（这是基本的 WSGI 工具集）来完成此操作。

# c# - 为什么我不能在 C# 中定义一点？

> ID：352089
> 
> 赞同：9
> 
> 时间：2008-12-09T08:16:47.143
> 
> 标签：c#, c#-7.0

为什么 C# 中没有位结构？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2014-09-05T10:55:35.077

值得一提的是，这里有一个成熟的位结构，包含强制转换`int`和`bool`算术运算。可能不完美，但对我来说很好。享受！

```
/// <summary>
/// Represents a single bit that can be implicitly cast to/from and compared
/// with booleans and integers.
/// </summary>
/// <remarks>
/// <para>
/// An instance with a value of one is equal to any non-zero integer and is true,
/// an instance with a value of zero is equal to the integer zero and is false.
/// </para>
/// <para>
/// Arithmetic and logical AND, OR and NOT, as well as arithmetic XOR, are supported.
/// </para>
/// </remarks>
public struct Bit
{
    /// <summary>
    /// Creates a new instance with the specified value.
    /// </summary>
    /// <param name="value"></param>
    public Bit(int value) : this()
    {
        Value = value == 0 ? 0 : 1;
    }

    /// <summary>
    /// Gets the value of the bit, 0 or 1.
    /// </summary>
    public int Value { get; private set; }

    #region Implicit conversions

    public static implicit operator Bit(int value)
    {
        return new Bit(value);
    }

    public static implicit operator int(Bit value)
    {
        return value.Value;
    }

    public static implicit operator bool(Bit value)
    {
        return value.Value == 1;
    }

    public static implicit operator Bit(bool value)
    {
        return new Bit(value ? 1 : 0);
    }

    #endregion

    #region Arithmetic operators

    public static Bit operator |(Bit value1, Bit value2)
    {
        return value1.Value | value2.Value;
    }

    public static Bit operator &(Bit value1, Bit value2)
    {
        return value1.Value & value2.Value;
    }

    public static Bit operator ^(Bit value1, Bit value2)
    {
        return value1.Value ^ value2.Value;
    }

    public static Bit operator ~(Bit value)
    {
        return new Bit(value.Value ^ 1);
    }

    public static Bit operator !(Bit value)
    {
        return ~value;
    }

    #endregion

    #region The true and false operators

    public static bool operator true(Bit value)
    {
        return value.Value == 1;
    }

    public static bool operator false(Bit value)
    {
        return value.Value == 0;
    }

    #endregion

    #region Comparison operators

    public static bool operator ==(Bit bitValue, int intValue)
    {
        return 
          (bitValue.Value == 0 && intValue == 0) || 
          (bitValue.Value == 1 && intValue != 0);
    }

    public static bool operator !=(Bit bitValue, int intValue)
    {
        return !(bitValue == intValue);
    }

    public override bool Equals(object obj)
    {
        if(obj is int)
            return this == (int)obj;
        else
            return base.Equals(obj);
    }

    #endregion
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-09T08:17:44.177

它被称为布尔值。至少，它会提供基本功能，对吧？您不会在 C# 中经常旋转位（至少，我不会），如果您需要，您可以使用内置操作。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-09T08:20:31.270

有**一个**[BitArray](http://msdn.microsoft.com/en-us/library/system.collections.bitarray.aspx)类..

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-09T08:35:58.307

你想用它做什么？请记住，CLR 不会尝试将多个变量打包到一个字节中，因此单独拥有一个变量并不比布尔值有用。如果您想收集它们 - 好吧，这就是[BitArray](http://msdn.microsoft.com/en-us/library/system.collections.bitarray.aspx)的用途，正如 David 指出的那样。

如果我们*确实*有一个 Bit 结构，我怀疑人们会期望多个 Bit 变量能够有效地打包在内存中——通过首先没有类型，我们避免了这种期望，并引导人们转向其他解决方案，例如 BitArray。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-09T08:24:52.557

如果您有一组位标志，那么使用枚举（带有 falgs 属性）和整数会很有效。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-02-19T21:02:27.973

除了已经提到的 BitArray 类之外，还有一个更高效的[BitVector32 Structure](http://msdn.microsoft.com/en-us/library/system.collections.specialized.bitvector32.aspx)。

> 对于内部使用的布尔值和小整数，BitVector32 比 BitArray 更有效。BitArray 可以根据需要无限增长，但它具有类实例所需的内存和性能开销。相比之下，BitVector32 仅使用 32 位。

请记住，您仅限于 32 个值。

[Dotnetpearls.com 上的 BitVector32 使用示例](http://www.dotnetperls.com/bitvector32)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-05-12T18:32:33.907

尽管可能存在极少数例外，但计算机并非旨在或旨在操纵或分配单个位。即使在最低级别（汇编或纯机器语言），您也无法分配或访问单个位。在这方面，您可以使用与任何编程级别相同的工具：字节和按位操作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-01-27T02:18:48.040

您现在可以在 C# 7.0 中执行此操作！

公共常量 int 一 = 0b0001;

[https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7#numeric-literal-syntax-improvements](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7#numeric-literal-syntax-improvements)

# json - 如何在 shell 脚本中漂亮地打印 JSON？

> ID：352098
> 
> 赞同：3414
> 
> 时间：2008-12-09T08:20:45.137
> 
> 标签：json, unix, command-line, format, pretty-print

是否有（Unix）shell 脚本以人类可读的形式格式化 JSON？

基本上，我希望它转换以下内容：

```
{ "foo": "lorem", "bar": "ipsum" } 
```

...变成这样的东西：

```
{
    "foo": "lorem",
    "bar": "ipsum"
} 
```

* * *

## 回答 #1

> 赞同：4899
> 
> 时间：2009-12-17T09:48:55.990

使用 Python 2.6+，您可以：

```
echo '{"foo": "lorem", "bar": "ipsum"}' | python -m json.tool 
```

或者，如果 JSON 在文件中，您可以执行以下操作：

```
python -m json.tool my_json.json 
```

如果 JSON 来自 Internet 源（例如 API），您可以使用

```
curl http://my_url/ | python -m json.tool 
```

在所有这些情况下，为了方便起见，您可以创建一个别名：

```
alias prettyjson='python -m json.tool' 
```

* * *

为了更方便，请输入更多内容以做好准备：

```
prettyjson_s() {
    echo "$1" | python -m json.tool
}

prettyjson_f() {
    python -m json.tool "$1"
}

prettyjson_w() {
    curl "$1" | python -m json.tool
} 
```

对于上述所有情况。你可以把它放进去`.bashrc`，它每次都可以在 shell 中使用。像`prettyjson_s '{"foo": "lorem", "bar": "ipsum"}'`.

请注意，正如@pnd 在下面的评论中指出的那样，在 Python 3.5+ 中，JSON 对象默认不再排序。要进行排序，请将`--sort-keys`标志添加到末尾。即`... | python -m json.tool --sort-keys`。

* * *

## 回答 #2

> 赞同：1314
> 
> 时间：2013-03-05T18:34:05.913

您可以使用：[`jq`](http://stedolan.github.io/jq/)

它使用起来非常简单，而且效果很好！它可以处理非常大的 JSON 结构，包括流。[你可以在这里](http://stedolan.github.io/jq/tutorial/)找到他们的教程。

使用示例：

```
$ jq --color-output . file1.json file1.json | less -R

$ command_with_json_output | jq .

$ jq # stdin/"interactive" mode, just enter some JSON

$ jq <<< '{ "foo": "lorem", "bar": "ipsum" }'
{
  "bar": "ipsum",
  "foo": "lorem"
} 
```

或`jq`与身份过滤器一起使用：

```
$ jq '.foo' <<< '{ "foo": "lorem", "bar": "ipsum" }'
"lorem" 
```

* * *

## 回答 #3

> 赞同：401
> 
> 时间：2010-07-12T13:00:30.177

我使用“空格”参数[`JSON.stringify`](http://es5.github.io/#x15.12.3)在 JavaScript 中漂亮地打印 JSON。

例子：

```
// Indent with 4 spaces
JSON.stringify({"foo":"lorem","bar":"ipsum"}, null, 4);

// Indent with tabs
JSON.stringify({"foo":"lorem","bar":"ipsum"}, null, '\t'); 
```

从带有 Node.js 的 Unix 命令行，在命令行上指定 JSON：

```
$ node -e "console.log(JSON.stringify(JSON.parse(process.argv[1]), null, '\t'));" \
  '{"foo":"lorem","bar":"ipsum"}' 
```

回报：

```
{
    "foo": "lorem",
    "bar": "ipsum"
} 
```

从带有 Node.js 的 Unix 命令行，指定一个包含 JSON 的文件名，并使用四个空格的缩进：

```
$ node -e "console.log(JSON.stringify(JSON.parse(require('fs') \
      .readFileSync(process.argv[1])), null, 4));"  filename.json 
```

使用管道：

```
echo '{"foo": "lorem", "bar": "ipsum"}' | node -e \
"\
 s=process.openStdin();\
 d=[];\
 s.on('data',function(c){\
   d.push(c);\
 });\
 s.on('end',function(){\
   console.log(JSON.stringify(JSON.parse(d.join('')),null,2));\
 });\
" 
```

* * *

## 回答 #4

> 赞同：350
> 
> 时间：2012-05-01T16:48:57.497

我编写了一个工具，它拥有最好的“智能空白”格式化程序之一。与此处的大多数其他选项相比，它产生了更具可读性和更少冗长的输出。

[下划线-cli](http://github.com/ddopson/underscore-cli)

这就是“智能空白”的样子：

[![](https://i.stack.imgur.com/936Jk.png)](https://i.stack.imgur.com/936Jk.png)

我可能有点偏见，但它是一个很棒的工具，可以从命令行打印和操作 JSON 数据。它使用起来非常友好，并且有大量的命令行帮助/文档。这是一把瑞士军刀，我用它来完成 1001 种不同的小任务，以任何其他方式执行这些任务都会令人惊讶地烦人。

最新用例：Chrome、开发控制台、网络选项卡，全部导出为 HAR 文件，“cat site.har | underscore select '.url' --outfmt text | grep mydomain”；现在我有一个按时间顺序排列的在加载我公司网站期间进行的所有 URL 提取的列表。

漂亮的打印很容易：

```
underscore -i data.json print 
```

一样：

```
cat data.json | underscore print 
```

同样的事情，更明确：

```
cat data.json | underscore print --outfmt pretty 
```

这个工具是我目前的激情项目，所以如果你有任何功能要求，我很有可能会解决它们。

* * *

## 回答 #5

> 赞同：181
> 
> 时间：2011-11-01T01:19:25.847

我通常只是这样做：

```
echo '{"test":1,"test2":2}' | python -mjson.tool 
```

并检索选择数据（在本例中为“test”的值）：

```
echo '{"test":1,"test2":2}' | python -c 'import sys,json;data=json.loads(sys.stdin.read()); print data["test"]' 
```

如果 JSON 数据在文件中：

```
python -mjson.tool filename.json 
```

如果您想`curl`使用身份验证令牌在命令行上一次性完成所有操作：

```
curl -X GET -H "Authorization: Token wef4fwef54te4t5teerdfgghrtgdg53" http://testsite/api/ | python -mjson.tool 
```

* * *

## 回答 #6

> 赞同：94
> 
> 时间：2008-12-09T22:22:59.883

感谢 JF Sebastian 非常有帮助的指点，这是我想出的稍微增强的脚本：

```
#!/usr/bin/python

"""
Convert JSON data to human-readable form.

Usage:
  prettyJSON.py inputFile [outputFile]
"""

import sys
import simplejson as json

def main(args):
    try:
        if args[1] == '-':
            inputFile = sys.stdin
        else:
            inputFile = open(args[1])
        input = json.load(inputFile)
        inputFile.close()
    except IndexError:
        usage()
        return False
    if len(args) < 3:
        print json.dumps(input, sort_keys = False, indent = 4)
    else:
        outputFile = open(args[2], "w")
        json.dump(input, outputFile, sort_keys = False, indent = 4)
        outputFile.close()
    return True

def usage():
    print __doc__

if __name__ == "__main__":
    sys.exit(not main(sys.argv)) 
```

* * *

## 回答 #7

> 赞同：93
> 
> 时间：2011-01-30T00:46:17.487

如果你使用 npm 和 Node.js，你可以`npm install -g json`通过`json`. 做得到`json -h`所有的选择。它还可以提取特定字段并使用`-i`.

```
curl -s http://search.twitter.com/search.json?q=node.js | json 
```

* * *

## 回答 #8

> 赞同：89
> 
> 时间：2017-05-18T15:47:04.327

[使用jq 工具](https://stedolan.github.io/jq/tutorial/)的原生方式并不太简单。

例如：

```
cat xxx | jq . 
```

* * *

## 回答 #9

> 赞同：74
> 
> 时间：2010-06-30T14:31:12.037

对于 Perl，使用 CPAN 模块`JSON::XS`。它安装了一个命令行工具`json_xs`。

证实：

```
json_xs -t null < myfile.json 
```

将 JSON 文件美化`src.json`为`pretty.json`：

```
< src.json json_xs > pretty.json 
```

如果没有`json_xs`，请尝试`json_pp`。“pp”代表“纯 perl”——该工具仅在 Perl 中实现，没有绑定到外部 C 库（这是 XS 的意思，Perl 的“扩展系统”）。

* * *

## 回答 #10

> 赞同：73
> 
> 时间：2009-07-31T00:51:48.403

在 *nix 上，从标准输入读取和写入标准输出效果更好：

```
#!/usr/bin/env python
"""
Convert JSON data to human-readable form.

(Reads from stdin and writes to stdout)
"""

import sys
try:
    import simplejson as json
except:
    import json

print json.dumps(json.loads(sys.stdin.read()), indent=4)
sys.exit(0) 
```

把它放在你的 PATH 和它的一个文件中（我在[AnC](https://stackoverflow.com/users/83069/anc)的回答之后将我的命名为“prettyJSON” ） `chmod +x`，你就可以开始了。

* * *

## 回答 #11

> 赞同：72
> 
> 时间：2016-07-27T07:54:32.597

用于漂亮 json 打印的简单 bash 脚本

json_pretty.sh

```
#/bin/bash

grep -Eo '"[^"]*" *(: *([0-9]*|"[^"]*")[^{}\["]*|,)?|[^"\]\[\}\{]*|\{|\},?|\[|\],?|[0-9 ]*,?' | awk '{if ($0 ~ /^[}\]]/ ) offset-=4; printf "%*c%s\n", offset, " ", $0; if ($0 ~ /^[{\[]/) offset+=4}' 
```

例子：

```
cat file.json | json_pretty.sh 
```

* * *

## 回答 #12

> 赞同：67
> 
> 时间：2009-12-29T16:36:35.643

JSON Ruby Gem 捆绑了一个 shell 脚本来美化 JSON：

```
sudo gem install json
echo '{ "foo": "bar" }' | prettify_json.rb 
```

脚本下载： [gist.github.com/3738968](http://gist.github.com/3738968)

* * *

## 回答 #13

> 赞同：62
> 
> 时间：2008-12-09T08:52:28.740

```
$ echo '{ "foo": "lorem", "bar": "ipsum" }' \
> | python -c'import fileinput, json;
> print(json.dumps(json.loads("".join(fileinput.input())),
>                  sort_keys=True, indent=4))'
{
    "bar": "ipsum",
    "foo": "lorem"
} 
```

注意：这不是这样做*的方法。*

在 Perl 中也是如此：

```
$ cat json.txt \
> | perl -0007 -MJSON -nE'say to_json(from_json($_, {allow_nonref=>1}), 
>                                     {pretty=>1})'
{
   "bar" : "ipsum",
   "foo" : "lorem"
} 
```

注意2：如果你运行

```
echo '{ "Düsseldorf": "lorem", "bar": "ipsum" }' \
| python -c'import fileinput, json;
print(json.dumps(json.loads("".join(fileinput.input())),
                 sort_keys=True, indent=4))' 
```

可读性好的单词变成 \u 编码

```
{
    "D\u00fcsseldorf": "lorem", 
    "bar": "ipsum"
} 
```

如果管道的其余部分将优雅地处理 unicode，并且您希望 JSON 也对人类友好，只需[使用](https://docs.python.org/2/library/json.html) `ensure_ascii=False`

```
echo '{ "Düsseldorf": "lorem", "bar": "ipsum" }' \
| python -c'import fileinput, json;
print json.dumps(json.loads("".join(fileinput.input())),
                 sort_keys=True, indent=4, ensure_ascii=False)' 
```

你会得到：

```
{
    "Düsseldorf": "lorem", 
    "bar": "ipsum"
} 
```

* * *

## 回答 #14

> 赞同：62
> 
> 时间：2017-02-02T21:23:17.820

我就是这样做的：

```
curl yourUri | json_pp 
```

它缩短了代码并完成了工作。

* * *

## 回答 #15

> 赞同：59
> 
> 时间：2013-05-21T09:18:49.850

**更新**我现在正在使用`jq`另一个答案中的建议。它在过滤 JSON 方面非常强大，但在最基本的情况下，它也是一种非常棒的方式来漂亮地打印 JSON 以供查看。

[jsonpp](https://github.com/jmhodges/jsonpp)是一个非常不错的命令行 JSON 漂亮打印机。

从自述文件：

> 漂亮的打印 Web 服务响应如下：
> 
> ```
> curl -s -L http://<!---->t.co/tYTq5Pu | jsonpp 
> ```
> 
> 并使磁盘上运行的文件变得漂亮：
> 
> ```
> jsonpp data/long_malformed.json 
> ```

如果您使用的是 Mac OS X，则可以`brew install jsonpp`. 如果没有，您可以简单地将二进制文件复制到`$PATH`.

* * *

## 回答 #16

> 赞同：53
> 
> 时间：2013-01-29T12:23:49.733

试试[`pjson`](https://github.com/igorgue/pjson)。它有颜色！

![回声'{](https://i.stack.imgur.com/nu2Mc.png)

安装它`pip`：

`⚡ pip install pjson`

然后将任何 JSON 内容通过管道传输到`pjson`.

* * *

## 回答 #17

> 赞同：41
> 
> 时间：2018-07-16T12:09:08.140

您可以使用这个简单的命令来实现结果：

```
echo "{ \"foo\": \"lorem\", \"bar\": \"ipsum\" }"|python -m json.tool 
```

* * *

## 回答 #18

> 赞同：40
> 
> 时间：2009-10-21T09:10:49.650

或者，使用 Ruby：

```
echo '{ "foo": "lorem", "bar": "ipsum" }' | ruby -r json -e 'jj JSON.parse gets' 
```

* * *

## 回答 #19

> 赞同：40
> 
> 时间：2011-05-19T23:51:40.040

我使用[jshon](http://kmkeen.com/jshon/)来完全按照您的描述进行操作。赶紧跑：

```
echo $COMPACTED_JSON_TEXT | jshon 
```

您还可以传递参数来转换 JSON 数据。

* * *

## 回答 #20

> 赞同：37
> 
> 时间：2011-01-25T18:35:20.103

查看[Jazor](https://github.com/mconigliaro/jazor)。这是一个用 Ruby 编写的简单命令行 JSON 解析器。

```
gem install jazor
jazor --help 
```

* * *

## 回答 #21

> 赞同：31
> 
> 时间：2012-04-27T10:37:19.523

[JSONLint](http://jsonlint.com/)在 GitHub 上有一个[开源实现](https://github.com/zaach/jsonlint)，可以在命令行上使用或包含在 Node.js 项目中。

```
npm install jsonlint -g 
```

接着

```
jsonlint -p myfile.json 
```

或者

```
curl -s "http://api.twitter.com/1/users/show/user.json" | jsonlint | less 
```

* * *

## 回答 #22

> 赞同：30
> 
> 时间：2016-10-03T23:29:30.433

只需将输出通过管道传输到`jq .`.

例子：

```
twurl -H ads-api.twitter.com '.......' | jq . 
```

* * *

## 回答 #23

> 赞同：27
> 
> 时间：2019-09-30T13:11:46.000

您可以简单地使用 jq 或 json_pp 等标准工具。

`echo '{ "foo": "lorem", "bar": "ipsum" }' | json_pp`

或者

`echo '{ "foo": "lorem", "bar": "ipsum" }' | jq`

都会像下面这样美化输出（jq 更加丰富多彩）：

```
{
  "foo": "lorem",
  "bar": "ipsum"
} 
```

jq 的巨大优势在于，如果您想解析和处理 json，它可以做更多事情。

* * *

## 回答 #24

> 赞同：25
> 
> 时间：2011-10-07T18:27:26.903

使用 Perl，如果您从 CPAN 安装[JSON::PP](http://search.cpan.org/dist/JSON-PP/)，您将获得[json_pp](http://search.cpan.org/perldoc?json_pp)命令。从[B Bycroft](https://stackoverflow.com/users/233648/b-bycroft)窃取[示例](https://stackoverflow.com/questions/352098/how-to-pretty-print-json-script/1920585#1920585)，您将得到：

```
[pdurbin@beamish ~]$ echo '{"foo": "lorem", "bar": "ipsum"}' | json_pp
{
   "bar" : "ipsum",
   "foo" : "lorem"
} 
```

值得一提的是，`json_pp`它预装了 Ubuntu 12.04（至少）和 Debian`/usr/bin/json_pp`

* * *

## 回答 #25

> 赞同：25
> 
> 时间：2015-08-27T10:09:30.537

# Pygmentize

我将 Python 的 json.tool 与 pygmentize 结合起来：

```
echo '{"foo": "bar"}' | python -m json.tool | pygmentize -g 
```

[我的这个答案](https://stackoverflow.com/a/27501509/2670370)中列出了一些 pygmentize 的替代方法。

这是一个现场演示：

[![演示](https://i.stack.imgur.com/bpTen.png)](https://i.stack.imgur.com/bpTen.png)

* * *

## 回答 #26

> 赞同：20
> 
> 时间：2011-02-02T22:06:53.730

我建议使用 JSON::XS perl 模块中包含的 json_xs 命令行实用程序。JSON::XS 是一个用于序列化/反序列化 JSON 的 Perl 模块，在 Debian 或 Ubuntu 机器上你可以像这样安装它：

```
sudo apt-get install libjson-xs-perl 
```

它显然也可以在[CPAN](http://search.cpan.org/~mlehmann/JSON-XS-2.3/bin/json_xs)上使用。

要使用它来格式化从 URL 获得的 JSON，您可以使用 curl 或 wget，如下所示：

```
$ curl -s http://page.that.serves.json.com/json/ | json_xs 
```

或这个：

```
$ wget -q -O - http://page.that.serves.json.com/json/ | json_xs 
```

并格式化文件中包含的 JSON，您可以这样做：

```
$ json_xs < file-full-of.json 
```

重新格式化为[YAML](http://en.wikipedia.org/wiki/YAML)，有些人认为它比 JSON 更易于阅读：

```
$ json_xs -t yaml < file-full-of.json 
```

* * *

## 回答 #27

> 赞同：20
> 
> 时间：2018-02-25T13:50:32.133

[jj](https://github.com/tidwall/jj)速度超快，可以经济地处理巨大的 JSON 文档，不会混淆有效的 JSON 数字，并且易于使用，例如

```
jj -p # for reading from STDIN 
```

或者

```
jj -p -i input.json 
```

它（2018 年）仍然很新，所以它可能不会像您期望的那样处理无效的 JSON，但它很容易安装在主要平台上。

* * *

## 回答 #28

> 赞同：17
> 
> 时间：2018-09-03T07:15:26.467

[`bat`](https://github.com/sharkdp/bat)是一个`cat`带有语法高亮的克隆：

例子：

```
echo '{"bignum":1e1000}' | bat -p -l json 
```

`-p`将不带标题输出，`-l`并将明确指定语言。

它具有 JSON 的颜色和格式，并且没有*此*评论中指出的问题：*[如何在 shell 脚本中漂亮地打印 JSON？](https://stackoverflow.com/questions/352098/how-can-i-pretty-print-json-in-a-unix-shell-script#comment52647558_15231463)*

* * *

## 回答 #29

> 赞同：16
> 
> 时间：2012-11-23T13:30:17.317

使用以下命令安装 yajl-tools：

```
sudo apt-get install yajl-tools 
```

然后，

```
echo '{"foo": "lorem", "bar": "ipsum"}' | json_reformat 
```

* * *

## 回答 #30

> 赞同：16
> 
> 时间：2017-09-15T20:38:19.270

1.  `brew install jq`
2.  `command + | jq`
3.  （例如`curl localhost:5000/blocks | jq`：）
4.  享受！

[![在此处输入图像描述](https://i.stack.imgur.com/3QBbk.jpg)](https://i.stack.imgur.com/3QBbk.jpg)

* * *

## 回答 #31

> 赞同：14
> 
> 时间：2021-03-31T06:50:43.813

当您在系统上安装节点时，以下工作。

```
echo '{"test":1,"test2":2}' | npx json

{
  "test": 1,
  "test2": 2
} 
```

* * *

## 回答 #32

> 赞同：13
> 
> 时间：2017-10-27T06:41:27.887

在一行中使用 Ruby：

```
echo '{"test":1,"test2":2}' | ruby -e "require 'json'; puts JSON.pretty_generate(JSON.parse(STDIN.read))" 
```

您可以为此设置别名：

```
alias to_j="ruby -e \"require 'json';puts JSON.pretty_generate(JSON.parse(STDIN.read))\"" 
```

然后你可以更方便地使用它

```
echo '{"test":1,"test2":2}' | to_j

{
  "test": 1,
  "test2": 2
} 
```

如果你想用颜色显示 JSON，你可以安装`awesome_print`，

```
gem install awesome_print 
```

然后

```
alias to_j="ruby -e \"require 'json';require 'awesome_print';ap JSON.parse(STDIN.read)\"" 
```

试试看！

```
echo '{"test":1,"test2":2, "arr":["aa","bb","cc"] }' | to_j 
```

[![在此处输入图像描述](https://i.stack.imgur.com/Z05PJ.png)](https://i.stack.imgur.com/Z05PJ.png)

* * *

## 回答 #33

> 赞同：12
> 
> 时间：2018-09-25T06:44:51.320

使用 Node.js 的单行解决方案如下所示：

```
$ node -e "console.log( JSON.stringify( JSON.parse(require('fs').readFileSync(0) ), 0, 1 ))" 
```

例如：

```
$ cat test.json | node -e "console.log( JSON.stringify( JSON.parse(require('fs').readFileSync(0) ), 0, 1 ))" 
```

* * *

## 回答 #34

> 赞同：10
> 
> 时间：2011-05-18T16:32:44.977

[`yajl`](http://lloyd.github.com/yajl/) is very nice, in my experience. I use its `json_reformat` command to pretty-print `.json` files in `vim` by putting the following line in my `.vimrc`:

```
autocmd FileType json setlocal equalprg=json_reformat 
```

* * *

## 回答 #35

> 赞同：10
> 
> 时间：2013-08-06T10:14:25.007

这是一个比 Json 的 prettify 命令更好的 Ruby 解决方案。宝石`colorful_json`相当不错。

```
gem install colorful_json
echo '{"foo": "lorem", "bar": "ipsum"}' | cjson
{
  "foo": "lorem",
  "bar": "ipsum"
} 
```

* * *

## 回答 #36

> 赞同：9
> 
> 时间：2021-11-03T08:04:58.903

你只需要使用jq 如果没有安装jq 那么你需要先安装jq。

```
sudo apt-get update
sudo apt-get install jq 
```

安装好jq之后只需要使用jq

```
echo '{ "foo": "lorem", "bar": "ipsum" }' | jq 
```

输出看起来像

```
{
  "foo": "lorem",
  "bar": "ipsum"
} 
```

* * *

## 回答 #37

> 赞同：8
> 
> 时间：2013-04-18T18:45:17.530

PHP 版本，如果您的 PHP >= 5.4。

```
alias prettify_json=php -E '$o = json_decode($argn); print json_encode($o, JSON_PRETTY_PRINT);'
echo '{"a":1,"b":2}' | prettify_json 
```

* * *

## 回答 #38

> 赞同：8
> 
> 时间：2009-06-29T21:01:46.500

JF Sebastian 的解决方案在 Ubuntu 8.04 中对我不起作用。
这是一个修改后的 Perl 版本，可以与旧的 1.X JSON 库一起使用：

```
perl -0007 -MJSON -ne 'print objToJson(jsonToObj($_, {allow_nonref=>1}), {pretty=>1}), "\n";' 
```

* * *

## 回答 #39

> 赞同：8
> 
> 时间：2015-03-06T02:48:18.247

我正在使用[httpie](https://github.com/jakubroztocil/httpie)

```
$ pip install httpie 
```

你可以像这样使用它

```
 $ http PUT localhost:8001/api/v1/ports/my 
 HTTP/1.1 200 OK
 Connection: keep-alive
 Content-Length: 93
 Content-Type: application/json
 Date: Fri, 06 Mar 2015 02:46:41 GMT
 Server: nginx/1.4.6 (Ubuntu)
 X-Powered-By: HHVM/3.5.1

 {
     "data": [], 
     "message": "Failed to manage ports in 'my'. Request body is empty", 
     "success": false
 } 
```

* * *

## 回答 #40

> 赞同：8
> 
> 时间：2020-04-09T11:07:15.007

**TL;DR**：对于表演，使用`jj -p < my.json`.

# 基准

我在这里采用了一些解决方案，并使用下一个虚拟脚本对它们进行了基准测试：

```
function bench {
    time (
      for i in {1..1000}; do
        echo '{ "foo" : { "bar": { "dolorem" : "ipsum", "quia" : { "dolor" : "sit"} } } }' \
        | $@ > /dev/null
      done
    )
} 
```

这是我的 mac（32 GB，Apple M1 Max，YMMV）上的结果：

```
bench python -m json.tool
# 8.39s user 12.31s system 42% cpu 48.536 total
bench jq
# 13.12s user 1.28s system 87% cpu 16.535 total
bench bat -p -l json # NOTE: only syntax colorisation.
# 1.87s user 1.47s system 66% cpu 5.024 total
bench jj -p
# 1.94s user 2.44s system 57% cpu 7.591 total
bench xidel -s - -e '$json' --printed-json-format=pretty                      
# 4.32s user 1.89s system 76% cpu 8.101 total 
```

感谢@peak 和您对 jj 发现的[回答](https://stackoverflow.com/a/48974193/6320039)！

* * *

## 回答 #41

> 赞同：7
> 
> 时间：2008-12-09T08:31:36.910

有[TidyJSON](http://www.raboof.com/Projects/TidyJson/)。

它是 C#，所以也许你可以让它用[Mono](http://en.wikipedia.org/wiki/Mono_%28software%29)编译，并在 *nix 上工作。但不能保证，对不起。

* * *

## 回答 #42

> 赞同：7
> 
> 时间：2015-11-14T09:58:12.333

对于 Node.js，您还可以使用“util”模块。它使用语法高亮，智能缩进，从键中删除引号，并使输出尽可能漂亮。

```
cat file.json | node -e "process.stdin.pipe(new require('stream').Writable({write: chunk =>  {console.log(require('util').inspect(JSON.parse(chunk), {depth: null, colors: true}))}}))" 
```

* * *

## 回答 #43

> 赞同：6
> 
> 时间：2016-07-31T16:28:12.720

该工具`ydump`是一个 JSON 漂亮的打印机：

```
$ ydump my_data.json
{
  "foo": "lorem",
  "bar": "ipsum"
} 
```

或者您可以通过管道输入 JSON：

```
$ echo '{"foo": "lorem", "bar": "ipsum"}' | ydump
{
  "foo": "lorem",
  "bar": "ipsum"
} 
```

除了使用该`jq`工具之外，这可能是最短的解决方案。

此工具是[OCaml](https://en.wikipedia.org/wiki/Ocaml)`yojson`库的一部分，并[在此处](https://mjambon.github.io/atdgen-doc/tutorial)记录。

在 Debian 及其衍生版本中，该软件包`libyojson-ocaml-dev`包含此工具。或者，`yojson`可以通过[OPAM](https://opam.ocaml.org/)安装。

* * *

## 回答 #44

> 赞同：5
> 
> 时间：2011-02-15T16:33:52.457

```
$ sudo apt-get install edit-json
$ prettify_json myfile.json 
```

* * *

## 回答 #45

> 赞同：5
> 
> 时间：2017-02-01T09:31:33.840

If you have Node.js installed you can create one on your own with one line of code. Create a file pretty:

> > vim pretty

```
#!/usr/bin/env node

console.log(JSON.stringify(JSON.parse(process.argv[2]), null, 2)); 
```

Add execute permission:

> > chmod +x pretty
> 
> > ./pretty '{"foo": "lorem", "bar": "ipsum"}'

Or if your JSON is in a file:

```
#!/usr/bin/env node

console.log(JSON.stringify(require("./" + process.argv[2]), null, 2)); 
```

> > ./pretty file.json

* * *

## 回答 #46

> 赞同：4
> 
> 时间：2011-12-08T21:35:43.740

这是使用[Groovy](http://en.wikipedia.org/wiki/Groovy_%28programming_language%29)脚本的方法。

创建一个 Groovy 脚本，比如说“pretty-print”

```
#!/usr/bin/env groovy

import groovy.json.JsonOutput

System.in.withReader { println JsonOutput.prettyPrint(it.readLine()) } 
```

使脚本可执行：

```
chmod +x pretty-print 
```

现在从命令行，

```
echo '{"foo": "lorem", "bar": "ipsum"}' | ./pretty-print 
```

* * *

## 回答 #47

> 赞同：4
> 
> 时间：2021-01-04T09:29:21.530

我想出了这个解决方案：[https ://callbertts.medium.com/unix-pipelines-with-curl-requests-and-serverless-functions-e21117ae4c65](https://calbertts.medium.com/unix-pipelines-with-curl-requests-and-serverless-functions-e21117ae4c65)

```
# this in your bash profile
jsonprettify() {
  curl -Ss -X POST -H "Content-Type: text/plain" --data-binary @- https://jsonprettify.vercel.app/api/server?indent=$@
} 
```

```
echo '{"prop": true, "key": [1,2]}' | jsonprettify 4
# {
#     "prop": true,
#     "key": [
#         1,
#         2
#     ]
# } 
```

无需安装任何东西，如果您有互联网连接并安装了 cURL，则可以使用此功能。

您是否在无法安装任何东西的另一台主机上，这将是该问题的完美解决方案。

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2012-01-25T20:33:41.943

使用 JavaScript/Node.js：看看[vkBeautify.js 插件](http://www.eslinstructor.net/vkbeautify/)，它为 JSON 和 XML 文本提供了漂亮的打印。

它是用纯 JavaScript 编写的，不到 1.5 KB（缩小）并且速度非常快。

* * *

## 回答 #49

> 赞同：3
> 
> 时间：2012-01-11T04:00:57.823

我是[json-liner](https://github.com/wuyongzheng/json-liner)的作者。它是将 JSON 转换为 grep 友好格式的命令行工具。试试看。

```
$ echo '{"a": 1, "b": 2}' | json-liner
/%a 1
/%b 2
$ echo '["foo", "bar", "baz"]' | json-liner
/@0 foo
/@1 bar
/@2 baz 
```

* * *

## 回答 #50

> 赞同：3
> 
> 时间：2014-08-12T21:12:51.577

这是一个 Groovy 单行代码：

```
echo '{"foo": "lorem", "bar": "ipsum"}' | groovy -e 'import groovy.json.*; println JsonOutput.prettyPrint(System.in.text)' 
```

* * *

## 回答 #51

> 赞同：3
> 
> 时间：2015-12-11T11:05:45.870

```
gem install jsonpretty
echo '{"foo": "lorem", "bar": "ipsum"}' | jsonpretty 
```

此方法还[“**检测 HTTP 响应/标头，原封不动地打印它们，然后跳到正文（与 `curl -i' 一起使用）** ”](https://github.com/nicksieger/jsonpretty)。

* * *

## 回答 #52

> 赞同：3
> 
> 时间：2017-02-20T04:37:46.600

[https://github.com/aidanmelen/json_pretty_print](https://github.com/aidanmelen/json_pretty_print)

```
from __future__ import unicode_literals
from __future__ import absolute_import
from __future__ import print_function
from __future__ import division

import json
import jsonschema

def _validate(data):
    schema = {"$schema": "http://json-schema.org/draft-04/schema#"}
    try:
        jsonschema.validate(data, schema,
                            format_checker=jsonschema.FormatChecker())
    except jsonschema.exceptions.ValidationError as ve:
        sys.stderr.write("Whoops, the data you provided does not seem to be " \
        "valid JSON.\n{}".format(ve))

def pprint(data, python_obj=False, **kwargs):
    _validate(data)
    kwargs["indent"] = kwargs.get("indent", 4)
    pretty_data = json.dumps(data, **kwargs)
    if python_obj:
        print(pretty_data)
    else:
       repls = (("u'",'"'),
                ("'",'"'),
                ("None",'null'),
                ("True",'true'),
                ("False",'false'))
    print(reduce(lambda a, kv: a.replace(*kv), repls, pretty_data)) 
```

* * *

## 回答 #53

> 赞同：2
> 
> 时间：2016-10-15T13:43:04.737

如果你不介意使用第三方工具，你可以简单地*curl*到[jsonprettyprint.org](https://jsonprettyprint.org)。这是针对您无法在机器上安装软件包的情况。

```
curl -XPOST https://jsonprettyprint.org/api -d '{"user" : 1}' 
```

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2012-03-07T10:41:28.920

我的 JSON 文件没有被这些方法解析。

我的问题类似于帖子*[Google 数据源 JSON 无效吗？](https://stackoverflow.com/questions/628505/is-google-data-source-json-not-valid)*.

[该帖子的答案](https://stackoverflow.com/questions/628505/is-google-data-source-json-not-valid/628634#628634)帮助我找到了解决方案。

它被认为是没有字符串键的无效 JSON。

```
{id:'name',label:'Name',type:'string'} 
```

一定是：

```
{"id": "name", "label": "Name", "type": "string"} 
```

此链接对一些不同的 JSON 解析器进行了很好的全面比较：http: [//deron.meranda.us/python/comparing_json_modules/basic](http://deron.meranda.us/python/comparing_json_modules/basic)

这让我去了[http://deron.meranda.us/python/demjson/](http://deron.meranda.us/python/demjson/)。我认为这个解析器比许多其他解析器更容错。

* * *

## 回答 #55

> 赞同：1
> 
> 时间：2017-01-26T10:19:12.057

另请务必查看[JSONFUI：支持折叠的命令行 JSON 查看器](https://github.com/AdrianSchneider/jsonfui)

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2019-01-17T23:08:19.930

您可以使用[xidel](/questions/tagged/xidel "显示标记为“xidel”的问题")。

> Xidel 是一个命令行工具，用于从 HTML/XML 页面或 JSON-API 下载和提取数据，使用 CSS、XPath 3.0、XQuery 3.0、JSONiq 或模式模板。它还可以创建新的或转换的 XML/HTML/JSON 文档。

Xidel 默认漂亮打印：

```
$ xidel -se '$json' <<< '{"foo":"lorem","bar":"ipsum"}'
{
  "foo": "lorem",
  "bar": "ipsum"
} 
```

或者：

```
$ echo '{"foo":"lorem","bar":"ipsum"}' | xidel -se '$json'
{
  "foo": "lorem",
  "bar": "ipsum"
} 
```

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2022-01-25T12:34:05.643

如果你想在控制台可视化 json 日志，你可以使用 [munia-pretty-json](https://github.com/gagan-bansal/munia-pretty-json)

```
npm install -g munia-pretty-json 
```

您的 json 数据 (app-log.json)

```
{"time":"2021-06-09T02:50:22Z","level":"info","message":"Log for pretty JSON","module":"init","hostip":"192.168.0.138","pid":123}
{"time":"2021-06-09T03:27:43Z","level":"warn","message":"Here is warning message","module":"send-message","hostip":"192.168.0.138","pid":123} 
```

运行命令：

```
munia-pretty-json app-log.json 
```

这是控制台上的可读输出：

[![在此处输入图像描述](https://i.stack.imgur.com/RNram.png)](https://i.stack.imgur.com/RNram.png)

您可以使用模板格式化输出。默认模板是`'{time} {level -c} {message}'`

使用模板：

```
munia-pretty-json -t '{module -c} - {level} - {message}' app-log.json 
```

输出：

[![在此处输入图像描述](https://i.stack.imgur.com/2DrfJ.png)](https://i.stack.imgur.com/2DrfJ.png)

* * *

## 回答 #58

> 赞同：-2
> 
> 时间：2014-11-19T17:03:56.227

如果您愿意，您也可以使用在线工具。

我发现[http://jsonprettyprint.net](http://jsonprettyprint.net)是最简单和最容易的。

* * *

## 回答 #59

> 赞同：-3
> 
> 时间：2012-11-16T10:24:15.943

我知道原始帖子要求提供 shell 脚本，但是有很多有用且不相关的答案可能对原作者没有帮助。添加无关紧要:)

顺便说一句，我无法使用任何命令行工具。

如果有人想要简单的 JSON JavaScript 代码，他们可以这样做：

```
JSON.stringfy(JSON.parse(str), null, 4) 
```

[http://www.geospaces.org/geoweb/Wiki.jsp?page=JSON%20Utilities%20Demos](http://www.geospaces.org/geoweb/Wiki.jsp?page=JSON%20Utilities%20Demos)

这里的 JavaScript 代码不仅可以修饰 JSON，还可以按属性或按属性和级别对 JSON 进行排序。

如果输入是

```
{ "c": 1, "a": {"b1": 2, "a1":1 }, "b": 1}, 
```

它要么打印（将所有对象组合在一起）：

```
{
     "b": 1,
     "c": 1,
     "a": {
          "a1": 1,
          "b1": 2
     }
} 
```

或者（只是按键命令）：

```
{
 "a": {
      "a1": 1,
      "b1": 2
 },
 "b": 1,
 "c": 1
} 
```

# .net - .net 中最小的内存分配是一个字节是真的吗？

> ID：352100
> 
> 赞同：3
> 
> 时间：2008-12-09T08:21:40.223
> 
> 标签：.net, memory

我可以在托管代码中分配的最小内存量是一个字节，这是真的吗？

我是否正确理解布尔变量占用的内存远不止一点点？

有没有办法让我在.net中以小于一个字节的块分配内存？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-09T08:27:55.763

这是正确的，分配是按字节粒度进行的（可能四舍五入到偶数字节甚至更高）。我使用过的任何操作系统都是如此，因此它并不特定于托管代码。内存管理器使用字节，而不是位。

另一方面，如果您有大量布尔值并希望获得更高的存储效率，则将布尔值打包成位数组并不难（请参阅[BitArray](http://msdn.microsoft.com/en-us/library/system.collections.bitarray.aspx)）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-09T08:28:55.900

您不能在任何计算机上分配内存 - 我知道 - 数量小于一个字节，绝对不是在 PC 上。

此外，使用 .net，*您*不会分配任何内存，除非您在 .Net 中使用 C++（使用垃圾收集，最好说您正在“使用”内存而不是“分配”内存） ，实际上不可能判断对 new 的调用是分配内存还是重用内存）。

如果您使用 C++，即使您可能要求一个字节，操作系统也会为您的程序分配一块内存供您使用，这几乎肯定会超过一个字节。

如果您想存储一个位数组，您可以滚动您自己的 BitArray 集合，其中您将存储的最小值是一个字节（实际上您应该使用整数），然后您将这些位打包和解包。

幸运的是 .Net 3.5 带有一个[BitArray 类](http://msdn.microsoft.com/en-us/library/system.collections.bitarray.bitarray.aspx)（*显然 1.0、1.1、2.0、3.0 ......谢谢乔*）

然而，总是有代价的。打包和解包位将比保持布尔数组慢。

希望这可以帮助

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T08:30:11.233

如果您有很多布尔值要以节省空间的方式存储，请查看[BitArray 类](http://msdn.microsoft.com/en-us/library/system.collections.bitarray(VS.80).aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T08:37:21.097

尝试迁移到[Intel 4040](http://en.wikipedia.org/wiki/Intel_4040)。那么你的布尔值将只使用 4 位。但是，如果您在跳蚤市场上找不到，或者碰巧在阁楼上，我建议您使用位数组，因为随着 64 位的惊人出现，您的布尔值将变得像双精度数一样大，恐怖！

# image - “ul”中的背景图片居中...但我希望它在顶部

> ID：352103
> 
> 赞同：0
> 
> 时间：2008-12-09T08:23:52.713
> 
> 标签：image, background, alignment, html-lists

在这个页面（[http://www.bonniesphere.com/blog/elsewhere/](http://www.bonniesphere.com/blog/elsewhere/)）上，“li”项目有一个图像而不是一个项目符号。但是图像垂直居中，在多行条目中看起来不太好。谁能告诉我 CSS 中是否有需要更改的内容？

下面是相关代码：

.entry ul {list-style-type:none;} .entry ul li{padding: 0 0 0 15px;background: url(img/ol.gif) no-repeat left center;margin-left:10px;}

非常感谢您的帮助...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T08:37:21.050

用**top**替换**center**：

 **```
background: transparent url(img/ol.gif) no-repeat scroll left top; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T08:26:52.473

```
.entry ul {list-style-type:none;} 
.entry ul li{padding: 0 0 0 15px;
background: url(img/ol.gif) no-repeat left top center;
margin-left:10px;} 
```

只是在我的脑海中输入了那个，但是“top”属性可能会做到这一点。您可以尝试用顶部标签替换左侧或中心，因为我的 webdeveloper 插件正在欺骗我，所以无法检查您。:(

我在当地查了一下，它是中心标签。但是仍然需要一些额外的空白。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T08:35:38.680

```
.entry ul li{padding: 0 0 0 15px;background: url(img/ol.gif) no-repeat left 4pt;margin-left:10px;} 
```

基本上你需要指定从顶部的偏移量。您有**center**，它显然使图像垂直居中。

作为一个粗略的猜测，我使用**了 4pt**，但这取决于你想要放置图像的确切位置。使用**4pt**它大致将其与第一行对齐，但字体大小的任何更改都会搞砸定位。

就我个人而言，使用**top**作为垂直位置对我来说有点太高了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T12:57:40.930

感谢您的建议...我有 Firebug，但从未使用过它 - 因此结合 Firebug 和 BBEdit 的“比较”功能，我终于能够弄清楚了！模板作者提供了对要点的修复，但是当我上传最新版本的主题时，问题又出现了。我找到了，瞧……

多亏了这两个程序，我还能够找到其他不起作用的解决方案。

我是一个快乐的露营者！至少……直到下一次我遇到无法解决的问题……

:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T00:36:59.800

这很奇怪......我尝试了上述所有三个建议，但它们都没有改变任何东西。更多信息，如果有帮助的话：它是一个 Wordpress 博客（在我的服务器上），我正在通过主题编辑器编辑 style.css。（这不应该有任何区别......）

您是否认为 CSS 中的其他地方有一些东西使图像保持在中心对齐，覆盖了这段代码？

# java - Java 的序列化是如何工作的，什么时候应该使用它来代替其他一些持久性技术？

> ID：352117
> 
> 赞同：41
> 
> 时间：2008-12-09T08:32:15.113
> 
> 标签：java, serialization

我最近一直在尝试了解更多信息并普遍测试 Java 的工作和个人项目的序列化，我必须说，我对它了解得越多，我就越不喜欢它。这可能是由错误信息引起的，所以这就是为什么我要向你们提出这两件事：

**1：**在字节级别，序列化如何知道如何将序列化值与某个类匹配？

我的一个问题是我用包含值“一”、“二”、“三”的 ArrayList 做了一个小测试。序列化后，字节数组占用了 78 个字节，这对于如此少量的信息（19+3+3+4 字节）来说似乎非常多。当然肯定会有一些开销，但这引出了我的第二个问题：

**2：**序列化可以被认为是持久化对象的好方法吗？现在很明显，如果我使用一些自制的 XML 格式，持久性数据将是这样的

```
<object>
    <class="java.util.ArrayList">
    <!-- Object array inside Arraylist is called elementData -->
    <field name="elementData">
        <value>One</value>
        <value>Two</value>
        <value>Three</value>
    </field>
</object> 
```

与一般的 XML 一样，它有点臃肿，占用 138 个字节（即没有空格）。JSON中的相同可能是

```
{
    "java.util.ArrayList": {
        "elementData": [
            "one",
            "two",
            "three"
        ]
    }
} 
```

这是 75 个字节，因此已经比 Java 的序列化略小。对于这些基于文本的格式，显然必须有一种方法可以将您的基本数据表示为文本、数字或两者的任意组合。

所以回顾一下，序列化如何在字节/位级别上工作，什么时候应该使用，什么时候不应该使用，除了它在 Java 中的标准之外，序列化的真正好处是什么？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-12-09T08:40:39.357

我个人会尽量避免 Java 的“内置”序列化：

*   它不能移植到其他平台
*   效率不是很高
*   它很脆弱——让它处理一个类的多个版本有点棘手。除非您小心，否则即使更改编译器也会破坏序列化。

有关实际字节含义的详细信息，请参阅[Java 对象序列化规范](http://java.sun.com/javase/6/docs/platform/serialization/spec/serialTOC.html)。

有多种选择，例如：

*   XML 和 JSON，正如您所展示的（当然，各种 XML 风格）
*   [YAML](http://en.wikipedia.org/wiki/Yaml)
*   Facebook 的[Thrift](http://incubator.apache.org/thrift/)（RPC 以及序列化）
*   [Google 协议缓冲区](http://code.google.com/apis/protocolbuffers/)
*   [Hessian](http://hessian.caucho.com/)（Web 服务以及序列化）
*   [阿帕奇阿夫罗](http://avro.apache.org/)
*   您自己的自定义格式

（免责声明：我为 Google 工作，我正在将 Protocol Buffers 移植到 C# 作为我 20% 的项目，所以很明显，我认为这是一项很好的技术 :)

出于显而易见的原因，跨平台格式几乎总是比特定于平台的格式更具限制性——例如，Protocol Buffers 的本地类型非常有限——但互操作性可能非常有用。您还需要考虑版本控制的影响，以及向后和向前兼容性等。文本格式通常是可手动编辑的，但在空间和时间上往往效率较低。

基本上，您需要仔细查看您的要求。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-09T09:18:59.607

序列化的主要优点是它非常易于使用，相对较快，并且保留了实际的 Java 对象网格。

但是您必须意识到，它并不是真正用于存储数据，而是主要作为不同 JVM 实例使用 RMI 协议通过网络进行通信的一种方式。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-09T08:47:08.377

有关用于序列化对象的文件格式和语法的描述，请参阅 Java 对象[序列化流协议。](http://java.sun.com/javase/6/docs/platform/serialization/spec/protocol.html)

就我个人而言，我认为内置序列化对于持久化短期数据（例如，将会话对象的状态存储到 http-requests 之间）是可以接受的，这在您的应用程序之外是不相关的。

对于具有更长生存时间或应该在应用程序之外使用的数据，我会保存到数据库中，或者至少使用更常用的格式......

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-01-06T00:54:24.643

> Java 的内置序列化是如何工作的？

每当我们想要序列化一个对象时，我们都会实现 java.io.Serializable 接口。没有任何方法可以实现的接口，即使我们实现它**是为了向编译器或 JVM 指示某些东西**（称为**标记接口**）。因此，如果 JVM 看到一个类是可序列化的，它会对这些类执行一些预处理操作。操作是，它添加了以下两个示例方法。

```
private void writeObject(java.io.ObjectOutputStream stream)
            throws IOException {
        stream.writeObject(name); // object property
        stream.writeObject(address); // object property
    }

    private void readObject(java.io.ObjectInputStream stream)
            throws IOException, ClassNotFoundException {
        name = (String) stream.readObject(); // object property
        address = (String) stream.readObject();// object property
    } 
```

> 什么时候应该使用它来代替其他一些持久性技术？

`Serialization`当发送方和接收方都是 Java 时，内置函数很有用。如果您想避免上述问题，我们在框架的帮助下使用 XML 或 JSON。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T08:45:28.223

大约一个月前，我遇到了这个难题（请参阅[我提出的问题](https://stackoverflow.com/questions/244493/homemade-vs-java-serialization)）。

我从中学到的主要教训是仅在必要且没有其他选择的情况下使用 Java 序列化。正如 Jon 所说，它有缺点，而其他序列化技术更容易、更快、更便携。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T08:46:02.327

序列化意味着您将类中的结构化数据放入字节码的平面顺序中以保存它。

您通常应该使用内置 java-method 之外的其他技术，它只是开箱即用，但是如果您将来在序列化类中有一些更改内容或更改顺序，您会遇到麻烦，因为您将无法加载他们正确。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-09T13:00:12.360

Java 对象序列化 (JOS) 的优势在于它可以正常工作。还有一些工具可以与 JOS 做同样的事情，但使用 XML 格式而不是二进制格式。

关于长度：JOS 在开始时写入一些类信息，而不是作为每个实例的一部分 - 例如，完整的字段名称被记录一次，并且该名称列表的索引用于类的实例。如果您只编写类的一个实例，这会使输出更长，但如果您编写它的多个（不同）实例，则效率会更高。我不清楚您的示例是否真的使用了一个类，但这就是 JOS 比人们预期的要长的一般原因。

顺便说一句：这是偶然的，但我不认为 JSON 记录类名（如您在示例中所使用的那样），因此它可能无法满足您的需要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-14T17:08:38.163

存储少量信息以串行形式存储的原因相对较大，因为它存储了有关其正在序列化的对象的类的信息。如果您存储列表的副本，那么您会看到该文件并没有增长太多。将同一对象存储两次，差异很小。

重要的优点是：相对容易使用、相当快并且可以发展（就像 XML 一样）。但是，数据相当不透明，它是纯 Java 的，数据与类紧密耦合，不受信任的数据很容易导致 DoS。你应该考虑序列化的形式，而不是`implements Serializable`到处打耳光。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-15T01:44:51.417

如果没有太多数据，可以将对象保存到 java.util.Properties 对象中。键/值对的示例是 user_1234_firstname = Peter。使用反射来保存和加载对象可以使事情变得更容易。

# asp.net-mvc - asp.net mvc - 视图中的命名空间

> ID：352118
> 
> 赞同：15
> 
> 时间：2008-12-09T08:32:27.487
> 
> 标签：asp.net-mvc

我将使用命名空间放在后面的视图代码中，但我不能在 aspx 中调用此命名空间的任何类。

在代码隐藏中：

```
using MVCTest.Controller; 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-09T08:45:12.750

尝试在您的 aspx / ascx 文件中使用

```
<%@ import namespace='your namespace' %> 
```

您也可以尝试在 web.config 中导入您的命名空间

```
<system.web>
  <pages>
    <namespaces>
      <add namespace='you namespace' />
    </namespaces>
  </pages>
</system.web> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-11-21T15:47:57.627

添加**import**语句 如果您使用的是 ASP.NET (C#) 引擎：

```
<%@ Import Namespace="My.Namespace.Path" %>

<html goes here>
    ...
</html> 
```

或者

如果您使用的是 Razor 引擎，请将**using**语句添加到您的视图中：

```
@using My.Namespace.Path

@{
    ViewBag.Title = "My Page";
    ...
}

<html goes here>
   ...
</html goes here> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T08:44:10.660

你还记得包括程序集吗？比如像这样：

```
// system.web / compilation / assemblies
<add assembly="Microsoft.Web.Mvc"/> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T08:56:35.567

假设这是你的 .Cs 文件说

> 命名空间 MVCTest.Controller {
> 
> ```
> public class Utility
> 
> { 
>    public static void func1()
>    {} 
> } 
> ```
> 
> }

尝试通过以下方式调用该函数： Utility.func1()

# reporting-services - SQL Reporting Services - 限制导出格式

> ID：352130
> 
> 赞同：2
> 
> 时间：2008-12-09T08:38:45.430
> 
> 标签：reporting-services

是否可以仅限制 PDF 和 Excel 的导出格式？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-09T08:44:23.717

**在rsreportserver.config**的Render 部分中注释掉或删除要排除的格式

```
..\Program Files\Microsoft SQL Server\MSSQL.<n>\Reporting Services\ReportServer 
```

# iphone - 访问 iPhone/iPod touch 上的日历条目

> ID：352140
> 
> 赞同：2
> 
> 时间：2008-12-09T08:44:50.317
> 
> 标签：iphone, cocoa-touch

是否可以在 iPhone/iPod touch 上访问日历条目，即阅读、创建、更改、删​​除约会？

我搜索了 iPhone SDK 文档，但没有找到任何东西。也许我错过了什么。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T13:15:06.603

目前 SDK 不支持此功能。如果您需要这个，请考虑向 Apple 提交[错误报告](http://bugreport.apple.com)。

# c++ - STL 中有 dereference_iterator 吗？

> ID：352152
> 
> 赞同：15
> 
> 时间：2008-12-09T08:47:43.163
> 
> 标签：c++, stl, iterator

我想知道 STL 中是否有一个迭代器在返回之前取消引用指向的对象。这在操作容器聚合指针时可能非常有用。这是我希望能够做的一个例子：

```
#include <vector>
#include <iterator>
#include <algorithm>

using namespace std;

int main()
{
  vector<int*> vec;

  int i = 1;
  int j = 2;
  int k = 3;

  vec.push_back(&i);
  vec.push_back(&j);
  vec.push_back(&k);

  copy(deref_iterator(vec.begin()), 
       deref_iterator(vec.end()), 
       ostream_iterator<int>(cout, " ")); // prints "1 2 3"

  return 0;
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-09T09:43:36.297

试试 Boost 的[`indirect_iterator`](http://www.boost.org/doc/libs/1_37_0/libs/iterator/doc/indirect_iterator.html).

An`indirect_iterator`与它所包装的迭代器具有相同的类别。例如，an`indirect_iterator<int**>`是一个随机访问迭代器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T08:52:33.170

如果无法使用 Boost，编写自定义迭代器并不难。以下是满足 InputIterator 要求的“取消引用迭代器”示例：

```
#include <iterator>

template <typename T>
struct PointedType;

template <typename T>
struct PointedType<T*>
{
  typedef T value_type;
};

template <typename InputIterator>
struct DerefIterator
{
  typedef input_iterator_tag iterator_category;
  typedef typename PointedType<
            typename iterator_traits<InputIterator>::value_type>::value_type
            value_type;
  typedef typename iterator_traits<InputIterator>::difference_type
            difference_type;
  typedef value_type* pointer;
  typedef value_type& reference;

  public:
    explicit DerefIterator(const InputIterator& ii)
      : it(ii) {}

    // Returns the object pointed by the object referenced by it
    reference operator*()  const { return **it; }
    pointer   operator->() const { return *it; }

    DerefIterator& operator++()
    {
        ++it;
        return *this;
    }

    DerefIterator operator++(int)
    {
        DerefIterator tmp = *this;
        ++it;
        return tmp;
    }

    bool equals(const DerefIterator<InputIterator> & di) const
    {
        return di.it == it;
    }

  private:
    InputIterator it;
};

// Equality functions

template <typename InputIterator>
inline bool operator==(const DerefIterator<InputIterator>& di1, 
                       const DerefIterator<InputIterator>& di2)
{
  return di1.equals(di2);
}

template <typename InputIterator>
inline bool operator!=(const DerefIterator<InputIterator>& di1, 
                       const DerefIterator<InputIterator>& di2)
{
  return ! (di1 == di2);
}

//Helper function

template <typename InputIterator>
DerefIterator<InputIterator> deref_iterator(const InputIterator& ii)
{
  return DerefIterator<InputIterator>(ii);
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-09T13:52:32.393

假设您的实际用例比整数指针容器复杂一点！

您可以查看 boost ptr 容器
[http://www.boost.org/doc/libs/1_35_0/libs/ptr_container/doc/reference.html](http://www.boost.org/doc/libs/1_35_0/libs/ptr_container/doc/reference.html)

容器包含动态分配的对象（即指针）。
但是对对象的所有访问（直接或通过迭代器）都会返回对该对象的引用。

```
#include <boost/ptr_container/ptr_vector.hpp>
#include <iostream>
#include <iterator>
#include <algorithm>

using namespace std;

int main()
{
  boost::ptr_vector<int> vec;

  vec.push_back(new int(1));
  vec.push_back(new int(2));
  vec.push_back(new int(3));

  copy(vec.begin(),vec.end(),
       ostream_iterator<int>(std::cout, " ")); // prints "1 2 3 "

  return 0;
} 
```

# c# - 在 WinForms 桌面应用程序中使用 jQuery？

> ID：352159
> 
> 赞同：3
> 
> 时间：2008-12-09T08:52:21.393
> 
> 标签：c#, .net, jquery, winforms, webbrowser-control

我们有一个 WinForms 桌面应用程序，它非常广泛地使用 .NET 2.0 框架 WebBrowser 控件来显示 HTML。HTML 可能很简单，也可能很复杂。它可能驻留在磁盘上，也可能在运行时直接写入文档属性。

我想知道是否有人有使用 jQuery 作为此类桌面应用程序库的经验。我可以只引用磁盘上的 jquery.js 文件，并像使用 Web 应用程序一样使用它吗？有什么我需要注意的陷阱吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T10:42:32.763

归根结底，它只是浏览器中的 HTML 标记，就像您正在处理要在任何 Web 浏览器中查看的页面一样对待它。假设您可以从标记中引用库，jQuery 就可以正常工作。这需要在运行时将脚本引用注入到标记中。

您说源可能驻留在磁盘上或动态生成，我将介绍一个预加载步骤，该步骤要么从磁盘加载文件，要么在内存中生成标记，然后（使用字符串或 XML 操作），注入 jQuery 参考以及在填充 WebBrowser 文档之前将任何关联的脚本放入标记中。从那里，让 WebBrowser 控件完成它的工作。

# session - 会话可以伪造吗？

> ID：352172
> 
> 赞同：5
> 
> 时间：2008-12-09T08:57:26.420
> 
> 标签：session, asp-classic, sql-injection

我需要检查我所有的 asp 代码以防止 SQL 注入。

我也应该检查会话对象吗？

会话如何被劫持？

谢谢！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T09:10:50.497

为避免 SQL 注入，请使用参数化查询，而不是通过连接字符串来构建 SQL 查询。会话劫持是一个完全不同的话题。通过在每个请求中更改会话 cookie 会变得更加困难，而使用 HTTPS 可以完全避免这种情况。一个相关（并且更大）的问题是跨站点请求伪造（查找）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T09:14:08.697

会话可以被劫持。如果我没记错的话，Classic ASP 只支持基于 cookie 的会话标识符。如果有人能够窃取该 cookie（窃听），那么他们可以获得与合法用户相同的会话。

你也应该检查会话对象吗？那要看。如果您可以确保存储在会话中的所有对象都是“安全的”（输入已被清理），那么您可以跳过会话对象。如果您在应用程序的某个地方从不安全的来源获取数据并将其放入 Session 对象中，那么您也必须检查它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T09:37:14.687

好吧，您只需要保护用户输入。所以你必须问自己的问题是：“这些数据是否来自用户输入？” 如果是这样，您必须使用 sql 参数。

在更大的范围内，考虑到您有单独的方法和类来执行数据访问，您应该为您提供给 sql 的每个文本参数使用 sql 参数。在这种情况下，sql 参数并不是真正需要的，因为如果您收到一个数字作为方法参数，那么它就不可能进行 sql 注入。

但是，当有疑问时使用 sql 参数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T02:55:08.353

会话变量存储在服务器的内存中。客户端上只存储了一个 cookie id。除非它们来自客户端，否则无需担心会话中的变量。很多时候，检查传递给数据库的所有变量以进行 sql 注入会更容易。

# c# - 服务器无法识别 HTTP Header SOAPAction 的值

> ID：352174
> 
> 赞同：46
> 
> 时间：2008-12-09T09:01:46.397
> 
> 标签：c#, javascript, web-services

```
 [SoapRpcMethod(Action = "http://cyberindigo/TempWebService/InsertXML",
    RequestNamespace = "http://cyberindigo/TempWebService/Request",
    RequestElementName = "InsertXMLRequest",
    ResponseNamespace = "http://cyberindigo/TempWebService/Response",
    ResponseElementName = "InsertXMLResponse",
    Use = System.Web.Services.Description.SoapBindingUse.Literal)]

    [WebMethod]
    public string InsertXML(string Jobs)
    {
        return "Hi";
    } 
```

当我使用 XMLHttpRequest 访问它时出现问题，它给出以下错误服务器没有识别 HTTP Header SOAPAction 的值：[http://Cyber​​indigo/TempWebService/InsertXML](http://Cyberindigo/TempWebService/InsertXML)

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2010-01-21T12:24:47.767

这篇文章下一部分的来源是：

> [http://bluebones.net/2003/07/server-did-not-recognize-http-header-soapaction/](http://bluebones.net/2003/07/server-did-not-recognize-http-header-soapaction/)

（因为 OP 不想给出归属，并感谢彼得）

请注意，贝克特是文本的原作者，而不是 OP。

* * *

在互联网上看不到任何地方，我可以找到这个错误的解释，我想我会分享我长期搜索这个错误的成果。

这意味着（至少在我的情况下）您正在使用 SOAP 访问 Web 服务并`SOAPAction`在 HTTP 请求中传递一个与服务所期望的不匹配的参数。

我陷入了困境，因为我们将 Web 服务从一台服务器移动到另一台服务器，因此我更改了调用 C# 文件中的“命名空间”（不要混淆 Web 服务命名空间和 .net 命名空间）以匹配新服务器。但是服务器并不关心它的实际网络现实，`http://yournamespace.com/blah`只关心你向它发送你所说的你在服务器上期望的东西。它不关心那里是否真的有任何东西。

所以基本上 web 服务被从`http://foo.com/servicename`to移动了，`http://bar.com/servicename`但是 web 服务的“命名空间”保持不变，`http://foo.com/servicename`因为没有人改变它。

而且只用了大约4个小时就可以解决！

如果您遇到类似的问题，但无法按照我在这里所说的方式工作，请随时通过 bakert+web@gmail.com 给我发邮件——我不希望我的四个小时在任何人身上！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-02-11T02:56:48.363

在调用 .asmx / wcf 网络服务时，请注意以下几点：

1.  命名空间区分大小写，SOAP 请求必须使用与声明 WebService 相同的命名空间发送。

例如对于如下声明的 WebService

```
[WebService(Namespace = "http://MyDomain.com/TestService")] 
public class FooClass : System.Web.Services.WebService 
{
   [WebMethod]   
    public bool Foo( string name)    
     {

      ...... 
     }

 } 
```

SOAP 请求在调用时必须为命名空间保持相同的大小写。有时我们会忽略区分大小写。

```
<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
  <soap:Body>
     <Foo xmlns="http://MyDomain.com/TestService">
     <name>string</name>      
     </Foo>
  </soap:Body> 
</soap:Envelope> 
```

2.  命名空间不必与服务的托管 url 相同。命名空间可以是任何字符串。

例如，上面的服务可能托管在[http://84.23.9.65/MyTestService](http://84.23.9.65/MyTestService)，但在从客户端调用 Web 服务时，命名空间应该与服务类所具有的相同，即[http://MyDomain.com/TestService](http://MyDomain.com/TestService)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-04-21T14:28:22.280

我同意 Sam 的观点，即 SOAP 定义与预期不符。这只是一个可能的解决方案，我必须自己手动解决这个错误：

我的问题是我更改了 Web 方法的名称，但没有更改元数据标记中的“MessageName”。

```
[WebMethod(MessageName = "foo")]
public string bar()
{

} 
```

它应该是

```
[WebMethod(MessageName = "foo")]
public string foo()
{

} 
```

希望对某人有所帮助

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-12-29T17:49:08.263

我决定在这里发布我自己的答案，因为我在这方面浪费了几个小时，我认为，尽管接受的答案非常好，并为我指明了正确的方向（是的，它得到了投票），但它是至少在我的情况下，不够详细，无法解释我的申请出了什么问题。

我在 OpenESB 2.2 中运行 BPEL 模块，我的复合应用程序的测试用例失败并出现以下错误：

```
Caused by: System.Web.Services.Protocols.SoapException: Server did not recognize the value of HTTP Header SOAPAction: . 
```

在做了一些研究之后，我注意到外部 WSDL 提供了解决此问题所需的所有线索，例如，我使用以下 Web 服务通过 Web 服务的编排来验证信用卡号： [http:// www.webservicex.net/CreditCard.asmx?WSDL](http://www.webservicex.net/CreditCard.asmx?WSDL)

如果您检查`<wsdl:operation`元素，您会看到它清楚地说明了`soapAction`该操作：

```
<wsdl:binding name="CCCheckerSoap" type="tns:CCCheckerSoap">
  <soap:binding transport="http://schemas.xmlsoap.org/soap/http"/>
  <wsdl:operation name="ValidateCardNumber">
    <soap:operation soapAction="http://www.webservicex.net/ValidateCardNumber" style="document"/>
    <wsdl:input>
  <soap:body use="literal"/>
</wsdl:input>
... 
```

但是，一旦您创建复合应用程序并使用调用此外部 WSDL 服务的 BPEL 构建项目，出于某种原因（错误？），复合应用程序服务组件 (CASA) 绑定的 XML 将使用空`soapAction`参数生成：

```
<binding name="casaBinding1" type="ns:CCCheckerSoap">
        <soap:binding style="document" transport="http://schemas.xmlsoap.org/soap/http"/>
        <operation name="ValidateCardNumber">
            <soap:operation soapAction="" style="document"/>
            <input>
                <soap:body use="literal"/>
            </input> 
```

一旦您将正确的soapAction (http://www.webservicex.net/ValidateCardNumber) 复制到此参数中，应用程序的测试用例将正确并返回预期的Soap 响应。

```
<soap:operation soapAction="http://www.webservicex.net/ValidateCardNumber" style="document"/> 
```

因此，我决定根据这篇博文中的信息记录一个更具体的解决方案：http: [//bluebones.net/2003/07/server-did-not-recognize-http-header-soapaction/](http://bluebones.net/2003/07/server-did-not-recognize-http-header-soapaction/)。

> 这意味着（至少在我的情况下）您正在使用 SOAP 访问 Web 服务，并**在 HTTP 请求中传递了与服务所期望的不匹配的 SOAPAction 参数**。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-07-13T04:12:28.370

我有同样的问题，经过一些检查后修复：

**<< 目标 WebService 存在，但调用的方法不是 eXXXists。>>**

> 我的本地服务包含方法，但目标服务器（连接服务器）不包含指定的调用方法。

**再次检查您的程序方案...**

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-05-23T16:39:04.390

只是为了帮助解决这个问题，经过一个下午的调试，问题是 Web 服务是使用框架 4.5 开发的，并且来自 android 的调用必须使用 SoapEnvelope.VER12 而不是 SoapEnvelope.VER11

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-09T09:46:12.237

我有类似的问题。为了调试问题，我运行了[Wireshark](http://www.wireshark.org/)并捕获了我的代码生成的请求。然后我使用[XML Spy 试用版](http://www.altova.com/products/xmlspy/xml_editor.html)创建了一个 SOAP 请求（假设您有 WSDL）并比较了这两者。

这应该给你一个提示出了什么问题。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-04-24T22:50:18.410

我遇到了同样的问题，但对我来说，解决方案是我指向了错误的 Web 服务。我已经正确更新了网络参考。但是我们将服务的 URl 存储在加密文件中，并且我没有使用正确的加密服务更新文件。

但是所有这些建议确实帮助我意识到去哪里进行调试。

谢谢！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-01-21T09:48:04.903

我们已经重命名了一些 web 服务项目的命名空间，并忘记使用重命名项目的命名空间更新网站 httphandlers 配置部分。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-01-25T16:20:21.300

在我的 Web 服务中从“tempuri”更改命名空间后，我遇到了同样的问题。

您必须在使用上述服务的项目中更新您的服务参考，以便它可以获取最新的 SOAP 定义。

或者至少这对我有用。:)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-08-16T19:36:11.337

我遇到了同样的错误，我可以通过删除“Web Reference”并添加“Service Reference”来解决它

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-05-01T13:50:19.117

我的错误由 John Saunders 先生的回答修复：[http ://forums.asp.net/post/2906487.aspx](http://forums.asp.net/post/2906487.aspx)

简而言之：ws **.asmx.cs**的命名空间与 ws **.wsdl**文件的区别。

```
1) [WebService(Namespace = "http://tempuri.org/")] 
```

后来 web 服务命名空间更改为：

```
2) [WebService(Namespace = "http://newvalue.com/")] 
```

所以我们在应用程序中引用了 (1)，而 Web 服务现在是 (2)。

使它们等于解决您的问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-06-30T16:29:07.820

当我尝试调用不存在的方法时出现此错误。它只存在于我们网络服务的较新版本中。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-02-18T23:18:36.020

我有一个类似的问题，同样的错误信息：

`System.Web.Services.Protocols.SoapException:`服务器无法识别 HTTP Header 的值`SOAPAction`：

我们在 Web 服务调用中使用动态 URL。我们有一个中央配置服务器来管理所有 Web 服务调用的位置，以便我们的代码可以在 DEV 中运行、测试或实时运行，而无需重新编译。在我们的配置服务器中，测试环境的特定 Web 服务调用的 URL 不正确。Web 服务调用被发送到错误的服务器和错误的 Web 服务。

因此，此错误可能只是 Web 服务请求与所调用的 Web 服务不匹配的结果。

在 Web 应用服务器上运行 fiddler 后，才发现实际调用的是错误的 Web 服务。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-01-11T09:45:00.500

我必须整理我的服务参考的大小写，删除参考并重新添加它们以解决此问题。我不确定这些步骤是否迷信，但问题消失了。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-05-23T17:32:45.430

问题出在服务中的 System.Web.Services.Protocols.SoapDocumentMethodAttribute 中。请检查一下。它可能会改变。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-06-15T04:47:12.777

我发现我的 Web 引用已过期，并且代码正在调用已删除的 Web 服务。

# sql - SQLServer：如何对按外键依赖性排序的表名进行排序

> ID：352176
> 
> 赞同：21
> 
> 时间：2008-12-09T09:03:38.140
> 
> 标签：sql, sql-server, database

下面的 SQL 根据它们的关系分隔表。问题在于按 3000 系列排序的表。作为外键一部分并使用外键的表。任何人都最好有一些聪明的递归 CTE 或存储过程来进行必要的排序？连接到数据库的程序不被视为解决方案。

编辑：我根据第一个解决方案在“答案”中发布了答案 免费的“正确答案”可供任何人重新发布我自己的“正确”答案！

```
WITH 
 AllTables(TableName) AS
 (
 SELECT OBJECT_SCHEMA_NAME(so.id) +'.'+ OBJECT_NAME(so.id) 
 FROM dbo.sysobjects so 
 INNER JOIN sys.all_columns ac ON 
  so.ID = ac.object_id
 WHERE
  so.type = 'U'
 AND
  ac.is_rowguidcol = 1
 ),

  Relationships(ReferenceTableName, ReferenceColumnName, TableName, ColumnName)  AS
  (
  SELECT  
    OBJECT_SCHEMA_NAME (fkey.referenced_object_id) + '.' +  
    OBJECT_NAME (fkey.referenced_object_id) AS ReferenceTableName 
    ,COL_NAME(fcol.referenced_object_id, 
              fcol.referenced_column_id) AS ReferenceColumnName 
    ,OBJECT_SCHEMA_NAME (fkey.parent_object_id) + '.' +  
    OBJECT_NAME(fkey.parent_object_id) AS TableName 
    ,COL_NAME(fcol.parent_object_id, fcol.parent_column_id) AS ColumnName 
  FROM sys.foreign_keys AS fkey 
    INNER JOIN sys.foreign_key_columns AS fcol ON 
               fkey.OBJECT_ID = fcol.constraint_object_id 
  ),

 NotReferencedOrReferencing(TableName) AS
 (
 SELECT TableName FROM AllTables
 EXCEPT
 SELECT TableName FROM Relationships
 EXCEPT
 SELECT ReferenceTableName FROM Relationships
 ),

 OnlyReferenced(Tablename) AS
 (
 SELECT ReferenceTableName FROM Relationships
 EXCEPT
 SELECT TableName FROM Relationships
 ),
-- These need to be sorted based on theire internal relationships
 ReferencedAndReferencing(TableName, ReferenceTableName) AS
 (
 SELECT r1.Tablename, r2.ReferenceTableName FROM Relationships r1 
 INNER JOIN Relationships r2
 ON r1.TableName = r2.ReferenceTableName   
 ),

 OnlyReferencing(TableName) AS
 (
 SELECT Tablename FROM Relationships
 EXCEPT
 SELECT ReferenceTablename FROM Relationships
 )
SELECT TableName, 1000 AS Sorting FROM NotReferencedOrReferencing
UNION
SELECT TableName, 2000 AS Sorting FROM OnlyReferenced 
UNION
SELECT TableName, 3000 AS Sorting FROM ReferencedAndReferencing
UNION
SELECT TableName, 4000 AS Sorting FROM OnlyReferencing
ORDER BY Sorting 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-12-08T14:25:37.670

我的版本进行了适度调整：这是 SQL-2005+，适用于没有“rowguidcol”的数据库：

```
WITH TablesCTE(SchemaName, TableName, TableID, Ordinal) AS
(
    SELECT
        OBJECT_SCHEMA_NAME(so.object_id) AS SchemaName,
        OBJECT_NAME(so.object_id) AS TableName,
        so.object_id AS TableID,
        0 AS Ordinal
    FROM
        sys.objects AS so
    WHERE
        so.type = 'U'
        AND so.is_ms_Shipped = 0
    UNION ALL
    SELECT
        OBJECT_SCHEMA_NAME(so.object_id) AS SchemaName,
        OBJECT_NAME(so.object_id) AS TableName,
        so.object_id AS TableID,
        tt.Ordinal + 1 AS Ordinal
    FROM
        sys.objects AS so
    INNER JOIN sys.foreign_keys AS f
        ON f.parent_object_id = so.object_id
        AND f.parent_object_id != f.referenced_object_id
    INNER JOIN TablesCTE AS tt
        ON f.referenced_object_id = tt.TableID
    WHERE
        so.type = 'U'
        AND so.is_ms_Shipped = 0
)

SELECT DISTINCT
        t.Ordinal,
        t.SchemaName,
        t.TableName,
        t.TableID
    FROM
        TablesCTE AS t
    INNER JOIN
        (
            SELECT
                itt.SchemaName as SchemaName,
                itt.TableName as TableName,
                itt.TableID as TableID,
                Max(itt.Ordinal) as Ordinal
            FROM
                TablesCTE AS itt
            GROUP BY
                itt.SchemaName,
                itt.TableName,
                itt.TableID
        ) AS tt
        ON t.TableID = tt.TableID
        AND t.Ordinal = tt.Ordinal
ORDER BY
    t.Ordinal,
    t.TableName 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-11T09:55:38.283

感谢您提供有效的解决方案 NXC。您让我走上了使用递归 CTE 解决问题的正确轨道。

```
WITH 
  TablesCTE(TableName, TableID, Ordinal) AS
  (
  SELECT 
    OBJECT_SCHEMA_NAME(so.id) +'.'+ OBJECT_NAME(so.id) AS TableName,
    so.id AS TableID,
    0 AS Ordinal
  FROM dbo.sysobjects so INNER JOIN sys.all_columns ac ON so.ID = ac.object_id
  WHERE
    so.type = 'U'
  AND
    ac.is_rowguidcol = 1
  UNION ALL
  SELECT 
    OBJECT_SCHEMA_NAME(so.id) +'.'+ OBJECT_NAME(so.id) AS TableName,
    so.id AS TableID,
    tt.Ordinal + 1 AS Ordinal
  FROM 
    dbo.sysobjects so 
    INNER JOIN sys.all_columns ac ON so.ID = ac.object_id
    INNER JOIN sys.foreign_keys f 
      ON (f.parent_object_id = so.id AND f.parent_object_id != f.referenced_object_id)
    INNER JOIN TablesCTE tt ON f.referenced_object_id = tt.TableID
  WHERE
    so.type = 'U'
  AND
    ac.is_rowguidcol = 1
)  
SELECT DISTINCT 
  t.Ordinal,
  t.TableName
  FROM TablesCTE t
  INNER JOIN 
    (
    SELECT 
      TableName as TableName,
      Max (Ordinal) as Ordinal
    FROM TablesCTE
    GROUP BY TableName
    ) tt ON (t.TableName = tt.TableName  AND t.Ordinal = tt.Ordinal)
ORDER BY t.Ordinal, t.TableName 
```

对于那些想知道这有什么用的人：我将使用它来安全地清空数据库，而不会违反任何外键关系。（通过按降序截断）我还可以通过按升序填充表格来安全地用另一个数据库中的数据填充表格。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T10:06:44.970

您可以使用迭代算法，它可能不如 CTE 复杂。这是一个根据深度排序的示例：

```
declare @level int      -- Current depth
       ,@count int      

-- Step 1: Start with tables that have no FK dependencies
--  
if object_id ('tempdb..#Tables') is not null
    drop table #Tables

select s.name + '.' + t.name  as TableName
      ,t.object_id            as TableID
      ,0                      as Ordinal
  into #Tables
  from sys.tables t
  join sys.schemas s
    on t.schema_id = s.schema_id
 where not exists
       (select 1
          from sys.foreign_keys f
         where f.parent_object_id = t.object_id)

set @count = @@rowcount         
set @level = 0

-- Step 2: For a given depth this finds tables joined to 
-- tables at this given depth.  A table can live at multiple 
-- depths if it has more than one join path into it, so we 
-- filter these out in step 3 at the end.
--
while @count > 0 begin

    insert #Tables (
           TableName
          ,TableID
          ,Ordinal
    ) 
    select s.name + '.' + t.name  as TableName
          ,t.object_id            as TableID
          ,@level + 1             as Ordinal
      from sys.tables t
      join sys.schemas s
        on s.schema_id = t.schema_id
     where exists
           (select 1
              from sys.foreign_keys f
              join #Tables tt
                on f.referenced_object_id = tt.TableID
               and tt.Ordinal = @level
               and f.parent_object_id = t.object_id
               and f.parent_object_id != f.referenced_object_id)
                   -- The last line ignores self-joins.  You'll
                   -- need to deal with these separately

   set @count = @@rowcount
   set @level = @level + 1
end

-- Step 3: This filters out the maximum depth an object occurs at
-- and displays the deepest first.
--
select t.Ordinal
      ,t.TableID
      ,t.TableName
  from #Tables t
  join (select TableName     as TableName
              ,Max (Ordinal) as Ordinal
          from #Tables
         group by TableName) tt
    on t.TableName = tt.TableName
   and t.Ordinal = tt.Ordinal
 order by t.Ordinal desc 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-22T16:09:59.413

这会导致自引用表出现问题。您需要手动排除任何指向自引用表的外键。

```
INNER JOIN sys.foreign_keys  f 
  ON (f.parent_object_id = so.id AND f.parent_object_id != f.referenced_object_id)

  /* Manually exclude self-referencing tables - they cause recursion problems*/      
    and f.object_id  not in /*Below are IDs of foreign keys*/
        ( 1847729685,   
        1863729742,     
        1879729799      
        )   
INNER JOIN TablesCTE tt 
```

# c# - 枚举是否仅命名为整数、类型或两者都不是？

> ID：352177
> 
> 赞同：9
> 
> 时间：2008-12-09T09:03:41.730
> 
> 标签：c#, enums

在 C# 中使用枚举很有趣。取一个为存储您之前定义的 Enum 而创建的通用列表，并在其中添加一些项目。使用 foreach 进行迭代，或者`GetEnumerator<T>()`指定其他一些枚举然后是原始枚举，看看会发生什么。我期待 InvalidCastException 或类似的东西，但它非常有效:)。

为了演示，让我们使用一个简单的控制台应用程序并在那里创建两个枚举：汽车和动物：

```
 public enum Cars
    {
        Honda = 0,
        Toyota = 1,
        Chevrolet = 2
    }
    public enum Animals
    {
        Dog = 0,
        Cat = 1,
        Tiger = 2
    } 
```

并在 main 方法中执行此操作：

```
 public static void Main()
    {
        List<Cars> cars = new List<Cars>();
        List<Animals> animals = new List<Animals>();
        cars.Add(Cars.Chevrolet);
        cars.Add(Cars.Honda);
        cars.Add(Cars.Toyota);

        foreach (Animals isItACar in cars)
        {
            Console.WriteLine(isItACar.ToString());
        }
        Console.ReadLine();
    } 
```

它将在控制台中打印：

> ```
> Tiger
> Dog
> Cat 
> ```

为什么会这样？我的第一个猜测是，枚举本身并不是一个类型，它只是和 int，但事实并非如此：如果我们写：

`Console.WriteLine(Animals.Tiger.GetType().FullName);` 我们将打印出他的全名！那么为什么会这样呢？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-09T09:21:59.790

枚举类型是不同的，但是你被 foreach 中的隐式转换弄糊涂了。

让我们稍微重写一下你的循环：

```
public static void Main()
{
    List<Cars> cars = new List<Cars>();
    List<Animals> animals = new List<Animals>();
    cars.Add(Cars.Chevrolet);
    cars.Add(Cars.Honda);
    cars.Add(Cars.Toyota);

    foreach (Cars value in cars)
    {
        // This time the cast is explicit.
        Animals isItACar = (Animals) value;
        Console.WriteLine(isItACar.ToString());
    }
    Console.ReadLine();
} 
```

现在结果让你吃惊吗？希望不会，除非您*可以*从一个枚举转换到另一个枚举。这只是您的原始代码所做的更明确的版本。

我认为，在每个`foreach`循环中都有一个隐含的强制转换（即使它通常是无操作的）这一事实是大多数开发人员会感到困惑的一点。

从 C# 3.0 规范的第 8.8.4 节：

> 上述步骤，如果成功，则明确生成集合类型 C、枚举类型 E 和元素类型 T。形式为 foreach 语句

```
foreach (V v in x)  embedded-statement 
```

> 然后扩展为：

```
{
    E e = ((C)(x)).GetEnumerator();
    try {
        V v;
        while (e.MoveNext()) {
            v = (V)(T)e.Current;
            embedded-statement
        }
    }
    finally {
        ... // Dispose e
    }
} 
```

枚举转换本身在第 6.2.2 节中介绍：

> 显式枚举转换为：

*   从 sbyte、byte、short、ushort、int、uint、long、ulong、char、float、double 或 decimal 到任何枚举类型。
*   从任何枚举类型到 sbyte、byte、short、ushort、int、uint、long、ulong、char、float、double 或 decimal。
*   从任何枚举类型到任何其他枚举类型。

> 通过将任何参与的枚举类型视为该枚举类型的基础类型，然后在结果类型之间执行隐式或显式数字转换来处理两种类型之间的显式枚举转换。例如，给定一个具有 int 基础类型的枚举类型 E，从 E 到 byte 的转换被处理为从 int 到 byte 的显式数字转换（第 6.2.1 节），从 byte 到 E 的转换被处理为从字节到整数的隐式数字转换（第 6.1.2 节）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T09:13:59.383

从概念上讲，枚举是具有字符串表示和数字的静态类型值。当您调用`ToString()`枚举时，它将返回字符串表示形式。当你调用`GetType()`一个枚举时，你会得到静态枚举类型。如果将枚举转换为`int`，您将获得枚举的整数值。

枚举应该是强类型的，但有一些事情你需要注意，比如任何整数都可以转换为任何枚举，即使它没有相应的声明（在这种情况下，字符串表示将与数字相同）。

在 CLR 中，枚举（如`bool`s）仅被视为`int`s，但如果您调用 GetType() 或 GetString()，它会调用执行上述操作的版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T16:36:02.393

您还可以从特定类型派生枚举。

```
public enum Cats : byte { ... }
public enum Dogs : int { ... } 
```

# django - Django 动态 OR 查询

> ID：352178
> 
> 赞同：4
> 
> 时间：2008-12-09T09:03:43.197
> 
> 标签：django, django-models

我有一个`MultipleChoiceField`持有汽车制造商的表格。我想将我的汽车数据库过滤到已检查的品牌，但这会导致问题。如何`Q(make=...)`动态获取所有语句？

我如何开始：`['value1', 'value2', ...]`

我想如何结束：`Q(col='value1') | Q(col='value2') | ...`

我还有其他几种方法。我已经尝试为每个 make 附加查询集并以相反的方式进行（执行多个排除），但它们都非常慢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T09:21:24.830

你有没有试过：`Model.objects.filter(make__in=list_of_makes)`？

list_of_makes 是由`MultipleChoiceField`

请参阅有关运算符[的查询集参考](http://docs.djangoproject.com/en/dev/ref/models/querysets/#in)`__in`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T09:52:23.377

#django 中提供了另一种方法：

```
reduce(lambda x,y: x | y, [Q1, Q2, Q3, ...]) 
```

[Ber 的方法](https://stackoverflow.com/questions/352178/django-dynamic-or-queries#352208)非常适合这种情况，但如果您需要过滤动态列，映射看起来是下一个最干净的方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-15T23:19:24.107

我尝试了 Oli 的答案，但它没有用，即使使用 reduce() 因为它似乎 Q 对象不接受字典作为参数：

这是我的工作方式：

```
# These are the fields I want to search with an OR clause
search_fields = ['title__icontains', 'publisher__name__icontains', 'authors__name__icontains']

search = 'search string'
clauses = []
for item in search_fields:
    clauses.append(queryset.filter(**{item: search}))
    queryset  = reduce(lambda x, y: x | y, clauses).distinct() 
```

检查性能问题，因为我只能用一个小数据集进行测试。

# java - GroovyScriptEngine 在 Web 容器中定位资源

> ID：352183
> 
> 赞同：1
> 
> 时间：2008-12-09T09:05:49.697
> 
> 标签：java, groovy

我正在研究在现有 Web 应用程序中使用 groovy 脚本，并且正忙于设置和配置`GroovyScriptEngine`.

管理容器中的脚本的“最佳实践”是什么？

1.  我应该将它们存储在数据库中，然后通过 URL 将它们提供给引擎吗？
2.  我可以将它们存储在服务器上的文件系统中 - 但是这在 Tomcat/JBoss 中似乎有问题？

欢迎任何建议:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T10:03:00.080

您可以使用自己的 ResourceConnector 实现来实例化 GroovyScriptEngine。这可以使用 java.lang.Class.getResource 来获取您嵌入到 war 文件中的脚本。

如果您需要能够动态更改脚本，那么数据库可能是一个好主意。

# algorithm - 懒惰地生成排列

> ID：352203
> 
> 赞同：88
> 
> 时间：2008-12-09T09:19:33.850
> 
> 标签：algorithm, functional-programming, clojure, combinatorics

我正在寻找一种算法来生成一组排列，这样我就可以在 Clojure 中制作一个惰性列表。即我想遍历一个排列列表，其中每个排列在我请求之前不会计算，并且所有排列不必一次存储在内存中。

或者，我正在寻找一种算法，在给定某个集合的情况下，它将返回该集合的“下一个”排列，这样在它自己的输出上重复调用该函数将循环遍历原始集合的所有排列，在一些顺序（顺序是什么无关紧要）。

有这样的算法吗？我见过的大多数排列生成算法都倾向于一次生成它们（通常是递归的），这不能扩展到非常大的集合。Clojure（或其他函数式语言）中的实现会有所帮助，但我可以从伪代码中弄清楚。

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2008-12-09T15:57:52.470

是的，有*一个*“下一个排列”算法，它也很简单。C++ 标准模板库 (STL) 甚至有一个名为`next_permutation`.

该算法实际上找到了*下一个*排列——按字典顺序排列的下一个排列。这个想法是这样的：假设给你一个序列，比如“32541”。下一个排列是什么？

如果你仔细想想，你会发现它是“34125”。你的想法可能是这样的：在“32541”中，

*   没有办法保持“32”固定并在“541”部分找到稍后的排列，因为该排列已经是 5,4 和 1 的最后一个排列——它按降序排序。
*   所以你必须把“2”改成更大的数字——事实上，改成比“541”部分大的最小数字，即4。
*   现在，一旦您决定排列将从“34”开始，其余数字应该按递增顺序排列，因此答案是“34125”。

该算法将精确地实现该推理：

1.  找到按降序排列的最长的“尾巴”。（“541”部分。）
2.  将尾部前面的数字（“2”）更改为比尾部大的最小数字（4）。
3.  按升序对尾部进行排序。

只要前一个元素不小于当前元素，您就可以通过从末尾开始并向后移动来有效地执行 (1.)。您可以通过将“4”与“2”交换来执行 (2.)，因此您将拥有“34521”。一旦这样做，您可以避免对 (3.) 使用排序算法，因为尾部过去，现在仍然（想想这个），按降序排序，所以只需要颠倒一下。

C++ 代码正是这样做的（查看`/usr/include/c++/4.0.0/bits/stl_algo.h`系统中的源代码，或查看[这篇文章](http://marknelson.us/2002/03/01/next-permutation)）；将它翻译成您的语言应该很简单：[如果您不熟悉 C++ 迭代器，请将“BidirectionalIterator”读作“指针”。`false`如果没有下一个排列，则代码返回，即我们已经按降序排列。]

```
template <class BidirectionalIterator>
bool next_permutation(BidirectionalIterator first,
                      BidirectionalIterator last) {
    if (first == last) return false;
    BidirectionalIterator i = first;
    ++i;
    if (i == last) return false;
    i = last;
    --i;
    for(;;) {
        BidirectionalIterator ii = i--;
        if (*i <*ii) {
            BidirectionalIterator j = last;
            while (!(*i <*--j));
            iter_swap(i, j);
            reverse(ii, last);
            return true;
        }
        if (i == first) {
            reverse(first, last);
            return false;
        }
    }
} 
```

看起来每个排列可能需要 O(n) 时间，但如果你仔细考虑一下，你可以证明所有排列总共需要 O(n!) 时间，所以只有 O(1) --恒定时间 - 每个排列。

好消息是，即使您有一个包含重复元素的序列，该算法也可以工作：例如，“232254421”，它会发现尾部为“54421”，交换“2”和“4”（所以“232454221” )，反转其余部分，给出“232412245”，这是下一个排列。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-12-12T13:22:27.920

假设我们正在讨论置换值的字典顺序，您可以使用两种通用方法：

1.  将元素的一个排列转换为下一个排列（如 ShreevatsaR 发布的），或
2.  直接计算`n`th 排列，同时`n`从 0 向上计数。

对于那些（像我一样；-）不说 C++ 作为本地人的人，方法 1 可以从以下伪代码实现，假设“左侧”索引为零的数组从零开始索引（替换一些其他结构，例如列表，“留作练习”;-)：

```
1\. scan the array from right-to-left (indices descending from N-1 to 0)
1.1\. if the current element is less than its right-hand neighbor,
     call the current element the pivot,
     and stop scanning
1.2\. if the left end is reached without finding a pivot,
     reverse the array and return
     (the permutation was the lexicographically last, so its time to start over)
2\. scan the array from right-to-left again,
   to find the rightmost element larger than the pivot
   (call that one the successor)
3\. swap the pivot and the successor
4\. reverse the portion of the array to the right of where the pivot was found
5\. return 
```

下面是一个从 CADB 的当前排列开始的示例：

```
1\. scanning from the right finds A as the pivot in position 1
2\. scanning again finds B as the successor in position 3
3\. swapping pivot and successor gives CBDA
4\. reversing everything following position 1 (i.e. positions 2..3) gives CBAD
5\. CBAD is the next permutation after CADB 
```

对于第二种方法（直接计算th 排列），请记住元素`n`存在`N!`排列。`N`因此，如果要排列`N`元素，则第一个`(N-1)!`排列必须从最小的元素开始，下一个`(N-1)!`排列必须从第二小的元素开始，依此类推。这导致了以下递归方法（再次在伪代码中，从 0 开始对排列和位置进行编号）：

```
To find permutation x of array A, where A has N elements:
0\. if A has one element, return it
1\. set p to ( x / (N-1)! ) mod N
2\. the desired permutation will be A[p] followed by
   permutation ( x mod (N-1)! )
   of the elements remaining in A after position p is removed 
```

因此，例如，ABCD 的第 13 次排列如下所示：

```
perm 13 of ABCD: {p = (13 / 3!) mod 4 = (13 / 6) mod 4 = 2; ABCD[2] = C}
C followed by perm 1 of ABD {because 13 mod 3! = 13 mod 6 = 1}
  perm 1 of ABD: {p = (1 / 2!) mod 3 = (1 / 2) mod 2 = 0; ABD[0] = A}
  A followed by perm 1 of BD {because 1 mod 2! = 1 mod 2 = 1}
    perm 1 of BD: {p = (1 / 1!) mod 2 = (1 / 1) mod 2 = 1; BD[1] = D}
    D followed by perm 0 of B {because 1 mod 1! = 1 mod 1 = 0}
      B (because there's only one element)
    DB
  ADB
CADB 
```

顺便说一句，元素的“删除”可以由一个并行的布尔数组表示，它指示哪些元素仍然可用，因此没有必要在每次递归调用时创建一个新数组。

因此，要遍历 ABCD 的排列，只需从 0 数到 23 (4!-1) 并直接计算相应的排列。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-09T09:36:56.217

您应该查看 wikipeda 上的[Permutations 文章](http://en.wikipedia.org/wiki/Permutation#Numbering_permutations)。此外，还有[阶乘](http://en.wikipedia.org/wiki/Factoradic)数的概念。

无论如何，数学问题是相当困难的。

在`C#`您可以使用`iterator`, 并使用 停止排列算法`yield`。这样做的问题是你不能来回走动，或者使用`index`.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T18:17:44.550

更多置换算法的例子来生成它们。

来源：[http ://www.ddj.com/architect/201200326](http://www.ddj.com/architect/201200326)

1.  使用 Fike 算法，这是已知最快的算法之一。
2.  使用 Algo 到 Lexographic 顺序。
3.  使用非词典，但运行速度比第 2 项快。

1.

```
 PROGRAM TestFikePerm;
CONST marksize = 5;
VAR
    marks : ARRAY [1..marksize] OF INTEGER;
    ii : INTEGER;
    permcount : INTEGER;

PROCEDURE WriteArray;
VAR i : INTEGER;
BEGIN
FOR i := 1 TO marksize
DO Write ;
WriteLn;
permcount := permcount + 1;
END;

PROCEDURE FikePerm ;
{Outputs permutations in nonlexicographic order.  This is Fike.s algorithm}
{ with tuning by J.S. Rohl.  The array marks[1..marksizn] is global.  The   }
{ procedure WriteArray is global and displays the results.  This must be}
{ evoked with FikePerm(2) in the calling procedure.}
VAR
    dn, dk, temp : INTEGER;
BEGIN
IF 
THEN BEGIN { swap the pair }
    WriteArray;
    temp :=marks[marksize];
    FOR dn :=  DOWNTO 1
    DO BEGIN
        marks[marksize] := marks[dn];
        marks [dn] := temp;
        WriteArray;
        marks[dn] := marks[marksize]
        END;
    marks[marksize] := temp;
    END {of bottom level sequence }
ELSE BEGIN
    FikePerm;
    temp := marks[k];
    FOR dk :=  DOWNTO 1
    DO BEGIN
        marks[k] := marks[dk];
        marks[dk][ := temp;
        FikePerm;
        marks[dk] := marks[k];
        END; { of loop on dk }
    marks[k] := temp;l
    END { of sequence for other levels }
END; { of FikePerm procedure }

BEGIN { Main }
FOR ii := 1 TO marksize
DO marks[ii] := ii;
permcount := 0;
WriteLn ;
WrieLn;
FikePerm ; { It always starts with 2 }
WriteLn ;
ReadLn;
END. 
```

2.

```
 PROGRAM TestLexPerms;
CONST marksize = 5;
VAR
    marks : ARRAY [1..marksize] OF INTEGER;
    ii : INTEGER;
    permcount : INTEGER;

PROCEDURE WriteArray;
VAR i : INTEGER;
BEGIN
FOR i := 1 TO marksize
DO Write ;
permcount := permcount + 1;
WriteLn;
END;

PROCEDURE LexPerm ;
{ Outputs permutations in lexicographic order.  The array marks is global   }
{ and has n or fewer marks.  The procedure WriteArray () is global and  }
{ displays the results.                             }
VAR 
    work : INTEGER:
    mp, hlen, i : INTEGER;
BEGIN
IF 
THEN BEGIN { Swap the pair }
    work := marks[1];
    marks[1] := marks[2];
    marks[2] := work;
    WriteArray ;
    END
ELSE BEGIN
    FOR mp :=  DOWNTO 1
    DO BEGIN
        LexPerm<>;
        hlen :=  DIV 2;
        FOR i := 1 TO hlen
        DO BEGIN { Another swap }
            work := marks[i];
            marks[i] := marks[n - i];
            marks[n - i] := work
            END;
        work := marks[n]; { More swapping }
        marks[n[ := marks[mp];
        marks[mp] := work;
        WriteArray;
        END;
    LexPerm<>
    END;
END;

BEGIN { Main }
FOR ii := 1 TO marksize
DO marks[ii] := ii;
permcount := 1; { The starting position is permutation }
WriteLn <   Starting position:  >;
WriteLn
LexPerm ;
WriteLn <   PermCount is   , permcount>;
ReadLn;
END. 
```

3.

```
 PROGRAM TestAllPerms;
CONST marksize = 5;
VAR
    marks : ARRAY [1..marksize] of INTEGER;
    ii : INTEGER;
    permcount : INTEGER;

PROCEDURE WriteArray;
VAR i : INTEGER;
BEGIN
FOR i := 1 TO marksize
DO Write ;
WriteLn;
permcount := permcount + 1;
END;

PROCEDURE AllPerm (n : INTEGER);
{ Outputs permutations in nonlexicographic order. The array marks is    }
{ global and has n or few marks.  The procedure WriteArray is global and    }
{ displays the results.                             }
VAR
    work : INTEGER;
    mp, swaptemp : INTEGER;
BEGIN
IF 
THEN BEGIN { Swap the pair }
    work := marks[1];
    marks[1] := marks[2];
    marks[2] := work;
    WriteArray;
    END
ELSE BEGIN
    FOR mp :=  DOWNTO 1
    DO BEGIN
        ALLPerm<< n - 1>>;
        IF > 
        THEN swaptemp := 1
        ELSE swaptemp := mp;
        work := marks[n];
        marks[n] := marks[swaptemp};
        marks[swaptemp} := work;
        WriteArray;
    AllPerm< n-1 >;
    END;
END;

BEGIN { Main }
FOR ii := 1 TO marksize
DO marks[ii] := ii
permcount :=1;
WriteLn < Starting position;   >;
WriteLn;
Allperm < marksize>;
WriteLn < Perm count is  , permcount>;
ReadLn;
END. 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T23:24:46.950

clojure.contrib.lazy_seqs 中的 permutations 函数已经声称可以做到这一点。

# c# - Compact Framework - OpenNetCf.Net FTP 示例？

> ID：352214
> 
> 赞同：5
> 
> 时间：2008-12-09T09:23:32.203
> 
> 标签：c#, compact-framework, ftp, windows-mobile-5.0, opennetcf

我正在尝试让 OpenNetCF.Net FTP 组件与我的 PDA 应用程序一起使用。除了连接到服务器之外，我正在努力让它做更多的事情，并想知道是否有人知道我可以用来学习如何使用它的任何示例代码？

我需要能够下载和上传文件，以及确定我希望下载的任何文件的下载大小。

提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T13:09:13.637

我不喜欢 OpenNETCF.Net.FTP 命名空间中的类（智能设备框架中的类）。它们像完整的框架版本一样基于流（这就是我们这样做的原因），但我发现用法令人困惑（尽管任何桌面 FTP 示例都应该作为基础）。我从 RFC 编写了一[组完整的 FTP 类](http://ftp.codeplex.com/)，但我发现在 OpenNETCF 社区论坛中使用了一个更直观的对象模型。带有完整的源代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T10:00:59.227

这看起来像答案：

[http://community.opennetcf.com/competition/folders/opennetcfnetftp/entry64583.aspx](http://community.opennetcf.com/competition/folders/opennetcfnetftp/entry64583.aspx)

# .net - 如何在 .NET 中创建 IE 附加组件？

> ID：352217
> 
> 赞同：1
> 
> 时间：2008-12-09T09:24:37.677
> 
> 标签：.net, internet-explorer, add-on

如果有人可能知道带有基本示例的博客帖子，那将有很大帮助。

谷歌搜索给我的主要是 add-in-express.com 的链接。

蒂亚

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T09:31:53.137

你可以检查这个网址：

[http://www.codeproject.com/KB/shell/dotnetbandobjects.aspx](http://www.codeproject.com/KB/shell/dotnetbandobjects.aspx)

它涉及为 Windows 资源管理器制作扩展，但我知道对于 IE，它的工作方式非常相似。

它是例如 qttabbar 使用的库：

[http://qttabbar.wikidot.com/](http://qttabbar.wikidot.com/)

（正如我所说，它可以适应 IE）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T09:38:33.373

简短的回答，不要。只是不要。

详细信息位于[创建 shell 扩展...](http://social.msdn.microsoft.com/forums/en-US/netfxbcl/thread/1428326d-7950-42b4-ad94-8e962124043e/)

由于 IE 和资源管理器是同一个组件，不同的皮肤，你会遇到同样的麻烦。

# logging - 企业库日志记录：TraceListeners 问题

> ID：352218
> 
> 赞同：0
> 
> 时间：2008-12-09T09:25:02.730
> 
> 标签：logging, enterprise-library, listeners

例如，是否可以将某些事件记录到 -> 事件日志，而将其他事件记录到 -> 文件跟踪侦听器，而其他事件仍然记录到 -> SQL 数据库。

我希望能够在某处进行配置，以便错误转到文本，详细信息转到 SQL，而警告转到（事件查看器和文本）。

这种事情可能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T09:36:36.000

[是](http://www.thejoyofcode.com/Log_Event_to_Listener_Routing_in_Enterprise_Library.aspx)的。

# asp.net - 回发或初始请求期间的 ASP.NET 事件顺序

> ID：352222
> 
> 赞同：3
> 
> 时间：2008-12-09T09:31:54.637
> 
> 标签：asp.net, postback, page-lifecycle

我能否从社区得到一些确认，我不会发疯，并且回发期间页面的生命周期实际上与最初请求页面时的顺序不同。

如果是这种情况，将不胜感激指向概述订单的参考/文章的指针。

（[页面生命周期图像](http://www.robincurry.org/blog/content/binary/o_aspNet_Page_LifeCycle.jpg)的回发等价物会很棒）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T09:36:08.653

行为略有不同，但顺序相同。在这方面，“回发”本质上是请求上的状态标志。

[http://msdn.microsoft.com/en-us/library/ms178472.aspx](http://msdn.microsoft.com/en-us/library/ms178472.aspx)

（漂亮的图像顺便说一句）

编辑：考虑一下，也许概述您的问题会有所帮助？提到回发让我觉得这可能是关于数据绑定？不过这篇文章应该会有所帮助。

# c# - 检查数组是否是多维的

> ID：352232
> 
> 赞同：3
> 
> 时间：2008-12-09T09:42:43.367
> 
> 标签：c#, arrays, interface, icollection

当我在我的类中实现 ICollection 接口时，我想实现 CopyTo 方法，如果数组是多维的，我必须抛出一个参数异常。这是什么意思？我的方法的负责人是这个

public void CopyTo(MyClass[] 数组，int arrayIndex)

我认为这些括号意味着给定的数组是一维的，但是当我从界面自动导入注释时，会出现注释，我必须检查多维性。有人可以向我解释吗？

亲切的问候

塞巴斯蒂亚

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T09:49:35.007

你可以看看Array.Rank？然而，T[] 是一维的。当您只知道“数组”时，您主要需要检查排名。这是因为实际方法是通过 Array 而不是 T[] 公开的。

所以简而言之 - 在这种情况下不要担心它;-p

# maintenance - 如何处理未使用的、有用的代码？

> ID：352234
> 
> 赞同：8
> 
> 时间：2008-12-09T09:43:34.300
> 
> 标签：maintenance

当您花一整天的时间让某个功能正常工作，但架构更改导致该功能不再被使用时，您会怎么做？但是您知道代码足够有用，以至于如果体系结构发生变化，该功能将再次有用吗？

在您签入之前删除该功能似乎是错误的，但是如果您签入它，它会再次占用空间作为未使用的功能。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-09T09:53:34.453

*作为答案，请考虑这个短篇故事：*

死代码收集器：带出你的死代码。

死代码的人：这是一个。

死密码收集器：那将是九便士。

死代码：我不是死代码。

死码收集者：什么？

死代码的人：什么都没有。有你的九便士。

死代码：我不是死代码。

死代码收集者：'呃，他说他不是死代码。

有死代码的人：是的，他是。

死代码：我不是。

死密码收集器：他不是。

死代码的人：嗯，他很快就会了，他病得很重。

死代码：我正在变得更好。

死代码的人：不，你不是，你马上就会变成死代码。

死密码收集者：嗯，我不能这样对待他。这是违反规定的。

死代码：我不想上车。

死代码的人：哦，别这么小。

死密码收集者：我不能带走他。

死代码：我感觉很好。

死代码的人：哦，帮我一个忙。

死代码收集器：我不能。

有死代码的人：嗯，你能多呆几分钟吗？他不会长。

死密码收集器：我答应过我会在罗宾逊家。他们今天已经输了九个。

死代码的人：嗯，你的下一轮是什么时候？

死代码收集器：星期四。

死代码：我想我会去散步。

死代码的人：你不是在愚弄任何人，你知道的。你没有什么可以做的吗？

死代码：我感到很高兴。我感到开心。

[死代码收集器偷偷地上下扫视街道，然后用他的 Ctrl-X 敲击使死代码静音]

死代码的人：啊，非常感谢。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-09T09:47:41.063

我在离线代码片段数据库中记录了所有有用的代码。

不要签入 -**集中存储库仅用于存放应用程序中使用的工作代码**。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-09T09:50:24.707

根据定义，未使用的代码没有用处。永远记住[YAGNI](http://en.wikipedia.org/wiki/You_Ain%27t_Gonna_Need_It)。在 99% 的情况下，您应该删除它，因为下次它*可能*有用时，再次执行它可能会更快（您只花了一天时间）。

在极少数情况下它很“酷”，您可以将其存储在片段数据库中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-09T09:48:20.470

我肯定会删除它。您可以将它放在项目成员可以看到但从项目中取出的特殊位置。当开发人员无法弄清楚为什么不调用特定函数时，它会使维护变得困难。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-09T10:02:48.287

在这种情况下，我总是使用描述该软件的**WIKI 。**然后，一个**标记**良好的子项和对该功能的**良好描述**就可以做到。

在我看来，重用整个函数并不总是有用的，而是查看曾经有意义的漂亮、可运行的代码。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-09T09:57:22.680

删除代码。写一个好的签入评论，解释你删除的内容和原因。这应该足够清楚，以便以后在该文件上运行历史命令的人会理解它，并且可以从版本控制存储库中检索您的函数。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-09T10:41:07.133

签入，并带有注释（在代码中并签入）说您将要删除它。

然后删除它并立即签入更改，并附上签入注释来解释原因。

这样你的代码库中就没有杂乱无章的东西，但你有一个永久的代码记录。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-09T09:48:14.383

签入并注释掉。恕我直言，太空成本非常值得您花时间在做正确的事情上（如果风变，可能需要再次花费）。也许您可以将其作为“零碎”文件的一部分签入，这样它就不会弄乱您的活动代码。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-09T10:28:58.030

**高兴地删除它。**

代码是针对动态世界中不断变化的需求做出的静态承诺。

> 我今天的观点是，如果我们想计算代码行数，我们不应该将它们视为“产生的行数”，而是“花费的行数”：当前的传统智慧是如此愚蠢，以至于将其计算在错误的一边。分类帐。
> 
> —<a href="http://www.cs.utexas.edu/users/EWD/ewd10xx/EWD1036.PDF" rel="nofollow noreferrer">Dijkstra 1036-11

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-09T10:11:32.497

将您的代码发布到： http: [//snipplr.com/](http://snipplr.com/) [http://refactormycode.com/](http://refactormycode.com/)

让其他人评价，也许也可以使用它:)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-09T10:23:58.277

不再维护死代码。当您再次需要它时，您将需要花时间让它再次工作。如果它真的很有用并且你仍然记得它，你总是可以通过你的版本控制来获得它。

在工作中，有些人的代码在 4 年前已被注释掉，占源文件的 70%。 **放手吧**

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-09T11:11:44.433

只需将其保存在您为自己设计或系统中可用的任何片段收集器中。问题不在于把它放在哪里（大多数情况下我们只是在谈论文本，不是吗？），而是如何再次找到它。问题是如何再次找到它，因此需要使用某种标记/搜索方法。

我将代码片段保存在[Code Collector Pro](http://www.mcubedsw.com/software/codecollectorpro)（适用于 Mac）中。

这样它不在任何项目中，但我可以在需要时重复使用它。

免责声明：我只是一个满意的客户。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-07T14:13:05.490

如果它的数量很大（而且通常还是有用的），为什么不考虑开源呢？我喜欢回收的想法。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-09T10:01:23.640

自从两年前我开始在我现在的雇主那里工作以来，我已经创建了一个相当大的实用程序代码库。它分为几个类别并用于多个项目。我创建的不需要的代码会立即进入那里并休眠，直到它被使用（或永远，以较早者为准）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-09T10:13:46.597

开源吧！如果它对你没有用，也许它对其他人有用。

反对这一点的通常论点是，公司没有付钱给你写免费代码，但是，他们让你在一个不稳定的架构上工作，所以他们无论如何都没有从你的代码中受益。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-09T10:31:48.370

我的项目副本中有一个类文件，我一直在其中存储有用的未使用函数。

另一种方式：因为我们将项目保存在 SVN 存储库中，所以当我替换我的有用函数时，我的日志文件中总是有 dat 函数，因此我可以在将来随时访问它。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-09T11:49:57.807

**代码较少的系统更好**，当您稍后取消注释时，您的注释代码将毫无用处。以前可以正常运行的代码的所有环境都可以更改或更危险 - 可能会更改新业务逻辑附带的一些不可见的小部分。

旧代码是引入新错误的绝佳机会。取消注释旧代码与通过猜测进行编程（看，它有效！）从定义上讲是邪恶的。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-09-02T11:27:49.010

[How to Delete Code](http://nedbatchelder.com/text/deleting-code.html)中有很多建议，但我保留了一个纯文本文件，我将其转储偶尔经过测试但未使用的函数，这些函数有一天可能会派上用场。我不忍心将它们完全扔掉，但话又说回来，我也从来不需要回到它们中的任何一个。

关于此类文件/代码片段集合的另一条规则：只有一个，在一个地方。

# c++ - 从另一个应用程序窗口中的文本字段读取

> ID：352236
> 
> 赞同：19
> 
> 时间：2008-12-09T09:43:37.577
> 
> 标签：c++, user-interface, winapi, textbox, ipc

Windows 应用程序有没有办法访问另一个应用程序的数据，更具体地说是 GUI 中的文本输入字段，并在那里获取文本以便在我们自己的应用程序中处理？

如果可能的话，有没有办法“屏蔽”你的应用程序来防止它？

编辑：前三个答案似乎是关于获取另一个应用程序窗口标题，而不是该窗口中的特定文本输入字段。

我不是 Windows API 期望的，所以你能否更准确地说我如何在该窗口中找到某个文本字段，它的先决条件是什么（似乎知道窗口句柄是必需的，它是否需要知道文本字段也处理？我怎么得到那个？等等......）

C++ 中的代码片段真的会非常感激。MSDN 帮助很难浏览，因为 Win32-API 有如此可怕的命名约定。

**完全的！**有关 C++ 的操作方法，请参阅下面的答案。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-11T17:47:48.127

要从另一个应用程序的文本框中读取文本内容，您需要以某种方式获取该文本框控件的窗口句柄。根据您的应用程序 UI 的设计方式（如果它有一个 UI），您可以使用几种不同的方法来获取此句柄。您可以使用“FindWindow”/“FindWindowEx”来定位您的控件，或者在有意义的情况下使用“WindowFromPoint”。无论哪种方式，一旦你有了文本控件的句柄，你就可以向它发送一个“WM_GETTEXT”消息来检索它的内容（假设它是一个标准的文本框控件）。这是一个编造的样本（没有错误检查）：

```
HWND hwnd = (HWND)0x00310E3A;
char szBuf[2048];
LONG lResult;

lResult = SendMessage( hwnd, WM_GETTEXT, sizeof( szBuf ) / sizeof( szBuf[0] ), (LPARAM)szBuf );
printf( "Copied %d characters.  Contents: %s\n", lResult, szBuf ); 
```

我使用“Spy++”来获取一个文本框窗口的句柄，该窗口恰好在附近。

至于保护您自己的文本框不被这样检查，您始终可以对您的文本框进行子类化（参见“SetWindowLong”和“GWL_WNDPROC”以获得“nIndex”参数）并对“WM_GETTEXT”消息进行一些特殊处理以确保只处理来自同一进程的请求。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-12T07:23:45.843

好的，我有点想通了。

现在的起点是准确地知道窗口句柄，我们只知道部分窗口标题，所以首先要做的是找到那个主窗口：

```
...
EnumWindows((WNDENUMPROC)on_enumwindow_cb, 0);
... 
```

它枚举了桌面上的所有窗口。它使用以下每个窗口句柄进行回调：

```
BOOL CALLBACK on_enumwindow_cb(HWND hwndWindow, LPARAM lParam) {
    TCHAR wsTitle[2048];
    LRESULT result;
result = SendMessage(hwndWindow, WM_GETTEXT, (WPARAM) 2048, (LPARAM) wsTitle);
    ... 
```

通过使用 wsTitle 和 little regex 魔法，我们可以找到我们想要的窗口。

通过使用前面提到的 Spy++，我可以找出文本编辑字段类名并使用它在*hwndWindow*中找到想要的字段：

```
hwndEdit = FindWindowEx(hwndWindow, NULL, L"RichEdit20W", NULL); 
```

然后我们可以从该字段中读取文本：

```
result = SendMessage(hwndEdit, WM_GETTEXT, (WPARAM) 4096, (LPARAM) wsText); 
```

我希望这可以帮助任何有同样问题的人！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T09:45:59.693

看看[AutoHotkey](http://www.autohotkey.com)。如果您的应用程序需要 API，请查看其来源。为防止出现这种情况，请使用自定义小部件而不是 WinForms、MFC 或 Win32 API。这不是万无一失的，但有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T09:47:09.333

是的，可以通过多种方式实现（一种方法是使用 WINAPI GetWindow 和 GetWindowText）。

首先，获取要从中检索文本的文本框的句柄（使用 FindWindow、EnumChildWindows 和其他 API），然后：

旧 VB6-codeexample，API 声明：

```
Private Declare Function GetWindowText Lib "user32" Alias "GetWindowTextA" (ByVal hwnd As Long, ByVal lpString As String, ByVal cch As Long) As Long  
Private Declare Function GetWindowTextLength Lib "user32" Alias "GetWindowTextLengthA" (ByVal hwnd As Long) As Long 
```

提取文本的代码：

```
Dim MyStr As String
MyStr = String(GetWindowTextLength(TextBoxHandle) + 1, Chr$(0))
GetWindowText TextBoxHandle, MyStr, Len(MyStr)
MsgBox MyStr 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-09T09:50:03.100

关于如何屏蔽应用程序以防止它，您可以做很多事情。一种方法是拥有一个自己的控件来处理文本输入，该控件从假设放置文本所在位置的几个标签构建文本，或者以图形方式绘制文本。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-13T12:29:56.730

您还可以使用 EM_GETTEXTRANGE 消息从 Richedit 控件中获取文本，但它仅适用于创建控件的同一进程。

# .net - 如何重定向另一个应用程序的 WebBrowser 控件

> ID：352245
> 
> 赞同：0
> 
> 时间：2008-12-09T09:46:20.317
> 
> 标签：.net, internet-explorer, plugins, activex, web-controls

我有应用程序，我无法修改它。此应用程序包含 IEControl（WebBrowser 控件），它显示一些 URL 并打开一些 txt 文件。如何获取 IWebBrowser2 并将此控件重定向到指定的 URL？例如，我需要将此控件重定向到`http://stackoverflow.com`每次尝试打开 txt 文件的控件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-14T15:18:14.360

You can't do this without serious hacks that would be unsupported and rather fragile. You'd have to inject your code across the process boundary using any of a number of tricks, none of which are trivial.

Why would you want to do this?

# .net - 用于测试 Web 服务的工具

> ID：352254
> 
> 赞同：0
> 
> 时间：2008-12-09T09:49:19.547
> 
> 标签：.net, web-services, testing, asmx

我想在将 Web 服务发送出去之前对其进行集成测试，并且想知道是否有人可以指出一些自动执行这些测试的工具？

我既有 ASMX 网络服务，也有一些 WCF 服务。

我希望能够将此作为任务添加到我的构建脚本中，并在可能的情况下自动执行。

在集成测试 Web 服务方面有哪些陷阱（如果有的话）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T09:53:10.037

您可以使用[SoapUI](http://www.soapui.org)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T09:59:14.660

[JMeter](http://jakarta.apache.org/jmeter/)是一个 java 应用程序，当然它也可以用于 .NET Web 服务。您可以创建脚本（发送 SOAP 请求）并以文本和图形方式监控结果。它可以模拟高流量条件，并且通常是非常可配置的。

除了您肯定需要在重负载条件下进行压力测试外，我没有任何专门用于测试 Web 服务的技巧。

关于在脚本中运行测试，有一个运行 JMeter 的[ant 任务](http://www.programmerplanet.org/pages/projects/jmeter-ant-task.php)。由于您正在构建 .NET 服务，我知道这可能意味着设置测试环境的工作量太大。当然还有Nant，但不知道是否与具体任务兼容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T12:54:59.017

看看[Watin-.Net](http://watin.sourceforge.net/)中的Web 应用程序*测试*。也许它可以帮助 Web 服务。

# ms-access - 在 MS Access/VBA 中使用 ADO 连接对话框

> ID：352259
> 
> 赞同：2
> 
> 时间：2008-12-09T09:51:22.133
> 
> 标签：ms-access, ado

我想在 MS Access 中使用标准的 ADO 连接字符串对话框。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T13:49:55.007

如果尚未选择，请在“参考”对话框中检查以下参考：

Microsoft OLE DB 服务组件 1.0 类型库

Microsoft ActiveX 数据对象 2.7 库

以下代码将打开对话框并将连接对象设置为“数据链接属性”对话框中提供的参数：

```
Dim dl As MSDASC.DataLinks
Dim cn As ADODB.Connection

Set dl = New MSDASC.DataLinks
Set cn = New ADODB.Connection

Set cn = dl.PromptNew
cn.Open 
```

然后，您可以使用连接打开 ADODB 记录集或检索有关连接的属性并根据需要继续操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T21:51:40.663

除了John Mo 的[先决条件之外，以下函数将返回一个完整的 ADO 连接字符串。](https://stackoverflow.com/questions/352259/using-ado-connection-dialog-in-ms-accessvba#352751)它可以使用默认的 ' `m_connectionString`' 值启动。这样的值可以存储在“连接表”中。

```
Function connectToDababase(Optional m_connectionString As String) As String
Dim dl As MSDASC.DataLinks
Dim cn As ADODB.Connection

Set dl = New MSDASC.DataLinks
Set cn = New ADODB.Connection

If IsMissing(m_connectionString) Then
    Set cn = dl.PromptNew
Else
    cn.ConnectionString = m_connectionString
    dl.PromptEdit cn
End If

connectToDababase = cn.ConnectionString
End Function 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-09T09:57:07.423

请参阅[如何将 Microsoft Access 表单绑定到 ADO 记录集](http://support.microsoft.com/kb/281998)

# .net - 互联网和 Intellisense 对您的记忆力有害吗？

> ID：352266
> 
> 赞同：10
> 
> 时间：2008-12-09T09:53:15.000
> 
> 标签：.net, intellisense

编程了一段时间后，我注意到我越来越依赖互联网和 IntelliSense 来完成我的工作。但我想知道在过去一年左右的时间里，这对我的知识有多大影响。但这有关系吗？

例如，我现在更有可能记住，当我需要针对我不了解的对象进行编程时，我将转到 System.Reflection 命名空间，快速查看列表将为我提供足够的详细信息以再次开始。但是，如果您要问我需要哪些课程等，我将很难将它们全部命名。

当人们似乎更多地关注 .NET 框架的晦涩领域的微小细节而不是申请人广泛而多样的知识和经验时，这种记忆问题似乎在面试时表现得更加明显。反正我跑题了。

有没有人认为是时候关闭 IntelliSense 并尝试寻找比互联网的快速修复和变通方法更好的学习方法了？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-09T09:56:19.953

你读过[查尔斯·佩佐德](http://charlespetzold.com/etc/DoesVisualStudioRotTheMind.html)关于这个主题的文章吗？里面有一些发人深省的东西。

我不确定你不知道事情的重要性太重要了。是的，这对面试来说是个问题——但这表明面试过程与现实不符。

我当然不建议关闭 Intellisense。编码已经够难了，无需尝试背诵计算机可以轻松告诉我们的东西。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-09T09:59:21.477

仅当您计划在没有互联网、同事或 MSDN 的岛上编写一些代码时，Intellisense 才不好。这可能发生在第三次世界大战之后，但我想无论如何我都必须选择新的职业。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-09T12:29:38.693

是的。从同样的意义上说，计算器不利于你的乘法速度，手机不利于你的写信和书法。所以，如果你想提高你的记忆力和助记技巧，请记住你所有的 API，但另一方面，如果你只是想编程和完成工作，谷歌和 IS 是你的朋友。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-09T09:58:55.703

对于编程中的大多数事情，您知道确切的名称并不重要。重要的是你知道它在那里并且你能够找到它。

Intellisense 是完成这项任务的绝佳工具，它可以让您专注于您的主要任务。互联网也是如此。它是宝贵的知识来源。您只需要确定知识价值的技能。（不是每个网站都有赞成/反对票系统，所以你必须自己做一些思考。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T09:57:42.213

我不会关闭IS。思考问题、模式和架构比背诵 API 更有用。如果你不知道一般的 API，IS 将无济于事。如果您大致了解它，它会提高编码速度。

这与询问是否使用记事本而不是VS和R#进行编程是一样的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-09T10:02:02.640

IMO 恰恰相反：通过消除记住细节的需要，代码完成和互联网资源使您可以专注于更重要和更复杂的问题，更多地了解如果需要可以做什么，而不是如何具体做某事。

了解 5 个 API 库的一般功能比了解一个 API 库的确切语法或了解解决不同问题的 5 种算法比了解如何准确实现特定的算法更有用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-09T10:10:31.283

除了智能感知还可以帮助像我这样拼写糟糕和/或有阅读障碍的人。

编辑：为了记录，我来这个问题是因为我读到智能感知对你的钱不利......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-09T13:00:33.013

我同意这里的每一个答案。

这并不是说我会关闭 IS 或将自己从互联网上删除。我想我的想法更多是这样的：在这个论坛上提出的大多数问题（如果不是全部）都可以通过在互联网上进行搜索来回答。是否通过搜索 Google 的速度和效率来衡量知识和理解？它是否影响我们的学习方式。

是的，如果我有时间寻找答案，我可以在这里回答所有问题，也许我会学到一些东西，但我不会将自己归类为 Guru。此外，我会觉得我被骗了。

并且以同样的方式，IS 和互联网可以帮助具有扎实理解力的人快速完成工作。它还限制或减慢了编程新手的学习（和理解）以获得这种理解。所以我假设那些已经编程很长时间但学习新技能或技术的人也和那些刚刚开始学习的人有同样的问题。当我第一次开始编程时——不仅仅是在我的 C64 上随机敲击按键——我遵循在线教程并阅读大量内容来完成工作。但是直到我真正离开“完成工作”并开始学习处理器架构、API、内存管理，你明白了，我才真正开始理解。

也许我只是有一种错误的看法，即理解和透彻的知识使一个好的程序员变得更好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-09T16:14:39.317

我认为对于像 .NET Framework 这样全面而复杂的产品而言，IntelliSense 是一个重要工具。字面上*有数千种*类型，如果不求助于某种帮助系统，任何开发人员都不可能希望记住其中的一小部分。在我看来，最好在你输入时使用它而不是通过 F1 ;)

Microsoft 的 IntelliSense 与框架的设计和 FxCop 等工具相结合，意味着您拥有一个（大部分）一致的开发框架，您可以利用该框架更快地开发自己的软件，并具有更好的组织性。与使用 VB 6 开发相比，这无疑是一个勇敢的新世界，但我认为微软已经站在巨人的肩膀上，并产生了一个优秀的——有时甚至是压倒性的——继任者。

# sharepoint - 如何访问从工作流关联表单传回的数据？

> ID：352268
> 
> 赞同：1
> 
> 时间：2008-12-09T09:55:05.587
> 
> 标签：sharepoint, infopath

如何访问从工作流关联表单传回的数据？

场景：当管理员将工作流与共享点列表相关联时，我想显示一个信息路径表单，该表单允许设置适用于该列表上所有实例的变量。关联表单按我的预期出现，并将输入的数据提交回托管环境。我读过我可以通过 SPWorkflowActivationProperties.ActivationData 在实例工作流中获取数据，但这是一个 xml 字符串。是否不能像使用普通信息路径表单一样通过扩展属性访问返回的数据？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T13:53:57.290

据我所知，这似乎不可能使用 InfoPath OOTB。然而，我在自定义启动表单方面的大部分经验都使用了 ASP.NET Web 表单，我们在其中序列化了一个类并将其填充到 ActivationData 中。

可能的方法可能是：

1.  封装 XML 解析

2.  使用 xsd.exe 根据您的信息路径表单的架构创建一个类。

**1.封装XML解析**

您可以创建一个封装表单数据的类，并将 xml 字符串作为其构造函数的参数。

信息路径形式：

```
<?xml version="1.0" encoding="UTF-8"?><?mso-infoPathSolution solutionVersion="1.0.0.2" productVersion="12.0.0" PIVersion="1.0.0.0" href="file:///C:\Documents%20and%20Settings\Administrator\My%20Documents\Template1.xsn" name="urn:schemas-microsoft-com:office:infopath:Template1:-myXSD-2005-10-21T21-12-27" ?><?mso-application progid="InfoPath.Document" versionProgid="InfoPath.Document.2"?><my:assetTracking xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:my="http://schemas.microsoft.com/office/infopath/2003/myXSD/2005-10-21T21:12:27" xmlns:xd="http://schemas.microsoft.com/office/infopath/2003" xml:lang="en-gb">
<my:employee>
    <my:employeeName></my:employeeName>
    <my:employeeDepartment></my:employeeDepartment>
</my:employee>
<my:assets>
    <my:asset>
        <my:assetID></my:assetID>
        <my:assetDescription></my:assetDescription>
        <my:assetMake></my:assetMake>
        <my:assetModel></my:assetModel>
        <my:assetSerialNumber></my:assetSerialNumber>
        <my:assetAssignedTo></my:assetAssignedTo>
        <my:assetDepartment></my:assetDepartment>
        <my:assetLocation></my:assetLocation>
        <my:assetCategory></my:assetCategory>
        <my:assetNotes></my:assetNotes>
    </my:asset>
</my:assets> 
```

自定义表单数据类

```
public class FormData
{

  public string EmployeeName { get; set; }
  public string EmployeeDepartment { get; set; }

  public FormData(string formData)
  {
       XmlDocument document = new XmlDocument();
       document.LoadXml(formData);
       XmlNamespaceManager namespaceManager = new XmlNamespaceManager(document.NameTable);
       namespaceManager.AddNamespace("my", "http://schemas.microsoft.com/office/infopath/2003/myXSD/2007-05-08T04:21:20");

       // Initialize member fields
       this.EmployeeName = document.SelectSingleNode("/my:employee/my:employeeName", nsmgr).InnerText;
       this.EmployeeDepartment = doc.SelectSingleNode("/my:employee/my:employeeDepartment", nsmgr).InnerText;

       etc....
  }
 } 
```

**2\. 使用 xsd.exe** xsd 可用于生成基于您的工作流表单使用的架构的类。请参阅：[如何：访问工作流中的关联和启动表单数据](http://msdn.microsoft.com/en-us/library/ms566880.aspx)

# c++ - 如何在 Windows 中取消“系统键关闭”状态

> ID：352270
> 
> 赞同：0
> 
> 时间：2008-12-09T09:56:16.007
> 
> 标签：c++, windows, winapi

在 Windows 中，当您按下 Alt 并再次释放时，菜单栏将被激活。但是，当您按下 Alt，然后单击，然后释放时，菜单栏不会被激活，因为大概您想要 Alt+单击，而不是激活菜单栏。

我想支持 Alt+鼠标滚轮更改（映射到水平滚动）。这很好用，但如果您准备好并松开 Alt 键，菜单栏就会激活。显然这是不可取的。当您 Alt+单击取消内部 'ActivateMenuBarWhenAltIsReleased' 标志时，Windows 必须在内部执行某种操作。如果我知道它是什么，我可以在收到鼠标滚轮消息时自己执行此操作。

那么，有谁知道当您按下并释放 Alt 时激活菜单栏的系统是如何工作的，以及如何取消它？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T10:47:20.350

当您松开 Alt 键时，系统会生成`WM_SYSCOMMAND`/`SC_KEYMENU`消息。此外，除非您按某个键打开特定的弹出菜单，否则 lparam 将为 0。 DefWindowProc 收到此信息后，将进入菜单循环。因此，您所要做的就是检测此消息并阻止它进入 DefWindowProc：

```
LRESULT CALLBACK MainWndProc(HWND wnd, UINT msg, WPARAM wparam, LPARAM lparam)
{
    switch (msg) {
        // ...
        case WM_SYSCOMMAND: {
            DWORD cmd = wparam & 0xfff0;
            // test for Alt release without any letter key pressed
            if (cmd == SC_KEYMENU && lparam == 0) {
                // don't let it reach DefWindowProc
                return 0;
            }
            break;
        }
        // ...
    }

    return DefWindowProc(wnd, msg, wparam, lparam);
} 
```

# wsdl - AXIS 1.4 将元素添加到自定义故障类型

> ID：352275
> 
> 赞同：2
> 
> 时间：2008-12-09T09:57:53.757
> 
> 标签：wsdl, axis

也许有人找到了解决以下问题的方法：

AXIS 1.4 似乎为每个自定义故障元素添加了一个`<exceptionName>`和一个`<hostname>`元素。在 WSDL 中，故障被定义为仅包含自定义故障消息`systemMessage`。

这是我的服务返回的答案。不用管错误，它可能是作为故障返回的任何错误。

```
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
   <soapenv:Body>
      <soapenv:Fault>
         <faultcode>soapenv:Server.generalException</faultcode>
         <faultstring/>
         <detail>
            <ns1:systemMessage xmlns:ns1="http://my.domain/workflow/engine/wsdl/types">
               <message>nullcvc-datatype-valid.1.2.1: '2008-12-02T00:00:00' is not a valid value for 'date'.cvc-type.3.1.3</message>
               <code>XML string is not valid</code>
               <parameter/>
            </ns1:systemMessage>
            <ns2:exceptionName xmlns:ns2="http://xml.apache.org/axis/">com.domain.commons.ws.schema.SystemMessageType</ns2:exceptionName>
            <ns3:hostname xmlns:ns4="http://xml.apache.org/axis/">my.host.com</ns3:hostname>
         </detail>
      </soapenv:Fault>
   </soapenv:Body>
</soapenv:Envelope> 
```

这似乎是 Axis 1.4 中的[错误](http://issues.apache.org/jira/browse/AXIS-2200?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel)。有谁知道这种行为的解决方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-09T11:30:24.927

该问题有一个解决方法：

在从 org.apache.axis.AxisFault 扩展的 AXIS 生成的故障类中，按如下方式更改构造函数以抑制元素（以下是用于问题中返回的故障的故障类）：

```
public SystemMessageType() {
    // Suppress the two elements
    this.removeHostname();
    this.removeFaultDetail(org.apache.axis.Constants.QNAME_FAULTDETAIL_EXCEPTIONNAME);
}

public SystemMessageType(
       java.lang.String message1,
       java.lang.String code,
       java.lang.String[] parameter) {
    // Call the default constructor
    this();
    this.message1 = message1;
    this.code = code;
    this.parameter = parameter;
} 
```

此解决方法解决了该问题。然而，每当您为 SOAP Web 服务重新生成代码时，您都必须调整故障类。

# sql - MS SQL Server COLUMNS_UPDATED() 函数

> ID：352287
> 
> 赞同：2
> 
> 时间：2008-12-09T10:02:12.220
> 
> 标签：sql, sql-server, sql-server-2005

我一直在研究我的一些 sql 表的审计触发器。我在[simple-talk上看到了](http://www.simple-talk.com/)[这篇文章](http://www.simple-talk.com/sql/database-administration/pop-rivetts-sql-server-faq-no.5-pop-on-the-audit-trail/)。

现在我知道这里使用的 COLUMNS_UPDATED() 函数应该只在 SQL Server 2005 及更高版本上可用，但它似乎也可以在 2000 下工作。这可能是 2000 年微软经典的未记录功能吗？还是我在使用 2k 的这种方法时会遇到麻烦？

如果是 2k 不支持 COLUMNS_UPDATED() 的情况，任何人都可以建议一种替代方法来仅审计表中的更改。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T11:03:45.700

sql server 2000 完全支持[COLUMNS_UPDATED() 。](http://msdn.microsoft.com/en-us/library/aa258254(SQL.80).aspx)

编辑：文档的[链接。](http://msdn.microsoft.com/en-us/library/aa258254(SQL.80).aspx)

# language-agnostic - 文化编码差异

> ID：352288
> 
> 赞同：9
> 
> 时间：2008-12-09T10:02:14.560
> 
> 标签：language-agnostic, social

我一直想知道在德国和印度的编码方式之间是否存在差异。

当然，人际关系是完全不同的，适合社会背景。等级制度、管理、工资金额、工作时间或宗教习俗完全改变了很多事情。

但这会影响您编码的方式吗？你有没有注意到，在旅行或与国外的人合作时，方法或代码中的某些东西有另一种味道？

这与语言无关，我是法国人，住在西班牙，但我们用英语编码。我想我们大多数人都这样做。

我倾向于觉得美国人在解决问题的方式上比法国人更直接，但我认为它不能仅限于编程，所以也许这是一个错误的例子。

* * *

警告 ！请不要让这个问题转移到种族虐待上。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T10:10:01.330

我与来自乌克兰的一些开发人员一起工作。最初，我确实认为存在主要的文化差异 - 例如倾向于使用“可爱”的代码，使用深不可测的模板结构等。

但是，我发现如果您沟通良好，差异很快就会消失，现在我对来自那里的代码非常满意。

*我*注意到的一件事是，与正常工作的代码相比，他们倾向于不太重视干净、重构的代码。拼写错误、字母错位、格式错误，我从基辅开发者那里看到的比本地开发者更多。他们普遍较低的英语水平起了一定的作用，但有时它很草率而且没有得到修复——错误只是到处复制粘贴。
总的来说，尽管我认为开发人员就是开发人员，如果你培养一种尊重和责任感的文化，你可以在任何地方找到适合你工作方式的优秀、可靠的人，而你的工作方式需要稍加调整。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T10:11:15.803

我不认为这种事情直接体现在代码中，即使那些喜欢用陈词滥调思考的人（每个人都在某种程度上这样做）可能会这样想。

但文化冲突肯定会产生间接影响。我反复听到印度承包商的一个问题是他们不能让自己与上级发生矛盾，所以如果你给他们一个不可能的截止日期，他们会提供一个糟糕的质量而不是告诉你根本不可能在这么短的时间内完成。当然，同样的结果可以（而且经常）通过许多美国公司所鼓励的过度乐观的“可以做”的态度来实现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T10:08:47.977

想想标记重要功能/类的不同方法等等......根据我的经验，来自其他国家的所有同事的工作确实非常不同，只是因为拼写他们的类方案的优先级不同

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T06:17:10.187

关于“权力距离”的一些东西开始发挥作用。我第一次遇到这个是在 Malcom Gladwell 的 Outliers 中。

就像在东南亚这里一样，我们也有根深蒂固的社会文化。我们试图在软件开发中克服这一点，以便我们能够适应更敏捷的模型。

在非编程方面，我们习惯称陌生人和老年人为“先生”和“女士”，在与来自西方文化的人打交道时我们必须忘掉这些。

# asp.net-mvc - 我应该如何构建一个简单的 ASP.NET MVC 应用程序？

> ID：352295
> 
> 赞同：10
> 
> 时间：2008-12-09T10:06:57.373
> 
> 标签：asp.net-mvc, model-view-controller, architecture, repository-pattern, poco

我一直在阅读一些关于 ASP.NET MVC、SOLID 等的内容，我正在尝试为中小型 ASP.NET MVC 应用程序找出一个简单的“配方”，将这些概念结合在一起；我最关心的问题是控制器过于复杂，就像 web 表单中的代码隐藏文件，其中包含所有类型的业务逻辑。

对于小型数据驱动的应用程序，我正在考虑以下架构：

*   控制器：只处理请求，调用相应的服务并将动作结果返回给视图；
*   模型：POCO，处理所有业务逻辑、授权等。依赖于存储库，完全不了解持久性基础设施。
*   存储库：实现`IRepository<T>`，使用依赖注入，是我的数据库代码所在的位置；只接收和返回 POCO。

我正在考虑在控制器和模型之间提供服务，但如果它们只是传递方法调用，我不确定它会有多大用处。

最后应该有覆盖模型代码的单元测试，以及覆盖存储库代码的单元+集成测试（如果可能，遵循“红绿”实践）

想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-09T10:20:25.537

伊恩·库珀（Ian Cooper）最近对此发表了一篇很好的文章：

[胖控制器](http://codebetter.com/blogs/ian_cooper/archive/2008/12/03/the-fat-controller.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T18:28:59.590

简单的方法：（**视图**）使用 ASP.NET 的表示层，（**控制器**）代码隐藏或 AJAX 服务层，（**模型**）应用程序服务层、业务模型层和持久性/数据访问层。

当然，您可以通过多种方式来处理复杂性，以构建清晰易读和可理解的应用程序。

有关该主题的最新讨论，我发现它非常好，请查看这本新出版的书：[Microsoft .NET：为企业构建应用程序](https://rads.stackoverflow.com/amzn/click/com/073562609X)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T10:21:10.230

这些演练非常有帮助：

[MVC 框架和应用结构](http://quickstarts.asp.net/previews/mvc/mvc_Framework.htm)

[演练：在 Visual Studio 中创建带有单元测试的基本 MVC 项目](http://quickstarts.asp.net/previews/mvc/mvc_CreateMvcProjectWalkthrough.htm)

另请参阅：[aspnet-mvc-structuring-controllers](https://stackoverflow.com/questions/36197/aspnet-mvc-structuring-controllers)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T10:34:12.357

[Rob Conery](http://blog.wekeroad.com/)有最好的答案 IMO。

查看他的[MVC Storefront Application](http://blog.wekeroad.com/mvc-storefront/)，它带有完整的[源代码](http://www.codeplex.com/mvcsamples)和[视频教程](http://www.asp.net/learn/mvc-videos/#MVCStorefrontStarterKit)。

# database - 数据库中的数字“日期” - 如何使用“正常”日期与之交互？

> ID：352311
> 
> 赞同：0
> 
> 时间：2008-12-09T10:18:53.870
> 
> 标签：database, ms-access, vbscript, ms-jet-ace

我正在使用这个数据库，其中日期列是数值而不是日期值。

是的，我知道我可以通过单击鼠标来更改它，但是使用该数据库的所有应用程序都是由我的一位前任制作的（他之后的每个人都忽略了它并建立在它之上）。因此，如果我将其更改为 Date 很多应用程序将失败。:(

好吧，我正在概述该数据库，从一个特定日期到另一个。我尝试使用下拉列表，但正如您所知，一个列表中的一千个选项非常不方便，甚至丑陋。

我宁愿为日-月-年提供小的输入字段，但是数据库中的数字日期会出现华尔兹舞曲。我将不得不以某种方式将日期计算回数值......

必须有一个简单的解决方案。对？

我正在为应用程序使用 ASP(vbscript)，它用于内部网络，并且我有一个 Access 数据库。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T11:26:16.683

如前所述，Access 将为您转换为数字，日期存储为数字。

```
Dim rs As DAO.Recordset

Set rs = CurrentDb.OpenRecordset("TestTable")
rs.AddNew
rs!NumberDate = Now()  'Value stored, eg, 39791.4749074074 '
rs.Update

rs.MoveLast

'To show that it converts back to the correct date / time '
Debug.Print Format(rs!NumberDate, "dd/mm/yyyy hh:nn:ss") 
```

编辑重新评论：这是一个显示返回日期的小测试：

```
Set cn = CreateObject("ADODB.Connection")
Set rs = CreateObject("ADODB.Recordset")

strFile = "C:\Docs\LTD.mdb"

cn.Open "Provider=Microsoft.Jet.OLEDB.4.0;" & _
       "Data Source=" & strFile & ";" & _
       "Persist Security Info=False"

strSQL = "SELECT NumberDate FROM TestTable WHERE NumberDate= #2008/12/7#"

rs.Open strSQL, cn, 3, 3
rs.MoveLast

MsgBox rs.RecordCount 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T12:38:16.600

对..所以这真的很容易。我会接受 Remou 的回答， WHERE NumberDate= #2008/12/7# 可以解决问题。

但是，为了结束这个问题，这是我自己摆弄函数的解决方案：

```
Function DateToNumeric(dayDate)
    DateToNumeric=DateDiff("d","31/12/1899",dayDate) +1 //yup
End Function

    response.Write("9/12/2008, should be 39791.<br /><br />")
    response.write("DateToNumeric('9/12/2008') gives: " &DateToNumeric("9/12/2008")& "<br />")
    response.write("CDate('39791') gives: " &CDate(39791)&"<br /><br />")
    response.write("BECAUSE CDate('1') gives: " &CDate(1)) 
```

输出：

> 2008 年 9 月 12 日，应该是 39791。
> 
> DateToNumeric('9/12/2008') 给出：39791
> CDate('39791') 给出：9-12-2008
> 
> 因为 CDate('1') 给出：31-12-1899

它使 1899 年 12 月 31 日不是第 0 天，而是第 1 天。：/

多谢你们！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T10:28:34.100

Access 在内部将日期存储为浮点数（自 31.12.1899 或其他日期以来的天数），您是否尝试过使用 CDate() 将数字转换回日期？您应该可以使用 BETWEEN 进行查询。

另一种可能性是日期以数字形式存储但未转换（即 31121899），在这种情况下，您应该能够使用 Format() 或 Day() 或 Month() 或 Year() 获取适当的日期部分。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T10:37:00.603

遗憾的是，日期存储为 39791 -> 9-dec-2008。浮点数。

我有一个将日期转换为可读格式的 javascript 函数（也由同一前辈编写）。这是相反的方式，回到那个让我困惑的数值的方式。

# visual-studio-2008 - 记录应用程序执行

> ID：352321
> 
> 赞同：0
> 
> 时间：2008-12-09T10:23:33.893
> 
> 标签：visual-studio-2008, debugging

我在几种情况下以调试模式测试应用程序。现在我通过在纸上写一些状态和执行的函数然后比较场景来做到这一点。

有谁知道VS2008中是否有任何内置功能或任何可以记录所选状态和执行功能的附加工具？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-09T19:18:35.187

这取决于您想要跟踪的内容，但如果您要比较哪些函数被执行，像 Vtune 这样的分析器可能会有所帮助。它可以生成一个表，其中包含调用了哪些函数以及调用频率，或者一个调用树。我相信 VS2008 Professional 或 Enterprise 也带有一个分析器，虽然我没有使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T12:21:53.237

您应该查看.NET 的[TRACE 和 DEBUG](http://msdn.microsoft.com/en-us/library/64yxa344(VS.80).aspx)指令。这意味着您必须将一些代码写入您想要记录事件或变量状态的应用程序，但它会为您提供自定义级别的详细信息，这应该比在一张纸上写下信息更好。

任何**DEBUG**语句都只会编译到 Debug 版本中，而**TRACE**语句可用于 Debug 和 Release 版本（取决于指定的指令）。

# c# - System.IO.FileLoadException

> ID：352332
> 
> 赞同：4
> 
> 时间：2008-12-09T10:30:15.687
> 
> 标签：c#, .net, enterprise-library, fileloadexception

使用 Enterprise Library 3.1 May 2007 版本时出现此错误。我们正在开发一个产品，并且在 Subversion Trunk 目录下有一个公共的 lib 目录

<>\Trunk\Lib\ 我们将所有第三方 DLL 放入其中。在其中我们有 Microsoft\EnterpriseLibrary\v3.1，我们在其中复制了 \Program Files\Microsoft Enterprise Library May2007\bin 中的所有 dll。在其中一位开发人员在这台机器上安装源代码之前，一切都正常工作。在源代码安装结束时复制了一些 dll，一旦完成，他就无法再运行该项目了。他总是得到这个错误

**'Microsoft.Practices.EnterpriseLibrary.Data, Version=3.1.0.0, Culture=neutral, PublicKeyToken=null' 或其依赖项之一。找到的程序集的清单定义与程序集引用不匹配。（来自 HRESULT 的异常：0x80131040）'**

这里有什么问题？我认为在安装源代码时，它只是应该构建所有内容并复制到源代码父目录中的 bin 目录中。此外，我们已将 Microsoft Enterprise Library May 2007\bin 目录中的 Dll 复制到我们的产品开发目录中，并在将 copylocal 标志设置为 true 的情况下引用到我们的项目中。

有谁可以帮我离开这里吗

RK

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-09T11:22:13.290

当我针对 dll 的签名版本进行开发并部署在只有未签名版本可用的地方时，我曾经得到过这种情况。

另外，[fuslogvw.exe](http://msdn.microsoft.com/en-us/library/e74a18c4(VS.71).aspx)。每一个。时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T15:02:25.343

我认为错误在于开发人员根据他拥有的未签名源代码编译编译了代码。

确保他在编译他的代码之前添加了对已签名 DLL 的引用。

Microsoft.Practices.EnterpriseLibrary.Data，版本=3.1.0.0，文化=中性，**PublicKeyToken=null**

应该是这样的：

Microsoft.Practices.EnterpriseLibrary.Data，版本=3.1.0.0，文化=中性，**PublicKeyToken=fa03fef243232**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T10:37:30.090

也许您应该检查 dll 的 Assembly- 和 FileVersion。如果它们不匹配，则可能发生此异常。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T11:20:46.663

阅读[此处](http://blogs.msdn.com/suzcook/archive/2003/05/29/57120.aspx)以开始进行程序集加载调试。

简而言之，您需要查看 Fusion 日志以获取更多信息。

> 对于“名称为 [yourAssembly] 的已定位程序集的清单定义与程序集引用不匹配”消息（对于 hresult FUSION_E_REF_DEF_MISMATCH，0x80131040）：Fusion 日志将说明程序集引用的哪个部分与找到的内容不匹配。它将是程序集名称、文化、公钥（或令牌）或版本（如果找到的程序集是强命名的）。

# xml - 如何在 XML::GDOME 中调试此错误的来源？

> ID：352334
> 
> 赞同：1
> 
> 时间：2008-12-09T10:31:06.437
> 
> 标签：xml, perl

我正在使用 GDOME.pm 并且在我的脚本中我有这一行：

```
my $doc = XML::GDOME->createDocument("","",""); 
```

我一生都无法弄清楚为什么会出现此错误：

```
NAMESPACE_ERR at /usr/lib/perl5/site_perl/5.6.1/i586-linux/XML/GDOME.pm line 103. 
```

这基本上指向：

```
sub createDocument {
  my $class = shift;
  return $di->createDocument(@_); ## it points to this LINE!!
} 
```

是否有工具或其他东西可以让我更多地了解哪些命名空间实际上导致了这个错误？

与此同时，我的解决方案是按照我的额头与键盘相接的方式进行的，但这似乎并没有奏效，只是引起了一些头痛，并且我的额头上出现了随机的形状。

谢谢~史蒂夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T12:24:24.850

文档说：

```
$doc = XML::GDOME->createDocument( $nsURI, $name, $dtd ); 
```

> 创建一个新的 xml 文档。如果定义了 $nsURI，它将位于 $nsURI 命名空间中，并且其文档元素将具有名称 $name。

现在，您的示例`""`用于命名空间。这与未定义不同，它是空字符串，并且已定义。它抱怨空字符串不是有效的命名空间。尝试`undef`改用：

```
my $doc = XML::GDOME->createDocument(undef,"",""); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T12:25:57.857

调用的 XML::GDOME::DOMImplementation::createDocument 有一个 C 例程，因此在其中遇到的错误会被报告为来自调用它的 Perl 代码行。该错误将由 gdome_di_createDocument 设置错误代码 14 引起。

我没有收到您报告的错误：

```
 perl -we'use XML::GDOME; XML::GDOME->createDocument("","","")' 
```

您可以尝试传递 undef 而不是 ""; 它在调用 gdome_di_createDocument 时将 undef 转换为 NULL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T01:51:18.480

好吧，当我尝试

```
my $doc = XML::GDOME->createDocument(undef,"",""); 
```

现在我收到了这个警告。他们是什么意思？

```
** CRITICAL **: file gdome-xml-element.c: line 235 (gdome_xml_el_setAttribute): assertion `value != NULL' failed.

** CRITICAL **: file gdome-xml-element.c: line 235 (gdome_xml_el_setAttribute): assertion `value != NULL' failed.

** CRITICAL **: file gdome-xml-element.c: line 235 (gdome_xml_el_setAttribute): assertion `value != NULL' failed. 
```

奇怪的是，namespace_err 似乎已经解决了，但这很奇怪，因为以前我有其他具有 createDocument 行（“”，“”，“”）的函数，它工作正常。

那么是否有任何我可能误以为导致错误触发的特殊原因或触发因素？

# .net - 如何使用 Pop3 将“标记为已读”？

> ID：352335
> 
> 赞同：10
> 
> 时间：2008-12-09T10:31:40.770
> 
> 标签：.net, pop3

我正在使用开源客户端以编程方式处理传入的电子邮件（在 Windows 2003 上）。防止接收以前阅读的电子邮件的唯一方法是从服务器中删除它们。这不太理想。据我所知，Pop3 中没有将电子邮件设置为正在阅读的命令。那么你怎么做呢？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-09T10:37:17.907

POP3 客户端有责任对此进行检查。最可靠的方法是使用`UIDL`POP3 命令获取唯一的消息 ID，并在客户端跟踪这些 ID。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-09T10:35:15.630

如果您不想删除，则必须跟踪所有已下载的电子邮件，并且不要再次 RETR。afaik 在标准 POP3 协议中没有类似“标记为已读”的功能（至少在[rfc](http://www.ietf.org/rfc/rfc1939.txt)中没有）

# python - 从 python 模块返回文件

> ID：352340
> 
> 赞同：1
> 
> 时间：2008-12-09T10:34:14.323
> 
> 标签：python, file, mime-types, download

编辑：如何通过 web 服务器从 python 控制器（后端）返回/提供文件，使用 file_name？正如@JV 所建议的那样

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T10:56:37.430

您可以传回对文件本身的引用，即文件的完整路径。然后您可以打开文件或以其他方式操作它。

或者，更正常的情况是传回文件句柄，并对文件句柄使用标准的读/写操作。

不建议传递实际数据，因为文件可以任意大并且程序可能会耗尽内存。

在您的情况下，您可能希望返回一个包含打开文件句柄、文件名和您感兴趣的任何其他元数据的元组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T11:48:15.047

CherryPy 完全支持使用

```
from cherrypy.lib.static import serve_file 
```

如[CherryPy 文档中所述 - FileDownload](http://www.cherrypy.org/wiki/FileDownload)：

```
import glob
import os.path

import cherrypy
from cherrypy.lib.static import serve_file

class Root:
    def index(self, directory="."):
        html = """<html><body><h2>Here are the files in the selected directory:</h2>
        <a href="index?directory=%s">Up</a><br />
        """ % os.path.dirname(os.path.abspath(directory))

        for filename in glob.glob(directory + '/*'):
            absPath = os.path.abspath(filename)
            if os.path.isdir(absPath):
                html += '<a href="/index?directory=' + absPath + '">' + os.path.basename(filename) + "</a> <br />"
            else:
                html += '<a href="/download/?filepath=' + absPath + '">' + os.path.basename(filename) + "</a> <br />"

        html += """</body></html>"""
        return html
    index.exposed = True

class Download:
        def index(self, filepath):
        return serve_file(filepath, "application/x-download", "attachment")
        index.exposed = True

if __name__ == '__main__':
    root = Root()
    root.download = Download()
    cherrypy.quickstart(root) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T11:06:04.960

有关 MIME 类型（下载方式）的信息，请从此处开始：[正确配置服务器 MIME 类型](https://developer.mozilla.org/en/Properly_Configuring_Server_MIME_Types)。

有关 CherryPy 的信息，请查看[Response](http://www.cherrypy.org/wiki/ResponseObject)对象的属性。您可以设置响应的[内容类型](http://www.cherrypy.org/wiki/ResponseObject#headers)。此外，您可以使用[tools.response_headers](http://www.cherrypy.org/wiki/BuiltinTools#tools.response_headers)设置内容类型。

当然，还有一个[File Download](http://www.cherrypy.org/wiki/FileDownload)的例子。

# c++ - C++ 中的多个整数类型类

> ID：352341
> 
> 赞同：4
> 
> 时间：2008-12-09T10:34:56.100
> 
> 标签：c++, class, boost, templates

我经常发现自己使用整数来表示不同“空间”中的值。例如...

```
int arrayIndex;
int usersAge;
int daysToChristmas; 
```

理想情况下，我想为这些类型“索引”、“年”和“天”中的每一个设置单独的类，这样可以防止我不小心把它们混在一起。从文档的角度来看，Typedef 是一种帮助，但不够类型安全。

我已经尝试过包装类，但最终我喜欢的样板太多。是否有一个简单的基于模板的解决方案，或者在 Boost 中是否有现成的解决方案？

编辑：有几个人在他们的答案中谈到了边界检查。这可能是一个方便的副作用，但不是关键要求。特别是，我不仅想防止超出范围的分配，还想防止“不适当”类型之间的分配。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-09T11:30:57.063

实际上，Boost 确实有一个专门用于此类事物的库！查看[Boost.Units 库](http://www.boost.org/doc/libs/1_37_0/doc/html/boost_units.html)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-09T10:44:40.073

您可以使用的一个时髦的“hack”是用于创建包装器类型的模板非类型参数。这不会添加任何界限，但它*确实*允许将它们视为仅具有一组样板模板代码的不同类型。IE

```
template<unsigned i>
class t_integer_wrapper
  {
  private:
    int m_value;
  public:
     // Constructors, accessors, operators, etc.
  };

typedef t_integer_wrapper<1> ArrayIndex;
typedef t_integer_wrapper<2> UsersAge; 
```

根据需要使用下限和上限或其他验证扩展模板。不过从长远来看并不漂亮。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-09T10:46:21.817

我记得用一个简单的模板解决了一个类似的问题，您可以在其中指定允许的范围，即

```
Int<0, 365> daysToChristmas;
Int<0, 150> usersAge;
Int<0, 6> dayOfWeek; 
```

你明白了。现在您可以从这样的模板类型派生，例如

```
class DayOfYear: public Int<0, 365> {} 
```

并且您不能再将用户年龄传递给期望 DayOfYear 的函数，并且您不必使用尖括号。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-09T12:32:36.877

你可以试试 BOOST_STRONG_TYPEDEF。来自`boost/strong_typedef.hpp`：

```
// macro used to implement a strong typedef.  strong typedef
// guarentees that two types are distinguised even though the
// share the same underlying implementation.  typedef does not create
// a new type.  BOOST_STRONG_TYPEDEF(T, D) creates a new type named D
// that operates as a type T. 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-09T11:13:07.020

这是一个通用的“StrongType”模板，我们用它来包装不同的类型和上下文。这个[答案](https://stackoverflow.com/questions/352341/multiple-integer-type-classes-in-c#352363)的唯一显着区别 是我们更喜欢使用一个*标签类型*，它为每个专门的包装器类型提供一个有意义的名称：

```
template <typename ValueType, class Tag> class StrongType {
public:
  inline StrongType() : m_value(){}
  inline explicit StrongType(ValueType const &val) : m_value(val) {}
  inline operator ValueType () const {return m_value; }
  inline StrongType & operator=(StrongType const &newVal) {
    m_value = newVal.m_value;
    return *this;
  }
private:
  //
  // data
  ValueType m_value;
}; 
```

以及模板的使用如下：

```
class ArrayIndexTag;
typedef StringType<int, ArrayIndexTag> StrongArrayIndex;
StringArrayIndex arrayIndex; 
```

还要注意，所有函数都是“内联”的，其目的是编译器可以尽最大努力生成与完全不使用模板时生成的代码完全相同的代码！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-09T11:48:45.467

除了 Ryan Fox 提到的 Boost Units 库之外，还会有 Boost Constrained Value 库，[目前正在审核中](http://comments.gmane.org/gmane.comp.lib.boost.announce/216)。

谁知道它何时或是否会发布官方 Boost 版本，但[无论如何你都可以尝试一下](http://student.agh.edu.pl/~kawulak/constrained_value/)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-09T10:54:41.613

添加运算符 int () 将允许您使用需要普通 int 的对象。您还可以添加运算符 = () 以将其设置在范围内。

```
class DayType 
  {
  public:
    static int const low = 1;
    static int const high = 365;
  };

template<class TYPE>
class Int
  {
  private:
    int m_value;
  public:
     operator int () { return m_value; }
     operator = ( int i ) { /* check and set*/ }
  };

  Int<DayType> day;
  int d = day;
  day = 23; 
```

我希望这有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-09T11:12:03.200

```
int arrayIndex; 
```

这是`std::size_t`为了什么。

```
int usersAge; 
```

人们不能有负年龄，并且设置年龄的固定上限是没有用/容易的。所以在这里你应该只使用`unsigned int`.

```
int daysToChristmas; 
```

圣诞节前几天需要特别注意。圣诞节前的天数范围为 0-366。简单的解决方案是在需要的地方编写以下内容：

```
assert( 0 < daysToChristmas && daysToChristmas < 366 ) 
```

如果你觉得你要`assert`在太多地方重复它，那么 David Allan Finch 为这个案例提出了一个巧妙的解决方案。虽然我偏爱使用断言。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-09T11:38:27.157

对于数组索引，如果我不需要负值，我会使用 size_t，因为这就是它的用途。当然，这通常是无符号整数，所以根本不会给你任何类型安全。但是，任何确实为您提供类型安全的东西（即阻止您将 unsigned int 分配给数组索引）也会阻止您将 size_t 值返回到您的类型中。无论如何，这可能是过多的类型安全。

您可能可以将枚举用于有界范围：

```
enum YearDay {
    FirstJan = 0,
    LastDecInLeapYear = 365
}; 
```

您可以将 YearDay 分配给 int，但如果没有显式强制转换，则不能将 int（或其他枚举类型）分配给 YearDay。枚举中最小和最大命名值之间的任何值都是该枚举的有效值。分配超出范围 [0,365] 的值会导致未定义的行为。或者可能是未指定或实现定义的结果，我不记得了。

年龄很棘手，因为它*几乎*是有界的，但并不完全。您可以在枚举中使用 969（玛士撒拉时代），或者使用其他人描述的使用显式转换包装 int 的类。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-17T05:42:47.277

查看有关此主题的[旧 CUJ 文章](http://www.ddj.com/cpp/184401633?pgno=4)。IIRC 该技术描述了如何使其与所有基本运算符一起使用

# url - 有没有办法在不刷新页面的情况下更改浏览器的地址栏？

> ID：352343
> 
> 赞同：92
> 
> 时间：2008-12-09T10:35:19.577
> 
> 标签：url, address-bar

我正在开发一个网络应用程序。在其中我有一个名为类别的部分，每次用户单击其中一个类别时，更新面板都会加载适当的内容。

用户单击类别后，我要更改浏览器的地址栏网址

```
www.mysite.com/products 
```

类似于

```
www.mysite.com/products/{selectedCat} 
```

无需刷新页面。
我可以使用某种 JavaScript API 来实现这一点吗？

* * *

## 回答 #1

> 赞同：158
> 
> 时间：2010-10-30T17:33:00.750

使用 HTML5，您可以修改 url 而无需重新加载：

如果您想在浏览器的历史记录中发布新帖子（即后退按钮将起作用）

```
window.history.pushState('Object', 'Title', '/new-url'); 
```

如果您只想更改网址而无法返回

```
window.history.replaceState('Object', 'Title', '/another-new-url'); 
```

该对象可用于 ajax 导航：

```
window.history.pushState({ id: 35 }, 'Viewing item #35', '/item/35');

window.onpopstate = function (e) {
  var id = e.state.id;
  load_item(id);
}; 
```

在这里阅读更多：http: [//www.w3.org/TR/html5-author/history.html](http://www.w3.org/TR/html5-author/history.html)

后备解决方案：[https ://github.com/browserstate/history.js](https://github.com/browserstate/history.js)

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-12-09T10:58:59.157

要添加这些家伙已经说过的内容，请编辑 window.location.hash 属性以匹配您在 onclick 函数中想要的 URL。

```
window.location.hash = 'category-name'; // address bar would become http://example.com/#category-name 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-09T10:43:34.897

我相信出于安全原因，不允许直接将地址栏操作到一个完全不同的 url 而不移动到该 url，如果你对它感到满意的话

www.mysite.com/products/#{selectedCat}

即同一页面中的锚样式链接，然后查看现在大多数 javascript 库中存在的各种历史记录/“后退按钮”脚本。

更新面板的提及让我猜测您正在使用 asp.net，在这种情况下，asp.net ajax 历史控件是一个很好的起点

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-09T10:40:54.310

我认为这是不可能的（至少更改为完全不同的地址），因为这将是对地址栏的不直观滥用，并且可能会促进网络钓鱼攻击。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-09T10:51:21.293

这不能像你说的那样做。somej.net 建议的方法是您可以获得的最接近的方法。这实际上是 AJAX 时代非常普遍的做法。甚至 Gmail 也使用它。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-23T03:16:04.463

> “window.location.hash”

正如 sanchothefat 所建议的那样，应该是唯一的方法。因为我看到的所有地方都有这个功能，它总是在URL中的#之后。

# c# - C#中的静态类

> ID：352348
> 
> 赞同：7
> 
> 时间：2008-12-09T10:37:24.690
> 
> 标签：c#, design-patterns, static, singleton

在回答这个问题（[https://stackoverflow.com/questions/352317/c-coding-question#352327](https://stackoverflow.com/questions/352317/c-coding-question#352327)）时，我想知道......

将静态类视为等效于实现单例模式的非静态类实例化是否有任何危险？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-09T10:47:11.240

唯一对我来说似乎很明显的是静态类基本上只是范围函数的集合（在这里明确避免“方法”），并且单例仍然是您可以实例化的东西，即使您只能有 1\. 1 > 0。

您可以将单例作为参数传递给需要某个接口的对象的东西，您不能在任何地方传递静态类（除非通过一些反射技巧）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T11:01:25.237

在许多方面，静态类和单例是相似的。一个很大的区别是单例可能会实现一些接口，而这对于静态类是不可能的。例如，`Comparer<T>.Default`/`EqualityComparer<T>.Default`提供（通过接口）在排序/字典使用中使用项目的能力。

也可以（虽然很棘手）将单例与标准序列化框架一起使用。使用静态类，您必须手动管理任何状态持久性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T10:41:08.910

它不完全等价。例如，您可以将对单例实例的引用作为参数传递，而静态类不能这样做，因为没有实例。

“危险”是什么意思？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T10:51:20.857

正如罗伯特·古尔德（Robert Gould）指出的那样，您对建筑的控制权松了。您还会遇到更加晦涩难懂的施工问题。静态类很快就会以静态初始化块结束。这些块在有人第一次引用您的类型时被调用，而且这个顺序可能没有您想像的那样定义好。因此，这些静态初始化程序的运行顺序可能会在您没有计划的情况下发生变化，并且可能会导致奇怪的错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T11:38:22.120

我可以看到静态类的主要危险是在编写单元测试时它们更难模拟。使用单例，您可以以这样的方式创建它，即您可以在其位置注入一个不同的类来测试特定的功能，而使用静态类则不是那么容易。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T10:42:31.887

不确定 C#，但在 C++ 中，静态对象会在初始化时被初始化，并且您无法直接控制它（尤其是在多线程应用程序中）。所以你需要一个函数来调用你的对象，而不是直接调用它（除非你想要不可移植的代码）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-09T10:52:43.973

正如罗伯特之前所说，初始化是静态类的主要缺点。静态类通常会在最后可能的时刻延迟初始化。但是，您失去了对确切行为的控制，并且静态构造函数很慢。

通常静态类用于保存全局数据。全局数据会在您的其他对象/类之间创建隐式依赖关系。所以在改变这个“全局对象”的时候一定要小心。可以破坏你的应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-09T11:30:13.133

我认为，在单例实现的情况下，没有任何危险。我经常这样做，通过静态类实现单调。从逻辑上讲，如果对象引用是单独且唯一的，则它不是必需的。

# sharepoint - 如何通过 SharePoint 对象模型创建托管路径

> ID：352350
> 
> 赞同：2
> 
> 时间：2008-12-09T10:39:41.440
> 
> 标签：sharepoint, object, model, managed, path

这是一个 WSS/SharePoint 专家的问题。

考虑这种情况：我有一个 ASP.Net Web 服务，它将我们的公司 CRM 系统和基于 WSS 的 Intranet 链接在一起。我要做的是在将新客户端添加到 CRM 系统时提供新的 WSS 网站集。为了完成这项工作，我需要以编程方式将托管路径添加到新网站集。我知道这可以通过对象模型实现，但是当我在自己的 Web 服务中尝试它时，它失败了。示例代码摘录如下：

```
 Dim _ClientSiteUrl As String = "http://myintranet/clients/sampleclient"

        Using _RootWeb As SPSite = New SPSite("http://myintranet")

            Dim _ManagedPaths As SPPrefixCollection = _RootWeb.WebApplication.Prefixes

            If Not (_ManagedPaths.Contains(_ClientSiteUrl)) Then

                _ManagedPaths.Add(_ClientSiteUrl, SPPrefixType.ExplicitInclusion)

            End If

        End Using 

```

此代码因 SPUtility.ValidateFormDigest() 上的 NullReferenceException 而失败。研究表明这可能是由于权限不足，我尝试使用 SPSecurity.RunWithElevatedPrivileges(AddressOf AddManagedPath) 在提升的权限块中运行代码，其中 AddManagedPath 是包含上述代码示例的子过程。

然后失败并出现 InvalidOperationException，“由于对象的当前状态，操作无效。”

我哪里错了？

我设法做的一种解决方法是通过 Process.Start() 调用 STSADM.EXE，提供必要的参数，这很有效。

**更新：**在开发 Web 服务时，我使用内置的 Visual Studio 2005 Web 服务器运行它——这将在什么安全上下文下运行？我可以通过在 web.config 中添加条目来更改安全上下文吗？

**更新：**我认为问题肯定与未在正确的 SharePoint 安全上下文中运行 Web 服务有关。我决定采用我建议的解决方法，并使用 STSADM，但要执行此操作，运行 Web 服务的应用程序池标识必须是 SharePoint 管理员的成员。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T21:14:43.547

**更新** 我认为您已经证明问题不在于代码。

SPSecurity.RunWithElevatedPrivileges：通常，SharePoint Web 应用程序中的代码以执行操作的用户的权限执行。RunWithElevatedPrivileges 在 SharePoint Web 应用程序池帐户的上下文中运行代码（我认为）[MSDN](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spsecurity.runwithelevatedprivileges.aspx)上的描述可能会更详细一些。

调用的问题可能是 Web 服务实际上并未在 SharePoint 进程中运行代码，因此解释了为什么它无法提升（猜测警报）。

尝试更改 Web 服务应用程序池的用户，看看是否会带来任何乐趣。

* * *

很可能是权限问题。也许尝试：

```
Dim clientSiteUrl As String = "http://myintranet/clients/sampleclient"
Using SPSite = new SPSite(clientSiteUrl) 
    webApp As SPWebApplication = SPWebApplication.Lookup(new Uri(clientSiteUrl));
    If Not (webApp.Prefixes.Contains(clientSiteUrl)) Then
        webApp.Prefixes.Add(clientSiteUrl, SPPrefixType.ExplicitInclusion)
    End If
End Using 
```

这不是确切的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-21T22:01:47.077

由于上面的代码不是确切的代码，这里是功能激活事件中 Web 应用程序范围内的功能的确切工作代码：

在 Mange Web 应用程序功能页面上激活功能时，激活功能将在指定的 Web 应用程序中创建一个新的显式托管路径（我想替换硬编码，可能使用 Properties.Feature.Parent 或类似的东西。）

```
using (SPSite site = new SPSite("http://dev-moss07-eric/PathHere")) {
    SPWebApplication webApp = SPWebApplication.Lookup(new Uri("http://dev-moss07-eric"));
    if (webApp.Prefixes.Contains("PathHere"))
    {
        //
    }
    else
    {
        webApp.Prefixes.Add("PathHere", SPPrefixType.ExplicitInclusion);
    }
} 
```

代码可能可以改进，但我尝试转换上述代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-21T23:41:02.513

如果要在该路径上创建托管路径（显式）和网站集，请执行以下操作：

```
using (SPSite site = new SPSite("http://dev-moss07-eric")) {
                SPWebApplication webApp = SPWebApplication.Lookup(new Uri("http://dev-moss07-eric"));
                if (webApp.Prefixes.Contains("ManagedPathHere"))
                {
                    //
                }
                else
                {
                    webApp.Prefixes.Add("ManagedPathHere", SPPrefixType.ExplicitInclusion);
                }
                using (SPWeb web = site.OpenWeb())
                {
                    SPWebApplication webApplication = web.Site.WebApplication;
                    try
                    {
                        webApplication.Sites.Add("ManagedPathHere","Site Title Here","This site is used for hosting styling assets.", 1033, "STS#1", "6scdev\\eric.schrader", "Eric Schrader", "eric.schrader@6sc.com");
                    }
                    catch (Exception ex)
                    {
                        //ex.ToString;
                    }
                }
            } 
```

# c# - 使用 Lookahead 使用正则表达式匹配字符串

> ID：352354
> 
> 赞同：1
> 
> 时间：2008-12-09T10:41:03.093
> 
> 标签：c#, html, regex

我需要使用正则表达式匹配一个字符串 holiding html 以提取所有嵌套跨度，我假设我认为有一种方法可以使用正则表达式来做到这一点，但整个早上都没有成功。

所以对于一个示例输入字符串

```
<DIV id=c445c9c2-a02e-4cec-b254-c134adfa4192 style="BORDER-RIGHT: #000000 1px solid; BORDER-TOP: #000000 1px solid; BORDER-LEFT: #000000 1px solid; BORDER-BOTTOM: #000000 1px solid; BACKGROUND-COLOR: #eeeeee">
<SPAN id=b8db8cd1-f600-448f-be26-2aa56ea09a9c>
<SPAN id=304ccd38-8161-4def-a557-1a048c963df4>
<IMG src="http://avis.co.uk/Assets/build/menu.gif">
</SPAN>
</SPAN>
<SPAN id=bc88c866-5370-4c72-990b-06fbe22038d5>
<SPAN id=55b88bbe-15ca-49c9-ad96-cecc6ca7004e>UK<BR></SPAN>
</SPAN>
<SPAN id=52bb62ca-8f0a-42f1-a13b-9b263225ff1d>
<SPAN id=0e1c3eb6-046d-4f07-96c1-d1ac099d5f1c>
<IMG src="http://avis.co.uk/Assets/build/menu.gif">
</SPAN>
</SPAN>
<SPAN id=4c29eef2-cd77-4d33-9828-e442685a25cb>
<SPAN id=0d5a266a-14ae-4a89-9263-9e0ab57f7ad2>Italy</SPAN>
</SPAN>
<SPAN id=f0a72eea-fddd-471e-89e6-56e9b9efbece>
<SPAN id=b7d9ada7-ade0-49fe-aa5f-270237e87c2b>
<IMG src="http://avis.co.uk/Assets/build/menu.gif">
</SPAN>
</SPAN>
<SPAN id=7604df94-34ba-4c89-bf11-125df01731ff>
<SPAN id=330d6429-4f1b-46a2-a485-9001e2c6b8c1>Netherlands</SPAN>
</SPAN>
<SPAN id=a18fb516-451e-4c32-ab31-3e3be29235f6>
<SPAN id=6c70238d-78f9-468f-bb8d-370fff13c909>
<IMG src="http://avis.co.uk/Assets/build/menu.gif">
</SPAN>
</SPAN>
<SPAN id=5a2465eb-b337-4f94-a4f8-6f5001dfbd75>
<SPAN id=47877a9e-a7d5-4f13-a41e-6948f899e385>Malta &amp; Gozo 
```

我想得到每个外部跨度及其包含的跨度，所以在上面的文本中应该有八个结果

任何帮助都欣然接受

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T11:04:06.493

再次[使用 HTML 解析器](http://www.developer.com/net/csharp/article.php/2230091)来遍历 DOM：正则表达式永远不会足够健壮来执行此操作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T11:06:38.063

使用标准正则表达式实际上不可能解决这个问题，因为它们基本上实现了[乔姆斯基层次结构](http://en.wikipedia.org/wiki/Chomsky_grammar)（有限状态自动机）中的类型 3 语法，而您至少需要类型 2 语法（某种堆栈或递归）才能正确识别任意嵌套结构。

但是，如果您限制最大可能的嵌套级别，那么它可能是可能的，但我仍然怀疑正则表达式是否是最佳解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T16:24:47.017

试试这个：

```
@"(?is)<SPAN\b[^>]*>\s*(<SPAN\b[^>]*>.*?</SPAN>)\s*</SPAN>" 
```

这与 PhiLho 的正则表达式基本相同，除了它允许两端的标签之间有空格。我还必须添加 SingleLine/DOTALL 修饰符以适应匹配文本中的行分隔符。我不知道这些改变中的任何一个是否真的有必要。OP 发布的示例数据都在一行上，但 PhiLho 将其分解（从而破坏了他自己的正则表达式）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T14:31:58.960

基本上，我同意上述建议，使用正则表达式解析 HTML 要求有一天会在奇怪的合法 HTML 结构上破坏代码（更不用说浏览器接受的格式错误的 HTML ......）。找到并使用一个好的 HTML 解析器可以在很多方面得到回报......

现在，我很务实（我无法抗拒一点正则表达式的挑战......），有时我会使用 RE 来对抗机器生成的 HTML（通常是导出功能），因为我知道我看到的结构不太可能改变，不像手- 生成的页面，作者可以在其中打错字……如果输出发生变化，我可以适应快速黑客攻击。

在您的情况下，HTML 非常规则、线性且可预测，因此 RE 非常简单。我提供 Java 代码是因为我不懂 C#，但适应应该是微不足道的。

```
Pattern p = Pattern.compile("(<SPAN id.*?<SPAN id.*?</SPAN></SPAN>)");
Matcher m = p.matcher(html);
while (m.find())
{
  System.out.println(m.group(1));
} 
```

HTH。

# multithreading - 代码重入与线程安全

> ID：352365
> 
> 赞同：26
> 
> 时间：2008-12-09T10:45:35.627
> 
> 标签：multithreading, thread-safety, reentrancy

**“代码重入”**和**“线程安全”**的概念有什么区别？根据下面提到的链接，一段代码可以是其中之一，也可以是两者，也可以不是。

[可重入和线程安全代码](http://encyclopedia.thefreedictionary.com/reentrant+code)

我无法清楚地理解解释。帮助将不胜感激。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-09T10:54:44.127

可重入代码在单点上没有状态。您可以在代码中执行某些操作时调用代码。如果代码使用全局状态，一个调用可能会覆盖全局状态，从而中断另一个调用中的计算。

线程安全代码是没有竞争条件或其他并发问题的代码。竞争条件是两个线程做某事的顺序影响计算。典型的并发问题是对共享数据结构的更改可能部分完成并处于不一致状态。为了避免这种情况，您必须使用并发控制机制，例如互斥量的信号量，以确保在操作完成之前没有其他任何东西可以访问数据结构。

例如，一段代码可以是不可重入但线程安全的，如果它在外部由互斥锁保护但仍然具有全局数据结构，其中状态必须在整个调用期间保持一致。在这种情况下，同一个线程可以发起对过程的回调，同时仍然受到外部粗粒度互斥体的保护。如果回调发生在不可重入过程中，则该调用可能会使数据结构处于从调用者的角度来看可能会破坏计算的状态。

如果一段代码可以对共享（和可共享）数据结构进行非原子更改，该更改可能在更新过程中被中断，从而使数据结构处于不一致状态，则它可以是可重入但非线程安全的. 在这种情况下，访问数据结构的另一个线程可能会受到半更改的数据结构的影响，并且会崩溃或执行破坏数据的操作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-09T13:03:54.037

那篇文章说：

“一个函数可以是可重入的，线程安全的，两者都可以，或者都不是。”

它还说：

“不可重入函数是线程不安全的”。

我可以看到这可能会导致混乱。它们意味着记录为不需要可重入的标准函数也不需要是线程安全的，这对于 POSIX 库 iirc 是正确的（并且 POSIX 也声明它对于 ANSI/ISO 库也是如此，ISO 有没有线程的概念，因此没有线程安全的概念）。换句话说，“如果一个函数说它是不可重入的，那么它也说它是线程不安全的”。这不是逻辑上的必要性，它只是一个约定。

这是一些线程安全的伪代码（好吧，由于锁定反转，回调有很多机会创建死锁，但我们假设文档包含足够的信息让用户避免这种情况）但不能重入。它应该增加全局计数器，并执行回调：

```
take_global_lock();
int i = get_global_counter();
do_callback(i);
set_global_counter(i+1);
release_global_lock(); 
```

If the callback calls this routine again, resulting in another callback, then both levels of callback will get the same parameter (which might be OK, depending on the API), but the counter will only be incremented once (which is almost certainly not the API you want, so it would have to be banned).

That's assuming the lock is recursive, of course. If the lock is non-recursive, then of course the code is non-reentrant anyway, since taking the lock the second time won't work.

Here's some pseudo-code which is "weakly re-entrant" but not thread-safe:

```
int i = get_global_counter();
do_callback(i);
set_global_counter(get_global_counter()+1); 
```

Now it's fine to call the function from the callback, but it's not safe to call the function concurrently from different threads. It's also not safe to call it from a signal handler, because re-entrancy from a signal handler could likewise break the count if the signal happened to occur at the right time. So the code is non-re-entrant by the proper definition.

Here's some code which arguably is fully re-entrant (except I think the standard distinguishes between reentrant and 'non-interruptible by signals', and I'm not sure where this falls), but still isn't thread-safe:

```
int i = get_global_counter();
do_callback(i);
disable_signals(); // and any other kind of interrupts on your system
set_global_counter(get_global_counter()+1);
restore_signal_state(); 
```

On a single-threaded app, this is fine, assuming that the OS supports disabling everything that needs to be disabled. It prevents re-entrancy from occurring at the critical point. Depending how signals are disabled, it may be safe to call from a signal handler, although in this particular example there's still the issue of the parameter passed to the callback being the same for separate calls. It can still go wrong multi-threaded, though.

In practice, non-thread-safe often implies non-re-entrant, since (informally) anything that can go wrong due to the thread being interrupted by the scheduler, and the function called again from another thread, can also go wrong if the thread is interrupted by a signal, and the function is called again from the signal handler. But then the "fix" to prevent signals (disabling them) is different from the "fix" to prevent concurrency (locks, usually). This is at best a rule of thumb.

Note that I've implied globals here, but exactly the same considerations would apply if the function took as a parameter a pointer to the counter and the lock. It's just that the various cases would be thread-unsafe or non-re-entrant when called with the same parameter, rather than when called at all.

# sql - 用sql过滤掉偏差记录

> ID：352389
> 
> 赞同：1
> 
> 时间：2008-12-09T11:00:40.680
> 
> 标签：sql, statistics, deviation

我们有这组数据，我们需要获得一列的平均值。a`select avg(x) from y`可以解决问题。然而，我们需要一个更准确的数字。

我认为必须有一种方法可以过滤具有太高或太低值（尖峰）的记录，以便我们可以在计算平均值时将它们排除在外。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T11:57:08.040

平均值分为三种类型，您最初使用的是平均值 - 所有值的总和除以值的数量。

您可能会发现获取模式更有用 - 最常出现的值：

```
select name,    
       (select top 1 h.run_duration
        from sysjobhistory h
        where h.step_id = 0
        and h.job_id = j.job_id
        group by h.run_duration
        order by count(*) desc) run_duration
from sysjobs j 
```

如果您确实想删除原始标准偏差之外的任何值，您可以在子查询中找到平均值和标准偏差，消除那些超出范围的值：平均 +- 标准偏差，然后做进一步的平均剩余的值，但您开始冒着获得无意义值的风险：

```
select oh.job_id, avg(oh.run_duration) from sysjobhistory oh
inner join (select job_id, avg(h.run_duration) avgduration, 
            stdev(h.run_duration) stdev_duration 
            from sysjobhistory h 
            group by job_id) as m on m.job_id = oh.job_id
where oh.step_id = 0
and abs(oh.run_duration - m.avgduration) <  m.stdev_duration
group by oh.job_id 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T11:07:26.940

在 sql server 中还有 STDEV 函数，所以也许这会有所帮助......

# c# - 什么是体面的 Mono 编辑器？

> ID：352392
> 
> 赞同：4
> 
> 时间：2008-12-09T11:02:09.557
> 
> 标签：c#, editor, mono

我已经离开 C# 有一段时间了，因为它“只是 Windows 的东西”，而且它不符合我当前的需求。然而，它越来越受欢迎，现在随着 Mono 的追赶，它变得越来越有吸引力，但我想知道人们在 *nix 平台上使用什么 IDE 来编写 C#（使用 Mono）。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-09T11:06:06.693

我认为[MonoDevelop](http://monodevelop.com/Main_Page)是最受欢迎的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-09T13:51:28.747

我将[Vim](http://www.vim.org)用于我所有的 *nix 东西。甚至还有一个用于 VS ( [ViEmu](http://www.viemu.com) ) 的 Vim 插件，因此您也可以在 IDE 中使用您的 Vim 技巧。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T11:20:04.463

正如[Mono For Linux Developers](http://www.mono-project.com/Mono_For_Linux_Developers)所示，至少有 3 个用于 C# 的 Eclispe 插件。

黑太阳：[http ://black-sun.sourceforge.net/](http://black-sun.sourceforge.net/)

Emonic 插件：[http ://emonic.sourceforge.net/](http://emonic.sourceforge.net/)

来自改进技术的 C# 插件：[http ://www.improve-technologies.com/alpha/esharp/](http://www.improve-technologies.com/alpha/esharp/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T11:32:27.310

我对编辑器非常不满意（与 VS.net 相比），但我认为在 windows 下可以使用 VS 开发 .net，然后也可以针对 mono 进行测试，以检查它是否适用于两个平台。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T13:19:30.417

奇怪，还没有人提到 Emacs。 [Emacs C# 模式](http://www.emacswiki.org/cgi-bin/wiki/CSharpMode "Emacs C# 模式")

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-09T11:09:37.763

我在 Mac OS X 上使用[Textmate](http://macromates.com)，它是任何平台上最棒的编辑器，但它不是 IDE。

在基于 X11 的系统上，如果我没记错的话，我想我更喜欢 Kate。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-09T14:40:50.143

[Omnicore](http://www.omnicore.com/en/xdevelop.htm)的 XDevelop 是另一个不错的选择。它有一些很好的高级特性，它是多平台的，并且它有很好的 Mono 支持。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-06T17:05:08.763

我在 Windows 和 Linux 上都使用了 SlickEdit 多年，并且非常喜欢它。它具有良好的 Emacs 键绑定，并且在两个平台上运行良好。

# php - Kohana 事件，放置它们的位置

> ID：352397
> 
> 赞同：1
> 
> 时间：2008-12-09T11:04:11.580
> 
> 标签：php, events, kohana

我正在尝试了解 Kohana 的事件系统。我唯一不明白的是，在哪里放置 Event::add 代码。

它应该在触发任何事件之前执行的地方。还是我错过了什么？

我想要实现的是构建一个随处可用的类，但真的不想将它破解到 Kohana 中。

任何人都可以对此有所了解吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T11:23:30.933

尝试在Event::Add 代码中添加一个[钩子。](http://docs.kohanaphp.com/general/hooks)

从文档中：

> hooks 的威力主要来自于 Events 类。在任何事件开始之前加载挂钩，因此您可以将挂钩附加到事件

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T08:13:19.550

通常 Event::add() 和 Event::replace() 放在 Hook 构造函数中。挂钩在系统的第一个事件（'system.ready'）之前加载，因此您可以将回调添加到每个系统或自定义事件。

# crystal-reports - 如何在 Crystal Report 饼图中对切片进行分组？

> ID：352406
> 
> 赞同：1
> 
> 时间：2008-12-09T11:08:34.863
> 
> 标签：crystal-reports, reporting

我正在尝试显示按公司显示销售额的饼图。然而，有很多公司只有很小的销售额，这使得饼图看起来很垃圾。

有没有办法将这样的公司归为一个“其他”类别？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-10T19:30:27.390

Chart Expert -> Data 然后选择您的“on change of”字段，然后单击 TopN 按钮。从这里您可以指定如何处理较小的金额。我通常将最底层的 5% 归为“其他”组。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T11:19:54.467

你总是可以从你的数据中制作两个饼图——一个显示主要参与者，另一个显示你的小公司数据的放大。

# class - 如何声明变量

> ID：352408
> 
> 赞同：1
> 
> 时间：2008-12-09T11:10:39.100
> 
> 标签：class, variables, ancestor, descendant

我和我的一位同事一直在讨论如何在函数中声明变量。

假设你有一个名为 TStrings 的类（为了解释而使用 Delphi），它至少有一个抽象方法和一个名为 TStringList 的后代类，它显然实现了抽象方法，但它没有引入任何你需要的尚未实现的东西祖先，您将如何声明 TStringList 类型的函数变量？

这里有两个例子。哪个被认为是更好的做法，为什么？

```
procedure AddElements;
var
  aList: TStringList;
begin
  aList := TStringList.Create;
  try
    aList.Add('Apple');
    aList.Add('Pear');
  finally
    aList.free;
  end;
end;

procedure AddElementsII;
var
  aList: TStrings;
begin
  aList := TStringList.Create;
  try
    aList.Add('Apple');
    aList.Add('Pear');
  finally
    aList.free;
  end;
end; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T11:16:51.477

它是一个 TStringList，因此您还应该将其声明为 TStringList（第一个示例）。其他一切都可能使您或其他稍后阅读代码的人感到困惑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T11:16:33.817

我的投票是第二种形式 - 想法是 TStrings 定义了一个合同/接口，并且更好地为它们编码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T11:26:00.367

我想说这取决于您是否期望 TStringList 可能会更改为其他实现 TStrings 的东西。如果您不希望它发生变化，请使用 TStringList 并访问仅在 TStringList 中的特殊功能（猜想情况并非如此）。如果您期望它可能会更改，请将其声明为 TStrings 并坚持使用“安全”方法。

在这种特定情况下，我会说没关系。地狱，您可能会更改变量声明，但无论如何都不会改变。所以使用你最喜欢的——这是一个偏好问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T11:32:51.693

我同意施奈德的观点。

TStringList 比 TStrings（它是一个抽象类）具有更多的属性和方法。除非您使用强制转换，否则使用 TStrings 变量会禁止使用这些成员。但在我看来，这让事情变得更糟。

您可以在函数参数中使用 TStrings。

```
procedure TMyClass.MyMethod(const AList: TStrings);
begin
end; 
```

或者作为财产。但是，如果将局部变量和字段声明为真实类型，则它们会更加通用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T14:06:22.320

这取决于...

在 Java 中，我经常看到使用可用的最高抽象级别进行声明的建议，尽管它通常适用于接口。

例如：

```
Collection list = new ArrayList();
[loop] list.add(someItem); [end loop] 
```

等等
为什么？它允许通过最小化更改的影响来更改实现（在某些情况下是一个细节：某些实现更适合某些用途（队列、链表、堆栈......），因此它可能主要是速度/内存问题）。

当然，如果您使用特定于实现的方法，则必须在声明中更加具体。

另一个优点：当一个方法需要一个 Collection 参数时，只要它只需要使用泛型方法，它就可以处理更广泛的输入。

# c# - C#单项目组织

> ID：352415
> 
> 赞同：5
> 
> 时间：2008-12-09T11:15:32.383
> 
> 标签：c#, visual-studio-2008, projects-and-solutions, project-organization

由于各种原因，我正在将我的源文件重新组织成一个带有单个项目的解决方案：

*   一个偏执的配置防病毒软件；
*   [通过 .NET 程序集对代码进行分区的建议](http://codebetter.com/blogs/patricksmacchia/archive/2008/12/08/advices-on-partitioning-code-through-net-assemblies.aspx)
*   [控制组件依赖以获得干净的架构](http://www.theserverside.net/tt/articles/showarticle.tss?id=ControllingDependencies)
*   [受益于 C# 和 VB.NET 编译器的性能](http://codebetter.com/blogs/patricksmacchia/archive/2007/06/20/benefit-from-the-c-and-vb-net-compilers-perf.aspx)

这给我留下了许多名称空间，这些名称空间被拆分到多个文件中。到目前为止，我使用的是这个约定：给定命名空间`Company.Project.A`，文件被命名`A.f1.cs`，`A.f2.cs`等等，`Company.Project.B`命名空间被分割`B.f1.cs`，`B.f2.cs`等等。

鉴于单个项目的限制，有没有更好的方法来组织多个命名空间中的多个文件？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-09T11:18:43.750

是的 - 使用文件夹。

如果您在项目中创建文件夹，该文件夹中的新类将自动使用文件夹名称作为命名空间的基础。

例如，如果您有一个默认命名空间为“Company.Project”的项目和一个包含“Bar.cs”的文件夹“Foo”，您最终会得到：

```
using System; // Etc

namespace Company.Project.Foo
{
    class Bar
    {
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T11:26:32.003

所以解决方案就在这里。是文件夹。但这有时很棘手。首先，每个班级有一个文件是个好主意。如果您将几个类打包到一个文件中 - 随着时间的推移，您将无法找到它们。

关于文件夹的第二件事 - 如果您单击一个文件夹并选择例如“添加 -> 新项目”，该项目将被放入选定的文件夹中。但要小心！如果您将在文件夹之间移动文件，则不会更新命名空间。

这是混乱项目的常见来源。不久之后，您可以完成一个项目，其中您有整齐组织的文件夹和文件，但不反映名称空间。因此，例如，如果您在文件夹 MyFolder 中有类 MyClass，请确保该类的命名空间类似于 MyApp.MyFolder 而不是一些旧垃圾。

因此，如果您不将类打包到一个文件中并观察类名称空间是否反映文件夹层次结构 - 您正在使您的项目非常易于阅读和导航。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T11:42:43.763

100% 同意 Jon Skeet。

为了在文件夹级别获得更多概览，我们正在创建打破命名空间结构的文件夹，方法是在它们前面加上下划线。

# c++ - stringstream clear 和 str 有什么区别

> ID：352420
> 
> 赞同：6
> 
> 时间：2008-12-09T11:17:43.363
> 
> 标签：c++, stringstream

我只是想知道 clear() 和 str(""); 之间有什么区别。

例如：

```
stringstream ss("Stack Overflow");

ss.clear();

ss.str(""); 
```

我想知道潜在的技术差异。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-09T11:20:56.040

`clear()`清除`stringstream`. 也就是说，它将错误状态设置为`goodbit`（等于零）。

`str("")`将关联的字符串对象设置为空字符串。

他们实际上做了完全不同的事情。名称的特殊选择只会让人*听起来*好像它们执行类似的任务。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-09T11:29:16.973

```
void clear ( iostate state = goodbit ) //clears and sets error flag passed as parameter

string str ( ) const;          //to get value from string stream
void str ( const string & s ); //to set value to string stream 
```

# protocols - 通用二进制协议

> ID：352433
> 
> 赞同：6
> 
> 时间：2008-12-09T11:24:17.030
> 
> 标签：protocols

我正在尝试为我的下一个分布式应用程序找到合适的协议中间件。在过去的几天里，我找到了几个规格，想知道我是否错过了一个重要的规格？它应该是二进制协议，支持 RPC，并且可以选择具有不同语言的开源实现。这是我找到的协议列表：

*   科尔巴
*   冰
*   AMQP
*   节约

这是被解雇的协议列表：

*   基于 XML 的协议，因为它们是基于文本的（XML-RCP、SOAP、手卷等）
*   协议缓冲区（闭源）
*   COM（仅限 Windows）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-09T11:28:25.040

Protocol Buffers 项目*绝对*不是封闭源代码。

您对哪种语言/平台感兴趣？

*   对于 Java、C++ 和 Python，有[Google 代码](http://code.google.com/apis/protocolbuffers/)。
*   对于 C#，至少有三个项目（包括[我](http://github.com/jskeet/dotnet-protobufs/tree)的或[Marc 的](http://code.google.com/p/protobuf-net/)）
*   对于其他语言/平台，请参阅[相关的 wiki 页面](http://code.google.com/p/protobuf/wiki/OtherLanguages)

请注意，虽然 Protocol Buffers 中有*stub* RPC 支持，但 Google 尚未发布其实际的 RPC 层，因此您必须提供自己的。考虑到基本上你会传递一个请求消息并返回一个响应消息，将它分层到现有协议（例如 HTTP POST）上并不*难*。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-09T11:26:19.193

我不认为[协议缓冲区](http://code.google.com/p/protobuf/)是封闭源代码的。该页面暗示不同，并且有源下载。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-09T11:51:20.173

很可能不是最好的候选人，但为了完整起见，我想补充一点[，XML 有一个二进制编码](http://www.w3.org/XML/Binary/)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-29T22:15:35.797

我建议您重新考虑 Google 协议缓冲区。所有主要平台都有许多开源实现，包括 Google 自己发布的 C++/Java/Python。

正如上面 Jon Skeet 所提到的，PB 规范没有定义 RPC 模型，但是使用 PB 定义自己的 RPC 非常容易。

或者，您可以查看 ASN.1。有大量使用 ASN.1 的应用程序。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T11:30:05.223

你可以看看[ASN.1](http://en.wikipedia.org/wiki/ASN.1)。

它用于在许多其他协议（例如 SNMP、LDAP）中编码和传输二进制数据，尽管 ASN.1 本身并没有定义传输协议。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-10T11:22:43.733

Joe Armstrong 的[UBF](http://www.sics.se/~joe/ubf/site/home.html)似乎并没有流行起来，但它通过有品位的设计满足了您的要求。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-10T10:19:52.613

我建议尝试 RabbitMQ AMQP，并使用协议缓冲区、XML 或其他一些数据格式（如 JSON）来品尝。除了相对简单和容易上手之外，这还允许您混合和匹配 RPC 和异步 pubsub 样式，并且可以很好地跨语言、协议和平台传播。但这可能不适合您的问题——这完全取决于您要做什么！干杯，亚历克西斯

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-02T20:50:44.603

从 ZeroC 到 Ice 有一个补丁可以原生支持 Google Protocol Buffers。

[http://www.zeroc.com/labs/protobuf/](http://www.zeroc.com/labs/protobuf/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-05-03T06:47:29.913

Flavor[风味，用于定义 MPEG-4](http://flavor.sourceforge.net/)

# php - 任意大小数字的基本转换 (PHP)

> ID：352434
> 
> 赞同：5
> 
> 时间：2008-12-09T11:25:38.727
> 
> 标签：php, math, base-conversion

我有一个很长的“二进制字符串”，比如 PHPs pack 函数的输出。

如何将此值转换为 base62 (0-9a-zA-Z)？内置的数学函数会溢出如此长的输入，并且 BCmath 没有 base_convert 函数或任何特定的函数。我还需要一个匹配的“pack base62”函数。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-11-16T17:06:23.007

我认为这个问题背后存在误解。基本转换和编码/解码是**不同**的。***的***输出`base64_encode(...)`不是一个大的 base64 数。它是一系列离散的 base64 值，对应于压缩函数。这就是为什么 BC Math 不起作用的原因，因为 BC Math 关注的是单个大数，而不是实际上代表二进制数据的小数组的字符串。

 *这是一个示例来说明差异：

```
base64_encode(1234) = "MTIzNA=="
base64_convert(1234) = "TS" //if the base64_convert function existed 
```

*base64 编码*将输入分成 3 个字节组（3*8 = 24 位），然后将每个 6 位子段（2^6 = 64，因此为“base64”）转换为相应的 base64 字符（值为“ ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"，其中 A = 0，/ = 63)。

在我们的示例中，`base64_encode()`将“1234”视为 4 个字符的字符串，而不是整数（因为`base64_encode()`不对整数进行操作）。因此它输出“MTIzNA==”，因为（在 US-ASCII/UTF-8/ISO-8859-1 中）“1234”是二进制的 00110001 00110010 00110011 00110100。这分为 001100（十进制 12，字符“M”）010011（十进制 19，字符“T”）001000（“I”）110011（“z”）001101（“N”）00。不完整，它用 0 填充，值为 000000（“A”）。因为一切都是由 3 个输入字符组完成的，所以有 2 个组：“123”和“4”。最后一组用 = 填充以使其长度为 3 个字符，因此整个输出变为“MTIzNA==”。

*另一方面，*转换为 base64采用单个整数值并将其转换为单个 base64 值。*对于我们的示例，如果我们使用与上面相同的 base64 值字符串，则 1234（十进制）是“TS”（base64）。从左到右向后工作：T = 19（第 1 列），S = 18（第 0 列），所以 (19 * 64^1) + (18 * 64^0) = 19 * 64 + 18 = 1234 （十进制）。相同的数字可以用十六进制（base16）*表示*为“4D2”：(4 * 16^2) + (D * 16^1) + (2 * 16^0) = (4 * 256) + (13 * 16 ) + (2 * 1) = 1234（十进制）。*

 *与*encoding*不同，它接受字符串并对其进行更改，基本*转换*不会更改实际数字，只会更改其表示形式。十六进制（base16）“FF”与十进制（base10）“255”是相同的数字，与二进制（base2）中的“11111111”相同*。*把它想象成货币兑换，如果汇率从未改变：1 美元与 0.79 英镑的价值相同（今天的汇率，但假装它从未改变）。

在计算中，整数通常作为二进制值进行运算（因为很容易构建 1 位算术单元，然后将它们堆叠在一起以形成 32 位/等算术单元）。要做像“255 + 255”（十进制）这样简单的事情，计算机需要先将数字转换为二进制（“11111111”+“11111111”），然后在算术逻辑单元（ALU）中执行运算。

几乎所有其他基数的使用都纯粹是为了方便人类（演示） - 计算机将其内部值 11111111（二进制）显示为 255（十进制），因为人类受过对十进制数进行运算的训练。该函数`base64_convert()`不作为标准 PHP 曲目的一部分存在，因为它通常对任何人都没有用：没有多少人本机读取 base64 数字。相比之下，二进制 1 和 0 有时对程序员很有用（我们可以像使用开/关开关一样使用它们！），而十六进制便于人类编辑二进制数据，因为整个 8 位字节可以明确表示为 00 到 FF，不会浪费太多空间。

您可能会问，“如果基础转换只是为了演示，那么为什么存在 BC Math？” 这是一个公平的问题，也是我说“几乎”纯粹是为了演示的原因：典型的计算机仅限于 32 位或 64 位宽的数字，这些数字通常足够大。有时您需要对不适合这些寄存器的非常*非常大的数字（例如 RSA 模数）进行操作。*BC Math 通过充当抽象层来解决这个问题：它将大量数字转换为长文本字符串。当需要进行一些操作时，BC Math 会煞费苦心地将长长的文本字符串分解成计算机可以处理的小块。它比本机操作慢*得多*，但它可以处理任意大小的数字。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-13T01:26:33.950

除非你真的，真的必须有 base62，否则为什么不去：

```
base64_encode()
base64_decode() 
```

唯一添加的其他字符是“+”和“=”，这是一种非常著名的方法，可以使用许多其他语言中的可用函数来打包和解包二进制字符串。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-01-31T07:28:44.387

这是一个`base_conv()`可以在完全任意的基数之间转换的函数，表示为字符串数组；每个数组元素代表该基数中的单个“数字”，因此也允许多字符值（避免歧义是您的责任）。

```
function base_conv($val, &$baseTo, &$baseFrom)
    {
    return base_arr_to_str(base_conv_arr(base_str_to_arr((string) $val, $baseFrom), count($baseTo), count($baseFrom)), $baseTo);
    }

function base_conv_arr($val, $baseToDigits, $baseFromDigits)
    {
    $valCount = count($val);
    $result = array();
    do
        {
        $divide = 0;
        $newlen = 0;
        for ($i = 0; $i < $valCount; ++$i)
            {
            $divide = $divide * $baseFromDigits + $val[$i];
            if ($divide >= $baseToDigits)
                {
                $val[$newlen ++] = (int) ($divide / $baseToDigits);
                $divide = $divide % $baseToDigits;
                }
            else if ($newlen > 0)
                {
                $val[$newlen ++] = 0;
                }
            }
        $valCount = $newlen;
        array_unshift($result, $divide);
        }
        while ($newlen != 0);
    return $result;
    }

function base_arr_to_str($arr, &$base)
    {
    $str = '';
    foreach ($arr as $digit)
        {
        $str .= $base[$digit];
        }
    return $str;
    }

function base_str_to_arr($str, &$base)
    {
    $arr = array();
    while ($str === '0' || !empty($str))
        {
        foreach ($base as $index => $digit)
            {
            if (mb_substr($str, 0, $digitLen = mb_strlen($digit)) === $digit)
                {
                $arr[] = $index;
                $str = mb_substr($str, $digitLen);
                continue 2;
                }
            }
        throw new Exception();
        }
    return $arr;
    } 
```

例子：

```
$baseDec = str_split('0123456789');
$baseHex = str_split('0123456789abcdef');

echo base_conv(255, $baseHex, $baseDec); // ff
echo base_conv('ff', $baseDec, $baseHex); // 255

// multi-character base:
$baseHelloworld = array('hello ', 'world ');
echo base_conv(37, $baseHelloworld, $baseDec); // world hello hello world hello world 
echo base_conv('world hello hello world hello world ', $baseDec, $baseHelloworld); // 37

// ambiguous base:
// don't do this! base_str_to_arr() won't know how to decode e.g. '11111'
// (well it does, but the result might not be what you'd expect;
// It matches digits sequentially so '11111' would be array(0, 0, 1)
// here (matched as '11', '11', '1' since they come first in the array))
$baseAmbiguous = array('11', '1', '111'); 
```

# php - php和sql查询失败

> ID：352452
> 
> 赞同：0
> 
> 时间：2008-12-09T11:32:06.080
> 
> 标签：php, sql

我有这个代码

[http://www.nomorepasting.com/getpaste.php?pasteid=22580](http://www.nomorepasting.com/getpaste.php?pasteid=22580)

这是一个小型 ajax 应用程序的一部分。我想知道一种更好、更有效的方法来分配 $query，而不是每次都用不同的查询或一堆 if 子句复制 sql。基本上查询将取决于单击的链接，但我不确定如何在逻辑中显示它。我也不确定为什么我在 $result 中的 SQL 查询失败。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T11:44:43.930

**更新**：我将 Eran 的功能集成到重构的代码中。注意：我通过将 $table 变量传递给它并重命名它来更正它，因为它不只搜索查询文本，而是主要返回所需的行！

**主要错误**：

*   错误 1：在所有破坏代码的情况下，您都用 query2 覆盖查询。
*   错误2：LIKE'%$query%' LIKE 和'=> LIKE'% 之间缺少一个空格...这很可能也破坏了您的代码

**其他问题**

*   安全问题：sql注入危险，使用mysql_real_escape_string
*   \n 不独立于平台：使用 PHP_EOL
*   写短 if 块的另一种方法
*   对正常的 if 结构和所有此类结构使用大括号

这是您的代码进行了一些更改，**请查看评论**：

```
<?php
session_start(); //ommit, no session var used

//use braces, always!
//you may write such statements with the short form like
if (isset($_GET['cmd'])) : $cmd = $_GET['cmd']; else : die (_MSG_NO_PARAM); endif;

$query = '';
//escpae your input - very important for security! sql injection!
if ( isset ($_GET["query"]))
{
    $query = mysql_real_escape_string($_GET["query"]);
}
//no need for the other part you had here

$con = mysql_connect("localhost", "root", "geheim");

if (!$con) : die ('Connection failed. Error: '.mysql_error()); endif;

mysql_select_db("ebay", $con);

if ($cmd == "GetRecordSet")
{
    $table = 'Auctions';
    $rows = getRowsByArticleSearch($searchString, $table);

    //use PHP_EOL instead of \n in order to make your script more portable

    echo "<h1>Table: {$table}</h1>".PHP_EOL;
    echo "<table border='1' width='100%'><tr>".PHP_EOL;
    echo "<td width='33%'>Seller ID</td>".PHP_EOL;
    echo "<td width='33%'>Start Date</td>".PHP_EOL;
    echo "<td width='33%'>Description</td>".PHP_EOL;
    echo "</tr>\n";

    // printing table rows
    foreach ($rows as $row)
    {
        $pk = $row['ARTICLE_NO'];
        echo '<tr>'.PHP_EOL;
        echo '<td><a href="#" onclick="GetAuctionData(\''.$pk.'\')">'.$row['USERNAME'].'</a></td>'.PHP_EOL;
        echo '<td><a href="#" onclick="GetAuctionData(\''.$pk.'\')">'.$row['ACCESSSTARTS'].'</a></td>'.PHP_EOL;
        echo '<td><a href="#" onclick="GetAuctionData(\''.$pk.'\')">'.$row['ARTICLE_NAME'].'</a></td>'.PHP_EOL;
        echo '</tr>'.PHP_EOL;
    }
}
mysql_free_result($result);
//mysql_close($con); no need to close connection, you better don't

function getRowsByArticleSearch($searchString, $table) 
{
    $searchString = mysql_real_escape_string($searchString);
    $result = mysql_query("SELECT ARTICLE_NO, USERNAME, ACCESSSTARTS, ARTICLE_NAME FROM {$table} WHERE upper ARTICLE_NAME LIKE '%" . $searchString . "%'");
    if($result === false) {
            return mysql_error();
    }
    $rows = array();
    while($row = mysql_fetch_assoc($result)) {
            $rows[] = $row;
    }
    return $rows;
}

// ?> ommit closing php tag 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T11:48:00.023

```
"SELECT ARTICLE_NO, USERNAME, ACCESSSTARTS, ARTICLE_NAME
FROM {$table} WHERE upper ARTICLE_NAME LIKE'%$query%'" 
```

您需要在`upper`函数的参数周围加上方括号。将您的查询更改为此，它应该可以工作：

```
"SELECT ARTICLE_NO, USERNAME, ACCESSSTARTS, ARTICLE_NAME
FROM {$table} WHERE upper(ARTICLE_NAME) LIKE'%$query%'" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T11:50:12.267

对于功能用途：

```
$result = mysql_query($sql_query) or die(mysql_error()); 
```

看看你得到什么样的mysql错误。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T11:54:28.250

你应该像*nickf*说的那样做。

而且你肯定很容易发生 SQL 注入：

wikibooks：[http](http://en.wikibooks.org/wiki/Programming:PHP:SQL_Injection) ://en.wikibooks.org/wiki/Programming:PHP:SQL_Injection 长文章：[http ://www.securiteam.com/securityreviews/5DP0N1P76E.html](http://www.securiteam.com/securityreviews/5DP0N1P76E.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T11:54:40.433

您可以在一个接受搜索文本作为参数的函数中抽象您的查询。就像是：

```
function searchQuery($text) {
    $text = mysql_real_escape_string($text);
    $result = mysql_query("SELECT ARTICLE_NO, USERNAME, ACCESSSTARTS, ARTICLE_NAME FROM {$table} WHERE upper ARTICLE_NAME LIKE '%" . $text . "%'");
    if($result === false) {
        return mysql_error();
    }
    $rows = array();
    while($row = mysql_fetch_assoc($result)) {
        $rows[] = $row;
    }
    return $rows;
} 
```

Note that you should escape user input to prevent SQL injection attacks (here I used mysql_real_escape_string() to do that). This function also returns the error code if the query fails, so you should check the result to see if it's an array or not:

```
 $result = searchQuery($_GET['query']);
 if(!is_array($result) ) {
      echo 'An error has occurred:' . $result;
 } else {
   //iterate over rows
 } 
```

Wrap your logical structures (IF/ELSE) with curly brackets {. It's better for readability and helps avoid unnecessary mistakes.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T11:47:38.777

您没有将语句包含在 IF/THEN/ELSE 构造中的赞誉中，因此只有每个块中的第一个语句有条件地执行，其余的始终是。

在大多数情况下，您会将 $query2 分配给 $query，而 $query2 可能尚未定义。

作为另一个提示：清理您的输入，不要像那样将用户输入粘贴到您的 SQL 中，这很危险。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-09T11:51:52.933

您可能需要在 LIKE 和 '%$query%' 之间留一个空格。此外，您应该查看 mysql_error() 函数 - 让 MySQL 准确地告诉您错误是什么。

# api - 那里有什么好的电影/电影 API 吗？

> ID：352456
> 
> 赞同：7
> 
> 时间：2008-12-09T11:33:59.367
> 
> 标签：api, movie

在电影网站上工作，很想找到一个 API，我可以用它来获取有关不同电影的信息。我用 PHP 编码，但我假设这可能会返回 XML。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-26T22:42:57.310

我可以推荐[themoviedb.org](http://www.themoviedb.org/)。我们一直在一个开源电影管理应用程序中使用他们的[API ，并取得了巨大的成功。](http://api.themoviedb.org/2.0/docs/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T11:36:09.143

快速谷歌搜索返回：~~[Internet Video Archive Movie API](http://api.internetvideoarchive.com/MovieAPI.aspx)~~。它似乎返回 XML 数据，所以它可以为您工作。

编辑：链接已关闭（感谢@Mutant），Wayback Machine 有[一个备份](http://web.archive.org/web/20090211033739/http://api.internetvideoarchive.com/MovieAPIAvail.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T21:27:30.517

对于获取有关电影的直接信息（例如，基本类型和标题信息），Amazon Associates 数据效果很好。有一个条件是数据主要用于为亚马逊带来流量，这是需要牢记的。

应该已经编写了一个可以使用的 PHP 库：http: [//aws.amazon.com/associates/](http://aws.amazon.com/associates/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-28T21:59:00.740

[烂番茄](http://www.rottentomatoes.com/)有一个免费的 REST API ( [developer.rottentomatoes.com](http://developer.rottentomatoes.com) )。访问密钥限制为[每天 10000 次呼叫](http://developer.rottentomatoes.com/forum/read/123466)。

# latitude-longitude - 美国各州和城市的 Tiger/Lines 或 shapefile？

> ID：352458
> 
> 赞同：4
> 
> 时间：2008-12-09T11:34:34.327
> 
> 标签：latitude-longitude, states, city, tiger-lines

我被要求根据美国的州和城市生成一些人口统计报告（犯罪率、出生/死亡等）。我拥有所有人口统计数据（由我们的客户提供），但似乎找不到任何具有美国各州及其城市边界（阅读：纬度/经度）的地方。

我们的数据是经纬度数据点（例如犯罪、出生等），我们希望获取一些映射报告并使用 Sql 服务器进行数据挖掘（我们使用的是 MS Sql 2008，但这不应该影响这一点问题）。

所以..谁能指导我到有一些*州和城市边界来源*的地方？[我知道我们的政府在美国人口普查局](http://www.census.gov/)免费提供所有这些信息，但我似乎无法理解它在哪里找到以及如何消化这些信息。

我假设这些信息将采用纬度/经度多边形的形式（例如 shapefile 等），然后我可以将其导入数据库并挖掘。

有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-05-30T17:42:43.850

有点晚了，但万一有人像我一样偶然发现：

要获取城市边界层，您可以导航到您感兴趣的年份的“下载 Shapefile”，然后下拉到城市边界层，即“Places”。（这对我来说不是一个足够直观的名字......）

[http://www.census.gov/cgi-bin/geo/shapefiles2011/main](http://www.census.gov/cgi-bin/geo/shapefiles2011/main)

这是 2011 年 shapefile 的链接。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-14T01:41:09.237

这是[2008 TIGER/Line shapefiles](http://www2.census.gov/cgi-bin/shapefiles/national-files)的链接，听起来查看[TIGER/Line Shapefiles FAQ](http://www.census.gov/geo/www/tiger/faq.html)可能会有所帮助[——2008 年数据集主页上的](http://www.census.gov/geo/www/tiger/tgrshp2008/tgrshp2008.html)其他信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-11T13:26:34.570

我可以建议帖子[http://adventuresdotnet.blogspot.com/2009/06/sql-server-2008-importing-tigerline.html](http://adventuresdotnet.blogspot.com/2009/06/sql-server-2008-importing-tigerline.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-02-07T15:22:49.213

我知道人口普查有时很难导航。尝试访问 nationalatlas.gov 上的国家地图集以及[http://nationalmap.gov/viewer.html上的国家地图](http://nationalmap.gov/viewer.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T13:35:02.023

我认为您正在寻找[GIS 数据](http://en.wikipedia.org/wiki/Geographic_information_system "地理信息系统 - 维基百科，免费的百科全书")。例如，我找到了[美国人口普查局 TIGER/Line 2007FE Shapefiles Mississippi, United States](http://data.geocomm.com/catalog/US/61088/group214.html "美国人口普查局 TIGER/Line 2007FE Shapefiles 美国密西西比州")虽然我不确定您从下载中得到了什么，也不知道如何利用这些信息......

HTH。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-08-22T18:42:09.140

无法使用老虎..某事网站。背部疼痛。只需在下面的位置下载文件，并可以根据您的需要进行修剪。

[http://www.nws.noaa.gov/geodata/catalog/national/html/cities.htm](http://www.nws.noaa.gov/geodata/catalog/national/html/cities.htm)

# sql-server - 在远程位置之间共享数据

> ID：352462
> 
> 赞同：2
> 
> 时间：2008-12-09T11:37:27.847
> 
> 标签：sql-server, database, synchronization, replication, infrastructure

我目前正在估计如何在不同地理位置的办公室之间最好地共享数据。
我目前的偏好是使用[SQL Server 合并复制](http://msdn.microsoft.com/en-us/library/ms151198.aspx)并拥有一个主数据库和少数订阅者。

该系统还需要允许一些工作场所断开连接（建筑工地没有或很少连接）。

数据量不会很大，我们谈论的是在制造工厂、少数区域办事处和工作地点之间共享来自定制 ERP 系统的数据。

[Sync Framework](http://msdn.microsoft.com/en-us/sync/default.aspx)看起来也不错，似乎在*SQL Server 2008*中有很好的支持。

1.  我应该调查哪些其他经过验证的系统可以满足这些需求？
2.  对于在类似环境中共享数据的经验的人，您有什么特别的建议和技巧吗？
3.  处理数据冲突对您来说有多困难？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T13:39:52.543

绝对坚持使用 SQL Server 复制，然后决定走“构建自己的复制框架”的道路。我已经看到一些应用程序以这种方式变得糟糕透顶。

我已经为断开连接模型中的快照复制设置了环境，但远程站点是只读的。他们工作得很好，问题很少。

我也有兴趣听听人们对同步框架的体验。

你可能想看看微软称之为*[智能客户端](http://msdn.microsoft.com/en-au/library/aa480482.aspx)*的东西 ，这是微软为可能具有临时网络连接的应用程序谈论的一种架构。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T17:31:25.713

我已经用#cycnus 讨论了我自己对SQLServer2005 的体验。我的回答不是真实的，只是提出我非常感兴趣的主题的一些论据。

1.  我们对“并非始终连接”站点的选择是实施基于 Web 的合并复制。数据交换恰好比通过 VPN 更快（因为我们也有 LAN 合并复制的组合）。我将通过网络轻松获得每秒 30 到 40 行的速度（512 Down/128 Up，共享），而我将通过 LAN（海外，256 Up/Down，专用）获得每秒 5 行的速度。不要问我为什么...
2.  提示很多：订阅应该是客户端类型（数据在分发之前基本上是从订阅者到发布者的循环）。主键应该始终是 GUID，原因有很多[，](https://stackoverflow.com/questions/230351/what-should-i-consider-when-selecting-a-data-type-for-my-primary-key#232985)但也有复制问题：我们确信任何新创建的记录都能够找到到达发布者的方式，因为它的 PK 将是唯一的。此外，我最近在我的一个复制中遇到了一个不收敛的问题（糟糕的经验，[在这里](https://stackoverflow.com/questions/343224/ms-sql-server-2005-non-convergent-data-after-replication)公开），我很高兴不使用自然键，因为问题发生在潜在的“自然键”列上。
3.  数据冲突应该基本上仅限于工作组织问题，其中（通常出于不良原因）相同的数据被不同地方的不同用户同时修改。使用我们的“PK 是 GUID 规则”，我们不会在这些特定情况下发生冲突。
4.  即使复制正在运行，也应该始终可以修改其数据库结构。在运行合并复制过程时，可以继续添加字段、索引、约束。我还找到了一种在不重新初始化复制过程的情况下添加表的解决方法（[在这里](https://stackoverflow.com/questions/220890/how-do-i-add-a-new-replicated-table-to-a-sql-server-2005-db-that-is-in-merge-re#221295)公开，仍然不明白为什么我在这个答案上被否决了！）

# javascript - 使用 JQuery 解析 JSON

> ID：352463
> 
> 赞同：7
> 
> 时间：2008-12-09T11:38:00.840
> 
> 标签：javascript, jquery, json

我有一个 JSON 如下

```
{
  columns      : [RULE_ID,COUNTRY_CODE],
  RULE_ID      : [1,2,3,7,9,101,102,103,104,105,106,4,5,100,30], 
  COUNTRY_CODE : [US,US,CA,US,FR,GB,GB,UM,AF,AF,AL,CA,US,US,US]
} 
```

我需要从列条目中检索列名，然后使用它来使用 jquery 搜索其余条目。例如，我使用每列

```
jQuery.each(data.columns, function(i,column)) 
```

我需要使用从上一个循环中获得的值来循环其余条目。即**没有硬编码 COUNTRY_CODE 或 RULE_ID**。使用 Jquery 的最佳方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-09T11:58:36.103

```
jQuery.each(data.columns, function(i,column) {
    jQuery.each(data[column], function(i, row) {
    ....
    });
}); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T22:53:00.620

一些评论：

Paolo 是对的，您可以使用 data[column] 来获取值列表：

```
jQuery.each(data.columns, function(iCol,column) {
    jQuery.each(data[column], function(iRow, row) {
    ....
    });
}); 
```

您需要列信息吗？您可以通过直接遍历数据来获取“列”列表：

```
for( var column in data )
{
    jQuery.each(data[column], function(i, row) {
    ....
    });
} 
```

这不是一个真正的问题，但您的 JSON 不是有效的 JSON，我希望这只是一个示例，而不是您的真实数据：

```
{
  "columns"      : ["RULE_ID","COUNTRY_CODE"],
  "RULE_ID"      : [1,2,3,7,9,101,102,103,104,105,106,4,5,100,30], 
  "COUNTRY_CODE" : ["US","US","CA","US","FR","GB","GB","UM","AF","AF","AL","CA","US","US","US"]
} 
```

# html - 如何在 Firefox 中设置文件输入字段的样式？

> ID：352467
> 
> 赞同：29
> 
> 时间：2008-12-09T11:38:46.987
> 
> 标签：html, css, forms, file

我目前正在为一个有大量表单的网站做前端，所有的样式都在 IE 中看起来很漂亮，但我刚刚注意到在 Firefox 中，文件输入字段没有响应我的任何样式，所有其他输入字段的类型很好。我已经在 Firebug 中检查了它，并将正确的样式与它相关联，但没有改变它的外观。

如果这不是代表我的一个完整的大脑放屁，那么这是 Firefox 中的一个已知问题吗？如果是这样，我以前怎么从未注意到它？

这是代码示例。

CSS：

```
form.CollateralForm input,
form.CollateralForm textarea
{
    width:300px;
    font-size:1em;
    border: solid 1px #979797;
    font-family: Verdana, Helvetica, Sans-Serif;
} 
```

HTML：

```
<form method="bla" action="blah" class="CollateralForm">
   <input type="file" name="descriptionFileUpload" id="descriptionFileUpload" />
</form> 
```

我也尝试过对其应用一个类，但这也不起作用。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2013-01-30T13:47:57.887

上面的许多答案都很老了。**2013 年出现了一个更简单的解决方案**：几乎所有当前的浏览器......

*   铬合金
*   IE
*   苹果浏览器
*   带有几行修复的 Firefox

通过标签的点击事件。在这里试试：http: [//jsfiddle.net/rvCBX/7/](http://jsfiddle.net/rvCBX/7/)

*   `<label>`设置您希望文件上传的样式。
*   在标签上设置`for="someid"`属性
*   创建一个`<input id="someid">`隐藏的元素。

点击标签会将事件传递到 Chrome、IE 和 Safari 中的文件上传。

[Firefox 需要一个非常小的解决方法，此答案中对此进行了详细说明](https://stackoverflow.com/questions/7742278/workaround-for-file-input-label-click-firefox)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-08-08T18:51:47.243

Firefox 可以使用 HTML 输入 size 属性进行攻击：size="40" 同时使用 css 宽度来控制布局中字段 + 按钮的全宽

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-07-17T10:13:14.283

假设你有你的输入：

```
<input style="display:none" id="js-choose-file" type="file"> 
```

使用 jQuery 创建一个假按钮。

```
<a id="js-choose-computer" href="javascript:void(0);">From Computer</a> 
```

以您喜欢的方式为上面的按钮设置样式。然后：

```
$("#js-choose-computer").on("click", function() {
  $("#js-choose-file").click();
  return false;
}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-11-05T04:18:24.887

[从 Firefox 82 开始，根据::file-selector-button](https://developer.mozilla.org/en-US/docs/Web/CSS/::file-selector-button)伪选择器，不再需要 hack 。当前版本的 Webkit/Blink 浏览器（Chrome、Edge、Safari、Opera）目前不支持它，但可以使用`::-webkit-file-upload-button`非标准伪类来处理。

这样，您的 HTML 可以保持语义化，并且不需要任何 hack。

来自上述 MDN 参考的示例代码：

HTML

```
<form>
  <label for="fileUpload">Upload file</label>
  <input type="file" id="fileUpload">
</form> 
```

CSS

```
input[type=file]::file-selector-button {
  border: 2px solid #6c5ce7;
  padding: .2em .4em;
  border-radius: .2em;
  background-color: #a29bfe;
  transition: 1s;
}

input[type=file]::file-selector-button:hover {
  background-color: #81ecec;
  border: 2px solid #00cec9;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-11T02:23:57.690

Customformsjs 插件在其文件模块类中解决了这个问题。
[http://customformsjs.com/doc/File.html](http://customformsjs.com/doc/File.html)

[http://customformsjs.com/doc/File.js.html](http://customformsjs.com/doc/File.js.html)

基本上，它可以对具有一些限制的文件输入字段进行样式设置。它的工作原理是将其包装在一个容器中并使其透明，以便您单击它。演示页面显示了它的作用

* * *

## 回答 #6

> 赞同：-5
> 
> 时间：2008-12-09T11:52:20.750

在 css 类的属性前面使用作弊码（#）说：

```
form.CollateralForm input,
form.CollateralForm textarea
{
    width:300px;  //for firefox
    #width:200px; //for IE7
    _width:100px; //for IE6
    font-size:1em;
    border: solid 1px #979797;
    font-family: Verdana, Helvetica, Sans-Serif;
} 
```

# mobile - iPhone 的网站 - 但其他平台呢？

> ID：352468
> 
> 赞同：6
> 
> 时间：2008-12-09T11:38:54.613
> 
> 标签：mobile, iphone, browser

我最近从[css-tricks.com](http://css-tricks.com)博客[#38: Basics & Tips on Design for iPhone 上](http://css-tricks.com/video-screencasts/38-basics-tips-on-designing-for-the-iphone/)完成了 Chris Coyier 教程。不用说，我非常兴奋，并建议我做一些代码猴子工作，我们现在可以为他的客户提供 iPhone 网站。他说很酷，但其他移动设备呢？好问题。那么为 Android、Blackberry、WindowsMo​​bile 等设计网站的低谷是什么？人们是否在为其他平台而烦恼？谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-09T14:01:57.070

### 最近的 Webkit 和 Opera：

对于 iPhone Safari、Opera Mobile 和 Android 上的 Webkit 开发是相似的（[但不完全相同](http://www.quirksmode.org/blog/archives/2009/10/there_is_no_web.html)），并且它们的开发非常简单。

您可以依赖 CSS2.1 和 JavaScript+DOM（但要小心[UI 事件](http://www.quirksmode.org/mobile/tableTouch.html#t01)）。只需对样式表进行少量更改，您就可以为您的常规网站提供服务。

诀窍在于提供这些样式表。**不要使用`User-Agent`字符串**。

因为有些移动浏览器读取手持媒体，有些坚持屏幕样式并假装拥有 960 像素宽的屏幕 (iPhone :/)，所以您需要同时提供移动样式表：

```
<link media="handheld" ...>
<link media="screen and max-device-width:480px" ...> 
```

后者是[CSS3 媒体查询](http://www.w3.org/TR/css3-mediaqueries/)- 非常有用，也可以与其他移动浏览器一起使用（您可以在样式表中使用它`@media {}`）。

不要依赖`:hover`或`onmouseover`因为这些事件在触摸屏上不起作用。

`onclick`延迟了，`mousemove`可能无法正常工作。自定义 DHTML 小部件（下拉菜单、滑块）和拖放在触摸屏上不起作用，除非您使用[触摸事件](http://www.quirksmode.org/mobile/tableTouch.html)（谢天谢地，所有最新的浏览器都采用了）。

视口

除了 Apple 的专有（以及恕我直言，标记和布局之间的不灵活和违反分离）之外，`<meta name=viewport>`请查看[CSS3 @viewport](http://dev.w3.org/csswg/css-device-adapt/)，它目前在最新的 Opera 中得到支持，`@-o-viewport`希望其他人也能效仿。

## 模拟器/模拟器

要在 Opera Mobile 中测试页面，请获取[模拟器](http://www.opera.com/developer/tools/)（或只是较旧的桌面版本并选择查看 → 小屏幕）。

Opera Mini 很特别，因为 CSS 被重新格式化了一点，DHTML 在服务器端执行，这并不总是能提供您期望的结果。有[模拟器可用](http://www.operamini.com/demo/)。

### 安卓

你需要 Android SDK，使用命令行来启动其笨重的 UI，下载一堆包，创建具有许多不相关的模糊设置的虚拟设备，耐心等待这个怪物加载并将计算机的粉丝变成四轴飞行器，然后你就可以 sss。 “浏览器”中的 .sss..slooowlyyyy 测试（我的英特尔 i5 太慢，无法模拟 Galaxy Tab - 浏览器“停止响应”，甚至在我完成输入 URL 之前）

更容易获得带有 Android 的手机/平板电脑并在真实设备上进行测试（但避免使用三星的播放器“iPod”等价物，因为它与过时的软件相去甚远）。

对于不喜欢 Linux 做事方式的人来说，Android 浏览器真的很痛苦——只是为了阅读 JS 控制台，你需要摆弄远程调试连接和命令行上的日志过滤。

### Firefox Mobile（以前的 Fennec）

有[模拟器可用](http://www.mozilla.com/en-US/mobile/download/)（移动下载下方的“Windows / Mac OS X / Linux”链接不是桌面版本，而是mobile-for-desktop-OS）。

模拟器非常基础，Mobile Firefox 本身非常好，恕我直言，例如`overflow:scroll`效果很好，而基于 WebKit 的浏览器溢出实现在非常不直观和完全损坏之间变化。

### 袖珍IE：

Windows Mobile < 7 的 PIE 与 Windows 上的 IE 不同。它与 IE4 一样原始且有缺陷，但（几乎不）支持一些令人惊讶的高级属性，例如`display:table`.

它同时读取样式表`handheld`和`screen`样式表，这违反了标准并自取其辱。如果您要支持 PIE，则将指向`handheld`样式表的链接放在最后并反转/覆盖其中的屏幕样式中的所有规则。

反正已经死了，很难搞到模拟器。

Windows Phone 7 目前带有类似 IE7 的版本，微软后来承诺提供 IE9 级别的东西。

### 新（少数）黑莓

最新的基于 WebKit 的 BlackBerry 浏览器相当不错，您可以将其视为一等公民（参见顶部链接的 WebKits 比较）。

### 目前最流行的BlackBerry & OpenWave、Blazer等：

在 BB OS6 之前，这是一场噩梦。只有基本的 HTML 有效。CSS 适用于某些模型，但原始且损坏。JavaScript 仅适用于某些模型，而且速度*非常*慢且缺乏（甚至忘记基本的 DHTML）。

RIM 提供免费的 BB 模拟器（需要烦人的注册）。如果你不走运，它会正确启动*一次*，然后你必须完全重新安装它:)

[低端手机上的数百个其他移动浏览器也是如此（由具有不错模拟器](http://developer.openwave.com/dvl/tools_and_sdk/phone_simulator/)的 OpenWave 等提供支持）。您必须为他们准备 1 列的基本 HTML 精简网站。

### 谷歌无线转码器

即使您为每个移动设备创建了漂亮的 (X)HTML，Google 移动搜索的用户也永远不会看到它！取而代之的是，每个页面都将通过“无线转码器”进行代理，它残酷地切断代码，剥离所有样式表和脚本（无论浏览器是否支持它们），甚至`<font>`:(

# c# - 如何创建不可变类？

> ID：352471
> 
> 赞同：123
> 
> 时间：2008-12-09T11:39:25.377
> 
> 标签：c#, .net, immutability

我正在创建一个不可变的类。
我已将所有属性标记为只读。

我有一个班级项目清单。
虽然如果属性是只读的，则可以修改列表。

公开列表的 IEnumerable 使其不可变。
我想知道使类不可变必须遵循的基本规则是什么？

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2008-12-09T11:47:59.027

我认为你在正确的轨道上-

*   注入类的所有信息都应在构造函数中提供
*   所有属性都应该只是吸气剂
*   如果将集合（或数组）传递给构造函数，则应将其复制以防止调用者稍后对其进行修改
*   如果你要返回你的集合，要么返回一个副本，要么返回一个只读版本（例如，使用[ArrayList.ReadOnly](http://msdn.microsoft.com/en-us/library/system.collections.arraylist.readonly.aspx)或类似的 - 你可以将它与前一点结合起来并*存储*一个只读副本以在何时返回调用者访问它），返回一个枚举器，或使用其他一些允许只读访问集合的方法/属性
*   请记住，如果您的任何成员是可变的，您仍然可能具有可变类的外观 - 如果是这种情况，您应该复制您想要保留的任何状态并避免返回整个可变对象，除非您复制它们在将它们返回给调用者之前 - 另一种选择是只返回可变对象的不可变“部分” - 感谢@Brian Rasmussen 鼓励我扩展这一点

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-12-09T11:47:33.927

为了不可变，您的所有属性和字段都应该是只读的。任何列表中的项目本身都应该是不可变的。

您可以按如下方式创建只读列表属性：

```
public class MyClass
{
    public MyClass(..., IList<MyType> items)
    {
        ...
        _myReadOnlyList = new List<MyType>(items).AsReadOnly();
    }

    public IList<MyType> MyReadOnlyList
    {
        get { return _myReadOnlyList; }
    }
    private IList<MyType> _myReadOnlyList

} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-09T11:57:03.580

另外，请记住：

```
public readonly object[] MyObjects; 
```

即使用 readonly 关键字标记也不是不可变的。您仍然可以通过索引访问器更改单个数组引用/值。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-09T13:18:33.367

使用`ReadOnlyCollection`类。它位于`System.Collections.ObjectModel`命名空间中。

在返回列表（或在构造函数中）的任何内容上，将列表设置为只读集合。

```
using System.Collections.ObjectModel;

...

public MyClass(..., List<ListItemType> theList, ...)
{
    ...
    this.myListItemCollection= theList.AsReadOnly();
    ...
}

public ReadOnlyCollection<ListItemType> ListItems
{
     get { return this.myListItemCollection; }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2020-11-11T21:02:55.190

您只需要 L...Ehm`record`和**C# 9.0**或更高版本。

```
public record Customer(string FirstName, string LastName, IEnumerable<string> Items);

//...

var person = new Customer("Test", "test", new List<string>() { "Test1", "Test2", "Test3" });
// you can't change anything within person variable
// person.FirstName = "NewName"; 
```

这将被转换为名为 Customer 的不可变类，具有三个`FirstName`属性`LastName`和`Items`。

如果您需要一个不可变（*只读*）集合作为类的属性，最好将其`IEnumerable<T>`公开`ReadOnlyCollection<T>`为`System.Collections.Immutable`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-09T12:38:20.047

另一种选择是使用访问者模式，而不是暴露任何内部集合。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-11-12T12:36:55.680

使用[ReadOnlyCollection](https://docs.microsoft.com/en-us/dotnet/api/system.collections.objectmodel.readonlycollection-1?view=netframework-4.8)将限制客户端对其进行修改。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-11-05T20:57:09.027

最初的问答日期是 2008 年底，现在有一个**System.Collections.Immutable 命名空间**，我相信它可以追溯到最早的 .NET Core (1.0) 。命名空间在 .NET Standard（当前版本 2.1）和 .NET Framework（当前版本 4.8）中仍然不可用。这个命名空间有很多不可变的集合，包括在原始问题中询问的**ImmutableList 。**但是，我相信 System.Collections.Immutable 命名空间可能会出现在 .NET 5 中，而 .NET 5 目前处于候选版本 2 中。

**此外，从 C# 6 开始，您只需使用{ get;**就可以拥有不可变的自动实现属性。**}**。

# .net - 团队成员之间的项目装配引用

> ID：352472
> 
> 赞同：3
> 
> 时间：2008-12-09T11:40:00.510
> 
> 标签：.net, assemblies, assembly-reference-path

我很想知道您在项目参考中使用什么类型的结构？

在我工作的地方，开发人员有一个名为 AssemblyCache (\\MACHINENAME\AssemblyCache) 的共享文件夹，该文件夹通过 Windows 2008 AD 中的 GPO 映射到 R:\（与 Developers AD 组相关联）。

我们的共享组件具有构建后事件，将它们复制到如下内容：

R:\.Net %VERSION%\Project\%SOMETHING%

有时，如果它对项目或特定的东西是共同的，那么它后面会跟着“Common”。.Net 版本文件夹下还有一个用于共享内容的公共目录。

这是多个解决方案上的大型项目可以从一个共同的地方引用程序集。

构建机器还有一个共享驱动器，其共享名称与开发人员映射到 S: 的共享名称相同。这使他们能够在需要时获得最新的工作版本。

所有这些都是为了让某人可以在一台新 PC 上打开一个项目，而不必将引用复制到不同的位置，并确保 dev a 从与 dev b 相同的位置引用程序集等......

这个解决方案对我们很有效，所以我想知道您有什么解决方案（如果有的话）可以确保所有开发人员从同一路径引用程序集？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T11:47:32.787

*   将所有参考程序集存储在源代码管理中。
*   始终获取代码以使代码与程序集具有相同的*相对*路径（例如 ../../CommonLibraries）
*   每个人都提取到本地驱动器

必须引用网络驱动器会导致各种问题：

*   以后版本没办法分支，现有分支参考早期版本
*   离线工作的困难
*   构建机器等取决于另一台机器 - 它不是独立的构建
*   性能不是很好

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T11:49:02.643

在一个项目中，我们将程序集添加到源代码存储库中。这也不是完美的，但它可以防止意外获得更新版本的参考，这在使用文件共享时很容易发生。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T11:55:44.113

您不需要创建网络共享。我认为您可以使用 windows subst 命令为本地文件夹创建虚拟驱动器号，例如...

```
subst R: "C:\.Net %VERSION%\Project\%SOMETHING%" 
```

这里的优点是可以将任意路径路由到程序集的标准定义良好的路径，因此例如可以将不同的程序集版本重新映射到 Visual Studio 使用的固定参考路径。

# java - 使用抽象类实现接口时要声明什么（不）？

> ID：352474
> 
> 赞同：7
> 
> 时间：2008-12-09T11:40:40.553
> 
> 标签：java, class, interface, declaration, abstract

我有一个接口 A，我必须为此提供几个不同的实现。但是，这些实现共享一些辅助方法，因此我将这些方法移至抽象基类。

```
Interface A {
    void doX();
}

abstract Class B implements A {
    protected void commonY() {
        // ...
    }

    @Override
    public abstract void doX();
}

Class C extends B {
    @Override
    public void doX() {
        // ...
    }
}

Class D extends B {
    @Override
    public void doX() {
        // ...
    }
} 
```

我的代码按预期工作，但我有几个问题：

*   我应该在 B 类中声明抽象方法 doX() 吗？为什么不）？

*   我是否还应该在 C 类和 D 类上明确声明“实现 A”？为什么不）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-09T11:47:21.883

我认为最好按以下方式进行：

```
Interface A {
        void doX();
}

abstract Class B {
        protected void commonY() {
                // ...
        }
}

Class C extends B implements A{

        public void doX() {
                // ...
        }
}

Class D extends B implements A{

        public void doX() {
                // ...
        }
} 
```

您不应该将接口（方法的签名）与实现混合。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T11:44:55.630

*   我应该在 B 类中声明抽象方法 doX() 吗？为什么不）？

不，它是一个抽象类——定义接口意味着所有子类都需要实现这些方法。换句话说，它是多余的。

*   我是否还应该在 C 类和 D 类上明确声明“实现 A”？为什么不）？

不，再次 - 因为您的超类（抽象基类）实现了该接口，所以您的具体子类将保证实现该接口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T12:00:04.167

我只会抛出另一个选项。

将抽象类 B 转换为不实现 A 的 AUtil 类。方法签名可能需要使用类型为 A 的附加参数。

C 和 D 实现 A，并在内部实例化一个 AUtil。这确实允许 C 和 D 扩展其他类。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T22:04:07.597

我同意 JeeBee：考虑在抽象基类以外的地方实现您的辅助方法。

如果您的辅助方法 commonY() 仅存在于抽象基类 B 中，则所有实现接口 A 的类都必须扩展基类 B 才能利用 commonY() 的实现。但是，您可能并不总是希望被迫扩展 B 类。

另外，如果你以后想改变 commonY() 的实现怎么办？然后，您将影响接口 A 的许多实现。但是，如果您不控制接口 A 的所有这些实现，您可能会无意中影响它们的功能（以一种不好的方式）。

在这种情况下使用抽象基类可能只会带走一些灵活性，而不会给您任何回报。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T11:45:03.917

实现接口的抽象类必须实现该接口。具体来说，它必须为该接口中指定的每个方法名称和签名具有公共方法。

继承是传递的。如果类 C 派生实现接口 A 的类 B，则无需编写类 C 实现接口 A。但是，它也没有太大的危害。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T11:46:02.760

我不会声明`doX()`，`B`也不会添加“ `implements A`” `C`，`D`因为你不应该[重复自己](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)。

`doX()`中的摘要`B`没有添加任何内容，因为它已经由“ `implements A`”指定。将“ `implements A`”添加到`C`and也是如此`D`。

这些子句的唯一可能用途是文档：如果您想非常明确地表示`C`(or `D`) is-a `A`，那么您可以添加`implements`，但您应该知道这对编译器来说并不重要。

# python - 将字符串大写

> ID：352478
> 
> 赞同：59
> 
> 时间：2008-12-09T11:42:47.227
> 
> 标签：python, string

有没有人知道一种非常简单的方法，只需将字符串的第一个字母大写，而不管字符串其余部分的大小写如何？

例如：

```
asimpletest -> Asimpletest
aSimpleTest -> ASimpleTest 
```

我也希望能够做所有的字符串长度。

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2013-04-25T10:29:58.383

```
>>> b = "my name"
>>> b.capitalize()
'My name'
>>> b.title()
'My Name' 
```

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2008-12-09T11:52:33.777

@saua是对的，[并且](https://stackoverflow.com/a/352494/2285236)

```
s = s[:1].upper() + s[1:] 
```

适用于任何字符串。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-01-04T18:30:46.873

怎么样`your_string.title()`？

例如`"banana".title() -> Banana`

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-09T11:47:59.650

```
s = s[0].upper() + s[1:] 
```

这应该适用于每个字符串，除了空字符串（when `s=""`）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-03-07T18:57:11.420

这实际上给了你一个大写的单词，而不是仅仅大写第一个字母

大写 -> 大写

```
def capitalize(str): 
    return str[:1].upper() + str[1:].lower()....... 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-08-17T07:42:47.233

大写第一个单词；

```
a="asimpletest"
print a.capitalize() 
```

要使所有字符串大写，请使用以下提示；

```
print a.upper() 
```

这是我认为最简单的一个。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-11-12T09:38:47.077

您可以使用[str.capitalize()](https://docs.python.org/2/library/stdtypes.html#str.capitalize)函数来做到这一点

```
In [1]: x = "hello"

In [2]: x.capitalize()
Out[2]: 'Hello' 
```

希望能帮助到你。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-04-29T04:47:29.293

可以在此处找到有关字符串函数的文档[https://docs.python.org/2.6/library/string.html#string-functions](https://docs.python.org/2.6/library/string.html#string-functions)
下面的代码将第一个字母大写，并以空格作为分隔符

```
s="gf12 23sadasd"
print( string.capwords(s, ' ') ) 
```

> GF12 23sadasd

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2015-09-24T23:33:33.397

```
str = str[:].upper() 
```

在我看来，这是最简单的方法

# delphi - Delphi 警告 - W1002 符号“FileSetDate”特定于平台

> ID：352479
> 
> 赞同：18
> 
> 时间：2008-12-09T11:42:59.503
> 
> 标签：delphi

当我在 Delphi 2006 下编译我的应用程序时，我收到以下警告 [Pascal 警告]- W1002 Symbol 'FileSetDate' is specific to a platform

我必须做些什么来抑制这个警告？

编码

```
MyLastError:= FileSetDate( Files[ i ].Handle, DateTimeToFileDate( arcDate ) ); 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-09T11:48:18.887

1）在项目选项中，您可以选择要查看的编译器消息。如果您不关心平台独立性，您可以在此处关闭平台警告。

2）另一种方法是禁用代码特定部分的警告：

```
{$WARN SYMBOL_PLATFORM OFF}
// Your code
{$WARN SYMBOL_PLATFORM ON} 
```

有关选项的完整列表，请查看主题“$WARN”的 Delphi 帮助文件

3）最后一种方法是添加

```
{$WARNINGS OFF}
// Your code
{$WARNINGS ON} 
```

但这很危险，因为*所有*警告都会被禁止。

4）此外，正如其他答案已经建议的那样，您可以切换到适用于文件名（即字符串）的**平台独立**变体`FileSetDate`，但据我所知，这不是您的问题。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-09T12:33:53.677

虽然DR的答案解决了警告，但它不是正确的解决方案。

您应该使用与平台无关的 FileSetDate 版本：

```
function FileSetDate(const FileName: string; Age: Integer): Integer; overload; 
```

也在 SysUtils 中。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-09T11:57:01.020

您可以关闭平台单元和平台符号编译器警告。它们已过时（默认情况下在 Delphi 2009 中禁用）。它们是在有用于 Linux 的 Delphi (Kylix) 时引入的。它们不再具有意义。尤其是用 Delphi Prism 替换 Delphi.NET。您可以在“项目选项”对话框（编译器消息）中为整个项目关闭它们。

# sql - 主从 SQL 查询

> ID：352503
> 
> 赞同：2
> 
> 时间：2008-12-09T11:50:11.830
> 
> 标签：sql

主表包含 ID 和 PersonName。
课程表包含 ID、CourseName。
明细表包含 ID、MasterID、CourseID、StartDate、EndDate

我想创建显示人员列表 (PersonName) 和他们上过的唯一最后一门课程的报告（因此每个人只列出一次）：

PersonName - CourseName - StartDate - EndDate

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T11:56:17.870

```
select m.PersonName, c.CourseName
from   Master m
join   Detail d on d.MasterID = m.ID
join   Course c on c.ID = d.CourseID
where  d.StartDate = (select max(d2.StartDate)
                      from   Detail d2
                      where  d2.MasterID = m.ID
                     ) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T12:20:05.403

```
 Select personname,coursename from details 
    inner join course on course.id = details.courseid 
    inner join master on master.id = details.masterid
    inner join (select max(startdate) ,  courseid,masterid 
    from details group by masterid,courseid ) as tb1
    on tb1.courseid = details.courseid and tb1.masterid = details.masterid 
```

# .net - .NET assemblies and DLL rebasing

> ID：352519
> 
> 赞同：11
> 
> 时间：2008-12-09T11:54:19.340
> 
> 标签：.net, assemblies, rebasing, base-address

According to [this article](http://msdn.microsoft.com/en-us/magazine/cc163610.aspx) rebasing is not necessary for .NET assemblies due to JIT compilation of the code. The article states:

*"JIT-compiled code does not have a rebasing problem since the addresses are generated at run time based on where the code is placed in memory. Also, MSIL is rarely affected by base address misses since MSIL references are token-based, rather than address-based. Thus when the JIT compiler is used, the system is resilient to base address collisions."*

However, I have noticed that VS2008 assigns the default 0x0400000 base address to all assemblies (project properties > build > advanced) and if I do a `listdlls /r` for my process all my .NET assemblies are in fact rebased per default.

If I assign addresses myself, no rebasing is done.

My question is: What is rebased in this case and why?

EDIT: I should add that I am not talking about NGen'ed assemblies.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T13:24:32.280

CLR Loading mechanism uses LoadLibrary behind the scenes, so this is what you observe: 2 assemblies can't be loaded at the same address. Now what people often mean when they try to rebase a dll is to avoid the perf. hit of fix-ups, e.g. absolute addresses & function calls need to be "relocated" with the loaded base-address. CLR does not have this problem (not sure about static data in the application, which is the second part of those fix-ups, I would need to read up on this), because MSIL code is loaded on-demand when you call a function in the managed code. The MSIL then gets jitted and placed on the heap, a different one from normal object heap I believe, in the same manner CLR allocates and lays out new objects in your application.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T13:12:08.123

What OS are you running? I know that the vista and beyond introduced ASLR which randomizes the address space it loads dlls into. This happens for system dlls but not sure about .net - maybe something to look into.

# c# - 使用 PostSharp 添加 OnException 属性

> ID：352527
> 
> 赞同：4
> 
> 时间：2008-12-09T11:56:21.973
> 
> 标签：c#, logging, aop, postsharp

我正在探索一些 AOP，似乎使用 .NET PostSharp 是要走的路。

发生异常时，我想对数据库进行一些简单的日志记录。但是，我发现很难找到任何超越基础的使用 PostSharp 的真实可靠示例。我尝试了以下方法：

```
[Serializable]
public sealed class LogExceptionAttribute : ExceptionHandlerAspect
{
    public override void OnException(MethodExecutionEventArgs eventArgs)
    {
        //do some logging here
    }
} 
```

然后将`[LogException]`属性附加到方法

但我得到一个编译错误：

```
Error   7   The type "CoDrivrBeta1.Classes.LogExceptionAttribute" or one of its ancestor should be decorated by an instance of MulticastAttributeUsageAttribute.    C:\work\CoDrivrBeta1\CoDrivrBeta1\EXEC  CoDrivrBeta1 
```

我不得不承认我对此很陌生，但这似乎是一个有趣的概念，我认为我只需要指出正确的方向

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T19:18:57.027

我通过扩展它来工作`OnExceptionAspect`：

```
[Serializable]
public sealed class LogExceptionAttribute : OnExceptionAspect
{
    public override void OnException(MethodExecutionEventArgs eventArgs)
    {
        //do some logging here
    }
} 
```

* * *

**原帖：**

它希望您添加 Multicast 属性：

```
[Serializable]
[MulticastAttributeUsage(... Add Appropriate MulticastTargets ...)]
public sealed class LogExceptionAttribute : ExceptionHandlerAspect
{
    public override void OnException(MethodExecutionEventArgs eventArgs)
    {
        //do some logging here
    }
} 
```

有关详细信息，请参阅此链接：http: [//doc.postsharp.org/1.0/UserGuide/Laos/Multicasting/Overview.html](http://doc.postsharp.org/1.0/UserGuide/Laos/Multicasting/Overview.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T19:18:28.307

我使用 OnMethodBoundaryAspect 而不是 ExceptionHandlerAspect 没有问题。而且我也没有把我的密封起来。

# linux - /usr/bin/env 关于 shebang 线特性的问题

> ID：352532
> 
> 赞同：7
> 
> 时间：2008-12-09T11:58:02.313
> 
> 标签：linux, apache, unix, environment, shebang

**问题**：

*   如果将 shell 脚本插入 shebang 行，内核会做什么？
*   内核如何知道要启动哪个解释器？

**说明**：

我最近想围绕*/usr/bin/env*编写一个包装器，因为我的 CGI 环境不允许我设置*PATH*变量，但全局除外（这当然很糟糕！）。

所以我想，“好的。让我们设置 PREPENDPATH 并将*PATH*设置在 env 的包装器中。”。生成的脚本（此处称为*env.1*）如下所示：

```
#!/bin/bash
/usr/bin/env PATH=$PREPENDPATH:$PATH $* 
```

看起来应该可以。在设置 PREPENDPATH 后，我检查了它们的反应：

```
$ which /usr/bin/env python
/usr/bin/env
/usr/bin/python

$ which /usr/bin/env.1 python
/usr/bin/env
/home/pi/prepend/bin/python 
```

看起来绝对*完美*！到现在为止还挺好。但是看看“Hello World！”会发生什么。

```
# Shebang is #!/usr/bin/env python
$ test-env.py
Hello World!

# Shebang is #!/usr/bin/env.1 python
$ test-env.1.py
Warning: unknown mime-type for "Hello World!" -- using "application/*"
Error: no such file "Hello World!" 
```

我想我错过了一些关于 UNIX 的基本知识。

*即使查看了原始env*的源代码，我也很迷茫。它设置环境并启动程序（或者在我看来......）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-11T06:01:53.590

首先，您应该很少使用`$*`并且几乎总是应该使用`"$@"`。这里有很多关于 SO 的问题，可以解释原因的来龙去脉。

其次 - 该`env`命令有两个主要用途。一是打印当前环境；另一种是完全控制命令运行时的环境。您正在演示的第三个用途是修改环境，但坦率地说，没有必要这样做——shell 完全有能力为您处理。

模式一：

```
env 
```

模式二：

```
env -i HOME=$HOME PATH=$PREPENDPATH:$PATH ... command args 
```

这个版本取消了所有继承的环境变量，并`command`在 ENVVAR=value 选项设置的环境下运行。

第三种模式 - 修改环境 - 不太重要，因为您可以使用常规（文明）外壳很好地做到这一点。（这意味着“不是 C shell”——同样，还有其他关于 SO 的问题的答案可以解释这一点。）例如，你可以很好地做到：

```
#!/bin/bash
export PATH=${PREPENDPATH:?}:$PATH
exec python "$@" 
```

这坚持`$PREPENDPATH`设置为环境中的非空字符串，然后将其添加到`$PATH`，并导出新的 PATH 设置。然后，使用新的 PATH，它`python`使用相关参数执行程序。将`exec`shell 脚本替换为`python`. 请注意，这与以下内容完全不同：

```
#!/bin/bash
PATH=${PREPENDPATH:?}:$PATH exec python "$@" 
```

从表面上看，这是一样的。但是，这将`python`在预先存在的 PATH 上执行找到的，尽管在进程的环境中使用 PATH 的新值。因此，在示例中，您最终将执行 Python from`/usr/bin`而不是 from `/home/pi/prepend/bin`。

在您的情况下，我可能不会使用`env`并且只会使用具有显式导出的适当脚本变体。

该`env`命令不寻常，因为它无法识别用于将选项与命令的其余部分分开的双破折号。这部分是因为它不需要很多选项，部分是因为不清楚 ENVVAR=value 选项应该出现在双破折号之前还是之后。

我实际上有一系列用于运行（不同版本）数据库服务器的脚本。这些脚本真正使用`env`（和一堆自制程序）来控制服务器的环境：

```
#!/bin/ksh
#
# @(#)$Id: boot.black_19.sh,v 1.3 2008/06/25 15:44:44 jleffler Exp $
#
# Boot server black_19 - IDS 11.50.FC1

IXD=/usr/informix/11.50.FC1
IXS=black_19
cd $IXD || exit 1

IXF=$IXD/do.not.start.$IXS
if [ -f $IXF ]
then
    echo "$0: will not start server $IXS because file $IXF exists" 1>&2
    exit 1
fi

ONINIT=$IXD/bin/oninit.$IXS
if [ ! -f $ONINIT ]
then ONINIT=$IXD/bin/oninit
fi

tmpdir=$IXD/tmp
DAEMONIZE=/work1/jleffler/bin/daemonize
stdout=$tmpdir/$IXS.stdout
stderr=$tmpdir/$IXS.stderr

if [ ! -d $tmpdir ]
then asroot -u informix -g informix -C -- mkdir -p $tmpdir
fi

# Specialized programs carried to extremes:
#   * asroot sets UID and GID values and then executes
#   * env, which sets the environment precisely and then executes
#   * daemonize, which makes the process into a daemon and then executes
#   * oninit, which is what we really wanted to run in the first place!
# NB: daemonize defaults stdin to /dev/null and could set umask but
#     oninit dinks with it all the time so there is no real point.
# NB: daemonize should not be necessary, but oninit doesn't close its
#     controlling terminal and therefore causes cron-jobs that restart
#     it to hang, and interactive shells that started it to hang, and
#     tracing programs.
# ??? Anyone want to integrate truss into this sequence?

asroot -u informix -g informix -C -a dbaao -a dbsso -- \
    env -i HOME=$IXD \
        INFORMIXDIR=$IXD \
        INFORMIXSERVER=$IXS \
        INFORMIXCONCSMCFG=$IXD/etc/concsm.$IXS \
        IFX_LISTEN_TIMEOUT=3 \
        ONCONFIG=onconfig.$IXS \
        PATH=/usr/bin:$IXD/bin \
        SHELL=/usr/bin/ksh \
        TZ=UTC0 \
    $DAEMONIZE -act -d $IXD -o $stdout -e $stderr -- \
    $ONINIT "$@"

case "$*" in
(*v*) track-oninit-v $stdout;;
esac 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T14:07:48.353

您应该仔细阅读有关[shebang](http://en.wikipedia.org/wiki/Shebang_(Unix))的维基百科文章。

当您的系统看到对应于 shebang 的幻数时，它会在`execve`shebang 之后的给定路径上执行一个操作，并将脚本本身作为参数。

您的脚本失败，因为您提供的文件 ( `/usr/bin/env.1`) 不是*可执行文件*，而是以 shebang....

理想情况下，您可以`env`在脚本上使用 ... 解决它，并将此行作为 shebang：

```
#!/usr/bin/env /usr/bin/env.1 python 
```

它在 linux 上不起作用，因为它将 " `/usr/bin/env.1 python`" 视为路径（它不会拆分参数）

所以我看到的唯一方法是`env.1`用 C 写你的

编辑：似乎没有人相信我^^，所以我写了一个简单而肮脏的`env.1.c`：

```
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>

const  char* prependpath = "/your/prepend/path/here:";

int main(int argc, char** argv){
  int args_len = argc + 1;
  char* args[args_len];
  const char* env = "/usr/bin/env";
  int i;

  /* arguments: the same */
  args[0] = env;
  for(i=1; i<argc; i++)
    args[i] = argv[i];
  args[argc] = NULL;

  /* environment */
  char* p = getenv("PATH");
  char* newpath = (char*) malloc(strlen(p)
                 + strlen(prependpath));
  sprintf(newpath, "%s%s", prependpath, p);
  setenv("PATH", newpath, 1);

  execv(env, args);
  return 0;
} 
```

# visual-studio-2008 - Visual Studio 2008;: 添加网络参考

> ID：352535
> 
> 赞同：0
> 
> 时间：2008-12-09T12:00:51.950
> 
> 标签：visual-studio-2008, web-services, reference

阿罗哈

我有一个 VS2008 解决方案，我想在其中添加 Web 服务参考。我输入一个类似“ [http://192.168.100.87:7001/wsdl/IMySOAPWebService](http://192.168.100.87:7001/wsdl/IMySOAPWebService) ”的网址。Add Web Reference 对话框开始查找，然后向我抛出此错误：

> [下载“ http://192.168.100.87:7001/wsdl/IMySOAPWebService/$metadata](http://192.168.100.87:7001/wsdl/IMySOAPWebService/) ”时出错。

向 VS 2005 项目添加完全相同的引用可以正常工作。有什么线索吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T12:37:16.977

ASMX？您是否确定您使用正确的对话框来输入标准的网络参考？默认情况下，VS2008 隐藏了这个选项，只允许 WCF 服务引用。如果您查看对话框的底部，您会看到一个按钮或复选框（我前面没有 2008）以允许添加 ASMX 服务引用。

**编辑**

找到它 - 右键单击​​您的项目 -> 添加服务引用 -> 高级 -> 添加 Web 引用

在那里您可以找到添加 ASMX 服务的正确对话框

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T13:20:06.517

阿罗哈，

我已经通过使用（VS2008）解决了这个问题，`svcutil.exe`这为我生成了一个代理，没有任何麻烦

# memcached - 如何将 MemCached 服务器链接在一起？

> ID：352536
> 
> 赞同：8
> 
> 时间：2008-12-09T12:01:16.380
> 
> 标签：memcached

我正在考虑将 MemCached 用于我正在开发的 Web 应用程序，在过去几天研究 MemCached 之后，我遇到了一个我找不到答案的问题。

**如何将 Memcached 服务器链接在一起，或者如何在 MemCached 服务器之间复制数据？**

**另外：**此功能是由服务器还是客户端控制？如何控制？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-09T12:16:14.757

当您设置多个服务器时，客户端库使用第一个哈希来选择一个存储每个密钥/数据对的位置。这意味着没有复制，并且每个客户端都必须使用同一组服务器。

优点：

*   几乎为零开销，存储和带宽线性增长。
*   服务器代码保持简单可靠。

缺点：

*   服务器集的任何更改（一个出现故障，或者您添加一个新的）都会突然（几乎）使整个缓存无效。
*   您必须确保在每个客户端上使用相同的算法。

如果您可以控制客户端的代码，您可以简单地将每个密钥/数据对存储在两台服务器上两次。当从不同的客户那里阅读时，一定要在相同的地方进行搜索。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T19:50:35.067

我使用[了 BeITMemcached](http://code.google.com/p/beitmemcached/wiki/Embed)，您创建了一个 MemcacheClient 实例并将您要使用的服务器设置为字符串。

在这一点上，客户端自己确定它可以将不同的项目放入哪些服务器。你永远不知道哪个项目会在里面。

在这里查看[服务器如何处理故障转移](http://code.google.com/p/memcached/wiki/FAQ)。

最简单的事情是有一个重新填充机制。就我而言，我将数百个来自数据库的对象存储在 memcache 中。我可以调用 repopulate 并将它们全部放回那里。每当我向数据库添加、更新或删除它们时，我都会对 memcache 进行相同的调用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-02T15:21:55.670

[http://repcached.lab.klab.org/](http://repcached.lab.klab.org/)

此外，PHP PECL memcache 客户端可以将数据复制到多个服务器，请参阅 memcache.redundancy。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T10:41:10.580

听起来您希望拥有可以应对机器重新启动等的缓存……</p>

在很多情况下（假设您不是在编写 Facebook），RDMS 对缓存来说足够快。只需创建一个具有键和 blob 列的表。如果 RDBS 服务器有足够的内存，所有的数据都将在内存中并保存到磁盘以便恢复。

请记住，这可能是与主数据库服务器不同的服务器。

如果您希望更花哨并使用高端 RDMS，您可以在用于构建“缓存数据”的查询上设置更改通知，以从缓存中删除过期行。

您可以设置触发器以从缓存中清除无效行，但这可能非常复杂，非常快速。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-15T06:39:24.760

Memcached 不提供复制属性。为此，您需要将服务器添加到 memcached 客户端服务器列表，然后点击数据库以将数据存储在该特定服务器中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-15T12:43:03.043

您应该认真考虑[CouchBase](http://www.couchbase.com/)。它使用 memcached 协议，提供几乎相同的速度，并提供您正在寻找的自动复制。它还保留在磁盘上，因此您的缓存永远不会变冷。

# python - 在python中扩展内置类

> ID：352537
> 
> 赞同：36
> 
> 时间：2008-12-09T12:01:30.277
> 
> 标签：python, string, monkeypatching

如何在 python 中扩展内置类？我想向 str 类添加一个方法。
我做了一些搜索，但我发现的只是旧帖子，我希望有人知道更新的东西。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-09T12:08:35.257

只是子类化类型

```
>>> class X(str):
...     def my_method(self):
...         return int(self)
...
>>> s = X("Hi Mom")
>>> s.lower()
'hi mom'
>>> s.my_method()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 3, in my_method
ValueError: invalid literal for int() with base 10: 'Hi Mom'

>>> z = X("271828")
>>> z.lower()
'271828'
>>> z.my_method()
271828 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2015-10-09T08:37:13.147

一种方法是使用“类重新打开”概念（原生存在于 Ruby 中），该概念可以使用类装饰器在 Python 中实现。此页面中给出了一个示例： [http ://www.ianbicking.org/blog/2007/08/opening-python-classes.html](http://www.ianbicking.org/blog/2007/08/opening-python-classes.html)

我引用：

我认为使用类装饰器可以做到这一点：

```
@extend(SomeClassThatAlreadyExists)
class SomeClassThatAlreadyExists:
    def some_method(self, blahblahblah):
        stuff 
```

像这样实现：

```
def extend(class_to_extend):
    def decorator(extending_class):
        class_to_extend.__dict__.update(extending_class.__dict__)
        return class_to_extend
    return decorator 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-09-26T17:39:31.107

假设您不能更改内置类。在 Python3 中模拟像 Ruby 这样的“类重新打开”，其中`__dict__`是 mappingproxy 对象而不是 dict 对象：

```
def open(cls):
  def update(extension):
    for k,v in extension.__dict__.items():
      if k != '__dict__':
        setattr(cls,k,v)
    return cls
  return update

class A(object):
  def hello(self):
    print('Hello!')

A().hello()   #=> Hello!

#reopen class A
@open(A)
class A(object):
  def hello(self):
    print('New hello!')
  def bye(self):
    print('Bye bye')

A().hello()   #=> New hello!
A().bye()     #=> Bye bye 
```

在 Python2 中，我还可以编写一个装饰器函数“open”：

```
def open(cls):
  def update(extension):
    namespace = dict(cls.__dict__)
    namespace.update(dict(extension.__dict__))
    return type(cls.__name__,cls.__bases__,namespace)
  return update 
```

# http - 在 IIS 6.0 上设置错误代码

> ID：352538
> 
> 赞同：3
> 
> 时间：2008-12-09T12:01:47.297
> 
> 标签：http, iis

`HTTP 304 (Not Modified)`我希望 IIS 服务器在访问特定文件时返回。

我该如何设置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T12:53:09.317

AFAIK，这是不可能的（在 IIS 中）。要发送此代码，必须满足一些条件：

1.  客户端必须有页面的缓存副本。
2.  请求的**If-Modified-Since** HTTP 标头时间/日期戳必须与服务器上的内容相匹配。

如果这两个条件都为真，则服务器将返回 HTTP 304 状态代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T04:51:22.253

选中 IIS 管理器中 HTTP 标头选项卡上的“启用内容过期”框：

[IIS 6.0 F1：网站属性 - HTTP 标头选项卡](http://technet.microsoft.com/en-us/library/cc732442.aspx)

# c# - 如何创建 XPS 文档？

> ID：352540
> 
> 赞同：20
> 
> 时间：2008-12-09T12:02:51.727
> 
> 标签：c#, .net, xps, xpsdocument

我想创建一个用于存储和打印的 XPS 文档。

在我的程序中创建 XPS 文档（例如，使用带有一些数据的简单网格）并传递它的最简单方法是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-09T12:11:41.413

没有什么容易的。但这是可以完成的。我的博客上有一些（可悲的是，仍然有问题）示例代码和信息，用于在内存中创建文档。

这是我为测试而编写的一些代码，它封装了所有内容（它将一组 FixedPages 写入内存中的 XPS 文档）。它包括将文档序列化为字节数组的代码，但您可以跳过该部分并仅返回文档：

```
public static byte[] ToXpsDocument(IEnumerable<FixedPage> pages)
{
    // XPS DOCUMENTS MUST BE CREATED ON STA THREADS!!!
    // Note, this is test code, so I don't care about disposing my memory streams
    // You'll have to pay more attention to their lifespan.  You might have to 
    // serialize the xps document and remove the package from the package store 
    // before disposing the stream in order to prevent throwing exceptions
    byte[] retval = null;
    Thread t = new Thread(new ThreadStart(() =>
    {
        // A memory stream backs our document
        MemoryStream ms = new MemoryStream(2048);
        // a package contains all parts of the document
        Package p = Package.Open(ms, FileMode.Create, FileAccess.ReadWrite);
        // the package store manages packages
        Uri u = new Uri("pack://TemporaryPackageUri.xps");
        PackageStore.AddPackage(u, p);
        // the document uses our package for storage
        XpsDocument doc = new XpsDocument(p, CompressionOption.NotCompressed, u.AbsoluteUri);
        // An xps document is one or more FixedDocuments containing FixedPages
        FixedDocument fDoc = new FixedDocument();
        PageContent pc;
        foreach (var fp in pages)
        {
            // this part of the framework is weak and hopefully will be fixed in 4.0
            pc = new PageContent();
            ((IAddChild)pc).AddChild(fp);
            fDoc.Pages.Add(pc);
        }
        // we use the writer to write the fixed document to the xps document
        XpsDocumentWriter writer;
        writer = XpsDocument.CreateXpsDocumentWriter(doc);
        // The paginator controls page breaks during the writing process
        // its important since xps document content does not flow 
        writer.Write(fDoc.DocumentPaginator);
        // 
        p.Flush();

        // this part serializes the doc to a stream so we can get the bytes
        ms = new MemoryStream();
        var writer = new XpsSerializerFactory().CreateSerializerWriter(ms);
        writer.Write(doc.GetFixedDocumentSequence());

        retval = ms.ToArray();
    }));
    // Instantiating WPF controls on a MTA thread throws exceptions
    t.SetApartmentState(ApartmentState.STA);
    // adjust as needed
    t.Priority = ThreadPriority.AboveNormal;
    t.IsBackground = false;
    t.Start();
    //~five seconds to finish or we bail
    int milli = 0;
    while (buffer == null && milli++ < 5000)
        Thread.Sleep(1);
    //Ditch the thread
    if(t.IsAlive)
        t.Abort();
    // If we time out, we return null.
    return retval;
} 
```

注意糟糕的线程代码。您不能在 MTA 线程上执行此操作；如果您在 STA 线程上，您也可以摆脱它。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-09T14:05:36.877

如果您在 .NET（v2 或更高版本）中工作，则可以非常轻松地从 WPF 视觉对象生成有效的 XPS 文档。

例如，看看我的这篇博文：

[http://nixps.blogspot.com/2008/12/wpf-to-pdf.html](http://nixps.blogspot.com/2008/12/wpf-to-pdf.html)

在示例中，我创建了一个 WPF 视觉对象并将其转换为 XPS 文件，然后再进行进一步处理。

如果您不在 .NET 中工作，或者想要对 XPS 输出进行更多控制，那么我建议您为此使用库（如[NiXPS SDK](http://nixps.com/library.html)）。与自己编写 XML 结构（以及进行适当的资源管理等）相比，它更容易编写代码，并且更不容易出错。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T12:10:44.067

它就是真正的 XML。如果您习惯使用 XML 文件，那么使用 XPS 文档应该没有问题。这是我过去用来帮助我入门的简单教程：

[http://blogs.ocrasoft.nl/jeroenveurink/?p=21](http://blogs.ocrasoft.nl/jeroenveurink/?p=21)

# multithreading - Delphi Win API CreateTimerQueueTimer 线程和线程安全的 FormatDateTime 崩溃

> ID：352543
> 
> 赞同：4
> 
> 时间：2008-12-09T12:05:21.283
> 
> 标签：multithreading, delphi, winapi, formatdatetime

这是一个有点长的问题，但我们开始吧。有一个 FormatDateTime 版本，据说是线程安全的，您可以使用

```
GetLocaleFormatSettings(3081, FormatSettings); 
```

得到一个值，然后你可以像这样使用它；

```
FormatDateTime('yyyy', 0, FormatSettings); 
```

现在想象两个定时器，一个使用 TTimer（间隔说 1000 毫秒），然后另一个定时器是这样创建的（10 毫秒间隔）；

```
CreateTimerQueueTimer
(
  FQueueTimer, 
  0, 
  TimerCallback, 
  nil, 
  10, 
  10, 
  WT_EXECUTEINTIMERTHREAD
); 
```

现在最重要的是，如果在回调和计时器事件中，您有以下代码；

```
for i := 1 to 10000 do
begin
  FormatDateTime('yyyy', 0, FormatSettings);
end; 
```

注意没有赋值。这几乎会立即产生访问冲突，有时会在 20 分钟后，无论如何，在随机的地方。现在，如果您在 C++Builder 中编写该代码，它永远不会崩溃。我们使用的标头转换是 JEDI JwaXXXX 的。即使我们在 Delphi 版本中围绕代码加锁，也只会延迟不可避免的情况。我们查看了原始的 C 头文件，一切看起来都不错，C++ 使用 Delphi 运行时有什么不同的方式吗？FormatDatTime 的线程安全版本看起来是可重入的。任何可能以前看过此内容的人的任何想法或想法。

**更新：**

为了缩小范围，FormatSettings 作为 const 传入，所以它们是否使用相同的副本是否重要（因为在函数调用中传递本地版本会产生同样的问题）？此外，采用 FormatSettings 的 FormatDateTime 版本不会调用 GetThreadLocale，因为它已经在 FormatSettings 结构中具有区域设置信息（我通过单步执行代码进行了仔细检查）。

我提到没有分配以明确表示没有访问共享存储，因此不需要锁定。

WT_EXECUTEINTIMERTHREAD 用于简化问题。我的印象是你应该只将它用于非常短的任务，因为如果它运行很长时间，它可能意味着它会错过下一个间隔？

如果您使用普通的旧 TThread，则不会出现问题。我想我在这里得到的是使用 TThread 或 TTimer 有效，但使用在 VCL 之外创建的线程不起作用，这就是为什么我问 C++ Builder 使用 VCL/Delphi RTL 的方式是否存在差异。

顺便说一句，前面提到的这段代码也失败了（但需要更长的时间），过了一会儿， CS := TCriticalSection.Create;

```
 CS.Acquire;
  for i := 1 to LoopCount do
  begin
    FormatDateTime('yyyy', 0, FormatSettings);
  end;
  CS.Release; 
```

现在对于我真的不明白的一点，我按照建议写了这个；

```
function ReturnAString: string;
begin
  Result := 'Test';
  UniqueString(Result);
end; 
```

然后在每种类型的计时器内，代码是；

```
 for i := 1 to 10000 do
  begin
    ReturnAString;
  end; 
```

这会导致相同类型的故障，正如我之前所说，故障永远不会出现在 CPU 窗口内的同一个地方等。有时它是访问冲突，有时它可能是无效的指针操作。我正在使用 Delphi 2009 顺便说一句。

**更新 2：**

Roddy（下）指出 Ontimer 事件（不幸的是 Winsock，即 TClientSocket）使用 Windows 消息泵（顺便说一句，使用 IOCP 和重叠 IO 有一些不错的 Winsock2 组件会很好），因此推动离开从中。但是，有谁知道如何查看 CreateQueueTimerQueue 上设置了哪种线程本地存储？

感谢您花时间思考和回答这个问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T01:34:34.660

我不确定为我自己的问题发布“答案”是否是一种好的形式，但这似乎是合乎逻辑的，如果这不酷，请告诉我。

我想我找到了问题所在，线程本地存储的想法让我跟着一堆线索，我发现了这条神奇的线；

IsMultiThread := 真；

从帮助；

“IsMultiThread 设置为 true 表示内存管理器应该支持多个线程。IsMultiThread 由 BeginThread 和类工厂设置为 true。”

这当然**不是**通过使用 TTimer 使用单个 Main VCL 线程来设置的，但是当您使用 TThread 时它是为您设置的。如果我手动设置它，问题就会消失。

在 C++Builder 中，我不使用 TThread，但它使用以下代码出现；

```
if (IsMultiThread) {
  ShowMessage("IsMultiThread is True!");
} 
```

那就是它自动为您设置的某个地方。

我真的很高兴人们的意见，所以我可以找到这个，我希望它可以帮助别人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T15:41:02.207

由于 FormatDateTime 调用的 DateTimeToString 使用 GetThreadLocale，您可能希望尝试为每个线程设置一个本地 FormatSettings 变量，甚至可以在循环之前在本地变量中设置 FormatSettings。

也可能是导致此问题的 WT_EXECUTEINTIMERTHREAD 参数。请注意，它声明它应该只用于非常短的任务。

如果问题仍然存在，问题实际上可能在其他地方，这是我看到这个时的第一个预感，但我没有足够的信息来了解代码的作用来真正确定这一点。

有关访问冲突发生位置的详细信息可能会有所帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T16:10:10.587

你确定这真的有什么关系`FormatDateTime`吗？您特别提到那里没有赋值语句；这是你问题的一个重要方面吗？如果您改为调用其他字符串返回函数会发生什么？（确保它不是一个常量字符串。编写自己的函数，`UniqueString(Result)`在返回之前调用。）

变量是`FormatSettings`线程特定的吗？这就是为 提供额外参数的意义所在`FormatDateTime`，因此每个线程都有自己的私有副本，保证在函数处于活动状态时不会被任何其他线程修改。

计时器队列对这个问题很重要吗？或者，当您使用普通的旧方法并在方法`TThread`中运行循环时，您会得到相同的结果吗？`Execute`

您确实警告说这是一个很长的问题，但您似乎可以做一些事情来缩小问题范围，缩小问题的范围。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T00:00:51.013

我想知道您正在进行的 RTL/VCL 调用是否期望访问一些在您通过计时器队列调用代码时未正确设置的线程本地存储 (TLS) 变量？

这不是您问题的答案，但您是否知道 TTimer OnTimer 事件只是作为 VCL 主线程中正常消息循环的一部分运行？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T03:17:12.550

您找到了答案 - IsMultiThread。必须随时使用它才能恢复使用 API 并创建线程。来自 MSDN： CreateTimerQueueTimer 正在创建一个线程池来处理此功能，因此您有一个外部线程与主 VCL 线程一起工作而没有保护。（注意：除非代码的其他部分尊重此锁，否则您的 CS.acquire/release 根本不会做任何事情。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T08:50:43.330

关于。您关于 Winsock 和重叠 I/O 的最后一个问题：您应该仔细查看[Indy](http://www.indyproject.org)。

Indy 使用阻塞 I/O，无论主线程在做什么，当您想要高性能网络 IO 时，它都是一个不错的选择。现在您已经解决了多线程问题，您应该创建另一个（或更多）线程来使用 indy 来处理您的 I/O。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-10T10:17:17.790

Indy 的问题在于，如果你需要很多连接，它根本就没有效率。每个连接需要一个线程（阻塞 I/O），这根本无法扩展，因此 IOCP 和重叠 IO 的好处，它几乎是 Windows 上唯一可扩展的方式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T00:38:22.787

对于更新2：

有一个免费的 IOCP 套接字组件：[http](http://www.torry.net/authorsmore.php?id=7131) ://www.torry.net/authorsmore.php?id=7131 （包含源代码）

> “作者 Naberegnyh Sergey N.. 基于 Windows 完成端口并使用 Windows 套接字扩展的高性能套接字服务器。支持 IPv6。”

我在寻找更好的组件/库来重新架构我的小型即时消息服务器时发现了它。我还没有尝试过，但它看起来很好，作为第一印象编码。

# java - 如何让线程等到创建文件？

> ID：352544
> 
> 赞同：2
> 
> 时间：2008-12-09T12:05:52.483
> 
> 标签：java, multithreading, file

我需要一个线程来等待文件存在或创建。到目前为止，我有以下代码：

```
while(!receivedDataFile.isFileExists("receiveddata.txt"))
{
    try {
        Thead.sleep(1000);
    } catch (InterruptedException e) {
        e.printStackTrace();
        return null;
    }
} 
```

当我运行它时，出现以下异常，并且线程结束：

```
java.lang.InterruptedException: sleep interrupted 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T12:44:19.210

一个线程在阻塞（睡眠调用）并且另一个线程调用它的`interrupt`方法时被中断。`interrupt`必须明确调用 to才能发生这种情况。

似乎如果线程被中断，重复检查文件将是合乎逻辑的事情，但在不知道中断原因的情况下很难说。

像往常一样，谈到线程，Brian Goetz 有话要说`InterruptedException`：

[http://www-128.ibm.com/developerworks/java/library/j-jtp05236.html](http://www-128.ibm.com/developerworks/java/library/j-jtp05236.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T12:38:18.427

我必须同意 Bombes 的评论：线程不会自行中断。与 Jokis 的评论相反——当线程上下文交换发生时它们也不会被中断（事实上，如果一个线程休眠，它会将它的量子交给任何有工作要做的线程，但我离题了）。

此外，我建议使用轮询文件之外的另一种通信方式。例如，你不能确定一旦你发现了一个文件，它是否已经被完全写入，而没有文件编写器的额外工作（例如在准备好时重命名它，或者创建一个“准备好的”文件）。

考虑使用更多的“数据推送”，例如 RMI、HTTP-POST、JMS 队列等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T12:09:46.940

您应该找出哪个线程中断了该线程。线程不会自行执行此操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T17:21:23.080

If all you want is a notification when a file is created, AND you can (and willing) to go native (JNI) AND you want only win32 support, you could use the code [here](http://www2.hawaii.edu/~qzhang/FileSystemWatcher/index.html "File system watcher using JNI (native)").

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T19:35:44.417

好吧，如果您不知道 InterruptedException 是什么和/或不想对此做任何事情，那么显然除了返回和退出循环之外，您至少应该做一些事情。取出退货，然后您将继续等待。

但我会检查你为什么会被打断。有东西试图取消你的线程。

# sql - 如何复制记录，仅更改 id？

> ID：352552
> 
> 赞同：6
> 
> 时间：2008-12-09T12:13:14.187
> 
> 标签：sql, db2

我的表有很多列。我有一个复制一些数据的命令 - 将其视为克隆产品 - 但由于列将来可能会发生变化，我只想从表中选择所有内容并且只更改一列的值而不必参考其余的部分。

例如，而不是：

```
INSERT INTO MYTABLE (
SELECT NEW_ID, COLUMN_1, COLUMN_2, COLUMN_3, etc
FROM MYTABLE) 
```

我想要类似的东西

```
INSERT INTO MYTABLE (
SELECT * {update this, set ID = NEW_ID}
FROM MYTABLE) 
```

有没有一种简单的方法可以做到这一点？

这是 iSeries 上的 DB2 数据库，但欢迎任何平台的答案。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-09T12:34:55.797

你可以这样做：

```
create table mytable_copy as select * from mytable;
update mytable_copy set id=new_id;
insert into mytable select * from mytable_copy;
drop table mytable_copy; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-03T01:26:50.077

我不认为这完全可以在 SQL 中完成，而无需费心创建临时表。在内存中执行它应该快得多。请注意，如果您使用临时表路径，则必须为每个函数调用选择一个唯一的表名称，以避免代码同时运行两次并将两行数据混入一个临时表的竞争条件。

我不知道您使用的是哪种语言，但应该可以获得程序中的字段列表。我会这样做：

```
array_of_field_names = conn->get_field__list;
array_of_row_values = conn->execute ("SELECT... ");
array_of_row_values ["ID"] = new_id_value
insert_query_string = "construct insert query string from list of field names and values";
conn->execute (insert_query_string); 
```

然后你可以将它封装为一个函数，只需指定表、旧 id 和新 id 就可以调用它，它会很神奇。

在 Perl 代码中，下面的代码片段会做：

```
$table_name = "MYTABLE";
$field_name = "ID";
$existing_field_value = "100";
$new_field_value = "101";

my $q = $dbh->prepare ("SELECT * FROM $table_name WHERE $field_name=?");
$q->execute ($existing_field_value);
my $rowdata = $q->fetchrow_hashref; # includes field names
$rowdata->{$field_name} = $new_field_value;

my $insq = $dbh->prepare ("INSERT INTO $table_name (" . join (", ", keys %$rowdata) . 
    ") VALUES (" . join (", ", map { "?" } keys %$rowdata) . ");";
$insq->execute (values %$rowdata); 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-03T08:35:26.947

好的，试试这个：

```
declare @othercols nvarchar(max);
declare @qry nvarchar(max);

select @othercols = (
select ', ' + quotename(name)
from sys.columns
where object_id = object_id('tableA')
and name <> 'Field3'
and is_identity = 0
for xml path(''));

select @qry = 'insert mynewtable (changingcol' + @othercols + ') select newval' + @othercols;

exec sp_executesql @qry; 
```

在运行“sp_executesql”行之前，请执行“select @qry”以查看要运行的命令是什么。

当然，您可能希望将其粘贴在存储过程中并传入一个变量而不是“Field3”位。

抢

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T12:18:26.780

您的示例应该几乎可以工作。只需将新表的列名添加到其中即可。

```
 INSERT INTO MYTABLE
(id, col1, col2)
SELECT new_id,col1, col2
FROM TABLE2
WHERE ...; 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-08-03T08:43:29.063

我从未使用过 db2，但在 mssql 中，您可以通过以下过程解决它。此解决方案仅在您不关心项目获得什么新 ID 时才有效。

1.) 创建具有相同方案但 id 列自动递增的新表。(mssql "标识规范 = 1，标识增量 = 1)

2.) 比一个简单的

```
insert into newTable(col1, col2, col3)
select (col1, col2, col3) from oldatable 
```

应该够了，一定不要在上面的语句中包含你的 id 列

# sql - 查看包含相同列的多个表

> ID：352569
> 
> 赞同：11
> 
> 时间：2008-12-09T12:24:40.887
> 
> 标签：sql, database, union

我有四个包含完全相同列的表，并且想要创建一个包含所有四个的视图，以便我可以一起查询它们。

这可能吗？

（出于乏味的原因，我不能/不允许将它们组合起来，这将使它无关紧要！）

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-09T12:28:43.390

假设除了具有相同的列名之外，相同的列还包含相同的数据，您希望创建一个视图，该视图是所有这些表的联合。

像下面这样的东西应该可以工作，但我的 SQL 生锈了：

```
(CREATE VIEW view_name AS
(SELECT * FROM table1
UNION
SELECT * FROM table2
UNION
SELECT * FROM table3)); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-09T12:36:00.880

值得注意的是，您可能需要使用“union all”来保留可能存在于多个表中的唯一行。标准联合将删除重复项。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-09T13:23:32.547

从您的查询中很难判断您是否希望基于 UNION 或作为包含离散列的视图返回数据。这显然是有效果的。

考虑以下示例：

```
TableA
ID  Name   RelatedID
1   John   2
2   Paul   1

TableB
ID  Name   RelatedID
1   Ringo  1
2   George 1

TableC
ID  Name  RelatedID
1   Bob   1

TableD
ID  Name  RelatedID
1   Kate  NULL 
```

现在，对此运行以下查询：

SELECT ID, Name FROM TableA UNION ALL SELECT ID, Name FROM TableB UNION ALL SELECT ID, Name FROM TableC UNION ALL SELECT ID, Name FROM TableD

这将产生以下输出：

```
1 John
2 Paul
1 Ringo
2 George
1 Bob
1 Kate 
```

这就是你所追求的吗？如果是这样，则使用 UNION 查询。

现在，如果您想要获得相关数据的离散视图，您可能需要执行以下操作：

```
SELECT A.ID MasterID, A.Name MasterName, 
       B.ID BandID, B.Name BandName, 
       C.ID BlackadderID, C.Name BlackadderName
       D.ID BlackadderRealID, D.Name BlackadderRealName
FROM
  TableA A
INNER JOIN
  TableB B
ON
  A.RelatedID = B.ID
INNER JOIN
  TableC C
ON
  B.RelatedID = C.ID
INNER JOIN
  TableD D
ON
  C.RelatedID = D.ID 
```

这将导致以下数据视图：

```
MasterID  MasterName  BandID  BandName BlackAdderID BlackAdderName  BlackadderRealID  BlackadderRealName
1         John        2       George   1            Bob             1                 Kate
2         Paul        1       Ringo    1            Bob             1                 Kate 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T12:27:54.110

使用联合。 [这里是解释](http://www.techonthenet.com/sql/union.php)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T12:28:03.657

使用联合声明

```
select * from table1
union 
select * from table2
union
select * from table3 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-09T12:30:19.067

如果你联合它们，你可以（我建议包括一些关于每条记录来自哪个表的指标）：

```
select   table1.column1, 1 as TableNumber
from     table1

union

select   table2.column1, 2 as TableNumber
from     table2

.. etc .. 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-09T12:51:57.353

不要使用 UNION，而是使用 UNION ALL，除非您特别希望排除重复行。UNION 本身需要更长的时间来执行（因为它会进行查找欺骗的排序），并删除重复的行。

# iframe - Safari：跨 iframe 的事件冒泡

> ID：352579
> 
> 赞同：2
> 
> 时间：2008-12-09T12:29:46.180
> 
> 标签：iframe, safari

如果用户在 iframe 内执行“onmousedown”，则在 iframe 外部拖动并将鼠标悬停在附加了“onmouseover”的元素上 - safari 不会触发此事件。

我有一个稍微非常规的拖放设置。可以“拖动”的项目位于 iframe 内。放置目标位于 iframe 之外。如果拖动在 iframe 内开始，则放置目标的“onmouseover”处理程序不会在 Safari 中触发。这是一个已知的问题？有没有可用的解决方法？

目前我不需要跟踪其他浏览器的放置目标的位置。如果在“拖动”时发生“鼠标上移”，我可以从事件对象中找到确切的放置目标。丢弃指示由“onmouseover”功能负责。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T12:15:59.380

IE 和 Firefox 触发 onmouseover 事件就好了。我正在做一些类似的事情，从父文档中拖放目标到 iframe 中，并且可以看到 onmouseover 事件针对 IE 和 FireFox 中的目标触发，但不是 Safari。有什么解决方法吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T12:35:32.580

副手，我不认为*有任何事情*会引发这个事件。这是两个完全独立的 DOM。

你在 FF、IE、Opera、Chrome 中试过吗？

# java - 如何在 JPA 中使用枚举

> ID：352586
> 
> 赞同：35
> 
> 时间：2008-12-09T12:35:01.147
> 
> 标签：java, jpa, enums, toplink

我有一个电影租赁系统的现有数据库。每部电影都有一个评级属性。在 SQL 中，他们使用约束来限制该属性的允许值。

```
CONSTRAINT film_rating_check CHECK 
    ((((((((rating)::text = ''::text) OR 
          ((rating)::text = 'G'::text)) OR 
          ((rating)::text = 'PG'::text)) OR 
          ((rating)::text = 'PG-13'::text)) OR 
          ((rating)::text = 'R'::text)) OR 
          ((rating)::text = 'NC-17'::text))) 
```

我认为使用 Java 枚举将约束映射到对象世界会很好。但由于“PG-13”和“NC-17”中的特殊字符，不可能简单地采用允许的值。所以我实现了以下枚举：

```
public enum Rating {

    UNRATED ( "" ),
    G ( "G" ), 
    PG ( "PG" ),
    PG13 ( "PG-13" ),
    R ( "R" ),
    NC17 ( "NC-17" );

    private String rating;

    private Rating(String rating) {
        this.rating = rating;
    }

    @Override
    public String toString() {
        return rating;
    }
}

@Entity
public class Film {
    ..
    @Enumerated(EnumType.STRING)
    private Rating rating;
    .. 
```

使用 toString() 方法，方向 enum -> String 工作正常，但 String -> enum 不起作用。我得到以下异常：

> [TopLink 警告]: 2008.12.09 01:30:57.434--ServerSession(4729123)--异常 [TOPLINK-116] (Oracle TopLink Essentials - 2.0.1 (Build b09d-fcs (12/06/2007))): oracle.toplink.essentials.exceptions.DescriptorException 异常描述：没有为字段 [FILM.RATING] 中的值 [NC-17] 提供转换值。映射：oracle.toplink.essentials.mappings.DirectToFieldMapping[rating-->FILM.RATING] 描述符：RelationalDescriptor(de.fhw.nsdb.entities.Film --> [DatabaseTable(FILM)])

干杯

蒂莫

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-08T20:44:12.987

您是否尝试过存储序数值。如果您没有与值关联的字符串，则存储字符串值可以正常工作：

```
@Enumerated(EnumType.ORDINAL) 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-23T06:30:15.930

这里有一个问题，那就是 JPA 在处理枚举方面的能力有限。使用枚举，您有两种选择：

1.  将它们存储为等于 的数字`Enum.ordinal()`，这是一个糟糕的主意（恕我直言）；或者
2.  将它们存储为等于 的字符串`Enum.name()`。 **注意：**不像`toString()`你想象的那样，特别是因为默认行为`Enum.toString()`是返回`name()`。

我个人认为最好的选择是（2）。

现在您遇到了一个问题，即您定义的值不代表 Java 中的有效实例名称（即使用连字符）。所以你的选择是：

*   更改您的数据；
*   持久化字符串字段并隐式将它们转换为对象中的枚举或从枚举转换；或者
*   使用非标准扩展，例如 TypeConverters。

我会按照优先顺序（从第一个到最后一个）执行它们。

有人建议使用 Oracle TopLink 的转换器，但您可能使用的是 Toplink Essentials，它是参考 JPA 1.0 实现，它是商业 Oracle Toplink 产品的子集。

作为另一个建议，我强烈建议切换到[EclipseLink](http://www.eclipse.org/eclipselink/)。它是一个比 Toplink Essentials 更完整的实现，Eclipselink 将成为 JPA 2.0 发布时的参考实现（JavaOne 预计在明年年中发布）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-09T15:05:57.287

听起来您需要添加对自定义类型的支持：

[扩展 OracleAS TopLink 以支持自定义类型转换](http://www.oracle.com/technetwork/middleware/ias/index-097678.html)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-09T14:29:11.900

```
public enum Rating {

    UNRATED ( "" ),
    G ( "G" ), 
    PG ( "PG" ),
    PG13 ( "PG-13" ),
    R ( "R" ),
    NC17 ( "NC-17" );

    private String rating;

    private static Map<String, Rating> ratings = new HashMap<String, Rating>();
    static {
        for (Rating r : EnumSet.allOf(Rating.class)) {
            ratings.put(r.toString(), r);
        }
    }

    private static Rating getRating(String rating) {
        return ratings.get(rating);
    }

    private Rating(String rating) {
        this.rating = rating;
    }

    @Override
    public String toString() {
        return rating;
    }
} 
```

但是，我不知道如何在带注释的 TopLink 方面进行映射。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T13:18:43.070

我不知道 toplink 的内部结构，但我有根据的猜测如下：它使用 Rating.valueOf(String s) 方法映射到另一个方向。无法覆盖 valueOf()，因此您必须遵守 java 的命名约定，以允许正确的 valueOf 方法。

```
public enum Rating {

    UNRATED,
    G, 
    PG,
    PG_13 ,
    R ,
    NC_17 ;

    public String getRating() {
        return name().replace("_","-");;
    }
} 
```

getRating 产生“人类可读”的评级。请注意，枚举标识符中不允许使用“-”字符。

当然，您必须将数据库中的值存储为 NC_17。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-06-23T18:30:41.573

问题是，我认为，JPA 从来没有考虑到我们可以拥有一个复杂的预先存在的模式。

我认为这导致了 Enum 特有的两个主要缺点：

1.  使用 name() 和 ordinal() 的限制。为什么不像我们使用@Entity 那样用@Id 标记getter？
2.  枚举通常在数据库中有表示，以允许与各种元数据关联，包括专有名称、描述性名称，可能还有本地化等。我们需要枚举的易用性和实体的灵活性。

[帮助我的事业并为JPA_SPEC-47](https://github.com/eclipse-ee4j/jpa-api/issues/47)投票

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-04-08T00:55:58.877

使用您现有的`enum Rating`. 您可以使用`AttributeCoverter`s。

```
@Converter(autoApply = true)
public class RatingConverter implements AttributeConverter<Rating, String> {

    @Override
    public String convertToDatabaseColumn(Rating rating) {
        if (rating == null) {
            return null;
        }
        return rating.toString();
    }

    @Override
    public Rating convertToEntityAttribute(String code) {
        if (code == null) {
            return null;
        }

        return Stream.of(Rating.values())
          .filter(c -> c.toString().equals(code))
          .findFirst()
          .orElseThrow(IllegalArgumentException::new);
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-09T14:05:14.257

那这个呢

```
public String getRating{  
   return rating.toString();
}

pubic void setRating(String rating){  
   //parse rating string to rating enum
   //JPA will use this getter to set the values when getting data from DB   
}  

@Transient  
public Rating getRatingValue(){  
   return rating;
}

@Transient  
public Rating setRatingValue(Rating rating){  
   this.rating = rating;
} 
```

有了这个，您在数据库和实体上都使用评级作为字符串，但将枚举用于其他所有内容。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2011-10-04T08:29:25.110

使用这个注解

```
@Column(columnDefinition="ENUM('User', 'Admin')") 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2017-11-14T16:53:01.983

枚举公共枚举 ParentalControlLevelsEnum { U("U"), PG("PG"), _12("12"), _15("15"), _18("18");

```
private final String value;

ParentalControlLevelsEnum(final String value) {
    this.value = value;
}

public String getValue() {
    return value;
}

public static ParentalControlLevelsEnum fromString(final String value) {
    for (ParentalControlLevelsEnum level : ParentalControlLevelsEnum.values()) {
        if (level.getValue().equalsIgnoreCase(value)) {
            return level;
        }
    }
    return null;
} 
```

}

比较 -> 枚举

公共类 RatingComparator 实现 Comparator {

```
public int compare(final ParentalControlLevelsEnum o1, final ParentalControlLevelsEnum o2) {
    if (o1.ordinal() < o2.ordinal()) {
        return -1;
    } else {
        return 1;
    }
} 
```

}

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2012-08-07T14:32:05.843

解决！！！我在哪里找到答案： http: [//programming.itags.org/development-tools/65254/](http://programming.itags.org/development-tools/65254/)

简而言之，转换查找枚举的名称，而不是属性“rating”的值。在你的情况下：如果你有 db 值“NC-17”，你需要在你的枚举中：

枚举等级 {
(...)
**NC-17** ("NC-17" );
(...)

# asp.net - Server.Transfer 后出现“未知网络方法”错误

> ID：352592
> 
> 赞同：2
> 
> 时间：2008-12-09T12:38:10.423
> 
> 标签：asp.net, web-services, redirect

我使用[System.Web.Services.WebMethodAttribute](http://msdn.microsoft.com/en-us/library/system.web.services.webmethodattribute.aspx)使 ASP.NET 页面的公共静态方法可从客户端脚本调用：

***测试.aspx.cs***

```
[System.Web.Services.WebMethod]
public static string GetResult()
{
    return "result";
} 
```

***测试.aspx***

```
<asp:ScriptManager ID="sm" runat="server" EnablePageMethods="true" />

<script type="text/javascript">
    alert(PageMethods.GetResult());
</script> 
```

该方法可以正常工作，但是如果我加载*test.aspx*

```
Server.Transfer("test.aspx"); 
```

我收到“未知的网络方法”错误。后

```
Response.Redirect("test.aspx"); 
```

该页面运行良好。

请您告诉我，错误的原因是什么以及如何避免它？非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T12:42:36.827

您在哪里收到错误 - 服务器或客户端？

如果它在客户端上，请查看它正在尝试做什么。我怀疑您会发现它要求原始页面做出响应，而不是 test.aspx。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T13:03:02.337

Server.Transfer 将页面的**处理**（在服务器级别）转移到您指定的页面，但是浏览器认为您仍在原始页面上：

因此，例如，您在 start.aspx 上，并且在您后面的代码中有 Server.Transfer("test.aspx");

您的浏览器认为您仍在 start.aspx 上，并且 javascript 将向 start.aspx 上的页面方法发送请求。

使用 Response.Redirect 您的浏览器知道您现在在 test.aspx 上，并且请求已正确发送。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T13:39:04.310

似乎调用 set_path 解决了这个问题：

```
<script type="text/javascript">
    PageMethods.set_path("test.aspx");
    alert(PageMethods.GetResult());
</script> 
```

# performance - 在经典的 asp/sql 服务器网站中查找性能瓶颈

> ID：352597
> 
> 赞同：3
> 
> 时间：2008-12-09T12:39:51.230
> 
> 标签：performance, asp-classic

我有一个旧的经典 asp/sql 服务器应用程序，即使负载不是很大，它也会不断抛出 500 个错误/超时。一些数据库查询非常密集，但没有什么会导致它崩溃。

有没有什么好的软件可以安装在我的服务器上，可以准确地显示出瓶颈在 asp 或 DB 中的位置？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T14:26:02.793

您可以尝试一些工具：

*   HP（原 Mercury）[LoadRunner](https://h10078.www1.hp.com/cda/hpms/display/main/hpms_content.jsp?zn=bto&cp=1-11-126-17%5E8_4000_100__)或[Performance Center](https://h10078.www1.hp.com/cda/hpms/display/main/hpms_content.jsp?zn=bto&cp=1-11-126-17_4000_100__)
*   Visual Studio [Application Center 测试](http://msdn.microsoft.com/en-us/library/aa287410.aspx)（仅限企业版？）
*   Microsoft [Web Application Stress](http://www.microsoft.com/downloads/details.aspx?familyid=e2c0585a-062a-439e-a67d-75a89aa36495&displaylang=en)工具（又名 WAS，又名“Homer”；Application Center Test 的前身）
*   [网页加载](http://www.webload.org/)
*   如果要跟踪应用程序代码，请使用[MS Visual Studio Analyzer 。](http://msdn.microsoft.com/en-us/library/aa728806(VS.71).aspx)这可以显示应用程序等待 DB 调用的时间，以及使用的 SQL 是什么。然后，您可以使用 SQL 探查器来调整查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T02:28:32.243

超时发生在哪里？ASP 连接/执行 sql 时是否在线？如果是这样，您的问题要么与数据库服务器的连接有关，要么在于数据库本身。在 MSSQL 中加载 SQL 分析器以查看查询需要多长时间。可能是由于数据库中的锁。

你使用交易吗？如果是这样，请确保他们不会长时间锁定您的数据库。确保在 ADO 中而不是在整个 ASP 页上使用事务。您还可以通过对表使用 WITH (NOLOCK) 提示来忽略 SQL 选择中的锁定。

确保您的数据库使用索引进行了优化。

还要确保您在尽可能短的时间内连接到数据库，即（示例不工作代码）： conn.open; 设置 rs = conn.execute(); rs.关闭；康涅狄格关闭。因此，将记录集存储在一个变量中，而不是在保持与数据库的连接打开时循环。一个好方法是在 ADO 中使用 GetRows() 函数。

始终显式关闭并将 ADO 对象设置为空。这可能会导致与 DB 的连接保持打开状态。

启用连接池。

如果您正在使用它们，请在 global.asa 中加载 ADO 常量

不要在会话或应用程序范围内存储任何对象。

升级到最新版本的 ADO、MDac、SQL Server 服务包等。

您确定服务器可以处理负载吗？也许升级它？是在共享主机上吗？也许您的应用程序不是问题。

通过从第一行到最后一行计时来衡量脚本性能非常简单。通过这种方式，您可以识别运行缓慢的页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T13:14:05.577

您是否尝试过在服务器上运行 SQL Server Profiler？它将突出显示从应用程序访问数据库的任何意外活动，并帮助识别性能不佳的查询。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T13:23:26.197

如果您很高兴 DB 查询非常密集，那么您可能需要在使用这些查询的页面上设置更合适的超时。

将 Server.ScriptTimeout 设置为更大的值，您可能还需要设置脚本使用的 ADO Command 对象的超时。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T06:22:21.413

这就是我的处理方式。

1.  查看服务器上正在运行的任务。哪个占用更多 CPU 时间 - SQL 服务器或 IIS？大多数时候，它将是 SQL 服务器，根据您的帖子，它听起来肯定是这样的。与 COM 或 SQL 方面相反，任何 ASP 应用程序实际上在 ASP 方面进行大量处理是非常罕见的。

2.  使用 SQL Profiler 检查所有命中数据库服务器的查询。

3.  首先处理低垂的果实。通常，您会遇到一些“问题”查询，这些查询经常访问数据库并占用大量时间。处理这些。（软件开发中的一个真理是 10% 的代码会占用 90% 的执行时间......）

除了使用 SQL Profiler 和 Query Analyzer/SQL Studio 查看查询成本以及进行正常的 SQL 性能检测工作之外，您可能还想检查您的数据库调用是否向您的 ASP 代码返回了过多的数据。我见过一些看起来无害的查询向 ASP 返回大量不需要的数据的情况——由懒惰/没有经验的程序员编写的经典（“从表名中选择 *”）类型的查询，当程序员真的只需要 1 时返回 10,000 大行1 行的字段。我之所以提到这种特殊情况，是因为这类查询在 SQL 方面的执行时间和查询成本通常都很低，因此可能会被忽视。

# visual-studio - 设置 Visual Studio 窗口

> ID：352598
> 
> 赞同：3
> 
> 时间：2008-12-09T12:39:57.923
> 
> 标签：visual-studio, visual-studio-2008, development-environment

我已经设置了 Visual Studio 2008，正如我想要的那样，一个屏幕（有双显示器）仅用于编码，另一个设置有多个选项卡组，每个选项卡组包含不同的选项卡，比如一组包含输出、错误列表和待办事项列表选项卡，另一组具有工具箱和属性窗口的选项卡。

现在这一切都很酷，除了当我调试某些东西并且我完成调试时，它会将所有选项卡放在一个组中，并将我所有很好分开的选项卡组搞砸。

任何人都知道任何会阻止 Visual Studio 执行此操作并记住哪些选项卡进入哪些组？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-09T12:43:21.550

这是因为 VS 对编码和调试有单独的布局设置。这个想法是在编码时你不想要输出窗口等东西，你需要解决方案资源管理器和一个漂亮的大代码窗口。调试时，您仍然希望查看代码，但可能还有很多其他窗口可以帮助您（线程、断点等）。

事实上，我相信有很多可用的窗口布局（除了您自己的定制）。这是 Visual Studio 在您第一次启动它并设置您的环境时询问您的事情之一。

我知道解决这个问题的唯一方法是在“调试时”重新安排你的窗口。它应该记住这些设置并在调试时切换到它们。

# eclipse - 如何让 eclipse 的自动格式化程序忽略一段代码？

> ID：352599
> 
> 赞同：42
> 
> 时间：2008-12-09T12:41:22.880
> 
> 标签：eclipse

我记得有一种方法可以在 Eclipse 中标记一段代码（特殊注释或注释？），这使得自动格式化程序忽略了该部分。或者我可能已经摆脱了这个......

主要在我有包含多行的字符串并且我不希望自动格式化程序重新排列它时使用。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2010-07-27T15:34:43.843

从 Eclipse 3.5（或 3.6）开始，这是可能的： - 转到项目属性 - Java 代码样式 - 格式化程序 - 编辑... - 选择标记为“关闭/打开标签”的选项卡， - 在您的注释中包含标签源代码，比如

```
/* @formatter:on */ 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-11-15T15:30:44.930

您可以在这些特殊注释之间包装您不希望自动格式化的代码：

```
normal code

/* @formatter:off */
strangely laid out code
/* @formatter:on */

normal code 
```

这是一个使 json 字符串（稍微）更具可读性的基本用法示例：

```
public class SomeTest {

    @Test
    public void can_deserialize_json() {
        /* @formatter:off */
        String json = "" +
        "{" +
        "   \"id\" : 123," +
        "   \"address1\" : blah," +
        "   \"shippingInfo\" : {" +
        "      \"trackingUrl\" : null," +
        "      \"price\" : 350" +
        "   }," +
        "   \"errorMessage\" : null" +
        "}";
        /* @formatter:on */
        MyClass.deserializeJson(json);
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T12:48:34.910

我只知道评论的答案：

Eclipse 足够聪明，只能重新格式化生成的 JavaDoc 不会更改的注释（即空白无关紧要的地方）：

```
/**
 * foo <i>
 * bar </i>
 * 
 * <pre>
 *   foo
 * bar
 * </pre>
 */ 
```

将被重新格式化为

```
/**
 * foo <i> bar </i>
 * 
 * <pre>
 *   foo
 * bar
 * </pre>
 */ 
```

请注意`<pre>`标签的内容是如何不重新格式化的。

对于长字符串文字，我建议它们可能表明您应该将其中的一些外部化。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T00:52:26.477

我不确定您所指的确切功能，但您可以更改表达式的换行策略，这可能会帮助您解决字符串问题。看：

窗口->首选项->Java->代码样式->格式化程序

单击“编辑...”按钮

单击“换行”选项卡

在树中，选择 Expressions->Assignments，然后更改窗口底部的缩进策略。

当然，格式化程序中还有无数其他选项，您可能会发现其中许多对其他规则也很有用，例如将大括号放在哪里，或者如何缩进控制块。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-23T08:28:23.477

我刚刚发现了这个问题，因为我也对缺少这个功能感到恼火。

一个小的搜索显示了这个问题和以下答案： [Stop eclipse from line wrapping?](https://stackoverflow.com/questions/890805/stop-eclipse-from-line-wrapping)

> Eclipse 3.5 支持这一点。（它在几天前发布了候选版本，因此值得一试）

祝你好运！:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-10T05:05:37.287

我偶然发现了这一点，因为我很想在 Eclipse 中看到部分着色。想象一下，您可以简单地为代码中的部分提供一些背景颜色。它不会让它更容易接近，尤其是当你在凌晨 4 点褪色时？:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-09T15:32:46.903

您可以在此部分中单击鼠标右键标记您要格式化的代码并选择格式。这是一个“白名单”解决方案，也许它有帮助......

# visual-c++ - 如何将 USB 驱动器上的 MSVC++ 6.0 作为便携式应用程序运行

> ID：352600
> 
> 赞同：2
> 
> 时间：2008-12-09T12:42:02.397
> 
> 标签：visual-c++, visual-c++-6, usb-drive, portable-applications

在不使用任何第三方程序的情况下（即不使用 VMware ThinApp、U3 或 MojoPac 等）如何将 MSVC++ 6.0 从安装在 C: 上移动到 USB 驱动器？以便它可以在没有管理员权限且无需在主机 PC 上安装任何东西的不同 PC 上使用？即使它仅可用作控制台应用程序也可以，尽管拥有包括 Visual Assist 等在内的 GUI 会更好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-28T15:54:56.830

将安装创建的两个文件夹移动`c:\program files\`到 USB 驱动器（例如`e:\progs\msvc\msvc6`和`e:\progs\msvc\vc98`），并附加到文件`e:\progs\msvc\vc98\bin\vcvars32.bat`以适应例如

```
prompt $g
set path=e:\progs\uedit;e:\progs\utl;%PATH%
e:
cd e:\work
start e:\progs\uedit\uedit32.exe /i=e:\progs\uedit\uedit32.ini 
cmd /k 
```

使用 vcvars32.bat 的快捷方式可以很好地进行任何简单的控制台编程，这就是我迄今为止使用它的全部。我不知道工具文件夹中的任何 GUI 类型程序的运行情况如何。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T14:59:06.707

我不确定究竟是如何做到这一点的。

这里有一些想法。

安装过程至少会创建两组目录，因此您可以将它们都指向 USB 驱动器。

安装过程会创建一个 bat 文件，该文件为命令行执行正确设置环境变量。当您的记忆棒加载到另一台机器上时，修改它以指向正确的驱动器号可能很重要。

还有 vc 6 的注册表项。提取它们，并在需要时使用某种脚本将它们加载到目标计算机上，可能会很有用。

是否有需要 vc 6 的特定原因？另一个编译器会这样做吗？

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-12-09T15:25:56.607

我没有这样做，但它应该“只是”是一个问题：

*   将所有应用程序文件复制到 USB 驱动器。请记住，可能需要进入 Windows 目录的共享文件和内容。
*   识别和复制所有注册表项，尽管您可能需要成为管理员才能在目标计算机上创建其中的一些。

在我看来，这是一项艰巨的工作，但收效甚微。我认为可能有一个仅命令行版本的 Visual C++ 工具链可能更适合您的要求。IIRC 发布它是为了帮助人们为开源项目（如 Mozilla Tinderbox）创建构建机器人，并包含 VC++ 7.0 编译器。

# tsql - 如何跟踪 T-SQL 函数调用

> ID：352605
> 
> 赞同：22
> 
> 时间：2008-12-09T12:45:16.167
> 
> 标签：tsql, debugging, trace, user-defined-functions

我正在尝试调试一个用 T-SQL UDF（不要问）编写的相当复杂的公式评估器，它**递归地**（但通过中间函数间接地）调用自身，等等。

当然，我们有一个错误。

现在，使用 PRINT 语句（然后可以通过实现 InfoMessage 事件的处理程序从 ADO.NET 读取），我可以模拟存储过程的跟踪。

对 UDF 执行相同操作会导致编译时消息：

```
Invalid use of side-effecting or time-dependent operator in 'PRINT' within a function. 
```

我收到了消息（PRINT 做了一些事情，比如重置`@@ROWCOUNT`，这在 UDF 中绝对是禁止的，但是我如何跟踪调用？我想打印出这个跟踪，这样我就可以研究它而不会因为单步执行而分心调试器中的调用...

**编辑：**我尝试使用 SQL Profiler（这对我来说是第一次），但我不知道要跟踪什么：虽然我可以得到跟踪以输出发送到数据库的查询，但它们是从某种意义上说是不透明的，因为我无法深入到调用的 Expression-UDF：我可以跟踪调用的实际存储过程，但未列出此过程调用的 UDF。我错过了什么吗？我猜不会...

**编辑＃2：**尽管（自动）接受的答案确实跟踪了函数调用 - 非常有帮助，谢谢 - 它无助于找出*传递*给函数的参数。当然，这对于**调试**递归函数是必不可少的。如果我找到任何解决方案，我会发布...

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-09T12:50:56.137

为什么不使用添加了语句级事件的 SQL Profiler？

**编辑**：为存储过程添加事件：SP:Stmt Starting 或 SP:Stmt Completed 如果需要，使用变量进行调试，即设置 @debug='i am here'; UDF，虽然在技术上不是存储过程，但将使用语句级事件进行跟踪。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-17T14:48:18.760

在 SQL 探查器中，您需要：SP:Starting、SP:StmtStarting、SP:Completed、SQL:BatchStarting。然后，您获得每个条目，从函数/存储过程中退出。

```
alter FUNCTION [dbo].[ufn_mjf](@i numeric(10))
    RETURNS numeric(20) 
AS
BEGIN
declare @datapoint varchar(10)

    set @datapoint = 'hello world'

    return @i
END
go
drop table foo
go
create table dbo.foo ( foo_id numeric(10)) 
go
delete from foo
insert into foo ( foo_id ) values ( 1 )
insert into foo ( foo_id ) values ( 2 )

select foo_id, dbo.ufn_mjf(foo_id) from foo 
```

有了这个，我得到：

```
SQL:BatchStarting   alter FUNCTION [dbo].[ufn_mjf](@i numeric(10))
SQL:BatchStarting   drop table foo
SQL:BatchStarting   create table dbo.foo ( foo_id numeric(10)) 
SQL:BatchStarting   delete from foo
    insert into foo ( foo_id ) values ( 1 )
    insert into foo ( foo_id ) values ( 2 )
    select foo_id, dbo.ufn_mjf(foo_id) from foo
SP:Starting select foo_id, dbo.ufn_mjf(foo_id) from foo
SP:StmtStarting set @datapoint = 'hello world'
SP:StmtStarting return @i
SP:Completed    select foo_id, dbo.ufn_mjf(foo_id) from foo
SP:Starting select foo_id, dbo.ufn_mjf(foo_id) from foo
SP:StmtStarting set @datapoint = 'hello world'
SP:StmtStarting return @i
SP:Completed    select foo_id, dbo.ufn_mjf(foo_id) from foo 
```

这对你来说足够了吗？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-16T11:21:36.113

[这](http://msdn.microsoft.com/en-us/library/ms165047(VS.80).aspx)看起来像您需要的，但它仅在 Visual Studio 的团队/专业版本中可用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T14:02:06.993

使用 SQL Profiler，我建议您在第一次添加事件时过度使用，这会让您对所需内容有所了解。如果不进行测试，我会为 SP:StmtStarted（或 Completed 或两者）、SQL:StmtStarted（再次 Completed 或 Both）添加事件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T12:56:51.743

我支持 SQL Profiler 的建议。花一些时间进行设置，以便只记录您感兴趣的事件以减少输出大小。您可以将跟踪输出到文件 - 我经常将该文件加载回表中以启用分析。（对于性能分析非常方便，尽管毫无疑问有人会告诉我 2008 年将这一切都内置在 somwehere...）

有时您没有运行 SQL Profiler 的权限，因为它确实会降低服务器速度 - 请您的 DBA 授予您对开发服务器的权限。他们不应该有任何问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T16:50:15.250

过去，我不得不采用 UDF 中的典型值，然后在单独的查询窗口中仅将 udf 部分作为直接 SQL 而不是 udf 使用典型值作为变量集并使用声明和 set 语句运行。如果它是从一个表中运行而不是只有一个值，我将使用输入值设置一个临时表或表变量，然后通过 UDF 中的 sql 运行它们（但同样作为直接 SQL 而不是 UDF）通过光标。通过直接运行 SQL，您可以在其中包含打印语句以查看发生了什么。我知道这很痛苦，但它确实有效。（我在创建/调试触发器时经历了一个类似的过程，使用我的测试值设置#inserted 和#deleted，然后测试我打算放入触发器的代码，然后将# 全局替换为空并添加创建触发器代码。 )

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-13T13:33:29.810

也许您可以使用 SQL CLR 进行跟踪，如此处所述 [如何登录 T-SQL](https://stackoverflow.com/questions/58709/how-to-log-in-t-sql)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-16T15:31:54.793

您能否获取您的函数，并制作它的第二个副本，但返回一个表类型，其中包含用于调试信息的附加列。

例如下面的 mySum 函数

```
CREATE FUNCTION mySum
(   
    @param1 int,
    @param2 int
)
RETURNS INT AS
BEGIN
    DECLARE @mySum int

    SET @mySum = @param1

    SET @mySum = @mySum + @param2

    RETURN @mySum

END
GO
SELECT dbo.mySum(1, 2) 
```

会变成

```
CREATE FUNCTION mySumDebug
(   
    @param1 int,
    @param2 int
)
RETURNS @myTable TABLE
(
    [mySum] int,
    [debug] nvarchar(max)
)
AS
BEGIN
    DECLARE @debug nvarchar(max)

    SET @debug = 'Declare @mySum variable. '
    DECLARE @mySum int

    SET @debug = @debug + 'Set @mySum = @param1(' + CONVERT(nvarchar(50), @param1) + ') '
    SET @mySum = @param1

    SET @debug = @debug + 'Add @param2(' + CONVERT(nvarchar(50), @param2) + ') to @mySum(' + CONVERT(nvarchar(50), @mySum) + ') '
    SET @mySum = @mySum + @param2

    SET @debug = @debug + 'Return @mySum variable. '

    INSERT @myTable (mySum, debug) VALUES (@mySum, @debug)

    RETURN
END
GO
SELECT mySum, debug FROM dbo.mySumDebug(1, 2) 
```

不是一个理想的解决方案，但仅用于返回一些文本以帮助追踪错误。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T04:14:49.873

我使用 SQL SPY，它可以满足您的需求以及更多功能。

[SQL间谍](http://www.ispysql.com)

[SQL SPY 功能文档](http://www.ispysql.com/forum/viewtopic.php?f=11&t=115)

SQL SPY 的 Incoming SQL Sniffer 显示每个连接的传入 SQL 代码（包括 DDL 和 DML 语句跟踪）

此功能专为 MS SQL Server 2005\2008 设计，但可在有限范围内与 MS SQL Server 2000 一起使用。它具有记录和报告传入 SQL 的能力。如何使用这些功能：见

披露：我是 SQL SPY 团队的一员。

# maven-2 - 如何让 Maven 运行战争：爆炸但不是战争：战争

> ID：352612
> 
> 赞同：60
> 
> 时间：2008-12-09T12:49:58.933
> 
> 标签：maven-2

我有一个使用`<packaging>war</packaging>`. 但实际上，我不想构建战争文件，我只想收集所有依赖的 jar 并创建一个完整的部署目录。

所以我正在运行`war:exploded`生成部署目录的目标：

```
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-war-plugin</artifactId>
    <executions>
        <execution>
            <phase>package</phase>
            <configuration>
                <webappDirectory>target/${env}/deploy</webappDirectory>
                <archiveClasses>true</archiveClasses>
            </configuration>
            <goals>
                <goal>exploded</goal>
            </goals>
        </execution>
    </executions>
</plugin> 
```

问题是，war 文件仍然被构建。有没有一种简单的方法来`<packaging>war</packaging>`执行`war:exploded`目标而不是战争：战争目标？

还是有另一种简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2012-06-21T09:08:51.243

解决方案非常简单。您需要覆盖war插件的默认执行以禁用它并添加您自己的执行（用于爆炸）：

```
<pluginManagement>
    <plugins>
            <plugin><!-- don't pack the war  -->
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-war-plugin</artifactId>
                <executions>
                    <execution>
                        <id>default-war</id>
                        <phase>none</phase>
                    </execution>
                    <execution>
                        <id>war-exploded</id>
                        <phase>package</phase>
                        <goals>
                            <goal>exploded</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
    </plugins>
</pluginManagement> 
```

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-10-07T09:22:41.663

根据[内置的生命周期绑定](http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Built-in_Lifecycle_Bindings)，用于打包阶段中的战争包装 war:war mojo 被调用。

您可以调用之前的“准备包”阶段 - 所有操作都将执行，然后调用 mojo war:exploded

```
mvn prepare-package war:exploded 
```

结果将与您的相同，但不会产生战争。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2015-03-26T09:47:50.393

我想升级到@Michael Wyraz 答案，并且只包括*安装跳过*设置，以防有人`mvn clean install`在多模块项目的顶层执行构建并且子模块之一是 Web 应用程序。

这位于战争模块中：

```
<profiles>
    <profile>
        <id>war_explode</id>
        <build>
            <pluginManagement>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-war-plugin</artifactId>
                        <version>2.6</version>
                        <executions>
                            <execution>
                                <id>default-war</id>
                                <phase>none</phase>
                            </execution>
                            <execution>
                                <id>war-exploded</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>exploded</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-install-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>default-install</id>
                                <phase>none</phase>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </pluginManagement>
        </build>
    </profile>
</profiles> 
```

没有*安装跳过*构建失败，因为它试图将战争安装到 .m2 文件夹中。错误消息如下所示：

```
[INFO] --- maven-install-plugin:2.4:install (default-install) @ *** ---
[INFO]   ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-install-plugin:2.4:install (default-install) on project ***: The packaging for this project did not assign a file to the build artifact -> [Help 1] 
```

`mvn clean install -P war_explode`使用此设置（包含在名为 war_explode 的 maven 配置文件中*）*执行它会完成构建而不会出现错误。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-09-19T22:55:15.137

我能想到的唯一方法是设置使用 pom 包装（或创建[自定义包装](https://stackoverflow.com/questions/1427722/how-do-i-create-a-new-packaging-type-for-maven/1427749#1427749)）并将所需目标从战争包装绑定到生命周期的相关阶段。如果您进行 pom 打包，您可以在配置文件中定义 war:war 执行以允许您打包它，但您需要使用 build-helper-maven-plugin [attach-artifact 目标](http://mojo.codehaus.org/build-helper-maven-plugin/attach-artifact-mojo.html)将战争附加到庞。

*如果您想使用任何其他特定于战争的处理，请注意这种方法可能会给您带来问题。*

[War 打包的生命周期绑定在Build Lifecycle 简介](http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html)中列出（请参阅“默认生命周期绑定 - 打包 ejb/ejb3/jar/par/rar/war”部分）。

要将相关的插件执行绑定到 pom 打包，您可以执行以下操作：

```
<build>
  <plugins>
    <plugin>
      <artifactId>maven-resources-plugin</artifactId>
      <executions>
        <execution>
          <id>process-resources</id>
          <phase>process-resources</phase>
          <goals>
            <goal>resources</goal>
          </goal>
        </execution>
      </executions>
    </plugin>
    <plugin>
      <artifactId>maven-compile-plugin</artifactId>
      <executions>
        <execution>
          <id>compile</id>
          <phase>compile</phase>
          <goals>
            <goal>compile</goal>
          </goal>
        </execution>
      </executions>
    </plugin>
    <plugin>
      <artifactId>maven-resources-plugin</artifactId>
      <executions>
        <execution>
          <id>process-test-resources</id>
          <phase>process-test-resources</phase>
          <goals>
            <goal>testResources</goal>
          </goal>
        </execution>
      </executions>
    </plugin>
    <plugin>
      <artifactId>maven-surefire-plugin</artifactId>
      <executions>
        <execution>
          <id>test</id>
          <phase>test</phase>
          <goals>
            <goal>test</goal>
          </goal>
        </execution>
      </executions>
    </plugin>
    <!-- package not wanted, install and deploy already defined for pom packaging-->
    <!--define war:war execution in a profile in case it is needed--> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T19:55:57.167

据我所知（我还是 Maven 新手）这是不可能的。您可以跳过的唯一默认生命周期是“测试”。为了进行部署，您必须打包。您可以在此处阅读有关默认生命周期执行顺序的所有信息： [http ://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference](http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference)

# html - 网页中的垂直表格

> ID：352614
> 
> 赞同：0
> 
> 时间：2008-12-09T12:50:22.880
> 
> 标签：html, css

我想在相同数据的垂直和水平表布局之间切换。

尽管可以通过为垂直布局的第一列应用与水平布局的标题行应用的 CSS 相同的 CSS 来做到这一点。

有什么方法可以让网页呈现我们喜欢的方式（水平/垂直）。

PS 我无法添加任何图像。对此表示歉意。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T13:02:34.227

你是说你想有效地切换行和列吗？

您不能对表格执行此操作，因为 A)。行和列具有特定的语义和 B)。这种在 HTML 标记中的结构方式将单元格分组在行集中，而不是在带有索引的表集中，您可以将矩阵应用到。显然，如果你真的必须这样做，JS 可以做到。

如果您有单行单元格，则可以使用浮动 <div> 标记与容器 <div> 更改宽度（以及其他方法）来安排类似的效果

# oop - 每个对象都应该有一个接口并且所有对象都松散耦合吗？

> ID：352618
> 
> 赞同：40
> 
> 时间：2008-12-09T12:52:15.137
> 
> 标签：oop, language-agnostic, interface

从我读过的最佳实践来看，最好的做法是让类基于接口并松散地耦合对象，以帮助代码重用和单元测试。

这是正确的吗？是应该始终遵循的规则吗？

我问的原因是我最近在一个包含 100 个非常不同的对象的系统上工作。一些共享的通用接口，但大多数没有，并且想知道它是否应该有一个接口来镜像这些类中的每个属性和函数？

我正在使用 C# 和 dot net 2.0，但我相信这个问题适合多种语言。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-12-09T12:57:48.747

它对于真正提供服务的对象很有用——身份验证、存储等。对于没有任何进一步依赖关系的简单类型，并且永远不会有任何替代实现，我认为使用具体类型是可以的。

如果你在这种事情上做得过火，你最终会花费*大量*时间来模拟/存根世界上的一切——这通常会导致创建脆弱的测试。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-09T13:00:22.657

并不真地。服务组件（为您的应用程序做事的类）非常适合接口，但通常我不会费心为基本实体类提供接口。

例如：如果您正在处理域模型，那么该模型不应该是接口。但是，如果该域模型想要调用服务类（如数据访问、操作系统功能等），那么您应该查看这些组件的接口。这减少了类之间的耦合，并意味着它是耦合的接口或“合同”。

在这种情况下，您开始发现编写单元测试要容易得多（因为您可以使用 stubs/mocks/fakes 来访问数据库等），并且可以使用 IoC 交换组件而无需重新编译您的应用程序。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-09T13:10:33.820

我只会使用需要那种抽象级别的接口——即你需要使用多态行为。常见的例子是依赖注入或者你在某个地方有工厂类型的场景，或者你需要建立一个“多重继承”类型的行为。

就我而言，以我的开发风格来说，这是很常见的（对于除了 UI 控件之外的大多数事情，我更喜欢聚合而不是深度继承层次结构），但我已经看到非常好的应用程序使用很少。这一切都取决于...

哦，是的，如果您确实大量使用接口 - 请注意 Web 服务。如果您需要通过 Web 服务公开您的对象方法，它们不能真正返回或获取接口类型，只能返回具体类型（除非您要手动编写所有自己的序列化/反序列化）。是的，这让我很痛苦……

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-09T14:00:11.507

接口的一个缺点是它们不能被版本化。一旦您发布了界面，您将不会对其进行更改。如果您使用抽象类，那么您可以通过添加新方法并将它们标记为虚拟来轻松扩展合同。

例如，.NET 中的所有流对象都派生自抽象类 System.IO.Stream。这使 Microsoft 可以轻松添加新功能。在 frameworkj 的版本 2 中，他们添加了**ReadTimeout**和**WriteTimeout**属性，而不会破坏任何代码。如果他们使用接口（比如 IStream），那么他们将无法做到这一点。相反，他们必须创建一个新接口来定义超时方法，如果我们想使用该功能，我们必须编写代码以有条件地转换为该接口。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-09T13:31:00.877

当您想清楚地定义软件的两个不同部分之间的交互时，应该使用接口。尤其是当您可能想撕掉连接的任一端并用其他东西替换它时。

例如，在我的 CAM 应用程序中，我有一个与点集合相连的切割路径。拥有 IPointList 接口是没有意义的，因为在我的应用程序中，CuttingPaths 总是由点组成。

但是我使用 IMotionController 接口与机器进行通信，因为我们支持许多不同类型的切割机，每种切割机都有自己的推荐集和通信方法。因此，在这种情况下，将其放在接口后面是有意义的，因为一个安装可能使用与另一台不同的机器。

我们的应用程序自 80 年代中期就开始维护，并在 90 年代后期转向面向对象的设计。我发现可以改变的东西大大超出了我最初的想法，接口的使用也在增长。例如，过去我们的 DrawingPath 是由点组成的。但现在它由实体（样条线、弧线、ec）组成，因此它指向一个 EntityList，它是实现 IEntity 接口的对象的集合。

但是，这种变化是由于意识到可以使用许多不同的方法绘制 DrawingPath。一旦意识到需要多种绘图方法，就表明需要接口而不是与实体对象的固定关系。

请注意，在我们的系统中，DrawingPaths 被渲染为低级切割路径，该切割路径始终是一系列点段。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-03-06T08:18:36.803

在最近的一个项目中，我试图从字面上接受“接口代码”的建议。最终结果基本上是每个类的公共接口（小 i）在接口（大 I）实现中精确地重复一次。这在实践中是毫无意义的。

我觉得一个更好的策略是将你的接口实现限制在**动词**：

```
Print()
Draw()
Save()
Serialize()
Update() 
```

...等等等等。这意味着主要作用是存储数据的类——如果你的代码设计得很好，他们通常只会这样做——不想要或不需要接口实现。任何您可能需要运行时可配置行为的地方，例如表示相同数据的各种不同图形样式。

当要求工作的人真的不想知道工作是如何完成的时候，这会更好。这意味着你可以给它一个 macguffin，它可以简单地相信它会做任何它的公共接口说它做的事情，并让有问题的组件简单地选择**何时**做工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-09T13:43:31.040

我同意克波洛克。接口用于获得对象的共同点。它们可以用于 IOC 容器和其他用途的事实是一个附加功能。

假设您有几种类型的客户类别，它们略有不同但具有共同的属性。在这种情况下，最好有一个`ICustomer`接口将它们逻辑地绑定在一起。通过这样做，您可以创建一个`CustomerHander`以相同方式处理 ICustomer 对象的类/方法，而不是为每个客户变体创建一个handerl 方法。

这就是接口的优势。如果你只有一个实现接口的类，那么接口就没有多大帮助，它只是坐在那里，什么都不做。

# c# - 如何使用 C# 和 IIS 无缝压缩我发布到表单的数据？

> ID：352623
> 
> 赞同：2
> 
> 时间：2008-12-09T12:53:10.487
> 
> 标签：c#, iis, compression, httpwebrequest

我必须与不使用 Web 服务的稍微过时的系统进行交互。为了向这个系统发送数据，我需要将一个 XML 文档发布到另一个系统网站上的*表单中。*这个 XML 文档可能会变得非常大，所以我想压缩它。另一个系统位于 IIS 上，我最终使用 C#。我当然可以在发布数据之前实现一些压缩数据的方法，但这需要其他系统进行更改，以便它可以解压缩数据。我想避免更改其他系统，因为我不拥有它。

我听说过有关在 IIS 和浏览器中启用压缩/http 1.1 的模糊信息，但我不知道如何将其转换为我的程序。基本上，我可以在我的程序中设置一些属性，使我的程序自动压缩它发送到 IIS 的数据，并让 IIS 无缝解压缩它，以便接收应用程序甚至不知道其中的区别？

这是一些示例代码，大致显示了我在做什么；

```
private static void demo()
    {

        Stream myRequestStream = null;
        Stream myResponseStream = null;

        HttpWebRequest myWebRequest = (HttpWebRequest)System.Net
                              .WebRequest.Create("http://example.com");
        byte[] bytMessage = null;
        bytMessage = Encoding.ASCII.GetBytes("data=xyz");
        myWebRequest.ContentLength = bytMessage.Length;
        myWebRequest.Method = "POST";

        // Set the content type as form so that the data
        // will be posted as form              
        myWebRequest.ContentType = "application/x-www-form-urlencoded";

        //Get Stream object 
        myRequestStream = myWebRequest.GetRequestStream();

        //Writes a sequence of bytes to the current stream    
        myRequestStream.Write(bytMessage, 0, bytMessage.Length);

        //Close stream
        myRequestStream.Close();

        WebResponse myWebResponse = myWebRequest.GetResponse();
        myResponseStream = myWebResponse.GetResponseStream();
} 
```

“data=xyz”实际上是“data=[一个几 MB XML 文档]”。

我知道，如果可以通过非编程方式实现这一点，那么这个问题最终可能会归入非编程领域，因此请提前道歉。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T13:07:15.963

我认为没有办法在一侧压缩数据并在另一侧接收未压缩的数据而不主动解压缩数据..

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T13:13:17.187

不知道这是否可行，因为我能找到的所有示例都是用于下载的，但您可以尝试使用 gzip 压缩数据，然后将传出消息上的 Content-Encoding 标头设置为`gzip`. 我相信 Length 应该是压缩消息的长度，尽管如果这不起作用，您可能希望将其设置为未编码消息的长度。

祝你好运。

**编辑** 我认为问题在于支持压缩的 ISAPI 过滤器是否在上传时永远/总是/可配置地调用。我找不到答案，所以我怀疑答案永远不会，但直到你尝试（或找到我无法找到的答案）后你才会知道。

# .net - 声明演示者和视图

> ID：352632
> 
> 赞同：0
> 
> 时间：2008-12-09T12:58:20.007
> 
> 标签：.net, design-patterns

我正在制作一个由屏幕（Presenter + View）组成的 WPF 应用程序。我希望能够在配置文件或 SQL 数据库中声明这些屏幕。我一直在尝试想出一个我已经放弃的好解决方案，我想问你们中的一些人是如何设计这种东西的？我已经为此工作了一个多星期，我想出的每一个解决方案都很糟糕。

在我的 WPF 应用程序中，我有一个表示屏幕的树视图。当用户点击一个节点时，屏幕被加载。我希望能够从配置文件或数据库中填充树节点。该程序不应该关心这些存储在哪里，因此我可以将配置存储换成数据库存储。如果我存储了屏幕信息，我还可以使用 IOC 容器为我实例化屏幕并按名称检索它们。这是我提出的配置文件模式的示例：

```
<screen name="" title="" presenterType="" viewType=""/>
<screen ...>
    <screen .../>
    <screen .../>
</screen>
<screen .../> 
```

我想出的最新解决方案是使用 ScreenService 向 ScreenRepository 询问 ScreenInfo 对象。然后我将能够使用此信息填充树视图和 IOC 容器。

这听起来像是一个好的解决方案吗？你会做什么不同的事情？而且，您如何在自己的编程中设计这种系统？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-09T13:14:48.010

通常，您需要为这些类型的情况使用工厂模式。您的 ScreenService、ScreenRepository 和 Screeninfo 的组合听起来像是您成功了。[这](http://en.wikipedia.org/wiki/Factory_pattern)是工厂模式的基本概述。您可以使用 Wikipedia 文章作为起点，看看是否有您遗漏的任何变化或方面。

我设计并维护了一个 CAD/CAM 应用程序，该应用程序具有多个预先确定的参数形状库，用户可以在其中键入几个尺寸并计算切割形状。每个形状都有自己的屏幕设置。在我的应用程序启动期间，我使用与您类似的模式。

我扫描每个程序集的形状库目录，挑选具有检索形状列表的方法的工厂类，将其加载到主列表中。当用户单击工具栏按钮或从列表中选择时，软件然后使用键将正确的形状从列表中拉出，从而显示 IShapeScreen 界面。管理形状的表单使用该界面为该形状绘制正确的输入屏幕。

这种方法已经运行了近十年，没有出现任何重大问题，同样重要的是，它并没有给我留下“哦，我希望我在设计它时就这样做了”的感觉。所以我认为你在正确的轨道上。

请注意，您可能不需要使用基于文本的配置文件。使用属性、您定义的一些接口和 .NET 反射 API，您可以将 DLL 放入一个目录中，软件可以扫描该目录并正确提取所需的对象。在您的情况下，屏幕对象。但是，如果您希望人工编辑配置，则肯定需要基于文本的文件。我假设您使用的是 .NET API，因为您使用 .NET 进行了标记。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T13:48:41.030

抱歉，我应该提到我使用的是 .NET 3.5。我太习惯在我忘记的 ASP.NET 论坛上发帖了。

我确实喜欢扫描程序集的想法，但我希望将其定义为用于填充树视图的层次结构。此外，与配置文件或数据库相比，使用反射扫描程序集的性能损失是多少？这是一个显着的差异还是很小的差异，没有人能说出来？

我正在创建的应用程序将在我们公司内部使用。它需要有一个用于导航的层次结构，以便我们的屏幕可以很容易地找到。扫描程序集文件夹会很好，因为我们可以创建一个模块并通过它进入该文件夹，应用程序会自动获取它。这将导致以分层方式表示屏幕的问题。此外，我们希望实施授权，以便用户只能看到他们被允许使用的屏幕。

感谢您的回复。我喜欢看别人如何做事。它帮助我理解了很多这些设计概念，因为我刚刚开始走上设计模式的道路（刚刚订购了 PEAA 书）。其他任何人请分享您的想法。它也可以帮助像我这样偶然发现这个问题的人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T14:31:35.593

当您从工厂方法中返回对象时，您也可以包含层次结构。例如，我的形状工厂有两种方法，一种返回添加到主列表的形状列表，另一种返回形状库。虽然用户可以定义和更改实际库，但我有一个自动生成的默认集用于故障排除和初始安装。它是分层的。

然而，ShapeLibrary 由 ShapeLibraryItem 组成。ShapeLibraryItem 存储了一个密钥，因此它可以将形状从主程序列表中拉出。因此，单击按钮或项目时，它会查看与其关联的 ShapeLibrary 项目。获取key，使用key获取shape程序，然后使用UI界面绘制屏幕。

如果您的屏幕将层次结构信息作为其众多属性之一嵌入，那么我建议您将其分离到一个层次结构项目中。然后可以创建由 HierarchyLists 或 HierarchyItem 组成的 HierarchyList。我会制作一个 IHierarchyItem 接口，以便 HierarchyLists 看起来像一个项目。

主要区别在于行为。当您单击 HeirarchyList 时，会弹出另一个列表（或展开等），真正的 Item 会弹出一个屏幕。

因此，您的程序集将有两个类标记有两个属性之一。一个是 ScreenFactory，另一个是 HierarchyFactory。

请注意，您不必使用可以将 HierarchyItem 直接链接到形状的键。我使用 GUID 键来避免每次耦合。耦合并不总是坏的，但也不总是好的。由于 GUID 实际上是唯一的，因此它的工作原理相同。

至于性能，您必须经过数百次组装才能注意到它。请记住，您不必为每个屏幕都安装一个程序集。只需将它们按逻辑分组到少数程序集中，您就可以开始了。

# linux - 配置ip别名和路由，处理网络不可用

> ID：352633
> 
> 赞同：2
> 
> 时间：2008-12-09T12:59:15.870
> 
> 标签：linux, networking, shell

我需要编写一个脚本来将 ip 地址/掩码/广播设置为 eth0:0 上的别名，并设置默认网关。

此解决方案有效：

```
ifconfig eth0:0 <ip> netmask <mask> up
ip route replace default via <ip> 
```

但有时第二个电话会收到错误“网络不可用”。

在它们之间添加睡眠可以修复它，但不可靠。等待网络准备好的正确方法是什么？

到目前为止，我想出的最好的方法是重试 ip 呼叫几次。这有效，但感觉很难看。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T01:06:36.730

您可以`ping -c1 -w`在循环中使用网关地址，直到它出现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T09:53:56.510

我认为 ifconfig 返回时接口未启动有点奇怪。我会尝试跳过 ifconfig 并仅使用“ip”命令：

```
ip address add <ip>/<mask> dev eth0
ip route replace default via <ip> 
```

这不会创建一个新的别名接口 eth0:0，它只是在主接口上配置一个额外的 IP 地址，在“IP 地址列表”中可见。我不确定这是否效果更好，但值得一试。

# java - 获取线程的输出

> ID：352638
> 
> 赞同：12
> 
> 时间：2008-12-09T13:01:38.643
> 
> 标签：java, multithreading

您认为获得线程工作结果的最佳方式是什么？想象一个进行一些计算的线程，你如何警告主程序计算完成？

您可以每隔 X 毫秒轮询一次名为“作业已完成”的公共变量或其他内容，但随后您将收到比它们可用时更晚的结果......主要代码将浪费时间等待它们。另一方面，如果您使用较低的 X，CPU 将被浪费如此多次轮询。

那么，你要怎么做才能知道线程或某些线程已经完成了他们的工作？

抱歉，如果它看起来与其他[问题相似，我想这可能是](https://stackoverflow.com/questions/289434/how-to-make-a-java-thread-wait-for-another-threads-output)*eben*答案的原因。我的意思是运行大量线程并知道它们何时完成，而不需要轮询它们。

我更多地考虑使用批次线程在多个 CPU 之间共享 CPU 负载，并知道批次何时完成。我想它可以用**Future**的对象来完成，但是阻塞的***get***方法看起来很像一个隐藏的锁，而不是我喜欢的东西。

感谢大家的支持。尽管我也喜欢 erickson 的答案***，***但我认为***saua***是最完整的，也是我将在自己的代码中使用的答案。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-09T13:07:10.083

不要使用诸如线程之类的低级构造，除非您绝对需要强大的功能和灵活性。

您可以使用[ExecutorService](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ExecutorService.html)（例如[ThreadPoolExecutor](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ThreadPoolExecutor.html) ）来[submit()](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ExecutorService.html#submit(java.util.concurrent.Callable)) [Callables](http://java.sun.com/javase/6/docs/api/java/util/concurrent/Callable.html)。这将返回一个[Future](http://java.sun.com/javase/6/docs/api/java/util/concurrent/Future.html)对象。

使用该`Future`对象，您可以轻松检查它是否已完成并获得结果（`get()`如果尚未完成，则包括阻塞）。

这些构造将大大简化最常见的线程操作。

我想澄清一下阻塞`get()`：

这个想法是你想运行一些任务（ s）来做一些工作（计算，资源访问，......）你*现在*`Callable`不需要结果。您可以只依赖于随时运行您的代码（如果是，那么只要有空闲线程可用，它就会运行）。然后在某个时间点，您可能*需要*计算结果才能继续。此时您应该调用. 如果此时任务已经运行，那么将立即返回该值。如果任务未完成，则调用将等到任务完成。这通常是需要的，因为无论如何您都无法在没有任务结果的情况下继续。*`Executor``ThreadPoolExecutor`*`get()``get()``get()`**

 **当您不需要该值继续，但想知道它是否已经可用（可能在 UI 中显示某些内容）时，您可以轻松调用`isDone()`并且仅`get()`在返回时调用`true`）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-18T10:50:56.363

您可以创建一个主程序实现的列表器接口，一旦它完成执行它的工作，它就会由工作人员调用。

这样你就不需要投票了。

这是一个示例界面：

```
/**
 * Listener interface to implement to be called when work has
 * finished.
 */
public interface WorkerListener {
    public void workDone(WorkerThread thread);
} 
```

这是一个实际线程的示例，它执行一些工作并通知它的侦听器：

```
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

/**
 * Thread to perform work
 */
public class WorkerThread implements Runnable {
    private List listeners = new ArrayList();
    private List results;

    public void run() {
        // Do some long running work here

        try {
            // Sleep to simulate long running task
            Thread.sleep(5000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        results = new ArrayList();
        results.add("Result 1");

        // Work done, notify listeners
        notifyListeners();
    }

    private void notifyListeners() {
        for (Iterator iter = listeners.iterator(); iter.hasNext();) {
            WorkerListener listener = (WorkerListener) iter.next();
            listener.workDone(this);
        }
    }

    public void registerWorkerListener(WorkerListener listener) {
        listeners.add(listener);
    }

    public List getResults() {
        return results;
    }
} 
```

最后，主程序启动一个工作线程并注册一个监听器，以便在工作完成后得到通知：

```
import java.util.Iterator;
import java.util.List;

/**
 * Class to simulate a main program
 */
public class MainProg {
    public MainProg() {
        WorkerThread worker = new WorkerThread();
        // Register anonymous listener class
        worker.registerWorkerListener(new WorkerListener() {
            public void workDone(WorkerThread thread) {
                System.out.println("Work done");
                List results = thread.getResults();
                for (Iterator iter = results.iterator(); iter.hasNext();) {
                    String result = (String) iter.next();
                    System.out.println(result);
                }
            }
        });

        // Start the worker thread
        Thread thread = new Thread(worker);
        thread.start();

        System.out.println("Main program started");
    }

    public static void main(String[] args) {
        MainProg prog = new MainProg();
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T13:10:43.290

轮询又名忙等待不是一个好主意。正如您所提到的，忙碌的等待会浪费 CPU 周期，并可能导致您的应用程序看起来没有响应。

我的 Java 很粗糙，但您想要以下内容：

如果一个线程必须等待另一个线程的输出，您应该使用条件变量。

```
final Lock lock = new ReentrantLock();
final Condition cv = lock.newCondition(); 
```

对其他威胁的输出感兴趣的线程应该调用`cv.wait()`. 这将导致当前线程阻塞。当工作线程完成*工作*时，它应该调用`cv.signal()`. 这将导致被阻塞的线程被解除阻塞，允许它检查工作线程的输出。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T15:49:01.333

作为 Saua 描述的并发 API 的替代方案（如果主线程不需要知道工作线程何时完成），您可以使用发布/订阅模式。

在这种情况下，子`Thread`/`Runnable`被赋予一个*监听*器，它知道如何处理结果并在子`Thread`/`Runnable`完成时被回调。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T16:19:08.370

您的情况仍然有点不清楚。

如果您正在运行批处理作业，您可能需要使用[`invokeAll`](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ExecutorService.html#invokeAll(java.util.Collection)). 这将阻塞您的主线程，直到所有任务完成。这种方法没有“忙等待”，主线程会浪费 CPU 轮询`isDone`Future 的方法。虽然此方法返回 列表`Futures`，但它们已经“完成”。（还有一个重载版本可以在完成之前超时，这对于某些任务可能更安全。）这比尝试自己收集一堆`Future`对象并尝试检查它们的状态或阻止它们的`get`方法要干净得多分别。

如果这是一个交互式应用程序，任务偶尔会在后台执行，那么使用[nick.holt](https://stackoverflow.com/questions/352638/getting-the-output-of-a-thread#353210)建议的[回调](http://en.wikipedia.org/wiki/Callback_(computer_science))是一个很好的方法。在这里，您使用a 。该方法在计算结果时使用结果调用回调。使用这种方法，您可能会丢弃返回的，除非您希望能够在不关闭整个.[`submit`](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ExecutorService.html#submit(java.lang.Runnable))`Runnable``run``Future``submit``cancel``ExecutorService`

如果您希望能够取消任务或使用超时功能，要记住的重要一点是通过调用[`interrupt`](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.html#interrupt())其线程来取消任务。因此，您的任务需要定期检查其[中断状态并根据需要中止。](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.html#interrupted())

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-09T19:31:26.983

子类线程，并给你的类一个返回结果的方法。调用该方法时，如果尚未创建结果，则使用线程 join()。当 join() 返回时，您的线程的工作将完成并且结果应该可用；把它返还。

仅当您确实需要触发异步活动，在等待时做一些工作，然后获得结果时才使用它。否则，线程的意义何在？您不妨编写一个完成工作并在主线程中返回结果的类。

另一种方法是回调：让您的构造函数接受一个参数，该参数实现一个带有回调方法的接口，该回调方法将在计算结果时调用。这将使工作完全异步。但是如果你在某个时候需要等待结果，我认为你仍然需要从主线程调用 join() 。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-09T14:22:25.517

正如 saua 所指出的：使用 java.util.concurrent 提供的构造。如果您坚持使用 1.5（或 5.0）之前的 JRE，您可能会采用自己的滚动方式，但您仍然最好使用反向端口：http: [//backport-jsr166.sourceforge.net/](http://backport-jsr166.sourceforge.net/)

# .net - 疑难解答：MS-Word VSTO 加载项中托管 dll 的程序集解析

> ID：352641
> 
> 赞同：3
> 
> 时间：2008-12-09T13:03:00.217
> 
> 标签：.net, vsto, assembly-resolution, word-2007

我有一个 MS-Word VSTO 文档，其中包含一个名为`WordDocument1.dll`

**项目文件夹 D:\Work\Seven\WordAutomation\ContentControls\WordDocument1\bin\Debug**
我已将一些自定义代码复制到该`MyAppExecs`文件夹​​下的文件夹中。DLL 具有指定的专用 bin 路径，以便`MyAppExecs`可以访问其中的代码。

所以在启动时，我在应该弹出一个对话框`Starter.DLL`的`MyAppExecs`文件夹中加载一个，它确实如此。但是，单击对话框上的按钮需要加载`X.DLL`，它具有非托管依赖项。（`X.DLL`有一些托管的 C++，有一些指定为附加依赖项的库。X 是无符号的，是一个私有程序集，不在 GAC 中）

但是，X.DLL 无法解析。从该`fuslogvw`工具中，我看到它正在尝试将**这个 DLL 加载到 Office12 文件夹中并且失败**。我也`ProcMon`运行过，但是，它没有显示任何未找到的非托管依赖文件错误。

*   如何让 Word Executable 看到其中存在的 X.Dll `D: \Work\Seven\WordAutomation\ContentControls\WordDocument1\bin\Debug`？

此外，它似乎很奇怪，它可以加载`Starter.DLL`和大量其他`{ProjFolder}\MyAppExecs`文件而没有任何问题，但看不到`{ProjFolder}`.

这是`fuslogvw`输出：

```
*** Assembly Binder Log Entry  (12/9/2008 @ 6:10:06 PM) ***

The operation failed.
Bind result: hr = 0x80070002\. The system cannot find the file specified.

Assembly manager loaded from:  C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\mscorwks.dll
Running under executable  C:\Program Files\Microsoft Office\Office12\WINWORD.EXE
--- A detailed error log follows. 

=== Pre-bind state information ===
LOG: User = GEIPS-EURO\PillaiGi
LOG: DisplayName = MyNamespace.X, Version=1.0.0.0, Culture=neutral, PublicKeyToken=5574221fffc7dcd4
 (Fully-specified)
LOG: Appbase = file:///C:/Program Files/Microsoft Office/Office12/
LOG: Initial PrivatePath = NULL
LOG: Dynamic Base = NULL
LOG: Cache Base = NULL
LOG: AppName = NULL
Calling assembly : (Unknown).
===
LOG: This bind starts in default load context.
LOG: No application configuration file found.
LOG: Using machine configuration file from C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\config\machine.config.
LOG: Post-policy reference: MyNamespace.X, Version=1.0.0.0, Culture=neutral, PublicKeyToken=5574221fffc7dcd4
LOG: GAC Lookup was unsuccessful.
LOG: Attempting download of new URL file:///C:/Program Files/Microsoft Office/Office12/MyNamespace.X.DLL.
LOG: Attempting download of new URL file:///C:/Program Files/Microsoft Office/Office12/MyNamespace.X/MyNamespace.X.DLL.
LOG: Attempting download of new URL file:///C:/Program Files/Microsoft Office/Office12/MyNamespace.X.EXE.
LOG: Attempting download of new URL file:///C:/Program Files/Microsoft Office/Office12/MyNamespace.X/MyNamespace.X.EXE.
LOG: All probing URLs attempted and failed. 
```

**更新#1**：解决了症状，但无法确定问题的原因。我通过 Assembly.load 手动加载了程序集。但是，上面的程序集解析错误一直被记录下来，但它不起作用。最后，在绝望的情况下，我将我的 word-project DLL 复制到`{ProjFolder}\MyAppExecs`这样所有的 DLL 都在一个文件夹中并且它开始工作了。

当我运行时，看起来一些非托管依赖项`X.dll`没有得到解决，`{ProjFolder}...`但是`ProcMon`没有显示任何迹象。还将 PATH 变量更新为 include `{ProjFolder}\MyAppExecs`，但没​​有运气。

因此，将它们全部复制到一个文件夹中是可行的。`X.dll`不是我的代码，所以我无法进一步调查。

# java - 如何将全局变量设置为 JSLint 以忽略整个文件集？

> ID：352646
> 
> 赞同：2
> 
> 时间：2008-12-09T13:04:48.933
> 
> 标签：java, javascript, validation, ant, jslint

我想在构建过程中运行 JSLint4Java。我在一个库中有大约 1000 个 JS 文件，并且真的不想添加一个

```
/*globals foo, bar, baz */ 
```

他们每个人的标题 - 特别是因为他们中的许多人来自外部库（Dojo）。但是，如果我不添加标题，JSLint 会抱怨几乎每个文件都有相同的五个全局变量。有没有办法告诉 JSLint 忽略它们？到目前为止我想到的一些事情：

1.  某种 AntFileMap 任务，它创建一个虚拟目录层次结构，它是另一个层次结构的精确副本，但对每个文件都有一个过滤器（在这种情况下，前面有一个`/*globals */`标题）。

2.  破解 JSLint4Java 以接受一组`globals`它作为注释添加到它处理的每个文件的开头。

我从未见过像（1）这样的东西。(2) 似乎比较容易，但如果可能的话，我更喜欢使用原始工具。有更好的建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-11-12T17:31:10.230

来自[http://www.ohloh.net/p/jslint4java](http://www.ohloh.net/p/jslint4java)

> 新闻 2009-12-02。jslint4java 1.3.3 发布。值得注意的更改：添加对 predef 选项的支持，以允许指定预定义全局变量的列表。

听起来像您可能正在寻找的东西。试试 --help 选项来获取语法，也许？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-05T19:29:26.047

您还可以使用[LintRoller](http://arthurakay.github.io/LintRoller/) - 一个 Node.js 实用程序，用于根据 JSLint、JSHint 和其他验证检查整个目录或项目。

# wcf - 找不到默认端点元素

> ID：352654
> 
> 赞同：380
> 
> 时间：2008-12-09T13:06:41.630
> 
> 标签：wcf, .net-3.5, wcf-binding, endpoint

我已将代理添加到 VS2008/.NET 3.5 解决方案的 Web 服务。构建客户端 .NET 时会引发此错误：

> 在 ServiceModel 客户端配置部分中找不到引用合同“IMySOAPWebService”的默认端点元素。这可能是因为没有为您的应用程序找到配置文件，或者因为在客户端元素中找不到与此合同匹配的端点元素。

搜索这个错误告诉我在合同中使用完整的命名空间。这是我的 app.config 与完整的命名空间：

```
<client>
  <endpoint address="http://192.168.100.87:7001/soap/IMySOAPWebService"
            binding="basicHttpBinding" bindingConfiguration="IMySOAPWebServicebinding"
            contract="Fusion.DataExchange.Workflows.IMySOAPWebService" name="IMySOAPWebServicePort" />
</client> 
```

我在本地运行 XP（我之所以提到这一点，是因为许多谷歌点击提到了 win2k3） app.config 被复制到 app.exe.config，所以这也不是问题。

有什么线索吗？

* * *

## 回答 #1

> 赞同：608
> 
> 时间：2010-04-29T13:18:41.840

“如果您在类库中调用服务并从另一个项目中调用类库，则可能会出现此错误。”

在这种情况下，您需要将 WS 配置设置包含到主项目 app.config（如果它是一个 winapp）或 web.config（如果它是一个 Web 应用程序）中。即使使用 PRISM 和 WPF/Silverlight，这也是要走的路。

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2011-06-16T08:57:00.913

我通过自己创建绑定和端点地址实例解决了这个问题（我认为其他人可能已经建议） - 因为我不想向配置文件添加新设置（这是对一些现有库代码的替代品，这些代码被广泛使用，并且以前使用过较旧的 Web 服务参考等），因此我希望能够将其放入而无需在任何地方添加新的配置设置。

```
var remoteAddress = new System.ServiceModel.EndpointAddress(_webServiceUrl);

using (var productService = new ProductClient(new System.ServiceModel.BasicHttpBinding(), remoteAddress))
{
    //set timeout
    productService.Endpoint.Binding.SendTimeout = new TimeSpan(0,0,0,_webServiceTimeout);

    //call web service method
    productResponse = productService.GetProducts();
} 
```

**编辑**

如果您使用的是 https，那么您需要使用`BasicHttpsBinding`而不是`BasicHttpBinding`.

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2008-12-10T13:19:45.783

测试了几个选项后，我终于通过使用解决了这个问题

> 合同="IMySOAPWebService"

即配置中没有完整的命名空间。由于某种原因，全名没有正确解析

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2010-06-10T17:44:39.880

我也有同样的问题。事实证明，对于 Web REFERENCE，您必须将 URL 作为第一个参数提供给构造函数：

```
new WebService.WebServiceSoapClient("http://myservice.com/moo.aspx"); 
```

对于新样式的 web SERVICE REFERENCE，您必须提供一个引用配置中端点条目的名称：

```
new WebService.WebServiceSoapClient("WebServiceEndpoint"); 
```

在`Web.config`or中有相应的条目`App.config`：

```
<client>
      <endpoint address="http://myservice.com/moo.aspx"
        binding="basicHttpBinding" 
        bindingConfiguration="WebService"
        contract="WebService.WebServiceSoap"
        name="WebServiceEndpoint" />
    </client>
  </system.serviceModel> 
```

很难消除“它在旧程序中工作”的隧道视野......

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2011-08-11T05:03:32.067

我有这样的情况，我有

*   WCF 服务托管在某处
*   主要项目
*   具有对 WCF 服务的服务引用的“类库”类型的消费者项目
*   主项目调用消费者项目的方法

现在 Consumer 项目在我的 app.config 的 Tag 中有所有相关的配置设置`<system.serviceModel>`，它仍然抛出与上面相同的错误。

我所做的只是将相同的标签添加`<system.serviceModel>`到我的主项目的 app.config 文件中，最后我们一切顺利。

就我而言，真正的问题是读取错误的配置文件。它指的是主项目的配置，而不是消费者的 app.config。我花了两个小时才弄明白。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2014-12-05T07:06:57.910

> > “如果您在类库中调用服务并从另一个项目中调用类库，则可能会出现此错误。”
> > 
> > > “在这种情况下，您需要将 WS 配置设置包含到主项目 app.config（如果它是一个 winapp）或 web.config（如果它是一个 Web 应用程序）中。即使使用 PRISM 和 WPF/Silverlight，这也是要走的路。”

是的，但是如果您不能更改主项目（例如 Orchard CMS），您可以在项目中保留 WCF 服务配置。

您需要使用客户端生成方法创建服务助手：

```
public static class ServiceClientHelper
{
    public static T GetClient<T>(string moduleName) where T : IClientChannel
    {
        var channelType = typeof(T);
        var contractType = channelType.GetInterfaces().First(i => i.Namespace == channelType.Namespace);
        var contractAttribute = contractType.GetCustomAttributes(typeof(ServiceContractAttribute), false).First() as ServiceContractAttribute;

        if (contractAttribute == null)
            throw new Exception("contractAttribute not configured");

        //path to your lib app.config (mark as "Copy Always" in properties)
        var configPath = HostingEnvironment.MapPath(String.Format("~/Modules/{0}/bin/{0}.dll.config", moduleName)); 

        var configuration = ConfigurationManager.OpenMappedExeConfiguration(new ExeConfigurationFileMap { ExeConfigFilename = configPath }, ConfigurationUserLevel.None);
        var serviceModelSectionGroup = ServiceModelSectionGroup.GetSectionGroup(configuration);

        if (serviceModelSectionGroup == null)
            throw new Exception("serviceModelSectionGroup not configured");

        var endpoint = serviceModelSectionGroup.Client.Endpoints.OfType<ChannelEndpointElement>().First(e => e.Contract == contractAttribute.ConfigurationName);
        var channelFactory = new ConfigurationChannelFactory<T>(endpoint.Name, configuration, null);
        var client = channelFactory.CreateChannel();
        return client;
    }
} 
```

并使用它：

```
using (var client = ServiceClientHelper.GetClient<IDefaultNameServiceChannel>(yourLibName)) {
                ... get data from service ...
            } 
```

请参阅[本文](http://www.tikalk.com/net/keep-wcf-client-configuration-class-library-appconfig/)中的详细信息。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2009-10-15T18:57:48.327

这让我发疯了。

我正在将 Silverlight 3 Prism (CAB) 与 WCF 一起使用

当我在 Prism 模块中调用 WCF 服务时，我得到了同样的错误：

> 在服务模型客户端配置部分中找不到引用合同“IMyService”的默认端点元素。这可能是因为没有为您的应用程序找到配置文件，或者因为在客户端元素中找不到与此合同匹配的端点元素

事实证明，它在 Shell 的 .xap 文件中查找 ServiceReferences.ClientConfig 文件，而不是在模块的 ServiceReferences.ClientConfig 文件中。我在我的 Silverlight Shell 应用程序中添加了我的端点并绑定到现有的 ServiceReferences.ClientConfig 文件（它调用它自己的 WCF 服务）。

然后，我必须重新构建 Shell 应用程序来为我的 Web 项目的 ClientBin 文件夹生成新的 .xap 文件。

现在这行代码终于可以工作了：

```
MyServiceClient myService = new MyServiceClient(); 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2017-07-05T20:11:01.310

当您面临从类文件中引用服务的令人麻木的模糊错误时，这里的几个响应找到了正确的解决方案：将服务配置信息复制到控制台或 Windows 应用程序的 app.config web.config 中。这些答案似乎都没有告诉你要复制什么。让我们尝试纠正它。

这是我从类库的配置文件中复制到控制台应用程序的配置文件中的内容，以便为我编写的名为“TranslationServiceOutbound”的服务解决这个疯狂的错误。

您基本上想要**system.serviceModel**部分中的所有内容：

```
 <system.serviceModel>
<bindings>
  <basicHttpBinding>
    <binding name="BasicHttpBinding_ITranslationServiceOutbound" />
  </basicHttpBinding>
</bindings>
<client>
  <endpoint address="http://MyHostName/TranslationServiceOutbound/TranslationServiceOutbound.svc"
    binding="basicHttpBinding" bindingConfiguration="BasicHttpBinding_ITranslationServiceOutbound"
    contract="TranslationService.ITranslationServiceOutbound" name="BasicHttpBinding_ITranslationServiceOutbound" />
</client> 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2014-08-29T10:27:54.437

我在 ASP.NET 应用程序中收到此错误，其中 WCF 服务已添加到类库中，该类库作为 bin 文件夹中的引用 .dll 文件添加到 ASP.NET 应用程序中。要解决此错误，需要将引用 WCF 服务的类库中的 app.config 文件中的配置设置复制到 ASP.NET 站点/应用程序的 web.config 设置中。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2009-04-07T11:47:35.210

我遇到了同样的问题，但是更改合同命名空间对我不起作用。所以我尝试了 .Net 2 样式的 Web 参考而不是 .Net 3.5 服务参考。那行得通。

要在 Visual Studio 2008 中使用 Web 引用，请单击“添加服务引用”，然后在出现对话框时单击“高级”。在那里，您将找到一个选项，可以让您使用 Web 引用而不是服务引用。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2010-10-30T11:14:43.283

我发现（以及在使用类库接口时复制到客户端 UI 的 App.config）我必须在绑定的名称前面加上服务引用的名称（我的`ServiceReference`在下面）。

例如：

```
<endpoint address="http://localhost:4000/ServiceName" binding="basicHttpBinding"
      bindingConfiguration="BasicHttpBinding_ISchedulerService"
      contract="ServiceReference.ISchedulerService" 
      name="BasicHttpBinding_ISchedulerService" /> 
```

而不是默认生成的：

```
<endpoint address="http://localhost:4000/ServiceName" binding="basicHttpBinding"
      bindingConfiguration="BasicHttpBinding_ISchedulerService"
      contract="ISchedulerService" 
      name="BasicHttpBinding_ISchedulerService" /> 
```

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2012-02-14T23:31:27.137

对使用服务的非库应用程序进行单元测试可能会导致此问题。

其他人输入的信息解决了这个问题的根本原因。如果您正在尝试编写自动化测试用例并且您正在测试的单元实际上会调用服务接口，则需要将服务引用添加到测试项目中。这是使用库类型错误的应用程序的一种风格。我并没有立即意识到这一点，因为我使用接口*的代码不在库*中。但是，当测试实际运行时，它将从测试程序集运行，而不是从被测程序集运行。

向单元测试项目添加服务引用解决了我的问题。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2015-09-23T13:16:45.580

我有一个在单元测试中的情况。我将 app.config 文件复制到了单元测试项目中。所以单元测试项目也包含端点信息。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2012-09-22T12:25:58.383

我曾经遇到过这个问题。那是因为我还在开发使用 WCF 服务的接口。我配置了测试应用程序并继续开发。然后在开发中，我更改了一些服务的命名空间。所以我在 web.config 中仔细检查了“system.serviceModel -> 客户端 -> 端点 -> 合同”以匹配 WCF 类。然后问题就解决了。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-12-10T15:54:36.750

配置中的命名空间应该反映客户端默认命名空间（在项目属性中配置）之后的命名空间路径的其余部分。根据您发布的答案，我的猜测是您的客户端配置为位于“Fusion.DataExchange.Workflows”命名空间中。如果您将客户端代码移动到另一个命名空间，则需要更新配置以匹配剩余的命名空间路径。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2010-04-15T12:10:06.147

如果您在类库中调用服务并从另一个项目调用类库，则可能会出现此错误。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2010-06-14T13:16:52.973

我有同样的问题。我在类库中使用了 WCF 服务并从 windows 应用程序项目中调用类库。但是我忘记`<system.serviceModel>`了 windows 应用程序项目的配置文件中的更改`<system.serviceModel>`与类库的 app.Config 文件相同。
解决方案：更改外部项目的配置与类库的wcf配置相同。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2011-07-11T14:16:40.153

不要将服务客户端声明行作为类字段，而是在每个使用的方法处创建实例。因此问题将得到修复。如果您将服务客户端实例创建为类字段，则会发生设计时错误！

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2011-07-31T22:04:01.357

嗨，我遇到了同样的问题，但最好的解决方案是让 .NET 配置您的客户端配置。我发现当我使用查询字符串 http:/namespace/service.svc?wsdl=wsdl0 添加服务引用时，它不会在客户端创建配置端点。但是当我删除 ?wsdl-wsdl0 并且只使用 url http:/namespace/service.svc 时，它会在客户端配置文件中创建端点配置。简称“?WSDL=WSDL0”。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2012-08-29T20:49:34.297

如果您使用 PRISM 框架使用 WPF 应用程序，那么配置应该存在于您的启动项目中（即在您的引导程序所在的项目中。）

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2010-05-06T21:14:47.080

似乎有几种方法可以创建/解决此问题。对我来说，我使用的 CRM 产品是用本机代码编写的，并且能够调用我的 .NET dll，但我遇到了需要位于/高于主应用程序的配置信息。对我来说，CRM 应用程序不是 .NET，所以我最终不得不将它放在我的 machine.config 文件中（不是我想要的位置）。此外，由于我的公司使用 Websense，由于 407 Proxy Authentication Required 问题，我什至很难添加服务参考，这需要对 machine.cong 进行修改。

代理解决方案：

为了让 WCF 服务参考工作，我必须将信息从我的 DLL 的 app.config 复制到主应用程序配置（但对我来说是 machine.config）。而且我还必须将端点信息复制到同一个文件中。一旦我这样做了，它就开始为我工作了。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2010-07-08T09:37:44.417

行。我的情况有点不同，但最后我找到了解决方法：我有一个 Console.EXE -> DLL -> Invoking WS1 -> DLL -> Invoking WS2

我已经按照建议在 Console.EXE.config 中配置了 WS1 和 WS2 的服务模型配置。- 没有解决问题。

但它仍然不起作用，直到我将**WS2 的 WebReference 也添加到 WS1 中**，而不仅仅是添加到实际创建和调用 WS2 代理的 DLL 中。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2010-10-25T00:48:12.143

如果您在类库中引用 Web 服务，则必须将 app.config 复制到 Windows 应用程序或控制台应用程序

解决方案：更改外部项目的配置与类库的wcf配置相同。

为我工作

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2011-11-04T12:58:29.653

我在使用桌面应用程序和使用 Global Weather Web 服务时 遇到了同样的问题

我删除了服务参考并添加了网络参考并解决了问题谢谢

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2011-12-23T09:37:28.707

我的解决方案是从客户端 web.config 中的端点名称属性中删除端点名称，这允许代理使用

```
ChannelFactory<TService> _channelFactory = new ChannelFactory<TService>(""); 
```

只花了一整天的时间来锻炼。此外，一旦此修复到位，合同名称也是错误的，尽管在出现初始错误时它是错误的。双重然后三重检查合同名称字符串的人！属性：伊恩

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2014-05-13T20:06:15.440

请允许我再添加一件要查找的内容。（[汤姆黑格的](https://stackoverflow.com/a/6369334/1467396)回答已经暗示了这一点，但我想明确一点）

我的`web.config`文件定义了以下内容：

```
<protocolMapping>
    <add binding="basicHttpsBinding" scheme="https" />
</protocolMapping> 
```

我已经在使用 basicHttpsBinding 作为一个参考，但后来我添加了一个需要 basicHttpBinding（没有）的新参考。我所要做的就是将其添加到我`protocolMapping`的如下：

```
<protocolMapping>
    <add binding="basicHttpBinding" scheme="http" />
    <add binding="basicHttpsBinding" scheme="https" />
</protocolMapping> 
```

正如[LR](https://stackoverflow.com/a/2737593/1467396)正确指出的那样，这需要在正确的位置进行定义。对我来说，这意味着我的单元测试项目的 app.config 中的一个以及主服务项目的 web.config 中的一个。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2014-10-29T23:07:43.703

当我在没有全局范围运算符的配置文件元素中引用合同时，我遇到了这个错误。

IE

```
<endpoint contract="global::MyNamepsace.IMyContract" .../> 
```

有效，但是

```
<endpoint contract="MyNamepsace.IMyContract" .../> 
```

给出“找不到引用合同的默认端点元素”错误。

包含 MyNamepsace.IMyContract 的程序集与主应用程序位于不同的程序集中，因此这可以解释使用全局范围解析的需要。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2016-05-31T17:35:58.500

添加服务参考时

[![在此处输入图像描述](https://i.stack.imgur.com/PgxiW.png)](https://i.stack.imgur.com/PgxiW.png)

注意您输入的命名空间：

[![在此处输入图像描述](https://i.stack.imgur.com/rp0PV.png)](https://i.stack.imgur.com/rp0PV.png)

您应该将其附加到您的接口名称：

```
<client>
  <endpoint address="http://192.168.100.87:7001/soap/IMySOAPWebService"
            binding="basicHttpBinding" 
            contract="MyNamespace.IMySOAPWebService" />
</client> 
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2016-09-21T09:58:58.507

我遇到了同样的错误，我尝试了很多东西但没有奏效，然后我注意到我的“合同”在所有项目中都不相同，我更改了合同，因为解决方案中的所有项目都相同，并且它起作用了。这是项目A

```
<client>
    <endpoint address="https://xxxxxxxx" binding="basicHttpBinding" bindingConfiguration="basic" contract="ServiceReference.IIntegrationService" name="basic" />
</client> 
```

项目 B：

```
<client>
    <endpoint address="xxxxxxxxxxxxx" binding="basicHttpBinding" bindingConfiguration="basic" contract="ServiceReference1.IIntegrationService" name="basic" />
</client> 
```

最后，我将两者都更改为：

```
<client>
    <endpoint address="https://xxxxxxxxxxx" binding="basicHttpBinding" bindingConfiguration="basic" contract="MyServiceReferrence.IIntegrationService" name="basic" />
</client> 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2016-08-24T09:10:05.023

我遇到了同样的问题，只有当主机应用程序和使用该端点的 dll 具有相同的服务引用名称时才能解决。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2020-08-11T07:30:45.670

就我而言，我在启动项目和使用同名服务的项目中都添加了服务。有效...

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2020-03-06T16:41:50.483

就我而言，我已手动将 app.config 重命名为 [appname].exe.config。这最终为文件名添加了一个额外的 .config 后缀。解决方案是将其重命名为 [appname].exe 以消除额外的 .config 扩展名。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2021-04-29T07:12:00.020

还有另一种方法我找到了正确的`endpointConfigurationName`。

**添加`endpointConfigurationName`如下**

```
EservicesNew.ServiceClient eservicenew = new EservicesNew.ServiceClient("BasicHttpsBinding_IService"); 
```

**找到`endpointConfigurationName`如下**

添加 Web 参考后，从生成的参考文件中打开 configuration.svcinfo 文件。

[![在此处输入图像描述](https://i.stack.imgur.com/Je8yh.png)](https://i.stack.imgur.com/Je8yh.png)

找到了两个端点，我使用了正确的端点`bindingConfiguration`值，即 `BasicHttpsBinding_IService`

[![在此处输入图像描述](https://i.stack.imgur.com/YY9XL.png)](https://i.stack.imgur.com/YY9XL.png)

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2018-04-10T09:31:00.407

就我而言，我指的是图书馆项目中的这项服务，而不是启动项目。一旦我将部分复制`<system.serviceModel>`到主启动项目的配置中，问题就解决了。

在任何应用程序的运行阶段，配置将从启动/父项目中读取，而不是读取单独的子项目中提到的自己的配置。

# asp.net - 实体框架、编译查询和 IIS

> ID：352658
> 
> 赞同：2
> 
> 时间：2008-12-09T13:09:13.700
> 
> 标签：asp.net, iis, entity-framework

我在我的网站上使用实体框架。为了提高性能，我已经开始尽可能使用编译查询，直接使用 CompiledQuery.Compile 或使用 ESQL。

现在的性能非常棒，就是这样，一旦查询被编译。显然，在某些页面上编译它们需要相当多的时间，所以第一次点击总是很糟糕。

这不应该是一个问题，因为一旦它被编译它应该是好的，只要网站启动并运行。然而，在现实中，情况并非如此。在页面上一段时间不活动之后，感觉好像查询被重新编译（当我再次访问它时）。

有可能的？IIS (v6) 是否清除已编译查询的缓存？我可以阻止它这样做吗？我真的可以确认这是问题的原因吗？

谢谢，广告

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-12T20:51:56.593

我认为当您的应用程序池由于不活动而被破坏时，它们会重新编译。您可以使用 IIS 6.0 的 MMC 控制台调整应用程序池。

指南在[这里](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/2a231dcb-d786-4b6d-b3ba-bda04061a5e7.mspx?mfr=true)

# python - 带和不带放回的加权随机选择

> ID：352670
> 
> 赞同：51
> 
> 时间：2008-12-09T13:15:00.833
> 
> 标签：python, algorithm, random, random-sample

最近我需要对列表中的元素进行加权随机选择，包括替换和不替换。虽然有一些众所周知且很好的非加权选择算法，还有一些用于不带替换的加权选择（例如对 resevoir 算法的修改），但我找不到任何好的带替换加权选择算法。我还想避免使用 resevoir 方法，因为我选择了列表的很大一部分，它小到足以保存在内存中。

有没有人对这种情况下的最佳方法有任何建议？我有自己的解决方案，但我希望找到更有效、更简单或两者兼而有之的方法。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-09T17:27:01.697

使用不变列表中的替换样本制作多个样本的最快方法之一是别名方法。核心直觉是，我们可以为加权列表创建一组大小相等的 bin，可以通过位操作非常有效地对其进行索引，以避免二分查找。事实证明，如果操作正确，我们将只需要从每个 bin 的原始列表中存储两个项目，因此可以用单个百分比表示拆分。

让我们以五个等权重的选择为例，`(a:1, b:1, c:1, d:1, e:1)`

要创建别名查找：

1.  将权重归一化，使其总和为`1.0`。 `(a:0.2 b:0.2 c:0.2 d:0.2 e:0.2)` 这是选择每个权重的概率。

2.  找到大于或等于变量个数的 2 的最小幂，并创建此分区数，`|p|`。每个分区代表一个概率质量`1/|p|`。在这种情况下，我们创建`8`分区，每个分区都可以包含`0.125`.

3.  取出剩余重量最少的变量，并将尽可能多的质量放在空分区中。在此示例中，我们看到`a`填充了第一个分区。 `(p1{a|null,1.0},p2,p3,p4,p5,p6,p7,p8)`和`(a:0.075, b:0.2 c:0.2 d:0.2 e:0.2)`

4.  如果分区未填充，则取权重最大的变量，并用该变量填充分区。

重复步骤 3 和 4，直到不需要将来自原始分区的权重分配给列表。

例如，如果我们运行 3 和 4 的另一个迭代，我们会看到

`(p1{a|null,1.0},p2{a|b,0.6},p3,p4,p5,p6,p7,p8)``(a:0, b:0.15 c:0.2 d:0.2 e:0.2)`有待分配

在运行时：

1.  获取一个`U(0,1)`随机数，比如二进制`0.001100000`

2.  移位它`lg2(p)`，找到索引分区。因此，我们将它移动`3`，产生`001.1`或位置 1，从而划分 2。

3.  如果分区被拆分，则使用移位后的随机数的小数部分来决定拆分。在这种情况下，值为`0.5`, 并且`0.5 < 0.6`, 所以 return `a`。

[这是一些代码和另一种解释](http://prxq.wordpress.com/2006/04/17/the-alias-method/)，但不幸的是它没有使用位移技术，我也没有实际验证它。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2013-12-12T16:30:12.717

此处未提及的一种简单方法是[Efraimidis 和 Spirakis](http://www.sciencedirect.com/science/article/pii/S002001900500298X)中提出的一种。在 python 中，您可以从 n >= m 加权项目中选择 m 个项目，并将严格正的权重存储在权重中，返回选定的索引，其中：

```
import heapq
import math
import random

def WeightedSelectionWithoutReplacement(weights, m):
    elt = [(math.log(random.random()) / weights[i], i) for i in range(len(weights))]
    return [x[1] for x in heapq.nlargest(m, elt)] 
```

这在结构上与 Nick Johnson 提出的第一种方法非常相似。不幸的是，这种方法在选择元素方面存在偏见（请参阅该方法的评论）。Efraimidis 和 Spirakis 在链接的论文中证明了他们的方法等同于无替换的随机抽样。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-09T17:06:26.310

这是我提出的无需替换的加权选择：

```
def WeightedSelectionWithoutReplacement(l, n):
  """Selects without replacement n random elements from a list of (weight, item) tuples."""
  l = sorted((random.random() * x[0], x[1]) for x in l)
  return l[-n:] 
```

这是列表中要从中选择的项目数的 O(m log m)。我相当肯定这将正确地衡量物品，尽管我还没有在任何正式意义上验证它。

这是我提出的带替换加权选择的方法：

```
def WeightedSelectionWithReplacement(l, n):
  """Selects with replacement n random elements from a list of (weight, item) tuples."""
  cuml = []
  total_weight = 0.0
  for weight, item in l:
    total_weight += weight
    cuml.append((total_weight, item))
  return [cuml[bisect.bisect(cuml, random.random()*total_weight)] for x in range(n)] 
```

这是 O(m + n log m)，其中 m 是输入列表中的项目数，n 是要选择的项目数。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-09T13:43:46.000

我建议您首先查看 Donald Knuth 的[Seminumerical Algorithms](https://rads.stackoverflow.com/amzn/click/com/0201896842)的第 3.4.2 节。

如果您的数组很大，在John Dagpunar的[《随机变量生成原理》](https://rads.stackoverflow.com/amzn/click/com/0198522029)第 3 章中有更有效的算法。如果您的数组不是特别大，或者您不关心尽可能多地提高效率，那么 Knuth 中更简单的算法可能就可以了。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-03-22T17:07:26.813

以下是对集合（或多集合，如果允许重复）的元素的随机加权选择的描述，无论是否在 O(n) 空间和 O(log n) 时间中进行替换。

它包括实现一个二叉搜索树，按要选择的元素排序，其中树的每个*节点*包含：

1.  元素本身（*元素*）
2.  元素的非标准化权重（*elementweight*），以及
3.  左子节点及其所有子节点的所有未归一化权重的总和（*leftbranchweight*）。
4.  右子节点及其所有子节点的所有未归一化权重的总和（*rightbranchweight*）。

然后我们从 BST 中随机选择一个元素，沿着树向下下降。下面是对该算法的粗略描述。该算法给出了树的一个*节点*。然后将*节点的**leftbranchweight*、*rightbranchweight*和*elementweight*的值相加，然后将权重除以该和，分别得到*leftbranchprobability*、 *rightbranchprobability*和*elementprobability*的值。然后得到一个介于 0 和 1 之间的随机数（*randomnumber*）。

 ****   如果数字小于*elementprobability*，
    *   照常从 BST 中删除元素，更新所有必要节点的*leftbranchweight* 和*rightbranchweight*，并返回元素。
*   否则，如果数字小于（*elementprobability* + *leftbranchweight*）
    *   在*leftchild上递归（使用**leftchild*作为*节点*运行算法）
*   别的
    *   递归*右孩子*

当我们最终使用这些权重找到要返回的元素时，我们要么简单地返回它（带替换），要么删除它并更新树中的相关权重（不带替换）。

免责声明：该算法是粗糙的，这里没有尝试关于正确实现 BST 的论文；相反，希望这个答案能帮助那些*真正*需要快速加权选择而不需要替换的人（就像我一样）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-04-18T20:07:58.990

在 O(N) 时间内首先创建一个额外的 O(N) 大小的数据结构之后，可以在 O(1) 时间内进行加权随机选择和替换。该算法基于Walker 和 Vose 开发的[Alias Method ，](http://en.wikipedia.org/wiki/Alias_method)[此处](http://www.keithschwarz.com/darts-dice-coins/)对此进行了很好的描述。

基本思想是直方图中的每个 bin 将由统一的 RNG 以 1/N 的概率选择。因此，我们将遍历它，对于任何会收到过多命中的人口不足的 bin，将多余的 bin 分配给人口过多的 bin。对于每个 bin，我们存储属于它的命中百分比，以及超出部分的合作伙伴 bin。这个版本跟踪大小的箱子，无需额外的堆栈。它使用合作伙伴的索引（存储在 中`bucket[1]`）作为他们已经被处理的指标。

这是一个最小的python实现，基于[这里的C实现](https://gist.github.com/ashelly/cc0cd6916235a04df49a)

```
def prep(weights):
    data_sz = len(weights)
    factor = data_sz/float(sum(weights))
    data = [[w*factor, i] for i,w in enumerate(weights)]
    big=0
    while big<data_sz and data[big][0]<=1.0: big+=1
    for small,bucket in enumerate(data):
        if bucket[1] is not small: continue
        excess = 1.0 - bucket[0]
        while excess > 0:
            if big==data_sz: break
            bucket[1] = big
            bucket = data[big]
            bucket[0] -= excess
            excess = 1.0 - bucket[0]
            if (excess >= 0):
                big+=1
                while big<data_sz and data[big][0]<=1: big+=1
    return data

def sample(data):
    r=random.random()*len(data)
    idx = int(r)
    return data[idx][1] if r-idx > data[idx][0] else idx 
```

示例用法：

```
TRIALS=1000
weights = [20,1.5,9.8,10,15,10,15.5,10,8,.2];
samples = [0]*len(weights)
data = prep(weights)

for _ in range(int(sum(weights)*TRIALS)):
    samples[sample(data)]+=1

result = [float(s)/TRIALS for s in samples]
err = [a-b for a,b in zip(result,weights)]
print(result)
print([round(e,5) for e in err])
print(sum([e*e for e in err])) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-03-09T19:34:23.203

这是一个老问题，numpy 现在提供了一个简单的解决方案，所以我想我会提到它。numpy 的当前版本是 1.2 版，`numpy.random.choice`允许在有或没有替换的情况下以及给定的权重下进行采样。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-10-16T15:07:49.500

假设您想用概率从列表 ['white','blue','black','yellow','green'] 中采样 3 个元素而不进行替换。分布 [0.1, 0.2, 0.4, 0.1, 0.2]。使用 numpy.random 模块就像这样简单：

```
 import numpy.random as rnd

    sampling_size = 3
    domain = ['white','blue','black','yellow','green']
    probs = [.1, .2, .4, .1, .2]
    sample = rnd.choice(domain, size=sampling_size, replace=False, p=probs)
    # in short: rnd.choice(domain, sampling_size, False, probs)
    print(sample)
    # Possible output: ['white' 'black' 'blue'] 
```

将`replace`标志设置为`True`，您将获得一个带替换的采样。

更多信息在这里： [http ://docs.scipy.org/doc/numpy/reference/generated/numpy.random.choice.html#numpy.random.choice](http://docs.scipy.org/doc/numpy/reference/generated/numpy.random.choice.html#numpy.random.choice)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-08-12T18:23:38.567

我们面临一个问题，即每个 epoch 按比例随机选择候选人`K`的验证者一次。`N`但这给我们带来了以下问题：

想象一下每个候选人的概率：

```
0.1
0.1
0.8 
```

**在 1'000'000 次无替换**`2`选择后，每个候选人的概率变为：`3`

 **```
0.254315
0.256755
0.488930 
```

你应该知道，那些原始的概率是无法实现不替换`2`的选择的。`3`

但我们希望初始概率是利润分配概率。否则，它会使小型候选人池更有利可图。所以我们意识到随机选择**和替换**将帮助我们——随机选择并存储每个验证者的权重以进行奖励分配`>K`：`N`

```
std::vector<int> validators;
std::vector<int> weights(n);
int totalWeights = 0;

for (int j = 0; validators.size() < m; j++) {
    int value = rand() % likehoodsSum;
    for (int i = 0; i < n; i++) {
        if (value < likehoods[i]) {
            if (weights[i] == 0) {
                validators.push_back(i);
            }
            weights[i]++;
            totalWeights++;
            break;
        }

        value -= likehoods[i];
    }
} 
```

它在数百万个样本上给出了几乎原始的奖励分布：

```
0.101230
0.099113
0.799657 
```

# java - 通过 SQL 更新单个记录并获取已更新记录的 id 的最佳方法是什么？(Java/MSSQL)

> ID：352673
> 
> 赞同：0
> 
> 时间：2008-12-09T13:17:21.857
> 
> 标签：java, sql-server

我知道我可以像这样更新单个记录 - 但是如何访问已更新记录的 ID？（我正在使用 MSSQL，所以我不能使用 Oracles RowId）

```
update myTable
set myCol = 'foo'
where itemId in (select top 1 itemId from myTable ) 
```

如果我正在执行插入，我可以使用 getGeneratedKeys 来获取 id 字段值，但我认为没有等效的更新？

我知道我可以使用可滚动的结果集来做我想做的事

IE

```
stmt = conn.prepareStatement("select top 1 myCol, itemId from myTable", ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_UPDATABLE);
ResultSet resultSet = stmt.executeQuery();
if(resultSet.first()){
    resultSet.updateString(1, "foo");
    resultSet.updateRow();
    String theItemId = resultSet.getString(1)
}
resultSet.close(); 
```

但我担心性能，因为测试显示负载下的锁定超时，我想知道是否有更好/更简单的方法？

-- 编辑：只是为了最终确定这个问题......当我们迁移到 MSSQL2005 时，我们将升级我们的代码以使用 Rich 的答案。在当前版本中，我们使用了锁提示：(UPDLOCK ROWLOCK READPAST) 来缓解原始代码显示的性能问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T13:44:41.630

此示例在 MSSQL 2005 中运行良好...

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

DROP TABLE [dbo].[TEST_TABLE]
GO

CREATE TABLE [dbo].[TEST_TABLE](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [name] [nvarchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
 CONSTRAINT [PK_TEST_TABLE] PRIMARY KEY CLUSTERED 
(
    [id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

-- An insert which will return the identity
INSERT INTO [dbo].[TEST_TABLE] ([name]) 
OUTPUT inserted.id
VALUES('Test 1')

-- Another insert which will return the identity
INSERT INTO [dbo].[TEST_TABLE] ([name]) 
OUTPUT inserted.id
VALUES('Test 2')

-- Now an update which will return the identity
UPDATE [dbo].[TEST_TABLE]
SET [name] = 'Updated Test 1'
OUTPUT inserted.id
WHERE [name] = 'Test 1'

SELECT id, [name] FROM [dbo].[TEST_TABLE] 
```

更具体地说，您的查询...

```
update myTable
set myCol = 'foo'
output inserted.itemid
where itemId in (select top 1 itemId from myTable ) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T13:55:07.757

我会做以下事情：

```
Begin Tran

update myTable
set myCol = 'foo'
where itemId in (select top 1 itemId from myTable )

select top 1 itemId from myTable

Commit Tran 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T14:05:49.107

这必须在一个声明中吗？最终这将是最好的存储过程

```
Create Procedure doMyUpdate

 @Id int output

as

Set @Id = (select top 1 itemId from myTable)
update myTable
set myCol = 'foo'
where itemId = @Id 
```

另一种方法是使用 th RETURN 关键字和内置的 RETURN_VALUE 参数...

```
Create Procedure doMyUpdate

as

Declare @Id int
Set @Id = (select top 1 itemId from myTable)

update myTable
set myCol = 'foo'
where itemId = @Id

RETURN @Id 
```

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2008-12-09T13:51:54.207

对于插入 MSQSQL 服务器有一个参数，该`@@Identity`参数具有最后插入记录的 ID。

# c# - 创建带有一组前缀的 GUID

> ID：352674
> 
> 赞同：3
> 
> 时间：2008-12-09T13:18:01.497
> 
> 标签：c#, guid

我想知道是否有一种方法可以生成有效的 GUID/UUID，其中第一个（或任何部分）部分是用户选择的前缀。

即，GUID 的格式为 AAAAAAAAA-BBBB-CCCC-DDDD-DDDDDDDDDDDD，我想将任何部分设置为预定义的值（最好是 AAA）。目标是让 GUID 仍然是全球唯一的，但它们不需要是加密安全的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T14:35:45.567

抱歉，您对 GUID 的要求太多了。从您的问题和您自己的答案/更新中总结，您希望它

*   1 是一个 GUID
*   2 不与任何其他 GUID 冲突（全局唯一）
*   3 忽略关于第一位解释的标准，使用保留值
*   4 对剩余位使用个人方案

这是不可能的，证明：如果可能的话，我可以生成一个 GUID G1，而您可以生成另一个 GUID G2。由于我们都忽略了标准并使用相同的保留前缀，而且我对其他位的个人方案超出了您的控制范围，因此我的 GUID G1 可能与您的 GUID G2 发生冲突。GUID 的非冲突属性遵循 GUID 标准。

防止冲突的机制本质上是对隐私敏感的。如果我随机生成一个 GUID G1，如果满足两个条件，我可以保证随机 GUID 是唯一的：

*   1 它是我控制下的 GUID 子集的成员，并且
*   2 我之前没有生成 GUID。

对于您控制的子集之外的 GUID，您不能保证 (2)。但是如何将不重叠的 GUID 子集分配给一个人呢？使用网卡的 MAC 是一种简单有效的方法。其他方式也是可能的。但无论如何，仅仅存在这样一个子集就涉及隐私。它必须属于某个人，我必须能够确定那是我还是其他人。证明两个随机 GUID G1 和 G2 是否属于同一子集（即人）有点困难，但当前方案（您反对）并没有试图隐藏这一点。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-09T14:41:57.583

嗯...所以，您基本上想要一个 12 字节的 GUID？因为，一旦你删除了前 4 个字节（你的 AAA）的唯一性，你就[破坏了现有的算法](http://blogs.msdn.com/oldnewthing/archive/2008/06/27/8659071.aspx)——你需要想出自己的算法。

根据相关[RFC](http://www.faqs.org/rfcs/rfc4122.html)，GUID 格式分解为：

```
 UUID                   = time-low "-" time-mid "-"
                           time-high-and-version "-"
                           clock-seq-and-reserved
                           clock-seq-low "-" node
  time-low               = 4hexOctet
  time-mid               = 2hexOctet
  time-high-and-version  = 2hexOctet
  clock-seq-and-reserved = hexOctet
  clock-seq-low          = hexOctet
  node                   = 6hexOctet
  hexOctet               = hexDigit hexDigit
  hexDigit =
        "0" / "1" / "2" / "3" / "4" / "5" / "6" / "7" / "8" / "9" /
        "a" / "b" / "c" / "d" / "e" / "f" /
        "A" / "B" / "C" / "D" / "E" / "F" 
```

唯一的静态数据是版本（4 位）和保留/变体（2-3 位）。我没有看到他们允许任何“用户指定”的版本，但我想说如果您使用 1111 作为您的版本标识符，那么在可预见的未来您将是安全的。现有版本在第 4.1.3 节中，但到目前为止只定义了 5 个……在碰撞之前为您提供了 11 个更多的修订。

因此，如果您可以忍受 6 或 7 位的区别，那么[Guid.NewGuid().ToByteArray()](http://msdn.microsoft.com/en-us/library/system.guid.tobytearray.aspx)的组合和在您的位摆弄之后创建一个[新的 Guid应该可以让您到达那里。](http://msdn.microsoft.com/en-us/library/system.guid.guid.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T13:24:02.280

无法创建第一个（或任何部分）部分是用户选择的前缀的 GUID/UUID，而您可以编写自己的函数来创建具有相同数量（36/38）字符的唯一 ID...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T14:01:50.723

您可以简单地创建一个 Guid，并将前缀更改为您希望的样子。在 OS-Project 中看到了这一点，通过生成如此多的 guid 直到一个匹配所需的前缀（啊！），抛出并解决了同样的问题。

`Guid g = Guid.NewGuid(); string gs = g.ToString(); Guid f = new Guid(string.Format("{0}-{1}", "AAAAAAAA", gs.Substring(gs.IndexOf('-') + 1)));`

不好，但有效。

这个主题的其他帖子让我感到困扰的是，一个 guid 应该是全局唯一的，这在所有情况下都是错误的，它有足够的空间来生成唯一的 guid，但不能保证全局唯一。在生成指南时甚至不考虑时间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-09T18:33:35.880

我最近也有类似的需求——我需要一个 GUID：

*   由标准 guid 算法创建，因此有机会成为全球唯一
*   有一个定义的前缀。

正如你可能想象的那样，我正在做我不应该做的事情。

您在其中一条评论中提到，您可以让 GUID 生成器运行，直到它碰巧遇到带有您需要的前缀的 guid。这就是我采取的策略。这是代码：

```
using System;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            string target_prefix = "dead";

            while (true)
            {
                Guid g = Guid.NewGuid();
                string gs = g.ToString();
                if (gs.Substring(0, target_prefix.Length) == target_prefix)
                {
                    Console.WriteLine("Match: " + gs);
                }
                else
                {
                    //Console.WriteLine("Mismatch: " + gs);
                }
            }
        }
    }
} 
```

对于较小的前缀，它会更快地产生匹配。我敢打赌，目标前缀的每个数字都是 16 倍。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T14:17:45.433

谢谢。[正如Raymond Chen](http://blogs.msdn.com/oldnewthing/archive/2008/06/27/8659071.aspx)所指出的，我对这些尝试的问题是它们不能保证是全球唯一的。我想知道是否有另一种算法可以生成唯一的 GUID。我记得曾经有使用时间戳和/或 NIC MAC 地址的实现，但它们不再使用，因为它们不是加密强和/或存在隐私问题。

我想知道：如果我自己编，我应该没问题吗？根据[维基百科](http://en.wikipedia.org/wiki/GUID)：

> 数据 4 中第二个字节的一到三个最高有效位定义了 GUID 的类型变体：
> 
> 模式描述
> 0 网络计算系统向后兼容
> 10 标准
> 110 微软组件对象模型向后兼容；这包括 IUnknown 和 IDispatch 等重要接口的 GUID。
> 111 保留供将来使用。
> 
> Data3 的最高有效四位定义版本号和使用的算法。

因此，如果我在 Data3/Data4 中编造一些东西，我通常会创建自己的实现，该实现不应与任何其他 GUID 冲突，但当然总是存在一些与之相关的风险，所以在我这样做之前，我想检查一下如果有一个旧的/不再使用的算法可以生成真正的唯一 ID。

# iphone - 如何连接 iPhone 和 Web 服务并获取 XML 数据？

> ID：352676
> 
> 赞同：27
> 
> 时间：2008-12-09T13:18:12.447
> 
> 标签：iphone, objective-c, web-services, cocoa-touch

我知道如何使用 iPhone 连接到 Web 服务器，但现在我必须将 iPhone 连接到 Web 服务。我不知道该怎么做，也没有在线演示或课程。

有没有人有任何想法？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-09T13:54:08.240

您可能会发现这个名为 Intro to [SOAP Web Services](http://icodeblog.com/2008/11/03/iphone-programming-tutorial-intro-to-soap-web-services/)的教程很有用。他展示了如何打包请求、将其发送到 Web 服务并读取响应。

如果您需要一些有关 XML 解析的帮助，[TouchXML](http://code.google.com/p/touchcode/wiki/TouchXML)库将为您提供一个不错的 xml“文档”。请注意内存使用情况。

如果您必须解析大型 XML 消息，本[教程关于 Cocoa 中的 libxml 和 xmlreader](http://www.cimgf.com/2008/08/18/cocoa-tutorial-libxml-and-xmlreader/)将向您展示如何使用较低级别的事件样式解析器解析 XML。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2010-03-17T18:23:52.463

我为 iPhone OS 3.0 创建了一个开源应用程序，展示了如何在 iPhone 应用程序中使用 REST 和 SOAP 服务，使用 XML（使用 8 个不同的 iPhone 库）、SOAP、JSON（使用 SBJSON 和 TouchJSON）、YAML、协议缓冲区（ Google 序列化格式），甚至是来自 PHP 示例应用程序（包含在项目中）的 CSV。

[http://github.com/akosma/iPhoneWebServicesClient](http://github.com/akosma/iPhoneWebServicesClient)

该项目的模块化程度足以在未来支持许多其他格式和库。

SlideShare 中的以下演示文稿展示了我在性能、易于实施和有效负载特征方面的发现：

[http://www.slideshare.net/akosma/web-services-3439269](http://www.slideshare.net/akosma/web-services-3439269)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-09T13:49:14.820

您可以使用这两行来返回您的 HTTP 请求的响应。您不需要任何配置。例如，如果您尝试访问 PHP 脚本，则此代码很有用。在你只需要解析你的结果之后。

```
NSURL *URL=[[NSURL alloc] initWithString:stringForURL];
NSString *results = [[NSString alloc] initWithContentsOfURL :URL]; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-09T13:30:18.430

在我看来，你有两个选择：

*   使用第三方库。您可以尝试[wsdl2objc](http://code.google.com/p/wsdl2objc/)。它对我不起作用，但它正在积极开发中，所以它每天都在改进。
*   使用原始 HTTP 连接并处理每个请求/响应。这是我遵循的方式。这很难，所以我也想知道更好的方法。

# asp.net - 本地主机的 URI 无效

> ID：352684
> 
> 赞同：1
> 
> 时间：2008-12-09T13:20:46.903
> 
> 标签：asp.net

我们有一个网站/网络服务在我们的一台服务器上运行。我们每天使用预定的 .bat scipt 访问该网络服务一次。

就在最近，计划任务开始失败。日志显示“无效的 URI：无法解析主机名。”

当我们登录到服务器时，我们可以通过[http://localhost/website 访问](http://localhost/website)该网站，但是当我们点击 web服务[http://localhost/website/ws.asmx](http://localhost/website/ws.asmx)时会出现 Invalid URI 错误。

有任何想法吗？

**编辑**：

我们尝试使用服务器名、IP 地址和端口号（以及其中的组合）。还有其他想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2015-05-03T17:08:29.730

对于私有 IP 地址，您使用维基百科参考 [http://en.wikipedia.org/wiki/IP_address](http://en.wikipedia.org/wiki/IP_address)有哪些限制和正确用途。

如果您有权访问 Web 服务的源代码，请查找正在使用的固定 IP 地址以及使用该服务的正确服务器绑定。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T18:04:29.603

尝试使用机器名而不是 localhost

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T13:31:44.417

尝试使用机器的 IP 地址而不是 localhost。

基本上，我正在疯狂地抨击某人运行了锁定或安装了一个服务补丁，该补丁以某种方式过滤了对 localhost (127.0.0.1) 的请求响应。

# git - 如何将 git-svn 分支恢复为 SVN HEAD？

> ID：352692
> 
> 赞同：5
> 
> 时间：2008-12-09T13:25:10.733
> 
> 标签：git, git-svn

我有一个本地 git 存储库，它通过`git svn`. 我已经在本地 git 存储库中进行并提交了一些更改，但现在我想创建一个反映 SVN HEAD 的分支，以便对 SVN 中的代码进行一些更改，因为我不想传播我的 git master 到 SVN 的变化还没有。我该怎么办？

立即跟进：我需要对 SVN HEAD 进行更改并提交，然后将它们合并回我的 git master。我该怎么做？我`git merge`是 'svn-edits' 分支到 master，还是做一个`git svn rebase`？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T13:48:32.823

我将假设您正在处理的分支是`trunk`（我称之为`old-trunk`）的分支。只需从那里创建一个新分支

```
git checkout -b real-trunk remotes/trunk 
```

现在进行更改`real-trunk`并从那里提交。之后，只需将旧分支重新建立在新分支上。

```
git svn dcommit
git checkout old-trunk
git rebase real-trunk 
```

现在，您之前的更改是基于您刚刚所做的更新的更改。

# java - 静态概念

> ID：352693
> 
> 赞同：1
> 
> 时间：2008-12-09T13:25:52.683
> 
> 标签：java, static

```
class Trial 
{   static int i; 
    int getI() 
    {       return i;} 
    void setI(int value) 
    {       i = value;} 
} 
public class ttest 
{  public static void main(String args[]) 
   {    Trial t1 = new Trial(); 
        t1.setI(10); 
        System.out.println(t1.getI()); 
        Trial t2 = new Trial(); 
        t2.setI(100); 
        System.out.println(t1.getI()); 
        System.out.println(t2.getI()); 
   } 
} 
```

这里 trial 是一个非静态类， i 是一个静态变量。如何从静态主要方法访问它。这种方式正确吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T13:30:35.963

是的，这是正确的方法。

当一个类不是静态的时，您需要使用 new 关键字对其进行实例化。就像你做的那样

```
Trial t1 = new Trial(); 
```

如果您不想在所有 Trial 对象之间共享其值，则静态变量 i 不应该是静态的。如果您想使用此值（在“共享模式”中），您可以按照您的方式进行操作。如果你把这个变量公开，你可以简单地做 Trial.i = "your value"...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T13:31:37.303

本质上，是的，但是如果您将访问器声明为 public static，那么您应该能够通过类名访问它们，即 Trial.getI();

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T13:47:25.523

您可能希望将 setter 和 getter 设为静态，因为它们访问静态变量。如果您看不到源代码，如果您将它们保留为非静态的，则可能会让该类的用户感到非常困惑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T14:54:04.547

你真的想要一个静态成员变量吗？如上所述，静态变量在所有实例之间共享，因此 t2.setI(x) 也意味着 t1.getI() == x。

如果您将 setter 和 getter 声明为静态，则可以通过类而不是实例来访问它们。试用.setI(x)。现在任何人都清楚 x 在所有实例之间共享。

但我似乎你真正需要的是一个非静态变量。

```
class Trial {   
    private int i; 
    int getI() { return i;} 
    void setI(int value) {i = value;} 
} 
```

运行主方法时，输出将为 10 10 100

与使用静态变量相比，它会打印 10 100 100

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T14:31:09.977

其他人已经提到 get 和 set 方法应该是静态的，因为它们指的是静态变量。

此外， java中没有**静态类之类的东西。**您还应该将该静态变量设为私有。所以从这个意义上说，我反对@Daok 将其公开的建议。

作为一个例子，这是可行的，但是如果您描述实际用例，则可能会发现一些设计错误。

# asp.net-mvc - 将 URL 作为获取参数传递？

> ID：352694
> 
> 赞同：6
> 
> 时间：2008-12-09T13:25:58.377
> 
> 标签：asp.net-mvc

我正在尝试将您的 url 作为参数传递给 get 方法。我定义了一个接受 {*url} 参数的路由，因此我可以发送“/”字符而不用分隔我的参数。只要 url 中有一个“:”（例如在 http: 或 localhost:3857 中），该方法就永远不会被命中。

Html.ActionLink 方法转义了它的参数本身，但它似乎没有转义'：'。我无法手动转义它，因为转义字符会被相同的 Html.Actionlink 方法转义。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T13:33:37.270

在传递之前使用EncodeUrl，然后在另一端对其进行解码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-01T18:59:46.117

我遇到了同样的问题。我最终删除了 Html.ActionLink 并将其替换为：

```
<a href="Movies?id=@item.ID">@item.Title</a> 
```

@item.ID 是从 netflix api 返回的 url，例如[http://api.netflix.com/catalog/titles/series/70021357/seasons/70021357](http://api.netflix.com/catalog/titles/series/70021357/seasons/70021357)。现在我的网址看起来像这样 - /Home/Movies?id=http://api.netflix.com/catalog/titles/series/70021357/seasons/70021357，我只是使用 Request.QueryString 来获取控制器中的值：

```
Request.QueryString.Get("id") 
```

可能不理想，但它现在有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-26T03:17:12.633

这有点小技巧，但您可以将 ':' 替换为 '%3A' （这是转义形式），然后看看 ActionLink 用它做了什么。如果再次转义，则必须在服务器上将两次转义的版本替换回“：”，否则只需将“％3A”替换回“：”

# multithreading - 运行多线程 nunit 测试的最佳方法

> ID：352695
> 
> 赞同：3
> 
> 时间：2008-12-09T13:27:46.780
> 
> 标签：multithreading, unit-testing, nunit

我目前正在尝试找到一个解决方案，如果测试方法产生的线程中发生异常，如何确保测试失败。

我不想在单元测试中开始讨论多个线程。=> "单元测试".Replace("unit","integration");

我已经在几个论坛中阅读了很多帖子，我知道[CrossThreadTestRunner](http://www.peterprovost.org/blog/post/NUnit-and-Multithreaded-Tests-CrossThreadTestRunner.aspx "CrossThreadTestRunner")，但我正在寻找一个集成到 nunit 中的解决方案，并且不需要重写很多测试。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-07-23T15:50:47.060

非测试线程（即其他衍生线程）上的异常不会导致测试失败的原因是 NUnit 默认配置为使用[legacyUnhandledExceptionPolicy](http://msdn.microsoft.com/en-us/library/ms228965.aspx)，这是一个可以通过 app.config 应用的 .Net 进程级别设置，即：

```
<legacyUnhandledExceptionPolicy enabled="1"/> 
```

启用此设置（即设置为“1”）会导致主线程上未发生的异常被*忽略*。

我写了一篇文章，详细介绍了 ReSharper 测试运行器的这个问题，但它同样适用于 NUnit 测试运行器：

[http://gojisoft.com/blog/2010/05/14/resharper-test-runner-hidden-thread-exceptions/](http://gojisoft.com/blog/2010/05/14/resharper-test-runner-hidden-thread-exceptions/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-08-19T22:13:02.473

我刚刚遇到了同样的问题，我的解决方案是捕获异常并增加一个异常计数器，因此 Test 方法只需断言异常计数器为 0 即可确认没有线程出现异常。

删除特定环境内容后，我的测试代码的摘录：

```
 const int MaxThreads = 25;
    const int MaxWait = 10;
    const int Iterations = 10;
    private readonly Random random=new Random();
    private static int startedThreads=MaxThreads ;
    private static int exceptions = 0; 
```

…</p>

```
[Test]
    public void testclass()
    {
        // Create n threads, each of them will be reading configuration while another one cleans up

        Thread thread = new Thread(Method1)
        {
            IsBackground = true,
            Name = "MyThread0"
        };

        thread.Start();
        for (int i = 1; i < MaxThreads; i++)
        {
            thread = new Thread(Method2)
            {
                IsBackground = true,
                Name = string.Format("MyThread{0}", i)
            };

            thread.Start();
        }

        // wait for all of them to finish
        while (startedThreads > 0 && exceptions==0)
        {
            Thread.Sleep(MaxWait);
        }
        Assert.AreEqual(0, exceptions, "Expected no exceptions on threads");
    }

    private void Method1()
    {
        try
        {
            for (int i = 0; i < Iterations; i++)
            {
            // Stuff being tested
                Thread.Sleep(random.Next(MaxWait));
            }
        }
        catch (Exception exception)
        {
            Console.Out.WriteLine("Ërror in Method1 Thread {0}", exception);
            exceptions++;
        }
        finally
        {
            startedThreads--;
        }
    }

    private void Method2()
    {
        try
        {
            for (int i = 0; i < Iterations; i++)
            {
                // Stuff being tested
                Thread.Sleep(random.Next(MaxWait));
            }
        }
        catch (Exception exception)
        {
            Console.Out.WriteLine("Ërror in Method2 Thread {0}", exception);
            exceptions++;
        }
        finally
        {
            startedThreads--;
        }
    } 
```

* * *

## 回答 #3

> 赞同：-8
> 
> 时间：2008-12-10T11:27:41.967

我通过为 nunit 创建一个插件解决了这个问题，它“安装”了一个 ITestDecorator。

# visual-studio - 如何找到 VS2008 中安装的扩展的完整列表？

> ID：352699
> 
> 赞同：0
> 
> 时间：2008-12-09T13:29:47.573
> 
> 标签：visual-studio, visual-studio-2008, plugins

我想要那个列表，因为如果发生可怕的事情，我将不得不重新安装 Visual Studio - 我需要这个列表，以便我可以重新创建相同的开发环境。这也使得搜索更新变得困难——我看不到当前安装的插件的版本。

那么，Visual Studio 中是否有一个地方可以向我显示插件及其版本的完整列表？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T13:32:24.073

如果您转到帮助->关于 Visual Studio，您通常会看到一个扩展列表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T13:32:46.523

帮助->关于 Microsoft Visual Studio->已安装的产品

# unit-testing - 将 Hudson 与 MS 测试集成？

> ID：352703
> 
> 赞同：19
> 
> 时间：2008-12-09T13:30:36.120
> 
> 标签：unit-testing, continuous-integration, hudson, mstest

是否可以将[Hudson](http://hudson.dev.java.net/ "hudson：一个可扩展的持续集成引擎")与 MS Test 集成？

我现在正在使用 Hudson 在我的开发机器上设置一个较小的 CI 服务器，以便我可以获得一些统计信息（即[FxCop](http://blogs.msdn.com/fxcop/ "代码分析团队博客")和编译器警告）。当然，如果它可以只运行我的单元测试并显示它们的输出，那也很好。

到目前为止，我已向 Hudson 添加了以下批处理任务，使其能够正确运行测试。

```
"%PROGRAMFILES%\Microsoft Visual Studio 9.0\Common7\IDE\MSTest.exe" /runconfig:LocalTestRun.testrunconfig /testcontainer:Tests\bin\Debug\Tests.dll 
```

但是，据我所知，Hudson 还不支持对 MS 测试结果进行分析。有谁知道生成的 TRX 文件是否`MSTest.exe`可以转换为[JUnit](http://www.junit.org/)或[NUnit](http://www.nunit.org/)结果格式（因为 Hudson 支持这些格式），或者是否有任何其他方法可以将 MS Test 单元测试与 Hudson 集成？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-04T16:22:40.907

我一直想写这篇文章作为指南并开发一个插件，但我还没有开始。我知道这个问题很老，但我敢肯定那里的其他人也想要同样的东西，所以就在这里。

在 Hudson 上的项目配置中：

**执行 Windows 批处理命令**

```
 SET MSTest="C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\MSTest.exe"
SET XSLParser="C:\MsBuildNunit\msxsl.exe"

SET TestDLL=path-to-your-test-projects.dll
SET TestOutFILE=TestResults\some-unique-filename.trx
SET TransformedOutputFile=%TestOutFILE:.trx=%.xml
SET XSLFile=c:\MsBuildNunit\MSBuild-to-NUnit.xslt

MKDIR TestResults

%MSTest% "/testcontainer:%TestDLL%" /nologo /resultsfile:%TestOutFILE% 

%XSLParser% %TestOutFILE% %XSLFile% -o %TransformedOutputFile%

SET ERRORLEVEL=0 
```

然后选中“发布 NUnit 测试结果报告”框并为“测试报告 XMLs”输入

```
TestResults/*.xml
```

C:\MsBuildNunit 中有一个 XSLT 以及来自 Microsoft 的 msxsl.exe。

您可以从此处下载 MSBuild-to-NUnit.xslt 并从**[此处](http://www.86th.org/MSBuild-to-NUnit.xslt)**从 microsoft 获取 msxsl.exe， 或者您可以**[在此处获取包含 xslt 和 exe](http://www.microsoft.com/downloads/details.aspx?FamilyID=2FB55371-C94E-4373-B0E9-DB4816552E41&displaylang=en)****[的](http://www.86th.org/MsBuildNunit.zip)**MsBuildNunit 文件夹的压缩副本

运行时，它调用 MSTest.exe 运行测试并以 microsofts trx (xml) 格式输出格式。然后它使用 xslt 和 trx 调用 msxsl.exe 并将其转换为 nunits xml 格式。在构建结束时，Hudson 将其作为任何其他 Nunit 测试结果进行选择，您就可以开始了。

编辑添加：我忘了提到，有了这个 xslt，我们得到了完整的测试结果。我们有多个测试项目和多个 dll，我们可以通过趋势图、按名称查看测试、查看测试状态以及如果出错我们会收到错误消息以及堆栈跟踪来获得很好的反馈。基本上几乎所有你能用 Nunit 得到的东西。

编辑（再次）：我刚刚在转换中添加了测试持续时间，所以它现在会显示在 Hudson 中！似乎对我们的测试很有用。

编辑：我尝试了新的 MSTest 插件，它目前不支持解析多个 TRX 文件，只有 1 个，所以如果你像我们一样并且有多个必须通过 MSTest 运行的测试程序集，那么目前这是你唯一的解决方案。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-10T07:11:44.083

Hudson 有一个新的 MSTest 插件。只需指定 .trx 文件的位置，即可为您完成工作。如果插件使用艾伦的解决方案，我不会感到惊讶。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-06T17:42:27.133

我已经能够使用“hangy's”命令行的变体和 MSTest 插件来成功运行和分析/发布测试用例。我所做的最大更改是为 mstest.exe 指定输出文件，并让 MSTest 插件使用该文件（不允许使用通配符...必须是实际文件名）。例如，以下是我的自定义构建步骤：

```
"%PROGRAMFILES%\Microsoft Visual Studio 9.0\Common7\IDE\MSTest.exe" /runconfig:LocalTestRun.testrunconfig /testcontainer:MyProject1.Test/bin/Debug/MyProject1.Test.dll  /testcontainer: MyProject2.Test/bin/Debug/MyProject2.Test.dll /resultsfile:TestResults\HudsonJobTestResults.trx 
```

出口 0

请注意，“结果文件”是相对于 Job 的工作空间的。因此，要解析的 MSTest 插件的结果文件是：

```
TestResults\HudsonJobTestResults.trx 
```

就是这样！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T13:36:10.227

Hudson 有一个[绘图插件](http://hudson.gotdns.com/wiki/display/HUDSON/Plot+Plugin)，可用于绘制通用数据。如果每个图表有多个数据点，这不是最容易配置和使用的插件，但是如果您可以解析 MS 测试输出并为插件生成输入文件，您至少可以绘制失败、成功和总测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T01:06:16.363

出于历史目的，我无法使用 Hudson 对 MS 测试结果进行分析，但我至少能够弄清楚，如果您使用 MSBuild 和 Exec 任务，Hudson 构建将正确标记为“ failed”，如果任何测试失败。

```
<Exec Command=""C:\Program Files (x86)\Microsoft Visual Studio 9.0\Common7\IDE\mstest.exe" /testcontainer:"MyAssembly.dll"" /> 
```

# c# - 使用“this”是真的吗？在c#中的参数使用更多内存之前？

> ID：352720
> 
> 赞同：2
> 
> 时间：2008-12-09T13:37:21.647
> 
> 标签：c#, memory, this

不仅仅是按原样调用参数？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-09T13:40:58.563

如果您的意思是字段，那么没有。无论您是显式（this.foo）还是隐式（foo） ，编译器都会注入“this”（[ldarg.0](http://msdn.microsoft.com/en-us/library/system.reflection.emit.opcodes.ldarg_0(VS.95).aspx)）。

但是，它确实在您的源代码中多占用了 5 个字符……所以在您的开发硬盘上占用了少量字节。它将在编译的 IL 或运行时产生完全零差异。

有两种情况使用“this”会改变事情：

*   当存在同名的变量/参数时 ( `this.foo = foo;`)
*   解析扩展方法时 ( `this.SomeMethod()`;)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T13:42:38.717

你的问题太含糊了，无法明确回答，但我仍然会以响亮的“否”开始

那么我想知道你的参数到底是什么意思？我通常会将其解释为“方法的参数”，但它们与范围内的“this”无关，因此您可能指的是“成员”，例如字段、属性和/或方法。

如果我关于如何解释你的问题的所有假设都是正确的，我支持我以前的“不”。

但我想知道你从哪里得到这个想法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T13:41:24.150

我不知道，如果它使用更多内存，但我不这么认为，它只是一个明确的参考，编译器也会在后台完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T13:42:01.167

我猜你的意思是在变量名之前？我不明白为什么它会使用更多内存。无论语法是什么，CLR 都必须优化，以不影响性能的方式引用变量（验证后，它将添加 this...）。所以不，它没有。

# sql-server - Sql Server 2005 - 管理表的并发性

> ID：352722
> 
> 赞同：1
> 
> 时间：2008-12-09T13:38:45.900
> 
> 标签：sql-server, locking

我有一个 ASP.NET 应用程序这个过程：

*   开始连接
*   开始交易
*   使用包含特定 LoadId 的列的 SqlBulkCopy 类将大量值插入到表“LoadData”中。
*   调用一个存储过程：
    *   阅读特定 LoadId 的表“LoadData”。
    *   对于每一行进行大量计算，这意味着读取数十个表并将结果写入临时（#temp）表（持续几分钟的过程）。
    *   删除特定 LoadId 的“LoadDate”中的行。
    *   一切完成后，将结果写入结果表中。
*   如果发生故障，提交事务或回滚。

我的问题是，如果我有 2 个用户启动该进程，第二个用户将不得不等待前一个用户完成（因为插入似乎在表上设置了排他锁）并且我的应用程序有时会超时（并且用户不乐意等待 :) )。

我正在寻找一种方法，让用户能够并行执行所有操作，因为没有交互，除了最后一个：编写结果。我认为阻止我的是“LoadData”表中的插入/删除。我检查了其他事务隔离级别，但似乎没有什么可以帮助我。

当插入完成但不结束事务时，能够删除“LoadData”表上的排他锁（是否可以强制 SqlServer 仅锁定行而不锁定表？）将是完美的。

有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T13:43:02.617

事务应涵盖小型且快速执行的 SQL/代码。它们倾向于在不同的平台上以不同的方式实现。他们将锁定表，然后随着修改的增长扩展锁定，从而锁定其他用户查询或更新同一行/页/表。

为什么不忘记事务，并以另一种方式处理处理错误？您的数据完整性是否真正受到交易的保护，或者您可以没有它吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T14:04:30.297

在 Books Online 中查找 SET TRANSACTION ISOLATION LEVEL READ COMMITTED SNAPSHOT。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T14:24:56.183

如果您确定除了最后一部分之外 cioncurrent 操作没有问题，为什么不在最后的语句之前开始事务，无论它们是需要隔离的），并在它们成功后立即提交。然后所有的前期读操作不会互相阻塞...

# qt - .ui 中的信号和插槽连接

> ID：352740
> 
> 赞同：0
> 
> 时间：2008-12-09T13:46:08.227
> 
> 标签：qt, signals-slots, qt-designer

我已经开始使用 Qt 4。然后我遇到了**Qt Designer**的问题。
在**Signal/Slots 编辑器**中，我只能设置那里列出的连接，而不是列出所有插槽。

如果我尝试在 .ui 文件中手动添加它，连接将无法正常工作。
如果我将它添加到 ui_*.h 文件中，它可以正常工作，但是当我更改设计时连接会被删除。

有人对我如何解决这个错误有什么好的建议吗？或者换个方式问：
如何让 Qt Designer 列出所有可用的插槽？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T13:53:44.873

默认情况下，不会显示所有信号/插槽。您可以尝试在尝试创建信号时出现的“配置连接”对话框左下角的“显示信号和插槽继承自 ....”复选框。

除此之外，您可以按照 Marcin 所说的使用[auto-connections](http://doc.trolltech.com/4.0/designer-using-a-component.html#a-dialog-with-auto-connect)，或者在使用 ui 的对象的构造函数中手动编写连接语句。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T13:50:40.387

您可以尝试使用 uic 的[自动](http://doc.trolltech.com/4.0/designer-using-a-component.html#a-dialog-with-auto-connect)连接功能。

但是，您将无法看到所有可用的插槽，但如果您在 Designer 和代码中使用相同的名称 - 它们应该会自动连接。

# c# - 在 C# 中发布大数据

> ID：352747
> 
> 赞同：1
> 
> 时间：2008-12-09T13:48:12.217
> 
> 标签：c#, asp.net

我有以下情况

1.  拥有一个使用 Navigate 方法调用网页的 Web 浏览器控件。我需要通过 FORM POST 发布大量元素。元素的数量可以是 40-100 个元素。

是否建议对其进行编码并通过 Navigate 方法发送？

通常是通过 FORM POST 做到这一点还是有更好的解决方案？我也许可以让客户端公开一个 web 服务，也许我可以将一个 xml 文件流式传输给他们

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T13:53:47.510

我没有看到 40-100 个元素的问题。您说的是 MB 正在发送多少数据？Web 服务器对帖子的大小确实有限制（可配置）。

根据实际场景，我会考虑将所有元素打包到 Xml 中并以这种方式发送它们（我觉得当元素具有可以在 Xml 中建模的关系时，对 Xml 进行编程更容易）。

您也可以使用 XmlHttpRequest 发布 Xml，然后您不需要在另一端提供 Web 服务，只需一个知道读取请求正文的页面即可。

# design-patterns - 使用自动删除机制撤消重做

> ID：352752
> 
> 赞同：0
> 
> 时间：2008-12-09T13:50:04.723
> 
> 标签：design-patterns, qt

我的应用程序是使用 Qt 在 C++ 中开发的，并且正在使用信号和插槽。

假设我有以下类（伪 C++ 代码）：

```
class Ball
{
    Color m_Color;
    int m_Size;
};

class Player
{
public:
    setBall(Ball* pBall)
    {
        if (pBall != m_pBall)
        {
            Ball* pPreviousBall = m_pBall;
            m_pBall = pBall;
            emit notifyBallNotUsed(pPreviousBall);
        }
    }

    Ball* getBall();

signals:
    void notifyBallNotUsed(Ball*);

private:
    String m_Name;
    Ball* m_pBall;
};

class GeneralHandler
{
public:
    addBall(Ball* pBall);
    deleteBall(Ball* pBall);

    addPlayer(Player* pPlayer)
    {
        connect(pPlayer, SIGNAL(notifyBallNotUsed(Ball*)), this, SLOT(onBallUsageChanged(Ball*)));
        ...
    }
    deletePlayer(Player* pPlayer);
    {
        disconnect(pPlayer, SIGNAL(notifyBallNotUsed(Ball*)), this, SLOT(onBallUsageChanged(Ball*)));

        onBallUsageChanged(pPlayer->getBall());
        ....
    }

private slots:
    void onBallUsageChanged(Ball* pBall)
    {
        if (isNotUsedAnymore(pBall))
        {
            m_BallList.remove(pBall);
            delete pBall;
        }
    }

private:
    bool isNotUsedAnymore(Ball* pBall); // Check if the given ball is still used by at least one player

    List<Player*> m_PlayerList;
    List<Ball*> m_BallList;
}; 
```

使用我的应用程序，用户可以添加/删除球员，并为每个球员决定球的颜色和大小。在引擎盖后面，GeneralHandler 负责存储球并删除它们。两名球员使用同一个球是完全可能的。

当一个球员被删除时，如果球不再被使用，GeneralHandler 应该删除它（如果球仍然被另一个球员使用，则保留它）。如果球员正在使用的球被改变，前一个球，如果不再使用，也应该被 GeneralHandler 删除。

到现在为止还挺好。

现在，我想使用命令模式向我的应用程序添加撤消/重做功能，这就是我卡住的地方。可以说我有这样的事情：

```
class ChangePlayerBall : public QUndoCommand
{
public:
    ChangePlayerBall(Player* pPlayer, Ball* pNewBall)
    {
        m_pPlayer = pPlayer;
    }

    void redo();
    void undo();

private:
    Player* m_pPlayer;
}; 
```

我猜 redo() 方法看起来像这样：

```
void ChangePlayerBall::redo()
{
    m_pPlayer->setBall(pNewBall);
} 
```

如果上面的代码中没有任何其他更改，那么如果其他玩家不再使用之前的 Ball 将被删除。这在实现 undo() 方法时会出现问题：如果前一个球已被删除，我不知道它的特征是什么，并且 undo 命令将无法重新创建它。或者也许我应该存储前一个球，但是撤消/重做命令如何知道这个前一个球是否仍然存在或已被处理程序删除？或者也许应该在撤消命令中实现这种一旦不再使用就删除球的机制？问题是 undo 命令会对许多其他类有很多依赖。另一个问题是此代码将在 DeletePlayer 命令中部分重复，这将不得不执行类似的操作：

```
class DeletePlayer : public QUndoCommand
{
public:
    DeletePlayer(Player* pPlayer);

    void redo();
    void undo();
...
}; 
```

我希望我的解释可以理解！

你将如何解决这个问题？我找不到令人满意的解决方案。

谢谢 ！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T09:08:23.403

> 如果其他玩家不再使用球将被删除

正如我所看到的 - 它有`s the source of your doubts. Certainly undo() command shouldn't recreate an object nor have it`自己的删除机制。您的 GeneralHandler.isNotUsedAnymore() 是如何工作的？如果它计算对球的引用，那么对 ChangePlayerBall 实例的引用也应该被计算在内。因此，需要将 Command 对象连接到一些 GeneralHandler 的插槽。

所以，我建议：

1.  球在没有被任何玩家**和**任何 UndoCommands 使用时被删除（可能包括颜色变化等）
2.  正如你所做的那样，球和球员之间的联系会在新的球分配上刹车
3.  命令对象析构函数上的球和命令制动器之间的链接（当它完全从堆栈中删除时）

希望能帮助到你 ）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-28T20:26:54.883

对球使用引用计数技巧怎么样？当球被存储在命令中时，命令可以增加球的引用计数，从而防止被处理程序（或自身，取决于您将如何更改实现）删除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-01T08:12:14.310

1.  将球保存在命令的构造函数中。
2.  需要时放入/取出。
3.  在任何地方都使用 QSharedPointer 来防止内存泄漏。

# c++ - 如何访问 qt 上的父窗口小部件？

> ID：352758
> 
> 赞同：6
> 
> 时间：2008-12-09T13:51:29.493
> 
> 标签：c++, linux, qt, kde

我有一个继承的 QTreeWidget（称为 PackList）类，它的父类是 KXmlGuiWindow。如何访问父母的插槽？

我已经尝试了 QTreeWidget 类中的 getParent()->mySlot() 但我有

```
error: no matching function for call to 'PackList::mySlot()' 
```

有人知道正确的方法吗？谢谢

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-11T02:21:50.103

如果您知道父类的类，则必须将 parentWidget() 强制转换为该类，然后调用您的插槽。请记住，在这种情况下，它是否是一个插槽没有任何区别。你只是在调用一个方法。

```
((KXmlGuiWindow*)parentWidget())->mySlot(); 
```

通过将信号连接到插槽，您可以在不投射的情况下拨打电话。

```
connect( this, SIGNAL(mySignal()), parentWidget(), SLOT(mySlot()) ); 
```

最后，如果您不想强制转换，可以使用[QMetaObject::invokeMethod来调用它。](http://doc.trolltech.com/4.4/qmetaobject.html#invokeMethod-3)这可能是矫枉过正。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T14:16:30.537

我不确定我是否完全理解你的问题。

[但是，您可以使用parentWidget()](http://doc.trolltech.com/4.4/qwidget.html#parentWidget)访问小部件的父小部件。

然后，您应该可以调用任何公共插槽：

```
parentWidget()->a_slot(); 
```

# php - PHP 刷新：频率和最佳实践

> ID：352759
> 
> 赞同：23
> 
> 时间：2008-12-09T13:51:44.550
> 
> 标签：php, optimization, flush

我刚刚读完这篇文章：[https](https://developer.yahoo.com/performance/rules.html#flush) ://developer.yahoo.com/performance/rules.html#flush并且已经在我的页面顶部加载后实现了刷新（head，css，top banner/search/nav） .

冲洗是否有任何性能影响？是否有经常这样做的事情？最佳实践是什么？

如果我要使用外部 API 获取数据，那么提前刷新是否有意义，这样用户就不会等待该数据返回，并且至少可以事先获取一些数据？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-09T14:10:31.390

所描述的技术看起来不错，但有几个缺陷：

1）PHP脚本开始和结束之间的时间比传输时间小；此外，根据您的消息来源，这可以为用户节省大约 0.5 秒。这对你来说是一个重要的时间吗？

2) 此技术不适用于 gzip 输出缓冲

3) 如果您刷新过于频繁，您将在刷新时发送一个几乎为空的数据包，这实际上可能会增加加载时间（在缓慢、嘈杂的连接上）。

4）一旦你刷新，你不能再发送任何标题

5）（小问题）服务器响应将采用分块编码，这意味着客户端不会提前知道大小（因此在下载文件时不会显示“x% done”）。

另一方面，如果您希望脚本运行很长时间（20 多秒），则可能需要发送一些数据（例如空格）以防止浏览器超时连接。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-09T13:58:28.560

不利的一面是你不能 gzip 内容以及刷新它，所以我一直更喜欢 gzip 而不是刷新。

> [某些版本的 Microsoft Internet Explorer 仅在收到 256 字节的输出后才开始显示页面，因此您可能需要在刷新之前发送额外的空格以使这些浏览器显示页面。](http://php.net/flush)

这使得这不是想法，因为填充更多数据似乎不是很有用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-03-30T13:11:41.820

我认为flush确实是一种微调机制。浏览器只使用大约 8 个线程来下载内容（取决于浏览器）。如果您有 15 张图片，浏览器将开始下载 8 张图片，并且在其中一张完成之前不会下载任何其他图片，然后它将开始下载下一张图片，等等。通过在标题后刷新，您基本上是在告诉浏览器什么它可以开始下载。当页面的其余部分被传递时（即 0.5 秒后），浏览器可能已经完成了 css 和 javascript 文件的下载。这将释放其他内容的下载线程。

除了标题之后，您可能不想在任何其他地方使用刷新。浏览器通常不会呈现未关闭的 html 标记，因此提供部分页面不会更快地显示内容。在接收到一定数量的数据或页面交付完成之前，旧版本的 IE 根本不会显示任何内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T14:17:21.533

按照 Piskvor 的观点 - 如果您期望等待 20 多秒，最好提供一个基本页面（可以压缩）并在缓慢的过程完成后使用 Ajax 更新页面。不过，您确实开始侵犯静态 html 的基本用途。

# encoding - 字符编码的最佳资源

> ID：352761
> 
> 赞同：2
> 
> 时间：2008-12-09T13:52:01.273
> 
> 标签：encoding, character-encoding, reference

我正在寻找一份文档（未打印），该文档详细但仍然简单地解释了字符编码的主题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-09T14:34:53.713

从程序员的角度来看，一个很好的概述是：

每个软件开发人员绝对、绝对必须了解 Unicode 和字符集的绝对最低要求（没有任何借口！）
作者：Joel Spolsky

[http://www.joelonsoftware.com/articles/Unicode.html](http://www.joelonsoftware.com/articles/Unicode.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T13:55:21.827

您是否尝试过维基百科的[字符编码](http://en.wikipedia.org/wiki/Charset)页面及其链接？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T13:55:55.023

这也许？

[http://www.unicode.org/versions/Unicode5.1.0/](http://www.unicode.org/versions/Unicode5.1.0/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T14:29:21.773

请参阅本文档[http://ahds.ac.uk/creating/guides/linguistic-corpora/chapter4.htm](http://ahds.ac.uk/creating/guides/linguistic-corpora/chapter4.htm)的第 2 节，它有一段有趣的字符编码方法历史。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T14:03:14.387

维基百科实际上是一个很好的来源：- http://en.wikipedia.org/wiki/Character_encoding>Character-Encodings。除了更熟悉的 ASCII、UTF-8 等之外，它们还提供有关 fieldata 等旧方案和 EBCDIC 的各种化身的良好信息。

有关 utf-8 和 unicode 的深入信息，您不能做得比：- http://www.unicode.org>Unicode.org

微软和 IBM 等各种制造商网站都有大量代码页信息，但往往与他们自己的硬件/软件产品相关。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T14:57:55.197

有一本关于这方面的法语书，叫Yannis Haralambous 的*Fontes et codages*，是 O'Reilly 的书，我很确定它已经或将要被翻译。事实上，它是： [字体和编码](http://oreilly.com/catalog/9780596102425/index.html)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-09T09:44:57.157

基本概念的简单解释：http: [//www.mihai-nita.net/article.php? artID=20060806a](http://www.mihai-nita.net/article.php?artID=20060806a)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-10-08T08:11:47.357

[每个程序员绝对、积极需要了解的编码和字符集以使用文本](http://kunststube.net/encoding/)是 joelonsoftware.com 上文章的精神继承者（[链接由 lkessler](https://stackoverflow.com/a/352922/40342)）。

这是一个很好的介绍，但在技术细节上要好一些。

# c# - 如何在 C# 中为旋转立方体设置动画？

> ID：352771
> 
> 赞同：3
> 
> 时间：2008-12-09T13:54:28.210
> 
> 标签：c#, animation, 3d, cube

我想做这样的事情：表格上的旋转立方体。我不想使用任何外部库或 dll，只使用纯 .NET 3.5（没有directx）。以及仅使用线条构建的立方体。你能告诉我怎么做吗？

我不想使用外部库，因为我不需要> 100 MB 的库来做这件事，对吗？我只想为一个用线条制作的旋转立方体制作动画。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T15:01:26.373

这就是你在 GDI+ 中制作多维数据集的方法

使用 GDI+ 欧拉旋转的 C# 3D 绘图

[http://www.vcskicks.com/3d-graphics-improved.html](http://www.vcskicks.com/3d-graphics-improved.html)

带有阴影的 C# 3D 绘图立方体

[http://www.vcskicks.com/3d_gdiplus_drawing.html](http://www.vcskicks.com/3d_gdiplus_drawing.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T14:20:24.007

学习任务？这可以通过一些简单的 3D 数学来完成。您只需要了解矩阵代数、3D 变换和 3D->2D 视图变换的基础知识。[DirectX 教程](http://msdn.microsoft.com/en-us/library/bb172485.aspx)涵盖了这一点，但您可以在 google 上搜索它，您将获得大量其他教程。

**补充：**只是为了澄清-我不建议使用 DirectX 或任何东西。您可以使用标准的 System.Drawing 工具来做到这一点。您只需要了解数学，这在 DirectX 教程中进行了解释。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T14:03:56.787

您可以尝试使用 WPF 和 WPF 团队发布的 3D Tools 源代码。

[3D工具](http://www.codeplex.com/3DTools)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T15:08:41.430

假设您将 WPF 用于您的 GUI：

1.  使用图形程序制作立方体的动画 PNG。
2.  使用[APNG WPF 控件](http://www.codeplex.com/apngwpf)将图像插入您的 GUI。

如果需要，这将产生较小的组件尺寸和透明背景。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T15:17:41.427

您需要一种表示 3d 点的方法。除非您使用 directx 或 WPF，否则 .NET 中没有现成的结构。

然后将标准欧拉旋转矩阵应用于这些点，您将获得转换后的点。如果您只进行旋转，则可以使用 3x3 矩阵，但如果您想要平移，则最好使用 4x4 矩阵和同质点。

在此之后，您需要一种将这些 3d 点投影到 2d 画布的方法。根据您使用的是透视投影还是正交投影，投影矩阵看起来会有些不同。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-09T14:22:33.707

总体上看一下 WPF，它会帮助你用几行代码来做到这一点。您还可以在 Forms 中托管 WPF 窗口。

[http://msdn.microsoft.com/en-us/library/aa970268.aspx](http://msdn.microsoft.com/en-us/library/aa970268.aspx)

# java - Java EBNF？

> ID：352774
> 
> 赞同：6
> 
> 时间：2008-12-09T13:55:00.923
> 
> 标签：java, bnf, ebnf

有谁知道 Java 语言的 (E)BNF 的准确来源？最好是来自权威来源，例如 Sun。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T17:28:43.190

我相信第三版是最新的：

[JLS 第三版](http://java.sun.com/docs/books/jls/third_edition/html/syntax.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T13:59:46.810

[第一个谷歌结果:)](http://java.sun.com/docs/books/jls/second_edition/html/syntax.doc.html)
虽然我不能说它可能是最新的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T14:27:28.563

我不确定你想要什么规格，但你可能有兴趣知道：

*   Javac 中的解析器是手写的。没有解析器生成的工具。
*   流行的解析器生成器语法存在许多存储库。这是[JavaCC](https://javacc.dev.java.net/servlets/ProjectDocumentList?folderID=110&filter=java+1.5)和[ANTLR](http://www.antlr.org/grammar/list)。

# sql - AS400 库/文件（成员）JDBC 查询

> ID：352777
> 
> 赞同：1
> 
> 时间：2008-12-09T13:55:45.010
> 
> 标签：sql, jdbc, ibm-midrange, jt400

使用 JDBC（使用 jt400 驱动程序/连接，命名=系统）我正在运行这些 SQL 语句：

```
"CREATE ALIAS QTEMP/SOURCETEMP FOR " + library + "/" + file + " (" + member + ")"
"SELECT SRCDTA FROM QTEMP/SOURCETEMP"
"DROP ALIAS QTEMP/SOURCETEMP" 
```

这行得通。但是，当成员 String 具有 . 在其中，这使一切变得混乱。

有没有办法处理这个问题？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T14:17:22.563

您可以通过更改来逃避任何 .'s，例如：

```
member = "foo.bar" 
```

至

```
member = "\"FOO.BAR\"" 
```

即用双引号括起来的大写字母。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T14:35:39.017

在[这里](http://www.ibm.com/support/knowledgecenter/ssw_ibm_i_53/pdf/welcome.htm)的某个地方有关于如何处理库（成员）的详细信息。

您的问题似乎是基本成员名称倾向于最多八个字符以及“。”之后的任何内容。被解释为一种类型（有点像 .html、.jpg .exe 等），但是您只能将一种类型的数据存储在库对象中。因此，如果您的第一个成员是premier.stuff，那么所有其他成员必须以“.stuff”作为后缀（如果提供）。

会员的官方 400-eze 是：

成员

一个数据库文件中的不同数据集，每个数据集具有相同的格式。

您可能会在第一个句号之后从您的会员姓名中删除所有内容。

抱歉，如果这不是太清楚，但是当 iSeries 设计时，他们忽略了迄今为止设计的每个操作系统，并从头开始。结果也需要一些时间来适应。

# java - 何时捕获 java.lang.Error？

> ID：352780
> 
> 赞同：119
> 
> 时间：2008-12-09T13:56:02.137
> 
> 标签：java, exception, error-handling, exception-handling

在什么情况下应该抓住`java.lang.Error`一个应用程序？

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2008-12-09T14:12:02.887

一般来说，从不。

但是，有时您需要捕获特定的错误。

如果您正在编写类似于框架的代码（加载第 3 方类），那么捕获`LinkageError`（未找到类定义、不满意的链接、不兼容的类更改）可能是明智之举。

我还看到一些愚蠢的 3rd-party 代码抛出 的子类`Error`，所以你也必须处理这些。

顺便说一句，我不确定是否无法从`OutOfMemoryError`.

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2008-12-09T14:00:00.757

绝不。您永远无法确定应用程序能够执行下一行代码。如果你得到一个`OutOfMemoryError`，你[不能保证你将能够可靠地做任何事情](https://stackoverflow.com/a/8729011/545127)。捕获 RuntimeException 和检查的异常，但从不捕获错误。

[http://pmd.sourceforge.net/rules/strictexception.html](http://pmd.sourceforge.net/rules/strictexception.html)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-03-05T12:29:59.960

通常，您应该始终捕获`java.lang.Error`并将其写入日志或将其显示给用户。我在支持部门工作，每天都看到程序员无法分辨程序中发生了什么。

如果你有一个守护线程，那么你必须防止它被终止。在其他情况下，您的应用程序将正常工作。

你应该只抓到`java.lang.Error`最高级别。

如果您查看错误列表，您会发现大多数都可以处理。例如`ZipError`，在读取损坏的 zip 文件时发生。

最常见的错误是`OutOfMemoryError`和`NoClassDefFoundError`，它们在大多数情况下都是运行时问题。

例如：

```
int length = Integer.parseInt(xyz);
byte[] buffer = new byte[length]; 
```

可以产生一个`OutOfMemoryError`但它是一个运行时问题，没有理由终止你的程序。

`NoClassDefFoundError`如果库不存在或者您使用另一个 Java 版本，则通常会发生这种情况。如果它是您程序的可选部分，那么您不应该终止您的程序。

我可以举更多例子来说明为什么`Throwable`在顶层捕获并产生有用的错误消息是个好主意。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-03-07T16:39:26.737

在多线程环境中，您最常想捕捉它！当您捕获它时，记录它并终止整个应用程序！如果你不这样做，一些可能正在执行某些关键部分的线程将会死掉，并且应用程序的其余部分会认为一切正常。因此，可能会发生许多不需要的情况。一个最小的问题是，如果其他线程由于一个线程不工作而开始抛出一些异常，您将无法轻松找到问题的根源。

例如，通常循环应该是：

```
try {
   while (shouldRun()) {
       doSomething();
   }
}
catch (Throwable t) {
   log(t);
   stop();
   System.exit(1);
} 
```

即使在某些情况下，您也希望以不同的方式处理不同的错误，例如，在 OutOfMemoryError 上，您将能够定期关闭应用程序（甚至可能释放一些内存并继续），在其他一些情况下，您无能为力。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-12-09T14:15:27.980

非常稀有。

我只会在线程的顶层说，以便尝试发出一条消息，说明线程死亡的原因。

如果你在一个为你做这类事情的框架中，把它留给框架。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-09T13:59:06.407

几乎从不。错误被设计为应用程序通常无法解决的问题。唯一的例外可能是处理错误的呈现，但即使这样也可能不会按计划进行，具体取决于错误。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-09T14:18:27.413

**`Error`通常不应该被捕获**，因为它**表示不应该发生的异常****情况**。

来自该类的 Java API 规范[`Error`](http://java.sun.com/javase/6/docs/api/java/lang/Error.html)：

> An`Error`是它的子类，`Throwable` 它指示合理的应用程序不应尝试捕获的严重问题。大多数此类错误是异常情况。[...]
> 
> 方法不需要在其 throws 子句中声明任何可能在方法执行期间抛出但未被捕获的 Error 子类，因为这些错误是不应该发生的异常情况。

正如规范中提到的，an`Error`仅在有机会的情况下抛出，当 an`Error`发生时，应用程序几乎无能为力，并且在某些情况下，Java 虚拟机本身可能处于不稳定状态（例如[`VirtualMachineError`](http://java.sun.com/javase/6/docs/api/java/lang/VirtualMachineError.html)）

虽然 an`Error`是一个子类，`Throwable`这意味着它可以被子句捕获，但它可能并不是真正需要的，因为当JVM 抛出`try-catch`an 时应用程序将处于异常状态。`Error`

在第[11.5 节 The Exception Hierarchy](http://java.sun.com/docs/books/jls/second_edition/html/exceptions.doc.html#44278) of the [Java Language Specification, 2nd Edition](http://java.sun.com/docs/books/jls/second_edition/html/jTOC.doc.html)中也有一个简短的部分。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-12-10T20:44:45.977

如果您足够疯狂地创建一个新的单元测试框架，您的测试运行程序可能需要捕获任何测试用例抛出的 java.lang.AssertionError。

否则，请参阅其他答案。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-12-09T14:09:10.113

还有其他几种情况，如果你发现一个错误，你***必须重新抛出它***。例如[ThreadDeath](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/ThreadDeath.html)永远不应该被捕获，如果你在一个封闭的环境（例如应用程序服务器）中捕获它，它可能会导致大问题：

> 只有在异步终止后必须进行清理时，应用程序才应捕获此类的实例。如果 ThreadDeath 被方法捕获，重要的是重新抛出它，以便线程真正死亡。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-09T14:28:55.037

非常非常罕见。

我只为一个非常具体的已知案例做这件事。例如，如果两个**独立的 ClassLoader**加载相同的 DLL，则可能会抛出 java.lang.UnsatisfiedLinkError。（我同意我应该将 JAR 移动到共享类加载器）

但最常见的情况是您需要登录才能知道用户抱怨时发生了什么。您想要向用户发送消息或弹出窗口，而不是默默地死去。

即使是 C/C++ 中的程序员，他们也会弹出一个错误并在它退出之前告诉人们不理解的内容（例如内存故障）。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-03-14T06:17:07.087

在 Android 应用程序中，我遇到了[java.lang.VerifyError](http://developer.android.com/reference/java/lang/VerifyError.html)。我正在使用的库无法在具有旧版本操作系统的设备中运行，并且库代码将引发此类错误。我当然可以通过在运行时检查操作系统的版本来避免错误，但是：

*   未来支持的最旧 SDK 可能会针对特定库进行更改
*   try-catch 错误块是更大的回退机制的一部分。一些特定的设备，虽然它们应该支持库，但会抛出异常。我捕获了 VerifyError 和所有异常以使用后备解决方案。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2013-11-27T01:53:46.140

在测试环境中捕获 java.lang.AssertionError 非常方便......

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-05-05T18:22:03.150

理想情况下，我们不应该处理/捕获错误。但是根据框架或应用程序的要求，可能存在我们需要做的情况。假设我有一个 XML Parser 守护进程，它实现了消耗更多内存的**DOM Parser 。****如果有一个要求，比如 Parser 线程在得到OutOfMemoryError**时不应该死掉，而是应该处理它并向应用程序/框架的管理员发送消息/邮件。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-01-26T06:23:27.300

理想情况下，我们不应该在我们的 Java 应用程序中捕获 Error，因为它是一种异常情况。应用程序将处于异常状态，并可能导致乱码或给出一些严重错误的结果。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-08-19T20:35:49.697

在检查断言的单元测试中捕获错误可能是合适的。如果有人禁用断言或以其他方式删除您想知道的断言

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-04-23T16:50:35.757

当 JVM 不再按预期工作或即将发生错误时，将出现错误。如果你捕捉到一个错误，就不能保证catch块会运行，更不能保证它会运行到最后。

还要看运行的电脑，当前的内存状态，所以没办法去测试，尽力而为。你只会有一个危险的结果。

您还将降低代码的可读性。

# java - 如何使用 MigLayout？

> ID：352781
> 
> 赞同：31
> 
> 时间：2008-12-09T13:56:43.087
> 
> 标签：java, miglayout, layout-manager

我阅读了一些关于 Java 布局管理器的信息，推荐的是[MigLayout](http://www.miglayout.com/)。我的问题是，我没有找到任何教程或简单的分步文档。

所以我想知道这一切是如何运作的，但我不知道如何。

希望，这不是微不足道的。

在此先感谢，格尔达

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-09T16:01:25.100

炸弹是对的……也是错的。我发现这份白皮书倾向于展示 MiGLayout 的所有重要功能，输入我们很少（如果有的话）使用的细节…… 这篇论文在作为教程和参考之间犹豫不决。

现在，提供的演示应用程序（在[MiG Layout 主页](http://www.migcalendar.com/miglayout/ "用于 Swing 和 SWT 的 MiG 布局 Java 布局管理器")和[MiG Java 组件页面](http://www.migcomponents.com/ "MiG Java 组件")）制作得非常好：您可以看到组件以及它们如何移动/调整大小，您可以查看用于执行此操作的源代码布局，是具体实现的宝贵资源。很珍贵，因为我还没有找到很多真正使用这种布局的开源项目（也许我只是没有正确搜索）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-08-11T05:00:49.357

也许为时已晚。但是我[在 MigLayout 上找到了这篇有用的文章：（](https://web.archive.org/web/20130403112247/http://jnb.ociweb.com/jnb/jnbMay2009.html)原来的链接现在好像离线了，所以访问它的唯一方法是archive.org）

有效的链接，如果第一个坏了，在[这里](http://jnb.ociweb.com/jnb/jnbMay2009.html)。
现在有一个[网站](https://objectcomputing.com/resources/publications/sett/may-2009-miglayout-the-one-java-layout-manager-that-does-it-all)可用。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-09T21:48:49.640

MigLayout 的人员设置了一个很棒的演示，让您通过实验学习如何配置 miglayout。

访问[http://www.miglayout.com/](http://www.miglayout.com/)并选择[Swing Demo](http://www.migcalendar.com/miglayout/swingdemoapp.jnlp)。然后您可以查看布局的示例使用，更重要的是，您可以右键单击任何组件（文本字段、标签等）并更改布局约束。这是一个很好的交互式工具，可以了解布局以及如何调整大小等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-07-17T00:37:18.927

[WindowBuilder](https://developers.google.com/java-dev-tools/wbpro/)支持 MigLayout，如果您想立即加入，并根据需要查找文档。

但是，[网站](http://www.miglayout.com/)上的文档和演示非常简单，不需要太多时间来阅读它们。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-11-29T18:21:08.230

现在来到这里的任何人都可以从这里下载 miglayout-4.0-swt.jar（任何版本，不只是 4.0）

[http://www.migcalendar.com/miglayout/versions/4.0/](http://www.migcalendar.com/miglayout/versions/4.0/)

并查看**视频**教程将它们添加到 jar 文件中

[http://www.youtube.com/watch?v=XAtKb-KaC7o](http://www.youtube.com/watch?v=XAtKb-KaC7o)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-03-20T14:49:13.667

现在来这里的人的另一个帮助...

我发现 MigLayout 的[快速入门](http://www.miglayout.com/QuickStart.pdf)是一个很好的起点，尤其是当我有一段时间没有使用它并且需要重新加快速度时。

# sql-server - 您如何在源代码控制中跟踪数据库更改？

> ID：352785
> 
> 赞同：22
> 
> 时间：2008-12-09T13:57:42.040
> 
> 标签：sql-server, svn, version-control, sourcegear-vault

我们在大多数项目中使用 SQL Server 2000/2005 和 Vault 或 SVN。我还没有找到一个不错的解决方案来捕获任一源代码控制系统中的数据库架构/过程更改。

我们当前的解决方案非常繁琐且难以实施（编写出您更改的对象并将其提交到数据库）。

我们有很多关于如何通过一些定制开发来解决这个问题的想法，但我宁愿安装一个现有的工具（付费工具很好）。

那么：您如何跟踪数据库代码更改？你有什么推荐的工具吗？

* * *

**编辑：**

感谢所有的建议。由于时间限制，我不想在这里自己动手。而且大多数建议都存在要求开发人员遵循某些程序的缺陷。

相反，理想的解决方案是监视 SQL 数据库的更改并将任何检测到的更改提交给 SCM。例如，如果 SQL Server 有一个附加组件可以记录任何 DML 更改以及进行更改的用户，然后将该对象的脚本提交给 SCM，我会很高兴。

我们在内部讨论了两个系统： 1\. 在 SQL 2005 中，使用对象权限来限制您在执行“签出”之前更改对象。然后，签入程序会将其写入 SCM。2\. 运行计划作业以检测任何更改并将它们（匿名）提交给 SCM。

如果我可以跳过用户操作部分并让系统自动处理所有这些，那就太好了。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-09T14:03:45.010

使用 Visual Studio 数据库版本编写数据库脚本。像一个魅力一样工作，你可以使用任何源代码控制系统，当然最好是它有 VS 插件。该工具还具有许多其他有用的功能。在这篇很棒的博客文章中查看它们

[http://www.vitalygorn.com/blog/post/2008/01/Handling-Database-easily-with-Visual-Studio-2008.aspx](http://www.vitalygorn.com/blog/post/2008/01/Handling-Database-easily-with-Visual-Studio-2008.aspx)

或者查看 MSDN 获取官方文档

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2017-12-07T15:12:35.620

可以使用各种 3rd 方工具直接从 SSMS 跟踪数据库更改。[ApexSQL 源代码控制](https://www.apexsql.com/sql_tools_source_control.aspx)会自动为版本控制中包含的任何数据库对象编写脚本。该工具无法自动执行提交。相反，用户需要选择将提交哪些更改。

从存储库中获取更改时，ApexSQL 源代码控制知道 SQL 数据库引用完整性。因此，它将创建一个同步脚本，包括将包装在事务中的所有依赖对象，因此，如果没有遇到错误，将应用所有更改，或者不应用任何选定的更改。在任何情况下，数据库完整性都不会受到影响。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-09T14:19:25.413

不得不说，我认为Visual Studio 数据库项目也是解决源代码控制困境的合理解决方案。如果设置正确，您可以从 IDE 对数据库运行脚本。如果您的脚本是旧的，请获取最新的，针对数据库运行它。如果需要，也有一个重新创建所有对象的脚本，新对象也必须手动添加到此脚本中，但只能添加一次

我喜欢每个表、过程和函数都在它自己的文件中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-09T14:01:27.150

一个穷人的解决方案是添加一个预提交钩子脚本，它将最新的数据库模式转储到一个文件中，并将该文件与您的代码一起提交到您的 SVN 存储库。然后，您可以从任何修订版中区分 db 模式文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T14:01:34.077

我只是将 SQL-alter-Statement 附加到完整的 SQL-CreateDB-statement 中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-09T14:04:41.450

在 SQL2000 中将**每个对象生成到它自己的文件**中，然后将它们全部检查到您的源代码管理中。让您的源代码控制处理更改历史记录。

在 SQL 2005 中，您需要编写一些代码来将所有对象生成到单独的文件中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-09T14:34:20.237

从头开始滚动你自己的并不是很可行，但是如果你使用像[Redgate SQL Compare SDK](http://www.red-gate.com/products/SQL_Comparison_SDK/index.htm)这样的 sql 比较工具来为你生成你的更改文件，那么半滚动你想要的东西并检查这些文件不会花费很长时间进入源代码控制。我为自己推出了类似的东西，以便在短短几个小时内将我们的开发系统的更改更新到我们的实时系统。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-09T16:32:44.083

在我们的环境中，我们从不手动更改数据库：所有更改都是在发布时由脚本完成的，并且脚本保存在版本控制系统中。此过程的一个重要部分是确保所有脚本都可以针对同一个数据库再次运行，这些脚本是幂等的？）而不会丢失数据。例如，如果您添加一列，如果该列已经存在，请确保您什么也不做。

您关于“建议具有要求开发人员遵循某些程序的缺陷”的评论确实是一个故事。这不是一个缺陷，这是一个特点。版本控制帮助开发人员遵循程序并使程序不那么痛苦。如果您不想遵循程序，则不需要版本控制。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-09T14:31:33.657

我们的 dbas 会定期检查 prod 与 SVN 中的内容，并删除任何不受源代码控制的对象。开发人员只需要一次就永远不会忘记再次将某些东西放入源代码控制中。

我们也不允许任何人在没有脚本的情况下将对象移动到 prod，因为我们的开发人员没有 prod 权限，这很容易执行。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-15T13:14:43.517

在一个项目中，我在设计中仔细安排了数据库中的所有重要数据都可以从外部位置自动重新创建。在启动时，如果缺少数据库，应用程序会创建数据库，并使用应用程序源代码中的模式（并因此与应用程序一起进行版本控制）从外部数据源填充它。数据库存储名称（一个 sqlite 文件名，尽管大多数数据库管理器允许多个数据库）包括一个模式版本，每当我们提交模式更改时，我们都会增加模式版本。这意味着当我们将应用程序重新启动到具有不同模式的新版本时，会自动创建和填充新的数据库存储。如果我们必须将部署恢复到旧模式，那么旧版本的新运行将使用旧数据库存储，

本质上，数据库就像一个传统的应用程序堆，具有持久性、事务安全、静态类型（因为我们使用 Python 很方便）和唯一性约束的优点。但是，我们完全不用担心删除数据库并重新开始，而且人们知道，如果他们尝试在数据库中进行一些手动 hack，那么它将在下一次部署时恢复，就像对进程状态的 hack 会恢复一样在下次重新启动时。

我们不需要任何迁移脚本，因为我们只需切换数据库文件名并重新启动应用程序，它就会自行重建。它有助于将应用程序实例分片以每个客户端使用一个数据库。它还减少了对数据库备份的需求。

如果您从外部源构建数据库的时间超过了您允许应用程序保持关闭的时间，那么这种方法将不起作用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-09-18T18:03:25.360

如果您正在使用 .Net 并且喜欢 Rails 对 Migrations 采用的方法，那么我会推荐[Migrator.Net](http://code.google.com/p/migratordotnet/)。

我找到了一个[很好的教程](http://michielvoo.net/blog/configuring-migrator-net-as-an-external-tool-in-visual-studio-using-msbuild/)，介绍了如何在 Visual Studio 中进行设置。他还提供了一个示例项目以供参考。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-09-18T18:15:04.923

我们开发了一个自定义工具来更新我们的数据库。数据库模式存储在与数据库无关的 XML 文件中，然后由该工具读取和处理。模式存储在 SVN 中，我们添加适当的注释以显示更改的内容。它对我们来说效果很好。

虽然这种解决方案对于大多数项目来说绝对是矫枉过正，但它确实有时会让生活变得更轻松。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-06-26T15:02:31.847

为了跟踪所有的变化，比如插入更新和删除，SVN 会有很多开销。最好只跟踪更改架构的 ddl 更改，例如 (alter, drop, create)。您可以通过创建一个表和一个将数据插入该表的触发器来轻松地进行此模式跟踪。任何时候您都可以通过从该表中查询来获取更改状态[这里](http://michaelbaylon.wordpress.com/2010/10/26/automatically-tracking-database-schema-changes/)和[这里有很多示例](http://chrismay.org/CommentView,guid,a21c17f9-e200-4033-8309-75d6ebbc293a.aspx)

# lambda - 统一问题的类型推断

> ID：352789
> 
> 赞同：2
> 
> 时间：2008-12-09T13:58:49.357
> 
> 标签：lambda, type-inference, unification

有谁知道类型推断问题如何

```
E > hd (cons 1 nil) : α0 
```

与打字环境

```
 E={
                   hd : list(α1 ) → α1 ,
                   cons : α2 → list(α2 ) → list(α2 ),
                   nil : list(α3 ),
                   1 : int
                } 
```

可以在统一问题中转移吗？

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T20:33:18.913

首先，重命名类型变量，使表达式中的变量不会与类型环境中的变量发生冲突。（在您的示例中，这已经完成，因为表达式引用 { a0 }，并且输入环境引用 { a1, a2, a3 }。

其次，使用新的类型变量，为表达式中的每个子表达式创建一个类型变量，生成如下内容：

```
nil : a4
1 : a5
cons : a6
(cons 1 nil) : a7
hd : a8
hd (cons 1 nil) : a0 // already had a type variable 
```

第三，在必须成立的类型变量之间生成一组方程。您可以自下而上、自上而下或以其他方式执行此操作。见[海伦，巴斯蒂安。顶级质量类型错误消息。2005.](http://people.cs.uu.nl/bastiaan/phdthesis/)详细了解为什么您可能要选择一种或另一种方式。这将导致类似：

```
a4 = list(a3) // = E(nil)
a5 = int // = E(1)
a6 = a2 -> list(a2) -> list(a2) // = E(cons)

// now it gets tricky, since we need to deal with application for the first time
a5 = a2 // first actual param of cons matches first formal param of cons
a4 = list(a2) // second actual param of cons matches type of second formal param of cons
a7 = list(a2) // result of (cons 1 nil) matches result type of cons with 2 params

a8 = list(a1) -> a1 // = E(hd)    

// now the application of hd
a7 = list(a1) // first actual param of hd matches type of first formal param of hd
a0 = a1 // result of hd (cons 1 nil) matches result type of hd with 1 param 
```

请注意，如果两次从类型环境中使用相同的函数，我们将需要更多新的类型变量（在上面的第二步中）来统一，这样我们就不会意外地使所有对 cons 的调用都使用相同的类型. 我不确定如何更清楚地解释这部分，抱歉。在这里，我们处于简单的情况，因为 hd 和 cons 都只使用一次。

第四，统一这些方程，结果（如果我没有弄错的话）如下：

```
a4 = list(int)
a5 = int
a6 = int -> list(int) -> list(int)
a7 = list(int)
a8 = list(int) -> int
a0 = int 
```

庆幸，您现在知道原始表达式中每个子表达式的类型。

（公平的警告，我自己在这些事情上有点业余，我很可能犯了印刷错误或无意中被骗了。）

# xml - 使用 XSLT/XPath，如何匹配 null 命名空间中的任何元素？

> ID：352790
> 
> 赞同：6
> 
> 时间：2008-12-09T13:59:03.380
> 
> 标签：xml, xslt, xpath

```
<xsl:template match="foo"> 
```

匹配 null 命名空间中的 foo 元素。

```
<xsl:template match="*"> 
```

匹配*任何*命名空间中的任何元素。

我试过：

```
xmlns:null=""
...
<xsl:template match="null:*"> 
```

但是为 null 命名空间声明前缀是非法的。

那么如何在 null 命名空间中匹配具有任何名称的元素呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T14:06:33.317

你可以试试：

```
<xsl:template match='*[namespace-uri() = ""]'> 
```

如果节点集为空或没有命名空间 URI，则该`namespace-uri`函数将返回一个空字符串，这应该可以实现您想要的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T15:06:18.207

ffpf 是正确的。

为了更清楚，我建议使用以下匹配模式：

 ' **`*[not(namespace-uri() )]`**'

# profiling - 学习如何使用 DTrace 的指针

> ID：352806
> 
> 赞同：13
> 
> 时间：2008-12-09T14:02:19.973
> 
> 标签：profiling, dtrace

当我询问用于分析 Rails 应用程序的工具时，有人[指着 DTrace](https://stackoverflow.com/questions/350470/what-tools-do-you-recommend-to-profile-rails-apps#351842)。由于我在 MacOSX 工作站上工作并在 OpenSolaris 上进行部署，因此这是一种有效的方法。但我对 DTrace 知之甚少。

除了通常的嫌疑人、Sun DTrace 页面和那里的可用信息之外，还有其他学习 Dtrace 的杀手锏吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-16T00:57:49.057

我做了一个 35 分钟的视频，并展示了一些 DTrace 入门示例，您可以在此处找到：[http](http://cocoasamurai.blogspot.com/2008/05/dtrace-for-cocoa-developers.html) ://cocoasamurai.blogspot.com/2008/05/dtrace-for-cocoa-developers.html ，旨在向 Cocoa 开发人员介绍 DTrace ，但它真的适用于任何人

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-27T20:21:13.197

*   [DTrace 一班轮](http://www.nbl.fi/~nbl97/solaris/dtrace/index.html#line)。
*   [SolarisInternal 上的 Dtrace CheatsSheets](http://www.solarisinternals.com/wiki/index.php/DTrace_Topics_Cheatsheets_Checklists)。
*   [高级 DTrace - 提示、技巧和陷阱](http://blogs.oracle.com/bmc/resource/dtrace_tips.pdf)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-01T13:34:08.003

观看 Brian Cantrill DTrace 视频。这是一个很棒的基于演示的演讲，Cantrill 是 DTrace 的创建者之一。

[http://video.google.com/videoplay?docid=-8002801113289007228](http://video.google.com/videoplay?docid=-8002801113289007228)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-09T14:11:33.107

我发现阅读 Mac OS X 常用管理员监控工具的 dtrace 版本对我有很大帮助`truss`-> `dtruss`。至少有十几种不同的脚本可供您阅读。（大多数以“d”开头。）

还有`/Developer/Applications/Instruments.app`一个图形应用程序可以生成 dtrace 脚本。

此外，Wikipedia 的[DTrace](http://en.wikipedia.org/wiki/DTrace)页面有很多链接，应该会有所帮助。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-09-23T22:54:34.583

这可能为时已晚，无法使用，但 Adam Leventhal 的 DTrace 新兵训练营演示非常适合入门：

[http://blogs.oracle.com/roller/resources/ahl/dtrace_course.2005.8.18.pdf](http://blogs.oracle.com/roller/resources/ahl/dtrace_course.2005.8.18.pdf)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-09T14:23:33.673

您还可以尝试“dtrace 工具包”，它包含用于许多监控目的的脚本，让您快速入门。

您还可以将 X-Code 的“仪器”附加到任何流程。在此之后，您可以大致了解您的应用程序，您可以尝试编写自己的脚本

# sql-server-2008 - 是否可以从 Sql Server 2008 以 gml2 格式导出空间数据？

> ID：352814
> 
> 赞同：1
> 
> 时间：2008-12-09T14:03:45.010
> 
> 标签：sql-server-2008, spatial, gml-geographic-markup-lan

Sql Server 2008 支持具有新几何和地理 UDT 的空间数据。它们都支持 AsGml() 方法以 gml 格式序列化数据。然而，它们将数据序列化为 GML3 格式。有什么方法可以告诉它将数据序列化为 GML2 格式吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-03T19:32:25.483

AFAIK，没有将地理空间数据序列化为 GML 2.x 的内置功能。您需要使用一些第三方工具，自己实现一个作家，或者，这个建议可能听起来有点奇怪，使用[PostGIS](http://postgis.refractions.net/)进行这种转换。

PostGIS 是替代地理空间数据库，与 SQL Server 类似的解决方案，但实现**了两种格式的反序列化： GML 2 和 GML 3**。

我的建议是使用 PostGIS 作为中间和翻译存储。

1.  使用 SQL Server 函数将数据存储到 GML 3

2.  使用 PostGIS 函数[ST_GeomFromGML加载序列化为 GML 3 的数据](http://postgis.refractions.net/documentation/manual-svn/ST_GeomFromGML.html)

3.  [使用ST_AsGML](http://postgis.refractions.net/documentation/manual-svn/ST_AsGML.html)将PostGIS 中的数据存储为 GML 2 格式，它允许您指定 GML 的目标版本：`text ST_AsGML(integer version, geometry g1);`

提出另一个地理空间数据库可能听起来很奇怪，但我相信它会运行得相当顺利和良好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T17:03:01.110

不支持 GML2，但有可用于实现自定义序列化的可扩展性 API。

下面是使用 SqlGeometry.Populate(IGeometrySink) 方法（C# 代码）进行自定义序列化的示例：

```
CustomWriter w = new CustomWriter();
SqlGeometry.Parse("POLYGON ((0 0, 10 0, 10 10, 0 10, 0 0))").Populate(w);
System.Console.WriteLine(w);

public class CustomWriter : IGeometrySink {
    private StringBuilder _builder = new StringBuilder();

    public string ToString() {
        return _builder.ToString();
    }

    public void SetSrid(int srid) {
        _builder.Append('@');
        _builder.Append(srid);
    }

    public void BeginGeometry(OpenGisGeometryType type) {
        _builder.Append(" (");
        _builder.Append(type);
    }

    public void BeginFigure(double x, double y, double? z, double? m) {
        _builder.Append(" [");
        _builder.Append(x);
        _builder.Append(' ');
        _builder.Append(y);
    }

    public void AddLine(double x, double y, double? z, double? m) {
        _builder.Append(',');
        _builder.Append(x);
        _builder.Append(' ');
        _builder.Append(y);
    }

    public void EndFigure() {
        _builder.Append(']');
    }

    public void EndGeometry() {
        _builder.Append(')');
    }
} 
```

要进行反序列化，请使用 SqlGeometryBuilder 类：

```
// Create "POLYGON ((0 0, 10 0, 10 10, 0 10, 0 0))" using Builder API
SqlGeometryBuilder b = new SqlGeometryBuilder();
b.SetSrid(0);
b.BeginGeometry(OpenGisGeometryType.Polygon);
    b.BeginFigure(0, 0);
    b.AddLine(10, 0);
    b.AddLine(10, 10);
    b.AddLine(0, 10);
    b.AddLine(0, 0);
    b.EndFigure();
b.EndGeometry();
SqlGeometry g = b.ConstructedGeometry; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-14T12:02:33.657

正如 Marko 所说，Sql Server 2008 中不支持 gml2，所以我最终编写了一个函数，用于将服务器返回的 gml3 转换为我需要的 gml2。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-08T03:24:31.080

好吧，既然你完成了，没什么意义，但我建议将 geoserver 放在 SQL Server 前面。Geoserver 为您想要的几乎任何格式内置了所有序列化代码，易于安装，并且像宣传的那样工作。

[http://docs.geoserver.org/2.0.x/en/user/services/wfs/outputformats.html](http://docs.geoserver.org/2.0.x/en/user/services/wfs/outputformats.html)

# resharper - 不包装长参数列表的可能理由是什么？(StyleCop SA1115)

> ID：352821
> 
> 赞同：2
> 
> 时间：2008-12-09T14:05:45.177
> 
> 标签：resharper, stylecop

我陷入了 ReSharper 和 StyleCop 之间的争斗，我想让 ReSharper 获胜，但在我这样做之前我想听听支持 StyleCop 的论点。

当我编写长参数列表时，ReSharper 会明智地切割参数列表并在下一行重新启动它。我发现这更具可读性。

当我在代码上运行 StyleCop 时，它希望我将这些行留得很长。我不喜欢这样，所以我想忽略 StyleCop 规则 (SA1115)。我想不出 SC 一开始就想要那些排长队的充分理由——这只是“我们一直都是这样做的”的一个例子吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-10-29T16:23:21.080

StyleCop 不希望您将所有参数放在一条很长的线上。但是，它也不希望您只是任意插入换行符来将部分参数列表向下移动到下一行。StyleCop 希望您执行以下操作之一：

```
public void MyMethod(int param1, int param2, int param3)

public void MyMethod(
    int param1, int param2, int param3)

public void MyMethod(
    int param1,
    int param2,
    int param3) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T14:07:49.853

它可能会提醒您，您的参数列表太长，应该缩短。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-24T21:44:09.167

在玩这个[问题](https://stackoverflow.com/questions/1322037/how-can-i-create-a-more-user-friendly-string-format-syntax/1322103#1322103)的代码时，我还通过从 VS IDE 运行 StyleCop 与 SA1115 发生了冲突。经过一番折腾，这是 StyleCop 认为还可以的最终结果：

```
public static string Format<T>(string pattern, T template)
{
    Dictionary<string, string> cache = new Dictionary<string, string>();

    return RegexExpression.Replace(
        pattern, 
        match =>
    {
        string key = match.Groups[1].Value;
        string value;

        if (!cache.TryGetValue(key, out value))
        {
            var prop = typeof(T).GetProperty(key);

            if (prop == null)
            {
                throw new ArgumentException("Not found: " + key, "pattern");
            }

            value = Convert.ToString(prop.GetValue(template, null));
            cache.Add(key, value);
        }

        return value;
    });
} 
```

只是想我会分享它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T14:17:52.733

从技术上讲，该规则似乎是“参数必须遵循逗号”。如果你问我，这很挑剔，但有些人相信用逗号开始连续行才能真正显示*嘿！这条线是延续！*例如

```
void Foo(  int blah
         , string blork
         , ... 
```

无论你的船飘起来，个人：）

# c# - 是否有任何用于撤消/重做数据库中行更改的库/框架？

> ID：352832
> 
> 赞同：3
> 
> 时间：2008-12-09T14:08:15.763
> 
> 标签：c#, java, sql-server, database, undo-redo

可能是我的标题不清楚。我正在寻找某种对数据库表的版本控制，就像 subversion 对文件所做的那样，就像 wiki 所做的那样。

我想跟踪更改日志。我想提取并反向运行差异。（像“svn merge -r 101:100”一样撤消）。我可能需要对历史进行索引搜索。

我已经阅读了“ [Undo Engine 的设计模式](https://stackoverflow.com/questions/49755/design-pattern-for-undo-engine)”，但它与“模式”有关。有什么我可以在不重新发明轮子的情况下重复使用的东西吗？

**编辑：** 例如，银行账户交易。我在表格中更新了“余额”（和其他）列。用户会在 10 天后发现他的错误，他会想要取消/回滚特定交易，而不更改其他交易。

如何在应用程序级别优雅地做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T15:19:19.943

Martin Fowler 在[Patterns 中讨论了随时间变化的事物](http://martinfowler.com/eaaDev/timeNarrative.html "随时间变化的事物的模式")的主题。仍然是模式而不是实际的框架，但他展示了示例数据以及如何使用它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T15:40:07.140

您可以对要跟踪的每条记录使用修订方法。这将涉及在您的表中为记录的每个修订保留一行。这些记录将通过一个共享的“ID”联系在一起，并且可以在“修订状态”上进行查询（例如，获取最新的“已批准”记录）。

在您的应用程序层中，您可以单独处理这些记录，并在需要时回滚到较早的状态，只要您记录了所有必要的信息。

```
[ID] [Revision Date] [Revision Status] [Modified By] [Balance]
1     1-1-2008         Expired           User1         $100
1     1-2-2008         Expired           User2         $200
2     1-2-2008         Approved          User3         $300
1     1-3-2008         Approved          User1         $250 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T15:05:04.307

迂腐点。您的银行账户示例无法通过审计员/监管机构。

帐户中的任何错误条目都应留在那里以备记录。将对帐户应用相等且相反的更正交易。实际上回滚了原始事务，但留下了非常明显的原始错误及其更正痕迹。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T17:02:34.913

我会采用双时态数据库设计，这将为您提供执行和回滚所需的所有数据，无论这意味着插入更多行还是简单地删除以后的修改。

这种数据库设计有相当多的微妙之处，但是关于这个主题有很好的书：

Richard T. Snodgrass 用 SQL 开发面向时间的数据库应用程序

可在此处下载：

[http://www.cs.arizona.edu/people/rts/tdbbook.pdf](http://www.cs.arizona.edu/people/rts/tdbbook.pdf)

使用数据库事务将是一个坏主意，因为它会在数据库中创建锁 - 基本上数据库事务应该尽可能短。

应用层中的任何东西，除非它本身具有某种持久性机制，否则将无法在应用程序重新启动后继续存在（尽管这可能不是必需的）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T16:05:51.953

根据您对 James Anderson 的评论，我会让用户界面在取消交易时编写一个新的插入。它将向表中插入一条新记录，该记录与取消的事务具有相同的值，但该值将是负数而不是正数。如果您的结构包含定义交易目的的内容，我会说它已取消以及它正在取消的交易的记录号。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T10:07:16.793

根据各种评论，您的问题的可能解决方案是制作一个“日期有效”表。

基本上，您将valid-from-date 和valid-to-date 列添加到每个表中。

“当前”记录的 valid_to_date 应始终为“2999-12-31”或一些任意高的值。当值更改时，您将“有效日期”更改为当前日期并插入一个新行，其有效日期为今天，有效日期为“2999-12-31”，复制所有旧行中的列（如果它们尚未更改）。

您可以使用“select all-columns-except-valid-xx-date from table where valid-to-date = '2999-12-31'”创建视图

这将允许您当前的所有查询保持不变。

这在数据仓库环境中是一种非常常见的技术，对于像汇率这样有效日期很重要的事情。

撤消逻辑应该是显而易见的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-10T10:20:16.580

尽管我在使用触发器和行版本之前已经设置了完整的撤消/审核历史记录，但我不知道具体的模式。

有几个适用于 MS Sql 的应用程序可让您浏览日志并查看实际更改。

我在 MS SQL 2000 中使用了一个名为 Log Navigator 的工具，它曾经让我撤消特定的历史事务——但我现在找不到它。

[http://www.lumigent.com](http://www.lumigent.com)和[http://www.apexsql.com](http://www.apexsql.com)是查看日志的工具，但我认为它们都不能让你回滚它们。

我认为最好的方法是在编写应用程序时牢记这一点——你已经在这里有一些关于如何做的好建议。

# version-control - 每日构建和 SQL Server 更改

> ID：352835
> 
> 赞同：0
> 
> 时间：2008-12-09T14:09:16.480
> 
> 标签：version-control, build-process, change-management

我将尝试自动化日常构建，这将涉及数据库更改、代码生成，当然还有构建、提交以及稍后的部署。目前，团队中的每个开发人员将他们的数据库结构和数据更改分别包含在两个文件中，例如 6.029_Brady_Data.sql。每个结构和数据文件都包含一个版本的所有更改，但所有更改都是可重复的，即使用 EXISTS 检查等，因此如果需要，它们可以每天运行。

我能做些什么来给这个过程带来更多的秩序，目前基本上是连接所有结构更改文件，重复运行它们直到解决所有依赖关系，然后重复数据更改文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T14:22:51.460

使用 Visual Studio 数据库版本创建一个数据库项目，将其放入源代码管理中，并让开发人员签入他们的代码。我已经这样做了，它适用于日常构建，并为构建数据库代码提供了很多支持。有关功能，请参阅此博客文章

[http://www.vitalygorn.com/blog/post/2008/01/Handling-Database-easily-with-Visual-Studio-2008.aspx](http://www.vitalygorn.com/blog/post/2008/01/Handling-Database-easily-with-Visual-Studio-2008.aspx)

# python - 如何在 Linux/Unix 上根据文件类型添加文件扩展名？

> ID：352837
> 
> 赞同：15
> 
> 时间：2008-12-09T14:10:18.957
> 
> 标签：python, linux, bash, unix, shell

这是一个关于 Unix shell 脚本（任何 shell）的问题，但任何其他“标准”脚本语言解决方案也将不胜感激：

我有一个充满文件的目录，其中文件名是这样的哈希值：

```
fd73d0cf8ee68073dce270cf7e770b97
fec8047a9186fdcc98fdbfc0ea6075ee 
```

这些文件具有不同的原始文件类型，例如 png、zip、doc、pdf 等。

任何人都可以提供一个脚本来重命名文件，以便他们获得适当的文件扩展名，可能基于`file`命令的输出？

## 回答：

[JF Sebastian 的](https://stackoverflow.com/questions/352837/how-to-add-file-extensions-based-on-file-type-on-linuxunix#352973)脚本既适用于文件名的输出，也适用于实际的重命名。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-09T14:47:24.407

这是 mimetypes 的版本：

```
#!/usr/bin/env python
"""It is a `filename -> filename.ext` filter. 

   `ext` is mime-based.

"""
import fileinput
import mimetypes
import os
import sys
from subprocess import Popen, PIPE

if len(sys.argv) > 1 and sys.argv[1] == '--rename':
    do_rename = True
    del sys.argv[1]
else:
    do_rename = False    

for filename in (line.rstrip() for line in fileinput.input()):
    output, _ = Popen(['file', '-bi', filename], stdout=PIPE).communicate()
    mime = output.split(';', 1)[0].lower().strip()
    ext = mimetypes.guess_extension(mime, strict=False)
    if ext is None:
        ext = os.path.extsep + 'undefined'
    filename_ext = filename + ext
    print filename_ext
    if do_rename:
       os.rename(filename, filename_ext) 
```

例子：

```
$ ls *.file? | python add-ext.py --rename
avi.file.avi
djvu.file.undefined
doc.file.dot
gif.file.gif
html.file.html
ico.file.obj
jpg.file.jpe
m3u.file.ksh
mp3.file.mp3
mpg.file.m1v
pdf.file.pdf
pdf.file2.pdf
pdf.file3.pdf
png.file.png
tar.bz2.file.undefined

```

* * *

在@Phil H 的回复之后，@csl 的回复之后：

```
#!/usr/bin/env python
"""It is a `filename -> filename.ext` filter. 

   `ext` is mime-based.
"""
# Mapping of mime-types to extensions is taken form here:
# http://as3corelib.googlecode.com/svn/trunk/src/com/adobe/net/MimeTypeMap.as
mime2exts_list = [
    ["application/andrew-inset","ez"],
    ["application/atom+xml","atom"],
    ["application/mac-binhex40","hqx"],
    ["application/mac-compactpro","cpt"],
    ["application/mathml+xml","mathml"],
    ["application/msword","doc"],
    ["application/octet-stream","bin","dms","lha","lzh","exe","class","so","dll","dmg"],
    ["application/oda","oda"],
    ["application/ogg","ogg"],
    ["application/pdf","pdf"],
    ["application/postscript","ai","eps","ps"],
    ["application/rdf+xml","rdf"],
    ["application/smil","smi","smil"],
    ["application/srgs","gram"],
    ["application/srgs+xml","grxml"],
    ["application/vnd.adobe.apollo-application-installer-package+zip","air"],
    ["application/vnd.mif","mif"],
    ["application/vnd.mozilla.xul+xml","xul"],
    ["application/vnd.ms-excel","xls"],
    ["application/vnd.ms-powerpoint","ppt"],
    ["application/vnd.rn-realmedia","rm"],
    ["application/vnd.wap.wbxml","wbxml"],
    ["application/vnd.wap.wmlc","wmlc"],
    ["application/vnd.wap.wmlscriptc","wmlsc"],
    ["application/voicexml+xml","vxml"],
    ["application/x-bcpio","bcpio"],
    ["application/x-cdlink","vcd"],
    ["application/x-chess-pgn","pgn"],
    ["application/x-cpio","cpio"],
    ["application/x-csh","csh"],
    ["application/x-director","dcr","dir","dxr"],
    ["application/x-dvi","dvi"],
    ["application/x-futuresplash","spl"],
    ["application/x-gtar","gtar"],
    ["application/x-hdf","hdf"],
    ["application/x-javascript","js"],
    ["application/x-koan","skp","skd","skt","skm"],
    ["application/x-latex","latex"],
    ["application/x-netcdf","nc","cdf"],
    ["application/x-sh","sh"],
    ["application/x-shar","shar"],
    ["application/x-shockwave-flash","swf"],
    ["application/x-stuffit","sit"],
    ["application/x-sv4cpio","sv4cpio"],
    ["application/x-sv4crc","sv4crc"],
    ["application/x-tar","tar"],
    ["application/x-tcl","tcl"],
    ["application/x-tex","tex"],
    ["application/x-texinfo","texinfo","texi"],
    ["application/x-troff","t","tr","roff"],
    ["application/x-troff-man","man"],
    ["application/x-troff-me","me"],
    ["application/x-troff-ms","ms"],
    ["application/x-ustar","ustar"],
    ["application/x-wais-source","src"],
    ["application/xhtml+xml","xhtml","xht"],
    ["application/xml","xml","xsl"],
    ["application/xml-dtd","dtd"],
    ["application/xslt+xml","xslt"],
    ["application/zip","zip"],
    ["audio/basic","au","snd"],
    ["audio/midi","mid","midi","kar"],
    ["audio/mpeg","mp3","mpga","mp2"],
    ["audio/x-aiff","aif","aiff","aifc"],
    ["audio/x-mpegurl","m3u"],
    ["audio/x-pn-realaudio","ram","ra"],
    ["audio/x-wav","wav"],
    ["chemical/x-pdb","pdb"],
    ["chemical/x-xyz","xyz"],
    ["image/bmp","bmp"],
    ["image/cgm","cgm"],
    ["image/gif","gif"],
    ["image/ief","ief"],
    ["image/jpeg","jpg","jpeg","jpe"],
    ["image/png","png"],
    ["image/svg+xml","svg"],
    ["image/tiff","tiff","tif"],
    ["image/vnd.djvu","djvu","djv"],
    ["image/vnd.wap.wbmp","wbmp"],
    ["image/x-cmu-raster","ras"],
    ["image/x-icon","ico"],
    ["image/x-portable-anymap","pnm"],
    ["image/x-portable-bitmap","pbm"],
    ["image/x-portable-graymap","pgm"],
    ["image/x-portable-pixmap","ppm"],
    ["image/x-rgb","rgb"],
    ["image/x-xbitmap","xbm"],
    ["image/x-xpixmap","xpm"],
    ["image/x-xwindowdump","xwd"],
    ["model/iges","igs","iges"],
    ["model/mesh","msh","mesh","silo"],
    ["model/vrml","wrl","vrml"],
    ["text/calendar","ics","ifb"],
    ["text/css","css"],
    ["text/html","html","htm"],
    ["text/plain","txt","asc"],
    ["text/richtext","rtx"],
    ["text/rtf","rtf"],
    ["text/sgml","sgml","sgm"],
    ["text/tab-separated-values","tsv"],
    ["text/vnd.wap.wml","wml"],
    ["text/vnd.wap.wmlscript","wmls"],
    ["text/x-setext","etx"],
    ["video/mpeg","mpg","mpeg","mpe"],
    ["video/quicktime","mov","qt"],
    ["video/vnd.mpegurl","m4u","mxu"],
    ["video/x-flv","flv"],
    ["video/x-msvideo","avi"],
    ["video/x-sgi-movie","movie"],
    ["x-conference/x-cooltalk","ice"]]

#NOTE: take only the first extension
mime2ext = dict(x[:2] for x in mime2exts_list)

if __name__ == '__main__':
    import fileinput, os.path
    from subprocess import Popen, PIPE

    for filename in (line.rstrip() for line in fileinput.input()):
        output, _ = Popen(['file', '-bi', filename], stdout=PIPE).communicate()
        mime = output.split(';', 1)[0].lower().strip()
        print filename + os.path.extsep + mime2ext.get(mime, 'undefined') 
```

* * *

这是旧 python 版本的片段（未经测试）：

```
#NOTE: take only the first extension
mime2ext = {}
for x in mime2exts_list:
    mime2ext[x[0]] = x[1]

if __name__ == '__main__':
    import os
    import sys

    # this version supports only stdin (part of fileinput.input() functionality)
    lines = sys.stdin.read().split('\n')
    for line in lines:
        filename = line.rstrip()
        output = os.popen('file -bi ' + filename).read()        
        mime = output.split(';')[0].lower().strip()
        try: ext = mime2ext[mime]
        except KeyError:
             ext = 'undefined'
        print filename + '.' + ext 
```

它应该适用于 Python 2.3.5（我猜）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-09T14:13:59.137

您可以使用

```
file -i filename 
```

获得 MIME 类型。您可能会在列表中查找类型，然后附加扩展名。您可以在网上找到[MIME 类型](http://www.iana.org/assignments/media-types/media-types.xhtml)和[示例文件扩展名的列表。](http://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-09T14:33:48.693

在 csl 的回复之后：

> 您可以使用
> 
> ```
> file -i filename 
> ```
> 
> 获得 MIME 类型。您可能会在列表中查找类型，然后附加扩展名。您可以在网上找到 MIME 类型列表和建议的文件扩展名。

我建议您编写一个脚本，该脚本获取 的输出`file -i filename`，并以您选择的语言返回一个扩展名（按空格分割，找到“/”，在表格文件中查找该术语） - 最多几行。然后您可以执行以下操作：

```
ls | while read f; do mv "$f" "$f".`file -i "$f" | get_extension.py`; done 
```

在 bash 中，或将其放入 bash 脚本中。或者使 get_extension 脚本更大，但这会降低您下次需要相关扩展时的用处。

编辑：从更改为`for f in *`，`ls | while read f`因为后者处理带有空格的文件名（Windows 上的特定噩梦）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T14:51:21.277

当然，应该补充一点，仅基于 file(1) 输出来决定 MIME 类型可能非常不准确/模糊（什么是“数据”？）甚至完全不正确......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-28T22:40:36.610

同意 Keltia 的观点，并详细说明了他的回答：

小心——某些文件类型可能有问题。 例如，[JPEG2000 。](http://www.linuxquestions.org/questions/showthread.php?p=3843206#post3843206)
鉴于“文件”命令没有任何选项标签，其他人可能会返回太多信息。[避免](http://www.linuxquestions.org/questions/showthread.php?p=3880220#post3880220)这种情况的方法是使用“file -b”来简短地返回信息。

BZT

# menu - 如何创建 DHTML 菜单？

> ID：352839
> 
> 赞同：0
> 
> 时间：2008-12-09T14:11:30.063
> 
> 标签：menu, dhtml

我需要创建一个具有指定功能的 DHTML 菜单，但我不知道该怎么做。这是我需要的：

所有项目均水平放置。如果它们比屏幕宽，菜单右侧会出现两个小箭头，允许滚动它。像这样的东西：

```
+--------+--------+-------+---+---+
| Item 1 | Item 2 | Item 3| < | > |
+--------+--------+-------+---+---+ 
```

菜单项应该可以在单元格中的任何位置单击。它们应该垂直和水平拉伸到内容。项目中的文本应垂直和水平居中。该菜单应该可以在 IE7/Opera/FF/Safari 中使用。

滚动是最简单的部分——我只是将它全部放在一个容器中（比如 a `<div>`），将容器设置为`overflow: hidden`然后在 Javascript 中使用`clientWidth`,`scrollWidth`和`scrollLeft`. 我已经想通并且已经尝试过了。

但是如何使菜单项如此有弹性、可在任何地方点击和居中文本呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T14:18:15.400

试试下面的 CSS：

```
#menu {
  display: table; 
}   
#menu a {
    display:table-cell; 
    vertical-align:middle;
} 
```

然后像这样格式化你的菜单：

```
<div id="menu">
    <a href="#">normal text</a>
    <a href="#"><big>large text</big></a>
    <a href="#"><span style="line-height:100px;">very tall text</span></a>
</div> 
```

这将强制垂直对齐并防止链接换行。让我们知道它是如何工作的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T15:12:30.830

好的，我与我的上级交谈，他们认为您不能右键单击菜单项并选择“在新窗口中打开”可能是可以的。如果这个要求被取消，那么我就不会绑定到`<a>`链接元素。使用 JavaScript，我可以将任何东西变成链接。所以，我选择你，~~皮卡丘~~ `<table>`！

是的，这是异端邪说，但它有效。更具体地说，它是我能想到的唯一可以同时执行以下所有操作的构造：

*   水平和垂直居中文本；
*   水平和垂直拉伸到内容；
*   当项目开始溢出时不换行到下一行。

无论如何，其他任何可以做同样事情的东西都可能会更加令人不安。在任何人有这个想法之前 - 不，我不需要搜索引擎支持。这是一个内部网络应用程序。如果谷歌可以索引那将是非常糟糕的......

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-12-09T14:21:26.940

随处可点击很容易：您可以将 onclick 事件触发器（希望有一些光标样式）绑定到原子单元元素，或者您可以将原子单元元素设置为 <a> 标记（或者更可能将它们包装在 <li> 中）和适当的链接和样式（填充，边距，foo）。

例如案例1：

```
<ul id="menu"><li class="item" onclick="foo()" style="cursor:pointer; cursor:hand; padding:1em; margin:1px; float: left;">FOO!</li></ul> 
```

（显然我并不真正推荐内联样式或脚本处理程序，但你明白了）

应用填充将有效地使文本居中，并且没有分配宽度，它们会自然地拉伸以适应其内容。

# tfs - VSS 6.0 到 TFS 迁移

> ID：352841
> 
> 赞同：2
> 
> 时间：2008-12-09T14:11:50.780
> 
> 标签：tfs, visual-sourcesafe, vssconverter, tfs-migration

我们的团队正在从 VSS 6.0 迁移到 TFS 2008，以用于源代码控制。我想知道是否有人对此迁移有任何经验。特别是，我们有兴趣在源代码控制中保留文件的历史记录，以及任何其他潜在的陷阱。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-23T10:58:18.987

是否安装了 VSS 2005？您需要它而不是以前的版本（6.0d）。

另外，您真的需要 TFS 中的历史记录吗？或者你能在沙子上画一条线，说某某日期之前的所有历史都在 VSS 中，而该日期之后的所有历史都在 TFS 中？如果是这样，您可以简单地从 VSS 获取最新信息并将文件添加到 TFS。迁移并非易事，因为您需要处理不映射到域用户的 VSS 用户、不再存在的 VSS 用户，并且虽然源代码控制操作的顺序保持不变，但操作的实际日期/时间未迁移，但它作为迁移的一部分存储在注释中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T14:44:13.540

一旦设置，这相当容易。您首先需要创建一个 usermap.xml。这会将您的 VSS 用户映射到您的 TFS2008 用户。然后创建一个项目配置文件。我会发布我的示例，但我无法发布 XML。

项目配置文件将指向用户映射 XML 文件。然后您所要做的就是键入命令“VSSConverter migrate settings.xml”来迁移或“VSSConverter analyze settings.xml”来分析项目。我建议您在迁移项目之前进行分析。

这是更多信息的链接。 [http://msdn.microsoft.com/en-us/library/ms253090(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms253090(VS.80).aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-20T15:17:05.333

不幸的是，当我尝试这个时......

TF60032：VSS 转换器需要 Visual SourceSafe 2005 或更高版本才能运行。请安装 Visual SourceSafe 2005 或更高版本，然后重试。

# perl - 如何防止 Windows 捕获我的 Perl 异常？

> ID：352870
> 
> 赞同：4
> 
> 时间：2008-12-09T14:22:15.860
> 
> 标签：perl, exception, signals

我有这个应该 24/7 运行的 Perl 软件。它保持与 IMAP 服务器的连接打开，检查新邮件，然后对新邮件进行分类。

现在我有一个用户每隔一段时间就会让他的 XP 笔记本电脑休眠。发生这种情况时，与服务器的连接失败并触发异常。调用代码通常会捕获该异常并尝试重新连接。但在这种情况下，似乎 Windows（或 Perl？）正在捕获异常并通过消息框将其传递给用户。

任何人都知道我可以如何防止这种wtf？我的代码可以捕捉到“系统即将休眠”的信号吗？

为了澄清您已经提出的一些观点：

*   我对用户休眠他们的机器没有任何问题。我只需要找到一种方法来处理它。
*   有问题的 Perl 模块确实会引发异常。它执行类似“die 'foo bar' 的操作。尽管应用程序完全基于浏览器并且不使用 Wx 或 Tk 之类的任何东西，但用户会收到一个标题为“poll_timer”的消息框。该消息框的内容正是其内容$@ （本例中为“foo bar”）。
*   [该应用程序使用perlapp](http://docs.activestate.com/pdk/7.3/PerlApp.html)编译成可执行文件。但是，该文档没有提及有关异常处理的任何内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T17:42:06.270

我认为您正在处理操作系统级别的异常，而不是 Perl 抛出的异常。相关的 Perl 模块正在调用 DLL 中的某些内容（我推测），并且抛出了异常。最好的办法是将其归结为一个简单的、可复制的触发异常的测试用例（您可能需要进行大量的休眠和唤醒此过程所涉及的机器）。然后，将此信息发送给模块开发人员并询问他们是否可以想出一种对您更有用的方法来捕获此异常。

如果模块开发人员不能或不愿提供帮助，那么您可能最终需要使用 Perl 调试器来调试模块的代码，看看到底发生了什么，看看是否有办法可以改变模块自己去捕捉和处理异常。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T18:10:31.890

我发现了一种技巧，可以避免出现硬错误的模态系统对话框（例如“遇到异常并需要关闭”）。我不知道相同的技巧是否适用于您描述的这种错误，但您可以尝试一下。

请参阅：[避免 Windows 上的“遇到问题并需要关闭”对话框](http://autopragmatic.com/2008/03/25/avoiding-the-encountered-a-problem-and-needs-to-close-dialog-on-windows/)

简而言之，将 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Windows\ErrorMode 注册表项设置为值“2”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T14:58:40.483

您的用户不是例外，而是规则。我的笔记本电脑在工作和家庭之间休眠。工作时，它在 DHCP 网络上；在家里，它完全是另一个。尽管 IP 地址的多样性（VMWare、VPN、通过 NAT 路由器的普通旧连接）令人困惑，但大多数程序仍可继续工作。那些不（AT&T 网络客户端，用于 VPN - 在办公室中未使用，在家或在路上需要）识别休眠时断开连接（AT&T 网络客户端保持待机/休眠过程，直到它断开连接），当机器唤醒时，我会在适当的情况下重新建立连接。在机场，我使用本地 WiFi（更多 DHCP），但在登机前完全关闭无线（一个物理开关）。

因此，您需要了解如何了解机器正在进入待机或休眠模式以使您的软件可用。很抱歉，我没有的是你需要做的事情的秘诀。

与 Google 的一些合作表明 ACPI（高级配置和电源接口）是解决方案的一部分（[微软](http://support.microsoft.com/kb/907477)）。APM（高级电源管理）也可能是相关的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T15:03:15.280

如果没有看到相关的代码，就很难提供明智的建议。如果您收到一个带有异常消息的对话框，则该程序很可能使用了[Tk](http://www.perltk.org)或[wxPerl](http://wxperl.sourceforge.net/) GUI 库，这可能会使事情变得有点复杂。话虽如此，我的猜测是通过将故障点包装在 eval 块中并在调用后测试 $@ 来修改程序中的异常处理将非常容易。如果 $@ 包含指示连接失败的错误消息，则重新建立连接并继续。

# visual-studio - 突出显示对 X 的所有引用？

> ID：352875
> 
> 赞同：5
> 
> 时间：2008-12-09T14:23:24.267
> 
> 标签：visual-studio, visual-studio-2008, ide

Eclipse IDE 有一个简洁的小功能，我在 Visual Studio 中真的很怀念它。

如果我将光标放在变量或方法名称上，IDE 将自动突出显示相关范围内当前文档中对它的所有引用。

我似乎找不到在 VS2008 或 Resharper 4 中打开类似行为的选项。我知道 VS 有一个 Find Usages 功能，但我想在运行中自动执行它。

有谁知道可以添加此功能的免费插件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T14:33:08.927

如果您使用的是 ReSharper，则可以使用 Shift-Alt-F11 突出显示文件中的用法。将光标放在要查找其用法的变量上，然后按 Shift-Alt-F11 组合。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T18:30:58.823

Visual Studio 有一个加载项，它会做类似的事情，叫做[RockScroll](http://www.hanselman.com/blog/IntroducingRockScroll.aspx)。当您双击某物时，它将突出显示您双击该项目的所有出现。它还将垂直滚动条更改为“语法突出显示的缩略图视图”，显示项目在文件中出现的位置的概述。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T06:20:08.127

我知道您提到了 ReSharper，但 CodeRush 有一个不错的参考窗口，您可以停靠它并让它即时或按需搜索内容。作为奖励，您可以选择每种用法，它会向您显示该用法的上下文。它也适用于方法。

我提到 CodeRush 是因为他们有一个[express edition](http://www.devexpress.com/Products/Visual_Studio_Add-in/CodeRushX/)，看起来它包含该功能，但我还没有尝试过那个版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-15T11:29:30.120

Visual Studio 2010 已经实现了这一点，但该功能有些欠缺。在放置光标和突出显示之间存在不可配置的延迟。

RockScroll 插件不适用于 Visual Studio 2010 及更高版本。

作为替代，免费的[“突出显示所选单词的所有出现”](http://visualstudiogallery.msdn.microsoft.com/4b92b6ad-f563-4705-8f7b-7f85ba3cc6bb)插件将在双击后突出显示所选字符串的所有出现。与原生 vs2010 荧光笔一样没有延迟。

它是基于字符串的，这意味着它可以在注释和字符串文字中工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-22T00:16:50.273

微软发布了一种工具，可以满足您的需求。我最喜欢的一些功能：

*   增强的滚动条
*   自动支撑完成
*   Ctrl + 单击转到定义
*   打开包含文件夹，列表继续。

对于[Visual Studio 2010](http://visualstudiogallery.msdn.microsoft.com/d0d33361-18e2-46c0-8ff2-4adea1e34fef)和[Visual Studio 2012](http://visualstudiogallery.msdn.microsoft.com/3a96a4dc-ba9c-4589-92c5-640e07332afd)

# php - 为 MySQL 和 JSON 转换 unicode

> ID：352883
> 
> 赞同：0
> 
> 时间：2008-12-09T14:25:47.320
> 
> 标签：php, mysql, json, ms-access, unicode

我有一些 HTML 从 CSV 文件插入到 MySQL 数据库中，而这些 HTML 又从访问 MDB 文件中导出。MDB 文件被导出为 Unicode，并且确实是 Unicode。然而，我不确定 MySQL 数据库的编码是什么。

但是，当我尝试回显存储在字段中的 html 时，没有 Unicode。这是直接检索数据库中的 html 字段之一。

[http://www.yousendit.com/download/TTZueEVYQzMrV3hMWEE9PQ](http://www.yousendit.com/download/TTZueEVYQzMrV3hMWEE9PQ)

它`utf-8`在来源中说。回显生成的实际页面代码`article_desc`在这里：

[http://www.nomorepasting.com/getpaste.php?pasteid=22566](http://www.nomorepasting.com/getpaste.php?pasteid=22566)

我需要将此 html 与 JSON 一起使用，我想知道我应该做什么。我不能使用任何其他框架或库。我应该在将数据插入 MySQL 数据库之前转换数据，还是其他？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T20:58:07.480

> mdb 文件被导出为 Unicode，并且确实是 unocode。

这是没有意义的。文件不能是 unicode。它可以使用与 unicode 兼容的编码进行编码，例如 utf-8，或 utf-16 或 utf-8 与 BOM 或 ..

字符集问题是一个非常普遍的问题，它的根源在于无知。我这样说并不是要冒犯您，但是您确实需要知道代码点（字符串）和编码（字节流）之间的区别。如果您不知道在整个应用程序中始终处理的是哪个，您最终会遇到问题。这些问题的诅咒是，它们只发生在边缘情况下，因此很容易长时间监督它们，当你最终意识到有问题时，它可能会在应用程序的完全不相关的部分触发。这使得调试几乎不可能。

# c++ - C++中的依赖注入

> ID：352885
> 
> 赞同：26
> 
> 时间：2008-12-09T14:26:17.520
> 
> 标签：c++, unit-testing, dependency-injection

这也是我在 Miško Hevery 的一个关于依赖注入的[谷歌谈话](http://misko.hevery.com/2008/11/11/clean-code-talks-dependency-injection/)中的评论中提出的一个问题，但它被埋没在评论中。

我想知道将依赖项连接在一起的工厂/构建器步骤如何在 C++ 中工作。

即我们有一个依赖于 B 的类 A。构建器将在堆中分配 B，在 A 的构造函数中传递指向 B 的指针，同时在堆中分配并返回指向 A 的指针。

之后谁清理？建好后让builder清理好不好？这似乎是正确的方法，因为在谈话中它说构建器应该设置预期具有相同生命周期的对象，或者至少依赖项具有更长的生命周期（我对此也有疑问）。我在代码中的意思是：

```
class builder {
public:
    builder() :
        m_ClassA(NULL),m_ClassB(NULL) {
    }
    ~builder() {
        if (m_ClassB) {
            delete m_ClassB;
        }
        if (m_ClassA) {
            delete m_ClassA;
        }
    }
    ClassA *build() {
        m_ClassB = new class B;
        m_ClassA = new class A(m_ClassB);
        return m_ClassA;
    }
}; 
```

现在，如果有一个依赖项预计会比我们将其注入的对象的生命周期更长（比如 ClassC 就是那个依赖项），我知道我们应该将构建方法更改为：

```
ClassA *builder::build(ClassC *classC) {
    m_ClassB = new class B;
    m_ClassA = new class A(m_ClassB, classC);
    return m_ClassA;
} 
```

您首选的方法是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-09T14:47:20.957

这个演讲是关于 Java 和依赖注入的。

在 C++ 中，我们尝试**不**传递 RAW 指针。这是因为 RAW 指针没有与之关联的所有权语义。如果您没有所有权，那么我们不知道谁负责清理该对象。

我发现大部分时间依赖注入是通过 C++ 中的引用完成的。
在您必须使用指针的极少数情况下，将它们包装在[std::unique_ptr<>](http://www.cplusplus.com/reference/memory/auto_ptr/)或[std::shared_ptr<>](http://www.cplusplus.com/reference/memory/shared_ptr/)中，具体取决于您要如何管理所有权。
如果您不能使用 C++11 功能，请使用 std::auto_ptr<> 或 boost::shared_ptr<>。

我还要指出，C++ 和 Java 的编程风格现在如此不同，以至于将一种语言的风格应用于另一种语言将不可避免地导致灾难。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-12-23T01:08:02.290

这很有趣，C++ 中的 DI 使用模板：

[http://adam.younglogic.com/?p=146](http://adam.younglogic.com/?p=146)

我认为作者正在采取正确的行动，不要将 Java DI 翻译成 C++。值得一读。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-05-10T16:39:21.867

我最近被 DI 虫子咬了。我认为它解决了很多复杂性问题，尤其是自动化部分。我已经编写了一个原型，它可以让你以一种漂亮的 C++ 方式使用 DI，或者至少我是这么认为的。您可以在这里查看代码示例：http: [//codepad.org/GpOujZ79](http://codepad.org/GpOujZ79)

显然缺少的东西：没有范围，没有接口与实现的绑定。后者很容易解决，前者我不知道。

如果这里有人对代码有意见，我将不胜感激。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-09T16:40:16.877

使用 RAII。

将原始指针交给某人与将所有权交给他们相同。如果这不是你想要做的，你应该给他们某种也知道如何清理有问题的对象的外观。

shared_ptr<> 可以做到这一点；其构造函数的第二个参数可以是一个知道如何删除对象的函数对象。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T14:33:02.983

如果您不一劳永逸地解决所有权问题，事情就会变得复杂。您只需在实现中决定依赖项是否可能比它们注入的对象寿命更长。

我个人会说不：注入依赖项的对象将在之后清理。尝试通过构建器来完成这意味着构建器必须比依赖项和注入它的对象寿命更长。在我看来，这导致的问题多于它解决的问题，因为在使用依赖注入的构建完成后，构建器不再提供任何有用的用途。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-09T15:14:02.387

在 C++ 中，通常，当你做对了事情时，在大多数情况下你根本不需要编写析构函数。您应该使用智能指针自动删除内容。我认为，builder 看起来不像 ClassA 和 ClassB 实例的所有者。如果您不喜欢使用智能指针，您应该考虑对象的生命周期及其所有者。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-12-23T16:04:06.073

根据我自己的经验，最好有明确的所有权规则。对于小的具体对象，最好使用直接复制，避免交叉依赖。

有时交叉依赖是不可避免的，并且没有明确的所有权。例如，(m) A 实例拥有 (n) B 实例，并且某些 B 实例可以由多个 As 拥有。在这种情况下，最好的方法是对 B 应用引用计数，方法类似于 COM 引用计数。任何拥有 B* 的函数必须首先增加引用计数，并在释放所有权时减少它。

我也避免使用 boost::shared_ptr 因为它创建了一个新类型（shared_ptr 和 B* 成为两种不同的类型）。我发现当我添加方法时它会带来更多的头痛。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-08-10T07:31:42.020

您还可以检查[**FFEAD 依赖注入**](http://code.google.com/p/ffead-cpp/wiki/DependencyInjection)。它提供了类似于 Spring for JAVA 的 DI，并且具有一种不显眼的处理方式。它还具有许多其他重要功能，例如内置**AJAX 支持、反射、序列化、C++ 解释器、C++ 业务组件、ORM、消息传递、Web 服务、线程池和**支持所有这些功能的应用程序服务器。

# database - 大数据——存储和查询

> ID：352895
> 
> 赞同：2
> 
> 时间：2008-12-09T14:30:09.353
> 
> 标签：database, architecture, hadoop, mapreduce

我们有大约 3 亿条记录的庞大数据，每 3-6 个月更新一次。我们需要（连续、实时）查询这些数据以获取一些信息。有哪些选项 - RDBMS(mysql) 或其他一些选项，例如 Hadoop。哪个会更好？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T14:54:27.667

300M 记录在常规关系数据库的范围内，如果您正确使用索引，实时查询应该没有问题。

Hadoop 听起来有点矫枉过正，除非你真的需要高度分布式和冗余的数据，而且如果你遇到麻烦或进行优化，它也会让你更难找到支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T14:37:23.443

好吧，我有一些 PostgreSQL 数据库，其中一些表的记录超过 7 亿条，并且它们一直在更新。

这些表中的查询运行速度非常快（几毫秒）并且没有任何问题。现在，我的数据非常简单，并且我在查询的字段上有索引。

所以，我想说，这完全取决于您将进行什么样的查询，以及您是否有足够的钱花在快速磁盘上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T14:45:27.280

正如其他人所说，现代 RDBMS 可以处理此类表，具体取决于查询和模式（必须进行一些优化）。如果您有一个好的键来分割行（例如日期列），那么分区/分片技术将帮助您将表拆分为几个小表。

您可以在我之前在这里提出的一个问题中阅读有关这些和其他扩展技术的更多信息 - [MySQL 的扩展解决方案（复制、集群）](https://stackoverflow.com/questions/189903/scaling-solutions-for-mysql-replication-clustering)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T14:48:43.997

如今，3 亿并不算大 :-)。

如果您主要是查询，并且您或多或少知道查询将采用什么形式，那么具有适当索引的 MySQL 表将可以正常工作。

如果您在运行查询的同时不断地应用更新，那么请选择 PostgreSQL，因为它具有更好的并发处理能力。

如果您的公司喜欢花钱，MS SQLServer、Sybase、Oracle 和 DB2 都可以轻松处理这些卷。

另一方面，如果您打算对非结构化数据进行真正的自由格式查询，那么 Hadoop 或类似的将是一个更好的选择。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T14:41:25.493

3 亿条记录应该不会对 Oracle、SQL Server、DB2 等高端 RDBMS 造成任何问题。我不确定 mySQL，但我很确定这些天它被用于一些相当大的数据库。

# .net - 异常处理

> ID：352899
> 
> 赞同：2
> 
> 时间：2008-12-09T14:31:08.493
> 
> 标签：.net, exception-handling

结构化异常处理不好吗？处理异常的正确方法是什么？

**编辑：使用 C# 在 .NET 中进行异常处理。**

我通常有一组特定的异常类（DivideByZeroException、ArrayTypeMismatchException）并且没有通用的“catch (Exception ex)”。

这背后的想法是，我预计会发生某些类型的异常，并在它们发生时定义特定的操作，并且意外的异常会在界面（Windows 或 Web）上出现。这是一个好习惯吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T14:39:49.163

我不确定“结构化异常处理”是什么意思。

在异常处理中可以做的最糟糕的事情是“吞下”异常或静默处理。

不要这样做：

```
try {
   ...
}
catch (Exception e) {
   //TODO: handle this later
} 
```

这通常是因为懒得编译代码。如果您不知道如何在特定级别处理异常，请让方法抛出异常并至少在顶部有一个 catch all 处理程序。以某种方式提供反馈（通过 GUI、给支持人员的页面/电子邮件、日志文件），以便最终解决问题。默默地捕捉异常几乎总是会导致稍后发生更大的问题并且难以追踪。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T14:33:19.707

Catch 语句 + 堆栈跟踪。永远不要在不打印堆栈跟踪的情况下捕获异常，当发生错误并且您的日志文件为空或模糊时，您或其他人将不得不再次签出该代码并将堆栈跟踪放置在 Catch 块中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T14:59:05.803

这是一个复杂的话题……有这方面的书籍……但是……有两种主要的异常处理类型……内联，其中处理潜在错误的代码与方法或例程的代码内联将“通常”执行和结构化异常处理，其中代码位于其他地方，并且基础架构旨在在发生意外事件（错误）时自动切换到该异常处理代码......两者都有优点和缺点。“内联”方法倾向于生成更混乱（带有错误代码）并且更难阅读和维护的代码。但它更容易预先生成，因为它不需要任何前期分析，当使用内联错误处理时，您经常会看到返回布尔或数字“错误”代码的方法，向调用者指示方法或例程是否成功。这消除了例程“返回”有意义的业务值或对象的“功能”语法（因为按照惯例，每个函数都必须返回错误代码）当使用结构化异常处理时，这个问题没有实际意义。

otoh，结构化异常处理通常更难做好，因为它需要预先分析例程或方法可能产生的错误，以及如果确实发生了每个错误，该方法可以或应该做什么。

可以肯定的一件事，不要将这两种方法混合在一个组件中......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T14:45:21.960

我的建议：

不要捕获异常，除非：

*   不这样做会导致应用程序崩溃（例如在事件处理程序中）
    *   在这种情况下，请务必记录异常，以便您知道发生了什么以及何时
*   您可以做一些事情来尝试补救这种情况（例如，在调用偶尔抛出异常的外部 API 时实现重试机制（请注意，不应使用异常处理来控制程序流））
    *   在这种情况下，只捕获您希望抛出的特定异常类型

在尽可能高的级别捕获异常意味着您可以获得最大的调用堆栈，这在您浏览日志并尝试查看最初是什么初始操作触发了导致异常的事件序列时非常有用.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T15:06:38.533

我不是 Windows 程序员，但在我看来，使用结构化异常处理来处理软件异常等硬件异常意味着：

*   您的代码执行 C++ 标准中的某些操作会产生未定义或实现定义的行为（例如除以零）。
*   Windows 定义在启用 SEH 的情况下，它会在这种情况下引发异常。
*   您正在使用这个事实来捕获异常和/或执行终止处理程序。

因此，IMO 要问的问题是：

*   你的编程任务真的是标准 C++ 无法处理的吗？（或者只能以明显不如通过允许硬件异常获得的方式进行处理）。
*   当您的代码变得非标准时，您真的需要采取行动吗？
*   您能否编写代码使其一开始就不会引发硬件异常？

如果答案是“是”、“是”、“否”，则需要结构化异常处理。否则，您可能能够避免它，在这种情况下，您可能想要。编写异常安全的代码很棘手，因此您可以提供的异常保证越强越好。可能用 SEH 除以零的代码不提供 nothrow 保证，当可能进行一些重新设计以使调用者不给它 duff 数据时，它可以这样做。但是如果一个函数已经因为其他原因不得不抛出异常，那么也可能为了硬件陷阱而抛出它们可能不会让事情变得更糟。

一种值得注意的特殊情况是内存分配。不确定 .NET 是否这样做，但在 linux 上分配只有在没有足够的虚拟地址空间进行分配时才会失败。物理内存在首次使用时提交，如果不够，则会导致硬件异常。由于内存分配*应该*在失败时抛出 std::bad_alloc，而实现未能实现标准的这一要求，它*可能*在某些情况下，将硬件异常转换为软件是正确的做法。然而，硬件异常可能发生在意想不到的地方，（包括你认为没有抛出的例程中），所以可能仍然无法优雅地处理，这就是为什么 linux 核心转储而不是抛出的原因。在实践中，任何完全初始化的东西都会使其构造函数崩溃，这通常足够接近软件异常有用的分配。

# debugging - 您如何处理间歇性错误？

> ID：352906
> 
> 赞同：35
> 
> 时间：2008-12-09T14:31:54.967
> 
> 标签：debugging, validation

## 设想

您有几个错误报告都显示相同的问题。他们都是神秘的，有着类似的问题是如何发生的故事。您按照这些步骤操作，但它不能可靠地重现问题。经过一些调查和网络搜索，您怀疑可能发生了什么，并且您非常确定可以修复它。

## 问题

不幸的是，如果没有重现原始问题的可靠方法，您无法验证它是否确实解决了问题，而不是完全没有效果或加剧和掩盖真正的问题。你不能修复它，直到它每次都可以重现，但这是一个大错误，不修复它会给你的用户带来很多其他问题。

## 问题

你如何去验证你的改变？

我认为对于任何设计过软件的人来说，这都是一个非常熟悉的场景，所以我确信有很多方法和最佳实践来解决这样的错误。我们目前正在研究我们项目中的这些问题之一，我花了一些时间来确定问题，但无法证实我的怀疑。一位同事正在对我的修复进行浸泡测试，希望“一天没有崩溃的跑步”等同于“修复”。但是，我更喜欢更可靠的方法，我认为这里有丰富的经验。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-09T14:40:41.300

难以重现的错误是最难解决的错误。您需要确保找到问题的根源，即使问题本身无法成功重现。

最常见的间歇性错误是由竞争条件引起的——通过消除竞争，或确保一方始终获胜，即使您无法通过测试结果成功确认问题的根源，您也已经消除了问题的根源。您唯一可以测试的是原因确实需要重复。

有时修复被视为根本的问题确实解决了问题，但不是正确的问题——无法避免。避免间歇性错误的最佳方法是在系统设计和架构上谨慎且有条不紊。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-09T14:40:41.033

如果没有确定根本原因并想出一种可靠的方法来重现错误，您将永远无法验证修复。

确定根本原因：如果您的平台允许，请在问题中加入一些事后调试。

例如，在 Windows 上，让您的代码在遇到此问题时创建一个 minidump 文件（Unix 上的核心转储）。然后，您可以让客户（或 Windows 上的 WinQual）向您发送此文件。这应该为您提供有关您的代码如何在生产系统上出错的更多信息。

但没有它，您仍然需要想出一种可靠的方法来重现错误。否则，您将永远无法验证它是否已修复。

即使有了所有这些信息，您最终可能会修复一个看起来像但不是客户看到的错误。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-09T14:39:56.637

使用更广泛的（可能是可选的）日志记录和数据保存来检测构建，允许精确再现用户在崩溃发生之前采取的可变 UI 步骤。

如果该数据不能可靠地让您重现问题，那么您已经缩小了错误的类别。是时候查看随机行为的来源了，例如系统配置的变化、指针比较、未初始化的数据等。

有时您“知道”（或者说感觉）无需大量测试或单元测试脚手架就可以解决问题，因为您真正了解问题。但是，如果您不这样做，它通常会归结为“我们运行了 100 次并且不再发生错误，因此我们会认为它已修复，直到下次报告它。”。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-09T14:47:10.693

我使用我所谓**的“重风格防御性编程”**：在似乎与问题相关的所有模块中**添加断言。**我的意思是，**添加很多断言**、断言证据、断言所有成员中对象的状态、断言“环境”状态等。

断言可帮助您识别与问题无关的代码。

大多数时候，我只是通过编写断言来找到问题的根源，因为它迫使您重新阅读所有代码并深入应用程序的核心以理解它。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-09T14:39:37.103

这个问题没有一个答案。有时，您找到的解决方案可以帮助您找出重现问题的方案，在这种情况下，您可以在修复前后测试该方案。但是，有时，您找到的解决方案只能解决其中一个问题，而不是全部问题，或者就像您说的那样掩盖了更深层次的问题。我希望我可以说“这样做，它每次都有效”，但没有适合这种情况的“这个”。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-09T17:24:53.167

你在评论中说你认为这是一个竞争条件。如果您认为您知道代码的什么“功能”正在生成条件，您可以编写一个测试来尝试强制它。

这是c中的一些危险代码：

```
const int NITER = 1000;
int thread_unsafe_count = 0;
int thread_unsafe_tracker = 0;

void* thread_unsafe_plus(void *a){
  int i, local;
  thread_unsafe_tracker++;
  for (i=0; i<NITER; i++){
    local = thread_unsafe_count;
    local++;
    thread_unsafe_count+=local;
  };
}
void* thread_unsafe_minus(void *a){
  int i, local;
  thread_unsafe_tracker--;
  for (i=0; i<NITER; i++){
    local = thread_unsafe_count;
    local--;
    thread_unsafe_count+=local;
  };
} 
```

我可以用以下方法测试（在 pthreads 环境中）：

```
pthread_t th1, th2;
pthread_create(&th1,NULL,&thread_unsafe_plus,NULL);
pthread_create(&th2,NULL,&thread_unsafe_minus,NULL);
pthread_join(th1,NULL);
pthread_join(th2,NULL);
if (thread_unsafe_count != 0) {
  printf("Ah ha!\n");
} 
```

在现实生活中，您可能必须以某种方式包装您的可疑代码，以帮助更多地进行比赛。

如果有效，调整线程数和其他参数，使其大部分时间都命中，现在你有机会了。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-09T14:47:14.530

在这种情况下，其他方法都不起作用，我引入了额外的日志记录。

我还添加了电子邮件通知，在应用程序出现故障时向我显示应用程序的状态。

有时我会添加性能计数器......我将这些数据放在一个表格中并查看趋势。

即使什么都没有出现，你也在缩小范围。不管怎样，你最终*会*得到有用的理论。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-09T14:48:31.330

首先，您需要从客户端获取堆栈跟踪，这样您就可以实际进行一些取证。

接下来使用随机输入进行模糊测试，并让这些测试长时间运行，它们非常擅长发现那些不合理的边界情况，人类程序员和测试人员可以通过用例和对代码的理解来找到这些情况。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-09T15:17:18.853

这些是可怕的，并且几乎总是抵制工程师认为他正在投入的“修复”，因为他们有几个月后回来咬人的习惯。警惕对间歇性错误所做的任何修复。为一些繁重的工作和密集的日志记录做好准备，因为这听起来更像是一个测试问题而不是开发问题。

在克服此类错误时，我自己的问题是我经常离问题太近，而不是退后一步看大局。试着让别人看看你是如何解决这个问题的。

具体来说，我的错误与超时设置和其他各种神奇数字有关，回想起来，这些数字几乎一直在工作。在我自己的案例中，诀窍是对设置进行大量实验，以便找出哪些值会“破坏”软件。

故障是否发生在特定时间段内？如果是这样，何时何地？似乎只有某些人会重现该错误？什么样的输入似乎会引发问题？它在应用程序的哪个部分失败？该错误在现场似乎或多或少是间歇性的？

当我是一名软件测试员时，我的主要工具是用笔和纸来记录我以前的操作——记住许多看似微不足道的细节至关重要。通过一直观察和收集少量数据，错误似乎变得不那么断断续续。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-09T17:19:11.057

对于难以重现的错误，第一步通常是文档。在失败的代码区域，将代码修改为超显式：每行一个命令；繁重的、差异化的异常处理；详细，甚至是冗长的调试输出。这样，即使您无法重现或修复错误，您也可以在下次看到故障时获得更多有关原因的信息。

第二步通常是断言假设和边界检查。您认为您对相关代码了解的所有内容，编写 .Asserts 和检查。具体来说，检查对象的无效性和（如果您的语言是动态的）是否存在。

第三，检查你的单元测试覆盖率。您的单元测试是否真的涵盖了执行中的每个分支？如果您没有单元测试，这可能是一个不错的起点。

不可重现错误的问题在于，它们仅对开发人员来说是不可重现的。如果您的最终用户坚持复制它们，那么它是利用现场崩溃的宝贵工具。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-09T17:32:13.480

我在系统上遇到了似乎总是导致错误的错误，但是当在调试器中单步执行代码时，问题神秘地消失了。在所有这些情况下，问题都是时间问题。

当系统正常运行时，存在某种资源冲突或在最后一个完成之前采取下一步。当我在调试器中单步执行时，事情进展缓慢，问题消失了。

一旦我发现这是一个时间问题，就很容易找到解决方法。我不确定这是否适用于您的情况，但是每当调试器中的错误消失时，时序问题就是我的第一个嫌疑人。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-09T18:56:53.403

一旦你完全理解了这个错误（这是一个很大的“一次”），你应该能够随意重现它。编写重现代码（自动测试）时，您修复了错误。

如何达到你理解错误的地步？

检测代码（疯狂地记录）。与您的 QA 合作 - 他们擅长重现问题，您需要安排在他们的机器上为您提供完整的开发工具包。对未初始化的内存/资源使用自动化工具。只是简单地盯着代码。那里没有简单的解决方案。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-09T14:44:05.177

这些类型的错误非常令人沮丧。将其外推到具有不同类型的定制硬件的不同机器上（比如在我的公司），天哪，天哪，这会变成一场噩梦。我目前在我的工作中有几个这样的错误。

我的经验法则：我不会修复它，除非我可以自己重现它，或者我看到的日志清楚地显示出了问题。否则我无法验证我的更改，也无法验证我的更改没有破坏其他任何东西。当然，这只是一个经验法则——我确实有例外。

我认为你关心你的大学的方法是完全正确的。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-09T14:47:06.620

这些问题一直是由以下原因引起的：

1.  内存问题
2.  线程问题

要解决问题，您应该：

*   检测您的代码（添加日志语句）
*   代码审查线程
*   代码审查内存分配/取消引用

代码审查很可能只有在优先考虑的情况下才会发生，或者如果您强烈怀疑多个错误报告共享哪些代码。如果这是线程问题，请检查您的线程安全性 - 确保两个线程均可访问的变量受到保护。如果是内存问题，请检查您的分配和取消引用，尤其要怀疑分配和返回内存的代码，或可能正在释放内存的其他人使用内存分配的代码。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-09T14:53:34.190

你可以问自己一些问题：

*   这段代码最后一次工作是什么时候没有问题。
*   自从它停止工作以来做了什么。

如果代码从未起作用，那么方法自然会有所不同。

至少当许多用户一直在更改大量代码时，这是一个非常常见的场景。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-09T15:21:59.127

## 具体场景

虽然我不想只专注于我遇到的问题，但这里有一些关于我们当前面临的问题以及我迄今为止如何解决它的细节。

当用户在流程的特定阶段与用户界面（确切地说是 TabControl）交互时，就会出现此问题。它并不总是发生，我相信这是因为展示问题的时间窗口很小。我的怀疑是 UserControl 的初始化（我们在 .NET 中，使用 C#）与来自应用程序另一个区域的状态更改事件相吻合，这导致字体被处置。同时，另一个控件（标签）尝试使用该字体绘制其字符串，因此崩溃。

然而，实际确认是什么导致了字体被处理已被证明是困难的。当前的修复是克隆字体，以便绘图标签仍然具有有效的字体，但这确实掩盖了根本问题，即字体首先被处理。显然，我想追踪完整的序列，但事实证明这非常困难，而且时间很短。

## 方法

我的方法是首先查看崩溃报告中的堆栈跟踪，然后使用 Reflector 检查 Microsoft 代码。不幸的是，这导致了一个几乎没有文档的 GDI+ 调用，它只返回一个错误数字——.NET 把它变成了一个非常无用的消息，表明某些东西是无效的。伟大的。

从那里，我去看看我们代码中的哪个调用导致了这个问题。堆栈以消息循环开始，而不是在我们的代码中，但我在怀疑的一般区域中发现了对 Update() 的调用，并且使用检测（跟踪等），我们能够以大约 75% 的确定性确认这是绘画信息的来源。然而，这不是错误的来源——要求标签上色并不是犯罪。

从那里，我查看了正在崩溃的绘制调用 (DrawString) 的各个方面，看看哪些方面可能是无效的，并开始排除每一个方面，直到它落在一次性物品上。然后我确定了哪些是我们可以控制的，而字体是唯一的。所以，我看了一下我们是如何处理字体的，以及我们在什么情况下处理它以确定任何潜在的根本原因。我能够提出符合用户报告的合理事件序列，因此能够编写低风险修复程序。

当然，我的脑海中闪过这个错误是在框架中，但我想假设我们在把责任推给微软之前搞砸了。

## 结论

因此，这就是我处理此类问题的一个特定示例的方式。如您所见，它不太理想，但符合许多人所说的。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-09T18:06:56.763

除非有重大的时间限制，否则我不会开始测试更改，直到我能够可靠地重现问题。

如果你真的需要，我想你可以编写一个似乎有时会触发问题的测试用例，并将它添加到你的自动化测试套件中（你确实有一个自动化测试套件，对吧？），然后做出改变并希望那个测试用例永远不会再失败，知道如果你没有真正修复任何东西，至少你现在有更多的机会抓住它。但是当您可以编写测试用例时，您几乎总是将事情减少到您不再处理这种（显然）非确定性情况的程度。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-09-05T10:50:02.737

**简单地说：询问报告它的用户。**

我只是使用其中一名记者作为验证系统。通常，愿意报告错误的人非常乐意帮助您解决她的问题 [1]。只需给她您的版本并可能修复并询问问题是否消失。在错误是回归的情况下，可以使用相同的方法将问题发生的位置一分为二，为用户提供多个版本的问题进行测试。在其他情况下，用户还可以通过为她提供具有更多调试功能的版本来帮助您调试问题。

这将限制可能的修复对那个人的任何负面影响，而不是猜测某些东西会修复错误，然后意识到你刚刚发布了一个没有效果的“错误修复”，或者在最坏的情况下对系统稳定性。

您还可以通过将新版本提供给有限数量的用户（例如所有报告问题的用户）并仅在此之后发布修复来限制“错误修复”可能产生的负面影响。

她还可以确认您所做的修复工作，很容易添加测试以确保您的修复将保留在代码中（至少在单元测试级别，如果该错误难以在更高的系统级别上重现）。

当然，这要求您所做的任何工作都支持这种方法。但如果不是这样，我真的会尽我所能来启用它——最终用户会更加满意，许多最困难的技术问题都会消失，当开发可以直接与系统最终用户交互时，优先级就会变得清晰。

[1] If you have ever reported a bug, you most likely know that many times the response from the development/maintenance team is somehow negative from the end users point of view or there will be no response at all - especially in situations where the bug can not be reproduced by the development team.

# java - Tomcat 应用程序缺少显示名称

> ID：352925
> 
> 赞同：8
> 
> 时间：2008-12-09T14:36:05.583
> 
> 标签：java, eclipse, tomcat, servlets

我有一个小项目，其中一些 jsp 部署在 Tomcat 5.5 上。最近，也与 jsp 文件（一个战争档案）一起部署的 Servlet 停止工作。我还从我的 svn 中检查了一个以前的版本，它应该可以工作。我注意到`displayname`（我使用德语版的 Tomcat ，所以我想这就是我的翻译方式，Tomcat 管理器第二列中的名称）消失了。我在 vista 上使用 Eclipse Ganymede。Tomcat 在 Debian 上运行。本地 Tomcat 显示相同的行为。希望有人有想法。谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-09T14:45:08.200

是`<display-name>`web.xml 文件中的元素吗？`web.xml`文件在 WAR 和 at 中吗`/WEB-INF/web.xml`？它是否验证（eclipse 可以这样做，或者尝试[w3c.org 的验证服务](http://validator.w3.org/)）？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2016-07-01T18:08:03.950

你正在寻找

```
<web-app blahblah>
    <display-name>**This**</display-name>
    <servlet>
        <servlet-name>Not this</servlet-name>
    </servlet>
</web-app> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T14:46:18.450

我将首先查看您的应用程序的部署描述符。即web.xml。通常，当应用程序已部署但由于配置错误或 web.xml 格式不正确而无法启动时。

# linq - 跨多个数据库的 LINQ

> ID：352949
> 
> 赞同：36
> 
> 时间：2008-12-09T14:43:26.207
> 
> 标签：linq, linq-to-sql

我有两个需要通过 LINQ 连接的表，但它们位于不同的数据库中。现在我正在返回一个表的结果，然后循环并检索另一个表的结果，您可以猜到这并不是非常有效。有什么方法可以将它们放入单个 LINQ 语句中？有没有其他方法来构造它以避免循环？我只是在寻找想法，以防我忽略了某些东西。

请注意，我不能更改数据库，即我不能在一个引用另一个的视图中创建视图。我还没有尝试过在引用这两个表的第三个数据库中创建视图。欢迎任何想法。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-12-09T15:24:36.407

只要您可以从另一个数据库访问一个数据库，您甚至可以跨服务器执行此操作*。*也就是说，如果可以针对*ServerA*编写 SQL 语句。访问*ServerB的**DatabaseA*。*数据库 B*。*架构*。*TableWhatever*，那么你可以在 LINQ 中做同样的事情。

 ***为此，您需要手动编辑 .dbml 文件。您可以像这样在 VS 2008 中轻松执行此操作：右键单击，选择**Open With...**，然后选择**XML Editor**。

查看**Connection**元素，它应该位于文件的顶部。您需要做的是为不在该连接字符串指向的数据库中的表提供一个明确的数据库名称（和服务器名称，如果不同）。

**.dbml 中Table**元素的开始标记如下所示：

```
<Table Name="dbo.Customers" Member="Customers"> 
```

您需要做的是，对于*不在*连接字符串的数据库中的任何表，将该**Name**属性更改为类似以下之一：

```
<Table Name="SomeOtherDatabase.dbo.Customers" Member="Customers">
<Table Name="SomeOtherServer.SomeOtherDatabase.dbo.Customers" Member="Customers"> 
```

如果遇到问题，请确保可以从您的原始数据库（或服务器）真正访问其他数据库（或服务器）。在 SQL Server Management Studio 中，尝试编写一个针对原始数据库运行的小型 SQL 语句，执行如下操作：

```
SELECT SomeColumn
FROM OtherServer.OtherDatabase.dbo.SomeTable 
```

如果*这*不起作用，请确保您的用户或登录名可以使用相同的密码访问两个数据库。当然，它应该与 .dbml 连接字符串中使用的相同。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-09T15:04:23.467

在您的数据库中创建一个 proc/view。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T15:11:27.820

鉴于您的条件，我认为您不能在一个 Linq 语句中做到这一点。但是您可以将 L2S 查询的结果加入到 Linq to Objects 查询中。

# objective-c - 如何使用 NSScanner 解析 Cocoa 中的制表符分隔字符串？

> ID：352952
> 
> 赞同：0
> 
> 时间：2008-12-09T14:43:50.670
> 
> 标签：objective-c, cocoa, parsing

我有一个返回制表符分隔数据的 Web 服务（请参见下面的示例）。

我需要将其解析为数组或类似的，以便创建它的导航视图。

我已经设法执行了 Web 请求并且可以解析 XML 文件，但是我对 Objective-C 的了解很少。

```
433 Eat
    502 Not Fussed
    442 British
    443 Chinese
    444 Dim Sum
    445 Fish
    446 French
    447 Gastropubs
    449 Indian
    451 Italian
    452 Japanese
    453 Middle Eastern
    454 Pan-Asian
    455 Pizza
    456 Spanish
    457 Tapas
    458 Thai
    459 Vegetarian
434 Drink
    501 Not Fussed
    460 Bars 
    461 Pubs 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-09T16:58:43.843

我不确定我是否完全理解你的格式（它对我来说有点奇怪）但最简单`with - (NSArray *)componentsSeparatedByString:(NSString *)separator`的方法是 NSString 类中的一个方法......例如：

```
NSArray *components = [myString componentsSeperatedByString:@"\t"]; 
```

这将为每个制表符分隔的字段返回一个`NSArray`of 。`NSStrings`如果换行符很重要，您可以使用`- (NSArray *)componentsSeparatedByCharactersInSet:(NSCharacterSet *)separator`（也 on `NSString`）使用多种分隔符进行拆分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T17:13:14.597

我有一种感觉，需要的不仅仅是一个平面列表。如果你想要一个多维结构，你可以这样做：

```
NSArray *lines = [data componentsSeparatedByString:@"\n"];
for (NSString *line in lines) {
    NSArray *fields = [line componentsSeparatedByString:@"\t"];
     // Do something here with each two-element array, such as add to an NSDictionary or to an NSArray (to make a multidimensional array.)
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T17:15:13.857

使用 NSScanner，您走在了正确的轨道上。您至少需要两台扫描仪：一台扫描整个输入字符串中的行，每行一台扫描仪。将整个输入扫描器设置为仅跳过空格（而不是换行符），然后：

1.  扫描一行（源字符串到行尾）。
2.  创建一个扫描仪并让它从行中扫描标签。
3.  计算您扫描的标签。那是你的缩进级别。
4.  该行的其余部分是条目号和名称。您可以将行扫描到空格以分隔数字和名称，或者将它们放在一起，具体取决于您的需要。
5.  回到步骤 1。

对于具体的方法名称，请参阅[NSScanner 类参考](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSScanner_Class/)和[NSCharacterSet 类参考](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSCharacterSet_Class/)。

# java - Future.get() 和 InterruptedException 异步线程

> ID：352954
> 
> 赞同：1
> 
> 时间：2008-12-09T14:44:10.340
> 
> 标签：java, multithreading, asynchronous, timeout, future

我在带有 httpClient 的应用程序中使用异步线程。我像这样使用 Future Api 拨打电话

```
mStrResults = (String) rssFuture.get(); 
```

此调用尝试检索从我的 Callable httpClient call() 方法返回的 html 字符串。

然而，我想要做的是确保 get 方法在执行 call() 方法时不会等待太久。我应该在调用 rssFuture.get() 时传递一个超时参数，还是只用一个 InterruptedException 捕获块包围就可以了？

还有一个异步线程在抛出 InterruptedException 之前等待的默认时间，如果是，我可以设置自定义值吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T15:07:18.280

你应该使用未来。[get(long timeout, TimeUnit unit)](http://java.sun.com/javase/6/docs/api/java/util/concurrent/Future.html#get(long,%20java.util.concurrent.TimeUnit))，并捕获 TimeoutException。get() 没有默认超时，它将*永远*等待。

除非调用 Future.get() 的线程被中断，否则不会抛出 InterruptedException。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T15:12:12.843

`rssFuture.get()`您应该在调用并捕获 TimeoutException时传递一个超时参数。`call`仅当运行您的线程被该方法中断`Thread.interrupt`或您`cancel(true)`在 Future obj 中调用该方法时，才会发生 InterruptedException 。

# c# - C# 相当于 C++ mem_fun？

> ID：352958
> 
> 赞同：0
> 
> 时间：2008-12-09T14:44:53.740
> 
> 标签：c#, methods, delegates, mem-fun

我想在 C# 中执行以下操作：

```
 class Container {
        //...
        public void ForEach(Action method) {
            foreach (MyClass myObj in sequence) myObj.method();
        }
    }

    //...
    containerObj.ForEach(MyClass.Method); 
```

在 C++ 中，我会使用 std::mem_fun 之类的东西。我将如何在 C# 中做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T15:00:49.463

这应该在 C# 3.0 中起作用：

```
class Container 
{        
//...        
public void ForEach(Action<MyObj> method) 
{            
    foreach (MyClass myObj in sequence) method(myObj);        
}    
}   

//...    containerObj.ForEach( myobj => myObj.Method() ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T14:49:00.753

假如说：

```
 public void ForEach(Action method) {
        foreach (MyClass myObj in sequence) method(myObj); 
```

对你没有好处，那么我认为你陷入了反思。

# asp.net - Subversion 和使用 IIS 进行 ASP.NET 开发

> ID：352968
> 
> 赞同：1
> 
> 时间：2008-12-09T14:46:45.857
> 
> 标签：asp.net, svn, iis, version-control

我是 SVN 的新手，无法为以下情况找到答案。

我有一个正在开发的 ASP .NET 2.0 Web 应用程序。我使用本地 IIS 作为开发 Web 服务器（即不是 Visual Studio Web 开发服务器）。我的开发环境是VS2005、Vista、IIS7、TortoiseSVN/AnkhSVN。VisualSVN 安装在服务器上。

我的 .sln 文件和类库等位于 **C:\Localsource\Projects\ProjectName** 文件夹中，我的 .aspx 文件位于我的 **C:\inetpub\wwwroot\ProjectName** 文件夹中。

我可以很好地为 **C:\Localsource\Projects\ProjectName** 设置存储库，但想不出在同一个存储库中也为 IIS 文件夹设置它的方法。

在 SVN 中处理这种开发环境的最佳方法是什么？

非常感谢，

蚂蚁

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T16:09:13.070

在 Visual Studio 的解决方案中，您可以拥有一个类库项目，该项目通常位于 .sln 文件下的目录中。

在这种情况下，他在解决方案中还有一个 Web 项目，但不在文件目录结构中的 .sln 文件下方。

他将通过 HTTP 而不是通过本地文件路径附加到该项目。

IIS 会将其作为[http://localhost/webapp](http://localhost/webapp)进行管理，默认情况下会将其放置在 c:\inetpub\wwwroot\webapp 中。webapp 文件夹中的文件不会在 repo 中，因为它们不在解决方案和类库的层次结构中。这是他如何解决的问题。

我的答案是移动[http://localhost/webapp](http://localhost/webapp)指向 .sln 文件下方并与类库目录相邻的文件夹，然后它都可以进入 repo。

将类库和 webapp 分离是帮助代码重用和将逻辑与网站解耦的最佳实践。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T14:55:32.627

您不能只将 IIS 指向*C:\Localsource\Projects\ProjectName*并设置权限吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T15:10:03.330

嗯 - 好点。当我到达这里时，它是这样设置的，Visual Studio 总是在 wwwroot 文件夹中创建网站，所以我认为 wwwroot 就是他们必须去的地方。

也许我得考虑重新安排一下……

谢谢！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T15:19:39.817

好的，我在这里可能很愚蠢，但是.. 为什么需要将 IIS 文件夹（即代码库的输出）添加到存储库中？

### 更新

我想我应该再澄清一下。我的意思是我不确定为什么 ASPX 无论如何都与项目分开？解决方案中的 Web 项目和*n*类库项目有什么问题，添加到您的存储库中。然后您在每个新版本上发布..

如果这只是“*回滚已发布的输出可能更容易*”的情况，那么就这样吧，我只是好奇，因为我没有看到很多人实际上是这样工作的。

在这种结构中部署解决方案也会容易得多..

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T15:49:49.053

IIS 文件夹不是代码库的输出，它是应用程序的一部分。它不是 CGI 输出或任何东西，而是运行应用程序的脚本！

这是具有用户控件和 HTML 以实际运行应用程序的 .aspx 页面。它是应用程序的一部分，但与 VS Studio 解决方案分开。

最简单的方法是有一个解决方案，然后是 C:\Localsource\Projects\ProjectName\WEBSITE。

将 IIS 也指向该文件夹。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T16:32:49.920

我认为您可能希望根据 Dillorscroft 的[建议](https://stackoverflow.com/questions/352968/subversion-and-using-iis-for-aspnet-development#353298)将其分为两个问题。

首先，关于您的开发服务器上发布到生产站点的材料，我认为您需要为此进行版本控制。首先，您可以回滚任何页面，并且您还可以决定何时拥有要提取到生产环境的开发站点的稳定级别。（我会从源代码控制系统中获取到站点映像，然后将该映像与生产站点同步。）

因此，对于第一部分，我们正在讨论对网页和所有支持网站的自定义服务器端材料进行版本控制。

其次，关于站点上使用的组件的开发，他们需要自己的开发项目，因为组件是去开发站点的结果，而不是所有的源、库等。和。所以这些将有自己的项目开发树（把它想象成你正在构建一个供其他开发项目使用的库，尽管在这种情况下其他项目是网页）。所以唯一应该出现在 IIS 中的是开发站点的“已部署”组件。

对你来说似乎有三个关键问题：

1.  如何处理需要针对网站的测试开发以及版本控制的位置（假设它们不属于网站本身）

2.  您可以如何轻松地安排确保开发网站上的所有内容都受到版本控制并适当地签入和签出。（这与您用于编辑网页和其他服务器端垃圾的工具有关，而不是在旁边开发的组件。）

3.  轻松地将开发的组件从生产它们的项目中取出到开发站点并在那里签入。

对于 (2) 和开发网站的版本控制，我的解决方案是使用 Visual Source Safe 与 IIS 和 FrontPage 扩展的集成，将网站置于版本控制之下。其他开发项目产生的组件通过 VSS 共享映射到服务器项目。

对于 SVN，我推测 (1) 您想查看是否存在 IIS 将识别为外部源代码控制系统的 SVN 适配器，并且，无论哪种方式，(2) 都有一个从他们的建设项目中获取组件交付的学科进入整个网站项目。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-09T21:50:25.783

抢，

为什么您认为 .aspx 文件是代码库的输出？

它是代码库的一部分。例如，它不是编译后的输出。

只是想知道？

# sharepoint - 清理文档库中的文档角色

> ID：352980
> 
> 赞同：2
> 
> 时间：2008-12-09T14:48:54.043
> 
> 标签：sharepoint, moss, variable-assignment, role

我一直在开发一个事件处理程序来清理 MOSS 中文档库的新项目的 RolesAssignments。我已经搜索了一种可以有效清理所有 RolesAssignments 的方法，尽管我发现接缝循环通过 RolesAssignments 并逐个删除的最佳方法是什么？是否有另一种方法来清理项目的所有 RolesAssignments？

我用于清理 RolesAssignments 的代码如下所示：

```
 for (int i = ListItem.RoleAssignments.Count - 1; i >= 0; --i)
    { 
        ListItem.RoleAssignments.Remove(i); 
    } 
```

有没有人对如何处理这个有任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T19:04:48.800

您在问题正文中给出的示例是执行此操作的最正确方法。ResetRoleInheritance 和 BreakRoleInheritance 可能会满足您的需求，但这是它们执行的操作的副作用。它们的目的不是删除 RoleAssignments，而是对角色继承进行操作。来自 MSDN：

[ResetRoleInheritance](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splistitem.resetroleinheritance.aspx) - “删除本地角色分配并从父对象恢复为角色分配。”

[BreakRoleInheritance](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splistitem.breakroleinheritance.aspx) - “为项目创建独特的角色分配，而不是从父级继承它们。”

如果角色继承已经被破坏并且您正在使用特定的角色分配，您应该像您在问题中那样使用循环删除它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T17:51:40.523

我有答案，把属性 SPListItem.BreakRoleInheritance(false) 打破角色继承并删除角色分配。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-09T16:02:58.933

ResetRoleInheritance 怎么样？这应该清除所有 RoleAssignments。

# ms-access - 在列中插入默认值（访问数据库）

> ID：352991
> 
> 赞同：3
> 
> 时间：2008-12-09T14:53:46.810
> 
> 标签：ms-access, alter

如何在 Access 中将默认值插入表的列中？我使用这个指令：

```
ALTER TABLE Tabella ADD Campo Double DEFAULT 0
ALTER TABLE Tabella ADD Campo Double DEFAULT (0)
ALTER TABLE Tabella ADD Campo DEFAULT 0
ALTER TABLE Tabella ADD Campo DEFAULT (0)
ALTER TABLE Tabella ADD Campo SET DEFAULT 0
ALTER TABLE Tabella ADD Campo SET DEFAULT (0) 
```

但所有这些都会导致错误。我该怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T14:59:09.327

来自[MSDN](http://msdn.microsoft.com/en-us/library/bb243857.aspx)：

> DEFAULT 语句只能通过 Access OLE DB 提供程序和 ADO 执行。如果通过 Access SQL View 用户界面使用，它将返回错误消息。

Sooo... 告诉我们更多关于您在做什么以及如何执行 SQL 的信息？

为什么不使用表格设计器？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T14:58:20.360

看到这个答案了吗？

[SQL 添加具有默认值的列 - Access 2003](https://stackoverflow.com/questions/47535/sql-to-add-column-with-default-value-access-2003)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T15:31:10.073

我有这个典型的 Access 函数来向 Access 表添加新字段 + 默认值：。如果该字段在表中不存在，则添加该字段。

```
Public Function addNewField( _
    m_tableName as string, _
    m_fieldName As String, _
    m_fieldType As Long, _      'check syntax of .createField method for values'
    m_fieldLength As Long, _    'check syntax of .createField method for values'
    Optional m_defaultValue As Variant = Null)

Dim myTable As DAO.TableDef
Dim myField As DAO.Field

On Error GoTo addNewField_error

Set myTable = currentDb.TableDefs(m_tableName)
Set myField = myTable.CreateField(m_fieldName, m_fieldType, m_fieldLength)

If Not IsNull(m_defaultValue) Then
    myField.DefaultValue = m_defaultValue
End If

myTable.Fields.Append myField

Set myTable = Nothing
Set myField = Nothing

Exit Function

addNewField_error:
If Err.Number = 3191 Or Err.Number = 3211 Then
    'The field already exists or the table is opened'
    'nothing to do but exit the function'
Else
    debug.print Err.Number & " - " & Error$
End If

End Function 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T15:06:58.750

您不*插入*新的默认值，您需要*更改*现有的默认值。

首先将 Access 切换到一个健全的 SQL 风格，如上面链接的答案，然后你可以说：

```
alter table Tabella alter column Campo Double DEFAULT 0 
```

# php - JQuery $.ajax“异步：假”错误？

> ID：352997
> 
> 赞同：1
> 
> 时间：2008-12-09T14:55:36.730
> 
> 标签：php, javascript, jquery, ajax

感谢您对以下内容的意见/建议

**设想**

HTML 有 PDF 文件昵称，后端有每个昵称的 URL。

链接 URL 始终是`download.php?what=%PDF_Nick%`为了确保 JS 禁用客户端的下载。

对于启用 JS 的客户端，我执行 JQuery AJAX 调用并将链接 URL 重写`download.php?what=%PDF_Nick%`为[http://examplesite.com/requestedPFF.pdf](http://examplesite.com/requestedPFF.pdf)以激活从客户端下载。我设置`"async: false"`允许 AJAX 获取新的 url。

**问题**

AJAX 返回有效的脚本重写 JS url 变量，但`location.href`再次运行到初始 url，创建额外的后端调用

您认为这与忽略`"async: false,"`定义的错误有关，还是我犯的错误而错过了捕获？

先感谢您

# HTML 代码

```
 <a href="/download.php?what=PDF_A" onclick="javascript:download
    ('PDF_A')">Download</a> 
```

# JS代码

```
function download ( what )  {

   var url = "download.php?what="+what;

   $.ajax({
      type: "GET",
      url: "download.php?ajax=true",
      data: "what=" + what
      async: false,
      dataType: "script"
  });

  // if AJAX got the download URL I expect actual download to start:
  location.href = url;
} 
```

# 后端（download.php）代码

```
$myPDF = array();
$myPDF["PDF_A"] = "PDF_A.pdf";
....
$url = "http://examplesite.com/" . $myPDF["PDF_A"];
...
if ( $_GET["ajax"] === "true" ) {
    // overwrite JS url variable
    print('url = "'.$url.'";');
} else {
    header("Location: ". $url );
    header("Connection: close");
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-07T00:19:24.673

您在这里遇到了范围界定问题。JS 代码中的 URL 变量是通过下载函数范围内的 var 关键字声明的。这意味着只有下载函数中的代码才能修改该特定的 url 值。

从 download.php 返回的脚本正在修改全局范围内的 URL 值（在浏览器上，这是“窗口”对象），这与下载函数范围*内*的 url 值不同。

如果您不在 url 变量的声明中使用 'var' 关键字，它将在全局范围内自动创建，并且您的代码将按预期运行。

我同意其他人的观点，你的设计本质上是有缺陷的，但是应该重新审视。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T15:27:47.833

或者您可以使用带有**.responseText**的同步 ajax 调用，如下例所示：

```
var html = $.ajax({
  url: "some.php",
  async: false
}).responseText; 
```

对于您的代码，这意味着：

```
function download ( what )  {
  var url = "download.php?what="+what;

  location.href = $.ajax({
       type: "GET",
       url: "download.php?ajax=true",
       data: "what=" + what
       async: false,
       dataType: "script"
  }).responseText;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-09T15:02:33.470

您是否有理由禁用 AJAX 请求的异步特性？它将锁定浏览器，直到请求完成。你最好使用回调来代替：

```
$.ajax({
  type: "GET",
  url: "download.php?ajax=true",
  data: "what=" + what,
  dataType: "script",
  success: function(msg) {
      location.href = url;
  }
}); 
```***************