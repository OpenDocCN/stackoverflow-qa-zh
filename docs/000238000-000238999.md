# StackOverflow 问答 000238000-000238999

# c# - 替换字符串 C# 中的换行符

> ID：238002
> 
> 赞同：576
> 
> 时间：2008-10-26T13:20:10.757
> 
> 标签：c#, .net, string

如何在 C# 中替换字符串中的换行符？

* * *

## 回答 #1

> 赞同：784
> 
> 时间：2008-10-26T13:38:57.723

使用替换为`Environment.NewLine`

```
myString = myString.Replace(System.Environment.NewLine, "replacement text"); //add a line terminating ; 
```

如其他帖子中所述，如果字符串来自另一个环境（OS），那么您需要替换该特定环境的[新行控制字符](http://en.wikipedia.org/wiki/Newline)实现。

* * *

## 回答 #2

> 赞同：489
> 
> 时间：2011-11-19T18:26:19.407

到目前为止发布的解决方案要么仅替换，要么`Environment.NewLine`在替换字符串包含换行符时失败，因为它们`string.Replace`多次调用。

这是一个使用正则表达式的解决方案，只需一次遍历字符串即可完成所有三个替换。这意味着替换字符串可以安全地包含换行符。

```
string result = Regex.Replace(input, @"\r\n?|\n", replacementString); 
```

* * *

## 回答 #3

> 赞同：179
> 
> 时间：2008-10-26T13:34:46.703

要扩展 The.Anyi.9 的答案，您还应该注意[一般使用的不同类型的换行符](http://en.wikipedia.org/wiki/Newline)。根据您的文件的来源，您可能需要查看确保您抓住所有替代方案......

```
string replaceWith = "";
string removedBreaks = Line.Replace("\r\n", replaceWith).Replace("\n", replaceWith).Replace("\r", replaceWith); 
```

应该让你去...

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2008-10-26T13:32:47.500

当我想为字符串插入换行符时，我会使用 Environment.Newline，但不想从字符串中删除所有换行符。

根据您的平台，您可以有不同类型的换行符，但即使在同一个平台内，也经常使用不同类型的换行符。特别是在处理文件格式和协议时。

```
string ReplaceNewlines(string blockOfText, string replaceWith)
{
    return blockOfText.Replace("\r\n", replaceWith).Replace("\n", replaceWith).Replace("\r", replaceWith);
} 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2008-10-26T13:41:54.317

如果您的代码应该在不同的环境中运行，我会考虑使用`Environment.NewLine`常量，因为它专门`newline`用于特定环境。

```
line = line.Replace(Environment.NewLine, "newLineReplacement"); 
```

但是，如果您从来自另一个系统的文件中获取文本，这可能不是正确的答案，您应该替换为其他系统上使用的任何换行符常量。它通常是`\n`或`\r\n`。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2018-10-13T21:28:05.040

如果您想“清理”新行，使用正则表达式`@"[\r\n]+"`的火焰波特注释是最佳选择。

```
using System;
using System.Text.RegularExpressions;

class MainClass {
  public static void Main (string[] args) {
    string str = "AAA\r\nBBB\r\n\r\n\r\nCCC\r\r\rDDD\n\n\nEEE";

    Console.WriteLine (str.Replace(System.Environment.NewLine, "-"));
    /* Result:
    AAA
    -BBB
    -
    -
    -CCC

    DDD---EEE
    */
    Console.WriteLine (Regex.Replace(str, @"\r\n?|\n", "-"));
    // Result:
    // AAA-BBB---CCC---DDD---EEE

    Console.WriteLine (Regex.Replace(str, @"[\r\n]+", "-"));
    // Result:
    // AAA-BBB-CCC-DDD-EEE
  }
} 
```

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2008-10-26T13:47:15.413

不要忘记 replace 不会在字符串中进行替换，而是返回一个替换了字符的新字符串。以下将删除换行符（而不是替换它们）。如果用其他东西替换它们，我会使用@Brian R. Bondy 的方法，也许包装为扩展方法。请记住在调用 Replace 或提供的扩展方法之前先检查空值。

```
string line = ...

line = line.Replace( "\r", "").Replace( "\n", "" ); 
```

作为扩展方法：

```
public static class StringExtensions
{
   public static string RemoveLineBreaks( this string lines )
   {
      return lines.Replace( "\r", "").Replace( "\n", "" );
   }

   public static string ReplaceLineBreaks( this string lines, string replacement )
   {
      return lines.Replace( "\r\n", replacement )
                  .Replace( "\r", replacement )
                  .Replace( "\n", replacement );
   }
} 
```

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2016-02-19T14:56:05.310

为了确保所有可能的换行方式（Windows、Mac 和 Unix）都被替换，你应该使用：

```
string.Replace("\r\n", "\n").Replace('\r', '\n').Replace('\n', 'replacement'); 
```

并按此顺序，当您找到一些行尾字符组合时，不要进行额外的换行符。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2016-03-31T02:37:11.597

为什么不兼得？

```
string ReplacementString = "";

Regex.Replace(strin.Replace(System.Environment.NewLine, ReplacementString), @"(\r\n?|\n)", ReplacementString); 
```

**注意：**替换`strin`为输入字符串的名称。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2011-08-25T18:58:25.310

我需要`\r\n`用实际的回车和换行替换，并`\t`用实际的选项卡替换。所以我想出了以下内容：

```
public string Transform(string data)
{
    string result = data;
    char cr = (char)13;
    char lf = (char)10;
    char tab = (char)9;

    result = result.Replace("\\r", cr.ToString());
    result = result.Replace("\\n", lf.ToString());
    result = result.Replace("\\t", tab.ToString());

    return result;
} 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2010-10-12T13:28:24.087

```
var answer = Regex.Replace(value, "(\n|\r)+", replacementString); 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2012-09-24T16:20:00.513

由于新行可以由`\n`,`\r`和分隔`\r\n`，首先我们将`\r`and`\r\n`替换为`\n`，然后才拆分数据字符串。

以下几行应该转到该`parseCSV`方法：

```
function parseCSV(data) {
    //alert(data);
    //replace UNIX new lines
    data = data.replace(/\r\n/g, "\n");
    //replace MAC new lines
    data = data.replace(/\r/g, "\n");
    //split into rows
    var rows = data.split("\n");
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-26T13:23:24.963

使用 .Replace() 方法

```
Line.Replace("\n", "whatever you want to replace with"); 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-09-08T10:54:23.027

安全替换换行符的最佳方法是

```
yourString.Replace("\r\n","\n") //handling windows linebreaks
.Replace("\r","\n")             //handling mac linebreaks 
```

这应该产生一个只有 \n （例如换行符）作为换行符的字符串。此代码对于修复混合换行符也很有用。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-02-20T09:23:40.137

[`StringReader`](https://docs.microsoft.com/en-us/dotnet/api/system.io.stringreader)另一种选择是在有问题的字符串上创建一个。在阅读器上，`.ReadLine()`循环执行。然后你有分隔线，不管他们有什么（一致或不一致）分隔符。有了它，您可以随心所欲地进行；一种可能性是使用 a[`StringBuilder`](https://docs.microsoft.com/en-us/dotnet/api/system.text.stringbuilder)并调用`.AppendLine`它。

优点是，您让框架决定什么构成“换行符”。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2022-01-17T06:20:14.413

在 .NET 6 中使用新方法

```
myString = myString.ReplaceLineEndings(""); 
```

文档： [ReplaceLineEndings](https://docs.microsoft.com/en-us/dotnet/api/system.string.replacelineendings)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-12-07T09:05:55.050

```
string s = Regex.Replace(source_string, "\n", "\r\n"); 
```

或者

```
string s = Regex.Replace(source_string, "\r\n", "\n"); 
```

取决于你想走哪条路。

希望它有所帮助。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-06-04T07:36:07.807

如果您只想替换换行符：

```
var input = @"sdfhlu \r\n sdkuidfs\r\ndfgdgfd";
var match = @"[\\ ]+";
var replaceWith = " ";
Console.WriteLine("input: " + input);
var x = Regex.Replace(input.Replace(@"\n", replaceWith).Replace(@"\r", replaceWith), match, replaceWith);
Console.WriteLine("output: " + x); 
```

如果要替换换行符、制表符和空格：

```
var input = @"sdfhlusdkuidfs\r\ndfgdgfd";
var match = @"[\\s]+";
var replaceWith = "";
Console.WriteLine("input: " + input);
var x = Regex.Replace(input, match, replaceWith);
Console.WriteLine("output: " + x); 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-12-06T11:30:51.510

基于@mark-bayers 的回答和更清晰的输出：

```
string result = Regex.Replace(ex.Message, @"(\r\n?|\r?\n)+", "replacement text"); 
```

它删除了`\r\n`, `\n`and`\r`虽然更喜欢更长的一个并将多次出现简化为一个。

# asp.net - 针对 MS Access DB 设置此 asp.net 页面的最快方法。.

> ID：238004
> 
> 赞同：2
> 
> 时间：2008-10-26T13:22:02.203
> 
> 标签：asp.net, ms-access, ado.net

我有一个包含 3 个表的访问数据库。

*   人们
*   礼物
*   人礼物

使用 VS 2008，启动和运行页面的最快方法是什么，它允许我对这些表运行查询并进行基本插入。

我希望将组合框绑定到表中的字段，以便用户可以单击一个人并单击一个礼物，然后他们单击“添加”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T13:32:57.843

最快的方法？[铁速](http://www.ironspeed.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T13:26:46.780

尝试使用 oleDBDataAdapter 和 formview

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T13:53:12.360

```
public interface IOleDbDataGateway
{
    void ExecuteNonQuery(string sql, params object[] args);
    object ExecuteScalar(string sql, params object[] args);
    DataTable FillDataTable(string sql, params object[] args);
}

public class OleDbDataGateway : IOleDbDataGateway
{
    private readonly string connectionString;

    public OleDbDataGateway(string connectionString)
    {
        this.connectionString = connectionString;
    }

    public void ExecuteNonQuery(string sql, params object[] args)
    {
        if (args != null)
        {
            sql = string.Format(sql, args);
        }
        var connection = new OleDbConnection(connectionString);
        var command = new OleDbCommand(sql, connection);
        connection.Open();
        try
        {
            command.ExecuteNonQuery();
        }
        finally
        {
            connection.Close();
        }
    }

    public object ExecuteScalar(string sql, params object[] args)
    {
        if (args != null)
        {
            sql = string.Format(sql, args);
        }
        var connection = new OleDbConnection(connectionString);
        var command = new OleDbCommand(sql, connection);
        connection.Open();
        try
        {
            return command.ExecuteScalar();
        }
        finally
        {
            connection.Close();
        }
    }

    public DataTable FillDataTable(string sql, params object[] args)
    {
        if (args != null)
        {
            sql = string.Format(sql, args);
        }
        var connection = new OleDbConnection(connectionString);
        var adapter = new OleDbDataAdapter(sql, connection);
        var table = new DataTable();
        connection.Open();
        try
        {
            adapter.Fill(table);
        }
        finally
        {
            connection.Close();
        }
        return table;
    }
} 
```

# c++ - std::vector 与 std::list 与 std::slist 的相对性能？

> ID：238008
> 
> 赞同：53
> 
> 时间：2008-10-26T13:24:34.383
> 
> 标签：c++, data-structures, stl, performance, linked-list

对于不需要随机访问列表元素的简单链表，使用`std::list`而不是有任何显着优势（性能或其他方面）`std::vector`吗？如果需要向后遍历，在迭代其元素之前使用`std::slist`和列表会更有效吗？`reverse()`

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-10-26T13:41:22.040

像往常一样，性能问题的最佳答案是为您的用例[分析](https://stackoverflow.com/questions/61278/quick-and-dirty-way-to-profile-your-code)两种实现，看看哪个更快。

一般来说，如果您在数据结构中插入（除了末尾之外），那么`vector`可能会更慢，否则在大多数情况下`vector`，预计性能会比`list`仅针对[数据局部性问题](http://en.wikipedia.org/wiki/Locality_of_reference)更好，这意味着如果两个相邻的元素在数据集在内存中是相邻的，那么下一个元素将已经在处理器的缓存中，并且不必将内存缺页到缓存中。

还要记住，a 的空间开销`vector`是恒定的（3 个指针），而 a 的空间开销`list`是为每个元素支付的，这也减少了可以在任何一个缓存中驻留的完整元素的数量（数据加上开销）时间。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2013-01-25T16:45:23.327

在 C++ 中要考虑的默认数据结构是**Vector**。

考虑以下几点...

**1] 遍历：**
列表节点分散在内存中的任何地方，因此列表遍历会导致***缓存未命中***。但是向量的遍历是平滑的。

**2] 插入和删除：**
当您对 Vector 执行此操作时，平均 50% 的元素必须移动，但缓存非常擅长此操作！但是，对于列表，您需要***遍历*到插入/删除点......**所以再次......缓存未命中！令人惊讶的是，向量也赢得了这个案子！

**3] 存储：**
当您使用列表时，每个元素有 2 个指针（向前和向后），因此列表比向量大得多！向量只需要比实际元素多一点的内存。

你应该有理由不使用向量。

* * *

参考：
我在 Bjarne Stroustrup 的演讲中了解到这一点：[https ://youtu.be/0iWb_qi2-uI?t=2680](https://youtu.be/0iWb_qi2-uI?t=2680)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-26T13:41:22.460

根本没有。List 比 Vector 有优势，但顺序访问不是其中之一——如果这就是你所做的一切，那么向量会更好。

但是.. 添加其他元素的向量比列表更昂贵，尤其是在中间插入时。

了解这些集合是如何实现的：向量是数据的顺序数组，列表是包含数据和指向下一个元素的指针的元素。一旦你理解了这一点，你就会明白为什么列表对插入有利，而对随机访问不利。

（因此，向量的反向迭代与前向迭代完全相同——迭代器每次只是减去数据项的大小，列表仍然必须通过指针跳转到下一项）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-26T13:42:31.787

如果您需要向后遍历，则 slist 不太可能成为您的数据结构。

传统的（双）链表为您在列表中的任何位置提供恒定的插入和删除时间；向量仅在列表末尾提供摊销的常数时间插入和删除。对于向量的插入和删除时间，除了末端以外的任何地方都是线性的。这不是全部。也有恒定的因素。向量是一种更简单的数据结构，其优点和缺点取决于上下文。

理解这一点的最好方法是了解它们是如何实现的。链表的每个元素都有一个 next 和一个 previous 指针。向量具有由索引寻址的元素数组。从中可以看出两者都可以进行高效的前向和后向遍历，而只有一个向量才能提供高效的随机访问。您还可以看到，链表的内存开销是每个元素的，而向量的内存开销是恒定的。您还可以看到为什么两个结构之间的插入时间不同。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-04-02T07:35:37.707

关于该主题的一些严格基准：http: [//baptiste-wicht.com/posts/2012/12/cpp-benchmark-vector-list-deque.html](http://baptiste-wicht.com/posts/2012/12/cpp-benchmark-vector-list-deque.html)

正如其他人所指出的，连续的内存存储意味着 std::vector 对大多数事情都更好。几乎没有充分的理由使用 std::list 除了少量数据（它可以全部放入缓存中）和/或擦除和重新插入频繁的地方。由于缓存和主内存速度（200x）之间的差异以及连续内存访问如何影响缓存使用，复杂性保证与实际性能无关。请参阅 Chandler Carruth (google) 在此处讨论该问题： [https ://www.youtube.com/watch?v=fHNmRkzxHWs](https://www.youtube.com/watch?v=fHNmRkzxHWs)

Mike Acton 的面向数据设计的演讲在这里： [https ://www.youtube.com/watch?v=rX0ItVEVjHc](https://www.youtube.com/watch?v=rX0ItVEVjHc)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-26T15:19:17.863

有关成本的详细信息，请参阅此问题：
[标准容器的复杂性保证是什么](https://stackoverflow.com/questions/181693/what-are-the-complexity-guarantees-of-the-standard-containers)

如果您有一个 slist 并且您现在想以相反的顺序遍历它，为什么不将类型更改为到处列出呢？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-05-14T11:36:42.617

*   std::vector 查找元素的速度比 std::list 快得多
*   对于非常小的数据，std::vector 总是比 std::list 执行得更快
*   std::vector 总是比 std::list 更快地将元素推到后面
*   std::list 处理大元素非常好，特别是排序或插入在前面

**注意**：如果您想了解有关性能的更多信息，我建议您查看[此内容](https://dzone.com/articles/c-benchmark-%E2%80%93-stdvector-vs)

# iphone - 如何在 iPhone 上进行内联汇编？

> ID：238010
> 
> 赞同：30
> 
> 时间：2008-10-26T13:26:17.577
> 
> 标签：iphone, assembly, inline-assembly

它是如何完成的？我需要采取哪些步骤以及需要考虑哪些陷阱和陷阱？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-29T22:56:21.950

[多亏了Apple Devforums](https://devforums.apple.com/)的一些内部帮助，我已经完成了这项工作，如果您是专门的 iPhone 开发人员，您应该注册。

首先是*__asm__()*，而不是普通的*asm()*。

其次，默认情况下，XCode 会生成一个针对 ARM Thumb 指令集编译内联汇编的编译目标，因此无法将*usat*识别为正确的指令。要解决此问题，请在目标上执行“获取信息”。向下滚动到“GCC 4.0 - 代码生成”部分并取消选中“Compile for Thumb”。然后，如果您将 Active SDK 设置为“设备”，则以下代码段将编译得很好

```
inline int asm_saturate_to_255 (int a) {
  int y;
  __asm__("usat %0, #8, %1\n\t" : "=r"(y) : "r"(a));
  return y;
} 
```

自然，现在它不能与 iPhone Simulator 一起使用。但是*TargetConditionals.h*已经定义了你可以使用#ifdef 来反对。即*TARGET_OS_IPHONE*和*TARGET_IPHONE_SIMULATOR*。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-26T13:35:59.057

我写了很多 ARM Cortex-A8 汇编代码。iPhone 上的 CPU 是 ARM11 (afaik)，因此核心指令集是相同的。

你到底在找什么？如果你愿意，我可以给你一些例子。

* * *

编辑：

我刚刚发现在 iPhone 上你必须使用 llvm-gcc 编译器。据我所知，它应该理解 GCC 的内联汇编语法。如果是这样，所有 ARM 内联汇编器教程也可以在 iPhone 上运行。

这是一个非常小的内联汇编函数（在 C 中）。你能告诉我它是否可以在 iphone 上编译和工作吗？如果它有效，我可以咆哮一下如何在 ARM 内联汇编器中做有用的事情，特别是对于 ARMv6 架构和 DSP 扩展。

```
inline int saturate_to_255 (int a)
{
  int y;
  asm ("usat %0, #8, %1\n\t" : "=r"(y) : "r"(a));
  return y;
} 
```

应该相当于：

```
inline int saturate_to_255 (int a)
{
  if (a < 0) a =0;
  if (a > 255) a = 255;
  return a;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-05-27T13:53:28.650

寄存器也可以在 inline asm 中显式使用

```
void foo(void) {
#if TARGET_CPU_ARM64
    __asm ("sub        sp, sp, #0x60");
    __asm ("str        x29, [sp, #0x50]");
#endif
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T13:31:02.293

Thumb 推荐用于不需要大量浮动操作的应用。Thumb 使代码大小更小，并导致更快的代码执行。

所以你应该只为 3D 游戏之类的应用程序关闭 Thumb...

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2021-11-23T07:14:00.667

# 背景

*   现在是 2021 年 -> 其他答案似乎太旧了？</li>
*   大多数 iOS 设备（iPhone 等）是 ARM 64 位：`arm64`

# iPhone 上的内联组装

## asm 关键字

*   GNU/GCC 编译器
    *   标准 C（编译标志：`-ansi`/ `-std`）：使用`__asm__`
    *   GNU 扩展：使用`asm`
*   ARM 编译器：使用`__asm`

## 汇编语法

AFAIK，有很多 asm 语法

*   汇编语法
    *   `AT&T syntax`~= `GNU syntax`~=`UNIX syntax`
    *   `Intel syntax`
    *   `ARM syntax`

这里只关注最常用的`GNU/GCC`语法

### `GNU/UNIX syntax`

#### 基本汇编

```
asm("assembly code");
__asm__("assembly code"); 
```

#### 扩展汇编

```
asm asm-qualifiers ( AssemblerTemplate 
                 : OutputOperands 
                 [ : InputOperands
                 [ : Clobbers ] ]) 
```

* * *

# 我的示例代码

*   环境
    *   开发者
        *   苹果系统
            *   IDE：X代码
                *   编译器：`clang`
    *   跑步
        *   iOS - iPhone
            *   硬件拱门：`ARM64`

## 使用扩展 Asm 为 ARM64 调用 svc 0x80 的内联 asm

*   ObjC 代码中的内联汇编

```
// inline asm code inside iOS ObjC code
__attribute__((always_inline)) long svc_0x80_syscall(int syscall_number, const char * pathname, struct stat * stat_info) {
    register const char * x0_pathname asm ("x0") = pathname; // first arg
    register struct stat * x1_stat_info asm ("x1") = stat_info;  // second arg
    register int x16_syscall_number asm ("x16") = syscall_number; // special syscall number store to x16

    register int x4_ret asm("x4") = -1; // store result

    __asm__ volatile(
         "svc #0x80\n"
         "mov x4, x0\n"
        : "=r"(x4_ret)
        : "r"(x0_pathname), "r"(x1_stat_info), "r"(x16_syscall_number)
//         : "x0", "x1", "x4", "x16"
    );
    return x4_ret;
} 
```

*   调用内联汇编

```
// normal ObjC code
#import <sys/syscall.h>

...
    int openResult = -1;
    struct stat stat_info;
    const char * filePathStr = [filePath UTF8String];
...
  // call inline asm function
    openResult = svc_0x80_syscall(SYS_stat64, filePathStr, &stat_info); 
```

# 文档

*   [GCC-Inline-Assembly-HOWTO (ibiblio.org)](https://www.ibiblio.org/gferg/ldp/GCC-Inline-Assembly-HOWTO.html#s6)
*   [扩展 Asm（使用 GNU 编译器集合 (GCC)）](https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html)
*   [Arm® 64 位架构的过程调用标准](https://developer.arm.com/documentation/ihi0055/latest)
*   [ARM GCC 内联汇编程序手册](http://www.ethernut.de/en/documents/arm-inline-asm.html)
*   [ConvertBasicAsmToExtended - GCC Wiki](https://gcc.gnu.org/wiki/ConvertBasicAsmToExtended)
*   [ios - 通过使用 svc 调用实现 fork() - 爱编程的大狗](https://stackoverflow.com/questions/32985409/fork-implementation-by-using-svc-call/32990553#32990553)
*   [linux - ARM inline asm：退出系统调用并从内存中读取值 - Thinbug](https://stackoverflow.com/questions/37358451/arm-inline-asm-exit-system-call-with-value-read-from-memory/37363860#37363860)

# windows - 从 Linux 调用 windows 批处理文件

> ID：238013
> 
> 赞同：7
> 
> 时间：2008-10-26T13:31:16.583
> 
> 标签：windows, linux

我有一个仅在 Windows 上运行的应用程序和一个启动它的批处理文件。我想从 Linux 调用这个批处理文件，这意味着像 Linux 批处理这样的东西将启动带有参数的 windows 批处理，这反过来运行我的应用程序。

我可以这样做吗？如何？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-26T13:40:01.823

您可以在 windows 框中安装一个 ssh 服务器（Cygwin 有一个），然后从 linux 执行以下操作：

```
ssh user@windows-box c:/path/to/batch.cmd 
```

这应该在 windows 框中启动您的应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T14:51:06.250

最直接的方法可能是在windows box上安装一个ssh服务器。 [Cygwin](http://www.cygwin.com/)包括一个 ssh 服务器。

根据您的时间需求的精确程度，您可能可以在 Windows 框中执行“at”作业，该作业定期（每 5 分钟一次？）运行，如果它看到特定文件存在，则删除该文件。然后您可以使用[Samba](http://www.samba.org/) /smbclient 创建文件。您需要在 Windows 框中打开文件共享才能使其正常工作。

如果 windows 框有一个 web 服务器，你可以编写一个[CGI ，并使用](http://www.w3.org/CGI/)[wget](http://www.gnu.org/software/wget/)或[cURL](http://curl.haxx.se/)触发它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T13:42:17.047

我们的构建过程目前是另一种方式：Windows 服务器使用 plink（[PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)的一部分）在 Linux 服务器上启动东西。您也许可以设置类似的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T13:49:32.180

这可能会导致安全问题。我们的信息安全人员不允许我直接调用任何程序。

更安全的方法是在 Windows 计算机上设置服务器。例如，这可以是一个网络服务器。然后在 PHP/Perl/Python 脚本中调用您的进程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-01-09T02:03:02.203

另请查看允许您在不运行 ssh 服务器的情况下执行 windows 命令/批处理脚本的[winexe 。](http://sourceforge.net/projects/winexe/)

# sql-server - SQL Server 2005/08 中的对等复制

> ID：238029
> 
> 赞同：6
> 
> 时间：2008-10-26T13:44:34.687
> 
> 标签：sql-server, replication

有没有人有使用 SQL Server 2005 或 2008设置[对等复制的经验？](http://msdn.microsoft.com/en-us/library/ms151196.aspx)

具体来说，我感兴趣的是是否考虑了其他选项/替代方案以及最终选择 P2P 复制的原因。

如果您使用过 P2P 复制：

*   您在同步过程中是否遇到任何问题，是否易于监控？*   解决冲突有多容易？*   您是否必须进行架构更改（即替换身份列等）？

或者，如果您考虑了 P2P 复制并选择了不同的选项，为什么要排除它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T15:38:11.977

（免责声明：我是开发人员，而不是 DBA）

我们将 SQL Server 2005 合并复制设置为在两个活动/活动地理上分离的节点之间进行复制，以实现旧系统中的弹性。

不知道是否容易监控；在我的职权范围之外。

它在每个表上创建触发器来执行发布/订阅机制，每个表调用自己的存储过程。

在我们的例子中，它被设置为在节点 0 中使用 1-10 亿身份，在节点 1 中使用 10-20 亿身份以避免身份冲突（而不是为每个表使用 NodeId + EntityId 的复合键，或者将键更改为 GUID，例如）。

我认为复制延迟大约是 15 秒（伦敦和纽约之间通过专用带宽）。

使用它是一个**巨大的痛苦**：

*   一个高薪承包商花了一年的时间来建立它（当然，部分原因是由于 DB 设计的遗留性质）
*   我们内部缺乏具有支持它的专业知识的任何人（我们花了大约 6 个月的时间来学习它的内部 DBA，并且已经继续前进）
*   模式更新现在很**痛苦**。据我了解：
    *   某些更新必须仅在一个节点上执行；然后复制负责弄清楚在其他节点上做什么
    *   必须在两个节点上执行某些更新
    *   数据更新必须仅在一个节点上执行（我认为）
    *   现在所有更新都需要更长的时间来执行 - 从运行 DDL 更改脚本所需的瞬间到大约 30 分钟
*   我不确定，但我认为复制的带宽要求非常高（在 MBit/s 范围内）
*   它将**许多**“噪声”对象（每个表 3 个存储过程，每个表 3 个触发器）引入数据库，使得在对象资源管理器中查找想要处理的项目变得不方便。
*   我们**永远不会**为这个系统设置第三个节点，这主要是基于感知到的困难和它在部署时会引入的额外痛苦。
*   我们现在还缺乏一个反映生产的暂存环境，因为设置起来太痛苦了。
*   轶事：进行设置的 DBA 经常会诅咒他被迫使用的是“MS v1”这一事实。
*   依稀记得：DBA 需要提出几个优先支持票才能直接从 MS 那里获得帮助。

当然 - 所涉及的一些痛苦是由于我们的特定环境以及没有内部人才来支持这种设置。你的旅费可能会改变。

# java - Java HTML 解析

> ID：238036
> 
> 赞同：52
> 
> 时间：2008-10-26T13:57:00.183
> 
> 标签：java, html, parsing, web-scraping

我正在开发一个从网站上抓取数据的应用程序，我想知道我应该如何获取数据。具体来说，我需要包含在许多使用特定 CSS 类的 div 标签中的数据 - 目前（出于测试目的）我只是在检查

```
div class = "classname" 
```

在 HTML 的每一行中 - 这行得通，但我不禁觉得那里有更好的解决方案。

有什么好方法可以让我给一个类一行 HTML 并有一些很好的方法，比如：

```
boolean usesClass(String CSSClassname);
String getText();
String getLink(); 
```

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2011-05-18T09:33:54.947

另一个可能对 HTML 处理有用的库是 jsoup。Jsoup 尝试清理格式错误的 HTML，并允许在 Java 中使用类似标签选择器语法的 jQuery 解析 html。

[http://jsoup.org/](http://jsoup.org/)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-26T14:55:57.303

如前所述，主要问题是 HTML 格式错误，因此必须使用 html 清理器或 HTML-XML 转换器。获得 XML 代码 (XHTML) 后，有很多工具可以处理它。您可以通过一个简单的 SAX 处理程序来获得它，该处理程序只提取您需要的数据，或者任何基于树的方法（DOM、JDOM 等），甚至可以让您修改原始代码。

这是一个示例代码，它使用[HTML 清理器](http://htmlcleaner.sourceforge.net/)获取所有使用某个类的 DIV，并打印出其中的所有 Text 内容。

```
import java.io.IOException;
import java.net.URL;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import org.htmlcleaner.HtmlCleaner;
import org.htmlcleaner.TagNode;

/**
 * @author Fernando Miguélez Palomo <fernandoDOTmiguelezATgmailDOTcom>
 */
public class TestHtmlParse
{
    static final String className = "tags";
    static final String url = "http://www.stackoverflow.com";

    TagNode rootNode;

    public TestHtmlParse(URL htmlPage) throws IOException
    {
        HtmlCleaner cleaner = new HtmlCleaner();
        rootNode = cleaner.clean(htmlPage);
    }

    List getDivsByClass(String CSSClassname)
    {
        List divList = new ArrayList();

        TagNode divElements[] = rootNode.getElementsByName("div", true);
        for (int i = 0; divElements != null && i < divElements.length; i++)
        {
            String classType = divElements[i].getAttributeByName("class");
            if (classType != null && classType.equals(CSSClassname))
            {
                divList.add(divElements[i]);
            }
        }

        return divList;
    }

    public static void main(String[] args)
    {
        try
        {
            TestHtmlParse thp = new TestHtmlParse(new URL(url));

            List divs = thp.getDivsByClass(className);
            System.out.println("*** Text of DIVs with class '"+className+"' at '"+url+"' ***");
            for (Iterator iterator = divs.iterator(); iterator.hasNext();)
            {
                TagNode divElement = (TagNode) iterator.next();
                System.out.println("Text child nodes of DIV: " + divElement.getText().toString());
            }
        }
        catch(Exception e)
        {
            e.printStackTrace();
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-26T16:06:03.697

几年前，我出于同样的目的使用了 JTidy：

[http://jtidy.sourceforge.net/](http://jtidy.sourceforge.net/)

“JTidy 是 HTML Tidy 的 Java 端口，是一个 HTML 语法检查器和漂亮的打印机。像它的非 Java 表亲一样，JTidy 可以用作清理格式错误和错误 HTML 的工具。此外，JTidy 提供了一个 DOM 接口到正在处理的文档，这有效地使您能够将 JTidy 用作真实世界 HTML 的 DOM 解析器。

JTidy 是由 Andy Quick 编写的，后来他辞去了维护者的职位。现在 JTidy 由一群志愿者维护。

有关 JTidy 的更多信息，请参见 JTidy SourceForge 项目页面。”

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-26T14:16:42.437

您可能会对[TagSoup](http://home.ccil.org/~cowan/XML/tagsoup/ "标签汤")感兴趣，这是一个能够处理格式错误的 HTML 的 Java HTML 解析器。XML 解析器只能在格式良好的 XHTML 上工作。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-26T14:23:12.173

HTMLParser 项目 ( [http://htmlparser.sourceforge.net/](http://htmlparser.sourceforge.net/) ) 可能是一种可能性。它在处理格式错误的 HTML 方面似乎相当不错。以下代码段应该可以满足您的需要：

```
Parser parser = new Parser(htmlInput);
CssSelectorNodeFilter cssFilter = 
    new CssSelectorNodeFilter("DIV.targetClassName");
NodeList nodes = parser.parse(cssFilter); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-01-21T18:36:15.027

杰里科：http: [//jericho.htmlparser.net/docs/index.html](http://jericho.htmlparser.net/docs/index.html)

易于使用，支持格式不正确的 HTML，示例很多。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-26T19:16:21.550

HTMLUnit 可能会有所帮助。它也做了很多事情。

[http://htmlunit.sourceforge.net/](http://htmlunit.sourceforge.net/) [1](http://htmlunit.sourceforge.net/)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-01-08T17:37:55.157

让我们不要忘记[Jerry](http://jodd.org/doc/jerry/index.html)，它的 jQuery in java：一个快速简洁的 Java 库，简化了 HTML 文档的解析、遍历和操作；包括 css3 选择器的使用。

例子：

```
Jerry doc = jerry(html);
doc.$("div#jodd p.neat").css("color", "red").addClass("ohmy"); 
```

例子：

```
doc.form("#myform", new JerryFormHandler() {
    public void onForm(Jerry form, Map<String, String[]> parameters) {
        // process form and parameters
    }
}); 
```

当然，这些只是一些简单的示例，可以让您感受一下它的样子。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-08-19T00:13:16.177

该[`nu.validator`](http://about.validator.nu/htmlparser/)项目是一个出色的高性能 HTML 解析器，在正确性方面不会偷工减料。

> Validator.nu HTML Parser 是 HTML5 解析算法的 Java 实现。该解析器旨在作为 XML 解析器的直接替代品，在已经使用 XML 解析器支持 XHTML 1.x 内容并使用 SAX、DOM 或 XOM 与解析器交互的应用程序中工作。为希望执行自己的 IO 并通过脚本支持 document.write() 的应用程序提供了低级功能。解析器核心在 Google Web Toolkit 上编译，可以自动翻译成 C++。（C++ 翻译功能目前用于移植解析器以在 Gecko 中使用。）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-10-04T15:54:20.710

您还可以使用[XWiki HTML Cleaner](http://extensions.xwiki.org/xwiki/bin/view/Extension/XML+Module)：

它使用[HTMLCleaner](http://htmlcleaner.sourceforge.net)并对其进行扩展以生成有效的 XHTML 1.1 内容。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-26T14:01:36.413

如果您的 HTML 格式正确，您可以轻松地使用 XML 解析器来为您完成这项工作……如果您只是阅读，[SAX](http://en.wikipedia.org/wiki/SAX)将是理想的选择。

# deployment - 为发布的构建保存哪些工件？

> ID：238046
> 
> 赞同：2
> 
> 时间：2008-10-26T14:06:31.193
> 
> 标签：deployment, build-process

所以，我现在知道[要从 nightly builds 中保存什么](https://stackoverflow.com/questions/230595/what-artifacts-to-save-for-a-nightly-build)。当我给顾客东西时怎么办？

例如，我可能想保存调试信息（例如 PDB）。

还有什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T14:19:30.997

我们用：

*   安装人员
*   二进制文件
*   数据库
*   源文件的标签
*   任何其他可能不在 svn 中的源文件 - 例如 config.status
*   构建日志

你让我怀疑我是否遗漏了什么重要的东西

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T14:26:32.447

*   编译器和库版本信息（它可能不是构建日志的一部分）。其他人提到了整个二进制文件。
*   链接器映射文件（它有时可以帮助远程调试问题）。
*   未剥离的可执行文件（如果在 Unix 系统上，您在将其提供给客户端之前将其剥离为可执行文件）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-07T11:52:03.730

对于 SDK 版本，我们确实包括：

*   库的 PDB 和 XML（与示例的最新快照一起打包）
*   来自 SVN 的源打包快照（只是因为我们可以）
*   链接到在线文档（文档是从源自动生成的）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T14:12:34.270

默认情况下不一定需要生成跟踪消息，但启用它们的可能性非常有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T14:50:16.487

从在构建上运行的 ATP 生成的结果和信息（可能作为构建过程的一部分）。

# sql-server - 将 SQL Server 2008 地理类型与 nHibernate 的 CreateSQLQuery 一起使用

> ID：238050
> 
> 赞同：2
> 
> 时间：2008-10-26T14:09:40.563
> 
> 标签：sql-server, nhibernate

我正在尝试使用 nHibernate (2.0.1GA) 发出 SQL 更新语句，如下所示：

```
sqlstring = string.Format("set nocount on;update myusers set geo=geography::Point({0}, {1}, 4326) where userid={2};", mlat, mlong, userid);
_session.CreateSQLQuery(sqlstring).ExecuteUpdate(); 
```

但是我收到以下错误：'geography@p0' 不是可识别的内置函数名称。

我以为 CreateSQLQuery 只会传递我给它的 SQL 并执行它……我猜不是。关于如何在 nHibernate 的上下文中做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T13:39:16.187

我很确定我可以告诉你发生了什么，但我不知道是否有解决办法。

我认为问题在于 NHibernate 使用 ':' 字符来创建命名参数。你的表情变成了：

```
set nocount on;update myusers set geo=geography@p0({0}, {1}, 4326) where userid={2}; 
```

@p0 将是一个 SQL 变量。不幸的是，我找不到任何转义冒号的文档，因此它们不被视为命名参数。

如果存在转义字符（我对 NHibernate 源的快速浏览没有找到；命名参数在 NHibernate.Engine.Query.ParameterParser 中处理，如果您想花更多时间搜索），那么您可以使用它。

其他解决方案：

*   将转义字符添加到源。然后，您可以使用 NHibernate 的修改版本。如果你这样做，你应该将你的补丁提交给团队，这样它就可以包含在真实的东西中，并且你不必维护源代码的修改版本（不好玩）。
*   在您的数据库中创建一个用户定义的函数，该函数返回一个 geography::Point，然后调用您的函数而不是标准 SQL 函数。这似乎是最快/最简单的启动和运行方式，但也有点像创可贴。
*   [看看NHibernate Spatial](http://nhforge.org/wikis/spatial/default.aspx)中是否有一些东西可以让您以编程方式添加 geography::Point() [或编辑该项目的代码以添加一个并将补丁提交给该团队]。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T02:25:22.180

“{whatever} 不是一个公认的内置函数名”是一条 SQL Server 错误消息，不确定 Hibernate 在那里做了什么，但 SQL Server 是抱怨它的人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-06T12:45:18.173

有一个从 varchar 到 Point 的隐式转换。

使用 NHibernate 将地理参数设置为其字符串表示形式

使用命名参数定义 SQL 查询模板`loc`：

```
const string Query = @"SELECT   {location.*}
FROM     {location}
WHERE    {location}.STDistance(:loc) is not null
ORDER BY {location}.STDistance(:loc)"; 
```

将参数设置为 的字符串表示形式`Point`：

```
return session
                .CreateSQLQuery(Query)
                .AddEntity("location", typeof (Location))
                .SetString("loc", "Point (53.39006999999999 -3.0084007)")
                .SetMaxResults(1)
                .UniqueResult<Location>(); 
```

这是一个选择。但我看不出为什么它不适用于插入或更新。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-04-26T14:33:07.233

在@Chris 的回答之后，这里有一个复制和粘贴解决方案：

```
CREATE FUNCTION GetPoint 
(
    @lat float,
    @lng float,
    @srid int
)
RETURNS geography
AS
BEGIN

declare @point geography = geography::Point(@lat, @lng, @srid);

RETURN @point

END
GO 
```

你做的

```
dbo.GetPoint(@Latitude, @Longitude, 4326) 
```

代替

```
geography::Point(@Latitude, @Longitude, 4326); 
```

NH很高兴

# iphone - iPhone 或 iPod Touch 可以与同一房间内的其他设备通信吗？

> ID：238056
> 
> 赞同：6
> 
> 时间：2008-10-26T14:16:59.423
> 
> 标签：iphone, cocoa-touch, social-networking, ipod-touch

我是为 iPhone 和 iPod touch 开发应用程序的新手。是否可以通过使用 WiFi 甚至 iPhone 上的蓝牙在同一房间内的 2 台设备之间直接通信？

我看过一个消防应用程序的演示，其中一部 iPhone 在彼此靠近时“点亮”另一部 iPhone。这是如何实现的？

所有这一切的重点是，我正在探索开发一款可以与其他人在同一个房间里玩的游戏的选择。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-26T14:23:59.753

iPhone 支持基于 Bonjour 的服务发现，一些应用程序利用这一点来做一些事情，比如与同一网络上的 PC 同步。探索 iPhone SDK 中的示例和指南。WiTap 和 BonjourWeb 是很好的例子。NSNetServices 和 CFNetServices 是您将为 Bonjour 处理的 API

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-02-02T13:07:49.607

iPhone-iPhone 通信也可以使用[GameKit](http://developer.apple.com/iphone/library/documentation/NetworkingInternet/Conceptual/GameKit_Guide/GameKitConcepts/GameKitConcepts.html#//apple_ref/doc/uid/TP40008304-CH100-SW1)通过蓝牙完成。

# php - 在 PHP 中从 SQL 格式化时间戳的最简单方法是什么？

> ID：238071
> 
> 赞同：10
> 
> 时间：2008-10-26T14:30:22.877
> 
> 标签：php, mysql, formatting, timestamp

完成下面的 PHP 代码以使输出采用用户友好的格式（例如，“2006 年 10 月 27 日”）的最简单、最快的方法是什么？

```
$result = mysql_query("SELECT my_timestamp FROM some_table WHERE id=42", $DB_CONN);
$row = mysql_fetch_array($result);
$formatted_date = ???($row['my_timestamp']);
echo $formatted_date; 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-26T14:34:35.613

您可以使用 MySQL 为您执行此操作，

```
$result = mysql_query("SELECT DATE_FORMAT(my_timestamp, '%M %d, %Y) AS my_timestamp FROM some_table WHERE id=42", $DB_CONN);
$row = mysql_fetch_array($result);
$formatted_date = $row['my_timestamp'];
echo $formatted_date; 
```

或者使用 PHP，

```
$result = mysql_query("SELECT my_timestamp FROM some_table WHERE id=42", $DB_CONN);
$row = mysql_fetch_array($result);
$formatted_date = strftime('%B %d, %y', $row['my_timestamp']);
echo $formatted_date; 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-26T16:05:18.443

我倾向于在 SQL 中进行日期格式化，例如[Aron](https://stackoverflow.com/users/11568/aron)的[回答](https://stackoverflow.com/questions/238071/what-is-the-simplest-way-to-format-a-timestamp-from-sql-in-php#238077)。虽然对于 PHP 日期，我更喜欢使用[DateTime](http://www.php.net/manual/en/function.date-create.php)对象 (PHP5+) 而不是[date](http://www.php.net/manual/en/function.date.php)：

```
$timestamp = new DateTime($row['my_timestamp']);
echo $timestamp->format('F j, Y') . '<br />';
echo $timestamp->format('F j, Y g:ia'); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T14:35:32.413

你想要[date()](http://www.php.net/date)函数。

如果您有 DATE 或 DATETIME 列，则可以使用 SELECT UNIX_TIMESTAMP(mycolumn) AS mycolumn 将其转换为 unix 时间戳以供日期函数使用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-26T16:21:18.237

您绝对应该使用 DateTime 类（或任何家庭种植的等效类），而不是使用日期函数，而不是使用时间戳：

*   对于 1970 年之前的日期，时间戳在所有环境中都无法正常工作 - 如果您处理生日，您所依赖的代码可能会在某些服务器上中断
*   strftime 的使用也要非常小心，它看起来是一个不错的函数，但它非常不可靠，因为它依赖于进程范围的 setlocale。这意味着如果您的服务器是一个 Windows 机器，那么每个处理器都有一个进程，然后其余的都是多线程的 - 换句话说，一个脚本中的一个 setlocale 会影响同一处理器上的其他脚本 - 非常讨厌！

归根结底，不要依赖时间戳，除非您在纯英语环境中，并且只处理 1970 年到 2032 年之间的日期......！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T13:51:18.120

如果您在该日期字段上索引了表，并且在调用中使用了 mysql 数据格式函数..（即 .. SELECT DATE_FORMAT(my_timestamp, '%M %d, %Y) AS my_time ）它将破坏您的索引。要记住的事情。我们已经看到从我们的 sql 语句中删除所有功能并让 php 处理这一切的速度显着提高。格式化日期和简单数学等功能

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T14:32:53.417

我用：

date("F j, Y", strtotime($row['my_timestamp']))

或者您可以将 SELECT 更改为： DATE_FORMAT(field,'%d %M, %Y') as datetime

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-26T14:52:29.620

你有一个选择。您可以使用 PHP 中的[date()](http://us2.php.net/date)函数并处理 MySQL 的输出，或者您可以使用 MySQL 中的[date_format()](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_date-format)函数并让它返回一个格式化的字符串开头。

根据我的经验，你使用哪个并不重要，但要保持一致。它们具有不同的格式参数，因此如果您在给定的应用程序中同时使用这两种参数，您将花费大量时间来尝试记住“W”是否为您提供了一周中的某一天或一年中的一周的名称。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-27T14:07:19.523

让数据库为您进行格式化。它不太容易出错，因为您没有读取字符串并对其进行转换。相反，数据库正在从其本机格式转换为字符串。

# bash - 如何在 shell 脚本中添加进度条？

> ID：238073
> 
> 赞同：496
> 
> 时间：2008-10-26T14:32:05.993
> 
> 标签：bash, shell, zsh

当在 bash 或 *NIX 中的任何其他 shell 中编写脚本时，在运行需要几秒钟以上的命令时，需要一个进度条。

例如，复制一个大文件，打开一个大 tar 文件。

您推荐哪些方式向 shell 脚本添加进度条？

* * *

## 回答 #1

> 赞同：766
> 
> 时间：2008-10-26T14:47:53.280

您可以通过覆盖一行来实现这一点。用于`\r`返回行首而不写入`\n`终端。

完成后写下`\n`以推进该行。

用于`echo -ne`：

1.  不打印`\n`和
2.  识别转义序列，如`\r`.

这是一个演示：

```
echo -ne '#####                     (33%)\r'
sleep 1
echo -ne '#############             (66%)\r'
sleep 1
echo -ne '#######################   (100%)\r'
echo -ne '\n' 
```

在下面的评论中，puk 提到如果您从长行开始然后想写短行，则此“失败”：在这种情况下，您需要覆盖长行的长度（例如，使用空格）。

* * *

## 回答 #2

> 赞同：106
> 
> 时间：2010-07-25T20:12:20.817

您可能还对[如何做微调器](http://mywiki.wooledge.org/BashFAQ/034)感兴趣：

## 我可以在 Bash 中做一个微调器吗？

> 当然！
> 
> ```
> i=1
> sp="/-\|"
> echo -n ' '
> while true
> do
>     printf "\b${sp:i++%${#sp}:1}"
> done 
> ```
> 
> 每次循环迭代时，它都会显示 sp 字符串中的下一个字符，并在到达末尾时回绕。（i 是要显示的当前字符的位置，${#sp} 是 sp 字符串的长度）。
> 
> \b 字符串替换为“退格”字符。或者，您可以使用 \r 回到行首。
> 
> 如果你想让它慢下来，在循环中放置一个 sleep 命令（在 printf 之后）。
> 
> POSIX 等价物是：
> 
> ```
> sp='/-\|'
> printf ' '
> while true; do
>     printf '\b%.1s' "$sp"
>     sp=${sp#?}${sp%???}
> done 
> ```
> 
> 如果您已经有一个执行大量工作的循环，则可以在每次迭代开始时调用以下函数来更新微调器：
> 
> ```
> sp="/-\|"
> sc=0
> spin() {
>    printf "\b${sp:sc++:1}"
>    ((sc==${#sp})) && sc=0
> }
> endspin() {
>    printf "\r%s\n" "$@"
> }
> 
> until work_done; do
>    spin
>    some_work ...
> done
> endspin 
> ```

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2015-01-20T12:05:57.323

得到了我前几天写的一个简单的进度条功能：

```
#!/bin/bash
# 1\. Create ProgressBar function
# 1.1 Input is currentState($1) and totalState($2)
function ProgressBar {
# Process data
    let _progress=(${1}*100/${2}*100)/100
    let _done=(${_progress}*4)/10
    let _left=40-$_done
# Build progressbar string lengths
    _fill=$(printf "%${_done}s")
    _empty=$(printf "%${_left}s")

# 1.2 Build progressbar strings and print the ProgressBar line
# 1.2.1 Output example:                           
# 1.2.1.1 Progress : [########################################] 100%
printf "\rProgress : [${_fill// /#}${_empty// /-}] ${_progress}%%"

}

# Variables
_start=1

# This accounts as the "totalState" variable for the ProgressBar function
_end=100

# Proof of concept
for number in $(seq ${_start} ${_end})
do
    sleep 0.1
    ProgressBar ${number} ${_end}
done
printf '\nFinished!\n' 
```

或者从
[https://github.com/fearside/ProgressBar/获取它](https://github.com/fearside/ProgressBar/)

* * *

## 回答 #4

> 赞同：55
> 
> 时间：2011-07-28T17:35:46.257

使用 Linux 命令[`pv`](https://man7.org/linux/man-pages/man1/pv.1.html)。

如果它在管道的中间，它不知道大小，但它给出了速度和总数，从那里你可以计算出它应该花费多长时间并获得反馈，这样你就知道它没有挂起。

* * *

## 回答 #5

> 赞同：49
> 
> 时间：2008-10-26T15:18:26.010

一些帖子显示了如何显示命令的进度。为了计算它，你需要看看你进步了多少。在 BSD 系统上，一些命令，例如 dd(1)，接受一个`SIGINFO`信号，并报告它们的进度。在 Linux 系统上，一些命令的响应与`SIGUSR1`. 如果此工具可用，您可以通过管道传输您的输入`dd`以监控处理的字节数。

或者，您可以使用[`lsof`](http://en.wikipedia.org/wiki/Lsof)获取文件读取指针的偏移量，从而计算进度。我编写了一个名为[pmonitor](https://github.com/dspinellis/pmonitor)的命令，它显示处理指定进程或文件的进度。有了它，您可以执行以下操作。

```
$ pmonitor -c gzip
/home/dds/data/mysql-2015-04-01.sql.gz 58.06% 
```

[我的博客](http://www.spinellis.gr/blog/20081027)（“Monitor Process Progress on Unix”）上出现了早期版本的 Linux 和 FreeBSD shell 脚本。

* * *

## 回答 #6

> 赞同：45
> 
> 时间：2016-10-06T14:17:54.930

我正在寻找比所选答案更性感的东西，我自己的脚本也是如此。

### 预览

[![progress-bar.sh 在行动](https://i.stack.imgur.com/ghAUC.gif)](https://i.stack.imgur.com/ghAUC.gif)

### 来源

我把它放在[github上`progress-bar.sh`](https://github.com/edouard-lopez/progress-bar.sh)

```
progress-bar() {
  local duration=${1}

    already_done() { for ((done=0; done<$elapsed; done++)); do printf "▇"; done }
    remaining() { for ((remain=$elapsed; remain<$duration; remain++)); do printf " "; done }
    percentage() { printf "| %s%%" $(( (($elapsed)*100)/($duration)*100/100 )); }
    clean_line() { printf "\r"; }

  for (( elapsed=1; elapsed<=$duration; elapsed++ )); do
      already_done; remaining; percentage
      sleep 1
      clean_line
  done
  clean_line
} 
```

### 用法

```
 progress-bar 100 
```

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2016-12-01T01:21:15.500

还没有看到任何类似的东西，这里的所有自定义功能似乎都只专注于渲染，所以......我非常简单的符合 POSIX 标准的解决方案在下面逐步解释，因为这个问题并非微不足道。

## TL;博士

渲染进度条非常简单。估计应该渲染多少是另一回事。这是渲染（动画）进度条的方法 - 您可以将此示例复制并粘贴到文件并运行它：

```
#!/bin/sh

BAR='####################'   # this is full bar, e.g. 20 chars

for i in {1..20}; do
    echo -ne "\r${BAR:0:$i}" # print $i chars of $BAR from 0 position
    sleep .1                 # wait 100ms between "frames"
done 
```

*   `{1..20}`- 值从 1 到 20
*   `echo`- 打印到终端（即到`stdout`）
*   `echo -n`- 最后打印不换行
*   `echo -e`- 打印时解释特殊字符
*   `"\r"`- 回车，返回行首的特殊字符

您可以让它以任何速度渲染任何内容，因此这种方法非常通用，例如，经常用于可视化愚蠢电影中的“黑客行为”，不是开玩笑。

## 完整答案（从零到工作示例）

问题的核心是如何确定`$i`值，即显示多少进度条。在上面的示例中，我只是让它在`for`循环中递增以说明原理，但现实生活中的应用程序将使用无限循环并`$i`在每次迭代时计算变量。为了进行上述计算，它需要以下成分：

1.  有多少工作要做
2.  到目前为止已经完成了多少工作

如果`cp`它需要源文件的大小和目标文件的大小：

```
#!/bin/sh

src="/path/to/source/file"
tgt="/path/to/target/file"

cp "$src" "$tgt" &                     # the & forks the `cp` process so the rest
                                       # of the code runs without waiting (async)

BAR='####################'

src_size=$(stat -c%s "$src")           # how much there is to do

while true; do
    tgt_size=$(stat -c%s "$tgt")       # how much has been done so far
    i=$(( $tgt_size * 20 / $src_size ))
    echo -ne "\r${BAR:0:$i}"
    if [ $tgt_size == $src_size ]; then
        echo ""                        # add a new line at the end
        break;                         # break the loop
    fi
    sleep .1
done 
```

*   `foo=$(bar)`-`bar`在子进程中运行并将其保存`stdout`到`$foo`
*   `stat`- 打印文件统计到`stdout`
*   `stat -c`- 打印一个格式化的值
*   `%s`- 总大小的格式

在文件解包等操作的情况下，计算源大小会稍微困难一些，但仍然像获取未压缩文件的大小一样容易：

```
#!/bin/sh
src_size=$(gzip -l "$src" | tail -n1 | tr -s ' ' | cut -d' ' -f3) 
```

*   `gzip -l`- 打印有关 zip 存档的信息
*   `tail -n1`- 从底部开始使用 1 行
*   `tr -s ' '`- 将多个空格转换为一个（“挤压”它们）
*   `cut -d' ' -f3`- 剪切第三个空格分隔的字段（列）

这是我之前提到的问题的实质。这种解决方案越来越不通用。实际进度的所有计算都与您尝试可视化的域紧密相关，它是单个文件操作、计时器倒计时、目录中文件数量的增加、对多个文件的操作等等，因此，它不能重复使用。唯一可重用的部分是进度条渲染。要重用它，您需要将其抽象并保存在文件中（例如`/usr/lib/progress_bar.sh`），然后定义计算特定于您的域的输入值的函数。这就是通用代码的样子（我也制作了`$BAR`动态代码，因为人们要求它，其余的现在应该很清楚了）：

```
#!/bin/sh

BAR_length=50
BAR_character='#'
BAR=$(printf %${BAR_length}s | tr ' ' $BAR_character)

work_todo=$(get_work_todo)             # how much there is to do

while true; do
    work_done=$(get_work_done)         # how much has been done so far
    i=$(( $work_done * $BAR_length / $work_todo ))
    echo -ne "\r${BAR:0:$i}"
    if [ $work_done == $work_todo ]; then
        echo ""
        break;
    fi
    sleep .1
done 
```

*   `printf`- 用于以给定格式打印内容的内置程序
*   `printf %50s`- 只打印 50 个空格
*   `tr ' ' '#'`- 将每个空间翻译成井号

这就是你如何使用它：

```
#!/bin/sh

src="/path/to/source/file"
tgt="/path/to/target/file"

function get_work_todo() {
    echo $(stat -c%s "$src")
}

function get_work_done() {
    [ -e "$tgt" ] &&                   # if target file exists
        echo $(stat -c%s "$tgt") ||    # echo its size, else
        echo 0                         # echo zero
}

cp "$src" "$tgt" &                     # copy in the background

source /usr/lib/progress_bar.sh        # execute the progress bar 
```

显然，您可以将其包装在一个函数中，重写以使用管道流，获取分叉的进程 ID`$!`并将其传递给它，`progress_bar.sh`以便它可以*猜测*如何计算要完成的工作和完成的工作，无论您的毒药是什么。

## 旁注

我经常被问到这两个问题：

1.  `${}`: 在上面的例子中我使用`${foo:A:B}`. 这种语法的技术术语是*Parameter Expansion*，一种内置的 shell 功能，允许操作变量（参数），例如修剪字符串`:`但也可以做其他事情 - 它不会产生子 shell。我能想到的参数扩展最突出的描述（不完全兼容 POSIX，但可以让读者很好地理解这个概念）在`man bash`页面中。
2.  `$()`: 在上面的例子中我使用`foo=$(bar)`. *它在子进程（又名Subshel​​l* ）中生成一个单独的 shell，在其中运行`bar`命令并将其标准输出分配给一个`$foo`变量。它与*Process Substitution不同，它与**管道*( )完全不同`|`。最重要的是，它有效。有人说这应该避免，因为它很慢。我认为这在这里“没问题”，因为无论这段代码试图可视化的时间都足够长，以至于需要一个进度条。换句话说，子壳不是瓶颈。调用 subshel​​l 也让我不必解释为什么`return`不是大多数人认为的那样，什么是*退出状态*以及为什么从 shell 中的函数传递值并不是 shell 函数通常擅长的。要了解有关所有内容的更多信息，我再次强烈推荐该`man bash`页面。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2010-08-02T14:15:23.667

[GNU tar](http://www.gnu.org/software/automake/manual/tar/checkpoints.html#SEC47)有一个有用的选项，它提供了一个简单的进度条功能。

(...) 另一个可用的检查点操作是“点”（或“.”）。它指示 tar 在标准列表流上打印一个点，例如：

```
$ tar -c --checkpoint=1000 --checkpoint-action=dot /var
... 
```

可以通过以下方式获得相同的效果：

```
$ tar -c --checkpoint=.1000 /var 
```

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2017-07-19T08:12:30.043

我也想贡献我[自己的进度条](https://ownyourbits.com/2017/07/16/a-progress-bar-for-the-shell/)

[它通过使用Half unicode块](https://en.wikipedia.org/wiki/Block_Elements#Character_table)来实现子字符精度

[![在此处输入图像描述](https://i.stack.imgur.com/pDY2q.gif)](https://i.stack.imgur.com/pDY2q.gif)

包含代码

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2018-12-04T15:49:39.343

## APT 风格的进度条（不破坏正常输出）

[![在此处输入图像描述](https://i.stack.imgur.com/xUd8n.gif)](https://i.stack.imgur.com/xUd8n.gif)

编辑：有关更新版本，请查看我的[github 页面](https://github.com/pollev/bash_progress_bar)

我对这个问题的回答不满意。我个人一直在寻找的是 APT 所见的精美进度条。

我查看了 APT 的 C 源代码，并决定为 bash 编写我自己的等价物。

**这个进度条将很好地留在终端的底部，并且不会干扰发送到终端的任何输出。**

请注意，该栏目前固定为 100 个字符宽。如果你想把它缩放到终端的大小，这也很容易完成（我的 github 页面上的更新版本很好地处理了这个）。

我将在这里发布我的脚本。使用示例：

```
source ./progress_bar.sh
echo "This is some output"
setup_scroll_area
sleep 1
echo "This is some output 2"
draw_progress_bar 10
sleep 1
echo "This is some output 3"
draw_progress_bar 50
sleep 1
echo "This is some output 4"
draw_progress_bar 90
sleep 1
echo "This is some output 5"
destroy_scroll_area 
```

脚本（我强烈推荐我的 github 上的版本）：

```
#!/bin/bash

# This code was inspired by the open source C code of the APT progress bar
# http://bazaar.launchpad.net/~ubuntu-branches/ubuntu/trusty/apt/trusty/view/head:/apt-pkg/install-progress.cc#L233

#
# Usage:
# Source this script
# setup_scroll_area
# draw_progress_bar 10
# draw_progress_bar 90
# destroy_scroll_area
#

CODE_SAVE_CURSOR="\033[s"
CODE_RESTORE_CURSOR="\033[u"
CODE_CURSOR_IN_SCROLL_AREA="\033[1A"
COLOR_FG="\e[30m"
COLOR_BG="\e[42m"
RESTORE_FG="\e[39m"
RESTORE_BG="\e[49m"

function setup_scroll_area() {
    lines=$(tput lines)
    let lines=$lines-1
    # Scroll down a bit to avoid visual glitch when the screen area shrinks by one row
    echo -en "\n"

    # Save cursor
    echo -en "$CODE_SAVE_CURSOR"
    # Set scroll region (this will place the cursor in the top left)
    echo -en "\033[0;${lines}r"

    # Restore cursor but ensure its inside the scrolling area
    echo -en "$CODE_RESTORE_CURSOR"
    echo -en "$CODE_CURSOR_IN_SCROLL_AREA"

    # Start empty progress bar
    draw_progress_bar 0
}

function destroy_scroll_area() {
    lines=$(tput lines)
    # Save cursor
    echo -en "$CODE_SAVE_CURSOR"
    # Set scroll region (this will place the cursor in the top left)
    echo -en "\033[0;${lines}r"

    # Restore cursor but ensure its inside the scrolling area
    echo -en "$CODE_RESTORE_CURSOR"
    echo -en "$CODE_CURSOR_IN_SCROLL_AREA"

    # We are done so clear the scroll bar
    clear_progress_bar

    # Scroll down a bit to avoid visual glitch when the screen area grows by one row
    echo -en "\n\n"
}

function draw_progress_bar() {
    percentage=$1
    lines=$(tput lines)
    let lines=$lines
    # Save cursor
    echo -en "$CODE_SAVE_CURSOR"

    # Move cursor position to last row
    echo -en "\033[${lines};0f"

    # Clear progress bar
    tput el

    # Draw progress bar
    print_bar_text $percentage

    # Restore cursor position
    echo -en "$CODE_RESTORE_CURSOR"
}

function clear_progress_bar() {
    lines=$(tput lines)
    let lines=$lines
    # Save cursor
    echo -en "$CODE_SAVE_CURSOR"

    # Move cursor position to last row
    echo -en "\033[${lines};0f"

    # clear progress bar
    tput el

    # Restore cursor position
    echo -en "$CODE_RESTORE_CURSOR"
}

function print_bar_text() {
    local percentage=$1

    # Prepare progress bar
    let remainder=100-$percentage
    progress_bar=$(echo -ne "["; echo -en "${COLOR_FG}${COLOR_BG}"; printf_new "#" $percentage; echo -en "${RESTORE_FG}${RESTORE_BG}"; printf_new "." $remainder; echo -ne "]");

    # Print progress bar
    if [ $1 -gt 99 ]
    then
        echo -ne "${progress_bar}"
    else
        echo -ne "${progress_bar}"
    fi
}

printf_new() {
    str=$1
    num=$2
    v=$(printf "%-${num}s" "$str")
    echo -ne "${v// /$str}"
} 
```

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2010-07-25T20:07:26.520

使用 pipeview ( pv ) 实用程序在我的系统上工作的更简单的方法。

```
srcdir=$1
outfile=$2

tar -Ocf - $srcdir | pv -i 1 -w 50 -berps `du -bs $srcdir | awk '{print $1}'` | 7za a -si $outfile 
```

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2013-05-02T21:54:03.307

这使您可以看到命令仍在执行：

```
while :;do echo -n .;sleep 1;done &
trap "kill $!" EXIT  #Die with parent if we die prematurely
tar zxf packages.tar.gz; # or any other command here
kill $! && trap " " EXIT #Kill the loop and unset the trap or else the pid might get reassigned and we might end up killing a completely different process 
```

这将创建一个**无限循环**，在后台执行并回显“。” 每一秒。这将显示`.`在外壳中。运行`tar`命令或您想要的任何命令。当该命令完成执行时，然后**终止**在后台运行的最后一个作业 - 这是**无限的 while 循环**。

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2018-09-30T20:24:12.290

## 这是它的外观

*上传文件*

```
[##################################################] 100% (137921 / 137921 bytes) 
```

*等待作业完成*

```
[#########################                         ] 50% (15 / 30 seconds) 
```

## 实现它的简单函数

您可以将其复制粘贴到您的脚本中。它不需要任何其他工作。

```
PROGRESS_BAR_WIDTH=50  # progress bar length in characters

draw_progress_bar() {
  # Arguments: current value, max value, unit of measurement (optional)
  local __value=$1
  local __max=$2
  local __unit=${3:-""}  # if unit is not supplied, do not display it

  # Calculate percentage
  if (( $__max < 1 )); then __max=1; fi  # anti zero division protection
  local __percentage=$(( 100 - ($__max*100 - $__value*100) / $__max ))

  # Rescale the bar according to the progress bar width
  local __num_bar=$(( $__percentage * $PROGRESS_BAR_WIDTH / 100 ))

  # Draw progress bar
  printf "["
  for b in $(seq 1 $__num_bar); do printf "#"; done
  for s in $(seq 1 $(( $PROGRESS_BAR_WIDTH - $__num_bar ))); do printf " "; done
  printf "] $__percentage%% ($__value / $__max $__unit)\r"
} 
```

## 使用示例

在这里，我们上传一个文件并在每次迭代时重绘进度条。只要我们能得到 2 个值：最大值和当前值，实际执行什么工作并不重要。

在下面的示例中，最大值是`file_size`，当前值由某个函数提供并被调用`uploaded_bytes`。

```
# Uploading a file
file_size=137921

while true; do
  # Get current value of uploaded bytes
  uploaded_bytes=$(some_function_that_reports_progress)

  # Draw a progress bar
  draw_progress_bar $uploaded_bytes $file_size "bytes"

  # Check if we reached 100%
  if [ $uploaded_bytes == $file_size ]; then break; fi
  sleep 1  # Wait before redrawing
done
# Go to the newline at the end of upload
printf "\n" 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2021-07-08T08:30:03.500

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2020-11-20T15:39:05.630

我需要一个进度条来遍历 csv 文件中的行。能够将 cprn 的代码改编成对我有用的东西：

```
BAR='##############################'
FILL='------------------------------'
totalLines=$(wc -l $file | awk '{print $1}')  # num. lines in file
barLen=30

# --- iterate over lines in csv file ---
count=0
while IFS=, read -r _ col1 col2 col3; do
    # update progress bar
    count=$(($count + 1))
    percent=$((($count * 100 / $totalLines * 100) / 100))
    i=$(($percent * $barLen / 100))
    echo -ne "\r[${BAR:0:$i}${FILL:$i:barLen}] $count/$totalLines ($percent%)"

    # other stuff
    (...)
done <$file 
```

看起来像这样：

```
[##----------------------------] 17128/218210 (7%) 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2008-10-26T14:42:52.167

大多数 unix 命令不会为您提供可以执行此操作的那种直接反馈。有些会在您可以使用的 stdout 或 stderr 上为您提供输出。

对于 tar 之类的东西，您可以使用 -v 开关并将输出传送到一个程序，该程序会为它读取的每一行更新一个小动画。当 tar 写出它被解开的文件列表时，程序可以更新动画。要完成百分比，您必须知道文件的数量并计算行数。

据我所知，cp 没有给出这种输出。要监视 cp 的进度，您必须监视源文件和目标文件并观察目标的大小。[您可以使用stat (2)](http://linux.die.net/man/2/stat)系统调用编写一个小型 c 程序来获取文件大小。这将读取源文件的大小，然后轮询目标文件并根据迄今为止写入的文件的大小更新完成百分比条。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2010-08-24T09:01:34.087

我的解决方案显示当前正在解压缩和写入的 tarball 的百分比。我在写出 2GB 根文件系统映像时使用它。你真的需要一个进度条来处理这些事情。我所做的是 `gzip --list`用来获取压缩包的总未压缩大小。从中我计算出将文件分成 100 个部分所需的阻塞因子。最后，我为每个块打印一条检查点消息。对于一个 2GB 的文件，这提供了大约 10MB 个块。如果它太大，那么您可以将 BLOCKING_FACTOR 除以 10 或 100，但是很难以百分比形式打印漂亮的输出。

假设您使用的是 Bash，那么您可以使用以下 shell 函数

```
untar_progress () 
{ 
  TARBALL=$1
  BLOCKING_FACTOR=$(gzip --list ${TARBALL} |
    perl -MPOSIX -ane '$.==2 && print ceil $F[1]/50688')
  tar --blocking-factor=${BLOCKING_FACTOR} --checkpoint=1 \
    --checkpoint-action='ttyout=Wrote %u%  \r' -zxf ${TARBALL}
} 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2014-07-18T06:06:44.843

首先bar不是唯一的一个pipe进度表。另一个（可能更知名）是 pv（管道查看器）。

其次 bar 和 pv 可以像这样使用：

```
$ bar file1 | wc -l 
$ pv file1 | wc -l 
```

甚至：

```
$ tail -n 100 file1 | bar | wc -l
$ tail -n 100 file1 | pv | wc -l 
```

如果您想在处理参数中给出的文件的命令中使用 bar 和 pv ，一个有用的技巧是使用[进程替换](http://tldp.org/LDP/abs/html/process-sub.html)：

```
$ copy <(bar file1) file2
$ copy <(pv file1) file2 
```

进程替换是一种 bash 魔术，它创建临时 fifo 管道文件 /dev/fd/ 并通过此管道从已运行的进程（括号内）连接标准输出，并且副本就像普通文件一样看到它（除了一个例外，它只能读取它前锋）。

更新：

bar 命令本身也允许复制。人吧之后：

```
bar --in-file /dev/rmt/1cbn --out-file \
     tape-restore.tar --size 2.4g --buffer-size 64k 
```

但在我看来，流程替换是更通用的方法。它使用 cp 程序本身。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2017-04-29T06:05:36.150

基于 Edouard Lopez 的工作，我创建了一个适合屏幕大小的进度条，无论它是什么。看看这个。

[![在此处输入图像描述](https://i.stack.imgur.com/fU6nR.gif)](https://i.stack.imgur.com/fU6nR.gif)

它也发布在[Git Hub](https://github.com/adriano-pinaffo/progressbar.sh)上。

```
#!/bin/bash
#
# Progress bar by Adriano Pinaffo
# Available at https://github.com/adriano-pinaffo/progressbar.sh
# Inspired on work by Edouard Lopez (https://github.com/edouard-lopez/progress-bar.sh)
# Version 1.0
# Date April, 28th 2017

function error {
  echo "Usage: $0 [SECONDS]"
  case $1 in
    1) echo "Pass one argument only"
    exit 1
    ;;
    2) echo "Parameter must be a number"
    exit 2
    ;;
    *) echo "Unknown error"
    exit 999
  esac
}

[[ $# -ne 1 ]] && error 1
[[ $1 =~ ^[0-9]+$ ]] || error 2

duration=${1}
barsize=$((`tput cols` - 7))
unity=$(($barsize / $duration))
increment=$(($barsize%$duration))
skip=$(($duration/($duration-$increment)))
curr_bar=0
prev_bar=
for (( elapsed=1; elapsed<=$duration; elapsed++ ))
do
  # Elapsed
prev_bar=$curr_bar
  let curr_bar+=$unity
  [[ $increment -eq 0 ]] || {  
    [[ $skip -eq 1 ]] &&
      { [[ $(($elapsed%($duration/$increment))) -eq 0 ]] && let curr_bar++; } ||
    { [[ $(($elapsed%$skip)) -ne 0 ]] && let curr_bar++; }
  }
  [[ $elapsed -eq 1 && $increment -eq 1 && $skip -ne 1 ]] && let curr_bar++
  [[ $(($barsize-$curr_bar)) -eq 1 ]] && let curr_bar++
  [[ $curr_bar -lt $barsize ]] || curr_bar=$barsize
  for (( filled=0; filled<=$curr_bar; filled++ )); do
    printf "▇"
  done

  # Remaining
  for (( remain=$curr_bar; remain<$barsize; remain++ )); do
    printf " "
  done

  # Percentage
  printf "| %s%%" $(( ($elapsed*100)/$duration))

  # Return
  sleep 1
  printf "\r"
done
printf "\n"
exit 0 
```

享受

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2016-01-10T17:40:47.220

我更喜欢使用带有*--gauge参数的**对话框*。经常用于 .deb 包安装和许多发行版的其他基本配置内容。所以你不需要重新发明轮子......再次

 *只需输入一个从 1 到 100 @stdin 的 int 值。一个基本而愚蠢的例子：

```
for a in {1..100}; do sleep .1s; echo $a| dialog --gauge "waiting" 7 30; done 
```

我有这个*/bin/Wait*文件（带有 chmod u+x perms）用于烹饪目的：P

```
#!/bin/bash
INIT=`/bin/date +%s`
NOW=$INIT
FUTURE=`/bin/date -d "$1" +%s`
[ $FUTURE -a $FUTURE -eq $FUTURE ] || exit
DIFF=`echo "$FUTURE - $INIT"|bc -l`

while [ $INIT -le $FUTURE -a $NOW -lt $FUTURE ]; do
    NOW=`/bin/date +%s`
    STEP=`echo "$NOW - $INIT"|bc -l`
    SLEFT=`echo "$FUTURE - $NOW"|bc -l`
    MLEFT=`echo "scale=2;$SLEFT/60"|bc -l`
    TEXT="$SLEFT seconds left ($MLEFT minutes)";
    TITLE="Waiting $1: $2"
    sleep 1s
    PTG=`echo "scale=0;$STEP * 100 / $DIFF"|bc -l`
    echo $PTG| dialog --title "$TITLE" --gauge "$TEXT" 7 72
done

if [ "$2" == "" ]; then msg="Espera terminada: $1";audio="Listo";
else msg=$2;audio=$2;fi 

/usr/bin/notify-send --icon=stock_appointment-reminder-excl "$msg"
espeak -v spanish "$audio" 
```

所以我可以说：

`Wait "34 min" "warm up the oven"`

或者

`Wait "dec 31" "happy new year"`

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2016-04-08T07:21:21.990

许多答案描述了编写您自己的打印命令`'\r' + $some_sort_of_progress_msg`。有时问题是每秒打印出数百个这样的更新会减慢这个过程。

但是，如果您的任何进程产生输出（例如`7z a -r newZipFile myFolder`，将在压缩文件时输出每个文件名），那么存在更简单、快速、轻松且可定制的解决方案。

安装 python 模块`tqdm`。

```
$ sudo pip install tqdm
$ # now have fun
$ 7z a -r -bd newZipFile myFolder | tqdm >> /dev/null
$ # if we know the expected total, we can have a bar!
$ 7z a -r -bd newZipFile myFolder | grep -o Compressing | tqdm --total $(find myFolder -type f | wc -l) >> /dev/null 
```

帮助：`tqdm -h`。使用更多选项的示例：

```
$ find / -name '*.py' -exec cat \{} \; | tqdm --unit loc --unit_scale True | wc -l 
```

作为奖励，您还可以使用`tqdm`在 python 代码中包装迭代。

[https://github.com/tqdm/tqdm/blob/master/README.rst#module](https://github.com/tqdm/tqdm/blob/master/README.rst#module)

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2014-11-04T13:02:23.977

对我来说最容易使用和最好看的命令是命令`pv`或者`bar`像一些人已经写过的

例如：需要对整个驱动器进行备份`dd`

通常你使用`dd if="$input_drive_path" of="$output_file_path"`

和`pv`你一起可以这样：

`dd if="$input_drive_path" | pv | dd of="$output_file_path"`

进展直接`STDOUT`如下：

```
 7.46GB 0:33:40 [3.78MB/s] [  <=>                                            ] 
```

完成后总结出现

```
 15654912+0 records in
    15654912+0 records out
    8015314944 bytes (8.0 GB) copied, 2020.49 s, 4.0 MB/s 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2015-05-26T09:04:50.240

要指示活动的进度，请尝试以下命令：

```
while true; do sleep 0.25 && echo -ne "\r\\" && sleep 0.25 && echo -ne "\r|" && sleep 0.25 && echo -ne "\r/" && sleep 0.25 && echo -ne "\r-"; done; 
```

**或者**

```
while true; do sleep 0.25 && echo -ne "\rActivity: \\" && sleep 0.25 && echo -ne "\rActivity: |" && sleep 0.25 && echo -ne "\rActivity: /" && sleep 0.25 && echo -ne "\rActivity: -"; done; 
```

**或者**

```
while true; do sleep 0.25 && echo -ne "\r" && sleep 0.25 && echo -ne "\r>" && sleep 0.25 && echo -ne "\r>>" && sleep 0.25 && echo -ne "\r>>>"; sleep 0.25 && echo -ne "\r>>>>"; done; 
```

**或者**

```
while true; do sleep .25 && echo -ne "\r:Active:" && sleep .25 && echo -ne "\r:aCtive:" && sleep .25 && echo -ne "\r:acTive:" && sleep .25 && echo -ne "\r:actIve:" && sleep .25 && echo -ne "\r:actiVe:" && sleep .25 && echo -ne "\r:activE:"; done; 
```

可以在 while 循环中使用**标志/变量**来检查和显示进度的值/范围。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2018-11-01T02:04:21.283

[https://github.com/extensionsapp/progre.sh](https://github.com/extensionsapp/progre.sh)

创建 40% 的进度：`progreSh 40`

[![在此处输入图像描述](https://i.stack.imgur.com/t7gba.gif)](https://i.stack.imgur.com/t7gba.gif)

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2020-07-26T14:55:11.993

它可以通过一种非常简单的方式实现：

*   `for`使用循环从 0 迭代到 100
*   每步睡眠 25 毫秒（0.25 秒）
*   将另一个符号附加到`$bar`变量`=`以使进度条更宽
*   回显进度条和百分比（`\r`清除行并返回到行首；`-ne`make`echo`不会在末尾添加换行符并解析`\r`特殊字符）

```
function progress {
    bar=''
    for (( x=0; x <= 100; x++ )); do
        sleep 0.25
        bar="${bar}="
        echo -ne "$bar ${x}%\r"
    done
    echo -e "\n"
} 
```

```
$ progress
> ========== 10% # here: after 2.5 seconds 
```

```
$ progress
> ============================== 30% # here: after 7.5 seconds 
```

**彩色进度条**

```
function progress {
    bar=''
    for (( x=0; x <= 100; x++ )); do
        sleep 0.05
        bar="${bar} "

        echo -ne "\r"
        echo -ne "\e[43m$bar\e[0m"

        local left="$(( 100 - $x ))"
        printf " %${left}s"
        echo -n "${x}%"
    done
    echo -e "\n"
} 
```

要使进度条变得丰富多彩，您可以使用格式化转义序列 - 这里进度条是黄色的：`\e[43m`，然后我们用 重置自定义设置`\e[0m`，否则即使进度条完成也会影响进一步的输入。

[![自定义进度条](https://i.stack.imgur.com/Lplwe.png)](https://i.stack.imgur.com/Lplwe.png)

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2021-01-01T18:37:26.170

我需要一个适合弹出气泡消息 ( `notify-send`) 的进度条来表示电视音量级别。最近我一直在用python写一个音乐播放器，电视画面大部分时间都是关闭的。

## 终端的示例输出

[![test_progress_bar3.gif](https://i.stack.imgur.com/gD4iz.gif)](https://i.stack.imgur.com/gD4iz.gif)

* * *

## bash 脚本

```
#!/bin/bash

# Show a progress bar at step number $1 (from 0 to 100)

function is_int() { test "$@" -eq "$@" 2> /dev/null; } 

# Parameter 1 must be integer
if ! is_int "$1" ; then
   echo "Not an integer: ${1}"
   exit 1
fi

# Parameter 1 must be >= 0 and <= 100
if [ "$1" -ge 0 ] && [ "$1" -le 100 ]  2>/dev/null
then
    :
else
    echo bad volume: ${1}
    exit 1
fi

# Main function designed for quickly copying to another program 
Main () {

    Bar=""                      # Progress Bar / Volume level
    Len=25                      # Length of Progress Bar / Volume level
    Div=4                       # Divisor into Volume for # of blocks
    Fill="▒&quot;                    # Fill up to $Len
    Arr=( "▉&quot; "▎&quot; "▌&quot; "▊&quot; )     # UTF-8 left blocks: 7/8, 1/4, 1/2, 3/4

    FullBlock=$((${1} / Div))   # Number of full blocks
    PartBlock=$((${1} % Div))   # Size of partial block (array index)

    while [[ $FullBlock -gt 0 ]]; do
        Bar="$Bar${Arr[0]}"     # Add 1 full block into Progress Bar
        (( FullBlock-- ))       # Decrement full blocks counter
    done

    # If remainder zero no partial block, else append character from array
    if [[ $PartBlock -gt 0 ]]; then
        Bar="$Bar${Arr[$PartBlock]}"
    fi

    while [[ "${#Bar}" -lt "$Len" ]]; do
        Bar="$Bar$Fill"         # Pad Progress Bar with fill character
    done

    echo Volume: "$1 $Bar"
    exit 0                      # Remove this line when copying into program
} # Main

Main "$@" 
```

* * *

## 测试 bash 脚本

使用此脚本测试终端中的进度条。

```
#!/bin/bash

# test_progress_bar3

Main () {

    tput civis                              # Turn off cursor
    for ((i=0; i<=100; i++)); do
        CurrLevel=$(./progress_bar3 "$i")   # Generate progress bar 0 to 100
        echo -ne "$CurrLevel"\\r            # Reprint overtop same line
        sleep .04
    done
    echo -e \\n                             # Advance line to keep last progress
    echo "$0 Done"
    tput cnorm                              # Turn cursor back on
} # Main

Main "$@" 
```

* * *

# TL;博士

本节详细介绍如何`notify-send`将垃圾邮件弹出气泡消息快速发送到桌面。这是必需的，因为音量级别可以在一秒钟内更改多次，并且默认的气泡消息行为是让消息在桌面上停留数秒。

## 示例弹出气泡消息

[![电视供电的.gif](https://i.stack.imgur.com/yYCDw.gif)](https://i.stack.imgur.com/yYCDw.gif)

## 弹出气泡消息 bash 代码

从上面的脚本中，该`main`函数被复制到一个`VolumeBar`名为`tvpowered`. `exit 0`复制函数中的命令`main`已删除。

以下是如何调用它并让 Ubuntu 的`notify-send`命令知道我们将发送垃圾邮件弹出气泡消息：

```
VolumeBar $CurrVolume
# Ask Ubuntu: https://askubuntu.com/a/871207/307523
notify-send --urgency=critical "tvpowered" \
    -h string:x-canonical-private-synchronous:volume \
    --icon=/usr/share/icons/gnome/48x48/devices/audio-speakers.png \
    "Volume: $CurrVolume $Bar" 
```

这是告诉`notify-send`立即替换最后一个弹出气泡的新行：

```
-h string:x-canonical-private-synchronous:volume \ 
```

`volume`将弹出气泡消息组合在一起，该组中的新消息立即替换以前的消息。您可以使用`anything`而不是`volume`.

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2014-03-17T12:25:41.193

这仅适用于使用 gnome zenity。Zenity 为 bash 脚本提供了一个很棒的原生界面： **[https ://help.gnome.org/users/zenity/stable/](https://help.gnome.org/users/zenity/stable/)**

来自 Zenity 进度条示例：

```
#!/bin/sh
(
echo "10" ; sleep 1
echo "# Updating mail logs" ; sleep 1
echo "20" ; sleep 1
echo "# Resetting cron jobs" ; sleep 1
echo "50" ; sleep 1
echo "This line will just be ignored" ; sleep 1
echo "75" ; sleep 1
echo "# Rebooting system" ; sleep 1
echo "100" ; sleep 1
) |
zenity --progress \
  --title="Update System Logs" \
  --text="Scanning mail logs..." \
  --percentage=0

if [ "$?" = -1 ] ; then
        zenity --error \
          --text="Update canceled."
fi 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2015-06-29T20:56:33.000

我使用了[在 shell script 中创建重复字符的字符串以](https://stackoverflow.com/questions/3211891/creating-string-of-repeated-characters-in-shell-script)进行字符重复的答案。对于需要显示进度条的脚本，我有两个相对较小的**bash**版本（例如，循环遍历许多文件，但对大 tar 文件或复制操作没有用处）。更快的一个包含两个函数，一个是为条形显示准备字符串：

```
preparebar() {
# $1 - bar length
# $2 - bar char
    barlen=$1
    barspaces=$(printf "%*s" "$1")
    barchars=$(printf "%*s" "$1" | tr ' ' "$2")
} 
```

和一个显示进度条：

```
progressbar() {
# $1 - number (-1 for clearing the bar)
# $2 - max number
    if [ $1 -eq -1 ]; then
        printf "\r  $barspaces\r"
    else
        barch=$(($1*barlen/$2))
        barsp=$((barlen-barch))
        printf "\r[%.${barch}s%.${barsp}s]\r" "$barchars" "$barspaces"
    fi
} 
```

它可以用作：

```
preparebar 50 "#" 
```

这意味着为带有 50 个“#”字符的 bar 准备字符串，然后：

```
progressbar 35 80 
```

将显示对应于 35/80 比例的“#”字符数：

```
[#####################                             ] 
```

请注意，该函数会一遍又一遍地在同一行显示栏，直到您（或其他程序）打印换行符。如果您将 -1 作为第一个参数，则该条将被删除：

```
progressbar -1 80 
```

较慢的版本是一个功能：

```
progressbar() {
# $1 - number
# $2 - max number
# $3 - number of '#' characters
    if [ $1 -eq -1 ]; then
        printf "\r  %*s\r" "$3"
    else
        i=$(($1*$3/$2))
        j=$(($3-i))
        printf "\r[%*s" "$i" | tr ' ' '#'
        printf "%*s]\r" "$j"
    fi
} 
```

它可以用作（与上面相同的示例）：

```
progressbar 35 80 50 
```

如果您需要 stderr 上的进度条，只需`>&2`在每个 printf 命令的末尾添加即可。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2018-01-22T20:05:11.807

使用上面列出的建议，我决定实现自己的进度条。

```
#!/usr/bin/env bash

main() {
  for (( i = 0; i <= 100; i=$i + 1)); do
    progress_bar "$i"
    sleep 0.1;
  done
  progress_bar "done"
  exit 0
}

progress_bar() {
  if [ "$1" == "done" ]; then
    spinner="X"
    percent_done="100"
    progress_message="Done!"
    new_line="\n"
  else
    spinner='/-\|'
    percent_done="${1:-0}"
    progress_message="$percent_done %"
  fi

  percent_none="$(( 100 - $percent_done ))"
  [ "$percent_done" -gt 0 ] && local done_bar="$(printf '#%.0s' $(seq -s ' ' 1 $percent_done))"
  [ "$percent_none" -gt 0 ] && local none_bar="$(printf '~%.0s' $(seq -s ' ' 1 $percent_none))"

  # print the progress bar to the screen
  printf "\r Progress: [%s%s] %s %s${new_line}" \
    "$done_bar" \
    "$none_bar" \
    "${spinner:x++%${#spinner}:1}" \
    "$progress_message"
}

main "$@" 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2020-06-04T01:23:39.657

具有随机颜色的灵活版本，用于操作和日期的字符串。

```
function spinner() {
  local PID="$1"
  local str="${2:-Processing!}"
  local delay="0.1"
  # tput civis  # hide cursor
  while ( kill -0 $PID 2>/dev/null )
    do
      printf "\e[38;5;$((RANDOM%257))m%s\r\e[0m" "[$(date '+%d/%m/%Y %H:%M:%S')][      $str      ]"; sleep "$delay"
      printf "\e[38;5;$((RANDOM%257))m%s\r\e[0m" "[$(date '+%d/%m/%Y %H:%M:%S')][      $str      ]"; sleep "$delay"
      printf "\e[38;5;$((RANDOM%257))m%s\r\e[0m" "[$(date '+%d/%m/%Y %H:%M:%S')][      $str      ]"; sleep "$delay"
  done
  printf "\e[38;5;$((RANDOM%257))m%s\r\e[0m" "[$(date '+%d/%m/%Y %H:%M:%S')][ ✅  ✅  ✅   Done!   ✅  ✅  ✅ ]"; sleep "$delay"
  # tput cnorm  # restore cursor

  return 0
} 
```

用法：

```
# your long running proccess pushed to the background
sleep 20 &

# spinner capture-previous-proccess-id string
spinner $! 'Working!' 
```

输出示例：

```
[04/06/2020 03:22:24][      Seeding!      ] 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2014-10-10T01:03:13.430

我为嵌入式系统做了一个纯 shell 版本，利用：

*   /usr/bin/dd 的 SIGUSR1 信号处理功能。

    基本上，如果您发送“kill SIGUSR1 $(pid_of_running_dd_process)”，它将输出吞吐速度和传输量的摘要。

*   后台 dd 然后定期查询它的更新，并像老式的 ftp 客户端那样生成哈希滴答。

*   使用 /dev/stdout 作为非标准输出友好程序（如 scp）的目的地

最终结果允许您进行任何文件传输操作并获得看起来像老式 FTP 'hash' 输出的进度更新，您只需为每 X 个字节获得一个哈希标记。

这几乎不是生产质量代码，但你明白了。我觉得很可爱。

对于它的价值，实际字节数可能无法正确反映在哈希数中 - 根据舍入问题，您可能会有更多或更少。不要将它用作测试脚本的一部分，它只是吸引眼球。而且，是的，我知道这是非常低效的——它是一个 shell 脚本，我不为此道歉。

最后提供了 wget、scp 和 tftp 的示例。它应该适用于任何发出数据的东西。确保对标准输出不友好的程序使用 /dev/stdout。

```
#!/bin/sh
#
# Copyright (C) Nathan Ramella (nar+progress-script@remix.net) 2010 
# LGPLv2 license
# If you use this, send me an email to say thanks and let me know what your product
# is so I can tell all my friends I'm a big man on the internet!

progress_filter() {

        local START=$(date +"%s")
        local SIZE=1
        local DURATION=1
        local BLKSZ=51200
        local TMPFILE=/tmp/tmpfile
        local PROGRESS=/tmp/tftp.progress
        local BYTES_LAST_CYCLE=0
        local BYTES_THIS_CYCLE=0

        rm -f ${PROGRESS}

        dd bs=$BLKSZ of=${TMPFILE} 2>&1 \
                | grep --line-buffered -E '[[:digit:]]* bytes' \
                | awk '{ print $1 }' >> ${PROGRESS} &

        # Loop while the 'dd' exists. It would be 'more better' if we
        # actually looked for the specific child ID of the running 
        # process by identifying which child process it was. If someone
        # else is running dd, it will mess things up.

        # My PID handling is dumb, it assumes you only have one running dd on
        # the system, this should be fixed to just get the PID of the child
        # process from the shell.

        while [ $(pidof dd) -gt 1 ]; do

                # PROTIP: You can sleep partial seconds (at least on linux)
                sleep .5    

                # Force dd to update us on it's progress (which gets
                # redirected to $PROGRESS file.
                # 
                # dumb pid handling again
                pkill -USR1 dd

                local BYTES_THIS_CYCLE=$(tail -1 $PROGRESS)
                local XFER_BLKS=$(((BYTES_THIS_CYCLE-BYTES_LAST_CYCLE)/BLKSZ))

                # Don't print anything unless we've got 1 block or more.
                # This allows for stdin/stderr interactions to occur
                # without printing a hash erroneously.

                # Also makes it possible for you to background 'scp',
                # but still use the /dev/stdout trick _even_ if scp
                # (inevitably) asks for a password. 
                #
                # Fancy!

                if [ $XFER_BLKS -gt 0 ]; then
                        printf "#%0.s" $(seq 0 $XFER_BLKS)
                        BYTES_LAST_CYCLE=$BYTES_THIS_CYCLE
                fi
        done

        local SIZE=$(stat -c"%s" $TMPFILE)
        local NOW=$(date +"%s")

        if [ $NOW -eq 0 ]; then
                NOW=1
        fi

        local DURATION=$(($NOW-$START))
        local BYTES_PER_SECOND=$(( SIZE / DURATION ))
        local KBPS=$((SIZE/DURATION/1024))
        local MD5=$(md5sum $TMPFILE | awk '{ print $1 }')

        # This function prints out ugly stuff suitable for eval() 
        # rather than a pretty string. This makes it a bit more 
        # flexible if you have a custom format (or dare I say, locale?)

        printf "\nDURATION=%d\nBYTES=%d\nKBPS=%f\nMD5=%s\n" \
            $DURATION \
            $SIZE \
            $KBPS \
            $MD5
} 
```

例子：

```
echo "wget"
wget -q -O /dev/stdout http://www.blah.com/somefile.zip | progress_filter

echo "tftp"
tftp -l /dev/stdout -g -r something/firmware.bin 192.168.1.1 | progress_filter

echo "scp"
scp user@192.168.1.1:~/myfile.tar /dev/stdout | progress_filter 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2015-03-27T09:45:51.667

如果您必须显示时间进度条（通过提前知道显示时间），您可以使用 Python，如下所示：

```
#!/bin/python
from time import sleep
import sys

if len(sys.argv) != 3:
    print "Usage:", sys.argv[0], "<total_time>", "<progressbar_size>"
    exit()

TOTTIME=float(sys.argv[1])
BARSIZE=float(sys.argv[2])

PERCRATE=100.0/TOTTIME
BARRATE=BARSIZE/TOTTIME

for i in range(int(TOTTIME)+1):
    sys.stdout.write('\r')
    s = "[%-"+str(int(BARSIZE))+"s] %d%% "
    sys.stdout.write(s % ('='*int(BARRATE*i), int(PERCRATE*i)))
    sys.stdout.flush()
    SLEEPTIME = 1.0
    if i == int(TOTTIME): SLEEPTIME = 0.1
    sleep(SLEEPTIME)
print "" 
```

然后，假设您将 Python 脚本保存为`progressbar.py`，可以通过运行以下命令从 bash 脚本中显示进度条：

```
python progressbar.py 10 50 
```

它会显示一个进度条大小的`50`字符并“运行”`10`几秒钟。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2016-02-10T11:54:02.017

我建立在恐惧边提供的答案之上

这将连接到 Oracle 数据库以检索 RMAN 还原的进度。

```
#!/bin/bash

 # 1\. Create ProgressBar function
 # 1.1 Input is currentState($1) and totalState($2)
 function ProgressBar {
 # Process data
let _progress=(${1}*100/${2}*100)/100
let _done=(${_progress}*4)/10
let _left=40-$_done
# Build progressbar string lengths
_fill=$(printf "%${_done}s")
_empty=$(printf "%${_left}s")

# 1.2 Build progressbar strings and print the ProgressBar line
# 1.2.1 Output example:
# 1.2.1.1 Progress : [########################################] 100%
printf "\rProgress : [${_fill// /#}${_empty// /-}] ${_progress}%%"

}

function rman_check {
sqlplus -s / as sysdba <<EOF
set heading off
set feedback off
select
round((sofar/totalwork) * 100,0) pct_done
from
v\$session_longops
where
totalwork > sofar
AND
opname NOT LIKE '%aggregate%'
AND
opname like 'RMAN%';
exit
EOF
}

# Variables
_start=1

# This accounts as the "totalState" variable for the ProgressBar function
_end=100

_rman_progress=$(rman_check)
#echo ${_rman_progress}

# Proof of concept
#for number in $(seq ${_start} ${_end})

while [ ${_rman_progress} -lt 100 ]
do

for number in _rman_progress
do
sleep 10
ProgressBar ${number} ${_end}
done

_rman_progress=$(rman_check)

done
printf '\nFinished!\n' 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2017-08-14T14:19:52.127

```
#!/bin/bash

function progress_bar() {
    bar=""
    total=10
    [[ -z $1 ]] && input=0 || input=${1}
    x="##"
   for i in `seq 1 10`; do
        if [ $i -le $input ] ;then
            bar=$bar$x
        else
            bar="$bar  "
       fi
    done
    #pct=$((200*$input/$total % 2 + 100*$input/$total))
    pct=$(($input*10))
    echo -ne "Progress : [ ${bar} ] (${pct}%) \r"    
    sleep 1
    if [ $input -eq 10 ] ;then
        echo -ne '\n'
    fi

} 
```

可以创建一个函数，以 1-10 的比例绘制柱状图：

```
progress_bar 1
echo "doing something ..."
progress_bar 2
echo "doing something ..."
progress_bar 3
echo "doing something ..."
progress_bar 8
echo "doing something ..."
progress_bar 10 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2018-12-11T08:41:58.430

```
#!/bin/bash
tot=$(wc -c /proc/$$/fd/255 | awk '/ /{print $1}')
now() {
echo $(( 100* ($(awk '/^pos:/{print $2}' < /proc/$$/fdinfo/255)-166) / (tot-166) )) "%"
}
now;
now;
now;
now;
now;
now;
now;
now;
now; 
```

输出：

```
0 %
12 %
25 %
37 %
50 %
62 %
75 %
87 %
100 % 
```

注意：如果您输入 1 而不是 255，您将监视标准输入...使用 2 标准输出（但您必须修改源以将“tot”设置为预计的输出文件大小）

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2020-09-14T02:14:16.310

关于这个主题有很多不同的答案，但是在计算文本文件操作的百分比时，使用`current length / total size`方式，例如显示`ver_big_file.json`进度百分比，我建议`awk`为此目的使用，如下面的代码：

```
awk '
    function bar(x){s="";i=0;while (i++ < x) s=s "#";return s}
    BEGIN{
        ("ls -l " ARGV[1]) | getline total;
        split(total,array);
        total=array[5];
    }
    {
        cur+=length($0)+1;
        percent=int(cur / total * 100);
        printf "LINE %s:%s %s%%\r", NR, bar(percent*.8), percent 
    }
    END {print}' very_big_file.json | grep "keyword" | ... 
```

这种方式非常精确，基于流，但它只适用于文本文件。

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2016-05-17T19:56:59.357

这是 nExace 用于 bash 脚本的迷幻进度条。它可以从命令行调用为“./progressbar x y”，其中“x”是以秒为单位的时间，“y”是与该部分进度相关联的消息。

如果您希望脚本的其他部分控制进度条，则内部 progressbar() 函数本身也很好。例如，发送 'progressbar 10 "Creating directory tree";' 将显示：

```
[#######                                     ] (10%) Creating directory tree 
```

当然，它会很好迷幻……

```
#!/bin/bash

if [ "$#" -eq 0 ]; then echo "x is \"time in seconds\" and z is \"message\""; echo "Usage: progressbar x z"; exit; fi
progressbar() {
        local loca=$1; local loca2=$2;
        declare -a bgcolors; declare -a fgcolors;
        for i in {40..46} {100..106}; do
                bgcolors+=("$i")
        done
        for i in {30..36} {90..96}; do
                fgcolors+=("$i")
        done
        local u=$(( 50 - loca ));
        local y; local t;
        local z; z=$(printf '%*s' "$u");
        local w=$(( loca * 2 ));
        local bouncer=".oO°Oo.";
        for ((i=0;i<loca;i++)); do
                t="${bouncer:((i%${#bouncer})):1}"
                bgcolor="\\E[${bgcolors[RANDOM % 14]}m \\033[m"
                y+="$bgcolor";
        done
        fgcolor="\\E[${fgcolors[RANDOM % 14]}m"
        echo -ne " $fgcolor$t$y$z$fgcolor$t \\E[96m(\\E[36m$w%\\E[96m)\\E[92m $fgcolor$loca2\\033[m\r"
};
timeprogress() {
        local loca="$1"; local loca2="$2";
        loca=$(bc -l <<< scale=2\;"$loca/50")
        for i in {1..50}; do
                progressbar "$i" "$loca2";
                sleep "$loca";
        done
        printf "\n"
};
timeprogress "$1" "$2" 
```

* * *

## 回答 #38

> 赞同：-1
> 
> 时间：2016-06-13T10:23:43.850

先将进程执行到后台，然后经常观察它的运行状态，正在运行的打印花样，再次检查它的状态是否在运行；

使用 while 循环经常查看进程的状态。

使用 pgrep 或任何其他命令来监视和获取进程的运行状态。

如果使用 pgrep 根据需要将不必要的输出重定向到 /dev/null。

**代码：**

```
sleep 12&
while pgrep sleep &> /dev/null;do echo -en "#";sleep 0.5;done 
```

这个“#”会一直打印到sleep终止，这个方法用来实现程序进度条的进度条。

您还可以使用此方法对 shell 脚本的命令进行可视化分析它的处理时间。

**BUG：** 此 pgrep 方法并非在所有情况下都有效，意外地另一个进程以相同的名称运行，while 循环没有结束。

所以通过指定它的PID来获取进程的运行状态，使用may进程可以使用一些命令，

命令***ps a***将列出所有具有 id 的进程，你需要*grep*找出指定进程的 pid

* * *

## 回答 #39

> 赞同：-1
> 
> 时间：2016-07-08T23:59:02.297

我想根据命令输出的行数与上一次运行的目标行数来跟踪进度：

```
#!/bin/bash
function lines {
  local file=$1
  local default=$2
  if [[ -f $file ]]; then
    wc -l $file | awk '{print $1}';
  else
    echo $default
  fi
}

function bar {
  local items=$1
  local total=$2
  local size=$3
  percent=$(($items*$size/$total % $size))
  left=$(($size-$percent))
  chars=$(local s=$(printf "%${percent}s"); echo "${s// /=}")
  echo -ne "[$chars>";
  printf "%${left}s"
  echo -ne ']\r'
}

function clearbar {
  local size=$1
  printf " %${size}s  "
  echo -ne "\r"
}

function progress {
  local pid=$1
  local total=$2
  local file=$3

  bar 0 100 50
  while [[ "$(ps a | awk '{print $1}' | grep $pid)" ]]; do
    bar $(lines $file 0) $total 50
    sleep 1
  done
  clearbar 50
  wait $pid
  return $?
} 
```

然后像这样使用它：

```
target=$(lines build.log 1000)
(mvn clean install > build.log 2>&1) &
progress $! $target build.log 
```

它输出一个看起来像这样的进度条：

```
[===============================================>   ] 
```

条形图随着输出的行数达到目标而增长。如果行数超过目标，则条形图重新开始（希望目标是好的）。

顺便说一句：我在 Mac OSX 上使用 bash。我将此代码基于[mariascio](https://github.com/marascio/bash-tips-and-tricks/tree/master/showing-progress-with-a-bash-spinner)的微调器。

* * *

## 回答 #40

> 赞同：-3
> 
> 时间：2012-05-30T10:40:40.520

制作 tar 进度条

```
tar xzvf pippo.tgz |xargs -L 19 |xargs -I@ echo -n "." 
```

其中“19”是 tar 中的文件数除以预期进度条的长度。示例：.tgz 包含 140 个文件，您需要 76 个“.”的进度条，您可以输入 -L 2。

你不需要其他任何东西。

* * *

## 回答 #41

> 赞同：-3
> 
> 时间：2013-11-01T11:52:12.897

有一次，我还有一个忙碌的脚本被占用了几个小时而没有显示任何进展。所以我实现了一个功能，主要包括前面答案的技术：

```
#!/bin/bash
# Updates the progress bar
# Parameters: 1\. Percentage value
update_progress_bar()
{
  if [ $# -eq 1 ];
  then
    if [[ $1 == [0-9]* ]];
    then
      if [ $1 -ge 0 ];
      then
        if [ $1 -le 100 ];
        then
          local val=$1
          local max=100

          echo -n "["

          for j in $(seq $max);
          do
            if [ $j -lt $val ];
            then
              echo -n "="
            else
              if [ $j -eq $max ];
              then
                echo -n "]"
              else
                echo -n "."
              fi
            fi
          done

          echo -ne " "$val"%\r"

          if [ $val -eq $max ];
          then
            echo ""
          fi
        fi
      fi
    fi
  fi
}

update_progress_bar 0
# Further (time intensive) actions and progress bar updates
update_progress_bar 100 
```

* * *

## 回答 #42

> 赞同：-5
> 
> 时间：2013-05-02T11:40:11.703

我今天也有同样的事情要做，根据 Diomidis 的回答，我是这样做的（linux debian 6.0.7）。也许，这可以帮助你：

```
#!/bin/bash

echo "getting script inode"
inode=`ls -i ./script.sh | cut -d" " -f1`
echo $inode

echo "getting the script size"
size=`cat script.sh | wc -c`
echo $size

echo "executing script"
./script.sh &
pid=$!
echo "child pid = $pid"

while true; do
        let offset=`lsof -o0 -o -p $pid | grep $inode | awk -F" " '{print $7}' | cut -d"t" -f 2`
        let percent=100*$offset/$size
        echo -ne " $percent %\r"
done 
```

# python - 你如何在 django 网站上记录服务器错误

> ID：238081
> 
> 赞同：184
> 
> 时间：2008-10-26T14:37:42.770
> 
> 标签：python, django, error-logging

因此，在进行开发时，我可以设置`settings.DEBUG`为`True`，如果发生错误，我可以看到它的格式很好，具有良好的堆栈跟踪和请求信息。

但是在那种生产网站上，我宁愿使用`DEBUG=False`并向访问者展示一些标准错误 500 页面，其中包含我目前正在修复这个错误的信息；）
同时我想有一些方法来记录所有这些信息（堆栈跟踪和请求信息）到我服务器上的文件中 - 所以我可以将其输出到我的控制台并观察错误滚动，每小时通过电子邮件将日志发送给我或类似的东西。

您会为 django 站点推荐哪些日志记录解决方案，以满足这些简单的要求？我将应用程序作为`fcgi`服务器运行，并且使用 apache Web 服务器作为前端（尽管考虑使用 lighttpd）。

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2008-10-26T14:53:31.147

好吧，当 时`DEBUG = False`，Django 会自动将任何错误的完整追溯邮件发送给设置中列出的每个人`ADMINS`，这几乎可以免费获得通知。如果您想要更细粒度的控制，您可以编写一个中间件类并将其添加到您的设置中，该类定义了一个名为 的方法`process_exception()`，该方法可以访问引发的异常：

[http://docs.djangoproject.com/en/dev/topics/http/middleware/#process-exception](http://docs.djangoproject.com/en/dev/topics/http/middleware/#process-exception)

然后，您的`process_exception()`方法可以执行您想要的任何类型的日志记录：写入控制台、写入文件等。

编辑：虽然它不太有用，但您也可以监听`got_request_exception`信号，只要在请求处理期间遇到异常，就会发送该信号：

[http://docs.djangoproject.com/en/dev/ref/signals/#got-request-exception](http://docs.djangoproject.com/en/dev/ref/signals/#got-request-exception)

但是，这不会*让*您访问异常对象，因此中间件方法更容易使用。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2011-06-18T11:58:01.903

正如已经提到的，Django Sentry 是一个很好的方法，但是要正确设置它（作为一个单独的网站）需要做一些工作。如果您只想将所有内容记录到一个简单的文本文件中，这里是要放入您的日志记录配置`settings.py`

```
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        # Include the default Django email handler for errors
        # This is what you'd get without configuring logging at all.
        'mail_admins': {
            'class': 'django.utils.log.AdminEmailHandler',
            'level': 'ERROR',
             # But the emails are plain text by default - HTML is nicer
            'include_html': True,
        },
        # Log to a text file that can be rotated by logrotate
        'logfile': {
            'class': 'logging.handlers.WatchedFileHandler',
            'filename': '/var/log/django/myapp.log'
        },
    },
    'loggers': {
        # Again, default Django configuration to email unhandled exceptions
        'django.request': {
            'handlers': ['mail_admins'],
            'level': 'ERROR',
            'propagate': True,
        },
        # Might as well log any errors anywhere else in Django
        'django': {
            'handlers': ['logfile'],
            'level': 'ERROR',
            'propagate': False,
        },
        # Your own app - this assumes all your logger names start with "myapp."
        'myapp': {
            'handlers': ['logfile'],
            'level': 'WARNING', # Or maybe INFO or DEBUG
            'propagate': False
        },
    },
} 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2010-11-16T20:34:56.797

在另一个答案中提到的 django-db-log 已替换为：

[https://github.com/dcramer/django-sentry](https://github.com/dcramer/django-sentry)

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-10-27T13:33:44.160

显然 James 是正确的，但如果您想在数据存储中记录异常，已经有一些开源解决方案可用：

1) CrashLog 是一个不错的选择：[http ://code.google.com/p/django-crashlog/](http://code.google.com/p/django-crashlog/)

2) Db-Log 也是一个不错的选择：[http ://code.google.com/p/django-db-log/](http://code.google.com/p/django-db-log/)

两者有什么区别？我几乎看不到任何东西，所以任何一个都足够了。

我两个都用过，而且效果很好。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2013-10-09T08:51:51.597

自 EMP 最有用的代码提交以来已经过去了一段时间。我刚刚实现了它，并且在使用一些 manage.py 选项来尝试解决错误时，我收到了一个弃用警告，大意是使用我当前版本的 Django (1.5.?) 一个 require_debug_false 过滤器现在mail_admins 处理程序需要。

这是修改后的代码：

```
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'filters': {
         'require_debug_false': {
             '()': 'django.utils.log.RequireDebugFalse'
         }
     },
    'handlers': {
        # Include the default Django email handler for errors
        # This is what you'd get without configuring logging at all.
        'mail_admins': {
            'class': 'django.utils.log.AdminEmailHandler',
            'level': 'ERROR',
            'filters': ['require_debug_false'],
             # But the emails are plain text by default - HTML is nicer
            'include_html': True,
        },
        # Log to a text file that can be rotated by logrotate
        'logfile': {
            'class': 'logging.handlers.WatchedFileHandler',
            'filename': '/home/username/public_html/djangoprojectname/logfilename.log'
        },
    },
    'loggers': {
        # Again, default Django configuration to email unhandled exceptions
        'django.request': {
            'handlers': ['mail_admins'],
            'level': 'ERROR',
            'propagate': True,
        },
        # Might as well log any errors anywhere else in Django
        'django': {
            'handlers': ['logfile'],
            'level': 'ERROR',
            'propagate': False,
        },
        # Your own app - this assumes all your logger names start with "myapp."
        'myapp': {
            'handlers': ['logfile'],
            'level': 'DEBUG', # Or maybe INFO or WARNING
            'propagate': False
        },
    },
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-08-23T16:33:50.447

我的`fcgi`脚本有一个烦人的问题。它发生在 django 甚至开始之前。缺乏日志记录太痛苦了。无论如何，首先将 stderr 重定向到文件有很大帮助：

```
#!/home/user/env/bin/python
sys.stderr = open('/home/user/fcgi_errors', 'a') 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-01-07T07:28:59.087

你可以在 Python 中使用日志库，不需要`pip install`任何东西。

将任何替换`print()`为`logging.debug()` 但是，

> Django Sentry 是一个不错的选择

正如EMP所说。

# python - Python中列表的模式匹配

> ID：238102
> 
> 赞同：43
> 
> 时间：2008-10-26T14:50:40.200
> 
> 标签：python, functional-programming, pattern-matching

我想对 Python 中的列表进行一些模式匹配。例如，在 Haskell 中，我可以执行以下操作：

```
fun (head : rest) = ... 
```

所以当我传入一个列表时，`head`将是第一个元素，并且`rest`将是尾随元素。

同样，在 Python 中，我可以自动解包元组：

```
(var1, var2) = func_that_returns_a_tuple() 
```

我想对 Python 中的列表做类似的事情。现在，我有一个返回列表的函数，以及执行以下操作的代码块：

```
ls = my_func()
(head, rest) = (ls[0], ls[1:]) 
```

我想知道我是否可以用 Python 的一行而不是两行来做到这一点。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-10-26T15:01:12.377

据我所知，如果不引入另一个函数，就无法使其成为当前 Python 中的单行代码，例如：

```
split_list = lambda lst: (lst[0], lst[1:])
head, rest = split_list(my_func()) 
```

然而，在 Python 3.0 中，用于可变参数签名和参数解包的专用语法也可用于这种类型的通用序列解包，因此在 3.0 中，您将能够编写：

```
head, *rest = my_func() 
```

有关详细信息，请参阅[PEP 3132](https://www.python.org/dev/peps/pep-3132/)。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-26T16:05:12.890

首先，请注意，功能语言的“模式匹配”和您提到的元组分配并不是那么相似。在函数式语言中，模式用于给出函数的部分定义。所以`f (x : s) = e`并不意味着取参数的头部和尾部并使用它们`f`返回`e`，而是意味着*如果*参数`f`的形式是`x : s`（对于某些`x`和`s`），*则* `f (x : s)`等于`e`。

python的赋值更像是一个多重赋值（我怀疑这是它的初衷）。因此，例如，您可以在不需要临时变量的情况下交换值（就像使用简单的赋值语句一样）`x, y = y, x`。这与模式匹配几乎没有关系，因为它基本上是“同时”执行and的简写。尽管 python 允许任意序列而不是逗号分隔的列表，但我不建议调用这种模式匹配。通过模式匹配，您可以检查某些内容是否与模式匹配；在 python 分配中，您应该确保两侧的序列相同。`x``y``x = y``y = x`

要执行您似乎想要做的事情，您通常（也在函数式语言中）使用辅助函数（如其他人所提到的）或类似于`let`or`where`构造的东西（您可以将其视为使用匿名函数）。例如：

```
(head, tail) = (x[0], x[1:]) where x = my_func() 
```

或者，在实际的 python 中：

```
(head, tail) = (lambda x: (x[0], x[1:]))(my_func()) 
```

请注意，这与其他人提供的具有辅助功能的解决方案基本相同，只是这是您想要的单行。但是，它不一定比单独的功能更好。

（对不起，如果我的回答有点过头了。我只是认为明确区分很重要。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T15:00:29.493

这是一种非常“纯函数式”的方法，因此在 Haskell 中是一个明智的习惯用法，但它可能不太适合 Python。Python 在这种方式下只有非常有限的[模式](http://www.haskell.org/tutorial/patterns.html)概念——我怀疑你可能需要一个更严格的类型系统来实现这种结构（请[erlang](http://www.erlang.org/)爱好者在这里不同意）。

您所拥有的可能与该习惯用法一样接近，但您最好使用列表推导式或命令式方法，而不是递归调用带有列表尾部的函数。

如前所述[，](http://www.oreillynet.com/onlamp/blog/2005/10/pythons_weak_functional_progra.html) [Python](http://www.artima.com/weblogs/viewpost.jsp?thread=4550) 实际上并不是一种函数式语言[。](http://blog.ianbicking.org/functional-python.html)它只是借鉴了 FP 世界的想法。它本质上并不是你期望看到嵌入函数式语言架构中的[尾递归，因此在不使用大量堆栈空间的情况下对大型数据集执行这种递归操作会有些困难。](http://en.wikipedia.org/wiki/Tail_recursion)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-07-20T23:18:17.343

我正在研究[pyfpm](https://github.com/martinblech/pyfpm)，这是一个用于在 Python 中使用类似 Scala 的语法进行模式匹配的库。您可以使用它来解压缩对象，如下所示：

```
from pyfpm import Unpacker

unpacker = Unpacker()

unpacker('head :: tail') << (1, 2, 3)

unpacker.head # 1
unpacker.tail # (2, 3) 
```

或者在函数的 arglist 中：

```
from pyfpm import match_args

@match_args('head :: tail')
def f(head, tail):
    return (head, tail)

f(1)          # (1, ())
f(1, 2, 3, 4) # (1, (2, 3, 4)) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-26T15:40:59.070

3.0 中引入了扩展解包 [http://www.python.org/dev/peps/pep-3132/](http://www.python.org/dev/peps/pep-3132/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-27T14:15:34.107

与 Haskell 或 ML 不同，Python 没有内置的结构模式匹配。进行模式匹配的最 Pythonic 方式是使用 try-except 块：

```
def recursive_sum(x):
    try:
        head, tail = x[0], x[1:]
        return head + recursive-sum(tail)
    except IndexError:  # empty list: [][0] raises IndexError
        return 0 
```

请注意，这仅适用于具有切片索引的对象。此外，如果函数变得复杂，则该行*之后*`head, tail`的正文中的某些内容可能会引发 IndexError，这将导致细微的错误。但是，这确实允许您执行以下操作：

```
for frob in eggs.frob_list:
    try:
        frob.spam += 1
    except AttributeError:
        eggs.no_spam_count += 1 
```

在 Python 中，尾递归通常更好地实现为带有累加器的循环，即：

```
def iterative_sum(x):
    ret_val = 0
    for i in x:
        ret_val += i
    return ret_val 
```

这是一种在 99% 的情况下都可以做到的显而易见且正确的方法。它不仅阅读起来更清晰，而且速度更快，而且它可以处理列表以外的东西（例如集合）。如果那里有等待发生的异常，该函数将很高兴地失败并将其传递到链上。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-26T15:03:08.973

好吧，为什么你首先想要它在 1-line 中？

如果你真的想，你总是可以做这样的把戏：

```
def x(func):
  y = func()
  return y[0], y[1:]

# then, instead of calling my_func() call x(my_func)
(head, rest) = x(my_func) # that's one line :) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-27T12:08:14.597

除了其他答案，请注意 Python 中等效的头/尾操作，包括 python3 对 * 语法的扩展，通常比 Haskell 的模式匹配效率低。

Python 列表是作为向量实现的，因此获取尾部需要获取列表的副本。这是列表大小的 O(n)，而使用链表（如 Haskell）的实现只能使用尾指针，即 O(1) 操作。

唯一的例外可能是基于迭代器的方法，其中实际上并未返回列表，而是返回了迭代器。但是，这可能不适用于需要列表的所有地方（例如，迭代多次）。

例如，[Cipher 的](https://stackoverflow.com/questions/238102/pattern-matching-of-lists-in-python#238185)方法，如果修改为返回迭代器而不是将其转换为元组，将具有这种行为。或者，不依赖字节码的更简单的仅包含 2 项的方法是：

```
def head_tail(lst):
    it = iter(list)
    yield it.next()
    yield it

>>> a, tail = head_tail([1,2,3,4,5])
>>> b, tail = head_tail(tail)
>>> a,b,tail
(1, 2, <listiterator object at 0x2b1c810>)
>>> list(tail)
[3, 4] 
```

显然，尽管您仍然必须包装一个实用函数，而不是为它提供很好的语法糖。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-26T16:15:17.190

python 食谱中有一个食谱可以做到这一点。我现在似乎找不到它，但这是代码（我稍微修改了一下）

```
 def peel(iterable,result=tuple):
    '''Removes the requested items from the iterable and stores the remaining in a tuple
    >>> x,y,z=peel('test')
    >>> print repr(x),repr(y),z
    't' 'e' ('s', 't')
    '''
    def how_many_unpacked():
        import inspect,opcode
        f = inspect.currentframe().f_back.f_back
        if ord(f.f_code.co_code[f.f_lasti])==opcode.opmap['UNPACK_SEQUENCE']:
            return ord(f.f_code.co_code[f.f_lasti+1])
        raise ValueError("Must be a generator on RHS of a multiple assignment!!")
    iterator=iter(iterable)
    hasItems=True
    amountToUnpack=how_many_unpacked()-1
    next=None
    for num in xrange(amountToUnpack):
        if hasItems:        
            try:
                next = iterator.next()
            except StopIteration:
                next = None
                hasItems = False
        yield next
    if hasItems:
        yield result(iterator)
    else:
        yield None 
```

但是您应该注意，这仅在使用分配解包时才有效，因为它不考虑前一帧的方式......仍然非常有用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-08-29T16:31:58.850

对于您的特定用例 - 模拟 Haskell's `fun (head : rest) = ...`，当然。函数定义支持参数解包已经有一段时间了：

```
def my_method(head, *rest):
    # ... 
```

从 Python 3.0 开始，正如@bpowah[提到](https://stackoverflow.com/a/238153/1336699)的那样，Python 也支持在赋值时解包：

```
my_list = ['alpha', 'bravo', 'charlie', 'delta', 'echo']
head, *rest = my_list
assert head == 'alpha'
assert rest == ['bravo', 'charlie', 'delta', 'echo'] 
```

请注意，星号（“splat”）表示“可迭代的剩余部分”，而不是“直到结束”。以下工作正常：

```
first, *middle, last = my_list
assert first == 'alpha'
assert last == 'echo'
assert middle == ['bravo', 'charlie', 'delta']

first, *middle, last = ['alpha', 'bravo']
assert first == 'alpha'
assert last == 'bravo'
assert middle == [] 
```

# windows-server-2003 - 另一个 Synergy 问题：Windows Server 2003 上的屏幕锁定

> ID：238106
> 
> 赞同：0
> 
> 时间：2008-10-26T14:52:00.040
> 
> 标签：windows-server-2003

我在 Unix 系统上设置了 Synergy 没有问题，但是当我在 Windows Server 2003 机器上设置 Synergy 服务器时，我收到一条错误消息，指出在尝试移动到客户端系统时鼠标光标被锁定。我使用 Microsoft Natural 键盘以防万一（似乎可能涉及 Scroll Lock）。是否有人在无法将鼠标悬停到客户端系统时报告鼠标屏幕锁定在日志中的 Windows 系统上使用 Synergy 的经验？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T17:17:25.330

Paul：Scroll-lock 键是“将鼠标锁定在这个屏幕上，不要让它离开”键。您可以通过在 ~/.synergy.conf 或 /etc/synergy.conf 的选项部分添加它来更改它

击键（f12）= lockCursorToScreen（切换）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-03-16T18:58:16.323

我遇到了同样的问题 - 注意：光标被锁定在屏幕上。

尝试了很多组合重新启动应用程序。删除监视器并在配置服务器中添加新监视器。但没有用。我从网址得到答案 - [http://www.lauramartin.co.nz/fix-synergy-cursor-is-locked-to-screen-unable-to-move-from-one-monitor-to-another/](http://www.lauramartin.co.nz/fix-synergy-cursor-is-locked-to-screen-unable-to-move-from-one-monitor-to-another/)

**解决方法很简单。你的主键盘是“滚动锁定”的。按键盘上的 Scroll Lock 键解锁“滚动锁定”。简单的**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T19:49:48.500

我在我的 Mac 上运行 Synergy 服务器，在 Vista 机器和 GNU/Linux (Gentoo) 机器上运行客户端。在 Vista 框中，我注意到当屏幕被锁定时，我无法使用共享 (Mac) 键盘解锁它。但是使用 Gentoo，这可以无缝地工作。我不确定解决方案是什么，但很高兴找到一个。

# c# - 签名中的匿名类型

> ID：238110
> 
> 赞同：5
> 
> 时间：2008-10-26T14:53:28.290
> 
> 标签：c#, asp.net-mvc, linq, anonymous-types

我正在尝试使以下方法的签名生效。由于这是匿名类型，我遇到了一些麻烦，任何帮助都会很棒。

当我在 QuickWatch 窗口中查看 sortedGameList.ToList() 时，我得到了签名

```
System.Collections.Generic.List<<>f__AnonymousType0<System.DateTime,System.Linq.IGrouping<System.DateTime,DC.FootballLeague.Web.Models.Game>>> 
```

非常感谢

唐纳德

```
 public List<IGrouping<DateTime, Game>> getGamesList(int leagueID)
{
    var sortedGameList =
        from g in Games
        group g by g.Date into s
        select new { Date = s.Key, Games = s };

    return sortedGameList.ToList();

} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-26T15:07:54.283

您不应该返回匿名实例。

您不能返回匿名类型。

创建一个类型（命名）并返回：

```
public class GameGroup
{
  public DateTime TheDate {get;set;}
  public List<Game> TheGames {get;set;}
} 
```

//

```
public List<GameGroup> getGamesGroups(int leagueID)
{
  List<GameGroup> sortedGameList =
    Games
    .GroupBy(game => game.Date)
    .OrderBy(g => g.Key)
    .Select(g => new GameGroup(){TheDate = g.Key, TheGames = g.ToList()})
    .ToList();

  return sortedGameList;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-26T15:06:58.217

~~选择新的 { Date = s.Key, Games = s.ToList() };~~

编辑：那是错误的！我认为这会做到。

```
public List<IGrouping<DateTime, Game>> getGamesList(int leagueID)
{
    var sortedGameList =
        from g in Games
        group g by g.Date;

    return sortedGameList.ToList();
} 
```

不，您不需要选择！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-26T15:03:49.953

简单的答案是：不要使用匿名类型。

与该匿名类型最接近的是 IEnumerable<object>。问题是，任何使用你的东西的人都不知道如何处理类型“不可预测”的对象。

相反，制作一个像这样的类：

```
public class GamesWithDate {
    public DateTime Date { get; set; }
    public List<Game> Games { get; set; }
} 
```

并将您的 LINQ 更改为：

```
var sortedGameList =
    from g in Games
    group g by g.Date into s
    select new GamesWithDate { Date = s.Key, Games = s }; 
```

现在您返回 List<GamesWithDate>。

# sharepoint - 分析 SharePoint 应用程序的最佳实践

> ID：238113
> 
> 赞同：3
> 
> 时间：2008-10-26T14:54:33.607
> 
> 标签：sharepoint, profiling

当您正在使用的 SharePoint 应用程序的响应时间不令人满意时，您如何查明原因以及按什么顺序？到目前为止，我还没有找到任何特定于 SharePoint 部分的开源或商业分析工具，因此任何指向工具或最佳实践的指针都将受到赞赏。

PS。我知道 Web 部件的分析选项，但我正在寻找涵盖整个应用程序的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T15:11:57.207

我的建议是查看以下内容：

*   **数据层** 检查并查看您的数据库是否正在运行，以及哪些请求需要花费大量时间。您在 SharePoint 中看到的所有内容的 90% 都存储在某个数据库中。运行 SQL Profiler 几个小时并检查您的日志。

*   **网站集** 我在 SharePoint 中发现，您对网站和网站集的安排越深入，性能下降得越深。这纯粹是轶事，所以带着一粒盐。

除此之外，我不知道有多少 SharePoint 分析工具。我使用 SharePoint 的经验使我摆脱了繁重的自定义工作，转而使用更多功能 OOTB。我很少推荐使用 SharePoint 作为应用程序平台。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T21:04:18.120

RedGate 有一个关于使用 ANTS Profiler 分析整个 Sharepoint 站点集合的文档：

[文档](http://www.red-gate.com/support/Knowledgebase/ANTS_Profiler/AP4SharePoint.pdf)

我目前正在评估它，所以我不能说它是否有效以及它有多好。确保您使用版本 4.1，以便能够在低于 1024 的端口上分析 IIS 6.0。Windows 权限的设置可能有点“奇怪”，但正如我所说，我自己仍在评估它，不能说它有多好用.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T00:38:21.057

查看来自 Binary Wave 的名为 Sonar 的工具。它详细介绍了有关在 SharePoint 页面上加载哪些内容需要时间的一些有用信息：

[http://www.binarywave.com/products/sonar/default.aspx](http://www.binarywave.com/products/sonar/default.aspx)

您可以试用免费的精简版。

HTH 尼克·斯旺

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-25T19:07:35.547

正如 Michael 在上面所说的那样，Red Gate ANTS Profiler 是分析您的 SharePoint 代码的出色工具。

我的帖子在这里展示了启动和运行是多么容易，尽管您可能会争辩说它是针对您的特定代码的，但是当填充大型列表之类的东西时，可以测试性能问题。但是，如果您进入这个领域，您并不是真的在寻找分析器，而是在负载和规模测试方面更多。

[http://www.21apps.com/sharepoint/code-profiling-ants/](http://www.21apps.com/sharepoint/code-profiling-ants/)

希望这可以帮助。

安德鲁

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T19:53:41.320

不幸的是，很多 Sharepoint 开发都是原始的。对于您想要的东西，我会将您认为缓慢的逻辑和区域提取到一个独立程序中，然后使用 Web 服务从 Sharepoint 中提取数据，以便对其进行测试。

如果不是这样，那么开始在您不确定的代码周围放置一堆计时器并打印输出。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-08-23T05:38:09.450

我已经使用[EQATEC Profiler](http://www.eqatec.com/Profiler/Home.aspx)成功地分析了 SharePoint 2010 。奖励是他们有免费版。

在此处进行设置的步骤：http: [//blogs.visigo.com/chriscoulson/performance-profiling-a-sharepoint-2010-project-using-eqatec-profiler/](http://blogs.visigo.com/chriscoulson/performance-profiling-a-sharepoint-2010-project-using-eqatec-profiler/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-04-15T12:56:11.817

您可以使用 Visual Studio 中的内置分析工具：http: [//msdn.microsoft.com/en-us/library/hh322089.aspx](http://msdn.microsoft.com/en-us/library/hh322089.aspx)

> “本演练展示了如何使用 Visual Studio 中的分析工具来优化 SharePoint 应用程序的性能。示例应用程序是一个 SharePoint 功能事件接收器，其中包含一个空闲循环，该循环会降低功能事件接收器的性能。Visual Studio 分析器使您能够定位并消除项目中最昂贵（性能最慢）的部分，也称为热路径。”

# python - python libsvn有windows实现吗？

> ID：238151
> 
> 赞同：1
> 
> 时间：2008-10-26T15:39:36.387
> 
> 标签：python, svn, hook, pre-commit

因为 windows 不区分大小写，并且因为 SVN 区分大小写，并且因为 VS2005 倾向于重命名文件，给它们以小写形式，这会扰乱我的存储库的历史，所以我尝试从[http:/添加预提交钩子脚本/svn.collab.net/repos/svn/trunk/contrib/hook-scripts/case-insensitive.py](http://svn.collab.net/repos/svn/trunk/contrib/hook-scripts/case-insensitive.py)。果然，该脚本使用了 python 的 libsvn 中的类（“from svn import repos, fs”），我找不到为 Windows 编译的类。有替代方案吗？到 libsvn 还是到钩子脚本？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T17:02:43.757

libsvn 有两种可选的 Python 绑定：

*   [pysvn](http://pysvn.tigris.org/) _
*   [颠覆](https://launchpad.net/subvertpy)。

Subvertpy 相当新，由[bzr-svn的作者编写：](http://bazaar-vcs.org/BzrForeignBranches/Subversion) [bzr](http://bazaar-vcs.org/)的透明[svn](http://subversion.apache.org/)互操作桥。

有一段时间，bzr-svn 使用了上游的[SWIG](http://www.swig.org/) Python 绑定，作者贡献了很多 bug 修复。它帮助将上游 python 对“严重损坏”的支持转移到“痛苦的加重和不符合 python 的”。因此，在为 SWIG 浪费了太多时间之后，作者决定制作自己的绑定。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T19:20:27.033

Tigris.org 为 libsvn 预编译的 python 绑定是一个单独的下载。可以在[此处](http://subversion.tigris.org/files/documents/15/44104/svn-win32-1.5.4_py25.zip)找到截至 10 月 27 日的最新信息。

[这里](http://subversion.tigris.org/getting.html#windows)列出了其他二进制 SVN 发行版，它们可能有不同的绑定 python 绑定的策略。

# sql-server - 在托管代码中实现 SQL Server 2008 用户定义函数以进行地理编码

> ID：238162
> 
> 赞同：1
> 
> 时间：2008-10-26T15:57:21.470
> 
> 标签：sql-server, visual-studio, visual-studio-2008, sql-server-2008, virtual-earth

**目标：**
要创建一个 .NET dll，我可以从 SQL Server 内部引用，我可以在其中传入地址并取回地理编码字符串，我可以在 t-SQL 中使用[STPointFromText()作为 POINT 粘贴到地理数据类型中。](http://msdn.microsoft.com/en-us/library/bb933979.aspx)

我正在使用 Virtual Earth，我注册了一个[开发者帐户](https://mappoint-css.live.com/mwssignup)，让我可以访问 Virtual Earth 登台服务器。

[我正在尝试以与此处](http://www.developer.com/net/csharp/article.php/10918_3399881_3)显示的示例类似的方式创建用户定义的函数，尽管当然使用的是 Visual Studio 2008。我有我在 ASP.NET 中编写的代码，它使用虚拟地球来传递地址并取回纬度/对数坐标。

**问题：**
唯一的问题是虚拟地球要求您为[地理编码服务](http://staging.dev.virtualearth.net/webservices/v1/geocodeservice/geocodeservice.svc)“添加服务参考”，并且由于某种原因，当我进入项目菜单时，有*Add Reference*和*Add Web Reference*，但没​​有*Add Service Reference* 这是什么我需要能够调用*geocodeService.Geocode(geocodeRequest)*来完成所有的魔法。

有人可以告诉我我在做什么错吗？为什么无法在 Visual Studio 中向 SQL Server 项目添加服务引用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T16:04:15.653

右键单击 Sql Server 项目，转到属性，确保目标框架设置为 .Net 3.5。我的猜测是它的目标是 .Net 2.0 FW。

如果您确实需要坚持使用 2.0 框架，请在浏览器中打开 .svc 链接并提取[wsdl url](http://staging.dev.virtualearth.net/webservices/v1/metadata/geocodeservice/geocodeservice.wsdl)，您可以改为执行“添加 Web 引用”

# java - 在您的经验中发现了最差的 Java 实践？

> ID：238173
> 
> 赞同：29
> 
> 时间：2008-10-26T16:06:59.920
> 
> 标签：java

类似于[这个问题](https://stackoverflow.com/questions/233030/worst-php-practice-found-in-your-experience)...

您在 Java 代码中实际发现的最糟糕的做法是什么？

我的是：

*   在 servlet 中使用实例变量（实际上，这不仅是不好的做法，而且是错误）
*   使用像 HashMap 这样的 Collection 实现，而不是使用适当的接口
*   使用看似神秘的类名，如 SmsMaker (SmsFactory) 或 CommEnvironment (CommunicationContext)

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2008-10-26T17:43:24.377

我必须维护 java 代码，其中大部分异常处理如下：

```
catch( Exception e ) {} 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-08-03T06:48:11.260

一旦我遇到“单例”异常：

```
class Singletons {
    public static final MyException myException = new MyException();
}

class Test {
    public void doSomething() throws MyException {
        throw Singletons.myException;
    }
} 
```

**每次都抛出相同的异常实例**......具有完全相同的堆栈跟踪，这与实际代码流无关:-(

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-08-02T18:08:20.787

六个非常糟糕的例子；

*   而不是错误报告，只是 `System.exit`没有警告。例如
    `if(properties.size()>10000) System.exit(0);`深埋在图书馆中。
*   使用字符串常量作为锁。例如`synchronized("one") { }`。
*   锁定可变字段。例如`synchronized(object) { object = ...; }`。
*   在构造函数中初始化静态字段。
*   触发异常只是为了获取堆栈跟踪。例如`try { Integer i = null; i.intValue(); } catch(NullPointerException e) { e.printStackTrace(); }`。
*   无意义的对象创建，例如`new Integer(text).intValue() or worse new Integer(0).getClass()`

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-10-29T18:33:49.310

```
if{
 if{
  if{
   if{
    if{
     if{
      if{
       if{
         .... 
```

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2008-10-26T16:59:27.163

我讨厌人们创建接口只是为了将一组常量挂在：

```
public interface InterfaceAntiPattern {
  boolean BAD_IDEA = true;
  int THIS_SUCKS = 1;
} 
```

— 接口用于指定行为契约，而不是用于包含常量的便利机制。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2008-10-26T16:16:47.937

与 Java 没有严格的关系，但是当你知道它不会改变时，一遍又一遍地调用一个昂贵的函数而不是存储结果。例子：

```
if (expensiveFunction() > aVar)
    aVar = expensiveFunction();
for (int i=0; i < expensiveFunction(); ++i)
    System.out.println(expensiveFunction()); 
```

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2008-10-27T01:15:35.413

几乎涵盖所有其他 Java 实践的最糟糕的 Java 实践：**全局可变状态。**

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2008-10-27T02:49:32.293

具有 10+ 级深度的类层次结构的可笑 OO 狂热。

这就是名字`DefaultConcreteMutableAbstractWhizzBangImpl`的来源。只需尝试调试这种代码 - 您将在类树上上下晃动几个小时。

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2008-10-26T17:13:26.247

当你不应该进行子类化时，例如，而不是使用组合、聚合等。

[编辑：这是锤子](https://stackoverflow.com/questions/237241/what-coding-mistakes-are-a-telltale-giveaway-of-an-inexperienced-programmer#237266)的特例。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2011-02-14T11:06:00.827

看到这样的东西：

```
public static boolean isNull(int value) {
    Integer integer = new Integer(value);

    if(integer == null) {
        return true;
    } else {
        return false;
    }
} 
```

他们对多头有类似的方法。

我想他们最初做了类似的事情

```
if(value == null) { 
```

并得到一个编译错误，但仍然没有意识到原始值不能为空。

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2008-10-26T18:12:30.713

我们的实习生使用`static`修饰符将当前登录的用户存储在 Seam 应用程序中。

```
 class Identity{
    ...
    public static User user; 
    ...
 }

 class foo{

    void bar(){
       someEntity.setCreator(Identity.user); 
    }

 } 
```

当然，当他测试它时它起作用了:)

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2008-10-26T17:21:50.987

将功能抽象到一个*永远不会被重用的库类中，因为它对于要解决的原始问题是如此具体*。因此，最终得到了一个没有人会使用的大量库类，它完全掩盖了您实际拥有的两个有用的实用程序**（**即`CollectionUtils`和`IOUtils`）。

...暂停呼吸...

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2009-08-02T16:12:55.637

我曾经不得不调查一个 Web 应用程序，其中所有状态都保存在发送到客户端的网页中，而 Web 服务器中没有状态。

虽然可以很好地扩展:)

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2009-10-01T10:32:22.313

在 finally{} 中不关闭数据库连接、文件句柄等

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2009-10-01T10:17:41.623

需要调用者执行以下操作的 API：

```
Foobar f = new Foobar(foobar_id);
f = f.retrieve(); 
```

以下任何一项都会更好：

```
Foobar f = Foobar.retrieve(foobar_id); 
```

或者

```
Foobar f = new Foobar(foobar_id); // implicit retrieve 
```

或者

```
Foobar f = new Foobar();
f.retrieve(foobar_id); // but not f = ... 
```

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2009-10-01T10:46:00.200

*为所有*私有变量创建访问器和修改器，无需停下来思考，有时是自动的。

发明封装是有原因的。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2008-10-26T16:14:04.710

[面向对象设计的过度抽象（仅删除了 10k）。](https://stackoverflow.com/questions/237719#237728)

类似线程上的相同答案（适用于所有允许面向对象设计的语言）。

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2011-02-16T23:55:39.793

# 不像程序员应该那样思考。

**在长时间暴露之后，Java 对某些人会这样做。**

为什么？我的观点是，这是因为**Intellisense 太多而没有 sense**。它可以让你快速做出愚蠢的事情，以至于人们不会停下来思考。

**示例 1：**

```
boolean negate( boolean shouldNegate, boolean value ) {
  return (shouldNegate?(!value):value;
} 
```

这当然与 value ^ shouldNegate 相同，一个简单的 XOR。

**示例 2：（**我发誓我不是编造的）

```
boolean isNotNull( Object o ) {
  return o != null;
} 
```

两者都有额外的 4-6 行 Javadoc，*解释*了这些方法的作用。

**示例 3：**

```
/**
*
*
*/ 
```

一个空的 Javadoc，使那些*烦人*的Eclipse“缺少 Javadoc”警告消失。

**示例 3b：**

```
/**
* A constructor. Takes no parameters and creates a new instance of MyClass.
*/
public MyClass() {
} 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2009-08-03T06:38:32.437

我最喜欢的排序算法，由灰胡子旅提供：

```
List needsToBeSorted = new List ();
...blah blah blah...

Set sorted = new TreeSet ();
for (int i = 0; i < needsToBeSorted; i++)
  sorted.add (needsToBeSorted.get (i));

needsToBeSorted.clear ();
for (Iterator i = sorted.iterator (); i.hasNext ();)
  needsToBeSorted.add (i.next ()); 
```

诚然，它奏效了，但最终我说服了他，也许 Collections.sort 会容易得多。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2011-01-12T20:07:47.023

在文件 I/O 中：不正确使用 try-catch 块。

```
try {
   /* open file */
}
catch(Exception e) {
  e.printStackTrace();
}

try {
   /* read file content */
}
catch (Exception e) {
  e.printStackTrace();
}

try {
   /* close the file */
}
catch (Exception e) {
  e.printStackTrace();
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2008-10-28T06:06:50.600

@madlep 没错！Java 社区的某些部分确实在极端抽象和疯狂的深度类层次结构方面做得过火了。几年前，史蒂夫·耶格（Steve Yegge）有一篇很好的博客文章：[名词王国的处决](http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html)。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-10-01T13:22:54.683

使用 for 循环或任何形式的循环就足够的异常来定义逻辑。

例子：

```
while(i < MAX_VALUE)
{
   try
   {
      while(true)
      {
         array[j] = //some operation on the array;
         j++;  

      }
   }
   catch(Exception e)
   {
      j = 0;
   }
} 
```

说真的，我认识写这段代码的人。我查看了它并更正了代码:)

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2010-07-29T08:32:28.257

几分钟前我看到了这条线：

```
Short result = new Short(new Integer(new Double(d).intValue()).shortValue()); 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-10-26T16:24:51.163

与您的类似，但更进一步：

当请求范围的变量是 Struts 操作中正确的事情时，使用类（静态）变量。:O

这实际上在生产中部署了几个月，直到有一天我审查代码之前没人注意到任何事情。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-10-01T11:07:15.423

过度关注重用导致到处都是静态事物的对象。（在某些情况下，重复使用可能非常有帮助）。

Java 内置了 GC，如果您需要一个对象，请创建一个新对象。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2011-01-12T19:50:51.960

这是我要维护的实际小程序的裁剪样本，我花了很长时间才意识到正在做什么。

```
int sval, eval, stepv, i;
double d;
                if (/*someCondition*/)
                    {
                    sval = 360;//(all values multiplied by 20)
                    eval = -271;
                    stepv = -10;
                    }
                else if (/*someCondition*/)
                    {
                    sval = 320;
                    eval = -601;
                    stepv = -10;
                    }
                else if (/*someCondition*/)
                    {
                    sval = 0;
                    eval = -311;
                    stepv = -10;

                    }
                    else
                    {
                    sval = 360;
                    eval = -601;
                    stepv = -10;
                    }
                for (i = sval; i > eval; i = i + stepv)
                    {
                    d = i;
                    d = d / 20.0;
                    //do some more stuff in loop
                    } 
```

原来他想在循环上迭代 0.5，这不是粘贴错误，这是缩进方案

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2012-02-15T11:06:39.763

巨大的类名。我记得：`AbstractTableComponentListeningBehaviourPanel.java`和其他类似的怪物。

最糟糕的是，即使命名约定非常详细，我仍然不得不将文件分开来确定它们的用途。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-10-01T10:50:27.713

初级程序员犯的一个错误：不必要地使用成员变量而不是局部变量。

Java EE 示例：

在 servlet 或 EJB 中启动线程（例如启动异步处理任务）。

这会破坏 Java EE 应用程序的可伸缩性。您不应该在 Java EE 组件中搞乱线程，因为应用程序服务器应该为您管理它。

我们通过让 servlet 将消息放在 JMS 队列上并编写消息驱动的 bean 来处理异步处理任务来重构这一点。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2010-10-26T17:02:50.020

我想这对我来说一定是一个记录。一个类用于为涉及过滤的前端构建复杂的数据模型。所以返回对象列表的方法是这样的：

```
 public DataObjectList (GenerateList (massive signature involving 14 parameters, three of which are collections and one is a collection of collections) 
try { 

250 lines of code to retrieve the data which calls a stored proc that parses some of it and basically contains GUI logic

 } catch (Exception e) {
            return new DataObjectList(e, filterFields);
        } 
```

所以我来到这里是因为我想知道为什么下面的调用方法失败了，我看不到 Exception 字段的设置位置。

```
DataObjectList dataObjectList= EntireSystemObject.getDataObjectList Generator().generateDataObjectList (viewAsUserCode, processedDataRowHandler, folderQuery, pageNumber, listCount, sortColumns, sortDirections, groupField, filters, firstRun, false, false, resetView);

dataObjectList.setData(processedDataRowHandler.getData());

if (dataObjectList.getErrorException() == null) {

do stuff for GUI, I think, put lots of things into maps ... 250 lines or so

       }
            return dataObjectList;
        } else {

put a blank version into the GUI and then  

            throw new DWRErrorException("List failed due to list generation error", "list failed due to list generation error for folder: " + folderID + ", column: " + columnID, List.getErrorException(), ListInfo);
        } 
```

到目前为止都和我在一起吗？

好吧，至少他们确实在前端告诉我们确实出了问题！

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2010-10-26T17:31:36.630

AbstractSpringBeanFactoryFactoryFacadeMutatorBeanFactory。我无法忍受这种过度设计、难以理解的废话。[Benji Smith](http://discuss.joelonsoftware.com/default.asp?joel.3.219431.12)说得更优雅一些。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2012-02-15T10:58:11.770

将裸 XML 消息（没有 XSD/命名空间）转换为 DataObject：

```
DataObject operation_file = boFactory....

try{operation_file.setString("file_name", Constants.getTagValue("file_name", eElementOp));}catch (Exception e){operation_file.setString("file_name","");}
try{operation_file.setDate("proposed_execution_date", sdf.parse(Constants.getTagValue("proposed_execution_date", eElementOp)));}catch (Exception e){operation_file.setString("proposed_execution_date",null);}
try{operation_file.setString("instructions", Constants.getTagValue("instructions", eElementOp));}catch (Exception e){operation_file.setString("instructions","");}
try{operation_file.setString("description", Constants.getTagValue("description", eElementOp));}catch (Exception e){operation_file.setString("description","");} 
```

我将其称为面向 try-catch 的编程（tcop）...

# lisp - 使用 SBCL 进行交叉编译

> ID：238174
> 
> 赞同：8
> 
> 时间：2008-10-26T16:07:42.617
> 
> 标签：lisp, common-lisp, cross-compiling, sbcl

我在 Ubuntu 机器上运行 SBCL。我想写一个小程序，我想送给一个只运行 Windows 的朋友。在我的机器上将它交叉编译成“独立”Windows程序（即通常的运行时+核心组合）的最快方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-26T21:55:35.833

我怀疑在 VM 上安装 Windows 并在那里编译您的应用程序将是最快的方法。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-28T13:28:41.270

SBCL 能够进行交叉编译，但由于在此过程中评估代码，您需要访问目标架构。[Christophe Rhodes 在SBCL: a Sanely-Bootstrapable Common Lisp](https://research.gold.ac.uk/2336/1/sbcl.pdf) 中很好地解释了 SBCL 的构建处理。

如果您没有直接访问 Windows 机器的权限，我想您可以尝试在模拟器或虚拟机管理程序（QEMU、HVM、Xen 等）中使用 Wine（我希望这会失败）或[ReactOS](http://www.reactos.org/) 。 .)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T08:11:02.457

内核特定于平台/版本组合。使用 Luís 的方法，或使用不同的 Lisp 分发，例如 CLisp。

> 不同的运行时支持程序之间绝对没有核心映像的二进制兼容性。即使是在不同时间从相同源构建的运行时也被视为不兼容。[SBCL 手册](http://www.sbcl.org/manual/Saving-a-Core-Image.html)

# c# - 如何将“选择数据源”添加到我的 Excel 应用程序？

> ID：238178
> 
> 赞同：1
> 
> 时间：2008-10-26T16:12:58.770
> 
> 标签：c#, excel, user-interface

我需要将“选择数据源”对话框添加到我的应用程序中，以便用户可以在 Excel 中手动选择一个（或多个）范围，并将该范围粘贴到我的文本框中。此功能在 Excel 中无处不在（尤其是在为图表选择范围时）。我怎样才能轻松做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T17:08:14.493

您是否尝试过使用 refedit 控件？

[如何将 RefEdit 控件与用户窗体一起使用](http://support.microsoft.com/kb/213776)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T02:16:47.973

```
Dim myRange As Range
  On Error Resume Next
  Set myRange = Application.InputBox(prompt:="Select the cells you want", Type:=8)
  On Error GoTo 0
  If myRange Is Nothing Then
    MsgBox "User cancelled"
  Else
    MsgBox "User selected " & myRange.Address
  End If 
```

这将显示一个输入对话框。不要在其中输入任何内容，而是用鼠标选择单元格，它们的地址将出现在对话框文本框中。当您按下 OK 时，它们应该被分配给变量 myRange。

注意： InputBox 行末尾的“Type:=8”告诉 VBA 这必须是一个单元格区域 On Error 位可防止用户取消时出错

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T18:10:19.267

我们发现了这个，看起来它可能是完美的（.NET 兼容）：

[如何编写 .NET REFEDIT 控件](http://blogs.msdn.com/gabhan_berry/archive/2008/06/12/net-refedit-control.aspx)

# configuration - 是否可以更改 Mercurial 中的默认差异工具？

> ID：238183
> 
> 赞同：63
> 
> 时间：2008-10-26T16:14:44.350
> 
> 标签：configuration, mercurial, diff

每次我这样做时，`hg diff file.ext`我最终都会使用控制台差异应用程序。我想使用 Kdiff3 或 WinMerge（我使用的是 Windows）。

有没有办法改变它？我在 Mercurial 文档中找不到参考（**我不是在谈论合并！**）。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-10-27T18:45:54.217

我已经使用 Mercurial 内置扩展解决了这个问题......我只需将以下行添加到 Mercurial.ini（在 Mercurial 文件夹上）：

```
[extensions]
hgext.extdiff=

[extdiff]
cmd.vdiff = kdiff3 
```

当我想使用 kdiff3 而不是 diff 时，我只需要使用：

```
hg vdiff file.ext 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-09-18T14:53:50.460

有了这个配置

```
[extdiff]
cmd.kdiff3 = 
```

我使用这个命令来查看差异：

```
hg kdiff 
```

这显示了一个目录树，其中包含所有已更改的文件。您单击一个文件以查看该文件的差异。您可以在命令中添加文件参数以仅查看一个文件。

更多信息[在这里](https://www.mercurial-scm.org/wiki/KDiff3)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-09-07T13:24:01.167

如果您正在寻找类似的东西`git difftool`，您不需要键入文件名并查看所有更改文件的差异，请将这些添加到您的`~/.hgrc`，然后运行`hg difftool`​​.

```
[extensions]
extdiff =

[extdiff]
cmd.vimdiff = vimdiff

[alias]
difftool = !for file in $(hg status -n); do hg vimdiff $file; done 
```

或对于窗户：

```
[alias]
difftool = !FOR /f %F IN ('hg status -nmar') DO hg vimdiff %F 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-12-23T17:13:07.733

几分钟前我刚遇到这个问题；我刚刚安装它并将其路径（默认为 c:\program files\kdiff3）添加到我的系统 PATH ev 重新启动我的窗口以获取新路径，并且“hg kdiff3”刚刚工作。事实证明，以下内容位于我的基本“mercurial.ini”文件中，这允许 kdiff3 为系统上的所有 hg 存储库工作。

```
[extensions]  
hgext.extdiff =  

[extdiff]  
cmd.kdiff3 =

[merge-tools]  
kdiff3.args = $base $local $other -o $output 
```

# c# - 定义一个接受不同参数的接口方法

> ID：238184
> 
> 赞同：11
> 
> 时间：2008-10-26T16:15:12.260
> 
> 标签：c#, .net, oop

我的应用程序使用连接到 PC 的测量仪器。我想让使用来自不同供应商的类似仪器成为可能。

所以我定义了一个接口：

```
interface IMeasurementInterface
    {
        void Initialize();
        void Close();
    } 
```

到目前为止，一切都很好。在测量之前，我需要设置仪器，这意味着不同仪器的参数非常不同。所以我想定义一个方法，它接受可以有不同结构的参数：

```
interface IMeasurementInterface
{
    void Initialize();
    void Close();
    void Setup(object Parameters);
} 
```

然后我会将对象投射到我需要的任何东西上。这是要走的路吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-26T16:27:14.530

您最好提出一个抽象的“参数”类，该类由每个不同的仪器参数扩展......例如，然后使用泛型来确保将正确的参数传递给正确的类......

```
public interface IMeasurement<PARAMTYPE> where PARAMTYPE : Parameters
{
    void Init();
    void Close();
    void Setup(PARAMTYPE p);
}

public abstract class Parameters
{

} 
```

然后对于每个特定的设备，

```
public class DeviceOne : IMeasurement<ParametersForDeviceOne>
{
    public void Init() { }
    public void Close() { }
    public void Setup(ParametersForDeviceOne p) { }
}

public class ParametersForDeviceOne : Parameters
{

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T16:50:42.000

对我来说，听起来[工厂](http://en.wikipedia.org/wiki/Factory_method_pattern)模式可能很有用，特别是如果您要对您的应用程序进行单元测试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T06:26:29.110

如果您要处理不止一种设备类型，那么控制器 + 设备接口分离（使用名称值对进行通信）将是一个很好的解决方案

**脱钩**

使用名称值对允许您将代码分离为设备 + 控制器 + 应用程序代码结构

**示例代码**

```
class DeviceInterface
    {
    void Initialize(IController & Controller);
    void Close();
    bool ChangeParameter(const string & Name, const string & Value); 
    bool GetParam(string & Name, string &Value );
    } 
```

每个设备实现在创建时都应使用可以接受其命令并将其转换为实际设备命令的控制器的标识来创建

```
interface IController
   {
   Initialize(DeviceSpecific & Params);
   Close();
   bool ChangeParameter(string & Name, string & Value);
   bool ChangeParams(string & Name[], string &Value []);
   } 
```

您的用户代码看起来像这样

```
IController     objController = new MeasurementDevice(MeasureParram);

DeviceInterface MeasureDevice = new DeviceInterface(objController);

string Value;

MeasureDevice.GetParam("Temperature", Value);

if (ConvertStringToInt(Value) > 80)
     {
     MeasureDevice.ChangeParameter("Shutdown", "True");
     RaiseAlert();
     } 
```

DeviceInterface 类应该做的就是将命令传递给控制器​​。控制器应负责设备通信。

**接口分离的优点**

**防止更改**

这种解耦将允许您将应用程序代码与控制器隔离开来。设备中的更改不会影响您的用户代码

**应用程序代码的可维护性**

此外，用户代码总是干净的，您只需要关心应用程序逻辑。但是，如果您定义了多个接口/创建的模板或具有多种类型的特定于控制器的参数结构的泛型，那么您的代码中将包含大量与设备相关的垃圾，这可能会损害可读性并在您的设备/其参数发生变化时产生维护问题。

**易于实施**

您还可以将不同的控制器实现划分到自己的项目中。此外，您的应用程序还可以使用 XML 文件等以更动态的方式配置命令和响应，这些文件可以与控制器类一起发布，从而使您的整个应用程序在本质上变得更加动态。

**现实生活**

该领域领导者的最新生产控制器项目之一以相同的方式工作。但他们使用 LON 进行设备通信。

**朗?**

控制器（想想空调/锅炉/风扇等）网络中使用的 LON 协议使用此概念与各种设备通信

因此，您需要的只是一个可以与您的设备对话的单一接口，然后使用 LON 将名称值对发送给它。他使用标准协议还可以让您与测量仪器以外的其他设备通话。如果您的设备使用 LON，则可以使用 LON 的开源实现。

如果您的设备不支持 LON，那么您可能必须设计一些东西，其中用户代码仍然适用于名称值对，并且相反的接口将您的名称值对转换为等效的对应控制器 struct+ 并以设备的方式与个人设备通信明白。

希望这有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T07:28:19.717

这首先取决于您将如何获取参数。如果它们存储在某个数据库表或配置文件中，并且只是需要设置的值，那么传入字典可能会这样做（尽管您确实会失去类型安全性）。如果您的设置过程会稍微复杂一点，那么我会考虑进一步抽象设置过程并执行双重调度（将转换操作推入新的设置类）。像这样

```
public interface IMeasurementInterface
{
  void Initialize();
  void Close();
  void Setup( IConfigurer config );
}

public interface IConfigurer
{
  void ApplyTo( object obj );
}

public abstract ConfigurerBase<T> : IConfigurer where T : IMeasurementInterface
{
  protected abstract void ApplyTo( T item );

  void IConfigurator.ApplyTo(object obj )
  {
    var item = obj as T;
    if( item == null )
      throw new InvalidOperationException("Configurer can't be applied to this type");
    ApplyTo(item);
  }
} 
```

这样，您就不会弄乱您的 Measurement 类层次结构（或不提供任何实现并假设所有实现无论如何都会做您想要的）。这也意味着您可以通过传入一个假的（或模拟的）测量设备来测试您的设置代码。

如果设置过程需要操作私有或受保护的数据，那么您可以使 IConfigurer 的具体实现驻留在其相应的 Measurement 类中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T12:28:34.480

我的软件必须这样做，因为我需要支持许多不同类型的金属切割机运动控制器。

您的界面具有您需要的基础知识。您需要记住的是，您不需要传入参数列表。您指出每种类型的设备可能具有非常不同的设置类型。

我这样做的方式如下

```
interface IMeasurementInterface
{
    void Initialize();
    void Close();
    void Setup();
    void Read (FileReader as <whatever read file object you are using>)
    void Store (FileReader as <whatever read file object you are using>)
    string Name();
} 
```

安装程序调用在 IMeasurementDevice 的程序集中创建的对话框。该对话框在程序集之外不可见。

现在我知道一些面向对象或 MVC 纯粹主义者可能会反对这一点。然而，我觉得隐藏特定测量类内部的概念胜过严格遵守 MVC 架构。

我的一般理念是，简单的对话框在同一个程序集中实现，前提是它对程序集是私有的，并且由在我设置的标准接口上实现的对象调用。再次这样做的原因是，我发现隐藏内部结构比尝试在顶层程序集中实现所有对话框更有价值。

通过指定读取方法和存储方法，您无需公开内部设置参数以进行保存。您只需要传递您用来保存设置参数的任何类型的文件存储对象。

最后，就像另一张海报所说，您需要在包含所有测量设备的程序集中设置一个工厂类。在设置期间，您需要实例化此类并检索支持的测量设备列表。

我这样做的方式是我的工厂类检索运动控制器列表。此列表是存储所有设置类的主类的一部分。当我阅读我的设置文件时，我得到了实际使用的控制器。我从列表中检索这些类，并将它们放在另一个在切割过程中实际使用的列表中。

我这样做的原因是，当用户设置运动控制器时，他需要能够从所有可用控件的列表中选择，以便告诉软件他拥有哪一个。我发现保留可用控制器列表的响应速度更快。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T16:23:16.767

那可能会奏效。另一种选择是在字典中传递参数。

# batch-file - 如何在我的 Windows 上下文菜单中创建函数

> ID：238194
> 
> 赞同：0
> 
> 时间：2008-10-26T16:20:19.223
> 
> 标签：batch-file, contextmenu

在将它们上传到生产环境之前，我使用[jsmin压缩我的 javascript 文件。](http://www.crockford.com/javascript/jsmin.html)

由于我倾向于每页有一个“代码隐藏”javascript 文件，因此我经常这样做。

我安装了一个 Windows Powertoy，它在 Windows 资源管理器中添加了一个上下文菜单项，所以我可以“在此处打开命令窗口”。当我单击它时，命令提示符会在正确的目录中打开。这样可以节省一点打字。

但是，我仍然需要输入如下内容：

```
jsmin <script.js> script.min.js 
```

让它工作。这很麻烦。

我想创建一个上下文菜单项，允许我右键单击 *.js 文件并选择“jsmin-compress this file”。然后调用jsmin，将原始文件压缩成“ **original_filename.min.js** ”

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T16:58:19.677

以下是如何在 .js 文件的上下文菜单中添加条目：

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\JSFile\shell\JSMinify]
@="JSMinify" 

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\JSFile\shell\JSMinify\Command]
@="cmd.exe /c \"implement whatever cmd-friendly functions you want here (can use %1 and %%f) " 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T16:26:00.287

您可以将批处理脚本的链接放到用户 sendto 目录中。就像是

```
jsmin %1 script.min.js 
```

这是我通常做的

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T16:29:28.270

您可以使用批处理文件并打开方式...

```
 Set jsminPath="C:\SomePath\jsmin.exe"
  %~d1 
  CD %~d1%~p1 
  %jsminPath% "%~n1.js" "%~n1.min.js" 
```

# c# - 如何将 Xml 属性绑定到 Treeview 节点，同时将 XDocument 数据绑定到 WPF Treeview

> ID：238196
> 
> 赞同：4
> 
> 时间：2008-10-26T16:21:38.143
> 
> 标签：c#, wpf, data-binding, xaml, treeview

我有一个需要数据绑定到**WPF TreeView**的 XML 。这里的 XML 可以有不同的结构。TreeView 应该是足够通用的数据绑定来加载层次结构的任何排列。但是，节点上的**XAttribute**（称为**Title**）应该数据绑定到 TreeViewItem 的**标题文本**而**不是 nodename**。

要绑定的 XML：

```
<Wizard>
  <Section Title="Home">
    <Loop Title="Income Loop">
      <Page Title="Employer Income"/>
      <Page Title="Parttime Job Income"/>
      <Page Title="Self employment Income"/>
    </Loop>
  </Section>
  <Section Title="Deductions">
    <Loop Title="Deductions Loop">
      <Page Title="Travel spending"/>
      <Page Title="Charity spending"/>
      <Page Title="Dependents"/>
    </Loop>
  </Section>
</Wizard> 
```

XAML：

```
<Window x:Class="Wpf.DataBinding.TreeViewer"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:Wpf.DataBinding"
    Title="TreeViewer" Height="300" Width="300">
    <Window.Resources>
        <HierarchicalDataTemplate ItemsSource="{Binding Path=Elements}" x:Key="TVTemplate">
            <TreeViewItem Header="{Binding Path=Name}"/>
        </HierarchicalDataTemplate>
    </Window.Resources>
    <StackPanel>
        <TreeView x:Name="_treeView" Style="{StaticResource TVallExpanded}"
                ItemsSource="{Binding Path=Root.Elements}"
                ItemTemplate="{StaticResource TVTemplate}" />
    </StackPanel>
</Window> 
```

XAML 的代码隐藏将 XML 加载到 XDocument 并将其绑定到 TreeView

```
public partial class TreeViewer : Window
{
    public TreeViewer()
    {
        InitializeComponent();
        XDocument doc = XDocument.Parse(File.ReadAllText(@"C:\MyWizard.xml"));
        _treeView.DataContext = doc;
    }
} 
```

因此，在 XAML 标记中，我们将 Name 绑定到 TreeViewItem 的标头。

```
<TreeViewItem Header="{Binding Path=Name}"/> 
```

但是，我想将它绑定到上面 Xml 中 Section、Loop 和 Page 的**Title**属性。我读到在绑定 XDocument 时无法使用 XPath。但是必须有一种方法可以将**Title**属性绑定到 TreeViewItem 的 Header 文本。我尝试使用@Title、.[@Title] 等。但似乎都没有。

[MSDN 论坛](http://social.msdn.microsoft.com/forums/en-US/wpf/thread/edd843b7-b378-4c2d-926f-c053dbd7b340)上的这个帖子有类似的讨论。

任何指针都会非常有帮助。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-26T17:12:18.883

万岁！！！我想出了如何绑定 XAttribute。它不直观，也不容易想象。但这是如何做到的。

```
<TreeViewItem Header="{Binding Path=Attribute[Title].Value}"/> 
```

很难想象 Title 可以直接用在方括号中。

[更多 @ 这个 MSDN 链接](http://msdn.microsoft.com/en-us/library/cc165615.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T16:54:40.183

我认为您需要做的就是为您的 XML 中的每个节点类型创建一个[HierarchicalDataTemplate](http://msdn.microsoft.com/en-us/library/system.windows.hierarchicaldatatemplate.aspx)，将您的 xml 加载到[XmlDataProvider](http://msdn.microsoft.com/en-us/library/ms749287.aspx)中，然后将其绑定*到*TreeView。电视与 XDP 一起工作以绑定数据，并且在某处它们会找出您定义的 HDT 并将它们的 DataType 与 XML 中节点的名称相匹配。您的 XPATH 会随着不同类型的数据而变化，您可能会遇到一些问题，但保持这些灵活性是另一个问题。

例如，我有一个小的正则表达式测试应用程序。它包括一个帮助系统，它基本上是树中列出的所有不同的正则表达式部分：类别和带有描述、工具提示和其他内容的部分。有关零件的数据存储为 xml 数据源。由于它是静态的，我只是用应用程序的资源创建了一个静态资源：

```
<XmlDataProvider
    x:Key="rxPartData"
    XPath="RegexParts">
    <x:XData>
        <RegexParts
            xmlns="">
            <Category
                Name="Character class"
                ToolTip="Sets of characters used in matching">
                <RegexPart
                    Regex="[%]"
                    Hint="Positive character group"
                    ToolTip="Matches any character in the specified group (replace % with one or more characters)" />
                <!-- yadda -->
            </Category>
        </RegexParts>
    </x:XData>
</XmlDataProvider> 
```

接下来，我为数据中的每个节点类型创建了[HierarchicalDataTemplates](http://msdn.microsoft.com/en-us/library/system.windows.hierarchicaldatatemplate.aspx)（同样，所有这些都在应用程序的资源中）：

```
<!-- Category data template -->
<HierarchicalDataTemplate
    DataType="Category"
    ItemsSource="{Binding XPath=*}">
    <TextBlock
        Focusable="False"
        Text="{Binding XPath=@Name}"
        ToolTip="{StaticResource CategoryTooltip}"
        ToolTipService.InitialShowDelay="0"
        ToolTipService.ShowDuration="{x:Static sys:Int32.MaxValue}"
        ToolTipService.HasDropShadow="True" />
</HierarchicalDataTemplate>
<!-- RegexPart data template -->
<HierarchicalDataTemplate
    DataType="RegexPart"
    ItemsSource="{Binding XPath=*}">
    <WrapPanel
        Focusable="False"
        ToolTip="{StaticResource RegexPartTooltip}"
        ToolTipService.InitialShowDelay="0"
        ToolTipService.ShowDuration="{x:Static sys:Int32.MaxValue}"
        ToolTipService.HasDropShadow="True">
        <TextBlock
            Text="{Binding XPath=@Regex}" />
        <TextBlock
            Text=" - " />
        <TextBlock
            Text="{Binding XPath=@Hint}" />
    </WrapPanel>
</HierarchicalDataTemplate> 
```

最后，我只是将树绑定到 XmlDataProvider：

```
<TreeView
  Name="_regexParts"
  DockPanel.Dock="Top"
  SelectedItemChanged="RegexParts_SelectedItemChanged"
  ItemsSource="{Binding Source={StaticResource rxPartData}, XPath=/RegexParts/Category}"
  ToolTip="Click the + to expand a category; click a part to insert it">
</TreeView> 
```

这就是你所要做的。TreeView 和[XmlDataProvider](http://msdn.microsoft.com/en-us/library/ms749287.aspx)将负责为数据中的正确节点查找和使用正确[的 HDT 。](http://msdn.microsoft.com/en-us/library/system.windows.hierarchicaldatatemplate.aspx)所有这一切中最困难的部分是找出用于绑定的 xpath。它可能会有点棘手，好像你的路径不正确，你最终会在树中一无所获并且不会有任何错误（有一些方法可以增加 WPF 中数据绑定中的错误报告，但这是另一个问题） .

# ms-word - 如何在不丢失格式的情况下更改 Word.Range 文本

> ID：238215
> 
> 赞同：0
> 
> 时间：2008-10-26T16:28:48.020
> 
> 标签：ms-word, ms-office, add-in, text-formatting

任何人都知道如何更改 Word.Range 对象的文本但仍保持其格式？例如，如果我有“this **text** ”并将其更改为“that **txt** ”，则 txt 仍将是粗体。

我正在寻找一种方法来更改范围的整个文本，而不仅仅是一个单词，因为我从独立的 API 获取新文本，我可以假设新文本和旧文本具有相同的数字的话。

这是我到目前为止得到的：

```
 for (int i = 0; i < oldWords.Length; i++)
    {
        if (oldWords[i] == newWords[i])
            continue;

        object Replace = WdReplace.wdReplaceOne;
        object FindText = oldWords[i];
        object ReplaceWith = newWords[i];
        var success = Sentence.Find.Execute(parameters stub);
    } 
```

但是由于某种原因，它只在第一次 Execute 中成功，因为范围选择仍然在找到的单词上。

编辑：知道了，每次执行后，我都恢复了 Range 的原始结束位置。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-21T03:59:34.157

您不能使用该`Execute`方法更改带有格式的文本。你可以这样做：

```
Range rng=doc.Content;
rng.Find.Execute(ref finding, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing)

//if this method returns true, you will get the range at the finding location.
if(rng.Find.Found)
{
  rng.Text='sth';
  rng.Bold=0;
} 
```

也许这可以帮助你。

# c# - HTML 到 PostScript 的转换

> ID：238217
> 
> 赞同：1
> 
> 时间：2008-10-26T16:29:37.223
> 
> 标签：c#, .net, postscript

我正在寻找可以将 HTML 转换为 PostScript（.ps 文件格式）的免费组件或库。我正在使用 .Net 框架 1.1。有没有人遇到过这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T16:44:45.960

您可以使用 HTML 查看器控件并将 html 打印到输出到文件的 PostScript 打印机。不是很优雅，但它会工作。我认为有执行此操作的 unix 工具，因此您可能会为其中一个找到 Windows 端口并通过 Process.Start 使用它。

# python - 在 ply 的正则表达式中匹配 unicode

> ID：238223
> 
> 赞同：4
> 
> 时间：2008-10-26T16:35:07.803
> 
> 标签：python, regex, unicode, ply, character-properties

我正在匹配标识符，但现在我遇到了一个问题：我的标识符允许包含 unicode 字符。因此，旧的做事方式是不够的：

```
t_IDENTIFIER = r"[A-Za-z](\\.|[A-Za-z_0-9])*" 
```

在[我的标记语言](http://freehg.org/u/cheery/aml/)解析器中，我通过允许除我明确使用的字符之外的所有字符来匹配 unicode 字符，因为我的标记语言只有两个或三个我需要以这种方式转义的字符。

如何将所有 unicode 字符与 python 正则表达式和 ply 匹配？这也是一个好主意吗？

我想让人们在他们的程序中使用像 Ω » « ° foo² väli π 这样的标识符作为标识符（变量名等）。见鬼！如果可行，我希望人们可以用自己的语言编写程序！无论如何，如今在很多地方都支持 unicode，它应该传播开来。

编辑：python 正则表达式似乎无法识别 POSIX 字符类。

```
>>> import re
>>> item = re.compile(r'[[:word:]]')
>>> print item.match('e')
None 
```

编辑：为了更好地解释我需要什么。我需要一个匹配所有 unicode 可打印字符但根本不匹配 ASCII 字符的正则表达式。

编辑： r"\w" 做了一些我想要的东西，但它不匹配« »，我还需要一个不匹配数字的正则表达式。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-26T21:18:53.630

[re](http://docs.python.org/library/re#regular-expression-syntax)模块支持\w 语法：

> 如果设置了 UNICODE，这将匹配字符 [0-9_] 加上 Unicode 字符属性数据库中分类为字母数字的任何内容。

因此，以下示例显示了如何匹配 unicode 标识符：

```
>>> import re
>>> m = re.compile('(?u)[^\W0-9]\w*')
>>> m.match('a')
<_sre.SRE_Match object at 0xb7d75410>
>>> m.match('9')
>>> m.match('ab')
<_sre.SRE_Match object at 0xb7c258e0>
>>> m.match('a9')
<_sre.SRE_Match object at 0xb7d75410>
>>> m.match('unicöde')
<_sre.SRE_Match object at 0xb7c258e0>
>>> m.match('ödipus')
<_sre.SRE_Match object at 0xb7d75410> 
```

所以你要找的表达式是： (?u)[^\W0-9]\w*

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-12-14T10:26:38.087

您需要在 lex.lex 中传递传递参数重新标记：

```
lex.lex(reflags=re.UNICODE) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T16:58:56.370

检查这个问题的答案

[从python中的字符串中去除不可打印的字符](https://stackoverflow.com/questions/92438/stripping-non-printable-characters-from-a-string-in-python)

您只需要改用其他 unicode 字符类别

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T17:19:46.903

在 Vinko 的帮助下解决了这个问题。

我意识到获取 unicode 范围是愚蠢的。所以我会这样做：

```
symbols = re.escape(''.join([chr(i) for i in xrange(33, 127) if not chr(i).isalnum()]))
symnums = re.escape(''.join([chr(i) for i in xrange(33, 127) if not chr(i).isalnum()]))

t_IDENTIFIER = "[^%s](\\.|[^%s])*" % (symnums, symbols) 
```

我不知道 unicode 字符类。如果这个 unicode 的东西开始变得太复杂，我可以把原来的东西放好。UTF-8 支持仍然确保支持在 STRING 令牌上，这是更重要的。

编辑：另一方面，我开始理解为什么编程语言中没有太多的 unicode 支持。这是一个丑陋的黑客，不是一个令人满意的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T16:37:58.737

可能[POSIX 字符类](http://www.regular-expressions.info/posixbrackets.html)适合您？

# geocoding - 如何计算给定纬度/经度位置的边界框？

> ID：238260
> 
> 赞同：114
> 
> 时间：2008-10-26T17:00:07.550
> 
> 标签：geocoding, panoramio

我给出了一个由纬度和经度定义的位置。现在我想计算该点例如 10 公里内的边界框。

边界框应定义为 latmin、lngmin 和 latmax、lngmax。

我需要这些东西才能使用[panoramio API](http://www.panoramio.com/api/)。

有人知道如何获得积分的公式吗？

**编辑：**伙计们，我正在寻找一个公式/函数，它以 lat & lng 作为输入并返回一个边界框作为 latmin & lngmin 和 latmax & latmin。Mysql、php、c#、javascript 都可以，但伪代码也可以。

**编辑：**我不是在寻找显示 2 点距离的解决方案

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-10-26T20:21:09.253

我建议将地球表面局部近似为一个球体，其半径由给定纬度的 WGS84 椭球体给出。我怀疑 latMin 和 latMax 的精确计算需要椭圆函数，并且不会显着提高准确性（WGS84 本身就是一个近似值）。

我的实现如下（它是用 Python 编写的；我没有测试过）：

```
# degrees to radians
def deg2rad(degrees):
    return math.pi*degrees/180.0
# radians to degrees
def rad2deg(radians):
    return 180.0*radians/math.pi

# Semi-axes of WGS-84 geoidal reference
WGS84_a = 6378137.0  # Major semiaxis [m]
WGS84_b = 6356752.3  # Minor semiaxis [m]

# Earth radius at a given latitude, according to the WGS-84 ellipsoid [m]
def WGS84EarthRadius(lat):
    # http://en.wikipedia.org/wiki/Earth_radius
    An = WGS84_a*WGS84_a * math.cos(lat)
    Bn = WGS84_b*WGS84_b * math.sin(lat)
    Ad = WGS84_a * math.cos(lat)
    Bd = WGS84_b * math.sin(lat)
    return math.sqrt( (An*An + Bn*Bn)/(Ad*Ad + Bd*Bd) )

# Bounding box surrounding the point at given coordinates,
# assuming local approximation of Earth surface as a sphere
# of radius given by WGS84
def boundingBox(latitudeInDegrees, longitudeInDegrees, halfSideInKm):
    lat = deg2rad(latitudeInDegrees)
    lon = deg2rad(longitudeInDegrees)
    halfSide = 1000*halfSideInKm

    # Radius of Earth at given latitude
    radius = WGS84EarthRadius(lat)
    # Radius of the parallel at given latitude
    pradius = radius*math.cos(lat)

    latMin = lat - halfSide/radius
    latMax = lat + halfSide/radius
    lonMin = lon - halfSide/pradius
    lonMax = lon + halfSide/pradius

    return (rad2deg(latMin), rad2deg(lonMin), rad2deg(latMax), rad2deg(lonMax)) 
```

编辑：以下代码将（度，素数，秒）转换为度+度的分数，反之亦然（未测试）：

```
def dps2deg(degrees, primes, seconds):
    return degrees + primes/60.0 + seconds/3600.0

def deg2dps(degrees):
    intdeg = math.floor(degrees)
    primes = (degrees - intdeg)*60.0
    intpri = math.floor(primes)
    seconds = (primes - intpri)*60.0
    intsec = round(seconds)
    return (int(intdeg), int(intpri), int(intsec)) 
```

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2010-05-26T13:24:47.093

我写了一篇关于找到边界坐标的文章：

[http://JanMatuschek.de/LatitudeLongitudeBoundingCoordinates](http://JanMatuschek.de/LatitudeLongitudeBoundingCoordinates)

文章解释了这些公式，还提供了一个 Java 实现。（这也说明了为什么 Federico 的最小/最大经度公式不准确。）

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2013-01-14T06:25:33.187

在这里，我已将 Federico A. Ramponi 对 C# 的回答转换为任何感兴趣的人：

```
public class MapPoint
{
    public double Longitude { get; set; } // In Degrees
    public double Latitude { get; set; } // In Degrees
}

public class BoundingBox
{
    public MapPoint MinPoint { get; set; }
    public MapPoint MaxPoint { get; set; }
}        

// Semi-axes of WGS-84 geoidal reference
private const double WGS84_a = 6378137.0; // Major semiaxis [m]
private const double WGS84_b = 6356752.3; // Minor semiaxis [m]

// 'halfSideInKm' is the half length of the bounding box you want in kilometers.
public static BoundingBox GetBoundingBox(MapPoint point, double halfSideInKm)
{            
    // Bounding box surrounding the point at given coordinates,
    // assuming local approximation of Earth surface as a sphere
    // of radius given by WGS84
    var lat = Deg2rad(point.Latitude);
    var lon = Deg2rad(point.Longitude);
    var halfSide = 1000 * halfSideInKm;

    // Radius of Earth at given latitude
    var radius = WGS84EarthRadius(lat);
    // Radius of the parallel at given latitude
    var pradius = radius * Math.Cos(lat);

    var latMin = lat - halfSide / radius;
    var latMax = lat + halfSide / radius;
    var lonMin = lon - halfSide / pradius;
    var lonMax = lon + halfSide / pradius;

    return new BoundingBox { 
        MinPoint = new MapPoint { Latitude = Rad2deg(latMin), Longitude = Rad2deg(lonMin) },
        MaxPoint = new MapPoint { Latitude = Rad2deg(latMax), Longitude = Rad2deg(lonMax) }
    };            
}

// degrees to radians
private static double Deg2rad(double degrees)
{
    return Math.PI * degrees / 180.0;
}

// radians to degrees
private static double Rad2deg(double radians)
{
    return 180.0 * radians / Math.PI;
}

// Earth radius at a given latitude, according to the WGS-84 ellipsoid [m]
private static double WGS84EarthRadius(double lat)
{
    // http://en.wikipedia.org/wiki/Earth_radius
    var An = WGS84_a * WGS84_a * Math.Cos(lat);
    var Bn = WGS84_b * WGS84_b * Math.Sin(lat);
    var Ad = WGS84_a * Math.Cos(lat);
    var Bd = WGS84_b * Math.Sin(lat);
    return Math.Sqrt((An*An + Bn*Bn) / (Ad*Ad + Bd*Bd));
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2016-09-02T12:36:02.067

由于我需要一个非常粗略的估计，因此为了在弹性搜索查询中过滤掉一些不需要的文档，我使用了以下公式：

```
Min.lat = Given.Lat - (0.009 x N)
Max.lat = Given.Lat + (0.009 x N)
Min.lon = Given.lon - (0.009 x N)
Max.lon = Given.lon + (0.009 x N) 
```

N = 给定位置所需的公里数。对于你的情况 N=10

不准确但方便。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2014-07-29T21:51:57.560

我写了一个 JavaScript 函数，它返回一个正方形边界框的四个坐标，给定一个距离和一对坐标：

```
'use strict';

/**
 * @param {number} distance - distance (km) from the point represented by centerPoint
 * @param {array} centerPoint - two-dimensional array containing center coords [latitude, longitude]
 * @description
 *   Computes the bounding coordinates of all points on the surface of a sphere
 *   that has a great circle distance to the point represented by the centerPoint
 *   argument that is less or equal to the distance argument.
 *   Technique from: Jan Matuschek <http://JanMatuschek.de/LatitudeLongitudeBoundingCoordinates>
 * @author Alex Salisbury
*/

getBoundingBox = function (centerPoint, distance) {
  var MIN_LAT, MAX_LAT, MIN_LON, MAX_LON, R, radDist, degLat, degLon, radLat, radLon, minLat, maxLat, minLon, maxLon, deltaLon;
  if (distance < 0) {
    return 'Illegal arguments';
  }
  // helper functions (degrees<–&gt;radians)
  Number.prototype.degToRad = function () {
    return this * (Math.PI / 180);
  };
  Number.prototype.radToDeg = function () {
    return (180 * this) / Math.PI;
  };
  // coordinate limits
  MIN_LAT = (-90).degToRad();
  MAX_LAT = (90).degToRad();
  MIN_LON = (-180).degToRad();
  MAX_LON = (180).degToRad();
  // Earth's radius (km)
  R = 6378.1;
  // angular distance in radians on a great circle
  radDist = distance / R;
  // center point coordinates (deg)
  degLat = centerPoint[0];
  degLon = centerPoint[1];
  // center point coordinates (rad)
  radLat = degLat.degToRad();
  radLon = degLon.degToRad();
  // minimum and maximum latitudes for given distance
  minLat = radLat - radDist;
  maxLat = radLat + radDist;
  // minimum and maximum longitudes for given distance
  minLon = void 0;
  maxLon = void 0;
  // define deltaLon to help determine min and max longitudes
  deltaLon = Math.asin(Math.sin(radDist) / Math.cos(radLat));
  if (minLat > MIN_LAT && maxLat < MAX_LAT) {
    minLon = radLon - deltaLon;
    maxLon = radLon + deltaLon;
    if (minLon < MIN_LON) {
      minLon = minLon + 2 * Math.PI;
    }
    if (maxLon > MAX_LON) {
      maxLon = maxLon - 2 * Math.PI;
    }
  }
  // a pole is within the given distance
  else {
    minLat = Math.max(minLat, MIN_LAT);
    maxLat = Math.min(maxLat, MAX_LAT);
    minLon = MIN_LON;
    maxLon = MAX_LON;
  }
  return [
    minLon.radToDeg(),
    minLat.radToDeg(),
    maxLon.radToDeg(),
    maxLat.radToDeg()
  ];
}; 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2016-12-23T09:46:16.477

这是一个使用 javascript 的简单实现，它基于纬度到 kms where 的转换`1 degree latitude ~ 111.2 km`。

我正在从给定的纬度、经度和半径（以公里为单位）计算地图的边界。

```
function getBoundsFromLatLng(lat, lng, radiusInKm){
     var lat_change = radiusInKm/111.2;
     var lon_change = Math.abs(Math.cos(lat*(Math.PI/180)));
     var bounds = { 
         lat_min : lat - lat_change,
         lon_min : lng - lon_change,
         lat_max : lat + lat_change,
         lon_max : lng + lon_change
     };
     return bounds;
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-04-06T04:53:13.903

@Jan Philip Matuschek 的插图很好的解释。（请投票给他的答案，而不是这个；我添加这个是因为我花了一点时间来理解原始答案）

优化寻找最近邻居的边界框技术需要为距离 d 处的点 P 导出最小和最大纬度、经度对。落在这些范围之外的所有点肯定与该点的距离大于 d。这里要注意的一件事是交叉点纬度的计算，正如 Jan Philip Matuschek 解释中强调的那样。交点的纬度不在点 P 的纬度上，而是稍微偏离它。在确定距离 d 的点 P 的正确最小和最大边界经度时，这是一个经常被忽略但很重要的部分。这在验证中也很有用。

P的（交点纬度，经度高）到（纬度，经度）之间的半正弦距离等于距离d。

Python 要点在这里[https://gist.github.com/alexcpn/f95ae83a7ee0293a5225](https://gist.github.com/alexcpn/f95ae83a7ee0293a5225)

[![在此处输入图像描述](https://i.stack.imgur.com/XUnbL.png)](https://i.stack.imgur.com/XUnbL.png)

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-26T17:10:57.467

您正在寻找一个椭球公式。

我发现开始编码的最佳位置是基于 CPAN 的 Geo::Ellipsoid 库。它为您提供了一个基线来创建您的测试并将您的结果与其结果进行比较。我在我以前的雇主那里使用它作为 PHP 的类似库的基础。

[地理::椭球](http://metacpan.org/pod/Geo::Ellipsoid)

看看`location`方法。调用它两次，你就有了你的 bbox。

您没有发布您使用的语言。可能已经有一个地理编码库可供您使用。

哦，如果你现在还没有弄清楚，谷歌地图使用 WGS84 椭球。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-11-19T16:01:45.710

我改编了一个我发现可以做到这一点的 PHP 脚本。您可以使用它来查找围绕某个点（例如 20 公里）的框的角。我的具体示例是针对 Google Maps API：

[http://www.richardpeacock.com/blog/2011/11/draw-box-around-coordinate-google-maps-based-miles-or-kilometers](http://www.richardpeacock.com/blog/2011/11/draw-box-around-coordinate-google-maps-based-miles-or-kilometers)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2021-03-26T12:20:55.187

这是用于获取基于纬度/经度和距离的边界框坐标的 javascript 代码。测试和工作正常。

```
Number.prototype.degreeToRadius = function () {
    return this * (Math.PI / 180);
};

Number.prototype.radiusToDegree = function () {
    return (180 * this) / Math.PI;
};

function getBoundingBox(fsLatitude, fsLongitude, fiDistanceInKM) {

    if (fiDistanceInKM == null || fiDistanceInKM == undefined || fiDistanceInKM == 0)
        fiDistanceInKM = 1;

    var MIN_LAT, MAX_LAT, MIN_LON, MAX_LON, ldEarthRadius, ldDistanceInRadius, lsLatitudeInDegree, lsLongitudeInDegree,
        lsLatitudeInRadius, lsLongitudeInRadius, lsMinLatitude, lsMaxLatitude, lsMinLongitude, lsMaxLongitude, deltaLon;

    // coordinate limits
    MIN_LAT = (-90).degreeToRadius();
    MAX_LAT = (90).degreeToRadius();
    MIN_LON = (-180).degreeToRadius();
    MAX_LON = (180).degreeToRadius();

    // Earth's radius (km)
    ldEarthRadius = 6378.1;

    // angular distance in radians on a great circle
    ldDistanceInRadius = fiDistanceInKM / ldEarthRadius;

    // center point coordinates (deg)
    lsLatitudeInDegree = fsLatitude;
    lsLongitudeInDegree = fsLongitude;

    // center point coordinates (rad)
    lsLatitudeInRadius = lsLatitudeInDegree.degreeToRadius();
    lsLongitudeInRadius = lsLongitudeInDegree.degreeToRadius();

    // minimum and maximum latitudes for given distance
    lsMinLatitude = lsLatitudeInRadius - ldDistanceInRadius;
    lsMaxLatitude = lsLatitudeInRadius + ldDistanceInRadius;

    // minimum and maximum longitudes for given distance
    lsMinLongitude = void 0;
    lsMaxLongitude = void 0;

    // define deltaLon to help determine min and max longitudes
    deltaLon = Math.asin(Math.sin(ldDistanceInRadius) / Math.cos(lsLatitudeInRadius));

    if (lsMinLatitude > MIN_LAT && lsMaxLatitude < MAX_LAT) {
        lsMinLongitude = lsLongitudeInRadius - deltaLon;
        lsMaxLongitude = lsLongitudeInRadius + deltaLon;
        if (lsMinLongitude < MIN_LON) {
            lsMinLongitude = lsMinLongitude + 2 * Math.PI;
        }
        if (lsMaxLongitude > MAX_LON) {
            lsMaxLongitude = lsMaxLongitude - 2 * Math.PI;
        }
    }

    // a pole is within the given distance
    else {
        lsMinLatitude = Math.max(lsMinLatitude, MIN_LAT);
        lsMaxLatitude = Math.min(lsMaxLatitude, MAX_LAT);
        lsMinLongitude = MIN_LON;
        lsMaxLongitude = MAX_LON;
    }

    return [
        lsMinLatitude.radiusToDegree(),
        lsMinLongitude.radiusToDegree(),
        lsMaxLatitude.radiusToDegree(),
        lsMaxLongitude.radiusToDegree()
    ];
}; 
```

使用如下 getBoundingBox 函数绘制边界框。

```
var lsRectangleLatLong = getBoundingBox(parseFloat(latitude), parseFloat(longitude), lsDistance);
            if (lsRectangleLatLong != null && lsRectangleLatLong != undefined) {
                latLngArr.push({ lat: lsRectangleLatLong[0], lng: lsRectangleLatLong[1] });
                latLngArr.push({ lat: lsRectangleLatLong[0], lng: lsRectangleLatLong[3] });
                latLngArr.push({ lat: lsRectangleLatLong[2], lng: lsRectangleLatLong[3] });
                latLngArr.push({ lat: lsRectangleLatLong[2], lng: lsRectangleLatLong[1] });
            } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-10-28T17:54:03.767

我正在研究边界框问题，作为查找静态 LAT、LONG 点的 SrcRad 半径内的所有点的附带问题。已经有相当多的计算使用

```
maxLon = $lon + rad2deg($rad/$R/cos(deg2rad($lat)));
minLon = $lon - rad2deg($rad/$R/cos(deg2rad($lat))); 
```

计算经度界限，但我发现这并没有给出所有需要的答案。因为你真正想做的是

```
(SrcRad/RadEarth)/cos(deg2rad(lat)) 
```

我知道，我知道答案应该是一样的，但我发现事实并非如此。似乎通过不确定我是否首先执行 (SRCrad/RadEarth) 然后除以 Cos 部分，我遗漏了一些位置点。

在获得所有边界框点之后，如果您有一个函数可以计算给定 lat,long 的点到点距离，那么很容易只获得距离固定点具有一定距离半径的那些点。这就是我所做的。我知道这需要一些额外的步骤，但它帮助了我

```
-- GLOBAL Constants
gc_pi CONSTANT REAL := 3.14159265359;  -- Pi

-- Conversion Factor Constants
gc_rad_to_degs          CONSTANT NUMBER := 180/gc_pi; -- Conversion for Radians to Degrees 180/pi
gc_deg_to_rads          CONSTANT NUMBER := gc_pi/180; --Conversion of Degrees to Radians

lv_stat_lat    -- The static latitude point that I am searching from 
lv_stat_long   -- The static longitude point that I am searching from 

-- Angular radius ratio in radians
lv_ang_radius := lv_search_radius / lv_earth_radius;
lv_bb_maxlat := lv_stat_lat + (gc_rad_to_deg * lv_ang_radius);
lv_bb_minlat := lv_stat_lat - (gc_rad_to_deg * lv_ang_radius);

--Here's the tricky part, accounting for the Longitude getting smaller as we move up the latitiude scale
-- I seperated the parts of the equation to make it easier to debug and understand
-- I may not be a smart man but I know what the right answer is... :-)

lv_int_calc := gc_deg_to_rads * lv_stat_lat;
lv_int_calc := COS(lv_int_calc);
lv_int_calc := lv_ang_radius/lv_int_calc;
lv_int_calc := gc_rad_to_degs*lv_int_calc;

lv_bb_maxlong := lv_stat_long + lv_int_calc;
lv_bb_minlong := lv_stat_long - lv_int_calc;

-- Now select the values from your location datatable 
SELECT *  FROM (
SELECT cityaliasname, city, state, zipcode, latitude, longitude, 
-- The actual distance in miles
spherecos_pnttopntdist(lv_stat_lat, lv_stat_long, latitude, longitude, 'M') as miles_dist    
FROM Location_Table 
WHERE latitude between lv_bb_minlat AND lv_bb_maxlat
AND   longitude between lv_bb_minlong and lv_bb_maxlong)
WHERE miles_dist <= lv_limit_distance_miles
order by miles_dist
; 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-08-19T10:54:35.617

在这里，如果有人感兴趣，我已经将 Federico A. Ramponi 的答案转换为 PHP：

```
<?php
# deg2rad and rad2deg are already within PHP

# Semi-axes of WGS-84 geoidal reference
$WGS84_a = 6378137.0;  # Major semiaxis [m]
$WGS84_b = 6356752.3;  # Minor semiaxis [m]

# Earth radius at a given latitude, according to the WGS-84 ellipsoid [m]
function WGS84EarthRadius($lat)
{
    global $WGS84_a, $WGS84_b;

    $an = $WGS84_a * $WGS84_a * cos($lat);
    $bn = $WGS84_b * $WGS84_b * sin($lat);
    $ad = $WGS84_a * cos($lat);
    $bd = $WGS84_b * sin($lat);

    return sqrt(($an*$an + $bn*$bn)/($ad*$ad + $bd*$bd));
}

# Bounding box surrounding the point at given coordinates,
# assuming local approximation of Earth surface as a sphere
# of radius given by WGS84
function boundingBox($latitudeInDegrees, $longitudeInDegrees, $halfSideInKm)
{
    $lat = deg2rad($latitudeInDegrees);
    $lon = deg2rad($longitudeInDegrees);
    $halfSide = 1000 * $halfSideInKm;

    # Radius of Earth at given latitude
    $radius = WGS84EarthRadius($lat);
    # Radius of the parallel at given latitude
    $pradius = $radius*cos($lat);

    $latMin = $lat - $halfSide / $radius;
    $latMax = $lat + $halfSide / $radius;
    $lonMin = $lon - $halfSide / $pradius;
    $lonMax = $lon + $halfSide / $pradius;

    return array(rad2deg($latMin), rad2deg($lonMin), rad2deg($latMax), rad2deg($lonMax));
}
?> 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-07-19T07:38:53.823

感谢@Fedrico A. 对于 Phyton 的实现，我已将其移植到 Objective C 类别类中。这是：

```
#import "LocationService+Bounds.h"

//Semi-axes of WGS-84 geoidal reference
const double WGS84_a = 6378137.0; //Major semiaxis [m]
const double WGS84_b = 6356752.3; //Minor semiaxis [m]

@implementation LocationService (Bounds)

struct BoundsLocation {
    double maxLatitude;
    double minLatitude;
    double maxLongitude;
    double minLongitude;
};

+ (struct BoundsLocation)locationBoundsWithLatitude:(double)aLatitude longitude:(double)aLongitude maxDistanceKm:(NSInteger)aMaxKmDistance {
    return [self boundingBoxWithLatitude:aLatitude longitude:aLongitude halfDistanceKm:aMaxKmDistance/2];
}

#pragma mark - Algorithm 

+ (struct BoundsLocation)boundingBoxWithLatitude:(double)aLatitude longitude:(double)aLongitude halfDistanceKm:(double)aDistanceKm {
    double radianLatitude = [self degreesToRadians:aLatitude];
    double radianLongitude = [self degreesToRadians:aLongitude];
    double halfDistanceMeters = aDistanceKm*1000;

    double earthRadius = [self earthRadiusAtLatitude:radianLatitude];
    double parallelRadius = earthRadius*cosl(radianLatitude);

    double radianMinLatitude = radianLatitude - halfDistanceMeters/earthRadius;
    double radianMaxLatitude = radianLatitude + halfDistanceMeters/earthRadius;
    double radianMinLongitude = radianLongitude - halfDistanceMeters/parallelRadius;
    double radianMaxLongitude = radianLongitude + halfDistanceMeters/parallelRadius;

    struct BoundsLocation bounds;
    bounds.minLatitude = [self radiansToDegrees:radianMinLatitude];
    bounds.maxLatitude = [self radiansToDegrees:radianMaxLatitude];
    bounds.minLongitude = [self radiansToDegrees:radianMinLongitude];
    bounds.maxLongitude = [self radiansToDegrees:radianMaxLongitude];

    return bounds;
}

+ (double)earthRadiusAtLatitude:(double)aRadianLatitude {
    double An = WGS84_a * WGS84_a * cosl(aRadianLatitude);
    double Bn = WGS84_b * WGS84_b * sinl(aRadianLatitude);
    double Ad = WGS84_a * cosl(aRadianLatitude);
    double Bd = WGS84_b * sinl(aRadianLatitude);
    return sqrtl( ((An * An) + (Bn * Bn))/((Ad * Ad) + (Bd * Bd)) );
}

+ (double)degreesToRadians:(double)aDegrees {
    return M_PI*aDegrees/180.0;
}

+ (double)radiansToDegrees:(double)aRadians {
    return 180.0*aRadians/M_PI;
}

@end 
```

我已经对其进行了测试，并且似乎运行良好。Struct BoundsLocation 应该换成一个类，我用过只是为了分享一下。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-10-21T08:26:54.763

很简单，只要去panoramio网站，然后从panoramio网站打开世界地图。然后去指定的位置，需要经纬度。

然后您在地址栏中找到纬度和经度，例如在此地址中。

[http://www.panoramio.com/map#lt=32.739485&ln=70.491211&z=9&k=1&a=1&tab=1&pl=all](http://www.panoramio.com/map#lt=32.739485&ln=70.491211&z=9&k=1&a=1&tab=1&pl=all)

lt=32.739485 =>纬度 ln=70.491211 =>经度

这个 Panoramio JavaScript API 小部件围绕纬度/经度对创建一个边界框，然后返回这些边界内的所有照片。

另一种 Panoramio JavaScript API 小部件，您还可以在其中通过[示例和代码](http://codespk.blogspot.com/2013/10/panoramio-javascript-api-widget-example.html)更改背景颜色。

作曲时不显示，发表后显示。

```
<div dir="ltr" style="text-align: center;" trbidi="on">
<script src="https://ssl.panoramio.com/wapi/wapi.js?v=1&amp;hl=en"></script>
<div id="wapiblock" style="float: right; margin: 10px 15px"></div>
<script type="text/javascript">
var myRequest = {
  'tag': 'kahna',
  'rect': {'sw': {'lat': -30, 'lng': 10.5}, 'ne': {'lat': 50.5, 'lng': 30}}
};
  var myOptions = {
  'width': 300,
  'height': 200
};
var wapiblock = document.getElementById('wapiblock');
var photo_widget = new panoramio.PhotoWidget('wapiblock', myRequest, myOptions);
photo_widget.setPosition(0);
</script>
</div> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-08-30T01:01:28.267

**以上所有答案都只是部分正确**。特别是在像澳大利亚这样的地区，他们总是包括极点并计算一个非常大的矩形，即使是 10 公里。

特别是 Jan Philip Matuschek 在[http://janmatuschek.de/LatitudeLongitudeBoundingCoordinates#UsingIndex](http://janmatuschek.de/LatitudeLongitudeBoundingCoordinates#UsingIndex)的算法包括一个非常大的矩形（-37, -90, -180, 180），用于澳大利亚的几乎每个点。这会影响数据库中的大量用户，并且必须为几乎一半国家的所有用户计算距离。

我发现**罗彻斯特理工学院的 Drupal API 地球算法**在极点周围和其他地方工作得更好，并且更容易实现。

[https://www.rit.edu/drupal/api/drupal/sites%21all%21modules%21location%21earth.inc/7.54](https://www.rit.edu/drupal/api/drupal/sites%21all%21modules%21location%21earth.inc/7.54)

使用`earth_latitude_range`和`earth_longitude_range`从上述算法计算边界矩形

并使用**谷歌地图记录的距离计算公式**计算距离

[https://developers.google.com/maps/solutions/store-locator/clothing-store-locator#outputting-data-as-xml-using-php](https://developers.google.com/maps/solutions/store-locator/clothing-store-locator#outputting-data-as-xml-using-php)

要按公里而不是英里搜索，请将 3959 替换为 6371。 *对于 (Lat, Lng) = (37, -122) 和包含 lat 和 lng 列的标记表*，公式为：

```
SELECT id, ( 3959 * acos( cos( radians(37) ) * cos( radians( lat ) ) * cos( radians( lng ) - radians(-122) ) + sin( radians(37) ) * sin( radians( lat ) ) ) ) AS distance FROM markers HAVING distance < 25 ORDER BY distance LIMIT 0 , 20; 
```

[在https://stackoverflow.com/a/45950426/5076414](https://stackoverflow.com/a/45950426/5076414)阅读我的详细答案

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-10-30T19:06:47.967

这是 Federico Ramponi 在 Go 中的回答。注意：没有错误检查:(

```
import (
    "math"
)

// Semi-axes of WGS-84 geoidal reference
const (
    // Major semiaxis (meters)
    WGS84A = 6378137.0
    // Minor semiaxis (meters)
    WGS84B = 6356752.3
)

// BoundingBox represents the geo-polygon that encompasses the given point and radius
type BoundingBox struct {
    LatMin float64
    LatMax float64
    LonMin float64
    LonMax float64
}

// Convert a degree value to radians
func deg2Rad(deg float64) float64 {
    return math.Pi * deg / 180.0
}

// Convert a radian value to degrees
func rad2Deg(rad float64) float64 {
    return 180.0 * rad / math.Pi
}

// Get the Earth's radius in meters at a given latitude based on the WGS84 ellipsoid
func getWgs84EarthRadius(lat float64) float64 {
    an := WGS84A * WGS84A * math.Cos(lat)
    bn := WGS84B * WGS84B * math.Sin(lat)

    ad := WGS84A * math.Cos(lat)
    bd := WGS84B * math.Sin(lat)

    return math.Sqrt((an*an + bn*bn) / (ad*ad + bd*bd))
}

// GetBoundingBox returns a BoundingBox encompassing the given lat/long point and radius
func GetBoundingBox(latDeg float64, longDeg float64, radiusKm float64) BoundingBox {
    lat := deg2Rad(latDeg)
    lon := deg2Rad(longDeg)
    halfSide := 1000 * radiusKm

    // Radius of Earth at given latitude
    radius := getWgs84EarthRadius(lat)

    pradius := radius * math.Cos(lat)

    latMin := lat - halfSide/radius
    latMax := lat + halfSide/radius
    lonMin := lon - halfSide/pradius
    lonMax := lon + halfSide/pradius

    return BoundingBox{
        LatMin: rad2Deg(latMin),
        LatMax: rad2Deg(latMax),
        LonMin: rad2Deg(lonMin),
        LonMax: rad2Deg(lonMax),
    }
} 
```

# sql - 您对存储过程的命名约定是什么？

> ID：238267
> 
> 赞同：128
> 
> 时间：2008-10-26T17:03:43.083
> 
> 标签：sql, stored-procedures, naming-conventions

我已经看到了命名存储过程的各种规则。

有些人在 sproc 名称前加上 usp_，有些人使用应用程序名称的缩写，还有一些人使用所有者名称。除非您是认真的，否则不应在 SQL Server 中使用 sp_。

一些以动词（获取、添加、保存、删除）开头的过程名称。其他人则强调实体名称。

在具有数百个存储过程的数据库上，当您认为已经存在一个存储过程时，可能很难滚动并找到合适的存储过程。命名约定可以使定位存储过程更容易。

你使用命名约定吗？请描述它，并解释为什么你更喜欢它而不是其他选择。

**回复摘要：**

*   每个人似乎都提倡命名的一致性，因为每个人使用相同的命名约定可能比使用哪个特定的命名约定更重要。
*   前缀：虽然很多人使用 usp_ 或类似名称（但很少使用 sp_），但许多其他人使用数据库或应用程序名称。一位聪明的 DBA 使用 gen、rpt 和 tsk 来区分一般的 CRUD 存储过程和用于报告或任务的存储过程。
*   动词+名词似乎比名词+动词更受欢迎。有些人对动词使用 SQL 关键字（Select、Insert、Update、Delete），而另一些人则使用非 SQL 动词（或它们的缩写），例如 Get 和 Add。有些人区分单数名词和复数名词，以表明是否正在检索一条或多条记录。
*   在适当的情况下，建议在末尾添加一个附加短语。GetCustomerById，GetCustomerBySaleDate。
*   有些人在名称段之间使用下划线，而有些人则避免使用下划线。app_Get_Customer 与 appGetCustomer——我想这是可读性的问题。
*   大型存储过程集合可以分离到 Oracle 包或 Management Studio (SQL Server) 解决方案和项目，或 SQL Server 模式中。
*   应避免使用难以理解的缩写。

**为什么我选择我所做的答案：**有很多好的回应。谢谢你们！如您所见，很难只选择一个。我选择的那个引起了我的共鸣。我遵循了他描述的相同路径——尝试使用动词+名词，然后找不到适用于客户的所有存储过程。

能够定位现有的 sproc，或者确定一个是否存在，是非常重要的。如果有人无意中创建了另一个名称的重复存储过程，则可能会出现严重问题。

由于我通常处理具有数百个存储过程的大型应用程序，因此我更喜欢最容易找到的命名方法。对于较小的应用程序，我可能会提倡动词 + 名词，因为它遵循方法名称的一般编码约定。

他还提倡以应用名称为前缀，而不是用不太有用的 usp_。正如一些人指出的那样，有时数据库包含多个应用程序的存储过程。因此，使用应用程序名称作为前缀有助于隔离存储过程并帮助 DBA 和其他人确定存储过程用于哪个应用程序。

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-10-26T17:50:56.577

对于我的上一个项目，我使用了 usp_[Action][Object][Process]，例如，usp_AddProduct 或 usp_GetProductList、usp_GetProductDetail。但是现在数据库有 700 个以上的过程，要找到特定对象上的所有过程变得更加困难。例如，我现在必须为 Product add 搜索 50 个奇数的 Add 过程，为 Get 等搜索 50 个奇数。

因此，在我的新应用程序中，我计划按对象对程序名称进行分组，我也放弃了 usp，因为我觉得它有些多余，除了告诉我它是一个程序，我可以从名称中扣除一些东西程序本身。

新格式如下

```
[App]_[Object]_[Action][Process]

App_Tags_AddTag
App_Tags_AddTagRelations
App_Product_Add 
App_Product_GetList
App_Product_GetSingle 
```

它有助于将事物分组以便以后更容易找到，尤其是在有大量存储过程的情况下。

关于哪里使用了多个对象，我发现大多数实例都有primary和secondary对象，所以在普通实例中使用primary对象，在process部分中引用secondary，例如App_Product_AddAttribute。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-10-26T18:19:05.707

**下面是关于 SQL Server 中 sp_ 前缀问题的一些说明。**

以前缀 sp_ 命名的存储过程是存储在 Master 数据库中的系统存储过程。

如果你给你的存储过程这个前缀，SQL Server首先在主数据库中查找它们，然后是上下文数据库，因此不必要地浪费资源。而且，如果用户创建的存储过程与系统存储过程同名，用户创建的存储过程将不会被执行。

sp_ 前缀表示 sproc 可以从所有数据库访问，但它应该在当前数据库的上下文中执行。

[这是](http://www.sqlmag.com/Article/ArticleID/23011/sql_server_23011.html)一个很好的解释，其中包括性能影响的演示。

[这是](http://rakph.wordpress.com/2008/04/19/tips-store-procedure/)Ant 在评论中提供的另一个有用的资源。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-26T17:29:02.003

[Systems Hungarian](http://www.joelonsoftware.com/articles/Wrong.html)（如上面的“usp”前缀）让我不寒而栗。

我们在不同的、结构相似的数据库中共享许多存储过程，因此对于特定于数据库的数据库，我们使用数据库名称本身的前缀；共享过程没有前缀。我想使用不同的模式可能是完全摆脱这种有些难看的前缀的替代方法。

前缀后的实际名称与函数命名几乎没有区别：通常是动词，如“Add”、“Set”、“Generate”、“Calculate”、“Delete”等，后跟几个更具体的名词，如“User” ”、“每日收入”等。

回应蚂蚁的评论：

1.  表和视图之间的区别与设计数据库模式的人有关，而不是与访问或修改其内容的人有关。在需要模式细节的极少数情况下，很容易找到。对于随意的 SELECT 查询，它是无关紧要的。事实上，我认为能够同等对待表和视图是一个很大的优势。
2.  与函数和存储过程不同，表或视图的名称不太可能以动词开头，或者不是一个或多个名词。
3.  函数需要调用模式前缀。事实上，函数和存储过程之间的调用语法（无论如何我们都使用）是非常不同的。但即使它不是，与 1\. 一样适用：如果我可以将函数和存储过程视为相同，我为什么不应该呢？

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-26T23:48:54.090

**TableName_WhatItDoes**

*   Comment_GetByID

*   客户列表

*   UserPreference_DeleteByUserID

没有前缀或愚蠢的匈牙利废话。只是与它最密切相关的表的名称，以及它的作用的快速描述。

对上述内容的一个警告：我个人总是在所有自动生成的 CRUD 前加上 zCRUD_ 前缀，这样它就可以排序到列表的末尾，而我不必查看它。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-10-26T17:41:39.963

在 SQL Server 中以 开头的存储过程名称`sp_`是不好的，因为系统存储过程都以 sp_ 开头。一致的命名（甚至在 hobgoblin-dom 的范围内）很有用，因为它促进了基于数据字典的自动化任务。前缀在 SQL Server 2005 中的用处稍小，因为它支持架构，它可以用于各种类型的命名空间，就像过去的名称前缀一样。例如，在星型模式中，可以有*暗淡*模式和*事实*模式，并按此约定引用表。

对于存储过程，前缀可用于从系统存储过程中识别应用存储过程。 `up_`vs.`sp_`使得从数据字典中识别非系统存储过程变得相对容易。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-10-26T18:49:58.313

这些年来，我几乎使用了所有不同的系统。我终于开发了这个，我今天继续使用它：

字首 ：

*   gen - 一般：CRUD，主要是
*   rpt - 报告：不言自明
*   tsk - 任务：通常具有程序逻辑，通过预定作业运行

动作说明符：

```
Ins - INSERT
Sel - SELECT
Upd - UPDATE
Del - DELETE 
```

（在过程做很多事情的情况下，总体目标用于选择操作说明符。例如，客户 INSERT 可能需要大量准备工作，但总体目标是 INSERT，因此选择“Ins”。

目的：

对于 gen (CRUD)，这是受影响的表或视图名称。对于 rpt（报告），这是报告的简短描述。对于 tsk（任务），这是任务的简短描述。

可选澄清剂：

这些是用于增强对程序的理解的可选信息位。示例包括“By”、“For”等。

格式：

[前缀][动作说明符][实体][可选说明符]

过程名称示例：

```
genInsOrderHeader

genSelCustomerByCustomerID
genSelCustomersBySaleDate

genUpdCommentText

genDelOrderDetailLine

rptSelCustomersByState
rptSelPaymentsByYear

tskQueueAccountsForCollection 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-26T17:16:42.370

对于小型数据库，我使用 uspTableNameOperationName，例如 uspCustomerCreate、uspCustomerDelete 等。这有助于按“主”实体进行分组。

对于较大的数据库，添加模式或子系统名称，例如 Receiving、Purchasing 等以将它们组合在一起（因为 sql server 喜欢按字母顺序显示它们）

为了清楚起见，我尽量避免名称中的缩写（并且项目中的新人不必想知道“UNAICFE”代表什么，因为存储空间被命名为uspUsingNoAbbreviationsIncreasesClarityForEveryone）

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-26T17:09:05.147

我总是将存储过程封装在**包**中（我正在使用 Oracle，在工作中）。这将减少单独对象的数量并有助于代码重用。

命名约定是个人喜好问题，您应该在项目开始时与所有其他开发人员达成一致。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-26T21:02:24.317

我目前使用如下格式

符号：

[前缀] *[应用]* [模块]_[名称]

例子：

P_CMS_USER_UserInfoGet

我喜欢这个符号有几个原因：

*   以非常简单的前缀开头允许编写代码以仅执行以前缀开头的对象（例如，以减少 SQL 注入）
*   在我们更大的环境中，多个团队正在开发运行相同数据库架构的不同应用程序。应用程序符号指定哪个组拥有 SP。
*   Module 和 Name 部分只是完成了层次结构。所有名称都应该能够与层次结构中的 Group/App、Module、Function 匹配。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-26T17:54:22.233

我总是使用：

usp[表名称][操作][额外细节]

给定一个名为“tblUser”的表，这给了我：

*   usp用户创建
*   usp用户选择
*   uspUserSelectByNetworkID

这些过程按表名和功能按字母顺序排序，因此很容易看出我可以对任何给定的表做什么。使用前缀“usp”让我知道我在（例如）编写一个与其他过程、多个表、函数、视图和服务器交互的 1000 行过程时我在调用什么。

在 SQL Server IDE 中的编辑器与 Visual Studio 一样好之前，我会保留前缀。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-26T18:45:35.420

应用程序前缀_操作前缀_所涉及的数据库对象的描述*（减去下划线之间的空格-必须放入空格才能显示）*。

我们使用的操作前缀 -

*   “<em>get” – 返回一个记录集
*   “<em>ins”——插入数据
*   “<em>upd” – 更新数据
*   “<em>del” – 删除数据

*例如*

**wmt_ins_customer_details**

“劳动力管理工具，将详细信息插入客户表”

**好处**

与同一应用程序相关的所有存储过程都按名称分组在一起。在组内，执行相同类型的操作（例如插入、更新等）的存储过程被分组在一起。

这个系统对我们很有效，大约有。一个数据库中的 1000 个存储过程让我难以想象。

到目前为止，还没有遇到这种方法的任何缺点。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-26T23:11:52.543

GetXXX - 根据@ID 获取 XXX

GetAllXXX - 获取所有 XXX

PutXXX - 如果传递的@ID 为 -1，则插入 XXX；其他更新

DelXXX - 根据@ID 删除 XXX

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-26T17:17:49.763

我认为 usp_ 命名约定没有任何好处。

过去，我使用 Get/Update/Insert/Delete 前缀进行 CRUD 操作，但现在由于我使用 Linq to SQL 或 EF 来完成我的大部分 CRUD 工作，这些都完全消失了。由于我的新应用程序中存储的过程非常少，因此命名约定不再像以前那样重要；-)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-26T17:20:05.780

对于我正在开发的当前应用程序，我们有一个标识应用程序名称的前缀（四个小写字母）。这样做的原因是我们的应用程序必须能够与同一数据库中的遗留应用程序共存，因此前缀是必须的。

如果我们没有遗留约束，我很确定我们不会使用前缀。

在前缀之后，我们通常以描述过程做什么的动词开头 SP 名称，然后是我们操作的实体的名称。允许实体名称的复数形式 - 我们试图强调可读性，以便仅从名称中就可以明显看出该过程的作用。

我们团队中典型的存储过程名称是：

```
shopGetCategories
shopUpdateItem 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-26T17:38:55.197

只要您合乎逻辑且始终如一，我认为您的前缀是什么并不重要。我个人使用

spu_[动作描述][过程描述]

其中动作描述是一小部分典型动作之一，例如获取、设置、归档、插入、删除等。过程描述简短但具有描述性，例如

```
spu_archiveCollectionData 

```

或者

```
spu_setAwardStatus

```

我以类似方式命名我的函数，但前缀为 udf_

我看到人们尝试使用伪匈牙利符号来命名程序，在我看来，这隐藏的比它揭示的要多。只要当我按字母顺序列出我的程序时，我可以看到它们按功能分组，那么对我来说，这似乎是秩序和不必要的严谨之间的最佳点

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-26T17:58:33.673

避免在 SQl 服务器中使用 sp_*，因为所有系统存储的过程都以 sp_ 开头，因此系统更难找到与名称对应的对象。

所以如果你从 sp_ 以外的东西开始，事情就会变得更容易。

所以我们使用一个通用的 Proc_ 命名开始。如果提供一个大模式文件，这将更容易识别过程。

除此之外，我们分配了一个前缀来标识该功能。像

`Proc_Poll_Interface, Proc_Inv_Interface`等等

这使我们能够找到执行 POLL 的工作与执行 Inventory 等工作的所有存储过程。

无论如何，前缀系统取决于您的问题域。但是，即使只是为了让人们在资源管理器下拉列表中快速定位存储过程进行编辑，也应该存在类似的说法和所做的事情。

其他例如功能。

```
Proc_Order_Place
Proc_order_Delete
Proc_Order_Retrieve
Proc_Order_History 
```

我们遵循基于函数的命名，因为 Procs 类似于代码/函数，而不是像表这样的静态对象。Procs 可能与多个表一起工作并没有帮助。

如果 proc 执行的功能比单个名称所能处理的要多，则意味着您的 proc 正在做的事情远远超出了必要的范围，是时候再次拆分它们了。

希望有帮助。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-06-13T22:32:58.493

我迟到了，但我想在这里输入我的回复：

在我最近的两个项目中，有不同的趋势，比如我们使用的一个：

> 获取数据：s<tablename>_G
> 删除数据：s<tablename>_D
> 插入数据：s<tablename>_I
> 更新数据：s<tablename>_U

前端也遵循此命名约定，前缀为**dt**。

**例子：**

```
exec sMedicationInfo_G
exec sMedicationInfo_D
exec sMedicationInfo_I
exec sMedicationInfo_U
```

借助我们应用程序中的上述命名约定，我们有了一个好记且易于记忆的名称。

在第二个项目中，我们使用了相同的命名约定，但略有不同：

> 获取数据：sp_<tablename>G
> 删除数据：sp_<tablename>D
> 插入数据：sp_<tablename>I
> 更新数据：sp_<tablename>U

**例子：**

```
exec sp_MedicationInfoG
exec sp_MedicationInfoD
exec sp_MedicationInfoI
exec sp_MedicationInfoU
```

# android - 如何在我的 Android 应用程序中以编程方式复制文本？

> ID：238284
> 
> 赞同：253
> 
> 时间：2008-10-26T17:13:32.487
> 
> 标签：android, menu, clipboardmanager

我正在构建一个 Android 应用程序，我想复制 EditText 小部件的文本值。用户可以按`Menu+A`then`Menu+C`来复制值，但我将如何以编程方式执行此操作？

* * *

## 回答 #1

> 赞同：464
> 
> 时间：2008-10-26T17:20:44.483

使用[`ClipboardManager#setPrimaryClip`](https://developer.android.com/reference/android/content/ClipboardManager#setPrimaryClip(android.content.ClipData))方法：

```
import android.content.ClipboardManager;

// ...

ClipboardManager clipboard = (ClipboardManager) getSystemService(CLIPBOARD_SERVICE); 
ClipData clip = ClipData.newPlainText("label", "Text to copy");
clipboard.setPrimaryClip(clip); 
```

[`ClipboardManager`API 参考](http://developer.android.com/reference/android/content/ClipboardManager.html)

* * *

## 回答 #2

> 赞同：218
> 
> 时间：2012-06-13T09:56:10.537

所以每个人都同意如何做到这一点，但由于没有人想给出一个完整的解决方案，这里是：

```
int sdk = android.os.Build.VERSION.SDK_INT;
if(sdk < android.os.Build.VERSION_CODES.HONEYCOMB) {
    android.text.ClipboardManager clipboard = (android.text.ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);
    clipboard.setText("text to clip");
} else {
    android.content.ClipboardManager clipboard = (android.content.ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE); 
    android.content.ClipData clip = android.content.ClipData.newPlainText("text label","text to clip");
    clipboard.setPrimaryClip(clip);
} 
```

我假设您在清单中声明了以下内容：

```
<uses-sdk android:minSdkVersion="7" android:targetSdkVersion="14" /> 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-03-30T10:59:45.830

谷歌搜索将您带到 android.content.ClipboardManager ，您可以像我一样决定剪贴板在 API < 11 上不可用，因为文档页面显示“自：API 级别 11”。

实际上有两个类，第二个扩展了第一个 - android.text.ClipboardManager 和 android.content.ClipboardManager。

android.text.ClipboardManager 从 API 1 开始就存在，但它只适用于文本内容。

android.content.ClipboardManager 是使用剪贴板的首选方式，但它在 API 级别 < 11 (Honeycomb) 上不可用。

要获得其中任何一个，您需要以下代码：

```
ClipboardManager clipboard = (ClipboardManager) getSystemService(CLIPBOARD_SERVICE); 
```

但是对于*API < 11*你必须导入`android.text.ClipboardManager`并且对于*API >= 11* `android.content.ClipboardManager`

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-10-31T12:01:29.920

```
public void onClick (View v) 
{
    switch (v.getId())
    {
        case R.id.ButtonCopy:
            copyToClipBoard();
            break;
        case R.id.ButtonPaste:
            pasteFromClipBoard();
            break;
        default:
            Log.d(TAG, "OnClick: Unknown View Received!");
            break;
    }
}

// Copy EditCopy text to the ClipBoard
private void copyToClipBoard() 
{
    ClipboardManager clipMan = (ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);
    clipMan.setPrimaryClip(editCopy.getText());
} 
```

你可以试试这个。。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2016-11-28T04:40:40.103

# Android 支持库更新

从 Android Oreo 开始，支持库仅下降到 API 14。大多数较新的应用程序的最小 API 可能也为 14，因此无需担心其他一些答案中提到的 API 11 问题。可以清理很多代码。（但如果您仍然支持较低版本，请参阅我的编辑历史记录。）

# 复制

```
ClipboardManager clipboard = (ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);
ClipData clip = ClipData.newPlainText("label", selectedText);
if (clipboard == null || clip == null) return;
clipboard.setPrimaryClip(clip); 
```

# 粘贴

我将此代码添加为奖励，因为复制/粘贴通常成对完成。

```
ClipboardManager clipboard = (ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);
try {
    CharSequence text = clipboard.getPrimaryClip().getItemAt(0).getText();
} catch (Exception e) {
    return;
} 
```

# 笔记

*   请务必导入`android.content.ClipboardManager`版本而不是旧的`android.text.ClipboardManager`. 对`ClipData`.
*   如果您不在活动中，您可以使用`context.getSystemService()`.
*   我使用了 try/catch 块来获取粘贴文本，因为可以有多种内容`null`。如果您发现这种方式更具可读性，您可以检查每一个。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-11-11T15:45:24.453

这是一些从 EditText 实现一些复制和粘贴功能的代码（感谢 Warpzit 的版本检查）。您可以将这些挂钩到您的按钮的 onclick 事件。

```
public void copy(View v) {      
    int startSelection = txtNotes.getSelectionStart();
    int endSelection = txtNotes.getSelectionEnd();      
    if ((txtNotes.getText() != null) && (endSelection > startSelection ))
    {
        String selectedText = txtNotes.getText().toString().substring(startSelection, endSelection);                
        int sdk = android.os.Build.VERSION.SDK_INT;
        if(sdk < android.os.Build.VERSION_CODES.HONEYCOMB) {
            android.text.ClipboardManager clipboard = (android.text.ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);
            clipboard.setText(selectedText);
        } else {
            android.content.ClipboardManager clipboard = (android.content.ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE); 
            android.content.ClipData clip = android.content.ClipData.newPlainText("WordKeeper",selectedText);
            clipboard.setPrimaryClip(clip);
        }
    }
}   

public void paste(View v) {
    int sdk = android.os.Build.VERSION.SDK_INT;
    if (sdk < android.os.Build.VERSION_CODES.HONEYCOMB) {
        android.text.ClipboardManager clipboard = (android.text.ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);
        if (clipboard.getText() != null) {
            txtNotes.getText().insert(txtNotes.getSelectionStart(), clipboard.getText());
        }
    } else {
        android.content.ClipboardManager clipboard = (android.content.ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);
        android.content.ClipData.Item item = clipboard.getPrimaryClip().getItemAt(0);
        if (item.getText() != null) {
            txtNotes.getText().insert(txtNotes.getSelectionStart(), item.getText());
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2016-08-05T11:47:58.013

要启用 TextView 的标准复制/粘贴，U 可以选择以下选项之一：

布局文件中的更改：将以下属性添加到您的 TextView

```
android:textIsSelectable="true" 
```

在你的 Java 类中写下这一行，在语法上设置两行。

`myTextView.setTextIsSelectable(true);`

长按 TextView 可以看到复制/粘贴操作栏。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2018-12-12T06:55:13.160

```
ClipboardManager clipboard = (ClipboardManager) getSystemService(CLIPBOARD_SERVICE); 
ClipData clip = ClipData.newPlainText("label", "Text to copy");
if (clipboard == null || clip == null)
    return;
clipboard.setPrimaryClip(clip); 
```

**并导入** `import android.content.ClipboardManager;`

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-04-18T21:26:21.087

@FlySwat 已经给出了正确答案，我只是分享完整的答案：

使用 ClipboardManager.setPrimaryClip ( [http://developer.android.com/reference/android/content/ClipboardManager.html](http://developer.android.com/reference/android/content/ClipboardManager.html) ) 方法：

```
ClipboardManager clipboard = (ClipboardManager) getSystemService(CLIPBOARD_SERVICE); 
ClipData clip = ClipData.newPlainText("label", "Text to copy");
clipboard.setPrimaryClip(clip); 
```

Where`label` 是剪辑数据的用户可见标签，并且 `text`是剪辑中的实际文本。根据[官方文档](https://developer.android.com/reference/android/content/ClipData.html#newPlainText(java.lang.CharSequence,%20java.lang.CharSequence))。

使用此导入很重要：

```
import android.content.ClipboardManager; 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2020-03-17T10:19:02.680

对于 Kotlin，我们可以使用以下方法。您可以将此方法粘贴到活动或片段中。

```
fun copyToClipBoard(context: Context, message: String) {

    val clipBoard = context.getSystemService(Context.CLIPBOARD_SERVICE) as ClipboardManager
    val clipData = ClipData.newPlainText("label",message)
    clipBoard.setPrimaryClip(clipData)

} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-11-06T19:24:23.813

对于 Kotlin，请在活动中使用以下代码。

```
import android.content.ClipboardManager

 val clipBoard = getSystemService(Context.CLIPBOARD_SERVICE) as ClipboardManager
 val clipData = ClipData.newPlainText("label","Message to be Copied")
 clipBoard.setPrimaryClip(clipData) 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-02-25T07:01:08.647

这是我的工作代码

```
/**
 * Method to code text in clip board
 *
 * @param context context
 * @param text    text what wan to copy in clipboard
 * @param label   label what want to copied
 */
public static void copyCodeInClipBoard(Context context, String text, String label) {
    if (context != null) {
        ClipboardManager clipboard = (ClipboardManager) context.getSystemService(CLIPBOARD_SERVICE);
        ClipData clip = ClipData.newPlainText(label, text);
        if (clipboard == null || clip == null)
            return;
        clipboard.setPrimaryClip(clip);

    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-07-02T00:36:51.447

除非您的应用是默认输入法编辑器 (IME) 或当前具有焦点的应用，否则您的应用无法在 Android 10 或更高版本上访问剪贴板数据。 [https://developer.android.com/about/versions/10/privacy/changes#clipboard-data](https://developer.android.com/about/versions/10/privacy/changes#clipboard-data)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-03-01T18:12:18.813

我用这个（处理片段）- kotlinish 方式

```
 private fun copyTextToClipboard(copyText: String) {

        val clipboardManager = requireActivity().
                               getSystemService(CLIPBOARD_SERVICE) as 
                                       android.content.ClipboardManager

        val clipData = ClipData.newPlainText("userLabel" ,copyText.trim())

        clipboardManager.setPrimaryClip(clipData)

    } 
```

# language-agnostic - When have you used dynamic programming in the field?

> ID：238296
> 
> 赞同：6
> 
> 时间：2008-10-26T17:20:11.740
> 
> 标签：language-agnostic, optimization, field, dynamic-programming

When have you ever directly applied the concepts of [dynamic programming](http://en.wikipedia.org/wiki/Dynamic_programming) to solve a problem in the field? It's sometimes not evident how it can be applied when using it to solve a made-up instance of the [knapsack problem](http://en.wikipedia.org/wiki/Knapsack_problem).

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T17:53:13.637

It's probably a lot more common to use [memoization](http://en.wikipedia.org/wiki/Memoization) to solve problems in the field, since it's applicable to a wider set of problems. DP is really only called for when you have a lot of overlapping sub-problems, like in calculating fibonacci numbers (the hard way), or prime numbers (the efficient way).

Incidentally, the page you linked to has a [list of algorithms that use DP](http://en.wikipedia.org/wiki/Dynamic_programming#Algorithms_that_use_dynamic_programming).

# java - 关于java接口的问题

> ID：238314
> 
> 赞同：1
> 
> 时间：2008-10-26T17:29:56.993
> 
> 标签：java, ruby

假设我有以下红宝石代码：

```
 def use_object(object)
  puts object.some_method
end 
```

而且，这将适用于任何响应**some_method**的对象，对吗？

假设存在以下 java 接口：

```
 interface TestInterface {
   public String some_method();
} 
```

我是否可以假设接口是 java 实现相同目标的方式（唯一的区别是参数的类型是**TestInterface**）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T17:34:59.010

你是对的，除了你不能在 Java 接口中定义函数体，只能定义原型。

接口是在 Java 中实现伪多派生的唯一方法，因为普通类派生只是简单的（只有一个父类）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T17:41:02.413

不，没有实现接口。你可以有它的多个实现。

界面看起来更像：

```
interface TestInterface {
   public String some_method();
} 
```

它可以在一个类中实现：

```
public class TestClass implements TestInterface {
   public String some_method() {
       return "test";
   }
} 
```

也许还有更多以不同方式实现此方法的类。所有实现接口的类都必须实现接口声明的方法。

由于 Java 是静态类型的，因此您无法使用与 Ruby 示例中完全相同的接口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T17:35:31.177

Java 接口定义了实现类必须提供的方法签名。JavaDoc 非常详细地解释了所有这些。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T17:38:50.703

在 Java 中，接口只能用于*声明*方法，而不是定义（实现）它们。只有类可以实现方法。但是类可以实现接口。因此，您可以例如使用适配器模式来实现您在 ruby​​ 中所做的相同事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T17:41:22.197

是的，但前提是您想将“任何具有 some_method() 的东西”抽象为一个单独的概念。如果你只有一个类有 some_method()，你不需要指定接口，use_object() 的参数就是那个类。

另请注意，在 Java 中，我们使用 camelCase 而不是 underscore_separated 名称。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-27T03:53:39.730

看起来您正在尝试使用 Java 在 Ruby 中进行编程，您想重新考虑您的方法以使用更多的语言习语。

# asp.net-mvc - ActionLink 不起作用，但 RouteUrl 起作用

> ID：238317
> 
> 赞同：4
> 
> 时间：2008-10-26T17:34:25.953
> 
> 标签：asp.net-mvc

我有路线

```
// Sample URL: /Fixtures/Team/id
routes.MapRoute(
     "Fixtures-by-TeamID",
     "Fixtures/Team/{teamId}",
     new { controller = "Fixtures", action = "GetByTeamID", },
     new { teamId = @"\d{1,3}" }
); 
```

我正在尝试在 ASP.net MVC p5 中使用 ActionLink。

```
<%= Html.ActionLink(g.HomeTeam.TeamName, "Team", new { teamId = g.HomeTeam.TeamID })%> 
```

但是它不起作用并给了我

```
<a href="/Fixtures/Team?teamId=118">Team A</a> 
```

如果我使用 Url.RouteUrl，我会得到正确的链接。

```
<a href="<%=Url.RouteUrl("Fixtures-by-TeamID", new { teamId = g.HomeTeam.TeamID })%>"><%=g.HomeTeam.TeamName%></a>   

<a href="/Fixtures/Team/118">Team A</a> 
```

任何帮助都会很棒？ASP.net MVC beta 会发生这种变化吗？

谢谢

唐纳德

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T17:47:47.707

以我的经验，只有当你只有一个默认路由时，动作路由才能真正正常工作。一旦你开始像上面那样添加自定义路线，动作路线就变成了……我猜“挑剔”是正确的词。匹配系统并不能完全按照您的预期工作。

在这种情况下，您说动作是“团队”，但这条路线不匹配“团队”的动作，它只匹配“GetTeamByID”。因此，路由系统会继续运行并最终为您提供基于默认路由的路由。teamId 不是您的默认路由的明确部分，因此它最终作为查询参数附加在末尾。

MVC Beta 已经发布，并且这种行为没有改变。

另外，您不觉得命名路线更清晰吗？就个人而言，我愿意。

我什至更进一步，实际上为我的所有自定义路由创建了路由助手，在您当前的示例中可能如下所示：

```
<a href="<%= Url.FixturesByTeam(g.HomeTeam.TeamID) %>"><%= g.HomeTeam.TeamName %></a> 
```

甚至：

```
<%= Html.LinkToFixturesByTeam(g.HomeTeam) %> 
```

您可以直接从模型中提取名称和 ID 的值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T18:48:52.170

尝试这个：

```
// Sample URL: /Fixtures/Team/id
routes.MapRoute(
     "Fixtures-by-TeamID",
     "Fixtures/Team/{teamId}",
     new { controller = "Fixtures", action = "Team", teamId = -1 }
); 
```

您的控制器应如下所示：

```
public class FixturesController : BaseController // or whatever 
{
  /*...*/
  public ActionResult Team(int teamId)
  {
     return View("Detail", Team.GetTeamById(teamId)) // or whatever
  }
  /*...*/
} 
```

你的链接看起来像

```
<%= Html.ActionLink("Click here for the team details", "Team", "Fixtures", new { teamId = ViewModel.Data.Id /*orwhateverlol*/ }) %> 
```

（我在这台机器上没有 MVC，所以这一切都来自内存；可能有语法错误或某些参数颠倒了）。

请注意，您的路线图的路径与您的 1) 控制器、2) 操作 3) 参数名称相匹配。我发现默认操作（MapRoute 中的第三个参数）有效，而您对我以前从未见过的该方法的重载（可能是以前版本的保留）。

还要观察您的 FixturesController 如何匹配路径 (Fixtures) 和操作名称匹配 (Team)，以及参数匹配 (teamId)。

最后，ActionLink 的最后一个参数必须与控制器的名称 (teamId) 和类型参数匹配。

在这一点上它有点太“神奇”了（在后台有很多字符串比较！）。希望这会随着时间的推移而改善。旧的 Expression 风格要好得多。您实际上调用了您希望运行的方法，并使用您希望传递的值。我希望他们将这种表达风格带回框架中。哈克？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T19:21:50.463

你试过这个吗？

```
Html.ActionLink<FixturesController>(c => c.GetByTeamID(g.HomeTeam.TeamID), "Team") 
```

还

您可能希望将 action = "GetByTeamID" 添加到您的约束中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T20:38:09.797

当一个参数（在本例中为“action”）仅在默认值中定义而不在路由 url 中定义时，它必须是完全匹配的（除非您强制它与 RouteUrl 案例中的特定路由相反）。

为了让一切按现在的方式运行，您可以在上述路线下方的列表中添加另一条路线：

routes.MapRoute("Fixtures-by-TeamID1", "Fixtures/Team/{teamId}", new { controller = "Fixtures", action = "Team", }, new { teamId = @"\d{1,3 }" });

或者您可以将操作参数添加到路由 url，

或者您可以像以前一样使用命名路线。

# spreadsheet - 数据库：为电子表格建模的最佳方法

> ID：238328
> 
> 赞同：4
> 
> 时间：2008-10-26T17:41:04.693
> 
> 标签：spreadsheet, database-design

我试图找出对电子表格进行建模的最佳方法（从数据库的角度），考虑到：

*   电子表格可以包含可变数量的行。
*   电子表格可以包含可变数量的列。
*   每列可以包含一个值，但其类型未知（整数、日期、字符串）。
*   生成包含数据的 CSV 文件必须简单（且高效）。

我正在考虑类似的事情：

```
class Cell(models.Model):
    column = models.ForeignKey(Column)
    row_number = models.IntegerField()    
    value = models.CharField(max_length=100)

class Column(models.Model):
    spreadsheet = models.ForeignKey(Spreadsheet)
    name = models.CharField(max_length=100)
    type = models.CharField(max_length=100)

class Spreadsheet(models.Model):
    name = models.CharField(max_length=100)
    creation_date = models.DateField() 
```

你能想出一种更好的方法来为电子表格建模吗？我的方法允许将数据存储为字符串。我担心生成 CSV 文件太慢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T18:20:01.277

从关系的角度来看：

```
Spreadsheet <-->> Cell : RowId, ColumnId, ValueType, Contents 
```

行和列不需要是实体，但如果你愿意，你可以

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T18:21:11.240

数据库不是为此而设计的。但是你可以尝试几种不同的方法。

天真的方法是做一个表来统治他们的一个版本。也就是说，创建一个巨大的通用表，所有类型都是 (n)varchars，它有足够的列来覆盖任何可预见的电子表格。然后，您需要第二个表来存储关于第一个表的元数据，例如 Column1 的电子表格列名称是什么，它存储的类型（以便您可以输入和输出）等。然后您需要运行触发器插入检查传入的数据和元数据以确保数据没有损坏等。如您所见，这种方式是一个完整的集群。我会尖叫着逃跑。

第二种选择是将数据存储为 XML。大多数现代数据库都有 XML 数据类型，并且在查询中支持 xpath。您还可以使用 XSD 提供某种数据验证，并使用 xslts 将该数据转换为 CSV。我目前正在对配置文件做类似的事情，到目前为止效果还不错。目前还没有关于性能问题的消息，但我相信 Knuth 会解决这个问题。

第一个选项可能更容易搜索并且可以更快地从中检索数据，但第二个选项可能更稳定并且更容易编程。

像这样的时候，我希望 Celko 有一个 SO 帐户。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T18:19:41.900

您可能想研究 EAV（实体属性值）数据模型，因为它们正试图解决类似的问题。

[实体-属性-值 - 维基百科](http://en.wikipedia.org/wiki/Entity-Attribute-Value_model)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T18:20:03.023

最佳解决方案很大程度上取决于使用数据库的方式。尝试找到几个您期望的顶级用例，然后决定设计。例如，如果没有用例从数据库中获取某个单元格的值（数据总是在行级别加载，甚至在行组中加载），那么就不需要这样存储“单元格”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-04-03T01:37:17.927

这是一个很好的问题，需要很多答案，这取决于您如何处理它，我很乐意与您分享意见。这个主题是我们在 Zenkit 上搜索的各种主题之一，我们甚至写了一篇关于它的文章，我们希望您对此发表意见：[https ://zenkit.com/en/blog/spreadsheets-vs-databases/](https://zenkit.com/en/blog/spreadsheets-vs-databases/)

# c# - 使用 LINQ 和 C# 选择子集合的算法/模式

> ID：238340
> 
> 赞同：1
> 
> 时间：2008-10-26T17:48:02.290
> 
> 标签：c#, linq, algorithm, design-patterns

我有一个 C# 字符串集合。每个字符串都是一个可以出现在页面上的句子。我还有一个分页符集合，它是 int 的集合。表示将字符串集合拆分到新页面的索引。

示例：字符串集合中的每 10 个项目是一个页面，因此分页符集合将是具有 10、20、30 值的 int 集合。...

因此，如果有 2 页字符串，则分页符集合中将有 1 个项目，如果有 1 页，则分页符集合将有 0 个项目。

我正在尝试创建以下功能：

```
List<string> GetPage(List<string> docList, List<int> pageBreakList, int pageNum)
{
    // This function returns a subset of docList - just the page requested
} 
```

我在编写这个函数时做了一些尝试，并不断提出复杂的 if 和 switch 语句来考虑单页和两页文档以及在范围之外请求的页码（例如，如果页码是，则应返回最后一页如果页码为 0 或更少，则大于页数和第一页）。

我与这个问题的斗争让我问了一个问题：是否有一种众所周知的模式或算法来解决这种类型的子集查询？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T18:03:11.137

不确定分页符列表的用途。我会这样想。字符串、页码和页面大小的集合。然后你可以做类似的事情：

```
List<string> strings = ...
int pageNum = ...
int pageSze = ...

if (pageNum < 1) pageNum = 1;
if (pageSize < 1) pageSize = 1;

List<string> pageOfStrings = strings.Skip( pageSize*(pageNum-1) ).Take( pageSize ).ToList(); 
```

如果每页的页数根据您的评论而有所不同，请尝试以下操作。您可能需要调整边缘条件检查...

```
List<string> strings = ...
List<int> sizes = ...

int pageNum = ...
int itemsToSkip =  0;
int itemsToTake = 1;

if (pageNum > 1)
{
   sizes.Take( pageNum - 2).Sum();

   if (pageNum <= sizes.Count)
   {
       itemsToTake = sizes[pageNum-1]
   }
{

List<string> pageOfStrings = strings.Skip( itemsToSkip ).Take( itemsToTake ); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T19:05:21.917

“纯”Linq 不适合解决这个问题。最适合的是依赖 List(T) 的方法和属性。没有那么多特殊情况。

```
//pageNum is zero-based.
List<string> GetPage(List<string> docList, List<int> pageBreaks, int pageNum)
{

  // 0 page case
  if (pageBreaks.Count != 0)
  {
    return docList;
  }

  int lastPage = pageBreaks.Count;

  //requestedPage is after the lastPage case
  if (requestedPage > lastPage)
  {
    requestedPage = lastPage;
  }

  int firstLine = requestedPage == 0 ? 0  :
      pageBreaks[requestedPage-1];
  int lastLine = requestedPage == lastPage ? docList.Count :
      pageBreaks[requestedPage];

  //lastLine is excluded.  6 - 3 = 3 - 3, 4, 5

  int howManyLines = lastLine - firstLine;

  return docList.GetRange(firstLine, howManyLines);
} 
```

您不想用 linq 的 .Count() 方法替换 .Count 属性。您不想用 linq 的 .Skip(n).Take(m) 方法替换 .GetRange() 方法。

如果您想将这些集合投影到其他集合中，Linq 会更合适：

```
IEnumerable<Page> pages =
  Enumerable.Repeat(0, 1)
  .Concat(pageBreaks)
  .Select
  (
    (p, i) => new Page()
    {
      PageNumber = i,
      Lines = 
        docList.GetRange(p, ((i != pageBreaks.Count) ? pageBreaks[i] : docList.Count)  - p)
    }
  ); 
```

# .net - 如何在 .NET 中创建类似于 Office 2007 的选项屏幕

> ID：238341
> 
> 赞同：1
> 
> 时间：2008-10-26T17:48:19.297
> 
> 标签：.net, wpf, winforms, controls

我认为 Office 2007 中的选项屏幕比具有多个标签页的“传统”固定大小选项对话框更可取。为我自己的 .NET 应用程序创建类似选项屏幕的最佳方式是什么？是否有我可以购买（或免费使用）的现有控件来执行此操作？在 WPF 中这样做会更容易吗？

对于那些没有看过的人，Office 2007 将选项显示为一个垂直列表，分成几组，如果整个列表不适合窗口，可以滚动该列表。我希望 Office 中没有的一件事是能够有一个搜索框来对选项列表进行增量搜索/过滤。

编辑：为了澄清，我对选项的滚动行为、分组和布局比对左/右拆分和选项卡行为更感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T18:19:31.057

在 windows 窗体上使用拆分器控件将窗体拆分为左右面板。

将每个选项集定义为单独的用户定义控件，并根据需要在每个选项上布局控件。

当用户单击左侧面板中的不同选项类型时： splittercontrol1.panel2.Controls.Remove(CurrentUserDefinedPanel); （其中 CurrentUserDefinedPanel 是用户定义面板/控件的实际名称！）

splittercontrol1.panel2.Controls.Add(new UserDefinedPanel2());

this.paint();

因此，您删除当前正在显示的用户定义面板，并添加新面板，然后重新绘制...

# c++ - C++ 中的大数

> ID：238343
> 
> 赞同：11
> 
> 时间：2008-10-26T17:49:15.300
> 
> 标签：c++, biginteger

我试图在 C++ 变量中放置一个大数字。号码是600851475143

我尝试了 unsigned long long int 但得到一个错误，说它的常数太大了。然后我尝试了一个名为 BigInt 的 bigInt 库 -> [http://mattmccutchen.net/bigint/](http://mattmccutchen.net/bigint/)

问题是我无法编译代码，因为我收到了很多关于 lib 的错误。

对“BigInteger::BigInteger(int)”的未定义引用 <-- 其中很多。

到目前为止，这是我的代码：

```
#include "string"
#include "iostream"       
#include "bigint/NumberlikeArray.hh"
#include "bigint/BigUnsigned.hh"
#include "bigint/BigInteger.hh"
#include "bigint/BigIntegerAlgorithms.hh"
#include "bigint/BigUnsignedInABase.hh"
#include "bigint/BigIntegerUtils.hh"
using namespace std;

int main() {

    //unsigned long int num = 13195;
    //unsigned long long int num = 600851475143;
    BigInteger num = 13195;
    int divider = 2;

    //num = 600851475143;

    while (1) {
        if ((num % divider) == 0) {
            cout << divider << '\n';
            num /= divider;
        }
        else
            divider++;

        if (num == 1)
            break;
    }
} 
```

如果我输入较小的数字并且不使用 BigInt 库，则该程序运行良好。任何帮助将不胜感激：D

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-26T17:50:20.260

您可以通过后缀 L
指定整数文字。您可以通过后缀 LL 指定整数文字。

```
#include <iostream>

int main()
{
    long long num = 600851475143LL;

    std::cout << num;
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-26T17:53:11.377

数字 600851475143 对于 long long int 来说并不算大，但在使用 long long 常量时需要使用 LL 后缀（ULL 表示 unsigned long long int）：

```
unsigned long long int num = 600851475143ULL; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-26T18:00:56.960

大型整数库的存在理由是表示您的语言无法原生处理的整数。这意味着，你甚至不能把它写成文字。可能，该库有一种将字符串解析为大数字的方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T19:00:33.423

在更一般的情况下，当您无法长时间容纳您的号码并且可以使用 GNU LGPL 许可证（[http://www.gnu.org/copyleft/lesser.html](http://www.gnu.org/copyleft/lesser.html)）时，我建议您尝试使用 GNU Multiprecision Library ( [http://gmplib.org/](http://gmplib.org/) )。

它非常快，用 C 语言编写，并带有一个非常酷的 C++-wrapper-library。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-26T17:53:41.343

是否有要链接的 bigint 库或要编译的 bigint.cpp？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-26T18:04:49.807

如果您收到 bignum 库的未定义参考错误，您可能没有链接它。在 Unix 上，您必须传递一个选项，例如 -lbigint。如果您使用的是 IDE，则必须找到链接器设置并添加库。

至于数字，如前所述，自然常量默认为 int 类型。您必须使用 LL/ll 来获得 long long。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-26T19:50:13.183

在这种情况下，要做的第一件事是找出可以放入 unsigned long long 的最大数字是多少。因为它是 64 位的，所以最大的数字是 2^64-1 = 18446744073709551615，比你的数字大。然后你知道你做错了什么，你看看 Martin York 的答案，看看如何解决它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-03-08T11:24:34.487

试试这个。基本上你可以拥有自己的自定义类，它使用链表来存储无限大小的数量。（内存是限制）试试这个 [https://mattmccutchen.net/bigint/](https://mattmccutchen.net/bigint/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-08T20:06:49.843

对于在提出这个问题五年后遇到这个图书馆问题的任何其他人，这就是你的答案。你不能只编译你的程序，它会无法链接到一个丑陋的难以理解的错误！这个库是你应该编译成 .o 文件并链接的 c++ 文件的集合。如果您查看随示例程序提供的 make 文件的输出，您将看到：

```
g++ -c -O2 -Wall -Wextra -pedantic BigUnsigned.cc
g++ -c -O2 -Wall -Wextra -pedantic BigInteger.cc
g++ -c -O2 -Wall -Wextra -pedantic BigIntegerAlgorithms.cc
g++ -c -O2 -Wall -Wextra -pedantic BigUnsignedInABase.cc
g++ -c -O2 -Wall -Wextra -pedantic BigIntegerUtils.cc
g++ -c -O2 -Wall -Wextra -pedantic sample.cc
g++ sample.o BigUnsigned.o BigInteger.o BigIntegerAlgorithms.o BigUnsignedInABase.o BigIntegerUtils.o -o sample 
```

替换`sample`为您的程序的名称，将这些行粘贴到生成文件或脚本中，然后就可以走了。

# php - 让 php 和 sql server 2005 一起运行令人头疼

> ID：238349
> 
> 赞同：1
> 
> 时间：2008-10-26T17:52:14.153
> 
> 标签：php, sql-server

下面是我无法工作的代码。我知道我已经建立了与数据库的连接，但这没有返回任何内容。我究竟做错了什么？

```
$result = "SELECT * FROM images WHERE path = ?";
$params = array("blah");
$row = sqlsrv_query($conn, $result, $params);

$finished = sqlsrv_fetch_array($row);

if($finished)
{
echo "blach";
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T19:36:58.063

您可能需要按照[php.net 手册的 mssql_connect() 页面](http://www.php.net/manual/en/function.mssql-connect.php)上的说明替换您的 ntwdblib.dll 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T01:45:14.403

如果你不使用文字怎么办？大多数[MSDN 示例](http://msdn.microsoft.com/en-us/library/cc296201(SQL.90).aspx)都使用变量。

我会尝试：

```
$result = "SELECT * FROM images WHERE path = ?";
$var = "废话";
$row = sqlsrv_query($conn, $result, array($var));

$finished = sqlsrv_fetch_array($row);

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T19:42:02.343

是否值得检查查询没有返回错误？

```
$result = "SELECT * FROM images WHERE path = ?";
$params = array("blah");
$row = sqlsrv_query($conn, $result, $params);

if( $row === false ) {
    print_r(sqlsrv_errors());
} 
```

# php - 如何从 CakePHP 中的多个登录位置获取 loginRedirect？

> ID：238358
> 
> 赞同：5
> 
> 时间：2008-10-26T17:56:28.170
> 
> 标签：php, cakephp

我正在尝试在 CakePHP 应用程序中按照我的喜好进行身份验证，但遇到了障碍。

我想让用户从主页或专用登录页面登录。我正在使用 Auth 组件来管理登录，现在登录本身可以工作。我将主页上的表单提交到 /Users/Login ，它确实将它们登录并创建会话。问题是它然后将用户重定向回主页。我宁愿他们重定向到 loginRedirect 中指定的位置。

如果我直接从 /users/login 登录，它会转发到 loginRedirect。我认为这个问题与将表单从一个页面发布到另一个页面而不是它本身有关，auth 自动认为你想回到上一页。

有什么想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-23T20:19:09.813

在 AppController 中

```
public function beforeFilter( )
{
    $this->Auth->autoRedirect   =   false;
} 
```

在用户控制器中

```
public function login( )
{
    if( $this->Auth->user( ) )
    {
        $this->redirect( array(
            'controller'    =>  'users' ,
            'action'    =>  'index' ,
        ));
    }
} 
```

此外，如果您还没有将表单移动到一个元素中，那么您可以绝对确定两个登录视图之间的登录表单是相同的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T08:14:29.187

是的，auth 有一个功能，它会在登录之前将您重定向到您尝试访问的页面。如果设置登录重定向不起作用，您可以尝试将 loginRedirect 设置为 false 并手动执行 ($this->redirect( [..] ) 在 UsersController::login 操作中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T09:50:15.160

您可以通过将 $autoRedirect 设置为 false 并自行处理重定向来关闭它。AuthComponent 的问题在于，您无法真正控制的自动魔法太多，或者只能通过黑客来控制。

您的问题的一种解决方案是删除 Session.Auth.redirect 键，因此 AuthComponent 将始终使用 $loginRedirect URL：

```
$this->Session->del('Auth.redirect'); 
```

# wcf - WCF 变量生命周期/状态

> ID：238359
> 
> 赞同：1
> 
> 时间：2008-10-26T17:56:55.627
> 
> 标签：wcf, iis

我在 IIS 中托管我的第一个 WCF 服务。我有两种方法，一种是在 WCF 服务上设置一个字符串变量，另一种是检索它。使用的接口是：

```
[OperationContract]
string ReturnText();

[OperationContract]
void SetText(string s); 
```

使用 BasicHttpBinding。使用来自客户端的调试器单步执行服务显示，使用 SetText 正确设置了字符串的值，但是当我立即执行返回文本时，字符串又回到了 null。

可能是我知道的一个简单的，但我认为 WCF 服务上的所有值都在打开服务连接和关闭它之间保留。

为什么 Set 和 Gets 之间会丢失值？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-26T18:49:49.797

默认情况下，事情是无会话的，并且实例是每次调用的。看

[http://msdn.microsoft.com/en-us/library/ms731193.aspx](http://msdn.microsoft.com/en-us/library/ms731193.aspx)

对于一些入门信息，但为了在调用中拥有状态，您需要在服务器上使用 PerSession 或 Single instancing 模式，在前一种情况下，将绑定配置为支持会话（以便两个调用可以是由于是同一会话连接的一部分而相关）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T09:26:42.147

谢谢布赖恩，该链接包含我需要的信息。我已经添加

[ServiceContract (SessionMode=SessionMode.Required)]

到我的界面/合同，它现在自动工作了！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-18T13:38:59.160

对于 volatile 值，您也可以将值存储在静态变量中。只要 wcf 主机没有被回收/重新启动，这也将在调用之间保持其状态

# php - 从 For 循环中取出第一项

> ID：238376
> 
> 赞同：2
> 
> 时间：2008-10-26T18:08:17.070
> 
> 标签：php, joomla, for-loop

我正在编写自己的 Joomla 组件 (MVC)，它主要基于 newsflash 模块，因为我想在滑动选项卡式界面中显示最新的 5 个内容项，所有的辛苦工作都完成了，但我很难获得内容出for循环。

这是我到目前为止的代码 default.php

```
<ul id="handles" class="tabs">
    <?php for ($i = 0, $n = count($list); $i < $n; $i ++) :
            modSankeSlideHelper::getTabs($list[$i]);
     endfor; ?>                
<li class="end"></li>
</ul> 
```

助手.php

```
function getTabs(&$item)
{
    global $mainframe;

    $item->created     = $item->created;

    list($year, $month, $day) = split("-", $item->created);
    $tabdate = date('d\/m\/y', mktime(0, 0, 0, $month, $day, $year));

    require(JModuleHelper::getLayoutPath('mod_sankeslide', '_tab'));
} 
```

_tab.php

```
<li><a href="#tab"><span><?php echo 'Shout ' . $tabdate; ?></span><b></b></a></li> 
```

第一项需要具有不同的值，并且需要将一个类项添加到 a: 项中，因此我需要能够识别哪个是第一项并在该循环中执行某些操作。

我尝试在 default.php 中使用 if $i = 0 else 语句，但由于某种原因导致页面超时！

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T18:17:52.823

你说，你试过`if $i = 0`了，PHP中的[比较运算符](http://www.php.net/operators.comparison)是`==`，如果你有一个无限循环，因为在每次迭代中你将0分配给$i，它永远不会达到$n，你应该在你的循环中做：

```
if ($i == 0){
  // First Item here...

}else{
  // Other Items...

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T18:18:47.627

我认为@CMS 是正确的。

您可能还想考虑处理循环外的第一项，并让循环处理其余的项。这样您就不必在每次通过循环时进行检查。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T22:54:22.203

如果您使用的是普通`for`循环，我建议您只对第一项进行操作，然后按照[tvanfosson](https://stackoverflow.com/users/12950/tvanfosson) [所说](https://stackoverflow.com/questions/238376/getting-the-first-item-out-of-a-for-loop#238392)的那样遍历其余部分。它稍微快一些，并且可能更容易阅读......

```
doSomethingWithFirst($list[0]);

for ($i = 1; $i < count($list); $i++) {
    doSomethingWithTheRest($list[$i]);
} 
```

我倾向于使用`foreach`over`for`来遍历数组，在这种情况下，我会使用“firstDone”var，如下所示：

```
$bFirstTime = true;
foreach($list as $item) {
    if ($bFirstTime) {
        doSomethingWithFirst($item);
        $bFirstTime = false;
    } else {
        doSomethingWithTheRest($item);
    }
} 
```

# haskell - 在 Haskell 中，如何在父进程和分叉子进程之间共享数据？

> ID：238379
> 
> 赞同：5
> 
> 时间：2008-10-26T18:10:04.977
> 
> 标签：haskell, concurrency, process

我什至如何首先使用 Haskell 来分叉一个子进程？

此外，如果管道是数据共享问题的明显解决方案 - 除了使用管道之外还有其他方法吗？我熟悉 C 中共享内存段的使用（shmget、*shmat、shmdt 和 shmctl 函数）。Haskell 可以模仿吗？如果是这样，怎么做？

如果您能提供任何帮助，我将不胜感激。

我必须承认我对函数式编程语言非常陌生，尤其是在 Haskell 方面。所以如果我说了些傻话，请原谅我（并请纠正我）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T19:01:21.927

更好的是，使用软件事务内存——即 TVar 和 TChannel。

会推荐同一本书，不同章节：[http ://book.realworldhaskell.org/read/software-transactional-memory.html](http://book.realworldhaskell.org/read/software-transactional-memory.html)

这是该技术的一个很好的小例子：http: [//sequence.complete.org/node/257](http://sequence.complete.org/node/257)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-02-21T10:06:46.587

OP 询问与子进程而不是线程通信的问题。为此，管道是一种非常好的方法。如果你愿意，你也可以直接从 Haskell 调用 C 库函数，尽管这可能会很棘手。

这个问题在这里有一个更好的答案：[是否有一些标准的 Haskell 库处理进程通信？](https://stackoverflow.com/questions/9167867/is-there-some-standard-haskell-library-dealing-with-process-communication)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T18:28:18.280

使用 MVar 或通道。参见 RealWorld Haskell 的第 24 章：http: [//book.realworldhaskell.org/read/concurrent-and-multicore-programming.html](http://book.realworldhaskell.org/read/concurrent-and-multicore-programming.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-02-21T10:06:06.160

如果你想真正 fork 一个进程，Unix 风格，你需要`forkProcess`使用[http://hackage.haskell.org/package/unix-2.4.2.0/docs/System-Posix-Process.html](http://hackage.haskell.org/package/unix-2.4.2.0/docs/System-Posix-Process.html)

在这种情况下，MVars 和 TVars 不做进程间通信，所以你不能用它们来做 IPC。IPC 的所有标准技术（管道、套接字等）仍然有效。如果您想要更高级的东西，请查看 Cloud Haskell [http://www.haskell.org/haskellwiki/Cloud_Haskell](http://www.haskell.org/haskellwiki/Cloud_Haskell)

# database - 更新 Postgres 中的引用列

> ID：238380
> 
> 赞同：1
> 
> 时间：2008-10-26T18:10:10.327
> 
> 标签：database, postgresql, migration

当有多个列引用另一个列时，我正在努力寻找更新该列同时保持引用完整性的最佳方法。例如，如果我有一个标签和描述表以及两个条目：

```
Label | Description
------------------------------------
read  | This item has been read
READ  | You read this thing already 
```

现在，我不想要这些重复。我想向不允许不区分大小写重复的值的列添加一个约束，如示例中所示。但是，我有几行引用“READ”的其他几个表，我想删除那个。

我知道 Postgres 知道其他行的哪些字段正在引用它，因为只要它们在那里，我就无法删除它。那么，我怎样才能让任何引用它的字段更新为“读取”？这只是一个例子，我实际上有几个地方想要这样做。另一个例子实际上是几个表的 int 主键，我想添加一个新表作为现有表扩展的“基表”，因此它们现在都需要具有唯一 ID，这意味着更新他们拥有的那些。

我对我可以添加的功能、我可以使用的工具或其他任何东西持开放态度。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T18:18:01.450

如果您有许多行引用 READ，您可以将外键更改为级联更新，更新该表集 Label = 'read' where Label = 'READ'，一切都会自动修复。之后，您可以再次将约束更改为以前的状态。

要查找引用该列的所有表，您可以使用

```
select TABLE_NAME,COLUMN_NAME,CONSTRAINT_NAME,
REFERENCED_TABLE_NAME,REFERENCED_COLUMN_NAME from 
INFORMATION_SCHEMA.KEY_COLUMN_USAGE where
REFERENCED_TABLE_NAME = '<table>' AND REFERENCED_COLUMN_NAME = '<column>' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T21:38:10.143

对于将来，您可以在“标签”列上创建一个唯一索引，例如：

```
CREATE UNIQUE INDEX index_name ON table ((lower(label))); 
```

或查看[手册](http://www.postgresql.org/docs/current/static/sql-createindex.html)。这将有助于您下次避免这种情况。

# audio - 对数字音频进行下采样和应用低通滤波器

> ID：238382
> 
> 赞同：13
> 
> 时间：2008-10-26T18:12:07.343
> 
> 标签：audio, signal-processing, pcm, downsampling

我有来自 CD 的 44Khz 音频流，表示为 16 位 PCM 样本数组。我想将其缩减为 11KHz 流。我怎么做？从我多年前上工程课的日子开始，我知道流将无法准确描述超过 5500Hz 的任何东西，所以我想我也想剪掉超过 5500Hz 的所有东西。有任何想法吗？谢谢。

[更新：此页面](http://www.codeguru.com/forum/showthread.php?t=463186&page=1&pp=15)上有一些代码使用简单的算法和看起来像 { 1, 4, 12, 12, 4, 1 } 的系数数组从 48KHz 转换为 8KHz。我认为这就是我所需要的，但我需要它的 4 倍而不是 6 倍。知道这些常数是如何计算的吗？此外，无论如何，我最终还是将 16 字节样本转换为浮点数，因此我可以使用浮点数而不是短裤进行下采样，如果这对质量有帮助的话。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-26T18:46:05.327

阅读 FIR 和 IIR 滤波器。这些是使用系数阵列的过滤器。

如果您在“FIR 或 IIR 滤波器设计器”上进行谷歌搜索，您会发现许多软件和在线小程序可以为您完成艰巨的工作（获取系数）。

**编辑：**

这个页面在这里（[http://www-users.cs.york.ac.uk/~fisher/mkfilter/](http://www-users.cs.york.ac.uk/~fisher/mkfilter/)）让你输入你的过滤器的参数，并会吐出准备使用C代码......

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-26T20:27:30.550

你是对的，你需要对你的信号应用低通滤波。任何超过 5500 Hz 的信号都将出现在您的下采样信号中，但会“混叠”为另一个频率，因此您必须在下采样之前将其删除。

使用浮点数进行过滤是个好主意。也有定点滤波器算法，但这些算法通常需要权衡质量。如果您有花车，请使用它们！

使用 DFT 进行过滤通常是矫枉过正，它使事情变得更加复杂，因为 dft 不是一个连续的过程，而是在缓冲区上工作。

数字滤波器通常有两种口味。FIR 和 IIR。这通常是相同的想法，但 IIF 滤波器使用反馈回路来实现更陡峭的响应和更少的系数。这对于下采样可能是一个好主意，因为您需要一个非常陡峭的滤波器斜率。

下采样是一种特殊情况。因为您将丢弃 4 个样本中的 3 个，所以无需计算它们。为此有一类特殊的滤波器，称为多相滤波器。

尝试在谷歌上搜索多相 IIR 或多相 FIR 以获取更多信息。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-03-26T17:34:09.860

请注意（除了其他评论之外）简单直观的方法“*通过将每组 4 个连续样本替换为平均值来将样本缩小 4 倍*”不是最优的，但仍然没有错，实际上也没有概念上。因为平均等于一个低通滤波器（一个矩形窗口，对应于频率的正弦值）。在概念上错误的是通过每 4 个样本中的一个来进行下采样：这肯定会引入混叠。

顺便说一句：几乎所有进行重新采样的软件（音频、图像或其他；音频案例的示例：sox）都会考虑到这一点，并经常让您选择底层的低通滤波器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T18:18:54.367

您需要在对信号进行下采样之前应用低通滤波器以避免“混叠”。低通滤波器的截止频率应小于奈奎斯特频率，即采样频率的一半。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-26T21:03:49.947

可能的“最佳”解决方案确实是 DFT，丢弃前 3/4 的频率，并执行逆 DFT，域限制在底部的 1/4。在这种情况下，丢弃前 3/4 是低通滤波器。填充到 2 个样本的幂可能会给您带来速度优势。请注意您的 FFT 包如何存储样本。如果它是一个复杂的 FFT（更容易分析，并且通常具有更好的特性），频率将从 -22 到 22，或 0 到 44。在第一种情况下，您需要中间的 1/4。在后者中，最外层的 1/4。

您可以通过将样本值平均在一起来完成足够的工作。以四乘四的方式抓取样本并进行相等加权平均的天真方法是可行的，但并不太好。相反，您需要使用“内核”函数以非直观的方式将它们平均在一起。

在数学上，丢弃低频带之外的所有内容是乘以频率空间中的盒函数。（逆）傅立叶变换将逐点乘法转换为函数的（逆）傅立叶变换的卷积，反之亦然。因此，如果我们想在时域工作，我们需要使用盒函数的（逆）傅里叶变换进行卷积。结果证明这与“sinc”函数（sin at）/at 成正比，其中 a 是频率空间中框的宽度。因此，在每第 4 个位置（因为您要进行 4 倍的下采样），您可以将其附近的点相加，乘以 sin (a dt) / a dt，其中 dt 是到该位置的时间距离。有多近？好吧，这取决于您希望它听起来有多好。它'

最后，还有一种很糟糕（但很快）的方法，就是丢弃大部分样本，只保留第零个、第四个等等。

老实说，如果它适合记忆，我建议只走 DFT 路线。如果它不使用其他人推荐的软件过滤器包之一为您构建过滤器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-05-09T14:32:02.143

您所追求的过程称为“抽取”。有2个步骤：

1.  对数据应用低通滤波器（在您的情况下，LPF 在 Pi / 4 处截止）。
2.  下采样（在您的情况下，从 4 个样本中抽取 1 个）。

有许多方法可以设计和应用低通滤波器。

你可以从这里开始：

[http://en.wikipedia.org/wiki/Filter_design](http://en.wikipedia.org/wiki/Filter_design)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-06-05T04:41:47.487

您可以使用[libsamplerate](http://www.mega-nerd.com/SRC/)来完成繁重的工作。Libsamplerate 是一个 C API，负责计算滤波器系数。您可以从不同的质量过滤器中进行选择，以便您可以权衡质量以换取速度。

如果您不想编写任何代码，您可以使用[Audacity](http://audacity.sourceforge.net/)进行采样率转换。它提供了强大的 GUI，并利用 libsamplerate 进行采样率转换。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-26T18:27:22.633

我会尝试应用 DFT，砍掉 3/4 的结果并应用逆 DFT。如果不真正努力，我无法判断它是否听起来不错。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-15T11:07:49.517

我最近遇到了[BruteFIR](http://www.ludd.luth.se/~torger/brutefir.html)，它可能已经做了一些你感兴趣的事情？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-06-24T17:41:43.353

您必须应用低通滤波器（去除 5500 Hz 以上的频率），然后应用抽取（在您的情况下每第 N 个样本，每 4 个样本）。

对于抽取，通常使用 FIR 而不是 IIR 滤波器，因为它们不依赖于先前的输出，因此您不必为丢弃的样本计算任何内容。IIR 通常取决于输入和输出，因此，除非使用特定类型的 IIR，否则您必须在丢弃 3/4 之前计算每个输出样本。

刚刚搜索了一篇关于这个主题的介绍性文章：[https ://www.dspguru.com/dsp/faqs/multirate/decimation](https://www.dspguru.com/dsp/faqs/multirate/decimation)

# linux - 在 Linux 中的 Javascript 中使用 ActiveX 对象（在 Firefox 中）

> ID：238384
> 
> 赞同：1
> 
> 时间：2008-10-26T18:12:34.410
> 
> 标签：linux, firefox, activex

这不是一个“编程”问题，但我希望它的相关性足够密切。

您知道是否可以在 Linux（例如 Firefox）中配置浏览器以使用 Wine 来创建 ActiveX 对象？我想处理使用以下内容的网页：

```
var xmlDocument = new ActiveXObject( Msxml2.DOMDocument.4.0 ) 
```

等在Javascript中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T11:05:56.440

我认为你只能[在 Wine 上的 Internet Explorer 中做到这一点](http://www.gagme.com/greg/linux/activex-linux.php)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T18:25:09.207

ActiveXObject 是 Windows 脚本宿主的一部分，在 Linux 中不可用，除非您可以使用 Wine 来安装它。

作为一个附带问题，实际的 ActiveXObject 是 Windows 应用程序的一个实例，在 Linux 中通常不可用（尤其是 MS Office 套件）。

链接：

[Windows 脚本宿主](http://msdn.microsoft.com/en-us/library/9bbdkx3k(VS.85).aspx)

[葡萄酒](http://www.winehq.org/)

编辑：让 Wine 与 Mono 混淆。现在修好了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T15:49:46.867

如果您只想要一个 xml 文档，您可以通过标准 javascript 来实现。他们不需要 ActiveX。只需要求文档为您解析 xml。看看 Mozilla 开发者中心。他们有非常好的 JS 文档。

另一方面，如果您想跨浏览器网页避开 ActiveX。尤其是所有的安全漏洞。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-03T08:33:46.790

你可以在linux的firefox中看到flash。尝试使用闪光灯。

# .net - Crystal Reports for .Net 中的子报表源

> ID：238387
> 
> 赞同：1
> 
> 时间：2008-10-26T18:14:54.467
> 
> 标签：.net, crystal-reports

我在 .Net 的 Crystal Reports 解决方案中使用了几个子报表。我创建了一个独立的报告，然后将该报告作为子报告导入到其他几个报告中。对独立版本的更改不会合并到任何利用它的报告中。我是否需要以这种方式不断地重新导入报表，或者有没有办法让 Crystal Reports for .Net 引用另一个“.rpt”文件以便自动应用更改？

编辑：现在我看到右键单击并选择“重新导入”实际上存在与之相关的问题。即，所有子报表字段都消失了。文本标题和行仍然存在，但所有字段都消失了。我什至跟踪 SQL 以确保链接按宣传的那样工作，然后我测试了 SQL 以确保返回结果集。这份报告简直“崩溃”了。我必须删除它们并重新添加它们。多么痛苦。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T19:39:20.633

不知道这是否是 .Net 的 CR，现在无法检查，该功能处于完整版本中。

右键单击主屏幕上的报表并调出格式子报表属性选择“打开时重新导入子报表”选项。报告必须在主页上打开才能激活。

# java - 用于加密的java包

> ID：238404
> 
> 赞同：4
> 
> 时间：2008-10-26T18:22:32.627
> 
> 标签：java, encryption

我想问一个小问题。我需要使用 Java 编写使用 32 位算法加密文本的程序。那么合适的包或库是什么？

谢谢大家

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-26T19:00:45.593

正如 Bob 提到的，javax.crypto 包是您最好的选择，因为它是 Java API 的一部分。话虽如此，我知道 JDK 附带的实现（至少对于某些算法，并且在旧版本的 JDK 中）相当慢。

如果您正在寻找替代实现（仍然符合 javax.crypto 规范），请查看 Bouncy Castle：

[http://www.bouncycastle.org/](http://www.bouncycastle.org/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T18:53:49.070

你是说[javax.crypto](http://java.sun.com/javase/6/docs/api/javax/crypto/package-summary.html)包吗？从[这里](http://java.sun.com/javase/6/docs/api/index.html)找到的 JDK 6u10 javadoc 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T18:52:10.757

查看来自格拉茨技术大学（奥地利）的 java 安全产品（库）。[http://jce.iaik.tugraz.at/](http://jce.iaik.tugraz.at/)

不幸的是，他们的产品似乎不再免费了。所以我不知道这是否可以解决您的问题。

# c++ - 在哪里可以了解有关 pthread 的更多信息？

> ID：238411
> 
> 赞同：1
> 
> 时间：2008-10-26T18:28:23.240
> 
> 标签：c++, pthreads

我被要求处理一段严重依赖 pthread 的代码。对这个库进行了如此多的调用，我对此一无所知。我已经学习了 pthread 的基础知识并尝试了一些示例，例如创建连接等，但不知道它的深度。

我使用[http://www.yolinux.com/TUTORIALS/LinuxTutorialPosixThreads.html学到了很多东西](http://www.yolinux.com/TUTORIALS/LinuxTutorialPosixThreads.html)

上面的教程没有深入介绍初学者应该需要的 pthread 库。你们可以为我推荐一个网站或电子书，让我看看并学习大多数高级的东西，比如信号处理、互斥锁、并发等。

TIA, the_Saint

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-26T18:32:48.287

[https://computing.llnl.gov/tutorials/pthreads/](https://computing.llnl.gov/tutorials/pthreads/)

[http://en.wikipedia.org/wiki/POSIX_Threads](http://en.wikipedia.org/wiki/POSIX_Threads)

[编辑] 第一个链接已损坏，现在已修复。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T22:37:33.190

查看 Butenhof 的“使用 POSIX 线程编程”（例如，[此处](https://rads.stackoverflow.com/amzn/click/com/0201633922)）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T19:05:50.667

了解任何编程概念的最佳方法是通过示例来解决一些问题，例如使用生产者和消费者、阅读器/编写器问题和实现简单的数学计算器等 pthreads 解决一些问题。有一些链接可以帮助你，
[http：/ /www.humbug.org.au/talks/pthreads/examples.html，http://www.cs.ucsb.edu/~tyang/class/pthreads/index_sgi.html](http://www.humbug.org.au/talks/pthreads/examples.html) _
[_](http://www.cs.ucsb.edu/~tyang/class/pthreads/index_sgi.html)

还有一本书“UNIX® 环境中的高级编程：W. Richard Stevens、Stephen A. Rago 的第二版”

一切顺利！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T21:40:48.093

正如 Ankit S 上面所说，Unix 环境中的高级编程是一个很好的来源。此外，Unix 网络编程的第 2 卷（也是 Stevens 的）有很大一部分是关于 posix 信号量和类似主题的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-12T07:59:20.860

[http://randu.org/tutorials/threads/](http://randu.org/tutorials/threads/)

[http://www.ibm.com/developerworks/linux/library/l-posix1/index.html](http://www.ibm.com/developerworks/linux/library/l-posix1/index.html)

[http://www.cs.cf.ac.uk/Dave/C/node32.html](http://www.cs.cf.ac.uk/Dave/C/node32.html)

您可以在 stackoverflow 上阅读很多内容： [https ://stackoverflow.com/questions/tagged/pthreads+c](https://stackoverflow.com/questions/tagged/pthreads+c)

# c# - Lambda 表达式树解析

> ID：238413
> 
> 赞同：16
> 
> 时间：2008-10-26T18:33:24.603
> 
> 标签：c#, lambda, expression-trees

我正在尝试在项目中使用 Lambda 表达式来映射到第三方查询 API。所以，我正在手动解析表达式树。

如果我传入一个 lambda 表达式，例如：

```
p => p.Title == "title" 
```

一切正常。

但是，如果我的 lambda 表达式看起来像：

```
p => p.Title == myaspdropdown.SelectedValue 
```

使用 .NET 调试器，我看不到该功能的实际价值。相反，我看到了类似的东西：

```
p => p.Title = (value(ASP.usercontrols_myaspusercontrol_ascx).myaspdropdown.SelectedValue) 
```

是什么赋予了？当我尝试将表达式的右侧作为字符串抓取时，我得到`(value(ASP.usercontrols_myaspusercontrol_ascx).myaspdropdown.SelectedValue)`的不是实际值。**我如何获得实际价值？**

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-27T08:53:00.873

请记住，当您将 lambda 表达式作为表达式树处理时，您没有可执行代码。相反，您有一个表达式元素树，它们构成了您编写的表达式。

Charlie Calvert 有[一篇很好的帖子](https://docs.microsoft.com/en-us/archive/blogs/charlie/expression-tree-basics)详细讨论了这一点。包括使用表达式可视化器调试表达式的示例。

在您的情况下，要获取等式表达式右侧的值，您需要创建一个新的 lambda 表达式，编译它然后调用它。

我已经编写了一个简单的示例 - 希望它能够满足您的需求。

```
public class Class1
{
    public string Selection { get; set; }

    public void Sample()
    {
        Selection = "Example";
        Example<Book, bool>(p => p.Title == Selection);
    }

    public void Example<T,TResult>(Expression<Func<T,TResult>> exp)
    {
        BinaryExpression equality = (BinaryExpression)exp.Body;
        Debug.Assert(equality.NodeType == ExpressionType.Equal);

        // Note that you need to know the type of the rhs of the equality
        var accessorExpression = Expression.Lambda<Func<string>>(equality.Right);
        Func<string> accessor = accessorExpression.Compile();
        var value = accessor();
        Debug.Assert(value == Selection);
    }
}

public class Book
{
    public string Title { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T19:46:31.007

要获得实际值，您需要将表达式树的逻辑应用于您拥有的任何上下文。

表达式树的全部意义在于它们将*逻辑*表示为数据，而不是评估表达式。您需要弄清楚 lambda 表达式的真正含义。这可能意味着根据本地数据评估其中的某些部分 - 您需要自己决定。表达式树非常强大，但是解析和使用它们并不是一件简单的事情。（询问任何编写过 LINQ 提供程序的人...... Frans Bouma 曾多次哀叹这些困难。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-16T12:20:28.627

一直在努力解决完全相同的问题，谢谢贝文。在扩展上，以下是可用于提取值的通用模式（在我的查询引擎中使用它）。

```
 [TestFixture]
public class TestClass
{
    [Test]
    public void TEst()
    {
        var user = new User {Id = 123};
        var idToSearch = user.Id;
        var query = Creator.CreateQuery<User>()
            .Where(x => x.Id == idToSearch);
    }
}

public class Query<T>
{
    public Query<T> Where(Expression<Func<T, object>> filter)
    {
        var rightValue = GenericHelper.GetVariableValue(((BinaryExpression)((UnaryExpression)filter.Body).Operand).Right.Type, ((BinaryExpression)((UnaryExpression)filter.Body).Operand).Right);
        Console.WriteLine(rightValue);
        return this;
    }
}

internal class GenericHelper
{
    internal static object GetVariableValue(Type variableType, Expression expression)
    {
        var targetMethodInfo = typeof(InvokeGeneric).GetMethod("GetVariableValue");
        var genericTargetCall = targetMethodInfo.MakeGenericMethod(variableType);
        return genericTargetCall.Invoke(new InvokeGeneric(), new[] { expression });
    }
}

internal class InvokeGeneric
{
    public T GetVariableValue<T>(Expression expression) where T : class
    {
        var accessorExpression = Expression.Lambda<Func<T>>(expression);
        var accessor = accessorExpression.Compile();
        return accessor();
    }
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-26T18:42:45.223

我不确定我是否理解。你在哪里“看到”那个？那是在设计时还是运行时？Lambda 表达式本质上可以被认为是匿名委托，并且将在延迟执行的情况下进行操作。因此，显然，在执行通过该行之前，您不应该期望看到分配的值。
我不认为这真的是你的意思......如果你澄清一下这个问题也许我可以帮助:)

# java - 我应该使用什么技术来创建分布式会计软件？

> ID：238421
> 
> 赞同：2
> 
> 时间：2008-10-26T18:39:57.147
> 
> 标签：java, .net, forms, architecture, accounting

这是我目前的选择。

1.  .Net：使用 WPF、Visual C#、SQLServer
2.  Java：使用 Spring、Hibernate、Enterprise DB、基于 Web

您能建议哪个更好吗？尤其是在构建复杂表单方面。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T19:03:36.600

哇，.NET 与 Java，迫不及待地想看看结果如何 ;-)

.NET 可能在 WPF 和单击一次部署方面具有优势。WPF 是第二个版本，并且显示出它非常强大且易于使用。它在逻辑和表示（在 XAML 中）之间提供了出色的分离。就个人而言，我更喜欢 Windows 应用程序而不是 Web 部署，因为编程模型更加强大和通用（并且更适合复杂的表单）。

在这里我不会尝试代表 Java 的观点，但是 Java 中的 Windows 窗体开发并没有很好的声誉。也许这是没有根据的，我很想听听 Java 程序员要说什么。（更新——Swing 是我在这里指的技术）

在某种程度上，这是一个错误的选择，因为您列出的其他技术（Spring、Hibernate）在 .NET 堆栈（Spring.Net 和 NHibernate）上也可用，并且相当成熟。大多数流行的 Java 开源技术已移植到 .NET 堆栈。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T19:08:13.953

根据该标准掷硬币或使用您知道的那个，对于表单和基本应用程序，它们基本上是相同的。

如果您正在做小型企业会计软件，请查看 Quickenbooks 的 Peachtree 之类的软件，它们具有一定程度的定制功能。如果您正在做大中型公司，请查看 Netsuite 或 SAP 之类的东西，他们有很多定制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T06:58:12.947

.Net 更好。Java 在客户端机器上运行缓慢。Java 最适合面向服务器的任务。

# asp.net-mvc - 如何在 ASP.NET MVC 中将多个对象传递给 ViewPage？

> ID：238430
> 
> 赞同：6
> 
> 时间：2008-10-26T18:46:15.717
> 
> 标签：asp.net-mvc

我想我知道答案，但我想围绕一些想法反弹。

我想将几个（在本例中为 2）有些不同的数据传递给视图。我最初的想法只是将各种对象包装成一个包含对象并以这种方式传递它们。然后从视图中，我会有类似的东西

```
var objContainer = ViewData.Model;
var thisObject = objContainer.ThisObject;
var thatObject = objContainer.ThatObject; 
```

这些可以在母版页和查看页中独立使用。

这是“最好”的方式吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-26T19:10:48.020

我发现创建专用于视图的附加类很有用。我将它们保存在一个名为“Core.Presentation”的单独命名空间中，以使事情井井有条。这是一个例子：

```
namespace Core.Presentation
{
    public class SearchPresentation
    {
        public IList<StateProvince> StateProvinces { get; set; }
        public IList<Country> Countries { get; set; }
        public IList<Gender> Genders { get; set; }
        public IList<AgeRange> AgeRanges { get; set; }
    }
} 
```

然后我确保我的 View 是一个使用该表示类的通用版本的强类型视图：

```
public partial class Search : ViewPage<SearchPresentation> 
```

这样在视图中，我可以使用 Intellisense 并轻松浏览项目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T18:56:18.863

我有同样的交易。这是我的解决方案（可能不是最佳实践，但对我有用）。

我创建了许多“分组”类：

```
public class Duo<TFirst,TSecond> { /*...*/ }
public class Trio<TFirst,TSecond, TThird> { /*...*/ } 
```

和一个工厂对象来创建它们（利用类型推断......一些 TFirsts 和 TSeconds 和 TThirds 可以是 LONG）

```
public static class Group{

public static Duo<TFirst, TSecond> Duo(TFirst first, TSecond second) { 
  return new Duo<TFirst, TSecond>(first, second);
 }    
/*...*/
} 
```

它为我提供了类型安全和智能感知功能，并且无需大惊小怪。它只是闻起来很臭，因为您将它们之间基本上没有真正关系的类组合到一个对象中。我想扩展 ViewPage 类以添加第二个和第三个 ViewModel 可能会更好，但我这样做的方式需要更少的工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T18:57:07.910

是的，您指定为模型的类可以由其他类组成。但是，为什么不像这样使用字典：

```
ViewData["foo"] = myFoo;
ViewData["bar"] = myBar; 
```

我认为这比将模型定义为其他不相关对象的容器更好，这对我来说有一种奇怪的气味。

# asp.net-mvc - 为什么AuthorizeAttribute会重定向到登录页面进行认证和授权失败？

> ID：238437
> 
> 赞同：273
> 
> 时间：2008-10-26T18:51:09.263
> 
> 标签：asp.net-mvc, authentication, authorization

在 ASP.NET MVC 中，您可以使用 标记控制器方法`AuthorizeAttribute`，如下所示：

```
[Authorize(Roles = "CanDeleteTags")]
public void Delete(string tagName)
{
    // ...
} 
```

这意味着，如果当前登录的用户不是“CanDeleteTags”角色，则永远不会调用控制器方法。

不幸的是，对于失败，`AuthorizeAttribute`返回`HttpUnauthorizedResult`，它总是返回 HTTP 状态代码 401。这会导致重定向到登录页面。

如果用户没有登录，这很有意义。但是，如果用户*已经*登录，但不是所需的角色，将他们发送回登录页面会令人困惑。

似乎`AuthorizeAttribute`将身份验证和授权混为一谈。

这在 ASP.NET MVC 中似乎有点疏忽，还是我遗漏了什么？

我不得不煮一个`DemandRoleAttribute`将两者分开的。当用户未通过身份验证时，它会返回 HTTP 401，将其发送到登录页面。当用户登录但不是所需的角色时，它会创建一个`NotAuthorizedResult`。目前这会重定向到错误页面。

当然我不必这样做？

* * *

## 回答 #1

> 赞同：311
> 
> 时间：2011-04-30T22:00:22.260

最初开发时，System.Web.Mvc.AuthorizeAttribute 做的是正确的事 - HTTP 规范的旧版本使用状态代码 401 表示“未授权”和“未验证”。

从原始规范：

> 如果请求已包含授权凭证，则 401 响应表示已拒绝对这些凭证的授权。

实际上，您可以在此处看到混乱-它在表示“身份验证”时使用了“授权”一词。然而，在日常实践中，当用户通过身份验证但未授权时，返回 403 Forbidden 更有意义。用户不太可能拥有第二组可以授予他们访问权限的凭据 - 到处都是糟糕的用户体验。

考虑大多数操作系统 - 当您尝试读取您无权访问的文件时，您不会看到登录屏幕！

值得庆幸的是，HTTP 规范已更新（2014 年 6 月）以消除歧义。

来自“超文本传输​​协议（HTTP/1.1）：身份验证”（RFC 7235）：

> 401（未授权）状态码表示该请求尚未应用，因为它缺少目标资源的有效身份验证凭据。

来自“超文本传输​​协议 (HTTP/1.1)：语义和内容”(RFC 7231)：

> 403（Forbidden）状态码表示服务器理解请求但拒绝授权。

有趣的是，在 ASP.NET MVC 1 发布时，AuthorizeAttribute 的行为是正确的。现在，行为不正确 - HTTP/1.1 规范已修复。

与其尝试更改 ASP.NET 的登录页面重定向，不如从源头解决问题更容易。**您可以在网站的默认命名空间**中创建一个具有相同名称 ( `AuthorizeAttribute`)的新属性（这非常重要），然后编译器会自动选择它而不是 MVC 的标准属性。当然，如果您愿意采用这种方法，您总是可以给属性一个新名称。

 **```
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, Inherited = true, AllowMultiple = true)]
public class AuthorizeAttribute : System.Web.Mvc.AuthorizeAttribute
{
    protected override void HandleUnauthorizedRequest(System.Web.Mvc.AuthorizationContext filterContext)
    {
        if (filterContext.HttpContext.Request.IsAuthenticated)
        {
            filterContext.Result = new System.Web.Mvc.HttpStatusCodeResult((int)System.Net.HttpStatusCode.Forbidden);
        }
        else
        {
            base.HandleUnauthorizedRequest(filterContext);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-01T13:29:29.310

将此添加到您的 Login Page_Load 函数中：

```
// User was redirected here because of authorization section
if (User.Identity != null && User.Identity.IsAuthenticated)
    Response.Redirect("Unauthorized.aspx"); 
```

当用户被重定向到那里但已经登录时，它会显示未经授权的页面。如果他们没有登录，它会通过并显示登录页面。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T22:02:54.477

不幸的是，您正在处理 ASP.NET 表单身份验证的默认行为。这里讨论了一种解决方法（我没有尝试过）：

[http://www.codeproject.com/KB/aspnet/Custon401Page.aspx](http://www.codeproject.com/KB/aspnet/Custon401Page.aspx)

（它不是特定于 MVC）

我认为在大多数情况下，最好的解决方案是在用户尝试到达那里之前限制对未经授权的资源的访问。通过删除/灰显可能将他们带到此未经授权页面的链接或按钮。

在属性上添加一个附加参数来指定将未经授权的用户重定向到何处可能会很好。但与此同时，我将 AuthorizeAttribute 视为安全网。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-27T16:28:46.647

我一直认为这确实有道理。如果您已登录并尝试访问需要您没有角色的页面，您将被转发到登录屏幕，要求您使用具有该角色的用户登录。

您可以向登录页面添加逻辑，以检查用户是否已通过身份验证。您可以添加一条友好的消息，解释为什么他们又被撞回了那里。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-01-08T21:44:27.313

在 Global.ascx 文件的 Application_EndRequest 处理程序中尝试此操作

```
if (HttpContext.Current.Response.Status.StartsWith("302") && HttpContext.Current.Request.Url.ToString().Contains("/<restricted_path>/"))
{
    HttpContext.Current.Response.ClearContent();
    Response.Redirect("~/AccessDenied.aspx");
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-14T23:05:55.623

如果您使用 aspnetcore 2.0，请使用：

```
using System;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Filters;

namespace Core
{
    [AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, Inherited = true, AllowMultiple = true)]
    public class AuthorizeApiAttribute : Microsoft.AspNetCore.Authorization.AuthorizeAttribute, IAuthorizationFilter
    {
        public void OnAuthorization(AuthorizationFilterContext context)
        {
            var user = context.HttpContext.User;

            if (!user.Identity.IsAuthenticated)
            {
                context.Result = new UnauthorizedResult();
                return;
            }
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-03-18T18:38:48.977

就我而言，问题是“HTTP 规范对“未经授权”和“未经身份验证”都使用了状态代码 401”。正如ShadowChaser所说。

这个解决方案对我有用：

```
if (User != null &&  User.Identity.IsAuthenticated && Response.StatusCode == 401)
{
    //Do whatever

    //In my case redirect to error page
    Response.RedirectToRoute("Default", new { controller = "Home", action = "ErrorUnauthorized" });
} 
```

# c++ - C 编译器可以重新排列堆栈变量吗？

> ID：238441
> 
> 赞同：16
> 
> 时间：2008-10-26T18:53:46.090
> 
> 标签：c++, c, compiler-construction, alignment, callstack

过去我从事过嵌入式系统的项目，我们重新安排了堆栈变量的声明顺序以减小生成的可执行文件的大小。例如，如果我们有：

```
void func()
{
    char c;
    int i;
    short s;
    ...
} 
```

我们将其重新排序为：

```
void func()
{
    int i;
    short s;
    char c;
    ...
} 
```

由于对齐问题，第一个导致使用了 12 个字节的堆栈空间，而第二个导致仅使用了 8 个字节。

这是 C 编译器的标准行为还是我们使用的编译器的一个缺点？

在我看来，如果编译器愿意，它应该能够重新排序堆栈变量以支持更小的可执行文件大小。有人向我建议 C 标准的某些方面阻止了这种情况，但无论哪种方式我都无法找到有信誉的来源。

作为一个额外的问题，这是否也适用于 C++ 编译器？

**编辑**

如果答案是肯定的，C/C++ 编译器可以重新排列堆栈变量，你能举一个绝对做到这一点的编译器的例子吗？我想查看编译器文档或类似的东西来支持这一点。

**再次编辑**

谢谢大家的帮助。对于文档，我能找到的最好的东西是 Naveen Sharma 和 Sanjiv Kumar Gupta 的论文[GCC 中的 Optimal Stack Slot Assignment](http://mirror-fpt-telecom.fpt.net/gcc/summit/2003/Optimal%20Stack%20Slot%20Assignment.pdf) (pdf)，它在 2003 年的 GCC 峰会上发表。

这里讨论的项目是使用 ADS 编译器进行 ARM 开发。在该编译器的文档中提到，像我展示的排序声明可以提高性能以及堆栈大小，因为 ARM-Thumb 体系结构如何计算本地堆栈帧中的地址。该编译器不会自动重新排列本地变量以利用这一点。此处链接的论文说，截至 2003 年，GCC 也没有重新排列堆栈帧以改善 ARM-Thumb 处理器的参考位置，但这意味着您可以。

我找不到任何可以肯定地说这曾经在 GCC 中实现过的东西，但我认为这篇论文可以证明你都是正确的。再次感谢。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-04T06:30:45.690

编译器不仅可以重新排序局部变量的堆栈布局，还可以将它们分配给寄存器，将它们分配给有时在寄存器中有时在堆栈中，它可以将两个局部变量分配给内存中的同一个槽（如果它们的生存范围不要重叠），它甚至可以完全消除变量。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-26T19:04:28.237

由于标准中没有任何内容禁止 C 或 C++ 编译器这样做，是的，编译器可以做到这一点。

对于必须保持相对顺序的聚合（即结构）则不同，但编译器仍然可以插入填充字节以实现更好的对齐。

IIRC 较新的 MSVC 编译器使用这种自由来对抗本地缓冲区溢出。

附带说明一下，在 C++ 中，即使编译器重新排序内存布局，销毁的顺序也必须与声明的相反顺序。

（我不能引用章节和诗句，但这是凭记忆。）

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-26T19:22:40.057

编译器甚至可以自由地从堆栈中删除变量并使其注册，前提是分析表明该变量的地址从未被占用/使用。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-26T19:38:38.963

堆栈甚至不需要存在（事实上，C99 标准中没有出现一次“堆栈”一词）。所以是的，编译器可以自由地做它想做的任何事情，只要它保留具有自动存储持续时间的变量的语义。

举个例子：我多次遇到这样的情况，因为它存储在寄存器中，所以无法在调试器中显示局部变量。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-26T21:03:47.357

德州仪器 62xx 系列 DSP 的编译器能够进行“整个程序优化”。（你可以关掉它）

这是您的代码重新排列的地方，而不仅仅是本地代码。所以执行顺序最终并不完全符合您的预期。

*C 和 C++实际上*并没有承诺内存模型（在 JVM 的意义上），所以事情可能完全不同并且仍然合法。

对于那些不了解它们的人，62xx 系列是每个时钟周期 8 条指令的 DSP；在 750Mhz 时，它们确实在 6e+9 指令处达到峰值。反正有些时候。它们进行并行执行，但指令排序是在编译器中完成的，而不是 CPU，就像 Intel x86 一样。

PIC 和 Rabbit 嵌入式板没有堆栈，除非你特别好问*。*

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-26T19:28:19.873

编译器甚至可能根本不使用堆栈来存储数据。如果您在一个非常小的平台上，以至于您担心 8 字节和 12 字节的堆栈，那么很可能会有编译器具有非常专业的方法。（想到一些 PIC 和 8051 编译器）

你要为什么处理器编译？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-26T18:58:19.030

这是编译器的细节，如果他想要那样的话，可以制作自己的编译器来做相反的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-26T19:30:21.493

如果可以的话，一个体面的编译器会将局部变量放在寄存器中。只有当寄存器压力过大（没有足够的空间）或者变量的地址被占用时，变量才应该放在堆栈上，这意味着它需要存在于内存中。

据我所知，没有什么说变量需要放置在 C/C++ 堆栈上的任何特定位置或对齐位置；编译器会将它们放在最适合性能和/或编译器编写者方便的地方。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-26T19:43:38.143

AFAIK 在 C 或 C++ 的定义中没有任何内容指定编译器应如何在堆栈上对局部变量进行排序。我会说在这种情况下依赖编译器可能会做的事情是个坏主意，因为下一个版本的编译器可能会做不同的事情。如果您花费时间和精力对局部变量进行排序以节省几个字节的堆栈，那么这几个字节最好对您的系统运行非常关键。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-26T21:10:13.973

无需对 C 标准需要或不需要什么进行无谓的猜测：最近的草案可从[ANSI/ISO 工作组](http://www.open-std.org/jtc1/sc22/wg14/www/standards)在线免费获得。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-28T15:28:42.227

这不能回答您的问题，但这是我关于相关问题的 2 美分...

我没有堆栈空间优化的问题，但我遇到了堆栈上双变量未对齐的问题。可以从任何其他函数调用函数，并且堆栈指针值可以具有任何未对齐的值。所以我想出了下面的想法。这不是原始代码，我只是写了它......

```
#pragma pack(push, 16)

typedef struct _S_speedy_struct{

 double fval[4];
 int64  lval[4];
 int32  ival[8];

}S_speedy_struct;

#pragma pack(pop)

int function(...)
{
  int i, t, rv;
  S_speedy_struct *ptr;
  char buff[112]; // sizeof(struct) + alignment

  // ugly , I know , but it works...
  t = (int)buff;
  t +=  15; // alignment - 1
  t &= -16; // alignment
  ptr = (S_speedy_struct *)t;

  // speedy code goes on...
} 
```

# reporting-services - 如何配置 SQL Server 2005 Reporting Services (SSRS) 以通过远程 SMTP 服务器通过电子邮件发送报告？

> ID：238449
> 
> 赞同：5
> 
> 时间：2008-10-26T18:57:19.577
> 
> 标签：reporting-services, smtp, reporting

如何配置 SSRS/Windows Server 2003，以便我可以通过需要用户名和密码的远程 SMTP 服务器设置电子邮件传送。

我可以使用 SMTP 地址和其他参数配置 SSRS，但无法使用 smtp 用户名和密码对其进行配置。

我四处寻找，但只能找到关于设置某种中继的模糊参考，以掩盖 SSRS 开箱即用的奇怪缺乏 smtp 功能。

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-04T14:55:17.153

以下是仅使用 Microsoft SSRS/Windows Server 2003 组件进行设置的步骤。

1) 在添加/删除程序 / 应用服务器 / IIS 中安装 SMTP 服务器
**在 IIS 管理器中：**
2) 添加您将发送的域（作为远程类型），例如*yourwebsite.com*
3) 在默认 SMTP 虚拟服务器属性/交付下选项卡/高级按钮，在智能主机字段中添加您的远程 smtp 服务器。
4) 在默认 SMTP 虚拟服务器属性/交付选项卡/出站安全按钮下，选择基本身份验证，用户名 = SMTP 用户名，密码 = SMTP 密码

**在 rsreportserver.config 文件**（*sql drive* :\Program Files\Microsoft SQL Server\MSSQL.3\Reporting Services\ReportServer）中：
5) 填充`<SMTPServer>x.x.x.x</SMTPServer>`您刚刚设置 SMTP 服务器的机器的 IP。
6) 填充`<From>you@yourwebserver.com</From>`
7) 将此更改为 false `<SendEmailToUserAlias>False</SendEmailToUserAlias>`
8) 最后，确保将域设置为允许的主机，例如：
`<PermittedHosts>`
`<HostName>yourwebsite.com</HostName>`
`</PermittedHosts>`

至于*为什么*SSRS 中不直接支持 SMTP 基本身份验证似乎是设计使然。我能在这个[MSDN 论坛](http://social.msdn.microsoft.com/Forums/en-US/sqlreportingservices/thread/e8c388ef-a864-4ab6-804f-4da3ca73aaf7)上找到最好的解释：

正如这里的一张海报所提到的，有一张[Microsoft Connect 票](https://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=332979)可供请求此功能的人使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-16T11:56:42.763

当然你已经解决了这个问题，但是让我在这里提供一个额外的信息，以便其他有同样问题的人，比如我，可以按照 Tom Willwerth 的这篇文章来解决这个问题。

要解决这个 SMTP 中继问题，只需按照上述步骤操作，但一定要执行一个额外的步骤，可以调用： 4-a) 在访问选项卡上，选择中继，然后在选择哪台计算机上选择“除以下以外的所有”通过此虚拟服务器中继：

这将允许所有连接通过此 smtp 发送，但请注意 smtp 服务器将中继连接到它的任何人。如果要限制此中继，请选择“仅以下列表”并添加要中继的机器。

有关这方面的更多详细信息，您可以查看我在以下位置找到此信息的来源：http: [//businessintelligencechronicles.blogspot.com/2010/08/configure-reporting-services-to-use.html](http://businessintelligencechronicles.blogspot.com/2010/08/configure-reporting-services-to-use.html)

另一件事，步骤 8) 不是必需的。

希望它对其他人有帮助，并感谢您提供的信息，它有帮助，现在我认为只需按照此链接上的步骤操作即可解决此问题。

问候

ps：有错误请见谅

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T05:48:44.407

这可能对您有所帮助：C:\Program Files\Microsoft SQL Server\MSSQL.3\Reporting Services\ReportServer\rsreportserver.config 包含 . 我看不出你到底想要什么，所以你可能不得不执行一些接力技巧。

# php - 帮助为 Eclipse 设置 php

> ID：238451
> 
> 赞同：14
> 
> 时间：2008-10-26T18:58:23.583
> 
> 标签：php, eclipse, eclipse-pdt

我正在尝试为 php web 开发设置 Eclipse。我想做的是从 Eclipse 中预览一个 php 网页，但我不知道该怎么做。是否有某种集成的 Web 服务器允许这样做，还是我必须设置 IIS/Apache 才能做到这一点？如果是这样，我是否必须将我的 php 文件放在 web 服务器路径中，或者 Eclipse 是否会自动将文件部署到本地 web 服务器？任何信息或链接将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-26T20:44:52.480

Eclipse 有一个名为 PDT 的插件，它使 PHP 开发变得轻而易举。

有关如何安装它的概述，您可以参考 Eclipse 网站：

> [http://wiki.eclipse.org/PDT/Installation#Eclipse_3.4_.2F_Ganymede_.2F_PDT_2.0](http://wiki.eclipse.org/PDT/Installation#Eclipse_3.4_.2F_Ganymede_.2F_PDT_2.0)

要实际查看正在运行的 PHP 脚本，我想您必须已经安装并运行某种服务器。您可以将工作空间位置设置为服务器路径，然后通过 localhost 查看文件。但也许 PDT 包会为您解决其中的一些问题。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-05-11T08:18:06.063

我会让它变得非常容易；）

(1) 到 Eclipse 主页： http: [//www.eclipse.org/downloads/](http://www.eclipse.org/downloads/) 下载 Eclipse Classic（当前 May/2013 版本为 4.2.2）

(2) 你的机器上已经启动了 Eclipse 执行以下操作：Help > Install Software

![帮助 > 安装软件](https://i.stack.imgur.com/90FXn.png)

比，点击添加![点击添加](https://i.stack.imgur.com/UGVyM.png)

最后，添加此链接： http: [//download.eclipse.org/releases/indigo](http://download.eclipse.org/releases/indigo) 以获取所有附加组件列表![添加](https://i.stack.imgur.com/GKc1s.png)

并在 Web Addon 下选择 PHP（应该在列表中的最后一个）并安装它。

重新启动你的 Eclipse + 对我的 Ans 竖起大拇指。并开始编码；）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T20:47:43.723

我在我的 Windows PC 上设置了 apache/php/MySQL，因此测试环境与我的服务器并不完全不同（操作系统除外，但 90% 的时间都可以）。我在 Apache 配置中为 Eclipse 工作区创建别名，然后在浏览器和 Eclipse 之间切换。用于测试的 URL 类似于：

```
http://localhost/project_name/file.php 
```

虽然这并不理想，但它是一个相当一致/流畅的过程，不需要在 Eclipse 中进行大量配置。我一直认为应该有更好的方法，但老实说，我认为我没有花足够的时间来证明这项研究的合理性。设置完成后，我就不会再浪费时间了，而且我可以控制在我的系统上运行的 PHP 版本。

无论如何，我不倾向于使用集成浏览器来测试 Web 应用程序。每次我处理一个，它都与我必须完全重新测试的“真实”浏览器完全不同。至少这样，当我完成逻辑的第一遍时，我已经完成了我的 Firefox 测试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T03:34:41.670

试试[easyeclipse](http://www.easyeclipse.org)，这是我发现的最简单的 Eclipse 设置

“EasyEclipse for LAMP：使用 Web 服务器和数据库进行 PHP、Python、Perl 和 Ruby 开发”

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-21T12:32:45.047

我还建议下载和安装 WAMP 服务器，它是一个非常简单的多合一 Windows 等价物（Windows、Apache、MySQL、PHP），您可能拥有商业网络主机。有关详细信息和下载，请参见[http://www.wampserver.com](http://www.wampserver.com)。

除了已经提到的 pdt 之外，其他替代品还有 phpeclipse 和基于 eclipse 的 aptana studio。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-11-27T17:28:03.030

访问此网站[https://eclipse.org/pdt/](https://eclipse.org/pdt/)。转到显示“更新现有 Eclipse”的位置。

程序是这样的“在 Eclipse 中，单击帮助 -> 安装新软件并使用 *: [http://download.eclipse.org/tools/pdt/updates/3.6](http://download.eclipse.org/tools/pdt/updates/3.6) ”

# c++ - C++ RTTI 可行的例子

> ID：238452
> 
> 赞同：30
> 
> 时间：2008-10-26T18:58:34.270
> 
> 标签：c++, rtti

我熟悉 C++ RTTI，并且觉得这个概念很有趣。

仍然存在很多滥用它的方法而不是正确使用它（RTTI-switch 恐惧浮现在脑海中）。作为一名开发人员，我发现（并使用）它只有两个可行的用途（更准确地说，一个半）。

**您能否分享一些 RTTI 是解决问题的可行方法，包括示例代码/伪代码？**

注意：目的是建立一个可供初级开发人员参考、批评和学习的可行示例库。

**编辑：**你会发现下面的代码使用 C++ RTTI

```
// A has a virtual destructor (i.e. is polymorphic)
// B has a virtual destructor (i.e. is polymorphic)
// B does (or does not ... pick your poison) inherits from A

void doSomething(A * a)
{
   // typeid()::name() returns the "name" of the object (not portable)
   std::cout << "a is [" << typeid(*a).name() << "]"<< std::endl ;

   // the dynamic_cast of a pointer to another will return NULL is
   // the conversion is not possible
   if(B * b = dynamic_cast<B *>(a))
   {
      std::cout << "a is b" << std::endl ;
   }
   else
   {
      std::cout << "a is NOT b" << std::endl ;
   }
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-26T19:40:41.987

[Acyclic Visitor](http://www.objectmentor.com/resources/articles/acv.pdf) (pdf) 很好地利用了它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-26T21:11:07.933

boost::any 对象怎么样！

这基本上使用 RTTI 信息来存储任何对象，并使用 boost::any_cast<> 检索该对象。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-26T21:47:33.213

您可以将 RTTI 与 dynamic_cast 一起使用来获取指向派生类的指针，以便使用它来调用快速的类型专用算法。而不是通过基类使用虚拟方法，它将进行直接和内联调用。

这让我使用 GCC 加快了速度。Visual Studio 似乎做得不太好，它的 dynamic_cast 查找速度可能较慢。

例子：

```
D* obj = dynamic_cast<D*>(base);
if (obj) {
    for(unsigned i=0; i<1000; ++i)
        f(obj->D::key(i));
    }
} else {
    for(unsigned i=0; i<1000; ++i)
        f(base->key(i));
    }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-26T19:45:41.087

我不能说我曾经在现实生活中找到过使用，但在[Effective C++](http://www.aristeia.com/books.html)中提到 RTTI作为 C++ 中多方法的可能解决方案。这是因为方法分派是针对参数的动态类型而不是`this`参数的静态类型进行的。

```
class base
{
  void foo(base *b) = 0; // dynamic on the parameter type as well
};

class B : public base {...}
class B1 : public B {...}
class B2 : public B {...}

class A : public base
{
  void foo(base *b)
  {
    if (B1 *b1=dynamic_cast<B1*>(b))
      doFoo(b1);
    else if (B2 *b2=dynamic_cast<B2*>(b))
      doFoo(b2);
  }
}; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-27T02:22:58.837

我在序列化为 XML 文件的类树中使用它。在反序列化时，解析器类返回一个指向基类的指针，该基类具有子类类型的枚举（因为在解析它之前您不知道它是哪种类型）。如果使用该对象的代码需要引用子类特定元素，它会将枚举值和 dynamic_cast 切换到子类（由解析器创建）。这样，代码可以检查以确保解析器没有错误以及枚举值与返回的类实例类型之间不匹配。虚函数也不够用，因为您可能需要获取子类特定数据。

这只是 RTTI 可能有用的一个例子；这可能不是解决问题的最优雅的方法，但是使用 RTTI 可以使应用程序在使用这种模式时更加健壮。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-26T19:50:26.960

我曾经做过一次飞机模拟，他们（有点令人困惑）称之为“模拟数据库”。您可以在其中注册浮点数、整数或字符串等变量，人们可以按名称搜索它们，并提取对它们的引用。您还可以注册一个模型（从“SimModel”派生的类的对象）。我使用 RTTI 的方式是让你可以搜索实现给定接口的模型：

```
SimModel* SimDatabase::FindModel<type*>(char* name="")
{
   foreach(SimModel* mo in ModelList)
   if(name == "" || mo->name eq name)
   {
       if(dynamic_cast<type*>mo != NULL)
       {
           return dynamic_cast<type*>mo;
       }
   }
   return NULL;
} 
```

SimModel 基类：

```
class public SimModel
{
    public:
        void RunModel()=0;
}; 
```

一个示例接口可能是“EngineModel”：

```
class EngineModelInterface : public SimModel
{
    public:
        float RPM()=0;
        float FuelFlow()=0;
        void SetThrottle(float setting)=0; 
}; 
```

现在，制作莱康明和大陆发动机：

```
class LycomingIO540 : public EngineModelInterface 
{
    public:
        float RPM()
        {
            return rpm;
        }
        float FuelFlow()
        {
            return throttleSetting * 10.0;
        }
        void SetThrottle(float setting) 
        {
            throttleSetting = setting
        }
        void RunModel() // from SimModel base class
        {
            if(throttleSetting > 0.5)
                rpm += 1;
            else
                rpm -= 1;
        }
    private:
        float rpm, throttleSetting;
};
class Continental350: public EngineModelInterface 
{
    public:
        float RPM()
        {
            return rand();
        }
        float FuelFlow()
        {
            return rand;
        }
        void SetThrottle(float setting) 
        {
        }
        void RunModel() // from SimModel base class
        {
        }
}; 
```

现在，这里有一些有人想要引擎的代码：

```
.
.
EngineModelInterface * eng = simDB.FindModel<EngineModelInterface *>();
.
.
fuel = fuel - deltaTime * eng->FuelFlow();    
.
.
. 
```

代码是相当伪的，但我希望它能传达这个想法。一个开发人员可以编写依赖于引擎的代码，但只要它有实现引擎接口的东西，它并不关心它是什么。因此，更新油箱中燃料量的代码与除了 FindModel<>() 函数和他有兴趣使用的纯虚拟 EngineModel 接口之外的所有内容完全解耦。一年后有人可以制造一个新的发动机模型，将它注册到 SimulationDatabase，上面更新燃料的人会自动开始使用它。我实际上是这样做的，因此您可以在运行时将新模型作为插件 (DLL) 加载，一旦它们在 SimulationDatabase 中注册，就可以使用 FindModel<>() 找到它们，即使正在寻找它们的代码在新 DLL 存在几个月前就已编译并构建到 DLL 中。您还可以添加从 SimModel 派生的新接口，在一个 DLL 中实现它们，在另一个 DLL 中搜索它们，一旦加载了两个 DLL，就可以执行 FindModel<>() 来获取模型另一个。即使在构建主应用程序时界面本身甚至不存在。

顺便说一句，RTTI 并不总是跨 DLL 边界工作。因为无论如何我都在使用 Qt，所以我使用`qobject_cast`了`dynamic_cast`. 每个类都必须从 QObject 继承（并获得 moc'd），但 qobject 元数据始终可用。*如果您不*关心 DLL，或者您正在使用 RTTI跨 DLL 边界工作的工具链（类型比较基于字符串比较而不是哈希或其他），那么上述所有方法都`dynamic_cast`可以正常工作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-27T14:51:46.250

有时`static_cast`，C 风格的演员表还不够，您需要`dynamic_cast`，例如当您拥有可怕的[菱形层次结构](http://en.wikipedia.org/wiki/Diamond_problem)时（图片来自 Wikipedia）。

![钻石传承](https://upload.wikimedia.org/wikipedia/commons/thumb/8/8e/Diamond_inheritance.svg/180px-Diamond_inheritance.svg.png)

```
struct top {
};

struct left : top { 
    int i;
    left() : i(42) {}
};

struct right : top {
    std::string name;
    right() : name("plonk") { }
};

struct bottom : left, right {
};

bottom b;
left* p = &b;

//right* r = static_cast<right*>(p); // Compilation error!
//right* r = (right*)p;              // Gives bad pointer silently 
right* r = dynamic_cast<right*>(p);  // OK 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-07-18T22:45:46.793

我在项目中的用例（如果您知道针对特定案例的更好解决方案，请发表评论）：

1.  和 1800 INFORMATION 一样的东西已经提到过：

    对于派生类，您需要一个`dynamic_cast`for `operator==`or`operator<`实现。或者至少我不知道任何其他方式。

2.  如果您想实现类似`boost::any`或其他一些变体容器。

3.  在一个具有（可能的实例是和）（最多可以有一个）的`Client`类中的一个游戏中，我需要一个函数。这个函数很少使用，所以我想避免与一个额外的局部成员变量和处理这个的所有额外代码混淆。`std::set<Player*>``NetPlayer``LocalPlayer``LocalPlayer``LocalPlayer* Client::localPlayer()``Client`

4.  我有一些`Variable`带有几个实现的抽象类。所有已注册`Variable`的 s 都在 some 中`std::set<Variable*> vars`。并且有几个类型的内置变量`BuiltinVar`保存在`std::vector<BuiltinVar> builtins`. 在某些情况下，我有 a`Variable*`并且需要检查它是否是 a`BuiltinVar*`和 inside `builtins`。我可以通过一些内存范围检查或通过`dynamic_cast`（我可以确定在任何情况下所有实例`BuiltinVar`都在这个向量中）来做到这一点。

5.  我有一个`GameObject`s 的网格集合，我需要检查一个网格内是否有一个`Player`对象（一个专门的`GameObject`）。我可以有一个`bool GameObject::isPlayer()`总是返回 false 的函数，`Player`或者我可以使用 RTTI。还有更多这样的例子，人们经常实现类似`Object::isOfTypeXY()`的功能，因此基类变得非常混乱。

    对于其他非常特殊的功能，例如`Object::checkScore_doThisActionOnlyIfIAmAPlayer()`. 需要一些常识来决定什么时候在基类中拥有这样的函数真正有意义，什么时候没有。

6.  有时我将它用于断言或运行时安全检查。

7.  有时我需要将一些数据的指针存储在某个 C 库的某个数据字段中（例如 SDL 或其他），然后我会在其他地方或作为回调得到它。我在`dynamic_cast`这里做一个只是为了确保我得到我所期望的。

8.  我有一些`TaskManager`类执行一些`Task`s 队列。对于某些`Task`s，当我将它们添加到列表中时，我想`Task`从队列中删除其他相同类型的s。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-26T20:35:48.427

几年前，我在使用 Qt 做一些基于画布的工作时使用了 RTTI。在对对象进行命中测试以使用 RTTI 来确定我将要“命中”的形状时，这非常方便。但我没有在生产代码中使用它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-27T07:47:16.217

我将它与**[Dynamic Double Dispatch 和 Templates](http://jogear.net/dynamic-double-dispatch-and-templates)**一起使用。基本上，它提供了仅观察/聆听对象有趣部分的能力。

# asp.net-mvc - ASP.NET MVC Beta 1：DefaultModelBinder 在不相关的请求之间错误地保留参数和验证状态

> ID：238460
> 
> 赞同：6
> 
> 时间：2008-10-26T19:04:05.930
> 
> 标签：asp.net-mvc, inversion-of-control, castle-windsor, defaultmodelbinder

当我使用默认模型绑定将表单参数绑定到作为操作参数的复杂对象时，框架会记住传递给第一个请求的值，这意味着对该操作的任何后续请求都会获得与第一个请求相同的数据。参数值和验证状态在不相关的 Web 请求之间保持不变。

这是我的控制器代码（`service`代表对应用程序后端的访问）：

```
 [AcceptVerbs(HttpVerbs.Get)]
    public ActionResult Create()
    {
        return View(RunTime.Default);
    }

    [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Create(RunTime newRunTime)
    {
        if (ModelState.IsValid)
        {
            service.CreateNewRun(newRunTime);
            TempData["Message"] = "New run created";
            return RedirectToAction("index");
        }
        return View(newRunTime);
    } 
```

我的 .aspx 视图（强类型为`ViewPage<RunTime`>）包含如下指令：

```
<%= Html.TextBox("newRunTime.Time", ViewData.Model.Time) %> 
```

这使用了`DefaultModelBinder`该类，该类[旨在自动绑定我的模型的 properties](http://weblogs.asp.net/scottgu/archive/2008/10/16/asp-net-mvc-beta-released.aspx#three)。

我点击页面，输入有效数据（例如时间 = 1）。该应用程序正确保存了时间 = 1 的新对象。然后我再次点击它，输入不同的有效数据（例如时间 = 2）。但是，保存的数据是原始数据（例如时间 = 1）。这也会影响验证，所以如果我的原始数据无效，那么我以后输入的所有数据都被认为是无效的。重新启动 IIS 或重建我的代码会刷新持久状态。

我可以通过编写自己的硬编码模型绑定器来解决这个问题，下面显示了一个基本的简单示例。

```
 [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Create([ModelBinder(typeof (RunTimeBinder))] RunTime newRunTime)
    {
        if (ModelState.IsValid)
        {
            service.CreateNewRun(newRunTime);
            TempData["Message"] = "New run created";
            return RedirectToAction("index");
        }
        return View(newRunTime);
    }

internal class RunTimeBinder : DefaultModelBinder
{
    public override ModelBinderResult BindModel(ModelBindingContext bindingContext)
    {
        // Without this line, failed validation state persists between requests
        bindingContext.ModelState.Clear();

        double time = 0;
        try
        {
            time = Convert.ToDouble(bindingContext.HttpContext.Request[bindingContext.ModelName + ".Time"]);
        }
        catch (FormatException)
        {
            bindingContext.ModelState.AddModelError(bindingContext.ModelName + ".Time", bindingContext.HttpContext.Request[bindingContext.ModelName + ".Time"] + "is not a valid number");
        }

        var model = new RunTime(time);
        return new ModelBinderResult(model);
    }
} 
```

我错过了什么吗？我不认为这是浏览器会话问题，因为如果在一个浏览器中输入第一个数据而在另一个浏览器中输入第二个数据，我可以重现该问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T20:20:24.637

事实证明，问题在于我的控制器在调用之间被重用。我选择从原始帖子中省略的细节之一是我正在使用 Castle.Windsor 容器来创建我的控制器。我没有用 Transient 生活方式标记我的控制器，所以我在每个请求上都得到了相同的实例。因此，绑定器使用的上下文被重新使用，当然它包含陈旧的数据。

我在仔细分析 Eilon 的代码和我的代码之间的差异时发现了这个问题，排除了所有其他可能性。正如[城堡文档所说](http://www.castleproject.org/monorail/documentation/trunk/integration/windsor.html)，这是一个“可怕的错误”！让这成为对其他人的警告！

感谢您的回复 Eilon - 很抱歉占用您的时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T17:53:19.970

我试图重现这个问题，但我没有看到同样的行为。我创建了几乎完全相同的控制器和视图（有一些假设），每次我创建一个新的“运行时”时，我都会将它的值放入 TempData 并通过重定向发送它。然后在目标页面上，我抓取了该值，它始终是我在该请求中输入的值——绝不是过时的值。

这是我的控制器：

公共类 HomeController : Controller { public ActionResult Index() { ViewData["Title"] = "Home Page"; string message = "欢迎：" + TempData["Message"]; if (TempData.ContainsKey("value")) { int theValue = (int)TempData["value"]; 消息 += " " + theValue.ToString(); } ViewData[“消息”] = 消息；返回视图（）；}

```
[AcceptVerbs(HttpVerbs.Get)]
public ActionResult Create() {
    return View(RunTime.Default);
}

[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Create(RunTime newRunTime) {
    if (ModelState.IsValid) {
        //service.CreateNewRun(newRunTime);
        TempData["Message"] = "New run created";
        TempData["value"] = newRunTime.TheValue;
        return RedirectToAction("index");
    }
    return View(newRunTime);
} 
```

}

这是我的视图（Create.aspx）：

```
<% using (Html.BeginForm()) { %>
<%= Html.TextBox("newRunTime.TheValue", ViewData.Model.TheValue) %>
<input type="submit" value="Save" />
<% } %> 
```

另外，我不确定“RunTime”类型是什么样的，所以我做了这个：

```
 public class RunTime {
        public static readonly RunTime Default = new RunTime(-1);

        public RunTime() {
        }

        public RunTime(int theValue) {
            TheValue = theValue;
        }

        public int TheValue {
            get;
            set;
        }
    } 
```

您的 RunTime 实现是否可能包含一些静态值或其他内容？

谢谢，

艾隆

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T17:59:09.163

我不确定这是否相关，但是您对 <%= Html.TextBox("newRunTime.Time", ViewData.Model.Time) %> 的调用实际上可能选择了错误的重载（因为 Time 是一个整数，它将选择`object htmlAttributes`重载，而不是`string value`.

检查呈现的 HTML 会让您知道这是否正在发生。将 int 更改为`ViewData.Model.Time.ToString()`将强制正确的过载。

听起来您的问题有所不同，但我注意到了这一点，并且过去曾被烧毁。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T12:05:24.097

Seb，我不确定你的例子是什么意思。我对 Unity 配置一无所知。我将解释 Castle.Windsor 的情况，也许这会帮助您正确配置 Unity。

默认情况下，每次请求给定类型时，Castle.Windsor 都会返回相同的对象。这就是单身的生活方式。[Castle.Windsor 文档](http://www.castleproject.org/container/documentation/trunk/usersguide/lifestyles.html)中对各种生活方式选项进行了很好的解释。

在 ASP.NET MVC 中，控制器类的每个实例都绑定到创建它以提供服务的 Web 请求的上下文。因此，如果您的 IoC 容器每次都返回您的控制器类的相同实例，您将始终获得一个绑定到使用该控制器类的第一个 Web 请求的上下文的控制器。特别是，the`ModelState`和其他使用的对象`DefaultModelBinder`将被重用，因此您绑定的模型对象和 中的验证消息`ModelState`将是陈旧的。

因此，每次 MVC 请求控制器类的实例时，您都需要 IoC 返回一个新实例。

在 Castle.Windsor 中，这被称为短暂的生活方式。要配置它，您有两个选择：

1.  XML 配置：将 lifestlye="transient" 添加到配置文件中代表控制器的每个元素。
2.  代码内配置：您可以在注册控制器时告诉容器使用瞬态生活方式。这就是 Ben 提到的 MvcContrib 助手会自动为您做的事情 - 看看[MvcContrib 源代码](http://code.google.com/p/mvccontrib/source/browse/trunk/src/MvcContrib.Castle/WindsorExtensions.cs)中的 RegisterControllers 方法。

我想 Unity 提供了与 Castle.Windsor 中的生活方式类似的概念，因此您需要配置 Unity 以将其等效于短暂的生活方式用于您的控制器。MvcContrib 似乎有一些[Unity 支持](http://code.google.com/p/mvccontrib/source/browse/trunk/src/?r=510#src/MvcContrib.Unity)——也许你可以看看那里。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-03T09:14:19.997

在尝试在 ASP.NET MVC 应用程序中使用 Windsor IoC 容器时遇到了类似的问题，我必须经历同样的发现之旅才能使其正常工作。以下是一些可能对其他人有所帮助的细节。

使用这是 Global.asax 中的初始设置：

```
 if (_container == null) 
  {
    _container = new WindsorContainer("config/castle.config");
    ControllerBuilder.Current.SetControllerFactory(new WindsorControllerFactory(Container)); 
  } 
```

并使用 WindsorControllerFactory ，当被要求提供控制器实例时：

```
 return (IController)_container.Resolve(controllerType); 
```

虽然 Windsor 正确连接了所有控制器，但由于某种原因，参数没有从表单传递到相关的控制器操作。相反，它们都是空的，尽管它正在调用正确的操作。

默认是让容器传回单例，这对控制器来说显然是一件坏事以及问题的原因：

[http://www.castleproject.org/monorail/documentation/trunk/integration/windsor.html](http://www.castleproject.org/monorail/documentation/trunk/integration/windsor.html)

但是文档确实指出控制器的生活方式可以更改为瞬态，尽管如果您使用配置文件，它实际上并没有告诉您如何做到这一点。事实证明这很容易：

```
<component 
  id="home.controller" 
  type="DoYourStuff.Controllers.HomeController, DoYourStuff" 
  lifestyle="transient" /> 
```

并且无需任何代码更改，它现在应该可以按预期工作（即，每次都由容器的一个实例提供唯一的控制器）。然后，您可以在配置文件中进行所有 IoC 配置，而不是像我认识的好男孩/女孩那样的代码。

# c++ - 静态或动态链接 CRT、MFC、ATL 等

> ID：238465
> 
> 赞同：22
> 
> 时间：2008-10-26T19:06:22.773
> 
> 标签：c++, mfc, linker

回到 90 年代，当我第一次开始使用 MFC 时，我曾经动态链接我的应用程序并发布相关的 MFC DLL。这给我带来了一些问题（DLL 地狱！），我改用静态链接 - 不仅适用于 MFC，还适用于 CRT 和 ATL。除了较大的 EXE 文件之外，静态链接从来没有给我带来任何问题——那么其他人遇到过任何缺点吗？是否有充分的理由再次访问动态链接？我的应用程序现在主要是 STL/Boost FWIW。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-16T16:18:59.603

我听到的大多数答案都涉及与其他程序共享您的 dll，或者在无需修补软件的情况下更新这些 dll。

坦率地说，我认为这些是缺点，而不是优点。当第三方 dll 更新时，它的变化足以破坏您的软件。现在，硬盘空间不再像以前那么宝贵了，您的可执行文件中多了 500k？谁在乎？

*   100% 确定您的软件使用的 dll 版本是一件好事。
*   100% 确定客户不会有依赖问题是一件好事。

在我看来，好处远远大于坏处

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-27T02:12:52.850

有一些缺点：

*   更大的 exe 大小（尤其是如果您发送多个 exe）
*   使用依赖或假设动态链接的其他 DLL 的问题（例如：您无法作为静态库获得的第 3 方 DLL）
*   具有独立静态链接的 DLL 之间的不同 c 运行时（无跨模块分配/释放）
*   没有共享组件的自动服务（没有能力让第 3 方模块供应商更新他们的代码来解决问题，而无需重新编译和更新您的应用程序）

我们为我们的 Windows 应用程序进行静态链接，主要是因为它允许 xcopy 部署，这只是通过安装或依赖 SxS DLL 的方式是不可能的，因为该过程和机制没有很好的文档记录或容易远程处理。如果您在安装目录中使用本地 DLL，它会起作用，但它没有得到很好的支持。无法在不通过远程系统上的 MSI 的情况下轻松进行远程安装是我们不使用动态链接的主要原因，但是（正如您所指出的）静态链接还有许多其他好处。各有利弊；希望这有助于枚举它们。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T19:48:42.267

只要您将使用限制在某些库并且不使用任何 dll，那么您应该很好。

不幸的是，有些库不能静态链接。我拥有的最好的例子是 OpenMP。如果您利用 Visual Studio 的 OpenMP 支持，则必须确保已安装运行时（在本例中为 vcomp.dll）。

如果你确实使用了 dll，那么你不能在没有一些严肃的体操的情况下来回传递一些项目。想到 std::strings 。如果您的 exe 和 dll 是动态链接的，则分配发生在 CRT 中。否则，您的程序可能会尝试在一侧分配字符串并在另一侧取消分配。坏事接踵而至……

也就是说，我仍然静态链接我的 exe 和 dll。它确实减少了安装中的很多变量，我认为这非常值得一些限制。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-26T19:59:49.013

使用 dll 的一个优点是，如果多个进程加载相同的 dll，则可以在它们之间共享其代码。这可以节省内存并缩短应用程序加载已被另一个程序使用的 dll 的加载时间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-26T19:13:01.247

不，这方面没有什么新鲜事。保持这种方式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-26T19:32:25.950

明确地。

分配是在“静态”堆上完成的。由于分配和解除分配应该在同一个堆上完成，这意味着如果你发布一个库，你应该注意客户端代码不能调用“你的”`p = new LibClass()`并使用删除该对象本身`delete p;`。

我的结论：要么屏蔽客户端代码的分配和释放，要么动态链接 CRT。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-02-26T17:02:39.227

有一些软件许可证（例如 LGPL）要求您使用 DLL 或将您的应用程序分发为用户可以链接在一起的目标文件。如果您正在使用这样的库，您可能希望将其用作 DLL。

# .net - DataGridView 组合框

> ID：238466
> 
> 赞同：1
> 
> 时间：2008-10-26T19:07:04.037
> 
> 标签：.net, vb.net, winforms, datagridview

如何访问 DataGridView 中特定行中组合框的项目集合？

我正在按如下方式填充组合：

```
 Dim VATCombo As New DataGridViewComboBoxColumn
            With VATCombo
                .HeaderText = "VAT Rate"
                .Name = .HeaderText
                Dim VATCol As New JCVATRateCollection

                VATCol.LoadAll(EntitySpaces.Interfaces.esSqlAccessType.StoredProcedure)
                For Each Rate As JCVATRate In VATCol
                    .Items.Add(Rate.str.VATRate)
                Next
                .Sorted = True

                VATCol = Nothing

                .ToolTipText = "Select VAT Rate"
                .AutoSizeMode = DataGridViewAutoSizeColumnMode.DisplayedCells
                .CellTemplate.Style.BackColor = Color.Honeydew
                .DisplayIndex = 8
                .AutoSizeMode = DataGridViewAutoSizeColumnMode.Fill

            End With
            .Columns.Add(VATCombo)
            VATCombo = Nothing 
```

我希望能够为添加到网格的每个新行设置一个默认值，我还希望能够根据其他业务逻辑更改组合中的值。我意识到我可以直接设置单元格值，但我想避免将值硬编码到系统中并依赖数据库来填充。

我敢肯定它一定是直截了当的，但它让我望而却步......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-01T19:27:57.730

EditGridView 中基本组合框的问题是所有行共享同一个组合框，因此您无法更改它。

您要创建一个继承自 ComboBox 并实现 IDataGridViewEditingControl 的新类 (ComboEditingControl)：

（例如customdropdown.vb :)

```
Imports System.Collections.Generic
Imports System.Drawing
Imports System.Windows.Forms

Friend Class ComboEditingControl
Inherits ComboBox
Implements IDataGridViewEditingControl

Private dataGridViewControl As DataGridView
Private valueIsChanged As Boolean = False
Private rowIndexNum As Integer
Private ItemSelected As String

Public Sub New()
    Me.DropDownStyle = ComboBoxStyle.DropDownList
End Sub

Public Property EditingControlFormattedValue() As Object _
    Implements IDataGridViewEditingControl.EditingControlFormattedValue

    Get
        Return ItemSelected
    End Get

    Set(ByVal value As Object)
        If TypeOf value Is Decimal Then
            Me.SelectedItem = value.ToString()
        End If
    End Set
End Property

Public Function GetEditingControlFormattedValue(ByVal context As DataGridViewDataErrorContexts) As Object _
    Implements IDataGridViewEditingControl.GetEditingControlFormattedValue
    Return ItemSelected
End Function

Public ReadOnly Property EditingControlCursor() As Cursor _
    Implements IDataGridViewEditingControl.EditingPanelCursor
    Get
        Return MyBase.Cursor
    End Get
End Property

Public Sub ApplyCellStyleToEditingControl(ByVal dataGridViewCellStyle As DataGridViewCellStyle) _
    Implements IDataGridViewEditingControl.ApplyCellStyleToEditingControl

    Me.Font = dataGridViewCellStyle.Font
    Me.ForeColor = dataGridViewCellStyle.ForeColor
    Me.BackColor = dataGridViewCellStyle.BackColor

End Sub

Public Property EditingControlRowIndex() As Integer _
    Implements IDataGridViewEditingControl.EditingControlRowIndex

    Get
        Return rowIndexNum
    End Get
    Set(ByVal value As Integer)
        rowIndexNum = value
    End Set

End Property

Public Function EditingControlWantsInputKey(ByVal key As Keys, ByVal dataGridViewWantsInputKey As Boolean) As Boolean _
    Implements IDataGridViewEditingControl.EditingControlWantsInputKey

    ' Let the DateTimePicker handle the keys listed.
    Select Case key And Keys.KeyCode
        Case Keys.Up, Keys.Down, Keys.Home, Keys.End, Keys.PageDown, Keys.PageUp
            Return True
        Case Else
            Return False
    End Select
End Function

Public Sub PrepareEditingControlForEdit(ByVal selectAll As Boolean) _
    Implements IDataGridViewEditingControl.PrepareEditingControlForEdit
    ' No preparation needs to be done.
End Sub

Public ReadOnly Property RepositionEditingControlOnValueChange() As Boolean Implements _
    IDataGridViewEditingControl.RepositionEditingControlOnValueChange
    Get
        Return False
    End Get
End Property

Public Property EditingControlDataGridView() As DataGridView _
    Implements IDataGridViewEditingControl.EditingControlDataGridView

    Get
        Return dataGridViewControl
    End Get
    Set(ByVal value As DataGridView)
        dataGridViewControl = value
    End Set

End Property

Public Property EditingControlValueChanged() As Boolean _
    Implements IDataGridViewEditingControl.EditingControlValueChanged

    Get
        Return valueIsChanged
    End Get
    Set(ByVal value As Boolean)
        valueIsChanged = value
    End Set
End Property

''' <summary>
''' Notify the DataGridView that the contents of the cell have changed.
''' </summary>
''' <param name="eventargs"></param>
''' <remarks></remarks>
Protected Overrides Sub OnSelectedIndexChanged(ByVal eventargs As EventArgs)
    valueIsChanged = True
    dataGridViewControl.NotifyCurrentCellDirty(True)
    MyBase.OnSelectedItemChanged(eventargs)
    ItemSelected = SelectedItem.ToString()
End Sub
End Class 
```

* * *

还有 2 个类，请注意 InitializeEditingControl 您需要为您所在的特定行构建项目

```
Friend Class ComboColumn
    Inherits DataGridViewColumn

    Public Sub New()
        MyBase.New(New ComboCell())
    End Sub

    Public Overrides Property CellTemplate() As DataGridViewCell
        Get
            Return MyBase.CellTemplate
        End Get
        Set(ByVal value As DataGridViewCell)
            ' Ensure that the cell used for the template is a ComboCell.
            If Not (value Is Nothing) AndAlso Not value.GetType().IsAssignableFrom(GetType(ComboCell)) Then
                Throw New InvalidCastException("Must be a ComboCell")
            End If
            MyBase.CellTemplate = value
        End Set
    End Property
End Class

Friend Class ComboCell
    Inherits DataGridViewTextBoxCell

    Public Sub New()
    End Sub

    Public Overrides Sub InitializeEditingControl(ByVal rowIndex As Integer, ByVal initialFormattedValue As Object, ByVal dataGridViewCellStyle As DataGridViewCellStyle)
        ' Set the value of the editing control to the current cell value.
        MyBase.InitializeEditingControl(rowIndex, initialFormattedValue, dataGridViewCellStyle)

        Dim ctl As ComboEditingControl = CType(DataGridView.EditingControl, ComboEditingControl)

        Dim GetValueFromRowToUseForBuildingCombo As String = Me.DataGridView.Rows(rowIndex).Cells(0).Value.ToString()

        ctl.Items.Clear()
        For Each thing As String In ACollection
            ctl.Items.Add(Sheet)
        Next

        If Me.Value Is Nothing Then
            ctl.SelectedIndex = -1
        Else
            ctl.SelectedItem = Me.Value
        End If
    End Sub

    Public Overrides ReadOnly Property EditType() As Type
        Get
            Return GetType(ComboEditingControl)
        End Get
    End Property

    Public Overrides ReadOnly Property ValueType() As Type
        Get
            Return GetType(String)
        End Get
    End Property

    Public Overrides ReadOnly Property FormattedValueType() As System.Type
        Get
            Return GetType(String)
        End Get
    End Property

    Public Overrides ReadOnly Property DefaultNewRowValue() As Object
        Get
            Return ""
        End Get
    End Property
End Class 
```

最后在表单的 OnLoad 代码中，以编程方式将控件添加到 Grid：

```
Dim c As New ComboColumn
c.HeaderText = "Sheet"
c.DataPropertyName = "My Combo"
c.ToolTipText = "Select something from my combo"
MyDataGridView.Columns.Add(c) 
```

要获取和设置，只需使用`ThisRow.Cells(ComboCol).Value`

第一个字段是通用的，另一个继承并具有您需要的每个 DataGridView 的自定义代码

高温高压

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T16:14:07.393

您不能使用行索引直接在单元格内转换控件来访问当前行吗？

# iphone - iPhone SDK：使用按钮点击从一个视图前进到另一个视图

> ID：238473
> 
> 赞同：3
> 
> 时间：2008-10-26T19:13:34.053
> 
> 标签：iphone, cocoa-touch

我想制作一个非常简单的 iphone 应用程序：一个带有单个按钮的屏幕......当点击按钮时，会出现一个新屏幕。就是这样。没有动画，什么都没有，

我已经无休止地尝试让 NavBar 示例项目做到这一点......它可以工作，但前提是我使用 UINavigationController 和我可以点击的表格等。我也尝试过 XCode 中的所有骨架项目。

当我这样做时，我以为我已经完成了：

```
[[self navigationController] presentModalViewController:myViewController animated:YES]; 
```

但如果没有 UINavigationController，我就无法做到这一点。我只想要一个简单的例子。

非常感谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-26T19:18:16.370

您可以这样做的一种方法是创建一个新的 UIView，然后在按下按钮时将该新的 UIVIew 添加为子视图，从而使其成为您所看到的。

如果你让新视图成为它自己的 UIView 子类，你会做这样的事情。

```
LoginView *login = [[LoginView alloc] initWithFrame: rect];
[mainView addSubview: login]; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-18T05:24:20.640

```
[self presentModalViewController:myViewController animated:NO]; 
```

将弹出一个新视图，没有动画，什么都没有。为了摆脱它，在 myViewController 中：

```
[self dismissModalViewControllerAnimated:NO]; 
```

虽然我建议您使用漂亮的滑动动画（将 NO 更改为 YES。）是的，您可以将它们堆叠起来。我认为这比创建一个新的 UIView 更好，但我可能错了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T23:34:42.327

正确的方法是使用`UINavigationController`. 在您的根视图控制器中，将您的按钮添加到视图控制器的视图中。然后在 中，从您的按钮`viewDidLoad`注册事件。`UIControlEventTouchUpInside`然后，在您的事件回调中，调用：

```
[self.navigationController pushViewController:[[[SecondViewControllerClass alloc] initWithNib:nibName bundle:nil] autorelease]]; 
```

kdbdallas 的建议会起作用，但您不会获得漂亮的滑动效果，导航栏也不会自动更改并为您的用户提供后退按钮。

# c# - 在 Oracle 存储过程上调用 OracleDataAdapter.Update() 时如何配置 C# 类型数据集？

> ID：238488
> 
> 赞同：1
> 
> 时间：2008-10-26T19:28:11.497
> 
> 标签：c#, oracle, stored-procedures

我正在编写一个调用 Oracle 存储过程的 C# Windows 窗体应用程序。

我选择在应用程序中使用类型化数据集，这些数据集可以正确填充各种数据网格，但是在调用 UpdateCommand 或 InsertCommand 时遇到了问题。我已经手动编写了这些命令，因为 a) 我使用的是 Oracle 存储过程，并且 b) 我不信任 CommandBuilder ;)

我正在使用 VS2008 和 Oracle 9i

简单地从 .ExecuteNonQuery 命令调用它们时，我在 SQL Server 或 Oracle 中执行存储过程没有问题；我也没有直接执行 SQL 语句和更新数据库的问题。只有在使用 OracleDataAdapter.Update() 执行更改的行时才会出现问题。我正在指定正确的行集（添加、更改等）

我得到的主要错误（经过大量实验，越来越简单的 SP 只用一个 int 参数完成）是“PLS-00306：调用'PROCNAME'时参数的数量或类型错误”

我尝试在 Oracle 参数前面加上 ':' 和不加前缀。

可以说我正在失去生存的意愿。有没有更多的想法我可以尝试下一个？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T20:30:37.703

您使用的是 Oracle 的 ODBC 驱动程序，还是 Microsoft？

坚持使用 Oracle 驱动程序。

尝试使用带有文本参数而不是整数的简单测试用例。在没有看到您的代码的情况下，您可能需要将一个 long int 传递给该过程。尝试一个简单的文本参数可以验证问题出在变量类型上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T21:13:42.390

感谢您的回复，它是 Oracle 9.02.0.0 驱动程序，SQORA32.DLL。对于我所做的一切，它一直都很好用……猜你已经在我心中埋下了怀疑的种子！

# asp.net-mvc - 由 linq 查询引起的 StackOverflowException

> ID：238490
> 
> 赞同：3
> 
> 时间：2008-10-26T19:30:02.740
> 
> 标签：asp.net-mvc, linq, stack-overflow

**编辑＃2：**问题解决了一半。往下看

作为一个后续问题，有没有人知道一种非侵入性的方法来解决我在下面尝试做的事情（即，在不触发无限循环的情况下将对象相互链接）？

* * *

我尝试创建一个 asp.net-mvc web 应用程序，并得到一个 StackOverFlowException。控制器触发以下命令：

```
 public ActionResult ShowCountry(int id)
    {
        Country country = _gameService.GetCountry(id);
        return View(country);
    } 
```

GameService 像这样处理它（WithCountryId 是一个扩展）：

```
 public Country GetCountry(int id)
    {
        return _gameRepository.GetCountries().WithCountryId(id).SingleOrDefault();
    } 
```

GameRepository 像这样处理它：

```
 public IQueryable<Country> GetCountries()
    {
        var countries =  from c in _db.Countries
               select new Country
               {
                   Id = c.Id,
                   Name = c.Name,
                   ShortDescription = c.ShortDescription,
                   FlagImage = c.FlagImage,
                   Game = GetGames().Where(g => g.Id == c.GameId).SingleOrDefault(),
                   SubRegion = GetSubRegions().Where(sr => sr.Id == c.SubRegionId).SingleOrDefault(),
               };
        return countries;
    } 
```

GetGames() 方法导致 StackOverflowException：

```
 public IQueryable<Game> GetGames()
    {
        var games = from g in _db.Games                   
               select new Game
               {
                   Id = g.Id,
                   Name = g.Name

               };
        return games;

    } 
```

我的业务对象与 linq2sql 类不同，这就是我用 select new 填充它们的原因。

mscorlib.dll 中出现“System.StackOverflowException”类型的未处理异常

* * *

**编辑＃1：**我找到了罪魁祸首，它是以下方法，它触发了 GetCountries() 方法，该方法反过来又触发了 GetSubRegions() ，令人作呕：

```
 public IQueryable<SubRegion> GetSubRegions()
    {
        return from sr in _db.SubRegions
               select new SubRegion
               {
                   Id = sr.Id,
                   Name = sr.Name,
                   ShortDescription = sr.ShortDescription,
                   Game = GetGames().Where(g => g.Id == sr.GameId).SingleOrDefault(),
                   Region = GetRegions().Where(r => r.Id == sr.RegionId).SingleOrDefault(),
                   Countries = new LazyList<Country>(GetCountries().Where(c => c.SubRegion.Id == sr.Id))
               };
    } 
```

可能必须在这里考虑其他事情:) 当您因为咖啡太多而以 OO 思维方式思考时会发生这种情况

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T19:45:02.150

嗨！我认为您的模型无意中递归地调用了一个方法，这导致了堆栈溢出。例如，您的 Subregion 对象正在尝试获取 Country 对象，而 Country 对象又必须获取 Subregions。

无论如何，在 StackOverflow 异常中检查堆栈总是有帮助的。如果您看到一个属性被反复访问，很可能是因为您正在执行以下操作：

公共对象 MyProperty { 设置 { MyProperty = 值；}}

更容易发现像您这样的情况，其中方法 A 调用方法 B，而 B 又调用方法 A，因为您可以看到相同的方法在调用堆栈中出现两次或更多次。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T19:53:27.733

问题可能是这样的：国家有次区域，次区域有国家。我不知道你是如何实现惰性列表的，但这可能会继续调用 GetCountries，然后调用 GetSubRegions 等等。为了找出答案，我将启动调试器并在 GetCountries 和 GetSubRegions 方法标头上设置断点。

我用 LinqToSql 尝试了类似的模式，但是很难在不影响性能的情况下进行双向导航。这就是我现在使用 NHibernate 的原因之一。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T19:54:00.633

要回答您编辑的问题，即：“在不触发无限循环的情况下将对象相互链接”：

假设您有某种关系，双方都需要了解对方...掌握双方的所有相关实体，然后将它们链接在一起，而不是试图让一方的获取自动获取其他。或者只是让*一侧*取另一侧，然后修复剩余的一侧。因此，在您的情况下，选项将是：

选项1：

*   获取所有国家/地区（将子区域留空）
*   获取所有子区域（将国家留空）
*   对于每个次区域，查看国家列表并将次区域添加到国家，将国家添加到次区域

选项 2：

*   获取所有国家/地区（将子区域留空）
*   获取所有子区域，通过上面获取的国家列表设置 Subregion.Countries
*   对于每个次区域，遍历其所有国家并将其添加到该国家

（或反向国家和次区域）

它们基本上是等效的答案，只是在您进行一些链接时会发生变化。

# c# - 如何在一段时间内限制对 WCF 服务的调用？

> ID：238498
> 
> 赞同：2
> 
> 时间：2008-10-26T19:39:42.083
> 
> 标签：c#, wcf, enforcement

我想编写一个每小时运行次数不能超过 X 次的 WCF 服务。如果在过去 60 分钟内调用服务超过 x 次，我希望该服务将消息挂起到队列中。

任何想法如何限制服务？我愿意在 WCF 堆栈中编写自定义组件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T20:38:48.530

使用数据库、XML 文件或其他一些数据存储，记录每次调用服务的日期和时间，以及它是否有效。每次调用服务时：

1.  检查数据存储中在过去 60 分钟内有效的记录数。
2.  如果小于 X，做工作，记录你做了什么，什么时候做的。
3.  如果超过 x 次将请求移动到队列中，则记录该请求。

您还需要检查要完成的工作队列（Windows 服务？），并确定队列中完成的工作是否计入每小时 X 次。

这都是非常高级的，因为我们对您的项目 HTH 一无所知。

# .net - Linq to Sql - 在不使用 DataLoadOptions 的情况下加载子实体？

> ID：238504
> 
> 赞同：6
> 
> 时间：2008-10-26T19:43:38.767
> 
> 标签：.net, linq, linq-to-sql

是否可以在不使用 DataLoadOptions的情况下在***单个***查询中加载子实体？

我在 asp.net Web 应用程序中为每个请求使用一个数据上下文，并试图绕过 linq to sql 限制，即一旦执行查询就无法更改 dataloadoptions。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T20:51:39.643

如果您不介意指向数据上下文的链接，正如您所说的那样，您可以编写一个存储过程来返回映射到您的对象的多个结果。[在此处阅读更多相关信息](http://blogs.microsoft.co.il/blogs/bursteg/archive/2007/10/05/linq-to-sql-stored-procedures-with-multiple-results-imultipleresults.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T00:38:29.763

我找到了以下 vb.net 示例，它从 IMultipleResults 类型手动填充子实体：

```
 Public Function GetSubjectsWithBooks() As List(Of Subject)
        Dim results As IMultipleResults = Me.GetSubjectAndBooks
        Dim Subjects = results.GetResult(Of Subject).ToList
        Dim Books = results.GetResult(Of Book).ToList
        For Each s In Subjects
            Dim thisId As Guid = s.ID
            s.FetchedBooks = (From b In Books Where b.SubjectId = thisId).ToList
        Next
        Return Subjects
    End Function 
```

这取自 Jim Wooley（Link in Action 作者之一）编写的示例项目，可在以下位置找到：[http ://www.thinqlinq.com/Downloads/LinqToSqlBeyondTheBasics.zip](http://www.thinqlinq.com/Downloads/LinqToSqlBeyondTheBasics.zip)

奥马尔，这就是你所说的技术吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T01:06:32.013

[Rob Conery 的博客](http://blog.wekeroad.com/)有一种方法可以使用他拥有的帮助类，`LazyList<T>`. 他还使用自定义对象来避免加入匿名类型问题。我已经成功地使用它从没有 DataLoadOptions 的 sql 中获取父子关系。

我认为他在 MVC Storefront 视频的 Pt2 或 Pt3 中介绍了它：

[http://www.asp.net/learn/mvc-videos/video-351.aspx](http://www.asp.net/learn/mvc-videos/video-352.aspx)

[http://www.asp.net/learn/mvc-videos/video-352.aspx](http://www.asp.net/learn/mvc-videos/video-352.aspx)

这假设您有 POCO 称为 Category （不是 linq 实体）和一个 LazyList 类：

```
var categories = (from c in _db.Categories
                  select new Category
                  {
                  CategoryID = c.CategoryID,
                  CategoryName = c.CategoryName,
                  ParentCategoryID = c.ParentCategoryID,
                  SubCategories = new LazyList<Category>(
                       from sc in _db.Categories
                       where sc.ParentCategoryID == c.CategoryID
                       select new Category
                       {
                            CategoryID = sc.CategoryID,
                            CategoryName = sc.CategoryName,
                            ParentCategoryID = sc.ParentCategoryID
                        })
                    }); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T20:02:39.040

子实体将在您第一次访问它们时被加载，因此您可以通过访问它们来强制 Linq to Sql 加载它们...... :-) 但我认为这不是您的想法。

你的情况如何？您是否将子实体与父实体存储在同一个表中，并希望使用一个查询来获取所有子实体？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T22:00:00.427

加盟呢？例如：

```
from a in Albums join  o in Users on a.Owner equals o select new {a, o} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T23:01:25.623

如果您的集合是*EntitySet*，那么您可以通过 .Load() 方法加载它：

```
Person p = ctx.Persons.First();
p.Addresses.Load(); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-06T13:59:09.373

使用包括...

var q = from u in context.Users.Include("address")...

也会导致地址子对象被填充。

# asp.net-mvc - 作为一个团队开发 asp.net mvc 应用程序？

> ID：238505
> 
> 赞同：2
> 
> 时间：2008-10-26T19:44:13.743
> 
> 标签：asp.net-mvc, methodology

不知道有没有讨论过这个。

假设您在一个三人开发团队中。你会如何分享：

*   模型 - 视图 - 控制器
*   由控制器
*   按用例
*   别的东西？

也许有人说这与 asp.net mvc 无关，但我认为它会以某种方式影响。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T10:19:15.083

按故事去做。但到目前为止，最好的方法是让 2 位开发人员处理同一个故事。在整个架构中协同工作。他们可以根据需要共享任务，创建视图或模型或存储的过程和表格等。会有一些踩脚，但在那些时候他们可以配对程序。试着想象“团队”在做一个故事。而不是一个开发人员，如果他们都同时处理同一个故事，开发应该以极快的速度进行。正如 Kieron 所说，您需要与整个团队进行十分钟的设计会议，以决定如何将其结合在一起。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T10:09:42.590

我们像这样分解它：

A组：

*   意见
*   CSS
*   JavaScript

B组：

*   控制器
*   楷模
*   数据库

我们使用思维导图应用程序来确定我们首先需要哪些控制器和视图，因此整个团队都知道如何将它们联系在一起。

它对我们非常有效，大大提高了我们的生产力。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T19:47:06.590

按用例或任务。帮助传播有关整个过程的知识。

# c++ - 在 Visual Studio 2005 c++ 多线程程序中跟踪函数的进入和退出的快速方法是什么？

> ID：238517
> 
> 赞同：3
> 
> 时间：2008-10-26T19:52:37.033
> 
> 标签：c++, visual-studio-2005, trace, activemq, visual-c++-2005

由于我使用 activemq-cpp API 的方式，我的 ActiveMQ 库中发生间歇性崩溃。如果我能观察到导致崩溃的每个函数都被调用，那么调试问题会容易得多。是否有任何快速方法可以跟踪 Visual Studio 2005 c++ 多线程程序中函数的进入和退出？

提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T19:54:25.780

使用 Tracer 对象。像这样的东西：

```
 class Tracer
{
public:
  Tracer(const char *functionName) : functionName_(functionName)
  {
    cout << "Entering function " << functionName_ << endl;
  }

  ~Tracer()
  {
    cout << "Exiting function " << functionName_ << endl;
  }

  const char *functionName_;
}; 
```

现在您可以简单地在函数顶部实例化一个 Tracer 对象，当函数退出并调用析构函数时，它将自动打印“exiting...”：

```
 void foo()
{
  Tracer t("foo");
   ...
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T20:04:42.280

当调试器附加到进程时，您可以右键单击源代码并选择“breakpoint->add TracePoint”，并带有您想要的文本（甚至提供了一些宏）。

Tracepoint 实际上是在某些消息打印机功能上带有“When Hit”字段的 BreakPoint，它实际上并没有中断进程。我发现它非常有用：它还有一个宏 $FUNCTION，它完全可以满足您的需要：打印它所在的函数（前提是它具有可用的调试信息...）和一个 $THREADID。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T20:53:18.737

以上所有选项都很好，可以为您提供帮助。但是我看不出用鼠标设置 TracePoing 可以如何帮助你，以防你的代码有数千个函数。
这种事情应该是你常规编程工作的一部分。当您编写一个函数时，您应该考虑什么跟踪消息将帮助您调试它。
您需要编写/使用现有的记录器，这些记录器可以分配到部分（阅读器线程、工作线程等）和不同的日志记录级别（错误、警告、跟踪、详细等。）。好的记录器应该以不损害性能的方式设计，这通常会损害冗长，但是通常可以重现复杂的同步问题，除非记录非常快，例如将字符串指针分配给可以在出现问题后转储的数组被复制。我通常开始调试时将完整的跟踪信息转储到屏幕上，如果我很幸运并且以这种方式重现了错误，那么修复错误是微不足道的，因为我已经有足够的信息，当问题消失时，乐趣就开始了，你需要用冗长的方式来玩重现问题。
实际上，我发现调试比编写代码更有创意和令人满意，但这只是我:)。

# java - 当 javadoc-comments 中遗漏了某些内容时，是否可以从 javadoc 获得警告？

> ID：238519
> 
> 赞同：6
> 
> 时间：2008-10-26T19:53:28.233
> 
> 标签：java, documentation, javadoc

在记录方法或类等时，我可能会意外地忘记描述一些参数或异常抛出（或其他东西）。

是否可以以警告我缺少文档项的方式运行 javadoc？

（我使用 ant 脚本生成文档）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-26T20:02:46.717

我不知道有任何 javadoc 选项会发出有关未记录项目的警告。

但是，如果您碰巧使用 Eclipse，请查看中的设置

窗口 -> 首选项 -> Java -> 编译器 -> Javadoc

在那里，您可以告诉 Eclipse 对未记录的项目发出警告。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T02:44:51.910

我们在早期的项目中使用了[Doc Check Doclet 。](http://java.sun.com/j2se/javadoc/doccheck/)它可以与构建集成并生成有用的报告，告诉您哪些代码的文档很差。

注意：该工具是测试版，Sun 不再支持。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T10:39:57.630

使用[检查样式](http://checkstyle.sourceforge.net/)！它具有很棒的 Ant 集成，并且还支持对您的源代码进行 100 多项其他重要检查。

JavadocType[检查器](http://checkstyle.sourceforge.net/config_javadoc.html)是您所需要的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T20:04:37.897

是的，在 Eclipse 中，您可以检查您定义的所有内容，因此可以将这个缺失放入“警告”中，然后您将能够看到您在哪里犯了错误。

# c++ - Python 和 pygame 是学习 SDL 的好方法吗？

> ID：238523
> 
> 赞同：18
> 
> 时间：2008-10-26T19:54:47.357
> 
> 标签：c++, python, sdl, pygame

如果我将来想转向 C++ 和 SDL，Python 和 pygame 是不是学习 SDL 的好方法？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-11T01:29:49.687

Python+PyGame 是学习 SDL 的好主意。

我就是这样写了一个[有点流行的游戏](http://taw.github.io/jrpg)。Python/PyGame 似乎比 SDL 绑定到任何其他语言要先进得多，与 C++ 相比的一个巨大优势是不必编译代码，并且通过一些简单的黑客攻击甚至可以修改正在运行的程序，并实时查看反馈。它产生了巨大的差异 - 就像使用 GUI 矢量图形程序与在文本编辑器中编写 SVG 一样。不幸的是，您并没有开箱即用，因为您需要稍微调整您的程序才能看到它。

至于 PyGame 的其他优点，jrpg 在 Linux、Windows 和 OSX 上运行的变化非常小。我不得不对全屏模式切换和双缓冲进行一些调整，因为操作系统之间存在一些差异，但不需要重新编译。如果您有任何问题，您可以获得良好的堆栈跟踪并实时调试您的问题，一旦您遇到内存损坏或段错误，这对于 C++ 来说是不可能的。

我真的不知道为您的 SDL 游戏混合 C++ 和 Python 有多容易或多难。我认为这不会太难，因为 PyGame 是一个非常简单但制作精良的 SDL 包装器，并且 Python/C++ 混合应该很容易。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-26T21:28:02.720

pygame 对 SDL 接口进行了相当多的抽象，因此我认为没有太多优势。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-26T21:37:15.510

您可以在基于 SDL 的环境中学习一些技术、实现游戏逻辑的方法等，但是在迁移到 C++/SDL 之后，您将不得不直接使用 SDL 函数，pyGame 中的辅助函数/对象将完全无用。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-27T05:45:11.640

**是**的。如果 python 对您来说比 C++ 更自然，那么首先学习 pygame 可能是个好主意。迁移到使用 SDL 和 C 时，您必须经历一个转换过程，但它应该是或多或少的一对一映射。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-27T09:57:48.387

当然。您可以在更短的时间内编写 sdl 游戏或工具。

您可以从将 data/chimp.bmp 显示为 468x60 屏幕的代码开始：

```
import pygame, sys,os
from pygame.locals import * 

pygame.init() 

window = pygame.display.set_mode((468, 60)) 
pygame.display.set_caption('Monkey Fever') 
screen = pygame.display.get_surface() 

monkey_head_file_name = os.path.join("data","chimp.bmp")

monkey_surface = pygame.image.load(monkey_head_file_name)

screen.blit(monkey_surface, (0,0)) 
pygame.display.flip() 

def input(events): 
   for event in events: 
      if event.type == QUIT: 
         sys.exit(0) 
      else: 
         print event 

while True: 
   input(pygame.event.get()) 
```

当您熟悉 SDL 对象时，您可以轻松迁移到 C++（如果您想再次使用：p Pygame 速度很快，您可以用它制作复杂的游戏）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-12-16T18:42:43.173

出于您的目的[，PySDL2](http://pysdl2.readthedocs.org/en/latest/)比 pygame 更好。它几乎直接导入 SDL2 API。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-09T01:07:21.460

python 不会阻止你学习*设计*，这对于学习 IMO 来说是更重要的事情，我正在用 pygame 做一个粉碎兄弟克隆，我在设计方面学到了很多东西。然而，你也将学会不要编写太多次优代码，python 也有聪明而漂亮的 hack。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-27T09:43:06.730

如果你的目标是 OpenGL，你可以试试[pyglet 。](http://www.pyglet.org/)它比 pygame 的库要好得多。

但是，如果您将来想迁移到 C++ 和 SDL，现在就去做。这样您就可以真正学习 SDL。但是在做这种不负责任的事情之前，先检查一下[pyglet](http://www.pyglet.org/)可能是个好主意。仅仅因为无论您的库有多糟糕，都可以在 C++ 中正确设计您的应用程序。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-31T22:28:28.163

我不会认为 Python（或任何托管或解释语言，就此而言）是学习任何复杂任务的好方法，因为它使程序员与系统的工作隔离了太多。正如我的一个朋友所说，“Python 爱你，希望你快乐。” 如果您已经了解基础知识，那一切都很好，但是如果您想*学习*，那么您最不想要的就是一种可以为您完成所有工作的语言。

您将很快了解什么，但不是为什么，然后当出现严重错误时（最终会在任何不平凡的项目中），您将不知道发生了什么或为什么。

# java - Macintosh 上缺少 ant-javamail.jar 文件

> ID：238525
> 
> 赞同：4
> 
> 时间：2008-10-26T20:00:05.783
> 
> 标签：java, macos, ant

我一直在 Macintosh (10.5.5) 上从命令行运行内置[Ant ，但在](http://ant.apache.org/)**Mail**任务中遇到了一些问题。运行 Mail 任务会产生以下消息：

```
[mail] Failed to initialise MIME mail: org.apache.tools.ant.taskdefs.email.MimeMailer 
```

这很可能是由于 /usr/share/ant/lib 目录中缺少 ant-javamail.jar 文件。我在这个目录中看到了一个“ant-javamail-1.7.0.pom”文件，但没有看到相应的 jar 文件。任何人都知道为什么这个 jar 文件可能会丢失以及解决问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T14:28:00.300

这是我最终解决问题的方法：

1.  [从http://ant.apache.org/](http://ant.apache.org/)下载了最新版本的 Ant
2.  “内置” Ant 安装在 /usr/share/ant 中；我不想覆盖那个版本，所以我将新的完整版本提取***到***/usr/local/share/apache-ant-1.7.1/
3.  正如[npellow 所](https://stackoverflow.com/users/17333/npellow)指出的，Mac 不包含 mail.jar 或 activation.jar——这些文件可以分别从[JavaMail API](http://java.sun.com/products/javamail/downloads/index.html)和[JavaBeans Activation Framework](http://java.sun.com/products/javabeans/glasgow/jaf.html)下载和提取，然后复制到*新*的ant lib 文件夹（与所有ant-*.jar 文件）
4.  ant 命令 (/usr/bin/ant) 是指向 /usr/share/ant/bin/ant 的符号链接；我更新了此链接以指向新版本 ( `ln -s /usr/local/share/apache-ant-1.7.1/bin/ant /usr/bin/ant`)

如果由于某种原因您需要再次将旧版本的 Ant 设为默认值，只需使用
`ln -s /usr/share/ant/bin/ant /usr/bin/ant`

步骤 2-4 是在命令提示符下以 root 身份完成的。就是这样——Mac 现在拥有最新、*完整*的 Ant 版本，并且 Mail 任务运行良好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T10:30:28.150

从以下网址下载 Java Mail 库：http: [//java.sun.com/products/javamail/](http://java.sun.com/products/javamail/)。您还需要[http://java.sun.com/products/javabeans/glasgow/jaf.html](http://java.sun.com/products/javabeans/glasgow/jaf.html)

此处列出了 Ant 的可选任务所需的所有外部依赖项列表[http://ant.apache.org/manual/index.html](http://ant.apache.org/manual/index.html)。

另一种很容易获得 Ant 依赖项的方法是运行：

```
ant -f fetch all 
```

来自 $ANT_HOME。您还可以运行 -projecthelp 以获得完整的目标列表：

```
all         load all the libraries
 antlr       load antlr libraries
 bcel        load bcel libraries
 beanshell   load beanshell support
 bsf         load bsf libraries
 debugging   internal ant debugging
 get-m2      Download the Maven2 Ant tasks
 jdepend     load jdepend libraries
 jruby       load jruby
 junit       load junit libraries
 jython      load jython
 logging     load logging libraries
 networking  load networking libraries (commons-net; jsch)
 regexp      load regexp libraries
 rhino       load rhino
 script      load script languages
 xerces      load an updated version of Xerces
 xml         load full XML libraries (xalan, resolver) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T18:54:47.423

我也让这个工作方式略有不同：

1.  创建目录`~/.ant/lib`。
2.  下载[JavaMail API](http://java.sun.com/products/javamail/downloads/index.html)并将 jars 复制到该目录中。
3.  下载[JavaBeans Activation Framework](http://java.sun.com/javase/technologies/desktop/javabeans/jaf/downloads/index.html)并将 jar 复制到该目录中。
4.  下载[Apache Ant 1.7.0](http://archive.apache.org/dist/ant/binaries/)（不是最新的，与安装的版本匹配）并将`apache-ant-1.7.0/lib/ant-javamail.jar`文件复制到该目录中。

这仅解决了单个用户帐户的问题，但这对我的目的来说很好，并且省去了在我的机器上安装两个单独的 ant 的麻烦。

# c++ - 访问成员变量与局部变量的 C++ 性能

> ID：238535
> 
> 赞同：38
> 
> 时间：2008-10-26T20:08:15.673
> 
> 标签：c++, performance

类访问成员变量还是局部变量更有效？例如，假设您有一个（回调）方法，其唯一职责是接收数据，对其执行计算，然后将其传递给其他类。在性能方面，拥有一个方法在接收数据时填充的成员变量列表是否更有意义？还是每次调用回调方法时都声明局部变量？

假设这个方法每秒会被调用数百次......

如果我不清楚，这里有一些简单的例子：

```
// use local variables
class thisClass {
    public:
        void callback( msg& msg )
        {
            int varA;
            double varB;
            std::string varC;
            varA = msg.getInt();
            varB = msg.getDouble();
            varC = msg.getString();

            // do a bunch of calculations
         }

};

// use member variables
class thisClass {
    public:
        void callback( msg& msg )
        {
             m_varA = msg.getInt();
             m_varB = msg.getDouble();
             m_varC = msg.getString();

             // do a bunch of calculations
        }

    private:
        int m_varA;
        double m_varB;
        std::string m_varC;

}; 
```

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-10-26T20:28:52.857

内容提要：几乎在所有场景下都无所谓，但局部变量有一点优势。

警告：您正在进行微优化。您最终将花费数小时试图理解本应赢得一纳秒的代码。

警告：在您的场景中，性能不应该是问题，而是变量的作用——它们是临时的，还是 thisClass 的状态？

警告：优化的第一、第二和最后一条规则：测量！

* * *

首先，查看为 x86 生成的典型程序集（您的平台可能会有所不同）：

```
// stack variable: load into eax
mov eax, [esp+10]

// member variable: load into eax
mov ecx, [adress of object]
mov eax, [ecx+4] 
```

一旦对象的地址被加载到寄存器中，指令是相同的。加载对象地址通常可以与较早的指令配对，并且不会影响执行时间。

但这意味着 ecx 寄存器不可用于其他优化。*然而*，现代 CPU 做了一些巧妙的技巧来减少这个问题。

此外，当访问许多对象时，这可能会花费您额外的费用。*然而*，这还不到一个周期的平均值，而且配对指令的机会通常更多。

内存局部性：这是堆栈赢得大好时机的机会。栈顶实际上总是在 L1 缓存中，因此加载需要一个周期。对象更有可能被推回二级缓存（经验法则，10 个周期）或主内存（100 个周期）。

*但是*，您只需为首次访问付费。如果您只有一次访问，则 10 或 100 个周期是不明显的。如果您有数千次访问，对象数据也将在 L1 缓存中。

总之，增益是如此之小，以至于将成员变量复制到局部变量中以获得更好的性能几乎没有意义。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-26T20:16:00.823

我更喜欢一般原则上的局部变量，因为它们可以最大限度地减少程序中的邪恶可变状态。至于性能，你的分析器会告诉你所有你需要知道的。对于 int 和其他内置函数，Locals 应该更快，因为它们可以放在寄存器中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T20:15:11.463

这应该是你的编译器问题。相反，优化可维护性：如果信息只在本地使用，则将其存储在本地（自动）变量中。我讨厌阅读充斥着成员变量的类，这些变量实际上并没有告诉我关于类本身的任何信息，而只是关于一堆方法如何协同工作的一些细节:(

实际上，如果局部变量无论如何都没有更快，我会感到惊讶-它们一定会在缓存中，因为它们靠近其余的函数数据（调用帧）并且对象指针可能完全在其他地方-但是我只是在这里猜测。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-26T20:16:27.187

愚蠢的问题。
这完全取决于编译器以及它为优化所做的工作。

即使它确实有效，你得到了什么？混淆你的代码的方法？

变量访问通常通过指针和偏移量完成。

*   指向对象的指针 + 偏移量
*   指向堆栈帧的指针 + 偏移量

也不要忘记添加将变量移动到本地存储然后将结果复制回来的成本。所有这些都可能意义不大，因为编译器可能足够聪明，可以优化大部分内容。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-26T13:08:15.307

其他人没有明确提及的几点：

*   您可能会在代码中调用赋值运算符。例如 varC = msg.getString();

*   每次设置功能框架时，您都会浪费一些周期。您正在创建变量，调用默认构造函数，然后调用赋值运算符将 RHS 值放入本地。

*   将局部变量声明为 const-refs，当然，还要初始化它们。

*   成员变量可能在堆上（如果你的对象被分配在那里），因此会受到非局部性的影响。

*   即使节省了几个周期也很好——如果可以避免的话，为什么还要浪费计算时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-26T20:15:20.607

如有疑问，请进行基准测试并亲自查看。并确保它首先有所作为——每秒数百次对现代处理器来说并不是一个巨大的负担。

也就是说，我认为不会有任何区别。两者都是指针的常量偏移量，局部变量来自堆栈指针，成员来自“this”指针。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-26T20:16:25.953

在我看来，它不应该影响性能，因为：

*   在您的第一个示例中，变量是通过堆栈上的查找来访问的，例如**[ESP]+4**这意味着*当前堆栈结束加上四个字节*。
*   在第二个示例中，变量是通过相对于 this 的查找来访问的（请记住，varB 等于 this->varB）。这是一个类似的机器指令。

因此，没有太大的区别。

但是，您应该避免复制字符串；）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-26T20:41:30.897

与您在算法实现中表示数据的方式相比，您将与之交互的数据量对执行速度的影响更大。

处理器并不真正关心数据是在堆栈上还是在堆上（除了堆栈顶部可能会在处理器缓存中，如 peterchen 提到的那样），但为了获得最大速度，数据必须适合处理器的缓存（L1 缓存，如果你有不止一级缓存，几乎所有现代处理器都有）。来自 L2 缓存的任何负载 - 或 $DEITY 禁止，主内存 - 都会减慢执行速度。因此，如果您正在处理一个大小为几百 KB 且每次调用都有机会的字符串，则甚至无法测量差异。

请记住，在大多数情况下，最终用户几乎无法检测到程序中 10% 的加速（除非您设法将隔夜批处理的运行时间从 25 小时缩短到 24 小时以下），所以这不值得担心除非你确定并且有分析器输出来支持这段特定的代码在 10%-20% 的“热区”内，这对你的程序的运行时间有重大影响。

其他考虑应该更重要，例如可维护性或其他外部因素。例如，如果上面的代码是多线程代码，使用局部变量可以使实现更容易。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-26T20:45:13.230

这取决于，但我希望绝对没有区别。

重要的是：使用成员变量作为临时变量将使您的代码不可重入 - 例如，如果两个线程尝试在同一个对象上调用 callback()，它将失败。使用静态局部变量（或静态成员变量）更糟糕，因为如果两个线程尝试在**任何**thisClass 对象或后代上调用 callback()，您的代码将失败。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-26T20:15:37.923

使用成员变量应该稍微快一些，因为它们只需分配一次（在构造对象时），而不是每次调用回调时。但与您可能正在做的其他工作相比，我预计这将是一个非常小的百分比。对两者进行基准测试，看看哪个更快。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-26T20:18:26.107

此外，还有第三种选择：静态局部变量。这些不会在每次调用函数时重新分配（实际上，它们会在调用中保留），但它们不会用过多的成员变量污染类。

# jquery - SimpleModal containerCSS 在 Firefox 或 Chrome 中不起作用

> ID：238536
> 
> 赞同：1
> 
> 时间：2008-10-26T20:09:07.560
> 
> 标签：jquery, simplemodal

我试图覆盖带有 containerCSS 的 simplemodal jquery 插件附带的默认样式表中的设置，该插件在 IE7 中运行良好，但在 Firefox 或 Chrome 中运行良好。不确定这是一个错误还是我做错了什么。

**jQuery代码：**

```
$(document).ready(function() {
    $("#ButtonPopup").click(function() {
        $("#addEditTask").modal({
            onOpen: modalOpen,
            persist: true,
            containerCss: ({ width: "300", height: "200", marginLeft: "-150" })
        });
        return false;
    });
}); 
```

**HTML 代码：**

```
<button id="ButtonPopup">Popup</button>
<div id="addEditTask" style="display:none;">
     <p>Aliquam nonummy adipiscing augue. Lorem ipsum dolor sit amet, consectetuer adipiscing elit.
     Maecenas porttitor congue massa. Fusce posuere, magna sed pulvinar ultricies, purus lectus malesuada
     libero, sit amet commodo magna eros quis urna.</p>
     <button id="ButtonSave">Save</button>
     <button id="ButtonCancel">Cancel</button>
</div> 
```

请参阅[此](http://beckelman.net/issues/simplemodalfirefoxproblem/default.aspx) 内容以获取您可以自己测试的代码的工作演示和 zip 下载。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T23:40:01.567

Eric Martin 通过 jquery 邮件列表回答了这个问题。

[http://groups.google.com/group/jquery-en/browse_thread/thread/90e58bb317002361](http://groups.google.com/group/jquery-en/browse_thread/thread/90e58bb317002361)

我省略了在 IE 中找到但在 Firefox 中找不到的单元。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T15:48:19.193

基于 Gecko 和 WebKit 的浏览器非常喜欢它们的单元。确保你总是告诉它如何衡量你的价值观。

另请注意，如果您想覆盖 css 文件中的内联样式，可以通过在值末尾添加 !important 来实现。

高度：300px！重要；

将覆盖内联样式。

干杯!

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T20:22:25.380

我会看看 jqModal 。

# ms-access - 如何在 Access 中检查空值？

> ID：238537
> 
> 赞同：2
> 
> 时间：2008-10-26T20:09:25.890
> 
> 标签：ms-access, null

我是 Access 的新手。我有一张满是记录的桌子。我想编写一个函数来检查任何 id 是否为空或为空。如果是这样，我想用 xxxxx 更新它。id 的检查必须在数据库中的所有表中运行。谁能提供一些示例代码？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T20:17:38.400

我不确定您是否能够使用 Access SQL 找到数据库中的所有表。相反，您可能想要编写一些 VBA 来遍历表并为每个表生成一些 SQL。类似于以下内容：

```
update TABLE set FIELD = 'xxxxxx' where ID is null 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T16:23:49.083

查看 Nz() 函数。当它用您指定的任何内容替换它们时，除非它们为空，否则它将保持字段不变。

对于合理数量和大小的表格，只需

*   打开它们
*   依次按每个字段排序
*   检查空值并手动替换

找出空值的来源并阻止它们是一种很好的做法 - 为字段提供默认值，在输入上使用 Nz()。并让您的代码处理任何从网络中溜走的空值。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-26T22:19:58.967

我称它为*UpdateFieldWhereNull*函数，显示的是一个调用它的子程序（*改编自[http://www.aislebyaisle.com/access/vba_backend_code.htm](http://www.aislebyaisle.com/access/vba_backend_code.htm)*）

它更新*DbPath*参数中的所有表（*未经测试，请小心处理*）：

```
Function UpdateFieldWhereNull(DbPath As String, fieldName as String, newFieldValue as String) As Boolean
    'This links to all the tables that reside in DbPath,
    '  whether or not they already reside in this database.
    'This works when linking to an Access .mdb file, not to ODBC.
    'This keeps the same table name on the front end as on the back end.
    Dim rs As Recordset

        On Error Resume Next

    'get tables in back end database
        Set rs = CurrentDb.OpenRecordset("SELECT Name " & _
                                        "FROM MSysObjects IN '" & DbPath & "' " & _
                                        "WHERE Type=1 AND Flags=0")
        If Err <> 0 Then Exit Function

    'update field in tables
        While Not rs.EOF
            If DbPath <> Nz(DLookup("Database", "MSysObjects", "Name='" & rs!Name & "' And Type=6")) Then

                'UPDATE the field with new value if null
                DoCmd.RunSQL "UPDATE " & acTable & " SET [" & fieldName & "] = '" & newFieldValue & "' WHERE [" & fieldName & "] IS NULL"

            End If
            rs.MoveNext
        Wend
        rs.Close

        UpdateFieldWhereNull = True
End Function

Sub CallUpdateFieldWhereNull()
    Dim Result As Boolean

    'Sample call:
    Result = UpdateFieldWhereNull("C:\Program Files\Microsoft Office\Office\Samples\Northwind.mdb", "ID", "xxxxxx")
    Debug.Print Result
End Sub 
```

# information-retrieval - 寻找信息科学、信息检索方面的书籍

> ID：238541
> 
> 赞同：3
> 
> 时间：2008-10-26T20:12:39.240
> 
> 标签：information-retrieval

到目前为止，这是我的清单上的内容。我想知道同样的其他人，也许技术性更强，也许更少

被炸成碎片：数字爆炸后的你的生活、自由和幸福 - Ableson、Leeden 和 Lewis
Glut：通过时代掌握信息 - Wright
信息规则 - Varian 和 Shapiro
网络龙：搜索引擎技术的神话 - Witten， Gori 和 Numerico

我在文本挖掘方面见过一些，它们包括
Web Data Mining - Liu
现代信息检索 - Baeza-Yates，Ribiero-Neto

也在寻找像
[http://www.stat.columbia.edu/~gelman/blog/](http://www.stat.columbia.edu/~gelman/blog/)
[http://www.econlib.org/library/Enc/Information.html这样的博客记录](http://www.econlib.org/library/Enc/Information.html)

或诸如
[结构形式的发现之类的论文](http://www.psy.cmu.edu/~ckemp/papers/kempt08.pdf)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-08-19T15:09:46.197

*   “SIGIR” - 会议
*   “TREC” - 会议
*   Baeza-Yates，Ribeiro-Neto，“现代信息检索”（1999）
*   Witten，“管理千兆字节”（1999 年）
*   van Rijsbergen，“信息检索”（1979）

是明显的“圣经”（如上所述）。

*   Büttcher、Clarke、Cormack，“信息检索：实施和评估搜索引擎”（2010 年）

是一本有趣的新教科书（学生级别），充满了参考书目。它包含对并行检索算法的很好解释（示例章节）。

*   Croft、Metzler、Strohman，“搜索引擎：实践中的信息检索”（2009 年）

有很好的评价；我不太喜欢它（阅读 Croft 主页上的示例章节）。

*   Voorhees, Harman，“Trec：信息检索中的实验和评估”（2009 年）

是对评估 IR 的 TREC 方法的一个很好的介绍。

*   Langville, Meyer，“Google 的 Pagerank 及其他：搜索引擎排名的科学”（2006 年）

解释了如何有效地计算 PageRank。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T23:02:52.843

[如今，信息检索简介](http://www-csli.stanford.edu/~hinrich/information-retrieval-book.html)似乎是推荐用于底层技术的文本；它于 2008 年发布，我还没有阅读它。（全文免费在线。）TimB 推荐的《管理千兆字节》是我最喜欢的老书*；**它比Modern Information Retrieval*写的好得多，尽管这也值得一看。您可以通过[明显的搜索](http://www.google.com/search?q=information+retrieval)找到更多内容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-26T21:40:25.800

[管理千兆字节 - Witten、Moffat 和 Bell](https://rads.stackoverflow.com/amzn/click/com/1558605703)：非常详细地介绍了信息检索、文本和图像压缩背后的一些技术。（免责声明：我的大学导师是第二作者。）

您还应该了解 ACM 的[SIGIR](http://www.sigir.org/)，它组织了一次关于信息检索的年度会议，并且还有一个[邮件列表](http://www.sigir.org/sigirlist/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-15T20:42:47.167

As Book [Introduction to Information Retrieval](http://www-csli.stanford.edu/~hinrich/information-retrieval-book.html) as mentioned.

I think, the best advanced information are the publications found in several academic sites and the conference papers (SIGIR, CIKM, SPIRE, WWW009, ...).

Ex.:

*   [Poly edu](http://cis.poly.edu/suel/papers/papers.htm)
*   [Melbourne](http://www.cs.mu.oz.au/~jz/Papers.html)
*   [Melbourne](http://www.cs.mu.oz.au/~alistair/abstracts/)
*   [Glasgow](http://ir.dcs.gla.ac.uk/terrier/publications.html)
*   [University of Waterloo](http://www.wumpus-search.org/publications.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-11-20T22:48:00.727

**Information Retrieval - Implementation and Evaluating Search Engines**已于 2010 年由 MIT 出版社出版，是一本非常好的关于获取信息检索实用知识的书籍。Stefan Buttcher、Charles Clarke 和 Gordon Cormack 是本书的作者。Buttcher 是 Clarke 的博士生，Clarke 是 Cormack 的博士生。总之，他们在本书中结合了大约 50 年的 IR 研究和经验。它必须阅读！

# java - 你如何以编程方式在 Java 中下载网页

> ID：238547
> 
> 赞同：120
> 
> 时间：2008-10-26T20:16:18.497
> 
> 标签：java, http, compression

我希望能够获取网页的 html 并将其保存到 a `String`，因此我可以对其进行一些处理。另外，我该如何处理各种类型的压缩。

我将如何使用 Java 来做到这一点？

* * *

## 回答 #1

> 赞同：179
> 
> 时间：2010-12-31T17:57:30.997

我会使用像[Jsoup](http://jsoup.org)这样的体面的 HTML 解析器。然后就很简单了：

```
String html = Jsoup.connect("http://stackoverflow.com").get().html(); 
```

它完全透明地处理 GZIP 和分块响应以及字符编码。它还提供了更多的优势，比如像 jQuery 一样通过 CSS 选择器进行HTML[遍历](http://jsoup.org/cookbook/extracting-data/selector-syntax)和[操作。](http://jsoup.org/cookbook/modifying-data/set-html)你只需要把它当作`Document`，而不是`String`。

```
Document document = Jsoup.connect("http://google.com").get(); 
```

您真的[不想](http://www.codinghorror.com/blog/2009/11/parsing-html-the-cthulhu-way.html)在 HTML 上运行基本的 String 方法甚至是正则表达式来处理它。

### 也可以看看：

*   [Java 中领先的 HTML 解析器的优缺点是什么？](https://stackoverflow.com/questions/3152138/what-are-the-pros-and-cons-of-the-leading-java-html-parsers)

* * *

## 回答 #2

> 赞同：113
> 
> 时间：2008-10-26T21:09:39.497

下面是一些使用 Java 的[URL](http://java.sun.com/javase/6/docs/api/java/net/URL.html)类测试过的代码。不过，我建议在处理异常或将它们传递到调用堆栈方面做得比我在这里做得更好。

```
public static void main(String[] args) {
    URL url;
    InputStream is = null;
    BufferedReader br;
    String line;

    try {
        url = new URL("http://stackoverflow.com/");
        is = url.openStream();  // throws an IOException
        br = new BufferedReader(new InputStreamReader(is));

        while ((line = br.readLine()) != null) {
            System.out.println(line);
        }
    } catch (MalformedURLException mue) {
         mue.printStackTrace();
    } catch (IOException ioe) {
         ioe.printStackTrace();
    } finally {
        try {
            if (is != null) is.close();
        } catch (IOException ioe) {
            // nothing to see here
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2010-04-06T05:17:00.170

比尔的回答非常好，但您可能希望对请求做一些事情，例如压缩或用户代理。以下代码显示了如何对您的请求进行各种类型的压缩。

```
URL url = new URL(urlStr);
HttpURLConnection conn = (HttpURLConnection) url.openConnection(); // Cast shouldn't fail
HttpURLConnection.setFollowRedirects(true);
// allow both GZip and Deflate (ZLib) encodings
conn.setRequestProperty("Accept-Encoding", "gzip, deflate");
String encoding = conn.getContentEncoding();
InputStream inStr = null;

// create the appropriate stream wrapper based on
// the encoding type
if (encoding != null && encoding.equalsIgnoreCase("gzip")) {
    inStr = new GZIPInputStream(conn.getInputStream());
} else if (encoding != null && encoding.equalsIgnoreCase("deflate")) {
    inStr = new InflaterInputStream(conn.getInputStream(),
      new Inflater(true));
} else {
    inStr = conn.getInputStream();
} 
```

要同时设置用户代理，请添加以下代码：

```
conn.setRequestProperty ( "User-agent", "my agent name"); 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-26T20:20:45.307

[好吧，您可以使用URL](http://java.sun.com/javase/6/docs/api/java/net/URL.html)和[URLConnection](http://java.sun.com/javase/6/docs/api/java/net/URLConnection.html)等内置库，但它们并没有提供太多控制。

~~我个人会选择[Apache HTTPClient](http://hc.apache.org/httpclient-3.x/)库。~~
**编辑：** HTTPClient 已被Apache设置为*生命周期结束。*替换为：[HTTP 组件](http://hc.apache.org/)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-05-30T10:30:16.080

上述所有方法都不会像在浏览器中那样下载网页文本。如今，大量数据通过 html 页面中的脚本加载到浏览器中。上述技术均不支持脚本，它们仅下载 html 文本。HTMLUNIT 支持 javascripts。因此，如果您希望下载浏览器中的网页文本，那么您应该使用[HTMLUNIT](http://htmlunit.sourceforge.net)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-10-27T17:55:52.063

您很可能需要从安全网页（https 协议）中提取代码。在以下示例中，html 文件被保存到 c:\temp\filename.html 享受！

```
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.URL;

import javax.net.ssl.HttpsURLConnection;

/**
 * <b>Get the Html source from the secure url </b>
 */
public class HttpsClientUtil {
    public static void main(String[] args) throws Exception {
        String httpsURL = "https://stackoverflow.com";
        String FILENAME = "c:\\temp\\filename.html";
        BufferedWriter bw = new BufferedWriter(new FileWriter(FILENAME));
        URL myurl = new URL(httpsURL);
        HttpsURLConnection con = (HttpsURLConnection) myurl.openConnection();
        con.setRequestProperty ( "User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0" );
        InputStream ins = con.getInputStream();
        InputStreamReader isr = new InputStreamReader(ins, "Windows-1252");
        BufferedReader in = new BufferedReader(isr);
        String inputLine;

        // Write each line into the file
        while ((inputLine = in.readLine()) != null) {
            System.out.println(inputLine);
            bw.write(inputLine);
        }
        in.close(); 
        bw.close();
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-06-15T19:23:00.267

为此，使用 NIO.2 强大的 Files.copy(InputStream in, Path target)：

```
URL url = new URL( "http://download.me/" );
Files.copy( url.openStream(), Paths.get("downloaded.html" ) ); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-26T20:43:45.667

在 Unix/Linux 机器上，您可以只运行“wget”，但如果您正在编写跨平台客户端，这不是一个真正的选择。当然，这假设您真的不想对下载的数据在下载到磁盘之间进行太多操作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-08-18T16:42:58.213

Jetty 有一个 HTTP 客户端，可用于下载网页。

```
package com.zetcode;

import org.eclipse.jetty.client.HttpClient;
import org.eclipse.jetty.client.api.ContentResponse;

public class ReadWebPageEx5 {

    public static void main(String[] args) throws Exception {

        HttpClient client = null;

        try {

            client = new HttpClient();
            client.start();

            String url = "http://example.com";

            ContentResponse res = client.GET(url);

            System.out.println(res.getContentAsString());

        } finally {

            if (client != null) {

                client.stop();
            }
        }
    }
} 
```

该示例打印一个简单网页的内容。

在[阅读 Java 中的网页](https://zetcode.com/java/readwebpage/)教程中，我编写了六个使用 URL、JSoup、HtmlCleaner、Apache HttpClient、Jetty HttpClient 和 HtmlUnit 以编程方式在 Java 中下载网页的示例。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-12-16T17:23:19.400

**从这个类中获得帮助，它会获取代码并过滤一些信息。**

```
public class MainActivity extends AppCompatActivity {

    EditText url;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate( savedInstanceState );
        setContentView( R.layout.activity_main );

        url = ((EditText)findViewById( R.id.editText));
        DownloadCode obj = new DownloadCode();

        try {
            String des=" ";

            String tag1= "<div class=\"description\">";
            String l = obj.execute( "http://www.nu.edu.pk/Campus/Chiniot-Faisalabad/Faculty" ).get();

            url.setText( l );
            url.setText( " " );

            String[] t1 = l.split(tag1);
            String[] t2 = t1[0].split( "</div>" );
            url.setText( t2[0] );

        }
        catch (Exception e)
        {
            Toast.makeText( this,e.toString(),Toast.LENGTH_SHORT ).show();
        }

    }
                                        // input, extrafunctionrunparallel, output
    class DownloadCode extends AsyncTask<String,Void,String>
    {
        @Override
        protected String doInBackground(String... WebAddress) // string of webAddress separate by ','
        {
            String htmlcontent = " ";
            try {
                URL url = new URL( WebAddress[0] );
                HttpURLConnection c = (HttpURLConnection) url.openConnection();
                c.connect();
                InputStream input = c.getInputStream();
                int data;
                InputStreamReader reader = new InputStreamReader( input );

                data = reader.read();

                while (data != -1)
                {
                    char content = (char) data;
                    htmlcontent+=content;
                    data = reader.read();
                }
            }
            catch (Exception e)
            {
                Log.i("Status : ",e.toString());
            }
            return htmlcontent;
        }
    }
} 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2017-10-26T08:42:30.323

> 我使用了这篇文章的实际答案（[url](https://stackoverflow.com/a/238634/2683452)）并将输出写入文件。

```
package test;

import java.net.*;
import java.io.*;

public class PDFTest {
    public static void main(String[] args) throws Exception {
    try {
        URL oracle = new URL("http://www.fetagracollege.org");
        BufferedReader in = new BufferedReader(new InputStreamReader(oracle.openStream()));

        String fileName = "D:\\a_01\\output.txt";

        PrintWriter writer = new PrintWriter(fileName, "UTF-8");
        OutputStream outputStream = new FileOutputStream(fileName);
        String inputLine;

        while ((inputLine = in.readLine()) != null) {
            System.out.println(inputLine);
            writer.println(inputLine);
        }
        in.close();
        } catch(Exception e) {

        }

    }
} 
```

# macos - Mac 控制台粘贴生成垃圾文本

> ID：238553
> 
> 赞同：-1
> 
> 时间：2008-10-26T20:18:07.603
> 
> 标签：macos, console, copy-paste

在 mac os 控制台上，当粘贴大量文本（例如 sql 数据库）时，我会收到大量垃圾和损坏的文本。但是当在 Windows 下或文本框中执行相同操作时，不会发生这种情况，并且文本输出正常。

这是缓冲区问题还是类似的问题？如果是这样，有人知道任何标志可以使其尺寸更大吗？

除此之外，有人对解决此问题的方法有任何建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T21:06:45.340

不要使用复制/粘贴。说真的，shell 早在 GUI 之前就已经设计好了。它不适用于某些现代 HIG 习语，如复制/粘贴。具有讽刺意味的是，如果您转储到临时文件而不是粘贴，您的任务可能会*更容易。*例如，而不是做这样的事情：

```
dump_database
# select and hit Cmd+C
create_database
# hit Cmd+V at prompt 
```

尝试更多类似以下的方法：

```
dump_database | create_database 
```

或者，如果您绝对必须：

```
dump_database > tmp_file
# ...
create_database < tmp_file
rm tmp_file 
```

**或者：**只需使用[`pbcopy`and`pbpaste`](http://osxdaily.com/2007/03/05/manipulating-the-clipboard-from-the-command-line/)。

# c# - 如何获取 MemberInfo 的值？

> ID：238555
> 
> 赞同：40
> 
> 时间：2008-10-26T20:20:38.193
> 
> 标签：c#, reflection

如何获取`MemberInfo`对象的值？`.Name`返回变量的名称，但我需要该值。

我想你可以这样做，`FieldInfo`但我没有片段，如果你知道怎么做，你能提供一个片段吗？

谢谢！

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2015-10-31T00:53:37.633

尽管我大体上同意 Marc 关于不反映字段的观点，但有时需要它。如果你想反映一个成员并且你不在乎它是一个字段还是一个属性，你可以使用这个扩展方法来获取值（如果你想要类型而不是值，请参阅nawful对[这个问题](https://stackoverflow.com/questions/15921608/getting-the-type-of-a-memberinfo-with-reflection)的回答） ：

```
 public static object GetValue(this MemberInfo memberInfo, object forObject)
    {
        switch (memberInfo.MemberType)
        {
            case MemberTypes.Field:
                return ((FieldInfo)memberInfo).GetValue(forObject);
            case MemberTypes.Property:
                return ((PropertyInfo)memberInfo).GetValue(forObject);
            default:
                throw new NotImplementedException();
        }
    } 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-10-26T20:23:04.193

[这是使用FieldInfo.GetValue](http://msdn.microsoft.com/en-us/library/system.reflection.fieldinfo.getvalue.aspx)的字段示例：

```
using System;
using System.Reflection;

public class Test
{
    // public just for the sake of a short example.
    public int x;

    static void Main()
    {
        FieldInfo field = typeof(Test).GetField("x");
        Test t = new Test();
        t.x = 10;

        Console.WriteLine(field.GetValue(t));
    }
} 
```

类似的代码适用于使用[PropertyInfo.GetValue()](http://msdn.microsoft.com/en-us/library/system.reflection.propertyinfo.getvalue.aspx)的属性- 尽管您还需要将任何参数的值传递给属性。（“普通”C# 属性不会有任何属性，但就框架而言，C# 索引器也算作属性。）对于方法，如果要调用方法并[使用](http://msdn.microsoft.com/en-us/library/system.reflection.methodbase.invoke.aspx)返回值。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-26T21:33:09.233

乔恩的回答是理想的 - 只有一个观察：作为一般设计的一部分，我会：

1.  *一般*避免对非公众成员进行反思
2.  避免拥有公共领域（几乎总是）

这两者的结果是，*通常*您只需要针对公共属性进行反射（除非您知道它们的作用，否则您不应该调用方法；​​属性获取器*应该*是幂等的[延迟加载]）。所以对于 a`PropertyInfo`这只是`prop.GetValue(obj, null);`.

实际上，我是 的忠实粉丝`System.ComponentModel`，所以我很想使用：

```
 foreach(PropertyDescriptor prop in TypeDescriptor.GetProperties(obj))
    {
        Console.WriteLine("{0}={1}", prop.Name, prop.GetValue(obj));
    } 
```

或对于特定属性：

```
 PropertyDescriptor prop = TypeDescriptor.GetProperties(obj)["SomeProperty"];
    Console.WriteLine("{0}={1}", prop.Name, prop.GetValue(obj)); 
```

一个优点`System.ComponentModel`是它可以与抽象数据模型一起使用，例如如何`DataView`将列公开为虚拟属性；还有其他技巧（例如[表演技巧](http://www.codeproject.com/KB/cs/HyperPropertyDescriptor.aspx)）。

# sql - (Windows) 异常处理：到事件日志还是到数据库？

> ID：238583
> 
> 赞同：6
> 
> 时间：2008-10-26T20:42:52.330
> 
> 标签：sql, exception, exception-handling, event-log

我曾在一些商店工作过，我在事件日志和数据库表中实现了异常处理。

每个都有其优点，我可以根据我的经验强调一些优点：

事件簿

*   例外情况的行业标准位置 (+)
*   易于记录 (+)
*   可以在此处记录数据库连接问题 (+)
*   可以在事件日志之上构建报告和查看应用程序 (+)
*   需要经常冲洗，如果那里报告很多（-）
*   不如 SQL 日志记录那样可扩展[在 SQL 中添加自定义字段，如方法名称] (-)

SQL/数据库

*   可以处理大量数据 (+)
*   可以处理异常的快速批量插入 (+)
*   负载均衡环境中异常的单一存储位置 (+)
*   非常可定制 (+)
*   从 SQL 存储中构建报告/通知更容易一些 (+)
*   不同于存储典型异常的位置 (-)

我是否遗漏了任何主要考虑因素？

我确信其中一些观点值得商榷，但我很好奇什么对其他团队最有效，以及为什么你对这个选择有强烈的感觉。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T21:21:12.360

您需要区分日志记录和跟踪。虽然线条有点模糊，但我倾向于将日志记录视为“非开发人员的东西”。诸如未处理的异常、损坏的文件等。这些绝对是不正常的，应该是一个非常罕见的问题。

跟踪是开发人员感兴趣的。堆栈跟踪、方法参数、Web 服务器返回的 HTTP 状态为 401.3 等。这些确实很嘈杂，并且可以在短时间内产生大量数据。通常我们有不同级别的跟踪，以减少噪音。

对于登录客户端应用程序，我认为事件日志是要走的路（我必须仔细检查，但我认为 ASP.NET 健康监控也可以写入事件日志）。普通用户有权写入事件日志，只要您有安装程序（无论如何都由管理员安装）创建事件源。

Sql 日志记录的大部分优势虽然是真的，但不适用于事件日志记录：

*   可以处理大量数据： *您是否真的有大量未处理的异常或其他高级故障？*
*   可以处理快速大量插入的异常：*一个未处理的异常应该会让你的应用程序崩溃——它本质上是速率受限的。其他对非开发人员感兴趣的事件也应该类似地汇总。*
*   非常可定制：*事件日志中的消息几乎是自由文本。如果您需要更多信息，只需指向文本或结构化 XML 或二进制文件日志*
*   从 SQL 存储中构建报告/通知更容易一些：*报告内置于事件日志查看器中，并且通知系统是固有的 - 由于应用程序崩溃 - 或与其他非常重要的通知混合 - 没有什么借口缺少事件日志消息。对于企业或其他联网应用程序，已经从事件日志中剔除一千零一个不同的应用程序以查找错误......您的系统管理员可能已经在使用一个。*

对于*跟踪*，其中包含异常或错误的具体细节，我喜欢平面文件 - 它们易于维护，易于 grep，如果我愿意，可以导入 Sql 进行分析。

90% 的情况下，您不需要它们，它们被设置为 WARN 或 ERROR。但是，当您将它们设置为 INFO 或 DEBUG 时，您将生成*大量*数据。RDBMS 有很多开销——性能（ACID、并发等）、存储（事务日志、SCSI RAID-5 驱动器等）和管理（备份、服务器维护等）——所有这些都是跟踪日志是不必要的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T20:51:12.407

我不会*直接*登录到数据库。正如你所说，数据库问题变得难以记录:)

我会登录到文件系统，然后有一个从文件批量插入到数据库的作业。就我个人而言，我喜欢在日志中运行数据库中的日志，主要用于扩展情况——我几乎假设我将运行不止一台机器，并且能够有效地拥有一个组合日志很方便。（当然，每个条目都应该说明它来自哪台机器。）

报告和查看应用程序可以很容易地从数据库中完成 - 目前可能存在较少的日志专用报告工具，但几乎所有数据库都具有通用报告功能。

为了便于记录，我会使用像[log4net](http://logging.apache.org/log4net/index.html)这样的框架，它需要付出很多努力，并且是一个久经考验的解决方案。除此之外，这意味着您可以在不更改代码的情况下更改输出策略。如有必要，您甚至可以同时记录到事件日志和数据库，或者将一些日志发送到一个地方，而将一些日志发送到另一个地方。（我在这里假设 .NET，但许多平台都有类似的日志框架。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T20:48:50.227

关于事件日志需要考虑的一件事是，有一些产品可以监控服务器的事件日志（如 Microsoft Operations Manager）并智能地进行通知，并收集有关其内容的统计信息。

基于 SQL 的日志记录的一个“缺点”是它向您的应用程序添加了另一层依赖关系，这可能会或可能不会总是可接受的。在我的职业生涯中，我都做到了。我曾经甚至两次使用基于 MSMQ 的消息队列来对日志事件进行排队并将队列清空到 MSSQL 数据库中，以消除我的客户端软件与数据库连接的需要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T20:47:18.607

关于写入事件日志的一个注意事项：这需要您的应用程序用户具有某些权限，在某些环境中默认情况下可能会受到限制。

在我所在的位置，我们将大部分日志记录到数据库中，并使用平面文件作为备份。非常好，我们可以做一些事情，比如在我们做出改变时为应用程序获取一个 RSS 提要，以便观看几天。

# python - 如何在 Python 中支持用户定义的搜索字符串中的通配符？

> ID：238600
> 
> 赞同：8
> 
> 时间：2008-10-26T20:52:35.977
> 
> 标签：python, search, parsing, string, wildcard

搜索字符串时是否有一种简单的方法来支持通配符（“*”） - 不使用 RegEx？

用户应该使用通配符输入搜索词，但不必处理 RegEx 的复杂性：

```
"foo*"   =>  str.startswith("foo")
"*foo"   =>  str.endswith("foo")
"*foo*"  =>  "foo" in str 
```

（但是，当有多个搜索词时，它会变得更加复杂，例如“foo *bar* baz”）

这似乎是一个常见问题，所以我想知道是否有现成的解决方案。

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-26T20:54:30.107

你可以试试这个[`fnmatch`](http://www.python.org/doc/2.5.2/lib/module-fnmatch.html)模块，它有一个类似于 shell 的通配符语法。

# c - 如何在 C 中获取文件的大小？

> ID：238603
> 
> 赞同：424
> 
> 时间：2008-10-26T20:54:57.593
> 
> 标签：c, file, size

如何找出用 C 编写的应用程序打开的文件的大小？我想知道大小，因为我想将加载文件的内容放入一个字符串中，我使用`malloc()`. 只是写作`malloc(10000*sizeof(char));`是恕我直言一个坏主意。

* * *

## 回答 #1

> 赞同：584
> 
> 时间：2008-10-26T20:57:29.897

您需要寻找到文件的末尾，然后询问位置：

```
fseek(fp, 0L, SEEK_END);
sz = ftell(fp); 
```

然后您可以回溯，例如：

```
fseek(fp, 0L, SEEK_SET); 
```

或（如果想从头开始）

```
rewind(fp); 
```

* * *

## 回答 #2

> 赞同：410
> 
> 时间：2008-10-26T20:59:32.153

## 使用标准库：

假设您的实现有意义地支持 SEEK_END：

```
fseek(f, 0, SEEK_END); // seek to end of file
size = ftell(f); // get current file pointer
fseek(f, 0, SEEK_SET); // seek back to beginning of file
// proceed with allocating memory and reading the file 
```

## Linux/POSIX：

您可以使用`stat`（如果您知道文件名），或者`fstat`（如果您有文件描述符）。

下面是一个统计示例：

```
#include <sys/stat.h>
struct stat st;
stat(filename, &st);
size = st.st_size; 
```

## 赢32：

您可以使用[GetFileSize](https://msdn.microsoft.com/en-us/library/windows/desktop/aa364955(v=vs.85).aspx)或[GetFileSizeEx](https://msdn.microsoft.com/en-us/library/windows/desktop/aa364957(v=vs.85).aspx)。

* * *

## 回答 #3

> 赞同：120
> 
> 时间：2008-10-26T21:17:18.017

如果您有文件描述符，则`fstat()`返回一个包含文件大小的统计结构。

```
#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>

// fd = fileno(f); //if you have a stream (e.g. from fopen), not a file descriptor.
struct stat buf;
fstat(fd, &buf);
off_t size = buf.st_size; 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2011-03-27T02:09:48.093

我最终只是做了一个简短而甜蜜的`fsize`功能（注意，没有错误检查）

```
int fsize(FILE *fp){
    int prev=ftell(fp);
    fseek(fp, 0L, SEEK_END);
    int sz=ftell(fp);
    fseek(fp,prev,SEEK_SET); //go back to where we were
    return sz;
} 
```

标准 C 库没有这样的功能有点傻，但我明白为什么它会很困难，因为不是每个“文件”都有大小（例如`/dev/null`）

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2010-01-05T02:36:01.360

如何使用***lseek*** / ***fseek*** / ***stat*** / ***fstat***获取文件大小？

```
#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/stat.h>

void
fseek_filesize(const char *filename)
{
    FILE *fp = NULL;
    long off;

    fp = fopen(filename, "r");
    if (fp == NULL)
    {
        printf("failed to fopen %s\n", filename);
        exit(EXIT_FAILURE);
    }

    if (fseek(fp, 0, SEEK_END) == -1)
    {
        printf("failed to fseek %s\n", filename);
        exit(EXIT_FAILURE);
    }

    off = ftell(fp);
    if (off == -1)
    {
        printf("failed to ftell %s\n", filename);
        exit(EXIT_FAILURE);
    }

    printf("[*] fseek_filesize - file: %s, size: %ld\n", filename, off);

    if (fclose(fp) != 0)
    {
        printf("failed to fclose %s\n", filename);
        exit(EXIT_FAILURE);
    }
}

void
fstat_filesize(const char *filename)
{
    int fd;
    struct stat statbuf;

    fd = open(filename, O_RDONLY, S_IRUSR | S_IRGRP);
    if (fd == -1)
    {
        printf("failed to open %s\n", filename);
        exit(EXIT_FAILURE);
    }

    if (fstat(fd, &statbuf) == -1)
    {
        printf("failed to fstat %s\n", filename);
        exit(EXIT_FAILURE);
    }

    printf("[*] fstat_filesize - file: %s, size: %lld\n", filename, statbuf.st_size);

    if (close(fd) == -1)
    {
        printf("failed to fclose %s\n", filename);
        exit(EXIT_FAILURE);
    }
}

void
stat_filesize(const char *filename)
{
    struct stat statbuf;

    if (stat(filename, &statbuf) == -1)
    {
        printf("failed to stat %s\n", filename);
        exit(EXIT_FAILURE);
    }

    printf("[*] stat_filesize - file: %s, size: %lld\n", filename, statbuf.st_size);

}

void
seek_filesize(const char *filename)
{
    int fd;
    off_t off;

    if (filename == NULL)
    {
        printf("invalid filename\n");
        exit(EXIT_FAILURE);
    }

    fd = open(filename, O_RDONLY, S_IRUSR | S_IRGRP);
    if (fd == -1)
    {
        printf("failed to open %s\n", filename);
        exit(EXIT_FAILURE);
    }

    off = lseek(fd, 0, SEEK_END);
    if (off == -1)
    {
        printf("failed to lseek %s\n", filename);
        exit(EXIT_FAILURE);
    }

    printf("[*] seek_filesize - file: %s, size: %lld\n", filename, (long long) off);

    if (close(fd) == -1)
    {
        printf("failed to close %s\n", filename);
        exit(EXIT_FAILURE);
    }
}

int
main(int argc, const char *argv[])
{
    int i;

    if (argc < 2)
    {
        printf("%s <file1> <file2>...\n", argv[0]);
        exit(0);
    }

    for(i = 1; i < argc; i++)
    {
        seek_filesize(argv[i]);
        stat_filesize(argv[i]);
        fstat_filesize(argv[i]);
        fseek_filesize(argv[i]);
    }

    return 0;
} 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-10-29T13:38:45.027

您是否考虑过不计算文件大小而只在必要时增加数组？这是一个示例（省略了错误检查）：

```
#define CHUNK 1024

/* Read the contents of a file into a buffer.  Return the size of the file 
 * and set buf to point to a buffer allocated with malloc that contains  
 * the file contents.
 */
int read_file(FILE *fp, char **buf) 
{
  int n, np;
  char *b, *b2;

  n = CHUNK;
  np = n;
  b = malloc(sizeof(char)*n);
  while ((r = fread(b, sizeof(char), CHUNK, fp)) > 0) {
    n += r;
    if (np - n < CHUNK) { 
      np *= 2;                      // buffer is too small, the next read could overflow!
      b2 = malloc(np*sizeof(char));
      memcpy(b2, b, n * sizeof(char));
      free(b);
      b = b2;
    }
  }
  *buf = b;
  return n;
} 
```

即使对于无法获得文件大小的流（如标准输入），这也具有工作的优势。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-10-26T21:13:54.043

如果您使用的是 Linux，请认真考虑只使用 glib 中的[**g_file_get_contents**](https://developer.gnome.org/glib/stable/glib-File-Utilities.html#g-file-get-contents)函数。它处理加载文件、分配内存和处理错误的所有代码。

* * *

## 回答 #8

> 赞同：-42
> 
> 时间：2008-10-29T13:50:48.337

```
#include <stdio.h>

#define MAXNUMBER 1024

int main()
{
    int i;
    char a[MAXNUMBER];

    FILE *fp = popen("du -b  /bin/bash", "r");

    while((a[i++] = getc(fp))!= 9)
        ;

    a[i] ='\0';

    printf(" a is %s\n", a);

    pclose(fp);
    return 0;
} 
```

高温高压

# c# - C# Web 服务器连接问题

> ID：238606
> 
> 赞同：1
> 
> 时间：2008-10-26T20:56:55.623
> 
> 标签：c#, connection

我正在尝试制作一个简单的 C# Web 服务器，在这个阶段，您可以通过浏览器访问它，并且只会执行“Hello World”。

我遇到的问题是服务器可以很好地接收数据——我得到了浏览器的标头信息——但是浏览器没有收到我发送的任何东西。此外，我只能通过 localhost（或 127.0.0.1）连接到服务器。我无法通过访问我的 IP 来访问它，它不是网络设置，因为如果我运行它，Apache 可以正常工作。此外，我正在使用端口监控程序，在尝试从浏览器连接后，进程的端口卡在 TIME_WAIT 状态，即使我告诉连接关闭并且它应该返回 LISTEN。

这是相关的代码。几个电话可能没有意义，但这是一个更大的程序的一部分。

```
class ConnectionHandler
{
    private Server server;

    private TcpListener tcp;

    private ArrayList connections;

    private bool listening;

    private Thread listeningThread;

    public Server getServer()
    {
        return server;
    }

    private void log(String s, bool e)
    {
        server.log("Connection Manager: " + s, e);
    }

    private void threadedListen()
    {
        while (listening)
        {
            try
            {
                TcpClient t = tcp.AcceptTcpClient();
                Connection conn = new Connection(this, t);
            }
            catch (NullReferenceException)
            {
                log("unable to accept connections!", true);
            }
        }
        log("Stopped listening", false);
    }

    public void listen()
    {
        log("Listening for new connections", false);
        tcp.Start();
        listening = true;
        if (listeningThread != null && listeningThread.IsAlive)
        {
            listeningThread.Abort();
        }
        listeningThread = new Thread(new ThreadStart(
            this.threadedListen));
        listeningThread.Start();
    }

    public void stop()
    {
        listening = false;
        if (listeningThread != null)
        {
            listeningThread.Abort();
            log("Forced stop", false);
        }
        log("Stopped listening", false);
    }

    public ConnectionHandler(Server server)
    {
        this.server = server;
        tcp = new TcpListener(new IPEndPoint(
            IPAddress.Parse("127.0.0.1"), 80));
        connections = new ArrayList();
    }
}

class Connection
{
    private Socket socket;
    private TcpClient tcp;

    private ConnectionHandler ch;

    public Connection(ConnectionHandler ch, TcpClient t)
    {
        try
        {
            this.ch = ch;
            this.tcp = t;
            ch.getServer().log("new tcp connection to " 
                + this.tcp.Client.RemoteEndPoint.ToString(), false);
            NetworkStream ns = t.GetStream();

            String responseString;
            Byte[] response;
            Int32 bytes;
            responseString = String.Empty;
            response = new Byte[512];
            bytes = ns.Read(response, 0, response.Length);
            responseString = 
                System.Text.Encoding.ASCII.GetString(response, 0, bytes);
            ch.getServer().log("Received: " + responseString);

            String msg = "<html>Hello World</html>";
            String fullMsg = "HTTP/1.x 200 OK\r\n"
                    + "Server: Test Server\r\n"
                    + "Content-Type: text/html; "
                        + "charset=UTF-8\r\n"
                    + "Content-Length: " + msg.Length + "\r\n"
                    + "Date: Sun, 10 Aug 2008 22:59:59 GMT"
                        + "\r\n";
            nsSend(fullMsg, ns);
            nsSend(msg, ns);

            ns.Close();
            tcp.Close();
        }
        catch (ArgumentNullException e)
        {
            ch.getServer().log("connection error: argument null exception: " + e);
        }
        catch (SocketException e)
        {
            ch.getServer().log("connection error: socket exception: " + e);
        }
    }

    private void nsSend(String s, NetworkStream ns)
    {
        Byte[] data = System.Text.Encoding.ASCII.GetBytes(s);
        ns.Write(data, 0, data.Length);
        ns.Flush();
        ch.getServer().log("Sent: " + s);
    }
} 
```

有没有人有任何想法？感觉这对我来说一定是愚蠢的，但我只是不知道是什么。我真的很感激任何见解

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T21:03:24.377

目前不是问题但以后可能会出现的一件事是，您的内容长度基于消息字符串的*Unicode*长度，而不是*二进制*长度。

Connection 构造函数中也发生了很多事情——IMO 根本不属于构造函数的东西。如果发生异常，它也不会关闭事物。

您是否查看过像 WireShark 这样的网络跟踪器中发生了什么？这将是查看是否*有任何*数据被发送回客户端的最简单方法。

或者，发布一个简短但完整的代码版本，我们可以自己编译和运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T21:13:47.167

你可能想知道你可以[`HttpListener`](http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx)很容易地用它来编写一个基本的网络服务器——它处理了大部分痛苦的部分，让你专注于编写实际的代码。MSDN 页面给出了一个示例。

请注意，这使用 HTTP.SYS，这很好 - 但意味着需要明确授予非管理员访问开放端口的权限；在 xp 上，您可以使用`httpcfg`; 在 vista 上你可以使用`netsh`. 请参阅[此处](https://stackoverflow.com/questions/169904/can-i-listen-on-a-port-using-httplistener-or-other-net-code-on-vista-without-re#195256)了解更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T21:26:14.067

也许我只是遗漏了一些东西，但是您只能在 localhost 上连接的原因是因为您正在侦听的 IP 是 127.0.0.1，这使得 TCPListener 只能侦听该 IP 地址。而且我看不到您在任何地方调用任何客户端断开连接，TCPListener 是一个阻塞调用，因此它永远坐在那里，直到建立连接。在我过去使用 TCP/IP 和 TCPListener、TCPClient 类的经验中，没有太多方法可以强制侦听器断开它的连接，直到您断开客户端连接。调用 TCPListener.Abort() 不会断开保持端口阻塞的客户端连接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-15T06:25:34.477

对于处于类似情况的任何人，如果您想从本地网络 IP 地址访问您的 C# 服务器，那么您将需要侦听地址 0.0.0.0，这意味着侦听所有 IP 地址，而不是特定的 IP 地址，例如 127.0.0.1 等。

# windows - Mercurial 中不区分大小写的文件名处理

> ID：238608
> 
> 赞同：5
> 
> 时间：2008-10-26T20:59:20.253
> 
> 标签：windows, mercurial, tortoisehg

我在 Vista64 上使用 TortoiseHg 0.5（包括 Mercurial 1.0.2）。我对[Mercurial Book](http://hgbook.red-bean.com/hgbookch7.html#x11-1530007.7)的理解是 Mercurial 应该在不区分大小写的文件系统（例如我正在使用的 NTFS）上以不区分大小写的方式处理文件名。但是我发现我安装的 Mercurial 实际上对大小写敏感：

```
>hg status -A foo
C foo
>hg status -A FOO
? FOO 
```

这可能是 Mercurial 中的错误，Mercurial 的 TortoiseHg 版本中的错误，还是其他原因？如何在 Windows 上通过 Mercurial 实现不区分大小写的文件名处理？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-09T20:16:30.540

这个问题已在 Mercurial 1.1 中解决！来自[发行说明](http://www.selenic.com/mercurial/wiki/index.cgi/WhatsNew#head-b1d1f9a535adb686d6e0a490e049261313f10d7d)：“在面对折叠文件系统时提高了正确性”。

在 Windows 上，Mercurial 现在在其命令行参数中忽略大小写：

```
>hg status -A foo
C foo
>hg status -A FOO
C foo 
```

它还知道仅涉及大小写的文件名更改不是新文件：

```
>ren foo FOO
>hg status -A fOO
C foo 
```

因此，不再有任何因命令行输入错误而忽略更改的风险。

**但是，请注意 .hgignore 文件的内容仍然区分大小写。**仅当您使用 glob 语法时才会出现此问题；使用正则表达式语法，您可以将 (?i) 放在模式的开头以使其不敏感。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-29T05:16:14.040

我认为您误读了 hgbook。7.7 节的介绍只是描述了操作系统中存在的三种不同类型的区分大小写，并不是说 mercurial 会反映这些语义。

稍后在第 7.7.2 节“检测案例冲突”中它说：

> 在工作目录中操作时，Mercurial 遵循工作目录所在文件系统的命名策略。如果文件系统保留大小写但不区分大小写，Mercurial 会将仅大小写不同的名称视为相同。

当您执行`hg status -A FOO`mercurial 中发生的过程时：

1.  检查文件系统上是否存在与文件参数'FOO'匹配的文件，此时它不区分大小写，因此它找到'foo'并说“是的，我有一个文件”
2.  检查文件清单中是否有与文件参数“FOO”匹配的条目，但没有，因此状态显示为“？” 说这是 hg 没有跟踪的磁盘上的文件

为了更好地查看 mercurial 不关心 NTFS 上的大小写，请尝试以下步骤：

1.  汞初始化
2.  回声线 > Foo
3.  hg 添加 Foo
4.  hg commit -m '提交的 Foo'
5.  move Foo not-foo
6.  move not-foo FOO
7.  汞状况

你应该看到 hg 说什么都没有改变，因为唯一改变的是 hg 忽略了你的情况。

当我在 linux 上做同样的事情时，我看到的是：

```
! Foo
? FOO 
```

# ruby-on-rails - 定义？Ruby 和 Rails 中的方法

> ID：238615
> 
> 赞同：28
> 
> 时间：2008-10-26T21:03:22.037
> 
> 标签：ruby-on-rails, ruby, content-management-system, erb

我有一个在 ERB 之上编写的非常古老的模板系统。它依赖于存储在数据库中的 ERB 模板。那些被读取和渲染。当我想将数据从一个模板传递到另一个模板时，我使用 Rails 渲染方法的 :locals 参数。为了在某​​些模板中设置这些变量的默认变量，我使用定义的？方法简单地告诉我是否已经定义了局部变量，如果没有，我用默认值初始化它，如下所示：

```
unless defined?(perex)
  perex = true
end 
```

我正在将应用程序升级到最新的 Rails，我看到一些奇怪的行为。基本上这有时有效（有时 perex 未定义），有时则无效（perex 已定义并设置为 nil）。这发生在没有任何其他改变的情况下。

我有两个问题：除了使用定义之外，还有什么更好的方法吗？哪个被证明是不可靠的（在 Rails 1.6 上几年可靠）？这种方式不应该导致我重写所有模板。我一直在浏览 Ruby 文档，但找不到任何关于定义的内容？方法。它是被弃用的还是我只是盲目的？

*编辑：*实际问题是由似乎是 Ruby/eRB 错误引起的。有时，*除非*语句会起作用，但有时不会。奇怪的是，即使第二行被执行，*perex*仍然对世界其他地方保持零。删除定义？解决了这个问题。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-26T22:26:50.793

第一：实际上，[`defined?`是一个运算符](http://ruby-doc.com/docs/ProgrammingRuby/html/tut_expressions.html#UG)。

第二：如果我正确理解了您的问题，那么使用这个 Ruby 习语的方法是：

```
perex ||= true 
```

如果它是未定义`perex`的或`nil`. 这不完全是您的示例所做的，因为您的示例不会在值为 时评估分配`nil`，但是如果您依赖它，那么在我看来，如果没有看到它，您就没有编写清晰的代码。

*编辑*：正如 Honza 所说，上面的语句将替换`perex`when it's的值`false`。然后我提出以下重写最小行数：

```
perex ||= perex.nil?  # Assign true only when perex is undefined or nil 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-11T09:59:34.183

如果在 Rails 模板中定义了本地，最安全的测试方法是：

```
local_assigns[:perex] 
```

`defined?`这与由于实现限制而无法使用的解释一起记录在 Rails API 中。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-12-17T20:00:23.917

根据 mislav 的回答，我在 Rails API 中查找该文档，并在[Class ActionView::Base](http://api.rubyonrails.org/classes/ActionView/Base.html)中找到它（在“将局部变量传递给子模板”标题下）。然而，这几乎不值得搜索，因为它几乎没有比米斯拉夫多说什么。除了它推荐这种模式：

```
if local_assigns.has_key? :perex 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-07-23T16:42:11.823

考虑到[g mislav 的原始答案](https://stackoverflow.com/questions/238615/defined-method-in-ruby-and-rails/633927#633927)和[KenB 的阐述](https://stackoverflow.com/questions/238615/defined-method-in-ruby-and-rails/1924195#1924195)，我认为以下是绝对最好的方法（尽管我持开放态度）。如果原始哈希中不存在键，它会利用 Ruby 的[Hash#fetch](http://www.ruby-doc.org/core-1.9.3/Hash.html#method-i-fetch)方法回退到备用值。

```
perex = local_assigns.fetch(:perex, true) 
```

这甚至比`||=`大多数用户建议的方法更好，因为有时您会想要允许`false`值。例如，以下代码将*永远*不允许`false`传入值：

```
perex = local_assigns[:perex] || true 
```

# iphone - 如何将 nib (.xib) 文件与 UIView 关联？

> ID：238620
> 
> 赞同：20
> 
> 时间：2008-10-26T21:04:06.497
> 
> 标签：iphone

我有一个 UIView 的子类“s”。我想在 s 上放一些按钮和标签。如何将我的 UIView 子类与 nib 文件相关联？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-26T23:43:10.997

1.  在 Interface Builder 中，使用 View 模板创建一个新的 xib。
    *   单击 xib 中对象列表中的视图（您还应该看到“文件的所有者”和“第一响应者”）。
    *   按 Cmd-4 打开检查器的身份窗格。
    *   在“班级名称”字段中输入您的班级名称并按回车键。

您应该能够拖动按钮。要从代码中获取 nib，请使用`-[NSBundle loadNibNamed:owner:options:]`. 您的视图应该是返回数组中的第一个对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-09-11T17:54:31.513

就我而言，我不希望我的视图控制器从我的视图的 .xib 中获得任何关于 IBOutlets 的知识。我希望我的视图子类拥有 IBOutlets。不幸的是 UIView 没有`initWithNibName:`方法，所以我只是创建了自己的类别。

这是我所做的：

*   在 IB 中，单击您的主 UIView，然后在 Identity Inspector 中，将类设置为您的子类
*   在 IB 中，单击 File's Owner，然后在 Identity Inspector 中，将类设置为您的子类
*   使用您的新类别方法`initWithNibName:`来实例化您的视图。

这是我创建的类别：

```
- (instancetype)initWithNibName:(NSString *)nibName
{
    NSArray *arrayOfViews = [[NSBundle mainBundle] loadNibNamed:nibName owner:self options:nil];
    if (arrayOfViews.count < 1) {
        return nil;
    }

    self = arrayOfViews[0];

    return self;
} 
```

受[这篇文章的](http://answers.oreilly.com/topic/2578-loading-a-nib-file-programmatically-objective-c/)启发。

但请注意，到目前为止，框架会自动调整，因此与帖子中的代码不同，我还没有明确设置框架。此外，与帖子的代码不同，我需要进行设置`owner:self`，以便正确连接 IBOutlets。

# visual-studio - Microsoft.ACE.OLEDB.12.0 提供程序未注册

> ID：238625
> 
> 赞同：68
> 
> 时间：2008-10-26T21:05:00.600
> 
> 标签：visual-studio, ms-access, ado.net, oledb

我有一个带有两个项目（一个 Word 模板项目和一个用于测试的 VB.Net 控制台应用程序）的 Visual Studio 2008 解决方案。这两个项目都引用了一个数据库项目，该项目打开了与 MS-Access 2007 数据库文件的连接，并引用了 System.Data.OleDb。在数据库项目中，我有一个检索数据表的函数，如下所示

```
 private class AdminDatabase
   ' stores the connection string which is set in the New() method
   dim strAdminConnection as string

   public sub New()
   ...
   adminName = dlgopen.FileName
   conAdminDB = New OleDbConnection
   conAdminDB.ConnectionString = "Data Source='" + adminName + "';" + _
       "Provider=Microsoft.ACE.OLEDB.12.0"

   ' store the connection string in strAdminConnection
   strAdminConnection = conAdminDB.ConnectionString.ToString()
   My.Settings.SetUserOverride("AdminConnectionString", strAdminConnection)
   ...
   End Sub

   ' retrieves data from the database
   Public Function getDataTable(ByVal sqlStatement As String) As DataTable
        Dim ds As New DataSet
        Dim dt As New DataTable
        Dim da As New OleDbDataAdapter
        Dim localCon As New OleDbConnection

        localCon.ConnectionString = strAdminConnection

        Using localCon
            Dim command As OleDbCommand = localCon.CreateCommand()
            command.CommandText = sqlStatement
            localCon.Open()
            da.SelectCommand = command
            da.Fill(dt)
            getDataTable = dt
        End Using

    End Function
End Class 
```

当我从我的 Word 2007 模板项目中调用此函数时，一切正常；没有错误。但是当我从控制台应用程序运行它时，它会抛出以下异常

> ex = {"'Microsoft.ACE.OLEDB.12.0' 提供程序未在本地计算机上注册。"}

这两个项目具有相同的引用，并且当我第一次编写控制台应用程序时（不久前）它确实可以工作，但现在它已经停止工作。我一定错过了什么，但我不知道是什么。有任何想法吗？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2010-04-15T20:11:13.417

基本上，如果您使用的是 64 位计算机，则 IIS 7 不会（默认情况下）为数据库引擎运行的 32 位应用程序提供服务。所以这正是你所做的：

1) 确保已安装 2007 数据库引擎，可在以下网址下载： [http ://www.microsoft.com/downloads/details.aspx?FamilyID=7554F536-8C28-4598-9B72-EF94E038C891&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=7554F536-8C28-4598-9B72-EF94E038C891&displaylang=en)

2）打开IIS7管理器，打开Application Pools区域。在右侧边栏中，您将看到一个选项，上面写着“设置应用程序池默认值”。单击它，将弹出一个带有选项的窗口。

3) 第二个字段，表示“启用 32 位应用程序”可能默认设置为 FALSE。只需单击显示“假”的位置即可将其更改为“真”。

4）重新启动您的应用程序池（您可以通过点击 RECYCLE 而不是 STOP 然后 START 来做到这一点，这也可以）。

5）完成，您的错误消息将消失。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2009-01-26T03:45:22.880

我有一个带有 Visual Studio 2008 的 Visual Basic 程序，它使用 Access 2007 数据库并收到相同的错误。如果您运行的是 64 位系统，我发现一些线程建议在程序属性中将高级编译配置更改为 x86。到目前为止，我的程序没有任何问题。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-26T22:19:58.000

您是否运行 64 位系统，数据库运行 32 位，但控制台运行 64 位？没有运行 64 位的 MS Access 驱动程序并且会报告与您报告的错误相同的错误。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-12-12T16:55:44.687

* * *

**解决方案：**

就是这样！感谢 Arjun Paudel 提供的链接。这是在 XNA Creator's Club Online 上找到的解决方案。这是斯蒂芬·斯蒂尔查克的作品。

以下错误提示我相信您正在为 64 位编译：

> 'Microsoft .ACE.OELDB.12.0' 提供程序未在本地计算机上注册

我没有快递版，但以下步骤在 2008 年快递中是否有效？

[http://forums.xna.com/forums/t/4377.aspx#22601](http://forums.xna.com/forums/t/4377.aspx#22601)

[http://social.msdn.microsoft.com/Forums/en-US/vbgeneral/thread/ed374d4f-5677-41cb-bfe0-198e68810805/?prof=required](http://social.msdn.microsoft.com/Forums/en-US/vbgeneral/thread/ed374d4f-5677-41cb-bfe0-198e68810805/?prof=required)
- Arjun Paudel

* * *

在`VC# Express`中，缺少此属性，但如果您知道在哪里查找，您仍然可以创建 x86 配置。

它看起来像一长串步骤，但是一旦你知道这些东西在哪里，它就会容易得多。任何只有拥有的`VC# Express`人可能会发现这很有用。一旦你知道了`Configuration Manager`，下次它会更加直观。

1.在 VC# Express 2005 中，转到`Tools -> Options`.
2.在“选项”对话框的左下角，选中显示为 的框`"Show all settings"`。
3.在左侧的树视图中，选择`"Projects and Solutions"`。
4.在右侧的选项中，选中显示`"Show advanced build configuraions."`
5.Click的框`OK`。
6.转到`Build -> Configuration Manager`...
7.在项目旁边的平台列中，单击组合框并选择`"<New...>"`。
8.在`"New platform" setting, choose "x86"`.
9\. 单击`OK`。
10.单击`Close`。
在那里，现在您有了 x86 配置！非常简单！:-)

我还建议使用`Configuration Manager`删除 Any CPU 平台。如果您曾经依赖于 32 位本机 DLL（甚至是间接依赖），您真的不希望这样。

斯蒂芬·斯蒂尔查克 | XNA 游戏工作室开发者 [http://forums.xna.com/forums/p/4377/22601.aspx#22601](http://forums.xna.com/forums/p/4377/22601.aspx#22601)

* * *

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-01-29T12:36:57.557

我想我会插话，因为我在面临稍微不同的问题背景时发现了这个问题，并认为它可能会在未来帮助其他受折磨的灵魂：

我有一个托管在 IIS 7.0 上的 ASP.NET 应用程序，该应用程序在 Windows Server 2008 64 位上运行。

由于 IIS 控制进程位数，因此我的解决方案是将 Enable32bitAppOnWin64 设置设置为 true：http: [//blogs.msdn.com/vijaysk/archive/2009/03/06/iis-7-tip- 2-you-can-now-run-32-bit-and-64-bit-applications-on-the-same-server.aspx](http://blogs.msdn.com/vijaysk/archive/2009/03/06/iis-7-tip-2-you-can-now-run-32-bit-and-64-bit-applications-on-the-same-server.aspx)

它在 IIS 6.0 中的工作方式略有不同（您不能在应用程序池级别设置 Enable32bitAppOnWin64） [http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/0aafb9a0-1b1c-4a39-ac9a-994adc902485.mspx？出厂=真](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/0aafb9a0-1b1c-4a39-ac9a-994adc902485.mspx?mfr=true)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-14T02:42:00.150

我有同样的问题。我尝试在 Windows 7 64 位上安装 Office 2010 64 位，然后安装 2007 Office 系统驱动程序：数据连接组件。

之后，Visual Studio 2008 可以打开与 MS-Access 2007 数据库文件的连接。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-01-30T11:52:50.090

请参阅我在类似 Stack Exchange 线程上的帖子[https://stackoverflow.com/a/21455677/1368849](https://stackoverflow.com/a/21455677/1368849)

我安装了 15 版，而不是 12 版，这是我通过运行此 PowerShell 代码发现的...

```
(New-Object system.data.oledb.oledbenumerator).GetElements() | select SOURCES_NAME, SOURCES_DESCRIPTION 
```

...这给了我这个结果（为简洁起见，我删除了其他数据源）...

```
SOURCES_NAME              SOURCES_DESCRIPTION                                                                       
------------              -------------------                                                                       
Microsoft.ACE.OLEDB.15.0  Microsoft Office 15.0 Access Database Engine OLE DB Provider 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-04-26T10:18:07.930

我在完全更新的 Windows Vista Family 64bit 上遇到了同样的错误，它带有一个仅编译为 32 位的 .NET 应用程序——该程序安装在 64 位机器上的 programx86 文件夹中。即使安装了 2007 访问数据库提供程序，安装了/未安装相同的 SP2，安装了 IIS 并设置了用于 32 位应用程序支持的应用程序池，它也会失败并显示此错误消息......是的，我已经尝试了所有解决方案，但仍然没有成功。

我将我的应用程序切换到 ACE OLE DB.12.0，因为 JET4.0 在 64 位机器上失败了——而且没有更好的：-/ 我发现的最有希望的线程是这样的：

[http://ellisweb.net/2010/01/connecting-to-excel-and-access-files-using-net-on-a-64-bit-server/](http://ellisweb.net/2010/01/connecting-to-excel-and-access-files-using-net-on-a-64-bit-server/)

但是当您尝试安装 64 位“2010 Office System Driver Beta: Data Connectivity Components”时，它会告诉您，如果不卸载所有 32 位办公应用程序，则无法安装 64 位版本...并安装 2010 的 32 位版本Office System 驱动程序测试版：数据连接组件不能解决最初的问题，即使使用“Microsoft.ACE.OLEDB.12.0”作为提供程序，而不是该页面（和其他人）推荐的“Microsoft.ACE.OLEDB.14.0”。

我的下一次尝试将是关注这篇文章：

问题是由于在服务器上注册的 OLEDB32.DLL 和 OLEDB32r.DLL 的风格错误。如果注册了 64 位版本，则需要取消注册，然后注册 32 位版本。要解决此问题，请取消注册位于 %Program Files%/Common Files/System/OLE DB 中的版本。然后在同一路径但在 %Program Files (x86)% 目录中注册版本。

有没有其他人在 64 位机器上同时使用 JET4.0 和 OLEDB ACE 提供程序时遇到这么多麻烦？如果其他人都不起作用，有没有人找到解决方案？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-02-10T15:23:49.600

我假设如果您正在运行带有 32 位数据库的 64 位系统并尝试运行 64 位控制台，则需要在机器上安装以下软件包。

1.  安装 Microsoft Access 数据库引擎 2010 x86 Redistributable，此安装位于：http: [//www.microsoft.com/download/en/details.aspx?id=13255](http://www.microsoft.com/download/en/details.aspx?id=13255)。
2.  Office 2007 的数据连接组件，此安装位于：http: [//www.microsoft.com/download/en/confirmation.aspx?id=23734](http://www.microsoft.com/download/en/confirmation.aspx?id=23734)。
3.  Microsoft Access Database Engine 2010 x64 Redistributable. You will need to download the package locally and run it with a passive flag. You can download the installation here: [http://www.microsoft.com/en-us/download/details.aspx?id=13255](http://www.microsoft.com/en-us/download/details.aspx?id=13255) Installing using the command prompt with the '/passive' flag. In the command prompt run the following command: 'AccessDatabaseEngine_x64.exe /passive'

Note: The order seems to matter - so if you have anything installed already, uninstall and follow the steps above.

# winapi - Pktextract.exe 安装在哪里？

> ID：238631
> 
> 赞同：1
> 
> 时间：2008-10-26T21:08:11.343
> 
> 标签：winapi, sxs

我安装了 Visual Studio 2008 和适用于 Windows Server 2008 和 .NET Framework 3.5 的 Windows SDK。我相信那是最新的平台SDK。

我正在尝试构建一个签名的 dll 以安装在 SxS 中。所有教程都解释了使用名为 pktextract.exe 的工具，它是 SDK 的一部分，但我似乎找不到该工具。所有其他工具，如 makecert、mt、makecat 都存在。

pktextract 是否被最新版本的 sdk 中的其他工具取代？

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-26T21:16:08.673

应该是[Platform SDK](http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm)的一部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T22:21:42.783

我最终从 Visual Studio 2005 安装中获得它，它位于 ...\common\tools\bin 下

我想知道为什么它被删除了。也许MS只是忘记了它？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-25T15:50:54.187

使用 VS2008，您可以使用 sn -T 从程序集中提取公钥令牌，或者使用 sn -p 和 sn -t 的组合从 pfx 中提取一个。

# java - Websphere 从哪里获得 WSDL？

> ID：238643
> 
> 赞同：0
> 
> 时间：2008-10-26T21:16:56.580
> 
> 标签：java, web-services, wsdl, websphere

我有一个使用 Axis 发布 Web 服务的 java 应用程序。

在最新版本中，WSDL 中的一种服务方法是错误的。它有一个复杂类型的字段，带有双精度而不是双精度数组。

我检查了 src WSDL 和生成的类，如数据对象和绑定存根，但它们都是正确的。

但是，当我浏览到 WSDL 时，情况就不同了。

我可以看到其他差异。例如，源只是具有序列的复杂类型，其中已发布版本扩展了抽象基础。

那么，Websphere 是否从中获得了其他 WSDL？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-27T16:07:28.173

我希望 WSDL 是使用 Axis Java2WSDL 工具自动生成的。我相信您可以选择关闭自动生成或添加一些指令来生成您喜欢的那种 WSDL。

# vb.net - VB.NET 我如何皮肤一个 vb.net 应用程序

> ID：238650
> 
> 赞同：2
> 
> 时间：2008-10-26T21:22:46.117
> 
> 标签：vb.net, skinning, skin

我想为我制作的一个 vb.net 应用程序换肤，我用谷歌搜索了一些东西，我已经看到了换肤的 vb.net 应用程序。

然而，似乎任何时候我都试图找到有人解释它是一个付费产品的链接。

有人对此有什么有用的吗？

* * *

我已经看到了一些以编程方式执行此操作的免费方法，我似乎无法将其完全转换为我自己独特的程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T11:34:22.263

我记得在我还是学生的时候（可能是 6 年前）制作了一个“可换肤”的 vb.net winforms 应用程序（媒体播放器）。

这很丑陋，但我这样做的方式如下：

1.  选择透明度颜色。无论你在哪里使用这种颜色，应用程序都是透明的（我使用的是 Fuchsia (#FF00FF)，我记得它是当时视频游戏的标准。

2.  对子控件（特定按钮、滑块等）使用命名约定。

3.  为步骤 2 中的控件创建图像。

4.  为这些控件设置 1 个像素宽的彩色涂层占位符。例如，蓝色像素是我的播放按钮，绿色像素是我的暂停按钮，等等。占位符标记了控件的左上角。

5.  在运行时动态生成控件（实际上是带有 onclick 事件的图像）并将它们放在占位符的顶部。

我确信有更好的方法来做到这一点，但那是我粗鲁的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-16T21:35:14.293

我更像是一个业余爱好者，但你可以这样做：创建一个必须用 winform 和“设置文件”路径初始化的类。从构造函数：

1.  读入一个设置文件（我只是用 XML 编一些东西）
2.  循环遍历所述winform上的所有控件并应用所述设置文件指定的前/后颜色、图片、不透明度等。
3.  只需以所有形式实例化该类。

可能是更好的方法，但这几乎就是我上次做的事情。通常我为每种类型的控件、文本框、组合框等指定一个“样式”，然后通过使用标签的控件属性来考虑特殊情况。

不确定这有多大帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T01:04:18.230

不幸的是，VB.NET 没有提供开箱即用的“剥皮”功能。它只是使用标准的 windows 界面。当您更改显示属性时，只会对 UI 进行更改。

我不知道提供皮肤功能的开源项目，但是我使用了许多商业产品。到目前为止，我使用过的最好的应用程序样式框架之一是 Infragistics在[NET Advantage中找到的应用程序样式框架。](http://www.infragistics.com/dotnet/netadvantage.aspx#Overview)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T11:08:14.687

正如之前的答案所述，香草 VB 很难做到这一点，但有一个免费的替代方案（仍然在 VB 中）。不幸的是，这将涉及您学习很多东西并重写您的应用程序以使用 WPF（Windows Presentation Foundation）。

简而言之，WPF 是 WinForms（您现在可能正在使用）的替代品。主要区别在于 WPF 是基于矢量且独立于分辨率的，而 WinForms 是基于位图的。WPF 的输出看起来很棒，但要学习的东西很多。

您可以轻松地为 WPF 应用程序设置皮肤，Microsoft 示例也向您展示了如何执行此操作。使用 WPF 可能会限制您可以安装的系统，因为它需要 .Net 3.0（如果可以，最好使用 3.0 SP1 或 3.5 SP1）。

WPF 和皮肤的快速谷歌显示了很多希望。

瑞安

# vb.net - VB.NET WMI 还是 WQL？帮助

> ID：238653
> 
> 赞同：0
> 
> 时间：2008-10-26T21:24:52.277
> 
> 标签：vb.net

我有一个应用程序，当它第一次启动时，我需要它来运行数据库查询。

我有所有的数据库查询，但是表单都是通过这种方法加载的。

将 myfrm 调暗为新的 Form2 myfrm.show。

问题是如果这个应用程序已经崩溃等我需要确保它是这个程序的第一次初始启动

有没有人有任何想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-26T22:28:57.013

放置一个带有版本列的 App 表，如果您想要更多粒度，可以使用 step。如果表不存在，则您处于第一个版本，然后继续...在完成所有查询后，将一个版本放入表中。这样，您将能够检查这些查询是否已运行。

# iphone - 如何在两个以上的 UIView 之间做翻转动画？

> ID：238654
> 
> 赞同：5
> 
> 时间：2008-10-26T21:25:38.670
> 
> 标签：iphone, objective-c, cocoa-touch

我在扩展 UIView 的类中有动画代码：

```
// Start Animation Block
CGContextRef context = UIGraphicsGetCurrentContext();
[UIView beginAnimations:nil context:context];
[UIView setAnimationTransition: UIViewAnimationTransitionFlipFromLeft forView:[self superview] cache:YES];
[UIView setAnimationCurve:UIViewAnimationCurveEaseInOut];
[UIView setAnimationDuration:1.0];

//int nextView = currentView + 1;
// Animations
[[self superview] exchangeSubviewAtIndex:0 withSubviewAtIndex:1];
//And so I would do: [[self superview exchangeSubviewAtIndex:currentView withSubviewAtIndex:nextView];
//Doesn't work because curentView is not global... with each instance of a class it's reset to what it's instanciated to. 
//currentView++;

// Commit Animation Block
[UIView commitAnimations]; 
```

此动画代码适用于两个视图。但我试图为许多观点这样做。我尝试通过添加一个全局变量（nextview 索引和 currentView 索引），但这不起作用，因为每个自定义视图类都有它自己的实例并且这些变量不共享。

有谁知道我怎样才能完成我想做的事情？

谢谢！

编辑：如果我可以使用 [self superview] 访问当前视图和下一个视图的索引，我将能够做到这一点。有一些方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-26T23:02:35.230

Apple 有一个很好的关于视图转换的[教程](https://developer.apple.com/iphone/library/samplecode/ViewTransitions/index.html)。除了他们实现它们的方式之外，您还可以查看使用 UINavigationController 来管理一堆视图并在它们之间进行转换。

本质上，您需要在超级视图而不是视图中管理转换 - 超级视图可以知道它当前正在显示谁以及下一个是谁。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T21:49:21.290

如果您有指向要在它们之间切换的视图的指针，只需在“from”视图上调用 -removeFromSuperview 并在 superview 上调用 -addSubview:(“to”视图)。转换不依赖于任何特定的方法调用；或多或少任何形式的“交换两个视图”方法都将被适当地动画化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-04T17:45:18.797

对于那些发现这个问题并且支持 iOS 4.0 及更高版本的人，Apple 已为此任务提供了一个内置 API：

请参阅：[transitionFromView:toView:duration:options:completion:](https://developer.apple.com/library/ios/#documentation/uikit/reference/UIView_Class/UIView/UIView.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T21:35:47.247

我认为链接列表可能是您应该考虑实施的。

# c# - 两个'uint'的差异

> ID：238660
> 
> 赞同：12
> 
> 时间：2008-10-26T21:28:23.203
> 
> 标签：c#, .net

当您尝试在 C#.NET 中使用超出其值范围的值声明无符号变量时，它会被标记为编译器错误，但如果您在运行时产生负值并在运行时将其分配给该变量，则值会换行。

```
uint z = -1; // Will not compile

uint a = 5;
uint b = 6;
uint c = a - b; // Will result in uint.MaxValue 
```

无符号变量在这种情况下包装而不是抛出异常是否有充分的理由？

谢谢。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-26T21:35:18.493

在 C# 中声明未分配的变量不会标记为错误 - 尝试将无效值分配给变量是。例如，这是一个在声明后未明确分配（假设它是本地的）的变量：

```
uint z; 
```

-1 不是超过 0.5 的 uint 的有效值，这就是您的示例无法编译的原因。

现在，至于其余的：整数类型只是在溢出时换行——就像在 return 中加 1`int.MaxValue`一样`int.MinValue`。与让程序检查每个操作是否溢出相比，这是一个显着的性能改进——代价是可能没有发现错误。

仅当您处于未检查的上下文中时，请注意 - 如果您在已检查的上下文中执行任何这些操作，您将得到一个异常。例如;

```
class Test
{
    static void Main()
    {
        checked
        {
            uint a = 5;
            uint b = 6;
            uint c = a - b;
        }
    }
} 
```

运行它，你会看到一个`OverflowException`被抛出。如果这是您对整个项目的要求，您可以在项目属性中设置它（或使用`/checked+`命令行选项编译为`csc`.）

编辑：值得注意的是，其他答案表明您可以在检查的上下文中放置少量代码 - 只是声明和分配，`c`甚至只是计算。这一切都非常灵活。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-26T21:37:41.767

包装是因为 dfault C# 未选中。如果添加“已检查”块，则会检测到溢出：

```
 uint a = 3, b = 4;
    checked
    {
       uint c = a - b; // throws an overflow
    } 
```

至于编译器：它只需要有效数据。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-26T21:44:18.570

这只是默认设置 - 您可以更改编译设置以启用运行时算术溢出检查。如果你打开它，异常将如你所料抛出。或者，您可以通过将特定操作放置在选中的块中来打开检查特定操作。

```
uint c = checked(a - b); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T22:04:36.440

在这里可能值得澄清的是，它`uint`是一个*无符号*整数，而不是一个*未分配*的整数。巨大差距！

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-04T17:47:40.363

它包装为负数的原因是用于整数算术的二进制 [补码数学。](http://en.wikipedia.org/wiki/Two%27s_complement)

简短的回答是最高有效位用作符号。零是正数；一个是负数。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2010-05-26T15:30:32.607

始终使用双倍。性能差异微不足道，而且更加灵活和包容。这种做法可以防止异常并减少开发时间。肛门的人虽然讨厌它。

# linq - 挑战：优雅地 LINQify 这段程序代码

> ID：238662
> 
> 赞同：1
> 
> 时间：2008-10-26T21:32:47.750
> 
> 标签：linq, linq-to-objects

```
string[] filesOfType1 = GetFileList1();
string[] filesOfType2 = GetFileList2();
var cookieMap = new Dictionary<string, CookieContainer>();

Action<string, Func<string, KeyValuePair<string, CookieContainer>>> addToMap = (filename, pairGetter) =>
    {
        KeyValuePair<string, CookieContainer> cookiePair;
        try
        {
            cookiePair = pairGetter(filename);
        }
        catch
        {
            Console.WriteLine("An error was encountered while trying to read " + file + ".");
            return;
        }

        if (cookieMap.ContainsKey(cookiePair.Key))
        {
            if (cookiePair.Value.Count > cookieMap[cookiePair.Key].Count)
            {
                cookieMap[cookiePair.Key] = cookiePair.Value;
            }
        }
        else
        {
            cookieMap.Add(cookiePair.Key, cookiePair.Value);
        }
    };

foreach (string file in filesOfType1)
{
    addToMap(file, GetType1FileCookiePair);
}
foreach (string file in filesOfType2)
{
    addToMap(file, GetType2FileCookiePair);
} 
```

必须保留的显着特征：

*   类型 1 的文件比类型 2 的文件更重要；即，如果类型 1 的文件映射到 (key, value1) 组合，类型 2 的文件映射到 (key, value2) 组合，那么我们将 (key, value1) 添加到 cookieMap 而*不是*(key, value2)。**编辑：正如 Bevan 所指出的，我原来的程序代码对此并不满意。**
*   其次，具有更高优先级`CookieContainer`的 s`Count`具有更高的优先级，即如果同一键有两个（键，值）组合并且都来自相同的文件类型，我们选择具有更高的一个`value.Count`。
*   每个案例的异常处理是必须的；搞砸一个文件阅读应该只是让我们注意到这一点并继续。

我最好的尝试是这样开始的：

```
var cookieMap = (filesOfType1.Select(file => GetType1FileCookiePair(file))
                .Concat(filesOfType2.Select(file => GetType2FileCookiePair(file))))
                    .GroupBy(pair => pair.Key)
                    .Select(/* some way of selecting per the above bullets */)
                    .ToDictionary(pair => pair.Key, pair => pair.Value); 
```

但这很不雅，并且填写该评论块似乎是个婊子。现在我很高兴保持程序化，但我认为看看人们是否能想出一些非常聪明的东西可能是一个有趣的挑战。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T08:25:17.277

这是我的尝试 - 将任务分成三个不同的陈述似乎最简单。

我正在使用一个辅助函数，如果操作引发异常，则返回 null - 为了与 Omer van Kloeten 的答案保持一致，我称之为 Swallow()

另外，我没有使用 LINQ 语法，只是 System.Linq.Enumerable 提供的扩展方法

最后，请注意这是未编译的 - 所以将其视为意图。

```
// Handle all files of type 1
var pairsOfType1 = 
    filesOfType1
        .Select( file => Swallow( pairGetter(file)))
        .Where( pair => pair != null);

// Handle files of type 2 and filter out those with keys already provided by type 1
var pairsOfType2 =
    filesOfType2
        .Select( file => Swallow( pairGetter(file)))
        .Where( pair => pair != null);
        .Where( pair => !pairsOfType1.Contains(p => p.Key == pair.Key));

// Merge the two sets, keeping only the pairs with the highest count
var cookies =
    pairsOfType1
        .Union( pairsOfType2)
        .GroupBy( pair => pair.Key)
        .Select( group => group.OrderBy( pair => pair.Value.Count).Last());
        .ToDictionary( pair => pair.Key); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T00:38:52.273

```
using CookiePair = KeyValuePair<string, CookieContainer>;
using CookieDictionary = Dictionary<string, CookieContainer>;

Func<string[], Func<string, CookiePair>, IEnumerable<CookiePair>> getCookies =
  ( files, pairGetter ) =>
    files.SelectMany( filename => {
      try { return new[] { pairGetter( filename ) }; }
      catch { Console.WriteLine( "..." ); return new CookiePair[0]; }
    } );

var type1Cookies = getCookies( filesOfType1, GetType1FileCookiePair ).ToArray( );
var type1CookieNames = type1Cookies.Select( p => p.Key ).ToArray( );
var type2Cookies = getCookies( filesOfType2, GetType2FileCookiePair )
  .Where( p => !type1CookieNames.Contains( p.Key ) );

var cookieMap = type1Cookies.Concat( type2Cookies )
  .Aggregate( new CookieDictionary( ), ( d, p ) => {
    if( !d.ContainsKey( p.Key ) || p.Value.Count > d[p.Key].Count )
      d[p.Key] = p.Value;
    return d;
  } ); 
```

**编辑：**更新 cookie 检索以满足“类型 1 的文件比类型 2 的文件更重要”的要求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T22:36:24.613

请原谅我实际上并没有继续编译它，但这是我要做的方式：

```
var cookieMap = (from pair in
                     (from f1 in filesOfType1
                      select Swallow(() => GetType1FileCookiePair(f1)))
                         .Concat(from f2 in filesOfType2
                                 select Swallow(() => GetType2FileCookiePair(f2)))
                         .SelectMany(dict => dict)
                 group pair by pair.Key into g
                 select g)
                .ToDictionary(g => g.Key, g => g.Select(pair => pair.Value)
                                                .OrderByDescending(value => value.Count)
                                                .First()); 
```

`Swallow`如下：

```
private static T Swallow<T>(Func<T> getT)
{
    try { return getT(); } catch { }

    return default(T);
} 
```

爱我一个好的LINQ。

*   **编辑：**添加了一个`Swallow`可以吞下所有异常的方法。
*   **编辑 2：**编译、更改等。添加`Swallow`. 现在按预期工作。

# .net - 将依赖注入到 Linq to Sql

> ID：238665
> 
> 赞同：1
> 
> 时间：2008-10-26T21:34:11.553
> 
> 标签：.net, linq-to-sql, dependency-injection

是否有将依赖项注入到 Linq to Sql 或实体框架实体的机制？如果是这样，这将是一个明智的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T22:29:39.150

对不起，我不清楚。我希望能够注入服务，例如。IEmailer 使用许多依赖注入框架之一进入 linq to sql 实体，例如。温莎之春、统一等

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T21:50:00.430

你到底在追求什么？请注意，您可以使用不带属性的 LINQ-to-SQL，如果您想使用现有类...您需要使用[外部 xml 文件](http://msdn.microsoft.com/en-us/library/bb386907.aspx)来保存映射，并使用[`XmlMappingSource`](http://msdn.microsoft.com/en-us/library/system.data.linq.mapping.xmlmappingsource.aspx).

请注意，这不适用于实体框架；仅 LINQ-to-SQL。

# language-agnostic - 专有系统文档“泄漏”以及如何阻止它们？

> ID：238668
> 
> 赞同：2
> 
> 时间：2008-10-26T21:35:07.590
> 
> 标签：language-agnostic

> 在声称 Andrew Tridgell 对 BitKeeper 协议进行逆向工程，违反了 BitKeeper 许可后，版权所有者 Larry McVoy 撤回了免费使用 BitKeeper 的能力。在 Linux.Conf.Au 2005 上，Tridgell 在他的主题演讲中展示了他使用的逆向工程过程只是简单地远程登录到 BitKeeper 服务器的适当端口并输入“帮助”。
> 
> -- [关于 Git 的维基百科]( [http://en.wikipedia.org/wiki/Git_(software)#Early_history)](http://en.wikipedia.org/wiki/Git_(software)#Early_history))

有时这并不总是有人泄露您的文档或源代码的问题，而是有人不记得删除一两个实用程序函数的问题。你有什么样的流程和程序来阻止这些“泄漏”通过？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-26T21:45:55.290

不是一开始就创建它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T22:10:30.000

我认为您不能简单地避免专有文档，但我认为您应该清楚地标记它。

您为内部目的编写的任何代码都应该是单独项目的一部分，并且也应该明确标识。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T22:12:43.350

不要试图阻止第三方技术与您的技术兼容。

说真的，如果你没有信心让第三方进行兼容的替换，那么首先考虑一下是否有很多人会发现你的产品很有价值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T16:26:08.790

这涉及到一个相关主题，您可以在其中“暂时”注释掉事物。

在编码时有一个过程来保护你免受这种情况的影响是很重要的。

*   在进行“**临时**”更改时，请确保对它们进行注释以便找到它们。单元测试在这里非常好。
*   Make sure the infrastructure is intelligent enough so that you can have different types of builds. You don't want to always remember to disable certain things for a certain type of build. Remove any possibility for human error as soon as you know you're creating them. (At least create a ticket for it.)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-26T22:09:29.067

对它们非常小心，并确保只有合适的人才能获得正确的文档（这包括确保管理层不会掌握专有文档）。

我正在为客户定制我的公司编写的一些专有软件（这些软件依赖于默默无闻的安全性）。我确保创建了两个版本的文档，一个完整的自定义技术设计文档，另一个删除了“安全”位以与客户共享。我犯了一个错误，将它提供给管理层，他们与客户分享了它。

幸运的是，客户并没有说什么（他们问了一些问题，但并没有大惊小怪，我猜他们已经习惯了我公司软件的质量；））。

# vb.net - 线程管理器

> ID：238675
> 
> 赞同：0
> 
> 时间：2008-10-26T21:39:31.980
> 
> 标签：vb.net, multithreading

我正在寻找为应用程序构建线程管理器。

我已经开始线程化，它工作得很好，但我希望能够以编程方式杀死它们或获取关于它们的信息。

有人有想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T21:44:36.137

只是一个简短的警告：不要使用`Thread.Abort`，除非你真的关闭了整个应用程序（或者你从你正在中止的线程中调用它，在这种情况下你知道线程当时在做什么）。如果您真的希望能够“杀死”线程，我建议您使用相当“软”的杀死 - 设置一个标志，并确保您定期从线程内测试该标志。

我的线程教程的一部分讨论[了干净地关闭线程](http://www.yoda.arachsys.com/csharp/threads/shutdown.shtml)- 你可能会发现它很有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T03:40:21.783

您可能会查看`Thread.ThreadState`, `Thread.Interrupt()`, and `Thread.Abort()`（正如 Jon Skeet 指出的，这不是停止线程的首选方式）。

对于应用程序中运行的所有线程的集合，请使用

`System.Diagnostics.Process.GetCurrentProcess().Threads`.

有关更多信息，您可以查看[线程监视器的这个示例](http://www.codeproject.com/KB/dotnet/threadmonitor.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T21:45:09.800

严厉地杀死线程：不是一个好主意。您应该几乎总是与线程通信（即使是简单的 volatile 位标志也可以），然后让线程自杀。杀死它是非常危险的，并且可能会在物体上留下锁等。

对于更一般的情况 - 您听说过[并行扩展](http://blogs.msdn.com/pfxteam/)吗？.NET 4.0 计划了一个全新级别的线程管理，包括并行 LINQ 扩展等。

# ruby - 从 Ruby 中的 DateTime 中减去 n 小时

> ID：238684
> 
> 赞同：48
> 
> 时间：2008-10-26T21:46:25.697
> 
> 标签：ruby, datetime, subtraction, hour

我有一个从表格中填写的 Ruby DateTime。此外，我也有 n 小时的时间。我想从之前的 DateTime 中减去这 n 个小时。（获取时间范围）。

DateTime 有两种方法“-”和“<<”来减去日和月，但不能减去小时。（[API](https://ruby-doc.org/stdlib-2.5.1/libdoc/date/rdoc/DateTime.html)）。有什么建议我该怎么做？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-10-27T04:57:57.993

你可以这样做。

```
adjusted_datetime = (datetime_from_form.to_time - n.hours).to_datetime 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-12-05T13:40:17.163

你可以减去不到一整天：

```
two_hours_ago = DateTime.now - (2/24.0) 
```

这适用于几分钟和其他任何东西：

```
hours = 10
minutes = 5
seconds = 64

hours = DateTime.now - (hours/24.0) #<DateTime: 2015-03-11T07:27:17+02:00 ((2457093j,19637s,608393383n),+7200s,2299161j)>
minutes = DateTime.now - (minutes/1440.0) #<DateTime: 2015-03-11T17:22:17+02:00 ((2457093j,55337s,614303598n),+7200s,2299161j)>
seconds = DateTime.now - (seconds/86400.0) #<DateTime: 2015-03-11T17:26:14+02:00 ((2457093j,55574s,785701811n),+7200s,2299161j)> 
```

如果浮点算术不准确是一个问题，您可以使用`Rational`或其他一些安全的算术实用程序。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2011-05-16T00:14:49.373

如果您想更明确地了解此类行为，advance 方法很好。

```
adjusted = time_from_form.advance(:hours => -n) 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2015-07-16T07:03:04.603

你只需要离开一天的一小部分。

```
two_hours_ago = DateTime.now - (2.0/24) 
```

*   1.0 = 一天
*   1.0/24 = 1 小时
*   1.0/(24*60) = 1 分钟
*   1.0/(24*60*60) = 1 秒

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-08-13T20:30:53.163

`n/24.0`技巧将无法正常工作，因为浮点数最终会四舍五入：

```
>> DateTime.parse('2009-06-04 02:00:00').step(DateTime.parse('2009-06-04 05:00:00'),1.0/24){|d| puts d}
2009-06-04T02:00:00+00:00
2009-06-04T03:00:00+00:00
2009-06-04T03:59:59+00:00
2009-06-04T04:59:59+00:00 
```

但是，您可以改用 Rational 类：

```
>> DateTime.parse('2009-06-04 02:00:00').step(DateTime.parse('2009-06-04 05:00:00'),Rational(1,24)){|d| puts d}
2009-06-04T02:00:00+00:00
2009-06-04T03:00:00+00:00
2009-06-04T04:00:00+00:00
2009-06-04T05:00:00+00:00 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-26T21:52:36.947

如果您在*Rails*中工作，则存在以下超级直观的可能性：

```
> Time.now - 12.hours
=> 2019-08-19 05:50:43 +0200 
```

（这也适用于*seconds*、*minutes*、*days*和*years*）

如果您只使用 Ruby，`DateTime`则不能这样做，但`Time`可以：

```
t = Time.now
t = t - (hours*60**2) 
```

请注意，`Time`它还存储日期信息，这有点奇怪。

如果您必须与`DateTime`

```
DateTime.commercial(date.year,date.month,date.day,date.hour-x,date.minute,date.second) 
```

可能有效，但很难看。医生说`DateTime`是不可变的，所以我什至不确定`-`和`<<`

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-27T00:00:23.333

你没有说你需要如何利用你获得的价值，但是将你的小时数除以 24 这样你就减去了一天的一小部分呢？

```
mydatetime = DateTime.parse(formvalue)
nhoursbefore = mydatetime - n / 24.0 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-26T22:27:21.870

**编辑**：在您决定使用我在这里概述的方法之前，请先看看[这个问题。](https://stackoverflow.com/questions/238878/is-it-acceptable-practice-to-patch-rubys-base-classes-such-as-fixnum)在 Ruby 中修改基类的行为似乎不是最佳实践（我可以理解）。所以，对这个答案持保留态度......

* * *

[MattW的回答](https://stackoverflow.com/questions/238684/subtract-n-hours-from-a-datetime-in-ruby#238690)是我最先想到的，但我也不是很喜欢。

`DateTime`我想你可以通过修补和`Fixnum`做你想做的事来让它变得不那么难看：

```
require 'date'

# A placeholder class for holding a set number of hours.
# Used so we can know when to change the behavior
# of DateTime#-() by recognizing when hours are explicitly passed in.

class Hours
   attr_reader :value

   def initialize(value)
      @value = value
   end
end

# Patch the #-() method to handle subtracting hours
# in addition to what it normally does

class DateTime

   alias old_subtract -

   def -(x) 
      case x
        when Hours; return DateTime.new(year, month, day, hour-x.value, min, sec)
        else;       return self.old_subtract(x)
      end
   end

end

# Add an #hours attribute to Fixnum that returns an Hours object. 
# This is for syntactic sugar, allowing you to write "someDate - 4.hours" for example

class Fixnum
   def hours
      Hours.new(self)
   end
end 
```

然后你可以这样写你的代码：

```
some_date = some_date - n.hours 
```

`n`您要减去的小时数在哪里`some_date`

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-08-14T14:52:23.043

如果我被允许使用`Time`而不是`DateTime`（有[几种方法可以将一种翻译成另一种](https://stackoverflow.com/questions/279769/convert-to-from-datetime-and-time-in-ruby/280026#280026)）：

```
# Just remove the number of seconds from the Time object
Time.now - (6 * 60 * 60) # 6 hours ago 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-30T21:22:45.757

我喜欢使用 active_support 中的助手。它使它非常干净且易于阅读。

请参见下面的示例：

```
require 'active_support'

last_accessed = 2.hours.ago
last_accessed = 2.weeks.ago
last_accessed = 1.days.ago 
```

如果使用当前日期，则可能有一种方法可以使用这种语法来完成您正在寻找的事情。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2011-12-20T11:00:53.443

你可以使用这个：

```
Time.now.ago(n*60*60) 
```

例如`Time.now.ago(7200)`，将给出从现在开始 2 小时之前的日期和时间。

# .net - 衡量线程费用

> ID：238687
> 
> 赞同：5
> 
> 时间：2008-10-26T21:49:16.830
> 
> 标签：.net, performance, multithreading, concurrency

Joe Duffy 在 MSDN 文章“ [Using concurrency for scaling](http://msdn.microsoft.com/en-us/magazine/cc163552.aspx) ”中指出，创建线程的成本约为 200,000 个周期，而销毁的成本约为 100,000 个周期。

当我尝试创建一个新线程来执行一些计算时，我想确保计算本身比 200,000 个周期更昂贵。

我如何测量 CPU 周期？我认为这比测量执行时间更有趣。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T22:46:56.260

您可以使用像 Intel 的 Vtune 之类的采样分析器来测量消耗了多少 CPU 周期，同时对被测系统的干扰量最小。

然而，当使用线程时，目标是避免不必要地产生新线程。研究使用[线程池](http://msdn.microsoft.com/en-us/library/ms973903.aspx)。这将允许您异步运行工作项，但不必为每个项生成一个新线程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T21:53:39.300

我会检查 System.Diagnostic 命名空间。它有很多关于跟踪内存和 cpu 使用情况的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T22:17:34.713

几天前我问了一个密切相关的问题，但还没有找到一种方法来衡量代码的实际 CPU 周期使用情况： [限制程序集执行的 CPU 周期数](https://stackoverflow.com/questions/234411/limiting-assembly-execution-number-of-cpu-cycles)

在您的情况下，您是否可以不运行计算分析并查看单个计算需要多少时间，并将其与生成执行计算的线程然后杀死线程的总时间进行比较？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T01:06:27.663

这是计算 CPU 周期的问题。不同的 CPU 需要不同数量的周期来执行相同的指令。因此，IMO 的度量标准不太可靠。我认为您应该测量的是执行时间，而在 .NET 中，您使用 System.Environment.TickCount 来完成此操作。我认为这是你所拥有的最好的...

# python - 使用 ElementTree 进行 XPath 搜索

> ID：238697
> 
> 赞同：4
> 
> 时间：2008-10-26T22:00:16.807
> 
> 标签：python, xml, xpath

xml 新手。寻找 XPath 以搜索具有 python ElementTree 格式的 xml 文件

```
<root>
<child>One</child>
<child>Two</child>
<child>Three</child>
</root> 
```

用“二”搜索孩子并返回真/假

如果它开始像

```
from elementtree import ElementTree
root = ElementTree.parse(open(PathFile)).getroot() 
```

如何做到这一点

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T09:32:36.830

我最近一直在玩 ElementTree，让我们看看..

```
>>> from xml.etree import ElementTree
>>> help(ElementTree.ElementPath)
>>> root = ElementTree.fromstring("""
<root><child>One</child><child>Two</child><child>Three</child></root>
""")
>>> ElementTree.ElementPath.findall(root, "child")
[<Element child at 2ac98c0>, <Element child at 2ac9638>, <Element child at 2ac9518>]
>>> elements = ElementTree.ElementPath.findall(root, "child")
>>> two = [x for x in elements if x.text == "Two"]
>>> two[0].text
'Two' 
```

这就是你要找的对吗？它说 ElementPath 虽然只是有限的 xpath 支持，但它并没有说根本不支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T23:00:26.673

当计算以下 XPath 表达式时：

    `boolean(/*/*[.='Two'])`

结果为**true**，如果存在这样的元素（顶部元素的子元素，其字符串值等于“Two”），

否则为**假。**

希望这有帮助。

干杯，

迪米特·诺瓦切夫

# vb.net - 如何优雅地处理 Linq to SQL 中的空外键？

> ID：238702
> 
> 赞同：0
> 
> 时间：2008-10-26T22:07:22.797
> 
> 标签：vb.net, linq-to-sql

在我的数据库中，Concessions 与 Firms 具有多对一的关系（每个 Concession 都有一个 FirmID）。SqlMetal 已经捕获了这种关系并生成了适当的类，因此每个 Concession 都有一个 Firm 元素。我正在绑定一个查询（此处简化），该查询返回特许权列表以及有关相应公司的信息：

```
From c as Concession in Db.Concessions _
Select _
   c.ConcessionID, _
   c.Title, _
   c.Firm.Title 
```

问题是，在某些情况下，没有将特许权分配给公司（c.FirmID 为空），所以 c.Firm 什么都不是，我得到`Object not set to an instance`等等。

我可以通过如下加入来解决这个问题：

```
From c As Concession In Db.Concessions _
Join f As Firm In Db.Firms On f.FirmID Equals c.FirmID _
Select _
    c.ConcessionID, _
    c.Title, _
    Firm_Title = f.Title 
```

当 FirmID 为 null（Firm_Title 只是一个空字符串）时，这不会引发错误，但它并不优雅：它不是面向对象的，并且它没有利用 Linq to SQL 已经捕获的所有关系智能。

有没有更优雅的方式来处理这种情况？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T22:27:10.450

你在哪里得到错误？

我刚刚完成了一个类似的 LINQ 查询（在 VB.Net 中），它运行良好（将 Title 设置为 null）

稍后您将不得不处理 title 为 null 的问题，但这并不是真正的 LINQ 问题。甚至可以在 C# 中轻松处理。

```
from c in Db.Concessions
select 
{   
     c.ConcessionID, 
     c.Title, 
     Title = c.Firm.Title ?? ""
} 
```

Vb.net 中的等价物是使用 Iif()，但我无法让它工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T22:16:58.130

您的第二个示例是进行内部联接。它不会返回具有空 FirmID 的让步。在这种情况下，您想进行外部联接：

[http://msdn.microsoft.com/en-us/vbasic/bb737929.aspx#grpjoinleftout](http://msdn.microsoft.com/en-us/vbasic/bb737929.aspx#grpjoinleftout)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T00:50:55.247

@James Curran：每当实际执行查询时，我都会收到错误消息-例如，如果我将网格数据绑定到它，或者如果我应用`.ToList`它。

VB.NET 有一个新的真正的三元语法（仍然比 C# 更冗长）。这实际上有效：

```
From c As Concession In db.Concessions _
Select _
    c.ConcessionID, _
    c.Title, _
    Firm_Title = If(c.Firm IsNot Nothing, c.Firm.Title, String.Empty) _ 
```

我对这种方法并不真正满意 - 不得不对我可能使用的外部表中的每个字段都这样做是很痛苦的。我很想知道为什么您的查询有效而我的查询无效 - 您的 DataContext 是由 SqlMetal 生成的吗？关系是从数据库中推断出来的吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-20T07:13:15.373

在对象构造函数中处理

```
Public Property office() As String
            Get
                Return _office
            End Get
            Set(ByVal value As String)
                If value IsNot Nothing Then
                    _office = value
                Else
                    _office = String.Empty
                End If
            End Set
        End Property 
```

# java - 在 Java 中用于用户身份验证的设计模式

> ID：238710
> 
> 赞同：2
> 
> 时间：2008-10-26T22:20:21.337
> 
> 标签：java, design-patterns

有一些跨项目使用的通用组件：

1.  用户认证和授权
2.  异常处理
3.  日志记录
4.  电子邮件
5.  数据库访问
6.  缓存等

是否有一致的设计模式可用于这些通用模块中的每一个？顺便说一句，该框架可以有所不同，例如用于用户身份验证和授权的 JAAS/JNDI、用于日志记录的 log4j/java 日志记录、用于 E-mai 的 JavaMail、用于数据库访问的 JDBC/Hibernate。

例如，有用于数据库访问的 DAO。无论使用什么框架（JAAS/JNDI/SSO），是否有任何好的设计模式可以用于用户认证和授权？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T22:53:16.667

也许本身不是一种模式，但我一直认为 spring 注释方法非常聪明。本质上，您注释需要保护的方法。如果你有一个很好的分层架构，那么这应该会让事情变得非常简单！它为您完成所有艰苦的工作。[在这里查看](http://www.acegisecurity.org/ "Acegi 网站")。[常见问题解答非常](http://www.acegisecurity.org/faq.html "常问问题")好。

作为我与罗德约翰逊一起进行的春季训练的一部分，我只在非常基础的东西中使用了它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T15:34:05.853

我会警惕使用面向方面的编程，尤其是拦截器。拦截器和 AOP 的一些实现在运行时运行，实际上并不修改运行的代码。

如果应用程序部署不正确，没有拦截器/方面，会发生什么？好吧，一般来说，您的应用程序可能在很大程度上依赖于拦截器提供的功能，如果没有它，将会明显中断。但是授权有点不同。如果用户没有被授权，就会发生一些事情，比如引发异常。但在典型情况下，用户被授权，拦截是无操作的。当应用程序在没有授权拦截器的情况下意外部署时，它会有效地授权所有操作。

相比之下，使用[显式权限检查](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/SecurityManager.html#checkPermission(java.security.Permission))的传统方法在敏感操作本身中结合了安全性，因此它不依赖于拦截器、过滤器或运行时方面支持的外部配置。

从历史上看，当 AOP 是一种寻找问题的解决方案时，安全性被视为可能的受害者。不幸的是，AOP 爱好者倾向于忽视将其安全地应用于这一重要功能所需的批判性思维。我相信是可以做到的，但并不是注释几个方法那么简单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T00:34:53.593

对于横切关注点，您可能需要考虑面向方面的编程 (AOP)。与其说是设计模式，不如说是在您描述的场景中使用。简而言之，您有许多需要安全性的组件……您在别处定义安全性，并让 AOP 系统根据需要将其添加到您的组件中。这样您就可以围绕核心业务案例设计代码，而不必过多担心安全性。安全性会自动注入。

[这篇](http://www.javalobby.org/java/forums/t44746.html)文章可能会有所帮助。它解释了它是如何在 Spring 中完成的。我现在在一个大型项目中使用 Spring，我不知道没有它之前我是如何管理的。

[这](http://static.springframework.org/spring/docs/2.5.x/reference/aop.html)是 Spring 本身关于其 AOP 的文档。

我知道这可能不适用于您提到的每种情况，但这可能是一个开始。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T02:33:58.033

JAAS 本身指定了一些：*Subject、Prinicipal、Credential 和 LoginContext*。任何身份验证框架都必须具有类似的类。

2 乍一看是特定于 JAAS 的，但对于使身份验证独立于应用程序的业务逻辑非常重要的是*CallBackHandlers*和*LoginModules*。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T14:38:48.990

我认为您在谈论拦截器模式。

在 Web 应用程序中这非常简单，因为它已经通过 web.xml 融入到 servlet 容器规范中

[http://java.sun.com/blueprints/corej2eepatterns/Patterns/InterceptingFilter.html](http://java.sun.com/blueprints/corej2eepatterns/Patterns/InterceptingFilter.html)

在 j2se 世界中它变得有点棘手......好像你想让它完全无缝你可以使用动态代理（想想 spring 事务 daos）[http://java.sun.com/j2se/1.5.0 /docs/api/java/lang/reflect/Proxy.html](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/reflect/Proxy.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T22:30:18.837

我不知道用户身份验证/授权的设计模式，但是......如果你想能够轻松地模拟它们，在 .NET 中我们使用提供程序。

然后我们可以直接通过我们的配置文件配置我们使用哪个组件进行身份验证和授权。

你怎么看？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-27T00:42:48.180

这可能不是您要寻找的，但所有这些功能都是[横切关注点](http://en.wikipedia.org/wiki/Cross-cutting_concern)的典型示例。[AspectJ](http://en.wikipedia.org/wiki/Aspectj)是一种 Java 语言扩展，专门设计用于以模块化方式处理这些类型的功能。

如果您决定尝试一下，有一个[Eclipse 插件。](http://www.eclipse.org/aspectj/)

# graph-theory - 可视化对 GraphViz 来说太大的无向图？

> ID：238724
> 
> 赞同：77
> 
> 时间：2008-10-26T22:31:59.300
> 
> 标签：graph-theory, graphviz, graph-layout

我需要有关渲染具有 178,000 个节点和 500,000 条边的无向图的建议。我尝试过 Neato、Tulip 和 Cytoscape。Neato 甚至都无法接近，Tulip 和 Cytoscape 声称他们可以处理它，但似乎无法处理。（Tulip 什么都不做，Cytoscape 声称正在工作，然后就停止了。）

我只是想要一个具有远程合理布局的节点的矢量格式文件（ps 或 pdf）。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2011-02-23T16:07:34.577

Graphviz 本身提供了一个渲染大图的解决方案。

即，Graphviz 包括`sfdp`一个多尺度版本的 fdp（也在 graphviz 中，类似于neato），用于布局大型无向图，这对于在我的项目中绘制大型图（70k 节点，500k 边）很有用。

[您可以在http://www.graphviz.org/](http://www.graphviz.org/)上的 graphviz 网站上找到该软件的文档。

欲了解更多信息，这里是*Efficient and high quality force-directed graph drawing*，由 Yifan Hu 撰写的描述底层技术和示例的论文：http: [//yifanhu.net/PUB/graph_draw_small.pdf](http://yifanhu.net/PUB/graph_draw_small.pdf)

还有一个网络存档版本：[https ://web.archive.org/web/20210812011222/http://yifanhu.net/PUB/graph_draw.pdf](https://web.archive.org/web/20210812011222/http://yifanhu.net/PUB/graph_draw.pdf)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-06-02T01:36:11.917

我建议您首先对数据进行一些预处理，例如将节点折叠成集群，然后将集群可视化。折叠将减少节点的数量，并使 Kamada-Kawai 或 Fruchterman-Reingold 等算法更容易渲染结果图。

如果您真的需要可视化 500.000 个节点，那么您可以考虑使用简单的圆形布局。这将很容易渲染，而不会出现基于力的算法所存在的问题。看看 Circos：[http ://mkweb.bcgsc.ca/circos/](http://mkweb.bcgsc.ca/circos/)

Circos 是由生物信息学人员开发的图形可视化，专门用于可视化基因组和其他极其庞大和复杂的数据集。

这是一个基于 PERL 的包，我希望这没有问题。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2014-10-07T21:46:08.470

我使用 python 中的[图形工具](http://graph-tool.skewed.de/)库取得了很好的效果。下图有 1,490 个节点和 19,090 条边——在我的笔记本电脑上渲染大约需要 5 分钟。

![政治博客网络](https://i.stack.imgur.com/qOyKL.jpg)

图表数据来自 Adamic 和 Glance 在[“政治博客圈和 2004 年美国大选”中描述的政治博客网络</a>](http://dx.doi.org/10.1145/1134271.1134277)[此处](http://www2.scedu.unibo.it/roversi/SocioNet/AdamicGlanceBlogWWW.pdf)的 pdf 链接。如果放大，您可以看到每个节点的博客网址。

![放大](https://i.stack.imgur.com/w64Pb.png)

这是我用来绘制它的代码（博客[http://ryancompton.net/2014/10/22/stochastic-block-model-based-edge-bundles-in-graph-tool/](http://ryancompton.net/2014/10/22/stochastic-block-model-based-edge-bundles-in-graph-tool/)）：

```
import graph_tool.all as gt
import math

g = gt.collection.data["polblogs"] #  http://www2.scedu.unibo.it/roversi/SocioNet/AdamicGlanceBlogWWW.pdf
print(g.num_vertices(), g.num_edges())

#reduce to only connected nodes
g = gt.GraphView(g,vfilt=lambda v: (v.out_degree() > 0) and (v.in_degree() > 0) )
g.purge_vertices()

print(g.num_vertices(), g.num_edges())

#use 1->Republican, 2->Democrat
red_blue_map = {1:(1,0,0,1),0:(0,0,1,1)}
plot_color = g.new_vertex_property('vector<double>')
g.vertex_properties['plot_color'] = plot_color
for v in g.vertices():
    plot_color[v] = red_blue_map[g.vertex_properties['value'][v]]

#edge colors
alpha=0.15
edge_color = g.new_edge_property('vector<double>')
g.edge_properties['edge_color']=edge_color
for e in g.edges():
    if plot_color[e.source()] != plot_color[e.target()]:
        if plot_color[e.source()] == (0,0,1,1):
            #orange on dem -> rep
            edge_color[e] = (255.0/255.0, 102/255.0, 0/255.0, alpha)
        else:
            edge_color[e] = (102.0/255.0, 51/255.0, 153/255.0, alpha)            
    #red on rep-rep edges
    elif plot_color[e.source()] == (1,0,0,1):
        edge_color[e] = (1,0,0, alpha)
    #blue on dem-dem edges
    else:
        edge_color[e] = (0,0,1, alpha)

state = gt.minimize_nested_blockmodel_dl(g, deg_corr=True)
bstack = state.get_bstack()
t = gt.get_hierarchy_tree(bstack)[0]
tpos = pos = gt.radial_tree_layout(t, t.vertex(t.num_vertices() - 1), weighted=True)
cts = gt.get_hierarchy_control_points(g, t, tpos)
pos = g.own_property(tpos)
b = bstack[0].vp["b"]

#labels
text_rot = g.new_vertex_property('double')
g.vertex_properties['text_rot'] = text_rot
for v in g.vertices():
    if pos[v][0] >0:
        text_rot[v] = math.atan(pos[v][1]/pos[v][0])
    else:
        text_rot[v] = math.pi + math.atan(pos[v][1]/pos[v][0])

gt.graph_draw(g, pos=pos, vertex_fill_color=g.vertex_properties['plot_color'], 
            vertex_color=g.vertex_properties['plot_color'],
            edge_control_points=cts,
            vertex_size=10,
            vertex_text=g.vertex_properties['label'],
            vertex_text_rotation=g.vertex_properties['text_rot'],
            vertex_text_position=1,
            vertex_font_size=9,
            edge_color=g.edge_properties['edge_color'],
            vertex_anchor=0,
            bg_color=[0,0,0,1],
            output_size=[4024,4024],
            output='polblogs_blockmodel.png') 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-27T16:46:26.517

Mathematica 很可能会处理它，但我不得不承认，我的第一反应是按照“拿一张纸把它涂成黑色”的评论。有没有办法降低图形的密度？

一个可能的问题是您似乎在寻找布局，而不仅仅是渲染。我不了解各种工具实现的布局的大 O 特性，但直觉上我猜想布局这么多数据可能需要很*长时间。*

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-27T16:34:39.857

它需要真正准确吗？

根据您要完成的工作，仅绘制 10% 或 1% 的数据量可能就足够了。（当然，它也可能完全没用，但这完全取决于可视化的用途）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-19T00:46:32.443

首先，我想第二个 aliekens 的建议尝试 sfdp。它是 Neato 的大型版本。

正如 OJW 建议的那样，您也可以只绘制 R2 中的节点。你的边缘实际上提供了他所谓的“自然排序”。特别是，您可以绘制归一化图拉普拉斯算子的第二个和第三个特征向量的分量。`L`这是这个维基百科页面中[关于光谱聚类](http://en.wikipedia.org/wiki/Spectral_clustering#Algorithms)的矩阵。您应该能够在不了解其背后的线性代数的情况下写下此矩阵。然后，您将问题简化为近似计算大型稀疏矩阵的前几个特征向量。这传统上通过迭代方法完成，并在标准线性代数包中实现。这种方法应该扩展到非常大的图表。

# security - 安全性 - 可以通过 HTTP GET 发送用户名和密码吗？

> ID：238728
> 
> 赞同：14
> 
> 时间：2008-10-26T22:34:18.533
> 
> 标签：security, http

我们是一个购买了医生用来查看患者测试结果（非常敏感信息）的系统的组织。作为一名程序员，我戳了戳系统，发现它通过 HTTP GET 请求提交用户名和密码。在运行它的域上，所有计算机都设置为绕过代理，因此带有请求的 URL 不会保存在某个代理日志中的某个地方。但我认为无论如何这是处理用户名和密码的不安全方式。

供应商会争辩说，由于我们从未要求过，这将是一种“增强”，需要额外的美元。（我们从一开始就没有为系统编写规范）。

我可以向管理层提出什么样的案例，让他们觉得这不符合标准，并且这个系统安全的唯一方法可能是通过 HTTPS？

编辑：感谢您的所有回复！我已经向项目负责人提出了这个问题，她的回答是“什么是 HTTP？”。所以我计划更详细地向她解释这一切，调查法律影响，并尝试向程序员提出问题，直接询问他们为什么要走这条路。我也会尝试向其他没有直接参与但可能对此事产生影响的同事解释情况。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-26T23:09:34.343

如果它是医疗数据并且您居住在美国，那么访问它很有可能会受到 HIPAA 法规的约束，包括安全要求。您应该查看[http://www.cms.hhs.gov/SecurityStandard/Downloads/SecurityGuidanceforRemoteUseFinal122806.pdf](http://www.cms.hhs.gov/SecurityStandard/Downloads/SecurityGuidanceforRemoteUseFinal122806.pdf)。如果您不住在美国，我建议您仍然可以将 HIPAA 指向与该域相关的内容。

如果您的供应商试图以额外费用进行反击，请说“您是说您不符合相关的政府标准吗？天哪，也许您应该向我们提供有关您的安全和隐私标准、保障措施和程序的完整文档。因为很明显，如果我们被罚款，我们就会追上你。“（IANAL 等等。）

从技术层面来看，显示清除用户名和密码是多么容易的空灵痕迹的建议肯定会让您的管理层大开眼界。鉴于嗅探正常的网络流量是多么容易，以及使用 SSL 进行传输是多么容易，供应商将*其*作为“安全增强”的想法是令人发指的。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-26T22:49:32.010

证明你的理由的一个好方法是找一个相对技术性（或聪明）的经理，如果你向他们展示登录的实时空灵痕迹，他会明白的（看！这是用户的密码：MrGreen。什么，不要相信我？你自己试试吧！）。

仅在不先询问您是否信任并了解经理的情况下这样做，否则只需与他谈谈这件事，如果他不相信您，请请求允许展示。如果他不同意，您可以指向这个问题或其他在线资源。但如果他们不在乎，我会说，你就不走运了。

进行实时跟踪，简单地解释你做了什么（我们网络上的任何人都可以做到这一点，就像安装这个程序一样简单）。之后解释说，在系统上进行加密几乎是免费的，这可以防止这种情况发生，并且应用程序几乎不需要修改。并且它的好处是可以传输加密的所有内容，因此记录也会更加安全。

然后让该经理负责适当的权限/预算批准/任何事情。

整体修复它的唯一明智的方法确实是使用 POST（修复在 URL 中发送的密码）和 HTTPS。

最让我担心的是，通过网络发送明文密码的人可能会有许多其他的安全漏洞。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-26T23:48:02.050

您在这里有两个问题，一个是技术问题，一个是合同问题（因此是法律问题）。我不会就 Stack Overflow 寻求法律建议。

技术上的答案是显而易见的——这些做你系统的人是小丑，因为他们在其中留下了一个巨大的安全漏洞。

从法律上讲，这将取决于你在哪个国家（我注意到你来自布里斯班，所以你好来自该国的另一边）。许多人将有可能违反的医疗和/或隐私立法，因此这是需要检查的一件事。其他人建议研究的 HIPAA 法律仅适用于美国；我们可能在澳大利亚也有类似的，但我很确定奥兹的隐私法可以发挥作用。

同样，您需要查看合同（无论您是否起草了合同，我都假设您（或您的前任）签署了它，否则您根本没有义务向他们付款）以查看隐私是否是一项要求。即使不是，一位称职的律师也可以辩称这是一项隐含的要求。

您可能不得不接受它并支付额外的钱-我曾为一些大公司工作过，他们倾向于对未在交付给客户的可交付成果中列出的任何内容免除所有责任（这通常写在合同中）。如果您的供应商是一个称职的供应商（当然是在业务方面而不是客户满意度方面），他们就会做到这一点。

但**首先**，请联系律师寻求建议。他们是吸渣的底部饲养员:-)，但他们是知道该怎么做的人，他们最有能力检查合同并为您提供最佳选择。大约 10 年前，我使用了一个来摆脱我再也负担不起的汽车合同，尽管它花费了几千美元，但这比替代方案要好得多。

除非他们经常光顾 SO，否则您将在这里获得的建议要么偏向技术方面（最好的情况），要么在法律意义上完全危险（特别是因为它将主要基于美国法律）。不想为律师类型做广告，我知道你可以在[这里](http://www.findlaw.com.au/wld/advancedsearch.asp)找到。

祝你好运。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-27T04:25:27.760

即使使用 SSL，请记住，当使用 GET 发送用户名和密码时，它们会包含在 URL 中。

这意味着任何服务器日志都将包含用户名和密码作为日志记录过程的一部分。因此，您需要保护这些日志，或者至少防止记录查询字符串。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-26T22:51:26.563

我认为对于您的情况，您应该坚持使用 https - 即使它是通过“安全”网络。

这与 http basic 类似（basic 允许它在标头中 - 这是可取的，但您也可以将其以某种格式放在 URL 中，有关更多详细信息，请参阅[rfc2617](http://www.ietf.org/rfc/rfc2617)）。

使用 SSL/https，主机名将是明文的（显然它必须找到服务器），但 URL 的其他部分应该被安全加密。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-26T22:38:04.483

这不亚于内置的基本 http 身份验证安全。只需确保客户端 Web 浏览器没有缓存用户名/密码（它在您的浏览器历史记录中吗？）

我认为最简单和最便宜的方法是要求 HTTPS 来保护您的 Web 应用程序。如果用户转到 HTTP 的 URL，您可以简单地将他们重定向到 HTTPS 等效 URL。

如果您必须允许 HTTP 访问（我不确定为什么会这样），那么它绝对不安全。您应该改为实现[HTTP 摘要访问身份验证](http://en.wikipedia.org/wiki/Digest_access_authentication)之类的东西。

我不认为增强安全性是你应该从编码人员那里免费获得的东西。除非 u/p 出现在浏览器历史记录中。

由于您正在处理医生和患者信息，在我看来，内容本身也应该被加密，而不仅仅是身份验证。所以无论如何你真的应该使用HTTPS。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-26T22:48:58.517

> 这不亚于内置的基本 http 身份验证安全。

这是真的，除了一个微妙的点，用户名和密码，取决于系统的设计方式，可能会出现在浏览器窗口的地址栏中。

至少，我认为他们应该将该信息发布到服务器。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-26T23:06:46.657

用户名和密码不应该通过网络发送未加密的，所以至少要坚持使用 HTTPS 进行身份验证。我的偏好是仅通过 POST 接受用户名/密码（这样它根本不会出现在 URL 中），但是您可以想象对密码进行加密和编码，以便将其放入 GET 请求中。我无法想象为什么我会这样做而不是 POST。

[编辑] 正如其他人所指出的，如果您有与患者相关的数据，您可能需要加密与服务器的所有通信。如果您在美国，我会敦促您查看[HIPAA法规，看看是否适用于保护数据，尤其是](http://www.hhs.gov/ocr/hipaa/)[隐私规则](http://www.hhs.gov/ocr/AdminSimpRegText.pdf)(PDF)的第 164.306 小节。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-27T02:54:04.420

这是定制软件还是其他人使用的东西？如果是后者，请考虑加入或启动一个代表所有使用该软件的用户组。

# ios - 如何将 UIView 移动到“底部”以便显示下一个 UIView？

> ID：238733
> 
> 赞同：7
> 
> 时间：2008-10-26T22:40:05.807
> 
> 标签：ios, objective-c, iphone, cocoa-touch, uiview

我想从超级视图中“删除”一个 UIView 并在最后再次添加它......但是在属于超级视图的其余 UIview 的“底部”。

这可能吗？

非常感谢任何帮助！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-26T22:57:30.700

嗯……

```
- (void)insertSubview:(UIView *)view atIndex:(NSInteger)index; 
```

可能是你所追求的？或者 -

```
- (void)insertSubview:(UIView *)view belowSubview:(UIView *)siblingSubview; 
```

虽然您可以通过调用 sendSubviewToBack 来避免一起删除视图（如果您不需要出于任何其他原因）： -

```
- (void)sendSubviewToBack:(UIView *)view; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T23:35:18.690

我不太明白你说的底部是什么意思。您可以使用：`[view removeFromSuperview];`删除它（确保您删除它`retain`（`[view retain];`），然后再执行此操作以及`release` `[view release];`不再需要它时。

如果您希望一个视图位于另一个视图之后，您可以做的另一件事是设置它的 " `zPosition`" ( `view.layer.zPosition = X;`)

如果一个 View 的 a`zPosition`比另一个 View 大`zPosition`，它将出现在另一个 View 的顶部。

# c++ - C++ 中的事件

> ID：238738
> 
> 赞同：24
> 
> 时间：2008-10-26T22:46:33.610
> 
> 标签：c++

我不知道如何在网上寻找这个......我认为它们在 C++ 中可能被称为不同的东西

我想要一个简单的事件系统，比如

```
event myCustomEvent;
myCustomEvent.subscribe( void myHandler(string) );
myCustomEvent.fire("a custom argument");
// myHandler prints out the string passed in the first argument

event myNewCustomEvent;
myNewCustomEvent.subscribe( void myNewHandler(int) );
myNewCustomEvent.fire(10);
// myHandler prints 10 
```

我可以用一个简单的类很容易地做到这一点——但是当我想要一个向订阅者传递不同类型或数量的参数的事件时，我必须编写，并定义一个全新的事件类。我认为有成为某个库，或者甚至可能是 Visual C++ 2008 中的原生库，它们的工作原理与此类似。它基本上只是观察者模式的一个实现，所以在 C++ 中它不可能太不可能

这真的让我很欣赏在 JavaScript 中不必担心你传递的参数是多么美好。

告诉我这是不是一个愚蠢的问题。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-26T22:57:06.067

看一下升压[信号](http://www.boost.org/doc/libs/1_36_0/doc/html/signals.html)库。结合[函数](http://www.boost.org/doc/libs/1_36_0/doc/html/function.html)库和[绑定](http://www.boost.org/doc/libs/1_36_0/libs/bind/bind.html)库，您可以完全按照您的要求进行操作。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-26T23:06:40.930

我正是为了这个目的使用[sigslot](http://sigslot.sourceforge.net/)。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-26T22:48:10.297

GOF 的观察者模式几乎就是你想要的。

在书中，它有用于此的 C++ 代码......

此外，与往常一样，Boost 也有你可以使用的东西

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-27T02:44:13.863

有一个原生的 Visual C++[事件系统](http://msdn.microsoft.com/en-us/library/6f01ek09.aspx)。它主要用于 COM，但它也具有原生 C++ 支持。

从[这里](http://msdn.microsoft.com/en-us/library/ee2k0a7d.aspx)：

```
[event_source(native)]
class CSource {
public:
   __event void MyEvent(int nValue);
};

[event_receiver(native)]
class CReceiver {
public:
   void MyHandler1(int nValue) {
      printf_s("MyHandler1 was called with value %d.\n", nValue);
   }

   void MyHandler2(int nValue) {
      printf_s("MyHandler2 was called with value %d.\n", nValue);
   }

   void hookEvent(CSource* pSource) {
      __hook(&CSource::MyEvent, pSource, &CReceiver::MyHandler1);
      __hook(&CSource::MyEvent, pSource, &CReceiver::MyHandler2);
   }

   void unhookEvent(CSource* pSource) {
      __unhook(&CSource::MyEvent, pSource, &CReceiver::MyHandler1);
      __unhook(&CSource::MyEvent, pSource, &CReceiver::MyHandler2);
   }
};

int main() {
   CSource source;
   CReceiver receiver;

   receiver.hookEvent(&source);
   __raise source.MyEvent(123);
   receiver.unhookEvent(&source);
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-28T07:37:49.027

我使用[libsigc++](http://libsigc.sourceforge.net/)。它是 gtkmm 原生的。

一个简单的例子迷失地改编自[教程](https://developer.gnome.org/libsigc++-tutorial/stable/)：

```
#include <iostream>
#include <sigc++/sigc++.h>

using namespace std;

class AlienDetector {
public:
        void run ();
        sigc::signal<void> signal_detected;
};

void warn_people () {
        cout << "There are aliens in the carpark!" << endl;
}

void AlienDetector::run () {
        signal_detected.emit ();
}

int main () {
        AlienDetector mydetector;
        mydetector.signal_detected.connect (sigc::ptr_fun (warn_people));
        mydetector.run ();
} 
```

它还提供了一种使用 sigc::mem_fun 而不是 sigc::ptr_fun 将特定对象的成员函数连接到信号的机制：

```
sigc::mem_fun (someobject, &SomeClass::some_method); 
```

这几乎提供了 GLib 信号所能提供的任何东西。

# c++ - Visio & UML - 在属性和返回值中显示指针

> ID：238740
> 
> 赞同：1
> 
> 时间：2008-10-26T22:47:12.593
> 
> 标签：c++, uml, visio

我需要为我的一项 C++ 作业生成 UML 图。我正在使用 Visio 2007，但无法表示 C++ 指针。我找到了一种向 Datatypes 添加后缀的方法，但是为程序中使用或返回的每个指针执行此操作相当耗时。

基本上我试图得到`-object1 : Object* = NULL`并且没有每次都`+Object() : Object*`深入研究属性并添加到后缀字段。`*`

我非常坚持使用 Microsoft 制作图表和编码的软件，所以请不要建议我使用不同的软件。但是，如果 Visual Studio 2003 支持以比 Visio 更轻松的方式制作 UML 图，我不会反对使用 Visual Studio，但请告诉我该选项在哪里。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T06:54:24.057

您可以让 Visio 将其数据文件保存为 XML 格式。然后，您可以编写一个脚本来在任何您想要的地方进行 * 调整。根据您的模型有多大，这可能比您现在使用的繁琐的手动方式更快，特别是如果您已经有一些像 Perl 这样的语言的经验。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T23:35:41.870

一种解决方案是创建一个以 Object* 作为名称的自定义数据类型，但这需要为每个类完成。

# delphi - 如何在 Delphi 中将 GIF/PNG/... 图像放在 BitBtn 上？

> ID：238741
> 
> 赞同：11
> 
> 时间：2008-10-26T22:47:25.197
> 
> 标签：delphi, delphi-2007

我正在使用 Delphi 2007。如何将 GIF/PNG 图像放在 BitBtn 组件上？（最好支持 alpha 透明度）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-27T05:15:33.683

[PngComponents](http://www.thany.org/article/18/Delphi_components)包有一个名为 PngBitBtn 的组件，它可以正确显示具有 alpha 透明度的 PNG。它们有些旧，但只需一点工作就可以在 Delphi 2007 下安装它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T22:49:11.280

使用 Photoshop 之类的图形程序（或其他更便宜的软件）将图像转换为位图。BitBtns 不接受 GIF 或 PNG 图片。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T00:44:20.673

只有 Delphi 2009 完全支持 PNG 支持。有一个名为[GraphicEx](http://www.soft-gems.net/index.php?option=com_content&task=view&id=13&Itemid=33)的免费软件包（许可为 MPL 1.1） ，它允许您在设计时/运行时加载图像，但您不会在按钮上获得 alpha 混合透明度德尔福 2007。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-21T10:11:21.543

包含在 Delphi 2009k 中的 PNGimage 应该可以完成这项工作。如果我们能找到它。

# ajax - 如何使用 Ext GWT (GXT) 在 Grails 上共享域对象？

> ID：238746
> 
> 赞同：3
> 
> 时间：2008-10-26T22:50:00.513
> 
> 标签：ajax, grails, gwt-ext

我的应用程序在逻辑上分为服务器，其中包含我的 Grails 域对象和控制器；和客户端，在那里我有构建所有 UI 页面的 Ext GWT 类。

对于 UI 请求，我使用 AJAX 调用来返回例如作为 JSON 结构的域对象列表的控制器方法。

遵循 DRY 原则，我不想在服务器上将域数据“序列化”为 JSON 字符串，然后在客户端将其反序列化为另一个结构 - 我想利用我已经拥有的域对象, 这在我添加、更改或删除新字段时不必更改多个位置。

问题是：这是一个好方法吗？

如果是，如何使 .groovy 域对象在“客户端”Ext GWT Java 类上可用的最佳方式是什么？

如果没有，为什么它不好，你会建议什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T09:52:34.450

没有一个好方法——你需要一个 GWT 可序列化的 java 对象。我能看到的唯一真正的解决方案是编写一个插件（或添加到 GWT 插件）一种自动生成数据传输对象的方法，可能使用 grails 域对象中的注释。

类似的方法被用于在 gwt 插件中自动生成 RPCAsync 接口 - 请参阅 gwt 插件目录中的 GwtGrailsPlugin.groovy，第 133 行左右是开始。

您可以挂钩（或者直接修改该文件，可能更容易）并插入一些代码来生成数据传输文件。另一个好处可能是您可以细化数据传输对象，以便私有数据（如密码！）不会被传输。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-02T18:33:23.590

或者，您可以将数据作为 json 或 xml 发送到客户端。您可以为您的服务器端创建一个 REST api。

# c++ - IDirectInputDevice8 键盘挂钩

> ID：238748
> 
> 赞同：1
> 
> 时间：2008-10-26T22:51:06.190
> 
> 标签：c++, directx

我们有一个通过 IDirectInputDevice8 检索键盘按下的 3D 应用程序。有什么办法，当我们通过 win32 API winproc 循环检索键盘事件时，我们可以将这些命令发送到 DirectInputDevice？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T10:02:05.057

Windows 在后台轮询键盘硬件。当关键事件发生时，它会将相应的 WM_* 消息添加到您的 Windows 消息队列中（以及有关键盘状态的相关信息）。[Windows 消息泵](http://en.wikipedia.org/wiki/Message_loop_in_Microsoft_Windows)将这些消息从队列中拉出并相应地处理它们。这种方法的主要好处是你真的不需要做很多事情来掌握键盘事件（加上不需要键盘布局/硬件的知识）。缺点是它真的不是实时的。

通过 DirectInput 与键盘对话实际上是相似的，但轮询由您决定。通常，您使用 DirectInput 设置键盘设备，然后每次运行更新循环时，您使用[GetDeviceState()](http://msdn.microsoft.com/en-us/library/bb205968.aspx)**轮询**键盘的状态。您可以在轮询之间跟踪键盘的状态。最好的办法是创建一个包含此功能的对象，并可能在适当的时间触发事件/回调或在队列中创建一个命令条目，以便更好地使用它。这种方法的优点是速度快，因为您直接与硬件对话并且可以立即调用更新。缺点是您必须手动执行此操作，这需要一些时间来设置和正确处理。

查看如何使用 DirectInput 查询键盘的[示例。](http://www.gamedev.net/reference/articles/article1607.asp)

所以你的问题有几个答案：

1.  如果您已经拥有 WM_* 消息，为什么不直接调用 DirectInput 处理将调用的代码，从而为您提供相同的功能？
2.  DirectInput 通过轮询为您提供与 Windows 通过 WM_* 消息为您提供的相同信息。所以你不需要转换，或者尝试将一个映射到另一个。只需检查键的状态并处理状态变化的情况。
3.  选择一种方法并放弃另一种方法。他们都做同样的事情。如果您想要速度和响应能力，我建议您使用 DirectInput。如果这不是那么重要，请使用 WM_* 消息。

我希望这会有所帮助。祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T23:12:19.640

wndproc 将在键盘事件上发送这些消息的组合：

```
WM_SYSKEYDOWN
WM_SYSKEYUP
WM_KEYDOWN
WM_KEYUP 
WM_CHAR 
```

# .net - .NET 中的 Castle、AOP 和日志记录

> ID：238755
> 
> 赞同：7
> 
> 时间：2008-10-26T22:54:58.177
> 
> 标签：.net, logging, castle-windsor, aop

是否有任何关于使用 AOP、Castle 和登录 .Net 应用程序的教程或示例程序？我已经找到了一些碎片，但我正在寻找更多的东西来帮助我形成更完整的画面。

谢谢，-布赖恩

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-26T23:19:34.133

您需要使用继承自 IInterceptor 的自定义拦截器。例如：

```
public class LogInterceptor : IInterceptor
{    
    public void Intercept(IInvocation invocation)
    {
        Logger.Write("I'm in your method logging your access");
        invocation.Proceed();
    }
} 
```

希望这会有所帮助。

# c++ - Visio 和 UML - 显示向量

> ID：238764
> 
> 赞同：4
> 
> 时间：2008-10-26T23:04:00.983
> 
> 标签：c++, uml, visio

我需要为我的一项 C++ 作业生成 UML 图。我正在使用 Visio 2007，但在表示 C++ 向量时遇到了问题。我可以看到这种工作的唯一方法是在我的项目中创建自定义 C++ 数据类型或创建向量类，然后对于 UML 中向量的每个实例，我需要深入研究属性并添加`<Class>`到后缀字段中。

基本上我试图在`vector<Object>`不深入研究属性的情况下`<Class>`每次都添加到后缀字段。

我非常坚持使用 Microsoft 制作图表和编码的软件，所以请不要建议我使用不同的软件。但是，如果 Visual Studio 2003 支持以比 Visio 更轻松的方式制作 UML 图，我不会反对使用 Visual Studio，但请告诉我该选项在哪里。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-26T23:24:00.210

您不需要规定它是 UML 图上的向量。

在您给出的示例中，一个类和另一个类之间存在一对多的关系。这是您需要传达的重要信息。

您已选择将其实现为向量：这是一个不需要在图表上显示的实现细节 - 只需显示一对多关联。

如果由于某种原因，您需要将其更改为 std::list、std::deque 或任何其他 stl 容器，则无需更新图表，因为一对多的概念是还是一样。

请记住，您正在显示代码的*抽象*。如果您想传达所有类在概念上如何相互关联，UML 类图是理想的。如果有人想知道它是如何实现的细节，他或她总是可以在查看源代码本身之前使用图表作为起点。

有关使用 UML 显示的一对多关系的示例，请单击[此处](http://dn.codegear.com/article/31863#classdiagrams)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T07:02:21.830

UML 有参数化类的表示法。[参数类型像这样](http://www.csci.csusb.edu/dick/samples/uml.template.gif)进入右上角的重叠框 您的工具是否支持它是另一回事...

# c# - 给定一个 ExpressionType.MemberAccess 类型，我如何获取字段值？

> ID：238765
> 
> 赞同：34
> 
> 时间：2008-10-26T23:04:20.733
> 
> 标签：c#, reflection, expression-trees

我正在解析一个表达式树。给定 ExpressionType.MemberAccess 的 NodeType，我如何获取该字段的值？

来自 C# MSDN 文档：MemberAccess 是表示从字段或属性读取的节点。

一个代码片段会非常非常有用。提前致谢！！！

我的代码看起来像这样：

```
public static List<T> Filter(Expression<Func<T, bool>> filterExp) 
{
//the expression is indeed a binary expression in this case
BinaryExpression expBody = filterExp.Body as BinaryExpression;

if (expBody.Left.NodeType == ExpressionType.MemberAccess) 
  //do something with ((MemberExpressionexpBody.Left).Name

//right hand side is indeed member access. in fact, the value comes from //aspdroplist.selectedvalue            
if (expBody.Right.NodeType == ExpressionType.MemberAccess)
{
   //how do i get the value of aspdroplist.selected value?? note: it's non-static                        
}

//return a list
} 
```

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-10-26T23:38:17.717

[为清楚起见更新]

第一的; 将其`Expression`转换为`MemberExpression`.

A`MemberExpression`有两件事很有趣：

*   .Member -成员的`PropertyInfo`/`FieldInfo`
*   .Expression - 为获取 .Member 的“obj”而求值的表达式

即，如果您可以将 评估`.Expression`为“obj”，并且`.Member`is a ，那么您可以通过on`FieldInfo`获得实际值（并且非常相似）。`.GetValue(obj)``FieldInfo``PropertyInfo`

问题是评估`.Expression`非常棘手；-p

显然，如果结果是 - 你会很幸运`ConstantExpression`- 但​​在大多数情况下并非如此；它可以是 a `ParameterExpression`（在这种情况下，您需要知道要评估的实际参数值），或`Expression`s 的任何其他组合。

在许多情况下，一个简单的（也许是懒惰的）选项是使用`.Compile()`.NET 框架来完成繁重的工作；然后，您可以将 lambda 评估为类型化委托（传入 lambda 所需的任何参数）。然而，这并不总是一种选择。

展示这有多复杂；考虑这个简单的例子（我在每一步都进行了硬编码，而不是测试等）：

```
using System;
using System.Linq.Expressions;
using System.Reflection;
class Foo
{
    public string Bar { get; set; }
}

static class Program
{
    static void Main()
    {
        Foo foo = new Foo {Bar = "abc"};
        Expression<Func<string>> func = () => foo.Bar;

        MemberExpression outerMember = (MemberExpression)func.Body;
        PropertyInfo outerProp = (PropertyInfo) outerMember.Member;
        MemberExpression innerMember = (MemberExpression)outerMember.Expression;
        FieldInfo innerField = (FieldInfo)innerMember.Member;
        ConstantExpression ce = (ConstantExpression) innerMember.Expression;
        object innerObj = ce.Value;
        object outerObj = innerField.GetValue(innerObj);
        string value = (string) outerProp.GetValue(outerObj, null);    
    }

} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-27T02:28:33.723

非常感谢上面的 Marc Gravell。我真的很感谢他的帮助。

事实证明，就我而言。该问题可以通过以下方式解决：

```
object value = Expression.Lambda(expBody.Right).Compile().DynamicInvoke(); 
```

再次感谢马克！

# c# - 有没有办法使用 Wpf (C#) 更改 Web 浏览器的上下文菜单

> ID：238768
> 
> 赞同：6
> 
> 时间：2008-10-26T23:07:36.233
> 
> 标签：c#, wpf, xaml, default, contextmenu

我想更改 Web 浏览器控件中提供的默认上下文菜单中的菜单项。我已经尝试过：webbrowser.contextmenu = mycontextmenu。没有改变。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-11-23T00:05:16.590

答案 - 是的。webbrowser 控件中有一个设置：.IsWebBrowserContextMenuEnabled = false;

将此设置为 false 将禁用 IE 上下文菜单，允许您设置的任何一个来统治根。简单的..

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T12:58:19.857

简短的回答是肯定的。

请参阅[有关 codeproject 的这篇文章](http://www.codeproject.com/KB/books/0764549146_8.aspx)。

[这是关于 codeproject 的另一篇（较短的）文章](http://www.codeproject.com/KB/cs/advhost.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-19T23:25:28.090

我正在尝试做同样的事情。我阅读了大约 5 篇 codeproject 文章（顺便说一下，它们有点旧），但无法正确理解 COM 互操作部分。可能是因为我不能用 C++ 编程。

但后来我发现这个页面[http://www.pinvoke.net/default.aspx/Interfaces/IDocHostUIHandler.html](http://www.pinvoke.net/default.aspx/Interfaces/IDocHostUIHandler.html)看起来很有希望。它包含声称提供您想要的功能的 ac# 接口。但是我仍然无法让它一直工作，所以如果其他人可以为这个答案做出贡献，我将不胜感激。

由于我不知道您对 c# 有多熟悉（顺便说一句，我几乎是个菜鸟），所以我将在此处发布一些额外的步骤，使用 VS2008。添加 Microsoft.mshtml 作为对您的项目的引用，创建一个新的 c# 界面，并在界面顶部添加额外的 3 个“使用”语句。

```
using System.Windows;
using System.Runtime.InteropServices;
using mshtml; 
```

并粘贴接口定义的代码。然后让 WebBrowser 容器实现这个接口和所有的方法。这就是我到现在为止的距离。我仍在寻找将浏览器事件重定向到容器的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-05T03:34:31.037

最简洁的答案是不。有关更多详细信息，请参阅[此线程](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/7c283faf-16c8-4b4e-a362-f292e3032abb/)。

# tsql - 在 T-SQL 中的事务期间实现日志记录的最佳方法是什么？

> ID：238782
> 
> 赞同：2
> 
> 时间：2008-10-26T23:19:12.263
> 
> 标签：tsql, logging, sybase, transactions

我想实现一个简单的调试日志，它由一个表组成，我在其中插入有关事务当前状态的有见地的消息。如何停止插入到该表中受到我正在尝试调试的事务的回滚的影响？在 Oracle 中，我可以使用它`PRAGMA AUTONOMOUS_TRANSACTION`来确保插入是在事务之外完成的，但是在 T-SQL 中我有哪些选择？您如何在您的商店中实现登录？

*注意：我没有使用 SQL Server，我使用的是 Sybase 12.5。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T00:17:10.900

终于在网上查到了sybase的手册。根据[文档](http://infocenter.sybase.com/help/index.jsp)，您唯一的出路是通过[RPC](http://www.sybase.com/detail?id=1029418)登录到外部日志服务器。

# php - PHP4：通过 cURL 通过 HTTPS/POST 发送 XML？

> ID：238784
> 
> 赞同：7
> 
> 时间：2008-10-26T23:19:56.147
> 
> 标签：php, xml, curl, https, php4

我编写了一个类/函数来通过 PHP4/cURL 通过 https 发送 xml，只是想知道这是否是正确的方法，或者是否有更好的方法。

请注意，PHP5 目前不是一个选项。

```
/**
 * Send XML via http(s) post
 *
 * curl --header "Content-Type: text/xml" --data "<?xml version="1.0"?>...." http://www.foo.com/
 *
 */
function sendXmlOverPost($url, $xml) {
  $ch = curl_init();
  curl_setopt($ch, CURLOPT_URL, $url);

  // For xml, change the content-type.
  curl_setopt ($ch, CURLOPT_HTTPHEADER, Array("Content-Type: text/xml"));

  curl_setopt($ch, CURLOPT_POST, 1);
  curl_setopt($ch, CURLOPT_POSTFIELDS, $xml);

  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); // ask for results to be returned
  if(CurlHelper::checkHttpsURL($url)) { 
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
  }

  // Send to remote and return data to caller.
  $result = curl_exec($ch);
  curl_close($ch);
  return $result;
} 
```

干杯！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T14:34:14.350

如果您使用的协议是 XML-RPC（根据您所说的看起来很像）并且您至少使用 PHP 4.2，请查看[http://phpxmlrpc.sourceforge.net/](http://phpxmlrpc.sourceforge.net/)以获取库和资源。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-11-29T17:13:30.687

很好的解决方案！在这里也找到了一个类似的：

*   [使用 curl 发布 JSON/XML 数据并在另一端接收](http://www.technoreaders.com/2011/11/29/post-json-xml-data-with-curl-and-receive-it-on-other-end/)

他们还展示了如何在服务器上接收这种 XML/JSON

```
// here you can have all the required business checks
if ( $_SERVER['REQUEST_METHOD'] === 'POST' ){
    $postText = file_get_contents('php://input');
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-29T10:31:59.450

$ch = curl_init($serviceUrl);

```
 if( $this -> usingHTTPS() )
    {
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, $this->sslVerifyHost);

    }

    curl_setopt($ch,CURLOPT_POST,TRUE);
    curl_setopt($ch, CURLOPT_HEADER, FALSE);    
    curl_setopt ($ch, CURLOPT_POSTFIELDS, "OTA_request=".urlencode($this->xmlMessage));

    curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);

    $this->xmlResponse = curl_exec ($ch);   

    $this -> callerFactory -> dbgMsg('xmlResponse: <hr><pre>'.htmlentities($this->xmlResponse).'</pre><hr>'. curl_error($ch));
    curl_close ($ch);

    $this->checkResponse(); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-26T23:27:36.567

使用随大多数 PHP 安装提供的[SoapClient类](http://us2.php.net/manual/en/function.soap-soapclient-construct.php)

一个例子是：

```
$soap = new SoapClient("http://some.url/service/some.wsdl");
$args = array("someTypeName" => "someTypeValue"
              "someOtherTypeName" => "someOtherTypeValue");

$response = $soap->executeSomeService($args);

print_r($response); 
```

# wpf - 使用 Wpf 滚动到 Web 浏览器中的位置

> ID：238792
> 
> 赞同：1
> 
> 时间：2008-10-26T23:29:44.987
> 
> 标签：wpf, indexing, browser, scroll, position

我似乎无法在普通 Windows 窗体中以编程方式在 WPF 中滚动我会使用下面的代码，但 WPF 中不存在该属性。

```
HtmlDocument doc = this.webBrowser1.Document;
doc.Body.ScrollTop = 800;
return; 
```

有没有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T00:03:24.170

不确定要在该代码中查找什么，但我基本上有一个 WebControl，它显示一个包含几篇文章的网页。我想按标题跳转到一篇文章。我知道我可以获取文章名称的索引，但跳转到它是问题所在。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-06-12T02:08:39.510

这个怎么样？

```
if (wb.Document is mshtml.HTMLDocument htmlDoc)
{
    htmlDoc.parentWindow.scrollTo(0, 0);
} 
```

# c# - 如何使用 linq to sql 将 xml 文件存储在 xml 列中？

> ID：238793
> 
> 赞同：2
> 
> 时间：2008-10-26T23:30:41.507
> 
> 标签：c#, xml, linq-to-sql

我有要读取并存储在数据库中的 xml 文件。Linq to sql 需要使用 xelement 发送数据，但如果我发送数据

```
new XElement("build", BuildNode.InnerXml) 
```

我最终在数据库中得到了这样的数据 lt;..gt;.. 它将括号转换为 lt; 和GT; 从 xml 的角度来看，这会使数据变得无用。

关于如何在 xml 列中获取 xml 数据的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T00:44:58.953

看起来您应该使用 XElement.Parse(BuildNode.InnerXml) 而不是只传入原始属性。

回复：http : [//social.msdn.microsoft.com/Forums/en-US/csharplanguage/thread/413654f3-dc2d-4b96-8a7e-bde69da05866/](http://social.msdn.microsoft.com/Forums/en-US/csharplanguage/thread/413654f3-dc2d-4b96-8a7e-bde69da05866/)

# php - 使用 PHP 更新 MySQL 字段的问题

> ID：238800
> 
> 赞同：2
> 
> 时间：2008-10-26T23:38:53.520
> 
> 标签：php, mysql

我有一个查询：

更新选择 SET 投票 = 投票 + 1 WHERE choice_id = '$user_choice'

但是当我在我的脚本中执行它时，投票字段会更新两次，因此投票将从 4 变为 6 而不是 5。它似乎没有被调用两次，因为我回显了一些东西来测试它，而且只有得到一个回声。有没有办法让PHP在每页“刷新”时只执行一次这个查询？

**编辑**：感谢您的回复，我使用的是常规 MySQL，没有 MySQLi 或 PDO。我发现的另一件事是，在进行查询时，当您从 0 开始并更新为 1 时，它会起作用，但之后它会变为 3、5、7，...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T13:35:34.297

另一种选择是，如果您使用的是 firefox 并安装了 firbug，则需要禁用缓存。由于某种原因 firbug 导致对 dB 的两次调用。花了数周时间才弄清楚我在哪里工作，因为 QA 在测试时得到了各种奇怪的结果。他是唯一一个有萤火虫的人。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T23:43:53.540

PHP中有许多不同品牌的数据库有几个SQL接口。您没有显示用于执行查询的 PHP 代码，也没有确定您使用的数据库品牌。

在 PHP 的一些 SQL 接口中，创建语句会隐式执行 SQL。然后你就有机会获取结果（如果它是一个 SELECT 语句）。如果您的语句是 SELECT 或 DELETE，则可能没有造成任何损害，尽管不必执行该语句两次。但是，如果您的语句是 INSERT 或 UPDATE，您可能会发现它已经生效了两次。

例如，使用 PDO：

```
$pdo = new PDO(...options...);
$stmt = $pdo->query('UPDATE ...'); // executes once
$stmt->execute(); // executes a second time 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T23:54:52.363

这个答案是一个矫枉过正，但你可以确保它被执行两次，通过在你的 mysql 中启用二进制日志（记住，矫枉过正！）。然后您可以使用 mysqllog 工具查看这些文件并查看查询是否执行了两次。

每个人都相信你的代码中的某个地方被查询了两次 :) 我正在使用这样的查询并且它运行良好。另一件事，我的 PEAR_DB 对象有一个包装类。如果需要，它可以输出渲染当前页面时使用的查询（和时间戳+堆栈跟踪）。我用它来查找重复的查询（比如你的）和缓慢的更新。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T06:03:09.717

首先，您需要进行正确的查询：

```
UPDATE `choices` SET `votes` = `votes` + 1 WHERE `choice_id` = '$user_choice' 
```

此查询必须正常工作。也许您在 PHP 代码中遇到错误并且此查询执行了两次？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T06:25:32.043

您可能只需要将括号括起来，`votes + 1`例如：

```
UPDATE choices SET votes = (votes + 1) WHERE choice_id = '$user_choice'; 
```

我也可以`LIMIT 1`在最后放一个。

此外，是否尝试过在 PHP 之外运行查询，例如通过 PHPMyAdmin？另外，请在运行之前尝试完整地回显您的 SQL……您可能会发现一个错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T07:11:57.097

我刚刚创建了一个数据库表来测试这个查询，我必须说它在我这边运行良好。

> 更新`choices`集`votes`=（投票+1）哪里`choice_id`='1'

我认为代码在您的应用程序中执行了两次，您可以尝试在运行时打印出 sql。您还可以针对您的数据库本地运行输出的 sql 语句。

总而言之，sql语句很好，只需将您的应用程序脚本加倍即可。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T07:20:40.497

我只是在这里猜测，但也许这个代码对页面上使用的每个资源执行一次？因此，如果您有一个使用相同代码的图像或 iframe，两个资源都会执行一次，从而导致该字段被更新两次。

上周我在基于 PDO 的会话处理程序中遇到了这个问题，我的测试计数器会触发两次，因为站点徽标也由 php 提供，并且我正在更新 auto_prepend_file 中的测试计数器。

# asp.net - ASP.NET Dropdownlist selectedindexchanged 事件未在向上/向下箭头上触发

> ID：238812
> 
> 赞同：7
> 
> 时间：2008-10-26T23:48:49.130
> 
> 标签：asp.net, events, drop-down-menu

[我在Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)更新面板中有一个服务器下拉列表。当我使用鼠标单击一个项目时，它会触发回发，但是当我单击向上/向下箭头更改条目时，它不会触发。可能是什么原因？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-27T02:33:11.373

尝试将DropDownList 控件的“ **AutoPostBack ”属性设置为“** **true** ”。

```
<asp:DropDownList ID="DropDownList1" runat="server" AutoPostBack="true">
</asp:DropDownList> 
```

有关详细信息，请参阅[MSDN 上的 ListControl.AutoPostBack 属性](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.autopostback%28v=vs.110%29.aspx)

> 获取或设置一个值，该值指示当用户更改列表选择时是否自动回发到服务器。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-27T02:18:05.367

试试这个：

```
<asp:DropDownList ID="DropDownList1" runat="server" AutoPostBack="True" 
OnSelectedIndexChanged="DropDownList1_SelectedIndexChanged" onKeyUp="this.blur();"> 
```

使用**onKeyUp="this.blur();"** 当未按下某个键时，控件将失去焦点，这将触发 onChange 事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T23:51:55.647

如果您使用键盘来触发事件，我认为您必须离开控件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T00:40:30.570

如果您希望它与箭头键一起使用，则应使用客户端事件`onKeyDown`.

# iphone - iPhone SDK 中的 Tell-A-Friend 形式

> ID：238814
> 
> 赞同：2
> 
> 时间：2008-10-26T23:50:19.970
> 
> 标签：iphone

我正在尝试在 AppStore 中构建一个游戏内告诉朋友的表单。有人知道它是否可以在 SDK 中的任何地方找到吗？我不想重新发明切片面包。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T09:05:27.947

除了编写自己的 SMTP 客户端之外，您还可以创建一条消息，然后通过使用 openURL 向邮件应用程序发送一个 URL 来退出您的应用程序。

```
NSURL *url = [[NSURL alloc] initWithString: @"mailto:gilm@myopenid.com?subject=subject&body=body"];
[[UIApplication sharedApplication] openURL:url]; 
```

然后用户检查内容并发送消息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-01-16T18:55:43.453

在您的 .h 文件中导入 MessageUI 和 MFMailComposerViewController：
`#import <MessageUI/MessageUI.h>`
`#import <MessageUI/MFMailComposeViewController.h>`
您需要通过添加使您的 viewController MFMailComposeViewControllerDelegate：`<MFMailComposeViewControllerDelegate>`如下所示：

```
@interface tellAFriend : UIViewController <MFMailComposeViewControllerDelegate> { 
```

还为告诉朋友做一个 IBAction：
`-(IBAction)tellAFriend;`
**UPDATE**
对于 SMS，还添加：
`-(IBAction)tellAFriendViaSMS;`

* * *

然后进入您的 .m 并添加以下代码：

```
-(IBAction)tellAFriend {

if ([MFMailComposeViewController canSendMail]) {

MFMailComposeViewController *mailView = [[MFMailComposeViewController alloc] init];
mailView.mailComposeDelegate = self;
[mailView setSubject:@"Check Out your_app_name_here"];
[mailView setMessageBody:@"Check out your_app_name_here <br> It's really cool and I think you would like it." isHTML:YES];

[self presentModalViewController:mailView animated:YES];
[mailView release];

}

else {

NSLog(@”Mail Not Supported”);

}

}

-(void)mailComposeController:(MFMailComposeViewController*)controller didFinishWithResult MFMailComposeResult)result error  NSError*)error {

[self dismissModalViewControllerAnimated:YES];

} 
```

* * *

**更新** 您还可以使用以下代码发送短信：

```
-(IBAction)tellAFriendViaSMS {
MFMessageComposeViewController *controller = [[[MFMessageComposeViewController alloc] init] autorelease];
if([MFMessageComposeViewController canSendText])
{
    controller.body = @"Check Out your_app_name_here, itunes_link_here";
    controller.recipients = [NSArray arrayWithObjects:@"phoneNumbersHere", @"PhoneNumberTwo", nil]; // Optional
    controller.messageComposeDelegate = self;
    [self presentModalViewController:controller animated:YES];
}
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-15T17:22:12.630

与此同时，iPhone SDK 中有一些新的 API，包括 MessageKit.framework。该框架使得添加 MFMailComposeViewController 成为可能。

希望有效，蒂姆

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T01:20:27.823

SDK中没有这样的东西，抱歉。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-27T09:56:12.057

正如 Ben 所说，不，SDK 中没有类似的东西。我的猜测是永远不会。我想这个功能是在服务器端实现的，这可能是最好的选择。

# svn - 如何将存储库从 Unfuddle 复制到本地 SVN 服务器？

> ID：238815
> 
> 赞同：4
> 
> 时间：2008-10-26T23:51:54.007
> 
> 标签：svn, version-control, unfuddle

我目前在 Unfuddle 上托管了几个 SVN 存储库，我希望有一个存储库的本地副本作为备份。理想情况下，这将是一个“实时”备份，因此我的本地存储库将“ping”远程存储库，如果检测到任何更改，这些更改将应用​​于我的本地存储库。

有没有人试过这个？如果是这样，使用什么工具来完成这项工作？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T00:42:42.157

Try [`svnsync`](http://svn.collab.net/repos/svn/trunk/notes/svnsync.txt)，它会创建存储库的完整镜像。`svnsync sync`将仅下载新修订版。还有一个`svn-mirror`，它做同样的事情。

Git[`git-svn`](http://git-scm.com/docs/git-svn)也是一种选择。

我已经使用了`svnsync`和`git-svn`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T00:27:33.950

我只会创建一个运行 PowerShell 脚本/BAT 文件的计划任务，以便为您的每个存储库执行 svn 更新。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T00:34:39.757

*要创建存储库*的副本（即：所有修订均完好无损），我认为您可能必须执行完整的备份/下载/恢复周期。有一些方法可以对存储库进行增量复制（通过`svnadmin dump`或`svnadmin hotcopy`），但我怀疑 Unfuddle 会让您访问这些。

# asp.net - asp.net - 管理数据库表的 Web 前端 - 添加、删除、更新

> ID：238821
> 
> 赞同：2
> 
> 时间：2008-10-27T00:00:15.893
> 
> 标签：asp.net, ms-access

我有一个我想让我的朋友更新的数据库表。拥有一个简单的 asp.net 页面的最快方法是映射到数据库中的每个字段并允许添加、删除和更新的表单。我认为应该有一个开箱即用的解决方案，而不必编写每个控件等。.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T02:15:44.700

ASP.NET 动态数据。建立一个数据模型，就是这样。如果需要，请创建自定义模板。

[http://www.asp.net/dynamicdata/](http://www.asp.net/dynamicdata/)

# java - 从java中的http请求中获取文件

> ID：238824
> 
> 赞同：7
> 
> 时间：2008-10-27T00:03:15.857
> 
> 标签：java, http, request

如何调用 url 来处理结果？

我有一个独立的报告 servlet，我链接到该 servlet 以获取报告。我现在想通过电子邮件发送这些报告，如果我在浏览器中执行此操作，我可以使用 xhttprequest 并处理结果 - 我基本上想在 Java 中做同样的事情，但我不知道该怎么做它。

**更新**：我希望从 url 中取回一个文件（无论是 pdf 还是 html 等）。

**更新**：这将纯粹在服务器上运行 - 没有触发电子邮件的请求，而是预定的电子邮件。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-27T00:32:33.613

```
public byte[] download(URL url) throws IOException {
    URLConnection uc = url.openConnection();
    int len = uc.getContentLength();
    InputStream is = new BufferedInputStream(uc.getInputStream());
    try {
        byte[] data = new byte[len];
        int offset = 0;
        while (offset < len) {
            int read = is.read(data, offset, data.length - offset);
            if (read < 0) {
                break;
            }
          offset += read;
        }
        if (offset < len) {
            throw new IOException(
                String.format("Read %d bytes; expected %d", offset, len));
        }
        return data;
    } finally {
        is.close();
    }
} 
```

编辑：清理代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T00:05:49.300

查看 URL 和 URLConnection 类。这是一些文档：[http ://www.exampledepot.com/egs/java.net/Post.html](http://www.exampledepot.com/egs/java.net/Post.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T00:24:22.100

如果打算在您的 servlet 执行时运行另一个资源而不将控制权转移到另一个资源，您可以尝试使用 include(request, response)。

```
RequestDispatcher dispatcher =
   getServletContext().getRequestDispatcher("/url of other resource");
if (dispatcher != null)
   dispatcher.include(request, response);
} 
```

您可以将它放在一个 servlet 上，而其他资源的结果将包含在您的 servlet 中。

编辑：由于您正在寻找一个文件，那么这个解决方案也适用于此。

# c# - 如何将数据行写入 xml 文件

> ID：238829
> 
> 赞同：1
> 
> 时间：2008-10-27T00:04:23.060
> 
> 标签：c#, xml

这是故事。我正在做一个程序，每次关闭程序时，用户创建的所有数据（文件链接）都会丢失，所以每当用户重新打开程序时，他确实必须重新完成所有工作。

所以我决定使用 xml 文件来存储数据，因为 dbms 加载时间太长，并且处理纯文本文件的代码很难维护。

数据主要由 Links 组成，其中存储了两个文件路径，一个为源，一个为目标，一个布尔值表示程序关闭前的链接状态，以及其他一些不太重要的东西。

当程序加载数据时，应读取数据以恢复应用程序的先前状态。

所以我做了一个这样的xml文件：

```
...
  <Directories>
    <Directory id="0">
      <FilePath>C:\Test1</FilePath>
      <PathSeparator>\</PathSeparator>
    </Directory>
... 
```

并使用 DataSet 来获取数据。

```
Directory getDirectory()
{
    ds = new DataSet();
                ds.ReadXml(xmlPath);
    DataRow[] myRow = ds.Tables["Directory"].
                Select("id ="+id.ToString());// "id = id"
    string temp = myRow[0]["FilePath"].ToString();
    Directory result = new Directory();
    result.path = temp;
    temp = myRow[0]["PathSeparator"].ToString();
    result.pathSeparator = temp[0];
    return result;
} 
```

所有这些都很好，但后来我尝试向 xml 添加新的“行”：

```
public static int addDirectory(DataSet ds, char pathSeparator, string path)
{
    DataRow myRow = ds.Tables["Directory"].NewRow();
    myRow.ItemArray[0] = 8;
    myRow.ItemArray[1] = path;
    myRow.ItemArray[2] = pathSeparator.ToString();
    myRow.ItemArray[3] = "lol";
    ds.Tables["Directory"].Rows.Add(myRow);
    ds.AcceptChanges();
    ds.WriteXml(ApplicationDataManager.xmlPath);
    return 8;
} 
```

但是所有这些写入都是在 .xml 上的一个随机位置

我究竟做错了什么？

顺便说一句，如果有人对我应该如何存储这些数据有任何建议，我会很高兴听到（阅读）。

提前致谢！

[更新] 文件链接用于创建两个目录之间的连接，因此它们可以同步。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T00:38:09.983

如果 LINQ 在您的工具箱中，我强烈建议使用它来读取/写入 xml，而不是 DataTable。它更加流畅和直观，您可以控制节点的位置......无论您将它们添加到集合中的任何位置，它们都会出现在生成的 XML 中。

这是一个快速介绍，如果您稍微搜索一下，网上就会有大量关于它的信息：http: [//www.hookdonlinq.com/LINQtoXML5MinuteOverview.ashx](http://www.hookedonlinq.com/LINQtoXML5MinuteOverview.ashx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T00:39:11.573

如果您想要一种快速而肮脏的方式，最好的选择是将用户信息加载到数据集中，调用“WriteXml”方法保存并使用“ReadXml”将其拉回。DataSet 自己使用的 XML 格式将以相同的格式进出。

您还有许多其他选择，但 DataSet 是最快速和最肮脏的方式。

# php - CakePHP 和 Flex - 它们可以集成吗？如果可以，是丑还是好？

> ID：238839
> 
> 赞同：0
> 
> 时间：2008-10-27T00:13:27.147
> 
> 标签：php, apache-flex, cakephp, frameworks

我在看一个新项目，我们想要使用 Flex（提供与 AIR 的轻松集成并为我们的项目提供桌面应用程序）。CakePHP 与 Flex 一起玩有多容易，或者是否有更好的 PHP 框架与 Flex 一起使用，或者我们应该不使用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T18:14:11.863

任何基于 PHP 的东西都可以从[AMFPHP](http://www.amfphp.org/)中受益。

[Cakeforge](https://cakeforge.org/projects/cakeamfphp/)中有一个项目试图创建那个桥，虽然我认为它有点过时了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T20:00:51.897

我是 Rails + Flex 的人，但 IIRC、CakePHP 与 Rails 非常相似。假设这是真的，MVC 架构与 Flex 前端配合得非常好。

实际上，Flex 应用程序和常规 HTML 应用程序之间的唯一区别是返回 XML 供 Flex 解释，而不是返回 HTML 供浏览器解释。从这个角度来看，将 Flex 与任何 MVC 框架搭配使用比使用扁平 PHP 更好。

# ruby - 修补 Ruby 的基类（例如 Fixnum）是否可以接受？

> ID：238878
> 
> 赞同：17
> 
> 时间：2008-10-27T01:01:17.220
> 
> 标签：ruby, monkeypatching

我对 Ruby 还是很陌生（通读 Pickaxe 并且大部分时间都花在`irb`了修补 Ruby 的基类。例如：我[在这里](https://stackoverflow.com/questions/238684/subtract-n-hours-from-a-datetime-in-ruby#238718)回答了另一个 Ruby 问题，发帖人想知道如何从`DateTime`. 由于`DateTime`该类似乎没有提供此功能，因此我发布了一个答案，该答案将修补`DateTime`和`Fixnum`类作为可能的解决方案。这是我提交的代码：

```
require 'date'

# A placeholder class for holding a set number of hours.
# Used so we can know when to change the behavior
# of DateTime#-() by recognizing when hours are explicitly passed in.

class Hours
   attr_reader :value

   def initialize(value)
      @value = value
   end
end

# Patch the #-() method to handle subtracting hours
# in addition to what it normally does

class DateTime

   alias old_subtract -

   def -(x) 
      case x
        when Hours; return DateTime.new(year, month, day, hour-x.value, min, sec)
        else;       return self.old_subtract(x)
      end
   end

end

# Add an #hours attribute to Fixnum that returns an Hours object. 
# This is for syntactic sugar, allowing you to write "someDate - 4.hours" for example

class Fixnum
   def hours
      Hours.new(self)
   end
end 
```

我修补了这些类，因为我认为在这种情况下，它会产生一种清晰、简洁的语法，用于从`DateTime`. 具体来说，由于上述代码，您可以执行以下操作：

```
five_hours_ago = DateTime.now - 5.hours 
```

看起来很漂亮，也很容易理解；但是，我不确定弄乱`DateTime`'`-`运算符的功能是否是个好主意。

对于这种情况，我能想到的唯一选择是：

**`DateTime`1\. 简单地即时创建一个新对象，在调用中计算新的小时值`new`**

```
new_date = DateTime.new(old_date.year, old_date.year, old_date.month, old_date.year.day, old_date.hour - hours_to_subtract, date.min, date.sec) 
```

**2\. 编写一个实用方法，接受 a`DateTime`和要从中减去的小时数**

基本上，只是方法（1）的包装：

```
def subtract_hours(date, hours)
  return DateTime.new(date.year, date.month, date.day, date.hour - hours, date.min, date.sec)
end 
```

**3.添加一个新的方法来`DateTime`代替改变现有的行为`#-()`**

也许是`DateTime#less`一种可以与`Fixnum#hours`补丁一起使用的新方法，以允许这样的语法：

```
date.less(5.hours) 
```

* * *

然而，正如我已经提到的，我采用了修补方法，因为我认为它会产生更具表现力的语法。

我的方法有什么问题吗，或者我应该使用 3 种替代方法中的一种（或我没有想到的另一种）来做到这一点？我感觉打补丁正在成为我解决 Ruby 问题的新“锤子”，所以我想就我是否以“Ruby 方式”做事得到一些反馈。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-27T02:03:39.547

我个人的回答，简而言之：[核心级修补锤应该在工具箱的底部](http://avdi.org/devblog/2008/02/25/full-disclosure/)。您可以使用许多其他技术，并且几乎在所有情况下它们都足够、更清洁、更[可持续](http://avdi.org/devblog/2008/03/25/sustainable-development-in-ruby-introduction/)。

不过，这实际上取决于您编码的环境。如果这是一个个人项目——当然，随心所欲！当您与一大群程序员长时间处理大型代码库时，问题就开始出现了。在我工作的组织中，拥有超过 100KLOC 的 Ruby 代码库和大约 20 名开发人员，我们已经开始严厉打击猴子补丁，因为我们已经看到它会导致令人头疼、浪费工时的行为太频繁了。在这一点上，我们几乎只能容忍它临时修补尚未合并或不会合并我们的源补丁的第三方代码。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-27T01:06:42.407

个人认为，在基类中添加方法是可以接受的，但是修改现有方法的实现是不能接受的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-27T01:56:37.063

最*安全*的方法是定义你自己的继承自内置类的类，然后将你的新东西添加到你的新类中。

```
class MyDateTime < DateTime
  alias...
  def... 
```

但显然，现在只有声明新类的对象才能获得新行为。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T01:14:26.960

我认为它是这样的：如果你真的觉得大多数其他程序员会同意你的补丁，那很好。如果没有，也许您应该改为实现代码库？

# iphone - 如何重新格式化 PDF 文件以便在 iPhone 上阅读？

> ID：238879
> 
> 赞同：1
> 
> 时间：2008-10-27T01:01:49.483
> 
> 标签：iphone, pdf, ipod-touch

我想在我的 iPod Touch（或 iPhone）上以合理的字体大小阅读任意 PDF。一些 PDF 已经格式化为窄列和宽边距。一旦我缩放文档以“删除”边距，文本就很容易阅读。

大多数文档都有一列非常宽的文本。当我放大到足以使文本可读时，该列比屏幕大，我必须在每一行上左右滚动才能阅读。不可行。

我想运行一个程序来将我的宽栏 PDF 转换为窄栏 PDF。我研究了许多 PDF 库（例如 Mac OS X 上的 PDFKit），但它们似乎都专注于显示或创建 PDF。

你能指出我阅读 PDF 文本的任何资源吗？我宁愿编写自己的实用程序也不愿购买产品，但如果这是唯一的方法，我会接受产品。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T02:50:27.267

我一直在使用名为 Stanza 的 iPhone 应用程序来执行此操作。我是从应用商店免费获得的。有一个[桌面版本](http://www.lexcycle.com/)可以将 pdf 转换为可以在 iPhone 屏幕上使用 Stanza 轻松阅读的文件。

Stanza 的主要用途是下载公共​​领域的书籍并在 iPhone 上阅读它们，但 PDF 到 iPhone 的转换也很有效。但是，我不确定它在处理图形繁重的文档时效果如何。

# python - 如何在 MacOs X 10.5 上安装 plpython？

> ID：238882
> 
> 赞同：1
> 
> 时间：2008-10-27T01:03:40.603
> 
> 标签：python, macos, postgresql

我刚刚在 Mac OS X 10.5（使用端口）上安装了 PostgreSQL 8.3.4，但我不知道如何启用 PL/Python。当我运行时，`CREATE LANGUAGE plpythonu`我收到以下错误：

```
ERROR:  could not access file "$libdir/plpython": No such file or directory
STATEMENT:  CREATE LANGUAGE plpythonu;
psql:<stdin>:18: ERROR:  could not access file "$libdir/plpython": No such file or directory 
```

我该如何解决？理想情况下，我宁愿避免在没有`port`或类似的情况下编译 Postgres。

Thia 运行 pg_config 的输出：

```
BINDIR = /opt/local/lib/postgresql83/bin
DOCDIR = 
INCLUDEDIR = /opt/local/include/postgresql83
PKGINCLUDEDIR = /opt/local/include/postgresql83
INCLUDEDIR-SERVER = /opt/local/include/postgresql83/server
LIBDIR = /opt/local/lib/postgresql83
PKGLIBDIR = /opt/local/lib/postgresql83
LOCALEDIR = 
MANDIR = /opt/local/share/man
SHAREDIR = /opt/local/share/postgresql83
SYSCONFDIR = /opt/local/etc/postgresql83
PGXS = /opt/local/lib/postgresql83/pgxs/src/makefiles/pgxs.mk
CONFIGURE = '--prefix=/opt/local' '--sysconfdir=/opt/local/etc/postgresql83' '--bindir=/opt/local/lib/postgresql83/bin' '--libdir=/opt/local/lib/postgresql83' '--includedir=/opt/local/include/postgresql83' '--datadir=/opt/local/share/postgresql83' '--mandir=/opt/local/share/man' '--without-docdir' '--with-includes=/opt/local/include' '--with-libraries=/opt/local/lib' '--with-openssl' '--with-bonjour' '--with-readline' '--with-zlib' '--with-libxml' '--with-libxslt' '--enable-thread-safety' '--enable-integer-datetimes' '--with-ossp-uuid' 'CC=/usr/bin/gcc-4.0' 'CFLAGS=-O2' 'CPPFLAGS=-I/opt/local/include -I/opt/local/include/ossp' 'CPP=/usr/bin/cpp-4.0' 'LDFLAGS=-L/opt/local/lib'
CC = /usr/bin/gcc-4.0 -no-cpp-precomp
CPPFLAGS = -I/opt/local/include -I/opt/local/include/ossp -I/opt/local/include/libxml2 -I/opt/local/include
CFLAGS = -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Winline -Wdeclaration-after-statement -Wendif-labels -fno-strict-aliasing -fwrapv
CFLAGS_SL = 
LDFLAGS = -L/opt/local/lib -L/opt/local/lib -L/opt/local/lib
LDFLAGS_SL = 
LIBS = -lpgport -lxslt -lxml2 -lssl -lcrypto -lz -lreadline -lm 
VERSION = PostgreSQL 8.3.4 
```

（几天前我刚从 Linux 切换到*Mac* ......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T01:20:29.633

傻我：

```
[lib/postgresql83] > variants postgresql83
 postgresql83 has the variants:
    universal
    python: add support for python
    krb5: add support for Kerberos 5 authentication
    perl: add Perl support 
```

（我有过`universal`。）

这意味着您必须安装正确的 PostgreSQL 变体才能使您的 python 函数运行起来。

```
$ sudo port install postgresql83 +python postgresql-server +python 
```

# php - 正则表达式 - 匹配所有具有可选属性的锚点

> ID：238891
> 
> 赞同：7
> 
> 时间：2008-10-27T01:07:58.207
> 
> 标签：php, regex

我的后端有一个所见即所得的编辑器，它让我写的第一个正则表达式出错了。这是在 PHP4 中，使用`preg_replace()`. 我正在捕获 URI 和链接文本。

```
@<a\shref=\"http[s]?://([^\"]*)\"[]>(.*)<\/a>@siU 
```

客户希望所有外部链接在新窗口中打开，所以这就是我用来查找所有（希望）外部链接的表达式，但保留内部、页面锚链接等

我意识到`style="font-weight: bold"`如果用户在链接上选择粗体，所见即所得编辑器也会添加。我最近才开始学习正则表达式，所以我不确定如何解决这个问题。

我该怎么做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-27T01:12:10.820

这应该可以匹配：

```
/<a\s+([^>]*)href="https?:\/\/([^"]*)"(.*?)>(.*?)<\/a>/ 
```

这里有用的是惰性匹配。`*?`这意味着它只会匹配它绝对需要的数量，而不是贪婪的常规匹配。

为了演示，用这个文本：

> `a b c d a b c d`

这些正则表达式会有不同的结果：

```
/a.*c/    selects: "a b c d a b c"
/a.*?c/   selects: "a b c" 
```

# verilog - 如何在verilog中将数字转换为二进制补码？

> ID：238894
> 
> 赞同：4
> 
> 时间：2008-10-27T01:10:19.527
> 
> 标签：verilog, circuit, hdl

我正在尝试在 verilog 中设计一个 4 位加法减法器。这只是我用verilog 写的第二件事，而且我还不知道所有正确的语法。这是我到目前为止的模块：

```
module Question3(carryin, X, Y, Z, S, carryout, overflow);
    parameter n = 4;
    input carryin, Z;
    input [n-1:0]X, Y;
    output reg [n-1:0]S;
    output reg carryout, overflow;

    if(Z==0)
    begin
        Y = not(y) + 4'b0001;
    end

    always @(X, Y, carryin)
        begin
            {carryout, S} = X + Y + carryin;
            overflow = carryout ^ X[n-1]^Y[n-1]^S[n-1];
        end

endmodule 
```

我的编译器（xilinx 10.1）一直说“if 附近出现语法错误”。我尝试了许多不同的转换方法，包括仅使用以 Y 作为参数的 Case，然后检查所有可能的 4 位组合，并将它们转换为二进制补码。

Z 决定加法器是做减法还是加法。如果为 0，则表示减法，我想将 y 转换为二进制补码，然后进行常规加法。我确定加法器的其余部分是正确的，我只是不知道我要转换的部分有什么问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-17T06:41:45.057

```
reg [n-1:0] Y_compl;

always @( Z, Y, X, carryin ) begin
  Y_ = ( ~Y + 4'b0001 );
  if ( Z == 1'b0 ) begin
    {carryout, S} = X + Y_compl + carryin;
    overflow = carryout ^ X[n-1] ^ Y_compl[n-1] ^ S[n-1];
  end
  else begin
    {carryout, S} = X + Y + carryin;
    overflow = carryout ^ X[n-1] ^ Y[n-1] ^ S[n-1];
  end

end 
```

几个重要的点。

1.  将 if 语句放在 always 块中。不要使用两个 always 块，您将在模拟器中创建竞争条件。
2.  我创建了一个新变量 Y_，因为使用 Y，它是一个输入，记住，在赋值的左侧可能会推断出锁存器或在你合成时做其他讨厌的事情。
3.  如果使用 'not' 原语，我建议使用按位反转运算符 '~' 来反转 Y。综合工具可以更自由地以这种方式优化您的代码。
4.  仔细检查结果是否正确，自从我构建加法器以来已经有一段时间了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T01:56:21.230

您在“Y = not(y) + 4'b0001;”中使用了小写“y”

此外，您使用的添加量超出了您的需要。XY 与 NOT(NOT(X)+Y) 相同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T02:26:21.043

将 if 语句放在初始块中
[http://www.asic-world.com/verilog/vbehave1.html](http://www.asic-world.com/verilog/vbehave1.html)

# c# - 如何从剪贴板获取正确编码的 HTML？

> ID：238898
> 
> 赞同：9
> 
> 时间：2008-10-27T01:13:16.667
> 
> 标签：c#, winforms, encoding, clipboard

有没有人注意到，如果你从剪贴板中检索 HTML，它会得到错误的编码并注入奇怪的字符？

例如，执行如下命令：

```
string s = (string) Clipboard.GetData(DataFormats.Html) 
```

结果如下：

```
<FONT size=-2>Â Â <A href="/advanced_search?hl=en">Advanced 
Search</A><BR>Â Â <A href="/preferences?hl=en">Preferences</A><BR>Â Â <A 
href="/language_tools?hl=en">Language 
Tools</A></FONT> 
```

*不确定 MarkDown 将如何处理这个，但上面生成的标记中有奇怪的字符。*

该错误似乎与 .NET 框架有关。您认为从剪贴板获取正确编码的 HTML 的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-09-28T15:07:51.950

在这种情况下，它不像我的情况那样明显。今天我试图从剪贴板复制数据，但有几个 unicode 字符。我得到的数据就好像我会以 Windows-1250 编码*（我的 Windows 中的本地编码）*读取一个 UTF-8 编码的文件。

看来你的情况是一样的。如果您在 Windows-1252 *（或 Windows-1250；两者都有效）中保存 html 数据**（请记住在 Â 字符后放置不可破坏的空格 = 0xa0，而不是标准空格*） 。然后将此文件作为 UTF-8 文件打开，您将看到应该有什么。

 *对于我的另一个项目，我制作了一个修复编码损坏的数据的函数。

在这种情况下，简单的转换就足够了：

```
byte[] data = Encoding.Default.GetBytes(text);
text = Encoding.UTF8.GetString(data); 
```

我的原始函数有点复杂，并且包含确保数据不损坏的测试......

```
public static bool FixMisencodedUTF8(ref string text, Encoding encoding)
{
  if (string.IsNullOrEmpty(text))
    return false;
  byte[] data = encoding.GetBytes(text);
  // there should not be any character outside source encoding
  string newStr = encoding.GetString(data);
  if (!string.Equals(text, newStr)) // if there is any character "outside"
    return false; // leave, the input is in a different encoding
  if (IsValidUtf8(data) == 0) // test data to be valid UTF-8 byte sequence
    return false; // if not, can not convert to UTF-8
  text = Encoding.UTF8.GetString(data);
  return true;
} 
```

我知道这不是最好的*（或正确的解决方案）*，但我没有找到任何其他方法来修复输入......

**编辑**：*（2017 年 7 月 20 日）*

微软似乎已经发现了这个错误，现在它可以正常工作了。我不确定问题是否出在某些框架中，但我可以肯定的是，当我写答案时，现在应用程序使用了不同的框架。*（现在是 4.5；以前的版本是 2.0）* *（现在我的所有代码都无法解析数据。还有另一个问题是确定应用程序的正确行为，修复已经应用但没有修复。）*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T05:41:57.263

您必须将数据解释为 UTF-8。查看[MS Office 超链接更改代码页？](https://stackoverflow.com/questions/189640/ms-office-hyperlinks-change-code-page).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-06-28T05:47:15.493

**DataFormats.Html** [规范](http://www.i18nqa.com/debug/utf8-debug.html)声明它以 UTF-8 编码。但是 .NET 4 Framework 及更低版本中存在一个错误，它实际上读取为 UTF-8 和**Windows-1252**。

你得到分配错误的编码，导致有趣/坏的字符，如'Å'，'â€¹'，'Å''，'Å½'，'Å¡'，'Å“'，'Å¾'，'Å¸ ','Â','Â¡','Â¢','Â£','Â¤','Â¥','Â¦','Â§','Â¨','Â©'

此处的完整说明 [Debugging Chart Mapping Windows-1252 Characters to UTF-8 Bytes to Latin-1 Characters](http://www.i18nqa.com/debug/utf8-debug.html)

Soln：创建翻译词典并进行搜索和替换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-08T17:15:54.753

我不知道您的原始源文档是什么，但请注意 Word 和 Outlook 以不同的编码提供多个版本的剪贴板。一种通常是 Windows-1252，另一种是 UTF-8。当您期待 Windows-1252（Latin-1 + Smart Quotes）时，您可能会默认获取 UTF-8 编码版本？非 ASCII 字符将显示为多个奇数的 Latin-1 重音字符。大多数“智能引号”不在 Latin-1 集中，在 UTF-8 中通常是三个字节。

你能指定你想要剪贴板内容的编码吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-04-15T22:58:22.807

尝试这个：

```
System.Windows.Forms.Clipboard.GetText(System.Windows.Forms.TextDataFormat.Html); 
```

# delphi - 在 Delphi 中替换可视组件的最佳方法

> ID：238900
> 
> 赞同：10
> 
> 时间：2008-10-27T01:15:12.483
> 
> 标签：delphi, replace, components

在 Delphi 表单中，我想将一个可视组件替换为另一个。示例：我想用来自 3rd 方包的 ElPanel 替换 Panel 组件。

我希望将第一个组件的所有相同属性和事件转移到新组件，并将属于第一个组件的所有组件（例如工具栏、备忘录、状态栏等）最终放置在新组件上正是他们在第一个上的位置。

除了将新组件添加到表单并精心地将每个属性、事件和组件一个接一个地传递给它之外，是否有最好/最简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-27T12:53:07.830

我这样做如下：

1.  右键单击表单并选择（以文本形式查看）。
2.  按 Ctrl + F 搜索 Component 类名，如 TPanel 并将其替换为 TElPanel
3.  切换回表单（以表单形式查看）
4.  在接口部分，将 TPanel 替换为 TElPanel。

如果您有许多组件使用 GExperts 将是更可行的解决方案。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-27T02:31:29.020

您可以使用[GExperts](http://www.gexperts.org)，也可以手动操作。

要手动完成，请在记事本中打开 .dfm 并替换所有类名。（例如，将 TPanel 替换为 TElPanel）。完成所有更改后，使用记事本打开 .pas 文件，然后执行相同操作。

确保将所需的单位添加到您的使用子句中。

然后在 IDE 中打开表单并清理任何不匹配的事件或未知属性问题。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-27T01:21:10.207

如果我记得优秀的免费 G​​Experts 插件就是这样做的。右键单击您的表单并选择“替换组件”。[http://www.gexperts.org](http://www.gexperts.org)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T09:01:53.623

恕我直言，替换组件 GExpert 的最大缺点是它改变了源代码中组件的顺序。这对 VCS 不是很友好。:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T02:34:32.977

如果您在容器中有其他组件，使用 GExperts 进行此替换将导致 IDE 中出现一些丑陋的异常和可能的意外行为。
因此，最好的解决方案是在您想要的位置（IDE 内部或外部）编辑 .dfm 文件并手动替换您想要更改的组件的类型。也许它也会导致一些异常，但 IDE 会管理它们。
如果您在 IDE 中执行此操作，则在切换到设计视图后，如果您立即保存 .dfm，IDE 会要求您更改与您接触的组件相关的变量类型，让您自由地去做。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T09:05:52.880

> 要在文本和二进制 dfm 格式之间进行转换，请使用 Delphi bin\ 目录中的 convert.exe 工具。– Tim Knipe（10 月 28 日 4:15）

您还可以使用表单设计器的上下文菜单 - 至少在 BDS 2006 中。它是最后一个菜单项（德语 IDE 中的“Text-DFM”）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-08T10:32:19.463

在我的项目中，我必须将几十种形式从一组组件转换为另一组。我创建了小的 perl 脚本来转换组件及其属性并进行所有必要的映射。该脚本是快速而肮脏的解决方案，但它是高度可配置的。它扫描项目目录中的所有 dfm 和 pas 文件，并根据您应在 ObjectBeginFound、PropertyFound、ObjectEndFound 过程/事件中提供的规则转换 dfm 组件定义。

DFM 文件应为文本模式。在 Delphi 5 文件上测试。我不知道它是否会与新版本兼容。发现后请发帖。

用法：perl.exe cxdfm.pl > logfile.txt

下载链接 [http://dl.dropbox.com/u/15887789/cxdfm.pl](http://dl.dropbox.com/u/15887789/cxdfm.pl)

# trac - 在私有 TRAC 中管理用户

> ID：238903
> 
> 赞同：3
> 
> 时间：2008-10-27T01:15:37.847
> 
> 标签：trac

是否有用于 trac 的插件启用基于 cookie 的身份验证而不是 http 身份验证，并允许为未知用户保留网站的私密性？

我们希望允许办公室外的客户登录、添加和查看他们项目的票证，但不允许我们其他客户的项目。非技术用户总是对 http 登录框而不是要求用户名和密码的表单感到困惑。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T11:07:33.590

取自其主页：

[Account Manager 插件](http://trac-hacks.org/wiki/AccountManagerPlugin)提供了一些用于管理用户帐户的功能：

*   允许用户注册新帐户
*   通过 HTML 表单而不是使用 HTTP 身份验证登录
*   允许现有用户更改密码或删除其帐户

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T05:28:06.810

我在 Account Manager 插件上使用了第二个反垃圾邮件。此外，如果您的 trac 需要面向 Web，您可能对 auth required 插件感兴趣。请注意，它还没有升级到 0.11，我怀疑存在一些小的兼容性问题。它确实可以完成这项工作。

# sql-server-2005 - 什么可能导致 IDENTITY 列损坏？

> ID：238913
> 
> 赞同：7
> 
> 时间：2008-10-27T01:30:27.023
> 
> 标签：sql-server-2005, identity

昨天我遇到了一个不寻常的问题，我突然无法将记录插入到带有标识列的表中。

像这样的简单插入：INSERT INTO MyTable (Column1, Column2) VALUES ('text', 236764)

开始引发主键约束违规。

我在表上运行 DBCC CHECKIDENT，并意识到 SQL Server 已停止更新最后使用的值，因此在插入时它使用旧值递增，而新的标识值通常已经存在于表中，因此出现违规错误.

解决问题不是问题，我只是为表重新设置了下一个最高序列号，但我以前从未见过这种情况！

有谁知道什么可能导致 SQL Server 停止更新身份属性，以及我可以在哪里寻找证据？不涉及复制或任何触发器，它只是一个普通的旧表。

编辑：SQL Log Rescue 本来是理想的，但它只适用于 SQL Server 2000。SQL 2005 日志是否有类似的工具？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T03:56:43.450

如果有人使用[SET IDENTITY_INSERT ON](http://msdn.microsoft.com/en-us/library/aa259221(SQL.80).aspx)插入到表中，则绝对可能有人为表输入了无效值。那将是我的第一个猜测。您可以使用[SQL Log Rescue](http://www.red-gate.com/products/SQL_Log_Rescue/index.htm)之类的日志分析器通过事务日志及时回溯，看看您是否可以找到谁是坏人谁弄乱了您的数据......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T04:57:14.640

我认为 SET IDENTITY_INSERT ON 重新植入身份。

来自 BOL

> 如果插入的值大于表的当前标识值，SQL Server 会自动使用新插入的值作为当前标识值。

我可以重现此问题的唯一方法是使用 DBCC CHECKIDENT 手动将种子设置得太低。

# asp.net - 是什么导致“无法取消注册 UpdatePanel”错误？

> ID：238915
> 
> 赞同：12
> 
> 时间：2008-10-27T01:48:27.313
> 
> 标签：asp.net, asp.net-ajax, updatepanel

我有一个包含 UpdatePanel 的 UserControl。当我把它放在页面上时，它会引发以下错误：

> 无法取消注册 ID 为“ReviewContentUpdatePanel”的 UpdatePanel，因为它未在 ScriptManager 中注册。如果从控件树中删除 UpdatePanel 并稍后再次添加，则可能会发生这种情况，这是不受支持的。参数名称：更新面板

`ReviewContentUpdatePanel`是更新面板的名称，它没有被删除或添加到代码中，它存在于 aspx 页面中并且没有被删除。有没有人遇到过这个？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-24T03:02:55.200

This error occurs when the Controls collection in which the UpdatePanel is resided is cleared using the [Clear method](http://msdn.microsoft.com/en-us/library/system.web.ui.controlcollection.clear.aspx), or when the specific UpdatePanel is removed using the [Remove method](http://msdn.microsoft.com/en-us/library/system.web.ui.controlcollection.remove.aspx).

A trigger for these methods could be the implementation of the [CreateChildControls method](http://msdn.microsoft.com/en-us/library/system.web.ui.control.createchildcontrols.aspx) for the control contains the UpdatePanel. Usually, you call Controls.Clear() in the top of this method, to start with a clean slate if this method is called repeatedly.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-27T15:10:18.613

Are you moving controls about in code? If so take a look [here](http://msmvps.com/blogs/luisabreu/archive/2006/11/16/adding-removing-updatepanels-dynamicaly-from-a-page.aspx) and see if this solves your problem.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-24T15:47:58.450

我以前也有过这种情况。为了修复它，我只是删除了它，然后重新创建它，问题就消失了。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-09-25T13:27:02.760

我希望这对其他人有帮助，因为它让我发疯了。在在这里和其他地方找到各种信息后，我终于想出了以下修复方法。请注意，我不是在此处或其他任何地方动态创建此更新面板，并且大多数信息都与动态创建此控件有关，而我不是。

我在使用脚本管理器的母版页继承的页面上使用的 Web 用户控件内使用更新面板。我不知道这个组合是否是导致它的原因，但这就是我修复它的方法（在使用更新面板的 Web 用户控件内）：

```
protected override void OnInit(EventArgs e)
{
    ScriptManager sm = ScriptManager.GetCurrent(this.Page);
    MethodInfo m = (
    from methods in typeof(ScriptManager).GetMethods(
        BindingFlags.NonPublic | BindingFlags.Instance
        )
    where methods.Name.Equals("System.Web.UI.IScriptManagerInternal.RegisterUpdatePanel")
    select methods).First<MethodInfo>();

    m.Invoke(sm, new object[] { updatePanel });
    base.OnInit(e);
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-10T15:42:33.163

在您的标记中，确保您已为 UpdatePanel 及其父层次结构中的每个 runat="server" 控件指定了一个 ID。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T21:21:24.507

您是否尝试过在用户控件中包含 ScriptManagerProxy？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-19T19:00:15.717

Try to remove the scriptproxy of UserControl. In this case you only have a ScriptManager on your page.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-05T19:33:32.943

这有点远，但我有过使用 AJAX 扩展的经验，特别是更新面板，其中子控件引发的错误表现为更新面板引发的不同错误。由于子控件中的错误，我确实看到了对这个特定错误的引用：

[http://msmvps.com/blogs/shareblog/archive/2009/03/11/cannot-unregister-updatepanel-with-id-since-it-was-not-registered-with-the-scriptmanager-and-moss。 aspx](http://msmvps.com/blogs/shareblog/archive/2009/03/11/cannot-unregister-updatepanel-with-id-since-it-was-not-registered-with-the-scriptmanager-and-moss.aspx)

不确定您是否属于这种情况，但因此我花了很多时间来追查错误的错误。

# php - PHP 运行不正常

> ID：238918
> 
> 赞同：2
> 
> 时间：2008-10-27T01:59:46.307
> 
> 标签：php

我在尝试让我的 PHP 运行时遇到了一些问题。当我尝试运行任何脚本时，它们会出现在源代码中并且无法正常运行。这是 htaccess 文件：

```
# Use PHP5 as default
AddHandler application/x-httpd-php5 .php
AddType x-mapp-php5 .php
AddHandler x-mapp-php5 .php 
```

这可能是错误吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T02:08:49.177

更改并确保您`AddHandler application/x-httpd-php5 .php`访问`AddHandler application/x-httpd-php .php`的文件具有 .php 扩展名。还要注释掉其他两行`AddType`/`AddHandler`行（`x-mapp-*`那些）。其他人所说的确保模块已加载或编译的内容也值得检查。

要检查模块是否已安装，您应该在 Apache 配置中的某处有类似这样的行（路径可能在您的环境中有所不同）：

`LoadModule php5_module /usr/lib/apache2/modules/libphp5.so`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T02:04:27.967

libphp5.so 加载了吗？

我相信那个 AddHandler 指令应该是：

AddType application/x-httpd-php .php

我不确定 x-mapp-php5 指令的用途是什么......

# user-interface - 如何为我的最终用户提供运行时表单设计器？

> ID：238919
> 
> 赞同：2
> 
> 时间：2008-10-27T02:01:51.030
> 
> 标签：user-interface, report

我想创建一个与 Visual Studio IDE 具有相同功能和易用性的报表设计器。能够将控件拖到表单上、选择这些控件的各种子集、左对齐、均匀空间等。

我遇到的唯一工具真的很糟糕。Crystal Reports、MS Access 报表 crapola、ComponentOne 等。是否有第三方工具可以做到这一点，还是我必须自己动手？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-27T02:12:44.830

嗯，听起来你想做临时报告。除了我现在在我的一个项目中使用的诸如 BusinessObjects Web Intelligence 之类的 COTS 产品之外，我从未见过其中一个做得很好。

[http://www.businessobjects.com/product/catalog/web_intelligence/](http://www.businessobjects.com/product/catalog/web_intelligence/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T02:17:17.240

我想你必须在这里自己动手。
这里的问题是平衡之一。第三方报告工具必须灵活、开放且高度可定制，以满足每个潜在用户的心血来潮。结果，这些工具最终不能用于外行。
也就是说，创建可视化报表设计器并非易事。所以我的建议是提炼用户的声音，以找到以可用方式首先完成的最小功能集（报告元素、格式等）......可能不是第一次。然后迭代。
我正在处理类似的需求，目前正在评估带有一些自定义加载项的 MS Word 是否可以完成工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-09T03:14:36.443

几年前，我使用了一家名为 Data Dynamics 的公司的[Active Reports 。](http://www.datadynamics.com/)很好，因为它允许我的用户创建他们自己的报告 - 他们喜欢不必联系我来创建一些临时报告。我确信该产品自 2001 年以来已经发展，可能想看看它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T01:34:55.003

有一个 SQL MS 报告解决方案。它被称为 SSRS，您可能听说过它，但您可能不知道它有一个 OK 的最终用户目标报告工具。如果您使用数据集，它尤其适用。报告可以保存为文件并在 VS 项目、SQL SSRS 或使用独立工具（我从这里开始）中运行和/或构建。它们也可以从 Web 控件运行。我认为他们可以导出到 excel 甚至 PDF。

请参阅此处的 SQL2008 工具 - [http://www.microsoft.com/downloads/details.aspx?FamilyID=9f783224-9871-4eea-b1d5-f3140a253db6&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=9f783224-9871-4eea-b1d5-f3140a253db6&displaylang=en)

更多信息在这里 - [http://en.wikipedia.org/wiki/SQL_Server_Reporting_Services](http://en.wikipedia.org/wiki/SQL_Server_Reporting_Services)

我相信这在 SQL2005 中也可用。

# java - 如何在 Java 中计算事件的经过时间？

> ID：238920
> 
> 赞同：56
> 
> 时间：2008-10-27T02:02:26.303
> 
> 标签：java, time, timer, clock

什么是使用 Java 访问系统时钟的简单/简便方法，以便我可以计算事件的经过时间？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-10-27T11:54:44.703

我会避免[`System.currentTimeMillis()`](https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#currentTimeMillis--)用于测量经过的时间。[`currentTimeMillis()`](https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#currentTimeMillis--)返回“挂钟”时间，该时间可能会发生变化（例如：夏令时，管理员用户更改时钟）并扭曲您的间隔测量。

[`System.nanoTime()`](https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#nanoTime--)另一方面，返回自“某个参考点”（例如，JVM 启动）以来的纳秒数，因此不会受到系统时钟变化的影响。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-27T02:28:21.943

这是一些示例代码。

```
long startTime = System.currentTimeMillis();
// Run some code;
long stopTime = System.currentTimeMillis();

System.out.println("Elapsed time was " + (stopTime - startTime) + " miliseconds."); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-27T03:58:13.637

Apache Commons-Lang 也有适合您目的的 StopWatch 类。它使用 System.currentTimeMillis()，所以你仍然会遇到分辨率问题，但你可以暂停并做单圈时间等。我现在将它用作事件统计的标准。

[http://commons.apache.org/lang/api-release/org/apache/commons/lang/time/StopWatch.html](http://commons.apache.org/lang/api-release/org/apache/commons/lang/time/StopWatch.html)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2016-03-16T23:39:18.250

[Leigh](https://stackoverflow.com/a/239661/642706)的答案是正确的。

# java.time

Java 8 及更高版本内置了 java.time 框架。

An`Instant`是 UTC 时间线上的时刻，具有纳秒级分辨率（最多 9 位小数秒的小数部分）。该[`now`](http://docs.oracle.com/javase/8/docs/api/java/time/Instant.html#now--)方法获取当前的日期时间时刻。

```
Instant now = Instant.now(); 
```

> 2016-03-12T04:29:39.123Z

您可以将一对`Instant`对象之间的经过时间计算为[`Duration`](http://docs.oracle.com/javase/8/docs/api/java/time/Duration.html). 持续时间使用纳秒分辨率，最大值为可以长时间保持的秒数。这大于目前估计的宇宙年龄。

```
Duration duration = Duration.between( startInstant , stopInstant ); 
```

的默认输出为[`Duration::toString`](http://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#toString--)标准[ISO 8601](https://en.wikipedia.org/wiki/ISO_8601#Durations)格式。您还可以询问纳秒 ( [`toNanos`](http://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#toNanos--)) 或毫秒 ( [`toMillis`](http://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#toMillis--)) 的总计数，以及其他数量。

## 爪哇 8

在 Java 8 中，获取当前时刻仅解析为毫秒分辨率（最多 3 位小数秒的小数部分）。因此，虽然 java.time 类可以*存储*纳秒，但它们只能以毫秒确定当前时刻。此限制是由于遗留问题（默认[`Clock`](http://docs.oracle.com/javase/8/docs/api/java/time/Clock.html)实现使用[`System.currentTimeMillis()`](http://docs.oracle.com/javase/8/docs/api/java/lang/System.html#currentTimeMillis--)）。

## 爪哇 9

在 Java 9 及更高版本中，默认`Clock`实现可以以纳秒的分辨率确定当前时刻。实际上这样做取决于计算机时钟硬件的精细度。

有关更多信息，请参阅此 OpenJDK 问题页面：[增加 java.time.Clock.systemUTC() 的实现精度](https://bugs.openjdk.java.net/browse/JDK-8068730)

# 微基准

如果您的目的是进行基准测试，请务必查看其他问题，例如：

*   [如何在 Java 中编写正确的微基准测试？](https://stackoverflow.com/q/504103/642706)
*   [使用 java 创建快速/可靠的基准测试？](https://stackoverflow.com/q/6373550/642706)

框架可用于协助进行短期基准测试。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-27T02:07:56.120

`java.lang.System.currentTimeMillis()`或者`java.lang.System.nanoTime()`应该可以测量经过的时间。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-11-20T16:48:16.843

这是我使用 System.nanoTime() 编写的一个小型 StopWatch 类，如 Leigh 的回答中所建议的那样：

```
public class StopWatch {
    // Constructor
    public StopWatch() {
    }

    // Public API
    public void start() {
        if (!_isRunning) {
            _startTime = System.nanoTime();
            _isRunning = true;
        }
    }

    public void stop() {
        if (_isRunning) {
            _elapsedTime += System.nanoTime() - _startTime;
            _isRunning = false;
        }
    }

    public void reset() {
        _elapsedTime = 0;
        if (_isRunning) {
            _startTime = System.nanoTime();
        }
    }

    public boolean isRunning() {
        return _isRunning;
    }

    public long getElapsedTimeNanos() {
        if (_isRunning) {
            return System.nanoTime() - _startTime;
        }
        return _elapsedTime;
    }

    public long getElapsedTimeMillis() {
        return getElapsedTimeNanos() / 1000000L;
    }

    // Private Members
    private boolean _isRunning = false;
    private long _startTime = 0;
    private long _elapsedTime = 0;
} 
```

# asp.net - 跨浏览器脚本代理

> ID：238931
> 
> 赞同：3
> 
> 时间：2008-10-27T02:16:36.493
> 
> 标签：asp.net, javascript, web-services, cross-domain

我正在开发一些在不同域上使用一些 JSON Web 服务的客户端 Javascript。我读过一些浏览器不允许跨域脚本，我应该在我的本地服务器上创建一个代理来提供数据。

有人可以指点我一个如何在 ASP.Net 中执行此操作的简单示例吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-27T04:31:41.853

一般来说，代理在您的 Web 服务器上运行 - 在您的情况下很可能是 IIS - 并将请求“中继”到不同域上的另一台服务器。

这是一个在 C# .NET 中实现的示例

[快速的流式 AJAX 代理](https://www.codeproject.com/articles/25218/fast-scalable-streaming-ajax-proxy-continuously-de)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T04:20:01.533

您可以通过使用[JSONP](http://remysharp.com/2007/10/08/what-is-jsonp/)之类的技术来避免代理。假设您正在与之交谈的 Web 服务支持 JSONP（例如，Flickr 或 Twitter 都提供 JSONP API）或者您可以控制 Web 服务发回的数据，您可以使用具有 JSONP 功能的库在域之间发送 JSON 数据.

例如，在 jQuery 中，您可以进行远程 JSON 调用：

```
jQuery.getJSON("http://www.someothersite.com/webservice?callback=?", function(result)
{
    doStuffWithResult(result);
}); 
```

因为调用的是另一个域，所以 jQuery 会自动使用一些技巧来进行跨域调用。jQuery 会自动替换 ? 在带有回调函数名称的 url 中，Web 服务可以使用它来格式化返回的 JSON 数据。

如果您是控制 Web 服务的人，您可以通过获取名为“callback”的请求参数来处理 JSONP 请求，该参数将设置为您需要使用的回调函数名称。回调函数接受一个参数，即您要发回的 JSON 数据。因此，如果回调参数设置为“jsonp2342342”，您将希望 Web 服务响应如下：

```
jsonp2342342({key: value, key2: value}); 
```

如果您使用的 Web 服务已经支持 JSONP，则您不必担心自己进行格式化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-07T22:35:50.597

您可以编写一个简单的 .NET 页面来检索远程页面并将其显示在您的站点上：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Net;
using System.IO;

namespace Proxy
{
    public partial class _Proxy : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            string proxyURL = string.Empty;
            try
            {
                proxyURL = HttpUtility.UrlDecode(Request.QueryString["u"].ToString());
            }
            catch { }

            if (proxyURL != string.Empty)
            {
                HttpWebRequest request = (HttpWebRequest)WebRequest.Create(proxyURL);
                request.Method = "GET";
                HttpWebResponse response = (HttpWebResponse)request.GetResponse();

                if (response.StatusCode.ToString().ToLower() == "ok")
                {
                    string contentType = response.ContentType;
                    Stream content = response.GetResponseStream();
                    StreamReader contentReader = new StreamReader(content);
                    Response.ContentType = contentType;
                    Response.Write(contentReader.ReadToEnd());
                }
            }
        }
    }
} 
```

请参阅我的帖子：[http ://www.johnchapman.name/aspnet-proxy-page-cross-domain-requests-from-ajax-and-javascript/](http://www.johnchapman.name/aspnet-proxy-page-cross-domain-requests-from-ajax-and-javascript/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T02:26:22.993

**没有**浏览器允许跨域脚本，尽管 w3c 在其对 xmlHTTPRequest-object 的建议中为此留出了空间，但我们仍然需要等待一段时间才能看到它以安全的方式实现......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T02:34:12.323

我将为寻求该问题一般答案的人们提供一个伪代码版本。

```
SomeAjaxAbstraction.Request('proxyScript', {
    parameters: {
        address: 'http://somewhere.com/someapi?some=query'
    }
}); 
```

然后在proxyScript中：

```
var address = GET['address'];
if(ValidUrl(address) && ConnectionAllowed(address)) {
    // Validating address and whitelisting services is an exercise to the reader
    var response = SomeHttpGetFunction(address);
    echo XssAndBadStuffFilter(response);
} else {
    // Handle errors
} 
```

# javascript - 处理长 write() 参数的最佳方法是什么？

> ID：238941
> 
> 赞同：0
> 
> 时间：2008-10-27T02:27:52.490
> 
> 标签：javascript, readability

**更新：**感谢大家的回复。我没有意识到 document.write() 已被弃用。在学习栏上再添一个档次。我将接受此处发布的建议，但保留原始问题，以便给出的答案在原始问题的上下文中有意义。

* * *

我正在编写一些相当长的 write() 参数，并且考虑到语法、可读性和性能，我正在尝试确定以下哪个示例最好遵循。我是不是该

一种。将它们全部放在一行上：

```
<script>

    var someVariable = "(<a href=\"http://www.example.com\">Link<\/a>)";

    document.write("<p>Supergroovalisticprosifunkstication and Supercalifragilisticexpialidocious are very long words.</p>" + someVariable + "<p>Dociousaliexpisticfragilicalirepus is Supercalifragilisticexpialidocious spelled backwards.</p>" + someVariable);

</script> 
```

湾。通过添加换行符来分解它们以提高可读性：

```
<script>

    var someVariable = "(<a href=\"http://www.example.com\">Link<\/a>)";

    document.write("<p>Supergroovalisticprosifunkstication and Supercalifragilisticexpialidocious are very long words.</p>" 
        + someVariable
        + "<p>Dociousaliexpisticfragilicalirepus is Supercalifragilisticexpialidocious spelled backwards.</p>" 
        + someVariable);

</script> 
```

C。通过使用多个变量来分解它们：

```
<script>

    var someVariable = "(<a href=\"http://www.example.com\">Link<\/a>)";

    var partOne = "<p>Supergroovalisticprosifunkstication and Supercalifragilisticexpialidocious are very long words.</p>"; 
    var partTwo = "<p>Dociousaliexpisticfragilicalirepus is Supercalifragilisticexpialidocious spelled backwards.</p>"; 

    document.write(partOne + someVariable + partTwo + someVariable);

</script> 
```

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T02:40:31.843

我的直觉反应是：**不要那样做**。（您的示例很差，您不应该在行为层中编写大量内容。）

每当你*必须*这样做时，要么连接：

```
var longVar = 'asdfasdf asdf asdf asdfasdf asdfasdf asdf asdfasdf' +
    ' fasdf s9d0af asdf asdf0s,dv z-xcfva-sdfmwaert ' +
    'qersdfasdfasdfasdfasdf';
document.write(longVar); 
```

或者，如果它变得非常长，则使用加入数组可能会提高性能：

```
var longVar = [
    'asdfasdf asdf asdf asdfasdf asdfasdf asdf asdfasdf',
    ' fasdf s9d0af asdf asdf0s,dv z-xcfva-sdfmwaert ',
    'qersdfasdfasdfasdfasdf'
].join('');
document.write(longVar); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T02:45:49.367

我会写它，但是它将最容易阅读和维护。然后测试性能。如果速度太慢，请尝试逐步改进算法，直到速度可以接受。

所以提高性能的想法： - 确保脚本被缩小。- 在服务器上进行尽可能多的预处理并提供“已处理”脚本。

通过使用缩小工具（例如 jsMin），您不会因使用空格和换行符以提高可读性而遇到任何问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T03:42:27.740

-- 这是一个不好的例子，`document.write()`因为它属于 90 年代，并且在 1998 年随着 HTML4 的引入而被弃用......

如果您在服务器端有任何东西，最好在那里处理代码生成......

关于连接字符串的问题，我同意没有眼睑！-)

**编辑（29/10）**

作为对评论的评论（我需要代码符号）

```
<script type="text/javascript">
  window.onload = function(){
    var newD = document.createElement("div");
    newD.appendChild(document.createTextNode("Hello World"));
    document.getElementsByTagName("body")[0].appendChild(newD);
  }
</script> 
```

这样任何东西都被插入到文档中......

# asp.net - 防止用户在同一行上工作

> ID：238946
> 
> 赞同：12
> 
> 时间：2008-10-27T02:30:15.933
> 
> 标签：asp.net, sql-server, vb.net, ajax, concurrency

我有一个类似于票务工作系统的 Web 应用程序。一些用户输入新问题。其他工人选择并解决问题。所有数据都保存在 MS SQL server 2005 中。

致力于解决问题的用户转到他们可以查看未解决问题的页面。因为多达 20 个人可以同时查看此页面，所以我必须解决的一个潜在问题是，如果有人在页面加载后选择了其他人选择的问题，会发生什么情况。

为了解决这个问题，我做了两件事。首先，显示要选择的问题的网格视图使用 AJAX 计时器每秒更新一次。一旦选择了一个问题，它最多会在一秒钟后消失。如果他们在这一秒内选择了一个，他们会收到一条消息，要求他们选择另一个。

问题是其中的 AJAX 部分发送了太多更新（这是我假设的），并且影响了页面和数据库的性能。此外，更新并不是每秒都在执行。我发现在触发存储过程时计时器不可靠。

必须有更好的方法，但我似乎找不到。有没有人遇到过这样的情况，或者有建议让多个用户不要选择相同的记录来维护？我真的不想完全禁用 AJAX 部分，因为我觉得单独的消息会使应用程序使用起来令人沮丧。

谢谢，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T02:50:33.477

在数据库中的行上放置一个锁定时间戳字段。如果过期 timsetamp 早于特定时间，则编写一个返回 true 或 false 的存储过程。将您在 Web 应用程序上的会话设置为在同一时间（一两分钟）内到期。当用户选择一行时，他们点击了存储过程，这有助于应用程序决定是否应该让用户修改它。

希望这是有道理的......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T12:22:51.400

我做了类似的事情，一旦用户打开一张票（行），它就会将该票分配给该用户并在该记录上设置一个值，例如该特定用户的 FK，所以如果其他人试图打开该票（行）它会让他们知道它已经分配给了其他人。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-09-23T15:21:03.907

有两件事可以帮助缓解您的问题。

首先，无论您的 ajax 更新时间框架如何，都需要在选择后通知该案例已被采纳。即使每秒检查一次也不意味着两个人不能在他们认为是同一时间点击同一个案例。在这种情况下，需要通知其中一位用户他们的选择是无效的，即使它在选择时看起来是有效的。此通知无需详细说明；即使在失望的情况下，保持轻松、有帮助的语气也可以改善用户的感知。而且，如果您已经确定了选择该记录的用户，那不仅会帮助您的用户在未来进行协调，而且还会将注意力从您的程序转移到蛇行的用户身上。（确实，管理层可能*喜欢*给你的用户偶尔的冲突，因为这会激励他们更快地选择案例）

其次，对如何显示案例进行小调整可以减少选择冲突。添加随机元素以显示顺序和/或过滤掉所有其他显示的案例将帮助您的用户自然地选择不同的案例。人类模式识别和任务选择并不是真正随机的，因此对表示的微小变化可能等于对选择行为的重大变化。减少碰撞机会使您的碰撞通知很少见（因此对您的用户来说不那么令人沮丧）。如果可以将您的用户分成有助于确定有用的案例排序/过滤的分类，那就更好了。

好的，随着时间的推移会帮助您的第三件事是，如果您记录碰撞发生的时间（包含有关碰撞的有用元数据，例如参与人员和选择时间）。借助可靠的碰撞数据，您可以找到有效的方法和无效的方法。随着时间的推移，您可以根据实际用例优化您的应用程序，并尽早发现潜在问题。没有什么比在他们意识到问题存在之前就已经解决问题（并且能够解释您解决问题的计划）更能让您的用户放心的了。

使用这些缓解模式，您可能会发现可以安全地缩短 ajax 查询时间，而不会影响用户体验。并且通过有用的日志记录，您将确保您所做的任何调整都在实际工作（或不工作 - 知道这可能更有用）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T02:42:45.487

您是否尝试过增加刷新之间的时间。我希望每 30 秒一次就足够了。40 个请求/分钟比 1200 个/分钟的负载要少得多。您的用户甚至可能没有注意到差异。

如果他们这样做了，如何在页面上提供一个刷新按钮，以便用户可以在选择项目之前手动刷新列表，以避免他们选择时出现烦人的消息。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-27T02:44:06.797

如果可能的话，限制系统，让他们从工作队列中取出下一个未解决的问题，而不是让他们能够从所有未解决的问题中进行选择。

如果那是不可能的，我想你可以检查一个问题的选择，看看它是否仍然可用。如果它不可用，则在用户单击它后使其消失。这样，您仅在他们实际单击某些内容时才请求，而不是不断地轮询数据。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-24T15:13:16.850

我错过了看到这个问题，特别是在您提到您已经将票证标记为正在进行/正在维护并且具有该项目的时间戳/版本之后。

以下内容还不够：

1.  用户浏览票证并查看可用票证列表，即这不包括正在进行的数据库中的票证。如果您希望用户也看到正在进行的工单，请在工单状态中清楚地指出它并禁用接受它的选项。
2.  用户可以通过打开工单显式或隐式地将工单标记为正在进行中（取决于用户体验/它如何呈现给用户）。
3.  用户明确地将工单移动到不同的状态，即已完成、无效、等待反馈等。

当在 1 处检索项目时，您包括时间戳/版本。当 2 发生时，您使用乐观并发方法来确保如果 2 个人尝试同时更新 take the ticket，则只有第一个会成功。

将会发生的情况是，对于第二个人来说，更新 ... where ... timestamp = @timestamp 将找不到任何要更新的记录，并且您将报告该票已被取走。

如果您愿意，您可以在上述基础上构建，以便在抢票时更新 UI。这可能是通过在 x 时间后完全刷新当前的票证页面（可能警告/提示用户），或者甚至通过检索为使用 ajax 显示的票证页面更改的票证列表。您仍然有前面的步骤，因为此修改只是为用户提供方便。

# mysql - 如何编写一个从一个表读取数据并写入另一个表的 mysql 查询？

> ID：238949
> 
> 赞同：5
> 
> 时间：2008-10-27T02:32:04.637
> 
> 标签：mysql, sql

如果可能，请提供一两个示例查询，以便我了解它是如何工作的。两个表将在同一个数据库中。

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-27T02:34:08.720

伪代码：

```
insert into <target-table>
( <column-list> )
select <columns>
  from <source-table> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-27T03:25:18.663

`INSERT...SELECT`是答案；见[http://dev.mysql.com/doc/refman/5.1/en/insert-select.html](http://dev.mysql.com/doc/refman/5.1/en/insert-select.html)。

例如：

```
INSERT INTO names
SELECT last_name, first_name
FROM people 
```

# php - 如何设置 OCI 以从 PHP 连接到 Oracle？

> ID：238956
> 
> 赞同：3
> 
> 时间：2008-10-27T02:38:39.803
> 
> 标签：php, oracle, oracle-call-interface

在最新的 Ubuntu 上，我有一个正常运行的 PHP 5.2.4 安装。我想使用 OCI 从 PHP 中使用远程 Oracle 服务器。

我已经下载了*“Instant Client Package - Basic Lite”*（[链接](http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/linuxsoft.html)）。我已经将包含 OCI 库的包解压缩到一个目录，但我不知道如何告诉 PHP 我想使用这些库。可以预见的是，我得到

> 致命错误：在...中调用未定义的函数 oci_connect()

运行此代码时：

```
<?php 
   $conn = oci_connect('hr', 'hrpw', 'someremotehost');
?> 
```

我不想用 Oracle 支持重新编译 PHP。连接 PHP 以便我可以使用 Oracle 的最快方法是什么？如果我想连接到远程 Oracle 实例，是否需要任何其他库，例如 Oracle 客户端？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T03:06:12.057

您需要 PHP 扩展，在您的 Ubuntu 上尝试以下操作：

```
(sudo) pecl install oci8 
```

确保您的 php.ini（应该有一个用于 Apache，一个用于 cli php）包含`extension=oci8.so`在之后。最后，您必须重新启动 Apache 并确认`<?php phpinfo(); ?>`已加载扩展。

**更新：**

当它要求您输入 ORACLE_HOME 时，输入如下内容：

> 即时客户端，/opt/oracle/instantclient

我认为设置环境变量将是另一种解决方案。/opt/oracle... 是我放入我的即时客户端的路径。我不久前学习了一些教程，不幸的是我再也找不到它了。

高温高压

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T15:13:56.900

最后，我下载了 Zend Core for Oracle 并且成功了。 [http://www.zend.com/en/products/core/for-oracle](http://www.zend.com/en/products/core/for-oracle)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T15:45:08.323

我认为您需要确保 $ORACLE_HOME/lib32 在您的 $LD_LIBRARY_PATH 中，或者将该目录添加到 /etc/ld.so.conf 文件中。

# asp.net-mvc - 如何在共享主机上成功托管 asp.net mvc 应用程序而不使用丑陋的 URL？

> ID：238974
> 
> 赞同：0
> 
> 时间：2008-10-27T02:58:11.667
> 
> 标签：asp.net-mvc, hosting

假设我们谈论的是最近发布的 Beta 版本。具体来说，我对分步教程或类似的教程很感兴趣，并且我会对有关如何在 CrystalTech 上执行此操作的信息感到兴奋。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T09:30:23.467

最终，您需要一个使用 Windows Server 2008 / IIS7 的托管环境，它允许您通过 web.config 而不是通过 IIS 本身配置诸如映射之类的东西。

如果做不到这一点，您唯一的选择是要求 CrystalTech 启用 ASP.NET 通配符映射到您的网站，或者坚持在您的 URL 中使用 .mvc 扩展名。

# html - 使无 DOCTYPE 的 HTML 页面符合 W3C

> ID：238977
> 
> 赞同：0
> 
> 时间：2008-10-27T03:03:16.477
> 
> 标签：html, standards-compliance

如何获取当前没有 doctype 声明的 HTML 站点并使其符合 W3C？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T03:08:11.787

首先：考虑一下*为什么*需要使其符合 W3C。如果只是为了小徽章，那就不值得了。

如果您确实有充分的理由（并且有很多），那么这就是我要做的：

首先选择一个文档类型。从它的声音来看，HTML 4.0 可能是要走的路。通过验证器运行您的页面，然后查看它为您提供的错误报告。一个一个地检查它，修复每个错误。通常，错误报告会告诉您大量有关如何解决每个问题的信息，并为您提供规范的相关链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T10:43:22.193

***注意***：*如果没有 DOCTYPE*， **IE 将不会在****标准模式下**呈现您的页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T03:09:24.203

您将需要确定您想要遵守的文档类型，然后开始着手使站点对其进行验证。我建议从 XHTML Transitional 之类的东西开始。

这很可能会形成大量的努力，可能没有真正的收获，并且可能涉及重构大量内容或进行软件更改，因此请确保在开始之前您愿意接受。如果该站点特别糟糕（例如，到处都是字体标签，没有使用 CSS），那么您很可能会发现它的麻烦多于其价值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T14:15:49.630

我倾向于不理会任何工作令人满意的页面。如果它没有损坏，请不要修复它。但是，任何需要重新设计或麻烦修改的页面我都会使用现代技术重新编写。

主要问题是，当您向页面添加 doctype 时，IE 6 及更高版本开始呈现页面的方式明显不同：[它使用标准模式而不是 Quirks 模式，并且盒子模型不同](http://www.quirksmode.org/css/quirksmode.html)。因此，即使页面编码良好，添加此 doctype 也可以完全改变非常流行的浏览器中的呈现。这意味着至少要花时间修理东西。

至于应该使用哪种 doctype，我推荐 HTML 4.01 transitional。XHTML 不值得努力。大多数开发人员都不太了解真正的 XHTML，如果您的代码中有一个错误，则整个页面可能不会显示；如果您将 XHTML 作为 HTML 提供，那么您也可以只提供 HTML。HTML 不够好的原因并不多。

选择文档类型后，您可以修复 HTML 和 CSS，以使页面更小、更干净、更易于维护。这是一个复杂的问题，无法在快速帖子中完全解释，但归结为确保您的布局是使用 DIVS 而不是 TABLES 等完成的。考虑将所有 CSS 放在 <style> 标记或外部 CSS文件; 我个人认为任何 HTML 属性（如高度、宽度或内联样式属性）都是错误。例如：

```
<div height="100" width="100" style="border: 1px solid red"></div> 
```

真的应该是：

```
<head>
  <style> .adbox { height: 100px; width: 100px; border: 1px solid red; } </style>
</head>
<body>
 <div class="adbox"></div>
</body> 
```

我的建议的主要关键是建设性地花费你的精力；如果工作正常，您可能不需要更改它。这些变化带来了好处，但它们也有很高的成本，所以除非你愿意为此付出代价，否则不要盲目地尝试实现某件事。简单地说“W3C 验证”并不是一个好的目标。而是专注于易于维护、良好的内容、小文件大小、屏幕阅读器的可访问性等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T07:13:32.227

基于对问题的误解，我丢弃了我之前的答案...

基本答案是使用[HTML Tidy](http://tidy.sourceforge.net/ "HTML 整洁的项目页面")，它应该有助于使其兼容。

# sql-server - 我还应该在 SQL Profiler 中看到查询命中吗？

> ID：238978
> 
> 赞同：0
> 
> 时间：2008-10-27T03:03:21.810
> 
> 标签：sql-server, asp.net-mvc, linq-to-sql, caching

我目前正在构建一个网站，我刚刚使用 LinqToSQL 实现了 SqlCacheDependency，就像这样。

```
 public IQueryable<VictoryList> GetVictoryList()
   {
                string cacheKey = HttpContext.Current.User.Identity.Name + "victoryCacheKey";
                IQueryable<VictoryList> cachednews = (IQueryable<VictoryList>)HttpContext.Current.Cache.Get(cacheKey);

                if (cachednews == null)
                {

                    var results = from v in _datacontext.ViewVictoryLists
                                  orderby _datacontext.GetNewId()
                                  select new VictoryList
                                  {
                                      MemberID = v.MemberID,
                                      Username = v.Aspnetusername,
                                      Location = v.Location,
                                      DaimokuGoal = v.DaimokuGoal,
                                      PreviewImageID = v.PreviewImageID,
                                      TotalDaimoku = v.TotalDaimoku,
                                      TotalDeterminations = v.TotalDeterminations,
                                      DeterminationID = v.DeterminationID,
                                      DeterminationName = v.DeterminationName
                                  };
                    SqlCacheDependency dependency =
                     new SqlCacheDependency(_datacontext.GetCommand(results) as SqlCommand);

                    HttpContext.Current.Cache.Add(cacheKey, results, dependency, DateTime.MaxValue,
                                  TimeSpan.Zero, CacheItemPriority.Normal, null); 

                    return results.ToList().AsQueryable();
                }
                return cachednews;
   } 
```

它似乎正在工作，因为事情明显更快，特别是在一些复杂的查询中，但是在查看 SQLProfiler 中的内容时，我仍然看到查询运行，我正在使用 SqlCacheDependency 的 CommandBroker 模式。即使数据显然来自缓存对象，我是否仍应看到查询？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T04:23:58.840

我认为问题在于您将 IQueryable 存储在缓存中，然后 cachednews 包含一个命中数据库的 IQueryable。

尝试以下更改。

```
public IQueryable<VictoryList> GetVictoryList() {
            // ...
            if (cachednews == null)
            {

                var results = from // ...
                results = results.ToList().AsQueryable(); // force query execution

                SqlCacheDependency dependency = // ...;
                HttpContext.Current.Cache.Add(cacheKey, 
                    results, // now just the result are stored
                    dependency, 
                    DateTime.MaxValue,
                    TimeSpan.Zero, 
                    CacheItemPriority.Normal, 
                    null); 

                return results;
            }
            return cachednews;
} 
```

# ios - 如何更改 iOS 应用程序的名称？

> ID：238980
> 
> 赞同：1079
> 
> 时间：2008-10-27T03:07:03.177
> 
> 标签：ios, xcode

前几天我用一个愚蠢的开发代号开始了一个 iPhone 项目，现在我想更改项目的名称，因为它快完成了。

但我不确定如何使用 Xcode 执行此操作，尝试在 info.plist 文件中更改应用程序的名称，这会导致签名过程出错（我认为......）并且我的应用程序不会启动我是启动器错误。

我想我可以创建一个新项目并复制粘贴所有内容，但它看起来很原始，我希望有一个更文明的解决方案。

* * *

## 回答 #1

> 赞同：1068
> 
> 时间：2008-10-27T03:30:28.107

1.  进入. `Targets`_`Xcode`
2.  `Build Settings`在您的项目目标（您当前的开发名称）上。
3.  `Product Name`在下搜索`Packaging`。将其值更改为您想要的新项目名称。

* * *

## 回答 #2

> 赞同：375
> 
> 时间：2013-12-06T08:06:02.573

在新版本的 Xcode（**Xcode 5 也是**）中，要更改项目的名称，请遵循以下简单（尽可能详细）步骤：

**注意：**在本例中，我将假设的“示例”名称更改为“测试”名称。

1.  **在项目导航器中的项目根目录上缓慢**单击两次，然后它就可以编辑了。

    [![在此处输入图像描述](https://i.stack.imgur.com/VqRG2.png)](https://i.stack.imgur.com/VqRG2.png)

2.  重命名项目。

    [![在此处输入图像描述](https://i.stack.imgur.com/zU5zS.png)](https://i.stack.imgur.com/zU5zS.png)

3.  按下`Enter`助手后，将建议您自动更改所有与项目名称相关的条目，并允许您取消选择其中一些，如果您愿意。

    [![在此处输入图像描述](https://i.stack.imgur.com/L85F4.png)](https://i.stack.imgur.com/L85F4.png)

4.  按“重命名”，Xcode 将完成剩下的工作。与此同时，Xcode 可能会询问您有关制作项目快照的选项（非常推荐这样做）。

5.  除了重命名项目之外，您可能还需要重命名方案，使其与您的新项目名称相匹配。

    [![在此处输入图像描述](https://i.stack.imgur.com/0Xu2D.png)](https://i.stack.imgur.com/0Xu2D.png)

6.  重复类似的步骤，如 1 和 2，然后按 OK。

    [![在此处输入图像描述](https://i.stack.imgur.com/6HHtO.png)](https://i.stack.imgur.com/6HHtO.png)

    [![在此处输入图像描述](https://i.stack.imgur.com/MUHox.png)](https://i.stack.imgur.com/MUHox.png)

7.  就是这样。

**另一个场景...**

前面的解释与更改项目名称有关，但您可能只需要更改主屏幕中应用程序图标下方显示的显示名称。这些是步骤：

1.  在“支持文件”组中找到*info.plist*（或相关）文件

2.  找到“捆绑显示名称”键并将值更改为新名称。

    ![在此处输入图像描述](https://i.stack.imgur.com/HZhQq.png)

    ![在此处输入图像描述](https://i.stack.imgur.com/b2Rjy.png)

3.  从模拟器或任何其他测试设备中删除“旧”应用程序。

4.  再次清理并重建您的应用程序。

5.  就是这样。您现在将在主屏幕中看到新的应用程序名称。

* * *

## 回答 #3

> 赞同：209
> 
> 时间：2009-12-24T23:38:52.143

*您在info.plist*文件中更改包显示名称。就这么简单。

更改“捆绑显示名称”（与“捆绑名称”相反）是在应用程序名称中包含“+”等字符的唯一方法。在项目名称中包含特殊字符会导致上传到[App Store](https://en.wikipedia.org/wiki/App_Store_(iOS/iPadOS))时出错！

* * *

## 回答 #4

> 赞同：148
> 
> 时间：2011-04-07T17:18:32.837

在 Xcode 4 中，在目标的“构建设置”选项卡下搜索“产品名称”。

* * *

## 回答 #5

> 赞同：49
> 
> 时间：2013-04-24T11:03:05.233

1.  选择目标

    ![在 Xcode 侧边栏中选择的目标。](https://i.stack.imgur.com/YJkM8.png)

2.  选择信息

    ![已选择信息选项卡。](https://i.stack.imgur.com/98C3t.png)

3.  插入捆绑显示名称并设置应用程序标题

    ![突出显示应用程序类别的下拉菜单。](https://i.stack.imgur.com/d4wxW.png)

* * *

## 回答 #6

> 赞同：47
> 
> 时间：2012-10-12T12:09:32.503

如果您只想更改显示名称，则可以直接在应用程序的属性文件（plist）中进行更改。

您可以使用以下键添加新行：**捆绑显示名称**

这是一个例子：

![在此处输入图像描述](https://i.stack.imgur.com/uSEDU.png)

当您使用此键指定的应用程序名称时，它将显示出来。

所以你可以简单地做到这一点。

* * *

## 回答 #7

> 赞同：40
> 
> 时间：2011-09-10T11:41:05.840

这就是我在 Xcode 4 中更改它的方式：

1.  单击您的目标文件（应用程序的第一个主文件）。
2.  转到*构建设置*。
3.  向下滚动您会发现一个名为“包装”的栏。
4.  在*Packaging*您将看到*Product Name*，您可以更改项目名称。

* * *

## 回答 #8

> 赞同：38
> 
> 时间：2010-03-08T13:32:59.370

* * *

## 回答 #9

> 赞同：33
> 
> 时间：2016-01-12T19:56:10.957

Xcode 7/8？它在您的目标使用的 plist 中

[![在此处输入图像描述](https://i.stack.imgur.com/NcTfd.png)](https://i.stack.imgur.com/NcTfd.png)

* * *

## 回答 #10

> 赞同：22
> 
> 时间：2012-01-30T07:38:20.740

从 Xcode 4.2 起，您可以使用更多选项。只需单击左侧导航窗格顶部的 .proj 文件名，即可重命名。重命名它，整个项目将被重命名，而不仅仅是目标。

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2014-02-13T15:53:31.870

我喜欢 Xcode 5 的最佳方式是在构建设置中更改产品名称。在“建筑设置”中搜索“产品名称”并进行更改。

![在此处输入图像描述](https://i.stack.imgur.com/WTLXM.png)

* * *

## 回答 #12

> 赞同：19
> 
> 时间：2011-02-22T05:53:39.990

如果您需要更改应用程序在 iPhone 主屏幕上显示的名称，您需要在*Target*配置中进行，而不是在项目配置中进行。

1.  在 Xcode 中展开*Targets*组，然后单击其下的项目。它应该共享您的项目的名称，这也是生成的应用程序的默认名称。

2.  按`Command`+`I`调出*Info*窗口，然后导航到 Build 标签。

3.  将*Configuration*下拉菜单设置为读取*All Configurations*。

4.  *在Packaging*标题下查找名为*Product Name的设置。*

**   将该值更改为您编译的应用程序所需的名称，用[Bugs Bunny](https://en.wikipedia.org/wiki/Bugs_Bunny)的不朽名言：瞧！进行清洁和构建。您的应用程序将采用新名称。* 

 ** * *

## 回答 #13

> 赞同：19
> 
> 时间：2019-07-01T19:02:58.187

**对于 Xcode 10.2：**

虽然这个问题有很多答案，但我想详细解释整个概念，以便每个人都可以将这些知识应用到 Xcode 的进一步或以前版本中。

每个 Xcode 项目都包含一个或多个目标。根据[苹果](https://developer.apple.com/library/archive/featuredarticles/XcodeConcepts/Concept-Targets.html)的说法，`A target specifies a product to build and contains the instructions for building the product from a set of files in a project or workspace.`所以每个目标本身就是一个产品（应用程序）。

改名步骤：

**第 1 步：**转到***目标***并打开要更改其名称的目标的***信息选项卡。***

**第 2 步：**查看设置为默认属性的*自定义 iOS 目标属性下的***Bundle 名称**键。*`$(PRODUCT_NAME)`*

 *[![在此处输入图像描述](https://i.stack.imgur.com/aVPS8.jpg)](https://i.stack.imgur.com/aVPS8.jpg)

**第 3 步：**您可以直接更改**Bundle 名称**（不推荐），或者如果您打开***Build Settings****选项卡，然后在Setting*下搜索**Product Name** ，您将看到**Product Name**设置为。***`$(TARGET_NAME)`***

 ***[![在此处输入图像描述](https://i.stack.imgur.com/imW8l.png)](https://i.stack.imgur.com/imW8l.png)

**步骤 3A：**您可以更改**产品名称**，也可以通过双击目标来更改**目标名称。**

[![在此处输入图像描述](https://i.stack.imgur.com/F1iro.png)](https://i.stack.imgur.com/F1iro.png)

因此更改**产品名称** *（应用程序名称）*或**目标名称**都会产生相似的结果。但是，如果您只想更改**App** Name并想继续使用相同的**Target Name**，则只需更改**Product Name**。

* * *

## 回答 #14

> 赞同：17
> 
> 时间：2011-10-17T10:19:16.920

如果您想更改名称，它将显示在您的屏幕上，在您的图标下方，在 Xcode 4 中，转到*Targets* → *Info* → *Bundle Display Name*并将其更改为您想要的任何内容。

* * *

## 回答 #15

> 赞同：16
> 
> 时间：2011-07-06T12:06:15.080

在 Xcode 4 中单击项目名称开始重命名。

* * *

## 回答 #16

> 赞同：16
> 
> 时间：2019-10-14T15:57:42.757

对于 Xcode 11，如果您想更改 App 显示名称，则只需转到 plist 并简单地替换以下值`CFBundleDisplayName`：

```
<key>CFBundleDisplayName</key>
<string>Your App Name</string> 
```

* * *

## 回答 #17

> 赞同：14
> 
> 时间：2016-12-12T19:15:30.207

在 Xcode 8 中更改非常容易。在*Project Target* → *General Identity*部分的“Display Name”字段中输入应用程序名称。

[![在此处输入图像描述](https://i.stack.imgur.com/htIF3.png)](https://i.stack.imgur.com/htIF3.png)

* * *

## 回答 #18

> 赞同：12
> 
> 时间：2009-06-10T00:50:51.577

另外：您的目标名称可能与您的应用名称相同 - 请注意，更改目标名称不会更改应用名称 - 只有下面描述的目标属性的更改 - 会更改应用名称。

* * *

## 回答 #19

> 赞同：11
> 
> 时间：2012-10-24T11:03:57.787

关于捆绑显示名称的注释——这是在应用程序菜单中更改名称的正确方法，但您可能需要在 iOS 模拟器中重置内容和设置，然后才能看到更改实际生效。

* * *

## 回答 #20

> 赞同：10
> 
> 时间：2014-09-11T18:06:19.073

为了在一个地方收集所有相关信息，这里是这个问题的[官方答案](https://developer.apple.com/library/ios/qa/qa1625/_index.html)- 它是唯一在 Xcode 5.1.1 上对我有用的答案

只需使用 Xcode 中的 Identity and Type 窗格。

![在 Xcode 中使用身份和类型面板](https://i.stack.imgur.com/lMkrS.png)

* * *

## 回答 #21

> 赞同：10
> 
> 时间：2014-12-11T08:49:23.097

您可以在`Product Name`不更改您的`Project Name`（尤其是目录）的情况下进行修改。

构建设置 > 搜索关键字“**产品名称**” > 更新值

* * *

## 回答 #22

> 赞同：8
> 
> 时间：2012-12-03T14:30:34.293

1.  选择左侧最上面的一行（包含您的项目名称、目标数量等）。
2.  选择要重命名的目标。
3.  再次单击目标的名称。
4.  键入新名称。
5.  按`Enter`。

* * *

## 回答 #23

> 赞同：8
> 
> 时间：2013-05-28T14:37:19.573

仅用于在 Xcode 4 或更高版本中更改应用程序名称（将与应用程序图标一起显示）：

从 Groups & Files 面板单击您的项目文件图标，选择*Target* → *Build Settings* → *Packaging* → *Product Name*。单击行。会弹出一个窗口。在此处输入您的新应用名称。

仅用于在 Xcode 4 或更高版本中更改项目名称（将与项目图标一起显示）：

*在Groups & Files*面板中单击您的项目文件图标，从右侧窗格中选择*Project (above targets)。*只需在最右侧的窗格中查看（仅当您启用“隐藏或显示实用程序”时它才可见）。查找项目名称。将其编辑为您要为项目指定的新名称。

从模拟器/设备中删除您的应用程序，清理并运行。变化应该反映。

就是这样。

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2015-12-19T12:03:01.520

我在主屏幕上看到了许多更改应用名称的方法，我认为编辑`.plist`文件或更改目标的*构建设置*的必要性是不合理的。

默认情况下，在 Xcode 7.2 中，您的文件中甚至没有“捆绑显示名称” `plist`。

默认情况下，目标的“构建设置”选项卡中的“产品名称”等于`$(TARGET_NAME)`. 恕我直言，这很方便，并不意味着要改变。

**因此，您可以像Hallski**在他的评论中所说的那样简单地更改您的目标名称以获得接受的答案。我为它拍了一张照片：

[![在此处输入图像描述](https://i.stack.imgur.com/4Xnj9.png)](https://i.stack.imgur.com/4Xnj9.png)

* * *

## 回答 #25

> 赞同：7
> 
> 时间：2016-02-24T07:32:55.323

我认为有一点混乱：

*   您要更改**项目名称**还是
*   是否要更改iOS 仪表板上的**应用名称？**

通常更改后者就足够了，在 plist 中添加/修改 BUNDLE DISPLAY NAME 键。

最好保持项目名称不变，但可能会更改。

请注意，Bundle display Name*可以*包含空格和特殊字符，但 project*不能*。由于文件名路径规则，这样做一些 cmd 行工具会失败。

甚至更多的捆绑显示名称可以本地化。

因此，除非您处于早期阶段并且需要更改*内部*项目名称，否则请继续使用 Bundle Display Name 键。

* * *

## 回答 #26

> 赞同：7
> 
> 时间：2016-11-30T10:31:00.583

有

*   `Product name`( `$(PRODUCT_NAME)`)：默认为`Target name`. 这对于`scheme`选择正确的目标很有用
*   `Bundle display name`( `CFBundleDisplayName`)：默认为`Product name`. 这是向您的 iOS 用户显示的内容

* * *

## 回答 #27

> 赞同：7
> 
> 时间：2016-12-30T16:27:48.237

*项目导航器*→*常规*→*显示名称*

[![在此处输入图像描述](https://i.stack.imgur.com/F7Obe.png)](https://i.stack.imgur.com/F7Obe.png)

* * *

## 回答 #28

> 赞同：6
> 
> 时间：2014-11-28T22:11:24.577

最简单的方法：选择目标名称，双击它，然后重命名。

您将在设备或模拟器上的图标下方看到应用的新名称。

* * *

## 回答 #29

> 赞同：6
> 
> 时间：2015-03-12T12:29:46.493

使用[Javier 的方法](https://stackoverflow.com/a/20418989/3962892 "导航到哈维尔的答案")重命名我的应用程序非常有效。最后我想补充一点。

在清理和重建之后，我仍然最终得到一个 Mach-O 链接器错误。解决这个问题；选择您的项目（在项目导航器中）。在 Targets 下，选择 yourProjectTests（测试目标）→ 在*General*选项卡下，将 Host Application 的值更新为新重命名的项目。

* * *

## 回答 #30

> 赞同：6
> 
> 时间：2015-03-30T05:01:26.480

在*Target* → *Build Setting* → *Product name*字段中，您可以在此处编辑该字段。

* * *

## 回答 #31

> 赞同：6
> 
> 时间：2017-10-12T06:58:19.393

选择项目导航器→*选择目标*→*身份*→*显示名称*→*名称*。

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2014-09-14T12:16:11.980

重命名 iOS 项目后，我正在使用此脚本。它有助于更​​改目录名称并使名称同步。

[http://github.com/ytbryan/rename](http://github.com/ytbryan/rename)

注意：您需要手动更改方案的名称。

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2015-06-06T03:40:32.493

下面的链接适用于 Xcode 6，尤其是当您在尝试重命名项目后遇到错误时。基本上，只需尝试构建您的应用程序的新方案。

[https://stackoverflow.com/a/27572164/4114835](https://stackoverflow.com/a/27572164/4114835)

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2021-06-09T11:19:16.683

按照以下四个步骤维护序列号。在第 4 步中给出您想要的名称..

[![在此处输入图像描述](https://i.stack.imgur.com/6WpHg.png)](https://i.stack.imgur.com/6WpHg.png)

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2021-01-23T15:59:45.300

使用*Target* → *Build Setting* → *Product name*。

# sorting - 有什么理由实现我自己的排序算法吗？

> ID：238988
> 
> 赞同：4
> 
> 时间：2008-10-27T03:13:43.927
> 
> 标签：sorting

排序已经研究了几十年，所以任何编程平台（java、.NET 等）提供的排序算法现在肯定是好的，对吧？是否有任何理由覆盖 System.Collections.SortedList 之类的内容？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-27T03:31:20.540

在某些时候，您对数据的深入了解可以产生比任何可用的通用算法更有效的排序算法。我在 SO 的另一篇文章中分享了这种情况的示例，但我将分享它只是为了提供一个案例：

回到 COBOL、FORTRAN 等时代……为电话公司工作的开发人员必须获取包含活动电话号码的相对大量数据（我相信它在纽约市地区），然后进行排序那个清单。最初的实现使用堆排序（这些是 7 位电话号码，并且在排序过程中发生了大量磁盘交换，因此堆排序是有意义的）。

最终，开发人员偶然发现了一种不同的方法：通过意识到每个电话号码中只有一个可以存在于他的数据集中，他意识到他不必将实际的电话号码本身存储在内存中。相反，他将整个 7 位电话号码空间视为一个非常长的位数组（每个字节有 8 个电话号码，1000 万个电话号码需要刚好超过一个兆来捕获整个空间）。然后，他对源数据进行了一次遍历，并将他找到的每个电话号码的位设置为 1。然后，他最后一次遍历位数组以查找高位并输出电话号码的排序列表。

这种新算法比堆排序算法快得多（至少快 1000 倍），并且消耗的内存量大致相同。

我想说，在这种情况下，开发人员开发自己的排序算法绝对有意义。

如果您的应用程序完全是关于排序的，并且您真的了解您的问题空间，那么您很有可能想出一个优于任何通用算法的特定于应用程序的算法。

然而，如果排序是你应用程序的一个辅助部分，或者你只是在实现一个通用算法，那么很有可能一些非常聪明的大学类型已经提供了一个比你能来的任何东西都更好的算法跟上。如果您可以将内容保存在内存中，那么快速排序确实很难被击败，并且堆排序对于大量数据集排序非常有效（尽管我个人更喜欢将 B+Tree 类型的实现用于堆 b/c，但它们已调整为磁盘分页表现）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-27T03:16:43.267

一般没有。

但是，您比编写这些排序算法的人更了解您的数据。也许您可以针对您的特定数据集提出一种比通用算法更好的算法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-27T03:32:37.477

实现自己的排序算法类似于优化，正如[查尔斯·安东尼·理查德·霍尔爵士](http://en.wikipedia.org/wiki/C._A._R._Hoare)所说，“我们应该忘记小的效率，比如大约 97% 的时间：过早的优化是万恶之源”。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T03:51:14.010

某些库（例如 Java 自己的 Collections.sort）根据可能适用于您的标准实现排序，也可能不适用于您。例如，Collections.sort 使用归并排序是因为它的 O(n log(n)) 效率以及它是就地排序的事实。如果两个不同的元素具有相同的值，则原始集合中的第一个元素保持在前面（有利于根据不同条件进行多遍排序（首先扫描日期，然后查找名称，集合保持名称（然后日期）排序））但是，如果您想要更好的常量或有一个特殊的数据集，那么实现您自己的快速排序或基数排序可能更有意义，具体到您想要做什么。

也就是说，[所有操作在足够小的 n 上都很快](http://www.codinghorror.com/blog/archives/001152.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T03:19:06.913

简短的回答；不，除了学术兴趣。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-27T04:57:48.227

*   您可能希望对排序实现进行多线程处理。
*   您可能需要比 Quicksorts O(n log n) 更好的性能特征，例如 bucketsort。
*   您可能需要稳定的排序，而默认算法使用快速排序。特别是对于用户界面，您会希望排序顺序保持一致。
*   更有效的算法可能适用于您正在使用的数据结构。
*   由于堆栈溢出（例如，您正在对大量数据进行排序），您可能需要默认排序算法的迭代实现。

无穷无尽。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-27T03:32:12.160

几个月前，Coding Horror 博客报道了某个平台的排序算法非常糟糕。如果您必须使用该平台，那么您肯定想要实现自己的平台。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-27T03:45:06.220

通用排序的问题已经被研究到了地狱，所以担心学术兴趣之外的问题是没有意义的。但是，大多数排序不是在通用输入上完成的，通常您可以使用数据的属性来提高排序速度。

一个常见的例子是计数排序。事实证明，对于通用比较排序，O(n lg n) 是我们希望做到的最好的。

但是，假设我们知道要排序的值在固定范围内的范围，比如 [a,b]。如果我们创建一个大小为 b - a + 1 的数组（默认一切为零），我们可以线性扫描数组，使用这个数组来存储每个元素的计数 - 产生线性时间排序（在数据的范围内） ) - 打破 n lg n 界限，但这仅仅是因为我们正在利用数据的特殊属性。有关更多详细信息，请参见[此处](http://en.wikipedia.org/wiki/Counting_sort)。

所以是的，编写自己的排序算法很有用。注意你正在分类的东西，你有时会想出显着的改进。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-27T06:01:14.417

如果您有实现排序算法的经验并了解数据特征对其性能的影响方式，那么您已经知道问题的答案。换句话说，您已经知道像快速排序这样的东西在几乎排序的列表中具有行人性能。:-) 而且，如果您的数据具有某些结构，则某些排序（几乎）是免费的。等等。

否则，没有。

# svn - 如何恢复 TortoiseSVN 意外删除的已删除文件？

> ID：238995
> 
> 赞同：1
> 
> 时间：2008-10-27T03:20:30.997
> 
> 标签：svn, tortoisesvn, file-recovery

这是一个意外，我认为没有解决办法。但我还是要问。

我向我们的网上商店介绍了 SVN，并将所有 dev pc 的 htdocs 设置为存储库的一部分。（我的第一个错误）

现在，我的一位同事正在做一个项目，并没有将他们的代码提交给 svn（第二个错误）。他的理由是他是唯一一个在那个网站上工作的人，他不需要 svn（另一个错误：我将 SVN 作为协作工具引入）

我指示每个人的 SOP 是：在启动和关闭 PC 时更新然后结帐。

不用说，我同事的项目消失了。

所以我的问题是：有没有办法恢复未提交的代码？

Ps，我打算在我们的规则中添加“源代码不存在，除非它被颠覆”和“每天备份”，以防止这种情况再次发生。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-27T03:22:56.123

你不会在 SVN 中找到答案，但你可以使用类似这个[undelete tool](http://www.altap.cz/salam_en/features/undelete.html)的东西。

在驱动器格式化（长）之前，文件并没有真正消失。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T03:23:18.603

如果文件从未提交并且它们不再位于硬盘驱动器上，那么恐怕它们可能已经消失了，除非您的用户有手动备份，或者其他一些恢复/取消删除策略有效。

# html - 在图例元素中包装标签元素

> ID：238996
> 
> 赞同：6
> 
> 时间：2008-10-27T03:20:48.237
> 
> 标签：html, label, fieldset, legend

我从来没有理由将标签元素放在图例元素中（从未真正考虑过或看到它完成）。但是对于我正在实施的设计，这样做很诱人。

这就是我想做的事情：

```
<fieldset>
<legend><label for="formInfo">I would like information on</label></legend>
<select id="formInfo">
    <option value="Cats">Cats</option>
    <option value="Dogs">Dogs</option>
    <option value="Lolz">Lolz</option>
</select>
</fieldset> 
```

它在 Firefox3、Safari、Opera 和 IE6/7 中按预期工作（单击标签聚焦相应的输入）并通过验证，但我只是想知道是否有任何已知原因（可访问性？语义？浏览器问题）为什么不应该这样做

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-27T06:05:00.557

你在哪里`</fieldset>`？

从语义上讲，[`legend`描述 a`fieldset`](http://www.w3.org/TR/html401/interact/forms.html#h-17.10)，就像`label`描述单个字段一样。

字段集应该用于将语义相关的字段组合在一起（例如，“地址”字段集可能具有街道、城市和国家的输入字段）。

假设您在字段集中有多个字段，那么执行您的建议在语义上没有意义——您需要创建单独的图例文本来描述字段集，然后为每个字段创建一个标签。

如果您只有一个字段，那么您根本不需要字段集或图例。

所以，基本上，你不应该做你正在做的事情。

如果你这样做是为了有额外的元素来附加 CSS 规则或 Javascript 事件，你最好使用通用元素`div`，`span`这样不会混淆文本到语音和其他非视觉用户代理。

即，在可访问性/语义方面（它不暗示任何内容）与滥用语义元素（即使只是轻微地，如本例中）相比，使用`div`或实际上是中立的，这可能会产生误导。`span`想象一下文本到语音浏览器中布局的*最佳情况*：文本被大声朗读两次，一次作为图例，一次作为标签——为什么有人希望大声朗读“我想要信息”这个短语两次给他们？`select`特别是因为它仅在控件中的选择上下文中才有意义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T03:33:12.673

好吧，标签元素本身看起来不错——它是“formInfo”元素的描述，所以不用担心。然而，从语义上讲，这个`legend`元素是什么意思？它应该是整个字段集的标题......*********