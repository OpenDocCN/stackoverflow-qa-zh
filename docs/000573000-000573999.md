# StackOverflow 问答 000573000-000573999

# c# - 什么是“投”

> ID：573002
> 
> 赞同：3
> 
> 时间：2009-02-21T13:38:27.367
> 
> 标签：c#, exception-handling, throw

谁能解释我在异常处理中使用 throw 吗？当我抛出异常时会发生什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-21T13:41:32.087

这意味着“导致”异常。当您“抛出”异常时，您是在说“出了点问题，这里有一些细节”。

然后，您可以“捕获”一个“抛出”异常，以允许您的程序优雅地降级而不是出错和死亡。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-21T13:43:24.233

“抛出”异常是触发异常处理的整个过程。

在正常执行过程中，程序中的行是通过循环和分支顺序执行的。当发生某种错误时，会创建一个异常然后抛出。

抛出的异常将修改程序中通常的操作顺序，使得在某处的“catch”块中处理异常之前不会执行“正常”指令。一旦在 catch 块中捕获到异常，并且该 catch 块中的代码被执行（“处理”异常），正常的程序执行将在 catch 块之后立即恢复。

```
// Do some stuff, an exception thrown here won't be caught.
try
{
  // Do stuff
  throw new InvalidOperationException("Some state was invalid.");
  // Nothing here will be executed because the exception has been thrown
}
catch(InvalidOperationException ex) // Catch and handle the exception
{
  // This code is responsible for dealing with the error condition
  //   that prompted the exception to be thrown.  We choose to name
  //   the exception "ex" in this block.
}
// This code will continue to execute as usual because the exception
//   has been handled. 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-21T13:50:02.317

当您抛出异常时，您基本上是在说某些情况已经超出了预期调用者处理它的合理方法。它们在无法发出任何形式的构造失败信号的构造函数中特别有用（因为它们没有返回值）。

当您抛出异常时，运行时会沿执行链向上移动，直到找到一个可分配给您抛出的异常类型的**catch块。**在它在你可能拥有的任何**finally**块中运行代码的过程中，它允许你（通常）释放你可能获得的任何资源。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T13:43:12.910

throw 创建要处理的异常。然后，您传递的对象将成为描述异常的数据。

在抛出某些东西之前，没有要处理的异常。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-21T14:15:22.333

抛出异常会导致异常在堆栈中上升。有两个主要场景`throw`。

1.  具有您的代码独有的异常情况

    ```
    if(inputVal < 0)
    {
        throw new LessThanZeroCustomException("You cannot enter a value less than zero");
    } 
    ```

    上面的代码假设您编写了一个名为`LessThanZeroCustomException`. 我实际上不会将其命名为，但`Custom`名称中的 旨在说明您对此进行了编码。它很可能继承自

2.  有已被捕获并需要重新抛出的异常情况。造成这种情况的正常原因是日志记录。在大多数情况下，我不喜欢这种模式，因为你最终会花时间一遍又一遍地捕捉、记录和扔东西。`try ... catch`这是因为大多数人在各个级别都采用这种模式。呸！

简而言之，`throw`意思是“我发现了一个我无法处理的异常情况，所以我通过抛出异常让使用此代码的人知道”。

# cocoa - 在 Cocoa 中将字符转换为 HTML 实体

> ID：573010
> 
> 赞同：3
> 
> 时间：2009-02-21T13:41:02.663
> 
> 标签：cocoa, html-entities

我目前正在尝试将我指定一些 GET 参数的 URL 放在一起。但我也想在这个 URL 中使用日文或其他字符。

有没有办法将 NSString 转换为包含我的 NSString 中“特殊”字符的 HTML 实体的字符串？

我目前正在使用以下代码，它似乎可以工作，除了像中文和日文这样的“特殊字符”：

```
NSString* url = @"/translate_a/t?client=t&sl=auto&tl=";
url = [url stringByAppendingString:destinationLanguage];
url = [url stringByAppendingString:@"&text="];
url = [url stringByAppendingString:text];

NSURL* nsurl = [[NSURL alloc] initWithScheme:@"http" host:@"translate.google.com" path:url]; 

NSError* error;
NSString* returnValue = [[NSString alloc] initWithContentsOfURL:nsurl encoding:NSUTF8StringEncoding error:&error]; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T20:30:26.517

要正确地对参数进行 URL 编码，您需要将每个名称和值转换为 UTF-8，然后分别对每个名称和值进行 URL 编码，然后使用 '=' 将名称与值连接起来，并使用 '&' 连接名称-值对。

我通常发现将所有参数放在 NSDictionary 中更容易，然后从字典中构建查询字符串。这是我用来执行此操作的类别：

```
// file NSDictionary+UrlEncoding.h
#import <Cocoa/Cocoa.h>

@interface NSDictionary (UrlEncoding)

-(NSString*) urlEncodedString;

@end

// file NSDictionary+UrlEncoding.m
#import "NSDictionary+UrlEncoding.h"

// private helper function to convert any object to its string representation
static NSString *toString(id object) {
  return [NSString stringWithFormat: @"%@", object];
}

// private helper function to convert string to UTF-8 and URL encode it
static NSString *urlEncode(id object) {
  NSString *string = toString(object);
  return [string stringByAddingPercentEscapesUsingEncoding: NSUTF8StringEncoding];
}

@implementation NSDictionary (UrlEncoding)

-(NSString*) urlEncodedString {
  NSMutableArray *parts = [NSMutableArray array];
  for (id key in self) {
    id value = [self objectForKey: key];
    NSString *part = [NSString stringWithFormat: @"%@=%@", 
                     urlEncode(key), urlEncode(value)];
    [parts addObject: part];
  }
  return [parts componentsJoinedByString: @"&"];
}

@end 
```

该方法构建一个名称-值对数组，`parts`通过 URL 对每个键和值进行编码调用，然后用“=”将它们连接在一起。然后`parts`数组中的部分用 '&' 字符连接在一起。

所以对于你的例子：

```
#import "NSDictionary+UrlEncoding.h"
// ...
NSMutableDictionary *parameters = [NSMutableDictionary dictionary];
[parameters setValue: @"t" forKey: @"client"];
[parameters setValue: @"auto" forKey: @"sl"];
[parameters setValue: destinationLanguage forKey: @"tl"];
[parameters setValue: text forKey: @"text"];
NSString *urlString = [@"/translate_a/t?" stringByAppendingString: [parameters urlEncodedString]]; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T15:05:02.557

`NSString`有方法`-stringByAddingPercentEscapesUsingEncoding:`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T15:40:20.473

这是您可以通过 Internet 找到的 NSString 扩展

[http://code.google.com/p/wimframework/source/browse/trunk/WimFramework/Classes/Helpers/WimAdditions.m](http://code.google.com/p/wimframework/source/browse/trunk/WimFramework/Classes/Helpers/WimAdditions.m)

解码部分在将数组索引映射到实际实体编号时存在一些错误。但是由于您只需要编码，因此可以使用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-21T09:27:07.717

对于字符串的简单 URL 编码，我见过的许多解决方案虽然在技术上是正确的，但看起来并不像我想要的那样易于使用。所以我想出了以下 NSString 类别：

```
@interface NSString (MLExtensions)

- (NSString *)urlencode;

@end

NSString *_mlfilterChars = @";/?:@&=+$,";

@implementation NSString (MLExtensions)

- (NSString *)urlencode
{
    return [[NSString stringWithString: (NSString *)
        CFURLCreateStringByAddingPercentEscapes(
            NULL, 
            (CFStringRef)self,
            NULL, 
            (CFStringRef)_mlfilterChars,
            kCFStringEncodingUTF8)]
               stringByReplacingOccurrencesOfString: @"%20" withString: @"+"];
}

@end 
```

我有点急于处理我正在处理的其他一些东西，所以我有点用 %20 => + 转换步骤作弊，但这一切似乎都很好，我已经使用了一段时间现在在我的应用程序中有很多 URL。

使用非常简单：

```
- (NSString *)URLForSearch: (NSString *)searchFor
{
    return [@"http://example.org/search?query="
                   stringByAppendingString: [searchFor urlencode]];
} 
```

# editor - 更改 Unix INFO 命令的编辑器

> ID：573022
> 
> 赞同：0
> 
> 时间：2009-02-21T13:43:27.493
> 
> 标签：editor, unix

目前我的“信息”命令使用 Emacs 作为它的默认编辑器。

```
$ info printf 
```

有没有办法把它改成 Vi/Vim？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T05:10:27.640

我能看到的最大希望是使用 --vi-keys 命令开关运行它，它“使用类似 vi 和不太类似的键绑定”。不幸的是，我没有看到任何其他对您有帮助的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T13:59:05.507

你需要一些理解 TexInfo 的东西，我不相信 Vi/Vim 能做到。你可能只是被emacs卡住了。更多信息在[维基百科](http://en.wikipedia.org/wiki/Info_(Unix))。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-21T13:47:11.543

尝试将 VISUAL 和 EDITOR 环境变量设置为 Vim 的完整路径。

# graphics - 我应该使用哪种 3D 模型格式？

> ID：573025
> 
> 赞同：32
> 
> 时间：2009-02-21T13:44:41.453
> 
> 标签：graphics, model, 3d, collada

我正在编写一个游戏引擎，我想知道我应该使用/加载/导出哪种 3D 模型格式？Obj 似乎通用且简单，但它似乎也不可靠，因为那里的大多数模型都包含错误，并且它不像其他格式那样存储任何地方。

似乎有专门用于 MD2/3/5 等游戏的格式，但我不确定，如果我建模，我会使用wings3d，除了纯粹从格式 Id 加载我需要和支持的内容之外，我不知道还有什么其他细节必须实施，例如我需要实施 IK 吗？我可以使用脚本化的每件动画而不是反向运动学和骨骼绑定吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-21T17:09:59.807

[Collada](http://en.wikipedia.org/wiki/COLLADA)是 Khronos 组（OpenGL 标准机构）拥有的基于 XML 的开放式 3d 模型格式

来自 Collada.org 常见问题解答：

COLLADA 1.4.x 功能集包括：

*   网格几何
*   变换层次结构（旋转、平移、剪切、缩放、矩阵）
*   效果
*   着色器（Cg、GLSL、GLES）
*   材料
*   纹理
*   灯
*   相机
*   剥皮
*   动画片
*   物理学（刚体、约束、布娃娃、碰撞、体积）
*   实例化
*   技术
*   多重表示
*   资产
*   用户数据

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-21T16:25:54.547

在担心您想要支持哪些 3D 格式之前，我认为您应该真正关注您计划在引擎中实现哪些功能。把这些写下来作为要求，并从列表中选择支持最多功能的格式......因为你会想要展示你的引擎（我假设你正计划让你的引擎公开可用）。如果您的引擎具有特定功能（这对于游戏引擎来说总是一件好事），您甚至可能想要推出自己的格式。

之后，尽可能多地支持流行的格式（.X、.3DS、.OBJ、.B3D）……您的引擎越容易访问，就越有更多人愿意使用它！

Collada 是一种很好的通用格式，但就像 Nils 提到的那样，它不是最终部署的理想格式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-21T15:14:21.847

我使用自己的二进制格式。我尝试使用现有格式，但总是遇到限制。有些可以解决，有些可以解决。

Collada 可能值得一看。我不认为它作为 3D 引擎可以读取的格式那么好。不过，它可以作为一般的数据交换格式。

[http://www.collada.org/mediawiki/index.php/Main_Page](http://www.collada.org/mediawiki/index.php/Main_Page)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-05T11:12:25.523

+1 科拉达。您可能还需要一个自定义的本机二进制格式以实现真正的快速加载（通常只是顶点/索引缓冲区数据的二进制转储，加上材质和骨架数据，以及适当的碰撞数据）。

游戏行业的一个趋势是支持在引擎的开发人员构建中加载像 collada 这样的格式，但也有一个导出优化版本以供发布的工具链。开发人员版本可以动态更新网格，因此当艺术家保存更改时，文件会自动重新加载，允许他们（几乎）即时查看模型的所见即所得，但仍提供完全优化的发布格式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-21T17:14:44.070

很好地支持 Collada，然后为其他格式提供良好的转换器（这可能是困难的部分）。这将为您提供最大的灵活性。看看[C4引擎](http://www.terathon.com/c4engine/index.php)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T23:43:39.290

Collada 很棒，但它更多地存在于 3D 应用程序方面。即它最好用于在应用程序之间传输 3D 数据，而不是从游戏引擎中加载 3D 数据。你有没有研究过Lua？它在游戏中被广泛使用，因为它是一种脚本语言，既快得离谱（非常适合游戏）又非常灵活（可用于表示引擎所需的任何数据）。

# vb.net - 如何将此代码转换为 LINQ？

> ID：573026
> 
> 赞同：2
> 
> 时间：2009-02-21T13:45:43.340
> 
> 标签：vb.net, linq, legacy

我正在尝试将其写为 LINQ，

**原始代码：**

```
For Each CurrentForm As Form In MyForms
    AddLink(CurrentForm.GetLink())
Next 
```

我是一个 LINQ 初学者，到目前为止我不太确定在哪里使用和在哪里不使用。如果在这种情况下 LINQ 会造成更大的伤害然后提供帮助，请随意给我发火。

**编辑：**您可以假设 AddLink() 有一个重载，它需要 IEnumerable

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T13:49:23.767

除非存在采用集合的 AddLink 重载，否则 LINQ 不会避免循环。

是否有这样的过载然后是这样的：

```
AddLinks(MyForms.Select(f => f.GetLink()) 
```

会做的。

* * *

上述表达式的工作原理（简要）：

*   LINQ 是关于表达式，获取一些对象（对于此处使用的 LINQ to Objects，始终是一个集合）
*   [Select](http://msdn.microsoft.com/en-us/library/bb548891.aspx)扩展方法接受一个集合和一个函数并返回一个集合。该函数被传递给输入集合的每个元素。然后 Select 返回由所有函数返回值组成的集合。
*   我使用[lambda 表达式](http://msdn.microsoft.com/en-us/library/bb397687.aspx)创建了一个匿名函数，该函数接受一个名为 f 的参数（其类型将由编译器确定）并返回表达式的值（现已更正）。
*   AddLinks 是您的 AddLink 的假定变体，它采用链接集合。

有很多事情要做，这是 LINQ 的优点之一，它是一种表达数据操作的紧凑方式，没有显式循环和临时变量的通常开销。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T13:49:53.313

这里没有火焰，但 LINQ 在这里不会有真正的帮助。如果 LINQ 有一个`ForEach`方法（如上一个[问题](https://stackoverflow.com/questions/571265)以及其他地方所讨论的），那么您可以使用它 - 但它不是 LINQ 内置的，在这种情况下，它似乎并没有太大用处。

当然，这完全取决于它`AddLink`的作用——如果它向列表添加一个链接，而您可以使用 (say) `List.AddRange`，那么您*可以*使用 LINQ。但是这段代码看起来已经非常简单和可读了，所以在这种情况下我不会担心。

# vmware - 寻找已安装 Linux 的 Virtual PC 或 VMware Guest O/S

> ID：573032
> 
> 赞同：0
> 
> 时间：2009-02-21T13:47:58.233
> 
> 标签：vmware, virtual-pc

我想玩弄 Linux 并做一些测试。我尝试在 Virtual PC (2004) 来宾上安装 Linux，但无法正常工作。

我想和所有在外面宣传 Linux 的人一样，也许有人做了一个猜测文件，我可以下载并在 Virtual PC（理想情况下）或 VmWare 中打开。

PS - 大约 2 年前我在 ExpertsExchange 上问过问题，我得到的只是人们告诉我应该使用 VMware（但没有建议在哪里可以找到预先制作的访客记录。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T13:54:49.620

预装来宾的 VMWare 库位于[http://www.vmware.com/appliances/](http://www.vmware.com/appliances/) - 不过它目前似乎已停止维护。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-21T13:56:38.633

VMware播放器：http: [//www.vmware.com/products/player/](http://www.vmware.com/products/player/)

vmware 镜像： http: [//www.vmware.com/appliances/](http://www.vmware.com/appliances/)

设备网站对我来说已关闭，但您可以下载各种操作系统的预制映像并使用 vmware 播放器或 vmware 服务器运行它们。

Ubuntu 8.04： http: [//www.vmware.com/appliances/directory/1224](http://www.vmware.com/appliances/directory/1224)

此外，只需查看右侧的热门部分。我发现当你想使用 Linux 时，vmware 是要走的路。我在尝试将它安装在虚拟 PC 上时遇到了问题，但自从我在 2006 年使用 Fedora 进行尝试后，这种情况可能已经改变。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T14:27:41.990

在我写这篇文章时，VMWare 设备站点已关闭，但是有一个非常有用的设备，大约 60K，它允许您将 ISO 挂载为 VM。

这很棒，因为您不必在 VM 中安装发行版。您可以每次都将 ISO 以新的形式加载到 VM 中，或者只是重新加载挂起的映像。

当您感觉舒适时 - 尝试在 VM 中安装 Linux 版本。

您也可以简单地将 ISO 刻录到 CD/DVD 并启动它来播放 - 无需安装。

您还应该看看 Sun 的 VirtualBox VM manager。它免费而且相当不错。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T01:46:49.690

试试[http://elasticserver.com/](http://elasticserver.com/)

他们为 linux VM 提供点菜方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T02:18:58.600

虚拟主机 Linux 很痛苦。如果您必须这样做，请使用[Sun 的 VirtualBox](http://www.virtualbox.org/) - 它启动速度更快，并且确实比其他任何东西都更易于使用。您也可以从[VirtualBoxImages](http://virtualboximages.com/veedeeeyes/About)获得 Ready To Use VDI 图像...但是，如果您只是想“玩”使用 linux，那么为什么不启动[LiveCD](https://help.ubuntu.com/community/LiveCD) ..

# vim - 在 Vim 中打开文件的快捷方式

> ID：573039
> 
> 赞同：123
> 
> 时间：2009-02-21T13:50:50.067
> 
> 标签：vim, keyboard-shortcuts

我想在 Vim 中打开一个文件，就像在 Eclipse 中使用`Ctrl`++或通过自动填充的`Shift`+选项一样。调用键盘快捷键，键入文件名/模式，然后从所有匹配的文件名中进行选择。`R``Ctrl``N`

我知道打开它通常像：

```
:tabe <filepath>
:new <filepath>
:edit <filepath> 
```

这里的问题是在这些情况下我必须指定整个文件路径。

* * *

## 回答 #1

> 赞同：142
> 
> 时间：2009-02-22T07:43:08.290

我通常做的是`e .`（e-space-dot），它为我提供了一个可浏览的当前目录——然后我可以`/`——搜索名称片段，就像在文本文件中查找单词一样。我发现这通常足够好，简单快捷。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-02-21T14:16:51.877

我最近爱上了[fuzzyfinder.vim](http://www.vim.org/scripts/script.php?script_id=1984) ... :-)

*:FuzzyFinderFile*将允许您通过键入部分名称或模式来打开文件。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2010-08-04T15:46:24.957

`:find`是另一种选择。

我从项目的根目录打开 vim 并将`path`设置放在那里。

然后，我可以使用以下命令打开位于树中任何位置的文件：

```
:find **/filena< tab > 
```

选项卡将通过各种匹配自动完成。（`**`告诉它递归搜索路径）。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2009-02-21T13:54:56.780

您可以使用以下命令在当前路径中搜索文件`**`：

```
:tabe **/header.h 
```

如果有多个匹配项，请点击选项卡以查看各种完成情况。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2012-04-28T11:03:56.397

考虑使用[CtrlP](http://github.com/kien/ctrlp.vim)插件。

它包含在[Janus Distributive](https://github.com/carlhuda/janus)中。

允许您使用“模糊匹配”或正则表达式查找当前目录中的文件、打开的缓冲区或最近使用的文件。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-02-21T13:53:01.217

除非我遗漏了什么， :e 文件名是我找到的最快的方法。

您也可以使用选项卡自动完成文件名。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2009-02-21T14:07:39.433

我喜欢我的设置中的 :FuzzyFinderTextMate （或`Ctrl`+ `F`）。见[http://weblog.jamisbuck.org/2008/10/10/coming-home-to-vim](http://weblog.jamisbuck.org/2008/10/10/coming-home-to-vim)

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-02-21T15:25:23.193

我在我的 .vimrc 文件中使用了几个快捷方式（下面的确切语法）。

它们基于这样一个事实，即在 90% 的情况下，我想在与我当前正在编辑的文件相同的目录中打开另一个文件，或者在层次结构中与该已编辑文件非常接近的目录中打开另一个文件。

**以下是命令的作用：**

`,cd`：将当前工作目录更改为您正在编辑的当前文件所在的目录。

`,e`：打开一个已经填写了当前工作目录的文件，因此您只需指定**文件**名。

**把这些放到你的 .vimrc 中：**

```
map ,e :e <C-R>=expand("%:p:h") . "/" <CR>

map ,cd :cd %:p:h <CR> 
```

**以下是一系列事件：**

* * *

1.  您正在“/home/prog”中编辑一个名为 test.java 的文件
2.  `,cd`-> 当前工作目录现在变为“/home/prog”
3.  `,e`-> 扩展为 ":e /home/prog" 这样你就可以只填写文件名，比如 test.h。

* * *

1.  `,e`-> 扩展为 ":e /home"
2.  `tab`-> 循环浏览 /home 的子目录
3.  `enter`->`cd`到你要说的目录 /home/prog
4.  `,e`-> 扩展为 ":e /home/prog"

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2010-08-09T01:31:43.340

还有 command-t 我发现它是最好的（我已经全部尝试过了）。安装它是一个小麻烦，但是一旦安装它，使用它就是一个梦想。

[https://wincent.com/products/command-t/](https://wincent.com/products/command-t/)

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-02-21T13:52:36.037

使用制表符，它们在 vim 转义模式下输入文件路径时起作用！

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-02-21T14:14:30.133

如果你有标签（你应该），你可以从命令行中打开一个文件，只需通过类或方法或 c 函数的名称，使用 "vim -t DBPlaylist"，并在 vim 中使用 ":tag ShowList ”。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-02-21T15:03:44.993

如果您正在编辑公共目录中的文件，则可以`:cd`到该目录，然后`:e`仅在文件名上使用。

例如，而不是：

```
:e /big/long/path/that/takes/a/while/to/type/or/tab/complete/thingy.rb
:sp /big/long/path/that/takes/a/while/to/type/or/tab/complete/other_thingy.c
:vs /big/long/path/that/takes/a/while/to/type/or/tab/complete/one_more_thingy.java 
```

你可以做：

```
:cd /big/long/path/that/takes/a/while/to/type/or/tab/complete/
:e thingy.rb
:sp other_thingy.c
:vs one_more_thingy.java 
```

或者，如果您已经在所需目录中打开了一个文件，您可以使用当前文件名的简写，并使用修饰符 ( )`%`将其修剪到当前目录：`:h``:help :_%:`

```
:e /big/long/path/that/takes/a/while/to/type/or/tab/complete/thingy.rb
:cd %:h
:sp other_thingy.c
:vs one_more_thingy.java 
```

而且，就像其他人所说的那样，您可以在前行上用制表符完成文件名（更多信息请参阅`:help cmdline-completion`）。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-01-07T20:56:06.870

这并不*完全*是您要寻找的，但在许多情况下（尽管不是全部）都很好。

如果您打开 VIM 并且缓冲区中有一个文件名，您可以将光标放在该文件名上并键入`g``f`. 这将在同一缓冲区中打开其名称位于光标下的文件。这是一样的

`:e `CTRL`+`r` `CTRL`+`w``

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-02-22T01:59:14.170

我知道三个插件允许打开文件，支持自动完成，并且不需要输入要打开的文件的完整路径名（只要文件位于`&path`vim 选项的目录之一下） ：

*   [我正在维护的searchInRuntime](http://code.google.com/p/lh-vim/wiki/searchInRuntime)（完成不在`:e`/上`:find`，而是在拆分操作上）
*   正如已经指出的那样，[模糊查找器，](http://www.vim.org/scripts/script.php?script_id=1984)
*   [查找文件](http://www.vim.org//scripts/script.php?script_id=1581)。

最近，我看到另一个具有类似功能的插件，但我不记得名字了。

很快， :find 很可能会支持自动补全——关于这个主题的补丁最近在 vim_dev 邮件列表上流传。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-21T14:30:46.617

*   你可以使用（设置wildmenu）
*   您可以使用选项卡自动完成文件名
*   您还可以使用匹配，例如 :e`p*.dat`或类似的东西（就像在旧的 dos 中一样）
*   您也可以 :browse confirm e (用于图形窗口)

*   但你也应该指定你正在使用的 vim 版本，以及 emacs 中的那个东西是如何工作的。也许我们可以为您找到一个确切的 vim 替代方案。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-02-23T11:03:13.823

已经提到了 FuzzyFinder，但是我喜欢[FuzzyFinderTextmate](http://weblog.jamisbuck.org/2008/11/17/vim-follow-up)插件的类似文本的行为，它扩展了行为以包括所有子目录。

确保您使用的是 2.16 版的fuzzyfinder.vim - 更高版本会破坏插件。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-05-06T04:30:57.130

使用 Exuberant ctags，您可以创建带有文件信息的标签文件：

```
ctags --extra=+f -R * 
```

然后，从 VIM 打开文件

```
:tag filename 
```

您还可以使用`<tab>`自动完成文件名。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2019-03-29T03:23:26.950

在 GVIM 中，可以使用打开/读/写对话框浏览文件；

```
:browse {command} 
```

{command} - 打开/读/写

**open** - 打开文件 **read** - 追加文件 **write** - SaveAs 对话框

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-01-07T20:42:37.493

我安装了 FuzzyFinder。但是，限制是它只能在当前目录中查找文件。一种解决方法是添加 FuzzyFinderTextmate。但是，根据文档和评论，这并不可靠。您需要正确版本的 FuzzyFinder，并且您需要使用 Ruby 支持编译您的 Vim 副本。

我现在尝试的另一种解决方法是在编辑会话开始时打开我可能需要的所有文件。例如，打开关键目录中的所有文件...

```
:args app/**
:args config/**
:args test/**
etc... 
```

（这意味着我可能会打开许多​​文件，但到目前为止它似乎仍然可以正常工作。）

之后，我可以在缓冲模式下使用 FuzzyFinder，它的行为有点像 TextMate 的`command-o`快捷方式......

```
:FuzzyFinderBuffer 
```

# xaml - 无法在 VS2008 SP1 中使用 WPF 设计器

> ID：573040
> 
> 赞同：1
> 
> 时间：2009-02-21T13:50:55.637
> 
> 标签：xaml, visual-studio-2008-sp1

我搜索了几个小时的四个解决方案，但一无所获。如果我在 VS2008 Team Suite SP1 中打开 WPF 设计器，则会出现以下错误：

> 加载此程序集会产生与其他实例不同的授权集。（来自 HRESULT 的异常：0x80131401）在 System.RuntimeType.CreateInstanceSlow（Boolean publicOnly，Boolean fillCache）的 System.RuntimeType.CreateInstanceSlow（Boolean publicOnly，Boolean fillCache）的 System.RuntimeTypeHandle.CreateInstance（RuntimeType 类型，Boolean publicOnly，Boolean noCheck，Boolean& canBeCached，RuntimeMethodHandle& ctor，Boolean& bNeedSecurityCheck）。 CreateInstanceImpl(Boolean publicOnly, Boolean skipVisibilityChecks, Boolean fillCache) at System.Activator.CreateInstance(Type type, Boolean nonPublic) at System.RuntimeType.CreateInstanceImpl(BindingFlags bindingAttr, Binder binder, Object[] args, CultureInfoculture, Object[] activationAttributes)在 System.Activator.CreateInstance（类型类型，BindingFlags bindingAttr，Binder binder，
> 在 MS.Internal.Providers.VSDesignerContext..ctor(IServiceProvider provider, IVsWindowFrame frame, Object docDataObj) 在 MS.Internal.Providers.VSDesignerContext.GetContext(IServiceProvider services, IVsWindowFrame frame, Boolean createIfNotExist) 在 MS.Internal.Designer.DesignerPane。初始化设计器（）

到现在我尝试了什么：

*   重置 Visual Studio 中的所有设置
*   关闭项目中所有打开的 XAML 文件，关闭 Visual Studio，重新打开 VS，打开 XAML 文件
*   在操作系统中创建新用户并尝试使用他们的开放解决方案
*   已完成卸载/重新安装 VS 2008 SP1 + MSDN、.NET 3.5 Framework SP1、Silverlight SDK、WPF Toolkit - 2009 年 1 月

我在 Windows Vista SP1 32 位商业版上运行。

在我尝试重新安装操作系统之前，有谁知道如何解决它？

问候安东卡尔奇克

更新：我还尝试禁用所有附加组件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T08:39:51.163

首先，不仅您收到此错误，所以您应该[先用谷歌搜索它](http://www.google.com/search?q=Loading+this+assembly+would+produce+a+different+grant+set+from+other+instances&ie=utf-8&oe=utf-8)吗？正如您所看到的，此问题有很多行为，我们无法找出您的情况出了什么问题，因为很难重现该问题。您也可以尝试修复 VS 或[禁用所有插件](http://social.msdn.microsoft.com/Forums/en-US/vswpfdesigner/thread/40e2b0a8-8131-4b50-a290-654f657c1d8e/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T11:21:26.393

感谢您解释失败的尝试。节省了我的时间和虚假的希望。您是否尝试过在没有 SP1 的情况下重新安装 VS？（你敢打赌这是 SP1 的错，这在我更新 VS 之前从未发生过）另外你的设计师不从事任何项目，对吗？甚至是新的？在其他 prog 语言中呢？

# c# - 如何在 Visual Studio 2008“Pro”中进行性能分析

> ID：573050
> 
> 赞同：6
> 
> 时间：2009-02-21T13:57:54.793
> 
> 标签：c#, visual-studio, visual-studio-2008, performance, profiling

微软制作了这款名为“Visual Studio 2008 Professional”的软件。我发现其中似乎没有应用程序性能分析器或类似的东西，这使得它对我来说似乎不是那么“专业”。

如果 Microsoft 不包含分析器，那么您有哪些第三方选项可用于 Visual Studio 2008 的时间分析？免费会更好，因为这是为了大学学生的目的：P

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-21T15:05:36.750

有几个免费的分析器，不像商业的那样完整或完善，但它们肯定可以提供很多帮助：

[Eqatec](http://www.eqatec.com/tools/profiler?gclid=CM_xvqDx7ZgCFRxNagod_Xic1Q) - 这是为 Windows CE 设计的，但对于普通应用程序来说工作得很好。

[Soft Prodigy Profile Sharp](http://www.softprodigy.net/products) - 这实际上是一个用 c# 编写的开源项目，因此您可以根据需要对其进行修改。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-21T14:01:27.420

就个人而言，我使用 Red Gate 分析器。

其他人则对 JetBrains 发誓。

这些似乎是选项，它们之间没有太多选择。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-21T14:02:21.677

我使用[JetBrains dotTrace 分析器](http://www.jetbrains.com/profiler/index.html)。这是一个商业分析器。（完全披露：我作为 MVP 获得了免费许可证。但*事实*证明它非常有用。）

还有[适用于 .NET 2.0 的免费 CLR Profiler](http://www.microsoft.com/downloads/details.aspx?familyid=A362781C-3870-43BE-8926-862B40AA0CD0&displaylang=en)和[一篇解释如何使用它的文章](http://msdn.microsoft.com/en-us/library/ms979205.aspx)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-21T14:01:55.750

我使用[团队系统版](http://msdn.microsoft.com/en-us/teamsystem/default.aspx)。它带有一个非常好的分析器。还有其他选择：

*   [Rational Purify](http://www-01.ibm.com/software/awdtools/purify/)（有这个 PurifyPlus，但不知道多少）
*   [英特尔 Vtune](http://www.intel.com/cd/software/products/asmo-na/eng/239144.htm)

希望有帮助。注意：它们都不是免费的。

快乐的分析:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-16T23:25:36.860

下载 VS 2008 独立命令行分析器 [http://www.microsoft.com/downloads/details.aspx?familyid=fd02c7d6-5306-41f2-a1be-b7dcb74c9c0b&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=fd02c7d6-5306-41f2-a1be-b7dcb74c9c0b&displaylang=en)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-21T14:01:02.070

[RedGate ANTS profiler](http://www.red-gate.com/Products/ants_profiler/index.htm)并不昂贵，而且可以胜任。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-21T14:01:34.907

我使用 JetBrain 的 dotTrace，效果很好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-22T22:08:22.250

[与以下相同的答案：](https://stackoverflow.com/questions/550109/what-are-some-resources-i-can-use-to-learn-profiling-optimizing/575417#575417)

重新编辑：你问你的选择是什么。如果你的心是分析，然后寻找一个分析器。

另一方面，如果您确实有性能问题要查找，那么简单方法的效果与几乎所有分析器一样好或更好。我说几乎每一个，因为在某些分析器中，您实际上可以梳理出您需要知道的内容，这是归因于单个指令的时间成本，尤其是调用指令。

一条指令的时间成本是如果可以删除该指令将节省的时间量，并且对它的良好估计是包含它的调用堆栈样本的分数。您不需要以高精度估计该分数。如果指令在 10 个样本中的 5 个上，它的成本可能在 45% 到 55% 的范围内。无论如何——如果你能摆脱它，你就会节省它的成本。

所以发现性能问题并不难。只需获取一些调用堆栈样本，收集这些样本的指令集，然后按包含它们的样本分数对指令进行排序。在高分数指令中有一些您可以优化掉，您不必猜测它们在哪里。

我进行了一些简化，因为通常检查更多的状态信息而不是仅仅检查调用堆栈是有帮助的，以查看正在完成的某些工作是否真的有必要。但我希望重点是。

人们怀疑它是否可以在存在递归的情况下工作，或者在大型程序上工作。稍加思考（和实验）就表明这些反对意见是站不住脚的。

# java - 在 jeditorpane (java swing) 上显示图像

> ID：573055
> 
> 赞同：7
> 
> 时间：2009-02-21T13:58:54.057
> 
> 标签：java, image, swing, jeditorpane

我有一个通过这种方式创建的 JEditorPane：

```
JEditorPane pane = new JEditorPane("text/html", "<font face='Arial'>" + my_text_to_show + "<img src='/root/img.gif'/>" + "</font>"); 
```

我把这个窗格放在一个 JFrame 上。

文字显示正确，但看不到图片，只有一个方块表示应该有图片（即：未找到图片时浏览器显示的“破损图片”）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-21T15:28:33.560

您必须提供类型并获取资源。就这样。我测试过的例子，但我不确定格式化。希望能帮助到你：

```
import java.io.IOException;
import javax.swing.JEditorPane;
import javax.swing.JFrame;

public class Test extends JFrame {

    public static void main(String[] args) throws Exception {
        Test.createAndShowGUI();
    }

    private static void createAndShowGUI() throws IOException {

        JFrame.setDefaultLookAndFeelDecorated(true); 

        JFrame frame = new JFrame("HelloWorldSwing");

        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        String imgsrc = 
            Test.class.getClassLoader().getSystemResource("a.jpg").toString();
        frame.getContentPane().add(new JEditorPane("text/html",
            "<html><img src='"+imgsrc+"' width=200height=200></img>"));
        frame.pack();

        frame.setVisible(true);
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-21T21:42:58.777

JEdi​​torPane 也使用 HTMLDocument.getBase 来定位相对 url，因此如果您正在显示目录中的内容，请确保在 html 文档上设置基础，以便它解析相对于基础目录的 url。

根据该图像的实际位置，您可能希望扩展 HTMLEditorKit+HTMLFactory+ImageView 并提供 ImageView 的自定义实现，该实现也负责将属性 URL 映射到图像 URL。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-04-10T06:58:00.640

以上都对我不起作用，但是 `'imgsrc = new File("passport.jpg").toURL().toExternalForm();'` 让我尝试让 html 中的每个图像都有一个前面的“文件：”，以便它现在显示为：

```
<img src="file:passport.jpg" /> 
```

这对我来说很好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-11-30T14:39:00.390

如果要指定图像的相对路径。

假设您的项目文件夹结构如下：

`sample_project/images`
`sample_project/images/loading.gif`
`sample_project/src`
`sampler_project/src/package_name`

现在图像标签看起来像这样：
`"<img src='file:images/loading.gif' width='100' height='100'>"`

耶！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-15T10:50:28.920

我在netbeans工作时使用了它，但它确实有效。如果程序应该在netbeans之外运行，我想稍微修改一下，

```
String imgsrc="";
try {
    imgsrc = new File("passport.jpg").toURL().toExternalForm();
} catch (MalformedURLException ex) {
   Logger.getLogger(EntityManager.class.getName()).log(Level.SEVERE, null, ex);
}
//System.out.println(imgsrc); use this to check
 html = "<img src='" + imgsrc + "' alt='' name='passport' width='74' height='85' /><br />";
//use the html ... 
```

如果您从 jar 运行，则图像文件必须在同一目录级别，...实际上，图像文件必须与您的执行条目在同一目录中。

# jquery - 错误消息“$.metadata”为空或不是对象。在 jQuery 中使用验证插件

> ID：573063
> 
> 赞同：0
> 
> 时间：2009-02-21T14:01:57.777
> 
> 标签：jquery, validation

我在 jQuery 中使用[验证插件。](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)

我在 Internet Explorer 中的代码给出了如下错误：

> '$.metadata' 为 null 或不是对象。

### 我的部分代码

```
 $(document).ready(function() {
       $.validator.setDefaults({
          submitHandler: function() {
               alert("OK");
          }
       }); 

       $.metadata.setType("attr", "validate"); 
       $("#email").validate();
}); 
```

如何纠正错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T15:41:28.770

您似乎没有包含[metadata plugin](http://view.jquery.com/trunk/plugins/metadata/jquery.metadata.js)。请检查您页面的代码。

# linq-to-sql - 当 datacontext ObjectTrackingEnabled = false 时 linq 上的 CRUD 操作

> ID：573065
> 
> 赞同：2
> 
> 时间：2009-02-21T14:03:42.360
> 
> 标签：linq-to-sql, crud

一个小问题。我在 n 层应用程序中使用 LinqToSql。我有一个数据上下文，我希望操纵 CRUD 操作。出于可扩展性的原因，我宁愿我的数据上下文没有对象跟踪。但是，当我将对象跟踪设置为故障时，我无法使用数据上下文必须提供的内置 CRUD 操作。那么......我该如何解决这个问题？

非常感谢您提前。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T17:06:17.337

您可以使用存储过程，但在对象跟踪关闭的情况下，您将无法使用“SubmitChanges”方法将新对象/更改持久保存到数据库中。（另外，仅供参考，在提交 LINQ to SQL 之前，请务必查看 ADO.NET Entity Framework）

Scott Gu - LINQ to SQL 存储过程

[http://weblogs.asp.net/scottgu/archive/2007/08/16/linq-to-sql-part-6-retrieving-data-using-stored-procedures.aspx](http://weblogs.asp.net/scottgu/archive/2007/08/16/linq-to-sql-part-6-retrieving-data-using-stored-procedures.aspx)

-

LINQ to SQL 概述

[http://msdn.microsoft.com/en-us/library/bb425822.aspx](http://msdn.microsoft.com/en-us/library/bb425822.aspx)

-

ADO.NET 实体框架概述

[http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)

# macos - 无法使用默认 Apache Web 服务器在 Mac OS X 上提供页面

> ID：573067
> 
> 赞同：3
> 
> 时间：2009-02-21T14:05:03.807
> 
> 标签：macos

我已经在我的 Mac OS X (10.5.6) 上启用了 Web 服务器，方法是转到系统偏好设置 -> Internet 和网络 -> 共享并单击 Web 服务器选项。它为我提供了作为 Web 服务器的系统的 IP 地址，但即使单击它，它也不会显示页面，而是给出错误：无法连接

对此的任何帮助都会很棒。

我尝试过使用 MAMP，但在那里，我无法显示我自己的 PHP 页面。

从命令行启动和/或停止 Web 服务器，给了我以下信息：

```
dyld: Symbol not found: _apr_socket_sendfile
  Referenced from: /usr/sbin/httpd
  Expected in: /usr/lib/libapr-1.0.dylib

Trace/BPT trap 
```

我盒子里的文件是：

```
~ $ ls -lrt /usr/lib/libapr*
-rwxr-xr-x  1 root  wheel  578640 Sep 23  2007 /usr/lib/libapr-1.0.2.7.dylib
-rwxr-xr-x  1 root  wheel  393696 Sep 23  2007 /usr/lib/libaprutil-1.0.2.7.dylib
-rwxrwxr-x  1 root  admin  569544 Oct 27 10:44 /usr/lib/libaprutil-1.0.2.12.dylib
-rwxrwxr-x  1 root  admin  835824 Oct 27 10:44 /usr/lib/libapr-1.0.2.12.dylib
lrwxr-xr-x  1 root  admin      25 Jan  4 22:28 /usr/lib/libaprutil-1.dylib -> libaprutil-1.0.2.12.dylib
lrwxr-xr-x  1 root  admin      25 Jan  4 22:28 /usr/lib/libaprutil-1.0.dylib -> libaprutil-1.0.2.12.dylib
lrwxr-xr-x  1 root  admin      21 Jan  4 22:28 /usr/lib/libapr-1.dylib -> libapr-1.0.2.12.dylib
lrwxr-xr-x  1 root  admin      21 Jan  4 22:28 /usr/lib/libapr-1.0.dylib -> libapr-1.0.2.12.dylib 
```

MD5 值为：

```
~ $ openssl md5 /usr/sbin/httpd /usr/lib/libapr-1.0.dylib 
MD5(/usr/sbin/httpd)= d5194790e9cfaca881d0e8fc3db24889
MD5(/usr/lib/libapr-1.0.dylib)= f7f7fd3cd315ca4e7c6ad2a2f222998e 
```

libapr-1.0.dylib 链接到较新的 1.0.2.12 版本。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-02T23:16:26.720

我遇到了类似的问题并进入了这个页面，因为我今天感觉很幸运:) 错误意味着 httpd 二进制文件引用了在适当的动态链接库中找不到的符号（在这种情况下为 libapr，Apache 运行时库）

在 iMac 上运行相同的 OS X 版本。/usr/lib/libapr-1.0.dylib 指向库的最新版本（1.0.2.12），它没有定义方法/符号_apr_socket_sendfile

libapr 库的另一个版本是 1.0.2.7，确实有那个符号。我让符号链接指向这个版本（也适用于 libaprutil）：

```
// 之前（1.0.2.7 和 1.0.2.12 版本都存在，符号链接指向 .12）
bash-3.2# ls -l libapr*
-rwxr-xr-x 2 用户轮 835824 2008 年 9 月 19 日 libapr-1.0.2.12.dylib
-rwxr-xr-x 1 根轮 578640 2007 年 9 月 24 日 libapr-1.0.2.7.dylib
lrwxrwxrwx 1 根轮 21 2008 年 10 月 14 日 libapr-1.0.dylib -> libapr-1.0.2.12.dylib
lrwxrwxrwx 1 根轮 21 2008 年 10 月 14 日 libapr-1.dylib -> libapr-1.0.2.12.dylib
-rwxr-xr-x 2 用户轮 569544 2008 年 9 月 19 日 libaprutil-1.0.2.12.dylib
-rwxr-xr-x 1 根轮 393696 2007 年 9 月 24 日 libaprutil-1.0.2.7.dylib
lrwxrwxrwx 1 根轮 25 2008 年 10 月 14 日 libaprutil-1.0.dylib -> libaprutil-1.0.2.12.dylib
lrwxrwxrwx 1 根轮 25 2008 年 10 月 14 日 libaprutil-1.dylib -> libaprutil-1.0.2.12.dylib

// 将符号链接更改为以前的版本
bash-3.2# ln -sf libapr-1.0.2.7.dylib libapr-1.0.dylib
bash-3.2# ln -sf libapr-1.0.2.7.dylib libapr-1.dylib
bash-3.2# ln -sf libaprutil-1.0.2.7.dylib libaprutil-1.0.dylib
bash-3.2# ln -sf libaprutil-1.0.2.7.dylib libaprutil-1.dylib

// 测试httpd是否加载并运行
bash-3.2# /usr/sbin/httpd -t
语法OK

```

不太确定自从上次包含 Apache Web 服务器的软件更新以来这是否已经被破坏，我很少在这个盒子上使用它。

希望它有所帮助；）
乔恩

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T17:22:00.217

可能是 apache 配置有错误。

如果您在系统偏好设置中禁用网络服务器并打开终端，您可以通过键入以下内容检查您的配置：

```
httpd -t 
```

如果它给出“语法 OK”，那么您离工作的网络服务器更近了一步。通过键入以下内容手动启动网络服务器：

```
sudo httpd 
```

如果没有错误，则启动 Web 服务器。打开浏览器并检查[http://localhost](http://localhost/)。有时需要额外刷新 (Command+R)。

停止服务器：

```
sudo httpd -k stop 
```

如果手动启动有效，但系统首选项版本无效，请检查 /var/log/apache2/error_log 是否有错误。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-12T13:28:08.000

您可以尝试执行以下操作： 1\. 备份当前的 apache

```
sudo cp /usr/sbin/httpd /usr/sbin/httpd.old 
```

2.将apache二进制文件中的链接替换为旧库：

```
sudo install_name_tool -change /usr/lib/libapr-1.0.dylib /usr/lib/libapr-1.0.2.7.dylib /usr/sbin/httpd 
```

在它应该按预期工作之后，其他应用程序仍将使用新版本的 libapr

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T14:14:32.710

如果您尝试从计算机本身访问页面，只需使用[http://localhost/](http://localhost/)。另外，尝试在浏览器中输入 IP 地址（而不是直接点击界面中的链接）；不要让我解释原因，但我已经看到这有所作为。

还要确保操作系统的防火墙设置为允许连接到 Apache。应选中“个人网络共享”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-21T17:37:45.123

[http://foundationphp.com/tutorials/php_leopard.php](http://foundationphp.com/tutorials/php_leopard.php)

我在我的身上跟着这个，它工作得很好。

尝试关注它，看看它是否有效

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T16:18:20.923

您是否在您的机器上安装了 subversion 1.5 客户端？我看到了同样的问题，似乎是因为这个。/usr/lib/libapr-1.0.dylib 通常链接到 /Developer/SDKs/MacOSX10.5.sdk/usr/lib/libapr-1.0.2.7.dylib 但如果您安装 svn 1.5 它会重新链接到 /opt /subversion/lib/libapr-1.0.2.12.dylib。

该库的 1.0.2.12 版本不包含符号 _apr_socket_sendfile。

找到问题后，我仍在试图弄清楚如何解决它。

道格

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T20:21:58.977

愚蠢的问题。libapr-1.0.dylib 是否存在？

在我的 Macbook 上，/usr/lib/libapr-1.0.dylib 是指向 libapr-1.0.2.7.dylib 的符号链接。

对该文件运行 nm 确实表明 apr_socket_sendfile 已在该库中定义。

另外：标准的 html 页面可以正常工作吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-11T03:32:20.403

听起来像：

1.  路径中第一个出现的 httpd 不是 /usr/sbin/httpd，它的构建很奇怪，或者

2.  您安装的东西覆盖了 httpd 或 libapr。

你的 httpd 和 libapr 的 MD5 是多少？我得到：

```
$ openssl md5 /usr/sbin/httpd /usr/lib/libapr-1.0.dylib 
MD5(/usr/sbin/httpd)= d5194790e9cfaca881d0e8fc3db24889
MD5(/usr/lib/libapr-1.0.dylib)= f1f5ece10140a5c2cea2fece7a9e4918 
```

# html - 用于识别布局结构元素的标题标签？

> ID：573074
> 
> 赞同：0
> 
> 时间：2009-02-21T14:08:16.483
> 
> 标签：html, accessibility

我正在尝试对我的网页应用更好的语义和可访问性。

我最近为 Firefox 安装了 Fangs 插件，以查看它们在屏幕阅读器中的外观。我担心我的所有侧边栏和页脚信息如何显示在我最后一个内容标题的下方。

**问题 #1**

我希望能够通过使用标题标签（`<h1>`,`<h2>`等）来指定“侧边栏”和“页脚”部分来将其分解。*我不确定这是否是标题标签的正确用法。*虽然这些部分在技术上是内容，但在与文章标题相同的层次结构级别上看到它们感觉有点奇怪。

**问题 #2**

*我还想保留这些用于标识布局结构元素的标题标签不可见，但仍然可供需要它的人使用。*使用“可见性：隐藏”会留下不需要的占位符。使用“显示：无”似乎可以产生预期的效果，但我看到一些帖子表明它可能不适用于实际的屏幕阅读器。我现在很想使用“位置：绝对”和否定的“文本缩进”技巧来打破元素的正常流程并将其推到屏幕外。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T14:14:38.403

我已经看到许多网站使用`<h3>`在侧边栏和页脚中使用的标签。因此，您也可以遵循相同的方法。和标签通常在网页中只使用一次`<h1>`。标题和标语。`<h2>``<h1>``<h2>`

好吧.. 对于第二个问题，您可以使用 JavaScript 来切换`display`属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T17:01:43.780

这些是我到目前为止的笔记。

一些资源：

*   [HTML 文档的全局结构 | W3C](http://www.w3.org/TR/html401/struct/global.html#h-7.5.5)
*   [使用h1-h6识别标题| WCAG 2.0](http://www.w3.org/TR/WCAG20-TECHS/H42.html)
*   [使用 CSS 隐藏部分链接文本 | WCAG 2.0](http://www.w3.org/TR/WCAG20-TECHS/C7.html)
*   [仅适用于屏幕阅读器用户的隐形内容 | 网络目标](http://www.webaim.org/techniques/css/invisiblecontent/)
*   [关于被听到但没有被看到 | 访问事项](http://www.access-matters.com/2005/04/03/quiz-241-on-being-heard-but-not-seen/)
*   [屏幕阅读器可见性 | CSS-讨论](http://css-discuss.incutio.com/?page=ScreenreaderVisibility)
*   [屏幕阅读器测试结果 | 访问事项](http://www.access-matters.com/screen-reader-test-results/)

野外的一些例子：

**w3.org/WAI/** (h3.no-display)

```
position: absolute;
left: -999px;
width: 990px; 
```

**diveintoaccessibility.org** (h2.invisibletitle)

```
display: none; 
```

**标准**-schmandards.com (h1)

```
position: absolute;
left: -1000em;
margin-left: -1000em;
display: block;
height: 0;
overflow: hidden; 
```

**yahoo.com** (h3.a11y)

```
position: absolute;
left: -5000px;
width: 100px; 
```

**my.yahoo.com** (h3.a11y)

```
position: absolute;
height: 0;
overflow: hidden; 
```

**gmail.com** (h2.u4w5cc)

```
position: absolute;
height: 9px;
left: 0;
top: -10000px; 
```

**target.com** (h1.offscreen)

```
position: absolute;
left: -99em;
width: 90em;
overflow: hidden; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T17:07:00.133

您可以使用该`hr`元素来分隔各个部分，例如：

```
<div id="header"></div>
<hr />
<div id="content"></div>
<hr />
<div id="sidebar"></div>
<hr />
<div id="footer"></div> 
```

此外，您可以使用元素`title`上的属性`hr`来描述以下部分。但我不知道这是如何支持的。

# c# - 什么是公钥令牌，它是如何在程序集强名称中计算的？

> ID：573079
> 
> 赞同：24
> 
> 时间：2009-02-21T14:09:32.253
> 
> 标签：c#, publickeytoken

什么是“公钥令牌”，它是如何在程序集强名称中计算的？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-21T14:49:53.577

关于您的问题，“它是如何计算的”，它是一个 SHA1 哈希。

来自[点网博客](http://ashishcodes.blogspot.com/2004/09/public-keys-and-public-key-tokens.html)：

> Microsoft 通过使用强命名程序集的公钥的哈希来解决“公钥膨胀”问题。这些散列称为公钥标记，是强命名程序集公钥的 SHA1 散列的低 8 个字节。SHA1 哈希是 160 位（20 字节）的哈希，哈希的前 12 个字节在此算法中被简单地丢弃。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-03-08T13:39:53.373

您可以通过键入以下内容从 VS 命令行获取 PublicKeyToken：

```
sn –T DLLName.dll 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-05-03T03:11:09.720

如果您需要基于完整的公钥生成公钥令牌，这个小静态方法可以工作：

```
 private static byte[] GetKeyTokenFromFullKey(byte[] fullKey)
    {
        SHA1CryptoServiceProvider csp = new SHA1CryptoServiceProvider();
        byte[] hash = csp.ComputeHash(fullKey);
        byte[] token = new byte[8];
        for (int i = 0; i < 8; i++ )
            token[i] = hash[hash.Length - (i+1)];

        return token;
    } 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-21T14:51:12.323

来自 ECMA-335：

> 此声明用于在程序集引用中存储发起者公钥的 SHA-1 哈希的低 8 字节，而不是完整的公钥。
> 程序集引用可以存储完整的公钥或 8 字节的“公钥令牌”。两者都可用于验证用于在编译时对程序集进行签名的同一私钥是否也对在运行时使用的程序集进行了签名。两者都不需要存在，虽然两者都可以存储，但这没有用。
> 
> [基本原理：存储在程序集引用中的公钥或公钥令牌用于确保被引用的程序集和运行时实际使用的程序集是由拥有相同私钥的实体生成的，因此可以假设旨在用于相同目的。虽然完整的公钥在密码学上更安全，但它需要更多的参考存储空间。公钥令牌的使用减少了存储引用所需的空间，同时仅略微削弱了验证过程。结束理由]

至于如何计算散列（我假设这可能是您要问的，因为公钥令牌不是“计算”的），来自相同的规范：

> CLI 元数据允许程序集的生产者计算该程序集的加密哈希（使用 SHA-1 哈希函数），然后使用 RSA 算法（参见第 I 部分）和生产者的公钥/私钥对对其进行加密。选择。然后可以将其结果（“SHA-1/RSA 数字签名”）与 RSA 算法所需的密钥对的公共部分一起存储在元数据（第 25.3.3 节）中。.publickey 指令用于指定用于计算签名的公钥。为了计算哈希，签名归零，计算哈希，然后将结果存储到签名中。
> 
> 强名称 (SN) 签名过程使用标准哈希和密码算法进行强名称签名。生成大部分 PE 文件的 SHA-1 散列。该哈希值是使用 SN 私钥进行 RSA 签名的。出于验证目的，公钥与签名的哈希值一样存储在 PE 文件中。
> 除以下内容外，PE 文件的所有部分都经过哈希处理： • 验证码签名条目：PE 文件可以进行验证码签名。验证码签名包含在 PE 头数据目录（第 25.2.3.3 节中的“证书表”）偏移量 128 处的 8 字节条目中，以及该目录条目指定范围内的 PE 文件的内容。[注意：在符合标准的 PE 文件中，该条目应为零。end note] • 强名称 Blob：CLI 标头偏移 32 处的 8 字节条目（第 25.3.3 节中的“StrongNameSignature”）和 PE 文件中此 RVA 中包含的散列数据的内容。如果 8 字节条目为 0，则没有关联的强名称签名。• PE 头校验和：PE 头 Windows NT 特定字段偏移 64 处的 4 字节条目（第 25.2.3.2 节中的“文件校验和”）。[笔记：在符合标准的 PE 文件中，该条目应为零。尾注]

您可以在此处免费下载规范：http: [//www.ecma-international.org/publications/standards/Ecma-335.htm](http://www.ecma-international.org/publications/standards/Ecma-335.htm)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-21T14:37:21.453

公钥令牌用于标识强命名程序集中的组织。此信息将添加到程序集元数据库中。我会假设理查德对它的存储技术方式是正确的。

如果要查看程序集的元数据库，请使用 ILDASM。除了查看 IL 之外，您还可以深入了解元数据库中存储的内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-21T14:12:51.527

它是用于签署程序集的密钥的哈希字节。

因此，与其列出密钥的数百个十六进制数字，您还可以拥有更简单的东西，但碰撞风险仍然很小。

# c# - 如何计算弹跳角度？

> ID：573084
> 
> 赞同：66
> 
> 时间：2009-02-21T14:11:36.710
> 
> 标签：c#, xna, physics

我玩了一段时间，但我根本无法弄清楚。

我做了一个发射导弹的坦克，当导弹击中墙壁时，我希望它们反弹，但我希望它们反弹到正确的角度。

现在我没有任何障碍物，导弹在`viewportRectangle`我制造的外面时会反弹。

我正在寻找的解决方案是否非常先进？

有没有相对简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：199
> 
> 时间：2009-02-21T15:17:49.797

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2009-02-21T14:25:09.813

我认为更简单的方法是使用导弹的速度而不是计算角度。假设你有一个导弹，它具有`xVelocity`并`yVelocity`代表它的水平和垂直运动。这些速度可以是正的或负的，以表示左、右、上或下。

*   如果导弹击中顶部或底部边界，则反转`yVelocity`.
*   如果导弹击中左边界或右边界，则反转符号`xVelocity`。

这将保持相反轴上的运动相同。

借用[ChrisF 的回答](https://stackoverflow.com/questions/573084/how-to-calculate-bounce-angle/573100#573100)中的图像，假设导弹从位置 I 开始。

![反射角](https://upload.wikimedia.org/wikipedia/commons/2/24/Angle_of_Reflection_(PSF).png)

和都为正（在二维图形中`xVelocity`，`yVelocity`右和下通常为正），导弹将沿指示的方向行进。让我们分配值

```
xVelocity = 3
yVelocity = 4 
```

**当导弹在位置C**撞到墙上时，它`xVelocity`不应该改变，但它`yVelocity`应该被反转到 -4 以便它在向上的方向上返回，但继续向右移动。

这种方法的好处是您只需要跟踪导弹的`xPosition`、`yPosition`、`xVelocity`和`yVelocity`。仅使用这四个组件和游戏的更新率，导弹将始终在正确的位置重新绘制。一旦您遇到更复杂的障碍物（不是直角或移动），使用 X 和 Y 速度比使用角度要容易得多。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-21T14:18:12.637

对于完美粒子（和光），反射角等于入射角，如图所示（来自 commons.wikimedia.org）。

![反射角](https://upload.wikimedia.org/wikipedia/commons/2/24/Angle_of_Reflection_(PSF).png)

关于反射的[维基百科页面](https://en.wikipedia.org/wiki/Reflection_(physics))非常擅长解释它是如何工作的。

当您考虑到物体的弹性和材料以及障碍物时，它会稍微复杂一些，但这对于大多数应用程序来说可能已经足够了。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-21T15:51:55.080

除了您要问的具体物理问题，我会推荐 Wendy Stahler 的《游戏程序员的数学和物理入门》一书。我发现它对我的游戏/物理编程项目非常有用。

本书随附的代码是 C++，但如果您了解 C#，则很容易进行转换。

祝你有个好的一天！

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-06-18T01:43:51.707

我遇到了这个问题，我发现的唯一方法是分离碰撞轴！

尝试一下：

```
x += velocity * Math.cos(angle * Math.PI /180);
y += velocity * Math.sin(angle * Math.PI /180);

if (x < 0 || x > canvas.width) {
     angle = 180 - angle;   
}
else if (y < 0 ||y > canvas.height) {
     angle = 360 - angle; 
} 
```

我希望这可以帮助你！

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-21T14:27:37.687

180-a 并非在所有情况下都有效，除非您只是在 X 增加时在顶部表面上进行反弹。

一个方向是 XNA 论坛或获取 XNA 示例代码。它是 C#，用于构建游戏。我并不是说你想在 XNA 中构建你的游戏，但它是一个很棒的工具，而且它是免费的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-21T14:14:08.827

一点也不复杂——伪代码：

```
angleObjectHitWall = a;
bounceAngle = 180-a; 
```

当然，这是一个非常简单的计算，一旦你开始考虑材料、重力、不直的墙壁等因素，就完全无关紧要了……

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-21T14:45:10.687

这确实是一个物理问题，所以如果你不是物理学家（既然你问这个问题，我会认为你不是）它需要大量的阅读和头脑风暴才能得到正确的答案。

我建议阅读[此](http://en.wikipedia.org/wiki/Collision)维基百科条目，以了解有关您问题深度的基本概念。

如果您只想让它“看起来合理”，那么我不会太担心它并使用*蜥蜴比尔的*答案，但是如果您想让它正确，您将有相当大的冒险。不要让这吓到你！祝你好运！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-10-19T04:37:00.420

`a = 2w - b`

其中：
a => 合成角度
w => 墙壁或地板或天花板角度
b => 球角度

这就是我在尝试找到最简单的公式来计算球在墙壁、天花板和地板上反弹的角度后得出的结论。结果可能超出 +360 或 -360 度，但它们仍然是等效角度。

例如，如果天花板角度为 270 度，球角度为 30 度，则所得角度为 510 度，相当于 +150 度或 -210 度。如果您将天花板使用 90 度而不是 270 度，则结果仍然是 150 度。

* * *

## 回答 #10

> 赞同：-5
> 
> 时间：2015-07-08T21:18:23.323

```
if(!Collide(Missle, Mainchar)){
(Velocity.x)*-1;
(Velocity.y)*-1;
} 
```

它有效并且很简单，祝你好运。

# c# - 如何仅在需要时提升权限？

> ID：573086
> 
> 赞同：85
> 
> 时间：2009-02-21T14:13:34.147
> 
> 标签：c#, .net, windows-vista, uac, privileges

这个问题适用于Windows Vista！

我有一个通常在没有管理权限的情况下工作的应用程序。有一项活动确实需要管理权限，但是当我知道大多数时候用户甚至不会使用该功能时，我不想以更高的权限启动应用程序本身。

我正在考虑某种方法，通过该方法我可以在某些事件（例如按下按钮）上提升应用程序的权限。例子：

![](https://i.stack.imgur.com/7wMTs.jpg)

如果用户单击此按钮，则会提示他使用 UAC 对话框或同意。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-02-21T14:50:53.963

我不相信有可能提升当前正在运行的进程。据我了解，它内置于 Windows Vista 中，在启动时授予进程管理员权限。如果您查看使用 UAC 的各种程序，您应该看到它们实际上在每次需要执行管理操作时启动一个单独的进程（任务管理器是一个，Paint.NET 是另一个，后者实际上是一个 .NET 应用程序）。

此问题的典型解决方案是在启动提升的进程时指定命令行参数（abatishchev 的建议是这样做的一种方法），以便启动的进程只知道显示某个对话框，然后在执行此操作后退出完全的。因此，用户几乎不会注意到一个新进程已经启动然后退出，并且宁愿看起来好像同一个应用程序中的一个新对话框已经打开（特别是如果你有一些黑客来制作主窗口的主窗口）提升的进程是父进程的子进程）。如果您不需要 UI 来进行提升访问，那就更好了。

有关 Vista 上 UAC 的完整讨论，我建议您[通过](http://weblogs.asp.net/kennykerr/archive/2006/09/29/Windows-Vista-for-Developers-_1320_-Part-4-_1320_-User-Account-Control.aspx)有关该主题的文章（代码示例使用 C++，但我怀疑您需要使用 WinAPI 和 P/Invoke 来完成 C# 中的大部分操作）反正）。希望您现在至少看到了正确的方法，尽管设计一个符合 UAC 的程序远非微不足道......

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-21T14:23:05.090

正如那里[所说](https://stackoverflow.com/questions/562350/requested-registry-access-is-not-allowed-under-windows-7/562389#562389)：

```
Process.StartInfo.UseShellExecute = true;
Process.StartInfo.Verb = "runas"; 
```

将以管理员身份运行该过程以对注册表执行您需要的任何操作，但以正常权限返回您的应用程序。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-10-24T14:16:35.683

以下 MSDN 知识库文章 981778 描述了如何“自我提升”应用程序：

[http://support.microsoft.com/kb/981778](https://web.archive.org/web/20101206083232/http://support.microsoft.com/kb/981778)

它包含 Visual C++、Visual C#、Visual Basic.NET 中的可下载示例。

这种方法绕过了启动单独进程的需要，但实际上它是重新启动的原始应用程序，以提升的用户身份运行。尽管如此，在某些无法在单独的可执行文件中复制代码的情况下，这可能仍然非常有用。

要移除海拔高度，您需要退出应用程序。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-21T14:16:25.420

您需要一个 UAC 名字对象和作为 COM 对象运行提升的代码。

[看到这个问题。](https://stackoverflow.com/questions/127042/how-to-uac-elevate-a-com-component-with-net)

[MSDN 上的文档。](http://msdn.microsoft.com/en-us/library/ms679687.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-03-05T16:39:10.510

也许有人会派上用场这个简单的例子：

```
using System;
using System.Linq;
using System.Reflection;
using System.Diagnostics;
using System.Security.Principal;
using System.Windows.Forms;

namespace WindowsFormsApp1
{
    internal static class Program
    {
        private class Form1 : Form
        {
            internal Form1()
            {
                var button = new Button{ Dock = DockStyle.Fill };
                button.Click += (sender, args) => RunAsAdmin();
                Controls.Add(button);

                ElevatedAction();
            }
        }

        [STAThread]
        internal static void Main(string[] arguments)
        {
            if (arguments?.Contains("/run_elevated_action") == true)
            {
                ElevatedAction();
                return;
            }

            Application.Run(new Form1());
        }

        private static void RunAsAdmin()
        {
            var path = Assembly.GetExecutingAssembly().Location;
            using (var process = Process.Start(new ProcessStartInfo(path, "/run_elevated_action")
            {
                Verb = "runas"
            }))
            {
                process?.WaitForExit();
            }
        }

        private static void ElevatedAction()
        {
            MessageBox.Show($@"IsElevated: {IsElevated()}");
        }

        private static bool IsElevated()
        {
            using (var identity = WindowsIdentity.GetCurrent())
            {
                var principal = new WindowsPrincipal(identity);

                return principal.IsInRole(WindowsBuiltInRole.Administrator);
            }
        }

    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-16T19:46:35.983

我知道这是一篇旧帖子，但这是对遇到 MarcP 建议的任何其他人的回应。他引用的 msdn 帖子确实重新启动了所有代码示例中的应用程序。代码示例使用`runas`其他建议中已经提出的动词。

我下载了代码以确保，但这是来自原始 msdn 文章：

> 4\. 单击“是”批准提升。然后，原始应用程序重新启动，以提升的管理员身份运行。
> 5\. 关闭应用程序。

# c# - 将 *.exe 嵌入到 dll 中

> ID：573105
> 
> 赞同：7
> 
> 时间：2009-02-21T14:22:27.603
> 
> 标签：c#, dll, exe

有人知道如何将 exe 文件嵌入到 dll 中吗？

我有一个工具，它是我从 c# 代码调用的 exe 文件。

问题是我想要 1 个包含此工具（exe 文件）的 dll 和包含我的 c# 代码的 dll。

是否可以将此 exe 文件嵌入资源中？

提前谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-21T14:28:19.523

是的。您可以在应用程序中将任何文件添加为 RC_DATA 作为资源。但我相信在调用它之前你需要先将它解压到磁盘上！

您正在使用哪种 IDE/语言？

[编辑]

对不起！你确实提到你正在使用 C#。

1.  将资源文件添加到您的应用程序（在 IDE 中右键单击应用程序并选择“添加新项目”。
2.  使用资源编辑器中的工具栏添加现有文件。
3.  然后在需要时通过调用类似以下的代码来提取 exe： System.IO.File.WriteAllBytes (@"C:\MyEXE\", Resource1.MyEXE);

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-21T14:35:51.487

值得一提的是，您的用户可能对您这样做不太满意。将他们无法控制的可执行文件嵌入到您将提取并运行的 DLL 中可能会让人们担心在他们的机器上运行木马。

最好将 .EXE 留在文件系统中，并对应用程序的操作保持透明。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-21T15:08:07.150

您可以从 byte[] 加载程序集。这可以通过嵌入资源的 ManifestResourceStream 获得。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T16:21:23.307

另一种方法可能是不嵌入 .exe 本身，而是将其功能包含在 dll 中，并使用 rundll32[ [1](http://support.microsoft.com/kb/164787) ] 来执行它。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-23T16:57:27.310

附带说明一下，请记住，当您将文件从资源中拉到磁盘然后在其上执行代码时，您可能会触发 Windows[数据执行保护](http://support.microsoft.com/kb/875352)- 基本上，Windows 会尝试自动检测是否应该是代码或数据，并且如果它看起来像数据（资源会这样），那么它将阻止该数据作为代码执行。

如果您的 .NET 程序集要通过网络而不是本地驱动器使用，这将成为一个特别棘手的问题 - 有各种 .NET 安全配置可能会阻止它正常工作。

另一种选择，并且不知道您的项目的详细信息，对此持保留态度：在您的安装中添加一个 .exe.readme 文件，该文件向任何好奇的用户或 IT 人员描述为什么会有他们没想到的可执行文件安装目录:)

# debugging - 你最喜欢的反调试技巧是什么？

> ID：573115
> 
> 赞同：25
> 
> 时间：2009-02-21T14:28:39.040
> 
> 标签：debugging, assembly, x86, reverse-engineering

在我以前的雇主中，我们使用了一个第三方组件，它基本上只是一个 DLL 和一个头文件。该特定模块在 Win32 中处理打印。但是，制造该组件的公司破产了，所以我无法报告我发现的错误。

所以我决定自己修复错误并启动调试器。我很惊讶地发现反调试代码几乎无处不在，通常`IsDebuggerPresent`是这样，但引起我注意的是：

```
 ; some twiddling with xor 
    ; and data, result in eax 
    jmp eax 
    mov eax, 0x310fac09 
    ; rest of code here 
```

乍一看，我只是跳过了被调用两次的例程，然后事情就变得一团糟。过了一会儿，我意识到位旋转的结果总是一样的，即 jmp eax 总是直接跳到`mov eax, 0x310fac09`指令中。我剖析了这些字节，它是用于测量 DLL 中一些调用之间所用时间`0f31`的指令。`rdtsc`

所以我的问题是：**你最喜欢的反调试技巧是什么？**

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-21T15:08:01.723

我最喜欢的技巧是为一个不起眼的微处理器编写一个简单的指令仿真器。

然后将为微处理器编译复制保护和一些核心功能（GCC 在这里很有帮助）并作为二进制 blob 链接到程序中。

这背后的想法是，普通 x86 代码中不存在复制保护，因此无法反汇编。您也不能删除整个模拟器，因为这会从程序中删除核心功能。

破解程序的唯一机会是对微处理器仿真器的功能进行逆向工程。

我使用 MIPS32 进行仿真，因为它很容易仿真（只需要 500 行简单的 C 代码）。为了让事情变得更加模糊，我没有使用原始的 MIPS32 操作码。相反，每个操作码都与它自己的地址进行异或。

复制保护的二进制文件看起来像垃圾数据。

强烈推荐！花了 6 个多月的时间才出现破解（这是为了一个游戏项目）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-21T14:46:18.233

我一直是许多 RCE 社区的成员，并且在黑客和破解方面有过相当的份额。从那时起，我就意识到这种脆弱的技巧通常是不稳定的，而且是徒劳的。大多数通用的反调试技巧都是特定于操作系统的，根本不是“可移植的”。

在上述示例中，您可能正在使用内联汇编和`naked`函数`__declspec`，在 x64 架构上编译时，MSVC 不支持这两者。当然仍然有实现上述技巧的方法，但是任何已经反转足够长的时间的人都可以在几分钟内发现并击败该技巧。

所以一般来说，我建议不要在利用`IsDebuggerPresent`API 进行检测之外使用反调试技巧。相反，我建议您编写存根和/或虚拟机。我编写了自己的虚拟机，并且多年来一直在改进它，老实说，这是迄今为止我在保护我的代码方面做出的最好的决定。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-21T16:50:20.197

分拆作为调试器附加到父进程的子进程并修改关键变量。保持子进程驻留并使用调试器内存操作作为某些关键操作的一种 IPC 的奖励积分。

在我的系统上，您不能将两个调试器附加到同一个进程。

关于这一点的好处是，除非他们试图篡改任何东西，否则不会破坏任何东西。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-02-28T18:39:06.780

引用未初始化的内存！（和其他黑魔法/伏都教......）

这是一个非常酷的读物： [http ://spareclockcycles.org/2012/02/14/stack-necromancy-defeating-debuggers-by-raising-the-dead/](http://spareclockcycles.org/2012/02/14/stack-necromancy-defeating-debuggers-by-raising-the-dead/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-21T15:21:21.597

最现代的混淆方法似乎是虚拟机。

基本上，您获取目标代码的一部分，并将其转换为您自己的字节码格式。然后添加一个小型虚拟机来运行此代码。正确调试此代码的唯一方法是为您的 VM 指令格式编写模拟器或反汇编程序。当然你也需要考虑性能。过多的字节码会使您的程序运行得比本机代码慢。

大多数旧技巧现在都没用了：

*   Isdebuggerpresent ：非常蹩脚且易于修补
*   其他调试器/断点检测
*   Ring0 的东西：用户不喜欢安装驱动程序，你实际上可能会破坏他们系统上的某些东西等。
*   每个人都知道的其他琐碎的东西，或者使您的软件不稳定的东西。请记住，即使破解使您的程序不稳定但它仍然有效，这种不稳定将归咎于您。

如果您真的想自己编写 VM 解决方案（有很好的程序出售），请不要只使用一种指令格式。使其具有多态性，这样您就可以使代码的不同部分具有不同的格式。这样一来，您的所有代码都无法通过仅编写一个仿真器/反汇编器来破坏。例如，一些人提供的 MIPS 解决方案似乎很容易被破坏，因为 MIPS 指令格式有据可查，并且像 IDA 这样的分析工具已经可以反汇编代码。

[IDA pro反汇编器支持的指令格式列表](http://www.hex-rays.com/idapro/idaproc.htm "IDA pro反汇编器支持的指令格式列表")

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-21T16:32:11.583

我更希望人们编写可靠、可靠并能按照广告宣传的方式编写软件。他们还以合理的价格和合理的许可证出售它。

我知道我已经浪费了太多时间与那些拥有复杂许可方案的供应商打交道，这些方案只会给客户和供应商带来问题。我始终建议避免使用这些供应商。在核电站工作，我们被迫使用某些供应商的产品，因此不得不处理他们的许可计划。我希望有一种方法可以找回我个人浪费的时间来处理他们为我们提供工作许可产品的失败尝试。这似乎是一件小事，但对于那些为了自己的利益而变得过于棘手的人来说，这似乎是一件困难的事情。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-21T15:01:54.343

我支持虚拟机建议。我实现了一个 MIPS I 模拟器，它（现在）可以执行使用 mipsel-elf-gcc 生成的二进制文件。添加到代码/数据加密功能（AES 或您选择的任何其他算法）、自我模拟能力（因此您可以拥有嵌套模拟器）并且您拥有一个非常好的代码混淆器。

选择 MIPS I 的好处是 1) 它易于实现，2) 我可以用 C 编写代码，在我的桌面上调试它，并在完成后将它交叉编译为 MIPS。无需调试自定义操作码或为自定义 VM 手动编写代码。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-03-09T07:21:45.750

我个人最喜欢的是 Amiga，它有一个协处理器（*Blitter*），独立于处理器进行大数据传输；该芯片将被指示清除所有内存，并从定时器 IRQ 复位。

当您连接 Action Replay 磁带时，停止 CPU 将意味着 Blitter 将继续清除内存。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-21T16:13:50.083

我最喜欢在看起来合法但真正隐藏实际指令指令的中间计算跳转。无论如何，它们很容易被人类检测到，但自动化工具经常把它搞砸。

替换堆栈上的返回地址也很浪费时间。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-21T14:33:15.330

使用[nop](http://en.wikipedia.org/wiki/NOP)通过调试器删除程序集是一个有用的技巧。当然，放回代码要困难得多！！！

# ruby - 使用 Ruby RIO gem 下载图像

> ID：573116
> 
> 赞同：2
> 
> 时间：2009-02-21T14:29:17.120
> 
> 标签：ruby, download, io

我的代码：

```
require 'rio'
rio('nice.jpg') < rio('http://farm4.static.flickr.com/3134/3160515898_59354c9733.jpg?v=0') 
```

但是下载的图像已损坏。这个解决方案有什么问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T19:24:02.980

pjb3 是正确的。您必须在左侧术语上调用[binmode ：](http://rio.rubyforge.org/classes/RIO/IF/RubyIO.html#M000008)

```
rio('nice.jpg').binmode < rio('http://...') 
```

如果这仍然不起作用（尤其是大型 jpeg 文件可能会发生这种情况，即 rio 在从您提供的 URL 检索时使用中间临时文件），则将`binmode`修饰符应用于这两个术语：

```
rio('nice.jpg').binmode < rio('http://...').binmode 
```

* * *

## 2011 更新

根据 Luke C. 的说法，上述答案不再适用于 gem 的更新版本：

> 这些都不起作用。在 Linux 上，在目标上设置了 .binmode 会导致 Errno::ENOENT 异常。做： rio('nice.jpg') < rio('http://...').binmode 有效

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T14:59:39.543

这个对我有用。你在窗户上吗？这可能是因为没有使用二进制标志打开文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-01T19:21:54.603

我在 Linux 上下载图像时遇到了类似的问题，我发现这对我有用：

rio(source_url).binmode > rio(文件名)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-11T09:31:24.067

这是一些用于下载图像的简单 ruby​​ 代码

```
require 'net/http'
url = URI.parse("http://www.somedomain.com/image.jpg")
Net::HTTP.start(url.host, url.port) do |http|
  resp, data = http.get(url.path, nil)
  open( File.join(File.dirname(__FILE__), "image.jpg"), "wb" ) { |file| file.write(resp.body) }
end 
```

这甚至可以扩展到跟随重定向：

```
require 'net/http'
url = URI.parse("http://www.somedomain.com/image.jpg")
Net::HTTP.start(url.host, url.port) do |http|
  resp, data = http.get(url.path, nil)
  prev_redirect = ''
  while resp.header['location']
    raise "Recursive redirect: #{resp.header['location']}" if prev_redirect == resp.header['location']
    prev_redirect = resp.header['location']
    url = URI.parse(resp.header['location'])
    host = url.host if url.host
    port = url.port if url.port
    http = Net::HTTP.new(host, port)
    resp, data = http.get(url.path, nil)
  end
  open( File.join(File.dirname(__FILE__), "image.jpg"), "wb" ) { |file| file.write(resp.body) }
end 
```

它可能会被美化一些，但它可以完成工作，并且不依赖于任何第 3 方宝石！:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-07T00:03:39.473

我想这是一个错误。在 Windows 上，所有 0x0A 都替换为 0x0D 0x0A。因此，在 Linux 上正确使用（使用 .binmode）是有道理的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-26T08:11:37.803

要从网页下载图片，可以使用 ruby​​ gem`image_downloader`

# ruby - Ruby 编程控制和元组合

> ID：573117
> 
> 赞同：2
> 
> 时间：2009-02-21T14:29:59.927
> 
> 标签：ruby, programming-languages

Ruby 编程控制和元组合用于什么？

```
?a                        # character code
?\n                       # code for a newline (0x0a)

?\C-a                     # control a = ?A & 0x9f = 0x01
?\M-a                     # meta sets bit 7
?\M-\C-a                  # meta and control a
?\C-?                     # delete character 
```

我在阅读 Ruby Pickaxe 书时遇到了这个术语，我不确定 meta 或 control 到底是做什么的，我认为它的作用类似于 C 的位移运算符 (<< >>) 但我不确定，所以决定确认。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T14:36:49.427

它们仅用于字符串中的数据，它们不会影响任何实际的 Ruby 代码本身。将它们视为“\n”和“\e”等不可打印字符的简写。

我能想到的一种情况是，如果您正在与类似 telnet 的终端交谈。在这种情况下，发送“?\C-?” 如果您直接连接到终端，则连接就像按键盘上的删除键一样。

```
telnet_socket << "?\C-?" #Write delete character to socket 
```

除非您正在处理类似终端或非常深奥的系统，否则我怀疑您永远不会使用它们。

# architecture - 为多个用户存储图像

> ID：573119
> 
> 赞同：2
> 
> 时间：2009-02-21T14:30:45.617
> 
> 标签：architecture, web-applications, image, storage

平台并不像理论那么重要。作为记录，它是 ASP.NET（3.5 SP1 上的 C#）、SQL Server 2005。为了论证，我有无限的空间（文件系统和数据库）和无限的带宽。

我正在开发一个项目，该项目将允许多个用户上传他们自己的图像，这些图像可以由该用户管理并由所有用户查看。我正在尝试确定最好的存储机制是什么。我的想法是，我希望避免将它们直接存储在数据库中，尽管我可以看到存储有关图像的信息。

我看到的是用户会上传图片。服务器将为图像创建一个唯一的名称，将其存储到文件系统中，并将有关该图像的关系数据存储在数据库中（即，当它被上传时，与用户的关联，对标题的引用等）。将这些存储在磁盘上是未来能够迁移到 CDN 的一步。

有没有人使用过这样的方法或可以推荐不同的方法？是否应该有某种文件夹结构，例如每个用户的文件夹以帮助文件访问时间？

对于任何反馈，我们都表示感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T18:44:51.157

我同意将图像/文件存储在文件系统而不是数据库上是一种好方法。

关于文件访问时间，如果目录包含大量文件，您可能需要检查您使用的文件系统的行为方式。如果这是一个巨大的列表，一些文件系统可能会降低性能。如果是这样，您可能想要创建一些文件夹结构，例如从 00 到 FF，这可能取决于您期望的文件数量在几个级别上。然后，您可以例如使用某个字段（如文件名）的 MD5 哈希将其排序到正确的目录中（例如，哈希 FABE063E... 进入 FA/BE/文件名）。

如果您不希望文件名被猜测以限制访问，您还可以使用一些哈希甚至随机字符串作为文件名。这样，只有知道文件名的用户（例如，通过您提供指向它的链接）才能访问该文件。如果您想移动到最终无法自己检查权限的 CDN，这可能也很重要。

（如果权限不重要并且 OTOH 想要可猜测的文件名，那么您显然会采用另一种方式，可能将用户名用作文件夹结构等。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T14:41:44.203

我认为您应该考虑引用 PresentationBase.dll，它可以让您访问由 Windows Presentation Foundation 包装的 Windows 映像组件 (WIC)。即使这是一个 ASP.NET 项目，您也可以依赖这些类进行图像编码和解码。这些类具有二进制数据或流的价值，可以对几种流行的图像格式进行解码和编码，并通过不同的解码和编码、高度和宽度在高分辨率存储中即时生成缩略图。

这些类位于 System.Windows.Media.Imaging 命名空间中，并派生自 BitmapEncoder 或 BitmapDecoder。如果您使用这些类，还可以从其他几个第三方实现中受益。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T14:44:59.110

我认为就推荐的做法而言，您已经走在正确的轨道上：将**有关**上传文件的数据存储在数据库中，例如文件系统位置、文件名、属性、标题等，但将实际文件存储在指定的指定文件夹中明确为此目的。

此方法还允许您检查上传文件的格式限制，并在完成上传过程之前对其进行病毒扫描。

绝对不建议在数据库中存储图像等二进制内容，这种观点似乎很普遍。

# php - 如何实现gmail登录？

> ID：573121
> 
> 赞同：3
> 
> 时间：2009-02-21T14:31:04.727
> 
> 标签：php, authentication

如何使用 gmail、yahoo 或 facebook ID（不是 OpenID 登录）实现站点身份验证？

PS：使用PHP。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T14:39:59.183

Google 提供了两个用于登录的 API： [http://code.google.com/apis/accounts/docs/AuthSub.html](http://code.google.com/apis/accounts/docs/AuthSub.html) [http://code.google.com/apis/accounts/docs/OAuth.html](http://code.google.com/apis/accounts/docs/OAuth.html)

**编辑为 AuthSub 于 2012 年 4 月 20 日正式弃用，并将于 2015 年 4 月 20 日关闭。**

您可以使用新的 API .. [https://developers.google.com/accounts/docs/OAuth2](https://developers.google.com/accounts/docs/OAuth2)

雅虎还提供了另一个：http: [//developer.yahoo.com/auth/](http://developer.yahoo.com/auth/)

# c# - dasBlog 并使用 C# 作为标签云的类别

> ID：573136
> 
> 赞同：0
> 
> 时间：2009-02-21T14:41:50.367
> 
> 标签：c#

我正在为我的博客使用 dasBlog，我拥有的类别之一是 C#。现在，当我单击此标签时，它会将我带到 /CategoryView.aspx?category=C 从而删除哈希。有谁知道一种快速的方法：

*   修复此问题并将 C# 保留为标记或
*   找到类别的数据存储并更改为“CSharp”

提前致谢

安德鲁

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T16:16:08.813

无法修复 dasBlog 以准确使用“/CategoryView.aspx?category=C#” url，因为 '#' 是链接中的[特殊字符](http://www.w3schools.com/HTMLDOM/prop_loc_hash.asp)。您也可以使用 stackoverflow 的使用方式（使用“c%23”而不是“c#”），但我认为您需要修复 dasBlog 中的一些代码来实现这一点。
您也可以使用[类别重命名器重命名此类别](http://www.vasanth.in/software/renamer-dasblog-category-renamer/)

# c# - C# 文件流 - 构建测验

> ID：573144
> 
> 赞同：3
> 
> 时间：2009-02-21T14:46:39.073
> 
> 标签：c#, csv, text-files

试图使用外部文件（txt 或 CSV）在 C# 中创建文件流。文件中的数据是由以下组成的问答游戏的数据：

1 个简短问题 4 个可能的答案 1 个正确答案

该程序应该能够告诉用户他是否正确回答。

我正在寻找有关如何使用外部文件中的数据在 C# 中创建简单测验的示例代码/算法/教程。此外，关于如何构建 txt 文件的任何建议（我如何将答案标记为正确的？）。有什么建议或链接吗？谢谢，

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-21T15:05:37.297

如果您必须从文件（而不是从数据库）加载数据，我的建议是使用 XML 文件。

使用文本文件需要您非常清楚地定义问题的各个元素的结构。使用 CSV 可能有效，但您必须定义一种在问题或答案本身中转义逗号的方法。这可能会使事情复杂化。

因此，重申一下，恕我直言，XML 是存储此类数据的最佳方式。这是一个简短的示例，展示了您可能使用的可能结构：

```
<?xml version="1.0" encoding="utf-8" ?>
<Test>
  <Problem id="1">
    <Question>Which language am I learning right now?</Question>
    <OptionA>VB 7.0</OptionA>
    <OptionB>J2EE</OptionB>
    <OptionC>French</OptionC>
    <OptionD>C#</OptionD>
    <Answer>OptionA</Answer>
  </Problem>
  <Problem id="2">
    <Question>What does XML stand for?</Question>
    <OptionA>eXtremely Muddy Language</OptionA>
    <OptionB>Xylophone, thy Music Lovely</OptionB>
    <OptionC>eXtensible Markup Language</OptionC>
    <OptionD>eXtra Murky Lungs</OptionD>
    <Answer>OptionC</Answer>
  </Problem>
</Test> 
```

就将 XML 加载到内存而言，.NET 提供了许多处理 XML 文件和字符串的内在方法，其中许多完全混淆了必须直接与 FileStreams 交互。例如，该`XmlDocument.Load(myFileName.xml)`方法将在一行代码中为您内部完成。就个人而言，虽然我更喜欢使用`XmlReader`and `XPathNavigator`。

[查看System.Xml 命名空间](http://msdn.microsoft.com/en-us/library/system.xml(VS.80).aspx)的成员以获取更多信息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-21T15:37:31.260

确实没有固定的方法可以做到这一点，尽管我同意对于一个简单的测验问题数据库，文本文件可能是您的最佳选择（与 XML 或适当的数据库相反，尽管前者不会完全矫枉过正） .

这是一组测验问题的基于文本的格式的一个小示例，以及将问题读入代码的方法。**编辑：**我试图让它尽可能容易地跟随（使用简单的结构），有很多评论！

## 文件格式

示例文件内容。

```
第一个问题的问题文本...
答案 1
答案 2
!答案 3（正确答案）
答案 4

第二个问题的问题文本...
!答案 1（正确答案）
答案 2
答案 3
答案 4

```

## 代码

这只是在代码中存储每个问题的简单结构：

```
struct Question
{
    public string QuestionText; // Actual question text.
    public string[] Choices;    // Array of answers from which user can choose.
    public int Answer;          // Index of correct answer within Choices.
} 
```

然后，您可以使用以下代码从文件中读取问题。除了对象初始化器之外，这里没有什么特别的（基本上这只是允许您在创建对象的同时设置对象的变量/属性）。

```
// Create new list to store all questions.
var questions = new List<Question>();

// Open file containing quiz questions using StreamReader, which allows you to read text from files easily.
using (var quizFileReader = new System.IO.StreamReader("questions.txt"))
{
    string line;
    Question question;

    // Loop through the lines of the file until there are no more (the ReadLine function return null at this point).
    // Note that the ReadLine called here only reads question texts (first line of a question), while other calls to ReadLine read the choices.
    while ((line = quizFileReader.ReadLine()) != null)
    {
        // Skip this loop if the line is empty.
        if (line.Length == 0)
            continue;

        // Create a new question object.
        // The "object initializer" construct is used here by including { } after the constructor to set variables.
        question = new Question()
        {
            // Set the question text to the line just read.
            QuestionText = line,
            // Set the choices to an array containing the next 4 lines read from the file.
            Choices = new string[]
            { 
                quizFileReader.ReadLine(), 
                quizFileReader.ReadLine(),
                quizFileReader.ReadLine(),
                quizFileReader.ReadLine()
            }
        };

        // Initially set the correct answer to -1, which means that no choice marked as correct has yet been found.
        question.Answer = -1;

        // Check each choice to see if it begins with the '!' char (marked as correct).
        for(int i = 0; i < 4; i++)
        {
            if (question.Choices[i].StartsWith("!"))
            {
                // Current choice is marked as correct. Therefore remove the '!' from the start of the text and store the index of this choice as the correct answer.
                question.Choices[i] = question.Choices[i].Substring(1);
                question.Answer = i;
                break; // Stop looking through the choices.
            }
        }

        // Check if none of the choices was marked as correct. If this is the case, we throw an exception and then stop processing.
        // Note: this is only basic error handling (not very robust) which you may want to later improve.
        if (question.Answer == -1)
        {
            throw new InvalidOperationException(
                "No correct answer was specified for the following question.\r\n\r\n" + question.QuestionText);
        }

        // Finally, add the question to the complete list of questions.
        questions.Add(question);
    }
} 
```

当然，这段代码相当快速和基本（当然需要一些更好的错误处理），但它至少应该说明一个您可能想要使用的简单方法。我确实认为文本文件将是实现诸如此类的简单系统的好方法，因为它们具有人类可读性（在这种情况下 XML 会有点过于冗长，IMO），而且它们与 XML 一样易于解析文件。希望这能让你开始......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-21T14:53:24.377

一个很好的起点是[Microsoft 关于 FileStream 的文档](http://msdn.microsoft.com/en-us/library/system.io.filestream.aspx)。

一个快速的谷歌搜索会给你几乎你需要的一切。这是[一个关于在 C# 中读取和写入文件的教程](http://www.devhood.com/Tutorials/tutorial_details.aspx?tutorial_id=400)。谷歌是你的朋友。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-21T16:25:13.393

> > 关于如何构建 txt 文件的任何建议（我如何将答案标记为正确的答案？）

也许最简单的是使用简单的文本文件格式——每一行都有问题和答案（没有空行）。# 号表示正确答案。

文件格式——

```
问题
＃回答
回答
回答
回答  

```

一个示例文件 -

```
什么是 1 + 1？
#2
9
3
7
谁被埋在格兰特的坟墓里？
埃德
约翰
＃授予
蒂姆

```

> > 我正在寻找有关如何使用外部文件中的数据在 C# 中创建简单测验的示例代码/算法/教程。

下面是一些使用示例文件创建测验的代码。

```
 static void Main(string[] args)
        {
            int correct = 0;
            using (StreamReader sr = new StreamReader("C:\\quiz.txt"))
            {
                while (!sr.EndOfStream)
                {
                    Console.Clear();
                    for (int i = 0; i < 5; i++)
                    {
                        String line = sr.ReadLine();
                        if (i > 0)
                        {                            
                            if (line.Substring(0, 1) == "#") correct = i;
                            Console.WriteLine("{0}: {1}", i, line);
                        }
                        else
                        {
                            Console.WriteLine(line);
                        }
                    }                                       

                    for (; ; )
                    {
                        Console.Write("Select Answer: ");
                        ConsoleKeyInfo cki = Console.ReadKey();
                        if (cki.KeyChar.ToString() == correct.ToString())
                        {
                            Console.WriteLine(" - Correct!");
                            Console.WriteLine("Press any key for next question...");
                            Console.ReadKey();
                            break;
                        }
                        else
                        {
                            Console.WriteLine(" - Try again!");
                        }
                    }
                }
            }
        } 
```

# javascript - 在 JavaScript 中的字符串中获取破折号后的所有内容

> ID：573145
> 
> 赞同：201
> 
> 时间：2009-02-21T14:47:18.793
> 
> 标签：javascript

在 IE 和 Firefox 中都可以使用的最干净的方法是什么？

我的字符串看起来像这样`sometext-20202`

现在`sometext`破折号后面的和整数可以是不同的长度。

我应该只使用`substring`和索引还是有其他方法？

* * *

## 回答 #1

> 赞同：354
> 
> 时间：2009-02-21T16:39:04.687

我将如何做到这一点：

```
// function you can use:
function getSecondPart(str) {
    return str.split('-')[1];
}
// use the function:
alert(getSecondPart("sometext-20202")); 
```

* * *

## 回答 #2

> 赞同：159
> 
> 时间：2016-02-06T03:08:40.207

我更喜欢的解决方案是：

```
const str = 'sometext-20202';
const slug = str.split('-').pop(); 
```

`slug`你的结果在哪里

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2018-03-09T12:04:23.787

```
var testStr = "sometext-20202"
var splitStr = testStr.substring(testStr.indexOf('-') + 1); 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2009-02-21T14:50:32.047

```
var the_string = "sometext-20202";
var parts = the_string.split('-', 2);

// After calling split(), 'parts' is an array with two elements:
// parts[0] is 'sometext'
// parts[1] is '20202'

var the_text = parts[0];
var the_num  = parts[1]; 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-21T14:55:40.987

AFAIK， Mozilla`substring()`和`indexOf()`IE 都支持。但是，请注意，某些浏览器（尤其是 Netscape/Opera）的早期版本可能不支持 substr()。

您的帖子表明您已经知道如何使用`substring()`and `indexOf()`，所以我没有发布代码示例。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2019-09-04T10:03:15.163

通过内置的 javascript`replace()`函数和正则表达式 ( `/(.*)-/`) 的使用，您可以将破折​​号之前的子字符串替换为空字符串 ("")：

```
"sometext-20202".replace(/(.*)-/,""); // result --> "20202" 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2019-08-06T07:31:42.293

```
myString.split('-').splice(1).join('-') 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2020-08-31T00:02:00.303

我提出这个问题是因为我需要 OP 的要求，但比其他答案提供的更多（它们在技术上是正确的，但对于我的目的来说太少了）。我已经制定了自己的解决方案；也许它会帮助别人。

假设您的字符串是`'Version 12.34.56'`. 如果您使用`'.'`拆分，其他答案往往会给您`'56'`，而您真正想要的是`'.34.56'`（即从第*一次*出现而不是最后一次出现的所有内容，但 OP 的特定情况恰好只有一次出现）。也许您甚至可能想要`'Version 12'`.

我还写了这个来处理某些失败（比如如果`null`通过或空字符串等）。在这些情况下，以下函数将返回`false`.

## 采用

```
splitAtSearch('Version 12.34.56', '.') // Returns ['Version 12', '.34.56'] 
```

## 功能

```
/**
 * Splits string based on first result in search
 * @param {string} string - String to split
 * @param {string} search - Characters to split at
 * @return {array|false} - Strings, split at search
 *                        False on blank string or invalid type
 */
function splitAtSearch( string, search ) {
    let isValid = string !== ''              // Disallow Empty
               && typeof string === 'string' // Allow strings
               || typeof string === 'number' // Allow numbers

    if (!isValid) { return false } // Failed
    else          { string += '' } // Ensure string type

    // Search
    let searchIndex = string.indexOf(search)
    let isBlank     = (''+search) === ''
    let isFound     = searchIndex !== -1
    let noSplit     = searchIndex === 0
    let parts       = []

    // Remains whole
    if (!isFound || noSplit || isBlank) {
        parts[0] = string
    }
    // Requires splitting
    else {
        parts[0] = string.substring(0, searchIndex)
        parts[1] = string.substring(searchIndex)
    }

    return parts
} 
```

## 例子

```
splitAtSearch('')                      // false
splitAtSearch(true)                    // false
splitAtSearch(false)                   // false
splitAtSearch(null)                    // false
splitAtSearch(undefined)               // false
splitAtSearch(NaN)                     // ['NaN']
splitAtSearch('foobar', 'ba')          // ['foo', 'bar']
splitAtSearch('foobar', '')            // ['foobar']
splitAtSearch('foobar', 'z')           // ['foobar']
splitAtSearch('foobar', 'foo')         // ['foobar'] not ['', 'foobar']
splitAtSearch('blah bleh bluh', 'bl')  // ['blah bleh bluh']
splitAtSearch('blah bleh bluh', 'ble') // ['blah ', 'bleh bluh']
splitAtSearch('$10.99', '.')           // ['$10', '.99']
splitAtSearch(3.14159, '.')            // ['3', '.14159'] 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-12-23T00:36:15.720

对于那些试图在第一次出现后得到所有东西的人：

`"Nic K Cage"`喜欢的东西`"K Cage"`。

您可以使用`slice`从某个角色中获取所有内容。在这种情况下，从第一个空间：

```
const delim = " "
const name = "Nic K Cage"

const result = name.split(delim).slice(1).join(delim) // prints: "K Cage" 
```

或者如果 OP 的字符串有两个连字符：

```
const text = "sometext-20202-03"
// Option 1
const opt1 = text.slice(text.indexOf('-')).slice(1) // prints: 20202-03
// Option 2
const opt2 = text.split('-').slice(1).join("-")     // prints: 20202-03 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-21T14:51:58.813

使用以下形式的正则表达式：\w-\d+ 其中，\w 代表一个单词，\d 代表一个数字。他们不会开箱即用，所以玩一下。试试[这个](http://www.regular-expressions.info/javascriptexample.html)。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-02-16T09:24:52.853

你可以使用`split`它的方法。如果你应该从特定模式中获取字符串，你可以使用`split`req. 经验：

```
var string = "sometext-20202";
console.log(string.split(/-(.*)/)[1])
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-12-23T00:46:50.683

其他人都发布了一些完全合理的答案。我采取了不同的方向。不使用 split、substring 或 indexOf。在 ie 和 firefox 上效果很好。可能也适用于 Netscape。

只是一个循环和两个ifs。

```
function getAfterDash(str) {
    var dashed = false;
    var result = "";
    for (var i = 0, len = str.length; i < len; i++) {
        if (dashed) {
            result = result + str[i];
        }
        if (str[i] === '-') {
            dashed = true;
        }
    }
    return result;
};

console.log(getAfterDash("adfjkl-o812347")); 
```

我的解决方案是高性能的并且可以处理边缘情况。

* * *

*上述代码的目的是拖延工作，请不要实际使用它。*

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-04-20T19:15:27.117

使用任何分隔符并获取第一部分或第二部分

```
 //To divide string using deimeter - here @
  //str: full string that is to be splitted
  //delimeter: like '-'
  //part number: 0 - for string befor delimiter , 1 - string after delimiter
  getPartString(str, delimter, partNumber) {
    return str.split(delimter)[partNumber];
  } 
```

# c# - 组装版本

> ID：573151
> 
> 赞同：2
> 
> 时间：2009-02-21T14:51:06.413
> 
> 标签：c#, .net

像major.minor.build.revision 这样的程序集版本是什么？这是什么意思？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T14:55:36.260

程序集版本是一种允许您的应用程序向后或向前兼容的方法。

例如：您可以指定您的应用程序需要引用特定版本或更高版本的第三方库（例如 NHibernate）。

您可以通过要求安装特定版本的 .NET Framework 来对 .NET Framework 本身执行相同的操作。

拥有程序集版本还允许您同时在 GAC 中维护程序集的一个或多个副本，让您的程序选择它想要的程序集版本。当您升级第三方库参考等时，这可能非常有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T14:54:23.690

它是程序集所代表的软件版本的指示器。

最左边的数字通常代表破坏与早期版本兼容性的大更改，而最右边的数字代表单个更改编号。

.NET 使用自动编号进行修订，因为必须非常勤奋才能更改它。但是，构建系统可以在构建过程中注入源代码控制修订号以使其更有意义。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T14:55:57.273

版本控制在 .NET 框架中是一个非常重要的概念，我无法在此处的简单帖子中做到这一点。

[http://msdn.microsoft.com/en-us/library/51ket42z(VS.71).aspx](http://msdn.microsoft.com/en-us/library/51ket42z(VS.71).aspx)

我还建议通过 Jeffrey Richter 的 C# 阅读 CLR。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T15:34:54.933

除了技术用途之外，产品经理和市场营销也会影响版本号或名称。

Consider MS C/C++ *7* was followed by Visual C++ *1.0*. Or Windows *XP* and *Vista* for versions 5.1 and 6.

# c# - 如何从 MySql 数据库中获取日期到 C# DateTime 对象？

> ID：573153
> 
> 赞同：2
> 
> 时间：2009-02-21T14:51:26.473
> 
> 标签：c#, mysql, database, datetime

我有一个包含日期的特定字段的 MySQL 数据库。

如何将其转换为 C#`DateTime`对象？

以及如何转换 C#`DateTime`对象以便将其插入数据库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T15:06:01.307

如果您还没有[MySQL Connector for .NET](http://dev.mysql.com/downloads/connector/net/) ，您将需要它，以便让您的 C# 应用程序与 MySQL 通信。

然后，您将能够使用[MySqlConnection](http://dev.mysql.com/doc/refman/5.1/en/connector-net-examples-mysqlconnection.html)、[MySqlCommand](http://dev.mysql.com/doc/refman/5.1/en/connector-net-examples-mysqlcommand.html)、[MySqlDataReader](http://dev.mysql.com/doc/refman/5.1/en/connector-net-examples-mysqldatareader.html)等以标准方式将日期列从数据库中取出并放入 DateTime 对象中。

在 MySQL 日期/时间和 .NET DateTimes 之间转换时有一些潜在的陷阱，但是[MySQL 文档中有一个有用的部分，](http://dev.mysql.com/doc/refman/5.1/en/connector-net-using-datetime.html)其中提供了有关如何处理这些问题的建议。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T16:00:48.850

我们在我的商店中使用 MySQL 和 C# 来开发许多应用程序。我用于与日期有关的任何事情的解决方案是在数据库中使用 BIGINT 值并将我的所有 DateTime 对象存储为 UTC 值。对于我的需要，这个解决方案效果很好，而且很简单。这避免了转换到/从不同日期格式之间的任何问题。DB 端没有注意到我正在存储日期，而 C# 客户端可以轻松地将任何内容从 Int64 转换为 DateTime。

无论如何，这是我的解决方案，它对我有用。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-24T13:56:29.410

在数据库 mysql`yyyy-mm-dd`

所以

```
string date = DateTime.Now.ToString("yyyy-MM-dd"); 
```

# syntax - Groovy 范围，步长为 0.5

> ID：573155
> 
> 赞同：12
> 
> 时间：2009-02-21T14:52:43.117
> 
> 标签：syntax, groovy, range

在 Groovy 中指定整数范围和它们之间的 0.5 步的最优雅的方式是什么？例如：1、1.5、2、2.5、3、3.5、4

**编辑：**澄清：作为最终结果，我需要一个用于 Grails 约束的范围对象。虽然我想一个列表也可以。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-21T15:05:47.093

我能看到的最好方法是使用 step 命令。

IE

```
 1.step(4, 0.5){ print "$it "} 
```

将打印出：“1 1.5 2.0 2.5 3.0 3.5”

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-09-08T22:41:36.327

有点晚了，但这也有效

上述套装的单衬：

(2..8)*.div(2)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T17:08:44.193

苏，以上述为基础。要测试值 val 是否在 1..n 范围内但具有一半值：

```
def range = 2..(n*2).collect { return it/2.0 }
return range.contains( val ) 
```

类似的东西会起作用，但不像我想要的那样漂亮，但它可以让你构建一次范围并多次使用它，如果你需要的话。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-29T16:32:28.033

```
def r = []
(0..12).each() {
  r << it
  r << it + 0.5
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T15:14:09.600

仅供参考，从 Groovy 1.6.0 开始，它似乎不原生支持。目前只存在 ObjectRange.step(int) 。

[http://groovy.codehaus.org/api/groovy/lang/ObjectRange.html#step%28int%29](http://groovy.codehaus.org/api/groovy/lang/ObjectRange.html#step%28int%29)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T17:28:44.873

欺骗。

将您想要的范围映射到另一个更容易被 Groovy 处理的范围。你想要这样的东西：

```
 y in [x, x+0.5, x+1, x+1.5, ..., x+n] // tricky if you want a range object 
```

当且仅当：

```
 2*y in [2x,2x+1,2x+2,2x+3,...,2x+2n] // over whole integers only 
```

这与范围对象相同：

```
(2*x)..(2*x+2*n).contains(2*y)   //simple! 
```

或者：

```
switch (2*y) {
   case (2*x)..(2*x+2*n): doSomething(); break;
   ...} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-26T12:07:03.320

我的回答如下：

```
(1..4).step(0.5) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-11-14T22:38:20.837

`(1..7).collect{0.5*it}`是我能想到的最好的

# linux - 嵌入档案中的动态链接器依赖信息

> ID：573163
> 
> 赞同：2
> 
> 时间：2009-02-21T14:56:53.747
> 
> 标签：linux, linker

动态库很好。它们中嵌入了信息，可帮助运行时链接器确定最终可执行文件需要加载的其他库。它还告诉可执行文件将加载哪些符号

然而，静态库令人头疼。链接器不会自动链接存档的依赖项。当静态链接中等复杂或具有深度依赖图的库时，这会令人发指。

那么为什么档案不能只包含它们的依赖信息呢？我试图做到这一点。我的想法的关键是/usr/lib/libc.so。该文件不是共享对象文件，而是链接描述文件。

链接器脚本为您提供了对最终链接器输出的大量控制，但我想要的只是指定您可以使用的依赖项：

```
INPUT( -ldependency -ldependecy2 ) 
```

这是我的问题。

*   这看起来很简单，为什么以前没有这样做过？我不可能是第一个想到这个的人。这似乎比 pkg-config 或 libtool（尤其是 libtool ugh）更容易、更直观。
*   我试图将链接描述文件嵌入到存档中，但它不起作用。为什么不？它可以工作吗？我怀疑对 ranlib 的一些巧妙使用可能会奏效，但这超出了我的范围。

我当前的解决方案是创建一个名为 libMyLibrary.a 的链接器脚本。它包含

```
INPUT( -lMyRealLibrary -ldependency1 -ldependency2 ) 
```

我必须手动输入依赖项，如果 ld 对我来说会很好，但那是另一天的问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T04:15:01.167

为了回答你问题的第二部分，`ar p ARCHIVE SCRIPT`将 cat 包含在 ARCHIVE 中的 SCRIPT 的内容。或者`ar x ARCHIVE SCRIPT`提取文件，然后将其传递给链接器，如`ld blah blah -TSCRIPT`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T21:01:27.967

这种形式的链接器脚本仅受 GNU-ld 支持（新的 Gold ELF 链接器也有有限的支持）。如果您有任何可移植性要求，最好不要依赖链接描述文件支持。

libtool 是*专门*为帮助创建共享库的可移植性而编写的（其详细信息因平台而异）。

如果您不需要可移植性，那么您*当然*不需要 libtool 及其复杂性。

# c# - HttpModule 和 Global.aspx 之间的性能差异是什么？

> ID：573174
> 
> 赞同：7
> 
> 时间：2009-02-21T15:03:53.743
> 
> 标签：c#, web-applications, asp.net-2.0, httpmodule, global-asax

我制作了一个网络应用程序，我在其中使用了一个模块，该模块在没有“www”网址（[http://example.com/](http://example.com/)）的情况下重定向到“www”网址（[http://www.example.com/](http://www.example.com/)）。但是由于我在共享托管服务器上，我没有实现 HttpModule 的权限，所以我尝试了使用 Global.asax 文件的相同模块代码。这样可行！

我使用以下 (Application_BeginRequest()) 事件来实现我的 HttpModule 功能。

```
void Application_BeginRequest()
{
  //module code
} 
```

Global.asax 文件中的模块和应用程序运行良好且正确，但我担心性能。

为什么我们在 asp.net 中使用 HTTPModules 如果我们可以使用 Global.asax 文件实现相同的功能。两者之间是否存在性能差异。或者在使用 Global.asax 文件而不是 HttpModule 时我需要担心的任何区别？

请解释！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T15:21:15.683

Global.asax 继承自 HTTPApplication，HTTPModules 必须实现 IHTTPInterface。
HTTPModules Init 方法获取传入的 HTTPApplication 对象。
在 Init 方法中，您可以挂钩到 HTTPApplication 的事件。

我建议尽可能使用 HTTPModules。
特别是如果您制作收缩包装的软件，客户可以用他们自己的替换您的 global.asax。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T15:07:25.873

几乎没有区别。HTTPModules 的重点是为了清晰和分离。人们通常会通过几个 HTTPModule 来管道请求，这是 global.asax 无法获得的。

# java - Java - 将字符串转换为有效的 URI 对象

> ID：573184
> 
> 赞同：74
> 
> 时间：2009-02-21T15:07:19.417
> 
> 标签：java, android, encoding, utf-8

我正在尝试`java.net.URI`从`String`. 该字符串有一些字符需要被它们的百分比转义序列替换。但是当我使用 URLEncoder 使用 UTF-8 编码对字符串进行编码时，甚至 / 也被它们的转义序列替换。

如何从 String 对象获取有效的编码 URL？

**[http://www.google.com?q=ab](http://www.google.com?q=a)**给出**http%3A%2F%2www.google.com...****而**我希望输出为**[http://www.google.com?q=a% 20b](http://www.google.com?q=a%20b)**

有人可以告诉我如何实现这一目标。

我正在尝试在 Android 应用程序中执行此操作。所以我可以访问数量有限的图书馆。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-02-21T15:26:50.460

您可以尝试：`org.apache.commons.httpclient.util.URIUtil.encodeQuery`在[Apache commons-httpclient](http://hc.apache.org/httpclient-3.x/)项目中

像这样（见[URIUtil](http://svn.apache.org/viewvc/httpcomponents/oac.hc3x/trunk/src/java/org/apache/commons/httpclient/util/URIUtil.java?view=markup)）：

```
URIUtil.encodeQuery("http://www.google.com?q=a b") 
```

会变成：

```
http://www.google.com?q=a%20b 
```

你当然可以自己做，但是 URI 解析会变得非常混乱......

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2011-04-07T15:21:23.533

Android 一直将 Uri 类作为 SDK 的一部分：http: [//developer.android.com/reference/android/net/Uri.html](http://developer.android.com/reference/android/net/Uri.html)

您可以简单地执行以下操作：

```
String requestURL = String.format("http://www.example.com/?a=%s&b=%s", Uri.encode("foo bar"), Uri.encode("100% fubar'd")); 
```

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2012-01-22T17:02:51.403

我将在这里添加一个针对 Android 用户的建议。您可以这样做，以避免必须获取任何外部库。此外，上述某些答案中建议的所有搜索/替换字符解决方案都是危险的，应该避免。

试试这个：

```
String urlStr = "http://abc.dev.domain.com/0007AC/ads/800x480 15sec h.264.mp4";
URL url = new URL(urlStr);
URI uri = new URI(url.getProtocol(), url.getUserInfo(), url.getHost(), url.getPort(), url.getPath(), url.getQuery(), url.getRef());
url = uri.toURL(); 
```

您可以看到，在这个特定的 URL 中，我需要对这些空格进行编码，以便我可以将其用于请求。

这利用了 Android 类中提供给您的几个功能。首先，URL 类可以将 url 分解为其适当的组件，因此您无需进行任何字符串搜索/替换工作。其次，当您通过组件而不是从单个字符串构造 URI 时，这种方法利用了正确转义组件的 URI 类特性。

这种方法的美妙之处在于，您可以获取任何有效的 url 字符串并使其工作，而无需自己掌握任何特殊知识。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2014-08-06T13:54:54.193

即使这是一个已经接受答案的旧帖子，我也会发布我的替代答案，因为它适用于当前问题，而且似乎没有人提到这种方法。

使用 java.net.URI 库：

```
URI uri = URI.create(URLString); 
```

如果你想要一个与之对应的 URL 格式的字符串：

```
String validURLString = uri.toASCIIString(); 
```

与许多其他方法（例如 java.net.URLEncoder）不同，此方法仅替换不安全的 ASCII 字符（例如`ç`，`é`...）。

* * *

在上面的例子中，if`URLString`如下`String`：

```
"http://www.domain.com/façon+word" 
```

结果`validURLString`将是：

```
"http://www.domain.com/fa%C3%A7on+word" 
```

这是一个格式正确的 URL。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-07-26T07:07:35.523

如果你不喜欢图书馆，这个怎么样？

请注意，您不应在整个 URL 上使用此功能，而应在组件上使用此功能...例如，在构建 URL 时仅使用“a b”组件 - 否则计算机将不知道应该使用哪些字符具有特殊含义，哪些应该具有字面含义。

```
/** Converts a string into something you can safely insert into a URL. */
public static String encodeURIcomponent(String s)
{
    StringBuilder o = new StringBuilder();
    for (char ch : s.toCharArray()) {
        if (isUnsafe(ch)) {
            o.append('%');
            o.append(toHex(ch / 16));
            o.append(toHex(ch % 16));
        }
        else o.append(ch);
    }
    return o.toString();
}

private static char toHex(int ch)
{
    return (char)(ch < 10 ? '0' + ch : 'A' + ch - 10);
}

private static boolean isUnsafe(char ch)
{
    if (ch > 128 || ch < 0)
        return true;
    return " %$&+,/:;=?@<>#%".indexOf(ch) >= 0;
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-21T15:41:01.143

您可以使用该类的多参数构造函数`URI`。从`URI`javadoc：

> 多参数构造函数根据它们出现的组件的要求引用非法字符。这些构造函数始终引用百分比字符 ('%')。保留任何其他字符。

所以如果你使用

```
URI uri = new URI("http", "www.google.com?q=a b"); 
```

然后你会得到`http:www.google.com?q=a%20b`不完全正确的，但它更接近一点。

如果您知道您的字符串不会有 URL 片段（例如[http://example.com/page#anchor](http://example.com/page#anchor)），那么您可以使用以下代码来获取您想要的内容：

```
String s = "http://www.google.com?q=a b";
String[] parts = s.split(":",2);
URI uri = new URI(parts[0], parts[1], null); 
```

为了安全起见，您应该扫描字符串中的`#`字符，但这应该可以帮助您入门。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-01-19T20:47:38.813

我的一个项目从字符串创建 URI 对象时遇到了类似的问题。我也找不到任何干净的解决方案。这是我想出的：

```
public static URI encodeURL(String url) throws MalformedURLException, URISyntaxException  
{
    URI uriFormatted = null; 

    URL urlLink = new URL(url);
    uriFormatted = new URI("http", urlLink.getHost(), urlLink.getPath(), urlLink.getQuery(), urlLink.getRef());

    return uriFormatted;
} 
```

如果需要，您可以使用以下 URI 构造函数来指定端口：

```
URI uri = new URI(scheme, userInfo, host, port, path, query, fragment); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-07-12T08:22:09.613

好吧，我尝试使用

```
String converted = URLDecoder.decode("toconvert","UTF-8"); 
```

我希望这就是你真正想要的？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-21T16:04:58.903

java.net 博客前几天有一个课程可能已经完成了你想要的（但它现在已经关闭，所以我无法检查）。

这里的代码可能会被修改为你想要的：

[http://svn.apache.org/repos/asf/incubator/shindig/trunk/java/common/src/main/java/org/apache/shindig/common/uri/UriBuilder.java](http://svn.apache.org/repos/asf/incubator/shindig/trunk/java/common/src/main/java/org/apache/shindig/common/uri/UriBuilder.java)

这是我从 java.net 想到的一个：[https ://urlencodedquerystring.dev.java.net/](https://urlencodedquerystring.dev.java.net/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-01-12T20:15:24.283

或者也许你可以使用这个类：

[http://developer.android.com/reference/java/net/URLEncoder.html](http://developer.android.com/reference/java/net/URLEncoder.html)

自 API 级别 1 起就存在于 Android 中。

然而，令人讨厌的是，它特别对待空格（用 + 而不是 %20 替换它们）。为了解决这个问题，我们只需使用这个片段：

`URLEncoder.encode(value, "UTF-8").replace("+", "%20");`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-02-12T04:51:42.647

我最终使用了 httpclient-4.3.6：

```
import org.apache.http.client.utils.URIBuilder;
public static void main (String [] args) {
    URIBuilder uri = new URIBuilder();
    uri.setScheme("http")
    .setHost("www.example.com")
    .setPath("/somepage.php")
    .setParameter("username", "Hello Günter")
    .setParameter("p1", "parameter 1");
    System.out.println(uri.toString());
} 
```

输出将是：

```
http://www.example.com/somepage.php?username=Hello+G%C3%BCnter&p1=paramter+1
```

# asp.net - ASP.NET Ajax：生产服务器上的“PageMethods is undefined”脚本错误（在本地主机上工作）

> ID：573193
> 
> 赞同：1
> 
> 时间：2009-02-21T15:11:17.470
> 
> 标签：asp.net, asp.net-ajax, pagemethods

在一个 javascript 文件中，我调用了一个 ASP.NET Ajax PageMethod (ASP.NET 3.5)，在页面类中正确定义了一个使用 WebMethod 属性的静态方法。这**适用于我的开发机器**，但在生产服务器上，当调用我的 javascript 函数（单击按钮）时， **PageMethod 对象未定义。**

一些调试信息：

*   Firefox 和 Internet Explorer 上的错误
*   根据 Firebug 的网络选项卡，所有外部资源都已正确加载
*   我在同一页面上使用 jQuery
*   使用 Web 部署项目部署应用程序

知道是什么导致了问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T15:16:56.910

写完问题后，我找到了问题的解决方案。[为了避免将 aspx 占位符文件（Web 部署项目）复制](https://stackoverflow.com/questions/424230/is-there-a-way-to-get-rid-of-aspx-placeholder-files-in-a-asp-net-web-deployment-p)到服务器，我做了一个肮脏的把戏：在 IIS 中，我取消选中了 .aspx ISAPI 扩展选项“验证该文件是否存在”。

这似乎是 ASP.NET Ajax 的一个问题。所以我创建了一个空的 aspx 占位符文件......现在它也在生产服务器上工作。我会在上面链接的问题/答案上放置一个警告标志。

# java - Java Web 应用程序数据访问类中的线程安全

> ID：573194
> 
> 赞同：0
> 
> 时间：2009-02-21T15:11:24.240
> 
> 标签：java, multithreading, jakarta-ee

我的一个爱好项目是 Java Web 应用程序。这是一个带有表单的简单网页。用户填写表单，提交，并显示一些结果。

数据来自 JDBC 连接。当用户提交时，我验证输入，构建“CREATE ALIAS”语句、“SELECT”语句和“DROP ALIAS”语句。我执行它们并对查询中的 ResultSet 做任何我需要做的事情。

由于我正在使用的特定数据库/JDBC 组合上的别名存在问题，因此每次运行查询时都需要使用唯一名称创建这些别名。我正在使用一个 int 来确保每次我们访问数据库时都会增加它。

所以，我的数据访问类看起来有点像：

```
private final static Connection connection = // initialized however

private static int uniqueInvocationNumber = 0;

public static Whatever getData(ValidatedQuery validatedQuery) {
    String aliasName = "TEMPALIAS" + String.valueOf(uniqueInvocationNumber);
    // build statements, execute statements, deal with results
    uniqueInvocationNumber++;
} 
```

这行得通。然而，我最近意识到我被 Jon Skeet 的[线程知识](https://stackoverflow.com/questions/423823/whats-your-favorite-programmer-ignorance-pet-peeve/424160#424160)第 0 阶段牢牢困住（“完全无知 - 忽略任何可能的问题。”）——我从未编写过线程代码或线程感知代码. 我完全不知道当许多用户同时使用该应用程序时会发生什么。

所以我的问题是，（假设我没有靠运气/ J2EE魔法偶然发现线程安全）：

我怎样才能保证这个安全？

我在这里包含了我认为相关的信息，但如果还不够，请告诉我。

太感谢了。

**编辑：**这是一个使用 Wicket 框架的合适的 J2EE Web 应用程序。我通常将它部署在 Jetty 中。

**编辑：**对于那些感兴趣的人来说，关于别名动机的长篇故事：

有问题的数据库是 AS400 上的 DB2（i5、System i、iSeries，无论 IBM 现在如何称呼它），我正在使用[jt400](http://jt400.sourceforge.net/)。

尽管 AS400 上的 DB2 有点像任何其他平台上的 DB2，但由于遗留的东西，表有一个“成员”的概念。成员有点像一张桌子。我要运行的查询是

```
SELECT thisField FROM thisTable(thisMember) 
```

它将 thisMember 本身视为一个表，因此只需为您提供成员中所有行的 thisField。

现在，诸如此类的查询在交互式 SQL 会话中运行良好，但不能在 JDBC 上运行（我不知道为什么）。我使用的解决方法是做类似的事情

```
CREATE ALIAS tempAlias FOR thisTable(thisMember) 
```

然后一个

```
SELECT thisField FROM tempAlias 
```

然后一个

```
DROP ALIAS tempAlias 
```

这有效，但对于一个显示停止的问题：当您使用始终称为“tempAlias”的 ALIAS 重复执行此操作时，如果 thisField 从一个查询到下一个查询的长度不同，则结果集第二次返回乱码查询（第一行的 getString 很好，下一个前面有一定数量的空格，下一个前面有相同数量的空格 - 这是来自内存，但它是这样的）。

因此，确保每个 ALIAS 都有一个不同的名称的解决方法可以解决这个问题。

我刚刚意识到（已经花时间挖掘这个解释）我可能没有花足够的时间首先考虑这个问题，然后才抓住解决方法。不幸的是，我还没有实现为我的卧室买一台 AS400 的梦想；）所以我现在不能尝试任何新的东西。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-21T15:23:07.067

好吧，我将暂时忽略任何 SQL 内容，只关注 uniqueInvocationNumber 部分。这里有两个问题：

*   无法保证线程会在任何特定点看到最新值
*   增量不是原子的

在 Java 中解决此问题的最简单方法是使用[AtomicInteger](http://java.sun.com/javase/6/docs/api/java/util/concurrent/atomic/AtomicInteger.html)：

```
private static final AtomicInteger uniqueInvocationNumber = new AtomicInteger();

public static Whatever getData(ValidatedQuery validatedQuery) {
    String aliasName = "TEMPALIAS" + uniqueInvocationNumber.getAndIncrement()
    // build statements, execute statements, deal with results
} 
```

请注意，这仍然假设您仅在单个服务器上运行单个实例。对于一个家庭项目，这可能是一个合理的假设:)

另一个潜在问题是在不同线程之间共享单个连接。通常，处理数据库连接的更好方法是使用连接池，并在需要的地方“打开/使用/关闭”连接（在 finally 块中关闭连接）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T15:23:04.883

如果该静态变量和唯一调用编号的递增对所有请求都是可见的，我会说它是需要同步的共享状态。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T12:36:15.230

我知道这不能回答您的问题，但我会认真考虑重新实现该功能，因此不需要创建所有这些别名。（你能解释一下你正在创建什么样的别名以及为什么它是必要的？）

我知道这只是一个爱好项目，但请考虑将您的“待办事项清单”添加到使用连接池。这都是学习的一部分，我想这也是你做这个项目的动力的一部分。连接池是在数据库支持的 Web 应用程序中处理多个同时用户的正确方法。

# redirect - 如何获得没有“default.aspx”网址？

> ID：573197
> 
> 赞同：0
> 
> 时间：2009-02-21T15:12:35.457
> 
> 标签：redirect, url-rewriting, asp.net-2.0, global-asax

我在我的 Web 应用程序的 Global.asax 文件中实现了以下代码。

```
void Application_BeginRequest()
{

    string rule = ConfigurationManager.AppSettings.Get("WwwRule");

    HttpContext context = HttpContext.Current;
    if (context.Request.HttpMethod != "GET" || context.Request.IsLocal)
    {
        return;
    }

    if (context.Request.PhysicalPath.EndsWith(".aspx", StringComparison.OrdinalIgnoreCase))
    {
        string url = context.Request.Url.ToString();

        if (!url.Contains("://www.") && rule == "add")
        {
            string url = context.Request.Url.ToString().Replace("://", "://www.");
            context.Response.Redirect(url);
        }
    }
} 
```

当我在上面运行代码时，它的工作方式如下

**example.com**重定向到**www.example.com/default.aspx**

**www.example.com**重定向到**www.example.com**

**[http://www.example.com/](http://www.example.com/)**重定向到**[http://www.example.com/](http://www.example.com/)**

最后两个条件效果很好。但是第一个条件效果不佳，因为它在我不感兴趣的 URL 中添加了“default.aspx”。

谁能告诉我如何制作如下

**example.com**应该重定向到**[http://www.example.com](http://www.example.com)**

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T15:34:40.567

实际上，/default.aspx 是在请求​​到达 BeginRequest 事件之前添加的。如果要删除它，则必须实际删除它：

```
void Application_BeginRequest() {
    string rule = ConfigurationManager.AppSettings.Get("WwwRule");

    HttpContext context = HttpContext.Current;
    if (context.Request.HttpMethod != "GET" || context.Request.IsLocal) {
        return;
    }

    if (context.Request.PhysicalPath.EndsWith(".aspx", StringComparison.OrdinalIgnoreCase)) {
        string url = context.Request.Url.ToString();

        if (!url.Contains("://www.") && rule == "add") {
            url = url.Replace("://", "://www.");
            if (url.EndsWith("/default.aspx", StringComparison.OrdinalIgnoreCase) {
               url = url.Substring(0, url.Length - 13);
            }
            context.Response.Redirect(url);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T15:35:27.850

Request.Url 很可能附加了 default.aspx，因为那是当时实际提供的页面（IIS 使这对您透明，因为它是默认页面之一）。

当您创建要重定向的新 URL 时，请在其末尾添加另一个 .Replace("/default.aspx", "")。所以...

```
string url = context.Request.Url.ToString().Replace("://", "://www.").Replace("/default.aspx", ""); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-02-06T09:35:19.087

使用以下代码更改您的 webconfig：它解决了我同样的问题。

```
<?xml version="1.0"?>
<configuration>
    <system.webServer>
        <rewrite>
            <rules>
                <rule name="default.aspx Redirect" stopProcessing="true">
                    <match url="^(.*\/)*default\.aspx$" />
                    <conditions logicalGrouping="MatchAll">
                        <add input="{REQUEST_METHOD}" negate="true" pattern="^POST$" />
                    </conditions>
                    <action type="Redirect" url="{R:1}" redirectType="Permanent"/>
                </rule>
            </rules>
        </rewrite>
    </system.webServer>
</configuration> 
```

# architecture - 构建项目的最佳方式是什么？

> ID：573201
> 
> 赞同：1
> 
> 时间：2009-02-21T15:14:55.077
> 
> 标签：architecture, projects, n-tier-architecture, layered

我想知道我应该如何构建我的项目。

我们有一些项目在其他项目中（重新）使用。

我的意思是，我们的数据项目和模型项目用于一对多的其他项目。

我真正知道的是如何构建这种类型的项目，最好的命名方式是什么？

在标准的 3 层应用程序中，应该类似于：

1.  DAL、DataAccessLayer、数据...
2.  模型、业务对象、BOL ...
3.  用户界面，视图，...

还有其他想法吗？

在我工作的每家公司，他们都有不同的组织方式，有没有比另一个更好的？您使用哪一种，您更喜欢哪一种，为什么？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T15:24:09.327

这几乎就是我所做的，除了我有几个库项目我尝试放置我所有的可重用代码。然后我的模型和 DAL 位于这些库之上，只是向它们添加项目细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T15:47:04.360

对于数据层，我通常使用：

**Company.ProjectName.Data**（即 AdventureWorks.OrderManager.Data）

对于业务层，我更喜欢“ObjectModel”之类的东西（我使用过“Business”或“BusinessLogic”，但这是数据在对象/类中聚集在一起的区域，所以为什么不这样命名呢？）。

**Company.ProjectName.ObjectModel** （即 AdventureWorks.OrderManager.ObjectModel）

对于 UI，我喜欢普通的旧“UI”或“Presentation”...

**Company.ProjectName.Presentation**（即 AdventureWorks.OrderManager.Presentation）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T16:09:07.643

大多数情况下，我使用 Microsoft Patterns & Practices [Application Architecture for .NET: Designing Applications and Services](http://msdn.microsoft.com/en-us/library/ms954595.aspx)中推荐的分层架构。文档描述了实现它的体系结构和 .NET 技术。

![替代文字](https://www.codeproject.com/KB/cs/InsideTrivadisFramework%5CMicrosoftBestPracticesArchitecture.png)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T15:39:07.030

软件架构取决于要构建的软件类型。如果您想进行内核编程，则与进行应用程序开发相比，其他原则适用。当您要进行物理模拟、天气预报软件、软件 IDE 或编译器时，还有另一个原则适用。

我假设您想做应用程序开发。那么，您很可能希望围绕您要反映的领域来设计您的软件。但即便如此，也有很多选择。

为了更深入地了解这个大主题，我强烈建议阅读`Domain Driven Design`和阅读.`Eric Evans``Applying Domain-Driven Design and Patterns``Jimmmy Nilsson`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T15:50:16.083

我目前正在开发具有 3 层架构的前端 Web 应用程序：

*   客户端层（浏览器）
*   应用层（Java EE 应用服务器，应用所在的位置）
*   后端层（大型机和遗留应用程序、各种数据库）

它具有分层架构，应用层中的层有：

*   表示层：生成将在客户端层中使用的 UI
*   应用层：相当于用例，包含应用逻辑
*   服务层：将后端层的域逻辑和数据映射到 Java 模型上
*   集成层：与后端层通信并包含用于 JMS、电子邮件、...以及 DAO 和其他东西的网关

这只是一个示例项目结构，最终结果将取决于应用程序的类型。[您可以在我](https://stackoverflow.com/questions/533102/what-strategy-do-you-use-for-package-naming-in-java-projects-and-why/534501#534501)对[这个问题](https://stackoverflow.com/questions/533102/what-strategy-do-you-use-for-package-naming-in-java-projects-and-why)的回答中阅读更多关于包的划分和命名策略的信息。

您可以根据需要添加/交换/删除图层。例如，在 SOA 中，您可以在应用程序层或服务层之上放置一个 Web 服务层，以便 ESB（企业服务总线）可以连接到您的应用程序或服务。如果其中任何一项是不可能的或看起来非常困难，那么您就没有最佳的架构和设计。

在考虑您的项目结构并允许上述场景时，您想要的模块和组件的一些重要属性是：

*   可测试性
*   可重用性
*   可维护性

您可以通过设计低耦合和高内聚来实现这一点。通过按功能/抽象级别对模块进行分组来选择分层架构是一个好的开始。在每一层内按功能进一步分组也有帮助。让每个更具体的层只依赖于更通用层的接口也减少了耦合。

# django - Django 模板 - 通过字符串参数重新组合

> ID：573208
> 
> 赞同：1
> 
> 时间：2009-02-21T15:20:05.157
> 
> 标签：django, google-app-engine, refactoring, django-templates

我想要重构的 Django 模板之一中有以下代码：

```
{% ifequal sort_type "set" %} 
    {% regroup cards by set as grouped %}   
{% endifequal %}
{% ifequal sort_type "rarity" %} 
    {% regroup cards by rarity as grouped %}
{% endifequal %} 
```

它确实有效，但它真的很难看，我想让它更像这样：

```
{% regroup cards by sort_type as groupedcards %} 
```

但这不起作用（它只是将它们全部放在一个名为 None 的组中。）从文档中，我认为它可能正在尝试字典查找（即，调用 card["set"] 而不是 card.set）。

有没有在模板中执行此操作的好方法，或者我应该使用 itertools 将重组移出到 Python 代码中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T15:59:21.023

在与此问题相关[的 Django bugtracker 中打勾。](http://code.djangoproject.com/ticket/1461)

# c# - 为什么使用 GZipStream 压缩 HTTP 响应时 CSS 文件不加载？

> ID：573210
> 
> 赞同：1
> 
> 时间：2009-02-21T15:20:31.193
> 
> 标签：c#, compression, asp.net-2.0, gzip, httpcontext

我正在使用 asp.net 2.0 (C#) 开发一个应用程序，我正在尝试实现我的文件的压缩，以便我的网站的性能得到改善。

为此，我在 Global.asax 文件中添加了一个代码来压缩所有请求（.aspx、.js、.css）但是当我运行我的应用程序时，它第一次运行良好，然后 CSS 没有加载并且网页是没有正确渲染。

为什么会这样？？

**已编辑（添加了我的压缩代码）**

我的 Global.asax 文件的压缩代码如下：

```
void Application_BeginRequest()
    {
        HttpContext incoming = HttpContext.Current;
        string oldpath = incoming.Request.Path.ToLower();

        incoming.Response.Filter = new GZipStream(incoming.Response.Filter, CompressionMode.Compress);
        HttpContext.Current.Response.AppendHeader("Content-encoding", "gzip");
        HttpContext.Current.Response.Cache.VaryByHeaders["Accept-encoding"] = true;
    } 
```

另外请让我知道是否有其他更好的方法来做同样的事情，使用 Global.asax 文件，因为我没有 IIS 设置的访问权限，也没有实现 HttpModule 的权限，这就是为什么我正在使用 Global.asax 文件。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T15:22:31.423

对于静态文件，您可以配置 IIS 为您进行压缩，无需自己实现。

在 IIS6 中，这是一个全局设置（IIS 管理器中“网站”节点的属性，服务选项卡）。

在 IIS7 中，这是基于每个文件夹设置的，它还会为您压缩动态内容。它可以在 IIS 管理器或[web.config](http://www.iis.net/ConfigReference/system.webServer/urlCompression "iis.net")文件中设置：

```
<configuration>
  <system.webServer>
    <urlCompression doDynamicCompression="true" doStaticCompression="true" />
  </system.webServer>
</configuration> 
```

# windows-mobile - 存档短信 (sms)

> ID：573215
> 
> 赞同：2
> 
> 时间：2009-02-21T15:22:35.370
> 
> 标签：windows-mobile, sms, rapi

我想将 WM 手机上的文本消息存档到我的 PC，最好是 XML。我可以从 PC 应用程序（例如通过 RAPI）访问它们吗？我没有WM开发经验，只会PC，然后主要是Delphi。

除非您认为这是唯一可能的方式，否则请不要链接到商业应用程序。

**编辑**
没人？你们让我失望了:-)。或者是:-(？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-24T14:28:28.460

我使用 PIM Backup 导出我的 SMS 消息。[http://www.dotfred.net/](http://www.dotfred.net/)

它可以以二进制或文本格式导出消息（csv，没有 xml，抱歉）

它会生成一个 .pib 文件，您可以将其重命名为 .zip，然后解压缩以查找导出的文本文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-05T11:31:36.077

也许这个应用程序可以帮助你：[http ://handheld.softpedia.com/get/System-Utilities/Enhancements/AllExport-9131.shtml](http://handheld.softpedia.com/get/System-Utilities/Enhancements/AllExport-9131.shtml)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T20:59:10.957

要访问 SMS 消息，请使用 Windows Mobile[消息](http://msdn.microsoft.com/en-us/library/bb446118.aspx)服务。具体来说，您需要使用[MAPI](http://msdn.microsoft.com/en-us/library/bb415647.aspx)来访问所有 SMS。这假定设备正在使用 Windows Mobile SMS Messaging，有些则不使用。在不需要的设备上，您必须使用 Manufactor API 来访问 SMS 消息。

您不能直接从 RAPI 访问 MAPI，但您可以使用 RAPI 下推并运行您自己的应用程序，该应用程序将与 PC 进行通信。有很多方法可以做到这一点。

# firefox - 快速查找 API 文档的 Firefox 栏

> ID：573225
> 
> 赞同：1
> 
> 时间：2009-02-21T15:34:28.570
> 
> 标签：firefox, search, address-bar

这个问题与这个 [Tricks to Google for desired page有关](https://stackoverflow.com/questions/573072/tricks-to-google-for-desired-page-quickly)

Firefox 可以发挥一些神奇的作用，并准确地提供所需的页面。例如

```
 java 6 SimpleDateFormat
  ruby doc rexml 
```

但有时它无法给出通常的谷歌结果：

```
 ruby rexml 
```

有时我希望它去不同的位置：

```
javascript array slice

  I see
    http://www.w3schools.com/jsref/jsref_slice_array.asp
  but whould like it to be
    https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Array/slice 
```

顺便说一句，它是如何工作的？我在哪里可以找到所有现有的映射，如何添加/编辑它们？如果可以将它们作为文本文档进行查看/编辑，那就太好了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-04T21:48:37.163

您可以将[YubNub](http://yubnub.org)添加为搜索引擎（这是我的默认设置），然后您选择的 api 文档作为 YubNub 命令（如果它尚不存在）。我一直将它用于 Ruby，例如`rdoc String`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-04T22:03:47.130

你有几个选择：

1.  使用搜索提供程序可用的右侧搜索框。MDC 曾经有过这样的提供商，但他们的搜索引擎很糟糕。例如 SO 有这样的提供者。它由那里的箭头上的蓝色阴影表示。

2.  导航到特定的搜索引擎，右键单击搜索字段并“为此搜索添加关键字”。例如，您可以添加“js”。以后你只需要在地址栏中输入“js array slice”，FF就会带你进入那个特定搜索引擎的搜索结果页面。

3.  如果该站点上没有搜索引擎，请使用[Google 自定义搜索](http://www.google.com/coop/cse/)，根据需要定义引擎，然后按照第 2 点的步骤操作。

如果要修改地址栏的内置搜索引擎，请打开一个新选项卡，转到 about:config 然后搜索“keyword.URL”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T15:37:38.827

这些不是映射，而是 Google Lucky 搜索，不是吗？

# c# - finally 块中的多项操作

> ID：573231
> 
> 赞同：2
> 
> 时间：2009-02-21T15:37:32.573
> 
> 标签：c#, exception

假设您进行了一些资源清理，例如：这是 C#。

```
try{/*stuff*/}
catch(Exception e) {/*rollback logs etc.*/}
finally{
 if( context.Transaction != null )
  context.Transaction.Dispose();
 context.Connection.Close();
 context.Connection.Dispose();
} 
```

这样做会更健壮吗？

```
try{/*stuff*/}
catch(Exception e) {/*rollback logs etc.*/}
finally{
 try{
  if( context.Transaction != null )
   context.Transaction.Dispose();
 }catch(Exception e){/*logs*/}
 finally{
  context.Connection.Close();
  context.Connection.Dispose();
 }
} 
```

这样，如果 transaction.dispose 至少失败，连接将有机会关闭。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-21T15:39:24.330

> 这样做会更健壮吗？

使用多个 using 块会更好。

首先，您的 catch 块将吃掉所有异常并且不需要（可以尝试 ... finally 没有任何捕获）。仅当您可以处理（或增加值）异常时才使用 catch。

但更好：

```
using (var resA = GetMeAResourceNeedingCleanUp())
using (var resB = new AnotherResourceNeedingCleanUpn(...)) {
  // Code that might throw goes in here.
} 
```

注意。一旦异常回退，并且 finally 块正在清理，抛出另一个异常可能会导致（充其量）混淆正在处理的异常。第二条准则：

**不要**从 Dispose 方法或终结器中抛出异常。如果您需要允许用户处理清理失败，请提供一个单独的 Close 方法，该方法可以报告其失败。

请注意，“框架设计指南”（第 2版）的内容为（ ^(§9.4.1)）：

> **避免**在 Dispose(bool) 中引发异常，除非在包含进程已损坏（泄漏、不一致的共享状态等）的危急情况下。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-21T15:50:52.167

三点：

*   您不需要调用 Close 以及 dispose
*   在单独的 finally 块中处理事务是一个更好的主意，因为它可以防止在处理期间引发异常。（它不应该经常发生，但它可能会发生。）
*   `using`声明几乎总是最干净的资源处理方式。即使我*还*想要一个 try/catch 块，我也会使用它，只是因为这是惯用的说法，“这使用了我想在块末尾处理的资源”

结合这些将导致两个 using 语句：

```
using (SqlConnection conn = ...)
{
    using (Transaction trans = ...)
    {
    }
} 
```

如果你想避免过多的缩进，你可以这样写：

```
using (SqlConnection conn = ...)
using (Transaction trans = ...)
{
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T15:40:04.000

为什么 Dispose 调用会失败？在某些时候你也可能过于小心。就像用 try/catch 包装每个“新”语句一样，以防内存耗尽......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T15:52:25.890

我不喜欢我的 finally 子句过于冗长（或任何子句，就此而言）。我会将您的资源清理重构为一些实用程序类。保留所有嵌套的 try 和“if null”条件，以便更好地重用。例如，由于您的清理逻辑仅驻留在一个位置，因此您稍后可以轻松地改变您是否真的需要调用 Dispose() 的想法。

更重要的是，您的应用程序代码变得更易于理解。

```
try{/*stuff*/}
catch(Exception e) {/*rollback logs etc.*/}
finally{
  Utility.cleanup(context);
} 
```

# ant - 如何更改 ant 的 JAVA_HOME？

> ID：573235
> 
> 赞同：32
> 
> 时间：2009-02-21T15:39:26.077
> 
> 标签：ant, java-home

我在没有 root 的类服务器上做 java 工作。每当我尝试使用 ant 进行编译时，它都会指向错误的目录（`/usr/tomcat`而不是`/usr/tomcat/jre`）。

在设置我们的用户帐户时，我们被告知要做的一件事是添加`export JAVA_HOME=/usr/tomcat/jre`到 .bashrc 文件中。我不知道这是否应该解决问题，但似乎没有。

那么，我怎样才能更改 ant 的 JAVA_HOME 属性，但仅限于我运行 ant 时？

编辑： `echo $JAVA_HOME`指向`/usr/tomcat/jre` `echo $JAVA_HOME\bin`指向`/usr/tomcat/jrebin`

问题是当我通常运行 ant 时出现此错误：

```
Unable to locate tools.jar. Expected to find it in /usr/tomcat/lib/tools.jar
Buildfile: build.xml

compile:
    [javac] Compiling 1 source file to /home/ejm244/build/classes

BUILD FAILED
/home/ejm244/build.xml:9: Unable to find a javac compiler;
com.sun.tools.javac.Main is not on the classpath.

Perhaps JAVA_HOME does not point to the JDK

Total time: 0 seconds 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-21T15:45:16.673

您可以创建自己的脚本来运行 ant，例如命名为 ant.sh，如：

```
#!/bin/sh
JAVA_HOME=</path/to/jdk>; export JAVA_HOME
ant $@ 
```

然后运行你的脚本。

```
$ chmod 755 ant.sh
$./ant.sh clean compile 
```

或您希望运行的任何蚂蚁目标

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-21T15:43:45.770

JAVA_HOME 应该指向 JDK 的安装位置，而不是 JRE。

那么，如果你输入 ls $JAVA_HOME 你会看到什么？如果你执行 ls $JAVA_HOME/bin/ 你会看到 javac 吗？

如果第一个不起作用，那么您没有 JAVA_HOME 指向正确的目录。如果第二个不起作用，那么您需要将 JAVA_HOME 指向 JDK 而不是 JRE。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-21T21:38:38.007

查看用于调用 ant 的 shell 脚本，在 .bashrc 中为您的 shell 设置的 $JAVA_HOME 的值可能会在文件 /etc/ant.conf、$HOME/.ant/ant.conf 和 $ 中被覆盖主页/.antrc。如果您执行 bash -x <path to ant script>，它将发出调试信息，帮助您追踪 $JAVA_HOME 被覆盖的位置。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-03-14T21:27:15.490

在我的 Windows 7 机器设置上：

```
JAVA_HOME="C:\Program Files\Java\jdk1.6.0_18" 

```

没用。但是设置：

```
JAVA_HOME=C:\Program Files\Java\jdk1.6.0_18

```

工作。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-01-25T19:33:01.853

有两种方法可以改变编译器：

*   `export JAVA_HOME=/path/to/jdk`在你启动 Ant 之前。
*   放`<javac exectuable="/path/to/javac">`

另一种选择是将一个相应`tools.jar`的添加到类路径中，但如果 Ant 是从其他工具（如 Maven）启动的，通常会使用这种方法。

有关在 Ant 中更改 Java 编译器的这些（或其他）选项的更多详细信息，请参阅[这篇文章](https://github.com/ctapobep/javatalks-articles/blob/master/en/ant-maven-hava-home.md)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-01-25T12:22:44.567

设置环境变量：JAVACMD - Java 可执行文件的完整路径。使用它来调用与 JAVA_HOME/bin/java(.exe) 不同的 JVM。

参考：[http ://ant.apache.org/manual/running.html](http://ant.apache.org/manual/running.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-04-01T14:39:01.547

尽管环境变量`JAVA_HOME`设置正确，但`ant`可以使用每个*build.xml*或任何构建文件中配置的 JRE。

要检查 ant 使用的 JRE 版本，请右键单击构建文件 -> 选择显示有关要选择的任务等详细信息的构建 ant，然后选择要使用的 JRE。

建议使用项目级别设置或仅在工作区级别。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-03-17T03:47:51.003

从 shell 运行 ant 时，您不需要`export JAVA_HOME`先设置该变量为当前 shell 和所有未来命令，而是使用

```
user@host:~# JAVA_HOME=/path/to/jdk ant targets 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-22T03:35:03.580

使用 Bash 时，试试这个：

```
$ export JAVA_HOME=/usr/tomcat/jre 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-10-06T13:30:19.350

将项目中的 JRE（项目属性 -> Java 构建路径 -> 库，通常是最后一个条目）或首选项（Java->已安装的 JRE）中的全局默认设置为 JDK，而不是 JRE。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-22T00:30:02.340

如果您尝试编译代码，JAVA_HOME 需要指向 JDK 主目录。检查“/usr/tomcat/jre/bin/javac”是否存在。我怀疑它确实如此。

如果您没有 JDK，则可以通过获取 ECJ（eclipse 编译器）库，将其放入“~/.ant/lib”并将系统属性添加到命令行以使用该编译器来解决它- 查看 Ant 手册了解详情。

[http://ant.apache.org/](http://ant.apache.org/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-02T07:25:11.140

您需要将 JAVA_HOME 路径更改为 Java SDK 目录而不是 Java RE 目录。在 Windows 中，您可以在命令提示符下使用 set 命令执行此操作。

例如

设置 JAVA_HOME="C:\Program Files\Java\jdk1.6.0_14"

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-08-24T09:12:43.473

试试这个：

```
/usr/sbin/update-alternatives --config java 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2011-09-20T13:43:41.770

java_home 始终指向 jdk，即为您提供类的编译器，而 jre 是您的浏览器或任何编译类的方式，因此它必须在版本中的 jdk 和 jre 之间匹配。

# javascript - 我有一个 jquery 自动完成条目，我想在其中添加一个向下箭头图像

> ID：573243
> 
> 赞同：0
> 
> 时间：2009-02-21T15:42:21.623
> 
> 标签：javascript, jquery, html, css

我有一个 jQuery 自动完成条目，我想让它看起来更像一个“组合框”。我对其进行了设置，以便当用户单击条目时，它将空白并执行空白查询以显示所有可能的匹配项。

我想在自动完成条目中添加一个特殊的“向下箭头图像”，以便用户知道单击该箭头，就像它是一个选择框箭头一样。如何将此图像粘贴在条目中以使其看起来像一个选择/组合框？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T15:44:33.583

这是一个 CSS 技巧，您必须在输入框上设置背景图像（或至少没有默认设置），并创建一个与输入对齐的按钮（箭头），使其看起来像输入。谷歌是你的朋友。

# asp.net - 是否可以在开发服务器上使用 SmtpClient.DeliveryMethod = SmtpDeliveryMethod.SpecifiedPickupDirectory？

> ID：573259
> 
> 赞同：1
> 
> 时间：2009-02-21T15:50:58.453
> 
> 标签：asp.net, email, system.net.mail

我无法访问 IIS 开发服务器——只有生产服务器。因此，对于我的开发，我必须使用 Visual Studio 中内置的 ASP.NET 开发服务器。`Failure to send message`当我以这种方式配置 SMTP 客户端时，我得到了。

```
SmtpClient.Host = "localhost";
SmtpClient.DeliveryMethod = SmtpDeliveryMethod.SpecifiedPickupDirectory;
SmtpClient.PickupDirectoryLocation = HttpContext.Current.Server.MapPath("~/MessagesSent/"); 
```

有什么方法可以使用开发服务器来发送消息以便我可以测试它们？

**编辑：**或者还有其他方法可以测试在开发服务器上发送电子邮件吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-21T16:09:24.633

只需完全省略 .DeliveryMethod 和 .PickupDeliveryLocation 属性 - 您不应该只需要它们来发送消息。没有它们也行吗？

如果您的 IIS SMTP 服务器设置正确，可以在您的开发箱上发送邮件，那么没有它您应该没问题。此外，如果 IIS 无权访问该目录，这可能会导致错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T16:10:36.097

我的`~/MessagesSent/`不存在。这就是问题所在。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-02-21T16:09:01.763

所有版本的 Windows（NT，NT4 之后）都有 IIS 作为选项。因此，您可以使用安装在开发系统上的 IIS 副本来运行您的开发。

# browser - 您需要在浏览器中的哪些地方编写脚本？

> ID：573267
> 
> 赞同：0
> 
> 时间：2009-02-21T15:55:35.227
> 
> 标签：browser, scripting

浏览器，如 Elinks，支持脚本。你在哪里需要它？

**[澄清]**我的意思是用户需要在哪里编写自己的脚本。它必须做一些数据操作和提取。脚本可以帮助我变得更快吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T18:52:11.357

脚本允许页面包含可执行内容。这可以用于自定义渲染、交互（无需往返服务器），或者......发挥您的想象力。

# sas - 对于 SAS 数据集，防止锁定多用户访问的最佳方法是什么

> ID：573268
> 
> 赞同：5
> 
> 时间：2009-02-21T15:56:05.197
> 
> 标签：sas

感谢您阅读本文。

我在设置 libref 时使用共享服务 (server=sharedLib)，以允许我的 SAS/IntrNet 应用程序的用户修改和更新（添加新）单个数据集的记录。该应用程序还将用于查询我的数据集。为了最大限度地减少锁定，我只使用数据步骤来修改和更新，而不是使用 Proc SQL（锁定整个成员）。但是，我想知道如果仅更新/修改对数据的访问使用共享服务但查询不使用，锁定的可能性或多或少。

```
%if &type=QUERY %then %do ;
 LIBNAME lib '/myServer/library' ;
%end ;
%else %do ;
 LIBNAME lib '/myServer/library' server=shareLib ;
%end; 
```

这不是我的实际代码，但我确实知道请求是否只是将数据发回或修改现有记录或添加新记录（更新）；

我最初做出这种区分是因为我们在连接到共享服务时遇到了一些故障（不确定这是正确的术语），但是引用库来查询数据并没有失败。从那时起，我认为解决了这个问题，但我想知道我是否正在为问题做好准备。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-11T12:41:48.477

由于您的问题更像是对 SAS 中数据访问和并发性的一般建议的请求，因此我的回答将形成一般建议，而不是具体解决方案。

有优秀的 SAS 在线文档。请访问[索引](http://support.sas.com/documentation/index.html)，并找到相关信息以供您进一步阅读。

1.  请进一步查看 " `ACCESS=READONLY`" libname 选项。它几乎做到了它所说的，即将对 libname 中数据成员的访问限制为只读。这样做的好处是您不会在非更改查询期间意外更改数据。它还使 SAS 能够为数据更改查询留出一些空间，以便对数据进行更高级别的控制。
2.  SAS/SHARE 支持并发数据访问，因此如果您需要提供对相同数据的并发访问（读/写），SAS/SHARE 是一个不错的选择。这意味着您可以只分配一次 libname，为您的 libname 语句提供选项“ `SERVER=SHARELIB`”，并让 SAS/SHARE 管理并发数据访问。如果您将 libname 分配给您的 SAS/SHARE 服务器进程，则需要访问此 libname 的所有后续 SAS 进程只需分配 libname，例如`"LIBNAME LIB SERVER=SHARELIB"`（注意没有物理路径 - SAS/SHARE 服务器进程负责处理）。如果您的 SAS/SHARE 服务器有单独的 SAS 进程，此设置将发挥最佳作用。
3.  You can also lock your libname with the LOCK statement or the LOCK command. This means that your SAS program can ensure itself exclusive access rights to a libname, in case that's what you need. Other SAS processes can then use the lock command to query a specific libname and see if it can get (exclusive) access.
4.  You can also control access on the data member level. This is done with the CNTLLEV data set option. For example "`DATA LIB.MYDATA(CNTLLEV=LIB);`" specifies that access control is at the library level, restricting concurrent access to only one update process to the library. `CNTLLEV=MEM` and `CNTLLEV=REC` restricts concurrent access at member level and record level respectively.

These options can be combined in many different ways, giving a lot of room for you to make access as fine-grained as you need. I hope these choices will help you complete your task.

# c++ - Python C-API 对象分配

> ID：573275
> 
> 赞同：8
> 
> 时间：2009-02-21T16:01:45.680
> 
> 标签：c++, python, c, python-3.x, python-c-api

我想使用 new 和 delete 运算符来创建和销毁我的对象。

问题是python似乎把它分成了几个阶段。tp_new、tp_init 和 tp_alloc 用于创建，tp_del、tp_free 和 tp_dealloc 用于销毁。然而 c++ 只有 new 分配和完全构造对象和 delete 破坏和释放对象。

我需要提供哪些 python tp_* 方法，它们必须做什么？

我还希望能够直接在 C++ 中创建对象，例如“PyObject *obj = new MyExtensionObject(args);” 我是否还需要以某种方式重载 new 运算符来支持这一点？

我也希望能够在 python 中对我的扩展类型进行子类化，我需要做些什么来支持这一点吗？

我正在使用 python 3.0.1。

编辑：好的，tp_init 似乎使对象对于我正在做的事情来说有点太可变了（例如，获取一个 Texture 对象，在创建后更改内容很好，但是更改它的基本方面，例如大小、bitdept 等会破坏许多现有的 c++ 东西都假设这些东西是固定的）。如果我不实现它，它只会阻止人们在构造后调用 __init__ （或者至少忽略调用，就像元组一样）。或者，如果 tp_init 在同一个对象上被多次调用，我是否应该有一些引发异常或其他东西的标志？

除此之外，我想我已经把剩下的大部分都整理好了。

```
extern "C"
{
    //creation + destruction
    PyObject* global_alloc(PyTypeObject *type, Py_ssize_t items)
    {
        return (PyObject*)new char[type->tp_basicsize + items*type->tp_itemsize];
    }
    void global_free(void *mem)
    {
        delete[] (char*)mem;
    }
}
template<class T> class ExtensionType
{
    PyTypeObject *t;
    ExtensionType()
    {
        t = new PyTypeObject();//not sure on this one, what is the "correct" way to create an empty type object
        memset((void*)t, 0, sizeof(PyTypeObject));
        static PyVarObject init = {PyObject_HEAD_INIT, 0};
        *((PyObject*)t) = init;

        t->tp_basicsize = sizeof(T);
        t->tp_itemsize  = 0;

        t->tp_name = "unknown";

        t->tp_alloc   = (allocfunc) global_alloc;
        t->tp_free    = (freefunc)  global_free;
        t->tp_new     = (newfunc)   T::obj_new;
        t->tp_dealloc = (destructor)T::obj_dealloc;
        ...
    }
    ...bunch of methods for changing stuff...
    PyObject *Finalise()
    {
    ...
    }
};
template <class T> PyObjectExtension : public PyObject
{
...
    extern "C" static PyObject* obj_new(PyTypeObject *subtype, PyObject *args, PyObject *kwds)
    {
        void *mem = (void*)subtype->tp_alloc(subtype, 0);
        return (PyObject*)new(mem) T(args, kwds)
    }
    extern "C" static void obj_dealloc(PyObject *obj)
    {
        ~T();
        obj->ob_type->tp_free(obj);//most of the time this is global_free(obj)
    }
...
};
class MyObject : PyObjectExtension<MyObject>
{
public:
    static PyObject* InitType()
    {
        ExtensionType<MyObject> extType();
        ...sets other stuff...
        return extType.Finalise();
    }
    ...
}; 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-21T17:25:29.800

这些文档位于[http://docs.python.org/3.0/c-api/typeobj.html](http://docs.python.org/3.0/c-api/typeobj.html)和 [http://docs.python.org/3.0/extending/newtypes.html](http://docs.python.org/3.0/extending/newtypes.html)描述了如何制作自己的类型.

tp_alloc 为实例分配低级内存。这相当于 malloc()，加上将 refcnt 初始化为 1。Python 有它自己的分配器 PyType_GenericAlloc，但是一个类型可以实现一个专门的分配器。

tp_new 与 Python 的 __new__ 相同。与指向数据的指针相比，它通常用于数据存储在实例本身中的不可变对象。例如，字符串和元组将它们的数据存储在实例中，而不是使用 char * 或 PyTuple *。

对于这种情况，tp_new 根据输入参数计算出需要多少内存，并调用 tp_alloc 来获取内存，然后初始化基本字段。tp_new 不需要调用 tp_alloc。例如，它可以返回一个缓存的对象。

tp_init 与 Python 的 __init__ 相同。你的大部分初始化都应该在这个函数中。

__new__ 和 __init__ 之间的区别称为[两阶段初始化](http://groups.google.com/group/comp.lang.python/msg/e78840758484b94d)，或[两阶段初始化](http://groups.google.com/group/comp.lang.python/browse_thread/thread/b129dc656f4d0c8b/e43ae56909c3c00a?lnk=gst&q=two-phase+init#e43ae56909c3c00a)。

你说“ *c++ just has new* ”但这是不正确的。tp_alloc 对应 C++ 中的自定义 arena 分配器，__new__ 对应自定义类型分配器（工厂函数），__init__ 更像是构造函数。最后一个链接更多地讨论了 C++ 和 Python 风格之间的相似之处。

Also read [http://www.python.org/download/releases/2.2/descrintro/](http://www.python.org/download/releases/2.2/descrintro/) for details about how __new__ and __init__ interact.

You write that you want to "create the object directly in c++". That's rather difficult because at the least you'll have to convert any Python exceptions that occurred during object instantiation into a C++ exception. You might try looking at Boost::Python for some help with this task. Or you can use a two-phase initialization. ;)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T16:16:58.857

我根本不知道python API，但是如果python 将分配和初始化分开，您应该可以使用placement new。

例如：

```
 // tp_alloc
 void *buffer = new char[sizeof(MyExtensionObject)];
 // tp_init or tp_new (not sure what the distinction is there)
 new (buffer) MyExtensionObject(args);
 return static_cast<MyExtensionObject*>(buffer);

 ...
 // tp_del
 myExtensionObject->~MyExtensionObject(); // call dtor
 // tp_dealloc (or tp_free? again I don't know the python apis)
 delete [] (static_cast<char*>(static_cast<void*>(myExtensionObject))); 
```

# php - 扩展 Drupal

> ID：573276
> 
> 赞同：15
> 
> 时间：2009-02-21T16:02:53.493
> 
> 标签：php, mysql, performance, drupal

我在一个基于 Drupal 的站点上工作，注意到有很多单独的 CSS 和 js 文件。通过一些代码，我还可以看到很多使用许多查询的情况。

您尝试过哪些技术来提高 Drupal 的性能，以及您使用哪些模块（如果有）来“开箱即用”地提高 Drupal 的性能？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-22T00:18:07.110

转到 admin/settings/performance 页面，打开 CSS 和 JS 聚合，以及最短生命周期为 1 分钟的页面缓存，将立即为您在高流量站点上提供支持。如果您正在编写自己的代码并进行任何查询，请考虑为昂贵的函数编写自己的离散[缓存](http://www.lullabot.com/articles/a_beginners_guide_to_caching_data)。链接的文章涵盖了 Drupal 5，而不是 6，但 d6 中唯一的变化是消除了序列化要求以及 cache_set() 和 cache_get() 函数的函数签名。（均在文章评论中注明）

在大型站点上，还可以考虑将 memcached 服务器放到网络上：使用[memcached](http://drupal.org/project/memcache)模块，您可以完全绕过 drupal 数据库来获取缓存数据。如果你有大量的内容并且搜索是一个热点，你也可以考虑使用 lucene/solr 作为你的搜索索引器，而不是 drupal 的内置搜索索引器。对于内置索引器来说这很好，但它不是为繁重的负载而设计的（例如，每小时有数百或数千条新内容，具有繁重的多面搜索）。[apache solr](http://drupal.org/project/apachesolr)模块可以与之配合。

如果您大量使用视图，请确保您检查了它为未索引字段生成的查询；特别是按 CCK 字段进行排序和过滤可能会很慢，因为 CCK 不会自动添加超出主键的索引。在 D6 中，在管理屏幕中预览视图，复制查询文本，然后通过 mysql 中的 EXPLAIN 或您拥有的任何查询分析工具运行它。

YSlow 和 Firebug 之类的工具还可以帮助您发现缓慢的内容，例如大量图像文件、托管在远程服务器上的 JS 等等。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-21T16:22:31.433

Drupal 6，开箱即用，提供 css 和 javascript 聚合 --- 大多数 css 和 js 文件将组合成一个文件（因此是一个 HTTP 请求），并且还缩短了空格（以减少带宽消耗）。您可以在 /admin/settings/performance 下启用此功能。

该屏幕上还有 Drupal（非常有效）缓存的控件，这有助于减少数据库查询的数量。

此外，由于 Drupal（以及您可能已经安装的所有模块）拥有大量 PHP 源代码，因此使用[APC](http://pecl.php.net/package/APC)等 PHP 操作码缓存有助于显着减少请求时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-29T03:47:07.570

我强烈支持 Benedict 对 Boost 模块的建议——如果配置正确，它本身就可以让您的网站在共享主机上运行，​​并且根本不会出现问题。

开启 CSS/JS 聚合，开启 Boost，你的网站对于匿名用户来说表现非常好。

If your site deals with mostly logged-in users, you're going to have to do a lot more work making sure sessions are cached well, and probably consider using memcached and more SQL query caching.

The biggest performance gains always come from caching—but monitoring and adjusting your slow queries, monitoring and adjusting apache and PHP configurations, and being smart about the modules you use are very important as well.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-13T06:40:18.943

Other than the drupal default cache , there are some another method to increase the performance

Boost module is one of the best. memcache, Varnish(Drupal 7/Pressflow), CDN are the another methods that can improve the performance

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-04-23T01:41:16.257

It's also worth mentioning the performance boost from using quality SSD storage. It has consistently cut my initial response load times by 30% or more when migrating to SSD (I went from about ~450ms to ~250ms on my last project, using identical Apache/Memcache/Cloudfront EC2 configs), not to mention how much nicer it is to manage a snappy server where every command or script you throw at it is nearly instantaneous. I will never go back.

# rest - REST 和 RESTful - 视频或播客

> ID：573285
> 
> 赞同：9
> 
> 时间：2009-02-21T16:07:24.327
> 
> 标签：rest

我正在寻找有关 REST 和 RESTful 的播客或视频。

理想情况下，它们应该涵盖基础知识和更高级的主题

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-21T17:01:15.133

它简短且非常基础，但请查看[GoogleDeveloper](http://www.youtube.com/user/GoogleDevelopers)频道的[Intro to REST 。](http://www.youtube.com/watch?v=YCcAE2SCQ6k)

对于播客，请查看 ThoughtWorks IT Matter 播客~~[REST - 第 1 部分，共 2](http://podcast.thoughtworks.com/itmatters/thoughtworks_004_REST_01.m4a)~~部分和~~[REST - 第 2 部分，共 2 部分](http://podcast.thoughtworks.com/itmatters/thoughtworks_004_REST_02.m4a)~~（音频链接断开；摘要仍在[此处](http://www.thoughtworks.com/what-we-say/podcasts.html)），其中 Martin Fowler、Chris Stevenson、Jim Webber 和 Sriram Narayan 谈论 REST。

此外，还有来自[软件工程电台的“](http://www.se-radio.net/) [Stefan Tilkov on REST](http://www.se-radio.net/podcast/2008-05/episode-98-stefan-tilkov-rest) ”，也许还有“ [Web Services with Olaf Zimmermann](http://www.se-radio.net/podcast/2008-02/episode-85-web-services-olaf-zimmermann) ” 。

[RestWiki](http://rest.blueoxen.net/cgi-bin/wiki.pl)上可能有适合您的内容，而[REST 维基百科文章](http://en.wikipedia.org/wiki/Representational_State_Transfer)有很多链接可供您访问以获取更多材料。

我最近偶然发现了[Intertech的“](http://www.intertech.com/) [RESTful Web Services](http://www.youtube.com/view_play_list?p=F678FD2E7711FF9E) ”视频课程，但还没有查看。YMMV。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-21T17:02:37.720

这是一篇相当有趣的文章。恐怕它不是视频或播客，但认为它可能有用。

[我如何向妻子解释 REST](http://tomayko.com/writings/rest-to-my-wife)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-21T16:30:47.110

对于基础知识，这是一个很好的：[了解 REST](http://www.internet.com/video/?bcpid=1431564240&bclid=1433966034&bctid=1788889483)

您可以通过搜索 REST 找到一些 MIX[会话](http://sessions.visitmix.com/)，但其中大多数是基于 WCF 或数据服务的。

Thoughtworks 也有一个关于 REST 的播客，你可以从[这里](http://jim.webber.name/2008/03/23/b4309893-7047-47f9-babc-f841d7f0d8f7.aspx)获得..

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-21T19:20:18.543

[这](http://www.infoq.com/presentations/qcon-tilkov-rest-intro)是 Stefan Tilkov 的一个和Alan Dean 的[另一个](http://alandean.blogspot.com/2009/01/video-of-rest-at-ddd7.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-21T16:50:34.143

如果您有兴趣将 REST 与 WCF 和 .NET 一起使用，我会推荐[Endpoint.TV](http://channel9.msdn.com/shows/Endpoint/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-31T14:37:36.703

infoq 的另外两篇文章： 1\. [A Brief Introduction to REST](http://www.infoq.com/articles/rest-introduction) 2\. [REST Anti-Patterns](http://www.infoq.com/articles/rest-anti-patterns)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-24T20:55:04.037

只需阅读菲尔丁的[论文](http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm)和他的[博客](http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven)。他的博客澄清了对 REST 的一些常见误解。当心其他不使用权威来源的 REST 信息 - 那里存在大量错误信息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-10T19:02:26.387

嗨，Jonathan Benedicto有一个关于如何在[Delphi 应用程序](https://members.embarcadero.com/login.aspx?returnURL=http://cc.embarcadero.com/download.aspx?id=27274)中使用 REST 的精彩视频

> Web 应用程序的 DataSnap REST 支持 本演示文稿介绍了如何为 Web 应用程序使用新的 DataSnap REST 支持。

这是 Marco Cantù 的视频链接，其中包含一些不错的[delphi 示例](http://cc.embarcadero.com/download.aspx?id=27318)休息客户端

> Delphi 中的 10 个 REST 客户端 从 Google 到 Amazon，从 Microsoft 到 Yahoo，从 Facebook 到 Twitter，大多数大型网站都提供 REST API，Delphi 可以轻松查询所有这些客户端。本次会议概述了 10 个 REST 客户端 API，展示了如何集成数据库数据和 Web 应用程序。在 Delphi 中创建 Windows 7 应用程序，自 Delphi 2007 以来，对 Windows 操作系统的新功能的支持得到了改进，从 Windows Vista 到 Windows 7。在本次会议中，我们将探索 VCL 的一些本机功能和一些额外的 API您可以使用。

这两个视频都来自[代码狂暴4](http://conferences.embarcadero.com/coderage/sessions)

# c++ - 何时使用 reinterpret_cast？

> ID：573294
> 
> 赞同：550
> 
> 时间：2009-02-21T16:12:39.960
> 
> 标签：c++, casting, reinterpret-cast

我对`reinterpret_cast`vs的适用性有点困惑`static_cast`。从我读过的内容来看，一般规则是在编译时可以解释类型时使用静态强制转换，因此使用`static`. 这也是 C++ 编译器在内部用于隐式转换的转换。

`reinterpret_cast`s适用于两种场景：

*   将整数类型转换为指针类型，反之亦然
*   将一种指针类型转换为另一种。我得到的一般想法是这是不可移植的，应该避免。

我有点困惑的是我需要的一种用法，我从 C 调用 C++，并且 C 代码需要保留 C++ 对象，所以基本上它包含一个`void*`. 应该使用什么类型转换来在 the`void *`和 Class 类型之间进行转换？

我见过两者的用法`static_cast`和`reinterpret_cast`？虽然从我一直在阅读的内容来看，它似乎`static`更好，因为演员可以在编译时发生？虽然它说用于`reinterpret_cast`从一种指针类型转换为另一种？

* * *

## 回答 #1

> 赞同：519
> 
> 时间：2009-02-21T16:42:12.010

C++ 标准保证以下内容：

`static_cast`指向和返回的指针会`void*`保留地址。也就是说，在下面，`a`和`b`都`c`指向同一个地址：

```
int* a = new int();
void* b = static_cast<void*>(a);
int* c = static_cast<int*>(b); 
```

`reinterpret_cast`仅保证如果您将指针转换为不同的类型，*然后将`reinterpret_cast`其返回到原始类型*，您将获得原始值。所以在下面：

```
int* a = new int();
void* b = reinterpret_cast<void*>(a);
int* c = reinterpret_cast<int*>(b); 
```

`a`并且`c`包含相同的值，但未`b`指定的值。（实际上，它通常包含与 和 相同的地址`a`，`c`但标准中没有指定，并且在具有更复杂内存系统的机器上可能不是这样。）

对于从 的转换`void*`，`static_cast`应该是首选。

* * *

## 回答 #2

> 赞同：184
> 
> 时间：2009-02-21T19:06:14.473

一种`reinterpret_cast`必要的情况是与不透明数据类型交互时。这经常发生在程序员无法控制的供应商 API 中。这是一个人为的示例，其中供应商提供了一个用于存储和检索任意全局数据的 API：

```
// vendor.hpp
typedef struct _Opaque * VendorGlobalUserData;
void VendorSetUserData(VendorGlobalUserData p);
VendorGlobalUserData VendorGetUserData(); 
```

要使用这个 API，程序员必须将他们的数据`VendorGlobalUserData`来回转换。 `static_cast`行不通，必须使用`reinterpret_cast`：

```
// main.cpp
#include "vendor.hpp"
#include <iostream>
using namespace std;

struct MyUserData {
    MyUserData() : m(42) {}
    int m;
};

int main() {
    MyUserData u;

        // store global data
    VendorGlobalUserData d1;
//  d1 = &u;                                          // compile error
//  d1 = static_cast<VendorGlobalUserData>(&u);       // compile error
    d1 = reinterpret_cast<VendorGlobalUserData>(&u);  // ok
    VendorSetUserData(d1);

        // do other stuff...

        // retrieve global data
    VendorGlobalUserData d2 = VendorGetUserData();
    MyUserData * p = 0;
//  p = d2;                                           // compile error
//  p = static_cast<MyUserData *>(d2);                // compile error
    p = reinterpret_cast<MyUserData *>(d2);           // ok

    if (p) { cout << p->m << endl; }
    return 0;
} 
```

下面是示例 API 的人为实现：

```
// vendor.cpp
static VendorGlobalUserData g = 0;
void VendorSetUserData(VendorGlobalUserData p) { g = p; }
VendorGlobalUserData VendorGetUserData() { return g; } 
```

* * *

## 回答 #3

> 赞同：155
> 
> 时间：2017-04-07T08:58:07.223

**简短的回答：** 如果您不知道`reinterpret_cast`代表什么，请不要使用它。如果你将来需要它，你会知道的。

**完整答案：**

让我们考虑基本的数字类型。

`int(12)`例如，当您转换为`unsigned float (12.0f)`处理器时，需要调用一些计算，因为这两个数字具有不同的位表示。这就是**`static_cast`**代表。

另一方面，当您调用**`reinterpret_cast`**CPU 时不会调用任何计算。它只是将内存中的一组位视为具有另一种类型。因此，当您使用此关键字转换`int*`为时`float*`，新值（在指针取消引用之后）与数学意义上的旧值无关。

***示例：***由于一个原因，它确实`reinterpret_cast`不可移植 - 字节顺序（字节序）。但这通常是使用它的最佳理由。让我们想象一下这个例子：你必须从文件中读取二进制 32 位数字，并且你知道它是大端。您的代码必须是通用的，并且可以在大端（例如某些 ARM）和小端（例如 x86）系统上正常工作。所以你必须检查字节顺序。~~它在编译时是众所周知的，因此您可以编写`constexpr`函数：~~您可以编写一个函数来实现这一点：

```
/*constexpr*/ bool is_little_endian() {
  std::uint16_t x=0x0001;
  auto p = reinterpret_cast<std::uint8_t*>(&x);
  return *p != 0;
} 
```

***说明：***内存中的二进制表示`x`可以是`0000'0000'0000'0001`（大）或`0000'0001'0000'0000`（小端）。在重新解释转换后，`p`指针下的字节可以分别是`0000'0000`或`0000'0001`。`0000'0001`如果您使用静态转换，无论使用什么字节序，它都将始终为

**编辑：**

[*在第一个版本中，我将示例函数`is_little_endian`设为`constexpr`. 它在最新的 gcc (8.3.0) 上编译得很好，但标准说它是非法的。clang 编译器拒绝编译它（这是正确的）。*]

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-02-21T16:38:15.530

`reinterpret_cast`C++ 标准没有定义的含义。因此，理论上 a`reinterpret_cast`可能会使您的程序崩溃。在实践中，编译器会尝试做你期望的事情，即解释你传入的内容，就好像它们是你要转换的类型一样。如果您知道要使用的编译器做什么，`reinterpret_cast` 您可以使用它，但说它是*可移植*的将是在撒谎。

对于您描述的情况，以及您可能考虑的几乎任何情况`reinterpret_cast`，您可以使用`static_cast`或其他替代方法。除其他事项外，该标准还说明了您可以期待的内容`static_cast`（第 5.2.9 节）：

> “指向 cv void 的指针”类型的右值可以显式转换为指向对象类型的指针。指向对象的指针类型的值转换为“指向 cv void 的指针”并返回到原始指针类型将具有其原始值。

因此，对于您的用例，标准化委员会打算让您使用`static_cast`.

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-01-12T16:54:06.553

reinterpret_cast 的一种用途是，如果您想对 (IEEE 754) 浮点数应用按位运算。一个例子是快速平方根逆技巧：

[https://en.wikipedia.org/wiki/Fast_inverse_square_root#Overview_of_the_code](https://en.wikipedia.org/wiki/Fast_inverse_square_root#Overview_of_the_code)

它将浮点数的二进制表示视为整数，将其右移并从常数中减去，从而将指数减半并取反。转换回浮点数后，对其进行 Newton-Raphson 迭代以使该近似值更精确：

```
float Q_rsqrt( float number )
{
    long i;
    float x2, y;
    const float threehalfs = 1.5F;

    x2 = number * 0.5F;
    y  = number;
    i  = * ( long * ) &y;                       // evil floating point bit level hacking
    i  = 0x5f3759df - ( i >> 1 );               // what the deuce? 
    y  = * ( float * ) &i;
    y  = y * ( threehalfs - ( x2 * y * y ) );   // 1st iteration
//  y  = y * ( threehalfs - ( x2 * y * y ) );   // 2nd iteration, this can be removed

    return y;
} 
```

这最初是用 C 编写的，因此使用 C 转换，但类似的 C++ 转换是 reinterpret_cast。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-10-23T20:06:26.623

这是 Avi Ginsburg 程序的一个变体，它清楚地说明了`reinterpret_cast`Chris Luengo、flodin 和 cmdLP 提到的属性：编译器将指向的内存位置视为新类型的对象：

```
#include <iostream>
#include <string>
#include <iomanip>
using namespace std;

class A
{
public:
    int i;
};

class B : public A
{
public:
    virtual void f() {}
};

int main()
{
    string s;
    B b;
    b.i = 0;
    A* as = static_cast<A*>(&b);
    A* ar = reinterpret_cast<A*>(&b);
    B* c = reinterpret_cast<B*>(ar);

    cout << "as->i = " << hex << setfill('0')  << as->i << "\n";
    cout << "ar->i = " << ar->i << "\n";
    cout << "b.i   = " << b.i << "\n";
    cout << "c->i  = " << c->i << "\n";
    cout << "\n";
    cout << "&(as->i) = " << &(as->i) << "\n";
    cout << "&(ar->i) = " << &(ar->i) << "\n";
    cout << "&(b.i) = " << &(b.i) << "\n";
    cout << "&(c->i) = " << &(c->i) << "\n";
    cout << "\n";
    cout << "&b = " << &b << "\n";
    cout << "as = " << as << "\n";
    cout << "ar = " << ar << "\n";
    cout << "c  = " << c  << "\n";

    cout << "Press ENTER to exit.\n";
    getline(cin,s);
} 
```

这导致输出如下：

```
as->i = 0
ar->i = 50ee64
b.i   = 0
c->i  = 0

&(as->i) = 00EFF978
&(ar->i) = 00EFF974
&(b.i)   = 00EFF978
&(c->i)  = 00EFF978

&b = 00EFF974
as = 00EFF978
ar = 00EFF974
c  = 00EFF974
Press ENTER to exit. 
```

可以看出，B 对象首先作为 B 特定数据构建在内存中，其次是嵌入的 A 对象。`static_cast`正确返回嵌入的 A 对象的地址，并且创建的指针正确`static_cast`地给出了数据字段的值。生成的指针`reinterpret_cast`将`b`的内存位置视为普通 A 对象，因此当指针尝试获取数据字段时，它会返回一些特定于 B 的数据，就好像它是该字段的内容一样。

一种用途`reinterpret_cast`是将指针转换为无符号整数（当指针和无符号整数大小相同时）：

`int i;` `unsigned int u = reinterpret_cast<unsigned int>(&i);`

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-10-29T17:12:47.023

您可以使用 reinterprete_cast 在编译时检查继承。
看这里： [使用 reinterpret_cast 在编译时检查继承](https://stackoverflow.com/questions/26649987/using-reinterpret-cast-to-check-inheritance-at-compile-time)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-01-18T14:38:38.570

```
template <class outType, class inType>
outType safe_cast(inType pointer)
{
    void* temp = static_cast<void*>(pointer);
    return static_cast<outType>(temp);
} 
```

我试图总结并使用模板编写了一个简单的安全演员表。请注意，此解决方案不保证在函数上转换指针。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-02-23T12:10:27.070

首先，您在此处有一些特定类型的数据，例如 int：

```
int x = 0x7fffffff://==nan in binary representation 
```

然后您想访问与其他类型（如 float）相同的变量：您可以在

```
float y = reinterpret_cast<float&>(x);

//this could only be used in cpp, looks like a function with template-parameters 
```

或者

```
float y = *(float*)&(x);

//this could be used in c and cpp 
```

简而言之：这意味着相同的内存被用作不同的类型。因此，您可以将浮点数的二进制表示形式转换为像上面那样的 int 类型的浮点数。例如，0x80000000 为 -0（尾数和指数为空，但符号 msb 为一。这也适用于双精度数和长双精度数。

优化：我认为 reinterpret_cast 将在许多编译器中进行优化，而 c-casting 是通过指针算术进行的（必须将值复制到内存中，因为指针无法指向 cpu- 寄存器）。

注意：在这两种情况下，您都应该在转换前将转换的值保存在变量中！这个宏可以帮助：

```
#define asvar(x) ({decltype(x) __tmp__ = (x); __tmp__; }) 
```

* * *

## 回答 #10

> 赞同：-8
> 
> 时间：2016-11-10T08:49:01.823

快速回答：`static_cast`如果编译则使用，否则使用`reinterpret_cast`.

* * *

## 回答 #11

> 赞同：-19
> 
> 时间：2009-02-21T16:31:02.333

阅读[常见问题解答](http://www.parashift.com/c++-faq-lite/mixing-c-and-cpp.html)！在 C 中保存 C++ 数据可能是有风险的。

在 C++ 中，指向对象的指针可以在`void *`不进行任何强制转换的情况下转换为。但反过来就不是这样了。您需要 a`static_cast`来取回原始指针。

# google-maps - 在谷歌地图中覆盖地理标记的照片？

> ID：573301
> 
> 赞同：1
> 
> 时间：2009-02-21T16:17:41.790
> 
> 标签：google-maps

我想用用户上传的带有地理标记的照片创建一个谷歌地图，这些照片显示在我的地图上。我可以轻松地创建操纵我的地图，但我似乎无法找到有关如何添加这些地理标记照片的说明。

这是我尝试完成的示例： [http ://maps.google.com/?ie=UTF8&ll=26.892794,-80.055909&spn=0.003875,0.004828&t=h&z=18&lci=lmc:panoramio](http://maps.google.com/?ie=UTF8&ll=26.892794,-80.055909&spn=0.003875,0.004828&t=h&z=18&lci=lmc:panoramio)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T16:40:06.227

我没有处理照片的经验，但我认为这与将 GMarker 放置在地图上照片的适当坐标处，然后在标签的信息窗口中输出你的包含您的照片的自定义 HTML。

编辑：指向 Google Maps API 参考中的 GMarker 类的特定链接：[http ://code.google.com/apis/maps/documentation/reference.html#GMarker](http://code.google.com/apis/maps/documentation/reference.html#GMarker)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T16:41:54.960

您需要创建一个图块，然后创建一个图块叠加层。

```
var tilelayer = new GTileLayer(myCopyright);
tilelayer.getTileUrl = function() { return "../include/tile_crosshairs.png"; };
tilelayer.isPng = function() { return true;};
tilelayer.getOpacity = function() { return 1.0; }

var myTileLayer = new GTileLayerOverlay(tilelayer);
var map = new GMap2(document.getElementById("map_canvas"));
map.setCenter(new GLatLng(37.4419, -122.1419), 13);
map.addOverlay(myTileLayer); 
```

[文档在这里](http://code.google.com/apis/maps/documentation/overlays.html#Tile_Overlays)，这里有一个[很棒的示例地图](http://code.google.com/apis/maps/documentation/examples/tileoverlay-simple.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-24T20:32:09.360

您可以使用 PHP（或其他脚本）创建 KML 或 GeoRSS 文件（很像 Flickr 的 KML 和 GeoRSS 提要），并让 Google Maps API 函数 GGeoXML 将文件加载为地图上的叠加层。在此处查看 Google 的示例代码：[http ://code.google.com/apis/maps/documentation/examples/geoxml-rss.html](http://code.google.com/apis/maps/documentation/examples/geoxml-rss.html)

该示例实际上是从 Flickr 加载实时 GeoRSS 提要。

# html - 如何在 ASP.NET MVC 中获取模型状态错误的集合？

> ID：573302
> 
> 赞同：150
> 
> 时间：2009-02-21T16:17:50.493
> 
> 标签：html, asp.net-mvc, validation, spark-view-engine

如何获取视图中的错误集合？

我不想使用 Html Helper Validation Summary 或 Validation Message。相反，我想检查错误，如果有的话以特定格式显示。同样在输入控件上，我想检查特定的属性错误并向输入添加一个类。

PS 我使用的是 Spark View Engine，但想法应该是一样的。

所以我想我可以做类似的事情......

```
<if condition="${ModelState.Errors.Count > 0}">
  DisplayErrorSummary()
</if>

....and also...

<input type="text" value="${Model.Name}" 
       class="?{ModelState.Errors["Name"] != string.empty} error" />

.... 
```

或类似的东西。

**更新**

我的最终解决方案如下所示：

```
<input type="text" value="${ViewData.Model.Name}" 
       class="text error?{!ViewData.ModelState.IsValid && 
                           ViewData.ModelState["Name"].Errors.Count() > 0}" 
       id="Name" name="Name" /> 
```

如果此属性有错误，这只会添加错误 css 类。

* * *

## 回答 #1

> 赞同：216
> 
> 时间：2009-02-21T16:21:12.343

```
<% ViewData.ModelState.IsValid %> 
```

或者

```
<% ViewData.ModelState.Values.Any(x => x.Errors.Count >= 1) %> 
```

对于特定的属性...

```
<% ViewData.ModelState["Property"].Errors %> // Note this returns a collection 
```

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2010-08-11T14:46:03.187

要从 ModelState 中获取错误，请使用以下 Linq：

```
var modelStateErrors = this.ModelState.Keys.SelectMany(key => this.ModelState[key].Errors); 
```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2014-01-08T22:51:54.727

[@ChrisMcKenzie 答案](https://stackoverflow.com/a/3459569/62600)的精简版：

```
var modelStateErrors = this.ModelState.Values.SelectMany(m => m.Errors); 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2014-03-10T16:18:04.557

这将为您提供一个字符串，其中包含逗号分隔的所有错误

```
string validationErrors = string.Join(",",
                    ModelState.Values.Where(E => E.Errors.Count > 0)
                    .SelectMany(E => E.Errors)
                    .Select(E => E.ErrorMessage)
                    .ToArray()); 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2017-05-31T17:12:29.243

将上面的几个答案放在一起，这就是我最终使用的：

```
var validationErrors = ModelState.Values.Where(E => E.Errors.Count > 0)
    .SelectMany(E => E.Errors)
    .Select(E => E.ErrorMessage)
    .ToList(); 
```

`validationErrors`最终成为`List<string>`包含每个错误消息的 a 。从那里，很容易用那个列表做你想做的事。

[![在此处输入图像描述](https://i.stack.imgur.com/RYwes.png)](https://i.stack.imgur.com/RYwes.png)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-06-16T11:46:57.637

谢谢乍得！为了显示与密钥相关的所有错误，这就是我想出的。由于某种原因，基本 Html.ValidationMessage 帮助程序仅显示与键关联的第一个错误。

```
 <%= Html.ShowAllErrors(mykey) %> 
```

HtmlHelper：

```
 public static String ShowAllErrors(this HtmlHelper helper, String key) {
        StringBuilder sb = new StringBuilder();
        if (helper.ViewData.ModelState[key] != null) {
            foreach (var e in helper.ViewData.ModelState[key].Errors) {
                TagBuilder div = new TagBuilder("div");
                div.MergeAttribute("class", "field-validation-error");
                div.SetInnerText(e.ErrorMessage);
                sb.Append(div.ToString());
            }
        }
        return sb.ToString();
    } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-02-12T14:43:44.800

这里是VB。

```
Dim validationErrors As String = String.Join(",", ModelState.Values.Where(Function(E) E.Errors.Count > 0).SelectMany(Function(E) E.Errors).[Select](Function(E) E.ErrorMessage).ToArray()) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-10-23T13:00:28.830

如果您不知道导致错误的属性，您可以使用反射循环所有属性：

```
public static String ShowAllErrors<T>(this HtmlHelper helper) {
    StringBuilder sb = new StringBuilder();
    Type myType = typeof(T);
    PropertyInfo[] propInfo = myType.GetProperties();

    foreach (PropertyInfo prop in propInfo) {
        foreach (var e in helper.ViewData.ModelState[prop.Name].Errors) {
            TagBuilder div = new TagBuilder("div");
            div.MergeAttribute("class", "field-validation-error");
            div.SetInnerText(e.ErrorMessage);
            sb.Append(div.ToString());
        }
    }
    return sb.ToString();
} 
```

其中 T 是您的“ViewModel”的类型。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-10-27T09:37:28.157

从对我有用的 BrockAllen 的回答中得到了这个，它显示了有错误的键：

```
 var errors =
    from item in ModelState
    where item.Value.Errors.Count > 0
    select item.Key;
    var keys = errors.ToArray(); 
```

来源：[https ://forums.asp.net/t/1805163.aspx?Get+the+Key+value+of+the+Model+error](https://forums.asp.net/t/1805163.aspx?Get%20the%20Key%20value%20of%20the%20Model%20error)

# apache-flex - 在 flex 应用程序中包含外部 actionscript 文件的最佳实践是什么

> ID：573305
> 
> 赞同：1
> 
> 时间：2009-02-21T16:19:24.623
> 
> 标签：apache-flex, class, actionscript, include

如果我在 flex mxml 文件中包含一个外部动作脚本文件，我会在编译时根据使用的方法获得不同的行为。使用带有源属性或包含语句的 mx 脚本标记，然后编译文件会产生如下错误：

错误：包不能嵌套。

如果使用 import 这些错误消失并且文件编译但是在尝试实例化类时我遇到了问题。

```
 import lib.journal;
    public var testing:journal = new journal();
    testing.init(); 
```

这使：

错误：访问未定义的属性测试。

谁能解释这里发生了什么？包含文件而不是导入它对包和范围有什么影响？

谢谢，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T17:16:16.093

回答更一般的问题：导入是包含外部文件的首选方式。在我看来，该`include`语句应该只在没有其他方法的情况下使用，因为如果出现问题，它会使调试变得更加困难，并且通常会使代码更难阅读和理解。阿萨夫对做什么`import`和`include`做什么的描述是正确的。

然后对于您似乎遇到的更具体的问题：您可能正在尝试 `testing.init();`在块中做正确的事情`<script>`-尝试将其放入方法中。您应该只`import`在脚本块中直接包含语句和成员声明（变量、函数）之类的内容，以及在函数中包含这样的语句。

您会看到该错误消息，因为当您调用`init()`此对象的方法时，它尚未创建——当您的 MXML 文件所代表的类的定义被加载时，该语句将被执行；您想要的是在创建此类的特定实例时执行它，并且您可以通过在类的构造函数中调用它来执行此操作（据我所知，这在您编写时是不可能的使用 MXML 的类，请继续阅读：）或例如在`FlexEvent.CREATION_COMPLETE`（或`creationComplete`根据 MXML 标记属性）事件的处理函数中（参见下面的示例。）

尝试这样的事情：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application 
    xmlns:mx="http://www.adobe.com/2006/mxml"
    width="800" height="600"
    creationComplete="creationCompleteHandler();"
>
    <mx:Script>
        <![CDATA[

        import lib.Journal;

        public var testing:Journal = new Journal();

        private function creationCompleteHandler():void
        {
            testing.init();
        }

        ]]>
    </mx:Script>

</mx:Application> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T16:44:14.503

Import 允许您访问导入文件的公共声明。

包含将 as3 文件的内容植入到包含位置*，就像您在那里键入它一样*。

请参阅“[比较、包含和导入 ActionScript 代码](http://livedocs.adobe.com/flex/3/html/help.html?content=usingas_4.html)”手册。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-22T19:44:44.530

试试这个：

```
<mx:Script>
    <![CDATA[

    import lib.Journal;

    public var testing:Journal;

    private function creationCompleteHandler():void
    {
        testing = new Journal();
    }

    ]]>
</mx:Script> 
```

干杯，德克

# linq-to-sql - LINQ to SQL：插入非标识主键

> ID：573306
> 
> 赞同：1
> 
> 时间：2009-02-21T16:20:01.830
> 
> 标签：linq-to-sql

我第一次在一个小项目中使用 LINQ to SQL。我的表的主键不是标识列，因为我本质上是从另一个数据库导入的。该关系是带有链接表的多对多关系。如果插入是重复的，有没有办法告诉 LINQ 忽略插入？

如果对象存在，我已经尝试检查当前表，如果存在，则跳到下一个，但由于关系，这很困难。

如有必要，我可以提供更多详细信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T16:24:44.767

您可以做的是 Any 查询，而不是查询整个对象...

```
DB.Items.Any(i => i.ID == myObj.ID); 
```

这将执行优化查询以检查它是否首先存在。

至于让 LINQ to SQL 为您处理这个问题，我很确定它不能。

# php - 如何替换 cakephp 密码哈希算法？

> ID：573307
> 
> 赞同：6
> 
> 时间：2009-02-21T16:20:22.377
> 
> 标签：php, authentication, cakephp, crypt

我有一个现有的数据库，我试图在上面放置一个蛋糕应用程序。旧应用程序在 Perl 中使用 crypt() 来散列密码。我需要在 PHP 应用程序中做同样的事情。

在标准 cakephp 应用程序中进行更改的正确位置在哪里？这样的变化会是什么样子？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-21T23:35:57.307

我让它工作...

这是我的 AppController：

```
class AppController extends Controller {
    var $components = array('Auth');

    function beforeFilter() {
        // this is part of cake that serves up static pages, it should be authorized by default
        $this->Auth->allow('display');
        // tell cake to look on the user model itself for the password hashing function
        $this->Auth->authenticate = ClassRegistry::init('User');
        // tell cake where our credentials are on the User entity
        $this->Auth->fields = array(
           'username' => 'user',
           'password' => 'pass',
        );
        // this is where we want to go after a login... we'll want to make this dynamic at some point
        $this->Auth->loginRedirect = array('controller'=>'users', 'action'=>'index');
    }
} 
```

然后是用户：

```
<?php
class User extends AppModel {
    var $name = 'User';

    // this is used by the auth component to turn the password into its hash before comparing with the DB
    function hashPasswords($data) {
         $data['User']['pass'] = crypt($data['User']['pass'], substr($data['User']['user'], 0, 2));
         return $data;
    }
}
?> 
```

其他都正常，我觉得。

这是一个很好的资源：[http ://teknoid.wordpress.com/2008/10/08/demystifying-auth-features-in-cakephp-12/](http://teknoid.wordpress.com/2008/10/08/demystifying-auth-features-in-cakephp-12/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-02T22:17:12.107

实际上，上面描述的 danb 方法在 CakePHP 2.x 中对我不起作用相反，我最终创建了一个自定义身份验证组件来绕过标准哈希算法：

/app/Controller/Component/Auth/CustomFormAuthenticate.php

```
<?php
App::uses('FormAuthenticate', 'Controller/Component/Auth');

class CustomFormAuthenticate extends FormAuthenticate {

    protected function _password($password) {
        return self::hash($password);
    }

    public static function hash($password) {
        // Manipulate $password, hash, custom hash, whatever
        return $password;
    }
} 
```

...然后在我的控制器中使用它...

```
public $components = array(
    'Session',
    'Auth' => array(
        'authenticate' => array(
            'CustomForm' => array(
                'userModel' => 'Admin'
            )
        )
    )
); 
```

最后一个块也可以放在*AppController的**beforeFilter*方法中。在我的情况下，我只是选择将它专门放在一个控制器中，在该控制器中我将使用具有不同用户模型的自定义身份验证。

 ** * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-10-21T07:31:30.947

为了在 CakePHP 2.4.1 中跟进这一点，我正在为遗留数据库构建一个前端，该数据库将现有用户密码存储为 md5(accountnumber:statictext:password)，并允许用户登录，我们需要使用该散列系统也是如此。

解决方案是：

使用以下命令创建文件 app/Controller/Component/Auth/CustomAuthenticate.php：

```
<?php
App::uses('FormAuthenticate', 'Controller/Component/Auth');

class CustomAuthenticate extends FormAuthenticate {

    protected function _findUser($username, $password = null) {
        $userModel = $this->settings['userModel'];
        list(, $model) = pluginSplit($userModel);
        $fields = $this->settings['fields'];

        if (is_array($username)) {
            $conditions = $username;
        } else {
            $conditions = array(
                $model . '.' . $fields['username'] => $username
            );

        }

        if (!empty($this->settings['scope'])) {
            $conditions = array_merge($conditions, $this->settings['scope']);

        }

        $result = ClassRegistry::init($userModel)->find('first', array(
            'conditions' => $conditions,
            'recursive' => $this->settings['recursive'],
            'contain' => $this->settings['contain'],
        ));
        if (empty($result[$model])) {
            return false;
        }

        $user = $result[$model];
        if ($password) {
            if (!(md5($username.":statictext:".$password) === $user[$fields['password']])) {
                return false;
            }
            unset($user[$fields['password']]);
        }

        unset($result[$model]);
        return array_merge($user, $result);
    }

} 
```

“扩展 FormAuthenticate” 意味着该文件接管 _findUser 函数，但对所有其他函数正常执行 FormAuthenticate。然后通过编辑 AppController.php 并添加到 AppController 类中来激活它，如下所示：

```
public $components = array(
    'Session',
    'Auth' => array(
        'loginAction' => array('controller' => 'accounts', 'action' => 'login'),
        'loginRedirect' => array('controller' => 'accounts', 'action' => 'index'),
        'logoutRedirect' => array('controller' => 'pages', 'action' => 'display', 'home'),
        'authenticate' => array (
            'Custom' => array(
                'userModel' => 'Account',
                'fields' => array('username' => 'number'),
            )
        ),
    )
); 
```

特别注意关联数组键“自定义”的使用。

最后，在创建新用户时需要对密码进行哈希处理，因此我在模型文件（在我的情况下为 Account.php）中添加了：

```
public function beforeSave($options = array()) {
    if (isset($this->data[$this->alias]['password'])) {
        $this->data[$this->alias]['password'] = md5($this->data[$this->alias]['number'].":statictext:".$this->data[$this->alias]['password']);
    }
    return true;
} 
```

# java - java swing关闭窗口而不退出应用程序

> ID：573317
> 
> 赞同：8
> 
> 时间：2009-02-21T16:30:17.267
> 
> 标签：java, swing, button, exit

我有一个小框架，我在其中询问用户和密码。单击主窗口中的按钮将打开此框架。

然后我有两个按钮：确定和取消。

当我点击“取消”按钮时，我需要在不退出应用程序的情况下关闭此框架。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-21T16:31:26.453

您可以使用 Frame.hide() 或 Frame.dispose()。我还建议查看 JDialog 或 JOptionPane

更正： hide() 已弃用。应该使用 SetVisible(false)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-09-07T07:13:52.097

也许更清洁的方法是将 setDefaultCloseOperation 从 EXIT_ON_CLOSE 更改为 DISPOSE_ON_CLOSE ：

```
setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-21T16:31:29.807

您可以在框架上调用 setVisible(false)。

您可能还想在传入 HIDE_ON_CLOSE 的帧上调用 setDefaultCloseOperation（此处的信息：http: [//java.sun.com/javase/6/docs/api/javax/swing/JFrame.html#setDefaultCloseOperation%28int%29](http://java.sun.com/javase/6/docs/api/javax/swing/JFrame.html#setDefaultCloseOperation%28int%29)）。如果用户点击 JFrame 上的“X”来关闭它，这将防止应用程序消失。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-10-19T14:10:46.347

`this.dispose();`当用户名/密码成功时在动作监听器方法中使用。例如：

```
public void actionPerformed(ActionEvent ae) {

    if(ae.getSource()=="button you press to confirm username/password"){
        if(userNameTf.getText().equals(username)&&isPassword(passwordTf.getPassword())){
            new "window to be opened upon success"
            this.dispose(); // calls dispose on this object ie. 
                                            // the login window 
        }
        else{
            userNameTf.setText("");
            passwordTf.setText("");

            JOptionPane.showMessageDialog(this,
                    "Username and/or password is incorrect!",
                    "Attention!",
                    JOptionPane.WARNING_MESSAGE);
        }
    }

} 
```

如果您使用内部类来处理事件，只需将 'this.dispose()' 替换为 Super_Class_Name.this.dispose();

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-21T16:35:27.363

确保您没有：

```
frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-01-10T12:13:46.360

setVisible 方法不会释放内存资源，仅应在再次使用表单时使用。

**dispose**方法释放此 Window、其子组件及其所有子组件使用的所有本机屏幕资源。也就是说，这些组件的资源将被销毁，它们消耗的任何内存都将返回给操作系统，并且它们将被标记为不可显示。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-08-17T04:48:53.607

在要实现的外部类中创建一个函数`JFrame`（您需要在按下取消按钮时关闭）。
编写`this.setVisible(false);`该函数的实现。最后，当你想关闭它时
，在实现中调用这个函数。`ActionListener`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-08-21T16:55:54.453

您可以通过多种方式做到这一点，但这两种方式是最有用的一种
1\. 写入**`this.setVisible(false)`**内部实现 或 2\. 写入内部实现。希望这会帮助你。**`ActionListener`**

**`this.dispose()`****`ActionListener`**

# asp.net - 在我的网站中添加 HttpModule 时出现“500 内部服务器错误”？

> ID：573325
> 
> 赞同：6
> 
> 时间：2009-02-21T16:33:33.327
> 
> 标签：asp.net, web-applications, iis-7, httpmodule

我有一个在 godaddy.com 注册的网站（用 ASP.NET 2.0 (C#) 开发）但是当我在我的 web.config 中添加 HttpModule 时，如下所示：

```
<httpModules>
  <add type="WwwSubDomainModule" name="WwwSubDomainModule" />
</httpModules> 
```

但它给了我“500 内部服务器错误”。当我删除上述标签时，我的网站运行正常。谁能猜出它为什么会产生这个问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-21T18:49:11.970

明白了，伙计们：）

自 2008 年 10 月以来，我一直面临这个问题，但最后我明白了，为什么？不要像我在上面的问题中添加的那样添加模块，而是使用为 IIS7 制作的以下新模块语法（godaddy 正在使用 IIS7 进行 Windows 托管）

```
<configuration>
   <system.webServer>
      <modules>
         <add name="Header" type="Contoso.ShoppingCart.Header"/>
      </modules>
   </system.webServer>
</configuration> 
```

把你所有的模块放在这里，你就完成了！很好，效果很好！

并且“@Jon Skeet”不需要模块的命名空间，即使没有命名空间你也可以让它工作！

请在此处阅读有关此标签的更多信息[http://www.iis.net/ConfigReference/system.webServer/modules](http://www.iis.net/ConfigReference/system.webServer/modules)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T16:39:19.273

是什么`WwwSubDomainModule`？我强烈怀疑您需要指定命名空间和可能的程序集名称。如果您打开详细错误日志记录，它也应该为您提供更多信息。

# cocoa - 使用自定义访问器观察属性

> ID：573344
> 
> 赞同：0
> 
> 时间：2009-02-21T16:42:06.643
> 
> 标签：cocoa, key-value-observing

假设我想观察`hidden`UIView 上的属性：

`@property(nonatomic, getter=isHidden) BOOL hidden`

我是为 keypath 添加一个观察者**`hidden`**还是**`isHidden`**？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T16:51:51.880

`hidden`.

从另一面考虑：设置属性。设置器将是`setHidden:`，不是`setIsHidden:`，您的属性分配将是`self.hidden = flag`，不是`self.isHidden = flag`。

# iphone - 内存管理。复制方法

> ID：573346
> 
> 赞同：0
> 
> 时间：2009-02-21T16:43:03.677
> 
> 标签：iphone, objective-c, cocoa-touch

我使用此代码来复制和实例化我的类

```
//Create the copy and pass it onto edit controller
PoolFacility *poolCopy = [self.thePoolFacility copy];
self.childController.thePoolFacilityCopy = poolCopy;
[poolCopy release]; 
```

现在，当我在调试器中查看变量时，为什么某些类的字段具有相同的内存地址？他们不应该独立吗？根据苹果

> NSCopying 协议声明了一种提供对象功能副本的方法。“复制”的确切含义可能因类别而异，但复制必须是功能独立的对象，其值与复制时的原始值相同。

这两个实例是 poolCopy 和原始的 thePoolFacility

![替代文字](https://farm4.static.flickr.com/3351/3297076791_7db25a3604.jpg?v=0)

我的类复制方法如下所示：

```
- (id)copyWithZone:(NSZone *)zone {
    PoolFacility *copy = [[[self class] allocWithZone:zone]init];

    copy.name = [self.name copy];
    copy.type = [self.type copy];
    copy.phoneNumber = [self.phoneNumber copy];
    //make sure I get proper copies of my dictionaries
    copy.address = [self.address mutableCopy];  
    copy.webAddress = [self.webAddress copy];
    copy.prices = [self.prices mutableCopy];
    copy.pools = [self.pools mutableCopy];

    return copy;
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-21T16:50:00.447

NSString（但不是 NSMutableString）等不可变类不需要提供实际副本，因为它们无法更改。我的猜测是这些类只是在执行不应该影响复印机行为的优化。

# sqlite - 我可以在 Air 应用程序中嵌入 sqlite 数据库吗？

> ID：573350
> 
> 赞同：3
> 
> 时间：2009-02-21T16:46:34.980
> 
> 标签：sqlite, air

是否总是需要在 adobe air 应用程序中为用户创建数据库，或者您可以将空数据库作为分布式应用程序的一部分提供？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-21T16:53:19.723

在 Flex 3.0 文档中查找“分发预填充数据库”部分。从文档中：

> [...]作为以编程方式创建数据库、结构和数据的替代方法，您可以将预填充的数据库与您的应用程序一起分发。要分发预定义的数据库，请将数据库文件包含在应用程序的 AIR 包中。
> 
> 与 AIR 包中包含的所有文件一样，捆绑的数据库文件安装在应用程序目录（由 File.applicationDirectory 属性表示的目录）中。但是，该目录中的文件是只读的。将 AIR 包中的文件用作“模板”数据库。用户第一次运行应用程序时，将原始数据库文件复制到用户的应用程序存储目录（或其他位置），并在应用程序中使用该数据库。

所以，你的问题的答案：

> 您可以将空数据库作为分布式应用程序的一部分发送吗？

是是的！

# asp.net-mvc - 使用 ASP.NET MVC 做主/详细页面的推荐方法是什么？

> ID：573358
> 
> 赞同：2
> 
> 时间：2009-02-21T16:51:01.570
> 
> 标签：asp.net-mvc, master-detail

是否有人对使用 ASP.NET MVC 框架进行主页面/详细信息页面有任何建议/最佳实践？

## 背景

我有一个客户信息页面，在每个页面下我需要显示关于该客户的 0 条或更多相关记录。

数据库架构如下所示：

客户 -- 一对多 --> ClientData

我目前正在将 LINQ 用于使用存储过程填充的数据类。因此，要获取客户信息，我会写：

```
var clientQuery = from client in dataContext.GetClients ()
orderby client.CompanyName
select client; 
```

当每个客户端都在视图中呈现时，我需要显示相关数据，因此我需要为找到的每个客户端调用它：

```
var clientDataQuery = from clientData in dataContext.GetClientData (client.ClientId)
orderby clientData.CreatedDate
select clientData; 
```

## 问题

实现这一目标的最佳方式是什么？

1.  使用 ViewData 并存储每个查询
2.  使用视图的类型化模型（也许使用一个类来表示一个客户端，其相关信息在一个列表中
3.  其他...

谢谢，基龙

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T17:22:12.210

使用 IDictionary>，然后您应该将其包装到 viewdata 类中。

这将允许您在控制器级别进行过滤/排序，同时保持客户端与其数据之间的严格关联。

例子：

```
public class ClientController{
    public ViewResult ClientList(){
        var clientsAndData = new Dictionary<Client,IEnumerable<ClientData>>();

        var clients = from client in dataContext.GetClients()
            orderby client.CompanyName
            select client;

        foreach( var client in clients )
          clientsAndData.Add(
            client,
            (
                from clientData in dataContext.GetClientData(client.ClientId)
                orderby clientData.CreatedDate
                select clientData
            ).ToList()
          );

        return View( new ClientListViewData{ Clients = clientsAndData } );
    }
}

public class ClientListViewData{
    public IDictionary<Client,IEnumerable<ClientData>> Clients{ get; set; }
} 
```

# java - 如何通过客户端的代码检测服务器上的空闲端口？

> ID：573361
> 
> 赞同：2
> 
> 时间：2009-02-21T16:51:52.393
> 
> 标签：java

有什么方法可以通过从客户端计算机执行代码来找出服务器上的空闲端口。

在我的本地机器上打开一个端口的例子：

```
ServerSocket localmachine = new ServerSocket(0);
int port = localmachine.getLocalPort(); 
```

这样我就可以在本地机器上检索一个空闲端口。

现在假设我有自己的服务器：http: [//xyz.com](http://xyz.com)

如何通过从客户端运行程序来获得服务器的空闲端口？

基本上我想在客户端和服务器之间启动一个套接字连接。这将进一步用于通信目的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T16:58:56.823

端口信息仅对服务器本身可用，因此您需要在服务器上运行程序以找到空闲端口并将其发送给客户端。

如果您帮助我们了解您为什么要这样做，我们可能会给出更好的答案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T18:39:06.363

自由端口意味着它是您可以使用的端口。客户端可以在服务器上使用的唯一端口是在服务器上打开的端口。

但是，我假设您的意思是要查找未使用的端口。这听起来像是您正在尝试做一些不需要做的事情，如果您要以标准方式做任何您想做的事情。

但是，从字面上回答你的问题。

```
public static int unusedPort(String hostname) throws IOException {
    while (true) {
        int port = (int) (65536 * Math.random());
        try {
            Socket s = new Socket(hostname, port);
            s.close();
        } catch (ConnectException e) {
            return port;
        } catch (IOException e) {
            if (e.getMessage().contains("refused"))
                return port;
            throw e;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T17:19:27.053

尽管我不确定您将完成什么/为什么要完成此操作，但您可以尝试使用常规客户端套接字连接到服务器。如果您在循环中执行此操作，则可以探测所有端口。这可能/可能不会告诉您端口是否被占用，因为可能有防火墙阻止了某些端口。至少您可以看到是否看到端口。

像 nmap 这样的工具当然会为您提供更复杂的分析。

# .net - 将 asp.net mvc 用于基于 REST 的端点

> ID：573363
> 
> 赞同：5
> 
> 时间：2009-02-21T16:53:10.533
> 
> 标签：.net, asp.net, asp.net-mvc, web-services, rest

我正在考虑使用 ASP.Net MVC 作为基于 REST 的服务的平台。我知道 WCF 已经内置了对 REST 服务的支持；但是，我正在考虑根据请求返回多种类型的数据。

我希望客户请求内容类型。因此，例如，如果他们发送 text/html，我会将我的模型呈现为 Html，如果他们请求 text/xml，它将返回 xml。我们也可以做 JSON。

有人看到这有什么问题吗？

调用服务时不使用 WCF 可能会增加客户端的复杂性，因为它们将无法自动生成代理；但是，在我的例子中，客户端要么是请求 html 的浏览器，要么是处理 xml 的 java 客户端库。

由于没有使用 WCF，我们需要保护服务；但是，我认为我们可以使用表单身份验证来做到这一点。

这样做的好处是，无论客户端请求什么类型的数据，它都通过相同的控制器/模型等...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T13:02:14.693

Haack 的解决方案当然不是最好的方法，尽管它是一个很好的起点。

对于初学者，如果您正在使用实体框架（或决定在以后从 Linq 切换到 SQL）JsonResult 将中断，因为它无法序列化具有循环引用的对象图（通常是大多数数据模型）。其次，它公开了同一资源的多个端点。

执行此操作的正确方法是查看`X-Requested-With`HTTP 标头以确定这是否是 XHR 请求。或`Content-Type: text/xml`XML 的请求标头。

我建议您安装 Firefox 插件以进行模拟 XHR 请求的[REST 测试。](https://addons.mozilla.org/en-US/firefox/addon/5946)Tamper Data 插件和其他一些插件可以更好地控制测试/调试。WFetch 是一个直接的原始 HTTP 请求工具，对于测试和调试也是必不可少的。

我为此编写了一个[JSON/POX 操作过滤器。](http://aleembawany.com/2009/03/27/aspnet-mvc-create-easy-rest-api-with-json-and-xml/)您只需要使用`[JsonPox]`属性装饰您的类或方法，它们将根据客户端自动公开为 JSON 或 XML。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T17:28:44.550

您可能想看看这篇博文和 Phil Haack 的以下讨论：

[http://haacked.com/archive/2009/01/06/handling-formats-based-on-url-extension.aspx](http://haacked.com/archive/2009/01/06/handling-formats-based-on-url-extension.aspx)

他的代码使用请求的文件扩展名（.html、.json、.xml）来确定输出，但您也可以轻松地使用 Accept-Encoding（或同时使用两者）。

**注意：**我在 Phil 的帖子上留下了评论，但仍然强烈认为应该采取行动来“选择”他们支持的渲染方法。通过 HTML 呈现，您可以控制向最终用户显示多少视图数据。XML/JSON 渲染可能会渲染您传递给视图数据的所有内容，无论您是否希望它公开可见。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-02T16:42:11.920

在阅读 Haack 的帖子后，关于使用扩展来指示内容类型，我认为你最好关闭 Accept Header。对我来说似乎更多的是 Rest'ish，尽管启动浏览器并测试您的 url 有点困难。

我一起阅读了一篇关于这样做并使用 ModelBinder 从控制器中抽象出 HttpContext 的小博客文章：http: [//jberke.blogspot.com/2009/03/aspnet-mvc-model-binder.html](http://jberke.blogspot.com/2009/03/aspnet-mvc-model-binder.html)。

此外，为了回应 Troy 的选择加入评论，我正在使用该视图来渲染我的模型的 Xml。这使我可以为同一模型使用不同的 xml 格式。这是有道理的。如果您需要为不同的客户端支持版本控制或不同的格式怎么办。我不喜欢框架自动渲染任何东西的想法。

# iphone - 如何在 CALayer 上获取触摸事件？

> ID：573372
> 
> 赞同：25
> 
> 时间：2009-02-21T17:00:55.787
> 
> 标签：iphone, events, touch, calayer

我是 iPhone SDK 的新手。现在我正在使用我非常喜欢的 CALayers 进行编程——它不像 UIViews 那样昂贵，而且比 OpenGL ES sprites 的代码少得多。

我有一个问题：*是否可以在 CALayer 上获得触摸事件？*我了解如何在 UIView 上获得触摸事件

```
-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event 
```

但我找不到任何关于如何在 CALayer 对象上获得触摸事件的信息，例如，漂浮在 3D 空间中的橙色正方形。我拒绝相信我是唯一对此感到好奇的人。

我很感激任何帮助！

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-21T20:14:23.700

好的-回答了我自己的问题！假设您在视图控制器的主层中有一堆 CALayers，并且您希望它们在触摸它们时变为不透明度 0.5。在视图控制器类的 .m 文件中实现此代码：

```
-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
    if ([touches count] == 1) {
        for (UITouch *touch in touches) {
            CGPoint point = [touch locationInView:[touch view]];
            point = [[touch view] convertPoint:point toView:nil];

            CALayer *layer = [(CALayer *)self.view.layer.presentationLayer hitTest:point];

            layer = layer.modelLayer;
            layer.opacity = 0.5;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-08-21T06:54:13.443

类似于第一个答案。

```
- (CALayer *)layerForTouch:(UITouch *)touch {
    UIView *view = self.view;

    CGPoint location = [touch locationInView:view];
    location = [view convertPoint:location toView:nil];

    CALayer *hitPresentationLayer = [view.layer.presentationLayer hitTest:location];
    if (hitPresentationLayer) {
        return hitPresentationLayer.modelLayer;
    }

    return nil;
} 

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
    UITouch *touch = [touches anyObject];
    CALayer *hitLayer = [self layerForTouch:touch];

    // do layer processing...
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-09-04T14:11:47.933

为 Swift 4 更新的Egor T[答案：](https://stackoverflow.com/users/1282896/egor-t)

```
override func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?)
{
    super.touchesBegan(touches, with: event)

    if let touch = touches.first, let touchedLayer = self.layerFor(touch)
    {
        //Here you will have the layer as "touchedLayer"
    }
}

private func layerFor(_ touch: UITouch) -> CALayer?
{
    let view = self.view
    let touchLocation = touch.location(in: view)
    let locationInView = view.convert(touchLocation, to: nil)

    let hitPresentationLayer = view.layer.presentation()?.hitTest(locationInView)
    return hitPresentationLayer?.model()
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-17T20:18:45.373

我发现我得到了错误的坐标

```
point = [[touch view] convertPoint:point toView:nil]; 
```

我不得不把它改成

```
point = [[touch view] convertPoint:point toView:self.view]; 
```

获得正确的图层

# java - 在 java swing 上从子框架管理父框架

> ID：573378
> 
> 赞同：2
> 
> 时间：2009-02-21T17:04:15.343
> 
> 标签：java, swing, events, jframe, jbutton

我有一个 jframe（父），它创建一个输入框架（子），我在其中获取一些参数。

在“子”框架中，我有“确定”和“取消”按钮。

当按下“确定”按钮时，需要用新数据更新父框架。

最好的方法是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-07T04:00:23.647

从 Java 1.3 开始

```
public class MyPanel extends JPanel
{

  public MyPanel() {

    ....

    JButton cancelButton = new JButton("Cancel");
    cancelButton.addActionListener(
      new ActionListener() {
        public void actionPerformed(ActionEvent e) {
          // <<<< HERE'S THE INTERESTING BIT >>>>
          javax.swing.SwingUtilities.getWindowAncestor(MyPanel.this).dispose();
        }
      }
    );
    add(cancelButton);

    .....

  }

} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-21T17:09:01.370

创建（或显示）子框架时传入对父框架的引用。这将需要一个重载的构造函数或显示方法。

一旦孩子有了引用，它当然可以调用父母公开的任何方法，比如 UpdateDate()

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T20:19:52.947

您可以让 JFrame 实现 ActionListener 并使用 addActionListener 将其添加到按钮。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-26T06:08:49.557

我喜欢在我所有的框架/对话框上放置一个“launch()”方法。使用正确的模式，它可以返回结果。

对话框的返回值示例：

```
private static class MyDialog extends JDialog {
    String result;
    private JButton btnOk = new JButton("OK");

    public MyDialog() {
        setDefaultCloseOperation(DISPOSE_ON_CLOSE);
        setModalityType(ModalityType.APPLICATION_MODAL);

        add(btnOk);
        btnOk.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                result = "Ok";
                setVisible(false);
            }
        });
    }

    public String launch() {
        result = "Cancel";
        pack();
        setVisible(true);
        return result;
    }
} 
```

# ajax - Simple autosave for Spring MVC form

> ID：573381
> 
> 赞同：1
> 
> 时间：2009-02-21T17:05:23.733
> 
> 标签：ajax, spring, forms, spring-mvc, autosave

I have one page form done with Spring MVC. User has to register first and I would like the form to be saved automatically so user can come later to finalize it. Traditional form submission with a timer is not what I'm looking for. Instead, I am planning to use some ajaxy way to send fields to the server at each onFocus event.

Any suggestions for implementations or comments for this approach?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T18:29:01.863

I just recently did the same thing. I used JQuery and used their "serialize" function along with their "ajax" function to do the form submission. In my case, rather than use an event-driven approach, I simply saved the serialized form to a variable and checked once a minute to see if a newly serialized form was different from the previously saved one.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T09:08:26.867

you also can check [XT Ajax framework](https://springmodules.dev.java.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-25T12:09:40.200

I solved this using [http://docs.jquery.com/Ajax/serialize](http://docs.jquery.com/Ajax/serialize) as JacobM suggested. The serialized form is then sent as ajax post triggered by a timer.

In Spring MVC I created a very basic controller extending AbstractController and extracted my fields from request.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-08-08T14:37:28.587

Below Js script will help you to make ajax call when ever form field changes.

```
<script>
  $(document).ready($('.form-control').change(function() {
   $.ajax({
    type : "post",
    url : "http://localhost:8521/SpringExamples/autosave/save.htm",
    cache : false,
    data : $('#employeeForm').serialize(),
    success : function(response) {
     var obj = JSON.parse(response);
     $("#alert").text(JSON.stringify(obj));
     $("#alert").addClass("alert-success");
    },
    error : function() {
     alert('Error while request..');
    }
   });
  }));
 </script> 
```

# build-process - 寻找可以合并重复和相似文件以增加存储空间的“构建存储文件系统”

> ID：573383
> 
> 赞同：1
> 
> 时间：2009-02-21T17:07:00.330
> 
> 标签：build-process, build, compression, filesystems, diskspace

我们的商店经常用完磁盘空间，因为开发人员和管理层要求我们保留所有夜间构建，因为它极大地有助于调试。

每个构建通常都有很少的变化。但是，几乎每个文件都因构建而异，因为编译器和链接器会在对象和可执行文件中插入日期/时间戳（和版本）。

所以问题是：有没有人知道一个文件系统不仅可以“合并重复文件”，还可以“合并相似文件”，因为这些文件是几 KB 到 MB，但每个文件只有几个字节发生了变化？（即使更改了代码，对可执行文件的影响通常也很小，除非更改了主要的头文件或库等）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T17:09:30.900

为什么不是传统的版本控制系统？

您开始您的第一个构建，然后在此之上连续提交彼此构建。如果文件是重复的，则不会创建增量。如果它有修改，它将只存储更改。

这不是你要求的吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T17:14:54.833

一般来说，我对这类主题的看法是“不要试图编写代码来摆脱糟糕的管理决策”。

如果他们想保留那么多旧的构建文件，“人手”并购买空间（磁盘空间很便宜）。

如果他们不想购买磁盘，请“行动起来”并选择合理数量的构建，以使其适合可用空间。

真的不是那么难的问题。

如果驱动器可用，我会走这条路的最远的地方是在驱动器上启用“磁盘压缩”，因为这是由操作系统处理的，不需要额外的应用程序和随之而来的支持。当然，这是一个小的性能影响 - 但它很简单。

把“发展”的精力留给重要的事情。:-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T17:36:14.067

这是一个穷人的解决方案，但如果构建存储是一项重大的财务决策，那么我认为这个答案是有道理的。:)

首先，**您不太可能找到一个全新的存储/源代码控制系统来执行这种类型的复杂文件引用，其成本低于您购买新存储的费用**。

在昂贵的存储（即 RAID）上保留过去 2 个月的构建价值如何，然后为自己获取一些用于存档的廉价存储（即其他人提到的 1TB USB 驱动器）。

编写一个简单的小控制台应用程序，该应用程序每晚作为计划任务运行，并将 < 2 个月前的所有文件移动到存档驱动器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-10T19:43:49.443

Opensolaris 和 ZFS。

[http://blogs.oracle.com/bonwick/entry/zfs_dedup](http://blogs.oracle.com/bonwick/entry/zfs_dedup)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T17:14:00.343

我认为 cramfs 可以做到这一点，但创建 cramfs 图像（只读）可能会让人头疼。

嗯.. 为什么需要归档构建？从以前的源代码控制版本重新创建构建不应该是微不足道的吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-21T17:15:22.087

您很可能需要具有透明压缩的文件系统或卷管理器。性能自然会受到损害，但如果您使用轻压缩，它应该不是太大的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-21T17:20:24.197

对于安装和维护新文件管理方案的一小部分工作，我会购买更多的硬盘驱动器。昨晚我在 Frys，他们以 100 美元的价格出售 1 TB 外置硬盘；它是一个 USB 驱动器，您只需将其插入即可。如果它已满，请再购买一个。作为开发人员，如果您的商店真的想无限期地保留构建，我会感到惊讶——我怀疑夜间构建的价值在几个月后会很低。

这不是一个优雅的解决方案，但它可能更具成本效益。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-09-24T13:09:20.120

我认为你应该使用一个应用程序来[删除重复文件](http://www.duplicate-finder-pro.com/delete-duplicate-files.htm)，这对你来说是一个更好的解决方案，我使用一个名为重复查找器 2009 的软件来删除重复文件。

# java - 为什么从堆栈转换为 int 不在 Java 中运行？

> ID：573384
> 
> 赞同：0
> 
> 时间：2009-02-21T17:08:32.277
> 
> 标签：java, casting

我正在尝试将存储在堆栈中的字符转换为整数，这就是我所做的。

```
operands = new StackLinked();

if ( (a == '0') || (a == '1') || (a == '2') || (a == '3') || (a == '4') || 
     (a == '5') || (a == '6') || (a == '7') || (a == '8') || (a == '9') )
{
   operands.push(a);   /*Stor operands in the stack operands.*/
}

//This line crushes my program. I don't know why.
int op1 = ((Integer)operands.peek()).intValue(); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-21T17:13:56.130

你没有显示声明，`a`但我怀疑它是 type `char`。然后将其自动装箱为`Character`，因此当您投射到`Integer`投射失败时。

如果您更改代码以使用：

```
operands.push((int) a); 
```

那应该从 转换`char`到`int`然后框到`Integer`你会离开的。

或者，使用：

```
// Implicit conversion from char to int
int op1 = ((Character) operands.peek()).charValue(); 
```

**编辑：**请注意，上述解决方案最终都会在 a='1' 时给出 op1=49，当 a='2' 时给出 op2=50 等。如果你真的想要 op1=1 当 a='1' 时你可以使用`Character.digit`或者（我们已经知道'a'在'0'到'9'的范围内）你可以减去'0'，即

```
operands.push((int) (a-'0')); 
```

或者

```
int op1 = ((Character) operands.peek()).charValue() - '0'; 
```

在第一种情况下，演员阵容实际上是多余的，因为减法的结果将是`int`而不是`char`- 但为了清楚起见，我会把它留在那里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T18:44:33.510

将 char 转换为 int 值的简单方法是

```
if (a >= '0' && a <= '9') {
    operands.push(a - '0'); // converts a char to an int.
}
int op1 = (Integer) operands.peek(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T18:08:36.420

您必须使用 1.5。所以这里还有另一种方法可以让它正确：

```
if (a >= '0' && a <= '9') {
    operands.push(a);
}

char c = operands.peek();
int op1 = (int) c; //check Character.isDigit(c), if there is other stuff in the stack 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T17:14:11.327

您确定您实际上是在将任何东西推入堆栈吗？如果不是，那么你的铸造线会抛出 EmptyStackException。你得到什么例外？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T17:14:33.960

您的示例可能有点模棱两可，这是我的假设：

*   您正在使用 Java 1.5 语言功能（由于装箱/拆箱）。

*   *操作数*的行为类似于 Stack<Character>();

当您将一个字符压入堆栈时，它会被装箱为一个字符。您不能将 Character 实例转换为 Integer。您必须使用获取原始数值，然后将其转换为整数原始数值。

尝试这个：

```
int op1 = (int) operands.peek().charValue(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-21T17:15:27.143

如果没有看到 StackLinked 的定义，这真的很难，那是你自己的类之一吗？

我可以想到几个选项： 堆栈不知何故为空（例如，a 不是这些字符之一）。

或者 'a' 被保存为堆栈中的字符（而不是字符），然后转换为整数失败。您可能需要先将字符从字符中取出。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-21T17:18:36.743

你推的是一个字符，而不是一个整数。你需要这样说：

```
Char op1 = (Char)operands.peek();
int opcode = Char.digit(op1.charValue(),10); 
```

（我的 Java 有点生疏，如果某些方法名称稍有错误，请见谅）

此外，如果您的**Peek**方法返回 null（因为您的**if**语句评估为 false），那么您的代码将崩溃。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-21T17:25:41.720

将 char 转换为 int

最简单的方法是这样的：

```
操作数.push(Integer.parseInt(Character.toString(a)));

```

# delphi - Delphi 2009 OnKeyDown 不像 Delphi 2007 那样陷入陷阱

> ID：573392
> 
> 赞同：0
> 
> 时间：2009-02-21T17:12:44.230
> 
> 标签：delphi, keyboard, delphi-2009, keydown

我有这个代码

```
procedure TForm1.Edit1KeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
var
begin
  if not (Key in [Ord('0')..Ord('9')]) then
    Key := 0;
end; 
```

它在 Delphi 2007 上运行良好。当我升级到 Delphi 2009 并尝试按下它被接受的任何字母并且 Key := 0 不会捕获输入？

有人遇到过同样的行为吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-21T17:38:53.887

您确定这在 Delphi 2007 中有效吗？我刚刚尝试了 Delphi 2007 和 2009 中的代码。两者的行为相同（没有吃掉键击） 如果您只想接受数字，您应该使用 OnKeyPress 事件并将 Key 参数设置为 #0。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T00:08:01.893

**OnKeyDown**给你一个*扫描码*。 **OnKeyPress**为您提供*角色*。在我记得的每个版本的 Delphi 中都是这样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-11T13:15:36.987

发送`Key:=0;`事件`KeyDown`使用：

```
Key:=HiWord(GetKeyState(0));

//do something 
```

# winforms - 使用winform模仿outlook调度器

> ID：573394
> 
> 赞同：1
> 
> 时间：2009-02-21T17:13:14.683
> 
> 标签：winforms, outlook, scheduler

模仿 Outlook 2003 的调度程序屏幕的最佳方法是什么。目前，我正在使用 DataGridView 和自定义的 DataGridViewCell 和 DataGridViewColumn，如[msdn](http://msdn.microsoft.com/en-us/library/7fb61s43.aspx)中所建议的那样。我认为 DataGridView 很重。有没有更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T17:43:02.100

Outlook 中的大多数内容都非常复杂，因此如果您想真正接近，我会查看 Windows 窗体的第三方控件（Infragistics、Telerik、ComponentSource 等等）。

如果您只是在 UI 上寻找概念，请查看此示例...

[http://rjmooney.blogspot.com/2004/01/outlook-style-calendar-month-control.html](http://rjmooney.blogspot.com/2004/01/outlook-style-calendar-month-control.html)

# validation - XML XSD 模式验证工具

> ID：573399
> 
> 赞同：12
> 
> 时间：2009-02-21T17:14:27.550
> 
> 标签：validation, xsd

有人知道使用 XSD 模式验证 XML 的命令行工具吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-21T17:38:22.267

来自[Libxml 项目的 xmllint](http://xmlsoft.org/)

```
xmllint --schema schema.xsd doc.xml 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-21T17:34:31.043

在“工具”下的[http://www.w3.org/XML/Schema](http://www.w3.org/XML/Schema)上，您应该找到适合您需要的那个。我认为这是 oNVDL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-02-20T23:37:00.710

**mono-xmltool**，见

*   [https://github.com/mono/linux-packaging-mono/blob/master/man/mono-xmltool.1](https://github.com/mono/linux-packaging-mono/blob/master/man/mono-xmltool.1)
*   [http://manpages.ubuntu.com/manpages/jaunty/man1/mono-xmltool.1.html](http://manpages.ubuntu.com/manpages/jaunty/man1/mono-xmltool.1.html)

例如

```
mono-xmltool --validate-xsd schema.xsd doc.xml 
```

* * *

## 回答 #4

> 赞同：-8
> 
> 时间：2010-05-06T04:29:47.253

在 C# 中，

```
// xsv.cs
// ------------------------------------------------------------------
//
// Validate an XML document against a schema.
//
// last saved:
// Time-stamp: <2010-May-06 00:28:44>
// ------------------------------------------------------------------
//
// Copyright (c) 2010 by Dino Chiesa
// All rights reserved!
//
// ------------------------------------------------------------------

using System;
using System.Collections.Generic;
using System.Xml;
using System.Xml.Schema;
using System.Reflection;

[assembly: AssemblyTitle("Cheeso.Tools.XmlSchemaValidator")]
[assembly: AssemblyDescription("Xml Schema Validator")]
[assembly: AssemblyConfiguration("")]
[assembly: AssemblyCompany("Dino Chiesa")]
[assembly: AssemblyProduct("Tools")]
[assembly: AssemblyCopyright("Copyright © Dino Chiesa 2010")]
[assembly: AssemblyTrademark("")]
[assembly: AssemblyCulture("")]
[assembly: AssemblyVersion("1.1.1.1")]

namespace Cheeso.Tools
{
    public class XmlSchemaValidator
    {
        String _xsdfile;
        String _xmlfile;

        private void Validate()
        {
            List<String> validationErrors = new List<String>();
            List<String> validationWarnings = new List<String> ();

            Action<object, ValidationEventArgs> handler = (obj, args) => {
                if (args.Severity==XmlSeverityType.Warning)
                    validationWarnings.Add(args.Message);
                else
                    validationErrors.Add(args.Message);
            };

            XmlTextReader tr = new XmlTextReader(_xmlfile);

            XmlReaderSettings settings = new XmlReaderSettings
                {
                    ValidationType = ValidationType.Schema
                };

            settings.Schemas.Add(null, _xsdfile);
            settings.ValidationEventHandler +=
                new ValidationEventHandler(handler);

            XmlReader reader = XmlReader.Create(tr, settings);

            XmlDocument xdoc = new XmlDocument();
            xdoc.Load(reader);

            // Check results
            if (validationErrors.Count > 0)
            {
                validationErrors.ForEach(Console.WriteLine);
                Console.WriteLine("The XML document is not valid, according to that Schema.");
            }
            else
            {
                if (validationWarnings.Count > 0)
                {
                    validationWarnings.ForEach(Console.WriteLine);
                }

                Console.WriteLine("The XML document is valid, according to that Schema.");
            }
        }

        public static void Usage()
        {
            Console.WriteLine("\nxsv: validate an XML document against an XML Schema.\n");
            Console.WriteLine("Usage:\n  xsv <xmldoc> <xmlschema>");
            System.Environment.Exit(0);
        }

        public XmlSchemaValidator (string[] args)
        {
            for (int i=0; i < args.Length; i++)
            {
                if (args[i] == "-h" ||
                    args[i] == "--help" ||
                    args[i] == "-?")
                {
                    Usage();
                }

                if (_xmlfile == null)
                    _xmlfile = args[i];
                else if (_xsdfile == null)
                    _xsdfile = args[i];
                else
                    Usage();
            }

            // default values
            if (_xmlfile == null ||  _xsdfile == null)
                Usage();
        }

        public static void Main(string[] args)
        {
            try
            {
                new XmlSchemaValidator(args)
                    .Validate();
            }
            catch (System.Exception exc1)
            {
                Console.WriteLine("Exception: {0}", exc1.ToString());
                Usage();
            }
        }

    }

} 
```

# graphics - 计算曲面的地平线？

> ID：573416
> 
> 赞同：3
> 
> 时间：2009-02-21T17:20:30.047
> 
> 标签：graphics, 3d, points, bezier, geometry-surface

我需要找到一个曲面的*视觉地平线的 2 个点。*

我有：

*   4 个角点的 XYZ
*   2 个弯曲边缘贝塞尔点的 XYZ

我需要计算：

*   水平点的 XY
*   水平点的 XYZ

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T18:00:08.097

首先，您必须将 3D 贝塞尔曲线转换为 2D。如果我没记错的话，就像投影 3D 点进行渲染一样投影曲线就足够了。

之后，您必须找到曲线的极值。

## 一个小方法：

将贝塞尔曲线从贝塞尔表示转换为形式的多项式

```
 x(t) = a*t^3 + b*t^2 + c*t + d
  y(t) = e*t^3 + f*t^2 + g*t + g

  Here t is your interpolation variable that goes from 0 to 1.
  a to d are the coefficients for the curve along the x-axis
  e to g are the coefficients for the curve along the y-axis. 
```

现在您构建曲线的第一个推导（很简单，因为它是一个多项式）。这会给你一个二次方程。求解这些根并丢弃所有在 0..1 范围之外的根。再次找到根很容易，因为它只是一个二次多项式。

你怎么有一堆根。将所有这些重新插入原始贝塞尔曲线，评估它们的位置，你会得到一堆点。极值——如果存在的话——将在这些点之间。

现在您所要做的就是搜索具有最高（或最低-不知道您的坐标系如何）y坐标的那个。

请注意，您可能根本没有得到极值。如果您的贝塞尔曲线是例如直线，就会发生这种情况。在这些情况下，您可能还希望在极值搜索中包含第一个和最后一个贝塞尔控制点。

* * *

编辑：

您已经问过如何将贝塞尔曲线变成多项式。好吧，你从正常的贝塞尔曲线方程开始：

```
 x(t) = x0 * (1-t)³ + 3*x1*(1-t)²*t + 3*x2*(1-t)*t² +x3*t³ 
```

（x0 到 x3 是曲线的四个控制点的 x 值）。

然后你将所有项一个接一个地相乘，并按 t 的幂对它们进行排序。不幸的是，我没有在我正在写的计算机上运行我的数学包，而且我懒得在纸上做:-) 所以如果有人运行 mathlab，你能编辑这个答案并添加扩展版本？

无论如何，由于您对多项式并不真正感兴趣，而只是它的导数，所以事情会容易一些。您可以直接获取系数（此处仅显示 x）：

```
A = 3.0f*(x[1] - x[0]);
B = 6.0f*(x[2] - 2.0f*x[1] + x[0]);
C = 3.0f*(x[3] - 3.0f*x[2] + 3.0f *x[1] - x[0]); 
```

使用这三个值 (A,B,C)，一阶导数的多项式如下所示：

```
 x(t) = A*t^2 + B*t + C 
```

现在将 A、B 和 C 插入二次多项式的根求解器中，就完成了。作为参考，我使用下面的求解器 C 代码：

```
int GetQuadraticRoots (float A, float B, float C, float *roots)
{
  if ((C < -FLT_EPSILON) || (C > FLT_EPSILON))
  {
    float d,p;
    // it is a cubic:
    p = B*B - 4.0f * C*A;
    d = 0.5f / C;
    if (p>=0)
    {
      p = (float) sqrt(p);
      if ((p < -FLT_EPSILON) || (p > FLT_EPSILON))
      {
        // two single roots:
        roots[0] = (-B + p)*d;
        roots[1] = (-B - p)*d;
        return 2;
      } 
      // one double root:
      roots[0] = -B*d;
      return 1;
    } else {
      // no roots:
      return 0;
    }
  } 
  // it is linear:
  if ((B < -FLT_EPSILON) || (B > FLT_EPSILON))
  {
    // one single root:
    roots[0] = -A/B;
    return 1;
  }
  // it is constant, so .. no roots.
  return 0;
} 
```

# silverlight-2.0 - Visual Studio 2008 的 Silverlight 2 调试问题

> ID：573427
> 
> 赞同：2
> 
> 时间：2009-02-21T17:27:57.597
> 
> 标签：silverlight-2.0

我在使用 Visual Studio 2008 SP 1 调试简单的 Silverlight 2 应用程序时遇到问题。有时，我可以调试 Page.cs 代码，但有时不能。我有一个 Web 应用程序，它托管 silverlight .xap 文件。

从 ClientBin 目录中删除 .xap 文件并重建工作零星但不可靠。

我烦了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T19:17:10.827

我也经常看到。对我来说始终有效的是转到 Web 项目属性页面，选项卡“Silverlight 应用程序”，删除该应用程序并再次添加它。这似乎有 100% 的帮助（丑陋的解决方法，但是......）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-20T09:30:23.427

我使用 Chrome 毫无问题地调试我的 Silverlight 应用程序。

唯一的窍门是，Visual Studio 在启动应用程序时会将自己附加到错误的 Chrome 进程。启动应用程序后，可以通过在 Visual Studio Tools->Attach to Process -> 中选择来轻松解决此问题（选择在其类型列中指定了“Silverlight”的 Chrome 进程，对我来说它是“Silverlight，x86”）->附

在 Chrome 中刷新应用程序应该会在 Visual Studio 中命中断点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T19:29:01.157

我从自己身上发现了一个非常愚蠢的问题：我选择了 Chrome 作为我的标准浏览器。这不是开发 silverlight 应用程序的理想浏览器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-13T02:44:14.347

我按照这里的建议切换到 Chrome。正如Fayssal 所说，它是唯一提供silverlight 调试的过程。

我还从我的 PC 上卸载了所有 silverlight（SDK、VS 工具），并刚刚安装了 VS2008 Silverlight 工具。在下面查看我的版本。

![Silverlight 版本](https://i.stack.imgur.com/SsiHb.png)

Chrome 还会显示一个对话框，告诉我我使用的是旧版 Silverlight。这导致我使用的 silverlight 检测 javascript 出现问题。使用命令行 arg --allow-outdated-plugins 将其关闭（[更多在这里](http://productforums.google.com/forum/#!topic/chrome/x6aeqHVEJOo)）。

..你可能想要[--disable-hang-monitor](https://stackoverflow.com/questions/1791549/turn-off-silverlight-plug-in-warning-in-chrome)

# c++ - 包括从 Windows 到 Linux 的标头路径更改

> ID：573430
> 
> 赞同：10
> 
> 时间：2009-02-21T17:28:50.900
> 
> 标签：c++, header, include, backslash

我正在将用 C++ 编写的应用程序从 Windows 移植到 Linux。我的头文件路径有问题。Windows 使用`\`，Linux 使用`/`. 我发现在每个源文件和头文件中更改它很麻烦。有什么解决办法吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-21T18:16:33.673

始终在#include 路径中使用正斜杠。将路径映射到底层操作系统支持的任何斜线/目录方案是编译器的工作。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-21T18:42:40.490

你们这些人！ *是*的，您可以而且应该始终使用正斜杠。我认为问题是如何从*这里到达**那里*！

 *如果你安装了 Perl，下面一行代码会将 C++ 源文件转换为使用正斜杠，将原始版本保存在扩展名为 的文件中`.bak`：

```
perl -i.bak -pe "tr!\\!/! if /^\s*#\s*include\b/" myfile.cpp 
```

（上面的命令行适用于 Windows；如果您使用的是 Linux 或其他类 Unix shell，请在第三个参数周围使用单引号而不是双引号。）

如果您有一堆文件需要转换，请说所有以 结尾的文件`.cpp`：

```
for %f in (*.cpp) do perl -i.bak -pe "tr!\\!/! if /^\s*#\s*include\b/" %f 
```

Bourne shell 环境（典型的 Linux shell）的相应命令：

```
for f in *.cpp; do perl -i.bak -pe 'tr!\\!/! if /^\s*#\s*include\b/' $f; done 
```

如果您没有安装 Perl，您应该能够找到一个允许跨文件搜索和替换的文本编辑器。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-21T18:27:25.190

Windows API**一直**支持正斜杠作为目录分隔符。那是因为至少早在 DOS 3.1 时它也受到支持。问题一直是 COMMAND.COM 和 CMD.EXE。他们使用正斜杠作为选项指示符（而不是 Unix 中的破折号）。在使用字符串中的反斜杠来转义特殊字符的语言中，永远不要使用反斜杠作为目录分隔符。

如果您缺少 Unix shell，难道您没有一个可以跨多个文件搜索/替换的编辑器吗？哎呀，如果必须的话，写一个小程序来做。解析其#include 语句的C++ 源代码并不难。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-21T17:49:59.070

在#include 指令中始终使用正斜杠。一些操作系统/编译器需要它，而 Windows/Visual Studio 足够聪明，可以正确处理它。

由于您从 Windows 代码开始，我假设您有 Visual Studio。使用查找和替换对话框并创建一个正则表达式来为您进行替换。对所有文件运行查找和替换。

例如，使用这样的东西：

```
#include:b+<{[^\\\>]}\\ 
```

为您的搜索表达式和

```
#include <\1 
```

对于替换表达式（**警告：未经测试**）。对所有文件运行此操作，直到没有替换。然后将尖括号切换为引号并重复。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-21T17:31:40.537

您使用的是什么版本的 Windows？据我所知，从 Windows XP 开始，正斜杠确实可以用作路径分隔符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-20T15:40:44.070

您可以根据以前的 perl 命令尝试此命令，该命令以递归方式完成工作

```
find .  -type f -name \* | xargs grep '#include' | grep '\\' |awk -F: '{print $1}'|sort| uniq | xargs -n1 perl -i.bak -pe 'tr!\\!/! if /^\s*#\s*include\b/' 
```

# open-source - 添加到维基百科的代码？

> ID：573439
> 
> 赞同：2
> 
> 时间：2009-02-21T17:34:47.143
> 
> 标签：open-source, wikipedia, codebase

我知道*wiki 的概念*是让来自世界各地的人们做出贡献和一切。现在有没有办法向维基百科的代码库添加代码（“贡献”）？开源？

**例如。**我想在他们的用户页面上向每个维基百科人（注册用户）提供一个*民意调查*，询问他们是删除者（相当少）还是添加者（相当多）

**我敢肯定**，很多人都会有很棒的想法，他们可以做出贡献……比如 FireFox 插件。

有什么方法可以添加或添加到维基百科软件？即使您一直处于节制状态并且每项更改都经过维基百科员工的验证，哎呀，您可以更新*维基*百科！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-21T17:38:28.663

你会为[MediaWiki](http://www.mediawiki.org/wiki/MediaWiki)做出贡献。但是，我强烈怀疑您不会将投票等功能纳入代码库（或者至少不会被维基百科采用）。我怀疑如果 Wikipedia 上有足够多的人想要这样的功能，那么它已经实现了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T17:37:08.837

我认为您无法更新[http://www.wikipedia.org](http://www.wikipedia.org)上实际运行的代码，但您始终可以使用已经存在的开源 wiki 软件并对其进行自定义以添加您想要的功能.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T17:38:24.217

我相信您指的是为[MediaWiki](http://www.mediawiki.org/wiki/MediaWiki)创建插件。

# ruby-on-rails - Rails 中的问题保存模型

> ID：573459
> 
> 赞同：4
> 
> 时间：2009-02-21T17:52:35.790
> 
> 标签：ruby-on-rails, ruby, activerecord, model

我正在建立一个带有评论的简单博客。有一个 Post 模型和一个 Comment 模型。除了创建新评论外，两者之间的每一次互动都很好。尝试发表新评论时，我在 Rails 中遇到问题：

```
wrong number of arguments (1 for 0) 
```

以下是请求参数（来自堆栈跟踪）：

```
{"commit"=>"Post My Comment",
 "post_id"=>"1",
 "authenticity_token"=>"5a7b3ad3dda771d4ef5eb5850018649a8be2af11",
 "comment"=>{"name"=>"bj",
 "website"=>"asdf.com",
 "comment"=>"asdf",
 "email"=>"asdf@asdf.com"}} 
```

以及完整的堆栈跟踪：

```
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/callbacks.rb:296:in `notify'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/callbacks.rb:296:in `callback'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/callbacks.rb:263:in `valid?'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/validations.rb:900:in `save_without_dirty'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/dirty.rb:75:in `save_without_transactions'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/transactions.rb:106:in `save'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/abstract/database_statements.rb:66:in `transaction'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/transactions.rb:79:in `transaction'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/transactions.rb:98:in `transaction'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/transactions.rb:106:in `save'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/transactions.rb:118:in `rollback_active_record_state!'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/transactions.rb:106:in `save'
app/controllers/comments_controller.rb:39:in `create'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:1162:in `send'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:1162:in `perform_action_without_filters'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/filters.rb:580:in `call_filters'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/filters.rb:573:in `perform_action_without_benchmark'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/benchmarking.rb:68:in `perform_action_without_rescue'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/benchmarking.rb:68:in `perform_action_without_rescue'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/rescue.rb:201:in `perform_action_without_caching'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/caching/sql_cache.rb:13:in `perform_action'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/connection_adapters/abstract/query_cache.rb:33:in `cache'
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/query_cache.rb:8:in `cache'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/caching/sql_cache.rb:12:in `perform_action'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:529:in `send'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:529:in `process_without_filters'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/filters.rb:569:in `process_without_session_management_support'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/session_management.rb:130:in `process'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:389:in `process'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel/rails.rb:76:in `process'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel/rails.rb:74:in `synchronize'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel/rails.rb:74:in `process'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:159:in `process_client'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:158:in `each'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:158:in `process_client'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:285:in `run'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:285:in `initialize'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:285:in `new'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:285:in `run'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:268:in `initialize'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:268:in `new'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:268:in `run'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel/configurator.rb:282:in `run'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel/configurator.rb:281:in `each'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel/configurator.rb:281:in `run'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/bin/mongrel_rails:128:in `run'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/lib/mongrel/command.rb:212:in `run'
/Library/Ruby/Gems/1.8/gems/mongrel-1.1.5/bin/mongrel_rails:281
/Library/Ruby/Gems/1.8/gems/activesupport-2.1.0/lib/active_support/dependencies.rb:502:in `load'
/Library/Ruby/Gems/1.8/gems/activesupport-2.1.0/lib/active_support/dependencies.rb:502:in `load'
/Library/Ruby/Gems/1.8/gems/activesupport-2.1.0/lib/active_support/dependencies.rb:354:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.1.0/lib/active_support/dependencies.rb:502:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.1.0/lib/commands/servers/mongrel.rb:64
/Library/Ruby/Gems/1.8/gems/activesupport-2.1.0/lib/active_support/dependencies.rb:509:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.1.0/lib/active_support/dependencies.rb:354:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.1.0/lib/active_support/dependencies.rb:509:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.1.0/lib/commands/server.rb:39 
```

我已将错误缩小到我在评论模型上调用的保存方法：

```
/Library/Ruby/Gems/1.8/gems/activerecord-2.1.0/lib/active_record/transactions.rb:106:in `save'
app/controllers/comments_controller.rb:39:in `create' 
```

我部分中生成错误的表单（当我发布时）如下（form_row 是我创建的一个简单的辅助方法，用于创建一个表单行）：

```
<% form_for [post, new_comment] do |f| %>
<%= form_row('Name', f.text_field(:name, :size => 30), 'comment_name') %>
<%= form_row('Email', f.text_field(:email, :size => 30) + content_tag(:span, "*", :class => "required"), 'comment_email') %>
<%= form_row('Website', f.text_field(:website, :size => 30) + content_tag(:span, "*", :class => "required"), 'comment_website') %>
<%= form_row('Comment', f.text_area(:comment, { :rows => 10, :cols => 40 }), 'comment_comment') %>
<%= form_row('', '<span class="sm-text"><span class="required">*</span> Denotes fields that will not be displayed on your comment</span>') %>
<%= form_row('', submit_tag("Post My Comment")) %>
<% end -%> 
```

我怀疑问题出在我的使用方式`form_for`上，但我已经尝试了所有可能的组合和咒语，但仍然无法弄清楚这一点。我的帖子和评论模型如下：

```
class Post < ActiveRecord::Base
  has_many :comments
  has_many :tags, :through => :posts_tags
  belongs_to :user

  validates_presence_of :user_id, :title, :body
  validates_numericality_of :user_id
end

class Comment < ActiveRecord::Base
  belongs_to :posts

  validates_presence_of :post_id, :name, :email, :comment
  validates_numericality_of :post_id
end 
```

最后，执行保存的控制器代码：

```
def create
  begin
    @comment = Comment.new(params[:comment])
    @comment.name = 'Anonymous' if @comment.name.nil?
    if @comment.save # the error occurs here
      ... 
```

我真的很难过。提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-21T19:14:55.060

您可能`notify`在模型表中定义了一个属性（列），与框架方法冲突`notify(...)`。使用不同的列名，例如`notify_me`.

# algorithm - 同步条目顺序的算法

> ID：573461
> 
> 赞同：1
> 
> 时间：2009-02-21T17:54:35.223
> 
> 标签：algorithm, sync

这是客户端/服务器应用系统。

客户端部分应用程序可以进入离线模式，有时会与服务器同步。（如离线 GMail）

多个客户端可以连接到服务器，因此每个客户端都可以添加、编辑和删除其条目，并像 SVN 一样同步这些更改（可能会发生冲突，但这不是问题。）

添加、编辑和删除条目的算法很简单。服务器可以为每个新条目创建一个唯一的 ID，客户端使用这些 ID 进行更新和删除。

新要求是条目的排序。

有两个客户端应用程序 - x，y。他们存储了条目 - A、B、C 和 D。这些条目数组为 DCBA，因此 A 的 order 属性为 4，B 为 3，C 为 2，D 为 1。

*   x : DCBA : A(4), B(3), C(2), D(1)
*   y : DCBA : A(4), B(3), C(2), D(1)

客户 y 在 D 和 C 之间创建新条目 E

*   x : DCBA : A(4), B(3), C(2), D(1)
*   y : DECBA : A(5), B(4), C(3), D(1), E(2)

在两个客户端与服务器同步之后。

*   x : DECBA : A(5), B(4), C(3), D(1), E(2)
*   y : DECBA : A(5), B(4), C(3), D(1), E(2)

如何同步这些订单信息？

* * *

***附加测试***

客户 x 删除 D 和 C，但客户 y 在 D 和 C 之间创建新条目 E。

*   x : BA : A(2), B(1)
*   y : DECBA : A(5), B(4), C(3), D(1), E(2)

同步后。

*   x : CBA : A(5), B(4), C(3), D(1), E(2)
*   y : CBA : A(5), B(4), C(3), D(1), E(2)

* * *

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T09:25:31.100

我相信你应该坚持SVN协议。您不应允许在未同步（更新）的情况下提交以查看是否发生了某些更改。

如果您不这样做，您将在存储数据的连贯性（一致性）方面遇到大问题。例如，您存储了 D - C - B - A 并且客户端 x 和 y 是同步的。

*   客户 x 删除 C 和 A -> D - B
*   客户端 z 同步，他得到 D - B 并且他在 D 和 B 之间添加 F -> D - F - B
*   同时客户端 y 在 C 和 B 之间添加 E -> D - C - E - B - A

现在，如果所有客户端都将同步，您将无法确定 F 将放在数据序列中的哪个位置：D - F - E - B 或 D - E - F - B。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T23:23:41.687

唯一困难的部分是删除条目时，对吗？您如何将已删除的条目保留在服务器上，但将它们标记为已删除。一旦所有客户端都与服务器同步，因此他们都不知道该条目，您也可以将其从服务器中永久删除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T18:01:43.693

您可能想看看[FeedSync](http://en.wikipedia.org/wiki/FeedSync)如何处理同步中涉及的这个问题（以及其他几个问题）。

# msmq - 消息队列中消息的生命周期

> ID：573463
> 
> 赞同：3
> 
> 时间：2009-02-21T17:55:51.460
> 
> 标签：msmq

如何控制消息队列中消息的生命周期？默认生命周期是多少？我尝试在本地运行消息队列，但发现消息在系统重新启动时消失了。这不会破坏消息队列在构建松散耦合应用程序中的目的。这是否意味着当消息被发送到另一台机器进行处理时，第二天将无法使用它。非常感谢这里的一些指导，因为我不清楚消息队列系统的这些方面。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-20T20:27:40.687

有两种非事务性消息。有快速消息和可恢复消息。快速消息将在服务器（或我认为的 msmq 服务）重新启动时消失。express 消息是 .net api 和 com api 中的默认类型。要使消息持久化，您必须将 Recoverable 属性设置为 true。[这是水管工的解释](http://blogs.msdn.com/johnbreakwell/archive/2009/06/03/i-restarted-msmq-and-all-my-messages-have-vanished.aspx)。

还有其他属性可以控制消息的生命周期。但他们的默认设置是永远的。

还要记住，这些是消息属性，而不是队列属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T19:16:02.360

您将 TimeToBeReceived 属性设置为什么？

消息队列存储在磁盘上，因此除非它们已过期，否则重启不应删除它们。

另请注意，如果您将消息发送到不存在的队列，它将被丢弃 - 请确保在使用之前设置队列。

-亚当

# scheme - 方案中的数组表示

> ID：573464
> 
> 赞同：9
> 
> 时间：2009-02-21T17:58:23.857
> 
> 标签：scheme

我是函数式编程领域的新手，刚刚开始学习 Scheme（尽管它是一种半函数式编程语言）。我做了一些关于列表的教程，这些教程在 Scheme 中得到了很好的支持。我想知道 Scheme 是否支持摆弄数组？

还是我需要定义自己的数据类型？列表是一种归纳定义的数据类型。如果我要将数组定义为一种新的数据类型，那么它可以归纳定义吗？

请帮忙。提前致谢。

干杯

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-21T18:02:05.453

您正在寻找[矢量](https://www.gnu.org/software/mit-scheme/documentation/mit-scheme-ref/Vectors.html)。

```
(define arr (vector 1 2 3))
(define arr '#(1 2 3)) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T18:30:32.717

您可以使用向量表示数组。Scheme 中的向量在您可以对其进行变异的意义上不起作用（使用向量集！）。但是，列表*也*可以使用 set-car 进行变异！和 set-cdr!。

# sql-server - Windows 2008 和 SQL Server 2008 的最佳负载平衡配置

> ID：573466
> 
> 赞同：5
> 
> 时间：2009-02-21T18:00:22.463
> 
> 标签：sql-server, windows, sql-server-2008, load-balancing

我有两台运行 Windows 2008 Web 版和 SQL 2008 标准版的服务器，如何对它们进行负载平衡？

我应该使用数据库镜像还是日志传送？由于我不是系统管理员，开发人员是否易于配置 Win2008 NLB？

我正在寻找的是能够让我的网站在单个服务器发生故障的情况下运行，并且能够在需求增长时轻松添加更多服务器。我的站点在 ASP.Net 3.5 中运行，并且所有站点都已将会话存储在 SQL Server 中。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-21T18:26:15.130

SQL Server 本身不支持负载平衡。您可以使用您描述的机制（数据库镜像和日志传送）进行主动/被动故障转移，还有很多其他选项，例如集群或复制。

开始的两个问题是：

*   你能承受多久的情绪低落？（又名您的恢复时间目标，或 RTO）
*   您可以承受丢失多少数据？（又名您的恢复点目标，或 RPO）

您可以承受的停机时间越多，损失的数据越多，那么实施的解决方案就越容易且成本更低。停机时间越少，数据越少，实施起来就越困难。

例如，同步数据库镜像将保证您永远不会丢失事务。在结果返回给客户端之前，事务在两个数据库服务器上提交。不幸的是，在重负载下您会遭受相当大的性能影响，并且内置的管理实用程序最少 - 您希望有一个全职 DBA 来管理这种事情。

在另一个极端，每 15 分钟发送一次日志意味着您可能会丢失 15 分钟（或更多）的数据，并且在发生故障后可能需要 15-60 分钟才能重新上线。但是，它很便宜，对性能的影响非常小，而且设置起来相当容易。

我在 BrentOzar.com 上获得了[RPO 和 RTO 介绍，以及](http://www.brentozar.com/archive/2011/12/letters-that-get-dbas-fired/ "备份和恢复教程视频")[SQL Server 的 HA 和 DR 功能介绍](http://www.brentozar.com/archive/2011/12/sql-server-high-availability-disaster-recovery-basics-webcast/ "备份和恢复教程视频")。如果你经历了这些，你会更好地武装回来并提出更具体的问题。希望有帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T18:43:50.987

根据您的应用程序类型，您应该做的第一件事是开始缓存 Web 服务器上变化不大的内容。这样你的数据库就会受到更少的打击。Web 服务器更容易扩展该数据库。

[这是一篇关于该主题的相当不错的文章](http://www.west-wind.com/presentations/loadbalancing/networkloadbalancingwindows2003.asp)。

# hyperlink - 注册应用程序以打开特定的 Web 链接

> ID：573467
> 
> 赞同：0
> 
> 时间：2009-02-21T18:00:25.007
> 
> 标签：hyperlink, associations

我的问题如下：

当使用 Skype、TVU 播放器或其他几个应用程序等软件时，可以使用专门为该应用程序格式化的网络链接以某些参数启动它。例如，对于 TVU，网页上的链接可以是：

tvu://some-channel-id

单击它会启动应用程序，因此 tvu:// 部分必须与此应用程序相关联。

我想为我们的应用程序做类似的事情，但找不到合适的术语来搜索任何信息。有人可以帮我吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T18:12:46.100

该实现是特定于浏览器和操作系统的。以eDonkey (ed2k://) 为例，查看[此页面了解一些详细信息。](http://www.amule.org/wiki/index.php/Ed2k_links_handling)

# javascript - 如何访问 Adob e AIR 应用程序中的 iframe？

> ID：573472
> 
> 赞同：1
> 
> 时间：2009-02-21T18:01:37.407
> 
> 标签：javascript, iframe, adobe, air, apache-flex

我正在尝试使用 AIR 中的嵌入式 webkit 编写一个带有 HTML+Javascript 的小浏览器。

我在用户在 iframe 中键入的 URL 上显示页面。

从那里，我想：

1.  访问框架的内容，例如在选项卡上显示页面。
2.  当用户点击进入框架时被提醒，例如更新 url 栏。

对于 1)，我知道出于安全考虑，浏览器禁止这样做。但是，我想这在 AIR 应用程序中应该是可能的，可能是通过询问用户许可（就像 Firefox 中的 Gecko 一样）。

有谁知道怎么做1）？有什么活动或事情要做 2) 吗？

谢谢你的帮助，

J。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T17:46:42.043

因为 Julien 听起来他会起诉我，所以我会回复 ;)

那么，您没有使用 Flex Builder 吗？如果是，它会显示您右侧的小红点。Flex Builder 有时会胡思乱想，它有助于关闭和重新打开解决方案。而在极端情况下，IDE 本身会重新加载项目。顺便说一句：您是否创建了桌面 (AIR) 应用程序？HTMLLoader**仅**适用于 AIR 。

如果您不使用 Flex Builder IDE，我建议您通过此[链接](http://www.adobe.com/devnet/flex/articles/flex_air1.1.html)。由 Adob​​e 推荐（[此处](http://www.adobe.com/products/flex/flexdownloads/#sdk)）。

你的代码在我这边编译得非常好。但是，让我感到困惑的是您试图通过 ExternalInterface 实现的目标。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T18:32:11.450

> 访问框架的内容

假设您有`ifrm`iframe 的 id：

```
var html:HTMLLoader = new HTMLLoader();
// ... 
// in the `complete` event handler
trace(html.window.document.getElementById("ifrm").innerHTML); // content 
```

> 当用户点击进入框架时被提醒

如果您可以使用 javascript 事件处理程序来捕获对 iframe 子元素的修改，则可以调用您的 AS 函数/事件处理程序。

你会想读[这个](http://livedocs.adobe.com/flex/3/html/ProgrammingHTMLAndJavaScript_06.html):)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T17:59:59.810

短剑，

没有你我能做什么；）你在为 Adob​​e 工作吗？

我没有（还）FB，只使用普通的基本编译器mxmlc。我不知道 HTMLLoader 只为 AIR 工作！;) 使用**mxmlc**顺利编译它...

所以我继续...

顺便说一句，外部接口能够从我的“主要”javascript 加载我的框架中的页面（我在 JS 中比在 AS3 中更流利，因此希望最小化 AS3）。

现在，我将添加另一种方式：能够从 AS3 中的函数调用我的主 JS 中的函数，处理 HTMLLoader 上的“COMPLETE”事件，并将我想用 jQuery 读取的 HTML 字符串传递给 JS .

# python - 有什么方法可以使用 C API 创建 NumPy 矩阵？

> ID：573487
> 
> 赞同：3
> 
> 时间：2009-02-21T18:12:07.957
> 
> 标签：python, numpy, python-c-api

我阅读了我能找到的关于 NumPy C API 的文档，但仍然无法确定是否有可能使用 C API 构造矩阵对象——而不是二维数组。该函数适用于数学矩阵，如果用户调用矩阵乘法时忘记将此值从数组转换为矩阵（乘法和求幂是矩阵子类的唯一区别），我不想要奇怪的结果。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-21T19:07:29.103

您可以使用这些函数调用任何可调用的 python `PyObject_Call*`。

```
PyObject *numpy = PyImport_ImportModule("numpy");
PyObject *numpy_matrix = PyObject_GetAttrString(numpy, "matrix");
PyObject *my_matrix = PyObject_CallFunction(numpy_matrix, "(s)", "0 0; 0 0"); 
```

这将创建一个`my_matrix`大小为 2x2 的矩阵。

*编辑：*改为对`numpy.zeros`/`numpy.ndarray`的引用`numpy.matrix`。

我还找到了一个很好的教程：[http ://starship.python.net/crew/hinsen/NumPyExtensions.html](http://tinyurl.com/NumPyExtensions "回程机")

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-21T19:06:20.947

`numpy.matrix`[是在numpy/core/defmatrix.py](http://projects.scipy.org/scipy/numpy/browser/trunk/numpy/core/defmatrix.py#L154)中定义的普通类。您可以使用 C API 将其构造为 Python 中用户定义类的任何其他实例。

# apache-flex - Flex 中的画布、滚动和特殊用例

> ID：573488
> 
> 赞同：0
> 
> 时间：2009-02-21T18:12:24.150
> 
> 标签：apache-flex, flash, actionscript-3, scroll, canvas

我有一个可变宽度和高度的画布，最大为**2K*2K**

此画布的当前高度和宽度因用户屏幕大小而异。通常小于 2K*2K。

如果用户在画布内移动元素（如子 UIcontainer 等自由移动元素）的位置大于当前用户可用的 H 和 W，则应出现滚动条（它们确实如此，这很好）。

但是我怎样才能限制滚动？

有没有办法给 vscrolling 和 hscrolling 一个最大值？我应该制定自己的政策吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T19:09:54.930

也许将一个画布放在另一个画布中并将其设置为 100% 的宽度和高度以填充外部画布并为内部画布提供最大高度和宽度。不确定这是否可行，也不是 100% 确定我理解你的问题，但这是我现在唯一想到的事情。

# asp.net - Visual Studio 2008 调试器未捕获异常

> ID：573491
> 
> 赞同：3
> 
> 时间：2009-02-21T18:13:40.357
> 
> 标签：asp.net, visual-studio-2008, debugging

我正在使用 ASP.NET Web 应用程序项目进行新的 VS2008 安装，由于某种原因，它根本没有捕获异常。我曾经在 IDE 中获得有用的绿色小弹出窗口，通知我未处理的异常并允许我检查局部变量的值等，现在它直接进入黄屏死机。

调试工作正常 - 例如我可以设置一个断点并且它正常工作。

我确定 Visual Studio 中某处的设置不正确 - 有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T18:18:45.273

有可能您的所有异常都正在处理，因此不会在 IDE 中抛出（除非您明确表示要使用 Debug->Exceptions 菜单中断已处理的异常）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T18:21:18.077

在调试菜单上 -> 异常

您可以选择要捕获或不捕获的异常。这是您的意思吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-22T16:51:09.423

这里发生的事情（很尴尬）是我无意中取消了项目属性/Web/调试器中的 ASP.NET。

# vb.net - 返回 Stringbuilder 内容

> ID：573494
> 
> 赞同：2
> 
> 时间：2009-02-21T18:15:50.040
> 
> 标签：vb.net, string, stringbuilder

我知道微不足道，但只是感兴趣

我有一个 stringbuilder 变量，我想返回它的内容，但如果它是空的，我想返回“|”，所以最好在比较语句中使用 stringbuilder.tostring，例如

```
 If lReturnStringBuilder.ToString = String.Empty Then
                lReturnStringBuilder.Append("|")
            End If
return lreturnStringBuilder.tostring 
```

还是最好将其转换为字符串并进行比较，即使这意味着加载一个新变量并为其分配字符串空间，例如

```
Dim lString as string = lReturnStringBuilder.ToString
if lString = string.empty then
      lstring = "|"
end if
return lString 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-21T18:22:17.980

这是您真正不需要担心的那种微优化。但是，无论如何，我都会发布我认为最优雅（和最有效）的方式：

```
Dim result = If(lReturnString.Length = 0, "|", lReturnString.ToString()) 
```

这样可以避免将空的 StringBuilder 不必要地转换为字符串（或者然后调用 Append，这绝对不是必需的）。请注意内联 If 语句 (VB 9.0) 的使用，它不会*在*任何一种情况下评估这两个语句，因为它是一种语言构造而不是函数（完全等同于具有变量赋值的普通 If 语句）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T18:20:20.263

无论您做什么，您都在分配“字符串空间”。ToString 函数为您提供一个字符串，无论您是否将值分配给变量。所以我建议你最好将 ToString() 的值分配给一个变量，然后测试一个空字符串的变量值。类似的东西（对不起，我是一个 C# 人，但希望这能在 VB 中工作）：

```
Dim returnVal as String
returnVal = lReturnString.ToString()
If String.IsNullOrEmpty(returnVal) Then
  returnVal = "|"
End If 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-21T18:53:33.583

您应该避免在 StringBuilder 上调用 ToString，然后将更多内容附加到它。当您调用 ToString 方法时，您将获得 StringBuilder 内部使用的字符串。如果您随后将更多内容附加到 StringBuilder，它必须分配一个新字符串。

只需使用 Length 属性来检查 StringBuilder 是否为空，如果是，则不必让 StringBuilder 来创建结果。

```
If lReturnStringBuilder.Length = 0 Then
   Return "|"
Else
   Return lReturnStringBuilder.ToString()
End If 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T18:36:23.827

您可以使用 StringBuilder 对象的[Length](http://msdn.microsoft.com/en-us/library/system.text.stringbuilder.length.aspx)属性。这样您就可以避免第一次调用 ToString() ：

```
If lReturnStringBuilder.Length = 0 Then
   lReturnStringBuilder.Append("|")
End If

Return lReturnStringBuilder.ToString() 
```

或者

```
If lReturnStringBuilder.Length = 0 Then
   Return "|"
End If

Return lReturnStringBuilder.ToString() 
```

# javascript - 将选定区域作为图像上传到服务器

> ID：573498
> 
> 赞同：1
> 
> 时间：2009-02-21T18:18:11.390
> 
> 标签：javascript, firefox, firefox-addon, greasemonkey

我想创建一个应用程序（Firefox 扩展），它将抓取一个屏幕区域，保存为图像并上传到服务器。

这是我的路线图：

首先，我将创建一个适用于所有域的*greasemonkey用户脚本。*当任何页面加载时，它会添加一个名为`screengrab + upload`. 当用户单击按钮时，它将添加一个鼠标处理程序，以便我可以绘制一个`div`元素。

通过这个可调整大小`div`的元素，我将在网页上选择一个矩形区域。在`MouseUp`事件中，我将在选定区域上添加一个等效`Canvas`元素。

然后我将使用`todataurl`函数将所选区域转换为图像/png。现在，我想将此数据上传到我的服务器。因为我的服务器与网页的域不同，所以我需要通过跨域脚本将数据（image/png base64 编码）上传到服务器。

对于图片上传，我将`iframe`在网页中添加一个隐藏在我的域中的内容。从网页，数据将作为变量发布到此`iframe`，然后从`iframe`，数据将发布到我的服务器。

最后，我将使用编译器/转换将*greasemonkey*脚本转换为FireFox 扩展。

我可以这样申请吗？请提出正确的方法来做到这一点。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-28T22:33:48.107

是的，你完全可以做到这一点。编写你的 GM 脚本（我建议[包括 jQuery](http://joanpiedra.com/jquery/greasemonkey/)以使其更容易）。当你让它在 GM 中工作时，使用[User Script Compiler](http://arantius.com/misc/greasemonkey/script-compiler)对其进行扩展。

# .net - 正则表达式电子邮件 - 忽略前导和尾随空格？

> ID：573504
> 
> 赞同：11
> 
> 时间：2009-02-21T18:23:00.757
> 
> 标签：.net, regex, email

我们正在使用以下内容在 ASP.NET 中进行电子邮件验证：

```
\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)* 
```

如何修改它以忽略前导和尾随空格？

我们在回发的代码中处理的实际修剪但如果用户通常由于复制和粘贴而有额外的空间，则验证器将触发为无效。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-21T18:28:02.553

您可以`\s*`在图案前后放置，它应该可以正常工作。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-21T18:27:22.430

将您想要的内容分组到命名捕获中，然后在捕获之前和之后允许空格

```
\s*(?<email>\w+([-+.']\w+)@\w+([-.]\w+).\w+([-.]\w+)*)\s* 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-21T18:24:46.133

只需在将其传递给验证器之前进行修剪。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-06-17T08:26:20.713

在 ASP.NET 的情况下，以下工作：

```
<asp:TextBox runat="server" ID="EmailAddress" />
<asp:RegularExpressionValidator ValidationExpression="\s*\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*\s*" runat="server" ControlToValidate="EmailAddress" Text="*" ErrorMessage="Email is not valid"  /> 
```

允许各种电子邮件，例如：

```
"some@one.com"
"  some@one.com  "
"so_me@one.co.uk"
" a.s-d__+f@asd.as.as " 
```

ETC

确保像这样去除代码中的空格：

VB`Dim Email as string = EmailAddress.Text.Trim()`

C＃`string Email = EmailAddress.Text.Trim();`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-02-07T23:56:42.010

我打算作为一个简单的评论来“回答”这个问题，但你问题的真正答案**是没有答案**。

为什么？

因为任何在其前后带有空格或空格的电子邮件地址都是**无效**的电子邮件地址。

例如，您尝试将带有空格字符的电子邮件地址传递到 SMPTP 控件中，然后尝试发送它，**它会失败**！

所有电子邮件地址都必须从这个正则表达式的角度进行验证......

> \w+([-+.']\w+) *@\w+([-.]\w+)* .\w+([-.]\w+)*

甚至这个

> /.+@.+/

其他任何内容**都是**无效的电子邮件地址。

真正解决它的方法是在传递到电子邮件控件以使用它之前对字符串进行 TRIM()。

只是警告你。

# asp.net - 将 DataTable 绑定到 gridview 并将 Edit Capability 添加到网格

> ID：573518
> 
> 赞同：1
> 
> 时间：2009-02-21T18:34:25.517
> 
> 标签：asp.net, gridview

我想知道何时要将基于 searchResult 生成的 dataTable 绑定到 gridview 的最佳方法（*现在我们想显示一条记录*），

现在我们如何为 gridview 中显示的这条记录添加**编辑删除功能**？我们有多少种方法，

我知道一些，但我想重塑我的知识，并找到更好的方法

*（用户点击按钮后，信息将被绑定。）*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T18:40:20.510

您可以使用 SQLDataSource 控件而不是使用数据表，该控件将允许您设置要执行的不同 SQL 命令。通过将您的gridview 绑定到这个数据源，您可以使用编辑/更新命令按钮修改gridview，修改gridview 编辑模板等。这将为您提供一种相当简单的方法。

如果您正在寻找可以让您更好地控制整个过程的东西，这里有一个为 gridview 设置插入/更新/删除功能的教程：

[http://www.aspdotnetcodes.com/GridView_Insert_Edit_Update_Delete.aspx](http://www.aspdotnetcodes.com/GridView_Insert_Edit_Update_Delete.aspx)

# language-agnostic - 将二次曲线点转换为多项式表示？

> ID：573522
> 
> 赞同：3
> 
> 时间：2009-02-21T18:36:42.657
> 
> 标签：language-agnostic, bezier, curve, polynomial-math, quadratic

我有*二次贝塞尔*曲线的 2 个*端点*和 1个*贝塞尔*点的 X、Y。

 *使用这些数据，我如何推导出曲线的*多项式表示？*

[![替代文字](https://i.stack.imgur.com/LUov7.gif)](https://i.stack.imgur.com/LUov7.gif)
[（来源：[euclidraw.com](http://www.euclidraw.com/Eng_fls/EUC_htmls/Bezier_fls/quad.gif)）]

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-21T18:46:04.367

B(t) = (1-t) * (1-t) * B0 + 2 * (1-t) * t * B1 + t * t * B2

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T18:41:58.260

哎呀。那会很棘手。[贝塞尔](http://en.wikipedia.org/wiki/B%C3%A9zier_curve)曲线是参数化曲线，即：

```
x = f(t)
y = g(t) 
```

其中 t=0 产生一个端点，而 t=1 产生另一个端点。

从技术上讲，您可以弄清楚如何消除“t”并在 x 和 y 中得到一个方程，但它不会是像 y = a + bx + cx ² ... 这样的多项式；这将是一个方程 h(x,y) = 0，其中 h 可能有点难看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T18:44:54.650

[维基百科](http://en.wikipedia.org/wiki/B%C3%A9zier_curve#Polynomial_form)有一个关于此的部分。也许这会有所帮助。

# c++ - 使用自定义用户输入处理在屏幕上播放透明视频

> ID：573523
> 
> 赞同：0
> 
> 时间：2009-02-21T18:37:24.510
> 
> 标签：c++, windows, directx, transparency

我需要在 Windows 的屏幕上播放动画角色。基本上，它将是具有透明度的字符视频，并且只有非透明部分应该能够接受用户输入（例如鼠标点击），所有其他事件都应该传递到底层窗口。

我制作了一个简单的透明 DirectX 窗口，其中包含视频。但我不知道如何使该窗口的某些部分“透明”以供用户输入。所以如果我点击角色，我的应用程序应该接受这个点击，如果我点击视频的透明部分——点击应该由底层窗口处理。我怎样才能做到？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T16:48:07.290

我假设您的意思是 Direct Show 而不是 DirectX？

您可以使用视频混合渲染器来完成。与任何直接展示它的东西一样，它不一定很容易。

首先将视频连接到 VMR 过滤器。
其次，对于动画角色，您需要做的就是构建一个简单的 DirectShow 推送源过滤器（在 DirectShow 示例中很好地解释了它），它提供了动画帧。第三，您需要创建一个 IVMRImageCompositor 类。然后，您可以使用 DirectX 来合成图像。

# .net - FxCop 告诉我使用 .Net Uri 类是不是错了？

> ID：573528
> 
> 赞同：3
> 
> 时间：2009-02-21T18:41:37.980
> 
> 标签：.net, url, amazon-s3, uri, fxcop

在获取 Amazon S3 存储桶中某物的 URL 时，它可以在末尾附加一个签名以确认用户有权查看该对象，并且该 URL 如下所示：

> [https://mybucket.amazonaws.com/mykey?AWSAccessKeyId=myaccesskey&](https://mybucket.amazonaws.com/mykey?AWSAccessKeyId=myaccesskey&) Expires=1235241261&Signature= **t5vFBWXaN0DvVaWfck9n2%2fmTzOU%3d**

这些 URL 作为字符串对象从我的 S3 库中返回，我就这样传递它们。最近我通过 FxCop 运行我的代码，它建议我使用`Uri`该类来传递 URL。我接受了 FxCops 的建议并将我的 URL`string`属性更改为`Uri`属性。一切似乎都运行良好，直到很久以后我才注意到并非所有对象都被成功取回。

问题的原因是`Uri`类`ToString()`函数会返回一个稍微不同版本的 URL：

> [https://mybucket.amazonaws.com/mykey?AWSAccessKeyId=myaccesskey&](https://mybucket.amazonaws.com/mykey?AWSAccessKeyId=myaccesskey&) Expires=1235241261&Signature= **t5vFBWXaN0DvVaWfck9n2/mTzOU=**

我的解决方案是使用类的`OriginalString`属性`Uri`。但是对此感觉有些不对劲，我有两个问题，

*   我应该接受 FxCops 的建议并使用`Uri`课程吗？
*   亚马逊是否应该意识到 URL 可能会经过许多人的手，而不是依赖于它们以完全相同的方式返回？

对于使用 .Net Uri 类，我可以确定我的 URL 始终有效，但它似乎会导致更微妙的错误。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T18:59:12.510

FxCop 建议使用 Uri 类而不是原始字符串并没有错。使用 Uri 类提供了类型安全性和几个有用的解析方法。

System.Uri 会自动对查询字符串进行一些编码和解码。听起来您并没有预料到这种行为，并且它引起了一些问题。我建议根据 HTTP 标准检查 URI 中应该转义的字符。

这是一篇维基百科文章，更详细地描述了[百分比编码](http://en.wikipedia.org/wiki/Percent-encoding)或 URL 编码。

您的具体问题是`%2f`正斜杠`/`字符的 URL 中的转义序列。System.Uri 类为您解码了该序列。

当然，System.Uri 并不完美。Rick Strahl 最近在他的博客上谈到[了 Uri 字符串编码的不同选项。](http://west-wind.com/weblog/posts/617930.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-10T18:39:44.297

我同意 dthrasher。FxCop 没有错。但是 FxCop 没有告诉您的是使用 System.Uri 时可能会遇到的痛苦，尤其是使用 ASP.NET 时。我刚刚写了一篇文章，可以帮助您更好地准备使用这个类，这可能有点令人困惑：

[http://web.archive.org/web/20091015051451/http://www.pluralsight.com/community/blogs/keith/archive/2009/10/10/did-fxcop-tell-you-to-use-系统 uri.aspx](http://web.archive.org/web/20091015051451/http://www.pluralsight.com/community/blogs/keith/archive/2009/10/10/did-fxcop-tell-you-to-use-system-uri.aspx)

# php - symfony 1.1 中的自定义 500 错误页面

> ID：573538
> 
> 赞同：5
> 
> 时间：2009-02-21T18:47:32.553
> 
> 标签：php, symfony1

如果发生致命的 PHP 错误，symfony 会重定向到自定义错误页面吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-25T07:45:48.273

是的，你可以把文件放在这里

```
/www/site/web/errors/error500.php
/www/site/web/errors/unavailable.php 
```

阅读更多[19-Mastering-Symfony-s-Configuration-Files](http://www.symfony-project.org/book/1_1/19-Mastering-Symfony-s-Configuration-Files)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-21T22:33:18.330

不，您需要在 Apache 级别进行设置。

并确保它是一个平面 HTML 页面 - 如果 PHP 导致错误并且您尝试提供 PHP 驱动的 500 页面，您可能会再次收到错误，Apache 会发现您的错误页面正在重复出现并显示它自己的页面。

.htaccess 文件中的示例

```
ErrorDocument 500 /errors/500.htm 
```

# c# - 何时何地使用 LINQ to Objects？

> ID：573539
> 
> 赞同：6
> 
> 时间：2009-02-21T18:47:59.930
> 
> 标签：c#, .net, vb.net, linq

在哪些情况下我应该使用 LINQ to Objects？

显然，我可以在没有 LINQ 的情况下做任何事情。那么在哪些操作中 LINQ 实际上可以帮助我编写**更短**和/或**更易读**的代码？

*[这个问题由此引发](https://stackoverflow.com/questions/573026/how-to-convert-this-code-to-linq)*

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-21T19:03:06.260

我发现 LINQ to Objects 在所有地方都很有用。它解决的问题非常普遍：

*   您有一些数据项的集合
*   您想要另一个集合，该集合由原始集合形成，但经过某种转换或过滤。这可能是排序、投影、应用谓词、分组等。

这是我经常遇到的情况。有很多编程领域基本上涉及将一个集合（或数据流）转换为另一个。在这些情况下，使用 LINQ 的代码几乎总是更短且更易读。我想指出，不应将 LINQ 视为查询表达式的同义词——如果只需要一个运算符，[那么通常的“点表示法”（使用扩展方法）通常可以更短且更具可读性](http://msmvps.com/blogs/jon_skeet/archive/2009/01/07/you-don-t-have-to-use-query-expressions-to-use-linq.aspx)。

我特别喜欢 LINQ to Objects 的原因之一是它*非常*通用 - 而 LINQ to SQL 可能只涉及您的数据层（或几乎成为数据层），LINQ to Objects 适用于每一层，并在各种应用中。

举个例子，这是我的 MiniBench 基准测试框架中的一行，将 a `TestSuite`（基本上是一个命名的测试集合）转换为一个`ResultSuite`（一个命名的结果集合）：

```
return new ResultSuite(name, 
    tests.Select(test => test.Run(input, expectedOutput))); 
```

如果`ResultSuite`需要针对某个特定的“标准”结果进行缩放，那么再次：

```
return new ResultSuite(name, 
    results.Select(x => x.ScaleToStandard(standard, mode))); 
```

如果没有 LINQ，编写这段代码并不*难*，但 LINQ 只是让它更清晰，让您专注于真正的“逻辑”，而不是迭代循环和将结果添加到列表等的细节。

即使 LINQ 本身不适用，为了 LINQ 而主要包含的一些特性（例如，隐式类型的局部变量、lambda 表达式、扩展方法）也可能非常有用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-21T19:08:25.717

答案**几乎无处不**在。一个更好的问题是何时*不*使用它。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-23T07:06:38.430

LINQ 非常适合“滑坡”。想想许多常见操作中涉及的内容：

*   **哪里**。只需编写一个 foreach 循环和一个“if”
*   **选择**。创建一个目标类型的空列表，遍历原件，转换每一个并将其添加到结果中。
*   **排序依据**。只需将其添加到列表并调用 .Sort()。或实施冒泡排序；）
*   **ThenBy**（按 PropertyA 排序，然后按 PropertyB 排序）。比较难。自定义比较器和排序应该可以解决问题。
*   **GroupBy** - 创建一个`Dictionary<key, List<value>>`并循环遍历所有项目。如果不存在密钥，请创建它，然后将项目添加到适当的列表中。

在每种情况下，过程方式都比 LINQ 方式需要更多的代码。在“如果”的情况下，它多出几行；在 GroupBy 或 OrderBy/ThenBy 的情况下，它更多。

现在采取一个非常常见的场景，将它们组合在一起。你突然看到了一个 10-20 行的方法，它可以在 LINQ 中用 3-4 行来解决。并且保证 LINQ 版本更易于阅读（一旦您熟悉 LINQ）。

那么什么时候使用 LINQ？我的回答：每当你看到“foreach” :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T18:56:10.737

LINQ 在以下几种情况下非常有用：

*   您想使用类型化的“业务实体”而不是数据表来更自然地访问您的数据（并且还没有使用 NHibernate 或 LLBLGenPro 之类的东西）
*   您想使用类似 SQL 的语法查询非关系数据（这在查询列表等时非常方便）
*   你不喜欢大量的内联 SQL 或存储过程

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T18:59:17.657

当您开始对复杂数据类型进行复杂过滤时，LINQ 就会发挥作用。例如，如果给您一个 People 对象列表，并且您需要收集该列表中所有医生的列表。使用 LINQ，您可以将以下代码压缩为单个 LINQ 语句：

（伪代码）

```
doctors = []
for person in people:
    if person is doctor:
        doctors.append(person) 
```

（对不起，我的 C# 生锈了，类型检查语法可能不正确，但你明白了）

```
doctors = from person in people where person.type() == doctor select person; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-21T19:14:45.887

编辑：在我回答后，我看到了“LINQ to Objects”的变化。那好吧。

如果我们通过 LINQ 引用 System.Linq 中的所有新类型以及新的编译器功能，那么它将有很多好处——它有效地将函数式编程添加到这些语言中。（这是我见过几次的进展（虽然这主要是 C# -- VB 在当前版本中受到限制）。

显而易见的开始是任何与列表处理相关的事情都变得非常容易。很多循环可以消失。你得到什么好处？您将开始更多地以声明方式进行编程，这将导致更少的错误。切换到这种风格时，事情开始“正常工作”。（我觉得 LINQ 查询语法不太有用，除非查询非常复杂，有很多中间值。在这些情况下，语法将解决所有问题，否则您必须传递元组。）

接下来，匿名方法的语言支持（在 C# 和下一版本的 VB 中）允许您以更短的方式编写更多的构造。例如，处理异步回调可以在启动它的方法中定义。在这里使用闭包将导致您不必将状态捆绑到不透明的对象参数中并稍后将其强制转换。

能够使用高阶函数会让你思考得更笼统。所以你会开始看到你可以在哪里简单地传递一个 lambda 并更简洁地解决问题。此时，您会意识到只有使用泛型才能真正发挥作用。当然，这是 2.0 的一个特性，但在传递函数时使用更为普遍。

在那里，你会进入收益递减点。声明和使用 func 以及声明所有泛型类型参数（在 C# 和 VB 中）的成本相当高。编译器不会为您解决问题，因此您必须手动完成所有操作。这会增加大量的开销和摩擦，从而限制了您可以走多远。

那么，这就是“LINQ”吗？也许取决于营销。LINQ 推动使这种风格的 C# 编程变得更加容易，并且所有 LINQ 都基于 FP 思想。

# c++ - 如何在代码中引用资源文件夹

> ID：573540
> 
> 赞同：2
> 
> 时间：2009-02-21T18:48:14.267
> 
> 标签：c++, macos, qt, bundle

我正在将一个 c++ Qt 应用程序从 Windows 移植到 OSX，我无法理解 .app 捆绑包的概念。我希望有人能帮助我理解。

我的可执行文件在这里：MyProgram.app/Content/MacOS/MyProgram.exe

我的资源文件夹位于：MyProgram.app/Content/Resources/

在我的代码中，我使用相对路径来引用资源文件夹中的项目：

“../资源/something.png”

如果我打开 .app 包并直接运行 .exe，这将非常有用。

但这不是 .app 捆绑包的工作方式。用户应该单击 Finder 中的 .app 包来运行程序。但在那种情况下，我的相对路径不再有效，这是我不明白的。

有谁了解我的问题以及我该如何解决？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-22T14:19:32.783

```
QApplication::applicationDirPath() 
```

[http://doc.qt.io/qt-5/qcoreapplication.html#applicationDirPath](http://doc.qt.io/qt-5/qcoreapplication.html#applicationDirPath)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T10:23:56.537

我们用：

```
QDir
CoreDir::bundle()
{
    // Trolltech provided example
    CFURLRef appUrlRef = CFBundleCopyBundleURL( CFBundleGetMainBundle() );
    CFStringRef macPath = CFURLCopyFileSystemPath( appUrlRef, kCFURLPOSIXPathStyle );
    QString path = CFStringToQString( macPath );
    CFRelease(appUrlRef);
    CFRelease(macPath);
    return QDir( path );
} 
```

CoreDir::bundle().filePath("../Resources"); 也是如此。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T18:53:38.653

当您编译您的产品时，您是否尝试过将路径设置`Resources`为相对？否则，您可以检索主包、其应用程序的 URL 并将其附加到资源 URL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T19:23:18.177

[捆绑编程指南](https://developer.apple.com/library/mac/documentation/corefoundation/conceptual/cfbundles/AccessingaBundlesContents/AccessingaBundlesContents.html)

一切都有一本手册，似乎:)

# java - Java 是否需要重新启动？

> ID：573543
> 
> 赞同：3
> 
> 时间：2009-02-21T18:51:18.737
> 
> 标签：java, programming-languages

Java 现在已经快 14 岁了，而且年龄开始显现。在我的行业（银行业），我们开玩笑说 Java 是 21 世纪的 COBOL；除了这不是一个笑话，这是可悲的现实。

Java 有很多“包袱”是为了向后兼容而保留的——这正是对银行等客户至关重要的东西。但我经常认为是时候重新启动了。只需阅读“Java Puzzlers”即可找到语言设计中的痛点列表。我不是在责怪语言设计者——在过去的 14 年中吸取了很多教训！然而，我真的很喜欢一些重大的变化，它们会很高兴地打破向后兼容性，同时让语言变得更好。

这是我将在语言中更改的（非常部分）列表：

*   删除所有已弃用的项目。例如，现在是 Thread.stop 和朋友死亡的时候了。
*   禁止超载。那是一个错误。（我知道这个有点争议，但是……）
*   构造函数必须是私有的，只有。静态方法应该作为工厂方法来获取实例。这允许进行主要和重要的优化。（再次，有争议，但学术界似乎同意。另见*有效 Java*中的第 1 项。）
*   丢弃 API 的死/错误设计部分。特别是，修复 Date 类。
*   删除“最终确定”。
*   放弃对泛型类的“原始”变体的支持。没有了`List`；它必须是`List<Something>`。
*   特性。当你在它的时候，没有非私人领域。
*   提供“equals”的默认实现，它遍历字段并调用它们的“equals”；允许一些注释（“@NonState”）标记不属于相等性测试的字段。
*   "==" 应该调用 equals(); 为身份添加一个新的运算符“is”。
*   从对象中删除“克隆”；只有实现 Cloneable 的对象才应该有这个方法。
*   允许对测试类进行特殊注释；测试类应该能够访问同一包中所有类的私有成员。
*   充分利用库中的枚举——目前，许多旧类使用 int 常量。
*   删除“Thread.run”；Thread.start 应该接受一个 Runnable 对象（您会惊讶于我所看到的调用 Thread.run 而不是 Thread.start 的错误数量）。

这只是我的想法......所以，我想听听：

*   您是否同意重新启动 Java（新版本破坏与旧代码的兼容性）将是一件好事？
*   你的烦恼是什么，你认为需要用语言解决的问题是什么？我自己的示例侧重于破坏兼容性的项目——在不破坏现有代码的情况下，您在当前 Java 中无法做到的事情。但也欢迎其他想法。

**澄清：**我不是在寻找新的语言（如 Scala 或 C#）。我正在寻找显然仍然是 Java 的东西——但需要对现有代码进行一些移植工作。请注意，对于我建议的许多更改，可以自动或半自动地移植代码。我知道银行不会很快采用它（嘿，我在那里*工作*）但我也知道银行经常启动新项目，并且希望在享受更好的语言的同时利用现有程序员的知识。

对于那些声称，对于我的许多建议，团队可以只执行自己的规则（例如，不重载）的所有人：确实如此，但我们高度依赖第三方代码。不是每个人吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-21T18:56:50.517

我认为语言从来没有进行过这种极端的改造，尤其是不会像您的建议那样以一百万种不同的方式破坏向后兼容性的语言。相反，你会得到一门新的语言。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-21T19:11:57.563

好吧，我不得不说，不管 C#、Scala 或 Groovy 的粉丝是否同意，我认为这里的一些建议完全是愚蠢的。

1) 任何犯错误调用 Thread.run 而不是 Thread.start 的人都不应该编程。在这里，程序员有错，而不是框架或语言。

2）不允许重载？为什么，你到底为什么要这样做。这又是没有意义的，它会导致什么问题？我发现重载在任何情况下都非常有用。

3）工厂方法和构造函数之间的真正区别是什么。这就是构造函数，它们是创建对象实例的工厂方法。如果您想要或更喜欢工厂方法，那么实施它们......并不难

4）==调用equals（），运算符重载是进入面向对象领域的最糟糕的想法之一。您是否意识到使用一组重载运算符会变得多么复杂 C++ 程序。它并不明显，并且需要耗时的分析。

5) 如果删除了不推荐使用的方法，Java 将彻底死去。为什么不直接忽略它们？每种语言都在朝着这个方向发展，没有一种语言是完美的，只有在开发人员继续使用它并升级时，错误才能被弃用。

尽管您的一些评论是有道理的，但我发现缺乏经验会使人们倾向于原则​​和理想，并且通过经验您会意识到实用主义才是最重要的。为什么让 Java 变得完美才是最重要的，当然是你可以用它做什么。我认为闭包、具体化的泛型和属性是唯一需要的基本增强功能。

Java 不是娱乐的玩具，它在这里很流行，因为企业建立在它之上并依赖它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-21T19:10:08.753

与大多数其他语言相比，有*更多*的人致力于从 java 中挤出 h*ll。您可以选择专注于不好的事情，而 J2EE 是该语言生命周期中可悲的一部分。

我今天写的 java 代码和我 5 年前写的 java 代码*毫无共同之处。*我不相信我使用了5 年前使用的*单个库。*重启已经发生。

虽然我也是一名 C# 程序员，但我认为慢慢行动也很有价值。只是疯狂地添加功能未必是好事。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-21T18:58:19.267

我不知道您是否看过[Scala](http://www.scala-lang.org/)，这是一种由 Java 的原始作者之一创建的新语言，它在 JVM 上运行。

语言很少会得到你描述的那种“重启”，你通常只会得到新的语言。VB是我能想到的唯一例外。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-21T19:00:15.907

打破遗留代码只会为大型企业提供考虑其他平台的理由。1970 年代 C 仍然在当今的编译器中编译……尽管某些函数可能被标记为已弃用（这是一个更好的解决方案，IMO）。如果因为我的团队升级到更新版本的 Java 而导致企业应用程序的大部分无法编译，我会非常愤怒。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-21T19:22:10.737

> 禁止超载。那是一个错误。（我知道这个有点争议，但是……）

不使用重载是 IMO 的一个更大的错误，导致代码的可维护性降低。例如从 OpenGL API 看一下这个页面。（C 语言，无重载）[glColor](http://www.opengl.org/sdk/docs/man/xhtml/glColor.xml)

> 充分利用库中的枚举——目前，许多旧类使用 int 常量。

是否因为 int 常量而损坏？

没有冒犯，但是这和你的大部分观点听起来有点强迫症，而不是实际使用编码时间。优秀的开发人员已经可以解决这些问题，或者避免使用被认为不好的功能。此外，如果一个库已经可以工作，没有理由仅仅为了“使用枚举”等而改变它。丢弃好的调试代码是一种巨大的浪费。

考虑到“重新启动”，这里有一个链接到 Joel of Software 的关于从头开始重写的文本。不是 100% 相关，但还是有点相关 :)[你不应该做的事情，第一部分](http://www.joelonsoftware.com/articles/fog0000000069.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-21T18:55:12.177

我同意突破性的修订是个好主意。从您的列表中，我特别喜欢属性——可能类似于 C# 的实现。获取/设置样板的数量惊人，而且没有理由这样做。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-21T18:56:44.450

您要求的大部分内容是 API 更改而不是语言本身。如果您对当前的基类库不满意，您始终可以设计自己的基类库并从它开始。

除了告诉您这样做，但您始终可以在尝试解决当前问题之前寻找*替代方案*，还有 .NET 具有您所要求的许多功能。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-21T19:03:27.273

我认为 Java 不应该（也不会）重新启动。每种语言都有它的问题，现在 Java 已经足够成熟以至于它的问题众所周知（并且优秀的开发人员可以考虑到它们），语言应该改变吗？？没门。

当然，可以开始一种基于 Java 经验教训的新语言。其实它已经在这里了，它的名字是C#。太糟糕了，它实际上是专有的 MS 产品。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-21T19:17:54.913

> 您是否同意重新启动 Java（新版本破坏与旧代码的兼容性）将是一件好事？

不，至少没有迁移路径。让您的客户出海是一个非常糟糕的主意。对他们进行教育（特别是关于弃用及其含义）并鼓励他们转向新的实践（例如，可能通过提供代码诊所）是很重要的。另一个例子（可能更有效）是通过服务合同继续支持遗留代码（我认为 Sun 无论如何都在做这件事）。

> 你的烦恼是什么，你认为需要用语言解决的问题是什么？我自己的示例侧重于破坏兼容性的项目——在不破坏现有代码的情况下，您在当前 Java 中无法做到的事情。但也欢迎其他想法。

Steve Yegge 曾将 Java 称为“名词王国”，我不得不同意他的观点。我理解它的原因，但是多年来不得不调用“setter”和“getter”之类的东西使得代码变得庞大而嘈杂。我还认为列表、映射、正则表达式和 XML 的文字早就应该使用了。事情可能要麻烦得多——Java 本可以在没有字符串文字的情况下推出。想想那会是什么样子。

我不认为该语言需要诸如闭包之类的新结构。一些人认为 Java 已经有了匿名内部类。它们是“名词-y”闭包。如果 Java 平台（JVM）是​​固定的，这样运行在它上面的其他语言可以朝那个方向发展，那就更好了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-21T19:02:44.420

银行通常对尖端技术不感兴趣。银行需要成熟、稳定的技术和良好的业绩记录。流行的语言很少使用，它们只出现了几年，所以发明一种新的语言会看到它被引入银行业，直到它已经流行了一段时间并且有很多相同的包袱。

大多数 Java 谜题在编程语言中已经存在了一段时间，并且仍然存在于新语言中。这些是用 Java 编写的编程难题。

我想大多数人都会不同意你的大部分观点，即使是我同意的。这就是开始一门新语言的问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-21T19:03:47.257

> Java 现在已经快 14 岁了，而且年龄开始显现。

它只是一种语言。如果你做了所有你提议的改变，我不相信它会成功——java 花了 5 年时间才找到它的位置，并且“重新启动”会导致向后可计算性问题。

这似乎不是什么大问题，但对于许多公司来说，这意味着全球数十亿美元的转换成本。

此外，您还可以在相同的服务器上运行旧版本和新版本，并获得有趣的结果或复杂的配置。

这些问题是否会阻止您做您需要做的事情？然后别担心。

Java 的维护者知道，如果他们不保持最新，人们会随着时间的推移转而使用一种较新的语言，他们会改变它以适应。

但请记住，旧语言消亡和新语言成熟是好事。随着计算机的变化，保持一种语言在积极使用和开发中并不总是最好的，或者用一些向后兼容的破坏但恢复活力的药水重新激活它。

-亚当

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-21T19:22:06.463

您提到的大多数项目都很容易由开发人员控制，我认为这很好。

我们可能会浏览完整的列表，但我认为第一个项目就可以了。

> *删除所有已弃用的项目。例如，现在是 Thread.stop 和朋友死亡的时候了。*

只是不要使用它们。

> *禁止超载。那是一个错误。（我知道这个有点争议，但是……）*

不要超载

> *构造函数必须是私有的，只有。静态方法应该用作工厂......*

将所有构造函数设为私有。

等等等等。

好处是您的大多数人可以选择在内部（与每个开发团队）强制执行所有这些项目，而不是更改整个语言并完全分开。

我认为需要进行良好的刷新，但出于不同的原因，您的列表中没有一个（例如闭包）。

可能不会修改 Java 语言，而是支持更多和新的语言，如 Groovy、Ruby、Python（JRuby 或 XRuby、Jython 等），并且每次都增强 JVM。

我非常高兴我已经升级了旧的 webapp 系统，并且仅通过将 JRE 从 Java 1.2 更改为 1.3 和 1.4 来提高性能。

* * *

## 回答 #14

> 赞同：-4
> 
> 时间：2009-02-21T18:57:33.997

12 年前我脱离了 Java。12！当时，我不同意 J2EE 即将发生的变化。

我喜欢该语言的许多概念，但是得到 Sun（糟糕）的支持并没有帮助，并且需要从头开始进行重大重建。

一些新的东西，“像java”。

而且，在我的（小）社区中，不幸的是，所有 Java 开发人员都被称为“恐龙”，因为他们的行为就像过去的 COBOL 开发人员一样……沉浸在自己的世界中，不知道事情已经发生了变化，大多没有他们。

# javascript - 使此函数可防御空/空字符串等

> ID：573551
> 
> 赞同：2
> 
> 时间：2009-02-21T18:56:37.740
> 
> 标签：javascript

我怎样才能使这个函数对空/空字符串更加“防御”？

```
function getSecondPart(str) {
    return str.split('-')[1];
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-21T18:58:30.093

```
function getSecondPart(str) {
    if(str === undefined ||
       typeof str != 'string' ||
       str.indexOf('-') == -1) return false;
    return str.split('-')[1];
}
console.log(getSecondPart({}); // false
console.log(getSecondPart([]); // false
console.log(getSecondPart()); // false
console.log(getSecondPart('')); // false
console.log(getSecondPart('test')); // false
console.log(getSecondPart('asdf-test')); // test 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T19:04:03.853

我会说：

```
function getSecondPart(str) {
    if (typeof str !== "string" || str.indexOf("-") === -1) return false;
    return str.split("-")[1];
} 
```

# audio - 可听音频 (.aa) 文件规范？

> ID：573557
> 
> 赞同：2
> 
> 时间：2009-02-21T18:58:14.710
> 
> 标签：audio

有谁知道有声音频（.aa）文件规范的好资源？

我正在尝试编写一个可以使用它们的程序，如果没有人知道资源，有什么技巧可以对我自己的规范进行逆向工程吗？我在一个十六进制编辑器中打开它并四处寻找，看起来像一个 MP3，但有更多的标题信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-10-03T19:08:13.773

该站点提供了有关某些数据块在 .aa 文件中的位置的更多信息。

[http://wiki.multimedia.cx/index.php?title=Audible_Audio](http://wiki.multimedia.cx/index.php?title=Audible_Audio)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-08-14T20:10:16.953

我已经对 Audible 标头进行了一些研究，以为我的汽车收音机/电脑创建一个播放器。基本上，文件开头有一个 3700 个字符的块，其中包含许多感兴趣的字段，例如标题、作者、讲述人等。我在 C# 中有一些有限的解析代码来显示来自.aa 文件。如下：

```
 private void ParseFields(string fileName)
    {
        string aaHeader;
        string tryDate;
        if (fileName == "") return;

        using (StreamReader sr = new StreamReader(fileName))
        {
            char[] buff = new char[3700];
            sr.Read(buff, 0, buff.Length);
            aaHeader = new string(buff);
        }
        try
        {
            _author = GetParsedItem(aaHeader, "author");
        }
        catch
        {
            _author = "?";
        }
        try
        {
            _title = GetParsedItem(aaHeader, "short_title");
        }
        catch
        {
            _title = "???";
        }
        try
        {
            _narrator = GetParsedItem(aaHeader, "narrator");
        }
        catch
        {
            _narrator = "?";
        }
        try
        {
            _description = GetParsedItem(aaHeader, "description");
        }
        catch
        {
            _description = "???";
        }
        try
        {
            _longDescription = GetParsedItem(aaHeader, "long_description");
        }
        catch
        {
            _longDescription = "";
        }
        try
        {
            tryDate = GetParsedItem(aaHeader, "pubdate");
            if (tryDate != "")
                _pubDate = Convert.ToDateTime(GetParsedItem(aaHeader, "pubdate"));
            else
                _pubDate = DateTime.Today;
        }
        catch
        {
            _pubDate = DateTime.Today; 
        }
    }
    private string GetParsedItem(string buffer, string fieldName)
    {
        if (buffer.Contains(fieldName))
        {
            int pos = buffer.IndexOf(fieldName);
            pos += fieldName.Length;
            int posEnd = buffer.IndexOf('\0',pos);
            //if the value for the field is empty, skip it and look for another
            if (pos == posEnd)
            {
                pos = buffer.IndexOf(fieldName, posEnd);
                pos += fieldName.Length;
                posEnd = buffer.IndexOf('\0', pos);
            }
            return buffer.Substring(pos, posEnd - pos);
        }
        else
            return "(not found - " + fieldName + ")";
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-16T10:47:08.890

我认为，没有规范。看看[维基百科/Audible.com](http://en.wikipedia.org/wiki/Audible.com)：

引用：

```
[...]
Audible introduced one of the first digital audio players in 1997.
The following year it published a Web site from which audio files in its
proprietary .aa format could be downloaded. Audible holds a number of patents
in this area.
[...] 
```

摘要：专有/专利

# python - Python序列化词法闭包？

> ID：573569
> 
> 赞同：22
> 
> 时间：2009-02-21T19:03:12.733
> 
> 标签：python, serialization, closures

有没有办法使用标准库在 Python 中序列化词法闭包？pickle 和 marshal 似乎不适用于词法闭包。我并不真正关心二进制与字符串序列化等的细节，它只需要工作。例如：

```
def foo(bar, baz) :
    def closure(waldo) :
        return baz * waldo
    return closure 
```

我希望能够将关闭实例转储到文件中并将它们读回。

编辑：可以解决此问题的一种相对明显的方法是使用一些反射技巧将词法闭包转换为类对象，反之亦然。然后可以转换为类，序列化，反序列化，转换回闭包。哎呀，鉴于 Python 是鸭子类型的，如果你重载类的函数调用运算符以使其看起来像一个函数，你甚至不需要将它转换回闭包并且使用它的代码不会知道区别。如果有任何 Python 反射 API 专家，请说出来。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2010-11-08T14:46:46.813

PiCloud 发布了一个开源（LGPL）pickler，它可以处理函数闭包和更多有用的东西。它可以独立于他们的云计算基础设施使用——它只是一个普通的pickler。整个shebang都记录[在这里](http://docs.picloud.com/)，您可以通过“pip install cloud”下载代码。无论如何，它会做你想做的事。让我们通过酸洗一个闭包来证明这一点：

```
import pickle
from StringIO import StringIO

import cloud

# generate a closure
def foo(bar, baz):
    def closure(waldo):
        return baz * waldo
    return closure
closey = foo(3, 5)

# use the picloud pickler to pickle to a string
f = StringIO()
pickler = cloud.serialization.cloudpickle.CloudPickler(f)
pickler.dump(closey)

#rewind the virtual file and reload
f.seek(0)
closey2 = pickle.load(f) 
```

现在我们有了`closey`原始闭包和`closey2`从字符串序列化恢复的闭包。让我们测试一下。

```
>>> closey(4)
20
>>> closey2(4)
20 
```

美丽的。该模块是纯 Python 的——您可以打开它并轻松查看是什么使魔法起作用。（答案是很多代码。）

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-22T11:42:04.690

如果您只是简单地使用带有`__call__`方法的类，那么它应该与`pickle`.

```
class foo(object):
    def __init__(self, bar, baz):
        self.baz = baz
    def __call__(self,waldo):
        return self.baz * waldo 
```

另一方面，由于`pickle`处理类和实例的方式，将闭包转换为在运行时创建的新类的实例的 hack 是行不通的。 `pickle`不存储类；只有一个模块名和类名。当读回一个实例或类时，它会尝试导入模块并在其中找到所需的类。如果您使用即时创建的类，那么您就不走运了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T05:01:25.410

是的！我明白了（至少我认为）——也就是说，酸洗函数的更一般的问题。Python 太棒了 :)，我通过 dir() 函数和一些网络搜索发现了其中的大部分内容。[希望] 解决它也很棒，我也需要它。

我还没有对这个 co_code 东西的健壮性（嵌套 fcns 等）进行大量测试，如果有人可以查看如何挂钩 Python 以便可以自动腌制函数（例如，它们有时可能是闭包参数）。

Cython 模块 _pickle_fcn.pyx

```
# -*- coding: utf-8 -*-

cdef extern from "Python.h":
    object PyCell_New(object value)

def recreate_cell(value):
    return PyCell_New(value) 
```

Python 文件

```
#!/usr/bin/env python
# -*- coding: utf-8 -*-
# author gatoatigrado [ntung.com]
import cPickle, marshal, types
import pyximport; pyximport.install()
import _pickle_fcn

def foo(bar, baz) :
    def closure(waldo) :
        return baz * waldo
    return closure

# really this problem is more about pickling arbitrary functions
# thanks so much to the original question poster for mentioning marshal
# I probably wouldn't have found out how to serialize func_code without it.
fcn_instance = foo("unused?", -1)
code_str = marshal.dumps(fcn_instance.func_code)
name = fcn_instance.func_name
defaults = fcn_instance.func_defaults
closure_values = [v.cell_contents for v in fcn_instance.func_closure]
serialized = cPickle.dumps((code_str, name, defaults, closure_values),
    protocol=cPickle.HIGHEST_PROTOCOL)

code_str_, name_, defaults_, closure_values_ = cPickle.loads(serialized)
code_ = marshal.loads(code_str_)
closure_ = tuple([_pickle_fcn.recreate_cell(v) for v in closure_values_])
# reconstructing the globals is like pickling everything :)
# for most functions, it's likely not necessary
# it probably wouldn't be too much work to detect if fcn_instance global element is of type
# module, and handle that in some custom way
# (have the reconstruction reinstantiate the module)
reconstructed = types.FunctionType(code_, globals(),
    name_, defaults_, closure_)
print(reconstructed(3)) 
```

干杯，
尼古拉斯

**编辑**- 对于现实世界的案例，更强大的全局处理是必要的。fcn.func_code.co_names 列出全局名称。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-19T13:04:14.103

```
#!python

import marshal, pickle, new

def dump_func(f):
    if f.func_closure:
        closure = tuple(c.cell_contents for c in f.func_closure)
    else:
        closure = None
    return marshal.dumps(f.func_code), f.func_defaults, closure

def load_func(code, defaults, closure, globs):
    if closure is not None:
        closure = reconstruct_closure(closure)
    code = marshal.loads(code)
    return new.function(code, globs, code.co_name, defaults, closure)

def reconstruct_closure(values):
    ns = range(len(values))
    src = ["def f(arg):"]
    src += [" _%d = arg[%d]" % (n, n) for n in ns]
    src += [" return lambda:(%s)" % ','.join("_%d"%n for n in ns), '']
    src = '\n'.join(src)
    try:
        exec src
    except:
        raise SyntaxError(src)
    return f(values).func_closure

if __name__ == '__main__':

    def get_closure(x):
        def the_closure(a, b=1):
            return a * x + b, some_global
        return the_closure

    f = get_closure(10)
    code, defaults, closure = dump_func(f)
    dump = pickle.dumps((code, defaults, closure))
    code, defaults, closure = pickle.loads(dump)
    f = load_func(code, defaults, closure, globals())

    some_global = 'some global'

    print f(2) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T23:38:42.110

[配方 500261：命名元组](http://code.activestate.com/recipes/500261/)包含一个动态定义类的函数。而且这个类支持酸洗。

这是本质：

```
result.__module__ = _sys._getframe(1).f_globals.get('__name__', '__main__') 
```

结合[@Greg Ball 建议](https://stackoverflow.com/questions/573569/python-serialize-lexical-closures/574789#574789)在运行时创建一个新类，它可能会回答您的问题。

# language-agnostic - 业务对象的领域特定语言？

> ID：573580
> 
> 赞同：1
> 
> 时间：2009-02-21T19:10:42.217
> 
> 标签：language-agnostic, code-generation

我正在考虑编写一种领域特定语言 (DSL) 来为业务对象建模。DSL 不会被执行，而是由基于模板的代码生成器（可能是 CodeSmith）使用来生成 .NET 和 SQL。

DSL 需要支持以下元素的定义：

*   类（名称和描述）
*   属性（名称、友好名称、类型、null/not null）
*   简单验证（必需、正则表达式、范围等）
*   类之间的关系（1 对 1、1 对多、多对多）
*   继承（好的，也许在版本 2 中）

下面是 DSL 代码的一个简单示例：

```
Class: Insured
  Desc: "Represents a person covered by an insurance policy"
  Prop: FirstName, "First Name", String(20), not null
  Prop: LastName, "Last Name", String(20), not null
  Prop: MailAddress, "Mailing Address", Address, not null
  Prop: SSN, "Social Security Number", String(9), null      
  Rule: RegEx, SSN, ^\d{9}$

Class: Address
  Prop: Line1, "Line 1", String(30), not null
  Prop: City, "City", String(30), not null
  Prop: State, "State", String(2), not null
  ... 
```

为了保持 DSL 简单，将使用目标语言编写更复杂的验证规则。当前的计划是使生成的代码不受限制，并将更复杂的规则添加到子类中。

有没有人写过类似的东西？您能否提供任何提示或类似解决方案的链接？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T20:04:52.460

将您呈现的结构自动转换为 XML 相当容易。从那里开始，我想可以通过 XSLT 或 XQuery 将某种转换编写成您想要的任何最终结果。[我编写了一个名为CodeGenUtils](http://code.google.com/p/codegenutils)的 Visual Studio 插件来帮助进行转换。

如果您真的想编写自己的解析器，我建议您查看现有的文本 DSL 解决方案，例如[JetBrains MPS](http://www.jetbrains.com/mps/index.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T19:15:13.780

建议你看看[OSLO](http://msdn.microsoft.com/en-us/oslo/default.aspx "MSDN")，如果只是为了避免重新发明它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T20:58:51.550

我有一个名为[bdUnit](http://usingsystembeginner.blogspot.com/2009/02/bdunit-bdd-unit-test-dsl-using.html)的项目，我在其中使用[Oslo](http://msdn.microsoft.com/en-gb/oslo/default.aspx)框架的一部分来创建将用户故事建模为 C# 接口和单元测试的 DSL。

示例输入的一部分：

```
begin story "AUserStory":
begin setup 
    @Person to have a ~Spouse(@Person) 
            ~IsActive(true) 
            ~Age(0) 
            ~IsDead(false) 
            and several ~Children(@Person)
            and a ~Location(@Location)
        I want a @Person to be able to #Kill another @Person
        I want a @Person to be able to #Marry another @Person
        I want to be able to #Find all @Person
    @Location to have a ~Latitude(0.0)
            and a ~Longitude(0.0)
end setup 
```

对应生成的C#代码：

```
[PluginFamily("bdUnit")]
public interface IPerson
{
    IPerson Spouse { get; set; }
    bool IsActive { get; set; }
    int Age { get; set; }
    bool IsDead { get; set; }
    IList<IPerson> Children { get; set; }
    ILocation Location { get; set; }
    void Kill(IPerson user);
    void Marry(IPerson user);
    void Find();
}

[PluginFamily("bdUnit")]
public interface ILocation
{
    decimal Latitude { get; set; }
    decimal Longitude { get; set; }
} 
```

我在 dll 中编译接口和测试，因此它们是“禁区”。这些接口只能在继承类中实现。然后我使用[StructureMap](http://structuremap.sourceforge.net/Default.htm)将所需的依赖项注入到单元测试中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-13T02:33:55.123

嗯，它来自 Java 世界，但是使用 Eclipse 项目 TMF Xtext 这样的任务将在几分钟内完成。查看他们的主页，他们提供了非常相似的示例。

# android - 指定 Android 项目依赖项（在 Eclipse 中）

> ID：573581
> 
> 赞同：21
> 
> 时间：2009-02-21T19:11:18.127
> 
> 标签：android, eclipse, dependencies

我有两个 Android 项目，一个包含自定义布局的“库项目”和一个包含使用该布局的应用程序的“应用程序项目”。

一切似乎都可以正常构建和执行，除了可视布局编辑器抛出 ClassNotFoundException （我认为这是插件中的一个错误），但是当我尝试开始使用我为自定义布局定义的属性时xml，我无法再构建。那是; 这有效：

```
<?xml version="1.0" encoding="utf-8"?>
<se.fnord.android.layout.PredicateLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="fill_parent" 
    android:layout_height="fill_parent"> 
  <TextView
    android:layout_width="wrap_content" 
    android:layout_height="wrap_content" 
    android:text="asdfasdf"
    />
</se.fnord.android.layout.PredicateLayout> 
```

而这不是：

```
<?xml version="1.0" encoding="utf-8"?>
<se.fnord.android.layout.PredicateLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:fnord="http://schemas.android.com/apk/res/se.fnord.android"
    android:layout_width="fill_parent" 
    android:layout_height="fill_parent"> 
  <TextView
    fnord:layout_horizontalSpacing="1px"
    android:layout_width="wrap_content" 
    android:layout_height="wrap_content" 
    android:text="asdfasdf"
    />
</se.fnord.android.layout.PredicateLayout> 
```

构建失败并显示来自 aapt 的消息：

> 错误在包“se.fnord.android”中找不到属性“layout_horizo​​ntalSpacing”的资源标识符

资源标识符确实存在于 R 文件中，并且 attrs.xml 包含库项目，如果我将布局代码和资源直接放在应用程序项目中，一切正常。layout_horizo​​ntalSpacing 属性（和 layout_verticalSpacing）是 PredicateLayout.LayoutParam 类中用于指定到下一个小部件的距离的自定义属性。

到目前为止，我已经通过指定项目引用和构建路径项目依赖项尝试了标准的 Eclipse 方式。我还被告知要尝试应用程序清单中的标签，但这没有帮助。

那么，我需要做什么才能使 xml 文件中的引用起作用？

我不知道它是否相关，但“库”清单如下所示：

```
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
      package="se.fnord.android"
      android:versionCode="1" android:versionName="1.0.0">
</manifest> 
```

“应用程序”清单如下：

```
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
      package="se.fnord.appname"
      android:versionCode="1" android:versionName="1.0.0">
    <application android:icon="@drawable/icon" android:label="@string/app_name">
        <activity android:name=".AppName"
                  android:label="@string/app_name">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>
</manifest> 
```

[（顺便说一句，'PredicateLayout' 是this](https://stackoverflow.com/questions/549451)的清理版本）。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-05-21T00:26:02.560

Android sdk 的最早版本不支持在源代码级别以很好的方式共享。您可以将 .class 文件打包，然后将其添加到 lib/ 文件夹中，但此解决方案不允许直接共享源代码，同样重要的是，它不支持资源或aidl 文件的共享。

然后在 2010 年 5 月，Android 引入了 Library Project 机制。库项目的结构与普通的 Android 项目非常相似，但不是用于生成 apk，它仅用于为其他项目提供代码和资源。与普通项目一样，Library Project 通常包含 src 和 res 文件夹，以及一个 AndroidManifest.xml 文件；然而，除了 manifest 元素和 package 属性之外，清单应该大部分是空的（不再正确 - 您现在可以在图书馆项目的清单中声明活动和其他组件）。此外，库项目的 project.properties 文件需要包含以下属性：

```
"android.library=true" 
```

要从普通（生成 apk）项目引用库项目，您需要在普通项目的 project.properties 文件中添加“android.library.reference.N”行。例如，如果我的主项目想要指向两个库项目，我的主项目的 project.properties 文件将包括以下内容：

```
android.library.reference.1=../LibraryA
android.library.reference.2=../../LibraryB 
```

其中 ../ 和 ../../ 是从主项目到库项目的各自路径（这只是一个示例）。请注意，此参考列表是从 1 开始的，不应包含空白或重复。Google 很清楚这不是一个完美的系统，但它是一个与 Ant 和 Eclipse 兼容的合理解决方案。一般来说，您的 IDE 会尝试为您维护这些文件，但有时您可能需要手动编辑它们。

起初图书馆项目不支持以下内容：

1.  指向其他图书馆项目的图书馆项目
2.  包含aidl文件的图书馆项目
3.  包含资产文件夹的库项目

然而随后的 sdk 版本解决了所有这些问题。

有关图书馆项目的更多信息，请参阅[官方文档](http://developer.android.com/tools/projects/index.html#LibraryProjects)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-09-26T20:20:52.867

将项目导出为 JAR 不是通过 Properties -> Java Build Path -> Library 将库项目链接到您的应用程序项目的正确方法。也不是通过 Properties -> Java Build Path -> Projects 将项目链接为必需项目。

首先，在 Android 开发者 -> 开发 -> 管理项目中阅读库项目主题：http: [//developer.android.com/guide/developing/projects/index.html#LibraryProjects](http://developer.android.com/guide/developing/projects/index.html#LibraryProjects) 在此之后，阅读设置库在 Android 开发人员 -> 开发 -> 管理项目 -> 从带有 ADT 的 Eclipse 中再次项目和引用库项目主题

所以......步骤是：

1.  通常将您的库项目创建为 Android 项目；
2.  在项目属性中设置“is library” -> Android 正常创建你的App项目；
3.  在项目属性 -> Android -> 添加中添加对您的库的引用。

在此之后，您可以使用所有类、组件（活动、服务、提供者、接收者）、资源等。

例如：要引用 xml 布局中的任何资源，例如，您应该使用 @mylib:id/my_id 或 @mylib:layout/my_lib_layout

观察：如果您在应用项目中使用库的组件，则必须在应用清单中复制它们。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-10-26T07:28:11.823

此外，我得到了属性工作，但不是我认为应该工作的方式。

您必须在使用自定义属性的元素中使用命名空间，即主应用程序的命名空间，而不是库项目的命名空间。因此，在您的示例中，如果您为“xmlns:fnord”的值指定应用项目的命名空间，则它可以工作。

`PredicateLayout(Context,AttributeSet)`此外，在自定义构造函数中读取自定义属性时，您还必须在调用`attributes.getAttributeValue()`.

这很痛苦，因为该代码在您的库应用程序中，它不/不应该知道它所使用的应用程序项目。我通过让应用程序调用静态方法 ViewUtil.setAttributeNamespace(appNamespace) 来解决这个问题我的应用程序的 onCreate() 和库的自定义视图使用该命名空间来检索自定义属性。然后 attrs.xml 文件也可以保留在库项目中。现在唯一难看的是布局 XML 必须在自定义视图上使用应用程序的命名空间，因此您不能将这些布局 XML 放在库项目中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-03-18T06:23:14.357

将您的库项目导出为 JAR，并在应用程序项目的“Java 构建路径”中将其作为 JAR 引用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-05-20T22:43:05.070

“将您的库导出为 jar”解决方案“仅在您的库项目仅包含源代码时才有效。在这种情况下，OP 的问题提到他的库项目包含与 ui 相关的内容。

我们的团队也有同样的问题，希望拥有包含 ui 相关源和资源的库项目。我们最终彻底检查了我们的 Ant 构建系统，以便在构建期间让应用程序吞没库项目。不幸的是，似乎没有这种解决方案与 Eclipse 兼容，这是开发人员感到沮丧的主要原因。我们仍然可以使用 Eclipse，但我们必须跳过障碍才能使其正常工作，并且不得不忍受生产力下降的情况。

# c# - 我在使用 C# 的泛型和强制转换方面遇到了一些问题

> ID：573584
> 
> 赞同：0
> 
> 时间：2009-02-21T19:12:39.857
> 
> 标签：c#, generics

所以我有一个简单的验证规则模式，用于对实体对象进行验证。这是我的 ValidationRule 类：

```
public class ValidationRule {

    public Func<object, bool> Rule { get; set; }
    public string ErrorMessage { get; set; }

    public ValidationRule(string errorMessage, Func<object, bool> rule) { 
        Rule = rule;
        ErrorMessage = errorMessage;
    }

    public bool IsValid(object obj) {
        return Rule(obj);
    }
} 
```

我的实体对象有一个基类，它封装了执行验证的方法，如下所示：

```
public abstract class ModelBase {

    private List<ValidationRule> _validationRules;
    public List<ValidationRule> ValidationRules {
        get {
            if (_validationRules == null)
                _validationRules = new List<ValidationRule>();
            return _validationRules;
        }
        set { _validationRules = value; }
    }

    public ValidationResult Validate() {
        var result = new ValidationResult();
        rules.ForEach(r => {
            if (!r.IsValid(this))
                result.Errors.Add(
                    new ValidationError(r.ErrorMessage, r.PropertyName));             
            });
        return result;
    }
} 
```

现在这是我要解决的真正问题。当我创建一个从 ModelBase 继承的新类时，添加验证规则有点尴尬。例如：

```
public class Client : ModelBase {

    public int ID{ get; set; }
    public string Name { get; set; }
    public Address MailingAddress { get; set; }

    public Client() {
        CreateValidationRules();
    }

    private void CreateValidationRules() {

        ValidationRules.Add(new ValidationRule("Client 'Name' is required.",
            c => !string.IsNullOrEmpty(((Client)c).Name)));
    }
} 
```

注意我在哪里创建验证规则列表。在 lambda 表达式中，我必须将“c”转换为“Client”，因为我的规则本质上是`Func<object, bool>`. 我已经尝试了很多方法来使这个通用化，`ValidationRule<Client>`但我总是遇到调用`Validate()`ModelBase 类的问题。关于如何绕过这个选角的任何想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T19:33:52.097

您可以使 ValidationRule 类通用，但将 IsValid 方法的参数保留为对象并在方法中进行转换。这样你就可以得到泛型，而不必使 ModelBase 也泛型。

您还需要一个 ModelBase 接口，以便能够在不知道其实际类型的情况下保留验证规则列表。然后只需将列表的类型和 ModelBase 中的属性更改为 IValidationRule。

（注意：您可以在属性上使用私有设置器以使其成为只读。）

```
public Interface IValidationRule {
   bool IsValid(object);
}

public class ValidationRule<T> : IValidationRule {

    public Func<T, bool> Rule { get; private set; }
    public string ErrorMessage { get; private set; }

    public ValidationRule(string errorMessage, Func<object, bool> rule) { 
        Rule = rule;
        ErrorMessage = errorMessage;
    }

    public bool IsValid(object obj) {
        return Rule((T)obj);
    }
} 
```

现在，lamda 表达式中的参数类型是泛型类型，因此您不必强制转换它：

```
ValidationRules.Add(
      new ValidationRule<Client>(
           "Client 'Name' is required.",
           c => !string.IsNullOrEmpty(c.Name)
      )
 ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T19:17:00.143

我怀疑 ModelBase 也需要变得通用。不过，我不清楚这里到底发生了什么——*每个*客户的验证规则不都是一样的吗？验证规则感觉它们应该与整个类型相关联，而不是与类型的单个实例相关联。诚然，它们将针对单个实例进行*验证。*

我想知道您是否不应该有一个`Validator<T>`类型，并创建（一次） a `Validator<Client>`，然后可以针对`Client`.

# git - “svn update -r”的 git 等价物是什么？

> ID：573585
> 
> 赞同：57
> 
> 时间：2009-02-21T19:13:43.317
> 
> 标签：git, svn, git-svn, git-checkout, svn-update

我是最近的 git convert 。能够使用 git-svn 将我的分支保留在本地而不干扰 svn 服务器，这真是太好了。最新版本的代码中存在一个错误。我想建立一个有效的时间，以便我可以使用 git bisect。我找不到正确的命令来及时返回。谢谢。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-02-21T19:20:11.943

```
git checkout HEAD~1 
```

这会将您当前的 HEAD 移动到更早的一个修订版。

```
git checkout <sha> 
```

这会将您当前的 HEAD 移动到给定的版本。使用`git log`或`gitk`查找您要查找的修订。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2011-03-09T11:08:58.290

回到最新的（相当于：svn up），你需要更新分支，通常：

```
git checkout master 
```

这是因为 HEAD 指的是正在检出的版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-20T01:03:51.343

```
git 拉
```

似乎更适合您正在寻找的命令

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-10-02T15:18:25.783

这似乎做了我想要的，这也是我认为你所要求的

```
git checkout * 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-02-05T07:26:27.870

如果您使用的是 TortoiseGit，那么

```
Right Click in project folder > TortoiseGit > Pull 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-12-31T17:06:31.980

2019 年更新：正确的命令是

```
git restore -s @~1 
```

（例如，在 HEAD 父提交中恢复文件的状态）

那是因为：

*   [`git checkout`太混乱了](https://stackoverflow.com/a/57066202/6309)，同时处理分支和文件。
    [`git restore`](https://git-scm.com/docs/git-restore)仅...恢复文件，从 Git 2.23（2019 年 8 月）开始。
    不需要`git checkout HEAD~ -- .`
*   Git 1.8.4`@`作为`HEAD`.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-11-18T14:44:06.113

git 中没有与 svn update 完全等价的功能。如果您删除一个文件，即使您再次拉取它，它也会显示为已删除状态。唯一的选择是签出该文件。如果您错误地删除了多个文件并想要恢复它们，您可以重命名该存储库并再次克隆它。这就是我所做的。

# c - 如何在 VC++ 2005 中定义 HAVE_STDIO_H？

> ID：573610
> 
> 赞同：1
> 
> 时间：2009-02-21T19:32:22.727
> 
> 标签：c, visual-c++

我刚刚使用 Visual C++ 2005 的 Express 版本构建了 SDL.dll 的更新版本，这是我的 Delphi 项目使用的开源 C DLL。我将它放在我的 EXE 文件夹中并尝试运行它，但它成功了不加载：

```
The procedure entry point SDL_RWFromFP could not be located in the dynamic
link library SDL.dll. 
```

现在 C 从来都不是我的强项，但我在大学时记得足够多，试图找到这个。我在源代码中四处寻找这个函数发生了什么，我发现它在预处理器指令下方呈灰色：

```
#ifdef HAVE_STDIO_H 
```

IIRC，STDIO 是标准的 CI/O 库。我认为这意味着它不可用。任何人都知道为什么会这样以及如何解决它？这是 Visual C++ 问题还是 SDL 问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T06:28:20.293

大多数情况下，在 Unix/Linux 世界中，诸如此类`HAVE_STDIO_H`的名称表示代码已被“自动没收”（这是用于描述已与“autotools”如“autoconf”一起使用的状态的官方术语）。在这样的设置中，配置过程将确定是否`<stdio.h>`可用，并将`#define HAVE_STDIO_H 1`在`config.h`它生成的文件中进行设置。然后编译会发现平台已经`<stdio.h>`并且会编译匹配的代码（当前灰显的东西）。

适应您的 Windows 环境，由于在 Windows 上可能有其他一些意义`HAVE_STDIO_H`，因此您可能会认为`-DHAVE_STDIO_H`在运行编译器时包含在命令行选项中是可以的。或者您可以手动创建配置文件并定义`-DHAVE_CONFIG_H`（这是指示配置设置在文件“config.h”中的常规方式）。在“config.h”文件中，您将拥有`#define HAVE_STDIO_H 1`如上所述的内容。

* * *

注意：在 Unix 上，您通常会找到一个名为“configure”的 shell 脚本，您可以运行它来创建 config.h 文件。如果您有 Cygwin，则有可能在 Windows 上使用该脚本 - 我刚刚检查了我在 Solaris 上创建的自动没收程序包可在 Cygwin 下的 Windows 上配置，并且它大部分工作 - 除了一些网络处理之外。我不保证它总是会失败（但它是软件 - 保证任何事情都是非常危险的）。我应该补充一点，问题出在我的自动配置代码中（网络功能的测试显然不太正确），而不是 Cygwin 本身。如果我正确地完成了这项工作，它就会奏效。（有人说“没有可移植的代码；只有被移植的代码”。这适用于这里。）

您确实需要对 Unix 环境进行良好的模拟。MingW 也可能有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T23:45:16.347

它上面的预处理器指令有什么作用？

很可能，这只是为了确定编译器的某些属性，它是灰色的，因为无论宏表示什么，都不适用于您的编译器。

您的问题很可能在其他地方。

由于它找不到该函数`SDL_RWFromFP`，您可能应该查看该函数是否由于某种原因也被预处理器指令禁用。

但是，我的猜测是该函数存在，但没有被标记为 __declspec( dllexport )

没有它，它不会被暴露，因此加载 DLL 的程序可以调用它。很可能你必须#define 来指定你想要创建一个DLL，这将启用必要的预处理器魔法来在函数前面插入dllexport 部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T06:44:53.547

通常，您不必添加任何 HAVE_STDIO_H：它们无论如何都不应该是公共的（尽管遗憾的是，许多项目都用这些污染了公共命名空间）。

我猜您没有正确构建 SDL - 或者 SDL 不太支持 Visual Studio 2005（我对 SDL 了解不多，所以这些都是非常疯狂的猜测，没有太多信息）。是否有任何 SDL 测试套件，例如您可以测试构建的 dll 吗？

# python - 设置计划的工作？

> ID：573618
> 
> 赞同：563
> 
> 时间：2009-02-21T19:39:59.540
> 
> 标签：python, django, web-applications, scheduled-tasks

我一直在使用 Django 开发一个网络应用程序，我很好奇是否有办法安排作业定期运行。

基本上我只想通过数据库运行并自动定期进行一些计算/更新，但我似乎找不到任何关于这样做的文档。

有谁知道如何设置这个？

澄清一下：我知道我可以设置一个`cron`工作来做到这一点，但我很好奇 Django 中是否有一些特性可以提供这个功能。我希望人们能够自己部署这个应用程序，而不必做太多配置（最好是零）。

我已经考虑通过简单地检查自上次向站点发送请求以来是否应该运行作业来“追溯地”触发这些操作，但我希望有一些更清洁的东西。

* * *

## 回答 #1

> 赞同：393
> 
> 时间：2009-02-21T20:06:38.010

我采用的一种解决方案是这样做：

1）创建[自定义管理命令](http://docs.djangoproject.com/en/dev/howto/custom-management-commands/#howto-custom-management-commands)，例如

```
python manage.py my_cool_command 
```

2）使用`cron`（在 Linux 上）或`at`（在 Windows 上）在需要的时间运行我的命令。

这是一个简单的解决方案，不需要安装繁重的 AMQP 堆栈。但是，使用其他答案中提到的芹菜之类的东西有很多好处。特别是，使用 Celery 时，不必将应用程序逻辑分散到 crontab 文件中是一件好事。但是，cron 解决方案非常适合中小型应用程序，并且您不希望有很多外部依赖项。

编辑：

在更高版本的 Windows 中`at`，Windows 8、Server 2012 及更高版本已弃用该命令。您可以`schtasks.exe`用于相同的用途。

**** 更新 **** 这是 django doc 的新[链接](https://docs.djangoproject.com/en/2.2/howto/custom-management-commands/#howto-custom-management-commands)，用于编写自定义管理命令

* * *

## 回答 #2

> 赞同：166
> 
> 时间：2009-06-29T11:56:47.943

[Celery](http://celeryproject.org/)是一个分布式任务队列，建立在 AMQP (RabbitMQ) 之上。它还以类似 cron 的方式处理周期性任务（请参阅[周期性任务](http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html)）。根据您的应用程序，可能值得一试。

Celery 很容易使用 django ( [docs](http://docs.celeryproject.org/en/latest/django/) ) 进行设置，并且定期任务实际上会在停机时跳过错过的任务。Celery 还具有内置的重试机制，以防任务失败。

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2012-01-30T21:47:06.483

我们已经开源了我认为的结构化应用程序。布赖恩的上述解决方案也暗示了这一点。我们会喜欢任何/所有反馈！

[https://github.com/tivix/django-cron](https://github.com/tivix/django-cron)

它带有一个管理命令：

```
./manage.py runcrons 
```

这就是工作。每个 cron 都被建模为一个类（所以它都是面向对象的）并且每个 cron 以不同的频率运行，我们确保相同的 cron 类型不会并行运行（以防 cron 本身的运行时间比它们的频率长！）

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2009-02-21T20:04:40.260

如果您使用的是标准 POSIX 操作系统，则使用[cron](http://linux.die.net/man/8/cron)。

如果您使用的是 Windows，请使用[at](http://technet.microsoft.com/en-us/library/cc755618.aspx)。

写一个 Django 管理命令到

1.  弄清楚他们在哪个平台上。

2.  为您的用户执行适当的“AT”命令，**或**为您的用户更新 crontab。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-03-07T08:32:30.637

有趣的新可插拔 Django 应用程序：[django-chronograph](https://bitbucket.org/wnielson/django-chronograph/)

您只需添加一个用作计时器的 cron 条目，并且您可以在脚本中运行一个非常好的 Django 管理界面。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-02-21T20:29:47.643

看看 Django Poor Man's Cron，这是一个 Django 应用程序，它利用垃圾邮件机器人、搜索引擎索引机器人等以大约固定的时间间隔运行计划任务

请参阅：[http ://code.google.com/p/django-poormanscron/](http://code.google.com/p/django-poormanscron/)

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2017-06-22T14:04:20.800

前段时间我有完全相同的要求，最终使用[APScheduler](https://apscheduler.readthedocs.io/en/latest/)（[用户指南](https://apscheduler.readthedocs.io/en/latest/userguide.html)）解决了它

它使调度作业变得超级简单，并使其独立于基于请求的某些代码的执行。下面是一个简单的例子。

```
from apscheduler.schedulers.background import BackgroundScheduler

scheduler = BackgroundScheduler()
job = None

def tick():
    print('One tick!')\

def start_job():
    global job
    job = scheduler.add_job(tick, 'interval', seconds=3600)
    try:
        scheduler.start()
    except:
        pass 
```

希望这对某人有帮助！

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2011-12-20T12:30:42.837

Brian Neal 建议通过 cron 运行管理命令效果很好，但如果您正在寻找更强大的东西（但不像 Celery 那样精致），我会研究像[Kronos](https://github.com/jgorset/django-kronos)这样的库：

```
# app/cron.py

import kronos

@kronos.register('0 * * * *')
def task():
    pass 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2019-09-19T21:03:41.100

用于调度程序作业的 Django APScheduler。Advanced Python Scheduler (APScheduler) 是一个 Python 库，可让您安排 Python 代码稍后执行，无论是一次还是定期执行。您可以随意添加新工作或删除旧工作。

**注意：我是这个库的作者**

## 安装 APScheduler

```
pip install apscheduler 
```

## 查看文件函数调用

文件名：scheduler_jobs.py

```
def FirstCronTest():
    print("")
    print("I am executed..!") 
```

## 配置调度程序

制作execute.py文件并添加以下代码

```
from apscheduler.schedulers.background import BackgroundScheduler
scheduler = BackgroundScheduler() 
```

你写的函数这里，调度器函数写在 scheduler_jobs

```
import scheduler_jobs 

scheduler.add_job(scheduler_jobs.FirstCronTest, 'interval', seconds=10)
scheduler.start() 
```

### 链接文件以执行

现在，在 Url 文件的底部添加以下行

```
import execute 
```

*   您可以通过执行 [点击这里] [https://github.com/devchandansh/django-apscheduler查看完整代码](https://github.com/devchandansh/django-apscheduler)

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2012-04-03T14:54:18.513

RabbitMQ 和 Celery 比 Cron 有更多的特性和任务处理能力。如果任务失败不是问题，并且您认为您将在下一次调用中处理中断的任务，那么 Cron 就足够了。

Celery & [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol)会让你处理被破坏的任务，它会被另一个工作人员再次执行（芹菜工作人员监听下一个要处理的任务），直到`max_retries`达到任务的属性。您甚至可以在失败时调用任务，例如记录失败，或`max_retries`在达到目标后向管理员发送电子邮件。

当您需要扩展应用程序时，您可以分发 Celery 和 AMQP 服务器。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2009-02-22T03:18:07.553

我个人使用 cron，但[django-extensions的](https://github.com/django-extensions/django-extensions)[Jobs Scheduling](http://code.google.com/p/django-command-extensions/wiki/JobsScheduling)部分看起来很有趣。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2016-07-19T20:49:43.057

尽管不是 Django 的一部分，但[Airflow](http://airflow.incubator.apache.org/project.html)是一个更新的项目（截至 2016 年），对任务管理很有用。

Airflow 是一个工作流自动化和调度系统，可用于创作和管理数据管道。基于 Web 的 UI 为开发人员提供了一系列用于管理和查看这些管道的选项。

Airflow 是用 Python 编写的，并使用 Flask 构建。

Airflow 由 Airbnb 的 Maxime Beauchemin 创建并于 2015 年春季开源。它于 2016 年冬季加入 Apache 软件基金会的孵化计划。这是[Git 项目页面](https://github.com/apache/incubator-airflow)和一些附加[背景信息](http://nerds.airbnb.com/airflow/)。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2010-01-07T23:26:10.873

将以下内容放在 cron.py 文件的顶部：

```
#!/usr/bin/python
import os, sys
sys.path.append('/path/to/') # the parent directory of the project
sys.path.append('/path/to/project') # these lines only needed if not on path
os.environ['DJANGO_SETTINGS_MODULE'] = 'myproj.settings'

# imports and code below 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2011-10-30T13:19:58.790

我只是想到了这个相当简单的解决方案：

1.  定义一个视图函数**do_work(req, param)**就像使用任何其他视图一样，使用 URL 映射，返回一个 HttpResponse 等等。
2.  **使用运行curl [http://localhost/your/mapped/url?param=value](http://localhost/your/mapped/url?param=value)**的计时首选项（或在 Windows 中使用 AT 或计划任务）设置 cron 作业。

您可以添加参数，但只需将参数添加到 URL。

告诉我你们的想法。

**[更新]**我现在使用[django-extensions](https://github.com/django-extensions/django-extensions)中的 runjob 命令而不是 curl。

我的 cron 看起来像这样：

```
@hourly python /path/to/project/manage.py runjobs hourly 
```

... 以此类推，适用于每日、每月等。您还可以将其设置为运行特定作业。

我发现它更易于管理和更清洁。不需要将 URL 映射到视图。只需定义您的工作类别和 crontab 即可。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2011-05-17T03:09:13.127

在部分代码之后，我可以写任何东西，就像我的views.py :)

```
#######################################
import os,sys
sys.path.append('/home/administrator/development/store')
os.environ['DJANGO_SETTINGS_MODULE']='store.settings'
from django.core.management impor setup_environ
from store import settings
setup_environ(settings)
####################################### 
```

来自 [http://www.cotellese.net/2007/09/27/running-external-scripts-against-django-models/](http://www.cotellese.net/2007/09/27/running-external-scripts-against-django-models/)

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2018-08-04T05:50:24.100

你一定要看看 django-q！它不需要额外的配置，并且很可能拥有处理商业项目中任何生产问题所需的一切。

它正在积极开发并与 django、django ORM、mongo、redis 很好地集成。这是我的配置：

```
# django-q
# -------------------------------------------------------------------------
# See: http://django-q.readthedocs.io/en/latest/configure.html
Q_CLUSTER = {
    # Match recommended settings from docs.
    'name': 'DjangoORM',
    'workers': 4,
    'queue_limit': 50,
    'bulk': 10,
    'orm': 'default',

# Custom Settings
# ---------------
# Limit the amount of successful tasks saved to Django.
'save_limit': 10000,

# See https://github.com/Koed00/django-q/issues/110.
'catch_up': False,

# Number of seconds a worker can spend on a task before it's terminated.
'timeout': 60 * 5,

# Number of seconds a broker will wait for a cluster to finish a task before presenting it again. This needs to be
# longer than `timeout`, otherwise the same task will be processed multiple times.
'retry': 60 * 6,

# Whether to force all async() calls to be run with sync=True (making them synchronous).
'sync': False,

# Redirect worker exceptions directly to Sentry error reporter.
'error_reporter': {
    'sentry': RAVEN_CONFIG,
},
} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2017-11-11T16:38:15.553

一个更现代的解决方案（与 Celery 相比）是 Django Q： [https ://django-q.readthedocs.io/en/latest/index.html](https://django-q.readthedocs.io/en/latest/index.html)

它有很好的文档并且很容易理解。缺少 Windows 支持，因为 Windows 不支持进程分叉。但是，如果您使用 Windows for Linux 子系统创建开发环境，它就可以正常工作。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2011-09-02T18:41:33.843

我今天遇到了类似你的问题。

我不想让服务器通过 cron 处理它（大多数库最终只是 cron 助手）。

所以我创建了一个调度模块并将其附加到**init**。

这不是最好的方法，但它可以帮助我将所有代码放在一个地方，并且它的执行与主应用程序相关。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2014-03-26T01:04:36.933

是的，上面的方法太棒了。我尝试了其中的一些。最后，我找到了这样的方法：

```
 from threading import Timer

    def sync():

        do something...

        sync_timer = Timer(self.interval, sync, ())
        sync_timer.start() 
```

就像**递归**一样。

好的，我希望这个方法能满足你的要求。:)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-08-31T21:52:36.653

我使用 celery 来创建我的定期任务。首先，您需要按如下方式安装它：

```
pip install django-celery 
```

不要忘记`django-celery`在您的设置中注册，然后您可以执行以下操作：

```
from celery import task
from celery.decorators import periodic_task
from celery.task.schedules import crontab
from celery.utils.log import get_task_logger
@periodic_task(run_every=crontab(minute="0", hour="23"))
def do_every_midnight():
 #your code 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2017-01-11T19:34:28.060

我不确定这对任何人是否有用，因为我必须提供系统的其他用户来安排作业，而没有让他们访问实际的服务器（Windows）任务计划程序，我创建了这个可重用的应用程序。

请注意，用户可以访问服务器上的一个共享文件夹，他们可以在其中创建所需的命令/任务/.bat 文件。然后可以使用此应用程序安排此任务。

应用名称是[Django_Windows_Scheduler](https://github.com/just10minutes/Django_Windows_Scheduler)

截屏： [![在此处输入图像描述](https://i.stack.imgur.com/y3gtF.png)](https://i.stack.imgur.com/y3gtF.png)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2018-05-21T23:53:52.680

如果您想要比*Celery*更**可靠**的东西，请尝试构建在**AWS SQS/SNS**之上的**TaskHawk**。

 *****参考：[http ://taskhawk.readthedocs.io](http://taskhawk.readthedocs.io)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-01-25T12:13:05.980

对于简单的 dockerized 项目，我真的看不出任何现有的答案合适。

所以我写了一个非常简单的解决方案，不需要外部库或触发器，它可以自己运行。不需要外部 os-cron，应该可以在每个环境中工作。

它通过添加中间件来工作：`middleware.py`

```
import threading

def should_run(name, seconds_interval):
    from application.models import CronJob
    from django.utils.timezone import now

    try:
        c = CronJob.objects.get(name=name)
    except CronJob.DoesNotExist:
        CronJob(name=name, last_ran=now()).save()
        return True

    if (now() - c.last_ran).total_seconds() >= seconds_interval:
        c.last_ran = now()
        c.save()
        return True

    return False

class CronTask:
    def __init__(self, name, seconds_interval, function):
        self.name = name
        self.seconds_interval = seconds_interval
        self.function = function

def cron_worker(*_):
    if not should_run("main", 60):
        return

    # customize this part:
    from application.models import Event
    tasks = [
        CronTask("events", 60 * 30, Event.clean_stale_objects),
        # ...
    ]

    for task in tasks:
        if should_run(task.name, task.seconds_interval):
            task.function()

def cron_middleware(get_response):

    def middleware(request):
        response = get_response(request)
        threading.Thread(target=cron_worker).start()
        return response

    return middleware 
```

`models/cron.py`：

```
from django.db import models

class CronJob(models.Model):
    name = models.CharField(max_length=10, primary_key=True)
    last_ran = models.DateTimeField() 
```

`settings.py`：

```
MIDDLEWARE = [
    ...
    'application.middleware.cron_middleware',
    ...
] 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-02-20T10:21:02.703

简单的方法是编写自定义 shell 命令，参见[Django 文档](https://docs.djangoproject.com/en/2.2/howto/custom-management-commands/)并在 linux 上使用 cronjob 执行它。但是我强烈推荐使用像 RabbitMQ 这样的消息代理和 celery。也许你可以看看这个[教程](https://simpleisbetterthancomplex.com/tutorial/2017/08/20/how-to-use-celery-with-django.html)

# math - 如何开始信息提取？

> ID：573620
> 
> 赞同：7
> 
> 时间：2009-02-21T19:40:22.050
> 
> 标签：math, machine-learning, nlp, information-extraction

您能否推荐一条培训路径来开始并在信息提取方面变得非常出色。我开始阅读它来做我的一个爱好项目，并很快意识到我必须擅长数学（代数、统计、概率）。我已经阅读了一些关于不同数学主题的介绍性书籍（非常有趣）。寻求一些指导。请帮忙。

更新：只是为了回答其中一条评论。我对文本信息提取更感兴趣。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-21T20:57:36.280

> 只是为了回答其中一个评论。我对文本信息提取更感兴趣。

根据您项目的性质，[自然语言处理](http://en.wikipedia.org/wiki/Natural_language_processing)和[计算语言学](http://en.wikipedia.org/wiki/Computational_linguistics)都可以派上用场——它们提供了测量工具，从文本信息中提取特征，并应用训练、评分或分类。

好的介绍性书籍包括[OReilly 的 Programming Collective Intelligence](https://rads.stackoverflow.com/amzn/click/com/0596529325)（关于“搜索和排名”、文档过滤和决策树的章节）。

利用这些知识的建议项目：POS（词性）标记和命名实体识别（从纯文本中识别名称、地点和日期的能力）。您可以将 Wikipedia 用作训练语料库，因为大部分目标信息已经在信息框中提取 - 这可能会为您提供一些有限的测量反馈。

IE 中的另一把大锤是搜索，一个不容小觑的领域。同样，OReilly 的书提供了一些基本排名的介绍；一旦你有大量的索引文本，你就可以用它来做一些真正的 IE 任务。看看[Peter Norvig：从数据](http://www.youtube.com/watch?v=nU8DcBF-qo4)出发进行理论化，这是一个很好的激励因素——也许你可以重新实现他们的一些结果作为学习练习。

作为一个预警，我想我有义务告诉你，信息提取很*困难*。任何给定任务的前 80% 通常是微不足道的；然而，IE 任务每增加一个百分比的难度通常呈指数增长——在开发和研究时间中。它的记录也很不足——大多数高质量信息目前都在晦涩难懂的白皮书中（[谷歌学术](http://scholar.google.com)是你的朋友）——一旦你的手被烧了几次，就去看看。但最重要的是，不要让这些障碍让你失望——这方面肯定有很大的进步机会。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-21T19:46:49.913

我会推荐Christopher D. Manning、Prabhakar Raghavan 和 Hinrich Schütze所著[的《信息检索导论》的优秀书籍。](http://nlp.stanford.edu/IR-book/)它涵盖了广泛的问题领域，这些问题构成了信息提取的重要和最新（2008 年）基础，并且可以在线获取全文（在给定链接下）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-01T20:40:15.703

我建议您看一下[Natural Language Toolkit (nltk)](http://www.nltk.org)和[NLTK Book](http://www.nltk.org/book)。两者都是免费提供的，都是很棒的学习工具。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-05-29T04:24:02.273

你不需要擅长数学来做 IE 只需了解算法是如何工作的，在你需要最佳结果性能的情况下进行实验，以及你需要达到目标准确度水平并与之合作的规模。你基本上是在研究算法和编程以及 CS/AI/机器学习理论的各个方面，而不是写一篇关于构建新机器学习算法的博士论文，你必须通过数学原理说服某人为什么该算法有效，所以我完全不同意带着这个想法。实践和理论之间是有区别的——众所周知，数学家更多地停留在理论上，而不是算法的实用性，以产生可行的业务解决方案。然而，你会 需要做一些背景阅读 NLP 书籍和期刊论文，以了解人们从他们的结果中发现了什么。IE 是一个非常特定于上下文的域，因此您需要首先定义要在什么上下文中提取信息 - 您将如何定义这些信息？你的结构化模型是什么？假设您正在从半结构化和非结构化数据集中进行提取。然后，您还需要权衡是否要从标准的人类方法（包括正则表达式和模式匹配等）来处理您的 IE，或者您是否想使用诸如马尔可夫链之类的统计机器学习方法来实现它。您甚至可以查看混合方法。IE 是一个非常特定于上下文的域，因此您需要首先定义要在什么上下文中提取信息 - 您将如何定义这些信息？你的结构化模型是什么？假设您正在从半结构化和非结构化数据集中进行提取。然后，您还需要权衡是否要从标准的人类方法（包括正则表达式和模式匹配等）来处理您的 IE，或者您是否想使用诸如马尔可夫链之类的统计机器学习方法来处理您的 IE。您甚至可以查看混合方法。IE 是一个非常特定于上下文的域，因此您需要首先定义要在什么上下文中提取信息 - 您将如何定义这些信息？你的结构化模型是什么？假设您正在从半结构化和非结构化数据集中进行提取。然后，您还需要权衡是否要从标准的人类方法（包括正则表达式和模式匹配等）来处理您的 IE，或者您是否想使用诸如马尔可夫链之类的统计机器学习方法来处理您的 IE。您甚至可以查看混合方法。然后，您还需要权衡是否要从标准的人类方法（包括正则表达式和模式匹配等）来处理您的 IE，或者您是否想使用诸如马尔可夫链之类的统计机器学习方法来处理您的 IE。您甚至可以查看混合方法。然后，您还需要权衡是否要从标准的人类方法（包括正则表达式和模式匹配等）来处理您的 IE，或者您是否想使用诸如马尔可夫链之类的统计机器学习方法来实现它。您甚至可以查看混合方法。

您可以遵循的标准流程模型进行提取是采用数据/文本挖掘方法：

> 预处理 - 定义和标准化您的数据，以便从各种或特定来源中提取数据并清理您的数据
> 
> 分割/分类/聚类/关联 - 您的大部分提取工作将在其中完成的黑匣子
> 
> 后处理 - 将您的数据清理回您想要存储或表示为信息的位置

此外，您需要了解什么是数据和什么是信息之间的区别。因为您可以重用您发现的信息作为数据源来构建更多信息地图/树/图表。这一切都非常背景化。

标准步骤：输入->处理->输出

如果您使用的是 Java/C++，那么您可以使用大量可用的框架和库。

如果您想进行大量标准文本提取，Perl 将是一种出色的语言来进行 NLP 提取工作。

您可能希望将数据表示为 XML 甚至 RDF 图（语义 Web），并且对于您定义的上下文模型，您可以构建关系和关联图，当您提出越来越多的提取请求时，它们很可能会发生变化。将其部署为一项 RESTful 服务，因为您希望将其视为文档资源。您甚至可以使用 Solr 将其链接到分类数据集和分面搜索。

好的阅读来源是：

*   计算语言学和自然语言处理手册
*   统计自然语言处理的基础
*   信息提取应用前景
*   Perl 和 Prolog 语言处理简介
*   语音和语言处理（Jurafsky）
*   文本挖掘应用程序编程
*   文本挖掘手册
*   驯服文本
*   智能网络算法
*   构建搜索应用程序
*   IEEE期刊

确保在将此类应用程序/算法部署到生产环境之前进行全面评估，因为它们会递归地增加您的数据存储需求。您可以使用 AWS/Hadoop 进行集群，使用 Mahout 进行大规模分类等。将您的数据集存储在 MongoDB 中或将非结构化转储存储到 jackrabbit 等中。首先尝试使用原型进行试验。您可以使用各种档案来根据路透社语料库、提示者、TREC 等进行培训。您甚至可以查看 alchemy API、GATE、UIMA、OpenNLP 等。

从标准文本中提取内容比 Web 文档更容易，因此预处理步骤中的表示对于定义您试图从标准化文档表示中提取的确切内容变得更加重要。

标准度量包括*精度、召回率、f1 度量*等。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-09-28T12:15:04.600

我不同意那些推荐阅读《编程集体智能》的人。如果你想做任何中等复杂性的事情，你需要擅长应用数学，而 PCI 会给你一种错误的自信感。例如，当谈到 SVM 时，它只是说 libSVM 是实现它们的好方法。

现在，libSVM 绝对是一个很好的包，但谁在乎包。你需要知道的是为什么 SVM 会给出它所给出的了不起的结果，以及它与贝叶斯的思维方式有何根本不同（以及 Vapnik 是如何成为传奇的）。

恕我直言，没有一种解决方案。您应该很好地掌握线性代数以及概率和贝叶斯理论。我应该补充一点，贝叶斯对此与人类的氧气一样重要（它有点夸张，但你明白我的意思，对吧？）。另外，要好好掌握机器学习。仅仅使用其他人的工作是非常好的，但是当你想知道为什么某事会以这种方式完成时，你将不得不了解一些关于 ML 的知识。

检查这两个：

[http://pindancing.blogspot.com/2010/01/learning-about-machine-learniing.html](http://pindancing.blogspot.com/2010/01/learning-about-machine-learniing.html)

[http://measuringmeasures.com/blog/2010/1/15/learning-about-statistical-learning.html](http://measuringmeasures.com/blog/2010/1/15/learning-about-statistical-learning.html)

[http://measuringmeasures.com/blog/2010/3/12/learning-about-machine-learning-2nd-ed.html](http://measuringmeasures.com/blog/2010/3/12/learning-about-machine-learning-2nd-ed.html)

好的，现在是他们中的三个 :) / 酷

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-21T19:46:21.740

维基百科[信息提取](http://en.wikipedia.org/wiki/Information_extraction)文章是一个快速介绍。

在更学术的层面上，您可能想要浏览一篇论文，例如[Integrating Probabilistic Extraction Models and Data Mining to Discover Relations and Patterns in Text](http://www.cs.umass.edu/~culotta/pubs/culotta06integrating.pdf)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-17T16:33:30.740

如果您需要企业级 NER 服务，请查看[此处。](http://www.complexityintelligence.com)开发 NER 系统（和训练集）是一项非常耗时且技术含量高的任务。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-21T20:31:25.017

这有点离题，但您可能想阅读 O'Reilly 的 Programming Collective Intelligence。它间接处理文本信息提取，并且不假设有太多的数学背景。

# c# - Java中是否存在接口的C#“显式实现”？

> ID：573621
> 
> 赞同：18
> 
> 时间：2009-02-21T19:41:24.343
> 
> 标签：c#, java, explicit-implementation

在 C# 中，如果您有两个具有相同方法的基本接口（例如 F()），您可以使用显式实现来执行不同的 impl。对于 F()。这使您可以区别对待对象，对应于当前的观点：作为 IMyInterface1 或 IMyInterface2。这在Java中可能吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-21T19:45:45.580

不，没有什么能比得上 C# 在 Java 中的显式接口实现。

从好的方面来说，Java 有协变的返回类型，所以如果你想提供比接口指定的更强类型的实现，那没关系。例如，这很好：

```
interface Foo
{
    Object getBar();
}

public class Test implements Foo
{
    @Override
    public String getBar()
    {
        return "hi";
    }
} 
```

C# 不允许这样做（在 C# 9 之前，[现在支持协变返回类型](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-9.0/covariant-returns)） - 解决它的一种方法通常是显式实现接口，然后使用更具体的公共方法（通常由接口实现调用） .

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-09-28T15:15:43.213

使用 Java 中的匿名接口实现机制也可以达到类似的效果。

参见示例：

```
interface Foo {

    void f();
}

interface Bar {

    void f();
}

public class Test {

    private String foo = "foo", bar = "bar";

    Foo getFoo() {
        return new Foo() {

            @Override
            public void f() {
                System.out.println(foo);
            }
        };
    }

    Bar getBar() {
        return new Bar() {

            @Override
            public void f() {
                System.out.println(bar);
            }
        };
    }

    public static void main(String... args) {
        Test test = new Test();
        test.getFoo().f();
        test.getBar().f();
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T19:54:04.780

只有在方法重载时才能执行此操作。如果您有两种方法可以做不同的事情，恕我直言，它们应该有不同的名称。

* * *

## 回答 #4

> 赞同：-17
> 
> 时间：2010-05-21T04:20:52.460

不，它不应该出现在 Java 中。这只是扔给那些对优秀设计不屑一顾的人的另一块骨头。

永远不应该需要或使用接口的显式实现。有更好的方法来解决这个试图解决的问题。

# unix - PowerShell 准备好在 Windows 上替换我的 Cygwin shell 了吗？

> ID：573623
> 
> 赞同：390
> 
> 时间：2009-02-21T19:42:06.913
> 
> 标签：unix, shell, powershell

我正在争论我是否应该学习 PowerShell，或者只是坚持使用[Cygwin](http://en.wikipedia.org/wiki/Cygwin) /Perl 脚本/Unix shell 脚本等。

PowerShell 的好处是脚本可以更容易地被没有 Cygwin 的队友使用；但是，我不知道我是否真的会编写那么多通用脚本，或者人们是否会使用它们。

Unix 脚本如此强大，PowerShell 是否足够接近以保证切换？

以下是我将在 PowerShell 中寻找的一些特定事物（或等价物）：

*   [grep](http://en.wikipedia.org/wiki/Grep)
*   种类
*   独特的
*   Perl（PowerShell 与 Perl 的功能有多接近？）
*   [AWK](http://en.wikipedia.org/wiki/AWK)
*   [sed](http://en.wikipedia.org/wiki/Sed)
*   文件（提供文件信息的命令）
*   等等

* * *

## 回答 #1

> 赞同：794
> 
> 时间：2009-02-21T22:53:37.577

工具只是工具。
他们提供帮助或不提供帮助。
你需要帮助，或者你不需要。

如果您了解 Unix，并且这些工具可以在 Windows 上执行您需要它们执行的操作 - 那么您就是一个快乐的人，无需学习 PowerShell（除非您想探索）。

我最初的意图是在 Windows 中包含一组 Unix 工具并完成它（我们团队中的许多人都有深厚的 Unix 背景和对那个社区的健康尊重。）

我发现这并没有太大帮助。原因是 AWK/grep/sed 不适用于[COM](http://en.wikipedia.org/wiki/Component_Object_Model)、[WMI](https://en.wikipedia.org/wiki/Windows_Management_Instrumentation)、[ADSI](https://en.wikipedia.org/wiki/Active_Directory#Database)、注册表、证书存储等。

换句话说，UNIX 是一个围绕文本文件自我调整的整个生态系统。因此，文本处理工具是有效的管理工具。Windows 是一个完全不同的生态系统，围绕 API 和对象进行了自我调整。这就是我们发明 PowerShell 的原因。

我想您会发现，在很多情况下，文本处理无法在 Windows 上为您提供所需的内容。那时，您将需要选择 PowerShell。注意 - 这不是全有或全无的交易。在 PowerShell 中，您可以调用 Unix 工具（并使用它们的文本处理或 PowerShell 的文本处理）。您还可以从 Unix 工具调用 PowerShell 并获取文本。

再说一遍 - 这里没有宗教 - 我们的重点是为您提供成功所需的工具。这就是为什么我们如此热衷于反馈。让我们知道我们在哪里工作失败或您没有所需工具的地方，我们会将其列入清单并着手处理。

老实说，我们正在把自己从一个 30 年的坑里挖出来，所以这需要一段时间。也就是说，如果您选择了[Windows Server 2008](http://en.wikipedia.org/wiki/Windows_Server_2008) /R2 的测试版和/或我们的服务器产品的测试版，我想您会对这个漏洞被填补的速度感到震惊。

关于使用 - 迄今为止，我们的下载量已超过 350 万次。这不包括在 Windows Server 2008 中使用它的人，因为它是作为可选组件包含的，不需要下载。

V2 将在所有版本的 Windows 中提供。除了作为可选组件的服务器核心之外，所有版本都将默认启用。在 Windows 7/Windows Server 2008 R2 发布后不久，我们将在所有平台（Windows XP 及更高版本）上提供 V2。换句话说 - 你在学习上的投资将适用于大量的机器/环境。

最后一条评论。如果/当你开始学习 PowerShell，我想你会很高兴的。大部分设计都深受我们的 Unix 背景的影响，所以虽然我们完全不同，但你会很快学会它（在你不再抱怨它不是 Unix 之后:-)）。

我们知道人们的学习预算非常有限——这就是为什么我们非常重视一致性。你会学到一些东西，然后你会一遍又一遍地使用它。

实验！享受！从事！

* * *

## 回答 #2

> 赞同：125
> 
> 时间：2009-02-21T21:37:09.150

> grep

`Select-String`cmdlet 和`-match`operator 使用正则表达式。您也可以直接利用 .NET 的正则表达式支持来获得更高级的功能。

> 种类

`Sort-Object`更强大（比我记得 *nix's `sort`）。允许对任意表达式进行多级排序。在这里，PowerShell 对底层类型的维护有所帮助；例如，一个`DateTime`属性将被排序为 a`DateTime`而不必确保格式化为可排序的格式。

> 独特的

`Select-Object -Unique`

> Perl（PowerShell 与 Perl 的功能有多接近？）

就 Perl 的领域特定支持库的广度而言：远未接近（还）。

对于一般编程而言，PowerShell 无疑更具凝聚力和一致性，并且更易于扩展。文本修改的一个空白相当于 Perl 的`..`运算符。

> AWK

自从使用 AWK 以来已经足够长了（必须 > 18 年，因为后来我只使用了 Perl），所以不能真正评论。

> sed

[往上看]

> 文件（提供文件信息的命令）

PowerShell 在这里的优势与其说是它可以对文件系统对象做什么（它在这里获得完整的信息，`dir`返回`FileInfo`或`FolderInfo`适当的对象），不如说是整个提供程序模型。

您可以将注册表、证书存储、SQL Server、Internet Explorer 的 RSS 缓存等视为可由与文件系统相同的 cmdlet 导航的对象空间。

* * *

PowerShell 绝对是 Windows 上的前进方向。微软已将其作为未来非家用产品要求的一部分。因此在 Exchange 中的丰富支持，在 SQL Server 中的支持。这只会扩大。

最近的一个例子是 TFS PowerToys。许多 TFS 客户端操作无需每次都启动 tf.exe（这需要新的 TFS 服务器连接等）即可完成，并且随后进一步处理数据更加容易。以及允许对整个 TFS 客户端 API 的广泛访问比在 TF.exe 的任何一个团队资源管理器中公开的更详细。

* * *

## 回答 #3

> 赞同：59
> 
> 时间：2011-01-07T17:12:23.900

作为一个从 1997 年到 2010 年专注于 Windows 企业开发的人，显然的答案是 PowerShell，因为之前给出的所有充分理由（例如，它是 Microsoft 企业战略的一部分；它与 Windows/COM/.NET 很好地集成；以及使用对象而不是文件提供了“更丰富”的编码模型）。出于这个原因，在过去两年左右的时间里，我一直在使用和推广 PowerShell，并明确相信我在遵循“比尔的话”。

但是，作为一个实用主义者，我不再确定 PowerShell 是一个很好的答案。虽然它是一款出色的 Windows 工具，并且为填补 Window 命令行这一历史漏洞提供了非常必要的一步，但当我们都看到微软在消费者计算领域的控制下滑时，微软似乎越来越有可能在未来进行一场大规模的战斗，以保持其操作系统为对未来的企业很重要。

事实上，鉴于我发现我的工作越来越多地在异构环境中工作，我发现目前使用 Bash 脚本更有用，因为它们不仅适用于 Linux、Solaris 和 Mac OS X，而且还适用于Cygwin 的帮助——在 Windows 上。

因此，如果您相信操作系统的未来是商品化而不是垄断，那么选择敏捷开发工具策略似乎是有意义的，该策略在可行的情况下远离专有工具。但是，如果您看到自己的未来被所有的 Redmond 所主宰，那么请选择 PowerShell。

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2009-02-21T19:59:02.210

我使用了一些 PowerShell 来实现脚本自动化。虽然环境似乎比 Unix shell 考虑得更多，但实际上使用对象而不是文本流要笨拙得多，而且在过去 30 年开发的许多 Unix 工具年仍然失踪。

Cygwin 仍然是我为 Windows 主机选择的脚本环境。在完成工作方面，它肯定优于其他选择。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2015-09-17T08:22:32.847

这里有很多很棒的答案，这是我的看法。如果你准备好了，PowerShell 已经准备好了......示例：

grep = "[选择字符串-模式](https://technet.microsoft.com/en-us/library/hh849903.aspx)"

sort = ["排序对象"](https://technet.microsoft.com/en-us/library/ee176968.aspx)

uniq = "[获取唯一](https://technet.microsoft.com/en-us/library/ee176859.aspx)"

文件=“[获取项目](https://technet.microsoft.com/en-us/library/hh849788.aspx)”

cat = "[获取内容](https://technet.microsoft.com/en-us/library/hh849787.aspx)"

Perl/AWK/Sed 不是命令，而是实用程序，因此很难比较，但您几乎可以在 PowerShell 中完成所有操作。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2013-11-01T06:12:00.280

我最近才开始认真地涉足 PowerShell。尽管在过去的七年里，我一直在几乎完全基于 Windows 的环境中工作，但我来自 Unix 背景，发现自己一直在尝试“Unix-fy”我在 Windows 上的交互体验。至少可以说令人沮丧。

[将 PowerShell 与Bash](http://www.gnu.org/software/bash/)、[tcsh](http://www.tcsh.org/Welcome)或[zsh](http://www.zsh.org/)之类的东西进行比较是公平的，因为**grep**、**sed**、**awk**、**find**等实用程序严格来说不是 shell 的一部分；但是，它们将始终是任何 Unix 环境的一部分。也就是说，像[Select-String](http://technet.microsoft.com/en-us/library/hh849903.aspx)这样的 PowerShell 命令具有与**grep**非常相似的功能，并且*被*捆绑为 PowerShell 中的核心模块......所以这些线条可能有点模糊。

我认为关键是*文化*，以及各自的工具集将体现各自的文化这一事实：

*   Unix 是一种*基于文件*、（通常是非 Unicode）*基于文本的*文化。配置文件几乎完全是*文本*文件。另一方面，Windows 在配置格式方面总是更加结构化——配置通常保存在专有数据库（例如，Windows 注册表）中，这些数据库需要专门的工具进行管理。
*   Unix 管理（以及多年来的开发）界面传统上是命令行和虚拟终端。Windows 最初是作为 GUI 的，而管理功能最近才开始从*完全*基于 GUI 的转变。鉴于它在 PowerShell 上的显着领先优势，我们可以期待 Unix 在命令行上的体验会更丰富、更成熟，而我的经验与此相符。在这方面，根据我的经验：

    *   Unix 管理体验旨在以最少的击键使事情变得容易；这可能是由于必须通过缓慢的 9600 波特拨号连接来管理服务器的历史情况。现在 PowerShell 确实有别名，这对于绕过相当冗长**的动词名词**标准有很大帮助，但是了解这些别名有点痛苦（任何人都知道比：`alias | where {$_.ResolvedCommandName -eq "<command>"}`？）。

        操纵历史的丰富方式的一个例子：

        `iptables`命令通常是冗长的，如果不是因为**Bash**中内置的许多简洁的历史操作功能之一，那么重复它们并略有不同会很痛苦，因此插入如下的 iptables 规则：

        `iptables -I camera-1-internet -s 192.168.0.50 -m state --state NEW -j ACCEPT`

        另一台摄像机（“ `camera-2`”）的第二次，只是发出：

        `!!:s/-1-/-2-/:s/50/51`

        这意味着“执行前面的命令，但`-1-`用`-2-`和`50`替换`51`。

    *   Unix 体验针对触摸打字员进行了优化；一个人几乎可以在不离开“家”位置的情况下做任何事情。例如，在**Bash**中，使用**Emacs**键绑定（是的，Bash 还支持**vi**绑定），循环历史是使用`Ctrl-P`和`Ctrl-N`移动到行首和行尾分别使用`Ctrl-A`and完成的`Ctrl-E`......而且它肯定不止于此。尝试在 PowerShell 控制台中进行最简单的导航，而无需从初始位置移动，但您会遇到麻烦。

    *   像 Unix 上的通用分页（a la [less](http://www.gnu.org/software/less/)）这样的简单功能在 PowerShell 中似乎没有开箱即用，这有点令人沮丧，而且也不存在丰富的编辑器体验。当然，人们总是可以下载第三方工具来填补这些空白，但如果这些东西只是“存在”，就像它们在几乎任何风格的 Unix 上一样，那肯定会很好。
*   Windows 文化，至少在系统 API 方面，很大程度上是由支持框架驱动的，即**COM**和**.NET**，它们都是高度结构化和基于对象的。另一方面，对 Unix API 的访问传统上是通过文件接口 ( `/dev`and `/proc`) 或 (非面向对象的) C 风格的库调用。脚本编写体验与它们各自的操作系统范例相匹配也就不足为奇了。PowerShell 本质上是结构化的（一切都是对象）和基于**Bash**和朋友文件的。PowerShell 程序员可以使用的结构化 API 非常庞大（基本上与现有的一组标准[COM](http://en.wikipedia.org/wiki/Component_Object_Model)和 .NET 接口相匹配）。

简而言之，尽管 PowerShell 的脚本功能可以说比**Bash**更强大（尤其是当您考虑 .NET [BCL](http://msdn.microsoft.com/en-us/magazine/ee428166.aspx)的可用性时），但*交互*体验明显较弱，特别是如果您是从完全键盘驱动的，基于控制台的视角（就像许多 Unix 头一样）。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-02-21T20:05:17.500

无论如何，我不是一个非常有经验的 PowerShell 用户，但我接触到的一点点给我留下了深刻的印象。您可以将内置 cmdlet 链接在一起，以执行您可以在 Unix 提示符下执行的任何操作，并且还有一些额外的好处可以执行诸如导出到 CSV、HTML 表格以及更深入的系统管理类型的作业.

如果你真的需要[sed](http://en.wikipedia.org/wiki/Sed)之类的东西，总是有[UnixUtils](http://unxutils.sourceforge.net/)或[GnuWin32](http://gnuwin32.sourceforge.net/)，你可以很容易地与 PowerShell 集成。

作为一个长期使用 Unix 的用户，我在习惯命令命名方案方面确实有点困难，如果我了解更多 .NET，我肯定会从中受益更多。

所以本质上，我说如果它的仅限 Windows 不会造成问题，那么它是非常值得学习的。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-02-21T20:01:27.087

如果你喜欢 shell 脚本，你会喜欢 PowerShell！

从 Microsoft Command Shell (Ars Technica)*[导览](http://arstechnica.com/business/news/2005/10/msh.ars)*开始。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-02-21T20:02:55.990

当您将 PowerShell 与 Cygwin/Perl/Shell 组合进行比较时，请注意 PowerShell 仅代表该组合的“Shell”部分。

但是，您可以从 PowerShell 调用任何命令，就像从 cmd.exe 或 Cygwin 一样。它*没有*重新实现指定的功能，当然也比不上 Perl。

它“只是”一个外壳，但它使编程更容易，为 .NET 世界提供了一个舒适的接口。

另请记住，PowerShell 需要 Windows XP、Windows Server 2003 或更高版本，这可能会根据您的 IT 基础架构造成问题。

更新：

我不知道我的回答会引发什么样的哲学辩论。

我在问题的上下文中发布了我的答案：将 PowerShell 与 Cygwin 和 Perl 和 Bash 进行比较。

PowerShell 是一个 shell，因为它在内置命令、命令行开关、用户函数和外部命令（.exe、.bat、.cmd）之间没有语法差异。只有调用 .NET 方法的不同之处在于在调用中添加命名空间或对象。

它的可编程性源自 .NET 框架，而不是任何特定于 PowerShell“语言”的东西。

我想说我相信 PowerShell 是一种“脚本语言”，只要将[Bugzilla](http://en.wikipedia.org/wiki/Bugzilla)或[MediaWiki](http://en.wikipedia.org/wiki/MediaWiki)实现为在 Web 服务器上运行的 PowerShell 脚本；）

在那之前，享受[比较](http://bohdanszymanik.blogspot.com/2007/03/powershell-versus-perl.html)。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2014-03-26T23:36:46.430

TL;DR -- 我不讨厌 Windows 或 PowerShell。我无法在 Windows 或 PowerShell 中*做任何事情。*

* * *

我个人仍然觉得 PowerShell 充其量是平淡无奇的。

*   目录路径的制表符完成不复合，要求用户在每个名称完成后输入路径分隔符。
*   我仍然觉得 Windows 甚至没有路径或路径是什么的概念，没有可访问`~/`的用户主页指示器`@environment://somejibberish/%user_home%`
*   [NTFS](http://en.wikipedia.org/wiki/NTFS)仍然是一团糟，而且似乎永远都是。祝您导航顺利。

*   cmd-esque 界面，恐龙 cmd.exe 在 PowerShell 中仍然可见，*编辑*→*标记*仍然是复制信息的唯一方法，并且仅以可见终端空间的矩形块的形式进行复制。和*Edit* → *Mark*仍然是将字符串粘贴到终端的唯一方法。

*   将其涂成蓝色并不会使其更具吸引力。不过，我不介意微软开发人员对颜色有兴趣。

*   Windows 总是在屏幕的左上角打开。对于使用垂直任务栏的人来说，这非常烦人，特别是考虑到 Windows 任务栏将覆盖窗口的唯一角落，可以访问复制/粘贴功能。

由于 Windows 包含的工具，我不能说太多。由于有一整套开源、免费许可的 CLI 工具，并且 PowerShell 附带，据我所知，它们中没有一个完全令人失望。

*   PowerShell`wget`为 GNU wget 提供了看似无与伦比的参数。谢谢，希望的曙光便携无用。
*   PowerShell POSIX 不兼容 Bash，尤其是`&&`操作符没有被处理，使得最简单的条件命令跟随不是一回事。

我不认识人；我试了一下，我真的试了；我仍然尝试试一试，希望下次打开它时它会变得没用。我不能在 PowerShell 中做任何事情，而且我几乎不能用一个真正的项目来做将 GNU 工具带到 Windows 的事情。

MySysGit 使用几个 GNU 工具为我提供了恐龙 cmd.exe 提示，它仍然非常平淡无奇，但最后路径完成工作。Git 命令将在 Git Bash 中运行。

MySysGit 的 Mintty 在 mysysgit 的环境中提供了 Cygwin 界面，使复制和粘贴成为一件事情（选择复制（鼠标），`Shift`+`Ins`粘贴，多么现代......）。然而，像这样的东西`git push`在 Mintty 中被破坏了。

我并不是要咆哮，但即使使用像 Cygwin 这样的工具，我仍然看到 Windows 上的命令行可用性存在巨大问题。

* * *

PS：仅仅因为某些东西*可以*在 PowerShell 中完成，并不能使它变得*可用*。可用性比能力更深层次，是我作为消费者尝试使用产品时倾向于关注的内容。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2015-06-17T20:25:17.033

由于我最近的实验使我深入了解了 PowerShell 和 .NET 调用，我必须说 PowerShell**可以**替代 Cygwin 和 Unix shell。

我不确定 Perl，但由于 PowerShell 和 Perl 作为编程语言都是图灵完备的，所以我也同意替换 Perl。

PowerShell 在 Cygwin 和 *nix 下的普通 Bash 之上的一件事是，它能够执行沙盒 DLL 调用，通过直接 API 调用、WMI 方法甚至 COM 对象来操纵操作系统。如何通过代码启动 Internet Explorer，然后对其显示的文档做任何您想做的事情，有效地模拟 Web 服务器的后端？

如何从 SQL 服务器和其他数据提供者收集数据，解析它们并导出为 CSV、邮件消息、文本以及任何类型的现有和不存在的文件格式？（当然，具有根据收到的数据创建有效文件的适当技能，但 CSV 很容易获得）。

并且通过签名的 cmdlet 和脚本、组策略和执行策略提供了额外的安全性，即使您以管理员身份运行它们，也有助于防止恶意代码在您的系统上运行。

关于实现了哪些命令 - Richard 的答案列出了它们以及 PowerShell 已经模拟它们的功能的能力。

关于 PowerShell 是否强大以保证切换 - 这更多是个人喜好问题，尽管随着越来越多的 Windows 服务提供 PowerShell cmdlet 来控制它们，不使用带有这些服务的 PowerShell 被认为是一个障碍。（Hyper-V 服务器是主要的此类服务，它还提供了使用 PowerShell cmdlet 比使用 GUI 执行更多操作的能力！）

这个答案可能晚了五年，但是，如果有人在 Windows 上执行管理任务或各种内容的一般脚本，他们绝对应该尝试利用 PowerShell 来达到他们的目的。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-10-26T14:52:45.030

PowerShell 中的 cmdlet 非常好用并且工作可靠。因为我是一名 Java/C# 开发人员，所以它们的面向对象特性对我很有吸引力，但它根本不是一个完整的集合。由于它是面向对象的，因此它错过了POSIX 工具集的许多[文本流](http://en.wikipedia.org/wiki/Unix_philosophy)`awk`成熟度（`sed`仅举几例）。

对于热爱 OO 技术和热爱 POSIX 工具的成熟度这两个困境，我发现的最佳答案是两者都使用！PowerShell 的一个重要方面是它出色地将对象管道传输到标准流。默认情况下，PowerShell 使用对象管道来传输其对象。这些不是标准流（标准输出、标准错误和标准输入）。当 PowerShell 需要将输出传递给没有对象管道的标准进程时，它首先将对象转换为文本流。由于它在这方面做得很好，因此 PowerShell 是托管 POSIX 工具的绝佳场所！

最好的 POSIX 工具集是[GnuWin32](http://sourceforge.net/projects/getgnuwin32/files/latest/download?source=files)。安装确实需要超过 5 秒的时间，但这是值得的，而且据我所知，它不会修改您的系统（注册表、`c:\windows\*`文件夹等），除了将文件复制到您指定的目录。这特别好，因为如果您将工具放在共享目录中，许多人可以同时访问它们。

## GnuWin32 安装说明

下载并执行[exe](http://sourceforge.net/projects/getgnuwin32/files/latest/download?source=files)（它来自[SourceForge 站点](http://sourceforge.net/projects/getgnuwin32/files/)），将其指向合适的目录（我将使用`C:\bin`）。它将`GetGnuWin32`在那里创建一个目录，您将在其中运行`download.bat`，然后`install.bat`（不带参数），之后，将有一个`C:\bin\GetGnuWin32\gnuwin32\bin`目录，该目录是 Windows 机器上曾经存在的最有用的文件夹。将该目录添加到您的路径中，您就可以开始了。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-02-21T20:12:20.663

我还没有看到 PowerShell 真正起飞，至少现在还没有。因此，除非您团队中的其他人已经知道它，否则可能不值得努力学习它。

对于您的困境，您可能最好使用其他人可能落后的脚本语言，如您提到的 Perl，或者像 Ruby 或 Python 之类的其他语言。

我认为这在很大程度上取决于您需要做什么。就我个人而言，我一直将 Python 用于我自己的个人脚本，但我知道当我开始编写一些我永远无法传递的东西时——所以我尽量不做任何太具有革命性的事情。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-10-25T17:01:16.883

为什么不两者都用？在 Cygwin 中调用 PowerShell 脚本，就像 Perl 等任何其他解释脚本一样。

我这样做已经足够了，我为 Bash 包装器编写了[https://bitbucket.org/jbianchi/powershell](https://bitbucket.org/jbianchi/powershell)以在 Cygwin 中调用 powershell.exe。它可以用作一个[shebang](https://en.wikipedia.org/wiki/Shebang_(Unix))作为 powershell.exe .ps1 脚本的第一行（因为 PowerShell 也使用“#”作为注释）。有关示例，请参见[https://bitbucket.org/jbianchi/powershell/wiki/Home](https://bitbucket.org/jbianchi/powershell/wiki/Home)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-08-29T07:13:19.813

在几行中，Cygwin 和 PowerShell 是不同的工具，但是如果您安装了 Cygwin，则可以在 PowerShell 会话中运行 Cygwin 可执行文件。我已经习惯了 PowerShell，以至于现在我不再使用 grep、sort、awk 等。PowerShell 中有很多内置的替代品，如果没有，你可以在那里找到一个 cmdlet。

我发现自己使用的主要工具是 ssh.exe，但在 PowerShell 会话中。

它工作得很好。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-22T02:34:39.623

我发现 PowerShell 编程不值得付出努力。

我有几年在 Unix 下编写 shell 脚本的经验，但我发现用 PowerShell 做很多事情都非常困难。

似乎许多功能都需要您询问 Windows 管理界面并发出类似 SQL 的命令来获取您需要的信息。

例如，我想编写一个脚本来*从目录树中删除所有具有特定后缀的文件。* 在 Unix 下，这将是一个简单的...

```
find . -name \*.xyz -exec rm {} \; 
```

经过几个小时的使用`Scripting.FileSystemObject`并`WScript.Shell`发出 "SELECT * FROM Win32_ShortcutFile WHERE Drive = '" & drive & "' AND Path = '" & searchFolder & "'" 后，我终于放弃并选择了 Windows Explorer 的**搜索**命令只需手动完成。可能有一些方法可以做我想做的事，但我没有看到任何明显的东西，而且 MSDN 网站上的所有示例都如此微不足道，毫无价值。

*编辑*嘿，当然，当我写完这篇文章后，我又四处寻找，发现了我所缺少的东西：`-recurse`remove-item 命令的选项有问题（如果你使用 ，则会显示`get-help remove-item -detailed`）。

我一直在尝试“remove-item -filter '* .xyz' -recurse”，但它不起作用，所以我放弃了。

原来你需要使用`get-childitem -filter '*.xyz' -recurse | remove-item`

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-22T03:22:23.423

PowerShell 非常强大，比 Unix shell 的标准内置程序更强大（但这只是因为它包含了通常由子程序提供的大部分功能）。此外，考虑到您可以使用任何 .NET 语言编写小程序，包括[IronPython](http://en.wikipedia.org/wiki/IronPython)、[IronRuby](https://en.wikipedia.org/wiki/IronRuby)、PerlNet 等。或者您可以简单地从 PowerShell 调用 Cygwin 命令，忽略所有额外功能，它的工作方式类似于 Bash、[KornShell](https://en.wikipedia.org/wiki/KornShell)、管他呢...

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-07-13T17:06:47.337

您还可以尝试在 Windows 上使用 BashWin 在 [https://github.com/skanga/BashWin](https://github.com/skanga/BashWin)上运行 Bash 脚本。

# java - 将客户端应用程序从 Axis 迁移到 Axis 2 时的定位器和存根类

> ID：573624
> 
> 赞同：2
> 
> 时间：2009-02-21T19:42:34.417
> 
> 标签：java, web-services, axis2, axis

我正在尝试将客户端应用程序从 Axis 迁移到 Axis 2。该应用程序还支持通过 RMI 进行连接，因此之前，我们使用存根和定位器文件抽象出连接。例如，我们做了如下的事情：

AddFunctionLocator 定位器 = 新的 AddFunctionLocator ();

AddFunction api = (AddFunctionSoapBindingStub) locator.getAddFunction()

api.addInt(5, 3);

这很有效，因为定位器类将返回存根类，它除了扩展 org.apache.axis.client.Stub 之外，还实现了 AddFunction 接口类。

但是，在使用 WSDL2Java 的 Axis 2 中，我无法确定这种安排是否可行，因为既没有生成定位器类，也没有 Stub 类实现原始的 AddFunction 接口类。是否有人对与 WSDL2Java 一起使用的正确选项或我实现的其他方式有任何建议，以便我可以将这种抽象保留在我们的客户端代码中？

谢谢，

理查德

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-26T17:36:01.653

不幸的是，axis2 不会为客户端存根生成接口。它对带有 -ss 和 -ssi 开关的服务器执行此操作，因此您可以修改客户端以使用这些接口，尽管它不是那么简单。

# c# - 如何在评论或任何地方允许简单的 HTML 标签？

> ID：573627
> 
> 赞同：2
> 
> 时间：2009-02-21T19:45:28.060
> 
> 标签：c#, asp.net, html

在我的网络应用程序中，我正在开发一个评论功能，用户可以在其中发表评论。但我面临一个问题，即我想在评论框中允许简单的 HTML 标记。HTML 标签`<b>, <strong>, <i>, <em>, <u>,`等，通常允许在评论框中输入。但是我也希望当用户按下回车键时，它会自动转换为中断（`<br />`标签）并存储到数据库中，这样当我将它们显示在网页中时，它们看起来就像用户输入的那样。

您能否告诉我如何解析该用户输入的仅允许的 HTML 标签集以及如何将输入转换为`<br />`标签，然后将它们存储在数据库中。

或者，如果有人有更好的想法或建议来实现这种功能。我正在使用 ASP.NET 2.0 (C#)

我注意到 StackOverflow.com 也在 Profile Editing 上做同样的事情。当我们编辑我们的个人资料时，在“关于我”字段下方的“允许基本 HTML”行中写入，我想做几乎相同的功能。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T20:01:12.860

我没有针对您的 C# 特定答案，但您可以通过几种不同的方式来解决。一种是让用户输入他们想要的任何内容，然后在其上运行过滤器以去除“坏”的 html。有许多开源过滤器可以为 PHP、Python 等执行此操作。总的来说，这是一个相当困难的问题，最好让一些开发良好的 3rd 方代码来执行此操作，而不是自己编写。

处理它的另一种方法是允许用户以某种更简单的标记语言输入评论，例如 BBCode、Textile 或 Markdown（stackoverflow 使用 Markdown），也许与一个不错的 Javascript 编辑器结合使用。然后，您通过处理器运行其中一种标记语言的用户文本以获取 HTML。您通常可以为您使用的任何语言获取这些处理器的实现。这些处理器通常会去除“坏”的 HTML。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-08-21T13:59:39.177

由于函数众多，在 php 和 python 中执行此操作相当“简单”。我仍在学习 c# .lol。但还没有遇到这个函数。很有可能它存在，你需要做的就是搜索它。我的意思是一个可以接受用户输入的函数，搜索允许的标签（当然是在数组中）并将 <> 替换为 [] 之类的其他内容，然后使用函数来转义其他 html 标签。在​​ php 中，我们使用 htmlentities()。就像是

```
<code>
$txt=$_POST['comment'];
$txt=strreplace("<b>*</b>","[b]*[/b],"$txt");
$securetxt=htmlentities($txt);
$finaltxt=strreplace("[b]*[/b]","<b>*</b>","$securetxt"); 
```

//现在保存到 Db

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T19:58:02.243

我不确定，但我认为您必须在插入数据库时​​转义 html 字符，并且在检索未转义的回显时，浏览器可以像 html 一样看到它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T20:58:03.550

我不知道 asp.net，但是在 php 中有一个简单的函数**strip_tags**，它可以让你添加异常（在你的情况下是**b**、**em**等）。如果在 C# 中没有类似的东西，您可以编写一个正则表达式，去除除允许的标签之外的所有标签，但很可能这样的表达式已经存在，所以应该很容易找到。

用 br 替换 \n （或类似的东西）不应该是一个简单的搜索和替换的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-01T18:25:14.497

这是一条危险的下坡路。你可能认为你可以做一些很棒的正则表达式，或者找到可以帮助你的人，但是清理一些标记并留下其他标记只是疯狂的谈话。

我强烈建议您研究 BBCode 或其他令牌系统。即使是诸如 SO 使用的未标记的东西，也可能是一个更好的解决方案。

# iphone - 服务器应用程序入门

> ID：573631
> 
> 赞同：0
> 
> 时间：2009-02-21T19:46:22.053
> 
> 标签：iphone, database

我有一个 iPhone 游戏（[组合](http://www.itunes.com/app/Combination)），在下一个版本中我想设置一个服务器，用户（通过应用程序）可以在其中提交他们已经完成的级别，并查看其他用户的表现。在这一点上，我不打算让用户需要用户名和密码，只是简单的提交数据，取回数据。

我对基于服务器的语言和数据库知之甚少，但我听说过很多如果你弄错了可能会发生的可怕事情。设计简单、轻量级、安全数据库的最佳系统是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T20:26:31.393

您是否使用过 Java/C#/Perl/Python 任何其他“服务器端语言”？您是要自己托管服务器端，还是在寻找托管公司？您的决定可能归结为您打算如何托管您的服务器端内容，以及您的托管公司提供什么功能或您喜欢什么。

Java 或 C# 是非常强大的服务器端语言，但托管这些语言可能需要更多的工作（和金钱？）。

Java 可能是一个很好的起点，因为您可以自己设置 Tomcat 并尝试托管一些 Web 服务。MySQL 是一个很好的入门数据库，但还有更轻量级的数据库替代品。其中任何一个都可能有一些学习曲线。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T13:16:27.503

看看[Onyx Online](http://onyx.demiforce.com/)或[OpenFeint](http://www.openfeint.com)怎么样？

Onxy Online 来自 Trism 的制造商，他们说，“将 Xbox Live Arcade 生态系统带到了 iPhone 上”。我将这种系统写进 Trism 作为案例研究，并且取得了圆满成功。自 7 月推出 Trism 以来，我们一直在努力调整此在线代码以用于任何 iPhone 游戏，结果令人惊叹。我们要做的是允许任何开发人员将 Onyx 代码插入他们的游戏中，这将立即启用在线评分、成就、排行榜和自定义论坛。”

OpenFeint 来自 Aurora Feint 的开发者。来自新闻稿：

“OpenFeint 允许任何 iPhone 游戏添加玩家资料、好友列表、墙、新闻源和实时聊天室，从而使游戏能够以零操作开销和最少的开发时间围绕自身建立一个真实的社区。OpenFeint 由服务器和客户端组成. OpenFeint Server 与 Google 的 OpenSocial REST API 完全兼容，可通过 OpenFeint 客户端代码库和 Aurora Feint Inc 的示例 UI 代码访问。独立开发者无需操作服务器，服务器将托管在 Aurora Feint 的数据中心。

作为 iPhone 游戏的首创，iPhone 游戏开发者将能够将超过 2 个月的开发工作减少到 1 天，并完全消除后端服务器操作，同时为他们的玩家提供广泛的可定制社交和社区建设功能：

*   个人资料：玩家可以上传头像照片或使用 iPhone 相机拍摄。
*   墙：每个玩家都有一堵墙，其他玩家可以在上面发表评论并查看墙到墙的对话
*   异步实时聊天室，用于与其他玩家会面，在每个游戏社区内分享技巧、策略和经验
*   好友列表：玩家可以与社区内或整个 iPhone 游戏社区内的其他玩家交朋友
*   新闻源：玩家可以与朋友的所有活动保持联系（留言墙、游戏中的动作、与人交朋友）
*   全球社区聊天室供玩家讨论 iPhone 上其他游戏的推荐、提示和评论”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T21:48:13.773

你听说过[ICE touch](http://www.zeroc.com/labs/icetouch/index.html)吗？[ICE](http://www.zeroc.com/index.html)是用于网络通信的中间件，具有基本的持久性支持。它支持每个主要平台：

*   iPhone 作为客户端
*   Android 作为客户端
*   Objective-C Mac OS X 作为客户端/服务器
*   C++ Linux 作为客户端/服务器
*   Java [任何操作系统] 作为客户端/服务器
*   C#/C++、Windows .NET（使用 Silverlight）和本机作为客户端/服务器

我前段时间对其进行了评估，并对它的成熟度、良好的文档和示例代码感到惊讶。他们将 Skype 命名为他们的客户之一。

作为开始，我建议您查看他们的示例*聊天应用程序*。您可以运行 Java 服务器，连接 iPhone、G1 和 Silverlight 客户端并进行聊天。令人印象深刻的互操作性！

*缺点*是：GPL（如果您自己不是 GPL，则无法链接它）或商业（单独定价）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-14T15:05:07.253

我还建议您使用在线数据库服务，例如[Viravis](http://www.viravis.com)、[DabbleDB](http://www.dabbledb.com)或[Zoho Creator](http://creator.zoho.com)。几乎所有这些类型的服务都需要集成能力才能与 Web、桌面、Windows Mobile 或 iPhone 等客户端一起工作。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-21T20:31:22.740

Java/Javascript 是大多数开发人员事实上的组合，因为每个平台都支持 Java。Java Script 有很多“问题” 其余的人使用 .NET（附带的 100MB 运行时过时软件，每 9 个月更改一次）

php、pearl、ruby 等对服务器端有好处，但如果你想使用代码，最好的解决方案可能是 C/C++（或类似）和 CGI​​/FastCGI。

这允许您编写一次通信算法并在两端使用它们。任何加密/压缩模拟相同。

# design-patterns - 仅通过 Factory DP 实例化我的所有类有什么好处？

> ID：573633
> 
> 赞同：1
> 
> 时间：2009-02-21T19:47:17.167
> 
> 标签：design-patterns, oop, factory

> **可能重复：**
> [使用工厂而不是构造函数来创建对象的阈值是多少？](https://stackoverflow.com/questions/489623/what-is-your-threshold-to-use-factory-instead-of-a-constructor-to-create-an-obje)

仅通过 Factory DP 实例化我的所有类有什么好处？

据了解，当您必须从类似对象列表中进行选择来执行某些任务时，工厂是好的，比如说翻译类（英语->法语，阿拉伯语->希伯来语......）但是当您真的有一个可能的时候选项，没有理由用工厂方法模糊/抽象逻辑。

有什么见解吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T20:00:51.877

工厂方法的一个普遍优势是您可以控制公共接口后面的对象创建。因此，在不影响客户端代码的情况下，您可以稍后添加缓存机制等内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T16:17:08.653

首先简单地编写代码：使用构造函数。如果您发现构造函数稍后会限制您，请在此时重构以使用工厂。避免投机性设计：它增加了复杂性而几乎没有真正的价值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T19:56:32.700

您可能不希望您的所有课程都来自手写工厂。依赖注入可能更有用，您可以编写对象，并且您使用的任何 DI 框架都可以为您填充对象。如果您充分利用 DI，代码中“新”调用的数量将大大减少。

我们经常使用[Spring](http://www.springsource.org/)和[Spring.NET](http://www.springframework.net/)，但也有许多其他选项。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T19:57:06.800

你怎么知道，未来不会有其他可能性？更改依赖项实现的最常见原因之一是单元测试。当您为它编写单元测试时，您真的希望所有依赖项都使用它们的真实实现吗？完美地在编写一个类时，您可以在构造函数中将完成工作所需的内容声明为参数，而无需关心实现的来源。

使用工厂是一种选择，更好的是使用依赖注入容器。开源容器很少——选择一个适合您需求的容器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T02:32:03.753

工厂模式的一种用途是克服您在 Java 和 C# 等语言中发现的[构造函数限制](http://courses.csail.mit.edu/6.170/old-www/2004-Fall/lectures/lecture_18.pdf)：

1.  构造函数只能返回其关联类的实例，而不能返回子类型——即使根据定义，子类型是可以接受的。

2.  构造函数必须始终返回一个新对象，而不是以前分配的对象。这可能很烦人——例如，实际上没有必要拥有多个相等的不可变对象的实例。

# mysql - mysql 从最后 n 行中选择

> ID：573646
> 
> 赞同：68
> 
> 时间：2009-02-21T19:59:37.620
> 
> 标签：mysql, select, query-optimization

我有一个带有索引（自动增量）和整数值的表。该表有数百万行长。

如何最有效地搜索某个数字是否出现在表格的最后 n 行中？

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-02-22T01:52:32.470

从@chaos给出的[答案](https://stackoverflow.com/questions/573646/mysql-select-from-n-last-rows/573665#573665)开始，但有一些修改：

*   `ORDER BY`如果您使用，则应始终使用`LIMIT`. RDBMS 表没有隐式顺序保证。您*通常*可以按主键的顺序获取行，但您不能依赖它，也不能移植。

*   如果按降序排序，则不需要事先知道表中的行数。

*   您必须为派生表提供*相关名称*（也称为表别名）。

这是我的查询版本：

```
SELECT `id`
FROM (
    SELECT `id`, `val`
    FROM `big_table`
    ORDER BY `id` DESC
    LIMIT $n
) AS t
WHERE t.`val` = $certain_number; 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2014-09-14T13:02:40.273

可能是一个很晚的答案，但这很好也很简单。

```
select * from table_name order by id desc limit 5 
```

此查询将返回您在表中插入的一组最后 5 个值（最后 5 行）

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2013-09-02T07:27:31.770

在mysql中检索最后5行

此查询完美运行

```
SELECT * FROM (SELECT * FROM recharge ORDER BY sno DESC LIMIT 5)sub ORDER BY sno ASC 
```

或者

```
select sno from(select sno from recharge order by sno desc limit 5) as t where t.sno order by t.sno asc 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-02-21T23:16:12.860

像使用分页一样利用 SORT 和 LIMIT。如果您想要第 i 个行块，请使用 OFFSET。

```
SELECT val FROM big_table
where val = someval
ORDER BY id DESC
LIMIT n; 
```

回应 Nir：排序操作不一定会受到惩罚，这取决于查询计划器的作用。由于这个用例对分页性能至关重要，因此有一些优化（见上面的链接）。这在 postgres 中也是如此，“ORDER BY ... LIMIT 可以在不排序的情况下完成” [E.7.1。最后一颗子弹](http://www.postgresql.org/docs/8.3/static/release-8-3.html)

```
explain extended select id from items where val = 48 order by id desc limit 10;
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+
| id | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra       |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+
|  1 | SIMPLE      | items | const | PRIMARY       | PRIMARY | 4       | const |    1 | Using index | 
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+ 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-22T02:36:13.207

因为它是自动增量的，所以这是我的看法：

```
Select * from tbl 
where certainconditionshere 
and autoincfield >= (select max(autoincfield) from tbl) - $n 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-10-22T20:14:36.837

我知道这可能有点旧，但请尝试使用`PDO::lastInsertId`. 我认为它可以满足您的要求，但是您必须重写应用程序才能使用 PDO（这对攻击更安全）

# c++ - Excel 自动化。如何复制多个单元格？

> ID：573649
> 
> 赞同：0
> 
> 时间：2009-02-21T20:01:03.780
> 
> 标签：c++, visual-studio-2008, excel, com, automation

**例如：**

```
 //omitted

vector<_bstr_t> cellData;

Excel::_WorksheetPtr pSheet = application->ActiveSheet;

Excel::RangePtr pRange = application->Cells;

_bstr_t cellValue = pRange->Item[1][1]; //single cell

cellData.push_back(cellValue);

 //omitted 
```

**没有：**

*   MFC
*   ATL

**问题：**

*   如何将**多个**单元格（例如 A1:B1）复制到向量中？
*   有没有更**合适**的方法，而不是**Item**？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T18:42:57.110

我从未使用 C++ 完成任何 Excel 自动化，但如果它的工作方式与 VBA 宏类似，那么 WorkSheet 类应该有一个 Range 属性，该属性返回工作表中的一系列单元格。您可以通过提供两个单元格 id 或表示范围的字符串来指定所需的范围。

伪 VBA 中的代码：

```
Dim range As Range
Set range = ActiveSheet.Range("B12:D34")
Set range = ActiveSheet.Range("B12", "D34")
Set range = ActiveSheet.Range("B12", ActivSheet.Range("D34"))
... 
```

有关 Range 类的更多信息，请参阅[MSDN](http://msdn.microsoft.com/en-us/library/microsoft.office.tools.excel.worksheet.range(VS.80).aspx)。

# javascript - 在标签云结构中定位 div 而不重叠？

> ID：573652
> 
> 赞同：1
> 
> 时间：2009-02-21T20:02:06.023
> 
> 标签：javascript, tags, tag-cloud

我想知道是否有人可以提供帮助。

我需要构建一个系统，从数组中提取数字并以云状图案（一系列不同的大小和颜色）显示它们。我对如何构建一个系统来创建 div 感到困惑，这样它们就不会重叠并形成一个很好的紧凑结构。任何指针都会很棒。

模拟：http: [//img228.imageshack.us/my.php ?image=example.png](http://img228.imageshack.us/my.php?image=example.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T20:51:26.310

我想你应该看看一些到处飞来飞去的标签云生成机制，看看它们是如何开展业务的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T03:07:24.027

这不是CSS中[边距的目的吗？](http://www.w3schools.com/CSS/pr_margin.asp)

我应该想象设置一个 1-px 的全方位边距将确保没有一个 div 小于另一个 div 的像素。

# sql - 合并...有人可以帮我优化这段代码吗？

> ID：573654
> 
> 赞同：1
> 
> 时间：2009-02-21T20:03:28.313
> 
> 标签：sql, sql-server, coalesce

谁能帮我优化这段代码？目前需要17秒。

```
set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
GO
--SpResumeSearch NULL,null,null,null,null,null,null,null,null,null,null,NULL,null,null,null,null,null,null,null,0,10,NULL

ALTER PROCEDURE [dbo].[SpResumeSearch] 
    @Keyword varchar(50) = NULL,
    @JobCategoryId int  = NULL,
    @NationalityId int = NULL,
    @CountryId int = NULL,
    @LocationId int = NULL,
    @Email nvarchar(50) = NULL,
    @Gender int = NULL,
    @PassportNumber nvarchar(20) = NULL,
    @VisaStatus int = NULL,
    @PoBox nvarchar(10) = NULL,
    @CareerLevelId int = NULL,
    @KeySkills nvarchar(50) = NULL,
    @ExpectedSalary int = NULL,
    @Experience int = NULL,
    @DOB varchar(20) = NULL,
    @AppliedFrom datetime = NULL,
    @AppliedTo datetime = NULL,
    @MaritalStatusId int = NULL,
    @LanguageId int = NULL,
    @PageIndex int,
    @NumRows int, 
    @SortCol varchar(20) = NULL 
AS 
BEGIN

    DECLARE @startRowIndex INT;
    SET @startRowIndex = (@PageIndex * @NumRows) + 1;

    WITH ResumeListTemp AS 
        (SELECT DISTINCT M.MemberID, R.ResumeID, R.CreatedDate, R.ModifiedDate, R.CompletedDate, RP.FirstName, RP.LastName, G.Title AS Gender, 
        RP.DateOfBirth, C.NationalityTitle AS Nationality, RPD.KeySkills, RPD.ExperienceYear AS Experience, V.Title AS VisaStatus, RC.Phone, RC.Mobile, 
        ROW_NUMBER() OVER (ORDER BY 
            CASE WHEN @SortCol='FIRSTNAME' THEN FirstName END, 
            CASE WHEN @SortCol='LASTNAME' THEN RP.LastName END, 
            CASE WHEN @SortCol='GENDER' THEN G.Title END, 
        CASE WHEN @SortCol='DOB' THEN RP.DateOfBirth END,
        CASE WHEN @SortCol='NATIONALITY' THEN C.NationalityTitle END,
        CASE WHEN @SortCol='KEYSKILLS' THEN RPD.KeySkills END,
        CASE WHEN @SortCol='EXPERIENCE' THEN RPD.ExperienceYear END, 
        CASE WHEN @SortCol='VISASTATUS' THEN V.Title END, 
        CASE WHEN @SortCol='CONTACTNO' THEN RC.Mobile END,
        CASE WHEN @SortCol='UPDATEDATE' THEN R.ModifiedDate END,
        CASE WHEN @SortCol IS NULL THEN R.CompletedDate END
        ) AS RowNum
    FROM TblResume AS R

    LEFT OUTER JOIN TblResumeContactInfo AS RC ON RC.FKResumeID = R.ResumeID
    LEFT OUTER JOIN TblResumePersonalDetail AS RP ON RP.FKResumeID = R.ResumeID
    LEFT OUTER JOIN TblResumeJobCategory AS RJC ON RJC.FKResumeID = R.ResumeID
    LEFT OUTER JOIN TblResumeProfessionalDetail AS RPD ON RPD.FKResumeID = R.ResumeID
    LEFT OUTER JOIN TblResumeWorkExperience AS RE ON RE.FKResumeID = R.ResumeID
    LEFT OUTER JOIN TblResumeEducation AS RQ ON RQ.FKResumeID = R.ResumeID
    LEFT OUTER JOIN TblResumeSkill AS RS ON RS.FKResumeID = R.ResumeID
    LEFT OUTER JOIN TblMember AS M ON M.MemberID = R.FKMemberID
    LEFT OUTER JOIN TblMasterGender AS G ON G.GenderID = RP.FKGenderID
    LEFT OUTER JOIN TblMasterCountry AS C ON C.CountryID = RP.FKNationalityID 
    LEFT OUTER JOIN TblRisVisaStatus AS V ON V.VisaStatusID = RP.FKVisaStatusID
    LEFT OUTER JOIN TblResumeLanguage AS L ON L.FKResumeID = R.ResumeID

    WHERE (
--      RC.Address LIKE '%'+COALESCE(@Keyword,RC.Address)+'%' OR
--      RC.City LIKE '%'+COALESCE(@Keyword,RC.City)+'%' OR
        R.ResumeID IN ( SELECT _RQ.FKResumeID FROM TblResumeEducation AS _RQ, TblResume AS _R WHERE _RQ.Specialization LIKE '%'+COALESCE(@Keyword, _RQ.Specialization)+'%' AND _RQ.FKResumeID=_R.ResumeID GROUP BY _RQ.FKResumeID) OR
        R.ResumeID IN ( SELECT _RQ.FKResumeID FROM TblResumeEducation AS _RQ, TblResume AS _R WHERE _RQ.Institution LIKE '%'+COALESCE(@Keyword, _RQ.Institution)+'%' AND _RQ.FKResumeID=_R.ResumeID GROUP BY _RQ.FKResumeID) OR
        RP.FirstName LIKE '%'+COALESCE(@Keyword,RP.FirstName)+'%' OR
        RP.LastName LIKE '%'+COALESCE(@Keyword,RP.LastName)+'%' OR
        --RP.PassportNumber LIKE '%'+COALESCE(@Keyword,RP.PassportNumber)+'%' OR
        --(@Keyword IS NULL OR RP.PassportNumber LIKE '%' + @Keyword +'%') OR
        RPD.Summary LIKE '%'+COALESCE(@Keyword,RPD.Summary)+'%' OR
--      R.ResumeID IN ( SELECT _RS.FKResumeID FROM TblResumeSkill AS _RS, TblResume AS _R WHERE _RS.Title LIKE '%'+COALESCE(@Keyword,_RS.Title)+'%' AND _RS.FKResumeID=_R.ResumeID GROUP BY _RS.FKResumeID) OR
--      R.ResumeID IN ( SELECT _RE.FKResumeID FROM TblResumeWorkExperience AS _RE, TblResume AS _R WHERE _RE.Employer LIKE '%'+COALESCE(@Keyword, _RE.Employer)+'%' AND _RE.FKResumeID=_R.ResumeID GROUP BY _RE.FKResumeID) OR
        R.ResumeID IN ( SELECT _RE.FKResumeID FROM TblResumeWorkExperience AS _RE, TblResume AS _R WHERE _RE.Designation LIKE '%'+COALESCE(@Keyword, _RE.Designation)+'%' AND _RE.FKResumeID=_R.ResumeID GROUP BY _RE.FKResumeID) OR
        R.ResumeID IN ( SELECT _RE.FKResumeID FROM TblResumeWorkExperience AS _RE, TblResume AS _R WHERE _RE.Responsibilities LIKE '%'+COALESCE(@Keyword, _RE.Responsibilities)+'%' AND _RE.FKResumeID=_R.ResumeID GROUP BY _RE.FKResumeID)) AND 
        R.ResumeID IN ( SELECT _RJC.FKResumeID FROM TblResumeJobCategory AS _RJC, TblResume AS _R WHERE _RJC.FKJobCategoryID = COALESCE(@JobCategoryId, _RJC.FKJobCategoryID) AND _RJC.FKResumeID=_R.ResumeID GROUP BY _RJC.FKResumeID ) AND
        RP.FKNationalityID = COALESCE(@NationalityId, RP.FKNationalityID) AND
        RC.FKCountryID = COALESCE(@CountryId, RC.FKCountryID) AND
--      RPD.FKJobLocationID = COALESCE(@LocationId, RPD.FKJobLocationID) AND 
--      M.Email LIKE '%'+COALESCE(@Email, M.Email)+'%' AND  
--      RP.FKGenderID = COALESCE(@Gender, RP.FKGenderID) AND  
--      RP.PassportNumber LIKE '%'+COALESCE(@PassportNumber, RP.PassportNumber)+'%' AND    
--      RP.FKVisaStatusID = COALESCE(@VisaStatus, RP.FKVisaStatusID) AND    
--      COALESCE(RC.ZipCode,'0') LIKE '%'+COALESCE(@PoBox, COALESCE(RC.ZipCode,'0'))+'%' AND 
        RPD.FKExperienceLevelID = COALESCE(@CareerLevelId, RPD.FKExperienceLevelID) AND 
--      RPD.KeySkills LIKE '%'+COALESCE(@KeySkills, RPD.KeySkills)+'%' AND 
        RPD.FKSalaryID = COALESCE(@ExpectedSalary, RPD.FKSalaryID) AND  
        RPD.ExperienceYear = COALESCE(@Experience, RPD.ExperienceYear) AND  
        RP.DateOfBirth = COALESCE(@DOB, RP.DateOfBirth) AND 
        R.CompletedDate = COALESCE(@AppliedFrom, R.CompletedDate) AND
        R.CompletedDate = COALESCE(@AppliedTo, R.CompletedDate) AND 
        RP.FKMaritalStatusID = COALESCE(@MaritalStatusId, RP.FKMaritalStatusID) AND 
        R.ResumeID IN ( SELECT _L.FKResumeID FROM TblResumeLanguage AS _L, TblResume AS _R WHERE _L.FKLanguageID = COALESCE(@LanguageId, _L.FKLanguageID) AND _L.FKResumeID=_R.ResumeID GROUP BY _L.FKResumeID ) AND
        R.IsCompleted = 1
    )

    SELECT ResumeListTemp.*, (SELECT COUNT(*) from ResumeListTemp) AS RecCount 
        FROM ResumeListTemp
        WHERE RowNum BETWEEN @startRowIndex AND @StartRowIndex + @NumRows - 1
        ORDER BY             
            CASE WHEN @SortCol='FIRSTNAME' THEN FirstName END, 
        CASE WHEN @SortCol='LASTNAME' THEN LastName END, 
        CASE WHEN @SortCol='GENDER' THEN Gender END, 
        CASE WHEN @SortCol='DOB' THEN DateOfBirth END,
        CASE WHEN @SortCol='NATIONALITY' THEN Nationality END,
        CASE WHEN @SortCol='KEYSKILLS' THEN KeySkills END,
        CASE WHEN @SortCol='EXPERIENCE' THEN Experience END, 
        CASE WHEN @SortCol='VISASTATUS' THEN VisaStatus END, 
        CASE WHEN @SortCol='CONTACTNO' THEN Mobile END,
        CASE WHEN @SortCol='UPDATEDATE' THEN ModifiedDate END,
        CASE WHEN @SortCol IS NULL THEN CompletedDate END
END 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T20:37:37.343

尝试用列名替换 *

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T21:12:45.713

在这种情况下，我认为动态构建查询并使用[`sp_executesql`](http://technet.microsoft.com/en-us/library/ms188001.aspx)会给您带来更好的性能。

[这里](http://msdn.microsoft.com/en-us/library/ms175170.aspx)有一篇 MSDN 文章解释了基础知识，还有 Erland Sommarskog 的一些更深入的文章，[这里](http://www.sommarskog.se/dynamic_sql.html)和[这里](http://www.sommarskog.se/dyn-search-2005.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T20:01:09.497

为什么每个 where 子句都以通配符开头？您永远无法使用该技术进行优化（即使您转换为动态 SQL），因为数据库无法使用索引。要求您的用户至少输入他们正在搜索的内容的第一个字母。

摆脱子选择，它们是性能杀手。由于您已经加入这些表，因此您不需要它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T21:29:26.203

由于结果中只有一列需要排序，您可以尝试将 ORDER BY 子句（两次！）替换为

```
CASE @SortCol 
    WHEN 'FIRSTNAME' THEN FirstName 
    WHEN 'LASTNAME' THEN LastName 
    etc
    ELSE CompletedDate 
END 
```

（您可能需要将列转换为 NVARCHAR）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T21:43:11.913

WHERE 部分的优化 - 在我看来，不需要使用 IN 子句，thouse 表已经通过 ResumeID 连接，您只需将它们过滤掉：

```
 WHERE (
(RQ.Specialization IS NOT NULL AND (@Keyword IS NULL OR RQ.Specialization LIKE '%'+@Keyword+'%')) OR
(RQ.Institution IS NOT NULL AND (@Keyword IS NULL OR RQ.Institution LIKE '%'+@Keyword+'%')) OR
(RP.FirstName IS NOT NULL AND (@Keyword IS NULL OR RP.FirstName LIKE '%'+@Keyword+'%')) OR
(RP.LastName IS NOT NULL AND (@Keyword IS NULL OR RP.LastName LIKE '%'+@Keyword+'%')) OR
(RPD.Summary IS NOT NULL AND (@Keyword IS NULL OR RPD.Summary LIKE '%'+@Keyword+'%')) OR
(RE.Designation IS NOT NULL AND (@Keyword IS NULL OR RE.Designation LIKE '%'+@Keyword+'%')) OR
(RE.Responsibilities IS NOT NULL AND (@Keyword IS NULL OR RE.Responsibilities LIKE '%'+@Keyword+'%'))) AND 
(RJC.FKJobCategoryID IS NOT NULL AND (@JobCategoryId IS NULL OR RE.Designation LIKE '%'+@JobCategoryId+'%')) AND
RP.FKNationalityID = COALESCE(@NationalityId, RP.FKNationalityID) AND 
RC.FKCountryID = COALESCE(@CountryId, RC.FKCountryID) AND
RPD.FKExperienceLevelID = COALESCE(@CareerLevelId, RPD.FKExperienceLevelID) AND 
RPD.FKSalaryID = COALESCE(@ExpectedSalary, RPD.FKSalaryID) AND  
RPD.ExperienceYear = COALESCE(@Experience, RPD.ExperienceYear) AND  
RP.DateOfBirth = COALESCE(@DOB, RP.DateOfBirth) AND 
R.CompletedDate = COALESCE(@AppliedFrom, R.CompletedDate) AND
R.CompletedDate = COALESCE(@AppliedTo, R.CompletedDate) AND 
RP.FKMaritalStatusID = COALESCE(@MaritalStatusId, RP.FKMaritalStatusID) AND 
(L.FKLanguageID IS NOT NULL AND (@LanguageId IS NULL OR L.FKLanguageID LIKE '%'+@LanguageId+'%')) AND
R.IsCompleted = 1
) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-21T20:41:18.443

在 LIKE 子句的开头使用 '%' 可能会导致表扫描，如果可能，请尝试删除它们。

# c# - ArrayList 与对象数组与 T 集合

> ID：573655
> 
> 赞同：7
> 
> 时间：2009-02-21T20:03:41.170
> 
> 标签：c#, arrays, generics, collections

我有一个类`Customer`（具有典型的客户属性），我需要传递和数据绑定一个“块”`Customer`实例。目前我正在使用数组 of `Customer`，但我也使用过`Collection`of `T`（在我知道`List`of之前）。我想要使​​用 C# 和 .NET 3.5 传递这个块的最薄方法。`T``Collection``T`

目前，数组`Customer`对我来说工作得很好。它的数据绑定得很好，而且看起来很轻巧。我不需要提供的东西，`List`而且`T`仍然看起来有点矫枉过正。该数组确实要求我提前知道要添加到块中的 s 数量，但我总是提前知道（例如，给定页面中的行）。`Collection``T``Customer`

我错过了一些基本的东西还是没问题`Customer`？有没有我错过的权衡？

另外，我假设`Collection`of`T`会使旧的松散类型`ArrayList`过时。我在吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-21T20:06:47.307

是的，`Collection<T>`（或`List<T>`更常见的）`ArrayList`几乎已经过时了。特别是，我相信`ArrayList`Silverlight 2 甚至不支持。

数组在某些情况下是可以的，但应该被[认为有些有害](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)——它们有各种缺点。（当然，它们是大多数集合*实现*的核心......）我会详细介绍，但 Eric Lippert 做得比我在链接引用的文章中做得更好。我会在这里总结一下，但这很难做到。真的值得一读整篇文章。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-21T23:59:50.493

没有人提到框架指南建议：[不要`List<T>`在公共 API 中](http://blogs.gotdotnet.com/kcwalina/archive/2005/09/26/474010.aspx)使用：

> 我们不建议在公共 API 中使用 List 有两个原因。
> 
> *   `List<T>`不是为扩展而设计的。即你不能覆盖任何成员。例如，这意味着`List<T>`从属性返回的对象将无法在集合被修改时得到通知。 `Collection<T>`允许您覆盖 SetItem 受保护的成员，以便在添加新项目或更改现有项目时获得“通知”。
>     
>     
> *   List 有很多在许多情况下不相关的成员。我们说这`List<T>`对于公共对象模型来说太“忙”了。想象一下 ListView.Items 属性 `List<T>`以其所有的丰富性返回。现在，看看实际的`ListView.Items` 返回类型；它更简单，类似于`Collection<T>`or `ReadOnlyCollection<T>`

此外，如果您的目标是双向数据绑定，请查看[`BindingList<T>`](http://msdn.microsoft.com/en-us/library/ms132679.aspx)（需要注意的是它不是“开箱即用”的可排序！）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-21T20:27:36.057

通常，您应该“传递” IEnumerable<T> 或 ICollection<T> （取决于您的消费者添加项目是否有意义）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T22:37:03.187

如果您有一个不可变的客户列表，那就是......您的客户列表不会改变，它相对较小，并且您将始终从头到尾迭代它，您不需要添加到列表或从中删除它，那么一个数组可能就可以了。

但是，如果您不确定，那么最好的选择是某种类型的集合。您选择的集合取决于您希望对其执行的操作。集合都是关于插入、操作、查找和删除的。如果您经常频繁搜索给定元素，那么字典可能是最好的。如果您需要对数据进行排序，那么 SortedList 可能会更好。

我不会担心“轻量级”，除非您在谈论大量元素，即使这样 O(1) 查找的优势也超过了资源成本。

当你“传递”一个集合时，你只是传递一个引用，它基本上是一个指针。所以传递集合和数组之间没有性能差异。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T21:16:40.103

我将向 Jon 和 Eric Lippert 提出异议），这意味着你应该对我的回答感到非常厌倦，确实！）。

Eric Lippert 反对数组的论点的核心是内容是不可变的，而数据结构本身不是。关于从方法返回它们，List 的内容同样是可变的。事实上，因为您可以从 List 中添加或减去元素，所以我认为这使得返回值比数组*更可变。*

我喜欢数组的另一个原因是因为以前我有一小段性能关键代码，所以我对两者的性能特征进行了基准测试，数组把列表从水中吹了出来。现在，让我警告这一点，说这是对我将如何在特定情况下使用它们的狭隘测试，这与我对两者的理解背道而驰，但数字大不相同。

不管怎样，听 Jon 和 Eric =)，我同意 List 几乎总是更有意义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-21T22:33:50.840

我同意 Alun 的观点，还有一点。如果您可能想通过下标 myArray[n] 来处理返回值，则使用 IList。

Array 本质上支持 IList（以及 IEnumerable 和 ICollection，就此而言）。所以如果你通过接口传递，你仍然可以使用数组作为你的底层数据结构。这样，您将数组传递到其中的方法不必“知道”底层数据结构是一个数组：

```
 public void Test()
{
    IList<Item> test = MyMethod();
}

public IList<Item> MyMethod()
{
    Item[] items = new Item[] {new Item()};
    return items;
} 
```

# html - 当 Firefox 和 IE 左对齐时，Safari 将我的网站中的文本居中。容易修复？

> ID：573661
> 
> 赞同：0
> 
> 时间：2009-02-21T20:06:48.587
> 
> 标签：html, css, firefox, safari

我遇到了一个奇怪的怪癖。我正在为[Escondido Arts Gallery](http://www.escondidoarts.org)构建的网站在 Firefox 和 IE 中的每个元素中都具有左对齐的文本，但由于某种原因，所有内容在 Safari 中都是居中对齐的。我可以做一个简单的 css 或 html 修复来解决这个问题，还是我必须'text-align：left'每个元素？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T20:47:09.707

毫不奇怪：

```
 <body tracingsrc="../../non assets/web2.jpg" tracingopacity="30" align="center"> 
```

Just get rid of the proprietary attributes (align="**center**" especially), and your problem is solved.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T20:19:01.850

```
* { text-align: left; } 
```

如果事情正确级联，这在概念上应该足够了：

```
html, body { text-align: left; } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T20:24:51.633

取决于*为什么*它是左对齐的。如果只是浏览器应用了不同的默认值，您可以按照 grayfade 所说的那样使所有标签在所有浏览器中默认为左对齐。

如果问题是浏览器 CSS 实现中的错误，那么您可能必须追查浏览器不同意的原因，并找到一些解决方法。

指定一个严格的而不是过渡的文档类型也可能有助于从浏览器获得更统一的行为（老实说，我们真的可以声称仍然“过渡”到 HTML4.01 或 XHTML1.0 吗？这两个标准都已经过时了近十年。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T20:34:44.823

CSS 有问题（或存在未闭合的 html 标签）。center align 属性必须与其他元素级联，因为它不仅是 safari/chrome（也使用 webkit），而且是显示事物中心对齐的 opera，而且 safari/chrome 和 opera 都比 ie 甚至 firefox 更符合标准.

# c# - 保持你的主要形式类简短的最佳实践

> ID：573663
> 
> 赞同：1
> 
> 时间：2009-02-21T20:07:11.143
> 
> 标签：c#

我目前有一个主窗体，它有一个选项卡控件和 3 个数据网格（DevExpress xtragrid's）。除了普通的按钮组合框...我想说主窗体中 2/3 的方法与自定义网格或其相关事件处理程序以处理数据输入有关。这使得主窗体代码变得越来越大。

主表单的代码长度是多少？

如果需要，我应该如何移动代码？我目前正在考虑为每个网格创建一个用户控件并将其方法转储在那里。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T20:30:03.460

我在我的商店里构建了相当多的应用程序，并尽量避免，作为一般规则，用一堆特定于控件的代码阻塞主窗体。相反，我会将行为和状态设置封装到一些通常可重用的用户控件中，并将这些内容粘贴到用户控件的文件中。

我在主窗体中没有一个神奇的数字，而是使用“我为什么要把这个放在这里？” 测试。如果我不能想出一个很好的理由来说明为什么要考虑将代码放在主窗体中，我会避​​免使用它。否则，正如您所提到的，主窗体开始增长，管理所有内容变得非常痛苦。

我喜欢将我的胶水代码（事件处理程序等）与主表单本身分开。

至少，我将利用一些区域将代码分成逻辑分组的块。诚然，许多人讨厌#region/#endregion 构造，但我已经记住了几乎所有的击键，所以这对我来说不是问题。我喜欢使用它们只是因为它可以很好地组织事物并在 VS 中很好地折叠起来。

简而言之，除非我说服自己它属于那里，否则我不会将任何东西放在主要形式中。那里有很多好的模式，当它们被使用时，有助于避免否则容易发展的大堆。我回顾了我职业生涯早期的一份文件，该死的东西有 10K 行……绝对荒谬！

无论如何，那是我的两分钱。

祝你有个好的一天！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T20:30:19.217

与任何课程一样，超过 150 行是出现严重错误的迹象。相同的 OO 原则适用于与 UI 相关的类，就像应用程序中的其他任何地方一样。

这个类应该有一个单一的职责。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T21:12:52.470

很难想出一个数字。总的来说，我同意前两张海报，都是关于责任的。

问问自己，为网格 1 自定义行为的代码与网格 2 有什么关系？

主窗体的职责是什么？最近我一直在订阅 MVP 设计模式（MVC 也很好）。在此模式中，您的主要表单是演示者，或 ui 层。它的责任应该是呈现数据并接受用户输入。

没有看到你的代码，我只能猜测什么是最好的行动方案。但我同意您的看法，即每个网格及其自定义代码应该存在于不同的控件中。也许主窗体的职责应该只是将数据传递给正确的控件，并将来自控件的请求传递回控制器/演示者。每个控件都有责任理解传递给它的数据，并相应地显示它。

附件是一个示例 MVP 实现。 [http://www.c-sharpcorner.com/UploadFile/rmcochran/PassiveView01262008091652AM/PassiveView.aspx](http://www.c-sharpcorner.com/UploadFile/rmcochran/PassiveView01262008091652AM/PassiveView.aspx)

# algorithm - 分配班次的算法（离散优化问题）

> ID：573670
> 
> 赞同：21
> 
> 时间：2009-02-21T20:14:29.193
> 
> 标签：algorithm, discrete-mathematics, mathematical-optimization, linear-programming

我正在开发一个应用程序，可以优化地为医院的护士分配轮班。我相信这是一个离散变量的[线性规划](http://en.wikipedia.org/wiki/Linear_programming#Integer_unknowns)问题，因此可能是 NP-hard：

*   每天，每位护士（约 15-20 名）都被分配一个轮班
*   有少量（约 6 个）不同的班次
*   有相当多的约束和优化标准，无论是与一天有关，还是与员工有关，例如：
    *   每天必须为每个班次分配最少人数
    *   一些班次重叠，因此如果有人在做中间班次，则可以在早期班次少一个人
    *   有些人更喜欢早班，有些人更喜欢晚班，但需要最少的换班才能获得更高的轮班工作工资。
    *   一个人一天不能晚班，第二天早班（由于最低休息时间规定）
    *   会议分配的工作周长度（不同的人不同）
    *   ...

所以基本上有大量（大约 20*30 = 600）个变量，每个变量都可以取少量的离散值。

目前，我的计划是使用修改后的[最小冲突算法](http://en.wikipedia.org/wiki/Min_conflicts_algorithm)

*   从随机分配开始
*   对每个人和每一天都有一个健身功能
*   选择健身值最差的人或日子
*   为那一天/人随机选择一项任务，并将其设置为产生最佳适应度值的值
*   重复直到达到最大迭代次数或对于选定的日期/人无法找到改进

有更好的想法吗？我有点担心它会陷入局部最优。我应该使用某种形式的[模拟退火](http://en.wikipedia.org/wiki/Simulated_annealing)吗？或者不仅考虑一次只改变一个变量，还特别考虑两个人之间的轮班切换（当前手动算法的主要组成部分）？我想避免根据当前的约束来定制算法，因为这些可能会改变。

**编辑：**没有必要找到严格的最优解；名册目前是手动完成的，我很确定结果在大多数情况下都不是最理想的——应该不难打败它。短期调整和手动覆盖也肯定是必要的，但我不认为这会是一个问题；将过去和手动分配标记为“固定”实际上应该通过减少解决方案空间来简化任务。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-21T21:05:49.180

这是一个很难很好解决的问题。有很多关于这个主题的学术论文，特别是在[运筹学](http://en.wikipedia.org/wiki/Operations_research)领域——例如，参见[2007-2008 年护士轮班论文](http://www.asap.cs.nott.ac.uk/watt/resources/NR_2008_REFS.pdf)或只是谷歌“护士轮班运营研究”。复杂性还取决于以下方面：要解决多少天；护士可以提出什么样的“要求”；名册是“循环的”；这是一个长期计划还是需要处理短期排班“修复”，例如疾病和掉期等。

您描述的算法是一种[启发式](http://en.wikipedia.org/wiki/Heuristic_(computer_science))方法。您可能会发现您可以对其进行调整以使其适用于问题的一个特定实例，但是一旦“某事”发生更改，它可能就不能很好地工作（例如局部最优、收敛性差）。

但是，根据您的特定业务需求，这种方法可能就足够了 - 例如，获得**最佳**解决方案有多重要，您描述的问题大纲是否预期保持不变，潜在的节省（金钱和资源）是多少，有多重要是护士对其名册质量的看法，这项工作的预算是多少等。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-21T20:57:39.387

嗯，你知道一些 ILP 求解器做得很好吗？试试 AIMMS、Mathematica 或 GNU 编程工具包！600 个变量当然比 Lenstra 定理容易解决的要多得多，但有时这些 ILP 求解器有很好的处理能力，在 AIMMS 中，您可以稍微修改分支策略。另外，ILP 有一个非常快的 100% 近似值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-21T21:52:20.940

我最近为一家大型制造厂解决了轮班分配问题。首先，我们尝试生成纯随机调度并返回任何通过`is_schedule_valid`测试的调度 - 回退算法。当然，这是缓慢而不确定的。

接下来我们尝试了遗传算法（如您所建议的那样），但找不到一个适合任何可行解决方案的良好适应度函数（因为最小的变化可以使整个时间表正确或错误 - 几乎没有积分）。

最后我们选择了以下方法（效果很好！）：

1.  随机化输入集（即工作、轮班、员工等）。
2.  创建一个有效的元组并将其添加到您的暂定计划中。
3.  如果不能创建有效的元组，则回滚（并增加）最后添加的元组。
4.  将部分调度传递给一个测试函数`could_schedule_be_valid`，也就是说，如果剩余的元组以一种可能的方式填充，这个调度是否有效
5.  如果`!could_schedule_be_valid`，只需回滚（并增加）在（2）中添加的元组。
6.  如果`schedule_is_complete`,`return schedule`
7.  后藤 (2)

您以这种方式逐步建立部分转变。好处是一些有效时间表的测试可以很容易地在第 2 步（预测试）中完成，而其他测试必须保留在第 5 步（后测试）中。

祝你好运。我们浪费了几天时间尝试前两种算法，但在不到 5 小时的开发时间内得到了推荐的算法立即生成有效的时间表。

此外，我们支持算法将尊重的分配的前固定和后固定。您根本不会在步骤 1 中随机化这些插槽。您会发现解决方案不必接近最优。我们的解决方案至少是 O(N*M)，但在 PHP(!) 中执行整个制造工厂的时间不到半秒。`could_schedule_be_valid`美妙之处在于使用良好的测试快速排除不良日程安排。

习惯于手动操作的人不在乎是否需要一个小时——他们只知道他们不再需要手动操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-28T20:54:42.533

麦克风，

不知道您是否对此有过很好的回答，但我很确定约束编程就是门票。虽然 GA 可能会给您一个答案，但 CP 旨在为您提供许多答案或告诉您是否没有可行的解决方案。搜索“约束编程”和调度应该会带来很多信息。这是一个相对较新的领域，CP 方法可以很好地解决传统优化方法陷入困境的许多类型的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T20:41:36.460

像贝尔一样的[动态编程？](http://en.wikipedia.org/wiki/Dynamic_programming)听起来有点像它的位置：重叠子问题，最佳子结构。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-21T21:05:29.833

您可以做的一件事是尝试在问题中寻找对称性。例如，就问题而言，您能否将所有护士视为同等对待？如果是这样，那么您只需要按任意顺序考虑护士 - 您可以避免考虑将任何护士*i*安排在 i > j 的任何护士j*之前*的*解决**方案*。（你确实说过个别护士更喜欢轮班时间，这与这个例子相矛盾，尽管这可能是一个不太重要的目标？）

 *** * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-01-04T14:46:19.003

我认为你应该使用遗传算法，因为：

*   它最适合大型问题实例。
*   它以不准确的答案为代价降低了时间复杂度（不是最终最好的）
*   您可以通过调整未满足的健身惩罚来轻松指定约束和偏好。
*   您可以指定程序执行的时间限制。
*   解决方案的质量取决于您打算花多少时间解决程序。

    [遗传算法定义](http://en.wikipedia.org/wiki/Genetic_algorithm)

    [遗传算法教程](http://www.ai-junkie.com/ga/intro/gat1.html)

    [带有 GA 的课程安排项目](http://www.codeproject.com/KB/recipes/GaClassSchedule.aspx)

也看看：[一个类似的问题](https://stackoverflow.com/questions/2746309/best-fit-scheduling-algorithm/2749869#2749869)和[另一个](https://stackoverflow.com/questions/175544/writing-optimization-function/4594898#4594898)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-06T17:24:37.673

使用 CSP 编程，我制作了用于自动shitfs 排班的程序。例如：

1.  2 班制 - 针对 100 多名护士、30 天时间范围、10 多条规则进行了测试
2.  3 班制 - 针对 80 多名护士、30 天时间范围、10 多条规则进行了测试
3.  3 班制，4 个团队 - 测试 365 天，10 多个规则，

和几个类似的系统。所有这些都在我的家用 PC（1.8GHz，双核）上进行了测试。执行时间总是可以接受的，即。3/ 大约需要 5 分钟和 300MB RAM。

这个问题最难的部分是选择合适的求解器和合适的求解策略。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-02-14T15:13:32.397

**Metaheuristics**在[2010 年国际护士排班比赛](https://www.kuleuven-kulak.be/nrpcompetition)中表现出色。

有关实施，请参阅此[视频，其中包含连续护士排班 (java)](http://www.youtube.com/watch?v=7nPagqJK3bs)。

# database - 交换数据库？

> ID：573671
> 
> 赞同：3
> 
> 时间：2009-02-21T20:17:31.370
> 
> 标签：database, data-access-layer, data-access

似乎许多 ORM 工具和自定义数据访问层（DAO 模式等）的目标是将数据库抽象到可以用最少的工作换出整个数据库系统的程度。

在代码中遵循常见的 DAL 模式通常是一个好主意，但换出数据库似乎永远不会是最小的工作。（成本、培训、数据迁移等）

有没有人有在大型系统中将一个数据库换成另一个数据库并处理代码中的影响的经验？是否值得担心从代码中抽象出实际的数据库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T21:24:30.990

我不同意其目的是能够交换数据库，并且我认为您对导致该目标的 ORM 表示怀疑是正确的。

但是，我仍然会使用 ORM，因为它抽象出了数据访问的细节。这不是面向对象编程的目标吗？把你的顾虑分开。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T21:28:16.003

我认为数据库抽象（通过 ORM 工具）的主要用例是能够发布与多个数据库品牌一起使用的产品。我相信公司在数据库供应商之间切换的情况很少见，但这仍然是用例之一。

我从事过一些工作，我们出于金钱原因开始使用 MySQL（想想一家初创公司），并且我们开始赚钱，想切换到 Oracle。我们最终没有做出改变，但很高兴有这个选择。

尽管如此，ORM 工具并不是一个完全无泄漏的抽象，我*知道*我们的迁移仍然会很痛苦且代价高昂。这完全取决于您要构建的内容，但根据我的经验，通常出于性能原因，您最终要么围绕您的 ORM 解决方案工作，要么在某些时候利用供应商特定的功能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-22T01:07:16.273

> **问题 1：**是否有人在大型系统中将一个数据库换成另一个数据库，并处理代码中的影响？

是的，我们试过了。我们的客户正在使用一个大型的基于 MS Access 的 Delphi 客户端服务器应用程序。大约五年后，我们考虑切换到 SQL Server。我们分析了这个问题并得出结论，交换数据库的成本非常高，而且只能提供一些优势。客户决定不交换数据库。该应用程序仍然运行良好，客户仍然很高兴。

注意：

*   MS Access 仅用于数据存储和报告生成。
*   服务器应用程序确保仅在服务器上访问 MS Access。普通的多用户 MS Access 应用程序将通过网络传输大量 Access 数据库 - 导致数据库功能缓慢且不可靠。此应用程序不是这种情况。客户端 <> 服务器 <> MS 访问。只有服务器应用程序与 MS Access 数据库通信。实际上，服务器拥有对 MS Access 数据库的独占访问权限。没有其他计算机可以打开 MS Access 数据库。结论：MS Access 正被用作真正的 RDBMS，关系数据库管理系统——请不要对 MS Access 劣质和不稳定感到愤怒——它已经运行了 10 多年。

您必须考虑的最重要的问题：

1.  **SQL 语句**：（SELECT、UPDATE、DELETE、INSERT、CREATE TABLE）并确保它们与 SQL 数据库兼容。令人惊讶的是所有 RDBMS 在细节上的差异（日期格式、数字格式、搜索格式、字符串格式、连接语法、创建表语法、存储过程、用户定义的函数、（自动）主键等）
2.  **报告生成**：根据您的数据库，您可能使用不同的报告工具。我们的客户有 200 多份复杂的报告。转换所有这些报告非常耗时。
3.  **性能**：所有 RDBMS 在不同的环境中都有不同的性能。通常，性能优化非常依赖于 RDBMS。
4.  **成本**：工具、开发人员、服务器和用户许可的成本差异很大。它的范围从免费到非常昂贵。免费并不意味着便宜，昂贵并不总是等同于好。必须进行成本/价值比较。
5.  **经验**：充分利用您的 RDBMS 需要经验。如果您必须为“未知”RDBMS 开发，您的生产力将会受到影响。

> **问题 2：**是否值得担心从代码中抽象出实际的数据库？

是的。在理想情况下，交换数据库只是调整数据连接字符串。在现实世界中这是不可能的，因为所有数据库都是不同的。它们都有表和 SQL 支持，但区别在于细节。如果您可以通过抽象来屏蔽数据库的差异 - 请这样做。列出您需要支持的数据库。检查所选数据库系统是否存在差异。提供集中式代码来处理差异。支持一个 RDBMS 并为将来支持其他 RDBMS 提供存根。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T20:56:40.213

我唯一一次看到数据库切换是在项目进展期间从早期开发期间的 HSQL 到 Oracle。ORM 让这一切变得简单。

我经常使用 DAO 模式来交换数据服务（从数据库到 Web 服务或将 Web 服务交换到测试存根）。

对于 ORM，我不认为目标是让您能够切换数据库 - 它是让您远离不同数据库实现的复杂性，并且无需担心将数据的关系表示转换为对象表示的精细细节。

通过让某人聪明地编写一个处理缓存的 ORM，只更新已更改的字段、分组更新等，我不需要。虽然在我需要一些特殊的情况下，如果我愿意，我仍然可以恢复到 SQL。

# java - Swing：多面板显示和突出显示文本的对象

> ID：573672
> 
> 赞同：0
> 
> 时间：2009-02-21T20:17:34.677
> 
> 标签：java, swing

我计划制作一个多重比较程序。它将通过在网格中显示 N 个文件来比较多个文件，其中 N = X * Y。X 和 Y 是网格元素的宽度和高度。很简单，我知道如何做到这一点。

问题：如何以及以什么方式最好地突出每个网格元素中的单个字符？我计划突出显示在同一位置找到的匹配文本。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T21:31:43.873

您可以将 a`JTextArea`与 a 一起使用`Highlighter`。[请参阅此页面](http://java.sun.com/docs/books/tutorial/uiswing/components/textfield.html)上的第二个示例以了解如何操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T23:50:16.413

我会使用[JTextPane](http://java.sun.com/docs/books/tutorial/uiswing/components/editorpane.html)而不是 JTextArea，并阅读 StyledDocument 类。这将为您提供各种选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T20:52:24.077

我不确定“突出显示字符”是什么意思，但是为了引起对网格元素或网格元素对的注意，您可以设置适当组件的背景颜色。

# php - 寻找积极维护的 php 矩阵数学库

> ID：573674
> 
> 赞同：6
> 
> 时间：2009-02-21T20:20:52.937
> 
> 标签：php, math, matrix

有谁知道我在哪里可以找到仍在积极维护的 PHP 矩阵数学库？

我需要能够进行基本的矩阵运算，例如归约、转置（包括非方阵）、反转、行列式等。

这个问题过去被问过，然后没有答案就结束了。现在我需要对同一个问题的答案。请参阅这些指向相关问题的链接：

[PHP中的矩阵算法？](https://stackoverflow.com/questions/428473/matrix-artihmetic-in-php) [https://stackoverflow.com/questions/435074/matrix-arithmetic-in-php-again](https://stackoverflow.com/questions/435074/matrix-arithmetic-in-php-again)

当我看到这些并意识到它对我没有帮助时，我正在安装 pear Math_Matrix 库。（感谢 Ben 在您的问题中提出关于转置的评论。）

我可以自己编写这些东西，但我会更高兴看到某个地方有一个库。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T20:40:59.597

您最好用另一种语言进行矩阵操作并从 PHP 调用该代码。PHP 社区通常不关心矩阵计算，所以我想找到你想要的东西会很有挑战性。但是有很多其他语言的数学库。例如，您可以尝试 Python (SciPy)，尽管我不知道混合 PHP 和 Python 有多难。我不知道 PHP，但大多数语言都有调用 C 的方法，例如，您可以从 C 调用 Gnu Scientific Library。

顺便说一句，几乎没有理由反转矩阵。大多数看似需要矩阵求逆的问题实际上都需要求解线性系统。后者更稳定。此外，一些库本身可能没有矩阵求逆例程，因为它们假设人们将使用分解例程（例如 Cholesky）和重复求解方程组。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-20T21:32:00.937

它不是一个真正的库，但此页面上有很多有用的 php 数学代码（包括对矩阵的操作）：

[http://www.phpmath.com/home](http://www.phpmath.com/home)

我希望这个能帮上忙

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-11-17T23:26:40.807

我用过这个非常好： [https ://github.com/mcordingley/LinearAlgebra](https://github.com/mcordingley/LinearAlgebra)

这个看起来还不错： http: [//numphp.org/](http://numphp.org/)

# java - 在 Java 中使用相对路径打开资源

> ID：573679
> 
> 赞同：89
> 
> 时间：2009-02-21T20:26:28.697
> 
> 标签：java, resources, loading

在我的 Java 应用程序中，我需要获取一些文件和目录。

这是程序结构：

```
./main.java
./package1/guiclass.java
./package1/resources/resourcesloader.java
./package1/resources/repository/modules/   -> this is the dir I need to get
./package1/resources/repository/SSL-Key/cert.jks    -> this is the file I need to get 
```

`guiclass`加载将加载我的资源（目录和文件）的资源加载器类。

至于文件，我试过

```
resourcesloader.class.getClass().getResource("repository/SSL-Key/cert.jks").toString() 
```

为了得到真正的路径，但这种方式行不通。

我不知道该目录使用哪个路径。

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2010-01-20T17:50:45.087

我在使用该`getClass().getResource("filename.txt")`方法时遇到了问题。在阅读 Java 文档说明后，如果您的资源与您尝试从中访问资源的类不在同一个包中，那么您必须为其提供以`'/'`. 推荐的策略是将您的资源文件放在根目录中的“资源”文件夹下。因此，例如，如果您具有以下结构：

```
src/main/com/mycompany/myapp 
```

然后您可以按照 maven 的建议添加资源文件夹：

```
src/main/resources 
```

此外，您可以在资源文件夹中添加子文件夹

```
src/main/resources/textfiles 
```

并说你的文件被调用`myfile.txt`所以你有

```
src/main/resources/textfiles/myfile.txt 
```

现在这是愚蠢的路径问题出现的地方。假设您的 中有一个类`com.mycompany.myapp package`，并且您想`myfile.txt`从资源文件夹中访问该文件。有人说你需要提供：

```
"/main/resources/textfiles/myfile.txt" path 
```

或者

```
"/resources/textfiles/myfile.txt" 
```

这两个都是错误的。运行后`mvn clean compile`，文件和文件夹被复制到：

```
myapp/target/classes 
```

文件夹。但是资源文件夹不存在，只有资源文件夹中的文件夹。所以你有了：

```
myapp/target/classes/textfiles/myfile.txt

myapp/target/classes/com/mycompany/myapp/* 
```

所以给予该`getClass().getResource("")`方法的正确路径是：

```
"/textfiles/myfile.txt" 
```

这里是：

```
getClass().getResource("/textfiles/myfile.txt") 
```

这将不再返回 null，而是返回您的类。我希望这对某人有所帮助。我很奇怪，该`"resources"`文件夹也没有被复制，而只是文件夹中的子文件夹和文件`"resources"`。在我看来，该`"resources"`文件夹也可以在下面找到`"myapp/target/classes"`

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2009-02-21T20:46:13.220

提供相对于类加载器的路径，而不是您从中获取加载器的类。例如：

```
resourcesloader.class.getClassLoader().getResource("package1/resources/repository/SSL-Key/cert.jks").toString(); 
```

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2011-06-20T19:08:49.483

希望为那些没有像其他人那样快速掌握它的人提供更多信息，我想提供我的场景，因为它的设置略有不同。我的项目使用以下目录结构设置（使用 Eclipse）：

```
项目/
  src/ // 应用程序源代码
    组织/
      我的项目/
        MyClass.java
  test/ // 单元测试
  res/ // 资源
    images/ // 图标的 PNG 图像
      我的图像.png
    xml/ // XSD 文件，用于使用 JAXB 验证 XML 文件
      我的架构.xsd
    conf/ // Log4j 的默认 .conf 文件
      log4j.conf
  lib/ // 通过项目设置添加到构建路径的库

```

我在从***res***目录加载资源时遇到问题。我希望我的所有资源都与我的源代码分开（仅出于管理/组织目的）。所以，我要做的就是将***res***目录添加到*构建路径*，然后通过以下方式访问资源：

```
static final ClassLoader loader = MyClass.class.getClassLoader();

// in some function
loader.getResource("images/my-image.png");
loader.getResource("xml/my-schema.xsd");
loader.getResource("conf/log4j.conf"); 
```

**注意：**资源字符串的`/`开头省略了 ，因为我使用的是 [ClassLoader.getResource(String)](http://download.oracle.com/javase/6/docs/api/java/lang/ClassLoader.html#getResource%28java.lang.String%29)而不是[Class.getResource(String)](http://download.oracle.com/javase/6/docs/api/java/lang/Class.html#getResource%28java.lang.String%29)。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-22T00:10:36.067

在 Class 上使用“getResource”时，将根据 Class 所在的包解析相对路径。在 ClassLoader 上使用“getResource”时，将根据根文件夹解析相对路径。

如果您使用绝对路径，则两个“getResource”方法都将从根文件夹开始。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2010-10-21T00:27:34.897

@GianCarlo：您可以尝试调用系统属性 user.dir ，它将为您提供 java 项目的根目录，然后将此路径附加到您的相对路径，例如：

```
String root = System.getProperty("user.dir");
String filepath = "/path/to/yourfile.txt"; // in case of Windows: "\\path \\to\\yourfile.txt
String abspath = root+filepath;

// using above path read your file into byte []
File file = new File(abspath);
FileInputStream fis = new FileInputStream(file);
byte []filebytes = new byte[(int)file.length()];
fis.read(filebytes); 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-10-27T12:55:05.653

对于那些使用 eclipse + maven 的人。假设您尝试访问`images/pic.jpg`. `src/main/resources`这样做：

```
ClassLoader loader = MyClass.class.getClassLoader();
File file = new File(loader.getResource("images/pic.jpg").getFile()); 
```

完全正确，但可能导致空指针异常。似乎 eclipse 无法立即将 maven 目录结构中的文件夹识别为源文件夹。通过`src/main/resources`从项目的源文件夹列表中删除文件夹并将其放回（项目>属性>java构建路径>源>删除/添加文件夹），我能够解决这个问题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-21T20:52:43.250

```
resourcesloader.class.getClass() 
```

可以分解为：

```
Class<resourcesloader> clazz = resourceloader.class;
Class<Class> classClass = clazz.getClass(); 
```

这意味着您正在尝试使用引导类加载资源。

相反，您可能想要类似的东西：

```
resourcesloader.class.getResource("repository/SSL-Key/cert.jks").toString() 
```

如果只有 javac 警告在非静态上下文中调用静态方法...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-21T20:45:44.873

以下工作吗？

```
resourcesloader.class.getClass().getResource("/package1/resources/repository/SSL-Key/cert.jks") 
```

您是否有理由不能指定包括包在内的完整路径？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-12-11T08:51:19.557

与上面提到的两个答案一起去。第一个

```
resourcesloader.class.getClassLoader().getResource("package1/resources/repository/SSL-Key/cert.jks").toString();
resourcesloader.class.getResource("repository/SSL-Key/cert.jks").toString() 
```

应该是一回事吗？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-08-13T17:36:52.503

为了获得文件的真实路径，您可以尝试以下操作：

```
URL fileUrl = Resourceloader.class.getResource("resources/repository/SSL-Key/cert.jks");
String pathToClass = fileUrl.getPath; 
```

Resourceloader 在这里是类名。“resources/repository/SSL-Key/cert.jks”是文件的相对路径。如果您的 ./package1/java 中的 guiclass 保留了其余的文件夹结构，则由于定义了相对路径的规则，您会将“../resources/repository/SSL-Key/cert.jks”作为相对路径。

这样您就可以使用 BufferedReader 读取文件。不要使用字符串来标识文件的路径，因为如果路径中有空格或某些非英文字母的字符，则会出现问题并且找不到文件。

```
BufferedReader bufferedReader = new BufferedReader(
                        new InputStreamReader(fileUrl.openStream())); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-04-27T17:42:32.270

我对@jonathan.cone 的一个衬里进行了小修改（通过添加`.getFile()`）以避免空指针异常，并设置数据目录的路径。这对我有用：

```
String realmID = new java.util.Scanner(new java.io.File(RandomDataGenerator.class.getClassLoader().getResource("data/aa-qa-id.csv").getFile().toString())).next(); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-02-28T16:00:10.527

用这个：

```
resourcesloader.class.getClassLoader().getResource("/path/to/file").**getPath();** 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-09-19T14:41:32.587

在所有操作系统上工作的稳定方法之一是`System.getProperty("user.dir")`

```
String filePath = System.getProperty("user.dir") + "/path/to/file.extension";

Path path = Paths.get(filePath);
if (Files.exists(path)) {
    return true;
} 
```

# c# - 数组的大小是否受 int (2147483647) 的上限限制？

> ID：573692
> 
> 赞同：6
> 
> 时间：2009-02-21T20:31:50.087
> 
> 标签：c#, arrays, int, integer-overflow

我正在做一些[Project Euler](http://projecteuler.net/)练习，我遇到了一个场景，我~~想要~~`int`大于 2,147,483,647（ C# 中的上限）的数组。

当然这些是大数组，但例如，我不能这样做

```
// fails
bool[] BigArray = new BigArray[2147483648];

// also fails, cannot convert uint to int
ArrayList BigArrayList = new ArrayList(2147483648); 
```

那么，我可以有更大的数组吗？

编辑：这是为了[阿特金筛子](http://en.wikipedia.org/wiki/Sieve_of_Atkin)，你知道，所以我只想要一个非常大的：D

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-21T20:33:01.487

每当您使用这么大的阵列时，您可能应该尝试找到更好的解决方案。但话虽如此，我仍然会尝试回答你的问题。

如[本文](http://msdn.microsoft.com/en-us/library/ms241064(VS.80).aspx)所述，.Net 中的任何对象都有 2 GB 的限制。适用于所有 x86、x64 和 IA64。

> 与 32 位 Windows 操作系统一样，在 64 位 Windows 操作系统上运行 64 位托管应用程序时可以创建的对象大小限制为 2GB。

此外，如果您在堆栈上定义的数组太大，您将有堆栈溢出。如果您在堆上定义数组，它将尝试将其全部分配在一个大的连续块中。最好使用在堆上具有隐式动态分配的 ArrayList。这不会让你超过 2GB，但可能会让你更接近它。

我认为只有在使用 x64 或 IA64 架构和操作系统时，堆栈大小限制才会更大。使用 x64 或 IA64，您将拥有 64 位可分配内存，而不是 32 位。

如果您不能一次全部分配数组列表，您可以分部分分配它。

在具有 6GB RAM 的 x64 Windows 2008 机器上使用数组列表并一次添加 1 个对象，我最多可以得到 ArrayList 的大小：134217728。所以我真的认为你必须找到一个更好的解决方案来解决你的问题不使用那么多内存。也许写入文件而不是使用 RAM。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-21T20:38:16.017

数组限制是，afaik，即使在 64 位上也固定为 int32。单个对象的最大尺寸有上限。但是，您可以很容易地拥有一个漂亮的大锯齿状阵列。

更差; 因为 x64 中的引用更大，所以对于 ref 类型的数组，您实际上在单个数组中获得的元素*更少。*

见[这里](http://www.twine.com/item/11qtqln9x-1s/josh-williams)：

> 我收到了许多关于为什么 2.0 .Net 运行时的 64 位版本仍然将数组最大大小限制为 2GB 的问题。鉴于这似乎是最近的热门话题，我想出了一些背景知识，并讨论了绕过这个限制的选项。
> 
> 首先是一些背景；在 .Net 运行时 (CLR) 的 2.0 版本中，我们做出了一个有意识的设计决定，将 GC 堆中允许的最大对象大小保持在 2GB，即使在运行时的 64 位版本上也是如此。这与 32 位 CLR 的当前 1.1 实现相同，但是您将很难在 32 位 CLR 上实际分配 2GB 对象，因为虚拟地址空间太碎片化而无法实际找到 2GB洞。通常人们并不特别关心创建实例化（或任何接近）时大于 2GB 的类型，但是由于数组只是在托管堆中创建的一种特殊类型的托管类型，因此它们也受到此限制的影响。

* * *

应该注意的是，在 .NET 4.5 中， [gcAllowVeryLargeObjects标志可以选择性地删除](http://msdn.microsoft.com/en-us/library/hh285054(v=vs.110).aspx)*内存大小*限制，但是，这不会更改最大*维度*大小。关键是，如果您有自定义类型的数组或多维数组，那么您现在可以超过 2GB 的内存大小。

 ** * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-21T21:21:17.613

您根本不需要那么大的数组。

当你的方法遇到资源问题时，不要只看如何扩展资源，还要看方法。:)

这是一个使用 3 MB 缓冲区来使用 Eratosthenes 筛计算素数的类。该类跟踪您计算质数的距离，以及何时需要扩展范围，它会创建一个缓冲区来测试另外 300 万个数字。

它将找到的素数保存在一个列表中，当范围扩大时，previos 素数用于排除缓冲区中的数字。

我做了一些测试，大约 3 MB 的缓冲区是最有效的。

```
public class Primes {

   private const int _blockSize = 3000000;

   private List<long> _primes;
   private long _next;

   public Primes() {
      _primes = new List<long>() { 2, 3, 5, 7, 11, 13, 17, 19 };
      _next = 23;
   }

   private void Expand() {
      bool[] sieve = new bool[_blockSize];
      foreach (long prime in _primes) {
         for (long i = ((_next + prime - 1L) / prime) * prime - _next;
            i < _blockSize; i += prime) {
            sieve[i] = true;
         }
      }
      for (int i = 0; i < _blockSize; i++) {
         if (!sieve[i]) {
            _primes.Add(_next);
            for (long j = i + _next; j < _blockSize; j += _next) {
               sieve[j] = true;
            }
         }
         _next++;
      }
   }

   public long this[int index] {
      get {
         if (index < 0) throw new IndexOutOfRangeException();
         while (index >= _primes.Count) {
            Expand();
         }
         return _primes[index];
      }
   }

   public bool IsPrime(long number) {
      while (_primes[_primes.Count - 1] < number) {
         Expand();
      }
      return _primes.BinarySearch(number) >= 0;
   }

} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-21T20:38:46.403

我相信即使在 64 位 CLR 中，每个对象也有 2GB（或者可能是 1GB——我记不清了）的限制。这将阻止您创建更大的数组。Array.CreateInstance 仅采用 Int32 参数作为大小的事实也具有启发性。

从更广泛的角度来看，我怀疑如果您需要这么大的数组，您应该真正改变解决问题的方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T00:25:07.623

我是 C# 的新手（即本周学习它），所以我不确定如何实现 ArrayList 的确切细节。但是，我猜由于您没有为 ArrayList 示例定义类型，因此该数组将被分配为对象引用数组。这很可能意味着您实际上分配了 4-8Gb 的内存，具体取决于架构。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-09-15T20:47:26.120

[根据 MSDN](http://msdn.microsoft.com/en-us/windows/apps/hh285054.aspx)，字节数组的索引不能大于 2147483591。对于 .NET 4.5 之前的版本，它也是数组的内存限制。在 .NET 4.5 中，这个最大值是相同的，但对于其他类型，它可以达到 2146435071。

这是用于说明的代码：

```
 static void Main(string[] args)
    {
        // -----------------------------------------------
        // Pre .NET 4.5 or gcAllowVeryLargeObjects unset
        const int twoGig = 2147483591; // magic number from .NET

        var type = typeof(int);          // type to use
        var size = Marshal.SizeOf(type); // type size
        var num = twoGig / size;         // max element count

        var arr20 = Array.CreateInstance(type, num);
        var arr21 = new byte[num];

        // -----------------------------------------------
        // .NET 4.5 with x64 and gcAllowVeryLargeObjects set
        var arr451 = new byte[2147483591];
        var arr452 = Array.CreateInstance(typeof(int), 2146435071);
        var arr453 = new byte[2146435071]; // another magic number

        return;
    } 
```

# svn - 一个SVN存储库中多个项目的文件夹结构？

> ID：573695
> 
> 赞同：33
> 
> 时间：2009-02-21T20:33:45.293
> 
> 标签：svn, repository

我刚刚创建了一个[Google Code](http://code.google.com/) SVN 存储库，用于存储我的学校项目和家庭作业，并允许在学校和家庭之间轻松转移。

它创建的默认目录是：

> [https://simucal-projects.googlecode.com/svn/trunk/](https://simucal-projects.googlecode.com/svn/trunk/)
> [https://simucal-projects.googlecode.com/svn/tags/](https://simucal-projects.googlecode.com/svn/tags/)
> [https://simucal-projects.googlecode.com/svn/branches/](https://simucal-projects.googlecode.com/svn/branches/)

我从来没有为多个项目使用存储库，但在阅读后：[一个 svn 存储库还是多个？](https://stackoverflow.com/questions/252459/one-svn-repository-or-many/252553)我决定为我所有的随机学校项目建立一个存储库。

我应该只复制上面的文件夹结构，但是对于每个项目？

> [https://simucal-projects.googlecode.com/svn/projectA/trunk/](https://simucal-projects.googlecode.com/svn/projectA/trunk/)
> [https://simucal-projects.googlecode.com/svn/projectA/tags/](https://simucal-projects.googlecode.com/svn/projectA/tags/)
> [https://simucal-projects.googlecode.com/svn/项目A/分支机构/](https://simucal-projects.googlecode.com/svn/projectA/branches/)
> 
> [https://simucal-projects.googlecode.com/svn/projectB/trunk/](https://simucal-projects.googlecode.com/svn/projectB/trunk/)
> [https://simucal-projects.googlecode.com/svn/projectB/tags/](https://simucal-projects.googlecode.com/svn/projectB/tags/)
> [https://simucal-projects.googlecode.com/svn/项目B/分支机构/](https://simucal-projects.googlecode.com/svn/projectB/branches/)

这是你们多项目合一回购的人所做的吗？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-02-21T20:47:32.327

您有两种选择。您已经提到的那个，即每个项目都有一个主干（选项1）：

```
https://simucal-projects.googlecode.com/svn/projectA/trunk/
https://simucal-projects.googlecode.com/svn/projectA/tags/
https://simucal-projects.googlecode.com/svn/projectA/branches/

https://simucal-projects.googlecode.com/svn/projectB/trunk/
https://simucal-projects.googlecode.com/svn/projectB/tags/
https://simucal-projects.googlecode.com/svn/projectB/branches/ 
```

选项 2 是有一个主干，每个项目都是主干下的子文件夹：

```
https://simucal-projects.googlecode.com/svn/trunk/projectA/
https://simucal-projects.googlecode.com/svn/tags/projectA/
https://simucal-projects.googlecode.com/svn/branches/projectA/

https://simucal-projects.googlecode.com/svn/trunk/projectB/
https://simucal-projects.googlecode.com/svn/tags/projectB/
https://simucal-projects.googlecode.com/svn/branches/projectB/ 
```

选项 1 的优点是您可以独立地对每个项目进行分支和标记。如果您需要单独部署每个项目，这是可取的。

如果所有项目都部署在一起，则选项 2 是可取的。这是因为您只需在部署时标记存储库一次。

由于您将 Subversion 用于学校项目，因此您需要问自己是否需要标记您的工作。您还可以问自己是否需要创建分支（如果您想尝试一下，您可能会想要）。您还需要问自己是否乐于将所有工作分支为一个整体，是否更喜欢独立分支每个项目的灵活性。

我始终遵循的经验法则：将我们部署在一起的任何东西都放在一起。

（顺便说一句 - 您可以在同一个存储库中拥有多个主干 - 这几乎相当于在多个存储库中拥有一个主干，除了每个存储库维护自己的修订计数器并且您不能在存储库之间合并。）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-21T20:41:35.557

这就是我用于家庭源代码控制的方法。

我只有一个主存储库。

> Repository/Project1/Trunk
> Repository/Project1/Tags
> Repository/Project1/Branches
> 
> Repository/Project2/Trunk
> Repository/Project2/Tags
> Repository/Project2/Branches

我喜欢这种结构，它很容易引用项目并保持完整性。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-21T21:25:26.043

一个真实的例子：Apache Projects[存储库](http://svn.apache.org/viewvc/)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-08-03T09:34:40.690

跟踪文件夹布局（在版本控制中）的主要目标之一是访问控制管理。

如果需要分离开发团队（在主干上工作）和维护团队（处理分支），这种结构很好：

```
/trunk
      /Project1
      /Project2
/branches
         /Project1
         /Project2
/tags
     /Project1
     /Project2 
```

如果我们想允许每个项目访问特定的用户组，这个结构很好：

```
/Project1
         /trunk
         /branches
         /tags
/Project2
         /trunk
         /branches
         /tags 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-21T20:43:41.430

这个问题没有明确的答案，因为它取决于什么最适合您的项目。

1.  如果每个项目正在进行大量开发并且所有内容都需要分离，我会使用 /projectA/trunk 布局，因为它之间没有太多联系（独立的组件/项目）。但是，您也可以为每个项目使用一个 SVN 存储库。请记住，您将无法使用 svn co http://..../svn/ 查看所有项目，因为这也会从所有项目中获取所有标签和分支，而不仅仅是主干。
2.  /trunk/projectA 如果您的项目/组件紧密结合在一起，并且您需要从同一修订版标记和分支它们（例如非常接近主项目的库），那么 /trunk/projectA 肯定会更好。如果您愿意，您还可以使用 svn co http://.../svn/trunk/ 来获取所有项目的最新主干修订版。

从可维护性的角度来看，我几乎总是更喜欢第二种方式；但是如果您的项目变得更大并且可能会延长，最好为每个项目使用单独的存储库。

除此之外：请检查你是否真的需要谷歌代码服务来完成你的作业，因为它的目的是支持 OSS。您始终可以在本地甚至通过 SSH 使用 SVN，因此您也可以将存储库放在 U 盘或可以远程访问的某些计算机上；你真的不需要托管。也可能存在隐私问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-21T20:49:16.270

如果您坚持只拥有一个存储库（我自己也在 DON'T camp 中）并进行分支，那么我认为您的建议是好的。但同样，我认为 SVN 存储库等于一个项目。

# ruby - 在ruby中卸载动态声明的类

> ID：573698
> 
> 赞同：4
> 
> 时间：2009-02-21T20:35:13.993
> 
> 标签：ruby

我有一个使用 theClass.class_eval 和 Object.const_set(className, theClass) 定义的类。有没有办法删除这个类的定义？在测试期间，我需要加载同一类的不同版本。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-21T21:04:37.840

Object.send(:remove_const, className) 成功了。

# open-source - 展示 TDD 和 SOLID 原则的开源项目

> ID：573699
> 
> 赞同：17
> 
> 时间：2009-02-21T20:35:21.297
> 
> 标签：open-source, tdd, solid-principles

我之前问过一个类似的问题，得到了一些很好的答案，但我认为它太笼统了。

[伟大的软件设计和实施的例子](https://stackoverflow.com/questions/559484/examples-of-great-software-design-and-implementation)

有谁知道任何展示了非常好的 TDD 实践和 SOLID 原则的开源项目？TDD 和 SOLID 被广泛宣传，但我自己从未见过真正做过，我只是想了解它在项目（大或小）中的样子？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-09T06:36:42.160

[健身](http://fitnesse.org)。这大约是 50K 行 Java 代码。[它是使用TDD](http://en.wikipedia.org/wiki/Test-driven_development)构建的，并且具有大约 90% 的代码覆盖率（可能更高）。自始至终都强烈使用了[SOLID](https://en.wikipedia.org/wiki/SOLID_%28object-oriented_design%29)原则。

我相信你可以找到一些你不喜欢的部分。我经常这样做。但总体而言，该系统非常强大。我们有成千上万的用户和一个非常小的错误列表。我们经常发布，唯一的 QA 测试是：`ant testbuild`. 如果测试通过，我们就会发货。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-21T20:47:49.470

春天框架

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-22T09:22:40.577

[FitNesse](http://fitnesse.org/)，由 SOLID 先生，鲍勃·马丁叔叔维护。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-10T13:27:25.660

[Dimdwarf Application Server](http://dimdwarf.sourceforge.net/) - 它完全使用 TDD/BDD 编写，并尝试编写尽可能干净的代码（SOLID、好名字等）。生产代码约为 4500 SLOC，测试代码约为 7300 SLOC，代码覆盖率超过 90%，最大的生产类约为 200 LOC。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-21T20:51:02.100

CruiseControl.NET

# c# - 如果您不打算从自适应渲染中受益，那么使用 HtmlTextWriter 有什么好处吗？

> ID：573722
> 
> 赞同：15
> 
> 时间：2009-02-21T20:49:42.743
> 
> 标签：c#, stream, conventions, htmltextwriter

**除了受益于备用设备的自适应渲染之外，编写所有这些代码是否有意义：**

```
writer.WriteBeginTag("table");
writer.WriteBeginTag("tr");
writer.WriteBeginTag("td");
writer.Write(HtmlTextWriter.TagRightChar);
writer.WriteEncodedText(someTextVariable);
writer.WriteEndTag("td");
writer.WriteEndTag("tr");
writer.WriteEndTag("table"); 
```

**当 StringBuilder 可以简单地构建相同的东西时：**

```
sb.Append("<table><tr><td>");
sb.Append(someTextVariable);
sb.Append("</td></tr></table>"); 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-07T06:36:41.133

另一个优点可能是使用 HtmlTextWriter 可以以更清洁（更易于维护）的方式格式化代码，并且 HtmlTextWriter 支持自动编码 HTML。比较：

```
writer.AddAttribute(HtmlTextWriterAttribute.Id, "someId");
if (!string.IsNullOrEmpty(cssClass)) writer.AddAttribute(HtmlTextWriterAttribute.Class, cssClass);
writer.AddStyleAttribute(HtmlTextWriterStyle.Color, "Red");
writer.RenderBeginTag(HtmlTextWriterTag.Span);
writer.WriteEncodedText(text);
writer.RenderEndTag(); 
```

相对：

```
StringBuilder html = new StringBuilder();
html.Append("<span");
html.Append(" id=\"someId\"");
if (!string.IsNullOrEmpty(cssClass)) html.AppendFormat(" class=\"{0}\"", HttpUtility.HtmlAttributeEncode(cssClass));
html.Append(">");
html.Append(HttpUtility.HtmlEncode(text));
html.Append("</span>"); 
```

有人可能会争辩说，第二个示例中的代码可以用一种不同的、可能更简洁的方式编写，但这可以被视为 HtmlTextWriter 的一个优势，因为它基本上强制执行一种规范的格式化方式（这再次改进了维护）。

**编辑：**事实上，我实际上在第二个片段中犯了一个错误，我需要返回并修复响应。这证实了我想表达的观点。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-21T21:03:24.333

我可以想到使用 HtmlTextWriter 的两个原因：

1.  您可以使用编写器来跟踪您的缩进，以便您输出的 HTML 格式正确，而不是出现在一行上

2.  HtmlTextWriter 通常与输出流相关联，因此它应该比在内存中构建长字符串更有效（取决于您生成多少 HTML）。

这些都不是特别的原因，但它们足以说服我在需要效率时使用编写器，或者如果我正在编写一个将被重用并且应该尽可能专业的基本控件。你的旅费可能会改变 ：-）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-21T21:14:47.097

HtmlTextWriter 是有益的，因为：

HtmlTextWriter 是最干净的，并且标记在呈现时缩进很好。

HtmlTextWriter 直接写入输出流会影响性能。在调用 ToString 之前，Stringbuilder 不会写入输出流。

这里还有一个例子说明为什么你会使用 HtmlTextWriter 来[保存和重用 HTML 输出](http://www.ondotnet.com/pub/a/dotnet/excerpt/ASP.NETCookbook_chap1a/index.html?page=2)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-21T21:02:55.643

在某些时候，您仍然需要将其传递给 HtmlTextWriter 以便呈现给客户端。我猜你会有一个最终的 writer.Write(sb.ToString()); 在第二个例子中。减少代码行数的方法是编写原始 HTML，与第二个 StringBuilder 示例中的方式完全相同，但改用 HtmlTextWriter.Write。

```
writer.Write("<table><tr><td>");
writer.Write(someTextVariable);
writer.Write("</td></tr></table>"); 
```

然后使用 StringBuilder 似乎没有必要。而且，HtmlTextWriter 至少在一定程度上会确保生成的 HTML 是合规的（尽管在上述情况下，在编写原始 HTML 时，情况并非如此）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-03-05T13:59:19.447

我能想到的最大原因是避免采取额外的步骤来清理您的输入。根据文档，[`WriteEncodedText`](https://docs.microsoft.com/en-us/dotnet/api/system.web.ui.htmltextwriter.writeencodedtext?view=netframework-4.7.2#System_Web_UI_HtmlTextWriter_WriteEncodedText_System_String_)将自动适当地格式化任何尖括号。

[XSS](https://www.owasp.org/index.php/Cross-site_Scripting_(XSS))是一个真实的东西，你可以做的任何事情来让未来的开发者更容易维护你的代码是一种好处。

# c++ - 如何将标准输出重定向到 Windows 应用程序中的某个可见显示？

> ID：573724
> 
> 赞同：39
> 
> 时间：2009-02-21T20:50:08.593
> 
> 标签：c++, c, windows, user-interface, stdout

我可以访问做“好东西”的第三方库。它向标准输出发出状态和进度消息。在控制台应用程序中，我可以很好地看到这些消息。在 Windows 应用程序中，它们只是进入位桶。

是否有一种相当简单的方法可以将 stdout 和 stderr 重定向到文本控件或其他可见位置。理想情况下，这不需要重新编译第三方代码。它只会拦截低水平的蒸汽。我想要一个解决方案，我只需#include 标头，调用初始化函数并链接库，如...

```
#include "redirectStdFiles.h"

void function(args...)
{
  TextControl* text = new TextControl(args...);
  initializeRedirectLibrary(text, ...);

  printf("Message that will show up in the TextControl\n");
  std::cout << "Another message that also shows up in TextControl\n";
} 
```

如果它使用一些我可以覆盖的界面，这样它就不会绑定到任何特定的 GUI 库，那就更好了。

```
class StdFilesRedirector
{
  public:
    writeStdout(std::string const& message) = 0;
    writeStderr(std::string const& errorMessage) = 0;
    readStdin(std::string &putReadStringHere) = 0;
}; 
```

我只是在做梦吗？或者有人知道可以做这样的事情吗？

在两个答案后编辑：我认为使用 freopen 重定向文件是一个很好的第一步。对于完整的解决方案，需要创建一个新线程来读取文件并显示输出。对于调试，在 cygwin shell 窗口中执行 'tail -f' 就足够了。对于更精致的应用程序......这就是我想要写的......将需要一些额外的工作来创建线程等。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-21T21:16:19.903

您需要创建管道（使用[CreatePipe() ），然后使用](http://msdn.microsoft.com/en-us/library/aa365152(VS.85).aspx)[SetStdHandle](http://msdn.microsoft.com/en-us/library/ms686244(VS.85).aspx) ()将标准输出附加到它的写入端，然后您可以使用[ReadFile()](http://msdn.microsoft.com/en-us/library/aa365467(VS.85).aspx)从管道的读取端读取并将从那里获得的文本放在您喜欢的任何地方。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-21T20:54:40.187

您可以使用[freopen](http://www.cplusplus.com/reference/clibrary/cstdio/freopen.html)重定向标准输出、标准错误和标准输入。

从上面的链接：

```
/* freopen example: redirecting stdout */
#include <stdio.h>

int main ()
{
  freopen ("myfile.txt","w",stdout);
  printf ("This sentence is redirected to a file.");
  fclose (stdout);
  return 0;
} 
```

您还可以通过命令提示符运行程序，如下所示：

```
a.exe > stdout.txt 2> stderr.txt 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-05T23:26:54.310

您可能正在寻找类似的东西：

```
 #define OUT_BUFF_SIZE 512

    int main(int argc, char* argv[])
    {
        printf("1: stdout\n");

        StdOutRedirect stdoutRedirect(512);
        stdoutRedirect.Start();
        printf("2: redirected stdout\n");
        stdoutRedirect.Stop();

        printf("3: stdout\n");

        stdoutRedirect.Start();
        printf("4: redirected stdout\n");
        stdoutRedirect.Stop();

        printf("5: stdout\n");

        char szBuffer[OUT_BUFF_SIZE];
        int nOutRead = stdoutRedirect.GetBuffer(szBuffer,OUT_BUFF_SIZE);
        if(nOutRead)
            printf("Redirected outputs: \n%s\n",szBuffer);

        return 0;
    } 
```

这个类将做到这一点：

```
#include <windows.h>

#include <stdio.h>
#include <fcntl.h>
#include <io.h>
#include <iostream>

#ifndef _USE_OLD_IOSTREAMS
using namespace std;
#endif

#define READ_FD 0
#define WRITE_FD 1

#define CHECK(a) if ((a)!= 0) return -1;

class StdOutRedirect
{
    public:
        StdOutRedirect(int bufferSize);
        ~StdOutRedirect();

        int Start();
        int Stop();
        int GetBuffer(char *buffer, int size);

    private:
        int fdStdOutPipe[2];
        int fdStdOut;
};

StdOutRedirect::~StdOutRedirect()
{
    _close(fdStdOut);
    _close(fdStdOutPipe[WRITE_FD]);
    _close(fdStdOutPipe[READ_FD]);
}
StdOutRedirect::StdOutRedirect(int bufferSize)
{
    if (_pipe(fdStdOutPipe, bufferSize, O_TEXT)!=0)
    {
        //treat error eventually
    }
    fdStdOut = _dup(_fileno(stdout));
}

int StdOutRedirect::Start()
{
    fflush( stdout );
    CHECK(_dup2(fdStdOutPipe[WRITE_FD], _fileno(stdout)));
    ios::sync_with_stdio();
    setvbuf( stdout, NULL, _IONBF, 0 ); // absolutely needed
    return 0;
}

int StdOutRedirect::Stop()
{
    CHECK(_dup2(fdStdOut, _fileno(stdout)));
    ios::sync_with_stdio();
    return 0;
}

int StdOutRedirect::GetBuffer(char *buffer, int size)
{
    int nOutRead = _read(fdStdOutPipe[READ_FD], buffer, size);
    buffer[nOutRead] = '\0';
    return nOutRead;
} 
```

结果如下：

```
1: stdout
3: stdout
5: stdout
Redirected outputs:
2: redirected stdout
4: redirected stdout 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-21T21:09:57.047

[当您使用CreateProcess()](http://msdn.microsoft.com/en-us/library/ms682425.aspx)创建进程时，您可以选择`HANDLE`要写入的 stdout 和 stderr。这`HANDLE`可以是您将输出定向到的文件。

这将使您无需重新编译即可使用代码。只需执行它，而不是使用`system()`或诸如此类，使用`CreateProcess()`.

您提供的 HANDLE`CreateProcess()`也可以是您创建的管道，然后您可以从管道中读取数据并对数据执行其他操作。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-21T21:14:10.063

你可以用 cout 或 cerr 做这样的事情：

```
// open a file stream
ofstream out("filename");
// save cout's stream buffer
streambuf *sb = cout.rdbuf();
// point cout's stream buffer to that of the open file
cout.rdbuf(out.rdbuf());
// now you can print to file by writing to cout
cout << "Hello, world!";
// restore cout's buffer back
cout.rdbuf(sb); 
```

或者，您可以使用`std::stringstream`从`std::ostream`.

要重定向标准输出，您需要重新打开文件句柄。[这个线程](http://www.gamedev.net/community/forums/topic.asp?topic_id=126564)有一些这种性质的想法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-21T23:08:39.540

这就是我要做的：

1.  创建管道（）。
2.  CreateProcess() 使用来自 CreatePipe() 的句柄作为新进程的标准输出。
3.  创建一个计时器或线程，不时在该句柄上调用 ReadFile() 并将读取的数据放入文本框或诸如此类的东西中。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-11-26T16:02:42.217

在这里，我们将设置一个新的入口点`consoleMain`来覆盖您自己的入口点。

1.  确定应用程序的入口点。在 VisualStudio 中，选择*Project Properties/Linker/Advanced/Entry Point*。让我们称之为`defaultMain`。
2.  在您的源代码中的某处声明原始入口点（以便我们可以链接到它）和新入口点。两者都必须声明`extern "C"`以防止名称修改。

    ```
    extern "C"
    {
      int defaultMain (void);
      int consoleMain (void);
    } 
    ```

3.  实现入口点功能。

    ```
    __declspec(noinline) int consoleMain (void)
    {
      // __debugbreak(); // Break into the program right at the entry point!
      AllocConsole();    // Create a new console
      freopen("CON", "w", stdout);
      freopen("CON", "w", stderr);
      freopen("CON", "r", stdin); // Note: "r", not "w".
      return defaultMain();
    } 
    ```

4.  在某处添加您的测试代码，*例如*在按钮单击操作中。

    ```
    fwprintf(stdout, L"This is a test to stdout\n");
    fwprintf(stderr, L"This is a test to stderr\n");
    cout<<"Enter an Integer Number Followed by ENTER to Continue" << endl;
    _flushall();
    int i = 0;
    int Result = wscanf( L"%d", &i);
    printf ("Read %d from console. Result = %d\n", i, Result); 
    ```

5.  设置`consoleMain`为新的入口点（*Project Properties/Linker/Advanced/Entry Point*）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-23T01:09:13.577

感谢grayfade 答案中的[gamedev](http://www.gamedev.net/community/forums/topic.asp?topic_id=126564)链接，我能够编写和测试这段简单的代码

```
AllocConsole();

*stdout = *_tfdopen(_open_osfhandle((intptr_t) GetStdHandle(STD_OUTPUT_HANDLE), _O_WRONLY), _T("a"));
*stderr = *_tfdopen(_open_osfhandle((intptr_t) GetStdHandle(STD_ERROR_HANDLE), _O_WRONLY), _T("a"));
*stdin = *_tfdopen(_open_osfhandle((intptr_t) GetStdHandle(STD_INPUT_HANDLE), _O_WRONLY), _T("r"));

printf("A printf to stdout\n");
std::cout << "A << to std::cout\n";
std::cerr << "A << to std::cerr\n";
std::string input;
std::cin >> input;

std::cout << "value read from std::cin is " << input << std::endl; 
```

它可以工作并且足以进行调试。将文本变成更具吸引力的 GUI 元素需要更多的工作。

# ruby - 用于匹配 APA 参考格式的 Ruby 正则表达式

> ID：573739
> 
> 赞同：2
> 
> 时间：2009-02-21T20:57:47.653
> 
> 标签：ruby, regex

我需要一个匹配 APA 格式引用的正则表达式。

我目前有这个：

```
/([A-Z][a-zA-Z\-\:\'\s\´]{3,}\, ([a-zA-Z]\.[\s|,|.]| &?){1,}){1,}\(\d\d\d\d(, [A-Z][a-z\- ]*\d\d?|)\)\.[a-zA-Z\-\:\'\s]{3,}\.[a-zA-Z\-\s]+\,[ ]*\d\d(\(\S\))*,\d+.\d+./ 
```

它只能捕获 10 个并且非常脆弱。

我只需要期刊文章——不是书籍，不是非英文文章。

任何关于如何使这个正则表达式更易于管理的提示都值得赞赏。

我使用[Rubular构建它](http://www.rubular.com/)

这是源数据（我知道缺少空格和国际字符问题）：

> Bre´dart, S.、Valentine, T.、Calder, A. 和 Gassi, L. (1995)。面部命名的交互式激活模型。实验心理学季刊，48(A),466–486.Bruce, V., & Young, A. (1986)。了解面部识别。BritishJournal of Psychology，77,305–327.Burton, AM, & Bruce, V. (1992)。我认得你的脸，但我不记得你的名字：一个简单的解释？英国心理学杂志，83,45–60.Flude, B., Ellis, A., & Kay, J. (1990)。异常失语症中的面部处理和姓名检索：姓名与人的语义信息分开存储。大脑和认知，11,60–72。Gratton, G., Coles, MGH, Sirevaag, EJ, Eriksen, CW, & Donchin, E。（1988 年）。反应通道的刺激前和刺激后激活：心理生理分析。实验心理学杂志：人类感知与表现，14,331–344.Hodges, JR, & Greene, JDW (1998)。了解人并命名他们：阿尔茨海默氏病患者可以做一个没有另一个吗？实验心理学季刊，51(A),121–134.Huynh, H., & Feldt, LS (1976)。从随机区组和裂区设计中的样本数据中估计框校正的自由度。教育统计杂志，1,69-82.Jasper, HH (1958)。脑电图临床检查方法委员会报告。脑电图和临床神经生理学，10,370–375。Johnston, RA, & Bruce, V. (1990)。财产损失？检索熟悉的人的名称代码和语义代码之间的差异。心理研究 52,62–67.Kornhuber, HH, & Deecke, L. (1965)。Hirnpotentialaenderungen beiWillkuerbewegungen und passiven Bewegungen des Menschen: Be-reitschaftspotential und reafferente Potentiale [人类自愿和被动运动的脑电位变化：准备电位和传入电位].Pfluegers Archiv fuer die Gesamte Physiologie,284,1–17.Kutas, M., & Donchin, E.（1974 年 11 月 8 日）。挤压研究：惯用手、反应手、反应力和准备势的不对称性。科学，186,545–547.Kutas, M., & Donchin, E. (1980)。准备响应，表现为与运动相关的脑电位。脑研究，202,95–115 Hirnpotentialaenderungen beiWillkuerbewegungen und passiven Bewegungen des Menschen: Be-reitschaftspotential und reafferente Potentiale [人类自愿和被动运动的脑电位变化：准备电位和传入电位].Pfluegers Archiv fuer die Gesamte Physiologie,284,1–17.Kutas, M., & Donchin, E.（1974 年 11 月 8 日）。挤压研究：惯用手、反应手、反应力和准备势的不对称性。科学，186,545–547.Kutas, M., & Donchin, E. (1980)。准备响应，表现为与运动相关的脑电位。脑研究，202,95–115 Hirnpotentialaenderungen beiWillkuerbewegungen und passiven Bewegungen des Menschen: Be-reitschaftspotential und reafferente Potentiale [人类自愿和被动运动的脑电位变化：准备电位和传入电位].Pfluegers Archiv fuer die Gesamte Physiologie,284,1–17.Kutas, M., & Donchin, E.（1974 年 11 月 8 日）。挤压研究：惯用手、反应手、反应力和准备势的不对称性。科学，186,545–547.Kutas, M., & Donchin, E. (1980)。准备响应，表现为与运动相关的脑电位。脑研究，202,95–115 Pfluegers Archiv fuer die Gesamte Physiologie,284,1–17.Kutas, M., & Donchin, E.（1974 年，11 月 8 日）。挤压研究：惯用手、反应手、反应力和准备势的不对称性。科学，186,545–547.Kutas, M., & Donchin, E. (1980)。准备响应，表现为与运动相关的脑电位。脑研究，202,95–115 Pfluegers Archiv fuer die Gesamte Physiologie,284,1–17.Kutas, M., & Donchin, E.（1974 年，11 月 8 日）。挤压研究：惯用手、反应手、反应力和准备势的不对称性。科学，186,545–547.Kutas, M., & Donchin, E. (1980)。准备响应，表现为与运动相关的脑电位。脑研究，202,95–115

混淆 mletterle 答案的参考书目示例

```
Lippold, O. C. J. (1967). Electromyography. In P. H. Venables & I. Martin
(Eds.), A manual of psychophysiological methods (pp. 245–298). Amsterdam:
North-Holland.
Low, K. A., & Miller, J. (1999). The usefulness of partial information:
Effects of go probability in the choice/nogo task. Psychophysiology, 36,
288–297. 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-21T21:43:22.787

这个正则表达式应该做你想做的

```
([^\.].*?[0-9])(?=\.|\Z) 
```

它使用正向检查来检查数字后跟一个句点（或字符串的结尾），它从捕获中排除句点。你可以在这里看到结果： [http ://www.rubular.com/regexes/6293](http://www.rubular.com/regexes/6293)

# haskell - 使用 foldl 计算真值的数量

> ID：573751
> 
> 赞同：5
> 
> 时间：2009-02-21T21:07:35.197
> 
> 标签：haskell, functional-programming, count

我正在尝试找到一种使用 foldl 执行以下功能的方法：

```
count a = length (filter (\i -> i) a) 
```

它只计算布尔值列表中为真的值的数量。我自己尝试过

```
count = foldl (\i -> 
            case i of
                True -> (1+)
                False -> (0+)
            ) 0 
```

这甚至没有编译。有什么建议么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-21T21:20:22.653

那么让我们来看看所涉及的函数的类型

```
Prelude> :t (\i -> case i of { True -> (1+) ; False -> (0+) })
(\i -> case i of { True -> (1+) ; False -> (0+) }) :: (Num t) => Bool -> t -> t
Prelude> :t foldl
foldl :: (a -> b -> a) -> a -> [b] -> a 
```

因此，对于您的`Bool`s 列表，b 是 Bool，但您使用的函数`Bool`作为第一个参数，而不是第二个参数。累加值是第一个参数。所以你可以这样做

```
foldl (\acc p -> case p of { True -> acc + 1 ; False -> acc }) 0 
```

或者，如果您只想修复参数顺序，请使用您的原始函数`flip`

```
Prelude> :t flip
flip :: (a -> b -> c) -> b -> a -> c

foldl (flip (\i -> case i of
                           True -> (1+)
                           False -> (0+)
             )) 0 
```

或者你可以更简洁：`foldl (flip ((+) . fromEnum)) 0`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-21T21:20:23.933

怎么样：

```
count = foldl (\i v -> if v then i + 1 else i) 0 
```

另一种没有的方法`foldl`：

```
count list = sum $ map fromEnum list 
```

归功于 Logan 的指出`fromEnum`。以前没听说过那个。

# unit-testing - 通过 CC.NET 运行时 NUnit 测试失败

> ID：573759
> 
> 赞同：1
> 
> 时间：2009-02-21T21:14:23.603
> 
> 标签：unit-testing, cruisecontrol.net, log4net, rhino-mocks

这个错误的解决方案已经让我好几天了，现在是时候来这里寻求帮助了。简短的版本是，我有一个在构建服务器上失败但没有其他环境的单元测试。

我正在测试的方法是 log4net 中 ILog 的扩展方法。此扩展方法的目的是在调用时制作当前方法的调试日志，并使用它进行调试。执行此操作的代码非常简单。

```
public static void MethodHead(this ILog log, params object[] parameters)
{
    /* Assert */
    log.AssertNonNull();

    /* Since this is an expensive operation, don't do it if Debug is not enabled */
    if (log.IsDebugEnabled)
    {
        StackTrace stackTrace = new StackTrace();

        /* Get calling method */
        MethodBase method = stackTrace.GetFrame(1).GetMethod();

        string logMessage = string.Format("{0}.{1}({2})", method.DeclaringType.Name, method.Name, parameters.ToDelimitedString(", "));
        log.Debug(logMessage);
    }
} 
```

在这种方法中，我检查是否启用了调试模式，因为如果不应该记录任何内容（由于性能问题），我不想执行 StackTrace。当我测试这个方法时，我将使用 Rhino Mocks 来模拟 ILog 接口并让 IsDebugEnabled 返回 true。

请考虑以下 NUnit 测试方法。

```
[Test(Description = "Verify that MethodHead extension method will log with calling class.method(arguments)")]
public void MethodHeadShouldLogCurrentMethodNameWithArguments()
{
    /* Setup */
    MockRepository mocks = new MockRepository();
    ILog log = mocks.CreateMock<ILog>();
    string[] arguments = new string[] { "CAT", "IN", "A", "HAT" };

    string logMessage = string.Format("{0}.{1}({2})",
        "MethodHeadTest", "CallingMethod", arguments.ToDelimitedString(", "));

    With.Mocks(mocks).Expecting(delegate
    {
        /* Record */
        Expect.Call(log.IsDebugEnabled).Return(true);
        Expect.Call(delegate { log.Debug(logMessage); });
    })
    .Verify(delegate
    {
        /* Verify */
        CallingMethod(log, arguments);
    });
}

private void CallingMethod(ILog log, params object[] arguments)
{
    log.MethodHead(arguments);
} 
```

这在我的开发环境（带有 TestDriven.NET 的 Visual Studio 2008）中执行良好。如果我通过 nunit-console.exe 或 nunit-gui 运行测试，它确实执行得很好。如果我使用我的 NAnt 脚本执行测试，它甚至运行良好。

但是，我的构建服务器在通过从 CruiseControl.NET 执行的 NAnt 运行时未能通过此测试。当我在构建服务器上使用 nunit-console.exe 手动运行它时，它会成功。

错误和堆栈跟踪如下。

```
Rhino.Mocks.Exceptions.ExpectationViolationException : ILog.Debug("**<>c__DisplayClass8.<MethodHeadShouldLogCurrentMethodNameWithArguments>b__5**(CAT, IN, A, HAT)"); Expected #0, Actual #1\. 
ILog.Debug("MethodHeadTest.CallingMethod(CAT, IN, A, HAT)"); Expected #1, Actual #0.

at Rhino.Mocks.MethodRecorders.UnorderedMethodRecorder.DoGetRecordedExpectation(IInvocation invocation, Object proxy, MethodInfo method, Object[] args)
at Rhino.Mocks.MethodRecorders.MethodRecorderBase.GetRecordedExpectation(IInvocation invocation, Object proxy, MethodInfo method, Object[] args)
at Rhino.Mocks.Impl.ReplayMockState.DoMethodCall(IInvocation invocation, MethodInfo method, Object[] args)
at Rhino.Mocks.Impl.ReplayMockState.MethodCall(IInvocation invocation, MethodInfo method, Object[] args)
at Rhino.Mocks.MockRepository.MethodCall(IInvocation invocation, Object proxy, MethodInfo method, Object[] args)
at Rhino.Mocks.Impl.RhinoInterceptor.Intercept(IInvocation invocation)
at Castle.DynamicProxy.AbstractInvocation.Proceed()
at ILogProxy86e676a4761d4509b43a354c1aba33ed.Debug(Object message)
at Vanilla.Extensions.LogExtensions.MethodHead(ILog log, Object[] parameters) in d:\Build\Mint\WorkingDirectory\Source\Main\Vanilla\Extensions\LogExtensions.cs:line 42
at Vanilla.UnitTests.Extensions.LogExtensions.MethodHeadTest.<>c__DisplayClass8.<MethodHeadShouldLogCurrentMethodNameWithArguments>b__5() in d:\Build\Mint\WorkingDirectory\Source\Test\Vanilla.UnitTests\Extensions\LogExtensions\MethodHeadTest.cs:line 99
at Rhino.Mocks.With.FluentMocker.Verify(Proc methodCallsToBeVerified)
at Vanilla.UnitTests.Extensions.LogExtensions.MethodHeadTest.MethodHeadShouldLogCurrentMethodNameWithArguments() in d:\Build\Mint\WorkingDirectory\Source\Test\Vanilla.UnitTests\Extensions\LogExtensions\MethodHeadTest.cs:line 90 
```

所以问题是构建服务器认为这个方法有另一个（动态的？）名称。或者更确切地说，是 Rhino Mocks 做出了这个假设？

由于无法在我的开发机器上重新创建它，因此我无法解决此错误。我很高兴我能得到所有的意见。

谢谢！

迈克尔·伦丁

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T21:49:23.613

看起来 CallingMethod 在构建服务器上被优化掉了。当您手动重复测试时，您真的使用完全相同的程序集吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T09:15:11.750

CallingMethod 可能会被优化掉，这是我没有想到的。让我对此进行更多测试。

首先，我在构建服务器上手动调用 nant。

```
"C:\Program Files\nant-0.86-beta1\bin\nant.exe" test -D:nunit.exe.path="C:\\Program Files\\NUnit 2.4.8\bin\\" -D:Artifact.Output.Path="D:\\Build\\Mint\\Artifacts\\" -D:msbuild.logger="C:\\Program Files\\CruiseControl.NET\\server\\ThoughtWorks.CruiseControl.MSBuild.dll" -D:fxcop.exe.path="C:\\Program Files\\Microsoft FxCop 1.36\\" 
```

这工作正常，测试不会失败！我转到生成的二进制文件并在其上手动执行 NUnit。

```
D:\Build\Mint\WorkingDirectory\Source\Test\Vanilla.UnitTests\bin\Debug>"C:\Program Files\NUnit 2.4.8\bin\nunit-console.exe" Vanilla.UnitTests.dll
NUnit version 2.4.8
Copyright (C) 2002-2007 Charlie Poole.
Copyright (C) 2002-2004 James W. Newkirk, Michael C. Two, Alexei A. Vorontsov.
Copyright (C) 2000-2002 Philip Craig.
All Rights Reserved.

Runtime Environment -
   OS Version: Microsoft Windows NT 5.2.3790 Service Pack 2
  CLR Version: 2.0.50727.3082 ( Net 2.0.50727.3082 )

..............................................................
Tests run: 62, Failures: 0, Not run: 0, Time: 7.891 seconds 
```

它可以正常工作。但是当我通过 CC.NET 强制构建时，测试会失败，就像我上面显示的那样。然后，如果我选择构建服务器生成的二进制文件并在那些上运行 NUnit，我就会成功。

因此，二进制文件不会改变，但测试成功/失败取决于 NAnt 是通过命令行还是 CC.NET 运行。

这是我用来执行我的 NAnt 构建脚本的 cc.net 任务。

```
<nant>
    <executable>C:\Program Files\nant-0.86-beta1\bin\nant.exe</executable>
    <buildArgs>-D:nunit.exe.path="C:\\Program Files\\NUnit 2.4.8\bin\\" -D:Artifact.Output.Path="D:\\Build\\Mint\\Artifacts\\" -D:msbuild.logger="C:\\Program Files\\CruiseControl.NET\\server\\ThoughtWorks.CruiseControl.MSBuild.dll" -D:fxcop.exe.path="C:\\Program Files\\Microsoft FxCop 1.36\\"</buildArgs>
    <nologo>true</nologo>
    <buildFile>Mint.build</buildFile>
    <targetList>
        <target>clean</target>
        <target>build</target>
        <target>test</target>
        <target>staticAnalysis</target>
    </targetList>
    <buildTimeoutSeconds>1200</buildTimeoutSeconds>
</nant> 
```

在我的构建脚本中执行 NUnit 的任务有点混乱。

```
<!-- Run all tests -->
<target name="test" description="Run NUnit tests" depends="build">
  <property name="Failed.Test.Count" value="0"/>

  <!-- Test Vanilla -->
  <property name="Test.Name" value="Vanilla.UnitTests" />
  <call target="runCurrentTest" />

  <fail if="${int::parse(Failed.Test.Count)>0}" message="Failures reported in unit tests" />
</target>

<!-- Utility method to run tests -->
<target name="runCurrentTest">      
  <exec program="${nunit.exe.path}nunit-console.exe"
      failonerror="false"
      resultproperty="Test.Result"
      verbose="true">
      <arg value="${Test.Path + Test.Name + '\bin\Debug\' + Test.Name}.dll" />
      <arg value="/xml:${Artifact.Output.Path + Test.Name}-nunit-results.xml" />
      <arg value="/nologo" />
  </exec>
  <property name="Failed.Test.Count" value="${int::parse(Test.Result) + int::parse(Failed.Test.Count)}"/>
</target> 
```

我可以在 msbuild exec 调用上明确放置优化标志，以确定它不是这样的问题吗？我确实将编译直接指向 csproj 文件。msbuild 不应该从那里选择优化配置吗？

感谢您的所有意见！迈克尔·伦丁

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T11:23:36.310

我解决了。

从我的代码中删除 CallingMethod 并让测试直接调用 SUT。它使测试代码看起来有点难看，但它确实有效。

仍然不知道为什么 CallingMethod 在通过 CC.NET 运行时会更改名称。我想这将由其他人来弄清楚。

# python - Python 中 Twitter 的情感分析

> ID：573768
> 
> 赞同：88
> 
> 时间：2009-02-21T21:20:24.790
> 
> 标签：python, machine-learning, nlp, open-source, sentiment-analysis

**我正在寻找文本情感分析**（[http://en.wikipedia.org/wiki/Sentiment_analysis](http://en.wikipedia.org/wiki/Sentiment_analysis)）的开源实现，最好是在python中。有人熟悉我可以使用的这种开源实现吗？

我正在编写一个应用程序，它在 twitter 上搜索一些搜索词，比如“youtube”，并计算“快乐”推文与“悲伤”推文。我正在使用 Google 的 appengine，所以它在 python 中。我希望能够对来自 twitter 的返回搜索结果进行分类，并且我想在 python 中做到这一点。到目前为止，我还没有找到这样的情绪分析器，特别是在 python 中。你熟悉我可以使用的这种开源实现吗？最好这已经在python中，但如果没有，希望我可以将它翻译成python。

请注意，我正在分析的文本非常短，它们是推文。因此，理想情况下，该分类器针对此类短文本进行了优化。

顺便说一句，twitter 确实支持搜索中的 ":)" 和 ":(" 运算符，它们的目的就是为了做到这一点，但不幸的是，它们提供的分类并不是那么好，所以我想我可以自己尝试一下.

谢谢！

[顺便说一句，这里](http://twitgraph.appspot.com/?show_inputs=1&duration=30&q=youtube+annotations)有一个早期的演示，我到目前为止的代码也在[这里](http://code.google.com/p/twitgraph/)，我很乐意与任何感兴趣的开发人员一起开源它。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-03-03T19:54:07.457

祝你好运。

情绪与上下文密切相关，而推文文化使问题变得更糟，因为大多数推文*都没有给出上下文*。twitter 的全部意义在于，您可以利用大量共享的“现实世界”上下文将有意义的通信打包到非常短的消息中。

如果他们说视频不好，这意味着不好还是*不好*？

> 有一天，一位语言学教授正在给她的班级讲课。“在英语中，”她说，“双重否定形成肯定。但是在某些语言中，例如俄语，双重否定仍然是否定的。但是，没有一种语言可以使双重肯定形成否定。”
> 
> 房间后面传来一个声音，“是……对。”

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-02-22T00:26:23.220

对于大多数此类应用程序，您将不得不为统计分类任务编写大部分自己的代码。正如 Lucka 建议的那样，NLTK 是 Python 中自然语言操作的完美工具，只要您的目标不干扰其许可证的非商业性质。但是，我建议使用其他软件包进行建模。我还没有找到很多可用于 Python 的强大的高级机器学习模型，所以我将推荐一些可以轻松与之配合的独立二进制文件。

您可能[对高级判别建模工具包](http://tadm.sf.net)感兴趣，它可以很容易地与 Python 交互。这已用于自然语言处理各个领域的分类任务。您还可以选择多种不同的型号。只要您已经熟悉实现朴素贝叶斯分类器，我建议您从最大熵分类开始。如果没有，您可能需要研究它并编写一个代码，以便真正理解作为机器学习任务的统计分类。

德克萨斯大学奥斯汀分校的计算语言学小组举办了课程，其中大多数项目都使用了这个伟大的工具。您可以查看[Computational Linguistics II](http://comp.ling.utexas.edu/jbaldrid/courses/2006/cl2/)的课程页面，了解如何使其工作以及它以前服务过的应用程序。

另一个以同样方式工作的好工具是[Mallet](http://mallet.cs.umass.edu/)。Mallet 之间的区别在于有更多的文档和一些可用的模型，例如决策树，而且它是用 Java 编写的，在我看来，这让它慢了一点。 [Weka](http://www.cs.waikato.ac.nz/ml/weka/)是一整套不同的机器学习模型，包含在一个大包中，其中包括一些图形内容，但它实际上主要用于教学目的，并不是我真正投入生产的东西。

祝你任务顺利。真正困难的部分可能是您对模型将学习的“种子集”进行分类所需的知识工程量。它需要相当大，这取决于您是在进行二元分类（快乐与悲伤）还是整个情绪范围（这将需要更多）。确保保留其中一些工程数据进行测试，或者运行一些十倍或删除一个测试，以确保您在将其发布之前确实做好了预测。最重要的是，玩得开心！在我看来，这是 NLP 和 AI 最好的部分。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-03-19T13:04:07.113

谢谢大家的建议，确实很有用！我最终使用了从[这里](http://www.divmod.org/trac/wiki/DivmodReverend)借来的朴素贝叶斯分类器。我首先为它提供了一个好/坏关键字列表，然后通过使用用户反馈添加了一个“学习”功能。结果证明效果很好。

我的工作的全部细节在[博客文章](http://www.gbsheli.com/2009/03/twitgraph-en.html)中。

再次，您的帮助非常有用，非常感谢！

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-07-18T13:54:10.823

我已经构建了一个带有情感标签的单词列表。您可以从这里访问它：

[http://www2.compute.dtu.dk/pubdb/views/edoc_download.php/6010/zip/imm6010.zip](http://www2.compute.dtu.dk/pubdb/views/edoc_download.php/6010/zip/imm6010.zip)

你会在我的博客上找到一个简短的 Python 程序：

[http://finnaarupnielsen.wordpress.com/2011/06/20/simplest-sentiment-analysis-in-python-with-af/](http://finnaarupnielsen.wordpress.com/2011/06/20/simplest-sentiment-analysis-in-python-with-af/)

这篇文章展示了如何将单词列表与单句以及 Twitter 一起使用。

单词列表方法有其局限性。你会在文章“A new ANEW: Evaluation of a word list for sentiment analysis in microblogs”中找到对我的词表局限性的调查。那篇文章可以从我的主页上找到。

请注意`unicode(s, 'utf-8')`代码中缺少 a（出于教学原因）。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-02-21T23:04:24.247

许多研究论文表明，情绪分析的一个良好起点是查看形容词，例如，它们是积极形容词还是消极形容词。对于一小段文本，这几乎是您唯一的选择...有些论文会查看整个文档或句子级别的分析，但是正如您所说的推文很短...没有真正的神奇方法来理解一句话的情绪，所以我认为你最好的选择是寻找其中一篇研究论文并尝试获得他们的积极/消极形容词的数据集。

现在，已经说过，情绪是特定领域的，您可能会发现很难使用通用数据集获得高水平的准确性。

祝你好运。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-21T22:50:05.060

我想你可能会发现很难找到你想要的东西。我所知道的最接近的东西是[LingPipe](http://alias-i.com/lingpipe/index.html)，它具有一些[情绪分析功能](http://alias-i.com/lingpipe/demos/tutorial/sentiment/read-me.html)，并且可以在有限的开源许可证下使用，但是是用 Java 编写的。

此外，情绪分析系统通常是通过在产品/电影评论数据上训练一个系统来开发的，这与普通推文有很大不同。它们将针对包含多个句子的文本进行优化，这些句子都是关于同一主题的。我怀疑你自己想出一个基于规则的系统会更好，也许基于[匹兹堡大学提供](http://www.cs.pitt.edu/mpqa/)的情感术语词典。

查看[We Feel Fine](http://www.wefeelfine.org/)以获得具有非常漂亮的界面（和[twitrratr](http://twitrratr.com/)）的类似想法的实现。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-07-13T09:23:02.027

看看[Twitter 情绪分析工具](http://smm.streamcrab.com)。它是用 python 编写的，它使用带有半监督机器学习的朴素贝叶斯分类器。来源可以在[这里](https://github.com/cyhex/smm)找到。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-21T21:53:04.917

不久前我遇到了[自然语言工具包](http://www.nltk.org/)。您可能可以将其用作起点。它也有很多模块和插件，所以也许他们已经有类似的东西了。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-08-13T07:59:44.000

也许[TextBlob](http://textblob.readthedocs.org/en/dev/)（基于 NLTK 和模式）是适合您的情感分析工具。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-16T06:22:40.497

有点古怪的想法：您可以尝试使用 Twitter API 下载大量推文，然后使用表情符号对该集合的子集进行分类：“:)”、“:]”、“:D”等的一个积极组，以及另一个带有“:(”等的否定组。

一旦你有了粗略的分类，你就可以通过频率或 ngram 分析或类似的东西来搜索更多线索。

这可能看起来很愚蠢，但已经对此进行了认真的研究（搜索“情绪分析”和表情符号）。值得一看。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-03-13T02:07:45.493

TweetFeel 有一个 Twitter Sentiment API，可以对推文进行高级语言分析，并可以检索正面/负面推文。见[http://www.webservius.com/corp/docs/tweetfeel_sentiment.htm](http://www.webservius.com/corp/docs/tweetfeel_sentiment.htm)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-03-17T11:12:32.527

对于那些对从头开始编写 Twitter Sentiment Analyis 代码感兴趣的人，GitHub 上有一个带有 Python 代码的 Coursera 课程“[数据科学](https://www.coursera.org/course/datasci)”（作为作业 1 -[链接](https://github.com/uwescience/datasci_course_materials/tree/master/assignment1)的一部分）。情绪是[AFINN-111](https://github.com/uwescience/datasci_course_materials/blob/master/assignment1/AFINN-README.txt)的一部分。

您可以找到有效的解决方案，例如[在这里](https://github.com/calvdee/coursera-data-sci/tree/master/assignment1)。除了 AFINN-111 情绪列表之外，还有一个基于具有 pos/neg 分数的推文中的术语频率构建动态术语列表的简单实现（参见[此处](https://github.com/calvdee/coursera-data-sci/blob/master/assignment1/term_sentiment.py)）。

# objective-c - iPhone中真正的模态UIAlertView？

> ID：573773
> 
> 赞同：5
> 
> 时间：2009-02-21T21:22:17.487
> 
> 标签：objective-c, iphone, cocoa-touch, user-interface

我需要根据用户的决定运行一些验证（例如，如果批准购买超出支出限额），如果失败则拒绝“完成”操作。

但是，看起来不可能像其他语言（如 showmessage、alert() 等）那样具有真正的模态操作，并且一切都由代表完成。

但后来我不知道该怎么办。如果用户按下“完成”按钮，程序会询问“你确定吗？” 他说“取消”流程继续，视图被推后！

可可世界如何解决这个问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-21T21:33:22.980

解决方案*不是与之抗争*，只需将您的逻辑分成两部分。如果用户单击取消，则不执行第二部分。如果用户单击确定/继续，则执行第二部分。

阻塞主线程导致的主要问题是主线程是处理事件的。处理事件的经典方式可能会引入奇怪的事件处理错误，因为您没有一个事件循环，而是将多个事件循环嵌入到另一个事件循环中。

通过使用委托，您可以利用一个事件循环（通过 UIApplicationMain 调用），而不会出现任何这些事件处理异常。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-02-11T22:10:14.820

查看： [http ://code.google.com/p/modal-uialertview-uiactionsheet/](http://code.google.com/p/modal-uialertview-uiactionsheet/)

有了它，您可以执行以下操作：

```
UIActionSheet *actionSheet = [[UIActionSheet alloc] initWithTitle:nil delegate:nil cancelButtonTitle:@"Cancel" destructiveButtonTitle:@"Delete" otherButtonTitles:nil];
if ([actionSheet showModalInView:self.view] == actionSheet.destructiveButtonIndex) {
    UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:nil message:@"Do you want to delete this file?" delegate:nil cancelButtonTitle:@"No" otherButtonTitles:@"Yes", nil];
    if ([alertView showModal]!= alertView.cancelButtonIndex) {
        // Delete the file
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-11T18:26:22.310

将应用程序的状态保存在函数中的变量以外的其他位置。例如，在我的一个应用程序中，有一个配置文件字符串说明他们是否同意隐私政策。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-26T17:24:46.653

我只是作为 MonoTouch 问题遇到了这个问题，并且在研究解决方案时遇到了这个未解决的问题。

简短的回答是，是的，这是可能的。以下示例展示了如何在 iPhone 上使用 MonoTouch 和 C# 完成此操作，但同样的原则也适用于 Objective-C。

为此，您可以手动运行主循环。我没有设法直接停止主循环，所以我改为运行主循环 0.5 秒并等待用户响应。

以下函数显示了如何使用上述方法实现模态查询：

```
int WaitForClick ()
{
    int clicked = -1;
    var x = new UIAlertView ("Title", "Message",  null, "Cancel", "OK", "Perhaps");
    x.Show ();
    bool done = false;
    x.Clicked += (sender, buttonArgs) => {
        Console.WriteLine ("User clicked on {0}", buttonArgs.ButtonIndex);
    clicked = buttonArgs.ButtonIndex;
    };    
    while (clicked == -1){
        NSRunLoop.Current.RunUntil (NSDate.FromTimeIntervalSinceNow (0.5));
        Console.WriteLine ("Waiting for another 0.5 seconds");
    }

    Console.WriteLine ("The user clicked {0}", clicked);
    return clicked;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-20T18:38:46.950

我同意 NilObject 的观点，即您通常不应该与之抗争，而且通常我不会。但是我使用的是 AddressBookUI 框架，当我使用委托方法时，

```
- (BOOL)unknownPersonViewController:(ABUnknownPersonViewController *)personViewController shouldPerformDefaultActionForPerson:(ABRecordRef)person property:(ABPropertyID)property identifier:(ABMultiValueIdentifier)identifier 
```

我真的很想警告用户，例如，当他们单击地址时，他们将离开应用程序，这会触发地图应用程序。我已经使用 MapKit 来制作我自己的地图，但我没有耐心重现完整的地图应用程序（让用户从其他地址获取路线），并且只好让它`shouldPerformDefaultAction`完成它的工作并启动地图应用程序，但我无法警告用户他们将离开该应用程序。

我真的希望 Apple 能够提供一个非常基本的模型 UIAlertView 而不是围绕它进行黑客攻击。这很愚蠢。

# java - Smack api 和 Java

> ID：573778
> 
> 赞同：0
> 
> 时间：2009-02-21T21:27:23.353
> 
> 标签：java, chat, xmpp, tapestry, smack

我正在使用 Tapestry 5，Smack api 3.1.0。

我已经建立了一个连接，并且能够通过 xmpp 服务器与用户进行通信，但是我得到的回复在它们进入时被发送到标准输出：

```
Chat chat = connection.getChatManager().createChat("blah@jabber.org", new MessageListener() {
    public void processMessage(Chat chat, Message message) {
        // Print out any messages we get back to standard out.
        System.out.println("Received message: " + message.getBody());                   // this works

        showonbrowser = message.getBody();                                                   
        System.out.println(showonbrowser) // this prints nothing
    }
}; 
```

我正在寻找对我的 html 文件的回复，以便我可以在 Web 而不是控制台上阅读它们。但是，当我尝试将 message.getBody() 设置为 showonbrowser （页面上的一个属性）时，我看不到任何结果。有谁知道我如何解决这个问题？

问候，

凯斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-30T23:09:35.750

Smack 是多线程的，它有一个讨厌的习惯，就是吃掉抛出的异常（默默地）。很可能你没有使用线程安全的 GUI，它会抛出一个你永远不会得到的异常。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T21:01:48.917

我认为在呈现页面*后*`processMessage`调用该方法。

 *您正在创建一个 MessageListener 实例（通过匿名类），因此您不知道何时会调用 processMessage 方法。我认为您必须使用 AJAX 来在页面上进行部分更新，轮询服务器并获取任何新消息以在页面上显示它们。

# asp.net - ASP.NET/静态类竞争条件？

> ID：573791
> 
> 赞同：1
> 
> 时间：2009-02-21T21:42:30.387
> 
> 标签：asp.net, static, race-condition, static-members

我有一个包含大量动态内容的 ASP.NET 应用程序。属于特定客户端的所有用户的内容都是相同的。为了减少每个请求所需的数据库命中次数，我决定缓存客户端级数据。我创建了一个静态类（“ClientCache”）来保存数据。
迄今为止，该类最常用的方法是“GetClientData”，它返回一个 ClientData 对象，其中包含特定客户端的所有存储数据。但是，ClientData 是延迟加载的：如果请求的客户端数据已经缓存，则调用者获取缓存的数据；否则，获取数据，添加到缓存中，然后返回给调用者。

最终，我开始在将 ClientData 对象添加到缓存的行的 GetClientData 方法中出现间歇性崩溃。这是方法体：

```
public static ClientData GetClientData(Guid fk_client)
{
    if (_clients == null)
        _clients = new Dictionary<Guid, ClientData>();

    ClientData client;
    if (_clients.ContainsKey(fk_client))
    {
        client = _clients[fk_client];
    }
    else
    {
        client = new ClientData(fk_client);
        _clients.Add(fk_client, client);
    }
    return client;
} 
```

异常文本总是类似于“已存在具有相同键的对象”。当然，我尝试编写代码，以便如果客户端已经存在，则无法将其添加到缓存中。

在这一点上，我怀疑我有一个竞争条件并且该方法同时执行了两次，这可以解释代码是如何崩溃的。但是，我感到困惑的是，该方法如何可以同时执行两次。据我所知，任何 ASP.NET 应用程序一次只能处理一个请求（这就是我们可以使用 HttpContext.Current 的原因）。

那么，这个错误是否可能是一个需要在关键部分加锁的竞争条件？还是我错过了一个更明显的错误？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T21:53:33.010

如果一个 ASP.NET 应用程序一次只处理一个请求，那么所有 ASP.NET 站点都会遇到严重的问题。ASP.NET 一次可以处理数十个（通常每个 CPU 内核 25 个）。

您应该使用 ASP.NET 缓存而不是使用您自己的字典来存储您的对象。对缓存的操作是线程安全的。

请注意，您需要确保对存储在缓存中的对象的读取操作是线程安全的，不幸的是，大多数 .NET 类只是声明实例成员不是线程安全的，而没有尝试指出任何可能是线程安全的。

**编辑**：

对此答案的评论指出：-

> 只有缓存上的原子操作是线程安全的。如果您执行诸如检查
> 密钥是否存在然后添加它之类的操作，这不是线程安全的，并且可能导致该项目
> 被覆盖。

值得指出的是，如果我们觉得我们需要使这样的操作原子化，那么缓存可能不是资源的正确位置。

我有相当多的代码完全按照评论的描述。但是，在这两个地方存储的资源将是相同的。因此，如果一个现有项目在极少数情况下被覆盖，唯一的代价是一个线程不必要地生成了一个资源。这种罕见事件的成本远低于每次尝试访问它时尝试使操作原子化的成本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T01:10:25.567

这很容易解决：

```
private _clientsLock = new Object();

public static ClientData GetClientData(Guid fk_client)
{
  if (_clients == null)
    lock (_clientsLock)
      // Check again because another thread could have created a new 
      // dictionary in-between the lock and this check
      if (_clients == null) 
        _clients = new Dictionary<Guid, ClientData>();

  if (_clients.ContainsKey(fk_client))
    // Don't need a lock here UNLESS there are also deletes. If there are
    // deletes, then a lock like the one below (in the else) is necessary
    return _clients[fk_client];
  else
  {
    ClientData client = new ClientData(fk_client);

    lock (_clientsLock)
      // Again, check again because another thread could have added this
      // this ClientData between the last ContainsKey check and this add
      if (!clients.ContainsKey(fk_client))
       _clients.Add(fk_client, client);

    return client;
  }
} 
```

请记住，每当您使用静态类时，都可能出现线程同步问题。如果有某种类型的静态类级列表（在这种情况下，_clients，`Dictionary`对象），*肯定*会有线程同步问题需要处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T22:02:34.550

您的代码确实假设一次只有一个线程在函数中。

这在 ASP.NET 中根本就不是真的

如果您坚持这样做，请使用静态信号量来锁定此类周围的区域。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-19T02:48:22.460

你需要线程安全和最小化锁。
请参阅双重检查锁定（[http://en.wikipedia.org/wiki/Double-checked_locking](http://en.wikipedia.org/wiki/Double-checked_locking)）

简单地用 TryGetValue 编写。

```
 public static object lockClientsSingleton = new object();

public static ClientData GetClientData(Guid fk_client)
{
    if (_clients == null) {
        lock( lockClientsSingleton ) {
            if( _clients==null ) {
                _clients = new Dictionary``();
            }
        }
    }
    ClientData client;
    if( !_clients.TryGetValue( fk_client, out client ) )
    {
        lock(_clients) 
        {
            if( !_clients.TryGetValue( fk_client, out client ) ) 
            {
                client = new ClientData(fk_client)
                _clients.Add( fk_client, client );
            }
        }
    }
    return client;
} 
```

# math - 帮我解决刚体物理/变换

> ID：573795
> 
> 赞同：3
> 
> 时间：2009-02-21T21:43:42.037
> 
> 标签：math, physics, quaternions

我想实例化一个滑块约束，它允许一个物体在 A 点和 B 点之间滑动。为了实例化约束，我将两个物体分配给约束，在这种情况下，一个动态物体被约束到静态世界，想想滑动门. 第三个和第四个参数是变换，*参考帧 A*和*参考帧 B*。为了创建和操作变换，该库支持四元数、矩阵和欧拉角。

默认滑块约束沿 x 轴滑动主体。我的问题是： **我如何设置这两个变换，以便身体 B 沿着由它自己的原点和空间中的一个附加点给出的轴滑动？**

我天真地尝试过：

```
frameA.setOrigin(origin_of_point); //since the world itself has origin (0,0,0)
frameA.setRotation(Quaternion(directionToB, 0 rotation));

frameB.setOrigin(0,0,0); //axis goes through origin of object
frameB.setRotation(Quaternion(directionToPoint,0)) 
```

然而，四元数似乎并没有像我预期的那样工作。我对它们的数学知识不好，所以如果有人能告诉我为什么这不起作用，我将不胜感激。发生的情况是身体沿着与方向正交的轴滑动。当我在四元数构造函数中改变旋转部分时，主体围绕该滑动方向旋转。

**编辑：** 框架是子弹物理。这两个转换是滑块关节如何相对于每个身体的局部坐标系附加在每个身体上。

**Edit2** 我还可以通过正交基设置变换的旋转部分，但是我必须可靠地从单个向量构造正交基。我希望四元数能阻止这种情况。

**Edit3** 我在以下过程中取得了一些有限的成功：

```
btTransform trafoA, trafoB;
trafoA.setIdentity();
trafoB.setIdentity();

vec3 bodyorigin(entA->getTrafo().col_t);
vec3 thisorigin(trafo.col_t);
vec3 dir=bodyorigin-thisorigin;
dir.Normalize();

mat4x4 dg=dgGrammSchmidt(dir);
mat4x4 dg2=dgGrammSchmidt(-dir);

btMatrix3x3 m(
    dg.col_x.x, dg.col_y.x, dg.col_z.x,
    dg.col_x.y, dg.col_y.y, dg.col_z.y,
    dg.col_x.z, dg.col_y.z, dg.col_z.z);
btMatrix3x3 m2(
    dg2.col_x.x, dg2.col_y.x, dg2.col_z.x,
    dg2.col_x.y, dg2.col_y.y, dg2.col_z.y,
    dg2.col_x.z, dg2.col_y.z, dg2.col_z.z);

trafoA.setBasis(m);
trafoB.setBasis(m2);

trafoA.setOrigin(btVector3(trafo.col_t.x,trafo.col_t.y,trafo.col_t.z));
btSliderConstraint* sc=new btSliderConstraint(*game.worldBody, *entA->getBody(), trafoA, trafoB, true); 
```

但是，GramSchmidt 总是翻转 trafoB 矩阵的某些轴，并且门出现颠倒或从右到左。我希望有一种更优雅的方式来解决这个问题。 **Edit4** 我找到了一个解决方案，但是如果顶部向量与滑动方向对齐，我不确定这是否会导致约束求解器出现奇点：

```
btTransform rbat = rba->getCenterOfMassTransform();
btVector3 up(rbat.getBasis()[0][0], rbat.getBasis()[1][0], rbat.getBasis()[2][0]);
btVector3 direction = (rbb->getWorldTransform().getOrigin() - btVector3(trafo.col_t.x, trafo.col_t.y, trafo.col_t.z)).normalize();

btScalar angle = acos(up.dot(direction));
btVector3 axis = up.cross(direction);
trafoA.setRotation(btQuaternion(axis, angle));
trafoB.setRotation(btQuaternion(axis, angle));
trafoA.setOrigin(btVector3(trafo.col_t.x,trafo.col_t.y,trafo.col_t.z)); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T20:12:06.010

有没有可能你把这种方式弄得太复杂了？听起来像一个简单的参数转换 ( `x = p*A+(1-p)*B`) 就可以了。如果你的推拉门类比是准确的，那么整个旋转/方向的事情就是一个红鲱鱼。

另一方面，如果您试图限制两个方向之间的插值，则需要设置额外的限制，因为在一般情况下没有唯一的解决方案。

——马库斯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T21:56:38.510

如果您能说出您正在使用什么框架或 API，或者复制并粘贴您正在调用的函数的文档，将会有所帮助。如果没有那种细节，我只能猜测：

背景：四元数表示结合比例的 3 维旋转。（通常您不希望管理比例的复杂性，因此您只使用表示旋转的单位四元数。）矩阵和欧拉角是表示旋转的两种替代方式。

参考系是一个位置加上一个旋转。想象一个物体放置在空间中的某个位置，然后旋转以面向特定方向。

所以 A 帧可能需要是对象的初始位置和旋转（当滑块在一端时），而 B 帧是对象的最终位置和旋转（当滑块在另一端时）。特别是，这两个旋转可能应该是相同的，因为您希望对象刚性滑动。

但正如我所说，这只是一个猜测。

更新：这是[子弹物理](http://code.google.com/p/bullet/)吗？它似乎没有太多的文档方式，是吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T21:57:26.403

也许您正在寻找[slerp](http://en.wikipedia.org/wiki/Slerp)？

> Slerp 是球面线性插值的简写，由 Ken Shoemake 在四元数插值的上下文中引入，用于动画 3D 旋转。它是指在给定端点和介于 0 和 1 之间的插值参数的情况下，沿单位半径大圆弧进行等速运动。

归根结底，您仍然需要传统的旋转矩阵来旋转物体。

**编辑**：所以，我还在猜测，但我假设框架负责 slerping 并且您想要描述开始状态和结束状态的两个转换？

您可以将仿射变换堆叠在另一个之上。除非你必须反省。例如，假设滑动门在开始状态下放置在 (1, 1, 1) 朝东，您想将其向北滑动 (0, 1, 0)。门将在 (1, 1, 1) + (0, 1, 0) 结束。

对于开始状态，将门向东旋转。然后最重要的是，您应用另一个平移矩阵将门移动到 (1, 1, 1)。对于最终状态，再次将门向东旋转，然后通过再次应用平移矩阵将门移动到 (1, 1, 1)。接下来，应用平移矩阵 (0, 1, 0)。

# eclipse - 在编写 Eclipse 插件时，检查 IEditorPart 是否为 Java 编辑器的正确方法是什么？

> ID：573804
> 
> 赞同：2
> 
> 时间：2009-02-21T21:53:00.080
> 
> 标签：eclipse, eclipse-jdt

我正在为 Java 编写 Eclipse 插件，并且遇到以下问题：

给定一个 IEditorPart，我需要检查它是否是一个 java 编辑器。

我可以这样做（IEditor instanceof JavaEditor），但 JavaEditor 是一个 org.eclipse.jdt.internal.ui.javaeditor.JavaEditor，它属于 JDT 的“内部”类。

有没有更聪明、更安全的方法来做到这一点？我不确定为什么没有非内部接口。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T22:12:05.230

您应该测试 IEditorPart 的 id：

```
private boolean isJavaEditor(IWorkbenchPartReference ref) {
    if (ref == null) {
        return false; }

    String JavaDoc id= ref.getId();
    return JavaUI.ID_CF_EDITOR.equals(id) || JavaUI.ID_CU_EDITOR.equals(id);
} 
```

[仅在 eclipse3.1](https://bugs.eclipse.org/bugs/show_bug.cgi?id=84862)中需要测试实例。

[替代文字 http://blogs.zdnet.com/images/Burnette_DSCN0599.JPG](http://blogs.zdnet.com/images/Burnette_DSCN0599.JPG)

[`JavaUI`](https://bugs.eclipse.org/bugs/show_bug.cgi?id=84862)是 Java 用户界面组件的主要访问点。它允许您以编程方式打开 Java 元素上的编辑器、打开 Java 或 Java 浏览透视图以及打开包和类型提示对话框。

[`JavaUI`](http://help.eclipse.org/ganymede/topic/org.eclipse.jdt.doc.isv/reference/api/org/eclipse/jdt/ui/JavaUI.html)是 Java UI 插件的中央访问点 (id " `org.eclipse.jdt.ui`")

您可以看到`isJavaEditor()`例如在[`ASTProvider`](http://kickjava.com/src/org/eclipse/jdt/internal/ui/javaeditor/ASTProvider.java.htm).

这里的识别机制确实是简单的String比较。

无论如何，避免与内部类进行强制比较是明智的：它已被列为[插件开发中的 10 个常见错误之一](http://blog.eclipse-tips.com/2009/01/top-10-mistakes-in-eclipse-plug-in.html)；）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T18:18:58.193

一种策略可能是使用[JavaUI.getEditorInputJavaElement(IEditorPart)](http://help.eclipse.org/help32/topic/org.eclipse.jdt.doc.isv/reference/api/org/eclipse/jdt/ui/JavaUI.html#getEditorInputJavaElement(org.eclipse.ui.IEditorInput))：

```
// given IEditorPart editor
IJavaElement elt = JavaUI.getEditorInputJavaElement(editor.getEditorInput());
if (elt != null) {
    // editor is a Java editor
} 
```

`null`如果编辑器输入实际上不是 Java 元素，则该方法返回。

# php - WAMP - 离线时在线？

> ID：573808
> 
> 赞同：0
> 
> 时间：2009-02-21T21:54:20.577
> 
> 标签：php, wamp

如果我在本地网络上，是否有可以输入的 URL 允许本地网络上的所有用户查看本地托管网站？

有一项功能称为在线，但我需要连接到互联网。可以用另一种方式完成吗？

我知道这个问题是题外话，但我在这里得到了快速的答复。及其某种相关的:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T23:29:50.347

您可以使用本地 IP 或网络上的主机名。

要使主机名正常工作，您的网络需要一个从 DHCP 更新自身的 DNS 服务器，或者为您的计算机提供一个静态条目，或者所有系统都需要运行 NetBEUI。如果您可以在命令提示符/控制台窗口中键入“ping”，并显示它正在 ping 您的网络 IP，那么它可以工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T21:57:55.107

他们必须输入你的 ip

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T21:58:56.023

您可以使用本地网络 IP 地址来寻址您的机器。但是您必须配置您的网络服务器以在没有特定主机名的情况下提供正确的内容。

# c# - 使用 SendMessage 从闪烁控件中检索文本

> ID：573814
> 
> 赞同：2
> 
> 时间：2009-02-21T22:01:52.693
> 
> 标签：c#, sendmessage, scintilla

我正在尝试使用 C# 中的 SendMessage 在 Notepad++ 中检索文档文本。以下是我当前的代码。对 SendMessage 的第一次调用正确地返回了文本的长度。第二次调用 SendMessage 不会将文本插入到 StringBuilder 变量文本中。为什么不？

```
 [DllImport("user32.dll", EntryPoint = "SendMessage", CharSet = CharSet.Auto)]
    static extern int SendMessage(IntPtr hWnd, int msg, int wParam, int lParam);

    [DllImport("user32.dll", EntryPoint = "SendMessage", CharSet = CharSet.Auto)]
    static extern int SendMessage(IntPtr hWnd, int msg, int wParam, StringBuilder lParam);

    var length = SendMessage(hWnd, 2183, 0,0);
    var text = new StringBuilder(length +1);
    SendMessage(hWnd, 2182, length + 1, text); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-21T22:57:46.507

问题是您向 Scintilla 控件发送消息，该控件在 lParam 中具有 StringBuilder 缓冲区的地址，但 Notepad++ 中的 Scintilla 控件位于不同的地址空间中，因此无法写入它接收到的窗口消息中的地址到。*WM_GETTEXT*和*WM_SETTEXT*等标准消息的处理方式是为您执行必要的地址映射，但对于 Scintilla 控件使用的特殊消息则不会发生这种情况。有关更多信息查找编组。

不幸的是，对*WM_GETTEXTLENGTH*和*WM_GETTEXT*的支持正在逐步退出 Scintilla 控件，并且文档建议使用特殊的*SCI_XXX*消息。Notepad++ 已经不能与*WM_GETTEXT*一起使用，因此您需要使用*SCI_GETTEXTLENGTH* (2183) 和*SCI_GETTEXT* (2182)，并自己进行编组。

**警告：**从另一个应用程序发送 SCI_GETTEXT 消息实际上是危险的，而不对缓冲区地址进行特殊处理 - Notepad++ 会将数据复制到缓冲区，但由于地址在其自己的地址空间中无效，这可能会立即导致访问冲突，或者（更糟糕的）它可以默默地覆盖内部数据。

* * *

您可以使用 VirtualAllocEx() 和 ReadProcessMemory() 来使用带有 Notepad++ 可用地址的缓冲区。我已经整理了一个适合我的快速 Delphi 程序，重要的代码是这样的：

```
procedure TForm1.Button1Click(Sender: TObject);
const
  VMFLAGS = PROCESS_VM_OPERATION or PROCESS_VM_READ or PROCESS_VM_WRITE;
var
  Wnd: HWND;
  Len: integer;
  ProcessId, BytesRead: Cardinal;
  ProcessHandle: THandle;
  MemPtr: PChar;
  s: string;
begin
  Wnd := $30488;
  Len := SendMessage(Wnd, 2183, 0, 0);
  if Len > 0 then begin
    GetWindowThreadProcessId(Wnd, @ProcessId);
    ProcessHandle := OpenProcess(VMFLAGS, FALSE, ProcessId);
    MemPtr := VirtualAllocEx(ProcessHandle, nil, Len + 1,
      MEM_RESERVE or MEM_COMMIT, PAGE_READWRITE);
    if MemPtr <> nil then try
      SendMessage(Wnd, 2182, Len + 1, integer(MemPtr));
      SetLength(s, Len + 1);
      ReadProcessMemory(ProcessHandle, MemPtr, @s[1], Len + 1, BytesRead);
      SetLength(s, BytesRead);
      Memo1.Lines.Text := s;
    finally
      VirtualFreeEx(ProcessId, MemPtr, Len + 1, MEM_RELEASE);
    end;
  end;
end; 
```

这是使用 API 函数的 Ansi 版本的早期 Delphi 版本，您可能会使用 SendMessageW 和 WideChar 缓冲区，但总体思路应该很清楚。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-12-29T18:26:53.893

经过一番摆弄后，我得到了它的工作。

在 VirtualFreeEx 中使用`MEM_RELEASE`时，我认为 size 必须是`0`，否则函数会返回`false`。

# windows - 环境变量存储在 Windows 注册表中的什么位置？

> ID：573817
> 
> 赞同：203
> 
> 时间：2009-02-21T22:06:25.540
> 
> 标签：windows, environment-variables, registry

我需要远程访问环境变量。为此，我认为最好的方法是从注册表中读取它。

环境变量存储在 Windows 注册表中的什么位置？

* * *

## 回答 #1

> 赞同：296
> 
> 时间：2009-02-21T22:08:36.983

以下是它们通过[Windows Server 2012](https://en.wikipedia.org/wiki/Windows_Server_2012) R2在[Windows XP上的存储位置：](https://en.wikipedia.org/wiki/Windows_XP)

### 用户变量

```
HKEY_CURRENT_USER\Environment 
```

### 系统变量

```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2013-11-26T05:27:02.193

在 Windows 7 中有一种更有效的方法。SETX 默认安装并支持连接到其他系统。

要修改远程系统的全局环境变量，您可以使用

```
setx /m /s HOSTNAME-GOES-HERE VariableNameGoesHere VariableValueGoesHere 
```

这不需要重新启动 Windows 资源管理器。

> /M 指定应在系统范围 (HKEY_LOCAL_MACHINE) 环境中设置变量。默认是在 HKEY_CURRENT_USER 环境下设置变量。

> /S system 指定要连接的远程系统。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2018-01-30T19:37:45.497

命令：

```
reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment"
reg query HKEY_CURRENT_USER\Environment 
```

电源外壳：

```
Get-Item "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment"
Get-Item HKCU:\Environment 
```

Powershell/.NET：（参见*[EnvironmentVariableTarget 枚举](https://docs.microsoft.com/en-us/dotnet/api/system.environmentvariabletarget)*）

```
[System.Environment]::GetEnvironmentVariables([System.EnvironmentVariableTarget]::Machine)
[System.Environment]::GetEnvironmentVariables([System.EnvironmentVariableTarget]::User) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-01-03T21:10:40.610

我总是遇到问题，我制作了一个*getx.bat*脚本：

```
:: getx %envvar% [\m]
:: Reads envvar from user environment variable and stores it in the getxvalue variable
:: with \m read system environment

@SETLOCAL EnableDelayedExpansion
@echo OFF

@set l_regpath="HKEY_CURRENT_USER\Environment"
@if "\m"=="%2" set l_regpath="HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment"

::REG ADD "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" /v PATH /t REG_SZ /f /d "%PATH%"
::@REG QUERY %l_regpath% /v %1 /S

@FOR /F "tokens=*" %%A IN ('REG QUERY %l_regpath% /v %1 /S') DO (
@  set l_a=%%A
@    if NOT "!l_a!"=="!l_a:    =!" set l_line=!l_a!
)

:: Delimiter is four spaces. Change it to tab \t
@set l_line=!l_line!
@set l_line=%l_line:    =    %

@set getxvalue=

@FOR /F "tokens=3* delims=  " %%A IN ("%l_line%") DO (
@    set getxvalue=%%A
)
@set getxvalue=!getxvalue!
@echo %getxvalue% > getxfile.tmp.txt
@ENDLOCAL

:: We already used tab as a delimiter
@FOR /F "delims=    " %%A IN (getxfile.tmp.txt) DO (
    @set getxvalue=%%A
)
@del getxfile.tmp.txt

@echo ON 
```

# fluent-nhibernate - 来自 appSettings 的流利 NHibernate

> ID：573819
> 
> 赞同：3
> 
> 时间：2009-02-21T22:09:53.550
> 
> 标签：fluent-nhibernate

我想从 app.config 和 appSettingKey 配置我的 NHibernate Fluent。

是否有人可以解释文件 app.config 的外观？

```
MsSqlConfiguration.MsSql2005  
   .ConnectionString(c => c  
    .FromAppSetting("appSettingKey")); 
```

这是我的connectionsString

```
Data Source=(local);Initial Catalog=ABC;Integrated Security=True 
```

这不起作用：

```
<appSettingKey>"Data Source=.;Initial Catalog=ABC;Integrated Security=True"</appSettingKey> 
```

// 垫子，瑞典斯德哥尔摩

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-22T08:35:24.543

如果我对您的理解正确，您希望像在您的示例中那样配置 Fluent NHibernate 并使用 App.config 中的连接字符串。下面是我将如何实现这一目标的示例。

应用程序配置：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <appSettings>
    <add key="FluentNHibernateConnection"
      value="server=.;Initial Catalog=YourDB;Integrated Security=True" />
  </appSettings>
</configuration> 
```

创建会话工厂的代码：

```
private static ISessionFactory CreateSessionFactory()
{
    var fluentConfig = MsSqlConfiguration.MsSql2005
        .ConnectionString.FromAppSetting("FluentNHibernateConnection");

    PersistenceModel persistenceModel = new PersistenceModel();
    persistenceModel.addMappingsFromAssembly(typeof(User).Assembly);

    Configuration nhConfig = new Configuration()
        .AddProperties(fluentConfig.ToProperties());

    persistenceModel.Configure(nhConfig);

    return nhConfig.BuildSessionFactory();
} 
```

希望能帮助到你。

/埃里克（“斯德哥尔摩”同胞）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T13:32:08.807

阅读[Fluent NHibernate wiki](https://github.com/jagregory/fluent-nhibernate/wiki/)中的[数据库配置](https://github.com/jagregory/fluent-nhibernate/wiki/Database-configuration)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-15T16:04:13.167

```
Fluently.Configure()
                .Database(
                    MsSqlConfiguration.MsSql2008.ConnectionString(
                                c => c.FromConnectionStringWithKey(connectStringKey)
                            )//End ConnectionString
                        )//End Database
                .Mappings(m =>m.FluentMappings.AddFromAssemblyOf<ADomainClassType>())
                .BuildSessionFactory(); 
```

这就是我构建会话工厂的方式。

# ruby-on-rails - Rails 应用程序的托管电子邮件

> ID：573823
> 
> 赞同：3
> 
> 时间：2009-02-21T22:17:20.113
> 
> 标签：ruby-on-rails, ruby, email

我正在寻找 Google Apps 的替代方案，用于从我的 rails 应用程序发送电子邮件。（Google 限制了您可以发送的消息数量）。

大多数人自己滚动，还是他们的首选提供商？

我希望能够为我的客户动态创建地址：customer_name@myapp.com

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-21T22:20:05.757

我们使用 AuthSMTP，它可以在您被报告为垃圾邮件时通知您，并让您远离阻止列表。

它的成本，但非常合理。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-13T13:50:58.697

只是为了更新，看起来新的热点是[SendGrid](http://sendgrid.com/)。看看您是否在市场上为您的 rails 应用程序托管电子邮件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-22T21:57:43.930

如果您在 Linux 服务器上托管，并且只是在寻找可以从您的 rails 应用程序发送电子邮件的东西，那么滚动您自己的 SMTP 服务器真的不是火箭科学。您会找到大量关于如何在您选择的 Linux 发行版上部署 SMTP 服务器的手册。

[Postfix](http://www.postfix.org/)将成为事实上的标准，而[Qmail](http://cr.yp.to/qmail.html)是我个人选择的安全性、可靠性和速度方面的武器。

如果您想为您的客户提供用于接收电子邮件的邮箱（POP 和/或 IMAP），部署您自己的服务器也不是什么火箭科学，但是该服务器的管理和客户的支持电话可能会成为痛。:-) 在这种情况下，我会选择 Google Apps。50 美元/年/客户[的商业选项](http://www.google.com/apps/intl/en/business/details.html)可能是您的企业客户的选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-16T18:22:13.930

我在生产中使用带有 Rails 和 Linux 的 Postfix 取得了很好的成功。一旦网站变得非常小，为每封电子邮件连接到 Google Apps 就变得不切实际（每隔几百封电子邮件就会以某种方式失败或超时）。对于向所有用户发送群发邮件，这是非常不切实际的。

在 SliceHost 的页面 [http://articles.slicehost.com/2008/9/2/mail-server-overview上有一系列很好的文章来设置后缀](http://articles.slicehost.com/2008/9/2/mail-server-overview)

# javascript - IE覆盖window.top

> ID：573824
> 
> 赞同：2
> 
> 时间：2009-02-21T22:17:29.723
> 
> 标签：javascript, internet-explorer, dom

我试图让一个页面相信它是 window.top，即使它在 iframe 中。

在FF你可以做

窗户。**defineGetter** ('top', function() { return window});

在 Webkit (Safari/Chrome) 中你可以简单地做

window.top = 窗口

但在 IE 中，这些方法都不起作用。以前有人做过吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-19T23:07:39.487

我可能会尝试使用 John Resig 在他[关于该主题的文章中](http://ejohn.org/blog/javascript-getters-and-setters/)使用的“定义吸气剂”表示法：

`Window.prototype.__defineGetter__('top',function(){return this;});`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T23:13:46.330

尝试`window.top = window.top.window`

[有关DOM 窗口](http://w3schools.com/htmldom/dom_obj_window.asp)的更多详细信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T16:46:28.093

设置 window.top 不起作用。它在 IE 中是不允许的。

我最终不得不制作自己的假窗口对象，用窗口对象的大部分属性填充它，然后制作一个假的 .top 属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-10-20T10:22:47.330

用这个：

```
Object.defineProperty(window, "parent", { 
        get: function() {return window;} 
    }
); 
```

更多信息[在这里](https://developer.mozilla.org/pl/docs/Web/JavaScript/Reference/Global_Objects/Object/__defineGetter__)。

# algorithm - 如何培养算法直觉？

> ID：573825
> 
> 赞同：20
> 
> 时间：2009-02-21T22:18:11.050
> 
> 标签：algorithm

当遇到软件问题时，我通常会立即看到解决方案。当然，我看到的东西通常有些偏离，我总是需要坐下来设计（诚然，我通常设计的不够多），但我马上就有了一定的***直觉。***

我的问题是在高级算法方面我没有同样的直觉。我觉得自己更能胜任建立另一个[Facebook](http://www.facebook.com)的任务，然后再建立另一个[Google](http://www.google.com)搜索或[Music Genom 项目](http://www.pandora.com/mgp.shtml)。这可能是因为我已经*构建*软件有一段时间了，但是我对*编写*算法的经验很少。

**我希望社区对阅读什么内容以及开展哪些项目以更好地编写算法提出建议。**

（这个问题与[算法作文](http://en.wikipedia.org/wiki/Algorithmic_composition)无关。嗯，几乎没有）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-21T23:56:05.087

+1 对于说经验是最好的老师的人。

有几个在线门户网站有很多编程问题，您可以提交自己的解决方案，并获得自动通过/失败指示。

1.  [http://www.spoj.pl/](http://www.spoj.pl/)
2.  [http://uva.onlinejudge.org/](http://uva.onlinejudge.org/)
3.  [http://www.topcoder.com/tc](http://www.topcoder.com/tc)
4.  [http://code.google.com/codejam/contests.html](http://code.google.com/codejam/contests.html)
5.  [http://projecteuler.net/](http://projecteuler.net/)
6.  [https://codeforces.com](https://codeforces.com)
7.  [https://leetcode.com](https://leetcode.com)

[USACO 培训网站](http://train.usaco.org/usacogate)是所有美国计算奥赛参赛者都要经过的培训项目。它一步一步地进行，随着你的进展引入越来越复杂的算法。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-21T23:47:33.470

您可能会发现以物理方式执行算法很有帮助。例如，当你学习排序算法时，练习用一副纸牌做每一个算法。这将激活你大脑的不同部分，而不是单独阅读或编程。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-21T22:25:45.697

Steve Yegge在他的[一篇](http://steve-yegge.blogspot.com/2008/03/get-that-job-at-google.html)咆哮中提到了[“算法设计手册” 。](https://rads.stackoverflow.com/amzn/click/com/0387948600)我自己没见过，但听起来这只是他描述的票。

> 对于这种面试准备，我最喜欢的是 Steven Skiena 的算法设计手册。它比任何其他书更能帮助我理解图问题是多么普遍（和重要）——它们应该成为每个工作程序员工具包的一部分。这本书还涵盖了基本的数据结构和排序算法，这是一个不错的奖励。但是金矿是本书的后半部分，它是一本关于无数有用问题和解决这些问题的各种方法的一页百科全书，没有太多细节。几乎每个 1-pager 都有一张简单的图片，很容易记住。这是学习如何识别数百种问题类型的好方法。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-21T23:09:20.973

# 问题域

首先，您必须了解问题域。对错误问题的优雅解决方案是不好的，在大多数情况下，对正确问题的低效解决方案也不是好事。换句话说，解决方案的质量通常是相对的。如果计划每周重新计算一次，一个简单的调度问题具有确定性解决方案，需要十分钟才能运行，这可能没问题，但如果计划每天更改几次，则可能需要在几秒钟内收敛的遗传算法解决方案。

# 分解和映射

其次，将问题分解为子问题和与解决方案元素相对应的已知/未知元素。有时这很明显，例如，要对小部件进行计数，您需要一种识别小部件的方法、一个可递增的计数器和一种存储计数的方法。有时它并不那么明显。有时你必须同时分解问题、领域和可能的解决方案，并在它们之间尝试几种不同的映射，以找到一个导致正确结果的映射[这是通用方法]。

# 模型

至少在您的脑海中为解决方案建模，然后遍历它以查看它是否正常工作。根据需要进行调整（参见上面的分解和映射）。

# 组合/接口

很多时候，您可以找到相互映射的问题元素和解决方案元素，并产生有用的部分结果。这种组合和界面构造提供了解决方案的核心，并且还用于减少剩余问题的范围。因此，您只需以较小的初始问题循环回到顶部，然后再次进行处理。

# 经验

当然，经验是最好的老师，但阅读不同类型的问题和解决方案也会有所帮助。研究一些著名的算法*及其应用*同样非常有帮助，例如[Dijkstra](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)、[Bresenham](http://en.wikipedia.org/wiki/Bresenham_line_algorithm)、[Unification](http://en.wikipedia.org/wiki/Unification)，当然还有[图论](http://en.wikipedia.org/wiki/Graph_Theory)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T00:00:06.390

我不确定直觉是否可以培养，但我想我知道你在问什么。您解决的问题越多，您对未来问题的处理信息和经验就越多。所以，我说只是练习。练习编程现实世界的应用程序，你会遇到很多问题。有时，解决难题也很有教育意义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T00:08:36.383

当我在看一个复杂的问题时，我试图找到物理上的类似物。

# java - Java：必须在 EDT 线程中初始化 GUI？

> ID：573826
> 
> 赞同：2
> 
> 时间：2009-02-21T22:18:33.137
> 
> 标签：java, multithreading, user-interface, swing, look-and-feel

我是杰森。[我对 Substance 的外观和感觉（ https://substance.dev.java.net/](https://substance.dev.java.net/) ）有点问题。

我的问题更普遍。我已经写好了我的 GUI，它工作得很好，但是当我使用 Substance Look-and-feel 时，它需要在 EDT 线程（事件调度线程或其他东西）中进行所有 GUI 初始化。

现在我正在使用 com.sun.java.swing.plaf.windows.WindowsLookAndFeel （不确定我是否拼写正确），它不需要任何这类东西。

所以我通过调用 SwingUtilities.invokeLater() 将主要初始化放入 EDT。这使它工作。但是，该程序在执行过程中还会生成其他几个窗口。现在我有这样的代码：

```
SomeNewWindow window = new SomeNewWindow();
// ... some bs emitted
window.doStuff(); 
```

这段代码运行良好，因为在调用 window.doStuff() 时，它已经被初始化了。但是 Substance 要求我做这样的事情：

```
SwingUtilities.invokeLater(new Runnable(){
public void run(){
SomeNewWindow window = new SomeNewWindow();
}});
// ... bs emitted
window.doStuff(); 
```

在这里它有时会抛出 NullPointerException，因为 window 没有在 window.doStuff() 被调用时初始化。我不能将 window.doStuff() 放入 EDT 线程，因为它通常需要几秒钟才能返回并且会挂起 GUI。

我已经尝试在调用 EDT 线程后立即放置 Thread.sleep(1000)，因为那时它可能已经初始化。但这似乎很尴尬。我只需要一种方法让主线程“知道” SomeNewWindow 初始化何时返回，这样它就可以继续运行而不必担心 NullPointerException。

提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-21T22:47:37.763

您可以从invokeLater 切换到invokeAndWait，它会一直等到创建窗口。这有点俗气，但没有睡觉那么糟糕。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T22:23:22.533

我认为解决这个问题的标准方法是让你的 EDT 成为你启动其他工作线程来做事情的“基础线程”。

另一种方法是使用`volatile`初始化程序在完成时可以设置的标志，以便其他线程可以在循环中检查它并在设置标志后对新窗口进行操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T22:30:57.600

Egwor 建议改用[CountDownLatch](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/CountDownLatch.html)。绝对看起来它会简化情况。

* * *

这是[条件变量](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/locks/Condition.html)的工作。

基本上，在 run() 中，锁定锁，构造一些新窗口并发出条件信号（并解锁锁）。“同时”，在另一个线程中，做你的另一个“bs”，锁定锁；如果窗口为空，则在条件变量上等待（）；解锁锁；窗口.doStuff();

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T19:40:24.850

是否有理由不能将 doStuff() 调用移动到 invokeLater 回调中？

```
SwingUtilities.invokeLater(new Runnable(){
    public void run(){
         SomeNewWindow window = new SomeNewWindow();
         window.doStuff();
    }
}); 
```

如果上述方法是不可能的，我会选择`invokeAndWait()`而不是`invokeLater()`，正如 Paul Tomblin 已经建议的那样。

# javascript - 为什么将所有 JavaScript 文件转储到一个巨大的文件中会改变它们的行为？

> ID：573833
> 
> 赞同：1
> 
> 时间：2009-02-21T22:25:03.200
> 
> 标签：javascript, jquery, jquery-ui

我拍摄了我使用的 jquery.js 文件和 jquery-ui 文件的快照，并将它们与我用于我的站点的所有其他 .js 文件一起转储到一个巨大的 .js 文件中。

当我在没有缩小/打包的情况下执行此操作时，文件停止工作，并且当我尝试将其加载到我的站点而不是通常的 .js 文件时，文件上出现“递归太深”错误。所有的错误都来自 jquery 和 jquery-ui。使用简单的编号方案，我确保 jquery.js/jquery-ui 文件是文件中第一个列出的并且顺序正确（与包含单个文件相同。）

两个问题： 1) JavaScript 的包含标签与将所有文件转储到一个大文件中的效果不一样吗？JavaScript 文件在它们自己的脚本标签或不同文件中是否有额外的隔离/绝缘？

2) 我的目标是通过一个巨大的 .js 文件来加快我的网站速度，其中包含我在我的网站中使用过的所有 JavaScript（在 JQuery 中很重）并缩小该文件。为什么这是误导？有什么更好的方法呢？

注意：Google 的 JQuery 文件的 CDN 版本对我不起作用，我使用的所有 JQuery 插件/主题都不适用于 Google 的版本（无论如何，谁说他们可以成功使用 Google 的 CDN 是在撒谎。）

更新：感谢答案中的好建议，所有这些都帮助我了解了有关在生产服务器上部署 JavaScript 文件的更多信息。我实际上一直在使用 JQuery UI 插件的最新 SVN 分支，并且 UI 插件中存在错误，导致它们无法与我的文件合并在一起。我得到了最新的 Theme Rolled 插件，这些插件已经在一个文件中缩小并且可以解决这个问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-21T23:22:17.277

可能您的 JavaScript 文件有一些语法错误。浏览器可以在一个一个加载文件时纠正它们，但当“坏”文件组合时会失败。您可以尝试使用 Rhino 编译器 ( [http://www.mozilla.org/rhino/](http://www.mozilla.org/rhino/) )编译您的文件

```
java -cp build/js.jar org.mozilla.javascript.tools.jsc.Main giant.js 
```

您也可以使用 JSLint 验证器 ( [http://www.jslint.com/](http://www.jslint.com/) )，认为它可能无法处理 jQuery。*但是您*仍然可以合并所有文件并验证它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T22:28:21.430

我建议使用像[这个](http://www.gfilter.net/?Post=JSManager.js---Easily-manage-JS-dependancies)这样的脚本管理器来只注册您需要的文件和插件，并即时加载它们。

这将您的请求保持在最低限度，并且您不必一页加载一些巨大的 300k JS 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T03:06:50.107

另一个问题可能是加载顺序发生了变化。大多数 JavaScript 文件应该是独立于加载顺序的，但如果你在最后加载 jquery 之后：

```
$(document).ready(function() {}); 
```

你会遇到问题。

# iphone - 黑暗中的一枪 - 应用程序错误

> ID：573837
> 
> 赞同：0
> 
> 时间：2009-02-21T22:28:41.100
> 
> 标签：iphone, objective-c, cocoa-touch, memory-management

好的，所以如果您看不到我的应用程序，这将有点像在黑暗中拍摄！

我有一个错误。我有一个 SwimmingPool 类，我的应用程序将池从 tableview 传递到详细视图中，您可以在其中看到所有 SwimmingPool 类字段。然后，您可以单击单个详细信息，对其进行编辑，然后保存。“原始”池设施被复制并传递给负责实际进行更改的视图控制器。如果用户按下保存，字段将从副本复制到“原始”

```
switch (self.sectionFromParentTable) {
    case KNameIndex:
        self.thePoolFacility.name = self.thePoolFacilityCopy.name;
        self.thePoolFacility.type = self.thePoolFacilityCopy.type;
        break;

    case KAddressIndex:
        self.thePoolFacility.address = self.thePoolFacilityCopy.address;
        break;

    case KPhoneNumberIndex:
        self.thePoolFacility.phoneNumber = self.thePoolFacilityCopy.phoneNumber;
        break;

    case KWebAddressIndex:
        self.thePoolFacility.webAddress = self.thePoolFacilityCopy.webAddress;          
        break;
    case KPricesIndex:
        self.thePoolFacility.prices = self.thePoolFacilityCopy.prices;
        break;
    case KPoolIndex:
        self.thePoolFacility.pools = self.thePoolFacilityCopy.pools;
    default:
        break;
}

[self.navigationController popViewControllerAnimated:YES]; 
```

我可以对执行以下操作的错误进行一些猜测：

1.  该错误导致未保存对类的字段所做的更改。特别是一个名为 TimeEntry 的类，在一个名为 Monday 的可变数组中，在一个名为 TermTimes 的字典中，在一个名为 pool 的类中，然后在一个名为 Pools 的可变数组中。

2.  它看起来很随机。有时它工作得很好。有时不会！我无法重新创建错误，只有当我很幸运才能让它不保存。我的预感是它可能是时间敏感的。例如，如果我正在输入游泳池开放时间的时间表，如果我快速添加一些条目并保存它通常可以正常工作。如果我填写整个时间表，那么它多半不会保存。

3.  该应用程序不会崩溃。

它激怒了尝试和调试似乎随机发生的错误。关于这种史诗般的错误搜索的任何提示？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T22:36:46.200

解决此类问题（似乎无法可靠地重现）的最佳方法之一是在您期望某些事情发生的各个区域插入日志记录代码。记录可能发生错误的位置，记录您期望的值以及您拥有的值等。接下来，尝试，尝试，尝试直到您可以重现错误。

与以前不同，您现在可以查看日志并查看哪里出了问题。如果一切看起来仍然正确，请在其他地方插入更多的日志记录代码。如果您发现有问题但不理解，请在该区域添加更多日志记录代码并不断缩小问题范围。

希望这将导致关于错误如何发生的新假设，并且您将能够在调试器下可靠地重现它并修复它！

正如 duffymo 所提到的，多线程可能是罪魁祸首，如果您有意使用多个线程，这将是一个很好的先调查场所。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T17:11:49.390

Thanks for all your answers. It's now fixed.

For those interested I'd forgotten to add a cellidentifer in the XIB of my cell subclass.

cellForRow: method was therefore creating a new cell every time. The memory got filled up very quick. It then seemed as though my app was automatically trying to cut the fat by forcing another tableView out of editing mode and not managing my instances properly.

Again it's a memory problem. Isn't this always the case!?!

The clue was a one off 101 error in the console indicating my app was using too much memory. Oh and a slow scrolling tableView.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T23:31:50.093

我的建议是寻找 nils。对 nil 对象的任何方法调用都不会执行任何操作并返回 nil，因此任何时候您希望调用某个方法而实际上没有调用，您应该寻找它。（.foo = 和 setFoo: 一样，所以 nil.foo = 1; 什么也不做。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T22:34:13.240

“随机”和“难以重现”让我认为这是与多线程有关的问题。竞争条件很难重现和调试。您需要确保对执行此操作所需的资源拥有专有权。

# c# - 如何在 Windows 窗体应用程序中播放 MP4 视频

> ID：573841
> 
> 赞同：1
> 
> 时间：2009-02-21T22:33:10.437
> 
> 标签：c#, .net, winforms

我想知道在 Vista 和 XP 上的 Windows 窗体应用程序 (.NET 2.0) 中播放 MP4 视频的最佳方法是什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T22:37:38.460

您可以[在 Form 上嵌入 Windows Media Player](http://msdn.microsoft.com/en-us/library/bb383953.aspx)。

**更新**：WMP 不支持开箱即用的 MP4，但有一些[编解码器包](http://www.tech-faq.com/windows-media-player-mp4-codec.shtml)添加了这种支持。可以将编解码器安装与您的设置捆绑在一起，但我认为 WMP 能够自行获取和安装 MP4 编解码器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T23:53:26.170

嵌入媒体播放器或查看托管 DirectX（尽管 MDX 现在有点老了）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-26T01:37:42.387

看看 iSpy - 它是开源的，并为 mp4 播放包装了 VLC 播放器。

[http://www.ispyconnect.com](http://www.ispyconnect.com)

# svn - 将本地 Subversion 更改传输到另一台机器最不痛苦的方法是什么？

> ID：573849
> 
> 赞同：3
> 
> 时间：2009-02-21T22:42:03.520
> 
> 标签：svn, tortoisesvn, patch

我正在对我的笔记本电脑进行更改。它还没有准备好提交到存储库，但我也想继续在我的桌面上工作。我的变更集非常大，不仅包含修改，还包含新文件和已删除文件。

我可以将完整的本地工作副本复制到另一台机器上并进行更改。然而，这听起来像是一个肮脏的解决方案（因为我正在污染另一台机器上的元数据），而且我也在不必要地传输构建工件。

我尝试使用 TortoiseSVN 传输 .patch 文件，但它一直抱怨“补丁属于旧版本”（不是真的，你为什么关心？）或“行不匹配”（是的，它们不匹配，因为我改变了它们）。我根本不喜欢“连续错误弹出窗口”的体验。

我不想安装 Cygwin，所以命令行补丁是不可能的。

我猜最后一个选项是为这个特性创建一个新分支并进入一个“签入/更新”循环。然而，这些都显示在 trac 历史中造成污染。

有更好的想法吗？或者我缺少什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-21T22:49:40.130

您是否尝试过创建新分支并使用[svn switch](http://svnbook.red-bean.com/en/1.0/re27.html)。如果您从初始工作修订版分支，它会将您转移到存储库的不同部分并维护您的更改。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-21T22:51:03.700

至于替代方法，您可以将[GIT](http://git-scm.com/)添加到组合中。GIT 的分布式源代码控制模型允许您在台式机和笔记本电脑之间来回推送变更集。并且由于 GIT 在本地文件系统上管理其变更集信息，因此您在任何一方所做的提交都不会出现在您的 TRAC 系统正在监视的流中。

因此，您基本上是“使用颠覆离线”并使用 GIT 提交完成您的工作。完成后，将整个套件和 kaboodle 签入您的颠覆后备箱。

功能分支在 Subversion 中是轻量级的，非常适合隔离此类特定功能的工作。如果您使用的是 subversion 1.5 或更高版本，那么整个同步和合并过程比使用 1.4 时要容易得多。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-21T22:46:47.657

分支是干净的解决方案。并且具有额外的优势，即在您进行这一巨大更改时为您提供备份。更不用说，机器之间未来更改的轻松同步。

但是，您可能只需压缩整个工作目录并将其转储到另一台机器的某个位置即可。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T22:47:12.647

为此，我将创建一个临时分支。这样，您只需要使用 SVN 工具，而不会污染元元或复制工件。

此外，您似乎在间隔检查代码，并且如果您的硬盘驱动器崩溃，分支也可以防止数据丢失。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-21T22:47:21.290

不是最后一个选项，第一个选项：如果真的有这么多的变化，你早就应该创建一个功能分支。

您仍然可以通过从工作副本到服务器上的分支目录的 svn 复制来做到这一点，因此您不需要“签入/更新循环”，只需*一个*签入，*一个*更新/切换，真的。

像 svn copy MyWorkingCopy svn://theserver/project/branches/features/my-feature-branch

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-21T23:23:52.077

如果您只需要桌面上的副本，我发现 Live Sync 非常适合这种情况。我将它设置为在我的笔记本电脑和两台台式机上复制我的结帐文件夹，这使我在三台机器上的状态完全相同。这一切都在后台连续发生。

或者你可以去一个分支，并确保在移动到桌面之前不要忘记在笔记本电脑上提交任何更改。:-)

**编辑：**回应评论 - 是的，如果您在两台机器正在同步的过程中开始编辑文件，可能会遇到麻烦。可能发生的最糟糕的情况是在其中一台机器上丢失一些编辑。在实践中，这种情况发生的可能性很小。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-21T22:47:45.797

好吧，大多数人会争辩说，如果您的“更改集很大”，您绝对应该检查更改（在必要的分支中）！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-24T03:57:16.800

你可以试试[SVK](http://svk.elixus.org/view/HomePage)。从博文和 SVK 站点来看，典型的 SVK 使用场景是

*   *镜像现有的远程存储库，*
*   *然后在你的机器上创建分支，*
*   *在这些分支机构本地工作，并且*
*   *完成后，将它们合并回镜像树干，*
*   *最后一步将透明地更新远程存储库。*

我没有任何使用 SVK 的实践经验。但我认为它符合你的情况。这篇博客文章更详细地描述了它[http://www.bieberlabs.com/archives/2004/11/30/using-svk/](http://www.bieberlabs.com/archives/2004/11/30/using-svk/)

我认为 SVK 的 Windows 版本可用（[SVKWin32](http://svk.bestpractical.com/view/SVKWin32)），然后 TortoiseSVN 可以使用存储库的本地镜像进行更新/提交。

# html - 遵循网络标准有多重要？

> ID：573863
> 
> 赞同：18
> 
> 时间：2009-02-21T22:55:07.513
> 
> 标签：html, css, markup, web-standards

我最近发现大多数主要网站[都未通过 W3C 的标记和 CSS 验证测试](http://techqi.blogspot.com/2009/02/standards-compliance-huh.html)。因此，遵循 Web 标准到底有多重要？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-01-12T06:27:46.467

## 标准！

**一点历史**

在直接回答之前，我认为说明最新标准的背景很重要。

您知道[W3C](http://www.w3.org/)一直在尝试开发[XHTML 2](http://www.w3.org/TR/xhtml2/)标准吗？如果它出现了，它就不会与以前的 HTML 版本向后兼容。事实上，[W3C](http://www.w3.org/)内部形成了一场叛乱，最终以一个简单地分道扬镳创建[WHATWG](http://www.whatwg.org/)的团体告终。[WHATWG是](http://www.whatwg.org/)[HTML5](http://www.w3.org/TR/html5/)背后的真正大师。

你有没有问过自己为什么要花这么多时间从[WC3](http://www.w3.org/)获得标准？WC3 的工作方式非常民主。他们讨论一切，直到每个人都接受。[WHATWG](http://www.whatwg.org/)做这件事时有点扭曲：提出并讨论了问题，但最终决定权在于编辑。引用[Jeremy Keith](http://adactio.com/)的话：“当[WHATWG](http://www.whatwg.org/)开发 HTML5 时，W3C 继续致力于 XHTML 2。说它进展不快是不准确的。它进展非常非常缓慢。”

最终 W3C[放弃了](http://www.webdirections.org/blog/xhtml2-is-dead-long-live-html5/)XHTML 2 ，毕竟他们决定与[WHATWG](http://www.whatwg.org/)合作，而不是从头开始。

* * *

**意大利面条标记的回归？**

虽然 HTML5 不再像 XHTML 那样严格，但这并不意味着不再有良好的编码实践。HTML5 不是马基雅维利主义者。与 XHTML 2 不同，它建立在现有规范的基础上（支持现有内容）。

最重要的是，规范背后的仲裁者是不同的浏览器供应商。你见过`webkit`（Safari、Chrome）、`moz`（Firefox）或`o`（Opera）的专有 CSS 元素吗？这实际上是正常的，因为这意味着供应商正在努力制定即将到来的规范，有时甚至是超出规范的功能。有一段时间，微软有超标的心态，因为他们垄断了浏览器份额，并创建了自己的 CSS 元素。微软创建了诸如此类的 CSS 元素[`filter`](http://reference.sitepoint.com/css/filter)，但我们发现了一些奇特的东西。对于规范有两个建议，它们是在 CSS 中使用不透明度的两种不同方式：颜色元素中的 RGBA 和不透明度元素。

* * *

**标准的重要性**

最后，我想说网页设计师/开发人员有很大的责任跟上技术和标准（如 HTML5）的最新情况。这并不意味着要阅读那里的每一个规范。我同意这将是漫长而无聊的。实际上，阅读有关该主题的书籍，关注浏览器供应商的开发博客，不时尝试一些有趣的东西。我不再同意 100% 遵循所有 Web 标准，因为总会有例外。我更喜欢使用有助于开发人员的良好编码实践，但同时对浏览器友好。重要的是要了解 HTML5 建立在现有标准之上，并且是为了支持现有内容而设计的。

最后一个意见：[http ://dowebsitesneedtobeexperiencedexactlythesameineverybrowser.com/](http://dowebsitesneedtobeexperiencedexactlythesameineverybrowser.com/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-21T22:59:12.120

这取决于您的观众人数。如果是为了你的博客，你可能会很草率。然而，我做过政府网站，在这些网站上，我们遵循网络标准并遵循可访问性指南至关重要。

但是，是的，就去做吧。你为什么不呢？

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-21T23:05:42.150

很重要。可访问性、可用性、可移植性、这是规律（在某些情况下）、可扩展性、更容易与各种应用程序框架和 CMS 集成。名单还在继续，但其他海报已经很好地涵盖了这些要点。

您的普通企业主通常会像 OP 一样说“谁在乎”。到目前为止，我最有效的回应是“谷歌机器人只不过是一个盲人最终用户。你不想让它有效地列出你的网站吗？”

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-21T22:59:37.737

如果您遵循标准，任何布局错误都将更容易调试。当您忽略这些标准时，浏览器可以呈现您的页面，无论感觉如何，并且更改一个字符可以完全改变您的页面呈现方式。调试一个浏览器很困难，但调试 IE 7、IE 6、Firefox、Opera、Safari ......而忽略标准只会让你的生活变得困难。

如果您使用 jQuery 或其他 DOM 操作库，如果您的标记无效，您可能会得到意外和不一致的结果。

所以，不要浪费你的时间。确保编写有效的 HTML 和 CSS。这真的很容易，并且会节省您的时间。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-01-21T09:22:34.260

您可以遵循适用于 html、css、c、java...任何东西的简单规则。

**坚持标准，除非你有充分的理由不理会它们。如果您不遵守标准文档，为什么不这样做。**

有时您会遇到必须违反标准来编写解决方法，或加速您的代码或...的情况。

每当您觉得必须无视标准时，您应该写下您为什么这样做，以便您或其他遇到 html（或 CMS 代码）的开发人员知道这不是错误。

是的，有时“好理由”是截止日期或服务器崩溃。只要你有文件就OK了。

额外的专业人士：如果编写不符合标准的非标准 html（或代码）是一个例外，那么您很可能习惯于编写干净的代码。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-21T23:22:09.147

这些大网站的问题是他们有一群程序员来保证网站*继续工作*。

你？你愿意为此花钱吗？

不遵循标准的问题在于，您无法保证您的网站将如何在未来的浏览器中运行。

然后还有其他问题，例如可访问性，或启用自动化工具来解析您的网站。无论是搜索引擎网络爬虫还是聚合微格式信息的网站，还是盲人的屏幕阅读器，还是需要能够阅读您网站的数十种其他工具中的任何一种，您都无法保证它们能够如果它是随机标签汤，请解析您的网站。

然后是你自己我们的工具。jQuery 或其他 javascript 库能找出你奇怪的非标准 DOM 吗？也许，也许不是。请问下周的版本？谁知道？

最后，成本是多少？编写兼容的 HTML/CSS 并不难。需要一些练习来找出一些 CSS 技巧以避免依赖已弃用或非标准的 HTML，但是一旦你弄清楚了，它就像典型的草率的非标准代码一样容易编写。当然，它甚至可以让事情变得更容易，因为它允许您在调试时有意义地使用 HTML 验证器等工具。如果您的网站在任何情况下都包含 50 个 HTML 错误，则很难将其用于任何有用的事情。其中哪一个（如果有）与您要解决的问题有关？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-21T22:58:26.147

浏览器和其他基于 Web 的阅读器依赖于开发人员来遵循标准，并且在大多数情况下，遵守这些标准并不难。所以，尽你所能，但不要让自己没有效率地跟随他们。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-01-24T13:26:40.140

W3C 验证是您在寻找可能破坏站点功能（或可能破坏某些内容）的错误时要考虑的重要因素。这是一种雷达，可以在错误开始破坏您的工作之前检测到错误。

例如，如果您的网站有问题并想在 SO 上发布有关它的问题，建议您使用 W3C 验证器并确保它不会指向您问题的根源。

但是......并非所有的 HTML 都会验证。最重要但不是唯一的情况可能是 HTML5。在 CSS 中，供应商前缀也不会生效。这是否意味着您不应该使用它们？一点也不！

验证服务可以很好地发现输入错误的属性名称、未闭合的标记、缺少分号或`<br>`带有 XHTML 文档类型的标记。我不会担心仅仅因为验证器不知道`<video>`标签的作用而无法验证的元素。这仍然是正确的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-21T23:14:51.223

作为旁注 - 遵循 Web 标准并不是一项很大的努力。当你习惯它时，你很快就会注意到不这样做是多么的努力。与您想使用的任何老式布局技术相比，使用网络标准通常会产生更少的代码（= 更少的编写时间）、更具可读性的代码和“面向未来”的代码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-21T22:57:26.493

简而言之——非常。出于跨平台和跨浏览器兼容性的目的，这一点很重要。

你需要跟着他们去T吗？如果你不这样做，你可能会没事的。

许多不遵循严格标准的东西都是随着时间的推移而修改的遗留应用程序。

在我看来——没有理由不遵守新项目的严格标准。

伊恩

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-21T23:56:31.500

如果一切都在您想要支持的所有浏览器中运行，那么 HTML 代码实际验证并不是那么重要。但是，对于 XHTML，这**很**重要：使用 XHTML 意味着您希望 XML 解析器可以读取您的代码，因此任何不是有效 XHTML 的东西都不应该被声明为这样。

但是创建符合标准的代码并不难，即任何不费心修复错误的人都表现出缺乏专业精神。有时人们可能会决定忽略这些标准，但这应该始终是一个有意识的决定——例如，Google 主页针对速度和跨浏览器支持进行了优化，并且已经过广泛的测试。如果您没有进行此类测试和持续支持的资源，您应该坚持使用这些标准。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-01-26T15:59:02.340

归根结底，标准意味着为开发人员提供便利。通过成为“标准”，它充当一组不同要求的代理，因此如果您遵循标准：

*   知道您的代码将适用于不同的技术（浏览器、平台、版本）
*   知道您的代码适用于不同的人（可访问性）
*   客户基于该事实接受您的代码（项目需要符合标准）
*   其他我没想到的东西

Web 标准“为我们节省时间”的记录非常复杂：我们经常花费数小时争取验证，结果却发现浏览器不支持这些标准。对我来说，让页面进行验证通常可以节省时间。

回到手头的问题：何时使用它们。这是我的务实观点：再看看你的需求（在浏览器、平台、版本、可访问性方面）。比较瞄准所有这些的方法与瞄准标准加上标准缺乏的方法。在需求列表中添加“标准”是否可以节省您的时间，或者只是增加了完成项目的负担？

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-01-24T20:48:28.743

我发现 HTML 验证非常方便。

在那之后（即验证取代常识）它成为一个障碍，我相信验证是一个非常有用的开发工具但没有必要100％遵守，例如XHTML Strict规范不推荐使用`target=""`选择器，从而使它没有验证，但它仍然可以完美运行，要在不使用上述代码的情况下实现相同的操作，需要 javascript 代码来实现：

```
jQuery(document).ready(function($) {
    $('a').each(function(){
        if (($(this).attr('rel')=='external') || 
            ($(this).attr('rel')=='nofollow')) 
        {
             $(this).attr('target','_blank');
        }
    });
}); 
```

现在要实现上述内容，而不是简单的`target=""`违背逻辑和良好的编程，另一方面，CSS 通常确实需要验证，但也有例外；浏览器黑客和供应商特定标签，在当前浏览器环境中是必要的邪恶，它会使你的代码无效，但它会在大多数主流浏览器中工作，所以这完全取决于你，你可以追求 100% 的合规性并跳转通过箍在您的网站上有一个漂亮的小徽章，上面写着“XHTML Valid”或“HTML5 Valid”或其他任何东西，或者您可以拥有一个整洁、功能强大且代码简洁的网站。

PS 在我被激怒并被称为虚伪之前，是的，我的个人博客网站上确实有一个，但我的代码目前无效。

进一步阅读： http: [//net.tutsplus.com/articles/general/but-it-doesnt-validate/](http://net.tutsplus.com/articles/general/but-it-doesnt-validate/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-01-21T19:55:31.627

嗯，正如你所说，大多数大型网站都不遵循标准，所以如果你想要一个大型网站，你最好不要遵循标准。:)

但是不，最好遵循标准，因为这会给您带来最大的变化，即您的网站将在大多数浏览器上运行，并且将在很长一段时间内继续在大多数未来浏览器上运行。

有一些例外，主要是因为某些浏览器（或某些版本的浏览器）没有遵循标准。因此，您有时可能需要一些技巧或技巧来让您的网站在您想要支持的所有浏览器中运行。大多数这些技巧可以在遵循标准的同时应用，但其他一些技巧可能会带来更好的性能或更容易实施或维护。

因此，虽然最好遵循一般标准，但总可能有一两个例外......

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-01-26T16:39:14.393

Here is my take on this question.

Firstly, I'll tackle this bit:

"I recently found out that most of the major websites fail W3C's markup and CSS validation tests. Therefore [...]"

Big companies can often suffer from paralysis, which makes it very hard to get even small changes made. In most cases, the practices of "big companies" are not a good example to follow. They are not "big companies" because they have a poorly constructed website - its the other way around. They become big, and to make a change to their website to fix a validation error becomes a longer and longer process that costs more and more money (with long lists of people who need to sign off the changes!)

Now let's move onto the next bit, without the baggage of big companies to worry about!

"[...] how important is it really to follow web standards?"

This can be answered in two contexts. I think the first paragraph probably applies to you as you are asking on Stack Overflow :)

If you are a professional web developer, you should always follow the standards unless explicitly requested not to do so (see **1)**). The reasons you would do this are that being able to validate your mark-up, accessibility and browser-compatibility are part of the craft of creating professional websites.

If you are a subject-enthusiast (for example, an expert on rare insects) - it should be possible for you to publish a web page that contains terrible mark-up and browsers should all treat the errors in the same way - at the very least, everyone should be able to read the information. I mention this because the web is open to anyone to publish a web page - not just expert developers.

**1)** "explicitly requested not to do so" ? What on Earth does that mean. It means that it is possible to create a website that works in all browsers without following the standards. Google very deliberately use some very strange mark-up on their search page as discussed in this article:

[http://www.stevefenton.co.uk/Content/Blog/Date/201008/Blog/Google-Deliberately-Write-Awful-HTML/](http://www.stevefenton.co.uk/Content/Blog/Date/201008/Blog/Google-Deliberately-Write-Awful-HTML/)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-21T23:20:22.723

网站设计者在历史上没有遵循网络标准的唯一原因是（1）根本不了解标准，或者（2）让不符合标准的浏览器（*cough IE*咳嗽*）做一些很酷的事情。但是 Internet Explorer 最近在标准兼容性方面取得了重大进展，因此原因（2）变得越来越不相关，而您显然不受原因（1）的约束，那么为什么不编写符合标准的网站呢？正如其他人所说，它将使您的代码更容易调试，因为您只需要使用一个标准而不是一堆不同的浏览器。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-21T23:07:23.910

我做的第一件事是在我的目标环境中进行测试。如果它正在工作并且无法验证，它可能是一个较小的点，但自然值得探索。当然，您确实希望尽可能地争取可访问性。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-01-25T19:18:37.660

如果您想立即交付项目，请打破您想要的所有标准。

但是，如果您希望现在和将来交付（无需任何额外努力），请严格遵守标准。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-01-25T19:03:18.503

这取决于项目的规模和您的预算。如果您需要快速完成某件事，并且没有太多功能，而您的主要目的是完成某件事并继续前进，那么标准并不重要。当您的项目非常小时，您将花费双倍的时间来遵守标准。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2011-01-21T15:12:03.940

这一切都是为了让您的网站按照您的规范运行，并在当今最常用的浏览器中始终如一地运行。务实地说，网络标准并不优先。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2011-01-25T04:50:24.033

W3C 标准非常有用，但它们是达到目的的手段，而不是目的本身。这些标准的最终目标是跨浏览器兼容性，这一点非常重要。W3C 的标准排在第二位，以确保您的应用程序在您的受众将使用的所有不同浏览器上正确运行。当您牢记 SEO 时，Web 标准也会获得很多价值。遵守标准将使您的网站对非人类用户更加可见，因此如果您关心搜索引擎的可见性，那么网络标准也应该如此。对于“主要网站”（因为它们已经在搜索引擎中建立良好），这可能不是一个大问题，但可能对您而言。

因此，网络标准对于**跨浏览器兼容性**和**搜索引擎优化**目的很重要。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2011-01-23T02:39:32.297

这里有人用Hotmail吗？您是否注意到，对于每个主要的 Firefox 版本，Microsoft 都必须返回并对其 Hotmail 网站进行更改，以免它们在最新的 Firefox 版本中落后？

如果开发人员尊重标准，他们是否需要这样做？他们会节省多少时间/金钱？然后他们可以将多少时间/金钱投资于更新的技术或新功能？

您说大多数主要网站都未通过 W3C 的标记和 CSS 验证测试。看看大部分网站。它们看起来很现代吗？它们看起来像那些验证的吗？他们是第一个实施最新和最伟大的功能，还是他们坚持维护旧的和过时的技术，狂热而不知疲倦地试图维护纸牌屋，并希望变革之风不会把它吹倒？

我们做出的每一个决定都有机会成本。有时，跳过标准的机会成本可以建立有利可图的商业伙伴关系。其他时候，特别是当由于无知而没有遵循标准时，由于错误、随机行为和猜谜游戏，成本被抛在后面。有时，遵循标准可以创建一个可扩展平台，可以在未来几年添加新功能。

# c# - WCF 客户端“使用”块问题的最佳解决方法是什么？

> ID：573872
> 
> 赞同：415
> 
> 时间：2009-02-21T23:02:24.407
> 
> 标签：c#, vb.net, wcf, using, wcf-client

我喜欢在一个`using`块中实例化我的 WCF 服务客户端，因为它几乎是使用实现的资源的标准方式`IDisposable`：

```
using (var client = new SomeWCFServiceClient()) 
{
    //Do something with the client 
} 
```

但是，正如[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/aa355056.aspx)中所述，将 WCF 客户端包装在一个`using`块中可能会掩盖任何导致客户端处于故障状态（如超时或通信问题）的错误。长话短说，当`Dispose()`被调用时，客户端的`Close()`方法会触发，但由于它处于故障状态而引发错误。然后，原始异常被第二个异常掩盖。不好。

MSDN 文章中建议的解决方法是完全避免使用`using`块，而是实例化您的客户端并使用它们，如下所示：

```
try
{
    ...
    client.Close();
}
catch (CommunicationException e)
{
    ...
    client.Abort();
}
catch (TimeoutException e)
{
    ...
    client.Abort();
}
catch (Exception e)
{
    ...
    client.Abort();
    throw;
} 
```

与`using`街区相比，我认为这很丑陋。每次需要客户端时都要编写大量代码。

幸运的是，我发现了一些其他的解决方法，例如在（现已不复存在的）IServiceOriented 博客上的这个。你开始：

```
public delegate void UseServiceDelegate<T>(T proxy); 

public static class Service<T> 
{ 
    public static ChannelFactory<T> _channelFactory = new ChannelFactory<T>(""); 

    public static void Use(UseServiceDelegate<T> codeBlock) 
    { 
        IClientChannel proxy = (IClientChannel)_channelFactory.CreateChannel(); 
        bool success = false; 
        try 
        { 
            codeBlock((T)proxy); 
            proxy.Close(); 
            success = true; 
        } 
        finally 
        { 
            if (!success) 
            { 
                proxy.Abort(); 
            } 
        } 
     } 
} 
```

然后允许：

```
Service<IOrderService>.Use(orderService => 
{ 
    orderService.PlaceOrder(request); 
}); 
```

这还不错，但我不认为它像`using`块一样富有表现力和易于理解。

我目前尝试使用的解决方法是我第一次在[blog.davidbarret.net](http://blog.davidbarrett.net/archive/2007/11.aspx)上读到的。基本上，无论您在哪里使用，您都可以覆盖客户端的`Dispose()`方法。就像是：

```
public partial class SomeWCFServiceClient : IDisposable
{
    void IDisposable.Dispose() 
    {
        if (this.State == CommunicationState.Faulted) 
        {
            this.Abort();
        } 
        else 
        {
            this.Close();
        }
    }
} 
```

这似乎能够`using`再次允许该块，而没有掩盖故障状态异常的危险。

那么，在使用这些变通方法时，我还需要注意哪些其他问题？有没有人想出更好的办法？

* * *

## 回答 #1

> 赞同：142
> 
> 时间：2009-02-21T23:38:40.917

实际上，虽然我[写了博客](http://marcgravell.blogspot.com/2008/11/dontdontuse-using.html)（参见[Luke 的回答](https://stackoverflow.com/questions/573872/what-is-the-best-workaround-for-the-wcf-client-using-block-issue/573917#573917)），但我认为[这](http://web.archive.org/web/20100703123454/http://old.iserviceoriented.com/blog/post/Indisposable+-+WCF+Gotcha+1.aspx)比我的 IDisposable 包装器要好。典型代码：

```
Service<IOrderService>.Use(orderService=>
{
  orderService.PlaceOrder(request);
}); 
```

* * *

（根据评论编辑）

由于`Use`返回 void，处理返回值的最简单方法是通过捕获的变量：

```
int newOrderId = 0; // need a value for definite assignment
Service<IOrderService>.Use(orderService=>
  {
    newOrderId = orderService.PlaceOrder(request);
  });
Console.WriteLine(newOrderId); // should be updated 
```

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2009-09-14T23:24:46.627

如果要在 IServiceOriented.com 提倡的解决方案和[David Barret 的博客](http://blog.davidbarrett.net/archive/2007/11.aspx)提倡的解决方案之间进行选择，我更喜欢重写客户端的 Dispose() 方法所提供的简单性。这使我可以继续使用 using() 语句，就像人们对一次性对象所期望的那样。但是，正如@Brian 指出的那样，此解决方案包含一个竞争条件，即在检查状态时可能不会出现故障，但可能在调用 Close() 时出现故障，在这种情况下仍会发生 CommunicationException。

因此，为了解决这个问题，我采用了一种混合了两全其美的解决方案。

```
void IDisposable.Dispose()
{
    bool success = false;
    try 
    {
        if (State != CommunicationState.Faulted) 
        {
            Close();
            success = true;
        }
    } 
    finally 
    {
        if (!success) 
            Abort();
    }
} 
```

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-02-21T23:06:01.933

我写了一个[高阶函数](https://web.archive.org/web/20160315041245/http://www.atrevido.net/blog/2007/08/13/Practical+Functional+C+Part+II.aspx)来让它正常工作。我们已经在几个项目中使用了它，它似乎工作得很好。这就是事情从一开始就应该完成的方式，没有“使用”范式等。

```
TReturn UseService<TChannel, TReturn>(Func<TChannel, TReturn> code)
{
    var chanFactory = GetCachedFactory<TChannel>();
    TChannel channel = chanFactory.CreateChannel();
    bool error = true;
    try {
        TReturn result = code(channel);
        ((IClientChannel)channel).Close();
        error = false;
        return result;
    }
    finally {
        if (error) {
            ((IClientChannel)channel).Abort();
        }
    }
} 
```

您可以像这样拨打电话：

```
int a = 1;
int b = 2;
int sum = UseService((ICalculator calc) => calc.Add(a, b));
Console.WriteLine(sum); 
```

这与您在示例中的情况非常相似。在某些项目中，我们编写了强类型的辅助方法，因此我们最终编写了诸如“Wcf.UseFooService(f=>f...)”之类的东西。

我觉得它很优雅，考虑到所有的事情。你有遇到什么特别的问题吗？

这允许插入其他漂亮的功能。例如，在一个站点上，该站点代表登录用户对服务进行身份验证。（该站点本身没有凭据。）通过编写我们自己的“UseService”方法助手，我们可以按照我们想要的方式配置通道工厂，等等。我们也不必使用生成的代理——任何接口都可以.

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2011-02-19T04:35:23.697

这是 Microsoft 推荐的处理 WCF 客户端调用的方法：

有关更多详细信息，请参阅：[预期异常](http://msdn.microsoft.com/en-us/library/aa354510.aspx)

```
try
{
    ...
    double result = client.Add(value1, value2);
    ...
    client.Close();
}
catch (TimeoutException exception)
{
    Console.WriteLine("Got {0}", exception.GetType());
    client.Abort();
}
catch (CommunicationException exception)
{
    Console.WriteLine("Got {0}", exception.GetType());
    client.Abort();
} 
```

**附加信息** 似乎有很多人在 WCF 上问这个问题，以至于微软甚至创建了一个专门的示例来演示如何处理异常：

c:\WF_WCF_Samples\WCF\Basic\Client\ExpectedExceptions\CS\client

下载示例： [C#](http://www.microsoft.com/downloads/en/confirmation.aspx?FamilyID=35ec8682-d5fd-4bc3-a51a-d8ad115a8792&displaylang=en)或 [VB](http://archive.msdn.microsoft.com/vb2010samples/Release/ProjectReleases.aspx?ReleaseId=4174)

[考虑到涉及到 using 语句的](http://msdn.microsoft.com/en-us/library/aa355056.aspx)问题很多，[（加热？）关于这个问题的内部讨论](http://social.msdn.microsoft.com/forums/en-US/wcf/thread/4cdc67e0-3069-4d3b-b94f-27e2b8ff4429/)和[线程](http://social.msdn.microsoft.com/forums/en-US/wcf/thread/b95b91c7-d498-446c-b38f-ef132989c154/)，我不会浪费我的时间尝试成为代码牛仔并找到更清洁的方法。我将把它吸干，并为我的服务器应用程序以这种冗长（但受信任）的方式实现 WCF 客户端。

**可选的附加故障捕获**

许多异常源自`CommunicationException`，我认为大多数异常都不应该重试。我苦苦研究了 MSDN 上的每个异常，并找到了一个可重试异常的简短列表（除`TimeOutException`上述之外）。如果我错过了应该重试的异常，请告诉我。

```
 // The following is typically thrown on the client when a channel is terminated due to the server closing the connection.
catch (ChannelTerminatedException cte)
{
secureSecretService.Abort();
// todo: Implement delay (backoff) and retry
}

// The following is thrown when a remote endpoint could not be found or reached.  The endpoint may not be found or 
// reachable because the remote endpoint is down, the remote endpoint is unreachable, or because the remote network is unreachable.
catch (EndpointNotFoundException enfe)
{
secureSecretService.Abort();
// todo: Implement delay (backoff) and retry
}

// The following exception that is thrown when a server is too busy to accept a message.
catch (ServerTooBusyException stbe)
{
secureSecretService.Abort();
// todo: Implement delay (backoff) and retry
} 
```

诚然，这是一段平凡的代码。我目前更喜欢[这个答案](https://stackoverflow.com/a/9370880/328397)，并且在该代码中看不到任何可能导致问题的“黑客”。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2010-01-22T08:06:55.247

我终于找到了一些可靠的步骤来解决这个问题。

> 此自定义工具扩展了 WCFProxyGenerator 以提供异常处理代理。它生成一个额外的代理，称为`ExceptionHandlingProxy<T>`继承`ExceptionHandlingProxyBase<T>`- 后者实现了代理功能的核心。结果是您可以选择使用继承`ClientBase<T>`或`ExceptionHandlingProxy<T>`封装管理通道工厂和通道的生命周期的默认代理。ExceptionHandlingProxy 尊重您在“添加服务引用”对话框中关于异步方法和集合类型的选择。

[Codeplex](http://wcfproxygenerator.codeplex.com/)有一个名为**Exception Handling WCF Proxy Generator**的项目。它基本上是在 Visual Studio 2008 中安装了一个新的自定义工具，然后使用该工具生成新的服务代理*（添加服务引用）*。它有一些很好的功能来处理故障通道、超时和安全处置。这里有一个很棒的视频，叫做[ExceptionHandlingProxyWrapper](http://wcfguidanceforwpf.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=28192#DownloadId=70902)解释了它是如何工作的。

您可以安全地`Using`再次使用该语句，并且如果通道因任何请求（TimeoutException 或 CommunicationException）发生故障，Wrapper 将重新初始化故障通道并重试查询。如果失败，那么它将调用`Abort()`命令并处理代理并重新抛出异常。如果服务抛出`FaultException`代码，它将停止执行，并且代理将被安全地中止，并按预期抛出正确的异常。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-08-24T20:41:27.480

根据 Marc Gravell、MichaelGG 和 Matt Davis 的回答，我们的开发人员提出了以下建议：

```
public static class UsingServiceClient
{
    public static void Do<TClient>(TClient client, Action<TClient> execute)
        where TClient : class, ICommunicationObject
    {
        try
        {
            execute(client);
        }
        finally
        {
            client.DisposeSafely();
        }
    }

    public static void DisposeSafely(this ICommunicationObject client)
    {
        if (client == null)
        {
            return;
        }

        bool success = false;

        try
        {
            if (client.State != CommunicationState.Faulted)
            {
                client.Close();
                success = true;
            }
        }
        finally
        {
            if (!success)
            {
                client.Abort();
            }
        }
    }
} 
```

使用示例：

```
string result = string.Empty;

UsingServiceClient.Do(
    new MyServiceClient(),
    client =>
    result = client.GetServiceResult(parameters)); 
```

它尽可能接近“使用”语法，调用 void 方法时不必返回虚拟值，并且可以多次调用服务（并返回多个值）而不必使用元组。

此外，如果需要，您可以将其与`ClientBase<T>`后代一起使用，而不是 ChannelFactory。

如果开发人员想要手动处置代理/通道，则会公开扩展方法。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2013-05-02T10:53:57.173

@Marc Gravell

用这个不好吗：

```
public static TResult Using<T, TResult>(this T client, Func<T, TResult> work)
        where T : ICommunicationObject
{
    try
    {
        var result = work(client);

        client.Close();

        return result;
    }
    catch (Exception e)
    {
        client.Abort();

        throw;
    }
} 
```

或者，同样的`(Func<T, TResult>)`事情`Service<IOrderService>.Use`

这些将使返回变量更容易。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2011-08-30T19:23:19.933

下面是[问题](https://stackoverflow.com/q/573872/3312)源代码的增强版本，并扩展为缓存多个通道工厂，并尝试通过合约名称在配置文件中查找端点。

它使用 .NET 4（特别是：逆变，LINQ，`var`）：

```
/// <summary>
/// Delegate type of the service method to perform.
/// </summary>
/// <param name="proxy">The service proxy.</param>
/// <typeparam name="T">The type of service to use.</typeparam>
internal delegate void UseServiceDelegate<in T>(T proxy);

/// <summary>
/// Wraps using a WCF service.
/// </summary>
/// <typeparam name="T">The type of service to use.</typeparam>
internal static class Service<T>
{
    /// <summary>
    /// A dictionary to hold looked-up endpoint names.
    /// </summary>
    private static readonly IDictionary<Type, string> cachedEndpointNames = new Dictionary<Type, string>();

    /// <summary>
    /// A dictionary to hold created channel factories.
    /// </summary>
    private static readonly IDictionary<string, ChannelFactory<T>> cachedFactories =
        new Dictionary<string, ChannelFactory<T>>();

    /// <summary>
    /// Uses the specified code block.
    /// </summary>
    /// <param name="codeBlock">The code block.</param>
    internal static void Use(UseServiceDelegate<T> codeBlock)
    {
        var factory = GetChannelFactory();
        var proxy = (IClientChannel)factory.CreateChannel();
        var success = false;

        try
        {
            using (proxy)
            {
                codeBlock((T)proxy);
            }

            success = true;
        }
        finally
        {
            if (!success)
            {
                proxy.Abort();
            }
        }
    }

    /// <summary>
    /// Gets the channel factory.
    /// </summary>
    /// <returns>The channel factory.</returns>
    private static ChannelFactory<T> GetChannelFactory()
    {
        lock (cachedFactories)
        {
            var endpointName = GetEndpointName();

            if (cachedFactories.ContainsKey(endpointName))
            {
                return cachedFactories[endpointName];
            }

            var factory = new ChannelFactory<T>(endpointName);

            cachedFactories.Add(endpointName, factory);
            return factory;
        }
    }

    /// <summary>
    /// Gets the name of the endpoint.
    /// </summary>
    /// <returns>The name of the endpoint.</returns>
    private static string GetEndpointName()
    {
        var type = typeof(T);
        var fullName = type.FullName;

        lock (cachedFactories)
        {
            if (cachedEndpointNames.ContainsKey(type))
            {
                return cachedEndpointNames[type];
            }

            var serviceModel = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None).SectionGroups["system.serviceModel"] as ServiceModelSectionGroup;

            if ((serviceModel != null) && !string.IsNullOrEmpty(fullName))
            {
                foreach (var endpointName in serviceModel.Client.Endpoints.Cast<ChannelEndpointElement>().Where(endpoint => fullName.EndsWith(endpoint.Contract)).Select(endpoint => endpoint.Name))
                {
                    cachedEndpointNames.Add(type, endpointName);
                    return endpointName;
                }
            }
        }

        throw new InvalidOperationException("Could not find endpoint element for type '" + fullName + "' in the ServiceModel client configuration section. This might be because no configuration file was found for your application, or because no endpoint element matching this name could be found in the client element.");
    }
} 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2012-02-21T01:22:26.993

**这是什么？**

这是已接受答案的 CW 版本，但包含（我认为完整的）异常处理。

接受的答案引用[了这个不再存在的网站](http://web.archive.org/web/20100703123454/http://old.iserviceoriented.com/blog/post/Indisposable+-+WCF+Gotcha+1.aspx)。为了省去你的麻烦，我在这里包括了最相关的部分。此外，我稍微修改了它以包含[异常重试处理](https://stackoverflow.com/a/5048856/328397)以处理那些讨厌的网络超时。

**简单的 WCF 客户端用法**

生成客户端代理后，这就是实现它所需的全部内容。

```
Service<IOrderService>.Use(orderService=>
{
  orderService.PlaceOrder(request);
}); 
```

**服务委托.cs**

将此文件添加到您的解决方案中。无需更改此文件，除非您想更改重试次数或要处理的异常。

```
public delegate void UseServiceDelegate<T>(T proxy);

public static class Service<T>
{
    public static ChannelFactory<T> _channelFactory = new ChannelFactory<T>(""); 

    public static void Use(UseServiceDelegate<T> codeBlock)
    {
        IClientChannel proxy = (IClientChannel)_channelFactory.CreateChannel();
        bool success = false;

       Exception mostRecentEx = null;
       int millsecondsToSleep = 1000;

       for(int i=0; i<5; i++)  // Attempt a maximum of 5 times 
       {
           try
           {
               codeBlock((T)proxy);
               proxy.Close();
               success = true; 
               break;
           }

           // The following is typically thrown on the client when a channel is terminated due to the server closing the connection.
           catch (ChannelTerminatedException cte)
           {
              mostRecentEx = cte;
               proxy.Abort();
               //  delay (backoff) and retry 
               Thread.Sleep(millsecondsToSleep  * (i + 1)); 
           }

           // The following is thrown when a remote endpoint could not be found or reached.  The endpoint may not be found or 
           // reachable because the remote endpoint is down, the remote endpoint is unreachable, or because the remote network is unreachable.
           catch (EndpointNotFoundException enfe)
           {
              mostRecentEx = enfe;
               proxy.Abort();
               //  delay (backoff) and retry 
               Thread.Sleep(millsecondsToSleep * (i + 1)); 
           }

           // The following exception that is thrown when a server is too busy to accept a message.
           catch (ServerTooBusyException stbe)
           {
              mostRecentEx = stbe;
               proxy.Abort();

               //  delay (backoff) and retry 
               Thread.Sleep(millsecondsToSleep * (i + 1)); 
           }
           catch (TimeoutException timeoutEx)
           {
               mostRecentEx = timeoutEx;
               proxy.Abort();

               //  delay (backoff) and retry 
               Thread.Sleep(millsecondsToSleep * (i + 1)); 
           } 
           catch (CommunicationException comException)
           {
               mostRecentEx = comException;
               proxy.Abort();

               //  delay (backoff) and retry 
               Thread.Sleep(millsecondsToSleep * (i + 1)); 
           }
           catch(Exception )
           {
                // rethrow any other exception not defined here
                // You may want to define a custom Exception class to pass information such as failure count, and failure type
                proxy.Abort();
                throw ;  
           }
       }
       if (success == false && mostRecentEx != null) 
       { 
           proxy.Abort();
           throw new Exception("WCF call failed after 5 retries.", mostRecentEx );
       }

    }
} 
```

PS：我把这篇文章做成了一个社区维基。我不会从这个答案中收集“积分”，但如果你同意实施，我希望你支持它，或者编辑它以使其更好。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-12-07T12:25:02.037

像这样的包装器会起作用：

```
public class ServiceClientWrapper<ServiceType> : IDisposable
{
    private ServiceType _channel;
    public ServiceType Channel
    {
        get { return _channel; }
    }

    private static ChannelFactory<ServiceType> _channelFactory;

    public ServiceClientWrapper()
    {
        if(_channelFactory == null)
             // Given that the endpoint name is the same as FullName of contract.
            _channelFactory = new ChannelFactory<ServiceType>(typeof(T).FullName);
        _channel = _channelFactory.CreateChannel();
        ((IChannel)_channel).Open();
    }

    public void Dispose()
    {
        try
        {
            ((IChannel)_channel).Close();
        }
        catch (Exception e)
        {
            ((IChannel)_channel).Abort();
            // TODO: Insert logging
        }
    }
} 
```

这应该使您能够编写如下代码：

```
ResponseType response = null;
using(var clientWrapper = new ServiceClientWrapper<IService>())
{
    var request = ...
    response = clientWrapper.Channel.MyServiceCall(request);
}
// Use your response object. 
```

如果需要，包装器当然可以捕获更多异常，但原理保持不变。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-09-07T20:22:18.737

如果您不需要[IoC](http://en.wikipedia.org/wiki/Inversion_of_control)或使用自动生成的客户端（服务参考），那么您可以简单地使用包装器来管理关闭，并让[GC](http://en.wikipedia.org/wiki/Garbage_collection_%28computer_science%29)在客户端处于不会抛出任何异常的安全状态时获取客户端。GC 将调用 serviceclient 中的 Dispose，这将调用`Close`. 由于它已经关闭，因此不会造成任何损坏。我在生产代码中使用它没有问题。

```
public class AutoCloseWcf : IDisposable
{

    private ICommunicationObject CommunicationObject;

    public AutoDisconnect(ICommunicationObject CommunicationObject)
    {
        this.CommunicationObject = CommunicationObject;
    }

    public void Dispose()
    {
        if (CommunicationObject == null)
            return;
        try {
            if (CommunicationObject.State != CommunicationState.Faulted) {
                CommunicationObject.Close();
            } else {
                CommunicationObject.Abort();
            }
        } catch (CommunicationException ce) {
            CommunicationObject.Abort();
        } catch (TimeoutException toe) {
            CommunicationObject.Abort();
        } catch (Exception e) {
            CommunicationObject.Abort();
            //Perhaps log this

        } finally {
            CommunicationObject = null;
        }
    }
} 
```

然后当您访问服务器时，您创建客户端并`using`在自动断开连接中使用：

```
var Ws = new ServiceClient("netTcpEndPointName");
using (new AutoCloseWcf(Ws)) {

    Ws.Open();

    Ws.Test();
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-01-06T05:29:58.453

我使用 Castle 动态代理来解决 Dispose() 问题，并且还实现了在通道处于不可用状态时自动刷新通道。要使用它，您必须创建一个继承您的服务合同和 IDisposable 的新接口。动态代理实现了这个接口并包装了一个 WCF 通道：

```
Func<object> createChannel = () =>
    ChannelFactory<IHelloWorldService>
        .CreateChannel(new NetTcpBinding(), new EndpointAddress(uri));
var factory = new WcfProxyFactory();
var proxy = factory.Create<IDisposableHelloWorldService>(createChannel);
proxy.HelloWorld(); 
```

我喜欢这样，因为您可以注入 WCF 服务，而消费者无需担心 WCF 的任何细节。并且没有像其他解决方案那样增加麻烦。

看一下代码，其实很简单： [WCF Dynamic Proxy](https://github.com/JayDouglass/WcfProxy/blob/master/WcfProxy.Tests/WcfProxyTests.cs)

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2013-12-09T08:47:10.387

使用扩展方法：

```
public static class CommunicationObjectExtensions
{
    public static TResult MakeSafeServiceCall<TResult, TService>(this TService client, Func<TService, TResult> method) where TService : ICommunicationObject
    {
        TResult result;

        try
        {
            result = method(client);
        }
        finally
        {
            try
            {
                client.Close();
            }
            catch (CommunicationException)
            {
                client.Abort(); // Don't care about these exceptions. The call has completed anyway.
            }
            catch (TimeoutException)
            {
                client.Abort(); // Don't care about these exceptions. The call has completed anyway.
            }
            catch (Exception)
            {
                client.Abort();
                throw;
            }
        }

        return result;
    }
} 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2015-01-16T12:42:02.800

## 概括

使用此答案中描述的技术，可以使用以下语法在 using 块中使用 WCF 服务：

```
var channelFactory = new ChannelFactory<IMyService>("");

var serviceHelper = new ServiceHelper<IMyService>(channelFactory);
var proxy = serviceHelper.CreateChannel();
using (proxy as IDisposable)
{
    proxy.DoWork();
} 
```

您当然可以进一步调整它以实现针对您的情况的更简洁的编程模型 - 但关键是我们可以创建一个`IMyService`表示正确实现一次性模式的通道的实现。

* * *

## 细节

到目前为止给出的所有答案都解决了解决`IDisposable`. 似乎提供最简洁的编程模型（允许您使用`using`块来处理非托管资源）的答案是[这个](https://stackoverflow.com/a/4376544/2382536)- 修改代理以实现无错误`IDisposable`的实现。这种方法的问题是可维护性——我们必须为我们使用的任何代理重新实现这个功能。在这个答案的一个变体中，我们将看到我们如何使用*组合*而不是继承来使这种技术通用。

### 第一次尝试

该实现似乎有各种实现`IDisposable`，但为了论证，我们将使用[当前接受的答案](https://stackoverflow.com/a/573925/2382536)所使用的改编。

```
[ServiceContract]
public interface IMyService
{
    [OperationContract]
    void DoWork();
}

public class ProxyDisposer : IDisposable
{
    private IClientChannel _clientChannel;

    public ProxyDisposer(IClientChannel clientChannel)
    {
        _clientChannel = clientChannel;
    }

    public void Dispose()
    {
        var success = false;
        try
        {
            _clientChannel.Close();
            success = true;
        }
        finally
        {
            if (!success)
                _clientChannel.Abort();
            _clientChannel = null;
        }
    }
}

public class ProxyWrapper : IMyService, IDisposable
{
    private IMyService _proxy;
    private IDisposable _proxyDisposer;

    public ProxyWrapper(IMyService proxy, IDisposable disposable)
    {
        _proxy = proxy;
        _proxyDisposer = disposable;
    }

    public void DoWork()
    {
        _proxy.DoWork();
    }

    public void Dispose()
    {
        _proxyDisposer.Dispose();
    }
} 
```

有了上面的类，我们现在可以编写了

```
public class ServiceHelper
{
    private readonly ChannelFactory<IMyService> _channelFactory;

    public ServiceHelper(ChannelFactory<IMyService> channelFactory )
    {
        _channelFactory = channelFactory;
    }

    public IMyService CreateChannel()
    {
        var channel = _channelFactory.CreateChannel();
        var channelDisposer = new ProxyDisposer(channel as IClientChannel);
        return new ProxyWrapper(channel, channelDisposer);
    }
} 
```

这允许我们使用块来使用我们的服务`using`：

```
ServiceHelper serviceHelper = ...;
var proxy = serviceHelper.CreateChannel();
using (proxy as IDisposable)
{
    proxy.DoWork();
} 
```

### 使这个通用

到目前为止，我们所做的只是重新制定[托马斯的解决方案](https://stackoverflow.com/a/4376544/2382536)。阻止此代码通用的原因是`ProxyWrapper`必须为我们想要的每个服务合同重新实现类。我们现在将看一个允许我们使用 IL 动态创建此类型的类：

```
public class ServiceHelper<T>
{
    private readonly ChannelFactory<T> _channelFactory;

    private static readonly Func<T, IDisposable, T> _channelCreator;

    static ServiceHelper()
    {
        /** 
         * Create a method that can be used generate the channel. 
         * This is effectively a compiled verion of new ProxyWrappper(channel, channelDisposer) for our proxy type
         * */
        var assemblyName = Guid.NewGuid().ToString();
        var an = new AssemblyName(assemblyName);
        var assemblyBuilder = AppDomain.CurrentDomain.DefineDynamicAssembly(an, AssemblyBuilderAccess.Run);
        var moduleBuilder = assemblyBuilder.DefineDynamicModule(assemblyName);

        var proxyType = CreateProxyType(moduleBuilder, typeof(T), typeof(IDisposable));

        var channelCreatorMethod = new DynamicMethod("ChannelFactory", typeof(T),
            new[] { typeof(T), typeof(IDisposable) });

        var ilGen = channelCreatorMethod.GetILGenerator();
        var proxyVariable = ilGen.DeclareLocal(typeof(T));
        var disposableVariable = ilGen.DeclareLocal(typeof(IDisposable));
        ilGen.Emit(OpCodes.Ldarg, proxyVariable);
        ilGen.Emit(OpCodes.Ldarg, disposableVariable);
        ilGen.Emit(OpCodes.Newobj, proxyType.GetConstructor(new[] { typeof(T), typeof(IDisposable) }));
        ilGen.Emit(OpCodes.Ret);

        _channelCreator =
            (Func<T, IDisposable, T>)channelCreatorMethod.CreateDelegate(typeof(Func<T, IDisposable, T>));

    }

    public ServiceHelper(ChannelFactory<T> channelFactory)
    {
        _channelFactory = channelFactory;
    }

    public T CreateChannel()
    {
        var channel = _channelFactory.CreateChannel();
        var channelDisposer = new ProxyDisposer(channel as IClientChannel);
        return _channelCreator(channel, channelDisposer);
    }

   /**
    * Creates a dynamic type analogous to ProxyWrapper, implementing T and IDisposable.
    * This method is actually more generic than this exact scenario.
    * */
    private static Type CreateProxyType(ModuleBuilder moduleBuilder, params Type[] interfacesToInjectAndImplement)
    {
        TypeBuilder tb = moduleBuilder.DefineType(Guid.NewGuid().ToString(),
            TypeAttributes.Public | TypeAttributes.Class);

        var typeFields = interfacesToInjectAndImplement.ToDictionary(tf => tf,
            tf => tb.DefineField("_" + tf.Name, tf, FieldAttributes.Private));

        #region Constructor

        var constructorBuilder = tb.DefineConstructor(
            MethodAttributes.Public | MethodAttributes.HideBySig | MethodAttributes.SpecialName |
            MethodAttributes.RTSpecialName,
            CallingConventions.Standard,
            interfacesToInjectAndImplement);

        var il = constructorBuilder.GetILGenerator();
        il.Emit(OpCodes.Ldarg_0);
        il.Emit(OpCodes.Call, typeof(object).GetConstructor(new Type[0]));

        for (var i = 1; i <= interfacesToInjectAndImplement.Length; i++)
        {
            il.Emit(OpCodes.Ldarg_0);
            il.Emit(OpCodes.Ldarg, i);
            il.Emit(OpCodes.Stfld, typeFields[interfacesToInjectAndImplement[i - 1]]);
        }
        il.Emit(OpCodes.Ret);

        #endregion

        #region Add Interface Implementations

        foreach (var type in interfacesToInjectAndImplement)
        {
            tb.AddInterfaceImplementation(type);
        }

        #endregion

        #region Implement Interfaces

        foreach (var type in interfacesToInjectAndImplement)
        {
            foreach (var method in type.GetMethods())
            {
                var methodBuilder = tb.DefineMethod(method.Name,
                    MethodAttributes.Public | MethodAttributes.Virtual | MethodAttributes.HideBySig |
                    MethodAttributes.Final | MethodAttributes.NewSlot,
                    method.ReturnType,
                    method.GetParameters().Select(p => p.ParameterType).ToArray());
                il = methodBuilder.GetILGenerator();

                if (method.ReturnType == typeof(void))
                {
                    il.Emit(OpCodes.Nop);
                    il.Emit(OpCodes.Ldarg_0);
                    il.Emit(OpCodes.Ldfld, typeFields[type]);
                    il.Emit(OpCodes.Callvirt, method);
                    il.Emit(OpCodes.Ret);
                }
                else
                {
                    il.DeclareLocal(method.ReturnType);

                    il.Emit(OpCodes.Nop);
                    il.Emit(OpCodes.Ldarg_0);
                    il.Emit(OpCodes.Ldfld, typeFields[type]);

                    var methodParameterInfos = method.GetParameters();
                    for (var i = 0; i < methodParameterInfos.Length; i++)
                        il.Emit(OpCodes.Ldarg, (i + 1));
                    il.Emit(OpCodes.Callvirt, method);

                    il.Emit(OpCodes.Stloc_0);
                    var defineLabel = il.DefineLabel();
                    il.Emit(OpCodes.Br_S, defineLabel);
                    il.MarkLabel(defineLabel);
                    il.Emit(OpCodes.Ldloc_0);
                    il.Emit(OpCodes.Ret);
                }

                tb.DefineMethodOverride(methodBuilder, method);
            }
        }

        #endregion

        return tb.CreateType();
    }
} 
```

使用我们的新助手类，我们现在可以编写

```
var channelFactory = new ChannelFactory<IMyService>("");

var serviceHelper = new ServiceHelper<IMyService>(channelFactory);
var proxy = serviceHelper.CreateChannel();
using (proxy as IDisposable)
{
    proxy.DoWork();
} 
```

`ClientBase<>`请注意，您也可以对继承 for （而不是使用）的自动生成的客户端使用相同的技术（稍作修改）`ChannelFactory<>`，或者如果您想使用不同的实现`IDisposable`来关闭您的频道。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2015-10-07T07:07:59.583

我喜欢这种关闭连接的方式：

```
var client = new ProxyClient();
try
{
    ...
    client.Close();
}
finally
{
    if(client.State != CommunicationState.Closed)
        client.Abort();
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-02-24T14:47:10.593

我们的系统架构经常使用[Unity](http://unity.codeplex.com/) [IoC](http://en.wikipedia.org/wiki/Inversion_of_control)框架来创建 ClientBase 的实例，因此无法确保其他开发人员甚至使用`using{}`块。为了使其尽可能简单，我制作了这个扩展 ClientBase 的自定义类，并在处置时关闭通道，或者在最终确定时关闭通道，以防有人没有明确处置 Unity 创建的实例。

在构造函数中还需要做一些事情来设置自定义凭据和东西的通道，所以这里也有......

```
public abstract class PFServer2ServerClientBase<TChannel> : ClientBase<TChannel>, IDisposable where TChannel : class
{
    private bool disposed = false;

    public PFServer2ServerClientBase()
    {
        // Copy information from custom identity into credentials, and other channel setup...
    }

    ~PFServer2ServerClientBase()
    {
        this.Dispose(false);
    }

    void IDisposable.Dispose()
    {
        this.Dispose(true);
        GC.SuppressFinalize(this);
    }

    public void Dispose(bool disposing)
    {
        if (!this.disposed)
        {
            try
            {
                    if (this.State == CommunicationState.Opened)
                        this.Close();
            }
            finally
            {
                if (this.State == CommunicationState.Faulted)
                    this.Abort();
            }
            this.disposed = true;
        }
    }
} 
```

然后客户可以简单地：

```
internal class TestClient : PFServer2ServerClientBase<ITest>, ITest
{
    public string TestMethod(int value)
    {
        return base.Channel.TestMethod(value);
    }
} 
```

调用者可以执行以下任何操作：

```
public SomeClass
{
    [Dependency]
    public ITest test { get; set; }

    // Not the best, but should still work due to finalizer.
    public string Method1(int value)
    {
        return this.test.TestMethod(value);
    }

    // The good way to do it
    public string Method2(int value)
    {
        using(ITest t = unityContainer.Resolve<ITest>())
        {
            return t.TestMethod(value);
        }
    }
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-01-15T22:20:54.403

我编写[了一个简单的基类](https://github.com/uhaciogullari/WcfClientBase)来处理这个问题。它以[NuGet 包](https://nuget.org/packages/WcfClientBase)的形式提供，并且非常易于使用。

```
//MemberServiceClient is the class generated by SvcUtil
public class MemberServiceManager : ServiceClientBase<MemberServiceClient>
{
    public User GetUser(int userId)
    {
        return PerformServiceOperation(client => client.GetUser(userId));
    }

    //you can also check if any error occured if you can't throw exceptions       
    public bool TryGetUser(int userId, out User user)
    {
        return TryPerformServiceOperation(c => c.GetUser(userId), out user);
    }
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-05-08T16:22:56.080

```
public static class Service<TChannel>
{
    public static ChannelFactory<TChannel> ChannelFactory = new ChannelFactory<TChannel>("*");

    public static TReturn Use<TReturn>(Func<TChannel,TReturn> codeBlock)
    {
        var proxy = (IClientChannel)ChannelFactory.CreateChannel();
        var success = false;
        try
        {
            var result = codeBlock((TChannel)proxy);
            proxy.Close();
            success = true;
            return result;
        }
        finally
        {
            if (!success)
            {
                proxy.Abort();
            }
        }
    }
} 
```

所以它允许很好地编写返回语句：

```
return Service<IOrderService>.Use(orderService => 
{ 
    return orderService.PlaceOrder(request); 
}); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-01-07T06:08:36.857

对于那些感兴趣的人，这里是已接受答案的 VB.NET 翻译（如下）。为了简洁起见，我对其进行了一些改进，并结合了此线程中其他人的一些技巧。

我承认它对于原始标签 (C#) 来说是题外话，但由于我无法找到这个好的解决方案的 VB.NET 版本，我假设其他人也会寻找。Lambda 翻译可能有点棘手，所以我想为某人省去麻烦。

请注意，此特定实现提供了`ServiceEndpoint`在运行时配置的能力。

* * *

**代码：**

```
Namespace Service
  Public NotInheritable Class Disposable(Of T)
    Public Shared ChannelFactory As New ChannelFactory(Of T)(Service)

    Public Shared Sub Use(Execute As Action(Of T))
      Dim oProxy As IClientChannel

      oProxy = ChannelFactory.CreateChannel

      Try
        Execute(oProxy)
        oProxy.Close()

      Catch
        oProxy.Abort()
        Throw

      End Try
    End Sub

    Public Shared Function Use(Of TResult)(Execute As Func(Of T, TResult)) As TResult
      Dim oProxy As IClientChannel

      oProxy = ChannelFactory.CreateChannel

      Try
        Use = Execute(oProxy)
        oProxy.Close()

      Catch
        oProxy.Abort()
        Throw

      End Try
    End Function

    Public Shared ReadOnly Property Service As ServiceEndpoint
      Get
        Return New ServiceEndpoint(
          ContractDescription.GetContract(
            GetType(T),
            GetType(Action(Of T))),
          New BasicHttpBinding,
          New EndpointAddress(Utils.WcfUri.ToString))
      End Get
    End Property
  End Class
End Namespace 
```

**用法：**

```
Public ReadOnly Property Jobs As List(Of Service.Job)
  Get
    Disposable(Of IService).Use(Sub(Client) Jobs = Client.GetJobs(Me.Status))
  End Get
End Property

Public ReadOnly Property Jobs As List(Of Service.Job)
  Get
    Return Disposable(Of IService).Use(Function(Client) Client.GetJobs(Me.Status))
  End Get
End Property 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-01-14T14:10:30.750

对于使用 ServiceClient 而不是 ChannelFactory 的情况，我想从[Marc Gravell 的答案中添加服务的实现。](https://stackoverflow.com/a/573925/722552)

```
public interface IServiceConnector<out TServiceInterface>
{
    void Connect(Action<TServiceInterface> clientUsage);
    TResult Connect<TResult>(Func<TServiceInterface, TResult> channelUsage);
}

internal class ServiceConnector<TService, TServiceInterface> : IServiceConnector<TServiceInterface>
    where TServiceInterface : class where TService : ClientBase<TServiceInterface>, TServiceInterface, new()
{
    public TResult Connect<TResult>(Func<TServiceInterface, TResult> channelUsage)
    {
        var result = default(TResult);
        Connect(channel =>
        {
            result = channelUsage(channel);
        });
        return result;
    }

    public void Connect(Action<TServiceInterface> clientUsage)
    {
        if (clientUsage == null)
        {
            throw new ArgumentNullException("clientUsage");
        }
        var isChanneldClosed = false;
        var client = new TService();
        try
        {
            clientUsage(client);
            client.Close();
            isChanneldClosed = true;
        }
        finally
        {
            if (!isChanneldClosed)
            {
                client.Abort();
            }
        }
    }
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2013-08-16T06:53:23.953

我在这篇文章中提到了一些答案，并根据我的需要对其进行了定制。

我希望能够在使用 WCF 客户端之前使用它，以便使用该`DoSomethingWithClient()`方法。

```
public interface IServiceClientFactory<T>
{
    T DoSomethingWithClient();
}
public partial class ServiceClient : IServiceClientFactory<ServiceClient>
{
    public ServiceClient DoSomethingWithClient()
    {
        var client = this;
        // do somthing here as set client credentials, etc.
        //client.ClientCredentials = ... ;
        return client;
    }
} 
```

这是助手类：

```
public static class Service<TClient>
    where TClient : class, ICommunicationObject, IServiceClientFactory<TClient>, new()
{
    public static TReturn Use<TReturn>(Func<TClient, TReturn> codeBlock)
    {
        TClient client = default(TClient);
        bool success = false;
        try
        {
            client = new TClient().DoSomethingWithClient();
            TReturn result = codeBlock(client);
            client.Close();
            success = true;
            return result;
        }
        finally
        {
            if (!success && client != null)
            {
                client.Abort();
            }
        }
    }
} 
```

我可以将其用作：

```
string data = Service<ServiceClient>.Use(x => x.GetData(7)); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-01-15T12:13:46.127

我有自己的通道包装器，它实现 Dispose 如下：

```
public void Dispose()
{
        try
        {
            if (channel.State == CommunicationState.Faulted)
            {
                channel.Abort();
            }
            else
            {
                channel.Close();
            }
        }
        catch (CommunicationException)
        {
            channel.Abort();
        }
        catch (TimeoutException)
        {
            channel.Abort();
        }
        catch (Exception)
        {
            channel.Abort();
            throw;
        }
} 
```

这似乎运作良好，并允许使用 using 块。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2014-12-23T01:48:35.887

以下帮助程序允许调用`void`和非无效方法。用法：

```
var calculator = new WcfInvoker<CalculatorClient>(() => new CalculatorClient());
var sum = calculator.Invoke(c => c.Sum(42, 42));
calculator.Invoke(c => c.RebootComputer()); 
```

类本身是：

```
public class WcfInvoker<TService>
    where TService : ICommunicationObject
{
    readonly Func<TService> _clientFactory;

    public WcfInvoker(Func<TService> clientFactory)
    {
        _clientFactory = clientFactory;
    }

    public T Invoke<T>(Func<TService, T> action)
    {
        var client = _clientFactory();
        try
        {
            var result = action(client);
            client.Close();
            return result;
        }
        catch
        {
            client.Abort();
            throw;
        }
    }

    public void Invoke(Action<TService> action)
    {
        Invoke<object>(client =>
        {
            action(client);
            return null;
        });
    }
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-09-03T10:54:30.413

覆盖客户端的 Dispose() 无需基于 ClientBase 生成代理类，也无需[管理通道创建和缓存](https://msdn.microsoft.com/en-us/library/hh314046(v=vs.110).aspx)！（注意 WcfClient 不是 ABSTRACT 类，是基于 ClientBase 的）

```
// No need for a generated proxy class
//using (WcfClient<IOrderService> orderService = new WcfClient<IOrderService>())
//{
//    results = orderService.GetProxy().PlaceOrder(input);
//}

public class WcfClient<TService> : ClientBase<TService>, IDisposable
    where TService : class
{
    public WcfClient()
    {
    }

    public WcfClient(string endpointConfigurationName) :
        base(endpointConfigurationName)
    {
    }

    public WcfClient(string endpointConfigurationName, string remoteAddress) :
        base(endpointConfigurationName, remoteAddress)
    {
    }

    public WcfClient(string endpointConfigurationName, System.ServiceModel.EndpointAddress remoteAddress) :
        base(endpointConfigurationName, remoteAddress)
    {
    }

    public WcfClient(System.ServiceModel.Channels.Binding binding, System.ServiceModel.EndpointAddress remoteAddress) :
        base(binding, remoteAddress)
    {
    }

    protected virtual void OnDispose()
    {
        bool success = false;

        if ((base.Channel as IClientChannel) != null)
        {
            try
            {
                if ((base.Channel as IClientChannel).State != CommunicationState.Faulted)
                {
                    (base.Channel as IClientChannel).Close();
                    success = true;
                }
            }
            finally
            {
                if (!success)
                {
                    (base.Channel as IClientChannel).Abort();
                }
            }
        }
    }

    public TService GetProxy()
    {
        return this.Channel as TService;
    }

    public void Dispose()
    {
        OnDispose();
    }
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-01-28T00:53:27.213

我这样做的方法是创建一个显式实现 IDisposable 的继承类。这对于使用 gui 添加服务引用（添加服务引用）的人很有用。我只是将这个类放在项目中进行服务引用并使用它而不是默认客户端：

```
using System;
using System.ServiceModel;
using MyApp.MyService; // The name you gave the service namespace

namespace MyApp.Helpers.Services
{
    public class MyServiceClientSafe : MyServiceClient, IDisposable
    {
        void IDisposable.Dispose()
        {
            if (State == CommunicationState.Faulted)
            {
                Abort();
            }
            else if (State != CommunicationState.Closed)
            {
                Close();
            }

            // Further error checks and disposal logic as desired..
        }
    }
} 
```

注意：这只是一个简单的 dispose 实现，您可以根据需要实现更复杂的 dispose 逻辑。

然后，您可以将使用常规服务客户端进行的所有调用替换为安全客户端，如下所示：

```
using (MyServiceClientSafe client = new MyServiceClientSafe())
{
    var result = client.MyServiceMethod();
} 
```

我喜欢这个解决方案，因为它不需要我访问接口定义，我可以`using`按照我的预期使用该语句，同时让我的代码看起来或多或少相同。

您仍然需要处理可能引发的异常，如该线程中其他评论中所指出的那样。

* * *

## 回答 #26

> 赞同：-2
> 
> 时间：2013-05-23T12:03:21.260

您还可以使用 a`DynamicProxy`来扩展该`Dispose()`方法。这样，您可以执行以下操作：

```
using (var wrapperdProxy = new Proxy<yourProxy>())
{
   // Do whatever and dispose of Proxy<yourProxy> will be called and work properly.
} 
```

# windows - 限制访问开发网站的最佳方法是什么？

> ID：573878
> 
> 赞同：6
> 
> 时间：2009-02-21T23:06:27.780
> 
> 标签：windows, security, authentication, web

我有一个正在开发的网站，我现在只想向其他几个人展示。在进入开发站点之前设置windows用户名和使用windows auth提示用户有什么问题吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-21T23:16:49.440

有几种方法，具有不同程度的安全性：

*   不要把它放在互联网上 - 把它放在专用网络上，并使用 VPN 访问它
*   使用 HTTP 身份验证限制访问（如您所建议的那样）。这样做的缺点是它可能会干扰实际站点，如果您使用 HTTP 身份验证或其他类型的身份验证作为应用程序的一部分。
*   根据远程 IP 限制访问。只需允许您希望能够访问它的用户的 IP。
*   使用自定义主机名。将其放在公共 IP 上，但不要发布主机名。这意味着在您的 HOSTS 文件中创建一个条目（或配置您自己的 DNS 服务器，如果可能的话），以便“blah.mysite.com”进入该站点，但这在 Internet 上不可用。显然，您只能在使用该主机名（而不是 IP）时使该站点可访问。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T23:10:31.127

这取决于您所说的“最佳”是什么意思：例如，您的意思是“最简单”还是“最安全”？

最好的方法可能是将它放在您通过 VPN 连接的专用网络上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T23:09:33.517

我经常这样做。我使用 Hamachi 来允许他们访问我的开发箱，这样他们就可以看到发生了什么。他们可以在需要时和/或在我允许时访问它。当他们完成后，我将他们从我的 Hamachi 网络中逐出并更改密码。

Hamachi 是一个软件 VPN。这是到 Hamachi 的链接 - AKA LogMeIn

[滨町](https://secure.logmein.com/products/hamachi/vpn.asp?lang=en)

他们有一个运行良好的免费版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T23:17:27.163

当然，Windows auth 没有任何问题。但是，有几个（不是太大）缺点：

*   您的网站身份验证方案与最终产品不同。
*   你让他们更多地访问他们真正需要的盒子。
*   您自动重新映像机器并重新部署网站更加复杂，因为您必须自动创建 Windows 帐户。

我建议两种选择：

*   在最终网站上执行您计划执行的任何身份验证，并确保所有寻呼机都需要身份验证
*   do a token cookie based auth - send them a link that sets a particular token in a cookie and in your website code add quick check for that token before you even go to the regular user auth

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-21T23:52:58.933

If you aren't married to IIS, and you need developers to be able to change the content, I would consider Apache + SSL + WebDav (aka Web Folders). This will allow you to offer a secure sandbox where developers can change and view the content without having user accounts on the server.

This setup requires some knowledge of Apache so it only makes sense if you are already using Apache or if you frequently need to provide outsiders access to your web server.

First useful link I found on the topic: [http://pascal.thivent.name/2007/08/howto-setup-apache-224-webdav-under.html](http://pascal.thivent.name/2007/08/howto-setup-apache-224-webdav-under.html)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-22T00:47:43.217

Why don't you just set up an NTFS user and assign it to the website (and remove anonymous access)

# c# - 具有强类型索引的多维数组的最佳混合方法

> ID：573882
> 
> 赞同：4
> 
> 时间：2009-02-21T23:07:37.217
> 
> 标签：c#, data-structures, collections

我有一个多维数组。

```
int[][][] MyValues; 
```

我想要的是通过强类型等效项（例如枚举）访问索引。我知道您可以从 Enum 类型中获取枚举值，但我的口味有点啰嗦。

我宁愿有办法强输入索引。

例如：

```
int CarNumber = MyValues[Racetrack.Daytona][Race.Daytona500][Driver.JGordon]; 
```

由于它类似于枚举，这将防止抛出任何越界异常，而且它为所有索引提供了一个很好的人类可读含义。

我已经使用字典方法实现了这一点，但它似乎有点笨拙：

```
Dictionary<Racetrack,Dictionary<Race,<Dictionary<Driver,int>>> =
    new Dictionary<Racetrack,Dictionary<Race,<Dictionary<Driver,int>>>(); 
```

然后我可以通过枚举访问它，但我不太喜欢这种方法。看起来很“丑陋”。

**我正在寻找一些替代方法来表示本质上是一个多维数组，同时使用人类可读的索引器，同时保持类型安全（例如，不能意外地使用驱动程序进行比赛，所以简单地使用 consts 不是好方法）。**

有什么建议么？

这将是一个编译时数组（上面的例子不是真实的，只是一个说明）所以我不必担心数组的插入或删除或其他操作。它将在值、大小和布局上保持不变。

使用具有 const 值的静态类也不是一个好方法，因为它并不强制只能将定义的值集作为索引器传递。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-21T23:20:51.490

在我看来，您想使用[索引器](http://www.csharp-station.com/Tutorials/Lesson11.aspx)而不是数组。假设以下枚举（基于公式 1！）：

```
public enum Track
{
    Spielberg,
    Adelaide,
    Casablanca,
    Liverpool,
    Melbourne,
    Berlin,
    Sakhir,
}

public enum Constructor
{
    BMW,
    Ferrari,
    McLaren,
    Toyota,
    Williams
}

public enum Driver
{
    Hamilton,
    Kovalainen,
    Raikkonen,
    Nakajima,
    Glock
} 
```

基本结构如下：

```
public class Race
{
    int Year { get; set; }
    Track Track { get; set; }
    Driver[] Placings { get; set; }
    public int this[Driver driver] { } // placing by driver
}

public class Results
{
    YearResults this[int index] { }
    DriverResults this[Driver index] { }
    TrackResults this[Track index] { }
    ConstructorResults this[Constructor index] { }
}

public class YearResults
{
    YearDriverResults this[Driver index] { }
} 
```

这当然是部分实现，但您可以通过这种方式使用索引器做一些非常酷的事情。就像您可以使用**任意顺序的**任意值组合访问您的信息一样（假设您设置了所有中间类）。

它比多维数组或元组键字典更冗长，但我认为会给你更优雅的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T23:17:51.280

在 中使用三元组`<Racetrack,Race,Driver>`作为键（定义你自己的类）`Dictionary`怎么样？

如果你真的需要使用一个数组，我认为你不能做得比将它包装在一个只允许使用`Racetrack`, `Race`,`Driver`枚举访问的自定义类中做得更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T23:10:13.297

明显的问题..`List<T>`不适合你吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T23:16:37.600

枚举是否相当小，值为 0...n？如果是这样，您可以使用多维数组但公开索引器。请注意，下面的代码使用矩形数组而不是锯齿状数组，但您可以很容易地调整它。

```
// In a static class somewhere. Just a convenience method to check
// whether a value is defined or not. See comment in indexer.
public static void CheckDefined<T>(this T value, String name)
    where T : struct
{
    if (!Enum.IsDefined(typeof(T), value))
    {
        throw new ArgumentOutOfRangeException(name);
    }
}

// Somewhere else...
private static int GetLength<T>() where T : struct
{
    return Enum.GetValues(typeof(T)).Length;
}

private int[,,] array = new int[GetLength<Racetrack>(), 
                                GetLength<Race>(),
                                GetLength<Driver>()];

public int this Car[Racetrack racetrack, Race race, Driver driver]
{
  get
  {
    // If you don't care about just getting an
    // IndexOutOfRangeException, you could skip these three lines.
    racetrack.CheckDefined("racetrack");
    race.CheckDefined("race");
    driver.CheckDefined("driver");
    return array[(int) racetrack, (int) race, (int) driver);
  }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T23:22:32.127

我不认为字典方法不好，但它并不优雅。如果你为你的字典创建了一个别名，看起来会更好：

```
using RaceSetup = Dictionary<Racetrack,Dictionary<Race,<Dictionary<Driver,int>>>; 
```

或者您可以创建一个从字典派生的类：

```
class RaceSetup : Dictionary<Racetrack,Dictionary<Race,<Dictionary<Driver,int>>>
{} 
```

# oop - 多重继承的用途？

> ID：573913
> 
> 赞同：22
> 
> 时间：2009-02-21T23:32:17.500
> 
> 标签：oop, multiple-inheritance

谁能想到使用多重继承的任何情况？我能想到的每一个案例都可以通过方法操作符来解决

```
AnotherClass() { return this->something.anotherClass; } 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-21T23:49:56.647

全面多重继承的大多数用途是用于混合。举个例子：

```
class DraggableWindow : Window, Draggable { }
class SkinnableWindow : Window, Skinnable { }
class DraggableSkinnableWindow : Window, Draggable, Skinnable { } 
```

ETC...

大多数情况下，最好使用多重继承来做严格的接口继承。

```
class DraggableWindow : Window, IDraggable { } 
```

然后在 DraggableWindow 类中实现 IDraggable 接口。编写好的 mixin 类太难了。

MI 方法的好处（即使您只使用 Interface MI）是您可以将各种不同的 Windows 视为 Window 对象，但可以灵活地创建单个不可能（或更困难）的东西遗产。

例如，在许多类框架中，您会看到如下内容：

```
class Control { }
class Window : Control { }
class Textbox : Control { } 
```

现在，假设您想要一个具有 Window 特性的文本框？就像是可拖动的，有一个标题栏等......你可以做这样的事情：

```
class WindowedTextbox : Control, IWindow, ITexbox { } 
```

在单继承模型中，您不能轻松地从 Window 和 Textbox 继承而不会遇到重复的 Control 对象和其他类型的问题。您还可以将 WindowedTextbox 视为窗口、文本框或控件。

此外，为了解决您的 .anotherClass() 习语，.anotherClass() 返回一个不同的对象，而多重继承允许将同一对象用于不同的目的。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-21T23:40:16.280

我发现多重继承在使用[mixin](http://en.wikipedia.org/wiki/Mixin)类时特别有用。

如维基百科所述：

> 在面向对象的编程语言中，mixin 是一个类，它提供了可以被子类继承的特定功能，但并不意味着独立。

我们的产品如何使用 mixin 类的一个示例是用于配置保存和恢复目的。有一个抽象的 mixin 类，它定义了一组纯虚方法。任何可保存的类都继承自保存/恢复 mixin 类，该类会自动为它们提供适当的保存/恢复功能。

但是它们也可能从其他类继承作为其正常类结构的一部分，因此这些类在这方面使用多重继承是很常见的。

多重继承的一个例子：

```
class Animal
{
   virtual void KeepCool() const = 0;
}

class Vertebrate
{
   virtual void BendSpine() { };
}

class Dog : public Animal, public Vertebrate
{
   void KeepCool() { Pant(); }
} 
```

在进行任何形式的公共继承（单个或多个）时，最重要的是尊重**关系**。如果一个类“是”这些对象之一，则它应该只从一个或多个类继承。如果它只是“包含”这些对象之一，则应改为使用聚合或组合。

上面的例子结构很好，因为狗是动物，也是脊椎动物。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-21T23:48:01.630

*大多数人在将多个接口*应用于类的上下文中使用多重继承。这是 Java 和 C# 等强制执行的方法。

C++ 允许您在类型之间以 is-a 关系相当自由地应用多个基类。因此，您可以将派生对象视为其任何基类。

[LeopardSkinPillBoxHat 指出](https://stackoverflow.com/questions/573913/a-use-for-multiple-inhertance/573928#573928)，另一种用途是混合。[Loki library](http://loki-lib.sourceforge.net/)就是一个很好的例子，来自 Andrei Alexandrescu 的 Modern C++ Design 一书。他使用他所称的*策略类*，通过继承指定给定类的行为或要求。

另一种用途是简化模块化方法，该方法通过在经常令人恐惧的菱形层次结构中使用姐妹类委托来实现[API 独立性。](http://www.gamedev.net/reference/articles/article2103.asp)

MI的用途很多。滥用的可能性更大。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-21T23:50:36.943

Java有接口。C++ 没有。

因此，可以使用多重继承来*模拟*接口特性。如果您是 C# 和 Java 程序员，每次使用扩展基类但也实现一些接口的类*时*，您都承认多重继承在某些情况下可能很有用。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-21T23:52:48.123

我认为这对样板代码最有用。例如，IDisposable 模式对于 .NET 中的所有类都是完全相同的。那么为什么要一遍又一遍地重新键入该代码呢？

另一个例子是 ICollection。绝大多数接口方法的实现完全相同。只有几个方法实际上是您的类所独有的。

不幸的是，多重继承很容易被滥用。人们很快就会开始做一些愚蠢的事情，比如 LabelPrinter 类继承自他们的 TcpIpConnector 类，而不是仅仅包含它。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-21T23:40:26.797

我最近处理的一个案例涉及启用网络的标签打印机。我们需要打印标签，所以我们有一个类 LabelPrinter。这个类有打印几个不同标签的虚拟调用。我还有一个用于 TCP/IP 连接事物的通用类，它可以连接、发送和接收。因此，当我需要实现打印机时，它继承自 LabelPrinter 类和 TcpIpConnector 类。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-21T23:45:53.520

我认为 fmsf 示例是一个坏主意。汽车不是轮胎或发动机。你应该为此使用组合。

MI（实现或接口）可用于添加功能。这些通常被称为 mixin 类。想象一下你有一个 GUI。有处理绘图的视图类和处理拖动的拖放类。如果你有一个对象，你会有一个像

```
class DropTarget{
 public void Drop(DropItem & itemBeingDropped);
...
}

class View{
  public void Draw();
...
}

/* View you can drop items on */
class DropView:View,DropTarget{

} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-22T00:38:02.117

确实，接口的组合（Java 或 C# 之类的）加上转发到帮助程序可以模拟多重继承的许多常见用途（尤其是 mixins）。然而，这是以重复转发代码（并违反 DRY）为代价的。

MI 确实打开了许多困难的领域，最近一些语言设计者已经做出决定，认为 MI 的潜在缺陷大于好处。

类似地，人们可以反对泛型（异构容器确实有效，循环可以用（尾）递归代替）和几乎任何其他编程语言特性。仅仅因为可以在没有特性的情况下工作并不意味着该特性没有价值或无法帮助有效地表达解决方案。

丰富多样的语言和语言系列使我们作为开发人员更容易选择解决手头业务问题的好工具。我的工具箱里有很多我很少使用的东西，但在那些场合我不想把所有东西都当作钉子。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-23T20:29:00.937

*我们的产品如何使用 mixin 类的一个示例是用于配置保存和恢复目的。有一个抽象的 mixin 类，它定义了一组纯虚方法。任何可保存的类都继承自保存/恢复 mixin 类，该类会自动为它们提供适当的保存/恢复功能。*

这个例子并没有真正说明多重继承的用处。这里定义的是一个接口。多重继承也允许您继承行为。这是mixins的重点。

一个例子; 由于需要保持向后兼容性，我必须实现自己的序列化方法。

所以每个对象都有一个像这样的读取和存储方法。

```
Public Sub Store(ByVal File As IBinaryWriter)
Public Sub Read(ByVal File As IBinaryReader) 
```

我也希望能够分配和克隆对象。所以我想在每个物体上都这样。

```
Public Sub Assign(ByVal tObject As <Class_Name>)
Public Function Clone() As <Class_Name> 
```

现在在 VB6 中，我一遍又一遍地重复这段代码。

```
Public Assign(ByVal tObject As ObjectClass)
    Me.State = tObject.State
End Sub

Public Function Clone() As ObjectClass
    Dim O As ObjectClass
    Set O = New ObjectClass
    O.State = Me.State
    Set Clone = 0
End Function

Public Property Get State() As Variant
    StateManager.Clear
    Me.Store StateManager
    State = StateManager.Data
End Property

Public Property Let State(ByVal RHS As Variant)
    StateManager.Data = RHS
    Me.Read StateManager
End Property 
```

请注意，Statemanager 是一个读取和存储字节数组的流。

这段代码重复了几十次。

现在在 .NET 中，我可以通过结合使用泛型和继承来解决这个问题。我的 .NET 版本下的对象从 MyAppBaseObject 继承时会获得分配、克隆和状态。但我不喜欢每个对象都继承自 MyAppBaseObject 的事实。

我宁愿只是混合分配克隆界面和行为。更好的是单独混合读取和存储界面，然后能够混合分配和克隆。在我看来，这将是更简洁的代码。

但是当我使用接口时，我重用行为的时间已经相形见绌了。这是因为大多数对象层次结构的目标不是重用行为，而是精确定义不同对象之间的关系。设计用于哪些接口。因此，虽然 C#（或 VB.NET）有一些能力来做到这一点会很好，但在我看来，这并不是一个阻碍。

这甚至是一个问题的全部原因是 C++ 在谈到接口与继承问题时一开始就搞砸了。当 OOP 出现时，每个人都认为行为重用是首要任务。但这被证明是一种嵌合体，仅对特定情况有用，例如制作 UI 框架。

后来，mixin（以及面向方面编程中的其他相关概念）的想法得到了发展。发现多重继承在创建混合中很有用。但是 C# 是在这被广泛认可之前开发的。可能会开发一种替代语法来执行此操作。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-23T20:56:22.057

我怀疑在 C++ 中，MI 最好用作框架的一部分（前面讨论过的混合类）。我唯一确定的是，每次我尝试在我的应用程序中使用它时，我最终都会后悔选择，并经常将其撕掉并用生成的代码替换它。

MI 是另一种“如果你真的需要就使用它，但要确保你真的需要它”的工具。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-21T23:46:08.810

以下示例主要是我在 C++ 中经常看到的内容：有时由于您需要的实用程序类，它可能是必要的，但由于它们的设计不能通过组合使用（至少效率不高或不会使代码比回退更混乱）多重继承）。一个很好的例子是你有一个抽象基类 A 和一个派生类 B，而 B 也需要是一种可序列化的类，所以它必须派生自另一个名为 Serializable 的抽象类。可以避免 MI，但是如果 Serializable 只包含一些虚拟方法并且需要对 B 的私有成员进行深度访问，那么为了避免进行友元声明并将 B 的内部访问权泄露给某些人，可能值得混淆继承树助手组合类。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-30T00:46:49.213

我今天必须使用它，实际上...

这是我的情况 - 我有一个在内存中表示的域模型，其中 A 包含零个或多个 Bs（表示在一个数组中），每个 B 有零个或多个 Cs，以及 Cs 到 Ds。我无法改变它们是数组的事实（这些数组的来源来自构建过程中自动生成的代码）。每个实例都需要跟踪它们所属的父数组中的哪个索引。它们还需要跟踪其父实例的实例（关于原因的细节太多了）。我写了这样的东西（还有更多，这在语法上是不正确的，这只是一个例子）：

```
class Parent
{
    add(Child c)
    {
        children.add(c);
        c.index = children.Count-1;
        c.parent = this;
    }
    Collection<Child> children
}

class Child
{
    Parent p;
    int index;
} 
```

然后，对于域类型，我这样做了：

```
class A : Parent
class B : Parent, Child
class C : Parent, Child
class D : Child 
```

实际实现是在带有接口和泛型的 C# 中实现的，如果语言支持它，我不能像我那样做多重继承（必须完成一些复制粘贴）。所以，我想我会搜索一下，看看人们对多重继承的看法，我得到了你的问题；）

我无法使用您的 .anotherClass 解决方案，因为实现了 add for Parent （引用这个 - 我希望这不是其他类）。

它变得更糟，因为生成的代码有一个子类，它既不是父母也不是孩子……更多复制粘贴。

# python - 在 python 中使用 wget（错误代码帮助我）

> ID：573914
> 
> 赞同：0
> 
> 时间：2009-02-21T23:32:24.817
> 
> 标签：python

这是我的代码。

```
import os, sys
if len(sys.argv) != 2:
     sys.exit(1)

h = os.popen("wget -r %s") % sys.argv[1]
fil = open("links.txt","w")
dir = os.listdir("%s") % sys.argv[1]

for file in dir:
     print file.replace("@","?")
     fil.write("%s/"+file.replace("@","?")) % sys.argv[1]
     fil.write("\n")
h.close() 
```

运行它，就像这个 python project.py [http://google.com](http://google.com)

给我错误代码。

```
1.py:5 RuntimeWarning: tp_compare didnt return -1 or -2 for exception
h = os.popen("wget -r %s") % sys.argv[1]
Traceback (most recent call last):
File "1.py" line 5, in <module>
h = os.popen("wget -r %s") % sys.argv[1]
TypeError: unsupported operand type<s> for %: 'file' and 'str' 
```

我怎么了。（仍在学习python）任何解决方案/提示？

我不解释代码，我想你明白我想做什么

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-21T23:42:18.803

1.  h = os.popen("wget -r %s" % sys.argv[1])

2.  使用 subprocess 模块，os.popen 已过时

3.  python有urllib，你可以考虑用它来拥有纯python代码

4.  有pycurl

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T23:40:19.137

我想你想要：

```
h = os.popen("wget -r %s" % sys.argv[1]) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T23:42:11.347

您将`%`运算符放在错误的位置：您需要将其直接放在格式字符串之后：

```
h = os.popen("wget -r %s" % sys.argv[1])
...
dir = os.listdir("%s" % sys.argv[1])
...
fil.write(("%s/"+file.replace("@","?")) % sys.argv[1]) 
```

或者，由于您只是在使用`%s`，因此只需进行简单的字符串连接：

```
h = os.popen("wget -r " + sys.argv[1])
...
dir = os.listdir(sys.argv[1])
...
fil.write(sys.argv[1] + "/" + file.replace("@","?")) 
```

# java - 使用 keyPressed 检测键盘方向键

> ID：573918
> 
> 赞同：1
> 
> 时间：2009-02-21T23:34:04.643
> 
> 标签：java, swing, keyboard, key, direction

万事如意，

在这里了解到 Java 控制台不太支持键盘输入后，我切换到了 Swing 和 AWT。我现在的问题是如何检测何时使用键盘方向键（非数字键盘）。我的代码（如下）仅在按下向下、向上、向左、向右键时打印一个“小框”字符。例如，这个小方框字符与 CTRL 和 ALT 键使用的字符没有什么不同。有谁知道键盘方向键的实际标识是什么，以便我可以在我的应用程序中为它们编码？

```
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;

public class KeyChecker extends JFrame {
    JLabel keyLabel = new JLabel("Hit any key");

    public KeyChecker() {
        super("Hit a Key");
        setSize(300, 200);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(new FlowLayout(FlowLayout.CENTER));
        KeyMonitor monitor = new KeyMonitor(this);
        setFocusable(true);
        addKeyListener(monitor);
        add(keyLabel);
        setVisible(true);
    }

    public static void main(String[] arguments) {
        new KeyChecker();
    }
}

class KeyMonitor extends KeyAdapter {
    KeyChecker display;

    KeyMonitor(KeyChecker display) {
        this.display = display;
    }

    public void keyPressed(KeyEvent event) {
        display.keyLabel.setText("" + event.getKeyChar());
        display.repaint();
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T00:03:37.347

你应该做的是查看*虚拟键码* 而不是键字符，在`keyPressed`. 像这样：

```
public void keyPressed(KeyEvent event) {
    switch (event.getKeyCode()) {
        case KeyEvent.VK_UP:
            // up arrow
            break;
        case KeyEvent.VK_DOWN:
            // down arrow
            break;
        case KeyEvent.VK_RIGHT:
            // right arrow
            break;
        case KeyEvent.VK_LEFT:
            // left arrow
            break;
    }
} 
```

有关完整信息，请参阅[http://java.sun.com/javase/6/docs/api/java/awt/event/KeyEvent.html](http://java.sun.com/javase/6/docs/api/java/awt/event/KeyEvent.html)。

# c# - 何时使用 Request.Cookies 而不是 Response.Cookies？

> ID：573922
> 
> 赞同：61
> 
> 时间：2009-02-21T23:37:07.723
> 
> 标签：c#, asp.net

我是否在页面事件（例如加载）时使用响应，因为这是来自 ASP.NET 的响应，并在按下按钮时请求，因为这是一个响应到 ASP.NET 进行处理的响应？或者还有更多？

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2009-02-21T23:57:49.937

它们是 2 种不同的东西，一种是**SAVES** [Response]，另一种是**READS** [Request]

在 Cookie 中（信息学方面）:) 您将一个小文件保存**一段时间**，其中包含**字符串类型的对象**

在 .NET 框架中，您[保存一个 cookie](http://msdn.microsoft.com/en-us/library/aa287547(VS.71).aspx)：

```
HttpCookie myCookie = new HttpCookie("MyTestCookie");
DateTime now = DateTime.Now;

// Set the cookie value.
myCookie.Value = now.ToString();
// Set the cookie expiration date.
myCookie.Expires = now.AddMinutes(1);

// Add the cookie.
Response.Cookies.Add(myCookie);

Response.Write("<p> The cookie has been written."); 
```

您编写的 cookie 可以使用一分钟……通常我们现在就这样做*。AddMonth(1)*这样您就可以保存一个 cookie 整整一个月。

要[检索 cookie](http://msdn.microsoft.com/en-us/library/aa287533(VS.71).aspx)，请使用请求（您正在请求），例如：

```
HttpCookie myCookie = Request.Cookies["MyTestCookie"];

// Read the cookie information and display it.
if (myCookie != null)
   Response.Write("<p>"+ myCookie.Name + "<p>"+ myCookie.Value);
else
   Response.Write("not found"); 
```

**记住：**

要删除 Cookie，没有直接的代码，诀窍是**保存**相同的 Cookie 名称和已经过的过期日期，例如**now.AddMinutes(-1)**

这将删除 cookie。

如您所见，每次 cookie 的生命周期到期时，该文件都会自动从系统中删除。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-02-21T23:45:50.790

在 Web 应用程序中，请求来自浏览器，响应是服务器发回的内容。从浏览器验证 cookie 或 cookie 数据时，您应该使用 Request.Cookies。当您构建要发送到浏览器的 cookie 时，您需要将它们添加到 Response.Cookies。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-02-23T00:48:47.200

写入 cookie 时，请使用 Response，但读取可能取决于您的情况。通常，您从 Request 中读取，但如果您的应用程序试图获取刚刚写入或更新的 cookie，并且没有发生与浏览器的往返，您可能需要从 Response 中读取它。

我使用这种模式已经有一段时间了，它对我来说效果很好。

```
public void WriteCookie(string name, string value)
{
    var cookie = new HttpCookie(name, value);
    HttpContext.Current.Response.Cookies.Set(cookie);
}

public string ReadCookie(string name)
{
    if (HttpContext.Current.Response.Cookies.AllKeys.Contains(name))
    {
        var cookie = HttpContext.Current.Response.Cookies[name];
        return cookie.Value;
    }

    if (HttpContext.Current.Request.Cookies.AllKeys.Contains(name))
    {
        var cookie = HttpContext.Current.Request.Cookies[name];
        return cookie.Value;
    }

    return null;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-22T00:55:06.570

cookie 来自 Request.Cookies 集合中的浏览器。那是您阅读发送的 cookie 的地方。

要将 cookie 发送回浏览器，请将它们放在 Response.Cookies 集合中。

如果要删除 cookie，则必须通过发送过期日期已过的 cookie 来告诉浏览器将其删除。浏览器正在使用客户端计算机的本地时间，因此如果您使用服务器时间来创建日期，请确保至少减去一天以确保它实际上已通过客户端本地时间。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-23T01:10:37.240

当我在 .NET 中创建或更新 cookie 时，我通常对请求和响应 cookie 集合都执行此操作。这样，您可以确定如果您尝试在页面请求序列的下方进一步读取 cookie，它将获得正确的信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-22T10:37:01.253

安德鲁的代码在“AllKeys.Contains”方法中给出了错误。所以我纠正了一点..

```
public void WriteCookie(string strCookieName, string strCookieValue)
    {
        var hcCookie = new HttpCookie(strCookieName, strCookieValue);
        HttpContext.Current.Response.Cookies.Set(hcCookie);
    }

    public string ReadCookie(string strCookieName)
    {    
        foreach (string strCookie in HttpContext.Current.Response.Cookies.AllKeys)
        {
            if (strCookie == strCookieName)
            {
                return HttpContext.Current.Response.Cookies[strCookie].Value;
            }
        }         

        foreach (string strCookie in HttpContext.Current.Request.Cookies.AllKeys)
        {
            if (strCookie == strCookieName)
            {
                return HttpContext.Current.Request.Cookies[strCookie].Value;
            }
        }

        return null;
    } 
```

# sql-server - SQL Server Express 对于开发人员来说是否足够好，或者他们应该获得开发人员版本？

> ID：573927
> 
> 赞同：30
> 
> 时间：2009-02-21T23:39:42.240
> 
> 标签：sql-server

只是想知道开发人员使用 SQL Server 2005/2008 开发人员版而不是 Visual Studio 附带的捆绑 SQL Server Express 版是否值得。我说的是网站的初始开发，您需要创建 SQL 脚本来生成表和类似的东西。我知道使用 Express 很容易将`.mdf`文件添加到您的项目和程序中，但是安装开发人员版本并针对“真实”数据库进行编程不是更好，这将模仿您将在生产中使用的内容? 这样，如果您使用 VS Professional 并且可以创建“数据库项目”，则可以包含所有创建脚本并在生产中运行它们以重新创建环境。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-21T23:43:08.817

如果您可以访问它，最好使用 Developer Edition，因为它支持更多功能和更大的数据库。例如，如果您想将一个 50gb 的数据库从您的生产服务器恢复到您的工作站上进行测试，您将需要 Developer Edition。

另一个示例是，如果您正在使用分区、压缩或资源调控器等仅限企业的功能。这些功能在 Express 中不可用，但在 Developer Edition 中可用。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-22T00:18:29.527

如果它对生产足够好，那么它在开发中怎么可能不足。并且 SQL Express 非常有能力处理公平负载（这种负载在几年前会对严重的硬件造成压力）。

SQL Server Express 不需要许可，但具有较少的功能集。

针对完整的 SQL Server（并且开发人员版与企业版相匹配）进行开发总是会让您有机会依赖生产版中没有的某些功能。

至少您的所有测试（包括单元测试）都应该针对要在生产中使用的版本进行。

在这个问题中，由于“完整”版本的目标是生产，因此开发人员版本应该是一个很好的匹配，如果您要针对标准进行部署，请注意企业功能。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2018-02-07T21:51:22.097

就个人而言，我认为您的开发环境应该尽可能地类似于您的生产环境。

**SQL Server Express 版本** 有很多限制，如数据库大小、仅支持一个处理器等。它是 SQL Server 的“精简版”

**SQL Server Developer 版** 基本上是企业版，但不能用于生产。

请注意，如果您的后端数据库的成功依赖于使用企业功能进行开发，并且您希望在生产中使用相同的功能，则需要企业许可证。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-22T23:25:41.627

这取决于你在做什么。一般来说，我会说这很好。如果你能得到一份 Developer 的副本，我会推荐这条路线，但你的大部分工作都可以在 Express 中完成。

Express 具有基本的报告功能和高级服务。如果您超出了产品中的基本报告，您将不得不向上移动。你也有服务经纪人。但是，您将没有 Analysis Services（无数据仓库）或 SSIS（无 ETL）。如果你需要这些功能中的任何一个，你必须去开发者。

您也不会拥有某些 BI 功能，因为 Express Manager 缺少完整 SQL Management Studio 和 BI Developer 中的许多位。如果您需要这些，您将需要 SQL Server Developer。

# java - 如何在 OpenOffice 中创建侧边栏面板？

> ID：573936
> 
> 赞同：2
> 
> 时间：2009-02-21T23:42:57.600
> 
> 标签：java, user-interface, sdk, panel, openoffice.org

我想创建一个添加侧边栏的 OpenOffice.org 插件。我已经成功安装了 OpenOffice.org、OpenOffice.org SDK 和 NetBeans OpenOffice 插件。

我熟悉 Java、AWT 和 Swing，所以不需要向我解释这些概念。

现在，我想在 OpenOffice.org Writer 应用程序中创建一个侧边栏面板（或 JPanel）。我怎样才能做到这一点？它将在左侧并填充所有可用高度（同时使用固定宽度）。

关于如何实现这一点的任何想法？我过去没有 OpenOffice.org 插件的经验。先感谢您。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T13:38:08.517

这目前无法通过 OpenOffice.org API 实现。您可以创建菜单、工具栏和对话框。您不能通过 UNO 创建可停靠窗口或面板。请参阅：[开发指南中的 GUI 章节](http://wiki.services.openoffice.org/wiki/Documentation/DevGuide/GUI/Graphical_User_Interfaces)。

通过 API 公开此功能正在积极开发中，我建议您加入 api-dev@openoffice.org 邮件列表以掌握最新动态。

您要求的特定功能已在此处讨论过，并且建议将在 OpenOffice 3.0 的未来更新中提供该功能。请参阅[列表存档中的帖子](http://api.openoffice.org/servlets/ReadMsg?list=dev&msgNo=20716)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T02:07:04.383

我不知道是否有一个简单的答案。OO.o[在这里提供他们的开发指南](http://wiki.services.openoffice.org/wiki/Documentation/DevGuide/OpenOffice.org_Developers_Guide)。一旦您按照他们的规范创建 UNO 组件，它就会出现，您可以使用：

> 可以从用户界面调用用 Java 或 C++ [然后] 编写的任意对象，显示它们自己的 GUI，并与整个应用程序一起工作。

这听起来像你想要做的。希望这可以帮助！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-02-09T20:50:45.963

从 4.0 版开始就可以了。请参阅[https://wiki.openoffice.org/wiki/Sidebar](https://wiki.openoffice.org/wiki/Sidebar)

# c - 你如何写入缓冲区然后写入文件

> ID：573937
> 
> 赞同：2
> 
> 时间：2009-02-21T23:43:03.450
> 
> 标签：c, matlab, buffer, mex

我正在尝试从 matlab 中写入一些 STL 数据，我正在尝试通过编写 MEX 文件（用 C 编写的 matlab DLL）来做到这一点目前我有一个循环，只是通过我的数据写出 stl 语法与花车。

...

```
for(m=0;m<colLen;m++)
{

    res = m % 3;
    if(res == 0)
    {   
        fprintf(fp, "\tfacet normal %f %f %f \n",
                normalValues[(x*nvcolLen)+0], normalValues[(x*nvcolLen)+1], normalValues[(x*nvcolLen)+2]);
        fprintf(fp,"\t\touter loop\n" );
        flag = 0;
        x++;
    }

    fprintf(fp, "\t\t\tvertex ");

    for(n=0;n<rowLen;n++)
    {
        fprintf(fp, "%f ", xValues[m*rowLen+n]);

    }

    fprintf(fp,"\n");

    flag++;

    if (flag == 3)
    {
        fprintf(fp, "\t\tendloop\n\tendfacet\n");
        flag = 0;
    }

} 
```

...

我想在 MEX 文件中执行此操作的主要原因是因为它编译后速度更快。我正在阅读一本 C++ 书，“Sams Teach Yourself C++ in One our day”，在第 645 页中，他们谈到了使用缓冲区来加快写入磁盘的速度。一旦缓冲区填满，写入数据，刷新它，然后再做一次。他们并没有真正展示任何关于如何做到这一点的代码，这是使用 C++ 的流。

我将如何在 C 中处理这个问题？我是否只需制作一个固定大小的 char* 缓冲区，然后以某种方式检查它何时已满并使用 fwrite() 将其写入文件，刷新它，重新开始？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T23:48:53.747

fprintf 会自动为您缓冲输出。如果有问题，请向我们展示打开文件 (fp) 的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T23:53:49.073

基本上，你想自己做，你几乎完全按照你写的那样做：制作一个`char*`缓冲区，跟踪其中的字符数（通过计算你放入其中的字符）以及它是否已满（或几乎-full)，将其刷新到文件中。

但是，这对于 C 流来说应该不是问题，因为它们通常会进行缓冲。您甚至可以使用函数[setbuf 等来控制这种缓冲。](http://www.manpagez.com/man/3/setbuf/)

# quickbooks - 将 Google Checkout 中的数据导入 Quickbooks？

> ID：573950
> 
> 赞同：2
> 
> 时间：2009-02-21T23:46:46.077
> 
> 标签：quickbooks, google-checkout

有什么方法可以将 Google Checkout 中的数据导入 Quickbooks？（或其他会计包）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T00:26:23.753

是的 - 您可以从 Google 导出 CSV 并将其导入 Quickbooks（并可能导入其他会计软件包）：

[Google Checkout - 报告和对帐](http://checkout.google.com/support/sell/bin/answer.py?answer=134476&topic=8951)

[QuickBooks - 用于导入 Excel 和 CSV 文件的工具](http://support.quickbooks.intuit.com/support/Pages/KnowledgeBaseArticle/1005472)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T17:39:15.000

您还可以使用 QuickBooks SDK 构建一个集成应用程序，该应用程序可以自动将数据推送到 QuickBooks。

您可以使用 Google Checkout API 提取数据，然后使用 QuickBooks SDK qbXML 请求将数据推送到 QuickBooks。您可以自动化它/安排它，这样您就不必每天手动进行 CSV 导入。

[QuickBooks SDK](http://developer.intuit.com/)

[QuickBooks 网络连接器](http://marketplace.intuit.com/webconnector/)

[开源 QuickBooks PHP 框架](https://idnforums.intuit.com/messageview.aspx?catid=56&threadid=9164)

[开源 QuickBooks .NET 框架](https://idnforums.intuit.com/messageview.aspx?catid=56&threadid=11040&enterthread=y)

[QuickBooks 和 Ruby](http://qbruby.rubyforge.org/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-29T00:45:43.870

我找到了一个网站[http://www.ktsolutionsllc.com](http://www.ktsolutionsllc.com)，它声明有一个集成组件，可以集成 google checkout 和 quickbooks。我会试试看！

谢谢。

# ios - iPhone SDK：loadView 和 viewDidLoad 有什么区别？

> ID：573958
> 
> 赞同：137
> 
> 时间：2009-02-21T23:52:12.180
> 
> 标签：ios, objective-c, iphone, uiview

在 iPhone 应用程序中使用视图和视图控制器时，谁能解释 loadView 和 viewDidLoad 之间的区别？

我个人的情况是，我从代码中构建所有视图，我不会也不会使用 Interface Builder，如果这有什么不同的话。

我发现当我将初始化代码添加到 loadView 时，我经常会得到一个无限的堆栈跟踪，所以我通常会在 viewDidLoad 中构建我所有的子视图......但我真的不清楚每个人何时执行，并且放置初始化代码的更合适的位置是什么。最完美的是初始化调用的简单图表。

谢谢！

* * *

## 回答 #1

> 赞同：200
> 
> 时间：2009-02-22T03:50:36.227

我可以猜到这里可能是什么问题，因为我已经做到了：

> 我发现当我将初始化代码添加到 loadView 时，我经常会得到一个无限的堆栈跟踪

**不要在 -loadView 中阅读 self.view。**只*设置*它，不要*得到*它。

如果当前未加载视图，则 self.view属性访问器*调用-loadView。*有你的无限递归。

在 -loadView 中以编程方式构建视图的常用方法，如 Apple 的 pre-Interface-Builder 示例所示，更像是这样：

```
UIView *view = [[UIView alloc] init...];
...
[view addSubview:whatever];
[view addSubview:whatever2];
...
self.view = view;
[view release]; 
```

我不怪你不使用 IB。我对所有 Instapaper 都坚持使用这种方法，并且发现自己比处理 IB 的复杂性、界面怪癖和意想不到的幕后行为更舒服。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-02-21T23:56:28.347

`loadView`是`UIViewController`实际加载视图并将其分配给`view`属性的方法。`UIViewController`如果您想以编程方式设置`view`属性，这也是子类将覆盖的位置。

`viewDidLoad`是加载视图后调用的方法。这是在调用 loadView 之后调用的。这是一个您可以覆盖和插入代码的地方，这些代码在视图加载后会进行进一步的初始设置。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2013-08-21T09:36:10.390

```
viewDidLoad() 
```

当您从 NIB 加载视图并希望在启动后执行任何自定义时使用

```
LoadView() 
```

当您想以编程方式创建视图时使用（不使用 Interface Builder）

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-22T00:01:16.823

只需添加一些代码示例来演示 NilObject 所说的内容：

```
- (void)loadView
{
    // create and configure the table view
    myTableView = [[UITableView alloc] initWithFrame:[[UIScreen mainScreen] applicationFrame] style:UITableViewStyleGrouped];   
    myTableView.delegate = self;
    myTableView.dataSource = self;
    myTableView.scrollEnabled = NO;
    self.view = myTableView;

    self.view.autoresizesSubviews = YES;
}

- (void)viewDidLoad 
{
  self.title = @"Create group";

  // Right menu bar button is to Save
  UIBarButtonItem *saveButtonItem = [[UIBarButtonItem alloc] initWithTitle:@"Save" style:UIBarButtonItemStyleDone target:self action:@selector(save)];
  self.navigationItem.rightBarButtonItem = saveButtonItem;
  [saveButtonItem release];
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-03-02T06:06:55.153

为了防止在读取 self.view 时发生无限循环，请在加载视图时调用该类的超级实现。超级实现会为你分配一个新的 UIView。

```
- (void) loadView {
[super loadview];

// init code here...

[self.view addSubView:mySubview1]; //etc..

} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-19T11:34:20.130

使用 loadView 的最简单方法是制作某种类型的基本视图控制器，例如 MyBaseViewController，它是 UIViewController 的子类。在它的 loadView 方法中以这种方式创建视图：

```
-(void) loadView {
    if ([self viewFromNib]) {
        self.view = [self viewFromNib];
    } else {
        self.view = [[[UIView alloc] initWithFrame:[[UIScreen mainScreen] bounds]] autorelease];
    }
    self.view.autoresizingMask = UIViewAutoresizingFlexibleHeight;
    self.view.backgroundColor = [UIColor whiteColor];
} 
```

当您需要制作一些视图控制器时，您只需使用 MyBaseViewController 的子类，在它的 loadView 控制器中，您只需像这样调用 [super loadView]

```
//sucblass loadView
-(void) loadView {
    [super loadView];

    //rest of code like this..
    UILabel *myLabel = [[UILabel alloc] initWithFrame:myFrame];
    [self.view addSubview:myLabel];
    [myLabel release];
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-12-04T11:12:48.993

`loadView()`当您的控制器被要求创建其`self.view`. 你可以自己做

```
self.view = [UIView alloc] init...]; 
```

或者您的控制器的父 UIController 类已经有一个方法名称`-loadView()`，它将您的 self.view 初始化为空白视图。然后你可以打电话

```
[super loadView]; 
```

我真的推荐第二种方法，因为它鼓励继承。仅当您的视图控制器不是直接从 UIViewController 继承时。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-07-06T09:35:32.247

苹果在 viewDidLoad 上给出的定义中提到，它是在控制器的视图加载到内存后调用的。简单来说，它是第一个加载的方法。

您可能在想，这种方法在什么条件下才能得到充分利用？答案是，基本上你希望应用程序首先加载的任何内容。例如，您可能想要不同的背景颜色，而不是白色，您可以选择蓝色。

# algorithm - 快速排序术语？（如脂肪枢轴）

> ID：573961
> 
> 赞同：1
> 
> 时间：2009-02-21T23:53:11.710
> 
> 标签：algorithm, language-agnostic, quicksort

有谁知道完整的技术词汇来描述所有不同版本的快速排序？

我知道的一个是“胖枢轴”[A]（其中与枢轴匹配的所有项目都放置在子数组的中间，并被排除在进一步的排序之外）。

我想知道的是，当一个元素（枢轴）放在中间并从排序[B] 中排除时，以及零元素放在中间[C] 的位置。

下面是每个分区的示例：
输入子数组是 5,3,2,9,5,7
[A] 给出 [3,2],5,5,[9,7]
[B] 给出 [3,2 ],5,[9,5,7]
[C] 给出 [3,2,5],[9,5,7]

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T23:55:10.927

嗯，[快速排序](http://en.wikipedia.org/wiki/Quicksort)？

以下是有关[快速排序变体](http://www.ddj.com/cpp/184403848)的一些信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-28T11:34:13.667

在我在各种教科书中读到的描述中，变体没有通用的指定名称。它们标有摘要描述，并且确切的标签会有所不同。例如，您提到的“胖枢轴”有时称为“三元分割”，有时称为“三路分区”，有时称为“荷兰国旗算法”。涉及罗伯特·塞奇威克的不同作品至少使用了其中的两个。

# java - 如何打印java类垃圾收集事件？

> ID：573970
> 
> 赞同：9
> 
> 时间：2009-02-21T23:57:12.433
> 
> 标签：java, eclipse, classpath

```
java版本“1.5.0_14”
Java(TM) 2 运行时环境，标准版（内部版本 1.5.0_14-b03）
Java HotSpot(TM) 服务器虚拟机（内部版本 1.5.0_14-b03，混合模式）

```

我正在尝试调试一个 NullPointerException，因为我将引用传递给静态定义的字段。更具体地说，我在 Drools3 工作内存实例上设置了一个全局变量。

```
workingMemory.setGlobal("log", workingMemorieslog); 
```

我的假设是静态定义字段的类正在被垃圾收集。（接收类必须使用 Wea​​kReference 或类似的东西，我真的不知道）

你会建议如何调试这个？我认为，如果我能准确地知道 JVM 的 GC 何时卸载类/类的实例，那么我可以缩小错误行为的原因。（如果不是事件的确切时间，至少可以表明确实发生了某些事情）。

谢谢你，马克西姆。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-22T00:10:01.327

要跟踪 GC 活动，请将其添加到 java 命令：

> -verbose:gc -XX:+PrintGCTimeStamps -XX:+PrintGCDetails

您得到的 NPE 可能是您传递了空值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T00:14:17.790

为什么不将课程保留在内存中，然后看看它是否仍然发生，如果确实如此，那么您的问题就出在其他地方。如果不是，那么您知道问题在于垃圾收集。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T16:23:16.883

事实证明，日食是这里的主要问题。

我会解释：

为了测试性能，我将我们的 webapp 包装在 main() 方法中。我们使用了大量的 3rd 方代码，即 Apache commons-pool。

事实证明，我们有多个版本的 jar 分布在项目（eclipse 项目）中。我使用这些项目的应用程序有 commons-pool-1.3，另一个项目有 commons-pool-1.2。

当使用 servlet 容器 (Tomcat6) 加载时，webapp 类加载器具有第一优先级，因此它总是加载 webapp 版本。当我使用 main() eclipse 启动应用程序时，将依赖的项目 jars 导出到当前项目中的 -classpath 中并不是很明智的行为。

冲突发生在 2 个版本的 commons-pool 之间，这导致了未定义的行为 - 在对象借用时，有时决定创建一个新对象。我没有查看实现代码，我认为这与 GenericKeyedObjectPool （有问题的类）持有的静态映射有关。因为创建了一个新实例，所以它确实包含对提到的全局的空引用。

我运气的解决方案相当简单，commons-pool 仅由我的 web 应用程序使用，因此我可以从所有引用的项目中删除它，否则我想我会尝试将它们全部升级到一个版本。如果我不能做任何一个，我真的不知道我会做什么。这是 eclipse 的一个非常奇怪的默认设置。

感谢您的阅读和帮助。

// ps. 3 days. That's the time I've spend on understanding what the hell I did wrong in my servlet replacement code. Turns out I'm not even the problem. :P

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T00:06:09.637

你有堆栈跟踪吗？

您是否尝试过进入“setGlobal”方法（假设您有代码）以查看发生了什么？

# ios - 如何更改 UIPickerView 高度

> ID：573979
> 
> 赞同：118
> 
> 时间：2009-02-22T00:04:26.363
> 
> 标签：ios, iphone, cocoa-touch, uikit, uipickerview

是否可以更改 UIPickerView 的高度？一些应用程序的 PickerViews 似乎较短，但设置较小的框架似乎不起作用，并且框架在 Interface Builder 中被锁定。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-02-23T06:41:58.100

很明显，Apple 并没有特别邀请使用默认高度的`UIPickerView`，但我发现您可以通过完全控制并在创建时传递所需的帧大小来实现视图**高度的更改，例如：**

`smallerPicker = [[UIPickerView alloc] initWithFrame:CGRectMake(0.0, 0.0, 320.0, 120.0)];`

您会发现，在不同的高度和宽度上，都会出现视觉故障。显然，这些故障要么需要以某种方式解决，要么选择不显示它们的其他尺寸。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2010-07-09T13:28:31.697

以上方法均不适用于 iOS 4.0

pickerView 的高度不再可重新调整大小。如果您尝试在 4.0 中更改选择器的框架，则会有一条消息被转储到控制台：

```
-[UIPickerView setFrame:]: invalid height value 66.0 pinned to 162.0 
```

我最终做了一些非常激进的事情来获得在 OS 3.xx 和 OS 4.0 中都可以使用的较小选择器的效果。我将选择器保留为 SDK 决定的任何大小，而是在我的背景图像上制作了一个透明的透明窗口，通过该窗口可以看到选择器。然后简单地将选择器放在我的背景 UIImageView 后面（Z 顺序），这样只有一部分选择器是可见的，这由我背景中的透明窗口决定。

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2011-10-06T09:42:10.347

的有效高度只有三个`UIPickerView (162.0, 180.0 and 216.0)`。

您可以使用`CGAffineTransformMakeTranslation`和`CGAffineTransformMakeScale`函数来适当地调整选择器以方便您使用。

例子：

```
CGAffineTransform t0 = CGAffineTransformMakeTranslation (0, pickerview.bounds.size.height/2);
CGAffineTransform s0 = CGAffineTransformMakeScale       (1.0, 0.5);
CGAffineTransform t1 = CGAffineTransformMakeTranslation (0, -pickerview.bounds.size.height/2);
pickerview.transform = CGAffineTransformConcat          (t0, CGAffineTransformConcat(s0, t1)); 
```

上面的代码将选择器视图的高度更改为一半，并将其重新定位到确切的**(Left-x1, Top-y1)**位置。

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2011-06-16T04:55:12.220

尝试：

```
pickerview.transform = CGAffineTransformMakeScale(.5, 0.5); 
```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2011-07-21T19:39:50.080

在 iOS 4.2 和 4.3 中，以下工作：

```
UIDatePicker *datePicker = [[UIDatePicker alloc] init];
datePicker.frame = CGRectMake(0, 0, 320, 180);
[self addSubview:datePicker]; 
```

以下不起作用：

```
UIDatePicker *datePicker = [[UIDatePicker alloc] initWithFrame:CGRectMake(0, 0, 320, 180)];
[self addSubview:datePicker]; 
```

我在应用商店中有一个带有 3 行日期选择器的应用。我认为可能已经阻止了高度变化，因为您在日期选择器的边框下看到了文本，但这也发生在正常的 216 高度日期选择器上。

哪个是错误？你的猜测和我的一样好。

`UIDatePicker`（和`UIPickerView`）162.0、180.0 和 216.0也有 3 个有效高度。如果您将`UIPickerView`高度设置为其他任何值，您将在 iOS 设备上调试时在控制台中看到以下内容。

```
2011-09-14 10:06:56.180 DebugHarness[1717:707] -[UIPickerView setFrame:]: invalid height value 300.0 pinned to 216.0 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2015-06-11T15:09:13.753

从 iOS 9 开始，您可以自由更改`UIPickerView`的宽度和高度。无需使用上述转换技巧。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-05-29T20:11:59.967

我发现您*可以*编辑 UIPickerView 的大小 - 只是不能使用界面生成器。使用文本编辑器打开 .xib 文件并将选择器视图的大小设置为您想要的任何值。界面生成器不会重置大小，它似乎可以工作。我确定苹果锁定尺寸是有原因的，所以你必须尝试不同的尺寸才能看到什么有效。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2012-07-27T15:11:53.113

## 好处：

1.  使 setFrame 的`UIPickerView`行为像它应该的那样
2.  您的内部没有转换代码`UIViewController`
3.  用于`viewWillLayoutSubviews`重新缩放/定位`UIPickerView`
4.  在 iPad 上工作，无需`UIPopover`
5.  超类总是收到一个有效的高度
6.  适用于 iOS 5

## 缺点：

1.  要求您进行子类化`UIPickerView`
2.  需要使用`pickerView viewForRow`来撤消子视图的转换
3.  UIAnimations 可能不起作用

## 解决方案：

子类 UIPickerView 并使用以下代码覆盖这两个方法。它结合了子类化、固定高度和转换方法。

```
#define FIXED_PICKER_HEIGHT 216.0f
- (void) setFrame:(CGRect)frame
{
    CGFloat targetHeight = frame.size.height;
    CGFloat scaleFactor = targetHeight / FIXED_PICKER_HEIGHT;
    frame.size.height = FIXED_PICKER_HEIGHT;//fake normal conditions for super
    self.transform = CGAffineTransformIdentity;//fake normal conditions for super
    [super setFrame:frame];
    frame.size.height = targetHeight;
    CGFloat dX=self.bounds.size.width/2, dY=self.bounds.size.height/2;
    self.transform = CGAffineTransformTranslate(CGAffineTransformScale(CGAffineTransformMakeTranslation(-dX, -dY), 1, scaleFactor), dX, dY);
}

- (UIView *)pickerView:(UIPickerView *)pickerView viewForRow:(NSInteger)row forComponent:(NSInteger)component reusingView:(UIView *)view
{
    //Your code goes here

    CGFloat inverseScaleFactor = FIXED_PICKER_HEIGHT/self.frame.size.height;
    CGAffineTransform scale = CGAffineTransformMakeScale(1, inverseScaleFactor);
    view.transform = scale;
    return view;
} 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2015-02-19T11:01:16.063

更改选择器视图的可见高度的一种简单方法是将选择器嵌入 UIView，将父视图的高度调整为您希望看到的选择器的高度，然后在父 UIView 上的 Interface Builder 中启用“剪辑子视图”或`view.clipsToBounds = true`在代码中设置。

![在 IB 中剪辑子视图](https://i.stack.imgur.com/B2Fvj.png)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2012-03-12T20:36:04.997

我无法遵循上述任何建议。

我看了多个教程，发现[这个](http://www.youtube.com/watch?v=HUZ08yKnbPg&feature=related)最有益：

我添加了以下代码以在“viewDidLoad”方法中设置新高度，该方法在我的应用程序中有效。

```
UIPickerView *picker = [[UIPickerView alloc] initWithFrame:CGRectMake(0.0, 0.0, 320.0, 120.0)]; 
[self.view addSubview:picker];
picker.delegate = self;
picker.dataSource = self; 
```

希望这有帮助！

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2016-02-22T20:11:54.063

这在 iOS 9 中发生了很大变化（在 iOS 8 中，它与我们在这里看到的非常相似）。如果您负担得起只针对 iOS 9，那么您`UIPickerView`可以通过设置其框架来调整其大小。好的！

这是来自[iOS 9 发行说明](https://developer.apple.com/library/prerelease/ios/releasenotes/General/RN-iOSSDK-9.0/)

> UIPickerView 和 UIDatePicker 现在可以调整大小和自适应 - 以前，即使您尝试调整它们的大小，这些视图也会强制执行默认大小。这些视图现在在所有设备上也默认为 320 磅的宽度，而不是 iPhone 上的设备宽度。
> 
> 依赖于旧的默认大小强制执行的接口在为 iOS 9 编译时可能看起来是错误的。遇到的任何问题都可以通过将选取器视图完全约束或调整为所需大小而不是依赖于隐式行为来解决。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-09-28T14:43:18.183

我正在使用 ios 7、Xcode 5。我可以通过将日期选择器封闭在视图中来间接调整它的高度。容器视图高度可以调整。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-04-01T18:59:43.543

在 IB 或代码中创建视图。将您的选择器添加为该视图的子视图。调整视图大小。这在 IB 中是最容易做到的。创建从视图到其父视图以及从选取器到这个新视图的约束。

由于围绕它的 Picker 曲线溢出了视图的顶部和底部。您可以在 IB 中看到，当您将选取器中的顶部和底部约束添加到视图时，它会显示一个标准空间，类似于超级视图容器上方和下方 16 个点。如果您不想要这种行为（丑陋的警告），请将视图设置为剪辑它。

这是 iPhone 5 上 96 点高的样子。溢出的选择器高约 130 点。好瘦！

我在我的项目中使用它来防止选择器扩散到不必要的高度。这种技术将其修剪并迫使更紧密的溢出。它实际上看起来更紧凑，更紧凑。

![在此处输入图像描述](https://i.stack.imgur.com/JtnHU.png)

这是显示溢出的视图图像。

![在此处输入图像描述](https://i.stack.imgur.com/2DJhm.png)

这是我添加的 IB 约束。

![在此处输入图像描述](https://i.stack.imgur.com/dj9DZ.png)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-08-18T11:04:56.280

好的，在 iOS 4 中与愚蠢的pickerview 斗争了很长时间之后，我决定将我的控件更改为简单的表格：这是代码：

```
ComboBoxView.m = which is actually looks more like pickerview.

//
//  ComboBoxView.m
//  iTrophy
//
//  Created by Gal Blank on 8/18/10.
//

#import "ComboBoxView.h"
#import "AwardsStruct.h"

@implementation ComboBoxView

@synthesize displayedObjects;

#pragma mark -
#pragma mark Initialization

/*
- (id)initWithStyle:(UITableViewStyle)style {
    // Override initWithStyle: if you create the controller programmatically and want to perform customization that is not appropriate for viewDidLoad.
    if ((self = [super initWithStyle:style])) {
    }
    return self;
}
*/

#pragma mark -
#pragma mark View lifecycle

/*
- (void)viewDidLoad {
    [super viewDidLoad];

    // Uncomment the following line to display an Edit button in the navigation bar for this view controller.
    // self.navigationItem.rightBarButtonItem = self.editButtonItem;
}
*/

/*
- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
}
*/
/*
- (void)viewDidAppear:(BOOL)animated {
    [super viewDidAppear:animated];
}
*/
/*
- (void)viewWillDisappear:(BOOL)animated {
    [super viewWillDisappear:animated];
}
*/
/*
- (void)viewDidDisappear:(BOOL)animated {
    [super viewDidDisappear:animated];
}
*/
/*
// Override to allow orientations other than the default portrait orientation.
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
    // Return YES for supported orientations
    return (interfaceOrientation == UIInterfaceOrientationPortrait);
}
*/

#pragma mark -
#pragma mark Table view data source

- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView {
    // Return the number of sections.
    return 1;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    // Return the number of rows in the section.
    self.tableView.separatorStyle = UITableViewCellSeparatorStyleSingleLine;
    return [[self displayedObjects] count];
}

// Customize the appearance of table view cells.
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {

    NSString *MyIdentifier = [NSString stringWithFormat:@"MyIdentifier %i", indexPath.row];

    UITableViewCell *cell = (UITableViewCell *)[tableView dequeueReusableCellWithIdentifier:MyIdentifier];

    if (cell == nil) {
        cell = [[[UITableViewCell alloc] initWithFrame:CGRectZero reuseIdentifier:MyIdentifier] autorelease];
        //cell.contentView.frame = CGRectMake(0, 0, 230.0,16);
        UILabel *label = [[[UILabel alloc] initWithFrame:CGRectMake(0, 5, 230.0,19)] autorelease];
        VivatAwardsStruct *vType = [displayedObjects objectAtIndex:indexPath.row];
        NSString *section = [vType awardType]; 
        label.tag = 1;
        label.font = [UIFont systemFontOfSize:17.0];
        label.text = section;
        label.textAlignment = UITextAlignmentCenter;
        label.baselineAdjustment = UIBaselineAdjustmentAlignCenters;
        label.adjustsFontSizeToFitWidth=YES;
        label.textColor = [UIColor blackColor];
        //label.autoresizingMask = UIViewAutoresizingFlexibleHeight;
        [cell.contentView addSubview:label]; 
        //UIImage *image = nil;
        label.backgroundColor = [UIColor whiteColor];
        //image = [awards awardImage];
        //image = [image imageScaledToSize:CGSizeMake(32.0, 32.0)];

        //[cell setAccessoryType:UITableViewCellAccessoryDisclosureIndicator];
        //UIImageView *imageView = [[UIImageView alloc] initWithImage:image];
        //cell.accessoryView = imageView;
        //[imageView release];
    }

    return cell;
}

/*
// Override to support conditional editing of the table view.
- (BOOL)tableView:(UITableView *)tableView canEditRowAtIndexPath:(NSIndexPath *)indexPath {
    // Return NO if you do not want the specified item to be editable.
    return YES;
}
*/

/*
// Override to support editing the table view.
- (void)tableView:(UITableView *)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath *)indexPath {

    if (editingStyle == UITableViewCellEditingStyleDelete) {
        // Delete the row from the data source
        [tableView deleteRowsAtIndexPaths:[NSArray arrayWithObject:indexPath] withRowAnimation:YES];
    }   
    else if (editingStyle == UITableViewCellEditingStyleInsert) {
        // Create a new instance of the appropriate class, insert it into the array, and add a new row to the table view
    }   
}
*/

/*
// Override to support rearranging the table view.
- (void)tableView:(UITableView *)tableView moveRowAtIndexPath:(NSIndexPath *)fromIndexPath toIndexPath:(NSIndexPath *)toIndexPath {
}
*/

/*
// Override to support conditional rearranging of the table view.
- (BOOL)tableView:(UITableView *)tableView canMoveRowAtIndexPath:(NSIndexPath *)indexPath {
    // Return NO if you do not want the item to be re-orderable.
    return YES;
}
*/

#pragma mark -
#pragma mark Table view delegate

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    // Navigation logic may go here. Create and push another view controller.
    /*
     <#DetailViewController#> *detailViewController = [[<#DetailViewController#> alloc] initWithNibName:@"<#Nib name#>" bundle:nil];
     // ...
     // Pass the selected object to the new view controller.
     [self.navigationController pushViewController:detailViewController animated:YES];
     [detailViewController release];
     */
}

#pragma mark -
#pragma mark Memory management

- (void)didReceiveMemoryWarning {
    // Releases the view if it doesn't have a superview.
    [super didReceiveMemoryWarning];

    // Relinquish ownership any cached data, images, etc that aren't in use.
}

- (void)viewDidUnload {
    // Relinquish ownership of anything that can be recreated in viewDidLoad or on demand.
    // For example: self.myOutlet = nil;
}

- (void)dealloc {
    [super dealloc];
}

@end 
```

这是 .h 文件：

```
//
//  ComboBoxView.h
//  iTrophy
//
//  Created by Gal Blank on 8/18/10.
//

#import <UIKit/UIKit.h>

@interface ComboBoxView : UITableViewController {
    NSMutableArray *displayedObjects;
}

@property (nonatomic, retain) NSMutableArray *displayedObjects;

@end

now, in the ViewController where I had Apple UIPickerView I replaced with my own ComboBox view and made it size what ever I wish.

ComboBoxView *mypickerholder = [[ComboBoxView alloc] init]; 
[mypickerholder.view setFrame:CGRectMake(50, 220, 230, 80)];
[mypickerholder setDisplayedObjects:awardTypesArray]; 
```

就是这样，现在唯一剩下的就是在组合框视图中创建一个成员变量来保存当前的行选择，我们可以开始了。

享受每个人。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-08-20T01:13:16.680

即使它不是调整大小，当 UIPicker 位于屏幕底部时，另一个技巧可能会有所帮助。

可以尝试将其稍微向下移动，但中心行应保持可见。这将有助于显示选择器上方的一些空间，因为底部行将在屏幕外。

我再说一遍，这不是改变 UIPicker 视图高度的方法，而是关于如果所有其他尝试都失败了你可以做什么的一些想法。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-09-18T06:00:09.237

您通常不能在 xib 中执行此操作或以编程方式设置框架，但如果您将其父 xib 作为源打开并从那里更改高度，则它可以工作。右键单击包含选取器视图的 xib，搜索选取器视图，您可以找到高度、宽度等在那个标签中，改变高度然后保存文件。

```
<pickerView contentMode="scaleToFill" id="pai-pm-hjZ">
                                    <rect key="frame" x="0.0" y="41" width="320" height="100"/>
                                    <autoresizingMask key="autoresizingMask" widthSizable="YES" flexibleMaxY="YES"/>
                                    <connections>
                                        <outlet property="dataSource" destination="-1" id="Mo2-zp-Sl4"/>
                                        <outlet property="delegate" destination="-1" id="nfW-lU-tsU"/>
                                    </connections>
                                </pickerView> 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-22T00:06:34.440

据我所知，缩小 UIPickerView 是不可能的。我实际上也没有看到在任何地方使用过更短的。我的猜测是，如果他们确实设法缩小它，那它就是一个自定义实现。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-03-09T21:33:17.337

如果您想在 IB 中创建您的选择器，您可以将其调整为更小的尺寸。检查以确保它仍然正确绘制，因为它看起来令人发指。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-05-25T11:12:01.890

**斯威夫特**：你需要添加一个带有剪辑的子视图到边界

```
 var DateView = UIView(frame: CGRectMake(0, 0, view.frame.width, 100))
    DateView.layer.borderWidth=1
    DateView.clipsToBounds = true

    var myDatepicker = UIDatePicker(frame:CGRectMake(0,-20,view.frame.width,162));
    DateView.addSubview(myDatepicker);
    self.view.addSubview(DateView) 
```

这应该在视图控制器的顶部添加一个剪裁的 100 高度日期选择器。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-07-11T17:40:14.833

我的诀窍：使用 datepicker 的遮罩层使 datePicker 的某些部分可见。如您所见，就像更改 datepicke 的框架一样。

```
- (void)timeSelect:(UIButton *)timeButton {
UIDatePicker *timePicker = [[UIDatePicker alloc] initWithFrame:CGRectMake(0, 0, kScreenWidth, 550)];
timePicker.backgroundColor = [UIColor whiteColor];
timePicker.layer.mask = [self maskLayerWithDatePicker:timePicker];
timePicker.layer.masksToBounds = YES;
timePicker.datePickerMode = UIDatePickerModeTime;
[self.view addSubview:timePicker];
}

- (CALayer *)maskLayerWithDatePicker:(UIDatePicker *)datePicker {
CAShapeLayer *shapeLayer = [[CAShapeLayer alloc] init];
UIBezierPath *path = [UIBezierPath bezierPathWithRoundedRect:CGRectMake(0, 0, datePicker.width*0.8, datePicker.height*0.8) cornerRadius:10];
shapeLayer.path = path.CGPath;
return shapeLayer;
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-03-10T02:58:40.533

我使用遮罩层来改变它的显示大小

```
// swift 3.x
let layer = CALayer()
layer.frame = CGRect(x: 0,y:0, width: displayWidth, height: displayHeight)
layer.backgroundColor = UIColor.red.cgColor
pickerView.layer.mask = layer 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2018-03-28T11:07:57.887

嵌入堆栈视图。Stack view 是 Apple 最近在其 iOS SDK 中添加的一个组件，用于反映基于 java 脚本 Web 的前端库（如 bootstrap）中基于网格的实现。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-02-14T00:50:00.947

如上所述，`UIPickerView`现在可以调整大小。我只想补充一点，如果你想在 tableView 单元格中更改 pickerView 的高度，我没有成功将高度锚设置为常数。但是，使用`lessThanOrEqualToConstant`似乎有效。

```
 class PickerViewCell: UITableViewCell {

    let pickerView = UIPickerView()

    func setup() {

        // call this from however you initialize your cell

        self.contentView.addSubview(self.pickerView)
        self.pickerView.translatesAutoresizingMaskIntoConstraints = false

        let constraints: [NSLayoutConstraint] = [
            // pin the pickerView to the contentView's layoutMarginsGuide

            self.pickerView.leadingAnchor.constraint(equalTo: self.contentView.layoutMarginsGuide.leadingAnchor),
            self.pickerView.topAnchor.constraint(equalTo: self.contentView.layoutMarginsGuide.topAnchor),
            self.pickerView.trailingAnchor.constraint(equalTo: self.contentView.layoutMarginsGuide.trailingAnchor),
            self.pickerView.bottomAnchor.constraint(equalTo: self.contentView.layoutMarginsGuide.bottomAnchor),

            // set the height using lessThanOrEqualToConstant
            self.pickerView.heightAnchor.constraint(lessThanOrEqualToConstant: 100)
        ]

        NSLayoutConstraint.activate(constraints)
     }

 } 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2010-09-09T05:34:32.667

```
stockPicker = [[UIPickerView alloc] init];
stockPicker.frame = CGRectMake(70.0,155, 180,100);
```

如果你想设置 UiPickerView 的大小。上面的代码肯定会为你工作。

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2010-09-10T13:53:36.387

经过一整天的挠头，我找到了适合我的东西。每次用户更改手机方向时，以下代码将重新创建 UIDatePicker。这将消除 UIDatePicker 在方向更改后出现的任何故障。

由于我们正在重新创建 UIDatePicker，我们需要一个实例变量来保留选定的日期值。下面的代码是在 iOS 4.0 上测试的。

```
 @interface AdvanceDateViewController : UIViewController<UIPickerViewDelegate> {
        UIDatePicker *datePicker;
        NSDate *date;
    }

    @property (nonatomic, retain) UIDatePicker *datePicker;
    @property (nonatomic, retain) NSDate *date;

    -(void)resizeViewWithOrientation:(UIInterfaceOrientation) orientation;

    @end

    @implementation AdvanceDateViewController
    @synthesize datePicker, date;

    - (void)viewDidLoad {
      [super viewDidLoad];
          [self resizeViewWithOrientation:self.interfaceOrientation];
    }

    -(void)viewWillAppear:(BOOL)animated{
         [super viewWillAppear:animated];
         [self resizeViewWithOrientation:self.interfaceOrientation];
     }

     - (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
         return YES;
     }

     -(void)willRotateToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation duration:(NSTimeInterval)duration{
      [super willRotateToInterfaceOrientation:toInterfaceOrientation duration:duration];
      [self resizeViewWithOrientation:toInterfaceOrientation];
      }

     -(void)resizeViewWithOrientation:(UIInterfaceOrientation) orientation{
          [self.datePicker removeFromSuperview];
          [self.datePicker removeTarget:self action:@selector(refreshPickupDate) forControlEvents:UIControlEventValueChanged];
          self.datePicker = nil;

          //(Re)initialize the datepicker, thanks to Apple's buggy UIDatePicker implementation
          UIDatePicker *dummyDatePicker = [[UIDatePicker alloc] init];
          self.datePicker = dummyDatePicker;
          [dummyDatePicker release];

          [self.datePicker setDate:self.date animated:YES];
          [self.datePicker addTarget:self action:@selector(refreshPickupDate) forControlEvents:UIControlEventValueChanged];

          if(UIInterfaceOrientationIsLandscape(orientation)){
                 self.datePicker.frame = CGRectMake(0, 118, 480, 162);    
           } else {
                 self.datePicker.frame = CGRectMake(0, 200, 320, 216);
           }

           [self.view addSubview:self.datePicker];
           [self.view setNeedsDisplay];
      }

      @end 
```

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2011-11-24T04:17:11.590

在 iOS 5.0 中，我得到了以下工作：

```
UIDatePicker *picker = [[UIDatePicker alloc] init];
picker.frame = CGRectMake(0.0, 0.0, 320.0, 160.0); 
```

这创建了一个日期选择器，就像 Apple 在以横向模式创建新事件时在日历应用程序中使用的一样。（3 行高而不是 5 行。）当我在方法中设置框架时，这不起作用`initWithFrame:`，但到目前为止，在使用单独的方法设置它时有效。

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2012-03-09T22:14:06.923

对于 iOS 5：

如果您快速查看[UIPickerView 协议](https://developer.apple.com/library/ios/#DOCUMENTATION/UIKit/Reference/UIPickerViewDelegate_Protocol/Reference/UIPickerViewDelegate.html#//apple_ref/occ/intfm/UIPickerViewDelegate/pickerView%3arowHeightForComponent%3a)参考

你会找到

```
– pickerView:rowHeightForComponent:
– pickerView:widthForComponent: 
```

我想是你要找的第一个

# css - Drupal：如何在包含项目的页面上更改分类标题？

> ID：573980
> 
> 赞同：0
> 
> 时间：2009-02-22T00:06:03.880
> 
> 标签：css, drupal, content-management-system, header, taxonomy

我有一个菜单项，例如 [http://localhost/drupal/?q=category/articles/php](http://localhost/drupal/?q=category/articles/php)

它应该输出所有关于 PHP 的故事，但结果页面标题（带有术语名称 (PHP) ）看起来不太好。如何删除标题或更改其 CSS 样式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T01:38:07.267

自定义页面的最佳选择是使用 Views Module 并激活 taxonomy_term 视图。然后，您可以添加到标题字段，甚至为该视图创建一个新模板。

Drupal 手册有很多用于主题化和构建视图的资源：http: [//drupal.org/node/352970](http://drupal.org/node/352970)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T02:53:22.843

看看 Drupal 的主题指南： [http://drupal.org/theme-guide](http://drupal.org/theme-guide)

您需要了解主题才能编辑 css 或 html。

# java - 为什么使用单声道？

> ID：573982
> 
> 赞同：33
> 
> 时间：2009-02-22T00:06:30.400
> 
> 标签：java, .net, linux, mono

在 Java（或任何其他“免费”或 Linux 友好的语言/运行时）上使用 Mono 的主要好处是什么？

Mono 将始终落后于 .NET 框架的最新发展，您为什么要使用 Mono 而不是另一种传统的开源语言/框架 (Java)？

编辑：就像下面提到的人一样，我想根本问题是，为什么要在 Linux 平台上使用 .NET？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-02-22T00:11:37.313

答案很明显：因为您想在 Linux 上使用 .Net。

这当然引出了一个问题（我认为这正是您所要了解的）：为什么要在 Linux 上使用 .Net（通过 Java）？

很多原因：

*   您的服务器与例如 WPF 或 Winforms 应用程序之间的通用代码；
*   使用特定的 .Net 语言，如 F#；
*   Java 中没有的语言特性（闭包、运算符重载、部分类、运行时泛型、索引器、委托、LINQ、var 类型等）；
*   您或您的团队的技能已经在 C# 中；
*   等等

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-22T00:32:29.383

就个人而言，我更信任 Linux 平台作为服务器，但想使用 C# 作为程序语言。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-22T01:54:28.690

你想在未来的某个时候在 iPhone、Wii 和可能的 Android 上使用 C#。请参阅此链接。 [http://arstechnica.com/open-source/news/2009/01/open-source-mono-framework-brings-c-to-iphone-and-wii.ars](http://arstechnica.com/open-source/news/2009/01/open-source-mono-framework-brings-c-to-iphone-and-wii.ars)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-22T00:35:01.297

有些人比 Java 更喜欢 C#。此外，请考虑 C# 是 ISO 标准语言，而 Java 不是。也许您想在 Linux 服务器上运行 ASP.NET 代码？有很多原因，真的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-22T05:03:00.640

我认为这取决于个人喜好。我对 c# 很满意，我想开发可以在我的 Ubuntu 笔记本电脑或 Vista 笔记本电脑上运行的应用程序。因此，我使用单声道。如果我对 Java 更满意，那么这可能就是我会使用的。

只是我的2美分。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-22T01:24:40.070

我曾经为一家公司工作，该公司的主要产品是用 ASP.NET 编写的。他们意识到，如果他们可以让他们的产品在 Linux 服务器上运行，他们可能会增加他们的市场份额。如果不是 Mono，这当然会非常困难。我的任务是花一些时间看看他们的代码有多少（如果有的话）可以在 Mono 下运行。这应该是大约 2 年前的事了——其中大部分是编译好的，但是当时 Mono 对泛型的支持还有一点不足之处。我认为它从那时起就成熟了，但有些代码甚至无法解析。该代码还稍微使用了 p/invoke 来调用本机代码，这也让事情变得有点有趣。不过，尝试让它运行当然很有趣。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-22T02:08:43.913

由于微软在做出更改之前提交了对 C# ISO 标准的更改，因此理论上 Mono 不需要跟踪 .NET。实际上，大的旧 MS 预算首先到达终点线。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-22T05:47:00.690

正如每个人所说，“在 Linux 上运行 C#”或“跨平台”或其他什么。

我对 Mono 感兴趣的原因——而且我还没有被说服去接触它——是因为有可能利用 .Net 提供的所有 Java 不提供的东西。基本上，您的问题确实归结为 Java 与 .Net 的比较，我不会开始对它们之间的一百万个比较点进行比较（在 Google 中，您会发现 J2EE 与 ASP.NET 的比较分数，这是一部分，Java vs. C# 是另一部分）。

但是 .Net 和 Java 之间的最大区别是什么？它与 .Net 背后的单一力量（微软和 Novell 正试图将其转换到其他平台）或 Java 的多供应商方法有关。仅选择 App Server 的过程可能足以让某些人选择 Mono。

像微软这样的大型单体供应商为您提供了 Java 似乎没有的东西：

1.  集中式文档（是“非常好的文档，都在一个地方”，但有几个人告诉我我错了）
2.  无需做出单独的平台选择（例如，ASP.NET 或 ASP.NET，而不是 servlets+JSP+JSTL？+Axis）
3.  其他我忘记的东西

然后还有其他巨大的差异：Java 是一种单一语言，而 Mono（我认为）可以运行各种语言的 CLR 编译代码。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-22T06:14:01.280

Mono 在某些事情上落后，但在其他事情上却遥遥领先。例如，Mono 支持[SSE](https://stackoverflow.com/questions/415375/using-sse-in-c-is-it-possible)和完整的提前编译 - 内置。另一方面......它需要 Mono 一段时间才能在即将到来的 .net 版本中实现所有新的即将推出的东西......例如......相当广泛的并行库。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-22T00:11:35.957

总而言之？跨平台

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-06-30T00:38:22.180

任何使用 Mono 的人都面临来自微软的软件专利危险。

这就是为什么对于新应用程序不仅应该避免使用 Mono，而且首先应该避免使用 C#。

只有当您已经坚持使用 Windows 并想逃避时，迁移到 Mono 才有意义。

[为什么自由软件不应该依赖于 Mono 或 C#](http://www.fsf.org/news/dont-depend-on-mono)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-10T14:08:02.520

为什么没有人提到 Linux 是免费的？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-11-04T20:17:39.967

实际上，我使用 mono 作为交叉编译器。我在现有的 java/ant 构建文件中添加了一些“exec”行来调用 mono 作为编译器，因此有一个单一的、完整的命令行构建过程。

我必须围绕我们的 java-on-linux 代码库必须使用的一些 PC 代码编写 C# 包装层，但我不能让自己要求启动 Visual Studio（在单独的计算机上）只是为了进行检查-出和构建过程。

# objective-c - 在 PC 上为 iPhone 开发？

> ID：573986
> 
> 赞同：10
> 
> 时间：2009-02-22T00:07:19.633
> 
> 标签：objective-c, iphone, windows

> **可能的重复：**
> [Windows 上的 iPhone 开发](https://stackoverflow.com/questions/113547/iphone-development-on-windows)

是否可以使用 PC 创建 iPhone 应用程序？我正在运行windows vista，我想学习objective-c，有什么更好的方法可以激发你的动力，而不是创造某人在某处可能使用的东西的潜力。

是否有任何黑客允许我制作应用程序？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-22T00:11:20.747

不幸的是，这不受支持。为 iPhone 开发需要 Xcode 和 Apple 的 gcc 工具链，并且它仅在 Intel Mac OS X 上受支持（尽管有些已经让它在 PPC Mac OS X 上工作）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-22T00:23:57.173

NilObject 是正确的，您只能在最近（最近几年）带有 OS X 的 Mac 上为 iPhone 正式开发。

也就是说，Objective-C 与 iPhone 无关。您可以在 Objective-C 中为您的 PC 编写程序，这将为您提供无需 iPhone 和 Mac 的体验。Objective-C 是[GNU 编译器集合](http://gcc.gnu.org/)(GCC) 的标准部分。[使用Cygwin](http://cygwin.org/)安装相当容易。

如果你真的想做 iPhone 应用程序，你应该考虑 Mac。您将获得各种经验，然后还可以为 OS X 编程。由于笔记本电脑刚刚发布，许多人都在出售他们以前的型号，因为它们已经升级了。如果你能找到一个基于旧英特尔芯片的 Mac Mini，它根本不会花费你太多（几百），但它不会很快。最近的 Minis 已经很长时间没有更新了，并且对于它们的新价格（在我看来）来说不再是一个很好的价值，但它们也可能很便宜。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-22T20:37:45.960

实际上，有一个在 windows 和 linux 中工作的非官方工具链。你需要在你的电脑上安装 cygwin 才能在 Windows 中使用它。

这是基本设置的链接：[link](http://www.maxhorvath.com/documents/programming_for_iphone_using_l/eclipse-iphone-cdt.pdf)

虽然这不允许您发布到 AppStore，但这只是弄乱 SDK 的好方法。此外，每当 Apple 更新 iPhone 固件时，您都需要查找/等待更新的工具链或自己进行一些黑客攻击以获取更新标头等...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-22T00:37:06.300

不要打扰。我有一个 hackintosh，虽然它有效，但 Apple 可以（并且确实）定期更新 SDK 的最低平台要求，这意味着您的 hackintosh 将无法跟上 SDK 中新的酷功能，因为 Kalyway 和其他任何需要是时候对 kexts 或其他任何东西进行逆向工程以找出新的操作系统了。

如果你对 iPhone 很认真，那就买一台 Mac。您可能会以几百美元的价格找到第一代 Mac mini（英特尔）。或者春天买一本macbook，然后兴奋起来。新的非常好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-04T18:01:32.233

> 卢卡斯土豚写道：
> 
> *我要买个mac。只需要存一点钱;-)*

尽管我完全同意共识：*get a Mac*，但我只是想根据您留下的评论添加一点：

如果您打算进入 iPhone 领域，以一千万下载量的一美元下载您所听到的流行故事中的一个，您将需要一款杀手级应用程序，一款全新且令人兴奋的应用程序。祝你好运；我不会和你分享*我的*想法，因为我也在尝试做同样的事情。:)

也就是说，我和你在同一条船上——我没有多余的钱来购买 Mac——所以我将分享一些可能有帮助的一般性建议。

与其进入 iPhone 领域，我一直在考虑首先在[Android](http://developer.android.com/)手机上利用我的 Java 技能。一旦我这样做赚了几块钱，我就会买一台 Mac 并学习 Objective-C 并将我的程序移植过来。由于 Android 使用 Java 并且是免费/开源的，所以我只花了 25 美元来创建一个发布者帐户；我可以在我拥有的任何平台上使用 Eclipse 完成剩下的工作。

我不知道它是否对你有很大帮助，但它可能是一种更划算的方式来编写你的灰姑娘故事。:)

# ios - 在同一行并排显示 UITableViewCell（如在联系人 -> 信息中）

> ID：573987
> 
> 赞同：1
> 
> 时间：2009-02-22T00:07:51.753
> 
> 标签：ios, objective-c, iphone, uitableview, cocoa-touch

如果导航到 iPhone 的电话应用程序，然后转到联系人 -> 信息（在任何联系人上）.. 你会看到在联系人的底部有两个相邻的 UITableViewCells，在同一行上。在这种特殊情况下，它们是“短信”和“添加到收藏夹”

这种布局是如何实现的？如果有任何例子，那就太好了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-22T00:10:10.717

我将实现它的方式是创建一个透明的 UITableViewCell，并向单元格添加两个 UIButton。这就是联系人对我所做的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T05:39:32.197

您可以将按钮放在 a 中`UIView`并将其用作表格视图的页脚。您可以在 IB 中设置页脚视图并将其连接到表视图控制器中的插座和操作。然后代码是单行的：

```
- (void)viewDidLoad
{
    self.tableView.tableFooterView = footerView;
} 
```

# multithreading - 为什么叫“监视器”？

> ID：573998
> 
> 赞同：3
> 
> 时间：2009-02-22T00:13:35.983
> 
> 标签：multithreading, concurrency, synchronization, monitor, mutual-exclusion

我指的是这里描述的监视器：

[http://en.wikipedia.org/wiki/Monitor_(同步)](http://en.wikipedia.org/wiki/Monitor_(synchronization))

这里的定义似乎都不恰当：

[http://www.thefreedictionary.com/monitor](http://www.thefreedictionary.com/monitor)

那么他们为什么这么称呼呢？

== 更新 ==

谢谢大家的解答！

我想我很困惑，因为我认为监视器通常不会对自己起作用，这似乎就是这里发生的事情。例如，您使用婴儿监视器来监视婴儿。我只是认为让婴儿监控自己没有多大意义，但我可能是错的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-22T00:32:34.783

根据 P. Brinch Hansen 在[Monitors and Concurrent Pascal: A personal history](http://brinch-hansen.net/papers/1993a.pdf)中的说法，该名称起源于 60 年代和 70 年代初操作系统的原始术语：

> 在 1960 年代，操作系统的常驻部分通常被称为监视器。RC 4000 多道程序系统的内核称为监视器，并被定义为“可以作为不可分割的实体执行一系列指令”的程序（Brinch Hansen 1969）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T00:23:51.870

以[生产者消费者问题](http://en.wikipedia.org/wiki/Producer-consumer_problem)为例。在不使用监视器的情况下，您必须通过编写忙循环来不断检查队列是否 1) 已满和 2) 是否为空。实际上，监视器通过以原子方式传输控制来为您监视状态。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-22T00:31:10.713

我认为定义 3a（来自字典）很接近

3a。一种通常用于记录、调节或控制过程或系统的电子设备

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-22T00:34:04.420

我认为监视器监视（和控制）对资源的访问。

The Free Dictionary for [Monitor](http://www.thefreedictionary.com/monitor)中的定义：

名词定义 3A 和 4 或多或少都适用（监视器不是程序，而是程序组件）。

“动词、及物”部分的定义 1、2、5 也可以说是适用的。************