# StackOverflow 问答 000078000-000078999

# java - 在开发基于模块或插件的系统时，我应该如何开始？

> ID：78004
> 
> 赞同：7
> 
> 时间：2008-09-16T22:35:24.163
> 
> 标签：java, events, plugins, module

我打算开发一个完全基于模块的系统。系统基础应该支持查找插件、启动它们并能够为这些模块提供通信方式。理想情况下，一个人应该能够随意放入新模块和抽出未使用的模块，并且模块应该能够在可用的情况下使用彼此的功能。

该系统应该用作模拟系统的基础，其中很多事情发生在不同的模块中，而其他模块可能希望在此基础上做一些事情。

我打算开发的系统将使用 Java。在我看来，我打算为每个模块创建一个包含子文件夹的文件夹，其中包含一个 XML 描述模块的信息，例如名称、可能引发的事件等。我想我可能需要编写一个自定义 ClassLoader 来解决这些问题。

问题是，我不知道我的想法是否真的站得住脚，当然，我打算建立一个工作原型。但是，我以前从未研究过真正的模块化系统，而且我不确定解决这个问题的最佳方法是什么。

我应该从哪里开始？开发此类系统时是否发现了常见的问题和陷阱？如何在保持隔离的同时使模块相互通信（即，您删除了一个模块，而另一个正在使用它的模块保持正常）？是否有任何我可以阅读的指南、规范或文章可以给我一些关于从哪里开始的想法？如果它们基于 Java 会更好，但这不是必需的，因为我现在正在寻找的是想法，而不是代码。

任何反馈表示赞赏。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-16T22:42:44.037

You should definitely look at [OSGi](http://www2.osgi.org/Specifications/HomePage). It aims at being *the* component/plugin mechanism for Java. It allows you to modularize your code (in so-called bundles) and update bundles at runtime. You can also completely hide implementation packages from unwanted access by other bundles, eg. only provide the API.

Eclipse was the first major open-source project to implement and use OSGi, but they didn't fully leverage it (no plugin installations/updates without restarts). If you start from scratch though, it will give you a very good framework for a plugin system.

[Apache Felix](http://felix.apache.org) is a complete open-source implementation (and there are others, such as [Eclipse Equinox](http://www.eclipse.org/equinox/)).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T22:39:27.540

在不深入细节的情况下，您应该了解一下[Spring](http://springframework.org/)，并且熟悉 OSGI 或 Eclipse RCP 框架也会为您提供一些需要牢记的基本概念。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T23:12:46.803

Another option is the [ServiceLoader](http://java.sun.com/javase/6/docs/api/java/util/ServiceLoader.html) added in Java 1.6\.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T22:40:39.860

他们有很多方法可以做到这一点，但可以通过使用反射来做一些简单的事情。您在文件的 XML 文件名中写入文件（这实际上是一个类）。您可以检查它是什么类型并通过反射创建回来。该类可以有一个通用接口，可以让您找到外部文件/类是否真的是您的模块之一。这是有关[反射](http://java.sun.com/docs/books/tutorial/reflect/index.html)的一些信息。

您还可以使用像这样的预编码框架 SourceForge 一个[链接文本](http://sourceforge.net/projects/javasps/)，它将为您提供创建模块/插件的第一步。

# visual-studio - 为每个用户执行不同的 MSBuild 任务集？

> ID：78018
> 
> 赞同：1
> 
> 时间：2008-09-16T22:38:06.060
> 
> 标签：visual-studio, deployment, msbuild, build

在我们的开发环境中，每个开发人员都有自己的开发服务器。很多时候，他们实际上并没有在该服务器上进行开发，而是从他们的本地机器开发，部署到他们的开发服务器，然后附加远程调试器进行调试。

我的问题是；如何使用 MSBuild 为每个用户执行一组不同的任务？

我想让每个用户都可以使用 MSBuild 任务定义自己的构建过程，但我不希望这必然影响其他开发人员。如果给定用户明确定义了自己的流程，我还希望执行一组默认任务。

例子：

*   SomeProj.csproj
    *   默认 MS Build 过程是复制到测试服务器或登台服务器
    *   Steve 的自定义流程是复制到 Steve 的开发服务器
    *   Eric 的自定义流程是复制到 Eric 的开发服务器

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T22:43:28.683

你可以使用项目用户文件（*.suo / *.user）来做一些“可怜的人依赖注入”。

[看起来这家伙做了类似的事情](http://ahmed0192.blogspot.com/2006/11/customize-msbuild-without-modifying.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T14:53:08.687

是的，我以前做过。尝试技巧是关闭`$(USERNAME)`您的 msbuild 脚本。如果您以前没有尝试过编辑 msbuild 脚本，那么您需要学习很多东西。

# linux - 嵌入式 Linux 设备上的丰富用户界面

> ID：78043
> 
> 赞同：4
> 
> 时间：2008-09-16T22:40:24.820
> 
> 标签：linux, user-interface, embedded, touchscreen

我正在为运行 Linux 的大型触摸屏设备设计用户界面。什么是最好的工具包/开发工具包/SDK？唯一的要求是它能够在半低性能设备上运行，并且有 Linux 版本。

Nice-to-haves 将用于支持效果/动画和现代外观，但它们不是必需的。

我已经在研究 Adob​​e Flex/AIR，但我不确定该设备是否符合最低规格。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T22:41:33.460

试试 QTopia ( [http://trolltech.com/products/qtopia](http://trolltech.com/products/qtopia) ) 它来自与流行的 Qt 桌面工具包相同的稳定版本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T22:47:58.593

我同意 Mopoke，QTopia 就是你想要的。

*   它有一些图形硬件（2d 和 3d）的支持，如果你只需要这些，它也可以使用内核帧缓冲设备。

*   它基于 Qt，一个设计非常好的面向对象的 GUI 框架

*   它适用于开源项目和商业项目，但闭源项目需要支付许可费。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T21:53:06.710

您应该检查用于[Chumby](http://www.chumby.com/)的任何工具包。它是一个完全开源的 Linux 设备（开放原理图、开源软件等），具有非常丰富的用户界面（彩色触摸屏、内置 wifi、USB 端口等）。我相信用户提交的“应用程序”是基于 Adob​​e Flex/Flash 的，但也有各种开放的“黑客”，包括可以轻松下载和运行[的 Quake 端口。](http://www.bunniestudios.com/blog/?p=262)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-02-18T00:17:15.973

你可以试试[Disko](http://diskohq.com)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-07-01T20:54:27.187

看看[杂波。](http://www.clutter-project.org/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-18T08:44:51.783

CodeTyphon 可以让您轻松编码、可视化设计和交叉编译适用于嵌入式 linux 的 GUI 触摸屏应用程序。

[http://www.pilotlogic.com/sitejoom/index.php?option=com_content&view=article&id=96&catid=68&Itemid=147](http://www.pilotlogic.com/sitejoom/index.php?option=com_content&view=article&id=96&catid=68&Itemid=147)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T17:05:43.823

QTopia 确实是一个不错的选择；其他都是[DirectFB](http://www.directfb.org/)，当然X11一般都跑[Matchbox](http://matchbox-project.org/)。

# c - C 中的空间数据结构

> ID：78045
> 
> 赞同：9
> 
> 时间：2008-09-16T22:40:29.907
> 
> 标签：c, performance, optimization, data-structures, computational-geometry

我确实在高性能集群上从事理论化学工作，通常涉及分子动力学模拟。我的工作解决的问题之一涉及 N 维（通常 N = 2-5）超​​球体的静态场，测试粒子可能会与之发生碰撞。我正在寻找优化（阅读：大修）用于表示球体领域的数据结构，以便我可以进行快速碰撞检测。目前，我使用一个简单的指针数组，指向一个 N 成员结构（中心的每个坐标双精度）和一个最近邻列表。我听说过八叉树和四叉树，但还没有清楚地解释它们是如何工作的，如何有效地实现它们，或者如何使用它们进行快速碰撞检测。考虑到我模拟的大小，内存（几乎）不是对象，但循环是。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T09:29:41.470

如何最好地解决您的问题取决于您未描述的几个因素： - 相同的超球面排列是否会用于许多粒子碰撞计算？- 超球体的大小是否一致？- 粒子的运动是什么（例如直线/曲线），运动是否受到球体的影响？- 你认为粒子的体积为零吗？

我假设粒子没有简单的直线运动，因为这将是找到一条线和一个点之间最近点的相对快速的计算，这可能与找到线中哪个框的速度大致相同相交（以确定要检查的 n-tree 中的哪个位置）。

如果您的超球体位置对于大量粒子碰撞是固定的，那么计算[voronoi 分解/Dirichlet 细分](http://en.wikipedia.org/wiki/Voronoi_diagram)将为您提供一种快速的方法，以便您稍后准确地找到对于空间中的任何给定点哪个球体最接近您的粒子。

然而，要回答关于八叉树/四叉树/2^n-trees 的原始问题，在 n 维中，您从包含您感兴趣的空间区域的（超）立方体开始。这将被细分为 2^n 超立方体如果您认为内容过于复杂。这会递归地继续，直到叶节点中只有简单的元素（例如一个超球体质心）。现在已经构建了 n-tree，您可以通过获取粒子的路径并将其与外部超立方体相交来使用它进行碰撞检测。交点位置将告诉您接下来要访问树的下一层中的哪个超立方体，并且您确定与该级别的所有 2^n 个超立方体的交点位置，向下直到到达叶节点。到达叶子后，您可以检查粒子路径与存储在该叶子上的超球体之间的相互作用。如果你有碰撞你已经完成了，否则你必须从当前超立方体叶子中找到粒子路径的出口点，并确定它接下来移动到哪个超立方体。继续直到发现碰撞或完全离开整个边界超立方体。

在退出超立方体时有效地找到相邻的超立方体是这种方法中最具挑战性的部分之一。对于 2^n 树，可以采用 Samet 的方法 {1, 2}。对于 kd-trees（二叉树），{3} 第 4.3.3 节建议了一种方法。

有效的实现可以很简单，例如存储从每个超立方体到其子超立方体的 8 个指针的列表，如果超立方体是叶，则以特殊方式标记它（例如，使所有指针为 NULL）。

可以在 Klinger & Dyer {4} 中找到划分空间以创建四叉树（您可以将其推广到 n-tree）的描述

正如其他人提到的那样，kd-trees 可能比 2^n-trees 更适合，因为扩展到任意数量的维度更直接，但是它们会产生更深的树。调整分割位置以将超球体的几何形状与 kd-tree 匹配也更容易。上面对 2^n 树中的碰撞检测的描述同样适用于 kd-tree。

{1} [Connected Component Labeling, Hanan Samet, Using Quadtrees Journal of ACM 第 28 卷，第 3 期（1981 年 7 月）](http://portal.acm.org/citation.cfm?id=322267&dl=ACM&coll=ACM)

{2}[在 octrees 表示的图像中寻找邻居，Hanan Samet，计算机视觉、图形和图像处理第 46 卷，第 3 期（1989 年 6 月）](http://portal.acm.org/citation.cfm?id=65329)

{3}[集理论定义模型的凸包生成、连接组件标记和最小距离计算，Dan Pidcock，2000](http://people.bath.ac.uk/ensab/G_mod/Distances/)

{4} 使用正则分解的图片表示实验，Klinger, A., and Dyer, CR E, Comptr。图形和图像处理 5 (1976), 68-105。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T22:50:00.947

听起来您想要实现一个[kd-tree，](http://en.wikipedia.org/wiki/Kd-tree)它可以让您更快地搜索 N 维空间。[在Stony Brook Algorithm Repository](http://www.cs.sunysb.edu/~algorith/files/kd-trees.shtml)有更多信息和实现链接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T22:53:03.153

由于您的领域是静态的（我假设您的意思是超球体不移动），所以我所知道的最快的解决方案是 Kdtree。
你可以自己做，也可以用别人的，比如这个： http: [//libkdtree.alioth.debian.org/](http://libkdtree.alioth.debian.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T22:49:01.947

四叉树是一棵二维树，其中每一层有一个节点有 4 个子节点，每个子节点占父节点面积的 1/4。

Oct 树是一棵 3 维树，其中每一层有一个节点有 8 个子节点，每个子节点包含父节点体积的 1/8。这是帮助您将其可视化的图片：[http ://en.wikipedia.org/wiki/Octree](http://en.wikipedia.org/wiki/Octree)

如果您正在进行 N 维交叉测试，您可以将其推广到 N 树。

相交算法的工作原理是从树的顶部开始并递归地遍历与正在测试的对象相交的任何子节点，在某些时候您会到达包含实际对象的叶节点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T09:42:03.483

只要您可以通过球体的中心指定球体，八叉树就可以工作 - 它将点分层分类为具有八个孩子的立方区域。计算八叉树数据结构中的邻居将需要您进行球体相交立方体计算（在某种程度上比他们看起来更容易）来计算出八叉树中的哪些立方体区域在球体内。

找到最近的邻居意味着沿着树往回走，直到你得到一个节点，其中包含多个填充的子节点和所有周围的节点（这确保了查询得到所有方面）。

从记忆中，这是球体 - 立方体相交的（有点天真）基本算法：

一世。是立方体内的中心（这得到了同名的情况）

ii. 立方体的任何角是否在中心半径 r 内（球内的角）

iii. 对于立方体的每个表面（您可以通过计算中心位于表面的哪一侧来消除一些表面）计算（这都是第一年的向量算术）：

一个。指向球体中心的曲面法线

湾。从球体中心到法线与曲面平面交点的距离（弦与立方体曲面相交）

C。平面的交点位于立方体的边内（弦与立方体相交的一个条件）

iv. 计算弦的大小（Sin of Cos^-1 of ratio of normal length to sphere of sphere）

v. 如果线上最近的点小于弦的距离并且该点位于线的两端之间，则弦与立方体的其中一条边相交（弦与立方体表面沿其中一条边相交）。

记得有点模糊，但这是我为使用八角形数据结构（多年前）涉及球形区域的情况所做的事情。您可能还希望按照其他一些海报的建议查看 KD-trees，但您最初的问题听起来与我所做的非常相似。

# windows-xp - Best way to detect an application crash and restart it?

> ID：78048
> 
> 赞同：8
> 
> 时间：2008-09-16T22:40:50.233
> 
> 标签：windows-xp, crash

What's the best way to detect an application crash in XP (produces the same pair of 'error' windows each time - each with same window title) and then restart it?

I'm especially interested to hear of solutions that use minimal system resources as the system in question is quite old.

I had thought of using a scripting language like AutoIt ([http://www.autoitscript.com/autoit3/](http://www.autoitscript.com/autoit3/)), and perhaps triggering a 'detector' script every few minutes?

Would this be better done in Python, Perl, PowerShell or something else entirely?

Any ideas, tips, or thoughts much appreciated.

EDIT: It doesn't actually crash (i.e. exit/terminate - thanks @tialaramex). It displays a dialog waiting for user input, followed by another dialog waiting for further user input, then it actually exits. It's these dialogs that I'd like to detect and deal with.

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-16T23:12:16.757

Best way is to use a named [mutex](http://msdn.microsoft.com/en-us/library/ms684266(VS.85).aspx).

1.  Start your application.
2.  Create a new named mutex and take ownership over it
3.  Start a new process (process not thread) or a new application, what you preffer.
4.  From that process / application try to aquire the mutex. The process will block
5.  When application finish release the mutex (signal it)
6.  The "control" process will only aquire the mutex if either the application finishes or the application crashes.
7.  Test the resulting state after aquiring the mutex. If the application had crashed it will be WAIT_ABANDONED

**Explanation:** When a thread finishes without releasing the mutex any other process waiting for it can aquire it but it will obtain a WAIT_ABANDONED as return value, meaning the mutex is abandoned and therfore the state of the section it was protected can be unsafe.

This way your second app won't consume any CPU cycles as it will keep waiting for the mutex (and that's enterely handled by the operating system)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T22:48:07.503

How about creating a wrapper application that launches the faulty app as a child and waits for it? If the exit code of the child indicates an error, then restart it, else exit.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-23T21:06:51.243

I think the main problem is that Dr. Watson displays a dialog and keeps your process alive.

You can write your own debugger using the Windows API and run the crashing application from there. This will prevent other debuggers from catching the crash of your application and you could also catch the Exception event.

Since I have not found any sample code, I have written this Python quick-and-dirty sample. I am not sure how robust it is especially the declaration of DEBUG_EVENT could be improved.

```
from ctypes import windll, c_int, Structure
import subprocess

WaitForDebugEvent = windll.kernel32.WaitForDebugEvent    
ContinueDebugEvent = windll.kernel32.ContinueDebugEvent
DBG_CONTINUE = 0x00010002L    
DBG_EXCEPTION_NOT_HANDLED = 0x80010001L

event_names = {    
    3: 'CREATE_PROCESS_DEBUG_EVENT',
    2: 'CREATE_THREAD_DEBUG_EVENT',
    1: 'EXCEPTION_DEBUG_EVENT',
    5: 'EXIT_PROCESS_DEBUG_EVENT',
    4: 'EXIT_THREAD_DEBUG_EVENT',
    6: 'LOAD_DLL_DEBUG_EVENT',
    8: 'OUTPUT_DEBUG_STRING_EVENT', 
    9: 'RIP_EVENT',
    7: 'UNLOAD_DLL_DEBUG_EVENT',
}
class DEBUG_EVENT(Structure):
    _fields_ = [
        ('dwDebugEventCode', c_int),
        ('dwProcessId', c_int),
        ('dwThreadId', c_int),
        ('u', c_int*20)]

def run_with_debugger(args):
    proc = subprocess.Popen(args, creationflags=1)
    event = DEBUG_EVENT()

    while True:
        if WaitForDebugEvent(pointer(event), 10):
            print event_names.get(event.dwDebugEventCode, 
                    'Unknown Event %s' % event.dwDebugEventCode)
            ContinueDebugEvent(event.dwProcessId, event.dwThreadId, DBG_CONTINUE)
        retcode = proc.poll()
        if retcode is not None:
            return retcode

run_with_debugger(['python', 'crash.py']) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T18:17:24.087

I realize that you're dealing with Windows XP, but for people in a similar situation under Vista, there are new [crash recovery API](http://msdn.microsoft.com/en-us/library/aa373347.aspx)s available. [Here's a good introduction](http://community.bartdesmet.net/blogs/bart/archive/2006/11/11/Windows-Vista-Application-Recovery-with-C_2300_.aspx) to what they can do.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-04T10:14:10.310

Here is a slightly improved version.

In my test the previous code run in an infinite loop when the faulty exe generated an "access violation".

I'm not totally satisfied by my solution because I have no clear criteria to know which exception should be continued and which one couldn't be (The ExceptionFlags is of no help).

But it works on the example I run.

Hope it helps, Vivian De Smedt

```
from ctypes import windll, c_uint, c_void_p, Structure, Union, pointer
import subprocess

WaitForDebugEvent = windll.kernel32.WaitForDebugEvent
ContinueDebugEvent = windll.kernel32.ContinueDebugEvent
DBG_CONTINUE = 0x00010002L
DBG_EXCEPTION_NOT_HANDLED = 0x80010001L

event_names = {
    1: 'EXCEPTION_DEBUG_EVENT',
    2: 'CREATE_THREAD_DEBUG_EVENT',
    3: 'CREATE_PROCESS_DEBUG_EVENT',
    4: 'EXIT_THREAD_DEBUG_EVENT',
    5: 'EXIT_PROCESS_DEBUG_EVENT',
    6: 'LOAD_DLL_DEBUG_EVENT',
    7: 'UNLOAD_DLL_DEBUG_EVENT',
    8: 'OUTPUT_DEBUG_STRING_EVENT',
    9: 'RIP_EVENT',
}

EXCEPTION_MAXIMUM_PARAMETERS = 15

EXCEPTION_DATATYPE_MISALIGNMENT  = 0x80000002
EXCEPTION_ACCESS_VIOLATION       = 0xC0000005
EXCEPTION_ILLEGAL_INSTRUCTION    = 0xC000001D
EXCEPTION_ARRAY_BOUNDS_EXCEEDED  = 0xC000008C
EXCEPTION_INT_DIVIDE_BY_ZERO     = 0xC0000094
EXCEPTION_INT_OVERFLOW           = 0xC0000095
EXCEPTION_STACK_OVERFLOW         = 0xC00000FD

class EXCEPTION_DEBUG_INFO(Structure):
    _fields_ = [
        ("ExceptionCode", c_uint),
        ("ExceptionFlags", c_uint),
        ("ExceptionRecord", c_void_p),
        ("ExceptionAddress", c_void_p),
        ("NumberParameters", c_uint),
        ("ExceptionInformation", c_void_p * EXCEPTION_MAXIMUM_PARAMETERS),
    ]

class EXCEPTION_DEBUG_INFO(Structure):
    _fields_ = [
        ('ExceptionRecord', EXCEPTION_DEBUG_INFO),
        ('dwFirstChance', c_uint),
    ]

class DEBUG_EVENT_INFO(Union):
    _fields_ = [
        ("Exception", EXCEPTION_DEBUG_INFO),
    ]

class DEBUG_EVENT(Structure):
    _fields_ = [
        ('dwDebugEventCode', c_uint),
        ('dwProcessId', c_uint),
        ('dwThreadId', c_uint),
        ('u', DEBUG_EVENT_INFO)
    ]

def run_with_debugger(args):
    proc = subprocess.Popen(args, creationflags=1)
    event = DEBUG_EVENT()

    num_exception = 0

    while True:
        if WaitForDebugEvent(pointer(event), 10):
            print event_names.get(event.dwDebugEventCode, 'Unknown Event %s' % event.dwDebugEventCode)

            if event.dwDebugEventCode == 1:
                num_exception += 1

                exception_code = event.u.Exception.ExceptionRecord.ExceptionCode

                if exception_code == 0x80000003L:
                    print "Unknow exception:", hex(exception_code)

                else:
                    if exception_code == EXCEPTION_ACCESS_VIOLATION:
                        print "EXCEPTION_ACCESS_VIOLATION"

                    elif exception_code == EXCEPTION_INT_DIVIDE_BY_ZERO:
                        print "EXCEPTION_INT_DIVIDE_BY_ZERO"

                    elif exception_code == EXCEPTION_STACK_OVERFLOW:
                        print "EXCEPTION_STACK_OVERFLOW"

                    else:
                        print "Other exception:", hex(exception_code)

                    break

            ContinueDebugEvent(event.dwProcessId, event.dwThreadId, DBG_CONTINUE)

        retcode = proc.poll()
        if retcode is not None:
            return retcode

run_with_debugger(['crash.exe']) 
```

# content-management-system - 在单个 umbraco 实例上发布多个站点

> ID：78049
> 
> 赞同：1
> 
> 时间：2008-09-16T22:41:05.880
> 
> 标签：content-management-system, umbraco, sites, hostheaders

我希望为已经将 umbraco 用于其内容管理系统的站点设置一个并行站点。新站点将共享管理员、模板、宏和媒体资源，但不共享任何内容。如果我使用 umbraco 安装设置多个指向同一目录的主机头，如何根据正在访问的 url 切换站点的顶部节点（home 与 home2）？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-17T02:58:31.130

我相信您首先必须更改 umbracosettings.config 中的设置：

```
<useDomainPrefixes>true</useDomainPrefixes> 
```

然后我认为您还必须右键单击每个顶部节点并单击“管理主机名”，然后为该顶部节点添加适当的主机名。

听起来你已经正确配置了 IIS，所以你应该很好地继续这方面的工作。

自从我与 Umbraco 合作以来已经有一段时间了，但我认为我基本上是对的 ;-)

# c++ - 如何通过 COM 遍历 Excel 2003 工作表中的所有分页符

> ID：78053
> 
> 赞同：1
> 
> 时间：2008-09-16T22:41:20.980
> 
> 标签：c++, excel, com, vba

我一直在尝试通过 COM 检索给定 Excel 2003 工作表上所有分页符的位置。这是我正在尝试做的事情的一个例子：

```
Excel::HPageBreaksPtr pHPageBreaks = pSheet->GetHPageBreaks();
long count = pHPageBreaks->Count;
for (long i=0; i < count; ++i)
{
  Excel::HPageBreakPtr pHPageBreak = pHPageBreaks->GetItem(i+1); 
  Excel::RangePtr pLocation = pHPageBreak->GetLocation();

  printf("Page break at row %d\n", pLocation->Row);

  pLocation.Release();
  pHPageBreak.Release();
}
pHPageBreaks.Release(); 
```

我希望这能打印出每个水平分页符的行号`pSheet`。我遇到的问题是，尽管`count`正确指示了工作表中的分页符数，但我似乎只能检索第一个。在循环的第二次运行中，调用`pHPageBreaks->GetItem(i)`会引发异常，错误号为 0x8002000b，“索引无效”。

`pHPageBreaks->Get_NewEnum()`在调用`Get_NewEnum()`.

我四处寻找解决方案，到目前为止我发现的最接近的是 [http://support.microsoft.com/kb/210663/en-us](http://support.microsoft.com/kb/210663/en-us)。我尝试激活分页符之外的各种单元格，包括刚刚超出要打印范围的单元格，以及右下角的单元格（IV65536），但它没有帮助。

如果有人能告诉我如何让 Excel 返回工作表中所有分页符的位置，那就太棒了！

谢谢你。

@Joel：是的，我尝试过显示用户界面，然后设置`ScreenUpdating`为 true - 它产生了相同的结果。此外，我已经尝试将设置组合`pSheet->PrintArea`到整个工作表和/或`pSheet->ResetAllPageBreaks()`在我调用之前调用以获取`HPageBreaks`集合，这也没有帮助。

@Joel：我习惯于`pSheet->UsedRange`确定要滚动过去的行，而 Excel 确实会滚动过去所有水平中断，但是当我尝试访问第二个中断时，我仍然遇到同样的问题。不幸的是，切换到 Excel 2007 也无济于事。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T01:14:02.470

在 Visual Basic 中使用 Excel 2007 进行试验后，我发现分页符是未知的，除非它至少在屏幕上显示过一次。

我能找到的最佳解决方法是向下翻页，从工作表顶部到包含数据的最后一行。然后你可以枚举所有的分页符。

这是 VBA 代码...如果您在将其转换为 COM 时遇到任何问题，请告诉我：

```
Range("A1").Select
numRows = Range("A1").End(xlDown).Row

While ActiveWindow.ScrollRow < numRows
    ActiveWindow.LargeScroll Down:=1
Wend

For Each x In ActiveSheet.HPageBreaks
    Debug.Print x.Location.Row
Next 
```

这段代码做了一个简化的假设：

*   我使用 .End(xlDown) 方法来计算数据的距离......这假设您有从 A1 到工作表底部的连续数据。如果不这样做，则需要使用其他方法来确定要滚动多远。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T00:04:01.843

如知识库文章中所述，您是否将 ScreenUpdating 设置为 True？

您可能希望将其实际切换为 True 以强制重新绘制屏幕。听起来分页符的计算是实际渲染页面的副作用，而不是 Excel 按需执行的操作，因此您必须在屏幕上触发页面渲染。

# user-interface - MFC应用程序的图表控件？

> ID：78061
> 
> 赞同：2
> 
> 时间：2008-09-16T22:42:32.477
> 
> 标签：user-interface, visual-c++, mfc

我想对我们可以在 Visual C++ MFC 应用程序中使用哪些第三方控件提出一些建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T00:21:52.393

我们已经在 ActiveX 和 .Net 风格中部署了[IOComp的 Plot Pack，并取得了巨大的成功。](http://iocomp.com/)很棒的 AP​​I，非常灵活，提供了一个工具栏，让用户可以平移/缩放/自定义。它很坚固，有很长的记录，相对便宜，而且速度非常快。

（顺便说一句，我不隶属于。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T23:42:24.190

Xtreme Toolkit Pro 控件 [http://www.codejock.com/products/toolkitpro/](http://www.codejock.com/products/toolkitpro/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T20:29:11.743

IOComp 包 ( [http://iocomp.com/](http://iocomp.com/) ) 看起来很棒，但对我来说似乎相当昂贵，大约 850 美元的开发者许可证

TeeChart 包 ( [http://www.steema.com](http://www.steema.com) ) 看起来与 450 美元的较小价格相当。他们有一个免费的 50 天评估许可证

在 codeproject有几个*免费的图表控件：*

[http://www.codeproject.com/KB/miscctrl/CBarChart.aspx](http://www.codeproject.com/KB/miscctrl/CBarChart.aspx)

[http://www.codeproject.com/KB/miscctrl/High-speedCharting.aspx](http://www.codeproject.com/KB/miscctrl/High-speedCharting.aspx)

[http://www.codeproject.com/KB/miscctrl/graph2d.aspx](http://www.codeproject.com/KB/miscctrl/graph2d.aspx) 这个我用过。集成过程很尴尬，但它可以完成工作。

FarPoint 和 codejock，AFAIK，没有图表控件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T14:01:07.470

我们使用了 TeeChart 的 ActiveX 版本（[http://www.steema.com/](http://www.steema.com/)），它运行良好，并带有许多 MFC 示例。虽然它是 ActiveX，但在您的情况下这可能是也可能不是问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-18T17:48:24.990

只是为了完整性[科学的图表控制](http://www.codeproject.com/KB/miscctrl/xgraph.aspx)。我前段时间用过，很简单。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-18T01:52:15.227

我见过的最佳 MFC 图表，现代、稳定且写得很好

[http://www.codejock.com/products/chart/](http://www.codejock.com/products/chart/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T23:26:19.470

如果您不介意付款，可以使用 FarPoint Spread：

[http://www.componentsource.com/selec/products/farpoint-spread/summary.html](http://www.componentsource.com/selec/products/farpoint-spread/summary.html)

# asp.net - SSRS 2005 导出到 XLS 时的矩阵和边框样式

> ID：78062
> 
> 赞同：2
> 
> 时间：2008-09-16T22:42:41.133
> 
> 标签：asp.net, reporting-services, reporting, reportviewer, styles

SSRS（SQL Server Reporting Services 2005）中的矩阵在导出到 XLS 时似乎存在某些边框样式的问题（但不是 PDF 或 Web 视图；可能是其他格式，不确定？）。

例如：创建一个矩阵并将矩阵边框样式设置为 Black Solid 1px，但所有 4 个单元格的边框样式为 Black None 1px。通过 ASP.NET 控件查看时，它看起来是正确的。但是在导出到 XLS 之后，它会在所有标题单元格（列和行标题以及左上角的单元格）甚至最右边的数据列周围创建边框。但是报告中间的所有单元格都没有设置边框。

更新：

如果矩阵边框设置为无，则单元格上的边框不会显示在 XLS 中。那么，如何在矩阵周围设置外边框，但不让它在导出到 Excel 时将“所有边”边框应用于每个接触矩阵边缘的单元格？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T23:30:02.440

这似乎是 SSRS 2005 Excel 渲染中的一个错误。我已经能够通过将矩阵 BorderStyle 属性（左、右、上、下）的所有边显式设置为实心来解决此问题。

此外，当您这样做时，似乎将 BorderStyle.Default 属性设置为 Solid 或 None 并不重要。为其他方显式设置的值会覆盖该默认值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-01T06:41:32.107

我在将它导出到 xls 时遇到了这个问题。但这里有一个很酷的技巧来解决这个问题......！在边框中使用自定义格式...已解决

# asp.net - 错误代码或异常 - 这是 ASP.Net Web 服务的最佳实践？

> ID：78064
> 
> 赞同：2
> 
> 时间：2008-09-16T22:43:01.290
> 
> 标签：asp.net, web-services

我读过这个[线程](https://stackoverflow.com/questions/40122/exceptions-in-web-services)，因为 WCF 内置了自定义故障代码和东西。

*但是ASP.Net* Web 服务的最佳实践是什么？我是否抛出异常并让客户端处理异常或发送客户端将依赖其进行处理的错误代码（成功、失败等）。

更新：只是为了进一步讨论*SOAP*的情况，假设客户端进行了一个*web svc*调用，它应该是一个通知消息（没有预期的返回值），所以一切都很顺利，svc 没有抛出异常。

现在客户端如何知道通知调用是否由于通信/网络问题或服务器和客户端之间的某些原因而丢失？将此与未引发任何异常进行比较。客户可能会认为它是成功的。但事实并非如此。电话在某处丢失了。

发送“成功”错误代码是否可以确保客户端通话顺利？有没有其他方法可以实现这一点，或者上面的场景是否可能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-18T10:43:11.940

Jeff Atwood不久前就这个主题发表[了一篇有趣的文章。](http://www.codinghorror.com/blog/archives/000054.html)尽管 .NET 异常被转换为与大多数其他工具包兼容的 SoapFault，但故障中的信息不是很好。因此，文章的结论是 .NET Web 服务不会抛出非常好的异常消息，您应该添加其他信息：

```
Private Sub WebServiceExceptionHandler(ByVal ex As Exception)
    Dim ueh As New AspUnhandledExceptionHandler
    ueh.HandleException(ex)

    '-- Build the detail element of the SOAP fault.
    Dim doc As New System.Xml.XmlDocument
    Dim node As System.Xml.XmlNode = doc.CreateNode(XmlNodeType.Element, _
        SoapException.DetailElementName.Name, _
        SoapException.DetailElementName.Namespace)

    '-- append our error detail string to the SOAP detail element
    Dim details As System.Xml.XmlNode = doc.CreateNode(XmlNodeType.Element, _
        "ExceptionInfo", _
        SoapException.DetailElementName.Namespace)
    details.InnerText = ueh.ExceptionToString(ex)
    node.AppendChild(details)

    '-- re-throw the exception so we can package additional info
    Throw New SoapException("Unhandled Exception: " & ex.Message, _
        SoapException.ClientFaultCode, _
        Context.Request.Url.ToString, node)
End Sub 
```

更多信息为什么soapfaults[在这个问题](https://stackoverflow.com/questions/81306/wcf-faults-exceptions-versus-messages)上更好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T22:59:36.053

取决于您将如何使用 Web 服务 - 即您将使用哪种协议。

如果是 GET 或 POST，最好返回错误码，因为调用 HttpWebRequest (.Net) 或其他代码会收到服务器错误，必须对其进行处理以提取异常码。

如果是 SOAP - 那么抛出自定义异常是完全可以的（您不想返回内部框架异常，因为它们可能会向外部各方透露一些堆栈跟踪等）。

由于 SOAP Web 服务恰好将调用代码视为正常的方法调用，因此相应的调用框架应该能够很好地处理和传播异常，从而使调用代码的外观和行为与其处理内部调用一样.

# visual-studio - 任何好的 PowerShell MSBuild 任务？

> ID：78069
> 
> 赞同：5
> 
> 时间：2008-09-16T22:44:14.250
> 
> 标签：visual-studio, powershell, msbuild

任何人都知道将执行 PowerShell 脚本并传递不同参数的任何好的 MSBuild 任务吗？

我能够找到[B# .NET 博客：Invoking PowerShell scripts from MSBuild](http://bartdesmet.net/blogs/bart/archive/2008/02/16/invoking-powershell-scripts-from-msbuild.aspx)，但我希望得到一些更精致的东西。

如果我找不到任何东西，我当然会继续使用该博客文章作为入门来完善我自己的内容。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-08-12T05:45:30.323

对于 3.5，可以使用[http://powershellmsbuild.codeplex.com/ 。](http://powershellmsbuild.codeplex.com/)[如果有一个可以通过 NuGet package restore 使用的 NuGet 包，那就太好了](https://web.archive.org/web/20171226175241/http://powershellmsbuild.codeplex.com/discussions/348378)。

4.0 有一个[Windows Powershell 任务工厂](https://devblogs.microsoft.com/visualstudio/msbuild-task-factories-guest-starring-windows-powershell/)，~~您可以[在代码库](https://docs.microsoft.com/en-us/samples/browse/)~~中获得它已被纳入 [MSBuild 扩展包（顶级任务库之一 - 400 多个任务并在 MSBuild 内部推荐）](https://archive.codeplex.com/?p=msbuildextensionpack)有（从[下载部分](https://web.archive.org/web/20150203103526/http://msbuildextensionpack.codeplex.com:80/releases/view/77212)`PowerShellTaskFactory`下载帮助文件[这个示例发布](https://web.archive.org/web/20150203103526/http://msbuildextensionpack.codeplex.com:80/releases/view/77212)有一个偷看）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-17T05:24:58.203

您可能还想查看[Psake](https://github.com/psake/psake) - 基于 PowerShell 的构建环境。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-10-10T10:48:17.090

[我发布了重复的问题和答案](https://stackoverflow.com/questions/11648530/in-msbuild-how-do-i-run-something-powershell-and-have-all-errors-reported)，在这里为后代投票关闭。关键区别在于，这个问题被限制为**OOTB**，而我的自我回答保持在该限制范围内。

# 问题

Powershell 似乎没有一种简单的方法来使用任意命令触发它，然后以与非 PowerShell 的调用者正确互操作的方式冒泡解析和执行错误 - 例如`cmd.exe`，[TeamCity](https://stackoverflow.com/questions/11647987/how-do-i-get-errors-to-propagate-in-the-teamcity-powershell-runner)等。

我的问题很简单。使用 OOTB MSBuild v4 和 PowerShell v3 对我来说最好的方法是什么（接受建议 - 不会排除适合生产的 MSBuild 任务，但它需要比建议“这很容易 - 使用 PowerShell 任务工厂示例和调整它和/或成为它的维护者/父”）来运行一个命令（一个小的脚本段，或者（最常见的）一个`.ps1`脚本的调用。

我认为它应该是正常的，例如：

```
<Exec 
  IgnoreStandardErrorWarningFormat="true"
  Command="PowerShell &quot;$(ThingToDo)&quot;" /> 
```

* * *

可悲的是，这不起作用：-

1.  如果`ThingToDo`解析失败，则静默失败
2.  如果`ThingToDo`是不存在的脚本调用，则失败
3.  如果你想传播一个`ERRORLEVEL`基于`.cmd`结果的结果，它会变得毛茸茸的
4.  如果你想在 中嵌入`"`引号`ThingToDo`，它将不起作用

那么，从 MSBuild 运行 PowerShell 的防弹方法应该是什么？有什么我可以[PsGet](http://psget.net/)让一切正常的吗？

# 回答

Weeeeelll，您可以使用像这样冗长的东西，直到找到更好的方法：-

```
<PropertyGroup>
  <__PsInvokeCommand>powershell "Invoke-Command</__PsInvokeCommand>
  <__BlockBegin>-ScriptBlock { $errorActionPreference='Stop';</__BlockBegin>
  <__BlockEnd>; exit $LASTEXITCODE }</__BlockEnd>
  <_PsCmdStart>$(__PsInvokeCommand) $(__BlockBegin)</_PsCmdStart>
  <_PsCmdEnd>$(__BlockEnd)"</_PsCmdEnd>
</PropertyGroup> 
```

然后你需要做的“所有”就是：

```
<Exec 
  IgnoreStandardErrorWarningFormat="true"
  Command="$(_PsCmdStart)$(ThingToDo)$(_PsCmdEnd)" /> 
```

这个唯一的赎回功能（除了捕获我能想到的所有错误类型）是它适用于任何 PowerShell 版本和任何 MSBuild 版本的 OOTB。

我去拿我的外套。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-12-09T01:36:37.073

带着一点乐趣，我设法想出了一个相当干净的方法来完成这项工作：

```
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- #1 Place this line at the top of any msbuild script (ie, csproj, etc) -->
  <PropertyGroup><PowerShell># 2>nul || type %~df0|find /v "setlocal"|find /v "errorlevel"|powershell.exe -noninteractive -&amp; exit %errorlevel% || #</PowerShell></PropertyGroup>

  <!-- #2 in any target you want to run a script -->
  <Target Name="default" >

    <PropertyGroup> <!-- #3 prefix your powershell script with the $(PowerShell) variable, then code as normal! -->
      <myscript>$(PowerShell)
      #
      # powershell script can do whatever you need.
      #
      dir ".\*.cs" -recurse |% {
        write-host Examining file named:  $_.FullName
        # do other stuff here...
      } 
      $answer = 2+5
      write-host Answer is $answer !
      </myscript>
    </PropertyGroup>

    <!-- #4 and execute the script like this -->
    <Exec Command="$(myscript)" EchoOff="true" /> 
  </Target>
</Project> 
```

# 笔记：

*   您仍然可以使用标准的执行任务功能！（见：[https](https://msdn.microsoft.com/en-us/library/x8zx72cd.aspx) ://msdn.microsoft.com/en-us/library/x8zx72cd.aspx ）
*   如果您的 powershell 脚本需要使用 < > 或 & 字符，只需将内容放在 CDATA 包装器中：

    ```
    <script2><![CDATA[  $(PowerShell)
      # your powershell code goes here!
      write-host "<<Hi mom!>>"
    ]]></script2> 
    ```

*   如果您想将项目返回到 msbuild 脚本，您可以获取它们：

    ```
    <script3>$(PowerShell)
      # your powershell code goes here!
      (dir "*.cs" -recurse).FullName
    </script3>

    <Exec Command="$(script3)" EchoOff="true" ConsoleToMSBuild="true"> 
        <Output TaskParameter="ConsoleOutput" PropertyName="items" />
    </Exec>
    <Touch Files="$(items)" /> 
    ```

看！然后您可以将这些项目与另一个 msbuild 任务一起使用：D

# sorting - 字母数字排序

> ID：78077
> 
> 赞同：1
> 
> 时间：2008-09-16T22:45:27.087
> 
> 标签：sorting, alphanumeric

对字母数字字段进行排序的最佳/最快方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T22:50:02.177

您无需指定目标语言，但无论它是什么，它都应该具有可靠的内置排序方法，因此请使用其中一种！对于 PHP...

加载到数组中并排序($array);

[php排序](http://ie.php.net/sort)...

```
$fruits = array("lemon", "orange", "banana", "apple");
sort($fruits);

foreach ($fruits as $key => $val)
{
    echo "fruits[" . $key . "] = " . $val . "\n";
} 
```

输出：

```
fruits[0] = apple
fruits[1] = banana
fruits[2] = lemon
fruits[3] = orange 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T22:50:15.000

[冒泡排序](http://en.wikipedia.org/wiki/Bubble_sort)！只是在开玩笑 ：）

可能您最好的选择是[quicksort](http://en.wikipedia.org/wiki/Quicksort)或[mergesort](http://en.wikipedia.org/wiki/Merge_sort)。

两者都是 O(nlogn) 而不是冒泡排序的 O(n^2)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T22:52:18.960

您的问题的答案与您未提供的一些细节密切相关。“最佳/最快”的方式取决于字段的长度、您必须排序的数量、可用的内存量、磁盘和内存的相对速度、字符串中的内容的详细信息，...，*广告恶心*。

Knuth Vol 3 详细介绍了各种方法。我不记得他是否讨论过基数排序，但他可能会讨论。如果他没有，您应该查找有关 Radix Sorting 的一些参考资料。它仅在有限的情况下有用，但确实有效。如果您有一小部分短字符串，由于开销较低，冒泡排序在某些架构上的性能将优于复杂排序。C 运行时库包括一个版本的快速排序，因为在某些情况下，它对于较大的数据集可能是一种非常有效的算法。

Net-net，答案是“视情况而定”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T22:52:31.860

“最佳”方式取决于很多因素：

1.  您需要支持的不仅仅是语言吗？
2.  您是否需要同时支持一种以上的语言？
3.  您是否需要支持当前操作系统或用户语言以外的语言？（例如，网络应用程序）
4.  您是否需要支持多种编码？（unicode、utf-16le/utf-8、ansi 代码页等）
5.  您是否需要支持长输入或高度冗余输入？（预计算或压缩可能会加快排序操作）
6.  您是否需要支持大量输入，例如：百万或十亿输入？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T22:48:09.030

您会发现大多数开发库都附带了快速排序算法的实现，这通常是最快的排序算法。在此处查看[Wikipedia 链接](http://en.wikipedia.org/wiki/Quicksort)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T22:50:17.217

在 C# 中，List 具有 .Sort()。

一般来说，QuickSort 在很多情况下都非常快，但它总是取决于数组的大小，

这是[链接](http://en.wikipedia.org/wiki/Quicksort)

# perl - 如何从 Perl 脚本中捕获系统命令的标准输入和标准输出？

> ID：78091
> 
> 赞同：4
> 
> 时间：2008-09-16T22:47:41.543
> 
> 标签：perl, ipc

在 Perl 脚本的中间，有一个我要执行的系统命令。我有一个字符串，其中包含需要输入标准输入的数据（该命令只接受来自标准输入的输入），我需要捕获写入标准输出的输出。我已经查看了在 Perl 中执行系统命令的各种方法，并且该`open`功能似乎是我所需要的，只是看起来我只能捕获标准输入或标准输出，而不是两者。

目前，似乎我最好的解决方案是使用`open`，将标准输出重定向到一个临时文件，并在命令完成后从文件中读取。有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-17T03:41:23.867

IPC::Open2/3 很好，但我发现通常我真正需要的只是[IPC::Run3](http://metacpan.org/pod/IPC::Run3)，它以最小的复杂性很好地处理简单的情况：

```
use IPC::Run3;    # Exports run3() by default

run3( \@cmd, \$in, \$out, \$err ); 
```

该文档将 IPC::Run3 与其他替代方案进行了比较。即使您不决定使用它也值得一读。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T22:48:55.457

IPC::Open3 可能会做你想做的事。它可以捕获 STDERR 和 STDOUT。

[http://metacpan.org/pod/IPC::Open3](http://metacpan.org/pod/IPC::Open3)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T23:04:01.287

在脚本顶部的某处，包括该行

```
use IPC::Open2; 
```

这将包括必要的模块，通常默认安装在大多数 Perl 发行版中。（如果你没有它，你可以使用 CPAN 安装它。）然后，而不是打开，调用：

```
$pid = open2($cmd_out, $cmd_in, 'some cmd and args'); 
```

您可以通过将数据发送到 $cmd_in 来将数据发送到您的命令，然后通过读取 $cmd_out 来读取命令的输出。

如果您还希望能够读取命令的 stderr 流，则可以改用 IPC::Open3 模块。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-17T02:31:29.463

[perlipc 文档](http://perldoc.perl.org/perlipc.html)涵盖了您可以执行此操作的多种方法，包括 IPC::Open2 和 IPC::Open3。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T11:36:36.623

我最近发现的一个非常简单的方法是**IPC [::Filter](http://p3rl.org/IPC::Filter)模块**。它使您可以非常直观地完成工作：

```
$output = filter $input, 'somecmd', '--with', 'various=args', '--etc'; 
```

请注意，如果您将列表传递给它，它会如何调用您的命令而无需通过 shell。它还可以合理地处理常见实用程序的错误。（失败时，它`die`使用来自 STDERR 的文本作为其错误消息；成功时，STDERR 将被丢弃。）

当然，它不适合处理大量数据，因为它无法进行任何流处理；此外，错误处理可能不足以满足您的需求。但它使许多简单的案例变得*非常*简单。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T22:49:23.537

我想你想看看[IPC::Open2](http://search.cpan.org/~rgarcia/perl-5.10.0/lib/IPC/Open2.pm)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T22:54:19.233

有一个特殊的 perl 命令

```
open2() 
```

更多信息请访问：[http ://sunsite.ualberta.ca/Documentation/Misc/perl-5.6.1/lib/IPC/Open2.html](http://sunsite.ualberta.ca/Documentation/Misc/perl-5.6.1/lib/IPC/Open2.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T23:26:16.427

如果我只期望单行输出或想要将结果拆分为换行符以外的其他内容，我总是这样做：

```
my $result = qx( command args 2>&1 );  
my $rc=$?;  
# $rc >> 8 is the exit code of the called program.

if ($rc != 0 ) {  
    error();  
} 
```

如果要处理多行响应，请将结果作为数组获取：

```
my @lines = qx( command args 2>&1 );  

foreach ( my $line ) (@lines) {  
    if ( $line =~ /some pattern/ ) {  
        do_something();  
    }  
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T08:53:45.767

如果你不想包含额外的包，你可以这样做

```
open(TMP,">tmpfile");
print TMP  $tmpdata ;
open(RES,"$yourcommand|");
$res = "" ;
while(<RES>){
$res .= $_ ;
} 
```

这与您的建议相反，但也应该有效。

# php - apache模块与cgi（关于安全性）之间有区别吗？

> ID：78108
> 
> 赞同：17
> 
> 时间：2008-09-16T22:49:22.443
> 
> 标签：php, perl, apache, mod-perl, mod-php

**例如**`mod_php`，使用而不是更安全`php-cgi`吗？还是使用起来`mod_perl`比传统的更安全`cgi-scripts`？

我主要对安全问题感兴趣，但如果存在显着差异，速度可能是一个问题。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-16T23:02:53.223

什么意义上的安全？无论哪种方式，它实际上都取决于正在运行的脚本以及编写的好坏。这些天太多的脚本是半途而废的，并且没有正确地进行输入验证。

我个人更喜欢 FastCGI 而不是 mod_php，因为如果一个 FastCGI 进程死了，就会产生一个新的进程，而我已经看到 mod_php 杀死了整个 Apache。

至于安全性，使用 FastCGI 从技术上讲，您可以在与默认 Web 服务器用户不同的用户下运行 php 进程。

另外，如果您使用 Apache 的新工作线程支持，您需要确保您没有使用 mod_php，因为某些扩展不是线程安全的，并且会导致竞争条件。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T23:19:41.170

如果您运行自己的服务器，则采用模块方式，它会更快一些。如果您在共享服务器上，则已经为您做出了决定，通常是在 CGI 方面。原因是文件系统权限。PHP 作为一个模块以 http 服务器（通常是“apache”）的权限运行，除非您可以将脚本更改为该用户，否则您必须将它们更改为 777 - 世界可读。唉，这意味着您的服务器邻居可以查看它们 - 想想您存储数据库访问密码的位置。大多数共享服务器已经使用诸如 phpsuexec 之类的东西解决了这个问题，它们以脚本所有者的权限运行脚本，因此您可以（必须）将您的代码更改为 644。Phpsuexec 仅与 PHP 作为 CGI 一起运行 - 这或多或少是全部， 它'

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T22:52:55.383

大多数安全漏洞是由于脚本本身的糟糕编程而发生的，所以如果它们作为 cgi 或模块运行，这真的有点没有实际意义。也就是说，apache 模块可能会导致整个网络服务器崩溃（尤其是在使用线程 MPM 时），而 mod_php 以它而闻名。

cgi 会慢一些，但现在有解决方案，主要是 FastCGI 和朋友。

你的威胁模型是什么？

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-16T23:16:22.817

**来自 PHP 5.2.6 的 PHP install.txt 文档：**

与 CGI 二进制文件相比，服务器模块提供了明显更好的性能和附加功能。

**对于 IIS/PWS：**

警告

通过使用 CGI 设置，您的服务器会受到多种可能的攻击。请阅读我们的 CGI 安全部分，了解如何保护自己免受这些攻击。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-17T02:27:44.260

像 mod_php 或 FastCGI 这样的模块比普通 CGI 快得令人难以置信。只是不要做 CGI。正如其他人所说，PHP 程序本身是最大的安全威胁，但忽略了共享主机上的另一个考虑因素。

如果您的脚本与其他 php 程序位于共享主机上并且该主机未在安全模式下运行，那么很可能所有服务器进程都以同一用户身份运行。这可能意味着任何其他 php 脚本都可以读取您自己的，包括数据库密码。因此，请务必调查服务器配置，以确保您的代码对其他人不可读。

即使您控制自己的主机，请记住，服务器上的另一个被黑客入侵的 Web 应用程序可能是进入其他人的渠道。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T22:52:13.450

使用内置模块肯定会比使用 CGI 更快。安全隐患取决于配置。在默认配置中它们几乎相同，但 cgi 允许一些内置模块无法提供的更安全的配置，特别是在共享主机的上下文中。您究竟想保护自己免受什么侵害？

# c - 为什么我不能在 C 中将 'char**' 转换为 'const char* const*'？

> ID：78125
> 
> 赞同：60
> 
> 时间：2008-09-16T22:50:30.617
> 
> 标签：c, pointers, constants, const-correctness

以下代码片段（正确）在 C 中给出警告，在 C++ 中给出错误（分别使用 gcc 和 g++，使用版本 3.4.5 和 4.2.1 进行测试；MSVC 似乎并不关心）：

```
char **a;
const char** b = a; 
```

我可以理解并接受这一点。
此问题的 C++ 解决方案是将 b 更改为 const char * const *，这不允许重新分配指针并防止您规避 const-correctness ( [C++ FAQ](http://www.parashift.com/c++-faq-lite/const-correctness.html#faq-18.17) )。

```
char **a;
const char* const* b = a; 
```

但是，在纯 C 中，更正后的版本（使用 const char * const *）仍然会发出警告，我不明白为什么。有没有办法在不使用演员表的情况下解决这个问题？

澄清：
1）为什么这会在C中产生警告？它应该是完全 const 安全的，而且 C++ 编译器似乎也能认出它。
2）在说（并让编译器强制执行）我不会修改它指向的字符的同时，接受这个 char** 作为参数的正确方法是什么？例如，如果我想写一个函数：

```
void f(const char* const* in) {
  // Only reads the data from in, does not write to it
} 
```

我想在 char** 上调用它，参数的正确类型是什么？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-09-16T23:04:21.097

几年前我也遇到过同样的问题，这让我很恼火。

C 中的规则更简单地说明（即它们没有列出转换`char**`为等例外情况`const char*const*`）。结果，就是不允许。在 C++ 标准中，它们包含了更多规则来允许这样的情况。

最后，这只是C标准中的一个问题。我希望下一个标准（或技术报告）能解决这个问题。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-16T23:08:36.500

> 但是，在纯 C 中，这仍然会发出警告，我不明白为什么

您已经发现了问题——此代码不是 const 正确的。“const 正确”意味着，除了`const_cast`C 风格的强制类型转换 remove之外`const`，您永远`const`不能通过那些 const 指针或引用来修改对象。

`const`-correctness的价值`const`在很大程度上是为了检测程序员的错误。如果您将某些内容声明为`const`，则表示您认为不应该修改它——或者至少，那些`const`只能访问该版本的人不应该能够修改它。考虑：

```
void foo(const int*); 
```

如声明的那样，`foo`无权*修改*其参数指向的整数。

如果您不确定为什么您发布的代码不正确，请`const`考虑以下代码，与 HappyDude 的代码略有不同：

```
char *y;

char **a = &y; // a points to y
const char **b = a; // now b also points to y

// const protection has been violated, because:

const char x = 42; // x must never be modified
*b = &x; // the type of *b is const char *, so set it 
         //     with &x which is const char* ..
         //     ..  so y is set to &x... oops;
*y = 43; // y == &x... so attempting to modify const 
         //     variable.  oops!  undefined behavior!
cout << x << endl; 
```

非`const`类型只能以特定方式转换为 const 类型，以防止`const`在没有显式转换的情况下对数据类型进行任何规避。

最初声明`const`的对象特别特别——编译器可以假设它们永远不会改变。但是，如果`b`可以在`a`不进行强制转换的情况下为其分配值，那么您可能会无意中尝试修改`const`变量。这不仅会破坏您要求编译器进行的检查，禁止您更改该变量值 - 它还会允许您破坏编译器优化！

在某些编译器上，这将打印`42`，在某些`43`和其他编译器上，程序将崩溃。

**编辑添加：**

HappyDude：你的评论很到位。无论是 C 语言，还是您使用的 C 编译器，其处理方式都`const char * const *`与 C++ 语言处理方式根本不同。也许考虑只为这个源代码行消除编译器警告。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-17T00:06:21.853

为了被认为是兼容的，源指针在直接前间接级别中应该是 const 。因此，这将在 GCC 中向您发出警告：

```
char **a;
const char* const* b = a; 
```

但这不会：

```
const char **a;
const char* const* b = a; 
```

或者，您可以投射它：

```
char **a;
const char* const* b = (const char **)a; 
```

您将需要相同的演员阵容来调用您提到的函数 f() 。据我所知，在这种情况下无法进行隐式转换（C++ 除外）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T00:41:00.083

这很烦人，但是如果您愿意添加另一个级别的重定向，您通常可以执行以下操作来下推指针到指针：

```
char c = 'c';
char *p = &c;
char **a = &p;

const char *bi = *a;
const char * const * b = &bi; 
```

它的含义略有不同，但通常是可行的，并且不使用强制转换。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T23:42:06.250

至少在 MSVC 14 (VS2k5) 和 g++ 3.3.3 上隐式将 char** 转换为 const char * const * 时，我无法得到错误。GCC 3.3.3 发出警告，我不确定这样做是否正确。

测试.c：

```
#include <stdlib.h> 
#include <stdio.h>
void foo(const char * const * bar)
{
    printf("bar %s null\n", bar ? "is not" : "is");
}

int main(int argc, char **argv) 
{
    char **x = NULL; 
    const char* const*y = x;
    foo(x);
    foo(y);
    return 0; 
} 
```

编译为 C 代码的输出：cl /TC /W4 /Wp64 test.c

```
test.c(8) : warning C4100: 'argv' : unreferenced formal parameter
test.c(8) : warning C4100: 'argc' : unreferenced formal parameter 
```

编译为 C++ 代码的输出：cl /TP /W4 /Wp64 test.c

```
test.c(8) : warning C4100: 'argv' : unreferenced formal parameter
test.c(8) : warning C4100: 'argc' : unreferenced formal parameter 
```

使用 gcc 输出：gcc -Wall test.c

```
test2.c: In function `main':
test2.c:11: warning: initialization from incompatible pointer type
test2.c:12: warning: passing arg 1 of `foo' from incompatible pointer type 
```

使用 g++ 输出：g++ -Wall test.C

*没有输出*

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T23:46:37.657

我很确定 const 关键字并不意味着数据不能更改/不变，只是数据将被视为只读。考虑一下：

```
const volatile int *const serial_port = SERIAL_PORT; 
```

这是有效的代码。volatile 和 const 如何共存？简单的。volatile 告诉编译器在使用数据时始终读取内存，而 const 告诉编译器在尝试使用 serial_port 指针写入内存时创建错误。

const 是否有助于编译器的优化器？一点都不。因为 const 可以通过转换添加到数据中或从数据中删除，编译器无法确定 const 数据是否真的是常量（因为转换可以在不同的翻译单元中完成）。在 C++ 中，您还可以使用 mutable 关键字使事情进一步复杂化。

```
char *const p = (char *) 0xb000;
//error: p = (char *) 0xc000;
char **q = (char **)&p;
*q = (char *)0xc000; // p is now 0xc000 
```

当尝试写入真正只读的内存（例如，ROM）时会发生什么，标准中可能根本没有定义。

# c - CGPathAddArc 与 CGPathAddArcToPoint

> ID：78127
> 
> 赞同：13
> 
> 时间：2008-09-16T22:50:43.923
> 
> 标签：c, macos, drawing, core-graphics

Apple 的 CoreGraphics 库定义了两个用于描述弧的函数。

*   CGPathAddArc 基于中心点、半径和角度对添加弧。
*   CGPathAddArcToPoint 基于半径和一对切线添加弧。

详细信息在[CGPath API 参考](http://developer.apple.com/documentation/GraphicsImaging/Reference/CGPath/Reference/reference.html)中进行了说明。为什么要两个函数？简单方便？一个比另一个更有效吗？一个是根据另一个定义的吗？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2013-09-28T09:31:10.803

`CGContextAddArc`做这个：

![添加弧](https://twistedape.me.uk/blog/images/AddArc.png)

其中红线是要绘制的内容， sA 是`startAngle`， eA 是`endAngle`， r 是`radius`， x 和 y 是`x`和`y`。如果您有前一点，则该函数将从该点到弧的起点排列（除非您小心，这条线不会与弧的方向相同）。

`CGContextAddArcToPoint`像这样工作：

![添加弧](https://www.twistedape.me.uk/blog/images/2013-09-23-what-arctopoint-does-addArcToPoint.png)

其中 P1 是路径的当前点，x1, x2, y1, y2 匹配函数`x1`, `x2`, `y1`, `y2`r 是`radius`。圆弧的起点与当前点 和 之间的直线的方向相同，并以和`(x1, y1)`之间的方向结束。它不会排队它会停在圆圈的尽头。`(x1, y1)``(x2, y2)``(x2, y2)`

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T22:59:07.040

前者为您提供了一个圆的一部分（实际上是一个的近似值），而后者揭示了您正在创建 Bézier 路径的事实。根据您实际绘制的内容，其中一种可能更方便。您真的可以考虑为 CGPathAddCurveToPoint 提供这两种便利。

# c# - 从派生类自动调用 base.Dispose()

> ID：78141
> 
> 赞同：2
> 
> 时间：2008-09-16T22:53:15.337
> 
> 标签：c#, reflection, idisposable

## 编辑 - 新问题

好的，让我们更笼统地重新表述这个问题。

使用反射，有没有办法在运行时动态调用您可能覆盖的基类方法。您不能在编译时使用“base”关键字，因为您无法确定它是否存在。在运行时，我想列出我的祖先方法并调用祖先方法。

我尝试使用 GetMethods() 等，但它们返回的只是指向该方法的最派生实现的“指针”。不是基类的实现。

## 背景

我们正在使用 C# 3.0 开发一个具有相对较大的类层次结构的系统。其中一些类，在层次结构中的任何位置，都具有需要释放的资源，它们实现了**IDisposable**接口。

## 问题

现在，为了方便代码的维护和重构，我想为实现 IDisposable 的类找到一种方法，如果任何祖先也实现 IDisposable ，则“自动”调用**base.Dispose(bDisposing) 。**这样，如果层次结构中较高的某个类开始实现或停止实现 IDisposable，它将自动得到处理。

问题有两个方面。

*   首先，查找是否有任何祖先实现了 IDisposable。
*   其次，有条件地调用 base.Dispose(bDisposing)。

第一部分，关于实现 IDisposable 的祖先的发现，我已经能够处理。

第二部分是棘手的部分。尽管我付出了所有努力，但我还是无法从派生类中调用 base.Dispose(bDisposing)。我所有的尝试都失败了。它们要么导致编译错误，要么调用错误的 Dispose() 方法，这是最衍生的方法，因此永远循环。

主要问题是，如果没有实现它的祖先之类的东西，您**实际上不能在代码中直接引用 base.Dispose() （请***注意，可能还没有实现 IDisposable 的祖先，但我希望派生代码准备好何时以及如果将来发生这样的事情*）。这给我们留下了**反射**机制，但我没有找到合适的方法。我们的代码充满了先进的反射技术，我想我没有错过任何明显的东西。

## 我的解决方案

我最好的办法是在注释代码中使用一些条件代码。更改 IDisposable 层次结构会破坏构建（如果不存在 IDisposable 祖先）或引发异常（如果存在 IDisposable 祖先但未调用 base.Dispose）。

这是我发布的一些代码，向您展示我的 Dispose(bDisposing) 方法的外观。我将此代码放在整个层次结构中所有 Dispose() 方法的末尾。任何新类都是从也包含此代码的模板创建的。

```
public class MyOtherClassBase
{
    // ...
}

public class MyDerivedClass : MyOtherClassBase, ICalibrable
{

    private bool m_bDisposed = false;

    ~MyDerivedClass()
    {
        Dispose(false);
    }

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    protected virtual void Dispose(bool bDisposing)
    {
        if (!m_bDisposed) {
            if (bDisposing) {
                // Dispose managed resources
            }
            // Dispose unmanaged resources
        }
        m_bDisposed = true;

        Type baseType = typeof(MyDerivedClass).BaseType;
        if (baseType != null) {
            if (baseType.GetInterface("IDisposable") != null) {
                // If you have no ancestors implementing base.Dispose(...), comment
                // the following line AND uncomment the throw. 
                //
                // This way, if any of your ancestors decide one day to implement 
                // IDisposable you will know about it right away and proceed to 
                // uncomment the base.Dispose(...) in addition to commenting the throw.
                //base.Dispose(bDisposing);
                throw new ApplicationException("Ancestor base.Dispose(...) not called - " 
                                               + baseType.ToString());
            }
        }
    }
} 
```

**所以，我问有没有办法自动/有条件地调用 base.Dispose() ？**

## 更多背景

应用程序中还有另一种机制，其中所有对象都注册到一个主类。该类检查它们是否实现了 IDisposable。如果是这样，它们将由应用程序正确处理。这避免了使用类来处理自己调用 Dispose() 的代码。因此，将 IDisposable 添加到没有 IDisposable 祖先历史的类中仍然可以正常工作。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-16T23:24:31.907

标准模式是让您的基类实现 IDisposable 和非虚拟 Dispose() 方法，并实现一个虚拟 Dispose(bool) 方法，那些持有一次性资源的类必须覆盖该方法。他们应该始终调用他们的基本 Dispose(bool) 方法，该方法最终将链接到层次结构中的顶级类。只有那些覆盖它的类才会被调用，所以链通常很短。

终结器，在 C# 中拼写为 ~Class：不要。很少有类需要一个，并且很容易意外地保留大型对象图，因为终结器在释放内存之前至少需要两个集合。在对象不再被引用后的第一个集合中，它被放入一个要运行的终结器队列中。这些*在单独的专用线程上运行*仅运行终结器（如果它被阻止，则不再运行终结器并且您的内存使用量会爆炸）。一旦终结器运行，收集适当代的下一个集合将释放对象以及它引用的任何其他未引用的对象。不幸的是，因为它在第一次收集中幸存下来，它将被放置到收集频率较低的老一代中。因此，您应该尽早并经常处理。

通常，您应该实现一个*仅*管理资源生命周期的小型资源包装器类，并在该类上实现终结器以及 IDisposable。然后，该类的用户应在处置它时对此调用 Dispose。不应该有指向用户的反向链接。这样，只有真正需要终结的东西才会出现在终结队列中。

如果您要在层次结构中的任何位置需要它们，则实现 IDisposable 的基类应实现终结器并调用 Dispose(bool)，并将 false 作为参数传递。

警告 Windows Mobile 开发人员（VS2005 和 2008、.NET Compact Framework 2.0 和 3.5）：您放置在设计器表面上的许多非控件，例如菜单栏、计时器、HardwareButtons，派生自 System.ComponentModel.Component，它实现了一个终结者。对于桌面项目，Visual Studio 将组件添加到名为 的 System.ComponentModel.Container`components`中，它会在 Disposed 表单时生成要 Dispose 的代码 - 它反过来会 Dispose 所有已添加的组件。对于移动项目，`components`会生成 Dispose 的代码，*但将组件放到表面上不会生成将其添加到`components`*. 调用 InitializeComponent 后，您必须自己在构造函数中执行此操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T23:09:54.547

就个人而言，我认为你最好用 FxCop 之类的东西来处理这个问题。您应该能够编写一个规则来检查是否在创建实现 IDisposable 的对象时使用 using 语句。

自动处理对象似乎有点脏（对我来说）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-09T23:08:53.053

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace TestDisposeInheritance
{
    class Program
    {
        static void Main(string[] args)
        {
            classC c = new classC();
            c.Dispose();
        }
    }

    class classA: IDisposable 
    { 
        private bool m_bDisposed;
        protected virtual void Dispose(bool bDisposing)
        {
            if (!m_bDisposed)
            {
                if (bDisposing)
                {
                    // Dispose managed resources
                    Console.WriteLine("Dispose A"); 
                }
                // Dispose unmanaged resources 
            }
        }
        public void Dispose() 
        {
            Dispose(true);
            GC.SuppressFinalize(this);
            Console.WriteLine("Disposing A"); 
        } 
    } 

    class classB : classA, IDisposable 
    {
        private bool m_bDisposed;
        public void Dispose()
        {
            Dispose(true);
            base.Dispose();
            GC.SuppressFinalize(this);
            Console.WriteLine("Disposing B");
        }

        protected override void Dispose(bool bDisposing)
        {
            if (!m_bDisposed)
            {
                if (bDisposing)
                {
                    // Dispose managed resources
                    Console.WriteLine("Dispose B");
                }
                // Dispose unmanaged resources 
            }
        }
    } 

    class classC : classB, IDisposable 
    {
        private bool m_bDisposed;
        public void Dispose() 
        {
            Dispose(true);
            base.Dispose();
            GC.SuppressFinalize(this);
            Console.WriteLine("Disposing C");             
        }
        protected override void Dispose(bool bDisposing)
        {
            if (!m_bDisposed)
            {
                if (bDisposing)
                {
                    // Dispose managed resources
                    Console.WriteLine("Dispose C");             
                }
                // Dispose unmanaged resources 
            }
        }
    } 

} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-17T09:56:27.340

没有“公认”的方式来做到这一点。你真的想让你的清理逻辑（无论是在 Dispose 还是终结器中运行）尽可能简单，这样它就不会失败。在 dispose（尤其是终结器）内部使用反射通常是一个坏主意。

至于实现终结器，一般来说你不需要。终结器会为您的对象增加成本，并且很难正确编写，因为您通常可以对对象的状态和运行时做出的大多数假设都是无效的。

有关 Dispose 模式的更多信息，请参阅[本文](http://www.codeproject.com/KB/cs/idisposable.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T23:14:40.527

如果你想使用 [basetype].Invoke("Dispose"...) 那么你可以在没有调试器抱怨的情况下实现函数调用。然后稍后当基类型实际实现 IDisposable 接口时，它将执行正确的调用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T23:18:31.720

如果你想使用 [basetype].Invoke("Dispose"...) 那么你可以在没有调试器抱怨的情况下实现函数调用。然后稍后当基类型实际实现 IDisposable 接口时，它将执行正确的调用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T23:26:06.193

```
public class MyVeryBaseClass {
    protected void RealDispose(bool isDisposing) {
        IDisposable tryme = this as IDisposable;
        if (tryme != null) { // we implement IDisposable
            this.Dispose();
            base.RealDispose(isDisposing);
        }
    }
}
public class FirstChild : MyVeryBaseClasee {
    //non-disposable
}
public class SecondChild : FirstChild, IDisposable {
    ~SecondChild() {
        Dispose(false);
    }
    public void Dispose() {
        Dispose(true);
        GC.SuppressFinalize(this);
        base.RealDispose(true);
    }
    protected virtual void Dispose(bool bDisposing) {
        if (!m_bDisposed) {
            if (bDisposing) {
            }// Dispose managed resources
        } // Dispose unmanaged resources
    }
} 
```

这样，您只负责实现 IDisposable 的第一个类。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T23:53:37.703

尝试这个。这是对 Dispose() 方法的单行添加，并调用祖先的 dispose（如果存在）。（注意`Dispose(bool)`不是 的成员`IDisposable`）

```
// Disposal Helper Functions
public static class Disposing
{
    // Executes IDisposable.Dispose() if it exists.
    public static void DisposeSuperclass(object o)
    {
        Type baseType = o.GetType().BaseType;
        bool superclassIsDisposable = typeof(IDisposable).IsAssignableFrom(baseType);
        if (superclassIsDisposable)
        {
            System.Reflection.MethodInfo baseDispose = baseType.GetMethod("Dispose", new Type[] { });
            baseDispose.Invoke(o, null);
        }
    }
}

class classA: IDisposable
{
    public void Dispose()
    {
        Console.WriteLine("Disposing A");
    }
}

class classB : classA, IDisposable
{
}

class classC : classB, IDisposable
{
    public void Dispose()
    {
        Console.WriteLine("Disposing C");
        Disposing.DisposeSuperclass(this);
    }
} 
```

# cross-platform - 跨平台RTF控制？

> ID：78153
> 
> 赞同：1
> 
> 时间：2008-09-16T22:54:14.897
> 
> 标签：cross-platform, rtf

有谁知道可以在 Linux/Windows/Mac 上使用的 RTF 控件？不幸的是，我不得不提到它，但它实际上必须能够保存和打开 rtf 文件......不像 wxWidgets wxRichTextCtrl 例如。

编辑：感谢 HappySmileMan 的回复。如果它更像是一个独立的而不是它所依赖的大型库的一部分，那就更好了。

编辑：...而且它看起来不能打开 rtf 文件...呃。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T00:01:56.413

RTF 根本不常见。它是由 Microsoft 控制的混乱格式，基本上是 .doc 格式的文本转储。我所知道的唯一开源 RTF 实现是在 Abiword、OpenOffice 和 KWord 中。所有这些都是跨平台的，但没有一个可能符合您的喜好（尽管 abiword 有一个 bonobo 界面，而 KWord 有一个 KPart，所以它们可以被嵌入，尽管是以重量级的方式）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T04:05:06.987

似乎我想要的（读写实际 rtf 文件的跨平台 rtf 控件）不存在，至少不是免费和开源的。...我会接受这个答案，但似乎不可能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T23:00:41.450

如果我正确理解了这个问题，那么您正在寻找的功能在 Qt 工具包中。

有关这方面的一些信息可以在[https://doc.qt.io/qt-5/richtext.html找到](https://doc.qt.io/qt-5/richtext.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T23:08:08.000

Qt 的控件是 HTML，而不是 RTF（虽然 foobar 可能只是表示富文本，在这种情况下就可以了）

# linux - 对 SD/USB 的突发写入使我在嵌入式 Linux 上的时间关键型应用程序停滞不前

> ID：78157
> 
> 赞同：13
> 
> 时间：2008-09-16T22:54:34.583
> 
> 标签：linux, video, embedded, filesystems, real-time

我正在开发一个嵌入式 Linux 项目，该项目将 ARM9 连接到硬件视频编码器芯片，并将视频写入 SD 卡或 USB 记忆棒。软件架构涉及将数据读取到缓冲区池中的内核驱动程序，以及将数据写入已安装可移动设备上的文件的用户级应用程序。

我发现在超过一定的数据速率（大约 750kbyte/sec）时，我开始看到用户级视频编写应用程序停止大约半秒，大约每 5 秒。这足以导致内核驱动程序耗尽缓冲区——即使我可以增加缓冲区的数量，视频数据也必须与其他实时发生的事情同步（最好在 40 毫秒内）。在这 5 秒的“滞后峰值”之间，写入在 40 毫秒内完成（就应用程序而言 - 我很欣赏它们被操作系统缓冲）

我认为这个延迟峰值与 Linux 将数据刷新到磁盘的方式有关——我注意到 pdflush 被设计为每 5 秒唤醒一次，我的理解是这就是写作的目的。一旦停顿结束，用户态应用程序就能够快速服务并写入缓冲区的积压（没有溢出）。

我认为我正在写入的设备具有合理的最终吞吐量：从内存 fs 复制 15MB 文件并等待同步完成（并且 USB 棒的指示灯停止闪烁）给了我大约 2.7MBytes/sec 的写入速度。

我正在寻找两种线索：

1.  我怎样才能阻止突发性写入停止我的应用程序——可能是进程优先级、实时补丁或调整文件系统代码以连续写入而不是突发性写入？

2.  如何让我的应用程序知道文件系统在写入积压和卡/棒的吞吐量方面发生了什么？我有能力动态更改硬件编解码器中的视频比特率，这比丢帧或对最大允许比特率施加人为上限要好得多。

更多信息：这是一个 200MHz ARM9，当前运行基于 Montavista 2.6.10 的内核。

更新：

*   挂载文件系统 SYNC 会导致吞吐量太差。
*   可移动媒体为 FAT/FAT32 格式，设计目的必须是媒体可以插入任何 Windows PC 并读取。
*   定期调用 sync() 或 fsync() 说，每秒都会导致定期停顿和不可接受的低吞吐量
*   我正在使用 write() 和 open(O_WRONLY | O_CREAT | O_TRUNC) 而不是 fopen() 等。
*   我无法立即在网上找到有关上述“Linux 实时文件系统”的任何信息。链接？

我希望这是有道理的。关于stackoverflow的第一个嵌入式Linux问题？:)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-18T20:47:20.753

根据记录，除了最极端的情况外，似乎有两个主要方面已经消除了这个问题。该系统仍在开发中，尚未经过彻底的酷刑测试，但运行良好（触摸木头）。

最大的胜利来自于使 userland writer 应用程序多线程。有时阻塞的是对 write() 的调用：其他进程和线程仍在运行。只要我有一个线程为设备驱动程序提供服务并更新帧计数和其他数据以与其他正在运行的应用程序同步，数据就可以在几秒钟后被缓冲并写出，而不会破坏任何截止日期。我先尝试了一个简单的乒乓双缓冲，但这还不够；小缓冲区会不堪重负，而大缓冲区只会导致更大的停顿，而文件系统会消化写入。在线程之间排队的 10 个 1MB 缓冲区池现在运行良好。

另一方面是关注物理介质的最终写入吞吐量。为此，我密切关注统计数据 Dirty: 由 /proc/meminfo 报告。如果 Dirty: 爬升到某个阈值以上，我有一些粗略且现成的代码来限制编码器，似乎工作模糊。以后需要更多的测试和调整。幸运的是，我有很多 RAM (128M) 可以使用，让我有几秒钟的时间来查看我的积压工作并顺利减少。

如果我发现我需要做任何其他事情来处理这个问题，我会尽量记住弹出并更新这个答案。感谢其他回答者。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-16T23:18:06.057

我会抛出一些建议，建议很便宜。

*   确保您使用较低级别的 API 来写入磁盘，不要使用用户模式缓存函数，例如`fopen, fread, fwrite`使用较低级别的函数`open, read, write`。
*   打开文件时传递`O_SYNC`标志，这将导致每次写入操作在写入磁盘之前被阻塞，这将消除写入的突发行为......但每次写入都会变慢。
*   `copy_to_user`如果您正在从设备执行读取/ioctls 以获取一大块视频数据，您可能需要考虑在应用程序和内核之间分配一个共享内存区域，否则在传输视频数据缓冲区时会遇到一堆调用内核空间到用户空间。
*   您可能需要验证您的 USB 闪存设备是否足够快，并且可以持续传输以写入数据。

只是一些想法，希望这会有所帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T13:51:29.123

[以下](http://www.westnet.com/~gsmith/content/linux-pdflush.htm)是一些关于调整 pdflush 以进行大量写入操作的信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T23:17:40.333

听起来您正在寻找 linux 实时文件系统。一定要搜索谷歌等。

XFS 有一个实时选项，虽然我没有玩过它。

hdparm 可能会让您完全关闭缓存。

调整文件系统选项（关闭所有额外不需要的文件属性）可能会减少您需要刷新的内容，从而加快刷新速度。不过，我怀疑这会有多大帮助。

但我的建议是完全避免将棒用作文件系统，而是将其用作原始设备。像使用“dd”一样在其上填充数据。然后在其他地方读取原始数据并在烘烤后将其写出。

当然，我不知道这是否适合您。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T23:10:32.393

在不了解您的具体情况的情况下，我只能提供以下猜测：

尝试使用 fsync()/sync() 来强制内核更频繁地刷新数据到存储设备。听起来内核缓冲了您的所有写入，然后在执行实际写入时占用了总线或以其他方式停止您的系统。通过仔细调用 fsync()，您可以尝试以更细粒度的方式安排系统总线上的写入。

以这样一种方式构建应用程序可能是有意义的，即编码/捕获（你没有提到视频捕获，所以我在这里做一个假设 - 你可能想要添加更多信息）任务在它自己的线程中运行并且在用户区缓冲其输出 - 然后，第二个线程可以处理对设备的写入。这将为您提供一个平滑缓冲区，以允许编码器始终完成其写入而不会阻塞。

听起来很可疑的一件事是，您仅在特定数据速率下看到此问题 - 如果这确实是一个缓冲问题，我希望问题在较低数据速率下发生的频率较低，但我仍然希望看到这个问题。

无论如何，更多信息可能会被证明是有用的。你的系统架构是什么？（用非常笼统的术语来说。）

鉴于您提供的其他信息，听起来设备的吞吐量对于小写入和频繁刷新来说相当差。如果您确定对于较大的写入，您可以获得足够的吞吐量（我不确定情况是否如此，但文件系统可能会做一些愚蠢的事情，例如在每次写入后更新 FAT）然后有一个编码线程管道数据写入线程在写入线程中有足够的缓冲以避免停顿。我过去使用共享内存环形缓冲区来实现这种方案，但是任何允许写入器写入 I/O 进程而不会停止的 IPC 机制都应该可以解决问题，除非缓冲区已满。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-17T15:00:22.143

有调试帮助，你可以使用 strace 查看哪些操作需要时间。FAT/FAT32 可能有一些令人惊讶的事情。

您是写入单个文件还是多个文件？

您可以创建一个读取线程，该线程将维护一个准备写入队列的视频缓冲区池。当接收到一帧时，将其添加到队列中，并向写入线程发出信号

共享数据

```
empty_buffer_queue
ready_buffer_queue
video_data_ready_semaphore 
```

阅读线程：

```
buf=get_buffer()
bufer_to_write = buf_dequeue(empty_buffer_queue)
memcpy(bufer_to_write, buf)
buf_enqueue(bufer_to_write, ready_buffer_queue)
sem_post(video_data_ready_semaphore) 
```

写线程

```
sem_wait(vido_data_ready_semaphore)
bufer_to_write = buf_dequeue(ready_buffer_queue)
write_buffer
buf_enqueue(bufer_to_write, empty_buffer_queue) 
```

如果您的写入线程在等待内核时被阻塞，这可能会起作用。但是，如果您在内核空间中被阻塞，那么您无能为力，除了寻找比您的 2.6.10 更新的内核

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-18T14:30:12.987

一个有用的 Linux 函数和同步或 fsync 的替代方法是 sync_file_range。这使您可以安排数据写入，而无需等待内核缓冲区系统处理它。

为避免长时间停顿，请确保您的 IO 队列（例如：/sys/block/hda/queue/nr_requests）足够大。该队列是数据在从内存中刷新和到达磁盘之间进入的地方。

请注意，sync_file_range 不可移植，仅在内核 2.6.17 及更高版本中可用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-11-18T04:04:22.987

有人告诉我，主机发送命令后，MMC 和 SD 卡“必须在 0 到 8 个字节内响应”。

但是，规范允许这些卡在完成操作之前以“忙”响应，并且显然卡可以声称忙的时间没有限制（请告诉我是否有这样的限制）。

我看到一些低成本的闪存芯片，如 M25P80，保证“最大单扇区擦除时间”为 3 秒，尽管通常它“仅”需要 0.6 秒。

这 0.6 秒听起来与您的“停止可能半秒”非常相似。

我怀疑廉价、慢速闪存芯片和昂贵、快速闪存芯片之间的权衡与 USB 闪存驱动器结果的广泛变化有关：

*   [http://www.testfreaks.com/blog/information/16gb-usb-drive-comparison-17-drives-compared/](http://www.testfreaks.com/blog/information/16gb-usb-drive-comparison-17-drives-compared/)
*   [http://www.tomshardware.com/reviews/data-transfer-run,1037-10.html](http://www.tomshardware.com/reviews/data-transfer-run,1037-10.html)

我听说过每次擦除闪存扇区然后重新编程时，都比上次花费的时间要长一些。

因此，如果您有一个时间要求严格的应用程序，您可能需要 (a) 测试您的 SD 卡和 USB 记忆棒，以确保它们满足您的应用程序所需的最小延迟、带宽等，以及 (b) 定期重新测试或抢先更换这些存储设备。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T23:03:57.947

首先很明显，您是否尝试过明确告诉文件刷新？我还认为可能有一些 ioctl 可以用来做这件事，但老实说，我没有做过太多的 C/POSIX 文件编程。

看到您使用的是 Linux 内核，您应该能够调整和重建内核以更好地满足您的需求，例如。更频繁，但对永久存储的刷新也更小。

* * *

快速检查我的手册页会发现：

```
SYNC(2) Linux 程序员手册 SYNC(2)

姓名
       同步 - 将缓冲区缓存提交到磁盘

概要
       #include <unistd.h>

       无效同步（无效）；

   glibc 的功能测试宏要求（参见 feature_test_macros(7)）：

       同步（）：_BSD_SOURCE || _XOPEN_SOURCE >= 500

描述
       sync() 首先将 inode 提交到缓冲区，然后将缓冲区提交到磁盘。

错误
       这个函数总是成功的。
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-17T16:59:57.800

做你自己的 flush()ing 听起来对我来说是正确的 - 你想要控制，而不是让它留给通用缓冲层的变幻莫测。

这可能很明显，但请确保您不会过于频繁地调用 write() - 确保每个 write() 都有足够的数据要写入，以使系统调用开销值得。另外，在另一个方向上，不要太少调用它，否则它会阻塞足够长的时间以引起问题。

在更难以重新实现的轨道上，您是否尝试过切换到异步 i/o？使用 aio，您可以启动写入并将一组缓冲区交给它，同时将视频数据吸入另一组，当写入完成时，您切换缓冲区组。

# c# - 协助将 commctrl 命令移植到 C#

> ID：78161
> 
> 赞同：1
> 
> 时间：2008-09-16T22:55:54.877
> 
> 标签：c#, com, treeview

在 C++ 应用程序中，我有一个 hWnd 指向在第三方进程中运行的窗口。此窗口包含扩展 COM TreeView 控件的控件。我有兴趣获取此控件的 CheckState。
我使用 hWnd 从 commctrl.h 中使用 TreeView_GetRoot(hwnd) 获取 HTREEITEM

hwnd 指向窗口，hItem 是 TreeView_GetRoot(hwnd) 的返回值。它们的用法如下：

```
int iCheckState = TreeView_GetCheckState(hwnd,  hItem);
switch (iCheckState)
{
   case 0:
      // (unchecked)
   case 1:
      // checked
   ...
} 
```

我希望将此代码移植到执行相同操作的 C# 应用程序中（关闭 TreeView 控件的 CheckState）。我从来没有使用过 COM 并且很陌生。

我曾尝试使用 .NET mscomctl，但找不到与 TreeView_GetRoot 或 TreeView_GetCheckState 等效的方法。我完全被卡住了，不知道如何在 C# 中重新创建这段代码:(

建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T03:52:08.223

我们从 CommCtrl.h 中得到这些定义：

```
#define TreeView_SetItemState(hwndTV, hti, data, _mask) \
{ TVITEM _ms_TVi;\
  _ms_TVi.mask = TVIF_STATE; \
  _ms_TVi.hItem = (hti); \
  _ms_TVi.stateMask = (_mask);\
  _ms_TVi.state = (data);\
  SNDMSG((hwndTV), TVM_SETITEM, 0, (LPARAM)(TV_ITEM *)&_ms_TVi);\
}

#define TreeView_SetCheckState(hwndTV, hti, fCheck) \
  TreeView_SetItemState(hwndTV, hti, INDEXTOSTATEIMAGEMASK((fCheck)?2:1), TVIS_STATEIMAGEMASK) 
```

我们可以使用 PInvoke 将其转换为 C#。首先，我们将这些宏实现为函数，然后添加使这些函数工作所需的任何其他支持。这是我的第一次尝试。您应该仔细检查我的代码，尤其是在结构编组方面。此外，您可能希望跨线程发布消息，而不是调用 SendMessage。

最后，我不确定这是否会起作用，因为我相信通用控件使用 WM_USER+ 消息。当这些消息被跨进程发送时，数据参数的地址不会被修改，由此产生的进程可能会导致访问冲突。无论您使用哪种语言（C++ 或 C#），这都会是一个问题，所以也许我在这里错了（您说您有一个有效的 C++ 程序）。

```
static class Interop {

public static IntPtr TreeView_SetCheckState(HandleRef hwndTV, IntPtr hti, bool fCheck) {
    return TreeView_SetItemState(hwndTV, hti, INDEXTOSTATEIMAGEMASK((fCheck) ? 2 : 1), (uint)TVIS.TVIS_STATEIMAGEMASK);
}

public static IntPtr TreeView_SetItemState(HandleRef hwndTV, IntPtr hti, uint data, uint _mask) {
    TVITEM _ms_TVi = new TVITEM();
    _ms_TVi.mask = (uint)TVIF.TVIF_STATE;
    _ms_TVi.hItem = (hti);
    _ms_TVi.stateMask = (_mask);
    _ms_TVi.state = (data);
    IntPtr p = Marshal.AllocCoTaskMem(Marshal.SizeOf(_ms_TVi));
    Marshal.StructureToPtr(_ms_TVi, p, false);
    IntPtr r = SendMessage(hwndTV, (int)TVM.TVM_SETITEMW, IntPtr.Zero, p);
    Marshal.FreeCoTaskMem(p);
    return r;
}

private static uint INDEXTOSTATEIMAGEMASK(int i) { return ((uint)(i) << 12); }

[DllImport("user32.dll", CharSet = CharSet.Auto)]
private static extern IntPtr SendMessage(HandleRef hWnd, int msg, IntPtr wParam, IntPtr lParam);

private enum TVIF : uint {
    TVIF_STATE = 0x0008
}

private enum TVIS : uint {
    TVIS_STATEIMAGEMASK = 0xF000
}

private enum TVM : int {
    TV_FIRST = 0x1100,
    TVM_SETITEMA = (TV_FIRST + 13),
    TVM_SETITEMW = (TV_FIRST + 63)
}

private struct TVITEM {
    public uint mask;
    public IntPtr hItem;
    public uint state;
    public uint stateMask;
    public IntPtr pszText;
    public int cchTextMax;
    public int iImage;
    public int iSelectedImage;
    public int cChildren;
    public IntPtr lParam;
}
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T23:10:22.660

为什么不使用 Windows 窗体 TreeView 控件？如果使用此控件，请将控件的 CheckBoxes 属性设置为 true 以启用复选框，并在要显示为选中的节点上设置 Checked 属性。

要获取根节点的集合，请使用 TreeView 的 Nodes 属性。这将返回一个 TreeNodeCollection，然后您可以对其进行索引或添加项目。

# c - 使用 C/Pthreads：共享变量是否需要是 volatile 的？

> ID：78172
> 
> 赞同：36
> 
> 时间：2008-09-16T22:59:37.613
> 
> 标签：c, multithreading, pthreads

以C编程语言和Pthreads作为线程库；线程之间共享的变量/结构是否需要声明为 volatile？假设它们可能受到锁的保护（也许是障碍）。

pthread POSIX 标准对此是否有任何发言权，这是依赖于编译器还是两者都不依赖？

编辑添加：感谢您的出色回答。但是如果你*不*使用锁呢？例如，如果您使用[障碍](http://en.wikipedia.org/wiki/Barrier_(computer_science))怎么办？或者使用诸如[比较和交换之](http://en.wikipedia.org/wiki/Compare_and_swap)类的原语直接和原子地修改共享变量的代码......

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-16T23:08:52.867

只要您使用锁来控制对变量的访问，就不需要对它进行 volatile 操作。事实上，如果你将 volatile 放在任何变量上，你可能已经错了。

[https://software.intel.com/en-us/blogs/2007/11/30/volatile-almost-useless-for-multi-threaded-programming/](http://web.archive.org/web/20190219170904/https://software.intel.com/en-us/blogs/2007/11/30/volatile-almost-useless-for-multi-threaded-programming/)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-24T07:26:18.150

答案是绝对的，毫不含糊的，不。除了正确的同步原语之外，您不需要使用“易失性”。需要做的一切都由这些原语完成。

'volatile' 的使用既不必要也不充分。这不是必需的，因为适当的同步原语就足够了。这还不够，因为它只会禁用一些优化，而不是所有可能会咬你的优化。例如，它不保证在另一个 CPU 上的原子性或可见性。

> 但是除非您使用 volatile，否则编译器可以自由地将共享数据缓存在寄存器中任意时间......如果您希望将数据写入可预测地写入实际内存，而不仅仅是缓存在寄存器中编译器自行决定，您需要将其标记为 volatile。或者，如果您只在离开修改它的函数后才访问共享数据，您可能没问题。但我建议不要依靠盲目的运气来确保将值从寄存器写回内存。

是的，但即使您确实使用了 volatile，CPU 也可以将共享数据缓存在写入发布缓冲区中任意时间长度。可以咬你的优化集与“volatile”禁用的优化集并不完全相同。因此，如果您使用“易失性”，则您*是在*依靠运气。

另一方面，如果您使用具有定义的多线程语义的同步原语，则可以保证一切正常。另外，您不会受到“易失性”的巨大性能影响。那么为什么不那样做呢？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-03T13:12:17.543

我认为 volatile 的一个非常重要的属性是它使变量在修改时写入内存，并在每次访问时从内存中重新读取。这里的其他答案混合了易失性和同步性，并且从其他一些答案中可以清楚地看出，易失性不是同步原语（信用到期的信用）。

但是除非您使用 volatile，否则编译器可以自由地将共享数据缓存在寄存器中任意时间......如果您希望将数据写入可预测地写入实际内存，而不仅仅是缓存在寄存器中编译器自行决定，您需要将其标记为 volatile。或者，如果您只在离开修改它的函数后才访问共享数据，您可能没问题。但我建议不要依靠盲目的运气来确保将值从寄存器写回内存。

特别是在寄存器丰富的机器上（即，不是 x86），变量可以在寄存器中存在相当长的时间，一个好的编译器甚至可以在寄存器中缓存结构的一部分或整个结构。因此，您应该使用 volatile，但为了提高性能，还要将值复制到局部变量以进行计算，然后进行显式回写。从本质上讲，有效地使用 volatile 意味着在 C 代码中进行一些加载存储思考。

无论如何，您肯定必须使用某种操作系统级别提供的同步机制来创建正确的程序。

有关 volatile 弱点的示例，请参阅我在[http://jakob.engbloms.se/archives/65](http://jakob.engbloms.se/archives/65)上的 Decker 算法示例，这很好地证明了 volatile 无法同步。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-11-14T10:21:12.040

有一个普遍的概念是关键字 volatile 有利于多线程编程。

Hans Boehm[指出](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/n2016.html)volatile 只有三种便携式用途：

*   *volatile*可用于标记与 setjmp 相同范围内的局部变量，其值应在 longjmp 中保留。目前还不清楚有多少比例的此类使用会被减慢，因为如果无法共享相关的局部变量，原子性和排序约束将不起作用。（甚至不清楚通过要求在 longjmp 中保留所有变量会减慢多少此类使用，但这是一个单独的问题，此处不予考虑。）
*   *当变量可能被“外部修改”时，可以使用*volatile ，但实际上修改是由线程本身同步触发的，例如，因为底层内存映射到多个位置。**
**   *volatile* sigatomic_t可用于以受限方式与同一线程中的信号处理程序进行通信。可以考虑削弱对 sigatomic_t 案例的要求，但这似乎相当违反直觉。*

 *如果您为了速度而使用*多线程*，那么减慢代码绝对不是您想要的。对于多线程编程，volatile 经常被错误地认为要解决两个关键问题：

*   *原子性*
*   *内存一致性*，即另一个线程看到的线程操作的顺序。

我们先处理（1）。Volatile 不保证原子读取或写入。例如，129 位结构的易失性读取或写入在大多数现代硬件上不会是原子的。32 位 int 的 volatile 读取或写入在大多数现代硬件上是原子性的，但*volatile 与它无关*。如果没有 volatile，它可能是原子的。原子性是编译器的心血来潮。C 或 C++ 标准中没有任何内容说它必须是原子的。

现在考虑问题（2）。有时程序员将 volatile 视为关闭对 volatile 访问的优化。这在实践中基本上是正确的。但这只是易失性访问，而不是非易失性访问。考虑这个片段：

```
 volatile int Ready;       

    int Message[100];      

    void foo( int i ) {      

        Message[i/10] = 42;      

        Ready = 1;      

    } 
```

它试图在多线程编程中做一些非常合理的事情：编写一条消息，然后将其发送到另一个线程。另一个线程将等待，直到 Ready 变为非零，然后读取 Message。尝试使用 gcc 4.0 或 icc 用“gcc -O2 -S”编译它。两者都会先存储到 Ready，因此可以与 i/10 的计算重叠。重新排序不是编译器错误。这是一个积极的优化器在做它的工作。

您可能认为解决方案是将所有内存引用标记为易失性。这简直是​​愚蠢的。正如前面的引文所说，它只会减慢您的代码速度。最糟糕的是，它可能无法解决问题。即使编译器不重新排序引用，硬件也可能。在此示例中，x86 硬件不会对其进行重新排序。Itanium(TM) 处理器也不会，因为 Itanium 编译器为易失性存储插入内存栅栏。这是一个聪明的安腾扩展。但 Power(TM) 等芯片将重新订购。订购真正需要的是*内存栅栏*，也称为*内存屏障*。内存栅栏防止跨栅栏的内存操作重新排序，或者在某些情况下，防止在一个方向上重新排序。易失性与内存栅栏无关。

那么多线程编程的解决方案是什么呢？使用实现原子和栅栏语义的库或语言扩展。当按预期使用时，库中的操作将插入正确的栅栏。一些例子：

*   POSIX 线程
*   Windows(TM) 线程
*   开放式MP
*   待定

基于[Arch Robison（英特尔）的文章](http://software.intel.com/en-us/blogs/2007/11/30/volatile-almost-useless-for-multi-threaded-programming/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T23:03:43.080

根据我的经验，没有；当您写入这些值时，您只需要自己正确地互斥，或者构建您的程序，以便线程在需要访问依赖于另一个线程操作的数据之前停止。我的项目，x264，就是用这个方法；线程共享大量数据，但其中绝大多数不需要互斥锁，因为它要么是只读的，要么线程将等待数据变得可用并在需要访问它之前完成。

现在，如果您有许多线程在它们的操作中都被大量交错（它们在非常细粒度的级别上依赖于彼此的输出），这可能会更难——事实上，在这种情况下，我会考虑重新审视线程模型，看看是否可以通过线程之间的更多分离来更干净地完成它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-17T23:06:33.523

不。

`Volatile`仅在读取可以独立于 CPU 读/写命令改变的内存位置时才需要。在线程的情况下，CPU 完全控制每个线程对内存的读/写，因此编译器可以假设内存是连贯的，并优化 CPU 指令以减少不必要的内存访问。

的主要用途`volatile`是访问内存映射的 I/O。在这种情况下，底层设备可以独立于 CPU 更改内存位置的值。如果在这种情况下不使用`volatile`，CPU 可能会使用以前缓存的内存值，而不是读取新更新的值。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-11-19T13:54:28.843

**POSIX 7 保证诸如`pthread_lock`同步内存之类的功能**

[https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap04.html#tag_04_11](https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap04.html#tag_04_11) “4.12 内存同步” 说：

> 以下函数相对于其他线程同步内存：
> 
> ```
> pthread_barrier_wait()
> pthread_cond_broadcast()
> pthread_cond_signal()
> pthread_cond_timedwait()
> pthread_cond_wait()
> pthread_create()
> pthread_join()
> pthread_mutex_lock()
> pthread_mutex_timedlock()
> pthread_mutex_trylock()
> pthread_mutex_unlock()
> pthread_spin_lock()
> pthread_spin_trylock()
> pthread_spin_unlock()
> pthread_rwlock_rdlock()
> pthread_rwlock_timedrdlock()
> pthread_rwlock_timedwrlock()
> pthread_rwlock_tryrdlock()
> pthread_rwlock_trywrlock()
> pthread_rwlock_unlock()
> pthread_rwlock_wrlock()
> sem_post()
> sem_timedwait()
> sem_trywait()
> sem_wait()
> semctl()
> semop()
> wait()
> waitpid() 
> ```

因此，如果您的变量受到保护`pthread_mutex_lock`，`pthread_mutex_unlock`则它不需要进一步同步，因为您可能会尝试提供`volatile`.

相关问题：

*   [使用 pthread 互斥锁保护变量是否保证它也不会被缓存？](https://stackoverflow.com/questions/3208060/does-guarding-a-variable-with-a-pthread-mutex-guarantee-its-also-not-cached)
*   [pthread_mutex_lock 是否包含内存围栏指令？](https://stackoverflow.com/questions/24137964/does-pthread-mutex-lock-contains-memory-fence-instruction)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T23:02:25.720

易失性意味着我们必须去内存来获取或设置这个值。如果不设置 volatile，编译后的代码可能会将数据长期保存在寄存器中。

这意味着您应该将线程之间共享的变量标记为易失性，这样您就不会出现一个线程开始修改值但在第二个线程出现并尝试读取值之前不写入结果的情况.

Volatile 是禁用某些优化的编译器提示。没有它，编译器的输出程序集可能是安全的，但您应该始终将它用于共享值。

如果您不使用系统提供的昂贵的线程同步对象，这一点尤其重要 - 例如，您可能有一个数据结构，您可以通过一系列原子更改使其保持有效。许多不分配内存的堆栈都是此类数据结构的示例，因为您可以向堆栈添加一个值，然后移动结束指针或在移动结束指针后从堆栈中删除一个值。在实现这样的结构时， volatile 对于确保您的原子指令实际上是原子的变得至关重要。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T23:10:14.860

只有在一个线程写入内容和另一个线程读取内容之间绝对不需要延迟时，Volatile 才会有用。但是，如果没有某种锁，您将不知道其他线程*何时*写入数据，只知道它是最新的可能值。

对于简单的值（不同大小的 int 和 float），如果您不需要显式同步点，则互斥锁可能会过大。如果你不使用互斥锁或某种锁，你应该声明变量 volatile。如果您使用互斥锁，则一切就绪。

对于复杂的类型，您必须使用互斥锁。对它们的操作是非原子的，因此您可以在没有互斥锁的情况下阅读半修改版本。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-10-28T07:23:40.023

根本原因是 C 语言语义基于**单线程抽象机**。只要程序在抽象机器上的“可观察行为”保持不变，编译器就有权转换程序。它可以合并相邻或重叠的内存访问，多次重做内存访问（例如在寄存器溢出时），或者简单地丢弃内存访问，如果它认为程序的行为在**单个线程**中执行时不会改变。因此，您可能会怀疑，如果程序实际上应该以多线程方式执行，那么行为**确实会发生变化。**

[正如 Paul Mckenney 在著名的Linux 内核文档](http://elixir.free-electrons.com/linux/latest/source/Documentation/memory-barriers.txt#L264 "内存屏障.txt")中指出的那样：

> _must_not_ 假定编译器将使用不受 READ_ONCE() 和 WRITE_ONCE() 保护的内存引用执行您想要的操作。没有它们，编译器有权进行各种“创造性”转换，这些转换在编译器屏障部分中进行了介绍。

READ_ONCE() 和 WRITE_ONCE() 被定义为对引用变量的 volatile casts。因此：

```
int y;
int x = READ_ONCE(y); 
```

相当于：

```
int y;
int x = *(volatile int *)&y; 
```

因此，除非您进行“易失性”访问，否则无论您使用何种同步机制，都不能保证访问只会发生**一次。**调用外部函数（例如 pthread_mutex_lock）可能会强制编译器对全局变量进行内存访问。但这仅在编译器无法确定外部函数是否更改这些全局变量时才会发生。采用复杂的过程间分析和链接时间优化的现代编译器使这个技巧变得毫无用处。

总之，您应该将多个线程共享的变量标记为 volatile 或使用 volatile casts 访问它们。

* * *

正如保罗麦肯尼所指出的：

> 当他们讨论您不希望您的孩子知道的优化技术时，我看到了他们眼中的闪光！

* * *

但是看看**C11/C++11**会发生什么。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2010-09-22T15:35:56.437

有些人显然假设编译器将同步调用视为内存屏障。“Casey”假设只有一个 CPU。

如果同步原语是外部函数并且所讨论的符号在编译单元之外可见（全局名称、导出的指针、可能修改它们的导出函数），那么编译器会将它们 - 或任何其他外部函数调用 - 视为关于所有外部可见对象的内存栅栏。

否则，你就靠自己了。volatile 可能是使编译器生成正确、快速代码的最佳工具。但是，它通常不会是可移植的，当您需要 volatile 时，它​​实际上为您做了什么，很大程度上取决于系统和编译器。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2010-11-02T03:35:29.843

线程之间共享的变量应声明为“volatile”。这告诉编译器当一个线程写入这些变量时，写入应该是内存（而不是寄存器）。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2016-04-13T19:52:14.073

不。

首先，`volatile`没有必要。还有许多其他操作提供了不使用的有保证的多线程语义`volatile`。这些包括原子操作、互斥体等。

二`volatile`是不够。C 标准不对声明的变量的多线程行为提供任何保证`volatile`。

因此，既不是必要的也不是充分的，使用它没有多大意义。

一个例外是特定平台（例如 Visual Studio），它确实记录了多线程语义。

# .net - 如何从 MemoryStream 中获取字符串？

> ID：78181
> 
> 赞同：578
> 
> 时间：2008-09-16T23:02:01.587
> 
> 标签：.net, vb.net, string, memorystream

如果给我 a`MemoryStream`我知道已经填充了 a `String`，我该如何`String`退出？

* * *

## 回答 #1

> 赞同：483
> 
> 时间：2008-09-29T18:20:38.280

此示例演示如何读取字符串并将其写入 MemoryStream。

* * *

```
Imports System.IO

Module Module1
  Sub Main()
    ' We don't need to dispose any of the MemoryStream 
    ' because it is a managed object. However, just for 
    ' good practice, we'll close the MemoryStream.
    Using ms As New MemoryStream
      Dim sw As New StreamWriter(ms)
      sw.WriteLine("Hello World")
      ' The string is currently stored in the 
      ' StreamWriters buffer. Flushing the stream will 
      ' force the string into the MemoryStream.
      sw.Flush()
      ' If we dispose the StreamWriter now, it will close 
      ' the BaseStream (which is our MemoryStream) which 
      ' will prevent us from reading from our MemoryStream
      'sw.Dispose()

      ' The StreamReader will read from the current 
      ' position of the MemoryStream which is currently 
      ' set at the end of the string we just wrote to it. 
      ' We need to set the position to 0 in order to read 
      ' from the beginning.
      ms.Position = 0
      Dim sr As New StreamReader(ms)
      Dim myStr = sr.ReadToEnd()
      Console.WriteLine(myStr)

      ' We can dispose our StreamWriter and StreamReader 
      ' now, though this isn't necessary (they don't hold 
      ' any resources open on their own).
      sw.Dispose()
      sr.Dispose()
    End Using

    Console.WriteLine("Press any key to continue.")
    Console.ReadKey()
  End Sub
End Module 
```

* * *

## 回答 #2

> 赞同：358
> 
> 时间：2008-10-24T16:29:27.233

你也可以使用

```
Encoding.ASCII.GetString(ms.ToArray()); 
```

我不*认为*这会降低效率，但我不能发誓。它还允许您选择不同的编码，而使用 StreamReader 您必须将其指定为参数。

* * *

## 回答 #3

> 赞同：104
> 
> 时间：2008-09-16T23:03:14.737

使用 StreamReader 将 MemoryStream 转换为字符串。

```
<Extension()> _
Public Function ReadAll(ByVal memStream As MemoryStream) As String
    ' Reset the stream otherwise you will just get an empty string.
    ' Remember the position so we can restore it later.
    Dim pos = memStream.Position
    memStream.Position = 0

    Dim reader As New StreamReader(memStream)
    Dim str = reader.ReadToEnd()

    ' Reset the position so that subsequent writes are correct.
    memStream.Position = pos

    Return str
End Function 
```

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2008-09-16T23:02:58.230

使用[StreamReader](http://msdn.microsoft.com/en-us/library/system.io.streamreader.aspx)，然后您可以使用返回字符串的[ReadToEnd](http://msdn.microsoft.com/en-us/library/system.io.streamreader.readtoend.aspx)方法。

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2017-05-03T22:01:46.557

```
byte[] array = Encoding.ASCII.GetBytes("MyTest1 - MyTest2");
MemoryStream streamItem = new MemoryStream(array);

// convert to string
StreamReader reader = new StreamReader(streamItem);
string text = reader.ReadToEnd(); 
```

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2012-10-26T11:44:14.270

以前的解决方案在涉及编码的情况下不起作用。这是-一种“现实生活”-示例如何正确执行此操作...

```
using(var stream = new System.IO.MemoryStream())
{
  var serializer = new DataContractJsonSerializer(typeof(IEnumerable<ExportData>),  new[]{typeof(ExportData)}, Int32.MaxValue, true, null, false);               
  serializer.WriteObject(stream, model);  

  var jsonString = Encoding.Default.GetString((stream.ToArray()));
} 
```

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2014-10-25T06:44:22.923

在这种情况下，如果你真的想以一种简单的方式使用`ReadToEnd`方法`MemoryStream`，你可以使用这个扩展方法来实现：

```
public static class SetExtensions
{
    public static string ReadToEnd(this MemoryStream BASE)
    {
        BASE.Position = 0;
        StreamReader R = new StreamReader(BASE);
        return R.ReadToEnd();
    }
} 
```

您可以通过这种方式使用此方法：

```
using (MemoryStream m = new MemoryStream())
{
    //for example i want to serialize an object into MemoryStream
    //I want to use XmlSeralizer
    XmlSerializer xs = new XmlSerializer(_yourVariable.GetType());
    xs.Serialize(m, _yourVariable);

    //the easy way to use ReadToEnd method in MemoryStream
    MessageBox.Show(m.ReadToEnd());
} 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2015-07-15T18:10:41.940

此示例显示如何从 MemoryStream 中读取字符串，其中我使用了序列化（使用 DataContractJsonSerializer），将字符串从某个服务器传递到客户端，然后，如何从作为参数传递的字符串中恢复 MemoryStream，然后，反序列化 MemoryStream。

我使用了不同帖子的部分内容来执行此示例。

希望这会有所帮助。

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Runtime.Serialization;
using System.Runtime.Serialization.Json;
using System.Threading;

namespace JsonSample
{
    class Program
    {
        static void Main(string[] args)
        {
            var phones = new List<Phone>
            {
                new Phone { Type = PhoneTypes.Home, Number = "28736127" },
                new Phone { Type = PhoneTypes.Movil, Number = "842736487" }
            };
            var p = new Person { Id = 1, Name = "Person 1", BirthDate = DateTime.Now, Phones = phones };

            Console.WriteLine("New object 'Person' in the server side:");
            Console.WriteLine(string.Format("Id: {0}, Name: {1}, Birthday: {2}.", p.Id, p.Name, p.BirthDate.ToShortDateString()));
            Console.WriteLine(string.Format("Phone: {0} {1}", p.Phones[0].Type.ToString(), p.Phones[0].Number));
            Console.WriteLine(string.Format("Phone: {0} {1}", p.Phones[1].Type.ToString(), p.Phones[1].Number));

            Console.Write(Environment.NewLine);
            Thread.Sleep(2000);

            var stream1 = new MemoryStream();
            var ser = new DataContractJsonSerializer(typeof(Person));

            ser.WriteObject(stream1, p);

            stream1.Position = 0;
            StreamReader sr = new StreamReader(stream1);
            Console.Write("JSON form of Person object: ");
            Console.WriteLine(sr.ReadToEnd());

            Console.Write(Environment.NewLine);
            Thread.Sleep(2000);

            var f = GetStringFromMemoryStream(stream1);

            Console.Write(Environment.NewLine);
            Thread.Sleep(2000);

            Console.WriteLine("Passing string parameter from server to client...");

            Console.Write(Environment.NewLine);
            Thread.Sleep(2000);

            var g = GetMemoryStreamFromString(f);
            g.Position = 0;
            var ser2 = new DataContractJsonSerializer(typeof(Person));
            var p2 = (Person)ser2.ReadObject(g);

            Console.Write(Environment.NewLine);
            Thread.Sleep(2000);

            Console.WriteLine("New object 'Person' arrived to the client:");
            Console.WriteLine(string.Format("Id: {0}, Name: {1}, Birthday: {2}.", p2.Id, p2.Name, p2.BirthDate.ToShortDateString()));
            Console.WriteLine(string.Format("Phone: {0} {1}", p2.Phones[0].Type.ToString(), p2.Phones[0].Number));
            Console.WriteLine(string.Format("Phone: {0} {1}", p2.Phones[1].Type.ToString(), p2.Phones[1].Number));

            Console.Read();
        }

        private static MemoryStream GetMemoryStreamFromString(string s)
        {
            var stream = new MemoryStream();
            var sw = new StreamWriter(stream);
            sw.Write(s);
            sw.Flush();
            stream.Position = 0;
            return stream;
        }

        private static string GetStringFromMemoryStream(MemoryStream ms)
        {
            ms.Position = 0;
            using (StreamReader sr = new StreamReader(ms))
            {
                return sr.ReadToEnd();
            }
        }
    }

    [DataContract]
    internal class Person
    {
        [DataMember]
        public int Id { get; set; }
        [DataMember]
        public string Name { get; set; }
        [DataMember]
        public DateTime BirthDate { get; set; }
        [DataMember]
        public List<Phone> Phones { get; set; }
    }

    [DataContract]
    internal class Phone
    {
        [DataMember]
        public PhoneTypes Type { get; set; }
        [DataMember]
        public string Number { get; set; }
    }

    internal enum PhoneTypes
    {
        Home = 1,
        Movil = 2
    }
} 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-11-12T16:53:45.010

为什么不在 MemoryStream 类型上做一个很好的扩展方法呢？

```
public static class MemoryStreamExtensions
{

    static object streamLock = new object();

    public static void WriteLine(this MemoryStream stream, string text, bool flush)
    {
        byte[] bytes = Encoding.UTF8.GetBytes(text + Environment.NewLine);
        lock (streamLock)
        {
            stream.Write(bytes, 0, bytes.Length);
            if (flush)
            {
                stream.Flush();
            }
        }
    }

    public static void WriteLine(this MemoryStream stream, string formatString, bool flush, params string[] strings)
    {
        byte[] bytes = Encoding.UTF8.GetBytes(String.Format(formatString, strings) + Environment.NewLine);
        lock (streamLock)
        {
            stream.Write(bytes, 0, bytes.Length);
            if (flush)
            {
                stream.Flush();
            }
        }
    }

    public static void WriteToConsole(this MemoryStream stream)
    {
        lock (streamLock)
        {
            long temporary = stream.Position;
            stream.Position = 0;
            using (StreamReader reader = new StreamReader(stream, Encoding.UTF8, false, 0x1000, true))
            {
                string text = reader.ReadToEnd();
                if (!String.IsNullOrEmpty(text))
                {
                    Console.WriteLine(text);
                }
            }
            stream.Position = temporary;
        }
    }
} 
```

当然，在将这些方法与标准方法结合使用时要小心。:) ...如果你这样做，你将需要使用那个方便的 streamLock 来实现并发。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2010-04-07T11:44:22.837

Brian's answer的略微修改版本允许对读取开始进行可选管理，这似乎是最简单的方法。可能不是最有效的，但易于理解和使用。

```
Public Function ReadAll(ByVal memStream As MemoryStream, Optional ByVal startPos As Integer = 0) As String
    ' reset the stream or we'll get an empty string returned
    ' remember the position so we can restore it later
    Dim Pos = memStream.Position
    memStream.Position = startPos

    Dim reader As New StreamReader(memStream)
    Dim str = reader.ReadToEnd()

    ' reset the position so that subsequent writes are correct
    memStream.Position = Pos

    Return str
End Function 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-04-14T10:45:09.290

我需要与一个需要 Stream 的类集成：

```
XmlSchema schema;
// ... Use "schema" ...

var ret = "";

using (var ms = new MemoryStream())
{
    schema.Write(ms);
    ret = Encoding.ASCII.GetString(ms.ToArray());
}
//here you can use "ret"
// 6 Lines of code 
```

我创建了一个简单的类，可以帮助减少多次使用的代码行：

```
public static class MemoryStreamStringWrapper
{
    public static string Write(Action<MemoryStream> action)
    {
        var ret = "";
        using (var ms = new MemoryStream())
        {
            action(ms);
            ret = Encoding.ASCII.GetString(ms.ToArray());
        }

        return ret;
    }
} 
```

那么您可以用一行代码替换示例

```
var ret = MemoryStreamStringWrapper.Write(schema.Write); 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2020-12-14T14:09:44.650

仅使用 Convert.ToBase64String 方法

```
Convert.ToBase64String(inputStream.ToArray()); 
```

# c++ - 如何在 C++ 中创建 RAW TCP/IP 数据包？

> ID：78184
> 
> 赞同：24
> 
> 时间：2008-09-16T23:02:11.337
> 
> 标签：c++, c, sockets, networking, tcp

我是一个初级 C++ 程序员/网络管理员，但我想如果有人指出我正确的方向，我可以学习如何做到这一点。大多数教程都是使用由于某种原因不再有效的旧代码进行演示的。

由于我在 Linux 上，所以我只需要解释如何编写原始伯克利套接字。有人可以让我快速运行吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-16T23:05:19.613

从阅读[Beej 的套接字编程指南](http://beej.us/guide/bgnet/output/html/multipage/index.html)开始。它将带您快速了解如何开始编写网络代码。之后，您应该能够通过阅读手册页获得越来越多的信息。

其中大部分将包括阅读您最喜欢的库的文档，以及对手册页的基本了解。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-16T23:19:59.547

对于初学者，如果您澄清“原始”的含义，将会很有帮助。传统上，这意味着您想要制作所有第 4 层标头（TCP/UDP/ICMP... 标头），也许还需要您自己制作一些 IP 标头。为此，您需要的不仅仅是 beej 的教程，我已经在这里提到了很多。在这种情况下，您希望在对套接字的调用中使用 SOCK_RAW 参数获得原始 IP 套接字（有关一些基础知识，请参见[http://mixter.void.ru/rawip.html](http://mixter.void.ru/rawip.html)）。

如果您真正想要的只是能够与某个远程主机（例如 stackoverflow.com 上的端口 80）建立 TCP 连接，那么您可能不需要“原始”套接字，beej 的指南将为您提供很好的服务。

有关该主题的权威参考，您应该真正选择 Unix Network Programming, Volume 1: The Sockets Networking API (3rd Edition) by Stevens et al。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T23:13:20.920

**对于 TCP 客户端：**

使用 gethostbyname 查找 dns 名称到 IP，它会返回一个 hostent 结构。我们称这个返回值为主机。

```
hostent *host = gethostbyname(HOSTNAME_CSTR); 
```

填充套接字地址结构：

```
sockaddr_in sock;
sock.sin_family = AF_INET;
sock.sin_port = htons(REMOTE_PORT);
sock.sin_addr.s_addr = ((struct in_addr *)(host->h_addr))->s_addr; 
```

创建一个套接字并调用connect：

```
s = socket(AF_INET, SOCK_STREAM, 0); 
connect(s, (struct sockaddr *)&sock, sizeof(sock)) 
```

**对于 TCP 服务器端：**

设置一个套接字

使用绑定将您的地址绑定到该套接字。

用listen开始监听那个socket

调用 accept 以获取连接的客户端。<-- 此时，您生成一个新线程来处理连接，同时您再次调用接受以获取下一个连接的客户端。

**一般通讯：**

使用 send 和 recv 在客户端和服务器之间进行读写。

**BSD套接字的源代码示例：**

[您可以在wikipedia](http://en.wikipedia.org/wiki/Berkeley_sockets)找到一些很好的示例代码。

**进一步阅读：**

我强烈推荐[这本书](https://rads.stackoverflow.com/amzn/click/com/0131411551)和[这个在线教程](http://beej.us/guide/bgnet/output/html/multipage/index.html)：

![替代文字](https://i.stack.imgur.com/CIP1b.jpg)

[4](https://i.stack.imgur.com/CIP1b.jpg)：

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-16T23:05:01.627

一个好的起点是使用[Asio](http://www.boost.org/doc/libs/1_36_0/doc/html/boost_asio/overview.html)，它是一个用于网络通信的优秀跨平台（包括 Linux）库。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-02-07T13:30:58.980

I've been developing [libtins](http://libtins.github.io/) for the past year. It's a high level C++ packet crafting and sniffing library.

Unless you want to reinvent the wheel and implement every protocol's internals, I'd recommend you to use some higher level library which already does that for you.

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-16T23:07:04.680

执行此操作的方式与在常规 C 中完全相同，在标准库中没有特定于 C++ 的方式来执行此操作。

我用来学习的教程是[http://beej.us/guide/bgnet/](http://beej.us/guide/bgnet/)。这是我环顾四周后发现的最好的教程，它给出了清晰的示例，并很好地解释了它描述的所有功能。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T23:05:36.103

对此有大量参考资料（当然，我想到了 Stevens 的书），但我发现[Beej 指南](http://beej.us/guide/bgnet/output/html/multipage/index.html)对入门非常有用。它足够丰富，你可以理解真正发生的事情，但它足够简单，不需要你花几天时间来编写一个“hello world”udp 客户端/服务器。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T23:06:11.203

简单的：

```
#include <sys/socket.h>
#include <sys/types.h>

int socket(int protocolFamily, int Type, int Protocol)
// returns a socket descriptor

int bind(int socketDescriptor, struct sockaddr* localAddress, unsigned int addressLength)
// returns 0 
```

...ETC。

都在 sys/socket.h

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T23:16:26.887

海报，请澄清你的问题。

几乎所有的回复似乎都认为您要的是套接字教程。我读到您的问题意味着您需要创建一个能够发送任意 IP 数据包的原始套接字。正如我在之前的回答中所说，一些操作系统限制了原始套接字的使用。

[http://linux.die.net/man/7/raw](http://linux.die.net/man/7/raw) “只有有效用户 ID 为 0 或 CAP_NET_RAW 能力的进程才允许打开原始套接字。”

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T23:30:47.087

阅读Richard Stevens 的[Unix Network Programming](https://rads.stackoverflow.com/amzn/click/com/0131411551)。必须的。它解释了它是如何工作的，给你代码，甚至给你帮助方法。你可能想看看他的其他一些书。 [Unix 环境中的高级编程对于 Unix](https://rads.stackoverflow.com/amzn/click/com/0201433079)中较低级别的编程来说是必须的。我什至不再在 Unix 堆栈上做任何事情，这些书中的内容仍然有助于我编写代码。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-27T16:38:17.243

[Libpcap](http://www.tcpdump.org/)将让您制作完整的数据包（第 2 层到第 7 层）并通过网络将它们发送出去。听起来很有趣，但有一些警告。您需要创建所有适当的标头并自己进行所有校验和。 [不过， Libnet](http://libnet.sourceforge.net/)可以提供帮助。

如果你想摆脱 C++ 编程池，python 有[scapy](http://www.secdev.org/projects/scapy/)。它使制作和传输 TCP/IP 数据包变得轻而易举。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-11-13T18:11:30.830

无论如何，如果您想使用 tcp/ip 堆栈，它们的标头将被添加到您的数据包中。如果你想控制数据包到字节，我建议你 npcap。不幸的是，Libpcap 已经过时了，尽管它更容易使用。但是，我个人使用过 npcap，它提供了对包的完全控制

# tomcat - Java EE 中有哪些用于定时批处理的工具？

> ID：78194
> 
> 赞同：2
> 
> 时间：2008-09-16T23:03:26.933
> 
> 标签：tomcat, jakarta-ee, process, timer, websphere

我的雇主刚刚要求我在他们正在运行的 Java EE WebSphere 应用程序中运行一个定时批处理。它应该在每天晚上 11:30 上一节课。

我对 Java EE 和 WebSphere 服务器（或开发环境中的 tomcat）不是很熟悉，我一直在研究，但我发现的只是关于 java timer 类，而不是如何设置或调用它.

似乎也需要编辑 web.xml 文件。

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T23:10:13.657

您应该查看来自 OpenSymphony的开源[Quartz 库。](http://www.quartz-scheduler.org/)非常易于使用，非常适合这种事情。

TimerTasks 最适合在未来短时间内运行某些东西。但是对于像这样在大时间范围内重复执行，Quartz 表现出色。您甚至可以将即将执行的任务列表保存在持久存储中，例如文件或数据库，因此如果您的应用程序重新启动，即将执行的定时作业不会丢失。

此外，Spring 框架中还有一个非常棒的 Quartz 抽象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-24T05:55:18.853

在 WebSphere 中，您可以使用调度程序服务来触发 Java 类中方法的执行。调度程序提供了一个用于调度作业执行的日历（类似于 cron），或者您可以开发自己的日历。

这是 WAS 6.1 文档中描述调度程序的页面的链接：

[http://publib.boulder.ibm.com/infocenter/wasinfo/v6r1/index.jsp](http://publib.boulder.ibm.com/infocenter/wasinfo/v6r1/index.jsp)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T20:31:48.810

EJB 3.1 将改进计时器服务，以及应用程序生命周期挂钩，无需使用 servlet 来启动任务而无需用户交互。

这可能会回答问题标题，但对于有关在 websphere 上运行的遗留应用程序（写于 6 个多月前；））的“真实”问题，我建议使用启动 servlet 和 EJB 计时器服务。

[J2EE 1.4 (EJB 2.1) 中的计时器服务](http://java.sun.com/j2ee/1.4/docs/tutorial/doc/Session5.html)

对于 EJB 3.0（和 3.1 尽快可用），有一些很好的注释；）

除非你真的需要它，否则我不会介绍另一个[库。](http://www.quartz-scheduler.org/)计时器服务应该足以每天执行任意工作。

HTH，
马丁

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T23:12:14.620

在您的 web.xml 中，您可以配置一个 servlet 以在启动时加载。
句法：

<servlet servlet-name='hello' servlet-class='test.HelloWorld'>
<load-on-startup/>
</servlet>

这样做，然后在 servlet 的 init 方法中，您可以设置 Timer / TimerTask 来执行您需要执行的任何操作。TimerTasks 类似于线程，只是您可以安排它们何时运行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T02:22:44.693

Quartz 是标准 JBoss 4.2.x 发行版的一部分。

并且是一个非常好的库，无需太多工作，您也可以定义简单的工作流程。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T20:16:59.050

WebSphere 中不支持调度。

如果您使用的是 unix，则可以使用 crontab 来安排对 websphere 应用程序页面的请求。我想在 Windows 上也可以安排对页面的请求。在我的 crontab 中，我安排了每天 8:45 对网页的请求

45 8 * * * 获取[http://www.domain.com/myBatch?securitykey=verysecret](http://www.domain.com/myBatch?securitykey=verysecret)

现在每天早上都会调用 myBatch servlet，我可以在那里做当时需要做的任何事情。为了避免其他人调用此页面并启动批处理，我添加了 securitykey 参数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-08T18:52:01.037

WebSphere 中包含对调度的支持。

WAS v7.0 [http://publib.boulder.ibm.com/infocenter/wasinfo/v7r0/topic/com.ibm.websphere.base.doc/info/aes/ae/welc6tech_sch.html](http://publib.boulder.ibm.com/infocenter/wasinfo/v7r0/topic/com.ibm.websphere.base.doc/info/aes/ae/welc6tech_sch.html)

WAS v6.1 [http://publib.boulder.ibm.com/infocenter/wasinfo/v6r1/topic/com.ibm.websphere.base.doc/info/aes/ae/welc6tech_sch.html](http://publib.boulder.ibm.com/infocenter/wasinfo/v6r1/topic/com.ibm.websphere.base.doc/info/aes/ae/welc6tech_sch.html)

# django - 为单点登录管理大型用户数据库

> ID：78217
> 
> 赞同：6
> 
> 时间：2008-09-16T23:08:32.803
> 
> 标签：django, authentication, active-directory, ldap, authorization

您将如何实施具有以下目标的系统：

*   管理目前与第三方供应商的应用程序紧密集成的**数十万***现有用户*的身份验证和授权 （我们希望将这些用户分解为我们管理的东西，并让我们的应用程序与之抗衡，加上我们的第 3 方供应商与之抗衡）。
*   管理链接到这些用户的个人资料信息
*   必须能够从几乎任何平台（Windows、*nix、PHP、ASP/C#、Python/Django 等）上的任意数量的 Web 应用程序访问。

这里有一些示例实现：

*   LDAP/AD 服务器来管理一切。对所有配置文件数据使用自定义架构。一切都可以针对 LDAP/AD 进行身份验证，我们可以将各种 ACL 和配置文件数据存储在自定义模式中。
*   仅使用 LDAP/AD 进行身份验证，使用某种传统数据库（MSSQL/PostgreSQL/MySQL）或基于文档的数据库（CouchDB、SimpleDB 等）将 LDAP 用户绑定到最强大的配置文件/授权服务器。使用 LDAP 进行授权，然后点击数据库获取更高级的内容。
*   对所有内容都使用传统数据库（关系或文档）。

这三个是最好的吗？是否有其他符合上述目标且更易于实施的解决方案？

** 我应该补充一点，几乎所有将对用户数据库进行身份验证的应用程序都在我们的控制之下。唯一的少数外部人员将是我们正在从中删除当前用户数据库的应用程序，也许还有 1 或 2 个其他应用程序。没有什么比需要 openID 服务器更广泛的了。

同样重要的是要知道这些用户中的许多人已经拥有这些帐户 5-8 年并且知道他们的登录名和密码等等。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T23:26:51.747

身份验证和授权/分析之间存在差异，因此不必强制将两者都强制到一个工具中。您使用 LDAP 进行身份验证和使用数据库进行授权的第二种解决方案似乎更健壮，因为 LDAP 数据由用户控制，而数据库将由管理员控制。后者可能会随着时间的推移在结构和复杂性上发生变化，但身份验证就是那种身份验证。这些功能的分离将证明更易于管理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T23:19:26.273

如果您有一个现有的 ActiveDirectory 基础结构，那将是可行的方法。这对于已经设置了 Windows 服务器进行身份验证的公司尤其有利。如果是这种情况，我倾向于您在“示例实现”中的第一个要点。

否则，它将是 AD 和开源 LDAP 选项之间的折腾。

为单点登录滚动您自己的身份验证架构可能是不可行的（特别是考虑到您可能必须做的大量文档和集成工作），并且显然不要将您的身份验证服务器与运行在其上的任何应用程序捆绑在一起您的系统（因为您希望它能够独立于此类应用程序的负载）。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T23:29:37.090

仅使用 LDAP/AD 进行身份验证，使用某种传统数据库（MSSQL/PostgreSQL/MySQL）或基于文档的数据库（CouchDB、SimpleDB 等）将 LDAP 用户绑定到最强大的配置文件/授权服务器。使用 LDAP 进行授权，然后点击数据库获取更高级的内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T23:31:58.567

我们有大约 10 万用户的不同站点，它们都使用普通数据库。如果大多数应用程序可以访问数据库，您可以使用此解决方案。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-16T23:14:00.373

您始终可以实现自己的[OpenID](http://openid.net/what/)服务器。已经有一个[用于 OpenID 的 Python 库，](http://openidenabled.com/python-openid/)所以它应该相当容易。

当然，您不需要在您的应用程序中接受其他服务器授权的登录。接受仅由您自己的服务器授权的凭据。

**编辑：**我[在 Django 中找到了 OpenID 服务器协议的实现](http://trac.nicolast.be/djangoid)。

**Edit2：**为您的用户实施 OpenID 有一个明显的优势。他们将能够使用他们的登录名登录到 StackOverflow :-)

# apache-flex - 使用 ant 和 flex sdk 编译 mxml 文件

> ID：78230
> 
> 赞同：7
> 
> 时间：2008-09-16T23:10:27.480
> 
> 标签：apache-flex, ant, mxml

我刚刚开始使用 flex，并且正在使用 SDK（不是 Flex Builder）。我想知道从 ant 构建脚本编译 mxml 文件的最佳方法是什么。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-16T23:12:55.413

Flex SDK 附带一组 ant 任务。更多信息在：

[http://livedocs.adobe.com/flex/3/html/help.html?content=anttasks_1.html](http://livedocs.adobe.com/flex/3/html/help.html?content=anttasks_1.html)

以下是使用 ant 编译 Flex SWC 的示例：

[http://www.mikechambers.com/blog/2006/05/19/example-using-ant-with-compc-to-compile-swcs/](http://www.mikechambers.com/blog/2006/05/19/example-using-ant-with-compc-to-compile-swcs/)

迈克室

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T15:42:36.280

我肯定会使用 Flex 中包含的 ant 任务，它们使您的构建脚本更加简洁。这是一个示例构建脚本，它将编译然后运行您的 flex 项目

```
<?xml version="1.0"?>

<project name="flexapptest" default="buildAndRun" basedir=".">

    <!-- 
        make sure this jar file is in the ant lib directory 
        classpath="${ANT_HOME}/lib/flexTasks.jar" 
    -->
    <taskdef resource="flexTasks.tasks" />
    <property name="appname" value="flexapptest"/>
    <property name="appname_main" value="Flexapptest"/>
    <property name="FLEX_HOME" value="/Applications/flex_sdk_3"/>
    <property name="APP_ROOT" value="."/>
    <property name="swfOut" value="dist/${appname}.swf" />
    <!-- point this to your local copy of the flash player -->
    <property name="flash.player" location="/Applications/Adobe Flash CS3/Players/Flash Player.app" />

    <target name="compile">
        <mxmlc file="${APP_ROOT}/src/${appname_main}.mxml"
            output="${APP_ROOT}/${swfOut}" 
            keep-generated-actionscript="true">

            <default-size width="800" height="600" />
            <load-config filename="${FLEX_HOME}/frameworks/flex-config.xml"/>
            <source-path path-element="${FLEX_HOME}/frameworks"/>
            <compiler.library-path dir="${APP_ROOT}/libs" append="true">
                <include name="*.swc" />
            </compiler.library-path>
        </mxmlc>
    </target>

    <target name="buildAndRun" depends="compile">
        <exec executable="open">
            <arg line="-a '${flash.player}'"/>
            <arg line="${APP_ROOT}/${swfOut}" />
        </exec>
    </target>

    <target name="clean">
        <delete dir="${APP_ROOT}/src/generated"/>
        <delete file="${APP_ROOT}/${swfOut}"/>
    </target>

</project> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-03T23:55:06.600

还有另一种选择 - 它称为[Project Sprouts](http://projectsprouts.org)。

这是一个使用 Ruby、RubyGems 和 Rake 构建的系统，提供了 Maven 和 ANT 中的许多功能，但语法更简洁，构建脚本更简单。

例如，上面显示的 ANT 脚本在 Sprouts 中将如下所示：

```
require 'rubygems'
require 'sprout'

desc 'Compile and run the SWF'
flashplayer :run => 'bin/SomeProject.swf'

mxmlc 'bin/SomeProject.swf' do |t|
  t.input = 'src/SomeProject.as'
  t.default_size = '800 600'
  t.default_background_color = '#ffffff'
  t.keep_generated_actionscript = true
  t.library_path << 'libs'
end

task :default => :run 
```

安装 Ruby 和 RubyGems 后，您只需调用此脚本：

```
rake 
```

要删除生成的文件，请运行：

```
rake clean 
```

要查看可用任务：

```
rake -T 
```

Sprouts 安装后的另一个巨大好处是，它提供了项目、类和测试生成器，可以通过几个简单的命令行操作让任何开发框准备好运行。

```
# Generate a project and cd into it:
sprout -n mxml SomeProject
cd SomeProject

# Compile and run the main debug SWF:
rake

# Generate a new class, test case and test suite:
script/generate class utils.MathUtil

# Compile and run the test harness:
rake test 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T06:22:37.253

如果您对 Maven 开放，请尝试使用 flex-compiler-mojo 插件：

[http://code.google.com/p/flex-mojos/](http://code.google.com/p/flex-mojos/)

克里斯蒂安

# c# - XML to Excel (2007) Ideas using Windows XP, and C#.Net

> ID：78233
> 
> 赞同：2
> 
> 时间：2008-09-16T23:10:38.790
> 
> 标签：c#, .net, xml, excel

我有一个已修改为 xml 文档的数据集，然后使用 xsl 表转换为 Excel xml 格式，以便允许从我的应用程序以编程方式打开数据。我遇到了两个问题：

1.  Excel 不是打开 Excel 文件的默认 Windows 应用程序，因此在运行 Program.Start("xmlfilename.xml") 时，会打开 IE，并且 XML 文件的可读性不是很好。

2.  如果您将该文件重命名为 .xlsx，您会收到一条警告，“这不是一个 excel 文件，您希望继续吗”。这对客户来说并不理想。

理想情况下，我希望 Windows 在不修改打开 Excel 文件的默认操作系统设置的情况下在 Excel 中打开文件。Office 互操作是一种可能性，但对于这个应用程序来说似乎有点过头了。有没有人有任何想法来完成这项工作？

解决方案在 .Net/C# 中，但我对创建干净解决方案的其他可能性持开放态度。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T12:51:19.613

如果将以下内容插入 XML 的第二行，它会指示 Windows 使用 Excel 打开

```
<?mso-application progid="Excel.Sheet"?> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T23:12:43.277

如果将文件保存为 xlsx（XML-Excel 的扩展名）会怎样？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T23:19:42.077

```
Process.Start(@"C:\Program Files\Microsoft Office\Officexx\excel.exe", "yourfile.xml"); 
```

话虽如此，您仍然会收到消息框。我想您可以使用 Interop，但我不确定它对您的效果如何。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T23:21:36.017

正如 Sam 所提到的，xlsx 文件扩展名可能是一个不错的选择。但是，涉及的不仅仅是将 xml 文件保存为 xlsx。xlsx 实际上是一个 zip 文件，文件夹中有一堆 xml 文件。[我在这里](http://www.gemboxsoftware.com/Excel2007/DemoApp.htm)找到了一些很好的示例代码，虽然我没有亲自尝试过，但它似乎给出了一些很好的解释。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T01:05:33.193

提前为插入第三方库道歉，我知道它不是免费的，但我使用TMS Software 的[FlexCel Studio](http://www.tmssoftware.com/site/flexcelnet.asp)。如果您希望做的不仅仅是转储数据（格式化、动态交叉表等），它会非常有效。我们使用它每周生成数百份报告。

FlexCel 接受强类型数据集，它可以根据关系对数据进行分组，并且生成的 Excel 文件看起来比从 Crystal Reports excel 导出中获得的要干净得多。我已经完成了水晶报告的事情，以及 OLE 自动化的事情。FlexCel 的售价为 125 欧元。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-02T19:57:20.630

希望这可以帮助。

MSDN 中的 OpenXML - [http://msdn.microsoft.com/en-us/library/microsoft.office.interop.excel.workbooks.openxml(v=office.11 ​​).aspx](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.excel.workbooks.openxml%28v=office.11%29.aspx)

```
using Excel = Microsoft.Office.Interop.Excel;

string workbookPath= @"C:\temp\Results_2013Apr02_110133_6692.xml";

            this.lblResultFile.Text = string.Format(@" File:{0}",workbookPath);
            if (File.Exists(workbookPath))
            {
                Excel.Application excelApp = new Excel.Application();
                excelApp.Visible = true;
                Excel.Workbook excelWorkbook = excelApp.Workbooks.OpenXML(workbookPath, Type.Missing, Excel.XlXmlLoadOption.xlXmlLoadPromptUser);
            }
            else
            {
                MessageBox.Show(String.Format("File:{0} does not exists", workbookPath));
            } 
```

# python - OpenGL 用户界面编程

> ID：78238
> 
> 赞同：3
> 
> 时间：2008-09-16T23:11:31.160
> 
> 标签：python, user-interface, opengl

我正在开发一个图形应用程序来呈现数据（不是游戏，而是一个真正的主力应用程序）。它需要是跨平台的，所以我选择了：

*   Python
*   openGL（我需要 3D、混合、纹理等）
*   pyopengl
*   wx/pywx - 窗口、对话框等。

最后一个组件——WX——提出了这个问题。我可以组装一个非常漂亮的应用程序（原型看起来很漂亮） - 但是当我需要与用户交互以提出问题、获取输入时，我必须使用 WX。在具有混合、平滑运动、纹理等的全屏 3D 应用程序之上具有带有传统对话框和组合以及文本输入的传统 UI，这使得应用程序看起来不一致。

有没有人使用 OpenGL 和 python 开发过 GUI？你能和我分享你使用的工具包和/或技巧吗？我需要组合、文本输入、按钮、收音机、选项按钮、树视图。

那里有一些工具包，但它们要么不完整，要么陈旧且未维护。一个很好的例子是 pyUI ( [http://pyui.sourceforge.net/](http://pyui.sourceforge.net/) ) - 看起来很漂亮但多年来没有受到影响。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-16T23:41:09.497

这不是答案，更多的是恳求：请不要那样做。

您重新实现的小部件将缺少用户会错过的各种功能。您的文本输入框是否支持拖放？复制粘贴？从右到左的脚本？拖动选择？双击选择？所有这些机制都会遵循您支持的每个平台的本机约定吗？

使用 Wx，您的小部件可能看起来与应用程序不一致，但至少它们看起来与同样重要的操作系统一致。更重要的是，他们会做用户期望的事情。

（编辑）三个帖子和-3分？搞砸这个业力妓女的巢穴。原始海报：我已经在 OpenGL 中实现了一组基本的小部件（用于游戏 UI），这是一项永无止境的噩梦。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T10:21:40.307

在 QT 的最新版本中，如果您真的想做类似的事情，您可以将小部件绘制*到您的 OpenGL 上下文中。*否则，某些游戏引擎中会使用[CEGui](http://www.cegui.org.uk/wiki/index.php/Main_Page)。

除非您想启发自己，否则自己实现 GUI 小部件是在浪费您的时间，除非您对最基本的外观和功能感到满意。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T00:14:41.617

Python + Qt + OpenGL - 我相信任何应用程序都可以使用 python 更快更好地编写。QT4 是跨平台的、美观的，实现了您从小部件（可访问性等...）所需的一切，并且...它与 OpenGL 集成。这意味着，您可以简单地拥有一个小部件，它是您在代码中呈现的 openGL 内容的视口。

另一个可以覆盖大部分内容但在用户界面上不那么友好的 3D 解决方案是使用 python 脚本扩展 Blender3D。它具有 3d 功能和渲染功能，您可以在 python 中编写所有相同的脚本，并且它将是跨平台的 - 您可以获得比单独使用 openGL 更高级的工具来处理 3D 事物。与 PyQT 相比，主要从 UI 的角度来看，有明显的缺点，但它可以做到。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T23:39:31.263

你可能想看看[Clutter](http://clutter-project.org/)，它看起来很酷。我还没有使用它，但我打算在即将到来的个人项目中使用它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T23:57:37.070

尝试 Qt 而不是 wx。

QT 是跨平台的，您可以使用 CSS 设置很多样式。它的文档非常好，并且具有出色的 python 绑定。事实上，我使用的是 C++ 文档而不是 PyQT 文档。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-17T17:14:16.907

wx 和 QT 在创建与操作系统外观和感觉相匹配的应用程序方面做得非常出色。也可以直接在 openg 中自己实现所有小部件，这个 slashdot 帖子列出了一些可用的集合

[http://ask.slashdot.org/askslashdot/02/12/24/1813219.shtml?tid=156](http://ask.slashdot.org/askslashdot/02/12/24/1813219.shtml?tid=156) fox 可能是最发达的，但在所有平台上看起来都像 Windows。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-10-08T13:59:37.573

Blender 是我所知道的唯一一个使用完全用 OpenGL 编写的 GUI 的应用程序……唯一的问题是它是用 C++ 编写的。

我也是一名 Python 开发人员，但我刚刚开始使用 OGL

老实说，我不认为有任何工具包可以在 OGL 中开发 GUI ......

Blender 开发人员正在给我运行文档而不是直接帮助......但我会让你知道我想出什么;）

编辑：这里有一些关于 PyOpenGL 功能的文档：http: [//pyopengl.sourceforge.net/documentation/manual/reference-GLUT.html](http://pyopengl.sourceforge.net/documentation/manual/reference-GLUT.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-10-21T11:18:49.700

“ [cegui](http://cegui.org.uk) ”是一个不错的选择，还有一个名为“ceed”的 gui 编辑器来生成布局 xml 文件。cegui 也有 python 绑定及其有据可查的文档并在许多游戏引擎中使用

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2011-10-08T14:50:03.933

我的朋友。
我相信我找到了你的答案；）
[http://glinter.sourceforge.net/](http://glinter.sourceforge.net/)

我还没有尝试过，但它似乎很有希望。（如果它不起作用，我会编辑它）

编辑：
嗯……
它使用 Tk、PMW 和 WX……
（不是我想要的）

你可以试试 CVS 下载...
（没有发布的包，但 CVS 运行）

# web-services - 字典网络服务推荐

> ID：78257
> 
> 赞同：17
> 
> 时间：2008-09-16T23:14:16.613
> 
> 标签：web-services

很多谷歌搜索对我没有帮助！有没有好的字典网络可用？

如果我们通过查询字符串传递单词，我正在寻找一个可以向我发送单词含义的站点！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-16T23:20:34.290

我在[Aonaware](http://services.aonaware.com/DictService/)找到了一个带有 Web API的[Big Huge Thesaurus](http://words.bighugelabs.com/) ，以及一个看起来使用 SOAP的字典

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-15T05:46:11.480

还有已经存在很长时间的[dict协议。](http://dict.org)我喜欢 dict 的一件事是可用的命令行查询程序。

我还创建了一个[维基词典到 dict 网关](http://hewgill.com/dict/)，它通过 dict 协议提供对维基词典数据库的访问。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-08-26T08:21:37.823

我又找到了三个：

*   可编程网络： http: [//www.programmableweb.com/api/oxford-english-dictionary](http://www.programmableweb.com/api/oxford-english-dictionary)
*   Glosbe API： http: [//glosbe.com/a-api](http://glosbe.com/a-api)
*   字典服务：[http ://services.aonaware.com/DictService/DictService.asmx](http://services.aonaware.com/DictService/DictService.asmx)

# ajax - 您实施了哪些解决方法/应对策略来处理多个选项卡与两个连接限制问题？

> ID：78262
> 
> 赞同：2
> 
> 时间：2008-09-16T23:14:45.177
> 
> 标签：ajax, tabs, two-connection-limit

当您同时打开多个选项卡时，两个连接限制可能会特别麻烦。除了“忽略问题”之外，尽管有两个连接限制，您还见过哪些应对机制让多个选项卡都执行高度交互的 Ajax？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T00:34:03.410

如果您将 Ajax 请求发送到不同的子域，它们不会干扰常规页面的连接限制。不过，这将花费额外的 DNS 查找费用

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T23:35:17.153

两个连接限制是一个“建议”，[本文](http://www.oreillynet.com/xml/blog/2006/10/what_i_didnt_know_about_xhr.html)描述了如何在可能的情况下绕过它。其他 Firefox 配置在此讨论关于 Firefox 中的[about:config](http://kb.mozillazine.org/Firefox_:_FAQs_:_About:config_Entries)功能。

此外，如果您拥有该网站，您可以使用来自首席性能雅虎的[本书中的建议来调整网站的性能。](https://rads.stackoverflow.com/amzn/click/com/0596529309)

# delphi - 如何修复损坏的 Delphi 2009 安装

> ID：78263
> 
> 赞同：2
> 
> 时间：2008-09-16T23:15:03.210
> 
> 标签：delphi, delphi-2009

当我收到 Delphi 2009 试用版和实际版本时，我通过 Web 安装程序安装了它们，并且在安装它们时遇到了相同的错误。

两次似乎核心 Web 安装程序在生成用于 boost、文档和 dbtools 的附加安装包时都失败了。（它打开了一个查找文件对话框，询问我的机器上不存在的 setup.msi）。取消此操作时，安装程​​序报告了一个致命错误。

卸载程序没有出现在我的程序列表中，也不会从安装文件夹启动。

未来尝试启动安装程序时，它认为 Delphi 2009 已经安装，并且不会更正、修复或卸载它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T04:15:34.860

## 第1步

清除所有 Delphi 2009 的注册表。

您正在寻找*HKLM\Software\Codegear\BDS\6.0*及其下的所有内容。当你在它的时候清除 HKCU 等价物。

在 HKEY.CLASSES.ROOT 下搜索包含“CodeGear\RAD Studio\6.0”的任何内容 - 假设您安装到默认文件夹中。从 CLSID 级别清除所有这些项目。

## 第2步

使用[Microsoft Windows Installer 清理](http://support.microsoft.com/kb/290301 "Microsoft Windows 安装程序清理实用程序")实用程序清理 Windows Installer。

## 第 3 步

我建议在这个阶段重新启动。

## 第4步

尝试再次安装。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T23:17:44.310

问题似乎源于 Web 安装程序没有所需的所有文件。

下载 2009 ISO：[http ://cc.codegear.com/item/26049](http://cc.codegear.com/item/26049)

使用 Microsoft 提供的这个免费工具安装它：http: [//download.microsoft.com/download/7/b/6/7b6abd84-7841-4978-96f5-bd58df02efa2/winxpvirtualcdcontrolpanel_21.exe](http://download.microsoft.com/download/7/b/6/7b6abd84-7841-4978-96f5-bd58df02efa2/winxpvirtualcdcontrolpanel_21.exe) （您也可以将其刻录到 DVD）

然后重新运行安装程序。此时，修复和卸载都有效。

# c - 如何保证 64 位写入是原子的？

> ID：78277
> 
> 赞同：20
> 
> 时间：2008-09-16T23:16:55.577
> 
> 标签：c, multithreading, macos, atomic, lock-free

当在基于 Intel x86 的平台（特别是基于 Intel 的 Mac 使用 Intel 编译器运行 MacOSX 10.4）上用 C 编程时，何时可以保证 64 位写入是原子的？例如：

```
unsigned long long int y;
y = 0xfedcba87654321ULL;
/* ... a bunch of other time-consuming stuff happens... */
y = 0x12345678abcdefULL; 
```

如果在对 y 的第一次赋值完成执行后另一个线程正在检查 y 的值，我想确保它看到值 0xfedcba87654321 或值 0x12345678abcdef，而不是它们的混合。我想在没有任何锁定的情况下执行此操作，并且如果可能的话，无需任何额外的代码。我希望，在能够支持 64 位代码（MacOSX 10.4）的操作系统上使用 64 位编译器（64 位 Intel 编译器）时，这些 64 位写入将是原子的。这总是正确的吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-16T23:35:50.803

最好的办法是避免尝试用原语构建自己的系统，而是使用锁定，除非它在分析时**确实**显示为热点。（如果您认为自己可以聪明并避免使用锁，请不要这样做。您不是。那是一般的“您”，包括我和其他所有人。）您至少应该使用自旋锁，请参阅[spinlock(3)](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man3/spinlock.3.html)。无论你做什么，**都不要**试图实现“你自己的”锁。你会弄错的。

最终，您需要使用操作系统提供的任何锁定或原子操作。在**所有情况下都****完全正确地完成**这些事情是**极其困难**的。通常它可能涉及诸如特定处理器特定版本的勘误表之类的知识。（“哦，那个处理器的 2.0 版没有在正确的时间进行缓存一致性窥探，它在 2.0.1 版中已修复，但在 2.0 版中您需要插入一个.”）只需在 C 中的变量上添加一个关键字几乎总是不足的。****`NOP``volatile`****

 ****在 Mac OS X 上，这意味着您需要使用[atomic(3)](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man3/atomic.3.html)中列出的函数在 32 位、64 位和指针大小的数量上执行真正的跨所有 CPU 的原子操作。（将后者用于指针上的任何原子操作，这样您就可以自动兼容 32/64 位。）无论您想要执行原子比较和交换、递增/递减、自旋锁定或堆栈/队列等操作，这都适用管理。幸运的是[spinlock(3)](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man3/spinlock.3.html)、[atomic(3)](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man3/atomic.3.html)和[barrier(3)](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man3/barrier.3.html)函数都应该在 Mac OS X 支持的所有 CPU 上正常工作。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-16T23:26:04.727

在 x86_64 上，Intel 编译器和 gcc 都支持一些内在的原子操作函数。这是 gcc 的文档： http: [//gcc.gnu.org/onlinedocs/gcc-4.1.0/gcc/Atomic-Builtins.html](http://gcc.gnu.org/onlinedocs/gcc-4.1.0/gcc/Atomic-Builtins.html)

英特尔编译器文档也在此处讨论它们：http: [//softwarecommunity.intel.com/isn/downloads/softwareproducts/pdfs/347603.pdf](http://softwarecommunity.intel.com/isn/downloads/softwareproducts/pdfs/347603.pdf)（第 164 页或附近）。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-16T23:39:53.477

根据Intel[处理器手册](http://www.intel.com/products/processor/manuals/index.htm)[第 3A 部分 - System Programming Guide](http://download.intel.com/design/processor/manuals/253668.pdf)的第 7 章，如果在 Pentium 或更新版本的 64 位边界上对齐，并且在高速缓存行中未对齐（如果仍在高速缓存行内），四字访问将自动执行。 P6 或更高版本。您应该使用以确保编译器不会尝试将写入缓存在变量中，并且您可能需要使用内存围栏例程来确保写入以正确的顺序发生。`volatile`

如果您需要基于现有值写入值，则应使用操作系统的 Interlocked 功能（例如 Windows 具有 InterlockedIncrement64）。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-16T23:49:14.093

在 Intel MacOSX 上，您可以使用内置的系统原子操作。没有为 32 位或 64 位整数提供原子获取或设置，但您可以使用提供的 CompareAndSwap 构建它。您可能希望在 XCode 文档中搜索各种 OSAtomic 函数。我在下面写了 64 位版本。32 位版本可以使用类似名称的函数来完成。

```
#include <libkern/OSAtomic.h>
// bool OSAtomicCompareAndSwap64Barrier(int64_t oldValue, int64_t newValue, int64_t *theValue);

void AtomicSet(uint64_t *target, uint64_t new_value)
{
    while (true)
    {
        uint64_t old_value = *target;
        if (OSAtomicCompareAndSwap64Barrier(old_value, new_value, target)) return;
    }
}

uint64_t AtomicGet(uint64_t *target)
{
    while (true)
    {
        int64 value = *target;
        if (OSAtomicCompareAndSwap64Barrier(value, value, target)) return value;
    }
} 
```

请注意，Apple 的 OSAtomicCompareAndSwap 函数以原子方式执行操作：

```
if (*theValue != oldValue) return false;
*theValue = newValue;
return true; 
```

我们在上面的示例中使用它来创建一个 Set 方法，首先获取旧值，然后尝试交换目标内存的值。如果交换成功，则表明内存的值仍然是交换时的旧值，并且在交换期间被赋予了新值（它本身是原子的），所以我们完成了。如果它没有成功，那么当我们抓取它和尝试重置它时，其他一些线程通过修改中间值进行了干扰。如果发生这种情况，我们可以简单地循环并重试，而代价很小。

Get 方法背后的想法是我们可以首先获取值（如果另一个线程正在干扰，它可能是也可能不是实际值）。然后我们可以尝试将值与自身交换，简单地检查初始抓取是否等于原子值。

我没有根据我的编译器检查这个，所以请原谅任何错别字。

您特别提到了 OSX，但如果您需要在其他平台上工作，Windows 有许多 Interlocked* 功能，您可以在 MSDN 文档中搜索它们。其中一些适用于 Windows 2000 Pro 及更高版本，而一些（尤其是一些 64 位功能）是 Vista 中的新功能。在其他平台上，GCC 4.1 及更高版本具有多种 __sync* 函数，例如 __sync_fetch_and_add()。对于其他系统，您可能需要使用汇编，您可以在 src/system/libroot/os/arch 中找到 HaikuOS 项目的 SVN 浏览器中的一些实现。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-10-30T19:33:45.640

在 X86 上，以原子方式写入对齐的 64 位值的最快方法是使用 FISTP。对于未对齐的值，您需要使用 CAS2 (_InterlockedExchange64)。由于 BUSLOCK，CAS2 操作非常慢，因此检查对齐并为对齐地址执行 FISTP 版本通常会更快。事实上，这就是[英特尔线程构建模块](http://www.threadingbuildingblocks.org/)实现原子 64 位写入的方式。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-04-06T22:20:29.023

最新版本的 ISO C (C11) 定义了一组原子操作，包括`atomic_store(_explicit)`. 有关更多信息，请参见例如[此页面](http://en.cppreference.com/w/c/atomic)。

第二个最可移植的原子实现是 GCC 内在函数，我们已经提到过。我发现 GCC、Clang、Intel 和 IBM 编译器完全支持它们，并且 - 截至我上次检查时 - Cray 编译器部分支持它们。

除了整个 ISO 标准之外，C11 原子的一个明显优势是它们支持更精确的内存一致性规定。据我所知，GCC 原子意味着一个完整的内存屏障。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-16T23:41:31.930

如果你想为线程间或进程间通信做这样的事情，那么你需要的不仅仅是原子读/写保证。在您的示例中，您似乎希望写入的值表明某些工作正在进行中和/或已完成。您将需要做几件事情，但并非所有事情都是可移植的，以确保编译器按照您希望的顺序完成事情（volatile 关键字可能在一定程度上有所帮助）并且内存是一致的。现代处理器和缓存可以在编译器不知道的情况下乱序执行工作，因此您确实需要一些平台支持（即锁或特定于平台的互锁 API）来执行您想要执行的操作。

“内存栅栏”或“内存屏障”是您可能想要研究的术语。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T23:18:28.880

GCC 具有原子操作的内在函数；我怀疑你也可以用其他编译器做类似的事情。永远不要依赖编译器进行原子操作；优化几乎肯定会冒着将明显的原子操作变成非原子操作的风险，除非您明确告诉编译器不要这样做。

# perl - Perl 中策略模式的干净实现

> ID：78278
> 
> 赞同：3
> 
> 时间：2008-09-16T23:17:06.200
> 
> 标签：perl, design-patterns, strategy-pattern

如何在 Perl 中编写策略模式的干净实现？我想以一种利用 Perl 特性的方式来做这件事。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T14:17:36.333

这真的取决于你所说的“干净的实施”是什么意思。与任何其他语言一样，您可以使用 Perl 的具有多态性的对象系统来为您执行此操作。然而，由于 Perl 具有一流的函数，这种模式通常不会被显式编码。Leon Timmermans 的例子

```
sort { lc($a) cmp lc($b) } @items 
```

非常优雅地展示了这一点。

[但是，如果您正在寻找像在 C++ 中那样的“正式”实现，这就是使用 Perl+ Moose](http://search.cpan.org/dist/Moose)的样子。这只是[Wikipedia -- Strategy pattern](http://en.wikipedia.org/wiki/Strategy_pattern)中 C++ 代码的翻译，除了我使用 Moose 对委派的支持。

```
package StrategyInterface;
use Moose::Role;
requires 'run';

package Context;
use Moose;
has 'strategy' => (
  is      => 'rw',
  isa     => 'StrategyInterface',
  handles => [ 'run' ],
);

package SomeStrategy;
use Moose;
with 'StrategyInterface';
sub run { warn "applying SomeStrategy!\n"; }

package AnotherStrategy;
use Moose;
with 'StrategyInterface';
sub run { warn "applying AnotherStrategy!\n"; }

###############
package main;
my $contextOne = Context->new(
  strategy => SomeStrategy->new()
);

my $contextTwo = Context->new(
  strategy => AnotherStrategy->new()
);

$contextOne->run();
$contextTwo->run(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T23:21:53.973

使用子引用和闭包。一个很好的例子

```
sort { lc($a) cmp lc($b) } @items 
```

# c# - 使用 .NET 在 Windows XP 和 Vista 上读取正在使用的文件和系统文件

> ID：78282
> 
> 赞同：0
> 
> 时间：2008-09-16T23:17:42.190
> 
> 标签：c#, .net, windows

我有一个免费备份应用程序的想法。

我目前需要解决的最大问题是如何访问正在使用的文件或系统文件。我希望该应用程序能够执行文件的完整备份（即不在逐个扇区的磁盘扇区上）。

我将把应用程序的服务器部分变成服务。首先，我猜这个服务需要以管理权限运行？其次，是否可以访问锁定的文件和系统使用的文件？也许在下次重新启动后获取这些文件？（我见过一些反病毒应用程序就是这样工作的。）

我将使用 C# 和 .NET 平台，因为这似乎是目前开发 Windows 应用程序的最简单方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T23:30:03.267

关于正在使用的文件，您正在寻找的是“[卷影复制服务](http://msdn.microsoft.com/en-us/library/bb968832(VS.85).aspx "MSDN - 卷影复制服务")”，它在 Windows XP、Server 2003 及更高版本上可用。这将允许您复制文件，即使它们正在使用中。

我找到了一篇 CodeProject 文章“[来自 .NET 的卷影副本](http://www.codeproject.com/KB/dotnet/makeshadowcopy.aspx?display=Print "CodeProject - 来自 .NET 的卷影副本")”，它描述了一个针对卷影副本编写的简单 Outlook PST 备份应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T23:24:30.643

在 HoboCopy 上做一个谷歌。它是一个开源的windows备份工具，可以使用Windows卷影服务备份正在使用的文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T23:30:47.727

.NET 中没有任何东西可以直接 AFAIK 做到这一点。

我认为您正在寻找专为此类任务设计的 XP/Vista 上的**[卷影复制。](http://msdn.microsoft.com/en-us/library/bb968832(VS.85).aspx)**

# php - 即使使用 error_reporting(0)，PHP 也会回显错误的原因是什么？

> ID：78296
> 
> 赞同：11
> 
> 时间：2008-09-16T23:21:23.193
> 
> 标签：php, error-reporting, ini-set

无论您告诉它禁用什么，PHP 都会强制显示错误的一些原因是什么？

我试过了

```
error_reporting(0);
ini_set('display_errors', 0); 
```

没有运气。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-16T23:26:17.067

请注意[http://uk.php.net/error_reporting](http://uk.php.net/error_reporting)手册中的警告：

> > 大多数 E_STRICT 错误是在编译时评估的，因此此类错误不会在增强 error_reporting 以包含 E_STRICT 错误的文件中报告（反之亦然）。

如果您的底层系统配置为报告 E_STRICT 错误，则这些错误可能会在您的代码被考虑之前就被输出。不要忘记，error_reporting/ini_set 是运行时评估，在“运行前”阶段执行的任何操作都不会看到它们的效果。

* * *

根据您的评论，您的错误是...

> 解析错误：语法错误，意外的 T_VARIABLE，需要 ',' 或 ';' 在第 11 行的 /usr/home/REDACTED/public_html/dev.php

然后同样的一般概念适用。您的代码永远不会运行，因为它在语法上无效（您忘记了“;”）。因此，永远不会遇到您更改错误报告的情况。

解决此问题需要更改系统级错误报告。例如，在 Apache 上，您可以放置​​...

php_value error_reporting 0

在 .htaccess 文件中将它们全部抑制，但这取决于系统配置。

务实地，不要写有语法错误的文件:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-18T13:06:59.427

为防止显示错误，您可以

*   写入 .htaccess: *php_flag display_errors 0*
*   将代码拆分到单独的模块中，其中主（父）PHP 文件仅设置 error_logging，然后 include() 其他文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-02T15:52:17.523

使用[phpinfo](http://php.net/manual/en/function.phpinfo.php)查找加载的 php.ini 并对其进行编辑以隐藏错误。它会覆盖您在脚本中输入的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-06-10T08:34:37.190

`set_error_handler()`在脚本中的任何地方使用？这会覆盖`error_reporting(0)`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T23:33:46.567

使用*log_errors*来记录而不是显示它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T21:25:17.263

如果在 Apache 中使用*php_admin_value*指定设置，则无法在 .htaccess 或运行时更改。

请参阅：*[如何更改配置设置](http://docs.php.net/configuration.changes)*

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-12-07T15:50:45.263

> 务实地，不要写有语法错误的文件:)

为确保文件中没有语法错误，请运行以下命令：

```
php -l YOUR_FILE_HERE.php 
```

这将输出如下内容：

```
PHP Parse error:  syntax error, unexpected '}' in Connection.class.php on line 31 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-12-16T10:16:58.697

**只需在index.php**文件中添加以下代码：

```
ini_set('display_errors', False); 
```

# c# - Visual Studio 2008 上的远程处理设施

> ID：78303
> 
> 赞同：0
> 
> 时间：2008-09-16T23:22:26.657
> 
> 标签：c#, visual-studio, remoting

我正在玩我的第一个远程处理项目，我需要创建一个 RemotableType DLL。我知道我可以使用 csc 手动编译它，但我想知道 Visual Studio 上是否有一些设施来处理 Remoting 案例，或者更具体地说，告诉它应该将特定文件编译为 .dll 而无需必须将另一个项目添加到解决方案中，才能将一两个类编译成 DLL。

注意：我知道我应该玩弄我的第一个 WCF 项目，但这必须在 2.0 上运行。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-16T23:24:21.080

目前我不知道使用 VS 2008。

但是您可能想查看**[NAnt](http://nant.sourceforge.net/)**。它是为这种工作而设计的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T00:33:37.060

如果您不想直接弄乱 .proj 文件并添加构建事件，则只需在预构建事件上调用 csc.exe 即可逃脱。

# solaris - Solaris 上的硬盘驱动器设备名称

> ID：78336
> 
> 赞同：8
> 
> 时间：2008-09-16T23:28:43.100
> 
> 标签：solaris

我需要弄清楚solaris box的硬盘驱动器名称，我不清楚设备名称是什么。在 linux 上，它类似于`/dev/hda`or `/dev/sda`，但在 solaris 上，我对分区和设备名称有点迷失了。我认为像`/dev/rdsk/c0t0d0s0`分区这样的条目，如何引用整个硬盘驱动器？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-16T23:32:46.177

/dev/rdsk/c0t0d0s0 表示控制器 0，SCSI 目标 (ID) 0，s 表示 Slice（分区）0。

通常，按照惯例，s2 是整个磁盘。该分区与其他分区重叠。

prtvtoc /dev/rdsk/c0t0d0s0 将显示磁盘的分区表，以确保。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-12-19T22:55:40.117

如果您在非 SPARC 硬件上运行 Solaris 并且不使用 EFI，则整个硬盘驱动器不是`c0t0d0s2`但是`c0t0d0p0`，`s2`在这种情况下只是 Solaris 主分区。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-24T17:53:45.737

你想对整个磁盘做什么？查看相关命令的手册页的示例部分，以了解该命令需要多少磁盘名称。

zpool 不需要分区，如：c0t0d0 newfs 需要：c0t0d0s0 dd 将使用整个磁盘分区：c0t0d0s2

注意：s2 作为整个磁盘只是一个约定。root 用户可以使用 Solaris 格式命令并更改任何分区的范围。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T08:08:05.837

有关片 2 的注释仅适用于带有 SMI 标签的驱动器。

如果驱动器大于 1TB，或者驱动器已用于 ZFS，则驱动器将具有 EFI 标签，并且片 2 将不是整个磁盘。使用 EFI 标签，切片 2 “只是另一个切片”。然后，您可以使用不带分片的设备名称来引用整个磁盘，例如 c0t0d0。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-11-12T15:20:49.433

磁盘标签有两种，一种是SMI(vtoc)，一种是GPT(EFI)。

在 X86 平台上，磁盘带有 SMI 标签（默认行为）： cXtXdXp0 是整个物理磁盘 cXtXdXp1-cXtXdXp4 是主分区，包括 solaris 分区。

cXtXdXs0-cXtXdXs8 是激活的 Solaris 分区的分区（片）。cXtXdXs2 是整个激活的 Solaris 分区，可能不是整个磁盘。

希望我清楚。

/孟

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-10-16T05:30:14.643

C0 - 控制器 T0 - 目标 D0 - 磁盘 S- - 片

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-16T23:34:05.753

c0t0d0s0*是*整个驱动器。细分是：

/dev/[r]dsk/c **C** t **A** d0s **S**

...其中**C**是控制器编号，**A**是 SCSI 地址，**S**是“片”。切片 0 是整个磁盘；其他切片是分区号。

有关更多信息，请参阅[此](http://www.washington.edu/R870/DevicesDrivers.html)内容。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-09-17T04:12:24.837

cXtYdZs2 是整个驱动器。时期。

# c# - C# / dot-NET 的字体渲染库？

> ID：78351
> 
> 赞同：5
> 
> 时间：2008-09-16T23:31:13.373
> 
> 标签：c#, .net, text, fonts, gdi+

是否有任何免费的第三方库可用于在 dot-NET 应用程序中呈现任意缩放和旋转的文本？尽管原生 GDI+ 允许文本缩放和旋转，但其确定渲染文本尺寸的方法不够精确，并且在将文本添加到渲染字符串时的字距调整差异使其不适合在某些类型的软件中使用（例如，例如，图形编辑软件）。

要求：

*   本机 .NET 代码。
*   任意缩放和旋转文本。
*   精确的文本指标。
*   无论字符串长度如何，都保持一致的字距调整。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T23:34:24.380

[Windows Presentation Foundation 为排版](https://docs.microsoft.com/en-us/dotnet/framework/wpf/advanced/typography-in-wpf)提供了复杂的支持。

# java - 在 HP-UX 环境 JVM 中，C 堆与 Java 堆中运行的是什么？

> ID：78352
> 
> 赞同：2
> 
> 时间：2008-09-16T23:31:15.260
> 
> 标签：java, c, jvm, heap-memory, hp-ux

我在 HP-UX 环境中遇到了某些 Java 应用程序的特殊问题。

堆设置为 -mx512，但是，使用 gpm 查看此 java 进程的内存区域，它显示它使用了 1.6GB 的 RSS 内存，其中 1.1GB 分配给了 DATA 区域。在 24-48 小时内快速增长，然后大幅放缓，仍然每隔几个小时增长 2MB。但是，Java 堆没有泄漏的迹象。

好奇这是怎么可能的，我研究了一下，发现了这篇关于 java 堆和 c 堆内存泄漏的 HP 文章：http: [//docs.hp.com/en/JAVAPERFTUNE/Memory-Management.pdf](http://docs.hp.com/en/JAVAPERFTUNE/Memory-Management.pdf)

我的问题是什么决定了在 C 堆和 java 堆中运行的内容，对于不通过 java 堆运行的东西，您将如何识别在 C 堆上运行的那些对象？此外，Java 堆是否位于 C 堆内？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T00:22:02.673

考虑什么构成了 Java 进程。

你有：

*   JVM（一个 C 程序）
*   JNI 数据
*   Java字节码
*   Java 数据

值得注意的是，它们都存在于 C 堆中（JVM 堆自然是 C 堆的一部分）。

在 Java 堆中只是 Java 字节码和 Java 数据。但是 Java 堆中还有“空闲空间”。

典型的（即 Sun）JVM 只在必要时增加它的 Java Heap，但从不缩小它。一旦它达到其定义的最大值 (-Xmx512M)，它就会停止增长并处理剩下的任何东西。当最大堆用完时，您会收到 OutOfMemory 异常。

Xmx512M 选项不做的是限制进程的整体大小。它仅限制进程的 Java Heap 部分。

例如，您可能有一个人为的 Java 程序，它使用 10MB 的 Java 堆，但调用一个分配 500MB 的 C 堆的 JNI 调用。您可以看到您的进程大小如何，即使 Java 堆很小。此外，使用新的 NIO 库，您也可以将内存附加到堆外。

您必须考虑的另一个方面是 Java GC 通常是“复制收集器”。这意味着它从正在收集的内存中获取“实时”数据，并将其复制到内存的不同部分。复制到的这个空白空间不是堆的一部分，至少在 Xmx 参数方面不是。它就像“新堆”，在复制后成为堆的一部分（旧空间用于下一次 GC）。如果你有一个 512MB 的堆，它是 510MB，Java 将把实时数据复制到某个地方。天真的想法会是另一个大的开放空间（比如 500+MB）。如果你所有的数据都是“活的”，那么它需要一个像这样的大块来复制。

因此，您可以看到，在最极端的情况下，您需要至少双倍系统上的可用内存来处理特定的堆大小。512MB 堆至少需要 1GB。

事实证明，实际情况并非如此，内存分配等比这更复杂，但您确实需要大量空闲内存来处理堆副本，这会影响整个进程的大小。

最后，请注意 JVM 会做一些有趣的事情，例如将 rt.jar 类映射到 VM 以简化启动。它们映射在只读块中，并且可以在其他 Java 进程之间共享。这些共享页面将对所有 Java 进程“计数”，即使它实际上只消耗一次物理内存（虚拟内存的魔力）。

现在至于为什么您的进程继续增长，如果您从未遇到 Java OOM 消息，这意味着您的泄漏不在 Java 堆中，但这并不意味着它可能不在其他地方（JRE 运行时，a 3rd 方 JNI 库、本机 JDBC 驱动程序等）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T00:06:15.333

一般来说，只有 Java 对象中的数据存储在 Java 堆上，Java VM 所需的所有其他内存都是从“本机”或“C”堆中分配的（实际上，Java 堆本身只是分配的一个连续块来自 C 堆）。

由于 JVM 要求 Java 堆（或使用分代垃圾收集的堆）是一块连续的内存，因此通常在 JVM 启动时分配整个最大堆大小（-mx 值）。在实践中，Java VM 将尝试最小化其对该空间的使用，以便操作系统不需要为其保留任何实际内存（操作系统足够精明，可以知道何时从未写入过存储空间） .

因此，Java 堆会在内存中占据一定的空间。

剩余的存储空间将由 Java VM 和正在使用的任何 JNI 代码使用。例如，JVM 需要内存来存储来自已加载类的 Java 字节码和常量池、JIT 编译代码的结果、编译 JIT 代码的工作区、本机线程堆栈和其他此类杂项。

JNI 代码只是特定于平台的（编译的）C 代码，可以以“本机”方法的形式绑定到 Java 对象。当这个方法被执行时，绑定的代码被执行，并且可以使用标准的 C 例程（例如 malloc）分配内存，这将消耗 C 堆上的内存。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T23:55:23.080

我对您给出的数字的唯一猜测是 Java VM 中的内存泄漏。您可能想尝试他们在您提到的论文中列出的其他 VM 之一。另一种（更困难的）替代方法可能是在 HP 平台上编译 open java。

Sun 的 Java 还没有 100% 开放，他们正在努力，但我相信 sourceforge 中有一个。

顺便说一下，Java 也会破坏内存。有时它会稍微混淆操作系统内存管理（当 windows 内存不足并要求 Java 释放一些内存时，你会看到它，Java 会触及它的所有对象，导致它们从交换文件中加载，windows 痛苦地尖叫并死掉），但是我不认为这就是你所看到的。

# security - 在 Vista 中使用保护模式进行战斗

> ID：78380
> 
> 赞同：0
> 
> 时间：2008-09-16T23:35:15.517
> 
> 标签：security, windows-vista, activex, protected, mode

我们的应用程序通常使用 ActiveX 控件在 IE（XP 和更早版本）上下载和安装我们的客户端，但是随着我们的用户群转向更多启用“保护模式”的 Vista 框，我们需要进行调查。

那么接下来，尝试使用保护模式 API 是否值得头疼？这是否会导致大量对话框和管理员权限来执行我们的应用程序需要做的事情（写入一些本地文件位置，访问其他一些应用程序等）？

我一心只想添加一个非基于浏览器的安装程序应用程序，如果需要，它将完成下载和安装客户端的繁琐工作......这只需要安装一次，在大型公司结构中它可能是被 IT 淘汰了。

我还缺少其他一些想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T23:41:48.870

这个客户端，它是一个桌面应用程序，而不是在浏览器中运行的一些软件吗？在这种情况下，请提供一个常规的下载安装程序应用程序。我对浏览器托管安装程序的个人经验是，它们只是令人困惑，而且我所见过的少数安装程序似乎在某些方面编码不佳。

如果您使用基于 MSI 的安装程序，我相信很多 Windows 域管理员也会喜欢您，因为 Microsoft 有工具可以将基于 MSI 的安装远程部署到大量机器上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T23:41:37.873

你检查过微软的[ClickOnce 部署](http://msdn.microsoft.com/en-us/library/t71a733d(VS.80).aspx)吗？

如果我没记错的话，您可以嵌入一个清单，这将有助于自动处理受保护的模式，从而为您省去 API 的麻烦。

我相信 ClickOnce 适用于您的 ActiveX 安装程序的设计目的。

既然您说您的 IT 部门可以将其推出，我认为您也可以使用这种技术。

即使您可能没有在 .NET CLR 上编写应用程序，也可以使用 Visual Studio 为您生成这些清单和安装程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T23:42:11.100

做这件事比再拖延要好得多。Vista 是微软的一种说法，他们不会让人们不再忽视安全问题并鼓励人们更新他们的代码。

我相信这里的其他用户将能够向您指出一些有关编写 ActiveX 控件的 MSDN 最佳实践。

# tdd - RhinoMocks：模拟属性获取器的正确方法

> ID：78389
> 
> 赞同：12
> 
> 时间：2008-09-16T23:37:01.800
> 
> 标签：tdd, rhino-mocks

我是 RhinoMocks 的新手，除了在幕后发生的事情之外，我还试图掌握语法。

我有一个用户对象，我们称它为 User，它有一个名为 IsAdministrator 的属性。IsAdministrator 的值通过另一个检查用户安全权限的类进行评估，并根据这些权限返回真或假。我试图模拟这个 User 类，并伪造 IsAdministrator 的返回值以隔离一些单元测试。

到目前为止，这就是我正在做的事情：

```
public void CreateSomethingIfUserHasAdminPermissions()
{
    User user = _mocks.StrictMock<User>();
    SetupResult.For(user.IsAdministrator).Return(true);

    // do something with my User object
} 
```

现在，我期待 Rhino 会“伪造”对属性 getter 的调用，然后对我返回 true。这是不正确的吗？目前，由于 IsAdministrator 属性中的依赖关系，我遇到了异常。

有人可以解释我如何在这里实现我的目标吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-17T03:41:00.480

在我开始之前先做一个简短的说明。通常，您希望避免使用“严格”模拟，因为它会导致脆弱的测试。如果发生任何您没有明确告诉 Rhino 会发生的事情，严格的模拟将抛出异常。此外，我认为您在调用创建模拟时可能会误解 Rhino 正在做什么。将其视为一个自定义对象，该对象要么派生自，要么实现了您定义的 System.Type。如果你自己做，它看起来像这样：

```
public class FakeUserType: User
{
    //overriding code here
} 
```

由于 IsAdministrator 可能只是 User 类型的公共属性，因此您不能在继承类型中覆盖它。

就您的问题而言，您可以通过多种方式处理此问题。您可以将 IsAdministrator 实现为您的用户类上的虚拟属性，如下所述的[aaronjensen ：](https://stackoverflow.com/questions/78389/rhinomocks-correct-way-to-mock-property-getter#78428)

```
public class User
{
    public virtual Boolean IsAdministrator { get; set; }
} 
```

这是一个不错的方法，但前提是您计划从您的 User 类继承。此外，如果您不想伪造此类上的其他成员，他们也必须是虚拟的，这可能不是所需的行为。

实现此目的的另一种方法是使用接口。如果它确实是您想要模拟的 User 类，那么我会从中提取一个接口。你上面的例子看起来像这样：

```
public interface IUser
{
    Boolean IsAdministrator { get; }
}

public class User : IUser
{
    private UserSecurity _userSecurity = new UserSecurity();

    public Boolean IsAdministrator
    {
        get { return _userSecurity.HasAccess("AdminPermissions"); }
    }
}

public void CreateSomethingIfUserHasAdminPermissions()
{
    IUser user = _mocks.StrictMock<IUser>();
    SetupResult.For(user.IsAdministrator).Return(true);

    // do something with my User object
} 
```

如果你愿意，你可以通过使用[依赖注入和 IOC](http://martinfowler.com/articles/injection.html)来获得更好的体验，但基本原理是相同的。通常，您希望您的类依赖于接口而不是具体的实现。

我希望这有帮助。我在一个主要项目中使用 RhinoMocks 已经有很长时间了，所以请不要犹豫，向我询问有关 TDD 和 mocking 的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T23:46:38.297

确保 IsAdministrator 是虚拟的。

另外，请确保您致电 _mocks.ReplayAll()

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-08T08:52:24.493

_mocks.ReplayAll() 什么都不做。只是因为您使用了不计数的 SetupResult.For()。使用 Expect.Call() 来确保你的代码做的一切都是正确的。

# php - 如何在 Acer Aspire One 中安装 php-gtk？

> ID：78392
> 
> 赞同：0
> 
> 时间：2008-09-16T23:38:21.500
> 
> 标签：php, fedora, php-gtk

我有一个在 Ubuntu、Windows 和 Asus EeePC 附带的 Xandros 中运行良好的应用程序。

现在我们正在转向[Acer Aspire One](http://en.wikipedia.org/wiki/Aspire_One)，但我在制作 php-gtk 以在它附带的类似 Fedora（Linpus Linux Lite）的 Linux 下编译时遇到了很多麻烦。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-10-27T08:14:51.587

我设法在 Fedora 上安装了 Phoronix 测试套件所需的所有组件，但仍有一个问题。

```
# phoronix-test-suite gui
shell-init: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory
pwd: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory
pwd: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory
/usr/bin/phoronix-test-suite: line 28: [: /usr/share/phoronix-test-suite: unary operator expected 
```

您需要两个不在 Fedora 中的软件包，php-gtk，但 php-gtk 也有它的依赖项 - pecl-cairo

php-gtk 需要从 svn 下载，因为 tar.gz 版本太旧了，不能与 php 5.3 一起使用

这是我构建所有组件的方法。

```
su -c "yum install php-cli php-devel make gcc gtk2-devel svn"

svn co http://svn.php.net/repository/pecl/cairo/trunk pecl-cairo
cd pecl-cairo/
phpize
./configure
make
su -c "make install"

cd ..

svn co http://svn.php.net/repository/gtk/php-gtk/trunk php-gtk
cd php-gtk
./buildconf
./configure
make
su -c "make install"

cd ..

wget http://www.phoronix-test-suite.com/download.php?file=phoronix-test-suite-2.8.1
tar xvzf phoronix-test-suite-2.8.1.tar.gz
cd phoronix-test-suite
su -c "./install-sh" 
```

所以请到我离开的地方让 Phoronix 测试套件在 Fedora 上运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T02:39:18.693

嗨，伙计们，我终于让这个东西工作了，基本的工作流程是这样的：

```
#!/bin/bash
sudo yum install yum-utils
#We don't want to update the main gtk2 by mistake so we download them
#manually and install with no-deps[1](and forced because gtk version
#version of AA1 and the gtk2-devel aren't compatible).
sudo yumdownloader --disablerepo=updates gtk2-devel glib2-devel
sudo rpm --force --nodeps -i gtk2*rpm glib2*rpm

#We install the rest of the libraries needed.
sudo yum --disablerepo=updates install atk-devel pango-devel libglade2-devel
sudo yum install php-cli php-devel make gcc

#We Download and compile php-gtk
wget http://gtk.php.net/do_download.php?download_file=php-gtk-2.0.1.tar.gz
tar -xvzf php-gtk-2.0.1.tar.gz
cd php-gtk-2.0.1
./buildconf
./configure
make
sudo make install 
```

如果您想添加更多库，如 gtk-extra，请`./configure -help`在创建之前输入以查看可用的不同选项。

安装后你需要添加`php_gtk2.so`到*动态扩展*`/etc/php.ini`

```
extension=php_gtk2.so 
```

资料来源：

[1]：[Acer Aspire One Linux 上的依赖问题](http://macles.blogspot.com/2008/08/dependency-problems-on-acer-aspire-one.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T21:44:14.853

如果您可以给我们更多的帮助，而不仅仅是编译它；我们可能能够更好地帮助您解决您的问题。

# networking - 一台计算机可以支持多少个网络连接？

> ID：78422
> 
> 赞同：8
> 
> 时间：2008-09-16T23:45:38.627
> 
> 标签：networking, network-programming

在编写自定义服务器时，确定在任何给定时间可以连接到服务器的最大用户数的最佳实践或技术是什么？

我认为计算机硬件、网络容量和服务器协议的能力都是重要因素。

另外，您认为将网络连接数限制为某个最大用户数是否是一种好习惯？还是服务器不应该限制网络连接的数量，让性能下降，直到响应时间非常长？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-17T00:13:13.383

Dan Kegel 汇总了处理来自单个服务器的大量网络连接的技术摘要，此处：[http ://www.kegel.com/c10k.html](http://www.kegel.com/c10k.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-16T23:48:59.523

一般来说，现代服务器可以处理非常大量的并发连接。我曾在拥有超过 8,000 个同时打开的 TCP/IP 套接字的系统上工作过。

您将需要一个高质量的服务界面来处理这种负载，请查看[libevent](http://monkey.org/~provos/libevent/)或[libev](http://software.schmorp.de/pkg/libev.html)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-16T23:55:04.393

这是一个很好的问题，而且绝对是情境性的。你的电脑是什么？您是否有一台配备四核 Xeon、128 GB RAM 和光纤通道连接的 4 插槽机器（例如我们刚刚购买的一对戴尔 R900）？或者您是在具有 256 MB RAM 和 56K 调制解调器的 p3 550 上运行吗？每个连接在您的服务器上放置多少负载？什么样的回应是可以接受的？

这些是您需要回答的问题。我想找到答案的最好方法是通过负载测试。创建您的代码将对您的服务器执行的预期（可能还有一些意外）路径的单元测试。找到一个负载测试框架，让您可以模拟 10、100、1000、10000 个用户同时执行这些任务。

这将告诉您您的计算机可以支持多少个连接。

负载/单元测试场景的好处在于，您可以在单元测试中加入响应时间预期并增加负载，直到超出响应时间。如果您需要以 Y 秒响应支持 X 数量的用户，您将能够通过负载测试来证明它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T23:52:40.513

高并发连接的最大挫折之一实际上是所涉及的路由器。面向家庭用户的路由器通常有一个小的 NAT 表，阻止路由器实际为服务器提供连接服务。

一定要研究你的路由器/网络基础设施设置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T23:54:22.927

我认为您不应该限制服务器允许的连接数量 - 只需捕获并正确处理接受和关闭连接时可能发生的任何异常，您应该没问题。您应该将这种较低级别的编程留给底层操作系统层 - 这样您就可以更轻松地移植服务器等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T23:54:42.740

这实际上取决于您的操作系统。

不同的 Unix 风格将支持“无限”数量的文件句柄/套接字，其他的具有高值，如 32768。

典型的用户限制是 8192，但通常可以设置得更高。

我认为 windows 的限制更多，但服务器版本可能有更高的限制。

# iphone - 使用自定义框架

> ID：78423
> 
> 赞同：3
> 
> 时间：2008-09-16T23:45:40.313
> 
> 标签：iphone, xcode, macos, cocoa

我得到的错误：

```
in /Users/robert/Documents/funWithFrameworks/build/Debug-iphonesimulator/funWithFrameworks.framework/funWithFrameworks, can't link with a main executable 
```

悬崖笔记：

*   试图包括框架
*   不想链接

更多细节：我正在为*移动设备开发...提示，*使用 Xcode 提示，我正在尝试制作我自己的自定义框架，我可以从另一个应用程序中包含它。到目前为止，我已经完成了以下工作：

1.  创建一个新项目；一个基于 iPhone OS 窗口的应用程序。
2.  转到目标信息-> 在包装下，将包装器扩展从应用程序更改为框架
3.  转到操作-> 新构建阶段-> 复制标题。将标题的角色更改为“公共”
4.  从我的应用程序中，我将框架添加到框架组。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T10:04:35.753

苹果明确表示**不能**在他们的手机上使用动态库。私有框架就是这样。

但是，您可以使用静态库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T22:11:33.410

Egil，这通常被认为是 iPhone 开发者协议第 3.3.2 节的含义之一，该协议（部分）禁止插件架构或其他框架。他们没有为与 iPhone 兼容的框架提供 Xcode 项目模板这一事实往往会强化这个想法，尽管这当然可能只是一个疏忽或他们在没有实际禁止的情况下不鼓励的事情。

这是否是该部分的预期含义，您必须向 Apple 询问，并可能咨询律师，但这就是经常提到的“无框架”想法的来源。

对于那些想要在 iPhone 应用程序中使用框架代码的人来说，另一种方法是使用框架代码来构建静态库。然后将其编译到应用程序中，而不是在运行时动态加载。它是应用程序可执行文件的一部分这一事实避免了对这部分协议的任何潜在担忧。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-21T03:58:42.990

虽然不允许使用动态库，但您可以创建一个框架（使用静态库和 lipo）。

查看：[http ://accu.org/index.php/journals/1594](http://accu.org/index.php/journals/1594)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T01:54:37.240

我还没有为所谓的*移动设备*尝试过它，但我猜它与常规 Cocoa 应用程序的方法非常相似。看看这个教程：

[嵌入式 Cocoa 框架](http://rentzsch.com/cocoa/embeddedFrameworks)

# python - 将命令重定向到 Python 中另一个的输入

> ID：78431
> 
> 赞同：7
> 
> 时间：2008-09-16T23:46:47.673
> 
> 标签：python, bash, redirect, diff, vimdiff

我想在python中复制它：

```
gvimdiff <(hg cat file.txt) file.txt 
```

（hg cat file.txt 输出最近提交的 file.txt 版本）

我知道如何将文件传输到 gvimdiff，但它不会接受另一个文件：

```
$ hg cat file.txt | gvimdiff file.txt -
Too many edit arguments: "-" 
```

进入python部分......

```
# hgdiff.py
import subprocess
import sys
file = sys.argv[1]
subprocess.call(["gvimdiff", "<(hg cat %s)" % file, file]) 
```

当 subprocess 被调用时，它只是`<(hg cat file)`作为`gvimdiff`文件名传递。

那么，有没有办法像 bash 那样重定向命令？为简单起见，只需 cat 一个文件并将其重定向到 diff：

```
diff <(cat file.txt) file.txt 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-16T23:57:32.093

可以办到。然而，从 Python 2.5 开始，这种机制是特定于 Linux 的，并且不可移植：

```
import subprocess
import sys

file = sys.argv[1]
p1 = subprocess.Popen(['hg', 'cat', file], stdout=subprocess.PIPE)
p2 = subprocess.Popen([
    'gvimdiff',
    '/proc/self/fd/%s' % p1.stdout.fileno(),
    file])
p2.wait() 
```

也就是说，在 diff 的特定情况下，您可以简单地从标准输入中获取文件之一，而无需使用相关的 bash 类似功能：

```
file = sys.argv[1]
p1 = subprocess.Popen(['hg', 'cat', file], stdout=subprocess.PIPE)
p2 = subprocess.Popen(['diff', '-', file], stdin=p1.stdout)
diff_text = p2.communicate()[0] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T23:53:40.170

还有命令模块：

```
import commands

status, output = commands.getstatusoutput("gvimdiff <(hg cat file.txt) file.txt") 
```

如果您想在命令运行时实际从命令中获取数据，那么还有一组 popen 函数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T01:26:43.597

这实际上是[文档](https://docs.python.org/2.4/lib/node242.html)中的一个示例：

```
p1 = Popen(["dmesg"], stdout=PIPE)
p2 = Popen(["grep", "hda"], stdin=p1.stdout, stdout=PIPE)
output = p2.communicate()[0] 
```

这对你来说意味着：

```
import subprocess
import sys

file = sys.argv[1]
p1 = Popen(["hg", "cat", file], stdout=PIPE)
p2 = Popen(["gvimdiff", "file.txt"], stdin=p1.stdout, stdout=PIPE)
output = p2.communicate()[0] 
```

这消除了 linux 特定 /proc/self/fd 位的使用，使其可能在其他 unices 上工作，如 Solaris 和 BSD（包括 MacOS），甚至可能在 Windows 上工作。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-16T23:57:24.840

我突然意识到您可能正在寻找其中一个 popen 功能。

来自：[http ://docs.python.org/lib/module-popen2.html](http://docs.python.org/lib/module-popen2.html)

popen3(cmd[, bufsize[, mode]]) 将 cmd 作为子进程执行。返回文件对象（child_stdout、child_stdin、child_stderr）。

合十礼，马克

# php - 如何从 PHP5 中的用户输入创建 DOM？

> ID：78447
> 
> 赞同：0
> 
> 时间：2008-09-16T23:51:30.627
> 
> 标签：php, dom, web-applications

如何从 PHP5 中的用户输入创建 DOM？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T23:54:22.880

我将使用自 5 以来一直是核心一部分的 DOM API。对于 XML 字符串 $xml，您可以构建一个 DOM 对象

```
$dom = new DOMDocument();
$dom->loadXML($xml); 
```

[使用在http://uk.php.net/DOM](http://uk.php.net/DOM)中定义的 DOM API 的其余部分对其进行操作

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T21:56:47.047

如果输入是 HTML，请使用 loadHTML 方法。请注意，输入必须是有效代码，因此您可能希望首先通过[html tidy](http://docs.php.net/manual/en/book.tidy.php)进行管道传输。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T03:29:26.553

当您需要将其注入到其他 DOM（例如您的 HTML 页面）中时，您可以使用 $dom->saveXML() 方法再次将其导出。然而，问题在于它还导出了一个 xml 标头（对于 saveHTML 版本来说更糟）。要摆脱这种情况，请使用：

```
$xml = $dom->saveXML();
$xml = substr( $xml, strlen( "<?xml version=\"1.0\"?>" ) ); 
```

# python - Python ReportLab 使用 splitfirst/splitlast

> ID：78450
> 
> 赞同：7
> 
> 时间：2008-09-16T23:52:04.697
> 
> 标签：python, reportlab

我正在尝试将 Python 与 ReportLab 2.2 一起使用来创建 PDF 报告。
根据[用户指南](http://www.reportlab.com/docs/userguide.pdf)，

> 特殊 TableStyle Indeces [原文如此]
> 
> 在任何样式命令中，第一行索引可以设置为特殊字符串 'splitlast' 或 'splitfirst' 之一，以指示该样式应仅用于拆分表的最后一行或延续的第一行。这允许在拆分周围具有更好效果的拆分表。

我尝试过使用几种样式元素，包括：

```
('TEXTCOLOR', (0, 'splitfirst'), (1, 'splitfirst'), colors.black) 
('TEXTCOLOR', (0, 'splitfirst'), (1, 0), colors.black) 
('TEXTCOLOR', (0, 'splitfirst'), (1, -1), colors.black) 
```

这些似乎都不起作用。第一个生成带有消息的 TypeError：

```
TypeError: cannot concatenate 'str' and 'int' objects 
```

后两者生成带有消息的 TypeErrors：

```
TypeError: an integer is required 
```

这个功能是简单地坏了还是我做错了什么？如果是后者，我做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T17:46:36.087

好吧，看来我要回答我自己的问题了。

首先，文档完全位于它读取“在任何样式命令中，第一行索引可以设置为特殊字符串之一'splitlast'或'splitfirst'以指示该样式应仅用于a的最后一行拆分表，或延续的第一行。” 在当前版本中，“splitlast”和“splitfirst”行索引与前面提到的 TEXTCOLOR 和 BACKGROUND 命令上的 TypeErrors 中断。

根据阅读源代码，我的怀疑是，目前只有 tablestyle 行命令（GRID、BOX、LINEABOVE 和 LINEBELOW）与“splitfirst”和“splitlast”行索引兼容。我怀疑所有单元格命令都因上述 TypeErrors 而中断。

但是，我可以通过继承 Table 类并覆盖 onSplit 方法来做我想做的事。这是我的代码：

```
class XTable(Table):
    def onSplit(self, T, byRow=1):
        T.setStyle(TableStyle([
          ('TEXTCOLOR', (0, 1), (1, 1), colors.black)])) 
```

这样做是将文本颜色黑色应用于每页第二行的第一个和第二个单元格。（第一行是表头，由 Table 的 repeatRows 参数重复。）更准确地说，它对每个框架的第一个和第二个单元格执行此操作，但由于我使用的是 SimpleDocTemplate，因此框架和页面是相同的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-12T16:52:07.013

这似乎是 ReportLab Table 类中的一个错误。除了[DLJessup 自己的答案](https://stackoverflow.com/a/94869/669202)之外，另一个解决方法是修改导致错误的 ReportLab 代码，在`Table._drawBkgrnd()`1301 行附近。对于“splitlast”，更改：

```
y0 = rowpositions[sr] 
```

至：

```
if sr == 'splitlast':
    y0 = rowpositions[-2] # last value is 0\.  Second last is the one we want.
else:
   y0 = rowpositions[sr] 
```

这很容易在您自己的代码中完成，而无需通过子类化 Table 并覆盖此方法来破解 ReportLab。我不需要使用“splitfirst”；如果我这样做，我会在这里发布其余的黑客攻击。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T00:40:54.080

> [...] 在任何样式命令**中，第一行索引**可以设置为一个特殊字符串 [...]

在您的第一个示例中，您还将*第二*行索引设置为特殊字符串。

不知道为什么其他两个不起作用...您确定这是异常的来源吗？

# project-planning - 如何使用功能点估计任务？

> ID：78453
> 
> 赞同：4
> 
> 时间：2008-09-16T23:52:15.663
> 
> 标签：project-planning, estimation

使用功能点进行估计的步骤是什么？

那里有某种快速参考指南吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T23:59:59.327

几年前我参加了一个关于功能点分析的会议。它也有很多。您可以在线查看[免费功能点培训手册](http://www.softwaremetrics.com/freemanual.htm)，[功能点基础知识](http://www.softwaremetrics.com/fpafund.html)，或者我怀疑您可以在计算机商店购买一本书。

您还可以查看[国际功能点用户组](http://www.ifpug.org/)，看看他们是否有一些资源或本地会议适合您。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T23:17:01.030

你真的需要接受一些培训。与 IFPUG 核对。如果自学成才，你会在不知不觉中养成一些破坏性的坏习惯。让经验丰富的 FP 分析师审查您的一些早期尝试也很有帮助。

在你“明白”之前，这种事情看起来非常复杂，然后很快就可以做到。它也大大改善了我的需求分析。我在数数时经常发现矛盾和差距。

它也不限于 BDUF 瀑布项目。在签订敏捷方法项目时，我花了三年时间使用 FP 和 Planning Poker 作为相互交叉检查。

我从 2002 年到 2005 年获得了 IFPUG 认证，并且仍在使用 FP 分析。我已经看到它被滥用了很多次，我认为这就是它名声如此糟糕的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-12-24T09:02:48.167

我建议你看看 COSMIC 功能点。 [https://cosmic-sizing.org](https://cosmic-sizing.org)。COSMIC 功能点也是衡量软件大小的 ISO 标准。它们是对 IFPUG 的进化改进。

您可以通过计算条目、退出、读取和写入来快速估计大小。

与IFPUG手册相比，学习COSMIC要容易得多，下面的免费书就够了，一天就能看完。

推荐阅读：[https ://cosmic-sizing.org/publications/measurement-guide/](https://cosmic-sizing.org/publications/measurement-guide/)

# join - Linq to Entity 具有多个左外连接

> ID：78468
> 
> 赞同：20
> 
> 时间：2008-09-16T23:54:57.933
> 
> 标签：join, linq-to-entities, outer-join

我试图了解 LINQ to Entity 中的左外连接。例如，我有以下 3 个表：

公司、公司产品、产品

CompanyProduct 链接到其两个父表 Company 和 Product。

无论给定产品的 CompanyProduct 是否存在，我都想返回所有 Company 记录和关联的 CompanyProduct。在 Transact SQL 中，我将使用左外连接从 Company 表中走出来，如下所示：

```
SELECT * FROM Company AS C
LEFT OUTER JOIN  CompanyProduct AS CP ON C.CompanyID=CP.CompanyID
LEFT OUTER JOIN  Product AS P ON CP.ProductID=P.ProductID 
WHERE      P.ProductID = 14 OR P.ProductID IS NULL 
```

我的数据库有 3 家公司，2 条 CompanyProduct 记录与 ProductID 14 相关联。因此，SQL 查询的结果是预期的 3 行，其中 2 行连接到 CompanyProduct 和 Product，1 行仅包含 Company 表和空值在 CompanyProduct 和 Product 表中。

那么如何在 LINQ to Entity 中编写相同类型的连接来获得类似的结果呢？

我尝试了一些不同的方法，但无法正确使用语法。

谢谢。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-06T18:39:27.007

解决了！

**最终输出：**

```
theCompany.id: 1  
theProduct.id: 14  
theCompany.id: 2  
theProduct.id: 14  
theCompany.id: 3 
```

* * *

**这是场景**

**1 - 数据库**

```
--Company Table
CREATE TABLE [theCompany](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [value] [nvarchar](50) NULL,
 CONSTRAINT [PK_theCompany] PRIMARY KEY CLUSTERED 
( [id] ASC ) WITH (
    PAD_INDEX  = OFF, 
    STATISTICS_NORECOMPUTE  = OFF, 
    IGNORE_DUP_KEY = OFF, 
    ALLOW_ROW_LOCKS  = ON, 
    ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY];
GO

--Products Table
CREATE TABLE [theProduct](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [value] [nvarchar](50) NULL,
 CONSTRAINT [PK_theProduct] PRIMARY KEY CLUSTERED 
( [id] ASC
) WITH (    
    PAD_INDEX  = OFF, 
    STATISTICS_NORECOMPUTE  = OFF, 
    IGNORE_DUP_KEY = OFF, 
    ALLOW_ROW_LOCKS  = ON, 
    ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY];
GO

--CompanyProduct Table
CREATE TABLE [dbo].[CompanyProduct](
    [fk_company] [int] NOT NULL,
    [fk_product] [int] NOT NULL
) ON [PRIMARY];    
GO

ALTER TABLE [CompanyProduct]  WITH CHECK ADD CONSTRAINT
    [FK_CompanyProduct_theCompany] FOREIGN KEY([fk_company]) 
    REFERENCES [theCompany] ([id]);
GO

ALTER TABLE [dbo].[CompanyProduct] CHECK CONSTRAINT 
    [FK_CompanyProduct_theCompany];
GO

ALTER TABLE [CompanyProduct]  WITH CHECK ADD CONSTRAINT 
    [FK_CompanyProduct_theProduct] FOREIGN KEY([fk_product]) 
 REFERENCES [dbo].[theProduct] ([id]);
GO

ALTER TABLE [dbo].[CompanyProduct] CHECK CONSTRAINT 
    [FK_CompanyProduct_theProduct]; 
```

**2 - 数据**

```
SELECT [id] ,[value] FROM theCompany
id          value
----------- --------------------------------------------------
1           company1
2           company2
3           company3

SELECT [id] ,[value]  FROM theProduct
id          value
----------- --------------------------------------------------
14          Product 1

SELECT [fk_company],[fk_product] FROM CompanyProduct;
fk_company  fk_product
----------- -----------
1           14
2           14 
```

**3 - VS.NET 2008 中的实体**

[alt text http://i478.photobucket.com/albums/rr148/KyleLanser/companyproduct.png](http://i478.photobucket.com/albums/rr148/KyleLanser/companyproduct.png)
实体容器名称是“testEntities”（如模型属性窗口中所示）

**4 - 代码（终于！）**

```
testEntities entity = new testEntities();

var theResultSet = from c in entity.theCompany
select new { company_id = c.id, product_id = c.theProduct.Select(e=>e) };

foreach(var oneCompany in theResultSet)
{
   Debug.WriteLine("theCompany.id: " + oneCompany.company_id);
    foreach(var allProducts in oneCompany.product_id)
    {
        Debug.WriteLine("theProduct.id: " + allProducts.id);
    }
} 
```

**5 - 最终输出**

```
theCompany.id: 1  
theProduct.id: 14  
theCompany.id: 2  
theProduct.id: 14  
theCompany.id: 3 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-03-18T12:05:15.020

它应该是这样的......

```
var query = from t1 in db.table1
    join t2 in db.table2
    on t1.Field1 equals t2.field1 into T1andT2
    from t2Join in T1andT2.DefaultIfEmpty()

    join t3 in db.table3
    on t2Join.Field2 equals t3.Field3 into T2andT3
    from t3Join in T2andT3.DefaultIfEmpty()
    where t1.someField = "Some value" 
    select 
    {
        t2Join.FieldXXX
        t3Join.FieldYYY

    }; 
```

我就是这样做的......

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-10-02T20:30:47.640

您将希望使用实体框架来设置从公司到产品的多对多映射。这将使用 CompanyProduct 表，但无需在实体模型中设置 CompanyProduct 实体。完成后，查询将非常简单，这将取决于个人偏好以及您希望如何表示数据。例如，如果您只想要拥有给定产品的所有公司，您可以说：

```
var query = from p in Database.ProductSet
            where p.ProductId == 14
            from c in p.Companies
            select c; 
```

或者

```
var query = Database.CompanySet
            .Where(c => c.Products.Any(p => p.ProductId == 14)); 
```

您的 SQL 查询将返回产品信息以及公司。如果这就是你想要的，你可以尝试：

```
var query = from p in Database.ProductSet
            where p.ProductId == 14
            select new
            {
                Product = p,
                Companies = p.Companies
            }; 
```

如果您想提供更多信息，而不是创建另一个答案，请使用“添加评论”按钮。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-29T18:18:57.567

LEFT OUTER JOIN 是通过使用实体框架中的 GroupJoin 完成的：

[http://msdn.microsoft.com/en-us/library/bb896266.aspx](http://msdn.microsoft.com/en-us/library/bb896266.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-20T09:29:06.440

普通组连接表示左外连接。尝试这个：

```
var list = from a in _datasource.table1
           join b in _datasource.table2
           on a.id equals b.table1.id
           into ab
           where ab.Count()==0
           select new { table1 = a, 
                        table2Count = ab.Count() }; 
```

该示例为您提供了`table1`没有引用的所有记录`table2`。如果省略该`where`句子，您将获得 的所有记录`table1`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-06T18:08:37.693

这个呢（在实体设计器中，公司和产品之间确实存在多对多关系，不是吗？）：

```
from s in db.Employees
where s.Product == null || s.Product.ProductID == 14
select s; 
```

实体框架应该能够确定要使用的连接类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T00:43:38.847

请尝试这样的事情：

```
from s in db.Employees
join e in db.Employees on s.ReportsTo equals e.EmployeeId
join er in EmployeeRoles on s.EmployeeId equals er.EmployeeId
join r in Roles on er.RoleId equals r.RoleId
where e.EmployeeId == employeeId &&
er.Status == (int)DocumentStatus.Draft
select s; 
```

干杯!

# sql-server - 上次修改日期对象

> ID：78471
> 
> 赞同：7
> 
> 时间：2008-09-16T23:55:18.027
> 
> 标签：sql-server, sql-server-2000

如何找出 MS SQL Server 2000 对象的最后修改日期？

我需要获取自 8 月 15 日以来修改的所有视图、过程、函数等的列表。在 sysObjects 中，我可以看到创建对象的日期，但我需要知道它们最后一次更改的时间。

注意：这是一个 SQL 2000 数据库。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-02-26T16:12:00.063

**我知道这有点旧，但是可以使用以下查询查看存储过程和函数**的最后更改日期：

```
USE [Your_DB]    
SELECT * FROM INFORMATION_SCHEMA.ROUTINES 
```

只是觉得很高兴提及这一点，因为我搜索了这个解决方案并且这个线程具有误导性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-17T00:21:16.327

请注意，SQL Server 实际上并不**记录**最后修改日期。它不存在于任何系统表中。

Schema Changes History 报告实际上是从[Default Trace](http://msdn.microsoft.com/en-us/library/ms191006.aspx)构建的。由于许多管理员（和网络主机）将其关闭，它可能不适合您。Buck Woody 很好地解释了这份报告是如何运作[的](http://blogs.msdn.com/buckwoody/archive/2007/10/12/sql-server-management-studio-standard-reports-schema-changes-history.aspx)。数据也是临时的。

出于这个原因，您永远不应该依赖 Schema Changes History 报告。备择方案：

*   使用[DDL 触发器](http://msdn.microsoft.com/en-us/library/ms186406.aspx)将所有模式修改记录到您选择的表中。
*   执行一个协议，其中视图和过程永远不会改变，它们只会被删除和重新创建。这意味着创建日期也将是最后更新日期（这显然不适用于表格）。
*   在源代码控制中谨慎地对 SQL 对象和架构进行版本控制。

--

编辑：看到这是 SQL 2000。排除了默认跟踪和 DDL 触发器。您只剩下我上面列出的更乏味的选项之一。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-03-18T07:09:39.643

我已通过以下查询获得修改日期的上述任何程序历史记录的确认答案

步骤 -1 在 DB 上执行该过程

```
SELECT name, create_date, modify_date 
FROM sys.objects
WHERE type = 'p' 
```

步骤-2然后将文本复制到带有标题的Excel

选择路由列，然后将确切的程序名称粘贴到 ^F 窗口中，然后按回车键，您将获得准确的修改日期。

问候， 苏迪尔浦那

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-06-08T17:30:54.520

这并不总是正确的，因为 modify_date 是对象上次使用 ALTER 语句修改的日期。**如果对象是表或视图，则 modify_date 也会在创建或更改表或视图上的聚集索引时更改。**

# c - 确定字符串是 ANSI C 中的整数还是浮点数

> ID：78474
> 
> 赞同：9
> 
> 时间：2008-09-16T23:55:42.190
> 
> 标签：c, floating-point, numbers

仅使用 ANSI C，确定 C 样式字符串是整数还是实数（即浮点数/双精度数）的最佳方法是什么？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-17T00:11:24.243

不要使用 atoi 和 atof，因为这些函数在失败时返回 0。上次我检查 0 是一个有效的整数和浮点数，因此没有用于确定类型。

使用 strto{l,ul,ull,ll,d} 函数，因为这些函数在失败时设置 errno，并且还报告转换数据的结束位置。

strtoul：[http ://www.opengroup.org/onlinepubs/007908799/xsh/strtoul.html](http://www.opengroup.org/onlinepubs/007908799/xsh/strtoul.html)

此示例假定字符串包含要转换的单个值。

```
#include <errno.h>

char* to_convert = "some string";
char* p = to_convert;
errno = 0;
unsigned long val = strtoul(to_convert, &p, 10);
if (errno != 0)
    // conversion failed (EINVAL, ERANGE)
if (to_convert == p)
    // conversion failed (no characters consumed)
if (*p != 0)
    // conversion failed (trailing data) 
```

感谢 Jonathan Leffler 指出我忘了先将 errno 设置为 0。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-17T00:13:22.960

使用[sscanf](http://www.cplusplus.com/reference/clibrary/cstdio/sscanf.html)，您可以确定字符串是 float 还是 int 或其他类型，而无需特殊情况 0，就像 atoi 和 atof 解决方案一样。

这是一些示例代码：

```
int i;
float f;
if(sscanf(str, "%d", &i) != 0) //It's an int.
  ...
if(sscanf(str "%f", &f) != 0)  //It's a float.
  ... 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T23:58:35.117

如果不能， atoi 和 atof 将转换或返回 0。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-17T07:14:26.117

我同意 Patrick_O 的观点，即 strto{l,ul,ull,ll,d} 函数是最好的方法。不过有几点需要注意。

1.  在调用函数之前将 errno 设置为零；没有任何功能可以为您做到这一点。
2.  链接到的 Open Group 页面（我在注意到 Patrick 也链接到它之前访问过）指出 errno 可能未设置。如果值超出范围，则设置为 ERANGE；如果参数无效，则*可以*将其设置（但同样*也可以* *不*设置）为 EINVAL。

根据手头的工作，我有时会安排跳过返回的转换指针末尾的尾随空格，然后如果最后一个字符不是终止的 null '\0'，则抱怨（拒绝）。或者我可以草率地让垃圾出现在最后，或者我可以接受可选的乘数，如 'K'、'M'、'G'、'T' 表示千字节、兆字节、千兆字节、太字节……或任何其他基于上下文的需求。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T23:58:03.903

我想您可以单步调试字符串并检查其中是否有任何`.`字符。不过，这只是我脑海中闪现的第一件事，所以我相信还有其他（更好的）方法可以更加确定。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-17T00:21:11.087

使用 strtol/strtoll（不是 atoi）检查整数。使用 strtof/strtod（不是 atof）检查双打。

atoi 和 atof 转换字符串的初始部分，但不告诉您他们是否使用了所有字符串。strtol/strtod 告诉你字符转换后是否有多余的垃圾。

所以在这两种情况下，请记住传入一个非空的 TAIL 参数，并检查它是否指向字符串的末尾（即 **TAIL == 0）。还要检查下溢和上溢的返回值（有关详细信息，请参阅手册页或 ANSI 标准）。

另请注意，strod/strtol 会跳过初始空格，因此如果要将具有初始空格的字符串视为格式错误，还需要检查第一个字符。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T00:07:12.710

这实际上取决于您首先要问的原因。

如果您只想解析一个数字并且不知道它是浮点数还是整数，那么只需解析一个浮点数，它也会正确解析一个整数。

如果你真的想知道类型，也许是为了分类，那么你真的应该考虑按照你认为最相关的顺序测试类型。就像尝试解析一个整数，如果你不能，然后尝试解析一个浮点数。（反过来只会产生更多的浮动......）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-17T00:12:02.417

即使有尾随非数字字符， atoi 和 atof 也会转换数字。但是，如果您使用 strtol 和 strtod ，它不仅会跳过前导空格和可选符号，还会为您留下一个指向不在数字中的第一个字符的指针。然后您可以检查其余部分是否为空格。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-02-15T00:41:49.630

好吧，如果你不想使用像 strtoul 这样的新函数，你可以添加另一个 strcmp 语句来查看字符串是否为 0。

IE

```
if(atof(token) != NULL || strcmp(token, "0") == 0) 
```

# multithreading - 在 Delphi 中，TDataSet 线程安全吗？

> ID：78475
> 
> 赞同：14
> 
> 时间：2008-09-16T23:55:59.587
> 
> 标签：multithreading, delphi, dataset

我希望能够在它自己的线程中异步打开一个 TDataSet，以便主 VCL 线程可以继续运行直到完成，然后让主 VCL 线程从该 TDataSet 读取。我做了一些实验并且遇到了一些非常奇怪的情况，所以我想知道是否有人以前做过。

我见过一些示例应用程序，其中 TDataSet 在单独的线程中创建，它被打开，然后从中读取数据，但这都是在单独的线程中完成的。我想知道在另一个线程打开数据源之后从主 VCL 线程读取 TDataSet 是否安全。

我在 Delphi 7 中进行 Win32 编程，使用来自[DAC for MySQL](http://www.microolap.com/products/connectivity/mysqldac/)的 TmySQLQuery作为我的 TDataSet 后代。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T08:28:46.607

如果您只想在自己的线程中使用数据集，您可以使用同步与主线程进行任何 VCL/UI 更新通信，就像与任何其他组件一样。
或者，更好的是，您可以使用自己的消息系统实现主线程和工作线程之间的通信。

在此处查看 Hallvard 的线程解决方案：http:
[//hallvards.blogspot.com/2008/03/tdm6-knitting-your-own-threads.html](http://hallvards.blogspot.com/2008/03/tdm6-knitting-your-own-threads.html)

或另一个： http:
[//dn.codegear.com/article/22411](http://dn.codegear.com/article/22411)

有关同步及其低效率的一些解释：
[http ://www.eonclash.com/Tutorials/Multithreading/MartinHarvey1.1/Ch3.html](http://www.eonclash.com/Tutorials/Multithreading/MartinHarvey1.1/Ch3.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T00:10:23.793

我已经看到它与 TDataSet 的其他实现一起完成，即在[Asta](http://www.astatech.com)组件中。这些将联系服务器，立即返回，然后在加载数据后触发事件。

但是，我相信这在很大程度上取决于组件。例如，除了主 VCL 线程之外，无法以同步方式打开这些相同的 Asta 组件。

所以简而言之，我不认为这是 TDataSet 本身的限制，而是特定于实现的东西，我无权访问您提到的组件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T01:22:56.040

**在多个线程之间使用相同的TDataSet**时要记住的一件事是，您只能在任何给定时间读取当前记录。因此，如果您在一个线程中读取记录，然后另一个线程调用**Next**，那么您就有麻烦了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T03:00:07.240

还要记住线程很可能需要自己的数据库连接。我相信这里需要的是一个多线程“保存”对象，用于将数据从线程加载到（只写），然后从主 VCL 线程只读。在阅读之前使用某种同步方法来确保您不会在同一时刻阅读您的写作，或者在同一时刻阅读您的阅读，或者将所有内容加载到内存文件中并编写一个同步方法来告诉主应用程序在文件中的位置停止阅读。

我已经多次采用最后一种方法，取决于预期记录的数量（和数据集的大小），我什至将它带到本地系统上的物理磁盘文件中。它工作得很好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T11:00:10.673

我已经完成了多线程数据访问，这并不简单：

1）您需要为每个线程创建一个会话。

2) 对该 TDataSet 实例所做的一切都必须在创建它的线程的上下文中完成。如果你想在上面放置一个数据库网格，这并不容易。

3) 如果您想让主线程处理您的数据，直接的解决方案是将其移动到某种单独的容器中，例如内存数据集。

4）一旦数据检索完成，您需要某种信号机制来通知主线程。

...而且异常处理也不是直截了当的...

但是：一旦你成功了，应用程序将非常优雅！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T03:28:14.627

大多数 TDatasets 不是线程安全的。我知道线程安全的是[kbmMemtable](http://www.components4programmers.com/products/kbmmemtable/index.htm "kbmMemtable")。它还具有克隆数据集的能力，因此确实会出现移动记录指针的问题（如 Jim McKeeth 所解释的）。它们是您可以获得（购买或免费）的最佳数据集之一。

# .net - .NET 和 AMF

> ID：78477
> 
> 赞同：4
> 
> 时间：2008-09-16T23:56:34.060
> 
> 标签：.net, apache-flex, actionscript-3, amf

如何让 ASP.NET (inc MVC) 应用程序通过 AMF 与 Flex UI 通信。我想一次推送大约 100 多条记录，而 AMF 似乎是前进的方向，但似乎没有任何明显的迹象。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-17T01:06:09.947

如果您时间紧迫，您可以使用 RemoteObject 来访问已编译的 DLL（如 WebORB - 它对 .NET 是免费的，但您需要在 Express 之上的 VS 副本来编译您想要公开给 Flex 的类）

并以这种方式检索对象...

显然，您的对象应该有一个适当的 DAL 或生成，以便您可以与您的数据库进行通信。

但我建议将 Cairngorm 用于任何数据密集型 Flex 应用程序。这并不简单，开发也不会感觉那么快，但是一旦你理解了它，事情就会顺利得多，而且感觉很好。我可以详细介绍，但有些人比我聪明得多，他们已经深入解释了它。像你这样的人应该能够很快掌握这些概念。

以下是学习 WebORB 和 Cairngorm 的链接：

*   weborb：[http ://www.themidnightcoders.com/weborb/](http://www.themidnightcoders.com/weborb/)
*   凯恩戈姆：[http ://opensource.adobe.com/wiki/display/cairngorm/Cairngorm](http://opensource.adobe.com/wiki/display/cairngorm/Cairngorm)
*   学习凯恩戈姆： http: [//www.adobe.com/devnet/flex/articles/cairngorm_pt1.html](http://www.adobe.com/devnet/flex/articles/cairngorm_pt1.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T03:00:15.490

用于 .Net AMF 远程处理的 WebORB 的替代方案是[FlourineFx](http://www.fluorinefx.com/)。我没用过，但看起来很有趣。我使用了非常强大的 WebORB。它有一些很棒的代码生成工具，可以加快构建数据库驱动应用程序的过程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T04:21:46.577

对上述答案的一个小修正：您实际上可以使用 Express 版本来编译您的程序集。使用 WebORB，您可以简单地将 DLL 部署到虚拟目录的 /bin 文件夹中，它会负责将您的类启用为 Flex Remoting 服务。您不需要实现任何特殊接口或使用任何特殊属性。只需创建一个类来返回您要传递给客户端的数据，将该类部署到 weborb 并在客户端使用 RemoteObject API。这是入门文章的链接：

[http://www.themidnightcoders.com/articles/flextodotnet.htm](http://www.themidnightcoders.com/articles/flextodotnet.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-18T14:00:55.130

我会明确检查 WebORB 和 MSMQ 支持（FluorineFX 具有相同的功能。两者都是免费的）。您可以让 WebORB 监听 MSMQ 中的某个队列。在弹性方面，您需要创建一个消费者并将其订阅到该队列。然后，WebORB 会将队列中的每条消息推送到在 swf 中创建的所有消费者。像您的 ASP.NET 应用程序这样的其他应用程序可以将消息放入该队列（例如，序列化对象或 xml），并将传递到您的 Flex GUI。

[我在http://blog.johlero.eu](http://blog.johlero.eu)上写了一些关于 subect 的帖子。

另一个很好的例子是[http://www.themidnightcoders.com/articles/msmqtoflexdatapush.shtm](http://www.themidnightcoders.com/articles/msmqtoflexdatapush.shtm)，他们使用 Windows 窗体应用程序向 flex Gui 发送消息。

Lieven Cardoen 又名 Johlero

# shell - $$ 在 shell 中是什么意思？

> ID：78493
> 
> 赞同：157
> 
> 时间：2008-09-16T23:59:32.743
> 
> 标签：shell, scripting

我曾经读到，在 shell 中为临时文件获取唯一文件名的一种方法是使用双美元符号 ( `$$`)。这确实会产生一个不时变化的数字......但如果你重复调用它，它会返回相同的数字。（解决办法就是利用时间。）

我很想知道`$$`实际上是什么，以及为什么建议将其作为生成唯一文件名的一种方式。

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2008-09-17T00:13:43.507

`$$`是 bash 中的进程 ID (PID)。使用`$$`是一个坏主意，因为它通常会产生竞争条件，并允许您的 shell 脚本被攻击者破坏。例如，请参阅所有[这些](http://www.google.com/search?q=tmp+race)创建不安全临时文件并不得不发布安全建议的人。

相反，使用`mktemp`. mktemp的[Linux 手册页](http://linux.die.net/man/1/mktemp)非常好。这是其中的一些示例代码：

```
tempfoo=`basename $0`
TMPFILE=`mktemp -t ${tempfoo}` || exit 1
echo "program output" >> $TMPFILE 
```

* * *

## 回答 #2

> 赞同：112
> 
> 时间：2008-09-17T00:02:13.923

在 Bash`$$`中是进程 ID，如注释中所述，由于各种原因，将其用作临时文件名是不安全的。

对于临时文件名，使用`mktemp`命令。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-09-17T00:01:48.480

$$ 是当前进程的id。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-17T00:05:09.347

类 UNIX 操作系统中的每个进程都有一个（临时）唯一标识符，即 PID。同时运行的两个进程不能有相同的 PID，$$ 指的是运行脚本的 bash 实例的 PID。

这*不是*一个唯一标识符，因为它永远不会被重用（实际上，PID 经常被重用）。它给你的是一个数字，如果另一个人运行你的脚本，他们将在你的脚本仍在运行时获得不同的标识符。一旦你的 PID 死了，PID 可能会被回收，其他人可能会运行你的脚本，获得相同的 PID，从而获得相同的文件名。

因此，说“$$ 给出一个文件名，这样如果其他人在我的实例仍在运行时运行相同的脚本，他们将得到一个不同的名称”，这真的是很理智的。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-17T00:06:00.420

$$ 是您的 PID。它并不会真正生成唯一的文件名，除非你很小心并且没有其他人以完全相同的方式这样做。

通常你会创建类似 /tmp/myprogramname$$

有很多方法可以解决这个问题，如果您正在写入其他人可以写入的位置，那么在许多操作系统上预测您将拥有什么 PID 并搞砸并不难——想象您正在运行以 root 身份创建 /tmp/yourprogname13395 作为指向 /etc/passwd 的符号链接，然后您将其写入。

这是在 shell 脚本中做的一件坏事。如果您要使用临时文件来做某事，您应该使用更好的语言，它至少可以让您添加“独占”标志来打开（创建）文件。然后你可以确定你没有破坏其他东西。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-17T00:08:20.430

$$ 是运行脚本的 shell 解释器的 pid（进程 ID）。目前在系统上运行的每个进程都是不同的，但随着时间的推移，pid 会环绕，并且在您退出后最终会有另一个具有相同 pid 的进程。只要您正在运行，pid 对您来说是唯一的。

从上面的定义很明显，无论你在脚本中使用多少次 $$，它都会返回相同的数字。

您可以使用 /tmp/myscript.scratch.$$ 作为临时文件，用于不需要非常可靠或安全的东西。在脚本末尾删除此类临时文件是一个很好的做法，例如，使用 trap 命令：

```
trap "echo 'Cleanup in progress'; rm -r $TMP_DIR" EXIT 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-17T00:01:50.540

$$ 是当前 shell 进程的 pid。这不是生成唯一文件名的好方法。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-17T00:02:44.733

它是 bash 进程的进程 ID。没有并发进程将永远具有相同的 PID。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-17T00:05:11.857

$$ 是运行脚本的 shell 的进程 ID。有关更多详细信息，请参见 sh 或 bash 的手册页。可以使用命令行“man sh”或通过在网上搜索“shell manpage”来找到手册页

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-17T00:29:10.287

让我再说一遍 emk 的答案——不要将 $$ 本身用作“独特”的任何东西。对于文件，使用 mktemp。对于同一 bash 脚本中的其他 ID，请使用 "$$$(date +%s%N)" 以获得*相当*好的唯一性。

```
 -k 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-11-15T22:29:33.073

在**鱼壳**( `3.1.2`) 中：

> 该`$`符号也可以多次使用，作为一种“取消引用”运算符（C 或 C++ 中的 *）

```
set bar bazz
set foo bar
echo $foo # bar
echo $$foo # same as echo $bar → bazz 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-02-12T11:05:54.190

> 此外，您可以通过此命令获取登录用户名。例如。

```
echo $(</proc/$$/login id). After that, you need to use getent command. 
```

# design-patterns - shell 脚本的设计模式或最佳实践

> ID：78497
> 
> 赞同：181
> 
> 时间：2008-09-17T00:00:03.273
> 
> 标签：design-patterns, bash, shell

有谁知道任何关于 shell 脚本（sh、bash 等）的最佳实践或设计模式的资源？

* * *

## 回答 #1

> 赞同：232
> 
> 时间：2009-04-10T22:14:48.503

我写了相当复杂的 shell 脚本，我的第一个建议是“不要”。原因是很容易犯一个阻碍你的脚本的小错误，甚至让它变得危险。

也就是说，除了我的个人经验，我没有其他资源可以传递给你。这是我通常做的事情，这是矫枉过正，但往往是可靠的，虽然*非常*冗长。

**调用**

让您的脚本接受多头和空头选项。要小心，因为有两个命令可以解析选项，getopt 和 getopts。使用 getopt 可以减少麻烦。

```
CommandLineOptions__config_file=""
CommandLineOptions__debug_level=""

getopt_results=`getopt -s bash -o c:d:: --long config_file:,debug_level:: -- "$@"`

if test $? != 0
then
    echo "unrecognized option"
    exit 1
fi

eval set -- "$getopt_results"

while true
do
    case "$1" in
        --config_file)
            CommandLineOptions__config_file="$2";
            shift 2;
            ;;
        --debug_level)
            CommandLineOptions__debug_level="$2";
            shift 2;
            ;;
        --)
            shift
            break
            ;;
        *)
            echo "$0: unparseable option $1"
            EXCEPTION=$Main__ParameterException
            EXCEPTION_MSG="unparseable option $1"
            exit 1
            ;;
    esac
done

if test "x$CommandLineOptions__config_file" == "x"
then
    echo "$0: missing config_file parameter"
    EXCEPTION=$Main__ParameterException
    EXCEPTION_MSG="missing config_file parameter"
    exit 1
fi 
```

另一个重要的一点是，如果程序成功完成，则应始终返回零，如果出现问题，则应始终返回非零。

**函数调用**

您可以在 bash 中调用函数，只需记住在调用之前定义它们。函数就像脚本，它们只能返回数值。这意味着您必须发明一种不同的策略来返回字符串值。我的策略是使用一个名为 RESULT 的变量来存储结果，如果函数干净地完成，则返回 0。此外，如果您返回一个不同于零的值，则可以引发异常，然后设置两个“异常变量”（我的：EXCEPTION 和 EXCEPTION_MSG），第一个包含异常类型，第二个包含人类可读的消息。

当你调用一个函数时，函数的参数被分配给特殊的变量$0、$1等。我建议你把它们改成更有意义的名字。将函数内的变量声明为本地变量：

```
function foo {
   local bar="$0"
} 
```

**容易出错的情况**

在 bash 中，除非您另有声明，否则未设置的变量将用作空字符串。这在拼写错误的情况下是非常危险的，因为错误类型的变量不会被报告，它会被评估为空。采用

```
set -o nounset 
```

以防止这种情况发生。但是要小心，因为如果你这样做，程序将在你每次评估一个未定义的变量时中止。因此，检查变量是否未定义的唯一方法如下：

```
if test "x${foo:-notset}" == "xnotset"
then
    echo "foo not set"
fi 
```

您可以将变量声明为只读：

```
readonly readonly_var="foo" 
```

**模块化**

如果您使用以下代码，您可以实现“类似python”的模块化：

```
set -o nounset
function getScriptAbsoluteDir {
    # @description used to get the script path
    # @param $1 the script $0 parameter
    local script_invoke_path="$1"
    local cwd=`pwd`

    # absolute path ? if so, the first character is a /
    if test "x${script_invoke_path:0:1}" = 'x/'
    then
        RESULT=`dirname "$script_invoke_path"`
    else
        RESULT=`dirname "$cwd/$script_invoke_path"`
    fi
}

script_invoke_path="$0"
script_name=`basename "$0"`
getScriptAbsoluteDir "$script_invoke_path"
script_absolute_dir=$RESULT

function import() { 
    # @description importer routine to get external functionality.
    # @description the first location searched is the script directory.
    # @description if not found, search the module in the paths contained in $SHELL_LIBRARY_PATH environment variable
    # @param $1 the .shinc file to import, without .shinc extension
    module=$1

    if test "x$module" == "x"
    then
        echo "$script_name : Unable to import unspecified module. Dying."
        exit 1
    fi

    if test "x${script_absolute_dir:-notset}" == "xnotset"
    then
        echo "$script_name : Undefined script absolute dir. Did you remove getScriptAbsoluteDir? Dying."
        exit 1
    fi

    if test "x$script_absolute_dir" == "x"
    then
        echo "$script_name : empty script path. Dying."
        exit 1
    fi

    if test -e "$script_absolute_dir/$module.shinc"
    then
        # import from script directory
        . "$script_absolute_dir/$module.shinc"
    elif test "x${SHELL_LIBRARY_PATH:-notset}" != "xnotset"
    then
        # import from the shell script library path
        # save the separator and use the ':' instead
        local saved_IFS="$IFS"
        IFS=':'
        for path in $SHELL_LIBRARY_PATH
        do
            if test -e "$path/$module.shinc"
            then
                . "$path/$module.shinc"
                return
            fi
        done
        # restore the standard separator
        IFS="$saved_IFS"
    fi
    echo "$script_name : Unable to find module $module."
    exit 1
} 
```

然后，您可以使用以下语法导入扩展名为 .shinc 的文件

导入“AModule/ModuleFile”

将在 SHELL_LIBRARY_PATH 中搜索。由于您总是在全局命名空间中导入，请记住为所有函数和变量添加适当的前缀，否则可能会出现名称冲突。我使用双下划线作为 python 点。

另外，把它作为你模块中的第一件事

```
# avoid double inclusion
if test "${BashInclude__imported+defined}" == "defined"
then
    return 0
fi
BashInclude__imported=1 
```

**面向对象编程**

在 bash 中，你不能进行面向对象的编程，除非你构建了一个相当复杂的对象分配系统（我考虑过。这是可行的，但很疯狂）。然而，在实践中，您可以进行“面向单例的编程”：每个对象都有一个实例，并且只有一个。

我所做的是：我将一个对象定义为一个模块（参见模块化条目）。然后我定义空变量（类似于成员变量）一个初始化函数（构造函数）和成员函数，就像在这个示例代码中一样

```
# avoid double inclusion
if test "${Table__imported+defined}" == "defined"
then
    return 0
fi
Table__imported=1

readonly Table__NoException=""
readonly Table__ParameterException="Table__ParameterException"
readonly Table__MySqlException="Table__MySqlException"
readonly Table__NotInitializedException="Table__NotInitializedException"
readonly Table__AlreadyInitializedException="Table__AlreadyInitializedException"

# an example for module enum constants, used in the mysql table, in this case
readonly Table__GENDER_MALE="GENDER_MALE"
readonly Table__GENDER_FEMALE="GENDER_FEMALE"

# private: prefixed with p_ (a bash variable cannot start with _)
p_Table__mysql_exec="" # will contain the executed mysql command 

p_Table__initialized=0

function Table__init {
    # @description init the module with the database parameters
    # @param $1 the mysql config file
    # @exception Table__NoException, Table__ParameterException

    EXCEPTION=""
    EXCEPTION_MSG=""
    EXCEPTION_FUNC=""
    RESULT=""

    if test $p_Table__initialized -ne 0
    then
        EXCEPTION=$Table__AlreadyInitializedException   
        EXCEPTION_MSG="module already initialized"
        EXCEPTION_FUNC="$FUNCNAME"
        return 1
    fi

    local config_file="$1"

      # yes, I am aware that I could put default parameters and other niceties, but I am lazy today
      if test "x$config_file" = "x"; then
          EXCEPTION=$Table__ParameterException
          EXCEPTION_MSG="missing parameter config file"
          EXCEPTION_FUNC="$FUNCNAME"
          return 1
      fi

    p_Table__mysql_exec="mysql --defaults-file=$config_file --silent --skip-column-names -e "

    # mark the module as initialized
    p_Table__initialized=1

    EXCEPTION=$Table__NoException
    EXCEPTION_MSG=""
    EXCEPTION_FUNC=""
    return 0

}

function Table__getName() {
    # @description gets the name of the person 
    # @param $1 the row identifier
    # @result the name

    EXCEPTION=""
    EXCEPTION_MSG=""
    EXCEPTION_FUNC=""
    RESULT=""

    if test $p_Table__initialized -eq 0
    then
        EXCEPTION=$Table__NotInitializedException
        EXCEPTION_MSG="module not initialized"
        EXCEPTION_FUNC="$FUNCNAME"
        return 1
    fi

    id=$1

      if test "x$id" = "x"; then
          EXCEPTION=$Table__ParameterException
          EXCEPTION_MSG="missing parameter identifier"
          EXCEPTION_FUNC="$FUNCNAME"
          return 1
      fi

    local name=`$p_Table__mysql_exec "SELECT name FROM table WHERE id = '$id'"`
      if test $? != 0 ; then
        EXCEPTION=$Table__MySqlException
        EXCEPTION_MSG="unable to perform select"
        EXCEPTION_FUNC="$FUNCNAME"
        return 1
      fi

    RESULT=$name
    EXCEPTION=$Table__NoException
    EXCEPTION_MSG=""
    EXCEPTION_FUNC=""
    return 0
} 
```

**捕获和处理信号**

我发现这对于捕获和处理异常很有用。

```
function Main__interruptHandler() {
    # @description signal handler for SIGINT
    echo "SIGINT caught"
    exit
} 
function Main__terminationHandler() { 
    # @description signal handler for SIGTERM
    echo "SIGTERM caught"
    exit
} 
function Main__exitHandler() { 
    # @description signal handler for end of the program (clean or unclean). 
    # probably redundant call, we already call the cleanup in main.
    exit
} 

trap Main__interruptHandler INT
trap Main__terminationHandler TERM
trap Main__exitHandler EXIT

function Main__main() {
    # body
}

# catch signals and exit
trap exit INT TERM EXIT

Main__main "$@" 
```

**提示和技巧**

如果由于某种原因无法正常工作，请尝试重新排序代码。顺序很重要，但并不总是直观的。

甚至不考虑使用 tcsh。它不支持功能，而且总的来说很糟糕。

希望对您有所帮助，尽管请注意。如果非得用我这里写的那种东西，说明你的问题太复杂了，用shell解决不了。使用另一种语言。由于人为因素和遗产，我不得不使用它。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-09-17T02:44:13.487

查看[Advanced Bash-Scripting Guide](http://www.tldp.org/LDP/abs/html/index.html)，了解有关 shell 脚本的大量知识——不仅仅是 Bash。

不要听别人告诉你要研究其他可能更复杂的语言。如果 shell 脚本满足您的需求，请使用它。你想要功能，而不是花哨。新语言为您的简历提供了宝贵的新技能，但如果您有需要完成的工作并且您已经了解 shell，这将无济于事。

如前所述，没有很多用于 shell 脚本的“最佳实践”或“设计模式”。不同的用途有不同的指导方针和偏见——就像任何其他编程语言一样。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-09-17T23:57:14.270

shell 脚本是一种设计用于操作文件和进程的语言。虽然它很好，但它不是通用语言，所以总是尝试从现有实用程序中粘合逻辑，而不是在 shell 脚本中重新创建新逻辑。

除了一般原则之外，我还收集了一些[常见的 shell 脚本错误](http://www.pixelbeat.org/programming/shell_script_mistakes.html "常见的 shell 脚本错误")。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-17T19:30:13.460

**知道何时使用它。**对于快速而肮脏的将命令粘合在一起，没关系。如果您需要做的不仅仅是一些重要的决定、循环等任何事情，请选择 Python、Perl 和**模块化**。

shell 的最大问题通常是最终结果看起来就像一个大泥球，4000 行 bash 并且还在增长……你无法摆脱它，因为现在你的整个项目都依赖于它。当然，**它从 40 行**漂亮的 bash 开始。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-17T04:57:28.893

今年（2008 年）在 OSCON 上就这个主题举行了一场精彩的会议：http: [//assets.en.oreilly.com/1/event/12/Shell%20Scripting%20Craftsmanship%20Presentation%201.pdf](http://assets.en.oreilly.com/1/event/12/Shell%20Scripting%20Craftsmanship%20Presentation%201.pdf)

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-09-17T00:05:01.840

使用 set -e 这样你就不会在出现错误后继续前进。如果您希望它在非 Linux 上运行，请尝试使其与 sh 兼容而不依赖 bash。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-17T00:02:48.947

简单：使用 python 而不是 shell 脚本。您的可读性提高了近 100 倍，而无需使您不需要的任何东西复杂化，并且保留了将部分脚本演变为函数、对象、持久对象 (zodb)、分布式对象 (pyro) 的能力，几乎没有任何额外的代码。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-09-17T20:33:48.173

要找到一些“最佳实践”，请查看 Linux 发行版（例如 Debian）如何编写他们的初始化脚本（通常在 /etc/init.d 中找到）

它们中的大多数都没有“bash-isms”，并且很好地分离了配置设置、库文件和源格式。

我的个人风格是编写一个定义一些默认变量的 master-shellscript，然后尝试加载（“源”）一个可能包含新值的配置文件。

我尽量避免使用函数，因为它们会使脚本更复杂。（Perl 就是为此目的而创建的。）

为确保脚本是可移植的，不仅要使用#!/bin/sh 进行测试，还要使用#!/bin/ash、#!/bin/dash 等。您很快就会发现特定于Bash 的代码。

# openid - OpenID 迁移

> ID：78523
> 
> 赞同：11
> 
> 时间：2008-09-17T00:04:34.400
> 
> 标签：openid

我对 OpenID 很好奇。虽然我同意统一凭证的想法很棒，但我有一些保留意见。什么是防止 OpenID 提供者发疯并持有他们拥有的 OpenID 帐户的人质，直到您支付 $n？如果我决定不喜欢我所在的提供商，是否有办法迁移到不同的提供商而不会丢失我在各个站点的所有信息？

**编辑：**我觉得我的问题被误解了。有人说我可以简单地创建一个代表团，这部分是正确的。如果我还没有在例如 SO 创建帐户，我可以这样做。如果我决定在某个时候建立自己的 OpenID 提供程序，我将无法看到移动和保留我的帐户信息。这就是我想知道的那种想法。

**第二次编辑：** 我看到有一个关于将它添加到 SO 的用户声音。[关联](https://web.archive.org/web/20090424075552/http://stackoverflow.uservoice.com:80/pages/general/suggestions/16685)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-17T00:08:45.780

这就是您可以使用[OpenID 委托](http://wiki.openid.net/Delegation)的原因，即您在您的个人网站上设置两个 META 标签，然后您可以使用该网站的 URL 作为您当前选择的 OpenID 提供商的别名。如果它变得不友好，您只需切换到另一个并更新您的标签。

此外，您始终可以操作自己的 OpenID 身份提供程序（如果您有一个服务器，例如，一个 Web 服务器和 PHP）。我为此使用[phpMyID](http://siege.org/projects/phpMyID/)。

**更新**：关于更新的问题：OpenID 消费者（您使用 OpenID 登录的站点）可能允许您自行切换用于登录的 OpenID。例如，Sourceforge 就是这样做的。为了防止出现问题，最好从一开始就使用委托。否则，这是 OpenID 设计强加的必要限制。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-17T01:19:20.587

允许将多个 OpenID 与单个帐户关联是[OpenID 依赖方的最佳实践。](http://wiki.openid.net/Relying_Party_Best_Practices#Many-to-one_relationship_between_Identity_URLs_and_.22user_accounts.22)

这也是[OpenID 依赖方最佳实践](http://wiki.openid.net/Relying_Party_Best_Practices#Provide_.22Lost_Identifier.22_functionality_to_switch_to_a_new_identifier_without_access_to_the_old_one)，允许人们在不访问旧 OpenID 的情况下恢复他们的帐户。

如果 Stack Overflow 不做这些事情，那么这是 Stack Overflow 的缺点，而不是 OpenID。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-17T00:07:28.090

没有什么可以阻止提供商持有您的帐户以勒索赎金。您应该选择一个您认为可靠的提供商。或者，如果您只信任自己，您可以成为自己的提供者：

[http://wiki.openid.net/Run_your_own_identity_server](http://wiki.openid.net/Run_your_own_identity_server)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-17T01:13:44.627

在我向他们支付 $n 之前，无法阻止 Google 扣押我的 gmail 收件箱。我猜这是信任问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T00:06:55.690

这可能会有所帮助： [OpenID](http://openid.net/foundation/intellectual-property/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T00:26:02.320

我认为您可能会将自由市场供应商与政府混为一谈。后者滥用他们的权力，因为你没有其他人可以去（尝试获得“替代”护照）。由于 OpenID 提供者之间存在竞争，因此您始终可以离开一个提供者并转到另一个提供者。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T01:11:17.440

一个以良好方式实施 OpenID 身份验证的站点将允许您将您的 ID 切换到另一个 URL，或者在您的主​​要提供商发生故障时指定辅助 ID。

目前，大多数网站仍然没有这个选项，是的——如果我们的 OpenID 提供商有一天会删除我们的帐户，我们将无法在某些网站上访问我们的帐户。我们相信他们不会拒绝我们的服务。

# c# - 深度克隆对象

> ID：78536
> 
> 赞同：2473
> 
> 时间：2008-09-17T00:06:27.547
> 
> 标签：c#, .net, clone

我想做类似的事情：

```
MyObject myObj = GetMyObj(); // Create and fill a new object
MyObject newObj = myObj.Clone(); 
```

然后对未反映在原始对象中的新对象进行更改。

我并不经常需要这个功能，所以当有必要时，我会创建一个新对象，然后单独复制每个属性，但它总是让我觉得有更好或更优雅的处理方式情况。

如何克隆或深度复制对象，以便可以修改克隆的对象而不会在原始对象中反映任何更改？

* * *

## 回答 #1

> 赞同：1849
> 
> 时间：2008-09-17T00:18:28.830

一种方法是实现[`ICloneable`](http://msdn.microsoft.com/en-us/library/system.icloneable.aspx)接口（[在此处](https://stackoverflow.com/questions/78536/cloning-objects-in-c/78568#78568)描述，因此我不会反刍），这是我不久前在[The Code Project](http://www.codeproject.com/Articles/23832/Implementing-Deep-Cloning-via-Serializing-objects)上找到的一个不错的深度克隆对象复制器，并将其合并到我们的代码中。如其他地方所述，它要求您的对象是可序列化的。

```
using System;
using System.IO;
using System.Runtime.Serialization;
using System.Runtime.Serialization.Formatters.Binary;

/// <summary>
/// Reference Article http://www.codeproject.com/KB/tips/SerializedObjectCloner.aspx
/// Provides a method for performing a deep copy of an object.
/// Binary Serialization is used to perform the copy.
/// </summary>
public static class ObjectCopier
{
    /// <summary>
    /// Perform a deep copy of the object via serialization.
    /// </summary>
    /// <typeparam name="T">The type of object being copied.</typeparam>
    /// <param name="source">The object instance to copy.</param>
    /// <returns>A deep copy of the object.</returns>
    public static T Clone<T>(T source)
    {
        if (!typeof(T).IsSerializable)
        {
            throw new ArgumentException("The type must be serializable.", nameof(source));
        }

        // Don't serialize a null object, simply return the default for that object
        if (ReferenceEquals(source, null)) return default;

        using var Stream stream = new MemoryStream();
        IFormatter formatter = new BinaryFormatter();
        formatter.Serialize(stream, source);
        stream.Seek(0, SeekOrigin.Begin);
        return (T)formatter.Deserialize(stream);
    }
} 
```

这个想法是它序列化您的对象，然后将其反序列化为一个新对象。好处是当对象变得过于复杂时，您不必担心克隆所有内容。

如果您更喜欢使用 C# 3.0 的新[扩展方法](http://en.wikipedia.org/wiki/Extension_method)，请将方法更改为具有以下签名：

```
public static T Clone<T>(this T source)
{
   // ...
} 
```

现在方法调用简单地变成了`objectBeingCloned.Clone();`.

**编辑**（2015 年 1 月 10 日）我想我会重新审视这个，提到我最近开始使用（Newtonsoft）Json 来做这件事，它[应该](http://maxondev.com/serialization-performance-comparison-c-net-formats-frameworks-xmldatacontractserializer-xmlserializer-binaryformatter-json-newtonsoft-servicestack-text/)更轻，并且避免了 [Serializable] 标签的开销。（**注意**@atconway 在评论中指出私有成员不使用 JSON 方法克隆）

```
/// <summary>
/// Perform a deep Copy of the object, using Json as a serialization method. NOTE: Private members are not cloned using this method.
/// </summary>
/// <typeparam name="T">The type of object being copied.</typeparam>
/// <param name="source">The object instance to copy.</param>
/// <returns>The copied object.</returns>
public static T CloneJson<T>(this T source)
{            
    // Don't serialize a null object, simply return the default for that object
    if (ReferenceEquals(source, null)) return default;

    // initialize inner objects individually
    // for example in default constructor some list property initialized with some values,
    // but in 'source' these items are cleaned -
    // without ObjectCreationHandling.Replace default constructor values will be added to result
    var deserializeSettings = new JsonSerializerSettings {ObjectCreationHandling = ObjectCreationHandling.Replace};

    return JsonConvert.DeserializeObject<T>(JsonConvert.SerializeObject(source), deserializeSettings);
} 
```

* * *

## 回答 #2

> 赞同：375
> 
> 时间：2013-04-03T13:31:02.153

我想要一个克隆器，用于非常简单的对象，主要是基元和列表。如果您的对象是开箱即用的 JSON 可序列化对象，那么此方法就可以解决问题。这不需要修改或实现克隆类上的接口，只需要像 JSON.NET 这样的 JSON 序列化器。

```
public static T Clone<T>(T source)
{
    var serialized = JsonConvert.SerializeObject(source);
    return JsonConvert.DeserializeObject<T>(serialized);
} 
```

此外，您可以使用此扩展方法

```
public static class SystemExtension
{
    public static T Clone<T>(this T source)
    {
        var serialized = JsonConvert.SerializeObject(source);
        return JsonConvert.DeserializeObject<T>(serialized);
    }
} 
```

* * *

## 回答 #3

> 赞同：190
> 
> 时间：2008-09-17T01:12:18.327

不使用[ICloneable](http://referencesource.microsoft.com/mscorlib/system/icloneable.cs.html#fb795e239ce05299)的原因**不是**因为它没有通用接口。 [不使用它的原因是因为它是模糊的](http://blogs.msdn.com/brada/archive/2004/05/03/125427.aspx)。不清楚你得到的是浅拷贝还是深拷贝。这取决于实施者。

是的，`MemberwiseClone`做一个浅拷贝，但相反的`MemberwiseClone`不是`Clone`；它可能是，`DeepClone`不存在的。当您通过其 ICloneable 接口使用对象时，您无法知道底层对象执行哪种克隆。（并且 XML 注释不会说清楚，因为您将获得接口注释，而不是对象的 Clone 方法上的注释。）

我通常做的只是简单地制作一个`Copy`完全符合我想要的方法。

* * *

## 回答 #4

> 赞同：146
> 
> 时间：2012-09-26T20:18:05.100

在大量阅读了此处链接的许多选项以及此问题的可能解决方案之后，我相信所有选项都在[*Ian P*](https://developerscon.blogspot.com/2008/06/c-object-clone-wars.html)[的链接](https://developerscon.blogspot.com/2008/06/c-object-clone-wars.html)[中得到了很好的总结](https://developerscon.blogspot.com/2008/06/c-object-clone-wars.html)*（所有其他选项都是这些选项的变体），并且最佳解决方案由[*Pedro77*的问题评论链接](http://www.agiledeveloper.com/articles/cloning072002.htm)。*

 *所以我将在这里复制这两个参考的相关部分。这样我们就可以拥有：

## 用 C 语言克隆对象的最佳方法！

首先，这些都是我们的选择：

*   手动使用**[ICloneable](https://docs.microsoft.com/en-us/dotnet/api/system.icloneable)**，它是*Shallow*且不是*类型安全的*
*   **[MemberwiseClone](https://docs.microsoft.com/en-us/dotnet/api/system.object.memberwiseclone)**，它使用 ICloneable
*   使用[Activator.CreateInstance](https://docs.microsoft.com/en-us/dotnet/api/system.activator.createinstance)和[递归 MemberwiseClone进行](https://github.com/Burtsev-Alexey/net-object-deep-copy/)**[反射](https://www.codeproject.com/Articles/3441/Base-class-for-cloning-an-object-in-C)**
*   **[序列化](https://docs.microsoft.com/en-us/dotnet/api/system.serializableattribute)**，正如[johnc 的首选答案所指出的那样](https://stackoverflow.com/a/78612/274502)
*   **中间语言**，我不知道它[是如何工作的](https://whizzodev.blogspot.com/2008/03/object-cloning-using-il-in-c.html)
*   **扩展方法**，例如[Havard Straden 的这个自定义克隆框架](https://circlesandcrossesblogarchive.blogspot.com/2008/01/extension-methods-for-copying-or.html)
*   **[表达式树](https://www.codeproject.com/Articles/1111658/Fast-Deep-Copy-of-Objects-by-Expression-Trees-Csha)**

文章[Fast Deep Copy by Expression Trees](https://www.codeproject.com/Articles/1111658/Fast-Deep-Copy-of-Objects-by-Expression-Trees-Csha) 也有序列化、反射和表达式树克隆的性能比较。

# 为什么我选择*ICloneable*（即手动）

[Venkat Subramaniam 先生（此处为冗余链接）详细解释了原因](http://www.agiledeveloper.com/articles/cloning072002.htm)。

他的所有文章都围绕着一个尝试适用于大多数情况的示例，使用 3 个对象：*Person*、*Brain*和*City*。我们想克隆一个人，它有自己的大脑，但在同一个城市。您可以描绘上述任何其他方法可能带来的所有问题，也可以阅读本文。

这是我对他的结论稍作修改的版本：

> `New`通过指定后跟类名来复制对象通常会导致代码不可扩展。使用克隆，原型模式的应用，是实现这一点的更好方法。但是，使用 C#（和 Java）中提供的 clone 也可能存在很大问题。最好提供一个受保护的（非公共）复制构造函数并从 clone 方法调用它。这使我们能够将创建对象的任务委托给类本身的实例，从而提供可扩展性，并且还可以使用受保护的复制构造函数安全地创建对象。

希望这个实现可以让事情变得清晰：

```
public class Person : ICloneable
{
    private final Brain brain; // brain is final since I do not want 
                // any transplant on it once created!
    private int age;
    public Person(Brain aBrain, int theAge)
    {
        brain = aBrain; 
        age = theAge;
    }
    protected Person(Person another)
    {
        Brain refBrain = null;
        try
        {
            refBrain = (Brain) another.brain.clone();
            // You can set the brain in the constructor
        }
        catch(CloneNotSupportedException e) {}
        brain = refBrain;
        age = another.age;
    }
    public String toString()
    {
        return "This is person with " + brain;
        // Not meant to sound rude as it reads!
    }
    public Object clone()
    {
        return new Person(this);
    }
    …
} 
```

现在考虑从 Person 派生一个类。

```
public class SkilledPerson extends Person
{
    private String theSkills;
    public SkilledPerson(Brain aBrain, int theAge, String skills)
    {
        super(aBrain, theAge);
        theSkills = skills;
    }
    protected SkilledPerson(SkilledPerson another)
    {
        super(another);
        theSkills = another.theSkills;
    }

    public Object clone()
    {
        return new SkilledPerson(this);
    }
    public String toString()
    {
        return "SkilledPerson: " + super.toString();
    }
} 
```

您可以尝试运行以下代码：

```
public class User
{
    public static void play(Person p)
    {
        Person another = (Person) p.clone();
        System.out.println(p);
        System.out.println(another);
    }
    public static void main(String[] args)
    {
        Person sam = new Person(new Brain(), 1);
        play(sam);
        SkilledPerson bob = new SkilledPerson(new SmarterBrain(), 1, "Writer");
        play(bob);
    }
} 
```

产生的输出将是：

```
This is person with Brain@1fcc69
This is person with Brain@253498
SkilledPerson: This is person with SmarterBrain@1fef6f
SkilledPerson: This is person with SmarterBrain@209f4e 
```

请注意，如果我们保持对象数量的计数，则此处实现的克隆将保持对象数量的正确计数。

* * *

## 回答 #5

> 赞同：95
> 
> 时间：2008-09-17T00:13:01.947

我更喜欢复制构造函数而不是克隆。意图更明确。

* * *

## 回答 #6

> 赞同：46
> 
> 时间：2011-03-16T11:38:17.713

复制所有公共属性的简单扩展方法。适用于任何对象，**不需要**类是`[Serializable]`. 可以扩展为其他访问级别。

```
public static void CopyTo( this object S, object T )
{
    foreach( var pS in S.GetType().GetProperties() )
    {
        foreach( var pT in T.GetType().GetProperties() )
        {
            if( pT.Name != pS.Name ) continue;
            ( pT.GetSetMethod() ).Invoke( T, new object[] 
            { pS.GetGetMethod().Invoke( S, null ) } );
        }
    };
} 
```

* * *

## 回答 #7

> 赞同：37
> 
> 时间：2012-10-15T17:55:40.633

如果您已经在使用像[ValueInjecter](https://github.com/omuleanu/ValueInjecter)或[Automapper](https://github.com/AutoMapper/AutoMapper)这样的 3rd 方应用程序，您可以执行以下操作：

```
MyObject oldObj; // The existing object to clone

MyObject newObj = new MyObject();
newObj.InjectFrom(oldObj); // Using ValueInjecter syntax 
```

使用这种方法，您不必在您的对象上实现`ISerializable`或。`ICloneable`这在 MVC/MVVM 模式中很常见，因此创建了像这样的简单工具。

请参阅[GitHub 上的 ValueInjecter 深度克隆示例](https://github.com/omuleanu/ValueInjecter/blob/dae7956439cac8516979fe254a520a1942c5cdeb/Tests/Cloning.cs)。

* * *

## 回答 #8

> 赞同：37
> 
> 时间：2013-12-24T22:56:12.867

我刚刚创建了**[`CloneExtensions`库](https://github.com/MarcinJuraszek/CloneExtensions)**项目。它使用表达式树运行时代码编译生成的简单赋值操作执行快速、深度克隆。

**如何使用它？**

使用表达式树，而不是编写自己的方法`Clone`或`Copy`在字段和属性之间进行分配的方法，而是让程序自己完成。`GetClone<T>()`标记为扩展方法的方法允许您在实例上简单地调用它：

```
var newInstance = source.GetClone(); 
```

您可以选择应该复制的内容`source`以`newInstance`使用`CloningFlags`枚举：

```
var newInstance 
    = source.GetClone(CloningFlags.Properties | CloningFlags.CollectionItems); 
```

**什么可以克隆？**

*   Primitive（int、uint、byte、double、char 等）、已知的不可变类型（DateTime、TimeSpan、String）和委托（包括 Action、Func 等）
*   可空的
*   T[] 数组
*   自定义类和结构，包括泛型类和结构。

以下类/结构成员在内部克隆：

*   公共而非只读字段的值
*   具有 get 和 set 访问器的公共属性的值
*   实现 ICollection 的类型的集合项

**它有多快？**

解决方案比反射更快，因为成员信息只需要收集一次，在`GetClone<T>`第一次用于给定类型之前`T`。

当您克隆多个相同类型的实例时，它也比基于序列化的解决方案更快`T`。

**和更多...**

[在文档](https://github.com/MarcinJuraszek/CloneExtensions/blob/master/EXPRESSION_TREES.md)中阅读有关生成表达式的更多信息。

示例表达式调试列表`List<int>`：

```
.Lambda #Lambda1<System.Func`4[System.Collections.Generic.List`1[System.Int32],CloneExtensions.CloningFlags,System.Collections.Generic.IDictionary`2[System.Type,System.Func`2[System.Object,System.Object]],System.Collections.Generic.List`1[System.Int32]]>(
    System.Collections.Generic.List`1[System.Int32] $source,
    CloneExtensions.CloningFlags $flags,
    System.Collections.Generic.IDictionary`2[System.Type,System.Func`2[System.Object,System.Object]] $initializers) {
    .Block(System.Collections.Generic.List`1[System.Int32] $target) {
        .If ($source == null) {
            .Return #Label1 { null }
        } .Else {
            .Default(System.Void)
        };
        .If (
            .Call $initializers.ContainsKey(.Constant<System.Type>(System.Collections.Generic.List`1[System.Int32]))
        ) {
            $target = (System.Collections.Generic.List`1[System.Int32]).Call ($initializers.Item[.Constant<System.Type>(System.Collections.Generic.List`1[System.Int32])]
            ).Invoke((System.Object)$source)
        } .Else {
            $target = .New System.Collections.Generic.List`1[System.Int32]()
        };
        .If (
            ((System.Byte)$flags & (System.Byte).Constant<CloneExtensions.CloningFlags>(Fields)) == (System.Byte).Constant<CloneExtensions.CloningFlags>(Fields)
        ) {
            .Default(System.Void)
        } .Else {
            .Default(System.Void)
        };
        .If (
            ((System.Byte)$flags & (System.Byte).Constant<CloneExtensions.CloningFlags>(Properties)) == (System.Byte).Constant<CloneExtensions.CloningFlags>(Properties)
        ) {
            .Block() {
                $target.Capacity = .Call CloneExtensions.CloneFactory.GetClone(
                    $source.Capacity,
                    $flags,
                    $initializers)
            }
        } .Else {
            .Default(System.Void)
        };
        .If (
            ((System.Byte)$flags & (System.Byte).Constant<CloneExtensions.CloningFlags>(CollectionItems)) == (System.Byte).Constant<CloneExtensions.CloningFlags>(CollectionItems)
        ) {
            .Block(
                System.Collections.Generic.IEnumerator`1[System.Int32] $var1,
                System.Collections.Generic.ICollection`1[System.Int32] $var2) {
                $var1 = (System.Collections.Generic.IEnumerator`1[System.Int32]).Call $source.GetEnumerator();
                $var2 = (System.Collections.Generic.ICollection`1[System.Int32])$target;
                .Loop  {
                    .If (.Call $var1.MoveNext() != False) {
                        .Call $var2.Add(.Call CloneExtensions.CloneFactory.GetClone(
                                $var1.Current,
                                $flags,

                         $initializers))
                } .Else {
                    .Break #Label2 { }
                }
            }
            .LabelTarget #Label2:
        }
    } .Else {
        .Default(System.Void)
    };
    .Label
        $target
    .LabelTarget #Label1:
} 
```

}

与以下 c# 代码具有相同含义的内容：

```
(source, flags, initializers) =>
{
    if(source == null)
        return null;

    if(initializers.ContainsKey(typeof(List<int>))
        target = (List<int>)initializers[typeof(List<int>)].Invoke((object)source);
    else
        target = new List<int>();

    if((flags & CloningFlags.Properties) == CloningFlags.Properties)
    {
        target.Capacity = target.Capacity.GetClone(flags, initializers);
    }

    if((flags & CloningFlags.CollectionItems) == CloningFlags.CollectionItems)
    {
        var targetCollection = (ICollection<int>)target;
        foreach(var item in (ICollection<int>)source)
        {
            targetCollection.Add(item.Clone(flags, initializers));
        }
    }

    return target;
} 
```

这不是很像您为自己编写`Clone`方法的方式`List<int>`吗？

* * *

## 回答 #9

> 赞同：35
> 
> 时间：2009-12-02T17:39:54.037

好吧，我在 Silverlight 中使用 ICloneable 时遇到了问题，但我喜欢序列化的想法，我可以序列化 XML，所以我这样做了：

```
static public class SerializeHelper
{
    //Michael White, Holly Springs Consulting, 2009
    //michael@hollyspringsconsulting.com
    public static T DeserializeXML<T>(string xmlData) 
        where T:new()
    {
        if (string.IsNullOrEmpty(xmlData))
            return default(T);

        TextReader tr = new StringReader(xmlData);
        T DocItms = new T();
        XmlSerializer xms = new XmlSerializer(DocItms.GetType());
        DocItms = (T)xms.Deserialize(tr);

        return DocItms == null ? default(T) : DocItms;
    }

    public static string SeralizeObjectToXML<T>(T xmlObject)
    {
        StringBuilder sbTR = new StringBuilder();
        XmlSerializer xmsTR = new XmlSerializer(xmlObject.GetType());
        XmlWriterSettings xwsTR = new XmlWriterSettings();

        XmlWriter xmwTR = XmlWriter.Create(sbTR, xwsTR);
        xmsTR.Serialize(xmwTR,xmlObject);

        return sbTR.ToString();
    }

    public static T CloneObject<T>(T objClone) 
        where T:new()
    {
        string GetString = SerializeHelper.SeralizeObjectToXML<T>(objClone);
        return SerializeHelper.DeserializeXML<T>(GetString);
    }
} 
```

* * *

## 回答 #10

> 赞同：34
> 
> 时间：2016-08-03T22:24:35.087

最好的方法是实现一个**扩展方法**，比如

```
public static T DeepClone<T>(this T originalObject)
{ /* the cloning code */ } 
```

然后在解决方案中的任何地方使用它

```
var copy = anyObject.DeepClone(); 
```

我们可以有以下三种实现：

1.  [**按序列化**](https://stackoverflow.com/a/129395/2094687)（最短代码）
2.  [**通过反射**](https://github.com/Burtsev-Alexey/net-object-deep-copy/)-**快 5 倍**
3.  [**通过表达式树**](http://www.codeproject.com/Articles/1111658/Fast-Deep-Copy-by-Expression-Trees-C-Sharp)-**快 20 倍**

所有链接的方法都运行良好，并经过深入测试。

* * *

## 回答 #11

> 赞同：26
> 
> 时间：2008-09-17T00:14:04.330

简短的回答是您从 ICloneable 接口继承，然后实现 .clone 函数。克隆应该进行成员复制并对任何需要它的成员执行深度复制，然后返回结果对象。这是一个递归操作（它要求您要克隆的类的所有成员都是值类型或实现 ICloneable，并且它们的成员是值类型或实现 ICloneable，等等）。

有关使用 ICloneable 进行克隆的更详细说明，请查看[这篇文章](https://web.archive.org/web/20120113123300/http://www.ondotnet.com/pub/a/dotnet/2002/11/25/copying.html)。

长*答案*是“这取决于”。正如其他人所提到的，ICloneable 不受泛型支持，需要对循环类引用进行特殊考虑，并且实际上被某些人视为 .NET Framework 中的[“错误”](http://blogs.msdn.com/brada/archive/2004/05/03/125427.aspx)。序列化方法取决于您的对象是可序列化的，它们可能不是并且您可能无法控制。社区中仍然存在很多关于哪种是“最佳”实践的争论。实际上，没有一个解决方案是一刀切的最佳实践，适用于 ICloneable 最初被解释为的所有情况。

有关更多选项，请参阅此[Developer's Corner 文章](http://developerscon.blogspot.com/2008/06/c-object-clone-wars.html)（感谢 Ian）。

* * *

## 回答 #12

> 赞同：25
> 
> 时间：2008-09-17T00:11:54.290

1.  基本上你需要实现ICloneable接口，然后实现对象结构复制。
2.  如果它是所有成员的深层副本，您需要确保（与您选择的解决方案无关）所有孩子也是可克隆的。
3.  有时您需要注意此过程中的一些限制，例如，如果您复制 ORM 对象，大多数框架只允许将一个对象附加到会话，并且您不得克隆该对象，或者您可能需要注意关于这些对象的会话附加。

干杯。

* * *

## 回答 #13

> 赞同：23
> 
> 时间：2019-07-08T10:28:39.597

## DeepCloner：解决克隆问题的快速、简单、有效的 NuGet 包

在阅读了所有答案后，我很惊讶没有人提到这个优秀的包：

[DeepCloner GitHub 项目](https://github.com/force-net/DeepCloner)

[DeepCloner NuGet 包](https://www.nuget.org/packages/DeepCloner)

详细说明它的 README，以下是我们在工作中选择它的原因：

> *   它可以深拷贝或浅拷贝
> *   在深度克隆中，所有对象图都被维护。
> *   在运行时使用代码生成，因为结果克隆非常快
> *   由内部结构复制的对象，没有调用方法或ctors
> *   您不需要以某种方式标记类（例如 Serializable-attribute 或实现接口）
> *   无需为克隆指定对象类型。对象可以转换为接口或抽象对象（例如，您可以将整数数组克隆为抽象数组或 IEnumerable；甚至可以克隆 null 而不会出现任何错误）
> *   克隆的对象没有任何能力确定他是克隆的（除了非常特定的方法）

### 用法：

```
var deepClone = new { Id = 1, Name = "222" }.DeepClone();
var shallowClone = new { Id = 1, Name = "222" }.ShallowClone(); 
```

### 表现：

自述文件包含各种克隆库和方法的性能比较：[DeepCloner Performance](https://github.com/force-net/DeepCloner#performance)。

### 要求：

*   *.NET 4.0 或更高版本或 .NET Standard 1.3 (.NET Core)*
*   *需要完全信任权限集或反射权限 (MemberAccess)*

* * *

## 回答 #14

> 赞同：20
> 
> 时间：2015-02-16T11:30:51.103

编辑：项目已停止

如果您想真正克隆到未知类型，可以查看 [fastclone](http://fastclone.codeplex.com/)。

这是基于表达式的克隆，其工作速度比二进制序列化快 10 倍，并保持完整的对象图完整性。

这意味着：如果您多次引用层次结构中的同一对象，则克隆也将引用单个实例。

不需要对被克隆的对象进行接口、属性或任何其他修改。

* * *

## 回答 #15

> 赞同：17
> 
> 时间：2016-05-28T11:02:49.390

保持简单并像其他人提到的那样使用[AutoMapper](http://automapper.org/)，它是一个简单的小库，可以将一个对象映射到另一个对象......要将一个对象复制到另一个具有相同类型的对象，您只需要三行代码：

```
MyType source = new MyType();
Mapper.CreateMap<MyType, MyType>();
MyType target = Mapper.Map<MyType, MyType>(source); 
```

目标对象现在是源对象的副本。不够简单？创建一个扩展方法以在您的解决方案中随处使用：

```
public static T Copy<T>(this T source)
{
    T copy = default(T);
    Mapper.CreateMap<T, T>();
    copy = Mapper.Map<T, T>(source);
    return copy;
} 
```

扩展方法可以使用如下：

```
MyType copy = source.Copy(); 
```

* * *

## 回答 #16

> 赞同：13
> 
> 时间：2008-09-17T00:09:02.177

一般来说，你实现ICloneable接口，自己实现Clone。C# 对象有一个内置的 MemberwiseClone 方法，该方法执行浅拷贝，可以帮助您处理所有原语。

对于深拷贝，它无法知道如何自动完成。

* * *

## 回答 #17

> 赞同：12
> 
> 时间：2009-09-30T09:51:49.673

我想出这个来克服[.NET](http://en.wikipedia.org/wiki/.NET_Framework)必须手动深拷贝 List<T> 的缺点。

我用这个：

```
static public IEnumerable<SpotPlacement> CloneList(List<SpotPlacement> spotPlacements)
{
    foreach (SpotPlacement sp in spotPlacements)
    {
        yield return (SpotPlacement)sp.Clone();
    }
} 
```

在另一个地方：

```
public object Clone()
{
    OrderItem newOrderItem = new OrderItem();
    ...
    newOrderItem._exactPlacements.AddRange(SpotPlacement.CloneList(_exactPlacements));
    ...
    return newOrderItem;
} 
```

我试图想出一个可以做到这一点的oneliner，但这是不可能的，因为 yield 在匿名方法块中不起作用。

更好的是，使用通用 List<T> 克隆器：

```
class Utility<T> where T : ICloneable
{
    static public IEnumerable<T> CloneList(List<T> tl)
    {
        foreach (T t in tl)
        {
            yield return (T)t.Clone();
        }
    }
} 
```

* * *

## 回答 #18

> 赞同：11
> 
> 时间：2015-07-04T17:24:47.000

### 问：为什么我会选择这个答案？

*   如果您想要 .NET 能够提供的最快速度，请选择此答案。
*   如果您想要一种非常非常简单的克隆方法，请忽略此答案。

换句话说，[除非您有需要修复的性能瓶颈，否则请选择另一个答案，并且您可以使用 profiler 来证明它](http://c2.com/cgi/wiki?PrematureOptimization)。

### 比其他方法快 10 倍

以下执行深度克隆的方法是：

*   比涉及序列化/反序列化的任何东西快 10 倍；
*   非常接近 .NET 能够达到的理论最大速度。

### 而且方法...

为了获得终极速度，您可以使用**Nested MemberwiseClone 进行深度复制**。它与复制值结构的速度几乎相同，并且比（a）反射或（b）序列化（如本页其他答案中所述）快得多。

请注意，**如果**您使用**Nested MemberwiseClone 进行深层复制**，则必须为类中的每个嵌套级别手动实现一个 ShallowCopy，以及一个调用所有所述 ShallowCopy 方法的 DeepCopy 来创建一个完整的克隆。这很简单：总共只有几行，请参见下面的演示代码。

以下是显示 100,000 个克隆的相对性能差异的代码输出：

*   嵌套结构上的嵌套 MemberwiseClone 需要 1.08 秒
*   嵌套类上的嵌套 MemberwiseClone 为 4.77 秒
*   序列化/反序列化 39.93 秒

在类上使用 Nested MemberwiseClone 几乎与复制结构一样快，并且复制结构非常接近 .NET 能够达到的理论最大速度。

```
Demo 1 of shallow and deep copy, using classes and MemberwiseClone:
  Create Bob
    Bob.Age=30, Bob.Purchase.Description=Lamborghini
  Clone Bob >> BobsSon
  Adjust BobsSon details
    BobsSon.Age=2, BobsSon.Purchase.Description=Toy car
  Proof of deep copy: If BobsSon is a true clone, then adjusting BobsSon details will not affect Bob:
    Bob.Age=30, Bob.Purchase.Description=Lamborghini
  Elapsed time: 00:00:04.7795670,30000000

Demo 2 of shallow and deep copy, using structs and value copying:
  Create Bob
    Bob.Age=30, Bob.Purchase.Description=Lamborghini
  Clone Bob >> BobsSon
  Adjust BobsSon details:
    BobsSon.Age=2, BobsSon.Purchase.Description=Toy car
  Proof of deep copy: If BobsSon is a true clone, then adjusting BobsSon details will not affect Bob:
    Bob.Age=30, Bob.Purchase.Description=Lamborghini
  Elapsed time: 00:00:01.0875454,30000000

Demo 3 of deep copy, using class and serialize/deserialize:
  Elapsed time: 00:00:39.9339425,30000000 
```

要了解如何使用 MemberwiseCopy 进行深度复制，以下是用于生成上述时间的演示项目：

```
// Nested MemberwiseClone example. 
// Added to demo how to deep copy a reference class.
[Serializable] // Not required if using MemberwiseClone, only used for speed comparison using serialization.
public class Person
{
    public Person(int age, string description)
    {
        this.Age = age;
        this.Purchase.Description = description;
    }
    [Serializable] // Not required if using MemberwiseClone
    public class PurchaseType
    {
        public string Description;
        public PurchaseType ShallowCopy()
        {
            return (PurchaseType)this.MemberwiseClone();
        }
    }
    public PurchaseType Purchase = new PurchaseType();
    public int Age;
    // Add this if using nested MemberwiseClone.
    // This is a class, which is a reference type, so cloning is more difficult.
    public Person ShallowCopy()
    {
        return (Person)this.MemberwiseClone();
    }
    // Add this if using nested MemberwiseClone.
    // This is a class, which is a reference type, so cloning is more difficult.
    public Person DeepCopy()
    {
            // Clone the root ...
        Person other = (Person) this.MemberwiseClone();
            // ... then clone the nested class.
        other.Purchase = this.Purchase.ShallowCopy();
        return other;
    }
}
// Added to demo how to copy a value struct (this is easy - a deep copy happens by default)
public struct PersonStruct
{
    public PersonStruct(int age, string description)
    {
        this.Age = age;
        this.Purchase.Description = description;
    }
    public struct PurchaseType
    {
        public string Description;
    }
    public PurchaseType Purchase;
    public int Age;
    // This is a struct, which is a value type, so everything is a clone by default.
    public PersonStruct ShallowCopy()
    {
        return (PersonStruct)this;
    }
    // This is a struct, which is a value type, so everything is a clone by default.
    public PersonStruct DeepCopy()
    {
        return (PersonStruct)this;
    }
}
// Added only for a speed comparison.
public class MyDeepCopy
{
    public static T DeepCopy<T>(T obj)
    {
        object result = null;
        using (var ms = new MemoryStream())
        {
            var formatter = new BinaryFormatter();
            formatter.Serialize(ms, obj);
            ms.Position = 0;
            result = (T)formatter.Deserialize(ms);
            ms.Close();
        }
        return (T)result;
    }
} 
```

然后，从 main 调用演示：

```
void MyMain(string[] args)
{
    {
        Console.Write("Demo 1 of shallow and deep copy, using classes and MemberwiseCopy:\n");
        var Bob = new Person(30, "Lamborghini");
        Console.Write("  Create Bob\n");
        Console.Write("    Bob.Age={0}, Bob.Purchase.Description={1}\n", Bob.Age, Bob.Purchase.Description);
        Console.Write("  Clone Bob >> BobsSon\n");
        var BobsSon = Bob.DeepCopy();
        Console.Write("  Adjust BobsSon details\n");
        BobsSon.Age = 2;
        BobsSon.Purchase.Description = "Toy car";
        Console.Write("    BobsSon.Age={0}, BobsSon.Purchase.Description={1}\n", BobsSon.Age, BobsSon.Purchase.Description);
        Console.Write("  Proof of deep copy: If BobsSon is a true clone, then adjusting BobsSon details will not affect Bob:\n");
        Console.Write("    Bob.Age={0}, Bob.Purchase.Description={1}\n", Bob.Age, Bob.Purchase.Description);
        Debug.Assert(Bob.Age == 30);
        Debug.Assert(Bob.Purchase.Description == "Lamborghini");
        var sw = new Stopwatch();
        sw.Start();
        int total = 0;
        for (int i = 0; i < 100000; i++)
        {
            var n = Bob.DeepCopy();
            total += n.Age;
        }
        Console.Write("  Elapsed time: {0},{1}\n\n", sw.Elapsed, total);
    }
    {               
        Console.Write("Demo 2 of shallow and deep copy, using structs:\n");
        var Bob = new PersonStruct(30, "Lamborghini");
        Console.Write("  Create Bob\n");
        Console.Write("    Bob.Age={0}, Bob.Purchase.Description={1}\n", Bob.Age, Bob.Purchase.Description);
        Console.Write("  Clone Bob >> BobsSon\n");
        var BobsSon = Bob.DeepCopy();
        Console.Write("  Adjust BobsSon details:\n");
        BobsSon.Age = 2;
        BobsSon.Purchase.Description = "Toy car";
        Console.Write("    BobsSon.Age={0}, BobsSon.Purchase.Description={1}\n", BobsSon.Age, BobsSon.Purchase.Description);
        Console.Write("  Proof of deep copy: If BobsSon is a true clone, then adjusting BobsSon details will not affect Bob:\n");
        Console.Write("    Bob.Age={0}, Bob.Purchase.Description={1}\n", Bob.Age, Bob.Purchase.Description);                
        Debug.Assert(Bob.Age == 30);
        Debug.Assert(Bob.Purchase.Description == "Lamborghini");
        var sw = new Stopwatch();
        sw.Start();
        int total = 0;
        for (int i = 0; i < 100000; i++)
        {
            var n = Bob.DeepCopy();
            total += n.Age;
        }
        Console.Write("  Elapsed time: {0},{1}\n\n", sw.Elapsed, total);
    }
    {
        Console.Write("Demo 3 of deep copy, using class and serialize/deserialize:\n");
        int total = 0;
        var sw = new Stopwatch();
        sw.Start();
        var Bob = new Person(30, "Lamborghini");
        for (int i = 0; i < 100000; i++)
        {
            var BobsSon = MyDeepCopy.DeepCopy<Person>(Bob);
            total += BobsSon.Age;
        }
        Console.Write("  Elapsed time: {0},{1}\n", sw.Elapsed, total);
    }
    Console.ReadKey();
} 
```

再次注意，**如果**您使用**Nested MemberwiseClone 进行深层复制**，则必须为类中的每个嵌套级别手动实现 ShallowCopy，以及调用所有所述 ShallowCopy 方法的 DeepCopy 来创建完整的克隆。这很简单：总共只有几行代码，请参见上面的演示代码。

### 值类型与引用类型

**请注意，在克隆对象时，“结构**”和“**类**”之间存在很大差异：

*   如果你有一个“**结构**”，它是一个**值类型**，所以你可以复制它，并且内容将被克隆（但它只会进行浅克隆，除非你使用本文中的技术）。
*   如果你有一个“**类**”，它是一个**引用类型**，所以如果你复制它，你所做的就是复制指向它的指针。要创建真正的克隆，您必须更具创造性，并利用[值类型和引用类型之间的差异，](https://msdn.microsoft.com/en-us/library/system.object.memberwiseclone(v=vs.110).aspx)从而在内存中创建原始对象的另一个副本。

查看[值类型和引用类型之间的差异](https://msdn.microsoft.com/en-us/library/system.object.memberwiseclone(v=vs.110).aspx)。

### 有助于调试的校验和

*   不正确地克隆对象会导致非常难以确定的错误。在生产代码中，我倾向于实施校验和来仔细检查对象是否已正确克隆，并且没有被另一个引用损坏。此校验和可以在发布模式下关闭。
*   我发现这种方法非常有用：通常，您只想克隆对象的一部分，而不是整个对象。

### 对于将许多线程与许多其他线程解耦非常有用

此代码的一个极好的用例是将嵌套类或结构的克隆提供给队列，以实现生产者/消费者模式。

*   我们可以让一个（或多个）线程修改他们拥有的类，然后将这个类的完整副本推送到`ConcurrentQueue`.
*   然后我们有一个（或多个）线程将这些类的副本拉出并处理它们。

这在实践中非常有效，并且允许我们将许多线程（生产者）与一个或多个线程（消费者）分离。

而且这种方法也快得惊人：如果我们使用嵌套结构，它比序列化/反序列化嵌套类快 35 倍，并且允许我们利用机器上所有可用的线程。

# 更新

显然，ExpressMapper 与上述手动编码一样快，甚至更快。我可能需要看看他们如何与分析器进行比较。

* * *

## 回答 #19

> 赞同：10
> 
> 时间：2019-07-30T20:49:06.300

*免责声明：我是上述软件包的作者。*

我很惊讶 2019 年这个问题的最佳答案仍然使用序列化或反射。

## 序列化是有限制的（需要属性、特定的构造函数等）并且非常慢

`BinaryFormatter`需要`Serializable`属性，`JsonConverter`需要无参数的构造函数或属性，都不能很好地处理只读字段或接口，并且两者都比必要的慢 10-30 倍。

## 表达式树

您可以改为使用*Expression Trees*或*Reflection.Emit*只生成一次克隆代码，然后使用该编译代码而不是慢反射或序列化。

我自己遇到了这个问题并且没有看到令人满意的解决方案，我决定创建一个包，它可以做到这一点并且**适用于每种类型，并且几乎与自定义编写的代码一样快**。

您可以在 GitHub 上找到该项目：[https ://github.com/marcelltoth/ObjectCloner](https://github.com/marcelltoth/ObjectCloner)

## 用法

您可以从 NuGet 安装它。获取`ObjectCloner`包并将其用作：

```
var clone = ObjectCloner.DeepClone(original); 
```

或者，如果您不介意使用扩展来污染您的对象类型，`ObjectCloner.Extensions`也可以编写：

```
var clone = original.DeepClone(); 
```

## 表现

克隆类层次结构的简单基准显示性能比使用 Reflection 快约 3 倍，比 Newtonsoft.Json 序列化快约 12 倍，比强烈建议的快约 36 倍`BinaryFormatter`。

* * *

## 回答 #20

> 赞同：9
> 
> 时间：2010-10-19T13:01:19.507

我也看到它是通过反射实现的。基本上有一种方法可以遍历对象的成员并将它们适当地复制到新对象。当它到达引用类型或集合时，我认为它对自身进行了递归调用。反射很昂贵，但效果很好。

* * *

## 回答 #21

> 赞同：9
> 
> 时间：2011-09-06T07:38:32.540

这是一个深拷贝实现：

```
public static object CloneObject(object opSource)
{
    //grab the type and create a new instance of that type
    Type opSourceType = opSource.GetType();
    object opTarget = CreateInstanceOfType(opSourceType);

    //grab the properties
    PropertyInfo[] opPropertyInfo = opSourceType.GetProperties(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance);

    //iterate over the properties and if it has a 'set' method assign it from the source TO the target
    foreach (PropertyInfo item in opPropertyInfo)
    {
        if (item.CanWrite)
        {
            //value types can simply be 'set'
            if (item.PropertyType.IsValueType || item.PropertyType.IsEnum || item.PropertyType.Equals(typeof(System.String)))
            {
                item.SetValue(opTarget, item.GetValue(opSource, null), null);
            }
            //object/complex types need to recursively call this method until the end of the tree is reached
            else
            {
                object opPropertyValue = item.GetValue(opSource, null);
                if (opPropertyValue == null)
                {
                    item.SetValue(opTarget, null, null);
                }
                else
                {
                    item.SetValue(opTarget, CloneObject(opPropertyValue), null);
                }
            }
        }
    }
    //return the new item
    return opTarget;
} 
```

* * *

## 回答 #22

> 赞同：9
> 
> 时间：2016-01-25T17:45:56.083

由于在不同项目中找不到满足我所有要求的克隆器，我创建了一个深度克隆器，可以配置和适应不同的代码结构，而不是调整我的代码以满足克隆器的要求。它是通过向应克隆的代码添加注释来实现的，或者您只需将代码保留为具有默认行为即可。它使用反射、类型缓存并基于[fastflect](https://fasterflect.codeplex.com/)。对于大量数据和高对象层次结构（与其他基于反射/序列化的算法相比），克隆过程非常快。

[https://github.com/kalisohn/CloneBehave](https://github.com/kalisohn/CloneBehave)

也可作为 nuget 包提供： [https ://www.nuget.org/packages/Clone.Behave/1.0.0](https://www.nuget.org/packages/Clone.Behave/1.0.0)

例如：下面的代码将 deepClone 地址，但只执行 _currentJob 字段的浅拷贝。

```
public class Person 
{
  [DeepClone(DeepCloneBehavior.Shallow)]
  private Job _currentJob;      

  public string Name { get; set; }

  public Job CurrentJob 
  { 
    get{ return _currentJob; }
    set{ _currentJob = value; }
  }

  public Person Manager { get; set; }
}

public class Address 
{      
  public Person PersonLivingHere { get; set; }
}

Address adr = new Address();
adr.PersonLivingHere = new Person("John");
adr.PersonLivingHere.BestFriend = new Person("James");
adr.PersonLivingHere.CurrentJob = new Job("Programmer");

Address adrClone = adr.Clone();

//RESULT
adr.PersonLivingHere == adrClone.PersonLivingHere //false
adr.PersonLivingHere.Manager == adrClone.PersonLivingHere.Manager //false
adr.PersonLivingHere.CurrentJob == adrClone.PersonLivingHere.CurrentJob //true
adr.PersonLivingHere.CurrentJob.AnyProperty == adrClone.PersonLivingHere.CurrentJob.AnyProperty //true 
```

* * *

## 回答 #23

> 赞同：9
> 
> 时间：2020-06-24T21:24:28.257

创建一个扩展：

```
public static T Clone<T>(this T theObject)
{
    string jsonData = JsonConvert.SerializeObject(theObject);
    return JsonConvert.DeserializeObject<T>(jsonData);
} 
```

并这样称呼它：

```
NewObject = OldObject.Clone(); 
```

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2016-06-09T20:56:50.757

# 代码生成器

从序列化到手动实现再到反射，我们已经看到了很多想法，我想提出一种使用[CGbR 代码生成器](https://github.com/Toxantron/CGbR#cloneable)的完全不同的方法。生成克隆方法具有内存和 CPU 效率，因此比标准 DataContractSerializer 快 300 倍。

您只需要一个部分类定义，`ICloneable`其余的由生成器完成：

```
public partial class Root : ICloneable
{
    public Root(int number)
    {
        _number = number;
    }
    private int _number;

    public Partial[] Partials { get; set; }

    public IList<ulong> Numbers { get; set; }

    public object Clone()
    {
        return Clone(true);
    }

    private Root()
    {
    }
} 

public partial class Root
{
    public Root Clone(bool deep)
    {
        var copy = new Root();
        // All value types can be simply copied
        copy._number = _number; 
        if (deep)
        {
            // In a deep clone the references are cloned 
            var tempPartials = new Partial[Partials.Length];
            for (var i = 0; i < Partials.Length; i++)
            {
                var value = Partials[i];
                value = value.Clone(true);
                tempPartials[i] = value;
            }
            copy.Partials = tempPartials;
            var tempNumbers = new List<ulong>(Numbers.Count);
            for (var i = 0; i < Numbers.Count; i++)
            {
                var value = Numbers[i];
                tempNumbers.Add(value);
            }
            copy.Numbers = tempNumbers;
        }
        else
        {
            // In a shallow clone only references are copied
            copy.Partials = Partials; 
            copy.Numbers = Numbers; 
        }
        return copy;
    }
} 
```

**注意：**最新版本有更多的空检查，但为了更好地理解，我将它们省略了。

* * *

## 回答 #25

> 赞同：7
> 
> 时间：2015-03-06T13:48:06.413

我喜欢这样的 Copyconstructors：

```
 public AnyObject(AnyObject anyObject)
    {
        foreach (var property in typeof(AnyObject).GetProperties())
        {
            property.SetValue(this, property.GetValue(anyObject));
        }
        foreach (var field in typeof(AnyObject).GetFields())
        {
            field.SetValue(this, field.GetValue(anyObject));
        }
    } 
```

如果您有更多要复制的内容，请添加

* * *

## 回答 #26

> 赞同：7
> 
> 时间：2016-04-12T13:43:36.730

这种方法为我解决了这个问题：

```
private static MyObj DeepCopy(MyObj source)
        {

            var DeserializeSettings = new JsonSerializerSettings { ObjectCreationHandling = ObjectCreationHandling.Replace };

            return JsonConvert.DeserializeObject<MyObj >(JsonConvert.SerializeObject(source), DeserializeSettings);

        } 
```

像这样使用它：`MyObj a = DeepCopy(b);`

* * *

## 回答 #27

> 赞同：7
> 
> 时间：2016-07-29T13:44:32.687

这是一个快速而简单的解决方案，它对我有用，而不需要序列化/反序列化。

```
public class MyClass
{
    public virtual MyClass DeepClone()
    {
        var returnObj = (MyClass)MemberwiseClone();
        var type = returnObj.GetType();
        var fieldInfoArray = type.GetRuntimeFields().ToArray();

        foreach (var fieldInfo in fieldInfoArray)
        {
            object sourceFieldValue = fieldInfo.GetValue(this);
            if (!(sourceFieldValue is MyClass))
            {
                continue;
            }

            var sourceObj = (MyClass)sourceFieldValue;
            var clonedObj = sourceObj.DeepClone();
            fieldInfo.SetValue(returnObj, clonedObj);
        }
        return returnObj;
    }
} 
```

**编辑**：需要

```
 using System.Linq;
    using System.Reflection; 
```

我就是这样用的

```
public MyClass Clone(MyClass theObjectIneededToClone)
{
    MyClass clonedObj = theObjectIneededToClone.DeepClone();
} 
```

* * *

## 回答 #28

> 赞同：6
> 
> 时间：2011-12-07T21:24:25.410

跟着这些步骤：

*   定义一个带有返回和`ISelf<T>`的只读`Self`属性，它派生自并包含一个方法。`T``ICloneable<out T>``ISelf<T>``T Clone()`
*   然后定义一个`CloneBase`实现对传入类型 的`protected virtual generic VirtualClone`强制转换的类型。`MemberwiseClone`
*   每个派生类型都应该`VirtualClone`通过调用基本克隆方法来实现，然后做任何需要做的事情来正确克隆父 VirtualClone 方法尚未处理的派生类型的那些方面。

为了最大程度地继承多功能性，公开公共克隆功能的类应该是`sealed`，但派生自一个基类，除了缺少克隆之外，该基类是相同的。与其传递显式可克隆类型的变量，不如采用 type 的参数`ICloneable<theNonCloneableType>`。这将允许期望 的可克隆衍生物 `Foo`与 的可克隆衍生物一起工作的例程`DerivedFoo`，但也允许创建 的不可克隆衍生物`Foo`。

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2018-11-16T06:40:43.460

由于这个问题的几乎所有答案都不令人满意或显然不适用于我的情况，因此我编写了[AnyClone](https://github.com/replaysMike/AnyClone)，它完全通过反射实现并解决了这里的所有需求。我无法让序列化在具有复杂结构的复杂场景中工作，并且`IClonable`不太理想 - 实际上它甚至没有必要。

`[IgnoreDataMember]`使用,支持标准忽略属性`[NonSerialized]`。支持复杂的集合、没有设置器的属性、只读字段等。

我希望它可以帮助遇到与我相同的问题的其他人。

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2014-04-11T16:06:55.463

我创建了一个可接受的答案版本，它适用于“[Serializable]”和“[DataContract]”。我写它已经有一段时间了，但如果我没记错的话 [DataContract] 需要一个不同的序列化程序。

需要*System、System.IO、System.Runtime.Serialization、System.Runtime.Serialization.Formatters.Binary、System.Xml*；

```
public static class ObjectCopier
{

    /// <summary>
    /// Perform a deep Copy of an object that is marked with '[Serializable]' or '[DataContract]'
    /// </summary>
    /// <typeparam name="T">The type of object being copied.</typeparam>
    /// <param name="source">The object instance to copy.</param>
    /// <returns>The copied object.</returns>
    public static T Clone<T>(T source)
    {
        if (typeof(T).IsSerializable == true)
        {
            return CloneUsingSerializable<T>(source);
        }

        if (IsDataContract(typeof(T)) == true)
        {
            return CloneUsingDataContracts<T>(source);
        }

        throw new ArgumentException("The type must be Serializable or use DataContracts.", "source");
    }

    /// <summary>
    /// Perform a deep Copy of an object that is marked with '[Serializable]'
    /// </summary>
    /// <remarks>
    /// Found on http://stackoverflow.com/questions/78536/cloning-objects-in-c-sharp
    /// Uses code found on CodeProject, which allows free use in third party apps
    /// - http://www.codeproject.com/KB/tips/SerializedObjectCloner.aspx
    /// </remarks>
    /// <typeparam name="T">The type of object being copied.</typeparam>
    /// <param name="source">The object instance to copy.</param>
    /// <returns>The copied object.</returns>
    public static T CloneUsingSerializable<T>(T source)
    {
        if (!typeof(T).IsSerializable)
        {
            throw new ArgumentException("The type must be serializable.", "source");
        }

        // Don't serialize a null object, simply return the default for that object
        if (Object.ReferenceEquals(source, null))
        {
            return default(T);
        }

        IFormatter formatter = new BinaryFormatter();
        Stream stream = new MemoryStream();
        using (stream)
        {
            formatter.Serialize(stream, source);
            stream.Seek(0, SeekOrigin.Begin);
            return (T)formatter.Deserialize(stream);
        }
    }

    /// <summary>
    /// Perform a deep Copy of an object that is marked with '[DataContract]'
    /// </summary>
    /// <typeparam name="T">The type of object being copied.</typeparam>
    /// <param name="source">The object instance to copy.</param>
    /// <returns>The copied object.</returns>
    public static T CloneUsingDataContracts<T>(T source)
    {
        if (IsDataContract(typeof(T)) == false)
        {
            throw new ArgumentException("The type must be a data contract.", "source");
        }

        // ** Don't serialize a null object, simply return the default for that object
        if (Object.ReferenceEquals(source, null))
        {
            return default(T);
        }

        DataContractSerializer dcs = new DataContractSerializer(typeof(T));
        using(Stream stream = new MemoryStream())
        {
            using (XmlDictionaryWriter writer = XmlDictionaryWriter.CreateBinaryWriter(stream))
            {
                dcs.WriteObject(writer, source);
                writer.Flush();
                stream.Seek(0, SeekOrigin.Begin);
                using (XmlDictionaryReader reader = XmlDictionaryReader.CreateBinaryReader(stream, XmlDictionaryReaderQuotas.Max))
                {
                    return (T)dcs.ReadObject(reader);
                }
            }
        }
    }

    /// <summary>
    /// Helper function to check if a class is a [DataContract]
    /// </summary>
    /// <param name="type">The type of the object to check.</param>
    /// <returns>Boolean flag indicating if the class is a DataContract (true) or not (false) </returns>
    public static bool IsDataContract(Type type)
    {
        object[] attributes = type.GetCustomAttributes(typeof(DataContractAttribute), false);
        return attributes.Length == 1;
    }

} 
```

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2015-12-19T08:17:57.830

好的，这篇文章中有一些明显的反射示例，但是反射通常很慢，直到你开始正确缓存它。

如果你能正确缓存它，它会在 4.6 秒内深度克隆 1000000 个对象（由 Watcher 测量）。

```
static readonly Dictionary<Type, PropertyInfo[]> ProperyList = new Dictionary<Type, PropertyInfo[]>(); 
```

比您获取缓存属性或向字典添加新属性并简单地使用它们

```
foreach (var prop in propList)
{
        var value = prop.GetValue(source, null);   
        prop.SetValue(copyInstance, value, null);
} 
```

在另一个答案中查看我的帖子中的完整代码

[https://stackoverflow.com/a/34365709/4711853](https://stackoverflow.com/a/34365709/4711853)

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2016-08-19T16:47:21.490

我想你可以试试这个。

```
MyObject myObj = GetMyObj(); // Create and fill a new object
MyObject newObj = new MyObject(myObj); //DeepClone it 
```

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2014-04-25T09:39:22.053

要克隆您的类对象，您可以使用 Object.MemberwiseClone 方法，

只需将此功能添加到您的课程中：

```
public class yourClass
{
    // ...
    // ...

    public yourClass DeepCopy()
    {
        yourClass othercopy = (yourClass)this.MemberwiseClone();
        return othercopy;
    }
} 
```

然后要执行深度独立复制，只需调用 DeepCopy 方法：

```
yourClass newLine = oldLine.DeepCopy(); 
```

希望这可以帮助。

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2015-04-20T13:51:42.553

如果您的对象树是可序列化的，您也可以使用类似这样的东西

```
static public MyClass Clone(MyClass myClass)
{
    MyClass clone;
    XmlSerializer ser = new XmlSerializer(typeof(MyClass), _xmlAttributeOverrides);
    using (var ms = new MemoryStream())
    {
        ser.Serialize(ms, myClass);
        ms.Position = 0;
        clone = (MyClass)ser.Deserialize(ms);
    }
    return clone;
} 
```

请注意，此解决方案非常简单，但性能不如其他解决方案。

并确保如果类增长，仍然只会克隆那些字段，这些字段也会被序列化。

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2017-04-23T09:16:04.997

映射器执行深度复制。对于对象的每个成员，它都会创建一个新对象并分配其所有值。它在每个非原始内部成员上递归地工作。

我建议您使用最快、目前正在积极开发的产品之一。我建议 UltraMapper [https://github.com/maurosampietro/UltraMapper](https://github.com/maurosampietro/UltraMapper)

Nuget 包：[https ://www.nuget.org/packages/UltraMapper/](https://www.nuget.org/packages/UltraMapper/)

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2019-11-21T12:59:24.447

最短的方法但需要依赖：

```
using Newtonsoft.Json;
    public static T Clone<T>(T source) =>
        JsonConvert.DeserializeObject<T>(JsonConvert.SerializeObject(source)); 
```

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2021-08-05T09:24:14.843

C# 9.0 引入了`with`需要 a 的关键字`record`（感谢 Mark Nading）。这应该允许非常简单的对象克隆（如果需要，还可以进行变异），只需要很少的样板文件，但只能使用`record`.

您似乎无法通过将类放入泛型来克隆（按值）`record`；

```
using System;

public class Program
{
    public class Example
    {
        public string A { get; set; }
    }

    public record ClonerRecord<T>(T a)
    {
    }

    public static void Main()
    {
        var foo = new Example {A = "Hello World"};
        var bar = (new ClonerRecord<Example>(foo) with {}).a;
        foo.A = "Goodbye World :(";
        Console.WriteLine(bar.A);
    }
} 
```

这写“再见世界:(”-该字符串是通过引用复制的（不需要）[。https://dotnetfiddle.net/w3IJgG](https://dotnetfiddle.net/w3IJgG)

（令人难以置信的是，以上内容与`struct`! [https://dotnetfiddle.net/469NJv](https://dotnetfiddle.net/469NJv)一起正常工作）

但是克隆 a`record`似乎确实可以缩进，按值克隆。

```
using System;

public class Program
{
    public record Example
    {
        public string A { get; set; }
    }

    public static void Main()
    {
        var foo = new Example {A = "Hello World"};
        var bar = foo with {};
        foo.A = "Goodbye World :(";
        Console.WriteLine(bar.A);
    }
} 
```

这将返回“Hello World”，字符串是按值复制的！[https://dotnetfiddle.net/MCHGEL](https://dotnetfiddle.net/MCHGEL)

更多信息可以在博客文章中找到：

[https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/with-expression](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/with-expression)

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2015-04-24T19:39:19.410

使用 IClonable 接口可以花费多少精力是令人难以置信的——尤其是如果您有繁重的类层次结构。MemberwiseClone 的工作方式也有些奇怪——它甚至不能完全克隆普通的 List 类型的结构。

当然，序列化最有趣的困境是序列化反向引用——例如，你有父子关系的类层次结构。我怀疑二进制序列化程序在这种情况下能否为您提供帮助。（最终会出现递归循环+堆栈溢出）。

我有点喜欢这里提出的解决方案：[How do you do a deep copy of an object in .NET (C# 特别是)？](https://stackoverflow.com/questions/129389/how-do-you-do-a-deep-copy-an-object-in-net-c-specifically)

但是 - 它不支持列表，补充说支持，还考虑了重新养育。对于我已将该字段或属性设置为“父”的唯一规则，DeepClone 将忽略它。您可能想决定自己的反向引用规则 - 对于树层次结构，它可能是“左/右”等......

这是整个代码片段，包括测试代码：

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Reflection;
using System.Text;

namespace TestDeepClone
{
    class Program
    {
        static void Main(string[] args)
        {
            A a = new A();
            a.name = "main_A";
            a.b_list.Add(new B(a) { name = "b1" });
            a.b_list.Add(new B(a) { name = "b2" });

            A a2 = (A)a.DeepClone();
            a2.name = "second_A";

            // Perform re-parenting manually after deep copy.
            foreach( var b in a2.b_list )
                b.parent = a2;

            Debug.WriteLine("ok");

        }
    }

    public class A
    {
        public String name = "one";
        public List<String> list = new List<string>();
        public List<String> null_list;
        public List<B> b_list = new List<B>();
        private int private_pleaseCopyMeAsWell = 5;

        public override string ToString()
        {
            return "A(" + name + ")";
        }
    }

    public class B
    {
        public B() { }
        public B(A _parent) { parent = _parent; }
        public A parent;
        public String name = "two";
    }

    public static class ReflectionEx
    {
        public static Type GetUnderlyingType(this MemberInfo member)
        {
            Type type;
            switch (member.MemberType)
            {
                case MemberTypes.Field:
                    type = ((FieldInfo)member).FieldType;
                    break;
                case MemberTypes.Property:
                    type = ((PropertyInfo)member).PropertyType;
                    break;
                case MemberTypes.Event:
                    type = ((EventInfo)member).EventHandlerType;
                    break;
                default:
                    throw new ArgumentException("member must be if type FieldInfo, PropertyInfo or EventInfo", "member");
            }
            return Nullable.GetUnderlyingType(type) ?? type;
        }

        /// <summary>
        /// Gets fields and properties into one array.
        /// Order of properties / fields will be preserved in order of appearance in class / struct. (MetadataToken is used for sorting such cases)
        /// </summary>
        /// <param name="type">Type from which to get</param>
        /// <returns>array of fields and properties</returns>
        public static MemberInfo[] GetFieldsAndProperties(this Type type)
        {
            List<MemberInfo> fps = new List<MemberInfo>();
            fps.AddRange(type.GetFields());
            fps.AddRange(type.GetProperties());
            fps = fps.OrderBy(x => x.MetadataToken).ToList();
            return fps.ToArray();
        }

        public static object GetValue(this MemberInfo member, object target)
        {
            if (member is PropertyInfo)
            {
                return (member as PropertyInfo).GetValue(target, null);
            }
            else if (member is FieldInfo)
            {
                return (member as FieldInfo).GetValue(target);
            }
            else
            {
                throw new Exception("member must be either PropertyInfo or FieldInfo");
            }
        }

        public static void SetValue(this MemberInfo member, object target, object value)
        {
            if (member is PropertyInfo)
            {
                (member as PropertyInfo).SetValue(target, value, null);
            }
            else if (member is FieldInfo)
            {
                (member as FieldInfo).SetValue(target, value);
            }
            else
            {
                throw new Exception("destinationMember must be either PropertyInfo or FieldInfo");
            }
        }

        /// <summary>
        /// Deep clones specific object.
        /// Analogue can be found here: https://stackoverflow.com/questions/129389/how-do-you-do-a-deep-copy-an-object-in-net-c-specifically
        /// This is now improved version (list support added)
        /// </summary>
        /// <param name="obj">object to be cloned</param>
        /// <returns>full copy of object.</returns>
        public static object DeepClone(this object obj)
        {
            if (obj == null)
                return null;

            Type type = obj.GetType();

            if (obj is IList)
            {
                IList list = ((IList)obj);
                IList newlist = (IList)Activator.CreateInstance(obj.GetType(), list.Count);

                foreach (object elem in list)
                    newlist.Add(DeepClone(elem));

                return newlist;
            } //if

            if (type.IsValueType || type == typeof(string))
            {
                return obj;
            }
            else if (type.IsArray)
            {
                Type elementType = Type.GetType(type.FullName.Replace("[]", string.Empty));
                var array = obj as Array;
                Array copied = Array.CreateInstance(elementType, array.Length);

                for (int i = 0; i < array.Length; i++)
                    copied.SetValue(DeepClone(array.GetValue(i)), i);

                return Convert.ChangeType(copied, obj.GetType());
            }
            else if (type.IsClass)
            {
                object toret = Activator.CreateInstance(obj.GetType());

                MemberInfo[] fields = type.GetFieldsAndProperties();
                foreach (MemberInfo field in fields)
                {
                    // Don't clone parent back-reference classes. (Using special kind of naming 'parent' 
                    // to indicate child's parent class.
                    if (field.Name == "parent")
                    {
                        continue;
                    }

                    object fieldValue = field.GetValue(obj);

                    if (fieldValue == null)
                        continue;

                    field.SetValue(toret, DeepClone(fieldValue));
                }

                return toret;
            }
            else
            {
                // Don't know that type, don't know how to clone it.
                if (Debugger.IsAttached)
                    Debugger.Break();

                return null;
            }
        } //DeepClone
    }

} 
```

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2018-03-14T11:37:04.230

另一个 JSON.NET 答案。此版本适用于不实现 ISerializable 的类。

```
public static class Cloner
{
    public static T Clone<T>(T source)
    {
        if (ReferenceEquals(source, null))
            return default(T);

        var settings = new JsonSerializerSettings { ContractResolver = new ContractResolver() };

        return JsonConvert.DeserializeObject<T>(JsonConvert.SerializeObject(source, settings), settings);
    }

    class ContractResolver : DefaultContractResolver
    {
        protected override IList<JsonProperty> CreateProperties(Type type, MemberSerialization memberSerialization)
        {
            var props = type.GetProperties(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance)
                .Select(p => base.CreateProperty(p, memberSerialization))
                .Union(type.GetFields(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance)
                    .Select(f => base.CreateProperty(f, memberSerialization)))
                .ToList();
            props.ForEach(p => { p.Writable = true; p.Readable = true; });
            return props;
        }
    }
} 
```

* * *

## 回答 #40

> 赞同：2
> 
> 时间：2018-10-12T12:59:44.460

通用方法在技术上都是有效的，但我只是想添加我自己的注释，因为我们实际上很少需要真正的深度复制，我强烈反对在实际业务应用程序中使用通用深度复制，因为这样你可能会有很多对象被复制然后显式修改的地方，很容易丢失。

在大多数实际情况下，您还希望对复制过程进行尽可能精细的控制，因为您不仅与数据访问框架耦合，而且实际上复制的业务对象很少应该 100% 相同。想想ORM用来识别对象引用的示例referenceId，完整的深拷贝也会复制这个id，所以在内存中对象会有所不同，一旦你将它提交到数据存储区，它就会抱怨，所以你会无论如何都必须在复制后手动修改此属性，如果对象发生更改，您需要在所有使用通用深度复制的地方进行调整。

使用 ICloneable 扩展 @cregox 答案，实际上什么是深拷贝？它只是堆上新分配的对象，与原始对象相同，但占用不同的内存空间，因此，为什么不使用通用克隆器功能而不是创建一个新对象呢？

我个人在我的域对象上使用静态工厂方法的想法。

例子：

```
 public class Client
    {
        public string Name { get; set; }

        protected Client()
        {
        }

        public static Client Clone(Client copiedClient)
        {
            return new Client
            {
                Name = copiedClient.Name
            };
        }
    }

    public class Shop
    {
        public string Name { get; set; }

        public string Address { get; set; }

        public ICollection<Client> Clients { get; set; }

        public static Shop Clone(Shop copiedShop, string newAddress, ICollection<Client> clients)
        {
            var copiedClients = new List<Client>();
            foreach (var client in copiedShop.Clients)
            {
                copiedClients.Add(Client.Clone(client));
            }

            return new Shop
            {
                Name = copiedShop.Name,
                Address = newAddress,
                Clients = copiedClients
            };
        }
    } 
```

如果有人正在研究如何构建对象实例化同时保留对复制过程的完全控制，这是我个人非常成功的解决方案。受保护的构造函数也做到了这一点，其他开发人员被迫使用工厂方法，它提供了一个简洁的对象实例化单点，将构造逻辑封装在对象内部。如果需要，您还可以重载该方法并为不同的位置设置多个克隆逻辑。

* * *

## 回答 #41

> 赞同：2
> 
> 时间：2019-06-20T17:27:05.143

深度克隆是关于复制**状态**。对于`.net` **state**意味着**fields**。

假设有一个层次结构：

```
static class RandomHelper
{
    private static readonly Random random = new Random();

    public static int Next(int maxValue) => random.Next(maxValue);
}

class A
{
    private readonly int random = RandomHelper.Next(100);

    public override string ToString() => $"{typeof(A).Name}.{nameof(random)} = {random}";
}

class B : A
{
    private readonly int random = RandomHelper.Next(100);

    public override string ToString() => $"{typeof(B).Name}.{nameof(random)} = {random} {base.ToString()}";
}

class C : B
{
    private readonly int random = RandomHelper.Next(100);

    public override string ToString() => $"{typeof(C).Name}.{nameof(random)} = {random} {base.ToString()}";
} 
```

可以进行克隆：

```
static class DeepCloneExtension
{
    // consider instance fields, both public and non-public
    private static readonly BindingFlags bindingFlags =
        BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance;

    public static T DeepClone<T>(this T obj) where T : new()
    {
        var type = obj.GetType();
        var result = (T)Activator.CreateInstance(type);

        do
            // copy all fields
            foreach (var field in type.GetFields(bindingFlags))
                field.SetValue(result, field.GetValue(obj));
        // for every level of hierarchy
        while ((type = type.BaseType) != typeof(object));

        return result;
    }
} 
```

**演示1**：

```
Console.WriteLine(new C());
Console.WriteLine(new C());

var c = new C();
Console.WriteLine($"{Environment.NewLine}Image: {c}{Environment.NewLine}");

Console.WriteLine(new C());
Console.WriteLine(new C());

Console.WriteLine($"{Environment.NewLine}Clone: {c.DeepClone()}{Environment.NewLine}");

Console.WriteLine(new C());
Console.WriteLine(new C()); 
```

结果：

```
C.random = 92 B.random = 66 A.random = 71
C.random = 36 B.random = 64 A.random = 17

Image: C.random = 96 B.random = 18 A.random = 46

C.random = 60 B.random = 7 A.random = 37
C.random = 78 B.random = 11 A.random = 18

Clone: C.random = 96 B.random = 18 A.random = 46

C.random = 33 B.random = 63 A.random = 38
C.random = 4 B.random = 5 A.random = 79 
```

注意，所有新对象都有随机的`random`字段值，但`clone`完全匹配`image`

**演示2**：

```
class D
{
    public event EventHandler Event;
    public void RaiseEvent() => Event?.Invoke(this, EventArgs.Empty);
}

// ...

var image = new D();
Console.WriteLine($"Created obj #{image.GetHashCode()}");

image.Event += (sender, e) => Console.WriteLine($"Event from obj #{sender.GetHashCode()}");
Console.WriteLine($"Subscribed to event of obj #{image.GetHashCode()}");

image.RaiseEvent();
image.RaiseEvent();

var clone = image.DeepClone();
Console.WriteLine($"obj #{image.GetHashCode()} cloned to obj #{clone.GetHashCode()}");

clone.RaiseEvent();
image.RaiseEvent(); 
```

结果：

```
Created obj #46104728
Subscribed to event of obj #46104728
Event from obj #46104728
Event from obj #46104728
obj #46104728 cloned to obj #12289376
Event from obj #12289376
Event from obj #46104728 
```

注意，事件支持字段也被复制，客户端也订阅了克隆的事件。

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2013-08-08T10:29:14.127

这会将一个对象的所有可读和可写属性复制到另一个对象。

```
 public class PropertyCopy<TSource, TTarget> 
                        where TSource: class, new()
                        where TTarget: class, new()
        {
            public static TTarget Copy(TSource src, TTarget trg, params string[] properties)
            {
                if (src==null) return trg;
                if (trg == null) trg = new TTarget();
                var fulllist = src.GetType().GetProperties().Where(c => c.CanWrite && c.CanRead).ToList();
                if (properties != null && properties.Count() > 0)
                    fulllist = fulllist.Where(c => properties.Contains(c.Name)).ToList();
                if (fulllist == null || fulllist.Count() == 0) return trg;

                fulllist.ForEach(c =>
                    {
                        c.SetValue(trg, c.GetValue(src));
                    });

                return trg;
            }
        } 
```

这就是你使用它的方式：

```
 var cloned = Utils.PropertyCopy<TKTicket, TKTicket>.Copy(_tmp, dbsave,
                                                            "Creation",
                                                            "Description",
                                                            "IdTicketStatus",
                                                            "IdUserCreated",
                                                            "IdUserInCharge",
                                                            "IdUserRequested",
                                                            "IsUniqueTicketGenerated",
                                                            "LastEdit",
                                                            "Subject",
                                                            "UniqeTicketRequestId",
                                                            "Visibility"); 
```

或复制所有内容：

```
var cloned = Utils.PropertyCopy<TKTicket, TKTicket>.Copy(_tmp, dbsave); 
```

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2014-04-13T12:53:53.060

在一个基本上应该调用自动复制构造函数的方法中进行重铸怎么样

```
T t = new T();
T t2 = (T)t;  //eh something like that

        List<myclass> cloneum;
        public void SomeFuncB(ref List<myclass> _mylist)
        {
            cloneum = new List<myclass>();
            cloneum = (List < myclass >) _mylist;
            cloneum.Add(new myclass(3));
            _mylist = new List<myclass>();
        } 
```

似乎对我有用

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2015-08-22T11:36:20.867

当使用 Marc Gravells protobuf-net 作为序列化程序时，接受的答案需要稍作修改，因为要复制的对象不会被赋予属性`[Serializable]`，因此不可序列化，并且克隆方法将引发异常。
我修改它以使用 protobuf-net：

```
public static T Clone<T>(this T source)
{
    if(Attribute.GetCustomAttribute(typeof(T), typeof(ProtoBuf.ProtoContractAttribute))
           == null)
    {
        throw new ArgumentException("Type has no ProtoContract!", "source");
    }

    if(Object.ReferenceEquals(source, null))
    {
        return default(T);
    }

    IFormatter formatter = ProtoBuf.Serializer.CreateFormatter<T>();
    using (Stream stream = new MemoryStream())
    {
        formatter.Serialize(stream, source);
        stream.Seek(0, SeekOrigin.Begin);
        return (T)formatter.Deserialize(stream);
    }
} 
```

这将检查`[ProtoContract]`属性的存在并使用 protobufs 自己的格式化程序来序列化对象。

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2017-08-08T00:44:46.197

我找到了一种新的方法，那就是 Emit。

我们可以使用 Emit 将 IL 添加到应用程序并运行它。但我不认为这是一个好方法，因为我想完善我写下我的答案。

Emit可以看[官方文档](https://msdn.microsoft.com/en-us/library/system.reflection.emit(v=vs.110).aspx)和[Guide](http://www.c-sharpcorner.com/uploadfile/puranindia/reflection-and-reflection-emit-in-C-Sharp/)

你应该学习一些 IL 来阅读代码。我将编写可以在类中复制属性的代码。

```
public static class Clone
{        
    // ReSharper disable once InconsistentNaming
    public static void CloneObjectWithIL<T>(T source, T los)
    {
        //see http://lindexi.oschina.io/lindexi/post/C-%E4%BD%BF%E7%94%A8Emit%E6%B7%B1%E5%85%8B%E9%9A%86/
        if (CachedIl.ContainsKey(typeof(T)))
        {
            ((Action<T, T>) CachedIl[typeof(T)])(source, los);
            return;
        }
        var dynamicMethod = new DynamicMethod("Clone", null, new[] { typeof(T), typeof(T) });
        ILGenerator generator = dynamicMethod.GetILGenerator();

        foreach (var temp in typeof(T).GetProperties().Where(temp => temp.CanRead && temp.CanWrite))
        {
            //do not copy static that will except
            if (temp.GetAccessors(true)[0].IsStatic)
            {
                continue;
            }

            generator.Emit(OpCodes.Ldarg_1);// los
            generator.Emit(OpCodes.Ldarg_0);// s
            generator.Emit(OpCodes.Callvirt, temp.GetMethod);
            generator.Emit(OpCodes.Callvirt, temp.SetMethod);
        }
        generator.Emit(OpCodes.Ret);
        var clone = (Action<T, T>) dynamicMethod.CreateDelegate(typeof(Action<T, T>));
        CachedIl[typeof(T)] = clone;
        clone(source, los);
    }

    private static Dictionary<Type, Delegate> CachedIl { set; get; } = new Dictionary<Type, Delegate>();
} 
```

代码可以是深拷贝，但它可以复制属性。如果你想把它变成深拷贝，你可以改变它，因为 IL 太难了，我做不到。

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2018-05-03T08:18:56.750

C# 扩展也将支持“not **ISerializable** ”类型。

```
 public static class AppExtensions
 {                                                                      
       public static T DeepClone<T>(this T a)
       {
           using (var stream = new MemoryStream())
           {
               var serializer = new System.Xml.Serialization.XmlSerializer(typeof(T));

               serializer.Serialize(stream, a);
               stream.Position = 0;
               return (T)serializer.Deserialize(stream);
           }
       }                                                                    
 } 
```

用法

```
 var obj2 = obj1.DeepClone() 
```

* * *

## 回答 #47

> 赞同：1
> 
> 时间：2019-06-28T11:19:13.677

使用`System.Text.Json`：

[https://devblogs.microsoft.com/dotnet/try-the-new-system-text-json-apis/](https://devblogs.microsoft.com/dotnet/try-the-new-system-text-json-apis/)

```
public static T DeepCopy<T>(this T source)
{
    return source == null ? default : JsonSerializer.Parse<T>(JsonSerializer.ToString(source));
} 
```

新的 API 正在使用`Span<T>`. 这应该很快，做一些基准测试会很好。

**注意：**在 Json.NET 中不需要`ObjectCreationHandling.Replace`like，因为它会默认替换集合值。您现在应该忘记 Json.NET，因为一切都将被新的官方 API 取代。

我不确定这是否适用于私有字段。

* * *

## 回答 #48

> 赞同：1
> 
> 时间：2021-09-16T15:31:37.833

我对当前答案做了一些基准测试，发现了一些有趣的事实。

使用 BinarySerializer => [https://stackoverflow.com/a/78612/6338072](https://stackoverflow.com/a/78612/6338072)

使用 XmlSerializer => [https://stackoverflow.com/a/50150204/6338072](https://stackoverflow.com/a/50150204/6338072)

使用 Activator.CreateInstance => [https://stackoverflow.com/a/56691124/6338072](https://stackoverflow.com/a/56691124/6338072)

这些是结果

```
BenchmarkDotNet=v0.13.1, OS=Windows 10.0.18363.1734 (1909/November2019Update/19H2) 
```

Intel Core i5-6200U CPU 2.30GHz (Skylake)，1 个 CPU，4 个逻辑和 2 个物理核心 [主机]：.NET Framework 4.8 (4.8.4400.0)，X86 LegacyJIT DefaultJob：.NET Framework 4.8 (4.8.4400.0)，X86旧版 JIT

| 方法 | 意思是 | 错误 | 标准差 | 0代 | 已分配 |
| --- | --- | --- | --- | --- | --- |
| 二进制序列化器 | 220.69 美元 | 4.374 我们 | 9.963 我们 | 49.8047 | 77 KB |
| XmlSerializer | 182.72 我们 | 3.619 我们 | 9.405 我们 | 21.9727 | 34 KB |
| 激活器.CreateInstance | 49.99 美元 | 0.992 我们 | 2.861 我们 | 1.9531 | 3 KB |

* * *

## 回答 #49

> 赞同：1
> 
> 时间：2022-01-28T19:25:28.810

我将使用以下简单的方法来实现这一点。只需创建一个抽象类并实现方法以再次序列化和反序列化并返回。

```
public abstract class CloneablePrototype<T>
{
    public T DeepCopy()
    {
        string result = JsonConvert.SerializeObject(this);
        return JsonConvert.DeserializeObject<T>(result);
    }
}
public class YourClass : CloneablePrototype< YourClass>
…
…
… 
```

并像这样使用它来创建深层副本。

```
YourClass newObj = (YourClass)oldObj.DeepCopy(); 
```

如果您还需要实现浅拷贝方法，此解决方案也很容易扩展。

只需在抽象类中实现一个新方法。

```
public T ShallowCopy()
{
    return (T)this.MemberwiseClone();
} 
```

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2020-05-23T17:48:45.083

对于克隆过程，可以先将对象转换为字节数组，然后再转换回对象。

```
public static class Extentions
{
    public static T Clone<T>(this T obj)
    {
        byte[] buffer = BinarySerialize(obj);
        return (T)BinaryDeserialize(buffer);
    }

    public static byte[] BinarySerialize(object obj)
    {
        using (var stream = new MemoryStream())
        {
            var formatter = new BinaryFormatter(); 
            formatter.Serialize(stream, obj); 
            return stream.ToArray();
        }
    }

    public static object BinaryDeserialize(byte[] buffer)
    {
        using (var stream = new MemoryStream(buffer))
        {
           var formatter = new BinaryFormatter(); 
           return formatter.Deserialize(stream);
        }
    }
} 
```

该对象必须为序列化过程进行序列化。

```
[Serializable]
public class MyObject
{
    public string Name  { get; set; }
} 
```

用法：

```
MyObject myObj  = GetMyObj();
MyObject newObj = myObj.Clone(); 
```

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2021-03-08T22:32:45.757

@Konrad 和 @craastad 的补充，使用内置`System.Text.Json`for`.NET >5`

[https://docs.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-how-to?pivots=dotnet-5-0](https://docs.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-how-to?pivots=dotnet-5-0)

方法：

```
public static T Clone<T>(T source)
{
    var serialized = JsonSerializer.Serialize(source);
    return JsonSerializer.Deserialize<T>(serialized);
} 
```

扩展方法：

```
public static class SystemExtension
{
    public static T Clone<T>(this T source)
    {
        var serialized = JsonSerializer.Serialize(source);
        return JsonSerializer.Deserialize<T>(serialized);
    }
} 
```

* * *

## 回答 #52

> 赞同：-1
> 
> 时间：2021-05-05T14:09:20.487

使用 System.Text.Json；

```
public static class CloneExtensions
{
    public static T Clone<T>(this T cloneable) where T : new()
    {
        var toJson = JsonSerializer.Serialize(cloneable);
        return JsonSerializer.Deserialize<T>(toJson);
    }
} 
```

* * *

## 回答 #53

> 赞同：-1
> 
> 时间：2021-10-06T19:37:39.450

`DeepCloner`找到了这个包，与它相比，它似乎更快，并且没有依赖关系。

[https://github.com/AlenToma/FastDeepCloner](https://github.com/AlenToma/FastDeepCloner)

* * *

## 回答 #54

> 赞同：-3
> 
> 时间：2017-02-01T19:30:00.147

我知道这个问题和[答案](https://stackoverflow.com/a/78612/1842492)在这里停留了一段时间，以下不是完全答案，而是观察，我最近在检查是否确实没有克隆私人时遇到了这个问题（如果我没有，我就不会是我自己;) 当我愉快地复制粘贴@johnc[更新的答案](https://stackoverflow.com/a/78612/1842492)时。

我只是做了自己的扩展方法（这几乎是上述答案的复制粘贴形式）：

```
public static class CloneThroughJsonExtension
{
    private static readonly JsonSerializerSettings DeserializeSettings = new JsonSerializerSettings { ObjectCreationHandling = ObjectCreationHandling.Replace };

    public static T CloneThroughJson<T>(this T source)
    {
        return ReferenceEquals(source, null) ? default(T) : JsonConvert.DeserializeObject<T>(JsonConvert.SerializeObject(source), DeserializeSettings);
    }
} 
```

并像这样天真地放弃了课程（实际上还有更多，但它们无关）：

```
public class WhatTheHeck
{
    public string PrivateSet { get; private set; } // matches ctor param name

    public string GetOnly { get; } // matches ctor param name

    private readonly string _indirectField;
    public string Indirect => $"Inception of: {_indirectField} "; // matches ctor param name
    public string RealIndirectFieldVaule => _indirectField;

    public WhatTheHeck(string privateSet, string getOnly, string indirect)
    {
        PrivateSet = privateSet;
        GetOnly = getOnly;
        _indirectField = indirect;
    }
} 
```

和这样的代码：

```
var clone = new WhatTheHeck("Private-Set-Prop cloned!", "Get-Only-Prop cloned!", "Indirect-Field clonned!").CloneThroughJson();
Console.WriteLine($"1\. {clone.PrivateSet}");
Console.WriteLine($"2\. {clone.GetOnly}");
Console.WriteLine($"3.1\. {clone.Indirect}");
Console.WriteLine($"3.2\. {clone.RealIndirectFieldVaule}"); 
```

导致：

```
1\. Private-Set-Prop cloned!
2\. Get-Only-Prop cloned!
3.1\. Inception of: Inception of: Indirect-Field cloned!
3.2\. Inception of: Indirect-Field cloned! 
```

我整个人都想：这到底是什么……所以我抓住了 Newtonsoft.Json Github 回购并开始挖掘。结果是：在反序列化恰好只有一个 ctor 且其参数名称匹配（[不区分大小写](https://github.com/JamesNK/Newtonsoft.Json/blob/cf6a917a46b532558578c53d34cdc4f39ec0560a/Src/Newtonsoft.Json/Serialization/JsonPropertyCollection.cs#L126)）公共属性名称的类型时，它们将作为这些参数传递给 ctor。可以在[此处](https://github.com/JamesNK/Newtonsoft.Json/blob/744be1a712ee0e0bbc264b800368a7b7f5026884/Src/Newtonsoft.Json/Serialization/DefaultContractResolver.cs#L606)和[此处](https://github.com/JamesNK/Newtonsoft.Json/blob/744be1a712ee0e0bbc264b800368a7b7f5026884/Src/Newtonsoft.Json/Serialization/DefaultContractResolver.cs#L309)的代码中找到一些线索。

**底线**

我知道这并不常见，示例代码有点滥用，但是，嘿！当我检查灌木丛中是否有龙等着跳出来咬我的屁股时，这让我大吃一惊。;)

# c# - 在 ASP.NET MVC 中将数据传递到母版页

> ID：78548
> 
> 赞同：103
> 
> 时间：2008-09-17T00:08:39.663
> 
> 标签：c#, .net, asp.net, asp.net-mvc

您在不违反 MVC 规则的情况下将数据传递到母版页（使用 ASP.NET MVC）的方式是什么？

就个人而言，我更喜欢编写抽象控制器（基本控制器）或传递给所有视图的基类。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-04-14T01:33:07.737

如果您希望您的视图具有强类型视图数据类，这可能对您有用。其他解决方案可能更*正确*，但恕我直言，这是设计和实用性之间的一个很好的平衡。

母版页采用强类型视图数据类，仅包含与其相关的信息：

```
public class MasterViewData
{
    public ICollection<string> Navigation { get; set; }
} 
```

使用该母版页的每个视图都采用强类型视图数据类，其中包含其信息并派生自母版页视图数据：

```
public class IndexViewData : MasterViewData
{
    public string Name { get; set; }
    public float Price { get; set; }
} 
```

由于我不希望各个控制器知道有关将母版页数据放在一起的任何信息，因此我将该逻辑封装到传递给每个控制器的工厂中：

```
public interface IViewDataFactory
{
    T Create<T>()
        where T : MasterViewData, new()
}

public class ProductController : Controller
{
    public ProductController(IViewDataFactory viewDataFactory)
    ...

    public ActionResult Index()
    {
        var viewData = viewDataFactory.Create<ProductViewData>();

        viewData.Name = "My product";
        viewData.Price = 9.95;

        return View("Index", viewData);
    }
} 
```

继承很好地匹配主视图关系，但是在渲染部分/用户控件时，我会将他们的视图数据组合到页面视图数据中，例如

```
public class IndexViewData : MasterViewData
{
    public string Name { get; set; }
    public float Price { get; set; }
    public SubViewData SubViewData { get; set; }
}

<% Html.RenderPartial("Sub", Model.SubViewData); %> 
```

*这只是示例代码，并不打算按原样编译。专为 ASP.Net MVC 1.0 设计。*

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2010-08-09T21:48:08.820

我更喜欢将主视图的数据驱动部分分解为部分并使用**Html.RenderAction**呈现它们。与流行的视图模型继承方法相比，这具有几个明显的优势：

1.  主视图数据与“常规”视图模型完全分离。这是组合而不是继承，并导致更松散耦合的系统更容易更改。
2.  主视图模型由完全独立的控制器操作构建。“常规”操作不需要担心这一点，也不需要视图数据工厂，这对我的口味来说似乎过于复杂。
3.  如果您碰巧使用[AutoMapper](http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/01/22/automapper-the-object-object-mapper.aspx)之类的工具将您的域映射到您的视图模型，您会发现配置起来更容易，因为当您的视图模型不继承主视图数据时，它们将更接近于您的域模型。
4.  使用针对主数据的单独操作方法，您可以轻松地将输出缓存应用到页面的某些区域。通常，主视图包含的数据更改频率低于主页内容。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-06-04T06:26:58.863

**编辑**

[通用错误](https://stackoverflow.com/users/40944/generic-error)在下面提供了更好的答案。请阅读！

**原始答案**

[微软实际上已经发布了一个关于“官方”方式](http://www.asp.net/LEARN/mvc/tutorial-13-cs.aspx)来处理这个问题的条目。这提供了一步一步的演练，并解释了他们的推理。

简而言之，他们建议使用抽象控制器类，但请自行查看。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-17T00:12:41.573

抽象控制器是个好主意，我还没有找到更好的方法。我也很想看看其他人做了什么。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-17T00:15:18.527

我做了一些研究，发现了这两个网站。也许他们可以提供帮助。

[ASP.NET MVC 技巧 #31 – 将数据传递给母版页和用户控件](http://stephenwalther.com/blog/archive/2008/08/12/asp-net-mvc-tip-31-passing-data-to-master-pages-and-user-controls.aspx)

[使用 ASP.NET MVC 将数据传递到母版页](http://geekswithblogs.net/scarpenter/archive/2007/12/14/117724.aspx)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-17T00:27:34.657

我发现传递给视图的所有模型对象的共同父对象非常有用。

无论如何，页面之间总会有一些共同的模型属性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T00:12:56.223

Request.Params 对象是可变的。作为请求处理周期的一部分，向其添加标量值非常容易。从视图的角度来看，该信息可能已在 QueryString 或 FORM POST 中提供。hth

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T00:19:25.740

我认为另一种好方法可能是使用某些属性（例如某些接口的 ParentView）为视图创建接口，因此您可以将它用于需要引用页面（父控件）的控件和应从其访问的主视图意见。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-30T05:28:38.703

其他解决方案缺乏优雅且耗时太长。我为几乎整整一年后做了这件非常悲伤和贫困的事情而道歉：

```
<script runat="server" type="text/C#">
    protected override void OnLoad(EventArgs e)
    {
        base.OnLoad(e);
        MasterModel = SiteMasterViewData.Get(this.Context);
    }

    protected SiteMasterViewData MasterModel;
</script> 
```

很明显，我在 SiteMasterViewData 上有这个静态方法 Get()，它返回 SiteMasterViewData。

# sql-server-2005 - 锁定的 SQL Server 数据文件

> ID：78560
> 
> 赞同：3
> 
> 时间：2008-09-17T00:10:52.077
> 
> 标签：sql-server-2005

我有一个 SQL Server 数据库，其中数据和日志文件存储在外部 USB 驱动器上。当我不在办公室时，我在办公室的主要开发机器和笔记本电脑之间切换外部驱动器。在台式机和笔记本电脑之间移动时，我正在尝试使用 sp_detach_db 和 sp_attach_db。我发现这在桌面上可以正常工作 - 我可以毫无问题地分离和重新连接数据库。但是在笔记本电脑上我无法重新附加数据库（数据库实际上最初是在笔记本电脑上创建的，并且第一次分离发生在那里）。当我尝试重新连接笔记本电脑时，出现以下错误：

无法打开物理文件“p:\SQLData\AppManager.mdf”。操作系统错误 5：“5（未找到错误）”

我发现很多对这个错误的引用都表明这是一个权限问题。所以我沿着这条路走，并确保 SQL Server 服务帐户具有适当的权限。我还在同一路径上创建了一个新数据库，并且能够成功地分离和重新连接它。所以我相信权限不是问题。

进一步调查显示，我无法重命名、复制或移动数据文件，因为 Windows 认为它​​们已锁定 - 即使 SQL Server 服务已停止。Process Explorer 不会显示任何锁定文件的进程。

如何找出锁定文件的原因并解锁它们。

我已经验证数据库没有出现在 SSMS 中 - 所以 SQL Server 仍然认为它们不存在。

**2008 年 9 月 18 日更新**

迄今为止，我已经尝试了所有建议的答案，但都没有成功。然而，尝试这些建议有助于澄清情况。我可以验证以下内容：

1.  只有当外部驱动器连接到数据库副本恢复到的服务器时，我才能成功分离和重新连接数据库 - 实际上是“创建”数据库的服务器 - 让我们称之为“源服务器”。
2.  在分离数据库后，我可以移动、复制或重命名数据和日志文件，而外部驱动器仍连接到源服务器。
3.  一旦我将外部驱动器移动到另一台机器上，数据和日志文件就会被“锁定”，尽管我尝试过的 2 个工具 - Process Explorer 和 Unlocker，都没有找到附加到文件的锁定句柄。

注意。分离数据库后，我尝试在移动外部驱动器之前停止 SQL Server 服务并关闭源服务器 - 仍然没有成功。

所以在这个阶段，我在台式机和笔记本电脑之间移动数据所能做的就是将数据备份到外部驱动器上，移动外部驱动器，从备份中恢复数据。工作正常，但需要更多时间，因为数据库大小合理（1gb）。无论如何，这是我现阶段唯一的选择，即使我试图避免走这条路。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-17T05:48:23.533

听起来很疯狂，您是否尝试通过右键单击/属性/安全性手动授予文件权限？我认为 SQL Server 2005 会将分离文件的权限专门设置给进行分离的主体（可能是您的帐户，也可能是运行 SQL Server 服务的帐户），并且没有其他人可以操作该文件。为了解决这个问题，我必须在移动或删除它们之前手动授予自己对 MDF 和 LDF 文件的文件权限。另请参阅 onupdatecascade.com 上的博客文章

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T00:22:11.393

可以复制文件吗？我很想知道您是否可以将文件复制到您的笔记本电脑，然后将它们附加到那里。我猜这也是某种权限错误，但听起来您已经完成了解决此问题的工作。

文件上是否有任何属性？

更新：如果您无法复制文件，那么一定是某些东西锁定了它们。我会检查[Unlocker](http://www.emptyloop.com/unlocker/)，我没有尝试过，但听起来是一个很好的起点。您也可以尝试在文件权限下取得文件的所有权。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T00:15:36.823

当您在 Enterprise Manager 或 SSMS 中时，您能看到您正在谈论的数据库的名称吗？可能有一个处于时髦状态的剩余数据库。我会确保您在安全的地方有一份 mdf 的备份或副本。如果是这种情况，也许尝试删除数据库然后重新附加它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T00:22:15.543

我会尝试在桌面上备份数据库，然后看看它是否会在笔记本电脑上成功恢​​复。没有解释你的问题，但至少你可以继续前进。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T00:25:44.257

使用 /c 开关在调试模式下运行 sqlservr.exe，看看启动时会发生什么。任何锁定或权限问题都可以通过制作文件副本并将副本传输到原始文件来解决。

还要检查相关的日志文件 (.ldf) .. 如果该文件丢失或不可用，您将无法在不求助于紧急绕过模式的情况下将数据库挂载到任何健全/一致的状态。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-04-03T09:52:19.447

我有一个类似的问题。似乎没有什么可以解决它 - 甚至试图完全重新启动机器，重新启动 SQL 服务等。ProcMon 和 ProcessExplorer 没有显示任何内容，所以我认为 - “锁定”是由操作系统完成的。

**我通过删除文件并从安装在另一个驱动器号下的驱动器恢复它来解决它。**

PS。我的数据库文件不在 USB 驱动器上，而是在 TrueCrypt 驱动器上（在某些情况下，您也可以说它是“可移动驱动器”）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-26T06:40:49.493

这是文件级别安全性的安全问题-您已使用不同的凭据分离数据库并将其与其他凭据附加-只需浏览文章[http://www.sqlservermanagementstudio.net/2013/12/troubleshooting-with-attaching-and。 html](http://www.sqlservermanagementstudio.net/2013/12/troubleshooting-with-attaching-and.html) 并尝试将其复制粘贴到不同的位置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-29T22:49:19.627

在 SQL Server 配置管理器中，查看 SQL Server 服务。对于所有 SQL Server 实例，查看在“登录”选项卡 - 登录为：中选择了哪个帐户。例如，我发现将其更改为本地系统帐户可以解决您遇到的问题。这是唯一对我有用的东西——当然，不乏有同样问题的人。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-11-10T09:32:19.687

我通过授予系统管理员所有权限解决了类似的问题：

1.  右键单击>属性
2.  安全选项卡
3.  在`group or usernames`点击编辑。
4.  单击添加>高级
5.  单击`find now`以列出所有可用权限。
6.  选择管理员并将其添加到列表中。
7.  授予它具有完全权限。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2018-08-11T18:25:39.063

我遇到过同样的问题。有人分离了文件并离开了，我们无法将其移动到另一个驱动器。但是在获得文件的所有权（安全-->高级-->获得您的登录 ID 的所有权）之后，然后将您的登录 ID 添加到安全选项卡并授予对文件的访问权限，就可以移动了。

# html - 推荐哪个 JavaScript 库用于整洁的 UI 效果？

> ID：78570
> 
> 赞同：2
> 
> 时间：2008-09-17T00:12:09.500
> 
> 标签：html, javascript

我需要一个支持 Ajax 的 JavaScript 库，并帮助我在我正在处理[的网站中制作简单而整洁的动画效果。](http://www.voidy.com/)

你推荐哪个图书馆？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-17T00:12:48.500

我绝对会推荐 JQuery 作为最容易使用并且需要您编写最少代码的一种。[http://jquery.com/](http://jquery.com/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T00:13:53.553

[http://script.aculo.us/](http://script.aculo.us/)

我认为它符合您的“整洁的动画效果”要求。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T00:15:37.323

这是一个相当广泛的问题，一些顶级开源堆栈是 - [YUI](http://developer.yahoo.com/yui/) (Yahoo) - Prototype with [Scriptaculuous](http://script.aculo.us/) - [ExtJs](http://extjs.com/) - [Dojo](http://dojotoolkit.org/)

这是一个非常个人化的选择，取决于代码风格、外观和感觉，以及您更喜欢哪一个。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T00:46:59.777

看看 Dojo/Dijit/Dojox ( [http://dojotoolkit.org](http://dojotoolkit.org) )。它们有很多很酷的特殊效果，还有很多对任何使用 Javascript 的人都会派上用场的东西。

他们还将文档和相关文章保存在[http://dojocampus.org/](http://dojocampus.org/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T02:47:52.480

我非常喜欢 ExtJS。它是一个很棒的库，用于使用 javascript 开发复杂的接口。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-17T00:13:54.160

我一直在玩[Scriptaculous](http://script.aculo.us/)和[jQuery](http://jquery.com/)。两者都很好，尽管我更倾向于 jQuery。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T02:44:15.377

我是[YUI](http://developer.yahoo.com/yui/)的粉丝。它支持[动画](http://developer.yahoo.com/yui/animation/)和[Ajax](http://developer.yahoo.com/yui/connection/)。

此外，还有大量的控件：菜单、可移动窗口、树形控件、滑块、选项卡视图，不胜枚举。我使用了他们的代码，并且在[跨浏览器](http://developer.yahoo.com/yui/articles/gbs/)方面有很好的体验。并不让我感到惊讶。他们对工具包进行了广泛的测试。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-17T02:59:00.580

如果这很重要，Stack Overflow 会使用 jQuery。Scriptaculous 非常努力地做您在 Flash 中可以做的所有事情。Dojo 有一个 SVG 抽象，可以让您执行 JavaScript 不直接支持的事情。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-17T05:16:41.903

就个人而言，我是[MooTools](http://www.mootools.net)动画类（[Fx.Tween](http://docs.mootools.net/Fx/Fx.Tween)、[Fx.Morph](http://docs.mootools.net/Fx/Fx.Morph)、[Fx.Transitions](http://docs.mootools.net/Fx/Fx.Transitions)）的粉丝。非常直接且易于使用。对于更高级的动画 Fx.Slide、Fx.Scroll 和 Fx.Elements 也可用...

它还有一个简洁的 Ajax 类 (Request)，可以满足您所有的 ajax 需求。

显然，尽管这是我个人的意见......任何大的（Yahoo UI、jQuery、MooTools、Prototype 等......）都能够同时执行 Ajax 和动画，所以我建议查看所有示例代码那些图书馆，选择你最喜欢的！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-17T15:47:36.880

[Spry](http://labs.adobe.com/technologies/spry/articles/data_api/index.html)有很多看起来比较容易使用的效果。

Spry 的缺点（优点？）是它的包装。它被分成许多单独的部分和部分。

因此，如果您想使用大量 Spry，您要么对外部 javascript 文件进行多次调用，要么自行将它们粘合在一起。Spry 不会为你整齐地做这件事（就像 YUI 做的那样）。

但是，如果您只想使用单个组件或效果，Spry 非常轻量级！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-17T00:16:13.530

1.  如果你想实现一些基本的动画 jQuery 是可以的。
2.  我个人也喜欢prototype.js
3.  对于更困难的事情，我们使用 Microsoft AJAX 客户端库的一些功能

# palm-os - 在 Palm OS 上创建日历事件

> ID：78586
> 
> 赞同：2
> 
> 时间：2008-09-17T00:13:56.593
> 
> 标签：palm-os, garnet-os

我已经在谷歌上搜索了一段时间，但不知道如何在更新的 Palm OS 设备上的日历中创建事件。关于如何做到这一点的任何想法？我猜我将在日历数据库中创建一条记录，但我不知道该记录中数据的格式以及将其放入哪个数据库。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-18T05:36:50.943

在 Palm 的后期设备中，他们转向了 PIM 应用程序（如联系人和日历）的扩展格式。这样做是为了更好地映射设备的数据库和 Microsoft Outlook 使用的数据库，但这意味着格式从原始 PIM 中的传统格式发生了变化。

Palm 有一个 PIM Access SDK，可从[Palm Developer Network 站点](https://pdnet.palm.com/)获得，其中包括用于访问这些数据库格式的代码。这些设备还支持使用影子版本的数据库和系统库来支持原始数据库，这些数据库将更改来回转换到影子。然而，影子数据库并不拥有扩展数据库所拥有的所有数据，并且转换并不总是被触发。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T00:19:59.247

好的，在我发布这个问题十秒钟后，我收到了一封来自 palm 开发者网络的电子邮件，它把我带到了我需要去的地方。令人沮丧。您似乎需要 PIM SDK，它可以通过 Palm Developer 网络获得 [。](https://dts.pdn.palm.com/cgi-bin/palmdev.cfg/php/enduser/std_adp.php?p_faqid=418&p_lva=1378&p_sid=zaz2d2ej&p_redirect=1)

# java - 与 Java Web 应用程序世界中的 RJS（用于 Ruby on Rails）类似吗？

> ID：78590
> 
> 赞同：2
> 
> 时间：2008-09-17T00:14:45.313
> 
> 标签：java, ruby-on-rails

在 Ruby on Rails 中，有 RJS 模板通过返回将在客户端浏览器中执行的 JavaScript 代码来帮助执行 AJAX。我怎样才能在 Java/J2EE 世界中做类似的事情？Google Widget Toolkit 是否类似于 RJS？我有什么选择？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T00:42:37.150

是的，我认为[Google Web Toolkit](http://code.google.com/webtoolkit/)是等效于 RJS 模板的 java。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T20:10:32.807

没有直接的等价物。如果您想在 java 中完成全部或大部分客户端，GWT 非常棒。另外值得一试的是[DWR](http://directwebremoting.org/)，它使您可以远程过程调用样式访问您的服务器代码。

# arrays - bash 中的 Perl 列表有什么好的等价物？

> ID：78592
> 
> 赞同：24
> 
> 时间：2008-09-17T00:15:13.847
> 
> 标签：arrays, bash

在 perl 中，只需执行以下操作来存储和迭代名称列表

```
my @fruit = (apple, orange, kiwi);
foreach (@fruit) {
        print $_;
} 
```

bash 中的等价物是什么？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-17T00:21:22.567

bash（与 POSIX sh 不同）支持数组：

```
fruits=(apple orange kiwi "dried mango")
for fruit in "${fruits[@]}"; do
  echo "${fruit}"
done 
```

这样做的好处是数组元素可能包含空格或 $IFS 的其他成员；只要它们作为单独的元素正确插入，它们就会以相同的方式被读出。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-17T00:16:42.127

像这样：

```
FRUITS="apple orange kiwi"
for FRUIT in $FRUITS; do
  echo $FRUIT
done 
```

请注意，如果水果名称中有空格，这将不起作用。在这种情况下，请参阅[这个答案](https://stackoverflow.com/questions/78592/what-is-a-good-equivalent-to-perl-lists-in-bash#78631)，它的便携性稍差，但更健壮。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-17T00:20:05.847

既然我喜欢的答案已被接受为正确答案，我现在将进入另一个话题：如何`IFS`为个人谋取利益。:-P

```
fruits="apple,orange,kiwifruit,dried mango"
(IFS=,
 for fruit in $fruits; do
     echo "$fruit"
 done) 
```

我将代码放在括号中，以便将`IFS`更改隔离到它自己的子流程中；因此，在括号部分的末尾，将`IFS`恢复为其旧值。:-)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-17T00:16:32.627

```
为我在苹果橙猕猴桃
做
  回声 $i
完毕

```

# iphone - 从 iPhone 上的应用程序到服务器的已验证通道

> ID：78599
> 
> 赞同：1
> 
> 时间：2008-09-17T00:16:27.710
> 
> 标签：iphone, http, security

我正在为 iPhone 开发一款游戏，并希望它能够将分数提交回服务器。很简单，但我希望验证分数实际上来自游戏。在出口条件下（事实上）禁止真正的加密货币，在安全/经过验证的渠道中获取信息的最佳方式是什么？

我所有的想法都回到了 RSA 风格的数字签名算法，但更喜欢不那么“加密”的东西来解决这个导出问题。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T00:23:55.557

难道您不能只使用客户端证书（由您签名）并与您的服务器建立 HTTPS 连接，该服务器已配置为仅接受以您签名的客户端证书开始的连接？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T00:42:32.313

长话短说，您可以在几乎没有限制的情况下导出数字签名代码*。*要了解更多信息，[请从 BIS 出口常见问题解答开始](http://www.bis.doc.gov/exportlicensingqanda.htm)。

您可能想查看[EAR 742.15(b)3](http://www.access.gpo.gov/bis/ear/pdf/742.pdf)，其中涵盖了数字签名豁免。

当然，我不是律师，而且规则可能在去年发生了变化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-21T16:20:42.110

使用真正的加密货币实际上不会在这里给你买任何东西。您基本上与典型的 DRM 问题相反。在这种情况下，你想阻止人们解密内容，但他们必须解密才能观看，所以无论如何你都必须给他们密钥。

在您的情况下，您希望防止人们签署假分数，但他们必须能够签署真实分数，因此无论如何您都必须给他们密钥。

你需要做的就是确保你的计划需要更多的努力来破解而不是潜在的回报。由于我们谈论的是游戏排行榜，因此风险并不高。让使用 tcpdump 的人不会很快发现它，你应该没问题。如果您的服务器足够智能，可以检测到“实验”（来自一个来源的大量失败提交），那么您将比依赖任何加密算法更安全。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T08:03:54.490

一个可能足够好的想法：

*   令 Secret1、Secret2、Secret3 为任意随机字符串。
*   设 DeviceID 为 iPhone 的唯一设备 ID。
*   让 Hash(Foo + Bar) 表示我将 Foo 和 Bar 连接起来，然后计算一个哈希值。

然后：

1.  应用程序第一次与服务器对话时，它会请求一个 DevicePassword。iPhone 发送：DeviceID, Hash(DeviceID + Secret1)

2.  服务器使用 Secret1 来验证请求是否来自应用程序。如果是，它会生成一个 DevicePassword 并将 DeviceID 和 DevicePassword 之间的关联保存在服务器上。

3.  服务器回复：DevicePassword, Hash(DevicePassword + Secret2)

4.  该应用程序使用 Secret2 来验证密码是否来自服务器。如果是这样，它会保存它。

5.  要提交分数，iPhone 会发送：DeviceID、Score、Hash(Score + DevicePassword + Secret3)

6.  服务器使用 Secret3 和 DevicePassword 进行验证。

DevicePassword 的优点是每个设备实际上都有一个唯一的秘密，如果我不知道它会更难通过数据包嗅探提交的分数来确定秘密。

此外，在正常情况下，应用程序每次安装只应请求一次 DevicePassword，因此您可以轻松识别对 DevicePassword 的可疑请求，或者将其限制为每天一次。

免责声明：这个解决方案不在我的脑海中，所以我不能保证这个方案没有重大缺陷。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T00:36:20.393

生成一个随机的，相当长的东西，然后将分数添加到最后，可能是名称或其他静态的东西，然后 sha1/md5 它，并将两者都传递给服务器，验证随机散列是否等于散列.

事后思考：如果你想让逆向更难，那么将你的随机数乘以当天的数字表示（星期一=1，星期二=2，...）

# c - 在x86上将float转换为int的最快方法是什么

> ID：78619
> 
> 赞同：25
> 
> 时间：2008-09-17T00:20:06.423
> 
> 标签：c, optimization, x86, floating-point, assembly

您知道在 x86 CPU 上将浮点数转换为 int 的最快方法是什么。对于以下任意组合，最好在 C 或程序集中（可以在 C 中内联）：

*   32/64/80 位浮点数 -> 32/64 位整数

我正在寻找一些比让编译器更快的技术。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-17T00:34:40.867

这取决于您是否想要截断转换或舍入转换以及精度。默认情况下，当您从 float 转换为 int 时，C 将执行截断转换。有 FPU 指令可以做到这一点，但它不是 ANSI C 转换，使用它有很多注意事项（例如了解 FPU 舍入状态）。由于您的问题的答案非常复杂，并且取决于您尚未表达的一些变量，因此我推荐这篇关于该问题的文章：

[http://www.stereopsis.com/FPU.html](http://www.stereopsis.com/FPU.html)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-17T00:24:10.407

使用 SSE 的打包转换是迄今为止最快的方法，因为您可以在同一指令中转换多个值。 [ffmpeg](https://github.com/FFmpeg/FFmpeg)对此有很多汇编（主要用于将音频的解码输出转换为整数样本）；检查它的一些例子。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-23T07:19:57.773

普通 x86/x87 代码的一个常用技巧是强制浮点数的尾数部分表示 int。32 位版本如下。

64 位版本是类比的。上面发布的 Lua 版本速度更快，但依赖于将 double 截断为 32 位结果，因此需要将 x87 单元设置为双精度，并且无法适应 double 到 64 位 int 的转换。

这段代码的好处是它对于所有符合 IEEE 754 的平台都是完全可移植的，唯一的假设是浮点舍入模式设置为最近。注意：在它编译和工作的意义上是可移植的。x86 以外的平台通常不会从这种技术中受益多少，如果有的话。

```
static const float Snapper=3<<22;

union UFloatInt {
 int i;
 float f;
};

/** by Vlad Kaipetsky
portable assuming FP24 set to nearest rounding mode
efficient on x86 platform
*/
inline int toInt( float fval )
{
  Assert( fabs(fval)<=0x003fffff ); // only 23 bit values handled
  UFloatInt &fi = *(UFloatInt *)&fval;
  fi.f += Snapper;
  return ( (fi.i)&0x007fffff ) - 0x00400000;
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-17T00:27:00.557

在汇编中有一条指令可以将浮点数转换为 int：使用 FISTP 指令。它从浮点堆栈中弹出值，将其转换为整数，然后存储在指定的地址处。我认为不会有更快的方法（除非您使用我不熟悉的扩展指令集，如 MMX 或 SSE）。

另一条指令 FIST 将值留在 FP 堆栈上，但我不确定它是否适用于四字大小的目标。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-17T01:05:58.387

Lua 代码库有以下代码片段来执行此操作（请查看 www.lua.org 的 src/luaconf.h）。如果您找到（SO 找到）更快的方法，我相信他们会很兴奋。

哦，`lua_Number`是双倍的意思。:)

```
/*
@@ lua_number2int is a macro to convert lua_Number to int.
@@ lua_number2integer is a macro to convert lua_Number to lua_Integer.
** CHANGE them if you know a faster way to convert a lua_Number to
** int (with any rounding method and without throwing errors) in your
** system. In Pentium machines, a naive typecast from double to int
** in C is extremely slow, so any alternative is worth trying.
*/

/* On a Pentium, resort to a trick */
#if defined(LUA_NUMBER_DOUBLE) && !defined(LUA_ANSI) && !defined(__SSE2__) && \
    (defined(__i386) || defined (_M_IX86) || defined(__i386__))

/* On a Microsoft compiler, use assembler */
#if defined(_MSC_VER)

#define lua_number2int(i,d)   __asm fld d   __asm fistp i
#define lua_number2integer(i,n)     lua_number2int(i, n)

/* the next trick should work on any Pentium, but sometimes clashes
   with a DirectX idiosyncrasy */
#else

union luai_Cast { double l_d; long l_l; };
#define lua_number2int(i,d) \
  { volatile union luai_Cast u; u.l_d = (d) + 6755399441055744.0; (i) = u.l_l; }
#define lua_number2integer(i,n)     lua_number2int(i, n)

#endif

/* this option always works, but may be slow */
#else
#define lua_number2int(i,d) ((i)=(int)(d))
#define lua_number2integer(i,d) ((i)=(lua_Integer)(d))

#endif 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-15T11:34:23.703

如果您可以保证运行您的代码的 CPU 与 SSE3 兼容（即使 Pentium 5 也兼容 JBB），您可以允许编译器使用其 FISTTP 指令（即 gcc 的 -msse3）。它似乎在做应该一直做的事情：

[http://software.intel.com/en-us/articles/how-to-implement-the-fisttp-streaming-simd-extensions-3-instruction/](http://software.intel.com/en-us/articles/how-to-implement-the-fisttp-streaming-simd-extensions-3-instruction/)

请注意，FISTTP 与 FISTP 不同（存在问题，导致速度缓慢）。它是 SSE3 的一部分，但实际上是（唯一的）X87 方面的改进。

无论如何，其他然后 X86 CPU 可能会很好地进行转换。:)

[支持 SSE3 的处理器](http://en.wikipedia.org/wiki/SSE3#CPUs_with_SSE3)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2014-02-26T17:28:59.860

我假设需要截断，就像`i = (int)f`在“C”中写入一样。

如果你有 SSE3，你可以使用：

```
int convert(float x)
{
    int n;
    __asm {
        fld x
        fisttp n // the extra 't' means truncate
    }
    return n;
} 
```

或者，使用 SSE2（或在可能无法使用内联汇编的 x64 中），您可以使用几乎一样快：

```
#include <xmmintrin.h>
int convert(float x)
{
    return _mm_cvtt_ss2si(_mm_load_ss(&x)); // extra 't' means truncate
} 
```

在较旧的计算机上，可以选择手动设置舍入模式并使用普通`fistp`指令执行转换。这可能仅适用于浮点数组，否则必须注意不要使用任何会使编译器更改舍入模式的构造（例如强制转换）。它是这样完成的：

```
void Set_Trunc()
{
    // cw is a 16-bit register [_ _ _ ic rc1 rc0 pc1 pc0 iem _ pm um om zm dm im]
    __asm {
        push ax // use stack to store the control word
        fnstcw word ptr [esp]
        fwait // needed to make sure the control word is there
        mov ax, word ptr [esp] // or pop ax ...
        or ax, 0xc00 // set both rc bits (alternately "or ah, 0xc")
        mov word ptr [esp], ax // ... and push ax
        fldcw word ptr [esp]
        pop ax
    }
}

void convertArray(int *dest, const float *src, int n)
{
    Set_Trunc();
    __asm {
        mov eax, src
        mov edx, dest
        mov ecx, n // load loop variables

        cmp ecx, 0
        je bottom // handle zero-length arrays

    top:
        fld dword ptr [eax]
        fistp dword ptr [edx]
        loop top // decrement ecx, jump to top
    bottom:
    }
} 
```

请注意，内联程序集仅适用于 Microsoft 的 Visual Studio 编译器（可能还有 Borland），必须将其重写为 GNU 程序集才能使用 gcc 进行编译。但是，具有内在函数的 SSE2 解决方案应该非常便携。

其他舍入模式可以通过不同的 SSE2 内在函数或通过手动将 FPU 控制字设置为不同的舍入模式来实现。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-17T00:29:51.783

如果您真的关心这个速度，请确保您的编译器正在生成 FIST 指令。在 MSVC 中，您可以使用 /QIfist 执行此操作，[请参阅此 MSDN 概述](http://msdn.microsoft.com/en-us/library/6d9xx1d2.aspx)

您还可以考虑使用 SSE 内在函数为您完成工作，请参阅英特尔的这篇文章：http: [//softwarecommunity.intel.com/articles/eng/2076.htm](http://softwarecommunity.intel.com/articles/eng/2076.htm)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-06-01T15:32:43.827

由于 MS 将我们从 X64 中的内联汇编中分离出来并迫使我们使用内在函数，因此我查找了使用哪个。[MSDN doc](http://msdn.microsoft.com/en-us/library/shf1ys5b%28v=vs.90%29.aspx)给出`_mm_cvtsd_si64x`了一个例子。

该示例有效，但效率极低，使用 2 个双精度的未对齐负载，我们只需要一个负载，因此摆脱了额外的对齐要求。然后产生了很多不必要的加载和重新加载，但可以通过以下方式消除它们：

```
 #include <intrin.h>
 #pragma intrinsic(_mm_cvtsd_si64x)
 long long _inline double2int(const double &d)
 {
     return _mm_cvtsd_si64x(*(__m128d*)&d);
 } 
```

结果：

```
 i=double2int(d);
000000013F651085  cvtsd2si    rax,mmword ptr [rsp+38h]  
000000013F65108C  mov         qword ptr [rsp+28h],rax 
```

可以在没有内联汇编的情况下设置舍入模式，例如

```
 _control87(_RC_NEAR,_MCW_RC); 
```

默认情况下四舍五入（无论如何）。

我猜，是在每次调用时设置舍入模式还是假设它会被恢复（第三方库）的问题必须通过经验来回答。您将必须包括`float.h`for`_control87()`和相关的常量。

而且，不，这不适用于 32 位，所以请继续使用 FISTP 指令：

```
_asm fld d
_asm fistp i 
```

* * *

## 回答 #10

> 赞同：-8
> 
> 时间：2008-09-17T00:35:57.587

通常，您可以相信编译器是高效且正确的。为编译器中已经存在的东西滚动你自己的函数通常不会有任何收获。

# oracle - 完全用 PL/SQL 编写大型批处理程序是不是很愚蠢？

> ID：78626
> 
> 赞同：3
> 
> 时间：2008-09-17T00:21:09.697
> 
> 标签：oracle, plsql, batch-processing

我正在着手开发一个程序，该程序可能最自然地描述为对数据库表的一批计算，并将每月执行一次。所有输入都在 Oracle 数据库表中，所有输出都将在 Oracle 数据库表中。该程序应在未来许多年内保持可维护性。

将其实现为一系列存储过程似乎很简单，每个存储过程都执行合理的转换，例如根据某些业务规则在部门之间分配成本。然后我可以编写单元测试来检查每个转换的输出是否符合我的预期。

在 PL/SQL 中完成这一切是不是一个坏主意？您是否愿意使用典型的面向对象编程语言（例如 C#）进行大量的批量计算？使用以数据库为中心的编程语言（例如 PL/SQL）不是更有表现力吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-18T12:12:35.483

您描述了以下要求

a) 必须能够实现批处理 b) 结果必须是可维护的

我的回复：

1.  PL/SQL 旨在实现您所描述的。同样重要的是要注意 PL/SQL 中的效率在其他工具中是不可用的。存储过程语言将处理放在数据旁边——这是批处理应该放在的地方。
2.  用任何语言编写可维护性差的代码都很容易。

如上所述，您的实施将取决于可用的技能、适当的设计和对高质量流程的坚持。

为了提高效率，您的实施必须分批处理数据（分批选择和分批插入/更新）。OO 方法的危险在于它很容易被引导到逐行处理数据的设计。这种类型的方法包含不必要的开销，并且比以行批量处理数据的设计效率要低得多。

可以成功使用这两种方法。

马修·巴特勒

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-17T15:40:40.547

其他评论者需要注意的一点 - 问题是关于 PL/SQL，而不是关于 SQL。一些答案显然是关于 SQL，而不是 PL/SQL。PL/SQL 是一种功能齐全的数据库语言，而且它也很成熟。有一些不足之处，但对于发帖人想做的事情类型来说，还是很不错的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-17T00:28:57.527

不，这不一定是个坏主意。如果该解决方案对您来说似乎很简单，并且允许您测试和验证每个流程，那么它听起来可能是一个好主意。OO 平台对于大型数据集可能（尽管它们不一定是）不好，因为对象创建和开销会降低性能。

Oracle 在设计 PL/SQL 时就考虑到了像您这样的问题，如果企业对数据库和 PL/SQL 有足够的了解，这似乎是一个合理的解决方案。请记住大批量集，因为从 PL/SQL 到实际 SQL 引擎的每次调用都是上下文切换，因此应尽可能将单个记录进程批处理在一起以提高性能。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-17T03:15:50.043

只要确保你以某种方式记录它工作时发生的事情。否则你会有一个黑匣子，如果它卡在某个地方几个小时，你会想知道是停止它还是让它“多工作一点”。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-17T23:37:38.467

PL/SQL 是一门成熟的语言，可以很好地与 SQL 集成。随着 Oracle 的每个版本，它变得越来越强大。同样从 Oracle 11 开始，PL/SQL 默认编译为机器码。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-17T00:24:25.260

通常我会说尽可能少地使用 PL/SQL——它通常更难维护——在我最后的工作之一中，我真的看到了使用它会变得多么混乱和困难。

然而，由于它是批处理——并且由于输入和输出都是数据库——将逻辑放入 PL/SQL 中是很有意义的——以最大限度地减少“移动部件”。但是，如果它是业务逻辑 - 或系统其他部分使用的组件 - 我会说不要这样做..

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-17T01:25:20.510

*我为一个项目用 PL/SQL 和 Pro C*编写了大量的批处理和报告生成程序。*他们通常更喜欢我用 PL/SQL 编写，因为他们自己的开发人员将来会维护，发现它比 Pro* C 代码更容易理解。

它最终只是最终用 Pro*C 编写的真正时髦的处理或报告。

没有必要像其他人提到的那样将这些编写为存储过程，它们可以只是根据需要运行的脚本文件，有点像 shell 脚本。使测试和生产系统之间的源代码修订控制和迁移变得容易得多。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-17T00:25:53.507

只要您需要执行的计算可以在 PL/SQL 中充分且可读地捕获，那么仅使用 PL/SQL 将是最有意义的。

真正的问题是可维护性——编写不可维护的 SQL 非常容易，因为一旦您跳出简单的 SQL DML，每个 RDBMS 都有不同的语法和不同的函数集，而且没有真正的格式化标准。评论等

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-17T00:37:25.057

我使用 C# 和 SQL 创建了批处理程序。

C#的优点：

*   您拥有完整的 .NET 库和 OO 语言的所有功能。

C# 的缺点：

*   批处理程序和数据库分开 - 这意味着，您必须将批处理程序与数据库分开管理。
*   您需要转义所有该死的 sql 代码

SQL的优点：

*   与 DBMS 很好地集成。如果这项工作只操作数据库，那么将它包含在数据库中是有意义的。您最终会在一个包中获得一个数据库及其所有组件。
*   无需转义sql代码
*   保持真实——你正在你的问题领域编程

SQL的缺点：

*   它的 SQL 和我个人对它的了解不如 C#。

一般来说，由于上述优点，我会坚持使用 SQL。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-17T00:35:54.013

这是一个加载的问题:) 您应该知道一些数据库编程架构设计，以及它们的成本/收益是什么。2 层通常意味着您有一个连接到数据库的客户端，发出直接 SQL 调用。3 层通常意味着您有一个“应用程序服务器”，它向数据库发出直接 SQL 调用，但客户端正在与应用程序服务器通信。通常，这提供了“横向扩展”。最后，您有 2 1/2 分层的应用程序，它们采用类似 2 层的格式，只有工作在存储过程中被划分。

您的流程听起来像是“后台”之类的东西，客户/流程只需要每月汇总和缓存一次的结果。也就是说，没有代理连接，并且经常连接，并说“做这些计算”。相反，你暗示了一个偶尔发生的过程，你可以摆脱非实时。

因此，考虑到这些要求，我会说，一般来说，靠近数据会更快，让 SQL Server 完成所有计算。我想你会发现接近数据会很好地为你服务。

但是，在执行这些计算时，您可能会发现某些计算不适用于 SQL Server。以计算债券或任何固定收益工具的应计利息为例。在 SQL 中不是很漂亮，更适合更丰富的编程语言。但是，如果您只有简单的平均值和其他相对健全的聚合，我会坚持使用 SQL 方面的存储过程。

再说一次，没有足够的信息来说明你的计算的性质，或者你的房子在开发人员的 SQL 能力方面要求什么支持，或者你的老板说什么......但是因为我知道我的 SQL 方法，并且喜欢靠近数据，我会为这样的任务保留纯 SQL/存储过程。

YMMV :)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-17T00:27:14.860

它通常不会更有表现力，因为大多数存储过程语言在设计上都很糟糕。但它可能会比在外部应用程序中运行得更快。

我想这可以归结为你对 PL/SQL 的熟悉程度，你需要多少时间来编写它，性能有多重要，以及你是否可以合理地期望维护人员对 PL/SQL 足够熟悉以维护一个用它。

如果速度无关紧要并且维护人员可能不精通 PL/SQL，那么使用“传统”语言可能会更好。

您还可以使用混合方法，使用 PL/SQL 生成中间数据（例如，表连接和总和或其他），并使用单独的应用程序来控制流并检查值和错误。

# math - 一个好的 3D 网格库

> ID：78641
> 
> 赞同：21
> 
> 时间：2008-09-17T00:23:28.490
> 
> 标签：math, graphics, 3d, mesh

我正在寻找一个好的 3D Mesh 库

*   应该能够阅读流行的格式（OFF，OBJ ...）
*   应该同时支持半边结构和三角汤
*   应该容忍故障和非法网格。
*   基本几何运算 - 交点、法线计算等
*   最重要的是 - 不应该与无尽的模板和继承层次结构复杂化。

我已经尝试过 CGAL 和 OpenMesh，但在最后一点都失败了。

特别是 CGAL，即使使用最先进的代码分析工具也无法遵循。

到目前为止，我正在认真考虑自己动手。

我的偏好是 C++，但我对其他选项持开放态度。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-17T00:51:08.563

请问为什么最后一点是要求？

为公共消费而编写的图书馆被设计为尽可能通用，以便尽可能广泛的受众使用。在 C++ 中，这通常最好使用模板来完成。如果找到一个好的库，它会非常糟糕，只是发现它对您的目的毫无用处，因为它使用浮点数而不是双精度数。

例如，CGAL 似乎采用了众所周知且经过充分测试的 STL 范式来编写通用和可扩展的 C++ 库。这确实使代码分析工具难以遵循；我怀疑他们也很擅长遵循 STL 标头。

但是您是在尝试使用该库还是对其进行修改？无论哪种方式，他们似乎都有一些非常高质量的文档（例如[Kernel Manual](http://www.cgal.org/Manual/3.3/doc_html/cgal_manual/Kernel_23/Chapter_main.html)），可以让您相对简单地弄清楚您需要做什么，而无需阅读他们的代码。

免责声明：我知道这不是您要的。但我认为你要找的东西不存在。很难找到具有与我通过 CGAL 扫描的一样好的文档的开源代码**。**我强烈建议你再看看它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T00:24:19.807

First, some general comments about you requirements:

*   reading OBJ or OFF files is very easy. You could implement it yourself, on top of a library providing the more geometric features, in a few minutes. On the other hand, the geometric part of such libraries is so much more tricky that you should certainly focus on your requirements which really deal with the geometric algorithms, and try to find something which suits your needs. Then, of course, if there is a tie, start considering this interface issue.
*   in terms of geometric operations, you ask for intersection. Do you mean primitives intersection ? (for which good and simple algorithms can be found and implemented) or computation of the intersection of two meshes ? or collision detection ? (which are delicate questions, with no simple answer)
*   if you are more specific, from a higher level point of view, about the kind of tools you want to build, then people will be able to direct you to the right tool. Your requirements are too low-level.

As far as I understand your question, it seems to me that you do not clearly see the point of libraries like CGAL and OpenMesh. Such libraries may not provide all the higher level tools you need, but their aim is to provide you (especially in the CGAL case) all the geometric framework upon which you can build a geometric application. Such geometric frameworks are very delicate to design, especially because of the robustness issue, which is very specific to computational geometry. And without such a framework, building a robust application is an horrendous effort.

If you do not find a library which suits your need, you should seriously consider using a library such as CGAL as the underlying framework for your development. It will prevent the appearance of the robustness related problems, that you will typically only start noticing late in your development process, when changing the underlying framework will be painful. As an aside, CGAL has an extensive documentation, and a very active users' mailing-list.

If you do not know about robustness issues in geometry software, have a look at this page: [robustness issues](http://www.mpi-inf.mpg.de/departments/d1/ClassroomExamples/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-13T18:28:30.740

我不知道它是否对你有用。还有另一个库，称为 Mangrove TDS 库，可在[http://mangrovetds.sourceforge.net](http://mangrovetds.sourceforge.net)免费获得它支持任何类型的形状（2d、3d、任何维度），具有任何域（流形、非流形、伪流形、iqm 复形、单纯复形等）。它可能支持不规则的形状，即由不同维度的块组成。

它的主要特性是它是可扩展的，即支持任何拓扑数据结构。它是一个插件，可以在运行时更改和加载。

它的实现基于基于数组的实体索引，编码在数据结构中，支持迭代器。它还支持动态属性。

最后，它支持未直接编码在数据结构中的实体（幽灵实体）的隐式表示，从而提高了拓扑查询的效率

# visual-studio - 如何在 VS2008 中启用 Platform Builder 模式

> ID：78669
> 
> 赞同：3
> 
> 时间：2008-09-17T00:30:29.830
> 
> 标签：visual-studio, visual-studio-2008, windows-mobile, smartphone, platform-builder

安装 VS2008、平台构建器 mod 和 WM7 aku 后，VS 通常会在首次启动时提示您使用默认模式。如果你犯了错误并选择了 PB7 以外的东西，你如何回到 PB 模式？

我可以获取设备窗口，但它始终是灰色的。我也可以配置我的正常连接设置，但 VS 永远不会连接到设备。

我有其他机器，我确实正确选择了默认选项。他们工作得很好。

我希望我不必重新安装所有东西。

合十礼，马克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T00:40:17.153

转到工具菜单并选择“导入和导出设置...”选项。然后在向导中选择“重置所有设置”。在下一个屏幕上，您可以保存当前设置。然后在最后一个屏幕上，它应该允许您选择要使用的设置集合。我没有平台构建器，但希望该选项应该出现在那里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T00:42:04.577

工具 > 导入和导出设置... X 重置所有设置（保存或不保存） 选择新设置。

# .net - Vista UAC、Access Elevation 和 .Net

> ID：78696
> 
> 赞同：5
> 
> 时间：2008-09-17T00:38:23.167
> 
> 标签：.net, uac, elevation

我试图找出是否有任何方法可以提升应用程序中的特定功能。例如，我有一个应用程序，其系统和用户设置存储在注册表中，我只需要在需要更改系统设置时进行提升。

不幸的是，我遇到的所有信息都在谈论只启动具有提升权限的新进程。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-18T15:02:58.180

不可能只提升一个功能或单个流程的任何其他部分，因为提升级别是每个流程的属性。就像怀孕一样，您的过程可以升高也可以不升高。如果您需要运行提升的代码的某些部分，则必须启动一个单独的进程。

但是，如果您可以将函数实现为 COM 对象，则可以通过创建提升的 COM 对象来间接提升它，如下所示：

```
HRESULT 
CreateElevatedComObject (HWND hwnd, REFGUID guid, REFIID iid, void **ppv)
{
    WCHAR monikerName[1024];
    WCHAR clsid[1024];
    BIND_OPTS3 bo;

    StringFromGUID2 (guid, clsid, sizeof (clsid) / 2);

    swprintf_s (monikerName, sizeof (monikerName) / 2, L"Elevation:Administrator!new:%s", clsid);

    memset (&bo, 0, sizeof (bo));
    bo.cbStruct = sizeof (bo);
    bo.hwnd = hwnd;
    bo.dwClassContext = CLSCTX_LOCAL_SERVER;

    // Prevent the GUI from being half-rendered when the UAC prompt "freezes" it
    MSG paintMsg;
    int MsgCounter = 5000;  // Avoid endless processing of paint messages
    while (PeekMessage (&paintMsg, hwnd, 0, 0, PM_REMOVE | PM_QS_PAINT) != 0 && --MsgCounter > 0)
    {
        DispatchMessage (&paintMsg);
    }

    return CoGetObject (monikerName, &bo, iid, ppv);
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-17T00:57:36.613

我看过的最好的文章是这篇：

[http://www.codeproject.com/KB/vista-security/UAC__The_Definitive_Guide.aspx](http://www.codeproject.com/KB/vista-security/UAC__The_Definitive_Guide.aspx)

它解释了当现有的 Microsoft 应用程序启动 UAC 提示时幕后发生的事情的本质，以及一些如何自己做的事情，或者至少你会知道你要面对什么来使它工作。 ..

（注意他展示的示例是托管 c++）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T00:47:24.923

在这里找到了[一篇很好的文章](http://msdn.microsoft.com/en-us/magazine/cc163486.aspx)：

> 大多数应用程序在运行时不需要管理员权限。如果您的应用程序在执行时不维护跨会话状态并且不执行修改本地安全策略之类的操作，那么使用标准用户令牌运行应该就可以了。有时您的应用程序的某些部分需要管理员权限，您应该将这些部分分离到一个单独的进程中。我稍后再谈。

看起来这篇文章是在谈论使用 C++，所以我找到[了另一篇文章](http://buildingsecurecode.blogspot.com/2007/06/how-to-display-uac-shield-icon-inside.html)，介绍了如何使用 P/Invoke 调用此代码。所以应该可以从.NET中实现。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-22T12:58:19.653

The Windows SDK "Cross Technology Samples" have a "UACDemo" application which shows examples of a C# Windows Forms application which launches an administrator process to perform a task which requires elevation (i.e. writing to `%programfiles%`).

This is a great starting point for writing your own functionality. I've extended this sample to use .Net Remoting and IPC to call between my normal user process and my elevated process which allows me to keep the elevation executable generic and implement application-specific code within the application.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T00:41:53.237

您真正需要做的是将您的设置存储在 Application Data 文件夹中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-08T17:20:10.947

I think Aydsman is on the right track here. With the addition of Named Pipes support to .NET 3.5, you have a decent IPC mechanism for communicating with an elevated child process.

# networking - KVM 和 Linux 无线桥接？

> ID：78700
> 
> 赞同：2
> 
> 时间：2008-09-17T00:39:34.880
> 
> 标签：networking, kvm

我正在使用 KVM 在我的 Linux 机器上运行 Windows 虚拟机。网络是通过连接到桥接以太网设备的 Tap 设备完成的，这使得 Windows VM 在我的网络上基本上看起来像一台单独的物理计算机。这很不错。

但是，我的理解是大多数（如果不是全部）无线驱动程序不支持桥接。我真的很想在工作时能够更自由地漫游——有人知道有效的解决方法吗？

用户模式网络不起作用，因为我必须使用一些需要较低级别网络访问的 Windows VPN 软件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T00:46:07.047

我假设您可以将您的 Windows 客户机配置为使用主机作为其默认网关，并通过主机上的无线接口设置 NAT。所以信号流看起来像这样：

1.  Windows 软件打开与 Internet 上主机的连接。
2.  Windows 通过默认网关（即主机 Linux 系统）路由数据包。
3.  Linux 执行 NAT 魔术并通过其正常路由表（应该通过无线接口使用默认网关）路由数据包。

不过，我从未尝试过将其与桥接结合使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-28T17:15:04.380

[像这样](https://stackoverflow.com/questions/10527780/how-to-set-up-bridged-networking-for-kvm-using-ubuntu-12-04)的其他相关问题似乎表明它只是许多无线驱动程序的限制。有一些 Linux 可以进行桥接，但是从第一天开始就必须计划将其构建到他们的系统中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-06T07:25:52.360

为什么将主机 linux 系统设置为使用 WLAN，然后将此连接用作本地/内部网桥的默认网关并且所有虚拟机都插入其中，这应该是一个问题？好的，必须配置简单的 NAT，但实际上有什么意义呢？

# javascript - Javascript框架日历插件

> ID：78703
> 
> 赞同：42
> 
> 时间：2008-09-17T00:40:58.573
> 
> 标签：javascript, jquery, calendar

有谁知道用于主要 javascript 框架之一的好的日历（不是 datepicker，而是一个大的可浏览日历）插件。我更喜欢jQuery。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-04-27T01:51:35.947

刚刚发布了一个新的开源项目（jQuery 插件）。听起来和你想要的完全一样：

[全日历](http://arshaw.com/fullcalendar/)

希望它对你有好处！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-07-09T09:58:37.670

我更喜欢[Eyecon 日历。](http://eyecon.ro/datepicker/)也许是最好的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-05T20:12:17.607

我想你会喜欢以下内容：

[日期范围选择器](http://www.filamentgroup.com/examples/daterangepicker/)

喜欢就投票吧

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-09-21T14:38:11.470

对 Web 开发人员有用的日历和日期选择器脚本：

[http://www.hongkiat.com/blog/useful-calendar-date-picker-scripts-for-web-developers/](http://www.hongkiat.com/blog/useful-calendar-date-picker-scripts-for-web-developers/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-08-30T05:47:19.587

结帐[http://keith-wood.name/datepick.html](http://keith-wood.name/datepick.html)

这是 jQuery 日历实现的非常好的资源

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-09-26T09:03:29.893

为什么不试试这个 jquery 事件日历[http://www.web-delicious.com/jquery-plugins/](http://www.web-delicious.com/jquery-plugins/)。这真太了不起了。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-17T00:49:07.447

你可能想给[jCalendar](http://tedserbinski.com/jcalendar/index.html#about)的人发个便条。他们正在开发一个类似于 Google 日历的 jQuery 插件。项目似乎已经继续进行，但他们也许能够为您指明正确的方向。

从他们的网站：

> v1.0 即将推出，它不仅可以直观地选择日期，还可以在迷你和整页日历视图中显示它们，类似于 Google 日历。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-06-12T15:37:56.060

这是我放在一起的一个。它的外观和工作方式类似于 Google 日历。

[http://code.google.com/p/jquery-frontier-calendar/](http://code.google.com/p/jquery-frontier-calendar/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-11-18T01:21:36.307

我已经成功使用[http://www.stefanoverna.com/log/create-astonishing-ical-like-calendars-with-jquery](http://www.stefanoverna.com/log/create-astonishing-ical-like-calendars-with-jquery)

# html - XSLT 值得吗？

> ID：78716
> 
> 赞同：114
> 
> 时间：2008-09-17T00:43:50.687
> 
> 标签：html, xml, xslt, xml-parsing

不久前，我开始了一个项目，我设计了一个 html 式 XML 模式，以便作者可以以简化格式编写他们的内容（教育课程材料），然后通过 XSLT 将其转换为 HTML。我玩了（苦苦挣扎）了一段时间，并把它弄到了一个非常基本的水平，但后来对我遇到的限制（这很可能是我知识的限制）太恼火了，当我读到一篇建议放弃的博客时XSLT 并且只需使用您选择的语言编写您自己的 XML 到任何解析器，我急切地跳到了它上面，并且效果非常好。

直到今天我仍在努力（*实际上我应该现在就在努力，而不是在 SO 上玩*），而且我看到越来越多的事情让我认为放弃 XSLT 的决定是一个很好的。

我知道 XSLT 有它的位置，因为它是一个公认的标准，如果每个人都编写自己的解释器，90% 的人最终会使用[TheDailyWTF](http://thedailywtf.com)。但是鉴于它是一种[函数式风格的语言](http://en.wikipedia.org/wiki/Functional_programming)，而不是大多数程序员熟悉的过程式风格，对于像我这样从事项目的人来说，**你会建议他们走我所做的道路，还是坚持使用 XSLT** ?

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-11-19T10:27:11.007

如此多的消极情绪！

我已经使用 XSLT 好几年了，并且真的很喜欢它。您必须意识到的关键是*它不是一种编程语言，它是一种模板语言*（在这方面，我发现它比 asp.net /spit 优越得多）。

XML 是当今 Web 开发事实上的数据格式，无论是配置文件、原始数据还是内存表示。XSLT 和 XPath 为您提供了一种*非常*强大且非常有效的方法，可以将该数据转换为您可能喜欢的任何输出格式，立即为您提供将表示与数据分离的 MVC 方面。

然后是实用功能：清除命名空间、识别不同的模式定义、合并文档。

处理 XSLT肯定比开发自己的内部方法更好*。*至少 XSLT 是一个标准，并且您可以聘请它，如果这对您的团队来说真的是一个问题，那么很自然地会让您的大多数团队只使用 XML。

一个真实的用例：我刚刚编写了一个应用程序，它处理整个系统的内存中 XML 文档，并根据最终用户的请求转换为 JSON、HTML 或 XML。我有一个相当随机的请求作为 Excel 数据提供。一位前同事以编程方式做了类似的事情，但它需要几个类文件的模块，并且服务器安装了 MS Office！原来 Excel 有一个 XSD：3 小时内对基码影响最小的新功能。

就我个人而言，我认为这是我职业生涯中遇到的最干净的事情之一，我相信所有明显的问题（调试、字符串操作、编程结构）都归结为对工具的错误理解。

显然，我坚信这是“值得的”。

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2008-09-17T01:26:23.847

XSLT 的优点：

*   特定于 XML 的域，因此例如不需要在输出中引用文字 XML。
*   支持 XPath/XQuery，这是查询 DOM 的好方法，就像正则表达式是查询字符串的好方法一样。
*   函数式语言。

XSLT 的缺点：

*   可能非常冗长 - 您不必引用文字 XML，这实际上意味着您必须引用代码。而且不是很漂亮。但话又说回来，它并不比典型的 SSI 差多少。
*   不做大多数程序员认为理所当然的某些事情。例如，字符串操作可能是一件苦差事。当新手设计代码时，这可能会导致“不幸的时刻”，然后疯狂地在网上搜索如何实现他们认为就在那里并且没有给自己时间编写的功能的提示。
*   函数式语言。

顺便说一句，获得程序行为的一种方法是将多个变换链接在一起。在每个步骤之后，您都有一个全新的 DOM 可以处理，它反映了该步骤中的更改。一些 XSL 处理器具有扩展，可以在一次转换中有效地执行此操作，但我忘记了细节。

因此，如果您的代码主要是输出而没有太多逻辑，那么 XSLT 可以是一种非常简洁的表达方式。如果有很多逻辑，但主要是内置于 XSLT 的表单（选择所有看起来像 blah 的元素，并为每个元素输出 blah），那么它可能是一个非常友好的环境。如果您喜欢始终像 XML 一样思考，那么试试 XSLT 2。

否则，我会说，如果您最喜欢的编程语言具有支持 XPath 并允许您以有用的方式构建文档的良好 DOM 实现，那么使用 XSLT 几乎没有什么好处。与 libxml2 和 gdome2 的绑定应该做得很好，坚持使用您熟悉的通用语言并没有什么可耻的。

自制的 XML 解析器通常不是不完整的（在这种情况下，你总有一天会遇到困难），或者不会比你可以从现成的东西小很多（在这种情况下，你可能会浪费你的时间），并给出您有很多机会围绕恶意输入引入严重的安全问题。除非您确切地知道这样做会获得什么，否则不要写。这并不是说如果您不需要 XML 提供的所有内容，您就不能为比 XML 更简单的输入格式编写解析器。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-08-13T17:14:50.233

我不得不承认这里有偏见，因为我以教授 XSLT 为生。但是，可能值得介绍一下我看到我的学生工作的领域。他们通常分为三组：出版、银行和网络。

到目前为止，许多答案可以概括为“它对创建网站没有好处”或“它不像语言 X”。许多技术人员在他们的职业生涯中没有接触过函数式/声明式语言。当我教学时，有经验的 Java/VB/C/等人是那些对语言有问题的人（变量是代数意义上的变量，而不是过程编程）。很多人都在这里回答——我从来没有接触过 Java，但我不会因此而费心批评这种语言。

在许多情况下，它不是创建网站的合适工具——通用编程语言可能更好。我经常需要获取非常大的 XML 文档并在 Web 上呈现它们；XSLT 使这变得微不足道。我在这个领域看到的学生倾向于处理数据集并在网络上展示它们。XSLT 肯定不是这个领域唯一适用的工具。然而，他们中的许多人正在使用 DOM 来执行此操作，而 XSLT 肯定不会那么痛苦。

我看到的银行业学生一般都使用 DataPower 盒子。这是一个 XML 设备，它用于在“说”不同 XML 方言的服务之间。在 XSLT 中从一种 XML 语言转换到另一种语言几乎是微不足道的，而且参加我的这门课程的学生人数正在增加。

我看到的最后一组学生来自出版背景（比如我）。这些人往往拥有大量的 XML 文档（相信我，作为一个行业的出版业正在深入研究 XML——技术出版业已经存在多年，而贸易出版业现在也已普及）。这些文档需要处理（这里想到的是 DocBook 到 ePub）。

上面有人评论说脚本往往低于 60 行，否则它们会变得笨拙。如果它确实变得笨拙，那么编码人员很可能还没有真正理解 - XSLT 是一种与许多其他语言非常不同的思维方式。如果你没有得到这种心态，那是行不通的。

它当然不是一种垂死的语言（我得到的工作量告诉我）。现在，在微软完成他们（非常晚的）XSLT 2 实现之前，它有点“卡住”。但它仍然存在，并且从我的角度来看似乎正在变得强大。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2009-08-13T08:02:09.637

我们将 XSLT 广泛用于文档之类的事情，并使一些复杂的配置设置可供用户使用。

对于文档，我们使用了大量的 DocBook，它是一种基于 XML 的格式。这让我们可以使用我们所有的源代码存储和管理我们的文档，因为这些文件是纯文本的。使用 XSLT，我们可以轻松构建自己的文档格式，允许我们以通用方式自动生成内容，并使内容更具可读性。例如，当我们发布发行说明时，我们可以创建如下所示的 XML：

```
<ReleaseNotes>
    <FixedBugs>
        <Bug id="123" component="Admin">Error when clicking the Foo button</Bug>
        <Bug id="125" component="Core">Crash at startup when configuration is missing</Bug>
        <Bug id="127" component="Admin">Error when clicking the Bar button</Bug>
    </FixedBugs>
</ReleaseNotes> 
```

然后使用 XSLT（将上面的内容转换为 DocBook），我们最终得到了很好的发行说明（通常是 PDF 或 HTML），其中错误 ID 自动链接到我们的错误跟踪器，错误按组件分组，并且所有内容的格式都完全一致. 上面的 XML 可以通过向我们的错误跟踪器查询版本之间发生的变化来自动生成。

我们发现 XSLT 有用的另一个地方实际上是在我们的核心产品中。有时在与第三方系统交互时，我们需要以某种方式处理复杂 HTML 页面中的数据。解析 HTML 很难看，所以我们通过[TagSoup之类的东西提供数据](http://home.ccil.org/~cowan/XML/tagsoup/)（它生成正确的 SAX XML 事件，本质上让我们处理 HTML，就好像它是正确编写的 XML 一样）然后我们可以针对它运行一些 XSLT，将数据转换为我们可以实际使用的“已知稳定”格式. 通过将该转换分离为 XSLT 文件，这意味着如果 HTML 格式发生更改，应用程序本身不需要升级，最终用户可以自己编辑 XSLT 文件，或者我们可以通过电子邮件发送它们是更新的 XSLT 文件，无需升级整个系统。

我想说，对于 Web 项目，现在有比 XSLT 更好的方法来处理视图端，但作为一项技术，XSLT 肯定有用途。它不是世界上最容易使用的语言，但它绝对没有死，而且从我的角度来看，它仍然有很多好的用途。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-08-13T07:47:16.343

[XSLT 是声明性编程](http://en.wikipedia.org/wiki/Declarative_programming)语言 的一个示例。

声明性编程语言的其他示例包括正则表达式、Prolog 和 SQL。所有这些都具有高度的表现力和紧凑性，并且通常设计得非常好，并且对于它们所设计的任务来说功能强大。

然而，软件开发人员通常讨厌这样的语言，因为它们与更主流的 OO 或过程语言有很大的不同，以至于它们很难学习和调试。它们紧凑的性质通常很容易在不经意间造成大量伤害。

因此，虽然 XSLT 是一种将数据合并到表示中的有效机制，但它在易用性方面却失败了。我相信这就是它没有真正流行起来的原因。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-17T01:03:34.603

我记得当新标准发布时围绕 XSLT 的所有炒作。能够通过“简单”转换构建完整的 HTML UI 令人兴奋。

让我们面对现实吧，它很难使用，几乎无法调试，而且速度常常令人难以忍受。最终结果几乎总是古怪且不理想。

当有更好的方法来做事时，我宁愿咬掉自己的腿，也不愿使用 XSLT。它仍然有它的位置，它适用于简单的转换任务。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-08-13T08:10:11.307

我已经将 XSLT（以及 XQuery）广泛用于各种事情——生成 C++ 代码作为构建过程的一部分，从文档注释生成文档，以及在必须使用一般 XML 和特别是 XHTML 的应用程序中. 尤其是代码生成器，超过 10,000 行 XSLT 2.0 代码分布在大约十几个单独的文件中（它做了很多事情——客户端的标头、远程代理/存根、COM 包装器、.NET 包装器、ORM 等等）一些）。我从另一个不太懂语言的人那里继承了它，因此较旧的部分变得一团糟。然而，我们写的较新的东西大多保持理智和可读，我不记得实现这一点有什么特别的问题。这当然不比为 C++ 做这件事难。

说到版本，处理 XSLT 2.0 肯定会帮助您保持理智，但 1.0 对于更简单的转换仍然没问题。在其利基市场中，它是一个非常方便的工具，并且您从某些特定于域的功能（最重要的是，通过模板匹配进行动态调度）获得的生产力难以匹敌。尽管 XSLT 基于 XML 的语法看起来很冗长，但在 LINQ to XML 中（甚至在带有 XML 文字的 VB 中）中的相同内容通常要长几倍。然而，很多时候，由于在某些情况下不必要地使用 XML，它会受到不应有的抨击。

总结一下：它是一个非常有用的工具，放在一个人的工具箱中，但它是一个非常专业的工具，所以只要你正确使用它并达到预期目的，它就很好。我真的希望 XSLT 2.0 有一个适当的、本机的 .NET 实现。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-08-13T08:01:28.360

我使用 XSLT（因为没有更好的选择），但不是为了演示，只是为了转换：

1.  我编写了简短的 XSLT 转换来对我们的 maven pom.xml 文件进行大规模编辑。

2.  我编写了一个转换管道以从 XMI（UML 图）生成 XML 模式。它工作了一段时间，但最终变得太复杂了，我们不得不把它从谷仓后面拿出来。

3.  我使用转换来重构 XML 模式。

4.  通过使用 XSLT 生成 XSLT 来完成实际工作，我已经解决了 XSLT 中的一些限制。（曾经尝试编写一个 XSLT，使用直到运行时才知道的名称空间产生输出？）

我不断地回到它，因为它比我尝试过的其他方法更好地往返于它正在处理的 XML，这些方法似乎不必要地有损或只是误解了 XML。XSLT 令人不快，但我发现使用[Oxygen](http://www.oxygenxml.com/)可以忍受。

也就是说，我正在研究使用[Clojure](http://clojure.org/)（一种 lisp）来执行 XML 的转换，但我还没有深入了解这种方法是否会给我带来好处。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-09-17T00:51:22.510

我个人在完全不同的环境中使用 XSLT。我当时正在开发的电脑游戏使用了大量使用 XML 定义的 UI 页面。在发布后不久的一次重大重构中，我们想要更改这些 XML 文档的结构。我们使游戏的输入格式遵循更好的模式感知结构。

XSLT 似乎是从旧格式 -> 新格式转换的完美选择。在两周内，我完成了数百页从旧到新的有效转换。我还能够使用它来提取有关我们 UI 页面布局的大量信息。我创建了相对容易地嵌入了哪些组件的列表，然后我使用 XSLT 将其写入我们的模式定义中。

此外，来自 C++ 背景，这是一种非常有趣且值得掌握的语言。

我认为作为一种将 XML 从一种格式转换为另一种格式的工具，它非常棒。但是，它不是定义将 XML 作为输入并输出*Something*的算法的唯一方法。如果您的算法足够复杂，则输入是 XML 的事实与您选择的工具无关 - 即在 C++ / Python / 中滚动您自己的工具。

具体到您的示例，我想最好的想法是创建您自己的 XML-> XML 转换，以遵循您的业务逻辑。接下来，编写一个 XSLT 翻译器，它只知道格式化并且什么都不做。这可能是一个很好的中间立场，但这完全取决于你在做什么。在输出上安装 XSLT 转换器可以更轻松地创建替代输出格式 - 可打印、用于移动设备等。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-08-13T07:52:01.123

是的，我经常使用它。通过使用不同的 xslt 文件，我可以使用相同的 XML 源来创建多个多语言 (X)HTML 文件（以不同的方式呈现相同的数据）、RSS 提要、Atom 提要、RDF 描述符文件和站点地图的片段.

它不是灵丹妙药。有些事情它做得很好，也有些事情做得不好，就像编程的所有其他方面一样，这都是关于使用正确的工具来完成正确的工作。这是一个非常值得在您的工具箱中使用的工具，但只有在适当的时候才应该使用它。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-17T01:43:08.643

我肯定会建议坚持下去。特别是如果您使用的是内置 XSLT 编辑、查看和调试工具的 Visual Studio。

是的，你在学习的时候会很痛苦，但大部分的痛苦与熟悉有关。当您学习语言时，疼痛确实会减轻。

W3schools 有两篇特别有价值的文章： [http://www.w3schools.com/xpath/xpath_functions.asp](http://www.w3schools.com/xpath/xpath_functions.asp) [http://www.w3schools.com/xsl/xsl_functions.asp](http://www.w3schools.com/xsl/xsl_functions.asp)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-17T01:09:42.000

我发现 XSLT 很难使用。

我曾在与您描述的系统有些相似的系统上工作过。我的公司注意到我们从“中间层”返回的数据是 XML 格式的，并且页面将以 HTML 格式呈现，这也可能是 XHTML，而且他们听说 XSL 是在 XML 之间进行转换的标准格式。因此，“架构师”（我指的是那些深思熟虑但显然从不编码的人）决定我们的前端将通过编写将数据转换为 XHTML 以显示的 XSLT 脚本来实现。

事实证明，这个选择是灾难性的。事实证明，XSLT 编写起来很痛苦。因此，我们所有的页面都难以编写和维护。如果使用 JSP（这是在 Java 中）或使用一种标记（尖括号）作为输出格式（HTML）和另一种标记（如 <%... %>) 用于元数据。XSLT 最令人困惑的地方在于它是用 XML 编写的，并且它可以从 XML 转换为 XML……很难将所有 3 个不同的 XML 文档都牢记在心。

您的情况略有不同：不像我那样在 XSLT 中编写每个页面，您只需在 XSLT 中编写一点代码（从模板转换为显示的代码）。但听起来你可能遇到了和我一样的困难。我想说的是，像您所做的那样尝试解释简单的基于 XML 的 DSL（领域特定语言）并不是 XSLT 的强项之一。（虽然它可以完成这项工作......毕竟，它是图灵完备的！）

但是，如果您所拥有的更简单：您拥有一种 XML 格式的数据，并且想要对其进行简单的更改——不是完整的页面描述 DSL，而是一些简单直接的修改，那么 XSLT 是用于此目的的出色工具。它的声明性（而非程序性）性质实际上是为此目的的优势。

——迈克尔·彻姆赛德

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-10-10T12:05:41.700

XSLT 很难使用，但是一旦您掌握了它，您将对 DOM 和模式有非常透彻的了解。如果您还使用 XPath，那么您正在学习函数式编程，这将接触到解决问题的新技术和方法。在某些情况下，连续转换比程序解决方案更强大。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-08-13T08:21:09.443

我广泛使用 XSLT，用于自定义 MVC 风格的前端。该模型被“序列化”为 xml（不是通过 xml 序列化），然后通过 xslt 转换为 html。与 ASP.NET 相比的优势在于与 XPath 的自然集成，以及更严格的格式要求（在 xslt 中推理文档结构比在大多数其他语言中要容易得多）。

不幸的是，该语言包含一些限制（例如，转换另一个转换的输出的能力），这意味着使用它有时会令人沮丧。

尽管如此，它所授予的易于实现、强制执行的关注点分离并不是我现在看到的另一种技术提供的东西——所以对于文档转换，它仍然是我推荐的东西。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-08-13T08:55:06.270

2004 年的某个时候，我在一个非常不同的数据库系统之间的集成项目中使用了 XML、XSD 和 XSLT。我不得不从头开始学习 XSD 和 XSLT，但这并不难。这些工具的伟大之处在于它使我能够编写独立于数据的 C++ 代码，依靠 XSD 和 XSLT 来验证/验证然后转换 XML 文档。更改数据格式，更改 XSD 和 XSLT 文档，而不是使用 Xerces 库的 C++ 代码。

出于兴趣：主要 XSD 为 150KB，XSLT 的平均大小为 < 5KB IIRC。

另一个很大的好处是 XSD 是 XSLT 所基于的规范文档。两人配合默契。如今，规范在软件开发中很少见。

尽管我在学习声明性 XSD 和 XSLT 时没有遇到太多困难，但我确实发现其他 C/C++ 程序员在适应声明性方式时遇到了很大的困难。当他们看到就是这样，啊他们喃喃的程序，现在我明白了！他们继续（双关语？）编写程序 XSLT！问题是您必须学习 XPath 并理解 XML 的轴心。让我想起以前的 C 程序员在编写 C++ 时适应使用 OO。

我使用了这些工具，因为它们使我能够编写一个小型 C++ 代码库，该代码库与除了最基本的数据结构修改之外的所有内容都是隔离的，而后者是 DB 结构更改。尽管我更喜欢 C++ 而不是任何其他语言，但我会使用我认为对软件项目的长期生存能力有益的语言。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-08-13T09:52:18.027

我曾经认为 XSLT 是个好主意。我的意思是这*是*个好主意。

它失败的地方是执行。

随着时间的推移，我发现的问题是 XML 中的编程语言只是一个坏主意。它使整个事情变得难以穿透。具体来说，我认为 XSLT 很难学习、编码和理解。功能方面之上的 XML 只会让整个事情变得过于混乱。在我的职业生涯中，我尝试学习它大约 5 次，但它就是不坚持。

好的，你可以“工具化”它——我认为这部分是它设计的重点——但这是第二个失败：市场上的所有 XSLT 工具，很简单......废话！

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-17T00:48:11.910

[XSLT 规范](http://www.w3.org/TR/xslt)将XSLT 定义为“一种将 XML 文档转换为其他 XML 文档的语言”。如果您尝试做除了 XSLT 中最基本的数据处理之外的任何事情，那么可能有更好的解决方案。

另外值得注意的是，XSLT 的数据处理能力可以在 .NET 中使用自定义扩展函数进行扩展：

*   [MSDN 文档](http://msdn.microsoft.com/en-us/library/system.xml.xsl.xsltargumentlist.addextensionobject.aspx)
*   [CSharpFriends：教程](http://www.csharpfriends.com/Articles/getArticle.aspx?articleID=64)

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-09-17T00:51:12.743

我仍然相信 XSLT 是有用的，但它是一种丑陋的语言，并且会导致可怕的不可读、不可维护的混乱。部分原因是 XML 的可读性不足以构成一种“语言”，部分原因是 XSLT 卡在声明性和过程性之间。话虽如此，我认为可以用正则表达式进行比较，当涉及到简单的定义明确的问题时，它有它的用途。

使用替代方法并在代码中解析 XML 可能同样令人讨厌，并且您确实希望使用某种 XML 编组/绑定技术（例如 Java 中的 JiBX）将您的 XML 直接转换为对象。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-09-17T01:05:35.737

我为我的公司维护一个在线文档系统。作者使用 SGML（类似 xml 的语言）创建文档。然后将 SGML 与 XSLT 组合并转换为 HTML。

这使我们无需进行任何编码即可轻松更改文档布局。它只是改变 XSLT 的问题。

这对我们很有效。在我们的例子中，它是一个只读文档。用户没有与文档交互。

此外，通过使用 XSLT，您可以更接近您的问题域 (HTML)。我一直认为这是个好主意。

最后，如果您当前的系统工作正常，请不要管它。我绝不会建议破坏您现有的代码。如果我从头开始，我会使用 XSLT，但在你的情况下，我会使用你所拥有的。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-09-17T01:32:18.823

它归结为你需要它。它的主要优势是转换的易于维护性，编写自己的解析器通常会消除这一点。话虽如此，有时系统又小又简单，真的不需要“花哨”的解决方案。只要您的基于代码的构建器是可替换的，而无需更改其他代码，没什么大不了的。

至于 XSL 的丑陋，是的，它很丑陋。是的，这需要一些时间来适应。但是一旦你掌握了它（不应该花很长时间IMO），它实际上是一帆风顺的。根据我的经验，编译后的转换运行得非常快，您当然可以调试它们。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2009-08-13T08:24:24.087

如果您可以以声明式风格使用 XSLT（尽管我不完全同意它是声明式语言），那么我认为它是有用且富有表现力的。

我编写了使用 OO 语言（在我的例子中是 C#）来处理数据/处理层的 Web 应用程序，但输出的是 XML 而不是 HTML。然后，客户端可以将其作为数据 API 直接使用，或者由 XSLT 呈现为 HTML。因为 C# 输出的 XML 在结构上与这种用法兼容，所以一切都非常流畅，并且表示逻辑保持声明性。它比从 C# 发送标签更容易跟踪和更改。

但是，由于您在 XSLT 级别需要更多处理逻辑，因此它变得复杂和冗长 - 即使您“获得”了函数式样式。

当然，这些天我可能已经使用 RESTful 接口编写了这些 Web 应用程序——而且我认为 JSON 等数据“语言”在传统上由 XSLT 转换 XML 的领域正在获得牵引力。但就目前而言，XSLT 仍然是一项重要且有用的技术。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-17T00:56:00.893

我在 XSLT 上花了很多时间，发现虽然它在某些情况下是一个有用的工具，但它绝对不是万能的。当它用于机器可读 XML 输入/输出的数据转换时，它非常适合 B2B 目的。我认为您在声明其局限性时没有走错路。最让我感到沮丧的事情之一是 XSLT 实现中的细微差别。

也许您应该看看其他一些可用的标记语言。我相信 Jeff 写了一篇关于 Stack Overflow 的文章。

[HTML 是一种人性化的标记语言吗？](http://www.codinghorror.com/blog/archives/001116.html)

我想看看他写的东西。您可能会找到一个“开箱即用”的软件包，或者至少非常接近，而不是从头开始编写自己的东西。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-10-23T07:22:34.760

我目前的任务是从公共网站上抓取数据（是的，我知道）。谢天谢地，它符合 xhtml，所以我可以使用 xslt 来收集我需要的数据。生成的解决方案可读、干净且在需要时易于更改。完美的！

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2009-08-13T07:47:04.393

我以前使用过 XSLT。在我用 C# 重写之前，这组 6 个 .xslt 文件（从一个大文件中重构出来）大约有 2750 行。C# 代码目前有 4000 行，包含大量逻辑；我什至不想考虑用 XSLT 编写会需要什么。

当我意识到没有 XPATH 2.0 严重损害了我的进步时，我放弃了。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-08-13T07:53:18.220

回答你的三个问题：

1.  几年前我使用过一次 XSLT。
2.  我确实相信 XSLT 在某些情况下可能是正确的解决方案。（永不说永不）
3.  我倾向于同意您的评估，即它对“简单”转换最有用。但我认为，只要您很好地理解 XSLT，就可以将它用于更大的任务，例如将网站发布为将 XML 转换为 HTML。

我相信许多开发人员不喜欢 XSLT 的原因是他们不了解它所基于的根本不同的范式。但随着最近对函数式编程的兴趣，我们可能会看到 XSLT 卷土重来……

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2009-08-13T08:17:36.453

xslt 真正闪耀的地方之一是生成报告。我发现这是一个两步过程，第一步将报告数据导出为 xml 文件，第二步使用 xslt 从 xml 生成可视化报告。这允许提供漂亮的可视化报告，同时在需要时仍保留原始数据作为验证机制。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-08-13T14:32:25.843

在之前的一家公司，我们在 XML 和 XSLT 方面做了很多工作。XML 和 XSLT 都很大。

是的，有一个学习曲线，但是你有一个强大的工具来处理 XML。您甚至可以在 XSLT 上使用 XSLT（这有时很有用）。

性能也是一个问题（对于非常大的 XML），但您可以通过使用智能 XSLT 并使用（生成的）XML 进行一些预处理来解决这个问题。

任何了解 XSLT 的人都可以更改成品的外观，因为它没有被编译。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2009-10-08T04:51:18.407

我个人喜欢 XSLT，您可能想看看[简化的语法](http://www.w3.org/TR/xslt#result-element-stylesheet)（没有显式模板，只是一个带有一些 XSLT 标记的常规旧 HTML 文件以向其中吐出值），但它并不适合所有人。

也许您只是想为您的作者提供一个简单的 Wiki 或 Markdown 界面。也有相应的库，如果 XSLT 不适合您，也许 XML 也不适合它们。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-09-17T00:55:30.707

XSLT 并不是 xml 转换的终极目标。但是，根据给出的信息很难判断它是否是解决您的问题的最佳解决方案，或者是否有其他更有效和可维护的方法。您说作者可以以简化格式输入他们的内容——什么格式？文本框？你把它转换成什么样的html？要判断 XSLT 是否是适合这项工作的工具，有助于更详细地了解这种转换的特征。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-09-17T01:00:11.583

我也曾涉足 XSLT 的世界，但我发现它在某些地方有点尴尬。我认为我的主要问题是难以将“纯数据”XML 转换为完整的 HTML 页面。事后看来，也许使用 XSLT 生成一个页面片段，该页面片段可以与使用服务器端脚本（例如 SSI）的其他片段组合在一起，这会解决我的许多问题。

可能的错误之一是通过使用 document() 函数导入 XHTML 或其他 XML 数据来尝试构建一个通用的页面布局来包围我的数据。

另一个错误是尝试执行编程操作，例如创建通用模板以在 XML 数据上生成表，其逻辑执行的操作包括对具有特定值的行使用不同的背景行颜色，并允许您指定要过滤掉的某些列。

更不用说尝试从似乎只能使用递归模板调用来解决的 XML 数据构造值的字符串列表。

我得到了什么？好吧，页面源是 XML 数据，可供查看者使用。数据和演示被巧妙地分开。

我会再做一次吗？可能不会，除非我真的想在**静态**页面上分离数据/表示。否则，我可能会编写一个 Rails 或 Java EE 应用程序，它可以使用模板生成 XML 视图或 HTML 视图——所有好处，但更自然的（对我而言）编程语言触手可及。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2008-09-17T01:04:22.900

我喜欢将 XSLT 仅用于更改 XML 文档的树结构。我发现做任何与文本处理相关的事情并将其委托给我可能在将 XSLT 应用于 XML 文档之前或之后运行的自定义脚本都很麻烦。

XSLT 2.0 包含了更多的字符串函数，但我认为它不太适合该语言，并且 XSLT 2.0 的实现并不多。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-09-17T01:13:32.147

我认为你做对了。以我的经验，XSLT 开发人员是最难招到的，因为它是一种无论是 Web 开发人员还是普通程序员都不会流行的语言。

因此，您最终不得不为“了解主流语言之外的语言的高级程序员”付费，但要购买一种可能不是该程序员最喜欢的语言。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2008-10-10T11:59:43.103

我需要在这里使用 XSLT，因为有人认为解决给定问题是个好主意：我们需要从多个 XML 文件中提取一些数据，并将其连接到不同的输出格式中，以供不同的工具进行进一步处理。

首先，我认为 XSLT 是一个非常好的主意，因为它是您可以依赖的标准。这适用于简单的格式化任务，您的代码中不需要太多的编程逻辑或算法。

但是：这是一个相当多的学习曲线，因为它*不是*程序性的。如果你习惯了过程式编程（C、Java、Perl、PHP 等），你会错过很多常见的结构，或者你会想知道那些只是幸运的东西，有时未经训练的眼睛无法真正阅读。例如编写“可重用”代码：如果您需要在不同的地方一遍又一遍地做某事，在过程编程中，您可以定义一个函数来执行此操作。您也可以在 XSLT 中实现这样的目标，但它需要编写更多代码，并且不像普通函数那样可读/可理解。

我遇到的主要问题是，到目前为止，许多具有程序背景的人都在研究 XSLT 文件，几乎每个人都只是“模仿”他需要的东西。

所以作为一个结论：我不再将 XSLT 视为“终极”解决方案。事实上，在 XSLT 中读或写一些结构是很痛苦的。在大多数情况下，您必须考虑应用程序： 对于简单的转换，我可能会再次使用 XSLT。但是对于更复杂的软件我不会再用了。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2008-10-23T07:31:44.913

谈到互操作性，XML 是一种信息存储标准。很多工具都以 XML 格式生成输出，还有什么比在您的应用程序中嵌入浏览器并格式化 XML 并将其放入浏览器中更好（或更简单）的方式来呈现它。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2008-11-05T06:47:48.277

在我看来是的。

有关 XSLT 非常酷的使用的一个很好的例子，请查看暴雪的魔兽世界军械库。

[http://www.wowarmory.com](http://www.wowarmory.com)

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2009-08-13T07:49:34.530

我确实广泛使用了 XSLT……几个小时。对于更改元素名称或过滤输入文档（剥离不需要的东西）等事情来说，这很酷。

其他任何事情都会很快变得复杂。这继承了复杂性，加上缺少从任何其他编程语言中使用的大多数东西（如变量）以及使 XPath 表达式不可读的简单方法，真的很受伤。

最后，XSLT 遭受了分裂：程序员不喜欢它，因为它的局限性，其他人根本无法使用它（例如，网页设计师或任何其他非程序员类型）。

如果 XSLT 被提升为某种用于 XML 的 SQL，那么情况会有些不同。首先，人们甚至不会费心去看它。那些这样做的人不会对疼痛感到惊讶。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2009-08-13T07:49:40.630

我认为这个概念是合理的，也许执行并不像它可能的那样“干净”。

但是我认为它应该被视为一种工具，在每种情况下都使用它可能并不明智，但是在解决解决方案时永远不应该忽视工具。

我看到了非常好的 XSLT，也看到了非常糟糕的 XSLT 使用，我认为其中一些可能取决于开发人员的技能。我认为它需要开发人员同时考虑多个领域。

是未来吗？也许不是，也许有更好的解决方案..

我不知道会出现什么新技术，但至少最好学习它，增加自己的工具集肯定不是坏事吗？

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2009-08-13T08:03:35.453

我使用 XSLT 来纠正非常复杂的 xml 文件中的错误。因此，我没有处理 xml 中的错误，而是使用 xslt 来纠正它们。

这很棒。因为该语言非常强大并且适合 xml 用例。为了用一种常用的编程语言做同样的事情，每次出现新的风格时，我都需要很长时间来调整我的代码。

在不让微软决定要更改哪些内容的情况下迁移 Visual Studio 解决方案也很有用。所以转换一种解决方案。检查发生了什么变化。还原您不想更改的内容并运行 xslt 脚本对所有文件执行此工作。

所以我从来没有用它来做网络演示或类似的东西，但它可以帮助我解决基于 xml 的问题。为了解决这些问题，它真的非常强大，非常值得一看。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2009-08-13T10:53:39.313

就纯粹的生产力而言，您最好使用其中一个 jQuery 风格的库 - pyQuery、phpQuery 等。大多数 XML 库都很糟糕，XSLT 本质上只是另一个打包为成熟语言但没有一套像样的工具的 XML 库. jQuery 使得以您选择的语言遍历和操作 XML 样式数据变得异常容易。

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2011-11-30T20:11:39.503

我在使用 XSLT 方面有过相当不错的体验，但我并没有转换成 HTML。可能是 XSLT-HTML 组合很难完成。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2012-01-18T16:31:32.833

XSLT 1.0 是最便携的代码之一，至少在台式机和服务器计算机上是这样。因为它在大多数这些系统上都有一个（通常是多个）运行时：

*   Microsoft Windows 具有 MSXML，它至少从 Windows 2000 开始就安装在基本系统中。它可以从 MSIE、[命令行](http://msdn.microsoft.com/en-us/library/windows/desktop/ms757858%28v=vs.85%29.aspx)（使用 WSH）或 Office 应用程序中使用
*   Java 运行时环境 (JRE) 具有 XSLT 运行时，并且 JRE 安装在大多数桌面上
*   几乎所有主要的网络浏览器都有一个。歌剧是个例外。
*   在主要的基于 GNU 的操作系统（libxslt、xsltproc）上默认安装了免费的实现
*   我没有检查过 MacOS X，但它至少在 Safari 中有一个实现

这使得它非常适合构建一些需要便携性和轻量级/无需安装的应用程序。

此外，XSLT 只需要一个运行时（不需要编译器），您可以使用任何文本编辑器创建代码。因此，您可以从任何桌面轻松创建程序（好吧，一旦您掌握了语言）。

# c++ - gcc 和 cpp 中的“foreach 值”宏

> ID：78717
> 
> 赞同：13
> 
> 时间：2008-09-17T00:43:53.090
> 
> 标签：c++, gcc

我有一个在 C++ 中经常使用的“foreach”宏，它适用于大多数 STL 容器：

```
#define foreach(var, container) \
  for(typeof((container).begin()) var = (container).begin(); \
      var != (container).end(); \
      ++var) 
```

（请注意，'typeof' 是 gcc 扩展。）它的使用如下：

```
std::vector< Blorgus > blorgi = ...;
foreach(blorgus, blorgi) {
  blorgus->draw();
} 
```

我想做一些类似的东西来迭代地图的值。也许称它为“foreach_value”。所以不要写

```
foreach(pair, mymap) {
  pair->second->foo();
} 
```

我会写

```
foreach_value(v, mymap) {
  v.foo();
} 
```

我想不出一个可以做到这一点的宏，因为它需要声明两个变量：迭代器和值变量（上面的'v'）。我不知道如何在 for 循环的初始化程序中执行此操作，即使使用 gcc 扩展也是如此。我可以在 foreach_value 调用之前声明它，但是它会与同一范围内的 foreach_value 宏的其他实例发生冲突。如果我可以将当​​前行号作为迭代器变量名称的后缀，它会起作用，但我不知道该怎么做。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-17T00:59:13.117

您会在寻找[BOOST_FOREACH](http://www.boost.org/doc/libs/1_36_0/doc/html/foreach.html) - 他们已经为您完成了所有工作！

如果您确实想自己动手，您可以在 C++ 中的任何位置声明一个块，这可以解决您的 itr->second 中间存储的范围问题...

```
// Valid C++ code (which does nothing useful)
{
  int a = 21; // Which could be storage of your value type
}
// a out of scope here
{ 
  int a = 32; // Does not conflict with a above
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-17T01:48:56.443

您可以使用两个循环来执行此操作。第一个声明了迭代器，其名称是容器变量的函数（如果您担心与自己的代码冲突，可以使这个更难看）。第二个声明值变量。

```
#define ci(container) container ## iter
#define foreach_value(var, container) \
    for (typeof((container).begin()) ci(container) = container.begin(); \
         ci(container) != container.end(); ) \
        for (typeof(ci(container)->second)* var = &ci(container)->second; \
             ci(container) != container.end(); \
             (++ci(container) != container.end()) ? \
                 (var = &ci(container)->second) : var) 
```

通过使用相同的循环终止条件，外循环只发生一次（如果幸运的话，会被优化掉）。此外，如果地图为空，则避免在迭代器上调用 ->second。这与内循环增量中的三元运算符的原因相同；最后，我们只是将 var 保留为最后一个值，因为它不会再次被引用。

您可以内联 ci(container)，但我认为它使宏更具可读性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-17T02:24:10.603

STL*[变换](http://www.sgi.com/tech/stl/transform.html)*函数也有类似的作用。

论据是（按顺序）：

1.  指定容器开头的输入迭代器
2.  指定容器结束的输入迭代器
3.  定义输出位置的输出迭代器（对于就地转换，类似于 for-each，只需传递 #1 中的输入迭代器）
4.  对每个元素执行的一元函数（函数对象）

对于一个非常简单的示例，您可以通过以下方式将字符串中的每个字符大写：

```
#include <iostream>
#include <string>
#include <algorithm>
#include <cctype>

int main(int argc, char* argv[]) {
    std::string s("my lowercase string");
    std::transform(s.begin(), s.end(), s.begin(), toupper);
    std::cout << s << std::endl; // "MY LOWERCASE STRING"
} 
```

或者，还有*[累积](http://www.sgi.com/tech/stl/accumulate.html)*函数，它允许在调用函数对象之间保留一些值。*accum*不会像*transform*那样修改输入容器中的数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T01:01:11.130

您是否考虑过使用[Boost 库](http://www.boost.org/)？他们[`foreach`实现了一个宏](http://www.boost.org/doc/libs/1_36_0/doc/html/foreach.html)，它可能比你写的任何东西都更健壮......而且还有[`transform_iterator`](http://www.boost.org/doc/libs/1_36_0/libs/iterator/doc/transform_iterator.html)一个似乎可以用来做你想要的第二次提取部分。

不幸的是，我不能确切地告诉你*如何*使用它，因为我对 C++ 了解的不够多：)[这个谷歌搜索](http://www.google.com/search?q=boost+foreach+transform_iterator)出现了一些有希望的答案：[comp.lang.c++.moderated](http://groups.google.com/group/comp.lang.c++.moderated/msg/26b344960588d3ac)，[Boost transform_iterator use case](https://network-geographics.com/weblog/2008/06/boost_transform_iterator_use_cas.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T02:53:48.410

Boost::For_each 是迄今为止你最好的选择。有趣的是，它们实际上给您的是宏 BOOST_FOREACH()，然后您可以将其包装并 #define 到您真正想在代码中调用的任何内容。大多数人都会选择旧的“foreach”，但其他商店可能有不同的编码标准，所以这符合这种心态。Boost 还为 C++ 开发人员提供了许多其他好处！很值得使用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-18T12:34:55.250

我创建了一个小的 Foreach.h 助手，其中包含一些 foreach() 变体，包括对局部变量和指针进行操作的变体，还有一个额外的版本，可以防止从循环中删除元素。所以使用我的宏的代码看起来很舒服，如下所示：

```
#include <cstdio>
#include <vector>
#include "foreach.h"

int main()
{
    // make int vector and fill it
    vector<int> k;
    for (int i=0; i<10; ++i) k.push_back(i);

    // show what the upper loop filled
    foreach_ (it, k) printf("%i ",(*it));
    printf("\n");

    // show all of the data, but get rid of 4
    // http://en.wikipedia.org/wiki/Tetraphobia :)
    foreachdel_ (it, k)
    {
        if (*it == 4) it=k.erase(it);
        printf("%i ",(*it));
    }
    printf("\n");

    return 0;
} 
```

输出：

```
0 1 2 3 4 5 6 7 8 9
0 1 2 3 5 6 7 8 9 
```

我的[Foreach.h](http://pleasanthacking.com/2010/06/17/foreach-in-cpp/ "c++中的foreach")提供以下宏：

*   foreach() - 用于指针的常规 foreach
*   foreach_() - 局部变量的常规 foreach
*   foreachdel() - foreach 版本，在循环中检查删除，指针版本
*   foreachdel_() - foreach 版本，在循环内检查删除，局部变量版本

他们确实为我工作，我希望他们也能让你的生活更轻松:)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-08-31T05:48:38.417

这个问题有两个部分。您需要以某种方式（1）在映射的*值*（而不是键）上生成一个迭代器（或者更确切地说，一个可迭代的序列），以及（2）使用宏来进行迭代而无需大量样板。

最干净的解决方案是对第 (1) 部分使用[Boost Range](http://www.boost.org/doc/libs/1_47_0/libs/range/doc/html/index.html) [Adapter ，对第 (2) 部分使用](http://www.boost.org/doc/libs/1_47_0/libs/range/doc/html/range/reference/adaptors/introduction.html)[Boost Foreach](http://www.boost.org/doc/libs/1_47_0/doc/html/foreach.html)。您不需要自己编写宏或实现迭代器。

```
#include <map>
#include <string>
#include <boost/range/adaptor/map.hpp>
#include <boost/foreach.hpp>

int main()
{
    // Sample data
    std::map<int, std::string> myMap ;
    myMap[0] = "Zero" ;
    myMap[10] = "Ten" ;
    myMap[20] = "Twenty" ;

    // Loop over map values
    BOOST_FOREACH( std::string text, myMap | boost::adaptors::map_values )
    {
        std::cout << text << " " ;
    }
}
// Output:
// Zero Ten Twenty 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T00:53:55.717

您可以定义一个模板类，它将 mymap 的类型作为模板参数，并通过重载 * 和 -> 来充当值的迭代器。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T07:01:24.133

```
#define foreach(var, container) for (typeof((container).begin()) var = (container).begin(); var != (container).end(); ++var) 
```

C++ 中没有 typeof ......这是如何为你编译的？（它当然不是便携式的）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-08-15T15:32:30.140

`foreach_value`我根据代码实现了自己的`Boost` `foreach`：

```
#include <boost/preprocessor/cat.hpp>
#define MUNZEKONZA_FOREACH_IN_MAP_ID(x)  BOOST_PP_CAT(x, __LINE__)

namespace munzekonza {
namespace foreach_in_map_private {
inline bool set_false(bool& b) {
  b = false;
  return false;
}

}
}

#define MUNZEKONZA_FOREACH_VALUE(value, map)                                  \
for(auto MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_it) = map.begin();      \
        MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_it) != map.end();)       \
for(bool MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_continue) = true;       \
      MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_continue) &&               \
      MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_it) != map.end();          \
      (MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_continue)) ?              \
        ((void)++MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_it)) :          \
        (void)0)                                                              \
  if( munzekonza::foreach_in_map_private::set_false(                          \
          MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_continue))) {} else    \
  for( value = MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_it)->second;      \
        !MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_continue);              \
        MUNZEKONZA_FOREACH_IN_MAP_ID(_foreach_in_map_continue) = true) 
```

例如，您可以像这样在代码中使用它：

```
#define MUNZEKONZA_FOREACH_VALUE foreach_value

std::map<int, std::string> mymap;
// populate the map ...

foreach_value( const std::string& value, mymap ) {
  // do something with value
}

// change value
foreach_value( std::string& value, mymap ) {
  value = "hey";
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-02-01T22:29:01.893

```
#define zforeach(var, container) for(auto var = (container).begin(); var != (container).end(); ++var) 
```

没有 typeof() 所以你可以使用它：

```
decltype((container).begin()) var 
decltype(container)::iterator var 
```

# c++ - 如何测试函数调用顺序

> ID：78723
> 
> 赞同：3
> 
> 时间：2008-09-17T00:45:22.993
> 
> 标签：c++, unit-testing, tdd

考虑这样的代码：

```
class ToBeTested {
public:
  void doForEach() {
    for (vector<Contained>::iterator it = m_contained.begin(); it != m_contained.end(); it++) {
       doOnce(*it);
       doTwice(*it);
       doTwice(*it);
    }
  }
  void doOnce(Contained & c) {
    // do something
  }
  void doTwice(Contained & c) {
    // do something
  }

  // other methods
private:
  vector<Contained> m_contained;
} 
```

我想测试如果我用 3 个值填充向量，我的函数将以正确的顺序和数量调用。例如，我的测试可能如下所示：

```
tobeTested.AddContained(one);
tobeTested.AddContained(two);
tobeTested.AddContained(three);

BEGIN_PROC_TEST()
SHOULD_BE_CALLED(doOnce, 1)
SHOULD_BE_CALLED(doTwice, 2)
SHOULD_BE_CALLED(doOnce, 1)
SHOULD_BE_CALLED(doTwice, 2)
SHOULD_BE_CALLED(doOnce, 1)
SHOULD_BE_CALLED(doTwice, 2)

tobeTested.doForEach()
END_PROC_TEST() 
```

你建议如何测试这个？有没有办法用 CppUnit 或 GoogleTest 框架来做到这一点？也许其他一些单元测试框架允许执行这样的测试？

我知道如果不从这些函数中调用任何调试函数，这可能是不可能的，但至少可以在某些测试框架中自动完成。我不喜欢扫描跟踪日志并检查它们的正确性。

*UPD*：我不仅尝试检查对象的**状态，还尝试检查****执行顺序**以避免尽早出现性能问题（通常我想知道我的代码完全按照我的预期执行）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T01:04:13.493

您应该能够使用任何好的模拟框架来验证对协作对象的调用是否按特定顺序完成。

但是，您通常不会测试一个方法对同一类上的其他方法进行一些调用......为什么会这样？

通常，当您测试一个类时，您只关心测试其公开可见的状态。如果您测试其他任何内容，您的测试将阻止您以后进行重构。

我可以提供更多帮助，但我认为您的示例不一致（AddContained 方法的实现在哪里？）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T00:58:37.500

您可以查看[mockpp](http://mockpp.sourceforge.net/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T01:22:56.210

与其试图弄清楚调用了多少个函数以及以什么顺序调用，不如找到一组输入，如果你以正确的顺序调用事物，它们只能产生预期的输出。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T02:05:36.497

如果您对性能感兴趣，我建议您编写一个测量性能的测试。

检查当前时间，运行您关心的方法，然后再次检查时间。断言所花费的总时间小于某个值。

检查方法是否按特定顺序调用的问题是您的代码将不得不更改，并且您不想在发生这种情况时更新您的测试。您应该专注于测试*实际需求*，而不是测试满足该需求的实现细节。

也就是说，如果您真的想测试您的方法是否按特定顺序调用，您需要执行以下操作：

1.  将他们移到另一个班级，称之为 Collaborator
2.  将这个其他类的实例添加到 ToBeTested 类
3.  使用模拟框架将 ToBeTested 上的实例变量设置为 Collborator 类的模拟
4.  调用被测方法
5.  使用您的模拟框架来断言在您的模拟上以正确的顺序调用了这些方法。

我不是本地 cpp 演讲者，所以我无法评论您应该使用哪个模拟框架，但我看到其他一些评论者在这方面添加了他们的建议。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T00:56:17.023

一些模拟框架允许您设置有序的期望，这让您可以准确地说出您期望按特定顺序调用的函数。例如，[RhinoMocks](http://www.ayende.com/projects/rhino-mocks.aspx) for C# 允许这样做。

我不是 C++ 编码员，所以我不知道 C++ 有什么可用的，但这是一种可能允许您尝试执行的工具。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T01:13:15.127

[http://msdn.microsoft.com/en-au/magazine/cc301356.aspx](http://msdn.microsoft.com/en-au/magazine/cc301356.aspx)

这是一篇关于上下文绑定对象的好文章。它包含一些非常先进的东西，但如果你不懒惰并且真的想了解这类东西，它会非常有帮助。

最后，您将能够编写如下内容： [CallTracingAttribute()] public class TraceMe : ContextBoundObject {...}

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T01:23:25.320

您可以使用 ACE（或类似的）调试框架，并在您的测试中，将调试对象配置为流式传输到文件。然后你只需要检查文件。

# sql-server - 要包含在安装部署项目中的 SQL Server Express 64 位先决条件

> ID：78731
> 
> 赞同：0
> 
> 时间：2008-09-17T00:47:07.310
> 
> 标签：sql-server

在哪里可以获得 SQL Server Express 64 位先决条件以包含在 Visual Studio 2008 安装部署项目中。Visual Studio 2008 附带的先决条件仅是 32 位。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T00:58:51.790

看起来没有基于[这篇文章的](http://sqlserver-qa.net/blogs/x64/archive/2007/08/28/1761.aspx)SQL Express x64并且它还在[快速下载页面上说它在 WOW 中运行](http://www.microsoft.com/downloads/details.aspx?familyid=220549b5-0b07-4448-8848-dcc397514b41&displaylang=en)。但是，[SQL Server Express 2008](http://www.microsoft.com/downloads/details.aspx?FamilyID=58ce885d-508b-45c8-9fd3-118edd8e6fff&DisplayLang=en)确实有 x64 版本。

# database - 在 URL 中存储数据库密钥的一些技术是什么

> ID：78752
> 
> 赞同：4
> 
> 时间：2008-09-17T00:52:53.083
> 
> 标签：database

我读过在 URL 中使用数据库键是一件坏事。

例如，

我的表有 3 个字段：`ID:int`, `Title:nvarchar(5)`,`Description:Text`

我想创建一个显示记录的页面。就像是 ...

```
http://server/viewitem.aspx?id=1234 
```

1.  首先，有人可以详细说明为什么这是一件坏事吗？

2.  其次，有哪些方法可以解决在 url 中使用主键的问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T00:56:56.570

我认为在 URL 中使用主键是完全合理的。

然而，一些考虑：

1）避免SQL注入攻击。如果你只是盲目地接受 id URL 参数的值并将其传递到 DB 中，那么你就有风险了。确保您对输入进行了清理，使其与您拥有的任何格式的键匹配（例如，去除任何非数字字符）。

2）搜索引擎优化。如果您的 URL 包含有关该项目的一些上下文（例如“大蓬松兔子”而不是 1234），这会有所帮助。这有助于搜索引擎看到您的页面是相关的。它对您的用户也很有用（我可以从我的浏览器历史记录中知道哪条记录是哪条记录，而无需记住数字）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T00:57:10.593

这本身并不是一件坏事，但它有一些警告。

需要注意的一点是，有人可以输入不同的键，并且可能会提取您不希望/期望他们获得的数据。您可以通过增加密钥空间（例如使 ids 随机 64 位数字）来减少成功的机会。

警告二是，如果您正在运行公共服务并且您有竞争对手，如果它们是单调的，他们可能能够从您的密钥中提取业务信息。示例：今天创建一个帖子，在一周内创建一个帖子，比较 Id，您已经提取了发布帖子的速率。

警告三是它容易受到 SQL 注入攻击。但你永远不会犯这些错误，对吧？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T01:04:43.023

在 URL 中使用 ID 不一定是坏事。尽管由专业人员完成，但该站点仍使用它。

他们怎么会有危险？当允许用户更新或删除属于他们的条目时，开发人员会实施某种身份验证，但*他们经常忘记*检查该条目是否真的**属于**您。恶意用户可能会形成一个 URL，例如`"/questions/12345/delete"`当他注意到“12345”属于您时，它将被删除。

在执行此类操作之前，程序员应确保具有任意 ID 的数据库条目确实属于当前登录的用户。

**有时有充分的理由避免在 URL 中公开 ID。**在这种情况下，开发人员通常会生成他们为每个条目存储的随机*哈希值，并在 URL 中使用这些哈希值。*篡改 URL 栏的恶意人员将很难猜出属于其他用户的哈希值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T01:08:33.140

安全和隐私是避免这样做的主要原因。任何泄露您的数据结构的信息都是黑客可以用来访问您的数据库的更多信息。正如 mopoke 所说，您还会将自己暴露在相当常见的 SQL 注入攻击中，并且可能对您的数据库和应用程序造成极大的危害。从隐私的角度来看，如果您显示任何敏感或个人信息，任何人都可以用一个数字来检索信息，如果您没有身份验证机制，您可能会将您的信息置于危险之中。此外，如果查询您的数据库那么容易，那么您就会面临拒绝服务攻击，因为他们知道每个人都会得到响应，因为他们知道每个人都会对您的服务器进行循环访问。

无论数据的性质如何，我倾向于建议不要在 URL 中共享任何可能泄露有关您的应用程序架构的任何内容，在我看来，您只是在招惹麻烦（我对隐藏的字段也有同样的感觉真的隐藏）。

为了解决这个问题，我们通常在传递参数之前对其进行加密。在某些情况下，加密的 URL 还包括某种形式的验证/身份验证机制，因此服务器可以决定是否可以处理。

当然，每个应用程序都是不同的，您想要实现的安全级别必须与功能、预算、性能等相平衡。但我认为在数据安全方面偏执并没有什么问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T00:55:23.157

有时这有点迂腐，但您希望对事物使用唯一的业务标识符，而不是代理键。

它可以像 ItemNumber 而不是 Id 一样简单。

Id 是一个数据库问题，而不是业务/用户问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T00:59:00.697

1.  在 URL 中使用整数主键存在安全风险。有人很容易使用任何号码发帖。例如，通过正常的 Web 应用程序使用，用户创建一个 ID 为 45 (viewitem/id/45) 的用户记录。这意味着用户自动知道还有 44 个其他用户。除非您有正确的授权系统，否则他们可以通过创建自己的 url (viewitem/id/32) 来查看其他用户的信息。

2a. 使用适当的授权。2b。对主键使用 GUID。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T01:01:44.543

显示密钥本身并不坏，因为它没有真正的意义，但显示获取项目访问权限的方法是不好的。

例如，假设您有一家在线商店出售来自 2 个商家的商品。商家 A 有商品 (1, 3, 5, 7)，商家 B 有商品 (2, 4, 5, 8)。

如果我在商家 A 的网站上购物并看到： [http://server/viewitem.aspx?id=1](http://server/viewitem.aspx?id=1)

然后我可以尝试摆弄它并输入： [http://server/viewitem.aspx?id=2](http://server/viewitem.aspx?id=2)

这可能让我访问一个我不应该访问的项目，因为我正在与商家 A 而不是 B 一起购物。通常，允许用户摆弄类似的东西会导致安全问题。另一个简短的例子是员工可以查看他们的个人信息 (id=382)，但他们输入其他人的 id 以直接转到其他人的个人资料。

现在，话虽如此......这还不错，只要系统中内置安全检查以确保人们在做他们应该做的事情（例如：不与其他商家购物或不查看其他员工）。

一种机制是在会话中存储信息，但有些人不喜欢这样。我不是网络程序员，所以我不会讨论这个:)

最主要的是确保系统是安全的。永远不要相信用户返回的数据。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T01:26:33.207

每个人似乎都在发布使用这种技术的“问题”，但我还没有看到任何解决方案。有什么替代方案。URL 中必须有一些东西可以唯一地定义您想要向用户显示的内容。我能想到的唯一其他解决方案是将整个站点从表单中运行，并让浏览器将值发布到服务器。这对代码来说有点棘手，因为所有链接都需要表单提交。此外，对于网站的用户来说，输入他们想要的任何价值只是最低限度的困难。这也不允许用户为任何内容添加书签，这是一个主要缺点。

@John Virgolino 提到加密整个查询字符串，这可能有助于这个过程。然而，对于大多数应用程序来说，这似乎有点太过分了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-05T01:54:29.553

我一直在阅读这个，寻找解决方案，但正如@Kibbee 所说，没有真正的共识。

我可以想到一些可能的解决方案：

1）如果您的表使用整数键（可能），请在标识符中添加校验和数字。这样，（简单的）注入攻击通常会失败。收到请求后，只需删除校验和数字并检查它是否仍然匹配 - 如果它们不匹配，那么您就知道 URL 已被篡改。这种方法也隐藏了你的“增长率”（有点）。

2）最初存储数据库记录时，保存一个“辅助键”或您乐于成为公共 id 的值。这必须是唯一的并且通常不是连续的 - 示例是整数 ID 的 UUID/Guid 或哈希 (MD5)，例如[http://server/item.aspx?id=AbD3sTGgxkjero](http://server/item.aspx?id=AbD3sTGgxkjero)（但要小心不兼容的字符与http）。NB。次要字段需要被索引，并且您将失去在 1) 中获得的集群优势。

# vba - 打印时在 MS Access 中进行查询默认为横向

> ID：78757
> 
> 赞同：1
> 
> 时间：2008-09-17T00:55:01.533
> 
> 标签：vba, database, ms-access, printing

如何以编程方式在 MS Access 中进行查询，打印时默认为横向，特别是在将其作为数据透视图查看时？我目前正在 MS Access 2003 中尝试此操作，但希望看到任何版本的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T03:26:01.187

以下函数应该可以解决问题：

```
Function SetLandscape()
   Application.Printer.Orientation = acPRORLandscape
End Function 
```

应该能够从 autoexec 函数调用它以确保它始终运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T03:43:13.860

是的，ahockley 的调用将应用程序的打印机方向设置为横向。我尝试了一个实验，效果很好。我知道这不会产生一个数据透视表，但我没有设置一个使用，所以它打开并打印一个常规查询。

```
Private sub
    Application.Printer.Orientation = acPRORLandscape
    DoCmd.OpenQuery "qry1", acViewNormal, acReadOnly
    DoCmd.PrintOut acPrintAll
End Sub 
```

如果要在打印后关闭查询，请添加：

```
docmd.Close acQuery, "qry1", acSaveNo 
```

# python - 在 Python 中的另一个类中定义一个类有什么好处吗？

> ID：78799
> 
> 赞同：125
> 
> 时间：2008-09-17T01:02:31.157
> 
> 标签：python, oop

我在这里谈论的是嵌套类。本质上，我有两个正在建模的课程。一个 DownloadManager 类和一个 DownloadThread 类。这里明显的 OOP 概念是组合。然而，组合并不一定意味着嵌套，对吧？

我的代码看起来像这样：

```
class DownloadThread:
    def foo(self):
        pass

class DownloadManager():
    def __init__(self):
        dwld_threads = []
    def create_new_thread():
        dwld_threads.append(DownloadThread()) 
```

但现在我想知道是否存在嵌套更好的情况。就像是：

```
class DownloadManager():
    class DownloadThread:
        def foo(self):
            pass
    def __init__(self):
        dwld_threads = []
    def create_new_thread():
        dwld_threads.append(DownloadManager.DownloadThread()) 
```

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2008-09-17T01:12:59.480

当“内部”类是一次性的时，您可能希望这样做，它永远不会在外部类的*定义*之外使用。例如要使用元类，有时这样做很方便

```
class Foo(object):
    class __metaclass__(type):
        .... 
```

如果您只使用一次，而不是单独定义元类。

唯一一次我使用这样的嵌套类时，我只使用外部类作为命名空间来将一堆密切相关的类组合在一起：

```
class Group(object):
    class cls1(object):
       ...

    class cls2(object):
       ... 
```

然后从另一个模块中，您可以导入 Group 并将它们称为 Group.cls1、Group.cls2 等。但是有人可能会争辩说，您可以通过使用模块完成完全相同的操作（也许以一种不那么容易混淆的方式）。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-09-17T01:14:33.687

我不知道 Python，但你的问题似乎很笼统。如果它特定于 Python，请忽略我。

类嵌套是关于范围的。如果您认为一个类仅在另一个类的上下文中才有意义，那么前者可能是成为嵌套类的良好候选者。

将帮助类作为私有的嵌套类是一种常见的模式。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2018-04-13T08:46:20.140

嵌套类还有另一种用法，当人们想要构造其增强功能被封装在特定嵌套类中的继承类时。

看这个例子：

```
class foo:

  class bar:
    ...  # functionalities of a specific sub-feature of foo

  def __init__(self):
    self.a = self.bar()
    ...

  ...  # other features of foo

class foo2(foo):

  class bar(foo.bar):
    ... # enhanced functionalities for this specific feature

  def __init__(self):
    foo.__init__(self) 
```

请注意，在 的构造函数中，当正在构造的对象实际上是一个对象时`foo`，该行将`self.a = self.bar()`构造 a `foo.bar`，而当正在构造的对象实际上是一个`foo`对象`foo2.bar`时，该行将构造一个`foo2`对象。

如果类`bar`是在类之外定义的`foo`，以及它的继承版本（`bar2`例如，将被调用），那么定义新类`foo2`会更加痛苦，因为构造函数的`foo2`第一行需要替换为`self.a = bar2()`,这意味着重写整个构造函数。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-17T01:34:41.767

你可以使用一个类作为类生成器。喜欢（在一些即兴代码中：）

```
class gen(object):
    class base_1(object): pass
    ...
    class base_n(object): pass

    def __init__(self, ...):
        ...
    def mk_cls(self, ..., type):
        '''makes a class based on the type passed in, the current state of
           the class, and the other inputs to the method''' 
```

我觉得当您需要此功能时，您会非常清楚。如果您不需要做类似的事情，那么它可能不是一个好的用例。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-17T01:52:55.263

这样做确实没有任何好处，除非您正在处理元类。

类：套件真的不是你想象的那样。这是一个奇怪的范围，它会做一些奇怪的事情。真的连课都不上！它只是收集一些变量的一种方式——类的名称、基础、属性的小字典和元类。

名称、字典和基础都传递给元类函数，然后将其分配给 class:suite 所在范围内的变量“name”。

通过弄乱元类，实际上是通过在标准类中嵌套类，您可以获得什么，更难阅读代码，更难理解代码，以及在不熟悉为什么“类”的情况下非常难以理解的奇怪错误范围与任何其他 python 范围完全不同。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-08-17T14:26:53.150

此功能的一个很好的用例是错误/异常处理，例如：

```
class DownloadManager(object):
    class DowndloadException(Exception):
        pass

    def download(self):
        ... 
```

现在阅读代码的人知道与此类相关的所有可能的异常。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-04-01T07:49:31.137

无论哪种方式，在类内部或外部定义都可以。这是一个员工工资计划程序，其中帮助类 EmpInit 嵌入到 Employee 类中：

```
class   Employee:

    def level(self, j):
        return j * 5E3

    def __init__(self, name, deg, yrs):
        self.name = name
        self.deg = deg
        self.yrs = yrs
        self.empInit = Employee.EmpInit(self.deg, self.level)
        self.base = Employee.EmpInit(self.deg, self.level).pay

    def pay(self):
        if self.deg in self.base:
            return self.base[self.deg]() + self.level(self.yrs)
        print(f"Degree {self.deg} is not in the database {self.base.keys()}")
        return 0

    class   EmpInit:

        def __init__(self, deg, level):
            self.level = level
            self.j = deg
            self.pay = {1: self.t1, 2: self.t2, 3: self.t3}

        def t1(self):   return self.level(1*self.j)
        def t2(self):   return self.level(2*self.j)
        def t3(self):   return self.level(3*self.j)

if  __name__ == '__main__':
    for loop in range(10):
        lst = [item for item in input(f"Enter name, degree and years : ").split(' ')]
        e1 = Employee(lst[0], int(lst[1]), int(lst[2]))
        print(f'Employee {e1.name} with degree {e1.deg} and years {e1.yrs} is making {e1.pay()} dollars')
        print("EmpInit deg {0}\nlevel {1}\npay[deg]: {2}".format(e1.empInit.j, e1.empInit.level, e1.base[e1.empInit.j])) 
```

要在外部定义它，只需取消缩进 EmpInit 并将 Employee.EmpInit() 更改为简单的 EmpInit() 作为常规的“has-a”组合。但是，由于 Employee 是 EmpInit 的控制器并且用户不直接实例化或与它交互，因此在内部定义它是有意义的，因为它不是一个独立的类。另请注意，实例方法 level() 被设计为在此处的两个类中调用。因此，它也可以方便地定义为 Employee 中的静态方法，这样我们就不需要将它传递给 EmpInit，而只需使用 Employee.level() 调用它。

# ruby-on-rails - SQLite3::BusyException

> ID：78801
> 
> 赞同：38
> 
> 时间：2008-09-17T01:02:39.067
> 
> 标签：ruby-on-rails, ruby, database, sqlite

现在使用 SQLite3 运行一个 Rails 站点。

大约每 500 个请求左右，我得到一个

ActiveRecord::StatementInvalid (SQLite3::BusyException: 数据库被锁定:...

解决这个问题的方法是什么，对我的代码的侵入性最小？

我目前正在使用 SQLLite，因为您可以将数据库存储在源代码控制中，这使得备份变得自然，并且您可以非常快速地推出更改。但是，它显然不是真正为并发访问设置的。明天早上我将迁移到 MySQL。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-04-10T22:15:41.217

您提到这是一个 Rails 站点。Rails 允许您在 database.yml 配置文件中设置 SQLite 重试超时：

```
production:
  adapter: sqlite3
  database: db/mysite_prod.sqlite3
  timeout: 10000 
```

超时值以毫秒为单位指定。将其增加到 10 或 15 秒应该会减少您在日志中看到的 BusyExceptions 的数量。

不过，这只是一个临时解决方案。如果您的站点需要真正的并发，那么您将不得不迁移到另一个数据库引擎。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-18T18:21:29.607

默认情况下，如果数据库繁忙并被锁定，sqlite 会立即返回一个阻塞、繁忙的错误。您可以要求它等待并继续尝试一段时间，然后再放弃。这通常可以解决问题，除非您确实有 1000 个线程访问您的数据库，否则我同意 sqlite 是不合适的。

```
    // 如果数据库锁定，则设置 SQLite 等待并重试最多 100 毫秒
    sqlite3_busy_timeout（分贝，100）；

```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-19T15:40:49.503

所有这些事情都是正确的，但它并没有回答这个问题，这很可能是：为什么我的 Rails 应用程序偶尔会在生产环境中引发 SQLite3::BusyException？

@Shalmanese：生产托管环境是什么样的？它在共享主机上吗？包含 SQLite 数据库的目录是否位于 NFS 共享上？（可能在共享主机上）。

这个问题可能与带有 NFS 共享的文件锁定现象和 SQLite 缺乏并发性有关。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-23T15:46:39.990

只是为了记录。在使用 Rails 2.3.8 的一个应用程序中，我们发现 Rails 忽略了 Rifkin Habsburg 建议的“超时”选项。

经过进一步调查，我们在 Rails 开发中发现了一个可能相关的错误：http: [//dev.rubyonrails.org/ticket/8811](http://dev.rubyonrails.org/ticket/8811)。经过更多调查，我们找到[了解决方案](http://webcache.googleusercontent.com/search?q=cache:6_UlZMo3eH4J:https://rails.lighthouseapp.com/projects/8994/tickets/5941+ActiveRecord+SQLite3+BusyException&cd=10&hl=en&ct=clnk&client=ubuntu&source=www.google.com)（使用 Rails 2.3.8 测试）：

编辑这个 ActiveRecord 文件：activerecord-2.3.8/lib/active_record/connection_adapters/sqlite_adapter.rb

替换这个：

```
 def begin_db_transaction #:nodoc:
    catch_schema_changes { @connection.transaction }
  end 
```

和

```
 def begin_db_transaction #:nodoc:
    catch_schema_changes { @connection.transaction(:immediate) }
  end 
```

就这样！我们没有注意到性能下降，现在该应用程序支持更多的请愿而不中断（它等待超时）。Sqlite 不错！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-10-01T20:35:48.520

如果您有这个问题，但**增加超时并没有改变任何东西**，您可能还有事务的另一个并发问题，总结如下：

1.  开始事务（获取*共享*锁）
2.  从 DB 中读取一些数据（我们仍在使用*SHARED*锁）
3.  同时，另一个进程启动事务并写入数据（获取*保留*锁）。
4.  然后你尝试写，你现在尝试请求*RESERVED*锁
5.  **SQLite立即**引发 SQLITE_BUSY 异常（与您的超时无关），因为您之前的读取可能在它获得*RESERVED*锁时不再准确。

解决此问题的一种方法是通过将选项填充到驱动程序来修补`active_record`sqlite 适配器以直接在事务开始时获取*保留锁。*`:immediate`这会稍微降低性能，但至少您的所有事务都会遵守您的超时并一个接一个地发生。以下是如何使用`prepend`（Ruby 2.0+）将其放入初始化程序中：

```
module SqliteTransactionFix
  def begin_db_transaction
    log('begin immediate transaction', nil) { @connection.transaction(:immediate) }
  end
end

module ActiveRecord
  module ConnectionAdapters
    class SQLiteAdapter < AbstractAdapter
      prepend SqliteTransactionFix
    end
  end
end 
```

在此处阅读更多信息：[https ://rails.lighthouseapp.com/projects/8994/tickets/5941-sqlite3busyexceptions-are-raised-immediately-in-some-cases-despite-setting-sqlite3_busy_timeout](https://rails.lighthouseapp.com/projects/8994/tickets/5941-sqlite3busyexceptions-are-raised-immediately-in-some-cases-despite-setting-sqlite3_busy_timeout)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-02-13T07:09:43.450

```
bundle exec rake db:reset 
```

它对我有用，它将重置并显示待处理的迁移。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-11T03:45:18.117

Sqlite 可以允许其他进程等到当前进程完成。

当我知道我可能有多个进程试图访问 Sqlite DB 时，我使用这条线进行连接：

conn = sqlite3.connect('文件名'，**isolation_level = 'exclusive'** )

根据 Python Sqlite 文档：

> 您可以通过 connect() 调用的isolation_level 参数或连接的isolation_level 属性来控制pysqlite 隐式执行（或根本不执行）哪种BEGIN 语句。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-02-25T00:56:18.000

我对 rake db:migrate 也有类似的问题。问题是工作目录位于 SMB 共享上。我通过将文件夹复制到我的本地计算机来修复它。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-12-13T13:11:51.180

大多数答案是针对 Rails 而不是原始 ruby​​，而 OPs 的问题是针对 Rails，这很好。:)

因此，如果任何原始 ruby​​ 用户有这个问题，并且没有使用 yml 配置，我只想把这个解决方案留在这里。

实例化连接后，您可以这样设置：

```
db = SQLite3::Database.new "#{path_to_your_db}/your_file.db"
db.busy_timeout=(15000) # in ms, meaning it will retry for 15 seconds before it raises an exception.
#This can be any number you want. Default value is 0. 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-17T01:14:50.380

来源：[此链接](http://nessie.de/mroth/lua-sqlite3/documentation.html)

```
- Open the database
db = sqlite3.open("filename")

-- Ten attempts are made to proceed, if the database is locked
function my_busy_handler(attempts_made)
  if attempts_made < 10 then
    return true
  else
    return false
  end
end

-- Set the new busy handler
db:set_busy_handler(my_busy_handler)

-- Use the database
db:exec(...) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-17T01:17:57.877

遇到锁时正在访问哪个表？

你有长期交易吗？

你能弄清楚遇到锁时哪些请求仍在处理中吗？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-17T01:33:32.783

啊——上周我存在的祸根。*当任何进程写入*数据库时​​，Sqlite3 会锁定 db 文件。IE 任何 UPDATE/INSERT 类型的查询（出于某种原因也选择 count(*)）。但是，它可以很好地处理多次读取。

所以，我终于很沮丧地围绕数据库调用编写了我自己的线程锁定代码。通过确保应用程序在任何时候只能有一个线程写入数据库，我能够扩展到 1000 个线程。

是的，它慢得要命。但它也足够快和*正确*，这是一个很好的属性。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-11-02T04:55:16.707

我在 sqlite3 ruby​​ 扩展上发现了一个死锁并在这里修复它：试一试，看看这是否解决了你的问题。

```
    https://github.com/dxj19831029/sqlite3-ruby

```

我打开了一个拉取请求，他们没有回复了。

无论如何，如 sqlite3 本身所述，预计会出现一些繁忙的异常。

**请注意**这种情况：[sqlite busy](http://www.sqlite.org/c3ref/busy_handler.html)

```
    繁忙的处理程序的存在并不能保证它会在有
    锁争用。如果 SQLite 确定调用忙处理程序可能会导致
    死锁，它将继续并返回 SQLITE_BUSY 或 SQLITE_IOERR_BLOCKED 而不是
    调用繁忙的处理程序。考虑一个进程持有读锁的场景
    它正在尝试提升为保留锁，而第二个进程正在持有保留锁
    它试图提升为独占锁的锁。第一个过程无法继续
    因为它被第二个阻止，第二个进程无法继续，因为它是
    被第一个挡住了。如果两个进程都调用繁忙的处理程序，则两者都不会产生任何
    进步。因此，SQLite 为第一个进程返回 SQLITE_BUSY，希望这
    将诱导第一个进程释放其读锁并允许第二个进程
    继续。

```

如果满足此条件，则超时不再有效。为避免这种情况，请不要将 select 放在 begin/commit 中。或使用独占锁开始/提交。

希望这可以帮助。:)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-01-31T12:38:00.070

这通常是多个进程访问同一个数据库的连续错误，即如果 RubyMine 中没有设置“只允许一个实例”标志

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-02-13T07:22:08.070

尝试运行以下命令，它可能会有所帮助：

```
ActiveRecord::Base.connection.execute("BEGIN TRANSACTION; END;") 
```

来自：[Ruby：SQLite3::BusyException：数据库被锁定：](https://stackoverflow.com/questions/7154664/ruby-sqlite3busyexception-database-is-locked)

这可以清除任何阻碍系统的交易

* * *

## 回答 #16

> 赞同：-9
> 
> 时间：2008-09-17T01:05:23.350

我相信当交易超时时会发生这种情况。您确实应该使用“真实”数据库。像 Drizzle 或 MySQL 之类的东西。为什么您更喜欢 SQLite 而不是之前的两个选项？

# refactoring - 无情地重构或构建一个扔掉？

> ID：78806
> 
> 赞同：24
> 
> 时间：2008-09-17T01:03:41.450
> 
> 标签：refactoring

> 在使用新的系统概念或新技术的地方，人们必须建立一个可以丢弃的系统，因为即使是最好的计划也不是无所不知的，以至于第一次就做好了。因此**打算扔掉一个；无论如何，你会的。**
> 
> ——弗雷德·布鲁克斯，[*神话般的人月*](http://en.wikipedia.org/wiki/The_Mythical_Man-Month)[强调我的]

建一个扔掉。他们就是这么告诉我的。然后他们告诉我，我们现在都很[敏捷](http://agilemanifesto.org/)，所以我们应该[无情地重构](http://c2.com/cgi/wiki?RefactorMercilessly)。是什么赋予了？

重构我的出路**总是**更好吗？如果没有，任何人都可以提出一个经验法则来帮助我决定何时坚持下去，何时放弃并重新开始？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-17T01:10:05.010

如果你在做测试驱动的开发，你几乎可以通过重构来摆脱任何麻烦。我已经毫不费力地更改了主要的设计决策，并挽救了十年前的代码库。

唯一的例外是当您发现您的架构从头到尾完全错误时。例如，如果您使用线程编写应用程序，但您发现需要一堆异步状态机。到那时，继续扔掉初稿。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-17T02:41:09.063

## 早扔，晚重构

对于小型系统来说，丢弃是可以的，但如果系统的规模很大，你根本没有资源这样做。

但是，您可以创建一个仅实现实际项目非常重要的功能的小型试点项目。经过一些试验和错误、学习和丢弃东西，你最终会获得一个坚实的核心，并对实际项目有更好的理解。然后，通过添加所需的所有功能，让项目的规模扩大。但是一旦你到了那里，你就不能扔掉核心。只有重构。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-17T01:07:03.160

如果你足够无情，重构的最终结果将与你从头开始重建时得到的结果非常接近，但在此过程中你不会被非工作系统卡住。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-17T02:50:15.283

The Mythical Man Month 的中心点之一是软件开发的难点在于弄清楚该说什么，而不是如何说。

我最近对此的解释是，您从初稿中获得的最大价值是您收集并以测试形式保存的需求。如果您注意不要测试实际上不是系统要求的东西，您*可以*重构自己的方式来摆脱任何混乱。

只要您不将自己编码到一个必须开始丢弃测试的陷阱中，您就可以在不丢失大量实际工作的情况下丢弃尽可能多的代码。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-19T10:28:13.700

我在这里的一般建议是将现有系统从其糟糕的设计重构为具有更好设计的系统。这可以维护系统并允许它随时部署。如果您从头开始，可能需要一段时间才能部署，或者永远不会。

如果您只是在谈论在没有现有系统的情况下编写一些全新的代码，那么编写一点代码通常是个好主意，但是您想要，然后将其丢弃，因为它从未部署并重新开始（使用 TDD）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-17T01:18:16.800

有一点是重构是浪费时间的。你只需要从头开始。如果你保持你的设计相当灵活，并且你意识到你还不知道一切，你就不必扔掉任何东西。当然，一个类可能会变得多余，但你不会丢弃整个系统。

有一个灵活的设计是能够正确重构的必要条件。没有设计或死板的设计意味着你最终会丢掉一些东西——要么是因为你无法重构，要么是因为不断的重构会降低代码库的可维护性。很少有人能做到一丝不苟和纪律严明，能够完成一长串小规模的重构以保持完整性。除非你有一支全明星队，否则这种退化会发生！

TL;DR：你可以通过重构来摆脱大多数麻烦。但是，有时您将无法重构过去的某些设计元素。当这种情况发生时，是时候重新开始了——尽管希望您可以重新使用您现有的一些组件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-17T02:43:58.840

不同的情况需要不同的方法。就我个人而言，我更喜欢尽可能地重构为更好的设计。与重写相比，重构导致的错误更少。

但是，即使您打算扔掉一个，编写一堆验收测试以确保您的第二个版本在正确的轨道上仍然是一个好主意。然后，您可以逐步迁移到下一个版本，同时确保您的功能不会从用户的角度发生变化。听起来有点像重构，我猜只是有点草率。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-17T02:59:56.413

在谈论敏捷时，你可以同时做这两件事，但一般来说，你会做[尖峰](http://www.extremeprogramming.org/rules/spike.html)（原型）只是为了尝试特定的问题，了解它们并能够做出更好的估计。当你真正编写应用程序时，当你做一个简单的峰值和重构时扔掉。

亲切的问候

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-17T01:09:58.410

当我尝试解决新问题或新功能时，我会制作原型。之后，我将根据我所学的进行重建。实际上，这听起来很像重构……什么？也许是同一件事？嗯……

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-17T02:01:07.147

我认为扔掉一个有时是最好的方法，但它可能会伤害。我发现效果很好的一件事是扔掉一个，但要选择好你的技术。

例如，我用 Ruby on Rails 编写了一个大型代码库，在过去的 2-3 年里，RoR 有了很大的进步。我还在架构方面做出了一些需要修复的决定。所以，我要扔掉一个，然后从头开始构建一个新的。但是，我仍然可以使用 70-80% 左右的旧代码，因为我仍在使用 Ruby 和 Rails 编写代码。

对此有所帮助的主要因素是 Rails 迫使您编写结构良好的代码，并将业务逻辑和表示层分离。我第一次没有把它完美，但由于一切都很好地分离和干燥，将代码移植到 Rails v2.1，重新架构问题区域，重新编写一些“问题”功能一直是相当无痛的体验。

因此，通过从一开始就选择一项伟大的技术，我已经能够扔掉一个，但仍然可以带走 70-80% 仍然有效的旧东西。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-17T02:05:05.983

在《神话人物月》的一篇文章中，布鲁克斯警告说，他发现如果你确实打算扔掉 1 个，那么你最终会扔掉 2 个！

我个人在现实生活中看到了这种情况；我们将项目的第 1 版分配给一个平庸的程序员作为快速丢弃，因为“我们计划稍后丢弃它——无论如何我们都会丢弃它。” 我们最终不得不为第 2 版重写它，但那个也被扔掉了。我从未见过第 3 版——公司倒闭了。

我认为当 Brooks 说“打算扔掉一个，无论如何你都会扔掉”时，它更像是“待发现的 bug 数量为 'n+1'”。也就是说，这是对墨菲定律的严肃陈述，而不是实用建议。从中吸取的教训是原型是有价值的，好的写作就是重写，不要害怕放弃一些不起作用的东西。

然而，它必须归结为一个判断电话，因为正如 Joel Spolsky 在几篇文章中所谈到的那样，丢弃并重新开始的选择很诱人​​，因为代码编写比阅读更容易，编写比维护更有趣，所以你的自然倾向将永远是重新开始，即使这并不是最好的事情。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-12-16T16:31:11.703

我认为您的版本控制系统在这里发挥了重要作用。如果你运行一个易于分支的分布式版本控制系统（现在是 git、mercurial），那么你将能够更轻松地进行原型设计和重构，同时仍然拥有有效的工作副本。其他任何事情都需要更多的纪律。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-12-21T11:11:53.697

作为该组织的开发经理，我“不允许”编写生产代码。

我（ab）使用该规则来删除解决一个或其他问题的快速、肮脏的概念验证代码，然后我将其签入源代码控制并指向一个“适当的”开发人员并说“这就是它的方式做完了，现在好好做。”

这与我们在这里“扔掉”的距离一样接近，而且我最多可能要花几个小时才能凑齐。花时间在错误处理、边界检查和所有其他可以编写好代码的东西上，对于这类工作来说是浪费时间，但这意味着那些因编写生产代码而获得报酬的人可以花他们的时间。编写生产代码的时间，并且在代码审查时间方面不要有“它只是一个原型”之类的借口。

建造一个扔掉的东西经常被用作没有正确完成工作的借口。这意味着您实际上并没有在此过程中遇到足够多的问题来学习足够的知识来充分利用任何人的时间。而做的恰到好处，却又把它扔掉，更是浪费。

正如一些人之前所说，任何软件中最重要的功能是它可以发布。考虑到这一点，我会在任何一天构建“一个让人们为我付费的产品”，而我在重构方面的无情就是只允许足够的重构来获得一个可以工作且可以合理维护的产品。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-10-09T17:25:37.547

很容易在任何支持分支概念的配置管理系统上构建一个丢弃。如果您要对现有系统进行彻底的设计更改，该系统是该领域的并且是您的薪水来源；你该死的更好的分支；原型; 如果它不起作用，就把它扔掉。

重构大型遗留摇钱树系统通常会导致简单的老式黑客攻击。重构听起来比我猜的黑客要好得多。

# java - 是否有将 C# 代码转换为 Java 代码的有效工具？

> ID：78811
> 
> 赞同：92
> 
> 时间：2008-09-17T01:04:20.590
> 
> 标签：java, c#, code-translation

是否有将 C# 代码转换为 Java 代码的有效工具？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-09-17T01:30:28.733

我从来没有遇到过 C#->Java 转换工具。语法很简单，但框架却截然不同。即使有工具，我也强烈建议不要使用它。我从事过几个“迁移”项目，不能过分强调说，虽然转换似乎是一个不错的选择，但转换项目*总是总是会*变成钱坑。这不是捷径，你最终得到的是不可读的代码，并且没有利用目标语言。从个人经验来看，假设重写是更便宜的选择。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-08-03T14:00:17.400

我们有一个需要在 C# 和 Java 中维护的应用程序。由于我们积极维护这个产品，一次性移植不是一种选择。我们调查了 Net2Java 和 Mainsoft 工具，但都没有满足我们的要求（Net2Java 缺乏健壮性，而 Mainsoft 成本高且缺乏源代码转换）。我们创建了自己的名为[CS2J](http://www.cs2j.com)的工具，它作为我们夜间构建脚本的一部分运行，并将我们的 C# 代码非常有效地移植到 Java。现在它正好可以翻译我们的应用程序，但要被认为是一个综合工具还有很长的路要走。我们已经将这项技术授权给一些有类似需求的各方，并且我们正在考虑公开发布它的想法，但我们的核心业务这些天让我们太忙了。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-04-10T11:57:00.057

这篇博客[文章建议了](http://lpeer.blogspot.com/2010/04/switching-from-c-to-java.html)[有形](http://www.tangiblesoftwaresolutions.com/)的有用结果。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-17T01:27:32.737

Microsoft 有一个工具可以将 java 转换为 C#。对于相反的方向，看看[这里](http://www.cs2j.com/)和[这里](http://www.theserverside.com/news/thread.tss?thread_id=40344)。如果这不起作用，手动转换源代码应该不会花费太长时间，因为 C# 和 java 非常相似，

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-01-13T16:47:29.623

虽然这是一个老问题，但看看 xmlVM [http://www.xmlvm.org/clr2jvm](http://www.xmlvm.org/clr2jvm)，我不确定它是否足够成熟，尽管它已经存在了好几年了。我相信，XMLvm 主要用于将 Android Java 应用程序翻译到 iPhone，然而，它基于 XML 代码翻译的框架足够灵活，可以进行其他组合（参见网站上的图表）。

至于进行这种转换的原因，也许需要“劫持”一些[高度丰富的 oss 代码](http://code.google.com/codesearch?hl=en&lr=&q=license%3absd|apache|mit|zlib+lang%3ac%23+game&sbtn=Search)并在他/他们自己的 [Java] 项目中使用它。

干杯

富有的

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-06-29T07:24:33.110

[这些](http://www.tangiblesoftwaresolutions.com/)家伙似乎对此有解决方案，但我还没有尝试过。他们也有转换器的演示版本。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-12T16:39:23.593

尝试查看[Net2Java](https://net2java.dev.java.net/index.html)在我看来，从 C# 到 Java 的自动（或至少半自动）转换的最佳选择

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-17T01:13:11.257

它们不直接转换，但它允许 .NET 和 J2EE 之间的互操作性。

[http://www.mainsoft.com/products/index.aspx](http://www.mainsoft.com/products/index.aspx)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-17T01:57:57.483

C# 比 Java 有更多的特性。以委托为例：许多非常简单的 C# 应用程序都使用委托，而 Java 人员认为观察者模式就足够了。因此，为了让工具转换使用委托的 C# 应用程序，它必须将结构从使用委托转换为观察者模式的实现。另一个问题是 C# 方法默认不是虚拟的，而 Java 方法是虚拟的。此外，Java 没有办法使方法成为非虚拟方法。这产生了另一个问题：C# 中的应用程序可以通过多态性以不直接转换为 Java 的方式利用非虚拟方法行为。如果您环顾四周，您可能会发现有很多工具可以将 Java 转换为 C#，因为它是一种更简单的语言（请不要' 我没有说更糟，我说的更简单）；但是，您会发现很少有像样的工具可以将 C# 转换为 Java。

我建议您更改从 Java 转换为 C# 的方法，因为从长远来看，它会减少令人头疼的问题。Db4Objects 最近向公众发布了他们用来将 Db4o 转换为 C# 的内部工具。它被称为锐化。如果您在他们的网站上注册，您可以查看此链接，其中包含有关如何使用 Sharpen 的说明：http: [//developer.db4o.com/Resources/view.aspx/Reference/Sharpen/How_To_Setup_Sharpen](http://developer.db4o.com/Resources/view.aspx/Reference/Sharpen/How_To_Setup_Sharpen)

（我已经在他们那里注册了一段时间，他们很擅长不发送垃圾邮件）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-13T14:45:16.370

我不确定您希望将 C# 转换为 java 的目的是什么，但如果您需要 .net 互操作性，您可能需要查看[Mono](http://www.mono-project.com/Main_Page)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-13T14:48:57.517

这是即兴的，但这不就是[蚱蜢](http://dev.mainsoft.com/Default.aspx?tabid=130#What%20is%20Grasshopper?)的目的吗？

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-08-03T14:04:08.210

好吧，语法几乎相同，但它们依赖于不同的框架，因此转换的唯一方法是让懂这两种语言的人转换代码:) 你的问题的答案是否定的，没有转换 c# 的“有效”工具到java

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-12-13T23:57:52.713

可能你可以使用[jni4net-opensource 桥](http://jni4net.sf.net/)代替？或我知道的[其他选项列表。](http://jni4net.sourceforge.net/links.shtml)

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2015-08-27T06:59:48.397

为什么不在 Haxe ( [http://haxe.org/](http://haxe.org/) ) 中编写它并将其转换为您想要的任何内容？

# sql - 从多个控件生成 LINQ 查询

> ID：78816
> 
> 赞同：1
> 
> 时间：2008-09-17T01:05:03.787
> 
> 标签：sql, linq

我最近编写了一个应用程序（vb.net），它存储并允许搜索旧的议会计划。现在，虽然应用程序运行良好，但前几天我正在查看用于生成 SQL 字符串以传递数据库的例程，坦率地说，它很糟糕。
我只是在这里发布一个问题，看看是否有其他人有更好的方法来做到这一点。

我拥有的是一个带有一堆控件的表单，从文本框到单选按钮，每个控件都像数据库过滤器，当用户点击搜索按钮时，一个 SQL 字符串（我真的希望它是一个 LINQ 查询，因为我已更改为 LINQ to SQL）从完成的控件生成并运行。

我遇到的问题是将这些控件中的每一个与数据库中的一个字段进行匹配，并有效地生成一个 LINQ 查询，而无需执行一堆“if ...then ...else”。陈述。过去我只是使用控件上的标记属性将控件链接到数据库中的字段名称。

如果这有点令人困惑，我很抱歉，它有点难以描述。只是把它扔在那里，看看是否有人有任何想法。

谢谢内森

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-17T01:40:50.583

您可以将每个控件包装在一个用户控件中，该控件可以接受 IQueryable 并在必要时附加到查询上。

所以你的页面代码可能类似于

```
var qry = from t in _db.TableName
      select t; 
```

然后将 qry 传递给每个用户控件上的方法

```
IQueryable<t> addToQueryIfNeeded(IQueryable<t> qry)
{
   if(should be added)
      return from t in qry
           where this == that
           select t;
   else
      return qry
} 
```

然后在您完成每个控件之后，您的查询将完成，然后您可以 .ToList() 它。关于 LINQ 的一个很酷的事情是在你 .ToList() 或 .First() 之前什么都不会发生。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T01:45:08.450

在编写复杂的 ad-hoc 查询类型的东西时，属性可能是你最好的朋友。采用更具声明性的方法并使用一些自定义属性装饰您的类、接口和/或属性，然后编写一些通用的“胶水”代码将您的 UI 绑定到您的模型。这将使您的模型和演示变得灵活，而无需更改 1000 行控制器逻辑。事实上，这正是微软构建 Visual Studio“属性”页面的方式。您甚至可以根据需要在您的产品中使用 Microsoft 的“EnvDTE.dll”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T01:46:53.470

我不知道这里的性能，但是如果您设置 LINQ to SQL 数据上下文类，您应该能够使用 .Select(...) 或 .Where(...) 查询数据库表。您应该能够为其中任何一个动态构建 lambda 表达式。您可能会为此目的研究 lambda 表达式的动态生成。我已经完成了动态 lambda 生成的所有工作，但这是可能的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T01:52:31.333

我不是 100% 确定如何实现这一点，但我知道在 ASP.NET MVC 源代码中是一个好的起点。在最近的版本中，它能够获取表单响应并将其传递给辅助方法，该方法执行写入 LINQ 数据源的操作。

我相信 MVC 是 C#，所以如果您正在寻找 VB 翻译，您可以尝试使用 .NET Reflector 并将其转换回 VB。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T02:11:44.890

我认为您正在搜索如何创建“动态”Linq 查询，[这里](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)有一个关于如何使用扩展方法库的示例。这些方法采用字符串参数而不是类型安全的语言运算符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T02:24:27.123

我不介意 sfusco 使用属性的方法。我唯一不确定的是将属性附加到哪里，因为如果我附加到设计器代码中的控件声明，它将在表单更改时重新生成。

还是我完全误解了 sfusco 的方法？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T02:26:56.370

我认为这样做的正确方法可能是扩展器提供程序：[MSDN 文档](http://msdn.microsoft.com/en-us/library/aa720162.aspx)

然后，您可以使用编辑器提供要连接的字段名称，并且可以向您的扩展程序提供程序传递一个 IQueryable<T>、添加条件并返回一个 IQueryable<T>。

# .net - 基于 HTTP 标头区分 MVC 控制器的最佳方法

> ID：78823
> 
> 赞同：3
> 
> 时间：2008-09-17T01:06:17.577
> 
> 标签：.net, asp.net, asp.net-mvc, routing

## 问题

我当前的项目要求我根据几乎每个操作的不同 HTTP 请求标头做不同的事情。

目前，我有一个庞大的控制器（全部用于相同的资源类型），每个动作方法都有一个 ActionName 属性（这样我就可以拥有同一个动作的多个版本，它们采用相同的参数，但做不同的事情）和一个自定义FilterAttribute（实现几乎与预览版 5 中的 AcceptVerbsAttribute 完全相同）检查某些标头是否具有某些值。

我真的很想将代码推送到单独的控制器中，并根据标题在它们之间选择 RouteTable，但想不出最干净的方法。

## 例子

例如，假设我有一个文件列表。服务必须以以下两种方式之一处理请求：

1.  客户端想要一个 zip 文件，并将“accept: application/zip”作为标题传递，我获取文件列表，将它们打包成一个 zip 文件，然后将其发送回客户端。

2.  客户端想要一个 html 页面，所以它通过“accept: text/html”，站点发回一个表格格式的 html 页面，列出文件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T15:48:18.970

听起来您的行为与基于哪个标头进入的操作略有不同。我会尝试尽可能地隔离这些差异。

例如，如果应用程序逻辑相同，但唯一的区别是您如何向用户呈现响应，您可能会考虑编写一个自定义 ActionResult，它根据 Http 标头采取不同的操作。

但是，如果逻辑完全不同，您可以实现附加到每个路由的自定义路由约束 (IRoutConstraint)。看看 HttpMethodConstraint 的实现思路。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T01:13:42.847

我不确定您是否需要基于标头的单独控制器；这种结构听起来非常合理。如果您的控制器如您所说的那样庞大，请考虑它是否正在处理多个资源，如果是，是否应该根据资源将其拆分为多个控制器？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T01:15:29.113

不确定是否可能，但看起来这类似于[在 Preview 5 中添加](http://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx)的 AcceptVerbs 属性。我会看看它是如何实现的（获取 MVC 源代码），看看你是否可以根据内容类型添加类似的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T02:05:36.033

你应该看看[这个帖子](http://omaralzabir.com/create_rest_api_using_asp_net_mvc_that_speaks_both_json_and_plain_xml/)。它描述了基于 http 标头的 json 和 xml 响应的实现。

# networking - 如何在 Erlang 中使用 gen_udp 进行多播？

> ID：78826
> 
> 赞同：18
> 
> 时间：2008-09-17T01:06:59.587
> 
> 标签：networking, erlang, multicast

你如何`gen_udp`在 Erlang 中使用[多播](https://en.wikipedia.org/wiki/Multicast)？我知道它在代码中，它背后没有文档。发送数据显而易见且简单。我想知道如何添加会员。不仅在启动时添加会员资格，而且在运行时添加会员资格也很有用。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-11-16T04:36:03.823

这是有关如何监听 Bonjour / Zeroconf 流量的示例代码。

```
-module(zcclient).

-export([open/2,start/0]).
-export([stop/1,receiver/0]).

open(Addr,Port) ->
   {ok,S} = gen_udp:open(Port,[{reuseaddr,true}, {ip,Addr}, {multicast_ttl,4}, {multicast_loop,false}, binary]),
   inet:setopts(S,[{add_membership,{Addr,{0,0,0,0}}}]),
   S.

close(S) -> gen_udp:close(S).

start() ->
   S=open({224,0,0,251},5353),
   Pid=spawn(?MODULE,receiver,[]),
   gen_udp:controlling_process(S,Pid),
   {S,Pid}.

stop({S,Pid}) ->
   close(S),
   Pid ! stop.

receiver() ->
   receive
       {udp, _Socket, IP, InPortNo, Packet} ->
           io:format("~n~nFrom: ~p~nPort: ~p~nData: ~p~n",[IP,InPortNo,inet_dns:decode(Packet)]),
           receiver();
       stop -> true;
       AnythingElse -> io:format("RECEIVED: ~p~n",[AnythingElse]),
           receiver()
   end. 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-17T08:32:44.710

组播发送已应答，接收需要订阅组播组。

它（仍然）似乎没有记录，但之前已经在 erlang-questions 邮件列表中介绍过。[http://www.erlang.org/pipermail/erlang-questions/2003-March/008071.html](http://www.erlang.org/pipermail/erlang-questions/2003-March/008071.html)

```
 {ok, Socket} = gen_udp:open(Port, [binary, {active, false},
                                       {reuseaddr, true},{ip, Addr}, 
                                       {add_membership, {Addr, LAddr}}]). 
```

其中`Addr`是多播组，并且`LAddr`是本地接口。（代码由 mog 提供）

可以将上面使用的相同选项传递给[`inet:setopts`](http://www.erlang.org/doc/man/inet.html#setopts-2)包括`{drop_membership, {Addr, LAddr}}`以停止收听组。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-12-10T10:49:23.413

我试图让这个例子在我的电脑上运行。如果我通过打开接收套接字总是收到消息 {error,eaddrnotavail} 会发生什么？

示例 1：这有效：

```
{ok, Socket} = gen_udp:open(?PORT, [{reuseaddr,true}, {ip,?SERVER_IP},
               {multicast_ttl,4}, {multicast_loop,false}, binary]), 
```

示例 2：获取运行时错误：

```
{ok, Socket} = gen_udp:open(?PORT, [{reuseaddr,true}, {ip,?MULTICAST_IP},
               {multicast_ttl,4}, {multicast_loop,false}, binary]), 
```

% --> {error,eaddrnotavail}

```
-define(SERVER_IP, {10,31,123,123}). % The IP of the current computer
-define(PORT, 5353).
-define(MULTICAST_IP, {224,0,0,251}). 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T01:18:29.450

**多播由 IP 地址指定**

erlang 中的所有语言都是一样的。IP 地址 224.0.0.0 到 239.255.255.255 是多播地址。

在该范围内选择一个地址，检查您是否没有与已分配的地址重叠，您就可以开始了。

[http://www.iana.org/assignments/multicast-addresses](http://www.iana.org/assignments/multicast-addresses)

# sql-server - SQL 2005 快照安全

> ID：78828
> 
> 赞同：1
> 
> 时间：2008-09-17T01:07:25.640
> 
> 标签：sql-server, snapshot

在 SQL Server 2005 中，可以创建允许对数据库进行只读访问的数据库快照，即使数据库处于“恢复挂起”模式也是如此。此功能的一个用例是创建引用生产数据库副本的报告数据库，该副本通过日志传送保持最新。

在这种情况下，如何在不同于“生产”源数据库的“快照”数据库上实现安全性？

例如，在生产数据库中，所有对数据的访问都是通过存储过程进行的，而在快照数据库中，用户可以从数据库中的表中进行选择以进行报告。我看到的问题是快照数据库的安全性是从源数据库继承的，并且不能更改，因为快照是严格只读的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T03:51:53.420

你能管理这个数据库的权限吗？对于这种情况，添加一个仅对数据库具有读取权限的单独用户是否足够？这可能是主数据库上的只读用户，但仅在快照数据库上有效使用。

即添加一个新用户，readerMan5000，他只被授予选择访问权限，到有问题的数据库。然后要求用户通过该新凭据进行身份验证。

请注意未来的评论者，您可能需要阅读： [http](http://www.simple-talk.com/sql/database-administration/sql-server-2005-snapshots/) ://www.simple-talk.com/sql/database-administration/sql-server-2005-snapshots/ 或 [http://msdn.microsoft.com/en- us/library/ms187054(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms187054(SQL.90).aspx) 在你像我一样张开大嘴之前。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T00:39:53.670

拍摄快照后您无法更改权限，但这里有一种解决方法：与其让他们直接访问表，不如要求他们使用视图。如果视图仅用于报告，那么您可以在原始数据库中对它们设置严格的安全性，然后让用户在快照中点击这些视图。如果您希望它有效，您将需要限制对基础表的访问。

# c# - 如何在数据网格中检索数据绑定文本框的更改值

> ID：78847
> 
> 赞同：2
> 
> 时间：2008-09-17T01:10:50.200
> 
> 标签：c#, asp.net, datagrid, textbox

ASP.NET 1.1 - 我在 ASPX 页面上有一个 DataGrid，它是数据绑定的，并在文本框中显示一个值。用户可以更改此值，然后单击一个按钮，其中后面的代码基本上遍历网格中的每个 DataGridItem，为文本框的 ID 执行 FindControl，然后将 .Text 值分配给一个变量，然后用于更新数据库。DataGrid 使用新值反弹。

我遇到的问题是，将 .Text 值分配给变量时，检索到的值是原始数据绑定值，而不是新输入的用户值。关于可能导致这种行为的任何想法？

代码示例：

```
foreach(DataGridItem dgi in exGrid.Items)
{
    TextBox Text1 = (TextBox)dgi.FindControl("TextID");
    string exValue = Text1.Text; //This is retrieving the original bound value not the newly entered value
    // do stuff with the new value
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-17T02:22:11.997

那么代码示例来自您的按钮单击事件？

你确定你没有在回发时重新绑定你的数据源吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T02:36:51.650

您何时尝试从 TextBox 中检索值？即您提供的代码示例何时执行？

如果您还没有，您需要为 DataGrid 的 ItemCommand 事件设置一个处理程序方法。您应该在该方法中寻找新的 TextBox 值。您还应该确保您的 DataGrid 在回发时没有被重新绑定。

我还强烈建议阅读 Scott Mitchell 关于使用 DataGrid 控件及其所有功能的优秀文章系列：http: [//aspnet.4guysfromrolla.com/articles/040502-1.aspx](http://aspnet.4guysfromrolla.com/articles/040502-1.aspx)

# apache-flex - 获取在 AS3 中单击鼠标的颜色的最佳方法

> ID：78849
> 
> 赞同：10
> 
> 时间：2008-09-17T01:11:08.127
> 
> 标签：apache-flex, flash, actionscript-3

我有一个图像（mx），我想获取被点击的像素的单位。

有任何想法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-17T02:18:45.577

[BitmapData LiveDoc 页面](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/BitmapData.html)上的几分钟将带您到您需要去的地方。将图像加载到 Bitmap 变量后，您可以访问其 BitmapData 属性。将[鼠标单击事件](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/events/MouseEvent.html#CLICK)侦听器添加到图像，然后使用[BitmapData::getPixel](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/BitmapData.html)。getPixel 的示例展示了如何将 uint 响应转换为 rgb 十六进制代码。

这是对我有用的 BitmapData 页面上给出的示例的修改（使用 mxmlc - YMMV）：

```
package {
    import flash.display.Bitmap;
    import flash.display.BitmapData;
    import flash.display.Loader;
    import flash.display.Sprite;
    import flash.events.Event;
    import flash.events.MouseEvent;
    import flash.net.URLRequest;

    public class BitmapDataExample extends Sprite {
        private var url:String = "santa-drunk1.jpg";
        private var size:uint = 200;
        private var image:Bitmap;

        public function BitmapDataExample() {
            configureAssets();
        }

        private function configureAssets():void {
            var loader:Loader = new Loader();
            loader.contentLoaderInfo.addEventListener(Event.COMPLETE, completeHandler);

            var request:URLRequest = new URLRequest(url);
            loader.load(request);
            addChild(loader);
        }

        private function completeHandler(event:Event):void {
            var loader:Loader = Loader(event.target.loader);
            this.image = Bitmap(loader.content);

            this.addEventListener(MouseEvent.CLICK, this.clickListener);
        }

        private function clickListener(event:MouseEvent):void {
            var pixelValue:uint = this.image.bitmapData.getPixel(event.localX, event.localY)
            trace(pixelValue.toString(16));
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-17T17:02:20.837

这是一个更简单的实现。您所要做的就是使用bitmapData的**draw()**方法拍摄舞台快照，然后在鼠标下的像素上使用**getPixel()**。这样做的好处是您可以对任何被绘制到舞台上的东西进行采样，而不仅仅是给定的位图。

```
import flash.display.Bitmap;
import flash.display.BitmapData;
import flash.events.*;

stage.addEventListener(MouseEvent.CLICK, getColorSample);

function getColorSample(e:MouseEvent):void {
    var bd:BitmapData = new BitmapData(stage.width, stage.height);
    bd.draw(stage);
    var b:Bitmap = new Bitmap(bd);
    trace(b.bitmapData.getPixel(stage.mouseX,stage.mouseX));
} 
```

希望这有帮助！

* * *

**编辑**：

此编辑版本使用单个`BitmapData`.，并删除了创建`Bitmap`. 如果您要对颜色进行采样，`MOUSE_MOVE`那么这对于避免内存问题至关重要。

注意：如果您使用自定义光标精灵，则必须使用“状态”以外的对象，否则您将采样自定义精灵的颜色而不是它下面的颜色。

```
import flash.display.Bitmap;
import flash.display.BitmapData;
import flash.events.*;

private var _stageBitmap:BitmapData;

stage.addEventListener(MouseEvent.CLICK, getColorSample);

function getColorSample(e:MouseEvent):void 
{
    if (_stageBitmap == null) {
        _stageBitmap = new BitmapData(stage.width, stage.height);
    }
    _stageBitmap.draw(stage);

    var rgb:uint = _stageBitmap.getPixel(stage.mouseX,stage.mouseY);

    var red:int =  (rgb >> 16 & 0xff);
    var green:int =  (rgb >> 8 & 0xff);
    var blue:int =  (rgb & 0xff);

    trace(red + "," + green + "," + blue);
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-12-23T18:58:56.353

这不是 Flex 或 mx:Image 特有的，它允许您从任何位图可绘制对象中获取像素颜色值（前提是您有权限）：

```
private const bitmapData:BitmapData = new BitmapData(1, 1);
private const matrix:Matrix = new Matrix();
private const clipRect:Rectangle = new Rectangle(0, 0, 1, 1);

public function getColor(drawable:IBitmapDrawable, x:Number, y:Number):uint
{
    matrix.setTo(1, 0, 0, 1, -x, -y)
    bitmapData.draw(drawable, matrix, null, null, clipRect);
    return bitmapData.getPixel(0, 0);
} 
```

您可以轻松地从舞台或您的 mx:Image 实例中获取一个像素。它比绘制整个舞台（或可绘制对象）要高效得多，并且应该足够快以连接到 MouseEvent.MOUSE_MOVE 以获得即时视觉反馈。

# asp.net - 发布与复制

> ID：78850
> 
> 赞同：4
> 
> 时间：2008-09-17T01:11:16.533
> 
> 标签：asp.net, visual-studio

使用 Visual Studio 发布网站与仅将文件复制到服务器有什么区别？发布文件是预编译的唯一区别吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T01:42:04.713

“发布”和复制文件之间没有太大区别。发布出现在 Web 应用程序中。真正的唯一区别是发布让您可以选择仅包含 html 和 dll，而复制时您需要手动解析源代码。发布选项中没有完全预编译，因为完全预编译意味着根本没有 HTML；aspx 文件只是占位符；所有 html 都在编译后的二进制文件中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T01:23:59.000

我相信你的假设是正确的。根据我的经验，唯一的区别是编译发布的文件。[Visual Studio® 2008 Web 部署项目](http://www.microsoft.com/downloads/details.aspx?FamilyId=0AA30AE8-C73B-4BDD-BB1B-FE697256C459&displaylang=en)是一个很好的增强功能，可以为您的网站和 Web 应用程序自定义构建脚本。

# nhibernate - 使用 NHibernate 映射枚举集合

> ID：78852
> 
> 赞同：1
> 
> 时间：2008-09-17T01:11:21.400
> 
> 标签：nhibernate, collections, enums, attributes, nhibernate-mapping

使用 NHibernate 映射枚举集合

具体来说，使用 Attributes 进行映射。

目前我有这个工作将集合映射为 Int32 类型，NH 似乎可以处理它，但它并不完全理想。

尝试将集合映射为我尝试映射的枚举类型时，我收到的错误是“无法确定类型”。

我发现一个帖子说将一个类定义为

```
public class CEnumType : EnumStringType {
  public CEnumType() : base(MyEnum) { }
} 
```

然后将枚举映射为 CEnumType，但这会给出“CEnumType is not mapped”或类似的东西。

那么有没有人有这样做的经验？

所以无论如何，只是一个简单的参考代码片段来举一个例子

```
 [NHibernate.Mapping.Attributes.Class(Table = "OurClass")]
    public class CClass : CBaseObject
    {
        public enum EAction
        {
            do_action,
            do_other_action
        };

        private IList<EAction> m_class_actions = new List<EAction>();

        [NHibernate.Mapping.Attributes.Bag(0, Table = "ClassActions", Cascade="all", Fetch = CollectionFetchMode.Select, Lazy = false)]
        [NHibernate.Mapping.Attributes.Key(1, Column = "Class_ID")]
        [NHibernate.Mapping.Attributes.Element(2, Column = "EAction", Type = "Int32")]
        public virtual IList<EAction> Actions
        {
            get { return m_class_actions; }
            set { m_class_actions = value;}
        }
} 
```

那么，任何人都得到了正确的属性让我将这个枚举集合映射为实际的枚举？如果它们也作为字符串而不是整数存储在数据库中，那就太好了，但这并不是完全必要的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-05-11T02:46:56.993

您将需要直接映射您的 CEnum 类型。在 XML 映射中，这意味着在您的 NHibernate XML 映射文件中创建一个新的类映射元素。

```

```
``<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" assembly="YourAssembly"
   auto-import="true" default-lazy="false">

   ...

   <class name="YourAssemblyNamespace.CEnum" table="CEnumTable" mutable="false" >
      <id name="Id" unsaved-value="0" column="id">
         <generator class="native"/>
      </id>

      ...

   </class>

</hibernate-mapping>`` 
```

 要使用属性映射来做到这一点，在您的 CEnum 类之上是这样的：

`[NHibernate.Mapping.Attributes.Class(Table = "CEnumTable")] //etc as you require`

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-11-07T05:20:15.410

虽然我自己没有尝试过使用它，但不久前我偶然发现了这段代码，它看起来很有趣：

[http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/08/12/enumeration-classes.aspx](http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/08/12/enumeration-classes.aspx "Jimmy Bogard - 枚举类")

就像我说的，我自己没有使用过它，但我打算在 RSN 项目中试一试。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-10-18T00:31:11.613

代替

```
[NHibernate.Mapping.Attributes.Element(2, Column = "EAction", Type = "Int32")] 
```

尝试

```
[NHibernate.Mapping.Attributes.Element(2, Column = "EAction", Type = "String")] 
```

即：更改`Int32`为`String`

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T06:16:49.060

这就是我这样做的方式。可能有一种更简单的方法，但这对我有用。

编辑：对不起，我忽略了你想要它作为一个列表。我不知道该怎么做...

Edit2：也许您可以将其映射为受保护的 IList[string]，并转换为公共 IList[EAction]，就像我使用简单属性一样。

```
 public virtual ContractGroups Group
    {
        get
        {
            if (GroupString.IsNullOrEmpty())
                return ContractGroups.Default;

            return GroupString.ToEnum<ContractGroups>(); // extension method
        }
        set { GroupString = value.ToString(); }
    }

    // this is castle activerecord, you can map this property in NH mapping file as an ordinary string
    [Property("`Group`", NotNull = true)] 
    protected virtual string GroupString
    {
        get;
        set;
    }

    /// <summary>
    /// Converts to an enum of type <typeparamref name="TEnum"/>.
    /// </summary>
    /// <typeparam name="TEnum">The type of the enum.</typeparam>
    /// <param name="self">The self.</param>
    /// <returns></returns>
    /// <remarks>From <see href="http://www.mono-project.com/Rocks">Mono Rocks</see>.</remarks>
    public static TEnum ToEnum<TEnum>(this string self)
        where TEnum : struct, IComparable, IFormattable, IConvertible
    {
        Argument.SelfNotNull(self);

        return (TEnum)Enum.Parse(typeof(TEnum), self);
    } 
```

# ms-office - 我应该使用哪个 IDE 来开发 InfoPath Forms、VSTA 或 VSTO 的自定义代码？

> ID：78859
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-09-17T01:13:06.997
> 
>         
> 
> 标签：ms-office, vsto, infopath, vsta

我是为 Office Forms Server / MOSS 2007 开发的新手。我必须在设计基于 Web 的表单和在 Visual Studio Tools for Applications（又名 VSTA）或 Visual Studio Tools for Office（又名 VSTO）中为它们编写代码之间做出选择。VSTA 作为 InfoPath 2007 许可证的一部分免费提供；VSTO 也是免费的，需要 Visual Studio 2005 / 2008。我拥有这两种产品的许可证，无法轻易确定每个 IDE 的优缺点。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-09-17T01:19:08.747

这比我能解释得更好：http: [//blogs.msdn.com/andreww/archive/2006/02/21/536179.aspx](http://blogs.msdn.com/andreww/archive/2006/02/21/536179.aspx)

鉴于 VSTA 的许可证随 InfoPath 一起提供，我可能会使用它。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-03T01:17:51.030

为了补充 Bennor 的答案，我将完全避免在 InfoPath 表单“后面”编写代码。这是尽可能多地制作“哑 XML”而不是与代码纠缠在一起的“智能”XML 的绝望尝试。如果做不到这一点，我的下一个选择是 VSTA，因为从历史上看，这些解决方案（至少是我编写的那些）具有较低的安全风险，并且可以在更多样化的 Office 环境中运行。

最后的手段是使用 VSTO。这是我的偏见……我的大部分 VSTO 投资都在 Microsoft Word 中。

# java - Java 代码签名证书是否与 SSL 证书相同？

> ID：78869
> 
>         
> 
> 赞同：40
> 
>         
> 
> 时间：2008-09-17T01:14:48.647
> 
>         
> 
> 标签：java, ssl, certificate, code-signing

我正在四处寻找 Java[代码签名](http://en.wikipedia.org/wiki/Code_signing)证书，这样我的 Java 小程序就不会抛出如此可怕的安全警告。然而，我发现向他们提供的所有地方都收费（在我看来）太高了，比如每年超过 200 美元。[在进行研究时，代码签名证书似乎与SSL](http://en.wikipedia.org/wiki/SSL)证书几乎完全相同。

我的主要问题是：是否可以购买 SSL 证书，但用它来签署 Java 小程序？

* * *

## 回答 #1

> 赞同：39
> 
>             
> 
> 时间：2008-09-17T01:19:21.633

简短的回答：不，它们是不同的。

长答案：它是同一种证书，它使用相同的加密软件，但证书有标志，表明它被允许用于什么。代码签名和 Web 服务器是不同的用途。  

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2008-09-17T01:27:03.110

当我在 Firefox（等）中导入新的 CA 证书时，我可以选择使用我信任的证书：

*   签署服务器

*   签署代码（如您的小程序）

*   签署电子邮件证书

所以对我来说答案是：是的，它们是一样的。[此外，为什么不使用OpenSSL](http://en.wikipedia.org/wiki/OpenSSL)   （Unix 上的 man openssl、man x509、man req 等）生成自己的？你是想让警告安静下来，*还是*想让你从未见过的*其他*人信任你的代码？如果您不需要其他用户将信任链接到与他们的浏览器、操作系统等捆绑的锚 CA，则使用 OpenSSL 生成您自己的。

并询问“如何使用 OpenSSL 生成自己的证书？” 如果后者是您的选择。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:27:39.117

[Thawte在此处](http://www.thawte.com/code-signing/)提供代码签名证书。我想其他证书颁发机构也提供这项服务。您还可以使用[Java keytool](http://java.sun.com/j2se/1.5.0/docs/tooldocs/solaris/keytool.html)创建自签名证书。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2014-12-28T13:17:33.560

X.509 证书可能包括[密钥使用字段](https://www.rfc-editor.org/rfc/rfc5280#section-4.2.1.3)(KU) 和[扩展密钥使用字段](https://www.rfc-editor.org/rfc/rfc5280#section-4.2.1.12)(EKU)。[描述如何为您的 RIA 创建签名](https://docs.oracle.com/javase/8/docs/technotes/guides/deploy/certificates.html#A1148308)的Oracle 技术说明会创建一个没有任何密钥使用标志的证书，它工作得很好（如果您可以让受信任的 CA 对其进行签名）

但是越来越多的 CA 颁发带有这些关键使用字段的证书。如果存在，这些字段会**限制**证书的使用。java 插件检查[EndEntityChecker](http://www.docjar.com/html/api/sun/security/validator/EndEntityChecker.java.html)中是否存在这些字段：

```
/**
 * Check whether this certificate can be used for code signing.
 * @throws CertificateException if not.
 */
private void checkCodeSigning(X509Certificate cert)
        throws CertificateException {
    Set<String> exts = getCriticalExtensions(cert);

    if (checkKeyUsage(cert, KU_SIGNATURE) == false) {
        throw new ValidatorException
           ("KeyUsage does not allow digital signatures",
            ValidatorException.T_EE_EXTENSIONS, cert);
    }

    if (checkEKU(cert, exts, OID_EKU_CODE_SIGNING) == false) {
        throw new ValidatorException
            ("Extended key usage does not permit use for code signing",
            ValidatorException.T_EE_EXTENSIONS, cert);
    }

    if (!SimpleValidator.getNetscapeCertTypeBit(cert, NSCT_SSL_CLIENT)) {
        throw new ValidatorException
            ("Netscape cert type does not permit use for SSL client",
            ValidatorException.T_EE_EXTENSIONS, cert);
    }

    // do not check Netscape cert type for JCE code signing checks
    // (some certs were issued with incorrect extensions)
    if (variant.equals(Validator.VAR_JCE_SIGNING) == false) {
        if (!SimpleValidator.getNetscapeCertTypeBit(cert, NSCT_CODE_SIGNING)) {
            throw new ValidatorException
                ("Netscape cert type does not permit use for code signing",
                ValidatorException.T_EE_EXTENSIONS, cert);
        }
        exts.remove(SimpleValidator.OID_NETSCAPE_CERT_TYPE);
    }

    // remove extensions we checked
    exts.remove(SimpleValidator.OID_KEY_USAGE);
    exts.remove(SimpleValidator.OID_EXTENDED_KEY_USAGE);

    checkRemainingExtensions(exts);
} 
```

检查方法如下：

```
/**
 * Utility method checking if the extended key usage extension in
 * certificate cert allows use for expectedEKU.
 */
private boolean checkEKU(X509Certificate cert, Set<String> exts,
        String expectedEKU) throws CertificateException {
    List<String> eku = cert.getExtendedKeyUsage();
    if (eku == null) {
        return true;
    }
    return eku.contains(expectedEKU) || eku.contains(OID_EKU_ANY_USAGE);
} 
```

因此，如果未指定 KU 或 EKU，KU 或 EKU 检查器会愉快地返回 true。

但

*   如果指定了 KU，则*数字签名*KU 应该是其中之一。

*   如果指定了任何 EKU，则还应指定 EKU*代码签名*（由 oid 1.3.6.1.5.5.7.3.3 标识）或 EKU*任何用法*（由 oid 2.5.29.37.0 标识）。

最后，该`checkRemainingExtensions`方法检查剩余的关键 EKU。唯一允许存在的其他关键 EKU 是

*   *基本约束*（oid "2.5.29.19"）和

*   *主题替代名称*（oid 2.5.29.17）

如果它发现任何其他关键 EKU，则返回 false。

# types - 如何在 postscript 文件中嵌入真正的字体

> ID：78874
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2008-09-17T01:16:10.297
> 
>         
> 
> 标签：types, fonts, postscript, cups

我有一个跨平台应用程序，对于我的 Linux 和 Mac 版本，它会生成一个用于打印报告的 postscript 文件，然后使用 CUPS 打印它们。它适用于简单的字符和图像，但我希望能够将真正的字体直接嵌入到 postscript 文件中。有谁知道如何做到这一点？？我也可以对简单的 ascii 字符进行编码，但我不确定如何对通常的 az 0-9 之外的任何字符进行编码，例如带有重音符号的外来字符。

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2008-09-17T05:22:29.957

为了在 Postscript 文档中嵌入 TrueType 字体，您首先需要将其转换为 Type 42 字体。这种转换将字体转换为 postscript 代码。有几个小型实用程序可以进行这种转换，或者您可以阅读[Type 42 规范](http://www.adobe.com/devnet/font/pdfs/5012.Type42_Spec.pdf)并为其编写自己的代码。

嵌入 Type 1 字体要容易得多。Linux 附带大量 Type 1 字体，如果您安装了 X11，OS X 也会如此。生成 PDF 也是您可能想要研究的一个选项，因为 PDF 可以直接嵌入 TrueType 字体。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2008-09-17T05:23:09.470

Postscript 字体具有广泛不同的编码，因此如果您想可靠地打印 iso-8859-1 字符，您需要在 postscript 程序中重新编码字体。

[PostScript 常见问题解答 - 如何打印重音字符](http://en.wikibooks.org/wiki/PostScript_FAQ#How_to_print_accented_characters.3F)

# xslt - 如何格式化 xsl:text 标签之间的文本？

> ID：78884
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2008-09-17T01:18:24.193
> 
>         
> 
> 标签：xslt, formatting

我有一个 xslt 表，上面有一些类似于下面的文本：

```
<xsl:text>I am some text, and I want to be bold</xsl:text> 
```

我希望一些文本是粗体的，但这不起作用。

```
<xsl:text>I am some text, and I want to be <strong>bold<strong></xsl:text> 
```

已弃用的 b 标签也不起作用。如何格式化 xsl:text 标记中的文本？

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2008-09-17T01:23:35.210

试试这个：  

```
<fo:inline font-weight="bold"><xsl:text>Bold text</xsl:text></fo:inline> 
```

*   [XSL-FO 教程：内联文本格式](http://www.ecrion.com/Support/Resources/XSL-FOTutorial/Inline.xml.html)

*   [XSL-FO 内联对象](http://www.w3schools.com/xslfo/obj_inline.asp)

* * *

## 回答 #2

> 赞同：7
> 
>             
> 
> 时间：2008-09-17T06:25:08.760

你没有。`xsl:text`只能包含文本节点并且`<strong>`是元素节点，而不是以小于字符开头的字符串；XSLT 是关于创建节点树，而不是标记。所以，你必须做

```
<xsl:text>I am some text, and I want to be </xsl:text>
<strong>bold<strong>
<xsl:text> </xsl:text> 
```

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2008-09-17T01:25:39.853

> <xsl:text **disable-output-escaping="yes"** >我要<strong>bold<strong> </xsl:text>

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2011-06-20T11:48:59.950

答案取决于内容中需要多少格式以及您从何处获取内容。如果您的内容较少且格式较少，那么您可以使用 jelovirt 建议的内容

```
<xsl:text>I am some text, and I want to be </xsl:text>
<strong>bold<strong>
<xsl:text> </xsl:text> 
```

但是，如果您的内容格式较大，那么 David Medinets 建议的方法是更好的方法

```
<xsl:text disable-output-escaping="yes"> 
```

我们有一些在 UI 上打印的说明。指令集非常庞大，当然我们从 XML 文件中读取这些指令。

在这种情况下，上述方法也易于使用和维护。那是因为内容是由技术作家提供的。他们不了解 XSL。他们知道如何使用 HTML 标签，并且可以轻松地编辑 XML 文件。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2019-12-11T19:11:38.807

使用强标签的正确方法是

```
<strong>This text is strong</strong> 
```

不是`<strong>`在最后

以下是资料参考：[https ://www.w3schools.com/html/html_formatting.asp](https://www.w3schools.com/html/html_formatting.asp)

* * *

## 回答 #6

> 赞同：-1
> 
>             
> 
> 时间：2008-09-17T01:27:17.057

XSL-FO 格式应该能够做到这一点，请参阅 W3Schools[教程](http://w3schools.com/xslfo/default.asp)。

# python - 如何检查 Guile 扩展模块中的内存泄漏？

> ID：78900
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2008-09-17T01:22:56.133
> 
>         
> 
> 标签：python, memory-leaks, valgrind, guile

我为 Guile 开发了一个扩展模块，用 C 编写。这个扩展模块嵌入了一个 Python 解释器。

由于此扩展模块调用 Python 解释器，我需要验证它是否正确管理 Python 对象占用的内存。  

我发现 Python 解释器在其自己的内存处理中表现良好，因此通过运行 valgrind，如果没有其他干扰因素，我可以发现由于我自己的 Python 解释器嵌入代码中的错误导致的内存泄漏。  

但是，当我在 valgrind 下运行 Guile 时，valgrind 报告内存泄漏。由于我自己的代码，此类内存泄漏掩盖了任何内存泄漏。  

问题是我可以做些什么来将由于我的代码中的错误导致的内存泄漏与 valgrind 报告的由于 Guile 引起的内存泄漏分开。另一个工具而不是 valgrind？特殊的 valgrind 选项？放弃并依赖手动代码演练？

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2008-09-17T01:38:24.580

你有几个选择。一种是为 valgrind 编写一个抑制文件，该文件会关闭报告您未处理的内容。Python有这样一个文件，例如： 
 [http ://svn.python.org/projects/python/trunk/Misc/valgrind-python.supp](http://svn.python.org/projects/python/trunk/Misc/valgrind-python.supp)

如果 valgrind 不喜欢您的设置，另一种可能性是使用`libmudflap`; 您使用 编译程序`gcc -fmudflap -lmudflap`，生成的代码将用于指针调试。在 gcc 文档中描述，在这里： http: [//gcc.gnu.org/wiki/Mudflap_Pointer_Debugging](http://gcc.gnu.org/wiki/Mudflap_Pointer_Debugging)

# joomla - 如何在 Joomla 中将组件显示为文章？

> ID：78905
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-09-17T01:23:40.280
> 
>         
> 
> 标签：joomla, components, mailto, joomla-article

更具体地说，我正在尝试使 mailto 组件显示在我的模板中；和文章一样。

默认情况下，mailto 组件在新窗口中打开。到目前为止，我更改了代码，使其在同一个窗口中打开，但这样整个模板就消失了。

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-11-10T23:55:18.843

在模板中有一个标签，它获取组件的内容。一篇文章是一个 com_content 组件。您正在尝试放入 caom_mail_to 组件？美妙之处在于它们都插入同一个插槽。

现在，您只能在页面上拥有一个组件。你可以有很多模块，但只有一个组件。

您可以通过从菜单命令中选择来设置页面上的组件。（每个菜单项指的是一个组件。）一般来说，组件是 com_content 类型，并且是文章，但在您的情况下，您想要添加一个名为 com_mailto 的组件？假设组件已安装，您只需在菜单项管理器中选择新按钮，然后选择 mailto 组件类型。

joomla 1.5 模板中使用的标签是：

```
<jdoc:include type="component" /> 
```

另一方面，如果您尝试将模块添加到模板中，那就是另一回事了。你需要创建一个模块的实例，将它分配给一个标签（它存在于模板中），然后选择模块将在哪些菜单项上发布。模块模板中的标签如下：

```
<jdoc:include type="modules" name="module_name_place_holder" /> 
```

您可以将多个模块放入一个占位符中。

如果您已经具备这些基础知识，请传递此组件的详细信息，我们会看看是否能为您找到更好的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-24T12:54:29.163

使用“组件作为内容”插件

[http://extensions.joomla.org/extensions/core-enhancements/embed-&-include/5947/details](http://extensions.joomla.org/extensions/core-enhancements/embed-&-include/5947/details)

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T18:25:22.477

恐怕我无法完全理解您的问题 - 您是否希望将会员注册表单或电子邮件通知显示为文章？如果是这样，那么最简单的方法是安装“m2c”——“模块到组件”组件。然后您可以将任何模块（即注册框）放在中心内容区域。

m2c 组件可以在这里找到：http: [//joomla.focalizaisso.com.br/en/componentes/index.php](http://joomla.focalizaisso.com.br/en/componentes/index.php)

# javascript - 跨浏览器 JavaScript 调试

> ID：78909
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-09-17T01:24:17.783
> 
>         
> 
> 标签：javascript

我最近开始维护的网站上有一些脚本。我在 IE6 中遇到了 Object Not Found 错误（Firefox 未能在其错误控制台中报告？）。调试这些的最佳方法是什么——任何好的跨浏览器兼容的 IDE，或某种 JavaScript 调试库？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-09-17T01:27:33.453

据我所知，没有跨浏览器的 JS 调试器（因为大多数浏览器使用不同的 JS 引擎）。

对于 firefox，我肯定会推荐 firebug ( [http://www.getfirebug.com](http://www.getfirebug.com) )

对于 IE，我发现最好的是 Microsoft Script Debugger ( [http://www.microsoft.com/downloads/details.aspx?familyid=2f465be0-94fd-4569-b3c4-dffdf19ccd99&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=2f465be0-94fd-4569-b3c4-dffdf19ccd99&displaylang=en) )。如果您安装了 Office，您可能还安装了 Microsoft 脚本编辑器。要使用其中任何一个，您需要在 IE 中打开脚本调试。（取消选中工具 -> Internet 选项 -> 高级 -> 禁用脚本调试）。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-09-17T02:39:12.110

您还可以使用[Firebug Lite](http://getfirebug.com/lite.html) - 它可以在 IE 和 Opera 中使用。它是一个外部库，可以帮助您追踪问题。有时它比处理 MS Script Debugger 更方便。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:26:04.597

[萤火虫](http://www.getfirebug.com)

它仅适用于 firefox，但它应该让您弄清楚 IE 上发生了什么，尤其是在您拥有脚本行号后。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:27:36.637

1.  您可以使用 Visual Studio 并在浏览器中启用调试

2.  可以为火狐安装FireBug插件，非常棒！

3.  您可以尝试安装 IE8 beta 2 并在兼容模式下使用内置调试器。

您也可以在任何 JS 代码行中编写

```
debugger; 
```

这将作为您使用的任何调试工具的断点受到威胁。

干杯!

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:35:22.403

[Aptana Studio](http://www.aptana.com/studio)为 Firefox 和 IE 提供 JavaScript 调试

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:53:02.520

[Firebug](http://www.getfirebug.com)是最好的客户端调试器。我经常用它来调试 CSS 代码和 javascript。它使您可以轻松找到有问题的代码区域。我特别喜欢在萤火虫窗格中修改标签属性并在提交前立即查看效果的能力。对于任何设计网站的人都非常有用。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T01:31:43.583

您显然可以使用此工具 - [Microsoft Script Debugger](http://www.microsoft.com/downloads/details.aspx?FamilyID=2f465be0-94fd-4569-b3c4-dffdf19ccd99&displaylang=en)

就我个人而言，我尝试通过代码并弄清楚发生了什么 - 它为您提供了出错的行号，对吗？

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T09:15:34.390

为了使 Microsoft Script Debugger 对用户更加友好（并添加实际上对 IE 有帮助的 javascript 错误消息），我强烈推荐[Companion.JS](http://www.my-debugbar.com/wiki/CompanionJS/HomePage)。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T09:26:00.730

[Firebug](http://getfirebug.com/)似乎是迄今为止最有用的。**当页面在 firebug 上运行时，通过 javascript 调用console.log('your log message'); 将消息**记录到 firebug 会非常方便；但不要在 IE 中执行该代码，因为控制台对象仅在 firebug 运行时才在范围内。

对于 IE，其他人提到了[Script Debugger](http://www.microsoft.com/downloads/details.aspx?FamilyID=2f465be0-94fd-4569-b3c4-dffdf19ccd99&displaylang=en)。[虽然它不是主要用于 javascript 调试，但添加IE 开发人员工具栏](http://en.wikipedia.org/wiki/IE_Developer_Toolbar)也很有用，它允许您轻松动态地检查页面 DOM 的样式和其他属性。

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T09:29:26.727

针对mopoke，对于IE6，如果可以的话，你肯定想使用Visual Studio进行调试。出于所有意图和目的，MS 脚本调试器毫无用处。最好使用某种形式的跟踪（而不是警报）而不是使用 MS 脚本调试器。例如，Dojo Toolkit 提供了一个用于跟踪的调试控制台，但您可以通过将消息转储到辅助窗口或 div 来编写自己的控制台。

脚本调试器不必要地提示您 IE6 中的每个错误，即使这样也不会为您提供足够的状态上下文以使其在足够复杂的 JS 应用程序中有用。Visual Studio 集成得更紧密，也更友好。只是我的经验。  

# language-agnostic - 防止算术上溢和下溢的最有效做法

> ID：78913
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-09-17T01:25:10.883
> 
>         
> 
> 标签：language-agnostic, numbers, overflow, math

[防止算术上溢](http://en.wikipedia.org/wiki/Arithmetic_overflow)和[下溢](http://en.wikipedia.org/wiki/Arithmetic_underflow)的最有效做法是什么？

想到的一些例子是：

*   基于有效输入范围的测试

*   使用正式方法进行验证

*   不变量的使用

*   使用语言功能或库在运行时检测（这不会阻止它）

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-09-17T01:28:33.577

一种可能性是使用一种具有任意大小整数且永不上溢/下溢的语言。

否则，如果这是您真正关心的事情，并且如果您的语言允许，请编写一个类似于整数的包装类，但会检查每个操作是否溢出。你甚至可以让它检查调试版本，并为发布版本优化。在像 C++ 这样的语言中，您可以做到这一点，它的行为几乎与发布版本的整数一样，但对于调试版本，您将获得完整的运行时检查。

```
class CheckedInt
{
private: 
    int Value;

public:
    // Constructor
    CheckedInt(int src) : Value(src) {}

    // Conversions back to int
    operator int&() { return Value; }
    operator const int &() const { return Value; }

    // Operators
    CheckedInt operator+(CheckedInt rhs) const
    {
        if (rhs.Value < 0 && rhs.Value + Value > Value)
            throw OverflowException();
        if (rhs.Value > 0 && rhs.Value + Value < Value)
            throw OverflowException();
        return CheckedInt(rhs.Value + Value);
    }

    // Lots more operators...
}; 
```

编辑：

原来有人[已经在为 C++ 做这件事了](http://www.codeplex.com/SafeInt)——当前的实现主要针对 Visual Studio，但看起来他们也正在获得对 gcc 的支持。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:29:41.763

我编写了很多测试代码来对我的代码进行范围/有效性检查。这往往会捕捉到大多数这些类型的情况 - 并且绝对可以帮助我编写更多防弹代码。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:32:20.227

使用高精度浮点数，如[long double](http://en.wikipedia.org/wiki/Long_double)。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:49:26.070

我认为您的列表中缺少一个非常重要的选项：为工作选择正确的编程语言。有许多编程语言没有这些问题，因为它们没有固定大小的整数。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T02:55:19.890

在选择使用哪种语言时，除了整数的大小之外，还有更重要的考虑因素。如果您不知道该值是否在界限内，只需检查您的输入，或者如果这种情况极为罕见，请使用异常处理。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-06-22T16:31:42.753

在许多情况下，检查不一致的包装器是有意义的。如果对两个或多个整数的加法运算（即加法或乘法）产生的值小于操作数，那么您就知道出了问题。每个加法运算都应遵循，

```
if (sum < operand1 || sum < operand2)
    omg_error(); 
```

同样，应该检查逻辑上应该导致较小值的任何操作，以查看它是否被意外embiggin'd。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2012-02-10T20:38:43.153

您是否调查过使用形式方法来检查您的代码以证明它没有溢出？一种称为抽象解释的形式方法技术可以检查软件的稳健性，以证明您的软件不会遭受上溢、下溢、被零除、上溢或其他类似的运行时错误。它是一种数学技术，可以详尽地分析您的软件。该技术由 Patrick Cousot 在 1970 年代首创。它成功地用于诊断阿里安 5 号火箭的溢出情况，溢出导致运载火箭损坏。将浮点数转换为整数时导致溢出。[您可以在此处](http://www.mathworks.com/discovery/formal-methods.html)以及在[Wikipedia](http://en.wikipedia.org/wiki/Abstract_interpretation)上找到有关此技术的更多信息。

# perl - Outlook + Perl + Win32::Ole：如何选择按日期排序的日历条目？

> ID：78916
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-09-17T01:25:35.283
> 
>         
> 
> 标签：perl, winapi, outlook

当前代码打开 Outlook 日历数据库，如下所示：

```
my $outlook = Win32::OLE->GetActiveObject('Outlook.Application') || Win32::OLE->new('Outlook.Application', 'Quit');

my $namespace = $outlook->GetNamespace("MAPI");

## only fetch entries from Jan 1, 2007 onwards
my $restrictDates = "[Start] >= '01/01/2007'"; 
```

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T02:43:12.787

由于您没有显示获取对象日期的代码，因此如果不了解您尝试访问的 Outlook 对象，就无法回答这个问题。

如果您有一组对象，则可以按日期对它们进行排序并在某个对象之前过滤它们。

```
my $sub = sub {
       my $ad = $a->date_string_accessor;
       my $bd = $b->date_string_accessor;
       $ad =~ s:(\d+)/(\d+)/(\d+):$3 . sprintf('%0d', $1) . sprintf('%0d', $2):e;
       $bd =~ s:(\d+)/(\d+)/(\d+):$3 . sprintf('%0d', $1) . sprintf('%0d', $2):e;
       return $ad cmp $bd;
};

my @sorted = sort $sub @unsorted;

print join("\n", @sorted); 
```

但在我看来，您应该使用应用程序本身来执行此操作——大概 Outlook 具有某种查询/排序功能。

# vba - MailItem 什么时候不是 MailItem？

> ID：78924
> 
>         
> 
> 赞同：11
> 
>         
> 
> 时间：2008-09-17T01:26:56.480
> 
>         
> 
> 标签：vba, outlook, typeof, mailitem, outlook-2003

我在 Outlook 的 Visual Basic（我们使用 Outlook 2003 和 Exchange Server）中编写了一个消息处理函数来帮助我整理传入的电子邮件。

它对我有用，除了有时规则失败并且 Outlook 将其停用。

然后我重新打开规则并在我的收件箱上手动运行它以赶上。该规则自发失败并每天停用几次。

我很想一劳永逸地解决这个问题。

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2011-12-29T19:03:09.080

这段代码向我展示了收件箱中的不同类型名称：

```
Public Sub GetTypeNamesInbox()
Dim myOlItems As Outlook.Items
Set myOlItems = application.GetNamespace("MAPI").GetDefaultFolder(olFolderInbox).Items
Dim msg As Object

For Each msg In myOlItems
    Debug.Print TypeName(msg)
    'emails are typename MailItem
    'Meeting responses are typename MeetingItem
    'Delivery receipts are typename ReportItem
Next msg

End Sub 
```

高温高压

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2008-09-17T01:39:16.530

在 Outlook 的 Visual Basic 中编写了一个消息处理函数（我们使用的是 Outlook 2003 和 Exchange Server）来帮助我整理收到的电子邮件。它对我有用，除了有时规则失败并且 Outlook 将其停用。然后我重新打开规则并在我的收件箱上手动运行它以赶上。该规则自发失败并每天停用几次。我很想一劳永逸地解决这个问题。

这是去掉了功能的代码，但让您了解它的外观：

```
 Public WithEvents myOlItems As Outlook.Items

   Public Sub Application_Startup()
       ' Reference the items in the Inbox. Because myOlItems is declared
       ' "WithEvents" the ItemAdd event will fire below.
       ' Set myOlItems = Outlook.Session.GetDefaultFolder(olFolderInbox).Items
       Set myOlItems = Application.GetNamespace("MAPI").GetDefaultFolder(olFolderInbox).Items
   End Sub

   Private Sub myOlItems_ItemAdd(ByVal Item As Object)
       On Error Resume Next
       If TypeName(Item) = "MailItem" Then
           MyMessageHandler Item
       End If
   End Sub

   Public Sub MyMessageHandler(ByRef Item As MailItem)
       Dim strSender As String
       Dim strSubject As String

       If TypeName(Item) <> "MailItem" Then
           Exit Sub
       End If

       strSender = LCase(Item.SenderEmailAddress)
       strSubject = Item.Subject

       rem do stuff
       rem do stuff
       rem do stuff
   End Sub 
```

我得到的一个错误是调用 MyMessageHandler 的“类型不匹配”，其中 VB 抱怨 Item 不是 MailItem。好的，但是 TypeName(Item) 返回“MailItem”，那么为什么 Item 不是 MailItem？

我收到的另一封邮件是一封主题为空的电子邮件。线

```
strSubject = Item.Subject 
```

给我一个错误。我知道 Item.Subject 应该是空白的，但为什么这是一个错误？

谢谢。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2012-08-29T18:10:35.100

我在直接引用 Outlook 库的其他 Office 应用程序中使用以下 VBA 代码片段。

```
' Outlook Variables

  Dim objOutlook As Outlook.Application: Set objOutlook = New Outlook.Application
  Dim objNameSpace As Outlook.NameSpace: Set objNameSpace = objOutlook.GetNamespace("MAPI")
  Dim objFolder As MAPIFolder: Set objFolder = objNameSpace.PickFolder()
  Dim objMailItem As Outlook.MailItem

  Dim iCounter As Integer:  iCounter = objFolder.Items.Count
  Dim i As Integer

  For i = iCounter To 1 Step -1
    If TypeOf objFolder.Items(i) Is MailItem Then
      Set objMailItem = objFolder.Items(i)
      With objMailItem 
```

等等

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2008-09-29T20:53:22.673

我对此的记忆有些模糊，但我相信当 MailItem 类似于已读回执时，它就不是 MailItem。（不幸的是，证明这一点的 VBA 代码是在另一份工作中编写的，现在不存在了。）

我还编写了代码来处理传入的消息，可能出于同样的原因（Exchange 规则太多，或者规则向导的规则太复杂），并且似乎记得遇到过同样的问题，有些项目似乎来自不同的类型，即使我用你写的东西来捕捉他们。

如果有帮助，我会看看我是否可以提供一个具体的例子。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2012-07-24T15:36:01.627

```
Dim objInboxFolder As MAPIFolder
Dim oItem As MailItem
Set objInboxFolder = GetNamespace("MAPI").GetDefaultFolder(olFolderInbox)

For Each Item In objInboxFolder.Items
    If TypeName(Item) = "MailItem" Then
    Set oItem = Item

next 
```

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2012-06-21T19:52:09.420

在默认收件箱中可以看到许多类型的项目。

在被调用的过程中，将传入项目分配给`Object`类型变量。然后使用`TypeOf`or`TypeName`来确定它是否是`MailItem`. 只有这样，您的代码才能执行适用于电子邮件的操作。

IE

```
Dim obj As Object

If TypeName(obj) = "MailItem" Then
  ' your code for mail items here
End If 
```

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2013-04-27T09:34:33.053

为什么不对代码使用简单的错误处理程序？严重地。您可以为每次读取似乎失败的属性或对象写入错误。然后无论如何都要恢复。无需复杂的错误处理。考虑一个显示空主题的测试。由于您不知道它将返回什么值（如果有的话），并且它似乎在空或空白主题上出错，因此您需要将其描述为一个可能存在错误的简单测试。将测试作为 if 语句运行（无论如何都会出错），并让程序在出错时恢复。

```
On Error Resume Next
If object.subject = Null 'produces an error when subject is null, otherwise allows a good read
  strSubject = ""   'sets the subject grab string to a null or empty string as a string
Else
 strSubject = object.subject 'Sets the subject grab string to the subject of the message\item
End If 
```

# javascript - 如何使用 JavaScript 以编程方式设置选择框元素的值？

> ID：78932
> 
>         
> 
> 赞同：536
> 
>         
> 
> 时间：2008-09-17T01:28:04.513
> 
>         
> 
> 标签：javascript, html, dom

我有以下 HTML`<select>`元素：

```
<select id="leaveCode" name="leaveCode">
  <option value="10">Annual Leave</option>
  <option value="11">Medical Leave</option>
  <option value="14">Long Service</option>
  <option value="17">Leave Without Pay</option>
</select> 
```

使用带有`leaveCode`数字作为参数的 JavaScript 函数，如何在列表中选择适当的选项？

* * *

## 回答 #1

> 赞同：670
> 
>             
> 
> 时间：2008-09-17T01:31:38.607

您可以使用此功能：

```
selectElement('leaveCode', '11')

function selectElement(id, valueToSelect) {    
    let element = document.getElementById(id);
    element.value = valueToSelect;
} 
```

* * *

## 回答 #2

> 赞同：141
> 
>             
> 
> 时间：2010-12-23T15:00:15.430

如果你使用 jQuery，你也可以这样做：

```
$('#leaveCode').val('14'); 
```

这将选择`<option>`值为 14 的 。

* * *

使用纯 Javascript，这也可以通过两种[`Document`方法](https://developer.mozilla.org/en-US/docs/Web/API/Document#Methods)实现：

*   使用[`document.querySelector`](https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector)，您可以根据 CSS 选择器选择元素：

    ```
    document.querySelector('#leaveCode').value = '14' 
    ```

*   使用更成熟的方法 with [`document.getElementById()`](https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementById)，正如函数名称所暗示的那样，您可以根据它的 选择一个元素`id`：

    ```
    document.getElementById('leaveCode').value = '14' 
    ```

您可以运行以下代码片段来查看这些方法和 jQuery 函数的运行情况：

```
const jQueryFunction = () => {

  $('#leaveCode').val('14'); 

}

const querySelectorFunction = () => {

  document.querySelector('#leaveCode').value = '14' 

}

const getElementByIdFunction = () => {

  document.getElementById('leaveCode').value='14' 

}
```

```
input {
  display:block;
  margin: 10px;
  padding: 10px
}
```

```
<select id="leaveCode" name="leaveCode">
  <option value="10">Annual Leave</option>
  <option value="11">Medical Leave</option>
  <option value="14">Long Service</option>
  <option value="17">Leave Without Pay</option>
</select>

<input type="button" value="$('#leaveCode').val('14');" onclick="jQueryFunction()" />
<input type="button" value="document.querySelector('#leaveCode').value = '14'" onclick="querySelectorFunction()" />
<input type="button" value="document.getElementById('leaveCode').value = '14'" onclick="getElementByIdFunction()" />

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
```

* * *

## 回答 #3

> 赞同：30
> 
>             
> 
> 时间：2008-09-17T03:04:31.847

```
function setSelectValue (id, val) {
    document.getElementById(id).value = val;
}
setSelectValue('leaveCode', 14); 
```

* * *

## 回答 #4

> 赞同：20
> 
>             
> 
> 时间：2008-09-17T01:32:10.930

不回答问题，但您也可以按索引选择，其中 i 是您要选择的项目的索引：

```
var formObj = document.getElementById('myForm');
formObj.leaveCode[i].selected = true; 
```

您还可以循环遍历项目以通过循环显示值进行选择：

```
for (var i = 0, len < formObj.leaveCode.length; i < len; i++) 
    if (formObj.leaveCode[i].value == 'xxx') formObj.leaveCode[i].selected = true; 
```

* * *

## 回答 #5

> 赞同：16
> 
>             
> 
> 时间：2012-08-10T15:50:20.937

我比较了不同的方法：

[比较如何使用 JS 或 jQuery 设置选择值的不同方法](https://jsfiddle.net/8sM7s/1/)

代码：

```
$(function() {
    var oldT = new Date().getTime();
     var element = document.getElementById('myId');
    element.value = 4;
    console.error(new Date().getTime() - oldT);

    oldT = new Date().getTime();
    $("#myId option").filter(function() {
        return $(this).attr('value') == 4;
    }).attr('selected', true);
    console.error(new Date().getTime() - oldT);

    oldT = new Date().getTime();
    $("#myId").val("4");
    console.error(new Date().getTime() - oldT);
}); 
```

在具有约 4000 个元素的选择上输出：

*   1 毫秒  

*   58 毫秒

*   612 毫秒

使用 Firefox 10。注意：我做这个测试的唯一原因是，jQuery 在我们的列表中表现非常糟糕，大约有 2000 个条目（它们在选项之间有更长的文本）。在 val() 之后我们有大约 2 秒的延迟

另请注意：我根据实际值设置值，而不是文本值。

* * *

## 回答 #6

> 赞同：13
> 
>             
> 
> 时间：2008-09-17T01:34:00.067

```
document.getElementById('leaveCode').value = '10'; 
```

那应该将选择设置为“年假”

* * *

## 回答 #7

> 赞同：12
> 
>             
> 
> 时间：2015-06-01T12:38:00.713

我尝试了上述基于 JavaScript/jQuery 的解决方案，例如：

```
$("#leaveCode").val("14"); 
```

和

```
var leaveCode = document.querySelector('#leaveCode');
leaveCode[i].selected = true; 
```

在 AngularJS 应用程序中，有一个**必需**的<select> 元素。

它们都不起作用，因为没有触发 AngularJS 表单验证。尽管选择了正确的选项（并显示在表单中），但输入仍然无效（仍然存在**ng-pristine**和**ng-invalid**类）。

要强制 AngularJS 验证，请在选择一个选项后调用 jQuery [change() ：](https://api.jquery.com/change/)

```
$("#leaveCode").val("14").change(); 
```

和

```
var leaveCode = document.querySelector('#leaveCode');
leaveCode[i].selected = true;
$(leaveCode).change(); 
```

* * *

## 回答 #8

> 赞同：8
> 
>             
> 
> 时间：2020-09-14T11:02:01.477

# 最短的

这是[威廉答案的尺寸改进](https://stackoverflow.com/a/78960/860099)

```
leaveCode.value = '14'; 
```

```
leaveCode.value = '14';
```

```
<select id="leaveCode" name="leaveCode">
  <option value="10">Annual Leave</option>
  <option value="11">Medical Leave</option>
  <option value="14">Long Service</option>
  <option value="17">Leave Without Pay</option>
</select>
```

* * *

## 回答 #9

> 赞同：4
> 
>             
> 
> 时间：2011-03-18T00:53:31.280

如果您需要，最简单的方法是：

1）单击定义选择选项的按钮

2）转到另一个页面，其中选择选项是

3）在另一个页面上选择该选项值

**1）**您的按钮链接（例如，在主页上）

```
<a onclick="location.href='contact.php?option=1';" style="cursor:pointer;">Sales</a>
<a onclick="location.href='contact.php?option=2';" style="cursor:pointer;">IT</a> 
```

（其中**contact.php**是您的带有选择选项的页面。请注意页面网址有？option=1 或2）

**2）**将此代码放在您的第二页（我的案例**contact.php**）

```
<?
if (isset($_GET['option']) && $_GET['option'] != "") {
$pg = $_GET['option'];              
} ?> 
```

**3）**根据点击的按钮选择选项值

```
<select>
<option value="Sales" <? if ($pg == '1') { echo "selected"; } ?> >Sales</option>
<option value="IT" <? if ($pg == '2') { echo "selected"; } ?> >IT</option>
</select> 
```

.. 等等。

所以这是一种通过 url 中的 GET 将值传递到另一个页面（带有选择选项列表）的简单方法。没有表格，没有 ID.. 只需 3 个步骤，就可以完美运行。

* * *

## 回答 #10

> 赞同：3
> 
>             
> 
> 时间：2008-09-17T01:32:56.747

```
 function foo(value)
{
    var e = document.getElementById('leaveCode');
    if(e) e.value = value;
} 

```

* * *

## 回答 #11

> 赞同：2
> 
>             
> 
> 时间：2008-09-17T01:35:28.083

应该是这样的：

```
function setValue(inVal){
var dl = document.getElementById('leaveCode');
var el =0;
for (var i=0; i<dl.options.length; i++){
  if (dl.options[i].value == inVal){
    el=i;
    break;
  }
}
dl.selectedIndex = el;
} 
```

* * *

## 回答 #12

> 赞同：2
> 
>             
> 
> 时间：2008-09-17T03:03:01.493

假设您的表单名为**form1**：

```
function selectValue(val)
{
  var lc = document.form1.leaveCode;
  for (i=0; i&lt;lc.length; i++)
  {
    if (lc.options[i].value == val)
    {
        lc.selectedIndex = i;
        return;
    }
  }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:43:51.370

为什么不为元素的 Id 添加一个变量并使其成为可重用的函数？

```
function SelectElement(selectElementId, valueToSelect)
{    
    var element = document.getElementById(selectElementId);
    element.value = valueToSelect;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
>             
> 
> 时间：2020-08-12T13:04:54.153

这里提到的大部分代码对我都不起作用！

**最后，这行得通**

***window.addEventListener**很重要，否则，您的 JS 代码将在选项中获取值之前运行*

```
 window.addEventListener("load", function () {
            // Selecting Element with ID - leaveCode  //
            var formObj = document.getElementById('leaveCode');

            // Setting option as selected
            let len;
            for (let i = 0, len = formObj.length; i < len; i++){
                if (formObj[i].value == '<value to show in Select>') 
                 formObj.options[i].selected = true;
            }
    }); 
```

希望这可以帮助！

* * *

## 回答 #15

> 赞同：-2
> 
>             
> 
> 时间：2016-05-25T19:07:03.747

你很可能想要这个：

```
$("._statusDDL").val('2'); 
```

或者

```
$('select').prop('selectedIndex', 3); 
```

* * *

## 回答 #16

> 赞同：-3
> 
>             
> 
> 时间：2014-01-29T05:17:07.593

如果使用 PHP，你可以尝试这样的事情：

```
$value = '11';
$first = '';
$second = '';
$third = '';
$fourth = '';

switch($value) {
            case '10' :
                $first = 'selected';
            break;
            case '11' :
                $second = 'selected';
            break;
            case '14' :
                $third = 'selected';
            break;
            case '17' :
                $fourth = 'selected';
            break;
        }

echo'
<select id="leaveCode" name="leaveCode">
  <option value="10" '. $first .'>Annual Leave</option>
  <option value="11" '. $second .'>Medical Leave</option>
  <option value="14" '. $third .'>Long Service</option>
  <option value="17" '. $fourth .'>Leave Without Pay</option>
</select>'; 
```

* * *

## 回答 #17

> 赞同：-6
> 
>             
> 
> 时间：2008-09-17T01:32:38.247

恐怕我目前无法对此进行测试，但在过去，我相信我必须给每个选项标签一个 ID，然后我做了类似的事情：

```
document.getElementById("optionID").select(); 
```

如果这不起作用，也许它会让你更接近解决方案：P

# asp.net - Oracle ASP.net 提供者模型对象性能

> ID：78952
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-09-17T01:32:49.603
> 
>         
> 
> 标签：asp.net, oracle, oracle11g, provider

ODP.Net 的 Oracle 11g 版本引入了提供者模型对象（会话状态提供者、身份提供者等），它允许应用程序将这些信息存储在 Oracle DB 中，而无需编写自定义提供者实现。

有没有人对这些对象进行过任何性能基准测试？它们在性能上与 .net 提供的 sql server 实现相比如何？我对 sessionstate 提供者的性能特别感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-09-19T02:57:28.947

我建议您下载 Reflector 的副本并比较 SQL Server 和 Oracle 提供程序的代码库（它们不应该那么复杂。）  

我猜测它们看起来几乎相同并且执行（从.NET 运行时的角度来看）相似。

Oracle 后端是否更快……那是另一回事。

# c# - 如何在前面没有代码的自定义控件上设置输出缓存指令

> ID：78974
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-09-17T01:35:20.783
> 
>         
> 
> 标签：c#, asp.net, caching, outputcache

我编写了一个继承自的控件，`System.Web.UI.WebControls.DropDownList`所以我前面没有任何代码用于该控件，但我仍然想设置 OutputCache 指令。我有什么方法可以在 C# 代码中设置它，比如使用属性或类似的东西？  

我特别希望能够复制该`VaryByParam`物业

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2010-07-15T18:14:40.667

我意识到这是一个非常古老的问题，但仍然值得回答。

您所说的不是用户控件，而是自定义控件。你想用 OutputCache 做的事情可以简单地用 Context Cache 来完成。

在您获取数据并绑定到 DropDownList 的代码中，执行以下操作：

```
 List<Object> listOfObjects = null;
//assuming a List of Objects... it doesn't matter whatever type of data you use
        if (Context.Cache["MyDataCacheKey"] == null)
        {
            // data not cached, load it from database
            listOfObjects = GetDataFromDB();
//add your data to the context cache with a sliding expiration of 10 minutes.
            Context.Cache.Add("MyDataCacheKey", listOfObjects, null,
                System.Web.Caching.Cache.NoAbsoluteExpiration,
                TimeSpan.FromMinutes(10.0),
                System.Web.Caching.CacheItemPriority.Normal, null);
        }
        else
            listOfObjects = (List<Object>)Context.Cache["MyDataCacheKey"];

        DropDownList1.DataSource = listOfObjects;
        DropDownList1.DataBind(); 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:41:24.467

```
Response.Cache.SetExpires(DateTime.Now.AddSeconds(60));
Response.Cache.SetCacheability(HttpCacheability.Server);
Response.Cache.SetValidUntilExpires(true); 
```

# .net - 特定标签的正则表达式

> ID：78978
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-09-17T01:35:40.750
> 
>         
> 
> 标签：.net, regex

我正在`.NET`项目中使用正则表达式来获取特定标签。我想匹配整个 DIV 标签及其内容：

```
<html>
   <head><title>Test</title></head>
   <body>
     <p>The first paragraph.</p>
     <div id='super_special'>
        <p>The Store paragraph</p>
     </div>
     </body>
  </head> 
```

代码：

```
 Regex re = new Regex("(<div id='super_special'>.*?</div>)", RegexOptions.Multiline);

    if (re.IsMatch(test))
        Console.WriteLine("it matches");
    else
        Console.WriteLine("no match"); 
```

我想匹配这个：

```
<div id="super_special">
   <p>Anything could go in here...doesn't matter.  Let's get it all</p>
</div> 
```

我以为`.`应该得到所有字符，但回车似乎有问题。我的正则表达式缺少什么？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2008-09-17T01:43:00.063

*拜托，非常*拜托，帮自己一个大忙：使用 HTML 解析器来解析 HTML。严重地。这就是他们的目的。

HTML 是一种*非常*复杂的语言。无论您要调整、摆弄、修复、磨练您的正则表达式*多久，**总会*有一个您遗漏的案例。

无论如何，您必须告诉您的正则表达式引擎匹配多行而不是仅匹配一行。在一些最流行的中，您可以通过应用`/m`修饰符来做到这一点。

但让我重复一遍：*请*使用 HTML 解析器。每当有人使用正则表达式解析 HTML 时，一只小猫就会死去......

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:37:19.983

取决于您使用的语言。例如，在 perl 中，您将使用正则表达式修饰符 s：

```
m{<div id="super_special">.*?</span>}s 
```

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:37:45.317

您使用什么语言？在 .NET 中，您必须设置一个选项以确保它不是单行。  

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:38:42.817

取决于语言。如果在 python 上，您缺少 re.S 标志，如下所示（删除匹配项）：

```
re.compile('<div id="super_special">.*?</div>',re.S).sub(your_html,'') 
```

其他正则表达式实现也存在类似的标志，它们被称为“单行”或“多行”或类似的东西。

但**不要使用正则表达式来解析 HTML**。这是通往维修地狱的直接途径。使用 HTML 解析器，例如 Beautiful Soup。检查[这些](https://stackoverflow.com/questions/55391/python-regular-expression-for-html-parsing-beautifulsoup#55424) [链接](https://stackoverflow.com/questions/2861/options-for-html-scraping#5093)以获取该方向的有用资源。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:43:25.490

问题在于 . 默认情况下，元字符不匹配换行符。您必须使用单行修饰符来实现这一点。在 .NET 中，您可以使用 RegexOptions.SingleLine 作为您正在使用的方法的最后一个参数，或者直接在模式中使用修饰符，例如：

```
(?s)(<div id="super_special">.*?</div>) 
```

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:48:09.923

大多数语言都有一些方法可以制作 . 匹配换行符：

*   在 Java 中：Pattern.compile("pattern", Pattern.MULTILINE);

*   在 Perl 和 Ruby 中：/pattern/m

*   在 VB 中：Regex.IsMatch(s, "pattern", RegexOptions.Multiline)

一般来说，使用正则表达式来匹配 XML/HTML 并不是一个好主意，因为 XML/HTML 标记可以嵌套，例如：

```
 <div id="super_special">
     <div>Nothing</div>
     <p>Anything could go in here...doesn't matter.  Let's get it all</p>
  </div> 
```

...在这里你可以很容易地匹配：

```
 <div id="super_special">
     <div>Nothing</div> 
```

另一方面，如果您**确定**要匹配的 HTML 对您的正则表达式始终是安全的，那么请不要让我阻止您（尽管即使那样，您也应该三思而后行，避免潜在的调试头痛）。

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:50:27.203

开箱即用，没有特殊修饰符，大多数正则表达式实现不会超出行尾来匹配文本。您可能应该查看用于此类修饰符的正则表达式引擎的文档。

我还有一个建议：提防贪婪！传统上，正则表达式**是**贪婪的，这意味着你的正则表达式可能会匹配这个：

```
<div id="super_special">
  I'm the wanted div!
</div>
<div id="not_special">
  I'm not wanted, but I've been caught too :(
</div> 
```

您应该检查“非贪婪”修饰符，以便您的正则表达式在第**一次**出现时停止匹配文本`</div>`，而不是在**最后**一次出现。

此外，正如其他人所说，考虑使用 HTML 解析器而不是正则表达式。它将为您省去很多麻烦。

*`<div>`编辑：如果s 是嵌套的，即使是非贪婪的正则表达式也不会按预期工作！考虑使用 HTML 解析器的另一个原因。*

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T01:38:33.940

. （点）匹配除换行符 \r 和 \n 之外的任何单个字符。大多数正则表达式风格也可以选择使点匹配换行符。. 匹配 x 或（几乎）任何其他字符

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T01:38:35.597

也许： 。*[\r\n]*。*[\r\n]*

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T02:41:23.557

这些正则表达式建议都不起作用。根据它们是否贪婪，它们将匹配文档中的最后一个 </div>，或者匹配起始字符串之后的第一个 </div>，这可能是嵌套在你所在字符串中的 div有兴趣。

正则表达式并不是真正用于此目的的理想工具，但如果您的情况足够简单以至于您不想解析 HTML，您可以使用 Microsoft 专有的 .NET 中可用的正则表达式扩展来完成此操作。有关详细说明，请参阅[Morten Maate 的这篇精彩文章](http://www.codeproject.com/KB/recipes/Nested_RegEx_explained.aspx)。

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2008-09-21T10:51:49.497

单独的正则表达式根本不足以解决您的问题。你需要更强大的东西，比如上下文无关的语法。请参阅Wikipedia 上的[乔姆斯基层次结构。](http://en.wikipedia.org/wiki/Chomsky_hierarchy)

换句话说（如前所述），不要使用正则表达式来解析 HTML。

# version-control - 在版本控制系统之间移动的最佳实践是什么？

> ID：78983
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2008-09-17T01:37:05.397
> 
>         
> 
> 标签：version-control, cvs, perforce

cvs 中大约有 200 个项目，vss 中至少有 100 个项目。有些是维护模式下的非活动代码。有些是旧版应用程序。有些是不再使用的旧应用程序。大约 10% 正在积极开发中。计划是移动一切来执行我的 2009 年年底。

有人做过这样的大规模迁移吗？

有没有人遇到过从 cvs 迁移到 perforce 的最佳实践？或类似的迁移。有什么需要注意的地方吗？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2008-09-17T02:59:59.347

在 VSS 方面，有可用于帮助迁移的转换工具。他们主要可以维护版本历史（自述文件和文档中解释了一些警告）。我已经使用 VSS to perforce 工具将 50 多个 VSS 项目迁移到 perforce 中。从 VSS 中获取数据可能有点挑剔，而且速度不是特别快，但它确实有效。如果您可以直接访问 VSS 存储库的磁盘（即不通过网络共享），则转换速度会快得多。[您可以在此处](http://kb.perforce.com/Conversions/VssToPerforce)找到有关脚本的信息。

CVS 有一个类似的页面可以[在此处](http://kb.perforce.com/Conversions/CvsToPerforce)执行转换，尽管我对此没有直接经验。这些链接是开始的好地方。[您还可以在此处](http://kb.perforce.com/)的 Perforce 知识库中搜索 Perforce 邮件列表。我很确定您可能会在邮件列表档案中找到一些转换信息。

首先迁移您的旧项目。您可以确保您的流程有效。当我们将活动代码迁移到 Perforce 时，我花了一个周末基本上取消了对服务器的访问，然后将代码移到了 Perforce。老实说，这是一次非常容易的迁移，当人们周一回来时，他们已经准备好出发了。在开始迁移后，您可能会考虑为您的员工准备 Perforce 备忘单。

最大的问题实际上可能是让您的员工准备好使用 Perforce。如果我再做一次，我会先迁移我们较小的活动项目，并让少数人同时使用 Perforce。事实上，我必须在迁移后的第一天培训 120 多人，这有点多。此外，请确保您在第一天也没有 100 多人访问您的服务器以进行新的同步。在最初的几天里，我们多次关闭我们的服务器。我们使用了我不推荐的 Windows 32 位服务器。我们现在有一个 Windows 64 位服务器，它更加强大。如果可以的话，我实际上会使用 Linux 作为你的 perforce 服务器的操作系统。同样，Perforce 网站上应该有关于性能的良好信息。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-09-17T02:18:35.407

我不必做这种规模的事情，但我有一些想法。首先，从一个小的、不重要的项目开始，然后迁移它。这将使您了解迁移其余项目将花费多少麻烦。之后，您应该立即选择一个中等规模的项目，因为迁移较大的项目（比如分支）可能会出现问题，而这在小型项目中可能并不明显。

确保您花一点时间了解将 cvs 项目转换为 vss 是多么容易，反之亦然。如果从 vss 转换为 perforce 真的很痛苦，您可以将 vss 转换为 cvs，然后再转换为 perforce。不要沉迷其中，但它可以让你摆脱困境。我认为这里的关键是增量。

备份很好。时期。

考虑一个截止日期，任何不活跃的项目，比那个更早的项目都应该被封存。查看最终版本并将其存储在 Perforce 中。你真的需要 15 岁的 Visual Basic 代码吗？

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T03:56:37.790

无论您做什么，都要在某个地方将旧存储库保持为只读模式。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T02:14:28.723

请原谅我用问题回答问题，但[Perforce](http://www.perforce.com/)不为此提供工具吗？或者，至少，文档？我会殴打我的 Perforce 销售人员...

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T03:51:44.527

考虑不要迁移死的和不活动的项目。只需将他们的存储库置于只读模式即可。如果需要，数据仍然可用，您可以节省迁移它们的时间。只需迁移正在使用的 10%。彻底记录这个过程。

如果某个未迁移的项目在未来某个时间复活，您可以使用您的文档作为参考轻松迁移它。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T07:14:58.267

我们使用我们编写的工具迁移了我们的 svn 存储库，并且只是对我们的 starteam 项目进行了头部修订。

注意单文件签入 (CVS) 和多文件变更集 (Perforce) 之间的差异。

注意分支是单独的空间 (CVS) 与文件路径空间中的分支 (Perforce)。

# asp.net - Intranet 应用程序的数据库身份验证

> ID：78984
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-09-17T01:37:09.250
> 
>         
> 
> 标签：asp.net, sql, nhibernate

我正在为内部 Web 应用程序到数据库层的端到端身份验证寻找最佳实践。

我见过的最常见的场景是使用单个 SQL 帐户，并将权限设置为应用程序所需的权限。此帐户由所有应用程序调用使用。然后，当人们需要通过查询工具访问数据库或使用查询访问创建这样一个单独的组时，人们可以访问该组。

我见过的另一种情况是使用完整的 Windows 身份验证端到端。因此，用户自己被添加到具有所有权限集的组中，以便用户能够在应用程序参数之外进行更新和更改。这通常涉及确保人们使用适当的存储过程，这样他们就不会直接更新表。  

第一种情况似乎相对容易维护，但如果应用程序中存在安全漏洞，那么整个数据库就会受到损害，这会引起人们的担忧。

第二种情况似乎更安全，但具有相反的担忧，即在数据库上的存储过程中必须有很多业务逻辑。这似乎限制了 Nhibernate 和 LINQ 等一些非常酷的技术的使用。然而，在当今人们可以以多种不同方式使用数据的时代，我们无法预见例如混搭等是最好的方法。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-09-17T02:16:50.777

戴尔——就是这样。如果您想为这些用户提供对底层数据存储的访问权限，请通过服务进行。根据我的经验，那些从大学/大学毕业的有经验的计算机用户对事情的伤害最大。俗话说，他们知道的足够危险。

如果他们想自动化他们的部分工作，并且他们可以展示他们拥有必要的知识，那么继续，授予他们的**域帐户**对后端的访问权限。这样一来，他们通过小型 VBA 自动化所做的任何事情都与他们的帐户相关联，并且您确切地知道当数据被淹没时该去查看谁。  

我的基本观点是，数据库是众所周知的应用程序的圣杯。您希望在那个特定的馅饼中尽可能少的手指。

作为一名顾问，每当我听到有人允许普通用户进入数据库时​​，我都会眼前一亮，因为我知道当我被要求修复它时，这最终会成为我的一大笔薪水。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-09-17T01:43:15.320

就个人而言，我不希望数据库中有普通的最终用户。对于 Intranet 应用程序（尤其是驻留在域中的应用程序），我将为应用程序访问数据库提供单个帐户，该帐户仅具有应用程序运行所需的权限。

然后将通过用户的域帐户控制对应用程序的访问（关闭 IIS 中的匿名访问等）。

**如果**用户需要并且可以证明直接访问数据库，那么他们的**域帐户**将被授予访问数据库的权限，并且他们可以使用适当的工具登录 DBMS。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T01:48:06.197

在过去的一年里，我一直负责开发几个内部 Web 应用程序。

我们的解决方案是使用 Windows 身份验证（Active Directory 或 LDAP）。

我们的目的只是允许使用现有公司 ID/密码进行简单登录。我们还希望确保现有部门仍负责验证和管理访问权限。

虽然我无法回答有关 Nhibernate 或 LINQ 的论点，但除非您有这些东西可以实现的特定杀手级功能，否则 Active Directory 或 LDAP 足够简单，可以实现并保持值得尝试。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T02:01:41.140

Stephen - 将普通最终用户排除在数据库之外很好，但我想知道在当今这个时代，有这么多有经验的计算机用户从大学/学院出来，这是否是正确的道路。如果有人想自动化他们的部分工作，其中包括对数据库的 VBA 更新，我允许他们通过正常的应用程序来完成，我们是否会因为以这种方式限制他们的访问而失去收益。

我想这里隐含的另一条路径是您可以通过服务打开应用程序，然后通过组保护这些服务，并且仍然将用户与数据库分开。

然后通过委派，您可以允许部门根据乔纳森的帖子通过组控制对自己帐户的访问。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-09-17T02:15:08.520

我同意斯蒂芬·赖顿的观点。域安全是要走的路。如果您想使用混搭之类的东西，您可以通过机器可读的 RESTful 接口公开部分数据库。[SubSonic](http://subsonicproject.com)有一个[内置的](http://subsonicproject.com/tips-and-tricks/webcast-using-subsonic-s-rest-handler/). 
```******