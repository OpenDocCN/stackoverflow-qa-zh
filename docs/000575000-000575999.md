# StackOverflow 问答 000575000-000575999

# dvorak - 德沃夏克定制程序

> ID：575005
> 
> 赞同：2
> 
> 时间：2009-02-22T14:35:08.330
> 
> 标签：dvorak

由于 4 个月前从 QWERTY 更改为 Dvorak，我没有配置太多的键绑定。我正在使用布局的程序员版本。我发现许多基于终端的程序，例如 Elinks 和 Vim，更易于使用。经验提出了一个问题：

**哪些程序是为 Dvorak 定制的？**

**[Some Elaborating]**术语“定制程序”意味着您可以轻松地将 Dvorak 与程序一起使用。至少对我来说，德沃夏克让我看到了我之前觉得奇怪的捷径。你呢？请不要犹豫提及这些程序。

**[我的发现]**

**Opera 浏览器** Opera 的键，如“CTRL+A”、“CTRL+E”、“CTRL+D”和“CTRL+H”，位于 Dvorak 的主行。然后，看看 Qwerty：不在主行。Opera 是为 Dvorak 定制的还是反之亦然？还是仅仅是因为 Unix？早些时候，我 95% 的时间都在使用 Firefox。现在，Firefox 的比例是 40%。

**终端应用** 答案中提到了终端应用，例如 GNU Screen。我有兴趣了解更多关于他们的信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T23:14:29.683

我已经使用 Dvorak 10 多年了，实际上发现大多数 QWERTY 键绑定实际上在 Dvorak 布局上都很好。

但是，由于您正在寻找要定制的东西，因此我在[gnu emacs](http://gnu.org/software/emacs "GNU Emacs")中对我最喜欢的绑定进行了广泛的绑定更改。它是完全可定制的，并且是一个很棒的编辑器。我的 .emacs 文件有超过 15 年的变化——我相信这里的其他人使用它的时间要长得多！

另一个自定义键绑定的好程序是[gnu screen](http://gnu.org/software/screen "gnu屏幕")，我开始在我远程管理的机器上广泛使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-12T05:19:45.673

我的两分钱：使用[AutoHotkey](http://www.autohotkey.com) / [IronAHK](http://code.google.com/p/ironahk/)在全球范围内重新映射热键或用于导致您悲伤的特定键绑定。自从几年前切换到 Dvorak 以来，我只遇到过一个这样的问题，但这是一个大问题：与按 ctrl+x/c/v 相比，用于剪切、复制和粘贴的热键在 Dvorak 上放置得很尴尬.

这些键显然意味着与控制按钮相邻并靠近，因此全局重新映射这些键对我来说是一个很好的解决方案。

```
^q::^x
^j::^c
^k::^v 
```

这样，您可以使用任何您喜欢的程序，并按照您的意愿使用它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-11T19:02:49.433

我在 Qwerty 上学习了 Vim，但我更喜欢用 Dvorak 来输入英文，所以我使用 qwerty2dvorak ( [http://www.vmunix.com/vim/howto/dvorak.html](http://www.vmunix.com/vim/howto/dvorak.html) ) 这让我可以使用 Qwerty 告诉 Vim 做什么（即, hjkl) 和 Dvorak 键入文本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-13T15:18:42.313

我只是把我的键盘放在德沃夏克上，然后去。我对所有的命令键都使用了 dvorak 布局，你很快就习惯了。Apple（和其他）确实设置了布局，其中布局为 Dvorak 用于正常打字，但在使用命令键时为 querty。

无论你做什么，只要选择简单的东西并坚持下去。如果您不得不为不同的应用程序使用不同的键盘快捷键，那么您可能会因为记住所有这些而疲惫不堪。

# svn - 在线协作环境（不仅面向开发）

> ID：575007
> 
> 赞同：5
> 
> 时间：2009-02-22T14:37:47.543
> 
> 标签：svn, project-management, collaboration, ticket-system

我已经在 SVN 上工作了几年，最近一直在从事一些涉及 Trac 的项目。对于你们中的大多数人来说，这可能看起来很奇怪，但我来自设计导向的背景，这些工具并不经常使用。

目前，我们主要使用 Basecamp 来跟踪客户需求、文档等。另一方面，SVN 用于源代码控制（仅限开发人员之间）。

因此，目标是将 Trac 集成到捆绑包（可能还有其他有用的功能）中，我一直在寻找可以满足这些要求的在线环境。那里有很多，但我主要担心的是我不想让设计师、项目经理、客户因为太极客而吓坏了。

到目前为止，我找到的最合适的解决方案是[Assembla](http://www.assembla.com/)。

任何建议都非常受欢迎！

谢谢，

吨

编辑 ：

感谢大家的意见！虽然答案是自动投票的。我们目前正在尝试[REDMINE](http://www.redmine.org/)。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T19:47:52.940

Assembla 是一个不错的选择。你也可以试试[devjavu](http://www.devjavu.com/)。我已经用了几年了，devjavu 的环境更干净。

我在与设计师、项目经理、以前没有接触过版本控制系统的人合作的两个项目中看到了“SVN 和 trac 的实际应用”。他们毫无问题地使用了最常见的功能，我认为如果您的团队可以进行 2 小时的关于带有颠覆的版本控制的主要概念的培训，这应该不是一个大问题。

编辑：

关于这个主题有一个[比较页面](http://www.svnhostingcomparison.com/)，它应该是一个很好的资源。如果不是，至少他们有大量指向 svn 托管服务的链接。;)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T10:07:49.727

您在寻找托管还是非托管？我们正在使用[redmine](http://www.redmine.org/)，它是 Trac 的替代品，*设置*和使用起来很容易。用户界面简单直观。配置相当灵活，允许多个项目，源代码管理集成（用于 SVN、git、CVS，所有常见的），集成 wiki、论坛、文件等。其他名称包括[unfuddle](http://unfuddle.com/)、[jira](http://www.atlassian.com/software/jira/)、[lighthouse](http://lighthouseapp.com/)和[sifter应用程序](http://sifterapp.com/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T21:17:00.447

这可能不适合您正在寻找的内容，但是您是否考虑过[google code](http://code.google.com/)？错误跟踪、版本控制、维基。它甚至是免费的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T12:02:07.300

我推荐[Confluence](http://www.atlassian.com/software/confluence/)。它很灵活，可以使用托管和非托管。它的核心是一个 wiki，但它对页面和附件都有很好的版本管理。它跟踪谁更改了什么，并且权限系统允许您指定谁看到什么（例如，允许您的客户访问，但仅限于相关区域）。它有很好的集成选项，例如远程 API 接口、WebDAV 接口，并且有很多插件可用于默认情况下不包含的功能。

您还可以查看[Jira](http://www.atlassian.com/software/jira/)，它对项目管理更有用。

不，我不为 atlassian 工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T21:48:45.360

我已经使用了将近两年了[Unfuddle](http://unfuddle.com)。

太棒**了**。它提供 SVN 和 GIT 托管，不占用在线空间，内置错误/问题跟踪（可以从 Trac 导入）并与 SVN 集成，有 wiki、迷你论坛、时间跟踪......使用简单，界面简洁。

它还有一个干净的 API。我通过一个简单的 Powershell 脚本进行备份（它们也会自动进行，但我对我的数据非常小心）。

他们非常以客户为导向：一旦我需要他们导入我以前的 SVN 存储库，他们就会回复并在半小时左右的时间内完成工作。

提供多种级别的服务，从免费到价格适中。我想说总体价格非常合理。

我没有什么可否认的，也没有任何附属关系，只是一个*非常*高兴的客户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T22:41:26.187

我使用 SVN+TRAC+MediaWIKI 作为开发过程所有链之间完整交互的主要工具。

开发人员使用 SVN 进行版本控制，使用 TRAC 监控问题 QA 报告，使用 WIKI 作为需求和技术文档的来源。

QA 使用 TRAC 报告问题，使用 WIKI 作为工作流和需求的来源。PM 和 TL 使用 TRAC 构建燃尽报告，并使用 WIKI 作为各种文档的来源。

高层管理人员通过燃尽图可视化了冰山的顶部。

所以我可以推荐使用与 SVN 和 MediaWIKI 集成的 TRAC。一切都是免费的。运行它只需要一些时间。

# many-to-many - 更新多对多关系中的连接表

> ID：575008
> 
> 赞同：0
> 
> 时间：2009-02-22T14:38:48.803
> 
> 标签：many-to-many

这是对此问题的后续问题：

[多对多关系中的查询示例](https://stackoverflow.com/questions/416565/query-examples-in-a-many-to-many-relationship)

关于更新联结表。为此，我必须在 WHERE 子句中使用联结表中的两个键值。

```
Users       UserAddresses     Addresses
=======     =============     =========
FirstName   UserId            City
LastName    AddressId         State
                              Zip 
```

例如，在此示例中，假设我想更新 UserAddresses 表中的 AddressId 字段，因为用户更改了他的地址。我必须在更新 WHERE 子句中同时使用现有的 UserId 和地址 AddressId。

我正在使用存储过程，并将 UserId 和新的 AddressId 作为参数传递。

我试过这个：

```
CREATE PROCEDURE dbo.test
(
@UserId int,
@AddressId int
)
AS
create table #temp
    (
    UserId int not null,
    AddressId int not null
    )
    insert into #temp select UserId, AddressId from UserAddresses where UserId = @UserId

update UserAddresses
set AddressId = @AddressIdD
WHERE (UserId+AddressId in #temp table = UserId+AddressId passed in as parameters)?? 
```

我尝试了各种组合，但我似乎无法正确使用语法。

传入的 UserId 当然与 UserAddresses 表中的相同，但这只是我尝试的一些事情。WHERE 子句似乎出错了。

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T15:03:29.760

这实际上看起来像一个多对一的关系。如果不是，您将需要旧地址 ID 以及新地址 ID 和用户 ID 来进行更改。如果它是多对一关系，那么一个简单的更新应该可以工作，因为每个用户 ID 只存在一个用户 ID/地址 ID 对：

```
update UserAddresses
set AddressId = @AddressId
where UserId = @UserId 
```

如果它确实是多对多关系，则您需要从许多可能的关系中找到现有的一对并更新那个——除了用户 ID 之外，您还需要新旧地址 ID。

```
update UserAddresses
set AddressId = @NewAddressId
where UserId = @UserId and @AddressId = @OldAddressId 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T15:04:06.467

为什么要使用临时表？

```
CREATE PROCEDURE dbo.test
(
@UserId int,
@AddressId int
)
AS
update UserAddresses
set AddressId = @AddressIdD
WHERE UserId = @UserId 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T15:12:37.803

我认为 tvanfossom 正确地指出了代码中的问题。

使用上面的表格，您的操作可以通过多种方式完成：

*   插入指向新地址的链接并删除指向旧地址的链接，保留或删除链接到的地址记录。
*   按照 tvanfossom 描述的方式更新链接记录（LuckyLindys 查询会将用户的所有注册地址设置为相同的地址）。
*   更新链接到的地址记录。

你使用哪一个取决于你在你的应用程序中想要什么。我可能只是更新链接地址，还是您需要保留旧地址？

# .net - 使用 URLRewriter.NET 重写可以包含 1 或 2 个查询字符串的 Url？

> ID：575009
> 
> 赞同：3
> 
> 时间：2009-02-22T14:39:00.130
> 
> 标签：.net, asp.net, web-config, url-rewriting, urlrewriter.net

在我的项目中，我的 /PropertDetail.aspx 可以获得 2 个查询字符串。

**PropertyId 的**第一个**`/PropertDetail.aspx?PropertyId=5`**

 ****语言**第二名**`/PropertDetail.aspx?PropertyId=5&Language=2`**

 ****编辑：**这个页面可以得到其中一个或两个都得到，所以我的重写器规则需要同时处理它们

所以，我已将这些规则设置为 web.config

```
<rewriter>
        <rewrite url="^(/.+(\.gif|\.png|\.jpg|\.ico|\.pdf|\.css|\.js)(\?.+)?)$" to="$1" processing="stop" />
        <rewrite url="^/(.+)-(.+).aspx$" to="/PropertyDetail.aspx?PropertyId=$2" processing="stop"/>
        <!--http://localhost:1562/Harika-Gayrimenkul-5.aspx-->
        <rewrite url="^/(.+)-(.+)-(.+).aspx$" to="/PropertyDetail.aspx?PropertyId=$2&#038;Language=$3" processing="stop"/>
        <!--http://localhost:1562/Great-Property-5-2.aspx-->
</rewriter> 
```

如果没有语言查询字符串，一切正常，但是当有语言查询字符串时，它会获得第三个表达式作为*PropertyId*而不是*语言*

如何为同一页面定义这两个规则？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T14:57:09.243

综合答案：

```
<rewriter>
    <rewrite url="^(/.+(\.gif|\.png|\.jpg|\.ico|\.pdf|\.css|\.js)(\?.+)?)$" to="$1" processing="stop"/>
    <rewrite url="^.+?([\d]+?)-([\d]+?)\.aspx$" to="/PropertyDetail.aspx?PropertyId=$1&amp;Language=$2" processing="stop"/>
    <rewrite url="^.+?-([\d]+?)\.aspx$" to="/PropertyDetail.aspx?PropertyId=$1" processing="stop"/>

</rewriter> 
```

现在对于许多组合来说效果很好：

```
/This-is-a-really-long-property-title-555-12 
```

返回 PropertyId=555 和 Language=12。

```
/This-is-another-really-long-property-title-666 
```

返回 PropertyId=666。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T15:32:29.143

通过添加问号使匹配中的第二个参数（语言值）可选：

*编辑：这是一个更正的版本，是在我意识到我对这个问题有点误解之后制作的。*

```
<rewriter>
  <rewrite url="\.(?:gif|png|jpg|ico|pdf|css|js)(?:\?.*)?$" to="$0" processing="stop"/>
  <rewrite url="(\d+)(?:-?(\d+)?)\.aspx$" to="/PropertyDetail.aspx?PropertyId=$1&amp;Language=$2" processing="stop"/>
</rewriter> 
```

这是 OP 工作的清理和简化版本。它将以以下形式产生输出

```
/PropertyDetail.aspx?PropertyId=12345&Language=1（存在语言时）
/PropertyDetail.aspx?PropertyId=12345&Language=（如果不是）

```

笔记

*   使用 $0 反向引用来引用整个输入字符串，而无需实际*匹配*整个输入字符串
*   对我们不需要存储在匹配组中的东西使用非捕获组（？：...），因为我们不想稍后检索它们的值
*   将单参数和双参数 URL 的单独规则合并为单个规则

* * *

答案的原始版本：

```
<rewriter>
  <rewrite url="^/(.+?)-(.+?)-?(.+?)?\.aspx$" to="/PropertyDetail.aspx?PropertyId=$2&amp;#038;Language=$3" processing="stop"/>
</rewriter> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T20:42:08.383

这是我们提出的最终解决方案。

```
<rewriter>
    <rewrite url="^(/.+(\.gif|\.png|\.jpg|\.ico|\.pdf|\.css|\.js)(\?.+)?)$" to="$1" processing="stop"/>
    <rewrite url="^.+?([\d]+?)-([\d]+?)\.aspx$" to="/PropertyDetail.aspx?PropertyId=$1&amp;Language=$2" processing="stop"/>
    <rewrite url="^.+?-([\d]+?)\.aspx$" to="/PropertyDetail.aspx?PropertyId=$1" processing="stop"/>
</rewriter> 
```

*   第一条规则是关于我们不需要的文件类型。
*   第二条规则是关于“如果页面获得 2 个查询字符串”
*   第三条规则是关于页面是否只有一个查询字符串

非常感谢您的帮助**teknohippy**和**JasonMArcher**

# vb.net - 以编程方式更改 DatagridView (.NET) 上的选择

> ID：575015
> 
> 赞同：15
> 
> 时间：2009-02-22T14:48:26.363
> 
> 标签：vb.net, datagridview

我正在学习 VB.NET。

尝试设置 CurrentCell 的值时，我遇到了 DataGridView 组件的问题。我想做的是：

我有一个带有值的 DataGridView。我想在我的表单中创建一个按钮，单击它时我想将选择从当前行更改为下一行。为了解释更多，通过单击我的按钮，我想模拟鼠标单击 DataGridview 的效果。

我希望你能帮帮我，

谢谢！

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-22T15:15:02.650

也许是这样的：

```
 If DataGridView1.RowCount > 0 Then

        Dim MyDesiredIndex As Integer = 0

        If DataGridView1.CurrentRow.Index < DataGridView1.RowCount - 1 Then
            MyDesiredIndex = DataGridView1.CurrentRow.Index + 1
        End If

        DataGridView1.ClearSelection()            
        DataGridView1.CurrentCell = DataGridView1.Rows(MyDesiredIndex).Cells(0)
        DataGridView1.Rows(MyDesiredIndex).Selected = True

    End If 
```

**注1：**也许这两行不是必需的。我没有证明

```
 DataGridView1.ClearSelection()            
        DataGridView1.CurrentCell = DataGridView1.Rows(MyDesiredIndex).Cells(0) 
```

**注意2：**注意，如果我们在最后一行，它会排在第一位

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-22T14:55:48.450

您需要将特定行的 Selected 属性设置为 true。我认为VB会是这样的：

```
someDGV.Rows(index).Selected = True 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-06T10:58:22.257

如果您的数据网格绑定到 BindingSource，最好更改那里的位置：

```
Object key = Convert.ToInt32(cdr["WordList"]);
int itemFound = lexiconNamesBindingSource.Find("ID_Name", key);
lexiconNamesBindingSource.Position = itemFound; 
```

...并且您可能需要通过以下方式完成它：

```
lexiconNamesBindingSource.ResetBidings(); 
```

（这是一个旧线程，但我找到了它，所以其他人可能会觉得这很有用）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-11-17T07:05:11.603

只需使用`BindingSource.MoveNext()`and`BindingSource.MovePrevious()`方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T15:09:04.347

你可以这样做：

```
If DataGridView1.CurrentRow.Index < DataGridView1.Rows.Count Then
    DataGridView1.Rows(DataGridView1.CurrentRow.Index + 1).Selected = True
End If 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-09-10T00:26:37.417

要获取选定的行，您应该使用**SelectedRows(0).Index**而不是CurrentRow。因为如果您以编程方式选择一行，那么下次您将在**CurrentRow.Index**中找到 0 。所以它会像：

```
If DataGridView1.SelectedRows(0).Index < DataGridView1.RowCount - 1 Then
    MyDesiredIndex = DataGridView1.SelectedRows(0).Index + 1
End If

DataGridView1.Rows(MyDesiredIndex).Selected = True 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-18T06:08:12.303

扩展上面的答案，考虑到我花了至少 4 个小时寻找这个答案，这是完美的。并假设您的 datagridview 被称为 dgvDevices ...此代码将处理您在行上来回移动时跳出的事件

```
Private Sub btnPrev_Click(ByVal sender As System.Object, ByVal e As   System.EventArgs) Handles btnPrev.Click
    Try
        dgvDevices.ClearSelection()
        Dim currentr As Integer = dgvDevices.CurrentCell.RowIndex
        dgvDevices.CurrentCell = dgvDevices.Rows(currentr - 1).Cells(0)
        dgvDevices.Rows(currentr - 1).Selected = True
    Catch ex As Exception
        dgvDevices.CurrentCell = dgvDevices.Rows(0).Cells(0)
        dgvDevices.Rows(0).Selected = True
    End Try

End Sub

Private Sub btnForw_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnForw.Click
    Try
        dgvDevices.ClearSelection()
        Dim currentr As Integer = dgvDevices.CurrentCell.RowIndex
        dgvDevices.CurrentCell = dgvDevices.Rows(currentr + 1).Cells(0)
        dgvDevices.Rows(currentr + 1).Selected = True
    Catch ex As Exception
        dgvDevices.CurrentCell = dgvDevices.Rows(dgvDevices.RowCount - 1).Cells(0)
        dgvDevices.Rows(dgvDevices.RowCount - 1).Selected = True
    End Try
End Sub 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-12-11T15:49:22.140

除了 Javiers 正确答案之外，如果您将 Bi​​ndingSource[用于](https://msdn.microsoft.com/en-us/library/system.windows.forms.bindingsource(v=vs.110).aspx)您的 datagridview，那么最好从绑定源更改所选项目，而不是使用`datagridview.CurrentCell`：

```
' Example Definitions
Dim bsExample As New BindingSource
Dim dgv As New DataGridView
dgv.DataSource = bsExample

' Example code to change current row position
Dim desiredIndex As Integer = 10
bsExample.Position = desiredIndex 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-06-03T01:31:02.667

```
Private Sub DGW2_DataBindingComplete(ByVal sender As Object, ByVal e As System.Windows.Forms.DataGridViewBindingCompleteEventArgs) Handles DGW2.DataBindingComplete
    Dim mygrid As DataGridView
    mygrid = CType(sender, DataGridView)
    mygrid.ClearSelection()
End Sub 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-06-28T04:24:16.073

```
 Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click

        If DataGridView1.Rows.Count - 1 > 0 Then
            For i As Integer = 0 To DataGridView1.Rows.Count - 1 Step +1
                If DataGridView1.Rows.Count - 1 > 0 Then
                    DataGridView1.Rows.RemoveAt(0)
                End If
            Next
        Else

        End If
    End Sub 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-02-14T17:59:33.317

易于扩展

```
Imports System.Runtime.CompilerServices

Module Extensions

    ''' <summary>
    ''' Select the Row(Index)
    ''' </summary>
    ''' <param name="Dgv">The DataGridView</param>
    ''' <param name="Index">The Row Index (0 First)</param>
    ''' <param name="ScroolToTop">If True scrool the row to top</param>
    ''' <returns>True if no error or False if something went wrong</returns>

    ' USE: if not DataGridView1.GoToRow(30) then MsgBox("Something went wrong!)

    <Extension()>

    Public Function GoToRow(Dgv As DataGridView, Index As Integer, Optional ScroolToTop As Boolean = True) As Boolean
        If Index > -1 And Index < Dgv.Rows.Count - 1 Then
            With Dgv
                .ClearSelection()
                .Rows(Index).Selected = True
                If ScroolToTop Then .FirstDisplayedScrollingRowIndex = Index
            End With
            Return True
        End If
        Return False
    End Function

End Module 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-12-07T12:42:24.500

我有这样的 DataGridView：| 身份证 | 姓名 | |:---|:-----:| | 1 | 萨米尔 |

我使用此代码按“名称”搜索：

```
 Private Sub GunaButton6_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles GunaButton6.Click
            Dim temp As Integer = 0
            For i As Integer = 0 To Me.Listofclient.RowCount - 2
                If Me.Listofclient.Rows(i).Cells(1).Value.ToString = EDSearch.Text Then
                    Me.Listofclient.ClearSelection()
                    Me.Listofclient.Rows(i).Selected = True
                    temp = 1
                End If
            Next
            If temp = 0 Then
                MsgBox("Item not found")
            End If
        End Sub 
```

# wcf - WebServiceHostFactory 和 IIS 身份验证

> ID：575021
> 
> 赞同：11
> 
> 时间：2009-02-22T14:55:35.677
> 
> 标签：wcf

我在 IIS 中使用 WebServiceHostFactory 时遇到问题。

“IIS 指定了身份验证方案‘IntegratedWindowsAuthentication, Anonymous’，但绑定只支持指定一个身份验证方案。有效的身份验证方案是 Digest、Negotiate、NTLM、Basic 或 Anonymous。更改 IIS 设置，以便只有一个身份验证方案是用过的。”

[我想保留两种身份验证方案，并通过不使用工厂而是在 web.config 中手动设置端点来设法做到这一点。](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/331b2440-ff41-451e-a498-adfac2fe4493/)

我的问题是 WebServiceHostFactory 做了什么来得到这个结果？我的印象是 WebServiceHostFactory 会将绑定设置为我在配置中使用的相同 webHttpBinding。

编辑：我在反射器中查看了 WebServiceHostFactory ，它没有做任何聪明的事情。它只是 WebServiceHost 的一个简单工厂。

如果您在配置中设置端点，IIS 是否仍使用服务主机？还是 WebServiceHost 设置不同。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-06-08T01:34:43.970

这对我有用。尽早（在打开服务主机之前）添加一个虚拟端点，如下所示似乎已经成功了。（这篇 MSDN 文章暗示了这个[http://msdn.microsoft.com/en-us/library/bb412178.aspx](http://msdn.microsoft.com/en-us/library/bb412178.aspx)。）

```
public class MyWebServiceHost : WebServiceHost
{
    public MyWebServiceHost (Type serviceType, params Uri[] baseAddresses) : base(serviceType, baseAddresses)
    {
        // Inserting this dummy endpoint config seemingly does the trick:
        AddServiceEndpoint(typeof(IMyContract), new WebHttpBinding(), string.Empty);
    }

    protected override void ApplyConfiguration()
    {
        // Typical programmatic configuration here per:
        // http://msdn.microsoft.com/en-us/library/aa395224.aspx
    }
} 
```

我猜这会阻止 WebServiceHost 创建默认端点，从而关闭一堆功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T08:16:34.357

我不确定 WebServiceHostFactory，但听起来您在 IIS 中托管服务，并且选择了不止一种身份验证方法。如果您有 IIS 5 或 6，请尝试进入 IIS 并查看包含您的服务的网站或虚拟目录的属性。转到目录安全选项卡，单击“匿名访问和身份验证控制”下的编辑按钮，然后取消选中“匿名访问”或“集成 Windows 身份验证”。我不确定IIS7。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-22T15:25:09.927

在 IIS7 下，您可能找不到可以管理集成 Windows 身份验证设置的位置。为了在 IIS7 管理控制台中查看设置，您需要按照以下文章中描述的步骤操作：http: [//msdn.microsoft.com/en-us/library/x8a5axew.aspx](http://msdn.microsoft.com/en-us/library/x8a5axew.aspx)（标题为“错误：调试失败，因为未启用集成 Windows 身份验证”，如果链接不起作用）。

希望能帮助到你。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-02-17T11:50:33.243

在 web.config-> 配置标签中禁用安全性

```
 <system.serviceModel>
    <bindings>
      <webHttpBinding>
        <binding>
          <security mode="None">
            <transport clientCredentialType="Windows"/>
          </security>
        </binding>
      </webHttpBinding>
    </bindings>
  </system.serviceModel> 
```

那么您的 wcf 服务不需要身份验证...

# c# - 远程拨入时如何搜索 Active Directory？

> ID：575026
> 
> 赞同：1
> 
> 时间：2009-02-22T15:00:27.333
> 
> 标签：c#, asp.net, active-directory

有没有办法使用来自用户保存的密码列表的凭据并使用它而不是本地 Windows 凭据？

我需要根据用户的 Active Directory 用户名查找用户的电子邮件地址，以允许他们通过 Intranet 站点注册电子邮件更新。如果用户实际上直接登录到属于域的机器，这似乎很容易 - 我可以使用他们的身份名称根据他们的用户名搜索 AD：

```
using( DirectoryEntry root = new DirectoryEntry("LDAP://admachine.domain.local") )
{
  using( DirectorySearcher searcher = new DirectorySearcher(root) )
  {
    // strip the domain from the username and find the user in AD
    var username = Regex.Replace(Page.User.Identity.Name, @".*\\", string.Empty);
    searcher.ReferralChasing = ReferralChasingOption.All;
    searcher.SearchScope = SearchScope.Subtree;
    searcher.Filter = string.Format("(&(objectCategory=user)(objectClass=person)(sAMAccountName={0}))", username);
    var foundUser = searcher.FindOne();

    // error checking occurs here...
    var email = foundUser.Properties["mail"][0].ToString();

    // TODO: stuff with the email address
  }
} 
```

但是，如果在家中使用 PC 工作，这是行不通的。`Page.Identity.Name`解析为我登录到我自己的 PC 的名称 ( `MyMachine\Dave`)，忽略了我用来验证我的工作域 ( `WorkDomain\dave.downs`) 的存储凭据。

拾取并使用保存的`DirectoryEntry`凭据就好了，允许我实际绑定和搜索 AD，但我找不到将其用作的方法`var username`，它将包含我的本地计算机用户名。

有没有办法真正做我想做的事情，或者我只是以错误的方式做事/把头撞在砖墙上？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T18:17:35.753

我假设您正在使用 IIS。禁用匿名访问并启用 Windows 身份验证。这样，不在域中的任何人都会收到一个弹出窗口，允许他们指定域用户和密码。对于来自启用域的服务器的用户，没有任何变化。但是这样可以保证身份始终解析为有效的域用户。因此，这应该可以解决您的“我看到的是非域用户”的问题。有关详细信息，请检查[Windows 身份验证提供程序](http://msdn.microsoft.com/en-us/library/907hb5w9.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T22:13:32.237

如果他们通过 Windows Auth 登录，您可以使用：

```
System.Security.Principal.WindowsIdentity.GetCurrent().User 
```

这将为您提供登录用户的 sid。

禁用 IIS 中的匿名访问和集成安全性，强制他们通过 https 下的基本身份验证登录。这将确保当前会话在经过身份验证的域用户下运行。

# java - Java 小程序双缓冲问题（和循环问题）

> ID：575038
> 
> 赞同：0
> 
> 时间：2009-02-22T15:10:54.563
> 
> 标签：java, applet

出于某种原因，当我尝试对我的 Java 小程序进行双重缓冲时，即使我没有告诉它，它也会显示一个白色方块。此外，如果我尝试在 start() 中放置一个循环，即使 repaint() 在最后，我也只会得到一个白屏。

```
/**
* @(#)vo4k.java
*
* vo4k Applet application
*
* @author William Starkovich
* @version 1.00 2009/2/21
*/

import java.awt.*;
import java.applet.*;
import java.awt.event.*;
import java.awt.image.*; 

public class vo4k extends Applet implements KeyListener
{
obj p1, e1;
boolean[] keys;
boolean end = false;
Graphics g2d;
Dimension size;
Image buf; 

public void init() 
{
    keys = new boolean[256];

    for(int i = 0; i < 256; i++)
        keys[i] = false;

    addKeyListener(this);
    p1 = new obj();
    p1.x = 0;

    size = getSize();
    buf = createImage(size.width,size.height); 
    g2d = buf.getGraphics();
}

public void keyTyped(KeyEvent e) {}
public void keyPressed(KeyEvent e) {keys[e.getKeyCode()] = true;}
public void keyReleased(KeyEvent e) {keys[e.getKeyCode()] = false;}
public void controls()
{
    if(keys[KeyEvent.VK_SPACE])
        end = true;

    if(keys[KeyEvent.VK_W])
        p1.x += 10;

}

public void start()
{
//  while(!end)
//  {

//  }
}

public void paint(Graphics g) 
{

    controls();
    //g2d = (Graphics2D) g;
    g2d.setColor(Color.RED);
    g2d.fillRect(0,0,size.width,size.height);
    g2d.setColor(Color.BLUE);
    g2d.drawString("Welcome 2 Java!!", (int) 50, 60 );
    //g2d.drawString("Welcome to Java!!", (int) p1.x, 60 );

    g.drawImage(buf, 0, 0, this);
    repaint();
}
}

class obj
{
    double x,y,l,a,s;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T18:45:35.387

在绘画方法中检查尺寸。如果尺寸发生了变化，则创建一个新图像，然后对其进行绘制，并存储新的尺寸信息。另外，不要调用 repaint，因为您只是对绘制进行递归调用。

如果您在 start 方法中放置一个无休止的循环，则线程永远不会退出 start 方法。

```
public void paint(Graphics g) 
{

        controls();
        Dimension currentSize  = getSize();
        if ( ! currentSize.equals(size) ) {
          size = currentSize;
          buf = createImage(size.width,size.height); 
          g2d = buf.getGraphics();
        }
        //g2d = (Graphics2D) g;
        g2d.setColor(Color.RED);
        g2d.fillRect(0,0,size.width,size.height);
        g2d.setColor(Color.BLUE);
        g2d.drawString("Welcome 2 Java!!", (int) 50, 60 );
        //g2d.drawString("Welcome to Java!!", (int) p1.x, 60 );

        g.drawImage(buf, 0, 0, this);

} 
```

# javascript - wmode=window时如何将html内容放在flash上 ？

> ID：575039
> 
> 赞同：1
> 
> 时间：2009-02-22T15:11:29.553
> 
> 标签：javascript, flash, z-index, wmode

这甚至可能吗？

情况是，我不控制嵌入式flash，也无法知道是嵌入了wmode=tranparent/opaque还是wmode=window。这意味着在前两种情况下，我可以将我的 html 内容放在顶部，只需使用 z-index，但在最后一种情况下（wmode=window）我无法控制。

有人知道克服这个问题的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T23:18:49.770

您不能， wmode=window 的全部意义在于将插件放在位于主浏览器窗口顶部的覆盖窗口中 - 浏览器实际上不可能在其上绘制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-10T11:32:00.440

尝试一种叫做 iframe shim 的东西。不确定它的交叉兼容性如何，但它对我有用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-03-02T11:08:02.927

我不知道这是什么原因，但我已经这样做了，只需为具有绝对位置和 z-index 的 html 最外部内容提供一些纯色背景颜色，并且它通过 wmode=window. 我在 2010 年的一个项目中做到了这一点。当时的主要问题是 IE 和 chrome。

# .net - LINQ to SQL - 按小时分组

> ID：575042
> 
> 赞同：11
> 
> 时间：2009-02-22T15:12:39.347
> 
> 标签：.net, sql, linq, linq-to-sql

考虑到列类型是 DateTime，如何按小时对 LINQ to SQL 查询的结果进行分组？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-22T16:33:53.020

这是技术时间的解决方案（无上下文）。

```
var query = myDC.Orders
    .GroupBy(x => x.OrderDate.Hour)
    .Select(g => new {
        Hour = g.Key,
        Amount = g.Sum(x => x.OrderAmount)
    }); 
```

这会产生：

```
SELECT SUM([t1].[OrderAmount]) AS [Amount], [t1].[value] AS [Hour]
FROM (
    SELECT DATEPART(Hour, [t0].[OrderDate]) AS [value], [t0].[OrderAmount]
    FROM [dbo].[Orders] AS [t0]
    ) AS [t1]
GROUP BY [t1].[value] 
```

* * *

这是营业时间的解决方案（上下文相关）。

```
DateTime zeroDate = new DateTime(2008, 1, 1);

var query = myDC.Orders
    .GroupBy(x => System.Data.Linq.SqlClient.SqlMethods.DateDiffHour(zeroDate, x.OrderDate)
    )
    .Select(g => new { Hours = g.Key, Amount = g.Sum(x => x.OrderAmount) })
    .Select(x => new { Hour = zeroDate.AddHours(x.Hours), Amount = x.Amount}); 
```

这会产生：

```
SELECT DATEADD(ms, (CONVERT(BigInt,(CONVERT(Float,[t2].[value2])) * 3600000)) % 86400000, DATEADD(day, (CONVERT(BigInt,(CONVERT(Float,[t2].[value2])) * 3600000)) / 86400000, @p1)) AS [Hour], [t2].[value] AS [Amount]
FROM (
    SELECT SUM([t1].[OrderAmount]) AS [value], [t1].[value] AS [value2]
    FROM (
        SELECT DATEDIFF(Hour, @p0, [t0].[OrderDate]) AS [value], [t0].[OrderAmount]
        FROM [dbo].[Orders] AS [t0]
        ) AS [t1]
    GROUP BY [t1].[value]
    ) AS [t2] 
```

* * *

呃 - bigint/float/milliseconds 的东西很难看而且很难验证。我更喜欢在客户端进行添加：

```
var results = myDC.Orders
    .GroupBy(x => System.Data.Linq.SqlClient.SqlMethods.DateDiffHour(zeroDate, x.OrderDate)
    )
    .Select(g => new { Hours = g.Key, Amount = g.Sum(x => x.OrderAmount) })
    .ToList()
    .Select(x => new { Hour = zeroDate.AddHours(x.Hours), Amount = x.Amount}); 
```

这会产生：

```
SELECT SUM([t1].[OrderAmount]) AS [Amount], [t1].[value] AS [Hours]
FROM (
    SELECT DATEDIFF(Hour, @p0, [t0].[OrderDate]) AS [value], [t0].[OrderAmount]
    FROM [dbo].[Orders] AS [t0]
    ) AS [t1]
GROUP BY [t1].[value] 
```

* * *

这是进行上下文时间的第三种方法。这个对 c# 非常友好，但是数据库中有字符串逻辑（糟糕）。

```
var query = myDC.Orders
    .GroupBy(x => new DateTime(x.OrderDate.Year, x.OrderDate.Month, x.OrderDate.Day, x.OrderDate.Hour, 0, 0))
    .Select(g => new { Hour = g.Key, Amount = g.Sum(x => x.OrderAmount) }); 
```

产生

```
SELECT SUM([t1].[OrderAmount]) AS [Amount], [t1].[value] AS [Hour]
FROM (
    SELECT CONVERT(DATETIME, (CONVERT(NCHAR(4), DATEPART(Year, [t0].[OrderDate])) + ('-' + (CONVERT(NCHAR(2), DATEPART(Month, [t0].[OrderDate])) + ('-' + CONVERT(NCHAR(2), DATEPART(Day, [t0].[OrderDate])))))) + (' ' + (CONVERT(NCHAR(2), DATEPART(Hour, [t0].[OrderDate])) + (':' + (CONVERT(NCHAR(2), @p0) + (':' + CONVERT(NCHAR(2), @p1)))))), 120) AS [value], [t0].[OrderAmount]
    FROM [dbo].[Orders] AS [t0]
    ) AS [t1]
GROUP BY [t1].[value] 
```

# wpf - 如何在 DataTemplate 中找到 ListView？

> ID：575051
> 
> 赞同：0
> 
> 时间：2009-02-22T15:17:04.080
> 
> 标签：wpf, xaml

我在 xaml 中有这个 ListView

```
 <ListView x:Name="PersonsListView" ItemsSource="{Binding}" ItemTemplate="{DynamicResource personLayout}">
    <ListView.Resources>
        <DataTemplate x:Key="personLayout" DataType="Person">
            <StackPanel Orientation="Vertical">
                <TextBlock Text="{Binding Path=FullName}"/>
                <ListView x:Name="AddressesListView" ItemsSource="{Binding Path=Addresses}"/>
            </StackPanel>
        </DataTemplate>
    </ListView.Resources>
</ListView> 
```

如何在后面的代码中使用 AddressesListView？例如，如果我想做 AddressesListView.SelectItem。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T17:28:27.553

给定 PersonsListView 中属于 Person 类型的项，您可以使用 PersonsListView 上的 ItemContainerGenerator 属性，并找到数据项的容器。然后，您应该能够使用 FrameworkElement.FindName() 来查找该特定元素。

嵌套的列表视图看起来有点奇怪 BTW :)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T18:12:23.230

查看此博客文章以了解更多类似这样的场景.....

[http://blogs.msdn.com/wpfsdk/archive/2007/03/16/how-do-i-programmatically-interact-with-template-generated-elements-part-i.aspx](http://blogs.msdn.com/wpfsdk/archive/2007/04/16/how-do-i-programmatically-interact-with-template-generated-elements-part-i.aspx)

[http://blogs.msdn.com/wpfsdk/archive/2007/04/16/how-do-i-programmatically-interact-with-template-generated-elements-part-ii.aspx](http://blogs.msdn.com/wpfsdk/archive/2007/04/16/how-do-i-programmatically-interact-with-template-generated-elements-part-ii.aspx)

# objective-c - 如何在 Objective-C 中构建类方法的 NSArray（或 NSMutableArray）？

> ID：575055
> 
> 赞同：14
> 
> 时间：2009-02-22T15:21:12.180
> 
> 标签：objective-c

我正在尝试在[Objective-C](http://en.wikipedia.org/wiki/Objective-C)中构建一个 NSArray 方法。

（我在这里想要完成的是类似于 C 中的以下内容）

```
typedef (void)(*handler)(int command);

void handleCommandA(void) { ... }
void handleCommandB(void) { ... }

static const handler handler_table[10] = {
    handleCommandA, handleCommandB, handleCommandC
}; 
```

我必须将它移植到Objective-C，但我不知道如何在编译时构建函数指针数组（在Objective-c 世界中，类方法）。

在 Objective-C 中，我有以下内容。

```
- (void)handleCommandA { ... }
- (void)handleCommandB { ... }

/* Now how to add above 2 functions into NSArray? */
NSArray *handler_table = [NSArray arrayWithObjects:... ];  /* This doesn't seem to work. */ 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-22T17:53:50.397

这里的问题是，要绑定这些函数，您必须使用返回 SEL 类型的选择器关键字。这是一个指针类型，而 NSArray 存储对象。

因此，您有三个选择；

1.  使用常规的 C 类型数组
2.  将函数折叠到将调用它们的 NSObject 派生类中。
3.  使用协议。

第二个可能更好，为此您可以使用 NSValue 类来保存选择器结果。例如;

```
NSValue* selCommandA = [NSValue valueWithPointer:@selector(handleCommandA:)];
NSValue* selCommandB = [NSValue valueWithPointer:@selector(handleCommandB:)];

NSArray *handler_table = [NSArray arrayWithObjects:selCommandA, selCommandB, nil ]; 
```

当您从数组中检索到正确的条目后，您可以进行转换；

```
SEL mySelector = [selCommand pointerValue];
[someObject performSelector:mySelector]; 
```

（请注意，我假设从您的objective-c语法中，这些旨在用作对象上的方法而不是全局函数。如果您希望在全局范围内使用它们，那么您应该像在普通C中一样编写它们。）

另一种选择是将命令方法形式化为协议。这允许您编写适用于实现该协议的任何对象的功能，并且编译器将提供比您仅调用选择器时更多的检查。

例如

```
// some header
@protocol CommandHandler
@required
-(void) handleCommandA;
-(void) handleCommandB;
@end

// some other header
@interface someClass : NSObject<CommandHandler>
{
// you will receive compiler warnings if you do not implement the protocol functions
} 
```

然后编写处理和调度代码以使用“CommandHandler”类型的对象。例如

```
-(void) registerForCommands:(CommandHandler*)handler 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-30T15:54:21.887

使用 NSValue。

例如：

```
NSArray* handlers = [NSArray arrayWithObjects:[NSValue valueWithPointer:handleA] ... ]; 
```

然后访问：

```
handleptr* handle = (handlerptr*)[[handlers objectAtIndex:0] pointerValue];
handle(foo_bar); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-22T18:35:19.203

在 Objective-C 中，你不传递方法；你传递*selectors*，它们基本上是方法的规范名称。然后，为了让对象响应选择器消息，您发送它`performSelector:`。例如：

```
NSString *exampleString = [NSString stringWithString:@"Hello"];
SEL methodName = @selector(stringByAppendingString:);
  // ^This is the selector. Note that it just represents the name of a
  //  message, and doesn't specify any class or implementation
NSString *combinedString = [exampleString performSelector:methodName withObject:@" world!"]; 
```

您需要创建一个包含您感兴趣的选择器名称的 NSString 数组。您可以使用该函数`NSStringFromSelector()`来执行此操作。然后，当您想使用它们时，调用`NSSelectorFromString()`字符串以获取原始选择器并将其传递给相应对象的`performSelector:`. （如上面的示例所示，接收器未编码在选择器中 - 只是方法名称 - 因此您可能还需要存储接收器。）

# macos - 如何在 XEmacs 中折叠 LaTeX 文件？

> ID：575060
> 
> 赞同：1
> 
> 时间：2009-02-22T15:24:29.723
> 
> 标签：macos, emacs, folding, aquamacs

我想在我的 AquaEmacs 中自动折叠评论。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T00:54:35.533

看看[`hs-minor-mode`](http://www.gnu.org/software/emacs/manual/html_node/emacs/Hideshow.html)。虽然它不是自动的。对于更自动的方法，我想您可以通过以下方式自定义 hideshow 模式：

1.  通过隐藏评论`hs-hide-comments-when-hiding-all`
2.  分配一个不隐藏任何内容的函数，`hs-hide-all-non-comment-function`然后
3.  用于`hs-hide-all`隐藏所有评论。

没试过。只是一个想法。

也可以查看[emacswiki 上的 hideshow 模式页面](http://www.emacswiki.org/cgi-bin/wiki/HideShow)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-23T16:35:34.193

你不能像在 Vim 中那样有类似的折叠。我无法对特定行进行折叠。

但是，有一个插件[Auctex](http://www.gnu.org/software/auctex/screenshots.html)可以为您提供 Emacs-folds。它们不像 Vim 那样灵活。

如果您找到了更好的解决方案，请告诉我。

# c# - 中继器中的用户控件

> ID：575063
> 
> 赞同：4
> 
> 时间：2009-02-22T15:24:55.137
> 
> 标签：c#, asp.net, user-controls, postback, repeater

我有一个提供投票按钮的用户控件（对于 SO 类型投票模型） - 它包含一个私有 int 成员，该成员保留记录的 id。在转发器之外，它运行得很好 - 回发工作，并且正确的 id 保留在用户控件中。

在转发器内部，itemdatabound 事件处理程序将正确的 ID 与用户控件相关联，并且它可以正常工作 - 显示来自数据库的正确投票计数。但是，当按下其中一个投票按钮时，它会向用户控件发出回发，并且该控件已丢失其私有 int 成员的内容，因此它不再起作用。

我已经尝试过在回发时重新绑定用户控件，并且只在初始加载时绑定它 - 两种方式的问题都是一样的。

如何让用户控件在回发中保留该 int 的值？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-22T15:29:37.933

您是否尝试过将值放入 viewstate ？

```
public string Id{
    get
    {
        return this.ViewState["Value"] == null ?
            0 :
            (int)this.ViewState["Value"];
    }
    set { this.ViewState["Value"] = value; }
} 
```

# activerecord - Castle ActiveRecord 播种主键值

> ID：575069
> 
> 赞同：2
> 
> 时间：2009-02-22T15:27:46.627
> 
> 标签：activerecord, primary-key, castle-activerecord

我想知道如何使用 Castle AR“播种”一个自动递增的主键值？例如，希望 Orders 表的主键以 10000 开头。这是 1\. 可能 2\. 创建订单号的好解决方案吗？

也许有一种方法可以在不是 pk 的数据库上连续自动递增字段，播种为 10000？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T19:02:19.700

Castle ActiveRecord 建立在 NHibernate 之上，AR 的功能在很大程度上依赖于 NHibernate 的功能。NHibernate 包含几个主键生成器：
1\. **native** - 这是默认的生成器。如果你指定了这个，NHibernate 会根据底层数据库自动选择生成器类型。例如，如果我在上面的映射片段中使用本机而不是身份，您仍然会得到相同的 SQL，因为 NHibernate 足够聪明，可以理解底层数据库 SQL Server 并且它支持身份列。NHibernate 使用 Convert.ChangeType 方法转换返回的值。
2.**身份**- 这可以与 SQL Server、MySQL、Sybase 等提供的身份列一起使用，
3。**序列**- Firebird、DB2、PostgreSQL、Oracle、SAP DB 支持序列
4。**增量**- 此生成器不使用任何数据库功能，如序列或身份。NHibernate 自动将 1 增加到最后一个主键值。这个生成器在处理单个数据库系统时很有帮助，但在基于集群的环境中没有帮助。
5\. **hilo** - Hi/Lo 算法用于生成主键值。与其他发电机类型相比，这非常有效。使用时，NHibernate 创建一个名为 hibernate_unique_key 的单独表并创建一个名为 next_hi 的列，然后 NHibernate 在 INSERT 发生时使用此表作为参考。我们将在本文后面详细讨论这一点。
6.uuid.hex **_**- 使用 System.Guid 及其 ToString 方法生成基于字符串的主键值。
7\. **guid** - 当类属性类型为 Guid 时可以使用。
8\. **guid.comb** - 这与 guid 类似，但使用不同的算法来生成主键值。请注意，uuid.hex、guid、guid.comb 使用 UNIQUEIDENTIFIER 作为 SQL Server 中的列数据类型。
9.已**分配**——最后但并非最不重要的一点是，此生成器假定主键值是由用户分配的。

所以你可以看到没有这样的内置功能。为了创建订单号，您可以使用两种方式：
1\. 选择最大订单并手动设置它
2\. 向数据库添加一些插入触发器
我认为您应该使用第一种方式，因为这样您将不依赖数据库。当您需要向上或向下移动对象时，您可以重用此功能。我一般都是用这种方式。

# c++ - 在 C++ 中的 ifstream 上设置超时？

> ID：575070
> 
> 赞同：5
> 
> 时间：2009-02-22T15:28:02.167
> 
> 标签：c++, linux, input, mouse

我们正在尝试从连接到 linux 盒子的 2 个 USB 鼠标中读取数据（该数据用于机器人的里程计/定位）。所以我们需要不断地从每只鼠标中读取它移动了多少。问题是当鼠标不移动时，它不会发送任何数据，因此我们从中获取数据的文件流会阻止执行，因此程序无法进行里程计计算（其中涉及速度的时间测量） .

有没有办法在输入流上设置超时（我们在 C++ 中使用 ifstream 并从 /dev/input/mouse 读取），以便我们能够知道鼠标何时不移动，而不是等待接收事件？还是我们需要弄乱线程（arggh ...）？欢迎任何其他建议！

提前致谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-22T16:31:59.017

在 linux 中读取多个文件描述符的常用方法是使用 select()。我建议从[手册页](http://linux.die.net/man/2/select)开始。基本系统流程如下：

1) 初始化设备
2) 获取设备文件描述符列表
3) 设置超时
4) 使用文件描述符和超时作为参数调用 select - 它将阻塞直到其中一个文件描述符上有数据或达到超时
5 ) 确定选择返回的原因并采取相应措施（即在具有数据的文件描述符上调用 read()）。您可能需要在内部缓冲读取的结果，直到获得整个数据报。
6）循环回到4。

这可以成为您的程序主循环。如果您已经有一个不同的主循环，则可以在不循环的情况下运行上述循环，但您需要确保该函数被足够频繁地调用，这样您就不会丢失串行端口上的数据。您还应该确保您的更新速率（即 1/超时）对于您的主要任务来说足够快。

Select 可以对任何文件描述符进行操作，例如网络套接字以及通过文件描述符公开接口的任何其他内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T15:36:31.847

您正在寻找的是一种从 ifstream 中读取的异步方式，例如套接字通信。唯一可以帮助的是[readsome](http://www.cplusplus.com/reference/iostream/istream/readsome.html)函数，如果没有可用数据，它可能会返回，但我怀疑这是否有帮助。

使用线程将是处理此问题的最佳方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T16:33:21.617

看看[boost Asio 库](http://www.boost.org/doc/libs/1_38_0/doc/html/boost_asio/overview.html)。这可能会帮助您处理 schnaeder 建议的线程。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-22T15:34:22.493

不，没有这样的方法。您将不得不等待一个事件，或者创建一个自定义 Timer 类并等待超时重新轮询，或者使用线程。

# audio - 如何将声音分开输出到扬声器和耳机？

> ID：575075
> 
> 赞同：0
> 
> 时间：2009-02-22T15:31:04.873
> 
> 标签：audio, split

操作系统：win xp
主板：华硕A8N-E（内置声卡）
我有一个扬声器和一个耳机。
当同时使用 mp3 播放器和媒体播放器时，所有声音都会输出到所有声音输出设备（扬声器和耳机）。

是否可以让mp3仅在扬声器中输出而媒体播放器仅在耳机中输出？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T15:59:49.950

哪个操作系统？

如果您运行的是 Windows 并且您的 PC 具有 HDAudio 解决方案，那么扬声器和耳机可能会显示为两个独立的输出设备（这取决于 - 例如，在我的笔记本电脑上，耳机和扬声器显示为相同的输出设备，并且有一个电子插入耳机时在两者之间切换的开关）。

如果耳机和扬声器显示为单独的音频设备，那么希望您的媒体播放器具有允许您选择它使用的输出设备的配置选项。

如果您正在运行 AC'97 音频解决方案（我怀疑您是因为您的音频解决方案似乎支持硬件环回），那么您可能不走运 - 这完全取决于音频解决方案的制造商如何连接它向上。

如果您运行的是 Windows 7，如果您启动音频播放控制控制面板 (mmsys.cpl)，请为插入 MP3 播放器的设备选择“属性”并导航到“收听”选项卡，您可以询问Windows 将任何输入的内容播放到任何输出设备上。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-22T15:32:47.723

不，不是没有第二个声卡

# sql - 数据库中的名字变体

> ID：575076
> 
> 赞同：10
> 
> 时间：2009-02-22T15:31:49.630
> 
> 标签：sql, sql-server, algorithm, database-design, data-structures

我正在尝试确定在数据库中查找名字的变体的最佳方法是什么。例如，我搜索 Bill Smith。显然，我希望它返回“Bill Smith”，但我也希望它返回“William Smith”或“Billy Smith”，甚至“Willy Smith”。我最初的想法是建立一个名字层次结构，但我不知道在哪里可以获得这样的数据，如果它存在的话。

由于用户可以搜索目录，我认为这将是一个关键功能。例如，和我一起上学的人都叫我乔，但我现在总是叫约瑟夫。因此，我正在考虑使用 NYSIIS 或 Double Metaphone 对姓氏进行拼音搜索，然后使用此名称层次结构搜索名字。有没有更好的方法来做到这一点 - 也许使用全名的全文搜索而不是名字和姓氏的两部分搜索来进行某种分级相关性？我的一部分认为，如果我将名称存储为单个值而不是多个值，它可能会促进更多的搜索选项，但代价是能够通过名字来称呼用户。

就平台而言，我使用的是 SQL Server 2005 - 但是，将一些匹配项转移到代码中没有问题；例如，为用户预先播种语音键，因为它们不会改变。

任何想法或指导将不胜感激。无数次搜索几乎都是空的。谢谢！

**编辑：似乎在功能上有两个非常不同的阵营，我现在肯定坐在中间。我可以看到全文搜索的论点——很可能是在缺乏数据规范化的情况下完成的，以及对名称的不同部分使用不同标准的多部分方法。**

**问题最终归结为用户意图。比尔/威廉的例子是一个很好的例子，因为它显示了基于使用形式的名字的变化。我认为构建名称层次结构是更准确（和可扩展）的解决方案，但会复杂得多。模糊搜索方法以牺牲准确性为代价更容易实现。这是一个公平的比较吗？**

**解决方案：在进行了一些测试后，我决定采用一种方法，即初始注册将采用全名，并将其拆分为多个字段（名字、姓氏、中间名、后缀等）。由于我确信它不会完美，我将允许用户编辑“部分”，包括添加婚前姓名或备用姓名。就搜索而言，无论是哪种解决方案，我都需要维护存在的变化，无论是在数据库表中还是作为同义词库。在这种情况下，两者都没有优势。我认为这将归结为性能，我将不得不实际运行一些基准来确定哪个是最好的。谢谢大家，您的意见！**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T15:46:59.547

在我看来，你要么*正确*地完成一个特性并使其*完整*，要么你应该放弃它以避免将一个半笨的智能构建到一个计算机程序中，而这个程序在大多数情况下仍然会出错（[“看起来你在写一封信”](http://en.wikipedia.org/wiki/Office_Assistant)，有人吗？）。

在人名的情况下，计算机大部分时间都会出错，恕我直言，正确和完整地完成它是不可能的。也许你可以破解一些最常见的英文名字。但实际上，寻找“Bill”和“William”的智慧几乎是所有说英语的人都具备的——我会让他们把这些点联系起来。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-01-07T19:51:44.610

您正在寻找的术语是 Hypocorism：

[http://en.wikipedia.org/wiki/Hypocorism](http://en.wikipedia.org/wiki/Hypocorism)

维基百科列出了其中的许多。您可以使用一些 Python 或 Perl 来抓取该页面并将其放入数据库中。

我会采用这样的结构：

```
create table given_names (
  id int primary key,
  name text not null unique
);

create table hypocorisms (
  id int references given_names(id),
  name text not null,

  primary key (id, name)
);

insert into given_names values (1, 'William');
insert into hypocorisms values (1, 'Bill');
insert into hypocorisms values (1, 'Billy'); 
```

然后你可以写一个函数/存储过程来规范化一个名字：

```
normalize_given_name('Bill'); --returns William 
```

您将面临的一个问题是不同的名字可能具有相同的虚伪（Albert -> Al，Alan -> Al）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T15:41:57.123

我认为你的基本方法是可靠的。我不认为全文会帮助你。对于播种，behindthename.com 似乎有大量您想要的数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T15:44:09.210

您是否正在使用带有高级服务的 SQl Server 2005 Express 对我而言，听起来您将从全文索引中受益，更具体地说，您可以使用包含和包含表，您可以使用特定说明，这里是包含表使用的链接：

[http://msdn.microsoft.com/en-us/library/ms189760.aspx](http://msdn.microsoft.com/en-us/library/ms189760.aspx)

这是带有高级服务的 SQL Server 2005 的下载链接：

[http://www.microsoft.com/downloads/details.aspx?familyid=4C6BA9FD-319A-4887-BC75-3B02B5E48A40&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=4C6BA9FD-319A-4887-BC75-3B02B5E48A40&displaylang=en)

希望这可以帮助，

安德鲁

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T15:46:24.400

您可以使用 SQL Server 全文搜索并进行屈折搜索。

基本上像：

SELECT ProductId, ProductName FROM ProductModel WHERE CONTAINS(CatalogDescription, 'FORMSOF(THESAURUS, metal)')

查看： [http ://en.wikipedia.org/wiki/SQL_Server_Full_Text_Search#Inflectional_Searches](http://en.wikipedia.org/wiki/SQL_Server_Full_Text_Search#Inflectional_Searches) [http://msdn.microsoft.com/en-us/library/ms345119.aspx](http://msdn.microsoft.com/en-us/library/ms345119.aspx) [http://www.mssqltips.com/tip.asp ?提示=1491](http://www.mssqltips.com/tip.asp?tip=1491)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-22T19:26:00.393

不确定您的应用程序是什么，但如果您的用户在注册时知道他们过去的人可能正在为他们搜索数据库，您可以为他们提供在用户配置文件中定义其他名称的机会，他们可能被称为（包括姓氏，女性一直在改变这些，让找到它们变得更加困难！）并且他们希望人们能够搜索。将这些存储在单独的相关表中。然后搜索那个。只需制作这样的结构，以便您可以将一个名称定义为主名称（用于除搜索之外的所有内容的名称。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-13T18:39:17.323

您会发现您正在涉足一个称为“自然语言处理”的领域，您需要做几件事，其中大部分可以在[词干提取](http://en.wikipedia.org/wiki/Stemming)主题下找到。

简单的词干只是将单词分开，但更高级的算法将具有相同含义的词关联起来——例如，谷歌可能会使用词干将“cat”和“kitten”转换为“feline”并搜索这三个词，权衡提供的实际词由用户稍微重一些，因此完全匹配在词干匹配之前返回。

这是一个已知问题，并且有可用的[开源词干分析器](https://stackoverflow.com/questions/595110/stemming-code-examples-or-open-source-projects)。

-亚当

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-22T15:52:36.257

不，全文搜索无助于解决您的问题。

我想你可能想看看下面的一些链接：（有趣的是，直到现在还没有人提到 SoundEx）

*   [SoundEx - MSDN](http://msdn.microsoft.com/en-us/library/ms187384.aspx)
*   [SoundEx - 谷歌搜索结果](http://www.google.com/search?q=soundex+sql)
*   [InformIT - 容错搜索算法](http://www.informit.com/articles/article.aspx?p=24691)

基本上，SoundEx 允许您评估相似发音词的相似度。该函数在 SQL 2005 上也可用。

作为一个附带问题，与其返回相似的结果，不如使用基于 AJAX 的脚本在用户启动他/她的搜索之前提供相似的听起来名称对用户来说可能更直观。这样你就可以向用户显示“相似的名字”或“你的意思是......”类型的数据。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-13T18:32:34.750

这是一个自动查找像 Bill/William 这样的“名称同义词”的想法。这个问题已经在一般同义词的更广泛背景下进行了研究：从在像 Web 这样的大型文本语料库中哪些单词通常出现在相同上下文中的统计数据中推断出它们。您可以尝试将该方法与[Moby Names](http://en.wikipedia.org/wiki/Moby_Project)等名称列表结合使用；不知道以前有没有做过。

[这里有一些指示。](http://forums.searchenginewatch.com/archive/index.php/t-13814.html)

# apache - RewriteRule，代理指令 [P] - 是否可以使请求使用实际的代理主机？

> ID：575077
> 
> 赞同：1
> 
> 时间：2009-02-22T15:32:18.613
> 
> 标签：apache, mod-rewrite, mod-proxy

有谁知道是否可以制定使用代理 [P] 指令的重写规则，如下所示，其行为类似于`ProxyPass`与`ProxyPreserveHost Off`.

换句话说，我希望 mydomain.net 上的服务器看到对 mydomain.net 而不是 mydomain.com 的请求。

```
RewriteCond  %{HTTP_HOST} ^mydomain.com$  [NC]
RewriteRule ^/(.*)$  http://mydomain.net/app1/$1 [P,L] 
```

谢谢和最好的问候，

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-22T15:36:27.263

由于 [P] 实际上使用 mod_proxy，我会尝试将 ProxyPreserveHost 设置为关闭并查看是否这样做。

# python - 为什么调用 file.close() 后 Python 不释放文件句柄？

> ID：575081
> 
> 赞同：5
> 
> 时间：2009-02-22T15:32:53.167
> 
> 标签：python

我在使用 Python 2.5 的 Windows 上。我有一个要写的打开文件。我写了一些数据。调用文件关闭。当我尝试使用 Windows 资源管理器从文件夹中删除文件时，它会出错，说进程仍然持有文件的句柄。

如果我关闭 python，然后再试一次，它会成功。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-22T15:38:49.190

它确实关闭了它们。你确定 f.close() 被调用了吗？我刚刚测试了相同的场景，Windows 为我删除了该文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T17:35:45.633

您是否处理文件对象周围的任何异常？如果是这样，请确保错误处理看起来像这样：

```
f = open("hello.txt")
try:
    for line in f:
        print line
finally:
    f.close() 
```

在考虑为什么要这样做时，请考虑以下代码行：

```
f = open('hello.txt')
try:
    perform_an_operation_that_causes_f_to_raise_an_exception()
    f.close()
except IOError:
    pass 
```

如您所见，上述代码中永远不会调用 f.close。问题是上面的代码也会导致 f 没有得到垃圾收集。原因是 f 仍会在 sys.traceback 中被引用，在这种情况下，唯一的解决方案是在 finally 块中手动调用 f 的 close 或将 sys.traceback 设置为 None（我强烈推荐前者）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-12-31T14:38:44.250

教程中解释：

```
with open('/tmp/workfile', 'r') as f:
    read_data = f.read() 
```

它在您编写或腌制/解封时也有效

try finally 块并不是真的有必要：Java 做事方式，而不是 Python

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-06-20T19:13:34.777

我一直在寻找这个，因为同样的事情发生在我身上。这个问题对我没有帮助，但我想我知道发生了什么。

在我编写的脚本的原始版本中，我忽略了在文件中添加“finally”子句以防出现异常。

我正在从交互式提示中测试脚本，并在文件打开时出现异常。我没有意识到文件对象并没有立即被垃圾收集。之后，当我运行脚本时（仍然来自同一个交互式会话），即使*新*文件对象正在关闭，第一个对象仍然没有，因此文件句柄仍在使用中，从角度来看操作系统。

一旦我关闭交互式提示，问题就消失了，我记得在文件打开时发生了异常，并意识到发生了什么。（道德：不要试图在睡眠不足的情况下进行编程。:)）

当然，我不知道这是否是原发者的情况，即使原发者还在，他们可能不记得具体情况，但症状相似，所以我想我会补充对于任何陷入相同情况并寻找答案的人来说，这是要检查的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-05-30T12:11:07.950

我使用中间文件做到了：

```
import os

f = open("report.tmp","w")
f.write("{}".format("Hello"))
f.close()
os.system("move report.tmp report.html") #this line is for Windows users 
```

# database - 哪里可以获得西班牙语 <-> 英语翻译数据库？

> ID：575089
> 
> 赞同：11
> 
> 时间：2009-02-22T15:42:07.763
> 
> 标签：database, language-agnostic, translation, vocabulary

对于我正在编写的程序，我需要一本西班牙语和英语单词之间的字典。我用谷歌搜索了一段时间，但我找不到任何免费可用的数据库。有谁知道在哪里或如何获得这样的数据库（最好是简单的 CSV 或 XML 文件）？

到目前为止，我创建这样一个字典的最佳想法是创建一个在 Wikipedia 上查找英语单词的小程序，并使用语言链接来提取正确的翻译。但我不想仅仅为了生成这个数据库就向维基百科发出一百万个请求......

我不需要任何花哨的东西，只需要从一个词到这个词的一个或多个翻译的映射。就像一本普通的字典。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-22T15:55:21.740

[在Omega Wiki](http://www.omegawiki.org/Meta:Main_Page)上四处询问，以前称为 Ultimate Wiktionary 或 Wiktionary Z。他们收集所有语言到所有语言的翻译，并且他们的数据可在关系数据库中获得。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T15:46:52.900

您是否需要在运行时即时翻译，还是一次性翻译 UI 的标签和消息？

我会说运行时翻译将非常困难，因为您需要的不仅仅是单词词典。自然语言处理在任何语言中都是困难的。大多数语言需要了解上下文才能顺利翻译。

如果它是 UI 元素的一次性翻译，我很幸运使用谷歌翻译将日语翻译成英语。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T21:28:04.937

为了回答你的问题，对不起，我没有这样的数据库。

自然语言的问题在于它们非常依赖于上下文，因此英语中的同一个词在法语中可能意味着很多东西。以英语动词“知道”为例。这可以翻译成法语作为“savoir”（了解一个事实）或connaitre（了解一个人或一个城镇）。

我很想知道是否存在这样的数据库，但我怀疑它是否存在。

像[http://www.reverso.net](http://www.reverso.net)这样的网站通过显示这两个结果来对冲他们的赌注。

# php - 从另一个迭代器的结果创建新的迭代器

> ID：575106
> 
> 赞同：3
> 
> 时间：2009-02-22T15:53:20.030
> 
> 标签：php, filter, iterator

我正在尝试在 PHP 5 中有效地使用迭代器，并且在网络上没有很多像样的示例，事实证明这有点困难。

我正在尝试遍历一个目录，并读取其中的所有（php）文件以搜索定义的类。然后我想要做的是返回一个关联数组，其中类名作为键，文件路径作为值。

通过使用 RecursiveDirectoryIterator()，我可以通过目录递归。通过将其传递给 RecursiveIteratorIterator，我可以将目录的内容作为一维迭代器检索。然后在此使用过滤器，我可以过滤掉所有目录和非 php 文件，这些文件只会留下我想要考虑的文件。

我现在想要做的是能够将此迭代器传递给另一个迭代器（不确定哪个合适），这样当它遍历每个条目时，它可以检索一个需要组合成主数组的数组。

解释起来有点复杂，所以这里有一个代码示例：

```
// $php_files now represents an array of SplFileInfo objects representing files under $dir that match our criteria
$php_files = new PhpFileFilter(new RecursiveIteratorIterator(new RecursiveDirectoryIterator($dir)));

class ClassDetector extends FilterIterator {
    public function accept() {
        $file = $this->current(); // get the current item, which will be an SplFileInfo object

        // Match all the classes contained within this file
        if (preg_match($regex, $file->getContents(), $match)) {
            // Return an assoc array of all the classes matched, the class name as key and the filepath as value
            return array(
                'class1' => $file->getFilename(),
                'class2' => $file->getFilename(),
                'class3' => $file->getFilename(),
            );
        }
    }
}

foreach (new ClassDetector($php_files) as $class => $file) {
    print "{$class} => {$file}\n";
}

// Expected output:
// class1 => /foo.php
// class2 => /foo.php
// class3 => /foo.php
// class4 => /bar.php
// class5 => /bar.php
// ... etc ... 
```

正如你从这个例子中看到的那样，我有点劫持了 FilterIterator 的 accept() 方法，我知道这是完全不正确的用法 - 但我只是用它作为一个例子来演示我只想如何调用一个函数，并让它返回一个合并到主数组中的数组。

目前我在想我将不得不使用其中一个 RecursionIterators，因为这似乎是他们所做的，但我不喜欢使用两种不同方法（hasChildren() 和 getChildren( )) 来实现目标。

简而言之，我试图确定我可以使用（或扩展）哪个迭代器来让它传递对象的一维数组（？），并让它将结果数组组合成一个主数组并返回它.

我意识到还有其他几种方法可以解决这个问题，比如：

```
$master = array();
foreach($php_files as $file) {
    if (preg_match($regex, $file->getContents(), $match)) {
        // create $match_results
        $master = array_merge($master, $match_results);
    }
} 
```

但这违背了使用迭代器的目的，并且作为解决方案也不是很优雅。

无论如何，我希望我已经解释得足够好。感谢您阅读本文，并提前为您解答:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-25T23:21:22.533

是的，我最终设法解决了这个问题。我不得不使用递归迭代器，因为输入迭代器本质上是生成子结果，并且我扩展了 IteratorIterator，它已经具有循环遍历迭代器的功能。

无论如何，这是一个代码示例，以防万一这对其他人有帮助。这假设您已经传入了一个 SplFileInfo 对象数组（无论如何都是 DirectoryIterator 的结果）。

```
class
    ClassMatcher
extends
    IteratorIterator
implements
    RecursiveIterator
{

    protected $matches;

    public function hasChildren() {
        return preg_match_all(
            '#class (\w+)\b#ism',
            file_get_contents($this->current()->getPathname()),
            $this->matches
        );
    }

    public function getChildren() {
        $classes = $this->matches[1];

        return new RecursiveArrayIterator(
            array_combine(
                $classes,                                                       // class name as key
                array_fill(0, count($classes), $this->current()->getPathname()) // file path as value
            )
        );
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T08:59:19.690

我曾经做过类似的事情。[来源就在这里](http://amenthes.110mb.com/parser.phps)，我相信很容易理解。如果您有任何问题，请告诉我。

主要思想是扩展**SplFileInfo**然后使用**RecursiveIteratorIterator::setInfoClass($className);** 以获取有关源代码的信息。一个只解析 PHP 文件的过滤器可能会很好，尽管我当时决定在主循环中通过扩展来过滤它们。

# ubuntu - 如何在基于 Debian 的 Linux 上解决 Eclipse 中的 TPTP Monitor 错误 (IWAT0435E)？

> ID：575110
> 
> 赞同：6
> 
> 时间：2009-02-22T15:57:38.817
> 
> 标签：ubuntu, debian, eclipse-tptp

在 Eclipse Ganymede 中安装测试和性能工具平台后，每当我尝试分析 Java 应用程序时，都会遇到启动配置对话框，其中包含以下错误：

```
Error IWAT0435E could not connect to host 
```

这个问题是如何解决的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T15:59:29.127

经过一段时间的搜索，我在几个博客中找到了解决方案，非常感谢 [Pablo](http://goodenoughjava.blogspot.com/2008/10/profiling-with-eclipse-tptp-problem.html)和[Shimi](http://myjavanotebook.blogspot.com/2008/04/libstdc210-glibc22-on-ubuntu-hardy-804.html)。如果您有兴趣，这些包含更详细的背景。

该问题与被称为代理控制器的东西相关联到旧版本的 libstdc++。要解决它，您可以运行以下两个命令：

```
wget mirrors.kernel.org/ubuntu/pool/universe/g/gcc-2.95/libstdc++2.10-glibc2.2_2.95.4-24_i386.deb
sudo dpkg --install libstdc++2.10-glibc2.2_2.95.4-24_i386.deb 
```

尽管您的里程可能会因发行版等而异。

然后您应该能够在 Eclipse 中成功配置文件，我发现我什至不需要重新启动 Eclipse。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-22T22:40:41.207

如果您使用的是 Ubuntu 9.10 Karmic Koala 64 位，请使用以下内容

```
wget http://mirrors.kernel.org/ubuntu/pool/universe/g/gcc-3.3/libstdc++5_3.3.6-17ubuntu1_amd64.deb
sudo dpkg -i libstdc++5_3.3.6-17ubuntu1_amd64.deb 
```

启动日食和中提琴......你在做生意:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-03T14:33:02.103

只需从存储库安装“libstdc++5”包。无需费心手动获取 deb 文件。（我使用的是 Ubuntu 10.10 64 位）

例如，在终端中输入以下内容：

> sudo apt-get install libstdc++5

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-22T14:14:00.980

问题：您需要安装 libstdc++-libc6.2-2.so.3。在 openSUSE 安装包 "compat" 上解决这个问题。

# php - 从数据库进行编辑时，如何填充单选按钮或下拉框？

> ID：575116
> 
> 赞同：0
> 
> 时间：2009-02-22T15:59:50.060
> 
> 标签：php, database, drop-down-menu, radio-button, editing

我知道这是一个与已经问过的问题类似的问题，但我希望对一个问题有不同的答案。我有一个表格，您可以在其中将新文章上传到数据库中，所有作品都很棒，很棒，很棒。表单使用文章类型的下拉菜单，我的下拉框中有新闻、八卦、旅行、表演等。当您上传到数据库时，它只会添加选定的项目，比如说，在这种情况下，新闻。

我需要用户能够编辑他们的文章，所以我需要用所选项目填充下拉框。我认为在 BUM 中设置一个包含每个放置项和它们的 ID 的数据库表有点痛苦。是否可以将所选项目设置为数据库中的值，然后仅使用 if 语句或其他内容来填充下拉框的其余部分？

希望这是有道理的。我还认为使用单选按钮可能是一种解决方案，但是我无法使用数据库中的值设置所选按钮。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T16:05:01.827

你可以这样做：

```
// array of available options
$available = array('news'=>'News', 'gosip'=>'Gosip', 'travel'=>'Travel', 'performances'=>'Performance');
// selected option value
$selected = 'news';
echo '<select name="article-type">';
foreach ($available as $val => $label) {
    echo '<option value="'.htmlspecialchars($val).'"';
    if ($val == $selected) {
        echo ' selected="selected"';
    }
    echo '>'.htmlspecialchars($label).'</option>';
}
echo '</select>'; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T16:03:46.777

听起来您想将文章类型放在表格中或类似的东西中。

然后，您可以从表中加载下拉列表，并将对文章类型 ID 的引用存储在文章表中。

另外，它应该可以更快地检索给定类型的所有文章，因为您将在 ID 上进行查找。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T16:18:48.360

在我看来，这更像是一个数据库设计问题。您的基本设计似乎有缺陷。我试图从你的问题中推断出这个问题，所以如果我偏离了轨道，请耐心等待。

这是设计的相关部分，应该是 IMO：

**表：文章**

* * *

```
ArticleID
ArticleContent
ArticleSubject (FK from Subjects)
..
..
.. Other columns. 
```

**表：科目**

* * *

```
SubjectID
SubjectDescription
..
..
.. Other columns. 
```

请注意，我将第二个表称为 Subjects 以更好地说明我的含义。这样，每篇文章都有一个对文章类型（主题）的引用。现在，当您检索“文章类型”下拉列表的数据时，您只需检索第二个表中的所有行，然后根据当前选择（从第一个表中）设置所选项目。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T16:09:50.770

```
$options = array(,);
$selection = filter_input(INPUT_POST, 'what');
$blah = true; //i don't know what to name this.
foreach($options as $option) {
    echo '....';
    if(isset($blah) && $option === $selection) {
        echo 'selected="selected"';
        unset($blah);
    }
} 
```

这可能是最快的方法。此外，如果您追求速度，请确保利用[echo 的多个参数。](http://us.php.net/echo)

# python - 生成唯一的、有序的毕达哥拉斯三元组

> ID：575117
> 
> 赞同：31
> 
> 时间：2009-02-22T16:00:34.067
> 
> 标签：python, math

这是我编写的用于计算毕达哥拉斯三元组的程序。当我运行程序时，由于 if 语句，它会打印每组三元组两次。有什么办法可以告诉程序只打印一组新的三元组一次？谢谢。

```
import math

def main():
    for x in range (1, 1000):
        for y in range (1, 1000):
            for z in range(1, 1000):
                if x*x == y*y + z*z:
                    print y, z, x
                    print '-'*50

if __name__ == '__main__':
    main() 
```

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-02-23T03:00:32.220

毕达哥拉斯三元组是声称“**`for`循环被认为是有害**的”的一个很好的例子，因为`for`循环会引诱我们思考计数，这通常是任务中最不相关的部分。

（我将坚持使用伪代码以避免语言偏见，并保持伪代码流线型，我不会优化 eg`x * x`和的多次计算`y * y`。）

**版本 1**：

```
for x in 1..N {
    for y in 1..N {
        for z in 1..N {
            if x * x + y * y == z * z then {
                // use x, y, z
            }
        }
    }
} 
```

是最坏的解决方案。它生成重复项，并遍历无用的空间部分（例如，无论何时`z < y`）。它的时间复杂度是立方上的`N`。

**第 2 版**，第一个改进，来自要求`x < y < z`持有，如：

```
for x in 1..N {
    for y in x+1..N {
        for z in y+1..N {
            if x * x + y * y == z * z then {
                // use x, y, z
            }
        }
    }
} 
```

这减少了运行时间并消除了重复的解决方案。但是，它仍然是立方的`N`；改进只是降低了`N`-cubed 的系数。

继续检查`z`after`z * z < x * x + y * y`不再成立的增加值是没有意义的。这一事实激发了**第 3 版**，这是远离暴力迭代的第一步`z`：

```
for x in 1..N {
    for y in x+1..N {
        z = y + 1
        while z * z < x * x + y * y {
            z = z + 1
        }
        if z * z == x * x + y * y and z <= N then {
            // use x, y, z
        }
    }
} 
```

对于`N`1000，这比版本 2 快大约 5 倍，但它*仍然*是立方的`N`。

下一个见解是`x`和`y`是唯一的自变量；`z`取决于它们的值，`z`为 的前一个值考虑的最后一个值`y`是 的下一个值的良好*起始*搜索值`y`。这导致**版本 4**：

```
for x in 1..N {
    y = x+1
    z = y+1
    while z <= N {
        while z * z < x * x + y * y {
            z = z + 1
        }
        if z * z == x * x + y * y and z <= N then {
            // use x, y, z
        }
        y = y + 1
    }
} 
```

它只允许`y`并`z`“扫描”上述值`x`一次。它不仅比 1000 快 100 倍`N`以上，而且在 上是二次的`N`，因此加速比随着增长而`N`增加。

我经常遇到这种改进，以至于对除了最微不足道的用途（例如遍历数组）之外的任何用途（例如遍历数组）不信任“计数循环”。

**更新：**显然我应该指出一些容易被忽视的关于 V4 的事情。

1.  **两个**`while`循环都由 的值控制（`z`一个直接，另一个通过 的平方间接控制`z`）。内部`while`实际上正在加速外部`while`，而不是与之正交。*重要的是要看循环在做什么，而不仅仅是计算有多少循环。*

2.  V4 中的所有计算都是严格的整数运算。相比之下，与浮点的转换以及浮点计算的成本很高。

3.  V4 在常量内存中运行，只需要三个整数变量。没有要分配和初始化的数组或哈希表（并且可能会导致内存不足错误）。

4.  原始问题允许所有`x`、`y`和`x`在同一范围内变化。V1..V4 遵循这种模式。

下面是一组不太科学的时序（在我的旧笔记本电脑上的 Eclipse 下使用 Java 并运行其他东西......），其中“使用 x、y、z”是通过实例化具有三个值的 Triple 对象来实现的并将其放入 ArrayList 中。（对于这些运行，`N`设置为 10,000，在每种情况下产生 12,471 个三元组。）

```
Version 4:           46 sec.
using square root:  134 sec.
array and map:      400 sec. 
```

“数组和映射”算法*本质上是*：

```
squares = array of i*i for i in 1 .. N
roots = map of i*i -> i for i in 1 .. N
for x in 1 .. N
    for y in x+1 .. N
        z = roots[squares[x] + squares[y]]
        if z exists use x, y, z 
```

“使用平方根”算法*本质上是*：

```
for x in 1 .. N
    for y in x+1 .. N
        z = (int) sqrt(x * x + y * y)
        if z * z == x * x + y * y then use x, y, z 
```

V4 的实际代码是：

```
public Collection<Triple> byBetterWhileLoop() {
    Collection<Triple> result = new ArrayList<Triple>(limit);
    for (int x = 1; x < limit; ++x) {
        int xx = x * x;
        int y = x + 1;
        int z = y + 1;
        while (z <= limit) {
            int zz = xx + y * y;
            while (z * z < zz) {++z;}
            if (z * z == zz && z <= limit) {
                result.add(new Triple(x, y, z));
            }
            ++y;
        }
    }
    return result;
} 
```

请注意，这`x * x` *是*在外循环中计算的（虽然我没有费心去缓存`z * z`）；在其他变体中进行了类似的优化。

我很乐意根据要求为我计时的其他变体提供 Java 源代码，以防我错误地实现了任何东西。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2011-11-25T00:59:17.343

比迄今为止的任何解决方案都要快得多。通过三元树查找三元组。

> [沃尔夫拉姆](http://mathworld.wolfram.com/PythagoreanTriple.html)说：
> 
> Hall (1970) 和 Roberts (1977) 证明这是一个原始毕达哥拉斯三元组当且仅当
> 
> `(a,b,c)=(3,4,5)M`
> 
> 其中 M 是矩阵 U,A,D 的有限乘积。

我们有一个公式可以生成每个原始三元组。

在上面的公式中，斜边一直在增长，因此很容易检查最大长度。

在 Python 中：

```
import numpy as np

def gen_prim_pyth_trips(limit=None):
    u = np.mat(' 1  2  2; -2 -1 -2; 2 2 3')
    a = np.mat(' 1  2  2;  2  1  2; 2 2 3')
    d = np.mat('-1 -2 -2;  2  1  2; 2 2 3')
    uad = np.array([u, a, d])
    m = np.array([3, 4, 5])
    while m.size:
        m = m.reshape(-1, 3)
        if limit:
            m = m[m[:, 2] <= limit]
        yield from m
        m = np.dot(m, uad) 
```

如果您想要所有三元组而不仅仅是原语：

```
def gen_all_pyth_trips(limit):
    for prim in gen_prim_pyth_trips(limit):
        i = prim
        for _ in range(limit//prim[2]):
            yield i
            i = i + prim 
```

`list(gen_prim_pyth_trips(10**4))`用 2.81 毫秒返回 1593 个元素，而用`list(gen_all_pyth_trips(10**4))`19.8 毫秒返回 12471 个元素

作为参考，[接受的答案](https://stackoverflow.com/a/576405/992385) [（在 python 中）](https://gist.github.com/kgullion/6adc2d633038ff852923)对于 12471 个元素需要 38 秒。

只是为了好玩，将上限设置为 100 万`list(gen_all_pyth_trips(10**6))`在 2.66 秒内返回 1980642 个元素（3 秒内几乎 200 万个三元组）。`list(gen_all_pyth_trips(10**7))`随着列表变得如此之大以至于消耗了最后一点内存，我的电脑就瘫痪了。做类似的事情`sum(1 for _ in gen_all_pyth_trips(10**7))`可以绕过这个限制，并在 30 秒内返回 23471475 个元素。

有关所用算法的更多信息，请查看[Wolfram](http://mathworld.wolfram.com/PythagoreanTriple.html)和[Wikipedia](http://en.wikipedia.org/wiki/Tree_of_primitive_Pythagorean_triples)上的文章。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-22T16:09:18.743

您应该定义 x < y < z。

```
for x in range (1, 1000):
    for y in range (x + 1, 1000):
            for z in range(y + 1, 1000): 
```

另一个好的优化是只使用 x 和 y 并计算 zsqr = x * x + y * y。如果 zsqr 是平方数（或 z = sqrt(zsqr) 是整数），则它是三元组，否则不是。这样，您只需要两个循环而不是三个（对于您的示例，这大约快 1000 倍）。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-02-23T18:43:00.690

前面列出的生成[毕达哥拉斯三元组](http://en.wikipedia.org/wiki/Pythagorean_triplets)的算法都是从基本关系派生的朴素方法的修改，`a^2 + b^2 = c^2`其中`(a, b, c)`是正整数的三元组。事实证明，毕达哥拉斯三元组满足一些相当显着的关系，可用于生成所有毕达哥拉斯三元组。

[Euclid](http://en.wikipedia.org/wiki/Euclid)发现了第一个这样的关系。他确定对于每个毕达哥拉斯三元组`(a, b, c)`，可能在 和 的重新排序之后`a`，`b`有相对素数的正整数`m`和`n`，`m > n`其中至少有一个是偶数，并且有一个正整数`k`使得

```
a = k (2mn)
b = k (m^2 - n^2)
c = k (m^2 + n^2) 
```

然后生成毕达哥拉斯三元组，生成相对素数的正整数`m`和`n`不同的奇偶校验，以及一个正整数`k`并应用上述公式。

```
struct PythagoreanTriple {
    public int a { get; private set; }
    public int b { get; private set; }
    public int c { get; private set; }

    public PythagoreanTriple(int a, int b, int c) : this() {
        this.a = a < b ? a : b;
        this.b = b < a ? a : b;
        this.c = c;
    }

    public override string ToString() {
        return String.Format("a = {0}, b = {1}, c = {2}", a, b, c);
    }

    public static IEnumerable<PythagoreanTriple> GenerateTriples(int max) {
        var triples = new List<PythagoreanTriple>();
        for (int m = 1; m <= max / 2; m++) {
            for (int n = 1 + (m % 2); n < m; n += 2) {
                if (m.IsRelativelyPrimeTo(n)) {
                    for (int k = 1; k <= max / (m * m + n * n); k++) {
                        triples.Add(EuclidTriple(m, n, k));
                    }
                }
            }
        }

        return triples;
    }

    private static PythagoreanTriple EuclidTriple(int m, int n, int k) {
        int msquared = m * m;
        int nsquared = n * n;
        return new PythagoreanTriple(k * 2 * m * n, k * (msquared - nsquared), k * (msquared + nsquared));
    }
}

public static class IntegerExtensions {
    private static int GreatestCommonDivisor(int m, int n) {
        return (n == 0 ? m : GreatestCommonDivisor(n, m % n));
    }

    public static bool IsRelativelyPrimeTo(this int m, int n) {
        return GreatestCommonDivisor(m, n) == 1;
    }
}

class Program {
    static void Main(string[] args) {
        PythagoreanTriple.GenerateTriples(1000).ToList().ForEach(t => Console.WriteLine(t));            
    }
} 
```

[关于生成毕达哥拉斯三元组](http://en.wikipedia.org/wiki/Formulas_for_generating_Pythagorean_triples)的公式的 Wikipedia 文章包含其他此类公式。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-22T21:31:53.460

算法可以针对速度、内存使用、简单性和其他方面进行调整。

这是一种`pythagore_triplets`针对速度调整的算法，代价是内存使用和简单性。如果你想要的只是速度，这可能是要走的路。

在我的计算机上计算`list(pythagore_triplets(10000))`需要 40 秒，而 ΤZΩΤZΙΟΥ 的算法需要 63 秒，而 Tafkas 的算法（以及使用 3 个嵌入式循环而不是仅 2 个的所有其他算法）可能需要几天的计算时间。

```
def pythagore_triplets(n=1000):
   maxn=int(n*(2**0.5))+1 # max int whose square may be the sum of two squares
   squares=[x*x for x in xrange(maxn+1)] # calculate all the squares once
   reverse_squares=dict([(squares[i],i) for i in xrange(maxn+1)]) # x*x=>x
   for x in xrange(1,n):
     x2 = squares[x]
     for y in xrange(x,n+1):
       y2 = squares[y]
       z = reverse_squares.get(x2+y2)
       if z != None:
         yield x,y,z

>>> print list(pythagore_triplets(20))
[(3, 4, 5), (5, 12, 13), (6, 8, 10), (8, 15, 17), (9, 12, 15), (12, 16, 20)] 
```

请注意，如果您要计算前十亿个三元组，那么由于内存不足错误，该算法甚至会在它开始之前崩溃。所以ΤZΩΤZΙΟΥ的算法对于n的高值可能是更安全的选择。

顺便说一句，这是 Tafkas 的算法，为了我的性能测试而翻译成 python。它的缺点是需要 3 个循环而不是 2 个。

```
def gcd(a, b):
  while b != 0:
    t = b
    b = a%b
    a = t
  return a

def find_triple(upper_boundary=1000):
  for c in xrange(5,upper_boundary+1):
    for b in xrange(4,c):
      for a in xrange(3,b):
        if (a*a + b*b == c*c and gcd(a,b) == 1):
          yield a,b,c 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-22T20:32:06.630

```
def pyth_triplets(n=1000):
    "Version 1"
    for x in xrange(1, n):
        x2= x*x # time saver
        for y in xrange(x+1, n): # y > x
            z2= x2 + y*y
            zs= int(z2**.5)
            if zs*zs == z2:
                yield x, y, zs

>>> print list(pyth_triplets(20))
[(3, 4, 5), (5, 12, 13), (6, 8, 10), (8, 15, 17), (9, 12, 15), (12, 16, 20)] 
```

V.1 算法具有单调递增的`x`值。

### 编辑

看来这个问题仍然存在 :)
因为我回来并重新访问了代码，所以我尝试了第二种方法，它几乎是我之前建议的 4 倍（N=10000 时 CPU 时间的大约 26%），因为它避免了很多不必要的计算：

```
def pyth_triplets(n=1000):
    "Version 2"
    for z in xrange(5, n+1):
        z2= z*z # time saver
        x= x2= 1
        y= z - 1; y2= y*y
        while x < y:
            x2_y2= x2 + y2
            if x2_y2 == z2:
                yield x, y, z
                x+= 1; x2= x*x
                y-= 1; y2= y*y
            elif x2_y2 < z2:
                x+= 1; x2= x*x
            else:
                y-= 1; y2= y*y

>>> print list(pyth_triplets(20))
[(3, 4, 5), (6, 8, 10), (5, 12, 13), (9, 12, 15), (8, 15, 17), (12, 16, 20)] 
```

请注意，此算法具有递增的`z`值。

如果将算法转换为 C（其中，由于更接近金属，乘法比加法花费更多时间），则可以最小化必要的乘法，因为连续正方形之间的步长是：

> (x+1)² - x² = (x+1)(x+1) - x² = x² + 2x + 1 - x² = 2x + 1

所以所有的内部`x2= x*x`和`y2= y*y`都会被转换成这样的加法和减法：

```
def pyth_triplets(n=1000):
    "Version 3"
    for z in xrange(5, n+1):
        z2= z*z # time saver
        x= x2= 1; xstep= 3
        y= z - 1; y2= y*y; ystep= 2*y - 1
        while x < y:
            x2_y2= x2 + y2
            if x2_y2 == z2:
                yield x, y, z
                x+= 1; x2+= xstep; xstep+= 2
                y-= 1; y2-= ystep; ystep-= 2
            elif x2_y2 < z2:
                x+= 1; x2+= xstep; xstep+= 2
            else:
                y-= 1; y2-= ystep; ystep-= 2 
```

当然，与版本 2 相比，在 Python 中产生的额外字节码实际上*会减慢*算法的速度，但我敢打赌（不检查:) V.3 在 C 中更快。

祝大家好运:)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-12-14T15:33:32.260

我只是扩展了 Kyle Gullion 的答案，以便三元组按斜边排序，然后是最长边。

它不使用 numpy，但需要一个 SortedCollection（或 SortedList），例如[这个](http://code.activestate.com/recipes/577197-sortedcollection/)

```
def primitive_triples():
""" generates primitive Pythagorean triplets x<y<z
sorted by hypotenuse z, then longest side y
through Berggren's matrices and breadth first traversal of ternary tree
:see: https://en.wikipedia.org/wiki/Tree_of_primitive_Pythagorean_triples
"""
key=lambda x:(x[2],x[1])
triples=SortedCollection(key=key)
triples.insert([3,4,5])
A = [[ 1,-2, 2], [ 2,-1, 2], [ 2,-2, 3]]
B = [[ 1, 2, 2], [ 2, 1, 2], [ 2, 2, 3]]
C = [[-1, 2, 2], [-2, 1, 2], [-2, 2, 3]]

while triples:
    (a,b,c) = triples.pop(0)
    yield (a,b,c)

    # expand this triple to 3 new triples using Berggren's matrices
    for X in [A,B,C]:
        triple=[sum(x*y for (x,y) in zip([a,b,c],X[i])) for i in range(3)]
        if triple[0]>triple[1]: # ensure x<y<z
            triple[0],triple[1]=triple[1],triple[0]
        triples.insert(triple)

def triples():
""" generates all Pythagorean triplets triplets x<y<z 
sorted by hypotenuse z, then longest side y
"""
prim=[] #list of primitive triples up to now
key=lambda x:(x[2],x[1])
samez=SortedCollection(key=key) # temp triplets with same z
buffer=SortedCollection(key=key) # temp for triplets with smaller z
for pt in primitive_triples():
    z=pt[2]
    if samez and z!=samez[0][2]: #flush samez
        while samez:
            yield samez.pop(0)
    samez.insert(pt)
    #build buffer of smaller multiples of the primitives already found
    for i,pm in enumerate(prim):
        p,m=pm[0:2]
        while True:
            mz=m*p[2]
            if mz < z:
                buffer.insert(tuple(m*x for x in p))
            elif mz == z: 
                # we need another buffer because next pt might have
                # the same z as the previous one, but a smaller y than
                # a multiple of a previous pt ...
                samez.insert(tuple(m*x for x in p))
            else:
                break
            m+=1
        prim[i][1]=m #update multiplier for next loops
    while buffer: #flush buffer
        yield buffer.pop(0)
    prim.append([pt,2]) #add primitive to the list 
```

该代码在[我的 Python 库的](https://github.com/goulu/Goulib)[math2 模块](https://github.com/goulu/Goulib/blob/master/Goulib/math2.py)中可用。它针对某些系列的 OEIS（代码[在](https://github.com/goulu/Goulib/blob/master/examples/oeis.py)底部）进行了测试，这使我能够[在 A121727 中找到错误](https://oeis.org/draft/A121727):-)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-22T16:44:40.903

我用 Ruby 编写了那个程序，它类似于 python 实现。重要的一行是：

```
if x*x == y*y + z*z && gcd(y,z) == 1: 
```

然后你必须实现一个返回两个给定数字的最大公约数 (gcd) 的方法。又是一个非常简单的 Ruby 示例：

```
def gcd(a, b)
    while b != 0
      t = b
      b = a%b
      a = t
    end
    return a
end 
```

找到三元组的完整 Ruby 方法是：

```
def find_triple(upper_boundary)

  (5..upper_boundary).each {|c|
    (4..c-1).each {|b|
      (3..b-1).each {|a|
        if (a*a + b*b == c*c && gcd(a,b) == 1)
          puts "#{a} \t #{b} \t #{c}"
        end
      }
    }
  }
end 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-12-21T14:38:40.087

老问题，但我仍然会输入我的东西。有两种生成唯一毕达哥拉斯三元组的一般方法。一个是通过缩放，另一个是使用这个古老的公式。

什么缩放基本上需要一个常数n，然后乘以一个基本的三元组，比如说3,4,5乘以n。因此，将 n 设为 2，我们得到下一个三元组 6,8,10。

**缩放**

```
def pythagoreanScaled(n):
    triplelist = []
    for x in range(n):
        one = 3*x
        two = 4*x
        three = 5*x
        triple = (one,two,three)
        triplelist.append(triple)
return triplelist 
```

公式方法使用的事实是，如果我们取一个数 x，计算 2m、m^2+1 和 m^2-1，这三个将始终是一个毕达哥拉斯三元组。

**公式**

```
def pythagoreantriple(n):
    triplelist = []
    for x in range(2,n):
        double = x*2
        minus = x**2-1
        plus = x**2+1
        triple = (double,minus,plus)
        triplelist.append(triple)
    return triplelist 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-22T16:05:11.203

就在这里。

好的，现在你会想知道为什么。为什么不直接约束它以使 z > y？尝试

```
for z in range (y+1, 1000) 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-06-07T13:25:52.283

```
from  math import sqrt
from itertools import combinations

#Pythagorean triplet - a^2 + b^2 = c^2 for (a,b) <= (1999,1999)
def gen_pyth(n):
if n >= 2000 :
  return
ELEM =   [  [ i,j,i*i + j*j ] for i , j in list(combinations(range(1, n +   1 ), 2)) if sqrt(i*i + j*j).is_integer() ]
print (*ELEM , sep = "\n")

gen_pyth(200) 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-10-10T10:05:30.723

```
 for a in range(1,20):
    for b in range(1,20):
        for c in range(1,20):
            if a>b and c and c>b:
                if a**2==b**2+c**2:
                    print("triplets are:",a,b,c) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-03-03T09:34:20.173

在python中，我们可以将所有数字的平方存储在另一个列表中。然后找到给定平方的所有数字对的排列它们最后检查是否有任何对平方和与平方列表匹配

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-23T10:12:40.870

乔尔·尼利的第 5 版。

因为对于 1..N 的范围，X 可以是“N-2”的最大值，Y 可以是“N-1”的最大值。由于 Z max 是 N 并且 Y max 是 N-1，X 可以是 Sqrt 的最大值 ( N * N - (N-1) * (N-1) ) = Sqrt ( 2 * N - 1 ) 并且可以从 3 开始.

```
MaxX = ( 2 * N - 1 ) ** 0.5

for x in 3..MaxX {
  y = x+1
  z = y+1
  m = x*x + y*y
  k = z * z
  while z <= N {
     while k < m {
        z = z + 1
        k = k + (2*z) - 1
    }
    if k == m and z <= N then {
        // use x, y, z
    }
    y = y + 1
    m = m + (2 * y) - 1
  }
 } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-02-10T23:41:16.003

只是检查，但我一直在使用以下代码来制作毕达哥拉斯三元组。它非常快（我在这里尝试了一些示例，尽管我学习了它们并编写了自己的示例，然后回来检查了这里（2 年前））。我认为这段代码正确地找到了所有毕达哥拉斯三元组（命名你的极限）并且也相当快。我使用 C++ 来制作它。

ullong 是 unsigned long long 并且我创建了几个函数来求平方和求根可生根的。_square 和 _root 正如上面描述的那样，我知道另一种优化它的方法，但我还没有做过也没有测试过。

```
generate(vector<Triple>& triplist, ullong limit) {
cout<<"Please wait as triples are being generated."<<endl;
register ullong a, b, c;
register Triple trip;
time_t timer = time(0);

for(a = 1; a <= limit; ++a) {
    for(b = a + 1; b <= limit; ++b) {
        c = _root(_square(a) + _square(b));

        if(c != -1 && c <= limit) {
            trip.a = a; trip.b = b; trip.c = c;

            triplist.push_back(trip);

        } else if(c > limit)
            break;
    }
}

timer = time(0) - timer;
cout<<"Generated "<<triplist.size()<<" in "<<timer<<" seconds."<<endl;
cin.get();
cin.get(); 
```

}

让我知道你们的想法。它根据我上交的老师生成所有原始和非原始三元组。（如果我没记错的话，她最多测试了 100 个）。

此处以前的编码器提供的 v4 的结果是

下面是一组不太科学的时序（在我的旧笔记本电脑上的 Eclipse 下使用 Java 并运行其他东西......），其中“使用 x、y、z”是通过实例化具有三个值的 Triple 对象来实现的并将其放入 ArrayList 中。（对于这些运行，N 设置为 10,000，在每种情况下产生 12,471 个三元组。）

版本 4：46 秒。使用平方根：134 秒。数组和地图：400 秒。

我的结果是生成多少个三元组：10000

请稍候，正在生成三元组。在 2 秒内生成 12471。

那是在我开始通过编译器优化之前。（我记得以前使用大量特殊选项和东西将 10000 秒缩短到 0 秒）。我的代码还生成了所有三元组，以 100,000 作为 side1,2,hyp 可以在 3.2 分钟内达到多高的限制（我认为 1,000,000 限制需要一个小时）。

我稍微修改了代码，将 10,000 限制降低到 1 秒（没有优化）。最重要的是，经过仔细考虑，我的可以分解成块并在给定的范围内线程化（例如，100,000 分为 4 个相等的块，用于 3 个 cpu（1 个额外的希望消耗 cpu 时间以防万一），范围为 1 到 25,000 （从 1 开始并将其限制为 25,000）、25,000 到 50,000、50,000 到 75,000 和 75,000 到结束。我可以这样做，看看它是否可以加快速度（我将预先制作线程，但不包括在实际数量中执行三重函数的时间。我需要一个更精确的计时器和一种连接向量的方法。我认为如果 1 3.4 GHZ cpu 和 8 gb 内存可供使用，则可以在 1 秒内完成 10,000 作为 lim，然后是 3 cpu应该在 1/3 秒内完成（我和 atm 一样四舍五入到更高的秒数）。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-02-09T01:38:41.760

需要注意的是，对于 a、b 和 c，您不需要一直循环到 N。

对于 a，您只需从 1 循环到 `int(sqrt(n**2/2))+1`，对于 b，`a+1`到`int(sqrt(n**2-a**2))+1`，以及对于 c 从`int(sqrt(a**2+b**2)`到`int(sqrt(a**2+b**2)+2`。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-07-20T16:58:48.427

```
# To find all pythagorean triplets in a range
import math
n = int(input('Enter the upper range of limit'))
for i in range(n+1):
    for j in range(1, i):
        k = math.sqrt(i*i + j*j)
        if k % 1 == 0 and k in range(n+1):
            print(i,j,int(k)) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-08-02T14:53:47.797

你必须使用欧几里得对毕达哥拉斯三胞胎的证明。跟着下面...

你可以选择任何大于零的任意数字说`m,n`

根据欧几里得，三元组将是`a(m*m-n*n)`, `b(2*m*n)`,`c(m*m+n*n)`

现在应用这个公式找出三元组，假设我们的三元组的一个值为 6，那么其他两个？好的，让我们解决...

`a(m*m-n*n)`, `b(2*m*n)`,`c(m*m+n*n)`

可以肯定的`b(2*m*n)`是，显然是平的。所以现在

`(2*m*n)=6 =>(m*n)=3 =>m*n=3*1 =>m=3,n=1`

U 可以取任何其他值而不是 3 和 1，但是这两个值应该包含两个数字的乘积，即 3`(m*n=3)`

现在，何时`m=3`，`n=1`然后，

`a(m*m-n*n)=(3*3-1*1)=8`,`c(m*m-n*n)=(3*3+1*1)=10`

6,8,10 是我们的价值三元组，这是我们如何生成三元组的可视化。

如果给定的数字是奇数，`(9)`那么这里稍微修改一下，因为`b(2*m*n)`

永远不会奇怪。所以，在这里我们必须采取

`a(m*m-n*n)=7`, `(m+n)*(m-n)=7*1`, 所以, `(m+n)=7`,`(m-n)=1`

现在从这里找到 m 和 n，然后找到其他两个值。

如果你不明白，请仔细阅读一遍。

根据这个做代码，它将有效地生成不同的三元组。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-01-28T18:54:21.647

Hall/Roberts 方法的非 numpy 版本是

```
def pythag3(limit=None, all=False):
    """generate Pythagorean triples which are primitive (default)
    or without restriction (when ``all`` is True). The elements
    returned in the tuples are sorted with the smallest first.

    Examples
    ========

    >>> list(pythag3(20))
    [(3, 4, 5), (8, 15, 17), (5, 12, 13)]
    >>> list(pythag3(20, True))
    [(3, 4, 5), (6, 8, 10), (9, 12, 15), (12, 16, 20), (8, 15, 17), (5, 12, 13)]

    """
    if limit and limit < 5:
        return
    m = [(3,4,5)]  # primitives stored here
    while m:
        x, y, z = m.pop()
        if x > y:
            x, y = y, x
        yield (x, y, z)
        if all:
            a, b, c = x, y, z
            while 1:
                c += z
                if c > limit:
                    break
                a += x
                b += y
                yield a, b, c
        # new primitives
        a = x - 2*y + 2*z, 2*x - y + 2*z, 2*x - 2*y + 3*z
        b = x + 2*y + 2*z, 2*x + y + 2*z, 2*x + 2*y + 3*z
        c = -x + 2*y + 2*z, -2*x + y + 2*z, -2*x + 2*y + 3*z
        for d in (a, b, c):
            if d[2] <= limit:
                m.append(d) 
```

`10^6`它比 numpy 编码的版本慢，但在我的慢速机器上大约 1.4 秒内生成了最大元素小于或等于的原语。（而且该列表`m`从未超过 18 个元素。）

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-12-23T12:46:36.703

在 c 语言中 -

```
#include<stdio.h>
int main()
{
    int n;
    printf("How many triplets needed : \n");
    scanf("%d\n",&n);
    for(int i=1;i<=2000;i++)
    {
        for(int j=i;j<=2000;j++)
        {
            for(int k=j;k<=2000;k++)
            {
                if((j*j+i*i==k*k) && (n>0))
                {
                    printf("%d %d %d\n",i,j,k);
                    n=n-1;
                }
            }
        }
    }
} 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2018-09-04T18:15:57.653

你可以试试这个

```
 triplets=[]
    for a in range(1,100):
        for b in range(1,100):
            for c in range(1,100):
                if  a**2 + b**2==c**2:
                    i=[a,b,c]
                    triplets.append(i)
                    for i in triplets:
                          i.sort()
                          if triplets.count(i)>1:
                              triplets.remove(i)
    print(triplets) 
```

# jquery-ui - jQuery UI 将项目放入其他容器

> ID：575126
> 
> 赞同：0
> 
> 时间：2009-02-22T16:05:36.070
> 
> 标签：jquery-ui, drag-and-drop, jquery-ui-sortable

我寻找一种将`<li>`条目放入其他`<ul>`容器的好方法。线索是，当`<li>`元素被放入它的原点`<ul>`时，它应该恢复到它的原点。我不希望它们是可排序的。当它被放到另一个列表上时，它应该被添加到那个`<ul>`.

我正在使用带有“connectWith：”选项的可排序插件，但它不能按我想要的方式工作。

你有什么想法，它是如何工作的？或者 whitch 插件更适合这个想法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-22T17:43:01.450

您可能需要使用 li 上的 attrs 或[jquery .data()](http://docs.jquery.com/Core/data#namevalue)方法维护一些有关原始定位的元数据，然后在触发 drop 事件时“手动”使用列表：

```
$('.selector').droppable({
   drop: function(event, ui) { ... }
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T18:12:17.013

难道你不能只使用可拖放的实用程序而不是可排序的吗？

# design-patterns - 存储库模式中的事务

> ID：575136
> 
> 赞同：51
> 
> 时间：2009-02-22T16:10:35.667
> 
> 标签：design-patterns, domain-driven-design, repository-pattern, architectural-patterns

如何使用存储库模式以事务方式封装多个实体的保存？例如，如果我想添加一个订单并根据该订单创建更新客户状态，但只有在订单成功完成后才这样做？请记住，对于此示例，订单不是客户内部的集合。他们是他们自己的实体。

这只是一个人为的例子，所以我并不关心订单是否应该或不应该在客户对象内，甚至在同一个有界上下文中。我并不真正关心将使用什么底层技术（nHibernate、EF、ADO.Net、Linq 等）。我只想看看在这个公认的人为设计的全有或全无操作示例中某些调用代码可能是什么样子。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-23T11:51:36.997

今天早上启动我的电脑时，我遇到了我正在从事的项目的确切问题。我有一些想法导致了以下设计 - 并且评论会非常棒。不幸的是，Josh 建议的设计是不可能的，因为我必须使用远程 SQL 服务器并且无法启用它所依赖的 Distribute Transaction Coordinator 服务。

我的解决方案基于对现有代码的一些简单更改。

首先，我的所有存储库都实现了一个简单的标记接口：

```
/// <summary>
/// A base interface for all repositories to implement.
/// </summary>
public interface IRepository
{ } 
```

其次，我让所有启用事务的存储库实现以下接口：

```
/// <summary>
/// Provides methods to enable transaction support.
/// </summary>
public interface IHasTransactions : IRepository
{
    /// <summary>
    /// Initiates a transaction scope.
    /// </summary>
    void BeginTransaction();

    /// <summary>
    /// Executes the transaction.
    /// </summary>
    void CommitTransaction();
} 
```

这个想法是，在我所有的存储库中，我实现了这个接口并添加了直接根据实际提供者引入事务的代码（对于假存储库，我制作了一个在提交时执行的委托列表）。对于 LINQ to SQL，很容易实现，例如：

```
#region IHasTransactions Members

public void BeginTransaction()
{
    _db.Transaction = _db.Connection.BeginTransaction();
}

public void CommitTransaction()
{
    _db.Transaction.Commit();
}

#endregion 
```

这当然需要为每个线程创建一个新的存储库类，但这对我的项目来说是合理的。

使用存储库的每个方法都需要调用`BeginTransaction()`和`EndTransaction()`，如果存储库实现`IHasTransactions`. 为了让这个电话更容易，我想出了以下扩展：

```
/// <summary>
/// Extensions for spawning and subsequently executing a transaction.
/// </summary>
public static class TransactionExtensions
{
    /// <summary>
    /// Begins a transaction if the repository implements <see cref="IHasTransactions"/>.
    /// </summary>
    /// <param name="repository"></param>
    public static void BeginTransaction(this IRepository repository)
    {
        var transactionSupport = repository as IHasTransactions;
        if (transactionSupport != null)
        {
            transactionSupport.BeginTransaction();
        }
    }

    public static void CommitTransaction(this IRepository repository)
    {
        var transactionSupport = repository as IHasTransactions;
        if (transactionSupport != null)
        {
            transactionSupport.CommitTransaction();
        }
    }
} 
```

评论表示赞赏！

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-22T16:20:30.463

我会考虑使用某种类型的事务范围/上下文系统。因此，您可能拥有以下大致基于 .Net 和 C# 的代码。

```
public class OrderService
{

public void CreateNewOrder(Order order, Customer customer)
{
  //Set up our transactional boundary.
  using (TransactionScope ts=new TransactionScope())
  {
    IOrderRepository orderRepos=GetOrderRespository();
    orderRepos.SaveNew(order);
    customer.Status=CustomerStatus.OrderPlaced;

    ICustomerRepository customerRepository=GetCustomerRepository();
    customerRepository.Save(customer)
    ts.Commit();   
   }
}
} 
```

TransactionScope 可以嵌套，因此假设您有一个跨越多个服务的操作，您的应用程序也将创建一个 TransactionScope。现在在当前的 .net 中，如果您使用 TransactionScope，他们就有升级为 DTC 的风险，但这将在未来得到解决。

我们创建了自己的 TransactionScope 类，它基本上管理我们的数据库连接并使用本地 SQL 事务。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-22T18:14:30.877

> 如何使用存储库模式以事务方式封装多个实体的保存？例如，如果我想添加一个订单并根据该订单创建更新客户状态，但只有在订单成功完成后才这样做？请记住，对于此示例，订单不是客户内部的集合。他们是他们自己的实体。

它不是存储库的责任，它通常在更高级别完成。尽管您说您对特定技术不感兴趣，但我认为值得将解决方案捆绑起来，例如在将 NHibernate 与 Web 应用程序一起使用时，您可能会考虑使用[session-per request](http://www.hibernate.org/42.html)。

因此，如果您可以在更高级别管理交易，那么我的两个选择是：

1.  **预先检查**- 例如，在协调行为的服务中，通过询问订单/客户来决定您是否要继续，如果任何一方说他们不这样做，那么甚至不要尝试更新他们中的任何一个。
2.  **回滚**- 只需继续更新客户/订单，如果事情在回滚数据库事务中途失败。

如果您选择第二个选项，那么问题是内存中的对象会发生什么，您的客户可能会处于不一致的状态。如果这很重要，并且我在不为该请求加载对象的情况下工作，那么我会考虑预先检查是否可能，因为它比替代方案容易得多（回滚-内存更改或重新加载对象）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-22T16:36:16.183

使用 Spring.NET AOP + NHibernate，您可以正常编写存储库类并在自定义 XML 文件中配置事务：

```
public class CustomerService : ICustomerService
{
    private readonly ICustomerRepository _customerRepository;
    private readonly IOrderRepository _orderRepository;

    public CustomerService(
        ICustomerRepository customerRepository, 
        IOrderRepository orderRepository) 
    {
        _customerRepository = customerRepository;
        _orderRepository = orderRepository;
    }

    public int CreateOrder(Order o, Customer c) 
    {
        // Do something with _customerRepository and _orderRepository
    }
} 
```

在 XML 文件中，您选择要在事务中执行的方法：

```
 <object id="TxProxyConfigurationTemplate" 
          abstract="true"
          type="Spring.Transaction.Interceptor.TransactionProxyFactoryObject, Spring.Data">

    <property name="PlatformTransactionManager" ref="HibernateTransactionManager"/>

    <property name="TransactionAttributes">
      <name-values>
        <add key="Create*" value="PROPAGATION_REQUIRED"/>
      </name-values>
    </property>
  </object>

  <object id="customerService" parent="TxProxyConfigurationTemplate">
    <property name="Target">
      <object type="MyNamespace.CustomerService, HibernateTest">
          <constructor-arg name="customerRepository" ref="customerRepository" />
          <constructor-arg name="orderRepository" ref="orderRepository" />
      </object>
    </property>

  </object> 
```

在您的代码中，您将获得一个 CustomerService 类的实例，如下所示：

```
ICustomerService customerService = (ICustomerService)ContextRegistry
    .GetContent()
    .GetObject("customerService"); 
```

Spring.NET 将返回 CustomerService 类的代理，当您调用 CreateOrder 方法时，该代理将应用事务。这样，您的服务类中就没有特定于事务的代码。AOP 负责处理它。有关更多详细信息，您可以查看[Spring.NET](http://www.springframework.net/doc-latest/reference/html/orm.html#orm-hibernate)的文档。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-22T16:22:53.047

你想看看实现工作单元模式。NHibernate 有一些实现。一个是在 Rhino Commons 项目中，还有 Machine.UoW。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-06-01T17:08:51.833

您可以将事务参数添加到要在事务中运行的方法的末尾，并为其提供默认值 null。因此，如果您不想在现有事务中运行该方法，则不要使用 end 参数或显式传递 null。

在这些方法中，您可以检查参数是否为 null 以确定是创建新事务还是使用传入的事务。此逻辑可以推送到基类。

这使您的方法比使用基于上下文的解决方案更纯粹，尽管后者可能更适合通用库。但是，在独立应用程序中，您知道哪些方法需要在事务中链接起来，而且不会是所有方法。

```
void Update(int itemId, string text, IDbTransaction trans = null) =>
   RunInTransaction(ref trans, () =>
   {
      trans.Connection.Update("...");
   });

void RunInTransaction(ref IDbTransaction transaction, Action f)
{
    if (transaction == null)
    {
        using (var conn = DatabaseConnectionFactory.Create())
        {
            conn.Open();

            using (transaction = conn.BeginTransaction())
            {
                f();

                transaction.Commit();
            }
        }
    }
    else
    {
        f();
    }
}

Update(1, "Hello World!");
Update(1, "Hello World!", transaction); 
```

然后你可以为你的服务层有一个事务运行器......

```
public class TransactionRunner : ITransactionRunner
{
    readonly IDatabaseConnectionFactory databaseConnectionFactory;

    public TransactionRunner(IDatabaseConnectionFactory databaseConnectionFactory) =>
        this.databaseConnectionFactory = databaseConnectionFactory;

    public void RunInTransaction(Action<IDbTransaction> f)
    {
        using (var conn = databaseConnectionFactory.Create())
        {
            conn.Open();

            using (var transaction = conn.BeginTransaction())
            {
                f(transaction);

                transaction.Commit();
            }
        }
    }

    public async Task RunInTransactionAsync(Func<IDbTransaction, Task> f)
    {
        using (var conn = databaseConnectionFactory.Create())
        {
            conn.Open();

            using (var transaction = conn.BeginTransaction())
            {
                await f(transaction);

                transaction.Commit();
            }
        }
    }
} 
```

服务方法可能看起来像这样......

```
void MyServiceMethod(int itemId, string text1, string text2) =>
   transactionRunner.RunInTransaction(trans =>
   {
      repos.UpdateSomething(itemId, text1, trans);
      repos.UpdateSomethingElse(itemId, text2, trans);
   }); 
```

这很容易模拟单元测试......

```
public class MockTransactionRunner : ITransactionRunner
{
    public void RunInTransaction(Action<IDbTransaction> f) => f(null);
    public Task RunInTransactionAsync(Func<IDbTransaction, Task> f) => f(null);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-10-07T03:14:24.247

来自 Eric Evans，DDD Book，CH 6，存储库：

> 将事务控制权留给客户端。虽然 REPOSITORY 会插入和删除数据库，但它通常不会提交任何内容。例如，在保存后提交是很诱人的，但客户端可能具有正确启动和提交工作单元的上下文。如果 REPOSITORY 不动手，事务管理会更简单。

让更高层进行事务管理很好：

*   在处理两个或多个聚合根时，您必须确保两者处于一致状态。
*   当存储库操作出现错误时，客户端代码通常有更多的上下文来操作。
*   存储库始终专注于检索/更新特定实体的任务，通常是聚合根。

# .net - 在 .NET 中实现自定义 TraceListener

> ID：575139
> 
> 赞同：12
> 
> 时间：2009-02-22T16:13:50.010
> 
> 标签：.net, sql-server, logging

我正在寻找实现[TraceListener](http://msdn.microsoft.com/en-us/library/system.diagnostics.tracelistener.aspx)的最佳实践，它将从 ASP.NET 应用程序在 SQL 服务器中写入日志。

在实现此类时应考虑哪些事项以避免性能下降？

存储过程会比普通的 ADO.NET INSERT 语句更快吗？

我真的很喜欢将日志写入临时内存缓冲区并稍后从后台线程将其刷新到数据库的想法，但是哪种数据结构最适合这种情况？[Queue<T>](http://msdn.microsoft.com/en-us/library/7977ey2c.aspx)似乎是一个不错的选择，但如果没有一些同步机制，我无法向其中添加元素。

我在互联网上找到了[一篇文章](http://www.15seconds.com/Issue/020910.htm)，其中显示了一个写入 SQL 服务器的自定义 TraceListener 的示例，但在将其放入生产代码之前，我想获得更多反馈。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T05:46:02.367

**log4net**会将跟踪转储到带有一大堆刷新选项等的 sql db。检查它： http: [//logging.apache.org/log4net/release/features.html](http://logging.apache.org/log4net/release/features.html)

log4net 已被证明。如果您可以避免“重新编写轮子”，那很好，对吗？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T16:30:04.293

存储过程不会比参数化 SQL 更快。在我的应用程序中，我更喜欢存储过程而不是硬编码 SQL，但是如果您要生成插入语句，那就更好了。

如果您同意可能丢失数据的想法，那么使用缓冲区是一个好主意。如果您想将客户端与插入分离并且希望它持久，您可以使用 MSMQ。然后，您可以编写一个处理队列的 Windows 服务，并将其与应用程序完全分离。如果您有一个服务器场，它还可以聚合来自多个服务器的日志。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-24T11:55:55.000

我不能说 SP 是否比 ADO 插入更快，但我总是建议在您的应用程序中保留查询/非查询，而不是在数据存储中。就像你现在一样，数据存储是用于数据的，而不是逻辑的。避免SP。

MS SQL Server 是一台复杂的机器，我认为您的应用程序不会导致您的代码因过多的日志记录到您的数据库而阻塞。显然，这取决于您的特定实施以及您对性能的兴趣，我可能会假设您打算支持大容量。我说的是我认为您不需要内存中的队列或服务来包装日志记录过程。只需将跟踪刷新到您的 aspnet 应用程序中的数据库，然后忘记缓存/刷新。SQL 将负责将日志记录查询保存在内存中，并将其写入磁盘之后-实际上它管理得很好。SQL 的查询缓冲区将确保您的代码在刷新跟踪时不会阻塞。如果您不相信我，请在调试窗口中使用时间戳或其他内容对其进行测试。如果你确实需要调整它，调整应该在您的数据库的内存设置中。你不需要在这里发明一个包装器，使用 SP 或在你的服务器上启动另一个服务（如 MSMQ），这只会占用你更多宝贵的 CPU 和内存。

# user-interface - 为什么要输入两次密码？

> ID：575142
> 
> 赞同：1
> 
> 时间：2009-02-22T16:16:19.287
> 
> 标签：user-interface, usability

在注册用户部分的大多数网站上，他们希望您输入密码 2 次。这是为什么？为什么不只输入一个输入密码？为什么一定要“确认”呢。

你知道

```
用户名
密码
确认密码

提交

```

这件事一直在我脑海里...

希望有人能回答这个问题。

谢谢

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-22T16:17:50.347

是为了避免错别字。如果您必须输入两次密码，您可能会按照自己的意愿设置密码。他们希望避免让密码为“blaj”的人稍后因为错误地输入了“blaj”而不得不检索他们的密码。尤其如此，因为密码字段显示为星号 ( `*********`)，有时很难判断您是否输入了您认为自己输入的内容 - 人们可能会在没有意识到的情况下打错字。一些网站也会在必要时使用正确的电子邮件地址。

顺便说一句：我完全不知道为什么会提到 PHP，这与 PHP 无关，并且在各种网站中都有使用。:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T16:25:55.800

# asp.net-mvc - 如何绑定到 ASP.NET MVC 中的特定数组元素？

> ID：575151
> 
> 赞同：2
> 
> 时间：2009-02-22T16:22:08.463
> 
> 标签：asp.net-mvc, data-binding

我正在使用 ASP.NET MVC RC1 并尝试将文本框绑定到对象属性，如下所示：

```
<%= Html.TextBox("Comments.Contacts[0].ContactName") %> 
```

似乎它应该工作，因为这样做：

```
<%= ((MuralProject)ViewData.Model).Comments.Contacts[0].ContactName %> 
```

但是很可惜，文本框中的结果是一个空字符串。难道我做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T16:36:43.280

文本框扩展方法的第一个参数设置最终创建的输入元素的名称，并尝试根据该参数从 ViewData/Model（对于它使用 TypeDescriptors/反射的模型）获取条目。

它这样做的方法只是在点处拆分输入字符串，然后通过反射检查 ViewDataDictionary 中的特定键和模型，所以如果你给它它会尝试寻找 Contacts[0] 而不是 Contacts 并赢了不要拿走你的财产。

为了解决这个问题，您只需要提供对象的实际值，例如

```
Html.TextBox("Comments.Contacts[0].ContactName", 
             Model.Comments.Contacts[0].ContactName) 
```

如果您查看 MVC 源代码并查看 ViewDataDictionary 类，您可以自己看到这一点。

# ssh - cygwin ssh 没有腻子是吗？

> ID：575157
> 
> 赞同：9
> 
> 时间：2009-02-22T16:25:18.067
> 
> 标签：ssh, cygwin, putty, passphrase

我用腻子生成了一个没有密码的密钥。putty 工作正常，但现在我安装了 cygwin 并想使用 ssh 登录。出于某种原因，我被提示输入密码？为什么？腻子直接登录？我不想生成新密钥并惹恼网络管理员。这是 cygwin 中的样子： $ ssh -i Documents\ and\ Settings/xxxxx/My\ Documents/xxxxx\ putty\ keys/private\ key.ppk dev.xxxxxx.com Enter passphrase for key 'Documents and Settings/ xxxxx/My Documents/xxxxx putty keys/private key.ppk'：权限被拒绝（公钥）。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-22T16:38:01.840

Putty 对密钥文件使用自己的 .ppk 格式，而 Cygwin 的 ssh 可能无法正确读取它们。

解决方案：使用 puttygen.exe 将 .ppk 文件转换为 OpenSSH 密钥格式。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-22T18:27:29.893

您需要从 putty 网页[http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)获取“puttygen.exe”，以将您的密钥转换为 OpenSSH 格式。然后它应该可以工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T09:48:03.533

如果您可以使用 putty 登录，则无需“惹恼网络管理员”。只需使用 cygwin 生成一个新密钥，然后使用 putty 登录并将新的公钥放入 .ssh/authorized_keys 文件中。您现在应该可以使用 cygwin 的 ssh 登录。

编辑：

顺便说一句，“惹恼”任何管理员的可靠方法是使用未加密的密钥。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-04-02T05:13:00.883

您可以将 PuTTY 密钥导出为 OpenSSH 格式并将它们附加到您的 .ppk 文件中，使其成为 ssh-add 的有效密钥。

只需使用 PuTTYGen 导出私钥，然后将其添加到 .ppk 文件中，然后您应该可以 ssh-add 它。但请注意，当您使用 PuTTYGen 编辑 .ppk 本身时，它会覆盖该文件。

您还可以使用这样的脚本将 .ppk 文件添加到 SSH 代理中：

```
file=~/`basename $0`.tmp
trap "rm -v $file" EXIT
echo -n "Password: "
read -s pwd
echo $pwd | puttygen -P -q -O private-openssh $1 -o $file
ssh-add $file 
```

来源：[http ://bazaar.launchpad.net/~renatosilva/+junk/scripts/view/head:/ppk-add.sh](http://bazaar.launchpad.net/~renatosilva/+junk/scripts/view/head:/ppk-add.sh)

# vb6 - vb6 程序终止时卸载模块的原因

> ID：575158
> 
> 赞同：2
> 
> 时间：2009-02-22T16:25:24.977
> 
> 标签：vb6

结束 vb6 程序的正确方法是执行以下操作：

```
Dim frm As Form
   For Each frm In Forms 
       Unload frm
   Next frm
   end 
```

负责表单，什么负责内存中的模块？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-22T16:56:09.800

在 VB6 中无需显式卸载模块。当最后一个表单被卸载时，它们会自动卸载。该语言根本不支持对标准模块的引用，只支持对其中定义的（全局）函数和变量的引用。由于您无法引用该模块，因此您也无法卸载它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T16:30:14.450

不要使用`End`，你不需要（永远）。然后所有内存都会被正确释放。

即使使用`End`，也应该自动释放内存。有传言说，尽管引用计数，一些类实例被*遗忘*并且没有正确终止。因此，已将所有对象实例显式设置为最佳实践`Nothing`（尤其是但不限于在模块中分配的实例）。我从未见过任何确认这实际上是真的（尽管它可能仍然是！）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T21:53:42.777

如果“模块”是指静态 .BAS 模块（它们都是模块：表单、类、用户控件等），则不需要“卸载”它们，因为它们是*静态*的。

大多数其他模块类型都是动态加载的。在 Forms 的情况下，通常通过与 Form 类具有相同名称和类型的预先声明的全局引用变量（是的，Form 是一种类）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T20:23:18.383

请注意，如果您使用全局变量，那么您应该检查是否需要清理它们中的任何一个。如果是这样，您应该有一个模块的 CleanUp 方法，并在主窗体的卸载事件期间调用它。另一个问题有时是你如何卸载东西的顺序很重要。通过进行显式清理，您可以控制它。

在 VB6 中你应该很少使用 END。如果您有任何循环引用，当您再次启动该程序时，该程序将继续作为一个消耗资源的进程，从而导致各种奇怪的错误。使用 COM 对象很容易在不经意间设置一个循环链接的对象链。

End 作为 QuickBASIC 和 Visual BASIC 的早期版本的兼容性保留存在。直到 VB 4.X 引入了创建类的能力，它才开始引起重大问题。它在 5.X 中开始受到关注。

在此之前，在 VB 3.X 中实现这一点的唯一方法之一是让两个表单相互设置引用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-16T16:06:50.927

退出时卸载所有模块的方法解决了一个有趣的错误，即使用 API 调用 ExitProcess() 检索退出代码

# objective-c - Objective-C 使用#import 和继承

> ID：575160
> 
> 赞同：5
> 
> 时间：2009-02-22T16:25:56.503
> 
> 标签：objective-c, cocoa, cocoa-touch, c-preprocessor

我有一个名为“foo”的假设 UIViewController 类。foo 继承自 class bar 和 class bar #import 的“Class A”，这是 foo 广泛使用的一个类。问题是，当我在 foo 中使用类 A 的实例时，我没有收到任何编译器错误，但我确实收到了警告，例如，类 A 的实例不响应特定方法。我是否必须将#import ClassA.h 显式地添加到“foo”类中？即使类 foo 扩展了扩展栏，它已经导入了它？

希望这不会太令人困惑。让我知道是否需要清理任何东西。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-22T16:35:04.237

听起来你有一个循环依赖问题。为了解决它，是的，每个实施文件（`.m`）都需要`#import`正确的头文件。但是，如果您尝试将*头*文件`#import`彼此共享，则会遇到问题。

为了使用继承，你需要知道超类的大小，这意味着你需要`#import`它。但是，对于其他事情，例如作为指针的成员变量，或者作为参数或返回其他类型的方法，您实际上并不需要类定义，因此您可以使用**前向引用**来解决编译器错误。

```
// bar.h
@class A;  // forward declaration of class A -- do not to #import it here

@interface bar : UIViewController
{
    A *member;  // ok
}

- (A) method:(A)parameter;  // also ok
@end

// bar.m
#import "bar.h"
#import "A.h"

// can now use bar & A without any errors or warnings 
```

# python - 可移植的非关系数据库

> ID：575172
> 
> 赞同：2
> 
> 时间：2009-02-22T16:31:16.460
> 
> 标签：python, non-relational-database, portable-database

我想尝试/玩弄非关系数据库，最好的解决方案是：

*   便携，这意味着它不需要安装。理想情况下，只需将目录复制粘贴到某个地方就可以了。我不介意第一次使用时是否需要编辑一些配置文件或运行配置工具。
*   可从 python 访问
*   适用于Windows和Linux

你有什么可以推荐给我的？

本质上，我希望能够将这个系统安装在我几乎没有用户权限的共享 linux 服务器上。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-23T04:49:08.340

我建议您在考虑许可问题的情况下考虑[BerkelyDB](http://en.wikipedia.org/wiki/Berkeley_DB) **。**

我已经厌倦了人们在没有资格的情况下推荐 BerkleyDB - 你只能在 GPL 下分发 BDB 系统，或者 Oracle 的一些未知且不公开的许可费用。

对于“本地”在不被外部各方使用的地方玩耍，这可能是一个好主意。请注意，有一个许可证等着咬你。

这也提醒我们，在要求技术建议时说明 GPL 是否可接受是一个好主意。

从[我自己](https://stackoverflow.com/questions/525065/which-embedded-database-capable-of-100-million-records-has-the-best-c-api)关于可移植 C API 数据库的问题来看，虽然建议了一系列其他产品，但没有一个嵌入式产品具有 Python 绑定。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T03:01:27.567

[Metakit](http://www.equi4.com/metakit/)是一个有趣的非关系型嵌入式数据库，它支持 Python。

安装只需要复制一个共享库和 .py 文件。它适用于 Windows、Linux 和 Mac，并且是开源的（MIT 许可）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-22T16:35:08.947

[伯克利数据库](http://en.wikipedia.org/wiki/Berkeley_DB)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-22T16:43:43.903

如果您习惯于认为关系数据库必须像 PostgreSQL 或 MySQL 那样庞大而沉重，那么您会对 SQLite 感到惊喜。

它是关系型的，非常小，使用单个文件，具有 Python 绑定，不需要额外的权限，并且可以在 Linux、Windows 和许多其他平台上运行。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-22T16:41:53.627

你看过[CouchDB](http://couchdb.apache.org/)吗？它是非关系型的，可以相对轻松地迁移数据，并且它具有[couchdb-python](http://code.google.com/p/couchdb-python/)形式的 Python API 。不过，它确实有一些相当不寻常的依赖关系，[比如 Spidermonkey](http://www.mozilla.org/js/spidermonkey/)和[Erlang](http://erlang.org/)。

至于纯 python 解决方案，我不知道[PyDBLite](http://quentel.pierre.free.fr/PyDbLite/index.html)已经走了多远，但仍然值得一试。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-22T16:35:12.457

BerkeleyDB：（似乎有一个与 python 的 API 绑定：[http](http://www.jcea.es/programacion/pybsddb.htm) ://www.jcea.es/programacion/pybsddb.htm ）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-22T17:43:29.187

你看过[Zope 对象数据库](http://wiki.zope.org/ZODB/FrontPage)吗？

此外，[SQLAlchemy](http://www.sqlalchemy.org/)或[Django 的 ORM](http://docs.djangoproject.com/en/dev/)层使 SQLite 上的模式管理几乎透明。

* * *

**编辑**

[从http://www.sqlalchemy.org/docs/05/ormtutorial.html#define-and-create-a-table](http://www.sqlalchemy.org/docs/05/ormtutorial.html#define-and-create-a-table)开始， 了解如何创建 SQL 表以及它们如何映射到 Python 对象。

虽然您的问题含糊不清，但您的评论似乎表明您可能想先定义 Python 对象，让它们工作，然后通过 SQLAlchemy 将它们映射到关系模式对象。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T03:52:37.553

如果您只是从 Python 来来往往，您可能会考虑使用[Pickle](http://docs.python.org/library/pickle.html)来序列化对象。如果您想使用其他工具来访问相同的数据，那当然是行不通的。它内置在 python 中，所以你不应该有任何特权问题，但它不是一个真正的数据库，所以它可能不适合你的实验需要。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-03-25T02:28:12.683

在此处添加对 TinyDB 的引用，因为此页面显示在许多搜索的顶部。它是python中的可移植非关系数据库。它将 python dicts 存储到本地 json 文件中，并使它们可用于类似于 mongodb 的数据库操作。它还具有对 mongodb 命令的端口的扩展，不同之处在于您将在本地 json 文件上操作，而不是在另一个系统服务器上工作。

与目前选择的答案不同，它是在一个宽松的 MIT 开放许可证下。

## 链接：

*   [TinyDB 网站](https://tinydb.readthedocs.io)
*   [Github 上的 Tinydb](https://github.com/msiemens/tinydb)
*   [基本用法](https://tinydb.readthedocs.io/en/latest/getting-started.html#basic-usage)
*   [用法](https://tinydb.readthedocs.io/en/latest/usage.html)
*   [支持论坛](https://forum.m-siemens.de/)
*   [实现](https://github.com/msiemens/tinydb/wiki/Used-By)

# visual-studio - 您最喜欢在 Visual Studio 中调试程序的方式是什么？

> ID：575173
> 
> 赞同：4
> 
> 时间：2009-02-22T16:31:47.393
> 
> 标签：visual-studio, debugging

这几天我想出了一个大软件。

我必须在 Visual Studio 2008 中进行调试。

我采取的步骤是：

1.  使用调用堆栈窗口查找我认为可能有错误的代码块。

2.  使用Immediate windows调用一些局部函数，看看这个blocks中的数据结构是否正确。

3.  当我在第 2 步得到结果时，我必须去第 1 步再次使用 callstack 找到错误的来源。

您最喜欢在 Visual Studio 中调试大型或小型程序的方法是什么？

我不认为运行整个程序并观察所有相关的数据结构是调试的好方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T16:48:49.133

将断点放入可疑方法并使用**即时窗口**是我的方式。**我是即时窗口**的忠实粉丝。

**条件断点**也是我喜欢的另一种方式。特别是当我迭代一个集合以找到一个可疑的对象时。我给断点设置了一个条件，然后按 F5 得到它。

**Ctrl + Alt + Q**组合是**Quick Watch Window**分析对象的另一个很好的快捷方式。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T16:53:34.423

与使用即时窗口相比，我更喜欢单元测试，主要是因为这意味着我可以非常简单地一遍又一遍地运行代码（实际上是从构建脚本中）。

如果您使用即时窗口发现问题并在不添加任何测试的情况下对其进行修复，那么如果同样的问题再次出现，您将不会收到任何警告。通过单元测试，您有一个持续的伙伴来确保任何未来的更改都不会重新引入错误。

就我个人而言，我不喜欢单步执行代码——与单元测试相比，我发现它令人沮丧。很容易意外地跨过您想要跨入的东西等。有时这是必要的，但这通常表明您的代码太复杂了。我*特别*不喜欢调试整个应用程序，而不是在调试器中单步执行单元测试。它通常慢几个数量级。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T18:04:13.880

为了找到破坏变量值的代码，我为该变量创建了一个**数据断点。**每次变量的数据发生变化时，程序都会中断执行，要么通过正确的代码，要么通过杂散指针。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T17:07:24.000

当被介绍给大型应用程序时，我最喜欢的方式：
- 始终：端到端“阅读所有代码”（这是最有趣的）
- 为代码的中心部分添加书签。
- 在调试时重构和编写测试

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T18:47:34.587

在我看来，调试的重点是形成一个关于错误可能在哪里的理论。换句话说，在启动调试器之前尝试查看代码并考虑问题。

我问了一个[类似的问题](https://stackoverflow.com/questions/366453/best-practices-for-debugging)，所以你可能也想检查一下答案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T16:42:02.237

我在 VS200x 调试中的 AHA 时刻之一是意识到我可以使用“附加到进程...”来开始调试已经运行的可执行文件。对于大型解决方案，与按 F5 启动调试会话相比，以“正常”方式启动应用程序然后将 Visual Studio 附加到它通常更快。

# delphi - Delphi 中的 BiDi 文本 - 你如何选择像这张图片这样按语言编辑的文本？

> ID：575175
> 
> 赞同：1
> 
> 时间：2009-02-22T16:32:02.370
> 
> 标签：delphi

我看到了这张照片，现在想知道你是否/如何在 Delphi 中做到这一点。突出显示/选定的文本显示两种格式的格式，即突出显示颜色和哈希线。

[http://img9.imageshack.us/img9/4121/easilyselecttextofonela.jpg](http://img9.imageshack.us/img9/4121/easilyselecttextofonela.jpg)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T15:10:13.510

我最近在[圣经应用程序](http://www.mybible.de)中做了一些非常相似的事情，也是在 Delphi 中完成的。

用户可以选择单个经文和所选经文的单个单词。（但是这个功能还没有发布，所以不要费心去寻找它）

我使用了 Microsoft 的 Web 浏览器控件并添加了我自己的选择处理。

我通过用`span`元素包围相关部分并更改它们的 CSS 样式来完成格式化。删除选择后，我还删除了封闭元素。

困难的部分是使用选择数据结构支持“可视”选择并处理所有选择事件（单击、shift-clicking、shift-ctrl-clicking...）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T12:25:01.070

[正如DR 所说](https://stackoverflow.com/questions/575175/bidi-text-in-delphi-how-do-you-select-text-to-edit-by-language-like-this-pic/577930#577930)，嵌入 IE 似乎是一种更简单的方法，但您也可以通过在画布上全部绘制来手动执行此操作，一种简单的方法是创建两个位图（一个没有选择，另一个选择（可能是尽可能复杂 - 虚线、彩色、...))，并且您需要知道所有字符的位置/矩形，这对于长文本来说有些困难。

您基本上显示未选择的位图，并通过第二张图像的部分重叠选定的部分。

您还需要通过 OnMouseDown、OnMouseMove、OnMouseUp 手动处理选择...

# macos - 如何在 Emacs 中拥有类似 Vim 的标签列表？

> ID：575177
> 
> 赞同：4
> 
> 时间：2009-02-22T16:33:02.167
> 
> 标签：macos, emacs, aquamacs, taglist

我使用 AquaEmacs。

我希望 Emacs 具有关于文档中项目的垂直层次结构（在左侧），类似于 Vim 的插件 Taglist。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T16:33:33.367

`M-x speedbar`.

[http://cedet.sourceforge.net/speedbar.shtml](http://cedet.sourceforge.net/speedbar.shtml)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-06-24T13:09:11.390

有一篇关于这个主题的新博客文章我认为非常有用。

[http://frankpzh.wordpress.com/category/emacs/](http://frankpzh.wordpress.com/category/emacs/)

重量很轻，工作无痛。到目前为止，它似乎不适用于 C 和 C++ 以外的任何东西，但这可能是我自己的错误。

古罗马

# perl - 如何在 Perl 中格式化日期？

> ID：575188
> 
> 赞同：6
> 
> 时间：2009-02-22T16:37:26.070
> 
> 标签：perl, date, templates

我正在修改 Xcode 中预先存在的脚本来自定义我的文件头。脚本是 Perl，它不是我最好的语言。:)

我只需要将当前日期以 dd/mm/yy 格式插入标题中。

这是我的脚本：

```
#! /usr/bin/perl -w
# Insert HeaderDoc comment for a header
#
# Inserts a template HeaderDoc comment for the header.
use strict;

# get path to document
my $headerPath = <<'HEADERPATH';
%%%{PBXFilePath}%%%
HEADERPATH
chomp $headerPath;
my $rootFileName = &rootFileNameFromPath($headerPath);

print "/*";
print " * $rootFileName\n";
print " * Project\n";
print " *\n";
print " * Created by Me on ";
# in bash it would be something like that :
# date +%d/%m/%y | awk '{printf "%s\n", $1}';
print " * Copyright 2009 My_companie. All rights reserved.\n";
print " *\n";
print " */\n";

sub rootFileNameFromPath {
    my $path = shift;

    my @pathParts = split (m'/', $path);
    my $filename = pop (@pathParts);
    my $rootFileName = "$filename";
    $rootFileName =~ s/\.h$//;
    return $rootFileName;
}

exit 0; 
```

我刚刚修改了打印命令，所以不要问我其余的代码:)

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-22T17:37:59.327

与其删除`strict`(!)，不如让代码变得`strict`干净？

```
my ($mday, $mon, $year) = (localtime(time))[3, 4, 5];

$mon  += 1;
$year += 1900;

printf "%02d/%02d/%02d\n", $mday, $mon, $year % 100; 
```

也许会更好（因为对于 Bash 问题的人来说看起来更熟悉）：

```
# At the top, under use strict;
use POSIX qw/strftime/;

# then later...
my $date = strftime "%d/%m/%y", localtime;
print "$date\n"; 
```

有趣的巧合：[Perl Training Australia](http://perltraining.com.au/)发布了半定期的[技巧（您可以通过电子邮件或在线获得它们），就](http://perltraining.com.au/tips/)[在](http://perltraining.com.au/tips/2009-02-26.html)今天在`strftime`.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-23T20:03:37.220

您还可以使用[DateTime](http://search.cpan.org/dist/DateTime)和相关模块，对于像这样的小脚本来说，这当然是完全矫枉过正的。但是对于一个更大的应用程序，您应该使用可靠的模块，而不是长时间地做所有事情。作为记录，您可以使用 DateTime 编写：

```
DateTime->today()->strftime('%d/%m/%y'); 
```

或者您可以使用更现代的 CLDR 格式语言：

```
DateTime->today->format_cldr('dd/MM/YYYY'); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-22T16:44:57.473

```
@time = localtime(time);
$mday = $time[3];
$mon = $time[4]+1;
$year = $time[5]+1900;
print "$mday/$mon/$year\n"; 
```

应该这样做。

编辑：

```
printf "%02d/%02d/%4d",$mday,$mon+1,$year+1900"; 
```

也会用零处理填充。

# entity-framework - 实体框架是否有内存提供程序？

> ID：575190
> 
> 赞同：39
> 
> 时间：2009-02-22T16:39:02.213
> 
> 标签：entity-framework, rhino-mocks

我是针对 ADO .NET Entity Framework 编写的单元测试代码。我想用行填充内存数据库，并确保我的代码正确检索它们。

我可以使用 Rhino Mocks 模拟实体框架，但这还不够。我会告诉查询返回给我的实体。这既不会测试 where 子句也不会测试 .Include() 语句。我想确保我的 where 子句只匹配我想要的行，而不匹配其他行。我想确定我已经要求了我需要的实体，而没有我不需要的实体。

例如：

```
class CustomerService
{
    ObjectQuery<Customer> _customerSource;
    public CustomerService(ObjectQuery<Customer> customerSource)
    {
        _customerSource = customerSource;
    }
    public Customer GetCustomerById(int customerId)
    {
        var customers = from c in _customerSource.Include("Order")
            where c.CustomerID == customerId
            select c;
        return customers.FirstOrDefault();
    }
} 
```

如果我模拟 ObjectQuery 以返回填充了订单的已知客户，我怎么知道 CustomerService 具有正确的 where 子句和 Include？我宁愿插入一些客户行和一些订单行，然后断言选择了正确的客户并填充了订单。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2015-04-30T19:20:37.553

**EF7**（预发行版）中包含一个 InMemory 提供程序。

您可以使用[NuGet 包](http://www.nuget.org/packages/EntityFramework.InMemory)，也可以在 GitHub 上的[EF 存储库](https://github.com/aspnet/EntityFramework/wiki/Using-EF7-in-Traditional-.NET-Applications#install-entity-framework-and-providers)中阅读它（[查看源代码](https://github.com/aspnet/EntityFramework/tree/dev/src/EntityFramework.InMemory)）。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-12-29T06:34:23.857

文章 [http://www.codeproject.com/Articles/460175/Two-strategies-for-testing-Entity-Framework-Effort](http://www.codeproject.com/Articles/460175/Two-strategies-for-testing-Entity-Framework-Effort)  描述 了在内存中运行的[Effort](http://entityframework-effort.net/)   -Entity Framework 提供程序。

您仍然可以在单元测试中使用 DbContext 或 ObjectContext 类，而无需拥有实际的数据库。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-22T18:54:53.463

这里更好的方法可能是使用存储库模式来封装您的 EF 代码。在测试你的服务时，你可以使用 mocks 或 fakes。在测试存储库时，您需要访问真实数据库以确保获得预期的结果。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-05-16T00:16:58.457

当前没有 EF 的内存提供程序，但如果您查看 Highway.Data，它有一个基本抽象接口和一个 InMemoryDataContext。

[使用 Highway.Data 测试数据访问和 EF](http://hwyfwk.com/blog/2013/10/15/testable-data-access-at-every-level/)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-22T18:36:56.737

是的，至少有一个这样的提供程序 - [SQLite](http://sqlite.phxsoftware.com/)。我已经使用了一点，它的工作原理。您也可以尝试[SQL Server Compact](http://www.microsoft.com/Sqlserver/2005/en/us/compact.aspx)。它是一个嵌入式数据库，也有 EF 提供程序。
编辑：
SQLite 支持内存数据库（[link1](http://www.sqlite.org/capi3ref.html#sqlite3_open)）。您只需要指定一个连接字符串，例如：“Data Source=:memory:;Version=3;New=True;”。如果您需要一个示例，您可以查看[SharpArchitecture](http://code.google.com/p/sharp-architecture/)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-22T16:53:44.800

我不熟悉 Entity Framework 和 ObjectQuery 类，但如果 Include 方法是虚拟的，您可以像这样模拟它：

```
// Arrange
var customerSourceStub = MockRepository.GenerateStub<ObjectQuery<Customer>>();
var customers = new Customer[] 
{
    // Populate your customers as if they were coming from DB
};
customerSourceStub
    .Stub(x => x.Include("Order"))
    .Return(customers);
var sut = new CustomerService(customerSourceStub);

// Act
var actual = sut.GetCustomerById(5);

// Assert
Assert.IsNotNull(actual);
Assert.AreEqual(5, actual.Id); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-23T08:31:14.280

您可以尝试[SQL Server Compact](http://technet.microsoft.com/en-us/library/cc835494.aspx)，但它有一些非常严重的限制：

*   与实体框架一起使用时，SQL Server Compact 不支持分页查询中的 SKIP 表达式
*   SQL Server Compact 在与实体框架一起使用时不支持具有服务器生成的键或值的实体
*   没有外部连接、整理、对浮点数、聚合取模

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-01-25T12:07:49.003

在[EF Core](https://docs.microsoft.com/en-us/ef/core/miscellaneous/testing/)中，执行此操作有两个主要选项：

1.  [SQLite 内存模式](https://docs.microsoft.com/en-us/ef/core/miscellaneous/testing/sqlite)允许您针对行为类似于关系数据库的提供程序编写有效的测试。
2.  [InMemory 提供程序](https://docs.microsoft.com/en-us/ef/core/miscellaneous/testing/in-memory)是一个轻量级提供程序，具有最小的依赖关系，但并不总是像关系数据库一样运行

我正在使用 SQLite，它支持所有查询，我需要使用 Azure SQL 生产数据库。

# javascript - Javascript OO 问题

> ID：575191
> 
> 赞同：0
> 
> 时间：2009-02-22T16:39:59.340
> 
> 标签：javascript, language-agnostic, oop

所以我想在javascript中构建一个表单验证类/对象。我看到它的工作方式是这样的：

```
var form=new Validation(); 
form.addField("name","Your name","required");
form.addField("email","Email Address","is_email");
.........
form.validate(); 
```

我在想这个`validation`类会被定义成这样吗？

```
validation
{
  var fields=new Array();
  var labels=new Array();
  var rules=new Array();
  var count=0;

  function addField(field,label,rule)
  {
    this.fields[count]=field;
    this.labels[count]=label;
    this.rules[count]=rule;
    this.count=count+1;
  }

  function validate()
  {
    var valid;
    for (x=0; x< count; x++)
    {
      valid=false;
      switch (this.rules[x])
      {
         case 'required':
           valid=this.validate_required(this.fields[x]);
           break;

         case 'email':
           valid=this.validate_email(this.fields[x]);
           break;
       }

       if (! valid)
         this.addError(this.fields[x],this.rules[x],this.labels[x]);
     }

     if (this.hasErrors())
       return false;  
     else
       return true;
   }

..........
} 
```

我知道这可能是不可能的，因为它现在是。我的问题是，我该怎么做才能使第一个代码块（它创建一个新实例`Validation`并向其中添加规则）可以工作？

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T16:46:54.627

您只是缺少一些 OO 符号。标有`"// ***"`注释的行是我从您的原始代码示例中更改的行：

```
function Validation() // ***
{
  var fields=new Array();
  var labels=new Array();
  var rules=new Array();
  var count=0;

  this.addField = function (field,label,rule) // ***
  {
    fields[count]=field; // ***
    labels[count]=label; // ***
    rules[count]=rule;   // ***
    count=count+1;
  }

  this.validate = function () // ***
  {
    var valid;
    for (x=0; x< count; x++)
    {
      valid=false;
      switch (rules[x]) // ***
      {
         case 'required':
           valid=this.validate_required(fields[x]); // ***
           break;

         case 'email':
           valid=this.validate_email(fields[x]); // ***
           break;
       }

       if (! valid)
         this.addError(fields[x],rules[x],labels[x]); // ***
     }

     if (this.hasErrors())
       return false;  
     else
       return true;
   }
} 
```

哦，我没看到`validate_required()`，，`validate_email()`也`addError()`没有`hasErrors()`。可能想添加这些。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T16:54:45.780

Javascript是[基于原型的](http://en.wikipedia.org/wiki/Prototype-based_programming)编程语言。所以没有真正的方法来拥有类。创建类（或模拟它）的方式是使用具有状态的函数和包含行为的更多函数。

为了解决您的问题，您可以使用全局级别函数创建验证类，并为您拥有的每个表单使用新关键字实例化它。

所以实际上你只需要让你的类定义成为一个函数。（**约定**：大写 V 只是用作表示这个函数是一个类的符号）

```
function Validation()
{
  var fields=new Array();
  var rules=new Array();
  var labels=new Array();
  var errors=new Array();
  var count=0;

  function addError(field,rule,label){
    //add error in errors array
  }

  function validate_required(field){
    //do required validation 
  }

  function validate_email(field){
    //do email validation
  }

  return function(){

      addField = function(f,r,l){
        this.fields[count]=f;
        this.rules[count]=r;
        this.labels[count]=l;
        this.count=count+1;
      }

      validate = function ()
      {
        var valid;
        for (x=0; x< count; x++)
        {
          valid=false;
          switch (this.rules[x])
          {
             case 'required':
               valid=validate_required(this.fields[x]);// create private function
               break;

             case 'email':
               valid=validate_email(this.fields[x]);// create private function
               break;
           }

           if (! valid)
             addError(this.fields[x],this.rules[x],this.labels[x]);
         }

         if (this.hasErrors())
           return false;  
         else
           return true;
       }
   }
} 
```

要了解更多关于 JavaScript 及其特性（和麻烦）的信息，您可以浏览[Douglas Crockford 的主页](http://www.crockford.com/)。它有许多易于理解的 JavaScript 参考资料，尤其是与原型和继承相关的参考资料。

# python - 为什么函数可以修改调用者感知的某些参数，而不能修改其他参数？

> ID：575196
> 
> 赞同：228
> 
> 时间：2009-02-22T16:42:51.457
> 
> 标签：python

我试图了解 Python 的变量范围方法。在这个例子中，为什么`f()`能够改变 的值`x`，如在 内所感知的那样`main()`，但不能改变 的值`n`？

```
def f(n, x):
    n = 2
    x.append(4)
    print('In f():', n, x)

def main():
    n = 1
    x = [0,1,2,3]
    print('Before:', n, x)
    f(n, x)
    print('After: ', n, x)

main() 
```

输出：

```
Before: 1 [0, 1, 2, 3]
In f(): 2 [0, 1, 2, 3, 4]
After:  1 [0, 1, 2, 3, 4] 
```

* * *

## 回答 #1

> 赞同：263
> 
> 时间：2009-02-22T18:06:13.797

一些答案在函数调用的上下文中包含“复制”一词。我觉得很混乱。

**Python 不会复制您在函数调用期间传递*的**对象*。**

 *函数参数是*名称*。当您调用函数时，Python 会将这些参数绑定到您传递的任何对象（通过调用者范围内的名称）。

对象可以是可变的（如列表）或不可变的（如 Python 中的整数、字符串）。您可以更改的可变对象。您不能更改名称，只能将其绑定到另一个对象。

您的示例与[范围或名称空间](https://docs.python.org/2/tutorial/classes.html#python-scopes-and-namespaces)无关，而是关于Python 中对象的[命名、绑定](http://docs.python.org/reference/executionmodel.html#naming-and-binding)和[可变性。](http://docs.python.org/reference/datamodel.html#objects-values-and-types)

```
def f(n, x): # these `n`, `x` have nothing to do with `n` and `x` from main()
    n = 2    # put `n` label on `2` balloon
    x.append(4) # call `append` method of whatever object `x` is referring to.
    print('In f():', n, x)
    x = []   # put `x` label on `[]` ballon
    # x = [] has no effect on the original list that is passed into the function 
```

[这是关于其他语言中的变量和 Python 中的名称之间差异](https://web.archive.org/web/20180121150727/http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html#other-languages-have-variables)的漂亮图片。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-02-22T21:52:14.550

你已经得到了很多答案，我大致同意 JF Sebastian 的观点，但你可能会发现这作为一种捷径很有用：

任何时候你看到**`varname =`**，你都在函数的范围内创建一个*新的名称绑定。*`varname`之前绑定的任何值都将*在此范围内*丢失。

任何时候你看到**`varname.foo()`**你在调用一个方法`varname`。该方法可能会改变 varname（例如`list.append`）。 `varname`（或者，更确切地说，`varname`命名的对象）可能存在于多个范围内，并且由于它是同一个对象，因此任何更改都将在所有范围内可见。

[请注意，`global`关键字创建第一种情况的例外]

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-02-22T16:47:13.597

`f`实际上并没有改变的值`x`（它始终是对列表实例的相同引用）。相反，它会更改此列表的*内容*。

在这两种情况下，*引用的副本*都会传递给函数。在函数内部，

*   `n`被分配一个新值。只修改函数内部的引用，而不修改函数外部的引用。
*   `x`没有被赋予新值：函数内部和外部的引用都没有被修改。相反，`x`' 的*值*被修改。

由于`x`函数内部和函数外部都引用相同的值，因此都可以看到修改。相比之下，`n`函数内部和外部在函数内部重新分配后引用*不同*的值`n`。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-22T17:15:36.837

我将重命名变量以减少混淆。 *n* -> *nf*或*nmain*。 *x* -> *xf*或*xmain*：

```
def f(nf, xf):
    nf = 2
    xf.append(4)
    print 'In f():', nf, xf

def main():
    nmain = 1
    xmain = [0,1,2,3]
    print 'Before:', nmain, xmain
    f(nmain, xmain)
    print 'After: ', nmain, xmain

main() 
```

当您调用函数*f*时，Python 运行时会创建*xmain*的副本并将其分配给*xf*，并且类似地将 *nmain*的副本分配给*nf*。

在*n*的情况下，复制的值为 1。

在*x*的情况下，复制的值**不是**文字列表*[0, 1, 2, 3]*。它是对该列表 的**引用。***xf*和*xmain*指向同一个列表，因此当您修改*xf*时，您也在修改*xmain*。

但是，如果您要编写如下内容：

```
 xf = ["foo", "bar"]
    xf.append(4) 
```

你会发现*xmain*并没有改变。这是因为，在*xf = ["foo", "bar"]*行中，您已将*xf*更改为指向一个**新**列表。您对此新列表所做的任何更改都不会影响*xmain*仍指向的列表。

希望有帮助。:-)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2017-12-30T18:00:38.533

如果用完全不同的变量重写函数并且我们在它们上调用[id](https://docs.python.org/3/library/functions.html#id)，那么它很好地说明了这一点。一开始我没有明白这一点，并阅读了 jfs 的帖子并给出了[很好的解释](http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html#other-languages-have-variables)，所以我试图理解/说服自己：

```
def f(y, z):
    y = 2
    z.append(4)
    print ('In f():             ', id(y), id(z))

def main():
    n = 1
    x = [0,1,2,3]
    print ('Before in main:', n, x,id(n),id(x))
    f(n, x)
    print ('After in main:', n, x,id(n),id(x))

main()
Before in main: 1 [0, 1, 2, 3]   94635800628352 139808499830024
In f():                          94635800628384 139808499830024
After in main: 1 [0, 1, 2, 3, 4] 94635800628352 139808499830024 
```

z 和 x 具有相同的 id。正如文章所说，相同的底层结构只是不同的标签。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-22T17:07:59.740

n 是一个 int （不可变），并且副本被传递给函数，因此在函数中您正在更改副本。

*X 是一个列表（可变），并且指针*的副本传递给函数，因此 x.append(4) 更改列表的内容。但是，您在函数中说 x = [0,1,2,3,4]，您不会更改 main() 中 x 的内容。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-10-21T17:40:17.447

我的一般理解是任何对象变量（例如列表或字典等）都可以通过其函数进行修改。我相信您无法做的是重新分配参数 - 即，在可调用函数中通过引用分配它。

这与许多其他语言一致。

运行以下简短脚本以查看其工作原理：

```
def func1(x, l1):
    x = 5
    l1.append("nonsense")

y = 10
list1 = ["meaning"]
func1(y, list1)
print(y)
print(list1) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-22T17:06:01.367

这是因为列表是一个可变对象。您没有将 x 设置为 [0,1,2,3] 的值，而是为对象 [0,1,2,3] 定义了一个标签。

你应该像这样声明你的函数 f() ：

```
def f(n, x=None):
    if x is None:
        x = []
    ... 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-12-04T14:48:00.270

如果你以正确的方式思考 Python，它是一种纯粹的按值传递语言。python 变量存储对象在内存中的位置。Python 变量不存储对象本身。当您将变量传递给函数时，您传递的是该变量指向的对象地址的 *副本。*

对比这两个函数

```
def foo(x):
    x[0] = 5

def goo(x):
    x = [] 
```

现在，当你在 shell 中输入

```
>>> cow = [3,4,5]
>>> foo(cow)
>>> cow
[5,4,5] 
```

将此与goo进行比较。

```
>>> cow = [3,4,5]
>>> goo(cow)
>>> goo
[3,4,5] 
```

在第一种情况下，我们将 cow 的地址的副本传递给 foo 并且 foo 修改了驻留在那里的对象的状态。对象被修改。

在第二种情况下，您将cow 地址的副本传递给goo。然后 goo 继续更改该副本。效果：无。

我称之为*粉红屋原则*。如果你复制你的地址并告诉油漆工把那个地址的房子涂成粉红色，你最终会得到一个粉红色的房子。如果你给画家一份你的地址副本并告诉他把它改成一个新地址，你家的地址不会改变。

解释消除了很多混乱。Python 按值传递地址变量存储。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-01-16T16:30:33.280

Python 是按引用值复制的。一个对象占用内存中的一个字段，并且一个引用与该对象相关联，但它本身占用了内存中的一个字段。并且名称/值与引用相关联。在 python 函数中，它总是复制引用的值，因此在您的代码中，n 被复制为一个新名称，当您分配它时，它在调用者堆栈中有一个新空间。但是对于列表，名称也被复制了，但它引用了相同的内存（因为您从未为列表分配新值）。那是python中的魔法！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-01-06T22:29:12.883

正如乔尔所说。这是什么指向什么的问题，我要补充一点，这也是 = 做什么和 .append 方法做什么之间的区别的问题。

1.  当您在 main 中定义 n 和 x 时，您告诉它们指向 2 个对象，即 1 和 [1,2,3]。这就是 = 所做的：它告诉你的变量应该指向什么。

2.  当你调用函数 f(n,x) 时，你告诉两个新的局部变量 nf 和 xf 指向与 n 和 x 相同的两个对象。

3.  当你使用 "something"="anything_new" 时，你改变了 "something" 指向的东西。当你使用 .append 时，你改变了对象本身。

4.  不知何故，即使您给它们起相同的名称，main() 中的 n 和 f() 中的 n 也不是同一个实体，它们最初只是指向同一个对象（实际上 x 也是如此）。改变其中一个指向的内容不会影响另一个。但是，如果您改为更改对象本身，这将影响两个变量，因为它们都指向同一个现在已修改的对象。

让我们在不定义新函数的情况下说明方法 .append 和 = 之间的区别：

比较

```
 m = [1,2,3]
    n = m   # this tells n to point at the same object as m does at the moment
    m = [1,2,3,4] # writing m = m + [4] would also do the same
    print('n = ', n,'m = ',m) 
```

到

```
 m = [1,2,3]
    n = m
    m.append(4)
    print('n = ', n,'m = ',m) 
```

在第一个代码中，它将打印 n = [1, 2, 3] m = [1, 2, 3, 4]，因为在第 3 行中，您没有更改对象 [1,2,3]，而是你告诉 m 指向一个新的、不同的对象（使用'='），而 n 仍然指向原始对象。

在第二个代码中，它将打印 n = [1, 2, 3, 4] m = [1, 2, 3, 4]。这是因为这里 m 和 n 在整个代码中仍然指向同一个对象，但是您使用 .append 方法修改了对象本身（m 指向）...请注意，第二个代码的结果将是无论您在第 3 行写 m.append(4) 还是 n.append(4) 都一样。

一旦你理解了这一点，剩下的唯一困惑就是真正理解，正如我所说，你的 f() 函数中的 n 和 x 和你的 main() 是不一样的，它们只是最初指向相同调用 f() 时的对象。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2022-01-23T10:22:42.097

当您在函数内部传递命令 n​​ = 2 时，它会找到一个内存空间并将其标记为 2。但是如果您调用方法 append，您基本上是在引用位置 x（无论值是什么）并对其进行一些操作那。

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2020-01-08T03:23:27.750

请允许我再次编辑。这些概念是我通过尝试错误和互联网学习python的经验，主要是stackoverflow。有错误，也有帮助。

Python 变量使用引用，我认为引用是来自名称、内存地址和值的关系链接。

当我们这样做时`B = A`，我们实际上创建了 A 的昵称，现在 A 有 2 个名称，A 和 B。当我们调用 B 时，我们实际上是在调用 A。我们为其他变量的值创建了一个 ink，而不是 create一个新的相同值，这就是我们所说的引用。这个想法会导致两个问题。

当我们这样做时

```
A = [1]
B = A   # Now B is an alias of A

A.append(2)  # Now the value of A had been changes
print(B)
>>> [1, 2]  
# B is still an alias of A
# Which means when we call B, the real name we are calling is A

# When we do something to B,  the real name of our object is A
B.append(3)
print(A)
>>> [1, 2, 3] 
```

当我们将参数传递给函数时会发生这种情况

```
def test(B):
    print('My name is B')
    print(f'My value is {B}') 
    print(' I am just a nickname,  My real name is A')
    B.append(2)

A = [1]
test(A) 
print(A)
>>> [1, 2] 
```

我们将 A 作为函数的参数传递，但该函数中此参数的名称是 B。同一个名称不同。
因此，当我们这样做时`B.append`，我们正在做`A.append` 当我们将参数传递给函数时，我们不是在传递变量，而是在传递别名。

这里有两个问题。

1.  等号总是创建一个新名称

```
A = [1]
B = A
B.append(2)
A = A[0]  # Now the A is a brand new name, and has nothing todo with the old A from now on.

B.append(3)
print(A)
>>> 1
# the relation of A and B is removed when we assign the name A to something else
# Now B is a independent variable of hisown. 
```

等号是明确全新名称的声明，

这是我的脑震荡部分

```
 A = [1, 2, 3]

# No equal sign, we are working on the origial object,
A.append(4)
>>> [1, 2, 3, 4]

# This would create a new A
A = A + [4]  
>>> [1, 2, 3, 4] 
```

和功能

```
def test(B):
    B = [1, 2, 3]   # B is a new name now, not an alias of A anymore
    B.append(4)  # so this operation won't effect A

A = [1, 2, 3]
test(A)
print(A)
>>> [1, 2, 3]

# ---------------------------

def test(B):
    B.append(4)  # B is a nickname of A, we are doing A

A = [1, 2, 3]
test(A)
print(A)
>>> [1, 2, 3, 4] 
```

第一个问题是

1.  和等式的左边总是一个全新的名称，新的变量，

2.  除非右边是一个名字，比如`B = A`，这只会创建一个别名

第二个问题，有些东西是永远不会改变的，我们不能修改原来的，只能创造一个新的。

这就是我们所说的不可变。

当我们这样做时`A= 123`，我们创建一个包含名称、值和地址的字典。

当我们这样做时`B = A`，我们将地址和值从 A 复制到 B，对 B 的所有操作都会影响 A 的值的相同地址。

当涉及到字符串、数字和元组时。价值和地址这对永远不会改变。当我们将str放到某个地址时，它立即被锁定，所有修改的结果将被放入其他地址。

`A = 'string'`将创建一个受保护的值并存储字符串 'string' 。目前，没有内置函数或方法可以用类似的语法修改字符串`list.append`，因为该代码修改了地址的原始值。

字符串、数字或元组的值和地址是受保护的、锁定的、不可变的。

我们可以对字符串进行处理，只需要使用 的语法`A = B.method`，我们必须创建一个新名称来存储新的字符串值。

如果您仍然感到困惑，请扩展此讨论。这个讨论帮助我一劳永逸地弄清楚可变/不可变/引用/参数/变量/名称，希望这也可以对某人有所帮助。

##############################

无数次修改了我的答案并意识到我不必说什么，python已经解释了自己。

```
a = 'string'
a.replace('t', '_')
print(a)
>>> 'string'

a = a.replace('t', '_')
print(a)
>>> 's_ring'

b = 100
b + 1
print(b)
>>> 100

b = b + 1
print(b)
>>> 101 
```

```
 def test_id(arg):
    c = id(arg)
    arg = 123
    d = id(arg)
    return

a = 'test ids'
b = id(a)
test_id(a)
e = id(a)

# b = c  = e != d 
```

```
# this function do change original value
del change_like_mutable(arg):
    arg.append(1)
    arg.insert(0, 9)
    arg.remove(2)
    return

test_1 = [1, 2, 3]
change_like_mutable(test_1)

# this function doesn't 
def wont_change_like_str(arg):
     arg = [1, 2, 3]
     return

test_2 = [1, 1, 1]
wont_change_like_str(test_2)
print("Doesn't change like a imutable", test_2) 
```

这个魔鬼不是引用/值/可变与否/实例、名称空间或变量/列表或str，它是语法，等号。

# debugging - 什么可以帮助您提高发现错误的能力？

> ID：575202
> 
> 赞同：6
> 
> 时间：2009-02-22T16:45:45.910
> 
> 标签：debugging

我想知道是否有方法可以快速找到程序中的错误。

似乎您越掌握软件的架构，您就越能更快地找到错误。

程序员如何提高他们发现错误的能力？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-22T16:49:03.297

日志记录和单元测试。你对所发生的事情掌握的信息越多，重现它就越容易。您可以使您的代码更加模块化，就越容易检查它是否真的*在*您认为的地方出现错误，然后检查您的修复是否解决了问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-22T16:55:44.670

分而治之。每当您进行调试时，您都应该考虑减少问题的可能位置。每次运行应用程序时，您都应该尝试消除可能的来源并将实际位置归零。这可以通过日志记录、调试器、断言等来完成。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-22T16:54:27.980

这是发现错误后的预防方法：我发现花一分钟时间思考错误真的很有帮助。

1.  本质上究竟是什么错误。
2.  为什么会发生。
3.  你能早点找到它吗，更容易。
4.  您从该错误中学到的任何其他内容。

我发现花一点时间考虑这些事情会大大降低您将来产生相同错误的可能性。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-22T16:49:49.037

我会假设你的意思是逻辑错误。我发现捕获逻辑错误的最佳方法是实施某种测试方案。签出[jUnit](http://www.junit.org/)作为标准。几乎您定义了一组可接受的方法输出。每次编译系统时，它都会检查所有测试用例。如果您引入了破坏测试的新逻辑，您将立即了解它并确切知道您必须修复什么。

测试驱动设计是目前编程领域的一个相当大的运动。您将很难找到一种不支持某种测试的语言。甚至 JavaScript 也有大量的测试套件。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-22T17:33:42.473

经验使您成为更好的调试器。密切关注您和其他人经常犯的错误。尝试弄清楚这些错误是否/如何适用于影响您的所有代码，而不是发现错误的单个实例。

[Raymond Chen 以他的通灵](http://blogs.msdn.com/oldnewthing/archive/2006/11/02/931674.aspx) [调试](http://blogs.msdn.com/oldnewthing/archive/2005/03/21/399688.aspx)能力而闻名。

> 大多数看起来像心理调试的东西实际上只是知道人们容易出错的地方。

这意味着您不必非常熟悉架构/系统。您只需要足够的知识来了解适用且易于制造的错误类型。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-22T16:51:11.420

我个人采取的方法是在实际打开代码并查看之前考虑错误可能在代码中的位置。当您第一次开始使用这种方法时，它实际上可能效果不佳，尤其是在您对代码库非常不熟悉的情况下。但是，随着时间的推移，有人将能够告诉您他们正在经历的行为，并且您会很好地了解问题所在，或者您甚至可能在查看代码之前就知道要在代码中修复什么以解决问题.

我在一个由供应商维护的项目上工作了几年。它们不是很好的调试器，大多数时候我们需要将它们指向有问题的代码区域。让我们的问题变得更糟的是我们没有一个很好的方式来查看源代码，所以我们的很多“调试”只是感觉。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-22T16:52:25.583

错误检查和报告。＃1新手编码器调试错误是关闭错误报告，避免检查发生的事情是否有意义等等。一般来说，人们觉得如果他们看不到任何问题，那么就没有任何问题。当然，这与情况相去甚远。

相反，您的代码应该充满会产生大量噪音的错误条件，并带有详细的报告，您会在某个地方看到它。（这并不意味着在生产网页中。）然后，您的错误开始发生在接近实际问题。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-22T17:11:21.450

> 似乎你越掌握软件的架构，就越能更快地找到错误。

在了解架构之后，一个人在应用程序中发现错误的能力会随着他们识别和编写大量测试的能力而提高。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-22T17:31:05.457

了解你的工具。

确保您知道如何在调试器中使用条件断点和监视。

也可以使用静态分析工具——它们可以指出更明显的问题。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-23T15:24:12.040

睡觉和休息。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-22T17:55:05.353

*   首先使用产生较少错误的编程方法。

如果要实现一个独立的功能需求，需要对源代码进行 N 次单独的点编辑，代码中的 bug 数量大致与 N 成正比，因此请找到最小化 N 的编程方法。不要重复自己）、代码生成和 DSL（领域特定语言）。

*   在可能出现错误的地方进行单元测试。

明显地。
恕我直言，最好的单元测试是蒙特卡罗。

*   使中间结果可见。

例如，编译器具有 4 元组形式的中间表示。如果有错误，可以检查中间代码。这表明错误是在编译器的前半部分还是后半部分。

PS 大多数程序员并不知道他们可以选择使用多少数据结构。您使用的数据结构越少，由它引起的错误（和性能问题）的机会就越少。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-22T18:33:19.037

我发现[跟踪点](http://blogs.msdn.com/ms_joc/archive/2004/07/02/171960.aspx)是一种非常宝贵的调试工具。它们有点像日志记录，除了您在调试会话期间创建它们以解决特定问题（如断点）。

在跟踪点中打印堆栈跟踪可能特别有用。例如，您可以在对象的构造函数中打印哈希码和堆栈跟踪，然后当再次使用该对象时，您可以搜索其哈希码以查看创建它的客户端代码。查看谁处理它或调用了某个方法等也是如此。

它们也非常适合调试与窗口焦点更改等相关的问题，如果您进入中断模式，调试器会干扰这些问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-22T18:49:44.753

[FindBugs](http://findbugs.sourceforge.net/)等静态代码工具

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-23T15:19:44.517

断言、断言和断言。

对于每行真实代码，我们代码的某些区域有 4 或 5 个断言。当我们收到错误报告时，首先发生的事情是客户数据在我们的调试版本中处理了 99 次 100 次，断言将在错误原因附近触发。

此外，我们的调试构建执行冗余计算以确保优化算法返回正确的结果，并且调试函数用于检查数据结构的健全性。

新开发人员必须应对的最困难的事情是让他们的代码在他们调用的代码的断言中存活下来。

此外，我们不允许将任何代码放回顶层，从而导致任何集成或单元测试失败。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-22T22:30:02.773

当您认为操作系统中一定存在错误时，请检查您的断言 - 并使用“断言”语句将它们放入代码中。

相反，当您编写代码时，请考虑您的算法的有效输入范围并放入断言以确保您拥有您认为拥有的东西。输出也是如此：检查您是否生产了您认为自己生产的产品。

例如，如果您期望一个非空列表：

```
l = getList(input)
assert l, "List was empty for input: %s" % str(input) 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-22T16:49:11.563

单步执行代码，检查发生意外行为的流程/状态。（当然，然后为它开发一个测试）。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-22T16:52:12.773

在您的代码中编写 Debug.Write(message) 并使用[DebugView](http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx)是另一种选择。然后运行你的应用程序找出发生了什么。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-22T17:01:13.407

软件中的“架构”意味着：

*   几个组件
*   组件通过明确定义的接口进行交互
*   每个组件都有明确的职责
*   一个组件的职责不同于其他组件的职责

因此，正如您所说，架构越好，就越容易找到错误。

第一：知道错误，您可以决定哪个功能被破坏，从而知道哪个组件实现了该功能。例如，如果错误是没有正确记录某些内容，则此错误应位于以下 3 个位置之一：

1.  在负责记录的组件中（你的记录库）
2.  或者，在使用这个库的应用程序代码之上
3.  或者，低于该库正在使用的系统代码

第二：检查通过组件之间的接口传输的数据。继续上面的例子：

*   在调用 logger API 的应用程序代码上设置调试器断点，以验证是否正确使用了 logger API（例如，它是否被调用，参数是否符合预期等）。
*   这样做会告诉您错误是在此接口上方的组件中，还是在此接口下方的组件中。
*   重复（如果调用堆栈非常深，可能使用二进制搜索），直到您找到哪个组件有问题。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-23T15:33:53.297

我是 QA 团队@work 的一员，对产品及其开发方式有所了解，这对发现错误**有很大**帮助，当我制作新的 QA 工具时，我会将其传递给我们的开发团队进行测试，发现错误在你自己的代码中简直**太难**了！

有人说程序员被**污染**了，所以我们看不到他们自己的产品中的错误；我们不是在这里谈论代码，我们超越了可用性和功能本身。

同时，单元测试接缝是一个很好的解决方案，可以在您自己的代码中找到错误，如果您在编写单元测试之前就错了，那完全没有意义，那么您将如何找到错误呢？你没有！让你的同事找到他们，雇佣一个质量检查人员。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-07-26T19:00:13.807

[科学调试](https://www.udacity.com/course/software-debugging--cs259)是我一直使用的，它有很大帮助。

基本上，如果你能复制一个错误，你就可以追踪它的起源。然后，您应该进行一些测试，观察结果，并推断错误发生原因的假设。

写下你所有的假设、尝试、预期结果和观察到的结果可以帮助你追踪错误，特别是如果它们是令人讨厌的。

有一些自动化工具可以帮助您完成该过程，特别是[git-bisect](http://git-scm.com/docs/git-bisect)（以及其他修订系统上的类似[二分](https://en.wikipedia.org/wiki/Bisection_(software_engineering))工具）可以快速找到引入错误的更改，[单元测试](https://en.wikipedia.org/wiki/Unit_testing)以重现错误并防止代码中的回归（可以是与 bisect 结合使用）和[delta 调试](https://en.wikipedia.org/wiki/Delta_Debugging)以找出代码中的罪魁祸首（类似于 git-bisect，但 git-bisect 适用于代码历史记录，而 delta 调试直接适用于代码）。

但无论您使用什么工具，最重要的好处在于科学方法，因为这是大多数有经验的调试器所做的工作的形式化。

# objective-c - 在 Objective-C 继承中使用 @synthesize/@property

> ID：575210
> 
> 赞同：12
> 
> 时间：2009-02-22T16:49:28.973
> 
> 标签：objective-c, cocoa, cocoa-touch, oop, inheritance

如果你的 A 类有一个实例 var "foo"，它有一个 @property/@synthesize 指令，并且 B 类继承自 A 类，它是否也需要 @property/@synthesize "foo"？我问的原因是因为当我尝试使用 B 类的“foo”时，调用类说“foo”不是结构化联合或成员，这让我相信它需要显式合成。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-22T17:01:27.603

不，你没有。合成的属性会自动添加到 A 类及其子类中。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-22T18:23:23.553

> 如果你的 A 类有一个实例 var "foo"，它有一个 @property/@synthesize 指令，并且 B 类继承自 A 类，它是否也需要 @property/@synthesize "foo"？

不。

> 我问的原因是因为当我尝试使用 B 类的“foo”时，调用类说……</p>

不，编译器会这么说。

> ……那个“foo”不是一个结构化的联合或成员，这让我相信它需要被明确地综合起来。

这是。在 A 类。

编译器向您发出警告是因为它不知道@property，这是因为您既没有声明它也没有导入声明它的标头。你说A类的头声明了属性，所以将A类的头导入到B类的实现中，这样编译器在编译B类的时候就知道这个属性了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-12-07T14:34:05.357

以防万一这有助于某人。

我也遇到了这个问题并阅读了这些答案，但仍然无法直接访问超类变量。它们被声明为属性并在超类中合成，并且我已将标头导入到我的子类中。我被困住了，直到我发现我需要在超类的@interface 部分声明成员变量以及超类的属性......！例如

```
@interface BuoyAnnotation : NSObject <MKAnnotation>
{
    CLLocationCoordinate2D coordinate;
    CLLocation* location;
    int type; 

}

@property (nonatomic, readonly) CLLocationCoordinate2D coordinate;
@property (nonatomic, retain) CLLocation* location;
@property (nonatomic, assign) int type; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T17:27:38.413

当继承时，您不需要重新声明任何属性或变量。

也许如果您发布您的 ClassB 头文件或其中的一部分，那么人们可以更好地查明您的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-16T01:12:06.107

正确，您只需在典型的成员变量声明大括号之外声明一个@property，然后在.m 文件中@synthesize 属性。我确实注意到在子类中您使用 self.propertyName 来引用它，但在父类中您可以只使用即时变量名称。

# knuth - 计算机编程艺术练习题：第 1 章，第 8 题

> ID：575215
> 
> 赞同：9
> 
> 时间：2009-02-22T16:51:08.503
> 
> 标签：knuth, taocp

我正在做 TAOCP 第 1 卷第 3 版的练习，但无法理解以下练习答案中使用的语法。

第 1 章练习 8

[通过指定 T j] ,s [j] ,a [j] ,b [j]计算正整数 m & n 的最大公约数

让您的输入由字符串 a ^m b ^(n 表示)（m a's 后跟 n b's）

回答：

令 A = {a,b,c}，N=5。该算法将以字符串 a ^(gcd(m,n)终止)

```
    j T j      s j     b j     a j
    0 ab（空） 1 2 删除一个 a 和一个 b，或转到 2。
    1（空） c 0 0 在最左边添加 c，返回 0。
    2 ab 2 3 将所有 a 更改为 b
    3 ca 3 4 将所有 c 更改为 a
    4 bb 0 5 如果 b 剩余，重复

```

我难以理解的部分只是如何解释这张表。此外，当 Knuth 说这将以字符串 a ^(gcd(m,n))结束时 ——为什么 gcd(m,n) 的上标？

谢谢你的帮助！

编辑了更多问题：

什么是 T [j] - 注意 T = Theta

什么是 s [j] - 注意 s = phi

您如何解释列 b [j]和 a [j]？

为什么 Knuth 将解决方案中的新符号转换为他在文本中没有解释的示例？只是令人沮丧。谢谢！！！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-22T17:13:06.453

这是该练习答案的[实现](http://readingtaocp.wordpress.com/2008/09/13/markov-algorithms-in-scala/)。也许它有帮助。

顺便说一句，该表似乎描述了[马尔可夫算法](http://en.wikipedia.org/wiki/Markov_algorithm)。

据我目前了解，您从第一个命令集 j = 0 开始。将 T [j]的任何出现替换为s [j]并根据您是否替换任何内容跳转到下一个命令行（在这种情况下跳转到 b [j]，如果没有被替换，跳转到[j] )。

编辑：新答案：

A = {a,b,c} 似乎是您可以使用的字符集。c 在算法过程中出现（添加到左侧，然后再次被 a 替换）。

Theta 和 phi 可能是您通常用于“原始”和“替换”之类的一些希腊字符，尽管我不知道它们是。

b [j]和 a [j]是接下来要执行的表格行。这与最后一列中人类可读的描述相匹配。

我唯一不能回答的是，为什么 Knuth 没有任何解释就使用这个符号。我再次浏览了书中的第一章和解决方案，他没有在任何地方提及。

EDIT2：gdc(2,2) = 2 的示例

```
    输入字符串：aabb
    第 0 行：删除一个 a 和一个 b，或转到 2。
    => ab => 转到 1
    第1行：在最左边添加c，回到0。
    => 出租车 => 去 0
    第 0 行：删除一个 a 和一个 b，或转到 2。
    => c => 转到 1
    第1行：在最左边添加c，回到0。
    => 抄送 => 去 0
    第 0 行：删除一个 a 和一个 b，或转到 2。
    没有找到ab，所以转到2
    第 2 行：将所有 a 更改为 b
    没有找到a，所以转到3
    第 3 行：将所有 c 更改为 a
    => 一个
    第 4 行：如果 b 仍然存在，则重复
    没有找到 b，所以转到 5（结束）。

    => 答案是“aa” => gdc(2,2) = 2

```

顺便说一句，我认为对第 1 行的描述应该是“删除一个“ab”，或者转到第 2 行。” 这让事情变得更清楚了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T17:12:05.237

gcd(m,n) 的上标是由于数字在此表中的表示方式。

例如：m => a^m n => b^n

gcd(m,n) => a^gcd(m,n)

看起来好像正在实施欧几里得算法。IE

```
gcd(m,n):
  if n==0:
    return m
  return gcd(n,m%n) 
```

这些数字表示为幂，以便能够进行模运算 m%n。

例如，4 % 3 将按如下方式计算：4 'a's (a^4) mod 3 'b's (b^3)，这将留下 1 'a' (a^1)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T17:52:38.900

^m的概念可能是状态机上下文中输入字符串的概念。

这样的概念用于指代`m`连续的实例`a`，即：

> a ⁴ = aaaa
> b ⁷ = bbbbbbb
> a ⁴ b ⁷ a ³ = aaaabbbbbbbaaa

而^(gcd(m,n))的意思是，在运行（解决方案）状态机之后，生成的字符串应该`gcd(m,n)`是`a`

换句话说，`a`结果中 's 的数量应该等于`gcd(m,n)`

我同意@schnaader 的观点，因为它可能是一个描述马尔可夫算法用法的表格。

# inheritance - 什么是类继承的好例子？

> ID：575217
> 
> 赞同：30
> 
> 时间：2009-02-22T16:51:46.130
> 
> 标签：inheritance, documentation, oop

我正在为面向对象的语言编写文档，我想知道什么样的类是继承的好例子。

一些常见的例子：

```
class Person {
}
class Employee extends Person {
} 
```

目前我最喜欢，但我不喜欢 Person->Employee 因为“Employee”看起来并不有趣。

```
class Bicycle {
}
class MountainBike extends Bicycle {
} 
```

我在一些[Java 教程](http://java.sun.com/docs/books/tutorial/java/javaOO/classes.html)中发现了这一点，但自行车应该具有哪些属性并不是很明显。

```
class Animal {
}
class Bird extends Animal {
} 
```

和自行车一样。

```
class A {
}
class B extends A {
} 
```

太抽象了。主要问题是这样的类将需要更多的抽象属性和方法。

有没有人有一个简单的类层次结构更好的例子？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-22T16:55:12.220

我喜欢`Stream`层次感。这个想法是任何东西都可以使用流而不用关心它是什么类型的流，并且各个子类以不同的方式处理存储（例如`NetworkStream`，在.NET 中）`MemoryStream`。`FileStream`

如果您对接口感兴趣，那么`IEnumerable<T>`.NET 是一个很棒的接口——您可以迭代任何集合，而无需关心底层数据结构是什么。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-22T17:35:28.880

我同意 Jon Skeet 的流示例。也许它并不完美，但与这里的大多数示例相比，它有一个优势：

*这是现实的*

自行车、人或动物、形状或武器在实际项目中不会通过继承来建模。（特别是形状，是非常危险的，因为*它不起作用*。）

这是我对继承的不满。它经常被教导为*必须*用来表达你能找到的*每一个层次结构的东西。*员工就是人，对吧？所以 Employee 类*必须*继承自 Person 类。但是一个人也是一个 LivingCreature，所以我们最好也有一个类。LivingCreature 也是一个有机体，所以我们还有另一个类。一个有机体是....随意继续。

我认为，如果有人在某处通过解释何时应该使用继承来教授继承，而不仅仅是如何在任何层次结构上强制继承，无论它是否有益。

流（或 ChrisW 示例中的设备）具有*有意义*的优势。您希望能够以相同的方式对待所有流，无论它们是连接到内存缓冲区、文件还是网络套接字。而且所有硬件设备确实有很多共同的行为，可以合理地分解为 Device 基类。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-02-22T16:57:55.007

汽车零件可能很有趣，例如您可能有

```
class part
{
    OEM
    Manufacturer
    Number
    Description
}

class Tire extends Part
{
   Speed
   Rating

} 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-02-22T16:59:48.607

出于多种原因，Animal 类是类继承的经典示例。

首先，有一些明显的方法可以扩展底层的动物类。您可能会从哺乳动物、鸟类、甲壳类动物等子类开始。

一些类，例如 Mammal，将通过添加相当明显的属性（“Warm-Blooded”等）来扩展 Animal。

如果你用动物继承来说明，那么在开发类层次结构中很常见的其他更成问题的问题是非常明显的——这对于解释来说是一件好事*。*鸟会飞，对吧？好吧，不是所有的鸟……那么，你如何代表飞行？当然，有经典的解决方案和关于如何解决每个解决方案引入的问题和权衡的大量在线讨论信息。

因此，我强烈建议使用“动物”作为您的示例，因为可用信息和示例非常丰富。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-02-22T17:13:15.733

许多人使用 Shapes 示例，但这实际上是一个危险的示例。当您直观地确定正方形是矩形的子类时，就会出现问题。

在行为方面，正方形比矩形更受限制，破坏了可替代性。例如，我们可以要求一个矩形对象改变它的高度。如果正方形是矩形的子类，这意味着我们应该能够问同样的正方形。但是，改变正方形的高度将意味着它不再是正方形了！当然，我们可以相应地增加宽度，但是当我们要求声明类型为矩形的对象（实际上是下面的正方形）来改变它的高度时，这不是我们所期望的。

它被称为[Liskov 替换原则](http://en.wikipedia.org/wiki/Liskov_substitution_principle)，在进行任何严肃的 OO 开发时都应该注意它。

正方形当然是矩形的子*集*，而不是子*类*。这是面向数据的方法和面向行为的方法之间的区别。

和 Jon 一样，我更喜欢以 Streams 为例。即使对非程序员来说也不难解释，而且它明确面向行为，避免了形状示例的反直觉。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2012-10-18T02:40:21.190

如果你喜欢电子游戏，可能是这样的：

```
class enemy{
  Health
  Posx
  posy
  Etc
}

class orc : extends enemy{
 speed
 Strength
 etc
} 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2013-02-17T18:42:09.170

代数表达式的层次结构怎么样。这是一个很好的例子，因为它同时使用了继承和组合：

```
public interface Expression {
    int evaluate();

    public class Constant implements Expression {

        private final int value;

        public Constant(int value) {
            this.value = value;
        }

        @Override
        public int evaluate() {
            return this.value;
        }

        @Override
        public String toString() {
            return String.format(" %d ", this.value);
        }

    }

    public class Negate implements Expression {

        private final Expression expression;

        public Negate(Expression expression) {
            this.expression = expression;
        }

        @Override
        public int evaluate() {
            return -(this.expression.evaluate());
        }

        @Override
        public String toString() {
            return String.format(" -%s ", this.expression);
        }
    }

    public class Exponent implements Expression {

        private final Expression expression;
        private final int exponent;

        public Exponent(Expression expression, int exponent) {
            this.expression = expression;
            this.exponent = exponent;
        }

        @Override
        public int evaluate() {
            return (int) Math.pow(this.expression.evaluate(), this.exponent);
        }

        @Override
        public String toString() {
            return String.format(" %s ^ %d", this.expression, this.exponent);
        }

    }

    public class Addition implements Expression {

        private final Expression left;
        private final Expression right;

        public Addition(Expression left, Expression right) {
            this.left = left;
            this.right = right;
        }

        @Override
        public int evaluate() {
            return this.left.evaluate() + this.right.evaluate();
        }

        @Override
        public String toString() {
            return String.format(" (%s + %s) ", this.left, this.right);
        }
    }

    public class Multiplication implements Expression {

        private final Expression left;
        private final Expression right;

        public Multiplication(Expression left, Expression right) {
            this.left = left;
            this.right = right;
        }

        @Override
        public int evaluate() {
            return this.left.evaluate() *  this.right.evaluate();
        }

        @Override
        public String toString() {
            return String.format(" (%s * %s) ", this.left, this.right);
        }
    }

} 
```

然后你可以提供一个激励性的例子，比如：

```
public static void main(String[] args) {

    Expression two = new Constant(2);
    Expression four = new Constant(4);
    Expression negOne = new Negate(new Constant(1));
    Expression sumTwoFour = new Addition(two, four);
    Expression mult = new Multiplication(sumTwoFour, negOne);
    Expression exp = new Exponent(mult, 2);
    Expression res = new Addition(exp, new Constant(1));

    System.out.println(res + " = " + res.evaluate());

} 
```

这将产生：

```
(  ( ( 2  +  4 )  *  - 1  )  ^ 2 +  1 )  = 37 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-02-22T16:56:24.730

我认为 Shape 是一个很好的抽象类。有 2D 和 3D 形状。2D 形状通常具有面积，而 3D 形状具有体积。两者都可以有一个“位置”或“质量中心”。

一些建议：

```
class Shape {..}

class Shape2D extends Shape {...}

class Circle extends Shape2D {...}

class Rectangle extends Shape2D {...}

class Polygon extends Shape2D {...}

class Shape3D extends Shape {...}

class Sphere extends Shape3D {...} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-04-12T07:57:42.650

作为一名反恐精英游戏爱好者，我想分享以下内容：

![在此处输入图像描述](https://i.stack.imgur.com/eoAgV.png)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2017-03-20T22:23:23.753

我用来展示国际象棋棋子。基类是一般 ChessPiece、King、Rook、Bishop 等继承而来。

我喜欢这个例子的地方：

*   这是真实的，如果您实施国际象棋，这是一个解决方案
*   在 C++ 中，您可以显示哪个函数是虚拟的，哪个不是
*   可以显示抽象类
*   高级示例可能会发展为定向棋子的通用基类（Rook 和 Bishop），甚至进一步发展为具有步长限制的通用定向棋子（除了 Pawn 之外的所有事物）

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-02-22T17:24:17.317

我建议“设备”。没有人真正使用软件对动物进行建模，但他们会为设备建模。

```
class Device
{
  void start();
  void stop();
  DeviceStatus status { get; }
}

class VideoDevice : Device
{
  ... methods for any/all video devices ...
}

class DiskDevice : Device
{
  ... methods for any/all disk devices ...
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-10-16T19:46:16.443

网上商店也可能是一个不错的选择。

```
Product(id, title, price, description)
Book(isbn, publisher, pageNr) extends Product
CD(company, duration, genre, taskList) extends Product 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-02-22T16:55:40.877

我一直很喜欢：

```
class Shape {
}
class Square extends Shape {
} 
```

但是你引用的前三名中的任何一个都可以。MountainBike 听起来最令人兴奋。当然，你可以用汽车做类似的事情。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-22T17:03:27.130

我遇到的最好的例子（并且在很多书中都读过）是使用 Shape 的例子。

最好的一点是，你可以很容易地向任何与他的经验无关的程序员解释与 OOP 相关的所有概念（包括困难的概念），如类、对象、继承、抽象、封装、多态等。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2017-10-18T12:29:30.677

我喜欢以打印机为例的想法。假设您正在为 HP、Brother、Lexmark 或其他一些实体工作，并且您需要开发一个能够为各种操作系统生成驱动程序特定模块的程序。

```
class Printer {
    private String brand;
    private String model;

    public void powerOn() {
        // Logic to power on
    }

    public void powerOff() {
        // Logic to power off
    }

    public void init() {
        // Bootstrap/prep the system
        // Check cartridge
        // Check paper
        // Ready for usage
}

class InkJetPrinter extends Printer {
    // Inherits fields and methods from Printer
    // Demonstrate method overriding and overloading
    // Add new InkJet specific behaviors, components etc.
}

class LaserPrinter extends Printer {
    // Inherits fields and methods from Printer
    // Demonstrate method overriding and overloading
    // Add new Laser specific behaviors, components etc.
}

class LabelPrinter extends Printer {
    // Inherits fields and methods from Printer
    // Demonstrate method overriding and overloading
    // Add new Label specific behaviors, components etc.
} 
```

在演示了继承之后，您可以转向抽象和方法重载/覆盖。Printer 类中的 init 方法是一个很好的抽象候选者。子类将需要实现它们自己的初始化过程。

您还可以扩展此示例并开始演示接口和组合的正确用法。IS-A 和 HAS-A 概念有什么区别？某些打印机可能具有 WiFi 和蓝牙功能。或者，某些喷墨打印机可能具有扫描功能，而其他只有进纸器等。您将如何实现这一点？

我认为使用打印机通常与计算机和计算机科学更密切相关。您可以使用此示例，甚至进一步演示处理嵌入式系统与 PC、智能手机和其他 IoT 之间网络的示例。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-22T16:56:09.660

我一直使用的最好的是 Shapes。

然后你可以有

```
Shape --> Quadrilateral
Quadrilateral --> Rectangle
Quadrilateral --> Trapezoid
Rectangle --> Square
Shape --> Triangle 
```

等等

方法也很容易猜到。

```
Shape::Area
Shape::Draw
Shape::Intersect (x,y) 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-22T16:58:52.900

我喜欢车辆示例，因为它允许一个相对干净的扩展来将接口包含到讨论中（IAutomaticGearbox，有人吗？）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-22T16:58:53.897

关于什么

```
class Weapon 
{
}

class Gun : extends Weapon
{
}

class Knife : extends Weapon
{
} 
```

等。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-22T17:01:04.220

继承可能很复杂。让我们从最简单的开始——行为继承。在这里，您仅继承行为而没有状态。例如：Person 和 Animal 都是 Animate 对象，它们表现出 IsAlive 行为。要使用您的示例：

```
class LivingThing {
   /* We propose a new type */
  public:
    virtual bool IsAlive() = 0;
    virtual void Birth() = 0;
    virtual void Death() = 0;
};

class Person : public  LivingThing {
    /* A real living thing */
  public:
    virtual bool IsAlive() { return true; }
    virtual void Birth() {}
    virtual void Death() {}
    /* .. and has some special behavior */
    void Marry();
    void Divorce();
};

class Animal: public  LivingThing {
    /* A real living thing */
  public:
    virtual bool IsAlive() { return true; }
    virtual void Birth() {}
    virtual void Death() {}
    /* .. and has some special behavior */
    void Bite();
    void Bark();
}; 
```

我是用 C++ 语法写的，如果你对其中的任何理解有问题，就直说吧！

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-02-22T17:06:31.553

例子：

**“一切都源于对象”方法。**

狗 --> 动物 --> 生物 --> 物体

狗是动物，是生物，而生物又是物体。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2016-12-14T05:52:29.617

您可以在设计模式中找到很好的类继承示例。

1.  [Abstract_factory_pattern](https://en.wikipedia.org/wiki/Abstract_factory_pattern)：提供一种封装一组具有共同主题的独立工厂的方法，而无需指定它们的具体类

2.  [Template_method_pattern](https://en.wikipedia.org/wiki/Template_method_pattern)：它是一种行为设计模式，它定义了操作中算法的程序骨架，将一些步骤推迟到子类。

3.  [Decorator_pattern](https://en.wikipedia.org/wiki/Decorator_pattern)：这是一种设计模式，允许将行为静态或动态添加到单个对象，而不会影响同一类中其他对象的行为

有关真实世界的示例，请参阅以下帖子：

[何时使用装饰器模式？](https://stackoverflow.com/questions/1549743/when-to-use-the-decorator-pattern/37504043#37504043)

[JDK中的模板设计模式，找不到定义要按顺序执行的方法集的方法](https://stackoverflow.com/questions/35559360/template-design-pattern-in-jdk-could-not-find-a-method-defining-set-of-methods/38740810#38740810)

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2014-02-21T05:39:59.803

形状层次结构

我完全理解关于 Liskov 替换原则的 Rectangles 和 Squares 之间关系的担忧。但是，有一些方法可以保留这一原则，并且仍然将 Square 作为 Rectangle 的子类。例如 (Python)，假设如下：

```
class Rectangle:
  def __init__(self, w, h):
     self.width = w
     self.height = h

  def setWidth(self, neww):
     if neww > 0: self.width = neww

  def setHeight(self, newh):
     if newh > 0: self.height = newh 
```

我们可以通过以下方式定义 Square：

```
class Square(Rectangle):
   def __init__(self, side):
       super().__init__(self, side, side) # width = height = side

   def setWidth(self, newside):
       super().setWidth(self, newside)
       super().setHeight(self, newside) # force height to match

   def setHeight(self, newside):
       super().setWidth(self, newside)  # force width to match
       super().setHeight(self, newside) 
```

这样，只要需要 Rectangle 实例，我们就可以始终使用 Square 实例，从而保留 Liskov 的实例。

现在，根据我的经验，我们还可以使用继承来执行策略（通常是限制性的）。例如，假设我们有一个带有颜色属性和相应设置器 (setColor) 的 Shape 类。

```
class Shape:

   def __init__(self, ..., color, ...):
        # ...
        self.color = color
        # ...

   def setColor(self, newcolor):
        self.color = newcolor

   #... 
```

假设我们要创建一个“RedShape”类。我们如何防止客户端代码改变颜色？答案：通过覆盖 setColor 方法停用它。

```
class RedShape(Shape):
   def __init__(self, ...):
      super().__init__(self, 'red', ...)

   def setColor(self, newcolor):
      pass 
```

我们在 RedShape 中重新定义了 setColor 以不做**任何事情**。

RedShape 中的 setColor 会覆盖 Shape 中的 setColor，因此客户端代码无法更改 RedShape 实例的颜色。在某种程度上，我们创建了一个更具限制性的子类，因为我们没有改变它的颜色的能力，但它并不违反替换原则。

**当我们拥有通用（非抽象）的基类并且我们创建专门的类来控制**或限制基类中可用的功能时，此模型很有用。您可以创建一个子类链，越来越多地启用基类中可用的功能，或者您可以创建提供基类中可用功能的不同组合的类。

在我被激怒之前，让我重申一下，这种用法是一种实用的模型，它利用了继承和多态机制进行**控制**。它与通过增强或改进现有类来创建新类的浪漫继承概念相去甚远。

# php - 重新创建/查找 Joomla/Community Builder 的“最新用户”模块。MySQL/Joomla 中的日期

> ID：575218
> 
> 赞同：2
> 
> 时间：2009-02-22T16:51:50.670
> 
> 标签：php, mysql, joomla, joomla1.5

当 Joomla 首次出现并且我从 Mambo 迁移过来时，我记得找到了一个名为 Community Builder (CB) 的组件，它扩展了 Joomla 背后的基于用户的界面。

我记得我在 CB 中找到的一个小模块，它显示了一些关于用户的有用细节，我希望能够从我当前的项目中提取这些细节。这些细节包括：

*   注册用户总数
*   每日注册用户总数
*   每周注册用户总数
*   每月注册用户总数
*   最新注册用户
*   网站访问者总数

我的问题是如何重新创建非常相似的东西。我一直在尝试构建一个 SQL 语句，它可以操纵用户表结果并将它们与一组标准进行比较，例如。`registerDate`查找上周内所有带有“”变量的用户。

让我迷失的问题是如何操作和比较类似于 ' `2008-08-05 07:41:40`'的日期字符串

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T17:53:33.173

> 让我迷失的问题是如何操作和比较类似于“2008-08-05 07:41:40”的日期字符串

您可以让 MySQL 将其转换为 UNIX 时间戳，或者您可以通过 strtotime 运行它。

MySQL：

```
SELECT UNIX_TIMESTAMP(datetime_field) FROM table 
```

开始时间：

```
$timestamp = strtotime('2008-08-05 07:41:40'); 
```

# javascript - 新手：在函数调用时挂起浏览器

> ID：575222
> 
> 赞同：4
> 
> 时间：2009-02-22T16:53:07.687
> 
> 标签：javascript

我刚开始学习 JavaScript，想知道为什么当我单击“调用函数”按钮时这个简单的代码段会挂起。我错过了什么？

```
<html>
<head>

<script type="text/javascript">
function myfunction()
{
document.write("hello");
}
</script>

</head>
<body>

<form>
<input type="button" 
onclick="myfunction()" 
value="Call function">
</form>

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T16:59:12.743

如果您只是想看到您的按钮执行某项操作，请尝试：

```
alert("Hello"); 
```

而不是document.write。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T17:04:41.277

您需要在元素内部写入或给元素一个值，或者您应该像这样使用文档写入：

```
<html>
<head>

<script type="text/javascript">
function myfunction()
{
document.getElementById("lblMessage").innerText = "hello";
document.getElementById("txtMessage").value = "hello";
//document.write("hello");
}
</script>

</head>
<body>

<form>

<script type="text/javascript">
document.write("This is written while page processed by browser !<br />");
</script>

<input type="text" id="txtMessage" /><br />
<span id="lblMessage"></span><br />
<input type="button" 
onclick="myfunction()" 
value="Call function">
</form>

</body>
</html> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T16:57:19.517

你希望函数在哪里输出它的“hello”？直接进入按钮的源代码？这是没有意义的。浏览器混乱并挂起。

Document.write 不会神奇地在文档末尾插入一些东西。它把它的东西写在它被调用的地方。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T17:04:57.610

不太清楚您所说的“挂起”是什么意思...试试这个...可以删除警报，但会通知您它在执行中的位置...

```
<html>
  <head>
     <script type="text/javascript">
       function myFunction() {
          //for debugging
          alert('Made it into function');
          document.getElementById('MyOutputDiv').innerHTML = 'Word To Your Mom...';
          //for debugging
          alert('function complete');
       }
     </script>
   </head>
   <body>
     <input type='button' onclick='myFunction();' value='Call Function'>
     <br>
     <div id='MyOutputDiv'></div>
   </body>
 </html> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T17:14:41.050

document.write，但在哪里？您必须指定这一点。

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Hello</title>
</head>
<body>
<pre><script type="text/javascript">
function myfunction() {
  d = document.getElementById('hello');
  d.style.display = "block";
  d = document.getElementById('callme');
  d.style.display = "none";
}
</script>
</pre>
<div id="hello" style="display:none">
Hello
</div>
<div id="callme">
  <input type="button" 
     onclick="myfunction()" 
     value="Call function">
  </input>
</div>
</body>
</html> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T17:30:56.550

我无法解释“挂起”，但请查看此页面以获取有关 document.write 的入门知识：http: [//javascript.about.com/library/blwrite.htm](http://javascript.about.com/library/blwrite.htm)我还想补充一下您可能想要的写入页面中的特定元素，而不仅仅是覆盖整个页面。

# macos - 如何在 MacVim 中拥有类似 xEmacs 的 Auctex？

> ID：575249
> 
> 赞同：0
> 
> 时间：2009-02-22T17:01:53.000
> 
> 标签：macos, vim, emacs, auctex

我想在我的 MacVim 中有一个数字，就像在 xEmacs 的 AucTex 中一样。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T17:34:13.250

Vim 是纯文本的，所以它不能复制[preview-latex](http://www.gnu.org/software/auctex/)：

> AUCTeX 包含 preview-latex，它通过将选定的源块（例如单个公式或图形）直接可视化为源缓冲区中的图像，使 LaTeX 成为编辑工作流程的紧密集成组件。

因此，如果这是您需要集成到编辑器中的功能（而不是从编辑器中调用以进行快速的外部预览，这是可能的），那么您就不走运了。

至于[功能列表的其余部分](http://www.gnu.org/software/auctex/features.html)，其中大部分看起来都可以使用。[你可能对VIM-LaTex](http://vim-latex.sourceforge.net/)或[auctex.vim](http://www.vim.org/scripts/script.php?script_id=162)有一些运气

# tfs - 我是否必须使用带有 Team Build 定义的解决方案文件？

> ID：575253
> 
> 赞同：2
> 
> 时间：2009-02-22T17:05:34.210
> 
> 标签：tfs, tfsbuild

我们的应用程序使用 ASP.NET 和 Flex 平台的组合。

我能够成功地使用构建服务来构建和部署 .NET 网站。这很好用。但是，我们在 TFS 中也有我们的 ActionScript 文件，我创建了一个批处理文件以从命令行成功编译 ActionScript。

我想为 ASP.NET 和 Flex 编译创建两个单独的构建定义。Flex 显然没有 SLN 文件——我可以从头创建一个构建定义文件来支持没有解决方案文件的 Flex 编译批处理文件吗？创建任务相当简单（见下文），但我从来没有在不使用创建向导的情况下构建自定义的 Team Build 脚本——创建向导希望您提供我没有的解决方案文件。

我的构建脚本将非常简单：

1.  获取最新版本的 ActionScript 文件
2.  运行 ActionScript 编译批处理文件
3.  将 ActionScript 文件复制到部署文件夹

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T17:21:01.550

绝对地。 [TFSBuild.proj](http://msdn.microsoft.com/en-us/library/ms400710(VS.80).aspx)是一个 MSBuild 文件，它在 TFS 中调用您的解决方案构建。您可以修改它以使用 MSBuild 构建您想要的任何内容，这是编写 .vbproj 和 .csproj 文件的语言。MSBuild 允许您使用大量任务......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T21:05:25.050

不，您不需要解决方案文件即可使用 TFSBuild 完成构建。一个非常简单的项目文件可能如下所示（由 Aaron Hallberg 提供）：

```
<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">
  <Target Name="EndToEndIteration">
    <Exec Command="SomeScript.cmd" />
  </Target>
</Project> 
```

请从 Aarons 博客调查此[页面。](http://blogs.msdn.com/aaronhallberg/archive/2008/07/28/a-minimal-tfsbuild-proj-file.aspx)tfsbuild.proj 文件中的默认目标实际上是在“通用”目标文件中定义的，并通过以下指令导入 projfile：

```
 <Import Project="$(MSBuildExtensionsPath)\Microsoft\VisualStudio\v8.0\TeamBuild\Microsoft.TeamFoundation.Build.targets" /> 
```

如果删除了导入，则只需要 EndToEndIteration 目标即可运行 tfsbuild....

万事如意/尼尔斯

# c# - html 正则表达式 c#

> ID：575271
> 
> 赞同：-2
> 
> 时间：2009-02-22T17:19:06.627
> 
> 标签：c#, html, regex

我想将 url 作为字符串加载，然后使用正则表达式在 c# 中写出匹配项。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T17:21:35.123

[使用System.Net.WebClient.DownloadString](http://msdn.microsoft.com/en-us/library/system.net.webclient.downloadstring.aspx)将 URL 作为字符串下载很容易。

[使用System.Text.RegularExpressions.Regex.Match](http://msdn.microsoft.com/en-us/library/twcw2f1c.aspx)在 HTML 中查找匹配项很容易。

这两个链接都有很好的用法示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T17:27:10.927

使用正则表达式来匹配 HTML 中的内容确实不是一个好主意。更好的是使用正则表达式来匹配 HTML 中的标记，并对其进行解析。但是，到那时，您不妨使用现有的解析器。

# sql - 如何检索通过 insert...select 插入的行的标识？

> ID：575273
> 
> 赞同：4
> 
> 时间：2009-02-22T17:21:13.437
> 
> 标签：sql, sql-server, identity

我正在通过与此类似的查询插入记录：

```
insert into tbl_xyz select field1 from tbl_abc 
```

现在我想检索插入记录的新生成的 IDENTITY 值。如何以最少的锁定量和最大的可靠性做到这一点？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-22T17:34:56.230

[您可以使用OUTPUT](http://technet.microsoft.com/en-us/library/ms177564.aspx)子句获取此信息。

您可以将信息输出到临时目标表或视图。

这是一个例子：

```
DECLARE @InsertedIDs TABLE (ID bigint)
INSERT into DestTable (col1, col2, col3, col4)
OUTPUT INSERTED.ID INTO @InsertedIDs
SELECT col1, col2, col3, col4 FROM SourceTable 
```

然后，您可以在 InsertedIDs 表中查询您插入的 ID。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T17:37:47.517

@@IDENTITY 会返回你最后插入的 IDENTITY 值，所以你有两个可能的问题

1.  注意插入 table_xyz 时执行的触发器，因为这可能会更改 @@IDENTITY 的值。

2.  tbl_abc 是否不止一行。如果是这样，那么@@IDENTITY 将只返回最后一行的标识值

问题 1 可以通过使用 SCOPE__IDENTITY() 而不是 @@IDENTITY 来解决 问题 2 更难解决。tbl_abc 中的 field1 是否在 tbl_xyz 中定义了唯一记录，如果是这样，您可以使用标识列从 table_xyz 中重新选择数据。还有其他使用 CURSORS 的解决方案，但这些会很慢。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T17:23:37.253

```
SELECT @@IDENTITY 
```

这就是我以前的做法。不过，不确定这是否会满足您帖子的后半部分。

**编辑**
也找到了这个链接，但不确定它是否相同......
[如何插入多条记录并获取标识值？](https://stackoverflow.com/questions/95988/how-to-insert-multiple-records-and-get-the-identity-value)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T17:51:40.587

据我所知，你不能在同一个脚本中使用直接的 SQL 来做到这一点。但是您可以创建一个 INSERT 触发器。现在，我**讨厌**触发器，但这是一种方法。

根据您要执行的操作，您可能希望首先将行插入到临时表或表变量中，然后以这种方式处理结果集。希望有一个可以链接到的独特列。

您还可以锁定表，获取最大键，插入行，然后再次获取最大键并执行范围。

**扳机：**

```
--Use the Inserted table.  This conaints all of the inserted rows.
SELECT * FROM Inserted 
```

**温度表：**

```
insert field1, unique_col into #temp from tbl_abc

insert into tbl_xyz (field1, unique_col) select field1, unique_col from tbl_abc

--This could be an update, or a cursor, or whatever you want to do
SELECT * FROM tbl_xyz WHERE EXISTS (SELECT top 1 unique_col FROM #temp WHERE unique_col = tbl_xyz.unique_col) 
```

**键范围：**

```
Declare @minkey as int, @maxkey as int

BEGIN TRANS --You have to lock the table for this to work

  --key is the name of your identity column
  SELECT @minkey = MAX(key) FROM tbl_xyz
  insert into tbl_xyz select field1 from tbl_abc
  SELECT @maxkey = MAX(key) FROM tbl_xyz

COMMIT Trans

SELECT * FROM tbl_xyz WHERE key BETWEEN @minkey and @maxkey 
```

# python - python如何关闭已被gc'ed的文件？

> ID：575278
> 
> 赞同：15
> 
> 时间：2009-02-22T17:26:49.837
> 
> 标签：python, file, garbage-collection, del

我一直认为如果打开而不关闭文件会泄漏，但我只是验证了如果输入以下代码行，文件将关闭：

```
>>> f = open('somefile.txt')
>>> del f 
```

纯粹出于好奇，这是如何工作的？我注意到该文件不包含`__`del`__`方法。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-22T17:53:46.667

至少在 CPython 中，文件对象在释放时会关闭。请参阅CPython 源代码中的`file_dealloc`函数。`Objects/fileobject.c`Dealloc 方法有点像`__del__`C 类型，除了没有`__del__`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T17:35:00.923

因此使用**with**语句。

对于 Python 2.5，使用

```
from __future__ import with_statement 
```

（对于 Python 2.6 或 3.x，什么都不做）

```
with open( "someFile", "rU" ) as aFile:
    # process the file
    pass
# At this point, the file was closed by the with statement.
# Bonus, it's also out of scope of the with statement,
# and eligible for GC. 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-22T18:22:23.773

除了垃圾收集之外，Python 还使用引用计数和确定性销毁。当不再有对某个对象的引用时，立即释放该对象。释放文件会关闭它。

这与只有非确定性垃圾收集的 Java 不同。这意味着您不知道对象何时被释放，因此您必须手动关闭文件。

请注意，引用计数并不完美。您可以拥有带有循环引用的对象，这是程序无法访问的。这就是 Python 除了引用计数之外还有垃圾收集的原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T17:41:07.743

最好的猜测是，因为文件类型是内置类型，解释器本身会在垃圾收集时处理关闭文件。

或者，您只在 python 解释器退出后进行检查，并且所有“泄露”的文件句柄都已关闭。

# php - 如何在 CakePHP 中将脚手架生成为代码？

> ID：575280
> 
> 赞同：2
> 
> 时间：2009-02-22T17:27:25.653
> 
> 标签：php, cakephp, scaffolding

我有一个 cakephp 应用程序，其中有一些控制器使用脚手架作为逻辑和视图......我如何才能让蛋糕在我的项目中实际生成这些文件和函数，然后我可以修改并获得所有权......

以这些东西为起点很好，但如果我想更改在脚手架生成的列表页面上公开的模型属性，我需要从头开始基本上是不可能的。

# http - 哪些浏览器声称支持 HTTP 压缩，但实际上是不稳定的？

> ID：575290
> 
> 赞同：12
> 
> 时间：2009-02-22T17:34:51.033
> 
> 标签：http, compression

声称支持 gzip/deflate 压缩但处理得不好的旧/有缺陷的浏览器是否存在任何已知问题？我显然只为声称支持它的浏览器打开它，但为了获得最佳用户体验，我想知道是否有任何浏览器我应该列入黑名单。

出于某种原因，我记得听说过有关 IE6 和 gzip 的问题，但我不确定细节是什么。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-22T18:09:52.370

以下是一些文档的链接，这些文档命名了一些不支持压缩但声称它的浏览器：

*   [mod_deflate 模块文档中的 Apache 示例配置](http://httpd.apache.org/docs/2.2/mod/mod_deflate.html#recommended)
*   [哪些浏览器可以处理`Content-Encoding: gzip`？](http://schroepl.net/projekte/mod_gzip/browser.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T18:03:53.147

IE6 的问题是在 IE6sp1 之前它可能会在压缩响应中丢失前 2048 个字节的数据：http: [//support.microsoft.com/default.aspx ?scid=kb;en-us;Q312496](http://support.microsoft.com/default.aspx?scid=kb;en-us;Q312496)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T18:05:53.113

引用用户 Greg Dan 对问题的回答[What is the problem with this ajax(with prototype)？](https://stackoverflow.com/questions/517799/what-is-the-problem-with-this-ajaxwith-prototype/537443#537443)：

*前段时间我读到了 IE 和 Apache gzip 模块问题。它仅发生在服务器响应非常快的本地安装上。*

我自己从来没有尝试过这样的事情，最近才读到那个答案。也许它有帮助。

# objective-c - 我的 iphone 应用程序崩溃

> ID：575293
> 
> 赞同：0
> 
> 时间：2009-02-22T17:35:08.787
> 
> 标签：objective-c, iphone, cocoa-touch

我制作了一个应用程序，它应该一直运行，直到我停止它。它的基本作用是从连接的另一台设备获取一些数据，并使用 NSURLConnection 定期将这些数据发送到服务器，并定期从服务器读取数据并使用 NSXMLParser 将该数据可视化为图形。

我运行仪器检查分配和泄漏。完全没有泄漏。内存监视器显示一致的 5.2MB。Objectalloc 图是稳定的，objectallo 的净字节数约为 480000，#net 约为 6400。

问题是应用程序在大约 12 小时后停止（或崩溃）。有哪些可能的问题？我完全不知道从哪里开始找到问题，因为调试器和仪器都没有显示任何错误或问题。

[添加]

1\. 按照 Paul 的建议，我在模拟器上运行了我的应用程序，并在运行 5 小时后收到了一些错误消息。

```
InAir(64628,0xa050c720) malloc: *** error for object 0xc015bc87: Non-aligned pointer being freed
*** set a breakpoint in malloc_error_break to debug
InAir(64628,0xa050c720) malloc: *** error for object 0xa0200100: pointer being freed was not allocated
InAir(64628,0xa050c720) malloc: *** error for object 0x2080a043: pointer being freed was not allocated
InAir(64628,0xa050c720) malloc: *** error for object 0x120100: pointer being freed was not allocated
InAir(64628,0xa050c720) malloc: *** error for object 0x34a00000: pointer being freed was not allocated
InAir(64628,0xa050c720) malloc: *** error for object 0xc1d3a1b1: pointer being freed was not allocated
InAir(64628,0xa050c720) malloc: *** error for object 0x46b0a1b1: pointer being freed was not allocated
InAir(64628,0xa050c720) malloc: *** error for object 0xc1d3a1b1: pointer being freed was not allocated
Program received signal:  “EXC_BAD_ACCESS”. 
```

2\. 关于 NilObject 的评论...我不知道组织者有 crashlog。是的，它有。

```
Incident Identifier: 0ADC2722-BF4B-457F-A224-4A946810FB1F
CrashReporter Key:   f62c1dc12071b63c1e21d612962ee6aad74b4503
Process:         InAir [3154]
Path:            /var/mobile/Applications/9471A5CA-97E1-4E52-A934-9CE33DC5A5DB/InAir.app/InAir
Identifier:      InAir
Version:         ??? (???)
Code Type:       ARM (Native)
Parent Process:  launchd [1]

Date/Time:       2009-02-21 21:37:36.786 -0500
OS Version:      iPhone OS 2.2.1 (5H11a)
Report Version:  103

Exception Type:  EXC_BREAKPOINT (SIGTRAP)
Exception Codes: 0x00000001, 0xe7ffdefe
Crashed Thread:  0

Thread 0 Crashed:
0   libobjc.A.dylib                 0x300c8c18 objc_msgSend + 20
1   InAir                           0x00003d34 0x1000 + 11572
2   Foundation                      0x306942a0 __NSFireTimer + 132
3   CoreFoundation                  0x30269d88 CFRunLoopRunSpecific + 2642
4   CoreFoundation                  0x30269320 CFRunLoopRunInMode + 44
5   GraphicsServices                0x31567e58 GSEventRunModal + 268
6   UIKit                           0x30a4fa6c -[UIApplication _run] + 520
7   UIKit                           0x30a591d0 UIApplicationMain + 1132
8   InAir                           0x000020b6 0x1000 + 4278
9   InAir                           0x0000202c 0x1000 + 4140 

Thread 0 crashed with ARM Thread State:
    r0: 0x0013b920    r1: 0x301a2410      r2: 0x0013b920      r3: 0x301a2410
    r4: 0xc004ea47    r5: 0x001203d0      r6: 0x001203d0      r7: 0x2fffef50
    r8: 0x001203d0    r9: 0x394346d0     r10: 0x001063b0     r11: 0x00000f03
    ip: 0x0000a134    sp: 0x2fffeef8      lr: 0x00003d3b      pc: 0x300c8c18
  cpsr: 0x00000010 
```

（等等......整个日志都[在这里](http://www.wonderment.org/crashlog.txt)。）

谁能解释这些？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T06:55:06.647

您是否尝试`malloc_error_break`按照错误消息告诉您的方式设置断点？（运行→管理断点→​​添加符号断点）。

# qt - 如何摆脱 QDialog 中的调整大小句柄？

> ID：575294
> 
> 赞同：3
> 
> 时间：2009-02-22T17:35:20.363
> 
> 标签：qt, pyqt

我有以下课程：

```
class SelectDateDialog(QDialog):
    startDate = date.today()
    endDate = date.today()

    def __init__(self, text, isInterval = False):
        QDialog.__init__(self)
        uic.loadUi("resources/SelectDate.ui", self) 
```

现在，该对话框在 Mac OS X 10.5 上可以调整大小，但不应该如此。它在右下角有调整大小的句柄。

我已经尝试过这个`setSizeGripEnabled`功能，它没有改变任何东西。

我怎样才能使它不可调整大小？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-04-06T07:06:48.460

如果你想要一个不可调整大小的 QDialog dlg，那么设置

```
dlg.setWindowFlags(Qt::MSWindowsFixedSizeDialogHint); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-15T18:25:21.727

我使用以下代码来修复 a 的大小`QDialog`：

```
layout()->setSizeConstraint( QLayout::SetFixedSize ) ;
setSizeGripEnabled( false ) ; 
```

第一行根据布局中包含的小部件的首选大小强制布局大小。第二行删除了实际的抓地力。

要扭转这种情况，您可以在布局上设置默认约束并重新启用尺寸夹点。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T00:53:34.100

使窗口或对话框不可调整大小的最简单方法是将其布局的大小约束设置为 QLayout.SetFixedSize（或 C++ 中的 QLayout::SetFixedSize）。您只需对窗口中的主布局执行此操作 - 包含所有其他小部件和布局的布局。

我看到您正在使用 Qt Designer 为您的对话框创建用户界面。打开 .ui 文件并选择窗口，然后在属性编辑器中向下滚动，直到看到 Layout 部分。将 layoutSizeConstraint 属性设置为 SetFixedSize。

预览表单时，对话框内的小部件应正确排列，但您将无法调整对话框的大小。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T11:39:52.903

无论出于何种原因，我总是必须执行以下操作（在 Qt Designer 中）以绝对确保无法调整窗口大小：

```
sizePolicy -> Horizontal Policy = Fixed
sizePolicy -> Vertical Policy = Fixed

minimumSize -> Width = X
minimumSize -> Height = Y

maximumSize -> Width = X
maximumSize -> Height = Y 
```

请注意，我选择 X 和 Y 来说明**minimumSize == maximumSize**。当你这样做时，调整大小的句柄*应该*会自行消失，尽管我已经看到至少一个 Linux 发行版保留了句柄。在那种特殊情况下，我们只是隐藏了句柄，因为它无论如何都无法调整窗口大小。

# iphone - 如何将 UITableView 设置为分组？

> ID：575299
> 
> 赞同：1
> 
> 时间：2009-02-22T17:37:47.563
> 
> 标签：iphone, uitableview, interface-builder, xib

在基于 iPhone 导航的应用程序中，我想添加第二个 tableview，但它的设计在 IB 中可用。我添加了一个新的空 XIB 并将 UITableView 拖到它上面。我想通过 IB 设置布局。我已经为这个 tableview 创建了一个控制器，并将 IB 中的 File's Owner 类设置为这个控制器。我也将 tableview 链接到 File's Owner。我将 tableview 设置为在 IB 中分组。但是，这不会在运行时转换。我仍然有一个简单的表格视图。事实上，Inspector 设置在运行时都不起作用。我错过了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-02T01:40:14.710

确保在实例化视图控制器时使用`initWithNibName:bundle:`您创建的文件的名称。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-15T03:13:07.670

```
UITableView *myTableView = [[[UITableView alloc] initWithFrame:CGRectMake(0,80,320,480) style:UITableViewStyleGrouped]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-05T17:17:13.750

选择您的 tableview 并打开它的检查器。在检查器的第一个选项卡中，展开“TableView”，您应该会看到一个名为 Style 的选项。将其从“普通”更改为“分组”。

如果你找不到这个，试试你的 viewdidload tableView.style = UITableViewStyleGrouped

# vb.net - 当用户在 ToolStripTextBox (VB.NET) 中按下“Enter”

> ID：575311
> 
> 赞同：3
> 
> 时间：2009-02-22T17:46:54.313
> 
> 标签：vb.net, events, textbox

我有一个 ToolStripTextBox（它的名称是 SearchBox），当用户键入某些内容并按 Enter 后，我希望它会将它们带到一个 URL。我已经整理好了 URL 部分，但我需要知道之后会发生什么

```
Handles SearchBox.{what?} 
```

当用户按下“输入”时，我在智能感知弹出窗口中看不到任何事件。

所以，换句话说，我如何在用户按下回车后执行一个动作？

```
 Private Sub ToolStripComboBox1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles SearchBox.**?????**

    Dim SearchString As String
    SearchString = SearchBox.Text

    Dim URL As String
    URL = ("https://www.example.com/search.php?&q=" + SearchString)

    Process.Start(URL)
End Sub 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T18:14:35.417

得到它：

[在文本框的 keyup 事件中按下回车键后消除回车键](https://stackoverflow.com/questions/236675/eliminate-the-enter-key-after-pressing-it-in-the-keyup-event-of-a-textbox)

不准确，但有帮助。

```
 Public Sub SearchBox_KeyPress(ByVal sender As Object, ByVal e As KeyEventArgs) Handles SearchBox.KeyDown

    If e.KeyCode = Keys.Enter Then

        Dim SearchString As String
        SearchString = SearchBox.Text

        Dim URL As String
        URL = ("https://www.example.com/search.php?search=" + SearchString)

        Process.Start(URL)

    End If
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T17:52:46.827

您可以处理 SearchBox_KeyUp 或 SearchBox_KeyPress 事件。

看看这里：

[http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripcontrolhost.keyup.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripcontrolhost.keyup.aspx)

[http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripcontrolhost.keypress.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripcontrolhost.keypress.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T18:08:05.370

这是我的代码，按任意键会导致 URL 加载！

```
 Public Sub SearchBox_KeyPress(ByVal sender As Object, ByVal e As KeyPressEventArgs) Handles SearchBox.KeyPress

        Dim messageBoxVB As New System.Text.StringBuilder()
        messageBoxVB.AppendFormat("{0} = {1}", "Enter", e.KeyChar)
        messageBoxVB.AppendLine()

        Dim SearchString As String
        SearchString = SearchBox.Text

        Dim URL As String
        URL = ("https://www.example.com/search.php?search=" + SearchString)

        Process.Start(URL)
    End Sub
End Class 
```

如何检查**输入**？

# c - 耗尽 Intel Core 2 Duo 的指令流水线？

> ID：575317
> 
> 赞同：8
> 
> 时间：2009-02-22T17:52:52.160
> 
> 标签：c, assembly, x86, benchmarking, microbenchmark

我正在为 C 中的一些非常短的操作编写一些微基准测试代码。例如，我正在测量的一件事是根据传递的参数数量调用一个空函数需要多少个周期。

目前，我在每次操作之前和之后使用 RDTSC 指令进行计时，以获取 CPU 的循环计数。但是，我担心在第一个 RDTSC 之前发出的指令可能会减慢我正在测量的实际指令。我还担心在第二个 RDTSC 发布之前，完整的操作可能还没有完成。

有谁知道在发出任何新指令之前强制所有正在进行的指令提交的 x86 指令？我被告知 CPUID 可能会这样做，但我一直无法找到任何这样说的文档。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-22T18:05:48.963

据我所知，没有专门“耗尽”管道的指令。这可以通过使用序列化指令轻松完成。

CPUID 是一个序列化指令，这正是您要查找的内容。每条指令在保证在 CPUID 指令之前执行之前发出。

因此，执行以下操作应该会获得预期的效果：

```
cpuid
rdtsc
# stuff
cpuid
rdtsc 
```

但是，顺便说一句，我不建议您这样做。您的“东西”仍然会受到您无法控制的许多其他事物的影响（例如 CPU 缓存、系统上运行的其他进程等），您永远无法将它们全部消除。获得准确的性能统计信息的最佳方法是执行您想要测量至少几百万次的操作并平均批处理的执行时间。

**编辑：** CPUID 的大多数指令参考都会提到它的序列化属性，例如[NASM 手册附录 B](http://webster.cs.ucr.edu/AsmTools/NASM/Doc/NASMDOCA.HTM#section-A.29)。

**编辑 2**：也可能想看看[这个相关的问题](https://stackoverflow.com/questions/505738/how-to-accurately-measure-clock-cycles-used-by-a-c-function/)。

# c# - Assigning Roles to Users

> ID：575318
> 
> 赞同：2
> 
> 时间：2009-02-22T17:53:20.583
> 
> 标签：c#, .net, wpf, database, linq-to-sql

I'm having trouble figuring out how to assign roles to users. I've got the log in mechanism working, but need to figure out how to use roles defined to give users certain access.

I have a database with these tables:

```
                     Tables
                     ------
   UserTbl          RolesTbl           UserInRoleTbl
   -------         ----------          -------------
 UserID  (PK)      RoleId  (PK)        ID       (PK)
 Name              RoleName            UserId
 UserName          Description         RoleId
 Password
 Email

```

With this small database I'm testing the ability to assign roles to the user.

I'm using `LINQtoSQL` to act as the Data Access Layer. I've created the login mechanism to login to the software, and then I get stuck on what to do next.

For Example:

> `username = admin,password= admin, RoleId = 1 ;Rolename =Administrator;`

And then I use the following code after the login to get the role:n

```
public partial class Window3 : Window
{  

    public Window3()
    {
        InitializeComponent();

        GenericIdentity My2 = new GenericIdentity("admin");

        string[] roles1 = { "Administrator" };

        GenericPrincipal principal1 = new GenericPrincipal(My2, roles1);
        Thread.CurrentPrincipal = principal1;
     }

private void LoadWindow(object sender, RoutedEventArgs e)
    {   if (Thread.CurrentPrincipal.IsInRole("Administrator"))
        {
             exercise.Visibility = Visibility;
              tot.IsEnabled = false;
        } 
```

}

I implement the code role but there is no connection with database; instead I want to store the role from the database,create a method in C# and write down a code that after user's login to get access to the application.

To explain further: I gave `Rolename = Administrator` so if the user is admin he'll get this role, but I'm unsure how to retreive this information from the database and tie it to the user. Can anyone assist me?

### Related (or possible duplicate) questions by Same User:

> [Username and role](https://stackoverflow.com/questions/550667/username-and-role)
> [Forms Authenticate](https://stackoverflow.com/questions/544517/forms-authenticate)
> [How create role to put in the database?](https://stackoverflow.com/questions/557791/how-create-role-to-put-in-the-database)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T18:08:13.917

Sorry, I find your question a little confusing.

You seem to want to have two tables, User and Role, with a many-to-many join table, UserRole, in between. User and Role must both have primary keys, both of which appear in the join table.

```
create table user
(
    user_id int not null, 
    -- other fields here, like username, password, etc.
    primary key(user_id)
);

create table role
(
    role_id int not null,
    -- other fields here, like role name, etc.
    primary key(role_id)
);

create table user_role
(
    user_id int not null,
    role_id int not null,
    primary key(user_id, role_id),
    foreign key(user_id) references(user),
    foreign key(role_id) references(role)
); 
```

When you query for a user to see if they're authorized, you're joining the many-to-many table to bring back all the potential roles at the same time. If the credential you supply includes a role, your authorization code should check to make sure that it's a member of the set of potential roles at that time.

One minor bit of advice: Leave the "Tbl" out of your table names. They're redundant, in my opinion.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T06:56:02.903

If you have the "UserTbl" and "RolesTbl" in your database, you should also have two classes called "UserTbl" and "RolesTbl" in your LINQ-to-SQL model.

To store a role in the database, instantiate one of thouse "RolesTbl" objects, set it's properties, and then add it to the LINQ data context. Same with the "UserTbl" object.

EDIT: here's the code sample requested - assuming you have set up your database, your LINQ-to-SQL model and used all the default names:

```
// create the LINQ-to-SQL Data context
UsersAndRolesDataContext dc = new UsersAndRolesDataContext();

// create new instace of "UserTbl" object
UserTbl newUser = new UserTbl();
newUser.UserID = "newuser";
newUser.Name = "Some NewUser";
newUser.EMail = "newuser@somewhere.org";
newUser.Password = "TopSecret";

// add new user to the table of users in the data context
dc.UserTbls.InsertOnSubmit(newUser);

// create new instance of a role
RolesTbl newRole = new RolesTbl();
newRole.RoleId = "ADMIN";
newRole.RoleName = "Administrators";
newRole.Description = "User with administrative rights";

// add new role into LINQ-to-SQL Data context
dc.RolesTbls.InsertOnSubmit(newRole);

// write out all changes back to database
dc.SubmitChanges(); 
```

Does that help at all?

Marc

# python - 连续调用 cProfile/pstats 没有正确更新

> ID：575325
> 
> 赞同：1
> 
> 时间：2009-02-22T17:56:42.293
> 
> 标签：python

我正在尝试连续调用一些分析器代码，但是在第二次调用该函数时，配置文件的更新时间会发生变化，但实际的分析器统计信息保持不变。这不是我正在运行的代码，但它是我可以想出的一个简化的示例，它显示了相同的行为。

运行时，第一次按 ctrl+c 时显示统计信息，第二次按相同的东西，但不是按预期完全更新，只是时间是，第三次程序实际上退出了。如果尝试，最好在 ctrl+c 按下之间等待几秒钟。

在第 8 行之后添加 profiler.enable() 确实在调用之间提供了完整的更新，但是它为我不想分析的东西添加了很多额外的分析器数据。

对于我获得完整更新但没有额外绒毛的快乐媒体有什么建议吗？

```
import signal, sys, time, cProfile, pstats

call = 0

def sigint_handler(signal, frame):
global call
if call < 2:
    profiler.dump_stats("profile.prof")
    stats = pstats.Stats("profile.prof")
    stats.strip_dirs().sort_stats('cumulative').print_stats()
    call += 1
else:
    sys.exit()
def wait():
time.sleep(1)

def main_io_loop():
signal.signal(signal.SIGINT, sigint_handler)
while 1:
    wait()

profiler = cProfile.Profile()
profiler.runctx("main_io_loop()", globals(), locals()) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T00:37:41.593

调用 profiler.dump_stats（在 cProfile.py 中实现）调用 profiler.create_stats，而后者又调用 profiler.disable()。

您需要调用 profiler.enable() 使其再次工作。不，这没有记录。

以下似乎做你想做的事。请注意，我摆脱了中间数据文件，因为 pstats.Stats 知道如何直接从探查器获取数据。

```
import signal, sys, time, pstats, cProfile

call = 0

def sigint_handler(signal, frame):
  global call
  if call < 2:
    stats = pstats.Stats(profiler)
    stats.strip_dirs().sort_stats('cumulative').print_stats()
    profiler.enable()
    call += 1
  else:
    sys.exit()

def wait():
  time.sleep(1)

def main_io_loop():
  signal.signal(signal.SIGINT, sigint_handler)
  while 1:
    wait()

profiler = cProfile.Profile()
profiler.runctx("main_io_loop()", globals(), locals()) 
```

# c - fcntl，lockf，哪个更好用于文件锁定？

> ID：575328
> 
> 赞同：48
> 
> 时间：2009-02-22T18:01:47.287
> 
> 标签：c, linux, file, locking

寻找有关***fcntl***和**lockf**用于文件锁定的**优缺点**的***信息。***例如，哪个更适合便携性？我目前正在编写一个 linux 守护程序，想知道哪个更适合用于强制互斥。

 ***** * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-02-22T18:11:53.317

**lockf和fcntl有什么区别：**

在许多系统上，`lockf()`库例程只是对`fcntl()`. 也就是说，`lockf`提供了功能的一个子集`fcntl`。

[来源](http://www.cs.albany.edu/~sdc/Linux/linux/Documentation/mandatory.txt)

但是在某些系统上，`fcntl`锁`lockf`是完全独立的。

[来源](http://www.mjmwired.net/kernel/Documentation/filesystems/locks.txt)

由于它依赖于实现，因此请确保始终使用相同的约定。因此，要么始终从您的两个进程中使用 lockf，要么始终使用 fcntl。它们很有可能可以互换，但使用同一个更安全。

你选择哪一个并不重要。

* * *

**关于强制锁和建议锁的一些说明：**

默认情况下，在 unix/linux 中锁定是**建议**性的，这意味着其他进程不需要遵循设置的锁定规则。因此，您锁定哪种方式并不重要，只要您的合作流程也使用相同的约定即可。

Linux 确实支持**强制**锁定，但前提是您的文件系统安装时使用了选项 on 并设置了文件特殊属性。您可以使用`mount -o mand`挂载文件系统并设置文件属性`g-x,g+s`以启用强制锁，然后使用`fcntl`或`lockf`。有关强制锁如何工作的更多信息，请参见[此处](http://linux.die.net/man/2/fcntl)。

请注意，锁不是应用于单个文件，而是应用于 inode。这意味着指向相同文件数据的 2 个文件名将共享相同的锁定状态。

另一方面，在 Windows 中，您可以主动以独占方式打开文件，这将阻止其他进程完全打开它。即使他们愿意。即，锁是强制性的。Windows 和文件锁也是如此。任何具有适当访问权限的打开文件句柄的进程都可以锁定文件的一部分，并且没有其他进程能够访问该部分。

* * *

**Linux 中强制锁的工作原理：**

关于强制锁，如果一个进程用读锁锁定文件的一个区域，那么其他进程可以读取但不能写入该区域。如果一个进程用写锁锁定了文件的一个区域，那么其他进程就不能读取或写入该文件。当不允许进程访问文件的一部分时会发生什么取决于您是否指定`O_NONBLOCK`。如果设置了阻塞，它将等待执行操作。如果没有设置阻塞，你会得到一个错误代码`EAGAIN`。

* * *

**NFS 警告：**

如果您在 NFS 挂载上使用锁定命令，请小心。该行为是未定义的，并且无论是仅使用本地锁还是支持远程锁，实现都存在很大差异。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-22T18:25:25.157

这两个接口都是 POSIX 标准的一部分，现在这两个接口在大多数系统上都可用（我刚刚检查了 Linux、FreeBSD、Mac OS X 和 Solaris）。因此，请选择更适合您的要求并使用它。

提醒一句：当一个进程使用 fcntl 锁定一个文件而另一个使用 lockf 锁定文件时会发生什么是未指定的。在大多数系统中，这些是等效的操作（实际上在 Linux 下 lockf 是在 fcntl 之上实现的），但 POSIX 表示它们的交互是未指定的。因此，如果您正在与使用两个接口之一的另一个进程进行互操作，请选择相同的一个。

其他人写道，锁只是建议性的：您负责检查一个区域是否被锁定。此外，如果您想使用锁定功能，请不要使用 stdio 功能。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-22T18:26:08.290

在这种情况下（即“**编写 Linux 守护程序**并想知道哪个更适合**用于强制互斥**”），您的主要关注点应该是：

1.  锁定的文件是本地的还是可以在 NFS 上？
    *   例如，用户可以欺骗您在 NFS 上创建和锁定您的守护进程的 pid 文件吗？
2.  `fork`当ing 或当守护进程以极端偏见终止时，锁将如何表现`kill -9`？

`flock`和命令在这两种情况下的`fcntl`行为不同。

我的建议是使用`fcntl`. 您可以参考 [Wikipedia 上的文件锁定文章，](http://en.wikipedia.org/wiki/File_locking#Problems)深入讨论这两种解决方案所涉及的问题：

> flock 和 fcntl 都有一些怪癖，这些怪癖有时会让其他操作系统的程序员感到困惑。群锁是否在网络文件系统（如 NFS）上工作取决于实现。在 BSD 系统上，群呼是成功的无操作。在 2.6.12 之前的 Linux 上，对 NFS 文件的群呼调用只会在本地执行。内核 2.6.12 及更高版本使用 POSIX 字节范围锁在 NFS 文件上实现群调用。这些锁将对实现 fcntl()/POSIX 锁的其他 NFS 客户端可见。[1](http://en.wikipedia.org/wiki/File_locking#Problems) Lock upgrades and downgrades release the old lock before applying the new lock. If an application downgrades an exclusive lock to a shared lock while another application is blocked waiting for an exclusive lock, the latter application will get the exclusive lock and the first application will be locked out. All fcntl locks associated with a file for a given process are removed when any file descriptor for that file is closed by that process, even if a lock was never requested for that file descriptor. Also, fcntl locks are not inherited by a child process. The fcntl close semantics are particularly troublesome for applications which call subroutine libraries that may access files.

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2014-09-17T14:31:26.417

我最近在使用 fcntl 和 flock 时遇到了一个问题，我觉得我应该在这里报告，因为搜索任何一个术语都会在两者的顶部附近显示此页面。

请注意，如上所述，BSD 锁是**建议**性的。对于那些不知道 OSX (darwin) 是 BSD 的人。打开要写入的文件时必须记住这一点。

要使用 fcntl/flock，您必须首先打开文件并获取其 ID。但是，如果您使用“w”打开文件，该文件将立即**清零**。如果您的进程由于文件在其他地方使用而未能获得锁定，它很可能会返回，将文件保留为 0kb。拥有锁的进程现在会发现文件已经从它下面消失了，通常会带来灾难性的结果。

为了纠正这种情况，当使用文件锁定时，**永远不要**打开文件“w”，而是打开它“a”，以追加。然后，如果成功获取了锁，您就可以像“w”那样安全地清除文件，即。：

fseek(fileHandle, 0, SEEK_SET);//移动到开头

ftruncate(fileno((FILE *) fileHandle), 0);//清除

这对我来说是一个不愉快的教训。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T18:08:58.347

由于您只是在编写一个将其用于互斥的守护程序，因此它们是等效的，毕竟您的应用程序只需要与自身兼容。

文件锁定机制的诀窍是保持一致——使用一个并坚持下去。改变它们是一个坏主意。

我在这里假设文件系统将是本地文件系统 - 如果不是，那么所有的赌注都关闭，NFS / 其他网络文件系统以不同程度的有效性处理锁定（在某些情况下没有）

# java - 如何检测变量何时更改值

> ID：575336
> 
> 赞同：79
> 
> 时间：2009-02-22T18:06:12.330
> 
> 标签：java, eclipse, debugging, variables

如何轻松检测变量何时更改值？我希望程序的执行在指定变量更改值时在调试器上中断。现在我正在使用 Eclipse 的调试器。

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2009-02-22T18:16:53.647

对于类或实例变量

1.  右键单击大纲视图中的变量
2.  选择“切换观察点”
3.  然后，在 breapkoints 视图中，您可以右键单击生成的条目
4.  选择“断点属性”
5.  取消选择“字段访问”。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2014-01-09T08:20:49.920

或在声明变量的行上切换断点，然后右键单击结果条目，选择“断点属性”并取消选择“字段访问”。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2019-06-30T11:37:13.640

我不确定 Eclipse，但在 IntelliJ IDEA 中，您可以右键单击断点并添加条件，就像在`if`语句中一样。然后，如果条件为真，调试器只会在断点处暂停。

例如，[在这种情况下](https://i.stack.imgur.com/JTEpe.png)，它仅在 时停止`min == 4`。

# java - 优化 java.util.Map/Set 中的插入速度

> ID：575340
> 
> 赞同：5
> 
> 时间：2009-02-22T18:07:00.130
> 
> 标签：java, algorithm, collections, insert, performance

有没有办法通过指定项目的顺序来优化 java.util.Collection 中的插入速度？

例如

```
java.util.Set<String> set = java.util.TreeSet<String>(); 
```

将这个解决方案：

```
set.add("A");
set.add("B");
set.add("C");
set.add("D");
set.add("E"); 
```

比这个更快（随机顺序）？

```
set.add("E");
set.add("D");
set.add("C");
set.add("A");
set.add("B"); 
```

（以及其他集合的相同问题：HashMap，hastable ...）

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-22T18:11:33.520

简单的答案是“时间看看”。

另一个答案是“没关系”。这似乎是一个微优化，几乎不值得付出努力。我认为它属于[“微优化剧院的悲惨悲剧”](http://www.codinghorror.com/blog/archives/001218.html)的范畴。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-22T18:15:37.440

java.util.Map 和 java.util.Set 不行，因为它们是接口，有不同的实现。

对于具体的实现，这不是值得的优化。如果您在性能方面遇到问题，请选择更合适的实现，或者重新考虑您需要存储什么以及如何存储。

在一台普通的笔记本电脑上，将 5000 个随机数插入 HashSet 大约需要一毫秒，那么您要插入多少百万个元素才能使这种优化变得有价值？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-22T18:11:16.437

[红黑树](http://en.wikipedia.org/wiki/Red-black_tree)（用于实现 Java 的[TreeSet/TreeMap](http://java.sun.com/j2se/1.5.0/docs/api/java/util/TreeMap.html) ）的插入时间保证最坏情况为 O(log n)。如果项目按特定顺序排列可能会更快，但我不确定那会是什么（可能预排序最快？）。

插入哈希表是 O(1)（恒定时间）操作。插入的主要工作是计算[hashcode](http://java.sun.com/j2se/1.3/docs/api/java/lang/Object.html#hashCode())。

* * *

编辑：Starblue 建议预排序可能会产生最差的性能，因此您可以尝试随机排序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-22T18:14:03.157

基于散列的集合和基于树的集合之间自然存在巨大差异。

基于树的对象受益于插入的元素排序（例如，字符串之间的比较），因此当您有可比较的对象（如字符串）时，最好使用它们。TreeSet/TreeMap/等。在标准集合中应该是平衡的（红黑树），所以插入顺序并不重要。如果它不平衡，那么插入顺序就会很重要，因为您最终可能会得到一个链而不是树。

在哈希表中，加载因子和哈希函数决定了一切，但如果您正在处理字符串，您可能甚至不打扰哈希会更好。

如果您需要一组字符串来处理许多重叠的字符串，Trie 可能会更节省内存，但我认为库中没有。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T18:53:14.310

在采取优化措施时要小心考虑数据结构的特征。举一个极端的例子，将元素按排序顺序插入二叉树会产生一个链表。

# php - 如何通过命令行运行 php 脚本（并在注销后保持运行）

> ID：575345
> 
> 赞同：10
> 
> 时间：2009-02-22T18:10:05.940
> 
> 标签：php, debian, putty, remote-server

我正在尝试通过命令行在我的远程虚拟专用服务器上运行 php 脚本。我遵循的过程是：

1.  使用 PuTTY 登录服务器
2.  在命令行提示符下，键入 > php myScript.php

脚本运行得很好。但问题是，一旦我关闭 PuTTY 控制台窗口，脚本就会停止运行。

我需要脚本继续无休止地运行。我怎样才能做到这一点？我在服务器上运行 Debian。

提前致谢。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-22T18:30:33.240

我相信 Ben 有正确的答案，即使用 nohup 命令。nohup 代表 nohangup 并且意味着您的程序应该忽略一个挂断信号，该信号是在您注销或因为您已超时而断开腻子会话时生成的。

您需要注意，命令的输出将附加到当前目录中名为 nohup.out 的文件（如果权限阻止您在当前目录中创建 nohup.out，则为 $HOME/nohup.out）。如果您的程序生成大量输出，则此文件可能会变得非常大，或者您可以使用 shell 重定向将脚本的输出重定向到另一个文件。

```
nohup php myscript.php >myscript.output 2>&1 & 
```

此命令将运行您的脚本并将所有输出（标准和错误）发送到文件 myscript.output，每次运行程序时都会重新创建该文件。

最后的 & 使脚本在后台运行，因此您可以在它运行或注销时执行其他操作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-22T18:12:20.087

一个简单的方法是通过 nohup 运行它：

```
nohup php myScript.php & 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-22T18:14:33.980

如果您在 a 中运行 php 命令`[screen](http://www.linuxjournal.com/article/6340)`，分离`screen`，那么当您关闭控制台时它不会终止。

> Screen 是一个终端多路复用器，允许您通过一个物理终端管理多个进程。每个进程都有自己的虚拟窗口，您可以在与每个进程交互的虚拟窗口之间跳转。screen 管理的进程在它们的窗口不活动时继续运行。

# c - 为什么设置 -std=c99 时 gcc 找不到 random() 接口？

> ID：575350
> 
> 赞同：18
> 
> 时间：2009-02-22T18:12:12.940
> 
> 标签：c, gcc, random, c99, c89

我`"#include <stdlib.h>"`在源代码的顶部做。

示例编译：

```
/usr/bin/colorgcc -std=c99 -fgnu89-inline  -g -Wall -I/usr/include -I./ -I../ -I../../ -I../../../ -I../../../../    -O3 -o f8  f8.c
In file included from f8.c:7:
ctype-cmp.c: In function ‘randomized’:
ctype-cmp.c:48: warning: implicit declaration of function ‘random’
ctype-cmp.c: In function ‘main’:
ctype-cmp.c:153: warning: implicit declaration of function ‘srandom’
ais@xcalibur:t$ 
```

当我关闭 -std=c99 时，找不到函数 isfinite()。因此，出于这个和其他原因，我确实想使用 -std=c99 。有什么我错过的技巧吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-22T18:39:16.573

`man srandom`表示该函数*不是*C99 的一部分，而是 POSIX 的一部分。

激活`_BSD_SOURCE`或`_XOPEN_SOURCE >= 500`声明 srandom/random 函数的任何其他合适的功能测试宏（参见`man feature_test_macros`和`man srandom`）。

这个有很好的机会，但是您还需要通过阅读上面的手册页来找出隐式定义/未定义的宏。

```
/usr/bin/colorgcc -std=c99 -D_XOPEN_SOURCE=600 -fgnu89-inline -g -Wall 
    -I/usr/include -I./ -I../ -I../../ -I../../../ -I../../../../ -O3 -o f8  f8.c 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-07-06T01:46:44.760

是的，您缺少一个技巧：您可以使用`-std=gnu99`而不是`-std=c99`.

`-std=c99` `#define`s `__STRICT_ANSI__`，它`/usr/include/features.h`解释为“默认情况下不启用 C 标准之外的任何东西”（没有它，您至少会同时得到`_SVID_SOURCE`and `_BSD_SOURCE`）。`-std=gnu99`，另一方面，表示“C99 加 GNU 扩展”（gcc 默认是当前`-std=gnu89`，它的 C89 等效项，这就是为什么您需要指定一些东西来获得新的 C99 功能）。

作为替代方案，您可以启用功能测试宏（如@litb 的回答中所述）。`/usr/include/stdlib.h`在我的系统中查看，它需要`__USE_SVID`,`__USE_XOPEN_EXTENDED`或`__USE_BSD`. `/usr/include/features.h`告诉我启用这些功能的功能测试宏是：

*   `_SVID_SOURCE`（启用`__USE_SVID`）
*   `_BSD_SOURCE`（启用`__USE_BSD`）
*   `_XOPEN_SOURCE`值至少为`500`(enables `__USE_XOPEN_EXTENDED`)
*   `_XOPEN_SOURCE_EXTENDED`（也启用`__USE_XOPEN_EXTENDED`）
*   `_GNU_SOURCE`（启用一切，包括上面的四个功能测试宏）

对于您不太担心与未来标准中的新功能的潜在名称冲突的新程序，同时使用`-std=gnu99`和`-D_GNU_SOURCE`是一个好主意。它允许您使用所有新的标准功能和 GNU 扩展，结合某种回退（例如，`autoconf`-style 功能测试）提供了最大的灵活性。

参考：

*   [控制 C 方言的选项](http://gcc.gnu.org/onlinedocs/gcc-4.4.0/gcc/C-Dialect-Options.html)
*   [功能测试宏](http://www.gnu.org/software/libc/manual/html_node/Feature-Test-Macros.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-17T15:44:16.220

我在 Ubuntu 9.10 下的 CodeBlocks 中使用 gcc 创建了随机数（带有编译器选项：）`-std=gnu99 -D_GNU_SOURCE`所以这对我有用：

这是我玩过的代码：

```
#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <time.h>
enum computer {keyboard, CPU, screen, printer};
int main(void)
{
  enum computer comp;
  time_t casovac;
  comp = CPU;
  srand(&casovac);
  printf("%d", rand());
  return 0;
} 
```

这只是一个想法，当然你可以通过其他方式来完成它;-) [要安装 CodeBlocks，请使用：`sudo apt-get install build-essential`然后`sudo apt-get install codeblocks`]

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-22T18:23:57.530

我使用 rand() 和 srand()。顺便说一句：你忘了一两个标题吗？至少第二个警告是这样告诉我的。

尝试包括 math.h。（只记得我们总是遇到数学库问题，并且必须实际强制将其与 -lm 链接）。

# c# - 正则表达式错误c#？

> ID：575359
> 
> 赞同：0
> 
> 时间：2009-02-22T18:14:55.447
> 
> 标签：c#, regex

我如何使用 "/show_name=(. *?)&show_name_exact=true\">(.* ?)

```
 Match m = Regex.Match(input, "/show_name=(.*?)&amp;show_name_exact=true\">(.*?)</i", RegexOptions.IgnoreCase);
   // Check Match instance
    if (m.Success)
    {
        // Get Group value
        string key = m.Groups[1].Value;
        Console.WriteLine(key);
        // alternate-1
    } 
```

错误，未终止的字符串文字（CS1039）] 错误，常量中的换行符（CS1010）]

我做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T21:11:39.623

我认为您将 .NET 的正则表达式语法与 PHP 的语法混为一谈。除了 C# 字符串文字所需的引号外，PHP 还要求您使用正则表达式分隔符。例如，如果您想在 PHP 中不区分大小写地匹配“foo”，您可以使用如下内容：

```
'/foo/i' 
```

...但是 C# 不需要额外的正则表达式分隔符，这意味着它不支持 /i 样式来添加匹配修饰符（无论如何这都是多余的，因为您也在使用该`RegexOptions.IgnoreCase`标志）。我想这就是你要找的：

```
@"show_name=(.*?)&amp;show_name_exact=true"">(.*?)<" 
```

还要注意我是如何使用另一个引号而不是反斜杠来转义内部引号的。无论您使用老式的字符串文字语法还是带有前导“@”的 C# 逐字字符串（强烈建议编写正则表达式），都必须这样做。这就是您收到未终止字符串错误的原因。

# .net - 更新 .NET Compact Framework - 什么时候？

> ID：575360
> 
> 赞同：0
> 
> 时间：2009-02-22T18:15:05.883
> 
> 标签：.net, windows-mobile, compact-framework

众所周知，上周在巴塞罗那举行的世界移动通信大会上，微软展示了 Windows Mobile 6.5 的“测试版”，它可能会在今年晚些时候推出。

我在网上阅读了很多关于这次大会和 Windows Mobile 6.5 新功能的文章，但我没有发现任何迹象表明 .NET Compact Framework（目前为 3.5）是否也会更新。

你们有没有人想分享这方面的任何新闻/更新？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T09:07:31.690

我的猜测是你不应该屏住呼吸。我真的不认为 6.5 有任何关于 .NET CF 的新内容，但对于 7.0，我会说新的 .NET CF 将在 ROM 中。

# php - 如何为我的网站创建电子邮件联系表

> ID：575366
> 
> 赞同：0
> 
> 时间：2009-02-22T18:16:41.650
> 
> 标签：php, email, forms, sendmail, contact

我希望在我的网站上创建一个表单，用户可以在其中输入他们的电子邮件地址和消息（无论多长）。然后单击提交按钮，代码将消息作为电子邮件发送到我的邮箱。

我想知道是否有人知道我可以使用什么代码。我使用 PHP 作为我的服务器端语言。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-22T18:21:18.660

您需要在某处访问 smtp 服务器。假设你这样做，使用 php mail 函数发送邮件，如下所示：

```
$Name = "John doe"; //senders name 
$email = "email@adress.com"; //senders e-mail adress 
$recipient = "recipient@emailadress.com"; //recipient 
$mail_body = "The text for the mail..."; //mail body 
$subject = "Subject for receiver"; //subject 
$header = "From: ". $Name . " <" . $email . ">\r\n"; //optional headerfields

mail($recipient, $subject, $mail_body, $header); 
```

smtp 服务器在 php.ini 文件中的这两行中设置：

```
SMTP = servername
smtp_port = 25 
```

更多信息请访问[w3schools 网站](http://www.w3schools.com/PHP/php_mail.asp)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T19:04:36.387

虽然上述两个答案提供了基本的电子邮件发送建议，但您应该考虑一件事，代码不安全。垃圾邮件发送者可以注入抄送：代码并使用表单发送垃圾邮件。如果他们这样做，您的 smtp 提供商可能会禁止您的帐户。尝试专用邮件程序，例如[phpmailer](http://phpmailer.codeworxtech.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-05T19:25:29.767

尝试使用**PHPForms**。它是一个终极的 Web[表单构建器](http://phpforms.net/tutorial/html-basics/form-builder.html)，可以在几分钟内创建具有专业外观的电子邮件表单。您只需要通过直观的界面创建一个 PHP 表单并生成可以轻松复制并粘贴到任何网页的代码。

# iphone - iPhone Bug App bug 问题和挑战

> ID：575371
> 
> 赞同：0
> 
> 时间：2009-02-22T18:17:21.197
> 
> 标签：iphone, objective-c, cocoa-touch

好的，所以我的应用程序中有一个非常烦人的错误。这让我发疯，我确信这超出了我的技能水平，因为我正在学习。

以下是该错误的初步概要：[A shot in the dark - 应用程序错误](https://stackoverflow.com/questions/573837/a-shot-in-the-dark-application-bug)

但是我找到了一种方法来一致地重现错误（仅在设备上而不是在模拟器中）

首先，您创建一个新池并保存它。然后在一天中添加 20 个空白时间。保存它，这就是问题开始的地方。（当您返回主要详细视图时，tableview 已将自己退出编辑模式，并被告知这样做）。现在，如果您回到当天查看刚刚添加的时间条目，它们仍然存在。

如果您返回到列出所有池的主整体表格视图，现在返回到您添加它们消失的时间的那一天。

加一次，一切都很好。添加二十，它不保存。哇！！

主菜单列表池：

![https://farm4.static.flickr.com/3503/3301053744_0325d5bc2c.jpg?v=0](https://farm4.static.flickr.com/3503/3301053744_0325d5bc2c.jpg?v=0)

详细视图：

![https://farm4.static.flickr.com/3546/3300222271_223d2c74e9.jpg?v=0](https://farm4.static.flickr.com/3546/3300222271_223d2c74e9.jpg?v=0)

编辑视图：

![https://farm4.static.flickr.com/3625/3300222887_b02c3e2052.jpg?v=0](https://farm4.static.flickr.com/3625/3300222887_b02c3e2052.jpg?v=0)

时间编辑视图：

![https://farm4.static.flickr.com/3547/3301056092_8d3ab78225.jpg?v=0](https://farm4.static.flickr.com/3547/3301056092_8d3ab78225.jpg?v=0)

添加时间：

![https://farm4.static.flickr.com/3635/3300224157_14c30cf58f.jpg?v=0](https://farm4.static.flickr.com/3635/3300224157_14c30cf58f.jpg?v=0)

我会很感激任何更多的猜测。但除了这个问题之外，我还悬赏 25 英镑（对不起，我是个穷学生）给任何有能力先修复这个 bug 的人！

如果您感兴趣，我的电子邮件是 danmorgz[at]gmail.com

谢谢，

担

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T00:18:30.463

如果您还没有这样做，我建议您打开[`NSZombie`](http://developer.apple.com/iphone/library/documentation/Xcode/Conceptual/iphone_development/130-Debugging_Applications/chapter_7_section_3.html#//apple_ref/doc/uid/TP40007959-CH7-SW3)支持并查看在它们被释放后您是否正在使用您的任何对象。据我所知，这可以在模拟器和设备上打开。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T17:10:51.810

Thanks for all your answers. It's now fixed.

For those interested I'd forgotten to add a cellidentifer in the XIB of my cell subclass.

cellForRow: method was therefore creating a new cell every time. The memory got filled up very quick. It then seemed as though my app was automatically trying to cut the fat by forcing another tableView out of editing mode and not managing my instances properly.

Again it's a memory problem. Isn't this always the case!?!

The clue was a one off 101 error in the console indicating my app was using too much memory. Oh and a slow scrolling tableView.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T19:00:55.810

最有可能的是，您未能在沿途某处保留一些对象。当一个对象被释放，然后内存被重新用于其他东西时，你会得到各种各样的不良行为，包括崩溃，或者其他对象神秘的“消失”。

您可以尝试的一件事是将断点放入自定义类的 -dealloc 方法中。然后你可以看到他们从哪里被释放。不过，最有可能的是，这最终会发生在 AutoreleasePool 耗尽时，这不会告诉你太多。

或者，考虑使用[Cocoa 中内置的一些内存调试工具](http://developer.apple.com/technotes/tn2004/tn2124.html#SECFOUNDATION)。

该文档适用于 Mac OS X，但我认为至少所有这些都可以在 iPhone 模拟器中运行。我知道您的错误在模拟器中“不会发生”，但这实际上仅意味着症状不同，而您没有注意到它们。

# php - 按 id 但向后调用 db 行

> ID：575376
> 
> 赞同：0
> 
> 时间：2009-02-22T18:19:43.750
> 
> 标签：php, mysql

我正在建立一个链接投票站点，在第二次对链接进行投票后，公式可以正常工作，问题是当链接只有 1 票时，它会从最旧到最新显示向后。

我想要的是从最新到最旧的一票链接。这是调用首页中链接的行：

```
$articles = Article::getAll("order by ranking desc limit $offset, $num_items"); 
```

这是 getAll 函数代码：

```
static function getAll($conditions = ' ')
    {
        /* Retrieve all the records from the
         * database according subject to
         * conditions
         */

        $db = null;
        $results = null;
        $records = array();
        $query = "select id, created, modified, username, url, title, description, points, ranking from articles $conditions";
        try
        {
            $db = parent::getConnection(); 
            $results = parent::execSql($query);

            while($row = $results->fetch_assoc())
            {
                $r_id = $row['id'];
                $r_created = $row['created'];
                $r_modified = $row['modified'];

                $r_title = $row['title'];
                $r_description = $row['description'];

                if(!get_magic_quotes_gpc())
                {
                    $r_title = stripslashes($r_title);
                    $r_description = stripslashes($r_description);
                }

                $r_url = $row['url'];
                $r_username = $row['username'];
                $r_points = $row['points'];
                $r_ranking = $row['ranking'];

                $article = new Article($r_title, $r_description , $r_url, $r_username, $r_created, $r_modified);
                $article->id = $r_id;
                $article->points = $r_points;
                $article->ranking = $r_ranking;
                $records[] = $article;
            }
            parent::closeConnection($db);
        }
        catch(Exception $e)
        {
            throw $e;
        }

        return $records;
    } 
```

如果有人可以提供帮助，我将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T18:27:21.127

在条款中添加`created`日期怎么样`order`？

```
$articles = Article::getAll("order by ranking desc, created desc limit $offset, $num_items"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T20:00:46.847

我会按照大卫所说的做，只是如果你想要按最新排序的链接，那么你必须按降序添加“创建”列：

```
$articles = Article::getAll("order by ranking desc, created DESC limit $offset, $num_items"); 
```

# .net - Visual Studio 2008 构建依赖链

> ID：575381
> 
> 赞同：4
> 
> 时间：2009-02-22T18:21:48.223
> 
> 标签：.net, vb.net, visual-studio, visual-studio-2008

我在使用 Visual Studio 2008 SP1 时遇到问题。基本上，我有一个带有客户端、共享和服务器组件的 .NET 3.5 解决方案。在编码时，所有组件都在同一个盒子上运行，但在生产中，服务器组件是在单独的服务器上运行的独立（远程）服务。

我希望对客户端组件的更改只需要重建该组件，因为没有客户端/服务器依赖性。这实际上是它在我的工作 PC 上的工作方式。但是，在我的个人 PC 和另一位同事的 PC 上，任何修改 - 甚至是客户端上的简单标签更改，都需要停止服务器组件服务，以便可以完全重建解决方案。有谁知道是否有控制这个的特定设置？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-07T18:33:59.147

好的，伙计们。这个问题比我起初想的要简单。在这没有按预期工作的 PC 上，我必须打开名为“仅在运行时构建启动项目和依赖项”的 Visual Studio 设置（选项->项目和解决方案->构建和运行）。这似乎解决了我的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T18:26:02.410

检查程序集版本。
您的问题听起来像是您在每次构建时都自动更改了 Assembly Version，因此兼容性被破坏了。

# python - 为什么不总是将 psyco 用于 Python 代码？

> ID：575385
> 
> 赞同：41
> 
> 时间：2009-02-22T18:23:50.247
> 
> 标签：python, optimization, psyco

[psyco](http://psyco.sourceforge.net/)似乎在优化 Python 代码方面很有帮助，而且它以一种非常非侵入性的方式进行。

因此，人们不得不怀疑。假设您始终使用 x86 架构（现在大多数应用程序都运行在该架构上），为什么不总是使用`psyco`所有 Python 代码呢？它有时会出错并破坏程序的正确性吗？增加一些奇怪情况的运行时间？

你有任何负面的经历吗？到目前为止，我最消极的经历是它使我的代码速度仅提高了 15%。通常情况会更好。

自然，使用 psyco 并不能替代高效的算法和编码。但是，如果您可以以两行代码（导入和调用 psyco）的成本提高代码的性能，我认为没有充分的理由不这样做。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-09-17T10:23:30.663

1）如其他答案中所述，内存开销是主要开销。您还需要支付编译成本，如果您没有选择性，这可能会令人望而却步。来自[用户参考](http://psyco.sourceforge.net/psycoguide/module-psyco.html)：

> 对于中型或大型应用程序而言，编译所有内容通常是多余的。编译过多的缺点在于编译所花费的时间，以及该进程消耗的内存量。这是一个微妙的平衡。

2) Psyco 编译实际上会损害性能。再次来自用户指南（[“已知错误”](http://psyco.sourceforge.net/psycoguide/tutknownbugs.html)部分）：

> 还有性能错误：Psyco 会减慢代码而不是加速代码的情况。很难列出可能的原因的完整列表，但这里有一些常见的原因：
> 
> *   必须避免使用内置函数`map`和函数，并用列表理解替换。`filter`例如，`map(lambda x: x*x, lst)`应该替换为更易读但更新的语法`[x*x for x in lst]`。
> *   正则表达式的编译似乎并没有从 Psyco 中受益。（正则表达式的执行不受影响，因为它是 C 代码。）不要在这个模块上启用 Psyco；如有必要，明确禁用它，例如通过调用`psyco.cannotcompile(re.compile)`.

3) 最后，在一些相对隐蔽的情况下，使用 Psyco 实际上会引入错误。其中一些在[此处列出](http://psyco.sourceforge.net/psycoguide/bugs.html#bugs)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-22T18:45:14.390

> Psyco 当前使用大量内存。它现在只能在与 Intel 386 兼容的处理器（在任何操作系统下）上运行。Python 的工作方式存在一些细微的语义差异（即错误）；它们在大多数程序中不应该很明显。

另请参阅[注意事项部分](http://psyco.sourceforge.net/psycoguide/node25.html)。举一个困难的例子，我注意到我的带有 Cheetah 生成的模板和 DB I/O 的 Web 应用程序没有获得明显的加速。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-22T18:26:25.090

使用 pyglet 时，我发现我无法在整个应用程序上使用 psyco，而不会使我的应用程序无法运行。当然，我可以在一小段数学繁重的代码中使用它，但这不是必需的，所以我没有打扰。

此外，psyco 对我的分析结果做了一些奇怪的事情（例如，完全不改变非 psyco 版本的结果）。我怀疑它不适合分析代码。

除非我真的想要速度，否则我不会真正使用它，这并不常见。我的首要任务是算法优化，这通常会带来更好的加速。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-22T18:39:53.093

这也取决于你的瓶颈在哪里。我主要在做网络应用程序，瓶颈可能是更多的 IO 和数据库。所以你应该知道在哪里优化。

另请注意，也许您应该首先考虑您的代码，而不是直接将 psyco 扔给它。所以我同意 Devin 的观点，即算法优化应该放在首位，而且它们产生不良副作用的机会可能更小。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-09-17T20:53:44.447

psyco 已死，不再维护。是时候寻找另一个了

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-23T02:43:57.673

永远不应该依靠一些灵丹妙药来解决您的问题。通常不需要使用 psyco 使慢速程序更快。糟糕的算法可以重写，*需要*速度的部分可以用另一种语言编写。当然，您的问题是问我们为什么不使用它来提高速度，并且使用 psyco 时会有一些开销。Psyco 使用内存，当您查看这两行代码时，*感觉就像是开销。*至于我为什么不使用 psyco 的个人原因，那是因为它不支持 x86_64，我认为这是新的新兴架构（尤其是 2038 迟早会到来）。我的替代方案是 pypy，但我也不完全喜欢它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-07T00:14:22.177

其他几件事：

1.  它似乎没有得到非常积极的维护。
2.  它可能是一个记忆猪。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-22T21:24:38.593

很简单：“因为代码已经运行得足够快了”。

# wpf - ItemTemplate 与 ControlTemplate

> ID：575389
> 
> 赞同：6
> 
> 时间：2009-02-22T18:25:01.850
> 
> 标签：wpf

我对学习 WPF 感到困惑。我看到 ControlTemplate 用于确定列表框中每个项目的外观。这不是 ItemTemplate 在列表框中的用途吗？有什么不同？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-23T08:45:41.670

ControlTemplate 让您可以更改现有控件的外观和感觉，例如，使普通的日常按钮看起来像 Vista 的任务栏闪亮的玻璃按钮，或者使选项卡控件看起来像新的 Office 2007 功能区。

这个想法是控件仅包含行为，而 ControlTemplate 包含外观 - 所以按钮是“您单击的东西”而不是“具有某些 3d 效果的矩形，您可以单击”。

您可以替换 ListBox 的控件模板，以获得类似于带有圆角或自定义滚动条的列表框。

另一方面，DataTemplate（ItemTemplate 是 DataTemplate 类型的属性）让您控制数据行在列表框（和其他类似控件）内的显示方式，数据模板用于指定诸如“显示姓氏，而不是逗号和名字 - 如果以 A 开头，姓氏应该是粗体，名字应该是绿色的。

为了完整起见，还有一个 ItemsPanelTemplate 类用于更改列表框的内部布局 - Charles Petzold 的 WPF 书中有一个使用它来使普通列表框显示它的项目的示例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T18:35:21.950

ItemTemplate 描述了如何在列表框中呈现数据项（例如，您可能将列表框绑定到列表 - ItemTemplate 将允许您指定如何呈现 Foo）。ItemTemplate 是 DataTemplate。

ControlTemplate 描述了应该如何呈现 ListBox 本身

# jquery - jquery选择器的问题

> ID：575397
> 
> 赞同：0
> 
> 时间：2009-02-22T18:28:46.630
> 
> 标签：jquery, jquery-selectors, css-selectors

这是我的观点来源：

```
<input id="ctl00_cp_ctrlNew_lendeeMe" type="radio" name="ctl00$cp$ctrlNew$whoBorrowed" value="lendeeMe" /> 
```

我正在尝试使用此选择器来检查其中一个，但它不起作用：

```
$("input[@id$='lendeeMe']").attr('checked','checked'); 
```

但如果我这样做，它工作正常：

```
$("#ctl00_cp_ctrlNew_lendeeMe").attr('checked','checked'); 
```

那是由于asp.net 制作控件的疯狂方式，所以我认为使用以前的选择器会更容易。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T18:35:31.840

`[@attr]`样式选择器在 jQuery 1.3 中被移除。（在 1.2 中已弃用）。尝试删除 @ 符号。

或者，基于另一个属性，例如`$("input[value='lendeeMe']")`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T18:36:31.103

您使用的是什么版本的 jQuery？

因为正如[这里所说](http://docs.jquery.com/Selectors)：

> 注意：在 jQuery 1.3 [@attr] 样式选择器被删除（它们以前在 jQuery 1.2 中被弃用）。只需从您的选择器中删除“@”符号，以使其再次工作。

所以也许你想简单地尝试：

```
$("input[id$='lendeeMe']").attr('checked','checked'); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-03-21T04:45:19.317

$("input[id$='lendeeMe']").attr('checked','checked');
因为“@”在 jquery 中被废弃了

# c# - stl 集的 C# 等价物是什么？

> ID：575406
> 
> 赞同：6
> 
> 时间：2009-02-22T18:33:32.813
> 
> 标签：c#, data-structures

我想使用 C# 将一些值存储在平衡的二叉搜索树中。我查看了泛型命名空间中的集合，但没有找到与 stl 集合等效的集合。

我可以使用什么通用集合？（我不想存储键/值对......只是值。）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-22T18:37:53.970

你可以使用[HashSet](http://msdn.microsoft.com/en-us/library/bb359438.aspx)

> 该类`HashSet<T>`提供高性能的集合操作。集合是不包含**重复元素**且其元素没有特定顺序的集合。

对象的容量`HashSet<T>`是对象可以容纳的元素的数量。`HashSet<T>`随着元素添加到对象中，对象的容量会自动增加。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-23T22:18:09.643

1.  如果您需要排序集，请使用[`SortedDictionary<T,U>`](http://msdn.microsoft.com/en-us/library/f7fta44c.aspx). 这是使用二叉搜索树实现的。诚然，您将使用每个条目 64 位，因为您在下面存储了一个键值对。您可以像这样围绕它编写一个包装器：

    ```
    class Set<T> : SortedDictionary<T, bool>
    {
        public void Add(T item)
        {
            this.Add(item, true);
        }
    } 
    ```

2.  如果您不需要排序集，请使用[`HashSet<T>`](http://msdn.microsoft.com/en-us/library/bb359438.aspx).

3.  否则，请查看[C5 Generic Collection Library](http://www.itu.dk/research/c5/)。特别是[`TreeSet<T>`](http://www.itu.dk/research/c5/Release1.1/c5doc/types/C5.TreeSet_1.htm)。它是一棵红黑树，只存储值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-22T19:03:26.767

试试[RedBlackTree.NET](http://www.bobpinchbeck.com/Portfolio/source_code_vb_red_black_tree.htm)。它在 VB 中，但我认为它可以很容易地转换为 C#。

而且我相信某些集合类型**实际上在内部使用了红黑树**。所以你可能想[反编译框架](http://www.red-gate.com/products/reflector/)本身并四处寻找一些线索。

我不认为二叉树可以用HashSet代替。它们的性能特点是不同的，大致如下：

HashSet - O(1) 查找 (n) 搜索
二叉搜索树 - O(log n) 查找 O(log n) 搜索

如果要存储值并稍后执行搜索，则需要使用二叉树而不是 HashSet。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-22T18:44:54.953

HashSet，但 HashSet 在 2.0 版框架中不可用。如果您需要 2.0 的内容，请使用 Dictionary，并指定一个虚拟类型（例如 object、int 或 bool），您为其提供一个虚拟值（例如 null、0 或 false）作为第二个/值参数（即使用字典作为一组键，而不关心相关的值）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-07-31T14:28:37.967

我知道这个问题很老，但对于 .NET Framework 4.0 及更高版本，请使用`SortedSet<T>`或`ImmutableSortedSet<T>`.

# c# - C#：httpweb请求

> ID：575407
> 
> 赞同：0
> 
> 时间：2009-02-22T18:34:31.560
> 
> 标签：c#, .net, httpwebrequest

我正在尝试设置 httpwebrequest 标头的referer参数的值，但它给出了错误-

我正在使用的函数（C#）：

```
webRequest.Headers.Set(HttpRequestHeader.Referer, "http://www.microsoft.com"); 
```

错误：

```
Invalid parameters. A required parameter is not found or contains invalid value. 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-22T19:17:41.443

以下是典型用法：

```
HttpWebRequest req = (HttpWebRequest)WebRequest.Create("");
req.Referer = "http://www.google.com"; 
```

显示您的代码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T18:38:49.570

[从MSDN](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.referer.aspx)尝试此方法 如果您发布代码，我可以更好地帮助您。

```
HttpWebRequest    myHttpWebRequest=(HttpWebRequest)WebRequest.Create(myUri);
// Set referer property  to http://www.microsoft.com .
myHttpWebRequest.Referer="http://www.microsoft.com";
// Assign the response object of 'HttpWebRequest' to a 'HttpWebResponse' variable.
HttpWebResponse myHttpWebResponse=(HttpWebResponse)myHttpWebRequest.GetResponse();
// Display the contents of the page to the console.
Stream streamResponse=myHttpWebResponse.GetResponseStream();
StreamReader streamRead = new StreamReader( streamResponse );
Char[] readBuffer = new Char[256];
int count = streamRead.Read( readBuffer, 0, 256 );
Console.WriteLine("\nThe contents of HTML page are.......");    
while (count > 0) 
{
    String outputData = new String(readBuffer, 0, count);
    Console.Write(outputData);
    count = streamRead.Read(readBuffer, 0, 256);
}
Console.WriteLine("\nHTTP Request  Headers :\n\n{0}",myHttpWebRequest.Headers);
Console.WriteLine("\nHTTP Response Headers :\n\n{0}",myHttpWebResponse.Headers);    
streamRead.Close();
streamResponse.Close();
// Release the response object resources.
myHttpWebResponse.Close();
Console.WriteLine("Referer to the site is:{0}",myHttpWebRequest.Referer); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T18:49:03.647

**有一些保留的 HTTP 标头是其中之一，您无法**通过`webRequest.Headers.Set`Referer 设置它们。

对于这些，总是需要设置一个特殊的属性。

在你的情况下`webRequest.Referer = "http://google.com"`会做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T18:53:33.497

@kedar kamthe，你不能把 HttpRequestHeader.Referer 放在那里，因为我相信这是一个值，但不确定......我想你想用这个：

webRequest.Headers.Set("Referer", " [http://www.microsoft.com](http://www.microsoft.com) ");

但是您应该将其用作 Chris Ballance 的示例。那应该可以，但是如果那不起作用，请按照我上面的说明尝试；）。

你应该把你的代码放在这里，这样我们就可以看到哪里出了问题。

# c# - 转发器内动态控件的视图状态问题

> ID：575414
> 
> 赞同：7
> 
> 时间：2009-02-22T18:36:57.063
> 
> 标签：c#, asp.net

我最近在使用向其中添加动态控件的中继器时遇到了一个问题，尽管我有一个解决方法，它在功能上完全符合我的要求，但我想知道是否有更好的方法来做为了我的理解。我已经使用 ASP.NET 大约 6 个月了，每次我认为我已经完全掌握了页面生命周期/视图状态时，都会出现一些我无法回答的问题。

我正在创建一个表单，用户可以在其中注册他们对事件的兴趣，并为多个人注册。

aspx 是这样的：

```
<asp:Repeater ...>
    <bunch of formatting and always there controls like firstname/lastname/address>
    <asp:PlaceHolder ...>
        <dynamic controls for workshop selection go here>
    </asp:PlaceHolder>
</asp:Repeater> 
```

一个活动可以有用户可以注册的研讨会，研讨会的可用性取决于他们选择参加活动的日期。研讨会的可用性取决于日期，因此他们在选择日期之前无法选择研讨会。

无论如何，我添加的动态控件基本上是一堆文字和一堆单选按钮组。

我首先在 ItemDataBound 事件处理程序中添加控件，但是当将我的转发器项目保存回我的委托列表时，单选按钮的 ViewState 从未更新。ItemTemplate 中引用的所有字段都处理得很好，但不是我动态添加的单选按钮。

我尝试使用 ItemCreated 事件，在那里添加我的按钮，但这似乎没有任何区别。最后，我确定了一个基于[此](http://groups.google.com/group/microsoft.public.dotnet.framework.aspnet/msg/f742774cac529b2c?pli=1)的解决方法。基本上我只是以文字形式输出 HTML 输入字段并从请求中读取它们。

现在一切都很完美，我对这个功能很满意，只是将单选按钮直接输出为 HTML 输入而不是使用服务器端控件似乎真的很脏。有没有人知道为什么 ViewState 没有被正确恢复？

为了清楚起见，控件每次都以相同的顺序重新创建，并正确设置了 ID。我在所有地方都使用动态控件并且它们工作正常，当我将它们添加到中继器中时，我无法让它们在这种情况下工作。

//更多说明

我无法在 Page.Init 中创建这些控件，因为用户选择了导致回发的日期，并且在创建动态控件之前我必须等待该控件的视图状态加载。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-22T19:07:28.970

当转发器绑定到其数据源时，您正在创建（或重新创建）控件。如果在页面加载 ViewState 之后发生这种情况，则 ViewState 将不可用于动态创建的控件。

检查您是否足够早地绑定中继器 - Page.Init 正常；Page.Load 为时已晚。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T10:23:05.337

值得注意的是，Radiobuttons 控件在中继器控件中不能“开箱即用”。Repeater 控件继承 INamingContainer 接口，确保所有呈现的 html 控件具有唯一的名称属性。由于单选按钮使用 name 属性对其自身进行分组，这意味着您将无法创建单选按钮组，即设置 GroupName 属性不会产生预期的效果，因为中继器将覆盖它并为每个 RadioButton 创建唯一的名称。

# c# - 如何将网页和数据库中的格式化文本转换为 RTF 或 doc

> ID：575416
> 
> 赞同：2
> 
> 时间：2009-02-22T18:37:38.497
> 
> 标签：c#, .net, plugins, rtf, doc

我有一些格式化数据需要从网页保存为 word 文档或 rtf，这是无处不在的，所以我在想 RTF。将 .net 中的内容另存为 rtf 的最简单方法是什么？是否有为此或某些插件的内置工具？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T18:49:51.883

像[这样](http://cutesoft.net/example/editRTF.aspx)的工具可以实现手动一次性转换。

如果你想以[编程方式做同样的事情](http://www.codeproject.com/KB/HTML/XHTML2RTF.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T18:51:38.587

就个人而言，我认为格式应该被排除在数据库之外。我更喜欢查看以与格式无关的方式存储的数据。它可能对其他用途有用，您可以将格式选择推迟到最后一刻。

# c++ - 我应该如何区分子类

> ID：575426
> 
> 赞同：2
> 
> 时间：2009-02-22T18:41:09.783
> 
> 标签：c++, inheritance, coding-style, dynamic-cast

我有一个看起来像这样的令牌类：

```
class Token
{
 public:
   typedef enum { STRTOK, INTTOK } Type;
   virtual bool IsA(Type) = 0;
}

class IntTok : public Token
{
   int data;
 public:
   bool IsA(Type t) { return (t == INTTOK); }
   int GetData() { return data; }
}

IntTok newToken;
if ( newToken.IsA(Token::INTTOK )
{
  //blah blah
} 
```

所以基本上我必须在 Token 类中定义每个子类；结果并没有那么糟糕，因为子类很少，我无法想象它们会发生变化。但是，与使用动态转换识别子类相比，它仍然丑陋、笨拙且“正确”。然而：

```
IntTok newToken;
IntTok* tmpTokenTest = dynamic_cast<IntTok*>(&newToken);
if ( tmpTokenTest != NULL )
{
  //blah blah
} 
```

也很笨拙。特别是当我必须将它们串在一个大的嵌套 if 中时。

那你会用哪个？这个问题还有其他解决方案吗？

*注意：*我知道无论如何我都必须强制他们获取各自的数据，但是

1.  在我使用它们的功能之前，我不会施放它们，所以感觉更干净
2.  我比使用他们的数据更频繁地测试他们的类型。

*注意2：*上面代码中没有说明的是这些token也是一个链表。这使得模板变得困难（a`Token<int>`可能指向 a`Token<string>`等）。这就是为什么我需要一个 Token 类作为父类开始的原因。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T19:17:46.170

[确实是访客模式](http://en.wikipedia.org/wiki/Visitor_pattern)。

```
class TokenVisitor {
public:
    virtual ~TokenVisitor() { }
    virtual void visit(IntTok&) = 0;
    virtual void visit(StrTok&) = 0;
};

class Token {
 public:
   virtual void accept(TokenVisitor &v) = 0;
};

class IntTok : public Token {
   int data;
 public:
   virtual void accept(TokenVisitor &v) {
       v.visit(*this);
   }
   int GetData() { return data; }
}; 
```

然后只需实现访问者接口并调用

```
token->accept(myVisitor); 
```

控制权将交给访问者，然后访问者可以执行适当的操作。如果您需要在本地使用正确类型的变量 - 那么您将很难绕过向下转换它。但我认为使用虚拟功能驱动对特定实现的控制通常是解决它的好方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T18:47:26.070

只需使用虚函数来做你想做的事。而不是这个：

```
if(newToken.IsA(Token::INTTOK))
{
    // do stuff with ((IntTok*)&newToken)->GetData()
} 
```

做这个：

```
class Token
{
public:
    ...
    virtual void doTypeDependentStuff() {}  // empty default implementation
}

class IntTok : public Token
{
public:
    ...
    void doTypeDependent()
    {
        // do stuff with data
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T08:13:07.943

我是否建议使用 Boost::Variant，它基本上是多种类型的联合（variant 类型的对象可以包含 Ti (1 <= i <= n) 类型的任何对象）。

使用它，您将不必使用继承。

见[那里](http://www.boost.org/doc/html/variant.html)了解更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T18:47:56.193

> 所以基本上我必须在 Token 类中定义每个子类

你能解释一下为什么吗？

真的有必要投吗？可以使用多态函数。

或者，也许您可​​以拥有一个模板化的 Token 类（对某些具有默认行为）并专门处理其余的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T18:50:31.960

这是一个令人讨厌的问题，尽管我更有可能使用使用 RTTI 的版本。

新的 C++ 编译器（我上次在 VC 6.0 中尝试过，当时它不被真正支持）不是应该使用 typeid 运算符，因此您不需要完整的动态转换吗？

# xml - 向 xml 文档添加属性

> ID：575427
> 
> 赞同：2
> 
> 时间：2009-02-22T18:41:19.907
> 
> 标签：xml, xsd, schema, xml-attribute

我有一个 XML 模式和一个从客户那里获得的实例文档。例如，文档可以是：

<doc>
   <carId>12</carId>
</doc>

并且根据架构是有效的。

我想用我的属性对此进行注释：

<doc>
   <carId myns:valid="true">12</carId>
</doc>

我希望带注释的文档根据某些模式有效 - 我不在乎哪个模式，我想它会基于原始模式。

我的问题是，是否有某种方法可以在不更改新模式的情况下“扩展”原始模式？或者，只要它们根据自己的模式有效，添加这些属性总是合法的吗？

我不能假设关于原始模式的任何事情，即它不一定声明 xsd:anyAttribute 在其元素上是允许的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T19:17:07.497

这将使用[xsd:anyattribute](http://www.w3.org/TR/2004/REC-xmlschema-1-20041028/structures.html#element-anyAttribute)声明。它可以完全对任何属性开放，仅限于特定的命名空间，或者（最常见的）允许任何命名空间，而不是现在定义的命名空间）。

如果您只想检查有效性并且在运行时不需要模式数据，一个简单的答案是从副本中删除您的属性并对其进行验证。

只要 complexType 具有名称，并且原始模式没有使用 final 来禁止这一点，通过扩展派生，为每个 complexType 生成具有所需 anyAttribute 声明的模式也相当容易。

但是，如果您真的无法控制输入模式，那么除了修改它之外，我看不到任何选择。

# c# - 为什么我的公共属性没有被 XmlSerializer 序列化？

> ID：575432
> 
> 赞同：63
> 
> 时间：2009-02-22T18:45:05.017
> 
> 标签：c#, .net, xml-serialization

这是我多年来一直在苦苦挣扎的一个，所以我想我会在某个地方记录下来。（很抱歉提出和回答问题。）

(C# .net 2.0) 我有一个由 XmlSerializer 序列化的类，我添加了一个新的公共属性，但它没有包含在输出 XML 中。

在我能找到的任何地方的文档中都没有提到它，但是公共属性必须有一个 set 和一个 get 才能被序列化！我猜这是因为它假设如果你要序列化，那么你会想要从同一个文件反序列化，所以只序列化同时具有 set 和 get 的属性。

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-02-22T19:39:34.870

如前所述，大多数属性必须同时具有 getter 和 setter；主要的例外是列表 - 例如：

```
private readonly List<Foo> bar = new List<Foo>();
public List<Foo> Bar {get { return bar; } } // works fine 
```

这将正常工作；但是，如果`XmlSerializer` *找到*一个 setter - 它要求它是公开的；以下将**不起作用**：

```
public List<Foo> Bar {get; private set;} // FAIL 
```

它可能无法序列化的其他原因：

*   它不与 get 和 set 公开（或`readonly`用于字段）
*   它有一个`[DefaultValue]`属性，并且具有该值
*   它有一个`bool ShouldSerializeFoo()`返回 false 的公共方法
*   它有一个`bool FooSpecified {get;set;}`返回 false 的公共属性或字段
*   它被标记`[XmlIgnore]`
*   它被标记`[Obsolete]`

任何这些都会导致它不序列化

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-09T06:04:28.743

关于 getter+setter 的观点在“ [Intro to Xml Serialization](http://msdn.microsoft.com/en-us/library/182eeyhh(VS.85).aspx) ”页面的第 3 段中提出。它实际上是在一个呼叫框。不能错过！

[XML 序列化简介 http://www.freeimagehosting.net/uploads/2f04fea2db.png](http://www.freeimagehosting.net/uploads/2f04fea2db.png)

（在 Freeimagehosting.net 上玩得太开心了）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-28T18:08:27.363

返回 null 的属性也不会序列化！

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-08-08T15:02:31.763

如果您不想实现正确的 Setter（因为也许您既不想反序列化或更改对象值），您可以只使用像这样的虚拟设置器`set { }`，这样就可以了`XMLSerializer`，但是如果您使用 Setter，什么都不会发生...

IE

```
public string ID { get { return _item.ID.ToString(); } set { } } 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-09-12T14:58:19.517

关于集合序列化的另一件事：

**XmlSerializer 忽略接口集合！**

我的意思是**忽略**。虽然您会遇到以下行的异常：

```
public IFoo Foo { get; set; } 
```

你*不会*得到例外：

```
public ICollection<IFoo> LotsOfFoos { get { return this.fooBackingField; } } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-04-17T09:47:07.223

如果你的类继承了一个列表并且也有它自己的成员，那么只有列表中的元素会被序列化。您的班级成员中存在的数据不会被捕获。花了一些时间弄清楚这个！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-10-10T01:13:20.467

您可以`IXmlSerializer`手动实现和执行序列化，并从序列化属性中受益，反之亦然，使用构造函数/私有字段分配反序列化它们。

# .net-2.0 - 模仿 UltraGridColumnChooser 的拖放功能

> ID：575435
> 
> 赞同：0
> 
> 时间：2009-02-22T18:46:14.967
> 
> 标签：.net-2.0, drag-and-drop, infragistics, ultrawingrid, ultratree

（基础设施 2008 年第 3 卷，CLR 2.0）

Infragistics`UltraGrid`带有一个列选择器用户控件，它只是垂直排列的列，带有切换列隐藏状态的复选框。此外，它允许您选择一列并将其直接拖到网格中，这样您就不必事后手动定位它。（当您已经有很多可见的列并且不知道新列在哪里结束时，这特别方便。）

我正在基于`UltraTree`. 让复选框的行为相同不是问题，但我还没有找到一种方法将列从树拖到网格并让它接受它。

在我的树中，每个`UltraTreeNode`都有`Tag`以下内容`struct`：

```
Private Structure DraggableGridColumn
    Public NodeKey As String
    Public NodeName As String
    Public ParentKey As String

    Public Column As UltraGridColumn
End Structure 
```

然后我有一个事件如下：

```
Private Sub columnsTree_SelectionDragStart(ByVal sender As Object, ByVal e As System.EventArgs) Handles columnsTree.SelectionDragStart
    If columnsTree.SelectedNodes.Count <> 1 Then
        Return
    End If

    If Not TypeOf columnsTree.SelectedNodes(0).Tag Is DraggableGridColumn Then
        Return
    End If

    Dim column As UltraGridColumn = CType(columnsTree.SelectedNodes(0).Tag, DraggableGridColumn).Column

    columnsTree.DoDragDrop(column, DragDropEffects.All)
End Sub 
```

在`DoDragDrop`调用中，`column`（类型`UltraGridColumn`）和`column.Header`（类型`ColumnHeader`）都不会被网格接受。我假设我发送了错误的类型，和/或网格需要`struct`带有一些附加信息的特殊信息。不幸的是，我也未能捕捉到 Infragistics 的普通列选择器正确执行此操作的事件（在列选择器端和网格端）；正常的拖放事件似乎永远不会触发。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T01:12:06.827

看起来该列必须是 UltraTreeNode 才能工作。大概您将列数据放入某种（派生的）UltraTreeNode 中，因此您可能想尝试将其倒出并在 DoDragDrop 调用中使用该对象。

——马库斯

# ruby-on-rails - 帮助使用 Flotilla 和 Ruby on Rails

> ID：575436
> 
> 赞同：3
> 
> 时间：2009-02-22T18:47:20.890
> 
> 标签：ruby-on-rails, flot, graphing

我是 Rails（和 StackOverflow）的新手，所以如果这是一个“愚蠢”的问题，我深表歉意。我已经组装了一个非常简单的 Rails 应用程序。它从另一台服务器接收数据（通过 HTTP POST）。我想绘制发送的数据 - 特别是，我希望绘制温度与时间的关系图。

我正在尝试使用[Flotilla](http://flotilla.rubyforge.org/)生成这些图表，但除了主页上的一行示例之外，我似乎找不到太多关于如何使用它的文档：

```
 = chart("graph", {"Store 1" => {:collection => @store_one, :x => :date, :y => :sales }, "Store 2" => {:collection => @store_two, :x => :date, :y => :sales }}) 
```

这是我的 index.html.erb：

```
<table>
  <tr>
    <th>Temperature</th>
    <th>Time</th>
  </tr>

<% for post in @posts %>
  <tr>
    <td><%=h post.temperature %></td>
    <td><%=h post.created_at %></td>
  </tr>
<% end %>
</table>
<%= chart("graph", { "Graph1" => { :collection => @posts, :x => :created_at, :y => :temperature }})%>
<br /> 
```

第一部分简单地打印出温度和时间列表。这工作正常。不幸的是，第二部分 - 实际图表 - 似乎不起作用。实际上没有任何显示。

如果我查看生成的 HTML 的源代码，我会看到：

```
 <script language="javascript" type="text/javascript" src="/javascripts/jquery.flot.pack.js"></script>
    <script type="text/javascript">
      $.plot($('#graph'), [{"data":[[1234191865.0,12.0],[1234192069.0,15.0],[1234192113.0,16.0],[1234192123.0,18.0],[1234192189.0,21.0],[1234192203.0,25.0],[1234192320.0,27.0],[1234192329.0,29.0],[1234192384.0,30.0],[1234192391.0,31.0],[1234192402.0,35.0],[1234192409.0,29.0],[1234192412.0,31.0],[1234192414.0,27.0],[1234192419.0,25.0],[1234211826.0,27.0]],"label":"Graph1"}], {});
    </script> 
```

但没有显示实际的图表。提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-02-26T20:42:41.923

对我有用的是在视图顶部添加这一行：

```
<%= javascript_include_tag 'jquery-1.5.1','flot/jquery.flot.js','excanvas.pack.js','jquery.flot.pack.js' %> 
```

这意味着在我看来，要包含使用 flot 所需的所有 javascript。还要确保在 /public/javascripts/ 文件夹下拥有所有 js 文件

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T00:41:59.040

尝试在页面的任何位置添加`div`带有 id 的元素`graph`；它将用作图表的画布。

> **`<div id="graph" style="width:600px;height:300px;"></div>`**

元素的`id`必须与您作为第一个参数传递给 的字符串匹配`chart`。

如有疑问，您可以查看Flot 网站上[各种示例页面的来源。](http://people.iola.dk/olau/flot/examples/)

# c# - 使用 C# 进行 URL 编码

> ID：575440
> 
> 赞同：405
> 
> 时间：2009-02-22T18:48:23.463
> 
> 标签：c#, .net, urlencode

我有一个应用程序，它向 VB 论坛软件发送一个 POST 请求并让某人登录（不设置 cookie 或任何东西）。

用户登录后，我会创建一个变量，在他们的本地机器上创建一个路径。

c:\tempfolder\日期\用户名

问题是一些用户名抛出“非法字符”异常。例如，如果我的用户名是`mas|fenix`它会抛出异常..

```
Path.Combine( _      
  Environment.GetFolderPath(System.Environment.SpecialFolder.CommonApplicationData), _
  DateTime.Now.ToString("ddMMyyhhmm") + "-" + form1.username) 
```

我不想从字符串中删除它，但是通过服务器上的 FTP 创建了一个带有用户名的文件夹。这引出了我的第二个问题。如果我在服务器上创建一个文件夹，我可以留下“非法字符”吗？我只问这个是因为服务器是基于 Linux 的，我不确定 Linux 是否接受它。

**编辑：似乎 URL 编码不是我想要的。这就是我想要做的：**

```
old username = mas|fenix
new username = mas%xxfenix 
```

其中 %xx 是 ASCII 值或任何其他可以轻松识别字符的值。

* * *

## 回答 #1

> 赞同：625
> 
> 时间：2012-06-27T23:10:56.053

我一直在试验 .NET 为 URL 编码提供的各种方法。也许下表会很有用（作为我编写的测试应用程序的输出）：

```
Unencoded UrlEncoded UrlEncodedUnicode UrlPathEncoded EscapedDataString EscapedUriString HtmlEncoded HtmlAttributeEncoded HexEscaped
A         A          A                 A              A                 A                A           A                    %41
B         B          B                 B              B                 B                B           B                    %42

a         a          a                 a              a                 a                a           a                    %61
b         b          b                 b              b                 b                b           b                    %62

0         0          0                 0              0                 0                0           0                    %30
1         1          1                 1              1                 1                1           1                    %31

[space]   +          +                 %20            %20               %20              [space]     [space]              %20
!         !          !                 !              !                 !                !           !                    %21
"         %22        %22               "              %22               %22              &quot;      &quot;               %22
#         %23        %23               #              %23               #                #           #                    %23
$         %24        %24               $              %24               $                $           $                    %24
%         %25        %25               %              %25               %25              %           %                    %25
&         %26        %26               &              %26               &                &amp;       &amp;                %26
'         %27        %27               '              '                 '                &#39;       &#39;                %27
(         (          (                 (              (                 (                (           (                    %28
)         )          )                 )              )                 )                )           )                    %29
*         *          *                 *              %2A               *                *           *                    %2A
+         %2b        %2b               +              %2B               +                +           +                    %2B
,         %2c        %2c               ,              %2C               ,                ,           ,                    %2C
-         -          -                 -              -                 -                -           -                    %2D
.         .          .                 .              .                 .                .           .                    %2E
/         %2f        %2f               /              %2F               /                /           /                    %2F
:         %3a        %3a               :              %3A               :                :           :                    %3A
;         %3b        %3b               ;              %3B               ;                ;           ;                    %3B
<         %3c        %3c               <              %3C               %3C              &lt;        &lt;                 %3C
=         %3d        %3d               =              %3D               =                =           =                    %3D
>         %3e        %3e               >              %3E               %3E              &gt;        >                    %3E
?         %3f        %3f               ?              %3F               ?                ?           ?                    %3F
@         %40        %40               @              %40               @                @           @                    %40
[         %5b        %5b               [              %5B               %5B              [           [                    %5B
\         %5c        %5c               \              %5C               %5C              \           \                    %5C
]         %5d        %5d               ]              %5D               %5D              ]           ]                    %5D
^         %5e        %5e               ^              %5E               %5E              ^           ^                    %5E
_         _          _                 _              _                 _                _           _                    %5F
`         %60        %60               `              %60               %60              `           `                    %60
{         %7b        %7b               {              %7B               %7B              {           {                    %7B
|         %7c        %7c               |              %7C               %7C              |           |                    %7C
}         %7d        %7d               }              %7D               %7D              }           }                    %7D
~         %7e        %7e               ~              ~                 ~                ~           ~                    %7E

Ā         %c4%80     %u0100            %c4%80         %C4%80            %C4%80           Ā           Ā                    [OoR]
ā         %c4%81     %u0101            %c4%81         %C4%81            %C4%81           ā           ā                    [OoR]
Ē         %c4%92     %u0112            %c4%92         %C4%92            %C4%92           Ē           Ē                    [OoR]
ē         %c4%93     %u0113            %c4%93         %C4%93            %C4%93           ē           ē                    [OoR]
Ī         %c4%aa     %u012a            %c4%aa         %C4%AA            %C4%AA           Ī           Ī                    [OoR]
ī         %c4%ab     %u012b            %c4%ab         %C4%AB            %C4%AB           ī           ī                    [OoR]
Ō         %c5%8c     %u014c            %c5%8c         %C5%8C            %C5%8C           Ō           Ō                    [OoR]
ō         %c5%8d     %u014d            %c5%8d         %C5%8D            %C5%8D           ō           ō                    [OoR]
Ū         %c5%aa     %u016a            %c5%aa         %C5%AA            %C5%AA           Ū           Ū                    [OoR]
ū         %c5%ab     %u016b            %c5%ab         %C5%AB            %C5%AB           ū           ū                    [OoR] 
```

这些列表示编码如下：

*   网址编码：`HttpUtility.UrlEncode`

*   UrlEncodedUnicode：`HttpUtility.UrlEncodeUnicode`

*   UrlPath 编码：`HttpUtility.UrlPathEncode`

*   转义数据字符串：`Uri.EscapeDataString`

*   转义UriString：`Uri.EscapeUriString`

*   Html 编码：`HttpUtility.HtmlEncode`

*   HtmlAttributeEncoded:`HttpUtility.HtmlAttributeEncode`

*   十六进制转义：`Uri.HexEscape`

**笔记：**

1.  `HexEscape`只能处理前 255 个字符。因此，它会`ArgumentOutOfRange`为拉丁 A 扩展字符（例如 Ā）抛出异常。

2.  该表是在 .NET 4.0 中生成的（请参阅下面的 Levi Botelho 的评论，其中说 .NET 4.5 中的编码略有不同）。

**编辑：**

我添加了第二个表，其中包含 .NET 4.5 的编码。看到这个答案：[https ://stackoverflow.com/a/21771206/216440](https://stackoverflow.com/a/21771206/216440)

**编辑2：**

由于人们似乎很欣赏这些表格，我想你可能会喜欢生成表格的源代码，所以你可以自己玩。这是一个简单的 C# 控制台应用程序，可以针对 .NET 4.0 或 4.5：

```
using System;
using System.Collections.Generic;
using System.Text;
// Need to add a Reference to the System.Web assembly.
using System.Web;

namespace UriEncodingDEMO2
{
    class Program
    {
        static void Main(string[] args)
        {
            EncodeStrings();

            Console.WriteLine();
            Console.WriteLine("Press any key to continue...");
            Console.Read();
        }

        public static void EncodeStrings()
        {
            string stringToEncode = "ABCD" + "abcd"
            + "0123" + " !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~" + "ĀāĒēĪīŌōŪū";

            // Need to set the console encoding to display non-ASCII characters correctly (eg the 
            //  Latin A-Extended characters such as ĀāĒē...).
            Console.OutputEncoding = Encoding.UTF8;

            // Will also need to set the console font (in the console Properties dialog) to a font 
            //  that displays the extended character set correctly.
            // The following fonts all display the extended characters correctly:
            //  Consolas
            //  DejaVu Sana Mono
            //  Lucida Console

            // Also, in the console Properties, set the Screen Buffer Size and the Window Size 
            //  Width properties to at least 140 characters, to display the full width of the 
            //  table that is generated.

            Dictionary<string, Func<string, string>> columnDetails =
                new Dictionary<string, Func<string, string>>();
            columnDetails.Add("Unencoded", (unencodedString => unencodedString));
            columnDetails.Add("UrlEncoded",
                (unencodedString => HttpUtility.UrlEncode(unencodedString)));
            columnDetails.Add("UrlEncodedUnicode",
                (unencodedString => HttpUtility.UrlEncodeUnicode(unencodedString)));
            columnDetails.Add("UrlPathEncoded",
                (unencodedString => HttpUtility.UrlPathEncode(unencodedString)));
            columnDetails.Add("EscapedDataString",
                (unencodedString => Uri.EscapeDataString(unencodedString)));
            columnDetails.Add("EscapedUriString",
                (unencodedString => Uri.EscapeUriString(unencodedString)));
            columnDetails.Add("HtmlEncoded",
                (unencodedString => HttpUtility.HtmlEncode(unencodedString)));
            columnDetails.Add("HtmlAttributeEncoded",
                (unencodedString => HttpUtility.HtmlAttributeEncode(unencodedString)));
            columnDetails.Add("HexEscaped",
                (unencodedString
                    =>
                    {
                        // Uri.HexEscape can only handle the first 255 characters so for the 
                        //  Latin A-Extended characters, such as A, it will throw an 
                        //  ArgumentOutOfRange exception.                       
                        try
                        {
                            return Uri.HexEscape(unencodedString.ToCharArray()[0]);
                        }
                        catch
                        {
                            return "[OoR]";
                        }
                    }));

            char[] charactersToEncode = stringToEncode.ToCharArray();
            string[] stringCharactersToEncode = Array.ConvertAll<char, string>(charactersToEncode,
                (character => character.ToString()));
            DisplayCharacterTable<string>(stringCharactersToEncode, columnDetails);
        }

        private static void DisplayCharacterTable<TUnencoded>(TUnencoded[] unencodedArray,
            Dictionary<string, Func<TUnencoded, string>> mappings)
        {
            foreach (string key in mappings.Keys)
            {
                Console.Write(key.Replace(" ", "[space]") + " ");
            }
            Console.WriteLine();

            foreach (TUnencoded unencodedObject in unencodedArray)
            {
                string stringCharToEncode = unencodedObject.ToString();
                foreach (string columnHeader in mappings.Keys)
                {
                    int columnWidth = columnHeader.Length + 1;
                    Func<TUnencoded, string> encoder = mappings[columnHeader];
                    string encodedString = encoder(unencodedObject);

                    // ASSUMPTION: Column header will always be wider than encoded string.
                    Console.Write(encodedString.Replace(" ", "[space]").PadRight(columnWidth));
                }
                Console.WriteLine();
            }
        }
    }
} 
```

[单击此处在 dotnetfiddle.net 上运行代码](https://dotnetfiddle.net/jRsnt7)

* * *

## 回答 #2

> 赞同：296
> 
> 时间：2009-02-22T21:29:28.397

您应该只对用户名或 URL 中可能无效的其他部分进行编码。URL 对 URL 进行编码可能会导致问题，因为如下所示：

```
string url = HttpUtility.UrlEncode("http://www.google.com/search?q=Example"); 
```

将产生

> http%3a%2f%2fwww.google.com%2fsearch%3fq%3dExample

这显然不会很好地工作。相反，您应该只对查询字符串中的键/值对的值进行编码，如下所示：

```
string url = "http://www.google.com/search?q=" + HttpUtility.UrlEncode("Example"); 
```

希望这会有所帮助。此外，正如[teedyay 所](https://stackoverflow.com/questions/575440/url-encoding-using-c/575463#575463)提到的，您仍然需要确保删除非法文件名字符，否则文件系统将不喜欢该路径。

* * *

## 回答 #3

> 赞同：220
> 
> 时间：2011-09-15T07:57:11.473

更好的方法是使用

[`Uri.EscapeUriString`](https://docs.microsoft.com/en-us/dotnet/api/system.uri.escapeuristring?view=netframework-4.7.2)

不参考 .net 4 的完整配置文件。

* * *

## 回答 #4

> 赞同：209
> 
> 时间：2009-02-22T20:55:35.497

**编辑：请注意，这个答案现在已经过时了。请参阅[下面的 Siarhei Kuchuk 的答案](https://stackoverflow.com/a/7427556/21539)以获得更好的解决方案**

UrlEncoding 将执行您在此处的建议。`HttpUtility`如前所述，使用 C#，您只需使用.

您也可以对非法字符进行正则表达式然后替换，但这会变得更加复杂，因为您必须拥有某种形式的状态机（例如 switch ... case）才能用正确的字符替换。由于`UrlEncode`这是预先完成的，因此相当容易。

至于 Linux 与 Windows，有些字符在 Linux 中是可接受的，但在 Windows 中是不可接受的，但我不担心，因为文件夹名称可以通过解码 Url 字符串返回，使用`UrlDecode`，所以你可以往返变化。

* * *

## 回答 #5

> 赞同：199
> 
> 时间：2013-06-03T10:07:25.337

从**.NET Framework 4.5**和**.NET Standard 1.0 开始**，您应该使用**[`WebUtility.UrlEncode`](https://docs.microsoft.com/en-us/dotnet/api/system.net.webutility.urlencode)**. 优于替代品的优势：

1.  它是 .NET Framework 4.5+、.NET Core 1.0+、.NET Standard 1.0+、UWP 10.0+ 以及所有 Xamarin 平台的一部分。[`HttpUtility`](https://docs.microsoft.com/en-us/dotnet/api/system.web.httputility.urlencode)，虽然在早期的 .NET Framework（.NET Framework 1.1+）中可用，但在其他平台上可用的时间要晚得多（.NET Core 2.0+、.NET Standard 2.0+），并且在 UWP 中仍然不可用（请参阅[相关问题](https://stackoverflow.com/q/8341882)）。

2.  在 .NET Framework 中，它*位于`System.dll`*`HttpUtility`.

3.  它*正确地转义了 URLs 的字符*，不像`Uri.EscapeUriString`（参见[drweb86's answer 的评论](https://stackoverflow.com/questions/575440/url-encoding-using-c-sharp/16894322#comment20628367_7427556)）。

4.  它对*字符串的长度没有任何限制*，不像`Uri.EscapeDataString`（参见[相关问题](https://stackoverflow.com/q/6695208)），因此它可以用于例如 POST 请求。

* * *

## 回答 #6

> 赞同：97
> 
> 时间：2014-02-14T05:00:58.290

Levi Botelho 评论说，之前生成的编码表对于 .NET 4.5 不再准确，因为 .NET 4.0 和 4.5 之间的编码略有变化。所以我为 .NET 4.5 重新生成了表：

```
Unencoded UrlEncoded UrlEncodedUnicode UrlPathEncoded WebUtilityUrlEncoded EscapedDataString EscapedUriString HtmlEncoded HtmlAttributeEncoded WebUtilityHtmlEncoded HexEscaped
A         A          A                 A              A                    A                 A                A           A                    A                     %41
B         B          B                 B              B                    B                 B                B           B                    B                     %42

a         a          a                 a              a                    a                 a                a           a                    a                     %61
b         b          b                 b              b                    b                 b                b           b                    b                     %62

0         0          0                 0              0                    0                 0                0           0                    0                     %30
1         1          1                 1              1                    1                 1                1           1                    1                     %31

[space]   +          +                 %20            +                    %20               %20              [space]     [space]              [space]               %20
!         !          !                 !              !                    %21               !                !           !                    !                     %21
"         %22        %22               "              %22                  %22               %22              &quot;      &quot;               &quot;                %22
#         %23        %23               #              %23                  %23               #                #           #                    #                     %23
$         %24        %24               $              %24                  %24               $                $           $                    $                     %24
%         %25        %25               %              %25                  %25               %25              %           %                    %                     %25
&         %26        %26               &              %26                  %26               &                &amp;       &amp;                &amp;                 %26
'         %27        %27               '              %27                  %27               '                &#39;       &#39;                &#39;                 %27
(         (          (                 (              (                    %28               (                (           (                    (                     %28
)         )          )                 )              )                    %29               )                )           )                    )                     %29
*         *          *                 *              *                    %2A               *                *           *                    *                     %2A
+         %2b        %2b               +              %2B                  %2B               +                +           +                    +                     %2B
,         %2c        %2c               ,              %2C                  %2C               ,                ,           ,                    ,                     %2C
-         -          -                 -              -                    -                 -                -           -                    -                     %2D
.         .          .                 .              .                    .                 .                .           .                    .                     %2E
/         %2f        %2f               /              %2F                  %2F               /                /           /                    /                     %2F
:         %3a        %3a               :              %3A                  %3A               :                :           :                    :                     %3A
;         %3b        %3b               ;              %3B                  %3B               ;                ;           ;                    ;                     %3B
<         %3c        %3c               <              %3C                  %3C               %3C              &lt;        &lt;                 &lt;                  %3C
=         %3d        %3d               =              %3D                  %3D               =                =           =                    =                     %3D
>         %3e        %3e               >              %3E                  %3E               %3E              &gt;        >                    &gt;                  %3E
?         %3f        %3f               ?              %3F                  %3F               ?                ?           ?                    ?                     %3F
@         %40        %40               @              %40                  %40               @                @           @                    @                     %40
[         %5b        %5b               [              %5B                  %5B               [                [           [                    [                     %5B
\         %5c        %5c               \              %5C                  %5C               %5C              \           \                    \                     %5C
]         %5d        %5d               ]              %5D                  %5D               ]                ]           ]                    ]                     %5D
^         %5e        %5e               ^              %5E                  %5E               %5E              ^           ^                    ^                     %5E
_         _          _                 _              _                    _                 _                _           _                    _                     %5F
`         %60        %60               `              %60                  %60               %60              `           `                    `                     %60
{         %7b        %7b               {              %7B                  %7B               %7B              {           {                    {                     %7B
|         %7c        %7c               |              %7C                  %7C               %7C              |           |                    |                     %7C
}         %7d        %7d               }              %7D                  %7D               %7D              }           }                    }                     %7D
~         %7e        %7e               ~              %7E                  ~                 ~                ~           ~                    ~                     %7E

Ā         %c4%80     %u0100            %c4%80         %C4%80               %C4%80            %C4%80           Ā           Ā                    Ā                     [OoR]
ā         %c4%81     %u0101            %c4%81         %C4%81               %C4%81            %C4%81           ā           ā                    ā                     [OoR]
Ē         %c4%92     %u0112            %c4%92         %C4%92               %C4%92            %C4%92           Ē           Ē                    Ē                     [OoR]
ē         %c4%93     %u0113            %c4%93         %C4%93               %C4%93            %C4%93           ē           ē                    ē                     [OoR]
Ī         %c4%aa     %u012a            %c4%aa         %C4%AA               %C4%AA            %C4%AA           Ī           Ī                    Ī                     [OoR]
ī         %c4%ab     %u012b            %c4%ab         %C4%AB               %C4%AB            %C4%AB           ī           ī                    ī                     [OoR]
Ō         %c5%8c     %u014c            %c5%8c         %C5%8C               %C5%8C            %C5%8C           Ō           Ō                    Ō                     [OoR]
ō         %c5%8d     %u014d            %c5%8d         %C5%8D               %C5%8D            %C5%8D           ō           ō                    ō                     [OoR]
Ū         %c5%aa     %u016a            %c5%aa         %C5%AA               %C5%AA            %C5%AA           Ū           Ū                    Ū                     [OoR]
ū         %c5%ab     %u016b            %c5%ab         %C5%AB               %C5%AB            %C5%AB           ū           ū                    ū                     [OoR] 
```

这些列表示编码如下：

*   网址编码：`HttpUtility.UrlEncode`
*   UrlEncodedUnicode：`HttpUtility.UrlEncodeUnicode`
*   UrlPath 编码：`HttpUtility.UrlPathEncode`
*   WebUtilityUrl 编码：`WebUtility.UrlEncode`
*   转义数据字符串：`Uri.EscapeDataString`
*   转义UriString：`Uri.EscapeUriString`
*   Html 编码：`HttpUtility.HtmlEncode`
*   HtmlAttributeEncoded:`HttpUtility.HtmlAttributeEncode`
*   WebUtilityHtml 编码：`WebUtility.HtmlEncode`
*   十六进制转义：`Uri.HexEscape`

**笔记：**

1.  HexEscape 只能处理前 255 个字符。因此，它会为拉丁 A 扩展字符（例如 Ā）抛出 ArgumentOutOfRange 异常。

2.  此表是在 .NET 4.5 中生成的（有关 .NET 4.0 及以下版本的编码，请参阅答案[https://stackoverflow.com/a/11236038/216440 ）。](https://stackoverflow.com/a/11236038/216440)

**编辑：**

1.  由于 Discord 的回答，我添加了新的 WebUtility UrlEncode 和 HtmlEncode 方法，它们是在 .NET 4.5 中引入的。

* * *

## 回答 #7

> 赞同：69
> 
> 时间：2009-02-22T18:57:46.060

.NET 中的 URL 编码很容易。采用：

```
System.Web.HttpUtility.UrlEncode(string url) 
```

如果将对其进行解码以获取文件夹名称，您仍然需要排除文件夹名称中不能使用的字符（*、?、/ 等）

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2011-03-20T05:20:04.230

如果看不到 System.Web，请更改项目设置。目标框架应该是“.NET Framework 4”而不是“.NET Framework 4 Client Profile”

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2013-05-21T22:21:31.740

.NET 的实现`UrlEncode`不符合 RFC 3986。

1.  有些字符没有编码，但应该编码。这些`!()*`字符在 RFC 的 2.2 节中列为必须编码的保留字符，但 .NET 无法对这些字符进行编码。

2.  一些字符被编码但不应该被编码。这些`.-_`字符未在 RFC 的第 2.2 节中列为不应编码的保留字符。NET 错误地对这些字符进行编码。

3.  RFC 指定为保持一致，实现应使用大写 HEXDIG，而 .NET 生成小写 HEXDIG。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2019-01-29T21:58:20.973

我认为这里的人们被 UrlEncode 消息转移了注意力。URLEncoding*不是*你想要的——你想要对在目标系统上不能作为文件名工作的东西进行编码。

假设您想要一些通用性——随意在多个系统（MacOS、Windows、Linux 和 Unix）上找到非法字符，将它们联合起来形成一组字符以进行转义。

至于转义，HexEscape 应该没问题（用 %XX 替换字符）。如果您想支持不执行 unicode 的系统，请将每个字符转换为 UTF-8 字节并对 >128 的所有内容进行编码。但是还有其他方法，例如使用反斜杠“\”或 HTML 编码“””。您可以创建自己的。任何系统所要做的就是“编码”掉不兼容的字符。上述系统允许您重新创建原始名称——但也可以用空格替换坏字符。

在与上述相同的切线上，唯一使用的是

> Uri.EscapeDataString

-- 它对 OAuth 所需的所有内容进行编码，它不对 OAuth 禁止编码的内容进行编码，并将空格编码为 %20 而不是 +（也在 OATH 规范中）参见：RFC 3986。AFAIK，这是最新的 URI 规范。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2017-11-02T12:25:57.900

我编写了一个对所有符号进行 url 编码的 C# 方法：

```
 /// <summary>
    /// !#$345Hf} → %21%23%24%33%34%35%48%66%7D
    /// </summary>
    public static string UrlEncodeExtended( string value )
    {
        char[] chars = value.ToCharArray();
        StringBuilder encodedValue = new StringBuilder();
        foreach (char c in chars)
        {
            encodedValue.Append( "%" + ( (int)c ).ToString( "X2" ) );
        }
        return encodedValue.ToString();
    } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-02-08T22:05:18.197

理想情况下，这些将放在一个名为“FileNaming”的类中，或者只是将 Encode 重命名为“FileNameEncode”。注意：这些不是为处理完整路径而设计的，只是文件夹和/或文件名。理想情况下，您首先会拆分（“/”）您的完整路径，然后检查各个部分。显然，您可以将“%”字符添加到 Windows 中不允许的字符列表中，而不是联合，但我认为这种方式更有帮助/可读性/事实性。Decode() 完全相同，但将 Replace(Uri.HexEscape(s[0]), s) 与字符“转义”。

```
public static List<string> urlEncodedCharacters = new List<string>
{
  "/", "\\", "<", ">", ":", "\"", "|", "?", "%" //and others, but not *
};
//Since this is a superset of urlEncodedCharacters, we won't be able to only use UrlEncode() - instead we'll use HexEncode
public static List<string> specialCharactersNotAllowedInWindows = new List<string>
{
  "/", "\\", "<", ">", ":", "\"", "|", "?", "*" //windows dissallowed character set
};

    public static string Encode(string fileName)
    {
        //CheckForFullPath(fileName); // optional: make sure it's not a path?
        List<string> charactersToChange = new List<string>(specialCharactersNotAllowedInWindows);
        charactersToChange.AddRange(urlEncodedCharacters.
            Where(x => !urlEncodedCharacters.Union(specialCharactersNotAllowedInWindows).Contains(x)));   // add any non duplicates (%)

        charactersToChange.ForEach(s => fileName = fileName.Replace(s, Uri.HexEscape(s[0])));   // "?" => "%3f"

        return fileName;
    } 
```

感谢@simon-tewsi 提供了上面非常有用的表格！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-03-01T08:07:20.217

除了@Dan Herbert 的回答，我们通常应该只对值进行编码。

Split 有 params 参数 Split('&','='); 表达式首先由 & 然后 '=' 分割，所以奇数元素都是要编码的值，如下所示。

```
public static void EncodeQueryString(ref string queryString)
{
    var array=queryString.Split('&','=');
    for (int i = 0; i < array.Length; i++) {
        string part=array[i];
        if(i%2==1)
        {               
            part=System.Web.HttpUtility.UrlEncode(array[i]);
            queryString=queryString.Replace(array[i],part);
        }
    }
} 
```

# p2p - peer2peer 如何通过路由器工作？

> ID：575448
> 
> 赞同：6
> 
> 时间：2009-02-22T18:49:55.097
> 
> 标签：p2p, nat-traversal

一台 PC 如何通过 Internet 连接到另一台 PC？

一个例子是监听 PC 1 上的连接的程序。PC 1 位于路由器 1 后面。PC 2 有一个客户端程序试图连接到 PC 1。

在这种情况下，作为听力程序使用的正确技术/技巧是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-22T18:52:10.053

[Brian Ford 的](http://www.brynosaurus.com/pub/net/p2pnat/)这篇文章解释了跨 NAT 的点对点通信是如何工作的。

大多数路由器还公开了[通用即插即用接口 (uPnP)](http://en.wikipedia.org/wiki/Universal_Plug_and_Play)，可用于端口转发和 NAT 穿越。

您还应该查看[STUNT 库](http://nutss.gforge.cis.cornell.edu/stunt.php)，它是一个易于使用的 NAT 遍历库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T23:35:05.880

您可能需要阅读[NAT Traversal](http://en.wikipedia.org/wiki/NAT_traversal)。NAT 穿越是建立和维护穿越网络地址转换 (NAT) 网关的 TCP/IP 网络连接的技术的通用术语。

# sql - 放置主键的位置

> ID：575450
> 
> 赞同：3
> 
> 时间：2009-02-22T18:49:57.890
> 
> 标签：sql, sql-server-2008, indexing

据我所知，SQL Server 2008 只允许每个表有一个聚集索引。为了这个问题，假设我有一个用户提交的故事列表，其中包含以下列。

ID (int, primary key)
Title (nvarchar)
Url (nvarchar)
UniqueName (nvarchar) 这是 url slug (blah-blah-blah)
CategoryID (int, FK to Category table)

大多数情况下，故事永远不会被 ID 查询。大多数查询将由 CategoryID 或 UniqueName 完成。

我是索引新手，所以我认为最好在此表上放置 2 个非聚集索引。一个在 UniqueName 上，一个在 CategoryID 上。在阅读了一些关于索引的内容之后，似乎在 UniqueName 上创建一个聚集索引会非常有益。考虑到 UniqueName is... unique 将主键放在 UniuqeName 上并摆脱 ID 字段是否有利？至于 CategoryID，我假设非聚集索引就可以了。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T18:57:03.800

首先，您可以将聚集索引放在唯一名称上，它不必放在 id 字段上。如果你很少或没有加入这个表，你可以摆脱 id。无论如何，我会在唯一名称字段上放置一个唯一索引（您可能会发现这样做并不像您想象的那样唯一！）。

如果你做了很多加入，我会保留 id 字段，它更小，加入更有效。

既然您说您是索引新手，我会指出，虽然主键在定义时会自动创建索引，但外键不会。您几乎总是希望索引您的外键字段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T18:57:19.540

只是出于习惯，我总是像 PK 一样创建一个身份字段“ID”。它使事情保持一致。如果所有“主”表都有一个名为“ID”的字段，即 INT Identity，那么 PK 是什么总是显而易见的。此外，如果我需要创建一个桥实体，我将存储两个（或更多）INT 类型的列，而不是 nvarchar() 类型。因此，在您的示例中，我会将 ID 保留为 PK 并在 UniqueName 上创建唯一索引。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T19:03:52.677

数据按聚集键的顺序存储；如果您要通过这些字段之一对数据进行密钥检索，那么使用假设值没有明显碎片化将是有利的，这会降低插入性能。

另一方面，如果此表在 ID 上连接到很多，则将聚集键保留在 PK 上可能更有意义。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T19:23:49.213

根本没有必要或没有必要拥有一个聚集索引，主键或其他。与所有索引策略一样，它是一种性能优化工具，应该在可以通过使用它获得改进时应用。

如前所述，因为表是根据聚集索引键进行物理排序的，所以这是一种汉兰达情况：只能有一个！

聚集索引主要用于以下情况：

*   您经常需要检索给定列的值在一个范围内的一组行，因此通常是 BETWEEN 子句主题的列很有趣；或者
*   表中的大多数单行命中都发生在可由键值的子集描述的区域中。

我认为它们对于诸如当顺序键是聚集列时具有非常频繁插入的大容量事务系统的情况特别无用。你会得到一帮进程都试图在同一个物理位置（“热点”）插入。事实证明，正如在此编辑之前在这里评论的那样，我很遗憾已经过时并且显示了我的年龄。请参阅[Kimberley Tripp 的这篇关于该主题的帖子，](http://sqlskills.com/BLOGS/KIMBERLY/post/The-Clustered-Index-Debate-Continues.aspx)它说得好多了。

顺序数字“ID”列通常不是很好的候选列。名字可以很好，日期也可以——如果仔细考虑的话。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T20:23:30.643

通常，最好在标识键上为表建立索引并将其用作聚集索引。这里有一个简单的经验法则

*不要使用有意义的列作为主索引*

这样做的原因是，通常在有意义的列上使用 PK 往往会引起维护问题。这是一个经验法则，因此可以在这种情况下被覆盖，但通常最好从由（聚集的）无意义的标识列索引的每个表的假定默认位置开始工作。这对于连接往往更有效，并且由于它通常是大多数 DBA 将采用的默认设计，因此不会引起任何关注或产生任何问题，因为它们的系统不像下一个 DBA 可能假设的那样。毫无意义的 PK 总是更灵活，更容易适应不断变化的环境。

何时覆盖规则？仅当您确实设想性能问题时。对于大多数在适当索引的现代硬件上具有合理负载的数据库，如果您不通过对最佳索引进行聚类来从它们中挤出最后一毫秒的性能，那么您将不会遇到任何问题。DBA 和程序员周期比 CPU 周期要昂贵得多，如果您通过采用不同的策略仅将查询中的奇数毫秒左右缩短，那么它就是不值得的。但是，如果您正在查看接近一百万行的表，那就另当别论了。这在很大程度上取决于具体情况，但一般来说，如果我正在设计一个表少于 100,000 行的数据库，我会非常倾向于设计灵活性，易于编写稳定的查询，以及任何其他设计师都希望看到的原则。超过一百万行然后我设计性能。在 10 万到 100 万之间，这是一个判断问题。

# c# - 将数组从 C++ 移动到 C#、对其进行修改并将其传回 C++ 的最简单方法

> ID：575455
> 
> 赞同：6
> 
> 时间：2009-02-22T18:52:25.730
> 
> 标签：c#, c++, com, interop

我有一个 C# 类库，其中包含需要与外部应用程序一起使用的方法。不幸的是，这个外部应用程序只支持 C/C++ 中的外部 API。

现在，我设法获得了一个在 C++ dll 和 C# DLL 之间工作的非常简单的 COM 示例，但我被困在如何移动数组数据上。

这是我到目前为止所得到的，就像我在通过 COM 通信的网络上找到的一个小例子一样：

```
DLL_EXPORT(void) runAddTest(int add1,long *result) {
    // Initialize COM.
    HRESULT hr = CoInitialize(NULL);

    // Create the interface pointer.
    IUnitModelPtr pIUnit(__uuidof(UnitModel));

    long lResult = 0;

    // Call the Add method.
    pIUnit->Add(5, 10, &lResult);

    *result = lResult;

    // Uninitialize COM.
    CoUninitialize();

} 
```

这可以很好地调用我的 C# 类中的 add 方法。如何修改它以获取并返回一个双精度数组？（我还需要用字符串来做）。

我需要获取一个非托管数组，将此数组传递给 C# 类进行一些计算，然后将结果传递回原始函数调用（非托管）C++ 中指定的数组引用。

我需要公开这样的函数：

* * *

*calcin - 对双精度数组的引用

*calcOut - 对双精度数组的引用

numIN - 输入数组的大小值

```
DLL_EXPORT(void) doCalc(double *calcIn, int numIn, double *calcOut)
{
      //pass the calcIn array to C# class for the calcuations

      //get the values back from my C# class

      //put the values from the C# class 
      //into the array ref specified by the *calcOut reference 

} 
```

* * *

我*想*我可以为外部应用程序使用 C++\CLI DLL，所以如果这比直接 COM 更容易，那么我愿意看看。

请温柔一点，因为我主要是 C# 开发人员，但已经陷入了 Interop 和 C++ 的深渊。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T23:11:57.730

我不久前对此进行了实验，但不幸的是忘记了它们是如何组合在一起的……出于我的目的，结果证明它非常缓慢，所以我删掉了 C# 并回到了所有 C++。当您说您主要是 C# 开发人员时，我希望您理解指针，因为如果您不理解，就没有办法变得温柔。

传递数组基本上归结为在 C++ 端使用 CoTaskMemAlloc 系列函数（[http://msdn.microsoft.com/en-us/library/ms692727(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms692727(VS.85).aspx)）和在 C# 端使用 Marshal 类（[http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.aspx](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.aspx) - 具有 AllocCoTaskMem 等方法。对于 C#，我最终得到了一个实用程序类：

```
public class serviceUtils
{
    unsafe public long stringToCoTaskPtr( ref str thestring )
    {
        return (long)Marshal.StringToCoTaskMemAnsi(thestring.theString).ToPointer();//TODO : what errors occur from here? handle them
    }

    unsafe public long bytesToCoTaskPtr( ref bytes thebytes, ref short byteCnt)
    {
        byteCnt = (short)thebytes.theArray.Length;
        IntPtr tmpptr = new IntPtr();
        tmpptr = Marshal.AllocCoTaskMem(byteCnt);
        Marshal.Copy(thebytes.theArray, 0, tmpptr, byteCnt);
        return (long)tmpptr.ToPointer();
    }

    public void freeCoTaskMemPtr(long ptr)
    {
        Marshal.FreeCoTaskMem(new IntPtr(ptr));//TODO : errors from here?
    }

    public string coTaskPtrToString(long theptr)
    {
        return Marshal.PtrToStringAnsi(new IntPtr(theptr));
    }

    public byte[] coTaskPtrToBytes(long theptr, short thelen)
    {
        byte[] tmpbytes = new byte[thelen];
        Marshal.Copy(new IntPtr(theptr), tmpbytes, 0, thelen);
        return tmpbytes;
    }
} 
```

只是为了向您抛出更多代码：this c++

```
#import "..\COMClient\bin\Debug\COMClient.tlb" named_guids raw_interfaces_only
int _tmain(int argc, _TCHAR* argv[])
{
CoInitialize(NULL);   //Initialize all COM Components
COMClient::IComCalculatorPtr pCalc;
// CreateInstance parameters
HRESULT hRes = pCalc.CreateInstance(COMClient::CLSID_ComCalculator);
if (hRes == S_OK) {
    long size = 5;
    LPVOID ptr = CoTaskMemAlloc( size );
    if( ptr != NULL )
    {
        memcpy( ptr, "12345", size );
        short ans = 0;
        pCalc->changeBytes( (__int64*)&ptr, &size, &ans );
        CoTaskMemFree(ptr);
    }
}

CoUninitialize ();   //DeInitialize all COM Components

return 0;
} 
```

叫这个c#

```
 public short changeBytes(ref long ptr, ref int arraysize)
    {
        try
        {
            IntPtr interopPtr = new IntPtr(ptr);                
            testservice.ByteArray bytes = new testservice.ByteArray();
            byte[] somebytes = new byte[arraysize];
            Marshal.Copy(interopPtr, somebytes, 0, arraysize);
            bytes.theArray = somebytes;

            CalculatorClient client = generateClient();
            client.takeArray(ref bytes);
            client.Close();
            if (arraysize < bytes.theArray.Length)
            {
                interopPtr = Marshal.ReAllocCoTaskMem(interopPtr, bytes.theArray.Length);//TODO : throws an exception if fails... deal with it
            }
            Marshal.Copy(bytes.theArray, 0, interopPtr, bytes.theArray.Length);
            ptr = interopPtr.ToInt64();

            arraysize = bytes.theArray.Length;

            //TODO : do we need to free IntPtr? check all code for memory leaks... check for successful allocation
        }
        catch(Exception e)
        {
            return 3;
        }

        return 2;
    } 
```

抱歉，但我没有时间解决所有这些问题并正确解释它，希望这会给你指明正确的方向，至少谷歌的一些东西。祝你好运

PS：我从网上得到了写这些东西的所有信息，所以它就在那里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T22:56:30.747

> 我想我可以为外部应用程序使用 C++\CLI DLL，所以如果这比直接 COM 更容易，那么我愿意看看。

如果您没有太多 COM 经验（并且数组在 COM 中明显不简单），那么围绕第 3 方的 C++/CLI 包装器^(可能)会更容易。

它也将只涉及单个编组阶段（本机 <-> 托管），而不是托管 <-> COM 接口所需的必要 COM 可调用包装器的额外步骤）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-06T15:46:15.833

这也行吗？

在 C# 中， 1\. 调用 Marshal.PtrToStructure 2\. 修改值 3\. 调用 Marshal.StructureToPtr

# php - 用 C/C++ 编写的 PHP 词法和语法分析器

> ID：575460
> 
> 赞同：1
> 
> 时间：2009-02-22T18:55:11.683
> 
> 标签：php, c++, syntax

我正在为我的硕士项目在 Qt4 中编写一个 PHP IDE。我正在尝试复制 Eclipse 或 Visual Studio 的许多功能，而不会产生臃肿和开销。我正在尝试进行一些代码完成，但我需要进行一些语法分析才能实现智能代码完成。我查看了 PHP 源代码并考虑在我的代码中编译 Zend 引擎（并在应得的地方给予信任），但即使在盯着代码几天后我也不知道从哪里开始接着就，随即。

有谁知道一些已经完成此任务的 C++ 代码，或者已经将 Zend 引擎用于他们自己的目的，或者对我自己的编写有一些建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T20:11:52.577

PHP 没有任何与正式的*LALR* (1) 或 LL(k) 语法相近的东西，您可以使用它们以适合学术界的方式实现这一点。Zend 的解析器不是上下文感知的，并且充满了我所看到的特殊消歧。

这并不是说你不能写一些简单的语法高亮。[以这个 javascript 实现](http://marijn.haverbeke.nl/codemirror/contrib/php/)为例。他们的标记器的代码在[这里](http://marijn.haverbeke.nl/codemirror/contrib/php/js/tokenizephp.js)，关于该项目的活动线程在[这里](http://groups.google.com/group/codemirror/browse_thread/thread/20cd864c74753db8?pli=1)。

# jquery - Jquery 多个过滤器，例如 www.tretti.se

> ID：575473
> 
> 赞同：1
> 
> 时间：2009-02-22T19:03:30.243
> 
> 标签：jquery, filtering

任何人都知道要找到一个 jquery 插件，它可以帮助我为[http://www.tretti.se/vitvaror/frysar/frysskap等项目构建过滤器/分页/排序](http://www.tretti.se/vitvaror/frysar/frysskap)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T02:55:41.483

我认为你真的只需要一个[滑块](http://docs.jquery.com/UI/Slider)和一些关于分页/过滤的 AJAX 的体面知识。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T00:33:59.763

那里有一些非常标准的类似 jQuery UI 的小部件，比如滑块。但我认为你必须自己建造它。漂亮的网站特定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-25T13:27:08.837

试试这个[http://www.webegg.co.uk/jquery-multiple-filter/](http://www.webegg.co.uk/jquery-multiple-filter/) ;)

# c# - 任何想法为什么这不起作用？C＃

> ID：575474
> 
> 赞同：0
> 
> 时间：2009-02-22T19:03:41.180
> 
> 标签：c#, regex

```
public class MyExample
{

    public static void Main(String[] args)
    {

string input = "<a href=\"http://tvrss.net/search/?show_name=The+Venture+Bros&amp;show_name_exact=true\">The Venture Bros</a></p></li>";

    // Call Regex.Match
    Match m = Regex.Match(input, "/show_name=(.*?)&amp;show_name_exact=true\">(.*?)</i");

   // Check Match instance
    if (m.Success)
    {
        // Get Group value
        string key = m.Groups[1].Value;
        Console.WriteLine(key);
        // alternate-1
    }

    } 
```

我想要“The Venture Bros”作为输出（在这个例子中）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T19:15:45.613

我认为这是因为您正在尝试在前面和结尾处使用 perl 样式的斜线。其他几个回答者已经对此感到困惑。他写它的方式是，他试图通过以 / 开头和结尾并在末尾加上 i 来做到不区分大小写，就像你在 perl 中所做的那样。

但我很确定 .NET 正则表达式不会那样工作，这就是导致问题的原因。

编辑：更具体地说，查看 RegexOptions，我从 MSDN 中提取的一个示例是这样的：

```
Dim rx As New Regex("\b(?<word>\w+)\s+(\k<word>)\b", RegexOptions.Compiled Or RegexOptions.IgnoreCase) 
```

那里的关键是“RegexOptions.IgnoreCase”，这将导致您尝试使用/pattern/i 的效果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T19:19:02.593

试试这个 ：

```
string input = "<a href=\"http://tvrss.net/search/?show_name=The+Venture+Bros&amp;show_name_exact=true\">The Venture Bros</a></p></li>";

// Call Regex.Match
Match m = Regex.Match(input, "show_name=(.*?)&amp;show_name_exact=true\">(.*?)</a");

// Check Match instance
if (m.Success)
{
    // Get Group value
    string key = m.Groups[2].Value;
    Console.WriteLine(key);
    // alternate-1
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T19:09:57.013

因为前面的问号`show_name`。它在输入中但不在模式中，因此不匹配。

此外，您尝试匹配`</i`但输入不包含这个（它包含`</li>`）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T19:19:39.347

在您的情况下，正确的正则表达式是

```
^.*&amp;show_name_exact=true\"\>(.*)</a></p></li>$ 
```

正则表达式很棘手，但在[http://www.regular-expressions.info/](http://www.regular-expressions.info/)你可以找到一个很棒的教程

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T19:19:43.217

/?show_name=(. *)&show_name_exact=true\">(.* )

我相信会像你期望的那样工作。但我注意到的另一件事是，您正在尝试获取 group[1] 的值，但我相信您想要 group[2] 的值，因为将有 3 个组，第一个是匹配，并且第二个是第一组...

升;)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T19:07:31.653

首先，正则表达式开始“/show_name”，但目标字符串有“/?show_name”，所以第一组不想要第一个预期的命中。

这将导致整个正则表达式失败。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-29T01:44:12.590

好的，让我们分解一下。

测试数据：`"<a href=\"http://tvrss.net/search/?show_name=The+Venture+Bros&amp;show_name_exact=true\">The Venture Bros</a></p></li>"`

原始正则表达式：`"/show_name=(.*?)&amp;show_name_exact=true\">(.*?)</i"`

工作正则表达式：`"/\?show_name=(.*)&amp;show_name_exact=true\">(.*)</a"`

我们将从左边开始，通过正则表达式向右工作。

1.  “？” 变成了“\?” 这是因为一个“？” 表示前面的字符或组是可选的。当我们在它前面加上一个斜杠时，它现在匹配一个文字问号。

2.  `"(.*?)"`变成`"(.*)"`括号表示一个组，问号表示“可选”，但“*”已经表示“0或更多”，所以这实际上只是消除了冗余。

3.  `"</i"`成为`"</a"`此更改是为了匹配您的实际文本，该文本以`"</a>"`标签终止锚点。

建议的正则表达式：`"[\\W]show_name=([^><\"]*)&amp;show_name_exact=true\">([^<]*)<"`

（添加了额外的 \ 以提供正确的 c# 字符串转义。）

在 c# 中测试正则表达式的好工具是 code.google.com 上的 regex-freetool

# matlab - 如何在 MATLAB 中保存更改后的图像？

> ID：575475
> 
> 赞同：13
> 
> 时间：2009-02-22T19:03:49.183
> 
> 标签：matlab, file-io, image-manipulation

我想将图像读入 MATLAB，在其上绘制一个矩形，然后保存图像。

另外，我只是在学习 MATLAB——请温柔一点。看起来应该很简单，但我似乎做不到。

```
im = imread('image.tif');
imshow(im);
rectangle('Position', [100, 100, 10, 10]);
imwrite(im, 'image2.tif'); 
```

即使我可以看到图像上的矩形，保存的图像也不会显示矩形。如何保存图像并显示矩形？

FWIW，我已经尝试过了`saveas()`，但这给了我一个巨大的形象。有没有办法使用`saveas()`并使保存的图像具有正确的大小？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-22T19:23:55.170

矩形未显示在保存的图像中的原因是您没有修改`im`存储图像数据的变量。矩形只是显示在绘图图像上的绘图对象。您必须修改图像数据本身。

通常，读入 MATLAB 的图像作为 N×M×3 矩阵加载（即 N×M 像素图像，每个像素具有 RGB（红-绿-蓝）值）。通常，图像数据是 uint8 数据类型，因此 RGB 值的范围是 0 到 255。如果要更改给定像素的 RGB 值，可以执行以下操作：

```
im = imread('test.jpg');  % Load a jpeg image
im(1,1,1) = 255;  % Change the red value for the first pixel
im(1,1,2) = 0;    % Change the green value for the first pixel
im(1,1,3) = 0;    % Change the blue value for the first pixel
imwrite(im,'new.jpeg');  % Save modified image 
```

有多种方法可以一次修改多个像素（即矩形区域），这需要您研究如何索引到[多维数组](https://www.mathworks.com/help/matlab/math/multidimensional-arrays.html)。有关如何将不同类型的图像读入 MATLAB（即[truecolor](https://www.mathworks.com/help/matlab/creating_plots/image-types.html#f2-12468)与[indexed](https://www.mathworks.com/help/matlab/creating_plots/image-types.html#f2-155)）的更多详细信息，我会查看[imread](https://www.mathworks.com/help/matlab/ref/imread.html)的文档。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-11-06T13:48:12.580

对于顶部的问题，matlab 提供了一个非常简单的解决方案：

```
% you so far

im = imread('image.tif');
imshow(im);
rectangle('Position', [100, 100, 10, 10]);

% now you use "getframe" and "frame2im"

f = getframe(gca);
im = frame2im(f);

imwrite(im,'image2.tif'); 
```

当我还在图像上绘制一个矩形并尝试保存它时，这对我很有用。如果您想继续使用它，只需添加

```
imread('image2.tif'); 
```

并继续使用它:)

问候，劳拉

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-22T21:55:53.217

[MathWorks 网站](http://www.mathworks.com/support/solutions/data/1-P51QW.html?solution=1-P51QW)上实际上存在一个关于此问题的错误。太糟糕了，他们没有拼出真正的答案（因为，恕我直言，将尺子举到显示器上并不是真正的解决方案）。

使用该`print`命令，您必须手动更改`-r`参数，直到保存的图像大小与输入图像的大小匹配。该`-r`参数指定保存图像的 DPI。由于大多数屏幕都有不同的 DPI，因此没有一种万能的解决方案。

```
im = imread('image.tif');
f = figure, imshow(im, 'Border', 'tight');
rectangle('Position', [100, 100, 10, 10]);
print(f, '-r80', '-dtiff', 'image2.tif'); 
```

使用上面的代码，调整`-r`参数直到它看起来正确，瞧！

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-23T17:33:13.947

跟进 [雅各布科的](https://stackoverflow.com/questions/575475/how-can-i-save-an-altered-image-in-matlab/575895#575895)回答。设置图形*纸张位置*和*纸张*单位属性以及轴*单位*和*位置*属性通常会给我想要的结果，而无需调整分辨率。所以，

```
>> im = imread('image.tif');
>> f = figure, imshow(im);
>> r=rectangle('Position',[100, 100,10,10]);
>> set(r,'edgecolor','b') % change the color of the rectangle to blue
>> set(f,'units','centimeters','position',[1 1 2.5 2.5]) % set the screen size and position
>> set(f,'paperunits','centimeters','paperposition',[1 1 2.5 2.5]) % set size and position for printing
>> set(gca,'units','normalized','position',[0 0 1 1]) % make sure axis fills entire figure
>> print(f, '-r80','-dtiff','image2.tif') 
```

输出图像 image2.tif 现在将是 2.5 厘米 x 2.5 厘米，分辨率为 80dpi，没有围绕轴的边框。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-22T19:23:45.453

如果要保存im，必须先修改它的值。我不熟悉矩形功能，但您可以执行以下操作（蛮力）：

```
im = imread('image.tif');
im(100:110,100)=0;
im(100:110,110)=0;
im(100,100:110)=0;
im(110,100:110)=0;
imshow(im);
imwrite(im, 'image2.tif'); 
```

请注意，上面的代码是针对灰度图像的，如果您的图像是 RGB 图像，则需要执行以下操作：

```
 im(100:110,100,:)=0;
 .... 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-22T20:01:19.090

您也许可以使用`getframe`从图形窗口中获取修改后的图像。`getframe`我认为您可以将to返回的结构的 cdata 和 colormap 字段`imwrite`分别作为图像及其颜色图传递。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-08-30T11:41:24.937

```
[f,p] = uigetfile('*.*');
I = imread([p,f]);
imwrite(I,'img12.tif');% 
```

我们可以为保存图像提供的任何名称

它会自动保存在您的文件夹中，您可以浏览任何图像。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-29T22:40:06.470

```
close all; clear; clc;

r = 240 ; c = 320;

fig = figure('Visible', 'off');
imshow( zeros(r,c) );
hold on;
plot([c-fix(c/2),c-fix(c/2)],[r-fix(r/2),r-fix(r/2)],'r*', 'MarkerSize', 10 );

% Sets position and size of figure on the screen
set(fig, 'Units', 'pixels', 'position', [100 100 c r] ); 

% Sets axes to fill the figure space
set(gca, 'Units', 'pixels', 'position', [0 0 c+1 r+1 ]);

% Sets print properties; Looks like 1 pixel = (3/4)th of a point
set(fig, 'paperunits', 'points', 'papersize', [fix((c-1)*(3/4))+1 fix((r-1)*(3/4))+1]);
set(fig, 'paperunits', 'normalized', 'paperposition', [0 0 1 1]);

print( fig, sprintf('-r%d', ceil(72*(4/3))), '-dpng', 'image.png' ); 

im = imread( 'image.png');
figure; imshow(im); 
```

# javascript - javascript中的关联数组

> ID：575480
> 
> 赞同：2
> 
> 时间：2009-02-22T19:05:06.573
> 
> 标签：javascript, arrays, oop

我有这个对象：

```
function formBuddy()
{
    var fields = new Array();
    var labels = new Array();
    var rules = new Array();
    var count=0;

    this.addField = function(field, label, rule)
    {
        fields[count] = field;
        labels[field] = label;
        rules[field] = rule;
        count = ++count;
    }
} 
```

它以这种方式使用：

```
var cForm=new formBuddy();
cForm.addField("c_first_name","First Name","required");
cForm.addField("c_last_name","Last Name","required"); 
```

问题是，在`addField()`函数中，`fields`数组被设置正确（可能是因为使用数字索引来引用它）但其他 2 个数组（`labels`和`rules`）根本没有被触及。做一个`console.log`显示它们在萤火虫中是空的。

我需要改变什么才能使它们工作？我还是想通过字段的字符串索引来引用规则和标签。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-22T19:08:40.963

改为使用对象：

```
function formBuddy()
{
    var fields = {};
    var labels = {};
    var rules = {};
    var count = 0;

    this.addField = function(field, label, rule)
    {
        fields[count] = field;
        labels[field] = label;
        rules[field] = rule;
        count++;
    }
} 
```

* * *

但正如[Christoph 已经提到](https://stackoverflow.com/revisions/575533/list#spacer-762632)的那样，我也会将这些信息存储在单个数据结构中。例如：

```
function formBuddy() {
    var fields = {};
    this.addField = function(name, label, rule) {
        fields[name] = {
            name: name,
            label: label,
            rule: rule
        };
    };
    this.getField = function(name) {
        return fields[name];
    };
}

var cForm=new formBuddy();
cForm.addField("c_first_name","First Name","required");
cForm.addField("c_last_name","Last Name","required");
alert(cForm.getField("c_last_name").label); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T19:27:44.960

`fields`应该是一个数组，而`labels`and`rules`应该是对象，因为您想使用字符串作为键。此外，对于（构造函数的名称应该大写）`addField()`的每个实例都是相同的，并且应该驻留在原型中，即`FormBuddy()`

```
function FormBuddy() {
    this.fields = []; // this is the same as `new Array()`
    this.labels = {}; // this is the same as `new Object()`
    this.rules = {};
}

FormBuddy.prototype.addField = function(field, label, rule) {
    this.fields.push(field);
    this.labels[field] = label;
    this.rules[field] = rule;
}; 
```

您可以通过以下方式访问标签/规则

```
var buddy = new FormBuddy();
buddy.addField('foo', 'bar', 'baz');
alert(buddy.labels['foo']);
alert(buddy.rules.foo); 
```

* * *

只是为了进一步激怒卢卡；），这是另一个版本，它也没有封装任何东西：

```
function FormBuddy() {
    this.fields = [];
}

FormBuddy.prototype.addField = function(id, label, rule) {
    var field = {
        id : id,
        label : label,
        rule : rule
    };

    this.fields.push(field);
    this['field ' + id] = field;
};

FormBuddy.prototype.getField = function(id) {
    return this['field ' + id];
};

var buddy = new FormBuddy();
buddy.addField('foo', 'label for foo', 'rule for foo'); 
```

它类似于 Gumbo 的第二个版本，但他的`fields`对象被合并到`FormBuddy`实例中。而是添加了一个名为的数组`fields`以允许快速迭代。

要访问字段的标签、规则或 ID，请使用

```
buddy.getField('foo').label 
```

要遍历字段，请使用

```
// list rules:
for(var i = 0, len = buddy.fields.length; i < len; ++i)
    document.writeln(buddy.fields[i].rule); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T19:25:38.850

数组在Javascript中被视为对象，因此您的代码有效，只是萤火虫`console.log`没有向您显示数组内的“对象”，而只是数组值......

使用`for(var i in obj)`来查看 Array 包含的对象值：

```
function formBuddy() {
    var fields = new Array();
    var labels = new Array();
    var rules = new Array();
    var count=0;

    this.addField = function(field, label, rule)
    {        
        fields[count] = field;
        labels[field] = label;
        rules[field] = rule;
        count = ++count;

        for(var i in labels) {
            console.log(labels[i]);
        }
        for(var i in rules) {
            console.log(rules[i]);
        }

        console.log(labels.c_last_name);
        // or
        console.log(labels["c_last_name"]);
    }
}

var cForm = new formBuddy();
cForm.addField("c_last_name","Last Name","required"); 
```

# iphone - 闪烁的颜色

> ID：575485
> 
> 赞同：0
> 
> 时间：2009-02-22T19:08:31.213
> 
> 标签：iphone, objective-c, xcode, colors

我试图让 iPhone 背景颜色每隔 X 秒改变一次颜色。

我怎样才能做到这一点？

我一直在尝试 UIAnimation 但只能让它更改为列表中的最后一种颜色。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T19:22:02.757

您可以使用自定义动画来遍历一组颜色，或者只使用计时器。计时器将调用一个设置所选背景颜色的函数，然后在视图上调用 setNeedsDisplay。伊

```
-(void) timerEntry
{
  UIColor* color = [colorArray objectAtIndex: colorIndex++];
  self.backgroundColor = color;
  [self setNeedsDisplay];
  if (colorIndex == [colorArray count])
    colorIndex = 0;
} 
```

然后设置定时器：

```
[NSTimer scheduledTimerWithTimeInterval:0.1f target:self selector:@selector(timerEntry) userInfo: nil repeats: NO]; 
```

# perl - Perl 中的 grep 和 map 有什么区别？

> ID：575490
> 
> 赞同：14
> 
> 时间：2009-02-22T19:11:25.217
> 
> 标签：perl, map, grep

在 Perl 中，`grep`and都`map`接受一个表达式和一个列表，并为列表中的每个元素计算表达式。

两者有什么区别？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-22T19:12:32.220

`grep`返回原始列表中与表达式匹配的元素，同时`map`返回应用于原始列表每个元素的表达式的结果。

```
$ perl -le 'print join " ", grep $_ & 1, (1, 2, 3, 4, 5)'
1 3 5
$ perl -le 'print join " ", map $_ & 1, (1, 2, 3, 4, 5)'
1 0 1 0 1 
```

第一个示例打印列表的所有奇数元素，而第二个示例根据相应元素是否为奇数打印 0 或 1。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-22T23:16:59.480

我发现以最一般的形式思考`grep()`和思考是有帮助的：`map()`

```
grep {BLOCK} LIST   
map  {BLOCK} LIST 
```

`grep()`是一个过滤器：它返回 LIST 中 BLOCK 返回 true 的项目子集。

`map()`是一个映射函数：将一个值从 LIST 发送到 BLOCK，BLOCK 返回一个包含 0 个或多个值的列表；所有这些对 BLOCK 的调用的组合集将是返回的最终列表`map()`。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-26T00:32:56.310

`map`将函数应用于列表中的所有元素并返回结果。

`grep`返回列表中的所有元素，当函数应用于它们时，它们的计算结果为 true。

```
my %fruits = (
  banana => {
    color => 'yellow',
    price => 0.79,
    grams => 200
  },
  cherry => {
    color => 'red',
    price => 0.02,
    grams => 10
  },
  orange => {
    color => 'orange',
    price => 1.00,
    grams => 225
  }
);

my %red_fruits = map { $_ => $fruits{$_} }
                   grep { $fruits{$_}->{color} eq 'red' }
                     keys(%fruits);

my @prices = map { $fruits{$_}->{price} } keys(%fruits);
my @colors = map { $fruits{$_}->{color} } keys(%fruits);
my @grams  = map { $fruits{$_}->{grams} } keys(%fruits);

# Print each fruit's name sorted by price lowest to highest:
foreach( sort { $fruits{$a}->{price} <=> $fruits{$b}->{price}} keys(%fruits) )
{
  print "$_ costs $fruits{$_}->{price} each\n";
}# end foreach() 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-22T20:24:38.817

关于 的另一件事`grep`：在标量上下文中，它告诉您找到了多少项目。如果您真的不想要第二个列表，但您确实想知道有多少特定种类的项目，这可能很有用。

```
my @numbers = qw/1 2 3 4 5 6/;

my @odd_numbers  = grep { $_ & 1 } @numbers; # grep returns (1, 3, 5)

my $how_many_odd = grep { $_ & 1 } @numbers; # grep returns 3 
```

编辑：由于 OP 在评论中询问，我应该说您可以`map`以相同的方式在标量上下文中使用。关键不是这`grep`两个中唯一一个可以做到这一点，而是有时用`grep`.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-22T20:05:20.237

将 grep 视为带有过滤器的映射。map 迭代并提供对每个项目做某事的机会。例如这两行是等价的：

```
my @copy = @original;
my @copy = map {$_} @original; 
```

同样，这两个是等价的：

```
my @copy = grep {-f $_} @original;

@copy = ();
for (@original)
{
  push @copy, $_ if -f $_;
} 
```

grep 提供插入条件的能力，因此成为过滤器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-05-19T08:04:58.000

开玩笑：grep 给出它的块标量上下文，map 给出它的块列表上下文。（并且 BLOCK foreach LIST 给出了它的块无效上下文。）

# asp.net - 使用javascript将值传递给字段

> ID：575498
> 
> 赞同：2
> 
> 时间：2009-02-22T19:17:40.007
> 
> 标签：asp.net, javascript

我目前正在构建一个需要一些查找控件的应用程序。这将如何工作是在表单上有一个带有查找按钮的 texbox。用户可以为文本框输入一个值，也可以选择查找按钮。当用户按下查找按钮时，会出现一个带有 gridview 和列列表的 javascript 窗口。我想做的是允许查找窗口将选定的gridview值传回第一页上的文本框并禁用文本框。

谁能帮我举个例子来说明如何去做？

提前致谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-22T19:24:00.867

如果您使用 window.open() 打开一个窗口，您可以访问指向打开窗口的 opener 对象并访问它的 dom/jhavascipt 函数。// 在窗口中 var retVal = ... opener.MyFunction(retVal) this.close()

```
// in main page
var valFromWindow = null;
function MyFunction(val)
{
   valFromWindow = val;
} 
```

如果您通过使隐藏的 div 可见来打开一个窗口，那么您可以使用当前窗口中的任何 javascript。

如果您使用 window.showModalDialog 打开一个窗口，您可以使用 returnValue 属性传回值。window.returnValue = "myretval" // 在模式对话框中

```
var retval = window.showModalDialog(...) // in main window 
```

# java - Java Regex - 减少字符串中的空格

> ID：575500
> 
> 赞同：11
> 
> 时间：2009-02-22T19:17:44.047
> 
> 标签：java, regex

我没有时间了解正则表达式，我需要一个快速的答案。平台是Java。

我需要字符串

```
"Some text   with  spaces" 
```

...转换为

```
"Some text with spaces" 
```

即，2 个或多个连续的空格被更改为 1 个空格。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-02-22T19:21:40.060

```
String a = "Some    text  with   spaces";
String b = a.replaceAll("\\s+", " ");
assert b.equals("Some text with spaces"); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-22T21:07:49.960

如果我们专门讨论空间，您希望专门针对空间进行测试：

```
MyString = MyString.replaceAll(" +", " "); 
```

使用**`\s`**将导致**所有空格**被替换 - 有时需要，有时不需要。

此外，仅匹配 2 个或更多的更简单方法是：

```
MyString = MyString.replaceAll(" {2,}", " "); 
```

（当然，`\s`如果希望将任何空格替换为单个空格，则可以使用这两个示例。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-06-11T10:30:52.187

对于 Java（不是 javascript，不是 php，不是其他）：

```
txt.replaceAll("\\p{javaSpaceChar}{2,}"," ") 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-08-26T02:34:44.037

您需要使用一个常量[`java.util.regex.Pattern`](http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html)来避免每次都重新编译表达式：

```
private static final Pattern REGEX_PATTERN = 
        Pattern.compile(" {2,}");

public static void main(String[] args) {
    String input = "Some text   with spaces";
    System.out.println(
        REGEX_PATTERN.matcher(input).replaceFirst(" ")
    );  // prints "Some text with spaces"
} 
```

以另一种方式，[Apache Commons Lang](http://commons.apache.org/proper/commons-lang/)在类[`StringUtils`](http://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/StringUtils.html)中包含 method [`normalizeSpace`](http://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/StringUtils.html#normalizeSpace%28java.lang.String%29)。

# asp.net - asp.net 508/WAI CMS

> ID：575502
> 
> 赞同：0
> 
> 时间：2009-02-22T19:18:37.900
> 
> 标签：asp.net, accessibility, section508

2个问题：

1.  使用 MVC 是否可以更轻松地构建符合 508/WAI 的站点？
2.  任何人都知道一个好的基于 508/WAI 的基于 asp.net 的 CMS 平台，或者至少，它试图让构建网站变得更容易？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T01:06:20.123

1.) 我认为确实如此。MVC 使您可以完全控制正在呈现的 HTML，从而更容易完全符合 508。

2.) 我正在为使用[Sitecore](http://www.sitecore.net/)作为 CMS 的政府开发符合 508 的解决方案。这是一款出色的产品，在 508 合规性方面非常出色。除了让您完全控制正在呈现的 HTML 之外，它还具有一些简洁的内置 508 功能。例如，如果人们将图像添加到项目中，如果他们忘记添加替代文本，系统会警告他们。您还可以将自己的验证规则添加到系统中。

强烈推荐，但不是很便宜。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T08:22:33.770

1.  正如[Stefan 所说](https://stackoverflow.com/questions/575502/asp-net-508-wai-cms/923965#923965)，是的，因为对标记的控制 - 例如：您将能够更简单地创建一个通过 (X)HTML 验证的页面，因为您不必与正在呈现的视图状态控件作斗争到 id 中带有“_”的页面。

2.  在价格范围的另一端（开源），我最近开始使用[N2 CMS](http://www.n2cms.com/)的 MVC 示例，它工作得非常好（等待客户看到它，所以不能真正发布链接此时此刻）。但这通过了 W3C、Hi Software 的 Cynthia 508 和 WAI 合规性检查。

我们在许多 CMS 产品中发现的真正问题不是网站合规，而是编辑界面不合规/不可访问，或者内容编辑器很容易在某处使用一些愚蠢的标记来破坏验证。

# perl - 如何解决 Perl 中的一组约束？

> ID：575515
> 
> 赞同：10
> 
> 时间：2009-02-22T19:22:06.283
> 
> 标签：perl, math, constraints, linear-algebra, linear-programming

我在 Perl 中有以下一组约束（只是一组示例约束，不是我真正需要的约束）：

```
$a < $b
$b > $c
$a is odd => $a in [10..18]
$a > 0
$c < 30 
```

我需要找到一个`($a, $b, $c)`满足约束的列表。我天真的解决方案是

```
sub check_constraint {
    my ($a, $b, $c) = @_;
    if !($a < $b) {return 0;}
    if !($b > $c) {return 0;}
    if (($a % 2) && !(10 <= $a && $a <= 18)) {return 0;}
    if !($a > 0) {return 0;}
    if !($c < 30) {return 0;}
    return 1;
}

sub gen_abc {
    my $c = int rand 30;
    my $b = int rand $c;
    my $a = int rand $b;
    return ($a, $b, $c);
}

($a, $b, $c) = &gen_abc();
while (!&check_constraint($a, $b, $c)) {
    ($a, $b, $c) = &gen_abc();
} 
```

现在，这个解决方案不能保证结束，而且通常效率很低。在 Perl 中有没有更好的方法来做到这一点？

**编辑：** 我需要这个用于随机测试生成器，因此解决方案需要使用随机函数，例如`rand()`. 完全确定性的解决方案是不够的，尽管如果该解决方案可以给我一个可能组合的列表，我可以随机选择一个索引：

```
@solutions = &find_allowed_combinations(); # solutions is an array of array references
$index = int rand($#solutions);
($a, $b, $c) = @$solution[$index]; 
```

**编辑2：** 这里的约束很容易用蛮力解决。但是，如果有许多变量具有很大范围的可能值，那么蛮力不是一种选择。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-22T23:48:21.433

这个优化问题的主要挑战本质上是数学。

正如我从您对方法的定义中推断的那样，您的目标是通过查找各种变量（等）`gen_abc`的边界间隔来修剪您的搜索空间。`$a``$b`

最好的策略是从你的全部约束中提取尽可能多的*线性*约束，尝试推断边界（使用[线性规划](http://en.wikipedia.org/wiki/Linear_programming)技术，见下文），然后针对修剪变量空间。

典型的[线性规划问题](http://en.wikipedia.org/wiki/Linear_programming)具有以下形式：

```
minimize (maximize) <something>
subject to <constraints> 
```

例如，给定三个变量 、`a`和`b`，`c`以及以下线性约束：

```
<<linear_constraints>>::
  $a < $b
  $b > $c
  $a > 0
  $c < 30 
```

您可以找到 的上限和下限`$a`，如下所示：`$b``$c`

```
lower_bound_$a = minimize $a subject to <<linear_constraints>>
upper_bound_$a = maximize $a subject to <<linear_constraints>>
lower_bound_$b = minimize $b subject to <<linear_constraints>>
upper_bound_$b = maximize $b subject to <<linear_constraints>>
lower_bound_$c = minimize $c subject to <<linear_constraints>>
upper_bound_$c = maximize $c subject to <<linear_constraints>> 
```

**在 Perl 中，你可以使用[Math::LP](http://search.cpan.org/perldoc?Math::LP)来达到这个目的。**

* * *

**例子**

线性约束的形式为“ `C eqop C1×$V1 ± C2×$V2 ± C3×$V3 ...`”，其中

*   `eqop`是`<`, `>`, `==`, `>=`,之一`<=`
*   `$V1`等`$V2`是变量，并且
*   `C`, `C1`,`C2`等是常数，可能等于 0。

例如，给定...

```
$a < $b
$b > $c
$a > 0
$c < 30 
```

...将所有变量（及其系数）移到不等式的左侧，将单独的常数移到不等式的右侧：

```
$a - $b       <  0
     $b - $c  >  0
$a            >  0
          $c  < 30 
```

...并调整约束，以便只使用`=`,`<=`和`>=`(in) 等式（假设我们的变量是离散的，即整数值）：

*   '... < C' 变成 '... <= C-1'
*   '... > C' 变成 '... >= C+1'

...那是，

```
$a - $b       <= -1
     $b - $c  >=  1
$a            >=  1
          $c  <= 29 
```

...然后写这样的东西：

```
use Math::LP qw(:types);             # imports optimization types
use Math::LP::Constraint qw(:types); # imports constraint types

my $lp = new Math::LP;

my $a  = new Math::LP::Variable(name => 'a');
my $b  = new Math::LP::Variable(name => 'b');
my $c  = new Math::LP::Variable(name => 'c');

my $constr1 = new Math::LP::Constraint(
    lhs  => make Math::LP::LinearCombination($a, 1, $b, -1), # 1*$a -1*$b
    rhs  => -1,
    type => $LE,
);
$lp->add_constraint($constr1);
my $constr2 = new Math::LP::Constraint(
    lhs  => make Math::LP::LinearCombination($b, 1, $c, -1), # 1*$b -1*$c
    rhs  => 1,
    type => $GE,
);
$lp->add_constraint($constr2);

...

my $obj_fn_a = make Math::LP::LinearCombination($a,1);
my $min_a = $lp->minimize_for($obj_fn_a);
my $max_a = $lp->maximize_for($obj_fn_a);

my $obj_fn_b = make Math::LP::LinearCombination($b,1);
my $min_b = $lp->minimize_for($obj_fn_b);
my $max_b = $lp->maximize_for($obj_fn_b);

...

# do exhaustive search over ranges for $a, $b, $c 
```

当然，以上可以推广到任意数量的变量`V1`, `V2`, ...（例如`$a`, `$b`, `$c`, `$d`, ...），具有任何系数`C1`, `C2`, ... （例如 -1, 1, 0, 123 等）。 ) 和任何常量值`C`（例如 -1、1、30、29 等），前提是您可以将约束表达式解析为相应的矩阵表示，例如：

```
 V1  V2  V3     C
[ C11 C12 C13 <=> C1 ]
[ C21 C22 C23 <=> C2 ]
[ C31 C32 C33 <=> C3 ]
... ... ... ... ... ... 
```

适用于您提供的示例，

```
 $a  $b  $c     C
[  1  -1   0 <= -1 ]   <= plug this into a Constraint + LinearCombination
[  0   1  -1 >=  1 ]   <= plug this into a Constraint + LinearCombination
[  1   0   0 >=  1 ]   <= plug this into a Constraint + LinearCombination
[  0   0   1 <= 29 ]   <= plug this into a Constraint + LinearCombination 
```

* * *

**笔记**

附带说明一下，**如果**执行非确定性（`rand`基于**且仅当**：`($a,$b,$c)`

 ***   正在测试的方法比哈希查找更昂贵（您上面提供的示例代码不是这种情况，但您的真实代码可能有问题，也可能没有问题）
*   散列不会增长到很大的比例（所有变量都受有限区间的约束，其乘积是一个合理的数字 - 在这种情况下，检查散列大小可以表明您是否已经完全探索了整个空间 - 或者您可以清除定期散列，因此一次至少有一个时间间隔，您确实有一些碰撞检测。）
    *   最终，如果您认为上述内容适用于您，您可以对各种实施选项（有和没有散列）计时，看看是否值得实施。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T18:16:07.977

我使用[Data::Constraint](http://search.cpan.org/dist/Data-Constraint)。您编写实现各个约束的小子程序，然后依次应用您想要的所有约束。我在“Dynamic Subroutines”一章的[Mastering Perl](http://oreilly.com/catalog/9780596527242/)中谈到了这一点。

```
#!perl
use v5.20;

use Data::Constraint 1.121;
use experimental qw(signatures);

Data::Constraint->add_constraint(
    'a_less_than_b',
    run         => sub ( $c, $t ) { $t->[0] <  $t->[1] },
    description => "a < b",
    );

Data::Constraint->add_constraint(
    'b_greater_than_c',
    run         => sub ( $c, $t ) { $t->[1] >  $t->[2] },
    description => "b > c",
    );

Data::Constraint->add_constraint(
    'a_greater_than_0',
    run         => sub ( $c, $t ) { $t->[0] > 0 },
    description => "a > 0",
    );

Data::Constraint->add_constraint(
    'c_less_than_30',
    run         => sub ( $c, $t ) { $t->[2] < 30 },
    description => "c < 30",
    );

Data::Constraint->add_constraint(
    'a_is_odd_between_10_18',
    run         => sub ( $c, $t ) {
        return 0 if( $t->[0] < 10 or $t->[0] > 18 );
        return 0 unless $t->[0] % 2;
        return 1;
        },
    description => "a is odd between 10 and 18",
    );

for ( 1 .. 10 ) {
    my( $a, $b, $c ) = gen_abc();
    print "a = $a | b = $b | c = $c\n";

    foreach my $name ( Data::Constraint->get_all_names ) {
        print "\tFailed $name\n"
            unless Data::Constraint->get_by_name( $name )->check( [ $a, $b, $c ] ),
        }
    }

sub gen_abc {
    my $c = int rand 30;
    my $b = int rand 30;
    my $a = int rand 30;
    return ($a, $b, $c);
    } 
```

这样做意味着很容易检查结果以查看失败的原因而不是整体失败：

```
一个 = 25 | b = 11 | c = 23
    失败 a_is_odd_between_10_18
    失败 a_less_than_b
    失败的 b_greater_than_c
一个 = 17 | b = 0 | c = 9
    失败 a_less_than_b
    失败的 b_greater_than_c
a = 1 | b = 5 | c = 29
    失败 a_is_odd_between_10_18
    失败的 b_greater_than_c
一个 = 26 | b = 21 | c = 16
    失败 a_is_odd_between_10_18
    失败 a_less_than_b
一个 = 24 | b = 20 | c = 19
    失败 a_is_odd_between_10_18
    失败 a_less_than_b
一个 = 27 | b = 20 | c = 12
    失败 a_is_odd_between_10_18
    失败 a_less_than_b
一个 = 18 | b = 25 | c = 13
    失败 a_is_odd_between_10_18
一个 = 26 | b = 10 | c = 11
    失败 a_is_odd_between_10_18
    失败 a_less_than_b
    失败的 b_greater_than_c
一个 = 14 | b = 27 | c = 0
    失败 a_is_odd_between_10_18
一个 = 6 | b = 28 | c = 20
    失败 a_is_odd_between_10_18

```

如果你想要更硬核的东西，我的[Brick](http://search.cpan.org/dist/Brick)模块可以处理约束树，包括修剪和分支。这些事情对于更大的系统是有意义的，因为大多数代码都在设置约束对象，因此您将针对不同情况混合和匹配各种约束。如果你只有一种情况，你可能只想坚持你所拥有的。

祝你好运， ：）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-22T20:08:30.073

我不确定您是否会找到一个简单的答案（尽管我希望被证明是错误的！）。

看来您的问题很适合[遗传算法](http://en.wikipedia.org/wiki/Genetic_algorithm)。适应度函数应该很容易写，每个满足的约束只给 1 分，否则为 0 分。 [AI::Genetic](http://search.cpan.org/dist/AI-Genetic)似乎是一个可以帮助您编写代码和理解您需要编写的内容的模块。

这应该比蛮力方法更快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T19:58:32.670

“真实”的答案需要解析表达式并推理关系。除此之外，我建议使用值空间的系统遍历，而不是随机尝试值。例如，

```
my $count = 0;
for (my $c = 0; $c < 30 && $count < $SOMELIMIT; ++$c) {
    # check all other constraints on only $c here
    # next if any fail
    for (my $b = $c + 1; $b < $UPPERLIMIT && $count < $SOMELIMIT; ++$b) {
        # check all other constraints on only $b and $c here
        # next if any fail
        for (my $a = 1; $a < $b && $count < $SOMELIMIT; ++$a) {
            #check all remaining constraints on $a, $b, and $c here
            # next if any fail
            # now use surviving combinations
            ++$count;
        }
    }
} 
```

我会将具有最个别约束的变量放在最外层，接下来是最受约束的变量，等等。

至少使用这种结构，您不会多次测试相同的组合（因为随机版本很可能会这样做），并且如果您观察它的运行，您可能会看到模式出现，可以让您缩短执行时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T19:48:43.537

似乎[Simo::Constrain](http://search.cpan.org/~kimoto/Simo-Constrain-0.0201/lib/Simo/Constrain.pm#NAME)是你想要的

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T20:31:48.237

相反，我会创建一个生成一堆有效列表的算法，无论是否随机生成（这应该是微不足道的），将它们写入文件，然后使用该文件来提供测试程序，这样他就可以随机选择任何列表想要。

# open-source - F# 是开源的吗？

> ID：575521
> 
> 赞同：7
> 
> 时间：2009-02-22T19:24:58.507
> 
> 标签：open-source, f#

F# 是开源的吗？如果不是这样，为什么微软提供 F# 模块的源代码？

编辑

（2010 年 11 月 4 日）情况发生了变化，请参阅[Brian McKenna 的回答](https://stackoverflow.com/questions/575521/is-f-open-source/4103116#4103116)。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-11-05T02:23:04.337

截至 2010 年 11 月，F# 编译器和库在[Apache 许可](https://www.apache.org/licenses/)下发布。它们现在是[F# PowerPack](https://web.archive.org/web/20180123010617/http://fsharppowerpack.codeplex.com:80/)的一部分。

您可以从[宣布它的博客文章](https://docs.microsoft.com/en-us/archive/blogs/dsyme/announcing-the-f-compiler-library-source-code-drop)中了解更多信息。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-23T00:01:08.670

现在，F# 团队似乎正忙于所有“产品化”工作。一封包含许可计划的电子邮件在[这里](http://article.gmane.org/gmane.comp.lang.fsharp.general/1000)。

> 随着我们在明年完成这项工作，我们的计划是在 MS-PL 下制作 F# 编译器组件的相应源代码版本。

和：

> 在此过程中，我们计划在 MS-PL 下发布 MSR“Power Pack”组件的源代码版本。其中包括 fslex.exe 和 fsyacc.exe 等工具以及一些库。这些可能会更频繁地发布，并且可能包括实验性组件。

和：

> 一般来说，我们的目标是使 F# 的源代码版本开放、稳定并与受支持的版本相对应。

也许是最好的一点:)：

> 总的来说，我们更喜欢“做”而不是“预先宣布”。

我还要注意，如果您没有使用“开源”一词，意思是“被某些组织批准为开源”，那么源代码已经包含在 F# 发行版中。（并且在 VS 中使用 F12“转到定义”将直接跳转到源文件。）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-22T19:53:20.653

发布 F# 所依据的“Microsoft Research Shared Source license”**尚未**获得 Open Source Initiative 或 Free Software Foundation 的批准（尽管[其他一些](http://en.wikipedia.org/wiki/Shared_source)Microsoft 许可证已获得批准）。

底线是共享源代码与使产品开源没有什么关系。关键是许可证，它（dis）允许或多或少地自由地使用和修改源代码。没有这样的许可证，源代码几乎毫无用处。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-22T19:37:10.180

它是根据 MS-Research[开源许可证](http://download.microsoft.com/download/a/0/2/a02725c2-4eb7-45e1-8e13-24d3c1141115/LICENSE-fsharp.txt)的变体发布的。

我不知道这是否“正式”开放。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-22T20:19:21.700

从 2008 年 CTP 版本开始，f# 遵循经过略微修改的[Microsoft Research Shared Source 许可协议](http://download.microsoft.com/download/a/0/2/a02725c2-4eb7-45e1-8e13-24d3c1141115/LICENSE-fsharp.txt) （“MSR-SSLA”）。

本质上您可以修改它，但 MS 获得所有修改的免版税许可

团队内部有人谈论它转向更开放的 MS-PL 许可证，我不知道进展如何，也不知道将 f# 包含在 VS2010 中的计划有何影响。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T20:54:46.793

有没有人真的尝试从发行版中包含的源代码构建 F#？在我看来，缺少某些部分可以防止这种情况发生。这是对未经 OSI 批准的许可证的补充。所以，不，F# 不是开源的。

# programming-languages - 一年学习两种语言。例如，C# 和 JavaScript 是个好主意吗？

> ID：575522
> 
> 赞同：1
> 
> 时间：2009-02-22T19:24:59.693
> 
> 标签：programming-languages

我知道[C#](http://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29)，但我并不深入。JavaScript 很热门，也可以在工作中使用，所以知道这不会有什么坏处。当您还没有真正深入了解您的第一种语言时，您对选择一种新语言有何看法。哦，别忘了还有[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)及其惊人的生命周期可供掌握。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T19:43:47.980

Javascript 与 C# 形成了很好的对比——而且非常重要的是，它是当前使用最广泛（如果不是最广泛）的语言之一。这意味着您不仅要学习一门非常重要的语言，而且还要学习一些与 C# 对比的东西，从而赋予诸如“C# 是一种静态类型语言”之类的评论更多的意义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T20:35:30.990

如果您无法在大约三周内将一门语言学习到模型的熟练程度，那么您可能走错了领域。

八周就好了。在典型的两个学期中，这大约是四种语言。

无论如何，你都会在谷歌上搜索图书馆。

C++ 是一个例外。您可以在大约 10 周内学会编写惯用的 C++，而阅读大多数 C++ 内容可能需要两年时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T19:35:56.640

C# 和 JavaScript 将是很好的学习语言。两者在实践中都非常有用，并且都具有有趣的语言书呆子方面。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T19:57:47.103

我认为学习 C# 和 JavaScript 是一个不错的选择——它们是完全不同的语言，这些经验是值得的。

为不同的目的（如 C# 和 JavaScript）或不同的范式（C 和[Haskell](http://en.wikipedia.org/wiki/Haskell_%28programming_language%29)）选择语言是理想的，因为您不会因相同事物的太多信息而使自己超负荷，也不会将自己与相似的概念混淆。

避免同时学习 C# 和 Java 或 C 和 C++。第一种情况会让你感到疲倦，第二种情况会让你非常困惑。

此外，尽早学习第二语言可能会很好。如果你花太多时间只用一种语言编码，你将很难学习新的习语。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T20:12:28.190

我现在的情况有些相似：几个月前我开始了一份新工作，我正在同时学习 PHP 和[交互式数据语言](http://en.wikipedia.org/wiki/IDL_%28programming_language%29)(IDL)。它们在很多方面都非常不同。PHP 与我使用过的其他语言（C、Perl 等）非常相似，因此它变得非常简单。IDL 对我的思维方式有点奇怪，所以它会变慢。因此，我发现同时学习两种语言可能具有挑战性……尤其是因为我正处于“30 多岁”;->。

也就是说，根据您的说法，我假设您在工作中使用 C#，并且也会学习 JavaScript 以便在那里使用。所以，你有足够的动力——大概还有时间——去学习它们并获得报酬。我不知道 C#，但我已经完成了大量的 C 和一点 Java 以及 JavaScript，并且认为它们并没有太大的不同 - 至少在语法上，所以认为你会没事的。

如果您完全在自己的时间（也许是一角钱）上做这件事，我建议您在一年内只学习另一种语言。这取决于你，但我认为没有足够的时间来学习语言和度过余生。

祝你好运！

# c# - 在 NHibernate 中，我可以使用工厂来构建复杂的聚合对象（实体）吗？

> ID：575530
> 
> 赞同：1
> 
> 时间：2009-02-22T19:27:11.747
> 
> 标签：c#, nhibernate, orm, domain-driven-design, factory

在 NHibernate 中，我可以使用工厂来构建复杂的聚合对象（实体）吗？如果是，那怎么办？如果没有..那么你的方法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-05-20T13:25:57.857

查看Ayende[的这篇文章](http://ayende.com/Blog/archive/2007/04/17/Advance-Extending-NHibernate-Proxies.aspx)，他在其中描述了创建代理工厂以在实体代理上实现 INotifyPropertyChanged。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T23:23:33.270

是的。如果您可以将对象设置为 POCO，则可以使用 NHibernate 映射到您的数据库。

但是，您实际上并不完全了解您的需求，因此请发布更清晰的要求，我将能够更好地帮助您。

# winapi - 预注册 ATL 窗口类

> ID：575532
> 
> 赞同：3
> 
> 时间：2009-02-22T19:27:36.987
> 
> 标签：winapi, atl, wtl, classname

我在一个项目中使用了 ATL 和 WTL 的组合，并从 派生了我自己的类`CWindowImpl`，它看起来像这样：

```
class CMyControl : public CWindowImpl<CMyControl>
{
public:
    DECLARE_WND_CLASS(_T("MyClassName"))
    ...
    BEGIN_MSG_MAP(CMyControl)
        ...
    END_MSG_MAP()
}; 
```

这一切都很好，如果我`CMyControl::Create`用来创建控件的实例，那么它在后台运行良好，该`CWindowImpl::Create`函数将注册 Win32 类（在本例中称为`MyClassName`）。

然而，正是这种行为——在创建实例时注册了 Win32 类——让我很头疼。我希望能够预先注册类，以便我可以将类名与另一个 3rd 方库一起使用，该库将使用 Win32`CreateWindowEx`调用创建窗口，但我找不到一个简单的方法来做到这一点。目前我通过使用`static`作为`CreateWindowEx`类名来解决这个问题，然后使用`CMyWindow::SubclassWindow`将我的类附加到它，但这是一个杂项。

有谁知道如何在`CWindowImpl`不实际创建窗口的情况下注册派生类，以便我可以`CreateWindowEx`成功传递类名？我认为有一种标准方法可以使用 ATL 窗口来执行此操作，因为我不是第一个遇到此问题的人。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T06:03:58.900

你试图做的事情是行不通的。这是因为 ATL/WTL Window 的创建必须经过 ATL 类。该类使用窗口[thunk注册其](http://www.codeproject.com/KB/atl/atl_underthehood_5.aspx)*this* ptr 。此 thunk 成为 WNDPROC 并用对象实例的*this ptr 替换 WNDPROC 的 HWND 参数。*

 *所以简而言之，如果您知道 ATL 窗口化是如何在幕后工作的，您就不会尝试这样做。如果您能够注册窗口类，则 CreateWindowEx 调用将成功创建窗口。但是，不会创建 WNDPROC thunk，并且不会有对象实例可以关联您的窗口，也不会调用任何消息处理程序。相反，看看您是否可以使用 CWindowImpl::Create 创建窗口，并在创建后将 ATL 控件的 hwnd 传递给您的第 3 方库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T19:52:20.377

您可以直接调用 Win32 API [RegisterClassEx](http://msdn.microsoft.com/en-us/library/ms633587%28VS.85%29.aspx)函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T21:38:45.707

您可以使用：

```
WNDPROC pUnusedWndSuperProc; 
pUnusedWndSuperProc = NULL;
CMyControl::GetWndClassInfo().Register(&pUnusedWndSuperProc); 
```

虽然......我不确定你为什么不只是创建一个窗口实例并将其隐藏。它有点开销，但它避免了与窗口逻辑的胆量混淆（这是非常复杂的东西......你想要的最后一件事是“thunking”的一些意外或不寻常的问题）。

# visual-studio - 哪个视觉工作室版本有这个程序集？

> ID：575534
> 
> 赞同：0
> 
> 时间：2009-02-22T19:28:13.523
> 
> 标签：visual-studio, unit-testing

我有一个包含此引用的 .proj 文件，但我在磁盘上找不到合适的程序集。

Microsoft.VisualStudio.QualityTools.UnitTestFramework

此程序集包含哪个 Visual Studio 版本，或者是否有其他方法可以获取此程序集？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T19:31:49.943

2008 年，Pro、Developer 和 Suite。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T19:33:21.857

Microsoft.VisualStudio.QualityTools.UnitTestFramework 仅与 Team System 一起安装。

只需从引用中删除此程序集并使用您想要的任何其他测试框架。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T19:37:08.307

嗯...不要复制但是...

这就是 Visual Studio 单元测试框架，可在

*   Visual Studio 团队系统 2005
*   Visual Studio 团队系统 2008
*   Visual Studio 2008 专业版

请注意，VS 2005 Pro 没有它。VS 2008 Pro 实际上是第一个内置单元测试的非团队系统版本。

# linden-scripting-language - 有人认为学习 Linden 脚本语言值得吗？

> ID：575547
> 
> 赞同：5
> 
> 时间：2009-02-22T19:30:59.350
> 
> 标签：linden-scripting-language

我只是在寻找人们对此的看法...

当第二人生问世时，我真的很担心；我认为这将改变互联网的游戏规则。直到我意识到，除了程序员和大学生之外，真正需要硬件和互联网连接要求的人并不多，他们需要在 Second Life 中获得良好的用户体验。

再加上 Linden Labs 服务器一次只能处理大约 70 个人访问一块土地的事实。因此，您在 Second Life 上创建的任何交互式 3D 内容都不可能产生您使用传统 Web 应用程序可能获得的点击量。

但即便如此，对于未来......当他们找到解决这个问题的方法时，是否值得学习 LSL？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-22T20:09:26.090

LSL 是一种不错的面向事件的小型语言，具有很高的时间/满意度比率。这是一个非常好的方法，可以让你进入与通常的、无聊的 webapps 完全不同的东西。你知道该怎么做：

*   服务器（Java）
*   桌面 (.NET)
*   网络（Javascript / PHP / 等）
*   低级的东西（C/C++）

与 LSL/Second Life 平台相比，它们看起来都相似。

另外，一边赚几块钱，真是太好了。有一个庞大、健康和充满活力的 Second Life 社区，对 LSL 程序员的需求很大，Second Life 中的小额支付也很活跃。

## 第二人生有多大？

首先，它有多大并不重要。大多数人想知道的真正问题是，“这是下一件大事吗？” 它可能是，或者它可能会惨遭失败。也许它作为主流产品已经失败，并永远将自己定义为利基市场。但无论它是什么，从技术上讲，它都是最前沿的，就像亚马逊网络服务或 iPhone 一样。它也是唯一的 3D MMO 世界，它不是游戏，更像是 Facebook（这是一种 2D 网络现象），而不是魔兽世界。Linden Labs（Second Life 的创造者）也在领导现有的唯一一项尝试连接 3D 世界和标准化协议的计划，这与 Facebook、Amazon 和 Google 等其他网络平台相比非常聪明，这些平台仍在试图将开发人员锁定在他们的平台。

但是为了辩论...

在一个第二人生模拟器中比较最多 70 人并不能说明太多。Simulator 相当于 Second Life 中的物理空间 (256 m ² )，类似于 2D web 中的 web 服务器。有多少用户可以同时访问一个 Web 服务器并不能说明它托管的网站，您始终可以添加更多 Web 服务器。无论如何，Big Second Life 事件通常跨越多个模拟器，并且有数千个模拟器。

这是一个[链接](http://nwn.blogs.com/nwn/2009/01/second-life-larger-than-world-of-warcraft-there-oahu-combined.html)，将第二人生的大陆与其他几个参考资料（如魔兽世界）进行了比较。此外，一些更有用的当前统计数据是：

*   86000 最大并发用户
*   40000 最低并发用户在任何时候
*   1444530 用户在过去 60 天内登录

这比 2008 年 4 月仅在中国就达到 100 万并发用户的《魔兽世界》要少得多，但话说回来，《魔兽世界》中的所有内容几乎都是由暴雪开发的，所以你真的没有选择在《魔兽世界》中创建内容。

## 这值得么？

这取决于。如果你只是因为有一天可能成为主流而想要进入 LSL，那么不，这可能不值得。

另一方面，它仍然是一个新领域，在 LSL 中创造一些原创的东西仍然相对容易。再过一两年，就不会那么容易了。相比之下，SL的时尚市场竞争要激烈得多，很难超越现有的产品；在 Second Life 中进入时尚界的好时机大约是在两年前（现在还为时不晚，但你必须非常出色）。

学习 LSL 的理由大致有四种（可以重叠）：

*   您是第二人生用户，希望能够创建没有 LSL 就无法完成的事情（并且没有其他人可以为您做这件事或不想付钱给某人）
*   你是一名对 3D 虚拟世界感兴趣的程序员
*   你想以一种有趣的方式赚取一些额外的钱（是的，这是可能的，虽然有些人是第二人生支付账单的，但它是例外而不是规则）
*   你是一名程序员，想要与专业的护送人员一起工作并获得补偿，并且真的不想知道小鸡在现实生活中的年龄或长相；） - 说真的，第二人生非常适合结识不同的人，并且LSL 技能将带你到一些 Java 根本做不到的地方

请注意，在 Second Life 中创建 3D 内容通常涉及的不仅仅是编程。很容易跨入 Photoshop/设计、视频、3D 建筑 (Autocad)、动画、营销等领域。您也可能会与时装设计师、试图在 LSL 中制作建筑原型的真正建筑师、教育工作者和各种不同的职业。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-22T20:14:57.983

像往常一样处理此类问题，这取决于您的目标。

学习 LSL 的原因：

*   您只想了解这种分布式/并行/交互系统是如何工作的。
*   您已经参与了 SecondLife，并且想要扩展自己。
*   您与想要建立 SecondLife 存在的公司签订了合同。

*不*学习 LSL 的原因：

*   一周内没有足够的时间涉足所有事情。
*   有很多语言可以教给你一些你更可能使用的东西。
*   使用它的工作机会从天而降的可能性很小。

我不反对 LL 或 SL，如果我无事可做，我可能会为了好玩而涉足 LSL。但我已经有很多其他的事情要做。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-22T20:15:58.073

LSL 恕我直言，这并不是一门很棒的语言，我认为它甚至更多是作为一种快速使 SL 对象可编写脚本的黑客。

由于第二人生现在使用单声道和 LSL，我希望从长远来看，还会提供“真正的”语言，例如 C# 或 Python。这肯定是有道理的，前段时间也有一些关于这个的问题。

[IETF（称为MMOX](https://www.ietf.org/mailman/listinfo/mmox) ）也正在进行标准化工作，可能会也可能不会提出不同的或新的脚本编写方式。

我也不确定你到底想用它做什么。如果您打算用它开发网络应用程序，我真的不鼓励这样做。在 SL 中使用它是因为没有其他选择，或者只是在 SL 之外使用真正的语言。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-21T17:47:19.333

我自己是一名 LSL 脚本编写者，这完全值得！我在 SecondLife 中建立了自己的公司，并由此获得了可观的额外一分钱！

此外，它非常简单，您可以在您周围构建世界，因此您可以按照自己的规格制造汽车！

如上所述，很快就会有其他类型的脚本可用，很难，我认为至少了解 LSL 基础知识会很好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-09-30T04:15:44.690

我有一份写 LSL 的“日常工作”。

正如许多人指出的那样，写作很有趣。因此，如果您是那种阅读 stackoverflow 的人，应该花一天或更少的时间来学习它，那么值得花时间向自己保证除了 J2EE 堆栈之外还有一些东西可以计算。

至于学习它，有很多学校都有课程，但这些通常不是针对程序员的。花一个小时浏览 LSL 门户将为您提供一个很好的概述。

你会得到大量的工作机会来写 LSL 吗？不会。你会在第二人生中卖枪致富吗？不。你会继续站在行业的前沿，而不是后边吗？是的。这段经历会开阔你的视野吗？确实

在电子游戏中工作胜过制作 ajax 网页吗？好呀！

你打算发明下一个非常酷的、有利可图的网页使用方式吗？你确定有一个吗？那个地区已经被大量开采了。

你打算发明下一个非常酷的、有利可图的虚拟世界应用吗？不知道，这取决于你。至少你有一个新的领域可以发挥。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-22T19:34:30.200

不，我不这么认为。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-22T20:20:13.430

你学习一门新语言需要多长时间？

现在学习 LSL 与在需要时学习 LSL 相比，您将获得哪些好处？

你学它是为了好玩还是为了找工作？

简而言之，未知数太多。例如，如果您失业并正在寻找工作，那么任何能增加您找到工作机会的事情都是好事。那里可能没有多少 LSL 程序员。另一方面，有多少 LSL 职位空缺？你可能最好学习一种你还不知道的流行的、独立的语言，或者用你已经知道的那些语言来磨练你的技能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-11T00:02:38.323

我敢打赌，linden 实验室很快就会支持比 lsl 更多的“真实”语言。他们已经开始使用 Mono 将其 lsl 转换为 .net 字节码，这似乎是一个合乎逻辑的下一步，允许使用可以使用 mono 编译和运行的其他语言。也许放一两个库来支持内置函数。

至少这是我的希望。我认为，如果他们确实向其他人开放了可用的语言，他们将获得更多的采用和更有趣的内容。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-19T21:02:29.870

我和比利一起做这个！我很容易从其他语言转向 LSL 编程，我使用它有几个原因 - 增强我自己的 SL 体验；突破 SL 的可能性；创造很多人购买的物品（顺便说一句，这是一个双重打击 - 我赚了足够的钱来支付游戏的所有费用，除此之外还有更多，人们似乎喜欢我所做的！）。

我还发现它有助于学习 C#，因为它是进入该语言的一种更温和的方式。

最后，SL 中有许多脚本编写者，他们中的大多数都非常乐意分享他们的专业知识。在 Script Academy 小组中发布的问题几乎总能得到即时的、消息灵通的答案。

当然，这真的可以追溯到 jeol 的第一条回复——“像往常一样，有这样的问题，这取决于你的目标。”

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-03-29T19:18:14.880

作为一名脚本编写者和构建者，我发现它是一种很好的简单媒介，可以修改我可能在其他地方应用的概念性想法。此外，根据给定的知识，该语言确实适用于 SL 之外，并且所述操作的负载正在对 SL 服务器而不是您自己的 PC 征税。

例如，您可以编写一个对象以从其他网站收集信息，并通过电子邮件将这些信息的摘要发送给您。这样，我可以保证无论我自己的计算机的开/关状态如何，我都能获得信息。

我还为无法编写脚本的构建者编写了一些 dinero 脚本……而且他们通常会付出高昂的代价。诀窍是从小处着手，随着你的声望越来越高，赚得更多。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-10-03T19:16:25.857

在这个派对上有点晚了，但是......对于现在遇到这个的任何人......虽然之前的答案涵盖了“商业案例”方面，以及只是做一些不同的事情的好处，但有一件事请注意这可能会影响您的决定。

LSL 有相当多的“功能”，可能会导致其中一个出现问题。有些是语言固有的，有些与内置函数设计中的奇怪决定有关。[本文末尾的部分列表为您提供“风味”]。此外，您在非常有限的环境中工作，其中单个脚本的代码和数据限制为 64k。你将需要磨练你的kludging技能！

我强烈建议您不要参与，除非您有特定的 SL 相关需要填写，而无法以其他方式填写。您将花费大量时间编写解决特定应用程序之外的各种 SL 特定问题的方法。

...

*LSL“功能”的部分*列表：仅作为示例

*   没有数组，只有列表
*   每个脚本 64k 内存限制
*   读取记事卡（文本文件）需要您的代码对事件请求进行排队，并且需要一个事件处理程序来接收每一行并请求下一行
*   有一个内置函数可以显示用户操作的按钮对话框......但是......如果用户只是单击它，您的脚本不会收到通知（'ignore'，就像 [x] 关闭），也不是脚本有什么方法可以强制关闭对话框，例如在超时后

也许学习的一个原因可能是在这样的环境中编写好的代码所面临的挑战？

# asp.net - 为什么你会在 Session 存储对象上使用 asp.net 的 ViewState 存储对象？

> ID：575568
> 
> 赞同：15
> 
> 时间：2009-02-22T19:38:32.517
> 
> 标签：asp.net, viewstate, storage, session-storage

除了因为会话存储对于不止一页来说是会话全局的，为什么还要使用视图状态来保存值？

从客户端到服务器来回发送除了一些小的查询字符串（如值）之外的任何类型的信息似乎有点荒谬。我的意思是浪费带宽（！），只是为了存储目的。会话虽然跨多个页面是全局的，但似乎是视图状态的完全优越的替代方案。

特别是对于 asp.net ajax 控件和变体，视图状态可能很快变得臃肿，跟踪所有这些不同控件和 html 元素的各种状态和变量。

但是，为什么还有页面变量和对象的视图状态存储呢？

也许我错过了页面视图状态存储的另一个很好的用途，有人知道吗？

谢谢阅读！

编辑：每个人都有一个很好的答案，对不起，如果我没有选择你的。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-22T19:44:13.687

会话用完，Viewstate 没有 - 您可以在一小时后返回，您的 viewstate 仍然可用。当您在网站上返回/前进时，视图状态也始终可用，会话发生变化。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-22T23:39:14.170

Viewstate 或 Session 的全部原因是将 Web 从无状态系统转变为动态的定制体验。当用户请求一个页面时，您可以从用户停止的地方继续进行体验的唯一方法是记住服务器或用户客户端上的状态。

Viewstate 是一种在客户端记住用户状态的机制。会话是一种在服务器上记住用户状态的机制。

Viewstate 是一种瞬态存储机制。使用 viewstate 的控件将其状态作为隐藏输入呈现到 html 页面中。为了防止篡改，它被签名。但是，它没有加密，因此您可能希望避免将任何敏感信息放在那里。Viewstate 对于您想要跨一系列多个请求（页面加载）发布的情况很有用。这方面的一个示例是当表单未验证时，因为用户可能输入了错误的电子邮件地址或其他内容，并且您希望将表单恢复为用户提交之前的状态。这样做的缺点是视图状态是一个饥饿的野兽，可以轻松地将页面大小增加 30-50%。

另一方面，会话存储在服务器上。客户端得到一个令牌，告诉服务器哪个内存块是他们的。这可能比视图状态更安全，因为数据不会一遍又一遍地重新传输给用户。不过也有取舍。您的服务器可能内存不足。或者，如果会话中断，用户可能会丢失数据。

一般来说，没有“正确”的答案可供使用。这完全取决于您要完成的工作。

大多数与控件有关的事情都应该使用 Viewstate。但是，如果您正在处理敏感信息，请考虑使用 Session。如果您有一组特定页面的数据，请使用 viewstate。如果您在用户访问您的网站期间需要数据，请考虑 Session。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-22T19:42:40.197

例如，当您的应用程序可能在计算机场中运行并且您无法将会话配置为使用 sql server 时。（或者使用 sql server 对性能的影响太大）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-22T21:31:01.950

ViewState 和 Session 有不同的作用域。ViewState 旨在在“回发”期间存储或多或少的瞬态数据，而 session 用于保存关键会话状态数据。我建议将 ViewState 用于与特定“页面会话”相关的状态。

如果您不喜欢 ViewState 的正常行为，那么编写自己的 PageStatePersister 并让该对象执行持久性非常简单，例如使用 session 或 Memcached 之类的东西。然后，您可以完全覆盖默认的持久性机制。

然后，好处是您可以无缝地继续使用 .NET Framework 中的标准 Web 控件，这些控件都将使用 ViewState/ControlState 来处理此类数据，而不会导致 ViewState 膨胀。服务器内存持久性机制可能非常有效。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-22T19:59:00.360

ViewState 本质上只是一个隐藏的输入，必须上传到服务器并与每个请求一起解析。该字段通常是自动填充的，通常程序员完全不知道，并且可以变得非常大。对于许多存在问题的站点来说，因为即使是宽带用户也有非常有限的上行带宽。

在所有用户都可以通过高速 LAN 访问服务器但可用于保存会话数据的内存有限的 Intranet 站点上，这可能更有意义。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-23T15:38:26.407

不是真正直接回答您的问题，但它可能会解决您的问题。

您可以在服务器端存储视图状态，从而消除客户端的负载。

创建一个继承页面的类，并覆盖 PageStatePersister。 [http://msdn.microsoft.com/en-us/library/system.web.ui.sessionpagestatepersister.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.sessionpagestatepersister.aspx)

```
 public class RussPage : Page
    {
         protected override PageStatePersister PageStatePersister
        {
            get
            {
                return new SessionPageStatePersister(Page);
            }
        }
    } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-22T21:23:35.803

不是您问题的答案，而是您的一个假设是不正确的。

会话 ID 可以在 URL 中传递。会话不需要 cookie。

[http://msdn.microsoft.com/en-us/library/aa479314.aspx](http://msdn.microsoft.com/en-us/library/aa479314.aspx)

```
<sessionState cookieless="true" /> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-22T19:52:06.883

您正在做一个应用程序，在大多数情况下，视图状态膨胀不是问题，那么最好将特定于页面的数据存储在视图状态中，因为它可以帮助您的服务器更好地执行。如果您对会话或任何缓存发疯，就此而言，您可能会伤害自己，而不是帮助自己。

# c# - LINQ to Objects - 绑定到 ListView

> ID：575577
> 
> 赞同：4
> 
> 时间：2009-02-22T19:40:13.447
> 
> 标签：c#, linq, data-binding, xaml

我一直在使用 LINQ 将 ListView 绑定到对象时遇到问题。最好用我创建的测试用例来解释：

C＃：

```
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Windows;
using System.Windows.Controls;

namespace WpfApplication1
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
        }

        public class MySubClass {
            public string subtitle;
        }

        public class MyClass
        {
            public string title;
            public MySubClass subclass;
        }

        private void Window_Loaded(object sender, RoutedEventArgs e)
        {
            MySubClass sub = new MySubClass();
            sub.subtitle = "This is the subtitle";

            MyClass cls = new MyClass();
            cls.title = "This is the title";
            cls.subclass = sub;

            ObservableCollection<MyClass> mylist = new ObservableCollection<MyClass>();
            mylist.Add(cls);
            mylist.Add(cls);

            listView1.ItemsSource = (from c in mylist select new List<MyClass> {c}).ToList();

            label1.Content = listView1.Items.Count.ToString();
        }
    }
} 
```

XAML：

```
<Window x:Class="WpfApplication1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300" Loaded="Window_Loaded">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition />
        </Grid.RowDefinitions>
        <ListView ItemsSource="{Binding}" Name="listView1" Height="200" Grid.Row="0">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Title" Width="80" DisplayMemberBinding="{Binding Path=title}" />
                    <GridViewColumn Header="Subtitle" Width="80" DisplayMemberBinding="{Binding subclass.subtitle}" />
                </GridView>
            </ListView.View>
        </ListView>
        <Label Name="label1" Grid.Row="1" ></Label>
    </Grid>
</Window> 
```

运行时，我希望此代码在列表视图中显示标题和副标题属性。它没有，但 listview Count() 正确显示它有 2 个项目。我想我绑定到了错误的属性……我应该在绑定中使用不同的语法吗？

谢谢，伊恩

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-22T19:44:33.640

（**更新**）

重新查看 xaml，看起来您在该行中缺少“Path =”：

```
{Binding subclass.subtitle} 
```

重新对象；它可能需要属性；尝试：

```
 public class MySubClass {
        public string subtitle {get;set;}
    }
    public class MyClass
    {
        public string title {get;set;}
        public MySubClass subclass {get;set;}
    } 
```

该行：

```
(from c in mylist select new List<MyClass> {c}).ToList(); 
```

创建一个列表列表，每个列表都有一个元素（以及外部列表中的两个项目）。只需设置`mylist`为源：

```
listView1.ItemsSource = mylist; 
```

如果你想在 LINQ 查询中做一个“有趣的”投影，那么它看起来更像：

```
(from c in mylist select new { Foo = c.SomeProp,
    Bar = c.SomeOtherProp + 12 }).ToList(); 
```

这是一个单一的列表，只是与原始列表有不同的项目。

# css - 为什么我要将相对字体大小应用于正文标签？

> ID：575586
> 
> 赞同：1
> 
> 时间：2009-02-22T19:42:09.340
> 
> 标签：css

我看到有些人使用在 CSS 属性中`font-size: 80%`为`body`标签设置 a。

我为什么要这样做？为什么我不能简单地将相对字体大小添加到特定属性（例如`p { font-size: 90% }`）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-22T19:49:25.093

将正文字体大小设置为 62.5% 会设置每隔一个元素，以便 1.0em == 10px。因此，如果我希望我的 h1 为 20px 并且我的 p 为 14，我只需将它们分别设置为 2.0em 和 1.4em。

以 ems 而不是 px 设置字体大小允许在某些浏览器中更灵活地调整文本大小（想到 FF2 和 IE6）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T19:59:47.613

大多数浏览器出厂时默认字体大小为 16 像素。但这对大多数作者来说太大了。因此，与其设置固定的字体大小并因此覆盖用户的设置（另外 IE <= 7 无法缩放像素字体大小），它们只是缩小浏览器的默认值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T19:44:52.140

您将它设置为 body 标签，作为您未设置字体大小的所有元素的默认值。也可以设置body的常用font-size，与body不同的元素只设置font-size。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T19:49:06.127

这种用法的另一个例子是，如果您想创建一个放大或缩小文本大小的 javascript 函数，那么您只需将更改附加到正文字体大小，它将适用于所有内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T19:45:54.637

因为您可能没有 ap 标记围绕您希望应用字体大小的所有内容。

不是每个人都会在每段文字周围加上一个段落（即有些人混合使用 div 和 ps...）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T19:49:49.930

另一个用途是利用字体大小继承。

如果您使用基于 body 标签的相对字体大小，那么现在提供多种尺寸成为更改 body 标签字体大小的任务。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T09:06:35.630

在 BODY 元素上以百分比或 em 设置字体大小是跨浏览器字体大小一致性的技巧。此外，当您使用菜单中的文本大小选项或使用 Alt + 鼠标滚轮组合时，它确实允许 IE6 调整字体大小。

话虽如此，由于新的 IE 和 Firefox 3 已经默认采用了整页缩放，并且眼看 IE6 正在慢慢消失在框架之外，因此纯粹使用 body 上的相对字体大小来支持 IE6 文本大小可能不再值得麻烦。X

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-25T22:54:26.547

我发现将字体大小定义为正文中的百分比的一个巧妙技巧是为没有的浏览器创建伪页面缩放。

如果您在网站中同时使用 ems 字体大小和布局尺寸，则所有内容都将相对于字体大小进行缩放。因此，如果用户选择将浏览器的字体大小设置为 12pt（而不是通常的默认值 16pt），您的整个页面（无图像）将随文本缩放。

# asp.net - 检测是否加载了 HttpModule

> ID：575598
> 
> 赞同：8
> 
> 时间：2009-02-22T19:45:36.163
> 
> 标签：asp.net, iis, httpmodule

我试图找到一种以编程方式检查是否加载了特定 HttpModule 的方法（因为我正在编写的组件需要模块正常工作）。我正在努力：

```
bool ismodulepresent = false;
foreach(HttpModuleAction module in ((HttpModulesSection)ConfigurationManager.GetSection("system.web/httpModules")).Modules)
{ 
    if(module.Type == typeof(MyModule).FullName)
    {
        ismodulepresent = true;
        break;
    }
} 
```

但这仅适用于 IIS5.1`<httpModules>`部分，而不适用于较新的`<system.webServer>`部分。

除了检查两个部分之外，是否有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-22T19:57:06.323

```
HttpModuleCollection modules = HttpContext.Current.ApplicationInstance.Modules;
foreach (string moduleKey in modules.Keys)
{
    IHttpModule module = modules[moduleKey];
    // Do your check here
} 
```

# visual-studio-2008 - 无法将 App_Code 文件夹添加到网站项目

> ID：575599
> 
> 赞同：4
> 
> 时间：2009-02-22T19:45:39.817
> 
> 标签：visual-studio-2008, app-code

使用 VS2008，我试图从 add-->folder-->Add ASP_NET 文件夹添加一个 App_Code 文件夹。

App_Code 文件夹选项按预期存在，但......它被禁用了！？

我很确定我正在使用网站项目（而不是 Web 应用程序），因为我可以添加所有其他 ASP_NET 文件夹（App_Data - App_themes 等），而且我的代码中没有控件声明（与 Web 应用程序相反，在 Web 应用程序中，您有带有控件声明和事件处理程序等的部分类）。事实是，如果它不是网站项目，我怎么能添加其他 ASP_NET 文件夹？还有 - 为什么我没有得到任何带有控件声明等的设计器文件？这是过去在 VS2005 中的工作方式。

如果我继续自己添加 App_Code 文件夹作为普通文件夹，它会拾取 ASP_NET App_Code 文件夹的图标 - 所以它似乎工作正常。

仍然困扰着我，因为我不明白为什么首先禁用该选项。

任何线索为什么会这样？

**编辑**：我正在尝试创建一个新**网站**，但我只获得了**Web 应用程序**模板，所以我怀疑我是否能够首先创建一个网站。这里有点糊涂！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-22T19:54:39.730

不知道为什么会这样，但您应该能够在解决方案资源管理器中添加一个新文件夹并重命名/调用它 App_Code。

如果您愿意，甚至可以在 Windows 资源管理器中执行此操作。

刷新，它会拿起它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T20:06:00.220

您确定它是网站项目而不是 Web 应用程序吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-22T09:20:00.980

您将一个新文件夹添加到项目中。然后，将其重命名为 App_Code。Visual Studio 可以将该文件夹修改为 App_Code 文件夹。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T19:50:40.553

可能如果您添加 .cs 文件，它会被创建吗？

这个选项以前对你有用吗？在它停止工作之前你做了什么吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-22T22:05:36.640

真的没有“网站项目”这样的东西。网站是无项目的，因为它们在文件夹中不包含 .csproj（或 .vbproj）文件。如果您看到这个文件，那么它就是一个“Web 应用程序”项目。此外，如果您从菜单中选择“新项目...”，那么您没有选择“网站”。

使用网站的唯一方法是从 VS 文件菜单中选择“新网站”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-06T15:50:11.540

如果您在网站而不是 Web 应用程序中工作，则只能`App_Code`在“新建 ASP.Net 文件夹”下拉菜单中访问“新文件夹”选项。也抓了我几次。希望这会有所帮助。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-04-24T13:36:52.800

您不能将 App_Code 文件夹添加到 Web 应用程序，因为该文件夹是为 asp.net 的运行时编译而设计的，而 Web 应用程序项目旨在让您将您的网站预编译成一个 dll，您可以在 Bin 文件夹中找到该 dll 并进行部署到您的网站。

因此，对于 Web 应用项目，您应该改为添加一个名为“CodeFolder”之类的文件夹，然后在其中添加您的类。然后右键单击该类文件上的属性并将其构建配置设置为编译而不是内容。

# c - 在 C 中使用管道进行父子 IPC 会导致程序阻塞

> ID：575602
> 
> 赞同：1
> 
> 时间：2009-02-22T19:45:51.640
> 
> 标签：c, pipe, ipc, interprocess

我正在编写一个服务器，当它接受套接字连接时，fork() 会关闭子进程。

当孩子与客户沟通时，它必须将一些信息发送回父母。我正在使用管道来完成此操作。

问题是，当我尝试执行父子 IPC 时，父在读取子输入时会阻塞。这意味着，即使子进程同时运行，它们也只能一次处理一个，因为它们都在等待父进程。

我的代码看起来像这样（为简洁起见，删除了错误检查）：

```
/* loop: wait for clients to connect */
for(;;) {

  pipe(write_to_parent); /* create pipe between parent and child */
  pipe(write_to_child);  /* create pipe between parent and child */

  newsockfd = accept(...);

  pid = fork();

  if (pid == 0) { /* child process */
      close(write_to_parent[0]);
      close(write_to_child[1]);

     printf("Connected!\n");

     while ((rc = recv(newsockfd, ...)) > 0) {
         /* process socket request */

         /* write stuff to parent that is related to what we recv'd from client */
         rc = write(write_to_parent[1], &buf, 1024);
     }

     printf("Disconnected!\n");

     exit(0);
  } else { /* parent */

      close(write_to_parent[1]);
      close(write_to_child[0]);

       while (read(write_to_parent[0], &buf, 1024) > 0) {
           /* accept data from child process, and do some processing */
       }
  }
} 
```

所以我的问题是，我该如何解决这个问题？我怎样才能让父母使用管道与孩子进行交流，而不会阻塞？

这甚至可以通过管道实现，还是我应该使用共享内存（我猜是信号量）或消息队列？（我读过这篇文章：[比较 Unix/Linux IPC](https://stackoverflow.com/questions/404604/comparing-unix-linux-ipc)，但很难找到这些任务是如何实际完成的示例。）

更多细节：

我有一个执行以下操作的测试程序： 1\. 连接到服务器 2\. Sleep(5) 3\. 断开与服务器的连接

当我运行该程序的 2 个实例时，服务器会输出以下内容：

```
connected!
  // pause for 5 seconds
disconnected!
connected!
  // pause for 5 seconds
disconnected! 
```

显然一次处理每个客户。

当我删除 IPC - 当我从父子节点中删除管道 read() 和 write() 时，我得到了这个：

```
connected!
connected!
  // pause for 5ish seconds
disconnected!
disconnected! 
```

这就是我想要的！

关于我如何做到这一点的任何想法？（或者我应该在解决这个问题的方式上做出改变？）

（编辑：这是网络课程作业的一部分。我们正在实现一个 P2P 协议，该协议使用中央服务器来管理对等点。我们可以使用任何语言，我想我会在 C 中试一试。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T19:50:48.150

我在下面写了答案，并在重新阅读您的问题后，注意到我完全错过了您的实际问题。但是，在任何情况下它都可能是有用的信息。

要回答您并发的父级问题，您需要让父级设置一个`select()`循环来随时处理来自其任何子级的可能响应。您将需要：

*   跟踪有多少孩子是开放的
*   *为每个*孩子保留一组管道
*   使用循环`select()`来接受传入的连接（因为它们可能随时发生）以及来自任何孩子的传入数据
*   用来`waitpid()`收割已经终止的孩子

这种技术很强大，但确实需要大量的簿记才能正确设置。

* * *

默认情况下，在父进程中打开的文件句柄在子进程中继承。问题可能是*父母*和孩子的管道的写端仍然打开，所以当父母从管道读取时，它永远不会看到它的结束。`close(write_to_parent[1])`在开始阅读之前尝试在父母中使用 a `write_to_parent[0]`。所以：

```
} else { /* parent */
     close(write_to_parent[1]);
     while (read(write_to_parent[0], &buf, 1024) > 0) {
         /* accept data from child process, and do some processing */
     }
} 
```

# c# - 关于streamwriters和压缩如何工作的困惑

> ID：575610
> 
> 赞同：1
> 
> 时间：2009-02-22T19:49:02.537
> 
> 标签：c#, .net

在我开始之前，是否可以使用 streamwriter 编写具有混合内容的 .doc 文件？例如，我可能有一个包含图像和文本的 .doc 文件 - 流写器是否适合此操作？我假设文本编写器用于编写纯文本文档。

我想做的是压缩一个文件（格式未知），这很容易。但我很困惑的是为什么我要调用解压缩？这将使大小成为正常和更大的值，那么有什么意义呢？如果我想压缩文件并将其发送到网络驱动器，我是否应该将其压缩、复制到网络位置并解压缩到新文件？这个应用程序将是一个 Windows 服务，所以我需要使用 Windows 模拟，对吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T20:02:39.493

我认为您通常对压缩感到困惑。

您“压缩”任何数据以减小其大小。但是通过减小它的大小，数据的结构也必须改变。

因此，如果您将 MS Word 文档保存为 .doc 文件，您将在 .doc 文件中获得 MS Word 文档结构。

但是，如果您随后压缩 .doc 文件，该文件会因压缩算法的魔力而变小……但它*不再*包含 MS Word 文档结构。

那么 MS Word 如何读取它得到的外星结构呢？不能！

这就是为什么您必须“解压缩”，以恢复压缩之前数据的任何结构，使其再次变得有用。

例如，假设您有句子“Woah .NET Rocks”，某种压缩算法可能会将每个单词替换为英语词典中的一页，并生成字符串“77 69 84”。

```
Woah -> 77
.NET -> 69
rocks -> 84 
```

那么如何理解字符串“77 69 84”呢？

当然没有意义！因为它被压缩了。

要再次理解它，您必须对其进行解压缩，如下所示：

```
77 -> Woah
69 -> .NET
84 -> rocks 
```

因此，基本上，您正在采用“其他人”的数据结构并对其进行压缩。压缩后，数据对他们来说没有任何意义，因为它是压缩的形式。因此，您必须“解压缩”它，以便“其他人”可以再次阅读它。”

我正确理解你的问题吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T19:54:36.407

Word`.doc`文件具有非常特定的二进制格式；我不确定这`StreamWriter`是否会让写一个变得容易......

重新压缩...您可以使用类似的东西压缩*数据流*`GZipStream`，但这通常用于传输目的；接收者还需要了解解压缩它（例如，TCP 客户端/服务器可能同意使用压缩）。对于一个文件，假设您希望它在另一端“作为原始文件”，那么您需要另一端的服务来解压缩它。

就个人而言，对于本地网络的使用，我不确定它是否值得，除非您正在转移大量数据 - 只需使用`robocopy`并使用快速网络。

对于互联网使用，大多数协议都内置了压缩支持。带有 gzip/deflate 的 Http 是最明显的。

当然，如果您正在谈论归档，那么将文件存储在 .zip 归档之类的文件中很有意义......当“整体”执行此操作时，我倾向于在最靠近物理磁盘的服务器上运行归档工具, 以最大化 IO 性能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T21:25:25.207

首先，我发了上面的帖子，但我在家的时候没有，所以我使用了一个未注册的帐户。

你已经回答了我的困惑。我实际上知道，当您压缩数据时，要再次对其进行解压缩（就像使用 .zips 一样）。

关于.NET中的压缩问题，我解压数据时，大小值大于原始大小。我有以下代码：

```
 MemoryStream ms = new MemoryStream();
        // Use the newly created memory stream for the compressed data.
        DeflateStream compressedzipStream = new DeflateStream(ms, CompressionMode.Compress, true);
        Console.WriteLine("Compression");
        compressedzipStream.Write(buffer, 0, buffer.Length);
        // Close the stream.
        compressedzipStream.Close();
        Console.WriteLine("Original size: {0}, Compressed size: {1}", buffer.Length,    ms.Length); 
```

在最后一行（Console.Writeline），我有以下数据：

原始大小：9708，压缩后的大小：13943。压缩后的大小不应该更小吗？我正在使用 .jgp 文件。

谢谢

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T00:10:01.660

并非所有数据都是可压缩的。例如，如果您尝试压缩已经压缩的文件（如在 jpeg 中），它很可能会增加大小。

# debugging - Visual Studio 调试 - 我只想逐步完成我的程序！

> ID：575621
> 
> 赞同：7
> 
> 时间：2009-02-22T19:53:11.920
> 
> 标签：debugging, visual-studio-2005

我只是想用 Visual Studio 2005 逐步完成我的程序，但是当我尝试复制我的老师（有点）给我展示的内容时，我开始逐步浏览一些自发出现在我的窗口中的其他文件。它们被称为“xstring”和“ios”之类的随机事物，我真的很沮丧。请问，我如何单步执行我的代码？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-07-07T12:34:58.840

避免步入此类方法的最佳方法是在注册表中设置 NoStepInto 规则。查看[此博客文章](http://blogs.msdn.com/andypennell/archive/2004/02/06/69004.aspx)以了解具体操作方法。

如果你想避开整个标准库，只需设置以下规则：

```
10    std\:\:.*=NoStepInto 
```

对于 Visual Studio 2005，您需要将规则添加到以下键

`HKLM\Software\Microsoft\VisualStudio\8.0\NativeDE\StepOver`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T19:58:24.997

发生原因：您正在使用标准模板库中的对象。您的某些语句显式或隐式调用这些 STL 类的方法。您正在使用调试器进入这些方法。

有两种方法可以解决此问题：

*   如果您知道您正在使用调用 STL 方法的语句，则选择调试器的“Step Over”（F10）命令而不是“Step Into”（F11）命令。

*   如果您误用了其中一种方法，请使用调试器的“Step Out”（Shift-F11）命令。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T19:57:55.543

最有可能发生的事情是您正在进入框架中的内置方法。发生这种情况时，只需单击“退出”，您就会回到自己的代码中。

您还可以对那些您知道内置的方法使用“跳过” - 当然冒着跳过您想要进入的方法的风险。

我的建议是确保在要检查应用程序状态的每一行都放置断点——这样你就可以使用播放按钮 (F5)。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-22T19:56:58.757

[http://mark.michaelis.net/Blog/VisualStudioKeyboardShortcutsWrapupMSDNFlashFeb22009.aspx](http://mark.michaelis.net/Blog/VisualStudioKeyboardShortcutsWrapupMSDNFlashFeb22009.aspx)

基本上来说，当当前代码行包含对不是您的函数的调用时，您应该使用 F10(step-over) 而不是 F11(step-in)。

# c# - 如何在vista上获得监视器超时

> ID：575627
> 
> 赞同：1
> 
> 时间：2009-02-22T19:54:49.747
> 
> 标签：c#, winapi, windows-vista

在几年前我写的一个应用程序中，我使用函数 SystemParametersInfo 和 SPI_GETPOWEROFFTIMEOUT 来获取关闭监视器的超时时间。在 Vista 上，这不再起作用。

所以我决定在 Vista 上完成这项工作，但几个小时后，我觉得我离解决方案还差得远。

我要提到的大多数功能都在[http://msdn.microsoft.com/en-us/library/aa373163(VS.85).aspx上进行了描述](http://msdn.microsoft.com/en-us/library/aa373163(VS.85).aspx)

据我了解，我应该： 1\. 使用函数 PowerGetActiveScheme，获取当前方案 2\. 使用带有 GUID_VIDEO_SUBGROUP 的 PowerEnumerate 3\. 使用 PowerReadACValue（或 DC 值）来获取值。

这是正确的吗？似乎需要做很多工作才能达到一个设置。如果这是正确的方法，那么我不明白一件事。在我的系统上 PowerEnumerate 返回 3 个键。我怎么知道哪个是监视器超时？

到目前为止，这是我的代码。我在使用 PowerReadACValue 时遇到问题，我可能没有正确定义或使用它。

```
class Program
{
    [DllImport("powrprof.dll")]
    static extern UInt32 PowerGetActiveScheme(IntPtr UserRootPowerKey, ref IntPtr ActivePolicyGuid);

    [DllImport("powrprof.dll")]
    static extern uint PowerEnumerate(
                IntPtr RootPowerKey,
                IntPtr SchemeGuid,
                Guid SubGroupOfPowerSettingGuid,
                UInt32 AcessFlags,
                UInt32 Index,
                ref Guid Buffer,
                ref UInt32 BufferSize);

    [DllImport("powrprof.dll")]
    static extern uint PowerReadACValue(
                IntPtr RootPowerKey,
                IntPtr SchemeGuid,
                IntPtr SubGroupOfPowerSettingGuid,
                Guid PowerSettingGuid,
                ref IntPtr Type,
                ref IntPtr Buffer,
                ref UInt32 BufferSize);

    static void Main(string[] args)
    {
        IntPtr activeGuidPtr = IntPtr.Zero;
        uint res = PowerGetActiveScheme(IntPtr.Zero, ref activeGuidPtr);
        if (res == 0)
        {
            Guid VideoSettingGuid = new Guid();
            UInt32 index = 0;
            UInt32 BufferSize = (UInt32)Marshal.SizeOf(typeof(Guid));
            while (0 == PowerEnumerate(
                IntPtr.Zero, activeGuidPtr, new Guid("7516b95f-f776-4464-8c53-06167f40cc99"), 18, index, ref VideoSettingGuid, ref BufferSize))
            {
                Console.Write(VideoSettingGuid.ToString() + ": ");

                UInt32 size = 1024;
                IntPtr temp = Marshal.AllocHGlobal(1024);
                IntPtr type = IntPtr.Zero;

                PowerReadACValue(IntPtr.Zero, activeGuidPtr, IntPtr.Zero, VideoSettingGuid, ref type, ref temp, ref size);

                Console.Write(Marshal.PtrToStringUni(temp));
                Marshal.FreeHGlobal(temp);
                index++;
            }
        }
    }
} 
```

我也尝试使用 GetActivePwrScheme，然后使用 ReadPwrScheme，但它似乎也不起作用。即使我切换电源方案，GetActivePwrScheme 也总是返回 0。我还尝试使用增量值 (1,2,3) 运行 ReadPwrScheme。我达到了 5 或 6，但它从未返回我在控制面板中为监视器超时设置的值的正确数字。

我希望我完全错了，并且有一种更简单的方法可以做到这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T09:35:19.267

我终于幸运地找到了一个在 XP 和 Vista 上都可以使用的函数——GetCurrentPowerPolicies。调用非常简单，并返回很多当前设置，包括我想要的设置 VideoTimeoutAc 和 VideoTimeoutDc。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T08:38:43.747

我认为它们在 VISTA 中已停产，

您需要使用 WM_POWERBROADCAST 编写 Power-Aware Application

如给出的

[http://msdn.microsoft.com/en-us/library/ms700612(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms700612(VS.85).aspx)

和

[http://msdn.microsoft.com/en-us/library/ms703398(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms703398(VS.85).aspx)

示例应用程序的概念在[codeproject](http://www.codeproject.com/KB/vista/VGPowerMonitor.aspx)中可用，但您需要重新编程以获得您的值，

# process - 创建服务器端时间激活进程

> ID：575628
> 
> 赞同：-1
> 
> 时间：2009-02-22T19:55:21.960
> 
> 标签：process

在服务器上创建每天检查日期并在满足条件时启动另一个进程的进程的方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T19:56:40.087

如果我们谈论的是 Linux 服务器，您可能需要[查看 crontab](http://www.tech-geeks.org/contrib/mdrone/cron&crontab-howto.htm)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T19:58:27.303

Windows 上的计划任务。开始->程序->附件->系统工具->计划任务。

# image - 如何让 Windows 资源管理器“浏览到下一个文件夹”？（vbscript/批处理等...）

> ID：575639
> 
> 赞同：0
> 
> 时间：2009-02-22T19:58:36.850
> 
> 标签：image, windows-xp, directory, autohotkey

我使用基本的 Windows 资源管理器来浏览大量图像。我有一组组织良好的文件夹，我不需要/不想要照片管理器（如 picasa 等）的任何额外功能......

唯一的缺点是：我真的希望能够从一个文件夹直接浏览到下一个文件夹，而无需单击返回并选择下一个文件夹。

所以我的问题是，我怎样才能以最流畅的方式做到这一点？！

我猜我可以使用一些脚本的组合，然后使用自动热键将其绑定到快捷键。

非常感谢任何帮助/想法/指针！

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-22T20:22:12.847

你根本不需要为此编程。我假设您使用 Windows Image Viewer 浏览您的图像。
要在整个文件夹树中按顺序浏览图像，请执行以下步骤：
1) 在 Windows 资源管理器中打开树的根文件夹
2) 单击放大镜工具栏按钮
3) 单击左侧面板中的“搜索”按钮
此时您将拥有您打开的根文件夹下所有文件夹和子文件夹中所有文件和文件夹的完整列表。
4) 现在只需单击其中一个图像即可使用 Windows 图像查看器将其打开
要转到文件夹树中的下一个/上一个图像，只需单击窗口底部的下一个/上一个图像按钮。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T16:21:21.110

好吧，现在我正在使用自动热键和一个小脚本。

这并不完美，因为资源管理器必须向上跳一个文件夹然后再向下跳，但它现在可以工作。

```
if WinActive("ahk_class CabinetWClass") or WinActive("ahk_class" . ExplorerWClass)
 ^Up::
 SendEvent {Alt Down}{Left}{Alt Up}
 SendEvent {Up}
 Sleep 300
 SendEvent {Return}

 ^Down::
 SendEvent {Alt Down}{Left}{Alt Up}
 SendEvent {Down}
 Sleep 300
 SendEvent {Return} 
```

# asp.net-mvc - asp.net mvc 中的 Content 文件夹是神圣的吗？

> ID：575640
> 
> 赞同：23
> 
> 时间：2009-02-22T19:58:49.783
> 
> 标签：asp.net-mvc

Content文件夹是MVC底层框架特有的吗？我在路由代码或配置中找不到对它的任何引用。

我只是想知道是否可以以不同的方式处理静态内容。

在相关说明中，stackoverflow 的脚本和 css 内容似乎是通过查询字符串中的版本号检索的：

```
<link href="/Content/all.min.css?v=2516" rel="stylesheet" type="text/css" /> 
```

小心推测这可能如何工作以及为什么这很重要？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-10-08T16:23:23.187

没有魔法，System.Web.Routing.RouteCollection 类有一个属性 RouteExistingFiles 来控制行为。

默认为 false，这意味着 ASP Routing 不应路由 URL，而只是返回默认内容。在这种情况下，“/Content/all.min.css?v=251”会完全跳过 MVC 路由规则。

如果要为内容文件夹添加路由规则，则需要添加规则，并将 RouteExistingFiles 设置为 true。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-22T20:07:38.747

不，内容文件夹不是神圣的。随心所欲地使用它。

重新版本 - 如果您启用了基于 http-header 的缓存，这是帮助版本控制的常用技巧；否则您无法保证所有客户端都在使用更新后的文件。你会在网上看到很多“foo_v4.js”等；-p

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-22T20:05:04.137

我在我的一些网站上使用了相同的技术。我用它来避免缓存——如果你没有为不同的构建指定不同的 URL，客户端可能已经缓存了旧的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-23T10:54:02.923

只是添加到关于此的其他评论 - 路由系统的工作方式如下：

一个请求进来，并被定向到路由引擎，然后它通过路由表查找匹配项 - 按照它们注册的顺序（这就是为什么你应该在更一般的路由之前放置更具体的路由）。

如果未找到匹配项，路由引擎会将请求传递给 IIS 以正常处理 - 这也是您可以在同一应用程序中混合 ASP.NET Webforms 和 MVC 的方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T20:06:06.210

它没有特别的意义。这只是一个随意的名字。如果您使用 ASP.NET MVC RC 的向导，您会发现它在您的母版页 (Site.master) 中被引用：

```
<link href="../../Content/Site.css" rel="stylesheet" type="text/css" /> 
```

至于 SO 中使用的 all.min.css，它可以是在服务器上执行的自定义处理程序，以按版本检索压缩的样式表。

# wpf - 优秀的 3D GUI 引擎

> ID：575646
> 
> 赞同：4
> 
> 时间：2009-02-22T20:00:02.510
> 
> 标签：wpf, user-interface, 3d-engine

我知道 WPF 是优秀的 3D GUI 引擎之一，但我想知道其他优秀的 3D GUI 引擎？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-22T20:05:26.757

XNA 带有一个 3D GUI 引擎。它以游戏为目标，但也可用于其他目的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T20:02:12.333

[Flash Player 10](http://www.adobe.com/products/flashplayer/features/)允许在 3D 中旋转和缩放任何 GUI。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T20:06:21.887

对于 Linux，有[Compiz Fusion](http://en.wikipedia.org/wiki/Compiz_Fusion)，它是基于 OpenGL 的 X11 实现。我相信 MacOSX 和 iPhone 中的 GUI 系统是基于 OpenGL 的（[Quartz](http://en.wikipedia.org/wiki/Quartz_(graphics_layer))）。

如果您指的是支持 3D 的 GUI 框架，我想大多数都会，即从[FLTK](http://www.fltk.org/doc-2.0/html/opengl.html)到[Qt](http://doc.trolltech.com/4.1/opengl-hellogl.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T20:14:08.420

我在 Flash/ActionScript 上做了一些[Papervision3D 。](http://papervision3d.org/)

它太棒了！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-03T10:43:58.417

[Flex](http://www.adobe.com/products/flex/)是 WPF 的直接竞争对手。

# python - 如何在 Python 中获取密钥代码

> ID：575650
> 
> 赞同：9
> 
> 时间：2009-02-22T20:01:21.867
> 
> 标签：python, input, keycode

我必须知道按下的是什么键，但不需要字符的代码，我想知道有人何时按下“A”键，即使获得的键是“a”或“A”，以及所有其他键.

我不能使用 PyGame 或任何其他库（包括 Tkinter）。只有 Python 标准库。这必须在终端中完成，而不是图形界面。

不需要字符代码。我需要知道关键代码。

前任：

```
ord('a') != ord('A')                      # 97 != 65
someFunction('a') == someFunction('A')    # a_code == A_code 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-22T21:02:36.963

请参阅[tty](http://docs.python.org/library/tty.html)标准模块。[它允许使用tty.setcbreak(sys.stdin)](http://docs.python.org/library/tty.html#tty.setcbreak)从默认的面向行（熟）模式切换到面向字符（cbreak）模式。从 sys.stdin 读取单个字符将导致下一个按下的键盘键（如果它生成代码）：

```
import sys
import tty
tty.setcbreak(sys.stdin)
while True:
    print ord(sys.stdin.read(1)) 
```

*注意：解决方案仅适用于 Unix（包括 Linux）。*

编辑：在 Windows 上尝试[msvcrt.getche()](http://docs.python.org/library/msvcrt.html#msvcrt.getche) / [getwche()](http://docs.python.org/library/msvcrt.html#msvcrt.getwche)。/我无处可试...

* * *

[编辑 2：通过ctypes.windll](http://docs.python.org/library/ctypes.html)使用 win32 低级控制台 API （参见[SO 示例](https://stackoverflow.com/questions/239020/how-can-i-call-a-dll-from-a-scripting-language)）和`ReadConsoleInput`函数。您应该过滤掉按键 -`e.EventType==KEY_EVENT`并寻找`e.Event.KeyEvent.wVirtualKeyCode`价值。可以在[http://www.benryves.com/tutorials/?t=winconsole&c=4](http://www.benryves.com/tutorials/?t=winconsole&c=4)找到应用程序示例（不是在 Python 中，只是为了了解一下） 。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-22T20:03:45.950

根据您要完成的工作，也许使用[pygame](http://pygame.org)之类的库可以满足您的要求。Pygame 包含比 Python 标准库通常可用的更高级的按键处理。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2018-04-11T13:11:13.990

看看Python 中的[pynput](https://github.com/moses-palmer/pynput)模块。它还有一个很好的[教程](https://pythonhosted.org/pynput/keyboard.html)，您可以使用它轻松地为您的代码创建键盘侦听器。

监听器的官方示例是：

```
from pynput.keyboard import Key, Listener

def on_press(key):
    print('{0} pressed'.format(
        key))

def on_release(key):
    print('{0} release'.format(
        key))
    if key == Key.esc:
        # Stop listener
        return False

# Collect events until released
with Listener(on_press=on_press,
              on_release=on_release) as listener:
    listener.join() 
```

希望这可以帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-22T20:12:31.373

您可能必须使用[Tkinter](http://wiki.python.org/moin/TkInter)，它是“标准”Python gui，并且已包含在 python 中多年。

由于数据传入和传出命令行进程的方式，命令行解决方案可能不可用。GUI 程序（某种风格）都通过（可能是库包装的）事件流接收用户输入。每个事件都将记录该事件的详细信息。对于击键事件，记录可能包含任何键码、修饰键位域或某种编码的文本字符。哪些字段以及它们的命名方式取决于您调用的事件库。

命令行程序通过字符流接收用户输入。没有办法捕获较低级别的数据。正如 myroslav 在他的帖子中解释的那样，tty 可以处于熟或未熟模式，唯一的区别是在熟模式下，终端将为您处理（一些）控制字符，如删除和输入，以便进程接收输入行，而不是一次 1 个字符。

处理任何低于此要求的（取决于操作系统的）系统调用或在 /dev 中打开字符设备。Python 的标准库没有为此提供标准工具。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-12-13T18:29:26.117

这是我最近一直在努力解决的一个话题。这里要检查的另一件事是您是否在不同的键盘布局中获得正确的值。例如，当您切换到法语 - PC 布局时，pygame 似乎无法正确报告数字键代码。我的建议是使用 wxPython。它在 RawKeyCode 属性中公开平台特定的键代码。这是一个代码示例，它演示了：

```
import logging as log
import wx

class MainWindow(wx.Frame):
    def __init__(self, parent, title):
        wx.Frame.__init__(self, parent, title=title, size=(200,100))

        self.panel = wx.Panel(self, wx.ID_ANY)
        self.panel.Bind(wx.EVT_KEY_DOWN, self.OnKeyDown)
        self.panel.Bind(wx.EVT_KEY_UP, self.OnKeyDown)
        self.panel.Bind(wx.EVT_CHAR, self.OnKeyDown)
        self.panel.SetFocus()
        self.Show(True)

    def OnKeyDown(self, event=None):
        line_txt = '---------------------'
        print(line_txt)
        for var in ['RawKeyCode', 'KeyCode', 'UnicodeKey']:
            print(var, getattr(event, var))
            if var == 'UnicodeKey':
                print('char', chr(getattr(event, var)))
        print(line_txt)

if __name__ == "__main__":
    app = wx.App(False)
    gui = MainWindow(None, "test")
    app.MainLoop() 
```

例如，当我在我的 mac 上按下 fn 键（一个 mac 专用键）时，我看到这个记录：

```
---------------------
RawKeyCode 63
KeyCode 0
UnicodeKey 0
char 
--------------------- 
```

这与[此处的平台特定键码](http://web.archive.org/web/20100501161453/http://www.classicteck.com/rbarticles/mackeyboard.php)一致。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T20:50:47.520

如果您只需要在 Windows 中工作，您应该尝试[msvcrt](http://docs.python.org/library/msvcrt.html)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T18:59:04.840

显而易见的答案：

```
someFunction = string.upper

ord('a') != ord('A')                      # 97 != 65
someFunction('a') == someFunction('A')    # a_code == A_code 
```

或者，换句话说：

```
char_from_user = getch().upper() # read a char converting to uppercase
if char == 'Q':
    # quit
    exit = True # or something
elif char in ['A', 'K']:
    do_something() 
```

ETC...

这是 getch 函数的一个实现，它可以在 Windows 和 Linux 平台上运行，[基于这个秘籍](http://code.activestate.com/recipes/134892/)：

```
class _Getch(object):
    """Gets a single character from standard input.  
       Does not echo to the screen."""
    def __init__(self):
        try:
            self.impl = _GetchWindows()
        except ImportError:
            self.impl = _GetchUnix()

    def __call__(self): 
        return self.impl()

class _GetchUnix(object):
    def __init__(self):
        import tty, sys

    def __call__(self):
        import sys, tty, termios
        fd = sys.stdin.fileno()
        old_settings = termios.tcgetattr(fd)
        try:
            tty.setraw(sys.stdin.fileno())
            ch = sys.stdin.read(1)
        finally:
            termios.tcsetattr(fd, termios.TCSADRAIN, old_settings)
        return ch

class _GetchWindows(object):
    def __init__(self):
        import msvcrt

    def __call__(self):
        import msvcrt
        return msvcrt.getch()

getch = _Getch() 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-10-26T09:32:31.477

此函数将返回大写字符的代码：

```
def upCcode( ch ):
    if(len(ch) == 1):
        return ord(ch.upper()) 
```

这是小写字符代码：

```
def lowCcode( ch ):
        if(len(ch) == 1):
            return ord(ch.lower()) 
```

这种方式要容易得多，并且您不需要导入外部库。

您将需要选择两种方法之一作为您在问题中描述的“someFunction”。这是一个例子：

输出：

```
# when using upCode():
>> upCcode('a')
65

>> upCcode('A')
65

# when using lowCode():
>> lowCcode('a')
97

>> lowCcode('A')
97 
```

# java - 寻找简单的 Java 内存缓存

> ID：575685
> 
> 赞同：116
> 
> 时间：2009-02-22T20:11:54.900
> 
> 标签：java, caching

我正在寻找一个简单的 Java 内存缓存，它具有良好的并发性（因此 LinkedHashMap 不够好），并且可以定期序列化到磁盘。

我需要但已证明很难找到的一个功能是一种“窥视”对象的方法。我的意思是从缓存中检索一个对象，而不会导致缓存保留该对象的时间比其他情况下更长。

**更新：**我没有提到的另一个要求是我需要能够就地修改缓存对象（它们包含浮点数组）。

任何人都可以提供任何建议吗？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2013-03-25T16:02:31.473

由于最初提出这个问题，[Google 的 Guava 库](https://github.com/google/guava/wiki/CachesExplained)现在包含一个强大而灵活的缓存。我会推荐使用这个。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-02-22T20:17:01.660

[Ehcache](http://ehcache.sourceforge.net/)是一个很好的解决方案，并且有一种窥视的方法（[getQuiet()](http://ehcache.sourceforge.net/apidocs/net/sf/ehcache/Cache.html#getQuiet(java.lang.Object))是方法），这样它就不会更新空闲时间戳。在内部，Ehcache 是用一组映射实现的，有点像 ConcurrentHashMap，因此它具有类似的并发优势。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-02-23T01:02:22.970

如果您需要一些简单的东西，这是否符合要求？

```
Map<K, V> myCache = Collections.synchronizedMap(new WeakHashMap<K, V>()); 
```

它不会保存到磁盘，但你说你想要简单......

链接：

*   [Collections.synchronizedMap](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#synchronizedMap(java.util.Map))
*   [弱哈希映射](http://java.sun.com/javase/6/docs/api/java/util/WeakHashMap.html)

（正如 Adam 评论的那样，同步地图会影响性能。并不是说这个想法没有问题，但作为一个快速而肮脏的解决方案就足够了。）

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2014-02-25T16:49:43.043

内存中 java 缓存的另一个选项是[cache2k](http://cache2k.org)。内存性能优于 EHCache 和 google guava，请参阅[cache2k 基准测试页面](http://cache2k.org/benchmarks.html)。

使用模式与其他缓存类似。这是一个例子：

```
Cache<String,String> cache = new Cache2kBuilder<String, String>() {}
  .expireAfterWrite(5, TimeUnit.MINUTES)    // expire/refresh after 5 minutes
  .resilienceDuration(30, TimeUnit.SECONDS) // cope with at most 30 seconds
                                          // outage before propagating 
                                          // exceptions
  .refreshAhead(true)                       // keep fresh when expiring
  .loader(new CacheLoader<String, String>() {
    @Override
    public String load(final String key) throws Exception {
      return ....;
    }
  })
  .build();
String val = cache.peek("something");
cache.put("something", "hello");
val = cache.get("something"); 
```

如果您有 google guava 作为依赖项，那么尝试 guava 缓存可能是一个不错的选择。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2013-03-20T13:33:00.963

试试这个：

```
import java.util.*;

public class SimpleCacheManager {

    private static SimpleCacheManager instance;
    private static Object monitor = new Object();
    private Map<String, Object> cache = Collections.synchronizedMap(new HashMap<String, Object>());

    private SimpleCacheManager() {
    }

    public void put(String cacheKey, Object value) {
        cache.put(cacheKey, value);
    }

    public Object get(String cacheKey) {
        return cache.get(cacheKey);
    }

    public void clear(String cacheKey) {
        cache.put(cacheKey, null);
    }

    public void clear() {
        cache.clear();
    }

    public static SimpleCacheManager getInstance() {
        if (instance == null) {
            synchronized (monitor) {
                if (instance == null) {
                    instance = new SimpleCacheManager();
                }
            }
        }
        return instance;
    }

} 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2014-01-16T20:38:30.480

您可以轻松使用[imcache](https://github.com/Cetsoft/imcache)。示例代码如下。

```
void example(){
    Cache<Integer,Integer> cache = CacheBuilder.heapCache().
    cacheLoader(new CacheLoader<Integer, Integer>() {
        public Integer load(Integer key) {
            return null;
        }
    }).capacity(10000).build(); 
} 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2014-09-12T15:17:15.943

[`@Cacheable`](http://aspects.jcabi.com/apidocs-0.17.2/com/jcabi/aspects/Cacheable.html)从[jcabi-aspects](http://aspects.jcabi.com/annotation-cacheable.html)尝试。使用单个注释，您可以使整个方法结果可缓存在内存中：

```
public class Resource {
  @Cacheable(lifetime = 5, unit = TimeUnit.SECONDS)
  public String load(URL url) {
    return url.openConnection().getContent();
  }
} 
```

另外，请阅读这篇文章：[http ://www.yegor256.com/2014/08/03/cacheable-java-annotation.html](http://www.yegor256.com/2014/08/03/cacheable-java-annotation.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-22T20:16:31.380

这个怎么样：[https](https://commons.apache.org/proper/commons-jcs/) ://commons.apache.org/proper/commons-jcs/ （更新到新地址，因为 JCS 现在在 Apache Commons 中）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-22T20:17:52.560

试试[Ehcache](http://ehcache.sourceforge.net/)吗？它允许您插入自己的缓存到期算法，以便您可以控制您的窥视功能。

您可以序列化到磁盘、数据库、跨集群等...

# git - 我可以从 Git 存储库中删除初始提交吗？

> ID：575694
> 
> 赞同：15
> 
> 时间：2009-02-22T20:16:36.947
> 
> 标签：git

似乎我的初始提交占用了 90% 的空间，因为它不小心包含了很多媒体文件。有没有办法从本地和远程仓库中删除第一个提交，或者我应该留下这个？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-22T20:35:22.940

听起来您已经与许多其他用户共享了存储库。如果是这种情况，那么您可能应该忍受它。

如果您可以控制所有克隆，那么您可以在修改的根提交之上重写历史记录，并删除意外文件。请注意，如果其他开发人员已经基于此分支进行了工作，则不应这样做。

如果您要改写历史，那么您可以尝试以下方法。请注意，由于 git 保留了您最近 HEAD 提交所在位置的日志（reflogs），因此即使您尝试`git gc`或`git gc --prune`. 但是，它将确保任何新的克隆最终都不会获取大对象作为主分支历史的一部分。

假设您的工作目录是“干净的”：

```
# Go back the initial commit
git checkout <SHA1_of_old_root>

# Clean up the index to remove unwanted files, e.g. using git rm <files>
# ...

# Amend the initial commit with the new tree. Note the sha1 of the new commit
git commit --amend

# Go back to the master branch
git checkout master

# Re-apply all the commits onto the new root
git rebase --onto <SHA1_of_new_root> <SHA1_of_old_root> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T03:28:04.040

或者，您可以使用[git filter-branch](http://git-scm.com/docs/git-filter-branch "git-filter-branch(1) 手册页")删除有问题的文件（请参阅示例部分），但它也会重写历史记录。因此，任何将他/她的代码建立在您的旧历史之上的人都会大吃一惊……

# c++ - 将多个参数传递给 CreateThread

> ID：575695
> 
> 赞同：3
> 
> 时间：2009-02-22T20:16:59.943
> 
> 标签：c++, windows, visual-studio-2008, com, marshalling

**问题：**

*   如何将**两个**参数具体**传递给**[CreateThread](http://msdn.microsoft.com/en-us/library/ms682453(VS.85).aspx)，**当**：

     *****   论据一，类型`SOCKET`
    *   参数二，**接口指针**：

    `_COM_SMARTPTR_TYPEDEF(Range, __uuidof(Range));`

    `RangePtr pRange; //pass pRange`**** 

 ******建议：**

*   对于接口指针，相应地使用[CoMarshalInterThreadInterfaceInStream](http://msdn.microsoft.com/en-us/library/ms693316.aspx)，

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-22T20:21:57.933

创建这两种类型的结构并将指针传递给它。这是通过单指针向线程传递数据的标准方式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T22:06:31.927

如果可能，我将首先使用 boost::thread，而不是创建 struct_thread_xyz_params。如果这不是一个选项，我将创建一个包装模板函数对象，该对象在构造时使用自身调用 CreateThread：

```
template <class Func>
class Thread
{
    Func m_Func;
    static DWORD WINAPI ThreadFunc(void* param)
    {
        Thread& pFunc = *(Thread*)param;
        pFunc();
        return S_OK;
    }
public:
    Thread(Func& func): m_Func(func){
        CreateThread(NULL,NULL,Thread::ThreadFunc,this,NULL,NULL);
    };
    void operator()()
    {
        m_Func();
    }
}; 
```

那么如果我有一个需要两个参数的函数：

```
void printTwoStrings(string a, string b)
{
    cout << a << " " << b << endl;
}; 
```

我可以将它们包装在函子中：

```
class StringFunc
{
    string m_a;
    string m_b;
public:
    StringFunc(string a, string b):m_a(a),m_b(b)
    {

    };
    void operator()(){
        printTwoStrings(m_a,m_b);
    }
}; 
```

并按需初始化该函子的一个实例：

```
int main()
{

    Thread<StringFunc> myThread(StringFunc("hello","world"));
    Sleep(500);
    return 0;
} 
```

请注意，我最后正在睡觉，您根本没有说等待线程完成... struct_xyz_params 的困难在于您经常需要稍后的 struct_wxyz_params 并且重复代码的诱惑总是很高。 ..

boost::thread 也很好（但我已经说过了）。

-瑞克

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T20:26:28.640

`std::pair`是你的朋友。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T11:14:36.523

您还可以发布 WM_COPYDATA，在线程启动后稍后填充 COPYDATASTRUCT（参考： http: [//msdn.microsoft.com/en-us/library/ms649011](http://msdn.microsoft.com/en-us/library/ms649011(VS.85).aspx) (VS.85).aspx ）

# layout - 如何平铺视频/创建视频蒙太奇？

> ID：575705
> 
> 赞同：5
> 
> 时间：2009-02-22T20:20:50.730
> 
> 标签：layout, video, montage

我有四个视频，我想以 2x2 的方式平铺制作一个新视频。有没有一种方法可以让我轻松地做到这一点，最好是免费的并且在 Linux 下？我愿意编写适量的程序，也许是为了与某些库进行交互，但不愿意自己编写一个完整的视频处理程序。您可以假设输入和输出视频采用最方便的常用格式。

[gm montage](http://www.graphicsmagick.org/1.2/www/montage.html)命令（用于图像）的类似物会很棒。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-01-17T02:46:40.453

以下 ffmpeg 命令将完全按照提问者的要求进行：

```
ffmpeg -i input1.mp4 -i input2.mp4 -i input3.mp4 -i input4.mp4 -filter_complex \
'[0:v]pad=iw*2:ih*2:0:0[int2];[int2][1:v]overlay=0:H/2[int3];[int3][2:v]overlay=W/2:0[int4];[int4][3:v]overlay=W/2:H/2[out]' \
-map [out] -c:v libx264 -crf 23 -preset veryfast output.mp4 
```

首先，填充过滤器将第一个输入视频的大小加倍，将原始视频留在左上角。然后，串行覆盖过滤器将其他输入置于由填充过滤器添加的黑色填充上。

如果视频具有不同的分辨率，则需要对该命令进行一些修改。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-01-07T13:44:39.600

我目前正在自己​​使用 GStreamer 进行类似的项目（讲座捕获）。您可能正在寻找[videomixer](http://gstreamer.freedesktop.org/data/doc/gstreamer/head/gst-plugins-good-plugins/html/gst-plugins-good-plugins-videomixer.html)元素。查看此示例：[视频 4 路分屏 gstreamer 管道](http://blogs.gnome.org/halfline/2009/10/11/video-4-way-split-screen-gstreamer-pipeline/)（脚本位于[此处](http://git.gnome.org/browse/usability-lab/tree/eb1304-to-ogg.sh#n93)）。

GStreamer 在 Windows 上也能正常工作。如果您有兴趣，可以查看[GStreamer WinBuilds 。](http://www.gstreamer-winbuild.ylatuya.es/doku.php)

**示例**
这是一个适用于 Windows 的基本脚本（它没有反斜杠，因为我使用 C 代码中的[gst_parse_launch](http://www.gstreamer.net/data/doc/gstreamer/head/gstreamer/html/gstreamer-GstParse.html#gst-parse-launch)调用来解析管道描述）：

```
 v0\. ! queue
      ! decodebin
      ! ffmpegcolorspace
      ! videoscale
      ! video/x-raw-yuv,width=320,height=240
      ! videobox right=-320 bottom=-240
      ! ffmpegcolorspace
      ! vmix.sink_0
  v1\. ! queue   
      ! decodebin
      ! ffmpegcolorspace
      ! videoscale
      ! video/x-raw-yuv,width=320,height=240
      ! videobox bottom=-240
      ! ffmpegcolorspace
      ! vmix.sink_1
  v2\. ! queue   
      ! decodebin
      ! ffmpegcolorspace
      ! videoscale
      ! video/x-raw-yuv,width=320,height=240
      ! videobox right=-240
      ! ffmpegcolorspace
      ! vmix.sink_2
  v3\. ! queue   
      ! decodebin
      ! ffmpegcolorspace
      ! videoscale
      ! video/x-raw-yuv,width=320,height=240
      ! ffmpegcolorspace
      ! vmix.sink_3
  vmix. ! queue 
        ! ffmpegcolorspace
        ! dshowvideosink
  filesrc location="c:/test.mpg" name="v0"
  filesrc location="c:/test.mpg" name="v1"
  filesrc location="c:/test.mpg" name="v2"
  filesrc location="c:/test.mpg" name="v3"
  videomixer name=vmix
             sink_0::xpos=0   sink_0::ypos=0   sink_0::zorder=0
             sink_1::xpos=320 sink_1::ypos=0   sink_1::zorder=1
             sink_2::xpos=0   sink_2::ypos=240 sink_2::zorder=2
             sink_3::xpos=320 sink_3::ypos=240 sink_3::zorder=3 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-01-06T00:35:06.153

这听起来像是[AviSynth](http://avisynth.org/mediawiki/Main_Page)旨在解决的问题。

AviSynth 本质上是一种用于处理视频流的脚本语言。一个文本文件描述了您想要应用于一个或多个输入视频流的操作。文本文件被交给 AviSynth 引擎，该引擎提供一个虚拟 .AVI 文件，在您获取源流时一次一帧地对其进行操作。

将 AviSynth 与从虚拟 .AVI 文件读取并写入新文件以保存更改的单独工具相结合。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T10:07:11.413

一种可能的解决方案是使用多媒体标记语言[SMIL](http://www.w3.org/AudioVideo/)来描述视频蒙太奇的布局。这需要一个用于编写 SMIL 文档的文本编辑器和一个用于显示它的 SMIL 视频播放器（例如，[Ambulant](http://www.ambulantplayer.org/)、Quicktime 或 Realplayer）。

# java - Graphics2D：在白色上绘制黑色？

> ID：575706
> 
> 赞同：18
> 
> 时间：2009-02-22T20:21:14.130
> 
> 标签：java, graphics

我确定这是一个非常愚蠢的问题，但我找不到答案，我对 Java2D API 没有经验。我正在尝试创建图像并将其写入 GIF 或 PNG，并且我希望它在白色背景上使用黑色笔。如果我不设置任何颜色，我会得到黑色上的白色。如果我使用 setPaint() （用于后续绘制操作），我会用该颜色重新绘制整个画布。以下示例将整个事物呈现为黑色。

该示例在 Scala 中，但您明白了。随意用Java回答！

```
 val bi = new BufferedImage(200, 400, BufferedImage.TYPE_BYTE_BINARY )
  val g = bi.createGraphics
  g.setBackground(Color.WHITE)
  g.setPaint(Color.BLACK)
  g.draw(new Rectangle(10, 10, 30, 20)) 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-22T21:03:07.070

[setBackground方法是/](http://java.sun.com/javase/6/docs/api/java/awt/Graphics2D.html#setBackground(java.awt.Color))[曾经](http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html#clearRect(int,%20int,%20int,%20int))只用于clearRect方法。

在绘画之前用背景颜色填充矩形：

```
int width = 200;
int height = 400;
BufferedImage image = new BufferedImage(width, height,
                          BufferedImage.TYPE_BYTE_BINARY);
Graphics g = image.createGraphics();
g.setColor(Color.WHITE);
g.fillRect(0, 0, width, height);
g.setColor(Color.BLACK);
//ready for drawing 
```

# perl - 如何在 Perl 中访问猴子补丁方法的原始方法？

> ID：575710
> 
> 赞同：4
> 
> 时间：2009-02-22T20:22:34.563
> 
> 标签：perl, monkeypatching

我正在尝试[修补](http://en.wikipedia.org/wiki/Monkey_patch)Perl 类：我想更改现有方法的行为。

[perlmonks 上的这个节点](http://www.perlmonks.org/?node_id=694332)显示了如何*将*函数添加到现有类。我发现这种模式也可以用来为现有功能提供新的实现。

但是，我想知道如何调用原始函数。

我正在寻找这样的东西：

```
use ExistingClass;

# TODO: Somehow rename existingFunction() to oldExistingFunction().

sub ExistingClass::existingFunction {
    my $self = shift;

    # New behavior goes here.
    $self->oldExistingFunction(@_); # Call old behavior.
    # More new behavior here.
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-22T20:38:44.307

## Typeglob 赋值

```
*ExistingClass::oldExistingFunction = *ExistingClass::existingFunction; 
```

又快又脏。`existingFunction`这将所有符号别名为`oldExistingFunction`. 这包括您感兴趣的 sub，还包括可能碰巧具有相同名称的任何标量、数组、散列、句柄。

*   优点：不用思考，就行了。“快的”
*   缺点：“脏”

## 代码引用分配

```
*ExistingClass::oldExistingFunction = \&ExistingClass::existingFunction;
# or something using *ExistingClass::symbol{CODE} 
```

那个只是别名子。它仍然在包存储中完成，因此该`oldExistingFunction`符号是全局可见的，这可能是也可能不是您想要的。可能不是。

*   优点：别名不会“泄漏”到其他变量类型。
*   缺点：多思考，多打字。如果使用 *...{CODE} 语法，则需要更多思考（我个人不是每天都使用它）

## 词法代码参考

```
my $oldFunction = \&ExistingClass::existingFunction; 
```

Using`my`保留对仅对当前块/文件可见的旧函数的引用。没有您的帮助，外部代码将无法获取它。注意调用约定：

```
$self->$oldFunction(@args);
$oldFunction->($self, @args); 
```

*   优点：不再存在可见性问题
*   缺点：更难做对

## 驼鹿

请参阅[jrockway 的答案](https://stackoverflow.com/questions/575710/monkey-patching-in-perl-how-to-access-original-method/576425#576425)。它必须是正确的方式，因为不再有 glob 和/或引用，但我不知道足以解释它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-23T03:12:34.733

您应该使用[Moose](http://search.cpan.org/perldoc?Moose)或[Class::Method::Modifiers](http://search.cpan.org/perldoc?Class::Method::Modifiers)。

在这种情况下，你可以说：

```
around 'some_method' => sub {
    my ($orig, $self, @args) = @_;
    # ... before original ...
    $self->$orig(@_);
    # ... after original ...
}; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T18:50:52.480

除了其他答案，请查看以下模块：

*   [子::覆盖](http://search.cpan.org/dist/Sub-Override)
*   [钩子::LexWrap](http://search.cpan.org/dist/Hook-LexWrap)

[我还在Mastering Perl](http://oreilly.com/catalog/9780596527242/)的“动态语言”一章中谈到了这一点。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-22T21:42:30.737

只需将其复制到词法变量并调用它。

```
my $existing_function_ref = \&ExistingClass::existingFunction;
*ExistingClass::existingFunction = sub { 
    my $self = shift;
    $self->go_and_do_some_stuff();
    my @returns = $existing_function_ref->( $self, @_ );
    $self->do_some_stuff_with_returns( @returns );
    return wantarray ? @returns : shift @returns;
}; 
```

如果您对 OO 语法感觉更好，您可以创建一个`UNIVERSAL::apply`方法（或在您选择的任何基类中）。

```
sub UNIVERSAL::apply { 
    my ( $self, $block ) = splice( @_, 0, 2 );
    unshift @_, $self;
    goto &$block;
} 
```

这样你就可以这样称呼它：

```
my @returns = $self->apply( $existing_function_ref, @_ ); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-22T20:45:58.813

[Memoize](http://search.cpan.org/perldoc/Memoize)就是一个很好的例子。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-24T16:49:29.767

对于[Moose](http://metacpan.org/module/Moose)课程，您可以[按照 jrockway 所说的去做](https://stackoverflow.com/a/576425/40468)；对于非 Moose 课程，请执行以下操作：

```
use Class::MOP ();
use ExistingClass;

Class::MOP::Class->initialize('ExistingClass')->add_around_method_modifier(
    existingFunction => sub {
        my $orig = shift;

        # new behaviour goes here

        # call old behaviour
        my $result = $orig->(@_);

        # more new behaviour goes here
    }
); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-22T21:12:37.237

作为替代方案，有什么问题：

```
package NewClass;
use base qw/ExistingClass/;

sub existingFunction {
# ....
}

sub oldExistingFunction {
    my $self = shift;
    return $self->SUPER::existingFunction(@_);
} 
```

# delphi - TEmbeddedWB 值得研究吗？

> ID：575736
> 
> 赞同：0
> 
> 时间：2009-02-22T20:35:38.557
> 
> 标签：delphi, internet-explorer

我尝试使用 Delphi 应用程序中的 Google 地图 API。我的另一个问题[是从我的 Delphi 应用程序中使用 Googlemap 吗？](https://stackoverflow.com/questions/558686/use-googlemap-from-my-delphi-application). 现在我找到[了 TEmbeddedWB](http://www.bsalsa.com/intro.html)，我想知道是否比内置的 TWebBrowser 组件有任何优势。两者都是 Internet Explorer DLL 文件的接口，并且似乎做类似的事情？我不想使用不必要的自定义组件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T09:39:26.363

界面比 twebbrowser 好得多。您还可以使用更多事件。也许对您很重要，您可以修改浏览器的安全性。如果在客户端机器上禁用了 javascript，这是必要的。twebbrowser 绑定到全局 ie 设置。

我认为使用 tembeddedwb 是一个优势。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T15:49:38.103

TEmbeddedWB 背后有很好的概念，但它的开发方式很糟糕。一切都以 50% 运行，有很多错误，没有经过测试也没有记录。

祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T16:49:19.667

我在我的一个项目中使用了 TEmbeddedWB，发现它的实现值得使用，因为它提供了对几个事件和方法的访问，这些事件和方法虽然不难实现，但已经存在。

# javascript - 向服务器提交有序列表

> ID：575745
> 
> 赞同：2
> 
> 时间：2009-02-22T20:41:24.160
> 
> 标签：javascript

为了自学 Javascript，我正在尝试制作一个网页，为用户提供项目列表（例如食物），要求他们将这些食物从最喜欢到最不喜欢排序，并在完成后提交数据。使用 jQuery sortables 似乎是一个很好的方法。但是，我不确定数据提交应该如何进行。

这就是我的想法。这些食物中的每一个都将在这样的 div 中：

```
<div id="sortable">
    <div id="1" class="foods">Pizza</div>
    <div id="2" class="foods">Sushi</div>
    <div id="3" class="foods">Taco</div>
</div> 
```

当用户单击“提交”按钮时，我希望确定这些项目的顺序，并将此顺序发送回服务器（顺便说一下，我在服务器端使用 Django）。看来我可以使用如下函数确定项目的顺序：

```
function getOrder()
{
    var foods = $(".foods");
    var ids = [];

    for(var x=0; x<foods.length; x++)
    {
        ids.push(foods[x].id);
    }
    return ids;
} 
```

但是，我被困在几件事上：

*   在我的代码中我会在哪里调用这个函数？我认为当用户按下提交按钮时这将是一个 onclick 动作，但我不确定函数返回的数据将传递到哪里。
*   哪种格式最适合将此订单发送到服务器（例如 JSON）？

（我知道这是一个非常基本的问题，但我以前从未使用 JavaScript 制作过网页，所以这个编程领域对我来说是全新的。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T20:44:52.310

一种在语义上更相关的列表方式是使用实际`<ul>`元素。

所以如果你有这样的事情：

```
<ul id='foods'>
<li id='food_1'>Pizza</li>
<li id='food_2'>Sushi</li>
<li id='food_3'>Taco</li>
</ul>
<a href="javascript:saveFoods();">Save Order</a> 
```

以下 jQuery 代码将是适当的：

```
function saveFoods(id) {
    var data = $("#foods").sortable('serialize');
    var action = "/django/view/";
    $.post(action, data, function(json, status) {
        if(status == 'success' && json.status == 'success') {
            alert('Saved order of the foods!');
        } else {
            alert('Unable to complete the request.');
        }
    }, "json");
} 
```

根据[sortable](http://docs.jquery.com/UI/Sortable)上的 jQuery 文档，当您使用序列化可排序的元素时，它要求它们的 ID 采用某种`setname_number`格式。因此，通过将您的列表设置为`food_1`、`food_2`等。jQuery 识别出 Pizza 的 ID 为 1，并且其集合为 food。然后`data`变量 in`saveFoods`将包含`food[]=1&food[]=2&food[]=3`您可以在 Django 应用程序中处理的类似内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T20:46:14.273

将隐藏字段放在项目列表中可能会更容易。当表单提交时，相同的订单会在 post 或 get 中发送到服务器。

例子：

```
<div id="sortable">
    <div id="1" class="foods"><input type="hidden" name="sortable[]" value="1" />Pizza</div>
    <div id="2" class="foods"><input type="hidden" name="sortable[]" value="2" />Sushi</div>
    <div id="3" class="foods"><input type="hidden" name="sortable[]" value="3" />Taco</div>
</div> 
```

然后帖子中将包含一个数组，例如：

```
array(
    0 => 1,
    1 => 3,
    2 => 2
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T20:49:10.007

是的，规范是某种形式的用户操作，因此单击按钮是一个不错的选择。您将编写一个调用排序例程并将其发送到服务器的例程。

JSON 是一个不错的选择，因为它是轻量级的。如果你想玩更多，你可以去 XML，但我认为除了学习之外没有其他理由这样做，因为 XML 在这种情况下增加了不必要的重量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T21:33:05.663

[Scriptaculous 库](http://wiki.github.com/madrobby/scriptaculous/sortable)提供了可排序的列表，并提供了可以发回服务器的排序索引。

# javascript - 如何用 Raphael 创建渐变对象

> ID：575747
> 
> 赞同：15
> 
> 时间：2009-02-22T20:43:12.593
> 
> 标签：javascript, object, svg, raphael, gradient

我试图使用 Raphael JS 图形库。我想使用应该接受对象的属性渐变。文档说要参考 SVG 规范。例如，我在 SVG 中找到了渐变对象

```
<linearGradient id="myFillGrad" x1="0%" y1="100%" x2="100%" y2="0%">
<stop offset="5%" stop-color="red" />
<stop offset="95%" stop-color="blue" stop-opacity="0.5" />
</linearGradient> 
```

但是如何从我的 javascript 中引用它？

```
circle.attr("gradient", "myFillGrad"); 
```

不起作用:)提前谢谢

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-25T05:46:06.017

***更新：***为最新的 Raphael API 重写：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Linear Gradient</title>
  <script src="http://raphaeljs.com/raphael.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
  <script type="text/javascript" charset="utf-8">
    var paper = Raphael(10, 10, 800, 600);
    var circle = paper.circle(150, 150, 150);
    circle.attr({
      "fill": "90-#f00:5-#00f:95",
      "fill-opacity": 0.5
    });
  </script>
</body>
</html> 
```

[可在此处](http://raphaeljs.com/reference.html#attr)找到新`attr()`API的文档。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-08-30T21:58:41.730

我不相信当前的 raphael API 允许您设置除最后一个之外的单个停止不透明度，这是给定传递给“不透明度”属性的值，例如：

```
this.ellipse(x, y, r, r).attr({stroke: "none", fill: "r(.5,.1)#ccc-#ccc", opacity: 0}) 
```

...在其最后一站的停止不透明度为 0。为了更细粒度的控制，我在 raphael.js 的属性解析开关中添加了这个“案例”：

```
 case "opacityStops":
                            if (attrs.gradient) {
                                var gradient = doc.getElementById(node.getAttribute(fillString)[rp](/^url\(#|\)$/g, E));
                                if (gradient) {
                                    var stops = gradient.getElementsByTagName("stop");
                                    var opacs=value.split("-");
                                    for(var ii=0;ii<stops.length;ii++){
                                        stops[ii][setAttribute]("stop-opacity", opacs[ii]||"1");
                                    }
                                }
                                break;
                            } 
```

您还必须在“availableAttrs”对象中添加相应的条目，例如：

```
availableAttrs = {<other attrs here>..., opacityStops:"1"} 
```

调用创建具有不同不透明度停止的径向渐变圆的调用将如下所示：

```
this.ellipse(x, y, r, r).attr({stroke: "none", fill: "r(.5,.5)#fff-#fff:70-#000", "opacityStops": "1-0-0.6"} 
```

# algorithm - 计算二叉搜索树高度的最佳方法？（平衡 AVL 树）

> ID：575772
> 
> 赞同：66
> 
> 时间：2009-02-22T20:59:44.630
> 
> 标签：algorithm, data-structures, binary-tree, avl-tree, tree-balancing

我正在寻找在[AVL-tree](http://en.wikipedia.org/wiki/AVL_tree)中计算节点余额的最佳方法。我以为我可以正常工作，但是经过一些繁重的插入/更新后，我可以看到它（根本）无法正常工作。

这是一个两部分的问题，第一部分是如何计算子树的高度，我知道定义*“节点的高度是从该节点到叶子的最长向下路径的长度。”* 我理解它，但我未能实施它。为了让我更加困惑，这句话可以在 wikipedia on tree-heights 上找到*“通常，值 -1 对应于没有节点的子树，而 0 对应于具有一个节点的子树。”*

第二部分是获取 AVL 树中子树的平衡因子，我对“获取您的树*和**子树**的高度并从中减去”`L``R``R``L`*这个概念没有问题。这被定义为这样的：`BALANCE = NODE[L][HEIGHT] - NODE[R][HEIGT]`

在维基百科上阅读描述插入 AVL 树的前几行是这样说的：*“如果平衡因子变为 -1、0 或 1，那么树仍然是 AVL 形式，不需要旋转。”*

然后它继续说*“如果平衡因子变为 2 或 -2，则以该节点为根的树是不平衡的，需要进行树旋转。最多需要单轮或双轮旋转来平衡树。”* - 我很容易掌握。

但是（是的，总是有一个但是）。

这是令人困惑的地方，文本指出*“如果 R 的平衡因子为 1，则意味着插入发生在该节点的（外部）右侧并且需要左旋转”*。但是根据我的理解，文本说（正如我所引用的）如果平衡因素在范围内，`[-1, 1]`那么就不需要平衡了吗？

我觉得我已经非常接近掌握这个概念了，我已经降低了树的旋转，实现了一个正常的二叉搜索树，并且在掌握 AVL 树的边缘，但似乎只是缺少了那个重要的顿悟。

**编辑：**代码示例优于学术公式，因为我总是更容易掌握代码中的某些内容，但非常感谢任何帮助。

**编辑：**我希望我可以将所有答案都标记为“已接受”，但对我来说，尼克的答案是第一个让我“啊哈”的答案。

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-02-22T21:37:36.863

## 第 1 部分 - 高度

正如starblue所说，高度只是递归的。在伪代码中：

```
height(node) = max(height(node.L), height(node.R)) + 1 
```

现在可以通过两种方式定义高度。它可以是从根到该节点的路径中的节点数，也可以是链接数。根据[您引用的页面](http://en.wikipedia.org/wiki/Tree_height#Height)，最常见的定义是链接数。在这种情况下，完整的伪代码将是：

```
height(node): 
   if node == null:
        return -1
   else:
        return max(height(node.L), height(node.R)) + 1 
```

如果您想要节点数，代码将是：

```
height(node): 
   if node == null:
        return 0
   else:
        return max(height(node.L), height(node.R)) + 1 
```

无论哪种方式，我认为重新平衡算法应该是一样的。

但是，如果您在树中存储和更新高度信息，而不是每次都计算它，那么您的树将更加高效（*O(ln(n)) ）。*( *O(n)* )

## 第 2 部分 - 平衡

当它说“如果R的平衡因子为1”时，它是在谈论右分支的平衡因子，当顶部的平衡因子为2时。它告诉你如何选择是否进行单轮旋转或双重旋转。在（类似python的）伪代码中：

```
if balance factor(top) = 2: // right is imbalanced
     if balance factor(R) = 1: // 
          do a left rotation
     else if balance factor(R) = -1:
          do a double rotation
else: // must be -2, left is imbalanced
     if balance factor(L) = 1: // 
          do a left rotation
     else if balance factor(L) = -1:
          do a double rotation 
```

我希望这是有道理的

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-24T21:23:12.370

您不需要即时计算树的深度。

您可以在执行操作时维护它们。

此外，您实际上不必跟踪深度；您可以简单地跟踪左右树深度之间的差异。

[http://www.eternallyconfuzzled.com/tuts/datastructures/jsw_tut_avl.aspx](http://www.eternallyconfuzzled.com/tuts/datastructures/jsw_tut_avl.aspx)

我发现从编程 POV 中更容易跟踪平衡因子（左右子树之间的差异），除了在旋转后整理平衡因子是 PITA ......

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-22T21:31:08.533

*   高度很容易通过递归实现，取子树高度的最大值加一。

*   我想，“R 的平衡因子”是指不平衡的树的右子树。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-24T21:30:34.617

> 这就是令人困惑的地方，文本指出“如果 R 的平衡因子为 1，则意味着插入发生在该节点的（外部）右侧并且需要左旋转”。但是根据我的理解，文本说（正如我所引用的）如果平衡因子在 [-1, 1] 范围内，那么就不需要平衡了吗？

好的，顿悟时间。

考虑一下旋转的作用。让我们考虑一下左旋转。

```
 P = parent
 O = ourself (the element we're rotating)
 RC = right child
 LC = left child (of the right child, not of ourself)

 P              10
  \               \
   O               15
    \                \
     RC               20
    /                /
   LC               18

          ↓
 P              10
   \               \
     RC              20
   /               /
  O              15
   \               \
   LC              18

 basically, what happens is;

 1\. our right child moves into our position
 2\. we become the left child of our right child
 3\. our right child's left child becomes our right 
```

现在，您必须在这里注意一件大事——左旋转并没有改变树的深度。我们已经不再平衡了。

但是 - 这就是 AVL 的魔力 - 如果我们将正确的孩子旋转到正确的 FIRST，我们将拥有的是......

```
 P
  \
   O
    \
     LC
      \
       RC 
```

现在，如果我们向左旋转 O，我们得到的是……

```
 P
   \
     LC
    /  \
   O   RC 
```

魔法！我们已经设法摆脱了树的一个层次——*我们已经使树平衡了*。

平衡树意味着摆脱多余的深度，并更完整地打包上层——这正是我们刚刚所做的。

关于单/双旋转的全部内容就是你必须让你的子树看起来像这样；

```
 P
  \
   O
    \
     LC
      \
       RC 
```

在您旋转之前 - 您可能需要进行正确的旋转才能进入该状态。但是，如果您已经处于该状态，则只需进行左旋转即可。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-10-30T20:54:55.137

这是另一种查找高度的方法。向您的节点添加一个名为 height 的附加属性：

```
class Node
{
data value; //data is a custom data type
node right;
node left;
int height;
} 
```

现在，我们将对树进行简单的广度优先遍历，并不断更新每个节点的高度值：

```
int height (Node root)
{
Queue<Node> q = Queue<Node>();
Node lastnode;
//reset height
root.height = 0;

q.Enqueue(root);
while(q.Count > 0)
{
   lastnode = q.Dequeue();
   if (lastnode.left != null){
      lastnode.left.height = lastnode.height + 1; 
      q.Enqueue(lastnode.left);
   }

   if (lastnode.right != null){
      lastnode.right.height = lastnode.height + 1;
      q.Enqueue(lastnode.right);
   }
}
return lastnode.height; //this will return a 0-based height, so just a root has a height of 0
} 
```

干杯，

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-22T21:49:13.717

好吧，您可以使用以下递归函数计算树的高度：

```
int height(struct tree *t) {
    if (t == NULL)
        return 0;
    else
        return max(height(t->left), height(t->right)) + 1;
} 
```

`max()`和的适当定义`struct tree`。您应该花时间弄清楚为什么这与您引用的基于路径长度的定义相对应。此函数使用零作为空树的高度。

但是，对于像 AVL 树这样的东西，我认为您实际上不会在每次需要时计算高度。相反，每个树节点都增加了一个额外的字段，该字段记住以该节点为根的子树的高度。当树被插入和删除修改时，该字段必须保持最新。

我怀疑，如果您每次都计算高度而不是像上面建议的那样将其缓存在树中，那么 AVL 树的形状将是正确的，但它不会具有预期的对数性能。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-22T21:52:27.653

> 这就是令人困惑的地方，文本指出“如果 R 的平衡因子为 1，则意味着插入发生在该节点的（外部）右侧并且需要左旋转”。但是根据我的理解，文本说（正如我所引用的）如果平衡因子在 [-1, 1] 范围内，那么就不需要平衡了吗？

`R`是当前节点的右手子节点`N`。

如果`balance(N) = +2`，那么您需要某种轮换。但是使用哪个轮换？好吧，这取决于`balance(R)`：如果`balance(R) = +1`那么您需要左旋转`N`; 但是如果`balance(R) = -1`那样的话，您将需要某种双重旋转。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-10-24T00:16:17.470

给`BinaryTree<T, Comparator>::Node`一个`subtreeHeight`数据成员，在其构造函数中初始化为 0，并且每次都自动更新：

```
template <typename T, typename Comparator>
inline void BinaryTree<T, Comparator>::Node::setLeft (std::shared_ptr<Node>& node) {
    const std::size_t formerLeftSubtreeSize = left ? left->subtreeSize : 0;
    left = node;
    if (node) {
        node->parent = this->shared_from_this();
        subtreeSize++;
        node->depthFromRoot = depthFromRoot + 1;
        const std::size_t h = node->subtreeHeight;
        if (right)
            subtreeHeight = std::max (right->subtreeHeight, h) + 1;
        else
            subtreeHeight = h + 1;
    }
    else {
        subtreeSize -= formerLeftSubtreeSize;
        subtreeHeight = right ? right->subtreeHeight + 1 : 0;
    }
}

template <typename T, typename Comparator>
inline void BinaryTree<T, Comparator>::Node::setRight (std::shared_ptr<Node>& node) {
    const std::size_t formerRightSubtreeSize = right ? right->subtreeSize : 0;
    right = node;
    if (node) {
        node->parent = this->shared_from_this();
        subtreeSize++;
        node->depthFromRoot = depthFromRoot + 1;
        const std::size_t h = node->subtreeHeight;
        if (left)
            subtreeHeight = std::max (left->subtreeHeight, h) + 1;
        else
            subtreeHeight = h + 1;
    }
    else {
        subtreeSize -= formerRightSubtreeSize;
        subtreeHeight = left ? left->subtreeHeight + 1 : 0;
    }
} 
```

请注意，数据成员`subtreeSize`和`depthFromRoot`也会更新。插入节点时会调用这些函数（所有已测试），例如

```
template <typename T, typename Comparator>
inline std::shared_ptr<typename BinaryTree<T, Comparator>::Node>
BinaryTree<T, Comparator>::Node::insert (BinaryTree& tree, const T& t, std::shared_ptr<Node>& node) {
    if (!node) {
        std::shared_ptr<Node> newNode = std::make_shared<Node>(tree, t);
        node = newNode;
        return newNode;
    }
    if (getComparator()(t, node->value)) {
        std::shared_ptr<Node> newLeft = insert(tree, t, node->left);
        node->setLeft(newLeft);
    }
    else {
        std::shared_ptr<Node> newRight = insert(tree, t, node->right);
        node->setRight(newRight);
    }
    return node;
} 
```

如果删除节点，请使用不同版本的`removeLeft`and`removeRight`替换`subtreeSize++;`为`subtreeSize--;`. 和的算法`rotateLeft`也`rotateRight`可以毫无问题地进行调整。以下测试并通过：

```
template <typename T, typename Comparator>
void BinaryTree<T, Comparator>::rotateLeft (std::shared_ptr<Node>& node) {  // The root of the rotation is 'node', and its right child is the pivot of the rotation.  The pivot will rotate counter-clockwise and become the new parent of 'node'.
    std::shared_ptr<Node> pivot = node->right;
    pivot->subtreeSize = node->subtreeSize;
    pivot->depthFromRoot--;
    node->subtreeSize--;  // Since 'pivot' will no longer be in the subtree rooted at 'node'.
    const std::size_t a = pivot->left ? pivot->left->subtreeHeight + 1 : 0;  // Need to establish node->heightOfSubtree before pivot->heightOfSubtree is established, since pivot->heightOfSubtree depends on it.
    node->subtreeHeight = node->left ? std::max(a, node->left->subtreeHeight + 1) : std::max<std::size_t>(a,1);
    if (pivot->right) {
        node->subtreeSize -= pivot->right->subtreeSize;  // The subtree rooted at 'node' loses the subtree rooted at pivot->right.
        pivot->subtreeHeight = std::max (pivot->right->subtreeHeight, node->subtreeHeight) + 1;
    }
    else
        pivot->subtreeHeight = node->subtreeHeight + 1;
    node->depthFromRoot++;
    decreaseDepthFromRoot(pivot->right);  // Recursive call for the entire subtree rooted at pivot->right.
    increaseDepthFromRoot(node->left);  // Recursive call for the entire subtree rooted at node->left.
    pivot->parent = node->parent;
    if (pivot->parent) {  // pivot's new parent will be its former grandparent, which is not nullptr, so the grandparent must be updated with a new left or right child (depending on whether 'node' was its left or right child).
        if (pivot->parent->left == node)
            pivot->parent->left = pivot;
        else
            pivot->parent->right = pivot;
    }
    node->setRightSimple(pivot->left);  // Since pivot->left->value is less than pivot->value but greater than node->value.  We use the NoSizeAdjustment version because the 'subtreeSize' values of 'node' and 'pivot' are correct already.
    pivot->setLeftSimple(node);
    if (node == root) {
        root = pivot;
        root->parent = nullptr; 
    }
} 
```

在哪里

```
inline void decreaseDepthFromRoot (std::shared_ptr<Node>& node) {adjustDepthFromRoot(node, -1);}
inline void increaseDepthFromRoot (std::shared_ptr<Node>& node) {adjustDepthFromRoot(node, 1);}

template <typename T, typename Comparator>
inline void BinaryTree<T, Comparator>::adjustDepthFromRoot (std::shared_ptr<Node>& node, int adjustment) {
    if (!node)
        return;
    node->depthFromRoot += adjustment;
    adjustDepthFromRoot (node->left, adjustment);
    adjustDepthFromRoot (node->right, adjustment);
} 
```

这是整个代码：http: [//ideone.com/d6arrv](http://ideone.com/d6arrv)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-10-16T14:34:56.180

这种类似 BFS 的解决方案非常简单。只需一个接一个地跳级。

```
def getHeight(self,root, method='links'):
    c_node = root
    cur_lvl_nodes = [root]
    nxt_lvl_nodes = []
    height = {'links': -1, 'nodes': 0}[method]

    while(cur_lvl_nodes or nxt_lvl_nodes):
        for c_node in cur_lvl_nodes:
            for n_node in filter(lambda x: x is not None, [c_node.left, c_node.right]):
                nxt_lvl_nodes.append(n_node)

        cur_lvl_nodes = nxt_lvl_nodes
        nxt_lvl_nodes = []
        height += 1

    return height 
```

# java - 如何在 JTable 单元格中显示动画

> ID：575782
> 
> 赞同：9
> 
> 时间：2009-02-22T21:03:01.547
> 
> 标签：java, user-interface, animation, animated-gif

我正在寻找一种在表格单元格中显示动画进度指示器（动画 GIF、通过 Java2D 呈现的旋转轮等，此处没有偏好）的方法，直到计算或检索到最终显示的值。

到目前为止，我刚刚在尚未准备好加快显示速度的每个单元格中放置了一个静态的“待定...”文本。当数据从后台线程到达时，我将其放入适当的单元格并在表上调用 repaint。

使用静态标签或图像可以正常工作，但是因为单元格渲染仅将其用作橡皮图章，并且不会为每个单元格创建单独的实例（这当然是一个好主意），例如动画 GIF不是在单个单元格中“玩耍”。

我怎样才能达到这样的效果？它会使用户界面更加“精致”，而不仅仅是简单的文本。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-22T22:41:25.307

首先，我采用了 Nick Fortescue 的相同想法（方法 2）。然而就在那之后，我偶然发现

[兔子洞博客](http://rabbit-hole.blogspot.com/2006/09/animated-icon-redux.html)

作者为动画图标（基于 GIF）以及 Java2D 绘制的无限进度指示器（著名的 Mac OS X 像旋转轮）提供了非常有用的类，我可以直接放入我的应用程序而不必担心太多的绘画我。

但是，如果我没有找到这些，尼克的方式就是这样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T21:24:40.077

正如您所说，基本的 JTable 渲染机制不支持这一点， CellRenderer 用于绘制单元格（或根据需要绘制单元格的一部分），并且不允许重新绘制，它按需绘制。

## 方法 1 - JLayeredPane

如果我需要这样做，我会使用[JLayeredPane](http://java.sun.com/docs/books/tutorial/uiswing/components/layeredpane.html)在 JTable 上绘制我的动画渲染器。

但是，我认为这将是很多工作。您需要做很多正确的事情，特别是如果您将它放在滚动窗格中。您的收容层次结构类似于：

JScrollPane -> (Viewport) JLayeredPane -> JTable & JPanel（透明，带动画）

您还需要为动画面板布置一项棘手的工作，您要么需要自定义布局管理器来镜像 JTable 列宽，要么使用 GridLayout 之类的东西。可以，但工作量很大。

## Method2 - 自定义 CellRenderer 并在 Swing Timer 中重绘

唯一的选择是保留一个动画单元的列表，然后维护一个摆动计时器，重复调用它们的重绘。然后，您将有一个自定义 CellRenderer 进行动画绘画，绘画随时间而变化。这可能更简单，但是在不消耗 CPU 的情况下获得正确的帧速率，并且更新重绘以匹配动画更新可能会导致一些奇怪的视觉效果

# sql - 排行榜的高效 SQL 查询/架构

> ID：575785
> 
> 赞同：8
> 
> 时间：2009-02-22T21:03:13.077
> 
> 标签：sql

我写了一个愚蠢的小游戏，并希望有某种排行榜网站。

**通常排行榜仅限于 10 或 20 名顶级玩家，但我认为如果我能记录每位玩家的最高得分，**那就太好了。然后，我总是可以显示他们的世界排名。

一个简单的模式，例如：

```
create table leaderboard (
    userid varchar(128) not null,
    score real not null,
    when datetime not null
);
create index on leaderboard(userid); 
```

将存储我需要的最少量信息 - 每个用户 1 个条目以及他们的最佳分数。

我的问题围绕着如何有效地确定某人在排行榜上的位置。一般的想法是，我希望他们在返回的列表中的位置：

```
select userid from leaderboard order by score desc 
```

但是从数据库性能的角度来看，运行这个查询然后线性搜索列表对我来说似乎有点荒谬。即便如此，我还是很难想象一个查询/模式可以使它成为一个快速的操作。

有任何想法吗？

（我更愿意保持 DB 模式和查询通用（不依赖于供应商）。但是，如果一个供应商让这变得简单，我很乐意使用 MS SQL 或 MySQL。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-22T21:07:14.940

怎么样：

```
select count(*)+1 as rank from leaderboard  
where score > (select score from leaderboard where userid = ?) 
```

您还需要在 score 列上建立索引。

即使多个玩家得分相同，`count()+1`使用 with也会为您提供准确的排名；`score > (...)`不会。`count()`_`score >= (...)`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T22:06:39.727

在 SQL Server 2005 及更高版本中，您可以使用该[`RANK()`](http://msdn.microsoft.com/en-us/library/ms176102(SQL.90).aspx)函数根据每个用户的分数返回排名

```
SELECT 
    userid,
    RANK() OVER 
    (ORDER BY score) AS rank
FROM leaderboard 
```

如果您有不止一种“游戏类型”，那么您可以将其包含在排行榜表中，并使用函数中的`PARTITION BY`子句`RANK`来确定每种游戏类型的排名。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T21:06:06.737

显而易见的选择是在“分数”上创建一个索引，这是完全合理的。（听起来你想保留两个值 - 累积分数和高水位分数 - 否则我误解了？）

除非您期望有数以万计的用户，否则即使表扫描对于有这么多记录的表也不应该是一个大问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T21:14:50.227

看起来你想查询这个：

```
select userid , max(score)
from leaderboard 
group by userid
order by max(score) desc 
```

这将为每个用户返回包含 1 个条目的排行榜。

编辑如下：我在评论中看到您想查看排名，而不是分数。为此，我不知道 ANSI SQL 的答案，但特定于数据库：

在 MySQL 中：

```
SELECT @rownum:=@rownum+1 rank
, t.userid 
FROM (SELECT @rownum:=0) r, 
 (select userid , score
from leaderboard 
order by score desc
) t; 
```

在 Oracle 中，您可以使用 RANK 语句。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T21:20:28.823

如果这不必是实时的（例如，如果可以接受每天更新一次），则添加一个额外的“位置”字段并使用按分数排序的查询定期更新它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-30T23:19:41.603

在 Sql server 2005 中，Rank() 几乎可以为您完成这项工作。但是，如果您有数百万条记录，那么每当基础统计数据发生变化时对它们进行实时排名将是性能消耗。

我试图在选择查询之上创建一个索引视图......（这个线程中的投票答案）但 Sql 2005 不允许我创建它，因为你不能在索引视图中使用子查询和自引用。

所以我们的解决方法是使用 Row() 函数每晚更新排名表。为避免在执行此更新时出现阻塞，我们保留了 2 份排名表副本，一份正在更新，一份正在应用程序中使用。我们有一个 RankingView，它在任何给定时间都指向活动的排名表。

我想知道是否有针对非常大的表格进行实时排名更新的解决方案？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-02-26T21:44:48.730

我正在考虑选择“从排行榜中选择计数（*）+1作为排名，
其中得分>（从排行榜中选择得分，其中用户ID =？）”

考虑以下情况：玩家 1，得分 100 玩家 2，得分 100 玩家 3，得分 50

Using that SQL the rank of player 3 would be 3, where the correct answer should be 2, because Player 1 and Player 2 are tied in the first position. The count() aggregate function in that case consider 2 records with Score column > 50.

To handle this case I think the right option is to make a group by, so repeatable values of score will be handled as a single ranking position:

```
select score, count(*)+1 as rank from leaderboard  
group by score having (score) > (select score from leaderboard where userid = ?) 
```

# php - 行数不是列 ID

> ID：575789
> 
> 赞同：0
> 
> 时间：2009-02-22T21:04:06.897
> 
> 标签：php

```
 $query = mysql_query("
    SELECT * FROM comments
    ORDER BY comments.comment_date ASC");

    while ($row = mysql_fetch_assoc($query)) {
    .......
    } 
```

我将如何为评论“编号”。

喜欢[这个网站](http://fragbite.com/?threadID=522519&commentPage=1#comments)

你知道...

1\.
2\.
3\.
4\.
5\.
...

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T21:06:33.880

```
$i = 0;
while ($row = mysql_fetch_assoc($query)) {
   $i++;
   print $i; 
   .......
} 
```

您可以计入您的周期，因此您可以获得与数据库无关的一致编号！=)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T21:09:48.257

您还可以使用排序列表（`OL`元素）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T21:07:11.040

```
$query = mysql_query("
SELECT * FROM comments
ORDER BY comments.comment_date ASC");
$num = 1;
while ($row = mysql_fetch_assoc($query)) {
    echo $num++;
    .......
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T21:50:06.910

诚然，我的背景是 MS SQL 而不是 MySQL，但听起来您正在寻找一种方法来完成 ROW_NUMBER() ( [msdn article](http://msdn.microsoft.com/en-us/library/ms186734.aspx) ) 在 MS SQL 2005 中完成的工作。在 2005 年之前，一种对结果行进行编号的方法是通过创建一个存储过程来返回一个表变量（或临时表）来完成。因此，您将创建表的临时表示，包括 RowNum 的新列，并让存储过程返回新表。例如...

*这些是 MS SQL 命令，但我假设 MySQL 的命令是相似的*

```
CREATE TABLE @TempComments
(
    RowNum smallint not null IDENTITY(1,1),
    ...other fields...
)

INSERT INTO @TempComments (all fields except RowNum)
SELECT * FROM comments 
```

让存储过程返回`@TempComments`到您的应用程序，现在您有了一个注释表，其中每行都有一个连续的行号。

看起来 MySQL 在 5.0 版中实现了存储过程，所以希望这就是你正在使用的。

希望对您有所帮助，其他人可以随意添加正确的 MySQL 语法。

# objective-c - 为自定义类中的全局变量设置默认值？

> ID：575790
> 
> 赞同：0
> 
> 时间：2009-02-22T21:04:36.943
> 
> 标签：objective-c, cocoa, xcode, macos

我有一个自定义类，它有很多用于自定义它的访问器方法。我的问题是，如果程序员使用这个类并且因为他不知道或不想打扰所有这些方法而不费心为所有这些方法分配值，我怎样才能让这个类假定一个默认视图？我不能使用 awakeFromNib，因为这会覆盖 AppController awakeFromNib 中的有目的的自定义。

有什么简单的方法可以做到这一点吗？

编辑：

NSView 中的类和自定义方法只是修改实例变量然后告诉视图重绘（背景颜色等）。当我没有明确告诉某个对象为所有这些自定义项分配值时，它会将它们设置为零。我需要将其更改为他们假定可用默认值的位置。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T21:22:12.283

我对你想要做什么感到困惑。如果您想为类成员设置默认值，只需在您的`init`方法中分配给它们：

```
- (id) init
{
    if((self = [super init]))
    {
        member1 = member1default;
        member2 = member2default;  // etc.
    }
    return self;
}

- (id) initWithCoder:(NSCoder *)encoder  // this is called for objects constructed from a NIB
{
    if((self = [super initWithCoder:encoder]))
    {
        member1 = member1default;
        member2 = member2default;  // etc.
    }
    return self;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-24T05:25:43.217

（很抱歉成为 StackOverflow 菜鸟；我似乎还无法评论其他人的答案。）

是的，您通常会在自定义 NSView 子类中覆盖 initWithFrame。确保你也调用了超类的 initWithFrame: 方法：

```
self = [super initWithFrame:frameRect]; 
```

关于加载大量堆栈帧的错误消息让我认为您可能无意中创建了一个无限递归循环。但是，没有看到代码我不能肯定地说。

# iphone - iPhone NavigationController - 推送相同的视图，收到不同的布局

> ID：575794
> 
> 赞同：4
> 
> 时间：2009-02-22T21:06:15.020
> 
> 标签：iphone

我有一个选项卡式应用程序，每个选项卡都有一个导航控制器。我使用帮助代码将视图/控制器对推送到导航堆栈上，但是当我从两个不同的地方调用相同的代码时，我得到（令人惊讶的）不同的结果。在一种情况下，视图呈现低于另一种情况，看起来低了导航栏高度。

从一个标签推（处于良好位置）：

![](https://content.screencast.com/users/adam_jack/folders/Jing/media/3f9fb818-5678-47b7-8b83-37d34eae2baf/00000006.png)

从另一个选项卡推送（太低）：

![](https://content.screencast.com/users/adam_jack/folders/Jing/media/88382e93-231e-4b7d-a003-b2b1f638f932/00000005.png)

厦门国际银行：

![](https://content.screencast.com/users/adam_jack/folders/Jing/media/bba933c4-0a71-4caf-a7a6-a5141f5bc37b/00000007.png)

这是推送代码：

```
+ (void)navigateToLocation:(Location*)location controller:(UIViewController*)vc withDelegate:(NSObject <LocationEditDelegate> *)delegate {

    LocationDetailsViewController *detailsController = [[LocationDetailsViewController alloc] initWithNibName:@"LocationDetailsViewController" bundle:nil];

    detailsController.title = [location display];
    detailsController.location = location;
    detailsController.delegate = delegate;

    // Push the detail view controller
    [[vc navigationController] pushViewController:detailsController animated:YES];

    [detailsController release];
} 
```

任何人都可以帮助我了解可能发生的事情，以及我如何进入其中？

我安装了 2.2.1 并使用 2.2 构建/部署。

由于似乎没有显示评论，因此我在底部进行了注释。如果我做错了事，请编辑这个：

*   我添加了模拟指标，行为没有改变。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T03:47:14.860

尝试了这些建议后，我注意到一个标签与其他标签之间存在细微差别。它的视图显示为适合标签栏上方*和*导航栏下方。其他人没有，他们的“内部视图”似乎滑到了导航后面（结果子视图也有问题。）

我不记得这些选项卡是如何创建的，但我重新创建了它们（在 MainView.xib 上设置了模拟指标，以防它产生影响，我怀疑这是因为一个选项卡已经“正确”。）无论如何，事情现在正在工作......

问题标签：

![替代文字](https://content.screencast.com/users/adam_jack/folders/Jing/media/26efb78c-847c-41bc-8c11-28f2351ef191/00000012.png)

工作选项卡：

![替代文字](https://content.screencast.com/users/adam_jack/folders/Jing/media/9b47d7fc-3fc7-4f84-990c-9799370eb683/00000013.png)

...**请参阅“内部视图周围的虚线”以及虚线顶部的结束位置。**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T01:33:25.220

我前段时间遇到过这个问题。如果我没记错的话，在我的脑海中，有一个在 IB 中选中的“自动调整视图以填充屏幕”框。我想它在标签栏上的某个地方。取消选择它解决了我的问题

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T21:13:22.990

这几乎肯定与在 XIB 中不使用模拟指标有关。尝试将模拟导航栏添加到您的 XIB 中，看看它是否有任何改变。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T04:28:51.930

选项卡之一是否没有导航栏开始？

此外，看起来底部的绿色条与视图的其余部分在同一个 XIB 中，但它没有被推下。那是对的吗？

如果是这样，另一种解决方案是转到所有上部元素的标尺选项卡，并确保它们被锁定到视图的顶部边缘，这样它们就不能被向下移动......

# java - 需要帮助设计“无限”线程

> ID：575803
> 
> 赞同：4
> 
> 时间：2009-02-22T21:07:55.280
> 
> 标签：java, concurrency

我有一些数据库表，只要应用程序正在运行，就需要一次处理 5 个记录。所以，它看起来像这样：

1.  获取其他线程尚未处理或当前未处理的记录。
2.  处理它（这是一个漫长的过程，取决于互联网连接，因此它可能会超时/抛出错误）。
3.  移动到下一条记录。当到达表的末尾时从头开始。

我对线程没有太多经验，所以我看到了两种可能的策略：

**方法 A。**

1.新建ExecutorService：

```
ExecutorService taskExecutor = Executors.newFixedThreadPool(5); 
```

2.添加5个任务：

```
for (int i = 0; i < 5; i++) {
    taskExecutor.execute(new MyTask());
} 
```

3.每个任务都是无限循环的，即：从表中读取一条记录，处理它，然后获取另一条记录。

这种方法的问题是如何通知其他线程当前正在处理哪些记录。为此，我可以使用表中的“状态”字段，或者只使用一些保存当前处理 ID 的 CopyOnWriteArraySet。

**方法 B。**

1.创建相同的ExecutorService：

```
ExecutorService taskExecutor = Executors.newFixedThreadPool(5); 
```

2.有一个无限循环选择需要处理的记录并将它们传递给执行程序：

```
while (true) {
    //get next record here
    taskExecutor.execute(new MyTask(record));
    //monitor the queue and wait until some thread is done processing,
    //so I can add another record
} 
```

3.每个任务处理一条记录。

这种方法的问题是我需要将任务添加到执行程序的队列中，速度比处理它们的速度要慢，以免它们随着时间的推移而堆积。这意味着我不仅需要监控当前正在运行的任务，还需要监控它们何时完成处理，这样我就可以将新记录添加到队列中。

我个人认为第一种方法更好（更容易），但我觉得第二种方法更正确。你怎么看？或者也许我应该做一些完全不同的事情？

如果需要，我也可以为此使用 Spring 或 Quartz 库。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-22T21:37:03.480

我认为[CompletionService](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/CompletionService.html)（和[ExecutorCompletionService](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ExecutorCompletionService.html)）可以帮助你。

您通过完成服务提交所有任务，它允许您等到一个线程（任何线程）完成其任务。这样一有空闲线程，您就可以提交下一个任务。这意味着您使用方法 B。

伪代码：

```
Create ThreadPoolExecutor and ExecutorCompletionService wrapping it

while (true) {
  int freeThreads = executor.getMaximumPoolSize() - executor.getActiveCount()
  fetch 'freeThreads' tasks and submit to completion service (which
                                      in turn sends it to executor)

  wait until completion service reports finished task (with timeout)
} 
```

等待超时可帮助您避免队列中没有任务的情况，因此所有线程都处于空闲状态，您正在等待其中一个完成 - 这永远不会发生。

[您可以通过ThreadPoolExecutor](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ThreadPoolExecutor.html)方法检查空闲线程的数量：（`getActiveCount`活动线程）和`getMaximumPoolSize`（最大可用配置线程）。您将需要直接创建 ThreadPoolExecutor，或者强制转换从 Executors.newFixedThreadPool() 返回的对象，尽管我更喜欢直接创建...有关详细信息，请参阅 Executors.newFixedThreadPool() 方法的源代码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T21:27:34.907

另一种方法是使用大小为 5 的 ArrayBlockingQueue。单个生产者线程将遍历表，最初填充它并在消费者处理它们时将记录放入。五个消费者线程将分别获取（）一条记录，处理它并返回另一条记录。这样，生产者线程确保不会同时向两个线程提供任何记录，而消费者线程则处理独立的记录。[Java Concurrency in Practice](http://jcip.net/)可能会给你更多的选择，对于这类问题来说是一本很好的读物。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T21:12:15.690

我会采用这种方法：

使用一个线程来分配工作。该线程将产生 5 个其他线程并进入睡眠状态。当一个工作线程完成时，它会唤醒工作分配器线程，然后它会产生新的工作线程并进入睡眠状态......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T03:15:38.110

我会在 MyTask 中有一个静态集合

```
public class MyTask implements Runnable {
  private static ArrayList<RecordID> processed = new ArrayList<RecordID>();
  private static ArrayList<RecordID> processing = new ArrayList<RecordID>();

  private RecordID working = null;

  public void run() {
    for(;;) {
      synchronized( MyTask.class ) {
        Record r = getUnprocessedRecord(); // use processed and processing to do query
        if ( r == null ) {  // no more in table to process
          if ( processing.length == 0 ) { // nothing is processing
            processed.clear();  // this should allow us to get some results on the next loop
          }
          Thread.sleep( SLEEP_INTERVAL );
          continue;
        } else {
          working = r.getRecordID();
          processing.add( working );
        }
      }
      try {
        //do work
        synchronized( MyTask.class ) {
          processed.add(working);
        }
      } catch( Whatever w ){
      } finally {
        synchronized( MyTask.class ) {
          processing.remove(working);
        }
      } 
    }
  } 
```

}

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T06:51:49.183

我个人的意见，去 QUARTZ with Spring。它是完美的选择。已经在生产中使用它 2 年多了。当有些人已经做得最好时，为什么还要尝试重新发明轮子。更不用说它提供的不同运行模式了。我建议至少尝试一下。

# nhibernate - NHibernate 是否可以在不使用存储过程的情况下进行非规范化更新？

> ID：575810
> 
> 赞同：1
> 
> 时间：2009-02-22T21:14:11.973
> 
> 标签：nhibernate, nhibernate-mapping, denormalization

我正在考虑在一个项目中使用 NHibernate，该项目的数据库具有一定程度的计划非规范化（由 DBA 计划）。从一组表中读取并将一列映射到一个属性不是问题。但是，在更新时，我必须将一个属性映射回原始表中的原始列，并在非规范化表中更新该列的几个副本。是否可以在不使用存储过程的情况下使用 NHibernate 做到这一点？

编辑：虽然我倾向于同意 NXC 的回答，但这个问题是关于如何解决 NHibernate 的问题，而不是在数据库中解决问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T22:27:08.523

是的，您可以注册一个从 DefaultSaveOrUpdateEventListener 继承的事件侦听器，覆盖 OnSaveOrUpdate 并更新其他实体。

以下是一些关于事件监听器的博客文章：

*   [http://nhforge.org/blogs/nhibernate/archive/2008/09/06/soft-deletes.aspx](http://nhforge.org/blogs/nhibernate/archive/2008/09/06/soft-deletes.aspx)
*   [http://darioquintana.com.ar/blogging/?p=9](http://darioquintana.com.ar/blogging/?p=9)
*   [http://www.codinginstinct.com/2008/04/nhibernate-20-events-and-listeners.html](http://www.codinginstinct.com/2008/04/nhibernate-20-events-and-listeners.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T23:33:01.453

关于非规范化数据的一些想法：

*   谨慎使用；众所周知，过度使用非规范化数据是导致维护和数据质量问题的根源。我参与的一个 J2EE 项目在 560 个表中只有 4 个非规范化数据项——其中两个是搜索表。

*   依靠应用程序来保持非规范化数据同步是一种已知的反模式。在事务系统中维护非规范化数据的普遍接受的方法是使用数据库触发器。使用触发器意味着来自任何来源（不仅仅是您的应用程序）的更新将由数据库本身传播。您最好使用触发器来维护非规范化数据，除非有特定的东西阻止它。

*   非规范化数据给维护开发人员留下了陷阱（尤其是如果您不使用数据库触发器来维护数据）。确保记录每条非规范化数据。

# encryption - Vim 加密：如何破解？

> ID：575817
> 
> 赞同：31
> 
> 时间：2009-02-22T21:19:04.693
> 
> 标签：encryption, vim, vi

最近我决定使用 vim 的 :X 加密功能来加密我的工程日志。我写下了密码，但显然我拼错了一些东西或弄乱了一些东西，因为解密文件只会产生乱码。更糟糕的是，我*所有*的备份都以某种方式损坏了（不要问，我也不知道是怎么回事）。

我不会找借口：我知道我搞砸了。现在我想专注于如何解决我造成的混乱。

这是我尝试过的：

1.  使用 vimzipper 将加密文件打包在一个 zip 中，这样它就可以被标准的 zip 破解器破解，如 fcrackzip、zipcracker、pkcrack、Advanced Zip Password Recovery 等。不幸的是，这没有奏效。我使用 VIMINFO 中寄存器的剩余信息从文件中恢复了一行纯文本，但文件中没有恢复的纯文本的偏移量。无论如何，zip 破解并没有奏效，即使对于一个带有三个字符的 vim 密码的简单测试文件也是如此。

    （见[http://zeus.phys.uconn.edu/refs/crackers/vimzipper.c](http://zeus.phys.uconn.edu/refs/crackers/vimzipper.c)）

2.  交换文件的恢复不起作用。当我用错误的密码重新打开加密文件时，vim 覆盖了“好的”交换文件。

3.  使用大型纯文本数据库（约 30 本书来自 Project Gutenberg）作为参考数据运行 unixcrypt-breaker。这会导致乱码，即使我只用恢复的明文播种 unixcrypt-breaker。此外，我似乎无法破解使用此方法使用 vim 加密的简单测试文件。（仅供参考，我在运行解密之前剥离了 VimCrypt~01! 魔术头，并在 PASTE 模式下使用 vim 将其剥离，因此我不会更改文件的内容）。

4.  拼命猜测我能想象到的每一个密码和拼写错误。我花了至少六个小时来猜测我可能拼错了什么。:)

为了从程序中快速尝试密码，我尝试编译 crypt/makekey 的旧 UNIX 副本，但结果与使用 vim 的 -x 加密和相同密码加密的相同文件不同。

如果有人可以提供帮助，我将不胜感激。如果没有，感谢阅读。:)

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-22T21:40:09.790

从[VIM 文档](http://vimdoc.sourceforge.net/htmldoc/editing.html#encryption)：

*   使用的算法是可破解的。一个 4 个字符的密钥在大约一小时内，一个 6 个字符的密钥在一天内（在 Pentium 133 PC 上）。这要求您知道一些必须出现在文件中的文本。专家可以用任何键破解它。当文本被解密后，这也意味着密钥可以被泄露，其他使用相同密钥加密的文件也可以被解密。

如果它在 Pentium 133 上是可行的，我认为你有很好的机会。:)

我要么使用#vim 询问算法的详细信息，要么浏览源代码以了解加密是如何工作的，然后编写一个密码分析程序。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-22T22:37:28.093

除了加密问题之外，您是否可能还会遇到数据损坏问题？

如果我要强制执行此操作，我想我会编写一个算法，开始尝试我可以使用的所有密码变体，然后再进行字典攻击。然而，在听完你的故事之后——我有一种挥之不去的感觉，你没有忘记你的密码，而是在某个地方出现了数据损坏问题，弄乱了你的密码/密码文本/密码密钥/其他任何东西。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-22T21:51:39.420

不确定这是否有帮助：

*   [**Crypt Breaker 的自述文件**](http://axion.physics.ubc.ca/cbw.html)

解释如何破解用“crypt”加密的文件，可能会给你一个起点（至少对于旧版本的 vi，加密是基于 crypt）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-22T22:22:05.290

这个古老[的新闻组帖子](http://www.sunmanagers.org/archives/1998/0783.html)与您的问题类似：

> 我的问题是我不小心使用 vi 加密了一个脚本并且无法记住密钥。非常感谢所有回复的人。
> 
> 建议如下：
> 
> *   使用 vi -x 并猜测密钥（我曾尝试过但没有成功）
> *   编写一个程序来进行 crypt 调用并尝试可能的组合键。提出这个建议的人估计大约需要 5 分钟才能破解
> *   从档案中下载 CWB（crypt 断路器工作台），这将有助于破解
> *   将问题发布到 sci.crypt.newsgroup，包括加密后文件的前 128 个字节和加密前的这些字节（如果我记得的话），小组中的某个人可能会帮我破解它
> *   重新输入脚本

打破这一点的一个婴儿床是你知道密码“应该”是什么。因此，即使您有一个随机拼写错误，它仍然会与您的预期密码略有相似。也许您可以从那里开始，编写一个程序来生成您想要的密码与 1 或 2 个字符拼写错误的所有可能组合。

无论如何，多么巧妙的练习/消遣！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-12-17T21:30:24.707

这个问题很老了。这是一个现代解决方案：

使用 hashcat ( [https://hashcat.net/hashcat/](https://hashcat.net/hashcat/) )。Hashcat 有一个适用于广泛加密算法的插件，它允许您指定和播种您的（蛮力起点-）字典文件，其中包含您仍然记得的有关丢失密码的提示。

# python - 在python中对字典键进行排序

> ID：575819
> 
> 赞同：144
> 
> 时间：2009-02-22T21:19:51.070
> 
> 标签：python, sorting

我有一个字典，其中每个键都引用一个 int 值。根据值将键排序到列表中的最佳方法是什么？

* * *

## 回答 #1

> 赞同：356
> 
> 时间：2009-02-22T21:53:13.190

我喜欢这一个：

```
sorted(d, key=d.get) 
```

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2009-02-22T21:21:22.050

```
>>> mydict = {'a':1,'b':3,'c':2}
>>> sorted(mydict, key=lambda key: mydict[key])
['a', 'c', 'b'] 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-22T21:22:21.330

```
my_list = sorted(dict.items(), key=lambda x: x[1]) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-22T21:24:45.037

```
[v[0] for v in sorted(foo.items(), key=lambda(k,v): (v,k))] 
```

# asp.net - 如何通过 ASP.net 网站将新条目插入 Access db 表？

> ID：575821
> 
> 赞同：1
> 
> 时间：2009-02-22T21:20:37.310
> 
> 标签：asp.net, visual-studio, visual-studio-2008, ms-access

我需要将新记录插入 Access 数据库。
我正在使用 Visual Studio 2008 并首先创建一个 asp.net 网站。我可以使用 dataview 或 gridview 连接到 Access 数据库中的信息，并可以查询特定条目（即提案编号 - 显示链接到该提案的所有详细信息）。
然后我可以编辑该提案的详细信息，这将更新 Access Db。
我需要做的是有一个表格，可以简单地为新客户输入新的详细信息。IE。输入姓名 [____] 输入地址 [____]。然后为此更新数据库。通过使用 gridview 或 dataview，我可以查看表中存在的所有字段并对其进行编辑。有没有办法让我获得一个空白的 gridview/dataview 模板（包括表中的所有字段）并填写它然后更新数据库？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T21:54:33.873

最好的方法是在您的网格视图正下方添加一个表格，并将表单字段粘贴到其中。

或者，您可以将表单字段放在网格的 <asp:FooterTemplate> 中，但是当您的网格为空时，您必须将它们复制到 <EmptyDataTemplate> 中才能看到 ADD 表单。

当用户单击添加按钮时，将表单数据插入数据库，并重新绑定网格以显示新插入的行。

编辑：要回答您的评论，您必须在网格视图中使用 <asp:TemplateFiels> 才能将“插入表单”放入FooterTemplate。我假设您现在正在使用 <asp:BoundField>。

同样，我建议您将“插入表格”放在网格正下方的表格中。

阅读[这篇文章](http://fredrik.nsquared2.com/viewpost.aspx?PostID=155)以获得详细解释

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T21:58:25.097

允许最终用户将新记录添加到数据库的常用方法是通过向用户提供一组控件来填写和/或从中进行选择，即许多带标签的文本框、列表框、复选框等控件。

如何布置这些取决于您，您可以布置它们以模仿您的网格视图。我建议创建一个用户控件，然后在您的页面中使用它。

**编辑：**

要回答有关如何将字段作为记录添加到数据库的评论，您可以执行以下操作（这是在 C# 中）

首先，设置将连接字符串添加到 web.config 中的 connectionstrings 部分。如果您要在整个应用程序中使用相同的数据源，通常在此处设置它们是一种很好的做法，因为它使您不必每次都写出连接字符串

```
<connectionStrings> 
<add name="myConnectionString" connectionString="Provider=Microsoft.Jet.OLEDB.4.0;Data Source=|DataDirectory|db1.mdb"
providerName="System.Data.OleDb" />
</connectionStrings> 
```

然后在您页面的代码隐藏中

```
 protected void AddButton_Click(object sender, EventArgs e)
    {
        AddRecordToDatabase(txtCustomerName.Text, txtPlaceOfBirth.Text); 

        /*
          Where txtCustomerName and txtPlaceOfBirth are the IDs 
          of your Name and Place Of Birth textboxes, respectively.
          You may want to perform some validation on the textboxes before
          performing the insert!
        */
    }

    private void AddRecordToDatabase(string customerName, string placeOfBirth)
    {
        OleDbConnection conn;
        OleDbCommand cmd;

        using (conn = new OleDbConnection(ConfigurationManager.ConnectionStrings["myConnectionString"].ConnectionString))
        {
            using (cmd = conn.CreateCommand())
            {
                cmd.CommandText = "INSERT INTO Customers(Name, PlaceOfBirth) VALUES (@name, @place_of_birth)";
                cmd.CommandType = CommandType.Text;

                cmd.Parameters.AddWithValue("@name", customerName);
                cmd.Parameters.AddWithValue("@place_of_birth", placeOfBirth);

                conn.Open();
                cmd.ExecuteNonQuery();
            }
        }
    } 
```

using 语句将在完成后处理对象（它们本质上是 Try-Finally 块）。

根据Access的版本，可能有可能在插入后返回一个值来表示插入是否成功（我只熟悉Access 97 - 2003）。如果可能，您可能希望使用 ExecuteScalar 而不是 ExecuteNonQuery 来获取返回值并做出相应的响应。

作为一个非常普遍的建议，我不推荐 Jet（Access 使用的数据库引擎）作为 ASP.NET 网站的后端数据库——请查看[这个问题的答案以](https://stackoverflow.com/questions/459442/insert-from-asp-net-to-ms-access)了解原因。SQL Server 2005 Express 可免费使用*，是 Web 开发的绝佳数据库选择。

*有一些限制，请查看[微软网站](http://www.microsoft.com/Sqlserver/2005/en/us/express.aspx)了解详情。

# asp.net - 从 ASP.NET 中的另一个线程填充下拉列表

> ID：575828
> 
> 赞同：0
> 
> 时间：2009-02-22T21:24:27.737
> 
> 标签：asp.net, vb.net, multithreading, asp.net-ajax, drop-down-menu

我在一个页面上有多个下拉列表。它们都包含国家/地区列表。所以在后台我从数据库中获取国家并缓存它们。我想从另一个线程填充这些下拉列表。我也在使用 AJAX 控件，所以我希望这一切都同时发生。而且在用户选择一个国家之后，我希望该国家的城镇向用户显示，并且我希望获得城镇也发生在另一个线程中，以便用户可以在列表尚未加载时填充其他控件。
我在某处读过我应该将 Page 作为该线程的参数，然后找到该下拉列表并填充它们。但这行不通。

这是另一个线程启动时调用的函数：

```
protected void GetCountries(object o)
{
    if (Session["Countries"] == null)
    {
        Session["Countries"] = CountryRepository.Instance.GetAll();
    }
    if (o is Page)
    {
        Page p = (Page)o;
        DropDownList ddl = (DropDownList)p.FindControl("ddlCountry");
        ddl.DataSource = Session["Countries"] as List<Country>;
        ddl.DataTextField = "Name";
        ddl.DataValueField = "Id";
        ddl.DataBind();
    }
} 
```

有人看到可能的问题吗？或者也许我的整个概念是错误的？有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T21:31:53.100

查看[ASP.NET AJAX Control Toolkit 中的 CascadingDropDown Extender](http://www.asp.net/ajax/ajaxcontroltoolkit/samples/CascadingDropDown/CascadingDropDown.aspx)。它使用 Web 服务来填充下拉列表，因此它可以异步操作（我相信这就是您所追求的）。

# mysql - 数据库设计问题 - 不同类别的多个分数

> ID：575834
> 
> 赞同：1
> 
> 时间：2009-02-22T21:26:05.720
> 
> 标签：mysql, database-design, rdbms

假设我有一个服装产品数据库。除了许多其他字段外，数据库还需要存储每个产品的不同类别的评分（满分 10 分）。

例如，一个类别可以是“场合”。场合可能如下：

穿去办公室 穿去参加婚礼 穿去约会... 穿去参加葬礼

每个产品都需要为每个产品分配 10 分。因此，一种产品可能具有：

办公室：5 婚礼：7 日期：10 葬礼：0

这表明该项目是令人愉快的，不是太低调，也不是太正式。

有许多这样的类别，这些类别将用作搜索算法的一部分，因此速度可能是一个问题。我也不希望我的产品表变得很大。这意味着我对将其存储在产品表中感到不安，因为每个响应都有自己的列。

可能以这种方式存储，除非在具有连接的不同表中？只是在寻找一个相当灵活和优雅的解决方案。

如果我不清楚，请告诉我。

PS我正在使用MySQL，如果这有所作为......

编辑：我不认为有一个类别表和一个带有 product_id、category_id 和 score 的连接表会很好用。您要么必须将连接中的每个分数列（例如，wedding_score 等）命名为别名，要么返回多个分数列（每个类别一个）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T21:28:40.130

你在正确的轨道上。有一个“类别”表，中间表有两列，一个是产品的PK，另一个是产品的PK；加上三分之一的分数。很标准的图案。然后通常中间表将有一个复合 PK（例如 productid + categoryid）和 categoryid 上的另一个非唯一索引。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T23:52:08.663

> 编辑：我不认为有一个类别表和一个带有 product_id、category_id 和 score 的连接表会很好用。您要么必须将连接中的每个分数列（例如，wedding_score 等）命名为别名，要么返回多个分数列（每个类别一个）。

我认为这是要走的路，因为它可以让您以相同的方式对待不同的分数。当分数类型被添加、重命名、删除等时，您的大部分代码都不需要调整。

如果您担心用于聚合此信息的复杂连接，也许一两个视图会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T23:39:57.177

好吧，关系数据库针对存储关系进行了优化，因此一个用于存储项目描述的表、另一个用于评分类别（包括分数描述）和一个连接表（项目到评分）似乎是完美的答案。

有什么缺点？那么，每个项目都会有几个分数记录，这是真的。在查询浏览器中也不会那么可读。但是使用正确的键和索引，它会足够快地使用你需要的方式。

# css - 哪个 CSS 选择器应该设置 background-image 属性？

> ID：575854
> 
> 赞同：0
> 
> 时间：2009-02-22T21:36:57.940
> 
> 标签：css, css-selectors

为了获得整个页面的整体背景图像，我应该为 、 或两者都设置背景`html`图像`body`？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-22T21:37:55.333

`body`. 它可以在所有浏览器中正常工作。

# database - 直接从表中选择和查看之间的区别

> ID：575858
> 
> 赞同：6
> 
> 时间：2009-02-22T21:37:27.520
> 
> 标签：database, select

直接从表中选择数据或从视图中选择数据有什么区别？
每个人的最佳用途是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-22T22:06:50.117

根据微软的说法，如果您在 sql server 2000/2005/2008 中使用**索引视图，则会有性能优势。**

索引视图可以通过以下方式提高查询性能
1\. 可以预先计算聚合并将其存储在索引中，以最大限度地减少查询执行期间的昂贵计算。
2\. 可以预先加入表并存储结果数据集。
3.可以存储连接或聚合的组合

但就像表上的索引一样，视图上的索引也会有修改开销。因此，仅当运行时速度增加的好处超过更新视图索引所需的时间时，才向视图添加索引。

以下链接提供了有关此的更多信息（关于何时使用什么）。

1.  [SQL Server 2000/2005 索引视图性能调优和优化技巧](http://www.sql-server-performance.com/tips/indexed_views_p1.aspx)。

2.  [使用 SQL Server 2000 索引视图提高性能](http://technet.microsoft.com/en-us/library/cc917717.aspx)。

3.  [通过在 SQL 中使用索引视图来查看性能提升](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-6160148.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T21:40:38.167

在大多数数据库中，它们在功能上是可互换的（忽略物化视图，无论如何它们是完全不同的东西。）创建视图有两个常见的原因。1\. 一种抽象（和列别名）机制，以及 2\. 用于权限和访问控制。但至于效率，这不是问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T21:43:01.843

这取决于数据库和视图的定义。

为列设置别名或执行简单计算的简单视图与直接进行查询没有什么不同。

但是，在某些情况下，视图可能会慢得多。一个例子：在Oracle 中，如果你嵌套视图查询太多（例如，一个视图使用另一个作为表，它使用另一个，等等），你可以创造糟糕的性能。

一般来说，您需要使用有问题的特定数据库和查询进行测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T21:42:16.417

这样想：

视图只是存在于服务器上并由 SQL 引擎编译的选择语句。

通常视图用于限制/简化表中的结果。

问候 K

# ruby-on-rails - RJS：在 select_tag 上使用 observe_field

> ID：575862
> 
> 赞同：2
> 
> 时间：2009-02-22T21:38:22.773
> 
> 标签：ruby-on-rails, rjs

只要用户更改下拉菜单中的值并点击“开始”按钮，我的应用程序中的下拉菜单（由 select_tag 构建）应该调用过滤器类别操作。

现在，我想摆脱“开始”按钮并让观察者（observe_field？）在用户更改下拉菜单中的值后立即调用过滤器类别操作。

下面你会看到我写的代码。它可以使用“Go”按钮工作，但不能仅通过更改下拉菜单中的值来工作。我的 observe_category_select-helper 有什么问题？

**带有下拉菜单和项目列表的视图部分**

```
 <!-- drop down menu -->
    <% form_tag(filter_category_path(:id), :method => :post, :class => 'categories') do %>
       <label>Categories</label>
       <%= select_tag(:category, options_for_select(Category.all.map {|category| [category.name, category.id]}, @category_id)) %>
       <!-- i would like to get rid of this button -->
       <%= submit_tag "Go" %>
     <% end %>

   <!-- list of projects related to categories chosen in drop down menu -->
   <ul class="projects">
     <% @projects.each do |_project| %>
       <li>
         <%= link_to(_project.name, _project) %>
       </li>
     <% end %>
   </ul>

   <%= observe_category_select -%> 
```

**辅助方法**

```
 def observe_category_select
    observe_field(
                  :category,
                  :url        =>  filter_category_path(:id),
                  :with       =>  'category',
                  :on         =>  'change'
    )
  end 
```

**HelperMethod 的 Javascript 输出**

```
<script type="text/javascript">
//<![CDATA[
   new Form.Element.EventObserver('category', function(element, value) {
     new Ajax.Request('/categories/id/filter', {asynchronous:true, evalScripts:true, parameters:'category=' + encodeURIComponent(value) + '&authenticity_token=' + encodeURIComponent('edc8b20b701f72285068290779f7ed17cfc1cf8c')})
   }, 'change')
//]]>
</script> 
```

**类别控制器**

```
class CategoriesController < ApplicationController
  def show
    @category = Category.find(params[:id])
    @category_id = @category.id
    @projects = @category.projects.find(:all)

    respond_to do |format|
      format.html # index.html.erb
    end
  end

  def index
    @projects = Category.find(params[:id]).projects.find(:all)

    respond_to do |format|
      format.html # index.html.erb
    end
  end

  def filter
    @category = Category.find(params[:category])
    @category_id = @category.id
    @projects = @category.projects.find(:all)

    respond_to do |format|
      format.html # index.html.erb
    end    
  end 
```

结尾

**'rake routes | 的输出 grep 过滤器'**

```
 filter_category POST   /categories/:id/filter                   {:controller=>"categories", :action=>"filter"}
   formatted_filter_category POST   /categories/:id/filter.:format           {:controller=>"categories", :action=>"filter"} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-22T23:31:26.230

您的过滤器控制器操作需要响应 Javascript 而不仅仅是普通的 HTTP 请求。

```
def filter
  @category = Category.find(params[:category])
  @category_id = @category.id
  @projects = @category.projects.find(:all)

  respond_to do |format|
    format.js # filter.rjs
  end    
end 
```

或者，如果您希望该操作在任一上下文中响应，请将两者都放在块中：

```
respond_to do |format|
  format.html # filter.html.erb
  format.js # filter.rjs
end 
```

这要求您有一个看起来像这样的视图文件 filter.rjs：

```
page.replace_html :id_of_element_to_replace_html, :partial => "name_of_partial" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T21:45:43.130

我的第一个想法是这可能是一些范围问题。我假设 filter_category_path 是您的路由路径助手之一 - id 或类别值（在：with 中）可能不在助手方法的范围内。

当您查看页面时，您是否可以看到调用**observe_field**输出的 JavaScript ？

使用 Firebug，您能看到正在发出的任何 Ajax 请求吗？

您的 development.log 中是否出现任何内容？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T22:27:01.090

```
 def observe_category_select
    observe_field(
                  :category,
                  :url        =>  filter_category_path(:id),
                  :with       =>  :category_id,
                  :on         =>  :onchange,
                  :update     =>  :projects
    )
  end 
```

:onchange 是问题所在 - 我花了很长时间才整理出来。编辑：看起来你解决了这个问题。

如果要重置下拉列表和项目显示状态，请在呈现的部分中包含这样的函数：

```
<%= link_to_function "close category", :title => 'close category' do |page| 
        page.select("#category").each do |element|
            element.value = "Choose Category"
            page << "window.fireEvent($(\"category\"), 'change');"
        end
        page.replace_html :projects, "<li></li>" 
    end-%> 
```

这会将选择列表设置为默认值，并删除与最后显示的类别相关的所有列表项，并使 ul 准备好从默认值显示新的 li。如果您选择刚刚隐藏的相同类别，则必须调用 fireEvent 否则观察者将无法工作。

由于观察者被触发，控制器动作必须处理它：

```
 def filter
  begin        
    @category = Category.find(params[:category])
    @category_id = @category.id
    @projects = @category.projects.find(:all)
  rescue
    @category = "choose"
  end
  render :layout => false
 end 
```

如果没有找到类别，则将 @category 设置为字符串并在部分视图中进行测试

```
<% if @category.eql?('choose') %>
  <li>choose category</li>
<% else %>
 # loop through projects returning them wrapped in li tags
<% end %> 
```

不漂亮，但它有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T09:19:22.230

我在实际项目中遇到了同样的问题。我用 select 标签中的 onchange 属性解决了这个问题：

```
<%= select_tag @procuct, 
        options_for_select(
            @product.properties.map {|property| [property.name, property.id]}),
        :onchange => "HERE_A_CALL_TO_YOUR_JS_FUNCTION();" %> 
```

更新：我将 Ajax 调用放在 JS 函数中，而不是您可以将所有内容放在 onchange 语句中，我认为您也可以将“本机 Rails”JS 方法放在那里。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-06T22:32:34.657

FWIW - 我对 Rails 还是很陌生，我偶然发现新的自定义操作需要在您的 routes.rb 文件中定义（事后看来有点明显，但我以前从未这样做过）。

如果您使用的是宁静的路线，那么只需将 :collection => {:filter => :get} 添加到资源路线行的末尾（例如 map.resource :categories, :collection => {:filter => ：得到}）。

希望能帮助别人。

# user-interface - 很棒的首次运行体验

> ID：575865
> 
> 赞同：5
> 
> 时间：2009-02-22T21:39:52.490
> 
> 标签：user-interface, interaction

有没有人有很好的软件示例，具有出色的首次运行体验？有些软件显然只是“开箱即用”。但是，有一些重要的软件需要一些配置才能使用。

任何例子将不胜感激。

干杯，易

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-22T22:14:45.057

第一次尝试 Opera 给我留下了深刻的印象；一周内我从 Firefox 切换。它带有许多功能，例如 IRC 和 Bittorrent 客户端，这对我在学校很重要，那里的磁盘空间配额为 50 兆！Opera 的大部分功能最终都可以作为插件使用/复制到 Firefox，但我仍然更喜欢在家使用 Opera，因为文本看起来更好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T22:18:30.617

Mac OS X 10.5 的时间机器。如果您有 Time Capsule，您只需轻按控制面板中的开关即可将其打开。当您需要备份文件时，您可以直观地回到您知道它存在的时间点。您可以像过去一样浏览您的硬盘驱动器（或仅在该时间点备份的目录）以检索它，当您这样做时，您可以看到它被复制到当前时间。噱头，但现在我喜欢删除文件，以便以后可以恢复它们。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-22T22:56:55.660

[Basecamp](http://www.basecamphq.com/)拥有令人难以置信的开箱即用体验。这是因为让事情变得非常简单，拥有一个托管的解决方案（无需安装/设置），以及解释如何开始的简短但引人注目的欢迎消息。

[TripIt](http://www.tripit.com/)、[FogBugz](http://www.fogcreek.com/FogBugz/)和[BlinkSale](http://www.blinksale.com/home)等其他一些第一次工作并在您开始使用时就完美工作的例子。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-22T23:03:59.557

iPhone怎么样？几乎所有 Apple 产品都附带最少的手册。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-22T22:06:49.820

谷歌的大多数东西在这方面都很好。Firefox 没问题，OpenOffice 也一样（虽然有点慢，但可以调整）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-22T22:25:13.287

我认为不可能绝对地回答这个问题。什么是出色的“开箱即用”/“首次运行”体验取决于运行它的人的期望。如果产品达到或特别超出预期，那将是一次很棒的体验。

这是一个简单的例子。我认为 Google Chrome 浏览器是一个很好的首次运行体验，因为它简单、安装良好且速度超快。对于其他一些人（尤其是许多阅读 stackoverflow.com 的人），这可能是有缺陷的，因为他们的期望是 Chrome 也可以无缝导入他们的 Firefox 或任何其他插件，这不是 Chrome 原始功能的一部分。所以对他们来说，这不会是一次很棒的经历，因为他们期待着一些不存在的东西。

Apple、iPod 和 iTunes 是其他经典例子。许多人（包括我自己）认为从 iTunes 查找和购买音乐是一种非常简单的体验。许多其他人觉得它令人震惊，因为直到最近，音乐还不是（并且其中一些仍然不是）无 DRM 的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-22T23:02:12.883

OS X，并行

Windows 7，Vista（我怀疑有点争议）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-22T23:00:09.443

我会说[Ubuntu](http://www.ubuntu.com/)具有良好的 OOB 体验。安装和运行非常简单。我从来没有为 Live CD 烦恼过，但我听说这也很棒，而且它让您无需实际安装即可试用 Ubuntu，这真是太棒了。

# php - 反序列化问题

> ID：575868
> 
> 赞同：-1
> 
> 时间：2009-02-22T21:40:53.487
> 
> 标签：php, mysql, serialization

我的 scripy 有另一个问题，现在我已经让它更先进了，首先计数功能不能正常工作，它给出了这个错误。

*警告：array_push() [function.array-push]：第一个参数应该是第 42 行 C:\wamp\www\social\add.php 中的一个数组*

这是我的脚本：

```
$query = mysql_query("SELECT friends FROM users WHERE id='$myid'");
$friends = mysql_fetch_array($query);
$friends2 = unserialize($friends['friends']);

if (count($friends2) == 0) {

//option 1
$friends2 = array($id);
$friendsUpdated = serialize($friends2);
mysql_query("UPDATE users SET friends='$friendsUpdated' WHERE id='$myid'");

}else{

//option 2
array_push($friends2, $id);
$friendsUpdated = serialize($friends2);
mysql_query("UPDATE users SET friends='$friendsUpdated' WHERE id='$myid'"); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T21:59:01.600

似乎这`$friends2`不是一个数组。使用该`var_dump($friends2)`函数查看其值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T22:02:28.973

这听起来可能没什么帮助，但是您的数据库设计*很奇怪*。

为什么 $friends2 不是数组？在获取数组后尝试 print_r () $friends 看看你是否真的从数据库中得到了你想要的东西。

此外，您的计数检查是多余的。要添加到数组中，只需执行 $friens2[] = $id; 如果 $friends2 为空，它只会创建一个包含 1 个元素 ($id) 的新数组，否则它将添加它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T22:02:51.170

您的问题包含答案：*unserialize($friends['friends'])*似乎返回非数组并且 count($friends2) 不为零 - 例如，如果 number 通过了，就会发生这种情况。您是否尝试过检查 $friends['friends'] 数据？最简单的方法是进行额外检查*is_array($friends2)*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T22:06:37.230

如果您在创建数据库之后但在将任何数据放入其中之前立即运行此代码，“unserialize($friends['friends']);” 返回数组以外的东西。可能是一个空字符串。因此，在选项 2 中，您可能希望在 array_push 之前执行以下操作：

```
if (!is_array($friends2)) {
  $friends2 = array();
} 
```

这样，如果这个人此时还没有朋友（很遗憾......但你可以通过向他们推送一个新朋友来解决它），一个空的朋友列表被初始化。

另外，任何时候你在“if”条件的不同部分看到两行相同的代码......

```
$friendsUpdated = serialize($friends2);
mysql_query("UPDATE users SET friends='$friendsUpdated' WHERE id='$myid'"); 
```

这是一个信号，表明您应该重组代码，以便您只有这些行的一份副本。

# .net - major.minor.build.revision 版本风格与 year.month.day.whatever 版本风格

> ID：575881
> 
> 赞同：14
> 
> 时间：2009-02-22T21:46:52.410
> 
> 标签：.net, deployment, assemblies, version

是否有任何理由对 .NET 程序集使用一种版本控制风格而不是另一种？？？？

我想知道除了口味之外，使用这两种风格是否有任何优点/缺点。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-22T21:48:17.790

时间的优势是您可以获得不断增加的版本号*并*编码时间戳。

使用更传统的数字的好处是人们更容易理解。例如，我们都大致知道“v2.1”是什么意思。

一般来说，我建议使用时间，因为添加的信息很有用。其他数字的优势仅用于营销，为此您无论如何都可以这样做。

例如，为什么不同时拥有两者，比如“v2.1.20090214”。现在您在major.minor 部分中有营销，在“构建”部分中有实用程序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-09-01T04:52:13.870

使用major.minor.revision 方案的优点是语义。有一种方法可以更新这些数字中的每一个：

主要编号更改意味着新版本与旧版本不兼容，任何依赖先前版本的人都需要更改代码才能升级到新包。

较小的数字更改意味着新版本向后兼容之前的版本，但比之前的版本有显着的增强。

每当将错误修复应用于构建时，都会更新修订号，这样它不会带来兼容性更改或引入更新的功能。

在指定依赖项时，您可以因此说您依赖于 foo-1.0.0 - foo-1.99.999，并请放心，您最终不会因为包升级而破坏您的应用程序。

如果您从较高的次要版本的依赖项开始，例如 foo-1.4.22，则应将依赖项指定为 foo-1.4.22 - foo-1.99.999，这样您就不会最终安装较旧的版本比 1.4.x，它可能缺少一些功能/增强功能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-22T21:53:23.033

我只是将 AssemblyVersion 保留在“1.0.*”并删除任何 AssemblyFileVersion。

然后，我可以酌情增加主要和次要版本号，并自动设置默认的 DateTime 基础构建和修订。

除非您有根据其他方案控制构建和修订号的替代构建工具，否则我认为手动设置它们没有真正的优势。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T07:15:00.907

使用时间/日期还有一个缺点（除了这里其他答案中已经提到的）缺点：

如果您的开发团队分布在不同的时区，您将永远无法确定相隔一小时构建的两个版本中的哪一个是较新的版本。除非您还对时区进行版本化或强制日期/时间使用例如 GMT。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T22:34:53.840

我使用一些基于 SVN 版本更新我的版本的构建脚本。这使得将 dll 跟踪回创建它的源代码变得微不足道。

时间比较棘手；您必须开始查看历史记录窗格——因为大多数源代码控制工具都有“获取修订”功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T22:40:52.360

为什么选择？您可以使用 Major.Minor.YYMMDD.Revision 之类的格式，并获得两全其美的效果。

**编辑** 正如评论中指出的那样，有时每个字段的范围都受到限制。在这种情况下，您可以使用 Major.Minor.YMMDD.Revision。

希望您至少每 10 年更改一次次要版本！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-22T22:53:55.150

基于日期的版本编号的一个缺点是对旧软件的负面*看法*。

虽然，我还是使用它，因为它非常适合我的项目。

# c# - 为什么我的 C# 客户端发布到我的 WCF REST 服务时返回 (400) 错误请求？

> ID：575893
> 
> 赞同：18
> 
> 时间：2009-02-22T21:54:47.650
> 
> 标签：c#, wcf, rest, post

我正在尝试向我编写的简单 WCF 服务发送 POST 请求，但我不断收到 400 Bad Request。我正在尝试将 JSON 数据发送到服务。谁能发现我做错了什么？:-)

这是我的服务接口：

```
public interface Itestservice
{
    [OperationContract]
    [WebInvoke(
        Method = "POST",
        UriTemplate = "/create",
        RequestFormat = WebMessageFormat.Json,
        ResponseFormat = WebMessageFormat.Json)]
    String Create(TestData testData);
} 
```

实施：

```
public class testservice: Itestservice
{
    public String Create(TestData testData)
    {
        return "Hello, your test data is " + testData.SomeData;
    }
} 
```

数据合约：

```
[DataContract]
public class TestData
{
    [DataMember]
    public String SomeData { get; set; }
} 
```

最后是我的客户代码：

```
private static void TestCreatePost()
{
    Console.WriteLine("testservice.svc/create POST:");
    Console.WriteLine("-----------------------");

    Uri address = new Uri("http://localhost:" + PORT + "/testweb/testservice.svc/create");

    // Create the web request  
    HttpWebRequest request = WebRequest.Create(address) as HttpWebRequest;

    // Set type to POST  
    request.Method = "POST";
    request.ContentType = "application/x-www-form-urlencoded";
    //request.ContentType = "text/x-json";

    // Create the data we want to send  
    string data = "{\"SomeData\":\"someTestData\"}";

    // Create a byte array of the data we want to send  
    byte[] byteData = UTF8Encoding.UTF8.GetBytes(data);

    // Set the content length in the request headers  
    request.ContentLength = byteData.Length;

    // Write data  
    using (Stream postStream = request.GetRequestStream())
    {
        postStream.Write(byteData, 0, byteData.Length);
    }

    // Get response  
    using (HttpWebResponse response = request.GetResponse() as HttpWebResponse)
    {
        // Get the response stream  
        StreamReader reader = new StreamReader(response.GetResponseStream());

        // Console application output  
        Console.WriteLine(reader.ReadToEnd());
    }

    Console.WriteLine();
    Console.WriteLine();
} 
```

谁能想到我可能做错了什么？正如您在 C# 客户端中看到的那样，我已经为 ContentType 尝试了 application/x-www-form-urlencoded 和 text/x-json，认为这可能与它有关，但似乎没有。我已经尝试过相同服务的 GET 版本，它工作正常，并且返回一个 JSON 版本的 TestData 没有问题。但是对于 POST，好吧，我现在很困惑:-(

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-22T22:00:59.770

您是否尝试过“application/json”而不是“text/x-json”。根据[这个](https://stackoverflow.com/questions/477816/the-right-json-content-type)Stack Overflow 问题 application/json 是唯一有效的 json 媒体类型。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T22:40:22.267

这里唯一的问题是 ContentType。

试试（推荐）

```
request.ContentType = "application/json; charset=utf-8"; 
```

或（这也可以）

```
request.ContentType = "text/json; charset=utf-8"; 
```

以上两个都解决了问题。但是，建议使用第一个，有关 JSON-RPC 1.1 规范的详细信息，请查看[http://json-rpc.org](http://json-rpc.org/wd/JSON-RPC-1-1-WD-20060807.html#ResponseHeaders)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T21:58:44.643

尝试：

```
[OperationContract]
[WebInvoke(
  Method = "POST",
  UriTemplate = "/create",
  RequestFormat = WebMessageFormat.Json,
  ResponseFormat = WebMessageFormat.Json,
  /* non-wrapped */ BodyStyle = WebMessageBodyStyle.Bare )]
String Create(TestData testData); 
```

# c# - 为什么结构不能有无参数构造函数

> ID：575901
> 
> 赞同：15
> 
> 时间：2009-02-22T21:59:43.923
> 
> 标签：c#

为什么结构不能有无参数构造函数？为 CLR 执行此操作有什么问题，或者为什么不允许这样做？请解释一下，因为我不明白。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-22T22:02:27.287

我不能有一个显式的无参数构造函数，只有隐式的构造函数，它将所有成员初始化为其默认值。

> 尽管 CLR 允许，但 C# 不允许结构具有默认的无参数构造函数。原因是，对于值类型，默认情况下编译器既不会生成默认构造函数，也不会生成对默认构造函数的调用。所以，即使你碰巧定义了一个默认构造函数，它也不会被调用，这只会让你感到困惑。为避免此类问题，C# 编译器不允许用户定义默认构造函数。而且因为它不生成默认构造函数，所以在定义字段时不能初始化它们，...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T22:03:33.790

可以在以下位置找到相当合理的解释：http://en.csharp-online.net/CSharp_FAQ: [_Why_must_struct_constructors_have_at_least_one_argument](http://en.csharp-online.net/CSharp_FAQ:_Why_must_struct_constructors_have_at_least_one_argument)

引用： *“.NET 公共语言运行时 (CLR) 不保证将调用无参数构造函数。如果允许结构具有默认的无参数构造函数，则意味着将始终调用默认构造函数。然而，CLR 使没有这样的保证。”*

# jackrabbit - 为什么在jackrabbit中从查询中跳过节点非常慢？

> ID：575902
> 
> 赞同：1
> 
> 时间：2009-02-22T21:59:50.443
> 
> 标签：jackrabbit

当我执行这样的简单查询时：

```
select * from nodeType 
```

调用`skip(N)`范围迭代器很慢。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T22:00:36.403

找出原因（自我回答） - 默认情况下使用文档顺序。

尝试在查询中添加一个合理的“order by”——从 10000 个节点的分钟到 < 1 秒。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-09T15:02:24.603

可悲的是，Jackrabbit 实现中的 RangeIterator skip() 方法（RangeIterator 只是一个接口）正在线性遍历节点。你不妨写

```
int counter = 0;
while ( counter < offset && iter.hasNext() ) { iter.next(); counter++; } 
```

# objective-c - 将两个不同的模型键路径绑定到同一个 NSArrayController 选择

> ID：575904
> 
> 赞同：1
> 
> 时间：2009-02-22T22:00:47.963
> 
> 标签：objective-c, cocoa, interface-builder, nsdictionary, cocoa-bindings

假设我有以下字典数组：

```
{
    {
        isoName => en,
        fullName => English,
        localName => English
    },
    {
        isoName => de,
        fullName => German,
        localName => Deutsch
    },
    {
        isoName => fr,
        fullName => French,
        localName => français
    }
} 
```

如何将`fullName`值绑定到 NSPopUpButton 控件的值，但将选择绑定`isoName`到 NSUserDefaults？我有一个使用上述数组设置的 NSArrayController，并且我的 NSPopUpButton 绑定到此控制器，模型键路径为“fullName”，但我想将其保留`isoName`在 NSUserDefaults 中。这可能吗？有没有更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T23:35:58.123

首先，创建一个表示语言的模型对象类，并使模型对象的这些字典对属性。根据我的经验，字典不能很好地与 Bindings 配合使用；绑定系统需要真实的模型对象。

接下来，创建一个控制器对象来保存这些模型对象。我将其称为 LanguageKeeper。它具有三个属性：

*   `languages`（语言对象的 NSArray）
*   `selectedLanguage`
*   `selectedLanguageISOName`

将最后一个公开为绑定。另外，使最后两个属性之一成为另一个的导数。我将创建 ISOName 属性派生：getter 将 return `self.selectedLanguage.ISOName`，而 setter 将对给定的 ISO 名称执行查找并设置`self.selectedLanguage`为该语言对象。确保实现`keyPathsForValuesAffectingSelectedLanguage`and `keyPathsForValuesAffectingSelectedLanguageISOName`，并在每个方法返回的集合中包含其他属性的名称。

首先，将 NSArrayController 的内容数组绑定绑定到`languages`LanguageKeeper 的属性。

然后，在弹出按钮上绑定三个属性：

*   content 到 NSArrayController 的`arrangedObjects`属性，将模型键路径留空（`self`如果这会导致问题，则将其设置为）
*   相同`arrangedObjects`属性的内容值，模型键路径为“<code>fullName”</li>
*   选择对象到`selectedLanguage`LanguageKeeper 的属性

最后，将`selectedLanguageISOName`LanguageKeeper 绑定到 User Defaults Controller 的相应属性。（您不能将弹出按钮直接绑定到 UDC，因为弹出按钮需要您的模型对象之一。）

您还可以尝试将弹出按钮的内容绑定绑定到数组中字典的`isoName`s 和内容值绑定`fullName`，但是我非常不信任将原始对象用作模型对象。过去我有太多的问题。此外，从长远来看，使用模型对象是有回报的，而且使用起来非常有趣。

因此，在完成上述所有操作后，会发生以下情况：

用户更改弹出按钮中的值

1.  弹出按钮更改其 selected-object 属性的值。
2.  这会改变`selectedLanguage`LanguageKeeper 的属性。
3.  这会改变 LanguageKeeper 的另一个属性 ( `selectedLanguageISOName`)。
4.  这会通过 UDC 更改用户默认值。

其他一些对象更改了用户默认值

1.  UDC 发布有关值已更改的通知。
2.  这会改变`selectedLanguageISOName`LanguageKeeper 的属性。
3.  这会改变 LanguageKeeper 的另一个属性 ( `selectedLanguage`)。
4.  这会改变弹出按钮的 selected-object 属性的值。
5.  用户`fullName`在弹出菜单中看到新的选择。

如果您不理解此答案的任何部分，请要求澄清。

# .net-3.5 - 在将程序集集成到 MSI 之前对其进行混淆

> ID：575912
> 
> 赞同：9
> 
> 时间：2009-02-22T22:03:31.810
> 
> 标签：.net-3.5, installation, windows-installer, obfuscation

我有一个包含安装项目的 VS.NET 2008 解决方案。此安装项目获取我的其他项目（在同一解决方案中）的输出并生成 MSI。到目前为止，一切都很好......我希望 MSI 中包含的程序集被混淆。这种混淆本身很简单，但是**如何将这个前置步骤（混淆）引入 MSI 构建**？有人有想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T17:59:29.010

如果您使用的是 Dotfuscator Professional，则可以轻松实现此目的，因为它附带了一个 Visual Studio 项目，该项目在安装时添加到您的系统中。

您需要做的就是将一个新的 Dotfuscator 项目添加到您的解决方案中，将其他项目的输出添加为 Dotfuscator 项目的输入（使用添加程序集/添加项目输出功能），设置任何必要的混淆设置，然后更改设置项目的输入为 Dotfuscator 项目。当您现在构建您的解决方案时，您的代码文件被编译，然后被混淆，然后移交给安装项目以构建到 MSI 中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T22:25:01.133

使用诸如[Finalbuilder 之](http://www.finalbuilder.com/)类的构建工具来自动执行此过程。

例如，构建程序集，然后对其进行混淆，最后构建安装项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-01T10:06:16.397

混淆器需要支持 MSBuild 集成才能工作，以便编译器的构建输出可以被混淆并作为输入传递给 MSI 项目。

[Crypto Obfuscator](http://www.ssware.com/cryptoobfuscator/obfuscator-net.htm)就是一种支持这种场景的工具。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-03-08T17:00:07.410

[Eazfuscator.NET](https://www.gapotchenko.com/eazfuscator.net "Eazfuscator.NET") was designed specifically to handle such scenario. To obfuscate your assemblies before they go to MSI, just do the following:

1.  Drop your assembly project(s) in the green zone of Eazfuscator.NET Assistant [![Drag and drop the project from Visual Studio to Eazfuscator.NET Assistant](https://i.stack.imgur.com/8T85z.png)](https://i.stack.imgur.com/8T85z.png)
2.  You are done. The assemblies are now automatically obfuscated and bundled into your MSI package every time the solution is built in `Release` configuration.

Some other obfuscators handle this too. For example, [Dotfuscator](https://www.preemptive.com/products/dotfuscator/overview) provides the obfuscation project type for Visual Studio where you can define inputs and outputs and thus form a build pipeline. The pipeline can get the output of an assembly project, obfuscate it and then pass it to the setup project.

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-23T00:26:16.693

我会考虑使用 WiX 或类似的东西（一些其他构建工具）来创建 MSI 文件。可以使用windows工具反编译MSI，然后混淆，放回MSI中。

另一种选择是在构建过程中添加混淆工具。我已经用 CodeVeil 完成了这篇文章的构建。如果您可以将其分支到所有项目的 Post Build 步骤中，无需设置项目（最后构建），您应该能够做到这一点。由于没有大量使用设置项目，我不确定这是否会起作用，但我看不出它不应该起作用的理由。

# c - glibc 附带的 C 是否有自动调整大小的数组/动态数组实现？

> ID：575914
> 
> 赞同：15
> 
> 时间：2009-02-22T22:04:03.057
> 
> 标签：c, data-structures, glibc

glibc 或任何 C 的标准 Linux 库中是否有[动态数组实现？](http://en.wikipedia.org/wiki/Array_list)我希望能够添加到列表中而不用担心它的大小。我知道 C++ 存在 std::vector，但我需要 C 等价物。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-22T22:07:47.790

我猜你正在考虑[realloc](http://opengroup.org/onlinepubs/007908775/xsh/realloc.html)。但最好将*列表*包装在结构中以跟踪其当前长度

示例 API

```
struct s_dynamic_array {
    int allocated;   /* keep track of allocated size  */
    int usedLength;  /* keep track of usage           */
    int *array;      /* dynamicaly grown with realloc */
};
typedef struct s_dynamic_array s_dynamic_array;

s_dynamic_array *new_dynamic_array(int initalSize);
void             free_dynamic_array(s_dynamic_array *array);
int              size_of_dynamic_array(s_dynamic_array *array);
s_dynamic_array *add_int_to_dynamic_array(s_dynamic_array *array, int value);
int              int_at_index(s_dynamic_array *array, int index); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T22:33:43.390

glib中有一个动态数组。（虽然不是 glibc）检查 GArray 和 GPtrArray。不过，动态数组与链表并不完全相同。

无论如何[，这](http://www.scribd.com/doc/3499572/Manage-C-Data-Using-the-GLib-Collections)是我在学习 glib 时能找到的最有用的资源。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T22:09:30.907

我总是为此使用[realloc](http://www.cplusplus.com/reference/clibrary/cstdlib/realloc.html)，您可以将自己的数组函数包装在它周围。AFAIK，没有其他内置的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T07:06:24.280

你也可以使用[obstacks](http://www.gnu.org/software/libc/manual/html_node/Obstacks.html#Obstacks)

# java - Ruby 模块是否等同于 Java 接口？

> ID：575920
> 
> 赞同：21
> 
> 时间：2009-02-22T22:07:27.197
> 
> 标签：java, ruby, interface, module

据我了解，接口是Java旨在通过为实现要填充的接口的类布置方法来强制设计。这也是Ruby模块的想法吗？我看到就像 Java 中的接口一样，您不能在 Ruby 中实例化模块。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-26T05:40:55.897

最简洁的答案是不。

原因如下，Java/C# 接口定义了实现类将至少提供的方法签名。

此外：

*   对于 ruby​​ 模块，由于鸭式打字，没有这样的合同。
*   模块只是一种提取通用功能以便于重用的方法。最接近的关系是 C# 扩展方法，但它们不是完全匹配的，因为它们存在于静态上下文中。
*   模块可以向现有类添加状态。
*   模块可以有静态方法
*   模块可以充当命名空间

例子：

```
module SimpleConversation
  class NamespacedExample
    def poke
      puts "ouch"
    end
  end

  attr_accessor :partner_name
  def converse
    partner_name ||= "Slowpoke"
    speak + "\n#{partner_name}: Yes they are"
  end

  def self.yay
    puts "yay"
  end
end

class Foo
  include SimpleConversation
  attr_accessor :name

  def speak
    name ||= "Speedy"
    "#{name}: tacos are yummy"
  end
end

x = Foo.new
x.name = "Joe"
x.partner_name = "Max"
puts x.speak
puts x.converse

y = SimpleConversation::NamespacedExample.new
y.poke

SimpleConversation.yay 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-22T22:13:10.287

我想我会将模块等同于更类似于 C# 中的扩展方法的东西。您正在向在其他地方实际定义的现有类添加功能。在 C# 或 Java 中都没有确切的类比，但我绝对不会将其视为接口，因为实现和接口一样是派生的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-26T05:22:49.217

ruby 中的模块是一个可以添加到其他东西的范围/命名空间。它们用于两个不同但相关的目的：捆绑一堆属于一起的相关事物（常量、类等），然后将它们添加到其他范围（如多重继承）。

例如，有一些称为 Comparable 和 Enumerable 之类的模块，它们封装了应用这些形容词时您期望的功能。通过提供基本定义（比较 Comparable 的两个实例和 Enumerable 的迭代器的方法），您可以导入模块并找到完整的接口。

另一方面，有像 Net 这样的模块，您很少将它们包含在一个类中，但它们提供了一系列功能，例如 Net::HTTP、Net::FTP、Net::SMTP 等。

中间有诸如数学和过程之类的东西，它们可能会以一种或另一种方式使用。

——马库斯

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-22T22:09:34.867

不，ruby 中的模块更类似于静态类。我不是Java 开发人员，但我*猜测*Java 接口类似于C# 接口，即它们定义了一个契约，而不是一个实现。

我不应该这样，虽然我有 ruby​​ 方面的经验，但它是在视频游戏创作 (RGSS/2) 方面。我确信我对资深 ruby​​ 程序员会知道的许多事情一无所知。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-06T14:13:11.957

从形式上看，Ruby 中的模块实现了称为“mixin”的设计模式。 [http://en.wikipedia.org/wiki/Mixin](http://en.wikipedia.org/wiki/Mixin)

它可以与 PHP 特征进行比较。 [http://php.net/manual/en/language.oop5.traits.php](http://php.net/manual/en/language.oop5.traits.php)

这种架构在不允许多重继承的语言中很有用，例如 Ruby、PHP。

# animation - 使用 GTK+ 制作流畅的动画

> ID：575924
> 
> 赞同：2
> 
> 时间：2009-02-22T22:08:35.697
> 
> 标签：animation, gtk, pygtk

我正在创建一个网络动画师（类似于 nam，如果您以前使用过它）。

基本上，我将节点表示为 GTK+ DrawingArea 上的小点，我更新这些节点的位置并在循环中重绘 DrawingArea。

生成的动画很快，但不流畅（有很多闪烁）。这可能是因为我在每一帧之前用纯色填充了 DrawingArea。

你认为我怎样才能最好地解决这个问题？我应该将帧预渲染到 Pixbuf 上吗？有更好的解决方案吗？

这是我当前的绘图代码（使用 PyGTK）：

```
rect  = self.drawing_area.get_allocation()
style = self.drawing_area.get_style()

pos   = [n.position_at(self.t) for n in self.nodes]

self.drawing_area.window.draw_rectangle(style.bg_gc[gtk.STATE_NORMAL], True,
                                        0, 0, rect.width, rect.height)

for p in pos:
    self.drawing_area.window.draw_arc(style.fg_gc[gtk.STATE_NORMAL], True,
                                      rect.width  * (p.x / 2400.0) - NODE_SIZE/2,
                                      rect.height * (p.y / 2400.0) - NODE_SIZE/2,
                                      NODE_SIZE, NODE_SIZE,
                                      0, 64 * 360) 
```

where`self.t`是当前时间，在循环中递增。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-22T22:39:46.293

我更改了代码以将帧渲染到 Pixmap 上，并将 DrawingArea 替换为 Image。

虽然这解决了闪烁问题，但现在 CPU 使用率已达到峰值。动画还是挺快的，但我不认为这种方法是可扩展的。

我猜是时候进行一些优化了。

**更新：**事实证明，使用带有图像的暴露事件并不是一个好主意。CPU 使用率恢复正常。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-14T14:48:14.373

关于暴露事件处理，请查看第一段动画与 Cairo + Gtk:P

> **Cairo 和 GTK+ 的多线程动画**
> cairo 和 GTK+ 的复杂动画可能会导致界面延迟。这是因为 gtk_main() 线程在单个循环中运行。所以，如果你的 do_draw() 函数实现了一个复杂的绘图命令，并且它是从 gtk_main() 线程调用的（比如通过 on_window_expose_event() 函数），你的 gtk 代码的其余部分将被阻塞，直到 do_draw() 函数完成. 因此，菜单项、鼠标单击甚至关闭按钮事件的处理速度都会很慢，并且您的界面会感觉迟钝。
> 
> 一种解决方案是将所有处理器密集型绘图交给一个单独的线程，从而释放 gtk_main() 线程来响应事件。

[http://cairographics.org/threaded_animation_with_cairo/](http://cairographics.org/threaded_animation_with_cairo/)

# python - 如何将有理数和十进制数字符串转换为python中的浮点数？

> ID：575925
> 
> 赞同：10
> 
> 时间：2009-02-22T22:08:47.990
> 
> 标签：python, rational-numbers

如何将可以表示十进制或有理数的字符串转换为浮点数

```
>>> ["0.1234", "1/2"]
['0.1234', '1/2'] 
```

我想要 [0.1234, 0.5]。

eval 是我的想法，但没有运气：

```
>>> eval("1/2")
0 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-22T22:18:47.247

如果转换失败，我会解析字符串：

```
>>> def convert(s):
    try:
        return float(s)
    except ValueError:
        num, denom = s.split('/')
        return float(num) / float(denom)
...

>>> convert("0.1234")
0.1234

>>> convert("1/2")
0.5 
```

通常使用 eval 是一个坏主意，因为它存在安全风险。*特别是*如果正在评估的字符串来自系统外部。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-22T22:34:55.057

正如其他人指出的那样，使用`eval`是潜在的安全风险，而且肯定是一个坏习惯。（如果你不认为它有风险，`exec`想象一下`eval`：）`__import__('os').system('rm -rf /')`

但是，如果您有 python 2.6 或更高版本，则可以使用[`ast.literal_eval`](http://docs.python.org/library/ast.html#ast.literal_eval)提供的字符串：

> 只能由以下 Python 文字结构组成：字符串、数字、元组、列表、字典、布尔值和无。

因此它应该是相当安全的:-)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-22T23:04:44.267

另一个选项（也仅适用于 2.6 及更高版本）是`fractions`模块。

```
>>> from fractions import Fraction
>>> Fraction("0.1234")
Fraction(617, 5000)
>>> Fraction("1/2")
Fraction(1, 2)
>>> float(Fraction("0.1234"))
0.1234
>>> float(Fraction("1/2"))
0.5 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-22T22:16:05.367

用于`from __future__ import division`获得您想要的行为。然后，在紧要关头，你可以做类似的事情

```
from __future__ import division
strings = ["0.1234", "1/2", "2/3"]
numbers = map(eval, strings) 
```

从字符串中获取浮点列表。如果您想以“正确”的方式执行此操作，请不要使用`eval()`，而是编写一个接受字符串并`float()`在它不包含斜杠时调用它的函数，或者解析字符串并在有斜杠时将分子和分母相除在里面。

一种方法：

```
def parse_float_string(x)
    parts = x.split('/', 1)
    if len(parts) == 1:
        return float(x)
    elif len(parts) == 2:
        return float(parts[0])/float(parts[1])
    else:
        raise ValueError 
```

然后只会`map(parse_float_string, strings)`给你你的清单。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-22T22:13:30.990

`/`运算符进行整数除法。尝试：

```
>>> eval("1.0*" + "1/2")
0.5 
```

因为`eval()`具有潜在危险，您应该始终准确检查您传递给它的内容：

```
>>> import re
>>> s = "1/2"
>>> if re.match(r"\d+/\d+$", s):
...     eval("1.0*" + s)
...
0.5 
```

但是，如果您首先将输入与正则表达式进行匹配，您不妨使用`r"(\d+)/(\d+)$"`提取分子和分母，自己进行除法，并完全避免`eval()`：

```
>>> m = re.match(r"(\d+)/(\d+)$", s)
>>> if m:
...     float(m.group(1)) / float(m.group(2))
...
0.5 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-22T22:17:37.360

eval 的问题在于，就像在 python 中一样，整数的商是一个整数。所以，你有几个选择。

第一个是简单地使整数除法返回浮点数：

```
from __future__ import division 
```

另一种是拆分有理数：

```
reduce(lambda x, y: x*y, map(int, rat_str.split("/")), 1) 
```

其中 rat_str 是有理数的字符串。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-23T00:18:53.903

在 Python 3 中，这应该可以工作。

```
>>> x = ["0.1234", "1/2"]
>>> [eval(i) for i in x]
[0.1234, 0.5] 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-23T02:54:20.767

[sympy](http://code.google.com/p/sympy/)可以在这里为您提供帮助：

```
import sympy

half = sympy.Rational('1/2')
p1234 = sympy.Rational('0.1234')
print '%f, %f" % (half, p1234) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-22T22:15:39.750

这是因为 1 和 2 被 Python 解释为整数而不是浮点数。它需要是 1.0/2.0 或两者的混合。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-22T22:29:11.513

`from __future__ import division`与结合的建议`eval`肯定会奏效。

可能值得指出的是，不使用`eval`而是解析字符串的建议这样做`eval`是危险的：如果有某种方式可以将任意字符串发送到`eval`，那么您的系统很容易受到攻击。所以这是一个坏习惯。（但如果这只是快速而肮脏的代码，那可能没什么*大不了*的！）

# c - 我如何错误地使用 C 中的 round() 函数？

> ID：575936
> 
> 赞同：9
> 
> 时间：2009-02-22T22:15:45.413
> 
> 标签：c

我从库中的`round()`and`roundf()`函数中得到了意想不到的结果`math.h`。这是示例代码：

```
#include <stdio.h>
#include <math.h>

int main(void)
{
    float f;
    double d;

    /* Note man page says that roundf() returns a float
       and round() returns a double */
    f = roundf(1.2);
    d = round(1.2);

    printf("%f\n", f);
    printf("%lf\n", d);

    return 0;
} 
```

当我编译并运行程序时，我得到：

```
gcc -lm round.c
./a.out
288.000000
524288.000000 
```

奇怪吧？

**更新：** 连同答案，我已经确认代码在较新的编译器上正常工作。（我认为 %lf 不是正确的 printf 说明符，但在这种情况下这不会影响最终结果。）我需要弄清楚为什么编译器会以这种方式运行，因为我正在运行使用 round() 和已经在同一台机器上编译。当我弄清楚时，我会更新帖子。

```
gcc -v
Reading specs from /usr/lib/gcc-lib/i386-slackware-linux/2.95.3/specs
gcc version 2.95.3 20010315 (release) 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-22T22:37:48.293

如果您在编译代码时没有告诉 gcc 使用 C99 模式编译`-std=c99`（`-fno-builtin`然后它假设您的 round/roundf 函数定义为

```
int round();
int roundf(); 
```

因为在 C99 之前的时代还没有这样的函数，所以它没有声明，然后隐式声明它们。这显然会失败，因为调用端将返回值视为一个 int，而被调用端（在链接库中这些函数的定义中）返回一个浮点数。例如，我得到这些结果：

```
[js@HOST2 cpp]$ ./a.out
1065353216.000000
-1048576.000000
[js@HOST2 cpp]$ 
```

并不是说您现在认为您可以将返回值转换为浮点数并且可以。好吧，情况更糟。甚至不能保证返回值与返回的浮点数有任何关系。调用方从它知道返回整数的位置读取。但是您的编译器可能会从被调用方返回另一个位置（例如，在浮动指针寄存器中）的浮点数。上面实际上可以做任何事情，包括中止程序，因为它以未定义的方式运行。

那么，你能做些什么来让它发挥作用呢？将标志传递给编译器`std=c99`或使用其他不需要这些函数的方法进行舍入（地板是其中之一）

```
gcc -std=c99 test.c -lm 
```

See the manpage of `man 3 round`. However, if you have a very old GCC - i'm not sure whether it supports enough of C99 to have that switch. Look into the feature test macros described in the manpage of round then.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T22:23:10.827

当我编译并运行这个确切的代码时（在 cygwin 上的 gcc 下），我得到：

```
$ ./a.exe
1.000000
1.000000 
```

你的编译器有多新？我能想到的只有一个编译器错误，也`gcc -Wall`没有任何警告。

要添加一些进一步的信息[，这个论坛线程](http://www.dreamincode.net/forums/showtopic14415.htm)似乎显示将编译器更改为更新的版本可以修复它。如果这对您不起作用，您需要提供编译器和操作系统的更多详细信息，但鉴于这似乎适用于三个不同平台上的其他人，看起来您的编译器有问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-22T22:24:53.740

为了增加批准的合唱，这对我来说很好（使用 gcc 的 OS X Leopard）。

出于好奇，您需要使用`-lm`标志吗？我第一次没有，第二次没有，没有区别，但那是因为 libm.dylib 和 libc.dylib 是 OS X 上同一个库的符号链接。也许你的 libm 坏了还是什么？您是否需要链接到 libm？我认为 math.h 函数将成为 libc 的一部分......？

编辑：

在您执行任何操作之前，请尝试使用它：

```
float f = 0;
double d = 0; 
```

我认为这不会改变任何事情，但如果改变了，我赢了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-22T22:34:17.663

在 gcc 版本 4.3.2 的 Ubuntu 上，又一个“在我的机器上工作”。

```
$ ./a.out
1.000000
1.000000 
```

不过，我在编译时确实收到了一些警告。

```
$ gcc -lm round.c
round.c: In function ‘main’:
round.c:11: warning: incompatible implicit declaration of built-in function ‘roundf’
round.c:12: warning: incompatible implicit declaration of built-in function ‘round’ 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-23T06:45:05.457

litb was on the right track. `-std=c99` didn't work but adding `#define _ISOC99_SOURCE` worked. So the code looks like:

```
#define _ISOC99_SOURCE
#include <stdio.h>
#include <math.h>

int main(void)
{
... 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T22:23:16.317

这显然无济于事，但代码看起来并按我预期的方式运行。一切似乎都很好。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-22T22:37:14.503

看起来你用对了，描述一下你的环境？

# http-redirect - 我可以合法地将用户从我的商业应用重定向到这个网站吗？

> ID：575946
> 
> 赞同：1
> 
> 时间：2009-02-22T22:19:38.883
> 
> 标签：http-redirect

有问题的网站是 www.eventid.net；我的基于 Web 的应用程序会将用户重定向到该站点并在 url 中发送一个事件 ID。重定向将是：[http ://www.eventid.net/display.asp?eventid=1003&source=Microsoft-Windows-Security-Licensing-SLC](http://www.eventid.net/display.asp?eventid=1003&source=Microsoft-Windows-Security-Licensing-SLC)

你觉得我能做到吗？

我已经联系了网站所有者，但没有得到回复。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-22T22:27:11.970

这是一个公共网站，你当然可以。

如果您为自己的应用程序屏幕抓取他们的结果，那将是另一回事，但根据您的描述，情况并非如此。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T22:43:15.987

如果您在德国运营一个网站，并且您的网站有指向 Stackoverflow 文章的深层链接，并且该文章包含来自一家德国公司的受版权保护的代码（例如，由员工发布），那么该公司很容易给您带来麻烦在任何德国法院。

美国法院要宽松得多，所以如果你只在美国做生意，我不会太担心，只要你不违反这里的使用条款。

因此，我认为“当然，它是一个公共网站”的答案并不能很好地解决当您将问题置于国际背景下时可能出现的潜在复杂法律问题。

一些例子（只有大的进入英语新闻）：

[http://www.linksandlaw.com/courtdecisions-germany.htm](http://www.linksandlaw.com/courtdecisions-germany.htm)

[http://www.theregister.co.uk/2005/04/11/heise_not_allowed_to_mention_slysoft/](http://www.theregister.co.uk/2005/04/11/heise_not_allowed_to_mention_slysoft/)

[http://news.cnet.com/8301-1023_3-10064740-93.html](http://news.cnet.com/8301-1023_3-10064740-93.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-22T22:30:26.860

仔细阅读他们[的使用条款。](http://www.eventid.net/legal.asp)确保避免侵犯他们的商标。如果不清楚您正在重定向到外部站点，您可能需要明确说明，以免您的用户感到困惑。

# visual-studio - 手动查找文本块的大小（ASCII 格式）

> ID：575951
> 
> 赞同：-2
> 
> 时间：2009-02-22T22:23:00.403
> 
> 标签：visual-studio, text, notepad++

是否有一种简单的方法可以手动（即不通过代码）查找选定文本块的大小（以字节、KB 等为单位）？目前我正在获取文本，剪切/粘贴到一个新的文本文档中，保存它，然后单击“属性”以估计大小。

我主要在 Visual Studio 2008 中进行开发，但我需要任何简单的方法来手动执行此操作。

注意：我知道这不是一个专门的编程问题，而是与编程有关。我需要这个来比较几个函数，看看哪个函数返回的文本量最少。我只需要做几次，所以想为它写一个方法是矫枉过正的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T22:25:37.137

这个问题没有任何意义。文本可以以不同的格式编码；ASCII、UTF-8、UTF-16 等。文本块消耗的内存取决于您决定使用的编码。

编辑：要回答您现在所说的问题（我如何确定哪个函数正在返回“较小”的文本块）——给定一个单一的编码，较短的文本几乎总是会更小。为什么不能只比较长度？

在您的评论中，您提到它是 ASCII。在这种情况下，它将是每个字符一个字节。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T22:25:28.900

我看不出使用您要粘贴到的应用程序编写的代码与使用其他代码之间的区别。作为一个 python 人，每当我想检查一些文本的长度时，我都会在交互式解释器中进行。当然，一些更适合您口味的等效解决方案是合适的吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T15:04:58.980

最终只是将文本剪切/粘贴到 MS Word 中并使用其中的字符计数功能

# .net - 异步操作性能

> ID：575974
> 
> 赞同：0
> 
> 时间：2009-02-22T22:34:45.337
> 
> 标签：.net, asynchronous, filestream

[.NET 中异步编程](http://msdn.microsoft.com/en-us/library/ms228963(VS.85).aspx)的特性之一是在长时间运行的操作执行期间节省线程。该类`FileStream`可以设置为允许异步操作，允许运行（例如）复制操作而无需虚拟使用任何线程。令我惊讶的是，我发现运行异步流复制不仅执行速度较慢，而且比等效的同步流复制使用更多的处理能力。

是否进行了任何基准测试来比较同步和异步操作执行（文件、网络等）？如果异步操作比同步操作慢几倍，那么执行异步操作而不是跨越单独的线程并在服务器环境中执行同步操作真的有意义吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T23:09:31.727

引用您在评论中包含的文章对@Alex 的回复。

> 在 I/O 请求预计需要大量时间的情况下，例如大型数据库的刷新或备份或通信链路缓慢，异步 I/O 通常是优化处理效率的好方法。但是，对于相对较快的 I/O 操作，处理内核 I/O 请求和内核信号的开销可能会降低异步 I/O 的益处，尤其是在需要进行许多快速 I/O 操作的情况下。在这种情况下，同步 I/O 会更好。如何完成这些任务的机制和实现细节取决于所使用的设备句柄类型和应用程序的特定需求。换句话说，通常有多种方法可以解决问题。

FWIW，我认为@Alex 是正确的，有另一个线程运行与您的 I/O 请求相关的内核代码。但是，该线程不由您的应用程序管理。运行内核代码的线程本身可能会阻塞设备 I/O 请求并等待实际硬件完成请求，然后再向您的用户模式线程发出信号，但它仍然存在。

使用异步线程不应该被认为是提高任何特定请求的速度的一种方式，而是一种通过允许您的应用程序在等待相对较慢的 I/O 的同时继续处理其他任务来提高整体效率的方式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T22:44:46.843

您确定您正确地对复制操作进行了基准测试吗？任何异步操作都只是创建新线程并在新线程中运行操作，同时让主线程做其他事情。

与自己创建线程相比，异步操作主要提供了一些简化（更少的代码行），但它们不应该比创建新线程更影响性能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T10:13:38.840

实际上，文件 i/o*实际上*是异步的条件是相当具体的，即使在本机 Win32 级别也是如此。有关更多详细信息，请参阅[本文](http://www.lenholgate.com/archives/000765.html)。

# c# - 在值对象的不可变对象和结构之间进行选择

> ID：575977
> 
> 赞同：24
> 
> 时间：2009-02-22T22:35:50.920
> 
> 标签：c#, oop, domain-driven-design

您如何在将值对象（规范示例是地址）实现为不可变对象或结构之间进行选择？

选择其中一个是否有性能、语义或任何其他好处？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-22T22:51:15.843

有几点需要考虑：

结构在堆栈上分配（通常）。它是一种值类型，因此如果数据太大，跨方法传递数据的成本可能会很高。

在堆上分配了一个类。它是一种引用类型，因此通过方法传递对象的成本并不高。

通常，我将结构用于不是很大的不可变对象。我只在其中包含有限数量的数据或者我想要不变性时使用它们。一个例子是`DateTime`结构。我喜欢认为，如果我的对象不像 a 那样轻量级`DateTime`，那么它可能不值得用作结构。此外，如果我的对象作为值类型（也像`DateTime`）传递没有意义，那么用作结构可能没有用。不变性是这里的关键。另外，我想强调一下，默认情况下结构不是不可变的**。**您必须通过设计使它们不可变。

在我遇到的 99% 的情况下，使用类是正确的。我发现自己并不经常需要不可变的类。在大多数情况下，我认为类是可变的更自然。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-22T22:40:58.567

我喜欢用一个思想实验：

当只调用一个空的构造函数时，这个对象有意义吗？

**[应Richard E](https://stackoverflow.com/users/39709/richard-e)的要求进行编辑**

一个很好的用途`struct`是包装原语并将它们限定在有效范围内。

例如，概率的有效范围为 0-1。在任何地方使用小数表示这一点很容易出错，并且需要在每个使用点进行验证。

相反，您可以使用验证和其他有用的操作来包装原语。这通过了思想实验，因为大多数原语具有自然的 0 状态。

以下是`struct`表示概率的示例用法：

```
public struct Probability : IEquatable<Probability>, IComparable<Probability>
{
    public static bool operator ==(Probability x, Probability y)
    {
        return x.Equals(y);
    }

    public static bool operator !=(Probability x, Probability y)
    {
        return !(x == y);
    }

    public static bool operator >(Probability x, Probability y)
    {
        return x.CompareTo(y) > 0;
    }

    public static bool operator <(Probability x, Probability y)
    {
        return x.CompareTo(y) < 0;
    }

    public static Probability operator +(Probability x, Probability y)
    {
        return new Probability(x._value + y._value);
    }

    public static Probability operator -(Probability x, Probability y)
    {
        return new Probability(x._value - y._value);
    }

    private decimal _value;

    public Probability(decimal value) : this()
    {
        if(value < 0 || value > 1)
        {
            throw new ArgumentOutOfRangeException("value");
        }

        _value = value;
    }

    public override bool Equals(object obj)
    {
        return obj is Probability && Equals((Probability) obj);
    }

    public override int GetHashCode()
    {
        return _value.GetHashCode();
    }

    public override string ToString()
    {
        return (_value * 100).ToString() + "%";
    }

    public bool Equals(Probability other)
    {
        return other._value.Equals(_value);
    }

    public int CompareTo(Probability other)
    {
        return _value.CompareTo(other._value);
    }

    public decimal ToDouble()
    {
        return _value;
    }

    public decimal WeightOutcome(double outcome)
    {
        return _value * outcome;
    }
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-25T18:31:44.087

> 您如何在将值对象（规范示例是地址）实现为不可变对象或结构之间进行选择？

我认为你的选择是错误的。不可变对象和结构不是对立的，也不是唯一的选择。相反，您有四个选择：

*   班级
    *   可变的
    *   不可变
*   结构
    *   可变的
    *   不可变

我认为在 .NET 中，默认选择应该是表示**逻辑的****可变类**和表示**实体的****不可变类**。如果可行的话，我实际上倾向于选择不可变类，即使是逻辑实现也是如此。结构应该保留给模拟值语义的小类型，例如自定义类型、数字类型类似实体。这里的重点是*小*，因为您不想复制大量数据，并且通过引用进行间接访问实际上很便宜（因此使用结构不会获得太多收益）。*我总是*倾向于制作结构******`Date``Complex`**不可变的（我现在想不出一个例外）。由于这最符合内在值类型的语义，我发现这是一个很好的规则。********

 ********* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-23T00:10:25.077

因素：结构、内存要求、拳击。

通常，结构的构造函数限制——没有显式的无参数构造函数，没有`base`构造——决定了是否应该使用结构。例如，如果无参数构造函数不应该*将*成员初始化为默认值，请使用不可变对象。

如果您仍然可以在两者之间进行选择，请确定内存要求。小项目应该存储在结构中，特别是如果您期望有很多实例。

当实例被装箱（例如，为匿名函数捕获或存储在非通用容器中）时，这种好处就消失了——您甚至开始为装箱支付额外费用。

* * *

什么是“小”，什么是“多”？

在 32 位系统上，对象的开销是 (IIRC) 8 个字节。请注意，对于几百个实例，这可能已经决定了内部循环是否完全在缓存中运行，或者调用 GC。如果您期望有数万个实例，这可能是运行与爬行之间的区别。

从那个 POV 来看，使用结构并不是过早的优化。

* * *

**所以，作为经验法则**：

如果大多数实例会被装箱，请使用不可变对象。
否则，对于小对象，仅当结构构造会导致笨拙的接口**并且**您期望不超过数千个实例时才使用不可变对象。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-01-03T19:44:23.003

我实际上不建议使用 .NET 结构来实现值对象。有两个原因：

*   结构不支持继承
*   ORM 不能很好地处理到结构的映射

这里我详细描述这个主题：[Value Objects Explained](http://enterprisecraftsmanship.com/2015/01/03/value-objects-explained/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-22T22:59:29.973

在当今世界（我在想 C# 3.5），我认为不需要结构（编辑：除了在某些利基场景中）。

支持结构的论点似乎主要基于感知的性能优势。我希望看到一些基准（复制真实场景）来说明这一点。

将结构用于“轻量级”数据结构的概念似乎对我来说太主观了。数据何时不再是轻量级的？此外，当向使用结构的代码添加功能时，您何时决定将该类型更改为类？

就个人而言，我不记得上次在 C# 中使用结构体是什么时候了。

## 编辑

我建议出于性能原因在 C# 中使用结构是过早优化的明显案例^*

^(* 除非应用程序已经过性能分析并且类的使用已被确定为性能瓶颈)

## 编辑 2

[MSDN 状态](http://msdn.microsoft.com/en-us/library/ah19swz4(VS.71).aspx?ppud=4)：

> struct 类型适用于表示轻量级对象，例如 Point、Rectangle 和 Color。虽然可以将一个点表示为一个类，但在某些情况下，结构更有效。例如，如果您声明一个包含 1000 个 Point 对象的数组，您将为引用每个对象分配额外的内存。在这种情况下，结构更便宜。
> 
> 除非您需要引用类型语义，否则小于 16 字节的类可能更有效地被系统作为结构处理。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-22T23:35:08.530

一般来说，我不建议将结构用于业务对象。虽然朝着这个方向前进可能会获得少量性能，但当您在堆栈上运行时，您最终会在某些方面限制自己，并且默认构造函数在某些情况下可能会成为问题。

我会说，当您拥有向公众发布的软件时，这一点更为重要。

结构体适用于简单类型，这就是为什么你看到微软对大多数数据类型使用结构体的原因。同样，结构体也适用于在堆栈上有意义的对象。答案之一中提到的 Point 结构就是一个很好的例子。

我该如何决定？我通常默认为 object，如果它似乎是一个结构体，它通常是一个相当简单的对象，只包含实现为结构体的简单类型，那么我会仔细考虑并确定它是否使感觉。

你提到一个地址作为你的例子。让我们检查一个，作为一个班级。

```
public class Address
{
    public string AddressLine1 { get; set; }
    public string AddressLine2 { get; set; }
    public string City { get; set; }
    public string State { get; set; }
    public string PostalCode { get; set; }
} 
```

将此对象视为结构。在考虑中，如果您以这种方式编码，请考虑此地址“结构”中包含的类型。您是否看到任何可能无法按照您想要的方式进行的事情？考虑潜在的性能优势（即，有没有）？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-22T22:50:56.640

如果按值传递，复制实例的成本是多少。

如果高，则为不可变引用（类）类型，否则为值（结构）类型。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-22T22:55:37.533

根据经验，结构大小不应超过 16 个字节，否则在方法之间传递它可能比传递对象引用更昂贵，对象引用只有 4 个字节（在 32 位机器上）长。

另一个问题是默认构造函数。结构*总是*有一个默认的（无参数和公共的）构造函数，否则像这样的语句

```
T[] array = new T[10]; // array with 10 values 
```

行不通。

此外，结构覆盖`==`和`!=`运算符并实现`IEquatable<T>`接口是很有礼貌的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-23T03:05:18.480

从对象建模的角度来看，我很欣赏结构，因为它们让我可以使用编译器将某些参数和字段声明为不可为空。当然，如果没有特殊的构造函数语义（如[Spec#](http://research.microsoft.com/en-us/projects/specsharp/)中），这仅适用于具有自然“零”值的类型。（因此布莱恩瓦特的“虽然实验”的答案。）

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2010-02-15T14:54:19.487

结构严格用于高级用户（以及 out 和 ref）。

是的，结构在使用 ref 时可以提供出色的性能，但您必须查看它们使用的内存。谁控制内存等。

如果您不使用带有结构的 ref 和 outs，那么它们是不值得的，如果您预计会出现一些讨厌的错误 :-)

# rdf - 从 RDF 数据实例生成 RDF Schema

> ID：575979
> 
> 赞同：0
> 
> 时间：2009-02-22T22:37:20.620
> 
> 标签：rdf, rdfs

有人知道为给定的 RDF 数据实例生成 RDF 模式的一些工作吗？这就像提出类、它们的属性、它们与其他类的关联（分层或对等）以及属性的数据类型（如果可能的话）之类的信息。这一切都类似于 RDF Schema。

我的另一个问题是这种方法（从给定的 RDF 数据实例生成 RDF 模式）与在 RDF 数据中查找模式有什么不同？是否以不同的方式提出相同的事情，或者，在模式生成中进一步寻找模式并涉及诸如从类关联中提出逻辑推理（传递关系等）之类的东西？

干杯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T23:00:06.970

对于第一个，我从未听说过。反正听起来很奇怪。生成模式是什么意思？使用 RDFS 已经告诉你一些事情，比如如果你有一些特定的三元组，你可以推断出其他的。例如

*   ex:S ex:P ex:O ==> ex:P rdf:type rdf:property
*   ex:A rdf:type ex:B ==> ex:B rdf:type rdf:class

和别的。但我不确定这就是你的意思？您的意思是统计分析以查找实例组、创建类或查找属性的范围/域？

对于模式问题，我知道一个基于机器学习和 OWL-DL 推理的项目[DL-Learner 。](http://aksw.org/Projects/DLLearner)不确定这是否是您再次想要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T08:24:26.563

新的答案，因为我发现一些东西没有经过审查并且与我之前写的内容无关。我不知道它是如何工作的，但我相信您正在搜索类似的东西：[vocabify](http://kwijibo.talis.com/vocabify/)。看[例子](http://kwijibo.talis.com/vocabify/?sample)

希望能有所帮助。

# java - Java 的 LinkedList 中的 clear() impl

> ID：575995
> 
> 赞同：11
> 
> 时间：2009-02-22T22:46:10.457
> 
> 标签：java, linked-list

我担心这是一个非常愚蠢的问题，但这里有：

为什么 Java 默认 LinkedList 实现中的 clear 方法会费心遍历列表并解开所有节点？为什么不直接解开标题并让列表的其余部分保持连接 - GC 无论如何都会得到它，不是吗？

这是方法：

```
/**
 * Removes all of the elements from this list.
 */
public void clear() {
    Entry<E> e = header.next;
    while (e != header) {
        Entry<E> next = e.next;
        e.next = e.previous = null;
        e.element = null;
        e = next;
    }
    header.next = header.previous = header;
    size = 0;
modCount++;
} 
```

为什么走路呢？为什么不直接跳到`header.next = header.previous = header;`？

我能想到的最好的结果是它对 GC 有帮助吗……？这个链接[http://java.sun.com/docs/books/performance/1st_edition/html/JPAppGC.fm.html#997442](http://java.sun.com/docs/books/performance/1st_edition/html/JPAppGC.fm.html#997442)有点暗示。

蒂亚...

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-22T22:48:36.817

他们的方法确保即使其他代码仍然持有对特定节点的引用，其他节点也会被 GC'ed。

否则，即使是对其中一个节点的单个外部引用也会阻止整个链被收集。

此外，列表中的其他操作可能同时进行（例如，通过`subList()`or `Collections.unmodifiableList()`，迭代器的视图），这确保了这些东西立即将列表视为“空”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T12:43:20.117

IIRC，这是在 JDK6 中进行的更改，以帮助某些（世代）GC 算法的性能。通常，`List`自身和较旧的节点将比其他一些节点位于较旧的一代中。年轻代会更频繁地被收集，结果年轻节点在发现所有节点都是垃圾之前就被复制了。

所以这是一个小的性能优化。内存性能优化有点奇怪，因为通常不是导致问题的代码需要额外的时间来执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T17:50:45.243

我只是在我的游戏开发博客上推测这个问题。感谢你的回答。我认为节点暴露是一个有问题的设计余量。列表上的替代视图（迭代器等）将依赖节点取消链接来快速失败，这也是粗略的。与其依赖这种副作用行为，列表上的子视图应该检查修改计数。无论如何，我明白他们为什么现在坚持下去了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-06-28T23:08:52.570

[http://developer.classpath.org/doc/java/util/LinkedList-source.html的](http://developer.classpath.org/doc/java/util/LinkedList-source.html)**java.util.LinkedList**的源代码建议您可以简单地将第一个和最后一个元素设置为 null。

当然，如果你倾向于过度保护，你可以遍历整个事情。我个人认为，如果您的列表包含数千个元素，这可能是一项非常昂贵的任务。************************