# StackOverflow 问答 000050000-000050999

# sql-server - SQL 2000 数据库复制到 SQL 2005 选项

> ID：50003
> 
> 赞同：1
> 
> 时间：2008-09-08T15:51:00.910
> 
> 标签：sql-server

我们有一个带有 SQL Server 2000 的生产 Web 和数据库服务器。（但是，一些客户有自己的带有 SQL 2005 的服务器。）所以我们有 SQL 2005 Express 的本地安装，用于在 Windows XP SP3 机器上进行开发（它不允许 SQL 2000 Enterprise 安装）。

我们经常需要将 SQL 2000 数据库复制到 SQL 2005 实例。过去，我们使用过 SQL Publishing 工具（这里也提到[了](https://stackoverflow.com/questions/1600/best-way-to-copy-a-database-in-sql-server-20058#1776)）。但是，我们的一个数据库太大，以至于使用该工具会失败，因为它创建的 SQL 脚本太大，Management Studio 无法正确处理它们。此外，它需要太长时间...... :)

我们将使用 SQL 2005 附带的复制数据库向导，但我们的开发机器运行 SQL 2005 Express，它不包括复制数据库向导工作所需的 SQL Server 代理。所以，我想我们的解决方案是用完整版的 SQL 2005 升级我们的开发安装（当然，我们有 MSDN 订阅）。

我想知道还有哪些其他解决方案（如果有的话）对你们有用？（除了向老板抱怨我们的生产服务器升级到2005甚至2008——我已经尝试过了。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-08T15:53:11.637

在 SQL Server 2000 中备份它，然后使用该`RESTORE WITH MOVE`命令进入 2005 Express。

# flash - Flash 超链接似乎截断了周围的空间

> ID：50005
> 
> 赞同：1
> 
> 时间：2008-09-08T15:51:41.860
> 
> 标签：flash, actionscript-3

我有一个涉及 Flash 文本和超链接的奇怪错误，带有`<a>`标签的 TextField 中的 htmlText 似乎截断了周围的空间：

[![输出](https://i.stack.imgur.com/FDA7a.gif)](https://i.stack.imgur.com/FDA7a.gif)

一旦我将光标放在文本上，它就会自行“修复”：

[![鼠标悬停输出](https://i.stack.imgur.com/YFbSR.gif)](https://i.stack.imgur.com/YFbSR.gif)

这是 textField 中的 HTML：

```
<p>The speeches at both the <a href="http://www.demconvention.com/speeches/" target="_blank">Democratic National Convention</a> last week and the <a href="http://www.gopconvention2008.com/videos" target="_blank">Republican National Convention</a> this week, have been, for me at least, must see TV.</p> 
```

当我禁用附加到它的 styleSheet 时，效果仍然存在，但是将鼠标放在它上面并不能修复间距。我正在使用“抗锯齿以提高可读性”，并嵌入了所有大写字母、小写字母、数字和标点符号。我还要指出，如果我将渲染设置更改为“使用设备字体”，错误就会消失。

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T08:46:36.560

确保你的 styleSheet 声明了它应该对 Anchors 做什么。如果您使用 CSS，那么您显然正在使用 htmlText .

将以下内容添加到您的 CSS 中，并确保它在样式、宽度和大小方面与文本的常规样式具有相同的设置。唯一应该不同的是颜色。

```
一条链接
{
   字体系列：sameAsReg；
   字体大小：12px；//注意flash省略了px和pt之类的东西。
   颜色：#FF0000; //红色的
}

```

确保您嵌入的字体在库中并被实例化到您的代码中。当您只能在运行时从库中加载字体然后您可以在任何地方使用它时，通过 UI 嵌入每个文本字段是很愚蠢的。

您还可以在编译时导入多种字体，并通过 <class span="someCSSClass">Some Text</span><class span="someOtherCSSClass">Some Other Text</span> 在同一个文本字段中使用它们

祝你好运，我希望这会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-24T17:29:24.257

我有同样的问题。如果将 autoSize 设置为 center，它就可以解决这个问题。我不知道为什么，但它确实解决了它。这似乎是一个 Flash 错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-01T17:32:01.110

圣牛也有同样的问题。显然，您设置变量的顺序很重要。[看看这个线程](http://forum.sephiroth.it/showthread.php?t=10000&page=2)的第六个回复。我还注意到这只发生在 AntiAliasType.ADVANCED 中，这是 TextField 的默认设置。

```
_description = new TextField();
_description.selectable = false;
_description.width = WIDTH; // Global.
addChild(_description);

var myriadPro:Font = new MyriadPro(); // Embedded font.
var style:StyleSheet = new StyleSheet();

var styleObj:Object = new Object();
styleObj.fontFamily = myriadPro.fontName;
styleObj.fontSize   = 13;
styleObj.textAlign  = "left";
styleObj.color      = "#FFFFFF";

style.setStyle("p", styleObj);
style.setStyle("a:link", styleObj);
style.setStyle("a:hover", styleObj);

_description.autoSize = TextFieldAutoSize.LEFT;
_description.antiAliasType = AntiAliasType.ADVANCED;
_description.condenseWhite = true;
_description.wordWrap   = true;
_description.multiline  = true;
_description.embedFonts = true;

_description.styleSheet = style;
_description.htmlText = '<p>A short description with an <a href="http://www.example.com/">HTML</a> link that can be clicked.</p>'; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-20T16:14:44.057

我尝试了以上所有方法，但发现确保 autosize = false 是为我解决的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-16T15:37:12.170

我也遇到了这个问题，发现设置以下为我解决了这个问题。

```
yourTextField.gridFitType = GridFitType.SUBPIXEL; 
```

看起来它可能是由`AntiAliasType`设置为高级（默认为 PIXEL gridFitType）引起的。我认为它移动了一些副本，因为它试图将字符修复为整个像素值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T10:59:18.437

如果您在锚元素之前和之后放置不间断空格，会有什么不同吗？

```
<p> ... &nbsp;<a ... >Link text</a>&nbsp; ... </p> 
```

诚然，充其量是一种解决方法，但它可能会为您争取一些时间来研究真正的解决方案。

# asp.net - Asp.Net Form DefaultButton Error in Firefox

> ID：50033
> 
> 赞同：5
> 
> 时间：2008-09-08T15:57:36.527
> 
> 标签：asp.net, firefox, webforms, textarea

The .Net generated code for a form with the "DefaultButton" attribute set contains poor javascript that allows the functionality to work in IE but not in other browsers (Firefox specifcially).

Hitting enter key does submit the form with all browsers but Firefox cannot disregard the key press when it happens inside of a <textarea> control. The result is a multiline text area control that cannot be multiline in Firefox as the enter key submits the form instead of creating a new line.

For more information on the bug, [read it here](http://www.velocityreviews.com/forums/t367383-formdefaultbutton-behaves-incorrectly.html).

This could be fixed in Asp.Net 3.0+ but a workaround still has to be created for 2.0\.

Any ideas for the lightest workaround (a hack that doesn't look like a hack =D)? The solution in the above link scares me a little as it could easily have unintended side-effects.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-08T16:12:13.543

I use this function adapted from codesta. [Edit: the very same one, I see, that scares you! Oops. Can't help you then.]

[http://blog.codesta.com/codesta_weblog/2007/12/net-gotchas---p.html](http://blog.codesta.com/codesta_weblog/2007/12/net-gotchas---p.html).

You use it by surrounding your code with a div like so. You could subclass the Form to include this automatically. I don't use it that much, so I didn't.

```
<div onkeypress="return FireDefaultButton(event, '<%= aspButtonID.ClientID %>')">
    (your form goes here)
</div>

```

Here's the function.

```
function FireDefaultButton(event, target) 
{
    // srcElement is for IE
    var element = event.target || event.srcElement;

    if (13 == event.keyCode && !(element && "textarea" == element.tagName.toLowerCase())) 
    {
        var defaultButton;
        defaultButton = document.getElementById(target);

        if (defaultButton && "undefined" != typeof defaultButton.click) 
        {
            defaultButton.click();
            event.cancelBubble = true;
            if (event.stopPropagation) 
                event.stopPropagation();
            return false;
        }
    }
    return true;
}

```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-21T11:21:55.097

It seems that the fix codesta.com that harpo link to is no longer necessary, since the fix event.srcElement is not integrade in ASP.NET 3.5\. The implementation of DefaultButton does however still have some problems, because it is catching the Enter key press in too many cases. For example: If you have activated a button in the form using tab, pressing Enter should click on the button and not submit the form.

Include the following JavaScript code at the bottom of your ASP.NET web page to make Enter behave the way it should.

```
// Fixes ASP.NET's behavior of default button by testing for more controls
// than just textarea where the event should not be caugt by the DefaultButton
// action. This method has to override ASP.NET's WebForm_FireDefaultButton, so
// it has to included at the bottom of the page.
function WebForm_FireDefaultButton(event, target) {
  if (event.keyCode == 13) {
    var src = event.srcElement || event.target;
    if (!(
      src
      &&
      (
        src.tagName.toLowerCase() == "textarea"
        || src.tagName.toLowerCase() == "a"
        ||
        (
          src.tagName.toLowerCase() == "input"
          &&
          (
            src.getAttribute("type").toLowerCase() == "submit"
            || src.getAttribute("type").toLowerCase() == "button"
            || src.getAttribute("type").toLowerCase() == "reset"
          )
        )
        || src.tagName.toLowerCase() == "option"
        || src.tagName.toLowerCase() == "select"
      ) 
    )) {
      var defaultButton;
      if (__nonMSDOMBrowser) {
        defaultButton = document.getElementById(target);
      }
      else {
        defaultButton = document.all[target];
      }
      if (defaultButton && typeof (defaultButton.click) != "undefined") {
        defaultButton.click();
        event.cancelBubble = true;
        if (event.stopPropagation) event.stopPropagation();
        return false;
      }
    }
  }
  return true;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T16:00:02.107

For this particular issue, the reason is because javascript generated by ASP.NET 2.0 has some IE only notation: event.srcElement is not availabe in FireFox (use event.target instead):

```
function WebForm_FireDefaultButton(event, target) {
if (!__defaultFired && event.keyCode == 13 && !(event.srcElement && 
(event.srcElement.tagName.toLowerCase() == "textarea"))) {
var defaultButton;
if (__nonMSDOMBrowser) {
defaultButton = document.getElementById(target);
}
else {
defaultButton = document.all[target];
}
if (defaultButton && typeof(defaultButton.click) != 
"undefined") {
__defaultFired = true;
defaultButton.click();
event.cancelBubble = true;
if (event.stopPropagation) event.stopPropagation();
return false;
}
}
return true;
} 
```

If we change the first 2 lines into:

```
function WebForm_FireDefaultButton(event, target) {
var element = event.target || event.srcElement;
if (!__defaultFired && event.keyCode == 13 && !(element && 
(element.tagName.toLowerCase() == "textarea"))) { 
```

Put the changed code in a file and then do

```
protected void Page_Load(object sender, EventArgs e)
{
ClientScript.RegisterClientScriptInclude("js1", "JScript.js");
} 
```

Then it will work for both IE and FireFox.

Source:

[http://www.velocityreviews.com/forums/t367383-formdefaultbutton-behaves-incorrectly.html](http://www.velocityreviews.com/forums/t367383-formdefaultbutton-behaves-incorrectly.html)

# security - 有哪些好的 SharePoint 安全资源？

> ID：50037
> 
> 赞同：5
> 
> 时间：2008-09-08T15:58:48.770
> 
> 标签：security, sharepoint

我有一个 SharePoint 应用程序，我很遗憾地说，在我的 SharePoint 引起的兴奋中，我忽略了很多我应该更加关注的安全问题。虽然我们以前没有，但现在我们实际上*需要*细粒度的安全性，所以我需要接受教育。我最感兴趣的是如何最好地创建组并将用户添加到这些组。我们有一个主站点集合和该集合下的几十个子站点。我怎样才能最好地创建一个细粒度的安全世界，在其中我可以独立地为每个子站点分配权限？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-08T16:22:02.117

要在“子站点”级别（即对象模型术语中的 SPWeb 对象）具有不同的权限，您需要**为站点启用唯一权限**。

可以在 office 网站上找到一篇概述 SharePoint 2007 中权限层次结构的好文章[关于控制对网站和网站内容 的访问](http://office.microsoft.com/en-us/sharepointtechnology/HA101001441033.aspx)

根据我的经验，如果您能够使用权限继承而不是细粒度的安全性，那么管理起来就会少很多麻烦。

**破坏站点权限继承**

*   单击“**人员和组**”
*   点击“**站点权限**”
*   从列表中的操作菜单中单击“**编辑权限**”

[http://blog.richfinn.net/content/binary/WindowsLiveWriter/InstallandConfiguretheCommunityKitforSha_E660/image_3.png http://blog.richfinn.net/content/binary/WindowsLiveWriter/InstallandConfiguretheCommunityKitforSha_E660/image_3.png](http://blog.richfinn.net/content/binary/WindowsLiveWriter/InstallandConfiguretheCommunityKitforSha_E660/image_3.png)

**其他参考**

*   [SharePoint 2007：权限、权限、权限。](http://dattard.blogspot.com/2007/02/sharepoint-2007-permissions-permissions.html)
*   [SharePoint 2007 站点组 - ​​第 1 部分 - 基础知识](http://www.sharepointblogs.com/tonstegeman/archive/2006/10/14/sharepoint-2007-sitegroups-part-1-the-basics.aspx)

# linux - linux下显卡内存使用情况

> ID：50042
> 
> 赞同：4
> 
> 时间：2008-09-08T16:03:03.737
> 
> 标签：linux, graphics

linux中有哪些工具可以监控显卡内存使用情况？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T22:27:15.493

[NVIDIA PerfKit](http://developer.nvidia.com/content/nvidia-perfkit)有一个 linux 版本，可以实时监控各种显卡属性，包括显卡内存使用情况。显然，这只适用于 NVIDIA 显卡，并且还需要使用特殊的检测驱动程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-08T16:41:49.650

如果您只是出于 3D 图形开发目的而需要了解它，您可能需要研究[gDEBugger](http://www.gremedy.com/)之类的东西，或者，如果您只关心 NVIDIA 显卡，您可以尝试[NVIDIA PerfHUD](http://developer.nvidia.com/content/nvidia-perfhud)。我自己没有使用过它们，但我希望他们能够跟踪此类信息。

# .net - Visual Studio 2003 是否仍然可用/受支持

> ID：50046
> 
> 赞同：7
> 
> 时间：2008-09-08T16:05:17.850
> 
> 标签：.net, visual-studio, visual-studio-2003

几乎就像标题所说的那样。

我们有一些基于 .NET 1.1 的代码，并没有真正希望对其进行上转换。但是，我们希望将开发人员添加到团队中，他们将需要 Visual Studio 的副本。

我的理解是他们将需要 VS 2003 - 因为这是唯一支持 .NET 1.1 的 IDE，但我想知道我们是否仍然能够购买它！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-08T16:06:56.130

您可以在 Visual Studio 2005 中构建 1.1 项目：

[http://www.hanselman.com/blog/BuildingNET11ProjectsUsingVisualStudio2005.aspx](http://www.hanselman.com/blog/BuildingNET11ProjectsUsingVisualStudio2005.aspx)

MSBuild Everett 环境 (MSBEE) 已经发布，很快这将成为（合理地）受支持的方案，我们都将能够在 Visual Studio 2005 上构建 .NET 代码的 1.1 和 2.0 版本。

另请阅读有关此问题的帖子：

[http://blogs.msdn.com/clichten/archive/2005/11/08/490541.aspx](http://blogs.msdn.com/clichten/archive/2005/11/08/490541.aspx)

并且：

[MSBuild Extras](http://www.codeplex.com/Wiki/View.aspx?ProjectName=MSBee) – .NET 1.1 工具包“MSBee”是 MSBuild 的一个补充，它允许开发人员使用面向 .NET 1.1 的 Visual Studio 2005 项目构建托管应用程序。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-08T16:10:00.130

Visual Studio 2003 仍可供 MSDN 订阅者下载。

Visual Studio 的 EULA 包含一个“降级”条款，显示为 IMNAL，允许您购买 Visual Studio 2008，然后在同一许可下安装 2003。

> 降级。您可以同时安装和使用此版本和较早版本的软件。本协议适用于您使用较早的版本。如果早期版本包含不同的组件，则早期版本随附的协议中有关这些组件的任何条款均适用于您对它们的使用。Microsoft 没有义务向您提供早期版本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-08T16:10:17.777

对 VS2003 的主流支持在今年 10 月结束：

[http://support.microsoft.com/lifecycle/search/?sort=PN&alpha=Visual+Studio](http://support.microsoft.com/lifecycle/search/?sort=PN&alpha=Visual+Studio)

延长支持（无论这意味着什么）在相当长的一段时间内仍然可用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T16:11:10.863

除了 Espo 的链接之外，还可以查看[MSBee](http://www.codeplex.com/MSBee)，这是一个用于 MSBuild 的增强工具包，以更好地支持 .NET Framework 1.1。

不过，您似乎甚至可以[将 .NET 1.1 与 Visual Studio 2008 一起使用](http://devlicio.us/blogs/ziemowit_skowronski/archive/2008/08/22/working-with-net-1-1-in-visual-studio-2008-and-team-server.aspx)，因此您应该没有问题。

也就是说，我很想知道是什么让你选择不升级。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T16:08:20.900

支持：是
可用：不通过正常渠道。您可能仍会在亚马逊或其他地方找到盒装副本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-08T16:08:34.940

.NET 1.1 代码可以在 VS 2005 中导入，因为 .NET 2.0 向后兼容 .NET 1.1。

您可能必须转换项目，但它仍应在 VS 2005 中运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-08T16:09:13.410

我相信vs2003在10月份失去支持

# java - 在 SWT 中设置颜色

> ID：50064
> 
> 赞同：61
> 
> 时间：2008-09-08T16:12:57.707
> 
> 标签：java, swt, colors

这很简单，我来自摇摆/awt 背景。

我只是想知道为 SWT 小部件设置背景颜色的正确方法是什么？

我一直在尝试：

```
widget.setBackground( ); 
```

除了我不知道如何在 SWT 中创建颜色对象？

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2008-09-16T18:34:17.440

对于标准颜色（包括操作系统使用的常用颜色和默认颜色）使用`Display.getSystemColor(int)`，并传入`SWT.COLOR_*`所需颜色的常量。

```
Display display = Display.getCurrent();
Color blue = display.getSystemColor(SWT.COLOR_BLUE);
Color listBackground = display.getSystemColor(SWT.COLOR_LIST_BACKGROUND); 
```

请注意，您不需要处理这些颜色，因为 SWT 创建了它们。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2008-09-08T16:49:54.717

要创建颜色，请尝试以下操作：

```
Device device = Display.getCurrent ();
Color red = new Color (device, 255, 0, 0); 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-16T18:18:17.417

请记住，在 SWT 中，您必须在使用完所有资源后显式释放它们。这包括小部件、字体、颜色、图像、显示器、打印机和 GC。如果您不处置这些资源，最终您的应用程序将达到操作系统的资源限制，并且应用程序将停止运行。

另请参阅：[SWT：管理操作系统资源](http://www.eclipse.org/articles/swt-design-2/swt-design-2.html "在 SWT 中管理操作系统资源")

# linux - Linux TCP/IP 黑客“生活”在哪里？

> ID：50074
> 
> 赞同：4
> 
> 时间：2008-09-08T16:21:25.847
> 
> 标签：linux, networking, tcp, kernel

在过去一年左右的时间里，我的生产平台一直受到一个奇怪的 TCP/IP 问题的困扰。我花了无数个小时与有能力和知识渊博的系统管理员一起工作，搜索网络，阅读源代码，被 RH 可怜的支持拉扯着，**流下了血泪**！无济于事。（谷歌[“unkn-4”](http://www.google.ch/search?source=ig&hl=en&rlz=&=&q=unkn-4&btnG=Google+Search&meta=)，你会看到很多帖子都写着我的名字。）

轮换工作已经到位，所以这个问题不是优先事项。但我内心的极客真的很想了解和解决这个问题。

***那么，一个中等能力的系统程序员可以去哪里询问详细的问题并从 TCP/IP 堆栈之王那里获得详细的答案呢？*** 我假设他们的世界如此接近裸机，他们的人口如此之少，与我的世界不同。那，他们不想回复“我的调制解调器不工作”的电子邮件，所以他们躲在阴影里。

任何指针将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-08T16:49:42.330

Dave Miller（负责 linux 内核网络的人）和他们的伙伴都居住在 lkml 或[Linux Kernel Mailing List](http://lkml.org)中。如果你能提供一个相当不错的错误报告，他们会给你一个合理的答案。

另一方面，如果你告诉他们这是一个非常旧的内核，他们会告诉你尝试最新的......至少你可以尝试搜索它的档案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T03:55:06.507

linux-net 邮件列表可能会让您感兴趣。[这里](http://vger.kernel.org/vger-lists.html)应该有更多的细节。

# c - C 图像库

> ID：50079
> 
> 赞同：17
> 
> 时间：2008-09-08T16:21:54.610
> 
> 标签：c, image, playstation-portable

谁能推荐一个像样的C图像库？

我正在寻找 bmp、gif、jpg、png 和 tga 的加载器。

我想用它来编程我的**Sony Playstation Portable**，所以开源会非常方便。

经过一番谷歌搜索，我找到了 FreeImage 和 CImg，但都感觉很重，而且 CImg 是 C++ 而不是 C。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2010-08-02T23:03:36.257

如果您控制正在加载的图像，我所知道的最轻量级的加载器是 Sean Barrett 的[出色 stb_image.c](http://nothings.org/stb_image.c)（直接链接到单个文件源代码！）。

在 Sean 的网站上还有其他非常有价值的库，例如小型 TrueType 光栅化器和 Vorbis 解压缩器，顺便说一句。

如果您需要使用 stb_image 的 OpenGL 图像加载，我会谦虚地将您指向[SOILex](http://bitbucket.org/akx/soilex) ...

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-08T16:25:29.097

ImageMagick 有一个[C API 来连接到它的库](http://www.imagemagick.org/script/magick-wand.php)。在 C 和 ImageMagick 库之间还有他们所谓的[“低级接口”](http://www.imagemagick.org/script/magick-core.php)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-08T16:29:47.823

我过去在 PSP 游戏中使用[FreeImage](http://freeimage.sourceforge.net/)，但它是用于预处理数据而不是在游戏中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-08T16:26:07.673

[DevIL](http://openil.sourceforge.net/)经常被推荐。它是否符合您的要求，我不知道。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T03:09:09.077

我将支持 Thomas Owens 的 ImageMagick 建议。令人难以置信的是，图书馆的全面性以及最终为您节省了多少时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T00:17:07.320

[这](http://code.google.com/p/kgui/source/browse/trunk/kguiimage.cpp)是我为处理图像编写的一些代码。它在 c++（不是 c）中，但您应该能够轻松提取 BMP 和 GIF 加载代码。它是许可的 LGPL。

我使用 libpng 和 jpeglib 来解压缩这些格式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-04-02T17:58:01.860

对于我的一个项目，我正在使用[CImg](http://cimg.sourceforge.net/)库。入手非常有用。此外，他们也有一个体面的文件。

# iis - 你如何在 C# 中备份 IIS 的元数据库？

> ID：50089
> 
> 赞同：0
> 
> 时间：2008-09-08T16:25:06.397
> 
> 标签：iis, directoryservices, metabase

确切的代码会有所帮助。我假设 DirectoryServices 命名空间可以做到这一点，但我找不到做到这一点的方法。

* * *

我需要实际的 C# 代码。到目前为止，我发现的所有示例都是 VB 或 VBScript。我发现的 C# 示例用于读取/设置 ADSI 属性。像备份这样的命令似乎具有某种 .NET 语法，我不清楚如何使用。在 VB 中有一个简单的备份命令。需要 .NET 中的等价物。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-08T17:03:50.330

您需要使用 ADSI 对象。[IIsComputer.Backup](http://msdn.microsoft.com/en-us/library/ms525753.aspx)方法是您想要的。

至于如何从 C# 访问 ADSI 对象，请查看此[MSDN 页面](http://support.microsoft.com/kb/315716)。

**编辑：**这是[C# 中的示例实现](http://www.vbforums.com/archive/index.php/t-470587.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T07:52:46.043

我找到了：

DirectoryEntry de = new DirectoryEntry("IIS://localhost"); de.Invoke("备份", 新对象[0] );

需要设置新对象以保存正确的参数，例如覆盖当前备份

# linux - 如何将密码传递给scp？

> ID：50096
> 
> 赞同：377
> 
> 时间：2008-09-08T16:35:09.230
> 
> 标签：linux, scp, io-redirection

我知道不建议这样做，但是是否可以将用户密码传递给 scp？

我想通过 scp 复制一个文件作为批处理作业的一部分，而接收服务器当然需要密码，不，我不能轻易地将其更改为基于密钥的身份验证。

* * *

## 回答 #1

> 赞同：645
> 
> 时间：2012-12-19T15:17:15.563

使用[sshpass](http://sshpass.sourceforge.net/)：

```
sshpass -p "password" scp -r user@example.com:/some/remote/path /some/local/path 
```

或者密码不会显示在 bash 历史记录中

```
sshpass -f "/path/to/passwordfile" scp -r user@example.com:/some/remote/path /some/local/path 
```

上面将路径的内容从远程主机复制到您的本地。

**安装 ：**

*   ubuntu/debian
    *   `apt install sshpass`
*   centos/fedora
    *   `yum install sshpass`
*   mac w/macports
    *   `port install sshpass`
*   mac w/brew
    *   `brew install https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb`

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2012-02-21T22:17:21.303

只需生成一个 ssh 密钥，例如：

```
ssh-keygen -t rsa -C "your_email@youremail.com" 
```

复制内容`~/.ssh/id_rsa.pub` 并最后将其添加到远程机器`~/.ssh/authorized_keys`

确保远程机器具有权限`0700 for ~./ssh folder`和`0600 for ~/.ssh/authorized_keys`

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2010-11-30T02:41:39.380

如果您从 Windows 连接到服务器，则 scp（“pscp”）的 Putty 版本允许您通过`-pw`参数传递密码。

[这在此处的文档中有所提及。](http://the.earth.li/~sgtatham/putty/0.67/htmldoc/Chapter5.html#pscp)

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2008-09-08T16:38:10.297

[您可以使用诸如expect](http://expect.sourceforge.net/)之类的工具编写脚本（也有方便的绑定，例如用于 Python 的 [Pexpect ）。](http://www.noah.org/wiki/Pexpect)

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2017-11-16T11:28:32.810

curl 可以用作 scp 的替代方法来复制文件，并且它支持命令行上的密码。

```
curl --insecure --user username:password -T /path/to/sourcefile sftp://desthost/path/ 
```

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2013-01-16T15:01:41.170

您可以在 unix/终端上使用 'expect' 脚本

例如创建 'test.exp' ：

```
#!/usr/bin/expect
        spawn scp  /usr/bin/file.txt root@<ServerLocation>:/home
        set pass "Your_Password"
        expect {
        password: {send "$pass\r"; exp_continue}
                  } 
```

运行脚本

```
expect test.exp 
```

我希望这会有所帮助。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-08T16:42:03.160

以下是如何使用`expect`工具执行此操作的示例：

```
sub copyover {
    $scp = Expect->spawn("/usr/bin/scp ${srcpath}/$file $who:${destpath}/$file");
    $scp->expect(30,"ssword: ") || die "Never got password prompt from $dest:$!\n";
    print $scp 'password' . "\n";
    $scp->expect(30,"-re",'$\s') || die "Never got prompt from parent system:$!\n";
    $scp->soft_close();
    return;
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2015-05-13T17:16:26.900

没有人提到它，但是[Putty scp](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html) (pscp) 有一个 -pw 密码选项。

文档可以在这里找到： [https ://the.earth.li/~sgtatham/putty/0.67/htmldoc/Chapter5.html#pscp](https://the.earth.li/~sgtatham/putty/0.67/htmldoc/Chapter5.html#pscp)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2016-11-22T09:35:16.993

您可以使用`ssh-copy-id`添加 ssh 密钥：

```
$which ssh-copy-id #check whether it exists 
```

如果存在：

```
ssh-copy-id  "user@remote-system" 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2017-10-20T07:08:58.833

`ssh-keygen`如上所述设置后，您可以执行

`scp -i ~/.ssh/id_rsa /local/path/to/file remote@ip.com:/path/in/remote/server/`

如果你想减少每次打字，你可以修改你的`.bash_profile`文件，把

```
alias remote_scp='scp -i ~/.ssh/id_rsa /local/path/to/file remote@ip.com:/path/in/remote/server/ 
```

然后从你的终端做`source ~/.bash_profile`. 之后，如果您`remote_scp`在终端中键入，它应该在`scp`没有密码的情况下运行该命令。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-09-14T03:57:31.260

1.  确保在目标服务器上启用密码验证。如果它运行 Ubuntu，然后`/etc/ssh/sshd_config`在服务器上打开，找到行`PasswordAuthentication=no`并将它们全部注释掉（放在`#`行的开头），保存文件并运行`sudo systemctl restart ssh`以应用配置。如果没有这样的行，那么你就完成了。
2.  添加`-o PreferredAuthentications="password"`到您的`scp`命令中，例如：

    ```
    scp -o PreferredAuthentications="password" /path/to/file user@server:/destination/directory 
    ```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2019-12-09T15:55:48.410

这是基于这篇博文的一个穷人的 Linux/Python/Expect-like 示例：[Upgradeing simple shells to fully interactive TTYs](https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/#method1pythonptymodule)。对于无法安装 Expect 或将模块添加到 Python 的旧机器，我需要这个。

代码：

```
(
    echo 'scp jmudd@mysite.com:./install.sh .'
    sleep 5
    echo 'scp-passwd'
    sleep 5
    echo 'exit'
) |

python -c 'import pty; pty.spawn("/usr/bin/bash")' 
```

输出：

```
scp jmudd@mysite.com:install.sh .
bash-4.2$ scp jmudd@mysite.com:install.sh .
Password: 
install.sh                                 100%   15KB 236.2KB/s   00:00    
bash-4.2$ exit
exit 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-03-21T06:04:33.367

1.  确保您之前有“期望”工具，如果没有，请执行

    `# apt-get install expect`

2.  创建具有以下内容的脚本文件。(#vi /root/scriptfile)

    `spawn scp /path_from/file_name user_name_here@to_host_name:/path_to`

    `expect "password:"`

    `send put_password_here\n;`

    `interact`

3.  使用“expect”工具执行脚本文件

    `# expect /root/scriptfile`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-12-02T15:55:38.063

如果您观察到严格的主机密钥检查错误，请使用`-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null`选项。

完整的例子如下 `sshpass -p "password" scp -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@domain-name.com:/tmp/from/psoutput /tmp/to/psoutput`

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-04-12T19:23:06.027

将文件从一台服务器复制到另一台服务器（在脚本上）

在 ubuntu 或其他 Linux 机器上安装 putty。putty 带有 pscp。我们可以用pscp复制文件。

```
apt-get update
apt-get install putty 
echo n |  pscp -pw "Password@1234" -r user_name@source_server_IP:/copy_file_path/files /path_to_copy/files 
```

有关更多选项，请参阅 pscp 帮助。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2021-08-31T13:07:38.230

您可以使用以下步骤。这对我有用！

**Step1-** 创建一个普通文件，假设“ **fileWithScpPassword** ”包含目标服务器的 ssh 密码。

**Step2-**使用**sshpaas -f**后跟密码文件名，然后是普通的 scp 命令。

**sshpass -f "fileWithScpPassword" scp /filePathToUpload user@ip:/destinationPath/**

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2008-09-16T08:16:54.850

另一种方法是将用户密钥的公共部分添加到目标系统上的授权密钥文件中。在您启动传输的系统上，您可以运行 ssh-agent 守护程序并将密钥的私有一半添加到代理。然后可以将批处理作业配置为使用代理来获取私钥，而不是提示输入密钥的密码。

这应该可以在 UNIX/Linux 系统或使用 pageant 和 pscp 的 Windows 平台上实现。

* * *

## 回答 #18

> 赞同：-5
> 
> 时间：2019-09-05T14:18:53.270

上面提到的所有解决方案只有在您安装了应用程序或者您应该拥有安装除了或 sshpass 的管理员权限时才能工作。

我发现这个非常有用的链接可以简单地在后台启动 scp。

```
$ nohup scp file_to_copy user@server:/path/to/copy/the/file > nohup.out 2>&1 
```

[https://charmyin.github.io/scp/2014/10/07/run-scp-in-background/](https://charmyin.github.io/scp/2014/10/07/run-scp-in-background/)

* * *

## 回答 #19

> 赞同：-10
> 
> 时间：2014-02-25T07:08:10.197

[我在这里](https://askubuntu.com/questions/44059/progress-bar-in-scp-command)找到了这个非常有用的答案。

```
rsync -r -v --progress -e ssh user@remote-system:/address/to/remote/file /home/user/ 
```

您不仅可以在那里传递密码，而且复制时会显示进度条。非常棒。

# javascript - 如何从 jQuery 中的模式对话框中获取结果

> ID：50097
> 
> 赞同：13
> 
> 时间：2008-09-08T16:36:03.830
> 
> 标签：javascript, jquery, ajax, jquery-ui, simplemodal

我想在 UI 工具包中使用 simple-modal 之类的加载项或对话框加载项。但是，我如何使用这些或任何其他方法并获得结果。基本上我希望模态与服务器进行一些 AJAX 交互，并返回结果供调用代码做一些事情。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-08T17:05:55.660

以下是确认窗口在 simpleModal 上的工作方式：

```
$(document).ready(function () {
  $('#confirmDialog input:eq(0)').click(function (e) {
    e.preventDefault();

    // example of calling the confirm function
    // you must use a callback function to perform the "yes" action
    confirm("Continue to the SimpleModal Project page?", function () {
      window.location.href = 'http://www.ericmmartin.com/projects/simplemodal/';
    });
  });
});

function confirm(message, callback) {
  $('#confirm').modal({
    close: false,
    overlayId: 'confirmModalOverlay',
    containerId: 'confirmModalContainer', 
    onShow: function (dialog) {
      dialog.data.find('.message').append(message);

      // if the user clicks "yes"
      dialog.data.find('.yes').click(function () {
        // call the callback
        if ($.isFunction(callback)) {
          callback.apply();
        }
        // close the dialog
        $.modal.close();
      });
    }
  });
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-02-15T08:56:10.327

如果您的 HTML 如下所示，并且您试图避免引导程序，那么您可以尝试如下所示。您也可以在此结构上应用 AJAX，因为这就像您页面的 HTML 的任何其他部分一样。或者您使用 Bootstrap 尝试相同的操作，您的工作会更轻松。这是一个代码，请尝试一下。它仍然可以增强和修改：

```
$("button.try-it").on("click", function() {
  $(".modal-container").removeClass("hide");
});
$(".close-btn").on("click", function() {
  $(".modal-container").addClass("hide");
});
```

```
.modal-container {
  position: absolute;
  background-color: rgba(35, 35, 35, 0.41);
  top: 0;
  bottom: 0;
  height: 300px;
  width: 100%;
}

.modal-body {
  width: 100px;
  height: 100px;
  margin: 0 auto;
  background: white;
}

.close-btn {
  float: right;
}

.hide {
  display: none;
}

.body-container {
  position: relative;
  box-sizing: border-box;
}

.close-btn {
  cursor: pointer;
}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<div class="body-container">
  <div class="button">
    <button class="try-it">Try It!!</button>
  </div>
  <div class="modal-container hide">
    <div class="modal-body">
      <span class="close-btn">x</span>
      <p>Here is the content of the modal</p>
      <!--You can apply AJAX on this structure since this just like any other part of the HTML of your page-->
      <!--Or you can use Bootstrap modal instead of this one.-->
    </div>
  </div>
</div>
```

希望这会有所帮助。

[这](https://jsfiddle.net/5j4ag1p2/)是小提琴的链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-08T16:38:19.253

由于模式对话框在页面上，您可以自由设置所需的任何文档变量。然而，我看到的所有模式对话框脚本都包含一个使用返回值的演示，所以它很可能在那个页面上。

（该网站已为我屏蔽，否则我会查看）

# .net - 比较两个集合的相等性，而不考虑其中项目的顺序

> ID：50098
> 
> 赞同：177
> 
> 时间：2008-09-08T16:36:15.840
> 
> 标签：.net, collections, comparison, equality

我想比较两个集合（在 C# 中），但我不确定有效实现这一点的最佳方法。

我已经阅读了关于[Enumerable.SequenceEqual](https://stackoverflow.com/questions/43500/is-there-a-built-in-method-to-compare-collections-in-c)的另一个线程，但这并不是我想要的。

就我而言，如果两个集合都包含相同的项目（无论顺序如何），它们将是相等的。

例子：

```
collection1 = {1, 2, 3, 4};
collection2 = {2, 4, 1, 3};

collection1 == collection2; // true 
```

我通常做的是遍历一个集合的每个项目，看看它是否存在于另一个集合中，然后循环遍历另一个集合的每个项目，看看它是否存在于第一个集合中。（我首先比较长度）。

```
if (collection1.Count != collection2.Count)
    return false; // the collections are not equal

foreach (Item item in collection1)
{
    if (!collection2.Contains(item))
        return false; // the collections are not equal
}

foreach (Item item in collection2)
{
    if (!collection1.Contains(item))
        return false; // the collections are not equal
}

return true; // the collections are equal 
```

然而，这并不完全正确，而且它可能不是比较两个集合是否相等的最有效方法。

我能想到的一个错误的例子是：

```
collection1 = {1, 2, 3, 3, 4}
collection2 = {1, 2, 2, 3, 4} 
```

这与我的实现相同。我应该只计算找到每个项目的次数并确保两个集合中的计数相等吗？

* * *

这些示例使用某种 C#（我们称其为伪 C#），但可以用任何您希望的语言给出答案，没关系。

**注意：**为了简单起见，我在示例中使用了整数，但我也希望能够使用引用类型的对象（它们不能正确地作为键，因为只比较对象的引用，而不是内容）。

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2010-09-24T20:10:30.170

事实证明，微软已经在其测试框架中包含了这一点：[CollectionAssert.AreEquivalent](http://msdn.microsoft.com/en-us/library/ms243779.aspx)

> 评论
> 
> 如果两个集合具有相同数量的相同元素，但顺序不限，则它们是等价的。如果它们的值相等，则元素相等，而不是如果它们引用同一个对象。

使用反射器，我修改了 AreEquivalent() 背后的代码以创建相应的相等比较器。它比现有答案更完整，因为它考虑了空值，实现了 IEqualityComparer 并具有一些效率和边缘情况检查。另外，它是*微软*:)

```
public class MultiSetComparer<T> : IEqualityComparer<IEnumerable<T>>
{
    private readonly IEqualityComparer<T> m_comparer;
    public MultiSetComparer(IEqualityComparer<T> comparer = null)
    {
        m_comparer = comparer ?? EqualityComparer<T>.Default;
    }

    public bool Equals(IEnumerable<T> first, IEnumerable<T> second)
    {
        if (first == null)
            return second == null;

        if (second == null)
            return false;

        if (ReferenceEquals(first, second))
            return true;

        if (first is ICollection<T> firstCollection && second is ICollection<T> secondCollection)
        {
            if (firstCollection.Count != secondCollection.Count)
                return false;

            if (firstCollection.Count == 0)
                return true;
        }

        return !HaveMismatchedElement(first, second);
    }

    private bool HaveMismatchedElement(IEnumerable<T> first, IEnumerable<T> second)
    {
        int firstNullCount;
        int secondNullCount;

        var firstElementCounts = GetElementCounts(first, out firstNullCount);
        var secondElementCounts = GetElementCounts(second, out secondNullCount);

        if (firstNullCount != secondNullCount || firstElementCounts.Count != secondElementCounts.Count)
            return true;

        foreach (var kvp in firstElementCounts)
        {
            var firstElementCount = kvp.Value;
            int secondElementCount;
            secondElementCounts.TryGetValue(kvp.Key, out secondElementCount);

            if (firstElementCount != secondElementCount)
                return true;
        }

        return false;
    }

    private Dictionary<T, int> GetElementCounts(IEnumerable<T> enumerable, out int nullCount)
    {
        var dictionary = new Dictionary<T, int>(m_comparer);
        nullCount = 0;

        foreach (T element in enumerable)
        {
            if (element == null)
            {
                nullCount++;
            }
            else
            {
                int num;
                dictionary.TryGetValue(element, out num);
                num++;
                dictionary[element] = num;
            }
        }

        return dictionary;
    }

    public int GetHashCode(IEnumerable<T> enumerable)
    {
        if (enumerable == null) throw new 
            ArgumentNullException(nameof(enumerable));

        int hash = 17;

        foreach (T val in enumerable)
            hash ^= (val == null ? 42 : m_comparer.GetHashCode(val));

        return hash;
    }
} 
```

示例用法：

```
var set = new HashSet<IEnumerable<int>>(new[] {new[]{1,2,3}}, new MultiSetComparer<int>());
Console.WriteLine(set.Contains(new [] {3,2,1})); //true
Console.WriteLine(set.Contains(new [] {1, 2, 3, 3})); //false 
```

或者，如果您只想直接比较两个集合：

```
var comp = new MultiSetComparer<string>();
Console.WriteLine(comp.Equals(new[] {"a","b","c"}, new[] {"a","c","b"})); //true
Console.WriteLine(comp.Equals(new[] {"a","b","c"}, new[] {"a","b"})); //false 
```

最后，您可以使用您选择的相等比较器：

```
var strcomp = new MultiSetComparer<string>(StringComparer.OrdinalIgnoreCase);
Console.WriteLine(strcomp.Equals(new[] {"a", "b"}, new []{"B", "A"})); //true 
```

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2008-09-08T17:07:36.263

一个简单且相当有效的解决方案是对两个集合进行排序，然后比较它们是否相等：

```
bool equal = collection1.OrderBy(i => i).SequenceEqual(
                 collection2.OrderBy(i => i)); 
```

这个算法是 O(N*logN)，而你上面的解决方案是 O(N^2)。

如果集合具有某些属性，您可能能够实现更快的解决方案。例如，如果您的两个集合都是哈希集，则它们不能包含重复项。此外，检查散列集是否包含某些元素非常快。在这种情况下，类似于您的算法可能会是最快的。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-09-08T17:00:55.627

创建一个字典“dict”，然后为第一个集合中的每个成员，执行 dict[member]++;

然后，以相同的方式循环第二个集合，但对每个成员执行 dict[member]--。

最后，遍历字典中的所有成员：

```
 private bool SetEqual (List<int> left, List<int> right) {

        if (left.Count != right.Count)
            return false;

        Dictionary<int, int> dict = new Dictionary<int, int>();

        foreach (int member in left) {
            if (dict.ContainsKey(member) == false)
                dict[member] = 1;
            else
                dict[member]++;
        }

        foreach (int member in right) {
            if (dict.ContainsKey(member) == false)
                return false;
            else
                dict[member]--;
        }

        foreach (KeyValuePair<int, int> kvp in dict) {
            if (kvp.Value != 0)
                return false;
        }

        return true;

    } 
```

编辑：据我所知，这与最有效的算法顺序相同。这个算法是 O(N)，假设 Dictionary 使用 O(1) 查找。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-09-08T19:18:55.857

这是我（受 D.Jennings 严重影响）比较方法的通用实现（在 C# 中）：

```
/// <summary>
/// Represents a service used to compare two collections for equality.
/// </summary>
/// <typeparam name="T">The type of the items in the collections.</typeparam>
public class CollectionComparer<T>
{
    /// <summary>
    /// Compares the content of two collections for equality.
    /// </summary>
    /// <param name="foo">The first collection.</param>
    /// <param name="bar">The second collection.</param>
    /// <returns>True if both collections have the same content, false otherwise.</returns>
    public bool Execute(ICollection<T> foo, ICollection<T> bar)
    {
        // Declare a dictionary to count the occurence of the items in the collection
        Dictionary<T, int> itemCounts = new Dictionary<T,int>();

        // Increase the count for each occurence of the item in the first collection
        foreach (T item in foo)
        {
            if (itemCounts.ContainsKey(item))
            {
                itemCounts[item]++;
            }
            else
            {
                itemCounts[item] = 1;
            }
        }

        // Wrap the keys in a searchable list
        List<T> keys = new List<T>(itemCounts.Keys);

        // Decrease the count for each occurence of the item in the second collection
        foreach (T item in bar)
        {
            // Try to find a key for the item
            // The keys of a dictionary are compared by reference, so we have to
            // find the original key that is equivalent to the "item"
            // You may want to override ".Equals" to define what it means for
            // two "T" objects to be equal
            T key = keys.Find(
                delegate(T listKey)
                {
                    return listKey.Equals(item);
                });

            // Check if a key was found
            if(key != null)
            {
                itemCounts[key]--;
            }
            else
            {
                // There was no occurence of this item in the first collection, thus the collections are not equal
                return false;
            }
        }

        // The count of each item should be 0 if the contents of the collections are equal
        foreach (int value in itemCounts.Values)
        {
            if (value != 0)
            {
                return false;
            }
        }

        // The collections are equal
        return true;
    }
} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-10-04T04:38:31.400

您可以使用[Hashset](http://msdn.microsoft.com/en-us/library/bb359438.aspx)。查看[SetEquals](http://msdn.microsoft.com/en-us/library/bb346516.aspx)方法。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2016-06-24T00:18:20.427

```
static bool SetsContainSameElements<T>(IEnumerable<T> set1, IEnumerable<T> set2) {
    var setXOR = new HashSet<T>(set1);
    setXOR.SymmetricExceptWith(set2);
    return (setXOR.Count == 0);
} 
```

解决方案需要 .NET 3.5 和`System.Collections.Generic`命名空间。[根据 Microsoft](https://msdn.microsoft.com/en-us/library/bb336848.aspx)的说法，`SymmetricExceptWith`是一个*O(n + m)*操作，其中*n*表示第一个集合中的元素数，*m*表示第二个集合中的元素数。如有必要，您始终可以向此函数添加相等比较器。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2017-11-14T15:09:18.637

如果您使用[Shouldly](https://shouldly.readthedocs.io)，则可以将 ShouldAllBe 与 Contains 一起使用。

```
collection1 = {1, 2, 3, 4};
collection2 = {2, 4, 1, 3};

collection1.ShouldAllBe(item=>collection2.Contains(item)); // true 
```

最后，您可以编写扩展程序。

```
public static class ShouldlyIEnumerableExtensions
{
    public static void ShouldEquivalentTo<T>(this IEnumerable<T> list, IEnumerable<T> equivalent)
    {
        list.ShouldAllBe(l => equivalent.Contains(l));
    }
} 
```

**更新**

**ShouldBe**方法上有一个可选参数。

```
collection1.ShouldBe(collection2, ignoreOrder: true); // true 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-06-18T23:20:02.803

编辑：我一提出就意识到这真的只适用于集合——它不能正确处理具有重复项目的集合。例如 { 1, 1, 2 } 和 { 2, 2, 1 } 从该算法的角度来看将被视为相等。但是，如果您的集合是集合（或者可以通过这种方式衡量它们的相等性），我希望您发现以下内容很有用。

我使用的解决方案是：

```
return c1.Count == c2.Count && c1.Intersect(c2).Count() == c1.Count; 
```

Linq 在幕后做字典的事情，所以这也是 O(N)。（注意，如果集合大小不同，则为 O(1)）。

我使用 Daniel 建议的“SetEqual”方法、Igor 建议的 OrderBy/SequenceEquals 方法以及我的建议进行了完整性检查。结果如下，显示了 Igor 的 O(N*LogN) 和我的和 Daniel 的 O(N)。

我认为 Linq 相交代码的简单性使其成为更可取的解决方案。

```
__Test Latency(ms)__
N, SetEquals, OrderBy, Intersect    
1024, 0, 0, 0    
2048, 0, 0, 0    
4096, 31.2468, 0, 0    
8192, 62.4936, 0, 0    
16384, 156.234, 15.6234, 0    
32768, 312.468, 15.6234, 46.8702    
65536, 640.5594, 46.8702, 31.2468    
131072, 1312.3656, 93.7404, 203.1042    
262144, 3765.2394, 187.4808, 187.4808    
524288, 5718.1644, 374.9616, 406.2084    
1048576, 11420.7054, 734.2998, 718.6764    
2097152, 35090.1564, 1515.4698, 1484.223 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2010-04-01T23:51:23.167

在没有重复和没有顺序的情况下，可以使用以下 EqualityComparer 来允许集合作为字典键：

```
public class SetComparer<T> : IEqualityComparer<IEnumerable<T>> 
where T:IComparable<T>
{
    public bool Equals(IEnumerable<T> first, IEnumerable<T> second)
    {
        if (first == second)
            return true;
        if ((first == null) || (second == null))
            return false;
        return first.ToHashSet().SetEquals(second);
    }

    public int GetHashCode(IEnumerable<T> enumerable)
    {
        int hash = 17;

        foreach (T val in enumerable.OrderBy(x => x))
            hash = hash * 23 + val.GetHashCode();

        return hash;
    }
} 
```

[这](http://team.pushbomb.com/2008/09/08/the_fastest_dot_net_hash_set_collection_with_linq_extended_features/)是我使用的 ToHashSet() 实现。[哈希码算法](https://stackoverflow.com/questions/263400/what-is-the-best-algorithm-for-an-overridden-system-object-gethashcode/263416#263416)来自 Effective Java（通过 Jon Skeet）。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2011-08-08T16:06:15.003

为什么不使用 .Except()

```
// Create the IEnumerable data sources.
string[] names1 = System.IO.File.ReadAllLines(@"../../../names1.txt");
string[] names2 = System.IO.File.ReadAllLines(@"../../../names2.txt");
// Create the query. Note that method syntax must be used here.
IEnumerable<string> differenceQuery =   names1.Except(names2);
// Execute the query.
Console.WriteLine("The following lines are in names1.txt but not names2.txt");
foreach (string s in differenceQuery)
     Console.WriteLine(s); 
```

[http://msdn.microsoft.com/en-us/library/bb397894.aspx](http://msdn.microsoft.com/en-us/library/bb397894.aspx)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-04-29T20:35:22.600

各种各样的重复帖子，但[请查看我的解决方案来比较集合](http://robertbouillon.com/2010/04/29/comparing-collections-in-net/)。这很简单：

无论顺序如何，这将执行相等比较：

```
var list1 = new[] { "Bill", "Bob", "Sally" };
var list2 = new[] { "Bob", "Bill", "Sally" };
bool isequal = list1.Compare(list2).IsSame; 
```

这将检查是否添加/删除了项目：

```
var list1 = new[] { "Billy", "Bob" };
var list2 = new[] { "Bob", "Sally" };
var diff = list1.Compare(list2);
var onlyinlist1 = diff.Removed; //Billy
var onlyinlist2 = diff.Added;   //Sally
var inbothlists = diff.Equal;   //Bob 
```

这将看到字典中的哪些项目发生了变化：

```
var original = new Dictionary<int, string>() { { 1, "a" }, { 2, "b" } };
var changed = new Dictionary<int, string>() { { 1, "aaa" }, { 2, "b" } };
var diff = original.Compare(changed, (x, y) => x.Value == y.Value, (x, y) => x.Value == y.Value);
foreach (var item in diff.Different)
  Console.Write("{0} changed to {1}", item.Key.Value, item.Value.Value);
//Will output: a changed to aaa 
```

原帖[在这里](https://stackoverflow.com/questions/43500/is-there-a-built-in-method-to-compare-collections-in-c/2740552#2740552)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-03-11T21:01:59.863

这是我的 ohadsc 答案的扩展方法变体，以防它对某人有用

```
static public class EnumerableExtensions 
{
    static public bool IsEquivalentTo<T>(this IEnumerable<T> first, IEnumerable<T> second)
    {
        if ((first == null) != (second == null))
            return false;

        if (!object.ReferenceEquals(first, second) && (first != null))
        {
            if (first.Count() != second.Count())
                return false;

            if ((first.Count() != 0) && HaveMismatchedElement<T>(first, second))
                return false;
        }

        return true;
    }

    private static bool HaveMismatchedElement<T>(IEnumerable<T> first, IEnumerable<T> second)
    {
        int firstCount;
        int secondCount;

        var firstElementCounts = GetElementCounts<T>(first, out firstCount);
        var secondElementCounts = GetElementCounts<T>(second, out secondCount);

        if (firstCount != secondCount)
            return true;

        foreach (var kvp in firstElementCounts)
        {
            firstCount = kvp.Value;
            secondElementCounts.TryGetValue(kvp.Key, out secondCount);

            if (firstCount != secondCount)
                return true;
        }

        return false;
    }

    private static Dictionary<T, int> GetElementCounts<T>(IEnumerable<T> enumerable, out int nullCount)
    {
        var dictionary = new Dictionary<T, int>();
        nullCount = 0;

        foreach (T element in enumerable)
        {
            if (element == null)
            {
                nullCount++;
            }
            else
            {
                int num;
                dictionary.TryGetValue(element, out num);
                num++;
                dictionary[element] = num;
            }
        }

        return dictionary;
    }

    static private int GetHashCode<T>(IEnumerable<T> enumerable)
    {
        int hash = 17;

        foreach (T val in enumerable.OrderBy(x => x))
            hash = hash * 23 + val.GetHashCode();

        return hash;
    }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-05-29T18:27:18.110

这是一个比[这个](https://stackoverflow.com/questions/4042101/net-check-if-two-ienumerablet-have-the-same-elements)改进的解决方案。

```
public static bool HasSameElementsAs<T>(
        this IEnumerable<T> first, 
        IEnumerable<T> second, 
        IEqualityComparer<T> comparer = null)
    {
        var firstMap = first
            .GroupBy(x => x, comparer)
            .ToDictionary(x => x.Key, x => x.Count(), comparer);

        var secondMap = second
            .GroupBy(x => x, comparer)
            .ToDictionary(x => x.Key, x => x.Count(), comparer);

        if (firstMap.Keys.Count != secondMap.Keys.Count)
            return false;

        if (firstMap.Keys.Any(k1 => !secondMap.ContainsKey(k1)))
            return false;

        return firstMap.Keys.All(x => firstMap[x] == secondMap[x]);
    } 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-08T17:05:45.740

[埃里克森](https://stackoverflow.com/users/3474/erickson)几乎是对的：既然你想匹配重复的数量，你需要一个[Bag](http://commons.apache.org/collections/api-3.1/org/apache/commons/collections/HashBag.html)。在 Java 中，这看起来像：

```
(new HashBag(collection1)).equals(new HashBag(collection2)) 
```

我确信 C# 有一个内置的 Set 实现。我会先使用它；如果性能有问题，您总是可以使用不同的 Set 实现，但使用相同的 Set 接口。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-11T20:20:47.660

这个问题有很多解决方案。如果您不关心重复项，则不必对两者进行排序。首先确保它们具有相同数量的项目。在排序之后的集合之一。然后对排序集合中的第二个集合中的每个项目进行 binsearch。如果您没有找到给定的项目，请停止并返回 false。其复杂性： - 对第一个集合进行排序：N *Log(N) - 从第二个到第一个搜索每个项目：N*LOG(N) 所以你最终得到 2*N*LOG(N) 假设它们匹配并且你查找所有内容。这类似于对两者进行排序的复杂性。如果有差异，这也可以让您提前停止。但是，请记住，如果在您进入此比较之前对两者都进行了排序，并且您尝试使用 qsort 之类的东西进行排序，那么排序将更加昂贵。对此进行了优化。另一种选择是使用位掩码索引，这对于您知道元素范围的小型集合非常有用。这将为您提供 O(n) 性能。另一种选择是使用散列并查找它。对于小型集合，进行排序或位掩码索引通常要好得多。Hashtable 的缺点是局部性较差，因此请记住这一点。再说一次，只有你不这样做 不关心重复。如果要考虑重复项，请对两者进行排序。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-08-30T23:30:19.573

在许多情况下，唯一合适的答案是 Igor Ostrovsky 之一，其他答案基于对象哈希码。但是，当您为对象生成哈希码时，您只能基于他的 IMMUTABLE 字段 - 例如对象 Id 字段（在数据库实体的情况下） - [为什么在重写 Equals 方法时重写 GetHashCode 很重要？](https://stackoverflow.com/questions/371328/why-is-it-important-to-override-gethashcode-when-equals-method-is-overridden)

这意味着，如果您比较两个集合，即使不同项目的字段不相等，compare 方法的结果也可能为真。要深入比较集合，您需要使用 Igor 的方法并实现 IEqualirity 。

请阅读我和施奈德先生对他投票最多的帖子的评论。

詹姆士

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-08-09T20:07:31.597

允许在`IEnumerable<T>`（如果集合不可取\可能）和“忽略顺序”中重复，您应该能够使用`.GroupBy()`.

我不是复杂性测量方面的专家，但我的基本理解是这应该是 O(n)。我理解 O(n^2) 来自于在另一个 O(n) 操作中执行 O(n) 操作，例如`ListA.Where(a => ListB.Contains(a)).ToList()`. ListB 中的每个项目都与 ListA 中的每个项目进行相等性评估。

就像我说的，我对复杂性的理解是有限的，如果我错了，请纠正我。

```
public static bool IsSameAs<T, TKey>(this IEnumerable<T> source, IEnumerable<T> target, Expression<Func<T, TKey>> keySelectorExpression)
    {
        // check the object
        if (source == null && target == null) return true;
        if (source == null || target == null) return false;

        var sourceList = source.ToList();
        var targetList = target.ToList();

        // check the list count :: { 1,1,1 } != { 1,1,1,1 }
        if (sourceList.Count != targetList.Count) return false;

        var keySelector = keySelectorExpression.Compile();
        var groupedSourceList = sourceList.GroupBy(keySelector).ToList();
        var groupedTargetList = targetList.GroupBy(keySelector).ToList();

        // check that the number of grouptings match :: { 1,1,2,3,4 } != { 1,1,2,3,4,5 }
        var groupCountIsSame = groupedSourceList.Count == groupedTargetList.Count;
        if (!groupCountIsSame) return false;

        // check that the count of each group in source has the same count in target :: for values { 1,1,2,3,4 } & { 1,1,1,2,3,4 }
        // key:count
        // { 1:2, 2:1, 3:1, 4:1 } != { 1:3, 2:1, 3:1, 4:1 }
        var countsMissmatch = groupedSourceList.Any(sourceGroup =>
                                                        {
                                                            var targetGroup = groupedTargetList.Single(y => y.Key.Equals(sourceGroup.Key));
                                                            return sourceGroup.Count() != targetGroup.Count();
                                                        });
        return !countsMissmatch;
    } 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-12-19T19:20:04.697

[这个简单的解决方案](https://stackoverflow.com/a/50177/4348580)强制实现[`IEnumerable`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.ienumerable-1)的泛型类型[`IComparable`](https://docs.microsoft.com/en-us/dotnet/api/system.icomparable)。因为 [`OrderBy`](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.orderby#System_Linq_Enumerable_OrderBy__2_System_Collections_Generic_IEnumerable___0__System_Func___0___1__)' 的定义。

如果您不想做出这样的假设但仍想使用此解决方案，则可以使用以下代码：

```
bool equal = collection1.OrderBy(i => i?.GetHashCode())
   .SequenceEqual(collection2.OrderBy(i => i?.GetHashCode())); 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-08-26T20:29:41.493

如果出于单元测试断言的目的进行比较，那么在进行比较之前将一些效率抛到窗外并简单地将每个列表转换为字符串表示形式 (csv) 可能是有意义的。这样，默认的测试断言消息将显示错误消息中的差异。

用法：

```
using Microsoft.VisualStudio.TestTools.UnitTesting;

// define collection1, collection2, ...

Assert.Equal(collection1.OrderBy(c=>c).ToCsv(), collection2.OrderBy(c=>c).ToCsv()); 
```

助手扩展方法：

```
public static string ToCsv<T>(
    this IEnumerable<T> values,
    Func<T, string> selector,
    string joinSeparator = ",")
{
    if (selector == null)
    {
        if (typeof(T) == typeof(Int16) ||
            typeof(T) == typeof(Int32) ||
            typeof(T) == typeof(Int64))
        {
            selector = (v) => Convert.ToInt64(v).ToStringInvariant();
        }
        else if (typeof(T) == typeof(decimal))
        {
            selector = (v) => Convert.ToDecimal(v).ToStringInvariant();
        }
        else if (typeof(T) == typeof(float) ||
                typeof(T) == typeof(double))
        {
            selector = (v) => Convert.ToDouble(v).ToString(CultureInfo.InvariantCulture);
        }
        else
        {
            selector = (v) => v.ToString();
        }
    }

    return String.Join(joinSeparator, values.Select(v => selector(v)));
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-05-11T11:49:51.063

基于这个重复问题的[答案](https://stackoverflow.com/a/3670082/379279)，以及答案下方的评论，以及@brian-genisio 的[答案](https://stackoverflow.com/a/3669985/379279)，我想出了这些：

```
 public static bool AreEquivalentIgnoringDuplicates<T>(this IEnumerable<T> items, IEnumerable<T> otherItems)
        {
            var itemList = items.ToList();
            var otherItemList = otherItems.ToList();
            var except = itemList.Except(otherItemList);
            return itemList.Count == otherItemList.Count && except.IsEmpty();
        }

        public static bool AreEquivalent<T>(this IEnumerable<T> items, IEnumerable<T> otherItems)
        {
            var itemList = items.ToList();
            var otherItemList = otherItems.ToList();
            var except = itemList.Except(otherItemList);
            return itemList.Distinct().Count() == otherItemList.Count && except.IsEmpty();
        } 
```

测试这两个：

```
 [Test]
        public void collection_with_duplicates_are_equivalent()
        {
            var a = new[] {1, 5, 5};
            var b = new[] {1, 1, 5};

            a.AreEquivalentIgnoringDuplicates(b).ShouldBe(true); 
        }

        [Test]
        public void collection_with_duplicates_are_not_equivalent()
        {
            var a = new[] {1, 5, 5};
            var b = new[] {1, 1, 5};

            a.AreEquivalent(b).ShouldBe(false); 
        } 
```

# sql - 寻找 SQL 事务日志文件查看器

> ID：50106
> 
> 赞同：23
> 
> 时间：2008-09-08T16:38:36.803
> 
> 标签：sql, sql-server, logging, transactions

如果你们中的任何人使用过一个很酷的工具来查看/查询 SQL 事务日志，请告诉我。这应该显示所有已提交或回滚的事务性 sql 语句。

对于数据库文件，如果它具有一些额外的图形功能，例如显示索引的内部二叉树结构，那将是很棒的，但我想我要求太多了。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-08T16:43:07.277

这仅在您使用 SQL Server 2000 时才有意义，但 RedGate 制作了一个名为[SQL Log Rescue](http://www.red-gate.com/products/SQL_Log_Rescue/index.htm)的免费工具。否则，对于 SQL Server 2005 ，来自 ApexSQL 的[ApexSQLLog](http://www.apexsql.com/sql_tools_log.asp)是我知道的唯一其他产品

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-08T16:46:08.047

您可以使用未记录的[DBCC LOG 命令。](http://searchsqlserver.techtarget.com/tip/1,289483,sid87_gci1173464,00.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-08T16:47:38.293

Lumigent 有一个名为“Log Explorer”的商业产品。每个座位 995 美元，但应该可以满足您的基本要求。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-09-29T18:56:02.770

你可以使用这个查询：

```
Select * from ::fn_dblog(null,null) 
```

或查看此链接：[如何查看 SQL Server 2005 事务日志文件](https://stackoverflow.com/questions/4153514/how-can-i-view-sql-server-2005-transaction-log-file/19081839#19081839)

或此链接：[您如何解码事务日志中的简单条目？](http://sqlfascination.com/2010/02/03/how-do-you-decode-a-simple-entry-in-the-transaction-log-part-1/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T16:50:11.953

有一些公司生产日志阅读器，如 Lumigent 和 Red Gate。但是，由于基础系统表和数据类型中的元数据更改，它们不适用于大于 2000 的 SQL Server 版本，如果您不使用任何新功能但如果您使用 varchar(max) XML 数据类型等，它们可能会起作用不走运

# wcf - WCF 是提高标准还是仅仅提高了复杂性水平？

> ID：50114
> 
> 赞同：84
> 
> 时间：2008-09-08T16:42:21.130
> 
> 标签：wcf, web-services

我了解 WCF 提供的三部分服务/主机/客户端模型的价值。但它只是我还是看起来像 WCF 采取了一些非常直接和直接的东西（ASMX 模型）并把它弄得一团糟？

是否有替代使用 SvcUtil 的命令行回退来生成代理的替代方法？使用 ASMX 服务会自动提供测试工具；今天有 WCF 的好选择吗？

我很欣赏 WS* 的东西与 WCF 更紧密地集成在一起，并希望在那里为 WCF 找到一些回报，但是哎呀，否则我很困惑。

此外，可用于 WCF 的书籍的状态充其量也很糟糕。Juval Lowy 是一位出色的作者，他写了一本很好的 O'Reilly 参考书“Programming WCF Services”，但它对于现在学习使用 WCF 并没有多大作用（无论如何对我来说）。这本书的前身（作为教程组织得更好，但不多）是 Michele Leroux Bustamante 的 Learning WCF。它有很好的地方，但已经过时了，相应的网站也不见了。

除了继续用谷歌搜索bejebus之外，你还有很好的WCF学习参考吗？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-05-18T13:04:09.460

好的，我们开始吧。首先，Michele Leroux Bustamante 的书已针对 VS2008 进行了更新。这本书的网站没有消失。它现在就启动了，它有很多很棒的 WCF 信息。在那个网站上，她为她书中的所有示例提供了与 VS2008 兼容的更新代码。如果您从亚马逊订购，您将获得更新的重印本。

WCF*不仅*是 ASMX 的替代品。当然它可以（并且做得很好）取代 ASMX，但真正的好处是它允许您的服务是自托管的。WSE 的大部分功能从一开始就已经融入其中。该框架是*高度*可配置的，并且通过多种协议为多个端点提供服务的能力令人惊叹，IMO。

虽然您仍然可以从“添加服务引用”选项生成代理类，但这不是必需的。您真正需要做的就是复制您的 ServiceContract 接口并告诉您的代码在哪里可以找到服务的端点，仅此而已。您可以使用很少的代码从服务中调用方法。使用此方法，您可以完全控制实施。无论您选择哪种方法来生成代理类，Michele 在她关于该主题的**出色**网络广播系列中都展示并使用了这两种方法。

Michele 有很多很棒的材料，我建议你查看她的网站。在我学习 WCF 时，这里有一些对我非常有帮助的链接。我希望您会意识到 WCF 的真正强大之处，以及实现它的难易程度。学习曲线有点陡峭，但你的时间投资回报是值得的：

*   Michele 的网络广播： [http ://www.dasblonde.net/2007/06/24/WCFWebcastSeries.aspx](http://www.dasblonde.net/2007/06/24/WCFWebcastSeries.aspx)
*   Michele 的图书网站（针对 VS2008 进行了更新和更新）： [http ://www.thatindigogirl.com/](http://www.thatindigogirl.com/)

我建议您至少观看 1 个 Michele 的网络广播。她是一位非常有效率的演讲者，而且她在 WCF 方面的知识显然令人难以置信。她在从头开始揭开 WCF 内部运作的神秘面纱方面做得很好。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-10T22:53:00.290

我通常使用 Google 来查找我的 WCF 答案，并且通常会在以下博客上找到自己：

**包含有价值的 WCF 文章的博客**

*   [http://blogs.msdn.com/drnick/default.aspx](http://blogs.msdn.com/drnick/default.aspx)
*   [http://blogs.msdn.com/wenlong/default.aspx](http://blogs.msdn.com/wenlong/default.aspx)
*   [http://blogs.thinktecture.com/buddhike/](http://blogs.thinktecture.com/buddhike/)
*   [http://www.dasblonde.net/default.aspx](http://www.dasblonde.net/default.aspx)

**我发现的其他有价值的文章**

*   [http://blogs.conchango.com/pauloreichert/archive/2007/02/22/WCF-Reliable-Sessions-Puzzle.aspx](http://blogs.conchango.com/pauloreichert/archive/2007/02/22/WCF-Reliable-Sessions-Puzzle.aspx)
*   [http://blogs.msdn.com/salvapatuel/archive/2007/04/25/why-using-is-bad-for-your-wcf-service-host.aspx](http://blogs.msdn.com/salvapatuel/archive/2007/04/25/why-using-is-bad-for-your-wcf-service-host.aspx)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-08T16:14:52.203

我很难确定何时应该或将使用 WCF。为什么？因为我把生产力和简单性放在我的清单上。为什么 ASMX 模型如此成功，因为它有效，而且您可以让它快速运作。在 VS 2005 和 .NET 2.0 中，wsdl.exe 提供了相当不错且合规的服务。

在现实生活中，您的架构中应该只有很少的通信协议。这使它保持简单和可维护。如果您需要访问遗留系统，请为它们编写特定的适配器，这样它们就可以在光鲜亮丽的 SOA 世界中发挥作用。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-26T10:29:06.950

WCF 比 ASMX 强大得多，它以多种方式对其进行了扩展。ASMX 仅限于 HTTP，而 WCF 可以使用多种协议进行通信（当然，HTTP 仍然是大多数人使用它的方式，至少对于需要互操作的服务而言）。WCF 也更容易扩展。至少，可以以 ASMX 无法扩展的方式对其进行扩展。“容易”可能会拉伸它。=)

在我看来，WCF 提供的附加功能远远超过了它所增加的复杂性。我也觉得编程模型更容易。例如，DataContracts 比必须使用带有公共属性的 XML 序列化来进行序列化要好得多。它在本质上也更具声明性，这也很好。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-08T17:13:37.297

等等......你有没有使用过.NET Remoting，因为那是它所取代的真实东西。.NET Remoting 本身就相当复杂。我发现 WCF 更容易且布局更好。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-08T16:53:10.713

我没有看到它经常被提及，但是您仍然**可以**使用 WCF 实现相当简单的服务，非常类似于 ASMX 服务。例如：

```
[ServiceContract]
[AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Allowed)]
public class SimpleService
{
    [OperationContract]
    public string HelloWorld()
    {
        return "Hello World";
    }

} 
```

您仍然需要在 web.config 中注册端点，但这还不错。

消除分离的数据、服务和操作合同的冗长对于使 WCF 对我来说更易于管理大有帮助。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-26T10:45:59.000

VS2008 包含“添加服务引用”上下文菜单项，它将在幕后为您创建代理。

如前所述，WCF 不仅仅旨在替代 ASMX Web 服务类型，而是为所有可互操作的服务（无论是通过 HTTP、tcp、命名管道还是 MSMQ 传输）提供一致、安全和可扩展的方法。

我承认我在 WCF 方面确实存在其他问题（例如，在通过 basicHTTP 公开服务时重写方法签名 - 请参见[此处](https://stackoverflow.com/questions/5863/c-wcf-service-backward-compatibility-issue)，但总体而言，我认为这是一个明确的改进

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-26T10:33:11.327

如果您使用的是 VS2008 并创建了一个 WCF 项目，那么当您点击运行/调试时，您会自动获得一个测试工具，并且您可以添加引用而无需使用 svcutil。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-10T23:10:53.313

我最初对 WCF 的想法是完全一样的！以下是一些解决方案：

1.  利用泛型编写您自己的代理/客户端层（请参阅类[ClientBase](http://msdn.microsoft.com/en-us/library/ms576141.aspx)和 Binding）。我发现这很容易上手，但很难完美。
2.  使用 1 的第三方实现（[SoftwareIsHardwork](http://www.codeplex.com/SoftwareIsHardwork)是我目前最喜欢的）

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-05-05T21:25:30.697

**WCF**是Microsoft早期所有**Web 服务**技术的替代品。它还比传统上认为的“Web 服务”做得更多。

WCF“Web 服务”是通过 WCF 实现的更广泛的远程通信的一部分。您将在 WCF 中获得比通过传统 ASMX 更高程度的灵活性和可移植性，因为 WCF 从头开始​​设计，总结了 Microsoft 提供的所有不同的分布式编程基础结构。WCF 中的端点可以通过 SOAP/XML 与通过 TCP/二进制文件一样容易地进行通信，并且更改此介质只需一个配置文件 mod。理论上，这减少了移植或更改业务需求、目标等时所需的新代码量。

`ASMX is older than WCF, and anything ASMX can do so can WCF (and more)`. 基本上，您可以将 WCF 视为试图将在 Microsoft 世界中让两个应用程序进行通信的所有不同方式逻辑地组合在一起；ASMX 只是众多方式中的一种，因此现在归入 WCF 功能的保护伞下。

Web 服务只能通过 HTTP 访问，它可以在无状态环境中工作，WCF 是灵活的，因为它的服务可以托管在不同类型的应用程序中。托管 WCF 服务的常见方案是 IIS、WAS、自托管、托管 Windows 服务。

主要区别在于 Web 服务使用 XmlSerializer。但是 WCF 使用 DataContractSerializer，与 XmlSerializer 相比，它的性能更好。

**什么情况下必须使用WCF**

*   用于处理业务交易的安全服务。一项服务
*   向他人提供当前数据，例如交通报告或其他
*   监控服务。允许两个人聊天的聊天服务
*   实时通信或交换数据。仪表板应用程序
*   轮询一个或多个服务以获取数据并以逻辑方式呈现
*   介绍。公开使用 Windows Workflow 实现的工作流
*   Foundation 作为 WCF 服务。用于轮询的 Silverlight 应用程序
*   提供最新数据源的服务。

**WCF的特点**

*   服务导向
*   互操作性
*   多种消息模式
*   服务元数据
*   数据合同
*   安全
*   多种传输和编码
*   可靠和排队的消息
*   持久消息
*   交易
*   AJAX 和 REST 支持
*   可扩展性

* * *

来源：[主要文本来源](http://www.codeproject.com/Articles/139787/What-s-the-Difference-between-WCF-and-Web-Services)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-08T16:45:47.050

微软？我通常对图书馆参考本身做得很好，我通常希望在那里找到有价值的文章。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-08T17:11:03.637

就它提供的功能而言，我认为答案是兼容性。ASMX 服务非常微软化。并不是说他们没有尝试与其他消费者兼容；但除了 ASP.NET 网页和其他一些自定义 Microsoft 消费者之外，该模型并不能很好地适应。而 WCF，由于其体系结构，允许您的服务在通常的 SOAP 之外具有非常开放的基于标准的端点，例如 REST、JSON 等。其他人使用 WCF 服务可能比使用 ASMX 服务更容易。

（这基本上都是从比较MSDN阅读中推断出来的，所以知道更多的人应该随时纠正我。）

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-08T19:52:13.260

不应将 WCF 视为 ASMX 的替代品。从它的定位以及它在微软内部的使用方式来看，它确实是一个基础架构，可用于任何类型的跨界通信。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-08T20:13:12.080

我相信 WCF 确实在很多方面推动了 ASMX Web 服务的实现。首先，它提供了一个非常好的分层对象模型，有助于隐藏分布式应用程序的内在复杂性。其次，您可以拥有更多的请求-重放消息模式，包括从服务器到客户端的异步通知（纯 HTTP 不可能），第三，从 XML 消息中抽象出底层传输协议，从而优雅地支持 HTTP、HTTPS、TCP 等。与“第一代”Web 服务的向后兼容性也是一个优势。WCF 使用 XML 标准作为内部表示格式。这可能被视为优势或劣势，尤其是在 JSON 等“XML 的无脂肪替代品”日益流行的情况下。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-31T20:16:11.793

我发现 WCF 的困难之处在于管理客户端和服务器的配置，以及对不太好的故障状态异常进行故障排除。

如果有人有任何捷径或提示，那就太好了。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-03-11T09:09:00.640

我觉得那很痛苦；因为我在两端都有.NET，在两端都加载了相同的“合同”dll，等等。但是我不得不处理很多细节，比如“KnownType”属性。

WCF 还默认只允许 1 或 2 个客户端连接到服务，直到您更改大量配置。从代码更改配置并不容易，不能选择发送大量配置文件，因为很难将我们的更改合并到客户在升级时可能所做的任何更改中（我们也不希望客户玩 WCF 设置！）

.NET 远程处理在大多数情况下都可以正常工作。

我认为试图**假装**.NET 到 .NET 基于对象的通信与将文本 (xml) 的位发送到未知系统相同，这太过分了。

（有几次我们使用 WCF 与 Java 系统对话，我们发现 Java 系统给出的 XSD 与它想要的 XML 不匹配，因此不得不手动编写很多 XML 映射。）

# javascript - 使用 shadowbox 禁用键盘快捷键？

> ID：50115
> 
> 赞同：3
> 
> 时间：2008-09-08T16:42:31.787
> 
> 标签：javascript, keyboard-shortcuts, mootools

所以我的网站使用[shadowbox](http://mjijackson.com/shadowbox/)来显示一些动态文本。问题是我需要用户能够复制和粘贴该文本。

右键单击并选择复制有效，但`Ctrl`+`C`无效（没有键盘快捷键）并且大多数人使用`Ctrl`+ `C`？[你可以看到我在这里](http://mjijackson.com/shadowbox/)谈论的一个例子。

只需转到“网络”示例并单击“内联”即可。请注意，键盘快捷键确实适用于“此页面”示例。我看到的两者之间的唯一区别是他们使用的播放器 js 文件。“内联”使用 html.js 播放器，“本页”使用 iframe.js。另外，我相信它使用了 mootools 库。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-12T02:32:50.233

最好的选择是通过将“enableKeys”选项设置为 false 来禁用 shadowbox 中的键盘导航快捷键（请参阅[此页面](http://mjijackson.com/shadowbox/doc/api.html)）。

或者，您可以按照 Robby 的建议执行并修改 shadowbox.js 文件，**但只有在您需要使用 shadowbox 键盘导航时才这样做**。我认为您想搜索此代码块并对其进行修改，以便仅在使用其中一个快捷方式时取消默认事件（我添加了一些换行符和缩进）：

```
var handleKey=function(e){
    var code=SL.keyCode(e);
    SL.preventDefault(e);
    if(code==81||code==88||code==27){
        SB.close()
    }else{
        if(code==37){
            SB.previous()
        }else{
            if(code==39){
                SB.next()
            }else{
                if(code==32){
                    SB[(typeof slide_timer=="number"?"pause":"play")]()
                }
            }
        }
    }
}; 
```

我认为您可以将其更改为更像这样：

```
var handleKey=function(e){
    switch(SL.keyCode(e)) {
        case 81:
        case 88:
        case 27:
            SB.close()
            SL.preventDefault(e);
            break;

        case 37:
            SB.previous()
            SL.preventDefault(e);
            break;

        case 39:
            SB.next()
            SL.preventDefault(e);
            break;

        case 32:
            SB[(typeof slide_timer=="number"?"pause":"play")]()
            SL.preventDefault(e);
            break;
    }
}; 
```

这应该可以防止 shadowbox 事件处理程序吞下它不关心的任何击键。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T01:03:10.637

这个问题是由一些吃键盘事件的 JavaScript 引起的。例如，您可以点击转义键，该键被 .js 文件之一捕获并导致阴影框关闭。

您的选择是破解文件并找到问题，或者不使用 shadowbox。祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-24T17:07:34.313

解决方案是将 enableKeys 选项设置为 false。但是，这似乎不适用于内联 HTML 的 open() 调用。但是，如果您在 init() 调用中设置它，它确实有效。

# c++ - (Visual) C++ 的数据库抽象层

> ID：50120
> 
> 赞同：3
> 
> 时间：2008-09-08T16:45:24.460
> 
> 标签：c++, database

从 C++ 访问不同的数据库有哪些选择？换句话说，ADO 有哪些替代方案？优缺点都有什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-08T17:05:03.650

1.  [微软 ODBC](http://msdn.microsoft.com/en-us/library/ms710252.aspx)。
2.  MFC ODBC 类，例如[CDatabase](http://msdn.microsoft.com/en-us/library/2dhc1abk.aspx)。
3.  [OleDB](http://msdn.microsoft.com/en-us/library/ms722784.aspx)（通过 COM）。
4.  而且您始终可以通过每个 RDBMS 本地库（例如，[SQL Server 本地库](http://msdn.microsoft.com/en-us/library/ms722784.aspx)）
5.  [DAO](http://msdn.microsoft.com/en-us/library/aa163992.aspx)（不要）。
6.  第 3 方 ORM 提供商。

我建议默认通过 ODBC 或 OleDB。原生库确实限制了你，DAO 并不好玩，C++/Windows 上没有很多很棒的 3rd-party ORM。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-18T14:57:04.043

尽管这个问题及其答案已经有好几年的历史了，但对于像我这样在评估之旅中巡游的人来说，它们仍然很有价值。出于这个原因，我想添加 Qt C++ 框架的`QtSql`模块作为数据库连接的选项。

请注意，我一般熟悉 Qt，但没有`QtSql`特别的经验。

**优点（如果您只是为其 QtSql 模块选择 Qt，也应该适用一些优点）：** Qt 是跨平台的。以我的经验，Qt 设计精良，使用起来非常直观，并且文档记录非常完善。它已经存在了很长时间，由一个活跃的社区维护并得到诺基亚的支持，因此它不会在一夜之间变得不可用。自 2009 年以来，Qt 已获得 LGPL 许可，因此即使对于商业应用程序，它也是一个真正的免费选择。

**缺点：** Qt 并不小。您将引入新类型，例如`QString`您的项目。Qt 是在 LGPL 下获得许可的，因此即使在商业应用程序中也需要确认它的使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-08T19:05:27.167

一件事 - 如果速度很重要并且您的代码不需要可移植，那么使用本机库可能是值得的。

我对 SQL Server 了解不多，但我知道 Oracle OCI 调用比使用 ODBC 更快。但是，它们将您绑定到 Oracle 的 SQL 版本。SQL Server 以同样的方式是有意义的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T21:33:27.893

有[POCO](http://pocoproject.org/poco/wiki/tiki-index.php?page=DataUserManual)数据库，它支持 ODBC、MySQL 和 SQLite。免费开源[POCO C++ 库](http://pocoproject.org)的一部分。

# licensing - 是否听说过收购时的许可证转让费？

> ID：50121
> 
> 赞同：3
> 
> 时间：2008-09-08T16:45:40.717
> 
> 标签：licensing

我的雇主最近被一家更大的公司收购。在整理我们开发软件许可证的所有法律细节的过程中，我们了解到，我们的 IDE 供应商收取新许可证成本 25% 的“名义”费用，以将我们现有的许可证转移到新的公司名称。

这让我觉得很荒谬。我还没有从任何其他供应商那里看到这种对客户不友好的政策。有没有其他人见过这种类型的政策？考虑到这种不友好和不正常的情况，我是否离谱？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-08T16:50:07.273

不友好？是的。异常的？不。实际上，对于每席位许可费用高昂的工具，在购买后收取转让费用是很常见的。我相信他们这样做是因为他们可以：转让许可证的成本要么在并购尽职调查期间被忽视，要么被认为与其他成本相比无关紧要。

工具供应商证明了这笔费用是合理的，因为他们现在少了一个潜在客户，而且由于批量折扣，合并后的公司将支付较低的每个座位的价格。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T16:50:32.530

我会说你不是，我以前从未见过这样的做法。

编辑：嗯，我一定很幸运，似乎很常见。很高兴我以前没有遇到过这个:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T16:51:33.057

我以前听说过一些高端图形软件，但这也是在 1990 年代，只有在您将许可证出售给其他人时才适用。

但是，将 25% 的新许可证更改为仅更改其名称似乎有点奇怪。我不是律师，但有没有什么办法可以让您不必更改软件上的名称？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T17:01:22.427

像这样的事情很常见。这一切都取决于供应商和出租人之间的协议。它也不限于软件。考虑购买音乐、图像等。我听说有些协议根本无法转让许可证。你只需要买一个新的副本。必须记住的是，从技术上讲，当我们购买程序的副本时，我们并不“拥有”该副本，我们只是出租使用它。它有时很糟糕，但这就是它的工作方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-08T20:01:31.197

在某些情况下，公司购买的工具（资本）比公司更有价值，而公司被购买和掏空只是为了以折扣价获得这些工具。

当然，这对公司不利，但工具供应商尤其不希望这种情况发生——他们失去了一个潜在的全价客户，因为没有真正的竞争对手。此外，最初购买该工具的公司并不介意合同，因为它有助于防止仅基于获得资金的收购。（推论：如果您的公司正在谈判达成这样的合同，请准备好被收购......）

对于非常非常昂贵的工具，这并非闻所未闻。想想每个座位几十万美元，你就会明白为什么这种经济会成为现实。此外，有时工具是由客户 (DoD) 为公司购买的，而他们实际上是一家小公司（少数开发人员赢得了一份不错的合同）——如果客户不保留许可证，那么公司可能会破产，并且在拍卖会上以几美分的价格出售许可证以支付债权人。

等等等等等等。简而言之，非常非常昂贵的许可证足以改变经济领域，以至于适用非常奇怪的规则。请注意，“昂贵”也可能意味着稀缺，例如餐馆的酒牌，或者很难获得（高通可能不想向特定公司出售其 CDMA 专利的许可证，但他们可能无法合法地获得阻止该公司通过法律途径获得此类许可）。

-亚当

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-08T16:50:43.403

我原以为你们的新领主会在他们的收购计划中意识到这一点。该过程的一部分涉及检查这种陷阱。

听起来他们选择忽略这些信息或没有检查它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-08T16:55:18.883

这对我来说听起来很苛刻，但是如果您考虑在收购过程中易手的金额，这可能是您的 IDE 供应商大部分时间都没有抱怨就获得报酬的情况之一，因此他们遵守政策。

我明白为什么不应该完全免费转让许可证——在供应商方面有一些（可能是“名义上的”）行政工作要做，他们需要阻止人们在他们到处转让许可证时真的不应该。但是对于他们需要做的工作量和验证来说，25% 似乎非常高——似乎他们可以对许可证转让费设置某种上限，或者有一个固定的价格。

这似乎是一种将客户推向竞争对手的政策，尤其是没有同样严格的许可证转让政策的政策。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-08T17:07:27.933

似乎这样的事情可以协商。我们从来没有将“费用”视为一个不可谈判的硬性项目。如果他们重视您的业务，我敢打赌他们可以打折转会费。对于所需的行政变更，某种费用似乎是合理的。对我来说，这应该是每个许可证的固定费用。无论许可证费用多少，更改其数据库所需的工作都是相同的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-08T19:55:29.573

这很常见。除非您在签订许可证时提前解决此问题，否则当您描述的交易发生时，您将受到许可人的摆布。许可人可能有也可能没有政策来收取费用，但除非在您的许可中解决了此事，否则他们将有法律能力这样做。

原因是这样的：许可证是与特定法人实体（在这种情况下是您的雇主）的法律合同，并且不会将软件中的任何权利授予任何其他人（他们在您的示例中购买公司）。现在您的雇主本可以坚持原始协议中的一项条款，即许可可以免费转让给可能的未来买家，但如果没有这样的条款，许可人可以为所欲为。包括收取25%的费用。

这就是许多公司的许可证由熟悉软件许可的法律顾问定期审查的原因之一。

# asp-classic - 替换经典 ASP 中的巨大 Case 语句

> ID：50140
> 
> 赞同：2
> 
> 时间：2008-09-08T16:53:51.897
> 
> 标签：asp-classic

我在经典 ASP 中有 200 多个案例陈述，现在已经失控了。它根据选择的情况设置 5 个变量。地址、电话、姓名等。在每种情况下，只需设置变量即可。

数据库或文件不是此应用程序的选项。

来自 Perl 世界，我会使用散列来存储这些信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-08T16:55:47.027

失控？我觉得已经失控了！

您不能将案例分类为“x”一般区域并分解为辅助例程吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-08T17:18:34.133

Brian，Perl 散列的经典 ASP 等价物是[Scripting.Dictionary](http://www.microsoft.com/technet/scriptcenter/guide/sas_scr_ildk.mspx?mfr=true)对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T11:39:53.890

取决于你想要的性能。

case 语句很难看，但不会消耗需要分配的内存。

但是，您可以为您的字段创建一个类并将它们的实例加载到字典中。在 global.asp 脚本中执行此操作，使其只发生一次。将字典存储在全局 asp 集合中，以便它只分配一次，但与每个页面调用一起使用。

我很抱歉在这里没有说得太具体……已经有一段时间了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T17:26:18.053

很多人将 VBScript 用于 Classic ASP，但您可以在服务器上使用 JavaScript / JScript 作为替代方案。事实上，这是我在最终迁移到 .NET 之前执行 Classic ASP 的首选方式（除了在某些情况下，您必须在特殊情况下混合使用 VBScript，即 Disconnected Recordset、ExecuteNoRecords 等）。它将为您提供比 VBScript 更好的 OOP 支持。也许您可以尝试将其重构为之后的某种策略模式。值得研究，我想从长远来看可以更好地维护。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T17:32:33.387

您无法将其迁移到数据库或文本文件这一事实有点问题，因为它们将是此类数据的最佳解决方案。但是，如果您必须在代码中包含它，您可以随时尝试将其放入您预定义的矩阵中。然后你可以提供一个函数来返回矩阵中给定行的数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T17:23:16.063

这应该使用数据库来完成，但是由于您说这不是一个选项，因此您将编写的任何内容都不会比 switch 语句更复杂，因为它都必须存在于您的代码中（根据您的 no db 和没有文件）。

**我的意思是，如果数据库**的概念太**复杂**，您可以使用 Excel 电子表格，但从技术上讲，它也是一个文件！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-13T05:14:39.820

脚本字典是**恕我直言**的最佳选择。

# security - 对称密钥存储

> ID：50142
> 
> 赞同：23
> 
> 时间：2008-09-08T16:54:39.370
> 
> 标签：security, symmetric-key, key-storage

我的公司将为我们的客户存储敏感数据，并将使用托管的 .NET 加密算法类之一对数据进行加密。大部分工作已经完成，但我们还没有弄清楚如何/在哪里存储密钥。我做了一些简单的搜索和阅读，看起来硬件解决方案可能是最安全的。有人对密钥存储解决方案或方法有任何建议吗？

* * *

谢谢大家的回复。

spoulson，问题实际上是您提到的两个“范围”。我想我应该更清楚。

数据本身以及对其进行加密和解密的逻辑都被抽象到 ASP.NET 配置文件提供程序中。此配置文件提供程序允许加密的配置文件属性以及纯文本属性。加密属性值的存储方式与纯文本值完全相同 - 明显的例外是它们已被加密。

也就是说，出于以下三个原因之一，需要能够召唤钥匙：

1.  在授权服务器上运行的授权 Web 应用程序需要对数据进行加密。
2.  与#1 相同，但用于解密数据。
3.  我们业务团队的授权成员需要查看加密数据。

我想象的方式是没有人真正知道密钥 - 会有一个软件控制数据的实际加密和解密。也就是说，密钥仍然需要来自*某个地方*。

完全披露——如果你还不能说，我以前从来没有做过这样的事情，所以如果我完全不知道这应该如何工作，请告诉我。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-16T09:15:49.717

这个问题（技术方面）只有两个真正的解决方案。假设只有应用程序本身需要访问密钥......

1.  硬件安全模块 (HSM) - 通常非常昂贵，而且实施起来并不简单。可以是专用设备（例如 nCipher）或特定令牌（例如 Alladin eToken）。然后你仍然必须定义如何处理该硬件......

2.  DPAPI（Windows 数据保护 API）。System.Security.Cryptography（ProtectedMemory、ProtectedStorage 等）中有这方面的类。这会将密钥管理交给操作系统 - 它处理得很好。在“USER_MODE”中使用，DPAPI 会将密钥的解密锁定给加密它的单个用户。（不用太详细，用户的密码是加密/解密方案的一部分 - 不，更改密码不会弄乱它。）

添加：最好使用 DPAPI 来保护您的主密钥，而不是直接加密您的应用程序的数据。并且不要忘记在您的加密密钥上设置强 ACL...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T10:14:28.037

回应OP这个[答案的#3](https://stackoverflow.com/questions/50142/symmetric-key-storage#50622)

授权成员能够查看加密数据但他们实际上不知道密钥的一种方法是使用密钥托管[（rsa labs）](http://www.rsa.com/rsalabs/node.asp?id=2348) [（维基百科）](http://en.wikipedia.org/wiki/Key_escrow)

总之，密钥被分解成单独的部分并提供给“受托人”。由于私钥的性质，每个段本身都是无用的。然而，如果需要解密数据，那么“受托人”可以将他们的片段组装成整个密钥。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T15:05:57.803

我们有同样的问题，也经历了同样的过程。
我们需要在一台计算机（客户端）上启动一个进程，然后登录到另一台计算机（数据库服务器）。

我们目前认为最佳做法是：

*   操作员在客户端 PC 上手动启动该过程。
*   客户端 PC 提示操作员输入*他的*个人登录凭据。
*   操作员输入他的凭据。
*   客户端 PC 使用这些登录到数据库服务器。
*   客户端 PC 从数据库服务器请求其自己的登录凭据。
*   数据库服务器检查操作员的登录凭据是否有权获取客户端进程的凭据并将其返回给客户端 PC。
*   客户端 PC 从数据库服务器注销。
*   客户端 PC 使用自己的凭据重新登录到数据库服务器。

实际上，操作员的登录密码是关键，但它不会存储在任何地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T17:01:15.500

[Microsoft Rights Management Server (RMS)](http://www.microsoft.com/rms)也有类似的问题。它只是通过使用主密码加密其配置来解决它。...密码上的密码，如果你愿意的话。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T18:07:59.257

您最好的选择是物理保护密钥所在的硬件。此外，永远不要将它写入磁盘 - 找到一些方法来防止该部分内存被分页到磁盘。加密/解密时需要将密钥加载到内存中，并且对于不安全的硬件，总是存在这种攻击场所。

就像您说的那样，有硬件加密设备，但它们无法扩展-所有加密/解密都通过芯片。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-08T18:33:12.113

您可以使用另一个对称密钥加密对称密钥，该对称密钥使用类似[PBKDF2](http://en.wikipedia.org/wiki/PBKDF2)的密码派生而来。

让用户提供密码，生成用于加密数据的新密​​钥，使用密码生成另一个密钥，然后加密并存储数据加密密钥。

它不如使用硬件令牌安全，但它可能仍然足够好并且非常易于使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-08T20:09:06.797

我想我误解了你的问题。您所要求的不是应用程序如何处理其密钥存储的范围，而是您的公司将如何存储它。

在这种情况下，您有两个明显的选择：

*   物理：写入 USB 驱动器、刻录到 CD 等。存储在物理上安全的位置。但是您遇到了递归问题：您将密钥存储在哪里？通常，您委派 2 人或更多人（或团队）持有钥匙。

*   软件：[Cyber​​-Ark](http://www.cyber-ark.com/) Private Ark 是我公司用来存储其秘密数字信息的工具。我们存储我们所有的管理员密码、许可证密钥、私钥等。它通过运行未加入域的 Windows“保险库”服务器来工作，防火墙除了它自己的端口之外的所有端口，并将其所有数据加密存储在磁盘上。用户通过 Web 界面进行访问，该界面首先对用户进行身份验证，然后通过类似资源管理器的界面与保管库服务器进行安全通信。记录所有更改和版本。但是，这也有同样的递归问题……主管理员访问 CD。这存储在我们的物理保险库中，访问受限。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-08T21:06:00.170

在将生成的密钥写出之前，使用硬编码密钥对其进行加密。然后你可以在任何地方写它。

是的，您可以找到硬编码的密钥，但只要您假设可以在*任何地方*存储对称密钥，它的安全性也不会降低。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-08T21:07:18.280

根据您的应用程序，您可以使用[Diffie-Hellman](http://en.wikipedia.org/wiki/Diffie-Hellman)方法让两方安全地就对称密钥达成一致。

在初始的安全交换之后，密钥被商定，会话的其余部分（或新会话）可以使用这个新的对称密钥。

# algorithm - 一个类似于 Levenshtein 但加权 Qwerty 键盘的好算法？

> ID：50144
> 
> 赞同：24
> 
> 时间：2008-09-08T16:55:41.287
> 
> 标签：algorithm, string, text, comparison

我注意到这里有一些关于字符串匹配的帖子，这让我想起了一个我想解决的老问题。有没有人有一个很好的[类似于 Levenshtein](http://en.wikipedia.org/wiki/Levenshtein_distance)的算法，它偏向于 Qwerty 键盘？

我想比较两个字符串，并允许拼写错误。Levenshtein 没问题，但我更愿意接受基于 Qwerty 键盘上按键之间物理距离的拼写错误。换句话说，算法应该更喜欢“yelephone”而不是“zelephone”，因为在大多数键盘上，“y”键比“z”键更靠近“t”键。

任何帮助都会很棒......这个功能不是我项目的核心，所以当我应该做一些更有成效的事情时，我不想转向一个老鼠洞。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-08T17:14:07.967

在生物信息学中，当您比对两条 DNA 序列时，您可能会拥有一个模型，该模型根据替换是转换还是颠换而具有不同的成本。这正是您想要的，但不是 4x4 矩阵，而是 40x40 矩阵或一些矩阵，我敢说距离函数吗？所以替换的成本来自矩阵/函数，而不是一个常数。

**警告：请确保删除和插入的权重正确，因此它们不会被过度接受为最小值。您最终会得到一串插入/删除/无更改替换字符。**

您尝试最小化的新功能是：

```
d[i, j] := minimum(
    d[i-1, j] + del_cost,
    d[i, j-1] + ins_cost,
    d[i-1, j-1] + keyboard_distance( s[i], t[j] )
) 
```

# c# - 如何向非技术人员推广 WCF？

> ID：50145
> 
> 赞同：5
> 
> 时间：2008-09-08T16:55:41.333
> 
> 标签：c#, .net, wcf, web-services, soa

您将如何向非技术客户/经理/CEO/等描述和推广 WCF 作为一种技术？

他们可能会提出哪些竞争解决方案或想法（例如他们在杂志上读到的宣传新技术的内容）？

WCF有*什么*不好的地方，你见过人们试图把它硬塞进去吗？

-亚当

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-08T20:45:39.250

与 .asmx 相比：WCF 是 Microsoft 的下一代 Web 服务开发平台，它解决了旧版本的许多问题，特别是：

*   更好的互操作性，因此您可以与不是来自 Microsoft 或在 Internet 上发布的 Web 服务进行互操作
*   更加灵活，因此开发人员可以更轻松、更快捷地完成工作
*   无需更改代码即可更轻松地进行配置，从而显着降低维护成本

可能他们提出了它与 SOA（一种“面向服务的架构”）之间的关系的问题。WCF 是用于创建参与这些分布式系统的应用程序的 Microsoft 解决方案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-08T17:17:20.080

告诉他们这会让你更轻松地完成工作，这意味着更少的时间和更少的金钱。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T16:59:30.667

一句话，我想说 WCF 是“让您比过去更有效地设置和管理系统之间通信的软件”。

我可以看到他们将 BizTalk 作为竞争对手，但当然你可以说 WCF 与它一起工作，实际上在最近的版本中被用作它的基础技术。

我不确定我是否能想到我所见过的任何不恰当的 WCF 鞋拔，尽管有很多遗留应用程序可能会“升级”到 WCF，而这些应用程序并不真正需要用于任何真正的业务原因。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T17:06:45.377

还有一个互操作角度。如果您将 Asmx 服务升级到 WCF 服务，您仍然可以使用您的 asmx 客户端，然后开始使用更新的 WCF 客户端。WCF 开始得到一些 ReST 的关注，RSS 在那里，Silverlight 在 WCF 中占有一席之地。性能更好，具体取决于您选择的绑定。最大的缺点之一是与 Asmx 服务相比更陡峭的学习曲线、强大的权力/重大责任问题以及做同样事情的 101 种方法。

这些都不是 CxO 谈话，而是将语言重构为杂志流行语，以便他们能够看到这项技术的未来。

# file-io - 为什么许多语言中的“文件存在”方法对目录返回 true？

> ID：50148
> 
> 赞同：1
> 
> 时间：2008-09-08T16:57:22.560
> 
> 标签：file-io, methods, language-design

我知道它在 PHP 中是这样，而且我很确定它在 Java 中也是如此。我没有使用过最新版本的 .NET，所以我不会为他们说话。这似乎很尴尬，但我想知道这是否有潜在的原因。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-08T16:59:51.947

一个原因是兼容性——任何做过“检查存在”的人都知道排除目录；改变这种行为可能会使那些依赖这种行为的人感到困惑。

其次，底层代码经常检查操作系统是否存在于文件系统条目的目录中——对于操作系统而言，目录与文件相同。换句话说，它在目录中查找“xyz”条目，而不是目录中名称为“xyz”的文件。

我怀疑，向后兼容性是主要原因。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-08T17:08:02.287

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T17:06:29.340

通常使用“文件存在”函数在写入之前检查路径。在这个用例中，文件的类型无关紧要，如果有一个名为“/home/foo”的目录，您将无法创建一个名为“/home/foo”的文件</p>

此外，您提到的其中一种语言 PHP 提供了几个功能，具体取决于您关心的文件类型：

*   [`file_exists()`](http://uk3.php.net/manual/en/function.file-exists.php)将为文件、目录和符号链接返回 TRUE
*   [`is_file()`](http://uk3.php.net/manual/en/function.is-file.php)将为文件返回 TRUE，但为目录和符号链接返回 FALSE
*   [`is_dir()`](http://uk3.php.net/manual/en/function.is-dir.php)将为目录返回 TRUE，但为文件和符号链接返回 FALSE
*   [`is_link()`](http://uk3.php.net/manual/en/function.is-link.php)对于符号链接将返回 TRUE，但对于文件和目录将返回 FALSE

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-22T00:49:46.727

# sql - 在 SQL 中将 DateTime 转换为“n Hours Ago”的最佳方法

> ID：50149
> 
> 赞同：8
> 
> 时间：2008-09-08T16:58:26.053
> 
> 标签：sql, datetime, function

我编写了一个 SQL 函数来将 SQL 中的日期时间值转换为更友好的“n Hours Ago”或“n Days Ago”等类型的消息。我想知道是否有更好的方法来做到这一点。

（是的，我知道“不要在 SQL 中这样做”，但出于设计原因，我必须这样做）。

这是我编写的函数：

```
CREATE FUNCTION dbo.GetFriendlyDateTimeValue
(
    @CompareDate DateTime
)
RETURNS nvarchar(48)
AS
BEGIN
    DECLARE @Now DateTime
    DECLARE @Hours int
        DECLARE @Suff nvarchar(256)
    DECLARE @Found bit

    SET @Found = 0
    SET @Now = getDate()
    SET @Hours = DATEDIFF(MI, @CompareDate, @Now)/60

    IF @Hours <= 1
    BEGIN
        SET @Suff = 'Just Now'
        SET @Found = 1
        RETURN @Suff
    END

    IF @Hours < 24
    BEGIN
        SET @Suff = ' Hours Ago'
        SET @Found = 1
    END

    IF @Hours >= 8760 AND @Found = 0
    BEGIN
        SET @Hours = @Hours / 8760
        SET @Suff = ' Years Ago'
        SET @Found = 1
    END

    IF @Hours >= 720 AND @Found = 0
    BEGIN
        SET @Hours = @Hours / 720
        SET @Suff = ' Months Ago'
        SET @Found = 1
    END

    IF @Hours >= 168 AND @Found = 0
    BEGIN
        SET @Hours = @Hours / 168
        SET @Suff = ' Weeks Ago'
        SET @Found = 1
    END

    IF @Hours >= 24 AND @Found = 0
    BEGIN
        SET @Hours = @Hours / 24
        SET @Suff = ' Days Ago'
        SET @Found = 1
    END

    RETURN Convert(nvarchar, @Hours) + @Suff
END 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-08T17:12:53.070

正如你所说，我可能不会在 SQL 中这样做，但作为一个思考练习，有一个 MySQL 实现：

```
CASE
    WHEN compare_date between date_sub(now(), INTERVAL 60 minute) and now() 
        THEN concat(minute(TIMEDIFF(now(), compare_date)), ' minutes ago')

    WHEN datediff(now(), compare_date) = 1 
        THEN 'Yesterday'

    WHEN compare_date between date_sub(now(), INTERVAL 24 hour) and now() 
        THEN concat(hour(TIMEDIFF(NOW(), compare_date)), ' hours ago')

    ELSE concat(datediff(now(), compare_date),' days ago')
END 
```

基于[MySQL 日期和时间](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#c9500)手册页上的类似示例

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-08T17:28:54.327

在甲骨文中：

```
select
  CC.MOD_DATETIME,
  'Last modified ' ||
  case when (sysdate - cc.mod_datetime) < 1
       then round((sysdate - CC.MOD_DATETIME)*24) || ' hours ago'
       when (sysdate - CC.MOD_DATETIME) between 1 and 7
       then round(sysdate-CC.MOD_DATETIME) || ' days ago'
       when (sysdate - CC.MOD_DATETIME) between 8 and 365
       then round((sysdate - CC.MOD_DATETIME) / 7) || ' weeks ago'
       when (sysdate - CC.MOD_DATETIME) > 365   
       then round((sysdate - CC.MOD_DATETIME) / 365) || ' years ago'
       end
from 
  customer_catalog CC 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-08T18:23:13.743

我的尝试 - 这是针对 MS SQL 的。它支持 'ago' 和 'from now' 复数形式，它不使用舍入或 datediff，但截断 - datediff 在 8/30 和 9/1 之间给出 1 个月的差异，这可能不是你想要的。四舍五入给出了 9/1 和 9/16 之间的 1 个月差异。同样，可能不是您想要的。

```
CREATE FUNCTION dbo.GetFriendlyDateTimeValue( @CompareDate DATETIME ) RETURNS NVARCHAR(48) AS BEGIN
declare @s nvarchar(48)
set @s='Now'
select top 1 @s=convert(nvarchar,abs(n))+' '+s+case when abs(n)>1 then 's' else '' end+case when n>0 then ' ago' else ' from now' end from (
 select convert(int,(convert(float,(getdate()-@comparedate))*n)) as n, s from (
  select 1/365 as n, 'Year' as s union all
  select 1/30, 'Month' union all
  select 1, 'Day' union all
  select 7, 'Week' union all
  select 24, 'Hour' union all
  select 24*60, 'Minute' union all
  select 24*60*60, 'Second'
 ) k
) j where abs(n)>0 order by abs(n)
return @s
END 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T17:12:48.093

您的代码看起来很实用。至于更好的方法，那将变得主观。您可能想查看此[页面](http://weblogs.sqlteam.com/jeffs/archive/2007/01/02/56079.aspx)，因为它处理 SQL 中的时间跨度。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-08T18:00:10.553

这个怎么样？您可以将此模式扩展为发送“年”消息，并且可以检查“1 天”或“1 小时”，这样它就不会显示“1 天前”...

我喜欢 SQL 中的 CASE 语句。

```
drop function dbo.time_diff_message    
GO

create function dbo.time_diff_message (
    @input_date datetime
)
returns varchar(200)    
as    
begin    
declare @msg varchar(200)    
declare @hourdiff int

set @hourdiff = datediff(hour, @input_date, getdate())    
set @msg = case when @hourdiff < 0 then ' from now' else ' ago' end    
set @hourdiff = abs(@hourdiff)    
set @msg = case when @hourdiff > 24 then convert(varchar, @hourdiff/24) + ' days' + @msg
                else convert(varchar, @hourdiff) + ' hours' + @msg
            end

return @msg
end

GO    
select dbo.time_diff_message('Dec 7 1941') 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-21T10:55:04.970

感谢上面发布的各种代码。

正如 Hafthor 指出的，原始代码在舍入方面存在局限性。我还发现他的代码踢出的一些结果与我的预期不符，例如周五下午 - > 周一早上会显示为“2 天前”。我想我们都会在 3 天前调用它，即使 3 个完整的 24 小时周期还没有过去。

所以我修改了代码（这是 MS SQL）。免责声明：我是一个新手 TSQL 编码器，所以这很 hacky，但是有效！

我做了一些覆盖 - 例如长达 2 周的任何内容都以天表示。超过 2 个月的任何时间都以周表示。任何超过几个月的时间等等。这似乎是表达它的直观方式。

```
CREATE FUNCTION [dbo].[GetFriendlyDateTimeValue]( @CompareDate DATETIME ) RETURNS NVARCHAR(48) AS BEGIN
declare @s nvarchar(48)

set @s='Now'
select top 1 @s=convert(nvarchar,abs(n))+' '+s+case when abs(n)>1 then 's' else '' end+case when n>0 then ' ago' else ' from now' end from (
 select convert(int,(convert(float,(getdate()-@comparedate))*n)) as n, s from (
  select 1/365 as n, 'year' as s union all
  select 1/30, 'month' union all
  select 1/7, 'week' union all
  select 1, 'day' union all
  select 24, 'hour' union all
  select 24*60, 'minute' union all
  select 24*60*60, 'second'
 ) k
) j where abs(n)>0 order by abs(n)

if @s like '%days%'
BEGIN
 -- if over 2 months ago then express in months
 IF convert(nvarchar,DATEDIFF(MM, @CompareDate, GETDATE())) >= 2
 BEGIN
  select @s = convert(nvarchar,DATEDIFF(MM, @CompareDate, GETDATE())) + ' months ago'
 END

 -- if over 2 weeks ago then express in weeks, otherwise express as days
 ELSE IF convert(nvarchar,DATEDIFF(DD, @CompareDate, GETDATE())) >= 14
 BEGIN
  select @s = convert(nvarchar,DATEDIFF(WK, @CompareDate, GETDATE())) + ' weeks ago'
 END

 ELSE
  select @s = convert(nvarchar,DATEDIFF(DD, @CompareDate, GETDATE())) + ' days ago'
END

return @s
END 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-09-14T19:58:28.403

上面的帖子给了我一些好主意，所以这里是使用 SQL Server 2012 的任何人的另一个功能。

```
 CREATE FUNCTION [dbo].[FN_TIME_ELAPSED] 
    (
        @TIMESTAMP DATETIME
    )
    RETURNS VARCHAR(50)
    AS
    BEGIN

    RETURN 
    (
        SELECT TIME_ELAPSED = 
            CASE
                WHEN @TIMESTAMP IS NULL THEN NULL
                WHEN MINUTES_AGO < 60 THEN CONCAT(MINUTES_AGO, ' minutes ago')
                WHEN HOURS_AGO < 24 THEN CONCAT(HOURS_AGO, ' hours ago')
                WHEN DAYS_AGO < 365 THEN CONCAT(DAYS_AGO, ' days ago')
                ELSE CONCAT(YEARS_AGO, ' years ago') END
        FROM ( SELECT MINUTES_AGO = DATEDIFF(MINUTE, @TIMESTAMP, GETDATE()) ) TIMESPAN_MIN
        CROSS APPLY ( SELECT HOURS_AGO = DATEDIFF(HOUR, @TIMESTAMP, GETDATE()) ) TIMESPAN_HOUR
        CROSS APPLY ( SELECT DAYS_AGO = DATEDIFF(DAY, @TIMESTAMP, GETDATE()) ) TIMESPAN_DAY
        CROSS APPLY ( SELECT YEARS_AGO = DATEDIFF(YEAR, @TIMESTAMP, GETDATE()) ) TIMESPAN_YEAR
    )
    END
    GO 
```

和实施：

```
 SELECT TIME_ELAPSED = DBO.FN_TIME_ELAPSED(AUDIT_TIMESTAMP)
    FROM SOME_AUDIT_TABLE 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-10-25T05:59:49.833

```
CASE WHEN datediff(SECOND,OM.OrderDate,GETDATE()) < 60 THEN
  CONVERT(NVARCHAR(MAX),datediff(SECOND,OM.OrderDate,GETDATE())) +' seconds ago'
WHEN datediff(MINUTE,OM.OrderDate,GETDATE()) < 60 THEN
  CONVERT(NVARCHAR(MAX),datediff(MINUTE,OM.OrderDate,GETDATE())) +' minutes ago'
WHEN datediff(HOUR,OM.OrderDate,GETDATE()) < 24 THEN
  CONVERT(NVARCHAR(MAX),datediff(HOUR,OM.OrderDate,GETDATE())) +' hours ago'
WHEN datediff(DAY,OM.OrderDate,GETDATE()) < 8 THEN
  CONVERT(NVARCHAR(MAX),datediff(DAY,OM.OrderDate,GETDATE())) +' Days ago'
ELSE FORMAT(OM.OrderDate,'dd/MM/yyyy hh:mm tt') END AS TimeStamp 
```

# wpf - 在 WPF 中显示状态消息的最佳方式是什么？

> ID：50151
> 
> 赞同：4
> 
> 时间：2008-09-08T16:59:31.853
> 
> 标签：wpf

我有几个带有更新/删除/添加按钮的 wpf 页面。我想向用户显示“成功删除”等消息。我怎样才能最好地实现这一点，以便将消息定义在一个地方（类似于 asp.net 母版页）并且我可以从任何地方更新此消息？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-08T17:14:33.563

您可能需要考虑进行发布/订阅（“观察者”模式）——在基本页面上定义“状态更改”事件，并创建一个自定义控件来设置委托和事件处理程序以侦听状态更新。

然后，您可以将自定义控件拖放到从基类继承的任何页面上，它会在触发事件时自动侦听并显示状态消息。

**编辑：**我整理了这个模式的一个示例实现，并[发布了一篇](http://weblogs.asp.net/guystarbuck/archive/2008/10/08/shared-message-area-in-wpf-using-publish-subscribe.aspx)介绍代码的博客文章。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T17:20:16.763

我认为您还没有将 ASP.Net 母版页翻译成*WPF Page*世界。
直到 MS 到达那里的一种解决方法，我可能会在页面顶部（或任何地方）放置一个仅显示特定用户级“[应用程序设置](http://msdn.microsoft.com/en-us/library/ms171565.aspx)”的控件。您可以更新字符串属性，例如

```
MyAppUserSettings.StatusMessage = "You just deleted the administrator!" 
```

粗鲁，但我认为会完成工作！

# c# - C# (.NET 2.0) 中 Windows 的进程间通信

> ID：50153
> 
> 赞同：53
> 
> 时间：2008-09-08T17:00:00.400
> 
> 标签：c#, .net, ipc

我以前从未在 Windows 上进行过 IPC。我正在开发一对程序、一个标准的 GUI/CLI 应用程序和一个 Windows 服务。该应用程序必须告诉服务该做什么。那么，假设通信仅在本地进行，那么这两个进程的最佳通信方法是什么？
最好的意思是更健壮和更不容易出错，不是最好的性能也不是最容易编码的。

注意我问的是使用什么，标准 TCP 套接字、命名管道或其他一些通信方式。

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-09-08T17:08:16.387

.Net 中的 IPC 可以通过以下方式实现：

# WCF

使用命名管道**需要 .Net 3.0**及更高版本。

## 代码示例

*   WCF 类**NetNamedPipeBinding**可用于同一台机器上的进程间通信。此类的 MSDN 文档包括涵盖此方案的代码示例[http://msdn.microsoft.com/en-us/library/system.servicemodel.netnamedpipebinding.aspx](http://msdn.microsoft.com/en-us/library/system.servicemodel.netnamedpipebinding.aspx)

* * *

# 远程处理

.Net 1.0 发布的原始 IPC 框架。我相信远程处理不再被积极开发，我们鼓励您改用 WCF

## 代码示例

[通过 Remoting 进行进程间通信](http://www.codeproject.com/KB/threads/process_communication.aspx/process_communication.aspx)- 使用 tcp 通道

## 资源

*   GenuineChannels，销售包含共享内存通道的远程处理工具包。[http://www.genuinechannels.com/Index.aspx](http://www.genuinechannels.com/Index.aspx)
*   [Ingo Rammer](http://www.thinktecture.com/resourcearchive/tools-and-software/dotnetremotingprojects)撰写了权威的 .Net 远程处理书籍[Advanced .NET Remoting, Second Edition](https://rads.stackoverflow.com/amzn/click/com/1590594177)

* * *

# Win32 RPC 使用 csharptest-net RpcLibrary

我最近遇到一个项目，它封装了 Win32 RPC 库并创建了一个可用于本地和远程 RPC 的 .net 类库

**项目主页**：[http ://csharptest.net/projects/rpclibrary/](http://csharptest.net/projects/rpclibrary/)

**MSDN 参考资料：**

*   rpc 的工作原理：[http ://technet.microsoft.com/en-us/library/cc738291(v=ws.10).aspx](http://technet.microsoft.com/en-us/library/cc738291(v=ws.10).aspx)
*   RPC 函数： http: [//msdn.microsoft.com/en-us/library/aa378623 (v=VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa378623(v=VS.85).aspx)

还有一个运行在库之上的 google 协议缓冲区 rpc 客户端：[https ://code.google.com/p/protobuf-csharp-rpc/](https://code.google.com/p/protobuf-csharp-rpc/)

* * *

# WM_COPYDATA

为了完整起见，也可以使用带有[WM_COPYDATA](http://msdn.microsoft.com/en-us/library/ms649011.aspx)消息的 WIN32 方法。我之前在 .Net 1.1 中使用过这种方法来创建一个从 Windows 资源管理器打开多个文件的单实例应用程序。

## 资源

*   [MSDN - WM_COPYDATA](http://msdn.microsoft.com/en-us/library/ms649011.aspx)
*   [代码示例](http://www.codeproject.com/KB/cs/wm_copydata_use.aspx)
*   [PInvoke.net 声明](http://www.pinvoke.net/search.aspx?search=wm_copyData)

# 插座

使用自定义协议（更难）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-08T17:04:16.677

仅限本地，我们已成功使用命名管道。避免了 TCP 的开销，并且几乎（至少对于 .NET）尽可能高效，同时还有一个不错的 API 可以使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-08T17:16:59.660

由于您仅限于 .Net 2.0 WCF 可能不是一个选项。您可以使用带有共享内存的 .Net 远程处理作为同一台机器上应用程序域之间的底层通信机制。使用这种方法，您可以轻松地将进程放在不同的机器上，并用网络协议替换共享内存协议。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-08T21:24:17.627

与 Windows 服务通信的标准方法是使用服务控制代码。Windows 服务可以接收从 0 到 255 的代码。0-127 是为系统保留的。128 到 255 可用于自定义命令。

如果您需要将复杂的对象发送到使用数据库、xml、文件、tcp、http 等的服务。除了发送控制命令，如重新加载配置、进程项等，应该使用此控制代码。

还有其他可用的功能，例如查询服务。请参阅 Windows 服务文档和 api。

[http://arcanecode.com/2007/05/30/windows-services-in-c-sending-commands-to-your-windows-service-part-7/](http://arcanecode.com/2007/05/30/windows-services-in-c-sending-commands-to-your-windows-service-part-7/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T17:18:28.453

你最好的选择是使用 WCF。您将能够在 Windows 服务中创建服务主机，并公开 GUI 应用程序可以使用的定义良好的接口。如果您愿意，WCF 将允许您通过命名管道进行通信，或者您可以选择任何其他通信协议，如 TCP、HTTP 等。使用 WCF，您可以获得强大的工具支持和大量可用信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-11T10:09:12.530

我想加入这个讨论。如果这是出路，请责备我-但是信号量（或多个信号量）不能用于基本通信吗？

# linux - 如何显示 Linux 中可执行文件使用的所有共享库？

> ID：50159
> 
> 赞同：259
> 
> 时间：2008-09-08T17:02:25.623
> 
> 标签：linux, shared-libraries

我想知道我系统上的可执行文件使用了哪些库。更具体地说，我想对使用最多的库以及使用它们的二进制文件进行排名。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：299
> 
> 时间：2008-09-08T17:21:54.407

1.  用于`ldd`列出每个可执行文件的共享库。
2.  清理输出
3.  排序、计算计数、按计数排序

要在“/bin”目录中找到所有可执行文件的答案：

```
find /bin -type f -perm /a+x -exec ldd {} \; \
| grep so \
| sed -e '/^[^\t]/ d' \
| sed -e 's/\t//' \
| sed -e 's/.*=..//' \
| sed -e 's/ (0.*)//' \
| sort \
| uniq -c \
| sort -n 
```

将上面的“/bin”更改为“/”以搜索所有目录。

输出（仅适用于 /bin 目录）将如下所示：

```
 1 /lib64/libexpat.so.0
  1 /lib64/libgcc_s.so.1
  1 /lib64/libnsl.so.1
  1 /lib64/libpcre.so.0
  1 /lib64/libproc-3.2.7.so
  1 /usr/lib64/libbeecrypt.so.6
  1 /usr/lib64/libbz2.so.1
  1 /usr/lib64/libelf.so.1
  1 /usr/lib64/libpopt.so.0
  1 /usr/lib64/librpm-4.4.so
  1 /usr/lib64/librpmdb-4.4.so
  1 /usr/lib64/librpmio-4.4.so
  1 /usr/lib64/libsqlite3.so.0
  1 /usr/lib64/libstdc++.so.6
  1 /usr/lib64/libz.so.1
  2 /lib64/libasound.so.2
  2 /lib64/libblkid.so.1
  2 /lib64/libdevmapper.so.1.02
  2 /lib64/libpam_misc.so.0
  2 /lib64/libpam.so.0
  2 /lib64/libuuid.so.1
  3 /lib64/libaudit.so.0
  3 /lib64/libcrypt.so.1
  3 /lib64/libdbus-1.so.3
  4 /lib64/libresolv.so.2
  4 /lib64/libtermcap.so.2
  5 /lib64/libacl.so.1
  5 /lib64/libattr.so.1
  5 /lib64/libcap.so.1
  6 /lib64/librt.so.1
  7 /lib64/libm.so.6
  9 /lib64/libpthread.so.0
 13 /lib64/libselinux.so.1
 13 /lib64/libsepol.so.1
 22 /lib64/libdl.so.2
 83 /lib64/ld-linux-x86-64.so.2
 83 /lib64/libc.so.6 
```

编辑 - 删除“grep -P”

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2013-03-20T10:28:37.170

我的 ARM 工具链上没有 ldd，所以我使用了 objdump：

$(CROSS_COMPILE)objdump -p

例如：

```
objdump -p /usr/bin/python:

Dynamic Section:
  NEEDED               libpthread.so.0
  NEEDED               libdl.so.2
  NEEDED               libutil.so.1
  NEEDED               libssl.so.1.0.0
  NEEDED               libcrypto.so.1.0.0
  NEEDED               libz.so.1
  NEEDED               libm.so.6
  NEEDED               libc.so.6
  INIT                 0x0000000000416a98
  FINI                 0x000000000053c058
  GNU_HASH             0x0000000000400298
  STRTAB               0x000000000040c858
  SYMTAB               0x0000000000402aa8
  STRSZ                0x0000000000006cdb
  SYMENT               0x0000000000000018
  DEBUG                0x0000000000000000
  PLTGOT               0x0000000000832fe8
  PLTRELSZ             0x0000000000002688
  PLTREL               0x0000000000000007
  JMPREL               0x0000000000414410
  RELA                 0x0000000000414398
  RELASZ               0x0000000000000078
  RELAENT              0x0000000000000018
  VERNEED              0x0000000000414258
  VERNEEDNUM           0x0000000000000008
  VERSYM               0x0000000000413534 
```

* * *

## 回答 #3

> 赞同：59
> 
> 时间：2011-11-17T23:54:24.113

在 Linux 上，我使用：

```
lsof -P -T -p Application_PID 
```

这比`ldd`可执行文件使用[非默认加载器时效果更好](https://stackoverflow.com/questions/10253170/checking-shared-libraries-for-non-default-loaders)

* * *

## 回答 #4

> 赞同：54
> 
> 时间：2008-09-08T17:04:53.900

要了解二进制文件使用的库，请使用 ldd

```
ldd path/to/the/tool 
```

您必须编写一个小 shell 脚本才能了解系统范围的故障。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2015-04-24T04:53:05.593

检查程序可执行文件的共享库依赖关系

要找出特定可执行文件所依赖的库，可以使用 ldd 命令。此命令调用动态链接器来找出可执行文件的库依赖关系。

**> $ ldd /路径/到/程序**

请注意，不建议使用任何不受信任的第三方可执行文件运行 ldd，因为某些版本的 ldd 可能会直接调用可执行文件来识别其库依赖关系，这可能存在安全风险。

相反，显示未知应用程序二进制文件的库依赖关系的更安全方法是使用以下命令。

> **$ objdump -p /path/to/program | 需要 grep**

[了解更多信息](http://ask.xmodulo.com/check-library-dependency-program-process-linux.html)

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2017-03-26T08:57:45.957

**`readelf -d`递归**

`redelf -d`产生与以下内容类似的输出`objdump -p`：[https ://stackoverflow.com/a/15520982/895245](https://stackoverflow.com/a/15520982/895245)

但请注意，动态库可能依赖于其他动态库，因此您必须递归。

例子：

```
readelf -d /bin/ls | grep 'NEEDED' 
```

样本输出：

```
 0x0000000000000001 (NEEDED)             Shared library: [libselinux.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libacl.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6] 
```

然后：

```
$ locate libselinux.so.1
/lib/i386-linux-gnu/libselinux.so.1
/lib/x86_64-linux-gnu/libselinux.so.1
/mnt/debootstrap/lib/x86_64-linux-gnu/libselinux.so.1 
```

选择一个，然后重复：

```
readelf -d /lib/x86_64-linux-gnu/libselinux.so.1 | grep 'NEEDED' 
```

样本输出：

```
0x0000000000000001 (NEEDED)             Shared library: [libpcre.so.3]
0x0000000000000001 (NEEDED)             Shared library: [libdl.so.2]
0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2] 
```

等等。

**`/proc/<pid>/maps`用于运行进程**

这对于查找当前正在运行的可执行文件使用的所有库很有用。例如：

```
sudo awk '/\.so/{print $6}' /proc/1/maps | sort -u 
```

显示`init`(PID `1`) 的所有当前加载的动态依赖项：

```
/lib/x86_64-linux-gnu/ld-2.23.so
/lib/x86_64-linux-gnu/libapparmor.so.1.4.0
/lib/x86_64-linux-gnu/libaudit.so.1.0.0
/lib/x86_64-linux-gnu/libblkid.so.1.1.0
/lib/x86_64-linux-gnu/libc-2.23.so
/lib/x86_64-linux-gnu/libcap.so.2.24
/lib/x86_64-linux-gnu/libdl-2.23.so
/lib/x86_64-linux-gnu/libkmod.so.2.3.0
/lib/x86_64-linux-gnu/libmount.so.1.1.0
/lib/x86_64-linux-gnu/libpam.so.0.83.1
/lib/x86_64-linux-gnu/libpcre.so.3.13.2
/lib/x86_64-linux-gnu/libpthread-2.23.so
/lib/x86_64-linux-gnu/librt-2.23.so
/lib/x86_64-linux-gnu/libseccomp.so.2.2.3
/lib/x86_64-linux-gnu/libselinux.so.1
/lib/x86_64-linux-gnu/libuuid.so.1.3.0 
```

此方法还显示了使用Ubuntu 18.04破解的[最小设置](https://github.com/cirosantilli/cpp-cheat/blob/71ab01c5de024d9d97f0e2f0698cbee6c6a9c87a/shared-library/basic/dlopen.c#L16)`dlopen`测试的库。`sleep(1000)`

另见：[https ://superuser.com/questions/310199/see-currently-loaded-shared-objects-in-linux/1243089](https://superuser.com/questions/310199/see-currently-loaded-shared-objects-in-linux/1243089)

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2015-01-27T00:29:31.823

默认情况下，在 OS X 上没有`ldd`,`objdump`或`lsof`. 作为替代方案，请尝试`otool -L`：

```
$ otool -L `which openssl`
/usr/bin/openssl:
    /usr/lib/libcrypto.0.9.8.dylib (compatibility version 0.9.8, current version 0.9.8)
    /usr/lib/libssl.0.9.8.dylib (compatibility version 0.9.8, current version 0.9.8)
    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1213.0.0) 
```

在此示例中，使用`which openssl`填充给定可执行文件和当前用户环境的完全限定路径。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2011-04-20T08:07:35.040

在 UNIX 系统上，假设二进制（可执行）名称是 test。然后我们使用下面的命令列出测试中用到的库是

```
ldd test 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-08T17:35:02.547

`ldd`您可以获得工具使用的库。要对一组工具的库使用情况进行排名，您可以使用以下命令。

```
ldd /bin/* /usr/bin/* ... | sed -e '/^[^\t]/ d; s/^\t\(.* => \)\?\([^ ]*\) (.*/\2/g' | sort | uniq -c 
```

（这里`sed`去掉所有不以选项卡开头的行，并且只过滤掉实际的库。随着`sort | uniq -c`你得到每个库，计数表明它发生的次数。）

您可能希望`sort -g`在最后添加以按使用顺序获取库。

请注意，您可能会使用上述命令获得两行非库行。静态可执行文件之一（“不是动态可执行文件”）和一个没有任何库的。后者的结果`linux-gate.so.1`不是文件系统中的库，而是内核“提供”的库。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-04-04T12:41:48.957

在与可执行文件相关的 ubuntu 打印包上

```
ldd executable_name|awk '{print $3}'|xargs dpkg -S |awk -F  ":"  '{print $1}' 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-11-30T09:43:33.533

另一种选择可以是读取位于的文件

```
/proc/<pid>/maps 
```

例如进程 id 是 2601 那么命令是

```
cat /proc/2601/maps 
```

输出就像

```
7fb37a8f2000-7fb37a8f4000 r-xp 00000000 08:06 4065647                    /usr/lib/x86_64-linux-gnu/libproxy/0.4.15/modules/network_networkmanager.so
7fb37a8f4000-7fb37aaf3000 ---p 00002000 08:06 4065647                    /usr/lib/x86_64-linux-gnu/libproxy/0.4.15/modules/network_networkmanager.so
7fb37aaf3000-7fb37aaf4000 r--p 00001000 08:06 4065647                    /usr/lib/x86_64-linux-gnu/libproxy/0.4.15/modules/network_networkmanager.so
7fb37aaf4000-7fb37aaf5000 rw-p 00002000 08:06 4065647                    /usr/lib/x86_64-linux-gnu/libproxy/0.4.15/modules/network_networkmanager.so
7fb37aaf5000-7fb37aafe000 r-xp 00000000 08:06 4065646                    /usr/lib/x86_64-linux-gnu/libproxy/0.4.15/modules/config_gnome3.so
7fb37aafe000-7fb37acfd000 ---p 00009000 08:06 4065646                    /usr/lib/x86_64-linux-gnu/libproxy/0.4.15/modules/config_gnome3.so
7fb37acfd000-7fb37acfe000 r--p 00008000 08:06 4065646                    /usr/lib/x86_64-linux-gnu/libproxy/0.4.15/modules/config_gnome3.so
7fb37acfe000-7fb37acff000 rw-p 00009000 08:06 4065646                    /usr/lib/x86_64-linux-gnu/libproxy/0.4.15/modules/config_gnome3.so
7fb37acff000-7fb37ad1d000 r-xp 00000000 08:06 3416761                    /usr/lib/x86_64-linux-gnu/libproxy.so.1.0.0
7fb37ad1d000-7fb37af1d000 ---p 0001e000 08:06 3416761                    /usr/lib/x86_64-linux-gnu/libproxy.so.1.0.0
7fb37af1d000-7fb37af1e000 r--p 0001e000 08:06 3416761                    /usr/lib/x86_64-linux-gnu/libproxy.so.1.0.0
7fb37af1e000-7fb37af1f000 rw-p 0001f000 08:06 3416761                    /usr/lib/x86_64-linux-gnu/libproxy.so.1.0.0
7fb37af1f000-7fb37af21000 r-xp 00000000 08:06 4065186                    /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so
7fb37af21000-7fb37b121000 ---p 00002000 08:06 4065186                    /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so
7fb37b121000-7fb37b122000 r--p 00002000 08:06 4065186                    /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so
7fb37b122000-7fb37b123000 rw-p 00003000 08:06 4065186                    /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-09-02T05:07:47.373

如果您不关心可执行文件的路径 -

```
ldd `which <executable>` # back quotes, not single quotes 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-10-19T14:20:41.767

我发现这篇文章非常有用，因为我需要调查来自 3rd 方提供的库（32 位与 64 位执行路径）的依赖关系。

我根据 RHEL 6 发行版上的“readelf -d”建议整理了一个 Q&D 递归 bash 脚本。

它是非常基本的，并且每次都会测试每个依赖项，即使它之前可能已经测试过（即非常冗长）。输出也很基础。

```
#! /bin/bash

recurse ()
# Param 1 is the nuumber of spaces that the output will be prepended with
# Param 2 full path to library
{
#Use 'readelf -d' to find dependencies
dependencies=$(readelf -d ${2} | grep NEEDED | awk '{ print $5 }' | tr -d '[]')
for d in $dependencies; do
   echo "${1}${d}"
   nm=${d##*/}
   #libstdc++ hack for the '+'-s
   nm1=${nm//"+"/"\+"}
   # /lib /lib64 /usr/lib and /usr/lib are searched
   children=$(locate ${d} | grep -E "(^/(lib|lib64|usr/lib|usr/lib64)/${nm1})")
   rc=$?
   #at least locate... didn't fail
   if [ ${rc} == "0" ] ; then
      #we have at least one dependency
      if [ ${#children[@]} -gt 0 ]; then
         #check the dependeny's dependencies
         for c in $children; do
          recurse "  ${1}" ${c}
         done
      else
         echo "${1}no children found"
      fi
   else
      echo "${1}locate failed for ${d}"
   fi
done
}
# Q&D -- recurse needs 2 params could/should be supplied from cmdline
recurse "" !!full path to library you want to investigate!! 
```

将输出重定向到文件并 grep 查找“找到”或“失败”

使用和修改当然需要您自担风险，如您所愿。

# sql-server - 如何从我的用户锁定我的 MS-SQL 数据库，但仍然通过 ODBC 访问它？

> ID：50164
> 
> 赞同：2
> 
> 时间：2008-09-08T17:04:17.910
> 
> 标签：sql-server, ms-access, odbc

我有一个通过 ODBC 连接访问的 ms-access 应用程序和 ms-sql db。我试图强迫我的用户*仅*通过应用程序部分更新数据，但我不在乎他们是直接读取数据还是通过他们自己的自定义 ms-access db 读取数据（他们使用它来创建临时报告）。

我正在寻找的是一种使数据仅在使用我分发给他们的已编译 .mde 文件时才可编辑的方法。我知道我可以将数据设置为仅供一般人群读取，并且可以对特定用户进行编辑。

有没有一种方法可以让 ms-sql 使数据只有在他们通过我的罐装 mde 访问数据时才可编辑？

想一想，有没有办法让 ms-access 以不同的用户身份登录数据库（或在连接后更改登录名）？

* * *

@Jake，
是的，它使用表单。我要做的只是在我弹出启动板/主菜单表单时切换用户一次。

@Peter，
这确实是我前进的方向。我还没有确定如何切换到第二个 ID。我并不担心密码被嗅探，用户都是内部的，并且在内部 LAN 上。如果他们能嗅出那个密码，他们当然可以嗅出我的特权 ID。

@一般来说没有人，
现在它的安全性默默无闻。我为用户提供了一个特殊的 .mdb 来进行报告，让他们可以读取数据，但不能更新数据。他们不知道通过 ODBC 连接重新链接到表。一个稍微懂 ms-access/DB 的用户可以在几秒钟内通过我所做的事情——还有一些人认为自己是 DBA，所以他们最终会弄明白的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-08T17:21:04.610

有一种方法可以对内部用户有效，但可能会被黑客入侵。您为每个用户创建两个 ID。一种是具有只读访问权限的报告 ID。这是用户知道的 ID：Fred / mypassword

第二个是可以进行更新的ID。该 ID 是 Fred_app / mypassword_mangled。他们使用 Fred 登录您的应用程序。当您的应用程序访问数据时，它使用应用程序 ID。

这可以被嗅探，但对于许多应用程序来说已经足够了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T17:31:28.017

您的应用程序允许链接表更新还是通过表单进行？听起来您使用具有不同角色的集中式用户的想法是可行的方法。是的，您可以更改用户，但我可能会引入更多编码，一旦您开始添加越来越多的代码，其他解决方案（存储过程等）可能听起来更有吸引力。

# linq - 优化 LINQ to SQL 查询

> ID：50169
> 
> 赞同：7
> 
> 时间：2008-09-08T17:05:22.480
> 
> 标签：linq, linq-to-sql, optimization

我有一个看起来像这样的查询：

```
public IList<Post> FetchLatestOrders(int pageIndex, int recordCount)
{
    DatabaseDataContext db = new DatabaseDataContext();
    return (from o in db.Orders
            orderby o.CreatedDate descending
            select o)
            .Skip(pageIndex * recordCount)
            .Take(recordCount)
            .ToList();
} 
```

我需要打印订单信息和创建它的用户：

```
foreach (var o in FetchLatestOrders(0, 10))
{
    Console.WriteLine("{0} {1}", o.Code, o.Customer.Name);
} 
```

这将生成一个 SQL 查询来带来订单，并为每个订单生成一个查询来带来客户。是否可以优化查询，以便在一个 SQL 查询中带来订单和客户？

谢谢

UDPATE：根据 Sirrocco 的建议，我更改了这样的查询并且它有效。只生成一个选择查询：

```
public IList<Post> FetchLatestOrders(int pageIndex, int recordCount)
{
    var options = new DataLoadOptions();
    options.LoadWith<Post>(o => o.Customer);
    using (var db = new DatabaseDataContext())
    {
        db.LoadOptions = options;
        return (from o in db.Orders
                orderby o.CreatedDate descending
                select o)
                .Skip(pageIndex * recordCount)
                .Take(recordCount)
                .ToList();
    }
} 
```

谢谢西洛克。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-08T17:33:54.407

您可以做的其他事情是 EagerLoading。在 Linq2SQL 中，您可以使用 LoadOptions ：有关 LoadOptions 的[更多信息](http://oakleafblog.blogspot.com/2007/08/linq-to-sql-query-execution-with.html) 关于 L2S 的一个非常奇怪的事情是，您只能在第一个查询发送到数据库之前设置 LoadOptions。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-08T17:12:39.777

您可能想研究使用已编译的查询

看看[http://www.3devs.com/?p=3](http://www.3devs.com/?p=3)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-07-10T08:28:04.507

给定一个 LINQ 语句，如：

```
context.Cars
  .OrderBy(x => x.Id)
  .Skip(50000)
  .Take(1000)
  .ToList(); 
```

这大致翻译为：

```
select * from [Cars] order by [Cars].[Id] asc offset 50000 rows fetch next 1000 rows 
```

因为 offset 和 fetch 是 order by 的扩展，所以它们直到 select-portion 运行后才会执行（google）。这意味着在获取获取结果之前，在整个数据集（[Cars]）上执行具有大量连接语句的昂贵选择。

**优化语句** 只需将 OrderBy、Skip 和 Take 语句放入 Where 子句中：

```
context.Cars
  .Where(x => context.Cars.OrderBy(y => y.Id).Select(y => y.Id).Skip(50000).Take(1000).Contains(x.Id))
  .ToList(); 
```

这大致翻译为：

```
exec sp_executesql N'
select * from [Cars]
where exists
  (select 1 from
    (select [Cars].[Id] from [Cars] order by [Cars].[Id] asc offset @p__linq__0 rows fetch next @p__linq__1 rows only
    ) as [Limit1]
    where [Limit1].[Id] = [Cars].[Id]
  )
order by [Cars].[Id] asc',N'@p__linq__0 int,@p__linq__1 int',@p__linq__0=50000,@p__linq__1=1000 
```

所以现在，外部选择语句仅在基于 where 存在子句的过滤数据集上执行！

同样，您的里程可能会因进行更改所节省的查询时间而异。一般的经验法则是您的选择语句越复杂，您想要进入的数据集越深入，这种优化就越有帮助。

# css - “显示：标记”是否适用于任何当前的浏览器，如果可以，如何？

> ID：50170
> 
> 赞同：2
> 
> 时间：2008-09-08T17:05:30.950
> 
> 标签：css, cross-browser

我不能确定我的代码是不是很糟糕，或者只是浏览器还没有跟上规范。

我的目标是使用生成的内容来模拟列表标记，以便在纯 CSS 中让计数器从列表到列表的延续。

所以下面的代码，我*认为*根据[规范是正确的](http://www.w3.org/TR/CSS2/generate.html#markers)，是这样的：

```
html {
  counter-reset: myCounter;
}
li {
  counter-increment: myCounter;
}
li:before {
  content: counter(myCounter)". ";
  display: marker;
  width: 5em;
  text-align: right;
  marker-offset: 1em;
}
```

```
<ol>
  <li>The<li>
  <li>quick</li>
  <li>brown</li>
</ol>
<ol>
  <li>fox</li>
  <li>jumped</li>
  <li>over</li>
</ol>
```

但这似乎不会在 FF3、Chrome 或 IE8 beta 2 中生成标记，如果我没记错的话，也不是 Opera（尽管我已经卸载了 Opera）。

那么，有谁知道标记是否*应该*起作用？在这方面，Quirksmode.org 并没有像往常一样乐于助人:(。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-08T17:15:04.373

显然，标记是在 CSS 2 中作为值引入的，但由于缺乏浏览器支持而没有进入 CSS 2.1。我想这无助于它的受欢迎程度……</p>

来源：[http](http://de.selfhtml.org/css/eigenschaften/positionierung.htm#display) ://de.selfhtml.org/css/eigenschaften/positionierung.htm#display （德语）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T17:47:52.457

哦，哎哟，不知道：-|。那么，这可能会密封它的情况。因为大多数时候我的假设是现代浏览器肯定应该支持这样一个基本的 CSS2 属性，但如果它没有进入 CSS 2.1，那么它不是更有意义。

为了将来参考，它没有出现[在 Mozilla Development Center](http://developer.mozilla.org/en/CSS/display)中，所以大概 Firefox 根本不支持它。

另外为了将来参考，我得到了我原来的例子来`inline-block`代替：

```
li:before
{
    content: counter(myCounter)". ";
    display: inline-block;
    width: 2em;
    padding-right: 0.3em;
    text-align: right;
} 
```

# linux - Linux/X11 输入库，无需创建窗口

> ID：50182
> 
> 赞同：7
> 
> 时间：2008-09-08T17:09:40.143
> 
> 标签：linux, user-input, sdl

是否有一个很好的库可用于从鼠标/键盘/操纵杆收集 Linux 中的用户输入，而不会强制您创建可见窗口来这样做？SDL 可以让您以合理的方式获取用户输入，但似乎强制您创建一个窗口，如果您有抽象控制，这很麻烦，因此控制机器不必与渲染机器相同。但是，如果控制机器和渲染机器是相同的，这会导致在您的显示器顶部出现一个丑陋的小 SDL 窗口。

**编辑澄清**：
渲染器有一个输出窗口，在其正常使用情况下，该窗口是全屏的，除非它们都在同一台计算机上运行，​​这样就可以给控制器焦点。实际上可以有多个渲染器在不同的计算机上显示相同数据的不同视图，它们都由同一个控制器控制，因此输入与输出的完全解耦（利用内置的 X11 客户端/服务器的东西来减少显示可用）此外，一个渲染器的多个控制器应用程序也是可能的。控制器和渲染器之间的通信是通过套接字进行的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-09T16:14:01.033

好的，如果您在 X11 下并且想要获取 kbd，则需要进行抓取。如果你不是，我唯一的好答案是来自终端的 ncurses。

以下是您如何从键盘上抓取所有内容并再次释放：

```
/* 演示代码，需要更多的错误检查，编译
 * 使用“gcc nameofthisfile.c -lX11”。

/* 奇怪的降价格式如下。啊！*/

```

`#include <X11/Xlib.h>`

```
int main(int argc, char **argv)
{
   显示 *dpy;
   XEvent EV;
   字符 *s;
   无符号整数 kc；
   诠释退出= 0；

   if (NULL==(dpy=XOpenDisplay(NULL))) {
      错误（argv[0]）；
      退出（1）；
   }

   /*
    * 您可能希望将指针扭曲到您知道的某个地方
    * 与任何会耗尽事件的东西无关。
    * (void)XWarpPointer(dpy, None, DefaultRootWindow(dpy), 0, 0, 0, 0, x, y);
    */

   XGrabKeyboard(dpy, DefaultRootWindow(dpy),
                 真，GrabModeAsync，GrabModeAsync，当前时间）；

   printf("键盘被抓！按 'q' 退出！\n"
          "如果这个工作被杀死或者你卡住了，使用 Ctrl-Alt-F1\n"
          “切换到控制台（如果可能）并运行\n”
          "松开键盘。\n");

   /* 一个非常简单的事件循环：从“man XEvent”开始了解更多信息。*/
   /* 另请参阅“apropos XGrab”，了解锁定访问权限的各种方法
    *某些类型的信息。出入服务器 */
   对于 (;!quit;) {
      XNextEvent(dpy, &ev);
      开关（ev.type）{
         案例按键：
            kc = ((XKeyPressedEvent*)&ev)->keycode;
            s = XKeysymToString(XKeycodeToKeysym(dpy, kc, 0));
            /* s 为 NULL 或静态无接触返回字符串。*/
            if (s) printf("KEY:%s\n", s);
            if (!strcmp(s, "q")) quit=~0;
            休息;
         案例曝光：
               /* 通常，最好将剩余的暴露暴露在
                * 避免访问 Blinky's Fun Club。*/
               while (XCheckTypedEvent(dpy, Expose, &ev)) /* 空体 */ ;
            休息;
         案例按钮按下：
         案例按钮释放：
         案例密钥发布：
         案例 MotionNotify：
         案例配置通知：
         默认：
            休息;
      }
   }

   XUngrabKeyboard(dpy, CurrentTime);

   如果（XCloseDisplay（dpy））{
      错误（argv[0]）；
      退出（1）；
   }

   返回0；
}

```

Run this from a terminal and all kbd events should hit it. I'm testing it under Xorg but it uses venerable, stable Xlib mechanisms.

Hope this helps.

BE CAREFUL with grabs under X. When you're new to them, sometimes it's a good idea to start a time delay process that will ungrab the server when you're testing code and let it sit and run and ungrab every couple of minutes. It saves having to kill or switch away from the server to externally reset state.

From here, I'll leave it to you to decide how to multiplex renderes. Read the XGrabKeyboard docs and XEvent docs to get started. If you have small windows exposed at the screen corners, you could jam the pointer into one corner to select a controller. XWarpPointer can shove the pointer to one of them as well from code.

One more point: you can grab the pointer as well, and other resources. If you had one controller running on the box in front of which you sit, you could use keyboard and mouse input to switch it between open sockets with different renderers. You shouldn't need to resize the output window to less than full screen anymore with this approach, ever. With more work, you could actually drop alpha-blended overlays on top using the SHAPE and COMPOSITE extensions to get a nice overlay feature in response to user input (which might count as gilding the lily).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-08T17:24:06.473

对于鼠标，您可以使用[GPM](http://www.linuxjournal.com/article/4600)。

我不确定键盘或操纵杆的想法。

`/dev`如果需要，直接从那里读取文件可能不会太糟糕。

希望能帮助到你

# svn - 每个人的源代码控制？

> ID：50194
> 
> 赞同：18
> 
> 时间：2008-09-08T17:13:16.533
> 
> 标签：svn, git, version-control

我有许多共享一组项目文件的非技术用户。让他们使用版本控制是理想的，但我认为 subversion 和 git 对于非技术办公室工作人员来说太技术性了。

有没有适合普通人使用的分布式源代码控制软件？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-08T17:28:08.930

如果源代码控制过于技术性，他们可以将[Subversion 与 WebDav 一起](http://svnbook.red-bean.com/en/1.2/svn.webdav.autoversioning.html)使用。

技术含量较低的人只会从他们使用的任何应用程序中正常保存文件，而不用担心/考虑源代码控制。他们无需执行任何操作即可获得自动版本控制的好处。

当他们需要更多功能时，他们可以学习使用 TortoiseSVN 来查看差异，恢复到自动为他们制作的旧版本等等......

从颠覆书：

> 因为很多操作系统已经集成了 WebDAV 客户端，所以这个功能的用例简直是天方夜谭：想象一个运行 Microsoft Windows 或 Mac OS 的普通用户办公室。每个用户都“挂载”Subversion 存储库，它看起来是一个普通的网络文件夹。他们像往常一样使用共享文件夹：打开文件、编辑文件、保存文件。同时，服务器会自动对所有内容进行版本控制。任何管理员（或知识渊博的用户）仍然可以使用 Subversion 客户端来搜索历史并检索旧版本的数据。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-08T17:15:33.267

你试过[乌龟SVN](http://tortoisesvn.tigris.org/)吗？我无法想象源代码控制变得更容易使用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-08T17:48:38.710

这听起来更像是[BaseCamp](http://www.basecamphq.com/?source=37s+home)、~~[SpiceBird](http://www.spicebird.com/)~~或 SharePoint 等协作工具的用例，而不是“源代码控制”。这些工具与源代码管理具有相同的目标，但更适合 Word 文档类型的内容和相应的用户。它是 IT 人员在服务器上维护的另一项内容，但它也消除了某人的助手清除您的代码的可能性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-08T20:39:10.467

如果他们不经常一次只需要一个用户编辑 Office 文件，请在具有适当权限的网络共享上获取文件并每晚备份它们。如果有人已经打开它，Active Directory 会警告他们。

如果它比办公室更复杂，请考虑 Sharepoint。我认为 SVN 太复杂了，尤其是因为二进制文件的冲突和比较，例如旧单词文档并不能真正起作用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T15:16:23.417

我会尝试将 Mercurial 与[TortoiseHG](http://tortoisehg.sf.net)一起用于 Explorer 集成。

它很容易使用，我可以毫无问题地使用：

*   把它教给不懂计算机的同事一起写文本。
*   guide a friend by phone through installing Mercurial (TortoiseHG), creating a repository and setting it up for working together using seperate push (his) and pull (mine) repositories - after installing it only once on a Windows machine (I only run GNU/Linux).

And since it is fully distributed, they can't break your repository when they break theirs - you can simply decide not to pull their changes or to pull only the good changes (for example avoiding these huge binary files beginners tend to put under version control).

I since then switched to also managing all my static websites via Mercurial (and a push-upload hook which automatically uploads the website to my FTP-server, so I don't have to worry about that anymore).

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-08T17:39:06.360

我认为最好的解决方案是让每个人都直接使用版本控制系统。如果你在 Windows 平台上，我会推荐 TortoiseSVN。

如果直接使用 TortoiseSVN 太难，我在设置 Samba 文件共享方面有很好的经验，所有项目文档都存储在其中，并自动与 Subversion 同步。你失去了人们在他们的提交上写评论的好处，但在许多情况下，自动版本历史总比没有版本历史好。这样，相关人员甚至不必知道版本跟踪，只要他们将文档保存在正确的位置即可。您需要同步的频率取决于文档更改的频率，但在我的情况下，每 24 小时同步一次就足够了。

注意：为了实现这一点，我必须编写一个自定义脚本，从存储库中检出最新版本，将其与本地副本进行比较，并发出`svn`（或`cvs`）命令来添加、删除和更新任何更改的文件。我不确定是否存在一个通用的（开源）解决方案来做到这一点，但我认为自己实现应该不会太难（我写了一个简单的脚本在几个小时内完成）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-08T19:55:08.343

我目前正在探索 SharePoint 在何种程度上可以在类似的环境中提供非技术人员友好但可靠的版本控制。初步结果是“meh”。即使在我们得出结论的情况下，修订控制要求用户对文档管理的态度发生相当重要的转变已经变得很明显。

现在，如果这是针对使用 Apple Macs 的团队（我认为不是），我强烈推荐[Versions](http://www.versionsapp.com/)，这是一个非常直观的 SVN 客户端。这是我见过的第一个也是唯一一个版本控制及其范式转换被非程序员轻松采用的软件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-10T03:19:24.293

I made a howto for the subversion+webdav answer:

[http://timwise.wikispaces.com/document-versioning](http://timwise.wikispaces.com/document-versioning)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-08T17:15:25.793

您是否尝试过 Adob​​e 的版本提示？这不是开源/免费的，但最终用户可能更容易使用。

[http://www.adobe.com/products/creativesuite/versioncue/](http://www.adobe.com/products/creativesuite/versioncue/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-08T17:28:03.470

如果带有 TortiseSVN 的 Subversion 太复杂了——而且可能是这样，因为版本控制是一个不同于 Open、Modify、Save 的完整范例——那么你可以从一个更简单的手动版本控制开始它们：

myDocument-20080908-beverlyd.doc

它简单易懂，您可以编写一个脚本，每晚或每周归档所有旧版本，这样他们就真的只能看到最新的一两个版本。

如果有人想看到差异，请教他们差异。

-亚当

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-08T18:38:53.080

“项目文件”可能含糊不清 - 如果有问题的文件主要不是 ASCII 文件，而是 Word 文档或您拥有的文件，我不确定传统的源代码控制工具是否真的有效。

SVN 等。人。会很高兴地支持二进制文件，但如果你只使用它，那么你并没有真正获得大部分有用的功能，并且通常最终会使非技术用户感到困惑。SVN（和 git 等）是为程序员设计的工具 - 如果您只是在寻找一种管理文档修订和保留历史记录的好方法，我猜您的特定平台有更好的工具（尽管我没有没有足够的知识来推荐一个特定的）。

也就是说，如果它们主要是 ASCII 文件，我怀疑 TortoiseSVN 是你最好的选择。

# log4net - 在多线程环境中使用 log4net 有什么问题吗？

> ID：50213
> 
> 赞同：3
> 
> 时间：2008-09-08T17:20:03.473
> 
> 标签：log4net

我想知道是否有人有在像 asp.net 这样的多线程环境中使用 log4net 的经验。我们目前正在使用 log4net，我想确保我们不会遇到任何问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-08T18:15:08.677

我们在高度多线程的环境中运行 log4net（和 log4cxx）没有问题。不过，您需要小心配置它们的方式。

Jeff 描述的 log4net 问题与某个附加程序的使用有关。我们总体上坚持使用简单的日志文件附加程序，以减少日志记录对代码操作的影响。将一行写入文件非常简单，启动另一个数据库事务非常繁重。

# ide - 与多语言 IDE 的插件相比，特定语言的 IDE 有什么优势吗？

> ID：50217
> 
> 赞同：5
> 
> 时间：2008-09-08T17:21:38.010
> 
> 标签：ide

我主要做 Java 和 C/C++ 开发，但我开始做更多的 Web 开发（PHP、Rails）和 Eiffel（学习一门新语言总是好的）。

目前，我将 Eclipse 用于 Java、C/C++ 和 Ruby（不是 Rails）。由于我了解环境，我认为找到一个插件并将 Eclipse 用于我所有的开发语言会更容易。但是在某些情况下，特定语言的 IDE（例如 Eiffel 的 EiffelStudio）会比 Eclipse 更好吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-08T17:29:15.870

我使用过很多 IDE，在大多数情况下，对我来说它会分解为个人喜好。有时，特定于语言的插件/插件/功能很不错，但除非它们是没有你就无法生存的东西，否则应该选择最适合你的东西。

我认为，如果您对多语言 IDE 感到满意，最好还是坚持使用那个。这样您就不必记住多个 IDE 布局、键盘快捷键等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-19T21:50:31.073

掌握 IDE 需要时间和精力。对于需要使用多种语言进行开发的程序员来说，使用多语言 IDE 无疑是有益的。出于同样的原因，VI 和 Emacs 等工具如此受欢迎。

另一方面，专门针对一种语言的 IDE 有时在某些方面可能会走得更远，并且在某些情况下可能是首选。

我喜欢 Eclipse 作为 Java IDE（以至于我们决定构建一些基于 Eclipse 的应用程序）并且我是 Emacs 的粉丝。但我也喜欢 IntelliJ 的 Groovy 支持和 EiffelStudio 的效率。

这是一个品味问题，你原谅你爱的人......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-14T08:05:08.983

这完全取决于用户和语言本身，如果您对键盘快捷键感到满意，那么您可以考虑使用插件，否则您可以使用 IDE。但是，大多数 IDE 都带有跨功能键映射，因此您可以使用您更熟悉的键映射....

# asp.net - asp.net 中的多线程

> ID：50221
> 
> 赞同：9
> 
> 时间：2008-09-08T17:24:07.240
> 
> 标签：asp.net, multithreading

在 asp.net 中需要注意哪些类型的多线程问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-08T18:34:44.480

从 ASP.NET 页面的代码隐藏中生成线程是有风险的，因为工作进程偶尔会被回收并且您的线程会死掉。

如果由于用户在网页上的操作而需要启动长时间运行的进程，最好的办法是在 MSMQ 中删除一条消息，并让一个单独的后台服务监控队列。该服务可能需要尽可能长的时间来完成任务，并且网页几乎会立即完成其工作。您可以通过对 web 方法的异步调用来完成同样的事情，但不要依赖于在 web 方法完成工作时获得响应。从代码隐藏，它需要是一个快速的即发即弃。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-08T17:30:45.227

在过期的事情上要注意的一件事（我认为 httpContext 确实如此），如果您将它用于“即发即忘”的操作，请记住，如果 asp.net 清理代码在您的操作完成之前运行，那么突然间，您将无法访问某些信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-08T17:55:53.153

如果这是针对 Web 服务的，那么您绝对应该考虑使用线程池。过多的线程会使您的应用程序陷入停顿，因为它们最终会开始争夺 CPU 时间。

这是用于文件还是网络 IO？如果是这样，您还应该考虑使用[异步 IO](http://msdn.microsoft.com/en-us/magazine/cc700359.aspx?pr=blog)。编程可能有点痛苦，但您不必担心一次产生太多线程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T17:28:17.167

程序化缓存是我立即想到的一个领域。这是一个很棒的功能，需要小心使用。由于它是跨请求共享的，因此您必须在更新它之前对其进行锁定。

我要检查的另一个地方是访问文件系统的任何代码，例如写入日志文件。如果一个请求对文件有读写锁，其他并发请求如果处理不当就会出错。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T18:37:43.647

IIS 配置中不是有 25 个总线程的限制吗？我相信至少在 IIS 6 中。如果您超过该限制，可能会发生有趣的事情（阅读：loooooooong 响应时间）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-12-18T22:49:46.410

根据您的需要，就多线程而言，您是否考虑过从客户端生成请求。使用 AJAX 生成请求是安全的，然后在回调中对结果进行操作。或者使用服务作为后台机制，每 X 分钟运行一次，并以这种方式在后台处理。

# mercurial - 如何在 Mercurial 中重复合并分支

> ID：50223
> 
> 赞同：14
> 
> 时间：2008-09-08T17:27:16.140
> 
> 标签：mercurial, version-control

我们在我工作的地方使用 Mercurial，我想要一个类似于我使用 SVN 的设置：

*   树干
*   标签
    *   生产
*   分支机构

由于 Mercurial 本身支持分支，我知道如何创建命名分支，但我找不到任何关于如何重复合并“主干”和“生产”的文档。

很简单，我想要一个用于正常工作的开发分支和一个我经常从开发分支中提取更改的生产分支。如何使用 Mercurial 执行此操作？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-08T19:26:01.690

正如之前的海报所提到的，移植扩展可用于从一个分支到另一个分支的个别更改。但是，如果您总是想提取*所有*最新更改，该`hg merge`命令将带您到达那里。

最简单的情况是当您使用克隆来实现分支时（因为这是 Mercurial 设计的用例）。假设您在/中打开了内置的[fetch](http://www.selenic.com/mercurial/wiki/index.cgi/FetchExtension)扩展：`.hgrc``Mercurial.ini`

```
cd ~/src/development
# hack hack hack
hg commit -m "Made some changes"
cd ../production
hg fetch ../development 
```

如果您使用本地分支机构：

```
hg update -C development
# hack hack hack
hg commit -m "Made some changes"
hg update -C production
hg merge development
hg commit -m "Merged from development" 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-08T17:33:21.570

像[`hg transplant`](http://www.selenic.com/mercurial/wiki/index.cgi/TransplantExtension)什么？这就是我们在 dev 和 prod 分支上使用的东西。

# winapi - 如何以编程方式更改 Win32 对话框中的 Tab 键顺序？

> ID：50236
> 
> 赞同：13
> 
> 时间：2008-09-08T17:31:55.753
> 
> 标签：winapi, dialog

在通过对话框模板和 CreateDialogIndirect 生成对话框后，我经常需要向对话框添加控件。在这些情况下，tab 顺序由对话框模板设置，并且没有明显的方法可以通过包含新创建的控件来更改 tab 顺序。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-08T17:34:11.130

我最近发现您可以使用 SetWindowPos 来完成此操作。确定要在哪个控件之后按 Tab 键顺序插入新控件，然后像这样使用 SetWindowPos：

```
SetWindowPos(hNewControl, hOldControl, 0, 0, 0, 0, SWP_NOMOVE|SWP_NOSIZE); 
```

这会更改控件的 z 顺序，从而建立 Tab 键顺序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-11T18:07:45.693

我知道这是一个老问题，但这里是如何在编译时做到这一点（这在绝大多数情况下是可取的）：http: [//msdn.microsoft.com/en-us/library/7039hzb0 (v=vs .80).aspx](http://msdn.microsoft.com/en-us/library/7039hzb0(v=vs.80).aspx)

我最喜欢的方法：

1.  从“视图”菜单中，选择“跳位顺序”。
2.  选择交互式分配。
3.  双击要成为 Tab 键顺序中第一个控件的控件旁边的 Tab 键顺序框。
4.  单击其他每个控件的选项卡顺序框。
5.  单击表单上的任意位置以保存更改并退出 Tab Order 模式，或按 ESC 退出 Tab Order 模式而不保存更改。

# .net - 查看已分配内存

> ID：50237
> 
> 赞同：6
> 
> 时间：2008-09-08T17:32:55.237
> 
> 标签：.net, memory

我正在寻找一种工具（$，免费，开源；我不在乎），它不仅可以让我查看 .NET 程序的内存统计信息，还可以查看对象层次结构。我真的很希望能够深入每个对象并查看它的足迹，以及它引用的所有对象。

我看过 RedGate 的 Ants Profiler 之类的东西，但这并不是我想要的：我无法查看特定的实例。

编辑：我以前使用过 .NET Memory Profiler（Visual Studio 附带的那个，以及曾经是 SDK 一部分的那个（？）），虽然它真的很好（并且显示了大多数其他人没有的视图） t)，我真正想要的是能够深入了解我的对象层次结构，查看每个对象实例。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-08T18:06:27.933

我使用过 JetBrains DotTrace 和 Redgate Ants，我会推荐这两个。我还使用过的一个鲜为人知的分析器是 .Net Memory Profiler ( [http://memprofiler.com/](http://memprofiler.com/) )，在我使用它时，它提供了与前面提到的两个分析器不同的内存使用视角。我发现 DotTrace 和 Ants 非常相似，尽管每个都略有不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-08T17:36:01.767

[JetBrains dottrace profiler](http://www.jetbrains.com/profiler/)是最好的。没有它我不会工作。在这个领域很难找到一款免费且性能良好的工具。Dottrace 无疑是我用于 .Net 的最佳分析器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-08T17:54:59.770

还有Microsoft .net profiler——我用过一点，它对于免费工具来说还不错。不确定您是否可以遍历对象层次结构，但确实会按类型和随着时间的推移分解内存使用。您甚至可以查看基础数据。

不过，它确实会大大降低应用程序的速度。

# c# - 动态 linq：创建生成 JSON 结果的扩展方法

> ID：50251
> 
> 赞同：3
> 
> 时间：2008-09-08T17:36:16.040
> 
> 标签：c#, linq, json

我一直在尝试创建一个返回 JSON 格式的字符串的动态 linq 扩展方法 - 我正在使用 System.Linq.Dynamic 和 Newtonsoft.Json，但我无法让 Linq.Dynamic 解析“cell=new对象[]”部分。也许太复杂了？有任何想法吗？：

**我的主要方法：**

```
static void Main(string[] args)
{
    NorthwindDataContext db = new NorthwindDataContext();
    var query = db.Customers;
    string json = JSonify<Customer>
                    .GetJsonTable(
                        query, 
                        2, 
                        10, 
                        "CustomerID"
                        , 
                        new string[] 
                            { 
                                "CustomerID", 
                                "CompanyName", 
                                "City", 
                                "Country", 
                                "Orders.Count"
                            });
    Console.WriteLine(json);
} 
```

**JSonify 类**

```
public static class JSonify<T>
{
    public static string GetJsonTable(
        this IQueryable<T> query, 
        int pageNumber, 
        int pageSize, 
        string IDColumnName, 
        string[] columnNames)
    {
        string selectItems =
            String.Format(@"
                        new
                        {
                            {{0}} as ID,
                            cell = new object[]{{{1}}}
                        }", 
                          IDColumnName, 
                          String.Join(",", columnNames));

        var items = new
        {
            page = pageNumber,
            total = query.Count(),
            rows =
                query
                    .Select(selectItems)
                    .Skip(pageNumber * pageSize)
                    .Take(pageSize)
        };

        return JavaScriptConvert.SerializeObject(items);
        // Should produce this result:
        // {
        //    "page":2,
        //    "total":91,
        //    "rows":
        //        [
        //        {"ID":"FAMIA","cell":["FAMIA","Familia Arquibaldo","Sao Paulo","Brazil",7]},
        //        {"ID":"FISSA","cell":["FISSA","FISSA Fabrica Inter. Salchichas S.A.","Madrid","Spain",0]},
        //        {"ID":"FOLIG","cell":["FOLIG","Folies gourmandes","Lille","France",5]},
        //        {"ID":"FOLKO","cell":["FOLKO","Folk och fä HB","Bräcke","Sweden",19]},
        //        {"ID":"FRANK","cell":["FRANK","Frankenversand","München","Germany",15]},
        //        {"ID":"FRANR","cell":["FRANR","France restauration","Nantes","France",3]},
        //        {"ID":"FRANS","cell":["FRANS","Franchi S.p.A.","Torino","Italy",6]},
        //        {"ID":"FURIB","cell":["FURIB","Furia Bacalhau e Frutos do Mar","Lisboa","Portugal",8]},
        //        {"ID":"GALED","cell":["GALED","Galería del gastrónomo","Barcelona","Spain",5]},
        //        {"ID":"GODOS","cell":["GODOS","Godos Cocina Típica","Sevilla","Spain",10]}
        //        ]
        // }

    }

} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-10T23:50:24.377

这真的很丑陋，字符串替换可能存在一些问题，但它会产生预期的结果：

```
public static class JSonify
{
    public static string GetJsonTable<T>(
        this IQueryable<T> query, int pageNumber, int pageSize, string IDColumnName, string[] columnNames)
    {
        string select = string.Format("new ({0} as ID, \"CELLSTART\" as CELLSTART, {1}, \"CELLEND\" as CELLEND)", IDColumnName, string.Join(",", columnNames));
        var items = new
        {
            page = pageNumber,
            total = query.Count(),
            rows = query.Select(select).Skip((pageNumber - 1) * pageSize).Take(pageSize)
        };
        string json = JavaScriptConvert.SerializeObject(items);
        json = json.Replace("\"CELLSTART\":\"CELLSTART\",", "\"cell\":[");
        json = json.Replace(",\"CELLEND\":\"CELLEND\"", "]");
        foreach (string column in columnNames)
        {
            json = json.Replace("\"" + column + "\":", "");
        }
        return json;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T15:25:14.677

感谢您及时的回复。但是，请注意所需的输出在“单元格”数组中没有属性名称（这就是我使用 object[] 的原因）：

"cell":["FAMIA","Familia Arquibaldo",... 与 "cell":{"CustomerID":"FAMIA","CompanyName","Familia Arquibaldo",...

结果旨在与名为“flexify”的 JQuery 网格一起使用，该网格需要这种格式的输出。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-08T20:27:56.423

```
static void Main(string[] args)
{
    NorthwindDataContext db = new NorthwindDataContext();
    var query = db.Customers;
    string json = query.GetJsonTable<Customer>(2, 10, "CustomerID", new string[] {"CustomerID", "CompanyName", "City", "Country", "Orders.Count" });
 }  

public static class JSonify
{
    public static string GetJsonTable<T>(
        this IQueryable<T> query, int pageNumber, int pageSize, string IDColumnName, string[] columnNames)
    {
        string select = string.Format("new ({0} as ID, new ({1}) as cell)", IDColumnName, string.Join(",",     columnNames));
        var items = new
        {
            page = pageNumber,
            total = query.Count(),
            rows = query.Select(select).Skip((pageNumber - 1) * pageSize).Take(pageSize)
        };
        return JavaScriptConvert.SerializeObject(items);
    }
} 
```

# sql - 在关系数据库中建模地理位置

> ID：50252
> 
> 赞同：6
> 
> 时间：2008-09-08T17:36:36.210
> 
> 标签：sql, database-design

我正在设计一个联系人管理系统，并遇到了一个有趣的问题，即以一致的方式对地理位置进行建模。我希望能够记录与特定人相关的位置（工作、学校、家庭等的邮寄地址）。我的想法是创建一个区域设置表，如下所示：

**自治位置（例如国家，例如美国）是其父级的**区域设置（ID、LocationName、ParentID） 。**通过这种方式，我可以任意深度嵌套“政治单位”（国家 > 州 > 城市或国家 > 州 > 城市 > 大学）。一些查询必然涉及递归。**

 **我将不胜感激任何其他建议，或者可能是关于我可能会在此类计划中遇到的可预测问题的建议。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-08T17:39:47.047

听起来对我来说是个好方法。在阅读您的帖子时我不清楚的一件事是“他们自己的父母”是什么意思 - 如果这是为了表明语言环境没有父母，那么您最好使用 null 而不是自己的 ID。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-08T17:47:05.063

您可能希望将 Freebase.com 视为一个站点，该站点已就“位置”的含义以及将位置包含在另一个位置时的含义进行了一些公开讨论。这类问题可以引起很多讨论。

例如，有明显的“地理嵌套”，但不太明显的逻辑嵌套。例如，在严格的地理意义上，梵蒂冈城嵌套在意大利境内。但它并没有在政治上嵌套。同样，如果您的用户位于属于大学的研究中心，但不位于大学的财产上，您是否对这种关系进行建模？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-08T19:03:03.647

我想你可能想多了。大多数系统只存储地址或者国家表是有原因的。以下是一些需要注意的事项：

1.  布朗克斯区的地址是否会将自治市镇作为层次结构中的一个级别？非合并区域中的地址会消除层次结构的“城市”级别吗？您如何模拟大学内的地址与不在大学内的地址？您最终会得到一个参差不齐的层次结构，这将迫使您每次需要在应用程序中显示地址时遍历树。如果您有一个“地址簿”页面，则性能影响可能很大。

2.  我不确定你甚至只有一个层次结构。布朗大学在罗德岛普罗维登斯和罗德岛布里斯托尔设有设施。唯一干净的解决方案是有两个校区的双重层次结构，每个校区在一个层次结构中属于各自的城市，但在另一个层次结构中都属于布朗大学。（一所大学从根本上不同于一个政治区域。你不应该把它们混为一谈。）

3.  邮政编码呢？一些邮政编码包含多个城镇，有时一个城市被分成多个邮政编码。并且（很少）一些邮政编码甚至跨越州界。（根据维基百科，至少......）

4.  您将如何输入数据？当您考虑到虚地址、某些街道的备用名称、不同的国际格式等时，通过解析常规格式的地址来构建数据库可能很困难。而且我认为分层输入每个地址将是一个 PITA。

5.  听起来您正试图在您的应用程序中对整个世界进行建模。您是否真的想要或需要维护一个可以想象包含世界上每个城市、州、省、邮政编码和国家/地区的表格？（或者至少每个你认识的人？）我能想到的唯一的事情就是这个计划会买你是接近，但如果这是你想要的，我只是分别存储州和国家（也许是邮政编码）并添加来自 Google 的纬度和经度数据。

对不起，我太悲观了，但我自己也走上了这条路。它在逻辑上既美观又优雅，但在实践中效果不佳。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T05:00:44.233

这是一个非常灵活的模式的建议。立即警告：对于您实际需要的内容，它可能过于灵活/复杂

位置（LocationID，LocationName）——基本构建块

LocationGroup (LocationGroupID, LocationGroupName, ParentLocationGroupID) -- 这可以有效地封装多个层次结构。你有一个根节点，然后你可以创建多个独立的分支。例如，您可以先按状态拆分，然后创建几个子层次结构，例如 ZIP/city/xxxx

LocationGroupLocation (LocationID, LocationGroupID) -- 下面介绍如何将 Location 与一个或多个层次结构联系起来。例如，您可以将您的房子链接到 ZIP 以及城市......您需要实施的是一个约束，即您不应该能够将一个位置与任何两个层次结构链接起来，其中一个是其他（因为关系已经是隐含的）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-08T21:05:58.127

我会仔细考虑这一点，因为它可能不是必要的功能。为什么不只使用文本字段并让用户输入地址？

记住[KISS 原则](http://en.wikipedia.org/wiki/KISS_principle)（保持简单，愚蠢）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T05:13:36.993

我同意其他帖子，您需要在这里非常小心您的要求。位置可能成为一个棘手的问题，这就是 GIS 系统如此复杂的原因。

如果您确定只需要一个基本的层次结构，我有以下建议：

*   我支持前面的评论，即根级项目不应该将自己作为父级。根级别项目的父项应该有一个空值。始终小心将数据放入没有意义的字段（即表示没有数据的“特殊”值）。这种做法很少在开发者社区**中**被过度使用。
*   考虑 XPath/XML。这是为了记录层次结构以及在检索时处理/解析数据而需要考虑的事情。如果您使用的是 MSSQL Server，则 select 语句中的 XPath 表达式非常适合诸如返回记录的完整位置/层次结构路径之类的任务，因为代码简单且结果快速。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T05:28:00.220

对于地理位置，您可能希望将地址解析为纬度、经度数组（可能使用 Google 地图等）以计算邻近度等。对于地缘政治嵌套......我会选择 KISS 响应。

如果您真的想对其进行建模，也许您需要更通用的类型... Country -> State -> County -> Borough -> Locality -> City -> Suburb -> Street or PO Box -> Number -> -> 公寓等 -> 机构（大学或雇主） -> 部门 -> Subdivision-1 -> subdivision-n ... 你确定不能做 KISS 吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-10-28T19:54:28.153

我正在为全球用户建模一个应用程序，我遇到了同样的问题，但我认为这种方法可能已经在许多企业中使用。但是为什么这个问题没有一个通用的解决方案呢？或者，这个问题是否有一个可以作为起点的最佳解决方案，或者世界上任何人都需要从一开始就考虑解决方案？不幸的是，在 IT 领域，我们随时随地都在做同样的事情。例如，谁没有创建多个用户、客户或产品的数据库？最糟糕的是，世界上所有的企业都做到了。我认为这可以为普遍问题提供通用解决方案。

# java - Java 需要闭包吗？

> ID：50255
> 
> 赞同：46
> 
> 时间：2008-09-08T17:38:18.233
> 
> 标签：java, closures

我最近阅读了很多关于 Java 的下一个版本可能支持[闭包](http://en.wikipedia.org/wiki/Closure_%28computer_science%29)的信息。我觉得我对什么是闭包有一个非常牢固的把握，但是我想不出一个可靠的例子来说明它们如何使面向对象的语言“更好”。谁能给我一个需要（甚至首选）关闭的特定用例？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-04-04T08:23:37.003

作为一名 Lisp 程序员，我希望 Java 社区能够理解以下区别：**作为对象的函数与闭包**。

a)**函数可以命名或匿名**。但它们也可以是它们自己的对象。这允许函数作为参数传递、从函数返回或存储在数据结构中。这意味着函数是编程语言中的第一类对象。

匿名函数并没有给语言增加太多，它们只是允许你以更短的方式编写函数。

b)**闭包是一个函数加上一个绑定环境**。闭包可以*向下*传递（作为参数）或*向上*返回（作为返回值）。这允许函数引用其环境的变量，即使周围的代码不再处于活动状态。

如果你有某种语言**的 a)**，那么问题就来了**b)**怎么办？有些语言有**a)**，但没有**b)**。在函数式编程世界中**，a)**（函数）和**b**（作为闭包的函数）是当今的规范。Smalltalk 长期以来一直有**a)**（*块*是匿名函数），但后来 Smalltalk 的一些方言增加了对**b)**（作为闭包的块）的支持。

你可以想象，如果你在语言中添加函数和闭包，你会得到一个稍微不同的编程模型。

从实用的角度来看，匿名函数添加了一些简短的符号，您可以在其中传递或调用函数。这可能是件好事。

闭包（函数加绑定）允许您创建一个可以访问某些变量（例如计数器值）的函数。现在您可以将该函数存储在一个对象中，访问它并调用它。函数对象的上下文现在不仅是它可以访问的对象，而且是它可以通过绑定访问的变量。这也很有用，但是您可以看到变量绑定与对对象变量的访问现在是一个问题：什么时候应该是*词法*变量（可以在闭包中访问），什么时候应该是某个对象的变量（一个*插槽*）。什么时候应该是闭包或对象？您可以以类似的方式使用两者。学习 Scheme（一种 Lisp 方言）的学生通常的编程练习是使用闭包编写一个简单的对象系统。

结果是更复杂的编程语言和更复杂的运行时模型。太复杂？

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-09-08T17:48:48.427

它们并没有使面向对象的语言变得更好。它们使实用语言更加实用。

如果您正在使用 OO 锤子解决问题 - 将所有内容都表示为对象之间的交互 ​​- 那么闭包就没有意义了。在基于类的 OO 语言中，闭包是烟雾缭绕的密室，事情已经完成，但事后没有人谈论它。从概念上讲，这是可憎的。

在实践中，它非常方便。我真的不想定义一种新类型的对象来保存上下文，为它建立“do stuff”方法，实例化它并填充上下文......我只想告诉编译器，“看，看看我现在可以访问吗？这就是我想要的上下文，这是我想要使用它的代码 - 为我保留这个，直到我需要它为止。

很棒的东西。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-09-08T17:41:12.940

最明显的事情是对所有那些只有一个名为 run() 或 actionPerformed() 或类似方法的类的伪替换。因此，与其创建嵌入了 Runnable 的线程，不如使用闭包。没有比我们现在拥有的更强大，但更方便和简洁。

那么我们*需要*闭包吗？不，他们会很高兴吗？当然，只要他们不像我担心的那样被束缚住了。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-09-08T17:42:20.847

我想为了支持核心函数式编程概念，你需要闭包。[通过对闭包](http://martinfowler.com/bliki/Closure.html)的支持使代码更加优雅和可组合。另外，我喜欢将代码行作为参数传递给函数的想法。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-15T15:21:25.493

有一些非常有用的“高阶函数”可以使用闭包对列表进行操作。高阶函数是具有“函数对象”作为参数的函数。

例如，对列表中的每个元素应用一些转换是一种非常常见的操作。这种高阶函数通常称为“map”或“collect”。[（参见Groovy](http://groovy.codehaus.org/Operators "Groovy 运算符")的 *.spread 运算符）。

例如，在没有闭包的情况下对列表中的每个元素进行平方，您可能会这样写：

```
List<Integer> squareInts(List<Integer> is){
   List<Integer> result = new ArrayList<Integer>(is.size());
   for (Integer i:is)
      result.add(i*i);
   return result;
} 
```

使用闭包和映射以及建议的语法，你可以这样写：

```
is.map({Integer i => i*i}) 
```

（关于原始类型的装箱，这里可能存在性能问题。）

正如 Pop Catalin 所解释的，还有另一个称为“选择”或“过滤器”的高阶函数：它可用于获取列表中符合某些条件的所有元素。例如：

代替：

```
void onlyStringsWithMoreThan4Chars(List<String> strings){
   List<String> result = new ArrayList<String>(str.size()); // should be enough
   for (String str:strings)
      if (str.length() > 4) result.add(str);
   return result;
} 
```

相反，你可以写类似

```
strings.select({String str => str.length() > 4}); 
```

使用该提案。

您可能会查看 Groovy 语法，它是 Java 语言的扩展，现在支持闭包。有关如何处理闭包的更多示例，请参阅[Groovy 用户指南](http://groovy.codehaus.org/Collections "Groovy 用户指南")的集合章节。

备注：

可能需要对“关闭”一词进行一些澄清。我上面显示的严格来说是没有闭包的。它们只是“功能对象”。闭包是可以捕获或“关闭”围绕它的代码的（词法）上下文的所有内容。从这个意义上说，Java 现在有闭包，即匿名类：

```
Runnable createStringPrintingRunnable(final String str){
    return new Runnable(){
       public void run(){
          System.out.println(str); // this accesses a variable from an outer scope
       }
    };
} 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-10T14:23:42.243

Java 不需要闭包，面向对象的语言可以完成闭包所做的一切，使用中间对象存储状态或执行操作（在 Java 的情况下为内部类）。但是闭包作为一种特性是可取的，因为它们极大地简化了代码并提高了可读性，从而提高了代码的可维护性。

我不是 Java 专家，但我使用的是 C# 3.5，而闭包是我最喜欢的语言特性之一，例如以下面的语句为例：

```
// Example #1 with closures
public IList<Customer> GetFilteredCustomerList(string filter) {
    //Here a closure is created around the filter parameter
    return Customers.Where( c => c.Name.Contains(filter)).ToList();
} 
```

现在举一个不使用闭包的等效示例

```
//Example #2 without closures, using just basic OO techniques
public IList<Customer> GetFilteredCustomerList(string filter) {
    return new Customers.Where( new CustomerNameFiltrator(filter));
}
... 
public class CustomerNameFiltrator : IFilter<Customer> {
    private string _filter;
    public  CustomerNameFiltrator(string filter) {
         _filter = filter;
    }
    public bool Filter(Customer customer) {
        return customer.Name.Contains( _filter);
    }
} 
```

我知道这是 C# 而不是 Java，但想法是一样的，闭包有助于简洁，并使代码更短且更具可读性。在幕后，C# 3.5 的闭包做了一些看起来与示例 #2 非常相似的事情，这意味着编译器在幕后创建了一个私有类并将“过滤器”参数传递给它。

Java 不需要闭包来工作，作为开发人员，您也不需要它们，但是，它们很有用并提供好处，这意味着它们在生产语言中是可取的，其目标之一是生产力.

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-04-04T07:28:47.447

> 我最近一直在阅读很多关于 Java 的下一个版本可能支持闭包的信息。我觉得我对什么是闭包有相当的把握，但我想不出一个可靠的例子来说明它们如何使面向对象的语言“更好”。

好吧，大多数使用“闭包”一词的人实际上是指“函数对象”，从这个意义上说，函数对象可以在某些情况下编写更简单的代码，例如在排序函数中需要自定义比较器时。

例如，在 Python 中：

```
def reversecmp(x, y):
   return y - x

a = [4, 2, 5, 9, 11]
a.sort(cmp=reversecmp) 
```

这通过传递自定义比较函数 reversecmp 以相反的顺序对列表 a 进行排序。添加 lambda 运算符使事情变得更加紧凑：

```
a = [4, 2, 5, 9, 11]
a.sort(cmp=lambda x, y : y - x) 
```

Java 没有函数对象，所以它使用“函子类”来模拟它们。在 Java 中，您通过实现 Comparator 类的自定义版本并将其传递给 sort 函数来执行等效操作：

```
class ReverseComparator implements Comparator {
   public compare(Object x, Object y) {
      return (Integer) y - (Integer) x;
   }

...

List<Integer> a = Arrays.asList(4, 2, 5, 9, 11);
Collections.sort(a, new ReverseComparator()); 
```

如您所见，它提供与闭包相同的效果，但更笨拙且更冗长。然而，匿名内部类的添加消除了大部分痛苦：

```
List<Integer> a = Arrays.asList(4, 2, 5, 9, 11);
Comparator reverse = new Comparator() {
   public Compare(Object x, Object y) {
       return (Integer) y - (Integer) x;
   }
}
Collections.sort(a, reverse); 
```

所以我会说Java中函子类+匿名内部类的组合足以弥补真正的函数对象的不足，使它们的添加变得不必要。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-08T17:48:58.897

Java 从 1.1 开始就有闭包，只是以一种非常麻烦和有限的方式。

只要您有一些描述的回调，它们通常很有用。一个常见的情况是抽象出控制流，留下有趣的代码来调用一个没有外部控制流的闭包的算法。

一个简单的例子是 for-each（尽管 Java 1.5 已经有了）。虽然您可以按原样在 Java 中实现 forEach 方法，但它过于冗长而无用。

一个已经对现有 Java 有意义的示例是实现“围绕执行”的习惯用法，从而抽象了资源的获取和释放。例如，文件打开和关闭可以在 try/finally 中完成，而无需客户端代码正确获取详细信息。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-04-04T09:07:18.583

一些人已经说过或暗示，闭包只是语法糖——做你已经可以用匿名内部类做的事情，并使它更方便地传递参数。

它们*是*语法糖，就像 Java 是汇编器的语法糖一样（为了论证，“汇编器”可以是字节码）。换句话说，他们提高了抽象级别，这是一个重要的概念。

闭包将函数作为对象的概念提升为第一类实体——增加了代码的表达能力，而不是用更多的样板来使代码混乱。

Tom Hawtin 已经提到了一个贴近我心的例子——实现 Execute Around 习惯用法，这几乎是将 RAII 引入 Java 的唯一方法。几年前，当我第一次听说可能会关闭时[，我写了一篇关于这个主题的博客文章。](http://www.levelofindirection.com/journal/2009/9/24/raii-and-closures-in-java.html)

具有讽刺意味的是，我认为闭包对 Java 有利的原因（更多的表达力和更少的代码）可能是让许多 Java 拥护者感到不安的原因。Java 有一种“把所有东西都拼出来”的心态。闭包是对更实用的做事方式的认可——我也认为这是一件好事，但可能会淡化 Java 社区中许多人所珍视的纯 OO 信息。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-04T02:18:41.703

当闭包最终出现在 Java 中时，我会兴高采烈地摆脱我所有的自定义比较器类。

```
myArray.sort( (a, b) => a.myProperty().compareTo(b.myProperty() ); 
```

......看起来比......好多了

```
myArray.sort(new Comparator<MyClass>() {
   public int compare(MyClass a, MyClass b) {
      return a.myProperty().compareTo(b.myProperty();
   }
}); 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-05-13T13:44:19.883

现在[JDK8](http://jdk8.java.net/lambda/)即将发布，有更多可用信息可以丰富这个问题的答案。

Oracle 的语言架构师 Bria Goetz 发表了一系列关于 Java 中 lambda 表达式当前状态的论文（尚未草稿）。它还涵盖了闭包，因为他们计划在即将发布的 JDK 中发布它们，该 JDK 应该[在 2013 年 1 月左右](http://openjdk.java.net/projects/jdk8/)完成代码，并应该在 2013 年年中左右发布。

*   [Lambda 的状态](http://cr.openjdk.java.net/~briangoetz/lambda/lambda-state-4.html)：在本文的第一页或第二页中，试图回答这里提出的问题。虽然我仍然觉得它的论点很短，但它充满了例子。
*   [The State of Lambda - Libraries Edition](http://cr.openjdk.java.net/~briangoetz/lambda/collections-overview.html)：这也很有趣，因为它涵盖了惰性评估和并行性等优点。
*   [The Translation of Lambda Expressions](http://cr.openjdk.java.net/~briangoetz/lambda/lambda-translation.html)：它基本上解释了 Java 编译器完成的脱糖过程。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-06-23T14:29:05.350

在过去的几天里，我一直在思考这个**非常有趣的问题的话题。**首先，如果我理解正确的话，Java 已经有了一些基本的闭包概念（通过匿名类定义），但是要引入的新特性是对基于匿名函数的闭包的支持。

这个扩展肯定会让语言更具表现力，但我不确定它是否真的适合其他语言。Java 被设计为一种不支持函数式编程的面向对象语言：新语义是否易于理解？Java 6 甚至没有函数，Java 7 会有匿名函数但没有“普通”函数吗？

我的印象是，随着函数式编程等新的编程风格或范式变得越来越流行，每个人都希望在自己喜欢的 OOP 语言中使用它们。这是可以理解的：人们希望在采用新功能的同时继续使用他们熟悉的语言。但这样一来，语言就会变得非常复杂并失去连贯性。

所以我目前的态度是在面向对象编程方面坚持使用 Java 6（我希望 Java 6 仍然会被支持一段时间），如果我真的对做 OOP + FP 感兴趣，可以看看其他一些语言，比如Scala（Scala 从一开始就被定义为多范式，可以很好地与 Java 集成）而不是切换到 Java 7。

我认为 Java 的成功归功于它结合了一种简单的语言与非常强大的库和工具这一事实，而且我不认为像闭包这样的新特性会使它成为一种更好的编程语言。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-04-04T08:44:44.690

命令式语言中的闭包（例如：JavaScript、C#、即将到来的 C++ 更新）与匿名内部类不同。他们需要能够捕获对局部变量的可修改引用。Java 的内部类只能捕获局部`final`变量。

几乎任何语言功能都可以被批评为非必要的：

*   `for`, `while`,`do`都只是`goto`/的语法糖`if`。
*   内部类是具有指向外部类的字段的类的语法糖。
*   泛型是强制转换的语法糖。

完全相同的“非必要”论点应该阻止包含上述所有功能。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-08T17:50:16.240

作为一名试图自学 lisp 以成为一名更好的程序员的 Java 开发人员，我想说我希望看到 Josh Block 提议的闭包实现。我发现自己使用匿名内部类来表达一些事情，比如在聚合一些数据时如何处理列表的每个元素。将其表示为一个闭包会很好，而不是必须创建一个抽象类。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-08T17:43:36.397

[Java 闭包示例](http://www.blog.dannynet.net/archives/87)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-04T06:34:57.373

不仅是本吉史密斯，我也喜欢你能做到的...

myArray.sort{ it.myProperty }

当属性的自然语言比较不适合您的需要时，您只需要显示的更详细的比较器。

我非常喜欢这个功能。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-01-12T04:03:44.987

您可能想看看 Groovy，这是一种与 Java 最兼容的语言，并且在 JRE 上运行，但支持闭包。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-03-18T19:59:05.013

可读性和可维护性怎么样...单行闭包更难理解和调试，imo 软件寿命很长，您可以让具有基本语言知识的人来维护它...所以比单行更好地展开逻辑为了便于维护...通常没有软件明星在软件发布后负责维护...

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-03-07T17:25:58.980

匿名函数中缺乏绑定[即，如果外部上下文的变量（以及方法参数，如果有一个封闭的方法）被声明为**最终**的，那么它们是可用的，但不是其他的），我不太明白这个限制实际上买了什么.

无论如何，我大量使用“最终”。所以，如果我的意图是在闭包内使用相同的对象，我确实会在封闭范围内声明这些对象最终。但是，让“闭包 [java aic]” 像通过构造函数传递一样获取引用的副本会有什么问题（事实上这就是它的完成方式）。

如果闭包想要覆盖引用，那就这样吧；它会在不更改封闭范围看到的副本的情况下这样做。

如果我们认为这会导致代码不可读（例如，在构造函数调用 aic 时可能无法直接查看对象引用是什么），那么至少让语法不那么冗长怎么样？斯卡拉？时髦？

# .net - .MSI 并不总是卸载以前的版本

> ID：50268
> 
> 赞同：4
> 
> 时间：2008-09-08T17:44:56.800
> 
> 标签：.net, windows-installer

在许多应用程序中，我们使用 Visual Studio 安装项目创建 MSI 安装程序。在大多数情况下，安装工作正常，但有时没有正确卸载以前的版本。用户最终会在桌面上看到两个图标，并且在“添加/删除程序”列表中，该应用程序出现了两次。我们还没有找到任何模式，并且在大多数情况下，安装程序可以正常工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-08T18:18:55.297

以前版本的卸载失败时会发生什么取决于 RemoveExistingProducts 操作的顺序。我过去曾写过关于各种选项的摘要：http: [//jpassing.wordpress.com/2007/06/16/where-to-place-removeexistingproducts-in-a-major-msi-upgrade/](http://jpassing.wordpress.com/2007/06/16/where-to-place-removeexistingproducts-in-a-major-msi-upgrade/)。

不幸的是，在使用 VS 设置项目时，您无法控制 RemoveExistingProducts 排序（除非您在构建 MSI 后使用 Orca 对其进行编辑，这通常是不切实际的）。但是，如果您的设置项目并非完全不重要，我强烈建议您使用不同的 MSI 创作工具，如 WiX 或商业工具之一。

# css - 在 Safari 浏览器中浮动

> ID：50280
> 
> 赞同：3
> 
> 时间：2008-09-08T17:50:07.130
> 
> 标签：css, safari, css-float

我有一个网站我制作得非常快，它使用浮动来显示不同的内容部分。浮动内容和具有额外边距的内容在 FF/IE 中都显示得很好，但在 safari 中，其中一个 div 完全隐藏。我尝试切换到`padding`and `position:relative`，但对我没有任何效果。如果我取出代码以将其显示在右侧，它会再次显示但在浮动内容下方。

似乎导致问题的css的主要部分是：

```
#settings{
    float:left;
}

#right_content{
    margin-top:20px;
    margin-left:440px;
    width:400px;
} 
```

无论我是否为#settings div 指定大小，这都会给我相同的结果。任何想法，将不胜感激。

该站点位于：http: [//frickinsweet.com/tools/Theme.mvc.aspx](http://frickinsweet.com/tools/Theme.mvc.aspx)以查看源代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-08T18:00:55.247

您是否尝试过将#right_content div 向右浮动？

```
#right_content{
  float: right;
  margin-top: 20px;
  width: 400px;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T18:21:39.473

我相信错误在于颜色选择器正在生成的标记。我保存了页面并删除了颜色选择器的代码，它在 IE/FF/SF 中呈现良好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-08T18:03:24.460

对不起，我也应该提到这一点。我尝试将内容向右浮动，另外尝试将其向左浮动并设置位置，认为两个 div 将从 left:0 开始，设置右侧的边距会将其移过。

谢谢

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T18:03:42.573

您应该事先解决一些问题：

1.  你的`<style>`标签在`<body>`，当它属于`<head>`
2.  您的一种内联样式中有一个错字“真实”：

    ```
    <a href="http://feeds.feedburner.com/ryanlanciaux" style="position:realtive; top:-6px;"> 
    ```

尝试让您的页面进行[验证](http://validator.w3.org/check?uri=http%3A%2F%2Ffrickinsweet.com%2Ftools%2FTheme.mvc.aspx)；这应该使调试实际问题变得容易得多。

# pdo - 持久的数据库连接——是还是不是？

> ID：50303
> 
> 赞同：54
> 
> 时间：2008-09-08T18:01:11.423
> 
> 标签：pdo, persistence, database-connection

我在项目中使用 PHP 的 PDO 层进行数据访问，我一直在阅读它，发现它对持久性数据库连接具有良好的先天支持。我想知道何时/是否应该使用它们。我会在重 CRUD 的应用程序中看到性能优势吗？是否有缺点需要考虑，可能与安全性有关？

如果这对您很重要，我使用的是 MySQL 5.x。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-09-09T10:54:49.413

您可以将其用作粗略的“规则集”：

**是**，使用持久连接，如果：

*   只有少数应用程序/用户访问数据库，即您不会导致 200 个打开（但可能是空闲）连接，因为在同一主机上共享了 200 个不同的用户。
*   数据库正在您通过网络访问的另一台服务器上运行
*   一个（一个）应用程序非常频繁地访问数据库

**否**，不要使用持久连接，如果：

*   您的应用程序每小时只需访问数据库 100 次。
*   您有许多网络服务器访问一台数据库服务器
*   您在 prefork 模式下使用 Apache。它为每个子进程使用一个连接，这可以相当快地增加。（通过评论中的@Powerlord）

使用持久连接相当快，尤其是当您通过网络访问数据库时。如果数据库在同一台机器上运行并没有太大区别，但它仍然快一点。然而——顾名思义——连接是持久的，即它保持打开状态，即使它没有被使用。

问题在于，在“默认配置”中，MySQL 只允许 1000 个并行“开放通道”。之后，拒绝新连接（您可以调整此设置）。因此，如果您有 - 比方说 - 20 台 Web 服务器，每台服务器上有 100 个客户端，并且每个服务器每小时只有一个页面访问权限，那么简单的数学将告诉您，您需要 2000 个与数据库的并行连接。那是行不通的。

Ergo：仅用于有大量请求的应用程序。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-10-20T13:09:01.770

简而言之，我的经验表明应尽可能避免持久连接。

请注意，对于使用 mysql_pconnect 创建的连接，mysql_close 是无操作 (no-op)。这意味着客户端不能随意关闭持久连接。当连接上没有任何活动超过**wait_timeout**时，mysqldb 服务器将关闭此类连接。如果**wait_timeout**值很大（比如 30 分钟），那么 mysql 数据库服务器可以轻松达到**max_connections**限制。在这种情况下，mysql db 将不会接受任何未来的连接请求。*这是您的寻呼机开始发出哔哔声的时候。*

为了避免达到**max_connections**限制，使用持久连接需要仔细平衡以下变量...

1.  一台主机上的 apache 进程数
2.  运行 apache 的主机总数
3.  mysql db服务器中的wait_timout变量
4.  mysql db服务器中的max_connections变量
5.  一个 apache 进程在重新生成之前服务的请求数

因此，经过充分考虑，请使用持久连接。您可能不想为了从持久连接中获得的小小收益而引发复杂的运行时问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-08T18:03:15.773

创建与数据库的连接是一项相当昂贵的操作。持久连接是个好主意。在 ASP.Net 和 Java 世界中，我们有“连接池”，这大致相同，也是一个好主意。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-08T18:16:39.953

IMO，这个问题的真正答案是最适合您的应用程序。我建议您使用持久连接和非持久连接对您的应用程序进行基准测试。

Maggie Nelson @ [Objectively Oriented](http://www.objectivelyoriented.com/2008/08/to_persist_or_not_to_persist.html)在 8 月发布了有关此问题的信息，[Robert Swarthout](http://www.robertswarthout.com/2008/08/benchmarking-of-mysql-persistent-connections-vs-non-persistent-connections/)也发布了附带的一些硬性数据。两本都很不错的读物。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T13:34:55.083

在我的愚见：

当使用 PHP 进行 Web 开发时，您的大部分连接将仅在页面执行的生命周期内“存活”。持久连接将花费您很多开销，因为您必须将其放入会话或类似的东西中。

99% 的情况下，在页面执行结束时终止的单个非持久连接可以正常工作。

另外 1% 的时间，您可能不应该在应用程序中使用 PHP，并且没有适合您的完美解决方案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T19:09:27.593

通常，您有时需要使用非持久连接，并且最好将单一模式应用于数据库连接设计（只要在您的上下文中使用持久连接的好处相对较小。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T19:06:22.810

我本来打算问同样的问题，但我不会再问同样的问题，我只会添加一些我发现的信息。

*   [PHP 持久连接是邪恶的吗？](http://www.mysqlperformanceblog.com/2006/11/12/are-php-persistent-connections-evil/)
*   [持久数据库连接](http://us2.php.net/manual/en/features.persistent-connections.php)

还值得注意的是，较新的 mysqli 扩展甚至不包括使用持久数据库连接的选项。

我目前仍在使用持久连接，但计划在不久的将来切换到非持久连接。

# export - 是否可以将 Navision 5.0 导出到 Word/Excel 到 OpenOffice.org？

> ID：50306
> 
> 赞同：2
> 
> 时间：2008-09-08T18:03:18.080
> 
> 标签：export, openoffice.org, navision

Navision 5.0 包含导出到 Word 或 Excel 的功能。是否可以使用 OpenOffice.org Writer 或 Calc 来代替它？如果是这样，必须做些什么来设置它？

我的 Navision 经销商告诉我，该功能最适用于 Office 2007，并且可以导出到 Excel 2003。没有提到 Office 2000（这是我们目前主要安装的）或 OpenOffice.org。我希望在 OpenOffice.org 3.0 发布时能够在整个公司实现标准化，以避免将每个人都升级到 Microsoft Office 2007 的费用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-11-06T09:07:00.257

我知道这是一个老问题，但我会添加答案以防万一有人来这里：

您无需自定义即可直接导出到 OpenOffice。您唯一需要做的就是进入工具 > 管理样式表...并修改现有的样式表，以便它们打开 OpenCalc 和 OpenWrite 而不是 Excel 和 Word。

注意：自从我上次配置它已经有一段时间了，但我似乎记得您可能需要导出和重新导入样式表以更改关联的程序。

这很简单，您实际上可以保留这两个选项（导出到 Excel/导出到 OpenCalc），以便需要 MS Office 的用户可以使用 Excel，而其余用户则使用 OpenCalc。

此答案适用于在 Dynamics Nav 5.0 和 Nav 5.0SP1 中导出到 Word 和 Excel 的功能。我还没有在 Dynamics Nav 2009 (Role Tailored Client) 中尝试过。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T08:17:31.013

为了从 Navision 导出，您需要在机器上安装 Microsoft Excel 2003 或 2007（因为导出过程使用自动调用 Excel）。但是，在那之后，您绝对可以使用 Open Office 打开导出的文件。

但是，您不能直接导出到 OpenOffice。至少，不是没有定制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-08T21:31:11.060

您应该能够将文档导出为 word 或 excel，然后使用 OpenOffice 打开文档。无需额外设置。

# visual-studio - 为什么从 Visual Studio 2008 中删除了在新 ATL 项目中使用属性的选项？

> ID：50310
> 
> 赞同：3
> 
> 时间：2008-09-08T18:04:11.650
> 
> 标签：visual-studio, visual-studio-2008, visual-c++, atl

这是来自 MSDN 评论的文本：“根据 ATL Internals (2ed) 一书，不推荐使用属性，不应在新的 ATL 项目中使用。”

但为什么？！！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T00:49:19.900

在 ATL 中，这些属性是一个编译器技巧。它们不像 C# 中的属性那样是平台的核心部分。它们也比宏更容易调试，并且转储生成的属性代码的方法很麻烦。

我怀疑另一个问题可能是 C++ 编译器兼容性和标准遵守。属性并没有使 C++ 代码更漂亮，也许这种语法可能会在未来版本的真正 C++ 标准中使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-10T10:59:01.553

本书的附录 D 对此进行了说明。

属性化 ATL 需要编译器扩展，遇到的问题包括

*   调试属性生成的代码或属性与代码之间的交互
*   无法控制生成的代码
*   错误，尤其是在连接点周围

# c++ - 在 C++ 中创建和流式传输大型 XML 文档

> ID：50311
> 
> 赞同：1
> 
> 时间：2008-09-08T18:05:14.193
> 
> 标签：c++, xml

我有一些代码可以创建一个相当大的 xml DOM 并将其写入一个文件（最大 50-100MB）。它基本上创建了 DOM，然后在其上调用 toString 并使用 ofstream 将其写出。有没有办法获得生成的dom的流输出，这样它就不会一次在内存中创建整个结构然后复制它等等？创建节点后，我不会修改任何节点，以便它可以将其写出并立即释放内存。我可以编写自己的 xml 类来构建 xml，但是......我认为这不是一个好主意，因为当涉及到转义等时我可能会错过一些东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T15:33:23.813

好的，原来 libxml2 有一个流式 API：

[http://xmlsoft.org/examples/testWriter.c](http://xmlsoft.org/examples/testWriter.c)

这是一种有点旧的风格（非常 C-ish），但你可以围绕它编写你的包装器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T11:29:55.007

我会推荐[GenX](http://www.tbray.org/ongoing/When/200x/2004/02/20/GenxStatus)作为流式 XML 编写器，我在[Programmer's Notepad](http://pnotepad.org/)中使用它，它很有效，您可以在源代码中查看使用示例。速度极快，并且可以生成良好的 UTF-8 XML。使用时的内存使用量应大致保持不变。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T07:18:22.910

查看关键字“C++ XML writer;” XML 编写器将 XML 生成到文件中，而无需在内存中构建整个 DOM，因此他们根本不需要使用太多内存。您没有提到平台，但 Microsoft XmlLite 有 IXmlWriter。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-08-04T09:40:13.523

生成有效的 XML 真的没什么。你担心的逃避是微不足道的。

这里有一个用于流式编写 XML 的库：[https](https://code.google.com/p/xml-writer-cpp/) ://code.google.com/p/xml-writer-cpp/——如果没有别的，它对教育目的很有用。

# linux - 在 shell 脚本中获取 CPU 使用率？

> ID：50312
> 
> 赞同：8
> 
> 时间：2008-09-08T18:05:34.300
> 
> 标签：linux, shell, scripting

我正在针对 Java 进程运行一些[JMeter测试，以确定 Web 应用程序在负载下的响应速度（500 多个用户）。](http://jakarta.apache.org/jmeter/)JMeter 将给出每个 Web 请求的响应时间，并且我编写了一个脚本来每 X 秒 ping 一次 Tomcat 管理器，这将获得 JVM 堆的当前大小。

我想在服务器上收集 Tomcat 使用的 CPU 百分比的统计信息。我尝试使用`ps`这样的 shell 脚本来执行此操作：

```
PS_RESULTS=`ps -o pcpu,pmem,nlwp -p $PID` 
```

...每 X 秒运行一次命令并将结果附加到文本文件中。（对于任何想知道的人，`pmem`= % 内存使用率并且`nlwp`是线程数）

但是，我发现这给出了与我想要的不同的“CPU 利用率百分比”定义 - 根据 ps 的联机帮助页，`pcpu`定义为：

> “##.#”格式的进程的cpu利用率。它是使用的 CPU 时间除以进程运行的时间（cputime/realtime 比率），以百分比表示。

换句话说，`pcpu`给了我进程*生命周期*内进程的 % CPU 利用率。

由于我想每 X 秒采样一次，我想只收集当前时间进程的 CPU 利用率 - 类似于`top`给我的结果（自上次更新以来进程的 CPU 利用率）。

如何从 shell 脚本中收集它？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-08T18:21:06.027

使用`top -b`（和其他开关，如果你想要不同的输出）。它只会转储到标准输出而不是跳入诅咒窗口。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-08T21:08:34.283

我发现在服务器上执行 JMeter 之类的测试时监控服务器的最有用的工具是[dstat](http://dag.wieers.com/home-made/dstat/.)。它不仅为您提供来自服务器的一系列统计信息，它还输出到 csv 以便轻松导入电子表格，并允许您使用 Python 编写的模块扩展该工具。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-03-14T21:44:40.097

用户负载：`top -b -n 2 |grep Cpu |tail -n 1 |awk '{print $2}' |sed 's/.[^.]*$//'` 系统负载：`top -b -n 2 |grep Cpu |tail -n 1 |awk '{print $3}' |sed 's/.[^.]*$//'` 空闲负载：`top -b -n 1 |grep Cpu |tail -n 1 |awk '{print $5}' |sed 's/.[^.]*$//'`

每个结果都是一个小数点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-08T18:28:36.757

在我的脑海中，我将使用系统状态的 /proc 文件系统视图 - 查看*man 5 proc*以查看 /proc/PID/stat 条目的格式，其中包含总 CPU 使用信息，并使用/proc/stat 获取全局系统信息。要获取“当前时间”使用情况，您可能真的是指“最近 N 秒内使用的 CPU”；取两个相距不远的样本，以查看当前的 CPU 消耗率。然后，您可以将这些值转换为有用的东西。但实际上，这可能更像是一个 Perl/Ruby/Python 工作，而不是一个纯 shell 脚本。

您可能能够使用 /proc/PID/status 获得您所追求的粗略数据，它会为进程提供睡眠平均值。虽然数据很粗略。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-25T11:08:26.793

也使用 1 作为迭代计数，因此您将获得当前快照，而无需等待在 $delay 时间内获得另一个快照。

```
top -b -n 1 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-01-28T13:19:18.337

这不会为您提供每个进程的指标，但[压力终端 UI](https://amanusk.github.io/s-tui/)对于了解您对盒子的惩罚程度非常有用。添加`-c`标志以使其将数据转储到 CSV 文件。

[![在此处输入图像描述](https://i.stack.imgur.com/lXNuM.png)](https://i.stack.imgur.com/lXNuM.png)

# javascript - 您如何允许在内部 Windows 身份验证 Intranet 上上传多个文件？

> ID：50315
> 
> 赞同：3
> 
> 时间：2008-09-08T18:06:45.717
> 
> 标签：javascript, flash, authentication, activex, file-upload

我有几个解决方案，但没有一个能完美运行。

**平台**

1.  ASP.NET/VB.NET/.NET 2.0
2.  IIS 6
3.  IE6（主要），部分 IE7；Firefox 不是必需的，但很有用

*允许的第 3 方选项*

1.  闪光
2.  ActiveX（想避免）
3.  Java（想避免）

**目前的尝试**

*Gmail 样式*：您可以使用 javascript 添加新的上传元素（输入类型='file'），然后单击按钮一次性上传它们。这可行，但仍需要大量点击。（我能够使用不可见的 ActiveX 控件来检测文件大小之类的东西，这很有用。）

*Flash Uploader*：我发现了几个 Flash Upload 控件，它们使用 1x1 flash 文件作为上传器，可以通过 javascript 调用。（一个这样的控件是[FancyUpload](http://digitarald.de/project/fancyupload/)，另一个是[Dojo 的 Multiple File Uploader](http://www.sitepen.com/blog/2008/09/02/the-dojo-toolkit-multi-file-uploader/)，另一个是[CodeProject 的 darick_c 的](http://www.codeproject.com/KB/aspnet/FlashUpload.aspx)一个。）这些让我很兴奋，但我很快遇到了两个问题：

1.  Flash 10 将破坏用于调用多文件上传对话框的功能。解决方法是使用透明的闪光框架，或者只是使用闪光按钮来调用对话框。这不是什么大不了的事。
2.  当 Flash 文件尝试上传文件时，我们的 Intranet 上使用的集成 Windows 身份验证未使用，提示用户输入凭据。解决方法是使用无 cookie 会话，由于其他几个原因，这对我们的项目来说将是一场噩梦。

*Java Uploader*：我注意到几个基于 Java 的多文件上传器，但大多数似乎都需要花钱。如果我发现一个非常好用的，我可以安排购买它。我宁愿不要。我也不喜欢他们中的大多数人的样子。我喜欢 FancyUpload，因为它与 html/javascript 交互，因此我可以轻松地以任何我想要的方式设置和管理它。

*ActiveX Uploader*：我也找到[了一个 ActiveX 解决方案](http://support.persits.com/xupload/demo1.asp)。ActiveX 似乎可以工作。我会自己写而不是买那个。这将是我最后的手段，我想。

**解析度**

我希望能够使用 FancyUpload 之类的东西。如果我能以某种方式获得凭据提示，那将是完美的。但是，根据我的研究，似乎唯一真正的解决方法是无 cookie 会话，这是我做不到的。

所以，问题是：有没有办法解决上面提出的问题，或者有没有我没有列出的不同的解决方案可以实现相同的目标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T08:58:25.500

我认为集成 Windows 身份验证没有任何解决方法。您可以做的是将文件保存到一个通用的不受保护的文件夹中，并且在 swfupload 的情况下，使用处理程序在文件完全上传时移动文件

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T20:54:06.050

您也可以尝试[SWFUpload](http://www.swfupload.org/) - 它适合您的 Flash Uploader“类别”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-08T17:33:45.117

我们公司使用支持此功能的 ajaxuploader.com。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T08:49:57.033

在 Internet Explorer 中，FileReference.upload（快速上传）*也将*发送 cookie。

此行为仅在其他浏览器中运行时才会中断。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T15:35:07.910

[@davidinbcn.myopenid.co](https://stackoverflow.com/questions/50315/how-do-you-allow-multiple-file-uploads-on-an-internal-windows-authentication-in#70521)：这基本上就是我解决这个问题的方法。但是，为了提供更详细的答案，我在这里发布我的解决方案。

**解决方案！**

创建两个 Web 应用程序或网站，或其他任何东西。

**应用程序 A**是一个简单的 Web 应用程序。此应用程序的目的是接收文件上传并将它们保存到适当的位置。将此设置为允许匿名访问。然后制作一个 ASPX 页面，该页面接受发布的文件并将它们保存到给定位置。（我在 Intranet 上执行此操作。Internet 站点这样做可能会使自己面临安全问题。如果是这种情况，请采取额外的预防措施。）此页面背后的代码如下所示：

```
Dim uploads As HttpFileCollection = HttpContext.Current.Request.Files
If uploads.Count > 0 Then
    UploadFiles(uploads)
Else
    result = "error"
    err = "File Not Uploaded"
End If 
```

**应用程序 B**是允许文件上传的主站点。将其设置为不允许匿名访问的经过身份验证的 Web 应用程序。然后，将[FancyUpload](http://digitarald.de/journal/54706744/fancyupload-for-flash-10/#comments)（或类似解决方案）放置在此站点的页面上。将其配置为将其文件发布到应用程序 A 的上传 ASPX 页面。

# html - 如何禁止 Firefox 密码字段完成？

> ID：50316
> 
> 赞同：17
> 
> 时间：2008-09-08T18:07:50.193
> 
> 标签：html, firefox

我正在开发一个网站。我使用的是单页 web 应用程序样式，因此网站的所有不同部分都通过 AJAX 处理到 index.php 中。当用户登录并告诉 Firefox 记住他的用户名和密码时，网站上的所有输入框都会自动填充该用户名和密码。这是更改密码表单上的问题。如何防止 Firefox 自动填写这些字段？我已经尝试给他们不同的名字和ID。

编辑：[有人已经问过这个](https://stackoverflow.com/questions/32369/disable-browser-save-password-functionality)。谢谢乔尔·库霍恩。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-08T18:10:28.533

来自 Mozilla 的文档

```
<form name="form1" id="form1" method="post" autocomplete="off"
  action="http://www.example.com/form.cgi">
[...]
</form> 
```

[http://developer.mozilla.org/en/How_to_Turn_Off_Form_Autocompletion](http://developer.mozilla.org/en/How_to_Turn_Off_Form_Autocompletion)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2015-06-17T17:04:55.357

该`autocomplete="off"`方法对我不起作用。我意识到 Firefox 在它遇到的第一个密码字段中注入了保存的密码，所以对我有用的解决方案是在密码更新字段之前创建一个虚拟密码字段并将其隐藏。像这样：

```
<input type="password" style="display: none;" />
<input type="password" name="password_update" /> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-08T18:10:05.413

您是否尝试过在输入标签中添加 autocomplete="off" 属性？不确定它是否会起作用，但值得一试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T18:13:32.237

您的所有输入框都设置为 type=password 吗？这样就可以了。您可以做的一件事，我完全不确定这是不是最好的答案是将输入框保留为输入类型，只需使用 javascript 和 onkeydown 事件将星号放在输入框中，而不是使用浏览器渲染它。Firefox 不会预先填充它。

顺便说一句，我不得不开发单页网络应用程序，我非常讨厌它。为什么要剥夺用户为页面添加书签的能力？使用后退按钮？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-02-14T17:44:49.753

添加到这个答案[https://stackoverflow.com/a/30897967/1333247](https://stackoverflow.com/a/30897967/1333247)

这是为了防止您在密码字段前面还有一个用户字段，并且也想禁用它的自动完成功能（例如路由器网络配置、设置代理用户和密码）。

只需在虚拟密码字段前面创建一个虚拟用户字段以隐藏用户名自动完成：

```
<input type="text" style="display: none;" />
<input type="password" style="display: none;" />
<input type="password" name="password_update" /> 
```

根据[文档](https://developer.mozilla.org/en-US/docs/Web/Security/Securing_your_site/Turning_off_form_autocompletion#The_autocomplete_attribute_and_login_fields)，这是关于登录自动完成的。要禁用正常的（例如搜索词完成），只需使用

```
autocomplete="off" 
```

表单或输入上的属性。要禁用两者，您需要两者，因为该属性不会禁用登录自动完成。

# asp.net - 如何阻止 Visual Studio 的“发布网站”发布我的 _ReSharper 文件夹？

> ID：50318
> 
> 赞同：2
> 
> 时间：2008-09-08T18:09:32.123
> 
> 标签：asp.net, visual-studio, deployment

这真的很烦人，因为它们不是项目的一部分。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-12-03T19:11:50.490

我知道这真的很老了，但也许其他人会得到我的回复。

我在这里找到了解决方案：[http ://www.meadow.se/wordpress/?p=137](http://www.meadow.se/wordpress/?p=137)

基本上，将这些行添加到选项卡上方的 Web 部署项目文件的底部。

只需将您的文件夹或文件也放在那里，它就不会被复制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T18:16:52.947

Visual Studio Web 部署插件允许您排除文件夹等。 [VS2005](http://msdn.microsoft.com/en-us/asp.net/aa336619.aspx) [VS2008](http://www.microsoft.com/downloads/details.aspx?FamilyId=0AA30AE8-C73B-4BDD-BB1B-FE697256C459&displaylang=en)

[也是关于Web 部署插件](http://www.codedigest.com/Articles/VisualStudio/126_Web_Deployment_Project_for_Visual_Studio_2005_and_2008.aspx)的一篇不错的文章

# wpf - WPF DatePicker：什么是最好的？

> ID：50327
> 
> 赞同：5
> 
> 时间：2008-09-08T18:16:38.890
> 
> 标签：wpf

我需要一个用于 WPF 应用程序的 Datepicker。什么被认为是最好的？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-22T22:31:35.583

### 还有一个[WPF 工具包](http://www.codeplex.com/wpf)，它有一个 DatePicker/Calendar 控件

（我加了重点，因为这是答案）

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-02-17T14:09:00.877

这是一个老问题，但为了记录，我想指出**这个控件包含在 .NET 4**中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-09T11:57:55.313

我没用过 Marlon 的，但我用过[Kevin Moore 的](http://j832.com/bagotricks/)。在我使用它的时候，我不得不[解决](http://kentb.blogspot.com/2007/07/wpf-and-date-entry.html)一些错误。除了这些问题，它似乎确实运作良好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-29T10:58:06.177

如果你付钱[Telerik](http://www.telerik.com/products/wpf.aspx)有一个很棒的 DatePicker 和 Calender

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T18:17:25.910

我正在考虑使用这个：[Marlon Grech Date Picker](http://marlongrech.wordpress.com/2007/09/11/wpf-datepicker/)。

# asp.net - 为异步 ASP.NET 验证器控件覆盖 ScriptControl 或 BaseValidator？

> ID：50330
> 
> 赞同：5
> 
> 时间：2008-09-08T18:17:11.823
> 
> 标签：asp.net, validation, asp.net-ajax

我计划开发一个 ASP.NET 服务器控件来为新用户注册提供异步用户名可用性验证。该控件将允许开发人员将其指向“用户名”文本框，它将提供用户名是否可用的指示。像[这个例子](http://encosia.com/2007/07/02/aspnet-username-availability-checking-via-ajax/)一样，但没有笨重的 UpdatePanel。

让我头疼的一个设计决定是是否继承自**ScriptControl**或**BaseValidator**。

通过将其实现为**ScriptControl**，我可以使客户端部分更容易处理并使用 resx 轻松本地化它。

但是，我想确保验证器相对于 Page.IsValid 正常运行。我知道这样做的唯一方法是覆盖**BaseValidator**并实现`EvaluateIsValid()`.

所以，我的问题是，你会如何建议构建这个控件？从 BaseValidator 继承是使验证器部分正确的最佳（唯一）方法，还是我可以通过其他方式做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-08T19:52:08.053

[如果您实现IScriptControl](http://msdn.microsoft.com/en-us/library/system.web.ui.iscriptcontrol.aspx)接口同时还从 BaseValidator 派生，您应该能够做到这两点：

```
public class YourControl : IScriptControl, BaseValidator 
```

要实现 IScriptControl 接口意味着您的控件还必须具有 GetScriptReferences 和 GetScriptDescriptors 方法。

# c# - TreeView 拖放帮助 - _无效的 FORMATETC 结构_ 异常

> ID：50332
> 
> 赞同：3
> 
> 时间：2008-09-08T18:17:53.537
> 
> 标签：c#, .net, winforms

我正在尝试使用作为 TreeView 控件的源来实现拖放功能。当我在节点上启动拖动时，我得到：

*无效的 FORMATETC 结构（来自 HRESULT 的异常：0x80040064 (DV_E_FORMATETC)）*

ItemDrag 处理程序（发生异常的地方）如下所示：

```
private void treeView_ItemDrag(object sender,
        System.Windows.Forms.ItemDragEventArgs e)
{

        this.DoDragDrop(e.Item, DragDropEffects.Move);
} 
```

有谁知道这个的根本原因以及如何解决它？（.NET 2.0，Windows XP SP2）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-12T17:48:16.693

如果它对其他人有帮助 - 我在 WPF TreeView（不是问题中列出的 Windows 窗体）遇到了这个问题，解决方案只是确保将事件标记为在 drop 事件处理程序中处理。

```
 private void OnDrop(object sender, DragEventArgs e)
    {
        // Other logic...

        e.Handled = true;
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T14:36:11.533

**`FORMATETC`**是一种应用程序剪贴板，因为没有更好的术语。为了实现一些在树节点周围拖动的视觉技巧，必须将其复制到此剪贴板及其源描述中。源代码管理将其信息加载到`FORMATETC`剪贴板并将其发送到目标对象。看起来错误发生在放置而不是拖动上。`DV`in`DV_E_FORMATETC`通常表示在 drop 步骤中发生的错误。
目的地看起来不像你在上面放的东西。剪贴板可能已损坏，或者放置目标可能未配置为理解它。

我建议您尝试以下两种方法之一。

1.  删除原始树结构和目标。转储你的dll。关闭一切。打开并将树视图和目的地放回表单上。它可能只是形成不良并且没有完全填充`FORMATETC`结构。
2.  尝试放置另一个树视图并放在那里。如果你掉到另一棵树上并且它工作你知道你的橙子到橙子工作，它不是树视图。如果它是网格或列表视图，它可能是目的地。您可能需要更改这些结构才能接收掉落。

并不是说它有帮助，但结构是这样的：

```
typedef struct tagFORMATETC
{
  CLIPFORMAT      cfFormat;
  DVTARGETDEVICE  *ptd;
  DWORD           dwAspect;
  LONG            lindex;
  DWORD           tymed;
} FORMATETC, *LPFORMATETC; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-22T05:22:12.127

使用列表和树视图控件进行拖放时，您必须确保正确删除和插入列表项。例如，使用涉及三个 ListView 控件的拖放：

```
 private void triggerInstanceList_DragOver(object sender, DragEventArgs e)
    {
        SetDropEffect(e);
    }

    private void triggerInstanceList_DragEnter(object sender, DragEventArgs e)
    {
        SetDropEffect(e);
    }

    private void SetDropEffect(DragEventArgs e)
    {
        if (e.Data.GetDataPresent(typeof(ListViewItem)))
        {
            ListViewItem itemToDrop = e.Data.GetData(typeof(ListViewItem)) as ListViewItem;
            if (itemToDrop.Tag is TriggerTypeIdentifier)
                e.Effect = DragDropEffects.Copy;
            else
                e.Effect = DragDropEffects.Move;
        }
        else
            e.Effect = DragDropEffects.None;
    }

    private void triggerInstanceList_DragDrop(object sender, DragEventArgs e)
    {
        if (e.Data.GetDataPresent(typeof(ListViewItem)))
        {
            try
            {
                ListViewItem itemToDrop = e.Data.GetData(typeof(ListViewItem)) as ListViewItem;
                if (itemToDrop.Tag is TriggerTypeIdentifier)
                {
                    ListViewItem newItem = new ListViewItem("<new " + itemToDrop.Text + ">", itemToDrop.ImageIndex);
                    _triggerInstanceList.Items.Add(newItem);
                }
                else
                {
                    _expiredTriggers.Items.Remove(itemToDrop);
                    _triggerInstanceList.Items.Add(itemToDrop);
                }
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex);
            }
        }
    } 
```

您会注意到，在 DragDrop 事件结束时，我要么移动 ListViewItem，要么创建一个副本。

# php - PHP 的敏捷工具有哪些？

> ID：50339
> 
> 赞同：5
> 
> 时间：2008-09-08T18:22:29.173
> 
> 标签：php

```
- Unit Testing
  - Mocking 
  - Inversion of Control
  - Refactoring
  - Object Relational Mapping
  - Others? 
```

我发现最[简单](http://www.lastcraft.com/simple_test.php)的单元测试和模拟，虽然它还有很多不足之处，但它有点工作。

我还没有找到任何合理的控制反转框架（有一个出现在 phpclasses 上，但没有文档，似乎没有人尝试过）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-08T19:14:19.783

[phpUnderControl](http://www.phpundercontrol.org/) - 持续集成。

不要忘记版本控制（例如使用[CVS](http://www.nongnu.org/cvs/)或[Subversion](http://subversion.tigris.org/)）！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-01T13:31:41.277

[Agile Toolkit](http://agiletoolkit.org/)是一个专注于敏捷开发价值的框架，即快速生产软件然后对其进行微调。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T19:02:26.270

单元测试 - PHPUnit [phpunit.de](http://www.phpunit.de/)

ORM - 学说[phpdoctrine.org](http://www.phpdoctrine.org/) , Propel [propel.phpdb.org](http://propel.phpdb.org/)

# .net - 为什么 Windows 窗体和库之间的 AppDomain.CurrentDomain.BaseDirectory 不同

> ID：50345
> 
> 赞同：5
> 
> 时间：2008-09-08T18:24:48.450
> 
> 标签：.net

在我的 winforms 应用程序中，AppDomain.CurrentDomain.BaseDirectory 设置为“C:\Projects\TestProject\bin\Debug\”

在我的单元测试中，它是“C:\Projects\TestProject\bin\Debug”（没有最后的斜杠）。为什么是这样？

[编辑] @Will：我在问为什么测试项目的目录没有斜杠？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-08T19:16:51.460

您可能会问两个可能的问题之一：为什么它们不同，或者为什么测试项目的目录没有尾部斜杠。

假设它是第一个：那是代码执行的地方。当你调试程序时，它的编译和二进制文件放在项目的\bin\debug 目录下。测试时，您正在运行测试的二进制文件，这些二进制文件被编译并放置在测试项目的 bin\debug 目录下。

假设它是最后一个：可能是一些模糊的原因，可能是一个错误，或者可能是为了捕捉连接路径而不是使用 Path.Combine 的人（顽皮顽皮！）。

* * *

嗯，我不知道为什么它不一样。测试应用程序可以在自定义 CLR 主机中运行；我认为这可能是这种情况，因为测试应用程序使用通常在标准 CLR 主机中不允许的私有访问器做一些奇怪的事情。我在这里只抓住稻草，因为我对这些东西实际上是如何编码的没有任何实际知识。

无论如何，解决方法是（Path.Combine）。没有人应该连接路径，因为路径分隔符可以改变。

# sql - 为什么 NHibernate 生成参数化 SQL 的速度与存储过程一样快？

> ID：50346
> 
> 赞同：16
> 
> 时间：2008-09-08T18:25:01.197
> 
> 标签：sql, stored-procedures, orm

我的一位同事声称，即使执行路径被缓存，从 ORM 生成的参数化 SQL 也不可能像存储过程一样快。对这个顽固的开发人员有任何帮助吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-08T18:26:36.777

我将从阅读这篇文章开始：

[http://decipherinfosys.wordpress.com/2007/03/27/using-stored-procedures-vs-dynamic-sql-generated-by-orm/](http://decipherinfosys.wordpress.com/2007/03/27/using-stored-procedures-vs-dynamic-sql-generated-by-orm/)

这是两者之间的速度测试：

[http://www.blackwasp.co.uk/SpeedTestSqlSproc.aspx](http://www.blackwasp.co.uk/SpeedTestSqlSproc.aspx)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-08T18:27:40.817

第 1 轮 - 您可以启动探查器跟踪并比较执行时间。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-08T18:27:08.257

对于大多数人来说，说服他们的最好方法是“向他们展示证据”。在这种情况下，我将创建几个基本的测试用例来检索相同的数据集，然后计算使用存储过程与 NHibernate 相比需要多长时间。一旦你有了结果，就把它交给他们，大多数持怀疑态度的人应该屈服于证据。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-08T18:36:18.267

我只会在 Rob 的回答中添加几件事：

首先，确保测试用例涉及的数据量与生产值相近。换句话说，如果您的查询通常针对具有数十万行或行的表，则创建这样的测试环境。

其次，除了使用 nHibernate 生成的查询和 s'proc 调用外，其他一切都相同。希望您可以通过简单地更换提供者来执行测试。

最后，要意识到通常比存储过程与 ORM 有更多的利害关系。考虑到这一点，测试应该考虑所有因素：执行时间、内存消耗、可伸缩性、调试能力等。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-08T18:35:05.523

这里的问题是你已经接受了举证责任。你不太可能像那样改变别人的想法。不管你喜不喜欢，人们——甚至是程序员——都太情绪化了，不会轻易被逻辑所左右。你需要把举证责任重新推给他——让他说服你——这将迫使他进行研究并为自己找到答案。

使用存储过程的一个更好的论点是安全性。如果*只*使用存储过程，*没有*动态 sql，则可以禁用应用程序数据库用户的 SELECT、INSERT、UPDATE、DELETE、ALTER 和 CREATE 权限。这将保护您免受大多数二阶 SQL 注入的影响，而参数化查询仅对一阶注入有效。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-08T18:27:58.443

测量它，但在非微基准中，即代表系统中实际操作的东西。即使存储过程对性能有微小的好处，但与代码所产生的其他成本相比，它是微不足道的：实际检索数据、转换数据、显示数据等。更不用说使用存储过程相当于传播你的逻辑在您的应用程序**和**数据库中，没有重要的版本控制、单元测试或重构支持。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-08T18:28:00.207

自己对它进行基准测试。编写一个测试平台类，执行数百次采样存储过程，并运行相同次数的 NHibernate 代码。比较每种方法的平均和中值执行时间。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-08T18:28:08.957

如果每次查询都相同，则同样快。Sql Server 2005 在批处理中的每条语句级别缓存查询计划，而不管 SQL 来自何处。

长期的不同可能是存储过程对于 DBA 来说管理和调整要容易很多很多倍，而必须从分析器跟踪中收集的数百个不同的查询是一场噩梦。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-08T18:28:10.237

我已经多次争论过这个问题。
几乎总是我最终得到一个非常好的 dba，并在运行分析器的情况下运行一个 proc 和一段代码，并让 dba 显示结果非常接近，可以忽略不计。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-08T18:29:11.280

测量它。

真的，在你衡量之前，任何关于这个话题的讨论都可能是徒劳的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-08T18:31:59.917

对于他正在考虑的特定用例，他可能是正确的。对于一些可以任意调整的复杂 SQL 集，存储过程可能会执行得更快。但是，您从诸如休眠之类的东西中获得的东西是缓存。对于您的实际应用程序的生命周期，这可能会更快。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-08T23:48:24.257

额外的抽象层将导致它比对 sproc 的纯调用要慢。仅仅因为您在托管堆上有额外的分配，以及额外的推送和弹出调用堆栈，事实是调用存储过程比让 ORM 构建查询更有效，不管有多好ORM 是。

有多慢，如果它甚至可以测量，是有争议的。大多数 ORM 都有一个缓存机制来避免执行查询，这也有助于实现这一点。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-09T00:01:00.843

即使存储过程快了 10%（可能不是），您可能想问问自己它到底有多重要。最终真正重要的是为您的系统编写和维护代码是多么容易。如果您正在编写一个 Web 应用程序，并且您的页面都在 0.25 秒内返回，那么使用存储过程节省的额外时间可以忽略不计。但是，使用像 NHibernate 这样的 ORM 可以有许多额外的优势，仅使用存储过程很难复制。

# .net - 将自动裁剪的图像库

> ID：50364
> 
> 赞同：3
> 
> 时间：2008-09-08T18:29:38.330
> 
> 标签：.net, image-manipulation

我正在寻找一个**.Net**库，它将接受图像或文件名和纵横比，并将图像裁剪为该纵横比。这是最简单的部分：我可以自己做。但我也希望它在准确选择要裁剪的内容方面表现出一点智慧，即使它只是选择要切片的边缘。

这是针对个人项目的，痛苦不足以证明花任何钱是合理的，但是如果您可以推荐付费工具，请继续。也许其他人会发现这个建议很有用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-18T22:13:16.150

免责声明：我为 .NET Imaging 供应商 ( [Atalasoft](http://www.atalasoft.com) )工作

这取决于你在谈论什么样的图像。如果您谈论的是 1 位文档图像（如传真或扫描），我们可以这样做。

如果您在谈论照片，我们的产品不这样做，但您可能正在寻找接缝雕刻。我写了这个应用程序

[http://www.atalasoft.com/cs/blogs/31appsin31days/archive/2008/05/26/simple-seam-carver.aspx](http://www.atalasoft.com/cs/blogs/31appsin31days/archive/2008/05/26/simple-seam-carver.aspx)

使用我们的库，可以移植到仅使用内置 .NET 图像进行一些工作。

接缝雕刻的想法是在图像中找到与周围像素变化最小的连接路径。在正常的实现中，您会选择一个连续的（但不一定是垂直的）路径并将其删除。如果你想要一种作物，你可以找到能量最少的区域并将其移除。我的代码显示了如何计算像素和路径的能量（它与周围像素有多大不同）

如果你查看缝雕，你会发现那里有一些免费的实现。

# svn - 更好的 Subversion 合并工具

> ID：50371
> 
> 赞同：58
> 
> 时间：2008-09-08T18:32:13.503
> 
> 标签：svn, tortoisesvn

Tortoisesvn 有没有好的外部合并工具（我不是特别喜欢内置的 Merge 工具）。我将 WinMerge 用于差异，但它不适用于三向合并（也许更好的问题是有没有办法强制 tortoisesvn 像 tortoisecvs 一样合并？）

[编辑]

在尝试了所有这些之后，对我来说，SourceGear 是我更喜欢的一个。从 sourcegear 指定 DiffMerge 的方法是：

> C:\Program Files\SourceGear\DiffMerge\DiffMerge.exe /t1="我的工作版本" /t2="存储库版本" /t3="Base" /r=%merged %mine %theirs %base

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-09-08T18:41:58.923

[Perforce 合并工具](https://www.perforce.com/product/components/perforce-visual-merge-and-diff-tools)

尽管 Perforce 显然不是免费的，但合并工具是免费的。它比默认的 TortoiseSvn 好 100 倍。要与 TortoiseSvn 集成，请将合并工具设置为：

> C:\Path-To\P4Merge.exe %base %theirs %mine %merged

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-09-08T18:50:25.550

看看[Sourcegear DiffMerge](http://www.sourcegear.com/diffmerge/)。DiffMerge 是他们的 Vault 和 Fortress 产品中的比较和合并工具，但他们将其作为独立工具免费提供。一个值得注意的特性是它允许对整个目录树进行差异化。

**编辑：**虽然 DiffMerge 仍然是一个免费工具，但它每天至少会通过弹出窗口注册一次（至少从 4.2 版开始）。它还在弹出窗口中指出：

> 未来版本中的选择新功能也需要注册，但核心功能和修复将可供所有人使用。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-08T19:03:40.247

[Beyond Compare](http://www.scootersoftware.com/)曾多次向我提出建议。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-08T18:44:44.940

我使用[KDiff3](http://kdiff3.sourceforge.net/)作为 3 路合并工具。它做得不错。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-08T18:50:54.940

[Araxis Merge](http://www.araxis.com/merge/index.html)很昂贵，但很棒。很好地处理文件或文件夹的 3 路合并。我发现它显示差异的方式比 Windiff 或 P4 的工具更有帮助。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-08T18:34:16.667

[CompareIt](http://www.grigsoft.com/wincmp3.htm)很好，我发现使用 svn 的命令行界面，它对我来说合并得更多，乌龟在哪里接东西并问你。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-21T00:19:41.740

我喜欢这款[SmartSynchronize](http://www.syntevo.com/smartsynchronize/index.html)，它可免费用于非商业用途

# generics - Scala中的MultiMap

> ID：50373
> 
> 赞同：18
> 
> 时间：2008-09-08T18:32:58.790
> 
> 标签：generics, scala

我正在尝试将`MultiMap`特征与`HashMap`这样的混合：

```
val children:MultiMap[Integer, TreeNode] = 
    new HashMap[Integer, Set[TreeNode]] with MultiMap[Integer, TreeNode] 
```

特征的定义`MultiMap`是：

```
trait MultiMap[A, B] extends Map[A, Set[B]] 
```

这意味着 a `MultiMap`of types `A`&`B`是 a `Map`of types `A`& `Set[B]`，或者在我看来是这样。但是，编译器抱怨：

```
C:\...\TestTreeDataModel.scala:87: error: illegal inheritance;   template $anon inherits different type instances of trait Map:   scala.collection.mutable.Map[Integer,scala.collection.mutable.Set[package.TreeNode]] and scala.collection.mutable.Map[Integer,Set[package.TreeNode]]  
    new HashMap[Integer, Set[TreeNode]] with MultiMap[Integer, TreeNode]  
    ^ one error found 
```

似乎泛型又让我绊倒了。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-08T18:59:25.310

我不得不导入`scala.collection.mutable.Set`. 似乎编译器认为 Set in`HashMap[Integer, Set[TreeNode]]`是`scala.collection.Set`. MultiMap def 中的 Set 是.`scala.collection.`**`mutable`**`.Set`

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-15T16:24:13.377

这可能很烦人，Scala 集合中的名称重载是它的一大弱点。

对于它的价值，如果您已`scala.collection._`导入，您可能会将您的`HashMap`类型编写为：

```
new HashMap[ Integer, mutable.Set[ TreeNode ] ] 
```

# shell - WScript.Shell 和阻塞执行？

> ID：50384
> 
> 赞同：8
> 
> 时间：2008-09-08T18:36:40.247
> 
> 标签：shell, vbscript, wsh

我正在使用[WScript](http://en.wikipedia.org/wiki/Windows_Script_Host#Usage)来自动化一些任务，方法是使用 WScript.Shell 调用外部程序。

但是，现在它不等待外部程序完成，而是继续前进。这会导致问题，因为我有一些任务依赖于其他任务首先完成。

我正在使用如下代码：

```
ZipCommand = "7za.exe a -r -y " & ZipDest & BuildLabel & ".zip " & buildSourceDir

Set wshShell = WScript.CreateObject("Wscript.Shell")
wshShell.run ZipCommand 
```

有没有办法做到这一点，所以它会阻塞，直到 shell 执行的程序返回？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-08T19:14:50.110

事实证明，while 循环是严重的 CPU 占用：P

我找到了一个更好的方法：

```
ZipCommand = "7za.exe a -r -y " & ZipDest & BuildLabel & ".zip " & buildSourceDir

Set wshShell = WScript.CreateObject("Wscript.Shell")

wshShell.Run ZipCommand,1,1 
```

最后两个参数是 Show window 和 Block Execution :)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-08T18:44:13.333

如果您使用“Exec”方法，它会返回一个引用，因此您可以轮询“Status”属性以确定它何时完成。这是来自[msdn](http://msdn.microsoft.com/en-us/library/ateytk4a(VS.85).aspx)的示例：

```
Dim WshShell, oExec
Set WshShell = CreateObject("WScript.Shell")

Set oExec = WshShell.Exec(ZipCommand)

Do While oExec.Status = 0
    WScript.Sleep 100
Loop 
```

# c# - ORM 的良好特性

> ID：50386
> 
> 赞同：7
> 
> 时间：2008-09-08T18:37:42.133
> 
> 标签：c#, orm

我目前正在组装一个相当简单的 ORM 工具，作为客户各种 Web 项目的框架。大多数项目都是内部的，不需要大量的并发性，所有项目都会与 SQL Server 相背离。我建议他们使用像 SubSonic、NHibernate 和其他一些开源项目这样的 ORM 工具，但是出于可维护性和灵活性的原因，他们希望创建一些自定义的东西。所以我的问题是：我应该确保在这个 ORM 工具中包含哪些功能？顺便说一句，我将使用 MyGeneration 来生成代码模板。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-08T18:48:51.590

为了所有神圣的人（以及妇女和儿童）的爱，尽一切可能说服他们不要使用定制的 O/RM 解决方案。当已经存在完美的开源轮子时，为什么人们想要重新发明轮子？！？！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-09-15T02:00:47.207

如果您的客户因为（真实的或想象的）对支持的看法而对 OSS 不感兴趣，您是否考虑过任何顶级的商业第三方 ORM，例如**[LightSpeed](http://www.mindscape.co.nz/products/LightSpeed)**，它带有一个不错的 GUI 设计器工具

[![光速 ORM](https://i.stack.imgur.com/A0l89.jpg)](https://i.stack.imgur.com/A0l89.jpg)
[（来源：[mindscape.co.nz](http://www.mindscape.co.nz/images/chrome/screendump.jpg)）]

[Mindscape](http://www.mindscape.co.nz/)（销售 LightSpeed 的公司）是一家位于我居住地附近的新西兰公司，我在那里遇到了一些开发人员，我知道他们以拥有令人难以置信的客户支持而闻名。当您购买软件时，它们会为您提供源代码，因此您可以随意调整它。

你可能不想推出自己的 ORM，除非你必须这样做**并且**你的客户愿意交出一大笔现金让你这样做。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-03T13:05:48.507

IMO 编写自己的 OR/M 是您可能做出的最糟糕的设计决策之一。“可维护性和灵活性”正是不编写自己的 OR/M 的原因。

请阅读[查看不编写自己的对象关系映射器的 25 个理由](http://ayende.com/Blog/archive/2006/05/12/25ReasonsNotToWriteYourOwnObjectRelationalMapper.aspx)，看看您的客户是否真的愿意支付构建[NHibernate](http://www.ohloh.net/projects/nhibernate)（760 万美元）或[SubSonic](http://www.ohloh.net/projects/6727)（150 万美元）之类的东西的成本。因为，就像上面 ChanChan 所说的，你最终会得到类似的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-15T04:25:41.383

Davy Brion（NHibernate 提交者）有很多帖子，由于某种原因，他还被迫为客户编写自定义 ORM。

他涵盖的一些内容是：

*   将类映射到表
*   开箱即用的 CRUD 功能
*   保湿实体
*   会话级缓存
*   执行自定义查询

如果您必须走这条路，绝对值得一试：[构建您自己的数据访问层系列](http://davybrion.com/blog/2009/08/build-your-own-data-access-layer-series/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-08T18:40:49.053

根据我的经验，您需要采用 nHibernate 样式并拥有它，以便您在对象和数据库之间拥有某种映射。这允许您的对象具有一些难以在数据库中表示但在 POCO 中更容易表示的东西。

Generation 通过为您提供符合您的模式的类来帮助您开始，但是如果您打算维护任何东西或测试任何东西，那么映射现在是痛苦的，以后会很高兴。

Subsonic 是一个很棒的模型，它的开源，如果你必须去生成，使用他们在 myGeneration 中的模板来获得优势。

**顺便说一句：我已经完成了你正在做的事情，我最终得到了与亚音速非常相似的东西，现在建议我的客户使用亚音速源，并为他们自己分叉。**

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-01T17:54:54.200

也许只是也许，您急需一些现有解决方案中尚不存在的“功能”。也许您还需要更简单的东西。亚音速的 1.5 美元简直太离谱了。也许你想使用 POCO。也许您想在 3 层场景中轻松使用这些东西。也许您不想支持地球上的所有 RDBMS，因此您可以为您的目标硬编码和优化代码。也许您想实现更智能的对象跟踪。可能现有 orms 做出的一些设计决策会让你发疯......

我自己正在使用我自己和我自己开发的自定义 orm，我很满意我做到了。地毯下没有隐藏的龙，没有惊喜的场景。我的 orm 完全符合我的要求，仅此而已。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-15T04:47:40.137

*   二级缓存

    允许您在内存中维护实体实例

    *   自动脏检查

        允许您在不加载对象的情况下更新对象的更改。

    *   强大的查询语言

    *   强大的级联操作

    *   强大的主键生成器策略

        ORM 框架将根据目标数据库选择最佳的主键生成器策略

    *   支持复合元素

    *   对活动的支持

        onSave、onUpdate 等

    *   良好的文档和参考书

    *   支持会话状态

问候，

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-15T04:36:11.550

您作为顾问的工作（听起来就是这样）是利用您的专业知识为您的客户实施符合他们需求的解决方案，同时以最少的成本和时间投资。

如果他们想建造和销售 OR/M。去城里做一个。如果他们想要其他任何东西，请使用已经存在的来完成工作。

如果他们坚持花钱，就买一个现有的（我不会点名，但有一些不错的不是免费的）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-10-18T16:14:18.443

尝试使用[Devart LinqConnect](http://www.devart.com/linqconnect/) - 所有 LINQ to SQL 功能和对最流行的数据库服务器的广泛支持 - Oracle、MySQL、Postgre、SQL Server 和 SQLite。令人难以置信的可视化建模工具、先进的监控工具、高质量的支持——因此，我在项目执行期间仅用了三周就学会了它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-09-15T02:04:58.107

还没有人提到它；但是选择[LLBLGen](http://www.llblgen.com/)。您可以根据需要自定义模板，当然，您也可以在生成的类中编写自己的自定义代码。买它。你永远不会回头，你会说“谢谢你丝滑！” 当它始终如一地工作时。（我没有写，但我喜欢它）。如果它不适合你，你也可以说“该死的丝滑！”。但这不太可能，但我确实提供了它作为一种选择。

我注意到关于 LLBLGen 的唯一不好的事情是支持动态切换数据库/服务器。它不支持我想要的功能；即检测您检索到的给定实体在您切换到的新数据库中“不存在”的能力。但这是一种罕见的情况。

我建议使用 LLBLGen，因为当我遇到它时，我正在编写自己的 OR/M。再也没有回头。

# windows - 有一个充满旧东西的注册表会减慢 Windows 的速度吗？

> ID：50389
> 
> 赞同：7
> 
> 时间：2008-09-08T18:39:35.280
> 
> 标签：windows, registry

我知道这不是严格意义上的编程问题，但我总是从伪技术人员那里听到的是，注册表中有大量条目会降低基于 Windows 的 PC 的速度。我认为这个概念来自那些试图对他们的 PC 进行故障排除以及为什么它运行如此缓慢的人，他们有时会打开注册表并查看他们很久以前卸载的程序的剩余条目。

但这个想法有任何道理吗？我不这么认为，因为注册表本质上只是一个数据库，并且在更大的注册表上深入到一个条目不会花费更长的时间。但真的吗？

**编辑：**需要明确的是，我不是在寻找有关如何使 PC 运行得更快的建议，或者询问为什么我的 PC 特别慢（不是），我只是好奇那些说“更大的注册表意味着更慢的人” PC”是否准确。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-08T18:46:44.607

我认为这是一种症状，而不是原因，因为发烧是感染的症状。

当您安装 Windows 更新时，至少在 xp 及更高版本中，会维护一个名为 SXS 的文件夹以将它们回滚。这些回滚点也存储在 reg 键中。

sxs（并排）文件夹的大小呈指数增长，并且肯定与为什么有些人简单地重新安装 sp3 而不是安装 sp1 并滚动到 sp3 时，即使安装了相同的程序，他们也会获得更好的性能。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-08T19:10:56.437

1) 开始 -> 运行 -> msconfig
2) 检查启动选项卡
3) 如果您不知道它是什么，请取消选中
4) 重新启动

它不是注册表，而是您在后台运行的垃圾。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-08T18:44:36.110

简而言之，并非如此。

在机器速度较慢的过去，答案是肯定的。但是，即使是 60MB 的注册表，现代处理器也不是问题。

通常，现代机器开始运行缓慢的真正原因是由于从恶意软件到病毒扫描程序的一切：Mcafee、Norton 等是我心目中的主要目标。

此外，WinSXS 文件夹会随着服务包和应用程序的安装而增长。这似乎对系统性能有负面影响。在这种情况下，只有两种可能的解决方案。首先，如果可能，重新安装操作系统，其中包含已集成到安装中的最新服务包。其次，如果这不可行并且您正在运行带有 SP1 的 Vista，您可以运行 vsp1cln.exe 工具（请参阅[technet](http://technet.microsoft.com/en-us/library/cc766219.aspx)），该工具将清理许多旧版本的组件。请注意，此工具只能执行一次，并且不允许您回滚。

* * *

## 回答 #4

> 赞同：-8
> 
> 时间：2011-05-02T15:49:20.453

注册表上出现的任何问题也可能使您的计算机变慢。修复注册表问题您需要安装[注册表清理](http://www.windows7-slow.com/computer-running-extremely-slow/)程序，因为这将修复错误并使您的电脑恢复正常状态。

# c# - 是否可以跟踪分配/解除分配？

> ID：50391
> 
> 赞同：5
> 
> 时间：2008-09-08T18:41:16.897
> 
> 标签：c#, memory, hook, allocation

据我所知，这是不可能的，所以我真的只是希望有一个左字段未记录的分配挂钩函数。
我想要一种方法来跟踪像[_CrtSetAllocHook](http://msdn.microsoft.com/en-us/library/cy8c7wz5.aspx)中的分配，但是对于`C#/.NET`.
垃圾收集器/分配的唯一可见性似乎是[GC.CollectionCount](http://msdn.microsoft.com/en-us/library/system.gc.collectioncount(VS.80).aspx)。
任何人有任何其他.NET 内存魔力？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-08T18:57:13.380

CLR 有一个“分析 API”，它可以连接到几乎所有东西——我相信这是商业 .NET 内存分析产品使用的。这是文档顶层的 MSDN 链接：[.NET Framework General Reference: About the Profiling API](http://msdn.microsoft.com/en-us/library/bb384547.aspx)

请参阅此 MSDN 杂志文章以了解有关内存部分的介绍：[使用 .NET Profiler API 检查和优化程序的内存使用情况](http://msdn.microsoft.com/en-us/magazine/cc188781.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T20:33:10.467

我只会使用 Red Gate 的 ANTS Profiler。它会告诉你很多关于内存中发生的事情，而无需你自己学习分析 API。

# python - 你会建议用什么 Python 方法来检查 whois 数据库记录？

> ID：50394
> 
> 赞同：9
> 
> 时间：2008-09-08T18:43:52.790
> 
> 标签：python, sysadmin, whois

我正在尝试启动并运行实际上需要检查 whois 数据库的 Web 服务。我现在正在做的事情很丑陋，我想尽可能地避免它：我调用 gwhois 命令并解析它的输出。丑陋。

我做了一些搜索，试图找到一种 Python 的方式来完成这项任务。一般来说，我什么都没得到——[这个旧的讨论列表链接](http://mail.python.org/pipermail/python-list/2000-March/028122.html)有一种方法可以检查域是否存在。完全不是我想要的......但是，它仍然是谷歌给我的最好的答案 - 其他一切都只是一堆 unanwsered 的问题。

你们中的任何人都成功地启动并运行了一些方法吗？我非常感谢一些提示，还是我应该以开源方式进行，坐下来自己编写代码？:)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-11-02T13:53:05.607

看看这个： [http ://code.google.com/p/pywhois/](http://code.google.com/p/pywhois/)

pywhois - 用于检索域 WHOIS 信息的 Python 模块

目标： - 创建一个简单的可导入 Python 模块，该模块将为给定域生成解析后的 WHOIS 数据。- 能够为所有流行的 TLD（com、org、net、...）提取数据 - 直接查询 WHOIS 服务器，而不是像许多其他人那样通过中间 Web 服务。- 适用于 Python 2.4+ 且无外部依赖项

例子：

```
>>> import pywhois
>>> w = pywhois.whois('google.com')
>>> w.expiration_date
['14-sep-2011']
>>> w.emails
['contact-admin@google.com',
 'dns-admin@google.com',
 'dns-admin@google.com',
 'dns-admin@google.com']
>>> print w
... 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-07-05T12:03:17.293

在我自己搜索python whois库的过程中发现了这个问题。

不知道我同意 cdleary 的回答，即使用包装命令的库始终是最好的方法 - 但我可以看到他这么说的原因。

优点： cmd-line whois 处理所有繁重的工作（套接字调用、解析等）

缺点：不便携；模块可能无法工作，具体取决于底层 whois 命令。速度较慢，因为除了 whois 命令之外还运行命令和最有可能的 shell。如果不是 UNIX (Windows)、不同的 UNIX、较旧的 UNIX 或较旧的 whois 命令，则受影响

我正在寻找一个可以处理 whois IP 查找的 whois 模块，我对编写自己的 whois 客户端不感兴趣。

以下是我（轻轻地）尝试过的模块以及有关它的更多信息：

pywhoisapi：

*   主页：[http ://code.google.com/p/pywhoisapi/](http://code.google.com/p/pywhoisapi/)
*   设计：REST客户端访问ARIN whois REST服务
*   优点：能够处理 IP 地址查找
*   缺点：能够从其他 RIR 的 whois 服务器中提取信息？

BulkWhois

*   主页： http: [//pypi.python.org/pypi/BulkWhois/0.2.1](http://pypi.python.org/pypi/BulkWhois/0.2.1)
*   设计：telnet 客户端从 RIR(?) 访问 whois telnet 查询接口
*   优点：能够处理 IP 地址查找
*   缺点：能够从其他 RIR 的 whois 服务器中提取信息？

pywhois：

*   主页：[http ://code.google.com/p/pywhois/](http://code.google.com/p/pywhois/)
*   设计：REST 客户端访问 RRID whois 服务
*   优点：访问许多 RRID；有 python 3.x 分支
*   缺点：似乎不处理 IP 地址查找

蟒蛇whois：

*   主页：[http ://code.google.com/p/python-whois/](http://code.google.com/p/python-whois/)
*   设计：包装“whois”命令
*   缺点：似乎不处理 IP 地址查找

whoisclient - python-whois 的分支

*   主页： http: [//gitorious.org/python-whois](http://gitorious.org/python-whois)
*   设计：包装“whois”命令
*   取决于：IPy.py
*   缺点：似乎不处理 IP 地址查找

更新：我最终使用 pywhoisapi 进行反向 IP 查找

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-10T21:44:53.197

使用命令行实用程序来做你想做的事没有错。如果你在服务周围放置了一个很好的包装器，你可以随心所欲地实现内部！例如：

```
class Whois(object):
    _whois_by_query_cache = {}

    def __init__(self, query):
        """Initializes the instance variables to defaults. See :meth:`lookup`
        for details on how to submit the query."""
        self.query = query
        self.domain = None
        # ... other fields.

    def lookup(self):
        """Submits the `whois` query and stores results internally."""
        # ... implementation 
```

现在，无论您是否使用 urllib 自行开发、环绕命令行实用程序（就像您正在做的那样），或者导入第三方库并使用它（就像[您说](https://stackoverflow.com/questions/50394#50423)的那样），这个界面都保持不变。

这种方法通常根本不被认为是丑陋的 -**有时命令实用程序可以满足您的需求，并且您应该能够利用它们**。如果速度最终成为瓶颈，您的抽象使切换到本机 Python 实现的过程对您的客户端代码透明。

[实用胜过纯洁](http://www.python.org/dev/peps/pep-0020/)——这就是 Pythonic。:)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-03-31T00:37:11.253

这是用 Python 重新实现的 whois 客户端：http: [//code.activestate.com/recipes/577364-whois-client/](http://code.activestate.com/recipes/577364-whois-client/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T00:23:53.210

我不知道 gwhois 是否对服务器输出做了一些特别的事情；但是，您可以在端口 whois (43) 上连接到 whois 服务器，发送您的查询，读取回复中的所有数据并解析它们。为了让生活更轻松，您可以使用 telnetlib.Telnet 类（即使 whois 协议比 telnet 协议简单得多）而不是普通套接字。

棘手的部分：

*   你会问哪个whois服务器？RIPE、ARIN、APNIC、LACNIC、AFRINIC、JPNIC、VERIO 等 LACNIC 可能是一个有用的后备方案，因为它们倾向于用有用的数据回复其域外的请求。
*   每个 whois 服务器的确切选项和参数是什么？有些提供帮助，有些则不提供。通常，纯域名无需任何特殊选项即可使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-08T18:53:37.990

另一种方法是使用`urllib2`模块来解析其他页面的 whois 服务（存在许多类似的站点）。但这似乎比你现在所做的更像是一种黑客行为，并且会让你依赖于你选择的任何 whois 网站，这很糟糕。

我不想这么说，但除非你想`whois`在你的程序中重新实现（这将是重新发明轮子），否则`whois`在操作系统上运行并解析输出（即你现在正在做什么）似乎是正确的方法做。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-08T19:00:58.957

解析另一个网页不会那么糟糕（假设他们的 html 不会很糟糕），但它实际上会将我与他们联系起来——如果他们失败了，我就失败了 :)

实际上，我在 sourceforge 上找到了一些旧项目：[rwhois.py](http://sourceforge.net/projects/rwhois/)。让我有点害怕的是，他们的最后一次更新是从 2003 年开始的。但是，这似乎是一个开始重新实施我现在所做工作的好地方......好吧，无论如何，我觉得有义务发布这个项目的链接，只是以供进一步参考。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-03-09T10:07:39.447

```
import socket
socket.gethostbyname_ex('url.com') 
```

如果它返回一个 gaierror 你知道它没有在任何 DNS 上注册

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-09T16:17:23.993

这是一个适合我的即用型解决方案；为 Python 3.1 编写（向后移植到 Py2.x 时，请特别注意字节/Unicode 文本的区别）。您的单点访问是 method `DRWHO.whois()`，它需要传入一个域名；然后它将尝试使用配置为的提供者解析名称`DRWHO.whois_providers[ '*' ]`（更完整的解决方案可以根据顶级域区分提供者）。`DRWHO.whois()`将返回带有单个条目的字典`text`，其中包含 WHOIS 服务器发回的响应文本。同样，一个更完整的解决方案将尝试解析文本（必须为每个提供者单独完成，因为没有标准格式）并返回更结构化的格式（例如，设置一个标志`available`它指定域看起来是否可用）。玩得开心！

```
##########################################################################
import asyncore as                                   _sys_asyncore
from asyncore import loop as                         _sys_asyncore_loop
import socket as                                     _sys_socket

##########################################################################
class _Whois_request( _sys_asyncore.dispatcher_with_send, object ):
  # simple whois requester
  # original code by Frederik Lundh

  #-----------------------------------------------------------------------
  whoisPort = 43

  #-----------------------------------------------------------------------
  def __init__(self, consumer, host, provider ):
    _sys_asyncore.dispatcher_with_send.__init__(self)
    self.consumer = consumer
    self.query    = host
    self.create_socket( _sys_socket.AF_INET, _sys_socket.SOCK_STREAM )
    self.connect( ( provider, self.whoisPort, ) )

  #-----------------------------------------------------------------------
  def handle_connect(self):
    self.send( bytes( '%s\r\n' % ( self.query, ), 'utf-8' ) )

  #-----------------------------------------------------------------------
  def handle_expt(self):
    self.close() # connection failed, shutdown
    self.consumer.abort()

  #-----------------------------------------------------------------------
  def handle_read(self):
    # get data from server
    self.consumer.feed( self.recv( 2048 ) )

  #-----------------------------------------------------------------------
  def handle_close(self):
    self.close()
    self.consumer.close()

##########################################################################
class _Whois_consumer( object ):
  # original code by Frederik Lundh

  #-----------------------------------------------------------------------
  def __init__( self, host, provider, result ):
    self.texts_as_bytes = []
    self.host           = host
    self.provider       = provider
    self.result         = result

  #-----------------------------------------------------------------------
  def feed( self, text ):
    self.texts_as_bytes.append( text.strip() )

  #-----------------------------------------------------------------------
  def abort(self):
    del self.texts_as_bytes[:]
    self.finalize()

  #-----------------------------------------------------------------------
  def close(self):
    self.finalize()

  #-----------------------------------------------------------------------
  def finalize( self ):
    # join bytestrings and decode them (witha a guessed encoding):
    text_as_bytes         = b'\n'.join( self.texts_as_bytes )
    self.result[ 'text' ] = text_as_bytes.decode( 'utf-8' )

##########################################################################
class DRWHO:

  #-----------------------------------------------------------------------
  whois_providers = {
    '~isa':   'DRWHO/whois-providers',
    '*':      'whois.opensrs.net', }

  #-----------------------------------------------------------------------
  def whois( self, domain ):
    R         = {}
    provider  = self._get_whois_provider( '*' )
    self._fetch_whois( provider, domain, R )
    return R

  #-----------------------------------------------------------------------
  def _get_whois_provider( self, top_level_domain ):
    providers = self.whois_providers
    R         = providers.get( top_level_domain, None )
    if R is None:
      R = providers[ '*' ]
    return R

  #-----------------------------------------------------------------------
  def _fetch_whois( self, provider, domain, pod ):
    #.....................................................................
    consumer  = _Whois_consumer(           domain, provider, pod )
    request   = _Whois_request(  consumer, domain, provider )
    #.....................................................................
    _sys_asyncore_loop() # loops until requests have been processed

#=========================================================================
DRWHO = DRWHO()

domain    = 'example.com'
whois     = DRWHO.whois( domain )
print( whois[ 'text' ] ) 
```

# c# - 从 Java 调用 C# 代码？

> ID：50398
> 
> 赞同：35
> 
> 时间：2008-09-08T18:46:09.537
> 
> 标签：c#, java, java-native-interface

有没有人有一个很好的解决方案将一些 C# 代码集成到 Java 应用程序中？

代码很小，所以我可以用java重新编写，但如果可能的话，我宁愿重用代码。不要重复自己等等。

另外，我知道我可以将 C# 公开为 Web 服务或其他任何东西，但它里面有一些安全/加密的东西，所以如果可能的话，我宁愿保持它的紧密集成。

* * *

编辑：它将在基于服务器的应用程序上，因此“下载”另一个运行时无关紧要。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-08T19:01:06.040

您将使用 Java 本机接口来调用编译成 DLL 的 C# 代码。

如果它是少量的 C#，将它移植到 Java 会容易得多。如果它很多，这可能是一个很好的方法。

这是它的高级概述：

[http://en.wikipedia.org/wiki/Java_Native_Interface](http://en.wikipedia.org/wiki/Java_Native_Interface)

您的另一个选择是从 C# 代码创建一个 COM 程序集并使用 J-Interop 来调用它。

[http://sourceforge.net/projects/j-interop/](http://sourceforge.net/projects/j-interop/)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-10-31T18:25:22.010

我是[jni4net](http://jni4net.sf.net/)的作者，它是 JVM 和 CLR 之间的开源进程内桥梁。它建立在 JNI 和 PInvoke 之上。无需 C/C++ 代码。我希望它会帮助你。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-08T18:50:16.190

如果它很短，我认为你最好用java重写代码。下载一个 50Mb 的运行时已经够糟糕的了。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-08T19:06:52.267

有一个 IL to Java Bytecode compiler [GrassHopper](http://dev.mainsoft.com/Default.aspx?tabid=130)可能对你有用。我从来没有尝试过。

不过，我会考虑用 Java 重写您的代码

编辑：请注意，蚱蜢似乎不再可用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-09T18:46:27.923

我们为此使用了[JNBridge](http://jnbridge.com)，效果很好。它处理 Java->.NET，反之亦然，所有进程都在进程内。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-08T21:01:06.377

如果您不想将 hadle 重写为[进程间通信](http://en.wikipedia.org/wiki/Inter-process_communication)，请选择以下之一：

*   命名管道
*   插座
*   肥皂

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-08T18:50:35.860

如果不是太麻烦，我会重写它。Web 服务可以工作，但似乎仅重用一点代码就会产生很多开销。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-21T20:44:41.557

[http://www.infoq.com/articles/in-process-java-net-integration](http://www.infoq.com/articles/in-process-java-net-integration)建议在同一进程空间中运行 CLR 和 JVM 并来回传递调用。听起来很有效率。如果它运行良好，我将尝试将它集成到[Jace中。](http://sourceforge.net/projects/jace/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-08T08:31:35.223

如果它是一段可作为命令行实用程序公开的代码，我只需让其他宿主语言使用系统调用来执行该实用程序。

如果您的 C# 应用程序需要调用 Java，请编译一个特殊的 Java main，它采用适当的命令行参数并返回文本输出。

它是最古老、最简单的方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-03-26T11:15:34.027

您可以通过桥接库调用您的 c# 类（编译在 dll 中），可以使用各种库，每个库都有自己的特点。**JNBridge**生成代理类，您可以调用这些代理类来管理 java 类中的代码。**JCOBridge**允许您加载您的 c# 类并使用调用机制从 java 中使用它，javanet 还**允许**您导入 java 类并使用调用机制调用 java 代码。
所有探索的解决方案都是商业解决方案，可让您从 .NET 调用 java 代码，反之亦然，具有图形用户界面集成和其他便利。

**链接**：
[jnbridge](http://www.jnbridge.com/) java-.NET bridge 开发者和部署许可证模式，30 天免费试用
[jcobridge](https://www.jcobridge.com) java-.NET bridge 开发者和部署许可证模式，无限试用
[java-.NET](https://www.javonet.com/)桥研究和专业许可证模式，30 天无限制试用后报名

# emacs - 如何在 GNU Emacs 中获取最近文件的列表？

> ID：50417
> 
> 赞同：30
> 
> 时间：2008-09-08T18:56:14.677
> 
> 标签：emacs, ide

当我使用 Emacs 时，我希望能够轻松地显示和浏览我处理的文件列表，这些文件不仅来自当前会话，还来自以前的会话。（顺便说一句，在 Windows 上运行 Emacs 22.2）

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-08T19:00:55.960

来自[Joe Grossberg](http://www.joegrossberg.com/archives/000182.html)的博客（不再可用）：

> 但是，如果您使用的是 GNU Emacs 21.2（最新版本，将其作为标准发行版的一部分），您只需将以下行放入您的 .emacs 文件中
> 
> ```
> ;; recentf stuff
> (require 'recentf)
> (recentf-mode 1)
> (setq recentf-max-menu-items 25)
> (global-set-key "\C-x\ \C-r" 'recentf-open-files) 
> ```
> 
> 然后，当你启动 emacs 时，点击 `CTRL`- `X` `CTRL`- `R`。它将显示缓冲区中最近打开的文件的列表。将光标移动到一行并按 `ENTER`。这将打开有问题的文件，并将其移至最近文件列表的顶部。
> 
> （注意：Emacs 记录文件名。因此，如果您在 Emacs 之外移动或重命名文件，它不会自动更新列表。您必须使用正常的 -- 方法打开重命名的`CTRL`文件`X` `CTRL`。`F`）
> 
> Jayakrishnan Varnam 有一个[页面，其中包含](http://web.archive.org/web/20021114012120/http://varnam.org/e-recentf.html)该软件包如何工作的屏幕截图。

*注意：*您不需要这`(require 'recentf)`条线。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2020-09-16T10:22:15.700

即使您没有打开 recentf，Emacs 也会将通过 minibuffer 输入的文件列表保存在变量`file-name-history`. 此外，`(savehist-mode 1)`在您的`.emacs`文件中执行会使该变量在 Emacs 的调用中保持不变。

所以这里有一个小函数，它显示该列表中实际存在的文件（欢迎任何人使用/构建它）：

```
(defun dir-of-recent-files ()
  "See the list of recently entered files in a Dired buffer."
  (interactive)
  (dired (cons
      "*Recent Files*"
      (seq-filter
       'file-exists-p
       (delete-dups
        (mapcar (lambda (s) (string-trim-right s "/*"))
            file-name-history)
        ))))
  ) 
```

我发现这非常有用，并将它绑定到我的桌面键盘上的那些小特殊功能键之一。（所以我还没有看到打开recentf的意义......）

# silverlight - Silverlight 对铬有效吗？

> ID：50421
> 
> 赞同：4
> 
> 时间：2008-09-08T19:00:01.720
> 
> 标签：silverlight, google-chrome

有谁知道silverlight是否插入chrome，或者他们计划何时支持它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-08T19:01:53.697

这家伙在 chrome 中使用 silverlight 取得了部分成功，但似乎不受支持：

[http://wildermuth.com/2008/09/02/Silverlight_2_and_Google_Chrome](http://wildermuth.com/2008/09/02/Silverlight_2_and_Google_Chrome)

来自[silverlight 论坛](http://silverlight.net/forums/t/24044.aspx)中的 Microsoft Silverlight 团队：

> 您好，目前我们没有计划支持 Chrome。如果它获得足够的市场份额，我们将在未来支持它。请理解，每个浏览器实现插件模型的方式不同，所以要正式支持一个浏览器 100% 会很费劲……顺便说一下，IE 8 也在自己的进程中运行每个选项卡。如果一个选项卡崩溃，其他选项卡仍然可以正常工作。

**更新：**

Jon Galloway 刚刚在此处发布了有关如何在 Chrome 上成功运行 silverlight 的说明：

[http://weblogs.asp.net/jgalloway/archive/2008/09/17/silverlight-on-chrome.aspx](http://weblogs.asp.net/jgalloway/archive/2008/09/17/running-silverlight-2-on-google-chrome-using-the-chrome-dev-channel.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T05:51:54.357

关于支持什么的官方说法是这样的：

[替代文字 http://www.jesseliberty.com/sl/browsers.jpg](http://www.jesseliberty.com/sl/browsers.jpg)

现实情况是，我们确实在**很多**浏览器上运行，但这里的这些部分可能会很快发生变化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T12:48:14.177

值得一提的是，Google Chrome 的 Dev 分支最近更新为支持 Silverlight 2。我试过了，它对我有用。当然，您必须使用 Google Chrome 的 Dev 版本。[您可以在此处](http://dev.chromium.org/getting-involved/dev-channel/)获取有关切换到 Chrome Dev 的更多信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T19:05:22.533

Silverlight 已经可以与 web-kit 一起使用，而且由于 Google 的 Chrome 是基于 web-kit 的，所以要让它工作不应该付出太多努力。

的确，[这位](http://bits.samiq.net/2008/09/silverlight-and-flash-running-on-google.html)先生似乎取得了一些成功。

基于此，我怀疑 Silverlight 会在它成为黄金时得到 Chrome 的完全支持。

# asp.net - 防止意外双击按钮

> ID：50426
> 
> 赞同：8
> 
> 时间：2008-09-08T19:01:38.767
> 
> 标签：asp.net, javascript, button

我有一些控件继承自`ASP.NET buttons`并使用`onserverclick`.

如果用户单击两次，则该按钮会触发两个服务器端事件。我怎样才能防止这种情况？

我尝试通过javascript`this.disabled='true'`在点击后（在`onclick`属性中）进行设置，但这也阻止了第一次回发。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-08T19:06:11.300

请参阅此示例以禁用对回发的控制。它应该可以帮助您完成您想要实现的目标。

[http://encosia.com/2007/04/17/disable-a-button-control-during-postback/](http://encosia.com/2007/04/17/disable-a-button-control-during-postback/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-08T19:11:53.033

您不一定要在回发时显示禁用的按钮。您要确保他们不会意外提交两次。因此，由于*服务器端*操作而禁用或隐藏按钮已经为时已晚。至此，第二个请求已经在进行中。您需要使用 javascript 或确保您的服务器端代码不会运行两次。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-07-13T08:20:56.393

对于 FormView-Template 中的更新面板和按钮，我使用以下方法：

```
<script type="text/javascript">
    // Using that prm reference, hook _initializeRequest
    Sys.WebForms.PageRequestManager.getInstance().add_initializeRequest(InitializeRequestBuchung);

    // Abfangen von Mehrfachklicks auf Buttons für asynchrone Postbacks im Updatepanel
    function InitializeRequestBuchung(sender, args) {
        var arrButtonIds = ["ButtonInsert", "ButtonUpdate"];

        // Get a reference to the PageRequestManager.
        var prm = Sys.WebForms.PageRequestManager.getInstance();
        if (prm.get_isInAsyncPostBack() & jQuery.inArray(args.get_postBackElement().id, arrButtonIds) > -1) {
            args.set_cancel(true);
        }
    }
</script> 
```

如果当前异步回发仍处于活动状态，这将取消后续回发。完美运行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T19:05:13.767

几天前有人在这里的某个地方说过这个，我同意 - 使用 javascript 来简单地*隐藏*按钮而不是禁用它；您可以在其位置显示“微调器”图像，让用户知道发生了什么。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-08T19:11:02.817

我所做的不是隐藏，而是使用 javascript 交换按钮。单击第一个按钮时显示另一个灰色图像。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-08-14T15:52:31.553

将 Button 属性 UseSubmitBehavior 设置为 false。然后创建一个禁用按钮的 OnClientClick 函数。它看起来像这样：

```
<script type="text/javascript">
   function disableFunctn(button){
       button.disabled = true;
   }
</script>
<asp:Button ID="button1" UseSubmitBehavior="false" OnClientClick="disableFunctn(this);"/> 
```

最快最便宜的方式：

```
<asp:Button ID="button1" UseSubmitBehavior="false" OnClientClick="this.disabled=true;"/> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-07-11T22:49:15.927

您也可以尝试例如 btnSave.Enable = false; 当按钮被点击并且在 Click Event 例程中完成按钮处理之前。如果您需要重置它以使其启用，请使用单独的按钮重置按钮以供重用。

另一种方法是设置带有验证的按钮，以便询问用户是否要保存，它应该会弹出两次。

另一种方法是标记第一次出现，然后为第二次设置弹出窗口以验证第二次或后续使用。

# css - CSS - 在左下角放置一个 div

> ID：50430
> 
> 赞同：28
> 
> 时间：2008-09-08T19:03:27.093
> 
> 标签：css, html, positioning

我希望我是一个 CSS 聪明人....

如何在网页的左下角放置一个 div 容器；考虑到用户的滚动位置？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-08T19:07:55.180

要相对于“视口”（它所在的窗口或框架）定位元素，并让它忽略该视口的滚动方式，您可以使用`position: fixed;`属性值（[MDN 文档](https://developer.mozilla.org/en/docs/Web/CSS/position#Fixed_positioning)）。自 Internet Explorer 7 以来，所有浏览器都支持此功能。

要将元素定位在窗口的左下角，我们还需要指定它应该位于`0`距`bottom`and的距离处`left`：

```
position: fixed;
bottom: 0;
left: 0; 
```

### 完整示例

```
.bottom-left {
  position: fixed;
  bottom: 0;
  left: 0;
}

.alert {
  border: 2px solid red;
  background: white;
  font-weight: bold;
  padding: 1em;
}
```

```
<div class="bottom-left alert">
  Look at me!
</div>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam dignissim diam arcu, a gravida justo malesuada et. Fusce iaculis, dui laoreet ultricies congue, arcu lectus rhoncus neque, ut molestie magna augue ut neque. Duis in feugiat ipsum, et imperdiet nunc. Cras convallis lorem eu diam malesuada malesuada. Nunc dapibus suscipit ligula, vel mattis eros blandit id. In placerat justo vitae pretium fermentum. Proin ac erat commodo nibh ullamcorper feugiat. Nulla ultricies maximus massa, non semper dolor malesuada vel. Nullam sem justo, bibendum vel tempus pharetra, gravida vel sapien. Morbi facilisis tristique mauris vel elementum. Ut porttitor egestas metus eget auctor. Phasellus efficitur rutrum massa nec fringilla. Aliquam et imperdiet leo. Sed tincidunt hendrerit tortor eget tempor.</p>

<p>Sed vel dolor lectus. Nulla sed blandit lacus. Mauris ac magna nec libero vehicula aliquet id a libero. Vivamus sed lobortis velit. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Sed at feugiat sapien, ut commodo mi. Quisque scelerisque maximus efficitur. In ultrices, magna eu semper pellentesque, tellus odio hendrerit augue, ut porta sapien lacus quis odio.</p>

<p>Duis sodales, dui a condimentum imperdiet, tellus est laoreet velit, a viverra risus libero sed urna. Phasellus sollicitudin tincidunt viverra. Proin vulputate leo at justo auctor feugiat. Nam auctor, mauris at commodo tempus, eros diam varius ligula, vitae efficitur massa lectus et enim. Integer tristique nibh in lacus condimentum, et interdum urna mollis. Aenean id risus tristique, volutpat dolor sed, fermentum ex. Interdum et malesuada fames ac ante ipsum primis in faucibus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nullam velit nibh, elementum at orci quis, tempor fermentum tellus. Nunc facilisis nisi at leo auctor aliquet. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Aliquam tempor ipsum vel scelerisque tincidunt. Etiam vulputate auctor ante, in tristique est congue ut. Vestibulum maximus nibh vestibulum tristique ullamcorper. Phasellus eu eleifend ante, nec efficitur nulla.</p>

<p>Nunc pulvinar purus id arcu egestas, sed iaculis nisl finibus. Sed cursus bibendum tortor, id cursus lacus euismod in. Nam lacinia, sapien faucibus dapibus varius, neque velit fringilla est, in porta quam sem sit amet ligula. Aliquam ornare est ac pellentesque suscipit. Curabitur eleifend convallis sem, volutpat efficitur erat laoreet id. Maecenas interdum ante in lectus varius, lobortis auctor quam rutrum. Nullam tristique felis quis lectus luctus gravida. Cras porttitor pellentesque nibh. Fusce placerat vehicula commodo. Mauris vel lectus viverra sem consectetur sagittis quis vel lectus. Quisque vel dapibus augue. Sed lacinia massa quis dui sodales faucibus.</p>

<p>Donec sagittis, dolor sed fermentum dapibus, justo ipsum porttitor purus, sed fermentum mi nulla non lorem. Praesent aliquet iaculis molestie. Phasellus enim nunc, vestibulum non odio vel, porta imperdiet lorem. Morbi laoreet felis a ipsum elementum sollicitudin. Morbi varius mollis ex, a posuere lorem fringilla ac. Curabitur metus ligula, mollis quis diam eu, pulvinar placerat libero. Aenean vestibulum lacinia diam in facilisis. Praesent egestas sapien a est consequat facilisis. Nulla id mauris a metus venenatis pellentesque. Praesent justo augue, efficitur ac vulputate et, luctus at elit. Proin quis urna quam. Pellentesque iaculis, felis sed hendrerit venenatis, purus augue venenatis tellus, a posuere justo tellus at ex. Donec et arcu non arcu scelerisque efficitur nec sed dolor. Sed eget lacus enim. Donec sodales mollis condimentum.</p>
```

# vb.net - 如何迭代锯齿状数组？

> ID：50450
> 
> 赞同：2
> 
> 时间：2008-09-08T19:12:28.587
> 
> 标签：vb.net, arrays, jagged-arrays

这让我发疯了好几天。为什么以下不起作用？

> ```
>  Dim arr(3, 3) As Integer
> 
>     For y As Integer = 0 To arr.GetLength(0) - 1
>         For x As Integer = 0 To arr.GetLength(y) - 1
>             arr(y, x) = y + x
>         Next
>     Next 
> ```

另外，如果数组看起来像这样呢？

```
{ {1, 2, 3},
  {4, 5, 6, 7, 8, 9, 9, 9},
  {5, 4, 3, 2}
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-08T19:15:57.500

因为没有“2”或“3”维度。应该是 .GetLength(1) 而不是 .GetLength(y)

另外：在 VB.Net 中，数组声明的工作方式略有不同。您在声明中指定的下标是最后一个索引，而不是像 C# 或 C++ 那样创建的项目数。但是该数组仍然像 C# 或 C++ 那样以 0 为索引，而不是像 VB6 那样以 1 为索引。这意味着，如果您从其他语言迁移到 VB.Net，则无论是哪种语言，您的数组直觉都可能是错误的。在 VB.Net 中，*Dim arr(3,3) As Integer*实际上创建了一个**4x4**数组。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-08T20:45:17.957

好的，所以你真正需要的是一个“锯齿状数组”。这将允许您拥有一个“包含其他不同长度数组的数组”。

```
 Dim arr As Integer()() = {New Integer() {1, 2, 3}, New Integer() {4, 5, 6, 7, 8, 9, 9, 9}, New Integer() {5, 4, 3, 2}}

  For x = 0 To arr.GetUpperBound(0)
      Console.WriteLine("Row " & x & " has " & arr(x).GetUpperBound(0) & " columns")
      For y = 0 To arr(x).GetUpperBound(0)
          Console.WriteLine("(" & x & "," & y & ") = " & arr(x)(y))
      Next
   Next 
```

输出：

```
Row 0 has 2 columns
(0,0) = 1
(0,1) = 2
(0,2) = 3
Row 1 has 7 columns
(1,0) = 4
(1,1) = 5
(1,2) = 6
(1,3) = 7
(1,4) = 8
(1,5) = 9
(1,6) = 9
(1,7) = 9
Row 2 has 3 columns
(2,0) = 5
(2,1) = 4
(2,2) = 3
(2,3) = 2 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-08T19:13:37.023

`arr.GetLength(y)`

应该

`arr.GetLength(1)`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T19:45:34.043

好吧，如果我有一个看起来像这样的数组怎么办

```
{ {1, 2, 3},
  {4, 5, 6, 7, 8, 9, 9, 9},
  {5, 4, 3, 2}
} 
```

GetLength(1) 如何仍然知道每行的长度？

* * *

基本上我想要的是....**一种查找任何给定行中元素数量的方法**。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T20:21:38.280

```
Dim arr(3, 3) As Integer
Dim y As Integer
Dim x As Integer

For x = 0 To arr.Rank - 1
    For y = 0 To arr.GetLength(x) - 2
        arr(x, y) = x + y
    Next
Next 
```

上面的代码对我有用。

编辑，虽然代码感觉很脏。我想知道你想要完成什么？

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-08T20:17:54.217

您的声明：`DIM arr(3,3) As Integer`allready 指定任何给定行中有 3 个元素（或 4 个，我对 VB 不太确定）

你可以试试：

```
Dim arr(3) as Integer() 
```

然后，您应该能够：

```
arr(n).Length 
```

求第 n 行的长度。

我对 VB6 有点生疏，从未学过 VB.NET，但这应该会给你一个“锯齿状”数组。查看有关多维数组的 msdn 文档。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-09-02T21:55:14.357

这段代码在 C# 中是获取锯齿状数组中的所有项目组合：

```
 static void Main(string[] args)
    {
        bool exit = false;
        int[] indices = new int[3] { 0, 0, 0 };
        string[][] vectores = new string[3][];

        vectores[0] = new string[] { "A", "B", "C" };
        vectores[1] = new string[] { "A", "B" };
        vectores[2] = new string[] { "B", "D", "E", "F" };

        string[] item;
        int[] tamaños = new int[3]{vectores[0].GetUpperBound(0), 
            vectores[1].GetUpperBound(0), 
            vectores[2].GetUpperBound(0)};

        while (!exit)
        {
            item = new string[]{ vectores[0][indices[0]],
                    vectores[1][indices[1]],
                    vectores[2][indices[2]]};

            Console.WriteLine("[{0},{1},{2}]={3}{4}{5}", indices[0], indices[1], indices[2], item[0], item[1], item[2]);
            GetVector(tamaños, ref indices, ref exit);
        }
        Console.ReadKey();
    }

    public static void GetVector(int[] tamaños, ref int[] indices, ref bool exit)
    {
        for (int i = tamaños.GetUpperBound(0); i >= 0; i--)
        {
            if (tamaños[i] > indices[i])
            {
                indices[i]++;
                break;
            }
            else
            {
                //ULTIMO ITEM EN EL ARRAY, VALIDAR LAS OTRAS DIMENSIONES SI YA ESTA EN EL ULTIMO ITEM
                if (!ValidateIndexes(tamaños, indices))
                    indices[i] = 0;
                else
                {
                    exit = true;
                    break;
                }
            }
        }
    }

    public static bool ValidateIndexes(int[] tamaños, int[] indices)
    {
        for (int i = 0; i < tamaños.Length; i++)
        {
            if (tamaños[i] != indices[i])
                return false;
        }
        return true;
    } 
```

输出看起来像 [0,0,0]=AAB [0,0,1]=AAD [0,0,2]=AAE [0,0,3]=AAF [0,1,0]=ABB [ 0,1,1]=ABD [0,1,2]=ABE [0,1,3]=ABF [1,0,0]=BAB [1,0,1]=BAD [1,0,2] ]=BAE [1,0,3]=BAF [1,1,0]=BBB [1,1,1]=BBD [1,1,2]=BBE [1,1,3]=BBF [2 ,0,0]=CAB [2,0,1]=CAD [2,0,2]=CAE [2,0,3]=CAF [2,1,0]=CBB [2,1,1] =CBD [2,1,2]=CBE [2,1,3]=CBF

# ios - 如何根据内容调整 UITextView 的大小？

> ID：50467
> 
> 赞同：545
> 
> 时间：2008-09-08T19:21:19.517
> 
> 标签：ios, cocoa-touch, autolayout, uikit, uitextview

有没有一种好方法可以调整 a 的大小`UITextView`以符合其内容？比如说我有一个`UITextView`包含一行文本的：

```
"Hello world" 
```

然后我添加另一行文本：

```
"Goodbye world" 
```

在 Cocoa Touch 中是否有一种好方法可以让`rect`文本视图中的所有行都保持不变，以便我可以相应地调整父视图？

作为另一个示例，查看日历应用程序中事件的便笺字段 - 请注意单元格（及其`UITextView`包含的单元格）如何扩展以容纳便笺字符串中的所有文本行。

* * *

## 回答 #1

> 赞同：638
> 
> 时间：2013-09-21T10:26:20.690

这适用于 iOS 6.1 和 iOS 7：

```
- (void)textViewDidChange:(UITextView *)textView
{
    CGFloat fixedWidth = textView.frame.size.width;
    CGSize newSize = [textView sizeThatFits:CGSizeMake(fixedWidth, MAXFLOAT)];
    CGRect newFrame = textView.frame;
    newFrame.size = CGSizeMake(fmaxf(newSize.width, fixedWidth), newSize.height);
    textView.frame = newFrame;
} 
```

或在 Swift 中（适用于 iOS 11 中的 Swift 4.1）

```
let fixedWidth = textView.frame.size.width
let newSize = textView.sizeThatFits(CGSize(width: fixedWidth, height: CGFloat.greatestFiniteMagnitude))
textView.frame.size = CGSize(width: max(newSize.width, fixedWidth), height: newSize.height) 
```

如果您想要支持 iOS 6.1，那么您还应该：

```
textview.scrollEnabled = NO; 
```

* * *

## 回答 #2

> 赞同：579
> 
> 时间：2010-03-21T14:26:31.360

## 这不再适用于 iOS 7 或更高版本

实际上有一种非常简单的方法可以`UITextView`将其大小调整到正确的内容高度。可以使用`UITextView` `contentSize`.

```
CGRect frame = _textView.frame;
frame.size.height = _textView.contentSize.height;
_textView.frame = frame; 
```

需要注意的一件事是，正确的`contentSize`只有在使用 .添加到视图**后才**可用。在此之前它等于`UITextView``addSubview``frame.size`

如果自动布局打开，这将不起作用。使用自动布局，一般方法是使用该`sizeThatFits`方法并更新`constant`高度约束上的值。

```
CGSize sizeThatShouldFitTheContent = [_textView sizeThatFits:_textView.frame.size];
heightConstraint.constant = sizeThatShouldFitTheContent.height; 
```

`heightConstraint`是一个布局约束，您通常通过 IBOutlet 将属性链接到情节提要中创建的高度约束来设置。

* * *

只是为了增加这个惊人的答案，2014，如果你：

```
[self.textView sizeToFit]; 
```

**仅iPhone6+**的行为有所不同：

![在此处输入图像描述](https://i.stack.imgur.com/GCC09.png)

仅使用 6+（不是 5s 或 6）它确实向 UITextView 添加了“一个空白行”。“RL 解决方案”完美地解决了这个问题：

```
CGRect _f = self.mainPostText.frame;
_f.size.height = self.mainPostText.contentSize.height;
self.mainPostText.frame = _f; 
```

它修复了 6+ 的“额外行”问题。

* * *

## 回答 #3

> 赞同：102
> 
> 时间：2014-10-28T01:12:15.390

## 更新

您需要做的关键事情是关闭 UITextView 中的滚动。

```
myTextView.scrollEnabled = @NO 
```

## 原始答案

为了在 a 中动态调整大小`UITextView`，`UITableViewCell`我发现以下组合适用于 Xcode 6 和 iOS 8 SDK：

*   将 a 添加`UITextView`到 a`UITableViewCell`并将其约束到两侧

*   将`UITextView`'`scrollEnabled`属性设置为`NO`。启用滚动后，框架`UITextView`与其内容大小无关，但禁用滚动时，两者之间存在关系。

*   如果您的表格使用 44 的原始默认行高，那么它将自动计算行高，但如果您将默认行高更改为其他值，您可能需要手动打开行高的自动计算`viewDidLoad`：

    ```
     tableView.estimatedRowHeight = 150;
     tableView.rowHeight = UITableViewAutomaticDimension; 
    ```

对于只读动态调整`UITextView`s，就是这样。如果您允许用户编辑 中的文本`UITextView`，您还需要：

*   实现协议的`textViewDidChange:`方法`UITextViewDelegate`，并告诉`tableView`每次编辑文本时重新绘制自己：

    ```
     - (void)textViewDidChange:(UITextView *)textView;
     {
         [tableView beginUpdates];
         [tableView endUpdates];
     } 
    ```

*   并且不要忘记将`UITextView`委托设置在某个地方，无论是 in`Storyboard`还是 in`tableView:cellForRowAtIndexPath:`

* * *

## 回答 #4

> 赞同：93
> 
> 时间：2016-07-17T07:06:09.627

使用代码和故事板的非常简单的工作解决方案。

按代码

```
textView.scrollEnabled = false 
```

通过故事板

取消选中**滚动启用**

[![在此处输入图像描述](https://i.stack.imgur.com/CGWqW.png)](https://i.stack.imgur.com/CGWqW.png)

除此以外无需做任何事情。

* * *

## 回答 #5

> 赞同：64
> 
> 时间：2015-10-01T18:32:46.387

**斯威夫特：**

```
textView.sizeToFit() 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2009-02-08T19:01:43.873

在我的（有限的）经验中，

```
- (CGSize)sizeWithFont:(UIFont *)font forWidth:(CGFloat)width lineBreakMode:(UILineBreakMode)lineBreakMode 
```

不尊重换行符，因此您最终可能会`CGSize`比实际需要的要短得多。

```
- (CGSize)sizeWithFont:(UIFont *)font constrainedToSize:(CGSize)size 
```

似乎确实尊重换行符。

此外，文本实际上并未呈现在`UITextView`. 在我的代码中，我将 的新高度设置为`UITextView`比`sizeOfFont`方法返回的高度大 24 像素。

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2013-09-16T21:35:08.990

在 iOS6 中，您可以`contentSize`在设置文本后立即检查 UITextView 的属性。在 iOS7 中，这将不再起作用。如果要在 iOS7 中恢复此行为，请将以下代码放在 UITextView 的子类中。

```
- (void)setText:(NSString *)text
{
    [super setText:text];

    if (NSFoundationVersionNumber > NSFoundationVersionNumber_iOS_6_1) {
        CGRect rect = [self.textContainer.layoutManager usedRectForTextContainer:self.textContainer];
        UIEdgeInsets inset = self.textContainerInset;
        self.contentSize = UIEdgeInsetsInsetRect(rect, inset).size;
    }
} 
```

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2014-07-25T07:32:55.927

我将在页面底部发布正确的解决方案，以防有人勇敢（或绝望）阅读到这一点。

对于那些不想阅读所有文本的人来说，这里是 gitHub 存储库：[resizableTextView](https://github.com/Nikita2k/resizableTextView)

**这适用于 iOs7（我相信它适用于 iOs8）和自动布局。你不需要幻数，禁用布局和类似的东西。**简短而优雅的解决方案。

我认为，所有与约束相关的代码都应该转到`updateConstraints`方法。所以，让我们自己制作`ResizableTextView`.

我们在这里遇到的第一个问题是在方法之前不知道真实的内容大小`viewDidLoad`。我们可以根据字体大小、换行符等来计算它。但是我们需要强大的解决方案，所以我们会这样做：

`CGSize contentSize = [self sizeThatFits:CGSizeMake(self.frame.size.width, FLT_MAX)];`

所以现在我们知道真正的 contentSize 无论我们在哪里： before 或 after `viewDidLoad`。现在在 textView 上添加高度约束（通过故事板或代码，无论如何）。我们将使用以下方法调整该值`contentSize.height`：

```
[self.constraints enumerateObjectsUsingBlock:^(NSLayoutConstraint *constraint, NSUInteger idx, BOOL *stop) {
    if (constraint.firstAttribute == NSLayoutAttributeHeight) {
        constraint.constant = contentSize.height;
        *stop = YES;
    }
}]; 
```

最后要做的就是告诉超类到`updateConstraints`.

```
[super updateConstraints]; 
```

现在我们的类看起来像：

**可调整大小的TextView.m**

```
- (void) updateConstraints {
    CGSize contentSize = [self sizeThatFits:CGSizeMake(self.frame.size.width, FLT_MAX)];

    [self.constraints enumerateObjectsUsingBlock:^(NSLayoutConstraint *constraint, NSUInteger idx, BOOL *stop) {
        if (constraint.firstAttribute == NSLayoutAttributeHeight) {
            constraint.constant = contentSize.height;
            *stop = YES;
        }
    }];

    [super updateConstraints];
} 
```

漂亮干净，对吧？而且您不必在**控制器**中处理该代码！

**可是等等！** **没有动画！**

您可以轻松地为更改设置动画以`textView`平滑拉伸。这是一个例子：

```
 [self.view layoutIfNeeded];
    // do your own text change here.
    self.infoTextView.text = [NSString stringWithFormat:@"%@, %@", self.infoTextView.text, self.infoTextView.text];
    [self.infoTextView setNeedsUpdateConstraints];
    [self.infoTextView updateConstraintsIfNeeded];
    [UIView animateWithDuration:1 delay:0 options:UIViewAnimationOptionLayoutSubviews animations:^{
        [self.view layoutIfNeeded];
    } completion:nil]; 
```

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2008-09-08T20:36:56.947

你试过了`[textView sizeThatFits:textView.bounds]`吗？

编辑： sizeThatFits 返回大小，但实际上并没有调整组件的大小。我不确定这是否是您想要的，或者是否`[textView sizeToFit]`是您正在寻找的更多。无论哪种情况，我都不知道它是否完全符合您想要的内容，但这是首先要尝试的。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2008-09-20T06:19:17.460

另一种方法是使用以下方法查找特定字符串将占用的大小`NSString`：

`-(CGSize)sizeWithFont:(UIFont *)font constrainedToSize:(CGSize)size`

这将返回适合给定字符串和给定字体的矩形的大小。传入具有所需宽度和最大高度的尺寸，然后您可以查看返回的高度以适合文本。有一个版本还可以让您指定换行模式。

然后，您可以使用返回的大小来更改视图的大小以适应。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2016-03-04T07:16:20.687

我们可以通过约束来做到这一点。

1.  为 UITextView 设置高度约束。 [![在此处输入图像描述](https://i.stack.imgur.com/mKaOJ.png)](https://i.stack.imgur.com/mKaOJ.png)

2.为该高度约束创建 IBOutlet。

```
 @property (weak, nonatomic) IBOutlet NSLayoutConstraint *txtheightconstraints; 
```

3.不要忘记为您的文本视图设置委托。

4.

```
-(void)textViewDidChange:(UITextView *)textView
{
    CGFloat fixedWidth = textView.frame.size.width;
    CGSize newSize = [textView sizeThatFits:CGSizeMake(fixedWidth, MAXFLOAT)];
    CGRect newFrame = textView.frame;
    newFrame.size = CGSizeMake(fmaxf(newSize.width, fixedWidth), newSize.height);
    NSLog(@"this is updating height%@",NSStringFromCGSize(newFrame.size));
    [UIView animateWithDuration:0.2 animations:^{
                  _txtheightconstraints.constant=newFrame.size.height;
    }];

} 
```

然后像这样更新你的约束:)

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2012-10-24T11:20:18.257

如果您没有`UITextView`方便（例如，您正在调整表格视图单元格的大小），则必须通过测量字符串来计算大小，然后计算 a 每一侧的 8 pt 填充`UITextView`。例如，如果您知道文本视图所需的宽度并想计算出相应的高度：

```
NSString * string = ...;
CGFloat textViewWidth = ...;
UIFont * font = ...;

CGSize size = CGSizeMake(textViewWidth - 8 - 8, 100000);
size.height = [string sizeWithFont:font constrainedToSize:size].height + 8 + 8; 
```

在这里，每个 8 占四个填充边缘之一，而 100000 只是作为一个非常大的最大尺寸。

在实践中，您可能希望`font.leading`在高度上增加一个额外的值；这会在您的文本下方添加一个空白行，如果文本视图正下方有视觉上沉重的控件，这可能会更好看。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2015-06-04T17:41:49.917

从 iOS 8 开始，可以使用 UITableView 的自动布局功能来自动调整 UITextView 的大小，而无需任何自定义代码。我在[github](https://github.com/ksoftllc/UITableView-with-UITextView-and-UILabel-Resize)中放了一个项目来演示这一点，但这里是关键：

1.  UITextView 必须禁用滚动，您可以通过编程方式或通过界面生成器执行此操作。如果启用滚动，它不会调整大小，因为滚动可以让您查看更大的内容。
2.  在 UITableViewController 的 viewDidLoad 中，您必须为 estimatedRowHeight 设置一个值，然后将其设置`rowHeight`为`UITableViewAutomaticDimension`.

```
 - (void)viewDidLoad {
    [super viewDidLoad];
    self.tableView.estimatedRowHeight = self.tableView.rowHeight;
    self.tableView.rowHeight = UITableViewAutomaticDimension;
} 
```

3.  项目部署目标必须是 iOS 8 或更高版本。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2008-11-06T04:31:12.733

结合迈克麦克马斯特的回答，您可能想要执行以下操作：

```
[myTextView setDelegate: self];

...

- (void)textViewDidChange:(UITextView *)textView {
  if (myTextView == textView) {
     // it changed.  Do resizing here.
  }
} 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2011-03-14T10:13:32.440

我找到了一种方法来根据其中的文本调整文本字段的高度，并根据文本字段的高度在其下方排列一个标签！这是代码。

```
UITextView *_textView = [[UITextView alloc] initWithFrame:CGRectMake(10, 10, 300, 10)];
NSString *str = @"This is a test text view to check the auto increment of height of a text view. This is only a test. The real data is something different.";
_textView.text = str;

[self.view addSubview:_textView];
CGRect frame = _textView.frame;
frame.size.height = _textView.contentSize.height;
_textView.frame = frame;

UILabel *lbl = [[UILabel alloc] initWithFrame:CGRectMake(10, 5 + frame.origin.y + frame.size.height, 300, 20)];
lbl.text = @"Hello!";
[self.view addSubview:lbl]; 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2015-01-02T06:58:22.503

使用自动布局的人并且您的 sizetofit 不起作用，那么请检查您的宽度限制一次。如果您错过了宽度限制，那么高度将是准确的。

无需使用任何其他 API。只需一行就可以解决所有问题。

```
[_textView sizeToFit]; 
```

在这里，我只关心高度，保持宽度固定，并错过了我的 TextView 在情节提要中的宽度约束。

这是为了显示来自服务的动态内容。

希望这可能会有所帮助..

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2015-11-02T10:18:23.187

以下内容就足够了：

1.  只需记住将启用的**滚动**设置为**NO**`UITextView`：

[![在此处输入图像描述](https://i.stack.imgur.com/Xuv3Z.png)](https://i.stack.imgur.com/Xuv3Z.png)

2.  正确设置自动布局约束。

你甚至可以使用`UITableViewAutomaticDimension`.

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2017-03-21T13:38:27.150

我查看了所有答案，所有答案都保持固定宽度并仅调整高度。如果你想调整宽度，你可以很容易地使用这个方法：

所以在配置你的文本视图时，设置滚动禁用

```
textView.isScrollEnabled = false 
```

然后在委托方法中`func textViewDidChange(_ textView: UITextView)`添加以下代码：

```
func textViewDidChange(_ textView: UITextView) {
    let newSize = textView.sizeThatFits(CGSize(width: CGFloat.greatestFiniteMagnitude, height: CGFloat.greatestFiniteMagnitude))
    textView.frame = CGRect(origin: textView.frame.origin, size: newSize)
} 
```

输出：

[![在此处输入图像描述](https://i.stack.imgur.com/NFe0a.png)](https://i.stack.imgur.com/NFe0a.png)

[![在此处输入图像描述](https://i.stack.imgur.com/k40zg.png)](https://i.stack.imgur.com/k40zg.png)

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2020-02-27T18:14:37.637

使用 UITextViewDelegate 是最简单的方法：

```
func textViewDidChange(_ textView: UITextView) {
    textView.sizeToFit()
    textviewHeight.constant = textView.contentSize.height
} 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2018-01-10T13:06:48.600

禁用滚动

[![](https://i.stack.imgur.com/60exo.png)](https://i.stack.imgur.com/60exo.png)

添加约束

[![](https://i.stack.imgur.com/lH2fW.png)](https://i.stack.imgur.com/lH2fW.png)

并添加您的文字

```
[yourTextView setText:@"your text"];
[yourTextView layoutIfNeeded]; 
```

如果你使用`UIScrollView`你也应该添加这个；

```
[yourScrollView layoutIfNeeded];

-(void)viewDidAppear:(BOOL)animated{
    CGRect contentRect = CGRectZero;

    for (UIView *view in self.yourScrollView.subviews) {
         contentRect = CGRectUnion(contentRect, view.frame);
    }
    self.yourScrollView.contentSize = contentRect.size;
} 
```

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2012-10-08T17:59:10.417

当我需要使文本`UITextView`适合特定区域时，这很有效：

```
// 文本必须已经添加到子视图中，否则 contentviewsize 会出错。

- (void) reduceFontToFit: (UITextView *)tv {
    UIFont *font = tv.font;
    双pointSize = font.pointSize;

    而（tv.contentSize.height > tv.frame.size.height && pointSize > 7.0）{
        点大小-= 1.0；
        UIFont *newFont = [UIFont fontWithName:font.fontName size:pointSize];
        tv.font = 新字体；
    }
    if (pointSize != font.pointSize)
        NSLog(@"font down to %.1f from %.1f", pointSize, tv.font.pointSize);
}

```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2015-03-07T16:02:09.333

这是@jhibberd 的快速版本

```
 let cell:MsgTableViewCell! = self.tableView.dequeueReusableCellWithIdentifier("MsgTableViewCell", forIndexPath: indexPath) as? MsgTableViewCell
    cell.msgText.text = self.items[indexPath.row]
    var fixedWidth:CGFloat = cell.msgText.frame.size.width
    var size:CGSize = CGSize(width: fixedWidth,height: CGFloat.max)
    var newSize:CGSize = cell.msgText.sizeThatFits(size)
    var newFrame:CGRect = cell.msgText.frame;
    newFrame.size = CGSizeMake(CGFloat(fmaxf(Float(newSize.width), Float(fixedWidth))), newSize.height);
    cell.msgText.frame = newFrame
    cell.msgText.frame.size = newSize        
    return cell 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2013-09-20T02:39:00.403

对于 iOS 7.0，不要将 设置`frame.size.height`为`contentSize.height`（目前什么都不做）使用`[textView sizeToFit]`.

看到[这个问题](https://stackoverflow.com/a/18905603/659310)。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2019-12-09T13:45:52.267

这适用于**Swift 5**，以防您希望在用户即时编写文本后适应您的 TextView。

只需使用以下方法实现**UITextViewDelegate**：

```
func textViewDidChange(_ textView: UITextView) {
    let newSize = textView.sizeThatFits(CGSize(width: CGFloat.greatestFiniteMagnitude, height: CGFloat.greatestFiniteMagnitude))
    textView.frame.size = CGSize(width: newSize.width, height: newSize.height)
} 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2012-07-30T01:56:34.430

如果有其他人到这里，这个解决方案对我有用，1“Ronnie Liew”+4“user63934”（我的文本来自网络服务）：注意 1000（“在我的情况下”没有什么可以这么大）

```
UIFont *fontNormal = [UIFont fontWithName:FONTNAME size:FONTSIZE];

NSString *dealDescription = [client objectForKey:@"description"];

//4
CGSize textSize = [dealDescription sizeWithFont:fontNormal constrainedToSize:CGSizeMake(containerUIView.frame.size.width, 1000)];

CGRect dealDescRect = CGRectMake(10, 300, containerUIView.frame.size.width, textSize.height);

UITextView *dealDesc = [[[UITextView alloc] initWithFrame:dealDescRect] autorelease];

dealDesc.text = dealDescription;
//add the subview to the container
[containerUIView addSubview:dealDesc];

//1) after adding the view
CGRect frame = dealDesc.frame;
frame.size.height = dealDesc.contentSize.height;
dealDesc.frame = frame; 
```

那就是……干杯

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2010-03-17T17:31:32.510

希望这可以帮助：

```
- (void)textViewDidChange:(UITextView *)textView {
  CGSize textSize = textview.contentSize;
  if (textSize != textView.frame.size)
      textView.frame.size = textSize;
} 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2013-09-06T06:27:03.373

我发现根据文本大小重新调整 UITextView 高度的最佳方法。

```
CGSize textViewSize = [YOURTEXTVIEW.text sizeWithFont:[UIFont fontWithName:@"SAMPLE_FONT" size:14.0]
                       constrainedToSize:CGSizeMake(YOURTEXTVIEW.frame.size.width, FLT_MAX)]; 
```

或者你可以使用

```
CGSize textViewSize = [YOURTEXTVIEW.text sizeWithFont:[UIFont fontWithName:@"SAMPLE_FONT" size:14.0]
                       constrainedToSize:CGSizeMake(YOURTEXTVIEW.frame.size.width, FLT_MAX) lineBreakMode:NSLineBreakByTruncatingTail]; 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2014-11-30T21:43:46.880

对于那些希望 textview 实际向上移动并保持底线位置的人

```
CGRect frame = textView.frame;
frame.size.height = textView.contentSize.height;

if(frame.size.height > textView.frame.size.height){
    CGFloat diff = frame.size.height - textView.frame.size.height;
    textView.frame = CGRectMake(0, textView.frame.origin.y - diff, textView.frame.size.width, frame.size.height);
}
else if(frame.size.height < textView.frame.size.height){
    CGFloat diff = textView.frame.size.height - frame.size.height;
    textView.frame = CGRectMake(0, textView.frame.origin.y + diff, textView.frame.size.width, frame.size.height);
} 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2015-04-08T08:25:57.160

唯一可以使用的代码是在上面的 jhibberd 答案中使用“SizeToFit”的代码，但实际上除非您在**ViewDidAppear**中调用它或将其连接到 UITextView 文本更改事件，否则它不会启动。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2015-05-13T12:46:46.857

根据 Nikita Take 的回答，我在 Swift 中找到了以下解决方案，该解决方案适用于具有自动布局的 iOS 8：

```
 descriptionTxt.scrollEnabled = false
    descriptionTxt.text = yourText

    var contentSize = descriptionTxt.sizeThatFits(CGSizeMake(descriptionTxt.frame.size.width, CGFloat.max))
    for c in descriptionTxt.constraints() {
        if c.isKindOfClass(NSLayoutConstraint) {
            var constraint = c as! NSLayoutConstraint
            if constraint.firstAttribute == NSLayoutAttribute.Height {
                constraint.constant = contentSize.height
                break
            }
        }
    } 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2015-05-16T23:16:38.437

快速回答：以下代码计算 textView 的高度。

```
 let maximumLabelSize = CGSize(width: Double(textView.frame.size.width-100.0), height: DBL_MAX)
                let options = NSStringDrawingOptions.TruncatesLastVisibleLine | NSStringDrawingOptions.UsesLineFragmentOrigin
                let attribute = [NSFontAttributeName: textView.font!]
                let str = NSString(string: message)
                let labelBounds = str.boundingRectWithSize(maximumLabelSize,
                    options: NSStringDrawingOptions.UsesLineFragmentOrigin,
                    attributes: attribute,
                    context: nil)
                let myTextHeight = CGFloat(ceilf(Float(labelBounds.height))) 
```

现在您可以将 textView 的高度设置为`myTextHeight`

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2017-03-31T09:39:19.337

如果您需要调整大小`textView`并`tableViewCell`动态调整，这是答案`staticTableView`

[ [https://stackoverflow.com/a/43137182/5360675][1]](https://stackoverflow.com/a/43137182/5360675][1])

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2017-09-25T06:04:48.640

像 ios 11 上的魅力一样工作，我在一个单元格中工作，就像一个带有气泡的聊天单元格。

```
let content = UITextView(frame: CGRect(x: 4, y: 4, width: 0, height: 0))
content.text = "what ever short or long text you wanna try"
content.textAlignment = NSTextAlignment.left
content.font = UIFont.systemFont(ofSize: 13)
let spaceAvailable = 200 //My cell is fancy I have to calculate it...
let newSize = content.sizeThatFits(CGSize(width: CGFloat(spaceAvailable), height: CGFloat.greatestFiniteMagnitude))
content.isEditable = false
content.dataDetectorTypes = UIDataDetectorTypes.all
content.isScrollEnabled = false
content.backgroundColor = UIColor.clear
bkgView.addSubview(content) 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2013-09-29T22:56:33.403

这种方法似乎适用于 ios7

```
 // Code from apple developer forum - @Steve Krulewitz, @Mark Marszal, @Eric Silverberg
- (CGFloat)measureHeight
{
    if ([self respondsToSelector:@selector(snapshotViewAfterScreenUpdates:)])
    {
    CGRect frame = internalTextView.bounds;
    CGSize fudgeFactor;
    // The padding added around the text on iOS6 and iOS7 is different.
    fudgeFactor = CGSizeMake(10.0, 16.0);

    frame.size.height -= fudgeFactor.height;
    frame.size.width -= fudgeFactor.width;

    NSMutableAttributedString* textToMeasure;
    if(internalTextView.attributedText && internalTextView.attributedText.length > 0){
        textToMeasure = [[NSMutableAttributedString alloc] initWithAttributedString:internalTextView.attributedText];
    }
    else{
        textToMeasure = [[NSMutableAttributedString alloc] initWithString:internalTextView.text];
        [textToMeasure addAttribute:NSFontAttributeName value:internalTextView.font range:NSMakeRange(0, textToMeasure.length)];
    }

    if ([textToMeasure.string hasSuffix:@"\n"])
    {
        [textToMeasure appendAttributedString:[[NSAttributedString alloc] initWithString:@"-" attributes:@{NSFontAttributeName: internalTextView.font}]];
    }

    // NSAttributedString class method: boundingRectWithSize:options:context is
    // available only on ios7.0 sdk.
    CGRect size = [textToMeasure boundingRectWithSize:CGSizeMake(CGRectGetWidth(frame), MAXFLOAT)
                                              options:NSStringDrawingUsesLineFragmentOrigin
                                              context:nil];

    return CGRectGetHeight(size) + fudgeFactor.height;
}
else
{
    return self.internalTextView.contentSize.height;
}
} 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2015-10-22T07:41:30.153

询问 a 的最简单方法`UITextView`是调用`-sizeToFit`它也应该与 一起使用`scrollingEnabled = YES`，然后检查高度并在文本视图上添加具有相同值的高度约束。
注意`UITexView`包含插入，这意味着您不能询问字符串对象要使用多少空间，因为这只是文本的边界矩形。
所有使用它的人都遇到错误的大小`-sizeToFit`可能是由于文本视图尚未布局到界面大小。
当您使用 size classes 和 a 时，总是会发生这种情况`UITableView`，第一次在`- tableView:cellForRowAtIndexPath:`带有任意配置的大小，如果您计算您刚才的值，文本视图将具有与预期不同的宽度，这将拧紧所有尺寸。
为了克服这个问题，我发现重写`-layoutSubviews`单元格的方法来重新计算 textview 高度很有用。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2016-01-24T11:31:24.127

如果您正在使用滚动视图和内容视图，并且您想根据 TextView 内容高度增加高度，那么这段代码将对您有所帮助。

**希望这会有所帮助，它在 iOS9.2 中完美运行**

当然设置`textview.scrollEnabled = NO;`

```
-(void)adjustHeightOfTextView
{
    //this pieces of code will helps to adjust the height of the uitextview View W.R.T content
    //This block of code work will calculate the height of the textview text content height and calculate the height for the whole content of the view to be displayed.Height --> 400 is fixed,it will change if you change anything in the storybord.

CGSize textViewSize = [self.textview sizeThatFits:CGSizeMake(self.view.frame.size.width, self.view.frame.size.height)];//calulcate the content width and height

float textviewContentheight =textViewSize.height;
self.scrollview.contentSize = CGSizeMake(self.textview.frame.size.width,textviewContentheight + 400);//height value is passed
self.scrollview.frame =CGRectMake(self.scrollview.frame.origin.x, self.scrollview.frame.origin.y, self.scrollview.frame.size.width, textviewContentheight+400);

CGRect Frame = self.contentview.frame;
Frame.size.height = textviewContentheight + 400;
[self.contentview setFrame:Frame];

self.textview.frame =CGRectMake(self.textview.frame.origin.x, self.textview.frame.origin.y, self.textview.frame.size.width, textviewContentheight);
[ self.textview setContentSize:CGSizeMake( self.textview.frame.size.width,textviewContentheight)];
self.contenview_heightConstraint.constant = 

self.scrollview.bounds.size.height;
    NSLog(@"%f",self.contenview_heightConstraint.constant);
} 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2019-08-31T15:44:29.770

使用 Key Value Observing (KVO) 非常简单，只需创建 UITextView 的子类并执行以下操作：

```
private func setup() { // Called from init or somewhere

    fitToContentObservations = [
        textView.observe(\.contentSize) { _, _ in
            self.invalidateIntrinsicContentSize()
        },
        // For some reason the content offset sometimes is non zero even though the frame is the same size as the content size.
        textView.observe(\.contentOffset) { _, _ in
            if self.contentOffset != .zero { // Need to check this to stop infinite loop
                self.contentOffset = .zero
            }
        }
    ]
}
public override var intrinsicContentSize: CGSize {
    return contentSize
} 
```

如果您不想子类化，可以尝试`textView.bounds = textView.contentSize`在`contentSize`观察者中进行。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2021-02-17T21:11:02.667

对我有用的最简单的解决方案是在 Storyboard 中的 textView 上设置高度约束，然后将 textView 和高度约束连接到代码：

```
@IBOutlet var myAwesomeTextView: UITextView!
@IBOutlet var myAwesomeTextViewHeight: NSLayoutConstraint! 
```

然后在设置文本和段落样式后，在**viewDidAppear**中添加：

```
self.myAwesomeTextViewHeight.constant = self.myAwesomeTextView.contentSize.height 
```

一些注意事项：

1.  与其他解决方案相比，**必须将 isScrollEnabled 设置为 true**才能使其正常工作。
2.  就我而言，我正在为代码中的字体设置自定义属性，因此我必须在 viewDidAppear 中设置高度（在此之前它无法正常工作）。如果您没有在代码中更改任何文本属性，您应该能够在 viewDidLoad 或设置文本后的任何位置设置高度。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2021-03-05T23:55:12.787

看起来这家伙为 NSTextView 想出来了，他的回答也适用于 iOS。原来intrinsicContentSize 不与布局管理器同步。如果在intrinsicContentSize 之后发生布局，您可能会有差异。

他有一个简单的解决办法。

[NSOutlineView 中的 NSTextView 与 IntrinsicContentSize 设置错误的高度](https://stackoverflow.com/questions/47927844/nstextview-in-nsoutlineview-with-intrinsiccontentsize-setting-wrong-height)

* * *

## 回答 #40

> 赞同：-1
> 
> 时间：2018-07-19T06:48:17.263

以下是步骤

解决方案适用于所有版本的 iOS。斯威夫特 3.0 及更高版本。

1.  将您添加`UITextView`到`View`. 我正在使用代码添加它，您可以通过界面生成器添加。
2.  添加约束。我在代码中添加了约束，你也可以在界面生成器中进行。
3.  使用`UITextViewDelegate`方法`func textViewDidChange(_ textView: UITextView)`调整TextView的大小

**代码 ：**

1.  ```
    //1\. Add your UITextView in ViewDidLoad
    let textView = UITextView()
    textView.frame = CGRect(x: 0, y: 0, width: 200, height: 100)
    textView.backgroundColor = .lightGray
    textView.text = "Here is some default text."

    //2\. Add constraints
    textView.translatesAutoresizingMaskIntoConstraints = false
    [
    textView.bottomAnchor.constraint(equalTo: view.safeAreaLayoutGuide.bottomAnchor),
    textView.leadingAnchor.constraint(equalTo: view.leadingAnchor),
    textView.trailingAnchor.constraint(equalTo: view.trailingAnchor),
    textView.heightAnchor.constraint(equalToConstant: 50),
    textView.widthAnchor.constraint(equalToConstant: 30)
    ].forEach{ $0.isActive = true }

    textView.font = UIFont.preferredFont(forTextStyle: .headline)

    textView.delegate = self
    textView.isScrollEnabled = false

    textViewDidChange(textView)

    //3\. Implement the delegate method.
    func textViewDidChange(_ textView: UITextView) {
    let size = CGSize(width: view.frame.width, height: .infinity)
    let estimatedSize = textView.sizeThatFits(size)

    textView.constraints.forEach { (constraint) in
        if constraint.firstAttribute == .height {
            print("Height: ", estimatedSize.height)
            constraint.constant = estimatedSize.height
        }
    }
    } 
    ```

* * *

## 回答 #41

> 赞同：-3
> 
> 时间：2014-12-23T17:31:17.380

不知道为什么人们总是把事情复杂化：这里是：

```
- (void)textViewDidChange:(UITextView *)textView{ CGRect frame = textView.frame;
CGFloat height = [self measureHeightOfUITextView:textView];
CGFloat insets = textView.textContainerInset.top + textView.textContainerInset.bottom;
height += insets;
frame.size.height = height;

if(frame.size.height > textView.frame.size.height){
    CGFloat diff = frame.size.height - textView.frame.size.height;
    textView.frame = CGRectMake(5, textView.frame.origin.y - diff, textView.frame.size.width, frame.size.height);
}
else if(frame.size.height < textView.frame.size.height){
    CGFloat diff = textView.frame.size.height - frame.size.height;
    textView.frame = CGRectMake(5, textView.frame.origin.y + diff, textView.frame.size.width, frame.size.height);
}
[textView setNeedsDisplay];
} 
```

# javascript - 我可以阻止用户将 Javascript 粘贴到设计模式 IFrame 中吗？

> ID：50470
> 
> 赞同：0
> 
> 时间：2008-09-08T19:23:00.573
> 
> 标签：javascript, iframe

我正在构建一个包含设计模式下的 IFrame 的 web 应用程序，以便我的用户可以“启动”他们的内容并粘贴内容以显示在他们的页面上。就像大多数博客引擎或论坛上的所见即所得编辑器一样。

我试图考虑我需要插入的所有潜在安全漏洞，其中之一是用户粘贴 Javascript：

```
<script type="text/javascript">

// Do some nasty stuff

</script> 
```

现在我知道我可以在服务器端删除它，然后再保存和/或返回它，但我担心有人能够粘贴一些脚本并在那里运行它，然后甚至不发送它返回服务器进行处理。

我在担心什么吗？

任何建议都会很棒，在谷歌搜索中找不到太多。

安东尼

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-08T19:28:02.357

> ...我担心有人能够粘贴一些脚本并在那里运行它，然后甚至不将其发送回服务器进行处理。
> 
> 我在担心什么吗？

Firefox 有一个名为 Greasemonkey 的插件，它允许用户对加载到浏览器中的任何页面任意运行 JavaScript，而您对此无能为力。Firebug 允许您修改网页以及运行任意 JavaScript。

AFAIK，你真的只需要担心一旦它到达你的服务器，然后可能会影响其他用户。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-08T19:25:53.670

正如 Jason 所说，我会更专注于清理服务器端的数据。除非您使用 Silverlight / Flex，否则您实际上对客户端没有任何真正的控制权，即使那样您也需要检查服务器。

也就是说，这里有一些来自*“A List Apart”的*提示，您可能会发现对服务器端数据清理很有帮助。

[http://www.alistapart.com/articles/secureyourcode](http://www.alistapart.com/articles/secureyourcode)

# asp.net - VS 2008 SP1 安装后 WebDev.WebServer.EXE 崩溃

> ID：50488
> 
> 赞同：6
> 
> 时间：2008-09-08T19:32:22.063
> 
> 标签：asp.net, webserver

由于各种原因，我无法将 IIS 用于我正在开发的 ASP.NET 网站，因此我从命令行运行 Cassini 来测试该网站。但是，在安装 Visual Studio 2008 SP1 后，当我尝试启动 Web 服务器时收到 System.Net.Sockets.SocketException。有没有其他人有这个问题，如果有，你是如何解决的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-08T19:48:29.187

*   事件日志的应用程序部分有什么内容吗？
*   您是否尝试过使用不同的端口？
*   根据[这个线程](http://forums.asp.net/p/1309348/2575545.aspx)，尝试：

    > 从 Visual Source safe 取消绑定，从解决方案中删除 Web 项目，重命名存储网站的文件夹，然后作为现有网站重新添加到解决方案，然后再次绑定到源安全。

`.suo`您的or`.sln`文件中可能有一些不正确的信息。**您可以安全地重命名**前者，因为它是用户特定**的**（解决方案用户**选项**）；后者（**解决**方案本身）将更麻烦重新**创建****。**

 ******# python - 如何获取当前正在执行的文件的路径和名称？

> ID：50499
> 
> 赞同：515
> 
> 时间：2008-09-08T19:41:10.497
> 
> 标签：python, scripting, file

我有调用其他脚本文件的脚本，但我需要获取当前在进程中运行的文件的文件路径。

例如，假设我有三个文件。使用[execfile](http://docs.python.org/library/functions.html#execfile)：

*   `script_1.py`来电`script_2.py`。
*   反过来，`script_2.py`调用`script_3.py`.

如何*从 中的代码中***`script_3.py`**获取 的文件名和路径，而不必将该信息作为参数传递？*`script_3.py`*`script_2.py`

（执行`os.getcwd()`返回原始启动脚本的文件路径而不是当前文件的。）

* * *

## 回答 #1

> 赞同：591
> 
> 时间：2009-12-23T20:33:47.133

```
__file__ 
```

正如其他人所说。您可能还想使用[os.path.realpath](https://docs.python.org/3/library/os.path.html#os.path.realpath)来消除符号链接：

```
import os

os.path.realpath(__file__) 
```

* * *

## 回答 #2

> 赞同：273
> 
> 时间：2008-09-08T23:02:42.043

p1.py：

```
execfile("p2.py") 
```

p2.py：

```
import inspect, os
print (inspect.getfile(inspect.currentframe())) # script filename (usually with path)
print (os.path.dirname(os.path.abspath(inspect.getfile(inspect.currentframe())))) # script directory 
```

* * *

## 回答 #3

> 赞同：97
> 
> 时间：2015-08-06T22:50:01.307

**2018 年 11 月 28 日更新：**

这是 Python 2 和 3 的实验总结。

main.py - 运行 foo.py
foo.py - 运行 lib/bar.py
lib/bar.py - 打印文件路径表达式

```
| Python | Run statement       | Filepath expression                    |
|--------+---------------------+----------------------------------------|
|      2 | execfile            | os.path.abspath(inspect.stack()[0][1]) |
|      2 | from lib import bar | __file__                               |
|      3 | exec                | (wasn't able to obtain it)             |
|      3 | import lib.bar      | __file__                               | 
```

对于 Python 2，切换到可以使用的包可能更清楚`from lib import bar`- 只需将空`__init__.py`文件添加到两个文件夹中。

对于 Python 3，`execfile`不存在 - 最近的替代方法是`exec(open(<filename>).read())`，尽管这会影响堆栈帧。最简单的方法是使用`import foo`和`import lib.bar`- 不需要`__init__.py`文件。

另请参见[import 和 execfile 之间的区别](https://stackoverflow.com/questions/27517003/difference-between-import-and-execfile)

* * *

**原答案：**

这是基于此线程中答案的实验 - 在 Windows 上使用 Python 2.7.10。

**基于堆栈的那些是唯一似乎给出可靠结果的。最后两个有最短的语法**，即-

```
print os.path.abspath(inspect.stack()[0][1])                   # C:\filepaths\lib\bar.py
print os.path.dirname(os.path.abspath(inspect.stack()[0][1]))  # C:\filepaths\lib 
```

这是将这些作为函数添加到**sys**的内容！感谢@Usagi 和@pablog

基于以下三个文件，并从其文件夹中运行 main.py `python main.py`（还尝试了具有绝对路径的 execfiles 并从单独的文件夹中调用）。

C:\filepaths\main.py: `execfile('foo.py')`
C:\filepaths\foo.py: `execfile('lib/bar.py')`
C:\filepaths\lib\bar.py:

```
import sys
import os
import inspect

print "Python " + sys.version
print

print __file__                                        # main.py
print sys.argv[0]                                     # main.py
print inspect.stack()[0][1]                           # lib/bar.py
print sys.path[0]                                     # C:\filepaths
print

print os.path.realpath(__file__)                      # C:\filepaths\main.py
print os.path.abspath(__file__)                       # C:\filepaths\main.py
print os.path.basename(__file__)                      # main.py
print os.path.basename(os.path.realpath(sys.argv[0])) # main.py
print

print sys.path[0]                                     # C:\filepaths
print os.path.abspath(os.path.split(sys.argv[0])[0])  # C:\filepaths
print os.path.dirname(os.path.abspath(__file__))      # C:\filepaths
print os.path.dirname(os.path.realpath(sys.argv[0]))  # C:\filepaths
print os.path.dirname(__file__)                       # (empty string)
print

print inspect.getfile(inspect.currentframe())         # lib/bar.py

print os.path.abspath(inspect.getfile(inspect.currentframe())) # C:\filepaths\lib\bar.py
print os.path.dirname(os.path.abspath(inspect.getfile(inspect.currentframe()))) # C:\filepaths\lib
print

print os.path.abspath(inspect.stack()[0][1])          # C:\filepaths\lib\bar.py
print os.path.dirname(os.path.abspath(inspect.stack()[0][1]))  # C:\filepaths\lib
print 
```

* * *

## 回答 #4

> 赞同：74
> 
> 时间：2011-07-08T17:50:28.897

我认为这更清洁：

```
import inspect
print inspect.stack()[0][1] 
```

并获得与以下相同的信息：

```
print inspect.getfile(inspect.currentframe()) 
```

其中 [0] 是堆栈中的当前帧（堆栈顶部），[1] 是文件名，增加以在堆栈中向后移动，即

```
print inspect.stack()[1][1] 
```

将是调用当前帧的脚本的文件名。此外，使用 [-1] 将使您到达堆栈的底部，即原始调用脚本。

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2015-02-06T01:05:18.657

```
import os
os.path.dirname(__file__) # relative directory path
os.path.abspath(__file__) # absolute file path
os.path.basename(__file__) # the file name only 
```

* * *

## 回答 #6

> 赞同：37
> 
> 时间：2010-02-26T22:25:29.397

如果您的脚本仅包含一个文件，则标记为最佳的建议都是正确的。

如果您想从可能作为模块导入的文件中找出可执行文件的名称（即传递给当前程序的python解释器的根文件），您需要这样做（假设这是在一个文件中名为*foo.py*）：

`import inspect`

`print inspect.stack()[-1][1]`

因为堆栈上的最后一件事 ( `[-1]`) 是进入其中的第一件事（堆栈是 LIFO/FILO 数据结构）。

然后在文件*bar.py*中，如果您`import foo`将打印*bar.py*而不是*foo.py*，这将是所有这些的值：

*   `__file__`
*   `inspect.getfile(inspect.currentframe())`
*   `inspect.stack()[0][1]`

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2019-08-23T19:19:43.533

由于 Python 3 相当主流，因此我想提供一个`pathlib`答案，因为我相信它现在可能是访问文件和路径信息的更好工具。

```
from pathlib import Path

current_file: Path = Path(__file__).resolve() 
```

如果您正在寻找当前文件的目录，则只需添加语句`.parent`即可：`Path()`

```
current_path: Path = Path(__file__).parent.resolve() 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2008-09-08T19:42:56.920

“当前在进程中运行的文件的文件路径”是什么意思并不完全清楚。 `sys.argv[0]`通常包含 Python 解释器调用的脚本的位置。查看[sys 文档](https://docs.python.org/2/library/sys.html)以获取更多详细信息。

正如@Tim 和@Pat Notz 所指出的， __file__ 属性提供了对

> 加载模块的文件，如果它是从文件加载的

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2013-08-11T03:05:05.107

```
import os
print os.path.basename(__file__) 
```

这只会给我们文件名。即如果文件的绝对路径是 c:\abcd\abc.py 那么第二行将打印 abc.py

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2012-08-08T09:42:27.620

我有一个必须在 windows 环境下工作的脚本。这段代码是我完成的：

```
import os,sys
PROJECT_PATH = os.path.abspath(os.path.split(sys.argv[0])[0]) 
```

这是一个很老套的决定。但它不需要外部库，这对我来说是最重要的。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2019-02-22T17:31:38.173

试试这个，

```
import os
os.path.dirname(os.path.realpath(__file__)) 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2008-09-08T19:56:19.730

该`__file__`属性适用于包含主要执行代码的文件以及导入的模块。

见[https://web.archive.org/web/20090918095828/http://pyref.infogami.com/__file__](https://web.archive.org/web/20090918095828/http://pyref.infogami.com/__file__)

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2014-06-24T15:04:34.567

```
import os
os.path.dirname(os.path.abspath(__file__)) 
```

无需检查或任何其他库。

当我必须导入一个脚本（从不同的目录然后执行的脚本）时，这对我有用，该脚本使用与导入的脚本位于同一文件夹中的配置文件。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2010-01-02T18:34:55.573

```
import sys

print sys.path[0] 
```

这将打印当前执行脚本的路径

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2008-09-08T19:44:07.433

我认为这只是`__file__` 听起来您可能还想[检查检查模块](https://docs.python.org/2/library/inspect.html)。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2008-09-09T00:00:52.887

您可以使用`inspect.stack()`

```
import inspect,os
inspect.stack()[0]  => (<frame object at 0x00AC2AC0>, 'g:\\Python\\Test\\_GetCurrentProgram.py', 15, '<module>', ['print inspect.stack()[0]\n'], 0)
os.path.abspath (inspect.stack()[0][1]) => 'g:\\Python\\Test\\_GetCurrentProgram.py' 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2010-04-19T07:47:21.700

```
import sys
print sys.argv[0] 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2015-06-14T16:37:44.943

这应该有效：

```
import os,sys
filename=os.path.basename(os.path.realpath(sys.argv[0]))
dirname=os.path.dirname(os.path.realpath(sys.argv[0])) 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2019-05-05T01:19:50.733

```
print(__file__)
print(__import__("pathlib").Path(__file__).parent) 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2019-06-28T01:28:38.270

这是我使用的，所以我可以毫无问题地将我的代码扔到任何地方。`__name__`总是被定义，但`__file__`仅在代码作为文件运行时才被定义（例如，不在 IDLE/iPython 中）。

```
if '__file__' in globals():
    self_name = globals()['__file__']
elif '__file__' in locals():
    self_name = locals()['__file__']
else:
    self_name = __name__ 
```

或者，这可以写成：

```
self_name = globals().get('__file__', locals().get('__file__', __name__)) 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2017-05-10T10:51:15.587

获取执行脚本的目录

```
 print os.path.dirname( inspect.getfile(inspect.currentframe())) 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2011-03-01T09:23:09.230

我使用了 __file__ 的方法，
`os.path.abspath(__file__)`
但有一个小技巧，它在第一次运行代码时返回 .py 文件，下一次运行给出 *.pyc 文件的名称，
所以我留下来：
`inspect.getfile(inspect.currentframe())`
或
`sys._getframe().f_code.co_filename`

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-06-14T15:06:50.273

我写了一个函数，它考虑到了 eclipse **debugger**和**unittest**。它返回您启动的第一个脚本的文件夹。您可以选择指定*__file__* var，但主要是您不必在所有**调用层次结构**中共享此变量。

也许你可以处理我没有看到的其他堆栈特殊情况，但对我来说没关系。

```
import inspect, os
def getRootDirectory(_file_=None):
    """
    Get the directory of the root execution file
    Can help: http://stackoverflow.com/questions/50499/how-do-i-get-the-path-and-name-of-the-file-that-is-currently-executing
    For eclipse user with unittest or debugger, the function search for the correct folder in the stack
    You can pass __file__ (with 4 underscores) if you want the caller directory
    """
    # If we don't have the __file__ :
    if _file_ is None:
        # We get the last :
        rootFile = inspect.stack()[-1][1]
        folder = os.path.abspath(rootFile)
        # If we use unittest :
        if ("/pysrc" in folder) & ("org.python.pydev" in folder):
            previous = None
            # We search from left to right the case.py :
            for el in inspect.stack():
                currentFile = os.path.abspath(el[1])
                if ("unittest/case.py" in currentFile) | ("org.python.pydev" in currentFile):
                    break
                previous = currentFile
            folder = previous
        # We return the folder :
        return os.path.dirname(folder)
    else:
        # We return the folder according to specified __file__ :
        return os.path.dirname(os.path.realpath(_file_)) 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-04-12T05:19:36.633

要保持跨平台（macOS/Windows/Linux）的迁移一致性，请尝试：

`path = r'%s' % os.getcwd().replace('\\','/')`

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2018-06-08T12:29:47.303

最简单的方法是：

在**script_1.py 中：**

```
import subprocess
subprocess.call(['python3',<path_to_script_2.py>]) 
```

在**script_2.py 中：**

```
sys.argv[0] 
```

PS：我试过`execfile`了，但是因为它把 script_2.py 作为字符串读取，所以`sys.argv[0]`返回了`<string>`.

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2019-01-23T16:31:44.130

我一直只是使用当前工作目录或 CWD 的 os 功能。这是标准库的一部分，很容易实现。这是一个例子：

```
 import os
    base_directory = os.getcwd() 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2022-01-19T15:14:23.537

以下返回当前主脚本所在的路径。我用 Linux、Win10、IPython 和 Jupyter Lab 对此进行了测试。我需要一个也适用于本地 Jupyter 笔记本的解决方案。

```
import builtins
import os
import sys

def current_dir():
    if "get_ipython" in globals() or "get_ipython" in dir(builtins):
        # os.getcwd() is PROBABLY the dir that hosts the active notebook script.
        # See also https://github.com/ipython/ipython/issues/10123
        return os.getcwd()
    else:
        return os.path.abspath(os.path.dirname(sys.argv[0])) 
```

* * *

## 回答 #28

> 赞同：-2
> 
> 时间：2018-11-09T01:15:45.260

这些答案大部分是用 Python 2.x 或更早版本编写的。在 Python 3.x 中，打印函数的语法已更改为需要括号，即 print()。

所以，这个来自 Python 2.x 中 user13993 的早期高分答案：

```
import inspect, os
print inspect.getfile(inspect.currentframe()) # script filename (usually with path)
print os.path.dirname(os.path.abspath(inspect.getfile(inspect.currentframe()))) # script directory 
```

在 Python 3.x 中变为：

```
import inspect, os
print(inspect.getfile(inspect.currentframe())) # script filename (usually with path)
print(os.path.dirname(os.path.abspath(inspect.getfile(inspect.currentframe()))) ) # script directory 
```

* * *

## 回答 #29

> 赞同：-3
> 
> 时间：2013-01-20T20:52:13.340

如果你只想要没有文件名，`./`或者`.py`你可以试试这个

```
filename = testscript.py
file_name = __file__[2:-3] 
```

`file_name`将打印测试脚本，您可以通过更改 [] 内的索引来生成您想要的任何内容

* * *

## 回答 #30

> 赞同：-3
> 
> 时间：2013-01-24T02:43:09.633

```
import os

import wx

# return the full path of this file
print(os.getcwd())

icon = wx.Icon(os.getcwd() + '/img/image.png', wx.BITMAP_TYPE_PNG, 16, 16)

# put the icon on the frame
self.SetIcon(icon) 
```

# c# - 为旧版 WinForms MDI 应用程序设计新 UI

> ID：50518
> 
> 赞同：5
> 
> 时间：2008-09-08T19:53:18.520
> 
> 标签：c#, wpf, silverlight, user-interface

我正在努力将使用 C# 和 WinForms 创建的客户端/服务器应用程序转移到 SOA/WPF/Silverlight 世界中。最大的障碍之一是 UI 的设计。我当前的 UI 是 MDI 驱动的，用户严重依赖子窗口，同时打开许多子窗口并在它们之间来回切换。

在无 MDI 环境中重新创建 UI 功能的最佳方式可能是什么？（我不想在 WPF 中自己创建 MDI 功能）。标签？切换不同控件的列表面板？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T05:12:17.300

看看[37signals](http://www.37signals.com/)以及他们的 Web UI 有多好（主要是 HTML + AJAX）。这是一个很好的 web 应用程序的例子。要记住的一件事是确保您不会破坏网络范式。如果用户想并排看到两件东西，他们应该能够复制窗口并让 Web 浏览器进行窗口化。

对于 WPF，有很多新的可视化范例。您可以在各种控制工具包提供商的网站上找到一些示例：[Xceed](http://xceed.com/3DViews_WPF_Features.html)、[Telerik](http://www.telerik.com/products/wpf/overview.aspx)、[Infragistics](http://www.infragistics.com/dotnet/netadvantage/wpf.aspx)。他们有演示程序，用于帮助您在应用程序中组织屏幕的不同方式。

在 WPF 中开发复杂的复合应用程序时，您还可以从 Patterns and Practices [Prism](http://www.codeplex.com/CompositeWPF)站点开始。这是一组 InProgress 实践，用于在 WPF 中规划和开发复杂的复合（智能客户端样式）应用程序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-08T19:57:59.770

我认为答案实际上将取决于您的用户——我会设置一些具有多种范式的原型，并让他们提供一些输入。您要做的最后一件事是在没有任何最终用户输入的情况下引入新的 UI 范例。

选项卡现在非常流行，但不允许并排查看，因此如果需要，您可能希望使用更多 Outlook 风格的设置，以及可以激活、隐藏和调整大小的多个面板。

您可能想要做的一件事是将您的应用程序编码为复合 UI，其中每个视图都独立于其容器（无论是子窗口、选项卡或手风琴等）构建，并且只是“放入”设计师。当用户在未来改变他们对导航范式的想法时，这将保护你。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T20:22:11.447

多个顶级窗口易于实现并具有 MDI 的所有优点 - 这是 MS 为较新版本的 Office 选择的

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T20:13:11.967

你试过[GOA WinForms](http://www.netikatech.com/products/default.aspx)吗？

# java - 什么是正则表达式“独立非捕获组”？

> ID：50524
> 
> 赞同：63
> 
> 时间：2008-09-08T19:57:03.767
> 
> 标签：java, regex

来自 Java 6[模式](http://java.sun.com/javase/6/docs/api/java/util/regex/Pattern.html)文档：

> 特殊构造（非捕获）
> 
> `(?:`*X* `)`   *X*，作为非捕获组
> 
> …</p>
> 
> `(?>`*X* `)`   *X*，作为一个独立的非捕获组

之间`(?:X)`有`(?>X)`什么区别？**在这种情况下，独立**意味着什么？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-09-08T20:16:09.667

这意味着分组是[原子](http://www.regular-expressions.info/atomic.html)的，它会丢弃匹配组的回溯信息。所以，这个表达是所有格；即使这样做是整个正则表达式成功的唯一方法，它也不会退缩。它是“独立的”，因为它不通过回溯与正则表达式的其他元素合作以确保匹配。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2018-05-03T03:31:47.983

我认为[本教程](https://www.regular-expressions.info/atomic.html)解释了“独立、非捕获组”或“原子分组”到底是什么

正则表达式`a(bc|b)c`（捕获组）匹配**abcc**和**abc**。正则表达式`a(?>bc|b)c`（原子组）匹配**abcc**但不匹配**abc**。

当应用于**abc**时，两个正则表达式都将匹配`a`到**a**，匹配`bc`到**bc**，然后`c`在字符串的末尾将无法匹配。他们的道路在这里分道扬镳。带有***捕获组***的正则表达式已经记住了交替的回溯位置。该组将放弃其匹配，`b`然后匹配**b**并`c`匹配**c**。找到匹配！

***但是，带有atomic group***的正则表达式在`bc`匹配后从原子组中退出。此时，组内令牌的所有回溯位置都将被丢弃。`b`在此示例中，将放弃在字符串中的第二个位置尝试的替代选项。结果，当`c`失败时，正则表达式引擎没有可供尝试的替代方案。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-26T21:22:14.660

如果你有`foo(?>(co)*)co`，那将永远不会匹配。我确信有实际示例说明何时有用，请尝试 O'Reilly 的书。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2015-02-22T22:19:22.497

(?>X?) 等于 (?:X)?+, (?>X*) 等于 (?:X)*+, (?>X+) 等于 (?:X)++。

**编辑：** 上面的“语法”意味着： `(?>X?)`equals `(?:X)?+`，`(?>X*)`equals `(?:X)*+`，`(?>X+)`equals `(?:X)++`。

除去 X 必须是非捕获组的事实，前面的等价是：

`(?>X?)`等于`X?+`，`(?>X*)`等于`X*+`，`(?>X+)`等于`X++`。

# c - C：表达式求值中的隐式转换和整数溢出

> ID：50525
> 
> 赞同：2
> 
> 时间：2008-09-08T19:57:12.613
> 
> 标签：c

让我们拿代码

```
int a, b, c;
...
if ((a + b) > C) 
```

如果我们将 a 和 b 的值相加，并且总和超过了 int 的最大值，是否会损害比较的完整性？我在想可能有一个隐式的向上转换或溢出位检查，这将被考虑到这个表达式的评估中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-08T19:58:23.063

C不会做这样的事情。它会悄悄溢出并导致可能不正确的比较。您可以自己上调，但不会自动完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T00:51:23.780

测试确认 GCC 4.2.3 将简单地与溢出的结果进行比较：

```
#include <stdio.h>

int main()
{
    int a, b, c;

    a = 2000000000;
    b = 2000000000;
    c = 2100000000;

    printf("%d + %d = %d\n", a, b, a+b);
    if ((a + b) > c)
    {
        printf("%d + %d > %d\n", a, b, c);
    }
    else
    {
        printf("%d + %d < %d\n", a, b, c);
    }
    return 0;
} 
```

显示以下内容：

```
2000000000 + 2000000000 = -294967296
2000000000 + 2000000000 < 2100000000 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-08T19:58:58.333

我相信这可能是特定于平台的。查看有关如何处理溢出的 C 文档...

啊，是的，向上转型不会自动发生……

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T20:39:19.110

请参阅K&R 书中的第 2.7 节，*类型转换*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-14T10:54:50.330

如果向上转换没有获得任何位（不能保证 sizeof(long)>sizeof(int) 在 C 中），您可以使用类似下面的条件来比较和检查溢出 - 如果可以的话，向上转换几乎肯定会更快不过，使用它。

```
#if !defined(__GNUC__) || __GNUC__<2 || (__GNUC__==2 && __GNUC_MINOR__<96)
#   define unlikely(x) (x)
#else
#   define unlikely(x)     (__extension__ (__builtin_expect(!!(x), 0)))
#endif

/* ----------
 * Signed comparison (signed char, short, int, long, long long)
 * Checks for overflow off the top end of the range, in which case a+b must
 * be >c.  If it overflows off the bottom, a+b < everything in the range. */
if(a+b>c || unlikely(a>=0 && b>=0 && unlikely(a+b<0)))
    ...

/* ----------
 * Unsigned comparison (unsigned char, unsigned short, unsigned, etc.)
 * Checks to see if the sum wrapped around, since the sum of any two natural
 * numbers must be >= both numbers. */
if(a+b>c || unlikely(a+b<a))
    ...

/* ----------
 * To generate code for the above only when necessary: */
if(sizeof(long)>sizeof(int) ? ((long)a+b>c)
       : (a+b>c || unlikely(a>=0 && b>=0 && unlikely(a+b<0)))
    ... 
```

宏或内联函数的绝佳候选者。如果你愿意，你可以拉出“不太可能”，但它们可以帮助缩小和加速 GCC 生成的代码。

# .net - 字体大小独立的 UI：当我切换到 120 DPI 时一切都坏了？

> ID：50528
> 
> 赞同：11
> 
> 时间：2008-09-08T19:58:22.533
> 
> 标签：.net, wpf, winforms, user-interface, fonts

所以我正在阅读另一个问题中有人链接到的那些 Windows Vista UI 指南，他们提到你应该能够在切换到 120 DPI 后幸存下来。好吧，我在安装了我的应用程序的情况下启动了我方便的虚拟机，我们得到了什么……啊啊！！！大规模用户界面失败！

一切都乱七八糟：有些容器不够大，无法容纳它们的文字；一些“彼此相邻”定位的控件现在都挤在一起/分开了；有些按钮不够高；我的`ListView`专栏不够宽... eeek。

这听起来像是一种完全不同的方法。我之前的一个基本上是使用 VS2008 Windows 窗体设计器来创建，我猜是基于像素的布局。我可以看到，如果我坚持使用 Windows 窗体，`FlowLayoutPanel`s 会很有帮助，尽管我过去发现它们相当不灵活。它们也不能解决容器（例如表单本身）不够大的问题；大概有办法做到这一点？也许是那个`AutoSize`属性？

这也可能表明是时候跳槽到 WPF 了。我的印象是它是专门为这种事情设计的。

基本问题似乎归结为这些：

*   如果我要坚持使用 Windows 窗体，那么实现与字体大小无关的布局的所有技巧是什么，这种布局可以在用户设置大字体或将显示设置为 120 DPI 时存活下来？
*   WPF 在这方面是否具有显着优势，如果是，您能否尝试说服我值得转换？
*   在 .NET 堆栈中或一般情况下，是否存在与字体大小无关的布局的一般“最佳实践”？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-08T21:25:57.610

了解*Anchor*和*Dock*属性如何在您的控件上工作，留下任何可以自动调整大小的东西，并*尽可能*使用`TableLayoutPanel`。

如果你做到了这三件事，你将获得很多 Windows 窗体中的 WPF 设计经验。精心设计`TableLayoutPanel`的控件会尽最大努力调整控件的大小，以使它们适合表单。结合*AutoSize*控件、停靠和 Soeren Kuklau 提到的*AutoScaleMode*，您应该能够制作出可以很好缩放的东西。如果没有，您的表单上可能有太多控件；考虑将其拆分为标签页、浮动工具箱或其他一些空间。

在 WPF 中这要容易得多，因为自动调整大小控件的概念是内置的；在大多数情况下，如果您使用坐标对放置 WPF 元素，那么您做错了。尽管如此，您仍然无法改变这样一个事实，即在较低分辨率下，填充屏幕不需要太多 120 dpi 文本。有时问题不是你的布局，而是试图在一个小空间里放太多东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-08T20:00:53.743

> 如果我要坚持使用 Windows 窗体，那么实现与字体大小无关的布局的所有技巧是什么，这种布局可以在用户设置大字体或将显示设置为 120 DPI 时存活下来？

一方面，[AutoScaleMode](http://msdn.microsoft.com/en-us/library/system.windows.forms.autoscalemode.aspx)可能是您的朋友。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-08T20:34:36.003

通常，问题在于使用两个不同的“常量”进行表单布局，然后更改其中一个常量而不更改另一个常量。

您正在为表单实体使用像素，并使用点（基本上是英寸）来指定字体大小。像素和点由 DPI 关联，因此您更改了 DPI，突然您的像素固定值与您的点固定值不一致。

对此有一些包和类，但最终您必须选择一个单位或另一个单位，或者根据不断变化的常数缩放其中一个单位。

就个人而言，我会将表单上的实体更改为英寸。我不是 C# 人，所以我不知道这是否受本机支持，或者您是否必须在应用程序启动时执行一些动态表单大小调整。

如果您必须在您的软件中执行此操作，请继续正常调整所有内容（例如，调整为您通常的 96 DPI）。

当您的应用程序启动时，请在显示您的表单之前验证系统的 DPI 为 96。如果是，那就太好了。如果不是，则使用校正因子设置一个变量，并在显示表单之前对每个实体进行缩放和平移（修改位置和大小）。

但是，最终的方法是以英寸或磅为单位指定所有内容（一个点是 1/72 英寸）并让操作系统处理它。您可能必须处理极端情况（具有正确设置 DPI 的户外屏幕会以几个像素显示您的应用程序......）

# java - 如何在 Java 中格式化数字？

> ID：50532
> 
> 赞同：120
> 
> 时间：2008-09-08T19:59:45.180
> 
> 标签：java, number-formatting

如何在 Java 中格式化数字？
什么是“最佳实践”？

我需要在格式化之前对数字进行四舍五入吗？

> `32.302342342342343`=>`32.30`
> 
> `.7323`=>`0.73`

等等

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2008-09-08T20:04:03.673

从[这个线程](http://bytes.com/forum/thread16212.html)，有不同的方法可以做到这一点：

```
double r = 5.1234;
System.out.println(r); // r is 5.1234

int decimalPlaces = 2;
BigDecimal bd = new BigDecimal(r);

// setScale is immutable
bd = bd.setScale(decimalPlaces, BigDecimal.ROUND_HALF_UP);
r = bd.doubleValue();

System.out.println(r); // r is 5.12 
```

* * *

```
f = (float) (Math.round(n*100.0f)/100.0f); 
```

* * *

```
DecimalFormat df2 = new DecimalFormat( "#,###,###,##0.00" );
double dd = 100.2397;
double dd2dec = new Double(df2.format(dd)).doubleValue();

// The value of dd2dec will be 100.24 
```

[DecimalFormat()](http://docs.oracle.com/javase/7/docs/api/java/text/DecimalFormat.html)似乎是最动态的方式，在阅读其他代码时也很容易理解。

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2008-09-08T20:04:18.290

你和`String.format()`将是新的最好的朋友！

[https://docs.oracle.com/javase/1.5.0/docs/api/java/util/Formatter.html#syntax](https://docs.oracle.com/javase/1.5.0/docs/api/java/util/Formatter.html#syntax)

```
 String.format("%.2f", (double)value); 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-08T22:50:22.697

请注意，从 NumberFormat （以及大多数其他 Format 后代）派生的类是不同步的。创建格式对象并将它们存储在 util 类的静态变量中是一种常见（但危险）的做法。在实践中，它几乎总是可以工作，直到它开始承受很大的负载。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-08T20:09:09.480

整数，是的。这是[主要的示例来源](http://java.sun.com/docs/books/tutorial/i18n/format/decimalFormat.html#numberpattern)。

```
/*
 * Copyright (c) 1995 - 2008 Sun Microsystems, Inc.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 *   - Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *
 *   - Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 *
 *   - Neither the name of Sun Microsystems nor the names of its
 *     contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
 * IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */ 

import java.util.*;
import java.text.*;

public class DecimalFormatDemo {

    static public void customFormat(String pattern, double value ) {
        DecimalFormat myFormatter = new DecimalFormat(pattern);
        String output = myFormatter.format(value);
        System.out.println(value + "  " + pattern + "  " + output);
    }

    static public void localizedFormat(String pattern, double value,                                       Locale loc ) {
        NumberFormat nf = NumberFormat.getNumberInstance(loc);
        DecimalFormat df = (DecimalFormat)nf;
        df.applyPattern(pattern);
        String output = df.format(value);
        System.out.println(pattern + "  " + output + "  " + loc.toString());
    }

    static public void main(String[] args) {

        customFormat("###,###.###", 123456.789);
        customFormat("###.##", 123456.789);
        customFormat("000000.000", 123.78);
        customFormat("$###,###.###", 12345.67);
        customFormat("\u00a5###,###.###", 12345.67);

        Locale currentLocale = new Locale("en", "US");

        DecimalFormatSymbols unusualSymbols = new DecimalFormatSymbols(currentLocale);
        unusualSymbols.setDecimalSeparator('|');
        unusualSymbols.setGroupingSeparator('^');
        String strange = "#,##0.###";
        DecimalFormat weirdFormatter = new DecimalFormat(strange, unusualSymbols);
        weirdFormatter.setGroupingSize(4);
        String bizarre = weirdFormatter.format(12345.678);
        System.out.println(bizarre);

        Locale[] locales = {
            new Locale("en", "US"),
            new Locale("de", "DE"),
            new Locale("fr", "FR")
        };

        for (int i = 0; i < locales.length; i++) {
            localizedFormat("###,###.###", 123456.789, locales[i]);
        }
     }
 } 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2014-09-19T08:40:11.660

试试这个：

```
String.format("%.2f", 32.302342342342343); 
```

简单高效。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-08T20:05:35.337

使用[DecimalFormat](http://java.sun.com/javase/6/docs/api/java/text/DecimalFormat.html)。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-08T20:09:42.443

标准库中有两种方法。一种是使用java.text.DecimalFormat。基于 java.util.Formatter 的其他更神秘的方法（String.format、PrintStream.printf 等）应该让 C 程序员高兴（ish）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-03-14T10:06:28.227

正如罗伯特在他的回答中指出的那样：DecimalFormat 既不同步，API 也不保证线程安全（它可能取决于您使用的 JVM 版本/供应商）。

请改用 Spring 的[Numberformatter](http://docs.spring.io/spring/docs/3.0.x/api/org/springframework/format/number/NumberFormatter.html)，它是线程安全的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-08-26T18:54:04.397

```
public static void formatDouble(double myDouble){
 NumberFormat numberFormatter = new DecimalFormat("##.000");
 String result = numberFormatter.format(myDouble);
 System.out.println(result);
} 
```

例如，如果传递给 formatDouble() 方法的双精度值是 345.9372，则结果如下：345.937 同样，如果将值 .7697 传递给方法，则结果如下：.770

# c# - 多行 ddl 自定义控件

> ID：50539
> 
> 赞同：0
> 
> 时间：2008-09-08T20:02:26.093
> 
> 标签：c#, asp.net, custom-controls

与我一起工作的其中一个人需要一个自定义控件，它可以像多行 ddl 一样工作，因为据我们所知，这样的东西并不存在

在我们有几个想法 之前，有没有人有任何想法或创造过这样的东西，但它们涉及到大量的数据库使用

我们更喜欢它是免费的！！！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-08T20:32:05.867

看看[EasyListBox](http://www.easylistbox.com/home.aspx)。我在一个项目中使用过，虽然起初有点古怪，但完成了工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-08T20:49:34.267

我不确定您所说的多行是什么意思，但如果它在下拉列表中选择多个元素，请参阅此[演示](http://www.easylistbox.com/demoMultiDropdown.aspx)。

如果它的显示元素在下拉列表中包含多行，请参阅此[演示](http://www.easylistbox.com/demoCustomized.aspx)。您可以在 HTML 中添加一个中断来实现您可能正在寻找的内容。我以前以这种方式使用过这个控件，所以我可以确认它有效。

祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T05:15:08.933

我们在工作中使用自定义修改版的[吸盘鱼](http://www.google.com/search?q=suckerfish)。数据库性能对我们来说不是问题，因为我们缓存了控件。

该控件为 中的所有节点或从数据库中提取的特定页面集呈现嵌套`UL`/ s。然后我们使用[jQuery](http://jquery.com/)来完成所有很酷的 javascript 工作。因为它使用了这样的基本 HTML，所以一旦使用 CSS 设置样式，就很容易拥有多行或包裹的长项目。`LI``web.sitemap`

# c# - 不知道大小的情况下如何初始化二维数组

> ID：50558
> 
> 赞同：8
> 
> 时间：2008-09-08T20:09:45.623
> 
> 标签：c#, array-initialize

我有一个二维数组，我需要将数据加载到其中。我知道数据的宽度（22 个值）但我不知道高度（估计大约 4000 条记录，但可变）。

我将其声明如下：

```
float[,] _calibrationSet;
    ....
int calibrationRow = 0;
While (recordsToRead)
{
  for (int i = 0; i < SensorCount; i++)
   {
     _calibrationSet[calibrationRow, i] = calibrationArrayView.ReadFloat();
   }
   calibrationRow++;
} 
```

这会导致 NullReferenceException，所以当我尝试像这样初始化它时：

```
_calibrationSet = new float[,]; 
```

我得到一个“数组创建必须具有数组大小或数组初始值设定项”。

谢谢你，基思

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-08T20:23:58.133

你不能使用数组。或者更确切地说，您需要选择一个大小，如果您最终需要更多，那么您将不得不分配一个新的更大的数组，将数据从旧数组复制到新数组中，然后像以前一样继续（直到你超过了新的大小......）

通常，您会选择其中一个集合类 - ArrayList、List<>、LinkedList<> 等 - 哪一个很大程度上取决于您要查找的内容；List 将为您提供最接近我最初描述的内容，而 LinkedList<> 将避免频繁重新分配的问题（以较慢的访问和更大的内存使用为代价）。

例子：

```
List<float[]> _calibrationSet = new List<float[]>();

// ...

while (recordsToRead)
{
    float[] record = new float[SensorCount];
    for (int i = 0; i < SensorCount; i++)
    {
        record[i] = calibrationArrayView.ReadFloat();
    }
    _calibrationSet.Add(record);
}

// access later: _calibrationSet[record][sensor] 
```

哦，值得注意的是（正如[Grauenwolf](https://stackoverflow.com/questions/50558/how-do-you-initialize-a-2-dimensional-array-when-you-do-not-know-the-size#50591)所做的那样），我在这里所做的并没有为您提供与单个多维数组相同的内存结构 - 在引擎盖下，它是对其他数组的引用数组实际上保存数据。通过使重新分配更便宜，这可以大大加快构建阵列的速度，但会影响访问速度（当然还有内存使用）。这对您来说是否是一个问题在很大程度上取决于加载数据后您将如何处理数据......以及是否有 200 条记录或 200 万条记录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-08T20:24:20.677

您不能在 .NET 中创建一个数组（与声明对它的引用相反，这就是您在示例中所做的）而不通过在初始化时指定一组文字值来显式或隐式指定其维度. （例如 int[,] array4 = { { 1, 2 }, { 3, 4 }, { 5, 6 }, { 7, 8 } };）

您需要首先使用可变大小的数据结构（22 元素一维数组的通用列表将是最简单的），然后在读取完成后分配您的数组并将数据复制到其中并且您知道有多少行你需要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T20:27:45.753

我只会使用一个列表，然后将该列表转换为一个数组。

您会注意到这里我使用了锯齿状数组 (float[][]) 而不是方形数组 (float [,])。除了作为“标准”的做事方式之外，它应该更快。将数据从列表转换为数组时，您只需复制 [calibrationRow] 指针。使用方形数组，您必须复制 [calibrationRow] x [SensorCount] 浮点数。

```
 var tempCalibrationSet = new List<float[]>();
        const int SensorCount = 22;
        int calibrationRow = 0;

        while (recordsToRead())
        {
            tempCalibrationSet[calibrationRow] = new float[SensorCount];

            for (int i = 0; i < SensorCount; i++)
            {
                tempCalibrationSet[calibrationRow][i] = calibrationArrayView.ReadFloat();
            } calibrationRow++;
        }

        float[][] _calibrationSet = tempCalibrationSet.ToArray(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T20:25:19.363

我通常将更好的集合用于此类工作（List、ArrayList 等），然后（如果确实需要）在完成后转换为 T[,]。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T20:26:46.520

您要么需要将数组预分配为最大大小 (float[999,22])，要么使用不同的数据结构。

我想您可以即时复制/调整大小..（但我认为您不想这样做）

我认为清单听起来很合理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-08T20:28:34.347

您还可以使用二维 ArrayList（来自 System.Collections）——您创建一个 ArrayList，然后将另一个 ArrayList 放入其中。这将为您提供所需的动态调整大小，但会产生一些开销。

# java - 以编程方式确定哪个 Java 线程持有锁

> ID：50561
> 
> 赞同：44
> 
> 时间：2008-09-08T20:10:55.670
> 
> 标签：java, multithreading, concurrency

是否可以在运行时以编程方式检查持有给定对象锁的线程的名称？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-08T20:21:07.780

您只能判断当前线程是否持有普通锁（[`Thread.holdsLock(Object)`](http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#holdsLock%28java.lang.Object%29)）。如果没有本机代码，您将无法获得对具有锁的线程的引用。

但是，如果您正在做任何复杂的线程操作，您可能需要熟悉 java.util.concurrent 包。确实允许您获取它的[`ReentrantLock`](http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/locks/ReentrantLock.html)所有者（但它是一种受保护的方法，因此您必须扩展它）。根据您的应用程序，很可能通过使用并发包，您会发现根本不需要获取锁的所有者。

有一些非编程的方法可以找到锁的所有者，例如向 JVM 发出信号以向 stderr 发出线程转储，这对于确定死锁的原因很有用。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-09-04T07:40:11.667

您可以通过反射获得线程持有的锁。这仅适用于 java 1.6。

```
ThreadMXBean bean = ManagementFactory.getThreadMXBean();
ThreadInfo[] ti = bean.getThreadInfo(bean.getAllThreadIds(), true, true); 
```

在这些 ThreadInfo 对象中的每一个上都有 LockInfo 对象，您可以使用它们上的 identityHashCode 来与所讨论的锁进行比较。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-09T11:02:25.043

从 1.6 开始，您可以使用 JMX 做各种有趣的事情，包括查找持有的锁。您无法获得实际对象，但您确实获得了类和身份哈希值（这不是唯一的）。

（这篇文章最初有一个链接到我现在已经失效的博客中的一个例子。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-09T03:40:50.283

运行[jconsole](http://java.sun.com/developer/technicalArticles/J2SE/jconsole.html)。它包含在 Java SDK 中并从命令行运行。我不确定您使用的是什么操作系统，但在 Windows 上您可以将 java 进程的 PID 传递给它。它应该可以帮助您找到导致问题的线程。或者，您可以使用诸如 YourKit 之类的商业分析器或任何数量的其他分析器。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-09T11:13:36.840

在 1.5 中，您可以找到所有线程并获取每个线程的状态，例如：

```
 Map<Thread,StackTraceElement[]> map = Thread.getAllStackTraces();
    for (Map.Entry<Thread, StackTraceElement[]> threadEntry : map.entrySet()) {
        log.info("Thread:"+threadEntry.getKey().getName()+":"+threadEntry.getKey().getState());
        for (StackTraceElement element : threadEntry.getValue()) {
            log.info("--> "+element);
        }
    } 
```

Thread.getState 为您提供有关线程是否被阻塞、等待等的信息，请参阅[jdk api ThreadState](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.State.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-07-11T16:34:13.177

如果它是可**重入锁**，你可以检查它是否被当前线程持有

```
final ReentrantLock lock = new ReentrantLock();
lock.isHeldByCurrentThread(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-03-07T07:08:22.030

`wait()`您可以通过在该对象上调用或`notify()`方法来检查特定对象上的锁。如果对象没有持有锁，那么它会抛出`llegalMonitorStateException`.

2-通过调用`holdsLock(Object o)`方法。这将返回布尔值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-12-04T23:21:55.207

您可以在获取锁时使用变量来保存当前线程，然后在其他人尝试使用它时打印它。

```
Thread holderOfLock = null;
Object theLock = new Object();

public void doStuff()
{
    if(holderOfLock != null)
    {
       //get and print name of holderOfLock-thread or get stacktrace etc.
    }

    synchronized (theLock)
    {
        holderOfLock = Thread.currentThread();
        //do stuff...
        holderOfLock = null;
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-03-29T06:46:38.003

丑陋但有效。

```
String findLockOwner(ReentrantLock lock) {
    String patternStr = "\\[Locked by thread (\\S+)\\]";
    Pattern pattern = Pattern.compile(patternStr);
    Matcher matcher = pattern.matcher(lock.toString());
    boolean matchFound = matcher.find();
    if (matchFound && matcher.groupCount() >= 1) {
      return matcher.group(1);
    }
} 
```

# .net - 上下文菜单重置 ComboBox 的 SelectedIndex

> ID：50565
> 
> 赞同：1
> 
> 时间：2008-09-08T20:15:09.840
> 
> 标签：.net, winforms, combobox, contextmenu, selectedindex

我有一个 ContextMenu 在用户右键单击组合框后显示。`ShowDialog()`当用户在上下文菜单中选择一个项目时，会使用该方法调出一个表单。

```
If frmOptions.ShowDialog() = Windows.Forms.DialogResult.Cancel Then
    LoadComboBoxes()
End If 
```

当该表单关闭时，我会刷新父表单上 ComboBoxes 中的所有数据。但是，当发生这种情况时，打开 ContextMenu 的 ComboBox 将重置为具有 -1 的选定索引，但其他 ComboBoxes 的其他选定索引保持不变。

如何防止打开上下文菜单的 ComboBox 被重置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-08T20:27:30.137

处理此问题的一种方法是使用上下文菜单的 Popup 事件来获取启动菜单的组合框的选定索引。当对话框关闭时，重置选定的索引。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-08T20:48:39.417

我想到了。

我创建了一个通过引用传递**ContextMenu.SourceControl()**属性的方法，因此我可以操作调用 ContextMenu 的控件。在方法的开始，我得到了ComboBox 的**SelectedValue**并重新加载了 ComboBoxes 中的数据。然后我将**SelectedValue**设置为我在方法开始时获得的值。

感谢 DaveK 为我指明了正确的方向。

# python - Django 会话

> ID：50568
> 
> 赞同：38
> 
> 时间：2008-09-08T20:16:16.717
> 
> 标签：python, django, session, caching, mongodb

我正在查看 Django 中的会话，默认情况下它们存储在数据库中。文件系统和缓存会话有什么好处，我应该什么时候使用它们？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-08T20:58:29.207

如果您不打算将数据库用于系统的任何其他部分，文件系统后端才值得一看。如果您使用的是数据库，那么文件系统后端没有什么可推荐的。

memcache 后端比数据库后端快得多，但是您会冒着会话被清除和一些会话数据丢失的风险。

如果您是一个非常非常高流量的网站并且仔细编码以便您可以应对丢失会话，那么请使用 memcache。如果您不使用数据库，请使用文件系统缓存，但默认数据库后端几乎在所有情况下都是最好、最安全和最简单的选项。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-09T10:11:33.807

我不是 Django 专家，所以这个答案通常是关于会话存储的。如果我错了，请投反对票。

## 性能和可扩展性

会话存储的选择对性能和可伸缩性有影响。如果您有一个非常受欢迎的应用程序，这应该只是一个大问题。

数据库和文件系统会话存储（通常）都由磁盘支持，因此您可以廉价地拥有大量会话（因为磁盘很便宜），但请求通常必须等待数据被读取（因为磁盘很慢）。Memcached 会话使用 RAM，因此支持相同数量的并发会话将花费更多（因为 RAM 很昂贵），但可能更快（因为 RAM 很快）。

文件系统会话与您的应用程序运行所在的机器相关联，因此如果您的站点变得庞大，您将无法在多个应用程序服务器之间进行负载平衡。数据库和 memcached 会话让您有多个应用程序服务器与共享会话存储进行通信。

## 简单

会话存储的选择也会影响部署站点的难易程度。改变默认设置会花费一些复杂性。Memcached 和 RDBMS 都有自己的复杂性，但您的应用程序可能无论如何都将使用 RDBMS。

除非您有一个非常流行的应用程序，否则简单性应该是更大的关注点。

## 奖金

另一种方法是将会话[数据存储在 cookie 中](https://docs.djangoproject.com/en/1.8/topics/http/sessions/#using-cookie-based-sessions)（所有这些，而不仅仅是一个 ID）。这样做的好处是会话存储会随着用户数量自动扩展，但也有缺点。您（或您的框架）需要小心阻止用户伪造会话数据。您还需要使每个会话保持较小，因为整个内容将随每个请求一起发送。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-12-21T11:21:56.760

从 Django 1.1 开始，您可以使用 cached_db 会话后端。

这会将会话存储在缓存中（仅与 memcached 一起使用），并将其写回数据库。如果它已经从缓存中掉出来，它将从数据库中读取。

虽然这比使用 memcached 存储会话要慢，但它增加了会话的持久性。

有关更多信息，请参阅：[Django 文档：使用缓存会话](http://docs.djangoproject.com/en/dev/topics/http/sessions/#using-cached-sessions "使用缓存会话")

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-19T08:20:37.827

One thing that has to be considered when choosing session backend is "how often session data is modified"? Even sites with moderate traffic will suffer if session data is modified on each request, making many database trips to store and retrieve data.

In my previous work we used memcache as session backend exclusively and it worked really well. Our administrative team put really great effort in making two special memcached instances stable as a rock, but after bit of twiddling with initial setup, we did not have any interrupts of session backends operations.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-28T15:34:56.953

如果数据库的 DBA 不是您，则可能不允许您使用数据库支持的会话（这只是前端问题）。直到 django 支持轻松合并来自多个数据库的数据，以便您可以在单独的数据库中拥有特定于前端的内容，例如会话和用户消息（django.contrib.auth 中的消息也存储在数据库中），您需要保留记住这一点。

# windows - Windows XP 对远程 NDIS 的支持

> ID：50571
> 
> 赞同：1
> 
> 时间：2008-09-08T20:18:40.207
> 
> 标签：windows, embedded, usb, drivers, ndis

我正在考虑开发一种需要通过 USB 支持以太网的设备（托管在 Linux、XP 和 Vista 中）。据我了解，Vista 和 Linux 支持行业标准 USB CDC。然而，在经典的 Windows 风格中，XP 只支持它自己的 Remote NDIS。所以，现在我正在考虑只是鞠躬并通过 RNDIS 进行操作，而不是为 XP 滚动我自己的 CDC 驱动程序。

我一直在阅读一些较旧的文档，这些文档说即使 XP 在 NDIS 中也存在很多问题（惊喜！）。有人对 XP 的 RNDIS 驱动程序有经验吗？它们对产品开发安全吗？任何见解将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-08T23:14:46.287

我们在工作中使用 RNDIS。而且我发现它时不时地（大约每两个月）蓝屏我的机器。但是其他人（在我的工作中）没有发生这种情况，所以它可能只是我使用的特定设备。

我认为它足够稳定，可以开发，所以试一试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T08:25:10.027

这里的问题是 Linux 不支持主机模式下的 RNDIS，并且由于 MS RNDIS 许可证限制，您无法开发自定义驱动程序。由于同样的原因（许可），MAC 也不支持 RNDIS。

因此，如果您需要多平台解决方案，您需要一种标准方法，即 CDC/ECM。
市场上有许多可用的 CDC/ECM XP/VIsta 解决方案，你可以用谷歌搜索它们，我不想在这里宣传我们的解决方案 :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T23:32:23.843

经过我自己的研究和测试，单个 NDIS 设备运行良好。但是，如果您完全需要支持多个 NDIS 设备，那么您就不走运了。我的系统变得非常不稳定，基本上无法使用。这是非常可重复的。

我不会在任何类型的多设备场景中推荐 NDIS。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-04T09:03:27.560

如果您正在寻找商业解决方案，Jungo 确实提供适用于 Windows/Linux/Mac 的体面的 ECM 解决方案。唯一的问题是，如果您要购买大量产品，则必须向他们支付不小的版税。

# sql - 来自 CDR 的同时呼叫

> ID：50576
> 
> 赞同：1
> 
> 时间：2008-09-08T20:21:36.313
> 
> 标签：sql, language-agnostic, asterisk

当只有每个事件的开始时间和持续时间时，我需要对同时发生的事件进行分析。

**细节**

我有一个标准的 CDR 呼叫详细记录，其中包含：

*   calldate（每次通话开始的时间日期
*   持续时间（int，呼叫持续时间的秒数）
*   频道（一个字符串）

我需要想出的是在给定的时间段内每秒对同时呼叫进行某种分析。例如，我们昨天同时通话的图表。

（如果我们在网站上拥有具有持续时间的访问者日志并希望同时获得一组网页的客户，问题也是一样的）

你的算法是什么？

我可以遍历给定时间段内的记录，并填充一个数组，其中数组的每个存储桶对应于整个时间段内的 1 秒。这可行并且似乎很快，但如果时间段很长（比如..1 年），我需要大量内存（3600x24x365x4 字节~ 120MB aprox）。

这是一个基于网络的交互式应用程序，所以我的内存占用应该足够小。

**编辑**

同时，我的意思是在给定的一秒内的所有呼叫。其次是我的最小单位。我不能使用更大的东西（例如小时），因为一个小时内的所有电话不需要同时保持。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-08T20:40:09.997

我会在数据库上实现这个。使用带有 DATEPART 的 GROUP BY 子句，您可以获取您想要的任何时间段的同时调用列表，按秒、分钟、小时等。

在 Web 端，您只需显示查询返回的直方图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-04T17:18:16.203

You can create table `'simultaneous_calls'` with 3 fields:

```
yyyymmdd  Char(8),
day_second Number,  -- second of the day,
count          Number   -- count of simultaneous calls
```

Your web service can take 'count' value from this table and make some statistics.

Simultaneous_calls table will be filled by some batch program which will be started every day after end of the day.

Assuming that you use Oracle, the batch may start a PL/SQL procedure which does the following:

1.  Appends table with 24 * 3600 = 86400 records for each second of the day, with default 'count' value = 0.
2.  Defines the 'day_cdrs' cursor for the query:

```
 Select to_char(calldate, 'yyyymmdd')              yyyymmdd,
         (calldate - trunc(calldate)) * 24 * 3600   starting_second,
         duration                                              duration
From cdrs
Where cdrs.calldate >= Trunc(Sysdate -1)
    And cdrs.calldate 
```

 `3.  Iterates the cursor to increment 'count' field for the seconds of the call:` 

```
For cdr in day_cdrs
Loop 
   Update simultaneos_calls
   Set      count = count + 1
   Where yyyymmdd = cdr.yyyymmdd
       And day_second Between cdr.starting_second And cdr.starting_second + cdr.duration;
End Loop; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-10T02:22:15.143

@eric-z-beard：我真的很希望能够在数据库上实现这一点。我喜欢你的建议，虽然它似乎会导致一些事情，但我并不完全理解它。你能详细说明一下吗？请记住，每个呼叫将跨越几秒钟，并且每一秒都需要计数。如果使用 DATEPART（或 MySQL 上的类似功能），GROUP BY 应该使用几秒。见有关同步的注释。

详细说明了这一点，我找到了一种使用临时表来解决它的方法。假设 temp 保持从 tStart 到 tEnd 的所有秒数，我可以这样做

```
SELECT temp.second, count(call.id)
FROM call, temp
WHERE temp.second between (call.start and call.start + call.duration)
GROUP BY temp.second 
```

然后，如建议的那样，网络应用程序应将其用作直方图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T00:03:17.073

您可以将静态 Numbers 表用于许多类似这样的 SQL 技巧。Numbers 表只包含从 0 到 n 的整数，例如 10000。

然后你的临时表永远不需要创建，而是一个子查询，如：

```
SELECT StartTime + Numbers.Number AS Second
FROM Numbers 
```

# asp.net - __doPostBack 未在回发时呈现

> ID：50579
> 
> 赞同：3
> 
> 时间：2008-09-08T20:22:48.433
> 
> 标签：asp.net, javascript, postback

我有一个奇怪的问题。

我必须使用`GetPostBackEventRefence`强制回发，但它第一次工作，在第一次回发后，.NET 函数没有呈现......有什么想法吗？

这是回发后我所缺少的：

```
<script language="javascript" type="text/javascript">
<!--
function __doPostBack(eventTarget, eventArgument) {
    var theform;
    if (window.navigator.appName.toLowerCase().indexOf("microsoft") > -1) {
        theform = document.Main;
    }
    else {
        theform = document.forms["Main"];
    }
    theform.__EVENTTARGET.value = eventTarget.split("$").join(":");
    theform.__EVENTARGUMENT.value = eventArgument;
    theform.submit();
}
// -->
</script> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-08T20:57:21.267

好吧，按照这个想法，我创建了一个带有回发引用的虚拟函数，它可以工作......但它仍然很奇怪，因为它第一次正确渲染

```
this.Page.RegisterClientScriptBlock("DUMMY", "<script language='javascript'>function dummy() { " + this.Page.GetPostBackEventReference(this) + "; } </script>"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-08T20:28:16.750

我首先要看的是页面上是否显示了任何 asp 控件（例如链接按钮、组合框，它们通常不会生成提交但需要回发）。 **只有当 ASP 认为您的某个控件需要它时，__doPostback 函数才会被放入页面中。**

如果您不使用其中之一，您可以使用：

```
Page.ClientScript.GetPostBackClientHyperlink(controlName, "") 
```

将功能添加到您的页面

# javascript - 您如何通过 Shockwave 对象在 FF 中捕获鼠标事件

> ID：50585
> 
> 赞同：1
> 
> 时间：2008-09-08T20:25:30.517
> 
> 标签：javascript, firefox, shockwave

您如何通过 JavaScript 在 Firefox 中捕获鼠标事件、移动和单击 Shockwave Director 对象（不是 Flash）的顶部。该代码在 IE 中有效，但在 FF 中无效。

该脚本适用于 IE 和 Moz 的文档正文，但当鼠标悬停在嵌入的冲击波导向器对象上时，鼠标事件不会触发。

更新：

```
 function displaycoordIE(){
     window.status=event.clientX+" : " + event.clientY;
  }      
  function displaycoordNS(e){
     window.status=e.clientX+" : " + e.clientY;
  }
  function displaycoordMoz(e)
  {
      window.alert(e.clientX+" : " + e.clientY);
  }

  document.onmousemove = displaycoordIE;
  document.onmousemove = displaycoordNS;
  document.onclick = displaycoordMoz; 
```

* * *

顺便说一句，我也尝试过使用 addEventListener 来“mousemove”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-03T11:51:22.140

您还可以在 Director 中捕获鼠标事件（永远不会失败），然后使用 gotoNetPage "javascript:function('" & argument & "')" 从那里调用您的 JS 函数

ej:

```
on mouseDown me
   gotoNetPage "javascript:function('" & argument & "')"
end 
```

鼠标移动检测有点棘手，因为在 lingo 中没有这样的事件，但您可以使用：

```
property pMouseLock

on beginsprite
   pMouseLock = _mouse.mouseLock
end
on exitFrame 
   if _mouse.mouseLock <> pMouseLock then
      gotoNetPage "javascript:function('" & argument & "')"
      pMouseLock = _mouse.mouseLock
   end if
end 
```

问候

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-04T23:09:31.940

只是一个想法。

尝试用不透明度为 0 的 div 覆盖冲击波对象，然后您可以在 div 本身上捕获事件。

# c - C中的有符号到无符号转换 - 它总是安全的吗？

> ID：50605
> 
> 赞同：149
> 
> 时间：2008-09-08T20:36:45.107
> 
> 标签：c, type-conversion

假设我有以下 C 代码。

```
unsigned int u = 1234;
int i = -5678;

unsigned int result = u + i; 
```

`u`这里发生了哪些隐式转换，这段代码对于and的所有值是否安全`i`？（安全，即使这个例子中的*结果*会溢出到某个巨大的正数，我也可以将它转换回一个*int*并得到真正的结果。）

* * *

## 回答 #1

> 赞同：247
> 
> 时间：2008-09-08T20:44:26.790

**简答**

您`i`将通过添加*转换*为无符号整数`UINT_MAX + 1`，然后将使用无符号值进行加法，从而产生较大`result`的值（取决于 和 的值`u`）`i`。

**长答案**

根据 C99 标准：

> 6.3.1.8 常用算术转换
> 
> 1.  如果两个操作数具有相同的类型，则不需要进一步转换。
> 2.  否则，如果两个操作数都具有有符号整数类型或都具有无符号整数类型，则具有较小整数转换等级的类型的操作数将转换为具有较高等级的操作数的类型。
> 3.  否则，如果无符号整数类型的操作数的等级大于或等于另一个操作数类型的等级，则将有符号整数类型的操作数转换为无符号整数类型的操作数的类型。
> 4.  否则，如果有符号整数类型的操作数的类型可以表示无符号整数类型的操作数类型的所有值，则将无符号整数类型的操作数转换为有符号整数类型的操作数的类型。
> 5.  否则，两个操作数都转换为与带符号整数类型的操作数类型对应的无符号整数类型。

在您的情况下，我们有一个 unsigned int ( `u`) 和 signed int ( `i`)。参考上面的（3），由于两个操作数具有相同的等级，因此您`i`需要将其*转换*为无符号整数。

> 6.3.1.3 有符号和无符号整数
> 
> 1.  当整数类型的值转换为_Bool以外的其他整数类型时，如果该值可以用新类型表示，则保持不变。
> 2.  否则，如果新类型是无符号的，则通过在新类型中可以表示的最大值的基础上反复加减一，直到该值在新类型的范围内。
> 3.  否则，新类型是有符号的，值不能在其中表示；结果是实现定义的，或者引发了实现定义的信号。

现在我们需要参考上面的（2）。您`i`将通过添加 转换为无符号值`UINT_MAX + 1`。所以结果将取决于`UINT_MAX`你的实现是如何定义的。它会很大，但不会溢出，因为：

> 6.2.5 (9)
> 
> 涉及无符号操作数的计算永远不会溢出，因为无法由结果无符号整数类型表示的结果会以比结果类型可以表示的最大值大一的数字为模减少。

**奖励：算术转换半 WTF**

```
#include <stdio.h>

int main(void)
{
  unsigned int plus_one = 1;
  int minus_one = -1;

  if(plus_one < minus_one)
    printf("1 < -1");
  else
    printf("boring");

  return 0;
} 
```

您可以使用此链接在线尝试：[https ://repl.it/repls/QuickWhimsicalBytes](http://codepad.org/yPhYCMFO)

**奖励：算术转换副作用**

算术转换规则可用于`UINT_MAX`通过将无符号值初始化为来获取 的值`-1`，即：

```
unsigned int umax = -1; // umax set to UINT_MAX 
```

由于上述转换规则，无论系统的符号数表示如何，都可以保证可移植。有关更多信息，请参阅此 SO 问题：[使用 -1 将所有位设置为 true 是否安全？](https://stackoverflow.com/questions/809227/is-it-safe-to-use-1-to-set-all-bits-to-true)

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-05-07T03:29:24.740

从有符号到无符号的转换**不一定**只是复制或重新解释有符号值的表示。引用 C 标准（C99 6.3.1.3）：

> 当整数类型的值转换为_Bool以外的其他整数类型时，如果该值可以用新类型表示，则保持不变。
> 
> 否则，如果新类型是无符号的，则通过在新类型中可以表示的最大值的基础上反复加减一，直到该值在新类型的范围内。
> 
> 否则，新类型是有符号的，值不能在其中表示；结果是实现定义的，或者引发了实现定义的信号。

对于当今几乎普遍的二进制补码表示，规则确实对应于重新解释位。但是对于其他表示（符号和大小或一个的补码），C 实现仍然必须安排相同的结果，这意味着转换不能只复制位。例如，(unsigned)-1 == UINT_MAX，无论表示形式如何。

通常，C 中的转换被定义为对值进行操作，而不是对表示进行操作。

要回答原始问题：

```
unsigned int u = 1234;
int i = -5678;

unsigned int result = u + i; 
```

i 的值被转换为无符号整数，产生`UINT_MAX + 1 - 5678`. 然后将该值添加到无符号值 1234，产生`UINT_MAX + 1 - 4444`.

（与无符号溢出不同，有符号溢出会调用未定义的行为。环绕很常见，但 C 标准不保证 - 编译器优化可能会对做出无根据假设的代码造成严重破坏。）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-08T22:45:29.073

参考[The C Programming Language, Second Edition](https://rads.stackoverflow.com/amzn/click/com/0131103628) (ISBN 0131103628)，

*   您的加法操作会导致 int 转换为 unsigned int。
*   假设二进制补码表示和相同大小的类型，位模式不会改变。
*   从 unsigned int 到 signed int 的转换取决于实现。（但它可能会按照你现在在大多数平台上所期望的方式工作。）
*   在组合不同大小的有符号和无符号的情况下，规则会稍微复杂一些。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-08T20:51:00.893

当添加一个无符号和一个有符号变量（或任何二元运算）时，两者都被隐式转换为无符号，在这种情况下会导致巨大的结果。

因此，从某种意义上说，结果可能是巨大的和错误的，但它永远不会崩溃，这是安全的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-08T20:52:33.260

当从有符号转换为无符号时，有两种可能性。最初为正的数字保持（或被解释为）相同的值。最初为负数的数字现在将被解释为更大的正数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-08T21:08:12.193

如前所述，您可以毫无问题地在有符号和无符号之间来回转换。有符号整数的边界大小写为 -1 (0xFFFFFFFF)。尝试从中添加和减去，您会发现您可以回退并使其正确。

但是，如果您要来回转换，我强烈建议您命名变量，以便清楚它们是什么类型，例如：

```
int iValue, iResult;
unsigned int uValue, uResult; 
```

如果没有提示，很容易被更重要的问题分散注意力并忘记哪个变量是什么类型。您不想强制转换为无符号然后将其用作数组索引。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-02-07T12:08:14.000

> 这里发生了什么隐式转换，

i 将被转换为无符号整数。

> 这段代码对 u 和 i 的所有值都安全吗？

在定义明确的意义上是安全的（请参阅[https://stackoverflow.com/a/50632/5083516](https://stackoverflow.com/a/50632/5083516)）。

这些规则通常以难以阅读的标准语言编写，但基本上无论有符号整数中使用什么表示，无符号整数都将包含数字的 2 的补码表示。

加法，减法和乘法将在这些数字上正常工作，从而产生另一个无符号整数，其中包含表示“实际结果”的二进制补码数。

除法和转换为更大的无符号整数类型将具有明确定义的结果，但这些结果不会是“实际结果”的 2 的补码表示。

> （安全，即使这个例子中的结果会溢出到某个巨大的正数，我也可以将它转换回一个 int 并得到真正的结果。）

虽然从有符号到无符号的转换是由标准定义的，但反向是由实现定义的，gcc 和 msvc 都定义了转换，以便在将存储在无符号整数中的 2 的补数转换回有符号整数时获得“真实结果” . 我希望您只会在不使用 2 的补码作为有符号整数的晦涩系统上找到任何其他行为。

[https://gcc.gnu.org/onlinedocs/gcc/Integers-implementation.html#Integers-implementation](https://gcc.gnu.org/onlinedocs/gcc/Integers-implementation.html#Integers-implementation) [https://msdn.microsoft.com/en-us/library/0eex498h.aspx](https://msdn.microsoft.com/en-us/library/0eex498h.aspx)

* * *

## 回答 #8

> 赞同：-19
> 
> 时间：2010-07-08T11:03:32.587

**可怕的答案嘉豪**

*奥兹古尔·奥兹齐塔克*

> 当您从有符号转换为无符号（反之亦然）时，数字的内部表示不会改变。改变的是编译器如何解释符号位。

这是完全错误的。

*马茨·弗雷德里克森*

> 当添加一个无符号和一个有符号变量（或任何二元运算）时，两者都被隐式转换为无符号，在这种情况下会导致巨大的结果。

这也是错误的。如果由于无符号类型中的填充位而具有相同的精度，则无符号整数可以提升为整数。

*smh*

> 您的加法操作会导致 int 转换为 unsigned int。

错误的。也许是这样，也许不是。

> 从 unsigned int 到 signed int 的转换取决于实现。（但它可能会按照你现在在大多数平台上所期望的方式工作。）

错误的。如果它导致溢出或值被保留，则它要么是未定义的行为。

*匿名的*

> i 的值被转换为 unsigned int ...

错误的。取决于 int 相对于 unsigned int 的精度。

*泰勒价格*

> 如前所述，您可以毫无问题地在有符号和无符号之间来回转换。

错误的。尝试存储有符号整数范围之外的值会导致未定义的行为。

**现在我终于可以回答这个问题了。**

如果 int 的精度等于 unsigned int，则 u 将被提升为有符号 int，并且您将从表达式 (u+i) 中获得值 -4444。现在，如果 u 和 i 有其他值，您可能会得到溢出和未定义的行为，但是使用这些确切的数字，您将得到 -4444 **[1]**。该值将具有 int 类型。但是您正在尝试将该值存储到 unsigned int 中，然后将其转换为 unsigned int 并且结果最终将具有的值将是 (UINT_MAX+1) - 4444。

如果 unsigned int 的精度大于 int 的精度，则有符号的 int 将被提升为 unsigned int 产生的值 (UINT_MAX+1) - 5678 将添加到另一个 unsigned int 1234。如果你和我有使表达式超出范围 {0..UINT_MAX} 的其他值，将添加或减去值 (UINT_MAX+1)，直到结果确实落在范围 {0..UINT_MAX) 内并且不会发生未定义的行为.

**什么是精度？**

整数具有填充位、符号位和值位。无符号整数显然没有符号位。Unsigned char 进一步保证没有填充位。整数具有的值位数是它具有多少精度。

[陷阱]

如果存在填充位，则不能单独使用宏大小来确定整数的精度。并且字节的大小不必是 C99 定义的八位字节（八位）。

**[1]**溢出可能发生在两个点之一。在添加之前（在提升期间） - 当您有一个 unsigned int 太大而无法放入 int 时。即使 unsigned int 在 int 范围内，加法后也可能发生溢出，加法后结果仍可能溢出。

# wordpress - Wordpress 类别模板问题

> ID：50606
> 
> 赞同：0
> 
> 时间：2008-09-08T20:36:45.590
> 
> 标签：wordpress, templates

我正在考虑为一组类别使用自定义模板。是否可以在父类别上使用类别模板（如 category-4.php）并让孩子也使用该模板？

那么根据到目前为止的答案，有没有办法做到这一点？我想将文本和图像添加到父类别中的所有类别。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-08T20:48:06.110

从文档看来，如果不实际添加几个类别模板文件（除非您对其进行自定义编程），它似乎是不可能的。我运行 Wordpress，我只看到它按类别完成。

[http://codex.wordpress.org/Category_Templates](http://codex.wordpress.org/Category_Templates)

# .net - finally 块的意义是什么？

> ID：50618
> 
> 赞同：35
> 
> 时间：2008-09-08T20:41:49.307
> 
> 标签：.net, design-patterns, exception, try-catch-finally

除了语法，有什么区别

```
try {
}
catch() {
}
finally {
    x = 3;
} 
```

和

```
try {
}
catch() {
}

x = 3; 
```

编辑：在.NET 2.0 中？

* * *

所以

```
try {
    throw something maybe
    x = 3
}
catch (...) {
    x = 3
} 
```

在行为上是等价的吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-08T20:43:44.000

好吧，一方面，如果你在 try 块中返回，finally 仍然会运行，但 try-catch-finally 块下面列出的代码不会。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-09-08T20:43:21.817

取决于语言，因为可能存在一些细微的语义差异，但想法是它会（几乎）始终执行，即使 try 块中的代码抛出异常也是如此。

在第二个例子中，如果 catch 块中的代码返回或退出，x = 3 将不会被执行。首先它会。

在 .NET 平台中，在某些情况下，finally 块的执行不会发生：安全异常、线程暂停、计算机关闭 :) 等。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-08T20:42:54.220

在 Java 中：

finally 总是被调用，不管异常是否在 catch() 中被正确捕获，或者事实上你是否有一个 catch。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-08T21:04:01.720

try catch **finally**是非常重要的构造。可以肯定的是，即使抛出异常，finally块中的代码也会被执行。处理外部资源以释放它们非常重要。垃圾收集不会为您做到这一点。在 finally 部分中，您不应该有*return*语句或抛出异常。这样做是可能的，但这是一种不好的做法，可能会导致不可预知的结果。

如果你试试这个例子：

```
try {
  return 0;
} finally {
  return 2;
} 
```

结果将是 2:)

与其他语言的比较：[从最终返回](http://www.gettingclever.com/2008/07/return-from-finally.html)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-08T21:11:15.367

有几件事使 finally 块有用：

1.  如果您从 try 或 catch 块返回，finally 块仍会在控制权交还给调用函数之前执行
2.  如果 catch 块中发生异常，或者 try 块中发生未捕获类型的异常，finally 块中的代码仍会执行。

这些使 finally 块非常适合关闭文件句柄或套接字。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-08T20:44:17.180

在 try 和 catch 为空的情况下，没有区别。否则，您可以确定 finally 将被执行。

例如，如果你在你的 catchblock 中抛出一个新的异常（重新抛出），那么只有在 finally 块中的赋值才会被执行。

通常，finally 用于在您自己之后进行清理（关闭 DB-connections、File-Handles 等）。

你不应该在 finally 中使用控制语句（return、break、continue），因为这可能是维护的噩梦，因此被认为是不好的做法

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-08T20:46:31.217

即使抛出异常或到达 return 语句（尽管这可能取决于语言），也会始终调用 finally 块（实际上并非[总是...）。](http://thedailywtf.com/Articles/My-Tales.aspx)这是一种清理方法，你知道它总是会被调用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-08T21:10:33.887

finally 块允许您作为开发人员自行整理，无论 try{} 块中前面的代码的操作是否遇到错误，并且有其他人指出这一点，主要属于释放资源的范畴 - 关闭指针/套接字/结果集，将连接返回到池等。

@mats 非常正确，总是存在“硬”故障的可能性 - finally 块不应包含关键任务代码，这应始终在 try{} 内以事务方式完成

再次@mats - 真正的美妙之处在于它允许您从自己的方法中抛出异常，并且仍然保证您整理：

```
try
{
StreamReader stream = new StreamReader("foo.bar");
mySendSomethingToStream(stream);
}
catch(noSomethingToSendException e) {
    //Swallow this    
    logger.error(e.getMessage());
}
catch(anotherTypeOfException e) {
    //More serious, throw this one back
    throw(e);
}
finally
{
stream.close();
} 
```

因此，我们可以捕获许多类型的异常，以不同的方式处理它们（第一个允许执行 try{} 之外的任何内容，第二个有效地返回），但总是干净整洁。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-09T16:05:45.703

@iAn 和 @mats：

作为一项规则，我不会在 finally {} 中“拆除”任何在 try {} 中“设置”的内容。最好将流创建拉到 try {} 之外。如果您需要在流创建上处理异常，则可以在更大范围内完成。

```
StreamReader stream = new StreamReader("foo.bar");  
try {
    mySendSomethingToStream(stream);
}
catch(noSomethingToSendException e) {
    //Swallow this    
    logger.error(e.getMessage());
}
catch(anotherTypeOfException e) {
    //More serious, throw this one back
    throw(e);
}
finally {
    stream.close();  
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-09-30T13:51:06.203

这不是回答，而是批评。这个问题很*老*，但这一直困扰着我。我在这里找到它是有原因的。我已经阅读了每个答案，在我看来，没有人真正考虑过。

我真的认为 没有什么好处`finally`，这可能就是为什么它直到“最近”才出现在编程语言中。大多数说明的示例`stream.close()`都可能导致空引用异常，因此您仍然需要测试它是否为空。

是的，如果你从内部返回`try{}`，`finally`仍然运行。但这是好的做法吗？好像是脑力体操，还不如带`goto`回来。为什么不等待，然后在阻塞后返回？所做`finally {}`的只是在代码中添加两三行。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-08T20:42:32.097

因此，您可以清理在 try 块中初始化的任何打开的连接等。如果您打开一个连接，然后发生异常，则该异常将不会被正确关闭。这种类型的场景就是 finally 块的用途。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-08T20:44:04.903

finally 块应该执行，无论您是否捕获了异常。参见[Try / Catch / finally 示例](http://neptune.netcomp.monash.edu.au/JavaHelp/howto/try_catch_finally.htm#whyFinally)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-08T20:51:16.697

[@Ed](https://stackoverflow.com/questions/50618/what-is-the-point-of-the-finally-block#50624)，您可能正在考虑像`catch(...)`在 C++ 中捕获未指定异常的东西。

但是`finally`无论`catch`块中发生什么，代码都会被执行。

[Microsoft 在C# 的 try-finally](http://msdn.microsoft.com/en-us/library/zwc8s4fz.aspx)上有一个帮助页面

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-08T20:57:43.373

finally 块与 try/catch 处于同一范围内，因此您将可以访问其中定义的所有变量。

假设您有一个文件处理程序，这就是它的编写方式的不同之处。

```
try
{
   StreamReader stream = new StreamReader("foo.bar");
   stream.write("foo");
}
catch(Exception e) { } // ignore for now
finally
{
   stream.close();
} 
```

相比

```
StreamReader stream = null;
try
{
    stream = new StreamReader("foo.bar");
    stream.write("foo");
} catch(Exception e) {} // ignore

if (stream != null)
    stream.close(); 
```

请记住，虽然 finally 里面的任何东西都不能保证运行。想象一下，您收到中止信号、窗口崩溃或断电。最终依赖于业务关键代码是不好的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-08T20:59:45.567

即使发生未处理的异常，finally 中的任何代码也会运行。通常，finally 代码用于使用 .dispose() 清理非托管代码的本地声明。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-27T23:49:04.560

在 Java 中，无论您是使用“返回”、只是运行 try 块还是捕获了异常，您都可以将它用于您想要执行的任何事情。

例如，关闭数据库会话或 JMS 连接，或释放某些操作系统资源。

我猜它在.NET中是相似的？

# php - PHP中的全局/会话范围值

> ID：50652
> 
> 赞同：0
> 
> 时间：2008-09-08T20:52:08.127
> 
> 标签：php, memcached, session-state, apc

在 PHP 中是否有处理全局范围变量的标准方法？会话范围？

根据我所做的研究，看起来这些选项主要是附加组件或外部的。APC 可能会工作，但仅限于单个 PHP 实例，对于服务器场不是那么有用。*Memcached*似乎可以工作，但我希望在 PHP 中找到一些东西。

它的无状态方法是否使其不再是处理此问题的标准方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T00:40:09.907

持久层是使用 php 的唯一方法。基于文件的解决方案或数据库。

php 本身不提供任何机制来执行应用程序范围变量。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-08T20:55:55.530

您可以使用[$_SESSION](http://www.php.net/manual/en/reserved.variables.session.php)执行会话变量。

# c# - 加密 WCF 连接的其他方法

> ID：50684
> 
> 赞同：2
> 
> 时间：2008-09-08T21:03:47.493
> 
> 标签：c#, wcf, security

我目前正在开发一个需要在 WCF 主机之间传递加密数据的项目。据我了解，只有两种方法可以确保通过 WCF 传递的数据是安全的。

1.  使用证书
2.  使用域（或在网络上的每台机器上使用相同的用户名和密码）

使用证书可能很昂贵且管理起来很复杂，因为我们不能保证在每次部署时都有一台服务器类机器，所以域也是不可能的。如果需要更改密码，让每台机器使用相同的用户名和密码也是有问题的。

目前我们使用 OpenSSH 在主机之间建立隧道连接。框架中是否还有另一个我不知道的选项？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T23:57:09.660

加密需要密钥。密钥通常作为证书实现。如果您拥有通信的双方，则可以免费创建自己的证书，而无需从受信任的根授权处购买证书。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-13T14:00:06.130

这是一个[替代方案](http://www.codeproject.com/Articles/166044/WCF-Client-Server-Application-with-Custom-Authenti)。无需 IIS 和 SSL/X509 证书即可工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T21:46:11.123

最便宜的方法可能是运行您自己的证书颁发机构。这意味着您可以完全控制证书，但您不必为外部认证付费。如果你适当地自动化这个，你可以给你网络上的每台机器一个加密身份，并使用你的本地认证将所有东西联系在一起。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T21:07:40.900

如果您使用的是 http 端点，则可以使用诸如 https 之类的安全传输。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T21:10:59.660

对放置在 WCF 容器中的数据使用传统加密。可能类似于以下内容：

[http://www.obviex.com/samples/EncryptionWithSalt.aspx](http://www.obviex.com/samples/EncryptionWithSalt.aspx)

# c# - linq - 您如何查询一个查询源中不在另一个查询源中的项目？

> ID：50702
> 
> 赞同：4
> 
> 时间：2008-09-08T21:10:49.923
> 
> 标签：c#, .net, linq, .net-3.5

如果我有 2 个查询源，我如何找到一个不在另一个的查询源？

连接以在两者中查找项目的示例：

```
var results = from item1 in qs1.Items
   join item2 in qs2 on item1.field1 equals item2.field2
   select item1; 
```

那么 linq 代码将返回 qs1 中不在 qs2 中的项目是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-08T21:21:00.507

来自[马可·鲁索](http://programminglinq.com/blogs/marcorusso/archive/2008/01/14/the-not-in-clause-in-linq-to-sql.aspx)

```
NorthwindDataContext dc = new NorthwindDataContext();
dc.Log = Console.Out;
var query =
    from c in dc.Customers
    where !(from o in dc.Orders
            select o.CustomerID)
           .Contains(c.CustomerID)
    select c;
foreach (var c in query) Console.WriteLine( c ); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-08T21:23:03.483

使用 except 扩展方法。

```
var items1 = new List<string> { "Apple","Orange","Banana" };
var items2 = new List<string> { "Grapes","Apple","Kiwi" };

var excluded = items1.Except(items2); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-05T05:25:46.113

达伦·科普的[回答](https://stackoverflow.com/questions/50702/linq-how-do-you-do-a-query-for-items-in-one-query-source-that-are-not-in-anothe/50724#50724)：

```
var excluded = items1.Except(items2); 
```

从性能的角度来看是最好的解决方案。

*（注意：这对于至少常规 LINQ 来说是正确的，也许 LINQ to SQL 会根据[Marco Russo 的博客文章](http://programminglinq.com/blogs/marcorusso/archive/2008/01/14/the-not-in-clause-in-linq-to-sql.aspx)改变事情。但是，我想在“最坏的情况下” Darren Kopp 的方法至少会返回 Russo 方法的速度，甚至在 LINQ to SQL 环境中）。*

作为一个简单的例子，在[LINQPad](http://www.linqpad.net/)中试试这个：

```
void Main()
{
   Random rand = new Random();
   int n = 100000;
   var randomSeq = Enumerable.Repeat(0, n).Select(i => rand.Next());
   var randomFilter = Enumerable.Repeat(0, n).Select(i => rand.Next());

   /* Method 1: Bramha Ghosh's/Marco Russo's method */
   (from el1 in randomSeq where !(from el2 in randomFilter select el2).Contains(el1) select el1).Dump("Result");

   /* Method 2: Darren Kopp's method */
   randomSeq.Except(randomFilter).Dump("Result");
} 
```

尝试一次注释掉这两种方法中的一种，并尝试不同 n 值的性能。

我的经验（在我的 Core 2 Duo 笔记本电脑上）似乎表明：

```
n = 100\. Method 1 takes about 0.05 seconds, Method 2 takes about 0.05 seconds
n = 1,000\. Method 1 takes about 0.6 seconds, Method 2 takes about 0.4 seconds
n = 10,000\. Method 1 takes about 2.5 seconds, Method 2 takes about 0.425 seconds
n = 100,000\. Method 1 takes about 20 seconds, Method 2 takes about 0.45 seconds
n = 1,000,000\. Method 1 takes about 3 minutes 25 seconds, Method 2 takes about 1.3 seconds 
```

*方法 2（Darren Kopp 的回答）显然更快。*

对于较大的 n，方法 2 的速度下降很可能是由于创建了随机数据（请随意放入 DateTime 差异来确认这一点），而方法 1 显然存在算法复杂性问题（只需查看即可看到）对于第一个集合中的每个数字，它至少是 O(N^2)，它与整个第二个集合进行比较）。

**结论：**使用 Darren Kopp 对 LINQ 的“除外”方法的回答

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T21:34:20.850

另一种完全不同的看待它的方式是将 lambda 表达式（用于填充第二个集合的条件）作为谓词传递给第一个集合。

我知道这不是问题的确切答案。我认为其他用户已经给出了正确的答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T21:25:21.590

这是同一件事的更简单版本，您不需要嵌套查询：

```
List<string> items1 = new List<string>();
items1.Add("cake");
items1.Add("cookie");
items1.Add("pizza");

List<string> items2 = new List<string>();
items2.Add("pasta");
items2.Add("pizza");

var results = from item in items1
          where items2.Contains(item)
          select item;

foreach (var item in results)
    Console.WriteLine(item); //Prints 'pizza' 
```

# c# - 格式化日志的好方法是什么？

> ID：50704
> 
> 赞同：4
> 
> 时间：2008-09-08T21:11:10.203
> 
> 标签：c#, parsing, logging

我正在设计一个应用程序，其中需要记录我从 Telnet 连接收到的所有传入消息。尽管可以包含提供文本颜色和格式（16 种颜色、粗体、下划线等）的 ANSI 标记，但文本基本上很简单。

我想格式化我的日志以存储带有格式、日期/时间和可能的其他元数据的文本。我的第一个想法是所有 XML，但这可能会影响我以后编写快速搜索工具的能力。我目前的想法是一个文件中的日期/时间+文本，元数据存储在另一个 XML 文件中，由行号引用。

这是一个好的解决方案吗？另外，我应该在哪里以及如何存储格式化命令？原始的 ANSI 标签会破坏普通标签，但将它们放在两个不同的文件中可能会很尴尬。

附加：感谢到目前为止的一些答案，尽管我应该提到大多数时候消息将是人与人之间的通信，而不是系统消息。一种更原始​​的 IRC。稍后由我的用户决定（通过添加元数据）哪些消息是重要的。这是过滤或编辑的日志可能源自记录日志的原始数据。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-08T21:57:26.100

我的第一个建议是使用 log4net 之类的插入式日志记录工具，这将使格式化更加自动化。

如果您打算使用两个文件的路线（我同意 Craig 的观点，数据库可能是更好的选择），您可以通过拥有一个尽可能稀疏的文件来为自己省去很多心痛。后来的快速搜索和一个将所有信息保存在一个地方（元数据和数据）而不是创建仅元数据格式的搜索。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T21:19:09.310

天，

一定要登录平面文件并添加 munge 脚本以稍后将其转换为 XMl。

第一个建议是确保所有日期/时间字符串都采用 ISO 8601 格式，即 YYYY-MM-DD hh:mm:ss。

其次是使您的类别，例如异常、致命、错误、警告、信息等在您的日志中真正脱颖而出。

然后看看一些 vim 语法文件并为您的日志格式创建一个新语法，以便让重要的日志条目真正脱颖而出。

获取标准语法文件之一并对其进行修改以处理您的日志字符串并不难。

HTH。

干杯，

抢

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-08T21:16:28.490

如果您正在捕获日志信息以供将来搜索和分析，那么数据库可能是一个更好的答案。

至于你的解决方案。平面文件根本不能很好地扩展，而数据库的扩展性要好得多。我也不会拆分文件，这只会加剧可伸缩性问题。如果您必须使用平面文件，我可能会尝试将元数据保存在 csv 中（开销较小），并将数据保存在 csv 文件索引的一系列文件中。这样所有数据都不会影响您的索引文件。只是我的想法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T22:05:40.807

我将“分道扬镳”并说将数据库用于所有分析/归档日志条目（例如您的 Telnet 通信）。这将为您提供全文搜索、列以及搜索数据的简便方法的好处。

对任何调试/严重错误类型日志使用平面文件（或 XML 格式，因为文件不应太大）。

如果您的数据库连接断开，或者您的表结构有些古怪，那么登录到数据库将毫无意义。

想一想，如果您正在寻找一个稍微“轻量级”的解决方案，您可以使用 SQLite 记录您的所有 telnet 流量，以便您可以利用 DB 结构的优势，同时也可以使用文件。

再次向 log4net 点头，您可以使用他们拥有的 ADO appender 轻松完成此任务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T22:17:05.960

我不确定您到底要完成什么。Telnet 通常被认为是一个字符一次的协议，所以当您说“传入消息”时，您的意思是每个字符都是一条消息吗？还是整个用户的会话都是一条消息？

我会做一些假设。您有用户通过 telnet 登录，并且您希望捕获他们在登录时所做的一切。稍后，您希望能够将他们所做的事情与该用户以及他们所做的时间和日期相关联。稍后您需要能够搜索以找出“谁以 root 身份执行了 'rm *'？”

我会将每个用户的会话存储为一个单独的文件，其命名约定包括用户的登录名和时间戳。

例如 2008_09_08_14_52_07_nidonocu

在文件中，我将捕获接收到的每个字节，假设它们主要是纯文本字符。

例如

```
ls
cd www
ls
vi index.html
/copyright 2007
llllllllllllr8:wq
exit 
```

将 8 位 ANSI 字符也写入文件。您应该能够使用文本编辑器和 grep 进行基本审核和搜索。如果您需要实际读取 8 位数据，您可以使用二进制文件查看器或稍后变得更复杂。

备份、归档、清除等都可以使用常规文件系统工具和脚本来完成。

如果我的假设是错误的，我很抱歉。

——
布鲁斯

# graphics - 游戏程序员的RSS提要？

> ID：50723
> 
> 赞同：1
> 
> 时间：2008-09-08T21:22:57.273
> 
> 标签：graphics, rss, artificial-intelligence, feed

我正在浏览[这个帖子](https://stackoverflow.com/questions/5119/what-are-the-best-rss-feeds-for-programmersdevelopers)，它有很好的推荐，但对我来说有点太笼统了。

因此，如果有人收集了不错的游戏编程提要，请分享。:)

（欢迎一般主题和特定主题）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-08T21:25:08.547

我在大学时经常使用[http://www.gamedev.net/](http://www.gamedev.net/)，尤其是[NeHe 教程](http://nehe.gamedev.net/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T21:25:57.673

**AIGameDev.com：http://feeds.aigamedev.com/AiGameDev** [_](http://feeds.aigamedev.com/AiGameDev)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T21:37:45.850

这是我用过的两个

[DirectX 论坛提要](http://www.programmersheaven.com/mb/dxgameprog/rss.aspx?AllPosts=1 "DirectX 游戏编程")和[有趣资源摘要](http://feeds.feedburner.com/TheGeeksOf3d "有趣的游戏资源的好总结")

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T21:40:02.380

GameDevKicks.com 可能会随着时间的推移变得有趣 - 如果使用更多： [http ://www.gamedevkicks.com/](http://www.gamedevkicks.com/)

# svn - 我可以让 TortoiseSVN 自动添加文件吗？

> ID：50737
> 
> 赞同：12
> 
> 时间：2008-09-08T21:29:38.850
> 
> 标签：svn, tortoisesvn

有没有办法让 TortoiseSVN（或任何其他工具）自动将我在目录中创建的任何新 .cs 文件添加到我的工作副本中，这样我就不必记住我在一天结束时创建了哪些文件？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-08T21:32:36.907

如果您只是提交您的工作副本，您将获得一个文件列表，其中显示您的未版本控制文件，您可以在提交时勾选添加。您不必在提交之前明确添加它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-08T22:16:26.867

我可能会制作一个批处理文件，如下所示（未经测试）：

```
dir /b /S *.cs > allcsfiles.txt
svn add --targets allcsfiles.txt 
```

我相信 svn 不会介意您尝试添加已经版本化的文件..

无论如何，这可能就像你很容易得到的那样自动。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-19T00:13:28.153

```
svn add --force --auto-props [Path to check in] 
```

对我来说工作正常。

-喷射

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T21:54:06.530

是的，您可以将 bat 文件添加到 svn（在已安装的服务器上），这样每当您更新特定分支时，该更改就会被模仿......我相信它被称为钩子......

我希望这就是你的意思。

# .net - 等到文件在 .NET 中解锁

> ID：50744
> 
> 赞同：112
> 
> 时间：2008-09-08T21:33:09.620
> 
> 标签：.net, .net-3.5, file

在文件被解锁并且可以读取和重命名之前阻塞线程的最简单方法是什么？例如，.NET Framework 中的某处是否有 WaitOnFile()？

我有一项服务，它使用 FileSystemWatcher 来查找要传输到 FTP 站点的文件，但*文件创建*事件在其他进程完成写入文件之前触发。

理想的解决方案将有一个超时时间，因此线程在放弃之前不会永远挂起。

编辑：在尝试了以下一些解决方案后，我最终更改了*系统*，以便所有文件都写入`Path.GetTempFileName()`，然后执行`File.Move()`到最终位置。一旦`FileSystemWatcher`事件触发，文件就已经完成了。

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2010-09-09T15:19:00.653

从 Eric 的回答开始，我进行了一些改进，以使代码更加紧凑和可重用。希望它有用。

```
FileStream WaitForFile (string fullPath, FileMode mode, FileAccess access, FileShare share)
{
    for (int numTries = 0; numTries < 10; numTries++) {
        FileStream fs = null;
        try {
            fs = new FileStream (fullPath, mode, access, share);
            return fs;
        }
        catch (IOException) {
            if (fs != null) {
                fs.Dispose ();
            }
            Thread.Sleep (50);
        }
    }

    return null;
} 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-09-08T21:59:11.790

这是我在一个[相关问题](https://stackoverflow.com/questions/41290/file-access-strategy-in-a-multi-threaded-environment-web-app#41559)上给出的答案：

```
 /// <summary>
    /// Blocks until the file is not locked any more.
    /// </summary>
    /// <param name="fullPath"></param>
    bool WaitForFile(string fullPath)
    {
        int numTries = 0;
        while (true)
        {
            ++numTries;
            try
            {
                // Attempt to open the file exclusively.
                using (FileStream fs = new FileStream(fullPath,
                    FileMode.Open, FileAccess.ReadWrite, 
                    FileShare.None, 100))
                {
                    fs.ReadByte();

                    // If we got this far the file is ready
                    break;
                }
            }
            catch (Exception ex)
            {
                Log.LogWarning(
                   "WaitForFile {0} failed to get an exclusive lock: {1}", 
                    fullPath, ex.ToString());

                if (numTries > 10)
                {
                    Log.LogWarning(
                        "WaitForFile {0} giving up after 10 tries", 
                        fullPath);
                    return false;
                }

                // Wait for the lock to be released
                System.Threading.Thread.Sleep(500);
            }
        }

        Log.LogTrace("WaitForFile {0} returning true after {1} tries",
            fullPath, numTries);
        return true;
    } 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2011-03-26T10:12:45.600

这是执行此操作的通用代码，独立于文件操作本身。这是有关如何使用它的示例：

```
WrapSharingViolations(() => File.Delete(myFile)); 
```

或者

```
WrapSharingViolations(() => File.Copy(mySourceFile, myDestFile)); 
```

您还可以定义重试次数和重试之间的等待时间。

注意：不幸的是，底层的 Win32 错误 (ERROR_SHARING_VIOLATION) 没有在 .NET 中公开，所以我添加了一个`IsSharingViolation`基于反射机制的小 hack 函数 () 来检查这一点。

```
 /// <summary>
    /// Wraps sharing violations that could occur on a file IO operation.
    /// </summary>
    /// <param name="action">The action to execute. May not be null.</param>
    public static void WrapSharingViolations(WrapSharingViolationsCallback action)
    {
        WrapSharingViolations(action, null, 10, 100);
    }

    /// <summary>
    /// Wraps sharing violations that could occur on a file IO operation.
    /// </summary>
    /// <param name="action">The action to execute. May not be null.</param>
    /// <param name="exceptionsCallback">The exceptions callback. May be null.</param>
    /// <param name="retryCount">The retry count.</param>
    /// <param name="waitTime">The wait time in milliseconds.</param>
    public static void WrapSharingViolations(WrapSharingViolationsCallback action, WrapSharingViolationsExceptionsCallback exceptionsCallback, int retryCount, int waitTime)
    {
        if (action == null)
            throw new ArgumentNullException("action");

        for (int i = 0; i < retryCount; i++)
        {
            try
            {
                action();
                return;
            }
            catch (IOException ioe)
            {
                if ((IsSharingViolation(ioe)) && (i < (retryCount - 1)))
                {
                    bool wait = true;
                    if (exceptionsCallback != null)
                    {
                        wait = exceptionsCallback(ioe, i, retryCount, waitTime);
                    }
                    if (wait)
                    {
                        System.Threading.Thread.Sleep(waitTime);
                    }
                }
                else
                {
                    throw;
                }
            }
        }
    }

    /// <summary>
    /// Defines a sharing violation wrapper delegate.
    /// </summary>
    public delegate void WrapSharingViolationsCallback();

    /// <summary>
    /// Defines a sharing violation wrapper delegate for handling exception.
    /// </summary>
    public delegate bool WrapSharingViolationsExceptionsCallback(IOException ioe, int retry, int retryCount, int waitTime);

    /// <summary>
    /// Determines whether the specified exception is a sharing violation exception.
    /// </summary>
    /// <param name="exception">The exception. May not be null.</param>
    /// <returns>
    ///     <c>true</c> if the specified exception is a sharing violation exception; otherwise, <c>false</c>.
    /// </returns>
    public static bool IsSharingViolation(IOException exception)
    {
        if (exception == null)
            throw new ArgumentNullException("exception");

        int hr = GetHResult(exception, 0);
        return (hr == -2147024864); // 0x80070020 ERROR_SHARING_VIOLATION

    }

    /// <summary>
    /// Gets the HRESULT of the specified exception.
    /// </summary>
    /// <param name="exception">The exception to test. May not be null.</param>
    /// <param name="defaultValue">The default value in case of an error.</param>
    /// <returns>The HRESULT value.</returns>
    public static int GetHResult(IOException exception, int defaultValue)
    {
        if (exception == null)
            throw new ArgumentNullException("exception");

        try
        {
            const string name = "HResult";
            PropertyInfo pi = exception.GetType().GetProperty(name, BindingFlags.NonPublic | BindingFlags.Instance); // CLR2
            if (pi == null)
            {
                pi = exception.GetType().GetProperty(name, BindingFlags.Public | BindingFlags.Instance); // CLR4
            }
            if (pi != null)
                return (int)pi.GetValue(exception, null);
        }
        catch
        {
        }
        return defaultValue;
    } 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-08-07T22:40:56.717

我为这些事情拼凑了一个助手类。如果您可以控制将访问该文件的所有内容，它将起作用。如果您期望来自一堆其他事物的争用，那么这是毫无价值的。

```
using System;
using System.IO;
using System.Threading;

/// <summary>
/// This is a wrapper aroung a FileStream.  While it is not a Stream itself, it can be cast to
/// one (keep in mind that this might throw an exception).
/// </summary>
public class SafeFileStream: IDisposable
{
    #region Private Members
    private Mutex m_mutex;
    private Stream m_stream;
    private string m_path;
    private FileMode m_fileMode;
    private FileAccess m_fileAccess;
    private FileShare m_fileShare;
    #endregion//Private Members

    #region Constructors
    public SafeFileStream(string path, FileMode mode, FileAccess access, FileShare share)
    {
        m_mutex = new Mutex(false, String.Format("Global\\{0}", path.Replace('\\', '/')));
        m_path = path;
        m_fileMode = mode;
        m_fileAccess = access;
        m_fileShare = share;
    }
    #endregion//Constructors

    #region Properties
    public Stream UnderlyingStream
    {
        get
        {
            if (!IsOpen)
                throw new InvalidOperationException("The underlying stream does not exist - try opening this stream.");
            return m_stream;
        }
    }

    public bool IsOpen
    {
        get { return m_stream != null; }
    }
    #endregion//Properties

    #region Functions
    /// <summary>
    /// Opens the stream when it is not locked.  If the file is locked, then
    /// </summary>
    public void Open()
    {
        if (m_stream != null)
            throw new InvalidOperationException(SafeFileResources.FileOpenExceptionMessage);
        m_mutex.WaitOne();
        m_stream = File.Open(m_path, m_fileMode, m_fileAccess, m_fileShare);
    }

    public bool TryOpen(TimeSpan span)
    {
        if (m_stream != null)
            throw new InvalidOperationException(SafeFileResources.FileOpenExceptionMessage);
        if (m_mutex.WaitOne(span))
        {
            m_stream = File.Open(m_path, m_fileMode, m_fileAccess, m_fileShare);
            return true;
        }
        else
            return false;
    }

    public void Close()
    {
        if (m_stream != null)
        {
            m_stream.Close();
            m_stream = null;
            m_mutex.ReleaseMutex();
        }
    }

    public void Dispose()
    {
        Close();
        GC.SuppressFinalize(this);
    }

    public static explicit operator Stream(SafeFileStream sfs)
    {
        return sfs.UnderlyingStream;
    }
    #endregion//Functions
} 
```

它使用命名互斥体工作。那些希望访问文件的人试图获得对命名互斥体的控制权，该互斥体共享文件名（'\' 变成了'/'）。您可以使用 Open()，它会停止直到互斥锁可访问，或者您可以使用 TryOpen(TimeSpan)，它尝试在给定的持续时间内获取互斥锁，如果在时间跨度内无法获取，则返回 false。这很可能在 using 块中使用，以确保正确释放锁，并且在释放该对象时正确释放流（如果打开）。

我用大约 20 件事做了一个快速测试，对文件进行各种读/写，没有发现损坏。显然它不是很先进，但它应该适用于大多数简单的情况。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-09T00:20:33.183

对于这个特定的应用程序，直接观察文件将不可避免地导致难以追踪的错误，尤其是当文件大小增加时。以下是两种可行的不同策略。

*   Ftp 两个文件，但只看一个。例如发送文件important.txt 和important.finish。只注意完成文件，但处理 txt。
*   FTP 一个文件，但完成后重命名。例如发送 important.wait 并让发件人在完成后将其重命名为 important.txt。

祝你好运！

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-08T21:37:55.727

我以前使用的一种技术是编写自己的函数。基本上捕获异常并使用可以在指定持续时间内触发的计时器重试。如果有更好的方法，请分享。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-08T21:48:11.973

来自[MSDN](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.created.aspx)：

> 创建文件后立即引发 OnCreated 事件。如果正在将文件复制或传输到监视目录，则将立即引发 OnCreated 事件，然后引发一个或多个 OnChanged 事件。

您的 FileSystemWatcher 可以进行修改，以便它不会在“OnCreated”事件期间进行读取/重命名，而是：

1.  生成一个轮询文件状态的线程，直到它未被锁定（使用 FileInfo 对象）
2.  一旦确定文件不再锁定并准备就绪，就立即回调服务以处理文件

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-09T00:11:30.147

在大多数情况下，像@harpo 建议的简单方法会起作用。您可以使用这种方法开发更复杂的代码：

*   使用 SystemHandleInformation\SystemProcessInformation 查找所选文件的所有打开句柄
*   子类 WaitHandle 类以访问它的内部句柄
*   将发现的句柄包裹在子类 WaitHandle 中传递给 WaitHandle.WaitAny 方法

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-07-08T15:10:18.290

在文件传输完成后创建的传输过程触发文件 SameNameASTrasferedFile.trg 的广告。

然后设置仅在 *.trg 文件上触发事件的 FileSystemWatcher。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-08T21:42:27.290

我不知道您使用什么来确定文件的锁定状态，但是应该这样做。

```
而（真）
{
    尝试 {
        流 = File.Open（文件名，文件模式）；
        休息;
    }
    捕捉（文件IOException）{

        // 检查是否是锁问题

        线程.睡眠（100）；
    }
}

```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-03-14T09:40:15.297

一个可能的解决方案是将文件系统观察器与一些轮询相结合，

为文件的每个更改获取通知，并在收到通知时检查它是否如当前接受的答案中所述被锁定：[https](https://stackoverflow.com/a/50800/6754146) ://stackoverflow.com/a/50800/6754146 打开文件流的代码是从答案中复制的并稍作修改：

```
public static void CheckFileLock(string directory, string filename, Func<Task> callBack)
{
    var watcher = new FileSystemWatcher(directory, filename);
    FileSystemEventHandler check = 
        async (sender, eArgs) =>
    {
        string fullPath = Path.Combine(directory, filename);
        try
        {
            // Attempt to open the file exclusively.
            using (FileStream fs = new FileStream(fullPath,
                    FileMode.Open, FileAccess.ReadWrite,
                    FileShare.None, 100))
            {
                fs.ReadByte();
                watcher.EnableRaisingEvents = false;
                // If we got this far the file is ready
            }
            watcher.Dispose();
            await callBack();
        }
        catch (IOException) { }
    };
    watcher.NotifyFilter = NotifyFilters.LastWrite;
    watcher.IncludeSubdirectories = false;
    watcher.EnableRaisingEvents = true;
    //Attach the checking to the changed method, 
    //on every change it gets checked once
    watcher.Changed += check;
    //Initially do a check for the case it is already released
    check(null, null);
} 
```

通过这种方式，您可以检查文件是否被锁定并在通过指定回调关闭时收到通知，这样您就可以避免过度激进的轮询，并且仅在可能实际关闭时才执行工作

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-05-06T19:21:25.217

这是与上述类似的答案，除了我添加了一个检查以查看文件是否存在。

```
bool WaitForFile(string fullPath)
        {
            int numTries = 0;
            while (true)
            {
                //need to add this line to prevent infinite loop
                if (!File.Exists(fullPath))
                {
                    _logger.LogInformation("WaitForFile {0} returning true - file does not exist", fullPath);
                    break;
                }
                ++numTries;
                try
                {
                    // Attempt to open the file exclusively.
                    using (FileStream fs = new FileStream(fullPath,
                        FileMode.Open, FileAccess.ReadWrite,
                        FileShare.None, 100))
                    {
                        fs.ReadByte();

                        // If we got this far the file is ready
                        break;
                    }
                }
                catch (Exception ex)
                {
                    _logger.LogInformation(
                       "WaitForFile {0} failed to get an exclusive lock: {1}",
                        fullPath, ex.ToString());

                    if (numTries > 10)
                    {
                        _logger.LogInformation(
                            "WaitForFile {0} giving up after 10 tries",
                            fullPath);
                        return false;
                    }

                    // Wait for the lock to be released
                    System.Threading.Thread.Sleep(500);
                }
            }

            _logger.LogInformation("WaitForFile {0} returning true after {1} tries",
                fullPath, numTries);
            return true;
        } 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-08T23:14:58.567

我的做法和 Gulzar 一样，只是不断尝试循环。

事实上，我什至不关心文件系统观察程序。每分钟轮询一次网络驱动器以获取新文件很便宜。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2013-01-22T20:51:29.733

只需将**Changed**事件与 NotifyFilter **NotifyFilters.LastWrite**一起使用：

```
var watcher = new FileSystemWatcher {
      Path = @"c:\temp\test",
      Filter = "*.xml",
      NotifyFilter = NotifyFilters.LastWrite
};
watcher.Changed += watcher_Changed; 
watcher.EnableRaisingEvents = true; 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2014-03-04T16:58:04.827

添加 Outlook 附件时，我遇到了类似的问题。“使用”拯救了这一天。

```
string fileName = MessagingBLL.BuildPropertyAttachmentFileName(currProp);

                //create a temporary file to send as the attachment
                string pathString = Path.Combine(Path.GetTempPath(), fileName);

                //dirty trick to make sure locks are released on the file.
                using (System.IO.File.Create(pathString)) { }

                mailItem.Subject = MessagingBLL.PropertyAttachmentSubject;
                mailItem.Attachments.Add(pathString, Outlook.OlAttachmentType.olByValue, Type.Missing, Type.Missing); 
```

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2009-07-23T12:56:35.410

作为一个选项怎么样：

```
private void WaitOnFile(string fileName)
{
    FileInfo fileInfo = new FileInfo(fileName);
    for (long size = -1; size != fileInfo.Length; fileInfo.Refresh())
    {
        size = fileInfo.Length;
        System.Threading.Thread.Sleep(1000);
    }
} 
```

当然，如果文件大小是在创建时预先分配的，您会得到误报。

# visual-studio - Visual Studio 2008“随机”挂起测试运行

> ID：50746
> 
> 赞同：17
> 
> 时间：2008-09-08T21:34:10.057
> 
> 标签：visual-studio, visual-studio-2008

我们正在使用带有自动化测试套件的 VS 2008 Team System，并且在运行测试时，测试主机“随机”锁定。我实际上必须终止 VSTestHost 进程并重新运行测试以使某些事情发生，否则所有测试都处于“待定”状态。

有没有人遇到过类似的行为并知道解决方法？我们这里有 3 名开发人员遇到相同的行为。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-20T14:45:04.667

这可能与导致单元测试挂起的模糊错误有关，除非计算机名称为大写。疯了，我知道 - 但我遇到了这个问题，修复对我有用。

有关此问题的[MS](http://social.msdn.microsoft.com/Forums/en-US/vststest/thread/fd6f2128-e248-4336-b8be-1eb5480e3de8/) Connect
[解决方法的](https://connect.microsoft.com/VisualStudio/feedback/Workaround.aspx?FeedbackID=403799)[错误报告](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=403799)MS Connect
[TFS 博客文章](http://teamfoundation.blogspot.com/2008/12/case-of-never-ending-unit-tests.html)如何编辑注册表以更改您的计算机名称

最简单的方法是调整注册表。您需要编辑两个键：

```
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\ComputerName\ActiveComputerName
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\ComputerName\ComputerName 
```

将两个键中的值 ComputerName 更改为大写，然后重新启动。然后测试神奇地起作用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T01:54:03.410

I would try running the tests from the command line using [MSTest.exe](http://msdn.microsoft.com/en-us/library/ms182486(VS.80).aspx). This might help isolate the problem to Visual Studio, and at least give you some method of running the tests successfully.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-09T01:10:12.423

当您说锁定时，您的意思是 VS 实际上已挂起，还是测试没有运行？

追踪正在发生的事情的最简单方法是查看挂起进程的转储。如果您使用的是 Vista，只需右键单击该进程并选择创建内存转储。如果您使用的是 Windows XP，并且没有安装[适用于 Windows 的调试工具](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx)，则可以使用 ntsd.exe 获取内存转储。您将需要进程 ID，您可以通过将 PID 列添加到“进程”选项卡显示来从任务管理器中获取该 ID。

完成后，运行以下命令：

```
ntsd -p <PID>
.dump C:\mydump.dmp 
```

然后，您可以使用[WinDBG 和 SOS](http://blogs.msdn.com/johan/archive/2007/11/13/getting-started-with-windbg-part-i.aspx)检查该转储，或者如果您可以将转储发布到某个地方，我很乐意查看它。

在任何情况下，您都可能希望每隔一分钟左右进行两次转储。这样，如果您执行 !runaway 之类的操作，您可以查看哪些线程正在工作，这将帮助您找出它挂起的原因。

另一个问题 - 你在 VS2008 SP1 上吗？

# asp.net - Response.StatusCode 和 Internet Explorer - 显示自定义消息？

> ID：50747
> 
> 赞同：1
> 
> 时间：2008-09-08T21:34:16.310
> 
> 标签：asp.net, http, internet-explorer-7

我正在我的 Application_Error 处理程序中实现 HttpRequestValidationException，如果可能，我想显示一条自定义消息。

现在，我正在考虑 StatusCode。在我当前的示例中，它发送 200，我认为不应该这样做。我想改为发送（恕我直言）更合适的 400 Bad Request。但是，与此同时，我想使用 Response.Write 输入自定义消息。Firefox 正确显示它，但 IE7 给了我默认无用的 Internet Explorer 错误页面。

一方面，我猜 Internet Explorer 只是假设所有 <> 200 的内容都没有任何“好”的内容，而[RFC 在这里并不是很清楚](https://www.rfc-editor.org/rfc/rfc2616#section-10.4.1)。

所以我只是想知道，是否为由 HttpRequestValidationException 良好做法引起的错误页面发送 HTTP 200？有没有好的选择？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-08T22:05:02.570

HTTP 200 响应代码不表示错误。它表明一切正常。您不应该使用 200 响应代码来表示错误。

如果响应小于 512 字节，Internet Explorer 将显示其“友好错误”页面。这里有更多关于这个问题：[http](http://weblogs.asp.net/scottgu/archive/2006/04/09/442332.aspx) ://weblogs.asp.net/scottgu/archive/2006/04/09/442332.aspx ，

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T21:49:22.873

不，这当然不是一个好习惯。2XX 状态码意味着（除其他外）**请求是有效**的。这与引发 HttpRequestValidationException 正好相反。

遗憾的是，我不知道如何使 IE 行为正确。比发送 200 稍微好一点的方法是将其重定向到错误页面，但仍远非完美。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T21:59:49.930

当响应为 4xx 或 5xx 时，Internet Explorer 会显示他们所谓的“友好 HTTP 错误消息”。用户可以在 IE 的 Tools.Options.Advanced[Browsing] 对话框中关闭此选项。

为错误页面发送 200 通常是不好的做法。一种替代方法是拥有一个*应该*显示错误消息的有效“错误”页面（所以 200 就可以了），然后使用 3xx 重定向到该页面。

# windows - 在 Windows 上确定磁盘几何形状

> ID：50762
> 
> 赞同：5
> 
> 时间：2008-09-08T21:41:57.820
> 
> 标签：windows, winapi, hard-drive

我需要从 Windows XP 中以编程方式确定物理磁盘上有多少扇区、磁头和柱面。有谁知道用于确定这一点的 API？Windows 可能会在哪里公开此信息？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-08T22:12:22.787

将[DeviceIoControl](http://msdn.microsoft.com/en-us/library/aa363216%28VS.85%29.aspx)与控制代码[IOCTL_DISK_GET_DRIVE_GEOMETRY](http://msdn.microsoft.com/en-us/library/aa365169%28VS.85%29.aspx)或[IOCTL_DISK_GET_DRIVE_GEOMETRY_EX 一起](http://msdn.microsoft.com/en-us/library/aa365171%28VS.85%29.aspx)使用。

MSDN 中有示例代码可以在[此处](http://msdn.microsoft.com/en-us/library/aa363147%28VS.85%29.aspx)执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T21:54:48.057

您可以将控制代码传递给[DeviceIoControl](http://msdn.microsoft.com/en-us/library/aa365171(VS.85).aspx)以获取物理磁盘几何结构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-12T19:01:38.070

WMI 在这方面也很擅长，我使用它取得了巨大的成功。

```
using( ManagementClass driveClass = new ManagementClass( "Win32_DiskDrive" ) )
{
    using( ManagementObjectCollection physicalDrives = driveClass.GetInstances( ) )
    {
        foreach( ManagementObject drive in physicalDrives )
        {
            string cylinders = ( string )drive["TotalCylinders"];
            // ... etc ...
            drive.Dispose( );
        }
    }
} 
```

有关您可以使用的其他驱动器属性的列表，请查看[此页面](http://msdn.microsoft.com/en-us/library/aa394132(VS.85).aspx)

# security - 使 OpenID 成为主流需要什么？

> ID：50769
> 
> 赞同：16
> 
> 时间：2008-09-08T21:44:45.617
> 
> 标签：security, user-interface, openid

OpenID 原则上是一个好主意，但是 UI 和关于它为什么好的解释目前还不是为一般用途量身定制的——您认为 OpenID 需要怎样才能为公众服务？这可以通过技术解决，还是问题本质上如此困难，以至于我们陷入了难以解释/多步骤注册程序、众多帐户或安全性差的困境？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-09T00:01:30.060

它需要更简单：涉及更少的概念知识，并且需要更少的步骤 - 最好是零。当这项技术在很少或没有帮助的情况下工作时，它就会起飞。

OpenID 凭证、提供者和供应商的机制不应该暴露给用户。人们谈论教育广大互联网用户，但这永远不会发生 - 群众永远不会停止愚蠢。如果你想吸引大众，你需要降低技术以达到他们的水平。当 Google 附属网站发现您已登录 Google 并默默地使用该帐户时，它就可以正常工作，而您无需告诉它您是谁。相比之下，OpenID 如此笨拙的事实是为什么像谷歌这样的大供应商仍在回避它，以及为什么公众不会采用它。

我认为 OpenID 的开发人员在使用 URL 而不是电子邮件地址作为 ID 时搞砸了。人们知道什么是电子邮件地址，他们已经拥有一个与他们相关联的地址（或者可以轻松获得一个），并且像谷歌和微软这样的电子邮件提供商很乐意扮演门户的角色。事实上，从电子邮件地址到 URL 的自动翻译就足够了：

> myname@example.com -> [http://www.example.com/openid/myname](http://www.example.com/openid/myname)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-08T21:48:06.247

我认为这将需要数百万人使用的网站的大量购买。例如，[MySpace 即将支持 OpenID](http://developer.myspace.com/Community/blogs/devteam/archive/2008/07/24/openid-coming-to-a-myspace-profile-near-you.aspx)，所以现在 OpenID 支持的用户数量猛增。如果网络上更多的高活动站点遵循此引导，您就去吧！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-08T23:44:44.657

它将采用所有支持它的流行网站，并使其对用户透明。

“您可以在这里创建一个用户帐户，或者如果您使用 MySpace、Google Mail、Hotmail 等，那么您可以使用 OpenID 登录。”

不要将其作为新服务出售，而是将其出售为能够使用与其他站点不同的 ID 登录。

然而，问题在于每个人都支持它，每个用户现在都将拥有一个 myspace id、google id 等。现在，如果他们使用 myspace id 登录到 stackoverflow，然后再使用 google，他们可能会感到困惑，stackoverflow 无法识别它们.

我想知道 openid 是否有链接 openid 帐户的解决方案，因此它们是相同的 - 我怀疑技术是否允许这样做，因为它们本质上是独立的签名机构。谷歌必须与 Myspace 共享数据，反之亦然，才能实现这一点……

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-08T23:52:02.703

ISP 应该向所有模仿其电子邮件地址的客户提供 openId。也许 openID 需要支持将 foo@example.com 自动转换为[http://openid.example.com/foo](http://openid.example.com/foo)以便 ISP 可以轻松地在单独的服务器上进行设置。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-08T23:03:38.280

我认为它不会成为主流。我认为 Ted Dziuba 说得对，他说它解决了一个大多数人认为不值得解决的“问题”。

[http://teddziuba.com/2008/09/openid-is-why-i-hate-the-inter.html](http://teddziuba.com/2008/09/openid-is-why-i-hate-the-inter.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-08T23:28:46.160

它必须变得简单得多，ID 更容易记住。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-08T21:50:28.253

你的意思是现在还没有？;)

显然，许多当前流行的应用程序都需要提供它，并表明它是一个很好的选择。

如果谷歌和 Facebook 将其作为一个显而易见的选择，那将有所帮助。

最终，用户教育将真正发挥作用。我怀疑大多数人会在意……愚蠢的羊。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-08T21:59:33.597

到目前为止，许多回应似乎归结为两种选择：

1.  用户教育，以及
2.  强制采用（许多网站从内部身份验证更改为 openid。）

这就是我们所能做的吗？让普通用户轻松进行 openid 委托的分布式工具怎么样？（比如说，与 OS X / Windows / Ubuntu 集成的东西）是否存在使这不可行的技术障碍？

如果客户端（和供应商发布的）应用程序可以让您管理您的在线安全偏好，那么我们可能能够应对与向随机站点提供密码相关的*一些*风险——因为“登录区域”将是一些本地程序位于您的系统托盘中，或者不是。当然，Web 应用程序与桌面的集成（例如 Chrome 提供的）在实践中可能无法进行这种区分，因此这可能是一个有争议的问题。

无论如何，看起来我们*现在*应该做些什么来让 openid 更受公众欢迎，并加快采用速度，同时让系统更加用户友好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-08T23:35:19.843

作为主要使用 Java 编写 Web 应用程序的人，我不能/不会使用 OpenID，因为没有库支持。 [JOID](http://code.google.com/p/joid/)和[openid4java](http://code.google.com/p/openid4java/)是我所知道的仅有的两个。JOID 显然没有得到积极维护，不包括几个月来一直在邮件列表中的真正重要的补丁；并且 openid4java 需要 >40 MB 的外部依赖项，包括一些需要进入认可的类路径的依赖项，正如[一位用户评论](http://code.google.com/p/openid4java/wiki/Installation)的那样，这很荒谬：

> 2008 年 4 月 28 日，witichis 发表评论
> 
> 46MB 下载，用于简单的重定向和解密/加密 - 你喝醉了吗？

在我看来，OpenID 还不错。它整合了登录凭据。它确实解决了一个实际问题，虽然它可能不是最佳解决方案 我能看到的唯一两个问题是，您必须信任身份提供者不允许其他人声称是您，以及依赖方（您登录的网站in to) 可以串通将您在多个站点上的身份链接在一起。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-11T09:18:18.130

我个人认为它根本不需要成为主流，这是一个有趣的想法，但它不再相关。

当我创建一个正常登录时，我输入我的用户名、主密码并单击 SuperGenPass 小书签。就是这样，当我必须注册 stackoverflow 时，我必须找到一个 openId 提供商，在那里注册（这需要永远）登录我的网站并设置委托，然后将 stackoverflow 添加到我的网站列表中。

昨天我无法登录，因为我已经从我的虚拟主机中删除了该文件，并且他们遇到了一些安全问题。

结论：不要使用openid。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-17T23:39:46.357

选择供应商需要简单得多。

目前没有办法知道它们中的任何一个有多可靠、值得信赖或安全，或者在 6 个月后仍然存在。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-08T21:48:46.137

我认为我们需要看到更多面向消费者的网站作为登录方法提供 OpenID。有很多大型消费者网站可以用作 OpenID 提供者，但我记得在 Stackoverflow 之前看到 OpenID 可作为登录名的唯一地方是在 Blogger 上发表评论。成为提供者固然很棒，但消费者几乎看不到它。另一方面，查看使用 OpenID 的实际位置可能会引起更多兴趣。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-08T21:51:00.343

如果更多的 OpenID 消费者也是 OpenID 提供者，那肯定会有所帮助。作为一名开发人员，我很乐意通过一些曲折来弄清楚我可以在 openid.org 上创建一个新 ID，但更主流的消费者很容易被这个过程推迟。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-08T21:58:06.333

大网站接受 OpenID 的事实本身并不足以使其成为主流。到目前为止，我看到的最接近的是 LiveJournal 既接受又提供 OpenID 身份验证（我相信它已经做了很长一段时间了）。

但我认为仅仅接受 OpenID 是不够的。我们真正需要的是更多这样的网站，拒绝建立自己的认证系统，并*要求*OpenID 认证。如果“下一件大事”说您必须使用您的 OpenID 登录（通过一个非常简单的向导与其他人设置新 ID），我相信它会开始正常滚动。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-08T23:42:24.083

如果我可以在每个站点上执行它并稍后根据我自己的时间和条件聚合身份，我会使用它。事实上，即使是找到一个像样的 OpenID 提供商也是一件非常痛苦的事情。体面的意思是stackoverflow.com不是一个，所以我不会打扰。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-08T23:48:24.303

浏览器应该自动填充 OpenID 登录框，这样您就不必记住您的 ID。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-08T23:50:03.287

Web 框架应将其作为默认设置，除非您花费大量额外时间来配置简单的用户名/密码组合。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-09T00:11:26.090

使用 OpenID 的站点需要将其放在登录页面的前面和中心。我见过许多网站[将其](http://disqus.com/login/)隐藏在标准登录/注册页面下的链接后面，如下所示：

> ## 用户名：
> 
> ## 密码：
> 
> 或使用您的 OpenID

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-12-03T18:55:51.400

我现在正在研究 OpenId 以集成到启动站点中，以便它可以管理我的站点的登录过程。

我认为要制作这个主流，他们需要让这个超级简单。将代码复制、粘贴到您的站点中，它会加载登录表单，为您提供 Stackoverflow.com 的功能。

我认为您也可以将表单的布局设计得更容易识别。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-13T03:23:42.250

它不会成为主流，因为对于那些习惯使用电子邮件地址和密码的人来说，它太费力并且太混乱了。

例如：

要使用 Opera 登录到 stackoverflow，我必须单击登录，从列表中选择 myOpenID，输入我的用户名，按 Enter，按 Ctrl+Enter 在 myOpenID 站点上自动填充密码，然后按继续按钮。

要使用 Opera 登录任何普通站点，只需按 Ctrl+Enter 即可自动填充已保存的用户/密码组合。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2008-09-16T14:56:13.470

Make it less open.

i do not want the same identity on multiple sites. i do not want to have to create a flickr account before StackOverflow will let me post. i do not have to have to create a new flickr account for each website that i want to register with.

# asp.net - ASP.NET AJAX 负载平衡问题

> ID：50771
> 
> 赞同：1
> 
> 时间：2008-09-08T21:46:25.393
> 
> 标签：asp.net, load-balancing

对于在 App_Code 文件夹中有代码并使用硬件负载平衡器的任何人来说，这都是一个问题。确实可以将硬件负载平衡器设置为粘性会话来解决问题，但在完美的世界中，我希望关闭该功能。

当 App_Code 文件夹中有一个文件，并且网站没有预编译时，iis 会为这些文件生成随机文件名。

```
server1 "/ajax/SomeControl, App_Code.tjazq3hb.ashx"
server2 "/ajax/SomeControl, App_Code.wzp3akyu.ashx" 
```

因此，当用户发布页面并转移到另一台服务器时，没有任何效果。

有人对此有解决方案吗？我可以更改为预编译的网站，但我们的 QA 部门将无法仅推广更改的文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-08T22:16:08.770

您是否将两台服务器上的 <machinekey> 节点设置为相同的值？

您可以覆盖 web.config 中的 machine.config 文件来设置它。这需要匹配，否则您可能会遇到这样的奇怪情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T21:49:23.543

您的负载均衡器是否支持粘性会话？启用此功能后，平衡器将在特定时间窗口内一遍又一遍地将相同的 IP 路由到同一服务器。这样，来自一个客户端的所有请求（AJAX 或其他）总是会到达集群/场中的同一台服务器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-15T18:59:34.603

好的，首先…… MachineKey 是真的。在所有负载平衡的机器上，这绝对应该设置为相同。我不记得它影响的一切，但无论如何都要这样做。

其次，继续并预编译该站点。您实际上仍然可以推出新版本，只要页面有一个 .cs 文件，该页面就会重新编译。棘手的是被编译成单个 dll 的 app_code 文件。但是，如果在那里进行了更改，您可以上传新的 dll，一切都应该没问题。

为了让事情变得更简单，启用“使用的固定命名和单页程序集”选项。这将确保每次编译都具有相同的名称，因此您只需测试然后替换更改的 .dll 文件。

综上所述，您不应该遇到问题。请求转到 IIS，它只是提供页面并根据需要进行编译。如果每台机器上的代码不同，那真的没关系，代码是相同的，那台机器将引用它自己的代码。实际的请求/回发不知道也不关心这些。我上面所说的一切都应该有助于简化事情，但无论如何它应该可以工作......所以这可能是一个机器密钥问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T21:49:53.870

如果它是一个硬件负载平衡器，你应该没有问题，因为所有已知的都是请求 URL，服务器将在其中编译请求的页面并提供它。

我能想到的唯一问题是会话和视图状态。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T21:57:59.640

确实可以将硬件负载平衡器设置为粘性会话来解决问题，但在完美的世界中，我希望关闭该功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T00:11:15.903

看来这仅适用于 ViewState 加密。它不会影响自动编译程序集的文件名。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-09T05:53:57.203

如果您的 QA 部门可以提升整个库，您可以将 app_code 中的任何内容移动到外部类库。如果您找不到方便或可容忍的方式来切换到预编译的站点，我认为您会遇到棘手的会话。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-10T09:09:23.503

我认为 asp.net 模型对加密和特定于机器的存储有很大的依赖性，所以我不确定它是否可以避免会话的粘性 IP。

我不了解 ASP.NET AJAX（我改用 MonoRail NJS 方法），但会话状态对您来说可能是个问题。

您必须确保会话状态是可序列化的，并且不要使用 InMemory 会话。您可能需要运行 ASP.NET 会话状态服务器以确保整个前端场使用相同的会话存储。在这种情况下，会话必须是完全可序列化的（这就是为什么会话中没有对象是首选的，你必须始终使用 ID，我敢打赌 MS 在进行 AJAX 库开发时会坚持这个限制）

# visual-studio - Visual Studio 2005 在启动时崩溃

> ID：50774
> 
> 赞同：2
> 
> 时间：2008-09-08T21:47:54.530
> 
> 标签：visual-studio, crash, intellisense

在我的工作环境中，Visual Studio 当前每次启动主项目时都会崩溃，除非我删除 .suo（解决方案选项）和 .ncb（C++ Intellisense 符号）文件。

显然，我找到了解决方法。还有比这更永久的解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-08T21:50:49.907

[尝试使用Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)之类的工具监视 Visual Studio 进程并获取更多信息。这可能是因为一些奇怪的文件访问问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-08T21:57:53.133

您是否安装了 Visual Studio 2005 Service Pack 1？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T22:17:17.410

接受的答案并不完全正确，但它指向了正确的方向。

知识库文章 947315 中描述了 VS2k5 SP1 的修补程序，可解决此问题。

# sql-server - 如何让 ms-access 以其他用户身份连接到 ms-sql？

> ID：50786
> 
> 赞同：3
> 
> 时间：2008-09-08T21:51:02.403
> 
> 标签：sql-server, ms-access, odbc

如何让 ms-access 以与其 Active Directory ID 不同的用户身份连接到 ms-sql 数据库（通过 ODBC）？

我不想在 ODBC 连接中指定一个帐户，我想在 ms-access 端执行它以对我的用户隐藏它。在 ODBC 连接中执行此操作将使我回到我试图避免的原始情况。

是的，这与之前的问题有关：http: [//www.stackoverflow.com/questions/50164/](http://www.stackoverflow.com/questions/50164/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T14:14:16.913

[如果您使用“ODBC DSN-LESS 连接”](http://www.carlprothman.net/Default.aspx?tabid=90#ODBCDriverForSQLServer)，我认为您可以按照您想要的方式工作

如果需要，请使用 Windows 身份验证将 ODBC DSN 保留在用户计算机上。授予您的用户对您的数据库的只读访问权限。（如果他们创建一个新的 mdb 文件并链接表，他们将只能读取数据。）

创建一个对您的数据库具有读/写权限的 SQL 登录名。

编写一个 VBA 例程，循环遍历您的链接表并重置连接以使用您的 SQL 登录，但请务必使用“DSN-Less”语法。

```
"ODBC;Driver={SQL Native Client};" &
       "Server=MyServerName;" & _
       "Database=myDatabaseName;" & _
       "Uid=myUsername;" & _
       "Pwd=myPassword" 
```

将此例程作为启动代码的一部分调用。

**关于这种方法的几点说明：**

*   一旦您从读/写更改为只读并尝试在不关闭并重新打开数据库 (mde/mdb) 文件的情况下返回读/写，Access 的连接信息似乎存在问题。如果您可以在启动时将其更改为读/写，而不是在会话期间更改它，则此解决方案应该可以工作。

*   通过使用 DSN - Less 连接，您可以在代码中隐藏用户的凭据（假设您给他们一个 mde 文件，您应该没问题）。通常硬编码连接字符串不是一个好主意，但是由于您正在处理内部应用程序，因此您应该可以接受这种方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T00:37:32.720

我认为您必须在要用于连接的帐户下启动 MS Access 进程。有多种工具可让您执行此操作，例如[CPAU](http://www.joeware.net/freetools/tools/cpau/index.htm)。这个工具也可以让你加密密码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T15:13:31.293

我们在这里承认您正在使用 ODBC 连接到您的数据库并启用了集成安全性，因此您没有/不想在连接字符串中写入用户名/密码值（根据我，这是正确的选择）。

在这种情况下，幸运的是在连接到数据时无法“模拟”另一个用户。和我一起承认，能够做出这样的事情将是集成安全性的一个巨大突破！

我从您之前的帖子中了解到，您希望用户能够根据他们使用的客户端界面更新数据或不更新数据。据我说，这个想法是为每个表创建一个链接的“不可更新”视图。假设为每个调用的表`Table_Blablabla`创建一个视图（= Access 中的查询），称为`View_Table_Blablabla`...）。

使用 Access 时，您可以在运行时决定是要打开可更新表还是只读视图。例如，这可以在运行时`form_Open`通过将表单记录源设置为表或视图来完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T22:10:31.023

@Philippe
我假设您使用“**承认**”一词大致相当于**理解**或**同意**；**与否认**相反。

我理解让所有用户使用一个 ID 和密码登录数据库（并将它们存储在应用程序中）的含义。对我来说，这比我现在面临的问题风险要小。
@离开

问题的更多背景信息：我使用 Windwos NT 身份验证在每个用户工作站上设置了 ODBC 连接。大多数情况下，用户使用 MDE 设置进行连接以使用该 ODBC 连接——在这种情况下，他们总是能够添加/更新/删除数据。

问题是一些用户受过足够的关于 MS-Access 的教育，可以创建一个新的 mdb 并将其链接到 MS-SQL 服务器。然后，他们可以直接在表格中编辑数据，而不是通过执行一定数量验证和手持操作的应用程序。他们**喜欢**这样做，但有时会搞砸并给我带来麻烦。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T16:31:23.920

我希望做的（我刚刚尝试过）是为每个表刷新到数据库的链接（注意：我已将 ODCB 连接切换到此实验的 SQL Server 身份验证，并将帐户添加到SQL 服务器也是如此：**只读**- 不能进行任何更新，而**读写**- 对表具有完全权限）。

```
myTable.Connect = _
                "ODBC;" & _
                "DATABASE=" & "MyTestDB" & ";" & _
                "UID=readonly;" & _
                "PWD=readonly_password;" & _
                "DSN=" & "MyTestDB" & ";"
myTable.RefreshLink 
```

这会阻止他们进行编辑，但我无法让以后的读写工作

```
myTable.Connect = _
                "ODBC;" & _
                "DATABASE=" & "MyTestDB" & ";" & _
                "UID=readwrite;" & _
                "PWD=readwrite_password;" & _
                "DSN=" & "MyTestDB" & ";"
myTable.RefreshLink 
```

似乎无论我首先获得的许可是什么，都会永久存在。如果我开始读写然后转到只读，则该表仍具有读写权限

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-17T07:43:54.753

为什么不使用集成/Windows 安全性。您可以授予活动目录组您希望用户的权限，然后将用户帐户添加到该组。我相信除此之外，您还可以使用 sql server 的角色功能来限制基于正在使用的客户端应用程序的功能。

# unix - unix 如何处理带有空格和参数的完整路径名？

> ID：50794
> 
> 赞同：25
> 
> 时间：2008-09-08T21:57:42.260
> 
> 标签：unix, path

unix 如何处理带有空格和参数的完整路径名？
在 windows 中我们引用路径并在后面添加命令行参数，在 unix 中如何？

```
 "c:\foo folder with space\foo.exe" -help 
```

**更新：**

我的意思是如何从命令行参数中识别路径。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-08T22:00:59.633

您可以像上面的 Windows 示例一样引用它，也可以使用反斜杠转义空格：

```
 "/foo folder with space/foo" --help
 /foo\ folder\ with\ space/foo --help 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-08T21:58:52.960

您可以根据需要引用，或者您可以使用前面的 \ 转义空格，但大多数 UNIX 路径（Mac OS X 除外）中没有空格。

```
/Applications/Image\ Capture.app/Contents/MacOS/Image\ Capture

"/Applications/Image Capture.app/Contents/MacOS/Image Capture"

/Applications/"Image Capture.app"/Contents/MacOS/"Image Capture" 
```

都指 Mac OS X 下的同一个可执行文件。

我不确定你对识别路径的意思是什么——如果上述任何路径作为参数传递给程序，shell 会将整个字符串放在一个变量中——你不必解析多个参数来获取整个路径。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-08T22:04:29.483

由于空格用于分隔命令行参数，因此必须将它们从 shell 中转义。这可以使用反斜杠 () 或引号来完成：

```
"/path/with/spaces in it/to/a/file"
somecommand -spaced\ option
somecommand "-spaced option"
somecommand '-spaced option' 
```

这是假设您是从 shell 运行的。如果您正在编写代码，通常可以直接传递参数，避免出现问题：

perl 中的示例。而不是这样做：

`print("code sample");`system("somecommand -spaced option");

你可以做

`print("code sample");`system("somecommand", "-spaced option");

因为当您传递 system() 调用列表时，它不会像使用单个参数调用那样破坏空格上的参数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T21:59:52.177

您可以像在 windows 中一样引用整个路径，也可以像以下那样转义空格：

```
/foo\ folder\ with\ space/foo.sh -help 
```

两种方法都行！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-08T22:18:36.063

还要小心双引号——在 Unix shell 上，这会扩展变量。有些是显而易见的（如`$foo`和`\t`），但有些不是（如`!foo`）。

为了安全起见，请使用单引号！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-01-03T11:40:46.450

我还想指出，如果您使用命令行参数作为 shell 脚本（.sh 文件）的一部分，那么在脚本中，您需要将参数括在引号中。所以如果你的命令看起来像

```
>scriptName.sh arg1 arg2 
```

arg1 是您的路径，其中包含空格，然后在 shell 脚本中，您需要将其称为“$arg1”而不是 $arg1

[这是详细信息](https://unix.stackexchange.com/questions/131766/why-does-my-shell-script-choke-on-whitespace-or-other-special-characters)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-02T17:15:46.320

如果正常方法不起作用，请尝试用`%20`.

在处理 SSH 和其他域风格的命令（如`auto_smb`.

# drupal - 哪个版本的 TinyMCE 可以在 Drupal 5 中使用 google chrome？

> ID：50799
> 
> 赞同：2
> 
> 时间：2008-09-08T21:59:07.733
> 
> 标签：drupal, tinymce, drupal-5

使用 Google Chrome 浏览器时，我的 drupal 站点（内部）不会显示 TinyMCE 编辑器。有没有人让 TinyMCE 在 Drupal 5 中与 Chrome 一起工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-08T22:25:54.643

TinyMCE 和 WebKit（Chrome 使用的渲染引擎）之间存在许多已知的不兼容性。如果您使用的是 TinyMCE 2.x，您可能想尝试使用 TinyMCE 的[Safari 插件](http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/safari)；Safari 也使用 WebKit。我还发现[TinyMCE 3.x 对 Safari/WebKit 的支持](http://wiki.moxiecode.com/index.php/TinyMCE:Compatiblity)比 TinyMCE 2.x 更好，所以您可能想尝试升级到最新的 3.x 版本。

高温高压

阿拉斯泰尔

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-21T21:52:40.983

我将 TinyMCE 升级到最新版本，但仍然失败。登录后第一次尝试编辑时编辑器会显示，但后续编辑无法调出TinyMCE编辑器

从好的方面来说，Drupal 6.4 和最新的 TinyMCE 似乎可以正常工作，所以我想我需要为这个网站将 Drupal 更新到 v. 6。

编辑刷新编辑页面会在我当前的设置中呈现 TinyMCE，这就是我在 Chrome 中对 Drupal 5.7 的回答。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T02:30:46.223

只需刷新编辑页面，编辑器就会在 Chrome 中呈现。

# php - 在 PHP 中获取浮点数的小数部分的最佳方法是什么？

> ID：50801
> 
> 赞同：52
> 
> 时间：2008-09-08T21:59:23.100
> 
> 标签：php

您如何在 PHP 中找到浮点数的小数部分？

例如，如果我有 value `1.25`，我想 return `0.25`。

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-09-08T22:01:21.503

```
$x = $x - floor($x) 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2017-01-13T02:49:12.167

```
$x = fmod($x, 1); 
```

这是一个演示：

```
<?php
$x = 25.3333;
$x = fmod($x, 1);
var_dump($x); 
```

应该输出

```
double(0.3333) 
```

[信用。](https://stackoverflow.com/questions/50801/whats-the-best-way-to-get-the-fractional-part-of-a-float-in-php/41626638#comment17394709_50806)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-09T13:38:55.667

不要忘记你不能相信浮点运算是 100% 准确的。如果您对此感到担忧，则需要研究[BCMath 任意精度数学](http://us2.php.net/manual/en/intro.bc.php)函数。

```
$x = 22.732423423423432;
$x = bcsub(abs($x),floor(abs($x)),20); 
```

你也可以自己破解字符串

```
$x = 22.732423423423432;    
$x = strstr ( $x, '.' ); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-08T22:08:22.017

如果数字为负数，则必须执行以下操作：

```
 $x = abs($x) - floor(abs($x)); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-10-12T03:10:40.510

nlucaroni 提供的答案仅适用于正数。适用于正数和负数的可能解决方案是：

```
$x = $x - intval($x) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-08T22:01:27.307

我的 PHP 技能欠缺，但您可以从原始数字中减去地板的结果

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-10T21:54:28.403

但是，如果您正在处理诸如 perlin 噪声或其他图形表示之类的东西，则被接受的解决方案是正确的。它将为您提供较低数字的小数部分。

IE：

*   `.25`: 0 是下面的整数，小数部分是 0.25
*   `-.25`: -1 是下面的整数，小数部分是 0.75

对于其他解决方案，您将在下面将 0 重复为整数，更糟糕的是，您将获得所有负数的反转小数值。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-08-01T14:19:42.403

前面的一些答案是片面的。我相信，这是您处理*所有*情况所需的：

```
function getDecimalPart($floatNum) {
    return abs($floatNum - intval($floatNum));
}

$decimalPart = getDecimalPart($floatNum); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-02-07T14:09:48.377

您可以使用[fmod](http://php.net/manual/en/function.fmod.php)功能：

```
$y = fmod($x, 1); //$x = 1.25 $y = 0.25 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-05-22T05:17:08.577

为了停止此页面上的混淆，实际上这是最好的答案，它速度快，适用于 $x 的正值和负值：

```
$frac=($x<0) ? $x-ceil($x) : $x-floor($x); 
```

我在 PHP 7.2.15 上运行了 1000 万次计算的速度测试，尽管两种解决方案给出了相同的结果，但 fmod 比 floor/ceil 慢。

`$frac=($x<0) ? $x-ceil($x) : $x-floor($x);` -> 490-510 毫秒（取决于 $x 的符号）

`$frac=fmod($x, 1);` -> 590 - 1000 毫秒（取决于 $x 的值）

而实际的空循环本身需要 80 毫秒（包括在上述时间中）。

测试脚本：

```
$x=sqrt(2)-0.41421356237;

$time_start = microtime(true);
for ($i=0;$i<=9999999;$i++) {
    //$frac=fmod($x, 1); // version a
    $frac=($x<0) ? $x-ceil($x) : $x-floor($x); // version b
}
$time_end = microtime(true);

$time = $time_end - $time_start; 
```

# javascript - Google 财经 - 获取报价搜索框 - 列对齐

> ID：50814
> 
> 赞同：0
> 
> 时间：2008-09-08T22:05:49.137
> 
> 标签：javascript, html, css

谷歌如何设法正确对齐[谷歌金融网址](http://finance.google.com)中“获取报价”搜索框建议下拉列表中的第二列*（即股票代码名称）*

**示例：**如果您输入`iii`- 第二列完全对齐。

它不使用固定宽度的字体 - 因此仅在*代码*中添加正确数量的空格是行不通的。

他们是怎么做到的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-08T22:11:17.423

很可能只是使用边距。将第一列向左浮动，然后将边距设置为第一列的宽度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T05:00:51.010

我刚刚使用 DOM 检查器查看了源代码，看起来它们`span`对于每个单元格都是 s，并且设置了边距（如 Darren 所说）以将右列放在上面。

# preprocessor - #line 并跳转到行

> ID：50819
> 
> 赞同：2
> 
> 时间：2008-09-08T22:10:00.343
> 
> 标签：preprocessor, text-editor

是否有任何编辑器尊重有关转到行功能的 C #line 指令？

*上下文：* 我正在开发代码生成器，需要跳转到输出的一行，但该行是相对于我添加的#line 指令指定的。我可以放下它们，但找到输入线更痛苦

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-18T05:02:10.060

如果编辑器是可编写脚本的，那么应该可以编写一个脚本来进行导航。甚至可能有一个 Vim 或 Emacs 脚本已经做了类似的事情。

FWIW 当我写很多 Bison/Flexx 时，我写了一个[Zeus](http://www.zeusedit.com) Lua 宏脚本，试图做类似的事情（即通过搜索#line 标记从输入文件移动到输出文件的相应行）。

对于任何可能感兴趣的人[来说，就是](http://www.zeusedit.com/forum/viewtopic.php?p=4065)那个特定的宏脚本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-08T22:27:35.217

`#line`指令通常由预编译器插入，而不是源代码中，因此如果文件扩展名为`.c`.

但是，后编译文件的正常文件扩展名是`.i`or `.gch`，因此您可以尝试使用它，看看会发生什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-08T23:07:35.480

我偶尔在头文件中使用以下内容在 VC6 和最近的 VS(2003+) 编译器输出窗口中生成可点击项目。

基本上，这利用了编译器输出中的项目输出本质上被解析为“PATH（LINENUM）：消息”这一事实。

这假定了微软编译器对“pragma remember”的处理。

这并不完全是您所要求的......但它通常可能有助于获得一些您可以让编译器发出一些编辑器可能会尊重的东西。

```
    // 以下定义将允许您插入
    // Microsoft 编译器输出流中的可点击项。
    // 错误和警告变量将由
    // IDE 作为实际的警告和错误...这意味着您可以
    // 它们出现在任务列表中。

    // 理论上可以在一定程度上检查编码标准
    //以这种方式和提示显示为警告甚至
    // 插入的错误...

    #define strify0(X) #X
    #define strify(X) strify0(X)
    #define 提醒（S）消息（__FILE__“（”strify（__LINE__）“）：”S）

    // 示例用法
    #pragma 提醒（“警告：虚假警告”）
    #pragma 提醒（“错误：假错误”）

```

我有一段时间没有尝试过，但它应该仍然有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T20:07:33.563

使用 sed 或类似工具将 #lines 转换为编译器未解释的其他内容，因此您会在实际行上收到 C 错误消息，但可以参考附近的原始输入文件。

# c# - 插件框架中的消息传递

> ID：50822
> 
> 赞同：2
> 
> 时间：2008-09-08T22:13:27.807
> 
> 标签：c#, plugins, message-passing

首先，我的博客上有一些关于这个问题的背景资料：

*   [http://www.codebork.com/coding/2008/06/25/message-passing-a-plug-framework.html](http://www.codebork.com/coding/2008/06/25/message-passing-a-plug-framework.html)
*   [http://www.codebork.com/coding/2008/07/31/message-passing-2.html](http://www.codebork.com/coding/2008/07/31/message-passing-2.html)

我知道描述不是很清楚，所以我会在这里尽可能地总结我正在尝试的内容。该应用程序是一个个人理财程序。本文末尾提供了有关框架本身的更多背景信息。

框架可以处理许多不同类型的插件（例如，帐户、导出、报告等）。但是，我专注于一类特定的插件，即所谓的数据插件，因为正是这类给我带来了问题。我有一类用于帐户的数据插件，一类用于交易等。

我正在进行大规模的重构，这给我留下了以下数据插件架构：

*   数据插件对象（实现初始化、安装和插件元数据）[实现`IDataPlugin<FactoryType>`]
*   数据对象（例如帐户）[实现，例如`IAccount`]
*   创建数据对象实例的工厂[实现，例如`IAccountFactory`]

以前数据对象和插件对象合二为一，但这意味着账户中记录的每笔交易都必须实例化一个新的交易插件，这导致了许多问题。不幸的是，这种重构破坏了我的消息传递。数据对象实现`INotifyPropertyChanged`了，所以我遇到了一个新问题，我不确定如何解决：插件对象正在向消息代理注册事件，但实际上是数据对象触发了事件。这意味着**订阅插件当前必须订阅每个创建的帐户，交易等！** 这显然是不可扩展的。

据我目前所知，我有两种可能的解决方案：

1.  使数据插件对象成为数据对象和消息代理的中间人，可能批量更改通知。我不喜欢这样，因为它给消息传递系统增加了另一层复杂性，我觉得我应该可以不用。
2.  垃圾当前基于事件的实现并使用其他更易于管理的东西（内存中 WCF？！）。

所以我想我真的在问：

1.  你将如何解决这个问题？
2.  您认为我忽略了哪些潜在的解决方案？
3.  我的方法甚至模糊地走上正轨/明智吗？！:-)

正如您从博客文章的日期中可以看出的那样，这个问题的某些变体已经让我感到很长一段时间了！因此，我们将不胜感激任何和所有的回应。

框架本身的背景如下：

> 我的插件框架由三个主要组件组成：插件代理、首选项管理器和消息代理。插件代理负责插件的基本工作：发现和创建插件。首选项管理器管理框架和各个插件的用户首选项，例如启用了哪些插件，数据应该保存在哪里等。通过发布/订阅进行通信，消息代理位于中间，收集所有发布的消息类型和管理订阅。发布/订阅当前是通过 .NET`INotifyPropertyChanged`接口实现的，该接口提供了一个名为`PropertyChanged`; 消息代理建立一个所有插件实现的列表`INotifyPropertyChanged`并订阅其他插件此事件。消息传递的目的是让账户和交易插件通知存储插件数据发生了变化，以便保存。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-08T23:25:19.150

哇！大问题！:)

如我错了请纠正我。您现在的基本解决方案是一种观察者模式，其中数据对象（帐户等）通知其状态的变化。您认为问题在于订阅插件必须在每个对象中注册才能处理通知。

这本身不是问题，您可以将事件控制放在[域模型](http://martinfowler.com/eaaCatalog/domainModel.html)中，但我建议您创建一个[服务层](http://martinfowler.com/eaaCatalog/serviceLayer.html)并在该层中执行此事件通知。这样一来，只有一个对象负责发布通知。

Martin Fowler 在他的博客中有一系列事件模式。[看看吧](http://www.martinfowler.com/eaaDev/)！很好的阅读。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-09T01:59:07.703

这是我对您的问题的理解：您有一个插件对象，它可能必须侦听 x 数据对象上的事件——尽管您不想订阅每个数据对象上的事件。我假设几个插件可能想要监听同一个数据对象上的事件。

您可以创建一个会话类型对象。每个插件都会监听会话对象上的事件。数据对象不再引发事件 - 它调用会话对象来引发事件（参数之一必须是引发事件的数据对象）。

That means that your plugins only have to subscribe to one event, but they get the event from all data objects.

On the other hand, if only one plugin will ever listen to a data object at a time, why not just have the data object call the plugin directly?

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T23:39:08.960

现在还为时过早，但您是否考虑过尝试使用[MEF](http://www.codeplex.com/MEF)而不是自己滚动？

# css - 最好的 CSS 生成器语言？

> ID：50823
> 
> 赞同：0
> 
> 时间：2008-09-08T22:14:21.050
> 
> 标签：css, maintainability

在维护 CSS 时，重用 CSS 中的值（尤其是颜色）一直是我的问题。使用 CSS 创建变量或提高可维护性的最佳工具是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-08T22:21:17.587

查看以下问题的答案

*   [在 .CSS 文件中创建一个变量以在该 .CSS 文件中使用](https://stackoverflow.com/questions/47487/create-a-variable-in-css-file-for-use-within-that-css-file)
*   [避免 CSS 中的重复常量](https://stackoverflow.com/questions/30170/avoiding-repeated-constants-in-css)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T01:49:07.977

我用过[Sass](https://sass-lang.com)，觉得它很棒。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-27T14:56:21.990

我还没有机会在项目中使用它，但是如果您碰巧使用 PHP 作为后端，[Turbine](http://turbine.peterkroener.de/)看起来很有希望。

# xml - XML 注释可以去任何地方吗？

> ID：50824
> 
> 赞同：17
> 
> 时间：2008-09-08T22:14:32.407
> 
> 标签：xml, comments

我编写了一个简单的工具来使用用户输入的查询生成 DBUnit XML 数据集。我想将在 XML 中输入的每个查询作为注释包含在内，但是用于生成 XML 文件的 DBUnit API 不支持在我想要的位置（在它生成的数据之上）插入注释，所以我求助于将使用顶部或底部的所有查询进行评论。

所以我的问题是：将它放在任何一个位置都是有效的 XML 吗？例如，上面的 XML 声明：

```
<!-- Queries used: ... -->
<?xml version='1.0' encoding='UTF-8'?>
<dataset>
  ...
</dataset> 
```

或者在根节点下面：

```
<?xml version='1.0' encoding='UTF-8'?>
<dataset>
  ...
</dataset>
<!-- Queries used: ... --> 
```

我计划最初尝试高于 XML 声明，但我怀疑这是否是有效的 XML，尽管来自[wikipedia](http://en.wikipedia.org/wiki/Xml#Well-formed_documents:_XML_syntax)的声明：

> 如果元素的内容是文本或#PCDATA，注释可以放置在树中的任何位置，包括文本中。

如果这可行，我计划回帖，但很高兴知道它是否是官方 XML 标准。

**更新：**有关我的测试结果，请参阅[下面的回复。](https://stackoverflow.com/questions/50824/can-xml-comments-go-anywhere#50976)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-08T22:19:32.740

根据[XML 规范](http://www.w3.org/TR/2006/REC-xml-20060816/#sec-comments)，格式良好的 XML 文档是：

> `document ::= prolog element Misc*`

`prolog`在哪里

> `prolog ::= XMLDecl? Misc* (doctypedecl Misc*)?`

并且`Misc`是

> `Misc ::= Comment | PI | S`

和

> `XMLDecl ::= '<?xml' VersionInfo EncodingDecl? SDDecl? S? '?>'`

这意味着，如果您想在顶部添加注释，则不能有 XML 类型声明。

但是，您可以在声明之后和文档元素之外，在文档的顶部或底部添加注释，因为`Misc*`可以包含注释。

该规范与维基百科的评论一致：

> 2.5 评论
> 
> [定义：注释可能出现在文档中其他标记之外的任何位置；此外，它们可能出现在文档类型声明中语法允许的位置。它们不是文档字符数据的一部分；XML 处理器可以（但不是必须）使应用程序能够检索注释文本。为了兼容性，字符串“--”（双连字符）不能出现在注释中。] 参数实体引用不能在注释中被识别。

所有这一切意味着您可以将注释**放在不在其他标记内的任何位置**，除非您**以注释开头，则不能有 XML 声明**。

然而，虽然理论上理论与实践一致，但实际上却并非如此，所以我很想知道你的实验是如何进行的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-08T22:21:48.193

第一个示例不是有效的 XML，声明必须是 XML 文档中的第一件事。

但除此之外，评论可以去其他任何地方。

更正您的第一个示例：

```
<?xml version="1.0" encoding="UTF-8"?>
<!-- Queries used: ... -->
<dataset>
</dataset> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-08T22:26:39.617

处理指令必须是 XML 内容中的第一件事（请参阅[XML 注释](http://www.w3.org/TR/REC-xml/#sec-comments)和[处理指令](http://www.w3.org/TR/REC-xml/#sec-pi)）。以下应该有效：

```
<?xml version='1.0' encoding='UTF-8'?>
<!-- Queries used: ... -->
<dataset>
  ...
</dataset> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-08T23:50:55.000

谢谢大家的回答！

事实证明，文件前面的注释似乎有效，但是当我深入研究 DBUnit 源代码时，这是因为验证已关闭。

我确实通过以下方式尝试了一个简单的文档加载：

```
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
DocumentBuilder builder = factory.newDocumentBuilder();
Document document = builder.parse(new File("/path/to/file")); 
```

这会失败并出现异常，因为 XML 声明不是第一件事（正如其他人指出的那样）。

因此，虽然 DBUnit 可以工作，但我更喜欢使用有效的 XML，所以我将注释移到了末尾（因为 DBUnit 生成 XML 声明，所以不能将注释放在它下面，即使我更喜欢这样...... . 至少在事后不修改 XML 的情况下，这将比它的价值更多）。

# memory - 如何记录 malloc

> ID：50829
> 
> 赞同：4
> 
> 时间：2008-09-08T22:18:27.717
> 
> 标签：memory, memory-management, malloc

这有点假设并且非常简化，但是......

假设一个程序将调用第三方编写的函数。这些当事方可以被认为是非敌对的，但不能被认为是“有能力的”。每个函数都会接受一些参数，有副作用并返回一个值。它们在不运行时没有状态。

目标是通过记录所有 malloc（等）并在函数退出后释放所有内容来确保它们不会导致内存泄漏。

这可能吗？这实用吗？

ps 对我来说重要的部分是确保没有分配持续存在，因此在不这样做的情况下消除内存泄漏的方法对我没有用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-08T22:33:16.187

您没有指定操作系统或环境，此答案假定 Linux、glibc 和 C。

您可以设置 __malloc_hook、__free_hook 和 __realloc_hook 指向将分别从 malloc()、realloc() 和 free() 调用的函数。有一个 __malloc_hook 手册页显示了原型。您可以在这些钩子中添加轨道分配，然后返回让 glibc 处理内存分配/释放。

听起来您想在第三方函数返回时释放任何实时分配。有一些方法可以让 gcc 使用 -finstrument-functions 在每个函数入口和退出时自动插入调用，但我认为这对于你想要做的事情是不优雅的。在调用这些第三方函数之一后，您可以让自己的代码调用内存跟踪库中的函数吗？然后，您可以检查是否有任何第三方功能尚未释放的分配。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-08T22:24:51.243

首先，您必须为`malloc()`和`free()`和朋友提供入口点。因为这段代码已经编译（对吗？）你不能依赖`#define`重定向。

然后，您可以以明显的方式实现这些，并通过将这些例程链接到这些模块来记录它们来自某个模块。

最快的方法*根本不需要记录。* 如果他们使用的内存量是有限的，为什么不预先分配他们将需要的所有“堆”并从中编写一个分配器呢？然后当它完成后，释放整个“堆”，你就完成了！如果它更复杂，你可以将这个想法扩展到多个堆。

如果您确实需要“记录”而不是制作自己的分配器，这里有一些想法。一，使用带有指针和内部链接的哈希表。另一种方法是在每个块前面分配额外的空间，并在那里放置你自己的结构，其中包含一个索引到你的“日志表”中，然后保留一个日志表条目的空闲列表（作为一个堆栈，以便获得一个空闲的或者放一个免费的是 O(1))。这需要更多内存，但应该很快。

实用吗？我认为是的，只要速度命中是可以接受的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-08T22:23:19.267

您可以在单独的进程中运行第三方函数，并在使用完库后关闭该进程。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-08T22:22:34.247

比尝试记录 malloc 更好的解决方案可能是在调用函数时对函数进行沙箱化——让它们访问固定的内存段，然后在函数运行完成时释放该段。

无限制、无能的内存使用可能与恶意代码一样具有破坏性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-08T22:21:43.937

你不能强迫他们在堆栈上分配所有内存吗？这样就可以保证在函数退出后将其释放。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-08T22:45:02.210

过去，我用 C 语言编写了一个软件库，它有一个内存管理子系统，其中包含记录分配和释放以及手动匹配每个分配和释放的能力。这在尝试查找内存泄漏时很有用，但使用起来既困难又耗时。日志的数量是压倒性的，并且需要大量的时间来理解这些日志。

话虽如此，如果您的第三方库有大量分配，那么通过日志记录来跟踪它很可能是不切实际的。如果您在 Windows 环境中运行，我建议使用 Purify[1] 或 BoundsChecker[2] 之类的工具，它们应该能够检测到第三方库中的泄漏。对工具的投资应在节省的时间中收回成本。

[1]：[http:](http://www-01.ibm.com/software/awdtools/purify/) //www-01.ibm.com/software/awdtools/purify/ 净化

[2]： http: [//www.compuware.com/products/devpartner/visualc.htm](http://www.compuware.com/products/devpartner/visualc.htm) BoundsChecker

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-08T22:26:24.487

由于您担心内存泄漏并谈论 malloc/free，因此我假设您使用 C。我还根据您的问题假设您无权访问第三方库的源代码。

我唯一能想到的就是在调用前后检查你的应用程序的内存消耗，如果它们不同，则记录错误消息，并说服第三方供应商修复你发现的任何泄漏。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T03:00:09.223

如果您有闲钱，请考虑使用 Purify 来跟踪问题。它可以创造奇迹，并且不需要源代码或重新编译。还有其他更便宜的调试 malloc 库可用。电子围栏是我记得的一个名字。也就是说，Denton Gentry 提到的调试钩子似乎也很有趣。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-21T03:40:38.563

如果你对 Purify 太穷了，试试 Valgrind。它比 6 年前好多了，而且比 Purify 更容易深入。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-02T11:07:36.697

Microsoft Windows 提供了（如果您需要 POSIX，请使用 SUA），很可能是当今任何发布操作系统的最先进的堆+（已知使用堆的其他 api）基础架构。

__malloc() 调试钩子和相关的 CRT 调试接口非常适合您拥有测试源代码的情况，但是它们通常会错过标准库或其他链接代码的分配。这是意料之中的，因为它们是 Visual Studio 堆调试基础结构。

**[gflags](http://technet.microsoft.com/en-us/library/cc738763(WS.10).aspx)**是一套非常全面和详细的调试功能，多年来一直包含在 Windows 中。具有仅用于源代码和二进制用例的高级功能（因为它是 OS 堆调试基础架构）。

它可以记录所有堆用户的所有堆修改入口点的完整堆栈跟踪（在后处理操作中重新分页符号信息），如果需要，可以串行记录。此外，它可能会用病态的情况修改堆，这可能会对齐数据的分配，以便最佳地分配 VM 系统提供的页面保护（即在页面末尾分配您请求的堆块，因此即使是单字节溢出在溢出时检测到。

umdh 是一个可以帮助评估各种检查点状态的工具，但是数据在目标执行过程中不断积累 o 它不是传统上下文中简单的检查点调试停止。另外，*警告*，最后我至少检查了存储堆栈信息的循环缓冲区的总大小，对于每个请求来说有点小（64k 条目（条目+堆栈）），因此您可能需要为重堆用户快速转储. 还有其他方法可以访问这些数据，但 umdh 相当简单。

**注意**有两种模式；

1.  模式 1，umdh {-p:Process-id|-pn:ProcessName} [-f:Filename] [-g]
2.  模式 2，umdh [-d] {File1} [File2] [-f:Filename]

    *我不知道选择在 -p:foo 参数说明符和参数的裸排序之间交替的开发人员是什么精神错乱，但它可能会有点混乱。*

调试 sdk 与许多其他工具一起使用，[memsnap](http://technet.microsoft.com/en-us/library/cc757686(WS.10).aspx)是一个显然专注于内存泄漏等的工具，但我没有使用它，你的里程可能会有所不同。

为 UI 模式执行不带参数的 gflags，+arg 和 /args 也是*不同*的使用“模式”。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-02-16T19:03:06.800

在 Linux 上，我已经成功地用来[`mtrace(3)`](http://man7.org/linux/man-pages/man3/mtrace.3.html)记录分配和释放。它的用法很简单

1.  修改您的程序以`mtrace()`在您需要开始跟踪时调用（例如在顶部`main()`），
2.  将环境变量设置`MALLOC_TRACE`为应保存跟踪并运行程序的文件路径。

之后，输出文件将包含类似这样的内容（从中间摘录以显示分配失败）：

```
@ /usr/lib/tls/libnvidia-tls.so.390.116:[0xf44b795c] + 0x99e5e20 0x49
@ /opt/gcc-7/lib/libstdc++.so.6:(_ZdlPv+0x18)[0xf6a80f78] - 0x99beba0
@ /usr/lib/tls/libnvidia-tls.so.390.116:[0xf44b795c] + 0x9a23ec0 0x10
@ /opt/gcc-7/lib/libstdc++.so.6:(_ZdlPv+0x18)[0xf6a80f78] - 0x9a23ec0
@ /opt/Xorg/lib/video-libs/libGL.so.1:[0xf668ee49] + 0x99c67c0 0x8
@ /opt/Xorg/lib/video-libs/libGL.so.1:[0xf668f14f] - 0x99c67c0
@ /opt/Xorg/lib/video-libs/libGL.so.1:[0xf668ee49] + (nil) 0x30000000
@ /lib/libc.so.6:[0xf677f8eb] + 0x99c21f0 0x158
@ /lib/libc.so.6:(_IO_file_doallocate+0x91)[0xf677ee61] + 0xbfb00480 0x400
@ /lib/libc.so.6:(_IO_setb+0x59)[0xf678d7f9] - 0xbfb00480 
```

# push - 如何近乎实时地将数据推送到各种不同的客户端类型？

> ID：50831
> 
> 赞同：2
> 
> 时间：2008-09-08T22:19:15.737
> 
> 标签：push

我们需要将体育数据推送到多种不同的客户端类型，例如 ajax/javascript、flash、.NET 和 Mac/iPhone。数据更新只需要接近实时，延迟几秒钟是可以接受的。

如何最好地做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T08:48:32.097

最好的解决方案（如果我们谈论的是 .NET）似乎是使用 WCF 和流式 http。客户端在端口 80 处与服务器建立第一个 http 连接，然后连接保持打开状态，并带有永不结束的流式响应。（如果确实如此，它会重新连接）。

下面是一个演示这一点的示例：[Streaming XML](http://blogs.thinktecture.com/buddhike/archive/2007/05/23/414851.aspx)。

通过防火墙的解决方案：[在 IIS 中保持连接打开](http://blogs.msdn.com/drnick/archive/2006/10/20/keeping-connections-open-in-iis.aspx "在 IIS 中保持连接打开")

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-09-08T22:31:35.363

我会选择 XML。XML 在所有平台上得到广泛支持，并且有许多可用的库和工具。而且由于它是文本，因此在平台之间传递它时没有问题。

我知道 JSON 是另一种选择，但我对它不够熟悉，不知道在这种情况下是否推荐它。

# watin - 如何使用 Watin 点击 AutoCompleteExtender

> ID：50845
> 
> 赞同：0
> 
> 时间：2008-09-08T22:25:48.153
> 
> 标签：watin, autocompleteextender

对于我的验收测试，我将文本写入自动完成扩展器，我需要单击填充的列表。

为了填充列表，我必须使用 AppendText 而不是 TypeText，否则文本框会在填充列表之前失去焦点。

现在我的问题是当我尝试点击填充列表时。我尝试搜索 UL 元素并单击它；但它不会触发列表上的点击事件。

然后我尝试按标记名和值搜索列表：

```
Element element = Browser.Element(Find.By("tagname", "li") && Find.ByValue("lookupString")); 
```

但它没有找到它，有没有人能够做我想做的事？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T00:19:57.740

万一有人遇到同样的问题。它适用于下一个代码：

```
string lookupString = "string in list";
Regex lookup = new Regex(string.Format(".*{0}.*", lookupString));
Element list = Browser.Element("li", Find.ByText(lookup));
list.MouseDown(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T00:29:52.953

较短的版本是：

```
string lookupString = "string in list";
Element list = Browser.Element("li", Find.ByText(new Regex(lookupString)));
list.MouseDown(); 
```

正则表达式将进行部分匹配，因此您*无需*在任一侧指定 .* 并使用 string.Format。然而，这假设 lookupString 不包含任何对正则表达式特殊的字符，它们需要被转义。

# linq-to-sql - LINQ to SQL 不会基于关系生成集合的原因是什么？

> ID：50853
> 
> 赞同：1
> 
> 时间：2008-09-08T22:27:45.620
> 
> 标签：linq-to-sql

我在两个实体（e1 和 e2）之间有一个关系，并且 e1 有一个 e2 的集合，但是我在（e2 和 e3）之间建立了类似的关系，但是 e2 不包含 e3 的集合，这有什么理由发生？我可以发布任何内容以使这更容易弄清楚吗？

编辑：我刚刚注意到 e1 和 e2 之间的关系是稳固的，而 e2 和 e3 之间的关系是点状的，这是什么原因造成的？有关系吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-06T19:11:49.453

**使用此设置，一切正常。**

*1) LINQ to SQL 查询，2) DB 表，3) VS.NET 2008 中的 LINQ to SQL 数据模型*

**1 - LINQ to SQL 查询**

```
DataClasses1DataContext db = new DataClasses1DataContext();

var results = from threes in db.tableThrees
    join twos in db.tableTwos on threes.fk_tableTwo equals twos.id
    join ones in db.tableOnes on twos.fk_tableOne equals ones.id
    select new { ones, twos, threes }; 
```

**2 - 数据库脚本**

```
--Table One
CREATE TABLE tableOne(
    [id] [int] IDENTITY(1,1) NOT NULL,
    [value] [nvarchar](50)  NULL,
 CONSTRAINT [PK_tableOne] PRIMARY KEY CLUSTERED 
    ( [id] ASC ) WITH ( 
    PAD_INDEX  = OFF, 
     STATISTICS_NORECOMPUTE  = OFF, 
     IGNORE_DUP_KEY = OFF, 
     ALLOW_ROW_LOCKS  = ON, 
     ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
    ) ON [PRIMARY];

--Table Two
CREATE TABLE tableTwo(
    [id] [int] IDENTITY(1,1) NOT NULL,
    [value] [nvarchar](50)  NULL,
    [fk_tableOne] [int] NOT NULL,
CONSTRAINT [PK_tableTwo] PRIMARY KEY CLUSTERED 
    ( [id] ASC ) WITH (
    PAD_INDEX  = OFF, 
    STATISTICS_NORECOMPUTE  = OFF, 
    IGNORE_DUP_KEY = OFF,
    ALLOW_ROW_LOCKS  = ON, 
    ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
    ) ON [PRIMARY];

ALTER TABLE tableTwo WITH CHECK     
    ADD CONSTRAINT [FK_tableTwo_tableOne]   
    FOREIGN KEY([fk_tableOne])
    REFERENCES tableOne ([id]);

ALTER TABLE tableTwo CHECK CONSTRAINT [FK_tableTwo_tableOne];

--Table Three
CREATE TABLE tableThree(
    [id] [int] IDENTITY(1,1) NOT NULL,
    [value] [nvarchar](50) NULL,
    [fk_tableTwo] [int] NOT NULL,
CONSTRAINT [PK_tableThree] PRIMARY KEY CLUSTERED 
    ([id] ASC ) WITH (
    PAD_INDEX  = OFF, 
    STATISTICS_NORECOMPUTE  = OFF, 
    IGNORE_DUP_KEY = OFF, 
    ALLOW_ROW_LOCKS  = ON, 
    ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
    ) ON [PRIMARY];

ALTER TABLE tableThree WITH CHECK 
    ADD CONSTRAINT [FK_tableThree_tableTwo] 
    FOREIGN KEY([fk_tableTwo])
    REFERENCES tableTwo ([id]);

ALTER TABLE tableThree CHECK CONSTRAINT [FK_tableThree_tableTwo]; 
```

**3 - Visual Studio 中的 LINQ to SQL 数据模型**

[替代文字 http://i478.photobucket.com/albums/rr148/KyleLanser/ThreeLevelHierarchy.png](http://i478.photobucket.com/albums/rr148/KyleLanser/ThreeLevelHierarchy.png)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-08T23:34:15.710

FK_Contraints 设置如下：

ALTER TABLE [dbo].[e2] WITH CHECK ADD CONSTRAINT [FK_e2_e1] FOREIGN KEY([E1Id]) REFERENCES [dbo].[e1] ([Id])

ALTER TABLE [dbo].[e3] WITH CHECK ADD CONSTRAINT [FK_e3_e2] FOREIGN KEY([E2Id]) REFERENCES [dbo].[e2] ([Id])

这是你要的吗？

# sql-server-2005 - sql 2005 角色

> ID：50863
> 
> 赞同：2
> 
> 时间：2008-09-08T22:34:41.657
> 
> 标签：sql-server-2005

如果我需要登录名才能创建数据库，并创建其他登录名并根据这些登录名将用户添加到我创建的数据库中，我应该赋予 sql 登录名什么角色？这是 sql 2005。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-08T22:42:51.387

没有包含这些权限的固定数据库角色。您必须创建一个角色并单独分配权限。

```
创建角色 db_creator
将创建数据库授予 db_creator
授予更改任何登录到 db_creator
将任何用户授予 db_creator

```

# language-agnostic - 学生项目：它们会影响就业前景吗？

> ID：50864
> 
> 赞同：7
> 
> 时间：2008-09-08T22:37:28.920
> 
> 标签：language-agnostic

我是一名 BSc 学生，即将开始我学位的最后一年，我想知道我的最后一年项目选择在明年寻找工作时的相关性 - 以及它将如何影响将开放的工作/在寻找我的第一份编程/开发人员工作时对我关闭。

对于我的最后一年的项目/论文，我目前有几个选择：

*   机器人/模式识别：我的一位二年级教授从事机器人/视觉模式识别方面的研究，并在我最后一年的项目中邀请我与他一起工作。它将在 Python 中，因为它在该领域具有良好的 API/库。

*   文档存储系统：带有数据库和一些网络元素（客户端/服务器），可能在服务器上使用 apache jackrabbit 和 java 以及 C#/WPF/.Net 堆栈来开发客户端。C# 因为 WPF 中的贝塞尔曲线很简单，而且我为客户端组件考虑了一种特定类型的 GUI。这是我自己的想法/项目。

第一个听起来最有趣，而且很可能是我参与真正研究的那一次（我 35 岁并且有一个家庭）。第二个听起来更接近现实世界的发展。我过去的工作经验不涉及编程或 IT。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-08T22:42:56.083

作为一个经常招聘的人（我们最近的两个招聘刚刚毕业），我会这样说：如果这是一个团队项目，它没有帮助，因为很难弄清楚谁做了什么。如果这是一个单例项目，并且您可以回答有关它的深层问题，那当然是一个加分项。

事实上，*任何*表现出主动性的东西都是加分项——学校项目、业余项目，甚至与编程无关的课外活动。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-08T22:42:21.733

我在我们的工作中大量参与招聘，所以我可以发表我的观点。当我们雇用以前没有工作经验的人时，我们只看他们的编程头脑。然而，任何相关技术的学生项目（对于我们的公司）都可以作为一点奖励（如果他们能回答有关技术的问题）。

如果可以的话，我认为你应该两者都做。一个用于您的论文，另一个作为一个自我项目（可能范围缩小），并将其包含在您的简历中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-08T22:45:41.943

项目的细节不会像你如何展示项目那样相关——面试官不会知道你是否有选择或其他选择是什么。

在一次采访中，我会寻找能够热情地谈论这个项目并明确表示他们喜欢挑战和解决问题的人，而不是他们只是以最快的方式将一些东西放在一起。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-09T02:35:08.723

在采访刚毕业的程序员时，我对**完成**的项目印象最深，尤其是那些至少部分在校外完成的项目。以我的经验，看到个人项目直至完成的能力与在大型项目中独立完成工作的能力之间存在密切关联。

因此，为了回答您的问题，出于简历的目的，我建议仅在您确信结果将是可以展示的可靠结果时才建议模式识别项目。

也就是说，毫无疑问，您应该从事您最感兴趣的项目。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-08T22:41:38.053

我的想法：

如果你毕业后特别想从事机器人工作，机器人项目可能会帮助你。

文档存储系统将帮助您在其他任何地方获得职位，因为它结合了所有最流行的当前技术（Java、C#、WPF）。

现在，如果您能想出一种方法来编写 C#/WPF UI 以与机器人项目进行交互，那么您将是黄金 :)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-08T22:46:56.543

老实说，我的 BSc 项目与我的工作经历无关，除了它对我最终学位分类的影响。项目本身评分比较高，但在功能代码方面，其实很少。我写了一份很好的报告，为进一步的进步奠定了坚实的基础，但仅此而已。我建议你选择你最喜欢的区域，然后享受其中的乐趣——我真的希望我自己能做到这一点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-08T22:47:48.443

当我完成大学四年级的项目时，我在负责该项目的外部公司找到了一份工作。我认为最重要的是，那是因为我选择了一个我感兴趣的项目，因此我在整个过程中保持了积极性，这意味着主管对我有很好的看法。

我会更担心选择一个能让你保持兴趣并且你可以做得很好的项目，而不是项目中的一些“就业能力”因素。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-08T22:48:10.703

如果这听起来很有趣（比如 AI），你的面试官可能会出于好奇而对你进行盘问。提示 10 分钟回答你可能知道答案的垒球问题，而不是你可能会遇到的技术问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-08T22:48:41.623

作为一个学生我自己，把这个和一些盐一起吃。

哎呀！

我的学校从事大型、行业赞助的高级项目。学生经常直接从他们那里得到工作。一些赞助商已经预先表示“这个项目有利于你在我公司的工作前景”

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-08T22:57:06.503

你必须让自己（和你的家人）快乐。所以请放心您的选择

我根据我想在 2 年和 5 年内做什么来做出这些选择。什么选择会帮助我，什么选择不会...

祝你好运！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-08T23:16:02.947

如果以下任何一项属实，学生项目可以为您提供帮助：

*   您可以回答有关它的深层问题
*   这表明您在对招聘团队很重要的技术方面拥有专业知识
*   作为项目的结果，您创建了良好的抵押品（例如，被引用的论文）
*   你可以用它来证明你可以富有成效、热情和善于沟通

否则，它不会有任何区别。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-27T15:26:41.003

对您的标题问题的简短回答：是的，但并不总是以您期望的方式。

更长的答案（强烈关注我的优先事项 - 当他们在桌子的另一边时，您的里程可能会因其他人而异）：

我昨天一整天都在接受采访，并且有足够的时间来思考我的采访风格和优先事项。

我的兴趣领域肯定已经超出了一小部分技术流行语和“你可以为我输入什么代码以及多快？” 这些天来，我对你一、二、三年多后的那个人非常感兴趣。因此，我对确保您与我们今天所做的工作符合流行语不太感兴趣，而是对以下内容更感兴趣：

1.  和你聊天有意思吗？
2.  你做过什么让你感兴趣的工作吗？你能让我对这项工作感兴趣吗？
3.  我们可以对您使用的方法有分歧吗？你能说服我你的方法是正确的吗？
4.  你是一个思维敏捷的人吗？你能理解我对我们工作的解释并进入我们可以讨论的地步吗？

所以，回到你的问题，如果我们正在接受采访，我真的不在乎你在项目中使用了哪种特定技术。我*会*关心你是否可以解释该技术的优势和劣势，它如何导致项目的成功或失败，以及你从整个练习中学到了什么。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-09T03:58:47.680

GSOC 不是获得一些“可恢复”经验的好方法。参与操作系统项目也很有效。任何有社区可以保证你的（好）工作的地方。另一个技巧是开始回答有关用户组、Stack Overflow 等的技术问题。建立一个在线代表需要一些时间，但是一旦你有主动、帮助他人等的历史，这将是一个不错的选择当审阅者执行不可避免的谷歌搜索时，几乎没有什么提升。...当然，这确实需要一个相当独特的名称。

# performance - 平均用户下载速度

> ID：50890
> 
> 赞同：3
> 
> 时间：2008-09-08T22:48:43.497
> 
> 标签：performance, download, average

任何想法平均用户的下载速度是多少？我正在一个流式传输视频的网站上工作，并试图找出平均下载速度来确定质量。

我知道我可能会将苹果与橙子进行比较，但我只是在寻找一些东西来获得从哪里开始的基础。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-08T22:53:47.773

[Speedtest.net](http://speedtest.net/global.php)有很多按国家、地区、城市和 ISP 细分的统计数据。不确定准确性，因为它仅基于使用“带宽测量”服务的人。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-08T22:51:11.493

这将取决于您定位的地理位置。例如，在印度，您可以放心地假设它是一个低于 256kbps 的数字。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-08T23:04:26.610

尝试从另一个角度攻击它。看看迎合你想要的客户的流媒体服务，并且有大量的流量（也许是 youtube），看看他们在推动什么。您会发现 Alexa 评分（受欢迎程度）和质量（所需的最低比特率）之间存在非常直接的相关性。Vimeo 的用户总是比 Youtube 少，因为低比特率用户的用户体验很差。

还有许多其他因素，这应该只是您带宽决策的一小部分，但这是一个有用的比较。

但是请记住，您希望优雅地降级。随着越来越多的站点上线，您将开始遇到限制总传输量的 ISP，并且能够告诉您的客户您的站点消耗了多少带宽以及宣称您是低带宽站点是有用的。

此外，越来越多的用户正在使用便携式蜂窝连接（iPhone），其中有限的带宽是一个大问题。AT&T 已经超卖了许多市场，因此能够通过一个微小的链接获得有用的视频将使您能够占领 vimeo 和 Hulu 无法获得的市场。

不过，坦率地说，最好的办法是在飞行中优雅地降级。持续测量连接的带宽并根据需要调整带宽，以获得具有良好音频的流畅播放体验。然后，您可以让所有用户跨域...

-亚当

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-08T22:50:38.810

您可以尝试查看 AT&T 和 Comcast 的低端产品。基本级别可能为 1.5 Mbps（我想大多数人都会得到）。

“测试您的带宽”网站也可能对此有一些统计数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T22:54:23.450

涉及很多因素（服务器带宽、本地 ISP、中间网络等），很难给出一个硬性答案。使用我当前的 ISP，我通常会获得 200-300 kB/秒。尽管当行星对齐时，我获得了高达 2 MB/秒的速度（“引用”的峰值下行速度）。然而，那是并行流。我在单个流上实现的峰值带宽是 1.2 MB/秒

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-08T23:00:30.347

最好的策略是始终为您的用户提供选择。为什么不以适合所有人的低比特率开始流，并为我们这些拥有 FTTH 连接的人提供“高质量”链接？我相信 YouTube 已经开始这样做了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-08T23:07:13.793

[据 CWA](http://arstechnica.com/news.ars/post/20070529-survey-average-broadband-speed-in-us-is-1-9mbps.html)称，美国居民的平均下载速度为 1.9Mbps。他们有各州的数据，所以如果你有钱，那么你可能会为你的目标受众获得更具体的报告。但是请记住，越来越多的人正在与多台计算机共享此内容，使用 VOIP 设备，并运行消耗带宽的后台进程。

-亚当

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-08T23:15:04.290

哇。

这取决于端到端链路中涉及的设备、连接方法、连接类型、ISP 节流等。

尝试计算出平均速度是相当不可能的。

想一想，家里的胖管道（8Gb 以上）与机场免费提供的糟糕无线连接（9.6kb）相比，您可以开始了解您尝试平均的连接范围。

然后我们转向屏幕尺寸和设备功能的变化。

也许拖网传入连接的 UA 刺，以了解在那里使用的用户设备的功能。

也许看看您是否可以使用某种地理定位解决方案来尝试了解人们如何连接到您的站点，以了解连接功能。

您是否以固定格式（即 X x Y 像素大小）提供视频？

HTH。

干杯，

抢

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-08T23:24:42.723

如果我使用您的网站，“平均”并不重要。我只关心我的经验，所以你要么需要让网站自适应，设计相当低的速度（如果你幸运的话，iPhone 2G 可以让你达到 70-80 kbps，以一个常见的情况为例），或者非常明确要求，以便我可以决定我的即时连接是否有效。

您不想让您的用户受到无法预测的断断续续、断断续续的视频和音频。

# asp.net - 在Repeater中嵌套一个GridView

> ID：50898
> 
> 赞同：3
> 
> 时间：2008-09-08T22:56:22.230
> 
> 标签：asp.net, data-binding, gridview, repeater

我有一个场景，例如，我需要重复美国各州的列表，并在每个州的名称后显示一个城市和城市人口表。设计要求规定，每一个外部重复必须是一个州的名称，后跟一张城市表，并且此时不能更改该要求。将 GridView 嵌套在 Repeater 中，然后在 Repeater`ItemDataBound`事件期间绑定每个重复的 GridView 是否有缺点？有哪些替代解决方案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-08T23:04:04.537

如果是我，我会反过来问*我为什么要*使用 GridView，如果你需要一堆内置功能，比如分页和排序，那么 GridView 可能是一个不错的选择。如果您只想要表格数据，我会重新考虑。为什么？因为使用 GridView 你会得到一大堆你不会使用的东西，你的 ViewState 可能会很大，你的页面性能会变慢。

谈到 GridView，我并不是一个偏执狂，但我只在有充分理由时才使用它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T23:05:32.177

在上述情况下，您最好使用主从样式的 GridView，这将为您节省所有创建的 GridView 对象的开销。

它有多种实现方式（[对 master 使用下拉菜单，](http://msdn.microsoft.com/en-us/library/aa479344.aspx)[对 detail](http://mattberseth.com/blog/2008/04/masterdetail_with_the_gridview.html)使用模式弹出窗口等），但要点是有可用的实现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T14:48:32.957

至少，希望您可以关闭 GridView 上的 ViewState。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T15:03:04.073

我能想出的最佳解决方案是将 GridView 嵌套在中继器中。然后我在Repeater 的ItemDataBound 事件期间绑定了每个重复的GridView。当然，我关闭了他们的 ViewStates，因为它们不是必需的。

# .net - 从调试版本中检测发布版本的最佳方法是什么？。网

> ID：50900
> 
> 赞同：8
> 
> 时间：2008-09-08T22:57:20.463
> 
> 标签：.net, debugging, release

所以我有大约 10 个与 mvc 应用程序一起使用的短 css 文件。有诸如 error.css login.css 等......只是一些非常短的 css 文件，使更新和编辑变得容易（至少对我来说）。我想要的是可以优化 if else 分支而不是将其合并到最终位中的东西。我想做这样的事情

```
if(Debug.Mode){

<link rel="stylesheet" type="text/css" href="error.css" /> 
<link rel="stylesheet" type="text/css" href="login.css" /> 
<link rel="stylesheet" type="text/css" href="menu.css" /> 
<link rel="stylesheet" type="text/css" href="page.css" /> 
} else {
<link rel="stylesheet" type="text/css" href="site.css" /> 
} 
```

我将有一个 msbuild 任务，它将合并所有 css 文件，最小化它们以及所有这些好东西。我只需要知道是否有办法删除最后一位中的 if else 分支。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-08T23:40:44.790

具体来说，就像在 C# 中这样：

```
#if (DEBUG)
   Debug Stuff
#endif 
```

C# 具有以下预处理器指令：

```
#if 
#else 
#elif // Else If
#endif
#define
#undef // Undefine
#warning // Causes the preprocessor to fire warning
#error // Causes the preprocessor to fire a fatal error
#line // Lets the preprocessor know where this source line came from
#region // Codefolding
#endregion 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-18T15:52:05.233

```
 if (System.Diagnostics.Debugger.IsAttached)
  {
           // Do this
  }
  else
  {
            // Do that
  } 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-08T23:09:59.903

我应该使用谷歌。

```
#if DEBUG
    Console.WriteLine("Debug mode.") 
#else 
    Console.WriteLine("Release mode.") 
#endif 
```

确保选中项目属性中的选项“配置设置”->“构建”“定义调试常量”。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-10-14T10:32:02.493

你可以尝试使用

```
HttpContext.Current.IsDebuggingEnabled 
```

它由配置中的节点控制。在我看来，这是比条件编译更好的解决方案。

但是，如果您希望能够基于编译进行控制，我认为您可以使用[ConditionalAttribute](http://msdn.microsoft.com/en-us/library/system.diagnostics.conditionalattribute.aspx)。

问候，

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-08T23:10:30.027

编译器常量。我不记得 C# 语法，但这是我在 VB 中的做法：

```
#If CONFIG = "Debug" Then
  'do somtehing
#Else
  'do something else
#EndIf 
```

# windows - 如何从目录中删除旧文件，同时在 Windows 上保留最新文件

> ID：50902
> 
> 赞同：5
> 
> 时间：2008-09-08T23:00:27.430
> 
> 标签：windows, file, maintenance

> **可能重复：**
> [批处理文件删除超过 N 天的文件](https://stackoverflow.com/questions/51054/batch-file-to-delete-files-older-than-n-days)

我想运行一个计划的 Windows 任务，该任务从一个超过 2 周的目录中删除所有文件。

原因是这些是填满我的服务器的 IIS 和 Tomcat 日志，但我想保留最新的日志以防我需要调查问题。

有谁知道一种简单的方法来做到这一点？

干杯

尼日

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-09-20T08:18:34.653

**确切的语法：** `FORFILES /p d:\new /d -30 /m * /c "cmd /c del @file"`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-08T23:07:52.623

安排一个批处理文件来处理这个问题。

此行将删除 c:\mydirectory 中所有超过 14 天的文件 (*.*)：

```
FORFILES -pc:\mydirectory -s -m*.* -d-14 -c"DEL @FILE" 
```

将它放在一个文本文件中，将其重命名为“deletefiles.bat”之类的名称并安排它。

我没有对此进行测试，但应该很容易尝试。

* * *

编辑：如果您使用它，请确保您了解正在发生的事情 - -s 标志告诉它递归子目录，这可能不是您想要发生的事情。此外，您可能还需要为 DEL 命令指定一些标志。:)

* * *

编辑：意识到您需要[**从 Microsoft 下载东西**](ftp://ftp.microsoft.com/ResKit/y2kfix/x86/)才能使 FORFILES 工作。我也喜欢公认的解决方案，因为你不必有什么特别的。唯一的问题是它只每两周发生一次，而不是每天运行一个进程来删除所有超过 14 天的东西。这值多少钱。:P

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-08T23:19:30.037

最简单的方法是每周或每月运行一个 .bat 运行文件。

```
cd \mylog\dir
mkdir archive
del /Q .\archive\*.log
move *.log .\archive 
```

如果您想要更复杂的东西，请下载 cygwin 工具以使用类似 un*x 的命令，或者可能查看 Powershell。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-08T23:39:23.093

使用 VBScript，改编自[ScriptingAnswers](http://www.scriptinganswers.com/forum2/forum_posts.asp?TID=2099&PN=1)

```
Dim fso, startFolder, OlderThanDate
Set fso = CreateObject("Scripting.FileSystemObject")

startFolder = "E:\temp"           ' folder to start deleting (subfolders will also be cleaned)

OlderThanDate = DateAdd("d", -07, Date)  ' 07 days (adjust as necessary)

DeleteOldFiles startFolder, OlderThanDate

Function DeleteOldFiles(folderName, BeforeDate)
    Dim folder, file, fileCollection, folderCollection, subFolder

    Set folder = fso.GetFolder(folderName)

    Set fileCollection = folder.Files

    For Each file In fileCollection
        If file.DateLastModified < BeforeDate Then
            ' fso.DeleteFile(file.Path)    # Modify this to delete after testing
            WScript.StdOut.WriteLine (file.Path)
        End If
    Next

    Set folderCollection = folder.SubFolders
    For Each subFolder In folderCollection
        DeleteOldFiles subFolder.Path, BeforeDate
    Next

End Function 
```

您可以使用 CScript 运行此脚本

@Jason：不错的实用程序，资源工具包中的 FORFILES

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-08T23:05:51.303

为什么不编写批处理文件或 powershell 脚本并安排它呢？

用于删除早于指定日期的文件的[脚本。](http://www.microsoft.com/technet/scriptcenter/resources/qanda/nov04/hey1104.mspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-08T23:08:45.803

如果您在服务器上安装了 perl（或类似的），这是相当简单的：

```
#!perl
foreach my $file (</path/to/logs/*.log>) {
  next unless -M $file > 14;
  print "Deleting $file...\n";
  # unlink $file or die "Failed to remove $file: $!";
} 
```

实际删除的行被注释掉了，因为房子里可能有孩子:)

# search - 按哈希搜索？

> ID：50914
> 
> 赞同：4
> 
> 时间：2008-09-08T23:06:34.013
> 
> 标签：search, hash, utilities

我有一个搜索引擎的想法，它可以像现在其他搜索引擎一样索引 web 项目，但只存储文件的标题、url 和内容的哈希值。

这样，如果您已经拥有它们并且不知道它们来自哪里或想知道某些东西出现的所有地方，那么在网络上很容易找到它们。

对于图像、可执行文件和档案等非文本项目更有用。

我想知道是否已经有类似的东西了？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-08T23:50:30.447

查看[关于 localitysensitive hashing 的维基百科页面](http://en.wikipedia.org/wiki/Locality_sensitive_hashing)。[麻省理工学院的一项研究](http://www.mit.edu/~andoni/LSH/)也提供了一个很好的页面。

一般来说，有几种可用的风格：字符串散列（例如[simhash](http://scholar.google.com/scholar?hl=en&lr=&cluster=2077823906332929131)）、集合或 0/1 特征（例如[min-wise hashes](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.43.9451)）以及实向量。

到目前为止，数值散列的主要技巧基本上是降[维。](http://en.wikipedia.org/wiki/Dimension_reduction)对于字符串，我们的想法是提出一种在面对微小编辑时仍能保持稳健的表示。

我也在这个领域做一些研究，虽然我猜 stackoverflow 可能不是适合新生工作的地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-08T23:11:55.843

好吧，对于图像，有[http://tineye.com](https://tineye.com)，它会为你找到相似的图像。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-21T23:50:20.443

这个问题似乎集中在精确匹配哈希上，我们比最近邻方法更好地理解它，并且确实值得，特别是如果人们可以通过这种方式共享标签和其他元数据。

正如@rjmunro 所指出的，基于哈希的搜索在 P2P 世界中是一个流行的想法，Bitzi 几乎做到了这一点，尽管他们已经关闭并且他们的 Bitpedia（数字媒体百科全书）不再托管在那里，尽管其中一些至少在 Archive.org 上仍然可用。

Bitzi 还制作了[Bitcollider (SourceForge.net)](http://sourceforge.net/projects/bitcollider/)和[Magnet URI 方案](https://en.wikipedia.org/wiki/Magnet_URI_scheme)等软件，该方案允许通过哈希指定文件，因此是基于内容的标识符。如该维基百科页面所述，各种应用程序支持通过 Magnet URI 在各种数据库中进行搜索。

同样的想法在密码破解场景中很流行 - 参见例如[findmyhash - 使用在线服务破解哈希的 Python 脚本](https://code.google.com/p/findmyhash/)等。

更进一步，我认为如果有数据库和在线存储库通过哈希识别内容并从各个角度提供有关内容的**标签**和其他**元数据，那就太好了。**然后我可以让我的音乐收藏保持原始状态（不会浪费备份空间和时间），但仍然可以自己标记它们并通过外部标记数据库添加其他元数据。如果我的应用程序知道如何获取标签，它似乎比我们修改和复制大文件只是为了将标签从我的桌面移动到我的手机的当前系统要好得多。

[请参阅Metadata Independent Hashing for Media Identification & P2P Transfer Optimization](http://www.tara.tcd.ie/xmlui/bitstream/handle/2262/66996/paper_final-july2012.pdf) (pdf) 中的相关想法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-08T23:18:37.510

这不是一个坏主意。有时我发现自己偶然发现了一些文件，试图找出它的来源:) 但是你将如何跟踪项目的来源？内容可以通过多种方式获取——网络浏览器、下载管理器，只需从网络共享中复制即可。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-09T00:05:08.540

如果我理解你的建议是正确的，[http://bitzi.com/](http://bitzi.com/)已经这样做了一段时间。

# python - 如何在 Python 中创建对对象的弱引用？

> ID：50923
> 
> 赞同：10
> 
> 时间：2008-09-08T23:10:53.037
> 
> 标签：python, weak-references

如何在 Python 中创建对对象的弱引用？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-08T23:13:16.527

```
>>> import weakref
>>> class Object:
...     pass
...
>>> o = Object()
>>> r = weakref.ref(o)
>>> # if the reference is still active, r() will be o, otherwise None
>>> do_something_with_o(r()) 
```

有关更多详细信息，请参阅[wearkref 模块文档](http://docs.python.org/lib/module-weakref.html)。您还可以使用它`weakref.proxy`来创建代理 o 的对象。`ReferenceError`如果不再引用所指对象时使用，将抛出。

# .htaccess - 使用 .htaccess 将非 www URL 重定向到 www

> ID：50931
> 
> 赞同：6
> 
> 时间：2008-09-08T23:14:45.117
> 
> 标签：.htaccess, isapi-rewrite

我正在使用[Helicon 的 ISAPI Rewrite 3](http://www.helicontech.com/isapi_rewrite/)，它基本上可以在 IIS 中启用 .htaccess 。我需要将非 www 的 URL 重定向到 www 版本，即 example.com 应该重定向到 www.example.com。我使用了示例中的以下规则，但它会影响子域：

```
RewriteCond %{HTTPS} (on)?
RewriteCond %{HTTP:Host} ^(?!www\.)(.+)$ [NC]
RewriteCond %{REQUEST_URI} (.+)
RewriteRule .? http(?%1s)://www.%2%3 [R=301,L] 
```

这在大多数情况下都有效，但也将 sub.example.com 重定向到 www.sub.example.com。如何重写上述规则以使子域不会被重定向？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-08T23:28:15.617

附加以下 RewriteCond：

```
RewriteCond %{HTTP:Host} ^[^.]+\.[a-z]{2,5}$ [NC] 
```

这样，它只会将规则应用于 nondottedsomething.uptofiveletters，如您所见， subdomain.domain.com 将不匹配条件，因此不会被重写。

您可以更改 [az]{2,5} 以获得更严格的 tld 匹配正则表达式，以及为域名中允许的字符放置所有约束（因为 [^.]+ 比严格必要的更宽松）。

总而言之，我认为在这种情况下这是没有必要的。

编辑：sadie 发现了正则表达式的一个缺陷，将它的第一部分从 [^.] 更改为 [^.]+

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T00:52:41.373

我使用[urlrewriter.net](http://urlrewriter.net/)获得了更多控制权，例如：

```
<unless header="Host" match="^www\.">
   <if url="^(https?://)[^/]*(.*)$">
     <redirect to="$1www.domain.tld$2"/>
   </if>
   <redirect url="^(.*)$" to="http://www.domain.tld$1"/>
</unless> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T01:34:01.617

Zigdon 的想法是正确的，只是他的正则表达式不太正确。采用

`^example\.com$`

而不是他的建议：

`^example\.com(.*)`

否则，您将不仅匹配 example.com，还将匹配 example.comcast.net、example.com.au 等内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T18:46:31.573

@Vinko

对于您的通用方法，我不确定您为什么选择在正则表达式中限制 TLD 的长度？它不是面向未来的，我不确定它提供了什么好处？它实际上甚至不是“现在证明”，因为那里至少有一个 6 个字符的 TLD (.museum) 不会匹配。

我似乎没有必要这样做。你就不能`^[^.]+\.[^.]\+$`吗？（注意：问号是句子的一部分，不是正则表达式！）

除此之外，这种方法还有一个更大的问题是：对于不直接位于 TLD 之下的域，它将失败。这是澳大利亚、英国、日本和许多其他国家的域，它们具有层次结构：.co.jp、.co.uk、.com.au 等。

无论这是否与 OP 有任何关系，我不知道，但如果您追求“修复所有”的答案，则需要注意这一点。

OP 尚未明确表示他想要通用解决方案还是针对单个（或小组）已知域的解决方案。如果是后者，请参阅我关于使用 Zigdon 方法的其他说明。如果是前者，那么考虑到这篇文章中的信息，继续使用 Vinko 的方法。

编辑：到目前为止，我遗漏的一件事可能是也可能不是您的商业选择，那就是走另一条路。我们所有的网站都将[http://www.domain.com](http://www.domain.com)重定向到[http://domain.com](http://domain.com)。[http://no-www.org](http://no-www.org)上的人们提出了一个很好的案例（恕我直言），因为这是“正确”的做法，但它仍然肯定只是一个偏好问题。有一件事是肯定的，为这种重定向编写一个通用规则比这个要容易得多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T21:14:02.747

@org 0100h 是的，问题描述中遗漏了许多变量，您的所有观点都是有效的，应在实际实施时加以解决。您提出的正则表达式既有优点也有缺点。一方面它更容易和未来证明，另一方面，如果在 Host 标头中发送，你真的想匹配 example.foobar 吗？当您最终重定向到错误的域时，可能会有一些极端情况。第三种选择是修改正则表达式以使用实际域的列表，如果有多个，例如

```
RewriteCond %{HTTP:Host} (example.com|example.net|example.org) [NC] 
```

（请注意克里斯，这**将**改变 %1）

@chrisofspades这并不是要替换它，您的第二个条件确保它没有www，而我的没有。它不会更改 %1、%2、%3 的值，因为它不存储匹配项（iow，它不使用括号）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-08T23:18:18.837

您不能将 RewriteCond 调整为仅在 example.com 上运行吗？

```
RewriteCond %{HTTP:Host} ^example\.com(.*) [NC] 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-09T01:23:08.757

你为什么不在你的（httpd 的）vhost 文件中有这样的东西？

```
ServerName: www.example.com
ServerAlias: example.com 
```

当然不会重定向，只会照常进行

# svn - 您可以使用 Subversion 进行部分结帐吗？

> ID：50945
> 
> 赞同：167
> 
> 时间：2008-09-08T23:26:12.953
> 
> 标签：svn, sparse-checkout

如果我在 trunk/ 下有 20 个目录，每个目录中有很多文件，并且只需要其中的 3 个目录，那么是否可以只在 trunk 下的这 3 个目录进行 Subversion 检出？

* * *

## 回答 #1

> 赞同：281
> 
> 时间：2008-09-08T23:52:53.280

事实上，多亏了对我的帖子的评论，看起来[稀疏目录](http://svnbook.red-bean.com/en/1.8/svn.advanced.sparsedirs.html)是要走的路。我相信以下应该做到这一点：

```
svn checkout --depth empty http://svnserver/trunk/proj
svn update --set-depth infinity proj/foo
svn update --set-depth infinity proj/bar
svn update --set-depth infinity proj/baz 
```

或者，`--depth immediates`不要在没有内容的情况下`empty`签出文件和目录。`trunk/proj`这样您就可以查看存储库中存在哪些目录。

* * *

正如@zigdon 的回答中提到的，您还可以进行非递归结帐。这是实现类似效果的一种较旧且不太灵活的方法：

```
svn checkout --non-recursive http://svnserver/trunk/proj
svn update trunk/foo
svn update trunk/bar
svn update trunk/baz 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2008-09-09T00:48:08.403

Subversion 1.5 引入了稀疏检出，这可能对您有用。从[文档](http://svnbook.red-bean.com/en/1.8/svn.advanced.sparsedirs.html)中：

> ...*稀疏目录*（或*浅签*出） ...允许您轻松签出工作副本 - 或工作副本的一部分 - 比完全递归更浅，可以自由引入以前忽略的文件和子目录晚点。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-07-13T22:31:10.800

我编写了一个脚本来自动化复杂的稀疏结帐。

```
#!/usr/bin/env python

'''
This script makes a sparse checkout of an SVN tree in the current working directory.

Given a list of paths in an SVN repository, it will:
1\. Checkout the common root directory
2\. Update with depth=empty for intermediate directories
3\. Update with depth=infinity for the leaf directories
'''

import os
import getpass
import pysvn

__author__ = "Karl Ostmo"
__date__ = "July 13, 2011"

# =============================================================================

# XXX The os.path.commonprefix() function does not behave as expected!
# See here: http://mail.python.org/pipermail/python-dev/2002-December/030947.html
# and here: http://nedbatchelder.com/blog/201003/whats_the_point_of_ospathcommonprefix.html
# and here (what ever happened?): http://bugs.python.org/issue400788
from itertools import takewhile
def allnamesequal(name):
    return all(n==name[0] for n in name[1:])

def commonprefix(paths, sep='/'):
    bydirectorylevels = zip(*[p.split(sep) for p in paths])
    return sep.join(x[0] for x in takewhile(allnamesequal, bydirectorylevels))

# =============================================================================
def getSvnClient(options):

    password = options.svn_password
    if not password:
        password = getpass.getpass('Enter SVN password for user "%s": ' % options.svn_username)

    client = pysvn.Client()
    client.callback_get_login = lambda realm, username, may_save: (True, options.svn_username, password, True)
    return client

# =============================================================================
def sparse_update_with_feedback(client, new_update_path):
    revision_list = client.update(new_update_path, depth=pysvn.depth.empty)

# =============================================================================
def sparse_checkout(options, client, repo_url, sparse_path, local_checkout_root):

    path_segments = sparse_path.split(os.sep)
    path_segments.reverse()

    # Update the middle path segments
    new_update_path = local_checkout_root
    while len(path_segments) > 1:
        path_segment = path_segments.pop()
        new_update_path = os.path.join(new_update_path, path_segment)
        sparse_update_with_feedback(client, new_update_path)
        if options.verbose:
            print "Added internal node:", path_segment

    # Update the leaf path segment, fully-recursive
    leaf_segment = path_segments.pop()
    new_update_path = os.path.join(new_update_path, leaf_segment)

    if options.verbose:
        print "Will now update with 'recursive':", new_update_path
    update_revision_list = client.update(new_update_path)

    if options.verbose:
        for revision in update_revision_list:
            print "- Finished updating %s to revision: %d" % (new_update_path, revision.number)

# =============================================================================
def group_sparse_checkout(options, client, repo_url, sparse_path_list, local_checkout_root):

    if not sparse_path_list:
        print "Nothing to do!"
        return

    checkout_path = None
    if len(sparse_path_list) > 1:
        checkout_path = commonprefix(sparse_path_list)
    else:
        checkout_path = sparse_path_list[0].split(os.sep)[0]

    root_checkout_url = os.path.join(repo_url, checkout_path).replace("\\", "/")
    revision = client.checkout(root_checkout_url, local_checkout_root, depth=pysvn.depth.empty)

    checkout_path_segments = checkout_path.split(os.sep)
    for sparse_path in sparse_path_list:

        # Remove the leading path segments
        path_segments = sparse_path.split(os.sep)
        start_segment_index = 0
        for i, segment in enumerate(checkout_path_segments):
            if segment == path_segments[i]:
                start_segment_index += 1
            else:
                break

        pruned_path = os.sep.join(path_segments[start_segment_index:])
        sparse_checkout(options, client, repo_url, pruned_path, local_checkout_root)

# =============================================================================
if __name__ == "__main__":

    from optparse import OptionParser
    usage = """%prog  [path2] [more paths...]"""

    default_repo_url = "http://svn.example.com/MyRepository"
    default_checkout_path = "sparse_trunk"

    parser = OptionParser(usage)
    parser.add_option("-r", "--repo_url", type="str", default=default_repo_url, dest="repo_url", help='Repository URL (default: "%s")' % default_repo_url)
    parser.add_option("-l", "--local_path", type="str", default=default_checkout_path, dest="local_path", help='Local checkout path (default: "%s")' % default_checkout_path)

    default_username = getpass.getuser()
    parser.add_option("-u", "--username", type="str", default=default_username, dest="svn_username", help='SVN login username (default: "%s")' % default_username)
    parser.add_option("-p", "--password", type="str", dest="svn_password", help="SVN login password")

    parser.add_option("-v", "--verbose", action="store_true", default=False, dest="verbose", help="Verbose output")
    (options, args) = parser.parse_args()

    client = getSvnClient(options)
    group_sparse_checkout(
        options,
        client,
        options.repo_url,
        map(os.path.relpath, args),
        options.local_path) 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-08T23:30:47.670

或者对 /trunk 进行非递归检出，然后手动更新您需要的 3 个目录。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-12-25T07:30:49.963

如果您已经拥有完整的本地副本，则可以使用`--set-depth`命令删除不需要的子文件夹。

```
svn update --set-depth=exclude www 
```

请参阅：http: [//blogs.collab.net/subversion/sparse-directories-now-with-exclusion](http://blogs.collab.net/subversion/sparse-directories-now-with-exclusion)

该`set-depth`命令支持多条路径。

更新根本地副本不会改变修改文件夹的深度。

要将文件夹恢复为递归检出，您可以`--set-depth`再次使用无限参数。

```
svn update --set-depth=infinity www 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-08T23:33:21.157

有点。正如鲍比所说：

```
svn co file:///.../trunk/foo file:///.../trunk/bar file:///.../trunk/hum 
```

将获得文件夹，但从颠覆的角度来看，您将获得单独的文件夹。您将不得不对每个子文件夹进行单独的提交和更新。

我不相信您可以签出部分树，然后将部分树作为单个实体使用。

* * *

## 回答 #7

> 赞同：-10
> 
> 时间：2008-09-08T23:32:05.997

没有任何特别有用的方式，不。您可以检查子树（如 Bobby Jack 的建议），但随后您将失去自动更新/提交它们的能力；要做到这一点，它们需要被放置在他们的共同父项下，并且一旦您签出共同父项，您就会下载该父项下的所有内容。非递归不是一个好的选择，因为您希望更新和提交是递归的。

# tdd - 应用测试

> ID：50954
> 
> 赞同：3
> 
> 时间：2008-09-08T23:31:08.107
> 
> 标签：tdd

真正`TDD`的好处是应用程序的实际测试，还是编写可测试的应用程序带来的好处？我问是因为我觉得谈话经常围绕着测试，而不是总的福利包。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-08T23:36:38.607

TDD 帮助您设计软件。测试变成了设计。通过首先编写测试，您可以从消费者的角度考虑您的代码，从而使软件设计更加用户友好和紧凑。

此外，通过应用 TDD，您通常最终会以可以提供测试模拟和存根的方式编写代码。这导致软件耦合度降低，随着时间的推移更容易更改和维护。

所以我想围绕 TDD 的讨论大部分都是关于测试的，但是这样做会带来其他很大的好处，例如质量（覆盖）、灵活性（解耦）、更好的设计（作为 API 的消费者思考）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-08T23:37:53.673

真正的改进在于它是一种迫使您真正思考设计和实现的好方法。然后，一旦您准备好测试并编写了代码，未预见问题的解决方案就会更容易出现。

经常发生在我身上的事情是一个很好的类比：当我要向论坛或 IRC 频道发布问题时，我喜欢把问题写得很好并且有充分的描述，很多时候是准备一个写得很好的和对问题的完整描述神奇地使解决方案出现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-08T23:36:44.927

TDD 的真正好处*应该*是它允许您修改/重构/增强您的应用程序，而不必担心您是否破坏了现有功能。编写单元测试往往会导致代码松散耦合和更好的架构这一事实不一定是 TDD 的*重点*，但我认为很难有一个没有另一个。

除非您拥有覆盖良好的单元测试，否则您无法真正体验到 TDD 的好处。为此，您将不得不编写可测试的代码。这就是为什么两者经常结合使用或相互替代的原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T01:44:39.813

当您开发要发布多个版本的产品时，自动化测试可以节省时间并增强信心。通过自动化测试，您知道您没有破坏版本之间的任何内容。当您的产品是人们可以为其编写附加组件时，这尤其有用 - 您不想在版本之间破坏他们的附加组件。

使用 TDD，您可以在开发时获得一套很好的测试。如果没有 TDD，编写这些测试要困难得多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T15:26:45.817

Michael Feathers 有一篇富有洞察力的博客文章，题为[“单元测试背后的缺陷理论”](http://michaelfeathers.typepad.com/michael_feathers_blog/2008/06/the-flawed-theo.html)。说真的，去读吧。妙语是

> 所有这些技术都已被证明可以提高质量。而且，如果我们仔细观察，我们就会明白原因：所有这些都迫使我们反思我们的代码。

但是您应该阅读全文以了解上下文。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-08T23:35:31.683

自动化测试使人类无法完成机器的工作。

测试驱动开发最大化了自动化测试的数量。

当然，超过某个点，仍然需要人类。当您尝试应用 TDD 超出该点时，您会达到收益递减。

# jpeg - 附加到 JPG 的随机数据会使其无法使用吗？

> ID：50965
> 
> 赞同：24
> 
> 时间：2008-09-08T23:39:52.063
> 
> 标签：jpeg, file-format, steganography

因此，为了简化我的生活，我希望能够在我的程序正在处理的一些 jpg 图像的末尾附加 1 到 7 个附加字符*。这些是虚拟填充（填充物等 - 可能都是 0x00），只是为了使文件大小成为 8 字节的倍数以进行块加密。

用一些程序尝试了这一点后，似乎它们对附加字符很好，这些字符出现在[指定图像结尾的 FF D9](http://en.wikipedia.org/wiki/JPEG#Syntax_and_structure)之后- 所以看起来文件格式定义得很好，以至于“损坏”我我在最后添加应该没关系。

如果需要，我总是可以稍后处理文件，但我的偏好是尽可能做最简单的事情 - 让它们保留（我正在解密其他文件类型，他们不会介意，所以有一个特殊情况很烦人）。

我认为，多年前关于[隐写术hullaballo 的讨论，有人在这里有一些意见......](http://en.wikipedia.org/wiki/Steganography)

（8字节块的加密处理，我不想保存预加密的文件大小，所以在输入数据后附加0x00，解码后留在那里）

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-08T23:43:45.627

不，您可以在 jpg 文件的末尾添加位，而不会使其无法使用。jpg 文件的标题告诉如何读取它，因此读取它的程序将在 jpg 数据的末尾停止。

事实上，人们通过将 zip 数据附加到 jpg 数据的末尾来隐藏 jpg 文件中的 zip 文件。由于这些格式的结构方式，生成的文件在任何一种格式下都有效。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-08T23:53:17.007

你可以..但结果*可能*是不可预测的。

尽管格式中有足够的信息告诉客户端忽略额外的数据，但程序员测试的情况可能不是这样。

一个偏执的程序可能会查看大小，注意到差异并决定它不会处理您的文件，因为显然它没有完全理解它。当文件中的随机字节可能被视为安全风险时，从 Web 读取数据时尤其可能出现这种情况。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-09T00:59:10.593

您可以将数据嵌入 JPEG（或 EXIF 或 IPTC 字段）内的 XMP 标记中。XMP 是 XML，因此您可以灵活地处理自己的自定义内容。

这可能不是*最简单的事情*，但将您的数据放在这里将保持 JPEG 的完整性，并且不需要“后期处理”。

然后，您的数据将显示在其他成像软件中，例如 PhotoShop，这可能并不理想。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T03:44:53.050

正如其他人所说，您无法控制程序如何处理图像文件，因此某些程序可能会发现图像有效，而其他程序可能不会。

However, there is a bigger issue here. Judging by your question, I'm deducing you're practicing "security through obscurity." It's widely considered a very bad practice. Use Google to find a plethora of articles about the topic.

# language-agnostic - 有没有实现泛型_well_的语言？

> ID：50983
> 
> 赞同：7
> 
> 时间：2008-09-08T23:58:17.307
> 
> 标签：language-agnostic, generics

[我喜欢泛型差异中](https://stackoverflow.com/questions/31693/differences-in-generics)的讨论，并且想知道是否有任何语言特别好地使用了这个特性。

我真的不喜欢 Java 的一些可以 Liskov 替代的`List<? extends Foo>`东西。为什么不能覆盖？`List``Foo``List<Foo>`

老实说，`Comparable<? super Bar>`？

我也记不起为什么你永远不应该返回泛型数组：

```
public T[] getAll<T>() { ... } 
```

我从不喜欢 C++ 中的模板，但这主要是因为没有一个编译器可以为它们吐出一个远程有意义的错误消息。有一次我实际上做了`make realclean && make`17 次来编译一些东西；我从来没有弄清楚为什么第 17 次是魅力。

那么，谁真正*喜欢*在他们的宠物语言中使用泛型呢？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-09T00:02:12.603

Haskell 很好地实现了类型构造函数参数化（泛型或参数多态）。Scala 也是如此（尽管有时它需要一些帮助）。

这两种语言都有更高种类的类型（又名抽象类型构造函数，或类型构造函数多态性，或高阶多态性）。

见这里：[更高种类的泛型](http://lambda-the-ultimate.org/node/2579)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-09T00:02:43.770

哎呀，英语甚至没有很好地实现泛型。:)

我的偏见是 C#。主要是因为这是我目前正在使用的，并且我已经使用它们取得了良好的效果。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-09T00:36:20.197

我认为Java中的泛型实际上非常好。之所以`List<Foo>`不同，`List<? extends Foo>`是因为 when`Foo`是 的子类型`Bar`，`List<Foo>`不是 的子类型`List<Bar>`。如果您可以将`List<Foo>`对象视为`List<Bar>`，那么您可以向其中添加`Bar`对象，这可能会破坏事物。任何合理的类型系统都需要这个。Java 允许您摆脱将`Foo[]`其视为 的子类型`Bar[]`，但这会强制运行时检查，从而降低性能。当您返回这样一个数组时，这使得编译器很难知道是否进行运行时检查。

我从来不需要使用下限 ( `List<? super Foo>`)，但我想它们可能对返回通用值很有用。请参阅[协变和逆变](http://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science))。

总的来说，我绝对同意关于过于冗长的语法和令人困惑的错误消息的抱怨。像 OCaml 和 Haskell 这样具有类型推断的语言可能会让你更容易做到这一点，尽管它们的错误消息也可能令人困惑。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-09T01:05:33.713

我会将 OCaml 添加到列表中，它具有非常*通用*的泛型。我同意 Haskell 的类型类确实做得很好，但有点不同的是 Haskell 没有 OO 语义，但 OCaml 确实支持 OO。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T00:07:14.197

我使用.Net (VB.Net)，使用泛型没有任何问题。它大多是无痛的。

```
Dim Cars as List(Of Car)
Dim Car as Car

For Each Car in Cars
...
Next 
```

使用泛型集合从来没有遇到过任何问题，尽管我还没有设计任何使用泛型的对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T14:20:00.620

我认为 C# 和 VB.NET 在泛型方面做得很好。

# xml - 在 XML Literals 中使用字符串

> ID：50995
> 
> 赞同：3
> 
> 时间：2008-09-09T00:05:57.587
> 
> 标签：xml, vb.net, xml-literals

我是一名 C# 开发人员，在他自 VB6 以来编写的第一个 VB 代码中摸索，所以如果我问了一个相当明显的问题，请原谅我。

我决定尝试使用 XML Literals 来为我生成一些 XML 代码，而不是使用 XMLDocument

我有 2 个问题，第二个问题是关于解决方法的，因为我无法弄清楚第一个问题。

1：理想的解决方案

我有一个 ElementName 和 ElementValue 的字典，我正在循环它的 KeyValue 对，希望动态生成这些值，但是下面的语法死得很惨

```
Dim xConnections As XElement        
For Each connection As Connection In connections.AsList
    For Each kvp As KeyValuePair(Of String, String) In connection.DecompiledElements
        xConnections = <Connections> <<%= kvp.Key %>><%= kvp.Value %><\<%=kvp.Key %>>  </Connections>
    Next
Next 
```

我对 T4 语法（ <%=%> 语法）能够处理更复杂的操作（而不是直接分配给 <%= ）和“Response.Write”之类的对象来写入输出有模糊的记忆，但是我不记得细节了。

2：笨拙的解决方法

相反，我想构建一个 StringBuilder 对象并将其 .ToString 分配给 XElement，但这也因转换错误而失败。

我更愿意继续在上面的示例 1 中使用我的键值对概念，因为我觉得像上面的示例 2 那样将一个字符串组合在一起是相当讨厌的，我真的应该回到使用 XMLDocument 来代替。

非常感谢任何想法或帮助

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-28T09:09:55.010

VB.NET XML Literals 非常强大，但大多数情况下，向它们添加一些 LINQ 会使它们非常棒。这段代码应该完全符合您的要求。

```
Dim Elements = New Dictionary(Of String, String)
Elements.Add("Key1", "Value1")
Elements.Add("Key2", "Value2")
Elements.Add("Key3", "Value3")

Dim xConnections = <Connections>
                       <%= From elem In Elements _
                           Select <<%= elem.Key %>><%= elem.Value %></> %>
                   </Connections> 
```

空的结束标记`</>`是 vb 编译器正确构造 xml 元素所需的全部内容，该元素的名称是从`<%= %>`块中的值生成的。

调用 xConnections.ToString 会呈现以下内容：

```
<Connections>
    <Key1>Value1</Key1>
    <Key2>Value2</Key2>
    <Key3>Value3</Key3>
</Connections> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T00:44:06.277

如果我正确理解您要执行的操作，则可以使用 StringBuilder。使用 StringBuilder.Append 方法并附加 XmlElement 'OuterXml' 属性。

例如：

sb.Append(xmlElement.OuterXml)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T17:54:58.710

为了更完整地回答这个问题......

将字符串注入 XML Literal 时，除非您在注入 XElement 时使用 XElement.Parse，否则它将无法正常工作（这是因为特殊字符被转义了）

所以你理想的解决方案更像是这样的：

```
Dim conns = connections.AsList()
If conns IsNot Nothing AndAlso conns.length > 0 Then
    Dim index = 0
    Dim xConnections = _
        <Connections>
            <%= From kvp As KeyValuePair(Of String, String) In conns (System.Threading.Interlocked.Increment(index)).DecompiledElements() _
            Select XElement.Parse("<" & <%= kvp.Key %> & ">" & <%= kvp.Value %> & "</" & <%= kvp.Key %> & ">") _
             %>
        </Connections>
    Return xConnections.ToString()
End If 
```

ToString 将正确地作为字符串返回 OuterXML（值不会......）当然，如果你想返回一个 XElement，只需删除 ToString()

由于我不知道 AsList() 做什么，也不知道 DecompiledElements 做什么，因此请相应地设置错误捕获。还有其他方法可以执行循环，这只是一种解决方案。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-09T06:55:36.930

更不用说动态 XML 元素名称通常是个坏主意，我们都会失职。XML 的全部意义在于以一种易于使用的形式创建存储数据结构：

1.  可验证
2.  可扩展

动态元素名称不符合第一个条件。为什么不简单地使用标准 XML 格式来存储诸如 plist 之类的键/值对[呢](http://developer.apple.com/documentation/Cocoa/Conceptual/PropertyLists/Articles/XMLPListsConcept.html)？

```
<dict>
    <key>Author</key>
    <string>William Shakespeare</string>
    <key>Title</key>
    <string>Romeo et</string>
    <key>ISBN</key>
    <string>?????</string>
</dict> 
```********