# StackOverflow 问答 000009000-000009999

# sql-server - 如何让 dbmail 处理 SQL Server 2005 队列中的项目？

> ID：9002
> 
> 赞同：4
> 
> 时间：2008-08-12T15:58:30.723
> 
> 标签：sql-server

当我使用 sp_send_dbmail 存储过程时，我收到一条消息说我的邮件已排队。但是，它似乎永远不会交付。如果我运行以下 SQL，我可以在队列中看到它们：

```
SELECT * FROM msdb..sysmail_allitems WHERE sent_status = 'unsent' 
```

此 SQL 返回 1：

```
SELECT is_broker_enabled FROM sys.databases WHERE name = 'msdb' 
```

此存储过程返回 STARTED：

```
msdb.dbo.sysmail_help_status_sp 
```

已设置适当的帐户和配置文件，并且邮件在某一时刻正常运行。msdb.dbo.sysmail_event_log 中没有错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-12T20:17:14.570

你有没有尝试过

```
sysmail_stop_sp 
```

然后

```
sysmail_start_sp 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-12T14:41:12.410

我遇到了同样的问题，这就是我能够解决的方法。

转到**Sql 代理 >> 属性 >> 警报系统 >> 选中 DBMail 的启用框**并添加一个配置文件。

**重新启动**代理，然后它就可以工作了。

希望这会有所帮助，_Ub

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-13T14:20:56.643

可能是一堆东西。例如，我已经看到（是的，实际看到）这种情况发生在以下情况之后：

*   域控制器重启
*   Exchange 服务器重新启动
*   路由器中断
*   服务帐号更改
*   SQL Server 磁盘空间不足

所以在它再次发生之前，我不会因为它而大惊小怪。

# perl - Perl 三元条件运算符中的赋值问题

> ID：9009
> 
> 赞同：40
> 
> 时间：2008-08-12T16:03:54.893
> 
> 标签：perl, conditional-operator, operator-precedence

我的程序中的这段 Perl 代码给出了错误的结果。

```
$condition ? $a = 2 : $a = 3 ;
print $a; 
```

不管value`$condition`是多少，输出总是3，怎么会？

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-08-12T16:05:34.390

[Perl文档](http://perldoc.perl.org/perlop.html#Conditional-Operator)中对此进行了解释。

由于 Perl 运算符优先级，该语句被解析为

```
($condition ? $a= 2 : $a ) = 3 ; 
```

因为 ?: 运算符产生一个可赋值的结果，所以将 3 赋值给条件的结果。

当 $condition 为真时，这意味着 ($a=2)=3 给出 $a=3

当 $condition 为假时，这意味着 ($a)=3 给出 $a=3

正确的写法是

```
$a = ( $condition ? 2 : 3 );
print $a; 
```

我们在工作中被这个咬了，所以我在这里发帖希望其他人会发现它有用。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-09-05T21:41:11.420

一旦你意识到你可能会遇到优先级问题，一个技巧来弄清楚 Perl 认为你的意思是什么：

```
perl -MO=Deparse,-p -e '$condition ? $a= 2 : $a= 3 ; print $a;' 
```

就您而言，这将向您展示：

```
(($condition ? ($a = 2) : $a) = 3);
print($a);
-e syntax OK 
```

...此时您应该说“哦，这就解释了”！

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-08-22T04:58:03.367

只是为了扩展先前的答案...如果由于某种原因，作业需要成为条件的一部分，那么您需要这样编写它：

```
$condition ? ($a=2) : ($a=3); 
```

如果您根据条件分配给不同的变量，这将很有用。

```
$condition ? ($a=2) : ($b=3); 
```

如果您选择变量，但无论如何分配相同的东西，您甚至可以这样做：

```
($condition ? $a : $b) = 3; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-16T15:43:29.753

由于 Perl 运算符优先级，该语句被解析为：

```
($condition ? $a = 2 : $a ) = 3 ; 
```

因为 ?: 运算符产生一个可赋值的结果，所以将 3 赋值给条件的结果。

当 $condition 为真时，这意味着 $a=2=3 给出 $a=3

当 $condition 为 false 时，这意味着 $a=3 给出 $a=3

正确的写法是

```
$a = $condition ? 2 : 3; 
```

一般来说，您应该真正改掉使用条件来进行赋值的习惯，就像在原始示例中一样——正是这种情况导致 Perl 以只写而闻名。

一个好的经验法则是，条件仅适用于简单值，绝不适用于具有副作用的表达式。当您或其他人需要在八个月后阅读此代码时，您是否希望它像这样阅读？

```
$x < 3 ? foo($x) : bar($y); 
```

还是像这样？

```
if ($x < 3) {
  $foo($x);
} else {
  $bar($y);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-04T12:54:51.383

对以上Tithonium回答的一个建议：

如果您想为同一个变量分配不同的值，这可能会更好（抄本方式）：

$a = ($条件) ? 2：3；

# visual-studio - Windows Mobile 设备模拟器 - 如何永久保存配置？

> ID：9018
> 
> 赞同：1
> 
> 时间：2008-08-12T16:20:58.040
> 
> 标签：visual-studio, windows-mobile, emulation, device

我在一个有代理服务器 ( `HTTP`) 的客户端站点工作。如果我对模拟器进行硬重置，它会忘记模拟器的网络连接设置和托管 Windows Mobile 操作系统中的设置。如果我“保存状态并退出”，它将丢失所有这些设置。我需要定期进行硬重置，这意味着我会丢失这些信息并花费大量时间进行设置：

*   模拟器关联网卡
*   WM OS 中网卡的 DNS 服务器。
*   WM OS 的连接设置中的代理服务器。

我怎样才能让我的生活更轻松？我可以将其保存为模拟器中的默认值，还是轻松创建安装程序？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-08-12T16:23:49.767

这些设备的问题是所有内容都存储在 RAM 和 ROM 中。因此，您需要第二个备用设备存储来存储这些设置，就像真实设备一样。因此，当真实设备或您的设备被重置时，它在 RAM 之外有一个静态存储的配置文件，可以在启动时加载。另一种方法是尽可能进行软重置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-13T02:02:27.727

有一种方法可以以编程方式配置您的设备。如果您使用托管代码，则可以使用 Microsoft.WindowsMo​​bile.Configuration.dll 为您完成大部分工作。如果您使用的是非托管代码，则必须使用 DMProcessConfigXML 本机函数。

[Andrew Arnott](http://web.archive.org/web/20090201134823/http://blogs.msdn.com:80/andrewarnottms/archive/2007/11/29/provisioning-smart-devices-an-introduction.aspx)的这篇博文中有更多详细信息。

# tsql - Sybase (T-SQL) 中 varchar 日期验证的最佳方法？

> ID：9019
> 
> 赞同：2
> 
> 时间：2008-08-12T16:22:14.793
> 
> 标签：tsql, validation, datetime, varchar, sap-ase

我有一个存储过程，它的参数是一个*varchar*，需要将其转换为*日期*时间以供以后使用：

```
SET @the_date = CAST(@date_string AS DATETIME) 
```

我希望日期字符串以“DD-MON-YYYY”格式提供，但为了进行防御性编码，如果由于某种原因无法成功转换，我想默认为系统日期和继续。在 PL/SQL 中，我可以使用异常处理来实现这一点，我也可以使用正则表达式相当容易地做到这一点，但是 Sybase 开箱即用支持的有限模式匹配不允许我这样做，我不能依赖第三方库或扩展。在 T-SQL 中有一种简单的方法吗？

*注意：使用 Sybase ASE 12.5.3，没有 ISDATE 功能*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-12T16:40:18.533

我的天哪，如果问题是关于 Microsoft SQL Server 的，那么我们就一直在做生意！

可悲的是，Sybase 现在是一个完整的“另一个数据库”，大约从 1997 年开始，事实上，大约一年。

如果输入格式必须是“DD-MON-YYYY”并且没有例外，那么我认为在首先做一些简单的事情之后，使用 SUBSTR() 对输入进行切片可以实现相当多的验证，例如检查长度.

我认为最近的 Sybase 版本（例如 SQL Anywhere 11）支持正则表达式，尽管我已经有一段时间没有忍受 T-SQL 了。一些谷歌搜索让我更加怀疑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T17:50:45.193

看来你会被困在自己身上。

您可能可以[以此](http://209.85.141.104/search?q=cache:O_jWxti6FwkJ:www.dbforums.com/archive/index.php/t-959748.html+how+do+I+validate+dates+in+sybase%3F&hl=en&ct=clnk&cd=2&gl=us)为起点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T21:10:00.147

我有一个类似的问题。您可能可以执行以下操作：

```
SET arithabort arith_overflow off
SET @the_date = CAST(@date_string AS DATETIME)
IF @the_date is NULL
    set @the_date = getdate()
SET arithabort arith_overflow on 
```

但是，这在选择中效果不佳。它可以在游标（boo）或 SQL 批处理之前/之后的逻辑中很好地工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-12T17:16:27.233

你不能做这样的事情：

```
SELECT @the_date = CASE @date_string
                      WHEN '[0-9][0-9]-[A-Z][A-Z][A-Z]-[0-9][0-9][0-9][0-9]'
                      THEN CONVERT(datetime, @date_string)
                      ELSE GETDATE()
                   END 
```

?

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T16:25:50.903

在搜索“验证日期字符串 sql”时，在 Google[的第二个结果](http://blog.sqlauthority.com/2007/07/12/sql-server-validate-field-for-date-datatype-using-function-isdate/)中发现了这一点。

```
----Invalid date
SELECT ISDATE('30/2/2007')
RETURNS : 0 (Zero)
----Valid date
SELECT ISDATE('12/12/20007')
RETURNS : 1 (ONE)
----Invalid DataType
SELECT ISDATE('SQL')
RETURNS : 0 (Zero) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-12T16:29:56.947

通过执行确保 SQL Server 知道字符串中的天、月和年的顺序

```
SET DATEFORMAT mdy; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-02T21:25:59.677

你试过`convert`代替`cast`吗？

```
select convert( datetime , @date_string ) 
```

# asp.net - asp.net 页面中的 Html 实体如何？

> ID：9022
> 
> 赞同：7
> 
> 时间：2008-08-12T16:25:18.720
> 
> 标签：asp.net, html, encoding

在 asp.net 页面中，我应该使用

```
<html><title>My page's title from México</title></html> 
```

或者

```
<html><title>My page&rsquo;s title from M&eacute;xico</title></html> 
```

这两个示例具有相同的输出。由于 asp.net 将我所有的页面都编码为 utf-8，所以不需要使用 html 实体，对吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-12T16:28:05.563

第二个示例将确保与 HTML 传输的 ASCII 标准兼容。所以我投票支持第二个示例，因此您不必确保通过所有代理服务器以及可能发生的任何其他类型的缓存和翻译一直输出 HTML 并将其编码为 UTF-8。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-12T16:28:59.460

你是对的；只要管道的两端都有unicode，那真的没关系。就个人而言，我会使用第一个只是因为它更具可读性。

而且，老实说，unicode 已经流行了一段时间。我个人认为，是时候让那些无法处理 UTF-8 的人抛在脑后了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-13T00:37:12.063

ASCII 表是一组字符，可以说是在每个字符只能保留 1 个字节的日子里第一个标准化的字符集。 [http://asciitable.com/](http://asciitable.com/) 但我环顾了一下 ASCII 的扩展字符集，看来您引用的字符是 ASCII 字符。因此，您选择显示标题的方式确实没有问题。

我修改后的答案是根据空间选择更便宜的（即第一个）

# iis - IIS 5.1 中的 HTTPS

> ID：9024
> 
> 赞同：7
> 
> 时间：2008-08-12T16:27:39.510
> 
> 标签：iis, ssl

我`IIS 5.1`在我的开发计算机上使用 Windows XP。我打算在我公司的 Web 服务器上设置 HTTPS，但我想先在本地尝试，然后再在生产系统上进行。

但是当我进入我网站配置部分的目录安全选项卡时，“安全通信”组框被禁用。我需要做些什么来启用这个组框吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-12T16:30:53.310

您可能需要先手动创建证书（在 WinXP 上似乎没有内置机制，因此您需要使用 OpenSSL）。查看这两个链接：

[在 Windows XP Professional 上的 IIS 中启用 SSL](http://www.somacon.com/p41.php)

[在 Windows XP 中为 IIS 启用 SSL (HTTPS)](http://dotnetyuppie.com/2008/04/26/enabling-ssl-https-for-iis-in-windows-xp/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-12T16:31:02.403

那是因为有限的Windows XP 版本下的IIS 5.1 仅限于HTTP。您需要在 Windows 2003 上安装完整版本的 IIS 6.0 才能执行此操作。幸运的是，您可以从 Microsoft 下载 Windows 2003 的 VHD 映像并在 Virtual PC 实例下运行它。另外，我建议您这样做，因为您要小心并使用靠近生产环境的机器。IIS 5.1 版本从未部署为生产机器，因此您无法保证任何事情，并且 IIS 5.1 和 IIS 6.0 之间的差异在 VM 值得您使用的情况下非常重要。

# c# - C#的隐藏特性？

> ID：9033
> 
> 赞同：1473
> 
> 时间：2008-08-12T16:32:24.540
> 
> 标签：c#, hidden-features

[从这个问题](http://www.stackoverflow.com/questions/8941/generic-type-checking)中了解到以下内容后，我想到了这一点：

```
where T : struct 
```

我们，C# 开发人员，都知道 C# 的基础知识。我的意思是声明、条件、循环、运算符等。

我们中的一些人甚至掌握了诸如[泛型](http://msdn.microsoft.com/en-us/library/512aeb7t.aspx)、[匿名类型](http://msdn.microsoft.com/en-us/library/bb397696.aspx)、[lambdas](http://msdn.microsoft.com/en-us/library/bb397687.aspx)、[LINQ](http://msdn.microsoft.com/en-us/library/bb397676.aspx)之类的东西......

但是，即使是 C# 爱好者、爱好者、专家也几乎不知道的 C# 最隐藏的特性或技巧是什么？

# 以下是迄今为止揭示的功能：

## 关键词

*   [`yield`](http://msdn.microsoft.com/en-us/library/9k7k7cf0.aspx)迈克尔·[斯图姆](https://stackoverflow.com/questions/9033/hidden-features-of-c/9035#9035)
*   `var`迈克尔·[斯图姆](https://stackoverflow.com/questions/9033/hidden-features-of-c/9035#9035)
*   `using()`[科科斯](https://stackoverflow.com/questions/9033/hidden-features-of-c/9036#9036)的声明
*   `readonly`通过[kokos](https://stackoverflow.com/questions/9033/hidden-features-of-c/9036#9036)
*   `as`迈克·[斯通](https://stackoverflow.com/questions/9033/hidden-features-of-c/9041#9041)
*   `as`/埃德`is`·[斯旺伦](https://stackoverflow.com/questions/9033/hidden-features-of-c/9070#9070)
*   `as`/ `is`（改进）由[Rocketpants](https://stackoverflow.com/questions/9033/hidden-features-of-c/9092#9092)
*   `default`by[死神](https://stackoverflow.com/questions/9033/hidden-features-of-c/9639#9639)
*   `global::`通过[pzycoman](https://stackoverflow.com/questions/9033/hidden-features-of-c/12152#12152)
*   `using()`[AlexCuse](https://stackoverflow.com/questions/9033/hidden-features-of-c/12316#12316)的积木
*   `volatile`通过[Jakub Šturc](https://stackoverflow.com/questions/9033/hidden-features-of-c/59691#59691)
*   `extern alias`通过[Jakub Šturc](https://stackoverflow.com/questions/9033/hidden-features-of-c/37926#37926)

## 属性

*   [`DefaultValueAttribute`](http://msdn.microsoft.com/en-us/library/system.componentmodel.defaultvalueattribute.aspx)迈克尔·[斯图姆](https://stackoverflow.com/questions/9033/hidden-features-of-c/9035#9035)
*   [`ObsoleteAttribute`](http://msdn.microsoft.com/en-us/library/system.obsoleteattribute.aspx)通过[丹尼蓝精灵](https://stackoverflow.com/questions/9033/hidden-features-of-c/9037#9037)
*   [`DebuggerDisplayAttribute`](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggerdisplayattribute.aspx)通过[斯图](https://stackoverflow.com/questions/9033/hidden-features-of-c/9048#9048)
*   [`DebuggerBrowsable`](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggerbrowsableattribute.aspx)并由[bdukes](https://stackoverflow.com/questions/9033/hidden-features-of-c/33474#33474)[`DebuggerStepThrough`](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggerstepthroughattribute.aspx) _
*   [`ThreadStaticAttribute`](http://msdn.microsoft.com/en-us/library/system.threadstaticattribute(VS.71).aspx)由[马西达](https://stackoverflow.com/questions/9033/hidden-features-of-c/13932#13932)
*   [`FlagsAttribute`](http://msdn.microsoft.com/en-us/library/system.flagsattribute.aspx)通过[马丁克拉克](https://stackoverflow.com/questions/9033/hidden-features-of-c/21752#21752)
*   [`ConditionalAttribute`](http://msdn.microsoft.com/en-us/library/4xssyw96.aspx)通过[安德鲁伯恩斯](https://stackoverflow.com/questions/9033/hidden-features-of-c/35342#35342)

## 句法

*   [`??`](http://msdn.microsoft.com/en-us/library/ms173224.aspx)[kokos](https://stackoverflow.com/questions/9033/hidden-features-of-c/9036#9036)的 (coalesce nulls) 运算符
*   [Nick Berardi](https://stackoverflow.com/questions/9033/hidden-features-of-c/9038#9038)的数字标记
*   `where T:new`由[Lars Mæhlum](https://stackoverflow.com/questions/9033/hidden-features-of-c/9067#9067)
*   [Keith](https://stackoverflow.com/questions/9033/hidden-features-of-c/9099#9099)的隐式泛型
*   [Keith](https://stackoverflow.com/questions/9033/hidden-features-of-c/9099#9099)的单参数 lambda
*   [基思](https://stackoverflow.com/questions/9033/hidden-features-of-c/9099#9099)的汽车属性
*   [Keith](https://stackoverflow.com/questions/9033/hidden-features-of-c/9099#9099)的命名空间别名
*   带有@的逐字字符串文字，[Patrick](https://stackoverflow.com/questions/9033/hidden-features-of-c/9114#9114)
*   `enum`[lfoust](https://stackoverflow.com/questions/9033/hidden-features-of-c/11738#11738)的价值观
*   @variablenames by [marxidad](https://stackoverflow.com/questions/9033/hidden-features-of-c/14088#14088)
*   `event`[marxidad](https://stackoverflow.com/questions/9033/hidden-features-of-c/14277#14277)的运算符
*   [Portman](https://stackoverflow.com/questions/9033/hidden-features-of-c/15321#15321)格式化字符串括号
*   [xanadont](https://stackoverflow.com/questions/9033/hidden-features-of-c/15715#15715)的属性访问器可访问性修饰符
*   [JasonS](https://stackoverflow.com/questions/9033/hidden-features-of-c/16450#16450)的条件（三元）运算符 ( `?:`)
*   `checked`和`unchecked`操作员[Binoj Antony](https://stackoverflow.com/questions/9033/hidden-features-of-c/355991#355991)
*   `implicit and explicit`[Flory](https://stackoverflow.com/questions/9033/hidden-features-of-c/121470#121470)的运算符

## 语言特点

*   [Brad Barker](https://stackoverflow.com/questions/9033/hidden-features-of-c/9055#9055)的可空类型
*   [Keith](https://stackoverflow.com/questions/9033/hidden-features-of-c/9099#9099)的匿名类型
*   `__makeref __reftype __refvalue`犹大·[希曼戈](https://stackoverflow.com/questions/9033/hidden-features-of-c/9125#9125)
*   [lomaxx](https://stackoverflow.com/questions/9033/hidden-features-of-c/9547#9547)的对象初始化器
*   [大卫在达科他州](https://stackoverflow.com/questions/9033/hidden-features-of-c/10207#10207)格式化字符串
*   [marxidad](https://stackoverflow.com/questions/9033/hidden-features-of-c/13932#13932)的扩展方法
*   `partial`[乔恩·埃里克森](https://stackoverflow.com/questions/9033/hidden-features-of-c/16395#16395)的方法
*   [John Asbeck](https://stackoverflow.com/questions/9033/hidden-features-of-c/16482#16482)的预处理器指令
*   `DEBUG`[Robert Durgin](https://stackoverflow.com/questions/9033/hidden-features-of-c/29081#29081)的预处理器指令
*   [SefBkn](https://stackoverflow.com/questions/9033/hidden-features-of-c/24914#24914)的运算符重载
*   [通过chakrit](https://stackoverflow.com/questions/9033/hidden-features-of-c/28811#28811)进行类型推断
*   [Rob Gough](https://stackoverflow.com/questions/9033/hidden-features-of-c/32148#32148)将布尔运算符提升到一个新的[水平](http://www.java2s.com/Tutorial/CSharp/0160__Operator-Overload/truefalseoperatorforComplex.htm)
*   将值类型变量作为接口传递而不由[Roman Boiko装箱](https://stackoverflow.com/questions/9033/hidden-features-of-c/1820538#1820538)
*   [Roman Boiko](https://stackoverflow.com/questions/9033/hidden-features-of-c/1789985#1789985)以编程方式确定声明的变量类型
*   [Chris](https://stackoverflow.com/questions/9033/hidden-features-of-c/100321#100321)的静态构造函数
*   使用 LINQ 的[roosteronacid更容易上手/浓缩的 ORM 映射](https://stackoverflow.com/questions/9033/hidden-features-of-c/2026781#2026781)
*   `__arglist`扎克[保龄球](https://stackoverflow.com/a/1836944/171819)

## Visual Studio 功能

*   [Himadri](https://stackoverflow.com/questions/9033/hidden-features-of-c/1699477#1699477 "block text selecting with alt key")在编辑器中选择文本块
*   DannySmurf 的[片段](https://stackoverflow.com/questions/9033/hidden-features-of-c/9037#9037)

## 框架

*   `TransactionScope`通过[KiwiBastard](https://stackoverflow.com/questions/9033/hidden-features-of-c/9042#9042)
*   `DependantTransaction`通过[KiwiBastard](https://stackoverflow.com/questions/9033/hidden-features-of-c/9042#9042)
*   `Nullable<T>`由[IainMH](https://stackoverflow.com/questions/9033/hidden-features-of-c/9118#9118)
*   `Mutex`由[迪亚哥](https://stackoverflow.com/questions/9033/hidden-features-of-c/9181#9181)
*   `System.IO.Path`作者：[ageektrapped](https://stackoverflow.com/questions/9033/hidden-features-of-c/9401#9401)
*   `WeakReference`胡安·[曼努埃尔](https://stackoverflow.com/questions/9033/hidden-features-of-c/14723#14723)

## 方法和属性

*   `String.IsNullOrEmpty()`[KiwiBastard](https://stackoverflow.com/questions/9033/hidden-features-of-c/9042#9042)的方法
*   `List.ForEach()`[KiwiBastard](https://stackoverflow.com/questions/9033/hidden-features-of-c/9042#9042)的方法
*   `BeginInvoke()`, [Will Dean](https://stackoverflow.com/questions/9033/hidden-features-of-c/9581#9581)`EndInvoke()`的方法
*   `Nullable<T>.HasValue`和[Rismo](https://stackoverflow.com/questions/9033/hidden-features-of-c/15393#15393)`Nullable<T>.Value`的属性
*   `GetValueOrDefault`[约翰·希恩](https://stackoverflow.com/questions/9033/hidden-features-of-c/18158#18158)的方法

## 提示与技巧

*   [Andreas HR Nilsson](https://stackoverflow.com/questions/9033/hidden-features-of-c/9282#9282)的事件处理程序的好方法
*   [约翰](https://stackoverflow.com/questions/9033/hidden-features-of-c/12137#12137)的大写比较
*   [不通过dp](https://stackoverflow.com/questions/9033/hidden-features-of-c/13441#13441)反射访问匿名类型
*   [Will](https://stackoverflow.com/questions/9033/hidden-features-of-c/58945#58945)懒惰地实例化集合属性的快速方法
*   [roosteronacid](https://stackoverflow.com/questions/9033/hidden-features-of-c/1399130#1399130)的类似 JavaScript 的匿名内联函数

## 其他

*   kokos 的[网络模块](https://stackoverflow.com/questions/9033/hidden-features-of-c/9036#9036)
*   [Duncan Smart](https://stackoverflow.com/questions/9033/hidden-features-of-c/10886#10886)的[LINQBridge](http://www.albahari.com/nutshell/linqbridge.html)
*   [Joel Coehoorn](https://stackoverflow.com/questions/9033/hidden-features-of-c/31293#31293)的[并行扩展](http://msdn.microsoft.com/en-us/concurrency/default.aspx)

* * *

## 回答 #1

> 赞同：751
> 
> 时间：2008-08-13T01:53:50.460

这本身不是 C#，但我还没有看到任何人真正使用`System.IO.Path.Combine()`到他们应该使用的程度。其实整个 Path 类真的很有用，只是**没人用！**

我敢打赌，每个生产应用程序都有以下代码，即使它不应该：

```
string path = dir + "\\" + fileName; 
```

* * *

## 回答 #2

> 赞同：583
> 
> 时间：2008-08-26T18:34:44.433

**lambdas and type inference** are underrated. **Lambdas can have multiple statements** and they **double as a compatible delegate object** automatically (just make sure the signature match) as in:

```
Console.CancelKeyPress +=
    (sender, e) => {
        Console.WriteLine("CTRL+C detected!\n");
        e.Cancel = true;
    }; 
```

Note that I don't have a `new CancellationEventHandler` nor do I have to specify types of `sender` and `e`, they're inferable from the event. Which is why this is less cumbersome to writing the whole `delegate (blah blah)` which also requires you to specify types of parameters.

**Lambdas don't need to return anything** and type inference is extremely powerful in context like this.

And BTW, you can always return **Lambdas that make Lambdas** in the functional programming sense. For example, here's a lambda that makes a lambda that handles a Button.Click event:

```
Func<int, int, EventHandler> makeHandler =
    (dx, dy) => (sender, e) => {
        var btn = (Button) sender;
        btn.Top += dy;
        btn.Left += dx;
    };

btnUp.Click += makeHandler(0, -1);
btnDown.Click += makeHandler(0, 1);
btnLeft.Click += makeHandler(-1, 0);
btnRight.Click += makeHandler(1, 0); 
```

Note the chaining: `(dx, dy) => (sender, e) =>`

Now that's why I'm happy to have taken the functional programming class :-)

Other than the pointers in C, I think it's the other fundamental thing you should learn :-)

* * *

## 回答 #3

> 赞同：527
> 
> 时间：2008-08-19T05:43:53.457

从[里克斯特拉尔](http://www.west-wind.com/weblog/posts/236298.aspx)：

可以连环吗？？运算符，以便您可以进行一堆空值比较。

```
string result = value1 ?? value2 ?? value3 ?? String.Empty; 
```

* * *

## 回答 #4

> 赞同：453
> 
> 时间：2008-09-16T16:53:37.230

别名泛型：

```
using ASimpleName = Dictionary<string, Dictionary<string, List<string>>>; 
```

它允许您使用`ASimpleName`, 而不是`Dictionary<string, Dictionary<string, List<string>>>`.

当您在很多地方使用相同的通用大长复杂事物时使用它。

* * *

## 回答 #5

> 赞同：437
> 
> 时间：2008-08-15T11:06:48.747

> 从[CLR 通过 C#](https://rads.stackoverflow.com/amzn/click/com/0735621632)：
> 
> 在规范化字符串时，强烈建议您使用 ToUpperInvariant 而不是 ToLowerInvariant，因为**Microsoft 已经优化了执行大写比较的代码**。

我记得有一次我的同事在比较之前总是将字符串更改为大写。我一直想知道他为什么这样做，因为我觉得先转换为小写更“自然”。现在读完这本书，我知道为什么了。

* * *

## 回答 #6

> 赞同：407
> 
> 时间：2008-09-12T13:25:55.610

我最喜欢的技巧是使用[空合并运算符](http://en.wikipedia.org/wiki/%3F%3F_Operator)和括号为我自动实例化集合。

```
private IList<Foo> _foo;

public IList<Foo> ListOfFoo 
    { get { return _foo ?? (_foo = new List<Foo>()); } } 
```

* * *

## 回答 #7

> 赞同：314
> 
> 时间：2008-08-12T21:57:39.267

**避免检查空事件处理程序**

在声明时向事件添加一个空委托，无需在调用之前始终检查事件是否为空，这很棒。例子：

```
public delegate void MyClickHandler(object sender, string myValue);
public event MyClickHandler Click = delegate {}; // add empty delegate! 
```

让你这样做

```
public void DoSomething()
{
    Click(this, "foo");
} 
```

而不是这个

```
public void DoSomething()
{
    // Unnecessary!
    MyClickHandler click = Click;
    if (click != null) // Unnecessary! 
    {
        click(this, "foo");
    }
} 
```

另请参阅此[相关讨论](https://stackoverflow.com/questions/840715/the-proper-way-of-raising-events-in-the-net-framework)和Eric Lippert 关于此主题的[博客文章](http://blogs.msdn.com/ericlippert/archive/2009/04/29/events-and-races.aspx)（以及可能的缺点）。

* * *

## 回答 #8

> 赞同：304
> 
> 时间：2008-08-12T18:23:40.587

其他一切，加上

1）隐式泛型（为什么只在方法上而不是在类上？）

```
void GenericMethod<T>( T input ) { ... }

//Infer type, so
GenericMethod<int>(23); //You don't need the <>.
GenericMethod(23);      //Is enough. 
```

2) 带有一个参数的简单 lambda：

```
x => x.ToString() //simplify so many calls 
```

3) 匿名类型和初始化器：

```
//Duck-typed: works with any .Add method.
var colours = new Dictionary<string, string> {
    { "red", "#ff0000" },
    { "green", "#00ff00" },
    { "blue", "#0000ff" }
};

int[] arrayOfInt = { 1, 2, 3, 4, 5 }; 
```

* * *

另一个：

4）自动属性可以有不同的范围：

```
public int MyId { get; private set; } 
```

* * *

感谢@pzycoman 提醒我：

5）命名空间别名（不是你可能需要这种特殊的区别）：

```
using web = System.Web.UI.WebControls;
using win = System.Windows.Forms;

web::Control aWebControl = new web::Control();
win::Control aFormControl = new win::Control(); 
```

* * *

## 回答 #9

> 赞同：285
> 
> 时间：2008-08-12T16:42:04.113

我有一段时间不知道“as”关键字。

```
MyClass myObject = (MyClass) obj; 
```

对比

```
MyClass myObject = obj as MyClass; 
```

如果 obj 不是 MyClass，则第二个将返回 null，而不是抛出类转换异常。

* * *

## 回答 #10

> 赞同：261
> 
> 时间：2008-08-13T07:39:13.493

我喜欢的两件事是自动属性，因此您可以进一步折叠代码：

```
private string _name;
public string Name
{
    get
    {
        return _name;
    }
    set
    {
        _name = value;
    }
} 
```

变成

```
public string Name { get; set;} 
```

还有对象初始化器：

```
Employee emp = new Employee();
emp.Name = "John Smith";
emp.StartDate = DateTime.Now(); 
```

变成

```
Employee emp = new Employee {Name="John Smith", StartDate=DateTime.Now()} 
```

* * *

## 回答 #11

> 赞同：254
> 
> 时间：2008-08-13T10:20:07.147

泛型类型中的“默认”关键字：

```
T t = default(T); 
```

如果 T 是引用类型，则结果为“null”，如果是 int，则为 0，如果是布尔型，则为 false，等等。

* * *

## 回答 #12

> 赞同：225
> 
> 时间：2008-08-12T16:59:40.460

一般属性，但最重要的是[DebuggerDisplay](http://msdn.microsoft.com/en-us/library/x810d419.aspx)。为您节省数年。

* * *

## 回答 #13

> 赞同：220
> 
> 时间：2008-08-13T02:07:26.267

> @ 告诉编译器忽略字符串中的任何转义字符。

只是想澄清这一点......它并没有告诉它忽略转义字符，它实际上告诉编译器将字符串解释为文字。

如果你有

```
string s = @"cat
             dog
             fish" 
```

它实际上会打印出来（注意它甚至包括用于缩进的空格）：

```
cat
             dog
             fish 
```

* * *

## 回答 #14

> 赞同：219
> 
> 时间：2008-09-09T21:52:00.237

我认为 C# (.NET 3.5) 中最被低估和鲜为人知的特性之一是[Expression Trees](http://msdn.microsoft.com/en-us/library/bb397951.aspx)，**尤其是**与泛型和 Lambda 结合使用时。这是 NInject 和 Moq 等较新的库正在使用的 API 创建方法。

例如，假设我想向 API 注册一个方法，并且该 API 需要获取方法名称

给定这个类：

```
public class MyClass
{
     public void SomeMethod() { /* Do Something */ }
} 
```

以前，开发人员使用字符串和类型（或其他主要基于字符串的东西）执行此操作是很常见的：

```
RegisterMethod(typeof(MyClass), "SomeMethod"); 
```

好吧，这很糟糕，因为缺乏强类型。如果我重命名“SomeMethod”怎么办？现在，在 3.5 中，我可以以强类型的方式执行此操作：

```
RegisterMethod<MyClass>(cl => cl.SomeMethod()); 
```

RegisterMethod 类在其中使用`Expression<Action<T>>`如下：

```
void RegisterMethod<T>(Expression<Action<T>> action) where T : class
{
    var expression = (action.Body as MethodCallExpression);

    if (expression != null)
    {
        // TODO: Register method
        Console.WriteLine(expression.Method.Name);
    }
} 
```

这是我现在爱上 Lambda 和表达式树的一个重要原因。

* * *

## 回答 #15

> 赞同：208
> 
> 时间：2008-08-12T16:34:44.970

“[产量](http://msdn.microsoft.com/en-us/library/9k7k7cf0(VS.80).aspx)”会出现在我的脑海中。[[DefaultValue()]](http://msdn.microsoft.com/en-us/library/system.componentmodel.defaultvalueattribute.aspx)等一些属性也是我的最爱。

“ [var](http://msdn.microsoft.com/en-us/library/bb383973.aspx) ”关键字比较知名，但您也可以在 .NET 2.0 应用程序中使用它（只要您[使用 .NET 3.5 编译器](http://blogs.msdn.com/msbuild/archive/2006/11/03/msbuild-orcas-and-multi-targeting.aspx)并将其设置为输出 2.0 代码）似乎不太为人所知出色地。

编辑：kokos，感谢您指出 ?? 运营商，确实很有用。由于搜索它有点困难（因为 ?? 只是被忽略了），这里是该运算符的 MSDN 文档页面：*[?? 运算符（C# 参考）](http://msdn.microsoft.com/en-us/library/ms173224.aspx)*

* * *

## 回答 #16

> 赞同：197
> 
> 时间：2008-08-12T17:07:59.350

我倾向于发现大多数 C# 开发人员不知道“可为空”类型。基本上，可以具有空值的原语。

```
double? num1 = null; 
double num2 = num1 ?? -100; 
```

将可空的双*精度数 num1*设置为空，然后将常规双*精度数 num2*设置为*num1*或*-100* （如果*num1*为空）。

[http://msdn.microsoft.com/en-us/library/1t3y8s4s(VS.80).aspx](http://msdn.microsoft.com/en-us/library/1t3y8s4s(VS.80).aspx)

关于 Nullable 类型的另一件事：

```
DateTime? tmp = new DateTime();
tmp = null;
return tmp.ToString(); 
```

它是返回 String.Empty。检查[此](https://stackoverflow.com/questions/4547112/is-nullable-datetime-work-correct)链接以获取更多详细信息

* * *

## 回答 #17

> 赞同：192
> 
> 时间：2008-08-12T18:50:29.720

以下是一些有趣的隐藏 C# 功能，以未记录的 C# 关键字的形式：

```
__makeref

__reftype

__refvalue

__arglist 
```

这些是未记录的 C# 关键字（甚至 Visual Studio 也能识别它们！），它们被添加到泛型之前用于更有效的装箱/拆箱。它们与 System.TypedReference 结构协同工作。

还有 __arglist，用于可变长度参数列表。

人们不太了解的一件事是[System.WeakReference](http://msdn.microsoft.com/en-us/library/ms404247.aspx) - 一个非常有用的类，它跟踪对象但仍允许垃圾收集器收集它。

最有用的“隐藏”功能是 yield return 关键字。它并不是真正隐藏的，但很多人并不知道它。LINQ 建立在此之上；它允许通过在后台生成状态机来延迟执行查询。Raymond Chen 最近发布了关于[内部、坚韧不拔的细节](http://blogs.msdn.com/oldnewthing/archive/2008/08/12/8849519.aspx)。

* * *

## 回答 #18

> 赞同：184
> 
> 时间：2008-09-23T20:39:01.003

**纯粹、安全的 C# 中的联合（C++ 共享内存类型）**

在不使用不安全模式和指针的情况下，您可以让类成员在类/结构中共享内存空间。给定以下课程：

```
[StructLayout(LayoutKind.Explicit)]
public class A
{
    [FieldOffset(0)]
    public byte One;

    [FieldOffset(1)]
    public byte Two;

    [FieldOffset(2)]
    public byte Three;

    [FieldOffset(3)]
    public byte Four;

    [FieldOffset(0)]
    public int Int32;
} 
```

您可以通过操作 Int32 字段来修改字节字段的值，反之亦然。例如，这个程序：

```
 static void Main(string[] args)
    {
        A a = new A { Int32 = int.MaxValue };

        Console.WriteLine(a.Int32);
        Console.WriteLine("{0:X} {1:X} {2:X} {3:X}", a.One, a.Two, a.Three, a.Four);

        a.Four = 0;
        a.Three = 0;
        Console.WriteLine(a.Int32);
    } 
```

输出这个：

```
2147483647
FF FF FF 7F
65535 
```

只需使用 System.Runtime.InteropServices 添加；

* * *

## 回答 #19

> 赞同：175
> 
> 时间：2008-08-18T01:45:02.193

使用 @ 作为关键字的变量名称。

```
var @object = new object();
var @string = "";
var @if = IpsoFacto(); 
```

* * *

## 回答 #20

> 赞同：167
> 
> 时间：2008-10-13T22:25:51.980

如果您想退出程序而不调用任何 finally 块或终结器，请使用[FailFast](http://msdn.microsoft.com/en-us/library/ms131100.aspx)：

```
Environment.FailFast() 
```

* * *

## 回答 #21

> 赞同：153
> 
> 时间：2008-08-17T01:01:28.397

Returning anonymous types from a method and accessing members without reflection.

```
// Useful? probably not.
private void foo()
{
    var user = AnonCast(GetUserTuple(), new { Name = default(string), Badges = default(int) });
    Console.WriteLine("Name: {0} Badges: {1}", user.Name, user.Badges);
}

object GetUserTuple()
{
    return new { Name = "dp", Badges = 5 };
}    

// Using the magic of Type Inference...
static T AnonCast<T>(object obj, T t)
{
   return (T) obj;
} 
```

* * *

## 回答 #22

> 赞同：146
> 
> 时间：2008-08-12T18:38:16.157

这是一个对正则表达式和文件路径有用的：

```
"c:\\program files\\oldway"
@"c:\program file\newway" 
```

@ 告诉编译器忽略字符串中的任何转义字符。

* * *

## 回答 #23

> 赞同：141
> 
> 时间：2008-10-26T19:04:33.183

混合。基本上，如果你想为几个类添加一个特性，但不能为所有类使用一个基类，让每个类实现一个接口（没有成员）。**然后，为接口**编写一个扩展方法，即

```
public static DeepCopy(this IPrototype p) { ... } 
```

当然，牺牲了一些清晰度。但它有效！

* * *

## 回答 #24

> 赞同：130
> 
> 时间：2008-08-12T18:53:44.333

> 不知道为什么有人会想要使用 Nullable<bool> 。:-)

对，错，[文件未找到](http://thedailywtf.com/Articles/What_Is_Truth_0x3f_.aspx)？

* * *

## 回答 #25

> 赞同：116
> 
> 时间：2008-08-16T23:55:28.373

This one is not "hidden" so much as it is misnamed.

A lot of attention is paid to the algorithms "map", "reduce", and "filter". What most people don't realize is that .NET 3.5 added all three of these algorithms, but it gave them very SQL-ish names, based on the fact that they're part of LINQ.

> "map" => Select
> Transforms data from one form into another
> 
> "reduce" => Aggregate
> Aggregates values into a single result
> 
> "filter" => Where
> Filters data based on a criteria

The ability to use LINQ to do inline work on collections that used to take iteration and conditionals can be incredibly valuable. It's worth learning how all the LINQ extension methods can help make your code much more compact and maintainable.

* * *

## 回答 #26

> 赞同：115
> 
> 时间：2008-09-01T00:03:41.560

```
Environment.NewLine 
```

对于系统独立的换行符。

* * *

## 回答 #27

> 赞同：111
> 
> 时间：2008-08-18T22:29:45.020

如果您尝试在 String.Format 表达式中使用大括号...

```
int foo = 3;
string bar = "blind mice";
String.Format("{{I am in brackets!}} {0} {1}", foo, bar);
//Outputs "{I am in brackets!} 3 blind mice" 
```

* * *

## 回答 #28

> 赞同：104
> 
> 时间：2008-08-12T16:35:55.703

1.  [??](http://msdn.microsoft.com/en-us/library/ms173224.aspx) - 合并运算符
2.  using ( [statement](http://msdn.microsoft.com/en-us/library/yh598w02(VS.80).aspx) / [directive](http://msdn.microsoft.com/en-us/library/sf0df423(VS.71).aspx) ) - 很棒的关键字，不仅可以用于调用 Dispose
3.  [只读](http://msdn.microsoft.com/en-us/library/acdd6hb7(VS.100).aspx)- 应该更多地使用
4.  netmodules - 太糟糕了，Visual Studio 不支持

* * *

## 回答 #29

> 赞同：103
> 
> 时间：2008-08-12T18:03:12.203

@Ed，我对发布这个有点沉默，因为它只不过是吹毛求疵。但是，我会在您的代码示例中指出：

```
MyClass c;
  if (obj is MyClass)
    c = obj as MyClass 
```

如果您要使用“is”，为什么要使用“as”进行安全转换？如果您确定 obj 确实是 MyClass，这是一个沼泽标准演员表：

```
c = (MyClass)obj 
```

......永远不会失败。

同样，你可以说：

```
MyClass c = obj as MyClass;
if(c != null)
{
   ...
} 
```

我对 .NET 的内部结构了解得不够多，无法确定，但我的直觉告诉我，这会将最多两种类型转换操作减少到最多一种。无论哪种方式，都不太可能破坏处理银行；就个人而言，我认为后一种形式看起来也更干净。

* * *

## 回答 #30

> 赞同：98
> 
> 时间：2008-08-19T15:54:52.677

也许不是一种先进的技术，但我一直看到的一种让我发疯的技术：

```
if (x == 1)
{
   x = 2;
}
else
{
   x = 3;
} 
```

可以浓缩为：

```
x = (x==1) ? 2 : 3; 
```

* * *

## 回答 #31

> 赞同：94
> 
> 时间：2009-04-15T00:23:53.073

许多人没有意识到他们可以使用：OrdinalIgnoreCase 来比较字符串，而不必执行 someString.ToUpper()。这消除了额外的字符串分配开销。

```
if( myString.ToUpper() == theirString.ToUpper() ){ ... } 
```

变成

```
if( myString.Equals( theirString, StringComparison.OrdinalIgnoreCase ) ){ ... } 
```

* * *

## 回答 #32

> 赞同：79
> 
> 时间：2008-10-17T16:41:51.873

刚刚了解到，匿名类型可以从变量名中推断出属性名：

```
string hello = "world";
var o = new { hello };
Console.WriteLine(o.hello); 
```

* * *

## 回答 #33

> 赞同：75
> 
> 时间：2008-08-12T16:38:50.703

老实说，根据定义，专家应该知道这些东西。但要回答您的问题：*[内置类型表（C# 参考）](http://msdn.microsoft.com/en-us/library/ya5y69ds.aspx)*

数字的编译器标记因以下原因而广为人知：

```
Decimal = M
Float = F
Double = D

// for example
double d = 30D; 
```

然而，这些更模糊：

```
Long = L
Unsigned Long = UL
Unsigned Int = U 
```

* * *

## 回答 #34

> 赞同：75
> 
> 时间：2008-08-28T20:59:59.060

I like looking up stuff in a list like:-

```
bool basketContainsFruit(string fruit) {
  return new[] { "apple", "orange", "banana", "pear" }.Contains(fruit);
} 
```

Rather than:-

```
bool basketContainsFruit(string fruit) {
  return fruit == "apple" || fruit == "orange" || fruit == "banana" ||
    fruit == "pear";
} 
```

Doesn't come up that much in practice, but the idea of matching items against the subject of the search can be really quite useful + succinct.

* * *

## 回答 #35

> 赞同：73
> 
> 时间：2008-09-05T16:10:21.047

**[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)**属性并不为人所知，但在某些情况下可以派上用场。它基本上允许另一个程序集能够访问定义程序集的“内部”元素。

* * *

## 回答 #36

> 赞同：72
> 
> 时间：2010-06-22T03:59:04.763

下面是 C# 4.0 中字符串类的一个新方法：

```
String.IsNullOrWhiteSpace(String value) 
```

是时候了。

* * *

## 回答 #37

> 赞同：70
> 
> 时间：2008-10-06T15:30:27.870

[我在使用ReSharper](http://www.jetbrains.com/resharper/)时选择了这个：

隐式方法组转换

```
//If given this:
var myStrings = new List<string>(){"abc","def","xyz"};
//Then this:
myStrings.ForEach(s => Console.WriteLine(s));
//Is equivalent to this:
myStrings.ForEach(Console.WriteLine); 
```

有关更多信息，请参阅“ [C# 中的隐式方法组转换](http://blog.opennetcf.com/ncowburn/2007/03/23/ImplicitMethodGroupConversionInC.aspx)”。

* * *

## 回答 #38

> 赞同：68
> 
> 时间：2008-08-12T16:45:22.813

*   System.Transactions 中的TransactionScope 和[DependentTransaction](http://msdn.microsoft.com/en-us/library/system.transactions.dependenttransaction.aspx)是在 .NET 中使用事务处理的轻量级方式 - 它也不仅仅适用于[数据库事务](http://msdn.microsoft.com/en-us/library/ms229973.aspx)
*   String.IsNullOrEmpty 是一个令我惊讶的是很多开发人员都不知道
*   List.ForEach - 使用委托方法遍历您的通用列表

还有更多，但那是我头顶上最明显的三个……

* * *

## 回答 #39

> 赞同：68
> 
> 时间：2010-06-22T19:22:03.763

调试时，您可以`$exception`在 Watch\QuickWatch\Immediate 窗口中键入并获取有关当前帧异常的所有信息。如果您打开了第一次机会异常，这将非常有用！

* * *

## 回答 #40

> 赞同：66
> 
> 时间：2008-09-19T20:02:05.340

Dictionary.TryGetValue(K key, out V value)

用作支票和入场券。而不是;

```
if(dictionary.ContainsKey(key)) 
{
    value = dictionary[key];
    ...
} 
```

你可以这样做；

```
if(dictionary.TryGetValue(key, out value)) 
{ ... } 
```

并且值已设置。

* * *

## 回答 #41

> 赞同：65
> 
> 时间：2009-08-05T05:57:55.170

[条件字符串](http://msdn.microsoft.com/en-us/library/0c899ak8.aspx#SectionSeparator)。格式：

根据数字是正数、负数还是零，对数字应用不同的格式。

```
string s = string.Format("{0:positive;negative;zero}", i); 
```

例如

```
string format = "000;-#;(0)";

string pos = 1.ToString(format);     // 001
string neg = (-1).ToString(format);  // -1
string zer = 0.ToString(format);     // (0) 
```

* * *

## 回答 #42

> 赞同：64
> 
> 时间：2008-08-18T07:33:17.560

事件实际上是引擎盖下的委托，任何委托对象都可以附加多个函数，并分别使用 += 和 -= 运算符与其分离。

事件也可以通过添加/删除来控制，类似于 get/set，除了在使用 += 和 -= 时调用它们：

```
public event EventHandler SelectiveEvent(object sender, EventArgs args) 
  { add 
     { if (value.Target == null) throw new Exception("No static handlers!");
       _SelectiveEvent += value;
     }
    remove
     { _SelectiveEvent -= value;
     }
  } EventHandler _SelectiveEvent; 
```

* * *

## 回答 #43

> 赞同：61
> 
> 时间：2008-09-18T02:33:51.023

不要忘记**[goto](http://msdn.microsoft.com/en-us/library/13940fs2(VS.71).aspx)**。

* * *

## 回答 #44

> 赞同：56
> 
> 时间：2008-10-18T11:54:28.583

更多的是运行时功能，但我最近了解到有两个垃圾收集器。工作站 gc 和服务器 gc。工作站是 Windows 客户端版本的默认设置，但服务器在多核机器上要快得多。

```
 <configuration>
   <runtime>
      <gcServer enabled="true"/>
   </runtime>
</configuration> 
```

当心。服务器 gc 需要更多内存。

* * *

## 回答 #45

> 赞同：55
> 
> 时间：2008-09-15T14:58:26.657

我在上面看不到这个——直到最近我才意识到你可以做的一个是从另一个构造函数调用一个构造函数：

```
class Example
{
    public Example(int value1)
        : this(value1, "Default Value")
    {
    }

    public Example(int value1, string value2)
    {
        m_Value1 = value1;
        m_value2 = value2;
    }

    int m_Value1;
    string m_value2;
} 
```

* * *

## 回答 #46

> 赞同：55
> 
> 时间：2008-12-10T13:11:49.433

其他未充分使用的运算符是`checked`and `unchecked`：

```
short x = 32767;   // 32767 is the max value for short
short y = 32767;
int z1 =  checked((short)(x + y));   //will throw an OverflowException
int z2 =  unchecked((short)(x + y)); // will return -2
int z3 =  (short)(x + y);            // will return -2 
```

* * *

## 回答 #47

> 赞同：55
> 
> 时间：2009-06-16T17:14:06.730

**使用“投掷”；而不是“扔前;” 保留堆栈跟踪**

如果在不添加其他信息的情况下重新抛出异常，请使用“throw”而不是“throw ex”。catch 块中的空“throw”语句将发出特定的 IL，该 IL 会在保留原始堆栈跟踪的同时重新引发异常。“throw ex”丢失了异常原始源的堆栈跟踪。

* * *

## 回答 #48

> 赞同：48
> 
> 时间：2008-09-26T15:28:11.950

我遇到的一些隐藏功能：

*   `stackalloc`这使您可以在堆栈上分配数组
*   没有显式参数列表的匿名方法，可以隐式转换为任何具有非 out/ref 参数的委托类型（对于事件非常方便，如前面的评论中所述）
*   很多人不知道真正的事件是什么（添加/删除一对方法，例如属性的 get/set）；C# 中的类字段事件确实声明了一个变量*和*一个事件
*   `==`and`!=`运算符可以重载以返回除 之外的类型`bool`。奇怪但真实。
*   C# 3 中的查询表达式翻译在某些方面确实“简单”——这意味着您可以让它做一些[非常奇怪的事情](http://msmvps.com/blogs/jon_skeet/archive/2008/02/29/odd-query-expressions.aspx)。
*   可空类型具有特殊的装箱行为：空值被装箱到空引用，并且您也可以从空拆箱到可空类型。

* * *

## 回答 #49

> 赞同：48
> 
> 时间：2009-11-09T06:58:35.877

我只是想复制没有注释的代码。所以，诀窍是简单地按下 Alt 按钮，然后突出显示您喜欢的矩形。（例如下面）。

```
protected void GridView1_RowCommand(object sender, GridViewCommandEventArgs e)
    {
        //if (e.CommandName == "sel")
        //{
        //    lblCat.Text = e.CommandArgument.ToString();
        //}
    } 
```

在上面的代码中，如果我想选择：

```
e.CommandName == "sel"

lblCat.Text = e.Comman 
```

然后我按 ALT 键并选择矩形，无需取消注释行。

看一下这个。

* * *

## 回答 #50

> 赞同：46
> 
> 时间：2008-09-05T13:54:30.030

@大卫在达科他州：

```
Console.WriteLine( "-".PadRight( 21, '-' ) ); 
```

我曾经这样做，直到我发现 String 类有一个构造函数，它允许你以更简洁的方式做同样的事情：

```
new String('-',22); 
```

* * *

## 回答 #51

> 赞同：46
> 
> 时间：2008-09-12T18:24:24.410

[volatile](http://msdn.microsoft.com/en-us/library/x13ttww7.aspx)关键字告诉编译器一个字段可以被多个线程同时修改。

* * *

## 回答 #52

> 赞同：45
> 
> 时间：2008-09-09T14:04:46.413

我喜欢的几件事：

- 如果你创建一个类似于

```
 public interface SomeObject<T> where T : SomeObject<T>, new() 
```

您强制从此接口继承的任何内容包含无参数构造函数。它对我遇到的一些事情非常有用。

- 使用匿名类型动态创建有用的对象：

```
var myAwesomeObject = new {Name="Foo", Size=10}; 
```

- 最后，许多 Java 开发人员都熟悉如下语法：

```
public synchronized void MySynchronizedMethod(){} 
```

但是，在 C# 中，这不是有效的语法。解决方法是一个方法属性：

```
 [MethodImpl(MethodImplOptions.Synchronized)]
 public void MySynchronizedMethod(){} 
```

* * *

## 回答 #53

> 赞同：45
> 
> 时间：2008-10-03T05:34:22.927

params 关键字，即

```
public void DoSomething(params string[] theStrings)
{
  foreach(string s in theStrings)
  {
    // Something with the Strings…
  }
} 
```

叫像

```
DoSomething(“The”, “cat”, “sat”, “on”, “the” ,”mat”); 
```

* * *

## 回答 #54

> 赞同：44
> 
> 时间：2008-09-04T21:06:29.627

**Foreach 使用鸭子打字**

转述，或无耻地从[Krzysztof Cwalinas 的博客](http://blogs.msdn.com/kcwalina/archive/2007/07/18/DuckNotation.aspx)中窃取。比什么都有趣的琐事。

为了让您的对象支持 foreach，您*不必*实现*IEnumerable*。即这不是一个约束，编译器也不会检查它。检查的是

*   您的对象提供了 一个公共方法*GetEnumerator*
    *   不带参数
    *   返回一个有两个成员的类型
        1.  *返回布尔值*的无参数*方法 MoveNext*
        **   带有*返回 Object*的 getter的*属性 Current**

 **例如，

```
class Foo
{
    public Bar GetEnumerator() { return new Bar(); }

    public struct Bar
    {
        public bool MoveNext()
        {
            return false;
        }

        public object Current
        {
            get { return null; }
        }
    }
}

// the following complies just fine:
Foo f = new Foo();
foreach (object o in f)
{
    Console.WriteLine("Krzysztof Cwalina's da man!");
} 
```

* * *

## 回答 #55

> 赞同：42
> 
> 时间：2008-09-19T07:48:12.320

静态构造函数。

实例：

```
public class Example
{
    static Example()
    {
        // Code to execute during type initialization
    }

    public Example()
    {
        // Code to execute during object initialization
    }
} 
```

静态类：

```
public static class Example
{
    static Example()
    {
        // Code to execute during type initialization
    }
} 
```

MSDN[说](http://msdn.microsoft.com/en-us/library/k9x6w0hc.aspx)：

> 静态构造函数用于初始化任何静态数据，或执行只需要执行一次的特定操作。在创建第一个实例或引用任何静态成员之前自动调用它。

例如：

```
public class MyWebService
{
    public static DateTime StartTime;

    static MyWebService()
    {
        MyWebService.StartTime = DateTime.Now;
    }

    public TimeSpan Uptime
    {
        get { return DateTime.Now - MyWebService.StartTime; }
    }
} 
```

但是，您也可以轻松完成：

```
public class MyWebService
{
    public static DateTime StartTime = DateTime.Now;

    public TimeSpan Uptime
    {
        get { return DateTime.Now - MyWebService.StartTime; }
    }
} 
```

因此，当您实际需要使用静态构造函数时，您将很难找到任何实例。

MSDN 提供了有关静态构造函数的有用说明：

> *   静态构造函数不采用访问修饰符或具有参数。
>     
>     
> *   在创建第一个实例
>     或引用任何静态成员之前，会自动调用静态构造函数来初始化类。
>     
>     
> *   不能直接调用静态构造函数。
>     
>     
> *   用户无法控制何时在程序中执行静态构造函数。
>     
>     
> *   静态构造函数的典型用途是当类使用日志文件并且构造函数用于将
>     条目写入该文件时。
>     
>     
> *   在为非托管代码创建包装类时，静态构造函数也很有用，此时构造函数
>     可以调用 LoadLibrary 方法。
>     
>     
> *   如果静态构造函数抛出异常，运行时将不会再次调用它，并且该类型将 在程序运行的应用程序域
>     的生命周期内保持未初始化状态。

最重要的一点是，如果静态构造函数中发生错误，则会`TypeIntializationException`抛出 a 并且您无法深入到有问题的代码行。相反，您必须检查`TypeInitializationException`'s`InnerException`成员，这是具体原因。

* * *

## 回答 #56

> 赞同：40
> 
> 时间：2008-08-28T21:46:35.407

[System.Diagnostics](http://msdn.microsoft.com/en-us/library/system.diagnostics.aspx)命名空间中的其他几个属性非常有用。

[DebuggerBrowsable](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggerbrowsableattribute.aspx)将允许您在调试器窗口中隐藏变量（我们将其用于所有公开属性的私有后备变量）。除此之外，[DebuggerStepThrough](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggerstepthroughattribute.aspx)使调试器跳过该代码，这对于哑属性非常有用（如果您可以依赖于 C# 3.0 编译器，可能应该将其转换为自动属性）。举个例子

```
[DebuggerBrowsable(DebuggerBrowsableState.Never)]
private string nickName;
public string NickName    {
    [DebuggerStepThrough]
    get { return nickName; }
    [DebuggerStepThrough]
    set { this.nickName = value; }
} 
```

* * *

## 回答 #57

> 赞同：39
> 
> 时间：2009-11-10T11:28:19.000

C# + CLR：

1.  `Thread.MemoryBarrier`: 大多数人不会使用它，而且 MSDN 上有一些不准确的信息。但是，如果您知道[复杂性](http://www.albahari.com/threading/part4.aspx)，那么您可以进行漂亮的无锁同步。

2.  `volatile, Thread.VolatileRead, Thread.VolatileWrite`: 很少有人使用这些，了解他们避免和引入的所有风险的人更少:)。

3.  `ThreadStatic`变量：这几年只有一种情况我发现 ThreadStatic 变量绝对是天赐之物，不可或缺。例如，当您想为整个调用链做某事时，它们非常有用。

4.  `fixed`关键字：当您想要访问大型数组的元素几乎与 C++ 一样快时，它是一个隐藏的武器（默认情况下，C# 强制执行绑定检查以减慢速度）。

5.  `default(typeName)`关键字也可以在泛型类之外使用。创建结构的空副本很有用。

6.  我使用的一个方便的特性是`DataRow[columnName].ToString()`总是返回非空值。如果数据库中的值为 NULL，则会得到空字符串。

7.  当您希望开发人员注意时，即使他/她没有启用异常自动中断，也可以使用 Debugger 对象自动中断：

```
 #if DEBUG  
    if (Debugger.IsAttached)  
        Debugger.Break();  
#endif 
```

8.  您可以给复杂难看的泛型类型加上别名，这样您就不必一次又一次地复制粘贴它们。您也可以在一处更改该类型。例如，

```
 using ComplicatedDictionary = Dictionary<int, Dictionary<string, object>>;
    ComplicatedDictionary myDictionary = new ComplicatedDictionary(); 
```

* * *

## 回答 #58

> 赞同：38
> 
> 时间：2008-12-24T18:10:36.670

## 闭包

由于匿名委托被添加到 2.0，我们已经能够开发闭包。它们很少被程序员使用，但提供了很大的好处，例如立即重用代码。考虑这段代码：

```
bool changed = false;

if (model.Prop1 != prop1)
{
    changed = true;
    model.Prop1 = prop1;
}
if (model.Prop2 != prop2)
{
    changed = true;
    model.Prop2 = prop2;
}
// ... etc. 
```

请注意，上面的 if 语句执行类似的代码片段，除了一行代码，即设置不同的属性。这可以通过以下方式缩短，其中将不同的代码行作为参数输入到`Action`适当命名的对象中`setAndTagChanged`：

```
bool changed = false;
Action<Action> setAndTagChanged = (action) => 
{ 
    changed = true; 
    action(); 
};

if (model.Prop1 != prop1) setAndTagChanged(() => model.Prop1 = prop1);
if (model.Prop2 != prop2) setAndTagChanged(() => model.Prop2 = prop2); 
```

在第二种情况下，闭包允许您`change`在 lambda 中限定变量的范围，这是解决此问题的一种简洁方法。

另一种方法是使用另一个未使用的功能，“或等于”二元赋值运算符。以下代码显示了如何：

```
private bool conditionalSet(bool condition, Action action)
{
    if (condition) action();
    return condition;
}

// ...

bool changed = false;
changed |= conditionalSet(model.Prop1 == prop1, () => model.Prop1 = prop1);
changed |= conditionalSet(model.Prop2 == prop2, () => model.Prop2 = prop2); 
```

* * *

## 回答 #59

> 赞同：38
> 
> 时间：2009-01-02T16:26:32.977

我想说将某些系统类用于扩展方法非常方便，例如 System.Enum，您可以执行以下操作...

```
[Flags]
public enum ErrorTypes : int {
    None = 0,
    MissingPassword = 1,
    MissingUsername = 2,
    PasswordIncorrect = 4
}

public static class EnumExtensions {

    public static T Append<T> (this System.Enum type, T value) where T : struct
    {
        return (T)(ValueType)(((int)(ValueType) type | (int)(ValueType) value));
    }

    public static T Remove<T> (this System.Enum type, T value) where T : struct
    {
        return (T)(ValueType)(((int)(ValueType)type & ~(int)(ValueType)value));
    }

    public static bool Has<T> (this System.Enum type, T value) where T : struct
    {
        return (((int)(ValueType)type & (int)(ValueType)value) == (int)(ValueType)value);
    }

}

...

//used like the following...

ErrorTypes error = ErrorTypes.None;
error = error.Append(ErrorTypes.MissingUsername);
error = error.Append(ErrorTypes.MissingPassword);
error = error.Remove(ErrorTypes.MissingUsername);

//then you can check using other methods
if (error.Has(ErrorTypes.MissingUsername)) {
    ...
} 
```

这当然只是一个例子——这些方法可能需要更多的工作......

* * *

## 回答 #60

> 赞同：36
> 
> 时间：2008-08-14T22:31:26.180

能够让枚举类型具有除 int 以外的值（默认值）

```
public enum MyEnum : long
{
    Val1 = 1,
    Val2 = 2
} 
```

此外，您可以为该枚举分配任何数值：

```
MyEnum e = (MyEnum)123; 
```

* * *

## 回答 #61

> 赞同：36
> 
> 时间：2010-06-29T05:18:36.120

**RealProxy 允许您为现有类型创建自己的代理。**

这是超级先进的，我还没有看到其他人使用它——这可能意味着它对大多数人来说也没有那么有用——但它是值得了解的事情之一。

基本上，.NET **RealProxy**类可以让您创建所谓的另一个类型的*透明代理。*在这种情况下，透明意味着它在其客户端看来完全像代理的目标对象——但实际上并非如此：它是您的类的一个实例，它是从 RealProxy 派生的。

这使您可以在客户端与在真实目标对象上调用的任何方法或属性之间应用强大而全面的拦截和“中介”服务。将此功能与工厂模式（IoC 等）相结合，您可以交回透明代理而不是真实对象，从而允许您拦截对真实对象的所有调用并在每个方法调用之前和之后执行操作。事实上，我相信这正是 .NET 用于跨应用程序域、进程和机器边界进行远程处理的功能：.NET 拦截所有访问，将序列化信息发送到远程对象，接收响应，并将其返回给您的代码。

也许一个例子可以清楚地说明这有什么用处：我为我作为企业架构师的上一份工作创建了一个参考服务堆栈，它指定了跨部门的任何新 WCF 服务的标准内部组合（“堆栈”）。该模型要求（例如）Foo 服务的数据访问层实现`IDAL<Foo>:` 创建 Foo、读取 Foo、更新 Foo、删除 Foo。服务开发人员使用提供的通用代码（来自我）来定位和加载服务所需的 DAL：

```
IDAL<T> GetDAL<T>(); // retrieve data access layer for entity T 
```

该公司的数据访问策略经常受到性能挑战。作为架构师，我无法监视每个服务开发人员以确保他/她编写了高性能的数据访问层。但是我可以在*GetDAL*工厂模式中做的是为请求的 DAL 创建**一个透明代理**（一旦公共服务模型代码找到 DLL 并加载它），并使用高性能计时 API 来分析对任何方法的所有调用达尔。然后对落后者进行排名只是按总时间递减排序 DAL 调用时间的问题。这种相对于开发分析（例如在 IDE 中）的优势在于它也可以在生产环境中完成，以确保 SLA。

这是我为“实体分析器”编写的测试代码示例，它是用一行代码为任何类型创建分析代理的常用代码：

```
[Test, Category("ProfileEntity")]
public void MyTest()
{
    // this is the object that we want profiled.
    // we would normally pass this around and call
    // methods on this instance.
    DALToBeProfiled dal = new DALToBeProfiled();

    // To profile, instead we obtain our proxy
    // and pass it around instead.
    DALToBeProfiled dalProxy = (DALToBeProfiled)EntityProfiler.Instance(dal);

    // or...
    DALToBeProfiled dalProxy2 = EntityProfiler<DALToBeProfiled>.Instance(dal);

    // Now use proxy wherever we would have used the original...
    // All methods' timings are automatically recorded
    // with a high-resolution timer
    DoStuffToThisObject(dalProxy);

    // Output profiling results
    ProfileManager.Instance.ToConsole();
} 
```

同样，这使您可以拦截客户端在目标对象上调用的所有方法和属性！在您的*RealProxy 派生*类中，您必须重写**Invoke：**

```
[System.ComponentModel.EditorBrowsable(System.ComponentModel.EditorBrowsableState.Never)]
[SecurityPermission(SecurityAction.LinkDemand, 
    Flags = SecurityPermissionFlag.Infrastructure)] // per FxCop
public override IMessage Invoke(IMessage msg)
{
    IMethodCallMessage msgMethodCall = msg as IMethodCallMessage;
    Debug.Assert(msgMethodCall != null); // should not be null - research Invoke if this trips. KWB 2009.05.28

    // The MethodCallMessageWrapper
    // provides read/write access to the method 
    // call arguments. 
    MethodCallMessageWrapper mc =
        new MethodCallMessageWrapper(msgMethodCall);

    // This is the reflected method base of the called method. 
    MethodInfo mi = (MethodInfo)mc.MethodBase;

    IMessage retval = null;

    // Pass the call to the method and get our return value
    string profileName = ProfileClassName + "." + mi.Name;

    using (ProfileManager.Start(profileName))
    {
        IMessage myReturnMessage =
           RemotingServices.ExecuteMessage(_target, msgMethodCall);

        retval = myReturnMessage;
    }

    return retval;
} 
```

.NET 能做什么不是很有趣吗？唯一的限制是目标类型*必须*从***MarshalByRefObject***派生。我希望这对某人有帮助。

* * *

## 回答 #62

> 赞同：36
> 
> 时间：2008-09-05T16:53:07.433

I just found out about this one today -- and I've been working with C# for 5 years!

It's the [namespace alias qualifier](http://msdn.microsoft.com/en-us/library/ms173212(VS.80).aspx):

```
extern alias YourAliasHere; 
```

You can use it to load multiple versions of the same type. This can be useful in maintenance or upgrade scenarios where you have an updated version of your type that won't work in some old code, but you need to upgrade it to the new version. [Slap on a namespace alias qualifier](http://blogs.msdn.com/abhinaba/archive/2005/11/30/498278.aspx), and the compiler will let you have both types in your code.

* * *

## 回答 #63

> 赞同：35
> 
> 时间：2010-03-22T20:05:06.127

# 任意嵌套范围 { }

## 1\. 更精细的作用域行为

**{**成员内的任何地方**}**，**{**仅使用大括号**}**，**{**没有控制语句**}**。

```
void MyWritingMethod() {

    int sameAge = 35;

    { // scope some work
        string name = "Joe";
        Log.Write(name + sameAge.ToString());
    }

    { // scope some other work
        string name = "Susan";
        Log.Write(name + sameAge.ToString());
    }

    // I'll never mix up Joe and Susan again
} 
```

在大的、令人困惑的或过时的成员中（然而，它们不应该存在）它可以帮助我防止使用错误的变量名。将内容范围扩大到更精细的水平。

## 2.用于代码美化或视觉语义

例如，此 XML 编写代码遵循实际生成的 XML 的缩进级别（即 Visual Studio 将相应地缩进范围括号）

```
XmlWriter xw = new XmlWriter(..);

//<root>
xw.WriteStartElement("root");
{
    //<game>
    xw.WriteStartElement("game");
    {
        //<score>#</score>
        for (int i = 0; i < scores.Length; ++i) // multiple scores
            xw.WriteElementString("score", scores[i].ToString());

    }
    //</game>
    xw.WriteEndElement();
}
//</root>
xw.WriteEndElement(); 
```

## 3\. 模仿“with”语句

（也是将临时工作排除在主要范围之外的另一种用途）
由[Patrik](https://stackoverflow.com/users/46187/)提供：有时用于模仿 C# 中的 VB“with-statement”。

```
var somePerson = this.GetPerson();  // whatever 
{ 
    var p = somePerson; 
    p.FirstName = "John"; 
    p.LastName = "Doe"; 
    //... 
    p.City = "Gotham"; 
} 
```

对于有眼光的程序员。

* * *

## 回答 #64

> 赞同：34
> 
> 时间：2008-08-18T23:47:06.157

没有隐藏，但我认为很多开发人员没有在可空类型上使用 HasValue 和 Value 属性。

```
 int? x = null;
        int y;
        if (x.HasValue)
            y = x.Value; 
```

* * *

## 回答 #65

> 赞同：33
> 
> 时间：2008-08-15T11:34:02.497

我最喜欢的是

```
global:: 
```

使用我们的一些 3rd 方代码提供程序来逃避命名空间地狱的关键字......

例子：

```
global::System.Collections.Generic.List<global::System.String> myList =
    new global::System.Collections.Generic.List<global::System.String>(); 
```

* * *

## 回答 #66

> 赞同：31
> 
> 时间：2009-09-12T19:47:40.967

您可以在一个 using 语句中“使用”多个对象。

```
using (Font f1= new Font("Arial", 10.0f), f2 = new Font("Arial", 10.0f))
{
    // Use f1 and f2.
} 
```

请注意，已经有一个答案表明您可以这样做：

```
using (Font f1= new Font("Arial", 10.0f))
using (Font f2 = new Font("Arial", 10.0f))
{    } 
```

这与我的不同。

* * *

## 回答 #67

> 赞同：31
> 
> 时间：2009-07-11T19:01:09.543

I've read through all seven pages, and I'm missing these:

**String.Join**

I've seen a lot of for-loops to convert a list of items to a string with separators. It's always a pain to make sure you doin't start with a separator and don't end with a separator. A built-in method makes this easier:

```
String.Join(",", new String[] { "a", "b", "c"}); 
```

**TODO in comment**

Not really a C# feature, more of a Visual Studio feature. When you start your comment with TODO, it's added to your Visual Studio Task List (View -> Task List. Comments)

```
// TODO: Implement this!
throw new NotImplementedException(); 
```

**Extension methods meets Generics**

You can combine extension methods with Generics, when you think of the tip earlier in this topic, you can add extensions to specific interfaces

```
public static void Process<T>(this T item) where T:ITest,ITest2 {} 
```

**Enumerable.Range**

Just want a list of integers?

```
Enumerable.Range(0, 15) 
```

I'll try to think of some more...

* * *

## 回答 #68

> 赞同：31
> 
> 时间：2010-06-13T05:14:40.770

类型定义

有人发帖说他们错过了 typedef，但你可以这样做

```
using ListOfDictionary = System.Collections.Generic.List<System.Collections.Generic.Dictionary<string, string>>; 
```

并将其声明为

```
ListOfDictionary list = new ListOfDictionary(); 
```

* * *

## 回答 #69

> 赞同：31
> 
> 时间：2010-05-27T03:10:14.313

宽度`string.Format()`

```
Console.WriteLine("Product: {0,-7} Price: {1,5}", product1, price1);
Console.WriteLine("Product: {0,-7} Price: {1,5}", product2, price2); 
```

生产

![替代文字](https://i.imgur.com/e0hg3.png)

来自 [Prabir 的博客 | 隐藏的 C# 功能](http://blog.prabir.me/post/Hidden-C-feature-stringFormat-Width.aspx)

* * *

## 回答 #70

> 赞同：30
> 
> 时间：2008-09-08T12:49:17.587

我喜欢关键字*continue*。

如果你在循环中遇到一个条件并且不想做任何事情，只是推进循环，只需坚持“继续；”。

例如：

```
foreach(object o in ACollection)
{
  if(NotInterested)
     continue;
} 
```

* * *

## 回答 #71

> 赞同：28
> 
> 时间：2008-09-01T05:03:20.607

**使用语句嵌套**

通常我们这样做：

```
StringBuilder sb = new StringBuilder();
using (StringWriter sw = new StringWriter()) {
    using (IndentedTextWriter itw = new IndentedTextWriter(sw)) {
        ... 
    }
} 
```

但我们可以这样做：

```
StringBuilder sb = new StringBuilder();
using (StringWriter sw = new StringWriter())
using (IndentedTextWriter itw = new IndentedTextWriter(sw)) {
    ... 
} 
```

* * *

## 回答 #72

> 赞同：28
> 
> 时间：2008-08-12T16:37:19.037

我个人最喜欢的两个，我认为很少使用：

1.  片段（尤其是属性，它在 Visual Studio 2008 中做得更好）
2.  [过时](http://msdn.microsoft.com/en-us/library/system.obsoleteattribute.aspx)的属性

* * *

## 回答 #73

> 赞同：28
> 
> 时间：2008-08-19T04:41:58.247

@lomaxx 前几天我还了解到（与我学习您的提示的时间相同）是，您现在可以在同一属性上拥有不同的访问级别：

```
public string Name { get; private set;} 
```

这样，只有类本身可以设置 Name 属性。

```
public MyClass(string name) { Name = name; } 
```

* * *

## 回答 #74

> 赞同：28
> 
> 时间：2009-09-09T11:31:54.323

**类似 JavaScript 的匿名内联函数**

返回一个字符串：

```
var s = new Func<String>(() =>
{
    return "Hello World!";
})(); 
```

返回一个更复杂的对象：

```
var d = new Func<Dictionary<Int32, String>>(() =>
{
    return new Dictionary<Int32, String>
    {
        { 0, "Foo" },
        { 1, "Bar" },
        { 2, "..." }
    };
})(); 
```

一个真实的用例：

```
var tr = new TableRow();

tr.Cells.AddRange
(
    new[]
    {
        new TableCell { Text = "" },
        new TableCell { Text = "" },
        new TableCell { Text = "" },

        new TableCell
        {
            Text = new Func<String>(() =>
            {
                return @"Result of a chunk of logic, without having to define
                         the logic outside of the TableCell constructor";
            })()
        },

        new TableCell { Text = "" },
        new TableCell { Text = "" }
    }
); 
```

*注意：您不能在内联函数的范围内重复使用变量名。*

**替代语法**

```
// The one-liner
Func<Int32, Int32, String> Add = (a, b) => Convert.ToString(a + b);

// Multiple lines
Func<Int32, Int32, String> Add = (a, b) =>
{
    var i = a + b;

    return i.ToString();
};

// Without parameters
Func<String> Foo = () => "";

// Without parameters, multiple lines
Func<String> Foo = () =>
{
    return "";
}; 
```

缩短字符串并添加水平省略号...

```
Func<String, String> Shorten = s => s.Length > 100 ? s.Substring(0, 100) + "&hellip;" : s; 
```

* * *

## 回答 #75

> 赞同：27
> 
> 时间：2009-11-24T13:15:08.260

轻松确定**声明**变量的类型（来自[我的回答](https://stackoverflow.com/questions/1786750/how-to-know-in-c-code-which-type-a-variable-was-declared-with/1786775#1786775 "确定变量的声明类型")）：

```
using System;
using System.Collections.Generic;

static class Program
{
    public static Type GetDeclaredType<T>(T x)
    {
        return typeof(T);
    }

    // Demonstrate how GetDeclaredType works
    static void Main(string[] args)
    {
        IList<string> iList = new List<string>();
        List<string> list = null;

        Console.WriteLine(GetDeclaredType(iList).Name);
        Console.WriteLine(GetDeclaredType(list).Name);
    }
} 
```

结果：

```
IList`1
List`1 
```

及其**名称**（借自[“获取变量名”](https://stackoverflow.com/questions/1386642/get-variable-not-hard-coded-name/1386730#1386730 "获取变量名")）：

```
static void Main(string[] args)
{
    Console.WriteLine("Name is '{0}'", GetName(new {args}));
    Console.ReadLine();
}

static string GetName<T>(T item) where T : class
{
    var properties = typeof(T).GetProperties();
    return properties[0].Name;
} 
```

结果：`Name is 'args'`

* * *

## 回答 #76

> 赞同：27
> 
> 时间：2008-11-18T16:16:26.043

一行中的按需字段初始化：

```
public StringBuilder Builder
{
    get { return _builder ?? (_builder = new StringBuilder()); }
} 
```

我不确定我对 C# 支持赋值表达式的感觉如何，但是嘿，它就在那里 :-)

* * *

## 回答 #77

> 赞同：27
> 
> 时间：2008-08-17T21:13:24.393

还有 ThreadStaticAttribute 可以使每个线程的静态字段唯一，因此您可以拥有强类型的线程本地存储。

即使扩展方法不是那么秘密（LINQ 基于它们），对于实用程序帮助方法的有用性和可读性可能不是那么明显：

```
//for adding multiple elements to a collection that doesn't have AddRange
//e.g., collection.Add(item1, item2, itemN);
static void Add<T>(this ICollection<T> coll, params T[] items)
 { foreach (var item in items) coll.Add(item);
 }

//like string.Format() but with custom string representation of arguments
//e.g., "{0} {1} {2}".Format<Custom>(c=>c.Name,"string",new object(),new Custom())
//      result: "string {System.Object} Custom1Name"
static string Format<T>(this string format, Func<T,object> select, params object[] args)
 { for(int i=0; i < args.Length; ++i)
    { var x = args[i] as T;
      if (x != null) args[i] = select(x);
    }
   return string.Format(format, args);
 } 
```

* * *

## 回答 #78

> 赞同：27
> 
> 时间：2008-10-10T16:22:40.903

完全访问调用堆栈：

```
public static void Main()
{
  StackTrace stackTrace = new StackTrace();           // get call stack
  StackFrame[] stackFrames = stackTrace.GetFrames();  // get method calls (frames)

  // write call stack method names
  foreach (StackFrame stackFrame in stackFrames)
  {
    Console.WriteLine(stackFrame.GetMethod().Name);   // write method name
  }
} 
```

所以，如果你要使用第一个 - 你知道你在哪个函数中。如果你正在创建一个辅助跟踪函数 - 在最后一个之前取一个 - 你会知道你的调用者。

* * *

## 回答 #79

> 赞同：26
> 
> 时间：2008-08-18T14:43:56.020

它实际上不是 C# 的隐藏功能，但我最近发现了[WeakReference 类](http://msdn.microsoft.com/en-us/library/system.weakreference.aspx)并被它所震撼（尽管这可能是因为它帮助我找到了解决我的[特定问题的方法](http://www.juanformoso.com.ar/post/2008/07/30/Weak-References.aspx)......）

* * *

## 回答 #80

> 赞同：26
> 
> 时间：2008-10-08T07:45:04.330

[Environment.UserInteractive](http://msdn.microsoft.com/en-us/library/system.environment.userinteractive.aspx)属性。

> 对于 Windows 进程或在没有用户界面的情况下运行的 IIS 等服务，UserInteractive 属性报告为 false。如果此属性为 false，则不要显示模式对话框或消息框，因为没有供用户交互的图形用户界面。

* * *

## 回答 #81

> 赞同：26
> 
> 时间：2010-06-30T04:20:12.973

[AppDomain.UnhandledException Event](http://msdn.microsoft.com/en-us/library/system.appdomain.unhandledexception.aspx) is also candidate for being hidden.

> This event provides notification of uncaught exceptions. It allows the application to log information about the exception before the system default handler reports the exception to the user and terminates the application. If sufficient information about the state of the application is available, other actions may be undertaken — such as saving program data for later recovery. Caution is advised, because program data can become corrupted when exceptions are not handled.

We can see, even on this site, a lot of people are wondering why their application is not starting, why it crashed, etc. The `AppDomain.UnhandledException` event can be very useful for such cases as it provides the possibility at least to log the reason of application failure.

* * *

## 回答 #82

> 赞同：26
> 
> 时间：2009-08-07T06:44:19.817

从 C/C++ 迁移过来的程序员可能会错过这一点：

在 C# 中，%（模运算符）适用于浮点数！

* * *

## 回答 #83

> 赞同：25
> 
> 时间：2008-08-26T12:54:41.083

C# ?? 空合并运算符 -

没有真正隐藏，但很少使用。可能是因为很多开发人员在看到条件时会跑得很远？运营商，所以当他们看到这个时，他们会运行两个。用过的：

```
string mystring = foo ?? "foo was null" 
```

而不是

```
string mystring;
if (foo==null)
    mystring = "foo was null";
else
    mystring = foo; 
```

* * *

## 回答 #84

> 赞同：25
> 
> 时间：2008-08-26T22:19:01.507

*#if DEBUG*预处理器指令。它对测试和调试很有用（尽管我通常更喜欢走单元测试路线）。

```
string customerName = null;
#if DEBUG
  customerName = "Bob"
#endif 
```

如果 Visual Studio 设置为在“调试”模式下编译，它只会执行代码块。否则，代码块将被编译器忽略（并在 Visual Studio 中显示为灰色）。

* * *

## 回答 #85

> 赞同：25
> 
> 时间：2010-01-25T13:55:03.170

我没有找到任何使用 string.Join 来使用分隔符连接字符串的人。每个人都在写同样丑陋的 for 循环

```
var sb = new StringBuilder();
var count = list.Count();
for(int i = 0; i < count; i++)
{
  if (sb.Length > 0) sb.Append(seperator);
  sb.Append(list[i]);
}

return sb.ToString(); 
```

代替

```
return string.Join(separator, list.ToArray()); 
```

* * *

## 回答 #86

> 赞同：24
> 
> 时间：2008-08-28T12:55:57.850

[真假](http://msdn.microsoft.com/en-us/library/6x6y6z4d.aspx)[运算](http://msdn.microsoft.com/en-us/library/6292hy1k.aspx)符真的很奇怪。

更全面的例子可以在[这里](http://www.java2s.com/Tutorial/CSharp/0160__Operator-Overload/truefalseoperatorforComplex.htm)找到。

*编辑：有相关的 SO 问题[C# 中的 false 运算符有什么用？](https://stackoverflow.com/questions/33265/whats-the-false-operator-in-c-good-for)*

* * *

## 回答 #87

> 赞同：24
> 
> 时间：2008-08-19T15:23:12.040

# Partial Methods

[Charlie Calvert explains partial methods on his blog](http://blogs.msdn.com/charlie/archive/2007/11/11/partial-methods.aspx)

[Scott Cate has a nice partial method demo here](http://weblogs.asp.net/scottcate/archive/2008/06/18/teched-orlando-compiler-tricks.aspx)

1.  Points of extensibility in Code Generated class (LINQ to SQL, EF)
2.  Does not get compiled into the dll if it is not implemented (check it out with .NET Reflector)

* * *

## 回答 #88

> 赞同：24
> 
> 时间：2008-09-05T07:49:27.087

C# 中有一些与 TypedReference 未记录类相关的真正隐藏的关键字和功能。以下关键字未记录在案：

*   `__makeref`
*   `__reftype`
*   `__refvalue`
*   `__arglist`

使用示例：

```
// Create a typed reference
int i = 1;
TypedReference tr1 = __makeref(i);
// Get the type of a typed reference
Type t = __reftype(tr1);
// Get the value of a typed referece
int j = __refvalue(tr1, int); 
// Create a method that accepts and arbitrary number of typed references
void SomeMethod(__arglist) { ...
// Call the method
int x = 1;
string y = "Foo";
Object o = new Object();
SomeMethod(__arglist(x,y,o));
// And finally iterate over method parameters
void SomeMethod(__arglist) {
    ArgIterator ai = new ArgIterator(__arglist);
while(ai.GetRemainingCount() >0)
{
      TypedReference tr = ai.GetNextArg();
      Console.WriteLine(TypedReference.ToObject(tr));
}} 
```

* * *

## 回答 #89

> 赞同：23
> 
> 时间：2009-11-30T15:37:31.573

我发现只有少数开发人员知道这个功能。

如果您需要**通过某个接口**（由该值类型实现）与值类型变量一起使用的方法，则很容易在方法调用期间**避免装箱。**

示例代码：

```
using System;
using System.Collections;

interface IFoo {
    void Foo();
}
struct MyStructure : IFoo {
    public void Foo() {
    }
}
public static class Program {
    static void MethodDoesNotBoxArguments<T>(T t) where T : IFoo {
        t.Foo();
    }
    static void Main(string[] args) {
        MyStructure s = new MyStructure();
        MethodThatDoesNotBoxArguments(s);
    }
} 
```

IL 代码不包含任何框指令：

```
.method private hidebysig static void  MethodDoesNotBoxArguments<(IFoo) T>(!!T t) cil managed
{
  // Code size       14 (0xe)
  .maxstack  8
  IL_0000:  ldarga.s   t
  IL_0002:  constrained. !!T
  IL_0008:  callvirt   instance void IFoo::Foo()
  IL_000d:  ret
} // end of method Program::MethodDoesNotBoxArguments

.method private hidebysig static void  Main(string[] args) cil managed
{
  .entrypoint
  // Code size       15 (0xf)
  .maxstack  1
  .locals init ([0] valuetype MyStructure s)
  IL_0000:  ldloca.s   s
  IL_0002:  initobj    MyStructure
  IL_0008:  ldloc.0
  IL_0009:  call       void Program::MethodDoesNotBoxArguments<valuetype MyStructure>(!!0)
  IL_000e:  ret
} // end of method Program::Main 
```

请参阅[Richter, J. CLR via C#](http://rads.stackoverflow.com/amzn/click/0735621632)，第 2 版，第 14 章：接口，关于泛型和接口约束的部分。

另请参阅[我](https://stackoverflow.com/questions/1816419/does-passing-a-struct-into-an-interface-field-allocate/1817137#1817137)对另一个问题的回答。

* * *

## 回答 #90

> 赞同：22
> 
> 时间：2008-08-18T23:08:35.830

几乎所有很酷的都被提到了。不确定这个是否众所周知

C# 属性/字段构造函数初始化：

```
var foo = new Rectangle() 
{ 
    Fill = new SolidColorBrush(c), 
    Width = 20, 
    Height = 20 
}; 
```

这将创建矩形，并设置列出的属性。

我注意到一些有趣的事情——你可以在属性列表的末尾有一个逗号，而不是语法错误。所以这也是有效的：

```
var foo = new Rectangle() 
{ 
    Fill = new SolidColorBrush(c), 
    Width = 20, 
    Height = 20,
}; 
```

* * *

## 回答 #91

> 赞同：21
> 
> 时间：2008-08-13T08:29:09.287

基于这个帖子的标题应该是“*尽管认为你已经知道一切，但直到最近你才知道的关于 C#*的事情”，我个人的特点是异步委托。

直到我阅读了 Jeff Richter 的 C#/CLR 书（优秀的书，每个使用 .NET 的人都应该阅读它），我不知道您可以使用/调用*任何*委托。我倾向于做很多调用（我想这很像代表在内部做的事情），但是添加标准化的连接/集合模式有时可能真的很有用。`BeginInvoke``EndInvoke``ThreadPool.QueueUserWorkItem``BeginInvoke`

* * *

## 回答 #92

> 赞同：21
> 
> 时间：2010-06-22T16:12:29.493

关于事件处理程序的另一个注意事项：您可以像这样简单地创建一个 raise 扩展方法：

```
public static class EventExtensions {
    public static void Raise<T>(this EventHandler<T> @event, 
                                object sender, T args) where T : EventArgs {
        if(@event!= null) {
            @event(sender, args);
        }
    }
} 
```

然后你可以用它来引发事件：

```
public class MyImportantThing {
    public event EventHandler<MyImportantEventEventArgs> SomethingHappens;
    ...
    public void Bleh() {
        SomethingHappens.Raise(this, new MyImportantEventEventArgs { X=true });
    }
} 
```

此方法具有执行编码标准（使用`EventHandler<>`）的额外优势。

一遍又一遍地编写相同的确切函数没有意义。也许下一个版本的 C# 最终将有一个`InlineAttribute`可以放置在扩展方法上的方法，并将导致编译器内联方法定义（这将使这种方法几乎是标准的，并且是最快的）。

编辑：根据评论删除了扩展方法中的临时变量

* * *

## 回答 #93

> 赞同：21
> 
> 时间：2008-11-18T20:51:07.910

有几个人提到过*使用*块，但我认为它们比人们意识到的要有用得多。将它们视为穷人的 AOP 工具。我有许多简单的对象，它们在构造函数中捕获状态，然后在*Dispose()*方法中恢复它。*这使我可以在using*块中包装一个功能，并确保在最后恢复状态。例如：

```
using(new CursorState(this, BusyCursor));
{
    // Do stuff
} 
```

*CursorState*捕获表单正在使用的当前光标，然后将表单设置为使用提供的光标。最后它恢复原始光标。我做了很多这样的事情，例如在刷新之前捕获网格上的选择和当前行等等。

* * *

## 回答 #94

> 赞同：20
> 
> 时间：2010-04-21T15:41:05.063

What about **IObservable**?

Pretty much everybody knows [**IEnumerable**](http://msdn.microsoft.com/en-us/library/9eekhta0.aspx) but their mathematical dual seems to be unknown [**IObservable**](http://msdn.microsoft.com/en-us/library/dd990377.aspx). Maybe because its new in .NET 4.

What it does is instead of pulling the information (like an enumerable) it pushes information to the subscriber(s) of the observerable.

Together with the [**Rx extensions**](http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx) it will change how we deal with events. Just to illustrate how powerful it is check a very short example [**here**](http://channel9.msdn.com/posts/J.Van.Gogh/Writing-your-first-Rx-Application/).

* * *

## 回答 #95

> 赞同：20
> 
> 时间：2008-08-27T21:05:41.940

我参加这个聚会迟到了，所以我的第一个选择已经做出了。但我还没有看到有人提到这个宝石：

[.NET Framework 的并行扩展](http://msdn.microsoft.com/en-us/concurrency/default.aspx)

它有诸如用 Parallel.For 替换或用 Parallel.ForEach 替换 foreach 之类的东西

* * *

Parallel Sample :
在您看来，一秒钟可以创建多少个 CLR 对象？ ![在此处输入图像描述](https://i.stack.imgur.com/nqJ2u.png)
见下例：

```
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Threading;
using System.Threading.Tasks;

namespace ObjectInitSpeedTest
{
   class Program
   {
       //Note: don't forget to build it in Release mode.
       static void Main()
       {
           normalSpeedTest();           
           parallelSpeedTest();

           Console.ForegroundColor = ConsoleColor.White;
           Console.WriteLine("Press a key ...");
           Console.ReadKey();
       }

       private static void parallelSpeedTest()
       {
           Console.ForegroundColor = ConsoleColor.Yellow;
           Console.WriteLine("parallelSpeedTest");

           long totalObjectsCreated = 0;
           long totalElapsedTime = 0;

           var tasks = new List<Task>();
           var processorCount = Environment.ProcessorCount;

           Console.WriteLine("Running on {0} cores", processorCount);

           for (var t = 0; t < processorCount; t++)
           {
               tasks.Add(Task.Factory.StartNew(
               () =>
               {
                   const int reps = 1000000000;
                   var sp = Stopwatch.StartNew();
                   for (var j = 0; j < reps; ++j)
                   {
                       new object();
                   }
                   sp.Stop();

                   Interlocked.Add(ref totalObjectsCreated, reps);
                   Interlocked.Add(ref totalElapsedTime, sp.ElapsedMilliseconds);
               }
               ));
           }

           // let's complete all the tasks
           Task.WaitAll(tasks.ToArray());

           Console.WriteLine("Created {0:N} objects in 1 sec\n", (totalObjectsCreated / (totalElapsedTime / processorCount)) * 1000);
       }

       private static void normalSpeedTest()
       {
           Console.ForegroundColor = ConsoleColor.Green;
           Console.WriteLine("normalSpeedTest");

           const int reps = 1000000000;
           var sp = Stopwatch.StartNew();
           sp.Start();
           for (var j = 0; j < reps; ++j)
           {
               new object();
           }
           sp.Stop();

           Console.WriteLine("Created {0:N} objects in 1 sec\n", (reps / sp.ElapsedMilliseconds) * 1000);
       }
   }
} 
```

* * *

## 回答 #96

> 赞同：20
> 
> 时间：2009-09-23T09:00:29.407

很抱歉这么晚才发帖，我是 Stack Overflow 的新手，所以错过了更早的机会。

我发现这`EventHandler<T>`是未充分利用的框架的一个重要功能。

我遇到的大多数 C# 开发人员在定义自定义事件时仍然会定义自定义事件处理程序委托，这不再是必需的了。

代替：

```
public delegate void MyCustomEventHandler(object sender, MyCustomEventArgs e);

public class MyCustomEventClass 
{
    public event MyCustomEventHandler MyCustomEvent;
} 
```

你可以走了：

```
public class MyCustomEventClass 
{
    public event EventHandler<MyCustomEventArgs> MyCustomEvent;
} 
```

这更加简洁，而且您不会陷入将委托放在包含事件的类或 EventArgs 派生类的 .cs 文件中的两难境地。

* * *

## 回答 #97

> 赞同：20
> 
> 时间：2008-12-05T11:10:09.463

我喜欢的一个很棒的类是`System.Xml.XmlConvert`它可以用来从 xml 标签中读取值。特别是，如果我从 xml 属性或元素中读取布尔值，我使用

```
bool myFlag  = System.Xml.XmlConvert.ToBoolean(myAttribute.Value); 
```

注意：由于 xml 中的布尔类型除了“true”和“false”之外还接受 1 和 0 作为有效值，因此在这种情况下使用字符串比较容易出错。

* * *

## 回答 #98

> 赞同：20
> 
> 时间：2009-06-02T07:20:56.077

[属性目标](http://msdn.microsoft.com/en-us/library/b3787ac0.aspx)

每个人都见过一个。基本上，当你看到这个时：

```
[assembly: ComVisible(false)] 
```

该属性的“程序集：”部分是目标。在这种情况下，属性应用于程序集，但还有其他属性：

```
[return: SomeAttr]
int Method3() { return 0; } 
```

在此示例中，属性应用于返回值。

* * *

## 回答 #99

> 赞同：20
> 
> 时间：2010-06-30T09:24:46.087

```
string.Empty 
```

我知道这不是幻想（非常奇怪），但我一直使用它而不是“”。

它隐藏得很好，直到有人告诉你它在那里。

* * *

## 回答 #100

> 赞同：20
> 
> 时间：2010-05-25T14:09:06.777

好的，这似乎很明显，但我想提一下`Object.Equals`方法（静态方法，带有两个参数）。

我很确定很多人甚至不知道它，或者忘记了它的存在，但在某些情况下它确实可以提供帮助。例如，当您想比较两个对象是否相等时，不知道它们是否为空。你写了多少次这样的东西：

```
if ((x == y) || ((x != null && y != null) && x.Equals(y)))
{
    ...
} 
```

当你可以写：

```
if (Object.Equals(x, y))
{
    ...
} 
```

（`Object.Equals`实际上与第一个代码示例中的实现完全相同）

* * *

## 回答 #101

> 赞同：19
> 
> 时间：2009-01-01T16:10:01.197

**C# 3.0 的 LINQ 查询理解是完全成熟的单子理解** *，*就像Haskell 一样（实际上它们是由 Haskell 的一位设计师设计的）。它们适用于任何遵循“LINQ 模式”的泛型类型，并允许您以纯单子函数样式编写，这意味着您的所有变量都是不可变的（就好像您使用的唯一变量是`IDisposable`s 和`IEnumerable`s 在*使用*和*foreach*语句）。这有助于保持变量声明靠近它们的使用位置，并确保所有副作用都被显式声明（如果有的话）。

```
 interface IFoo<T>
  { T Bar {get;}
  }

 class MyFoo<T> : IFoo<T> 
  { public MyFoo(T t) {Bar = t;}
    public T Bar {get; private set;} 
  }

 static class Foo 
  { public static IFoo<T> ToFoo<T>(this T t) {return new MyFoo<T>(t);}

    public static void Do<T>(this T t, Action<T> a) { a(t);}

    public static IFoo<U> Select<T,U>(this IFoo<T> foo, Func<T,U> f) 
     { return f(foo.Bar).ToFoo();
     }
  }

 /* ... */

 using (var file = File.OpenRead("objc.h"))
 { var x = from f in file.ToFoo()
           let s = new Scanner(f)
           let p = new Parser {scanner = s}
           select p.Parse();

   x.Do(p => 
    { /* drop into imperative code to handle file 
         in Foo monad if necessary */      
    });

 } 
```

* * *

## 回答 #102

> 赞同：19
> 
> 时间：2010-06-22T12:55:40.147

Not really hidden, but useful. When you've got an `enum` with `flags`, you can use shift-left to make things clearer. e.g.

```
[Flags]
public enum ErrorTypes {
    None              = 0,
    MissingPassword   = 1 << 0,
    MissingUsername   = 1 << 1,
    PasswordIncorrect = 1 << 2 
} 
```

* * *

## 回答 #103

> 赞同：19
> 
> 时间：2008-08-20T15:00:30.173

我看到很多人复制`Nullable<T>.GetValueOrDefault(T)`.

* * *

## 回答 #104

> 赞同：18
> 
> 时间：2009-04-17T07:09:13.487

我最喜欢的属性：[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)

在程序集级别，您可以声明另一个程序集可以看到您的内部。出于测试目的，这绝对是美妙的。

将其粘贴在您的 AssemblyInfo.cs 或等效文件中，您的测试程序集就可以完全访问所有需要测试的内部内容。

```
[assembly: InternalsVisibleTo("MyLibrary.Test, PublicKey=0024...5c042cb")] 
```

如您所见，测试程序集必须具有[强名称](http://msdn.microsoft.com/en-us/library/xc31ft41.aspx)才能获得被测程序集的信任。

在 .Net Framework 2.0+、Compact Framework 2.0+ 和 XNA Framework 1.0+ 中可用。

* * *

## 回答 #105

> 赞同：17
> 
> 时间：2008-08-28T16:17:15.883

我喜欢在 SQL 查询中使用 @ 字符。它使 sql 保持良好和格式化，并且不必用字符串分隔符包围每一行。

```
string sql = @"SELECT firstname, lastname, email
               FROM users
               WHERE username = @username AND password = @password"; 
```

* * *

## 回答 #106

> 赞同：17
> 
> 时间：2008-09-01T13:21:10.630

用于引用具有相同完全限定类型名称的两个版本的程序集的[extern 别名关键字。](http://msdn.microsoft.com/en-us/library/ms173212.aspx)

* * *

## 回答 #107

> 赞同：17
> 
> 时间：2009-09-16T19:38:58.367

`{ }`您可以使用括号来限制变量的生命周期和范围。

```
{
    string test2 = "3";
    Console.Write(test2);
}

Console.Write(test2); //compile error 
```

`test2`只存在于括号内。

* * *

## 回答 #108

> 赞同：17
> 
> 时间：2009-11-12T19:43:24.913

需要返回一个空的 IEnumerable？

```
public IEnumerable<T> GetEnumerator(){
  yield break;
} 
```

* * *

## 回答 #109

> 赞同：16
> 
> 时间：2008-11-19T16:28:25.427

您可以在 C# 名称中使用任何 Unicode 字符，例如：

```
public class MyClass
{
    public string Hårføner()
    {
        return "Yes, it works!";
    }
} 
```

您甚至可以使用 Unicode 转义。这个等价于上面的：

```
public class MyClass
{
    public string H\u00e5rføner()
    {
        return "Yes, it (still) works!";
    }
} 
```

* * *

## 回答 #110

> 赞同：16
> 
> 时间：2008-12-16T06:07:30.570

使用 LINQ 表达式执行强类型反射的能力：

```
static void Main(string[] args)
{
  var domain = "matrix";
  Check(() => domain);
  Console.ReadLine();
}

static void Check<T>(Expression<Func<T>> expr)
{
  var body = ((MemberExpression)expr.Body);
  Console.WriteLine("Name is: {0}", body.Member.Name);
  Console.WriteLine("Value is: {0}", ((FieldInfo)body.Member)
   .GetValue(((ConstantExpression)body.Expression).Value));
}

// output:
// Name is: 'domain'
// Value is: 'matrix' 
```

更多详细信息，请参阅[如何在 C# 中找出变量或参数名称？](http://rabdullin.com/journal/2008/12/13/how-to-find-out-variable-or-parameter-name-in-c.html)

* * *

## 回答 #111

> 赞同：16
> 
> 时间：2010-02-14T18:52:49.937

您可以将颜色存储在 Enum 中。

```
public enum MyEnumColors : uint
{
    Normal          = 0xFF9F9F9F,
    Active          = 0xFF8EA98A,
    Error           = 0xFFFF0000
} 
```

* * *

## 回答 #112

> 赞同：15
> 
> 时间：2008-08-22T03:55:51.533

枚举上的[FlagsAttribute](http://msdn.microsoft.com/en-us/library/system.flagsattribute.aspx)怎么样？它允许您执行按位运算……我花了很长时间才知道如何在 .NET 中很好地执行按位运算。

* * *

## 回答 #113

> 赞同：15
> 
> 时间：2008-08-12T17:29:29.307

我经常遇到需要将通用参数对象持久化到基类的视图状态中。

```
public abstract class BaseListControl<ListType,KeyType,ParameterType>
                 : UserControl 
                 where ListType : BaseListType
                 && ParameterType : BaseParameterType, new
{

    private const string viewStateFilterKey = "FilterKey";

    protected ParameterType Filters
    {
        get
        {
            if (ViewState[viewStateFilterKey] == null)
                ViewState[viewStateFilterKey]= new ParameterType();

            return ViewState[viewStateFilterKey] as ParameterType;
        }
        set
        {
            ViewState[viewStateFilterKey] = value;
        }
    }

} 
```

用法：

```
private void SomeEventHappened(object sender, EventArgs e)
{
    Filters.SomeValue = SomeControl.SelectedValue;
}

private void TimeToFetchSomeData()
{
    GridView.DataSource = Repository.GetList(Filters);
} 
```

这个“where ParameterType : BaseParameterType, new”的小技巧是让它真正起作用的原因。

在我的基类中使用这个属性，我可以自动处理分页、设置过滤器值以过滤网格视图、使排序变得非常容易等。

我真的只是说泛型在坏人手中可能是一个非常强大的野兽。

* * *

## 回答 #114

> 赞同：15
> 
> 时间：2010-03-16T15:37:04.987

**使用带有 FlagAttribute 和 enum 的“~”运算符**
有时我们会使用带有 enum 的 Flag 属性来对枚举执行按位操作。

```
 [Flags]
 public enum Colors
 {
    None  = 0,
    Red   = 1,
    Blue  = 2,
    White = 4,
    Black = 8,
    Green = 16,
    All   = 31 //It seems pretty bad...
 } 
```

请注意，枚举中的选项“All”的值很奇怪。
取而代之的是，我们可以使用带有标记枚举的“~”运算符。

```
 [Flags]
 public enum Colors
 {
    None  = 0,
    Red   = 1,
    Blue  = 2,
    White = 4,
    Black = 8,
    Green = 16,
    All   = ~0 //much better now. that mean 0xffffffff in default.
 } 
```

* * *

## 回答 #115

> 赞同：15
> 
> 时间：2010-06-30T18:09:05.607

[固定](http://msdn.microsoft.com/en-us/library/f58wzh21(VS.80).aspx)语句

此语句可防止垃圾收集器重新定位可移动变量。Fixed 也可用于创建固定大小的缓冲区。

> 固定语句设置一个指向托管变量的指针，并在语句执行期间“固定”该变量。

[堆栈分配](http://msdn.microsoft.com/en-us/library/cx9s2sy4(VS.71).aspx)

stackalloc 在栈上分配一块内存。

* * *

## 回答 #116

> 赞同：15
> 
> 时间：2009-06-26T16:13:06.793

您可以使用更少的输入来添加和删除委托。

常用方式：

```
handler += new EventHandler(func); 
```

少打字方式：

```
handler += func; 
```

* * *

## 回答 #117

> 赞同：15
> 
> 时间：2010-06-29T06:12:32.977

也有用，但不常用：[受约束的执行区域](http://msdn.microsoft.com/en-us/library/ms228973.aspx)。

来自 BCL 团队博客的引述：

> 存在约束执行区 (CER) 以帮助开发人员编写代码以保持一致性。CLR 不保证开发人员的代码是正确的，但 CLR 确实将所有运行时引起的故障点（即异步异常）提升到代码运行之前或完成之后。结合对开发人员可以在 CER 中添加的内容的限制，这些都是对您的代码是否会执行做出强有力保证的有用方法。CER 是热切准备的，这意味着当我们看到一个时，我们将热切地 JIT 在其静态可发现调用图中找到的任何代码。如果 CLR 的主机关心堆栈溢出，我们也会探测一些堆栈空间（尽管可能没有足够的堆栈空间用于任何任意方法*）。

在以原子方式对数据结构的多个字段进行编辑时，它会很有用。因此，对对象进行交易会有所帮助。

[CriticalFinalizerObject](http://msdn.microsoft.com/en-us/library/system.runtime.constrainedexecution.criticalfinalizerobject.aspx)似乎也被隐藏了（至少谁没有编写不安全的代码）。CriticalFinalizerObject 保证垃圾收集将执行终结器。在分配时，终结器及其调用图是预先准备好的。

* * *

## 回答 #118

> 赞同：14
> 
> 时间：2008-08-29T21:28:19.343

[条件属性](http://msdn.microsoft.com/en-us/library/aa664622(VS.71).aspx)

允许您告诉编译器在某些条件下（#define）省略对标有属性的方法的调用。

省略方法调用的事实也意味着不评估其参数。这非常方便，它允许您在 Debug.Assert() 中调用昂贵的验证函数，而不必担心它们会减慢您的发布构建。

* * *

## 回答 #119

> 赞同：14
> 
> 时间：2010-04-22T07:40:51.540

当一个类实现[INotifyPropertyChanged](http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanged%28v=VS.80%29.aspx)并且您想通知绑定系统（WPF、Silverlight 等）一个对象（ViewModel）的多个绑定属性已更改时，您可以使用**null**或**String.Empty**引发 PropertyChanged-Event 。

这在 MSDN 中有记录，但代码示例和文章通常不会解释这种可能性。我发现它非常有用。

```
public class BoundObject : INotifyPropertyChanged {

    private int _value;
    private string _text;

    public event PropertyChangedEventHandler PropertyChanged;

    public int Value {
        get {
            return _value;
        }
        set {
            if (_value != value) {
                _value = value;
                OnPropertyChanged("Value");
            }
        }
    }

    public string Text {
        get {
            return _text;
        }
        set {
            if (_text != value) {
                _text = value;
                OnPropertyChanged("Text");
            }
        }
    }

    public void Init(){
        _text = "InitialValue";
        _value = 1;
        OnPropertyChanged(string.Empty);
    }

    public void Reset() {
        _text = "DefaultValue";
        _value = 0;
        OnPropertyChanged(string.Empty);
    }

    private void OnPropertyChanged(string propertyName) {
        PropertyChangedEventArgs e = new PropertyChangedEventArgs(propertyName);

        if (PropertyChanged != null) {
            PropertyChanged(this, e);
        }
    }
} 
```

* * *

## 回答 #120

> 赞同：14
> 
> 时间：2008-09-29T16:34:13.247

我只在 Stack Overflow 上了解到的一个特性是能够在返回参数上设置属性。

```
[AttributeUsage( AttributeTargets.ReturnValue )]
public class CuriosityAttribute:Attribute
{
}

public class Bar
{
    [return: Curiosity]
    public Bar ReturnANewBar()
    {
        return new Bar();
    }
} 
```

这对我来说确实是一个隐藏的功能:-)

* * *

## 回答 #121

> 赞同：14
> 
> 时间：2010-07-03T17:31:40.200

您可以将多个属性放在一对方括号中：

```
 [OperationContract, ServiceKnownType(typeof(Prism)), ServiceKnownType(typeof(Cuboid))]
    Shape GetShape(); 
```

* * *

## 回答 #122

> 赞同：14
> 
> 时间：2008-10-03T05:57:04.743

标记我的末端区域...

```
#region stuff1
 #region stuff1a
 //...
 #endregion stuff1a
#endregion stuff1 
```

* * *

## 回答 #123

> 赞同：14
> 
> 时间：2009-09-12T19:26:18.997

定义自定义属性时，您可以将它们与 [MyAttAttribute] 或 [MyAtt] 一起使用。当两个写作都存在类时，就会发生编译错误。

@ 特殊字符可用于区分它们：

```
[AttributeUsage(AttributeTargets.All)]
public class X: Attribute
{}

[AttributeUsage(AttributeTargets.All)]
public class XAttribute: Attribute
{}

[X]      // Error: ambiguity
class Class1 {}

[XAttribute]   // Refers to XAttribute
class Class2 {}

[@X]      // Refers to X
class Class3 {}

[@XAttribute]   // Refers to XAttribute
class Class4 {} 
```

* * *

## 回答 #124

> 赞同：13
> 
> 时间：2008-08-13T18:47:41.473

**Lambda 表达式**

```
Func<int, int, int> add = (a, b) => (a + b); 
```

**晦涩的字符串格式**

```
Console.WriteLine("{0:D10}", 2); // 0000000002

Dictionary<string, string> dict = new Dictionary<string, string> { 
    {"David", "C#"}, 
    {"Johann", "Perl"}, 
    {"Morgan", "Python"}
};

Console.WriteLine( "{0,10} {1, 10}", "Programmer", "Language" );

Console.WriteLine( "-".PadRight( 21, '-' ) );

foreach (string key in dict.Keys)
{
    Console.WriteLine( "{0, 10} {1, 10}", key, dict[key] );             
} 
```

* * *

## 回答 #125

> 赞同：13
> 
> 时间：2008-11-19T16:58:38.097

如何使用这个：

```
#if DEBUG
            Console.Write("Debugging");
#else
            Console.Write("Final");
#endif 
```

当您使用定义的 DEBUG 编译解决方案时，它将输出“调试”。

如果您的编译设置为 Release，它将写入“Final”。

* * *

## 回答 #126

> 赞同：13
> 
> 时间：2008-08-15T14:51:42.590

直到最近我才开始真正欣赏“使用”块。他们让事情变得更加整洁:)

* * *

## 回答 #127

> 赞同：13
> 
> 时间：2009-07-30T04:23:58.397

我正在成为扩展方法的忠实拥护者，因为它们可以为现有代码或您无法编辑的代码添加很多想要的功能。我添加到我现在所做的一切中的最爱之一是 string.IsNullOrEmpty()

```
public static class Strings
{
    public static bool IsNullOrEmpty(this string value)
    {
        return string.IsNullOrEmpty(value);
    }
} 
```

这使您可以像这样缩短代码

```
var input = Console.ReadLine();
if (input.IsNullOrEmpty())
{
    Console.WriteLine("try again");
} 
```

* * *

## 回答 #128

> 赞同：13
> 
> 时间：2010-01-08T10:03:33.877

**使用 LINQ 更容易上手/精简的 ORM 映射**

考虑这张表：

```
[MessageId] INT,
[MessageText] NVARCHAR(MAX)
[MessageDate] DATETIME 
```

...而这个结构：

```
struct Message
{
    Int32 Id;
    String Text;
    DateTime Date;
} 
```

而不是按照以下方式做一些事情：

```
List<Message> messages = new List<Message>();

foreach (row in DataTable.Rows)
{
    var message = new Message
    {
        Id = Convert.ToInt32(row["MessageId"]),
        Text = Convert.ToString(row["MessageText"]),
        Date = Convert.ToDateTime(row["MessageDate"])
    };

    messages.Add(message);
} 
```

在我看来，您可以使用 LINQ 并用更少的代码行做同样的事情；更多风格。像这样：

```
var messages = DataTable.AsEnumerable().Select(r => new Message
{
    Id = Convert.ToInt32(r["MessageId"]),
    Text = Convert.ToString(r["MessageText"]),
    Date = Convert.ToDateTime(r["MessageDate"])
}).ToList(); 
```

这种方法可以嵌套，就像循环一样。

* * *

## 回答 #129

> 赞同：13
> 
> 时间：2009-06-05T18:43:55.447

FlagsAttribute，使用枚举制作位掩码时的一个小但[不错的功能：](http://msdn.microsoft.com/en-us/library/system.flagsattribute.aspx)

```
[Flags]
public enum ConfigOptions
{
    None    = 0,
    A       = 1 << 0,
    B       = 1 << 1,
    Both    = A | B
}

Console.WriteLine( ConfigOptions.A.ToString() );
Console.WriteLine( ConfigOptions.Both.ToString() );
// Will print:
// A
// A, B 
```

* * *

## 回答 #130

> 赞同：13
> 
> 时间：2009-11-20T14:57:05.713

# 工厂方法的类型推断

*我不知道这是否已经发布（我扫描了第一个帖子，找不到它）。*

最好用一个例子来说明这一点，假设你有这个类（模拟一个元组），为了演示使这成为可能的所有语言特性，我将逐步进行。

```
public class Tuple<V1, V2> : Tuple
{
    public readonly V1 v1;
    public readonly V2 v2;

    public Tuple(V1 v1, V2 v2)
    {
      this.v1 = v1;
      this.v2 = v2;
    }
} 
```

每个人都知道如何创建它的实例，例如：

```
Tuple<int, string> tup = new Tuple<int, string>(1, "Hello, World!"); 
```

不完全是火箭科学，现在我们当然可以将变量的类型声明更改为*var*，如下所示：

```
var tup = new Tuple<int, string>(1, "Hello, World!"); 
```

还是众所周知的，这里有点离题，这是一个带有类型参数的静态方法，每个人都应该熟悉：

```
public static void Create<T1, T2>()
{
    // stuff
} 
```

再次调用它是众所周知的，这样做是这样的：

```
Create<float, double>(); 
```

大多数人不知道的是，如果泛型方法的参数包含它需要的所有类型，则可以推断它们，例如：

```
public static void Create<T1, T2>(T1 a, T2 b)
{
    // stuff
} 
```

这两个调用是相同的：

```
Create<float, string>(1.0f, "test");
Create(1.0f, "test"); 
```

由于 T1 和 T2 是从您传递的参数中推断出来的。将这些知识与 var 关键字结合起来，我们可以通过添加第二个带有静态方法的静态类，例如：

```
public abstract class Tuple
{
    public static Tuple<V1, V2> Create<V1, V2>(V1 v1, V2 v2)
    {
        return new Tuple<V1, V2>(v1, v2);
    }
} 
```

实现这个效果：

```
var tup = Tuple.Create(1, "Hello, World!"); 
```

这意味着：变量“tup”的类型、“Create”的类型参数和“Create”的返回值都是从您**作为参数传递给 Create的类型推断出来的**

完整的代码如下所示：

```
public abstract class Tuple
{
    public static Tuple<V1, V2> Create<V1, V2>(V1 v1, V2 v2)
    {
        return new Tuple<V1, V2>(v1, v2);
    }
}

public class Tuple<V1, V2> : Tuple
{
    public readonly V1 v1;
    public readonly V2 v2;

    public Tuple(V1 v1, V2 v2)
    {
        this.v1 = v1;
        this.v2 = v2;
    }
}

// Example usage:
var tup = Tuple.Create(1, "test"); 
```

这为您提供了无处不在的完全类型推断的工厂方法！

* * *

## 回答 #131

> 赞同：12
> 
> 时间：2008-09-18T06:08:15.720

可以通过在 a (see ) 中没有代码或`switch`使用特殊的(see ) 或(see ) 形式来实现通过 -s：`case``case``case 0``goto case``case 1``goto default``case 2`

```
switch (/*...*/) {
    case 0: // shares the exact same code as case 1
    case 1:
        // do something
        goto case 2;
    case 2:
        // do something else
        goto default;
    default:
        // do something entirely different
        break;
} 
```

* * *

## 回答 #132

> 赞同：12
> 
> 时间：2008-11-04T23:30:41.453

我错过了很长时间的东西：您可以将字符串与

```
"string".equals("String", StringComparison.InvariantCultureIgnoreCase) 
```

而不是这样做：

```
"string".ToLower() == "String".ToLower(); 
```

* * *

## 回答 #133

> 赞同：12
> 
> 时间：2009-11-30T17:41:12.223

我能想到的一对：

```
[field: NonSerialized()]
public EventHandler event SomeEvent; 
```

这可以防止事件被序列化。'field:' 表示该属性应应用于事件的支持字段。

另一个鲜为人知的特性是覆盖添加/删除事件处理程序：

```
public event EventHandler SomeEvent
{
    add
    {
        // ...
    }

    remove
    {
        // ...
    }
} 
```

* * *

## 回答 #134

> 赞同：11
> 
> 时间：2008-12-03T04:45:34.577

委托语法在 C# 的后续版本中不断发展，但我仍然觉得它们很难记住。幸运的是，`Action<>`和`Func<>`代表很容易记住。

例如：

*   `Action<int>`是一个委托方法，它接受一个 int 参数并返回 void。
*   `Func<int>` 是一个不带参数并返回一个 int 的委托方法。
*   `Func<int, bool>`是一个委托方法，它接受一个 int 参数并返回一个 bool。

这些功能是在 .NET 框架 3.5 版中引入的。

* * *

## 回答 #135

> 赞同：11
> 
> 时间：2008-09-16T13:56:08.140

1.  我还不能发表评论，但请注意，默认情况下 Visual Studio 2008 会自动跳过属性，因此在这种情况下不再需要 DebuggerStepThrough 属性。

2.  另外，我没有注意到有人展示了如何声明一个无参数的 lambda（对于实现 Action<> 很有用）

    `() => DoSomething(x);`

您还应该阅读闭包 - 我不够聪明，无法正确解释它们。但基本上这意味着编译器做了一些聪明的事情，因此即使在创建 lambda 之后它“超出范围”，那行代码中的 x 仍然可以工作。

3.  我最近还发现你可以假装忽略一个 lambda 参数：

    `(e, _) => DoSomething(e)`

它并没有真正忽略它，只是 _ 是一个有效的标识符。所以你不能忽略这样的两个参数，但我认为这是一种巧妙的方式来表明我们不关心那个参数（通常是 EventArgs `.Empty`）。

* * *

## 回答 #136

> 赞同：11
> 
> 时间：2008-09-23T14:44:29.203

有一些运算符用于在声明的类和一个或多个任意类之间执行[`implicit`](http://msdn.microsoft.com/en-us/library/z5z9kes2.aspx)和[`explicit`](http://msdn.microsoft.com/en-us/library/xhbhezf4.aspx)用户定义的类型转换。该`implicit`运算符有效地允许模拟重载赋值运算符，这在 C++ 等语言中是可能的，但在 C# 中是不可能的。

它似乎不是一个经常遇到的功能，但实际上它在[LINQ to XML](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_XML) ( `System.Xml.Linq`) 库中使用，您可以在其中将字符串隐式转换为`XName`对象。例子：

```
XName tagName = "x:Name"; 
```

[我在这篇](http://www.codeproject.com/KB/architecture/smip.aspx)关于如何在 C# 中模拟多重继承的文章中发现了这个特性。

* * *

## 回答 #137

> 赞同：11
> 
> 时间：2008-08-14T10:59:21.430

我喜欢这样一个事实，即我可以在普通的旧 .NET 2.0 上使用 LINQ 对象（即无需在任何地方安装 .NET 3.5）。您所需要的只是所有查询运算符扩展方法的实现 - 请参阅[LINQBridge](http://www.albahari.com/nutshell/linqbridge.html)

* * *

## 回答 #138

> 赞同：11
> 
> 时间：2009-03-06T11:49:20.110

如果方法参数实现了两个接口，您可以使用泛型检查（编译时）：

```
interface IPropA 
{
    string PropA { get; set; } 
}

interface IPropB 
{
    string PropB { get; set; }
}

class TestClass 
{
    void DoSomething<T>(T t) where T : IPropA, IPropB 
    {
        MessageBox.Show(t.PropA);
        MessageBox.Show(t.PropB);
    }
} 
```

与从基类和接口继承的参数相同。

* * *

## 回答 #139

> 赞同：11
> 
> 时间：2009-07-02T00:34:17.423

可以调用扩展方法`null`；这不会导致 a`NullReferenceException`被抛出。

示例应用程序：您可以为被调用定义一个替代方法，它在`ToString()`调用`ToStringOrEmpty()`时将返回空字符串`null`。

* * *

## 回答 #140

> 赞同：10
> 
> 时间：2009-09-09T11:14:47.410

嵌套类可以访问外部类的私有成员。

```
public class Outer
{
    private int Value { get; set; }

    public class Inner
    {
        protected void ModifyOuterMember(Outer outer, int value)
        {
            outer.Value = value;
        }
    }
} 
```

现在与上述功能一起，您还可以从嵌套类继承，就好像它们是顶级类一样，如下所示。

```
public class Cheater : Outer.Inner
{
    protected void MakeValue5(Outer outer)
    {
        ModifyOuterMember(outer, 5);
    }
} 
```

这些功能允许一些有趣的可能性，只要通过一些隐藏的类提供对特定成员的访问。

* * *

## 回答 #141

> 赞同：10
> 
> 时间：2010-03-27T23:38:47.077

You can change rounding scheme using:

```
var value = -0.5;
var value2 = 0.5;
var value3 = 1.4;

Console.WriteLine( Math.Round(value, MidpointRounding.AwayFromZero) ); //out: -1
Console.WriteLine(Math.Round(value2, MidpointRounding.AwayFromZero)); //out: 1
Console.WriteLine(Math.Round(value3, MidpointRounding.ToEven)); //out: 1 
```

* * *

## 回答 #142

> 赞同：10
> 
> 时间：2009-06-30T08:55:57.547

`Or`赋值运算符非常好。你可以这样写：

```
x |= y 
```

而不是这个：

```
x = x | y 
```

如果您必须有一个变量或属性（*在*示例`x`中）`false`以.*`true`*

 ** * *

## 回答 #143

> 赞同：10
> 
> 时间：2008-12-13T21:53:01.053

要调用基类构造函数，只需将 base() 与构造函数内联。
要调用基类方法，您只需将 base.MethodName() 放在派生类方法中

```
class ClassA 
{
  public ClassA(int a)
  {
    //Do something
  }

  public void Method1()
  {
     //Do Something
  }
}

class ClassB : ClassA
{
  public ClassB(int a) : base(a) // calling the base class constructor
  {
    //Do something
  }

  public void Method2()
  {
    base.Method1();               // calling the base class method
  }
} 
```

当然你可以调用基类的方法，只要说`base.MethodName()`

* * *

## 回答 #144

> 赞同：10
> 
> 时间：2008-12-23T12:27:07.580

TrueForAll 方法`List<T>`：

```
List<int> s = new List<int> { 6, 1, 2 };

bool a = s.TrueForAll(p => p > 0); 
```

* * *

## 回答 #145

> 赞同：10
> 
> 时间：2009-05-08T15:35:04.417

很少有人知道的一件事是一些 C# 引入的预处理器指令。您可以使用`#error This is an error.`生成编译器错误和`#warning This is a warning.`

当我使用自上而下的方法作为“待办事项”列表进行开发时，我通常使用这些。我会的`#error Implement this function`，或者`#warning Eventually implement this corner case`作为提醒。

* * *

## 回答 #146

> 赞同：10
> 
> 时间：2009-06-19T13:08:28.730

不确定这个是否已经被提及，但 ThreadStatic 属性是一个非常有用的属性。这使得静态字段仅适用于当前线程。

```
[ThreadStatic]
private static int _ThreadStaticInteger; 
```

您不应该包含初始化程序，因为它只为整个应用程序执行一次，您最好使该字段可为空并在使用它之前检查该值是否为空。

ASP.NET 应用程序线程的另一件事是重用，因此如果您修改该值，它最终可能会被用于另一个页面请求。

我仍然在好几次发现这很有用。例如，在创建自定义事务类时：

```
using (DbTransaction tran = new DbTransaction())
{
    DoQuery("...");
    DoQuery("...");    
} 
```

DbTransaction 构造函数将 ThreadStatic 字段设置为其自身，并在 dispose 方法中将其重置为 null。DoQuery 检查静态字段，如果 != null 使用当前事务，如果不是，则默认为其他内容。我们避免了将事务传递给每个方法，而且它可以轻松地将原本不打算与事务一起使用的其他方法包装在事务中......

只有一种用途:)

* * *

## 回答 #147

> 赞同：9
> 
> 时间：2008-08-19T16:07:50.390

如果您希望在 Debug 和 Release 模式之间有不同的行为，预处理器指令可能会很漂亮。

[http://msdn.microsoft.com/en-us/library/ed8yd1ha.aspx](http://msdn.microsoft.com/en-us/library/ed8yd1ha.aspx)

* * *

## 回答 #148

> 赞同：9
> 
> 时间：2008-09-23T14:36:02.750

```
System.Diagnostics.Debug.Assert (false); 
```

将触发一个弹出窗口，并允许您在执行期间将调试器附加到正在运行的 .NET 进程。对于那些由于某种原因不能直接调试 ASP.NET 应用程序的时候非常有用。

* * *

## 回答 #149

> 赞同：9
> 
> 时间：2009-04-02T10:35:23.747

Working with enums.

Convert a string to an Enum:

```
enum MyEnum
{
    FirstValue,
    SecondValue,
    ThirdValue
}

string enumValueString = "FirstValue";
MyEnum val = (MyEnum)Enum.Parse(typeof(MyEnum), enumValueString, true) 
```

*   I use this to load the value of CacheItemPriority in my ASP.NET applications from a settings table in a database so that I can control caching (along with other settings) dynamically without taking the application down.

When comparing variables of type enum, you don't have to cast to int:

```
MyEnum val = MyEnum.SecondValue;
if (val < MyEnum.ThirdValue)
{
    // Do something
} 
```

* * *

## 回答 #150

> 赞同：9
> 
> 时间：2008-10-01T11:51:29.697

字符串实习。这是我在这个讨论中还没有看到的一个。它有点晦涩，但在某些情况下它可能很有用。

CLR 保留对文字字符串（和以编程方式进行的字符串）的引用表。如果您在代码中的多个位置使用相同的字符串，它将在表中存储一次。这可以减轻分配字符串所需的内存量。

您可以使用 String.IsInterned(string) 测试字符串是否被实习，并且可以使用[String.Intern(string)](http://msdn.microsoft.com/en-us/library/system.string.isinterned.aspx)[来](http://msdn.microsoft.com/en-us/library/system.string.intern.aspx)实习字符串。

**注意：** CLR 可以在应用程序甚至 AppDomain 结束后保存对实习字符串的引用。有关详细信息，请参阅 MSDN 文档。

* * *

## 回答 #151

> 赞同：9
> 
> 时间：2009-04-02T16:30:33.247

我非常喜欢函数的隐式泛型参数。例如，如果您有：

```
public void DoStuff<T>(T value); 
```

而不是这样称呼它：

```
DoStuff<int>(5); 
```

你可以：

```
DoStuff(5); 
```

它会根据参数的类型计算出泛型类型。

*   如果您通过反射调用该方法，这将不起作用。
*   我记得在 Mono 上遇到了一些奇怪的问题。

* * *

## 回答 #152

> 赞同：9
> 
> 时间：2008-11-24T12:51:58.030

`IEnumerable`'s `SelectMany`，它将列表列表扁平化为单个列表。假设我有一个 列表`Orders`，并且每个`Order`列表都有一个`LineItems`按该顺序排列的列表。

我想知道总`LineItems`销量...

```
int totalItems = Orders.Select(o => o.LineItems).SelectMany(i => i).Sum(); 
```

* * *

## 回答 #153

> 赞同：9
> 
> 时间：2010-03-01T22:37:19.970

要使用 LINQ 测试 IEnumerable`<T>`是否为空，请使用：

> IEnumerable `<T>`.Any();

*   起初，我使用的是 (IEnumerable `<T>`.Count() != 0)...
    *   这不必要地导致`<T>`枚举 IEnumerable 中的所有项目。
*   作为对此的改进，我继续使用 (IEnumerable `<T>`.FirstOrDefault() == null)...
    *   哪个更好...
*   但是 IEnumerable `<T>`.Any() 是最简洁且性能最好的。

* * *

## 回答 #154

> 赞同：8
> 
> 时间：2008-08-24T07:52:19.547

我很确定每个人都熟悉运算符重载，但也许有些人不熟悉。

```
class myClass
{
    private string myClassValue = "";

    public myClass(string myString)
    {
        myClassValue = myString;
    }

    public override string ToString()
    {
        return myClassValue;
    }

    public static myClass operator <<(myClass mc, int shiftLen)
    {
        string newString = "";
        for (int i = shiftLen; i < mc.myClassValue.Length; i++)
            newString += mc.myClassValue[i].ToString();
        mc.myClassValue = newString.ToString();
        return mc;
    }

    public static myClass operator >>(myClass mc, int shiftLen)
    {
        char[] newString = new char[shiftLen + mc.myClassValue.Length];

        for (int i = shiftLen; i < mc.myClassValue.Length; i++)
            newString[i] += mc.myClassValue[i - shiftLen];

        mc.myClassValue = new string(newString);
        return mc;
    }

    public static myClass operator +(myClass mc, string args)
    {
        if (args.Trim().Length > 1)
            mc.myClassValue += args;
        return mc;
    }

    public static myClass operator -(myClass mc, string args)
    {
        if (args.Trim().Length > 1)
        {
            Regex rgx = new Regex(args);
            mc.myClassValue = rgx.Replace(mc.myClassValue, "");
        }
        return mc;
    }
} 
```

我认为能够使用 << 和 >> 左右移动字符串或使用 -= 删除遵循正则表达式模式的一组字符串非常酷

```
myClass tmpClass = new myClass("  HelloWorld123");
tmpClass -= @"World";
tmpClass <<= 2;
Console.WriteLine(tmpClass); 
```

* * *

## 回答 #155

> 赞同：8
> 
> 时间：2009-11-05T00:10:43.080

C# allows you to add property setter methods to concrete types that implement readonly interface properties even though the interface declaration itself has no property setter. For example:

```
public interface IReadOnlyFoo
{
   object SomeReadOnlyProperty { get; }
} 
```

The concrete class looks like this:

```
internal class Foo : IReadOnlyFoo
{
   public object SomeReadOnlyProperty { get; internal set; }
} 
```

What's interesting about this is that the Foo class is immutable if you cast it to the IReadOnlyFoo interface:

```
// Create a Foo instance
Foo foo = new Foo();

// This statement is legal
foo.SomeReadOnlyProperty = 12345;

// Make Foo read only
IReadOnlyFoo readOnlyFoo = foo;

// This statement won't compile
readOnlyFoo.SomeReadOnlyProperty = 54321; 
```

* * *

## 回答 #156

> 赞同：8
> 
> 时间：2008-10-13T22:32:10.360

你可以打开字符串！

```
switch(name)
{
  case "Dave":
    return true;
  case "Bob":
    return false;
  default:
    throw new ApplicationException();
} 
```

非常便利！并且比一堆 if-else 语句更干净

* * *

## 回答 #157

> 赞同：8
> 
> 时间：2008-09-08T22:49:47.673

不是 C# 特定的东西，但我是一个三元操作迷。

代替

```
if (boolean Condition)
{
    //Do Function
}
else
{
    //Do something else
} 
```

你可以用简洁的

```
booleanCondtion ? true operation : false operation; 
```

例如

代替

```
int value = param;
if (doubleValue)
{
    value *= 2;
}
else
{
    value *= 3;
} 
```

你可以输入

```
int value = param * (tripleValue ? 3 : 2); 
```

它确实有助于编写简洁的代码，但是嵌套这些该死的东西可能很讨厌，而且它们可以用来作恶，但我仍然喜欢这些小傻瓜

* * *

## 回答 #158

> 赞同：8
> 
> 时间：2009-08-07T00:13:41.060

在 C# 3.5 中初始化字典的表达式：

`new Dictionary<string, Int64>() {{"Testing", 123}, {"Test", 125}};`

* * *

## 回答 #159

> 赞同：8
> 
> 时间：2009-05-04T19:57:08.820

而不是像这样做一些俗气的事情：

```
Console.WriteLine("{0} item(s) found.", count); 
```

我使用以下内联技巧：

```
Console.WriteLine("{0} item{1} found.", count, count==1 ? "" : "s"); 
```

当有一个项目时，这将显示“项目”，或者当多于（或少于）1 个时显示“项目”。对于一点专业性来说，没有太多的努力。

* * *

## 回答 #160

> 赞同：8
> 
> 时间：2009-12-07T08:26:16.287

字典初始化器对于需要硬编码某些数据的快速破解和单元测试总是有用的。

```
var dict = new Dictionary<int, string> { { 10, "Hello" }, { 20, "World" } }; 
```

* * *

## 回答 #161

> 赞同：8
> 
> 时间：2010-03-20T18:00:45.117

使用 LINQ，可以基于参数创建新函数。如果你有一个经常执行的小函数，那就太好了，但是参数需要一些时间来计算。

```
 public Func<int> RandomGenerator
    {
        get
        {
            var r = new Random();
            return () => { return r.Next(); };
        }
    }

    void SomeFunction()
    {
        var result1 = RandomGenerator();

        var x = RandomGenerator;
        var result2 = x();
    } 
```

* * *

## 回答 #162

> 赞同：7
> 
> 时间：2008-08-20T19:17:16.330

您输入“prop”，然后按 [TAB] 两次，它会为您的属性生成有用的代码，并可以加快您的输入速度。

我知道这适用于 VS 2005（我使用它），但我不知道在以前的版本中。

* * *

## 回答 #163

> 赞同：7
> 
> 时间：2008-12-15T15:03:09.210

**C# 4.0 中的动态关键字**

如果您希望仅在运行时解析方法调用，则可以使用 dynamic 关键字。

```
dynamic invoker=new DynamicInvoker();
dynamic result1=invoker.MyMethod1();
dynamic result2=invoker.MyMethod2(); 
```

在这里，我正在实现一个动态调用程序。

```
public class DynamicInvoker : IDynamicObject
    {
        public MetaObject GetMetaObject
              (System.Linq.Expressions.Expression parameter)
        {
            return new DynamicReaderDispatch (parameter);
        }
    }

    public class DynamicDispatcher : MetaObject
    {
        public DynamicDispatcher (Expression parameter) 
                   : base(parameter, Restrictions.Empty){ }

        public override MetaObject Call(CallAction action, MetaObject[] args)
        {
            //You'll get MyMethod1 and MyMethod2 here (and what ever you call)
            Console.WriteLine("Logic to invoke Method '{0}'", action.Name);
            return this; //Return a meta object
        }
    } 
```

* * *

## 回答 #164

> 赞同：7
> 
> 时间：2008-11-25T22:53:40.513

这不是 C# 特定类型，但我刚刚找到了 ISurrogateSelector 和 ISerializationSurrogate 接口——

[http://msdn.microsoft.com/en-us/library/system.runtime.serialization.isurrogateselector.aspx](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.isurrogateselector.aspx)

[http://msdn.microsoft.com/en-us/library/system.runtime.serialization.isurrogateselector.aspx](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.isurrogateselector.aspx)

将这些与 BinaryFormatter 结合使用允许通过代理类的实现来序列化不可序列化的对象。代理模式在计算机科学中很容易理解，尤其是在处理序列化问题时。我认为这个实现只是作为构造函数的参数隐藏到 BinaryFormatter，这太糟糕了。

仍然 - 非常隐蔽。:)

* * *

## 回答 #165

> 赞同：7
> 
> 时间：2009-06-03T15:03:23.143

在设计视图中查看组件时要显示的属性：

```
private double _Zoom = 1;

[Category("View")]
[Description("The Current Zoom Level")]
public double Zoom
{
get { return _Zoom;}
set { _Zoom = value;}
} 
```

让您的组件库的其他用户更轻松。

* * *

## 回答 #166

> 赞同：7
> 
> 时间：2008-08-14T11:07:01.447

除了 duncansmart 的回复，Framework 2.0 上也可以使用扩展方法。只需`ExtensionAttribute`在 System.Runtime.CompilerServices 命名空间下添加一个类，您就可以使用扩展方法（当然仅适用于 C# 3.0）。

```
namespace System.Runtime.CompilerServices
{
    public class ExtensionAttribute : Attribute
    { 
    }
} 
```

* * *

## 回答 #167

> 赞同：7
> 
> 时间：2009-06-14T17:31:46.930

## 高级调试

### 展示

已经提到的属性 DebuggerDisplay 和 DebuggerBrowsable 控制元素的可见性和显示的文本值。简单地覆盖 ToString() 将导致调试器使用该方法的输出。

如果您想要更复杂的输出，您可以使用/创建[Debugger Visualizer ，](http://msdn.microsoft.com/en-us/library/zayyhzts.aspx)[此处](http://www.dotnetpowered.com/DebuggerVisualizers.aspx)提供了几个示例。

### 罢工之子

Microsoft 提供称为[SOS](http://msdn.microsoft.com/en-us/library/bb190764(vs.80).aspx)的调试器扩展。这是一个非常强大（虽然经常令人困惑）的扩展，它是诊断“泄漏”的极好方法，更准确地说是对不再需要的对象的不需要的引用。

### 用于框架源的符号服务器

遵循这些[说明](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)将允许您逐步了解框架某些部分的源代码。

### 2010年的变化

Visual Studio 2010 中存在一些增强功能和新功能：

*   [调试并行任务](http://www.danielmoth.com/Blog/2009/05/parallel-tasks-new-visual-studio-2010.html)
*   [并行堆栈](http://www.danielmoth.com/Blog/2009/05/parallel-stacks-another-new-vs2010.html)允许同时查看多个线程调用堆栈。
*   [历史调试](http://channel9.msdn.com/posts/VisualStudio/Historical-Debugger-and-Test-Impact-Analysis-in-Visual-Studio-Team-System-2010/)可让您及时查看事件和非局部变量（只要您提前启用收集）。调试方式可能会发生重大变化。

* * *

## 回答 #168

> 赞同：7
> 
> 时间：2009-06-22T05:42:31.580

```
HttpContext.Current.Server.Execute 
```

is great for rendering HTML to strings for AJAX callbacks. You can use this with a component instead of piecing together HTML string snippets. I was able to cut page bloat down a couple of hundred KB with virtually no mess. I used it like this:

```
Page pageHolder = new Page();
UserControl viewControl = (UserControl)pageHolder.LoadControl(@"MyComponent.ascx");
pageHolder.Controls.Add(viewControl);
StringWriter output = new StringWriter();
HttpContext.Current.Server.Execute(pageHolder, output, false);
return output.ToString(); 
```

* * *

## 回答 #169

> 赞同：7
> 
> 时间：2008-10-25T09:53:31.090

## Object.ReferenceEquals 方法

确定指定的 Object 实例是否为同一个实例。

**参数：**

*   objA: System.Object - 要比较的第一个对象。
*   objB：System.Object - 要比较的第二个对象。

**例子：**

```
 object o = null;
 object p = null;
 object q = new Object();

 Console.WriteLine(Object.ReferenceEquals(o, p));
 p = q;
 Console.WriteLine(Object.ReferenceEquals(p, q));
 Console.WriteLine(Object.ReferenceEquals(o, p)); 
```

**与“==”和“.Equals”的区别：**

基本上，对象 A 的 Equals() 测试与对象 B 具有相同的内容。

System.Object.ReferenceEquals() 方法总是比较引用。尽管类可以为相等运算符（如下）提供自己的行为，但如果通过对 System.Object 的引用调用运算符，则不会调用重新定义的运算符。

对于字符串并没有真正的区别，因为 == 和 Equals 都已被覆盖以比较字符串的内容。

另请参阅另一个问题的[答案](https://stackoverflow.com/questions/73713/how-do-i-check-for-nulls-in-an-operator-overload-without-infinite-recursion#73732)（“如何在没有无限递归的情况下检查 '==' 运算符重载中的空值？”）。

* * *

## 回答 #170

> 赞同：7
> 
> 时间：2008-11-18T15:56:03.277

[显式接口成员实现](http://msdn.microsoft.com/en-us/library/aa664591(VS.71).aspx)，其中实现了接口成员，但隐藏，除非实例被强制转换为接口类型。

* * *

## 回答 #171

> 赞同：7
> 
> 时间：2009-01-24T05:22:17.283

您可以在非泛型类中使用泛型方法。

* * *

## 回答 #172

> 赞同：7
> 
> 时间：2010-05-14T18:46:21.680

我正在阅读“Pro ASP.NET MVC Framework”（APress）一书，并观察到作者正在对我不熟悉的 Dictionary 对象做一些事情。

他在不使用 Add() 方法的情况下添加了一个新的键/值对。然后，他覆盖了相同的键/值对，而无需检查该键是否已经存在。例如：

```
Dictionary<string, int> nameAgeDict = new Dictionary<string, int>();
nameAgeDict["Joe"] = 34;      // no error. will just auto-add key/value
nameAgeDict["Joe"] = 41;      // no error. key/value just get overwritten
nameAgeDict.Add("Joe", 30);   // ERROR! key already exists 
```

在很多情况下，我不需要检查我的字典是否已经有键，我只想添加相应的键/值对（如果需要，覆盖现有的键/值对。）在此发现之前，我总是必须在添加之前检查密钥是否已经存在。

* * *

## 回答 #173

> 赞同：7
> 
> 时间：2009-05-19T15:52:52.263

不指定数组元素类型的数组初始化：

```
var pets = new[] { "Cat", "Dog", "Bird" }; 
```

* * *

## 回答 #174

> 赞同：7
> 
> 时间：2009-04-01T21:50:41.820

这是我最近发现的一个有用的：

```
Microsoft.VisualBasic.Logging.FileLogTraceListener 
```

[MSDN 链接](http://msdn.microsoft.com/en-us/library/microsoft.visualbasic.logging.filelogtracelistener.aspx)

这是一个 TraceListener 实现，它有很多特性，比如自动日志文件翻转，我以前会使用自定义日志框架。好处是它是 .NET 的核心部分，并与 Trace 框架集成，因此易于上手并立即使用。

这是“隐藏的”，因为它在 Microsoft.VisualBasic 程序集中……但您也可以在 C# 中使用它。

* * *

## 回答 #175

> 赞同：7
> 
> 时间：2009-08-21T11:30:38.153

使用 LINQ 对过去采用迭代和条件的集合进行内联工作的能力非常有价值。值得学习所有 LINQ 扩展方法如何帮助您的代码更加紧凑和可维护。

* * *

## 回答 #176

> 赞同：7
> 
> 时间：2009-06-19T01:59:31.780

您可以从扩展方法创建委托，就好像它们是常规方法一样，对`this`参数进行柯里化。例如，

```
static class FunnyExtension {
    public static string Double(this string str) { return str + str; }
    public static int Double(this int num) { return num + num; }
}

Func<string> aaMaker = "a".Double;
Func<string, string> doubler = FunnyExtension.Double;

Console.WriteLine(aaMaker());       //Prints "aa"
Console.WriteLine(doubler("b"));    //Prints "bb" 
```

请注意，这不适用于扩展值类型的扩展方法；看到[这个问题](https://stackoverflow.com/questions/1016033/extension-methods-defined-on-value-types-cannot-be-used-to-create-delegates-why)。

* * *

## 回答 #177

> 赞同：7
> 
> 时间：2009-01-31T04:50:20.090

使用 lambdas 时模拟功能性“通配符”参数（如 Haskell 中的“_”）的酷技巧：

```
(_, b, __) => b.DoStuff();  // only interested in b here 
```

* * *

## 回答 #178

> 赞同：7
> 
> 时间：2009-07-22T01:42:45.620

```
[field: NonSerialized]
public event EventHandler Event; 
```

这样，事件监听器就不会被序列化。

只是 [NonSerialized] 不起作用，因为 NonSerializedAttribute 只能应用于字段。

* * *

## 回答 #179

> 赞同：7
> 
> 时间：2010-04-05T12:25:40.910

我喜欢

```
#if DEBUG
           //Code run in debugging mode

#else
           //Code run in release mode

#endif 
```

* * *

## 回答 #180

> 赞同：7
> 
> 时间：2009-04-26T16:11:10.087

在泛型代码中使用 default 关键字来返回类型的默认值。

```
public class GenericList<T>
{
    private class Node
    {
        //...

        public Node Next;
        public T Data;
    }

    private Node head;

    //...

    public T GetNext()
    {
        T temp = default(T);

        Node current = head;
        if (current != null)
        {
            temp = current.Data;
            current = current.Next;
        }
        return temp;
    }
} 
```

[这里的另一个例子](https://stackoverflow.com/questions/367378/returning-a-default-value-c)

* * *

## 回答 #181

> 赞同：7
> 
> 时间：2010-07-06T19:46:43.967

不确定这个是否被提及（11 页！！）

但是，`OptionalField`当您对将要被序列化的类/对象进行版本控制时，类的属性是惊人的。

[http://msdn.microsoft.com/en-us/library/ms229752(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms229752(VS.80).aspx)

* * *

## 回答 #182

> 赞同：7
> 
> 时间：2009-05-14T09:05:37.560

当您想要 Invoke/BeginInvoke 内联代码时，内置 (2.0) MethodInvoker 委托很有用。这避免了需要创建一个实际的委托和单独的方法。

```
 void FileMessageEvent(object sender, MessageEventArgs e)
    {

        if (this.InvokeRequired == true)
        {
            this.BeginInvoke((MethodInvoker)delegate { 
                     lblMessage.Text=e.Message; 
                     Application.DoEvents(); 
                 }
            ); 

        }
    } 
```

解决错误：“无法将匿名方法转换为类型 'System.Delegate'，因为它不是委托类型”。

* * *

## 回答 #183

> 赞同：7
> 
> 时间：2009-08-14T12:13:18.657

Eric Lippert 的[四个开关怪事](http://blogs.msdn.com/ericlippert/archive/2009/08/13/four-switch-oddities.aspx)

* * *

## 回答 #184

> 赞同：7
> 
> 时间：2009-08-07T06:37:19.330

我认为没有人提到过该附加？在值类型名称之后将使其可为空。

你可以做：

```
DateTime? date = null; 
```

DateTime 是一个结构。

* * *

## 回答 #185

> 赞同：6
> 
> 时间：2008-12-16T22:16:59.270

这不是 C# 特有的功能，但它是一个我觉得非常有用的插件。它被称为资源重构工具。它允许您右键单击文字字符串并将其提取到资源文件中。它将搜索代码并找到任何其他匹配的文字字符串，并将其替换为 Resx 文件中的相同资源。

[http://www.codeplex.com/ResourceRefactoring](http://www.codeplex.com/ResourceRefactoring)

* * *

## 回答 #186

> 赞同：6
> 
> 时间：2008-10-06T21:16:08.717

Instead of using int.TryParse() or Convert.ToInt32(), I like having a static integer parsing function that returns null when it can't parse. Then I can use ?? and the ternary operator together to more clearly ensure my declaration and initialization are all done on one line in a easy-to-understand way.

```
public static class Parser {
    public static int? ParseInt(string s) {
        int result;
        bool parsed = int.TryParse(s, out result);
        if (parsed) return result;
        else return null;
    }
    // ...
} 
```

This is also good to avoid duplicating the left side of an assignment, but even better to avoid duplicating long calls on the right side of an assignment, such as a database calls in the following example. Instead of ugly if-then trees (which I run into often):

```
int x = 0;
YourDatabaseResultSet data = new YourDatabaseResultSet();
if (cond1)
    if (int.TryParse(x_input, x)){
        data = YourDatabaseAccessMethod("my_proc_name", 2, x);
    }
    else{
        x = -1;
        // do something to report "Can't Parse"    
    }
}
else {
    x = y;
    data = YourDatabaseAccessMethod("my_proc_name", 
       new SqlParameter("@param1", 2),
       new SqlParameter("@param2", x));
} 
```

You can do:

```
int x = cond1 ? (Parser.ParseInt(x_input) ?? -1) : y;
if (x >= 0)  data = YourDatabaseAccessMethod("my_proc_name", 
    new SqlParameter("@param1", 2),
    new SqlParameter("@param2", x)); 
```

Much cleaner and easier to understand

* * *

## 回答 #187

> 赞同：6
> 
> 时间：2008-11-17T09:28:42.047

关于`foreach`：它不使用“鸭子打字”，因为鸭子打字IMO指的是运行时检查。它在编译时使用*结构类型检查*（而不是名义上的）来检查类型中所需的方法。

* * *

## 回答 #188

> 赞同：6
> 
> 时间：2008-09-19T15:59:09.043

文字可以用作该类型的变量。例如。

```
Console.WriteLine(5.ToString());
Console.WriteLine(5M.GetType());   // Returns "System.Decimal"
Console.WriteLine("This is a string!!!".Replace("!!", "!")); 
```

只是一点琐事...

有很多事情人们没有提到，但它们主要与不安全的构造有关。这是一个可以被“常规”代码使用的代码：

选中/未选中的关键字：

```
public static int UncheckedAddition(int a, int b)
{
    unchecked { return a + b; }
}

public static int CheckedAddition(int a, int b)
{
    checked { return a + b; } // or "return checked(a + b)";
}

public static void Main() 
{
    Console.WriteLine("Unchecked: " + UncheckedAddition(Int32.MaxValue, + 1));  // "Wraps around"
    Console.WriteLine("Checked: " + CheckedAddition(Int32.MaxValue, + 1));  // Throws an Overflow exception
    Console.ReadLine();
} 
```

* * *

## 回答 #189

> 赞同：6
> 
> 时间：2009-06-07T07:26:09.073

可以为枚举定义数据类型：

```
enum EnumName : [byte, char, int16, int32, int64, uint16, uint32, uint64]
{
    A = 1,
    B = 2
} 
```

* * *

## 回答 #190

> 赞同：6
> 
> 时间：2008-08-28T20:07:41.743

Thought about **@dp AnonCast** and decided to try it out a bit. Here's what I come up with that might be useful to some:

```
// using the concepts of dp's AnonCast
static Func<T> TypeCurry<T>(Func<object> f, T type)
{
    return () => (T)f();
} 
```

And here's how it might be used:

```
static void Main(string[] args)
{

    var getRandomObjectX = TypeCurry(GetRandomObject,
        new { Name = default(string), Badges = default(int) });

    do {

        var obj = getRandomObjectX();

        Console.WriteLine("Name : {0} Badges : {1}",
            obj.Name,
            obj.Badges);

    } while (Console.ReadKey().Key != ConsoleKey.Escape);

}

static Random r = new Random();
static object GetRandomObject()
{
    return new {
        Name = Guid.NewGuid().ToString().Substring(0, 4),
        Badges = r.Next(0, 100)
    };
} 
```

* * *

## 回答 #191

> 赞同：6
> 
> 时间：2008-08-12T18:40:45.340

@布拉德·巴克

我认为如果您必须使用可为空的类型，最好使用 Nullable<.T> 而不是问号表示法。这使得魔法正在发生的事情变得非常明显。不知道为什么有人会想使用 Nullable<.bool> 。:-)

Krzysztof Cwalina（框架设计指南的作者之一）在这里有一篇很好的帖子：http: [//blogs.msdn.com/kcwalina/archive/2008/07/16/Nullable.aspx](http://blogs.msdn.com/kcwalina/archive/2008/07/16/Nullable.aspx)

[Mike Hadlow 在Nullability Voodoo](http://mikehadlow.blogspot.com/2006/10/nullability-voodoo.html)上有一篇不错的帖子

* * *

## 回答 #192

> 赞同：6
> 
> 时间：2008-08-12T19:40:28.030

没有特别的顺序：

```
Lists<>
Mutex 
```

Framework 3.5 中的新属性定义快捷方式。

* * *

## 回答 #193

> 赞同：6
> 
> 时间：2008-09-17T20:28:37.203

**新修饰符**

C# 中“new”修饰符的使用并没有完全隐藏，但并不常见。当您需要“隐藏”基类成员而不总是覆盖它们时，新修饰符会派上用场。这意味着当您将派生类转换为基类时，“隐藏”方法变得可见并被调用，而不是派生类中的相同方法。

在代码中更容易看到：

```
public class BaseFoo
{
    virtual public void DoSomething()
    {
        Console.WriteLine("Foo");
    }
}

public class DerivedFoo : BaseFoo
{
    public new void DoSomething()
    {
        Console.WriteLine("Bar");
    }
}

public class DerivedBar : BaseFoo
{
    public override void DoSomething()
    {
        Console.WriteLine("FooBar");
    }
}

class Program
{
    static void Main(string[] args)
    {
        BaseFoo derivedBarAsBaseFoo = new DerivedBar();
        BaseFoo derivedFooAsBaseFoo = new DerivedFoo();

        DerivedFoo derivedFoo = new DerivedFoo();

        derivedFooAsBaseFoo.DoSomething(); //Prints "Foo" when you might expect "Bar"
        derivedBarAsBaseFoo.DoSomething(); //Prints "FooBar"

        derivedFoo.DoSomething(); //Prints "Bar"
    }
} 
```

[Ed：我会因为双关语而获得加分吗？对不起，帮不上忙。]

* * *

## 回答 #194

> 赞同：6
> 
> 时间：2009-09-27T19:04:44.140

开放泛型是另一个方便的功能，尤其是在使用[Inversion of Control](http://en.wikipedia.org/wiki/Inversion_of_control)时：

```
container.RegisterType(typeof(IRepository<>), typeof(NHibernateRepository<>)); 
```

* * *

## 回答 #195

> 赞同：6
> 
> 时间：2008-11-18T15:52:15.843

（我只用过这个）设置一个字段 null 并在没有中间变量的情况下返回它：

```
try
{
    return _field;
}
finally
{
    _field = null;
} 
```

* * *

## 回答 #196

> 赞同：6
> 
> 时间：2009-06-18T03:44:34.440

Yield 关键字功能强大时经常被忽视。不久前我在博客上讨论过它的好处（不同的处理），并在产量的背后发生，以帮助加深理解。

[在 C# 中使用产量](http://jxs.me/2010/05/14/using-yield-in-c/)

* * *

## 回答 #197

> 赞同：6
> 
> 时间：2008-08-25T15:09:18.617

在阅读有关 .NET 框架开发的书时。一个好的建议是不要使用 bool 来打开或关闭东西，而是使用 ENums。

使用 ENums，您可以为自己提供一些可扩展性，而无需重写任何代码来为函数添加新功能。

* * *

## 回答 #198

> 赞同：6
> 
> 时间：2008-11-04T23:24:03.120

Math.Max 和 Min 检查边界：我在很多代码中都看到了这一点：

```
if (x < lowerBoundary) 
{
   x = lowerBoundary;
} 
```

我发现这个更小、更干净、更易读：

```
x = Math.Max(x, lowerBoundary); 
```

或者您也可以使用三元运算符：

```
x = ( x < lowerBoundary) ? lowerBoundary : x; 
```

* * *

## 回答 #199

> 赞同：6
> 
> 时间：2009-07-22T08:39:34.373

我特别喜欢可以为空的 DateTime。因此，如果您在某些情况下给出了日期，而在其他情况下没有给出日期，我认为这是最好使用的，恕我直言，更容易理解为使用`DateTime.MinValue`或其他任何东西......

```
DateTime? myDate = null;

if (myDate.HasValue)
{
    //doSomething
}
else
{
    //soSomethingElse
} 
```

* * *

## 回答 #200

> 赞同：6
> 
> 时间：2009-05-26T21:23:24.767

刚刚了解了不变性、协变和逆变的含义，我发现了将包含在 .NET 4.0 中的[in](http://msdn.microsoft.com/en-us/library/dd469484(VS.100).aspx)和[out泛型修饰符。](http://msdn.microsoft.com/en-us/library/dd469487(VS.100).aspx)它们看起来很模糊，以至于大多数程序员都不知道它们。

Visual Studio Magazine 上有[一篇文章](http://visualstudiomagazine.com/articles/2009/05/01/generic-covariance-and-contravariance-in-c-40.aspx)讨论了这些关键字以及如何使用它们。

* * *

## 回答 #201

> 赞同：6
> 
> 时间：2009-05-19T11:00:33.940

在将它们与以下内容结合之前，我无法弄清楚`Convert`该类中的某些函数有什么用途（例如 Convert.ToDouble(int)、Convert.ToInt(double)）`Array.ConvertAll`：

```
int[] someArrayYouHaveAsInt;
double[] copyOfArrayAsDouble = Array.ConvertAll<int, double>(
                                someArrayYouHaveAsInt,
                                new Converter<int,double>(Convert.ToDouble)); 
```

这避免了由定义内联委托/闭包引起的资源分配问题（并且更具可读性）：

```
int[] someArrayYouHaveAsInt;
double[] copyOfArrayAsDouble = Array.ConvertAll<int, double>(
                                someArrayYouHaveAsInt,
                                new Converter<int,double>(
                                  delegate(int i) { return (double)i; }
                                )); 
```

* * *

## 回答 #202

> 赞同：6
> 
> 时间：2008-11-06T21:47:46.743

Mixins 是一个不错的功能。基本上，mixin 让你拥有接口而不是类的具体代码。然后，只需在一堆类中实现接口，您就会自动获得 mixin 功能。例如，要将深度复制混合到几个类中，请定义一个接口

```
internal interface IPrototype<T> { } 
```

为此界面添加功能

```
internal static class Prototype
{
  public static T DeepCopy<T>(this IPrototype<T> target)
  {
    T copy;
    using (var stream = new MemoryStream())
    {
      var formatter = new BinaryFormatter();
      formatter.Serialize(stream, (T)target);
      stream.Seek(0, SeekOrigin.Begin);
      copy = (T) formatter.Deserialize(stream);
      stream.Close();
    }
    return copy;
  }
} 
```

然后以任何类型实现接口以获得mixin。

* * *

## 回答 #203

> 赞同：6
> 
> 时间：2010-05-02T13:17:49.230

这意味着 T 必须有一个公共的无参数构造函数：

```
 class MyClass<T> where T : new()
 {

 } 
```

* * *

## 回答 #204

> 赞同：6
> 
> 时间：2008-12-30T01:40:37.583

我将此称为 AutoDebug，因为您可以根据布尔值在需要的时间和地点直接进行调试，该布尔值也可以存储为项目用户设置。

例子：

```
//Place at top of your code
public UseAutoDebug = true;

//Place anywhere in your code including catch areas in try/catch blocks
Debug.Assert(!this.UseAutoDebug); 
```

只需将上述内容放在代码的 try/catch 块或其他区域中，并将 UseAutoDebug 设置为 true 或 false，然后在您希望进行测试的任何时候进入调试。

您可以保留此代码并在测试时打开和关闭此功能，您还可以将其保存为项目设置，并在部署后手动更改它，以便在需要时从用户那里获取额外的错误信息。

您可以在此处的此 Visual Studio C# 项目模板中看到使用此技术的功能和工作示例，该模板被大量使用：

[http://code.msdn.microsoft.com/SEHE](http://code.msdn.microsoft.com/SEHE)

* * *

## 回答 #205

> 赞同：6
> 
> 时间：2009-05-17T08:41:55.380

我发现编译器在使用**外部变量**进行糖化代码时遇到了什么样的麻烦，这令人难以置信：

```
string output = "helo world!";
Action action = () => Console.WriteLine(output);
output = "hello!";
action(); 
```

这实际上打印`hello!`。为什么？因为编译器为委托创建了一个嵌套类，所有*外部变量*都有公共字段，并在每次调用委托之前插入设置代码:) 这是上面的代码“反射”：

```
Action action;
<>c__DisplayClass1 CS$<>8__locals2;
CS$<>8__locals2 = new <>c__DisplayClass1();
CS$<>8__locals2.output = "helo world!";
action = new Action(CS$<>8__locals2.<Main>b__0);
CS$<>8__locals2.output = "hello!";
action(); 
```

我觉得很酷。

* * *

## 回答 #206

> 赞同：6
> 
> 时间：2009-02-27T00:45:20.403

方法组并不为人所知。

鉴于：

```
Func<Func<int,int>,int,int> myFunc1 = (i, j) => i(j);
Func<int, int> myFunc2 = i => i + 2; 
```

你可以这样做：

```
var x = myFunc1(myFunc2, 1); 
```

而不是这个：

```
var x = myFunc1(z => myFunc2(z), 1); 
```

* * *

## 回答 #207

> 赞同：6
> 
> 时间：2009-05-08T18:21:05.907

这个问题我来得太晚了，但我想补充一些我认为没有被涵盖的内容。这些不是特定于 C# 的，但我认为它们对于任何 C# 开发人员来说都值得一提。

### [环境值属性](http://msdn.microsoft.com/en-us/library/system.componentmodel.ambientvalueattribute.aspx)

这类似于`DefaultValueAttribute`，但不是提供属性默认的值，而是提供属性用来决定是否从其他地方请求其值的值。例如，对于 WinForms 中的许多控件，它们的`ForeColor`和`BackColor`属性都有一个`AmbientValue`of`Color.Empty`以便它们知道从其父控件中获取它们的颜色。

### [隔离存储设置](http://msdn.microsoft.com/en-us/library/system.io.isolatedstorage.isolatedstoragesettings(VS.95).aspx)

这是一个 Silverlight。该框架方便地包含这个密封类，用于在每个应用程序和每个站点级别提供设置持久性。

### 标记与扩展方法的交互

使用扩展方法，标志枚举的使用可以更具可读性。

```
 public static bool Contains(
          this MyEnumType enumValue,
          MyEnumType flagValue)
    {
        return ((enumValue & flagValue) == flagValue);
    }

    public static bool ContainsAny(
          this MyEnumType enumValue,
          MyEnumType flagValue)
    {
        return ((enumValue & flagValue) > 0);
    } 
```

这使得对标志值的检查变得很好并且易于读写。当然，如果我们可以使用泛型并强制 T 成为枚举会更好，但这是不允许的。也许`dynamic`会让这更容易。

* * *

## 回答 #208

> 赞同：6
> 
> 时间：2009-07-13T11:05:00.177

C# 中的指针。

它们可用于就地字符串操作。这是一个不安全的特性，因此 unsafe 关键字用于标记不安全代码的区域。还要注意如何使用 fixed 关键字来指示指向的内存是固定的并且不能被 GC 移动。这是必不可少的指针指向内存地址，GC 可以将内存移动到不同的地址，否则会导致指针无效。

```
 string str = "some string";
    Console.WriteLine(str);
    unsafe
    {
        fixed(char *s = str)
        {
            char *c = s;
            while(*c != '\0')
            {
                *c = Char.ToUpper(*c++);                    
            }
        }
    }
    Console.WriteLine(str); 
```

我永远不会这样做，只是为了这个问题来演示这个功能。

* * *

## 回答 #209

> 赞同：6
> 
> 时间：2010-01-09T01:48:03.140

阅读完所有 9 页后，我觉得我必须指出一个不为人知的功能......

对于 .NET 1.1 也是如此，对 gzip 文件使用压缩/解压缩，必须：

*   下载[ICSharpCode.ZipLib](http://www.icsharpcode.net/OpenSource/SharpZipLib/)
*   或者，将 Java 库引用到您的项目中，并使用 Java 的内置库来利用 GZip 的压缩/解压缩方法。

它未被充分利用，我不知道，（仍然使用 ICSharpCode.ZipLib，即使使用 .NET 2/3.5）是它被合并到标准 BCL 版本 2 以上，在 System.IO.Compression 命名空间中。 .见MSDN页面“ [GZipStream Class](http://msdn.microsoft.com/en-us/library/system.io.compression.gzipstream(VS.80).aspx) ”。

* * *

## 回答 #210

> 赞同：6
> 
> 时间：2010-07-06T19:52:37.000

从匿名方法访问局部变量允许您使用新的控制流逻辑包装几乎任何代码，而无需将该代码分解到另一个方法中。在方法外部声明的局部变量在方法内部可用`endOfLineChar`，例如此处示例中的局部变量：

[http://aaronls.wordpress.com/2010/02/02/retrying-on-exception-conditionally/](http://aaronls.wordpress.com/2010/02/02/retrying-on-exception-conditionally/)

* * *

## 回答 #211

> 赞同：6
> 
> 时间：2010-01-10T01:27:07.047

我发现在 Visual Studio 中使用条件中断函数非常有用。我喜欢它允许我将值设置为某些东西的方式，例如只能在极少数情况下遇到，然后我可以从那里进一步检查代码。

* * *

## 回答 #212

> 赞同：5
> 
> 时间：2009-03-12T08:46:23.027

构造函数链是否已被引用？

```
namespace constructorChain {
    using System;

    public class Class1 {
        public string x;
        public string y;

        public Class1() {
            x = "class1";
            y = "";
        }

        public Class1(string y)
            : this() {
            this.y = y;
        }
    }

    public class Class2 : Class1 {
        public Class2(int y)
            : base(y.ToString()) {

        }
    }
} 
```

...

```
 constructorChain.Class1 c1 = new constructorChain.Class1();
        constructorChain.Class1 c12 = new constructorChain.Class1("Hello, Constructor!");
        constructorChain.Class2 c2 = new constructorChain.Class2(10);
        Console.WriteLine("{0}:{1}", c1.x, c1.y);
        Console.WriteLine("{0}:{1}", c12.x, c12.y);
        Console.WriteLine("{0}:{1}", c2.x, c2.y);

        Console.ReadLine(); 
```

* * *

## 回答 #213

> 赞同：5
> 
> 时间：2009-12-25T21:33:48.763

Action 和 Func 委托助手与 lambda 方法结合使用。我将这些用于需要委托来提高可读性的简单模式。例如，一个简单的缓存模式是检查请求的对象是否存在于缓存中。如果确实存在：返回缓存的对象。如果不存在，则生成新实例，缓存新实例并返回新实例。而是为每个我可以从缓存中存储/检索的对象编写此代码 1000 次，我可以编写一个简单的模式方法，如下所示......

```
private static T CachePattern<T>(string key, Func<T> create) where T : class
{
    if (cache[key] == null)
    {
        cache.Add(key, create());
    }

    return cache[key] as T;
} 
```

...然后我可以通过在我的自定义缓存管理器中使用以下内容来大大简化我的缓存获取/设置代码

```
public static IUser CurrentUser
{
    get
    {
        return CachePattern<IUser>("CurrentUserKey", () => repository.NewUpUser());
    }
} 
```

现在简单的“日常”代码模式可以编写一次并且更容易重用恕我直言。我不必去编写委托类型并弄清楚我想如何实现回调等。如果我能在 10 秒内编写它，我就不太合适了。求助于剪切/粘贴简单的代码模式，无论它们是惰性初始化还是上面显示的其他一些示例......

* * *

## 回答 #214

> 赞同：5
> 
> 时间：2010-04-05T11:15:10.473

Nullable.GetValueOrDefault ？

* * *

## 回答 #215

> 赞同：5
> 
> 时间：2009-09-11T03:52:09.283

如果有人提到了这个，我很抱歉，但我经常使用这个。

Visual Studio 的加载项由 Alex Papadimoulis 开发。它用于将常规文本粘贴为字符串、字符串生成器、注释或区域。

[http://weblogs.asp.net/alex_papadimoulis/archive/2004/05/25/Smart-Paster-1.1-Add-In---StringBuilder-and-Better-C_2300_-Handling.aspx](http://weblogs.asp.net/alex_papadimoulis/archive/2004/05/25/Smart-Paster-1.1-Add-In---StringBuilder-and-Better-C_2300_-Handling.aspx)

在这个插件中（我也不知道是否已经提到过）我注意到字符串粘贴有字符串文字前缀：

```
@ 
```

我知道这些，但我不知道在文字中使用双引号来转义引号。

例如

```
string s = "A line of text" + Environment.NewLine + "Another with a \"quote\"!!"; 
```

可以表示为

```
string s = @"A line of text 
Another with a ""quote""!!"; 
```

* * *

## 回答 #216

> 赞同：5
> 
> 时间：2009-07-27T00:43:31.763

零参数 Lambda

```
()=>Console.ReadLine() 
```

* * *

## 回答 #217

> 赞同：5
> 
> 时间：2008-08-26T18:51:13.473

Reflection Emit and Expression trees come to mind...

Don't miss Jeffrey Richter's CLR via C# and Jon Skeet's ![alt text](https://www.manning.com/skeet/skeet_cover150.jpg)

See here for some resources:

[http://www.codeproject.com/KB/trace/releasemodebreakpoint.aspx](http://www.codeproject.com/KB/trace/releasemodebreakpoint.aspx)

[http://www.codeproject.com/KB/dotnet/Creating_Dynamic_Types.aspx](http://www.codeproject.com/KB/dotnet/Creating_Dynamic_Types.aspx)

[http://www.codeproject.com/KB/cs/lambdaexpressions.aspx](http://www.codeproject.com/KB/cs/lambdaexpressions.aspx)

* * *

## 回答 #218

> 赞同：5
> 
> 时间：2008-09-16T14:43:44.000

[System.Runtime.Remoting.Proxies.RealProxy](http://msdn.microsoft.com/en-us/library/system.runtime.remoting.proxies.realproxy.aspx)

它支持 C# 中的面向方面编程，您还可以用它做很多其他花哨的事情。

* * *

## 回答 #219

> 赞同：5
> 
> 时间：2008-10-12T04:26:32.297

在使用 linqxml 时，我发现这种技术很有趣：

```
public bool GetFooSetting(XElement ndef){
   return (bool?)ndef.Element("MyBoolSettingValue") ?? true;
} 
```

相对于：

```
public bool GetFooSetting(XElement ndef){
   return ndef.Element("MyBoolSettingValue") != null ? bool.Parse(ndef.Element("MyBoolSettingValue") ) : true;
} 
```

* * *

## 回答 #220

> 赞同：5
> 
> 时间：2009-07-30T03:57:06.083

我没有看到这个：

```
for (;;); 
```

一样

```
while (true) ; 
```

* * *

## 回答 #221

> 赞同：5
> 
> 时间：2009-09-03T03:36:51.900

这不会编译：

```
namespace ns
{
    class Class1
    {
        Nullable<int> a;
    }
} 
```

*找不到类型或命名空间名称“Nullable”（您是否缺少 using 指令或程序集引用？）* <--缺少“ `using System;`”

但

```
namespace ns
{
    class Class1
    {
        int? a;
    }
} 
```

会编译！（.NET 2.0）。

* * *

## 回答 #222

> 赞同：5
> 
> 时间：2008-08-25T14:21:57.183

@lainMH，

在从可为空的数据库中检索值以及将值放回时，可为空的布尔值很有用。有时您想知道该字段尚未设置。

* * *

## 回答 #223

> 赞同：5
> 
> 时间：2008-11-03T15:26:12.897

通用事件处理程序：

```
public event EventHandler<MyEventArgs> MyEvent; 
```

这样你就不必一直声明自己的代表了，

* * *

## 回答 #224

> 赞同：5
> 
> 时间：2009-08-23T11:07:06.030

我最近学到的一个是你仍然可以[在一个可为空的值上调用方法](https://stackoverflow.com/questions/1242883/is-there-a-better-way-to-write-this-line-of-c-code-in-c3-0)......

事实证明，当你有一个可为空的值时：

```
decimal? MyValue = null; 
```

你可能认为你必须在哪里写：

```
MyValue == null ? null : MyValue .ToString() 
```

你可以改写：

```
MyValue.ToString() 
```

我知道我可以调用 MyValue.HasValue 和 MyValue.Value...但它并没有完全点击我可以调用 ToString()。

* * *

## 回答 #225

> 赞同：5
> 
> 时间：2008-11-03T16:16:07.820

我没有发现 - 将近一年 - 强类型 DataRows 包含 Is[ColumnName]Null() 方法。

例如：

```
Units.UnitsDataTable dataTable = new Units.UnitsDataTable();

foreach (Units.UnitsRow row in dataTable.Rows)
{
    if (row.IsPrimaryKeyNull())
        //....

    if (row.IsForeignKeyNull())
        //....
} 
```

* * *

## 回答 #226

> 赞同：5
> 
> 时间：2009-04-23T12:57:48.963

> **FIXED** / C# 中指针的力量 - 这个话题太大了，但我只会概述一些简单的事情。

在 C 语言中，我们有加载结构的设施，比如......

```
struct cType{
   char type[4];
   int  size;
   char name[50];
   char email[100];
}

cType myType;
fread(file, &mType, sizeof(mType)); 
```

我们可以在“不安全”方法中使用固定关键字来读取字节数组对齐的结构。

```
[Layout(LayoutKind.Sequential, Pack=1)]
public unsafe class CType{
    public fixed byte type[4];
    public int size;
    public fixed byte name[50];
    public fixed byte email[100];
} 
```

方法1（从常规流读取到字节缓冲区并将字节数组映射到结构的各个字节）

```
CType mType = new CType();
byte[] buffer = new byte[Marshal.SizeOf(CType)];
stream.Read(buffer,0,buffer.Length);
// you can map your buffer back to your struct...
fixed(CType* sp = &mType)
{
    byte* bsp = (byte*) sp;
    fixed(byte* bp = &buffer)
    {
         for(int i=0;i<buffer.Length;i++)
         {
             (*bsp) = (*bp);
             bsp++;bp++;
         }
    }
} 
```

方法2，可以将Win32 User32.dll的ReadFile映射到直接读取字节...

```
CType mType = new CType();
fixed(CType* p = &mType)
{
    User32.ReadFile(fileHandle, (byte*) p, Marshal.SizeOf(mType),0);
} 
```

* * *

## 回答 #227

> 赞同：5
> 
> 时间：2009-07-16T05:16:29.323

我喜欢使用*using*指令重命名一些类以便于阅读，如下所示：

```
// defines a descriptive name for a complexed data type
using MyDomainClassList = System.Collections.Generic.List<
  MyProjectNameSpace.MyDomainClass>;

....

MyDomainClassList myList = new MyDomainClassList();
/* instead of 
List<MyDomainClass> myList = new List<MyDomainClass>();
*/ 
```

这对于代码维护也非常方便。如果需要更改类名，只需更改一处。另一个例子：

```
using FloatValue  = float; // you only need to change it once to decimal, double...

....
FloatValue val1;
... 
```

* * *

## 回答 #228

> 赞同：5
> 
> 时间：2009-11-21T08:12:56.197

我喜欢[EditorBrowsableAttribute](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorbrowsableattribute.aspx)。它使您可以控制是否在 Intellisense 中显示方法/属性。您可以将值设置为始终、高级或从不。

[从 MSDN](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorbrowsableattribute.aspx) ...

**评论**

EditorBrowsableAttribute 是对设计者的提示，指示是否要显示属性或方法。您可以在可视化设计器或文本编辑器中使用此类型来确定用户可见的内容。例如，Visual Studio 中的 IntelliSense 引擎使用此特性来确定是否显示属性或方法。

在 Visual C# 中，您可以使用工具 | 下的隐藏高级成员设置来控制高级属性何时出现在 IntelliSense 和属性窗口中。选项 | 文本编辑器 | C＃。对应的 EditorBrowsableState 是 Advanced。

* * *

## 回答 #229

> 赞同：5
> 
> 时间：2009-12-03T00:45:50.267

__arglist 也是

```
[DllImport("msvcrt40.dll")]
public static extern int printf(string format, __arglist);

static void Main(string[] args)
{
   printf("Hello %s!\n", __arglist("Bart"));
} 
```

* * *

## 回答 #230

> 赞同：5
> 
> 时间：2010-03-08T22:43:57.697

**允许使用带有大括号的空块。**

你可以写这样的代码

```
{
    service.DoTonsOfWork(args);
} 
```

当您想尝试没有 a`using`或`try... finally`您已经编写过的东西时，它会很有帮助。

```
//using(var scope = new TransactionScope)
{
    service.DoTonsOfWork(args);
} 
```

* * *

## 回答 #231

> 赞同：4
> 
> 时间：2009-08-07T22:39:32.553

泛型和[奇怪重复的模板模式](http://en.wikipedia.org/wiki/Curiously_recurring_template_pattern)确实有助于一些静态方法/属性声明。

假设您正在构建一个类层次结构：

```
class Base
{
}

class Foo: Base
{
}

class Bar: Base
{
} 
```

现在，您想要在您的类型上声明静态方法，这些方法应该采用相同类型的参数（或返回值）或相同类型的静态属性。例如，您想要：

```
class Base
{
    public static Base Get()
    {
        // Return a suitable Base.
    }
}

class Foo: Base
{
    public static Foo Get()
    {
        // Return a suitable Foo.
    }
}

class Bar: Base
{
    public static Bar Get()
    {
        // Return a suitable Bar.
    }
} 
```

如果这些静态方法基本上都做同样的事情，那么你手上就有很多重复的代码。一种解决方案是在返回值上删除类型安全性并始终返回 type `Base`。但是，如果您想要类型安全，那么解决方案是将其声明`Base`为：

```
class Base<T> where T: Base<T>
{
    public static T Get<T>()
    {
        // Return a suitable T.
    }
} 
```

你`Foo`和`Bar`作为：

```
class Foo: Base<Foo>
{
}

class Bar: Base<Bar>
{
} 
```

这样，他们将自动获得静态方法的**副本**。

这也可以将**单例**模式封装在基类中创造奇迹（我知道下面的代码不是线程安全的，它只是为了说明一点）：

```
public class Singleton<T> where T: Singleton<T>, new()
{
  public static T Instance { get; private set; }

  static Singleton<T>()
  {
    Instance = new T();
  }
} 
```

我意识到这会迫使您在单例子类上拥有一个公共的无参数构造函数，但是在没有`where T: protected new()`构造的编译时无法避免这种情况；但是，可以使用[反射](http://www.codeproject.com/KB/architecture/GenericSingletonPattern.aspx)在运行时调用子类的受保护/私有无参数构造函数来实现这一点。

* * *

## 回答 #232

> 赞同：4
> 
> 时间：2008-09-03T15:03:20.693

在验证用户输入时，每种原始类型的 TryParse 方法都很棒。

```
double doubleValue
if (!Double.TryParse(myDataRow("myColumn"), out doubleValue))
{
    // set validation error
} 
```

* * *

## 回答 #233

> 赞同：4
> 
> 时间：2008-11-23T17:45:14.367

**框架功能**

我不知道，但我对[VisualStyleRenderer](http://msdn.microsoft.com/de-de/library/system.windows.forms.visualstyles.visualstylerenderer(VS.85).aspx)和整个[System.Windows.Forms.VisualStyles-Namespace](http://msdn.microsoft.com/de-de/library/system.windows.forms.visualstyles(VS.85).aspx)感到非常惊讶。很酷！

* * *

## 回答 #234

> 赞同：4
> 
> 时间：2009-06-16T18:38:22.347

能够像这样基于泛型参数创建类型的实例

新 T();

* * *

## 回答 #235

> 赞同：4
> 
> 时间：2009-06-14T16:11:16.937

一些来自我的 - 让他们随心所欲。

属性：

```
[assembly::InternalsVisibleTo("SomeAssembly")] 
```

允许您将程序集中的内部方法/属性或数据暴露给另一个名为“SomeAssembly”的程序集。所有受保护/私人的东西都保持隐藏。

* * *

静态构造函数（也称为“类型构造函数”）

```
public MyClass
{
  public static MyClass()
  {
     // type init goes here
  }
  ......
} 
```

* * *

关键字`internal`。在很多方面都很有用。

* * *

## 回答 #236

> 赞同：4
> 
> 时间：2009-06-22T12:29:48.727

Marketing events as non-serializable:

```
[field:NonSerializable]
public event SomeDelegate SomeEvent; 
```

* * *

## 回答 #237

> 赞同：4
> 
> 时间：2008-09-19T05:18:35.503

#region *{string}*和 #endregion 对非常适合对代码进行分组（大纲）。

```
#region Using statements
using System;
using System.IO;
using ....;
using ....;
#endregion 
```

代码块可以压缩为单个描述文本行。也适用于函数内部。

* * *

## 回答 #238

> 赞同：4
> 
> 时间：2008-08-24T22:10:22.963

我学到的一件有趣的事是框架和 C# 语言的不同部分是在不同的时间编写的，因此存在不一致。例如，框架本身违反了许多 FxCop 规则，因为在编写框架时这些规则并未全部到位。

此外，using 语句旨在界定“范围”，而不是专门用于处理资源。它是在 lock 语句之后编写的。Eric Gunnerson[曾经提到](http://haacked.com/archive/2004/05/27/DifficultiesOfLanguageDesign.aspx)过，如果 using 语句首先出现，他们可能不需要编写 lock 语句（尽管谁知道，也许他们无论如何都会有），因为 using 语句可能就足够了。

* * *

## 回答 #239

> 赞同：4
> 
> 时间：2009-07-21T21:46:11.613

[表达式树](http://msdn.microsoft.com/en-us/library/bb397951.aspx)怎么样？它们是 LINQ 的核心并允许延迟执行：

摘自[David Hayden 的博客](http://www.davidhayden.com/blog/dave/archive/2006/12/18/ExpressionTrees.aspx)：

在 C# 3.0 中，您可以使用 lambda 表达式按如下方式定义委托：

```
Func<int,int> f = x => x + 1; 
```

此委托在您的应用程序中编译为可执行代码，并且可以这样调用：

```
var three = f(2); // 2 + 1 
```

该代码按您的预期工作。这里没有什么花哨的。

**表达式树**

当您使用 System.Query.Expression 将委托定义为表达式树时：

```
Expression<Func<int,int>> expression = x => x + 1; 
```

委托不再编译为可执行代码，而是编译为可转换并编译为原始委托的数据。

要在应用程序中实际使用表示为表达式树的委托，您必须在应用程序中编译和调用它：

```
var originalDelegate = expression.Compile();

var three = originalDelegate.Invoke(2); 
```

* * *

## 回答 #240

> 赞同：4
> 
> 时间：2008-11-03T15:42:24.097

刚刚`[UnmanagedFunctionPointerAttribute(CallingConvention.CDecl)]`从尝试与定义没有 __stdcall 的回调的非托管 C++ 函数库接口中学到了乐趣。

* * *

## 回答 #241

> 赞同：4
> 
> 时间：2008-09-20T01:50:13.817

我想很多人都知道 C 中的指针，但不确定它是否适用于 C#。您可以在不安全的上下文中使用 C# 中的指针：

```
static void Main()
{
    int i;
    unsafe
    {               
        // pointer pi has the address of variable i
        int* pi = &i; 
        // pointer ppi has the address of variable pi
        int** ppi = &pi;
        // ppi(addess of pi) -> pi(addess of i) -> i(0)
        i = 0;
        // dereference the pi, i.e. *pi is i
        Console.WriteLine("i = {0}", *pi); // output: i = 0
        // since *pi is i, equivalent to i++
        (*pi)++;
        Console.WriteLine("i = {0}", *pi); // output: i = 1
        // since *ppi is pi, one more dereference  *pi is i 
        // equivalent to i += 2
        **ppi += 2;
        Console.WriteLine("i = {0}", *pi);// output: i = 3
    }
    Console.ReadLine();
} 
```

* * *

## 回答 #242

> 赞同：4
> 
> 时间：2009-04-27T16:46:52.050

InternalsVisibleToAttribute 指定通常仅在当前程序集中可见的类型对另一个程序集可见。[msdn上的文章](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx "InternalsVisibleToAttribute 类")

* * *

## 回答 #243

> 赞同：4
> 
> 时间：2009-06-05T20:56:00.313

如果您的 Visual Studio 工具栏中有搜索文本框，您可以键入“> of Program.cs”以打开文件 Program.cs

* * *

## 回答 #244

> 赞同：4
> 
> 时间：2008-10-21T19:08:37.363

这对于数据库应用程序开发人员来说可能是非常基础的，但我花了一段时间才意识到 null 与 DBNull.value 不同。

当您想查看数据库记录中的值是否为空时，您必须使用 DBNull.value。

* * *

## 回答 #245

> 赞同：4
> 
> 时间：2012-02-23T12:34:19.723

您可以组合`protected`and`internal`访问器，使其在同一个程序集中公开，但在不同程序集中受到保护。这可以用于字段、属性、方法甚至常量。

* * *

## 回答 #246

> 赞同：4
> 
> 时间：2010-02-11T10:37:59.893

我在这次谈话中有点晚了，我想贡献以下内容。对于某些开发人员来说，这可能是一个新事物。

```
public class User
{
    public long UserId { get; set; }
    public String Name { get; set; }
    public String Password { get; set; }
    public String Email { get; set; }
} 
```

声明和初始化它的常用方法是使用构造函数或类似的方法。

```
User user = new User();
user.UserId = 1;
user.Name = "myname";
etc 
```

但我学会了以下初始化它的方法。我知道 Visual Basic 开发人员会喜欢它，因为它就像操作符仅在 VB.NET 中可用，而在 C# 中不可用，如下所示。

```
User user = new User()
{
    UserId = 1,
    Name = "myname",
    Email = "myemail@domain.com",
    Password = "mypassword"
}; 
```

* * *

## 回答 #247

> 赞同：4
> 
> 时间：2009-11-25T17:16:48.400

**将枚举值转换为字符串值**

鉴于枚举

```
enum Country
{
    UnitedKingdom, 
    UnitedStates,
    UnitedArabEmirates,
} 
```

使用它：

```
public static void PrintEnumAsString( Country country )
{
    Console.Writeline( country.ToString() );
} 
```

将枚举值的名称打印为字符串，例如“UnitedKingdom”

* * *

## 回答 #248

> 赞同：4
> 
> 时间：2010-02-09T19:05:23.790

对象初始化器中的集合初始化器：

```
MailMessage mail = new MailMessage {
   To = { new MailAddress("a@example.com"), new MailAddress("b@example.com") },
   Subject = "Password Recovery"
}; 
```

您可以在单个表达式中初始化整个树。

* * *

## 回答 #249

> 赞同：4
> 
> 时间：2009-06-30T07:11:12.670

通用约束：

```
 //Constructor constraint, T has a default empty constructor
class Node<K,T> where T : new() 
{
}

//Reference\Value Type constraints
//T is a struct
public class MyClass<T> where T : struct 

{...}

//T is a reference type
public class MyClass<T> where T : class 

{...}

public class MyClass<T> where T : SomeBaseClass, ISomeInterface 

{...} 
```

* * *

## 回答 #250

> 赞同：4
> 
> 时间：2009-08-05T17:01:19.033

[这在标准](http://www.ecma-international.org/publications/standards/Ecma-334.htm)中已经解释了很多。对于任何初学者和专家来说，这都是一本好书，读起来很多，但它是官方标准，并且充满了有趣的细节。

一旦您完全理解了 C#，就该进一步了解[公共语言基础结构](http://www.ecma-international.org/publications/standards/Ecma-335.htm)的基础知识了。C# 的体系结构和基础。

我遇到过各种各样的程序员，他们不知道对象和 ValueType 之间的区别，除了它们的相关限制。

熟悉这两个文件，你永远不会成为那个人。

* * *

## 回答 #251

> 赞同：4
> 
> 时间：2009-10-26T16:45:31.897

我喜欢滥用静态模板类不共享其静态成员这一事实。

`Dictionary<Type,...>`这是一个线程安全的（在创建时）并且在编译时`Type`已知实例的任何廉价替代品。

```
public static class MyCachedData<T>{
    static readonly CachedData Value;
    static MyCachedData(){
       Value=// Heavy computation, such as baking IL code or doing lots of reflection on a type
    }
} 
```

干杯，弗洛里安

* * *

## 回答 #252

> 赞同：4
> 
> 时间：2010-02-02T22:12:39.037

我只想提一下（因为 OP 提到 where T : struct）C# 编译器的问题之一是

```
where T : Enum 
```

不会编译。它抛出错误“约束不能是特殊类'System.Enum'”。

* * *

## 回答 #253

> 赞同：4
> 
> 时间：2010-04-05T03:58:57.897

这与静态构造函数有关。这是一种执行静态销毁的方法（即在程序退出时清理资源）。

首先下课：

```
class StaticDestructor
{
    /// <summary>
    /// The delegate that is invoked when the destructor is called.
    /// </summary>
    public delegate void Handler();
    private Handler doDestroy;

    /// <summary>
    /// Creates a new static destructor with the specified delegate to handle the destruction.
    /// </summary>
    /// <param name="method">The delegate that will handle destruction.</param>
    public StaticDestructor(Handler method)
    {
        doDestroy = method;
    }

    ~StaticDestructor()
    {
        doDestroy();
    }
} 
```

然后作为班级的成员，您希望拥有一个“静态析构函数”：

```
private static readonly StaticDestructor destructor = new StaticDestructor
(
    delegate()
    {
        //Cleanup here
    }
); 
```

现在将在最终垃圾收集发生时调用它。如果您绝对需要释放某些资源，这很有用。

表现出这种行为的快速而肮脏的程序：

```
using System;

namespace TestStaticDestructor
{
    class StaticDestructor
    {
        public delegate void Handler();
        private Handler doDestroy;

        public StaticDestructor(Handler method)
        {
            doDestroy = method;
        }

        ~StaticDestructor()
        {
            doDestroy();
        }
    }

    class SomeClass
    {
        static SomeClass()
        {
            Console.WriteLine("Statically constructed!");
        }

        static readonly StaticDestructor destructor = new StaticDestructor(
            delegate()
            {
                Console.WriteLine("Statically destructed!");
            }
        );
    }

    class Program
    {
        static void Main(string[] args)
        {
            SomeClass someClass = new SomeClass();
            someClass = null;
            System.Threading.Thread.Sleep(1000);
        }
    }
} 
```

当程序退出时，“静态析构函数”被调用。

* * *

## 回答 #254

> 赞同：4
> 
> 时间：2010-06-22T19:57:59.953

我不宽恕它，但我很惊讶[goto](http://msdn.microsoft.com/en-us/library/13940fs2(VS.100).aspx)仍然围绕着*鸭子来袭的弹丸*

* * *

## 回答 #255

> 赞同：4
> 
> 时间：2010-01-07T15:57:15.387

*   附加 **？**到一个类型，使其可以为空，例如： int?
*   "c:\dir" 而不是**@"C:\dir"**

* * *

## 回答 #256

> 赞同：4
> 
> 时间：2010-03-11T15:01:42.510

Visual Studio 最有用的功能之一是“制作对象 ID”。它会生成一个 id 并“附加”到对象，因此无论您在哪里查看对象，您都会看到 id（无论线程如何）。

调试时右键单击变量工具提示，就可以了。它也适用于 watch/autos/locals 变量。

* * *

## 回答 #257

> 赞同：3
> 
> 时间：2008-11-15T07:14:26.467

ViewState getter 可以是单行的。

**使用默认值：**

```
public string Caption
{
    get { return (string) (ViewState["Caption"] ?? "Foo"); }
    set { ViewState["Caption"] = value; }
}

public int Index
{
    get { return (int) (ViewState["Index"] ?? 0); }
    set { ViewState["Index"] = value; }
} 
```

**使用 null 作为默认值：**

```
public string Caption
{
    get { return (string) ViewState["Caption"]; }
    set { ViewState["Caption"] = value; }
}

public int? Index
{
    get { return (int?) ViewState["Index"]; }
    set { ViewState["Index"] = value; }
} 
```

这适用于字典支持的任何内容。

* * *

## 回答 #258

> 赞同：3
> 
> 时间：2008-08-28T14:49:03.490

返回 IQueryable 投影

```
protected void LdsPostings_Selecting(object sender, LinqDataSourceSelectEventArgs e)
{   
    var dc = new MyDataContext();
    var query = dc.Posting.AsQueryable();

    if (isCondition1)
    {
        query = query.Where(q => q.PostedBy == Username);
        e.Result = QueryProjection(query);
        return;
    }

    ...

    if (isConditionN)
    {
        query = query.Where(q => q.Status.StatusName == "submitted");
        query = query.Where(q => q.ReviewedBy == Username);
        e.Result = QueryProjection(query);
        return;
    }
} 
```

而不是多次编码投影，创建一个方法：

```
private IQueryable QueryProjection(IQueryable<Posting> query)
{
    return query.Select(p => new
    {
        p.PostingID,
        p.Category.CategoryName,
        p.Type.TypeName,
        p.Status.StatusName,
        p.Description,
        p.Updated,
        p.PostedBy,
        p.ReviewedBy,
    });
} 
```

* * *

## 回答 #259

> 赞同：3
> 
> 时间：2008-10-09T20:37:13.477

上下文绑定对象

与其说是 C#，不如说是 .NET。这是实现 DI 的另一种方式，尽管它可能很辛苦。而且你必须从它继承，这可能会令人反感。

[http://msdn.microsoft.com/en-us/library/system.contextboundobject.aspx](http://msdn.microsoft.com/en-us/library/system.contextboundobject.aspx)

当我使用自定义日志记录属性装饰类/方法时，我使用它来添加日志记录。

* * *

## 回答 #260

> 赞同：3
> 
> 时间：2009-08-14T20:53:32.227

阻止 DataGridView 显示属性：

```
[System.ComponentModel.Browsable(false)]
public String LastActionID{get; private set;} 
```

允许您为组件（如 DataGrid 或 DataGridView）设置友好显示：

```
[System.ComponentModel.DisplayName("Last Action")]
public String LastAction{get; private set;} 
```

对于您的支持变量，如果您不希望任何东西直接访问它们，这将使其变得更加困难：

```
[System.ComponentModel.EditorBrowsable(System.ComponentModel.EditorBrowsableState.Never)]
    private DataController p_dataSources; 
```

* * *

## 回答 #261

> 赞同：3
> 
> 时间：2008-11-01T19:48:28.017

ThreadStaticAttribute 是我的最爱。此外，NonSerializableAttribute 很有用。（你能告诉我使用远程处理做了很多服务器工作吗？）

* * *

## 回答 #262

> 赞同：3
> 
> 时间：2008-10-13T22:29:09.880

```
double dSqrd = Math.Pow(d,2.0); 
```

比更准确

```
double dSqrd = d * d; // Here we can lose precision 
```

* * *

## 回答 #263

> 赞同：3
> 
> 时间：2010-04-08T19:30:55.320

参考带有永久链接的帖子“ [C#的隐藏功能？](https://stackoverflow.com/questions/9033/hidden-features-of-c/2495330#2495330) ”，还有另一种方法可以完成相同的操作 - 缩进/换行符。看一下这个..

```
XmlWriterSettings xmlWriterSettings = new XmlWriterSettings();
xmlWriterSettings.NewLineOnAttributes = true;
xmlWriterSettings.Indent = true;

XmlWriter xml = XmlWriter.Create(@"C:\file.xml", xmlWriterSettings);

// Start writing the data using xml.WriteStartElement(), xml.WriteElementString(...), xml.WriteEndElement() etc 
```

我不确定这是否是一个未知功能！

* * *

## 回答 #264

> 赞同：3
> 
> 时间：2009-09-10T11:21:28.523

起初 - [DebuggerTypeProxy](http://msdn.microsoft.com/en-us/library/d8eyd8zc.aspx)。

```
[DebuggerTypeProxy(typeof(HashtableDebugView))]
class MyHashtable : Hashtable
{
    private const string TestString = 
        "This should not appear in the debug window.";

    internal class HashtableDebugView
    {
        private Hashtable hashtable;
        public const string TestStringProxy = 
            "This should appear in the debug window.";

        // The constructor for the type proxy class must have a 
        // constructor that takes the target type as a parameter.
        public HashtableDebugView(Hashtable hashtable)
        {
            this.hashtable = hashtable;
        }
    }
} 
```

第二：

[ICustomTypeDescriptor](http://msdn.microsoft.com/en-us/library/ms171819.aspx)

* * *

## 回答 #265

> 赞同：3
> 
> 时间：2009-02-03T18:42:13.857

仅供参考 - 使用扩展方法的枚举二进制操作。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Linq.Expressions;

namespace BinaryOpGenericTest
{
    [Flags]
    enum MyFlags
    {
        A = 1,
        B = 2,
        C = 4

    }

    static class EnumExtensions
    {
        private static Dictionary<Type, Delegate> m_operations = new Dictionary<Type, Delegate>();

        public static bool IsFlagSet<T>(this T firstOperand, T secondOperand) 
                                                  where T : struct
        {

            Type enumType = typeof(T);

            if (!enumType.IsEnum)
            {
                throw new InvalidOperationException("Enum type parameter required");
            }

            Delegate funcImplementorBase = null;
            m_operations.TryGetValue(enumType, out funcImplementorBase);

            Func<T, T, bool> funcImplementor = funcImplementorBase as Func<T, T, bool>;

            if (funcImplementor == null)
            {
                funcImplementor = buildFuncImplementor(secondOperand);
            }

            return funcImplementor(firstOperand, secondOperand);
        }

        private static Func<T, T, bool> buildFuncImplementor<T>(T val)
                                                            where T : struct
        {
            var first = Expression.Parameter(val.GetType(), "first");
            var second = Expression.Parameter(val.GetType(), "second");

            Expression convertSecondExpresion = Expression.Convert(second, typeof(int));
            var andOperator = Expression.Lambda<Func<T, T, bool>>(Expression.Equal(
                                                                                                       Expression.And(
                                                                                                            Expression.Convert(first, typeof(int)),
                                                                                                             convertSecondExpresion),
                                                                                                       convertSecondExpresion),
                                                                                             new[] { first, second });
            Func<T, T, bool> andOperatorFunc = andOperator.Compile();
            m_operations[typeof(T)] = andOperatorFunc;
            return andOperatorFunc;
        }
    }

    class Program
    {
        static void Main(string[] args)
        {
            MyFlags flag = MyFlags.A | MyFlags.B;

            Console.WriteLine(flag.IsFlagSet(MyFlags.A));            
            Console.WriteLine(EnumExtensions.IsFlagSet(flag, MyFlags.C));
            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #266

> 赞同：3
> 
> 时间：2009-10-29T23:44:23.133

下面的不是隐藏的，而是相当隐含的。不知道有没有像下面这样的示例在这里发布过，也看不出有什么好处（可能没有），但我会尽量展示一个“奇怪”的代码。以下示例`for`通过 C# 中的仿函数（委托/匿名委托 [lambdas]）和闭包模拟语句。其他流程语句，如,`if`和也是 模拟的，但我不确定（也许，我太懒了:)）。我已经压缩了示例源代码以使其更清晰。`if/else``while``do/whle``switch`

```
private static readonly Action EmptyAction = () => { };
private static readonly Func<bool> EmptyCondition = () => { return true; };

private sealed class BreakStatementException : Exception { }
private sealed class ContinueStatementException : Exception { }
private static void Break() { throw new BreakStatementException(); }
private static void Continue() { throw new ContinueStatementException(); }

private static void For(Action init, Func<bool> condition, Action postBlock, Action statement) {
    init = init ?? EmptyAction;
    condition = condition ?? EmptyCondition;
    postBlock = postBlock ?? EmptyAction;
    statement = statement ?? EmptyAction;
    for ( init(); condition(); postBlock() ) {
        try {
            statement();
        } catch ( BreakStatementException ) {
            break;
        } catch ( ContinueStatementException ) {
            continue;
        }
    }
}

private static void Main() {
    int i = 0; // avoiding error "Use of unassigned local variable 'i'" if not using `for` init block
    For(() => i = 0, () => i < 10, () => i++,
        () => {
            if ( i == 5 )
                Continue();
            Console.WriteLine(i);
        }
    );
} 
```

如果我没记错的话，这种方法与函数式编程实践相当相关。我对吗？

* * *

## 回答 #267

> 赞同：3
> 
> 时间：2009-07-23T19:26:07.540

如果您尝试从项目列表中创建逗号分隔的字符串：

```
string[] itemList = { "Example 1", "Example 2", "Example 3" };
CommaDelimitedStringCollection commaStr = new CommaDelimitedStringCollection();
commaStr.AddRange(itemList);
//outputs Example 1,Example 2,Example 3 
```

看[这里](http://blog.crowe.co.nz/archive/2007/08/25/c---How-to-create-a-comma-seperated-string-from.aspx)的另一个例子。

* * *

## 回答 #268

> 赞同：3
> 
> 时间：2009-05-22T19:28:26.923

好吧...***不要用它***，但是很多人不知道C#支持邪恶的goto :)

```
static void Example()
{
    int i = 0;
top:
    Console.WriteLine(i.ToString());
    if (i == 0)
    {
        i++;
        goto top;
    }
} 
```

* * *

## 回答 #269

> 赞同：3
> 
> 时间：2009-06-04T08:41:48.907

当与 .NET 3.5 中的语句 lambda 一起使用时，绝对是 Func<> 类型。这些允许可定制的功能，并且可以极大地帮助提供用户可定制的对象，而无需对它们进行子类化或诉诸某些有限的系统，例如跟踪列出用户想要监视的按钮或键的变量。此外，它们可以像常规方法一样被调用，并且可以像变量一样被赋值。我能想到的唯一缺点是您仅限于 5 个参数！尽管到那时您可能想要考虑不同的解决方案...编辑：提供一些示例。

```
...
public Func<InputHelper, float> _horizontalCameraMovement = (InputHelper input) => 
{
    return (input.LeftStickPosition.X * _moveRate) * _zoom;
}
public Func<InputHelper, float> _verticalCameraMovement = (InputHelper input) => 
{
    return (-input.LeftStickPosition.Y * _moveRate) * _zoom;
}
...
public void Update(InputHelper input)
{
    ...
    position += new Vector2(_horizontalCameraMovement(input), _verticalCameraMovement(input));
    ...
} 
```

在此示例中，您可以编写一个函数来执行任意计算并返回一个浮点数，该浮点数将确定相机移动的量。不是最好的代码，但它得到了重点。

```
private int foo;
public int FooProperty {
    get
    {
        if (_onFooGotten() == true)
            return _foo;
    }
    set
    {
        if (onFooSet() == true)
            _foo = value;
    }
}
...
public Func<bool> _onFooGotten = () => 
{
    //do whatever...
    return true;
}
public Func<bool> _onFooSet = () =>
{
    //do whatever...
    return true;
} 
```

这不是最好的例子（因为我还没有真正探索过这种用法），但它展示了一个使用 lambda 函数来快速事件引发器的例子，而无需代理的麻烦。编辑：想到另一个。可空值！C# 最接近可选参数的东西。

* * *

## 回答 #270

> 赞同：3
> 
> 时间：2010-01-13T09:31:52.353

不知道这本身是否是一个秘密，但我喜欢 System.Linq 中添加的 Enumerable（添加到 IEnumerable）类。

[http://msdn.microsoft.com/en-us/library/system.linq.enumerable_members.aspx](http://msdn.microsoft.com/en-us/library/system.linq.enumerable_members.aspx)

虽然 yield 关键字已经列出。迭代器块真是太神奇了。我用它们来构建列表，这些列表将被测试以查看它们是否是互质的。它基本上允许您通过一个一个一个返回值并随时停止的函数。

哦，当您无法再优化时，我差点忘记了世界上最好的课程。后台工作者！！！！

[http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)

* * *

## 回答 #271

> 赞同：3
> 
> 时间：2010-06-09T14:39:44.047

最近我了解了 String.Join 方法。在构建像列这样的字符串以供查询选择时非常有用。

* * *

## 回答 #272

> 赞同：3
> 
> 时间：2009-12-29T21:41:35.003

“TODO”属性和任务列表

```
//TODO: [something] 
```

将其添加到您的代码中（间距很重要）会在您的任务列表中抛出一个项目，双击该项目会将您跳转到代码中的适当位置。

* * *

## 回答 #273

> 赞同：3
> 
> 时间：2010-01-05T11:51:22.167

我不知道可以帮助避免使用方法重载的通用方法。下面是打印 int 和 double 数字的重载方法。

```
 private static void printNumbers(int [] intNumbers)
    { 
        foreach(int element in intNumbers)
        {
            Console.WriteLine(element);
        }

    }

    private static void printNumbers(double[] doubleNumbers)
    {
        foreach (double element in doubleNumbers)
        {
            Console.WriteLine(element);
        }
    } 
```

有助于为上述两种方法提供一种方法的通用方法

```
 private static void printNumbers<E>(E [] Numbers)
    {
        foreach (E element in Numbers)
        {
            Console.WriteLine(element);
        }
    } 
```

* * *

## 回答 #274

> 赞同：2
> 
> 时间：2008-09-02T02:10:06.660

上一页属性：

“System.Web.UI.Page 表示将控制权转移到当前页面的页面。”

这是非常有用的。

* * *

## 回答 #275

> 赞同：2
> 
> 时间：2009-05-08T17:43:21.533

在处理 C++ 和 C# 之间的互操作时，很多人没有意识到 C++/CLI 是一个很好的选择。

假设您有一个 C++ DLL 和一个依赖于 C++ DLL 的 C# DLL。通常，最简单的技术是使用 /clr 开关编译 C++ DLL 的部分（或全部）模块。让 C# 调用 C++ DLL 就是在 C++ DLL 中编写托管 C++ 包装类。C++/CLI 类可以比 C# 更无缝地调用本机 C++ 代码，因为 C++ 编译器会自动为您生成 P/invokes，具有专门用于互操作的库，以及用于互操作的语言功能，例如[pin_ptr](http://msdn.microsoft.com/en-us/library/1dz8byfh(VS.80).aspx)。它允许托管代码和本机代码在同一个二进制文件中共存。

在 C# 方面，您只需像调用任何其他 .NET 二进制文件一样调用 DLL。

* * *

## 回答 #276

> 赞同：2
> 
> 时间：2008-08-18T17:06:41.957

我必须承认，我不确定这是否比正常的 ASP.NET 中继器 onItemDatabound 转换代码的性能更好或更差，但无论如何这是我的 5 美分。

```
MyObject obj = e.Item.DataItem as MyObject;
if(obj != null)
{
  //Do work
} 
```

* * *

## 回答 #277

> 赞同：2
> 
> 时间：2008-09-19T16:26:29.023

Before lambda comes into play, it's anonymous delegate. That could be used for blanket code similar to Ruby's blockgiven. I haven't tested how lambda works though because I want to stick with .NET 2.0 so far.

For example when you want to make sure you remember to close your HTML tags:

```
MyHtmlWriter writer=new MyHtmlWriter();
writer.writeTag("html", 
  delegate ()
  { 
    writer.writeTag("head", 
       delegate() 
       { 
           writer.writeTag("title"...);
       }
    )
  }) 
```

I am sure if lambda is an option, that could yield much cleaner code :)

* * *

## 回答 #278

> 赞同：2
> 
> 时间：2008-08-18T00:10:35.893

> 我认为如果您必须使用可为空的类型，最好使用 Nullable<.T> 而不是问号表示法。这使得魔法正在发生的事情变得非常明显。不知道为什么有人会想使用 Nullable<.bool> 。

在 VB.NET Web 服务中，参数可能不会通过*（因为合作伙伴的请求不一致或不可靠）*，但必须通过针对建议类型的验证*（“如果是搜索请求”的布尔值）*。把它归结为“管理层的另一个要求”......

*...是的，我知道有些人认为这不是做这些事情的正确方法，但是**IsSearchRequest As Nullable(Of Boolean)**让我那天晚上失去了理智！*

* * *

## 回答 #279

> 赞同：2
> 
> 时间：2008-09-05T09:14:04.713

@[罗比火箭裤](https://stackoverflow.com/questions/9033?#9092)

> “但我的直觉告诉我，这会将最多两种类型转换操作减少到最多一种。”

如果您按照示例 1 中的建议进行强制转换（使用 is & as），则会导致对“is”运算符的 2 次调用。因为当您执行“c = obj as MyClass”时，首先它会在后台调用“is”，然后如果失败，它只会返回 null。

如果您按照示例 2 中的建议进行演员阵容，

```
c = (MyClass)obj 
```

然后这实际上再次执行“is”操作，然后如果检查失败，则抛出异常（InvalidCastException）。

所以，如果你想做一个轻量级的动态转换，最好做你提供的第三个例子：

```
MyClass c;
if (obj is MyClass)
{
    c = obj as MyClass
}

if (c != null)
{
} 
```

**对比**

```
MyClass c = obj as MyClass;

if (c != null)
{
} 
```

您可以看到哪个更快、更简洁、更清晰。

* * *

## 回答 #280

> 赞同：2
> 
> 时间：2008-09-19T14:39:16.503

BCL 中的一些并发实用程序可能符合隐藏功能。

诸如 System.Threading.Monitor 之类的东西由 lock 关键字在内部使用；显然，在 C# 中 lock 关键字是可取的，但有时需要知道事情是如何在较低级别完成的；我必须锁定 C++/CLI，所以我用调用 Monitor.Enter() 和 Monitor.Exit() 封装了一段代码。

* * *

## 回答 #281

> 赞同：2
> 
> 时间：2009-10-20T10:04:34.167

在包含转义字符的字符串之前使用 @。基本上，当使用物理路径在字符串变量中分配时，每个人都使用“\”，其中字符串中存在转义字符。

例如字符串 strPath="D:\websites\web1\images\";

但是可以在字符串值之前使用 @ 忽略转义字符。

例如字符串 strPath=@"D:\websites\web1\images\";

* * *

## 回答 #282

> 赞同：2
> 
> 时间：2008-09-09T03:30:49.463

看到上面提到了 List.ForEach；2.0 引入了一系列基于谓词的集合操作 - Find、FindAll、Exists 等。再加上匿名委托，您几乎可以实现 3.5 的 lambda 表达式的简单性。

* * *

## 回答 #283

> 赞同：2
> 
> 时间：2010-03-02T05:16:54.683

大多数[P/Invoke](http://en.wikipedia.org/wiki/Platform_Invocation_Services)的东西有点奇怪。

属性示例：

```
[DllImport ("gdi32.dll")] 
[return : MarshalAs(UnmanagedType.I4)]
[StructLayout(LayoutKind.Sequential)] 
```

* * *

## 回答 #284

> 赞同：2
> 
> 时间：2009-06-03T15:37:49.650

谨慎使用时，选举是如此强大。我在电子邮件模板系统中使用它。模板管理器将被传递一个对象，并且 html 模板将具有引用属性的嵌入字段，这些属性可以使用反射从传递的对象中检索出来。效果很好。

* * *

## 回答 #285

> 赞同：2
> 
> 时间：2010-01-26T19:16:16.897

另一种通过 yield 获取 IEnumerable 而不显式创建 IEnumerable 对象的方法

```
public IEnumerable<Request> SomeMethod(IEnumerable<Request> requests)
{
    foreach (Request request in requests)
       yield return DoSomthing(request);
} 
```

* * *

## 回答 #286

> 赞同：2
> 
> 时间：2009-09-12T21:26:06.890

不确定微软是否会喜欢这个问题，尤其是有这么多回复。我敢肯定，我曾经听过一位微软负责人说：

> 隐藏的功能是浪费的功能

......或类似的东西。

* * *

## 回答 #287

> 赞同：2
> 
> 时间：2010-02-16T09:58:48.280

这个[使用 Delegate.CreateDelegate 调用私有方法的技巧](http://elegantcode.com/2010/01/28/calling-non-public-methods/)非常巧妙。

```
var subject = new Subject();
var doSomething = (Func<String, String>)
    Delegate.CreateDelegate(typeof(Func<String, String>), subject, "DoSomething");
Console.WriteLine(doSomething("Hello Freggles")); 
```

[这是一个有用的上下文](https://stackoverflow.com/questions/1043899/non-code-generated-forwarding-shim-for-testing-private-methods/1804696#1804696)

* * *

## 回答 #288

> 赞同：1
> 
> 时间：2008-11-18T10:54:30.593

[以下是](https://stackoverflow.com/questions/169276/is-the-region-directive-really-useful-in-net#287438)有关如何使用 #Region 指令来记录代码的提示。

* * *

## 回答 #289

> 赞同：1
> 
> 时间：2009-06-03T14:53:50.137

如果要阻止垃圾收集器运行对象的终结器，只需使用`GC.SuppressFinalize(object);`. 以类似的方式，`GC.KeepAlive(object);`将阻止垃圾收集器通过引用它来收集该对象。不是很常用，至少在我的经验中，但很高兴知道以防万一。

* * *

## 回答 #290

> 赞同：1
> 
> 时间：2010-05-16T09:55:53.540

根据周围类的泛型类型分隔静态字段。

```
 public class StaticConstrucEx2Outer<T> {

 // Will hold a different value depending on the specicified generic type
 public T SomeProperty { get; set; }

 static StaticConstrucEx2Outer() {
  Console.WriteLine("StaticConstrucEx2Outer " + typeof(T).Name);
 }

 public class StaticConstrucEx2Inner<U, V> {

  static StaticConstrucEx2Inner() {

   Console.WriteLine("Outer <{0}> : Inner <{1}><{2}>",
    typeof(T).Name,
    typeof(U).Name,
    typeof(V).Name);
  }

  public static void FooBar() {}
 }

 public class SCInner {

  static SCInner() {
   Console.WriteLine("SCInner init <{0}>", typeof(T).Name);
  }

  public static void FooBar() {}
 }
}

StaticConstrucEx2Outer<int>.StaticConstrucEx2Inner<string, DateTime>.FooBar();
StaticConstrucEx2Outer<int>.SCInner.FooBar();

StaticConstrucEx2Outer<string>.StaticConstrucEx2Inner<string, DateTime>.FooBar();
StaticConstrucEx2Outer<string>.SCInner.FooBar();

StaticConstrucEx2Outer<string>.StaticConstrucEx2Inner<string, Int16>.FooBar();
StaticConstrucEx2Outer<string>.SCInner.FooBar();

StaticConstrucEx2Outer<string>.StaticConstrucEx2Inner<string, UInt32>.FooBar();

StaticConstrucEx2Outer<long>.StaticConstrucEx2Inner<string, UInt32>.FooBar(); 
```

将产生以下输出

```
Outer <Int32> : Inner <String><DateTime>
SCInner init <Int32>

Outer <String> : Inner <String><DateTime>
SCInner init <String>

Outer <String> : Inner <String><Int16>

Outer <String> : Inner <String><UInt32>

Outer <Int64> : Inner <String><UInt32> 
```

* * *

## 回答 #291

> 赞同：1
> 
> 时间：2008-09-19T19:20:30.743

如果允许第 3 方扩展，那么[C5](http://www.google.co.il/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fwww.itu.dk%2Fresearch%2Fc5%2F&ei=H_vTSPmZGZyw0gTK4t2VDQ&usg=AFQjCNEd1FXV-4rROqtPwZ_jDwmW1w5pFA&sig2=ILE99mEc76cQ6g-iRnPgbQ)和[Microsoft CCR](http://www.google.co.il/url?sa=t&source=web&ct=res&cd=2&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fbb648752.aspx&ei=N_vTSPzrComE0QSvwemcDQ&usg=AFQjCNFxZGL9m_QDWlvlkRNOpiLSG_q8bA&sig2=NGJmUpq-jE6kawcvaWWGYQ)（请参阅[此博客文章](http://www.lnbogen.com/MicrosoftCCRCleanWayToWriteParallelCodeInNet.aspx)以获得快速介绍）是必须了解的。

C5 补充了 .Net 有点缺乏的集合库（不是 Set???），CCR 使并发编程更容易（我听说它应该与 Parallel Extensions 合并）。

* * *

## 回答 #292

> 赞同：1
> 
> 时间：2008-09-23T07:45:27.323

一些 ？？奇怪:)

```
Delegate target =
  (target0 = target as CallTargetWithContext0) ??
  (target1 = target as CallTargetWithContext1) ??
  (target2 = target as CallTargetWithContext2) ??
  (target3 = target as CallTargetWithContext3) ??
  (target4 = target as CallTargetWithContext4) ??
  (target5 = target as CallTargetWithContext5) ??
  ((Delegate)(targetN = target as CallTargetWithContextN)); 
```

有趣的是注意到由于某种原因需要的最后一个演员表。错误还是设计？

* * *

## 回答 #293

> 赞同：1
> 
> 时间：2009-03-31T04:18:58.253

不隐藏，但很整洁。我发现这是一个简单的 if-then-else 的更简洁的替代品，它只是根据条件分配一个值。

```
string result = 
              i < 2 ?               //question
              "less than 2" :       //answer
              i < 5 ?               //question
             "less than 5":         //answer   
              i < 10 ?              //question
              "less than 10":       //answer
              "something else";     //default answer 
```

* * *

## 回答 #294

> 赞同：1
> 
> 时间：2009-08-05T17:20:36.187

**当您需要（a）在对象之间就事件的发生进行同步通信时，有一个称为ISynchronizeInvoke**的专用接口。

引用 MSDN 文章（[链接](http://msdn.microsoft.com/en-us/library/system.componentmodel.isynchronizeinvoke.aspx)）：

> 实现此接口的对象可以接收事件发生的通知，并且可以响应有关事件的查询。通过这种方式，客户端可以确保在提交取决于第一个完成的后续请求之前已经处理了一个请求。

这是一个通用包装器：

```
protected void OnEvent<T>(EventHandler<T> eventHandler, T args) where T : EventArgs
{
    if (eventHandler == null) return;

    foreach (EventHandler<T> singleEvent in eventHandler.GetInvocationList())
    {
        if (singleEvent.Target != null && singleEvent.Target is ISynchronizeInvoke)
        {
            var target = (ISynchronizeInvoke)singleEvent.Target;

            if (target.InvokeRequired) {
                target.BeginInvoke(singleEvent, new object[] { this, args });
                continue;
            }
        }
        singleEvent(this, args);
    }
} 
```

这是一个示例用法：

```
public event EventHandler<ProgressEventArgs> ProgressChanged;

private void OnProgressChanged(int processed, int total)
{
    OnEvent(ProgressChanged, new ProgressEventArgs(processed, total));
} 
```

* * *

## 回答 #295

> 赞同：1
> 
> 时间：2009-07-17T14:29:23.230

[异常过滤器](http://code.msdn.microsoft.com/ExceptionFilterInjct)。所以“隐藏”你甚至*不能*在没有编译后补丁的情况下使用它们（至少从 C# 中）；）

* * *

## 回答 #296

> 赞同：0
> 
> 时间：2010-02-19T03:54:47.300

我不知道这是否是一个隐藏功能（“”）。任何字符串函数。

# java - 我可以在 TestNG 测试用例上指定一个类范围的组吗？

> ID：9044
> 
> 赞同：16
> 
> 时间：2008-08-12T16:52:08.697
> 
> 标签：java, testng

我有一个表示 TestNG 中的数据库测试的基类，我想指定从该类扩展的所有类都属于“db-test”组，但是我发现这似乎不可能。我已经尝试过 @Test 注释：

```
@Test(groups = { "db-test" })
public class DBTestBase {
} 
```

但是，这不起作用，因为 @Test 注释会尝试将一堆方法放入测试中，并且在运行测试时会在 eclipse 中弹出警告/错误。

所以我尝试禁用测试，所以至少分配了组：

```
@Test(enabled = false, groups = { "db-test" })
public class DBTestBase {
} 
```

但随后任何@BeforeTest（和其他类似的注释）也被禁用......这当然不是我想要的。

我想用某种方法将一个类注释为特定类型的组，但在 TestNG 中似乎不太可能。有没有人有任何其他想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T18:06:40.610

TestNG 将运行带有@Test 注解的类中的所有公共方法。也许您可以将不希望 TestNG 运行的方法更改为非公开的

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-08T23:12:31.067

答案是通过自定义**org.testng.IMethodSelector**：

它的**includeMethod()**可以排除我们想要的任何方法，比如公共的未注释方法。

但是，要注册自定义*Java* MethodSelector，您必须将其添加到任何 TestRunner 管理的**XMLTest**实例中，这意味着您需要自己的**自定义 TestRunner**。

但是，要构建自定义 TestRunner，您需要通过**-testrunfactory**选项注册一个**TestRunnerFactory 。**

 ****但是TestNG**类从不考虑 -testrunfactory ......所以您还需要定义一个自定义 TestNG 类：

*   为了覆盖 configure(Map) 方法，
*   所以你可以实际设置 TestRunnerFactory
*   TestRunnerFactory 将为您构建一个自定义的 TestRunner，
*   TestRunner 将为 XMLTest 实例设置一个自定义 XMLMethodSelector
*   XMLMethodSelector 将构建一个自定义的 IMethodSelector
*   IMethodSelector 将排除您选择的任何 TestNG 方法！

好吧……这是一场噩梦。但这也是一个代码挑战，所以一定有点挑战；）

所有代码都可以在[**DZone 片段**](http://snippets.dzone.com/posts/show/6446)中找到。

像往常一样进行代码挑战：

*   一个 java 类（和相当多的内部类）
*   将类复制粘贴到“源/测试”目录中（因为包是“测试”）
*   运行它（不需要参数）

* * *

**迈克·斯通的更新：**

我会接受这一点，因为它听起来非常接近我最终所做的，但我想我也会添加我所做的。

基本上，我创建了一个 Groups 注释，其行为类似于 Test（和其他）注释的 groups 属性。

然后，我创建了一个 GroupsAnnotationTransformer，它使用 IAnnotationTransformer 查看正在定义的所有测试和测试类，然后修改测试以添加组，这与组排除和包含完美配合。

修改构建以使用新的注释转换器，这一切都完美无缺！

嗯......一个警告是它不会将组添加到非测试方法......因为在我这样做的时候，有另一个注释转换器可以让你转换任何东西，但它不包括在内在我出于某种原因使用的TestNG中......所以最好让你的前/后注释方法总是运行=真......这对我来说已经足够了。

最终结果是我可以做到：

```
@Groups({ "myGroup1", "myGroup2"})
public class MyTestCase {
    @Test
    @Groups("aMethodLevelGroup")
    public void myTest() {
    }
} 
```

我让转换器与子类化和所有东西一起工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T19:03:22.737

我不确定 TestNG 的注释继承是如何工作的，但这篇[文章](http://web.archive.org/web/20100104232432/http://beust.com/weblog/archives/000170.html)可能会有一些用处。

实际上，这可能会[有所帮助](http://testng.org/doc/documentation-main.html#annotations)，请查看inheritGroups。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-08T22:57:34.233

在我看来，这是以下**代码挑战**（社区 wiki 帖子）：

如何能够从组“aGlobalGroup”执行扩展类的所有测试方法，而无需：

*   在扩展类本身上指定“aGlobalGroup”组？
*   测试扩展类的非注释公共方法？

第一个答案很简单：
**在基类级别添加一个类 TestNG(groups = { "aGlobalGroup" })**

该组将适用于基类和扩展类的所有公共方法。

但是：即使是非 testng 公共方法（没有 TestNG 注释）也将包含在该组中。

挑战：避免包含那些非 TestNG 方法。

```
@Test(groups = { "aGlobalGroup" })
public class Base {

    /**
     * 
     */
    @BeforeClass
     public final void setUp() {
           System.out.println("Base class: @BeforeClass");
     }

    /**
     * Test not part a 'aGlobalGroup', but still included in that group due to the class annotation. <br />
     * Will be executed even if the TestNG class tested is a sub-class.
     */
    @Test(groups = { "aLocalGroup" })
     public final void aFastTest() {
       System.out.println("Base class: Fast test");
     }

    /**
     * Test not part a 'aGlobalGroup', but still included in that group due to the class annotation. <br />
     * Will be executed even if the TestNG class tested is a sub-class.
     */
    @Test(groups = { "aLocalGroup" })
     public final void aSlowTest() {
        System.out.println("Base class: Slow test");
        //throw new IllegalArgumentException("oups");
     }

     /**
      * Should not be executed. <br />
      * Yet the global annotation Test on the class would include it in the TestNG methods...
     */
    public final void notATest() {
       System.out.println("Base class: NOT a test");
     }

    /**
     * SubClass of a TestNG class. Some of its methods are TestNG methods, other are not. <br />
     * The goal is to check if a group specify in the super-class will include methods of this class. <br />
     * And to avoid including too much methods, such as public methods not intended to be TestNG methods.
     * @author <a href="http://stackoverflow.com/users/6309/vonc">VonC</a>
     */
    public static class Extended extends Base
    {
        /**
         * Test not part a 'aGlobalGroup', but still included in that group due to the super-class annotation. <br />
         * Will be executed even if the TestNG class tested is a sub-class.
         */
        @Test
        public final void anExtendedTest() {
           System.out.println("Extended class: An Extended test");
        }

        /**
         * Should not be executed. <br />
         * Yet the global annotation Test on the class would include it in the TestNG methods...
         */ 
        public final void notAnExtendedTest() {
            System.out.println("Extended class: NOT an Extended test");
        }
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T17:23:10.673

您可以在允许最大灵活性的方法级别指定 @Test 注释。

```
public class DBTestBase {

    @BeforeTest(groups = "db-test")
    public void beforeTest() {
        System.out.println("Running before test");
    }

    public void method1() {
        Assert.fail(); // this does not run. It does not belong to 'db-test' group.
    }

    @Test(groups = "db-test")
    public void testMethod1() {
        Assert.assertTrue(true);
    }
} 
```

这对你有用还是我从你的问题中遗漏了一些东西。

# ms-access - MS Access 有没有办法获取当前的 Active Directory 用户？

> ID：9052
> 
> 赞同：10
> 
> 时间：2008-08-12T17:03:28.220
> 
> 标签：ms-access, active-directory

我正在为我的公司制定一个软件的规范，作为审计系统的一部分，我认为如果有办法抓住当前的 Active Directory 用户，那就太好了。

希望是这样的：

```
Dim strUser as String
strUser = ActiveDirectory.User()
MsgBox "Welcome back, " & strUser 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-12T17:07:52.563

[试试这篇文章](http://bytes.com/forum/thread717576.html)- 我有一些代码在工作中，如果这不可行的话......

相关报价：

> ```
> Private Declare Function GetUserName Lib "advapi32.dll" Alias "GetUserNameA" _
>                     (ByVal IpBuffer As String, nSize As Long) As Long
> Private Declare Function GetComputerName Lib "kernel32" Alias "GetComputerNameA" _
>                     (ByVal lpBuffer As String, nSize As Long) As Long
> 
> Function ThisUserName() As String
>     Dim LngBufLen As Long
>     Dim strUser As String
> 
>     strUser = String$(15, " ")
>     LngBufLen = 15
> 
>     If GetUserName(strUser, LngBufLen) = 1 Then
>         ThisUserName = Left(strUser, LngBufLen - 1)
>     Else
>         ThisUserName = "Unknown"
>     End If
> End Function
> 
> Function ThisComputerID() As String
>     Dim LngBufLen As Long
>     Dim strUser As String
> 
>     strUser = String$(15, " ")
>     LngBufLen = 15
> 
>     If GetComputerName(strUser, LngBufLen) = 1 Then
>         ThisComputerID = Left(strUser, LngBufLen)
>     Else
>         ThisComputerID = 0
>     End If
> End Function 
> ```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-07-18T22:14:47.730

这是我的版本：它将获取您喜欢的任何内容：

```
'gets firstname, lastname, fullname or username
Public Function GetUser(Optional whatpart = "username")
    Dim returnthis As String
    If whatpart = "username" Then GetUser = Environ("USERNAME"): Exit Function
    Set objSysInfo = CreateObject("ADSystemInfo")
    Set objUser = GetObject("LDAP://" & objSysInfo.USERNAME)
    Select Case whatpart
        Case "fullname": returnthis = objUser.FullName
        Case "firstname", "givenname": returnthis = objUser.givenName
        Case "lastname": returnthis = objUser.LastName
        Case Else: returnthis = Environ("USERNAME")
    End Select
    GetUser = returnthis
End Function 
```

[我从 Spiceworks 得到了最初的想法](http://community.spiceworks.com/scripts/show/425-get-the-current-logged-on-user-s-first-last-name)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T22:17:06.850

依赖环境变量保持有效是一个坏主意，因为它们很容易在用户会话中更改。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T10:29:51.957

David 对使用环境变量的风险提出了很好的观点。我只能补充一点，环境变量可能还有其他问题。看看我们 5 年前的项目中的这个实际代码片段：

```
Public Function CurrentWorkbenchUser() As String

    ' 2004-01-05, YM: Using Application.CurrentUser for identification of 
    ' current user is very problematic (more specifically, extremely 
    ' cumbersome to set up and administer for all users). 
    ' Therefore, as a quick fix, let's use the OS-level user's 
    ' identity instead (NB: the environment variables used below must work fine
    ' on Windows NT/2000/2003 but may not work on Windows 98/ME)
    ' CurrentWorkbenchUser = Application.CurrentUser
    '
    ' 2005-06-13, YM: Environment variables do not work in Windows 2003\. 
    ' Use Windows Scripting Host (WSH) Networking object instead.
    ' CurrentWorkbenchUser = Environ("UserDomain") & "\" & Environ("UserName")
    '
    ' 2007-01-23, YM: Somewhere between 2007-01-09 and 2007-01-20, 
    ' the WshNetwork object stopped working on CONTROLLER3\. 
    ' We could not find any easy way to fix that.
    ' At the same time, it turns out that environment variables 
    ' do work on Windows 2003.
    ' (Apparently, it was some weird configuration problem back in 2005: 
    ' we had only one Windows 2003 computer at that time and it was 
    ' Will's workstation).
    '
    ' In any case, at the time of this writing, 
    ' returning to environment variables 
    ' appears to be the simplest solution to the problem on CONTROLLER3.
    ' Dim wshn As New WshNetwork
    ' CurrentWorkbenchUser = wshn.UserDomain & "\" & wshn.UserName

    CurrentWorkbenchUser = Environ("USERDOMAIN") & "\" & Environ("USERNAME")

End Function 
```

# javascript - YUI 拖放代理拖动

> ID：9072
> 
> 赞同：6
> 
> 时间：2008-08-12T17:47:26.213
> 
> 标签：javascript, drag-and-drop, yui

YUI专家的问题...

我有一个表格，并且我已经使第一行的每个单元格都可以通过[proxy](http://web.archive.org/web/20160728103125/https://developer.yahoo.com/yui/examples/dragdrop/dd-proxy.html)拖动。在 IE 中，当拖动代理被释放时，原来的表格单元格实际上会跳转到释放点所在的位置。我怎样才能防止这种情况发生？本质上，我想知道代理在哪里被删除并从那里处理我的逻辑，但我不希望原件移动。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T13:39:36.597

您必须覆盖下拉功能，检查

`DD::dragOverEvent( )`

`DD:endDragEvent( )`

此参考上的功能：

[http://developer.yahoo.com/yui/docs/YAHOO.util.DD.html](http://developer.yahoo.com/yui/docs/YAHOO.util.DD.html)

# search - grep 一个文件，但显示几个周围的行？

> ID：9081
> 
> 赞同：3861
> 
> 时间：2008-08-12T17:55:32.813
> 
> 标签：search, logging, grep, command-line-interface

我想`grep`换一个字符串，还要显示前五行和后五行以及匹配的行。我怎么能做到这一点？

* * *

## 回答 #1

> 赞同：5116
> 
> 时间：2008-08-12T17:57:43.307

对于**BSD**或**GNU** `grep`，您可以使用`-B num`设置匹配前的`-A num`行数和匹配后的行数。

```
grep -B 3 -A 2 foo README.txt 
```

如果您希望前后行数相同，可以使用`-C num`.

```
grep -C 3 foo README.txt 
```

这将显示 3 行之前和 3 行之后。

* * *

## 回答 #2

> 赞同：634
> 
> 时间：2008-08-12T17:59:56.080

`-A`并且`-B`可以正常工作`-C n`（对于`n`上下文行），或者只是`-n`（对于`n`上下文行......只要 n 是 1 到 9）。

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2008-09-07T11:13:11.773

[ack](http://beyondgrep.com/)使用与 grep 类似的参数，并接受`-C`. 但通常更适合通过代码进行搜索。

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2008-08-12T17:58:00.153

```
grep astring myfile -A 5 -B 5 
```

这将为“astring”grep“myfile”，并在每次匹配之前和之后显示 5 行

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2008-08-12T18:42:49.080

我通常使用

```
grep searchstring file -C n # n for number of lines of context up and down 
```

许多像 grep 这样的工具也有非常棒的 man 文件。我发现自己经常参考[grep 的手册页](http://unixhelp.ed.ac.uk/CGI/man-cgi?grep)，因为你可以用它做很多事情。

```
man grep 
```

许多 GNU 工具还有一个[信息页面](http://web.archive.org/web/20090427121543/http://www.gnu.org:80/software/grep/doc/grep_toc.html)，除了手册页之外，它可能还有更多有用的信息。

```
info grep 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2018-01-12T11:25:38.453

使用 grep

```
$ grep --help | grep -i context
Context control:
  -B, --before-context=NUM  print NUM lines of leading context
  -A, --after-context=NUM   print NUM lines of trailing context
  -C, --context=NUM         print NUM lines of output context
  -NUM                      same as --context=NUM 
```

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2018-04-11T10:28:35.247

### [`ripgrep`](https://github.com/BurntSushi/ripgrep)

如果您关心性能，请使用[`ripgrep`](https://github.com/BurntSushi/ripgrep)与 具有相似语法的`grep`，例如

```
rg -C5 "pattern" . 
```

> `-C`, `--context NUM`- 在每场比赛前后显示 NUM 行。

还有`-A`/`--after-context`和`-B`/等参数`--before-context`。

该工具建立在[Rust 的正则表达式引擎](https://github.com/rust-lang-nursery/regex)之上，这使得它在处理大数据时非常[高效。](http://blog.burntsushi.net/ripgrep/)

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2013-10-08T00:21:17.040

`/some/file.txt`在显示前后 10 行上下文中搜索“17655” （使用`Awk`），输出前面是行号，后跟一个冒号。`grep`当不支持这些`-[ACB]`选项时，在 Solaris 上使用它。

```
awk '

/17655/ {
        for (i = (b + 1) % 10; i != b; i = (i + 1) % 10) {
                print before[i]
        }
        print (NR ":" ($0))
        a = 10
}

a-- > 0 {
        print (NR ":" ($0))
}

{
        before[b] = (NR ":" ($0))
        b = (b + 1) % 10
}' /some/file.txt; 
```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2020-04-28T17:14:25.193

如果您经常搜索代码，[银牌搜索器 AG](https://github.com/ggreer/the_silver_searcher)比 grep 更有效（即更快）。

您可以使用该`-C`选项显示上下文行。

例如：

```
ag -C 3 "foo" myFile

line 1
line 2
line 3
line that has "foo"
line 5
line 6
line 7 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2020-12-30T09:41:18.177

您可以在 grep 命令中使用选项`-A`(after) 和`-B`(before)。

尝试`grep -nri -A 5 -B 5 .`

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2018-04-11T10:24:12.747

这是[@Ygor 中](https://www.unix.com/302098992-post2.html?s=4309a3b1b120fabe0d81368129bc8921)的解决方案`awk`

```
awk 'c-->0;$0~s{if(b)for(c=b+1;c>1;c--)print r[(NR-c+1)%b];print;c=a}b{r[NR%b]=$0}' b=3 a=3 s="pattern" myfile 
```

^(注意：用前后的行数替换`a`和变量。`b`)

它对于不支持 grep 和参数的系统`-A`特别有用`-B`。`-C`

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2019-12-11T17:24:10.497

我以紧凑的方式做到这一点：

```
grep -5 string file 
```

这相当于：

```
grep -A 5 -B 5 string file 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2019-03-11T07:11:40.793

Grep 有一个名为 的选项`Context Line Control`，您可以`--context`在其中简单地使用

```
| grep -C 5 
```

或者

```
| grep -5 
```

应该做的伎俩

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2019-01-05T18:39:36.197

```
$ grep thestring thefile -5 
```

`-5`让你`5`在匹配 'thestring' 上方和下方的行等效于`-C 5`or `-A 5 -B 5`。

# .net - 使用 .NET 访问音频/视频元数据

> ID：9091
> 
> 赞同：10
> 
> 时间：2008-08-12T18:01:27.480
> 
> 标签：.net, video, audio, mp3

使用 .NET 获取和设置 mp3、mp4、avi 文件等元数据的最佳方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-12T19:34:28.760

我将[MediaInfo](http://mediainfo.sourceforge.net/en)与我的 C# 应用程序一起使用，为您提供了大量有关媒体文件的信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-12T20:18:03.930

这些是在 MediaInfo.dll zip 中找到的不同语言的示例类文件

*   媒体信息DLL.cs
*   MediaInfoDLL.def
*   媒体信息DLL.h
*   MediaInfoDLL.java
*   MediaInfoDLL.jsl
*   MediaInfoDLL.pas
*   媒体信息DLL.py
*   媒体信息DLL.vb
*   MediaInfoDLL_Static.h

你必须使用互操作，我不知道你是否可以编辑标签，我从来不需要这样做，但至少对于从文件中获取媒体信息来说，它几乎是一把瑞士军刀。

[链接到下载页面（sourceforge）](http://sourceforge.net/project/showfiles.php?group_id=86862&package_id=90614/showfiles.php?group_id=86862&package_id=90614)

MediaInfo_0.7.7.4_DLL_Win32.zip

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-12T18:15:52.053

您可以使用免费[的 UltraID3Lib](http://home.fuse.net/honnert/UltraID3Lib/) .NET 库来读取/写入 MP3 元数据。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-12T19:09:30.743

我也一直在研究处理 MP3/WMA/OGG 的[NTag](http://web.archive.org/web/20140212092246/http://orthogonal.com.au/computers/ntag/index.htm)项目。我不知道有哪个库可以处理音频和视频文件，因此您可能需要使用一些。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-18T08:29:43.310

我最近使用[Tag Lib Sharp](http://github.com/mono/taglib-sharp)编写了一些 C# 应用程序来清理和维护我的音乐库。我发现该库非常易于使用，虽然我只将它用于 MP3，但它似乎支持一系列其他音乐/视频格式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-12T20:45:00.800

我使用 COM 互操作来访问[DirectShow 的媒体检测器](http://msdn.microsoft.com/en-us/library/ms785892(VS.85).aspx)功能。

这确实工作得很好，但它的背后是一个正确的痛苦。您需要了解很多关于 COM、win32 互操作等的知识。

您也可以使用[DirectShowNet](http://directshownet.sourceforge.net/about.html)，它应该为您处理大部分内容，当我只对 MediaDetector 部分感兴趣时，我只是不想拖着整个事情

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-12T19:59:17.743

看起来 MediaInfo 在这一点上是只读的，顺便说一下：http: [//sourceforge.net/forum/message.php ?msg_id=4241318&abmode=1](http://sourceforge.net/forum/message.php?msg_id=4241318&abmode=1)

不过，非常酷的项目。在 SO 上发现所有这些很酷的东西很有趣。

# javascript - 添加一个只有 javascript 而不是 URL 的书签

> ID：9104
> 
> 赞同：56
> 
> 时间：2008-08-12T18:27:35.883
> 
> 标签：javascript, bookmarklet, bookmarks

我在想我不能这样做的原因是因为它可能是一个巨大的安全漏洞，但是这里......

我想在我的浏览器（最好是 FF3）上有一个书签，它只是一段 javascript 代码。它只会根据当前日期构造一个 URL，然后在该 URL 上执行 window.location =。

我知道我可以制作一个页面并将其保存在我的本地计算机上并以这种方式引用它，但我只是想知道您是否可以绕过该步骤并实际上让书签的“位置”实际上只是 javascript。我本可以发誓这在几年前是可能的，但我现在找不到任何可以告诉我的东西。

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-08-12T18:29:24.037

你想要的是一个[书签](http://en.wikipedia.org/wiki/Bookmarklet)，它们很容易创建，应该可以在大多数主流浏览器中使用。

编辑：堆栈溢出似乎不允许在站点的上下文中创建书签，基本上您可以创建一个新书签并在位置字段中键入以下内容

```
javascript:window.location='http://www.google.com/search?q='+Date()
```

获取一个在 google 上搜索当前日期的书签。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-07-20T15:25:09.980

值得注意的是，您也可以将其放入函数包装器中。imranamajeed 为我们很好地说明了这一点……但显然我对该网站太陌生了，无法发布他的帖子。:P

所以为了清楚起见：

```
javascript:(function(){
  location.href = location.href + "#";
})(); 
```

（回车不影响 chrome 和 IE 中的性能）

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-16T01:57:43.250

一个小问题。**IE**只能处理这种格式的**508**个字符的 URL。如果您将其保存在 IE 中，其 url 比这长，它将在没有警告的情况下截断并因此失败。

如果您需要一个非常复杂的脚本，则需要使用“托管”书签，其中您有一个短书签，可以将脚本标签注入页面，以“调用”您的托管书签。

它不是那么好/便携，但它是唯一的解决方法。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-01-24T20:13:48.263

谷歌书签

```
javascript:(function(){var%20a=window,b=document,c=encodeURIComponent,d=a.open("http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk="+c(b.location)+"&title="+c(b.title),"bkmk_popup","left="+((a.screenX||a.screenLeft)+10)+",top="+((a.screenY||a.screenTop)+10)+",height=420px,width=550px,resizable=1,alwaysRaised=1");a.setTimeout(function(){d.focus()},300)})(); 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-08-12T18:31:11.320

好吧，我刚刚在FF3中创建了一个书签，回去更新它并添加了以下测试：

```
javascript:alert('Wacky%20test%20yo'); 
```

低，看，在我保存和加载之后，我能够得到我的警报。

我相信你可以根据你的需要做一些类似的事情。

# mysql - 在MySQL中选择除一列之外的所有列？

> ID：9122
> 
> 赞同：424
> 
> 时间：2008-08-12T18:45:55.207
> 
> 标签：mysql, select, wildcard

我正在尝试使用 select 语句从某个 MySQL 表中获取除一个之外的所有列。有没有一种简单的方法可以做到这一点？

编辑：此表中有 53 列（不是我的设计）

* * *

## 回答 #1

> 赞同：240
> 
> 时间：2009-09-29T23:35:25.420

实际上有一种方法，您当然需要拥有这样做的权限......

```
SET @sql = CONCAT('SELECT ', (SELECT REPLACE(GROUP_CONCAT(COLUMN_NAME), '<columns_to_omit>,', '') FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = '<table>' AND TABLE_SCHEMA = '<database>'), ' FROM <table>');

PREPARE stmt1 FROM @sql;
EXECUTE stmt1; 
```

更换`<table>, <database> and <columns_to_omit>`

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2010-12-16T13:15:34.310

（不要在大桌子上尝试这个，结果可能......令人惊讶！）

> 临时表

```
DROP TABLE IF EXISTS temp_tb;
CREATE TEMPORARY TABLE ENGINE=MEMORY temp_tb SELECT * FROM orig_tb;
ALTER TABLE temp_tb DROP col_a, DROP col_f,DROP col_z;    #// MySQL
SELECT * FROM temp_tb; 
```

DROP 语法可能因数据库而异[@Denis Rozhnev](http://www.oracle-base.com/articles/8i/dropping-columns.php)

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2008-08-12T19:11:17.573

在这种情况下，视图会更好吗？

```
CREATE VIEW vwTable
as  
SELECT  
    col1  
    , col2  
    , col3  
    , col..  
    , col53  
FROM table 
```

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2008-08-12T18:48:04.983

你可以做：

```
SELECT column1, column2, column4 FROM table WHERE whatever 
```

没有得到 column3，但也许您正在寻找更通用的解决方案？

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2008-08-12T18:47:38.667

据我所知，没有。您可以执行以下操作：

```
SELECT col1, col2, col3, col4 FROM tbl 
```

并手动选择所需的列。但是，如果您想要很多列，那么您可能只想执行以下操作：

```
SELECT * FROM tbl 
```

并且忽略你不想要的。

在您的特定情况下，我建议：

```
SELECT * FROM tbl 
```

除非你只想要几列。如果你只想要四列，那么：

```
SELECT col3, col6, col45, col 52 FROM tbl 
```

会很好，但如果你想要 50 列，那么任何使查询的代码都会变得（太？）难以阅读。

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2013-06-13T17:24:06.700

如果您希望排除某个字段的值，例如出于安全考虑/敏感信息，您可以将该列检索为空。

例如

```
SELECT *, NULL AS salary FROM users 
```

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2013-07-18T09:01:56.820

在尝试@Mahomedalid 和@Junaid 的解决方案时，我发现了一个问题。于是想到分享。如果列名包含空格或连字符，例如签入，则查询将失败。简单的解决方法是在列名周围使用反引号。修改后的查询如下

```
SET @SQL = CONCAT('SELECT ', (SELECT GROUP_CONCAT(CONCAT("`", COLUMN_NAME, "`")) FROM
INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'users' AND COLUMN_NAME NOT IN ('id')), ' FROM users');
PREPARE stmt1 FROM @SQL;
EXECUTE stmt1; 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-08-12T18:56:35.340

如果您不想选择的列中有大量数据，并且由于速度问题不想包含它并且您经常选择其他列，我建议您创建一个新表使用您通常不使用原始表的键选择的一个字段，然后从原始表中删除该字段。当实际需要该额外字段时加入表。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-08-12T19:01:14.380

您可以使用[DESCRIBE my_table](http://dev.mysql.com/doc/refman/5.0/en/describe.html)并使用其结果动态生成 SELECT 语句。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2011-07-08T12:26:11.383

我的主要问题是加入表格时我得到了很多列。虽然这不是您问题的答案（如何从*一个*表中选择除某些列之外的所有列），但我认为值得一提的是，您可以指定*从特定表中获取所有列，而不仅仅是指定*.`table.`

 *`这是一个非常有用的示例：

```
选择用户。*，phone.meta_value 作为电话，zipcode.meta_value 作为邮政编码

来自用户

left join user_meta as phone
on ( (users.user_id = phone.user_id) AND (phone.meta_key = 'phone') )

left join user_meta as zipcode
on ( (users.user_id = zipcode.user_id) AND (zipcode.meta_key = 'zipcode') )

```

结果是用户表中的所有列，以及从元表中连接的另外两个列。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2012-05-15T09:56:16.417

`@Mahomedalid`除了这个事实之外，我还喜欢来自评论的答案`@Bill Karwin`。提出的可能问题`@Jan Koritak`是真的，我遇到了这个问题，但我找到了一个技巧，只想在这里与任何面临这个问题的人分享。

我们可以在 Prepared 语句的子查询中用 where 子句替换 REPLACE 函数，如下所示：

使用我的表名和列名

```
SET @SQL = CONCAT('SELECT ', (SELECT GROUP_CONCAT(COLUMN_NAME) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'users' AND COLUMN_NAME NOT IN ('id')), ' FROM users');
PREPARE stmt1 FROM @SQL;
EXECUTE stmt1; 
```

因此，这将仅排除该字段`id`，但不排除`company_id`

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2010-02-23T22:04:56.437

是的，虽然它可能是高 I/O，但取决于这里的表，这是我找到的一种解决方法。

```
SELECT *
INTO #temp
FROM table

ALTER TABLE #temp DROP COlUMN column_name

SELECT *
FROM #temp 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-08-12T19:20:19.753

即使查询所有列，最好指定要查询的列。

所以我建议你在语句中写下每一列的名称（不包括你不想要的那一个）。

```
SELECT
    col1
    , col2
    , col3
    , col..
    , col53

FROM table 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2011-01-07T03:20:13.550

我同意列出所有列的“简单”解决方案，但这可能很麻烦，而且拼写错误会浪费大量时间。我使用函数“getTableColumns”来检索适合粘贴到查询中的列的名称。然后我需要做的就是删除那些我不想要的。

```
CREATE FUNCTION `getTableColumns`(tablename varchar(100)) 
          RETURNS varchar(5000) CHARSET latin1
BEGIN
  DECLARE done INT DEFAULT 0;
  DECLARE res  VARCHAR(5000) DEFAULT "";

  DECLARE col  VARCHAR(200);
  DECLARE cur1 CURSOR FOR 
    select COLUMN_NAME from information_schema.columns 
    where TABLE_NAME=@table AND TABLE_SCHEMA="yourdatabase" ORDER BY ORDINAL_POSITION;
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
  OPEN cur1;
  REPEAT
       FETCH cur1 INTO col;
       IF NOT done THEN 
          set res = CONCAT(res,IF(LENGTH(res)>0,",",""),col);
       END IF;
    UNTIL done END REPEAT;
  CLOSE cur1;
  RETURN res; 
```

您的结果返回一个逗号分隔的字符串，例如...

> col1,col2,col3,col4,...col53

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-08-12T19:12:23.123

我同意`Select *`，如果你不需要的那个是 BLOB 是不够的，正如在别处提到的那样，你不想让开销蔓延。

我会创建一个包含所需数据的**视图**`Select *`，然后您可以放心——如果数据库软件支持它们。否则，将庞大的数据放在另一个表中。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-08-12T20:27:31.897

起初我以为你可以使用正则表达式，但是当我一直在阅读[MYSQL 文档](http://dev.mysql.com/doc/refman/5.0/en/select.html)时，似乎你不能。如果我是你，我会使用另一种语言（例如 PHP）来生成你想要获取的列列表，将其存储为字符串，然后使用它来生成 SQL。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2012-06-16T04:36:11.197

基于@Mahomedalid 的回答，我做了一些改进以支持“选择除mysql 中的某些列之外的所有列”

```
SET @database    = 'database_name';
SET @tablename   = 'table_name';
SET @cols2delete = 'col1,col2,col3';

SET @sql = CONCAT(
'SELECT ', 
(
    SELECT GROUP_CONCAT( IF(FIND_IN_SET(COLUMN_NAME, @cols2delete), NULL, COLUMN_NAME ) )
    FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @tablename AND TABLE_SCHEMA = @database
), 
' FROM ',
@tablename);

SELECT @sql; 
```

如果您确实有很多列，请使用此 sql 更改 group_concat_max_len

```
SET @@group_concat_max_len = 2048; 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2015-08-07T06:28:47.073

我同意@Mahomedalid 的回答，但我不想做类似准备好的声明，也不想输入所有字段，所以我有一个愚蠢的解决方案。

转到 phpmyadmin->sql->select 中的表，它会转储查询：复制、替换并完成！:)

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-08-12T20:43:21.210

虽然我同意 Thomas 的回答 (+1 ;))，但我想补充一点，我假设您*不*想要的列几乎不包含任何数据。如果它包含大量文本、xml 或二进制 blob，请花时间单独选择每一列。否则你的表现会受到影响。干杯!

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2010-01-07T10:02:01.733

做就是了

```
SELECT * FROM table WHERE whatever 
```

然后用你最喜欢的编程语言删除列：php

```
while (($data = mysql_fetch_array($result, MYSQL_ASSOC)) !== FALSE) {
   unset($data["id"]);
   foreach ($data as $k => $v) { 
      echo"$v,";
   }      
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2011-11-07T10:52:17.857

Mahomedalid 发布的答案有一个小问题：

内部替换功能代码是用“ `<columns_to_delete>,`”替换“”，如果要替换的字段是concat字符串中的最后一个，由于最后一个没有char逗号“，”并且没有从字符串。

我的建议：

```
SET @sql = CONCAT('SELECT ', (SELECT REPLACE(GROUP_CONCAT(COLUMN_NAME),
                  '<columns_to_delete>', '\'FIELD_REMOVED\'')
           FROM INFORMATION_SCHEMA.COLUMNS
           WHERE TABLE_NAME = '<table>'
             AND TABLE_SCHEMA = '<database>'), ' FROM <table>'); 
```

替换`<table>`,`<database>`和 `

在我的情况下，删除的列被字符串“FIELD_REMOVED”替换，因为我试图保护内存。（我要删除的字段是一个大约 1MB 的 BLOB）

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2013-03-22T13:27:46.723

我也想要这个，所以我创建了一个函数。

```
public function getColsExcept($table,$remove){
    $res =mysql_query("SHOW COLUMNS FROM $table");

    while($arr = mysql_fetch_assoc($res)){
        $cols[] = $arr['Field'];
    }
    if(is_array($remove)){
        $newCols = array_diff($cols,$remove);
        return "`".implode("`,`",$newCols)."`";
    }else{
        $length = count($cols);
        for($i=0;$i<$length;$i++){
            if($cols[$i] == $remove)
                unset($cols[$i]);
        }
        return "`".implode("`,`",$cols)."`";
    }
} 
```

因此，它的工作原理是您输入表格，然后输入您不想要的列或在数组中： array("id","name","whatevercolumn")

所以在选择中你可以像这样使用它：

```
mysql_query("SELECT ".$db->getColsExcept('table',array('id','bigtextcolumn'))." FROM table"); 
```

或者

```
mysql_query("SELECT ".$db->getColsExcept('table','bigtextcolumn')." FROM table"); 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2013-07-19T13:27:26.530

也许我对**Jan Koritak**指出的差异有一个解决方案

```
SELECT CONCAT('SELECT ',
( SELECT GROUP_CONCAT(t.col)
FROM
(
    SELECT CASE
    WHEN COLUMN_NAME = 'eid' THEN NULL
    ELSE COLUMN_NAME
    END AS col 
    FROM INFORMATION_SCHEMA.COLUMNS 
    WHERE TABLE_NAME = 'employee' AND TABLE_SCHEMA = 'test'
) t
WHERE t.col IS NOT NULL) ,
' FROM employee' ); 
```

**桌子 ：**

```
SELECT table_name,column_name 
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_NAME = 'employee' AND TABLE_SCHEMA = 'test' 
```

=================================

```
table_name  column_name
employee    eid
employee    name_eid
employee    sal 
```

=================================

**查询结果：**

```
'SELECT name_eid,sal FROM employee' 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-08-12T19:18:13.237

如果它总是相同的一列，那么您可以创建一个没有它的视图。

否则，不，我不这么认为。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-09-03T20:41:57.683

如果您愿意，可以使用 SQL 生成 SQL 并评估它生成的 SQL。这是一个通用解决方案，因为它从信息模式中提取列名。这是来自 Unix 命令行的示例。

替代

*   MYSQL 与你的 mysql 命令
*   带有表名的 TABLE
*   具有排除字段名称的 EXCLUDEDFIELD

```
echo $(echo 'select concat("select ", group_concat(column_name) , " from TABLE") from information_schema.columns where table_name="TABLE" and column_name != "EXCLUDEDFIELD" group by "t"' | MYSQL | tail -n 1) | MYSQL 
```

您实际上只需要以这种方式提取列名一次即可构建排除该列的列列表，然后只需使用您构建的查询。

所以像：

```
column_list=$(echo 'select group_concat(column_name) from information_schema.columns where table_name="TABLE" and column_name != "EXCLUDEDFIELD" group by "t"' | MYSQL | tail -n 1) 
```

现在您可以在您构造的查询中重用该`$column_list`字符串。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2013-12-05T09:51:09.970

我想添加另一个观点来解决这个问题，特别是如果你有少量的列要删除。

您可以使用[MySQL Workbench](http://www.mysql.fr/products/workbench/)之类的数据库工具来为您生成 select 语句，因此您只需手动删除生成语句的这些列并将其复制到您的 SQL 脚本中。

在 MySQL Workbench 中，生成它的方法是：

右键单击表 -> 发送到 Sql 编辑器 -> 选择所有语句。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2019-06-03T16:50:57.913

公认的答案有几个缺点。

*   它在表或列名需要反引号的地方失败
*   如果要省略的列在列表中，则失败
*   它需要列出两次表名（一次用于选择，另一次用于查询文本），这是多余且不必要的
*   它可能会以*错误的顺序返回列名*

所有这些问题都可以通过简单地在`SEPARATOR`for your中包含反引号`GROUP_CONCAT`并使用`WHERE`条件而不是`REPLACE()`. 出于我的目的（我想还有很多其他人的目的），我希望以与它们在表本身中出现的顺序相同的顺序返回列名。为此，我们`ORDER BY`在函数内部使用了一个显式子句`GROUP_CONCAT()`：

```
SELECT CONCAT(
    'SELECT `',
    GROUP_CONCAT(COLUMN_NAME ORDER BY `ORDINAL_POSITION` SEPARATOR '`,`'),
    '` FROM `',
    `TABLE_SCHEMA`,
    '`.`',
    TABLE_NAME,
    '`;'
)
FROM INFORMATION_SCHEMA.COLUMNS
WHERE `TABLE_SCHEMA` = 'my_database'
    AND `TABLE_NAME` = 'my_table'
    AND `COLUMN_NAME` != 'column_to_omit'; 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2020-11-28T17:04:21.437

我使用这项工作，虽然它可能是“离题” - 使用 mysql 工作台和查询生成器 -

1.  打开列视图
2.  Shift 在查询中选择您想要的所有列（在您的情况下，除了我所做的之外的所有列）
3.  右键单击并选择发送到 SQL 编辑器-> 短名称。
4.  现在您有了列表，然后您可以将查询复制粘贴到任何地方。

[![在此处输入图像描述](https://i.stack.imgur.com/NNnAY.png)](https://i.stack.imgur.com/NNnAY.png)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2019-07-30T09:45:58.023

我有一个建议，但不是解决方案。如果您的某些列具有更大的数据集，那么您应该尝试以下操作

```
SELECT *, LEFT(col1, 0) AS col1, LEFT(col2, 0) as col2 FROM table 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2020-10-28T12:39:50.087

如果您使用 MySQL Workbench，您可以右键单击您的表并单击`Send to sql editor`，然后`Select All Statement`这将创建一个列出所有字段的语句，如下所示：

```
SELECT `purchase_history`.`id`,
    `purchase_history`.`user_id`,
    `purchase_history`.`deleted_at`
FROM `fs_normal_run_2`.`purchase_history`;
SELECT * FROM fs_normal_run_2.purchase_history; 
```

现在你可以删除那些你不想要的。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2022-01-07T13:44:38.180

问题是关于 MySQL 的，但我仍然认为值得一提的是，至少[Google BigQuery 和 H2 原生支持一种`* EXCEPT`语法](https://blog.jooq.org/the-useful-bigquery-except-syntax/)，例如

```
SELECT * FROM actor 
```

生产：

```
|actor_id|first_name|last_name   |last_update            |
|--------|----------|------------|-----------------------|
|1       |PENELOPE  |GUINESS     |2006-02-15 04:34:33.000|
|2       |NICK      |WAHLBERG    |2006-02-15 04:34:33.000|
|3       |ED        |CHASE       |2006-02-15 04:34:33.000| 
```

然而

```
SELECT * EXCEPT (last_update) FROM actor 
```

生产：

```
|actor_id|first_name|last_name   |
|--------|----------|------------|
|1       |PENELOPE  |GUINESS     |
|2       |NICK      |WAHLBERG    |
|3       |ED        |CHASE       | 
```

也许，未来版本的 MySQL 也会支持这种语法？

* * *

## 回答 #32

> 赞同：-2
> 
> 时间：2013-02-21T21:25:03.477

我很晚才找到答案，这是我一直这样做的方式，坦率地说，它比最佳答案好 100 倍，更整洁，我只希望有人能看到它。并发现它很有用

```
 //create an array, we will call it here. 
    $here = array();
    //create an SQL query in order to get all of the column names
    $SQL = "SHOW COLUMNS FROM Table";
        //put all of the column names in the array
        foreach($conn->query($SQL) as $row) {
            $here[] = $row[0];
        }
    //now search through the array containing the column names for the name of the column, in this case i used the common ID field as an example
    $key = array_search('ID', $here);
    //now delete the entry
    unset($here[$key]); 
```

* * *

## 回答 #33

> 赞同：-8
> 
> 时间：2014-01-16T18:25:30.067

Select * 是一种 SQL 反模式。它不应该在生产代码中使用，原因有很多，包括：

处理时间稍长。当事情运行数百万次时，这些微小的部分可能很重要。由这种类型的草率编码导致的缓慢数据库是最难调整性能的类型。

这意味着您发送的数据可能比您需要的多，这会导致服务器和网络瓶颈。如果你有一个内部连接，发送比你需要的更多数据的机会是 100%。

它会导致维护问题，尤其是当您添加了不想随处可见的新列时。此外，如果您有一个新列，您可能需要对界面进行一些操作以确定如何处理该列。

它可以破坏视图（我知道这在 SQl 服务器中是正确的，在 mysql 中可能是也可能不是）。

如果有人愚蠢到以不同的顺序重建列的表（你不应该这样做，但它总是会发生），那么各种代码都会中断。特别是插入代码，例如突然将城市放入 address_3 字段，因为没有指定，数据库只能按列的顺序排列。当数据类型发生变化时这已经够糟糕了，但当交换的列具有相同的数据类型时更糟糕，因为您有时可以插入糟糕的数据，而这些数据很容易清理。您需要关心数据完整性。

如果在插入中使用它，如果在一个表中添加新列而不在另一个表中添加新列，它将中断插入。

它可能会破坏触发器。触发问题可能难以诊断。

将所有这些与添加列名所需的时间相加（哎呀，您甚至可能有一个界面允许您拖动列名（我知道我在 SQL Server 中这样做，我敢打赌有一些方法可以这样做是你用来编写 mysql 查询的一些工具。）让我们看看，“我会导致维护问题，我会导致性能问题，我会导致数据完整性问题，但是我节省了五分钟的开发时间。”真的只是把在您想要的特定列中。

我还建议您阅读这本书： [http ://www.amazon.com/SQL-Antipatterns-Programming-Pragmatic-Programmers-ebook/dp/B00A376BB2/ref=sr_1_1?s=digital-text&ie=UTF8&qid=1389896688&sr=1- 1&keywords=sql+反模式](https://rads.stackoverflow.com/amzn/click/com/B00A376BB2)

# c# - 企业库 CacheFactory.GetCacheManager 抛出空引用

> ID：9136
> 
> 赞同：6
> 
> 时间：2008-08-12T19:01:17.140
> 
> 标签：c#, configuration, enterprise-library

我正在尝试将使用 1.1 版本的企业库缓存块的应用程序转换为 2.0 版本。我认为我真正遇到的问题是不同 EntLib 部分的配置被拆分为多个文件。显然，这曾经由**ConfigurationManagerSectionHandler**处理，但现在已经过时，取而代之的是 .NET 2.0 中的内置配置机制。

我很难找到一个很好的例子来说明如何进行这种配置文件拆分，尤其是在 EntLib 的上下文中。有没有其他人处理过这个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-13T12:29:57.647

看起来是配置。我在这里找到了一个正常的单文件方法的一个很好的例子：http: [//www.devx.com/dotnet/Article/31158/0/page/2](http://www.devx.com/dotnet/Article/31158/0/page/2)

一旦你弄清楚它的语法，使用外部配置文件实际上是微不足道的。前任。：

在 Web.config 中：

```
<cachingConfiguration configSource="cachingconfiguration.config" />

```

在缓存配置.config 中：

```
<?xml 版本="1.0" 编码="utf-8"?>
<cachingConfiguration defaultCacheManager="默认缓存管理器">
    <backingStores>
        <add name="inMemory" type="Microsoft.Practices.EnterpriseLibrary.Caching.BackingStoreImplementations.NullBackingStore, Microsoft.Practices.EnterpriseLibrary.Caching" />
    </backingStores>
    <缓存管理器>
        <add name="Default Cache Manager" expirationPollFrequencyInSeconds = "60" maximumElementsInCacheBeforeScavenging="50" numberToRemoveWhenScavenging="10" backingStoreName="inMemory" />
    </cacheManagers>
</缓存配置>

```

希望这可以帮助某人！

# bug-tracking - FogBugz 与 OnTime 相比

> ID：9143
> 
> 赞同：10
> 
> 时间：2008-08-12T19:10:25.203
> 
> 标签：bug-tracking, fogbugz, ontime

有没有人同时使用 FogBugz 和 Axosoft 的 OnTime 并愿意提供意见？AxoSoft 有一个很大的[功能比较图表](http://web.archive.org/web/20090522134148/http://www.axosoft.com:80/products/ontime_competition.aspx)，但我也对更主观的想法感兴趣，比如易用性和稳定性。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-12-22T19:48:26.863

我从项目负责人的角度和团队成员的角度来管理并行项目和团队。

OnTime 有一个很大的特征矩阵，但这并不能转化为组织中的更多价值。为了便于使用，OnTime 失败了。OnTime 没有精心设计的界面，所以对我来说，它在人群中并不突出。另一方面，FogBugz 使用起来很愉快，我发现自己每天早上都“更快乐”地登录。

对我来说，最重要的“功能”是：**该工具如何很好地呈现和跟踪问题以及简化团队成员的参与。**如果它做得不好，大多数其他功能都会消失。如果它做得很好，那么可以原谅一些缺失的功能。

在这一点上，我发现 OnTime 特别不足，而 FogBugz 特别优越。

OnTime 加载了不同的选项卡，其中信息丢失或难以跟踪。团队和个人经常出于不同目的使用不同的选项卡。我必须四处点击，否则我可能会错过一些东西。

FogBugz 以最小的混乱跟踪问题，就像讨论线程一样。对问题进行更新时，将通过电子邮件通知所有各方，并且不会丢失任何信息。一目了然，我总是知道 FogBugz 是怎么回事。

OnTime 2009 也不允许我们同时分配和跟踪多个团队成员的问题。您只需分配给一个人。没办法抄袭别人。团队合作的大缺陷。

此外，在进行项目审查时，我们经常会在客户发言时快速解决很多问题。使用 FogBugz，我可以使用快速模式尽可能快地输入问题，然后再返回充实它。我们不能用 OnTime 来做到这一点，它有各种必填字段。除此之外，OnTime 只是缓慢，仅需要 5-6 秒才能弹出缺陷窗口。我需要能够在会议期间尽可能快地在 Excel 中输入问题。在任何工具中创建问题的总时间和点击次数是一个关键基准。

简而言之，对于使用 OnTime 的客户，我看到人们不断回退到电子邮件进行讨论，而且我还看到了交流的退化（有人输入了其他人从未看到的注释）。我没有看到 FogBugz 的这种趋势。

特征矩阵在纸面上看起来不错，但要让团队正确使用工具而不增加工具的难度就足够困难了。FogBugz 让它变得像您想要的一样简单，同时允许您根据需要向下钻取。

然而，OnTime 感觉就像一个非常详细的跟踪数据库，上面有快速的 WinForms 应用程序。

对我来说 FogBugz 的缺点是升级的价格。每年的维护费用是原始成本的 50%。我无法证明升级是合理的，部分原因是我们对 FogBugz 6 很满意，但部分原因是我看不到我的年度维护费能得到什么。FogCreek 对我们的许可折扣不是很灵活，毕竟他们需要谋生，所以我们决定永远坚持使用 v6。

2014 年更新：在我写完这篇文章大约一年后，FogCreek 向我发送了免费升级到 v7 以修复安全漏洞。就在今年，他们又做了同样的事情。他们是我接触过的唯一一家给我免费升级只是为了修复错误的公司，即使没有维护。一流的公司，优秀的人才。

我仍然会毫不犹豫地再次将钱花在 FogBugz 上。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-12T19:27:19.367

实际上，我鼓励我工作的公司开始使用软件（特别是 FogBugz）跟踪错误，并且对 FogBugz 非常满意。

我们一味地让客户通过电子邮件向 FogBugz 发送 bug 请求，这有它的优点和缺点。但我们确实没有遇到任何问题，将 FogBugz 集成到一个完全不熟悉任何错误跟踪软件的团队中。总的来说，我对 FogBugz 的易用性和稳定性评价为 9。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-14T16:04:17.460

我已经在生产软件开发环境中广泛使用了这两种方法。

OnTime 还不错 - 一旦您将其设置为处理发送到电子邮件的支持票证，它就可以很好地集成软件开发人员的所有日常活动。

我个人更喜欢 FogBugz，因为它包含预测性估计内容。能够选择截止日期，然后根据您过去的表现获得达到该日期的可能性非常棒。我还认为，总的来说，FogBugz 使用和组织您的功能/缺陷的速度更快，而且我喜欢它更好地跟踪时间的方式。

OnTime 胜出的一个领域是，针对 OnTime 进行报告要容易得多。它将所有内容存储在 SQL 服务器中，因此很容易访问（如果您获得了非托管 FogBugz，也许您也可以这样做）。此外，它还包括一个报表设计器，因此您可以访问您的数据。FogBugz 的弱点是，虽然您可以跟踪并输入您在每个项目上花费的时间，以便进行基于经验的调度，但它并没有让您作为经理轻松查看给定员工花费了多少时间那一周有什么事情。希望他们会在不久的将来添加它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-12T19:17:34.253

OnTime 更像是一个 ALM 工具——它试图做所有事情。

FogBugz 仅处理错误（和功能请求），并且非常出色。我不确定一些较新的扩展（如讨论），但对于错误来说，它真的很好。

我会在更好的报告、搜索等方面添加很多东西，但我绝对可以推荐 FogBugz。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T16:31:40.440

我已经使用 OnTime 几年了。它实际上是一个非常易于使用的工具，而不仅仅是建议的错误跟踪工具。对我来说，随着功能/缺陷/任务数量的增长，我所经历的放缓是我所经历的。此外，Web 客户端过于努力地尝试与 winform 版本并行，因此可能会变得不稳定。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-12T19:36:30.503

我还没有测试过 OnTime 的东西，但请记住，FogBugz 和 OnTime 都有免费版本，Axosoft 1 用户和 FogBugz 2 用户，虽然它是托管版本。（[在此处查看我的答案](https://stackoverflow.com/questions/3180/anyone-soloing-using-fogbugz#3581)，了解如何注册免费 FogBugz 版本）

因此，您可以在这两个系统上获得一些真正的第一手经验。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-04-12T05:45:04.550

*   您是错误跟踪还是项目计划？

FogBugz 具有更好的错误跟踪功能。FogBugz 具有更好的电子邮件集成、状态跟踪和触发器。FogBugz 更容易深入到单个任务，而无需应用大量过滤器。

然而，对于项目规划来说，OnTime 是最好的工具。FogBugz 中的 monte carlo 估计功能很酷——不要误会我的意思——但老实说，让项目进入 FogBugz 以便您可以实际使用估计器是一件非常痛苦的事情，它可能会令人沮丧。OnTime 中的 Scrum 计划板真的很性感。如果您习惯于使用白板或便笺，输入和可视化是轻而易举的事。

OnTime 提供更好的项目概览信息和自定义报告；这对管理者来说更好。

FogBugz 提供更好的下钻信息；这对实施者来说更好。

FogBugz 有更多的功能；这对于以技术为中心的用户来说更好。

OnTime 更加图形化；这对非工程师（项目规划师、艺术家和其他经常不得不使用调度工具的人）来说更好。

其他因素：有些人提到了速度问题。我没有注意到两者的速度问题，但我唯一的经验是本地安装。OnTime 对于中型团队来说很昂贵；它对单个用户是免费的，当你达到 10 个以上的用户时，价格是平均的，但对于 3-6 人的团队来说，它很昂贵，特别是如果你想要数据透视图。

老实说，如果你能负担得起，考虑两者都不会是愚蠢的。使用 OnTime 编写报价，使用 FogBugz 跟踪缺陷。它们是完全不同的工具，没有一个在所有领域都擅长，但都非常擅长选择任务。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-10-28T15:35:39.153

我没有与 FogBugz 合作过，尽管我最近建议我们公司使用它。OnTime 是公司决定使用的，我个人不喜欢 OnTime，因为它运行缓慢且 GUI 组织不善。我们选择自己托管，但我不认为这台机器很慢。正如布赖恩斯科特在回答中所说，网络应用程序看起来并不像网络应用程序，更像是复制了一个 Windows 应用程序。并且不要尝试通过 Internet（通过 VPN）使用 Windows 应用程序。它非常缓慢。我想这可能是由于我们的互联网连接延迟。

当然，我的经历可能与其他人不同，我可能遇到了网络问题。其他人将不得不证实我关于缓慢的说法。:)

# vb.net - 从文件资源管理器中打开我的应用程序中的文件

> ID：9161
> 
> 赞同：5
> 
> 时间：2008-08-12T19:27:35.153
> 
> 标签：vb.net, file-extension

我在 VB.NET 中创建了自己的应用程序，将其文档保存到具有自己的自定义扩展名 (.eds) 的文件中。

假设我已经正确地将文件扩展名与我的应用程序相关联，当我在文件资源管理器中双击文件时，如何实际处理应用程序中选定文件的处理？

我是在 Application.Load() 方法中获取 argsc/argsv 变量还是其他什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-12T19:37:01.907

试试[这篇文章](http://www.codeproject.com/KB/vb/VBFileAssociation.aspx)，但简短的回答是`My.Application.CommandLineArgs`

# c# - C# .NET 中挥之不去的程序集依赖项

> ID：9173
> 
> 赞同：8
> 
> 时间：2008-08-12T19:35:44.590
> 
> 标签：c#, .net, dependencies

我的 C# 项目——我们称之为 SuperUI——用于使用来自外部程序集的类。现在它没有，但编译器不会让我在没有适当的程序集引用的情况下构建项目。让我详细说明。

该项目用于抛出和捕获一个自定义异常类 - ，`SuperException`它派生自标准 System.Exception 并存在于一个单独的预编译程序集中，`SuperAssembly.DLL`我引用了它。

最终，我认为这是一个毫无意义的练习，并`SuperExceptions`在每种情况下都用 System.SuitableStandardException 替换了所有内容。我删除了对 的引用`SuperException.DLL`，但现在在尝试编译项目时遇到了以下问题：

> “SuperException”类型是在未引用的程序集中定义的。您必须添加对程序集 'SuperException, Version=1.1.0.0 (...)' 的引用

错误引用的源文件似乎不相关；它是在 IDE 中突出显示的项目名称空间。

现在，事情是这样的：

1.  `SuperException`项目代码中已经消除了 的所有使用。
2.  与另一个在没有引用的情况下编译良好的项目相比`SuperException.DLL`，我只引用了一个程序集 - 并且`that`没有引用我的项目不引用自身的任何内容。虽然这些依赖项中的任何一个都可能抛出`SuperExceptions`，但我只捕获了基本的 Exception 类，无论如何......另一个项目构建得很好！
3.  我已经完成了 Visual Studio 的“清洁解决方案”并多次手动清除所有内容。

包括这个参考并不是世界末日，我只是不明白为什么它是必要的。Nrrgg。欢迎任何指点！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T02:23:00.040

它可能是一个传递引用，其中某些类型方法调用返回一个装箱的 SuperException 实例（“向下转换”），例如异常，但是通过检查传递包含的代码中的代码，即来自外部方法调用的代码，编译器知道你需要能够在某个时候获得有关该类型的信息。

Resharper 会告诉您在什么情况下需要添加引用，您可以使用 Lütz Roeder 的又名 RedGate 的 Reflector 以两种方式扫描编译后的 IL 以获取对该类型的引用：1）使用搜索工具，2）打开您使用的每种公共类型以及需要“ghost”程序集的公共类型，它都会要求您指定其位置。

当我引用 Castle.Windsor 而不是 Castle.MicroKernel 时，这最常发生在我身上。:p

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-12T19:56:41.227

1.  退出 Visual Studio
2.  删除解决方案目录中的 bin 和 obj 文件夹
3.  重新启动，看看会发生什么

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-12T21:41:46.053

我同意这里的其他评论。有一个参考，在*某处*纯文本！过去我遇到过类似的问题，在项目文件中搜索什么也没有返回，结果发现它在搜索中没有自动找到的其他文件中。

我不认为创建一个新项目是这里的解决方案。你需要肯定你的依赖树中的引用都没有使用 SuperException **。***没有*

我从来没有经历过这种情况，以至于我需要从字面上擦除项目，我总是在某处找到参考。确保您正在搜索**每个**文件。

### 编辑：

需要补充一点，如果错误指向的位置看起来是随机的，这通常意味着编译的源代码和源代码文件之间存在不匹配。这是一个 ASP.NET 应用程序吗？我以前在 ASP.NET 临时文件夹中的重建中没有替换编译的 DLL 导致事情得到解决。调试时很有趣 :)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-21T14:11:02.750

我认为这不是代码问题。我可以看到正在发生的是，您现有的引用之一可能依赖于您可能在应用程序中创建的自己类型中的该类型。

如果是这种情况，即使您没有显式使用该类型并且即使其他引用的程序集有自己的引用，您也确实需要该引用。您有时会遇到需要引用您未引用的类型的第 3 方组件的问题。编译器显然在您现有的一个引用程序集中看到了一些东西，并希望您引用从属程序集。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-12T19:48:52.287

由于它是编译器错误，因此项目中的某处必须有 SuperException 的引用或使用。

1.  在整个项目或解决方案中查找/替换该类型并删除所有引用（您可能已经这样做了）。
2.  如果您引用任何继承自 SuperException 的类型（即使是在另一个程序集中定义的类型），您需要对定义 SuperException 的程序集的引用。

选择编译器显示错误的行并开始跟踪该行上使用的对象的继承树，您可能会以这种方式找到它的来源。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-12T20:38:39.597

感谢您到目前为止的回答。我已经尝试了所有建议（除了一个）无济于事。

我没有尝试过的建议是创建一个新项目并将我所有的东西都添加到其中，这个想法真的很考验我的生活意愿。;) 如果我能打扰的话，我明天可以试试这个。再次感谢。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-12T20:46:22.763

如今，VS 项目确实没有什么非常神秘的东西——都是文本文件等。某些东西必须引用该类/dll，并且某些东西必须是您项目的一部分。

您是否真的 grep'd 或 findstr'd 整个解决方案树，*每个文件*，以引用该异常？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-12T19:46:51.403

这听起来很奇怪。这是我接下来要检查的内容：

1.  检查您的 Properties/AssemblyInfo.cs 文件中是否没有任何东西挥之不去。
2.  检查您的 SuperUI.csproj 文件中是否有任何残留。
3.  删除所有引用并重新添加它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-12T19:51:10.737

尝试创建一个新项目，并将所有类添加到其中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-12T20:06:20.740

grep 你的项目文件夹。它可能是您项目中的隐藏引用，也可能是您的项目引用的项目。如果需要，用记事本清理。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-12T21:49:16.070

> 如果您引用任何继承自 SuperException 的类型（即使是在另一个程序集中定义的类型），您需要对定义 SuperException 的程序集的引用。

对此表示赞同。

您可能没有引用`SuperException`，但您可能正在引用`SpecializedSuperException`，它源自或以其他方式使用`SuperException`- 您的项目的 grep`SuperException`不会捕获它。

尝试通过试用[NDepend进行破解](http://www.ndepend.com/NDependDownload.aspx)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-13T01:05:29.980

这就是像[Resharper](http://www.jetbrains.com/resharper/)这样的工具真正发挥作用的地方——一个简单的 Find Usages 通常会多次告诉我这种“幽灵依赖”。

也许您可以转到 SuperException 类的定义并尝试 Find All References()。您可能还想调查程序集 SuperException 是否对您的主程序集具有*循环依赖关系*（例如，主程序集取决于异常程序集取决于主程序集......）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-04-22T21:10:18.867

当我的 C# 库具有依赖的 C++/CLI 程序集时，我遇到了一个非常相似的程序集引用问题。问题是我从我的 C# 程序集库中的 C++/CLI 程序集继承了一个公共类。这意味着继承链跨越多个程序集。

我希望任何客户端都足够聪明，可以在 C# 库需要它的任何时候间接加载 C++/CLI 程序集，但即使在编译时也并非如此。

我通过打破跨越这两个程序集库的类之间的继承并改用聚合来解决这个问题。我的客户终于高兴了，不再需要 C++/CLI 程序集作为依赖项。

用您的话来说，您可能必须确保`SuitableStandardException`不继承自`SuperException`以消除`SuperException.DLL`作为参考。

使用封装而不是继承，并`SuperException`在新的 `SuitableStandardException`.

如果这不能解决它，您可能有更多类跨越某些程序集的继承，在您的情况下`SuperAssembly.DLL`和`superException.dll`.

如果找不到所有这些，请尝试以下技巧：

1.  使您的所有公共成员和类都在`SuperAssembly.DLL`内部。

2.  在 SuperAssembly.DLL 中与`SuperException.DLL`：

    ```
    [assembly:InternalsVisibleTo("SuperException, PublicKey=0024000004800000....)] 
    ```

3.  确保他们`SuperAssembly.DLL`从已经引用的任何客户端构建和删除引用`SuperException.DLL`。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-08-13T00:29:42.343

`grep -R SuperException *`在你的项目的基础上（`grep`首先从某个地方获取）只是为了确定。

# windows - 如何从磁盘获得良好的并发读取性能

> ID：9191
> 
> 赞同：27
> 
> 时间：2008-08-12T19:50:13.440
> 
> 标签：windows, multithreading, file-io

我想问一个问题，然后用我自己的答案跟进，但也看看其他人有什么答案。

我们有两个大文件，我们想同时从两个单独的线程中读取它们。一个线程将顺序读取fileA，而另一个线程将顺序读取fileB。线程之间没有锁定或通信，它们都在尽可能快地顺序读取，并且都立即丢弃它们读取的数据。

我们在 Windows 上使用此设置的经验非常差。两个线程的总吞吐量约为 2-3 MiB/sec。驱动器似乎花费了大部分时间在两个文件之间来回搜索，可能在每次搜索后读取的很少。

如果我们禁用其中一个线程并暂时查看单个线程的性能，那么我们将获得更好的带宽（这台机器约为 45 MiB/秒）。很明显，糟糕的双线程性能是 OS 磁盘调度程序的产物。

**我们可以做些什么来提高并发线程读取性能？** 也许通过使用不同的 API 或以某种方式调整 OS 磁盘调度程序参数。

一些细节：

在具有 2GiB 内存的机器上，这些文件的大小约为 2GiB。出于这个问题的目的，我们认为它们没有被缓存和完美碎片整理。我们使用了碎片整理工具并重新启动以确保是这种情况。

我们没有使用特殊的 API 来读取这些文件。该行为可在各种标准 API 中重复，例如 Win32 的 CreateFile、C 的 fopen、C++ 的 std::ifstream、Java 的 FileInputStream 等。

每个线程都在循环中旋转，调用 read 函数。我们将每次迭代从 API 请求的字节数从 1KiB 到 128MiB 不等。改变这个没有任何效果，所以很明显，操作系统在每次磁盘寻道后物理读取的数量不是由这个数字决定的。这正是应该预期的。

在 Windows 2000、Windows XP（32 位和 64 位）、Windows Server 2003 以及使用和不使用硬件 RAID5 的情况下，单线程和双线程性能之间的巨大差异是可以重复的。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-13T13:47:39.333

问题似乎出在 Windows I/O 调度策略中。根据我在[这里](http://engr.smu.edu/~kocan/7343/fall05/slides/chapter11.ppt "I/O 管理和磁盘调度")发现的内容，操作系统可以通过多种方式安排磁盘请求。虽然 Linux 和其他人可以在不同的策略之间进行选择，但在 Vista 之前，Windows 被锁定在一个策略中：一个 FIFO 队列，其中所有请求都分成 64 KB 块。我相信这个策略是你遇到的问题的原因：调度程序会混合来自两个线程的请求，导致磁盘不同区域之间的连续寻道。
现在，好消息是，根据[here](http://technet.microsoft.com/en-us/magazine/cc162494.aspx "Windows Vista 内核内部")和[here](http://widefox.pbwiki.com/IO "内核比较：Linux (2.6.22) 与 Windows (Vista)")，Vista 引入了一个更智能的磁盘调度程序，您可以在其中设置请求的优先级并为您的进程分配最小的 badwidth。
坏消息是我发现无法更改以前版本的 Windows 中的磁盘策略或缓冲区大小。此外，即使提高进程的磁盘 I/O 优先级会提高与其他进程相比的性能，您仍然会遇到线程相互竞争的问题。
我可以建议的是通过引入自制的磁盘访问策略来修改您的软件。
例如，您可以在线程 B 中使用这样的策略（与线程 A 类似）：

```
if THREAD A is reading from disk then wait for THREAD A to stop reading or wait for X ms
Read for X ms (or Y MB)
Stop reading and check status of thread A again 
```

您可以使用信号量进行状态检查，也可以使用性能计数器来获取实际磁盘队列的状态。X 和/或 Y 的值也可以通过检查实际传输速率并慢慢修改它们来自动调整，从而在应用程序在不同机器和/或操作系统上运行时最大化吞吐量您可以找到缓存、内存或 RAID 级别以某种方式影响它们，但是通过自动调整，您将始终在每种情况下获得最佳性能。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-12T19:51:06.323

我想在我的回复中添加一些进一步的说明。我们测试过的所有其他非 Microsoft 操作系统都不会遇到此问题。Linux、FreeBSD 和 Mac OS X（这是不同硬件上的最后一个）在从一个线程移动到两个线程时，在总带宽方面都降级了很多。例如，Linux 从 ~45 MiB/sec 降级到 ~42 MiB/sec。这些其他操作系统必须在每次寻道之间读取更大的文件块，因此不会花费几乎所有时间在磁盘上等待寻道。

我们针对 Windows 的解决方案是将`FILE_FLAG_NO_BUFFERING`标志传递给`CreateFile`并在每次调用`ReadFile`. 由于以下几个原因，这是次优的：

*   像这样读取文件时不会缓存文件，因此缓存通常没有任何优势。
*   使用此标志时的约束比正常读​​取要复杂得多（读取缓冲区与页面边界的对齐等）。

（作为最后的评论。这是否解释了为什么在 Windows 下进行交换如此可怕？即，Windows 无法以任何效率同时对多个文件进行 IO，因此在交换所有其他 IO 操作时被迫过慢。）

* * *

*编辑为 Will Dean 添加更多详细信息：*

当然，在这些不同的硬件配置中，原始数据确实发生了变化（有时会发生很大变化）。然而，问题是在从一个线程移动到两个线程时，只有 Windows 会遭受性能的持续下降。以下是测试机器的摘要：

*   运行 Windows 2000、Windows XP（32 位）和 Windows XP（64 位）的多个不同年代的戴尔工作站（英特尔至强），带有单个驱动器。
*   运行 Windows Server 2003（64 位）和 RAID 1+0 的戴尔 1U 服务器（英特尔至强）。
*   具有 Windows XP（64 位）和 Windows Server 2003 以及硬件 RAID 5 的 HP 工作站 (AMD Opteron)。
*   我的家用无品牌 PC (AMD Athlon64)，运行 Windows XP（32 位）、FreeBSD（64 位）和 Linux（64 位），单驱动器。
*   我的家用 MacBook（Intel Core1）运行 Mac OS X，单个 SATA 驱动器。
*   我家运行 Linux 的[Koolu](http://koolu.com/Koolu-WE-Appliance/Works-Everywhere-Appliance.html) PC。与其他系统相比，动力明显不足，但我证明即使这台机器在进行多线程磁盘读取时也可以胜过具有 RAID5 的 Windows 服务器。

在测试期间，所有这些系统的 CPU 使用率都非常低，并且禁用了防病毒软件。

我之前忘了提，但我们也尝试了设置标志的普通 Win32 `CreateFile`API 。`FILE_FLAG_SEQUENTIAL_SCAN`这个标志没有解决问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T20:20:17.217

确实有点奇怪，您发现在相当广泛的 Windows 版本之间没有任何区别，并且在单个驱动器和硬件 raid-5 之间没有任何区别。

这只是“直觉”，但这确实让我怀疑这真的是一个简单的寻求问题。除了 OS X 和 Raid5，这一切都是在同一台机器上尝试过的——你试过另一台机器吗？在这次测试中你的 CPU 使用率基本为零吗？

您可以编写的最短的应用程序是什么来演示这个问题？- 我有兴趣在这里尝试一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T20:04:13.550

我会创建某种内存线程安全锁。每个线程都可以在锁上等待，直到它空闲。当锁空闲时，获取锁并在定义的时间长度或定义的数据量内读取文件，然后为任何其他等待线程释放锁。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T21:38:05.017

你在 Windows 下使用[IOCompletionPorts吗？](http://msdn.microsoft.com/en-us/library/aa363862(VS.85).aspx)Windows via C++ 有一个关于这个主题的深入章节，幸运的是，[它也可以在 MSDN 上找到](http://msdn.microsoft.com/en-us/library/cc500399.aspx)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-13T09:44:26.017

保罗 - 看到了更新。很有意思。

在 Vista 或 Win2008 上尝试它会很有趣，因为人们似乎报告了在某些情况下对这些 I/O 的一些相当大的改进。

我对不同 API 的唯一建议是尝试对文件进行内存映射——你试过了吗？不幸的是，在每个文件 2GB 的情况下，您将无法在 32 位机器上映射多个整个文件，这意味着这并不像它可能的那么简单。

# .net - IL 级代码调试器

> ID：9204
> 
> 赞同：30
> 
> 时间：2008-08-12T20:06:13.843
> 
> 标签：.net, debugging, il

是否有任何以 VS 插件或独立应用程序形式存在的 IL 级调试器？

Visual Studio 的调试器很棒，但它允许您在 HLL 代码级别或汇编语言上进行调试，您无法调试 IL。似乎在某些情况下，有机会在 IL 级别进行调试会很有用。

特别是在调试您没有源代码的问题时，它可能会有所帮助。

当您没有源代码时调试 IL 是否真的有用是有争议的，但无论如何。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-08-12T20:10:38.653

最好的方法是使用 ILDASM 反汇编托管二进制文件，这将生成 IL 指令。然后使用 ILASM 在调试模式下重新编译该 IL 源代码，当您启动 Visual Studio 调试器时，您将能够单步执行原始 IL。

1.  `ildasm foo.exe /OUT=foo.exe.il /SOURCE`
2.  `ilasm foo.exe.il /DEBUG`

我写了一篇关于这个主题的博客文章： [如何调试编译器生成的代码](http://blogs.msdn.com/chrsmith/archive/2008/03/13/how-to-debug-compiler-generated-code.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-04-24T17:37:01.827

这是我用来在 Visual Studio 中调试 IL 汇编器的 .BAT 文件。创建的 .IL.IL 文件包含原始源代码行和您生成的 IL 汇编器行，但不显示 jitted 机器代码。我将批处理文件命名为 ILDEB.BAT 并作为“ILDEB mypgm”调用。我使用 IL 汇编器指令“break”强制 Visual Studio 调试器在命中时设置断点。

```
for /f "tokens=1 delims=." %%1 in ("%1") do set NAME_ONLY=%%1
@erase/q %NAME_ONLY%.il.il
@if not exist %NAME_ONLY%.dll goto quit
ildasm /out:%NAME_ONLY%.il.il /source /nobar %NAME_ONLY%.dll
@if not exist %NAME_ONLY%.il.il goto quit
ilasm /dll /debug /out=%NAME_ONLY%.dll %NAME_ONLY%.il.il
@if not exist %NAME_ONLY%.dll goto quit
peverify %NAME_ONLY%.dll
:quit 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-19T21:26:17.937

Debug Companion VS 插件似乎正是我想要的，除了它在我的解决方案中看不到库项目。只有当我向解决方案添加控制台赢应用程序时，该项目列表中才会出现某些内容。

对我来说，反编译/编译方法的问题是我正在调试的代码不是我的代码。无论如何我都可以反编译它，但我认为没有办法签署重新编译的程序集，以便加载它而不是原始程序集。

对于特定的问题，我发现只需在汇编语言级别上对其进行调试并获取引发异常的方法的调用堆栈以及调用该方法的参数就足够了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T20:24:21.310

ISTR 有一个反射器的调试器插件。

虽然我使用 TestDriven.net 在 Reflector 的帮助下调试了第 3 方程序集，但我自己没有使用它：

[weblogs.asp.net/nunitaddin](http://weblogs.asp.net/nunitaddin/archive/2006/11/05/Debug-With-Reflector.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T20:38:34.947

这是[一篇](http://blogs.msdn.com/jmstall/archive/2004/10/03/237137.aspx)关于 IL 调试的文章。它说你不能这样做，然后谈论如何做到这一点。评论中也有一些关于这样做的信息。

# sql-server - ADO.NET 连接池和 SQLServer

> ID：9228
> 
> 赞同：3
> 
> 时间：2008-08-12T20:48:30.513
> 
> 标签：sql-server, performance, ado.net

*   它是什么？
*   如何使用 MS SQL 实现连接池？
*   什么时候出现性能影响

*   一个接一个地执行许多查询（即使用一个循环调用存储过程的 30K+ 迭代）？
*   执行一些需要很长时间（10 分钟以上）的查询？

*   有没有最佳实践？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-12T20:53:40.690

连接池是一种重用连接的机制，因为建立新连接很慢。

如果您使用 MSSQL 连接字符串和 System.Data.SqlClient，那么您已经在使用它 - 在 .Net 中，这些东西大部分时间都在幕后。

30k 次迭代的循环作为服务器端游标（查找 T-SQL 游标语句）可能会更好，这取决于您对存储过程之外的每个步骤执行的操作。

长查询很好 - 但要小心从网页调用它们，因为 Asp.Net 并没有真正针对长时间等待进行优化，并且一些连接会中断。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-12T21:07:35.233

关于连接池的更多信息......您已经在 SqlClient 中使用它，但前提是您的连接字符串对于您打开的每个新连接都相同。我的理解是，框架会在可能的情况下自动连接连接，但是如果连接字符串从一个连接到下一个连接甚至略有不同，那么新连接将不会来自池 - 它会被重新创建（所以它更昂贵）。

您可以将性能监视器应用程序与 XP/Vista 一起使用来监视 SQL 连接，并且您会很快看到是否正在使用池。在性能监视器中的“.NET CLR 数据”类别下查看。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T21:13:21.850

我支持基思；如果您调用存储过程 30,000 次，那么您遇到的问题要比连接池大得多。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-08-12T21:32:20.643

[此线程](https://stackoverflow.com/questions/8223/connection-pooling-in-netmssql)也部分回答了您的问题。搜索会发现这一点.. 连接池的定义，[谷歌](http://www.google.com/search?q=connection+pooling)会回答第一个命中是[这个](http://en.wikipedia.org/wiki/Connection_pool)..

这将只留下最佳实践，我认为这是一个很好的问题:)

+1 对[基思的回答](https://stackoverflow.com/questions/9228/adonet-connection-pooling-ms-sql#9233)。他一针见血。

只是来自常见问题的礼貌提醒：

> 您在提出问题之前已经搜索了互联网，并且您带着有关您的问题的研究和信息来到我们这里......对吗？

# backup - 异地备份

> ID：9231
> 
> 赞同：8
> 
> 时间：2008-08-12T20:49:54.003
> 
> 标签：backup, offsite

我最近的任务是提出一个异地备份策略。我们有大约 2TB 的数据需要备份，所以我们的需求有点不正常。

我调查了铁山，他们想要每月 12,000 美元！

有没有人对如何最好地处理在预算内备份这么多数据（如铁山的十分之一）有任何建议？其他公司如何负担得起呢？

谢谢！

更新 :: 更新

具有讽刺意味的是，我刚刚经历了我们都在谈论的那种毁灭性的失败。我的 BES 服务器出现故障，两天后，我的 Exchange 服务器的 RAID5 中的 2 个驱动器死了（2！！！？？！）。我目前正在重建我的网络，备份完整性绝对是一个问题。

至少现在我的老板们正在关注:)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-08-12T21:29:01.243

[您可以花2600 美元](http://www.newegg.com/Product/Product.aspx?Item=N82E16822101110)购买容量为 8TB 的外部 eSATA RAID 盒。我并不是说特定产品是正确的选择，但这种盒子可以在 RAID5 中完成 6TB 容量，并且仍然足够便携，可以购买几个并在银行中轮换，就像 Stu 说的那样。

显然，如果您必须保留 7 天的价值、14 天、30 和 90 天的快照等，那么事情将会更加昂贵，但如果您所追求的只是灾难恢复，这当然是可行的。

要确保的最重要的事情是您计划的一部分实际上是测试从备份中恢复。这似乎经常被忽视，并被证明是几乎所有策略中最薄弱的环节。

您应该在实际转储真实数据并从备份中恢复的地方尽可能多地计划计划恢复。没有它，你不知道它在你需要的时候也会起作用。

我已经忘记了我在一家公司的次数，那里有一个装满备份磁带/驱动器的大机架，所有这些都是按照计划尽职尽责地制作的，只是在服务器上发现它们都没有有效数据被消灭。

验证备份完整性的方法越多越好，但没有什么可以替代从一个备份中进行实际转储/加载以真正测试设置。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-12T21:14:16.170

[Amazon S3](http://www.amazon.com/gp/browse.html?node=16427261)可能更适合您的预算。我不知道是否有可用于自动化备份过程的软件，但编写自己的代码来处理它相当容易。这是他们的[定价计算器](http://calculator.s3.amazonaws.com/calc5.html?)。

根据我的估计，您将远远低于 1000 美元/月的范围。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-12T22:26:23.013

您确实必须评估数据的真正价值。如果您明天丢失了它会对您的业务产生什么影响？我们使用异地备份，这并不便宜，但如果我们丢失数据，业务将在 2-3 天内停止交易。

我们认为现场备份可能会节省成本，但根据我过去十年在数据中心/机房的经验（作为员工和客户），我见过火灾、灭火系统故障（湿）、硬件盗窃，有一天，一辆汽车从外墙撞到套房。除此之外，我们的最后一个 DC 位于希思罗机场，就在跑道旁边……你永远不知道会发生什么奇怪的事情（还记得 BA 777 在着陆时被困在跑道附近吗？）。

我的建议是，评估数据的价值，然后确定 12,000 美元是否太高而无法保证其安全。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-12T21:11:53.400

2TB 现在是小钱。

查看基于硬盘的热插拔备份机，并在当地银行租一个盒子： [http](http://www.high-rely.com/) ://www.high-rely.com/ （还有很多这样的产品，但我的谷歌时间有限）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-12T21:19:50.013

[Jungle Disk](http://www.jungledisk.com/index.aspx)就是这样一款软件，它可以自动执行到 Amazon S3 的备份过程。我在家里用它来备份，但我想它在服务器上也能正常工作。此外，可能还有其他使用 S3 进行异地存储的备份工具。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-21T22:02:59.933

为此，我们已经使用 DataDomain 设备大约 2 年了。它们并不便宜，但与每月 12,000 美元相比，它们很快就能收回成本。

基本上，我们通过 NFS 和 CIFS 将备份发送到一个 DataDomain 设备，它对数据进行重复数据删除，然后将差异复制到我们在远程站点的另一个设备。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-12T21:28:13.570

至于纯在线解决方案，请确保先进行一些粗略的计算。例如，如果您每月有 2TB 的流失量，那么您将只为备份流量而使 1Mb 的 Internet 连接饱和！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-12T22:11:07.040

如前所述，Amazon S3 绝对是一种选择，但从长远来看，拥有您要备份的硬件可能会更便宜。
例如：购买基本服务器和 eSATA RAID5 设置，容量是您当前所需容量的 2-3 倍，然后将其安装在托管中心。最好是具有高但便宜的带宽的一种。

这种方式服务器和存储是异地的，但是在硬件的初始成本之后，您只需为带宽付费。

诚然，这样做的不利之处在于，与 S3 之类的东西不同，如果硬件出现故障，您必须自己修复它，或者付钱给 CoLo 人。但这可能是您愿意做出的权衡。

此外，使用此解决方案，您仍然需要一个强大的上传管道来处理流量......所以总是有“sneakernet”解决方案。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-21T21:59:06.620

我使用[bqbackup.com](http://bqbackup.com) 1-2 年没问题。您可以每晚使用 rsync 进行同步。想补充一点，他们的价格非常便宜，我现在有接近 1TB 的容量。

# architecture - 不同逻辑层上的接口

> ID：9240
> 
> 赞同：12
> 
> 时间：2008-08-12T21:06:38.650
> 
> 标签：architecture

假设您有一个分为 3 层的应用程序：GUI、业务逻辑和数据访问。在您的业务逻辑层中，您已经描述了您的业务对象：getter、setter、accessors 等等……您明白了。业务逻辑层的接口保证了业务逻辑的安全使用，所以你调用的所有方法和访问器都会验证输入。

这在您第一次编写 UI 代码时非常棒，因为您有一个可以信赖的定义整齐的界面。

但是棘手的部分来了，当您开始编写数据访问层时，业务逻辑的接口无法满足您的需求。您需要更多的访问器和获取器来设置隐藏/曾经隐藏的字段。现在你不得不侵蚀你的业务逻辑的接口；现在可以从 UI 层设置字段，UI 层没有业务设置。

由于数据访问层所需的更改，业务逻辑的接口已经被侵蚀到甚至可以使用无效数据设置业务逻辑的程度。因此，该接口不再保证安全使用。

我希望我足够清楚地解释了这个问题。您如何防止接口侵蚀，维护信息隐藏和封装，同时仍然适应不同层之间的不同接口需求？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-13T06:08:24.597

如果我正确理解了这个问题，那么您已经创建了一个域模型，并且您想编写一个对象关系映射器来映射数据库中的记录和域对象。但是，您担心使用读取和写入对象字段所必需的“管道”代码污染您的域模型。

退后一步，您基本上有两种选择将数据映射代码放置在何处 - 在域类本身或外部映射类中。第一个选项通常称为 Active Record 模式，它的优点是每个对象都知道如何持久化自己，并对其内部结构有足够的访问权限，以允许它执行映射而无需暴露与业务无关的字段。

例如

```
public class User
{
    private string name;
    private AccountStatus status;

    private User()
    {
    }

    public string Name
    {
        get { return name; }
        set { name = value; }
    }

    public AccountStatus Status
    {
        get { return status; }
    }

    public void Activate()
    {
        status = AccountStatus.Active;
    }

    public void Suspend()
    {
        status = AccountStatus.Suspended;
    }

    public static User GetById(int id)
    {
        User fetchedUser = new User();

        // Lots of database and error-checking code
        // omitted for clarity
        // ...

        fetchedUser.name = (string) reader["Name"];
        fetchedUser.status = (int)reader["statusCode"] == 0 ? AccountStatus.Suspended : AccountStatus.Active;

        return fetchedUser;
    }

    public static void Save(User user)
    {
        // Code to save User's internal structure to database
        // ...
    }
} 
```

在此示例中，我们有一个对象，该对象表示具有名称和 AccountStatus 的用户。我们不想让 Status 直接被设置，可能是因为我们想检查更改是否是有效的状态转换，所以我们没有设置器。幸运的是，GetById 和 Save 静态方法中的映射代码可以完全访问对象的名称和状态字段。

第二个选项是有一个负责映射的第二个类。这样做的好处是将业务逻辑和持久性的不同关注点分开，这可以使您的设计更具可测试性和灵活性。这种方法的挑战是如何将名称和状态字段公开给外部类。一些选项是： 1\. 使用反射（它不会对深入挖掘对象的私有部分感到不安） 2\. 提供特殊命名的公共设置器（例如，在它们前面加上“Private”这个词）并希望没有人意外使用它们 3 . 如果您的语言支持它，请将设置器设置为内部但授予您的数据映射器模块访问权限。例如，在 .NET 2.0 及更高版本中使用 InternalsVisibleToAttribute 或在 C++ 中使用友元函数

有关更多信息，我推荐 Martin Fowler 的经典著作《企业架构模式》

但是，作为警告，在开始编写自己的映射器之前，我强烈建议使用 3rd-party 对象关系映射器 (ORM) 工具，例如 nHibernate 或 Microsoft 的实体框架。我参与了四个不同的项目，出于各种原因，我们编写了自己的映射器，很容易浪费大量时间维护和扩展映射器，而不是编写为最终用户提供价值的代码。到目前为止，我已经在一个项目中使用了 nHibernate，虽然它最初的学习曲线相当陡峭，但您在早期投入的投资获得了可观的回报。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-12T21:28:09.823

这是一个经典问题——将域模型与数据库模型分开。有几种方法可以攻击它，在我看来这真的取决于你的项目的大小。您可以像其他人所说的那样使用存储库模式。如果您使用的是 .net 或 java，您可以使用[NHibernate](http://www.hibernate.org/343.html)或[Hibernate](http://www.hibernate.org/)。

我所做的是使用[测试驱动开发](http://en.wikipedia.org/wiki/Test-driven_development)，所以我首先编写我的 UI 和模型层，然后模拟数据层，所以 UI 和模型是围绕特定领域的对象构建的，然后我将这些对象映射到我正在使用的任何技术数据层。让数据库决定您的应用程序的设计，先编写应用程序，然后再考虑数据，这是一个非常糟糕的主意。

ps问题的标题有点误导

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T21:34:47.127

@冰^^热：

> 数据层不应该知道业务逻辑层是什么意思？您将如何用数据填充业务对象？

UI 向业务层中的 ServiceClass 询问服务，即获取由具有所需参数数据的对象过滤的对象列表。
然后，ServiceClass 在数据层中创建一个存储库类的实例，并调用 GetList(ParameterType filters)。
然后数据层访问数据库，提取数据，并将其映射到“域”程序集中定义的通用格式。
BL 不再需要处理这些数据，因此将其输出到 UI。

然后 UI 想要编辑项目 X。它将项目（或业务对象）发送到业务层中的服务。业务层对对象进行验证，如果OK，则将其发送到数据层进行存储。

UI 知道业务层中的服务，而业务层又知道数据层。

UI 负责将用户数据输入映射到对象和从对象映射，数据层负责将数据库中的数据映射到对象和从对象映射。业务层保持纯粹的业务。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T21:16:50.987

我总是创建一个单独的程序集，其中包含：

*   很多小的接口（想想 ICreateRepository、IReadRepository、IReadListRepsitory .. 列表还在继续，其中大多数严重依赖泛型）
*   很多具体的接口，比如 IPersonRepository，从 IReadRepository 继承，你明白了。
    任何你不能用更小的接口描述的东西，你都放在具体的接口中。
    只要您使用 IPersonRepository 来声明您的对象，您就可以获得一个干净、一致的接口来使用。但更重要的是，您还可以创建一个在其构造函数中使用 fx 的 ICreateRepository 的类，因此代码最终将很容易做一些非常时髦的事情。这里还有业务层中的服务接口。
*   最后，我将所有域对象都粘贴到额外的程序集中，只是为了使代码库本身更干净，更松散耦合。这些对象没有任何逻辑，它们只是描述所有 3+ 层数据的常用方式。

顺便提一句。为什么要在业务逻辑层中定义方法来适应数据层？
数据层应该没有理由甚至知道有业务层..

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T21:18:44.650

这可能是一个解决方案，因为它不会侵蚀界面。我想你可以有这样的课程：

```
public class BusinessObjectRecord : BusinessObject
{
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-12T21:28:05.753

数据层不应该知道业务逻辑层是什么意思？您将如何用数据填充业务对象？

我经常这样做：

```
namespace Data
{
    public class BusinessObjectDataManager
    {
         public void SaveObject(BusinessObject object)
         {
                // Exec stored procedure
         {
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-12T21:52:01.570

那么问题来了，业务层需要向数据层暴露更多的功能，而增加这个功能就意味着向UI层暴露了太多？如果我正确理解了您的问题，那么听起来您试图通过单个界面满足太多，而这只会导致它变得混乱。为什么没有两个接口进入业务层？一个是用于 UI 层的简单、安全的界面。另一个是数据层的低级接口。

您也可以将这种双接口方法应用于需要同时传递给 UI 和数据层的任何对象。

```
public class BusinessLayer : ISimpleBusiness
{}

public class Some3LayerObject : ISimpleSome3LayerObject
{} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-13T01:00:12.783

您可能希望将接口分为两种类型，即：

*   查看界面——这些界面指定了您与 UI 的交互，以及
*   数据接口——允许您指定与数据交互的接口

可以继承和实现这两组接口，例如：

```
public class BusinessObject : IView, IData 
```

这样，在你的数据层你只需要看到 IData 的接口实现，而在你的 UI 中你只需要看到 IView 的接口实现。

您可能想要使用的另一种策略是在 UI 或数据层中组合您的对象，以便它们仅由这些层使用，例如，

```
public class BusinessObject : DomainObject

public class ViewManager<T> where T : DomainObject

public class DataManager<T> where T : DomainObject 
```

这反过来又允许您的业务对象保持对 UI/View 层和数据层的无知。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-13T22:45:03.680

我将继续我违背常规的习惯，并说你应该质疑为什么要构建所有这些极其复杂的对象层。

我认为许多开发人员将数据库视为其对象的简单持久层，并且只关心这些对象所需的 CRUD 操作。在对象和关系模型之间的“阻抗不匹配”上投入了太多精力。这是一个想法：停止尝试。

编写存储过程来封装您的数据。根据需要从代码中使用结果集、DataSet、DataTable、SqlCommand（或 java/php/任何等效项）与数据库交互。你不需要这些对象。一个很好的例子是将 SqlDataSource 嵌入到 .ASPX 页面中。

您不应该试图向任何人隐藏您的数据。开发人员需要准确了解他们与物理数据存储交互的方式和时间。

对象关系映射器是魔鬼。停止使用它们。

构建企业应用程序通常是一种管理复杂性的练习。您必须使事情尽可能简单，否则您将拥有一个绝对不可维护的系统。如果您愿意允许一些耦合（无论如何这在任何应用程序中都是固有的），那么您可以取消业务逻辑层和数据访问层（用存储过程替换它们），并且您不需要任何这些接口。

# apache-flex - 如何在 FireFox3 中打印 Flex 组件？

> ID：9256
> 
> 赞同：5
> 
> 时间：2008-08-12T21:27:40.200
> 
> 标签：apache-flex, actionscript-3, firefox

多亏了 FireFox 对 ActiveX 组件的错误实现（打印时它确实应该拍摄它们的图像） Flex 组件（在我们的案例中是图表）不会在 FX 中打印。

它们在 IE7 甚至 IE6 中打印良好。

我们需要这些图表来打印，但它们也有动态内容。我真的不想在用户打印时再次将它们绘制为图像 - Flex 组件应该这样做。

我们找到了一种[潜在的解决方法](http://www.anychart.com/blog/2007/09/23/solving-problem-with-printing-flash-content-in-firefox-browser/)，但不幸的是它在 FireFox3 中不起作用（在 FireFox2 中它有点起作用，但还不够好）。

有人知道解决方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-19T15:09:16.437

使用 ACPrintManager 我可以让 firefox 3 完美打印！

我必须添加到示例中的一件事是检查 stage 是否为 null，如果 stage 为 null，则 callLater。

```
private function initPrint():void {
    //if we don't have a stage, wait until the next frame and try again
    if ( stage ==  null ) {
        callLater(initPrint);
        return;
    }

    PrintManager.init(stage);

    var data:BitmapData = new BitmapData(stage.stageWidth, stage.stageHeight);
    data.draw(myDataGrid);

    PrintManager.setPrintableContent(data);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-26T12:51:31.637

谢谢。添加到我们的自定义图表代码中的 -s 负载`callLater`似乎已经完成了。

# version-control - 如何在 Perforce 树中查找未跟踪的文件？（模拟svn状态）

> ID：9272
> 
> 赞同：92
> 
> 时间：2008-08-12T21:44:32.070
> 
> 标签：version-control, perforce

任何人都有脚本或别名来在 Perforce 树中查找未跟踪的（真的：未添加的）文件？

编辑：我更新了已接受的答案，因为看起来 P4V 在 2009 年 1 月的版本中增加了对此的支持。

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2009-06-09T16:28:42.070

**编辑：**请`p4 status`立即使用。不再需要跳过篮球。请参阅@ColonelPanic 的[回答](https://stackoverflow.com/a/13864328/39648)。

在 2009 年 1 月版的 P4V 中，您可以右键单击工作区树中的任何文件夹，然后单击“协调脱机工作...”

这将进行一些处理，然后显示未签出但与软件仓库版本不同或根本未签入的文件的拆分树视图。它甚至可能带来一些其他类别。

您可以右键单击此视图中的文件并检出、添加甚至还原它们。

这是一个非常方便的工具，它救了我好几次。

编辑：啊这个问题专门询问了脚本，但我会在这里留下这个答案以防万一。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-08-12T21:56:45.180

在 linux 上，或者如果你在 windows 上安装了 gnu-tools：

```
find . -type f -print0 | xargs -0 p4 fstat >/dev/null 
```

这将为每个未计入的文件显示一条错误消息。如果要捕获该输出：

```
find . -type f -print0 | xargs -0 p4 fstat >/dev/null 2>mylogfile 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-19T06:55:08.377

在 Unix 下：

```
find -type f ! -name '*~' -print0| xargs -0 p4 fstat 2>&1|awk '/no such file/{print $1}' 
```

这将打印出未添加到您的客户端或 Perforce 库中的文件列表。我习惯于`! -name '*~'`排除以 ~ 结尾的文件。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-08-12T21:55:08.087

啊，Perforce 经典之一:) 是的，这真的很糟糕，默认命令中仍然没有简单的方法。

最简单的方法是运行命令以查找客户端根目录下的所有文件，然后尝试将它们添加到软件仓库。您最终会得到所有新文件的更改列表，而现有文件将被忽略。

例如 dir /s /b /AD | p4 -x - 添加

（在 nix 命令行中使用 'find . -type f -print'）。

如果您想要一个物理列表（在控制台或文件中），那么您可以管道差异的结果（或者如果您还希望它们在更改列表中，则添加）。

如果您在 P4Win 中运行它，您可以使用 $r 替换当前工作区的客户端根目录。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2012-12-13T16:35:39.980

> 有`svn status`or的类似物`git status`吗？

**是的，但是**。

从 Perforce 版本 2012.1 开始，`p4 status`在 P4V 中有命令和“协调离线工作”。但是，它们都非常缓慢。要排除不相关的文件，您需要根据[https://stackoverflow.com/a/13126496/284795](https://stackoverflow.com/a/13126496/284795)`p4ignore.txt`编写一个文件

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2016-10-08T20:07:03.357

**2021-07-16：此答案可能已过时。**

我有理由确定它在 2016 年是准确的，无论我使用的是什么版本的 Perforce（不一定是最新的）。但似乎这个问题或设计限制已在 Perforce 的后续版本中得到纠正。我不知道堆栈溢出礼仪是什么——应该删除这个答案吗？

**2016年答案**

我觉得有必要添加一个答案，因为接受的答案和其他一些答案存在我认为的一个重大问题：他们不理解只读查询命令和进行更改的命令之间的区别。

我不希望这个答案有任何功劳，但我希望它可以帮助其他人通过遵循已接受但恕我直言不正确的答案来避免浪费时间和犯错误。

**---+ 简介**

在 perforce 工作区中查找所有未跟踪文件的最方便的方法可能是`p4 reconcile -na`.

`-a`说“给我不在存储库中的文件，即应该添加的文件”。

`-n`说“不做任何改变” - 即试运行。（虽然消息可能会说“为添加打开”，但在心理上您必须将其解释为“如果不是 -n 将打开以添加”）

查找脱机时进行的所有本地更改的最方便的方法可能`p4 edit`是`p4 reconcile -n`.

几个答案提供了脚本，通常涉及`p4 fstat`. 虽然我还没有验证所有这些脚本，但我经常使用类似的脚本来弥补 perforce 命令的不足，例如`p4 reconcile -n`- 例如，我经常发现我想要本地路径而不是 Perforce 库路径或工作区路径。

**---+ 警告**

`p4 status`不是其他版本控制系统上的状态命令的对应物。

`p4 status`不是只读查询。`p4 status`实际上找到了相同类型的更改，`p4 reconcile`并将它们添加到存储库中。`p4 status`似乎没有像这样的`-n`空运行选项`p4 reconcile`。

如果您这样做`p4 status`，请查看文件并想“哦，我不需要这些”，然后`p4 revert`如果您想在同一个工作区中继续编辑，您将不得不使用它们。否则，`p4 status`添加到您的变更集的更改将在下次检查。

除了本地工作空间与仓库路径名的一些细节外，似乎没有或几乎没有理由使用`p4 status`而不是。`p4 reconcile -n`

我只能想象为非只读命令选择“状态”的人对英语和其他版本控制工具的掌握有限。

**---+`P4V`图形界面**

在 GUI`p4v`中，reconcile 命令查找可能需要添加、删除或打开以进行编辑的本地更改。幸运的是，默认情况下它不会将它们添加到更改列表中；但如果您不想提交更改，您仍然可能需要在检查后小心关闭协调窗口。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-08-28T21:19:01.103

或者，从 P4Win 中，使用左侧视图面板上的“本地文件不在 Depot 中”选项。

我不怎么用 P4V，但我认为相当于在 Workspace 视图 tab.p4 help fstat 的过滤器下拉列表中选择“Hide Local Workspace Files”

在 P4V 2015.1 中，您会在过滤器按钮下找到这些选项，如下所示： [![在此处输入图像描述](https://i.stack.imgur.com/nsfr5.png)](https://i.stack.imgur.com/nsfr5.png)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-06-08T18:59:57.010

我在我的工具中使用以下内容来备份工作区中与存储库不同的任何文件（对于 Windows）。它处理一些 Perforce 不太喜欢的奇怪情况，例如嵌入的空白、星号、百分比和井号：

```
dir /S /B /A-D | sed -e "s/%/%25/g" -e "s/@/%40/g" -e "s/#/%23/g" -e "s/\*/%2A/g" | p4 -x- have 1>NUL: 
```

“ **dir /S /B /AD** ”以“裸”格式 ( **/B** )列出此文件夹 ( **/S** ) 或以下的所有文件，不包括目录 (/ **AD** )。“ **sed** ” 将危险字符更改为“ **%xx** ” 形式（类似于 HTML），“ **p4 have** ” 命令检查该列表（“ **-x-** ”），以防止服务器丢弃有关它在存储库中实际定位的文件的任何信息(" **1>NUL:** ")。结果是一堆行，例如：

 ******```
Z:\No_Backup\Workspaces\full\depot\Projects\Archerfish\Portal\Main\admin\html\images\nav\navxx_background.gif - file(s) not on client. 
```

瞧！

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-03-23T18:11:26.933

Quick 'n Dirty：在 p4v 中右键单击有问题的文件夹并将其下的所有文件添加到新的更改列表中。更改列表现在将包含当前不属于软件仓库的所有文件。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-07-18T10:22:18.577

以下命令产生类似状态的输出，但没有一个完全等同于`svn status`or `git status`，提供每个文件状态的单行摘要：

*   `p4 status`
*   `p4 opened`
*   `p4 diff -ds`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-11-25T21:23:53.660

我没有足够的声誉点来评论，但罗斯的解决方案还列出了可以添加的文件。你可能**不想**用他的回答来清理你的工作空间。

以下使用`p4 fstat`（感谢 Mark Harrison）而不是`p4 have`, 并列出了不在软件仓库**中**且未打开以供添加的文件。

```
dir /S /B /A-D | sed -e "s/%/%25/g" -e "s/@/%40/g" -e "s/#/%23/g" -e "s/\*/%2A/g" | p4 -x- fstat 2>&1 | sed -n -e "s/ - no such file[(]s[)]\.$//gp" 
```

===江湖

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-06-19T15:06:04.080

方法快，但不太正统。如果代码库不经常添加新文件/更改视图，您可以在结帐时创建一个本地“git”存储库。从干净的 perforce 同步，git init，在本地添加和提交所有文件。Git 状态很快，并且会显示以前未提交的文件。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-10-19T07:26:22.977

该`p4 fstat`命令允许您测试工作空间中是否存在文件，结合`find`来查找要检查的文件，如以下 Perl 示例所示：

```
// throw the output of p4 fstat to a 'output file'
// find:
//  -type f  :-  only look at files,
//  -print0  :-  terminate strings with \0s to support filenames with spaces
// xargs:
//  Groups its input into command lines,
//  -0       :-  read input strings terminated with \0s
// p4:
//  fstat    :-  fetch workspace stat on files

my $status=system "(find . -type f -print0 | xargs -0 p4 fstat > /dev/null) >& $outputFile";

// read output file
open F1, $outputFile or die "$!\n";

// iterate over all the lines in F1
while (<F1>) {
  // remove trailing whitespace
  chomp $_;

  // grep lines which has 'no such file' or 'not in client'
  if($_ =~ m/no such file/ || $_ =~ m/not in client/){

     // Remove the content after '-'
     $_=~ s/-\s.*//g;

     // below line is optional. Check ur output file for more clarity.
     $_=~ s/^.\///g;

     print "$_\n";
  }
}

close F1; 
```

或者你可以使用`p4 reconcile -n -m ...`

如果它是“打开删除”，则它已从工作区中删除。请注意，上述命令在预览模式下运行 ( `-n`)。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-05-02T19:40:16.820

我需要可以在 Linux、Mac 或 Windows 上运行的东西。所以我为它写了一个 Python 脚本。基本思想是遍历文件并`p4 fstat`在每个文件上执行。（当然忽略依赖项和 tmp 文件夹）

你可以在这里找到它：[https ://gist.github.com/givanse/8c69f55f8243733702cf7bcb0e9290a9](https://gist.github.com/givanse/8c69f55f8243733702cf7bcb0e9290a9)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-10-26T01:53:31.683

此命令可以为您提供需要添加、编辑或删除的文件列表：
p4 status -aed ...
您也可以单独使用它们
p4 status -a ...
p4 status -e ...
p4 status -d ...

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2013-09-19T22:07:42.410

在 P4V 中，在“查看”菜单项下选择“文件夹中的文件”，这会在右侧窗格中打开一个新选项卡。在选项卡的最右侧有一个小图标，它会打开一个名为“文件夹中的文件”的窗口，其中包含 2 个图标。选择看起来像漏斗的左侧图标，您将看到几个选项。选择“显示不在仓库中的项目”，文件夹中的所有文件都会显示出来。然后只需右键单击要添加的文件并选择“标记为添加...”。您可以在“待处理”选项卡中验证它是否存在。只需正常提交 (Ctrl+S)。

# sql-server - 针对 ODBC 数据源使用 MS Reporting Services (SQL Server 2008) 中的参数

> ID：9275
> 
> 赞同：1
> 
> 时间：2008-08-12T21:47:45.277
> 
> 标签：sql-server, visual-studio, sql-server-2008, reporting-services, odbc

我在 Visual Studio 中编写了一个报告，该报告采用用户输入参数并针对 ODBC 数据源运行。我想手动编写查询，并让报告服务在将 where 子句发送到数据库之前用参数值替换部分 where 子句。似乎正在发生的事情是，`@parmName`我假设将被替换的实际上是作为 SQL 语句的一部分发送的。我是否在某处缺少配置设置，或者这根本不可能？

我没有在工具中使用过滤器选项，因为这似乎会从数据库中带回完整的数据集并在 SQL Server 上进行过滤。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-12T23:43:15.183

听起来您需要将 SQL 语句视为表达式。例如：

```
="Select col1, col2 from table 1 Where col3 = " & Parameters!Param1.Value 
```

如果 where 子句是字符串，则需要执行以下操作：

```
="Select col1, col2 from table 1 Where col3 = '" & Parameters!Param1.Value & "'" 
```

重要提示：不要在 SQL 表达式中使用换行符。如果你这样做，你会得到一个错误。

如果您需要更多帮助，请回来。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-21T10:44:08.020

ODBC 不使用旧的“？” 参数的语法？试试这个：

```
select col1, col2 from table1 where col3 = ? 
```

然后参数的顺序变得很重要，但它比简单地附加参数值更不容易受到 SQL 注入的影响。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-11T12:49:18.140

尝试通过 ODBC 查询访问数据库时遇到了同样的问题。

我原来的查询：`SELECT A.1 FROM A WHERE A.1 = @parameter`导致错误。改为：`SELECT A.1 FROM A WHERE A.1 = ?`。

然后，您必须将查询参数与您的报告参数进行映射。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-26T16:46:47.437

我对这个问题有点困惑，如果您正在寻找简单的参数用法，那么符号是 : `*paramName*`，但是如果您想在结构上更改`WHERE`子句（就像您可能在 sql+ 中使用？）那么您真的应该在其中使用自定义代码报表来定义一个函数，该函数返回查询所需的 sql。

不幸的是，在使用自定义代码时，不能在生成的查询中直接引用参数，而必须将这些值连接到结果字符串中，从而引入了`SQL`注入的可能性。

# linux - 使远程目录保持最新

> ID：9279
> 
> 赞同：44
> 
> 时间：2008-08-12T21:56:10.050
> 
> 标签：linux, macos, ssh, sftp

我非常喜欢[Winscp中的](http://winscp.net/)[Keep Remote Directory Up-to-date](http://winscp.net/eng/docs/task_keep_up_to_date)功能。不幸的是，我找不到在 OS X 或 Linux 中使用这么简单的东西。我知道*理论上*可以使用[changedfiles](http://freshmeat.net/projects/changedfiles/)或[rsync](http://samba.anu.edu.au/rsync/)完成同样的事情，但我一直发现这两种工具的教程都缺乏和/或矛盾。

 *我基本上只需要一个在 OSX 或 Linux 中工作的工具，并在我对本地目录进行更改时保持远程目录与本地目录同步（镜像）。

* * *

**更新**

通过解决方案，我看到了一些解决了*手动*保持远程目录与本地目录同步的一般问题的方法。我知道我可以设置一个 cron 任务来每分钟运行一次 rsync，这应该非常接近实时。

这不是我正在寻找的确切解决方案，因为 winscp 会这样做以及更多：它检测目录中的文件更改（当我处理它们时），然后自动将更改推送到远程服务器。我知道这不是最好的解决方案（没有代码存储库），但它允许我在开发时非常快速地在服务器上测试代码。有谁知道如何将 rsync 与任何其他命令结合使用来获得此功能？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2013-03-07T22:30:07.977

[lsyncd](https://github.com/axkibe/lsyncd#readme)似乎是完美的解决方案。它结合了**inotify**（用于监视目录树中文件更改的内核内置函数）和**rsync**（跨平台文件同步工具）。

```
lsyncd -rsyncssh /home remotehost.org backup-home/ 
```

引用自 github：

> Lsyncd 监视本地目录树事件监视器接口（inotify 或 fsevents）。它在几秒钟内聚合和组合事件，然后生成一个（或多个）进程以同步更改。默认情况下这是 rsync。因此，Lsyncd 是一种轻量级的实时镜像解决方案，它相对容易安装，不需要新的文件系统或块设备，也不会影响本地文件系统的性能。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-08-12T22:14:46.830

您希望同步有多“实时”？我仍然倾向于 rsync，因为您知道它将在两个平台（Windows 也一样，带有 cygwin）上得到完全支持，并且您可以通过 cron 作业运行它。我有一个在我的系统上运行的超级简单的 bash 文件（这不会*删除*旧文件）：

```
#!/bin/sh
rsync -avrz --progress --exclude-from .rsync_exclude_remote . remote_login@remote_computer:remote_dir    

# options
#   -a  archive
#   -v  verbose
#   -r  recursive
#   -z  compress 
```

您最好的选择是设置并尝试一下。选择是你的`-n (--dry-run)`朋友！

请记住，rsync（至少在 cygwin 中）不支持 unicode 文件名（截至 2008 年 8 月 16 日）。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-14T05:19:26.870

您想要为 linux 远程访问做的是使用 'sshfs' - SSH 文件系统。

```
# sshfs username@host:path/to/directory local_dir 
```

然后将其视为网络挂载，它是...

更多细节，例如如何设置它，以便您可以作为普通用户执行此操作，在[我的博客上](http://soi.kd6.us/2008/11/05/so-i-used-sshfs-to-mount-a-remote-filesystem/)

如果您想要 winSCP 的异步行为，您需要将 rsync 与定期执行它的东西结合使用。上面的 cron 解决方案有效，但对于 winscp 用例来说可能有点过分了。

以下命令将每 5 秒执行一次 rsync 以将内容推送到远程主机。您可以根据需要调整休眠时间以减少服务器负载。

```
# while true; do rsync -avrz localdir user@host:path; sleep 5; done 
```

如果你有一个非常大的目录结构并且需要减少轮询的开销，你可以使用'find'：

```
# touch -d 01/01/1970 last; while true; do if [ "`find localdir -newer last -print -quit`" ]; then touch last; rsync -avrz localdir user@host:path; else echo -ne .; fi; sleep 5; done 
```

我说 cron 可能是矫枉过正？但至少这一切都是从命令行完成的，并且可以通过 ctrl-C 停止。

KB

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-13T00:24:41.293

要检测更改的文件，您可以尝试 fam（文件更改监视器）或 inotify。后者是特定于 linux 的，fam 有一个 bsd 端口，可以在 OS X 上运行。两者都有用户空间工具，可以与 rsync 一起在脚本中使用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-12-07T16:20:21.923

我有同样的问题。我喜欢winscp“保持远程目录最新”命令。然而，在我摆脱 Windows 的过程中，我失去了 winscp。我确实编写了一个脚本，它使用 fileschanged 和 rsync 来执行更接近实时的类似操作。

如何使用：

*   确保已安装 fileschanged
*   将此脚本保存在 /usr/local/bin/livesync 或 $PATH 中可访问的某个位置并使其可执行
*   使用 Nautilus 连接到远程主机（sftp 或 ftp）
*   通过 livesync **SOURCE DEST运行此脚本**
*   DEST 目录将位于 /home/[username]/.gvfs/[ftp scp 的路径或其他]

几个缺点：

*   它比 winscp 慢（我的猜测是因为它通过 Nautilus 并且还必须通过 rsync 检测更改）
*   如果目标目录尚不存在，则必须手动创建它。因此，如果您要添加目录，它不会在 DEST 端检测和创建目录。
*   可能更多我还没有注意到
*   此外，不要尝试同步名为“rsyncThis”的 SRC 目录。那可能不太好:)

* * *

```
#!/bin/sh

upload_files()
{
    if [ "$HOMEDIR" = "." ]
    then
        HOMEDIR=`pwd`
    fi

    while read  input
    do
        SYNCFILE=${input#$HOMEDIR}
        echo -n "Sync File: $SYNCFILE..."
        rsync -Cvz --temp-dir="$REMOTEDIR" "$HOMEDIR/$SYNCFILE" "$REMOTEDIR/$SYNCFILE" > /dev/null
        echo "Done."
    done
}

help()
{
    echo "Live rsync copy from one directory to another.  This will overwrite the existing files on DEST."
    echo "Usage: $0 SOURCE DEST"    
}

case "$1" in
  rsyncThis)
    HOMEDIR=$2
    REMOTEDIR=$3
    echo "HOMEDIR=$HOMEDIR"
    echo "REMOTEDIR=$REMOTEDIR"
    upload_files
    ;;

  help)
    help
    ;;

  *)
    if [ -n "$1" ] && [ -n "$2" ]
    then
        fileschanged -r "$1" | "$0" rsyncThis "$1" "$2"
    else
        help
    fi
    ;;
esac 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-12T22:17:34.297

你总是可以使用版本控制，比如 SVN，所以你所要做的就是让服务器每晚在一个文件夹上运行 svn up。如果您公开共享文件，这会遇到安全问题，但它确实有效。

如果您使用的是 Linux，请学习使用 rsync。这真的没那么难，因为您可以使用 -n 测试每个命令。浏览[手册页](http://www.samba.org/ftp/rsync/rsync.html)，您需要的基本格式是

> rsync [选项...] SRC... [USER@]HOST:DEST

我从学校服务器运行到家庭备份机的命令是这样的

> rsync -avi --delete ~ me@homeserv:~/School/ >> BackupLog.txt

这将获取我的主目录 (~) 中的所有文件，并使用 rsync 的存档模式 (-a)、详细 (-v)、列出所做的所有更改 (-i)，同时删除任何不再存在的文件(--delete) 并将其放在我的远程服务器上的文件夹 /home/me/School/ 中。它打印出的所有信息（复制的内容、删除的内容等）也附加到文件 BackupLog.txt

我知道这是 rsync 的旋风之旅，但我希望它有所帮助。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-12T23:01:14.880

`rsync`解决方案非常好，特别是如果您只是以一种方式推动更改。另一个很棒的工具是`unison`——它试图同步两个方向的变化。[在Unison 主页](http://www.cis.upenn.edu/~bcpierce/unison/ "齐奏主页")上阅读更多内容。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-06-22T17:57:37.143

好问题我已经搜索了几个小时的答案！

我已经测试[了 lsyncd](https://github.com/axkibe/lsyncd)，问题是**默认延迟太长了，**并且没有示例命令行提供该`-delay`选项。

另一个问题是，默认情况下 rsync每次都询问**密码！**

使用**lsyncd**的解决方案：

```
lsyncd --nodaemon -rsyncssh local_dir remote_user@remote_host remote_dir -delay .2 
```

另一种方法是在脚本中使用**inotify-wait ：**

```
while inotifywait -r -e modify,create,delete local_dir ; do
    # if you need you can add wait here
    rsync -avz local_dir remote_user@remote_host:remote_dir
done 
```

对于第二个解决方案，您必须安装`inotify-tools`包

要**禁止**在每次更改时输入密码，只需使用`ssh-keygen`： [https ://superuser.com/a/555800/510714](https://superuser.com/a/555800/510714)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-13T00:32:05.897

似乎您正在解决错误的问题。如果您尝试在远程计算机上编辑文件，那么您可以尝试使用 jedit 的 ftp 插件之类的东西。 [http://plugins.jedit.org/plugins/?FTP](http://plugins.jedit.org/plugins/?FTP) 这确保您只有一个文件版本，因此它永远不会不同步。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T15:13:37.330

基于 icco 对 SVN 的建议，我实际上建议，如果您使用 subversion 或类似工具进行源代码控制（如果不是，您可能应该开始），您可以通过输入命令使生产环境保持最新将存储库更新到提交后挂钩。

您希望如何做到这一点有很多变数，但我所看到的工作是让开发或实时站点成为工作副本，然后让提交后使用带有强制命令的 ssh 密钥登录远程站点并在工作副本上触发 svn up。或者，在 post-commit 钩子中，您可以触发远程机器上的 svn 导出，或本地（到 svn 存储库）svn 导出，然后 rsync 到远程机器。

我会担心检测到变化并推动它们的事情，我什至会担心每分钟运行的事情，只是因为竞争条件。你怎么知道它不会在文件被写入的同一时刻传输文件？偶然发现一次或两次，您将失去通过不断进行 rsync 或类似操作而获得的所有节省时间的优势。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-22T02:23:01.850

DropBox ( [http://www.getdropbox.com/](http://www.getdropbox.com/) ) 会做你想做的事吗？

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-01-13T17:20:32.110

我以前在 Windows 下的设置与您相同，即本地文件树（版本化）和远程服务器上的测试环境，我使用 WinSCP 实时镜像。当我切换到 Mac 时，我不得不做一些挖掘工作才能感到高兴，但最终还是使用了：

*   [SmartSVN](https://www.smartsvn.com/)作为我的颠覆客户端
*   [Sublime Text 2](http://www.sublimetext.com/2)作为我的编辑器（已经在 Windows 上使用过）
*   ST2 的 SFTP 插件，用于处理保存时的上传（抱歉，不能发布超过 2 个链接）

我真的可以推荐这个设置，希望它有帮助！

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-02-20T18:39:19.347

用户 watcher.py 和 rsync 可以自动执行此操作。在此处阅读以下分步说明：

[http://kushellig.de/linux-file-auto-sync-directories/](http://kushellig.de/linux-file-auto-sync-directories/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-08-18T14:41:18.473

您还可以将 Fetch 用作 SFTP 客户端，然后在其中直接在服务器上编辑文件。还有 SSHFS（将 ssh 文件夹挂载为卷）选项。这与 stimms 所说的一致 - 您确定要保持同步，还是只想编辑服务器上的文件？

OS X 有它自己的文件通知系统——这就是 Spotlight 的基础。我还没有听说过任何使用它来保持同步的程序，但这当然是可以想象的。

我个人将 RCS 用于此类事情：- 虽然它具有手动方面，但我不太可能在不先测试的情况下从我的开发机器将某些东西推送到测试服务器。如果我在开发服务器上工作，那么我会使用上面给出的选项之一。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-01-21T09:25:35.473

好吧，我遇到了同样的问题，可以一起使用：rsync、SSH Passwordless Login、Watchdog（一个 Python 同步实用程序）和 Terminal Notifier（一个用 Ruby 制作的 OS X 通知实用程序。不需要，但有助于了解同步完成时）。

1.  我使用 Dreamhost wiki 中的本教程创建了无密码登录的密钥：http: [//cl.ly/MIw5](http://cl.ly/MIw5)

    1.1。完成后，测试一切是否正常……如果您无法无密码登录，也许您必须尝试 afp mount。Dreamhost（我的站点所在的位置）不允许挂载 afp，但允许无密码登录。在终端中，键入：

    `ssh username@host.com` 您应该在不询问密码的情况下登录：P

2.  我从 Github 页面安装了终端通知程序：http: [//cl.ly/MJ5x](http://cl.ly/MJ5x)

    2.1。我使用了 Gem 安装程序命令。在终端中，键入：

    `gem install terminal-notifier`

    2.3\. 测试通知是否有效。在终端中，键入：

    `terminal-notifier -message "Starting sync"`

3.  创建一个 sh 脚本来测试 rsync + 通知。以您喜欢的名称将其保存在您喜欢的任何位置。在此示例中，我将其命名为**~/Scripts/sync.sh**我使用了“.sh 扩展名，但我不知道是否需要它。

    `#!/bin/bash terminal-notifier -message "Starting sync" rsync -azP ~/Sites/folder/ user@host.com:site_folder/ terminal-notifier -message "Sync has finished"`

    3.1。记得给这个 sh 脚本执行权限。在终端中，键入：

    `sudo chmod 777 ~/Scripts/sync.sh` 3.2\. 运行脚本并验证消息是否正确显示以及 rsync 是否实际将您的本地文件夹与远程文件夹同步。

4.  最后，我从 Github 页面下载并安装了 Watchdog：http: [//cl.ly/MJfb](http://cl.ly/MJfb)

    4.1。首先，我使用 Brew 安装了 libyaml 依赖项（有很多关于如何安装 Brew 的帮助 - 就像 OS X 的“能力”）。在终端中，键入：

    `brew install libyaml`

    4.2\. 然后，我使用了“easy_install 命令”。进入看门狗文件夹，输入终端：

    `easy_install watchdog`

5.  现在，一切都安装好了！**转到您要同步的文件夹**，**将此代码更改为您的需要**，然后输入终端：

    ```
     watchmedo shell-command
          --patterns="*.php;*.txt;*.js;*.css" \
          --recursive \
          --command='~/Scripts/Sync.sh' \
          . 
    ```

    它必须**完全**这样，带有斜杠和换行符，所以你必须将这些行复制到文本编辑器，更改脚本，粘贴到终端并按回车键。

    我试过没有换行符，它不起作用！

    在我的 Mac 中，我总是收到一个错误，但它似乎没有影响任何事情：

    `/Library/Python/2.7/site-packages/argh-0.22.0-py2.7.egg/argh/completion.py:84: UserWarning: Bash completion not available. Install argcomplete.`

    现在，对文件夹内的一个文件进行一些更改，看看魔术吧！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-06-27T15:36:31.813

我正在使用这个小 Ruby 脚本：

```
#!/usr/bin/env ruby
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rsyncs 2Folders
#
# watchAndSync by Mike Mitterer, 2014 <http://www.MikeMitterer.at>
# with credit to Brett Terpstra <http://brettterpstra.com>
# and Carlo Zottmann <https://github.com/carlo/haml-sass-file-watcher>
# Found link on: http://brettterpstra.com/2011/03/07/watch-for-file-changes-and-refresh-your-browser-automatically/
#

trap("SIGINT") { exit }

if ARGV.length < 2
  puts "Usage: #{$0} watch_folder sync_folder"
  puts "Example: #{$0} web keepInSync"
  exit
end

dev_extension = 'dev'
filetypes = ['css','html','htm','less','js', 'dart']

watch_folder = ARGV[0]
sync_folder = ARGV[1]

puts "Watching #{watch_folder} and subfolders for changes in project files..."
puts "Syncing with #{sync_folder}..."

while true do
  files = []
  filetypes.each {|type|
    files += Dir.glob( File.join( watch_folder, "**", "*.#{type}" ) )
  }
  new_hash = files.collect {|f| [ f, File.stat(f).mtime.to_i ] }
  hash ||= new_hash
  diff_hash = new_hash - hash

  unless diff_hash.empty?
    hash = new_hash

    diff_hash.each do |df|
      puts "Detected change in #{df[0]}, syncing..."
      system("rsync -avzh #{watch_folder} #{sync_folder}")
    end
  end

  sleep 1
end 
```

根据您的需要进行调整！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-05-09T02:52:21.810

如果你在远程服务器上开发 python，Pycharm 可能是你的一个不错的选择。您可以使用 pycharm 远程开发功能将远程文件与本地文件同步。指南链接为： [https ://www.jetbrains.com/help/pycharm/creating-a-remote-server-configuration.html](https://www.jetbrains.com/help/pycharm/creating-a-remote-server-configuration.html)

# javascript - 在 JavaScript 中使用 Array.map 删除元素

> ID：9289
> 
> 赞同：112
> 
> 时间：2008-08-12T22:21:30.263
> 
> 标签：javascript, functional-programming, data-manipulation, client-side

我想使用该`map()`函数过滤一组项目。这是一个代码片段：

```
var filteredItems = items.map(function(item)
{
    if( ...some condition... )
    {
        return item;
    }
}); 
```

问题是过滤掉的项目仍然使用数组中的空间，我想完全清除它们。

任何的想法？

编辑：谢谢，我忘记了`filter()`，我想要的实际上是 a`filter()`然后 a `map()`。

EDIT2：感谢您指出`map()`并`filter()`没有在所有浏览器中实现，尽管我的特定代码不打算在浏览器中运行。

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-08-12T22:38:28.327

除了过滤之外，您应该使用该`filter`方法而不是 map ，除非您想改变数组中的项目。

例如。

```
var filteredItems = items.filter(function(item)
{
    return ...some condition...;
}); 
```

[编辑：当然你总是`sourceArray.filter(...).map(...)`可以同时过滤和变异]

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2016-04-11T19:25:52.623

受写这个答案的启发，我后来扩展并写了一篇博客文章，详细讨论了这个问题。如果您想更深入地了解如何考虑这个问题，我建议您[检查一下](http://code.kylebaker.io/2018/03/16/stack-overflow/)——我尝试逐段解释它，并在最后给出一个 JSperf 比较，超越速度考虑。

也就是说，** tl;dr 是这样的：

## 要完成您的要求（在一个函数调用中进行过滤和映射），您将使用`Array.reduce()`**.

## 然而，*更具可读性* **和**（不太重要）*通常明显更快的*^([2](http://code.kylebaker.io/2018/03/16/stack-overflow/#What-about-performance))方法是仅使用链接在一起的过滤器和映射：

`[1,2,3].filter(num => num > 2).map(num => num * 2)`

以下是如何`Array.reduce()`工作的描述，以及如何使用它在一次迭代中完成过滤和映射。同样，如果这太浓缩了，我强烈建议您查看上面链接的博客文章，这是一个更友好的介绍，带有清晰的示例和进展。

* * *

你给 reduce 一个参数，它是一个（通常是匿名的）函数。

*该匿名函数*有两个参数——一个（如传入 map/filter/forEach 的匿名函数）是要操作的迭代对象。然而，传递给 reduce 的匿名函数还有另一个参数，即那些函数不接受，这就是**将在函数调用之间传递的值，通常称为*memo***。

请注意，虽然 Array.filter() 只接受一个参数（一个函数），但 Array.reduce() 还接受一个重要的（尽管是可选的）第二个参数：'memo' 的初始值，它将作为其传递给该匿名函数第一个参数，随后可以在函数调用之间进行变异和传递。（如果未提供，则第一个匿名函数调用中的 'memo' 默认为第一个 iteratee，而 'iteratee' 参数实际上是数组中的第二个值）

在我们的例子中，我们将传入一个空数组开始，然后根据我们的函数选择是否将我们的迭代器注入到我们的数组中——这就是过滤过程。

最后，我们将在每个匿名函数调用中返回我们的“正在进行的数组”，reduce 将获取该返回值并将其作为参数（称为 memo）传递给它的下一个函数调用。

这允许过滤器和映射在一次迭代中发生，将我们所需的迭代次数减少一半——虽然每次迭代只做两倍的工作，所以除了函数调用之外什么都没有真正保存，这在 javascript 中并不那么昂贵.

有关更完整的解释，请参阅[MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce)文档（或此答案开头引用的我的帖子）。

Reduce 调用的基本示例：

```
let array = [1,2,3];
const initialMemo = [];

array = array.reduce((memo, iteratee) => {
    // if condition is our filter
    if (iteratee > 1) {
        // what happens inside the filter is the map
        memo.push(iteratee * 2); 
    }

    // this return value will be passed in as the 'memo' argument
    // to the next call of this function, and this function will have
    // every element passed into it at some point.
    return memo; 
}, initialMemo)

console.log(array) // [4,6], equivalent to [(2 * 2), (3 * 2)] 
```

更简洁的版本：

```
[1,2,3].reduce((memo, value) => value > 1 ? memo.concat(value * 2) : memo, []) 
```

请注意，第一个 iteratee 不大于 1，因此被过滤了。还要注意 initialMemo，命名只是为了明确它的存在并引起人们的注意。再一次，它作为“备忘录”传递给第一个匿名函数调用，然后匿名函数的返回值作为“备忘录”参数传递给下一个函数。

memo 的另一个经典用例示例是返回数组中的最小或最大数字。例子：

```
[7,4,1,99,57,2,1,100].reduce((memo, val) => memo > val ? memo : val)
// ^this would return the largest number in the list. 
```

一个如何编写自己的 reduce 函数的示例（我发现这通常有助于理解这些函数）：

```
test_arr = [];

// we accept an anonymous function, and an optional 'initial memo' value.
test_arr.my_reducer = function(reduceFunc, initialMemo) {
    // if we did not pass in a second argument, then our first memo value 
    // will be whatever is in index zero. (Otherwise, it will 
    // be that second argument.)
    const initialMemoIsIndexZero = arguments.length < 2;

    // here we use that logic to set the memo value accordingly.
    let memo = initialMemoIsIndexZero ? this[0] : initialMemo;

    // here we use that same boolean to decide whether the first
    // value we pass in as iteratee is either the first or second
    // element
    const initialIteratee = initialMemoIsIndexZero ? 1 : 0;

    for (var i = initialIteratee; i < this.length; i++) {
        // memo is either the argument passed in above, or the 
        // first item in the list. initialIteratee is either the
        // first item in the list, or the second item in the list.
           memo = reduceFunc(memo, this[i]);
        // or, more technically complete, give access to base array
        // and index to the reducer as well:
        // memo = reduceFunc(memo, this[i], i, this);
    }

    // after we've compressed the array into a single value,
    // we return it.
    return memo;
} 
```

例如，真正的实现允许访问诸如索引之类的东西，但我希望这可以帮助您对它的要点有一种简单的感觉。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-08-12T22:33:45.107

这不是地图的作用。你真的想要[`Array.filter`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter)。或者，如果您真的想从原始列表中删除元素，则需要使用 for 循环强制执行。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-09-30T14:56:21.877

# 数组[过滤方法](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter)

```
var arr = [1, 2, 3]

// ES5 syntax
arr = arr.filter(function(item){ return item != 3 })

// ES2015 syntax
arr = arr.filter(item => item != 3)

console.log( arr )
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-12T23:44:10.503

但是您必须注意，`Array.filter`并非所有浏览器都支持，因此您必须原型化：

```
//This prototype is provided by the Mozilla foundation and
//is distributed under the MIT license.
//http://www.ibiblio.org/pub/Linux/LICENSES/mit.license

if (!Array.prototype.filter)
{
    Array.prototype.filter = function(fun /*, thisp*/)
    {
        var len = this.length;

        if (typeof fun != "function")
            throw new TypeError();

        var res = new Array();
        var thisp = arguments[1];

        for (var i = 0; i < len; i++)
        {
            if (i in this)
            {
                var val = this[i]; // in case fun mutates this

                if (fun.call(thisp, val, i, this))
                   res.push(val);
            }
        }

        return res;
    };
} 
```

这样做，您可以对您可能需要的任何方法进行原型制作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-02-19T18:10:59.157

TLDR：使用`map`（`undefined`需要时返回）*然后* `filter`.

* * *

首先，我相信 map + filter 函数很有用，因为您不想在两者中重复计算。Swift 最初调用了这个函数`flatMap`，但后来将其重命名为`compactMap`.

例如，如果我们没有`compactMap`函数，我们最终可能会`computation`定义两次：

```
 let array = [1, 2, 3, 4, 5, 6, 7, 8];
  let mapped = array
  .filter(x => {
    let computation = x / 2 + 1;
    let isIncluded = computation % 2 === 0;
    return isIncluded;
  })
  .map(x => {
    let computation = x / 2 + 1;
    return `${x} is included because ${computation} is even`
  })

  // Output: [2 is included because 2 is even, 6 is included because 4 is even] 
```

因此`compactMap`对于减少重复代码很有用。

执行类似操作的一个非常简单的方法`compactMap`是：

1.  映射到真实值或`undefined`.
2.  过滤掉所有`undefined`值。

这当然依赖于您永远不需要将未定义的值作为原始地图函数的一部分返回。

例子：

```
 let array = [1, 2, 3, 4, 5, 6, 7, 8];
  let mapped = array
  .map(x => {
    let computation = x / 2 + 1;
    let isIncluded = computation % 2 === 0;
    if (isIncluded) {
      return `${x} is included because ${computation} is even`
    } else {
      return undefined
    }
  })
  .filter(x => typeof x !== "undefined") 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-10-07T14:48:21.550

以下语句使用 map 函数清理对象。

```
var arraytoclean = [{v:65, toberemoved:"gronf"}, {v:12, toberemoved:null}, {v:4}];
arraytoclean.map((x,i)=>x.toberemoved=undefined);
console.dir(arraytoclean); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-11-15T15:29:08.447

我刚刚写了正确处理重复的数组交集

[https://gist.github.com/gkucmierz/8ee04544fa842411f7553ef66ac2fcf0](https://gist.github.com/gkucmierz/8ee04544fa842411f7553ef66ac2fcf0)

```
// array intersection that correctly handles also duplicates

const intersection = (a1, a2) => {
  const cnt = new Map();
  a2.map(el => cnt[el] = el in cnt ? cnt[el] + 1 : 1);
  return a1.filter(el => el in cnt && 0 < cnt[el]--);
};

const l = console.log;
l(intersection('1234'.split``, '3456'.split``)); // [ '3', '4' ]
l(intersection('12344'.split``, '3456'.split``)); // [ '3', '4' ]
l(intersection('1234'.split``, '33456'.split``)); // [ '3', '4' ]
l(intersection('12334'.split``, '33456'.split``)); // [ '3', '3', '4' ]
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-04-20T17:15:22.613

首先你可以使用 map 和链接你可以使用 filter

```
state.map(item => {
            if(item.id === action.item.id){   
                    return {
                        id : action.item.id,
                        name : item.name,
                        price: item.price,
                        quantity : item.quantity-1
                    }

            }else{
                return item;
            }
        }).filter(item => {
            if(item.quantity <= 0){
                return false;
            }else{
                return true;
            }
        }); 
```

# javascript - 按下回车键时，onClick 不会仅通过一个输入触发

> ID：9301
> 
> 赞同：9
> 
> 时间：2008-08-12T23:01:10.807
> 
> 标签：javascript, internet-explorer, events, internet-explorer-7

我在处理 Internet Explorer 7 中的事件时遇到问题。

当我有一个包含**两个或更多** `input[type=text]`的表单并按 Enter 键时，事件按以下顺序发生：

1.  提交按钮 ( `onClick`)
2.  表格 ( `onSubmit`)

示例代码：

```
<form onSubmit="{alert('form::onSubmit'); return false;}">
    <input type="text">
    <input type="text">
    <input type="submit" onClick="{alert('button::onClick');}">
</form> 
```

如果我只有**一个** 并且我按下回车键，则不会触发`input[type=text]`提交按钮事件。`onClick`示例代码：

```
<form onSubmit="{alert('form::onSubmit'); return false;}">
    <input type="text">
    <input type="submit" onClick="{alert('button::onClick');}">
</form> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-13T00:08:17.007

按钮的 onclick 应该（我认为）仅在实际单击按钮时触发（或者当焦点位于按钮上并且用户单击 Enter 时），除非您添加了逻辑来更改它。

添加额外的文本框是否可能会更改元素的选项卡顺序（在这种情况下可能使按钮成为默认控件）？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-07-07T15:19:14.290

从浏览器诞生之日起，表单中的单个输入字段将在输入时提交，无论是否有提交按钮。这是为了让人们更容易从单个搜索字段搜索网站。

如果需要在表单中执行一些javascript，使用表单的onsubmit（并返回false停止提交）比在提交按钮的onClick中执行脚本更安全。如果您需要从按钮执行 javascript，请使用 type="button" 而不是 type="submit" - 希望这能澄清我的意思

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-22T16:09:58.697

有趣的是，如果您在只有一个文本框的第二个示例中单击屏幕（从文本框中移除焦点），则会触发 onClick 事件......所以这不是预期的行为，因为它仅在您只有一个文本框*并且*您有时才会发生文本框的焦点。
恐怕您在浏览器上发现了一个错误，您必须找到解决方法，或者在这种情况下避免使用 onClick 事件。
我使用 onSubmit 事件进行验证，因为它是一个“更安全”的事件，更有可能在不同的浏览器和情况下工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-22T16:13:05.773

出于好奇，您使用的是 DOCTYPE，如果是，是哪一个？我并不是说与 DOCTYPE 不兼容是问题所在，但在尝试其他任何事情之前要排除怪癖模式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-12T23:43:34.903

如果您希望代码在用户按下回车时运行，**只需使用 onSubmit 处理程序。**

如果您希望代码在用户按下按钮时运行，而*不是*在用户按下回车时运行，请使用 type="submit" 以外的按钮。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-03T14:52:38.533

您可能希望包含一个虚拟隐藏输入元素来重新创建您有两个输入元素的情况......这样，您将触发两个事件

```
<FORM onSubmit="{alert('form::onSubmit'); return false;}">
    <INPUT TYPE="text">
    <input type="hidden" name="dummy">
    <INPUT TYPE="submit" onClick="{alert('buttom::onClick');}">
</FORM> 
```

IE 有很多令人困惑的修复，需要做以提高我们代码的兼容性

# c# - 如何在 C# 中使用正则表达式检索选定的文本？

> ID：9303
> 
> 赞同：13
> 
> 时间：2008-08-12T23:04:10.770
> 
> 标签：c#, regex, perl

如何在 C# 中使用正则表达式检索选定的文本？

我正在寻找与此 Perl 代码等效的 C# 代码：

```
$indexVal = 0;
if($string =~ /Index: (\d*)/){$indexVal = $1;} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-12T23:12:48.927

```
int indexVal = 0;
Regex re = new Regex(@"Index: (\d*)")
Match m = re.Match(s)

if(m.Success)
  indexVal = int.TryParse(m.Groups[1].toString()); 
```

我可能有错误的组号，但你应该能够从这里弄清楚。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-12T23:27:54.093

我认为 Patrick 做到了这一点——我唯一的建议是记住命名的正则表达式组也存在，因此您不必*使用*数组索引号。

```
Regex.Match(s, @"Index (?<num>\d*)").Groups["num"].Value 
```

我发现这种正则表达式也更具可读性，尽管[意见不同](http://www.codinghorror.com/blog/archives/001016.html)......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T23:12:49.613

你会想要利用匹配的组，所以像......

```
Regex MagicRegex = new Regex(RegexExpressionString);
Match RegexMatch;
string CapturedResults;

RegexMatch = MagicRegex.Match(SourceDataString);
CapturedResults = RegexMatch.Groups[1].Value; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-12T23:35:05.560

那将是

```
int indexVal = 0;
Regex re = new Regex(@"Index: (\d*)");
Match m = re.Match(s);

if (m.Success)
    indexVal = m.Groups[1].Index; 
```

你也可以命名你的组（这里我也跳过了正则表达式的编译）

```
int indexVal = 0;
Match m2 = Regex.Match(s, @"Index: (?<myIndex>\d*)");

if (m2.Success)
    indexVal = m2.Groups["myIndex"].Index; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-02T23:41:03.897

```
int indexVal = 0;
Regex re = new Regex.Match(s, @"(<?=Index: )(\d*)");

if(re.Success)
{
  indexVal = Convert.ToInt32(re.Value);
} 
```

# c# - C# 3.0 自动属性——有用与否？

> ID：9304
> 
> 赞同：157
> 
> 时间：2008-08-12T23:06:58.767
> 
> 标签：c#, .net, automatic-properties

*注意：这是在我开始使用 C# 时发布的。凭借 2014 年的知识，我可以真正地说自动属性是 C# 语言发生过的最好的事情之一。*

我习惯于使用私有和公共字段在 C# 中创建我的属性：

```
private string title;
public string Title
{
    get { return title;  }
    set { title = value;  }
} 
```

现在，使用[.NET](http://en.wikipedia.org/wiki/.NET_Framework) 3.0，我们获得了自动属性：

```
public string Title { get; set; } 
```

我知道这更像是一个哲学/主观问题，但是除了为每个字段保存五行代码之外，还有什么理由使用这些自动属性？我个人的抱怨是这些属性对我隐藏了一些东西，而且我不是黑魔法的忠实粉丝。

事实上，隐藏的私有字段甚至没有出现在调试器中，考虑到 get/set 函数什么都不做，这是可以的。但是当我想实际实现一些 getter/setter 逻辑时，无论如何我都必须使用 private/public 对。

我看到了节省大量代码（一行对六行）而不会失去稍后更改 getter/setter 逻辑的能力的好处，但是我已经可以通过简单地声明一个公共字段“公共字符串标题”来做到这一点，而无需{ 获取的需要；放; } 块，因此甚至可以节省更多代码。

那么，我在这里缺少什么？为什么有人真的想使用自动属性？

* * *

## 回答 #1

> 赞同：121
> 
> 时间：2008-08-12T23:13:41.470

我们一直在 Stack Overflow 中使用它们。

您可能还对[属性与公共变量](http://blog.codinghorror.com/properties-vs-public-variables/)的讨论感兴趣。恕我直言，这确实是对它的反应，为此，它很棒。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2008-08-13T07:09:06.127

是的，它*只是*保存代码。当您拥有大量它们时，阅读起来会更容易。它们编写起来更快，更容易维护。保存代码始终是一个好目标。

您可以设置不同的范围：

```
public string PropertyName { get; private set; } 
```

这样属性只能在类内部更改。这并不是真正不可变的，因为您仍然可以通过反射访问私有设置器。

从 C#6 开始，您还可以创建真正的`readonly`属性 - 即不能在构造函数之外更改的不可变属性：

```
public string PropertyName { get; }

public MyClass() { this.PropertyName = "whatever"; } 
```

在编译时将变为：

```
readonly string pName;
public string PropertyName { get { return this.pName; } }

public MyClass() { this.pName = "whatever"; } 
```

在具有大量成员的不可变类中，这可以节省大量多余的代码。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2008-08-12T23:13:33.543

使用字段而不是属性的三大缺点是：

1.  您不能对字段进行数据绑定，而可以对属性进行数据绑定
2.  如果您开始使用字段，则以后不能（轻松）将它们更改为属性
3.  有一些属性可以添加到属性中，但不能添加到字段中

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-10-08T11:21:40.680

来自 C++ 的创造者 Bjarne Stroustrup：

> 我特别不喜欢有很多 get 和 set 函数的类。这通常表明它最初不应该是一个类。它只是一个数据结构。如果它真的是一个数据结构，那就让它成为一个数据结构。

你知道吗？他是对的。您多久只是将私有字段包装在 get 和 set 中，而实际上在 get/set 中没有做任何事情，仅仅是因为它是“面向对象”的事情。这是微软对问题的解决方案；它们基本上是您可以绑定的公共字段。

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2008-08-12T23:13:15.790

我个人喜欢汽车属性。保存代码行有什么问题？如果您想在 getter 或 setter 中做一些事情，那么稍后将它们转换为普通属性是没有问题的。

正如您所说，您可以使用字段，如果您想稍后向它们添加逻辑，您可以将它们转换为属性。但这可能会出现任何使用反射的问题（可能还有其他地方？）。

此外，这些属性允许您为 getter 和 setter 设置不同的访问级别，这是您无法对字段执行的操作。

我想它与 var 关键字相同。个人喜好问题。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2008-08-27T18:04:14.293

似乎没有人提到的一件事是，不幸的是自动属性对不可变对象（通常是不可变结构）没有用处。因为为此你真的应该这样做：

```
private readonly string title;
public string Title
{
    get { return this.title; }
} 
```

（该字段在构造函数中通过传递的参数进行初始化，然后是只读的。）

`get`所以这比简单的/自动属性有优势`private set`。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-12-05T10:59:42.123

我总是创建属性而不是公共字段，因为您可以在接口定义中使用属性，但不能在接口定义中使用公共字段。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-08-18T00:27:08.307

与 C# 中的其他任何东西一样，自动属性都是一种黑魔法。一旦您从编译到 IL 的角度考虑它，而不是首先将其扩展为普通的 C# 属性，它就比许多其他语言结构少了很多黑魔法。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-08-12T23:22:07.147

我一直使用自动属性。在 C#3 之前，我不会为所有的输入而烦恼，而是使用公共变量。

我唯一想念的是能够做到这一点：

```
public string Name = "DefaultName"; 
```

您必须将默认值转移到具有属性的构造函数中。乏味:-(

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-08-13T00:14:48.897

我认为任何直观且减少代码行数的结构都是一大优势。

正是这些特性使得像 Ruby 这样的语言如此强大（动态特性也有助于减少多余的代码）。

Ruby 一直以来都是这样的：

```
attr_accessor :my_property
attr_reader :my_getter
attr_writer :my_setter 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-08-13T01:36:03.617

我对他们的唯一问题是他们走得不够远。同一版本的编译器添加了自动属性，添加了部分方法。为什么他们没有把两者放在一起是超出我的。一个简单的“部分 On<PropertyName>Changed”会让这些东西非常有用。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-07T08:06:44.653

它很简单，很短，如果你想在属性的主体内创建一个真正的实现，它不会破坏你的类型的外部接口。

就如此容易。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-08-17T22:40:15.170

这里需要注意的一点是，据我了解，这*只是*C# 3.0 端的语法糖，这意味着编译器生成的 IL 是相同的。我同意避免使用黑魔法，但同样的，同一件事的行数越少通常是一件好事。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-08-17T23:19:30.987

在我看来，您应该始终使用自动属性而不是公共字段。也就是说，这是一个折衷方案：

从使用属性命名约定的[内部](http://msdn.microsoft.com/en-us/library/7c5ka91b.aspx)字段开始。当你第一次

*   需要从其程序集外部访问该字段，或
*   需要将逻辑附加到 getter/setter

做这个：

1.  重命名字段
2.  将其设为私有
3.  添加公共属性

您的客户端代码不需要更改。

不过，总有一天，您的系统会发展壮大，您会将其分解为单独的程序集和多个解决方案。发生这种情况时，任何暴露的字段都会回来困扰您，因为正如 Jeff 所提到的，[将公共字段更改为公共属性是一个破坏性的 API 更改](http://blogs.msdn.com/abhinaba/archive/2006/04/11/572694.aspx)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-08-21T11:13:54.627

我使用 CodeRush，它比自动属性更快。

去做这个：

```
 private string title;
public string Title
{
    get { return title;  }
    set { title = value;  }
} 
```

总共需要八次击键。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-08-26T09:01:06.933

好吧，使用代码片段，同名的自动属性总共将是七次击键；）

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-08-30T11:59:37.067

@Domenic：我不明白..你不能用自动属性做到这一点吗？：

```
public string Title { get; } 
```

或者

```
public string Title { get; private set; } 
```

这是你指的吗？

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-05T10:24:51.333

我对自动属性最大的抱怨是它们旨在节省时间，但我经常发现我必须稍后将它们扩展为完整的属性。

VS2008 缺少的是**Explode Auto-Property**重构。

我们有一个**封装字段**重构的事实使我的工作方式更快，只使用公共字段。

# c# - 在 Windows 窗体设计器中加载窗体时出现“找不到类型”错误

> ID：9314
> 
> 赞同：41
> 
> 时间：2008-08-12T23:17:00.540
> 
> 标签：c#, .net, winforms, visual-studio-2008, visual-studio-2005

我有一个 .NET 2.0 windows 窗体应用程序，它大量使用了`ListView`控件。

我已经将该类子`ListView`类化为一个模板`SortableListView<T>`类，因此它可以更智能地显示事物并自行排序。

不幸的是，这似乎破坏了 VS2005 和 2008 中的 Visual Studio Forms Designer。

该程序编译并运行良好，但是当我尝试在设计器中查看拥有表单时，出现以下错误：

*   找不到类型“MyApp.Controls.SortableListView”。请确保引用了包含此类型的程序集。如果此类型是您的开发项目的一部分，请确保该项目已成功构建。

没有可用于此错误的堆栈跟踪或错误行信息

*   变量“listViewImages”要么未声明，要么从未分配。

在 MyApp.Main.Designer.cs 行：XYZ 列：1

```
Call stack:
at System.ComponentModel.Design.Serialization.CodeDomSerializerBase.Error(IDesignerSerializationManager manager, String exceptionText, String helpLink)
at System.ComponentModel.Design.Serialization.CodeDomSerializerBase.DeserializeExpression(IDesignerSerializationManager manager, String name, CodeExpression expression)
at System.ComponentModel.Design.Serialization.CodeDomSerializerBase.DeserializeExpression(IDesignerSerializationManager manager, String name, CodeExpression expression)
at System.ComponentModel.Design.Serialization.CodeDomSerializerBase.DeserializeStatement(IDesignerSerializationManager manager, CodeStatement statement) 
```

有问题的代码行是它实际添加到表单的位置，并且是

```
this.imagesTab.Controls.Add( this.listViewImages ); 
```

listViewImages 被声明为

```
private MyApp.Controls.SortableListView<Image> listViewImages; 
```

并在方法中实例化`InitializeComponent`如下：

```
this.listViewImages = new MyApp.Controls.SortableListView<Image>(); 
```

如前所述，程序编译和运行完美，我尝试将`SortableListView`类移出单独的程序集，以便可以单独编译，但这没有什么区别。

我不知道从这里去哪里。任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2015-11-18T03:57:57.490

由于 x86 / x64 架构，它发生在我身上。

由于 Visual Studio（开发工具本身）没有 x64 版本，因此无法将 x64 控件加载到 GUI 设计器中。

最好的方法可能是在 x86 下调整 GUI，并在必要时为 x64 编译它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-13T01:23:58.633

> 添加列表视图时，是否将其添加到工具箱中，然后将其添加到表单中？

不，我只是编辑`Main.Designer.cs`并将其`System.Windows.Forms.ListView`从`MyApp.Controls.SortableListView<Image>`

怀疑这可能是由于泛型导致我真正找到了解决方案。

对于我需要为其创建 SortableListView 的每个类，我定义了一个像这样的“存根类”

```
class ImagesListView : SortableListView<Image> { } 
```

然后使`Main.Designer.cs`文件引用这些存根类而不是`SortableListView`.

它现在有效，万岁！

值得庆幸的是，我能够做到这一点，因为我的所有类型都是预先知道的，而且我只是将`SortableListView`用作减少重复代码的一种方法。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-12T23:33:06.670

过去我遇到过这样的问题（虽然不一样），我的控件与我的表单位于不同的命名空间中，即使它位于同一个项目中。要修复它，我必须添加一个

```
using My.Other.Namespace; 
```

到设计器生成的代码文件的顶部。令人讨厌的是，当设计师重新生成页面时，它一直被吹走。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-08-30T23:15:52.733

我也遇到了这个问题，与在 *.Designer.cs 文件中合并大量 SVN 更改（有冲突）有关。解决方案是仅以图形方式打开设计视图，编辑控件（将其向左然后向右移动）并重新保存设计。*.Designer.cs 文件神奇地改变了，警告在下一次编译时消失了。

需要明确的是，您需要首先修复所有代码合并问题。这只是强制 VS 重新加载它们的解决方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-13T00:22:44.417

包含 MyApp.Controls.SortableListView 的程序集没有安装在 GAC 中，是吗？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-13T01:07:15.857

添加列表视图时，是否将其添加到工具箱中，然后将其添加到表单中？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-07-31T21:02:30.597

也许你忘了补充：

```
 /// <summary>
    /// Required designer variable.
    /// </summary>
    private System.ComponentModel.IContainer components = null;

    /// <summary>
    /// Release all resources used.
    /// </summary>
    /// <param name="disposing">true if managed resources should be removed otherwise; false.</param>
    protected override void Dispose(bool disposing)
    {
        if (disposing && (components != null))
        {
            components.Dispose();
        }
        base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
        // ...
        this.components = new System.ComponentModel.Container(); // Not necessarily, if You do not use
        // ...
    } 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-02-03T08:41:03.087

我曾经也有过一样的问题。删除我自己对 *.Designer.cs-File 的一些控件后，问题就解决了。回到原始代码后，问题仍然得到解决。所以这似乎是Visual Sudio缓存的问题。目前我无法重现此问题。

如果您有问题，请尝试清空文件夹

C:\Users\YOURNAME\AppData\Local\Microsoft\VisualStudio\VERSION\Designer\ShadowCache

它奏效了吗？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-08-18T10:52:14.873

我有类似的东西 - 用户控件指的是远程服务（我不能保证在设计时可用）。

[MSDN 上的这篇文章](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/6d3147b0-8343-44aa-a191-f0e58b96c7ea)建议我添加

```
if (this.DesignMode) return; 
```

到控件的加载功能，或者在我的情况下到初始化 WCF 客户端之前的点。那成功了。

所以

```
private readonly Client _client = new Client(); 
```

变成

```
private Client _client;

public new void Load()
{
    if(DesignMode) return;
    _client = new Client();
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-11-19T11:48:09.927

我遇到过同样的问题。在我的情况下，这个问题是由于资源初始化造成的。我将以下代码从`InitializeComponent`方法移动到 ctor（调用后`InitializeComponent`）。之后，此问题得到解决：

```
this->resources = (gcnew System::ComponentModel::ComponentResourceManager(XXX::typeid)); 
```

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2013-10-17T13:59:44.847

就我而言，问题是我项目的文件夹名称！为什么我这么认为：我使用 SVN 并且在 'trunk\SGIMovel' 中完美运行。但是在名为“OS#125\SGIMovel”的分支文件夹中，我无法打开使用自定义控件并在主干文件夹中工作的表单的设计器。

只需下车 # 并且效果很好。

# c++ - 如何在 C++ 中创建静态类？

> ID：9321
> 
> 赞同：300
> 
> 时间：2008-08-12T23:35:00.613
> 
> 标签：c++, oop, class, syntax, static

如何在 C++ 中创建静态类？我应该能够做类似的事情：

```
cout << "bit 5 is " << BitParser::getBitAt(buffer, 5) << endl; 
```

假设我创建了这个`BitParser`类。`BitParser`类定义会是什么样子？

* * *

## 回答 #1

> 赞同：316
> 
> 时间：2008-08-12T23:43:37.773

如果您正在寻找一种将“静态”关键字应用于类的方法，例如您可以在 C# 中使用，那么您将无法不使用托管 C++。

但是您的示例看起来，您只需要在您的 BitParser 对象上创建一个公共静态方法。像这样：

**位解析器.h**

```
class BitParser
{
 public:
  static bool getBitAt(int buffer, int bitIndex);

  // ...lots of great stuff

 private:
  // Disallow creating an instance of this object
  BitParser() {}
}; 
```

**位解析器.cpp**

```
bool BitParser::getBitAt(int buffer, int bitIndex)
{
  bool isBitSet = false;
  // .. determine if bit is set
  return isBitSet;
} 
```

您可以使用此代码以与示例代码相同的方式调用该方法。

* * *

## 回答 #2

> 赞同：271
> 
> 时间：2008-09-21T22:55:43.297

考虑[马特普莱斯的解决方案](https://stackoverflow.com/questions/9321/how-do-you-create-a-static-class-in-c/9348#9348)。

1.  在 C++ 中，“静态类”没有任何意义。最接近的是只有静态方法和成员的类。
2.  使用静态方法只会限制你。

你想要的是，用 C++ 语义表达，把你的函数（因为它**是**一个函数）放在一个命名空间中。

## 编辑 2011-11-11

C++ 中没有“静态类”。最接近的概念是只有静态方法的类。例如：

```
// header
class MyClass
{
   public :
      static void myMethod() ;
} ;

// source
void MyClass::myMethod()
{
   // etc.
} 
```

但是您必须记住，“静态类”是类 Java 语言（例如 C#）中的 hack，它们不能具有非成员函数，因此它们必须将它们作为静态方法移动到类中。

在 C++ 中，您真正想要的是在命名空间中声明的非成员函数：

```
// header
namespace MyNamespace
{
   void myMethod() ;
}

// source
namespace MyNamespace
{
   void myMethod()
   {
      // etc.
   }
} 
```

### 这是为什么？

在 C++ 中，命名空间比“Java 静态方法”模式的类更强大，因为：

*   静态方法可以访问类私有符号
*   私有静态方法对每个人仍然可见（如果无法访问），这在一定程度上违反了封装
*   静态方法不能前向声明
*   类用户不能在不修改库头的情况下重载静态方法
*   没有什么比同一个命名空间中的（可能是朋友）非成员函数更好的静态方法可以完成的了
*   命名空间有自己的语义（可以组合，可以匿名等）
*   等等

结论：不要在 C++ 中复制/粘贴 Java/C# 的模式。在 Java/C# 中，该模式是强制性的。但在 C++ 中，这是不好的风格。

## 编辑 2010-06-10

有一个支持静态方法的论点，因为有时需要使用静态私有成员变量。

我有点不同意，如下所示：

### “静态私有成员”解决方案

```
// HPP

class Foo
{
   public :
      void barA() ;
   private :
      void barB() ;
      static std::string myGlobal ;
} ; 
```

首先，myGlobal 之所以称为 myGlobal，是因为它仍然是一个全局私有变量。看一下 CPP 的源代码将阐明：

```
// CPP
std::string Foo::myGlobal ; // You MUST declare it in a CPP

void Foo::barA()
{
   // I can access Foo::myGlobal
}

void Foo::barB()
{
   // I can access Foo::myGlobal, too
}

void barC()
{
   // I CAN'T access Foo::myGlobal !!!
} 
```

乍一看，从封装的角度来看，免费函数 barC 无法访问 Foo::myGlobal 似乎是一件好事……这很酷，因为查看 HPP 的人将无法（除非诉诸破坏）访问Foo::myGlobal。

但是如果你仔细观察，你会发现这是一个巨大的错误：不仅你的私有变量仍然必须在 HPP 中声明（因此，尽管是私有的，但对全世界都是可见的），而且你必须声明在同一个 HPP 中，所有（如在 ALL 中）功能将被授权访问它！！！！

所以**使用私人静态成员就像是裸体走在外面，皮肤上纹着你的爱人名单：没有人被授权触摸，但每个人都可以偷看。还有好处：每个人都可以拥有那些被授权与你的私人一起玩的人的名字。**

`private`确实... :-D

### “匿名命名空间”解决方案

匿名命名空间将具有使事物真正私有化的优势。

一、HPP头

```
// HPP

namespace Foo
{
   void barA() ;
} 
```

只是为了确保您说：没有 barB 和 myGlobal 的无用声明。这意味着没有人阅读标题知道 barA 后面隐藏了什么。

然后，CPP：

```
// CPP
namespace Foo
{
   namespace
   {
      std::string myGlobal ;

      void Foo::barB()
      {
         // I can access Foo::myGlobal
      }
   }

   void barA()
   {
      // I can access myGlobal, too
   }
}

void barC()
{
   // I STILL CAN'T access myGlobal !!!
} 
```

如您所见，就像所谓的“静态类”声明一样，fooA 和 fooB 仍然能够访问 myGlobal。但没有其他人可以。除了这个 CPP 之外，没有其他人知道 fooB 和 myGlobal 甚至存在！

**与在她的皮肤上纹身的地址簿裸体行走的“静态类”不同，“匿名”命名空间是全**包的，这似乎更好地封装了 AFAIK。

### 真的有关系吗？

除非您的代码的用户是破坏者（作为练习，我会让您找到如何使用肮脏的行为未定义的黑客访问公共类的私有部分......），即使它`private`是在标头中声明的类的部分中`private`可见。`private`

尽管如此，如果您需要添加另一个可以访问私有成员的“私有函数”，您仍然必须通过修改标头向全世界声明它，就我而言，这是一个悖论：**如果我更改我的代码（CPP 部分），那么接口（HPP 部分）不应该改变。**引用列奥尼达的话：“**这是封装！** ”

## 编辑 2014-09-20

什么时候类的静态方法实际上比具有非成员函数的命名空间更好？

当您需要将函数组合在一起并将该组提供给模板时：

```
namespace alpha
{
   void foo() ;
   void bar() ;
}

struct Beta
{
   static void foo() ;
   static void bar() ;
};

template <typename T>
struct Gamma
{
   void foobar()
   {
      T::foo() ;
      T::bar() ;
   }
};

Gamma<alpha> ga ; // compilation error
Gamma<Beta> gb ;  // ok
gb.foobar() ;     // ok !!! 
```

因为，如果一个类可以是模板参数，那么命名空间就不能。

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2008-08-13T00:26:43.740

您还可以在命名空间中创建自由函数：

在 BitParser.h 中

```
namespace BitParser
{
    bool getBitAt(int buffer, int bitIndex);
} 
```

在 BitParser.cpp 中

```
namespace BitParser
{
    bool getBitAt(int buffer, int bitIndex)
    {
        //get the bit :)
    }
} 
```

一般来说，这将是编写代码的首选方式。当不需要对象时，不要使用类。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-08-13T00:06:09.333

> 如果您正在寻找一种将“静态”关键字应用于类的方法，例如在 C# 中

静态类只是手握你并阻止你编写任何实例方法/变量的编译器。

如果您只是编写一个没有任何实例方法/变量的普通类，那是一样的，这就是您在 C++ 中所做的

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2015-07-03T08:22:19.150

**我可以写类似的东西`static class`吗？**

**不**，根据[C++11 N3337 标准草案](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf)附件 C 7.1.1：

> 更改：在 C++ 中，static 或 extern 说明符只能应用于对象或函数的名称。在 C++ 中将这些说明符与类型声明一起使用是非法的。在 C 中，这些说明符在用于类型声明时会被忽略。例子：
> 
> ```
> static struct S {    // valid C, invalid in C++
>   int i;
> }; 
> ```
> 
> 基本原理：存储类说明符在与类型关联时没有任何意义。在 C++ 中，可以使用静态存储类说明符声明类成员。在类型声明中允许存储类说明符可能会使代码让用户感到困惑。

和 like 一样`struct`，`class`也是一种类型声明。

通过遍历附录 A 中的语法树也可以推断出相同的结果。

有趣的是，这`static struct`在 C 中是合法的，但没有效果：[为什么以及何时在 C 编程中使用静态结构？](https://stackoverflow.com/questions/7259830/why-and-when-to-use-static-structures-in-c-programming)

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-08-12T23:43:34.840

在 C++ 中，您想创建一个类的静态函数（不是静态类）。

```
class BitParser {
public:
  ...
  static ... getBitAt(...) {
  }
}; 
```

然后，您应该能够使用 BitParser::getBitAt() 调用该函数，而无需实例化我认为是所需结果的对象。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2018-03-21T11:52:10.910

正如这里所指出的，在 C++ 中实现这一点的更好方法可能是使用命名空间。但是由于没有人在`final`这里提到这个关键字，我发布了一个直接等效`static class`于 C# 在 C++11 或更高版本中的样子：

```
class BitParser final
{
public:
  BitParser() = delete;

  static bool GetBitAt(int buffer, int pos);
};

bool BitParser::GetBitAt(int buffer, int pos)
{
  // your code
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-11-23T21:04:27.420

如前所述，您“可以”在 C++ 中拥有一个静态类，静态类是没有任何对象实例化它的类。在 C++ 中，这可以通过将构造函数/析构函数声明为私有来获得。最终结果是一样的。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-06-10T15:35:29.317

在托管 C++ 中，静态类语法是：-

```
public ref class BitParser abstract sealed
{
    public:
        static bool GetBitAt(...)
        {
            ...
        }
} 
```

... 迟到总比不到好...

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-01-29T06:34:41.467

与其他托管编程语言不同，“静态类”在 C++ 中没有任何意义。您可以使用静态成员函数。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-04-26T18:44:39.230

这类似于 C# 在 C++ 中的处理方式

在 C# file.cs 中，您可以在公共函数中拥有私有 var。当在另一个文件中时，您可以通过使用以下函数调用命名空间来使用它：

```
MyNamespace.Function(blah); 
```

以下是如何在 C++ 中实现相同的功能：

**共享模块.h**

```
class TheDataToBeHidden
{
  public:
    static int _var1;
    static int _var2;
};

namespace SharedData
{
  void SetError(const char *Message, const char *Title);
  void DisplayError(void);
} 
```

**共享模块.cpp**

```
//Init the data (Link error if not done)
int TheDataToBeHidden::_var1 = 0;
int TheDataToBeHidden::_var2 = 0;

//Implement the namespace
namespace SharedData
{
  void SetError(const char *Message, const char *Title)
  {
    //blah using TheDataToBeHidden::_var1, etc
  }

  void DisplayError(void)
  {
    //blah
  }
} 
```

* * *

**其他文件.h**

```
#include "SharedModule.h" 
```

**其他文件.cpp**

```
//Call the functions using the hidden variables
SharedData::SetError("Hello", "World");
SharedData::DisplayError(); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2020-05-06T01:52:19.243

一种（众多）替代方案，但（在我看来）最优雅（与使用命名空间和私有构造函数来模拟静态行为相比），在 C++ 中实现“无法实例化的类”行为的方法是使用`private`访问修饰符声明一个伪纯虚函数。

```
class Foo {
   public:
     static int someMethod(int someArg);

   private:
     virtual void __dummy() = 0;
}; 
```

`final`如果您使用的是 C++11，则可以通过使用类声明中的说明符来限制其他类继承它，从而确保该类不被继承（纯粹模拟静态类的行为）.

```
// C++11 ONLY
class Foo final {
   public:
     static int someMethod(int someArg);

   private:
      virtual void __dummy() = 0;
}; 
```

听起来很愚蠢和不合逻辑，C++11 允许声明“不能被覆盖的纯虚函数”，您可以在声明类的同时使用它`final`来纯粹和完全实现静态行为，因为这会导致结果类不能被继承，并且虚拟函数不能以任何方式被覆盖。

```
// C++11 ONLY
class Foo final {
   public:
     static int someMethod(int someArg);

   private:
     // Other private declarations

     virtual void __dummy() = 0 final;
}; // Foo now exhibits all the properties of a static class 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-04-25T07:47:11.330

命名空间对于实现“静态类”可能不是那么有用的一种情况是使用这些类来实现组合而不是继承。命名空间不能是类的朋友，因此不能访问类的私有成员。

```
class Class {
 public:
  void foo() { Static::bar(*this); }    

 private:
  int member{0};
  friend class Static;
};    

class Static {
 public:
  template <typename T>
  static void bar(T& t) {
    t.member = 1;
  }
}; 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-03-01T12:53:56.933

```
class A final {
  ~A() = delete;
  static bool your_func();
} 
```

`final`意味着一个类不能被继承。

`delete`对于析构函数意味着你不能创建这样一个类的实例。

这种模式也被称为“util”类。

正如许多人所说`static class`，C++ 中不存在的概念。

`namespace`在这种情况下，包含`static`首选作为解决方案的函数的规范。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-06-26T07:56:42.827

There is no such thing as a static class in C++. The closest approximation is a class that only contains static data members and static methods. Static data members in a class are shared by all the class objects as there is only one copy of them in memory, regardless of the number of objects of the class. A static method of a class can access all other static members ,static methods and methods outside the class

# .net - 即时生成站点地图

> ID：9336
> 
> 赞同：4
> 
> 时间：2008-08-13T00:01:11.780
> 
> 标签：.net, asp.net, sitemap

我正在尝试为特定的 asp.net 网站动态生成 sitemap.xml。

我找到了几个解决方案：

1.  [奇努克网](http://sitemap.chinookwebs.com/)
2.  [cervoproject](http://web.archive.org/web/20080307061444/http://www.cervoproject.info:80/sitemaps.aspx)
3.  [牛顿](http://www.codeplex.com/Sitemaps)

Chinookwebs 运行良好，但现在似乎有点不活跃，并且无法个性化每个页面的“priority”和“changefreq”标签，它们都从配置文件中继承相同的值。

你们使用什么解决方案？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-13T07:19:07.713

通常你会为此使用[HTTP 处理](http://www.google.com/search?q=HTTPHandler+ASP.NET&spell=1)程序。鉴于请求...

> [http://www.yoursite.com/sitemap.axd](http://www.yoursite.com/sitemap.axd)

...您的处理程序将使用格式化的 XML 站点地图进行响应。该站点地图是动态生成的，还是从数据库生成的，还是其他方法取决于 HTTP 处理程序的实现。

这大概是它的样子：

```
void IHttpHandler.ProcessRequest(HttpContext context)
{
    //
    // Important to return qualified XML (text/xml) for sitemaps
    //
    context.Response.ClearHeaders();
    context.Response.ClearContent();
    context.Response.ContentType = "text/xml";
    //
    // Create an XML writer
    //
    XmlTextWriter writer = new XmlTextWriter(context.Response.Output);
    writer.WriteStartDocument();
    writer.WriteStartElement("urlset", "http://www.sitemaps.org/schemas/sitemap/0.9");
    //
    // Now add entries for individual pages..
    //
    writer.WriteStartElement("url");
    writer.WriteElementString("loc", "http://www.codingthewheel.com");
    // use W3 date format..
    writer.WriteElementString("lastmod", postDate.ToString("yyyy-MM-dd"));
    writer.WriteElementString("changefreq", "daily");
    writer.WriteElementString("priority", "1.0");
    writer.WriteEndElement();
    //
    // Close everything out and go home.
    //
    result.WriteEndElement();
    result.WriteEndDocument();
    writer.Flush();
} 
```

这段代码可以改进，但这是基本思想。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-13T00:48:30.373

用于生成站点地图的自定义处理程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-13T01:12:17.970

使用 ASP.NET MVC 只需使用 .NET XML 生成库快速生成一些代码，然后将其传递给具有 XML 控件的视图页面。在代码隐藏中，我将控件与 ViewData 绑定在一起。这似乎覆盖了视图页面的默认行为以呈现不同的标题。

# monitoring - 质量控制/日志监控

> ID：9338
> 
> 赞同：2
> 
> 时间：2008-08-13T00:01:56.800
> 
> 标签：monitoring, logging

我最近真正喜欢阅读的一篇文章是[Last.FM 的质量控制](http://blog.last.fm/2008/08/01/quality-control)。本着这篇文章的精神，我想知道是否有其他人对 Web 类型的应用程序有最喜欢的监控设置。或者，如果您不相信日志监控，为什么？
我想我在这里寻找一种混合的意见斜线体验。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-13T01:04:19.013

我们从较旧的主机/应用程序/网络监控环境中收到一堆电子邮件/寻呼机警报，这些警报会根据问题的严重性/响应时间而逐渐变得更加滥用。幸运的是，我们都有厚脸皮和非常广泛的幽默感。:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-13T01:07:02.957

我们使用 log4net，通常同时写入日志文件和数据库。但是，当我们一直在追踪一个特别困难的问题时，我们启用了电子邮件附加程序，以便关键日志消息直接发送到开发人员的电子邮件帐户。这使我们能够更直接地弄清楚发生了什么。

此外，我们的基础架构团队有多种工具用于监控系统正常运行时间、事件日志等，以便在即将出现问题时向他们提供预警。我们还帮助他们实现了自定义监控脚本，以测试我们代码的特定功能。

# asp.net - 设置控件的选定值后运行 Javascript

> ID：9341
> 
> 赞同：12
> 
> 时间：2008-08-13T00:11:03.863
> 
> 标签：asp.net, javascript

简单的 ASP.NET 应用程序。

我有两个下拉控件。在第一个下拉菜单中，我有一个 JavaScript`onChange`事件。JavaScript 启用第二个下拉菜单并从中删除一个值（在第一个下拉菜单中选择的值）。如果他们单击下拉列表的第一个空白值，则第二个下拉列表将被禁用（并且选项重置）。

我在方法中也有代码，`OnPreRender`可以根据第一个下拉列表的值启用或禁用第二个下拉列表。这样可以在代码中选择第一个下拉列表的值（加载用户设置）。

我的问题是：

1.  用户在第一个下拉列表中选择了一些东西。第二个下拉菜单将通过 JavaScript 启用。
2.  然后，他们更改了启动回发的第三个下拉菜单。回发后，下拉菜单处于正确状态（选择第一个值，启用第二个下拉菜单）。
3.  如果他们然后单击后退按钮，则将不再启用第二个下拉菜单，尽管它应该启用，因为在第一个下拉菜单中选择了某些内容。

我已经尝试通过添加一个启动脚本（它将设置第二个下拉菜单的正确状态）`ClientScript.RegisterStartupScript`，但是当它被调用时，第一个下拉菜单有一个`selectedIndex`of `0`，而不是它实际上是什么。我的猜测是在我的启动脚本之后设置了选择的值（但仍然不调用`onChange`脚本）。

关于尝试什么的任何想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-13T00:16:51.233

如果第二个下拉菜单最初是通过 javascript 启用的（我假设这是在 javascript onchange 期间，因为您没有指定），那么单击后退按钮重新加载上一个回发将永远不会启用它。

将 ASP.NET 与经典 javascript 混合起来可能很麻烦。您可能想看看 ASP.NET 的 Ajax 实现（或者如果您被迫使用较旧的 ASP.NET 版本，则可以查看第三方 AjaxPanel 控件）。这些将通过纯 C# 为您提供您想要的行为，而不会强迫您诉诸 javascripthackery-pokery。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-13T00:53:34.077

```
<%@ Page Language="C#" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<script runat="server">
    protected void indexChanged(object sender, EventArgs e)
    {
        Label1.Text = " I did something! ";
    }
</script>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Test Page</title>
</head>
<body>
    <script type="text/javascript">
        function firstChanged() {
            if(document.getElementById("firstSelect").selectedIndex != 0)
                document.getElementById("secondSelect").disabled = false;
            else
                document.getElementById("secondSelect").disabled = true;
        }
    </script>
    <form id="form1" runat="server">
    <div>
        <select id="firstSelect" onchange="firstChanged()">
            <option value="0"></option>
            <option value="1">One</option>
            <option value="2">Two</option>
            <option value="3">Three</option>
        </select>
        <select id="secondSelect" disabled="disabled">
            <option value="1">One</option>
            <option value="2">Two</option>
            <option value="3">Three</option>
        </select>
        <asp:DropDownList ID="DropDownList1" AutoPostBack="true" OnSelectedIndexChanged="indexChanged" runat="server">
            <asp:ListItem Text="One" Value="1"></asp:ListItem>
            <asp:ListItem Text="Two" Value="2"></asp:ListItem>    
        </asp:DropDownList>
        <asp:Label ID="Label1" runat="server"></asp:Label>
    </div>
    </form>
    <script type="text/javascript">
        window.onload = function() {firstChanged();}
    </script>
</body>
</html> 
```

编辑：替换了整个代码。即使在您的用户控件中，这也应该有效。我相信 Register.ClientScriptBlock 不起作用，因为您在该块中编写的代码是在调用 window.onload*之前执行的。*而且，我假设（我不确定这一点）DOM 对象当时没有设置它们的值。而且，这就是为什么您总是得到 selectedIndex 0。

# windows - 以编程方式在 Windows 资源管理器中选择多个文件

> ID：9355
> 
> 赞同：23
> 
> 时间：2008-08-13T00:35:50.977
> 
> 标签：windows, explorer, windows-shell

我可以像这样在 Windows 资源管理器中显示和选择单个文件：

```
explorer.exe /select, "c:\path\to\file.txt" 
```

但是，我不知道如何选择多个文件。我尝试过的选择的排列都没有。

注意：我查看了这些页面的文档，都没有帮助。

[https://support.microsoft.com/kb/314853](https://support.microsoft.com/kb/314853)
[http://web.archive.org/web/20100716112458/http://www.infocellar.com:80/Win98/explorer-switches.htm](http://web.archive.org/web/20100716112458/http://www.infocellar.com:80/Win98/explorer-switches.htm)

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-06-10T02:36:47.240

这应该可以通过 shell 函数实现[`SHOpenFolderAndSelectItems`](http://msdn.microsoft.com/en-us/library/bb762232(VS.85).aspx)

**编辑**

下面是一些示例代码，展示了如何在 C/C++ 中使用该函数，而无需进行错误检查：

```
//Directory to open
ITEMIDLIST *dir = ILCreateFromPath(_T("C:\\"));

//Items in directory to select
ITEMIDLIST *item1 = ILCreateFromPath(_T("C:\\Program Files\\"));
ITEMIDLIST *item2 = ILCreateFromPath(_T("C:\\Windows\\"));
const ITEMIDLIST* selection[] = {item1,item2};
UINT count = sizeof(selection) / sizeof(ITEMIDLIST);

//Perform selection
SHOpenFolderAndSelectItems(dir, count, selection, 0);

//Free resources
ILFree(dir);
ILFree(item1);
ILFree(item2); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-08-26T15:02:26.137

在资源管理器中选择多个文件的真正方法是下一个

非托管代码看起来像这样（从中国代码帖子编译并修复其错误）

```
static class NativeMethods
{
    [DllImport("shell32.dll", ExactSpelling = true)]
    public static extern int SHOpenFolderAndSelectItems(
        IntPtr pidlFolder,
        uint cidl,
        [In, MarshalAs(UnmanagedType.LPArray)] IntPtr[] apidl,
        uint dwFlags);

    [DllImport("shell32.dll", CharSet = CharSet.Auto)]
    public static extern IntPtr ILCreateFromPath([MarshalAs(UnmanagedType.LPTStr)] string pszPath);

    [ComImport]
    [InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
    [Guid("000214F9-0000-0000-C000-000000000046")]
    public interface IShellLinkW
    {
        [PreserveSig]
        int GetPath(StringBuilder pszFile, int cch, [In, Out] ref WIN32_FIND_DATAW pfd, uint fFlags);

        [PreserveSig]
        int GetIDList([Out] out IntPtr ppidl);

        [PreserveSig]
        int SetIDList([In] ref IntPtr pidl);

        [PreserveSig]
        int GetDescription(StringBuilder pszName, int cch);

        [PreserveSig]
        int SetDescription([MarshalAs(UnmanagedType.LPWStr)] string pszName);

        [PreserveSig]
        int GetWorkingDirectory(StringBuilder pszDir, int cch);

        [PreserveSig]
        int SetWorkingDirectory([MarshalAs(UnmanagedType.LPWStr)] string pszDir);

        [PreserveSig]
        int GetArguments(StringBuilder pszArgs, int cch);

        [PreserveSig]
        int SetArguments([MarshalAs(UnmanagedType.LPWStr)] string pszArgs);

        [PreserveSig]
        int GetHotkey([Out] out ushort pwHotkey);

        [PreserveSig]
        int SetHotkey(ushort wHotkey);

        [PreserveSig]
        int GetShowCmd([Out] out int piShowCmd);

        [PreserveSig]
        int SetShowCmd(int iShowCmd);

        [PreserveSig]
        int GetIconLocation(StringBuilder pszIconPath, int cch, [Out] out int piIcon);

        [PreserveSig]
        int SetIconLocation([MarshalAs(UnmanagedType.LPWStr)] string pszIconPath, int iIcon);

        [PreserveSig]
        int SetRelativePath([MarshalAs(UnmanagedType.LPWStr)] string pszPathRel, uint dwReserved);

        [PreserveSig]
        int Resolve(IntPtr hwnd, uint fFlags);

        [PreserveSig]
        int SetPath([MarshalAs(UnmanagedType.LPWStr)] string pszFile);
    }

    [Serializable, StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode), BestFitMapping(false)]
    public struct WIN32_FIND_DATAW
    {
        public uint dwFileAttributes;
        public FILETIME ftCreationTime;
        public FILETIME ftLastAccessTime;
        public FILETIME ftLastWriteTime;
        public uint nFileSizeHigh;
        public uint nFileSizeLow;
        public uint dwReserved0;
        public uint dwReserved1;

        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)]
        public string cFileName;

        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 14)]
        public string cAlternateFileName;
    }

    public static void OpenFolderAndSelectFiles(string folder, params string[] filesToSelect)
    {
        IntPtr dir = ILCreateFromPath(folder);

        var filesToSelectIntPtrs = new IntPtr[filesToSelect.Length];
        for (int i = 0; i < filesToSelect.Length; i++)
        {
            filesToSelectIntPtrs[i] = ILCreateFromPath(filesToSelect[i]);
        }

        SHOpenFolderAndSelectItems(dir, (uint) filesToSelect.Length, filesToSelectIntPtrs, 0);
        ReleaseComObject(dir);
        ReleaseComObject(filesToSelectIntPtrs);
    }

    private static void ReleaseComObject(params object[] comObjs)
    {
        foreach (object obj in comObjs)
        {
            if (obj != null && Marshal.IsComObject(obj))
                Marshal.ReleaseComObject(obj);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-13T00:47:43.337

无法通过 explorer.exe 完成

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-13T05:56:33.527

根据您实际想要完成的任务，您可以使用[AutoHotKey](http://www.autohotkey.com/)来完成。这是一个了不起的免费工具，可以自动完成您通常无法完成的事情。它应该随 Windows 一起提供。当您按 F12 时，此脚本将选择您的文件并突出显示其下方的下两个文件。

```
F12:: 
 run explorer.exe /select`, "c:\path\to\file.txt"
 SendInput {Shift Down}{Down}{Down}{Shift Up}
return 
```

也可以将这两个中间行放在一个文本文件中，然后将其作为参数传递给 autohotkey.exe。他们还可以选择编译脚本，这将使其成为您可以调用的独立 exe。与一个很好的帮助文件一起工作很好。

@Orion，可以使用 C# 中的自动热键。您可以将自动热键脚本制作成可以由您的 C# 应用程序启动的独立可执行文件（大约 400k）（就像您启动资源管理器的方式一样）。您也可以将命令行参数传递给它。它没有任何运行时要求。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-17T20:52:22.750

> 这是考虑您要实现的目标以及是否有更好的方法可能会很好的问题之一。

添加更多上下文 - 我们公司开发了一个 C# 客户端应用程序，它允许用户加载文件并对其进行处理，有点像 iTunes 如何管理您的 MP3 文件而不向您显示磁盘上的实际文件。

在应用程序中选择一个文件并执行“在 Windows 资源管理器中显示此文件”命令很有用 - 这就是我想要实现的目标，并且已经为单个文件这样做了。

我们有一个 ListView，它允许用户在应用程序中选择多个文件，并移动/删除/等它们。让这个“在 Windows 中显示这个文件”命令适用于多个选定文件会很好 - 至少如果所有源文件都在同一个目录中，但如果不可能，那么它不是主要功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-24T11:17:33.477

我想您可以使用`FindWindowEx`获取 Windows Explorer 的 SysListView32，然后使用`SendMessage`with`LVM_SETITEMSTATE`选择项目。难点是要知道物品的位置……或许`LVM_FINDITEM`可以用这个。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-03T23:48:47.657

Grr 我也想这样做。当您选择 2+ 个文件并右键单击并执行“打开文件位置”时，媒体播放器会执行此操作，但不确定如何（我也不想花时间与 procmon 一起弄清楚）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-12-29T05:51:52.707

有 COM 自动化 LateBinding IDispatch 接口，这些接口很容易从 PowerShell、Visual Basic.NET 和 C# 中使用，一些示例代码：

```
$shell = New-Object -ComObject Shell.Application

function SelectFiles($filesToSelect)
{
    foreach ($fileToSelect in $filesToSelect)
    {
        foreach ($window in $shell.Windows())
        {
            foreach ($folderItem in $window.Document.Folder.Items())
            {
                if ($folderItem.Path -eq $fileToSelect)
                {
                    $window.Document.SelectItem($folderItem, 1 + 8)
                }
            }
        }
    }
} 
```

-

```
Option Strict Off

Imports Microsoft.VisualBasic

Public Class ExplorerHelp
    Shared ShellApp As Object = CreateObject("Shell.Application")

    Shared Sub SelectFile(filepath As String)
        For Each i In ShellApp.Windows
            For Each i2 In i.Document.Folder.Items()
                If i2.Path = filepath Then
                    i.Document.SelectItem(i2, 1 + 8)
                    Exit Sub
                End If
            Next
        Next
    End Sub
End Class 
```

[https://docs.microsoft.com/en-us/windows/win32/shell/shellfolderview-selectitem](https://docs.microsoft.com/en-us/windows/win32/shell/shellfolderview-selectitem)

# java - ICE Faces fileInput 文件路径和文件名属性

> ID：9361
> 
> 赞同：5
> 
> 时间：2008-08-13T00:49:17.360
> 
> 标签：java, ajax, jsf, icefaces

我想利用 ICE Faces fileInput 控件根据用户选择的文件填写文件路径和文件名，以输入到网页上的输入字段。如何在不实际执行任何文件传输操作的情况下捕获这些属性？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-08-19T18:09:44.513

我相信真正的答案是你不能。出于安全原因，浏览器不会发送文件路径。文件名将被发送，但我不相信它会在没有实际上传的情况下发送。

afaik，您最接近的方法是在上传开始时强行终止连接。这将使您获得几乎没有实际传输数据的文件名，但这听起来对您没有用处。

或者，一个签名的 Java 小程序可能会让您更接近您想要的解决方案。

# http - 如何防止 IIS7 丢弃我的 cookie？

> ID：9372
> 
> 赞同：6
> 
> 时间：2008-08-13T01:02:27.507
> 
> 标签：http, iis, iis-7, cookies, windows-vista

我正在使用带有 SP1 的 Windows Vista x64，并且正在开发一个以 IIS7 作为 Web 服务器的 ASP.NET 应用程序。我遇到了一个问题，我的 cookie 没有“粘”到会话中，所以我有一个谷歌，发现有一个已知问题，即重复响应标头被覆盖而不是被添加到会话中。然而，这个问题本应在 Vista 的 Service Pack 1 中得到修复。

关于我的麻烦可能是什么的任何想法？

* * *

我正在使用集成应用程序池，并且工作进程的最大数量 == 1。

下划线有什么意义？它在 URL 中的位置是否重要（例如，它是否在主机名中很重要，但如果它在查询字符串中则无关紧要）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-13T01:09:00.033

只是一个想法，你的网址中有下划线吗？例如[http://my_site](http://my_site)？

还有一件事，你不是在网络花园模式下运行应用程序池吗？即进程模型 -> 最大工作进程：> 1

您使用的是哪种类型的应用程序池 - 集成模式还是经典模式？

# c# - ILMerge 最佳实践

> ID：9376
> 
> 赞同：72
> 
> 时间：2008-08-13T01:05:47.250
> 
> 标签：c#, .net, deployment, ilmerge

你使用 ILMerge 吗？您是否使用 ILMerge 合并多个程序集以简化 dll 的部署？在 ILMerging 程序集在一起之后，您是否发现生产中的部署/版本控制问题？

我正在寻找一些关于使用 ILMerge 减少部署摩擦的建议，如果这可能的话。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-08-29T06:00:05.953

我将 ILMerge 用于几乎所有不同的应用程序。我将它直接集成到发布构建过程中，所以我最终得到的是每个应用程序一个 exe，没有额外的 dll。

您不能 ILMerge 任何具有本机代码的 C++ 程序集。您也不能 ILMerge 任何包含 WPF 的 XAML 的程序集（至少我没有取得任何成功）。它在运行时抱怨找不到资源。

我确实为 ILMerge 编写了一个包装器可执行文件，其中我传递了我想要合并的项目的启动 exe 名称和一个输出 exe 名称，然后它反映了依赖程序集并使用适当的命令行参数调用 ILMerge。现在，当我向项目添加新程序集时要容易得多，我不必记住更新构建脚本。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2012-03-20T10:23:38.600

## 介绍

这篇文章展示了如何`.exe + .dll files`用一个`combined .exe`. 它还保持调试`.pdb`文件完好无损。

## 对于控制台应用程序

以下是`Post Build String`使用 .NET 4.0 的 Visual Studio 2010 SP1 的基础知识。我正在构建一个包含所有 sub-.dll 文件的控制台 .exe。

```
"$(SolutionDir)ILMerge\ILMerge.exe" /out:"$(TargetDir)$(TargetName).all.exe" "$(TargetDir)$(TargetName).exe" "$(TargetDir)*.dll" /target:exe /targetplatform:v4,C:\Windows\Microsoft.NET\Framework64\v4.0.30319 /wildcards 
```

## 基本提示

*   输出是一个文件“ `AssemblyName.all.exe`”，它将所有子 dll 组合成一个 .exe。
*   注意`ILMerge\`目录。您需要将 ILMerge 实用程序复制到您的解决方案目录中（这样您就可以分发源代码而不必担心记录 ILMerge 的安装），或者更改此路径以指向 ILMerge.exe 所在的位置。

## 高级提示

如果您遇到无法正常工作的问题，请打开`Output`并选择`Show output from: Build`。检查 Visual Studio 实际生成的确切命令，并检查错误。

# 示例构建脚本

此脚本将所有替换`.exe + .dll files`为单个`combined .exe`. 它还保持调试 .pdb 文件完好无损。

要使用，请将其粘贴到您的`Post Build`步骤中，在`Build Events`C# 项目的选项卡下，并确保将第一行中的路径调整为指向`ILMerge.exe`：

```
rem Create a single .exe that combines the root .exe and all subassemblies.
"$(SolutionDir)ILMerge\ILMerge.exe" /out:"$(TargetDir)$(TargetName).all.exe" "$(TargetDir)$(TargetName).exe" "$(TargetDir)*.dll" /target:exe /targetplatform:v4,C:\Windows\Microsoft.NET\Framework64\v4.0.30319 /wildcards
rem Remove all subassemblies.
del *.dll
rem Remove all .pdb files (except the new, combined pdb we just created).
ren "$(TargetDir)$(TargetName).all.pdb" "$(TargetName).all.pdb.temp"
del *.pdb
ren "$(TargetDir)$(TargetName).all.pdb.temp" "$(TargetName).all.pdb"
rem Delete the original, non-combined .exe.
del "$(TargetDir)$(TargetName).exe"
rem Rename the combined .exe and .pdb to the original project name we started with.
ren "$(TargetDir)$(TargetName).all.pdb" "$(TargetName).pdb"
ren "$(TargetDir)$(TargetName).all.exe" "$(TargetName).exe"
exit 0 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-08-14T13:00:50.343

我们在 Microsoft 应用程序块上使用 ILMerge - 而不是 12 个单独的 DLL 文件，我们有一个可以上传到客户区域的文件，而且文件系统结构更加整洁。

合并文件后，我必须编辑visual studio项目列表，删除12个单独的程序集并添加单个文件作为参考，否则它会抱怨找不到特定的程序集。我不太确定这将如何在后期部署中发挥作用，但值得一试。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-11-03T01:53:42.290

我知道这是一个老问题，但我们不仅使用 ILMerge 来减少依赖项的数量，而且还内化了实用程序使用的“内部”依赖项（例如 automapper、restsharp 等）。这意味着它们被完全抽象出来，使用合并实用程序的项目不需要知道它们。这再次减少了项目中所需的引用，并允许它在需要时使用/更新同一外部库的自己的版本。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-13T04:31:44.323

我们在很多项目中使用 ILMerge。例如，[Web Service Software Factory](http://www.codeplex.com/servicefactory)会生成 8 个程序集作为其输出。我们将所有这些 DLL 合并到一个 DLL 中，以便服务主机只需引用一个 DLL。

它使生活变得更轻松，但这也不是什么大问题。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-04-13T14:16:48.253

我们在组合 WPF 依赖项时遇到了同样的问题.... ILMerge 似乎没有处理这些问题。然而，Costura.Fody 为我们工作得非常好，花了大约 5 分钟才开始……一次非常好的体验。

只需使用 Nuget 安装（在包管理器控制台中选择正确的默认项目）。它将自己引入目标项目，默认设置立即为我们工作。

它合并所有标记为“Copy Local”= true 的 DLL，并生成一个合并的 .EXE（与标准输出一起），它的大小被很好地压缩（远小于总输出大小）。

许可证是 MIT，因此您可以根据需要修改/分发。

[https://github.com/Fody/Costura/](https://github.com/Fody/Costura/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-02-28T13:36:45.647

请注意，对于 Windows GUI 程序（例如 WinForms），您需要使用 /target: **winexe**开关。
/target: **exe**开关创建一个合并的*控制台*应用程序。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-04-29T18:29:33.227

我刚刚开始使用 ILMerge 作为我的 CI 构建的一部分，将许多细粒度的 WCF 合同组合到一个库中。它工作得很好，但是新合并的库不能轻易地与其组件库或依赖于这些组件库的其他库共存。

如果在一个新项目中，您既引用了 ILMerged 库，又引用了依赖于您提供给 ILMerge 的输入之一的旧库，您会发现无法将 ILMerged 库中的任何类型传递给遗留库而不进行某种类型映射（例如自动映射器或手动映射）。这是因为一旦所有内容都编译完毕，类型就会有效地使用程序集名称进行限定。

名称也会发生冲突，但您可以使用[extern alias](https://blogs.msdn.microsoft.com/ansonh/2006/09/27/extern-alias-walkthrough/)修复它。

除非您确定您的合并程序集不会也永远不会依赖于同一库的独立版本。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-08-19T11:43:20.800

在合并具有相同命名空间中的资源的 DLL 时，我们遇到了问题。在合并过程中，资源名称空间之一被重命名，因此无法找到资源。也许我们只是在那里做错了什么，仍在调查这个问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-14T13:04:08.620

我们刚刚开始在我们的解决方案中使用 ILMerge，这些解决方案在我们的其他项目中重新分发和使用，到目前为止效果很好。一切似乎都正常。我们甚至直接混淆了打包的程序集。

我们正在考虑对 MS 企业库程序集执行相同的操作。

我看到的唯一真正的问题是包中各个程序集的版本控制。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-07-30T14:35:05.587

我最近遇到了问题，我在程序集中合并了程序集，我有一些类是通过 Umbraco 开源 CMS 中的反射调用的。

通过反射进行调用的信息取自 db 表，该表具有实现和接口的类的程序集名称和命名空间。问题是当 dll 被合并时反射调用会失败，但是如果 dll 是分开的，它一切正常。我认为问题可能类似于 longeasy 的问题？

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2010-08-24T21:14:23.693

在我看来，#1 ILMerge 最佳实践是不要使用 ILMerge。相反，使用[SmartAssembly](http://www.red-gate.com/products/smartassembly/index.htm)。原因之一是 #2 ILMerge 最佳实践是在执行 ILMerge 后始终运行 PEVerify，因为 ILMerge 不保证它将正确地将程序集合并到有效的可执行文件中。

ILMerge 的其他缺点：

*   合并时，它会去除 XML 注释（如果我关心这一点，我会使用混淆工具）
*   它无法正确处理创建相应的 .pdb 文件

另一个值得关注的工具是 Mono.Cecil 和 Mono.Linker [2] 工具。

[2]：http://www.mono-project.com/Linker

# sql-server - 从网络计算机访问 SQL Server 2005 Express Edition

> ID：9383
> 
> 赞同：1
> 
> 时间：2008-08-13T01:14:16.857
> 
> 标签：sql-server, sql-server-2005-express

如何从网络计算机中的应用程序访问 SQL Server 2005 Express Edition？

我需要的访问权限来自应用程序（Linq-to-SQL 和 ODBC）和 Management Studio

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-13T01:16:48.257

请参阅此知识库文章。[如何配置 SQL Server 2005 以允许远程连接](http://support.microsoft.com/default.aspx?scid=kb;EN-US;914277)。
哦，请记住 SQLServer 名称可能是 MyMachineName\SQLExpress

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-13T14:35:16.693

如果您在 2k3 机器上运行它，则需要安装 Sql Server 和 2003 服务器的所有更新。

启动 Sql Server 后检查事件日志。它会很好地记录所有内容，告诉您它是否被阻止，以及它在哪里监听连接。

在远程机器上，您可以使用 telnet 查看 sql 服务器是否正在侦听远程连接。您只需要服务器的 IP 和端口（默认为 1433）。从命令行：

```
telnet 192.168.10.10 1433 
```

如果你得到一个空白屏幕，它正在收听。如果您返回到命令提示符，则说明有什么东西阻止了您。

# asp.net - Datagrid：计算页脚中列的平均值或总和

> ID：9409
> 
> 赞同：5
> 
> 时间：2008-08-13T02:15:17.093
> 
> 标签：asp.net, vb.net, datagrid, report

我有一个绑定到数据集的数据网格，我想在页脚中显示填充整数的列的平均结果。

我想的方式，有两种我能想到的方法：

1.“使用**Source**，Luke”
在我调用 DataGrid.DataBind() 的代码中，使用 DataTable.Compute() 方法（*或者在我的情况下为 DataSet.DataTable(0).Compute()*）。例如：

```
Dim strAverage = DataTable.Compute("Avg(ColumnName)", "") 
```

但是一旦我有了这个，我怎么能把它插入到页脚中呢？

2.《为**荣耀**而战》
使用DataGrid.ItemDataBound事件，计算每个ListItemType.Item和ListItemType.AlternatingItem的累计，最终显示在ListItemType.Footer中。例如：

```
Select Case e.Item.ItemType
    Case ListItemType.Item, ListItemType.AlternatingItem
        runningTotal += CInt(e.Item.Cells(2).Text)
    Case ListItemType.Footer
        e.Item.Cells(2).Text = runningTotal/DataGrid.Items.Count
End Select 
```

这只是感觉不对，而且我必须确保在每个 DataBind 上重置 runningTotal。

有没有更好的办法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-13T02:59:55.943

我不知道是否一定更好，但两种*替代*方法是：

1.  一旦您点击页脚并根据屏幕上的文本进行计算，请手动浏览表格
2.  手动检索数据并与绑定分开进行计算

当然，#2 抵消了数据绑定的优势（假设您正在这样做）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-13T03:36:03.187

谢谢[DannySmurf](https://stackoverflow.com/questions/9409/aspnet-datagrid-in-footer-calculate-avg-or-sum-for-column#9426)，你的第一个回答让我明白了。（*为什么我们总是寻找那个神奇的解决方案？*）。

作为参考，这是我最终做的：（*警告：下面的 VB，可能没有足够的分号*）

```
Case ListItemType.Footer
    e.Item.Cells(0).Text = "Average"
    For i As Integer = 3 To 8
        Dim runningTotal As Integer = 0
        For Each row As DataGridItem In DataGrid.Items
            If IsNumeric(row.Cells(i).Text) Then
                runningTotal += CInt(row.Cells(i).Text)
            End If
        Next
    e.Item.Cells(i).Text = Math.Round(runningTotal / DataGrid.Items.Count, 0)
    Next
End Select 
```

我需要为几列（因此是 3 到 8）做这件事，这最终是我寻找神奇解决方案的原因。

# c - 如何在 C 中将函数作为参数传递？

> ID：9410
> 
> 赞同：751
> 
> 时间：2008-08-13T02:16:32.520
> 
> 标签：c, function, pointers, syntax, parameters

我想创建一个函数，在一组数据上执行由参数传递的函数。如何在 C 中将函数作为参数传递？

* * *

## 回答 #1

> 赞同：893
> 
> 时间：2008-08-13T02:22:24.007

**宣言**

带有函数参数的函数原型如下所示：

```
void func ( void (*f)(int) ); 
```

这表明参数`f`将是一个指向函数的指针，该函数具有`void`返回类型并且采用单个`int`参数。以下函数 ( `print`) 是一个可以`func`作为参数传递的函数的示例，因为它是正确的类型：

```
void print ( int x ) {
  printf("%d\n", x);
} 
```

**函数调用**

使用函数参数调用函数时，传递的值必须是指向函数的指针。为此使用函数的名称（不带括号）：

```
func(print); 
```

将调用`func`，将打印功能传递给它。

**功能体**

与任何参数一样，`func`现在可以使用函数体中的参数名称来访问参数的值。假设`func`它将应用它传递给数字 0-4 的函数。首先考虑一下循环直接调用 print 的样子：

```
for ( int ctr = 0 ; ctr < 5 ; ctr++ ) {
  print(ctr);
} 
```

由于`func`的参数声明表明这`f`是指向所需函数的指针的名称，我们首先回忆一下 if`f`是指针 then`*f`是指向的东西`f`（即`print`本例中的函数）。因此，只需将上面循环中的每次 print 替换为`*f`：

```
void func ( void (*f)(int) ) {
  for ( int ctr = 0 ; ctr < 5 ; ctr++ ) {
    (*f)(ctr);
  }
} 
```

[来源](http://math.hws.edu/bridgeman/courses/331/f05/handouts/c-c++-notes.html)

* * *

## 回答 #2

> 赞同：152
> 
> 时间：2008-08-13T02:34:47.850

这个问题已经有了定义函数指针的答案，但是它们可能会变得非常混乱，尤其是当您要在应用程序中传递它们时。为了避免这种不愉快，我建议您将函数指针类型定义为更具可读性的内容。例如。

```
typedef void (*functiontype)(); 
```

声明一个返回 void 且不带参数的函数。要创建指向此类型的函数指针，您现在可以执行以下操作：

```
void dosomething() { }

functiontype func = &dosomething;
func(); 
```

对于返回 int 并采用 char 的函数，您会这样做

```
typedef int (*functiontype2)(char); 
```

并使用它

```
int dosomethingwithchar(char a) { return 1; }

functiontype2 func2 = &dosomethingwithchar
int result = func2('a'); 
```

有一些库可以帮助将函数指针转换为可读的类型。[boost 函数](http://www.boost.org/doc/libs/1_36_0/doc/html/function.html)库很棒，值得努力！

```
boost::function<int (char a)> functiontype2; 
```

比上面的好多了。

* * *

## 回答 #3

> 赞同：110
> 
> 时间：2015-07-20T16:24:48.247

从 C++11 开始，您可以使用[函数库](http://www.cplusplus.com/reference/functional/function/function/)以简洁通用的方式执行此操作。语法是，例如，

```
std::function<bool (int)> 
```

其中`bool`是第一个参数类型为 的单参数函数的返回类型`int`。

我在下面包含了一个示例程序：

```
// g++ test.cpp --std=c++11
#include <functional>

double Combiner(double a, double b, std::function<double (double,double)> func){
  return func(a,b);
}

double Add(double a, double b){
  return a+b;
}

double Mult(double a, double b){
  return a*b;
}

int main(){
  Combiner(12,13,Add);
  Combiner(12,13,Mult);
} 
```

不过，有时使用模板函数更方便：

```
// g++ test.cpp --std=c++11

template<class T>
double Combiner(double a, double b, T func){
  return func(a,b);
}

double Add(double a, double b){
  return a+b;
}

double Mult(double a, double b){
  return a*b;
}

int main(){
  Combiner(12,13,Add);
  Combiner(12,13,Mult);
} 
```

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2015-11-23T12:07:40.563

**将函数的地址作为参数传递给另一个函数**，如下所示

```
#include <stdio.h>

void print();
void execute(void());

int main()
{
    execute(print); // sends address of print
    return 0;
}

void print()
{
    printf("Hello!");
}

void execute(void f()) // receive address of print
{
    f();
} 
```

**我们也可以使用函数指针**将函数作为参数传递

 **```
#include <stdio.h>

void print();
void execute(void (*f)());

int main()
{
    execute(&print); // sends address of print
    return 0;
}

void print()
{
    printf("Hello!");
}

void execute(void (*f)()) // receive address of print
{
    f();
} 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2018-11-27T15:42:42.960

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-08-13T02:18:28.163

您需要传递一个[函数指针](http://www.newty.de/fpt/fpt.html#passPtr)。语法有点繁琐，但是一旦你熟悉了它就真的很强大了。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2021-01-31T08:30:16.390

我将用一个简单的示例代码进行解释，该代码将一个`compare`函数作为另一个`sorting`函数的参数。假设我有一个冒泡排序函数，它采用自定义比较函数并使用它而不是固定的 if 语句。

比较函数

```
bool compare(int a, int b) {
    return a > b;
} 
```

现在，将另一个函数作为参数进行比较的冒泡排序

冒泡排序功能

```
void bubble_sort(int arr[], int n, bool (&cmp)(int a, int b)) {

    for (int i = 0;i < n - 1;i++) {
        for (int j = 0;j < (n - 1 - i);j++) {

            if (cmp(arr[j], arr[j + 1])) {
                swap(arr[j], arr[j + 1]);
            }
        }
    }
} 
```

最后，`main`通过将布尔比较函数作为参数传递来调用冒泡排序函数。

```
int main()
{
    int i, n = 10, key = 11;
    int arr[10] = { 20, 22, 18, 8, 12, 3, 6, 12, 11, 15 };

    bubble_sort(arr, n, compare);
    cout<<"Sorted Order"<<endl;
    for (int i = 0;i < n;i++) {
        cout << arr[i] << " ";
    }
} 
```

输出：

```
Sorted Order
3 6 8 11 12 12 15 18 20 22 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-09-23T14:29:50.047

```
typedef int function();

function *g(function *f)
{
    f();
    return f;
}

int main(void)
{
    function f;

    function *fn = g(f);

    fn();
}

int f() { return 0; } 
```

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2019-03-15T02:46:46.043

它不是一个真正的函数，而是一段本地化的代码。当然，它不会只传递结果。如果传递给稍后运行的事件调度程序，它将不起作用（因为结果是现在计算的，而不是在事件发生时计算的）。但是，如果您只想这样做，它确实会将您的代码本地化到一个地方。

```
#include <stdio.h>

int IncMultInt(int a, int b)
{
    a++;
    return a * b;
}

int main(int argc, char *argv[])

{
    int a = 5;
    int b = 7;

    printf("%d * %d = %d\n", a, b, IncMultInt(a, b));

    b = 9;

    // Create some local code with it's own local variable
    printf("%d * %d = %d\n", a, b,  ( { int _a = a+1; _a * b; } ) );

    return 0;
} 
```

# user-interface - 您是否使用与私有变量相同的约定来命名表单上的控件？

> ID：9433
> 
> 赞同：10
> 
> 时间：2008-08-13T03:17:52.037
> 
> 标签：user-interface, oop, coding-style

出于某种原因，我从来没有看到这样做过。有理由不这样做吗？例如，我喜欢 _blah 作为私有变量，并且至少在 Windows 窗体中，控件默认是私有成员变量，但我不记得曾经见过它们以这种方式命名。在我在成员函数的局部变量中创建/存储控制对象的情况下，有一些视觉区别特别有用。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-13T03:45:18.550

这对某些人来说可能是违反直觉的，但我们对 UI 元素使用了可怕的匈牙利符号。

逻辑很简单：对于任何给定的数据对象，您可能有两个或多个与之关联的控件。例如，您有一个在文本框中指示出生日期的控件，您将拥有：

*   文本框
*   指示文本框用于出生日期的标签
*   允许您选择日期的日历控件

为此，我将 lblBirthDate 用于标签，txtBirthDate 用于文本框，calBirthDate 用于日历控件。

不过，我很想听听其他人是如何做到这一点的。:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-13T03:48:00.603

匈牙利符号与否，我更好奇人们是否在 m_ 或 _ 或任何他们用于标准私有成员变量的前面添加。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-13T05:05:57.077

我个人用 _ 为私有对象添加前缀

表单控件总是以类型为前缀，我这样做的*唯一*原因是智能感知。*对于大型表单，只需键入lbl*并从列表中选择它就可以更容易地“获取标签值” ^_^ 它还遵循[Jon Limjap 所述的逻辑](https://stackoverflow.com/questions/9433/do-you-name-controls-on-forms-using-the-same-convention-as-a-private-variable#9453)。

尽管这确实再次出现了 Microsoft 的 .NET 编码指南，但请在[此处](http://search.msdn.microsoft.com/Default.aspx?query=naming+guidelines&brand=msdn&locale=en-us&refinement=)查看它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-13T06:19:16.850

对我来说，在私有成员前加下划线的命名约定的重大胜利与 Intellisense 相关。由于下划线位于字母表中的任何字母之前，因此当我使用 ctrl-space 来调出 Intellisense 时，我的所有 _privateMembers 都位于顶部。

但是，就命名而言，控件是另一回事。我认为范围是假设的，并且在前面加上几个字母来表示类型（例如txtMyGroovyTextbox）出于同样的原因更有意义；控件在 Intellisense 中按类型分组。

但在工作中，一路都是VB，我们做mPrivateMember。我认为 m 可能代表模块。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-13T09:31:26.340

我是通过 VB 来的，并保留了控件的控件类型前缀。我的私人成员使用小写字母 (firstLetterLowercase)，而公共成员使用 Pascal/大写字母 (FirstLetterUppercase)。

如果有太多的标识符/成员/本地人有 90% 的机会记住/猜测它的名字，那么可能需要更多的抽象。

我从不相信存储类型前缀是有用的和/或必要的。然而，我确实养成了遵循我使用的任何代码的风格的强烈习惯。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-13T03:26:07.217

我不知道，但我很欣赏你的逻辑。我猜大多数人不这样做的原因是下划线在设计时在“属性”窗口中看起来有点难看。它还会占用额外的水平空间特征，这在这样的停靠窗口中非常重要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-13T03:59:21.190

> 匈牙利符号与否，我更好奇人们是否在 m_ 或 _ 或任何他们用于标准私有成员变量的前面添加。

卢克，

我为我的类库对象使用 _ 前缀。出于我所说的原因，我专门为 UI 使用匈牙利符号。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-13T07:06:15.587

我从不在变量名中使用下划线。我发现除了字母（有时是字母数字）字符之外的任何东西都是多余的，除非语言要求。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-13T09:12:24.333

我在大写/小写阵营（“标题”是私有的，“标题”是公共的），混合了 UI 组件（tbTextbox、lblLabel 等）的“匈牙利”符号，我很高兴我们没有团队中的 Visual Case-Insensitive-Basic 开发人员 :-)

我不喜欢下划线，因为它看起来有点难看，但我不得不承认它有一个优势（或劣势，取决于你的观点）：在调试器中，由于 _ 存在，所有私有变量都将位于顶部在字母表的顶部。但话又说回来，我更喜欢我的私有/公共对在一起，因为这样可以更轻松地调试 getter/setter 逻辑，因为您可以看到私有和公共属性彼此相邻，

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-05T05:23:20.210

我写下它们所代表的数据库列的名称。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2008-08-13T04:00:10.953

我将 m_ 用于成员变量，但我越来越倾向于只使用 lowerCamelCase，就像我对方法参数和局部变量所做的那样。公共内容在 UpperCamelCase 中。

这似乎是整个 .NET 社区或多或少接受的约定。

# javascript - 添加多个 window.onload 事件

> ID：9434
> 
> 赞同：66
> 
> 时间：2008-08-13T03:18:32.893
> 
> 标签：javascript, asp.net, events, listener

在我的 ASP.NET 用户控件中，我将一些 JavaScript 添加到`window.onload`事件中：

```
if (!Page.ClientScript.IsStartupScriptRegistered(this.GetType(), onloadScriptName))
  Page.ClientScript.RegisterStartupScript(this.GetType(), onloadScriptName, 
    "window.onload = function() {myFunction();};", true); 
```

我的问题是，如果`onload`事件中已经有某些东西，那么这会覆盖它。我将如何允许两个用户控件在`onload`事件中分别执行 JavaScript？

**编辑：**感谢有关第三方库的信息。我会记住他们的。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-03-27T01:34:31.973

建议的大多数“解决方案”都是 Microsoft 特定的，或者需要臃肿的库。这是一个好方法。这适用于符合 W3C 的浏览器和 Microsoft IE。

```
if (window.addEventListener) // W3C standard
{
  window.addEventListener('load', myFunction, false); // NB **not** 'onload'
} 
else if (window.attachEvent) // Microsoft
{
  window.attachEvent('onload', myFunction);
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-08-13T13:44:52.163

仍然有一个丑陋的解决方案（远不如使用框架或`addEventListener`/ `attachEvent`）来保存当前`onload`事件：

```
function addOnLoad(fn)
{ 
   var old = window.onload;
   window.onload = function()
   {
       old();
       fn();
   };
}

addOnLoad(function()
{
   // your code here
});
addOnLoad(function()
{
   // your code here
});
addOnLoad(function()
{
   // your code here
}); 
```

请注意，像 jQuery 这样的框架将提供一种在 DOM 准备就绪时执行代码的方法，而不是在页面加载时执行代码。

DOM 准备就绪意味着您的 HTML 已加载，但未加载图像或样式表等外部组件，允许您在加载事件触发之前很久就被调用。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-12-01T02:48:09.350

我今天遇到了类似的问题，所以我`index.js`用以下方法解决了它：

```
window.onloadFuncs = [];

window.onload = function()
{
 for(var i in this.onloadFuncs)
 {
  this.onloadFuncs[i]();
 }
} 
```

在我想附加 onload 事件的其他 js 文件中，我只需要这样做：

```
window.onloadFuncs.push(function(){
 // code here
}); 
```

虽然我通常使用 jQuery，但这次我被限制在纯 js 上，不得不暂时使用我的大脑！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-13T04:16:01.500

[Mootools](http://mootools.net/)是另一个很棒的 JavaScript 框架，它相当容易使用，就像 RedWolves 所说的使用[jQuery](http://jquery.com/)一样，您可以继续使用任意数量的处理程序。

对于我包含的每个 *.js 文件，我只是将代码包装在一个函数中。

```
window.addEvent('domready', function(){
    alert('Just put all your code here');
}); 
```

[而且使用domready代替onload](http://walkthrough.ifupdown.com/walkthrough-1.2/domready.)也有好处

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-13T03:31:16.847

试试这个：

```
window.attachEvent("onload", myOtherFunctionToCall);

function myOtherFunctionToCall() {
    // do something
} 
```

编辑：嘿，我正准备用 Firefox 登录并自己重新格式化！似乎仍然没有用 IE7 为我格式化代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-13T03:26:40.617

我对 ASP.NET 了解不多，但为什么不为 onload 事件编写一个自定义函数，然后为您调用这两个函数呢？如果您有两个函数，请从您为该事件注册的第三个脚本调用它们。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-13T03:39:06.160

实际上，根据[这个 MSDN page](http://msdn.microsoft.com/en-us/library/z9h4dk8y.aspx)，看起来你*可以*多次调用这个函数来注册多个脚本。您只需要使用不同的键（第二个参数）。

```
Page.ClientScript.RegisterStartupScript(
    this.GetType(), key1, function1, true);

Page.ClientScript.RegisterStartupScript(
    this.GetType(), key2, function2, true); 
```

我相信这应该有效。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-08-30T08:37:31.777

你可以用jquery做到这一点

```
$(window).load(function () {
    // jQuery functions to initialize after the page has loaded.
}); 
```

# html - 为您的主站点规划和构建支持移动设备的站点

> ID：9435
> 
> 赞同：7
> 
> 时间：2008-08-13T03:23:55.987
> 
> 标签：html, mobile, responsive-design, wap, wml

我们正处于为我们的一位客户构建移动网站的初始规划阶段。这个移动站点将是我们已经为他们建立的主站点的补充。我们已确定内容将是主站点的一小部分，并将针对预期使用该站点的主要受众。

在浏览一些示例移动网站时，我们注意到很多网址中包含 WAP 的网站实际上只是简化的 HTML 文件。 [http://wap.mlb.com](http://wap.mlb.com)并没有真正启用 WAP，而是简单的 HTML。

我的问题是WAP想想过去？随着智能手机和 iPhone 能够按原样呈现网站，我们是否需要担心 WML 和 WAP，或者精简的 html 版本就足够了吗？

您还可以推荐博客或教程或回答以下如何最好地检查移动设备吗？作为程序员，我们是否需要了解用户代理的每个变体才能将它们重定向到我们的移动站点？

最后，您会为 iPhone/Touch Safari 浏览器编写一个移动站点，还是直接保留该站点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-28T07:39:01.357

较新的手机带有 WAP2，它使用 HTML 移动配置文件 (XHTML MP)，这与普通的 HTML 非常相似。旧手机使用无线标记语言 (WML)。

根据您的受众，我会考虑使用 XHTML MP 制作该网站的手机友好版本，并完全放弃 WML。手机友好是指简单的图形、少量的 JavaScript 和简单的导航。

要检查不同手机的功能，请查看[WURFL](http://wurfl.sourceforge.net/ "无线通用资源文件")。

此外，您可能想看看w3c 的[移动 Web 最佳实践](http://www.w3.org/TR/2008/REC-mobile-bp-20080729/ "移动网络最佳实践")。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-18T20:13:33.780

您可以做以下两件事来改进对 iPhone 的支持，而无需做太多工作：

使页面向上滚动以隐藏 URL 栏：

```
<script type="application/x-javascript">

  if (navigator.userAgent.indexOf('iPhone') != -1) {
    addEventListener("load", function() {
      setTimeout(hideURLbar, 0);
    }, false);
  }

  function hideURLbar() {
    window.scrollTo(0, 1);
  }

</script> 
```

并为页面宽度设置缩放（最好做一些测试和玩这个，也寻找其他可能使用的例子`user-scalable=true`）：

```
<meta name="viewport" content="width=320; user-scalable=false" /> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-18T11:28:26.413

我强烈建议您查看[Cameron Molls 的《](http://www.cameronmoll.com "卡梅伦·摩尔")[移动网页设计](http://mobilewebbook.com/)》一书。它与其说是构建移动优化网站的技术指南，不如说是让您思考可用的各种选项并总结每个选项的优缺点。肯定会让你思考你正在采取什么方法以及它是否正确。我认为它也有一些指向资源的指针，这些资源有助于检测对您网站的移动设备请求，那里有多种选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-03-17T07:37:21.383

截至目前（2014）

我们可能不需要单独的移动设备站点，而是可以使用前端库，如**Twitter Bootstrap**，它使用*响应式渲染* ，以便站点适应屏幕大小，无论是*平板电脑*、*移动设备*还是*桌面*

与拥有单独的移动和桌面网站相比，它的主要优势之一是需要**更少的维护。**

要了解有关*Twitter Bootstrap*的更多信息，请单击[此处](http://getbootstrap.com/getting-started/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-13T03:56:13.787

我认为 2.5G 手机和新 3G 手机的主要区别在于，虽然 2.5G 手机使用自己的浏览器，但 3G 手机上的浏览器在渲染能力上变得更加相似/准确。

另一方面，您可以使用 CSS 以大屏幕格式或小型移动优化格式呈现相同的 HTML，所以我猜发生的事情是“简单 HTML”方法似乎是最简单的路径采取。此外，无表格布局允许网站更好地扩展，从而更容易以大屏幕和小屏幕格式呈现网站。

所以最终的问题将是目标市场的问题。您的目标是那些倾向于拥有完全支持 3G 的手机的精通技术的受众吗？您是否针对最多可能拥有 2.5G 的人？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-13T04:38:44.993

我的经验是，这实际上取决于您要做什么以及用户是谁/在哪里。

虽然 WAP 受到了很多负面报道，但它的优势在于您拥有低带宽高延迟连接。WML 内容由运营商的网关优化，以大大减少空中传输的数据量。如果你有 iPhone 等，在 3G 覆盖稳固的地区，你可以负担得起更丰富的内容，但如果你想让应用程序在更偏僻的地区仍然表现良好，WAP 有很大的优势。

使用 WAP 需要注意的一件事是，手机中 WAP 支持的质量差异很大（猜想您也会对智能手机网络浏览器说同样的话）。他们中的大多数都可以显示页面，但是在某些浏览器中表单处理确实很糟糕。

如果您根据用户代理改变内容，您还应该提供访问特定类型内容（例如单独的 uri）的显式方式 - 自动选择并不总是正确的，您希望客户端能够覆盖它。

如果您使用 WAP 开发，请查看 WinWAP - 基于 Windows 的 WAP 浏览器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-18T19:59:09.987

如果您想花很少的钱，您可以在亚马逊上以不到 1 美元的价格找到我的[《Palm OS Web 应用程序开发人员指南》一书的二手副本。](https://rads.stackoverflow.com/amzn/click/com/1928994326)虽然关于旧 Palm VII 设备的具体提示不再适用，但仍有一些关于制作移动网站的部分可能仍然适用。我的基本建议是：先用相关信息做小页面，然后是导航链接；将通用/样板内容推送到其他页面；尝试优化以减少用户在单个页面上花费的时间；并避免为页面下载大量对象（图像、JavaScript 文件）以减少延迟。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-03-28T17:14:32.233

代码：当我使用 w3 验证器时，它会返回 11 个错误。这是尝试过的索引页面：您不会使用多行，未使用。它们是模板行。

```
<!DOCTYPE HTML>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Photography Aerial Commercial Portrait Underwater Wedding Tom Szabo</title>
<meta name="description" content="A Thomas Image professional photography serving Cleveland
Northeast Ohio Chagrin Falls Chardon Kirtland Madison Mentor Painesville Perry and Willoughby">
<meta name="keywords" content="A Thomas Image, professional, photography, cleveland, northeast ohio, chagrin falls, chardon, concord, kirtland, madison, mentor, painesville, perry, willoughby,commercial, marketing, advertising, executive, head shot, portrait, baby, children, family, high school senior, family reunion, underwater, scuba diving, pool party, wedding, bride, groom,">
<meta name="y_key" content="7b00158550200c1c">
<meta name="y_key" content="b5a3e0c1d778ff8a">
<meta name="msvalidate.01" content="7C6C4CEC2EB84051B1DCFEC558B77724" />
<meta name="verify-v1" content="G4nmk0aesZsCjneBo0W6kVlv5NpImVnTfsQ+fXEk1fA=" />
<meta name="viewport" content=”width=320,user-scalable=false”&gt; 
```

# php - 在 OpenBSD 的 Apache 服务器上运行 xinc

> ID：9455
> 
> 赞同：10
> 
> 时间：2008-08-13T03:47:52.397
> 
> 标签：php, continuous-integration, openbsd, xinc

有没有人能够让 xinc 在 OpenBSD 的 chrooted 默认 Apache 下正确运行？我想让我们的开发服务器像我们的生产服务器一样完全运行 chroot，以便我们确保我们的代码运行良好 chroot。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T08:26:34.580

您是否在 Xinc[错误跟踪器](http://code.google.com/p/xinc/issues/list)上发布了该问题？Xinc 本身应该可以正常运行，因为它既可以作为守护程序运行，也可以作为 Web 应用程序运行。正如您所提到的，问题可能是守护程序没有在 chroot 环境中运行，而 Web 界面是，导致任何一方都没有抓取文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-31T17:04:16.047

@dragonmantank

在 Xinc 的例子中，我希望你使用 PEAR 来安装它。

```
pear list-files xinc/Xinc 
```

这应该会这样做，并向您显示您的 Xinc 安装将其文件放在哪里。因此，即使 Xinc “只是”一个大的 PHP 脚本，它仍然分散到 rc 脚本和所有其他使应用程序运行所必需的东西中。我确定您不需要添加那里列出的所有路径，但可能需要添加一些以使其运行。

除了 Xinc 本身，我认为它还需要 phpUnit 和一堆其他 PEAR 库来运行，所以我建议是这样的：

```
pear config-get php_dir 
```

然后您需要将该路径（如 Henrik 建议的那样）添加到 chroot 环境。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-24T11:57:21.160

我自己从未使用过 xinc，我只能暗示我通常如何使用 chrooting 应用程序。

第一步是收集应用程序运行所需的所有信息；这我通常通过运行[systrace(1)](http://www.openbsd.org/cgi-bin/man.cgi?query=systrace&sektion=1)和[ldd(1)](http://www.openbsd.org/cgi-bin/man.cgi?query=ldd&sektion=1)来找出运行软件所需的内容。

通过输出

```
systrace -A -d. <app>
ldd <app> 
```

并确保应用程序接触和需要的一切（很多应用程序接触它实际上并不需要的东西）在 chroot 环境中可用。您可能需要稍微调整配置和环境变量。此外，如果可以选择让应用程序记录到 syslog，我通常会这样做并创建一个 syslog 套接字（请参阅[syslogd(8)](http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&sektion=8)的 -a 选项），以减少应用程序需要写入访问权限的位置。

我刚刚描述的是一种使几乎任何程序在 chroot 环境中运行的通用方法（但是，如果您需要导入一半的用户空间和一些 suid 命令，您可能不想执行 chroot :)。对于在 Apache 下运行的应用程序（我相信您知道 OpenBSD [httpd(8)](http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8)略有不同），您可以选择（一旦程序启动；任何动态库仍然需要存在于监狱中）使用apache 来访问文件，允许使用[httpd.conf](http://httpd.apache.org/docs/1.3/configuring.html)在 chroot 环境中导入资源，而无需实际复制它们。

[这个](http://www.phpbuilder.com/manual/en/install.unix.openbsd.php)链接也很有用（如果有点过时），它概述了 OpenBSD 上 chrooted PHP 中的一些陷阱。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-24T15:21:50.247

> 第一步是收集应用程序运行所需的所有信息；这我通常通过运行 systrace(1) 和 ldd(1) 来找出运行软件所需的内容。

我会试试这个。我发现 xinc 的一个大问题是，虽然它是一个 PHP 应用程序，但它想知道应用程序的安装路径（但它仍然会将内容传播到其他文件夹中）并以守护程序模式运行一些 PHP 脚本（这些脚本最难跑起来）。因此，例如，我告诉它安装到 /var/www/xinc 然后创建一个符号链接

/var/www/var/www/xinc -> /var/www/xinc

它部分工作。我让 GUI 出现了一点，它拒绝识别我设置的任何项目。我认为最大的问题是它的一部分在运行 chroot，而另一半在外面运行。

如果一切都失败了，我将不得不在我们在 chrooted 环境中编程时构建一些东西，因为我们的生产是 chrooted。我们遇到了问题，我们在 chroot 之外进行编码，然后必须回溯以找到我们需要使其在 chroot 内工作的内容。

# .net - 在 .Net 中编写 RESTful 服务“客户端”的最佳方式？

> ID：9467
> 
> 赞同：7
> 
> 时间：2008-08-13T04:04:05.877
> 
> 标签：.net, web-services, rest

人们使用什么技术在 .Net 上的 REST 阶梯中“使用”服务？普通的http客户端？与此相关：许多休息服务现在都在使用 JSON（它更紧凑、更快）——那么使用什么 JSON 库呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-13T04:30:50.487

我的方法是

1.  编写一些库和接口来将您的对象序列化为与 REST 兼容的 XML。您不能只使用内置的序列化程序，因为您的服务可能不接受 .NET 想要提供给您的那种 XML。

    示例：当将布尔值传递给 Rails REST 服务时，`"true"`被反序列化为`true`，而`"True"`（.NET 为您提供）反序列化为`false`.

2.  编写一些库来执行 HTTP，包装基本的 .NET`WebRequest`对象。您可能会从该领域的一些第三方库中获得一些信息，因为它往往更标准。不过我发现了一些问题，例如[.NET 框架中的这个可爱的错误](http://www.simple-talk.com/community/blogs/dana/archive/2006/07/28/1484.aspx)，所以我很高兴我坚持了基础知识。

# c# - WCF 向后兼容性问题

> ID：9472
> 
> 赞同：0
> 
> 时间：2008-08-13T04:27:31.773
> 
> 标签：c#, .net, wcf

我有一个必须从 .net 2.0 项目中引用的 WCF 服务。

我尝试使用“**添加网络引用**”方法来引用它，但它弄乱了参数。

例如，我在服务中有一个方法`char[]`需要传入 a，但是当我添加 Web 引用时，该方法需要一个`int[]`.

所以然后我尝试设置**svcutil**并且它工作......有点。
我只能通过向我的*.net 2.0*项目添加一堆*.net 3.0*引用来编译服务类。这对建筑师来说并不好，所以我不得不这样做（而且可能也是最好的）。

 *所以我想知道是否有人对我如何设置*.net 2.0*项目以引用**WCF 服务**有任何指示或资源。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-13T07:14:23.353

您需要编辑 WSDL 的那些实例之一。首先是一个有用的工具

[http://codeplex.com/storm](http://codeplex.com/storm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-21T12:12:47.667

您使用的是什么绑定 - 我认为如果您坚持使用 basicHttp 绑定，您应该能够使用 .net 2 项目中的“添加 Web 引用”方法生成代理？

也许如果您发布合同/接口定义可能会有所帮助？

干杯理查德

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-13T10:23:06.517

感谢您的资源。它确实帮助我测试了 web 服务，但它对在我的 .net 2.0 应用程序中使用 WCF 服务没有多大帮助。

我最终最终做的是回到架构师那里并解释我需要引用的 3.0 dll 被编译回以在 2.0 CLR 上运行。我们不一定喜欢这个解决方案，但我们现在会采用它，因为似乎没有太多可行的替代方案

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-28T01:32:25.277

我使用的是 basicHttp 绑定，但问题实际上出在 XMLSerializer 上。它不能正确识别 WCF 生成的 wsdl（即使使用 basicHttp 绑定），用于除基本值类型之外的任何内容。

我们通过添加对 3.0 dll 的引用并使用 datacontract 序列化程序来解决这个问题。

# asp.net - RaisePostBackEvent 未触发

> ID：9473
> 
> 赞同：5
> 
> 时间：2008-08-13T04:30:30.610
> 
> 标签：asp.net, postback

我有一个实现 IPostBackEventHandler 的自定义控件。一些客户端事件调用 __doPostBack(controlID, eventArgs)。

该控件在两个不同的用户控件中实现。在一个控件中，RaisePostBackEvent 在被调用时在服务器端触发`__doPostBack`。在另一个控件中，从不调用 RaisePostBackEvent。我检查了`__EVENTTARGET`参数，它确实与控件的 ClientID 匹配......我还能在哪里解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-13T04:45:06.557

有很多方法可以分崩离析。您是否在后面的代码中动态地将控件添加到页面？如果很多时候您的 UniqueID 可能会关闭 - 即使客户端 ID 相同。您是否有一个代码示例可以演示您在做什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-13T06:56:24.140

仔细检查它确实是 UserControl 类的派生，而不是 WebControl 类。
这一次让我惊讶了很多次。如果您需要使用 WebControl 进行样式设置，则需要让您的控件实现 INamingContainer。（别担心，它是一个标记界面）

所以..

```
public class MyControl : UserControl {} 
```

或者

```
public class MyControl : WebControl, INamingContainer {} 
```

# c# - 如何让 Visual Studio 为功能块自动生成大括号？

> ID：9486
> 
> 赞同：11
> 
> 时间：2008-08-13T05:09:33.233
> 
> 标签：c#, visual-studio

我可以发誓我见过人们输入函数标题，然后点击一些组合键来自动创建函数括号并在它们之间插入光标，如下所示：

```
void foo()_ 
```

到

```
void foo()
{
    _
} 
```

这是内置功能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-13T05:30:37.527

这些工具看起来不错（尤其是 Resharper，但价格为 200-350 美元！）但我最终只是录制了一个宏并将其分配给 ctrl+alt+[

宏是这样出来的：

```
Sub FunctionBraces()
    DTE.ActiveDocument.Selection.NewLine
    DTE.ActiveDocument.Selection.Text = "{}"
    DTE.ActiveDocument.Selection.CharLeft
    DTE.ActiveDocument.Selection.NewLine(2)
    DTE.ActiveDocument.Selection.LineUp
    DTE.ActiveDocument.Selection.Indent
End Sub 
```

编辑：我用宏记录器来做这个，还不错

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-13T05:20:34.147

查看[Resharper](http://www.jetbrains.com/resharper/documentation/feature_map.html) - 它是具有此功能的 Visual Studio 插件，以及许多其他开发帮助。

另请参阅[C# Completer](http://www.knowdotnet.com/articles/csharpcompleter.html)，另一个附加组件。

如果您想自己动手，请查看[这篇文章](http://www.developer.com/net/cplus/article.php/3347271)。疯狂的是，一个人应该这样做，虽然。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-13T05:14:51.693

它可以通过使用代码片段来实现，有些已经内置（尝试输入“svm”并点击 TAB-TAB）..

网上有很多关于创建这些的信息：

[杰夫在这里自己发了一个帖子](http://www.codinghorror.com/blog/archives/000419.html)

有一个谷歌！我经常使用它们！:D

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-13T05:15:22.283

看看[视觉辅助](http://www.wholetomato.com/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-05T15:47:09.540

我刚刚根据上面的@Luke 创建了一个。这个，你想按 Enter 然后按你的组合键，它会插入：

```
if ()
{

}
else
{

} 
```

它会将您的光标放在 if 语句的括号中。

```
Sub IfStatement()
    DTE.ActiveDocument.Selection.Text = "if ()"
    DTE.ActiveDocument.Selection.NewLine()
    DTE.ActiveDocument.Selection.Text = "{"
    DTE.ActiveDocument.Selection.NewLine(2)
    DTE.ActiveDocument.Selection.Text = "}"
    DTE.ActiveDocument.Selection.NewLine()
    DTE.ActiveDocument.Selection.Text = "else"
    DTE.ActiveDocument.Selection.NewLine(2)
    DTE.ActiveDocument.Selection.Text = "{"
    DTE.ActiveDocument.Selection.NewLine(2)
    DTE.ActiveDocument.Selection.Text = "}"
    DTE.ActiveDocument.Selection.LineUp(False, 7)
    DTE.ActiveDocument.Selection.EndOfLine()
    DTE.ActiveDocument.Selection.CharLeft(3)
End Sub 
```

# asp.net - 在非生产环境中复制与负载相关的崩溃

> ID：9501
> 
> 赞同：4
> 
> 时间：2008-08-13T06:04:52.950
> 
> 标签：asp.net, performance, memory, crash, cpu

我们正在我们的 Intranet 上运行一个自定义应用程序，我们在最近升级它后发现一个问题，即 IIS 以 100% 的 CPU 使用率挂起，需要重置。

在确定解决方案时，我们回滚到以前的版本，而不是让用户陷入困境。第一步是重现问题——但我们不能。

这里有一些背景：

Prod 有一个带有两个 CPU 和 2 GB RAM 的虚拟化 (vmware) Web 服务器。数据库服务器有 4GB，还有 2 个 CPU。它也在 VMWare 上，但在单独的物理硬件上。

在正常使用期间，应用程序运行良好。w3wp.exe 进程通常使用 5-20% 的 CPU 和大约 200MB 的 RAM。CPU 和 RAM 在正常使用情况下略有波动，但没有异常。

然而，当我们开始遇到问题时，RAM 急剧攀升，CPU 稳定在 98%（或尽可能多）。该站点变得无响应，需要重新启动 IIS。在这种情况下，重置应用程序池不起作用，需要完全重新启动 IIS。

它不会在夜间发生（不使用）。当站点处于负载状态时，这种情况发生得更多，但它也发生在非高峰期。

解决这个问题的第一步是重现它。为了模拟负载，我们开始使用 JMeter 来模拟使用。我们的加载脚本基于崩溃时的实际使用情况。使用 JMeter，我们可以提高使用率（崩溃期间负载的 2-3 倍），但站点运行良好。CPU 很高，站点确实变得缓慢，但内存使用量合理，没有任何问题。

有没有人有关于如何在非生产环境中重现此类问题的任何提示？我们真的很想重现错误，确定解决方案，然后再次测试以确保我们已经解决了它。在这个过程中，我们发现了一些我们已经改进的小东西可能会解决问题，但是如果我们能够重现问题并测试改进的版本，我真的会更有信心。

非常感谢任何工具、技术或理论！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-13T06:13:21.590

[您可以在此博客条目](http://blogs.msdn.com/tess/archive/2008/05/21/debugdiag-1-1-or-windbg-which-one-should-i-use-and-how-do-i-gather-memory-dumps.aspx)中找到有关解决此类问题的一些信息。她的博客通常是一个很好的调试资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-13T06:14:11.197

我有[一篇关于在生产中调试 ASP.NET 的文章，](http://www.codinghorror.com/blog/archives/000015.html)它可能会提供一些指导。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-13T07:26:33.987

你的测试环境真的和现场一样吗？即 2 个物理服务器上的 2 个单独的 vm 实例 - 具有网络连接和帐户类型？

数据库上是否还有其他实例？

IIS 中是否还有其他 Web 应用程序？

.Net 配置正确吗？

应用程序池配置是否适用于服务帐户？ [试试看这个——关于 II6 优化性能的 MS 文章](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/93275ef2-2f85-4eb1-8b92-a67545be11b4.mspx?mfr=true)

很多套路。

# c# - 使用 C# 3.0 编译的 C# 2.0 代码使用程序集

> ID：9508
> 
> 赞同：11
> 
> 时间：2008-08-13T06:17:00.570
> 
> 标签：c#, .net, .net-3.5

这应该没问题，因为 CLR 实际上并没有改变？

运行 C# 2.0 代码的机器**已经**推出了 .NET 3.5。

背景是我们有一个 Windows 服务（使用 VS2005 构建的 .NET 2.0 exe，部署到大约 150 台服务器），它动态加载程序集（几乎像插件）以完成要求它的各种工作项。每当我们推出新版本的总线逻辑时，我们只需将程序集放到 FTP 服务器上，Windows 服务就会知道如何检查、获取和存储最新版本。现在使用 VS2008 构建新的程序集并以 .NET 2.0 为目标，我们知道这可以正常工作。但是，我们希望开始利用 C# 3.0 语言功能（例如 LINQ）并将程序集针对 .NET 3.5，而无需构建和部署新版本的 Windows 服务。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-13T06:58:35.197

C#3 和 .Net 3.5 添加了新的程序集，但 IL 没有改变。

这意味着使用 .Net 2 程序集，您可以编译和使用 C#3，只要您不使用 Linq 或其他任何引用 System.Linq 或 System.Core

`yield`, `var`, lambda 语法、匿名类型和初始化器都是编译器的聪明之处。他们产生的 IL 是交叉兼容的。

如果您可以参考 3.5 的新程序集，它应该可以正常工作。

没有新版本的 ASP.Net - 它仍然应该是 2.0.50727 - 但您仍然应该为 3.5 编译

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-13T08:03:02.773

> yield、var、lambda 语法、匿名类型和初始化器都是编译器的聪明之处。他们产生的 IL 是交叉兼容的。

次要的挑剔点，但产量无论如何都是 2.0 的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-13T07:27:19.583

这是有趣的东西。在这个论坛上有人向我建议之后，我昨天在看[LinqBridge ，他们正在做类似的事情。](http://www.albahari.com/nutshell/linqbridge.html)

我觉得奇怪的是，微软将框架命名为 2.0、3.0 和 3.5，因为它们都编译下来生成 2.0 CLR 所需的相同 IL。我原以为将版本添加到 2.0 会更有意义，尽管我想也很难让人们了解存在不同版本的运行时、编译器和语言的事实。

# sharepoint - 您如何部署您的 SharePoint 解决方案？

> ID：9543
> 
> 赞同：18
> 
> 时间：2008-08-13T07:33:45.810
> 
> 标签：sharepoint, deployment, production

我现在正在计划将 SharePoint 解决方案部署到生产环境中。
我已经阅读了一些工具，它们承诺一种简单的方法来自动化这个过程，但似乎没有什么适合我的场景。

在测试阶段，我使用 SharePoint Designer 在不同的开发和测试服务器之间复制网站内容，但这个过程是手动的，似乎有点不必要。

该网站由带有自定义 Web 部件的 SharePoint Web 部件页面和大量 Reporting Services 报表定义组成。

那么，在这片广袤的极客之地，对于如何最有效地为多部署方案创建和部署 SharePoint 网站，有什么好的建议吗？

**编辑**
只是为了澄清。我需要将多个“SharePoint 站点”部署到现有网站集中。由于 SharePoint 喜欢将其网站放在 SharePoint 内容数据库中，因此目前不可以仅将文件放入 IIS。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-13T10:35:58.363

我还建议查看 Chris O'Brien 的 SharePoint 内容部署向导。 [http://www.codeplex.com/SPDeploymentWizard](http://www.codeplex.com/SPDeploymentWizard)

应该有助于使您描述的过程顺利进行，无论如何它都是您的工具包的好工具

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-13T07:39:37.157

我们有一个带有 Web 应用程序的 BizTalk 2006 和几个需要从 Dev 到 UAT 再到 Live 的 Web 服务。

我们直接在 VS 中使用 MSBuild 来构建、运行测试、依赖于测试结果、编译、压缩并发送到服务器。

服务器上的小型 MSBuild 脚本用于解压缩、移动文件、安装干净的 Web 应用程序、取消列出 biztalk 位、安装新的 biztalk 位、重新登记然后启动这些东西。

MSBuild 很强大，更多的人需要使用它，因为它现在就在平台上 =>

使用[MSBuild](http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T09:42:32.617

请注意，“解决方案”在 Sharepoint 中具有特定含义：为部署为 .wsp 文件而打包的一组功能（如 Web 部件、列表定义等）。

您通常在 Visual Studio 中构建共享点解决方案，并使用诸如 Sharepoint SmartTemplates [http://www.codeplex.com/smarttemplates之类的工具打包和部署它们](http://www.codeplex.com/smarttemplates)

但是，在您的情况下，您已经在想要移动到另一个站点的实时共享点站点中拥有内容。为此使用解决方案可能太麻烦了，特别是如果您想多次执行此操作（尽管可以使用 SharePoint 解决方案生成器从实时站点生成解决方案）。

将所有内容从一个活动站点部署到另一个站点的最简单方法是使用 stsadm 创建站点的备份，然后使用 stsadm restore 再次将其还原到新站点。这完全覆盖了新站点。

您可以使用导入/导出（而不是备份/恢复）来移动选择的文件/列表。SharePoint 内容部署向导之类的工具可以更轻松地选择要移动的内容。

# linker - 我需要将我的混合模式应用程序链接到哪些库？

> ID：9570
> 
> 赞同：1
> 
> 时间：2008-08-13T08:05:00.337
> 
> 标签：linker, c++-cli, mixed-mode

我正在将 .NET 支持集成到我们的 C++ 应用程序中。
这是一个老式的 MFC 应用程序，有 1 个额外的文件使用“/clr”选项编译，该选项引用 CWinFormsControl。

我不允许删除链接器标志“/NODEFAULTLIB”。
（我们有自己的构建管理系统，而不是 Visual Studio。）
这意味着我必须指定所有必要的库：VC 运行时和 MFC。

其他编译器选项包括“/MD”

接下来：我不能使用链接器标志“/FORCE:MULTIPLE”而只是添加*所有内容*：
我正在寻找一组不重叠的库。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-13T18:07:03.413

至少：

mscoree.lib MSVCRT.lib mfc90.lib（适当调整版本）

并从那里迭代。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-14T00:32:25.693

使用 AppWizard 以您的风格（SDI/MDI/对话框）创建一个准系统的 MFC 应用程序，然后[使用您的依赖](http://www.dependencywalker.com/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-14T11:01:33.623

我是如何解决的：

1.  与“/FORCE:MULTIPLE /verbose”（链接正常）链接并将输出放在一边。
2.  与“/NODEFAULTIB /verbose”链接并在上一步的输出中跟踪所有未解决的问题，并逐个添加库。
3.  这导致双打：“AAA.lib：XXX 已在 BBB.lib 中定义”
4.  然后我终于明白了：使用 /MD 重新编译托管和非托管单元并链接到（除其他外）：mscoree.lib msvcmrt.lib mfcm80d.lib

混合 /MT（非托管）和 /MD（托管）被证明是个坏主意：需要不同的（重叠）库。

@ajryan：Dependcy Walker 只告诉我使用了哪些 dll，而不是在链接时链接到哪些库。（例如 msvcmrt.lib ？）我想。

感谢您的回答！

简

# c++ - 任何生成makefile的好工具？

> ID：9589
> 
> 赞同：48
> 
> 时间：2008-08-13T08:47:36.363
> 
> 标签：c++, c, cross-platform, makefile

我正在寻找一种工具，它可以为不同编译器（gcc、microsoft vc++、borland 等）和不同平台（Win、Linux、Mac）的 C/C++ 项目生成 makefile。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-08-15T08:09:26.123

您可能需要考虑的其他建议：

*   [Scons](http://www.scons.org/)是一个跨平台、跨编译器的构建库，使用 Python 为构建系统进行调试。用于各种大型项目，性能非常好。

*   如果您使用 Qt，[QMake](https://doc.qt.io/qt-5/qmake-manual.html)也是一个不错的构建系统。

*   [CMake](https://cmake.org/)也很可爱。

*   最后，[如果一切都失败了......](http://www.google.co.uk/search?q=cross+platform+build+system)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-08-13T08:49:26.253

您是否尝试过[自动生成文件生成器](http://www.robertnz.net/genmake.htm#Details)？

它支持以下编译器：

```
宝兰 3.1
宝兰 5.0
Borland 5.0，16 位
宝兰 5.5
宝兰 5.6
宝兰 5.8
抄送
牛g++
Gnu g++，动态库
适用于 Linux 的英特尔 5、6、7
适用于 Linux 的 Intel 5、6、7，动态库
适用于 Windows 的英特尔 5、6、7
适用于 Linux 的英特尔 8、9、10
Intel 8,9,10 for Linux，动态库
适用于 Windows 的英特尔 8,9
适用于 Windows 的英特尔 10
视觉 C++ 5
视觉 C++ 6、7、7.1
视觉 C++ 8
打开沃通
华通10A
Watcom 10A，16 位

```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-27T07:27:43.670

我以前使用过[Bakefile](http://www.bakefile.org/index.html)并取得了一些成功。它相当简单，似乎运作良好。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-17T20:49:24.550

CMake 是唯一可以实际生成真正的 Visual Studio 项目（即不是调用外部工具的“Makefile”项目）的工具，它会在构建输入文件 (CMakeLists.txt) 更改时自动重新创建项目。

SCons 性能问题是众所周知的，并且是 SCons 邮件列表中争论不休的话题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-23T17:22:32.133

我会投票给[OMake](http://omake.metaprl.org)。它解决了我对 GNU make 的所有抱怨：

*   这是一门成熟的语言。
*   使用 MD5 而不是时间戳。
*   提供了一个最小的 shell，它在所有平台上实现了最有用的 unix 命令：find、sed、awk 等...
*   适用于 unix 或 dos 样式的路径名。
*   广泛记录。
*   支持并行构建。
*   快速地。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-27T09:33:11.153

(M|m)akefiles 的自动生成让我担心你在这里尝试做什么。

当您键入 make 时，您了解幕后发生的事情吗？还是gmake？我只是问，因为如果你在事情中断时不这样做，例如新的代码更改没有被合并到构建中，你将很难尝试处理已经发生的事情。

要开始了解 make，我可以建议阅读Robert Mecklenberg的“[使用 GNU Make 管理项目”。](https://rads.stackoverflow.com/amzn/click/com/0596006101)前面几章介绍了 make 的工作原理。让您了解 make 是反向链接的事实是您可以做的最重要的事情之一。

如果您不这样做，并且您的系统似乎可以工作，那么用实用程序员的术语来说，您将是“[巧合编程](http://www.pragprog.com/the-pragmatic-programmer/extracts/coincidence)”。（-：

顺便说一句，他们网站上有很棒的文章！我不参与其中。YMMV。亚达亚达...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-20T20:40:08.533

我还将支持 CMake。我在一个多平台项目上使用它已经有一段时间了，我对它非常满意。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-23T01:37:17.867

要考虑的一个问题是您想要“makefile”创建者还是替代构建系统？替换构建系统的问题在于，对于用户期望的平台（Visual C++），您通常无法获得良好的 IDE 集成。如果您确实想要一个 makefile 创建者而不是替代构建系统，请查看[MPC](http://ociweb.com/products/mpc)。它是免费和开源的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-08-18T04:56:17.950

最近添加到替换列表中的是[waf](http://code.google.com/p/waf/)。从个人经验来看，SCONS 做得很好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-01-25T15:41:06.753

不知道大家对这个问题有没有兴趣。我正在研究一个名为[CodeMate](http://dongli.github.com/CodeMate)的类似 Makefile 自动生成器投影，它是使用 Ruby 开发的。也许它现在对于大型应用程序还没有那么成熟，但我会继续努力让它变得更好。用户不应该需要编辑任何配置文件来构建软件，或者至少应该是这样。学习曲线应该最小化。

# wpf - 您会推荐哪些 WPF 书籍？

> ID：9591
> 
> 赞同：65
> 
> 时间：2008-08-13T08:59:42.783
> 
> 标签：wpf

好吧，我有一本不错的 WPF 书，名为 Sams Windows Presentation Foundation Unleashed。我真的很喜欢阅读和学习它。有没有其他可以推荐的 WPF 书籍？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-08-13T14:57:08.973

我发现以下书籍非常有用：

[Windows Presentation Foundation Unleashed - Adam Nathan](https://rads.stackoverflow.com/amzn/click/com/0672328917)
您提到您已经拥有这本书，但是我想就它发表我的看法。这对新手来说是一本很棒的书——它以全彩印刷，对于可视化 xaml 和 WPF 概念有很大帮助。

[Essential Windows Presentation Foundation - Chris Anderson](https://rads.stackoverflow.com/amzn/click/com/0321374479)
这也是另一本适合新手的好书。虽然它不是彩色印刷的，但它确实可以很好地了解 WPF 的工作原理。

[C# 2008 中的 Pro WPF - Matthew Macdonald](https://rads.stackoverflow.com/amzn/click/com/1590599551)
这是一本很棒的参考书——它放在我的办公桌上，并且经常被引用。但是，我觉得它不像上面的其他两本书那样对新手友好。这是最近出版的书（在发帖时），并且已针对 VS2008 进行了更新。这很有用，因为 WPF 的版本有一些变化。我相信有一个可用的 VB.NET 版本。

[Programming WPF - Chris Sells 和 Ian Griffiths](https://rads.stackoverflow.com/amzn/click/com/0596510373)
另一本很棒的书 - 我希望在我第一次学习框架时可以使用它。

[应用程序 = 代码 + 标记 - Charles Petzold](https://rads.stackoverflow.com/amzn/click/com/0735619573)
这是我购买的第一个 WPF。它*不是*对新手非常友好，我不建议第一次使用它。直到第 457 页才引入 Xaml 的事实使得学习现实世界的技术非常困难。也就是说，如果你真的想深入了解事物是如何工作的（这对于充分利用框架也很重要，那么这本书是无价的。

我会完全避免的唯一一本书是：

[专业 WPF 编程 - Chris Andrade 等人。](https://rads.stackoverflow.com/amzn/click/com/0470041803)
虽然这本书的内容还可以，但我发现其他书更清晰，更深入。

希望这可以帮助！WPF 有一个陡峭的学习曲线，但一旦你“掌握”，UI 编程实际上可以变得“有趣”！

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-16T20:56:16.150

## [Sams 在 24 小时内自学 WPF](https://rads.stackoverflow.com/amzn/click/com/0672329859)。

我是作者之一，所以我的意见是有偏见的。我们的书围绕构建四个应用程序而构建。它不像 Nathan 或 Petzold 的书那么深入。它的目的不是详尽无遗（或参考），而是一种在 WPF 上快速上手的方法。同样，提供一个基础，这样当您遇到技术中的一些不同的角落和缝隙时，您就不会感到不知所措。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-11T11:35:09.037

[WPF 在 Visual Studio 2008 中的应用](http://www.manning.com/feldman2/)

它现在正在印刷中。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-08-13T09:13:07.390

亚当的书很棒 - [http://blogs.msdn.com/adam_nathan/archive/2006/05/17/599301.aspx](http://blogs.msdn.com/adam_nathan/archive/2006/05/17/599301.aspx) Petzold 的书也很好，虽然有点难读:-) [http://www.charlespetzold。 com/wpf/](http://www.charlespetzold.com/wpf/)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-08-29T02:06:23.410

[MCTS 自定进度培训套件 - Microsoft .NET 3.5 Windows Presentation Foundation (70-502)](https://rads.stackoverflow.com/amzn/click/com/0735625662)

我个人发现，如果学习过程以 Microsoft 认证告终，我阅读和学习某个主题的动力会更大。如果您和我一样，您可能会发现深入研究一两周前刚刚发布的认证学习指南会更有意义。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-09-24T12:16:06.040

[著名的 WPF 专家Pavan Podila](http://blog.pixelingene.com/)刚刚出版了一本新书（在[Kevin Hoffman](http://dotnetaddict.dotnetdevelopersjournal.com/read/poster/87984.htm)的帮助下）。这都是关于在 WPF 中构建控件的，它被恰当地称为：

[**释放 WPF 控件开发**](https://rads.stackoverflow.com/amzn/click/com/0672330334)

如果您要在 WPF 中构建视觉效果、元素或控件，您会希望这本书放在您的书架上。达到你足够了解 WPF API 和概念以编写一个体面的控件的程度，需要足够的时间......这本书将简化你的旅程！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-13T09:25:51.873

我喜欢 KiwiB* 很棒的书。尽管您现在需要 .net 来获取一些示例，因为它们错过了代码示例的一些 using 语句。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-17T16:53:15.243

我目前正在开始研究“[带有 VB 2008 的 Pro WPF：带有 .NET 3.5（平装本）的 Windows Presentation Foundation](https://rads.stackoverflow.com/amzn/click/com/1590599624) ”，到目前为止我对它非常满意。对我们 VB'ers 有好处... :)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-13T09:10:15.257

是的，我强烈推荐[这个](https://rads.stackoverflow.com/amzn/click/com/0596510373)

# visual-studio - Visual Studio 2008 窗口布局烦恼

> ID：9601
> 
> 赞同：8
> 
> 时间：2008-08-13T09:24:10.020
> 
> 标签：visual-studio

我在使用 Visual Studio 2008 时遇到了一个奇怪的问题。每次启动它时，解决方案资源管理器大约有一英寸宽。就像它不记得它的布局设置一样。

每个未停靠的窗口都在我放置的位置。但是如果我停靠一个窗口，它的位置会被保存，但是当我加载时它的大小会被重置为非常窄（大约一英寸）。

我以前从未遇到过这种情况，这很烦人。有任何想法吗？

我尝试过的事情：

*   保存，然后通过导入/导出重新加载设置。
*   通过导入/导出重置所有环境设置。
*   窗口 -> 重置窗口布局。
*   更改上述内容后重新启动的组合。
*   安装了 SP1。没提升

这些都没有改变停靠窗口的行为。（另外，绝对没有其他实例在运行..）

我确实运行了两台显示器，但我已经在三个不同的工作站上进行了此设置，这是我第一次遇到它。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-13T10:04:49.143

我有同样的问题。事实证明，如果 VS 窗口未最大化，它真的很小。所以在使非最大化更宽之后，问题就消失了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-13T09:51:21.790

我偶尔会遇到这个错误，以及其他与布局/字体/着色等相关的错误。我发现的一个小技巧是使用工具 - >导入和导出设置，一旦你完成了所有设置，就导出你当前的设置，然后关闭并重新打开 Visual Studio 并导入。希望这会解决你。

在 2005 年，当解决方案资源管理器不在其默认位置，停靠在屏幕左侧时，查看项目/解决方案属性面板时出现了一些小错误 - 我不知道这在 VS2008 中是否发生了变化，但你可能想要放回去看看。

现在，我们什么时候才能获得体面的 MultiMonitor 支持？！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-13T09:35:07.173

也许您正在关闭 Visual Studio，而其他一些实例仍然存在。最后一个关闭的实例的设置将被应用。

# vb.net - 在 VB.NET 中为新的 Active Directory 条目设置组类型

> ID：9612
> 
> 赞同：3
> 
> 时间：2008-08-13T09:40:12.890
> 
> 标签：vb.net, active-directory, directoryservices, distribution-list

我正在尝试通过 VB.NET 和 DirectoryServices 为新的 Active Directory 条目设置组类型以创建分发列表。

如何访问 ADS_GROUP_TYPE 枚举？

具体来说，我在 ADS_GROUP_TYPE_GLOBAL_GROUP 之后。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-24T04:41:07.020

添加对 com ActiveDS Dll 的引用并使用 ActiveDS 导入命名空间，然后您将获得上述枚举值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-13T09:46:05.623

我不认为我可以通过 .NET 访问枚举，所以我创建了我需要的特定常量。对于它的价值，这是我的代码：

> ```
>  Const ADS_GROUP_TYPE_GLOBAL_GROUP As Object = &H2
>         adNewGroup.Properties("groupType").Value = ADS_GROUP_TYPE_GLOBAL_GROUP 
> ```

欢迎重构！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-13T10:19:05.120

你是对的，你实际上无法访问枚举。

只是一个小小的挑剔，这个常量不需要是一个对象，你可以把它变成一个 int32 -

常量 ADS_GROUP_TYPE_GLOBAL_GROUP 作为对象 = &H2

# sql - 双向外连接

> ID：9614
> 
> 赞同：8
> 
> 时间：2008-08-13T09:41:43.917
> 
> 标签：sql, mysql

假设我们有一张表 A：

```
itemid mark
1      5
2      3 
```

和表 B：

```
itemid mark
1      3
3      5 
```

我想在 A.itemid=B.itemid 左右加入 A*B。即结果：

```
itemid A.mark B.mark
1      5      3
2      3      NULL
3      NULL   5 
```

有没有办法在 MySQL 的一个查询中做到这一点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-08-13T10:15:39.293

[它被称为完全外连接，从它的docs](http://dev.mysql.com/doc/refman/4.1/en/join.html)来看，它在 MySQL 中不被原生支持。您可以使用 UNION 解决此限制，如我链接到的页面的评论中所述。

[编辑] 由于其他人发布了片段，所以你去。您可以在链接页面上查看说明。

```
SELECT *
FROM A LEFT JOIN B ON A.id = B.id
UNION ALL
SELECT *
FROM A RIGHT JOIN B ON A.id = B.id
WHERE A.id IS NULL 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-13T09:56:46.787

可以做一些工作，但这里有一些 sql

```
select distinct T.itemid, A.mark as "A.mark", B.mark as "B.mark"
    from (select * from A union select * from B) T 
    left join A on T.itemid = A.itemid 
    left join B on T.itemid = B.itemid; 
```

这依赖于左连接，它返回原始表中的所有行（在这种情况下，这是子选择表 T）。如果连接表中没有匹配项，那么它将将该列设置为 NULL。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-08-13T09:58:23.133

这适用于我在 SQL Server 上：

```
select isnull(a.id, b.id), a.mark, b.mark
from a 
full outer join b on b.id = a.id 
```

# cross-browser - 在浏览器中显示矢量图形

> ID：9615
> 
> 赞同：28
> 
> 时间：2008-08-13T09:43:53.787
> 
> 标签：cross-browser, svg, vector-graphics, vml

我需要在我正在处理的网站中显示一些交互式（附加 DOM 侦听器等和事件处理）矢量图形。W3C 推荐了 SVG，尽管 Internet Explorer 支持仍然无法识别这种格式，这是必须的（对于公共网站）。IE 处理 VML，甚至还有一些 JavaScript 库可以根据浏览器（SVG 与 VML）进行一些类似画布的绘图 - [excanvas](http://excanvas.sourceforge.net/ "画布")、[Dojo Toolkit 的 GFX](http://dojotoolkit.org/book/dojo-book-0-9/part-3-programmatic-dijit-and-dojo/drawing-gfx)等等。尽管它们都不能从给定的标记中显示 SVG 图像，但这会很好并且可以接受。

所以这个问题实际上由几个部分组成：

1.  是否有任何跨浏览器 Javascript 库可以显示来自给定标记（不是强制性 SVG）的矢量图形并提供附加到 DOM 事件的可用性？
2.  如果没有，哪种最流行的嵌入式浏览器技术最适合做这样的任务？我可以从 Flex/Flash、Java 小程序中进行选择。由于 Windows 锁定，Silverlight 不是一个选项。

[**编辑**]谢谢大家的意见/建议。以下只是我对此事的一些随机笔记/结论：

*   我需要的交互性级别是能够检测正在显示的矢量图像上的 DOM 事件——鼠标悬停、鼠标悬停、单击等——以及对它们做出反应的能力，比如改变背景颜色、显示对话框等。
*   坚持使用 SVG 格式的想法非常好，因为它在许多浏览器上都是原生的，除了最流行的浏览器 - IE。在尝试显示动态 SVG 之后，我意识到 IE 版本 7 是最有问题的。由于浏览器不兼容，有太多麻烦。
*   Cake 似乎是一个很棒的 Javascript 框架，尽管我无法获得在 IE7 上运行的示例。
*   Java Applets - 我最喜欢这个想法，因为我可以使用 Apache Batik 库，一个高质量的 SVG 渲染器。但是，Batik 是一个非常大的库，我负担不起部署一个只有几兆字节的小程序。
*   我决定坚持使用 Flex 选项。我找到了一个不错的矢量图形库[Degrafa](http://www.degrafa.com/)。它使用自己的标记格式，但是它识别 SVG 路径表示法，因此在我的情况下，使用 XSLT 转换我的 SVG 或仅解析它们将非常容易。

[**编辑 2** ] 出现了更多评论。我想澄清一下，“Windows 锁定”是指 Silverlight 通常在 Windows 上运行的情况，更具体地说，是 IE。我怀疑它是否是其他系统上可接受的解决方案（例如 Flash 或 Java Applet）。是的，我毫不怀疑*可以*在任何系统上启动 Silverlight 应用程序，尽管我担心这对普通用户来说会花费太多精力。

@Akira：您对 IE7 上的那些“SVG 渲染器”有什么问题吗？我总是抛出 Javascript 错误。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-13T11:13:39.987

Safari、Opera 和 Firefox 都以不同程度的完整性和正确性原生支持 SVG（例如，没有插件），包括从 javascript 编写 svg 脚本的能力。

还有一个 canvas 元素，它现在在 html5 中被标准化，并且已经在上述浏览器中得到支持（由于 html5 草案中相对较新的变化，在某些边缘情况下存在各种怪癖）。

不幸的是，任何基于标准的方法都会因 IE 故意无视其自身生态系统之外发生的事情而遭到破坏，但是有许多库试图将 canvas/svg 转换为 VML（IE 的专有矢量语言），例如[iecanvas](http://sourceforge.net/projects/iecanvas)。

[编辑：哎呀，我忘记了我最喜欢的 js 库[——Cake](http://glimr.rubyforge.org/cake/canvas.html#SVGParserTest)！它可以在画布中解析和显示svg，并且相信也支持IE]

[另一个编辑：Cake 实际上有一个[演示](http://glimr.rubyforge.org/cake/canvasmage.html)，做我认为你想做的事情]

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-13T11:42:58.460

看看[Raphael Javascript 库](http://raphaeljs.com/)。现在还为时过早，但看起来很有希望。

我记得在 IE7.2 中列出了支持 SVG 的 IE 路线图。

要看你想要怎样的交互性了？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-16T07:06:17.100

Can you clarify what you mean by the "Windows lock-in" thing with Silverlight? It runs on Windows and MacIntel, and the vector portions run just fine on Linux with the Moonlight plugin.

Were you thrown off by the lack of Amiga support?

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-13T09:55:05.933

查看已在许多浏览器中实现的新[Canvas元素。](http://en.wikipedia.org/wiki/Canvas_(HTML_element))我还听说有一个用于 IE 的 ActiveX 控件也实现了 Canvas 元素。

更新：等等，你已经说过了。下次我应该阅读整个问题！:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T01:11:24.100

Walter Zorn 有一个用于任意矢量图形的[JavaScript 库。](http://walterzorn.com/jsgraphics/jsgraphics_e.htm)它看起来不错。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-13T09:59:13.973

选择 SVG - 告诉用户为 IE 获取 ADOBE SVG 插件。

看到这个优秀的网站 - 这是一个英国政府网站（公共服务）

[埃尔金](http://www.elgin.gov.uk)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-13T10:12:54.227

IE 支持 VML，但没有其他支持，而且很丑。微软声称他们已经放弃了它（使用新的 XAML 和所有），但它仍然是 Office XML 格式的一部分（这就是 Excel .xlsx 支持评论的方式，很奇怪）。

FX 和负载更多支持新的 Canvas 元素。许多支持 SVG，但考虑到 MS 在 Silverlight 上所做的工作，我短期内看不到 IE 支持 SVG。

Microsoft 应该为非 MS 操作系统提供 Silverlight 插件。

我一直在使用 Flex——尽管使用了 Eclipse，它还是很不错的。您无需购买极其昂贵的 Adob​​e 服务器组件即可使用 Flex——它可以使用 SOAP 服务。

Flex 的开发工具非常实惠，几乎每个人都有 Flash。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-13T10:18:18.007

我不认为 SVG 是未来的好选择。来自[维基百科](http://en.wikipedia.org/wiki/Scalable_Vector_Graphics)：

*   “最常见的 IE 插件是由 Adob​​e 生产的。然而，Adobe 计划在 2009 年初退出该产品”
*   “... Internet Explorer 在即将推出的 IE8 版本中也将不支持 SVG”
*   “...对 SVG 1.1 的支持不完整...”
*   “Corel SVG Viewer 插件曾经由 Corel 提供。它的开发已经停止。”

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-13T12:43:36.933

在您列出的所有可能性中，唯一不严重滥用现有技术（Javascript）、几乎不支持（SVG、Canvas 元素）或大量工作（Java）的是 Flash。它被设计为矢量图形包，与 SVG 和 canvas 标签相比，兼容更多的浏览器。

我不会选择 Flash 而不是所有其他选项的唯一原因是，如果您的目标是移动浏览器或者没有 Flash 软件包的预算。

# c++ - 播放波形文件立即结束 (C++, Windows)

> ID：9629
> 
> 赞同：3
> 
> 时间：2008-08-13T10:04:40.610
> 
> 标签：c++, windows, waveout

我有以下情况。在一台机器上有一个**Fritz ISDN**卡。有一个进程负责在此设备的波形输出上播放某个波形文件（**ISDN**连接在启动时建立并保持不变）。这个场景很简单，只要需要，进程就会调用`waveOutWrite()`先前打开的 wave 设备（一切都初始化了，当然没有任何问题），并且回调函数等待`MM_WOM_DONE`msg 知道播放已经完成。

然而，几天后（过程和机器都没有改变）`MM_WOM_DONE`消息在调用后立即出现，`waveOutWrite()`即使波持续了几秒钟。再次没有报告错误，看起来文件已播放但长度为零（事实并非如此）。我也确信`waveOutReset()`我的进程没有调用它（它也会触发发送提到的消息）。过去我曾经遇到过一些奇怪的问题，只需重新安装**TAPI**驱动程序即可解决。这次由于某种原因，我再次执行该操作是有问题的，我正在尝试更多的分析方法:)。有什么建议可能导致这种行为吗？**也许在ISDN**线路的另一端有什么东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T19:38:03.403

根据您的描述，您正在异步播放。您确定当时没有清理 wav 文件的后备内存吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-14T14:43:52.520

我没有太多时间在谷歌上搜索这个，但我知道 Larry Osterman 或 Raymond Chen 都在博客上写过类似的情况。

当我有更多时间查看这个问题是否仍然存在时，我会稍后再回来查看。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-18T11:33:56.293

不播放声音时返回值是多少？如果您收到 MMSYSERR_NOERROR ，则表明驱动程序错误地向操作系统报告缓冲区已被处理。

WAV 文件本身是否发生了变化？此[博客条目](http://blogs.msdn.com/larryosterman/archive/2007/07/24/playsound-is-failing-on-vista-what-s-wrong.aspx)表明对元数据进行了一些非常深入的验证。

# wpf - WPF：如何设置或禁用 TextBox 的默认 ContextMenu

> ID：9632
> 
> 赞同：31
> 
> 时间：2008-08-13T10:05:41.747
> 
> 标签：wpf, xaml, .net-3.5

显然，当用户在我们的 WPF 应用程序中右键单击并使用 Windows 经典主题时，TextBox（包含复制、剪切和粘贴）的默认 ContextMenu 具有黑色背景。

我知道这很好用：

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"

      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

  <TextBox ContextMenu="{x:Null}"/>

</Page> 
```

但这不起作用：

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

<Page.Resources>

 <Style x:Key="{x:Type TextBox}" TargetType="{x:Type TextBox}">
   <Setter Property="ContextMenu" Value="{x:Null}"/>
</Style>
</Page.Resources>

  <TextBox/>
</Page> 
```

有谁知道如何为 WPF 中的所有 TextBox 设置样式或禁用默认 ContextMenu？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-08-13T14:36:20.810

要为所有文本框设置 ContextMenu 的样式，我会执行以下操作：

首先，在资源部分中，添加一个您计划在文本框中用作标准 ContextMenu 的 ContextMenu。
例如

```
<ContextMenu x:Key="TextBoxContextMenu" Background="White">
  <MenuItem Command="ApplicationCommands.Copy" />
  <MenuItem Command="ApplicationCommands.Cut" />
  <MenuItem Command="ApplicationCommands.Paste" />
</ContextMenu> 
```

其次，为您的 TextBoxes 创建一个样式，它使用上下文菜单资源：

```
<Style TargetType="{x:Type TextBox}">
  <Setter Property="ContextMenu" Value="{StaticResource TextBoxContextMenu}" />
</Style> 
```

最后，正常使用您的文本框：

```
<TextBox /> 
```

相反，如果您只想将此上下文菜单应用于某些文本框，请不要创建上面的样式，并将以下内容添加到您的 TextBox 标记中：

```
<TextBox ContextMenu="{StaticResource TextBoxContextMenu}" /> 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2010-08-14T20:15:03.323

奇怪。`ContextMenu="{x:Null}"`不成功。

但是，这样做：

```
<TextBox.ContextMenu>
    <ContextMenu Visibility="Collapsed">
    </ContextMenu>
</TextBox.ContextMenu> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-03-26T13:04:21.047

由于一个较晚的错误报告，我们发现我们不能直接在部分受信任的应用程序中使用 ApplicationComands 剪切粘贴和复制。因此，在您的控件的任何命令中使用这些命令在执行时绝对不会执行任何操作。

所以本质上布拉德斯的答案几乎就在那里，它看起来确实是正确的方式，即没有黑色背景，但没有解决问题。

我们决定根据 Brads 的回答“删除”菜单，如下所示：

```
<ContextMenu x:Key="TextBoxContextMenu" Width="0" Height="0" /> 
```

并像这样使用这个空的上下文菜单：

```
<Style TargetType="{x:Type TextBox}">
  <Setter Property="ContextMenu" Value="{StaticResource TextBoxContextMenu}" />
</Style> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-13T14:23:07.607

没关系，如果您不提供密钥，它将使用`TargetType`as 密钥，就像我的示例使用的方式一样:)

取自 MSDN 关于样式：

> 将`TargetType`属性设置为`TextBlock`类型而不设置`x:Key`隐式将 设置`x:Key`为`{x:Type TextBlock}`。这也意味着，如果您 > > 为上述 Style 赋予除 以外`x:Key`的任何值`{x:Type TextBlock}`，则 Style 不会自动应用于所有 TextBlock 元素。相反，您需要将样式`TextBlock`显式应用于元素。

[http://msdn.microsoft.com/en-us/library/system.windows.style.targettype.aspx](http://msdn.microsoft.com/en-us/library/system.windows.style.targettype.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-13T14:12:04.090

尝试从 Style 资源中删除 x:Key 属性，留下 TargetType。我知道，您应该拥有 x:Key 作为资源，但是如果您将它与 TargetType 一起拥有，则 Key 占上风。

这是我在一个项目中使用的示例样式，用于为我的一个应用程序中的所有工具提示设置皮肤（这是在 App.Resources--notice，no Key 中）

```
 <Style
    TargetType="{x:Type ToolTip}">
    <Setter
      Property="Template">
      <Setter.Value>
        <ControlTemplate
          TargetType="{x:Type ToolTip}">
          <Grid
            Width="{TemplateBinding Width}"
            Height="{TemplateBinding Height}">
            <Rectangle
              RadiusX="9"
              RadiusY="9"
              Stroke="LightGray"
              StrokeThickness="2">
              <Rectangle.Fill>
                <RadialGradientBrush>
                  <GradientStop />
                  <GradientStop
                    Color="FloralWhite"
                    Offset="0" />
                  <GradientStop
                    Color="Cornsilk"
                    Offset="2" />
                </RadialGradientBrush>
              </Rectangle.Fill>
            </Rectangle>
            <ContentPresenter
              Margin="6 4 6 4" />
          </Grid>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-12-20T05:35:30.757

这是我一直使用的方式：

```
 <TextBox x:Name="MyTextbox">
         <TextBox.ContextMenu>
         <ContextMenu Visibility="Hidden"/>
         </TextBox.ContextMenu>
      </TextBox> 
```

并且还可以使用：

```
 MyTextbox.ContextMenu.Visibility = Visibility.Hidden;
           MyTextbox.ContextMenu.Visibility = Visibility.Visble; 
```

# lisp - 没有 Emacs 的 Lisp/Scheme 解释器？

> ID：9650
> 
> 赞同：16
> 
> 时间：2008-08-13T11:06:12.747
> 
> 标签：lisp, scheme

一段时间以来，我一直想自学 Lisp。但是，我听说过的所有解释器都包含一些 emacs 风格。是否有任何命令行解释器，以便我可以在命令行中输入：

> lispinterpret 源文件.lisp

就像我可以运行 perl 或 python 一样。

虽然我还想更加熟悉 Emacs（如果只是为了在与使用 Emacs 的人一起工作时不会感到沮丧），我宁愿将学习 Emacs 与学习 Lisp 分离。

编辑：我实际上想关注使用Scheme的SICP，所以关于Scheme的答案会更有用。我只是不太熟悉这些差异。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-13T11:27:55.340

您也可以尝试[DrScheme](http://www.plt-scheme.org/)，它虽然不完全是独立的解释器，但也不是 emacs :)

它基本上是一个简单的 IDE，它有一个可以输入代码的区域，可以作为文件执行，然后另一个区域是可以与之交互的正在运行的解释器。

（另外，找到 UC Berkeley CS61A 播客并收听它们，以及阅读 SICP）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-13T11:55:48.700

看起来 Steel Bank Common Lisp (SBCL) 也可以满足您的需求：

[http://www.sbcl.org/manual/#Shebang-Scripts](http://www.sbcl.org/manual/#Shebang-Scripts)

SBCL 既是一流的又是开源的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-13T11:11:42.847

结帐 CLISP [wiki-link](http://en.wikipedia.org/wiki/CLISP)即。被保罗格雷厄姆使用

直接[链接](http://clisp.cons.org/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-15T16:36:10.477

我经常编写以这一行开头的 lisp shell 脚本：

#!/usr/bin/clisp

然后你甚至不需要在命令行输入“lispinterpret”。只需将脚本标记为可执行文件并直接运行即可。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-02-06T14:05:09.420

我熟悉的大多数方案解释器都可以从命令行运行。[（下面的大部分列表是从 Alexey Radul 的Scheme Implementation Choices](http://web.mit.edu/~axch/www/scheme/choices.html)页面的比较表中提取的。在 schemewiki 上[有](http://community.schemewiki.org/?scheme-faq-standards#implementations)更广泛的列表，但该页面没有立即提供命令行调用语法。）

以下是在命令行运行多个实现的方式：

*   [Chez 计划](http://www.scheme.com/): `scheme`,`petite`

*   [麻省理工学院计划](http://swiss.csail.mit.edu/projects/scheme/)：`mit-scheme`

*   [方案 48](http://s48.org/)：`scheme48`

*   [方案](http://www.rscheme.org/)：`rs`

*   [Racket](http://racket-lang.org/)：（`racket`但我建议尝试 DrRacket IDE，尤其是对于初学者。）

*   [诡计](http://www.gnu.org/software/guile/guile.html)：`guile`

*   [大卢](http://www-sop.inria.fr/mimosa/fp/Bigloo/)：`bigloo`

*   [鸡](http://www.call-with-current-continuation.org/)：`csi`

*   [策略](http://dynamo.iro.umontreal.ca/~gambit/wiki/index.php/Main_Page)：`gsi`

*   [左撇子](http://practical-scheme.net/gauche/)：`gosh`

*   [铁方案](http://ironscheme.codeplex.com/)：`IronScheme.Console`

*   [卡瓦](http://www.gnu.org/software/kawa/)：`kawa`，`java kawa.repl`

*   [盗窃](http://www.larcenists.org/)：`larceny`

*   [单片机](http://swissnet.ai.mit.edu/~jaffer/SCM.html)：`scm`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-10T19:01:31.737

如果您正在寻找与 SICP 一起使用的 Scheme，请查看 MIT/GNU Scheme

[http://groups.csail.mit.edu/mac/projects/scheme/](http://groups.csail.mit.edu/mac/projects/scheme/)

[http://www.gnu.org/software/mit-scheme/index.html](http://www.gnu.org/software/mit-scheme/index.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-27T23:54:23.033

Common Lisp 使用最广泛的 IDE，特别是在社区的自由软件子集中，实际上是[SLIME](http://common-lisp.net/project/slime/)，它在 Emacs 上运行。您可以使用您喜欢的任何 CL 编译器并按照您描述的方式调用 Lisp 源文件，但如果您这样做，您将无法利用许多在开发应用程序时非常有用的 Lisp 动态特性。

我建议你看一下这个[SLIME 演示视频](http://common-lisp.net/project/movies/movies/slime.mov)以了解我的意思，尽管此时它可能有点过时了。

如果问题是你（认为你）不喜欢 Emacs，我认真地建议你尝试学习它。严重地。不，真的，我是这个意思。但是，还有其他替代方案，例如由商业 Lisp 实现提供的 IDE，例如[Allegro](http://www.franz.com/products/allegrocl/)和[Lispworks （可免费试用），或名为](http://www.lispworks.com/downloads/index.html)[Cusp](http://bitfauna.com/projects/cusp/)的 Eclipse 插件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-13T11:13:43.433

[您是否从http://www.franz.com/](http://www.franz.com/)尝试过 Allegro CL ？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-14T00:45:14.373

@Nathan：我已经升级了 Common Lisp 链接，因为您询问了 Lisp（尤其是参考 Emacs Lisp）。然而，Common Lisp 与 Scheme 有很大不同。为一个人编写的程序不太可能在另一个人身上运行。

正如您所提到的，SICP 用于学习 Scheme，而不是 Lisp（或者至少不是 Common Lisp 和 Emacs Lisp）。原则上有一些重叠，但是您不能简单地从 SICP 剪切和粘贴代码并期望它在任何 Common Lisp 或 Emacs Lisp 系统上运行。:-)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-10T18:55:32.013

没有“解释器”需要 emacs。

此外，emacs 可以以无头方式运行 elisp。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-24T23:33:17.597

似乎方案外壳适合您的目的。看看[http://www.scsh.net/index.html](http://www.scsh.net/index.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-14T00:49:17.780

lisp 的另一个很好的方言是[cmucl](http://www.google.com/url?sa=t&ct=res&cd=1&url=http%3A%2F%2Fwww.cons.org%2Fcmucl%2F&ei=04CjSMesMIKWsAPkreiEDw&usg=AFQjCNEaD4T5bkSLBKWylon98jBsL7-IGA&sig2=W3p2EItQZ4NdWN8YCzPbRg)。他们过去喜欢吹嘘自己是“最快的”口齿不清。

# c# - 访问 C# 中的变量是原子操作吗？

> ID：9666
> 
> 赞同：65
> 
> 时间：2008-08-13T11:41:29.307
> 
> 标签：c#, multithreading

我一直相信，如果多个线程可以访问一个变量，那么对该变量的所有读取和写入都必须受到同步代码的保护，例如“锁定”语句，因为处理器可能会在中途切换到另一个线程一个写。

但是，我正在使用 Reflector 查看 System.Web.Security.Membership 并找到如下代码：

```
public static class Membership
{
    private static bool s_Initialized = false;
    private static object s_lock = new object();
    private static MembershipProvider s_Provider;

    public static MembershipProvider Provider
    {
        get
        {
            Initialize();
            return s_Provider;
        }
    }

    private static void Initialize()
    {
        if (s_Initialized)
            return;

        lock(s_lock)
        {
            if (s_Initialized)
                return;

            // Perform initialization...
            s_Initialized = true;
        }
    }
} 
```

为什么 s_Initialized 字段在锁之外读取？其他线程不能同时尝试写入它吗？**变量的读写是原子的吗？**

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-08-13T13:24:41.533

对于明确的答案去规范。:)

CLI 规范的第 I 部分第 12.6.6 节指出：“当对一个位置的所有写访问大小相同时，符合标准的 CLI 应保证对不大于本机字大小的正确对齐的内存位置的读写访问是原子的。”

这证实了 s_Initialized 永远不会不稳定，并且对小于 32 位的原始类型的读写是原子的。

特别是，`double`和`long`(`Int64`和`UInt64`)在 32 位平台上**不能保证是原子的。**您可以使用`Interlocked`类上的方法来保护这些。

此外，虽然读取和写入是原子的，但存在与加法、减法以及递增和递减原始类型的竞争条件，因为它们必须被读取、操作和重写。interlocked 类允许您使用`CompareExchange`和`Increment`方法保护这些。

互锁创建了一个内存屏障，以防止处理器重新排序读取和写入。在这个例子中，锁创建了唯一需要的屏障。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-09-16T15:50:29.737

这是双重检查锁定模式的（坏）形式，在 C# 中**不是**线程安全的！

这段代码有一个大问题：

s_Initialized 不是易失的。这意味着初始化代码中的写入可以在 s_Initialized 设置为 true 之后移动，并且其他线程可以看到未初始化的代码，即使 s_Initialized 对它们来说是 true。这不适用于 Microsoft 的框架实现，因为每次写入都是易失性写入。

而且在微软的实现中，未初始化数据的读取可以重新排序（即由 cpu 预取），因此如果 s_Initialized 为真，则读取应初始化的数据可能会由于缓存命中而导致读取旧的、未初始化的数据（即. 读取被重新排序）。

例如：

```
Thread 1 reads s_Provider (which is null)  
Thread 2 initializes the data  
Thread 2 sets s\_Initialized to true  
Thread 1 reads s\_Initialized (which is true now)  
Thread 1 uses the previously read Provider and gets a NullReferenceException 
```

在读取 s_Initialized 之前移动 s_Provider 的读取是完全合法的，因为在任何地方都没有 volatile 读取。

如果 s_Initialized 是易失性的，则在 s_Initialized 读取之前不允许移动 s_Provider 的读取，并且在 s_Initialized 设置为 true 并且现在一切正常之后，也不允许移动 Provider 的初始化。

Joe Duffy 也写了一篇关于这个问题的文章：[Broken variant on double-checked locking](http://joeduffyblog.com/2006/01/26/broken-variants-on-doublechecked-locking/)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-08-15T12:53:51.250

等一下——标题中的问题绝对不是 Rory 提出的真正问题。

名义问题的简单答案是“否”——但是当你看到真正的问题时，这根本没有帮助——我认为没有人给出简单的答案。

罗里提出的真正问题要晚得多，并且与他给出的例子更相关。

> 为什么 s_Initialized 字段在锁之外读取？

这个问题的答案也很简单，尽管与变量访问的原子性完全无关。

s_Initialized 字段是在锁之外读取的，因为**锁很昂贵**。

由于 s_Initialized 字段本质上是“一次写入”，因此它永远不会返回误报。

在锁外阅读它是经济的。

这是一项*低成本*的活动，具有*很高*的收益机会。

这就是为什么在锁之外读取它的原因——除非有说明，否则避免支付使用锁的成本。

如果锁很便宜，代码会更简单，并省略第一次检查。

*（编辑：来自 rory 的回应很好。是的，布尔读取是非常原子的。如果有人用非原子布尔读取构建了一个处理器，他们就会出现在 DailyWTF 上。）*

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-08-13T17:22:04.330

正确的答案似乎是，“是的，主要是”。

1.  John 引用 CLI 规范的回答表明，在 32 位处理器上访问不大于 32 位的变量是原子的。
2.  来自 C# 规范的进一步确认，第 5.5 节，[变量引用的原子性](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/variables#atomicity-of-variable-references)：

> 以下数据类型的读写是原子的：bool、char、byte、sbyte、short、ushort、uint、int、float 和引用类型。此外，上一个列表中具有基础类型的枚举类型的读取和写入也是原子的。其他类型的读取和写入，包括 long、ulong、double 和 decimal，以及用户定义的类型，不保证是原子的。

3.  我的示例中的代码是由 ASP.NET 团队自己编写的 Membership 类转述的，因此始终可以安全地假设它访问 s_Initialized 字段的方式是正确的。现在我们知道为什么了。

编辑：正如 Thomas Danecker 指出的那样，即使该字段的访问是原子的，s_Initialized 也应该真正标记为*volatile*，以确保处理器重新排序读取和写入时不会破坏锁定。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-13T12:08:29.220

初始化功能有问题。它应该看起来更像这样：

```
private static void Initialize()
{
    if(s_initialized)
        return;

    lock(s_lock)
    {
        if(s_Initialized)
            return;
        s_Initialized = true;
    }
} 
```

如果没有在锁内进行第二次检查，初始化代码可能会被执行两次。所以第一次检查是为了节省你不必要的锁的性能，第二次检查是针对线程正在执行初始化代码但尚未设置`s_Initialized`标志的情况，因此第二个线程将通过第一次检查并且在锁边等。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-13T12:34:20.057

我想您是在问`s_Initialized`在锁外读取时是否可能处于不稳定状态。最简洁的答案是不。一个简单的赋值/读取将归结为一条汇编指令，它在我能想到的每个处理器上都是原子的。

我不确定分配给 64 位变量的情况是什么，这取决于处理器，我认为它不是原子的，但它可能在现代 32 位处理器上，当然在所有 64 位处理器上。复杂值类型的赋值不会是原子的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-13T12:35:12.897

变量的读写不是原子的。您需要使用同步 API 来模拟原子读/写。

要获得有关此方面的精彩参考以及与并发有关的更多问题，请确保获取 Joe Duffy[最新奇观](https://rads.stackoverflow.com/amzn/click/com/032143482X)的副本。是开膛手！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-13T12:39:33.883

“访问 C# 中的变量是原子操作吗？”

没有。它不是 C# 的东西，甚至也不是 .net 的东西，它是处理器的东西。

OJ 认为 Joe Duffy 是获取此类信息的最佳人选。如果您想了解更多信息，“联锁”是一个很好的搜索词。

“撕裂读取”可能发生在其字段加起来超过指针大小的任何值上。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-13T13:28:47.013

> 您还可以使用 volatile 关键字装饰 s_Initialized 并完全放弃使用锁。

这是不正确的。在第一个线程有机会设置标志之前，您仍然会遇到第二个线程通过检查的问题，这将导致初始化代码的多次执行。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-02-28T01:35:36.470

对布尔值的`If (itisso) {`检查是原子的，但即使不是，也不需要锁定第一次检查。

如果任何线程完成了初始化，那么它就是真的。是否有多个线程同时检查并不重要。他们都会得到相同的答案，并且不会有冲突。

锁内的第二次检查是必要的，因为另一个线程可能已经先获取了锁并且已经完成了初始化过程。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-13T12:00:51.343

我认为它们是-我不确定您示例中的锁定点，除非您同时对 s_Provider 执行某些操作-然后锁定将确保这些调用一起发生。

该`//Perform initialization`评论是否涵盖创建 s_Provider？例如

```
private static void Initialize()
{
    if (s_Initialized)
        return;

    lock(s_lock)
    {
        s_Provider = new MembershipProvider ( ... )
        s_Initialized = true;
    }
} 
```

否则，静态属性-get 无论如何都会返回 null。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-13T12:16:39.860

您要问的是是否多次原子访问方法中的字段 - 答案是否定的。

在上面的示例中，初始化例程是错误的，因为它可能导致多次初始化。您需要检查`s_Initialized`锁内部和外部的标志，以防止多个线程在其中`s_Initialized`任何一个实际执行初始化代码之前读取标志的竞争条件。例如，

```
private static void Initialize()
{
    if (s_Initialized)
        return;

    lock(s_lock)
    {
        if (s_Initialized)
            return;
        s_Provider = new MembershipProvider ( ... )
        s_Initialized = true;
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-13T12:19:22.663

也许[互锁](http://msdn.microsoft.com/en-us/library/system.threading.interlocked(VS.85).aspx)提供了一个线索。否则[这个](http://msdn.microsoft.com/sv-se/magazine/cc188793(en-us).aspx)我很好。

我会猜到它们不是原子的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-08-30T22:59:27.060

为了使您的代码始终在弱排序架构上工作，您必须在编写 s_Initialized 之前放置一个 MemoryBarrier。

```
s_Provider = new MemershipProvider;

// MUST PUT BARRIER HERE to make sure the memory writes from the assignment
// and the constructor have been wriitten to memory
// BEFORE the write to s_Initialized!
Thread.MemoryBarrier();

// Now that we've guaranteed that the writes above
// will be globally first, set the flag
s_Initialized = true; 
```

在弱序处理器上写入 s_Initialized 之前，不能保证在 MembershipProvider 构造函数中发生的内存写入和对 s_Provider 的写入发生。

这个线程中有很多想法是关于某物是否是原子的。这不是问题。问题是**您的线程写入对其他线程可见的顺序**。在弱排序架构上，对内存的写入不会按顺序发生，这是真正的问题，而不是变量是否适合数据总线。

**编辑：**实际上，我在我的陈述中混合了平台。在 C# 中，CLR 规范要求写入是全局可见的、有序的（必要时通过对每个存储使用昂贵的存储指令）。因此，您实际上不需要在那里设置内存屏障。但是，如果是 C 或 C++，其中不存在这样的全局可见性顺序保证，并且您的目标平台可能具有弱排序的内存，并且它是多线程的，那么您需要在更新 s_Initialized 之前确保构造函数写入是全局可见的，在锁外进行测试。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-08-13T12:42:16.720

Ack，没关系......正如所指出的，这确实是不正确的。它不会阻止第二个线程进入“初始化”代码部分。呸。

> 您还可以使用 volatile 关键字装饰 s_Initialized 并完全放弃使用锁。

# c++ - 验证 Win32 窗口句柄

> ID：9667
> 
> 赞同：9
> 
> 时间：2008-08-13T11:42:13.860
> 
> 标签：c++, windows, winapi

给定一个类型的句柄，`HWND`是否可以确认该句柄代表一个真实的窗口？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-08-13T11:46:44.537

有一个功能`IsWindow`可以完全满足您的要求。

```
BOOL isRealHandle = IsWindow(unknwodnHandle); 
```

查看[此链接](http://msdn.microsoft.com/en-us/library/ms633528(VS.85).aspx)以获取更多信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-13T11:47:16.050

一般没有。当您确认 Window 有效时，另一个进程/线程我会出现并为您删除它。

# c# - 如何从 C# 数组中删除重复项？

> ID：9673
> 
> 赞同：235
> 
> 时间：2008-08-13T11:48:44.360
> 
> 标签：c#, arrays, duplicates

我一直在使用`string[]`从函数调用返回的 C# 中的数组。我可能会强制转换为一个`Generic`集合，但我想知道是否有更好的方法来做到这一点，可能是使用临时数组。

**从 C# 数组中删除重复项的最佳方法是什么？**

* * *

## 回答 #1

> 赞同：474
> 
> 时间：2008-08-13T12:03:05.940

您可以使用 LINQ 查询来执行此操作：

```
int[] s = { 1, 2, 3, 3, 4};
int[] q = s.Distinct().ToArray(); 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2008-08-13T13:50:14.383

这是[HashSet<string>](http://msdn.microsoft.com/en-us/library/bb359438.aspx)方法：

```
public static string[] RemoveDuplicates(string[] s)
{
    HashSet<string> set = new HashSet<string>(s);
    string[] result = new string[set.Count];
    set.CopyTo(result);
    return result;
} 
```

不幸的是，此解决方案还需要 .NET 框架 3.5 或更高版本，因为直到该版本才添加 HashSet。您还可以使用[array.Distinct()](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.distinct.aspx)，这是 LINQ 的一个功能。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-08-13T13:04:51.290

以下经过测试和工作的代码将从数组中删除重复项。您必须包含 System.Collections 命名空间。

```
string[] sArray = {"a", "b", "b", "c", "c", "d", "e", "f", "f"};
var sList = new ArrayList();

for (int i = 0; i < sArray.Length; i++) {
    if (sList.Contains(sArray[i]) == false) {
        sList.Add(sArray[i]);
    }
}

var sNew = sList.ToArray();

for (int i = 0; i < sNew.Length; i++) {
    Console.Write(sNew[i]);
} 
```

如果你愿意，你可以把它包装成一个函数。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-08-13T11:51:52.407

如果您需要对其进行排序，那么您可以实现一种同时删除重复项的排序。

用一块石头杀死两只鸟，然后。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-08-13T13:08:28.383

这可能取决于您想要设计解决方案的程度 - 如果数组永远不会那么大并且您不关心对列表进行排序，您可能想尝试类似于以下内容：

```
 public string[] RemoveDuplicates(string[] myList) {
        System.Collections.ArrayList newList = new System.Collections.ArrayList();

        foreach (string str in myList)
            if (!newList.Contains(str))
                newList.Add(str);
        return (string[])newList.ToArray(typeof(string));
    } 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-08-13T14:19:38.427

> ```
> List<String> myStringList = new List<string>();
> foreach (string s in myStringArray)
> {
>     if (!myStringList.Contains(s))
>     {
>         myStringList.Add(s);
>     }
> } 
> ```

这是**O(n^2)**，这对于将被塞入组合中的短列表无关紧要，但可能很快成为大集合的问题。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-12-06T17:50:22.073

这是使用**O(1)**空间的**O(n*n)**方法。

 **```
void removeDuplicates(char* strIn)
{
    int numDups = 0, prevIndex = 0;
    if(NULL != strIn && *strIn != '\0')
    {
        int len = strlen(strIn);
        for(int i = 0; i < len; i++)
        {
            bool foundDup = false;
            for(int j = 0; j < i; j++)
            {
                if(strIn[j] == strIn[i])
                {
                    foundDup = true;
                    numDups++;
                    break;
                }
            }

            if(foundDup == false)
            {
                strIn[prevIndex] = strIn[i];
                prevIndex++;
            }
        }

        strIn[len-numDups] = '\0';
    }
} 
```

上面的**hash/linq**方法是您在现实生活中通常使用的方法。然而，在采访中，他们通常希望设置一些约束，例如排除散列或没有内部**api**的常量空间- 排除使用**LINQ**。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-07-03T07:50:20.640

-- 这是每次**面试都会问的问题。**现在我完成了它的编码。

```
static void Main(string[] args)
{    
            int[] array = new int[] { 4, 8, 4, 1, 1, 4, 8 };            
            int numDups = 0, prevIndex = 0;

            for (int i = 0; i < array.Length; i++)
            {
                bool foundDup = false;
                for (int j = 0; j < i; j++)
                {
                    if (array[i] == array[j])
                    {
                        foundDup = true;
                        numDups++; // Increment means Count for Duplicate found in array.
                        break;
                    }                    
                }

                if (foundDup == false)
                {
                    array[prevIndex] = array[i];
                    prevIndex++;
                }
            }

            // Just Duplicate records replce by zero.
            for (int k = 1; k <= numDups; k++)
            {               
                array[array.Length - k] = '\0';             
            }

            Console.WriteLine("Console program for Remove duplicates from array.");
            Console.Read();
        } 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2012-02-14T06:07:27.103

```
protected void Page_Load(object sender, EventArgs e)
{
    string a = "a;b;c;d;e;v";
    string[] b = a.Split(';');
    string[] c = b.Distinct().ToArray();

    if (b.Length != c.Length)
    {
        for (int i = 0; i < b.Length; i++)
        {
            try
            {
                if (b[i].ToString() != c[i].ToString())
                {
                    Response.Write("Found duplicate " + b[i].ToString());
                    return;
                }
            }
            catch (Exception ex)
            {
                Response.Write("Found duplicate " + b[i].ToString());
                return;
            }
        }              
    }
    else
    {
        Response.Write("No duplicate ");
    }
} 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-08-13T12:53:33.233

将所有字符串添加到字典中，然后获取 Keys 属性。这将产生每个唯一的字符串，但不一定按照您原始输入的顺序。

如果您要求最终结果与原始输入具有相同的顺序，则当您考虑每个字符串的第一次出现时，请改用以下算法：

1.  有一个列表（最终输出）和一个字典（检查重复项）
2.  对于输入中的每个字符串，检查它是否已经存在于字典中
3.  如果没有，请将其添加到字典和列表中

最后，列表包含每个唯一字符串的第一次出现。

确保在构建字典时考虑文化等因素，以确保正确处理带有重音字母的重复项。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2010-04-15T09:31:27.883

以下代码尝试从 ArrayList 中删除重复项，尽管这不是最佳解决方案。我在一次采访中被问到这个问题，通过递归删除重复项，而不使用第二个/临时数组列表：

```
private void RemoveDuplicate() 
{

ArrayList dataArray = new ArrayList(5);

            dataArray.Add("1");
            dataArray.Add("1");
            dataArray.Add("6");
            dataArray.Add("6");
            dataArray.Add("6");
            dataArray.Add("3");
            dataArray.Add("6");
            dataArray.Add("4");
            dataArray.Add("5");
            dataArray.Add("4");
            dataArray.Add("1");

            dataArray.Sort();

            GetDistinctArrayList(dataArray, 0);
}

private void GetDistinctArrayList(ArrayList arr, int idx)

{

            int count = 0;

            if (idx >= arr.Count) return;

            string val = arr[idx].ToString();
            foreach (String s in arr)
            {
                if (s.Equals(arr[idx]))
                {
                    count++;
                }
            }

            if (count > 1)
            {
                arr.Remove(val);
                GetDistinctArrayList(arr, idx);
            }
            else
            {
                idx += 1;
                GetDistinctArrayList(arr, idx);
            }
        } 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2012-12-21T20:33:57.970

也许 hashset 不存储重复元素并默默地忽略添加重复项的请求。

```
static void Main()
{
    string textWithDuplicates = "aaabbcccggg";     

    Console.WriteLine(textWithDuplicates.Count());  
    var letters = new HashSet<char>(textWithDuplicates);
    Console.WriteLine(letters.Count());

    foreach (char c in letters) Console.Write(c);
    Console.WriteLine("");

    int[] array = new int[] { 12, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2 };

    Console.WriteLine(array.Count());
    var distinctArray = new HashSet<int>(array);
    Console.WriteLine(distinctArray.Count());

    foreach (int i in distinctArray) Console.Write(i + ",");
} 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2015-03-12T21:21:17.337

简单的解决方案：

```
using System.Linq;
...

public static int[] Distinct(int[] handles)
{
    return handles.ToList().Distinct().ToArray();
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-08-13T13:09:23.233

注意：未经测试！

```
string[] test(string[] myStringArray)
{
    List<String> myStringList = new List<string>();
    foreach (string s in myStringArray)
    {
        if (!myStringList.Contains(s))
        {
            myStringList.Add(s);
        }
    }
    return myStringList.ToString();
} 
```

可能会做你需要的...

**编辑**啊！！！不到一分钟就被抢劫打败了！

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2013-06-15T07:18:39.957

测试了以下内容并且可以正常工作。很酷的是它也进行了文化敏感搜索

```
class RemoveDuplicatesInString
{
    public static String RemoveDups(String origString)
    {
        String outString = null;
        int readIndex = 0;
        CompareInfo ci = CultureInfo.CurrentCulture.CompareInfo;

        if(String.IsNullOrEmpty(origString))
        {
            return outString;
        }

        foreach (var ch in origString)
        {
            if (readIndex == 0)
            {
                outString = String.Concat(ch);
                readIndex++;
                continue;
            }

            if (ci.IndexOf(origString, ch.ToString().ToLower(), 0, readIndex) == -1)
            {
                //Unique char as this char wasn't found earlier.
                outString = String.Concat(outString, ch);                   
            }

            readIndex++;

        }

        return outString;
    }

    static void Main(string[] args)
    {
        String inputString = "aAbcefc";
        String outputString;

        outputString = RemoveDups(inputString);

        Console.WriteLine(outputString);
    } 
```

}

--AptSenSDET

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2014-07-05T14:14:47.693

此代码 100% 从数组中删除重复值[就像我使用 a[i]] .....您可以将其转换为任何 OO 语言..... :)

```
for(int i=0;i<size;i++)
{
    for(int j=i+1;j<size;j++)
    {
        if(a[i] == a[j])
        {
            for(int k=j;k<size;k++)
            {
                 a[k]=a[k+1];
            }
            j--;
            size--;
        }
    }

} 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2018-10-13T04:32:53.637

通用扩展方法：

```
public static IEnumerable<TSource> Distinct<TSource>(this IEnumerable<TSource> source, IEqualityComparer<TSource> comparer)
{
    if (source == null)
        throw new ArgumentNullException(nameof(source));

    HashSet<TSource> set = new HashSet<TSource>(comparer);
    foreach (TSource item in source)
    {
        if (set.Add(item))
        {
            yield return item;
        }
    }
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2015-04-12T09:12:09.183

您可以在使用 ArrayList 时使用此代码

```
ArrayList arrayList;
//Add some Members :)
arrayList.Add("ali");
arrayList.Add("hadi");
arrayList.Add("ali");

//Remove duplicates from array
  for (int i = 0; i < arrayList.Count; i++)
    {
       for (int j = i + 1; j < arrayList.Count ; j++)
           if (arrayList[i].ToString() == arrayList[j].ToString())
                 arrayList.Remove(arrayList[j]); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2016-02-02T05:21:18.120

```
public static int RemoveDuplicates(ref int[] array)
{
    int size = array.Length;

    // if 0 or 1, return 0 or 1:
    if (size  < 2) {
        return size;
    }

    int current = 0;
    for (int candidate = 1; candidate < size; ++candidate) {
        if (array[current] != array[candidate]) {
            array[++current] = array[candidate];
        }
    }

    // index to count conversion:
    return ++current;
} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2016-10-05T08:14:13.787

下面是 java 中的一个简单逻辑，您遍历数组的元素两次，如果您看到任何相同的元素，您将其分配为零，而且您不会触及您正在比较的元素的索引。

```
import java.util.*;
class removeDuplicate{
int [] y ;

public removeDuplicate(int[] array){
    y=array;

    for(int b=0;b<y.length;b++){
        int temp = y[b];
        for(int v=0;v<y.length;v++){
            if( b!=v && temp==y[v]){
                y[v]=0;
            }
        }
    }
} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2020-05-24T08:57:45.697

最好的办法？很难说，HashSet 方法看起来很快，但是（取决于数据）使用排序算法（CountSort ？）可以更快。

```
using System;
using System.Collections.Generic;
using System.Linq;
class Program
{
    static void Main()
    {
        Random r = new Random(0); int[] a, b = new int[1000000];
        for (int i = b.Length - 1; i >= 0; i--) b[i] = r.Next(b.Length);
        a = new int[b.Length]; Array.Copy(b, a, b.Length);
        a = dedup0(a); Console.WriteLine(a.Length);
        a = new int[b.Length]; Array.Copy(b, a, b.Length);
        var w = System.Diagnostics.Stopwatch.StartNew();
        a = dedup0(a); Console.WriteLine(w.Elapsed); Console.Read();
    }

    static int[] dedup0(int[] a)  // 48 ms  
    {
        return new HashSet<int>(a).ToArray();
    }

    static int[] dedup1(int[] a)  // 68 ms
    {
        Array.Sort(a); int i = 0, j = 1, k = a.Length; if (k < 2) return a;
        while (j < k) if (a[i] == a[j]) j++; else a[++i] = a[j++];
        Array.Resize(ref a, i + 1); return a;
    }

    static int[] dedup2(int[] a)  //  8 ms
    {
        var b = new byte[a.Length]; int c = 0;
        for (int i = 0; i < a.Length; i++) 
            if (b[a[i]] == 0) { b[a[i]] = 1; c++; }
        a = new int[c];
        for (int j = 0, i = 0; i < b.Length; i++) if (b[i] > 0) a[j++] = i;
        return a;
    }
} 
```

几乎没有分支。如何？调试模式，使用小数组进入 (F11)：{1,3,1,1,0}

```
 static int[] dedupf(int[] a)  //  4 ms
    {
        if (a.Length < 2) return a;
        var b = new byte[a.Length]; int c = 0, bi, ai, i, j;
        for (i = 0; i < a.Length; i++)
        { ai = a[i]; bi = 1 ^ b[ai]; b[ai] |= (byte)bi; c += bi; }
        a = new int[c]; i = 0; while (b[i] == 0) i++; a[0] = i++;
        for (j = 0; i < b.Length; i++) a[j += bi = b[i]] += bi * i; return a;
    } 
```

具有两个嵌套循环的解决方案可能需要一些时间，尤其是对于较大的数组。

```
 static int[] dedup(int[] a)
    {
        int i, j, k = a.Length - 1;
        for (i = 0; i < k; i++)
            for (j = i + 1; j <= k; j++) if (a[i] == a[j]) a[j--] = a[k--];
        Array.Resize(ref a, k + 1); return a;
    } 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-11-30T08:03:58.673

```
 private static string[] distinct(string[] inputArray)
        {
            bool alreadyExists;
            string[] outputArray = new string[] {};

            for (int i = 0; i < inputArray.Length; i++)
            {
                alreadyExists = false;
                for (int j = 0; j < outputArray.Length; j++)
                {
                    if (inputArray[i] == outputArray[j])
                        alreadyExists = true;
                }
                        if (alreadyExists==false)
                        {
                            Array.Resize<string>(ref outputArray, outputArray.Length + 1);
                            outputArray[outputArray.Length-1] = inputArray[i];
                        }
            }
            return outputArray;
        } 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-06-06T23:58:18.570

```
int size = a.Length;
        for (int i = 0; i < size; i++)
        {
            for (int j = i + 1; j < size; j++)
            {
                if (a[i] == a[j])
                {
                    for (int k = j; k < size; k++)
                    {
                        if (k != size - 1)
                        {
                            int temp = a[k];
                            a[k] = a[k + 1];
                            a[k + 1] = temp;

                        }
                    }
                    j--;
                    size--;
                }
            }
        } 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-08-17T11:15:08.640

所以我正在做一个面试会议，并得到同样的问题来分类和区分

```
static void Sort()
    {
        try
        {
            int[] number = new int[Convert.ToInt32(Console.ReadLine())];
            for (int i = 0; i < number.Length; i++)
            {
                number[i] = Convert.ToInt32(Console.ReadLine());
            }
            Array.Sort(number);
            int[] num = number.Distinct().ToArray();
            for (int i = 0; i < num.Length; i++)
            {
                Console.WriteLine(num[i]);
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex);
        }
        Console.Read();
    } 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2019-04-25T17:28:08.597

```
using System;
using System.Collections.Generic;
using System.Linq;

namespace Rextester
{
    public class Program
    {
        public static void Main(string[] args)
        {
             List<int> listofint1 = new List<int> { 4, 8, 4, 1, 1, 4, 8 };
           List<int> updatedlist= removeduplicate(listofint1);
            foreach(int num in updatedlist)
               Console.WriteLine(num);
        }

        public static List<int> removeduplicate(List<int> listofint)
         {
             List<int> listofintwithoutduplicate= new List<int>();

              foreach(var num in listofint)
                 {
                  if(!listofintwithoutduplicate.Any(p=>p==num))
                        {
                          listofintwithoutduplicate.Add(num);
                        }
                  }
             return listofintwithoutduplicate;
         }
    }

} 
```

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2019-10-03T16:23:56.443

```
strINvalues = "1,1,2,2,3,3,4,4";
strINvalues = string.Join(",", strINvalues .Split(',').Distinct().ToArray());
Debug.Writeline(strINvalues); 
```

Kkk 不确定这是巫术还是漂亮的代码

**1** strINvalues .Split(',').Distinct().ToArray()

**2** string.Join(",", XXX);

*1*拆分数组并使用 Distinct [LINQ] 删除重复项 *2*在没有重复项的情况下将其重新加入。

对不起，我从来没有读过 StackOverFlow 上的文字，只是代码。它比文字更有意义；）

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2020-07-30T04:47:24.300

使用 Distinct & StringComparer.InvariantCultureIgnoreCase 删除重复并忽略区分大小写

```
string[] array = new string[] { "A", "a", "b", "B", "a", "C", "c", "C", "A", "1" };
var r = array.Distinct(StringComparer.InvariantCultureIgnoreCase).ToList();
Console.WriteLine(r.Count); // return 4 items 
```

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2020-10-25T00:10:43.430

在下面找到答案。

```
class Program
{
    static void Main(string[] args)
    {
        var nums = new int[] { 1, 4, 3, 3, 3, 5, 5, 7, 7, 7, 7, 9, 9, 9 };
        var result = removeDuplicates(nums);
        foreach (var item in result)
        {
            Console.WriteLine(item);
        }
    }
    static int[] removeDuplicates(int[] nums)
    {
        nums = nums.ToList().OrderBy(c => c).ToArray();
        int j = 1;
        int i = 0;
        int stop = 0;
        while (j < nums.Length)
        {
            if (nums[i] != nums[j])
            {
                nums[i + 1] = nums[j];
                stop = i + 2;
                i++;
            }
            j++;
        }
        nums = nums.Take(stop).ToArray();
        return nums;
    }
} 
```

只是基于我刚刚解决的测试的一点贡献，可能对这里其他顶级贡献者的改进有所帮助和开放。以下是我所做的事情：

1.  我使用了 OrderBy，它允许我使用 LINQ 从小到大对项目进行排序或排序
2.  然后我将其转换回数组，然后将其重新分配回主数据源
3.  所以我然后将我的数组右侧的 j 初始化为 1，将数组的左侧的 i 初始化为 0，我还将我要停止的位置初始化为 0。
4.  我使用 while 循环通过从一个位置到另一个位置从左到右递增数组，对于每个递增，停止位置是 i + 2 的当前值，稍后我将使用它来截断数组中的重复项。
5.  然后，我通过从 if 语句从左到右移动以及在 if 语句之外从右到右移动来递增，直到我遍历数组的整个值。
6.  然后我从第一个元素选择到停止位置，该位置成为最后一个 i 索引加 2。这样我就可以从 int 数组中删除所有重复项。然后重新分配。

# concurrency - 文档服务器：处理并发保存

> ID：9675
> 
> 赞同：2
> 
> 时间：2008-08-13T11:49:14.250
> 
> 标签：concurrency, locking, versioning

我正在实现一个文档服务器。目前，如果两个用户打开同一个文档，然后对其进行修改并保存更改，则文档的状态将是未定义的（第一个用户的更改被永久保存，或者第二个用户的更改）。这完全不能令人满意。我考虑了解决这个问题的两种可能性：

第一种是第一次打开文档时锁定，关闭时解锁。但如果与服务器的网络连接突然中断，文档将处于永久锁定状态。显而易见的解决方案是定期向服务器发送 ping。如果服务器没有连续接收到来自特定客户端的 K 个 ping (K > 1)，则由该客户端锁定的文档将被解锁。如果该客户再次出现，文档将再次被锁定，如果有人尚未锁定它们。如果客户端应用程序（在 Web 浏览器中运行）意外终止，这也可能会有所帮助，从而无法向服务器发送“退出，解锁我的文档”信号。

二是存储不同用户保存的同一文档的多个版本。如果快速连续地对文档进行更改，系统将提供合并版本或选择首选版本。为了优化存储空间，应该只保留文档差异（就像源代码控制软件一样）。

考虑到与服务器的连接*有时*可能很慢且无响应，我应该选择哪种方法？应该如何确定参数（ping 间隔、快速连续间隔）？

PS 不幸的是，我无法将文档存储在数据库中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-13T13:26:57.580

您描述的第一个选项本质上是悲观锁定模型，而第二个选项是乐观模型。选择哪一个实际上取决于许多因素，但基本上归结为企业希望如何运作。例如，如果他们需要编辑的文档被另一个用户锁定，会不会给用户带来过度的不便？如果文档被锁定并且有人在与他们的客户端连接的情况下去度假会发生什么？每个文档的可能争用是什么——即两个用户同时修改同一个文档的可能性有多大？单个文档中修改的本地化程度如何？（如果定期修改同一部分，则执行合并可能比简单地再次进行更改需要更长的时间）。

假设争用相对较低和/或每个更改的大小相当小，那么我可能会选择一个乐观模型，该模型使用自动或手动合并来解决冲突。文档内容的版本号或校验和可用于确定是否需要合并。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-13T12:10:43.240

我的建议会像你的第一个。当第一个用户（Bob）打开文档时，他会获得一个锁，以便其他用户只能阅读当前文档。如果用户在使用文档时保存了文档，他将保持锁定状态。只有当他退出文档时，它才被解锁，其他人可以编辑它。

如果第二个用户 (Kate) 在 Bob 锁定文档时打开文档，Kate 将收到一条消息，指出文档不可编辑，但她可以阅读它，直到锁定被释放。

那么当 Bob 获得锁时会发生什么，可能会保存文档一两次，但随后退出应用程序而使锁处于挂起状态？

正如您自己所说，要求具有锁的客户端以特定频率发送 ping 可能是最好的选择。如果您在一定时间内没有从客户端收到 ping，这实际上意味着他的客户端不再响应。如果这是一个 Web 应用程序，您可以使用 javascript 进行 ping。上次保存的文档释放了它的锁定，Kate 现在可以获取它。

ping 可以包含客户端锁定的文档的名称，并且服务器可以计算收到该文档的最后一次 ping 的时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-13T14:07:32.273

目前，文件由有限的一组人发布，每个人都在一个单独的主题上工作。因此，锁带来的不便被最小化了。人们大多扩展现有文档并纠正其中的错误。

谈到悲观模型，可以通过将锁定到期日期设置为锁定开始日期前一天来避免“左客户端连接 N 天”的情况。因为编辑的文档绝不是关键任务，并且很少被多个用户修改，这可能就足够了。

现在考虑乐观模型。如果文档有一些规则的（比如，分层的）结构，应该如何检测差异？如果不？在这些情况下，自动合并成功的机会有多大？

情况变得更加复杂，因为一些文档（由 'admins' 用户组编辑）包含重要的配置信息（文档全局索引、用户角色等）。在我看来，锁对于这类信息更有利，因为它不是每天都在变化的。所以一些混合解决方案可能是可以接受的。

你怎么看？

# sql - 动态搜索多个 sql 表的需要模式

> ID：9687
> 
> 赞同：7
> 
> 时间：2008-08-13T12:06:07.383
> 
> 标签：sql, database-design, design-patterns, dynamic-sql, table-structure

我正在寻找一种在多个表上执行动态搜索的模式。

我无法控制遗留（且设计不佳）的数据库表结构。

考虑类似于简历搜索的场景，其中用户可能希望对简历中的任何数据执行搜索，并获取与其搜索条件匹配的简历列表。任何字段都可以随时与一个或多个其他字段组合进行搜索。

实际的 sql 查询是根据搜索的字段动态创建的。我发现的大多数解决方案都涉及复杂的 if 块，但我不禁认为必须有一个更优雅的解决方案，因为现在这必须是一个已解决的问题。

* * *

是的，所以我开始了在代码中动态构建 sql 的路径。看起来很可怕。如果我真的尝试支持查询任何表中任何字段的任何组合的请求能力，这将是一组 MASSIVE 语句。 *颤抖*

* * *

我相信我读到 COALESCE 仅在您的数据不包含 NULL 时才有效。那是对的吗？如果是这样，那就不行，因为我到处都有 NULL 值。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-13T14:29:36.487

As far as I understand (and I'm also someone who has written against a horrible legacy database), there is no such thing as dynamic WHERE clauses. It has NOT been solved.

Personally, I prefer to generate my dynamic searches in code. Makes testing convenient. Note, when you create your sql queries in code, don't concatenate in user input. Use your @variables!

The only alternative is to use the COALESCE operator. Let's say you have the following table:

```
Users
-----------
Name nvarchar(20)
Nickname nvarchar(10) 
```

and you want to search optionally for name or nickname. The following query will do this:

```
SELECT Name, Nickname
FROM Users
WHERE
    Name = COALESCE(@name, Name) AND
    Nickname =  COALESCE(@nick, Nickname) 
```

If you don't want to search for something, just pass in a null. For example, passing in "brian" for @name and null for @nick results in the following query being evaluated:

```
SELECT Name, Nickname
FROM Users
WHERE
    Name = 'brian' AND
    Nickname =  Nickname 
```

The coalesce operator turns the null into an identity evaluation, which is always true and doesn't affect the where clause.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-04T00:59:33.697

你需要的是像[SphinxSearch](http://sphinxsearch.com/) (for MySQL) 或[Apache Lucene](http://lucene.apache.org/java/docs/)这样的东西。

正如您在示例中所说，让我们想象一个由几个字段组成的简历：

*   项目清单
*   姓名，
*   地址，
*   教育（这可能是一张单独的桌子）或
*   工作经验（这可能会增长到自己的表格，其中每一行代表以前的工作）

因此，使用 WHERE 在所有这些字段中搜索一个单词很快就会变成一个包含多个 JOINS 的非常长的查询。

相反，您可以更改您的参考框架并将整个简历视为单个文档，而您只想搜索该文档。

这就是 Sphinx Search 等工具的作用。他们为您的“文档”创建一个全文索引，然后您可以查询狮身人面像，它会告诉您在数据库中找到该记录的位置。

真的很好的搜索结果。

不要担心这个工具不是您的 RDBMS 的一部分，使用适当的模型“文档”与不正确的模型“表”用于此应用程序，它将为您省去很多麻烦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-13T14:56:15.420

Search and normalization can be at odds with each other. So probably first thing would be to get some kind of "view" that shows all the fields that can be searched as a single row with a single key getting you the resume. then you can throw something like [Lucene](http://lucene.apache.org/java/docs/) in front of that to give you a full text index of those rows, the way that works is, you ask it for "x" in this view and it returns to you the key. Its a great solution and come recommended by joel himself on the podcast within the first 2 months IIRC.

# visual-studio - 安装 Visual Studio 2008 后，Visual Studio 2005 宏停止工作

> ID：9693
> 
> 赞同：0
> 
> 时间：2008-08-13T12:11:07.657
> 
> 标签：visual-studio, visual-studio-2008, ide, visual-studio-2005, macros

我有许多为 Visual Studio 2005 编写的宏，但是一旦我在我的计算机上安装了 Visual Studio 2008，它们就停止工作了。当我尝试运行它时，宏没有返回错误，并且环境仅显示沙漏一秒钟，然后返回到正常光标。目前无法卸载其中一个，我想知道是否有办法让宏再次工作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-13T12:51:50.490

您可能需要安装（重新安装）VS 2005 SP1，因为 Microsoft 于 7 月 10 日发布的安全更新 (KB928365) 可能会导致该问题。

# database - 默认数据库 ID；系统和用户价值

> ID：9702
> 
> 赞同：1
> 
> 时间：2008-08-13T12:23:37.863
> 
> 标签：database

作为我们当前数据库工作的一部分，我们正在研究处理更新数据库的过程。

反复提到的一点是处理系统与用户价值的问题；在我们的项目中，用户和系统 vals 存储在一起。例如...

我们有一个模板列表。

```
1, <system template>

2, <system template>

3, <system template> 
```

这些在应用程序中映射到枚举 (1, 2, 3)

然后一个用户进来并添加......

```
4, <user template> 
```

...和...

```
5, <user template> 
```

然后......我们发出升级......并作为升级脚本的一部分插入......

```
<new id> [6], <new system template> 
```

那么！！...我们在新的系统模板中发现了一个错误，需要对其进行更新...问题是怎么回事？我们无法使用 ID6 更新记录（因为我们可能已将其插入为 9 或 999，因此我们必须使用其他机制来识别记录）

因此，我们为此提出了两种可能的解决方案。

## **在红角（速度）....**

我们只需从 5000（或其他值）开始用户 ID，并在 10000（或其他值）处测试数据。这将允许我们对系统值进行修改并测试它们直到下一个 ID 范围的下限。

优势...快速且易于实施，

缺点...如果我们不选择足够大的范围，可能会用完值！

## **在蓝色角落（可扩展性）......**

我们分别存储、系统和用户数据，使用 GUID 作为 Id，并使用视图合并两个列表。

优势...可扩展...对数据库大小没有限制。

缺点..实现起来比较复杂。（多对一可更新视图等）

* * *

我对第一个选项非常满意，但正在寻找一些弹药来支持我！

有没有人对这些方法有任何想法，甚至是我们错过的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-13T12:36:21.193

我建议使用第二个修改，将系统和用户值存储在一个表中。GUID 以这种方式非常可靠。

另一个想法：使用任何基于文本的 ID（不是必需的 GUID），它是您为系统值提供的，由随机字符串或基于用户值的某种自定义逻辑的字符串生成。

另一个想法：使用第一种方法，但使用一个标志扩展表，该标志显示一个值是系统还是用户。也许这是最简单的。好的，您必须编写某种机制来更新正确的系统值，但这很容易完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-13T12:51:41.067

Biri 基于文本的 ID +1 - 定义一个“template_mnemonic”基于文本的列并使其成为主键。当您将其插入时，这将是一个已知值，开发人员将决定使用它（或自动生成它），并且无论有多少用户指定的模板，您将始终能够通过其助记符引用模板。它还允许用户对其模板有一个有意义的命名约定。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-13T14:06:58.013

我从未遇到过使用 GUID 作为数据库 ID 的问题（性能或开发 - 包括 TDD 和单元测试），而且我已经处理了一些相当大的问题。如果您想了解更多关于使用 GUID（以及可能涉及的 GOTCHAS）作为主键的信息，请查看[此处](http://www.sql-server-performance.com/articles/per/guid_performance_p2.aspx)、[此处](http://weblogs.asp.net/wwright/archive/2007/11/04/the-gospel-of-the-guid-and-why-it-matters.aspx)和[此处](http://weblogs.asp.net/wwright/archive/2007/11/11/gospel-of-the-guid-answers-to-your-burning-questions-comments-and-insults.aspx)- 但我不能高度推荐它，因为安全地移动数据和数据库同步变得如此简单就像早上刷牙一样:-)

对于您上面的问题，我会推荐第三列（如果可能的话），指示模板是基于用户还是基于系统，或者您至少可以在插入系统模板时为系统模板生成 GUID 并保留一个列表那些手头的，所以如果您需要更新模板，您可以在您的 DEV、UAT 和/或 PRODUCTION 数据库中定位相同的 GUID，而不必担心覆盖其他模板。尽管可以随意选择所有系统或用户模板，但第三列会派上用场，而无需将它们分成两个表（恕我直言，这是矫枉过正）。

我希望这会有所帮助，

抢G

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-13T12:30:47.867

也许我没听懂，但是您不能将 GUID 用作 Id 并且仍然将用户和系统数据放在一起吗？然后，您可以通过（不可更改的）GUID 访问系统数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-13T12:47:39.407

我不认为 GUID 应该有任何问题。

如果你想避免它，那么使用一个标志：

> 身份证号码
> 
> 模板随便
> 
> 标志枚举/int/bool

标志显示实际值是系统值还是用户值。

如果您想更新系统值，则仅询问按 ID 排序的系统值，它会显示实际的插入顺序（您应该有一个 bigint 或 ID 以确保它不会被填满，并且它不会让已删除的 ID 恢复工作）。有了这个列表，x。记录是 x。插入的系统值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-18T14:08:13.550

我认为有更好的第三种解决方案。让我感到震惊的是，您将两个不同的东西存储在同一个表中，并且您最好创建两个单独的表，一个用于用户模板，一个用于系统模板。然后，您可能能够在这两个表上创建一个视图，以使它们在您的应用程序中显示为单个对象。显然我不完全了解您的应用程序，这对您来说可能是不可能的，但我认为这是一个比 GUID 更简洁的解决方案，并且比 ID 范围更安全（真的不要做 ID 范围它会有一天咬你）

# mfc - 调用CComboBox::ShowDropDown后如何防止鼠标光标隐藏？

> ID：9704
> 
> 赞同：2
> 
> 时间：2008-08-13T12:28:57.057
> 
> 标签：mfc, mouse, visibility, ccombobox

在我的 MFC 应用程序中，当我调用 CComboBox::ShowDropDown() 时，鼠标光标被隐藏，直到与组合框的交互完成（当组合框失去焦点时。）当鼠标移动时它不会重新出现，就像它一样带有编辑框。

如何让鼠标光标不被隐藏？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-13T12:31:26.023

称呼

```
SetCursor(LoadCursor(NULL, IDC_ARROW));
```

在 ShowDropDown() 调用之后立即。

# visual-studio - 如何扩展项目属性页面？

> ID：9729
> 
> 赞同：4
> 
> 时间：2008-08-13T12:50:10.557
> 
> 标签：visual-studio, visual-studio-2008, vsx, extensibility

是否可以在 Visual Studio 2008 的项目属性页面中添加自定义选项卡？我想要做的是能够为从默认项目模板（WPF 应用程序、WPF 自定义控件库等）创建的项目添加一个自定义选项卡到属性页面。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-22T10:50:17.123

基思，

我正在开发用于 WPF 应用程序本地化的 VS 插件。我希望能够通过“项目属性”页面管理项目特定设置。我做了一些研究，似乎不可能以这种方式扩展现有项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-01-19T12:34:28.657

似乎在问这个问题的时候，这个功能没有在 Visual Studio SDK 中实现。

有类似问题的答案[https://stackoverflow.com/a/5325158/2617201](https://stackoverflow.com/a/5325158/2617201)指的是[添加和删除属性页](https://docs.microsoft.com/en-us/visualstudio/extensibility/adding-and-removing-property-pages?view=vs-2015&redirectedfrom=MSDN)中的 Microsoft 文档。文章参考Visual Studio 2015（以后的版本应该有同样的功能）。

# c# - C#.Net 不区分大小写的字符串

> ID：9734
> 
> 赞同：7
> 
> 时间：2008-08-13T12:53:20.550
> 
> 标签：c#, .net

为什么 C#.Net 允许字符串对象的声明不区分大小写？

```
String sHello = "Hello";
string sHello = "Hello"; 
```

单词 String 的小写和大写 S 都是可接受的，这似乎是唯一允许这样做的对象。

谁能解释为什么？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-08-13T12:57:34.520

**`string`**是语言关键字，`System.String`而是其别名的类型。

两者都编译成完全相同的东西，类似地：

*   **`int`**是`System.Int32`
*   **`long`**是`System.Int64`
*   **`float`**是`System.Single`
*   **`double`**是`System.Double`
*   **`char`**是`System.Char`
*   **`byte`**是`System.Byte`
*   **`short`**是`System.Int16`
*   **`ushort`**是`System.UInt16`
*   **`uint`**是`System.UInt32`
*   **`ulong`**是`System.UInt64`

我认为在大多数情况下，这与代码的易读性有关——所有基本的系统值类型都有别名，我认为小写`string`可能只是为了保持一致性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-13T13:03:54.100

除了其他答案，最好使用关键字（如果存在）。

例如，您应该使用**string**而不是**System.String**。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-13T12:55:14.523

“字符串”是类的名称。“字符串”是映射此类的关键字。

一样

*   Int32 => 整数
*   十进制 => 十进制
*   Int64 => 长

... 等等...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-13T12:57:26.767

“字符串”是 C# 关键字。它只是“System.String”的别名——.NET BCL 类之一。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-13T12:58:46.733

“字符串”只是系统命名空间中“字符串”类的 C# 别名。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-13T12:56:39.200

string 是 System.String 的别名。他们是一样的东西。

但是，按照惯例，类型 (System.String) 的对象通常称为别名 - 例如

```
string myString = "Hello"; 
```

而对类的操作使用大写版本，例如

```
String.IsNullOrEmpty(myStringVariable); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-13T18:59:36.410

我使用字符串而不是字符串，使用 Int32 而不是 int，这样我的语法高亮显示将字符串作为类型而不是关键字。我希望关键字在我身上跳出来。

# virtualization - What kind of servers did you virtualize lately?

> ID：9749
> 
> 赞同：2
> 
> 时间：2008-08-13T13:00:23.063
> 
> 标签：virtualization

I wonder what type of servers for internal usage you virtualize in the last -say- 6 months. Here's what we got virtual so far:

*   mediawiki
*   bugtracker (mantis)
*   subversion

We didn't virtualize spezialized desktop PCs which are running a certain software product, that is only used once in a while. Do you plan to get rid of those old machines any time soon?

And which server products do you use? Vmware ESX, Vmware Server, Xen installations...?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T16:40:04.877

我对此类问题的标准回答是，“虚拟化很棒；注意它的局限性”。

我永远不会依赖任何基础设施级服务的纯虚拟实现（例如，您站点的权威 DNS 服务器；管理和监控工具）。

我在一家提供服务器和网络管理工具的公司工作。我们一直在努力克服虚拟化供应商的营销缺陷，因为基础设施工具不应该存在于基础设施工具中。

虚拟化想要控制您的所有服务。但是，有些东西应该始终存在于物理硬件上。

当您的虚拟设置出现问题时，故障排除和恢复可能需要很长时间。如果您仍在物理硬件上运行公司所需的一些服务，那么您就不会死在水中。

虚拟化还引入了时钟延迟、磁盘和网络 IO 延迟，以及您在物理硬件上看不到的其他问题。

最后，您选择的虚拟化工具将负责其托管虚拟机的所有资源。这转化为管理程序——而不是你——决定在任何给定时刻哪个 VM 应该具有优先级。如果您担心任何工具、服务或功能保证拥有某些资源，则它需要在物理硬件上。

对于任何“无关紧要”的东西，例如 Web、邮件、dhcp、ldap 等 - 虚拟化都很棒。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T20:50:01.497

我们虚拟化了测试客户端和服务器的副本，因此我们可以在将文件发送给客户之前对其进行部署。他们还习惯于测试错误报告。

我们发现这是虚拟化的最大好处，因为我们可以保留大量每个客户的版本。

我们还虚拟化了我们的网络服务器，公司部门已经虚拟化了一切。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T20:30:03.777

We use ESX in our labs and lately we've virtualized our document sharing service (KnowledgeTree), the lab management tools and almost all of our department's internal web servers.

We also virtualized almost all of our QA department's test machines, with the exception of the performance and stability testing hardware.

We aren't going to get rid of the hardware any time soon, it will be used to decrease the budget needs and increase the number of projects that can be handled by one lab.

We use VMware ESX 3.5.x exclusively.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-13T13:09:08.583

Our build machine running FinalBuilder runs on a Windows XP Virtual Machine running in VMWare Server on Linux.

It is very practical to move it and also to backup, we just stop the Virtual Machine and copy the disk image.

Some days ago we needed to change the host pc, it took less than 2 hours to have our builder up and running on another pc.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-13T13:47:04.810

We migrate to a new SBS 2005 Domain last month. We take the opotunity to create virtual machines for the following servers

*   Buid Machine
*   Svn Repository Machine
*   Bug Traking Machine (FogBugz)
*   Testing Databases

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-13T13:51:31.557

I recently had to build an internal network for our training division, enabling the classrooms to be networked and have access to various technologies. Because of the lack of hardware and equipment and running in an exclusive cash only environment I decided to go with a virtual solution on the server.

The server itself is running CentOS 5.1 with VMWare 1.0.6 loaded as the virtualisation provider. On top of this we have 4 Windows Server 2003 machines running, making up the Active Directory, Exchange, ISA, Database and Windows/AV updates component. File sharing and internet routing through the corporate network and ADSL is handled via the CentOS platform.

The setup allows us to expand to physical machines at a later stage quickly, and allows the main server to replaced with minimum downtime on the network, as it only requires the moving of the Virtual Machines and starting them up on the new box.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T20:24:57.127

*   项目管理 (dotProject)
*   通用测试服务器（IIS、PHP 等）

你打算很快摆脱那些旧机器吗？不

您使用哪些服务器产品？微软虚拟服务器

# language-agnostic - How can I reverse the ON bits in a byte?

> ID：9750
> 
> 赞同：5
> 
> 时间：2008-08-13T13:00:48.523
> 
> 标签：language-agnostic

I was reading Joel's book where he was suggesting as interview question:

> Write a program to reverse the "ON" bits in a given byte.

I only can think of a solution using C.

Asking here so you can show me how to do in a Non C way (if possible)

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-08-15T21:13:29.450

我声称技巧问题。:) 反转所有位意味着触发器，但只有打开的位明确表示：

```
return 0; 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-08-13T14:44:10.780

> What specifically does that question mean?

Good question. If reversing the "ON" bits means reversing only the bits that are "ON", then you will always get 0, no matter what the input is. If it means reversing *all* the bits, i.e. changing all 1s to 0s and all 0s to 1s, which is how I initially read it, then that's just a bitwise NOT, or complement. C-based languages have a complement operator, `~`, that does this. For example:

```
unsigned char b = 102;      /* 0x66, 01100110 */
unsigned char reverse = ~b; /* 0x99, 10011001 */ 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-13T13:03:17.253

What specifically does that question mean?

Does *reverse* mean setting 1's to 0's and vice versa?

Or does it mean *00001100* --> *00110000* where you reverse their order in the byte? Or perhaps just reversing the part that is from the first 1 to the last 1? ie. *00110101* --> *00101011*?

Assuming it means reversing the bit order in the whole byte, here's an x86 assembler version:

```
; al is input register
; bl is output register

xor bl, bl      ; clear output

; first bit
rcl al, 1       ; rotate al through carry
rcr bl, 1       ; rotate carry into bl

; duplicate above 2-line statements 7 more times for the other bits 
```

not the most optimal solution, a table lookup is faster.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-13T13:04:59.433

Reversing the order of bits in C#:

```
byte ReverseByte(byte b)
{
    byte r = 0;
    for(int i=0; i<8; i++)
    {
        int mask = 1 << i;
        int bit = (b & mask) >> i;
        int reversedMask = bit << (7 - i);
        r |= (byte)reversedMask;
    }
    return r;
} 
```

I'm sure there are more clever ways of doing it but in that precise case, the interview question is meant to determine if you know bitwise operations so I guess this solution would work.

In an interview, the interviewer usually wants to know how you find a solution, what are you problem solving skills, if it's clean or if it's a hack. So don't come up with too much of a clever solution because that will *probably* mean you found it somewhere on the Internet beforehand. Don't try to fake that you don't know it neither and that you just come up with the answer because you are a genius, this is will be even worst if she figures out since you are basically lying.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-14T17:48:17.627

> 我可能记错了，但我认为 Joel 的问题是关于计算“on”位而不是反转它们。

干得好：

```
#include <stdio.h>

int countBits(unsigned char byte);

int main(){
  FILE* out = fopen( "bitcount.c" ,"w");

  int i;
  fprintf(out, "#include <stdio.h>\n#include <stdlib.h>\n#include <time.h>\n\n");

  fprintf(out, "int bitcount[256] = {");
  for(i=0;i<256;i++){
    fprintf(out, "%i", countBits((unsigned char)i));
    if( i < 255 ) fprintf(out, ", ");
  }
  fprintf(out, "};\n\n");

  fprintf(out, "int main(){\n");

  fprintf(out, "srand ( time(NULL) );\n");
  fprintf(out, "\tint num = rand() %% 256;\n");
  fprintf(out, "\tprintf(\"The byte %%i has %%i bits set to ON.\\n\", num, bitcount[num]);\n");

  fprintf(out, "\treturn 0;\n");
  fprintf(out, "}\n");
  fclose(out);

  return 0;
}

int countBits(unsigned char byte){
  unsigned char mask = 1;
  int count = 0;
  while(mask){
    if( mask&byte ) count++;
    mask <<= 1;
  }
  return count;
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-08-13T15:11:45.810

If you're talking about switching 1's to 0's and 0's to 1's, using Ruby:

```
n = 0b11001100
~n 
```

If you mean reverse the order:

```
n = 0b11001100
eval("0b" + n.to_s(2).reverse) 
```

If you mean counting the on bits, as mentioned by another user:

```
n = 123
count = 0
0.upto(8) { |i| count = count + n[i] } 
```

♥ Ruby

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-14T01:43:01.493

这是一个直接从[OpenJDK](http://openjdk.java.net/)剪切和粘贴的版本，这很有趣，因为它不涉及循环。另一方面，与我发布的 Scheme 版本不同，此版本仅适用于 32 位和 64 位数字。:-)

32 位版本：

```
public static int reverse(int i) {
    // HD, Figure 7-1
    i = (i & 0x55555555) << 1 | (i >>> 1) & 0x55555555;
    i = (i & 0x33333333) << 2 | (i >>> 2) & 0x33333333;
    i = (i & 0x0f0f0f0f) << 4 | (i >>> 4) & 0x0f0f0f0f;
    i = (i << 24) | ((i & 0xff00) << 8) |
        ((i >>> 8) & 0xff00) | (i >>> 24);
    return i;
} 
```

64 位版本：

```
public static long reverse(long i) {
    // HD, Figure 7-1
    i = (i & 0x5555555555555555L) << 1 | (i >>> 1) & 0x5555555555555555L;
    i = (i & 0x3333333333333333L) << 2 | (i >>> 2) & 0x3333333333333333L;
    i = (i & 0x0f0f0f0f0f0f0f0fL) << 4 | (i >>> 4) & 0x0f0f0f0f0f0f0f0fL;
    i = (i & 0x00ff00ff00ff00ffL) << 8 | (i >>> 8) & 0x00ff00ff00ff00ffL;
    i = (i << 48) | ((i & 0xffff0000L) << 16) |
        ((i >>> 16) & 0xffff0000L) | (i >>> 48);
    return i;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-08-13T13:05:31.400

The classic [Bit Hacks](http://graphics.stanford.edu/~seander/bithacks.html) page has several (really very clever) ways to do this, but it's all in C. Any language derived from C syntax (notably Java) will likely have similar methods. I'm sure we'll get some Haskell versions in this thread ;)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-08-13T13:15:42.393

> `byte ReverseByte(byte b) { return b ^ 0xff; }`

That works if `^` is XOR in your language, but not if it's `AND`, which it often is.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-08-15T21:29:21.820

伪代码..

```
while (Read())
  Write(0); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-13T17:57:13.243

我可能记错了，但我认为 Joel 的问题是关于**计算**“on”位而不是反转它们。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-24T00:51:51.847

这是用于补充位的强制性 Haskell 解决方案，它使用库函数补码：

```
import Data.Bits
import Data.Int

i = 123::Int
i32 = 123::Int32
i64 = 123::Int64
var2 = 123::Integer

test1 = sho i
test2 = sho i32
test3 = sho i64
test4 = sho var2 -- Exception

sho i = putStrLn $ showBits i ++ "\n" ++ (showBits $complement i)
showBits  v = concatMap f (showBits2 v) where
   f False = "0"
   f True  = "1"
showBits2 v = map (testBit v) [0..(bitSize v - 1)] 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-08-15T20:16:18.473

I'd modify palmsey's second example, eliminating a bug and eliminating the `eval`:

```
n = 0b11001100
n.to_s(2).rjust(8, '0').reverse.to_i(2) 
```

The `rjust` is important if the number to be bitwise-reversed is a fixed-length bit field -- without it, the reverse of `0b00101010` would be `0b10101` rather than the correct `0b01010100`. (Obviously, the 8 should be replaced with the length in question.) I just got tripped up by this one.

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-08-15T20:52:06.497

如果问题意味着翻转所有位，并且不允许使用类似 C 的运算符，例如 XOR 和 NOT，那么这将起作用：

```
bFlipped = -1 - bInput; 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-08-15T22:00:20.243

> 在这里询问，以便您可以向我展示如何以**非 C 方式**进行操作（如果可能）

假设您有数字 10101010。要将 1 更改为 0（反之亦然），您只需使用 XOR：

```
 10101010
^11111111
 --------
 01010101 
```

用手做这件事就像你会得到的那样“非C”。

然而，从问题的措辞来看，它听起来真的*只是*关闭“ON”位......在这种情况下，答案为零（正如已经提到的）（当然，除非问题实际上是要求交换位）。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-07-29T04:02:19.390

Reversing the bits. For example we have a number represented by 01101011 . Now if we reverse the bits then this number will become 11010110\. Now to achieve this you should first know how to do swap two bits in a number. Swapping two bits in a number:- XOR both the bits with one and see if results are different. If they are not then both the bits are same otherwise XOR both the bits with XOR and save it in its original number; Now for reversing the number FOR I less than Numberofbits/2 swap(Number,I,NumberOfBits-1-I);

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-08-14T01:35:32.260

由于该问题要求采用非 C 方式，因此这是一个 Scheme 实现，愉快地从[SLIB](http://people.csail.mit.edu/jaffer/SLIB)抄袭：

```
(define (bit-reverse k n)
  (do ((m (if (negative? n) (lognot n) n) (arithmetic-shift m -1))
       (k (+ -1 k) (+ -1 k))
       (rvs 0 (logior (arithmetic-shift rvs 1) (logand 1 m))))
      ((negative? k) (if (negative? n) (lognot rvs) rvs))))

(define (reverse-bit-field n start end)
  (define width (- end start))
  (let ((mask (lognot (ash -1 width))))
    (define zn (logand mask (arithmetic-shift n (- start))))
    (logior (arithmetic-shift (bit-reverse width zn) start)
            (logand (lognot (ash mask start)) n)))) 
```

重写为 C（对于不熟悉 Scheme 的人），它看起来像这样（理解在 Scheme 中，数字可以任意大）：

```
int
bit_reverse(int k, int n)
{
    int m = n < 0 ? ~n : n;
    int rvs = 0;
    while (--k >= 0) {
        rvs = (rvs << 1) | (m & 1);
        m >>= 1;
    }
    return n < 0 ? ~rvs : rvs;
}

int
reverse_bit_field(int n, int start, int end)
{
    int width = end - start;
    int mask = ~(-1 << width);
    int zn = mask & (n >> start);
    return (bit_reverse(width, zn) << start) | (~(mask << start) & n);
} 
```

# asp.net - 发送电子邮件而不像垃圾邮件

> ID：9751
> 
> 赞同：5
> 
> 时间：2008-08-13T13:01:08.023
> 
> 标签：asp.net, email

我希望每周通过电子邮件发送更新。但是我担心如果发送的邮件太多，就会被标记为垃圾邮件。你们中的任何人都有每周发送许多电子邮件（数千封）的经验吗？你使用什么技术？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-19T00:12:23.860

> 对于一个积极的垃圾邮件发送者来说，这个问题的一个很好的答案将是一个真正的金矿:)

并非如此 - 正如您将在[其他线程](https://stackoverflow.com/questions/371/how-do-you-make-sure-email-you-send-programmatically-is-not-automatically-marke)中看到的那样，答案集中在表明您是电子邮件的权威发件人，以及对垃圾邮件发送者无用而对发送大量电子邮件的非垃圾邮件发送者有用的各个方面。

# eclipse - Can I script FlexBuilder without writing an extension?

> ID：9769
> 
> 赞同：0
> 
> 时间：2008-08-13T13:09:58.440
> 
> 标签：eclipse, flexbuilder, textmate

I'd like to script FlexBuilder so that I can run debug or profile without having to switch to FlexBuilder and manually clicking the button (or using the key combo). Is this possible without writing an extension?

To be more specific, this is exactly what I want to do: I want to create a TextMate command that talks to FlexBuilder and makes it run the debug target for the currently selected project. TextMate already has support for interacting with Xcode in this way, and it would be great to be able to do the same with FlexBuilder.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-13T15:19:19.180

When compiling I use Ant and have full control over that from TextMate, what I want is to be able to launch the *debugger* and the *profiler*. The command line debugger is unusable and there is no other profiler available than the one in FlexBuilder.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-13T13:34:49.077

Since FlexBuilder essentially is an extended version of Eclipse, any tools/scripts for doing the same in Eclipse should work for FlexBuilder aswell. I couldn't find any tools like this googling it, have you considered doing away with FlexBuilder completely, there are plenty of guides for using the mxmlc (or fcsh) compilers directly from your editor.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T12:26:39.617

我不知道 Eclipse 是否有这样的插件，但如果没有，您可以编写一个，因为它应该很容易。

如果您要调用的特定命令显示在**Windows/Preferences** - **General/Keys**中，您可以创建一个插件，从 TextMate 获取命令（我不知道 TextMate 使用什么协议、套接字或其他东西）并执行特定操作与也出现在首选项中的命令相关联。

# sql-server - Oracle XE 或 SQL Server Express

> ID：9783
> 
> 赞同：8
> 
> 时间：2008-08-13T13:18:30.950
> 
> 标签：sql-server, database, oracle-xe

我在这里开始一个新项目（Windows 窗体）。对于小型（像啤酒一样免费）DBMS，今天最好的选择是什么？

我在过去的项目中使用过 SQL Server Express，但我一次又一次听到人们说 Oracle 的产品更快、更强大。

它将在一家小公司（大约 20 个用户）中使用，并且不会很快达到 4 GB 的限制:)

我不想在我的第一篇文章中引发一场激烈的战争，所以如果可能的话，请指向一些链接，显示这两种产品之间的良好（和实际）比较。

PS：我也听说过[IBM DB2 Express](http://en.wikipedia.org/wiki/IBM_DB2_Express-C)，但我找不到任何关于它的信息。（来自 IBM 的营销材料不包括在内 :)）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-13T14:08:32.753

我会选择**SQL Server Express**解决方案，除非您绝对必须使用 Oracle 中 SQL Server 没有的功能并且您没有可用的解决方法。

Oracle 的优势示例：

*   Oracle ROCK 中的分析函数！
*   [PL/SQL](http://en.wikipedia.org/wiki/PL/SQL)比[T-SQL](http://en.wikipedia.org/wiki/Transact-SQL)更好。
*   如果您要将系统扩展到 1,000 名用户，所有用户都更新相同的小数据集
*   您可以扩展到多 TB 数据库，
*   您需要扩展以在服务器中需要大量 CPU（超过 8 个）。
*   需要即时故障转移 ( [RAC](http://en.wikipedia.org/wiki/Oracle_RAC) )
*   你*真的不能*承受失去一笔交易。

也许你可以说，我是甲骨文的忠实粉丝！但我认为 Oracle Express 是对 SQL Server Express 的商业反应，我认为 Oracle*内心深处*并不喜欢它。

*   您知道 SQL Server 有一个升级路径（SQL Server 2008 即将推出）以及服务包。
*   SQL Express 也比 Oracle 更“一劳永逸”。
*   它将更好地与您的 IDE 集成（如果您使用 .NET）

就速度而言，两者都将在如此小的数据集大小下快速发光。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-13T13:29:39.680

考虑到您概述的需求，无论哪种方式都很难争论，哪一种都会比另一个更重要。

我要说的是：

1.  你说你对 SSExpress 已经很熟悉了，那就是坚持下去的好理由
2.  恕我直言，带有 SSExpress 的工具比 Oracle 同类工具更优越且更易于使用

也就是说，我在 SS 方面的经验比 Oracle 多得多，所以 YMMV。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-13T13:32:06.430

抱歉，没有链接，但有一个建议。因为我们支持 Oracle 和 SQL Server，所以我知道修复“普通”Oracle 数据库并不是我所说的有趣的事情。您必须为此付费，如果您没有工具可以为您更新 Oracle 系统，那么如果您问我，那将是一个痛苦的过程。查看更新/修复如何支持 Oracle XE。我不知道，我只使用“普通”的 Oracle（开发人员）数据库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T05:35:58.763

我认为每隔一段时间重新考虑一下事情是很棒的，当你在一个路口考虑替代产品是非常聪明的。

如果您擅长优化系统并且具备 dba 级别的技能，我会考虑使用 PostgreSQL。我不认为自己是 dba 并且具有中等的数据库技能，并且发现 SQL Server Express 非常易于使用。此外，我的产品超出了 SQL Server Express 的限制 - 向 SQL Server Standard/Enterprise 的过渡是无缝的。

我意识到这在技术层面上并不重要，但拉里·埃里森用他的利润购买飞机和妓女。比尔·盖茨正在用他的方法解决对人类极为重要的问题。在所有条件相同的情况下，我总是更愿意把钱给比尔盖茨。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-13T13:26:38.657

这有什么用：

[https://web.archive.org/web/1/http://downloads.techrepublic%2ecom%2ecom/5138-9592-6028761.html](https://web.archive.org/web/1/http://downloads.techrepublic%2ecom%2ecom/5138-9592-6028761.html)

NB 需要注册

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-13T13:33:50.250

KiwiBastard 的两个观点都非常好，我完全同意他的观点。

如果你真的想要一个类似于 MS SQL 并且在需要时支持增长的免费替代方案，你可以看看 MySQL 或 PostgreSQL。SQLite 似乎也是一个不错的选择。如果您在一家有 20 名员工的公司工作，那么您当然可以买得起一台旧的 Linux 服务器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-13T13:49:13.853

100% SQL Express，比Oracle更容易安装和维护。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T16:46:21.857

恕我直言，SQL Server 的主要问题，长期以来一直是，没有多版本读取一致性。幸运的是，自具有快照隔离级别的 SQL Server 2005 以来，此问题已得到纠正。

如果您正在为需要最少维护知识的小型项目寻找一个好的 RDBMS，[SQL Server Express Edition](http://en.wikipedia.org/wiki/SQL_Server_Express)是一个不错的选择。SQL Server Express Edition UI 比[RMAN或](http://en.wikipedia.org/wiki/RMAN)[Oracle 数据库 XE](http://en.wikipedia.org/wiki/Oracle_Database#Marketing_editions)中包含的“更容易”使用的备份脚本更容易理解，后者需要使您的数据库脱机。

Oracle 数据库 XE 在我的 *** 列表中。他们最近发布了一个未正确编译的 Linux ODBC 驱动程序（[ld](http://en.wikipedia.org/wiki/GNU_linker)返回所需 ODBC 函数的缺失符号）完全可用（10.2.0.4）。即使对于“免费”产品，由于缺乏对任何合理数量的 QA 的关注，我会三思而后行。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-09-14T13:12:23.327

对于[DB2 Express-C，请参阅](http://db2express.com/en/)：

> “DB2 Express-C™ 是世界上最先进的数据库管理系统之一的免费版本。当您可以免费获得所需的一切时，为什么还要付费？DB2 Express-C 可以免费开发、部署和分发。
> 
> 它是一个快速、安全、可靠且具有惊人可扩展性的数据服务器，非常适合大多数初创公司和中小型企业。DB2 Express-C 9.7 可在 Linux、Unix、Windows 以及现在的 Mac OS X 上使用！它还使开发人员能够通过称为 pureXML™ 的本机存储技术轻松处理 XML。无论您使用 Java、.Net、Ruby、Python、Perl 还是几乎任何其他编程语言进行开发，DB2 都可以成为您的技术优势。”

# c# - 将 DateTime 周数计算为行

> ID：9805
> 
> 赞同：7
> 
> 时间：2008-08-13T13:38:56.043
> 
> 标签：c#, asp.net

我目前正在用 ASP.Net C# 编写一个小日历。目前为了生成一周的行，我执行以下 for 循环：

```
var iWeeks = 6;
for (int w = 0; w < iWeeks; w++) { 
```

这很好用，但是，有些月只有 5 周，在极少数情况下，有 4 周。

如何计算特定月份所需的行数？

这是我正在创建的示例：

![在此处输入图像描述](https://i.stack.imgur.com/NkxN7.png)

但是，正如您在上个月看到的那样，只需要 5 行。以本月（2008 年 8 月）为例，该月从星期六开始，在第 6 周/第 6 行的星期一结束。

***在谷歌上找到的图片***

* * *

这是我正在创建的示例：

![在此处输入图像描述](https://i.stack.imgur.com/NkxN7.png)

但是，正如您在上个月看到的那样，只需要 5 行。以本月（2008 年 8 月）为例，该月从星期六开始，在第 6 周/第 6 行的星期一结束。

***在谷歌上找到的图片***

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-13T14:03:39.223

这是执行此操作的方法：

```
public int GetWeekRows(int year, int month)
{
    DateTime firstDayOfMonth = new DateTime(year, month, 1);
    DateTime lastDayOfMonth = new DateTime(year, month, 1).AddMonths(1).AddDays(-1);
    System.Globalization.Calendar calendar = System.Threading.Thread.CurrentThread.CurrentCulture.Calendar;
    int lastWeek = calendar.GetWeekOfYear(lastDayOfMonth, System.Globalization.CalendarWeekRule.FirstFourDayWeek, DayOfWeek.Monday);
    int firstWeek = calendar.GetWeekOfYear(firstDayOfMonth, System.Globalization.CalendarWeekRule.FirstFourDayWeek, DayOfWeek.Monday);
    return lastWeek - firstWeek + 1;
} 
```

您可以通过修改 System.Globalization.CalendarWeekRule.FirstFourDayWeek 部分来自定义日历周规则。我希望代码是不言自明的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-13T13:46:30.317

好吧，这取决于您使用的文化，但假设您可以使用 Thread.CurrentThread.CurrentCulture，那么获取今天星期的代码将是：

```
Culture culture = Thread.CurrentThread.CurrentCulture;
Calendar cal = culture.Calendar;
Int32 week = cal.GetWeekOfYear(DateTime.Today,
    culture.DateTimeFormat.CalendarWeekRule,
    culture.DateTimeFormat.FirstDayOfWeek); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-13T13:39:47.850

如何检查第一天和最后一天将在哪一周？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-13T13:43:42.023

儒略历/公历中的月份每年都有相同的天数，除了 2 月，根据年份的闰年可以有 28 天或 29 天。您可以在[http://en.wikipedia.org/wiki/Gregorian_calendar](http://en.wikipedia.org/wiki/Gregorian_calendar)的描述部分找到天数。

正如@darkdog 提到的，你有 DateTime.DaysInMonth。只需这样做：

```
var days = DateTime.DaysInMonth(year, month) + 
           WhatDayOfWeekTheMonthStarts(year, month);    
int rows = (days / 7);  
if (0 < days % 7)  
{  
    ++rows;
} 
```

考虑到出于全球化/本地化目的，世界某些地区使用不同的日历/年度组织方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-13T13:45:22.613

试试这个，

```
DateTime.DaysInMonth 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-13T13:46:46.480

检查[Calendar.GetWeekOfYear](https://docs.microsoft.com/en-in/dotnet/api/system.globalization.calendar.getweekofyear)。它应该可以解决问题。

它有一个问题，它不遵循 ISO 8601 的 4 天规则，但除此之外它很整洁。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-13T13:47:42.297

您可以使用 DateTime.DaysInMonth(int WhichYear,int WhichMonth);

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-13T13:49:48.300

问题不在于该月的天数，而在于它跨越了多少周。

非闰年的 2 月将有 28 天，如果该月的第一天是星期一，则 2 月将恰好跨越 4 周数字。

但是，如果该月的第一天是星期二或一周中的任何其他日期，则 2 月将跨越 5 个周数。

一个 31 天的月份可以以同样的方式跨越 5 或 6 周。如果该月从星期一开始，则 31 天为您提供 5 个周数。如果月份从星期六或星期日开始，它将跨越 6 周数。

所以获取这个数字的正确方法是找到该月的第一天和最后一天的周数。

* * *

**编辑#1**：这是计算给定月份跨度的周数的方法： **编辑#2**：修复了代码中的错误

```
public static Int32 GetWeekForDateCurrentCulture(DateTime dt)
{
    CultureInfo culture = Thread.CurrentThread.CurrentCulture;
    Calendar cal = culture.Calendar;
    return cal.GetWeekOfYear(dt,
        culture.DateTimeFormat.CalendarWeekRule,
        culture.DateTimeFormat.FirstDayOfWeek);
}

public static Int32 GetWeekSpanCountForMonth(DateTime dt)
{
    DateTime firstDayInMonth = new DateTime(dt.Year, dt.Month, 1);
    DateTime lastDayInMonth = firstDayInMonth.AddMonths(1).AddDays(-1);
    return
        GetWeekForDateCurrentCulture(lastDayInMonth)
        - GetWeekForDateCurrentCulture(firstDayInMonth)
        + 1;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-13T13:57:34.930

首先找出该月的第一天在哪个工作日。只需使用第一天新建一个日期时间，始终为 1，以及相关的年份和月份，它上面有一个星期几属性。

然后从这里，您可以使用该月的天数，`DateTime.DaysInMonth`来确定除以 7 的周数，然后将第一天从 1 开始的天数相加。例如，

```
public static int RowsForMonth(int month, int year)
{
    DateTime first = new DateTime(year, month, 1);

    //number of days pushed beyond monday this one sits
    int offset = ((int)first.DayOfWeek) - 1;

    int actualdays = DateTime.DaysInMonth(month, year) +  offset;

    decimal rows = (actualdays / 7);
    if ((rows - ((int)rows)) > .1)
    {
        rows++;
    }
    return rows;
} 
```

# javascript - Mootools：拖放问题

> ID：9831
> 
> 赞同：6
> 
> 时间：2008-08-13T13:49:51.963
> 
> 标签：javascript, drag-and-drop, mootools

我在 Mootools 网站上的论坛上问过这个问题，有人说我的班级选择在管理员出现并将我的帖子状态更改为无效之前已损坏。不用说，这并没有多大帮助。然后我发布到谷歌组的 Mootools 没有回应。我的问题是为什么我的 '.drop' 元素不会触发 'enter'、'leave'、'drop' 事件？.drag 元素的事件正在运行。

```
<title>Untitled Page</title>
<script type="text/javascript" src="/SDI/includes/mootools-1.2.js"></script>
<script type="text/javascript" src="/SDI/includes/mootools-1.2-more.js"></script>
<script type="text/javascript" charset="utf-8">
    window.addEvent('domready', function() {
        var fx = [];
        $$('#draggables div').each(function(drag){
            new Drag.Move(drag, {
                droppables: $$('#droppables div'),
                onDrop: function(element, droppable){
                    if(!droppable) {
                    }
                    else {
                        element.setStyle('background-color', '#1d1d20');
                    }
                    element.dispose();
                },
                onEnter: function(element, droppable){
                    element.setStyle('background-color', '#ffffff');
                },
                onLeave: function(element, droppable){
                    element.setStyle('background-color', '#000000');
                }
            });
        });

        $$('#droppables div').each(function(drop, index){
            drop.addEvents({
                'enter': function(el, obj){
                    drop.setStyle('background-color', '#78ba91');
                },
                'leave': function(el, obj){
                    drop.setStyle('background-color', '#1d1d20');
                },
                'drop': function(el, obj){
                    el.remove();
                }
            });
        });
    });
</script>

<form id="form1" runat="server">
<div>
    <div id="draggables">
    <div class="drag"></div>
    <div class="drag"></div>
    <div class="drag"></div>
    <div class="drag"></div>
    <div class="drag"></div>
    <div class="drag"></div>
    <div class="drag"></div>
    <div class="drag"></div>
    <div class="drag"></div>
    <div class="drag"></div>
</div>

<div id="droppables">
    <div class="drop"></div>
    <div class="drop"></div>
    <div class="drop"></div>
    <div class="drop"></div>
    <div class="drop"></div>
    <div class="drop"></div>
</div>

</div>
</form> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-16T00:13:57.603

好的，看起来这里有几个问题。据我所知，mootools 中没有“可丢弃”之类的东西。这意味着您的“进入”、“离开”和“放下”等事件将不起作用。（这些是拖动对象上的事件）

如果您将这些名称更改为 mootools 中的元素具有的事件（如 DOM 事件），您的代码将完美运行。例如，如果您将 'enter' 和 'leave' 更改为 'mouseover' 和 'mouseout'，您的事件会毫无问题地触发。（Windows Vista 上的 Opera 9.51）

这似乎是文档中的相关行，其中统计使用 DOM 事件。

[http://docs.mootools.net/Element/Element.Event#Element:addEvents](http://docs.mootools.net/Element/Element.Event#Element:addEvents)

此外，在该页面上，是指向常规元素可以具有的事件的链接

[http://www.w3schools.com/html/html_eventattributes.asp](http://www.w3schools.com/html/html_eventattributes.asp)

然而，[在 nabble 论坛上给你的“TG in SD”的建议](http://mootools-users.660466.n2.nabble.com/Drag-and-drop-problem-I-m-having-td686391.html)可能是最好的。如果可以，请不要费心使用这些事件。将您需要做的任何事情都放在可拖动的对象中，省去所有这些麻烦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-30T01:05:06.700

According to [Mootools Docs](http://mootools.net/docs/more/Drag/Drag.Move), "`droppables`" is one of the options expected by the `Drag.Move` class. In fact, this is the array of elements that interact with the element when it fires the "`drop`," "`enter`," and "`leave`" event.

# c# - 开发人员友好型 ERP

> ID：9836
> 
> 赞同：5
> 
> 时间：2008-08-13T13:51:48.450
> 
> 标签：c#, erp

我的公司目前正在使用 Sage MAS 作为他们的 ERP 系统。虽然集成我们的购物车并非不可能，但它使用 COM 并有其自身的挑战。

我想知道那里是否有对开发人员更友好的 ERP。我研究过 Microsoft Dynamics，但要获得关于 ERP 系统的信息，而不是一堆商业术语几乎是不可能的。

我将使用 C# 3.whatever 和 .NET MVC。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T14:41:02.220

当您谈论 Microsoft Dynamics 时，听起来有点像您在谈论特定产品。然而，微软的 Dynamics 系列中有近 10 个不同的系统，其中至少有 6 个是不同的 ERP 系统，都具有不同的功能和可扩展性。新版本的 Microsoft Dynamics AX 以及 Microsoft Dynamics NAV 具有开箱即用的 Web 服务支持。

我希望这有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-13T14:01:50.647

MS Dynamics 是非常酷的应用程序。V3 完全是 Web Serviced V4 我假设更多 - 所有操作都公开为 Web 服务，由于“互联网”许可，MS CRM 的许可受到很大影响。

我们在一个完全 .NET SOA 中使用 CRMv3，它很棒。

进行集成应该没有问题-除了安全性=>

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-13T18:29:49.607

我已经在 ASP.NET 和 Dynamics AX4 之间进行了一些集成——它有一个称为 Business Connector 的 .NET API，可让您访问 AX 的完整内部对象模型——如果 AX 这样做，您的 Web 应用程序也可以这样做。我的应用程序必须执行任意 AX 业务逻辑功能，除了糟糕的 API 文档（我被 MSDN 宠坏了）之外，这一切都非常简单。Business Connector 是最低级别的 API - 还有许多在更高级别上工作的 Web 服务选项。

# .net - 性能关键的 GUI 应用程序（windows、linux）

> ID：9846
> 
> 赞同：5
> 
> 时间：2008-08-13T14:00:55.280
> 
> 标签：.net, windows, linux, user-interface

我的任务是更新一系列应用程序，这些应用程序是性能关键的 VB.NET 应用程序，它们基本上只是监视和返回网络统计信息。我只有三个要求：*将其转换为 C#，使其快速，并使其稳定*

一个警告是，我们*“可能”* *“很快”*从 .NET 平台迁移到 linux

 *我将来会负责维护这些应用程序，所以我想把这件事做好。我决定根据 MVP 模式重构这些应用程序，以便我可以正确地对这个坏男孩进行单元测试。但我也在考虑，因为我使用的是 MVP，我也可以在原生 C/C++ 代码中执行计算成本高昂的工作，而 GUI 可以使用 .NET 表单或 Qt 或其他方式完成。

问题：

1.  在winforms中做一个GUI但在本机、非托管C/C++中做昂贵的东西有意义吗？

2.  对于适合上述场景的良好跨平台窗口工具包有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-13T14:19:25.633

1）过早的优化是邪恶的。在 C# 中实现你的“昂贵的东西”，看看你是否需要重构它。或者，至少设置一个测试，让您确定这一点。

2）尤奇。跨平台用户界面。我不会忍受“可能”的东西。钉住黄鼠狼；你怎么可能在不知道你在设计什么的情况下做出设计决定？如果您使用纯 .NET 实现，如果您必须（至少）重构它以在 Mono 中工作，他们会抱怨吗？如果你用 Java 创建它，他们会不会因为它看起来丑陋而烦恼，并且用户抱怨他们在所有这些 .jar 中找不到他们的 .exe 文件？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-13T19:47:04.350

首先，我会花一些时间尝试一些[VB.NET 到 C# 的转换器](http://www.google.com/search?q=VB.NET+to+C%23+converter&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)。你基本上是在移植语法，如果你不需要的话，没有理由手动做。当然，您可能需要清理转换器产生的内容，但这比手动转换要好得多。

现在，至于你的问题：

> 1）在winforms中做一个GUI但在本机、非托管C/C++中做昂贵的东西是否有意义？

还没有。等到您完成转换，然后找出您实际花费时间的地方。在您发现有必要之前，没有理由将 C/C++ 与 C# 混合使用。您可能会发现使用不安全的 C# 就足够了。即使这样也可能是不必要的。您可能只需要优化算法。找出你的瓶颈是什么，*然后*决定如何解决它们。

> 2）对于适合上述场景的良好跨平台窗口工具包有什么建议吗？

我肯定会研究[单声道](http://www.mono-project.com)。如果您使用 C#，这确实是您能做的最好的事情。当/如果您迁移到 Linux 时，它几乎是单声道或另一种语言的另一种重写。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-13T14:28:51.760

1）不一定。我认为更正确的说法是用 C++ 编写后端代码可能是值得的，而不管性能影响如何。即使您不能在平台切换上束缚您的上级，但您还是谨慎地为这种可能性做准备，因为管理类型往往会在没有充分理由（或警告）的情况下改变主意；即使他们决定现在不转换，也不意味着他们不会在六个月后决定转换。现在用 C++ 编写你的逻辑，知道这是一种可能性，虽然更困难，但可能会让你以后的生活变得更加轻松。

2）不是真的。有像 wxWindows 和 GTK# 这样的“解决方案”，但它们通常有问题，或者难以正常工作，或者它们在一个或另一个平台上缺少重要的东西。它们通常还会将您锁定在一个最低公分母的 UI 中（即，一般控件可以正常工作，但您可能会忘记曾经做过一些有趣的事情——例如 WPF——使用它）。UI 很容易编写，所以我认为如果你用可移植的东西编写逻辑，那么将几个特定于平台的 UI 组合在一起应该是一件小事。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-13T14:24:12.287

对于第一个问题，很难说它是否有意义，因为它可能取决于您需要获得什么样的性能。我个人没有看到由于使用 WinForms 的正确设计的 GUI 中的 GUI 导致系统范围内的任何减速，所以我不明白为什么它会导致任何问题，而且很可能它会让你在 GUI 方面的生活更轻松.

至于你的第二个问题，如果你打算在某个时候转移到另一个平台 - 你想看看 Mono 已经实现的库（[http://www.mono-project.com/Main_Page](http://www.mono-project.com/Main_Page)） ，这也应该满足您对跨平台窗口的大部分需求，因为它支持 WinForms 和 GTK#。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-13T14:27:41.997

不，在 C/C++ 中做“昂贵的东西”是没有意义的。与 C# 相比，潜在的（并且很可能是次要的）性能改进永远不会超过你的生产力，因为它是一个卑鄙的、病态的笑话。真的。它甚至不接近。

通读此（以及其中引用的所有帖子）：http: [//blogs.msdn.com/ricom/archive/2005/05/10/416151.aspx](http://blogs.msdn.com/ricom/archive/2005/05/10/416151.aspx)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-13T14:34:47.740

您可能想考虑使用[Mono](http://www.mono-project.com)。这是 .NET 的开源版本，可在许多平台上运行...Linux、Mac、Solaris、Windows 等。

现在关于用 C/C++ 编写昂贵的东西。这是一篇很好地解释了[C/C++ 和 C# 性能](http://www.codeproject.com/KB/cs/CSharpVsCPP.aspx)之间的差异的文章。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-13T19:13:50.580

> 再一次，让我强调一下，C++ 的东西非常昂贵。做我上面提到的有意义吗？（.NET 表单隐藏繁重的 C++）

如前所述，我个人没有注意到由于在用 VB.NET 和 C# 编写的应用程序中的 WinForms 而导致的任何系统范围的减速。但是，如果应用程序是真正的性能密集型应用程序，那么如果您用 C# 编写所有内容，您可能会注意到速度略有下降，因为它被编译为 CIL ( [http://www.cl.cam.ac.uk/research/srg/han /hprls/orangepath/timestable-demo/](http://www.cl.cam.ac.uk/research/srg/han/hprls/orangepath/timestable-demo/)）。因此，使用诸如 C# 之类的语言编写 GUI 可能会使该部分的开发变得更容易一些，这将使您有更多时间来处理代码的关键部分。这里唯一的问题 22 可能会注意到由于从 C# 代码调用 C/C++ 代码而导致的一些减速；但是，这很可能不太可能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-13T20:34:21.353

> 1）在winforms中做一个GUI但在本机、非托管C/C++中做昂贵的东西是否有意义？

很可能不是。除非您与许多其他本机 C dll 等进行通信，否则 C# 可能比 C++ 慢 5% 到 5% *（*如果您使用它，std::string 真的会杀死您）

> 2）对于适合上述场景的良好跨平台窗口工具包有什么建议吗？

如果只是一些带有按钮的简单表单，mono 可能无需修改即可运行它们。如今，它对 .NET WinForms 的支持非常好。然而，它是丑陋的:-)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-13T19:32:12.570

**我可能误解了这个问题**，但如果它是一个网络监控系统，为什么不写成一个“专用”的 Windows 服务？

VB.NET 不应该比 C# 慢很多。我不能 100% 确定生成的 IL 代码是否存在任何重大差异，但我能想到的唯一优势（以及用 C# 重写它的正当理由）（除了 C# 有更好的语法和其他一些好处) 是使用不安全的代码块，可以稍微加快速度。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-17T14:41:08.820

[gtk-sharp](http://www.mono-project.com/GtkSharp)是一个非常不错的跨平台工具包。

> Gtk# 是一个用于单声道和 .Net 的图形用户界面工具包。该项目绑定了 gtk+ 工具包和各种 GNOME 库，支持使用 Mono 和 .Net 开发框架进行完全原生的图形 Gnome 应用程序开发。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-01T21:23:35.703

c/c++ 的东西最终可能是个好主意，但现在是 YAGNI。与Linux的东西一样。忽略它，除非你需要它，[否则你不会需要它。](http://en.wikipedia.org/wiki/You_Ain't_Gonna_Need_It)保持[简单](http://www.xprogramming.com/Practices/PracSimplest.html)。正如你所说，单元测试彻底搞砸了。让代码工作并从那里[改进设计。](http://martinfowler.com/articles/designDead.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-11-09T08:50:29.053

前段时间我遇到过类似的困境，同时试图找到一种最佳方法来开发基于 PC 的硬件测试工具（这显然意味着“带有 UI 选项”），它与嵌入式硬件（通过 PCMCIA 接口）交互。

瓶颈是测试应该以与测试人员指定的预期时间相差 10 毫秒的最大偏差运行。

例如：如果测试人员创建以下测试序列：

步骤 2 中提到的延迟不应 > 60 毫秒。

我选择 C++ WIN32 应用程序作为我的后端和 VC++ 2005 Winform（.NET 平台）进行 UI 开发。有关如何连接这两者的详细信息可在[msdn](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.aspx)
中找到 我这样隔离系统：
在 VC++ .NET 中：

在 C++ WIN32 中：

整个系统已启动并运行。它似乎很稳定。（没有上面提到的时序偏差）。
请注意，我们使用的测试 PC 仅用于硬件测试目的（它只运行 UI，没有自动更新、病毒扫描等.. 等等）。

# content-management-system - 个人网站建设

> ID：9877
> 
> 赞同：33
> 
> 时间：2008-08-13T14:22:20.947
> 
> 标签：content-management-system

我目前正在尝试建立一个个人网站，以便为自己在网络上建立一个存在。我的计划是包括我的简历、我自己完成的任何项目以及我参与的开源项目的链接等内容。但是，我不确定从“广告”自己的角度来看哪种方法会更好，因为这个网站就是这样做的，特别是因为我是一名软件开发人员。

我应该使用开箱即用的系统并根据需要使用可用模块和自定义模块对其进行扩展，还是应该根据需要自定义构建站点及其所有功能？在可能访问我的网站的潜在雇主眼中，自定义网站是否更好看？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-08-13T14:42:06.430

我过去曾玩弄过这个想法，但出于多种原因，我认为这并不是一个好主意。首先，有许多地方可以处理大部分这些，而无需您进行工作或维护。例如，只需注册一个linkedIn 帐户，就可以满足您在这方面的大部分需求。您可以在那里创建您的简历和生物信息等，并使其公开可见。您“自己的网站”的另一个问题是，如果您不经常更新它，信息就会变得陈旧，更糟糕的是，人们没有理由返回，因为*“什么都没有改变”* ——这算不上什么*广告*适合你吗？

既然我已经说了这么多，我会提出另一个建议。为什么不开始写博客呢？！如果您有不错的经验，为什么不分享。我敢打赌，这将是您技能的*最佳*广告，因为：

1.  它总是更新的（如果你经常发帖）
2.  这并不是说您正在*寻找*工作 - 但您的（未来）雇主或他们的开发人员无论如何都会检查它以更好地了解您的角色。
3.  把一些东西放在你的简历上并不意味着你可以做到。我并不是说你会对自己的技能撒谎:-)，但是当你写关于这些东西的文章、获得评论和反馈，以及更好地了解你的激情*时，你的能力是没有争议的。*

最重要的是 - 您可以从您选择的域运行您的博客，还可以指向您存储在linkedIn 中的简历。只是一个想法...

那是我的两便士价值-希望它可以帮助您做出决定！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-13T14:24:35.157

如果您是特定于 Web 的开发人员，我会使用自定义站点，但如果您更多地关注桌面应用程序或后端技术，我认为开箱即用的系统会很好。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-08-22T22:01:18.463

一个漂亮的、默认的、现成的、完整的网站可能比一个做得不好、破损、拼凑、不完整的网站更令人印象深刻。也许从“现成”但外观漂亮的东西开始，保持简单、专业，然后最终添加更多自定义功能、样式和内容。潜在的雇主可能希望看到您能够重复使用经过验证的解决方案，而不是[尝试从头开始创建所有内容](http://en.wikipedia.org/wiki/Not_Invented_Here)没有充分的理由。或者，您可以花时间将出色的组件组合成比部分总和更好的东西，正如 Jeff Atwood 在 Stack Overflow 播客中广泛讨论的那样。Stack Overflow 是编写大量自定义代码的一个很好的例子，但它与一些最好的 Web 2.0 技术/小部件/等相结合。变成连贯的东西，而不是试图证明他们可以从头开始实现 x/y/z。

（另一方面，构建自己的登录系统、博客或照片库真的很有趣。如果你真的很喜欢它并且想要学习很多东西或创造一些新的和不同的东西，那就去吧！）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-13T15:23:36.207

这是我所做的（或目前正在做的）。首先，首先使用开箱即用的解决方案。在我的例子中，我使用了 BlogEngine.NET，它是开源的并且易于设置。这使我可以尽快将内容放在我的网站上。现在，我可以继续使用 BlogEngine.NET，并为我的网站设置外观以赋予其更多个性，或者我可以开始推出自己的解决方案。但是，我还没有找到可以让我有理由浪费时间构建自己的解决方案的要求。很可能你也不会。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-13T14:47:58.790

我认为您的网站是否公然使用框架或其他“通用”解决方案并不重要。真正的问题是“做得好，有味道吗？” 如果您使用的是开箱即​​用的解决方案，则在自定义它时应该花时间并注意细节，就好像您是从头开始创建它一样。

或者，如果你正在寻找一个很好的学习体验和一些可以花费大量空闲时间的东西——你自己写吧。但要知道你在重新发明轮子，并接受它。

*编辑*

37Signals 最近的一篇文章，[Gearheads don't get it](http://www.37signals.com/svn/posts/1186-gearheads-dont-get-it)确实总结了一个很好的观点，即不关注技术细节，而是关注“内容和社区”。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-30T04:11:58.610

Reinventing the wheel is not such a great idea when you are building a personal site. Building your own CMS is fun, and to some degree is something to brag about, but not so much features you won't have the time to build and all the security holes that you won't have the time to fix.

It's much better to pick a good, well-established engine, build a custom theme, and contribute a module or two to it: you'll be writing code that you can show off as a code sample and at the same time creating something useful.

Knowing your way around an open source CMS is a good skill in just about any job: when your boss says - hey, we need a three pager site for client/product/person X in 10 hours, you can say - no problem.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-15T21:52:16.610

对于更简单的投资组合网站，Wordpress 可能会满足您的需求。

您可以为联系信息、各种投资组合、简历等设置“静态”Wordpress 页面。如果您想这样做，这也将为您提供一个博客。

Wordpress 确实让您可以灵活地“隐藏”其中的博客部分，并将其基本上用作更简单的 CMS。例如，您的 example.com 的根 URL 可能指向 WP 静态页面，而 example.com/blog 将是实际的博客页面。

如果您在自己的域上自行托管 Wordpress（我真的建议您不要通过 wordpress.com），为额外内容设置一些子域应该是微不足道的。例如，downloads.example.com 可以托管您从 Wordpress 投资组合页面链接的项目的实际下载。同样，如果您正在做大量的网络工作，那么像 lab.example.com 或 samples.example.com 这样的子域可以托管各种静态（或动态）页面，您可以在其中展示不受控制的沙盒页面WordPress。

请记住，尽管您希望使您的页面看起来不错。一个看起来邋遢的网站可能会吓跑潜在客户，即使您不想为他们做任何网络工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-13T14:34:54.057

把你的简历放到网上会有帮助，我通过谷歌搜索收到了很多来自我简历上的人的招聘电子邮件。不过，我同意 ColinYounger 的观点，因为您可能会从 LinkedIn 获得更多收益。

我的建议是——如果您想花时间学习 CMS 或其他东西，以提高自己，那么为什么不将您的第一个项目作为您的主页呢？

也许启发我们您想在个人主页上拥有的“功能”？除了指向 HTML 简历的链接以及可能指向您喜欢的内容的链接之外，不确定主页的确切功能是什么......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-13T14:38:59.387

这真的取决于：

a) 您提供什么服务

b）您在网页设计/开发方面的技能水平如何

如果您主要是 Web 应用程序开发人员，那么运行现成的产品或公然使用 DreamWeaver 来开发它可能不那么聪明——或者您的客户可能不够善于注意到？

同样，如果您主要是网页设计师，那么设计自己的网站可能是个好主意。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-13T14:51:10.420

就像一个附带问题和跟进我的“自我之旅”评论：你为什么要把网络上的任何东西都认为是“真实的”？IME 打印的提交，虽然不一定准确，但往往比网络提交略少，呃……夸张。

那些响应\观看的人是否曾经雇用过？我不会用谷歌搜索候选人。我可能会自我搜索受访者，但会忽略简历。

回到 OP，我建议你需要展示你擅长的东西 - 参与开源项目并在他们的论坛上发布，链接到你可以发布详细信息的项目，并且通常尝试展示你是一个多么好的员工可能。只是告诉我你擅长 [在此处插入最新趋势] 意味着愚蠢。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-13T19:18:08.307

我开始看到，为自己做广告的最佳方式是把高质量的内容放在那里。如果你写下你有经验的技术，也许会创建一些教程，如果你经常做这些，这表明你在选择的工作领域有一定的权威。

仅此一项就是最好的广告之一。但是，您也想表现出热情。在网上，这可以通过您的网站的精心制作来展示（它不必是超级棒的 UI 或其他东西），但它应该是整洁、干净和专业的。无论是开箱即用还是定制设计都没有关系。

无论哪种方式，您都必须努力使其看起来不错。

# algorithm - 寻找反转 sprintf() 函数输出的算法

> ID：9882
> 
> 赞同：5
> 
> 时间：2008-08-13T14:25:58.133
> 
> 标签：algorithm, parsing, logging, printf, normalizing

我正在做一个需要解析日志文件的项目。我正在寻找一种快速算法，可以接收这样的组消息：

> P1 处的温度为 35F。
> 
> P1 处的温度为 40F。
> 
> P3 处的温度为 35F。
> 
> 记录仪停止。
> 
> 记录仪启动。
> 
> P1 处的温度为 40F。

并以 printf() 的形式输出一些东西：

```
"The temperature at P%d is %dF.", Int1, Int2" 
{(1,35), (1, 40), (3, 35), (1,40)} 
```

该算法需要足够通用以识别消息组中的几乎所有数据负载。

我尝试搜索这种技术，但我什至不知道要搜索的正确术语。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-13T14:28:26.397

我认为您可能忽略并错过了 fscanf() 和 sscanf()。与 fprintf() 和 sprintf() 相反。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-15T16:45:12.813

概述：

一个**天真！**算法以每列的方式跟踪单词的频率，其中可以假设每一行都可以用分隔符分隔成列。

示例输入：

> 狗跳过月亮
> 猫跳过月亮
> 月亮跳过月亮
> 汽车跳过月亮

频率：

```
Column 1: {The: 4}
Column 2: {car: 1, cat: 1, dog: 1, moon: 1}
Column 3: {jumped: 4}
Column 4: {over: 4}
Column 5: {the: 4}
Column 6: {moon: 4} 
```

我们可以通过根据字段总数进行分组来进一步划分这些频率列表，但在这个简单方便的示例中，我们只使用固定数量的字段 (6)。

下一步是遍历生成这些频率列表的行，让我们以第一个示例为例。

1.  **:**符合一些手动标准，算法决定它必须是静态的。
2.  **dog**：根据频率列表的其余部分，它似乎不是静态的，因此它必须是动态的而不是静态文本。我们遍历一些预定义的正则表达式并提出`/[a-z]+/i`.
3.  **over** : 与#1 相同的交易；它是静态的，所以保持原样。
4.  **: 与#1 相同**的交易；**它是静态的，所以保持原样。**
***   **月亮**：与#1 相同的交易；它是静态的，所以保持原样。**

 **因此，只要从第一行开始，我们就可以将以下正则表达式放在一起：

```
/The ([a-z]+?) jumps over the moon/ 
```

注意事项：

*   显然，人们可以选择在第一遍扫描部分或整个文档，只要人们确信频率列表将是整个数据的充分采样。

*   误报可能会蔓延到结果中，这将取决于过滤算法（挥手）来提供静态和动态字段之间的最佳阈值，或者一些人工后处理。

*   总体思路可能不错，但实际实现肯定会影响该算法的速度和效率。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-15T15:00:43.553

感谢所有伟大的建议。克里斯，是的。我正在寻找一种通用解决方案来规范任何类型的文本。该问题的解决方案归结为在两个或更多相似字符串中动态查找模式。几乎就像根据前两个预测集合中的下一个元素：

1：珠穆朗玛峰高30000英尺

2：K2 高 28000 英尺

=> 模式是什么？=> 答案：

[名称] 是 [数字] 英尺高

现在文本文件可以有数百万行和数千种模式。我想非常非常快地解析文件，找到模式并收集与每个模式关联的数据集。

我考虑过创建一些高级语义哈希来表示消息字符串中的模式。我会使用分词器并给每个令牌类型一个特定的“权重”。然后我将对哈希进行分组并评估它们的相似性。分组完成后，我将收集数据集。

我希望，我不必重新发明轮子，并且可以重复使用已经存在的东西。

克劳斯

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-13T15:52:09.300

这取决于您要做什么，如果您的目标是快速生成 sprintf() 输入，则此方法有效。如果您尝试解析数据，也许正则表达式也可以。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-14T02:25:16.637

你不会找到一个工具，它可以简单地接受任意输入，猜测你想要从中得到什么数据，并产生你想要的输出。对我来说，这听起来像是强大的人工智能。

制作这样的东西，即使只是为了识别数字，也会变得非常棘手。例如“123.456”是一个数字还是两个？这个“123,456”怎么样？“35F”是十进制数字和“F”还是十六进制值0x35F？您将不得不构建一些能够以您需要的方式解析的东西。您可以使用正则表达式来执行此操作，也可以使用 来执行此操作`sscanf`，或者您可以通过其他方式执行此操作，但是您将不得不编写一些自定义的东西。

但是，使用基本的正则表达式，您可以自己执行此操作。这不会是魔法，但它不是那么多的工作。像这样的东西会解析你感兴趣的行并将它们合并（Perl）：

```
my @vals = ();
while (defined(my $line = <>))
{
    if ($line =~ /The temperature at P(\d*) is (\d*)F./)
    {
        push(@vals, "($1,$2)");
    }
}
print "The temperature at P%d is %dF. {";
for (my $i = 0; $i < @vals; $i++)
{
    print $vals[$i];
    if ($i < @vals - 1)
    {
        print ",";
    }
}
print "}\n"; 
```

这个的输出是L

```
The temperature at P%d is %dF. {(1,35),(1,40),(3,35),(1,40)} 
```

您可以为需要解析的每种类型的行做类似的事情。您甚至可以从文件中读取这些正则表达式，而不是对每个正则表达式进行自定义编码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-15T15:32:17.873

我不知道有什么特定的工具可以做到这一点。当我有类似的问题要解决时，我所做的是尝试猜测正则表达式以匹配行。

然后我处理了这些文件并只显示了不匹配的行。如果一行不匹配，则意味着模式错误，应该调整或添加另一个模式。

经过大约一个小时的工作，我成功地找到了大约 20 种模式来匹配 10000 多行。

在您的情况下，您可以首先“猜测”一个模式是`"The temperature at P[1-3] is [0-9]{2}F."`. 如果您重新处理删除任何匹配行的文件，它会留下“仅”：

> 记录仪停止。
> 
> 记录仪启动。

然后你可以匹配它`"Logger (.+)."`。

然后，您可以优化模式并找到新的模式以匹配您的整个日志。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-14T02:01:34.000

@John：我认为这个问题与一种算法有关，该算法实际识别日志文件中的模式并自动“猜测”适当的格式字符串和数据。`*scanf`家庭无法独自做到这一点，只有在首先识别出模式后才能提供帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-15T18:01:45.187

@Derek Park：好吧，即使是强大的人工智能也不能确定它有正确的答案。

也许可以使用一些类似压缩的机制：

2.  查找大而频繁的子串
3.  查找大而频繁的子字符串模式。（即[模式：1] [垃圾] [模式：2]）

另一个要考虑的项目可能是按[edit-distance](http://en.wikipedia.org/wiki/Edit_distance)对行进行分组。将相似的行分组应该将问题分成每组一个模式的块。

实际上，如果你能写出这个，*让全世界都知道*，我想我们很多人都会喜欢这个工具！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-15T18:11:42.263

@安德斯

> 好吧，即使是强大的人工智能也无法确定它是否有正确的答案。

我在想足够强大的人工智能*通常*可以从上下文中找出正确的答案。例如，强人工智能可以识别出“35F”在这种情况下是一个温度，而不是一个十六进制数。在某些情况下，即使是强大的 AI 也无法回答。但是，这些情况与人类无法回答的情况相同（假设人工智能*非常强大）。*

当然，这并不重要，因为我们没有强大的人工智能。:)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T04:33:19.750

[http://www.logparser.com](http://www.logparser.com)转发到一个似乎相当活跃的 IIS 论坛。这是 Gabriele Giuseppini 的“Log Parser Toolkit”的官方网站。虽然我从未真正使用过这个工具，但我确实从亚马逊市场买了一本便宜的书——今天一本低至 16 美元。没有什么能比只翻阅页面的死树界面更好的了。

浏览这个论坛，我以前没有听说过[http://www.lizardl.com/](http://www.lizardl.com/)上的“MS Log Parser，Log Parser Lizard 的新 GUI 工具” 。

当然，关键问题是语法的复杂性。要使用该术语常用的任何类型的日志解析器，您需要确切地知道要扫描的内容，您可以为其编写 BNF。很多年前，我参加了基于 Aho-and-Ullman 的“龙之书”的课程，而深入了解的 LALR 技术可以为您提供最佳速度，当然前提是您拥有该 CFG。

另一方面，您似乎确实可能正在寻找类似 AI 的东西，这完全是一种不同的复杂性顺序。

# language-agnostic - 使用 Office 自动化时检查挂起的 Office 进程

> ID：9905
> 
> 赞同：3
> 
> 时间：2008-08-13T14:42:52.887
> 
> 标签：language-agnostic, ms-office, office-automation

有没有办法在使用 Office 自动化时检查 Microsoft Office 进程（即 Word、Excel）是否挂起？另外，如果进程挂起，有没有办法终止它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-21T15:24:36.957

让我开始说我不建议在服务器上的服务中这样做，但我会尽力回答问题。

作为服务运行使清理变得困难。例如，您作为服务运行的内容可以杀死一个悬而未决的单词或 excel。您可能不得不终止服务。如果 word 或 excel 处于这种状态，您的服务会停止吗？

尝试测试它是否挂起的一个问题是，您的测试可能会导致一个新的 word 实例启动并工作，而服务正在运行的那个实例仍然会被挂起。

确定它是否挂起的最好方法是要求它做它应该做的事情并检查结果。我需要更多地了解它实际上在做什么。

以下是在批处理文件中用于清理的一些命令（两者都应该在路径中）：

*   sc stop servicename - 停止名为 servicename 的服务
*   sc start servicename - 启动名为 servicename 的服务
*   sc query servicename - 查询 servicename 的状态

*   taskkill /F /IM excel.exe - 终止所有 excel.exe 实例

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-13T15:34:41.410

我记得几年前这样做过 - 所以我说的是 Office XP 或 2003 天，而不是 2007。

显然，如今更好的自动化解决方案是使用使用 System.IO.Packaging 命名空间描述 docx 等的新 XML 格式。

那时，我曾经注意到，每当 MSWord 踢完桶并且受够了，机器上就会运行一个名为“Dr. Watson”的进程。这是我第一个知道 Word 绊倒的线索。有时我可能会看到不止一个*WINWORD.EXE*，但我的代码只是用来扫描好医生。一旦我看到（在代码中），我自己杀死了所有*WINWORD.EXE*进程好医生，并重新启动了折磨 Word 的过程:-)

希望能给你一些关于寻找什么的线索。

祝一切顺利，

抢G

PS如果你不来的话，我什至可以挖掘出我档案中的代码！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-13T15:30:34.150

我可以回答后半部分；如果您在代码中引用了应用程序对象，您可以简单地在其上调用“退出”：

```
private Microsoft.Office.Interop.Excel.Application _excel;
// ... do some stuff ...
_excel.Quit(); 
```

为了检查挂起的进程，我猜你想尝试从应用程序中获取一些数据，看看你是否在合理的时间范围内得到结果（检查计时器或其他线程或其他东西）。不过可能有更好的方法。

# multithreading - 分析多线程程序

> ID：9926
> 
> 赞同：7
> 
> 时间：2008-08-13T15:09:51.757
> 
> 标签：multithreading, concurrency

我们有一个已有数年历史的代码库，所有原始开发人员早已不复存在。它使用很多很多线程，但没有明显的设计或通用的架构原则。每个开发人员都有自己的多线程编程风格，因此一些线程使用队列相互通信，一些使用互斥锁锁定数据，一些使用信号量锁定，一些使用操作系统 IPC 机制进行进程内通信。没有设计文档，评论也很少。这是一团糟，似乎每当我们尝试重构代码或添加新功能时，都会引入死锁或其他问题。

那么，有没有人知道任何有助于分析和记录线程之间所有交互的工具或技术？FWIW，代码库是 Linux 上的 C++，但我有兴趣了解其他环境的工具。

* * *

## 更新

我很欣赏到目前为止收到的回复，但我希望得到比基本上是“添加日志消息、弄清楚发生了什么并修复它”的建议更复杂或更系统的东西。有很多工具可以用来分析和记录单线程程序中的控制流。多线程程序没有可用的东西吗？

* * *

另请参阅[调试多线程应用程序](https://stackoverflow.com/questions/619677/debugging-multithreaded-applications)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-21T18:38:14.323

购买一份英特尔的[VTune](http://www.intel.com/cd/software/products/asmo-na/eng/239144.htm)及其线程分析工具。它将为您提供线程行为的系统和源级别视图。它当然不会为您自动记录事情，但至少在可视化不同情况下发生的事情方面应该是一个真正的帮助。

我认为您可以下载试用版，因此值得一试。我只使用过 Windows 版本，但是查看 VTune 网页它也有 Linux 版本。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-13T15:33:28.900

作为一个起点，我很想在应用程序的关键点添加跟踪日志消息。这将允许你分析你的线程是如何交互的，而不会有观察线程的行为会改变它们的行为的危险（就像逐步调试的情况一样）。我的经验是使用 .NET 平台，我最喜欢的日志记录工具是 log4net，因为它是免费的，具有广泛的配置选项，并且如果您对实现日志记录的方式很明智，那么它不会明显影响应用程序的性能。或者，在 System.Diagnostics 命名空间中有 .NET 的内置调试（或跟踪）类。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-13T20:41:07.983

我会首先关注共享内存锁（互斥锁和信号量），因为它们最有可能导致问题。查看哪个状态被锁保护，然后确定哪个状态受到几个锁的保护。这会让你感觉到潜在的冲突。查看持有锁的代码调用方法的情况（不要忘记虚拟方法）。尽量消除这些调用（通过减少持有锁的时间）。

给定持有的互斥锁列表和它们保护的状态的粗略概念，分配一个锁定顺序（即，互斥锁 A 应始终在互斥锁 B 之前使用）。尝试在代码中强制执行此操作。

如果不会对并发性产生不利影响，请查看是否可以将多个锁合二为一。例如，如果互斥锁 A 和 B 看起来可能有死锁，并且排序方案不容易完成，那么最初将它们组合成一个锁。

这并不容易，但我以牺牲并发性为代价来简化代码以解决问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-21T19:11:07.350

对于自动化工具来说，这是一个非常困难的问题。您可能想查看[模型检查](http://en.wikipedia.org/wiki/Model_checking)您的代码。不要期望神奇的结果：模型检查器在代码量和它们可以有效检查的线程数方面非常有限。

可能对您有用的工具是[CHESS](http://research.microsoft.com/chess/)（尽管不幸的是它仅适用于 Windows）。[BLAST](http://mtc.epfl.ch/software-tools/blast/)是另一个相当强大的工具，但很难使用并且可能无法处理 C++。维基百科还列出了我以前从未听说过的[StEAM](http://steam.cs.uni-dortmund.de/index.html)，但听起来它可能对你有用：

> StEAM 是 C++ 的模型检查器。它检测死锁、分段错误、超出范围的变量和非终止循环。

或者，尝试将代码收敛到少量定义良好（最好是高级）的同步方案可能会有很大帮助。在同一个代码库中混合锁、信号量和监视器是自找麻烦。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-13T20:27:23.190

使用 log4net 或类似工具要记住的一件事是它们会改变应用程序的时间，并且通常可以隐藏底层的竞争条件。我们有一些写得很糟糕的代码要调试并引入了日志记录，这实际上消除了竞争条件和死锁（或大大降低了它们的频率）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T02:19:57.723

在 Java 中，您可以选择 FindBugs（用于静态字节码分析）来查找某些类型的不一致同步，也可以选择来自 Coverity、JProbe、OptimizeIt 等公司的许多动态线程分析器。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T14:25:16.313

UML 不能在这里帮助你吗？

如果您将代码库逆向工程为[UML](http://www.uml.org/)，那么您应该能够绘制显示类之间关系的类图。从方法是线程入口点的类开始，您可以看到哪个线程使用哪个类。根据我使用[Rational Rose](http://www.ibm.com/software/rational/)的经验，这可以通过拖放来实现；如果添加的类与之前的类之间没有关系，则添加的类不会被以您开始图表的方法开始的线程直接使用。这应该为您提供有关每个线程的作用的提示。

这还将显示共享的“数据对象”和特定于线程的对象。

如果您绘制一个大类图并删除所有“数据对象”，那么您应该能够将该图布局为云，每个云都是一个线程 - 或一组线程，除非代码库的耦合和内聚是可怕。

这只会给你一个难题的一部分，但它可能会有所帮助；我只是希望你的代码库不是太混乱或太“程序化”，在这种情况下......

# eclipse - How to setup Groovy + Eclipse + Junit4?

> ID：9928
> 
> 赞同：7
> 
> 时间：2008-08-13T15:11:09.103
> 
> 标签：eclipse, groovy, junit

I am working on a small webapp and I want to use Groovy to write some unit testing for my app. Most of my coding is done on Eclipse and I really want to run all the unit testing with the graphical test runner within Eclipse (I really like the green bar :) )

Sadly, after 4 hours of try-and-error, I'm still not able to setup properly. I tried to use the Eclipse Junit4 test runner to run a Groovy file with method annotated for testing using `@Test`. But it keeps complaining `NoClassDefFoundException`

Anyone can help?

Here is content of my groovy file, named simpleTest.groovy

```
import org.junit.Test
import static org.junit.Assert.assertEquals

class simpleTest{
  @Test
  void trial(){
    assertEquals 6, 3+3
  }
} 
```

Anyone can help?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-31T23:12:10.773

您可能想尝试一下更新后的插件，有关更多详细信息，请参阅[最近的博客文章](http://blog.springsource.com/2009/07/30/a-groovier-eclipse-experience)。这个 alpha 版本的主题是*提供优化的编辑/保存/编译/测试体验*，这似乎是您的确切用例。

![Groovy Eclipse 2.0](https://i.stack.imgur.com/0joPq.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T04:14:12.320

我有这个在我的环境中工作，所以这里是我所拥有的简要总结：

在 JUnit 下的运行对话框中：

*   **测试选项卡：**测试类，它必须已经被 Groovy 插件编译。
*   **类路径：**我项目中的所有 Jar 文件以及*Groovy*库

在 Window->Preferences->Java->Build Path

*   **类路径变量：**

    ```
    GROOVY_HOME _ECLIPSE_
    ```

    = Groovy 插件的安装位置

这对我有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-28T08:05:21.833

我遇到了类似的问题，正是缺少包装声明导致我遇到问题。Groovy Eclipse 插件没有抱怨它，但我的类存在于一个包中。将文件作为 JUnit 测试运行时出现 noClassDefError。

将 package 语句添加到类的顶部解决了这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T02:34:59.333

不幸的是，Groovy Eclipse 插件在提供实际有用信息方面非常糟糕，让您知道您的设置出了什么问题。我将假设您已经进行了验证以确保插件实际上正在构建您的 Groovy 文件（即做一个没有依赖关系的示例，检查正确的输出目录等......）之后，真的很多小型配置验证...我遇到了问题，我在 Eclipse 中使用的特定“运行器”（即在“运行”菜单中）没有在那里定义写入类名，或者由于某种原因我的项目没有将 JUnit 库依赖项正确插入其中。

最终，这可能是一个令人头疼的配置问题，但从长远来看，如果你能将其淘汰，你最终会节省一些时间并获得一些很酷的功能......

# sql-server - 什么是通过 WAN 打开大文件的好方法？

> ID：9932
> 
> 赞同：1
> 
> 时间：2008-08-13T15:16:50.713
> 
> 标签：sql-server, database, oracle

我有一个应用程序部署到多个区域，并且在跨 WAN 打开较大的文档 (20-50MB) 时存在一些问题。

目前，文档存储在 Zone 1（美洲）中，并且在数据库中存储了指向文档的链接。

我听说过一些关于 oracle 中的 blob 和在 MS SQL Server 2005 中存储二进制文件的事情，然后可能会将数据库复制到其他区域。

使用所描述的选项之一有任何其他建议或良好结果吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-13T15:37:44.697

您最好的选择可能是在第一次请求时将文档缓存在请求的区域中，并在每次请求缓存的文档时 ping 源文档的最后修改，以确定它是否需要刷新。在这种情况下，大多数时候访问文档时，您只需要通过 WAN 请求一小段信息（日期）。这对于经常请求的文档子集最有效。

如果您有大量文档，每个文档都很少被不同的组请求，那么您可能希望在每次更新主服务器时复制每个区域中的文档。这最好通过将文档作为二进制数据存储在主数据库中并让从属从主数据库中提取来完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-13T16:43:09.243

如果您在 Windows 上运行，您可以查看[分布式文件系统](http://en.wikipedia.org/wiki/Distributed_File_System_(Microsoft))

# c++ - 泛型迭代器

> ID：9938
> 
> 赞同：32
> 
> 时间：2008-08-13T15:22:47.847
> 
> 标签：c++, generics, iteration, containers

我正在尝试找到一种访问一组容器的通用方法。除了另一个自定义列表之外，我还有一个标准向量和列表。

自定义列表定义了一个迭代器；

```
class Iterator: public std::iterator<std::forward_iterator_tag, T> {
    // ...
}

Iterator begin() {
    return (Iterator(root));
}

Iterator end() {
    return (Iterator(NULL));
} 
```

适当的运算符重载。

理想情况下，我想这样做；

```
class Foo {
public:
    Foo() {
        std::list<int> x;
        std::vector<int> y;
        custom_list<int> z;

        iter = x.begin(); // OR
        iter = y.begin(); // OR
        iter = z.begin();

        // ...
    };
private:
    std::iterator<int> iter;
}; 
```

但显然这些都是不同类型的迭代器。但是，我可以假设所有容器都是同一类型。

有没有优雅的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-08-13T15:47:35.707

这里有一些您可能会感兴趣的文章

[给 STL 迭代器一个基类](http://accu.org/index.php/journals/479)

[C++ 迭代器的类型擦除](http://thbecker.net/free_software_utilities/type_erasure_for_cpp_iterators/start_page.html)

[any_iterator 类参考](http://stlab.adobe.com/classadobe_1_1any__iterator.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-14T11:09:02.690

迟到总比不到好...

最新一期的[C-Vu](http://accu.org/index.php/aboutus/aboutjournals)出现了，猜猜里面有什么：没错，迭代器可以*完全按照*您的意愿行事。

不幸的是，您需要成为[ACCU](http://accu.org/)的成员才能查看该杂志（该文章引用了 David 链接到的 2000 年的 Overload 文章）。但是，以每年微不足道的价格，您可以获得一本不错的杂志、会议和用户组。成为会员后，您可以查看 PDF 的过刊[，您还在等](http://accu.org/index.php/joining)什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T15:44:41.220

小心你所要求的情况。您看到的 any_iterator 类适用于无限的迭代器类型集。你只有三个，你事先知道。当然，您将来可能需要添加第四种类型，但是如果这需要 O(1) 额外的代码行怎么办？

The big advantage of a closed set of possible contained types is that you have an upper bound on sizeof(), which means you can avoid the heap and the indirection it brings. Basically, stuff them all in a boost::variant and call apply_visitor.

# sql - 查询从 Web 应用程序超时，但从管理工作室运行良好

> ID：9974
> 
> 赞同：30
> 
> 时间：2008-08-13T15:49:41.317
> 
> 标签：sql, sql-server, sql-server-2005

这是我在另一个论坛上提出的一个问题，得到了一些不错的答案，但我想看看这里是否有人有更多的见解。

问题是您的 Web 应用程序中的一个页面在进行存储过程调用时超时，因此您使用 Sql Profiler 或您的应用程序跟踪日志来查找查询并将其粘贴到管理工作室以计算我们为什么它运行缓慢。但是你从那里运行它，它就会一直燃烧，每次不到一秒钟就返回。

我的特殊情况是使用 ASP.NET 2.0 和 Sql Server 2005，但我认为这个问题可能适用于任何 RDBMS 系统。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-08-13T16:01:51.730

这是我迄今为止从我的研究中学到的。

.NET 发送的连接设置与您在登录管理工作室时获得的设置不同。如果您使用 Sql Profiler 嗅探连接，您会看到以下内容：

```
-- network protocol: TCP/IP  
set quoted_identifier off  
set arithabort off  
set numeric_roundabort off  
set ansi_warnings on  
set ansi_padding on  
set ansi_nulls off  
set concat_null_yields_null on  
set cursor_close_on_commit off  
set implicit_transactions off  
set language us_english  
set dateformat mdy  
set datefirst 7  
set transaction isolation level read committed 
```

我现在将这些设置粘贴到登录到 sql server 时运行的每个查询的上方，以确保设置相同。

对于这种情况，我在断开连接和重新连接后分别尝试了每个设置，发现将 arithabort 从关闭更改为打开将问题查询从 90 秒减少到 1 秒。

最可能的解释与参数嗅探有关，这是 Sql Server 用来挑选它认为最有效的查询计划的一种技术。当您更改其中一个连接设置时，查询优化器可能会选择不同的计划，在这种情况下，它显然选择了一个错误的计划。

但我并不完全相信这一点。在更改此设置后，我尝试比较实际的查询计划，但我还没有看到差异显示任何更改。

在某些情况下，关于 arithabort 设置是否还有其他可能导致查询运行缓慢的内容？

解决方案似乎很简单：只需将 set arithabort 放在存储过程的顶部即可。但这可能会导致相反的问题：更改查询参数，突然它在“关闭”时运行得比“开启”更快。

目前我正在运行“重新编译”程序，以确保每次都重新生成计划。对于这个特定的报告来说没关系，因为重新编译可能需要一秒钟，而这对于需要 1-10 秒才能返回的报告来说并不太明显（这是一个怪物）。

但是对于运行更频繁并且需要在几毫秒内尽快返回的其他查询，这不是一个选项。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-01T18:01:36.780

我有过类似的问题。尝试在 sproc create 上设置 with "WITH RECOMPILE" 选项，以强制系统在每次调用时重新计算执行计划。有时，查询处理器在具有大量分支或案例语句的复杂存储过程中会感到困惑，并且只会拉出一个真正次优的执行计划。如果这似乎“解决”了问题，您可能需要验证统计信息是最新的和/或分解存储过程。

您还可以通过分析存储过程来确认这一点。当您从 SQL Managment Studio 执行它时，IO 与您从 ASP.NET 应用程序分析它时相比如何。如果他们非常多，它只会重新强调它拉一个糟糕的执行计划。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-13T18:22:10.027

您是否打开了 ASP.NET 跟踪？我有一个实例，问题不是 SQL 存储过程本身，而是该过程返回了 5000 行，而应用程序正尝试使用导致问题的 5000 个项目创建数据绑定 ListItems。

您还可以通过跟踪查看 Web 应用程序功能之间的执行时间，以帮助追踪事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T14:44:43.687

我在使用 SQL 报告服务时遇到了同样的问题。尝试检查变量的类型，我正在向 SQL 发送不同类型的变量，比如将 varchar 发送到应该是整数的地方，或者类似的东西。在我同步了报表服务和 SQL 存储过程中的变量类型后，我解决了这个问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-13T16:19:24.830

首先在暂存箱上进行测试，在服务器级别为 sql server 更改它

> 声明@option int
> 
> 设置@option = @@options | 64
> 
> exec sp_configure '用户选项', @option
> 
> 重新配置

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T01:35:47.760

您可以尝试使用 sp_who2 命令来查看有问题的进程正在做什么。这将显示它是否被另一个进程阻塞，或者使用过多的 cpu 和/或 io 时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-25T18:02:38.530

我们遇到了同样的问题，这就是我们发现的。

我们的数据库日志大小保持在默认值 (814 MB)，自动增长为 10%。在服务器上，最大服务器内存也保持在默认设置 (2147483647 MB​​)。

当我们的日志已满并需要增长时，它使用了服务器的所有内存，并且没有任何东西可以运行代码，所以它超时了。我们最终将数据库日志文件的初始大小设置为 1 MB，将最大服务器内存设置为 2048 MB。这立即解决了我们的问题。当然，您可以更改这两个属性以满足您的需要，但这对于在通过代码执行存储过程时遇到超时问题的人来说是一个想法，但它在 SSMS 中运行速度非常快，并且上述解决方案没有帮助。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-08-13T15:52:35.460

尝试更改 SelectCommand 超时值：

```
DataAdapter.SelectCommand.CommandTimeout = 120; 
```

# .net - 您从用户组中寻找什么？

> ID：9977
> 
> 赞同：1
> 
> 时间：2008-08-13T15:50:56.510
> 
> 标签：.net

我正在与.NET 开发相关的领域建立一个用户组。社区的形式将是普通的免费食物、演示，然后可能是免费的赠品。

作为用户社区的成员，您会寻找什么来让您每个月都回来？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-13T16:02:07.063

我总是喜欢谈论不同的话题。与专业社区交谈的真正困难在于保持高细节水平和狭窄范围。与一群 .NET 程序员讨论多态性的好处有什么意义？当我去参加某个特定主题的会议并获得最基本的解释和示例时，它总是让我丧命。这是浪费时间。

MSDN 网络广播有一个描述主题复杂性的级别系统。大多数是 100 或 200 级。如果你与一群专业人士打交道，你的谈话应该总是在 600-1000 级。

除了谈论技术主题外，另一个重要的领域是专业发展。如何让自己成为更有价值的程序员？这些类型的谈话非常适合引入其他人，例如管理人员、销售人员、客户等。您通常只会在抗议时与之交往的人，以及当他们走过时您通常会低声咒骂的人。用户组论坛是将这些人与开发人员聚集在一起的好方法，就像设置中的伪团体治疗一样。

还有，甜甜圈。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-13T16:30:28.303

确实，有些谈话内容非常初级，不幸的是，有时你的大部分人可能需要它。我认为自己在很多领域都是新手，但我参加了一些我认为低于我的演讲，但人们仍然在问非常基本的问题。也许值得拥有一个双月用户组，一个星期用于入门级，一个星期用于高级。如果您可以找人帮助您协调很多工作，这并不一定意味着工作量要翻倍。另一方面，你可能只需要感受一下团队成员，看看他们的平均技能水平是多少，然后去玩。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-13T16:00:03.760

如果没有啤酒，它就不是一个足够好的用户组来参加。开源的人明白这一点。因此，他们的用户组会议更有趣，也更有活力。只需让它 BYOB，根据我的经验它自然会变得更好。***************`******