# StackOverflow 问答 000401000-000401999

# wpf - 您如何学习 WPF 和 Silverlight？

> ID：401014
> 
> 赞同：5
> 
> 时间：2008-12-30T18:14:12.493
> 
> 标签：wpf, silverlight, xaml

过去几个月我一直在做一些 WPF 开发，最近我开始了 Silverlight 开发。

大多数时候一切正常，尤其是对于简单的东西，但我经常被看似简单的东西难住——尤其是在 XAML 中。例如，昨天我尝试使用 Grid 来布置 ListBox 中的项目。这行得通，但我无法让网格拉伸以填充 ListBox 的宽度。只有经过几个小时的搜索、论坛帖子和实验，我才能让它工作，但我不能说我已经弄清楚了。

所以，我的问题是你如何**学习**WPF 或 Silverlight？- 特别是 XAML，真的。您使用什么技术来了解控件如何实现它们在屏幕上的功能、它们的结构等。我缺少什么吗？

确实，这是一个主要的症结所在，微软需要解决一些问题才能让大量开发人员启动并有效地使用 WPF/Silverlight！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T18:28:12.260

来自 Microsoft 的 Bill Steele 有一个多部分的网络广播系列，带您从 WPF 的绝对起点开始。我想大概有15集。您应该可以通过搜索 WPF Soup To Nuts 在 Microsoft 活动中找到它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T19:06:42.980

我[在 C# 2008 中购买了 Pro WPF](http://www.apress.com/book/view/1590599551)并发现它对 WPF 非常有用，但发现它立即令人沮丧地处理 WPF 和 Silverlight 之间的绑定、VSM 等方面的差异

您对[http://silverlight.net/Learn/](http://silverlight.net/Learn/)网站上的视频有任何成功吗？有人对[C# 2008 中的 Apress Pro Silverlight 2有意见吗](http://www.apress.com/book/view/1590599497)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T22:03:03.060

去[这里](http://windowsclient.net/learn/)获取 WPF 的东西。去[这里](http://silverlight.net/Learn/)寻找 Silverlight。

两者都是可靠的来源。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T18:18:17.200

检查您当地图书馆的网站。

我住在马萨诸塞州波士顿。深埋在他们网站中的是 Safari Books Online 的免费订阅，其中包含来自 O'Reilly 等顶级出版商的数千本技术和商业书籍。

埋在另一个页面上的是一个网络表格，您可以填写让他们通过电子邮件向您发送图书馆卡号。借书证号码可让您访问技术书籍。

另一页上还有免费的有声读物。不是为了技术，而是编程之后的生活！

亚当莱弗特

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-17T00:17:59.293

我认为当开始使用 Silverlight 时，Expression Blend 是一个重要的工具，因为 xaml 编写一开始并不容易，您必须更多地关注 xaml 错误，而不是整个事物系统和实际的视觉结果。

稍后肯定会最终调整（确定清理）Blend 创建的大量代码，然后从那里手动编写 XAML，因为开发人员喜欢生活在 VS 中，而解雇 Blend 是一个额外的举措。

这是一个开始，我希望几个月后你已经过去了。虽然直到今天（8 个月后）我仍然有一些我觉得在 Blend 中更舒服的事情。

从那以后，我转到了 msdn 文档——尽管智能感知为我们提供了所有可能的属性及其值，但文档可以为我们提供答案，它实际上是什么。对我来说，首先在 msdn 中打开例如 DockPanel 文档是一个步骤，而不是开始猜测参数 x 的作用。

这让我想起了我在使用 Silverlight 时遇到的另一个问题——因为我对 Microsoft 技术完全陌生，所以起初我在浏览 msdn 文档时遇到了很大的麻烦。现在看起来很傻，但我从那里找不到任何东西。学习新技术的重要部分是学习文档的结构:)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-05T10:23:41.117

我已经完成了“Pro Silverlight 2”，我发现每一章都非常详细和透彻。我还提到了SAMS“Silverlight 2 Unleashed”，那本书是对“Pro Silverlight 2”的一个很好的补充。此外，请查看“ [Silverlight Tip Of The Day](http://silverlight.net/blogs/msnow/archive/2009/01/02/silverlight-tips-of-the-day-summary-outline.aspx) ”和 Jesse Liberty 的博客以获取一些方便的提示。

HTH，印地

# vba - 使用 VBA 退出 Excel 会导致运行时错误 424

> ID：401015
> 
> 赞同：2
> 
> 时间：2008-12-30T18:15:27.683
> 
> 标签：vba, excel

我一直在编写一个 VBA 宏，它在 Excel 中打开一个 HTML 文档（以便对其执行各种计算）。Excel 将在当前文件夹中搜索 HTML 文档。如果在那里找不到它，它将产生一个文件打开框，用户可以在其中手动浏览到 HTML 文档的位置。到目前为止一切都很好。但是，如果用户选择取消（而不是选择文件），我希望 Excel 显示一条消息并退出。

该消息已生成，但随后代码停止并出现以下错误：

> 运行时错误“424”：需要对象。

这听起来并不麻烦，但我一直在尝试找出导致问题的原因。

似乎不起作用的子是：

```
Sub ExitWithoutPrompt()

MsgBox "You failed to select a file, therefore Excel will now close.  Please refer to the readme file."
Excel.Application.DisplayAlerts = False
Excel.Application.Quit

End Sub 
```

我正在使用 MS Excel 2002，但我希望该解决方案能够处理尽可能多的 Excel 变体。

任何关于我哪里出错的帮助都非常感激。顺便说一句，我是一个完整的新手，所以如果可能的话，请长篇大论地为我提供任何指导......

因为它可能在下面使用（有使这篇文章变得笨拙的风险）是我在宏中使用的另外两个子：

第一个子：

```
Sub Endurance()

Call OpenHTML

Range("G27").Value = "Category"
Range("G28").Value = "Meat"
Range("G29").Value = "Veg"
Range("G30").Value = "PRP"
Range("F27").Value = "Fleet"
Range("E27").Value = "Consumption"

Range("E32").Value = "Endurance"

Range("E33").Value = "Lowest Category"
Range("E34").Value = "Fleet"
Range("E35").Value = "Consumption"

Range("E27, F27, G27, E32").Font.Bold = True
Range("F28").Value = WorksheetFunction.Sum(Range("E8,E9,E11,E14,E21"))
Range("E28").Value = WorksheetFunction.Sum(Range("G8,G9,G11,G14,G21"))
Range("F29").Value = WorksheetFunction.Sum(Range("E10,E16"))
Range("E29").Value = WorksheetFunction.Sum(Range("G10,G16"))
Range("F30").Value = WorksheetFunction.Sum(Range("E20,E22"))
Range("E30").Value = WorksheetFunction.Sum(Range("G20,G22"))

Columns("E:F").EntireColumn.AutoFit

Range("G28:G30, E27, F27, G27, G33").Select
    With Selection
        .HorizontalAlignment = xlRight
    End With

Range("E27:G30, E32:G35").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = xlAutomatic
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = xlAutomatic
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = xlAutomatic
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = xlAutomatic
    End With
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    Selection.Borders(xlInsideHorizontal).LineStyle = xlNone

Dim Endurance As Double
Endurance = WorksheetFunction.Min(Range("F28:F30"))
Range("G34").Value = WorksheetFunction.RoundDown(Endurance, 0)

Endurance = WorksheetFunction.Min(Range("E28:E30"))
Range("G35").Value = WorksheetFunction.RoundDown(Endurance, 0)

Range("G33").Value = Endurance

Dim LowCat As String

LowCat = WorksheetFunction.VLookup(Endurance, Range("E28:G30"), 3, False)
Range("G33").Value = LowCat

ActiveSheet.PageSetup.PrintArea = "$A$1:$G$35"
ActiveSheet.PageSetup.Orientation = xlLandscape

Range("G36").Select

If MsgBox("Print endurance statement?", vbYesNo + vbDefaultButton2, "Print endurance") = vbYes Then
    ActiveWindow.SelectedSheets.PrintOut Copies:=1
    Else
    Range("G36").Select
    End If

End Sub 
```

第二个子：

```
Sub OpenHTML()

On Error GoTo MissingFile

Workbooks.Open FileName:=ThisWorkbook.Path & "\TRICAT Endurance Summary.html"

Exit Sub

MissingFile:

Dim Finfo As String
Dim FilterIndex As Integer
Dim Title As String
Dim FileName As Variant

' Set up list of file filters
Finfo = "HTML Files (*.html),*.html," & _
        "All Files (*.*),*.*,"

' Display *.html by default
    FilterIndex = 1

' Set the dialog box caption
Title = "Select TRICAT Endurance Summary"

' Get the filename
FileName = Application.GetOpenFilename(FInfor, FilterIndex, Title)

' Handle Return info from dialog box
If FileName = False Then
    Call ExitWithoutPrompt
    Else
    MsgBox "You selected" & FileName
    Workbooks.Open FileName

End If

End Sub 
```

如果你已经到了这一步，感谢阅读......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T19:43:01.907

添加调用`ActiveWorkbook.Close`到`ExitWithoutPrompt`：

```
Sub ExitWithoutPrompt()
    MsgBox "You failed to select a file, therefore Excel will now close.  Please refer to the readme file."
    Excel.Application.DisplayAlerts = False
    Excel.Application.Quit
    ActiveWorkbook.Close False
End Sub 
```

这适用于 Excel 2003 下的我。

出于某种原因，调用`Application.Quit`和的顺序`ActiveWorkbook.Close`很重要。与直觉相反，至少对我而言，如果您在仍然收到错误`ActiveWorkbook.Close`之前打电话。`Application.Quit`

# c# - Windows 窗体中未处理的非 ui 线程异常

> ID：401024
> 
> 赞同：1
> 
> 时间：2008-12-30T18:18:19.723
> 
> 标签：c#, .net, winforms, multithreading

没有在每个工作线程方法中插入 try/catch 块，有没有办法处理 Windows 窗体中未处理的、非 ui 线程的异常？

`Thread.GetDomain().UnhandledException`非常适合捕获错误，但到那时再做任何事情都为时已晚（除了记录它）。在控制权离开您的`UnhandledException`处理程序后，应用程序将终止。您可以期望的最好结果是一个通用的 Windows 错误，如下所示：

![http://i40.tinypic.com/2be98i.jpg](https://i.stack.imgur.com/8kxgl.jpg)

我所有的研究都表明你*必须*在工作线程方法中插入一个 try/catch 块，但我想把它放在那里以防万一有人有不同的看法。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T18:20:48.440

如果您想在错误发生 UnhandledException 之前对其进行处理，那么您需要在线程方法中使用 try/catch。

你至少应该在这里处理像 FileNotFoundException 这样的异常，你可以在其中做一些智能的事情。如果一切都失败了，您可以使用 UnhandledException 干净地处理您没有预料到的任何事情（希望这没什么）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T18:29:12.370

Thread.GetDomain().UnhandledException 演变为[AppDomain.UnhandledException](http://msdn.microsoft.com/en-us/library/system.appdomain.unhandledexception.aspx)，这通常是应用程序中所有线程的同一个域 - 换句话说，您只需挂钩一次此事件，而不是每个线程一次。

辅助线程中未处理的异常将杀死线程。请参阅[SafeThread](http://www.codeproject.com/KB/threads/SafeThread.aspx)以获取替代方案

警告：我是 SafeThread 文章的作者

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T18:27:36.663

听起来您误解了...您没有将代码“放入”线程中。您在线程“上”运行代码。

无论您将 try catch 块放在哪里，它最终都可以在任何线程上执行......如果您希望 catch 中的代码执行某些操作（操作）UI 元素，您只需在任何线程上“运行”该代码UI 元素是在（如有必要）上创建的。

每个 WinForms UI 元素都有两个成员来帮助您，InvokeRequired()，如果它在任何线程上执行，则返回一个布尔值，而不是创建元素的线程（在这种情况下，您必须切换线程），以及 BeginInvoke () 自动切换到正确的线程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T20:23:41.467

要处理异常，您必须在线程内执行的代码中插入一个 try/catch 块。

如果您考虑一下，UnhandledException 实际上命名得很好。异常“未处理”，因此您无能为力。太晚了！

实际上，在线程的上下文之外，您无法“拯救”它以免崩溃，因为您没有要纠正的上下文。因此 UnhandledException 对于记录和尝试确定崩溃*后*崩溃的原因很有用。

如果您考虑一下 try/catch 的工作原理：

```
try
{
  // run this code

}
catch (Exception ex)
{
  // an exception happened in the above try statement inside MY thread
} 
```

# python - 在 django Forms 中定义 css 类

> ID：401025
> 
> 赞同：204
> 
> 时间：2008-12-30T18:18:41.343
> 
> 标签：python, django, django-forms

假设我有一个表格

```
class SampleClass(forms.Form):
    name = forms.CharField(max_length=30)
    age = forms.IntegerField()
    django_hacker = forms.BooleanField(required=False) 
```

有没有办法让我在每个字段上定义 css 类，以便我可以在渲染页面中使用基于类的 jQuery？

我希望不必手动构建表单。

* * *

## 回答 #1

> 赞同：190
> 
> 时间：2011-01-13T01:56:34.787

另一个不需要更改 python 代码的解决方案，因此更适合设计人员和一次性的演示更改：[django-widget-tweaks](https://github.com/kmike/django-widget-tweaks)。希望有人会发现它有用。

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2008-12-30T18:20:28.533

回答了我自己的问题。*叹*

[http://docs.djangoproject.com/en/dev/ref/forms/widgets/#django.forms.Widget.attrs](http://docs.djangoproject.com/en/dev/ref/forms/widgets/#django.forms.Widget.attrs)

我没有意识到它被传递到小部件构造函数中。

* * *

## 回答 #3

> 赞同：82
> 
> 时间：2008-12-30T18:32:11.100

这是在类中声明字段后向小部件添加类定义的另一种解决方案。

```
def __init__(self, *args, **kwargs):
    super(SampleClass, self).__init__(*args, **kwargs)
    self.fields['name'].widget.attrs['class'] = 'my_class' 
```

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2013-09-23T14:55:01.993

使用[django-widget-tweaks](https://github.com/kmike/django-widget-tweaks "django-widget-tweaks")，它易于使用且运行良好。

否则，这可以使用自定义模板过滤器来完成。

考虑到您以这种方式呈现表单：

```
<form action="/contact/" method="post">
    {{ form.non_field_errors }}
    <div class="fieldWrapper">
        {{ form.subject.errors }}
        <label for="id_subject">Email subject:</label>
        {{ form.subject }}
    </div>
</form> 
```

form.subject 是[BoundField](https://docs.djangoproject.com/en/dev/ref/forms/api/#django.forms.BoundField)的一个实例，它具有**as_widget**方法。

您可以在“my_app/templatetags/myfilters.py”中创建自定义过滤器“addcss”

```
from django import template

register = template.Library()

@register.filter(name='addcss')
def addcss(value, arg):
    css_classes = value.field.widget.attrs.get('class', '').split(' ')
    if css_classes and arg not in css_classes:
        css_classes = '%s %s' % (css_classes, arg)
    return value.as_widget(attrs={'class': css_classes}) 
```

然后应用您的过滤器：

```
{% load myfilters %}
<form action="/contact/" method="post">
    {{ form.non_field_errors }}
    <div class="fieldWrapper">
        {{ form.subject.errors }}
        <label for="id_subject">Email subject:</label>
        {{ form.subject|addcss:'MyClass' }}
    </div>
</form> 
```

form.subjects 将使用“MyClass”css 类呈现。

希望这有帮助。

**编辑 1**

*   根据[dimyG](https://stackoverflow.com/users/2369865/dimyg)的回答更新过滤器

*   添加 django-widget-tweak 链接

**编辑 2**

*   根据[Bhyd](https://stackoverflow.com/users/2823526/bhyd)的评论更新过滤器

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2010-11-25T00:06:15.370

扩展指向 docs.djangoproject.com 的方法：

```
class MyForm(forms.Form): 
    comment = forms.CharField(
            widget=forms.TextInput(attrs={'size':'40'})) 
```

我认为必须知道每个字段的本机小部件类型很麻烦，并且认为覆盖默认值只是将类名放在表单字段上很有趣。这似乎对我有用：

```
class MyForm(forms.Form): 
    #This instantiates the field w/ the default widget
    comment = forms.CharField()

    #We only override the part we care about
    comment.widget.attrs['size'] = '40' 
```

这对我来说似乎更干净一些。

* * *

## 回答 #6

> 赞同：33
> 
> 时间：2013-12-13T18:35:43.863

如果你想让表单中的所有字段都继承某个类，你只需定义一个父类，它继承自`forms.ModelForm`，然后从它继承

```
class BaseForm(forms.ModelForm):
    def __init__(self, *args, **kwargs):
        super(BaseForm, self).__init__(*args, **kwargs)
        for field_name, field in self.fields.items():
            field.widget.attrs['class'] = 'someClass'

class WhateverForm(BaseForm):
    class Meta:
        model = SomeModel 
```

这帮助我将`'form-control'`类自动添加到我的应用程序的所有表单上的所有字段中，而无需添加代码复制。

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2017-08-13T02:27:26.987

只需将类添加到您的表单中，如下所示。

```
class UserLoginForm(forms.Form):
    username = forms.CharField(widget=forms.TextInput(
        attrs={
        'class':'form-control',
        'placeholder':'Username'
        }
    ))
    password = forms.CharField(widget=forms.PasswordInput(
        attrs={
        'class':'form-control',
        'placeholder':'Password'
        }
    )) 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2011-01-12T10:42:45.900

这是改变视图的简单方法。在将其传递到模板之前在视图中添加以下内容。

```
form = MyForm(instance = instance.obj)
form.fields['email'].widget.attrs = {'class':'here_class_name'} 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2018-10-24T03:19:03.377

你可以试试这个。。

```
class SampleClass(forms.Form):
  name = forms.CharField(max_length=30)
  name.widget.attrs.update({'class': 'your-class'})
... 
```

您可以在以下位置查看更多信息：[Django Widgets](https://docs.djangoproject.com/es/2.1/ref/forms/widgets/)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-03-04T07:38:15.777

这是上面的一个变体，它将为所有字段提供相同的类（例如 jquery 漂亮的圆角）。

```
 # Simple way to assign css class to every field
  def __init__(self, *args, **kwargs):
    super(TranslatedPageForm, self).__init__(*args, **kwargs)
    for myField in self.fields:
      self.fields[myField].widget.attrs['class'] = 'ui-state-default ui-corner-all' 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-12-13T19:37:15.637

如果您想将类添加到**模板**（不在 view.py 或 form.py 中）中的表单字段，例如在您想修改 3rd 方应用程序而不覆盖其视图的情况下，则使用所述的模板过滤器在*Charlesthk* [回答](https://stackoverflow.com/a/18962481/2369865)很方便。但是在这个答案中，模板过滤器会覆盖该字段可能具有的任何现有类。

我尝试将此添加为编辑，但建议将其编写为新答案。

因此，这是一个尊重该字段现有类的模板标签：

```
from django import template

register = template.Library()

@register.filter(name='addclass')
def addclass(field, given_class):
    existing_classes = field.field.widget.attrs.get('class', None)
    if existing_classes:
        if existing_classes.find(given_class) == -1:
            # if the given class doesn't exist in the existing classes
            classes = existing_classes + ' ' + given_class
        else:
            classes = existing_classes
    else:
        classes = given_class
    return field.as_widget(attrs={"class": classes}) 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-03-05T09:44:53.053

事实证明，您可以在表单构造函数（**init**函数）中或在表单类启动后执行此操作。如果您不编写自己的表单并且该表单来自其他地方，则有时需要这样做 -

```
def some_view(request):
    add_css_to_fields = ['list','of','fields']
    if request.method == 'POST':
        form = SomeForm(request.POST)
        if form.is_valid():
            return HttpResponseRedirect('/thanks/')
    else:
        form = SomeForm()

    for key in form.fields.keys():
        if key in add_css_to_fields:
            field = form.fields[key]
            css_addition = 'css_addition '
            css = field.widget.attrs.get('class', '')
            field.widget.attrs['class'] = css_addition + css_classes

    return render(request, 'template_name.html', {'form': form}) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-12-21T17:09:26.637

你也可以使用[Django Crispy Forms](https://github.com/django-crispy-forms/django-crispy-forms)，如果你想使用一些 CSS 框架，如 Bootstrap 或 Foundation，它是一个定义表单的好工具。在那里为您的表单字段指定类很容易。

你的表单类会这样：

```
from django import forms

from crispy_forms.helper import FormHelper
from crispy_forms.layout import Layout, Div, Submit, Field
from crispy_forms.bootstrap import FormActions

class SampleClass(forms.Form):
    name = forms.CharField(max_length=30)
    age = forms.IntegerField()
    django_hacker = forms.BooleanField(required=False)

    helper = FormHelper()
    helper.form_class = 'your-form-class'
    helper.layout = Layout(
        Field('name', css_class='name-class'),
        Field('age', css_class='age-class'),
        Field('django_hacker', css-class='hacker-class'),
        FormActions(
            Submit('save_changes', 'Save changes'),
        )
    ) 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-08-10T18:42:39.617

[您可以在此处](https://docs.djangoproject.com/en/3.2/ref/forms/widgets/)获取各种输入字段的样式选项

小部件是 Django 对 HTML 输入元素的表示。小部件处理 HTML 的呈现，以及从对应于小部件的 GET/POST 字典中提取数据。

```
email = forms.EmailField(label='Your email', widget=forms.EmailInput(attrs={'class': 'ui segment teal'})) 
```

# iphone - 图层命中测试仅在触摸图层的下半部分时返回图层

> ID：401040
> 
> 赞同：4
> 
> 时间：2008-12-30T18:25:05.013
> 
> 标签：iphone, cocoa-touch, core-animation

我在支持图层的视图上有一个子图层。子图层的内容设置为 Image Ref 并且是 25x25 矩形。
当调用 touchesBegan 和 touchesMoved 方法时，我在超级层上执行命中测试。事实上，hit 测试方法确实会在子图层被触摸时返回，但仅在图像的下半部分被触摸时才返回。如果触摸图像的上半部分，它会返回超级图层。

我知道 iPhone OS 弥补了用户触摸低于预期的趋势。即使我将子图层调整为更大的尺寸（50x50），它也会表现出相同的行为。

有什么想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-25T20:06:24.000

hitTest 的文档说：

```
/* Returns the farthest descendant of the layer containing point 'p'.
 * Siblings are searched in top-to-bottom order. 'p' is in the
 * coordinate system of the receiver's superlayer. */ 
```

所以你需要做（这样的事情）：

```
CGPoint thePoint = [touch locationInView:self];
thePoint = [self.layer convertPoint:thePoint toLayer:self.layer.superlayer];
CALayer *theLayer = [self.layer hitTest:thePoint]; 
```

（为了完整起见，重复其他帖子的答案）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-05T00:56:25.817

似乎该层不仅仅是在底部像素上接收触摸。相反，似乎屏幕上的“实际”层和层的内容是由不同的 CGRect 定义的。图像显示在预期的坐标处，而响应触摸的层在图像下方偏移。下面，我的意思是图像的原点在 (200, 200)，响应触摸的图层的原点在 (200, 220)。

下面我发布了一些我用来重现问题的测试代码。首先是我的视图子类，然后是我的视图控制器。非常感谢这个问题背后的任何推理。

我的视图子类：

```
#import "myView.h"
#import <QuartzCore/QuartzCore.h>

@implementation myView

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {

    CGPoint currentLocation = [[touches anyObject] locationInView:self];

    CALayer *currentLayer = [self.layer hitTest:currentLocation];

    CGPoint center = [currentLayer position];

    NSLog([currentLayer valueForKey:@"isRootLayer"]);

    if(![currentLayer valueForKey:@"isRootLayer"]) {

        if (center.x != 200) {

            [currentLayer setPosition:CGPointMake(200.0f, 200.0f)];     

        } else {
            [currentLayer setPosition:CGPointMake(100.0f, 100.0f)];     

        }
    }
}

- (id)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) {
        // Initialization code
    }
    return self;
}

- (void)drawRect:(CGRect)rect {
    // Drawing code
}

- (void)dealloc {
    [super dealloc];
}

@end 
```

我的视图控制器：

```
#import "layerTestViewController.h"
#import <QuartzCore/QuartzCore.h>

#define ELEMENT_PERIOD_SIZE 50
#define ELEMENT_GROUP_SIZE 50

@implementation layerTestViewController

// Implement viewDidLoad to do additional setup after loading the view, typically from a nib.
- (void)viewDidLoad {
    [super viewDidLoad];

    CALayer  *myLayer = [CALayer layer];
    CGRect layerFrame =CGRectMake(0.0f, 0.0f, ELEMENT_GROUP_SIZE, ELEMENT_PERIOD_SIZE);
    myLayer.frame = layerFrame; 

    [myLayer setName:[NSString stringWithString:@"test"]];
    [myLayer setValue:[NSString stringWithString:@"testkey"] forKey:@"key"];

    UIGraphicsBeginImageContext(layerFrame.size);
    [[UIColor blueColor] set];
    UIRectFill(layerFrame);
    UIImage *theImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    myLayer.contents = (id)[theImage CGImage];
    myLayer.position = CGPointMake(100.0f, 100.0f);

    [self.view.layer addSublayer:myLayer];   

    [self.view.layer setValue:[NSString stringWithString:@"YES"] forKey:@"isRootLayer"];
    NSLog([self.view.layer valueForKey:@"isRootLayer"]);

}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning]; // Releases the view if it doesn't have a superview
    // Release anything that's not essential, such as cached data
}

- (void)dealloc {
    [super dealloc];
}

@end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-21T10:55:47.827

接受的答案不能解决问题，但 schwa 的答案可以。

我有一个窗口、一个视图控制器和视图。`hitTest:`视图在其层上接收触摸和调用。我有同样的问题，发现视图中的点是正确的，但是在`hitTest:`点的y坐标上是20px的，恰好是状态栏的高度。

按照 schwa 的建议，通过将该点映射到超层的坐标系，这个问题得到了解决。“神秘”的超级层是超级视图的根层。在我的例子中，它是窗口层（frame (0, 0, 320, 480)）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-05T11:38:04.820

如果仅在下部识别触摸，则一种可能性是另一个子视图覆盖了该子视图的上半部分。你有多个子视图还是只有一个图像？如果您有多个子视图并且其中任何一个的背景颜色为 clearColor，请尝试为其提供纯色背景颜色以进行测试。这样你就会知道你的子视图是否被另一个子视图覆盖。

希望有帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-05T18:20:34.213

我已经简化了我的代码来找出问题所在。我在屏幕上只有一个子图层，没有子视图。上面列出的代码是我在模拟器中运行的。由于屏幕上只有 2 层，即主视图的支持层和我添加的子层，因此不会干扰命中测试。

如果不清楚，当子层的顶部被触摸时，命中测试会返回背衬层。此外，如果我在子层正下方的某个点触摸支撑层，则命中测试会返回子层。

这很难解释，但如果你运行代码，它就会变得清晰。

谢谢

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T01:46:19.763

谢谢凯文...

我最终只是用 UIViews 重做我的代码。只是想弄清楚为什么 UIView 不知道被触摸的是什么层太麻烦了。这个想法背后的全部原因是，我将一次在屏幕上显示 100 多个项目，并且认为层在处理器上比 UIViews 更容易。我现在已经启动并运行了该应用程序，并且 100 次查看并没有给它带来任何问题。

我对其他人的建议是尽可能坚持命中测试 UIViews，它使代码更简单

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-04-10T03:44:42.480

/// 添加frame.origin.y

```
 public override func hitTest(_ point: CGPoint, with event: UIEvent?) -> UIView? {
        let convertPoint = CGPoint(x:point.x, y:(point.y + frame.origin.y))
        let superPiont = self.layer.convert(convertPoint, to:layer.superlayer)
        selectlayer = layer.superlayer?.hitTest(superPiont)
        } 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-05T22:53:32.570

当我尝试您的代码时，我得到了几乎正确的行为，除了在子层的边缘通常无法识别触摸。我对发生了什么感到有些困惑。你可能想尝试做一些事情，比如当你注册一个触摸时，在触摸发生的地方扔一个新的小层（比如某种颜色的 5x5 正方形），然后在 3 秒后再次将其移除。这样您就可以跟踪 CA 认为触摸发生的位置与您的光标实际所在的位置。

顺便说一句，您不需要为蓝色内容创建 CGImage，您只需将图层设置`backgroundColor`为`[UIColor blueColor].CGColor`.

# windows - QueryPerformanceCounter 和线程安全

> ID：401051
> 
> 赞同：5
> 
> 时间：2008-12-30T18:29:54.787
> 
> 标签：windows, multithreading, performancecounter

我正在考虑在两个同时处于活动状态的线程中对 QueryPerformanceCounter 进行重复调用（旋转）。我不确定这是否真的是一个问题，因为我没有看到任何关于它的文章，但是 QueryPerformanceCounter 线程安全吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T18:37:39.247

这取决于您对 QueryPerformanceCounter 的论点所在的位置。如果它是两个线程之间的共享变量，那么听起来该函数不是线程安全的。

因此，我建议每个线程都有自己`LARGE_INTEGER`的传递给 QPC 的调用。每个调用都相互独立，并且应该`LARGE_INTEGER`适当地更新各自的 s。

如果您在多处理器环境中，有关此功能的[MSDN 文章](http://msdn.microsoft.com/en-us/library/ms644904.aspx)还提示[设置关联掩码。](http://msdn.microsoft.com/en-us/library/ms686247(VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T19:09:06.187

> 我正在考虑在两个同时处于活动状态的线程中对 QueryPerformanceCounter 进行重复调用（旋转）。

哎呀。想想你在做什么以及有多少处理器可用。如果您有一个处理器，这将不起作用：它们不能“同时处于活动状态”，因为 QueryPerformanceCounter 不会将控制权从一个线程交给另一个线程。我相当确定单处理器的win32中的线程切换具有大约1毫秒的时间粒度。

如果您有多个处理器，则可能会得到错误的结果（理论上——我没有多处理器 PC，所以我自己没有观察到这一点）。更多关于 QPC 的有趣讨论可以在互联网上找到（例如，参见[Raymond Chen 的](http://blogs.msdn.com/oldnewthing/archive/2008/09/08/8931563.aspx)博客）

如果您真的想等待优化时间，我建议您在有此类专家的游戏编程论坛之一上询问最佳方法。

# javascript - jQuery UI - 通过选择器隐藏和取消隐藏元素的交换功能

> ID：401056
> 
> 赞同：0
> 
> 时间：2008-12-30T18:31:12.707
> 
> 标签：javascript, jquery, jquery-ui

前言：我在一个页面上包含了 jQuery 和 jQuery UI。

我定义了这个函数：

```
 function swap(sel) {
        if (1 == 1) {
           $(sel).hide('drop',{direction:'left'});
        }
    } 
```

如何修复 (1 == 1) 部分以测试该元素是否已隐藏，然后将其带回（如果是）。我确信这很容易，但我是 jQuery 的新手。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T20:28:08.040

如果您不喜欢`toggle`，那么这可能会对您有所帮助：

```
function swap(sel) {
  if($(sel).is(':visible')) {
    $(sel).hide('drop',{direction:'left'});
  } else {
    $(sel).show('drop',{direction:'left'});
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T18:34:59.533

为什么不使用[toggle()](http://docs.jquery.com/Effects/toggle)？

例如：

```
function swap(sel) {
  $(sel).toggle();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T18:35:32.903

也许`$(sel).toggle();`是您正在寻找的东西？这是切换元素可见性的最佳方式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T20:27:58.090

正如其他回答者所说，`toggle()`是最好的解决方案。但是，如果由于某种原因您不能/不想使用切换，并且您的选择器仅用于一个元素：

```
function swap(sel) {
    if ($(sel).is(':visible')) {  // Is this element visible?
       $(sel).hide('drop',{direction:'left'});
    }
} 
```

**警告：** 如果元素或其任何父元素是 :visible 检查将返回误报`:hidden`。如果这对您很重要，您可能需要[查看此解决方案](http://remysharp.com/2008/10/17/jquery-really-visible/)，该解决方案也尝试检查其中的任何内容。

# asp.net - 哪些 ASP.NET Web 控件实现了 IPostBackDataHandler？

> ID：401060
> 
> 赞同：0
> 
> 时间：2008-12-30T18:32:54.997
> 
> 标签：asp.net, postback, viewstate

有人可以指出我实施的控制列表`IPostBackDataHandler`吗？

我想知道哪些控件实现了这个接口以及控件在`Postback`.

例如：

> 文本框：文本
> 
> 下拉列表：选定索引

我基本上是在寻找一个不会保存在`ViewState`.

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T19:22:02.653

在 .NET IDE 中打开对象浏览器窗口。您可以在“查看”菜单上找到此窗口，或者根据您的配置在顶部工具栏上找到此窗口。

在类中的搜索文本框中输入，或在本例中为界面，您正在寻找：`IPostBackDataHandler`并提交。

在结果中，展开类型，然后展开派生类型文件夹，你会找到你想要的！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-04-30T12:34:22.763

这就是@TheZenker，正在谈论...

![在此处输入图像描述](https://i.stack.imgur.com/QzzjR.png)

# php - Textmate Regex 查找替换帮助

> ID：401067
> 
> 赞同：1
> 
> 时间：2008-12-30T18:37:23.523
> 
> 标签：php, regex, replace, find, textmate

我有一个项目，我正在将一些遗留的 perl cgi 表单转换为 PHP。其中很多需要查找/替换信息。在这种情况下，我在 perl 脚本中有这样的行：

```
<INPUT type="radio" name="trade" value="1" $checked{trade}->{1}> 
```

需要阅读：

```
<INPUT type="radio" name="trade" value="1" <?php echo checked('trade', 1); ?>> 
```

另一个例子展示了这些标签如何在 perl/html 中显示的一些变化：

```
<INPUT type="radio" name="loantype" value="new" $checked{loantype}->{new}>
<INPUT type="radio" name="loantype" value="new" $checked{'loantype'}->{new}>
<INPUT type="radio" name="loantype" value="new" $checked{'loantype'}->{'new'}>
<INPUT type="radio" name="loantype" value="new" $checked{loantype}->{'new'}> 
```

如您所见，引号可以在任何地方，但这不是我的问题。我决定在 textmate 中编写一个查找/替换正则表达式，让我的生活更轻松一些。我的正则表达式看起来像：

```
Find:     \$checked\{'?([^']+)'?\}->\{'?([^']+)'?\}
Replace:  <?php echo checked('$1', '$2'); ?> 
```

这在我使用的第一个文件中运行良好，但由于某种原因，在当前文件中，正则表达式变得非常贪婪，匹配了很多行。它将匹配开头 (\$checked...)，然后匹配到字符 '}' 出现的最后一次。我尝试了一些变体以使其不那么贪婪，包括：

```
 ^(.*)\$checked\{'?([^']+)'?\}->\{'?([^']+)'?\}(.*)$ 
```

但即使这样似乎也匹配多行。我假设开头的 ^ 只会匹配一行的开头，而末尾的 $ 只会匹配结尾...将我的匹配限制为 1 行...但似乎并非如此。

/me 在正则表达式中失败

感谢您的帮助，迈克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T18:49:30.923

试试这个：

```
^(.*?)\$checked\{'?([^']+?)'?\}->\{'?([^']+?)'?\}(.*?)$ 
```

`?`之后`*`并使`+`他们“不贪婪” 。

# model-view-controller - 微软使用 MVC 对开源有什么影响？

> ID：401072
> 
> 赞同：1
> 
> 时间：2008-12-30T18:38:48.310
> 
> 标签：model-view-controller, open-source

我正在听 11/24 的 Hansel Minutes 播客谈论月光。

套用一句话，Scott 评论说微软对开源的态度正在迅速改变，尤其是在采用 MVC 架构的情况下。

我承认我对 MVC 对开发世界的意义没有最好的“全局”把握，但具体来说，我想知道它如何使开源社区受益？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T18:44:51.493

事实上，MVC 本身似乎与开源没有任何关系，只是 Ruby on Rails 受到了它的启发，这是开源开发人员使用和喜欢的东西。MVC 和 Microsoft 开源战略的主要内容是 ASP.NET MVC，这可能对 Microsoft 来说很重要，它作为开源软件发布，并且正在社区内开发。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T18:44:32.587

任何将任何代码作为开源发布的人都在为开源社区做一些事情。

将开源社区想象成一个巨大的 wiki——信息和想法越多，wiki 就越好。您在这里并做出贡献会使 stackoverflow 受益，因为任何积极的输入都会增加更大的利益。

因此，Microsoft 的贡献（无论其价值如何）使开源社区受益，因为他们说：“这是我们决定实现 MVC 框架的方式，请随意看看”。

谁知道谁会从中受益？也许很多，也许没有。这就是事物的美妙之处。

# delphi - Delphi：处理用户的字体偏好

> ID：401075
> 
> 赞同：11
> 
> 时间：2008-12-30T18:40:31.503
> 
> 标签：delphi, preferences, dpi

我提出了获取用户 UI 字体偏好的调用（与 Borland 的硬编码选择“MS Sans Serif”相对）。

假设用户的字体偏好是：

```
Segoe Print, 15pt 
```

我将所有应用程序中所有表单上所有项目的字体设置为：

```
Segoe Print, 15pt 
```

问题是现在事情被切断了。按钮太小 - 太窄，太短。标签中的文本被切断等。

该表单具有它的 Scaled 属性，但这不会根据字体大小而改变。scaled 属性在序列化时根据数字“0”的高度对表单进行缩放。

我在帮助中找不到关于 Borland 打算如何支持用户的 Windows 应用程序首选项的任何内容。

如何处理用户字体偏好？

**注意：**我从 Embargadero 的新闻组服务器交叉发布了此内容，因为 Embargadero 的新闻服务器似乎正在死亡、审查、损坏或需要登录。

* * *

## 更新 1

我说的是用户的字体偏好，而不是 DPI 设置。即：想象以下**语言中性**伪代码：

```
procedure TForm1.FormCreate(Sender: TObject);
var
    FontFace: string;
    FontHeight: Integer;
begin
    GetUserFontPreference(out FontFace, out FontHeight);
    Self.Font.Name := FontFace;
    Self.Font.Height := FontHeight;
end; 
```

**注意：**这不是我的实际代码（毕竟它是语言中性的伪代码）。但此外，您需要递归地遍历表单上的每个控件，在需要更改字体时更改字体。当字体应用了与其父字体不同的样式（例如粗体），并且不再从其父字体继承时，需要手动设置。

* * *

根据[lkessler](https://stackoverflow.com/users/30176/lkessler)的要求，下面是从 Windows 检索用户 UI 字体首选项的代码：

```
procedure GetUserFontPreference(out FaceName: string; out PixelHeight: Integer);
var
    lf: LOGFONT;
begin
    ZeroMemory(@lf, SizeOf(lf));
     //Yes IconTitleFont (not SPI_GETNONCLIENTMETRICS MessageFont)
    if SystemParametersInfo(SPI_GETICONTITLELOGFONT, SizeOf(lf), @lf, 0) then
    begin
        FaceName := PChar(Addr(lf.lfFaceName[0]));
        PixelHeight := lf.lfHeight;
    end
    else
    begin
        {
            If we can't get it, then assume the same non-user preferences that
            everyone else does.
        }
        FaceName := 'MS Shell Dlg 2';
        PixelHeight := 8;
    end;
end; 
```

## 相关问题

*   [.NET 2.0 WinForm：支持 DPI 和默认字体更改](https://stackoverflow.com/questions/196606/-net-2-0-winform-supporting-dpi-and-default-font-changes)
*   [.NET WinForms：Graphics.MeasureString 返回与 Win32 GetTextExtent 不同的值](https://stackoverflow.com/questions/203577/-net-winforms-graphics-measurestring-returns-different-values-than-win32-gettext)
*   [WPF：如何在 XAML 中布局对话框？](https://stackoverflow.com/questions/395195/wpf-how-to-layout-a-dialogs-in-xaml)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-30T19:02:45.250

首先，我们很清楚，Borland 不再拥有 Delphi。Embarcadero 现在拥有 Delphi，我们现在安全可靠。

好的，关于你的问题。

诀窍是将 TForm.AutoScroll 设置为 False 并确保您的开发机器设置为小字体。单独留下 TForm.Scaled（它的默认值为 True）。

这就是我们在内部执行此操作的方式，IDE 可以很好地处理所有内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-15T21:43:45.570

我喜欢使用这个功能。它基于 Graphics.GetFontData

```
procedure SystemFont(Font: TFont);
var
  LogFont: TLogFont;
begin
  if SystemParametersInfo(SPI_GETICONTITLELOGFONT, SizeOf(TLogFont), @LogFont, 0) then
    begin
      Font.Height := LogFont.lfHeight;
      Font.Orientation := LogFont.lfOrientation;
      Font.Charset := TFontCharset(LogFont.lfCharSet);
      Font.Name := PChar(@LogFont.lfFaceName);

      Font.Style := [];

      if LogFont.lfWeight >= FW_BOLD then
        Font.Style := Font.Style + [fsBold];

      if LogFont.lfItalic = 1 then
        Font.Style := Font.Style + [fsItalic];

      if LogFont.lfUnderline = 1 then
        Font.Style := Font.Style + [fsUnderline];

      if LogFont.lfStrikeOut = 1 then
        Font.Style := Font.Style + [fsStrikeOut];

      case LogFont.lfPitchAndFamily and $F of
        VARIABLE_PITCH: Font.Pitch := fpVariable;
        FIXED_PITCH: Font.Pitch := fpFixed;
        else Font.Pitch := fpDefault;
      end;
    end;
end; 
```

您只需在所有 TForm.OnCreate 事件上使用它。另一种方法是创建一个新类，在创建或循环 Screen.Forms 时执行此操作。

如果您更改表单上任何控件的默认字体的某些属性，它们仍将使用旧字体。如果您想要某些控件的自定义属性，则必须在调用 SystemFont 后对其进行调整。

如果表单设计器仅将更改的属性写入 .dfm 文件，则在运行时更改 Graphics.DefFontData 可能会有所帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T20:24:06.257

我和你有感觉。但平心而论：正确的 GUI 布局根本无法使用 VCL 所采用的基于像素的布局机制来创建。需要的是一个动态布局引擎，它只在之后布局控件

1.  已为每个控件设置了正确的字体（这取决于 Windows 版本、用户偏好以及最后但并非最不重要的控件类型）；和

2.  控件中的文本已被翻译为当前语言环境，因为这可能会减少或增加控件所需的空间。

由于这完全取决于运行时属性，因此通过放置控件来创建对话框是行不通的。像 GTK 和 QT 或 wxWidgets 中的 sizer 这样的布局机制更适合。

我知道德尔福程序没有这样的事情。我在某些程序中所做的是在字体设置和文本翻译之后手动调整控件的大小和定位。很多工作，但取决于你的听众，这可能是值得的。

您还可以查看 Jordan Russell 为 Inno Setup 编写的代码。他不使用表单的 Scaled 属性，但编写了用于自定义缩放控件的代码。也许它也适用于高 DPI 屏幕上的超大字体；我注意到至少在我的 124 DPI 笔记本电脑屏幕上，设置对话框看起来相当不错。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T21:03:36.253

To do this right, I think you would have to:

1 - Load the user's font preference

2 - Apply it as you've described

3 - Determine the width and height of all captions (in pixels) and compare that to the control's width & height, and adjust accordingly.

Unfortunately, the "adjust accordingly" part is hard. You could widen a button, but then you'd have to check whether that is overlapping with another control.

Your best bet might be to create slightly oversized controls, and hope the user doesn't choose a 32-point font size.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T23:59:14.997

Kogus had the right idea, but left out the function you need to use. It would be the Windows [GetTextExtentPoint32](http://msdn.microsoft.com/en-us/library/ms534223(VS.85).aspx) routine. You pass it a string and it calculates the width and height of the string using the currently selected font. You'll find it in Windows.pas.

You might want to calculate in advance what the maximum space you would need for fonts you allow.

Or you might use the function to dynamically adjust the size of the area displaying the text so that it fits.

This would be fine for one or two controls, but either method would be a lot of work if you're trying to do this on your whole user interface.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-31T10:13:25.303

我会说这类似于翻译。在我们的应用程序中，我们将按钮、标签、编辑等所有内容都做得更大一点，以便可以轻松容纳某些语言所需的较长单词。它不会对设计造成一点伤害。

# oracle - 向 Oracle 存储过程添加排序键和过滤器

> ID：401079
> 
> 赞同：2
> 
> 时间：2008-12-30T18:44:15.317
> 
> 标签：oracle, stored-procedures

我在 Oracle 中有一个存储过程，它返回一个选择语句游标引用。我希望能够传递列名和排序方向（例如：“CompanyName DESC”）并能够对结果进行排序，或者传递诸如“CompanyID > 400”之类的过滤器并能够将其应用于 select 语句。实现这一目标的最佳方法是什么？该表位于旧数据库中，有 90 列，我不想为每个可能的组合做逻辑。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T19:32:13.100

我想你想要一个带有`OPEN-FOR`and的游标`USING`。

```
CREATE OR REPLACE FUNCTION sort_table (
    p_sort VARCHAR2
    )
IS
    TYPE cursor_type IS REF_CURSOR;
    cur_out cursor_type;
    lv_cursor_txt VARCHAR2(300);
BEGIN
    lv_cursor_txt = 'SELECT * FROM table :sort';
    OPEN cur_out FOR lv_cursor_txt USING p_sort;
    -- Opening the cursor isn't probably what you want, but I'm not sure how to associate the variables except on open
    RETURN cur_out;
END; 
```

这不是一个很好的例子，但我希望它有所帮助。

[Oracle 在Dynamic SQL](http://download.oracle.com/docs/cd/B28359_01/appdev.111/b28370/dynamic.htm)页面中谈到了这一点。DBMS_SQL 包也可能有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T19:31:37.330

请参阅此处：[http](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1288401763279) ://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1288401763279和[http://asktom.oracle.com/pls/asktom/f? p=100:11:0::::P11_QUESTION_ID:6711305251199](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:6711305251199)

我特别喜欢这种方法：[http ://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1288401763279#4988761718663](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1288401763279#4988761718663)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-22T20:05:44.880

[http://forums.oracle.com/forums/thread.jspa?threadID=2177728&tstart=0](http://forums.oracle.com/forums/thread.jspa?threadID=2177728&tstart=0)

CASE WHEN :P4_SORT_ORDER = 1 THEN ROW_NUMBER() OVER (ORDER BY UPPER(ENAME))

或 decode(:Sort_var,1,ROW_NUMBER() OVER (ORDER BY UPPER(ENAME)),2,ROW_NUMBER() OVER (ORDER BY UPPER(地址)))

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T17:42:33.497

您可能已经知道，R. Bemrose 的答案使用动态 SQL 更易于实现。出于这个原因，它可能是最常用的。如果您这样做，请务必按照他（/她？）的方式进行操作，使用绑定变量（例如 USING p_sort），而不是仅仅将字符串连接到 lv_cursor_txt 上。这种方法比串联提供更好的性能和安全性。

第二种方法使用应用程序上下文，我没有看到它使用得太多，但我怀疑如果你经常调用查询会提供更好的查询性能。

祝你好运。

# windows - “Windows”键作为快捷键的一部分

> ID：401084
> 
> 赞同：3
> 
> 时间：2008-12-30T18:48:03.767
> 
> 标签：windows, windows-xp, keyboard-shortcuts

我在进行开发时经常打开一个控制台窗口。通常`Win`+ `R`-> cmd -> 回车。但是，Windows 还允许您向任何快捷方式添加快捷键......但是当我尝试添加`Win`+`C`以使我最喜欢的大小/形状/缓冲控制台的快捷方式出现时，它使用`Ctrl`+ `Alt`+`C`代替（已在各种编辑器中使用和其他应用程序......不行。）

有没有办法将 windows 键用作快捷键组合的一部分？

*（这适用于 Windows XP）*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T18:58:59.140

你可以使用[自动热键来做](http://www.autohotkey.com/)这种事情。

当你在它的时候。使用[控制台](http://sourceforge.net/projects/console/)可大大改善命令控制台体验。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T18:59:03.243

如果您阅读工具提示（单击 ?，然后单击标签），它会自动使用`Ctrl`+`Alt`来选择最后一个字符而不是其他修饰符——我假设避免与现有快捷键重叠。所以，不，我认为您不能以这种方式分配 Windows 键。不过，可能有一些第三方工具（例如[AutoHotKey](http://www.autohotkey.com/)）可以让您这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T19:14:04.947

另请参阅 Kana 的 SendKey 可执行文件。[地点](http://www.kanasolution.com/index.php?fid=13&pid=2&utilid=5)

您会看到 LWIN 或 RWIN 甚至允许您选择左侧或右侧的 WinKey。它在编写脚本时非常通用......而且作为奖励，它不需要安装。

以下是自述文件内容：

```
___________
DESCRIPTION:

Kana SendKey is a command line program which can be used
to send a system wide hotkey.

__________
HOW TO USE:

1\. Run it with several parameters attached into the
   command line. For information about the parameters,
   see the Parameter section below.

2\. You can also create a shortcut and assign the parameters
   on shortcut.

______
SYNTAX:

KanaKey [parameter1] [parameter2] ...

Example:
To send system wide CTRL+ALT+O, use:
KanaKey CTRL ALT O

Note: If no parameter is given, no action is performed.

__________
PARAMETERS:

  CTRLBREAK   = Control+Break
  BACKSPACE   = Backspace key
  TAB         = Tab key
  CLEAR       = Clear key
  RETURN      = Enter key
  SHIFT       = Shift key
  CTRL        = Ctrl Key
  ALT         = Alt key
  PAUSE       = Pause key
  CAPS        = Caps Lock key
  ESC         = Esc key
  SPACE       = Space key
  PAGEUP      = Page Up key
  PAGEDOWN    = Page Dn key
  END         = End key
  HOME        = Home key
  LEFT        = Left Arrow key
  UPARROW     = Up Arrow key
  RIGHTARROW  = Right Arrow key
  DOWNARROW   = Down Arrow key
  PRINTSCR    = Prnt Scrn key
  INSERT      = Insert Key
  DEL         = Delete Key
  LWIN        = Left Win key
  RWIN        = Right Win key
  NUM0        = Numeric 0 key
  NUM1        = Numeric 1 key
  NUM2        = Numeric 2 key
  NUM3        = Numeric 3 key
  NUM4        = Numeric 4 key
  NUM5        = Numeric 5 key
  NUM6        = Numeric 6 key
  NUM7        = Numeric 7 key
  NUM8        = Numeric 8 key
  NUM9        = Numeric 9 key
  MULTIPLY    = * key on numeric key pad
  ADD         = + key on numeric key pad
  SUBTRACT    = - key on numeric key pad
  DECIMAL     = . key on numeric key pad
  DIVIDE      = / key on numeric key pad
  F1          = F1 key
  F2          = F2 key
  F3          = F3 key
  F4          = F4 key
  F5          = F5 key
  F6          = F6 key
  F7          = F7 key
  F8          = F8 key
  F9          = F9 key
  F10         = F10 key
  F11         = F11 key
  F12         = F12 key
  F13         = F13 key
  F14         = F14 key
  F15         = F15 key
  F16         = F16 key
  F17         = F17 key
  F18         = F18 key
  F19         = F19 key
  F20         = F20 key
  F21         = F21 key
  F22         = F22 key
  F23         = F23 key
  F24         = F24 key
  NUMLOCK     = Num Lock key
  SCROLLLOCK  = Scroll Lock key 
```

# c# - 预防性与反应性 C# 编程

> ID：401090
> 
> 赞同：13
> 
> 时间：2008-12-30T18:50:18.067
> 
> 标签：c#, coding-style

除非我确定不会有错误，否则我一直是一个在防止异常情况方面犯错误的人，除非我确定不会发生错误，否则我永远不会采取任何行动。我学会了用 C 编程，这是真正做事的唯一方法。

使用 C# 我经常看到更多的反应式编程 - 尝试做某事并处理异常。对我来说，这似乎是使用异常作为控制语句。最初几次我看到这一点时，我认为这是不好的做法。但在过去的几个月里，我到处都看到了它，我不得不怀疑——这是被接受/有效的还是只是一种流行病？

更新：为了澄清一下，我看到的大多数异常处理都是这样的

```
try
{
    //open file
}
catch
{
    //message box for file not found
} 
```

甚至更糟

```
try
{
    //open xml
    //modify xml (100+ lines of code)
}
catch
{
    //message for 'unspecified error'
} 
```

我知道有时异常处理非常好用（例如数据库连接），但我指的是使用异常来代替更多“传统”控制。我问这个是因为我觉得这种编程风格是使用异常作为拐杖而不是作为一种恢复方法，并且想知道这是否只是我必须学会在 C# 世界中期待的东西。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-30T19:52:49.377

像往常一样，答案是“视情况而定”，但我总体上赞同“快速失败”的理念。

我更喜欢使用 try/finally（无捕获），除非我实际上可以做一些有用的事情来从特定代码块中的异常中恢复。捕获所有可能的异常是不值得的。一般来说，快速失败比默默失败更可取。

另一方面，如果您知道如何从特定异常中恢复，那么是的，去做吧。

假设您有一个文件传输库。如果传输由于超时或网络故障而中断，它可能会抛出异常。这是合理的。如果图书馆只是默默地失败，你会很生气；检查返回码更容易出错，并且不一定更具可读性。但也许您有一个将一堆文件发送到服务器的业务规则，您应该在放弃并请求用户干预之前至少尝试传输文件 3 次。在这种情况下，业务逻辑应该处理异常，尝试恢复，然后在自动解决方案失败时执行它应该执行的任何操作（提醒用户，安排稍后的尝试，或其他）。

如果您找到执行此操作的代码：

```
try
{
    // do something that could throw
    // ...
}
catch {} //swallow the exception 
```

或者：

```
catch { return null; } 
```

那应该**是**坏了。当然，有时您调用的代码可能会引发您真正不关心的异常。但是我经常看到人们这样做只是为了不必在上游“处理”异常；这种做法使事情更难调试。

有些人认为允许异常向上级联责任链是不好的，因为你只是“希望”上游的某个人会“奇迹般地”知道该怎么做。那些人是错的。上游代码通常是唯一**可以**知道该做什么的地方。

有时，我会尝试/捕获并抛出一个不同的、更合适的异常。但是，在可能的情况下，使用保护条款会更好。例如。`if (argument==null) throw new ArgumentNullException();`比允许 NullReferenceException 向上传播调用堆栈要好，因为它更清楚出了什么问题。

一些“不应该发生”或“我不知道会发生”的情况可能应该被记录下来（例如，参见 jboss 日志记录），但至少在某些情况下可以在它们关闭您的应用程序之前将其吞下。

ETA：获取特定异常然后显示一般的、模棱两可的错误消息可能会被破坏。对于上面的第二个示例，这对我来说听起来很糟糕。对于您的第一个“未找到文件”，这可能更合理（如果您实际上捕获了该特定异常，而不仅仅是“一切”），除非您有更好的方法来处理其他地方的这种情况。模态消息框对我来说通常是一种糟糕的“交互设计气味”，但这大多是无关紧要的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-30T19:11:13.533

在某些情况下，您被迫做出反应：检查和操作并不总是有效。

访问磁盘上的文件：磁盘工作正常吗？文件存在吗？我可以获得文件的读取权限吗？

访问数据库：服务器是否接受连接？我的资历好吗？数据库对象是否存在？列的名称/类型是否正确？

所有这些事情都可以在检查和操作之间发生变化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T18:52:45.707

你当然可以滥用异常是c#。在我看来，你永远不应该得到 ArgumentNullException，因为你应该总是先测试 null。但是，也有很多情况下您无法通过范围检查来摆脱异常。任何与“外部世界”交互的东西（连接到 Web 服务器、数据库等）都可能引发异常。

尽量避免，但你仍然需要对其他一切做出反应的能力。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T21:18:35.460

在我的 C++ COM 时代，我学会了不要向后弯腰来处理“可能的”错误——也就是说，我不会定期检查每个函数调用的返回值。那是因为我知道我无法成功处理未知条件：

*   我不知道它什么时候会失败，或者这意味着什么。

*   我做不到，所以我无法测试我的错误处理代码。未经测试的代码是不起作用的代码。

*   我不知道用户希望我做什么。

*   例行错误处理可能会让程序继续运行，但不是以用户将从中受益的可靠、可预测的方式。

*   快速而显着地失败（而不是缓慢而巧妙地）不会使用户陷入错误的安全感，并为程序员提供更好的诊断问题的机会。

显然，我不是说“从不处理错误”，我说的是“只有在可以增加价值时才处理错误”。

同样的原则也适用于 C#。我认为如果您可以将异常包装在更相关的异常中并抛出它，那么捕获异常是一个好主意。如果您确定您的用户将如何从您处理异常中受益，那么就去做吧。但除此之外，别管它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T19:04:42.233

我相信你是正确的，使用异常作为控制语句是一种不好的做法。.Net 中的异常很慢。[正如 Jon B提到](https://stackoverflow.com/questions/401090/preventive-vs-reactive-c-programming#401094)的那样，进行自己的检查总是比使用异常来捕获“坏”值（例如 Null）要好得多。

我在一个 .Net 1.1 应用程序中直接发现了该应用程序，该应用程序创建了实验室数据的分隔文本文件。我使用异常来捕获包含无效数据的字段，但是一旦我用适当的检查代码替换了异常，应用程序就会成倍地加速。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T19:10:32.270

线索在术语“例外”中。

*如果为 null 的参数是一个有效的业务条件*，那么根据定义，一个 null 参数不是异常，并且**应该**在使用它之前进行测试。在这种业务条件下使用异常来控制程序逻辑是一种草率的编码，并且应该用湿黑线鳕反复拍打肇事者，直到他悔改为止。

然而，抛开性能不谈，在这个例子中总是盲目地测试空参数，并不比在抛出异常时总是捕获异常好。

*如果参数不可能为 null ，则不应进行 null***测试**-除非在应用程序的最顶层，未处理的异常被捕获、存储、通过电子邮件发送给支持团队，并对用户隐藏应以道歉的方式显示适当的信息。

我曾经不得不调试一个应用程序，其中所有可以想象的该死的异常都得到了处理，而且实际上是不可能调试的。它必须从生产环境中撤出，连同它的数据库一起进入开发环境，并且所有的处理程序都被删除了。在那之后它是微不足道的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T21:05:34.830

在 C++ 中输入 try-block 是一项昂贵的操作（就 CPU 周期而言），因此您应该尽量减少使用它们。对于 C#，输入 try-block 很便宜，因此我们可以以不同的方式使用它。

现在; 在 C# 中捕获异常是昂贵的，并且仍然应该用于异常情况而不是一般程序逻辑，正如其他人已经在此处所述...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-30T18:55:04.627

C/C++ 也可以是反应式的。您有多少次看到尝试进行诸如 fopen 之类的操作，然后进行 NULL 检查？异常的优点是它们允许提供比 NULL 或 False 返回更多的信息。

大多数以任何支持它们的语言抛出异常的操作都无法事先“测试”以确保操作成功。

现在运行时异常是完全不同的东西。这些通常是由无效数据或数据滥用（被零除）引起的。在我看来，这种异常永远不应该被当作处理它们的一种方式。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-30T21:50:08.890

如果不全面讨论异常策略，就很难讨论异常的最佳使用。例如，您的策略可以是以下任何一种：

*   尽可能接近故障点处理所有异常
*   记录一个异常，然后重新抛出给调用者
*   回滚到异常前状态，并尝试继续
*   将异常转换为适当的错误消息并显示给用户

异常处理通常会因为在同一个项目上工作的多个开发人员甚至可能没有相同的策略，或者更糟糕的是，甚至不知道存在一个策略这一事实而变得复杂。因此，团队中的每个人都知道并理解战略是很重要的。

有关异常处理和策略的良好起点，请参阅 Ned Batchelder 的博客文章[Exceptions in the Rainforest](http://nedbatchelder.com/text/exceptions-in-the-rainforest.html)。

# .net - .NET 部署脚本

> ID：401095
> 
> 赞同：0
> 
> 时间：2008-12-30T18:53:03.600
> 
> 标签：.net, scripting, deployment

我正在研究部署一批 .NET 应用程序的各种选项。部署不仅仅是复制文件，我们需要停止/启动服务，调用执行数据库脚本的 EXE 文件，启动一些`setup.exe`安装等等。

这些脚本将提供给第三方，第三方将向我们的各种客户服务器应用各种应用程序更新。

两个最佳选项似乎是[CS-Script](http://en.wikipedia.org/wiki/CS-Script)和[PowerShell](http://en.wikipedia.org/wiki/Windows_PowerShell)，但我会让投票决定。

更新：根据到目前为止的回复，我觉得我应该澄清一下。首先，应用更新的人将是系统管理员类型；不是最终用户。因此，在这种情况下，一个成熟的安装程序[WiX](http://en.wikipedia.org/wiki/WiX)、[Wise](http://en.wikipedia.org/wiki/Wise_Solutions,_Inc.#Current_Products)等可能是矫枉过正。

其次，可以安全地假设 .NET 2.0 甚至 PowerShell（或 CS-Script 或其他）将安装在这些机器上。我们正在创建图像，以便我们可以指定要安装的内容。问题是一旦我们决定了一个镜像，在应用程序更新之外，我们将编写脚本，安装“新”应用程序将非常困难。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T19:21:14.277

我推荐使用[WiX](http://wix.sourceforge.net)创建安装程序。它具有完成出色工作所需的所有功能，而且它是免费的，由微软支持，具有声明性和可扩展性。它也很好地集成到了 VisualStudio 和 MSBuild-Process 中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-24T23:47:28.143

比较 CS-Script 和 PowerShell，以下是 CS-Script 相对于 PowerShell 的一些优势：

*   CS-Script 重量更轻，更易于部署。[http://www.csscript.net/help/Deployment.html](http://www.csscript.net/help/Deployment.html)说：“与脚本本身一起分发脚本引擎可执行文件（cscs.exe/csws.exe）”。
*   C# 是一种广泛接受的语言，具有易于访问的调试器。PowerShell 是另一种需要学习的语言。
*   C# 可以选择编译

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T18:58:29.643

这实际上完全取决于您对什么感到满意以及最终用户（如果有的话）将如何使用它。所有脚本语言都允许你做你想做的事。您甚至可以使用简单的批处理脚本来完成此操作。

如果要涉及最终用户并且他们不应该是系统管理员，我建议使用完整的安装程序。通过这种方式，他们可以以图形方式告诉他们正在做什么。如果它是为系统管理员或只是为了您自己使用，任何脚本语言都可以让您首先完成它，即使它是 VBS。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T18:58:34.930

使用 PowerShell 作为脚本环境进行部署的缺点是您必须确保目标计算机具有 .NET Framework 2.0 和 PowerShell。为此，您需要一个脚本，因此您将回到原来的问题减去 PowerShell。

我喜欢 PowerShell 作为脚本环境。它易于使用、灵活并且可以轻松处理部署场景。此外，由于它在 .NET 上运行并且您正在部署 .NET，因此内部人员查看和调试脚本的开销更少。

就个人而言，我会尝试使用一个引导脚本来确保安装 PowerShell，然后使用 PowerShell 作为实际的部署脚本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T19:04:53.297

听起来您正在寻找一个包装包来安装和设置许多其他东西......

作为一名前 Windows 安装程序开发人员，我强烈推荐[NSIS](http://en.wikipedia.org/wiki/Nullsoft_Scriptable_Install_System)来轻松创建和完全由脚本驱动的安装程序过程。NSIS 有大量可用的插件，可以让您运行外部程序、启动和停止服务、捕获命令行输出，并且基本上可以在他们的脚本语言中做任何您能想象到的事情。

NSIS 链接：http: [//nsis.sourceforge.net/Main_Page](http://nsis.sourceforge.net/Main_Page)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-16T19:25:26.530

我们采取了多种方法。最后，对我们来说效果很好的是：

*   具有良好命令行处理能力的普通可执行文件。
*   使用脚本（F#、IronPython、CS-Script）进行操作的库。
*   msbuild（调用可执行文件，有时是自定义任务，有时是脚本）

推测性：考虑使用[MS Deploy](http://technet.microsoft.com/en-us/library/dd569024.aspx)（在 RC1）。它可以完成您需要做的大部分事情。我现在正在评估。

效果不佳的地方：拥有上述 + 批处理文件的大杂烩。随着时间的推移，一切都将趋向于移动到可执行文件和安装库中，因为它是可以处理所有任务和扩展的技术。强制性的用户界面步骤是邪恶的并强制手动安装。

CS-Script 和 Powershell 都有缺点。CS-Script - 笨重的程序集引用方案。Powershell：很少有人能站着看。在使用这些之前，在每个中做一个概念证明——也许你会比我更喜欢它们。我的经验对这些很轻——在概念验证后，我关闭了 IronPython。

# open-source - 我们是否通过从事开源项目而自取其辱？

> ID：401103
> 
> 赞同：25
> 
> 时间：2008-12-30T18:57:57.210
> 
> 标签：open-source

我一直在考虑从事一些开源项目的想法，主要是因为与其他人这样做的原因相同：为了好玩和学习新东西。但现在这些 OS（开源）项目比以往任何时候都更加强大，并且越来越受欢迎。所以，我一直在想，**我们开发人员是否通过免费工作而扼杀了我们的职业？**我知道有一些操作系统项目会支付一些费用，但与在一家全职软件公司工作所获得的报酬相比，这根本不算什么。

想想这些最坏的情况：

*   OpenOffice 或任何其他这些办公套装让 Microsoft Office 垮台，现在微软不得不解雇数千名开发人员，因为这个......
*   Linux 成为排名第一的操作系统，苹果和微软都不得不裁员 Windows 和 Mac 开发人员。

想想这个类比：

*   如果有“开源银行”怎么办？！出纳员、经理、高管等都非常友好，免费工作，并提供一些出色的产品，为什么要去美国银行支付大量费用，对吧？

换句话说，如果所有软件都开源了怎么办？这可能永远不会发生，或者即使发生了，我们仍然会有很多工作，但无论如何，我想看看其他人如何看待我这种疯狂的偏执狂:)

* * *

也可以看看：
[https://stackoverflow.com/questions/196131/making-money-with-open-source-as-a-developer](https://stackoverflow.com/questions/196131/making-money-with-open-source-as-a-developer)
[https://stackoverflow.com/questions/116581/open-source-why-or-why-not](https://stackoverflow.com/questions/116581/open-source-why-or-why-not)
[自由软件和开源软件的区别](https://stackoverflow.com/questions/276957/the-difference-between-free-software-and-open-source-software)

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-12-30T19:03:03.940

开源并不意味着免费工作。尽管产品本身是免费的，但大多数从事大型开源项目的开发人员都是有偿的。这笔款项可以来自支持它的第 3 方，也可以来自为运行该项目而创建的基金会。

您真的认为 Open Office 等项目的主要开发人员正在免费工作吗？

此外，通常有许多公司是因为基于支持和安装的开源软件而成立的。很多时候，这些都是由软件的创建者运行的。Asterix 是一个开源项目的一个很好的例子，它具有基于安装和支持的公司方面。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-12-30T19:06:36.460

大多数开发人员不从事 MS Office、Windows 或 OS X 之类的项目。大多数开发人员从事的定制软件在他们的公司之外从未见过，也从未在他们的小行业之外听说过。这种类型的专用软件通常不出售，实际上甚至不是公司的最终产品。

开源软件是很多这种定制软件的基础。通过理解和贡献，你会让自己对这些公司非常有吸引力。

我相信最大的开源成功是围绕基础设施类型的项目（Web 服务器和操作系统），我认为这些是开源最重要的。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-30T19:11:32.267

有赚钱的开源商业模式。它们通常遵循以下模式之一（或某种组合）：

1.  使软件开源但出售支持（例如 Postgresql）
2.  使软件开源，但收取“赏金”以实现特定功能（例如 Reiserfs）
3.  使软件开源，但将一些闭源“高级”功能捆绑到商业版本（例如 MySql）中。

最重要的是，这取决于您正在使用哪种开源软件。对于基础设施类型的项目，例如库、实用程序、通用服务器等，您实际上可以为创建新的软件行业创造机会。如果他们都必须为每个处理器支付 4 万美元的 Oracle 许可证、网络服务器许可证、操作系统许可证等，会有多少网络初创公司？如果 Apache Commons、Hibernate 等不存在，有多少 Java 产品永远不会出现？有时，创建一些开源的东西可以使以前从未存在过的全新商业模式成为可能。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-30T19:08:21.447

有足够多的软件问题，解决操作系统或 Office 问题应该只允许程序员从事更高级别的工作。

就像微软在windows 3.1中包含网络堆栈时的争论一样——每个人都担心它会让销售堆栈的公司失业。我很高兴他们做到了，并欢迎他们也将防病毒软件放入操作系统中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-30T19:07:35.973

> 如果有“开源银行”怎么办？！出纳员、经理、高管等都非常友好，免费工作，并提供一些出色的产品，为什么要去美国银行支付大量费用，对吧？

这不是一个很好的类比（开源！= 无所事事），但是......*现在*使用 BoA 银行业务是一个糟糕的选择；这是一家糟糕的银行。信用合作社实际上与您所描述的很接近，但商业银行继续……嗯，存在。

> OpenOffice 或任何其他这些办公套装让 Microsoft Office 垮台，现在微软不得不解雇数千名开发人员，因为这个......

为此，OO 需要在功能、易用性和支持方面达到或超过 MSOffice。为此*，* MS 需要*完全*丢球。以 Internet Explorer 为例：实际上已被废弃多年，但仍占据大部分市场。还有其他因素在起作用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-30T19:07:31.980

我从事开源工作有几个原因。首先，显然是为了提高我的技能。二是好玩。不过最近最重要的可能是因为我厌倦了可能很酷的东西，这些东西最终会放在一个我无法告诉任何人的专有架子上。建造一些东西然后由于缺乏资金而萎靡不振是非常令人沮丧的。如果我在业余时间免费工作，它仍然不是“我的”，而且我基本上是在免费工作。我宁愿能够分享它。

然而，有一些开明的公司（有时包括我自己的公司）愿意投资于开源开发。在这些情况下，除了为开源工作而获得报酬外，还可以进行机动，使您获得报酬来做您不想在自己的时间做的不那么有趣的事情。诸如文档之类的东西，对您并不真正关心的依赖项的支持等。请注意它不会远离您:)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T19:00:55.503

我对此表示怀疑。就个人而言，开源项目最初是用来获得新技能的爱好——我可以将这些技能卖给最终的雇主，并能够指出我编写的实际代码正在使用中。

您必须亲自权衡决定。你会通过编写开源代码来进一步发展自己吗？它会给你更多的深度/广度吗？它是否以您希望自己的职业发展的方式发展您？更好的是——你这样做有报酬吗？

即使所有代码都是开源的，我们最终也会成为顾问。许多公司付钱让员工从事开源项目。我能想到的例子是 IBM、RedHat 和 Sun。许多公司通过支持合同和通过集成开源来赚钱。还是有很多钱在四处飘荡。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-30T19:07:04.180

这是一个权衡。是的，你免费工作，但你也在学习——正如你所指出的。

我真的认为，如果一个 OSS 项目到了威胁微软的地步，那么在此之前它早就不再是“免费的”了。

这有点像 2000 年代初期（甚至现在在某种程度上）的担忧，即向收入较低的国家运送编程工作会使美国开发人员失业。如果您孤立地考虑逻辑，这是正确的，但是当您开始将其置于“真实”世界中时，它就会崩溃。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-30T19:08:26.207

所有软件都不会开源。对定制软件的需求太多，所以总会有人愿意花钱请程序员为他们编写软件。

为开源项目做贡献有点像律师做公益工作。程序员需要得到报酬，但如果他们热爱编程，他们会希望将自己的时间贡献给他们关心的开源项目。

从事他们喜欢的项目的程序员可以开发出出色的应用程序，如果它是一个封闭的项目，这些应用程序就永远不会出现。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-30T19:18:28.820

首先，OO 颠覆 Office 或 Linux 颠覆 Windows 是不可能的。商业软件是商业的，开源是开源的，这是有原因的。

我只使用 OO，因为它是免费的。如果 OO 和 Office 都是免费的，我会立即选择 Office，因为 OO 像狗一样慢并且功能较少。而且 Linux 是严格的技术人员……如果您不喜欢自己动手，只是想要一些不需要付出太多努力的东西，那么您必须使用 Windows 或 Mac。

使软件更实用和功能更强大的所有额外的小改动都是使商业软件物有所值的原因。为什么是这样？好吧，开源开发人员养家糊口的能力并不依赖于他们的产品销售。

这不是谁的错。就是这样。你为质量买单，你得到质量。在您为质量付费并获得垃圾的时代，如果没有开源项目来取消它，那家公司可能会倒闭。

（哦，将 Photoshop 添加到商业产品列表中比免费的 Gimp 更容易）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-02T09:53:48.523

不是那么非黑即白，我们还需要考虑动机……

很少有人全职从事开源工作......大多数开发人员，正如之前的回答之一所说，在公司内部项目上工作以支付账单，然后在开源项目上实现自我实现。

用心理学术语来说，特别是[马斯洛的需求层次，](http://en.wikipedia.org/wiki/Maslow%27s_Hierarchy_of_Needs)日常工作满足生理和安全需求，而审美需求通过在开源项目中获得的自我实现和尊重得到部分满足。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-14T15:18:12.440

开源项目成为任何专有解决方案的**唯一**竞争对手实际上是相当罕见的，事实上大多数主流软件已经具有相当广泛的商业竞争。

因此，从这个角度来看，相关商业/专有解决方案的供应商之间通常已经存在更多的竞争。

另外，出于个人经验：每当我真正参与开源项目时，通常是由于对商业/专有、闭源解决方案的一定程度的“挫败感”，这些解决方案根本不具备丰富的功能和可定制性或欢迎功能请求和支持查询。

老实说，我确实认为这种“搔痒心态”是许多开源项目和参与贡献者经常和共同的动机：在某些时候，大多数项目都是因为闭源解决方案根本不接受用户反馈而开始的（请求/问题或只是想法）。

事实上，我真的知道有几个我完全不介意使用的闭源项目，仅仅是因为他们有很棒的支持并且非常擅长处理他们的社区——基本上，我认为没有必要切换到一个开放的解决方案。

因此，在某些时候，它确实归结为能够与您的客户和用户社区进行适当的交互（这适用于闭源**和**开源），这还包括接受功能请求和报告的问题：如果你无法处理你的项目引起的社区动力，它实际上可能会反击你并且弊大于利，因为它可能不可避免地导致用户社区感到沮丧，这可能意味着你的社区正在远离您为了检查替代方案，或者 - 在开源设置中 - 只需分叉您的代码并自行处理问题。

因此，从这个角度来看：***任何***类型的竞争通常都归结为不同的愿景，这可能是由于最初不接受这种愿景而引起的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-30T19:12:02.533

我不确定所说的确切数字，但我记得，90-95% 的程序员从事内部业务项目，而不是面向大众市场的软件。大多数（如果不是全部的话）开源软件都是面向大众市场的。因此，虽然我们可能会失去一些工作，但我们可能不会对整体程序员需求产生太大影响。除非有一些企业大量外流到 COTS 软件，而不是个性化系统，我认为在不久的将来不会发生这种情况，我认为大多数程序员的工作不会有任何危险。此外，开源软件有助于为商业软件创造竞争，从而为进一步开发闭源软件创造更多需求。看看 IE 在开源浏览器 Firefox 开始成为重要竞争对手之前休眠了多久。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-30T19:15:34.850

请记住，许多开源项目没有与付费产品相同级别的支持。例如，以微软、ESRI、甲骨文、IBM 等大公司为例。这些公司从咨询、服务和支持方面获得了大量利润，超出了盒装软件的初始成本。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-30T19:21:37.397

通过开发 OSS 项目，开发人员可以为整个代码库做出贡献并帮助每个人。我自己，如果不是因为 unix 和 Apache，我会失业。OSS 是许多让其他软件变得更好、更容易使用的好工具，我不想成为没有它们的行业。

如果 OSS 项目减少了付费开发职位的数量，那就太好了 - 付钱给人们重写已经以同行评审、社区支持的形式提供的代码不会更有效率。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-12-06T20:54:45.097

我认为除了已经提到的优点。开源项目为大学毕业生提供了在进入现实世界之前获得一些经验的绝佳机会。

它还增加了你找到工作的机会。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-12-06T21:37:16.150

我认为，大部分钱都用于定制、支持和维护......

开源软件提高了开发人员的生产力，因为它减少了重新从头开始的必要性……它只是一个工具，可以有效地创建真正的解决方案……一个可以立足的平台……

几乎没有为最终用户设计的开源软件......重点不是，它是免费的（就像免费啤酒一样），而是其他人可以免费（就像自由一样）来适应他们的需求......开源来自开发者为开发者......最终用户只倾向于看到免费啤酒方面，但不清楚是否使用免费软件，这需要更陡峭的学习曲线并且提供的支持较少，并且没有很多保证，最后还是便宜了很多。。。

为开源软件做贡献可以提高您的生产力，因为您可以非常了解该框架/库/工具，并且可以充分利用其潜力，并且 - 至少部分地 - 随意塑造它......

在排除商业用途的强大 Copyleft 下分发的自由软件（你很少在这样的东西上运行）是另一种野兽，但在 IDE 的情况下，编译器和其他开发工具很酷......

此外，对于放弃商业解决方案的源代码存在一定的恐惧……这也很偏执……当然，每个人都可以在获得源代码后修改您的源代码（无论是免费的还是花钱的）……但是，为了做到这一点，有问题的开发人员必须熟悉源......这需要很多钱（因此需要时间），除非他们的公司真的计划大规模这样做（在 GPL 下，这也意味着，他们的工作将作为对项目的贡献返回），支付任何项目贡献者以修改所需的修改要便宜得多......

美好的日子，开发人员被付钱重新发明轮子的日子已经一去不复返了......他们中只有少数人有幸有时间在时髦的库/框架/平台等上工作，而他们中最少的人得到了他们想要的钱应得的……但他们得到了挑战、乐趣、经验、功劳和创造适合自己需求的工具的机会……

如果你选择为一个开源项目做贡献，你依赖于你自己和支持这个项目的社区......你只依赖后者，如果你只是参与（这意味着只使用它并发送错误报告），并且您依赖一家公司，如果您选择成为专有软件的用户...我认为，第一个是您能做的最好的，第二个是在踢自己的脚，最后一个只是将其砍掉.. .

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-12-06T22:16:09.440

从长远来看，我认为开发人员会从开源中获益。

考虑到大多数开源项目都是“基础设施”——Linux OS、Apache Web 服务器、jQuery 等 Javascript 库，以消除浏览器之间的差异并简化常见任务。

Linus Thorvalds 创建 Linux 是因为他想要一个类似 Unix 的系统，而无需支付数千美元的许可证。与阿帕奇类似。创建 Firefox 是为了避免让微软控制 Web，并暗示所有 Web 开发人员的命运。

如果没有开源替代方案，所有操作系统和 Web 服务器都由 Microsoft 或 IBM 控制，并且您必须支付数万美元的许可证才能运行一个简单的网站，那么今天的 Web 会是什么状态？今天会有成千上万的 Web 开发人员有工作吗？

我认为普遍的论点是拥有一个高质量、或多或少的自由软件基础设施

*   提供更优质的基础设施
*   使您不必为只能从一个特定商业供应商处购买的技术培训（*咳嗽*MCP*咳嗽*DB2*cough*）支付大量费用 - 现在它们是可选的，因为存在其他替代品
*   使程序员免于为每个客户分别重新实现相同的通用功能的繁琐
*   为解决新的和有趣的问题类别开辟了新途径
*   软件**用户**的数量——开发者的潜在市场——增加了几个数量级

这对社会以及个人程序员和商业软件都是有益的。

我确实认为将所有软件都作为开源发布是自杀，这相当于一生都在免费工作。

但是对于主要由开发人员使用的一大类便利库和通用开发基础设施，我认为优点远远超过缺点。并且自己从事开源工作，您可以获得在其他地方可能很难找到的经验。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-07-10T05:33:13.650

开源模型并不适用于所有情况。我想银行不太可能采用这种模式，因为它根本不适合。

没有人来安装、维护和开发开源软件就无法工作。如果 Mac 和微软开源，仍然需要工人。事实上，我的工作是维护开源产品。我不支持闭源系统。

另外：微软已经在拥抱开源： http:
[//www.microsoft.com/web/gallery/Categories.aspx](http://www.microsoft.com/web/gallery/Categories.aspx)

# bash - 安装脚本的正确组件？

> ID：401111
> 
> 赞同：1
> 
> 时间：2008-12-30T19:00:51.883
> 
> 标签：bash, installation

我正在编写一个 bash 脚本来设置生产服务器。手头的任务包括编译软件、创建用户和目录、复制文件等。

我想知道我还应该做些什么。也许登录到文件？检查 0 退出状态？我可以添加什么来真正使这个脚本变得更好，而不仅仅是“它有效”？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-31T05:42:10.793

也许您应该重新考虑如何将软件部署到生产服务器：

1.  编译软件应该在您的开发环境中完成，而不是在生产服务器上。无需在生产服务器上安装编译器。并且有很多理由不这样做（主要是安全原因）。

2.  使用包管理系统来部署您的软件。如果您使用的是 linux，请使用 deb、rpm 或您的发行版使用的任何包管理器。这将使您可以完全控制安装的版本，并提供依赖项功能。

3.  安装您的软件的包应该带有您的软件需要的所有文件（除非这些文件可以由其他包提供），并且还设置用户、目录、权限以及您的软件需要的任何其他内容。

4.  基本上，您可以在包的安装后和删除后部分编写 bash 脚本。

5.  确保测试一旦安装，包带来并创建运行程序所需的一切，卸载包，删除所有文件，并撤消安装后脚本所做的事情。

6.  确保将包从版本 X 升级到 X+1 按预期工作。

关于剧本本身。您当然应该检查您运行的命令的退出状态。您可以使用[Wrapper 脚本](https://stackoverflow.com/questions/372116/what-is-the-best-way-to-write-a-wrapper-function-that-runs-commands-and-logs-thei)，这样您就不必重复退出代码检查和每个命令的日志记录。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T16:58:34.257

在我的工作中，我们有 shell 脚本来自动化构建服务器时的几乎所有事情。基于一些配置文件和诸如此类的东西，操作系统的安装是完全自动化的。修补、添加用户等都是为了让生活更轻松而编写的。

但是，当我们需要部署企业应用程序时，这些服务器是“应用程序服务器”，请注意，这是一个完全不同的过程。我们与一组完全不同的管理员、中间件人员打交道。我们为他们提供从 dev 升级到 qa 再到 prod 的二进制文件。

自动设置盒子是完全正常的，但您不想在生产盒子上“构建”应用程序。如果由于任何原因性能受到影响，任何实时应用程序都会在该框进行一个大的讨厌的编译过程时看到。:D

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-24T21:55:04.720

@Tom：稳定且成功的 Linux 发行版的一个示例是 Gentoo，其中所有二进制文件都在安装之前在服务器上编译（发行版中不存在二进制文件）。它已被 isohunt.com 等大型生产服务器使用。

在服务器上构建二进制文件是一个好主意，因为它确保您的二进制文件在主机平台的某个级别上进行了优化，前提是安装程序为编译器提供了正确的标志。

在服务器上安装 GCC 不会伤害任何人 IMO :)

@拉斯：

你应该-

保留一个日志文件，添加纠正错误和前进所需的步骤。

在开发过程开始时，通过消息处理异常到标准输出，并在测试脚本时提供处理程序。

总的来说，尽量为您的用户减轻工作，他们可能真的不知道您的脚本执行的微管理（复制文件、安装守护进程、创建文件系统、设置权限等等），并且只有您的安装程序才能成功完成该过程.

在多个系统上测试脚本将确保它可以工作

# java - 将值从 JavaScript 发送到 JSP（使用 jQuery）

> ID：401114
> 
> 赞同：5
> 
> 时间：2008-12-30T19:02:31.990
> 
> 标签：java, javascript, jquery, jsp, integration

现在我有一个允许对一些项目进行排序的 JSP 页面，当准备好并单击链接时，JavaScript 函数将所有信息转换为 XML（变量中的文本），之后我需要将此 XML 发送到 JSP 页面再次，我尝试将信息放在隐藏的输入中并提交表单，使用 $.post 和更多的 jQuery 函数发送，但没有任何效果。有任何想法吗？

在我的 JSP 中，我正在阅读这样的帖子：

```
<% out.println(request.getParameter("data")); %> 
```

这不起作用：

```
xml = "<xml></xml>";
$("#form").submit(function(){
   alert("JS: " + $("#data").text());
   $("#data").text(xml);
}); 
```

这要么：

```
xml = "<xml></xml>";
$("#data").text(xml);
$("#form").submit(); 
```

用 .html 替换 .text 也不起作用。欢迎任何想法，thx

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T21:38:23.423

你可能在这里走错路了。您没有提供 html 代码，但我认为它是这样的：

```
<form method="POST" id="form">
    <input type="hidden" id="data" />
</form> 
```

如果这是正确的，那么你应该说，`$("#data").val(xml);`而不是`text()`或者`html()`因为那些用你提供的文本或 html 改变匹配的东西。这应该适用于您当前的解决方案。

此外，我建议将 jQuery`$.post()`和其他人视为将所有内容打包为 xml 的替代方案，除非这确实是您在后端想要的。使用由某些名称键入的所有值组成一个 javascript 对象并将其传递给 jQuery`$.post(), $.get()`等之一可能会更容易，如下所示：

```
var values = {name: "John", surname: "Doe"};
values.age = 25;
$.post("index.jsp", values); // this will result in a post with 3 variables: name, surname, age 
```

实际上，我现在才想到您也可以通过这种方式发送 xml（除非您更喜欢自己的做事方式）：

```
$.post("index.jsp", {data: "<xml><whatever-else-needs-to-be-in-here/></xml>"}); 
```

您可能想在这里更多地启发自己：[Ajax @ jQuery docs](http://docs.jquery.com/Ajax)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T19:12:20.690

尝试使用[jQuery Ajax](http://docs.jquery.com/Ajax) API - 您可以使用它通过 GET 或 POST 发送任意数据，而无需设置隐藏表单或任何东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T19:05:49.563

您总是可以使用 XMLHttpRequest 来发送数据。这可以通过我们在表单提交按钮等元素上无需用户交互来完成。jQuery 具有内置的功能来协助处理此类请求。

[http://docs.jquery.com/Ajax](http://docs.jquery.com/Ajax)

# python - Django 中的 ForeignKey 形式限制

> ID：401118
> 
> 赞同：4
> 
> 时间：2008-12-30T19:04:16.183
> 
> 标签：python, django, django-forms

我正在使用 Django 编写博客应用程序，并且正在尝试实现分层类别结构。每个类别都有一个“父”外键，指向同一个类别模型。我想允许管理员添加类别，并且我希望界面允许他们选择类别的父类别。但是，我想避免我是我自己的祖父的情况，所以我想将可用的类别选择限制为那些没有作为祖先的类别。

现在，我正在从视图中控制它：

```
parent_candidates = list(Category.objects.all())
pruned_parent_list = [cat for cat in parent_candidates if instance.id not in cat.getHierarchy()] 
```

其中 instance 是正在编辑的类别，而 getHierarchy() 是获取祖先 ID 列表的方法。

这种方法存在许多问题。特别是，它使用额外的数据库命中来获取所有类别的列表，并且当我真的只想指定一个小部件时，它使我通过循环 pruned_pa​​rent_list 来将选择机制写入我的模板以获取选项。

有没有更好的方法来做到这一点？我知道我可以在后端添加自定义验证来防止这种情况，但为什么要让用户选择呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T08:20:45.420

我不得不处理 SQL 上的任意深度类别，它似乎不太适合以正常形式存储这种类型的数据，因为嵌套查询和/或多个 JOIN 往往会很快变得*丑陋*。

这几乎是我会采用一种不恰当的解决方案的唯一情况，即以字符串形式存储类别，子类别由分隔符分隔。它使数据库查询和其他操作变得更加简单。

类别表看起来像这样：

```
id    name
1     Internet
2     Internet/Google
3     Internet/Yahoo
4     Offline
5     Offline/MS Office/MS Excel
6     Offline/Openoffice 
```

另一个解决方案是，根据您的预期用途，您可以在类别列表中实现二叉树。这允许优雅地选择类别树和父/子关系。然而，它的局限性在于，在插入新类别时，可能必须重新计算整个树，并且提前知道树的大致大小是有用的。

无论如何，SQL 中的分层数据本身并不是微不足道的，因此，无论您做什么，您都可能需要进行一些自定义编码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T13:09:01.300

看看[django-treebeard](http://code.google.com/p/django-treebeard/)应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T19:20:22.453

“有没有更好的方法来做到这一点？” 并不真地。层次结构在关系模型中很难。除了完全放弃 SQL 之外，没有什么比这更容易了。

“通过循环 pruned_pa​​rent_list 将选择机制写入我的模板以获取选项” - 可能不是最佳的。在您看来，这应该发生。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T19:42:19.180

如果我正确理解您的困境，那么问题本身就在于您处理哪些类别可以是父母，哪些不能是父母的方式。避免这些问题的一种选择是实际限制可以成为父母的类别的级别。例如，假设您有以下类别：

*   互联网
    *   谷歌
    *   雅虎
*   离线
    *   微软Office
    *   开发办公室

我通常处理这个问题的方式显然是在类别表上有一个 parent_id FK。对于根元素（Internet、Offline），parent_id 将为 0。因此，当您在视图中尝试检索下拉列表的“父类别”时，您需要确定它们可以嵌套多远。我主要将其限制在第一级，因此要选择要在下拉列表中显示的类别，您可以执行以下操作：

```
parents = Category.objects.filter(parent_id=0) 
```

现在显然，这在一定程度上限制了方法，但是您可以增加您想要包含的级别并在模板中为下拉菜单制定某种视觉识别系统（包括层次结构中每个级别的额外空格或破折号或其他东西）。

无论如何，对冗长的回复感到抱歉，希望这能在一定程度上解决您的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T20:36:29.833

我不确定这是否更好（交互方式或其他方式）但是......

您可以在保存时检查层次结构完整性，并在必要时引发错误。

理想情况下，对于这种数据类型，我希望在旁边看到一棵实例树。或者至少是对象详细视图上的完整祖先。在这两种情况下，您已经完成了提到数据库的额外行程。

# sql-server - GO 和 BEGIN...END 之间的区别

> ID：401135
> 
> 赞同：13
> 
> 时间：2008-12-30T19:10:15.437
> 
> 标签：sql-server

SQL 脚本/存储过程中的“GO”和“BEGIN...END”有区别吗？更具体地说，BEGIN...END 是否像 GO 一样指定批次？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-30T19:14:37.830

GO 实际上不是服务器理解的命令。它只是客户端工具（例如查询分析器）使用的分隔符，用于将 SQL 拆分为多个批次。然后通常将每个批次分别发送到服务器。客户端工具通常允许您将批处理分隔符配置为您选择的任何内容，GO 是一种约定。

BEGIN/END 是一个块标记，它以与其他语言中的花括号相同的方式包装一段代码。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-30T20:02:05.037

还有一件关于 GO 的小事。

在 GO 之间定义的变量仅适用于该区域，并且不存在于该区域之外。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T19:15:05.287

## 去

分批分隔不同的语句（不能在存储过程中使用）

## 开始 .. 结束

用于对 SP 中的内容进行分组，例如 C# 中的 { 和 }

```
IF x
BEGIN 
   -- do y
   -- do w
END 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T19:52:29.313

每当您在 t-sql 中使用 if 时，使用 begin 和 end 语句也是一个好习惯。如果不使用 begin 和 end，那么只有 if 语句之后的下一条语句将作为 if 的一部分执行，这通常会导致错误。

# c# - 如何约束多个泛型类型？

> ID：401174
> 
> 赞同：21
> 
> 时间：2008-12-30T19:16:00.760
> 
> 标签：c#, generics, syntax

这是一个简单的语法问题（我希望如此），我知道如何使用 where 子句来约束一个泛型类型，但是如何约束两个泛型类型呢？

也许最简单的方法是写下我对语法的最佳猜测。

```
public class GenericDaoGetByIdTests<TDao, TComponent> : BaseDaoTests 
  where TDao : IDao<TComponent>, TComponent : EDC2ORMComponent {
    public void GetByIdTest(int id) { }
} 
```

这给了我一个错误。任何人都知道正确的语法是什么？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-12-30T19:21:16.443

使用两个 'where' 关键字，例如我有这样的声明：

```
public interface IParentNodeT<TChild, TSelf>
    where TChild : IChildNodeT<TSelf, TChild>, INodeT<TChild>
    where TSelf : IParentNodeT<TChild, TSelf>
{
    TChild childRoot { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-30T19:23:32.557

这应该有效：

```
public class GenericDaoGetByIdTests<TDao, TComponent> : BaseDaoTests 
  where TDao : IDao<TComponent> where TComponent : EDC2ORMComponent {
    public void GetByIdTest(int id) { }
} 
```

你只是重复在哪里。

# javascript - 使用 jQuery，你可以有两个使用 $(document).ready(function() 的外部脚本吗？

> ID：401178
> 
> 赞同：1
> 
> 时间：2008-12-30T19:17:16.187
> 
> 标签：javascript, jquery

我想将 jQuery .js 文件一分为二，但我注意到当我将其拆分时某些功能不起作用。是不是因为我有两个以以下开头的外部脚本：

$(文档).ready(函数(){

那不可能吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T19:20:09.303

是的，您可以拥有两个同时设置的脚本`$(document).ready(...).`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T19:25:51.677

哎呀，我想我找到了答案。

[http://docs.jquery.com/Events/ready#fn](http://docs.jquery.com/Events/ready#fn)

# c++ - 任何好的教程都可以帮助我创建用于在 C、C++ 中随机化的头文件

> ID：401183
> 
> 赞同：-6
> 
> 时间：2008-12-30T19:19:00.693
> 
> 标签：c++, c

我想为 C、C++ 创建一个头文件，专门用于帮助随机化。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T19:31:36.517

头文件是 C 文件，除了它们*不应*包含任何代码实现（仅声明）。

例如，假设 C 文件“dummy.c”：

```
int dummy_function(int x){
   return x+1;
} 
```

一个好的 C 头文件应该是：

```
#ifndef _DUMMY_HEADER_H_
#define _DUMMY_HEADER_H_ //This helps solve some possible errors

int dummy_function(int x);

#endif 
```

如果您使用结构作为参数（或返回值），您应该将它们的声明放在标题中。

```
typedef struct { int value; } myStruct;
int dummy_function(myStruct* x){
   return (*x).value+1;
} 
```

相反，你应该写

```
#include "dummy.h"
int dummy_function(myStruct* x){
   return (*x).value+1;
} 
```

并创建以下头文件：

```
#ifndef _DUMMY_HEADER_H_
#define _DUMMY_HEADER_H_

typedef struct{ int value; } myStruct;
int dummy_function(myStruct* x);

#endif 
```

一个好的头文件本身应该是有效的（包括它需要的所有'#include'语句）。

所以，如果你的代码是“double myRandom()”函数的实现，你应该写这个头文件：

```
#ifndef _HEADER_NAME_
#define _HEADER_NAME_

double myRandom(void);  /* Can omit void in C++, but not in C */

#endif 
```

如果这不是您的问题，那么请指定更好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T19:30:12.790

我仍然不确定我是否理解您的问题（我对您的问题发表了评论），但答案可能是这样的：

```
#include <stdlib.h> /* required for rand() and srand() */ 
```

如果您想调用 rand() 和 srand() 函数，这就是答案，它们是 C 标准库的一部分。例如，请参阅[http://www.google.com/search?q=srand](http://www.google.com/search?q=srand)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T19:30:40.920

尝试查看[http://www.daniweb.com/forums/thread1769.html](http://www.daniweb.com/forums/thread1769.html)和卡巴斯基，看看它是否可以帮助您回答您的问题——或者至少问一个更具体的问题。

# c# - 从 ASP.NET 下拉菜单重定向

> ID：401184
> 
> 赞同：3
> 
> 时间：2008-12-30T19:19:49.787
> 
> 标签：c#, asp.net, javascript, drop-down-menu

处理您有一个用于链接到另一个 URL 的 ASP.Net 下拉列表的情况的最佳方法是什么

*为清楚起见进行了编辑*

这是基本场景：

绑定了 5 个城市的下拉列表

选择其中一个城市应将我发送到基于城市的 URL

现在我正在使用“OnSelectedIndexChanged”事件发回，然后处理该事件并重定向到相应的页面。

但是，这会导致每个选定城市对服务器进行 2 次点击，1 次用于处理回发和重定向，然后另一次用于呈现实际页面。

使用自定义 javascript 构建 URL 是我的最佳选择吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-30T19:47:27.017

您可以为选择更改事件添加客户端处理程序，然后根据所选值重定向到所需页面：

```
<asp:DropDownList ID="ddl" runat="server"
  onchange="document.location.href = this.value;" >
    <asp:ListItem Text="a" Value="http://url1"></asp:ListItem>
    <asp:ListItem Text="b" Value="http://url2"></asp:ListItem>
    <asp:ListItem Text="c" Value="http://url3"></asp:ListItem>
    <asp:ListItem Text="d" Value="http://url4"></asp:ListItem>
</asp:DropDownList> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T19:44:47.990

将 autopostback 设置为 false，并将其添加到 onchange 客户端事件（假设该值具有整个 URL，如果没有，则根据需要进行编辑）：

```
window.navigate(this.options[this.selectedIndex].value); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T20:16:08.953

[我只是想知道，为什么不通过 AJAX 获取城市信息（ www.asp.net/learn](http://www.asp.net/learn)上有几个视频教程）并向用户显示城市信息而不是创建其他更多页面跳转？

这只是一个想法，一个 Web 2.0 的想法 :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T20:23:51.497

如果页面很重并且您担心呈现时间，则可以使用 ajax 来呈现查询结果。服务器命中来处理发布数据和重定向应该是最小的，不值得在客户端这样做。就个人而言，我会更专注于第一次显示用户想要的数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T20:45:15.993

通常，我会同意，但是每个页面都需要有一个具体的 URL + 在点击 URL 时重新生成页面的其他部分。

不过感谢您的建议！

# asp.net - ASP.NET 错误：无法加载文件或程序集 App_Web_z9w33txs

> ID：401188
> 
> 赞同：4
> 
> 时间：2008-12-30T19:20:48.957
> 
> 标签：asp.net

您是如何摆脱这些烦人的 ASP.NET 错误的：无法加载文件或程序集 'App_Web_z9w33txs, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null'

这在我之前只发生过一次。似乎它与 ASP.NET 动态缓存某些程序集有关，但由于某种原因没有重新编译它。想法？你如何解决这个问题？是什么原因造成的？

**更多信息：** 这发生在通过 Ajax 从我的 Default.aspx 页面调用的 WCF 服务上。Default.aspx 页面加载正常。

**删除堆栈跟踪**

**最后更新：**
所以我现在每天至少发生 5 次这种情况。我必须关闭应用程序池。
进入 C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files 并删除此处的文件然后重新启动应用程序池。还有其他人遇到这样的事情吗？我是否应该分解并与 Microsoft 一起创建支持案例。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T19:47:20.557

关闭您的解决方案，关闭 IIS，转到：

`C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\`

并删除所有这些文件。然后重新启动 IIS 并再次尝试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T19:45:33.633

尝试关闭 Visual Studio，然后通过从命令提示符运行以下命令删除**Temporary ASP.NET Files文件夹中的所有文件夹：**

```
rd "%TEMP%\Temporary ASP.NET Files\." /s /q 
```

或从 PowerShell：

```
gci "$env:TEMP\Temporary ASP.NET Files" | % {ri $_.FullName -recurse} 
```

根据使用的框架，还要清除 Web 服务器上的以下文件夹：

```
%windir%\Microsoft.NET\v1.1.4322\Temporary ASP.NET Files\
%windir%\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\ 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T19:29:26.350

我有那个错误。我选择“清洁解决方案”，然后选择“重建解决方案”。一旦我的重建成功，错误就会消失。我不认为这只是 WCF 的事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T19:30:07.427

如果您在编译和/或发布更改您的应用程序后遇到此错误，请尝试编译选项“使用固定命名和单页程序集”。

有时，当我将更改上传到服务器并且应用程序尚未重新编译时，我会得到它。这些可能是临时文件，请尝试重新启动 IIS Admin 服务（如果可以）以查看它是否消失。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-12-14T15:47:22.580

有时我遇到这样的错误并开始研究如何解决它。只是删除 ASP.NET 临时目录对我没有任何影响。然后我刚刚将这样的属性添加到 web.config 编译节点：

```
<compilation debug="true" tempDirectory="c:\temp" > 
```

我希望这可以帮助和其他人。

# rest - 如何RESTful返回随机项目？

> ID：401191
> 
> 赞同：10
> 
> 时间：2008-12-30T19:21:19.440
> 
> 标签：rest, random

我的设计暴露了两种资源：

1.  图片
2.  标签

我希望客户能够通过他们的标签请求随机图像。例如：给我随机的带有“纽约”和“冬天”标签的图片。在这种情况下，RESTful 设计会是什么样子？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-31T14:11:11.470

总结评论中的所有讨论，而不是改变我最初的建议，这就是我最终想出的：

您想通过标签访问图像；每个标签都与一组图像相关。由于给定标签的使用量可能比另一个标签多得多（例如，纽约照片的使用量比芝加哥的多得多），您应该使用允许缓存的 RESTful 配置，这样您就可以缓存纽约的照片。恕我直言，解决方案是：

*   每个图像都有一个固定的 URI：

    ```
    http://www.example.com/images/12345 
    ```

*   每个标签也有一个 URI：

    ```
    http://www.example.com/tags/New_York/random 
    ```

    此 URI 充当集合中图像的随机调度器；它返回[303 See Other](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3.4)响应，重定向到集合的随机图像。[根据定义](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3.4)，这个 URI 不能被缓存，固定的应该被缓存，并且浏览器不应该理解到第二个资源的重定向是永久的，所以它是最优的。

*   您甚至可以通过以下方式访问整个集合：

    ```
    http://www.example.com/tags/New_York 
    ```

    此访问将导致[300 多项选择](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3.1)响应；它将整个集合（作为 URI，而不是图像！）返回给浏览器，浏览器决定如何处理它。

*   您还可以使用各种标签的交集：

    ```
    http://www.example.com/tags/New_York/Autumn/Manhattan/random
    http://www.example.com/tags/Autumn/Manhattan/New_York/random (equivalent to the previous one)
    http://www.example.com/tags/New_York/girls/Summer/random
    etc. 
    ```

因此，每个图像都有一个固定的 URI，每个标签及其相关照片集都有一个固定的 URI，每个标签具有的随机调度程序都有一个固定的 URI。您不需要使用任何 GET 参数作为其他潜在的解决方案，因此这是您可以获得的 RESTful。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T19:32:58.807

多维资源识别具有挑战性。

您的资源是图像，所以这就是您的 URI。此外，特定图像具有永远不会改变的特定 URI。

您的“按标签”是资源的非识别属性。为此，查询字符串可能会响起。

这是我的第一个想法。

*   `http://www.example.com/MyStuff/image/`*id*`/` -- id 的特定图像
*   `http://www.example.com/MyStuff/image/?tag=`*tagname* -- 带有给定标签的随机图像，隐含地，`count=1`.
*   `http://www.example.com/MyStuff/image/?tag=`*tagname*`&count=all` -- 所有带有给定标签的随机顺序的图像（`count=1`是默认的，它会给你一个任意的图像）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T19:35:21.347

我一直在努力解决这个问题。我们最终实现的是一个 HttpResponseRedirect，例如：

[http://www.example.com/randomNewYorkImage](http://www.example.com/randomNewYorkImage)

到随机的纽约图像：

[http://www.example.com/images/New_York/1234](http://www.example.com/images/New_York/1234)。

第一个资源可以被认为是一个随机的纽约图像调度程序。此解决方案将加载更多服务器，因为它将被请求两个资源，但它是尽可能 RESTful 的。

编辑：另外，如果您正在缓存，每个图像都将在缓存中，并且您的服务器从发送图像变为仅发送重定向，因为缓存将拦截第二个请求，从而减轻您的服务器负载。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T19:39:43.693

我会做类似的事情`http://foo.com/image/tagged/sometag/random`并停止为此失眠。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T19:51:17.600

我同意三联画的这一点。在某种程度上，将随机添加到 URI 的末尾会让人感觉像是一个操作，但如果它的作用域是一个标签，那么你实际上只是在优化上下文。

在他的例子中：

/image/tagged/sometag/随机

图片资源 -> 标记范围（所有带有标签的图片）-> 特定标签（所有带有标签 X 的图片）-> 随机（来自带有标签 X 的图片范围列表中的资源）

# c# - 为什么无参数的 Guid 构造函数会生成一个空的 GUID？

> ID：401198
> 
> 赞同：18
> 
> 时间：2008-12-30T19:23:41.963
> 
> 标签：c#, .net, guid, default-constructor

为什么无参数的 Guid 构造函数会生成一个空的 GUID，而不是像 Guid.NewGuid() 那样默认生成一个？

空的 Guid 有什么特殊用途吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-30T19:57:34.297

> 为什么无参数的 Guid 构造函数会生成一个空的 GUID，而不是像 Guid.NewGuid() 那样默认生成一个？

简短回答：因为语言/运行时没有让 Guid 类型的设计者定义默认构造函数。

“默认构造”结构的值为零不仅是惯例，而且您根本无法为结构定义默认构造函数。当您说 new Guid() 时，运行时会为您提供一个新对象，其中所有字段都初始化为其默认值：http: [//msdn.microsoft.com/en-us/library/ah19swz4%28VS.71%29.aspx](http://msdn.microsoft.com/en-us/library/ah19swz4%28VS.71%29.aspx)

一些基本原理可以在这里找到：https://web.archive.org/web/20131102220804/http: [//www.yoda.arachsys.com/csharp/faq/#struct.constructors](https://web.archive.org/web/20131102220804/http://www.yoda.arachsys.com/csharp/faq/#struct.constructors)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T20:43:32.893

此行为与 .Net 框架中的其余值类型一致。当“更新”一个值类型时，使用一个默认值。这恰好是 Guid 的默认值，类似于 Int32 的默认值 0。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T19:28:11.407

空的 guid 可用于表示缺少 Guid。由于值类型不可为空（默认情况下是的，您可以使用可为空的）。

例如，我经常使用 Guid 作为 Id 属性，因为它们非常易于使用。因此，一种查看对象是否已被持久化的方法（即当它获取其 Id 时），我可以根据空 guid 检查 id 的值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T19:32:25.970

我认为传统的结构或内置类型的默认值为零。

# nhibernate - 如何通过多对多将 NHibernate 从表 A 映射到表 A 本身？

> ID：401207
> 
> 赞同：3
> 
> 时间：2008-12-30T19:27:04.903
> 
> 标签：nhibernate, nhibernate-mapping

请帮忙！我无法弄清楚如何映射以下情况：

我只有一张桌子。

> [表] 用户 { id, name }

我的课看起来像这样

```
public class User
{
  public int Id { get; set; }
  public string Name { get; set; }

  public ISet<User> Friends { get; set; }
} 
```

每个用户都与其他用户有关系。例如，“用户 A”可以有很多朋友，这些朋友是其他用户。

这应该是什么映射？我认为这应该是多对多的关系，但我真的不知道 HBM 会是什么样子？

谢谢，

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-31T10:07:26.030

> 我认为这应该是多对多的关系

你是对的。在您的场景中，您将需要使用自引用多对多映射。但是使用单个*用户*表不能表示*用户*和*朋友*之间的关系（使用单个表可以表示自引用[的父子](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html_single/#example-parentchild)关系）。您将需要一个中间表来实现这一点。下面是一个使用[SQLite](http://www.sqlite.org/) ADO.NET[提供程序](http://sqlite.phxsoftware.com/)的示例，展示了一种可能的场景建模方式：

用户.hbm.xml：

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
    namespace="Test" assembly="test">

    <class name="User" table="Users">
        <id name="Id" column="id">
            <generator class="native"/>
        </id>
        <property name="Name" column="name"/>
        <set name="Friends" table="Friends">
            <key column="user_id"/>
            <many-to-many class="User" column="friend_id"/>
        </set>
    </class>

</hibernate-mapping> 
```

从上面的映射中，您会注意到以下表格的使用：用户和朋友

这是代码：

```
using System;
using System.IO;
using System.Collections.Generic;
using System.Data.SQLite;
using NHibernate;
using NHibernate.Cfg;
using Iesi.Collections.Generic;

namespace Test
{
    class Program
    {
        public static void Main() 
        {
            if (File.Exists("nhibernate.db"))
            {
                File.Delete("nhibernate.db");
            }
            ExecuteCommand("create table Users (id integer, name string)");
            ExecuteCommand("create table Friends (user_id integer, friend_id string)");

            ExecuteCommand("insert into Users (id, name) values (1, 'user1')");
            ExecuteCommand("insert into Users (id, name) values (2, 'user2')");
            ExecuteCommand("insert into Users (id, name) values (3, 'user3')");

            // User1 is friend with User2    
            ExecuteCommand("insert into Friends (user_id, friend_id) values (1, 2)");
            // User1 is friend with User3    
            ExecuteCommand("insert into Friends (user_id, friend_id) values (1, 3)");
            // User2 is friend with User1    
            ExecuteCommand("insert into Friends (user_id, friend_id) values (2, 1)");
            // User3 is friend with User1    
            ExecuteCommand("insert into Friends (user_id, friend_id) values (3, 1)");

            ISessionFactory sessionFactory =
                new Configuration().Configure().BuildSessionFactory();
            ISession session = sessionFactory.OpenSession();
            User user = session.Get<User>(1);
            Console.WriteLine(user.Friends.Count);

            session.Close();
            sessionFactory.Close();
        }

        private static void ExecuteCommand(string sql)
        {
            using (SQLiteConnection connection = new SQLiteConnection("Data Source=nhibernate.db;Version=3"))
            using (SQLiteCommand command = new SQLiteCommand(sql, connection))
            {
                connection.Open();
                command.ExecuteNonQuery();
            }
        }
    }

    class User 
    {
        public virtual int Id { get; set; }
        public virtual string Name { get; set; }
        public virtual ISet<User> Friends { get; set; }
    }
} 
```

最后为了完整起见，这是我的配置文件：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <section
            name="hibernate-configuration"
            type="NHibernate.Cfg.ConfigurationSectionHandler, NHibernate"
        />
    </configSections>

    <hibernate-configuration xmlns="urn:nhibernate-configuration-2.2">
        <session-factory>
            <property name="connection.provider">NHibernate.Connection.DriverConnectionProvider</property>
            <property name="connection.driver_class">NHibernate.Driver.SQLite20Driver</property>
            <property name="dialect">NHibernate.Dialect.SQLiteDialect</property>
            <property name="connection.connection_string">Data Source=nhibernate.db;Version=3</property>

            <mapping assembly="test" />
        </session-factory>
    </hibernate-configuration>
</configuration> 
```

# c++ - 带有换行符的 Vista 凭据提供程序

> ID：401213
> 
> 赞同：5
> 
> 时间：2008-12-30T19:30:01.793
> 
> 标签：c++, windows-vista

我正在尝试构建一个 Vista 凭据提供程序。我有一个类型为 CPFT_SMALL_TEXT 的字段。我想在这个字段中添加一个多行字符串，但它一直在中途被截断，并在中断处附加一个省略号。我怎样才能避免这种情况并让我的多行字符串显示出来？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-01T18:34:53.317

您是否考虑过简单地创建多个字段并为每个字段提供一行？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T07:45:31.633

每当换行符应该出现时，文本是否会中断？它总是以相同的长度断裂吗？

# python - 如何在 Python 中限制对 Web 服务的请求率？

> ID：401215
> 
> 赞同：14
> 
> 时间：2008-12-30T19:30:11.420
> 
> 标签：python, web-services, rate-limiting

我正在开发一个与 Web 服务 API 接口的 Python 库。像我遇到的许多 Web 服务一样，这一项请求限制了请求的速率。我想为`limit`类实例化提供一个可选参数，如果提供，它将保持传出请求，直到指定的秒数过去。

我了解一般情况如下：该类的实例通过方法发出请求。当它发生时，该方法会发出一些信号，在某处设置一个锁定变量，并开始一个倒计时计时器，以计算`limit`. （很可能，锁是倒数计时器本身。）如果在此时间范围内发出另一个请求，则必须排队，直到倒数计时器达到零并且锁被解除；此时，发送队列中最旧的请求，并重置倒数计时器并重新锁定。

这是线程的情况吗？还有另一种我没有看到的方法吗？

倒数计时器和锁应该是实例变量，还是应该属于类，以便类的所有实例都持有请求？

此外，在库中提供速率限制功能通常是一个坏主意吗？我的理由是，默认情况下，倒计时为零秒，该库仍然允许开发人员使用该库并提供他们自己的速率限制方案。但是，鉴于任何使用该服务的开发人员都需要对请求进行速率限制，但我认为库提供一种速率限制方法会很方便。

无论是否在库中放置速率限制方案，我都想使用该库编写一个应用程序，因此建议的技术将派上用场。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2018-05-21T02:49:04.670

除非需要，否则不要重新发明轮子。检查真棒图书馆[ratelimit](https://pypi.org/project/ratelimit/)。如果您只是想出于任何原因限制对休息 api 的调用并继续您的生活，那就完美了。

```
from datetime import timedelta
from ratelimit import limits, sleep_and_retry
import requests

@sleep_and_retry
@limits(calls=1, period=timedelta(seconds=60).total_seconds())
def get_foobar():
    response = requests.get('https://httpbin.org/get')
    response.raise_for_status()
    return response.json() 
```

如果发出的请求多于每分钟一个，这将*阻塞线程。*

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-30T20:00:33.837

这与队列和调度程序一起工作得更好。

您将处理分为两个方面：**source**和**dispatch**。这些可以是单独的线程（或者如果更容易的话，可以是单独的进程）。

**源**端以任何让他们满意的速度创建和排队请求。

**Dispatch**端执行此操作。

1.  获取请求开始时间，*s*。

2.  将请求出列，通过远程服务处理请求。

3.  获取当前时间*t*。睡眠*速率*- ( *t* - *s* ) 秒。

如果你想运行**Source**端直接连接到远程服务，你可以这样做，并绕过速率限制。这对于使用远程服务的模拟版本进行内部测试很有用。

这方面的困难部分是为您可以排队的每个请求创建一些表示。由于 Python [Queue](https://docs.python.org/2/library/queue.html)几乎可以处理任何事情，因此您不必做太多事情。

如果您使用多处理，则必须[腌制](https://docs.python.org/2/library/pickle.html)您的对象以将它们放入管道中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T20:23:16.913

排队可能过于复杂。一个更简单的解决方案是为您的类提供最后一次调用服务的时间变量。每当调用服务 (!1) 时，将 waitTime 设置为`delay - Now + lastcalltime`。 `delay`应该等于请求之间的最小允许时间。如果这个数字是正数，请在拨打电话之前睡很长时间（！2）。这种方法的缺点/优点在于它将 Web 服务请求视为同步的。优点是它非常简单且易于实现。

*   (!1)：应该在收到服务的响应后立即在包装器内（可能在包装器的底部）发生。
*   (!2)：应该在 web 服务周围的 python 包装器被调用时发生，在包装器的顶部。

S.Lott 的解决方案当然更优雅。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T20:05:47.103

您的速率限制方案应该受到底层代码（同步或异步）的调用约定以及该速率限制将在什么范围（线程、进程、机器、集群？）上运行的严重影响。

我建议将所有变量保留在实例中，以便您可以轻松实现多个周期/控制速率。

最后，听起来你想成为一个中间件组件。不要试图成为一个应用程序并自行引入线程。如果您是同步的，则只需阻塞/睡眠，如果您被其中之一调用，则使用异步调度框架。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T20:43:37.917

如果您的库被设计为同步的，那么我建议您忽略限制执行（尽管您可以跟踪费率并至少帮助调用者决定如何遵守限制）。

我现在使用[twisted](http://twistedmatrix.com/)来连接几乎所有的东西。通过拥有一个将请求提交与响应处理分开的模型，它可以很容易地完成这种类型的事情。如果您不希望您的 API 用户必须使用 twisted，那么您至少最好了解他们的 API 以延迟执行。

例如，我有一个 twitter 界面，它代表[xmpp users](http://dustin.github.com/twitterspy/)推送相当数量的请求。我没有速率限制，但我确实需要做一些工作来防止所有请求同时发生。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T23:25:39.120

所以我假设像 import time time.sleep(2) 这样简单的东西不会在请求之间等待 2 秒

# c# - 并非所有需要的修订都指定了 sharpsvn

> ID：401217
> 
> 赞同：1
> 
> 时间：2008-12-30T19:30:15.693
> 
> 标签：c#, svn, sharpsvn

我正在尝试使用 SharpSVN 进行合并。经过一番研究，我了解到 SharpSVN 支持 MergDiff 函数，但是当我尝试下面列出的代码时，我收到一条错误消息，指出未指定所有必需的修订。

谢谢

```
try
{
    SvnCheckOutArgs argsSVNCheckout = new SvnCheckOutArgs();
    SvnUpdateResult result;
    SvnTarget _rootSVNTarget = null;   // = new SvnTarget();
    string serverUrl = "http://svn.snaffpaw.com:8080/CPM Creator/";

    // The Subversion target to run log against
    SvnTarget target = null;

    // Attempt to create an SvnTarget by parsing the targetPath
    if (string.IsNullOrEmpty(targetPath) ||
        !SvnTarget.TryParse(targetPath, out target))

    if (string.IsNullOrEmpty(serverUrl) || (!SvnTarget.TryParse(serverUrl,out _rootSVNTarget))) 

    //SvnStatusArgs argSVN = new SvnStatusArgs();
    //argSVN.RetrieveRemoteStatus = true;

    //Collection<SvnStatusEventArgs> infos;
    //bool isChecked = client.GetStatus(targetPath, argSVN, out infos);

    // Attempt to create an SvnTarget by parsing the targetPath
    if (string.IsNullOrEmpty(targetPath) ||
        !SvnTarget.TryParse(targetPath, out target))

        if (string.IsNullOrEmpty(serverUrl) || !SvnTarget.TryParse(serverUrl, out _rootSVNTarget))

    client.Authentication.DefaultCredentials = new NetworkCredential("guest", "guestpwd");

    client.DiffMerge(targetPath, _rootSVNTarget, target); //<<<-- errors here
}
// ... 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T12:10:52.723

如 SharpSvn 用户列表中所述，以下示例将解决缺少的修订：

```
using (SvnClient client = new SvnClient())
{
 client.DiffMerge(
     "CHANGES",  // Target to merge to
     new SvnUriTarget(new Uri("http://svn.collab.net/repos/svn/tags/1.5.0/CHANGES")), SvnRevision.Head),
     new SvnUriTarget(new Uri("http://svn.collab.net/repos/svn/tags/1.5.5/CHANGES"), SvnRevision.Head));
 } 
```

错误在于传递的 Uris 没有默认为 HEAD 修订版，而是必须明确使用 head 修订版。

[这已在http://sharpsvn.net/daily/](http://sharpsvn.net/daily/)上提供的当前每日构建中得到修复

# checksum - 从数据中确定 CRC 算法 + CRC - 嵌入式应用程序。

> ID：401231
> 
> 赞同：5
> 
> 时间：2008-12-30T19:33:11.973
> 
> 标签：checksum, crc

我有一组受 16 位校验和保护的数据，我需要更正这些数据。校验和位置是已知的，计算它们的确切区域以及用于计算它们的确切算法是未知的。16 位，LSB 在前。我怀疑它是某种 16 位 CRC，但我无法找到实际计算校验和的代码。

例子：

```
00    4E00FFFF26EC14091E00A01830393630  
10    30313131313030393030363030313030  
20    30303131313030393030363030313030  
30    30303131313030393030363030313030  
40    3030FFFF225E363436304D313037**0CE0**  
50    64000000000000008080808080800000  
60    00000000**BE6E**FC01E001EB0013010500 
```

校验和存储在 4E 和 64 处。我不知道它们是从每个数据段开头的第一个字的偏移量开始计算的，还是之后开始计算的，还是从整个范围开始计算的。我尝试了许多常见的 CRC 算法和多项式，但都没有成功。此应用程序没有可用的参考资料或规范。

为了比较，这里是另一个具有不同 CRC 的数据部分。

```
00    4E00FFFF26C014091600A01030393132  
10    30313131313030393030313230313030  
20    30303131313030393030313230313030  
30    30303131313030393030313230313030  
40    3030FFFF225E343231324F313044**8348**  
50    64000000000000008080808080800000  
60    00000000**72F8**E001EB00130105000E01 
```

我的问题是，任何人都可以识别算法吗？有什么方法可以从数据和 CRC 计算 CRC 多项式和其他因素？

谢谢！

编辑：

在我的反汇编中搜索常见的 CRC16 多项式 0xA001 发现了这个函数：

```
34F86 ; =============== S U B R O U T I N E =======================================
34F86
34F86
34F86 Possible_Checksum:                    ; CODE XREF: MEM_EXT_4:00034FEEP
34F86                                         ; MEM_EXT_4:0003503AP ...
34F86                 mov     [-r0], r9       ; Move Word
34F88                 mov     r4, r12         ; Move Word
34F8A                 mov     r5, r13         ; Move Word
34F8C                 shr     r4, #14         ; Shift Right
34F8E                 shl     r5, #2          ; Shift Left
34F90                 or      r5, r4          ; Logical OR
34F92                 mov     r4, r12         ; Move Word
34F94                 mov     DPP0, r5        ; Move Word
34F98                 and     r4, #3FFFh      ; Logical AND
34F9C                 movb    rl3, [r4]       ; Move Byte
34F9E                 mov     DPP0, #4        ; Move Word
34FA2                 movbz   r9, rl3         ; Move Byte Zero Extend
34FA4                 mov     r15, #0         ; Move Word
34FA6
34FA6 loc_34FA6:                              ; CODE XREF: MEM_EXT_4:00034FC8j
34FA6                 mov     r4, [r14]       ; Move Word
34FA8                 xor     r4, r9          ; Logical Exclusive OR
34FAA                 and     r4, #1          ; Logical AND
34FAC                 jmpr    cc_Z, loc_34FBA ; Relative Conditional Jump
34FAE                 mov     r4, [r14]       ; Move Word
34FB0                 shr     r4, #1          ; Shift Right
34FB2                 xor     r4, #0A001h     ; Logical Exclusive OR
34FB6                 mov     [r14], r4       ; Move Word
34FB8                 jmpr    cc_UC, loc_34FC0 ; Relative Conditional Jump
34FBA ; ---------------------------------------------------------------------------
34FBA
34FBA loc_34FBA:                              ; CODE XREF: MEM_EXT_4:00034FACj
34FBA                 mov     r4, [r14]       ; Move Word
34FBC                 shr     r4, #1          ; Shift Right
34FBE                 mov     [r14], r4       ; Move Word
34FC0
34FC0 loc_34FC0: 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T21:46:03.860

您从 loc_34FA6 向下发布的代码基本上如下：

```
unsigned short
crc16_update(unsigned short crc, unsigned char nextByte)
{
    crc ^= nextByte;

    for (int i = 0; i < 8; ++i) {
        if (crc & 1)
            crc = (crc >> 1) ^ 0xA001;
        else
            crc = (crc >> 1);
    }

    return crc;
} 
```

这是一个具有 0xA001 多项式的 CRC-16。一旦找出适用 CRC-16 的数据范围，将 CRC 初始化为 0xFFFF 并为序列中的每个字节调用此函数。存储返回值并在下次通过时将其传回。最后返回的值是您的最终 CRC。

我不知道序言在做什么......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-07T19:23:22.137

更一般地说，CRC 的部分概念是，当您计算某个数据文件的 CRC，然后在最后附加 CRC 时，您会得到一个文件，其 CRC 是取决于文件长度的某个值，但是不是它的内容。（对于某些 CRC 算法，它甚至不依赖于文件长度。）

因此，如果您怀疑您尝试逆向工程的应用程序正在使用 CRC16，并且您有一个计算 CRC16 的程序，并且您有多个相同长度的样本，只需计算这些数据文件的 CRC16（其中包括校验和）。如果每次都返回相同的校验和数据（对于相同长度的文件），那么它们必须包含使用相同宽度和多项式的 CRC 校验和。

例如，我曾经不得不对一些文件进行逆向工程，开发人员认为他很聪明，通过更改两个常量来更改 CRC32 算法。我不必找到验证校验和的目标代码，将其反汇编，然后费力地弄清楚。这个简单的测试成功了。

# c# - 静态索引器？

> ID：401232
> 
> 赞同：132
> 
> 时间：2008-12-30T19:33:16.967
> 
> 标签：c#, .net, static, indexer, static-indexers

为什么在 C# 中不允许使用静态索引器？我认为没有理由不应该允许它们，而且它们可能非常有用。

例如：

```
public static class ConfigurationManager 
{
        public object this[string name]
        {
            get => ConfigurationManager.getProperty(name);
            set => ConfigurationManager.editProperty(name, value);
        }

        /// <summary>
        /// This will write the value to the property. Will overwrite if the property is already there
        /// </summary>
        /// <param name="name">Name of the property</param>
        /// <param name="value">Value to be wrote (calls ToString)</param>
        public static void editProperty(string name, object value) 
        {
            var ds = new DataSet();
            var configFile = new FileStream("./config.xml", FileMode.OpenOrCreate);
            ds.ReadXml(configFile);

            if (ds.Tables["config"] == null)
                ds.Tables.Add("config");

            var config = ds.Tables["config"];

            if (config.Rows[0] == null) 
                config.Rows.Add(config.NewRow());

            if (config.Columns[name] == null) 
                config.Columns.Add(name);

            config.Rows[0][name] = value.ToString();

            ds.WriteXml(configFile);
            configFile.Close();
        }

        public static void addProperty(string name, object value) =>
            ConfigurationManager.editProperty(name, value);

        public static object getProperty(string name) 
        {
            var ds = new DataSet();
            var configFile = new FileStream("./config.xml", FileMode.OpenOrCreate);
            ds.ReadXml(configFile);
            configFile.Close();

            if (ds.Tables["config"] == null) return null;

            var config = ds.Tables["config"];

            if (config.Rows[0] == null) return null;
            if (config.Columns[name] == null) return null;

            return config.Rows[0][name];
        }
    } 
```

上面的代码将从静态索引器中受益匪浅。但是它不会编译，因为不允许使用静态索引器。为什么会这样？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2008-12-30T20:20:59.617

我相信它被认为不是非常有用。我认为这也是一种耻辱——我倾向于使用的一个例子是编码，`Encoding.GetEncoding("foo")`可能是`Encoding["Foo"]`. 我不认为它会*经常*出现，但除此之外，它只是感觉有点不一致，不可用。

我必须检查一下，但我*怀疑*它已经在 IL（中间语言）中可用。

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2008-12-30T19:47:48.653

索引器表示法需要引用`this`. 由于静态方法没有对类的任何特定实例的引用，因此您不能`this`与它们一起使用，因此您不能在静态方法上使用索引器表示法。

您的问题的解决方案是使用单例模式，如下所示：

```
public class Utilities
{
    private static ConfigurationManager _configurationManager = new ConfigurationManager();
    public static ConfigurationManager ConfigurationManager => _configurationManager;
}

public class ConfigurationManager
{
    public object this[string value]
    {
        get => new object();
        set => // set something
    }
} 
```

现在您可以`Utilities.ConfigurationManager["someKey"]`使用索引器表示法进行调用。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-30T19:42:16.933

作为一种解决方法，您可以在单例/静态对象上定义实例索引器（假设 ConfigurationManager 是单例，而不是静态类）：

```
class ConfigurationManager
{
  //private constructor
  ConfigurationManager() {}
  //singleton instance
  public static ConfigurationManager singleton;
  //indexer
  object this[string name] { ... etc ... }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-03-05T15:12:47.967

我也需要（好吧，更像是拥有）一个静态索引器来存储属性，所以我想出了一个有点尴尬的解决方法：

在您想要拥有静态索引器的类中（此处为：Element），创建一个同名的子类 +“Dict”。给它一个只读静态作为所述子类的实例，然后添加您想要的索引器。

最后，将类添加为静态导入（因此子类只公开静态字段）。

```
import static Element.ElementDict;

public class Element {
    // .... 
    private static readonly Dictionary<string, object> elemDict = new Dictionary<string, object>();
    public class ElementDict {
        public readonly static ElementDict element = new ElementDict();
        public object this[string key] {
            get => elemDict.TryGetValue(key, out object o) ? o : null;
            set => elemDict[key] = value;
        }
    }
} 
```

然后您可以将其大写为 Type 或不用作字典：

```
var cnt = element["counter"] as int;
element["counter"] = cnt; 
```

但是，唉，如果要实际使用对象作为“值”-Type，那么下面的内容会更短（至少作为声明），并且还提供即时类型转换：

```
public static T load<T>(string key) => elemDict.TryGetValue(key, out object o) ? (T) o : default(T);
public static void store<T>(string key, T value) => elemDict[key] = value;

var cnt = Element.load<int>("counter");
Element.store("counter", cnt); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-08-28T05:06:51.920

使用 C# 6 中较新的构造，您可以使用属性表达式主体简化单例模式。例如，我使用了以下与 code-lense 配合得很好的快捷方式：

```
public static class Config
{
   public static NameValueCollection Get => ConfigurationManager.AppSettings;
} 
```

它还有一个额外的好处，即可以查找替换以升级旧代码并统一您的应用程序设置访问。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2013-10-27T07:22:58.483

this 关键字引用类的当前实例。静态成员函数没有 this 指针。this 关键字可用于从构造函数、实例方法和实例访问器中访问成员。（从[msdn](http://msdn.microsoft.com/en-us/library/dk1507sz%28v=vs.71%29.ASPX)检索）。由于 this 引用了类的实例，因此它与 static 的性质相冲突，因为 static 与类的实例无关。

一种解决方法如下，它允许您对私有字典使用索引器，因此您只需要创建一个新实例并访问静态部分。

```
 public class ConfigurationManager 
{
    public ConfigurationManager()
    {
        // TODO: Complete member initialization
    }
    public object this[string keyName]
    {
        get
        {
                return ConfigurationManagerItems[keyName];
        }
        set
        {
                ConfigurationManagerItems[keyName] = value;
        }
    }
    private static Dictionary<string, object> ConfigurationManagerItems = new Dictionary<string, object>();        
} 
```

这允许您跳过整个访问类成员的过程，只需创建它的一个实例并为其编制索引。

```
 new ConfigurationManager()["ItemName"] 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2018-01-31T14:40:26.943

原因是很难理解您使用静态索引器索引的确切内容。

您说代码会从静态索引器中受益，但真的会这样吗？它所要做的就是改变这一点：

```
ConfigurationManager.editProperty(name, value);
...
value = ConfigurationManager.getProperty(name) 
```

进入这个：

```
ConfigurationManager[name] = value
...
value = ConfigurationManager[name] 
```

这不会以任何方式使代码变得更好；它并不比许多代码行更小，由于自动完成，编写起来并不容易，而且不太清楚，因为它隐藏了你正在获取和设置你称之为“属性”的东西的事实，它实际上迫使读者阅读有关索引器返回或设置的确切内容的文档，因为它绝对不是您要为其编制索引的属性，而两者都有：

```
ConfigurationManager.editProperty(name, value);
...
value = ConfigurationManager.getProperty(name) 
```

您可以大声朗读并立即了解代码的作用。

请记住，我们要编写易于（= 快速）理解的代码，而不是编写快速的代码。不要将编写代码的速度与完成项目的速度混淆。

# video - 将视频导出为动画 gif？

> ID：401233
> 
> 赞同：0
> 
> 时间：2008-12-30T19:34:23.080
> 
> 标签：video, converter, animated-gif

是否有任何推荐的程序可以根据视频输入输出动画 gif？最好是mac，但windows也很好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T19:39:38.000

你看过[MPlayer](http://www.mplayerhq.hu/design7/news.html)吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T19:40:30.133

我想说我见过其他人，但 SUPER 编码器会。界面有点笨拙，但它是一个方便的工具，可以将各种视频从一种格式转换为另一种格式。

[http://www.rightsoft.com/SUPER.html](http://www.erightsoft.com/SUPER.html)

祝你好运找到下载链接......我发誓每次我尝试升级时都会更轻松地寻找鸡蛋。:(

# svn - 如何使用 CruiseControl.net 根据 Subversion 修订号设置内部版本号

> ID：401234
> 
> 赞同：5
> 
> 时间：2008-12-30T19:34:27.150
> 
> 标签：svn, msbuild, cruisecontrol.net

> **可能重复：**
> [使用 SVN Revision 标记 CCNET 中的构建](https://stackoverflow.com/questions/1160/use-svn-revision-to-label-build-in-ccnet)

我正在完成安装 CruiseControl.net 并转换 Msbuild 脚本以使用它的过程。我希望我们的内部版本号能够反映 Subversion 的修订号。看起来 LastChangeLabeller 应该可以工作，但我得到的只是“未知”。

我的最终目标是使用内部版本号（以 1 递增）和颠覆版本来格式化内部版本号。但现在我会满足于修订号。

**澄清：**我正在尝试更新 CruiseControl.Net 内部版本号。不仅仅是编译结果中的版本号。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-01T16:53:59.003

我发现了一个重复的问题。[使用 svn revision 来标记 ccnet 中的 build](https://stackoverflow.com/questions/1160/use-svn-revision-to-label-build-in-ccnet)。这使我可以在 Google Code 上[找到 svnRevisionLabeller](http://code.google.com/p/svnrevisionlabeller/)

This seems to be the best solution for me. I modified the code slightly because I wanted the subversion revision number to be last number in the version number. major.minor.build.revision. This labeller by default does major.minor.revision.build.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T19:40:36.203

MSBuild 社区任务项目有一个颠覆任务，它将帮助您完成这项工作。

任务： http: [//msbuildtasks.tigris.org/servlets/ProjectDocumentList](http://msbuildtasks.tigris.org/servlets/ProjectDocumentList)

描述组件的文章： [http ://weblogs.asp.net/pwelter34/archive/2006/03/31/441613.aspx](http://weblogs.asp.net/pwelter34/archive/2006/03/31/441613.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T19:41:28.540

SVN FAQ 有一个如何使用 GNU 完成此操作的[示例](http://subversion.tigris.org/faq.html#version-value-in-source)`make`。我相信它可以很容易地适应。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-31T15:37:14.650

如果您想更改 CC.Net 中的内部版本号，我相信您想使用[贴标器块](http://confluence.public.thoughtworks.org/display/CCNET/Labeller+Blocks)- 可能是 Last Change 贴标器，尽管我自己没有使用过。

# macos - 使用 Cocoa 在辅助显示器上全屏显示 macOS 窗口

> ID：401240
> 
> 赞同：12
> 
> 时间：2008-12-30T19:36:44.510
> 
> 标签：macos, cocoa, fullscreen

我正在开发一个 Cocoa Mac 应用程序，我需要在辅助监视器上全屏显示窗口/视图。

我知道如何创建一个可以拖到辅助监视器上的窗口，但我想以编程方式创建窗口并使其在外部监视器上全屏显示。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-30T20:29:31.877

首先，通过迭代来确定要使用的屏幕`[NSScreen screens]`。

创建一个全屏窗口：

```
NSScreen *screen = /* from [NSScreen screens] */
NSRect screenRect = [screen frame];
NSWindow *window = [[NSWindow alloc] initWithContentRect:screenRect
    styleMask:NSBorderlessWindowMask
    backing:NSBackingStoreBuffered
    defer:NO
    screen:screen];
[window setLevel: CGShieldingWindowLevel()]; 
```

你可能也想谷歌`CGDisplayCapture()`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T20:36:59.320

您可以调用 的`enterFullScreenMode:withOptions:`方法`NSView`来实现所需的行为。

请参阅[Apple 的文档](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/instm/NSView/enterFullScreenMode:withOptions:)。

阅读[此处](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/doc/constant_group/Full_screen_mode)和[此处](http://developer.apple.com/DOCUMENTATION/GraphicsImaging/Reference/Quartz_Services_Ref/Reference/reference.html#//apple_ref/doc/constant_group/Display_Mode_Standard_Properties)了解可提供给此方法的选项。

您可以使用`[NSScreen screens]`获取可用屏幕的列表。有关详细信息，请参见[此处](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/ApplicationKit/Classes/NSScreen_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSScreen)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-01-22T09:56:00.813

全屏窗口动画断断续续，在我看来并不好看。全屏视图更加流畅。

试试这个：

```
- (void)toggleMyViewFullScreen:(id)sender
{
    if (myView.inFullScreenMode) {
      [myView exitFullScreenModeWithOptions:nil];
    } else {
      NSApplicationPresentationOptions options =
          NSApplicationPresentationHideDock |       
          NSApplicationPresentationHideMenuBar;

      [myView enterFullScreenMode:[NSScreen mainScreen] withOptions:@{
             NSFullScreenModeApplicationPresentationOptions : @(options) }];
                                                                                 }];
    }
} 
```

您可以将其连接到 Window 菜单中的全屏菜单项（在将其插入 nib 之后），但请务必将菜单项触发的操作更改为您的 toggleMyViewFullScreen: 。或者您可以通过编程方式或在您的应用加载时调用 toggleMyViewFullScreen。

# ruby-on-rails - 向现有控制器添加操作（Ruby on Rails）

> ID：401241
> 
> 赞同：36
> 
> 时间：2008-12-30T19:37:02.217
> 
> 标签：ruby-on-rails, ruby, rails-routing

我是 Ruby on Rails 的新手，我已经完成了[博客教程](http://guides.rubyonrails.org/getting_started_with_rails.html)。

我现在正在尝试向控制器添加一个额外的操作，称为“开始”。

```
def start
end 
```

我添加了一个视图页面“app/views/posts/start.html.erb”，只包含简单的 html。

当我转到 /posts/start 时，出现以下错误。

```
ActiveRecord::RecordNotFound in PostsController#show 
Couldn't find Post with ID=start 
```

我了解错误，正在执行 show 操作，并且 start 不是有效的 ID。为什么不执行启动操作，是否缺少 MVC 架构或配置的某些部分？

下面是我的posts_controller.rb

```
class PostsController < ApplicationController

  # GET /posts/start
  def start
  end

  # GET /posts
  # GET /posts.xml
  def index
    @posts = Post.find(:all)
    respond_to do |format|
      format.html # index.html.erb
      format.xml  { render :xml => @posts }
    end
  end

  # GET /posts/1
  # GET /posts/1.xml
  def show
    @post = Post.find(params[:id])
    respond_to do |format|
      format.html # show.html.erb
      format.xml  { render :xml => @post }
    end
  end

end 
```

是的，我已经重新启动了服务器并使用 Mongrel 和 webrick 进行了尝试。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-12-30T20:08:06.770

The error you're making is actually a pretty common one.

Basically, Rails automatically maps URLs for your scaffolds. So when you created the Posts scaffolds, Rails is mapping the URL routes for it. One such route is the URL for viewing a single post: /posts/(post_id)

So, when you're entering the URL /posts/start Rails thinks you're saying "Hey, give me the post with ID = start. So Rails complains that the show method can't find a post with such ID.

One quick way to fix this is to make sure your config/routes.rb has the route for the start action before the scaffolding routes:

```
# Route for start action
map.connect '/posts/start', :controller => 'posts', :action => 'start'
# Default mapping of routes for the scaffold
map.resources :posts 
```

Anyway, hope that helps.

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2011-09-28T14:00:43.867

On Rails 4.x use:

```
get '/posts/start', :controller => 'posts', :action => 'start' 
```

On Rails 3.x use:

```
match '/posts/start', :controller => 'posts', :action => 'start' 
```

instead of

```
map.connect '/posts/start', :controller => 'posts', :action => 'start' 
```

it solved my issue.

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-12-30T20:06:27.273

Your routing isn't set up to allow that route. Assuming you're using the default scaffolding, put this line *before* the `map.resources :posts` line in config/routes.rb:

```
map.connect "posts/:action", :controller => 'posts', :action => /[a-z]+/i 
```

The regex for `:action` restricts it to just a-z (to avoid catching things like /posts/1). It can be improved if you need underscores or numbers in your new actions.

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-12-29T07:21:40.033

Try this if you are using rails 3.0.3

in your route.rb

```
 resource :posts do
   collection do
     get 'start'
   end
 end 
```

this might help

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-08-09T22:27:13.320

I want to say, sometimes Rails gets sticky with routes-caching, even in the **development** environment.

It may help to **restart your Rails server**. This has worked for me more times than I can count when receiving this error.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-16T10:15:14.840

This works:

```
map.resource :post, :collection => { :my_action => :get} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-22T03:09:55.257

I found the solution to my problem, in the routes.rb file where

```
map.resource :post 
```

I added with collection argument, so it stayed this way:

```
map.resource :post, :collection => { :my_action => :get} 
```

# javascript - COM 对象在 Vista 下创建“打开文件”对话框？

> ID：401257
> 
> 赞同：2
> 
> 时间：2008-12-30T19:42:25.327
> 
> 标签：javascript, windows, com, windows-vista

我想使用 Windows 通用对话框“打开文件”，在 JScript 下从用户那里获取文件。这曾经可以在 MSCOMDLG.commondialog 对象上使用“ShowOpen()”，但是我找不到在 Vista 下工作的等效方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T13:38:03.767

**尝试这个：**

[http://www.tech-archive.net/Archive/Scripting/microsoft.public.scripting.vbscript/2007-10/msg00444.html](http://www.tech-archive.net/Archive/Scripting/microsoft.public.scripting.vbscript/2007-10/msg00444.html)

有帮助吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-24T01:39:44.993

您可能可以通过使用 CreateObject("Shell.Application").BrowseForFolder( ... ) 来伪造它并使用[BIF_BROWSEINCLUDEFILES](http://msdn.microsoft.com/en-us/library/bb773205(VS.85).aspx)标志

# testing - QuickTest Pro 自动化测试

> ID：401262
> 
> 赞同：4
> 
> 时间：2008-12-30T19:44:29.317
> 
> 标签：testing, qtp

我有三个简单的问题。

有人使用 QuickTest Pro 进行自动化测试吗？

您推荐的任何其他自动化测试应用程序？

自动化测试是个好主意吗？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-26T00:20:09.840

我是一个使用 QTP 的自动化团队的负责人，我讨厌它。记录/播放功能很糟糕，它经常会混淆，导致奇怪的测试结果。Record 只能用于构建对象数据库，即使这样，也不得不进行各种黑客攻击，以使其能够可靠地工作。

QTP/QC 基于 ActiveX/COM，只能使用 VBScript 编写脚本，VBScript 是另一包火焰狗屎。为了获得任何形式的可扩展性，我们必须做所有这些黑客和技巧。我们正在做一些事情，比如运行一个测试，将 QTP 测试动态添加到测试套件中，编辑输入参数，更改对象存储库以使其与环境匹配，保存测试，生成调度程序实例以运行测试。测试完成后，将所有结果复制到父测试，然后从测试集中删除 QTP 测试。最后，我们最终发布了自定义 COM 组件，VBScript 调用并使用 QTP/Quality Center 作为半成品报告引擎，它并没有真正提供足够的灵活性来获得我们真正需要的报告类型。

Mercury/HP 的另一个问题是他们将所有的技术支持外包给了印度，并且没有对他们进行培训。通常要在较低级别的支持炼狱中花费 2 周时间，然后才能与任何对 API 有任何技术知识的人交谈，结果却被告知是的，这是一个错误，但不，我们不会修复它。

我对强硬的语言感到抱歉，但我发现整个情节都令人痛苦，并且永远不会再为使用 QTP/QC 的项目或团队工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T23:40:28.357

SO上有几个关于测试自动化的线程：

*   [哪个更适合网络测试？录音播放自动化还是编码？](https://stackoverflow.com/questions/142398/which-is-better-for-web-testing-record-play-automation-or-coding#311259)
*   [用户界面测试](https://stackoverflow.com/questions/41601/user-interface-testing)
*   [GUI的自动化测试](https://stackoverflow.com/questions/226342/automated-testing-of-gui#226765)

我从未使用过 Quick Test Pro，但我参与过几个使用不同自动化测试工具的项目；Silk Test，理性机器人，WinRunner。这些努力中最成功的是使用带有 RRAFS 框架的 Rational Robot 将应用程序更改与测试脚本隔离开来。我们还使用[STAF](http://staf.sourceforge.net/)框架来自动化和管理我们的测试基础设施。

自动化测试是测试应用程序方面的一种很好的技术，但它并不能取代人工测试人员。像所有工具一样，您可以使用它，也可以滥用它。只要您正在测试的内容是稳定的、重复的、具有可预测或可计算的结果，并且您测试的频率足够高，那么自动化的成本最终会收回成本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T22:01:22.283

我发现非 UI 的自动化测试绝对值得。

UI 的自动化测试也是值得的，但没有那么多。对于我的项目，UI 不到代码的 10%。UI 的自动化测试还有很多其他问题，比如时间和线程访问，这使得它比预期的更困难。我使用 nunitforms 进行 UI 测试。

我建议如果可能的话，先测试 UI 背后的逻辑，然后再测试 UI。通过非 UI 测试，您可以获得更好的收益。

我评估了自动化 QA 的测试程序，它看起来不错，但我选择了 nunitforms，因为它更类似于我为非 UI 测试所做的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T20:10:18.310

“自动化测试”并不像听起来那么好。据我所知，测试执行的自动化只是流程的一部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T20:52:00.287

哪种自动化测试？

我已经编写了一些脚本，它们是构建后过程的一部分，以通过 API 比较一些结果，但这并不是您想要的。

在自动化的windows用户界面应用方面，我对理性机器人有所了解，但不能特别推荐。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T21:29:19.290

在我工作的地方，我们不使用 QuickTest Pro，但我们正在研究自动化系统测试的选项。就建议而言，如果不知道您接受或拒绝软件工具的标准是什么，这有点困难。我根据这些标准来判断自动化系统工具：

*   它是否使程序员以外的其他人能够创建自动化系统测试？
*   程序员可以为定制目的编写脚本吗？
*   它是否支持数据驱动测试（使用来自外部文件和/或数据库的测试数据多次运行单个测试）。
*   你能配置测试运行的顺序吗？
*   它对包含在持续集成环境中的支持程度如何？

这些只是能力。成本当然是一个因素。该工具是否需要学习用于脚本的专有语言是另一个因素。

自动化测试绝对是个好主意。自动化测试是[持续集成](http://martinfowler.com/articles/continuousIntegration.html)的关键推动因素之一。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-04T08:40:48.350

如果任务中有重复，任何任务的自动化都应该存在。例如，在一个模块中，如果您必须为每个构建运行回归测试用例，其中对产品进行了一些小的改进，那么可以运行回归测试用例自动化。在此示例中，重复测试用例的自动化将提高生产力并使测试人员能够更多地专注于手动测试。

除了 qtp，您还可以探索 qt 相关项目的 squish 和 windows C++ 和 VB 项目的测试伙伴。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-11-26T17:42:31.670

Dan，我使用 QTP 11 进行自动化。

让我知道您的要求，例如您想要测试哪种应用程序等。许多开源和共享软件工具可用于几乎所有类型的应用程序。

自动化测试是一个好主意，前提是你要自动化的东西不会经常改变。如果没有，您最终会相应地修改测试脚本，而不是在需要时在应用程序上运行它。

# asp.net-mvc - 使用 Visual Web Developer Express 2008 中的 ASP.NET MVC

> ID：401266
> 
> 赞同：5
> 
> 时间：2008-12-30T19:45:03.853
> 
> 标签：asp.net-mvc, projects-and-solutions, vwdexpress

我想知道是否有一种方法（甚至是手动方法）可以在 Visual Web Developer Express 2008 SP1 下设置带有单元测试的 ASP.NET MVC 项目。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-30T19:51:47.087

ASP.NET MVC 1.0（发布版）与 Visual Web Developer Express 2008 的模板捆绑在一起。但不确定是否需要 SP1。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T19:49:39.320

Visual Web Developer 不支持 C# 测试项目，它本质上是一个 ASP.NET MVC 测试项目。但是，您可以使用引用包含模型和控制器的程序集的 Visual C# Express 来测试您的应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T14:06:32.713

一段时间以来，我一直在使用[此处](http://padcom13.blogspot.com/2009/04/nunit-template-for-aspnet-mvc.html)描述的解决方案。它就像 Visual Web Developer 的魅力：D 实际上它的工作原理与 VisualStudio 的完整版完全一样！

它使您可以立即访问您的单元测试项目中的 NUnit 框架以及 NUnit Mocks（我知道它不是最好的，但无论如何它都带有 NUnit，因此没有必要否认它的存在）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-25T21:54:44.720

您需要 Visual Web Developer Express 2008 SP1，并且根据 VWDExpress 自述文件：要在文件菜单上查看“新建项目”和“打开项目”，您必须通过右键单击文件菜单手动将这些命令添加到菜单中，单击“自定义...”，选择“命令”选项卡，选择“文件”类别，然后将“新建项目”和“打开项目”拖到文件菜单...

# python - 命名 Python 记录器

> ID：401277
> 
> 赞同：49
> 
> 时间：2008-12-30T19:47:53.113
> 
> 标签：python, django, logging

在 Django 中，我到处都有记录器，目前使用硬编码的名称。

对于模块级日志记录（即，在视图函数的模块中），我有这样做的冲动。

```
log = logging.getLogger(__name__) 
```

对于类级别的日志记录（即，在类`__init__`方法中），我有这样做的冲动。

```
self.log = logging.getLogger("%s.%s" % (
    self.__module__, self.__class__.__name__)) 
```

在处理几十个`getLogger("hard.coded.name")`.

这行得通吗？还有其他人用同样缺乏想象力的方式命名他们的记录器吗？

此外，我应该分解并为此日志定义编写一个类装饰器吗？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-12-31T07:31:40.153

我通常不使用或不需要类级别的记录器，但我最多将我的模块保留在几个类中。一个简单的：

```
import logging
LOG = logging.getLogger(__name__) 
```

在模块顶部及后续：

```
LOG.info('Spam and eggs are tasty!') 
```

从文件中的任何地方通常可以让我到达我想去的地方。这避免了对`self.log`所有地方的需要，这从把它放在每个班级的角度来看都会困扰我，并使我的 5 个字符更接近 79 个适合的字符行。

你总是可以使用伪类装饰器：

```
>>> import logging
>>> class Foo(object):
...     def __init__(self):
...             self.log.info('Meh')
... 
>>> def logged_class(cls):
...     cls.log = logging.getLogger('{0}.{1}'.format(__name__, cls.__name__))
... 
>>> logged_class(Foo)
>>> logging.basicConfig(level=logging.DEBUG)
>>> f = Foo()
INFO:__main__.Foo:Meh 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-27T03:36:18.197

对于类级别日志记录，作为伪类装饰器的替代方案，您可以使用元类在类创建时为您制作记录器......

```
import logging

class Foo(object):
    class __metaclass__(type):
        def __init__(cls, name, bases, attrs):
            type.__init__(name, bases, attrs)
            cls.log = logging.getLogger('%s.%s' % (attrs['__module__'], name))
    def __init__(self):
        self.log.info('here I am, a %s!' % type(self).__name__)

if __name__ == '__main__':
    logging.basicConfig(level=logging.DEBUG)
    foo = Foo() 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T20:12:00.680

看起来它会起作用，只是它`self`没有`__module__`属性；它的类会。类级记录器调用应如下所示：

```
self.log = logging.getLogger( "%s.%s" % ( self.__class__.__module__, self.__class__.__name__ ) ) 
```

# asp.net - File.Exists 从网络共享返回 false

> ID：401284
> 
> 赞同：6
> 
> 时间：2008-12-30T19:51:13.107
> 
> 标签：asp.net, file, network-shares

我一直在做一个 ASP.NET 项目，它将上传的文件保存到网络共享中。我想我可以只使用一个虚拟目录就可以了，但我一直在为 Directory.CreateDirectory 的权限而苦苦挣扎。

我能够上传文件，所以我决定更改我的代码以将所有内容放在一个目录中，但这需要我使用 File.Exists 来避免覆盖重复项。

现在我已经更新了所有代码，我发现无论我做什么，当我针对网络共享进行测试时，File.Exists 总是返回 false（文件肯定存在）。

有任何想法吗？我将在网络共享方面走到尽头。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-30T19:58:08.477

File.Exist 实际上并不检查文件是否存在。相反，它会检查您可以访问的文件是否存在。如果您知道该文件存在，则可能的问题是您无权访问它。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-30T20:03:17.653

我最近刚刚从事了一个非常相似的项目，我将文件保存到网络共享。两台计算机在同一个子网上，但不受域控制器控制，所以每台计算机都有自己的用户。

我在两台计算机上创建了一个具有相同用户名和密码的用户。然后我创建了一个网络共享并设置文件夹/共享权限以允许用户读写。

然后我创建了以下类来管理模拟：

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Runtime.InteropServices;
using System.Security.Principal;
using System.Security.Permissions;
using System.Text;

namespace MyProject.Business.Web
{
    public class SecurityManager
    {
        #region DLL Imports
        [DllImport("advapi32.dll", SetLastError = true, CharSet = CharSet.Unicode)]
        public static extern bool LogonUser(String lpszUsername, String lpszDomain, String lpszPassword, int dwLogonType, int dwLogonProvider, ref IntPtr phToken);

        [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
        public extern static bool CloseHandle(IntPtr handle);

        [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        public extern static bool DuplicateToken(IntPtr ExistingTokenHandle, int SECURITY_IMPERSONATION_LEVEL, ref IntPtr DuplicateTokenHandle);
        #endregion

        public string Domain { get; set; }
        public string UserName { get; set; }
        public string Password { get; set; }

        private WindowsImpersonationContext m_CurrentImpersonationContext;

        [PermissionSetAttribute(SecurityAction.Demand, Name = "FullTrust")]
        public void StartImpersonation()
        {
            const int LOGON32_PROVIDER_DEFAULT = 0;
            const int LOGON32_LOGON_INTERACTIVE = 2;

            IntPtr tokenHandle = IntPtr.Zero;
            IntPtr dupeTokenHandle = IntPtr.Zero;

            // obtain a handle to an access token
            bool wasLogonSuccessful = LogonUser(UserName, Domain, Password, LOGON32_LOGON_INTERACTIVE, LOGON32_PROVIDER_DEFAULT, ref tokenHandle);

            if (!wasLogonSuccessful)
                throw new Exception(String.Format("Logon failed with error number {0}", Marshal.GetLastWin32Error()));

            // use the token handle to impersonate the user
            WindowsIdentity newId = new WindowsIdentity(tokenHandle);
            m_CurrentImpersonationContext = newId.Impersonate();

            // free the tokens
            if (tokenHandle != IntPtr.Zero)
                CloseHandle(tokenHandle);
        }
        public void EndImpersonation()
        {
            m_CurrentImpersonationContext.Undo();
        }
    }
} 
```

然后在 ASP.NET 页面中，我执行了以下操作：

```
SecurityManager sm = new SecurityManager();
sm.UserName = ConfigurationManager.AppSettings["UserFileShareUsername"];
sm.Password = ConfigurationManager.AppSettings["UserFileSharePassword"];
sm.StartImpersonation();

if (!Directory.Exists(folderPath)) Directory.CreateDirectory(folderPath);

File.Move(sourcePath, destinationPath);

sm.EndImpersonation(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T19:54:11.260

也许您正在运行的代码（即 ASP.NET 服务器代码）作为无权访问该网络共享的用户（例如 IIS 用户）运行。

我认为 IIS 不应该作为具有高度特权的用户运行，默认情况下该用户有权查看其他计算机上的共享。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-06-28T15:01:41.920

我使用了几乎相同的代码，但让我的类实现了 IDisposable 接口，并将 Undo() 添加到 Dispose() 方法中。这段代码运行良好，如果你是唯一使用它的开发人员并且你总是以正确的方式做事，对吧？

# ide - 如何将我的 Netbeans 主题迁移到其他计算机？

> ID：401289
> 
> 赞同：3
> 
> 时间：2008-12-30T19:52:00.283
> 
> 标签：ide, netbeans, migration, themes, colors

除了复制整个 .netbeans 目录之外，有没有办法将自定义 Netbeans 配色方案传输到其他计算机？我正在使用最新的（6.5）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-31T21:40:59.393

颜色设置存储在用户目录中的 config/Editors/ 下，因此您只需要传输 userdir 的那部分（应该很小；大部分 userdir 都在 var/ 代码索引等。 居住）。

-- 托尔

# c# - 企业库日志记录块不记录

> ID：401303
> 
> 赞同：5
> 
> 时间：2008-12-30T19:55:19.620
> 
> 标签：c#, asp.net, enterprise-library

我在使用 3.1 版本的日志记录应用程序块时遇到问题...

使用 3.5 框架，我的应用程序在我的桌面上运行良好......一旦它部署到我们的 qa 盒子......日志记录停止运行。web.config 在这两种情况下都是相同的。有任何想法吗？权限问题？

经过快速诊断......结果它在调试模式下编译但不能发布时工作......有人知道要更改设置以使其在发布模式下工作吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-05T17:33:19.067

好吧，我发现了这个问题，所以我会发布它，以防其他人遇到同样的问题。这一切都与我们部署到的目标机器上的权限有关。虽然我们的开发环境是通过 Visual Studio 使用内置 Web 服务器“部署”的，但我们的集成环境是 2003 年的服务器（希望您能看到我的目标）。原来是使用 iis 的默认应用程序池设置的权限问题。在网络权限下运行不允许您访问事件日志并且不会产生错误（注意这是一个真正的痛苦）。如果您将其移动到本地系统帐户...一切正常（尽管不推荐）。EntLib 的文档中有一个部分用于在部分信任下运行，您可以在其中找到所需的大部分信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-05T18:05:27.363

我知道

```
System.Diagnostics.Debug.Assert(conditionToTest, "Message when assert fails"); 
```

仅在定义了条件编译器指令 DEBUG 时运行。我怀疑你的情况也发生了类似的事情。

# c# - 如何从路径中提取每个文件夹名称？

> ID：401304
> 
> 赞同：74
> 
> 时间：2008-12-30T19:55:53.300
> 
> 标签：c#, string

我的路径是`\\server\folderName1\another name\something\another folder\`

如果我不知道路径中有多少个文件夹并且我不知道文件夹名称，如何将每个文件夹名称提取到一个字符串中？

非常感谢

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-12-30T20:02:52.023

```
string mypath = @"..\folder1\folder2\folder2";
string[] directories = mypath.Split(Path.DirectorySeparatorChar); 
```

编辑：这将返回目录数组中的每个单独的文件夹。您可以像这样获取返回的文件夹数：

```
int folderCount = directories.Length; 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-12-30T20:18:13.397

这在一般情况下很好：

```
yourPath.Split(@"\/", StringSplitOptions.RemoveEmptyEntries) 
```

如果路径本身以（反）斜杠结尾（例如“\foo\bar\”），则返回的数组中没有空元素。但是，您必须确保它`yourPath`确实是一个目录而不是文件。如果它是这样的文件，您可以找出它是什么并进行补偿：

```
if(Directory.Exists(yourPath)) {
  var entries = yourPath.Split(@"\/", StringSplitOptions.RemoveEmptyEntries);
}
else if(File.Exists(yourPath)) {
  var entries = Path.GetDirectoryName(yourPath).Split(
                    @"\/", StringSplitOptions.RemoveEmptyEntries);
}
else {
  // error handling
} 
```

我相信这涵盖了所有基础，而不会太迂腐。它将返回一个`string[]`您可以迭代`foreach`以依次获取每个目录的值。

如果要使用常量而不是`@"\/"`魔术字符串，则需要使用

```
var separators = new char[] {
  Path.DirectorySeparatorChar,  
  Path.AltDirectorySeparatorChar  
}; 
```

然后在上面的代码中使用`separators`而不是。`@"\/"`就个人而言，我觉得这太冗长了，很可能不会这样做。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-03-10T15:59:25.520

意识到这是一篇旧帖子，但我发现它是在寻找 - 最后我决定使用下面的函数，因为它比上述任何一个都更好地对我当时正在做的事情进行排序：

```
private static List<DirectoryInfo> SplitDirectory(DirectoryInfo parent)
{
    if (parent == null) return null;
    var rtn = new List<DirectoryInfo>();
    var di = parent;

    while (di.Name != di.Root.Name)
    {
    rtn.Add(di);
    di = di.Parent;
    }
    rtn.Add(di.Root);

    rtn.Reverse();
    return rtn;
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-03-13T21:48:08.627

我看到你的[方法](https://stackoverflow.com/questions/401304/c-sharp-how-do-i-extract-each-folder-name-from-a-path#answer-9647836) [Wolf5370](https://stackoverflow.com/users/378526/wolf5370)并提高了你。

```
internal static List<DirectoryInfo> Split(this DirectoryInfo path)
{
    if(path == null) throw new ArgumentNullException("path");
    var ret = new List<DirectoryInfo>();
    if (path.Parent != null) ret.AddRange(Split(path.Parent));
    ret.Add(path);
    return ret;
} 
```

`c:\folder1\folder2\folder3`在返回的路径上

`c:\`

`c:\folder1`

`c:\folder1\folder2`

`c:\folder1\folder2\folder3`

以该顺序

### 或者

```
internal static List<string> Split(this DirectoryInfo path)
{
    if(path == null) throw new ArgumentNullException("path");
    var ret = new List<string>();
    if (path.Parent != null) ret.AddRange(Split(path.Parent));
    ret.Add(path.Name);
    return ret;
} 
```

将返回

`c:\`

`folder1`

`folder2`

`folder3`

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-30T20:05:55.217

有几种方法可以表示文件路径。您应该使用`System.IO.Path`该类来获取操作系统的分隔符，因为它在 UNIX 和 Windows 之间可能会有所不同。此外，大多数（或所有，如果我没记错的话）.NET 库接受“\”或“/”作为路径分隔符，无论操作系统如何。出于这个原因，我会使用 Path 类来分割你的路径。尝试以下操作：

```
string originalPath = "\\server\\folderName1\\another\ name\\something\\another folder\\";
string[] filesArray = originalPath.Split(Path.AltDirectorySeparatorChar,
                              Path.DirectorySeparatorChar); 
```

无论文件夹数量或名称如何，这都应该有效。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-10-02T15:54:17.587

```
public static IEnumerable<string> Split(this DirectoryInfo path)
{
    if (path == null) 
        throw new ArgumentNullException("path");
    if (path.Parent != null)
        foreach(var d in Split(path.Parent))
            yield return d;
    yield return path.Name;
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-01-10T21:01:37.063

```
 // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    /// <summary>
    /// Use to emulate the C lib function _splitpath()
    /// </summary>
    /// <param name="path">The path to split</param>
    /// <param name="rootpath">optional root if a relative path</param>
    /// <returns>the folders in the path. 
    ///     Item 0 is drive letter with ':' 
    ///     If path is UNC path then item 0 is "\\"
    /// </returns>
    /// <example>
    /// string p1 = @"c:\p1\p2\p3\p4";
    /// string[] ap1 = p1.SplitPath();
    /// // ap1 = {"c:", "p1", "p2", "p3", "p4"}
    /// string p2 = @"\\server\p2\p3\p4";
    /// string[] ap2 = p2.SplitPath();
    /// // ap2 = {@"\\", "server", "p2", "p3", "p4"}
    /// string p3 = @"..\p3\p4";
    /// string root3 = @"c:\p1\p2\";
    /// string[] ap3 = p1.SplitPath(root3);
    /// // ap3 = {"c:", "p1", "p3", "p4"}
    /// </example>
    public static string[] SplitPath(this string path, string rootpath = "")
    {
        string drive;
        string[] astr;
        path = Path.GetFullPath(Path.Combine(rootpath, path));
        if (path[1] == ':')
        {
            drive = path.Substring(0, 2);
            string newpath = path.Substring(2);
            astr = newpath.Split(new[] { Path.DirectorySeparatorChar }
                , StringSplitOptions.RemoveEmptyEntries);
        }
        else
        {
            drive = @"\\";
            astr = path.Split(new[] { Path.DirectorySeparatorChar }
                , StringSplitOptions.RemoveEmptyEntries);
        }
        string[] splitPath = new string[astr.Length + 1];
        splitPath[0] = drive;
        astr.CopyTo(splitPath, 1);
        return splitPath;
    } 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2019-09-26T16:23:40.900

受早期答案的启发，但更简单，并且没有递归。此外，它不关心分隔符号是什么，如下`Dir.Parent`所示：

```
 /// <summary>
    /// Split a directory in its components.
    /// Input e.g: a/b/c/d.
    /// Output: d, c, b, a.
    /// </summary>
    /// <param name="Dir"></param>
    /// <returns></returns>
    public static IEnumerable<string> DirectorySplit(this DirectoryInfo Dir)
    {
        while (Dir != null)
        {
            yield return Dir.Name;
            Dir = Dir.Parent;
        }
    } 
```

要么把它放在一个`static`类中以创建一个很好的扩展方法，要么就省略`this`(and `static`)。

按编号访问路径部分的用法示例（作为扩展方法）：

```
 /// <summary>
    /// Return one part of the directory path.
    /// Path e.g.: a/b/c/d. PartNr=0 is a, Nr 2 = c.
    /// </summary>
    /// <param name="Dir"></param>
    /// <param name="PartNr"></param>
    /// <returns></returns>
    public static string DirectoryPart(this DirectoryInfo Dir, int PartNr)
    {
        string[] Parts = Dir.DirectorySplit().ToArray();
        int L = Parts.Length;
        return PartNr >= 0 && PartNr < L ? Parts[L - 1 - PartNr] : "";
    } 
```

以上两种方法现在都在我的个人库中，因此是 xml 注释。使用示例：

```
 DirectoryInfo DI_Data = new DirectoryInfo(@"D:\Hunter\Data\2019\w38\abc\000.d");
    label_Year.Text = DI_Data.DirectoryPart(3); // --> 2019
    label_Entry.Text = DI_Data.DirectoryPart(6);// --> 000.d 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-30T19:58:44.963

快速的答案是使用 .Split('\\') 方法。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-30T20:02:34.240

也许循环调用[Directory.GetParent ？](http://msdn.microsoft.com/en-us/library/system.io.directory.getparent.aspx)那是如果您想要每个目录的完整路径而不仅仅是目录名称。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-07-30T23:29:13.333

我用它来循环文件夹 ftp 服务器

```
public List<string> CreateMultiDirectory(string remoteFile)

var separators = new char[] { Path.DirectorySeparatorChar, Path.AltDirectorySeparatorChar };
string[] directory = Path.GetDirectoryName(remoteFile).Split(separators);

var path = new List<string>();
var folder = string.Empty;
foreach (var item in directory)
{
     folder += $@"{item}\";
     path.Add(folder);
}

return path; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-06T20:54:37.147

我写了以下对我有用的方法。

```
protected bool isDirectoryFound(string path, string pattern)
    {
        bool success = false;

        DirectoryInfo directories = new DirectoryInfo(@path);
        DirectoryInfo[] folderList = directories.GetDirectories();

        Regex rx = new Regex(pattern);

        foreach (DirectoryInfo di in folderList)
        {
            if (rx.IsMatch(di.Name))
            {
                success = true;
                break;
            }
        }

        return success;
    } 
```

与您的问题最相关的行是：

DirectoryInfo 目录 = new DirectoryInfo(@path); DirectoryInfo[] 文件夹列表 = 目录.GetDirectories();

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-30T20:04:23.317

或者，如果您需要对每个文件夹执行某些操作，请查看 System.IO.DirectoryInfo 类。它还有一个 Parent 属性，允许您导航到父目录。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-06-12T18:42:22.400

```
DirectoryInfo objDir = new DirectoryInfo(direcotryPath);
DirectoryInfo [] directoryNames =  objDir.GetDirectories("*.*", SearchOption.AllDirectories); 
```

这将为您提供所有目录和子目录。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-08-30T20:50:10.473

我正在添加马特布鲁内尔的答案。

```
 string[] directories = myStringWithLotsOfFolders.Split(Path.DirectorySeparatorChar);

            string previousEntry = string.Empty;
            if (null != directories)
            {
                foreach (string direc in directories)
                {
                    string newEntry = previousEntry + Path.DirectorySeparatorChar + direc;
                    if (!string.IsNullOrEmpty(newEntry))
                    {
                        if (!newEntry.Equals(Convert.ToString(Path.DirectorySeparatorChar), StringComparison.OrdinalIgnoreCase))
                        {
                            Console.WriteLine(newEntry);
                            previousEntry = newEntry;
                        }
                    }
                }
            } 
```

这应该给你：

“\服务器”

“\服务器\文件夹名称1”

"\server\folderName1\另一个名称"

"\server\folderName1\另一个名字\某事"

"\server\folderName1\another name\something\another folder\"

（或按每个值的 string.Length 对生成的集合进行排序。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-11-23T23:56:13.233

我只是编写了这个代码，因为我没有找到任何已经内置在 C# 中的代码。

```
/// <summary>
/// get the directory path segments.
/// </summary>
/// <param name="directoryPath">the directory path.</param>
/// <returns>a IEnumerable<string> containing the get directory path segments.</returns>
public IEnumerable<string> GetDirectoryPathSegments(string directoryPath)
{
    if (string.IsNullOrEmpty(directoryPath))
    { throw new Exception($"Invalid Directory: {directoryPath ?? "null"}"); }

    var currentNode = new System.IO.DirectoryInfo(directoryPath);

    var targetRootNode = currentNode.Root;
    if (targetRootNode == null) return new string[] { currentNode.Name };
    var directorySegments = new List<string>();
    while (string.Compare(targetRootNode.FullName, currentNode.FullName, StringComparison.InvariantCultureIgnoreCase) != 0)
    {
        directorySegments.Insert(0, currentNode.Name);
        currentNode = currentNode.Parent;
    }
    directorySegments.Insert(0, currentNode.Name);
    return directorySegments;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-09-16T23:35:37.763

我想使用这个选项做出贡献（没有拆分方法）

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

namespace SampleConsoleApp
{
    class Program
    {
        static void Main(string[] args)
        {
            var filePaths = new[]
            {
                "C:/a/b/c/d/files-samples/formdata.bmp",
                @"\\127.0.0.1\c$\a\b\c\d\formdata.bmp",
                "/usr/home/john/a/b/c/d/formdata.bmp"
            };

            foreach (var filePath in filePaths)
            {

                var directorySegments = GetDirectorySegments(filePath);
                Console.WriteLine(filePath);
                Console.WriteLine(string.Join(Environment.NewLine,
                    directorySegments.Select((e, i) => $"\t Segment#={i + 1} Text={e}")));
            }

        }

        private static IList<string> GetDirectorySegments(string filePath)
        {
            var directorySegments = new List<string>();
            if (string.IsNullOrEmpty(filePath))
                return directorySegments;

            var fileInfo = new FileInfo(filePath);
            if (fileInfo.Directory == null) 
                return directorySegments;

            for (var currentDirectory = fileInfo.Directory;
                currentDirectory != null;
                currentDirectory = currentDirectory.Parent)
                directorySegments.Insert(0, currentDirectory.Name);

            return directorySegments;
        }
    }
} 
```

如果一切顺利，输出将如下所示：

```
C:/a/b/c/d/files-samples/formdata.bmp
         Segment#=1 Text=C:\
         Segment#=2 Text=a
         Segment#=3 Text=b
         Segment#=4 Text=c
         Segment#=5 Text=d
         Segment#=6 Text=files-samples
\\127.0.0.1\c$\a\b\c\d\formdata.bmp
         Segment#=1 Text=\\127.0.0.1\c$
         Segment#=2 Text=a
         Segment#=3 Text=b
         Segment#=4 Text=c
         Segment#=5 Text=d
/usr/home/john/a/b/c/d/formdata.bmp
         Segment#=1 Text=C:\
         Segment#=2 Text=usr
         Segment#=3 Text=home
         Segment#=4 Text=john
         Segment#=5 Text=a
         Segment#=6 Text=b
         Segment#=7 Text=c
         Segment#=8 Text=d 
```

您仍然可以对 GetDirectorySegments 执行其他过滤器（因为您有一个 DirectoryInfo 实例，您可以检查属性或使用 Exist 属性）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-09-16T23:41:52.833

这是对 Wolf 答案的修改，它省略了根并修复了似乎是几个错误的问题。我用它来生成面包屑，我不希望根显示。

这是`DirectoryInfo`类型的扩展。

```
public static List<DirectoryInfo> PathParts(this DirectoryInfo source, string rootPath)
{
  if (source == null) return null;
  DirectoryInfo root = new DirectoryInfo(rootPath);
  var pathParts = new List<DirectoryInfo>();
  var di = source;

  while (di != null && di.FullName != root.FullName)
  {
    pathParts.Add(di);
    di = di.Parent;
  }

  pathParts.Reverse();
  return pathParts;
} 
```

# .net - UserControl 焦点问题 - Focus() 有时返回 false

> ID：401305
> 
> 赞同：2
> 
> 时间：2008-12-30T19:55:55.533
> 
> 标签：.net, user-controls

我有一个行为类似于选项卡控件的用户控件。选项卡标题是`UserControl`覆盖`Paint`事件以使其看起来自定义的实例。

为了利用标签页上各种控件的验证事件，当用户单击标签页眉时，我们将焦点设置为`TabHeader`用户控件。

我注意到`Control.Focus()`有时会返回 false，但文档没有说明为什么`Control.Focus()`会返回 false，除了控件无法获得焦点。但我不知道为什么。

这是我看到的：如果我的`TabHeader` `UserControl`不包含任何子控件，并且我`myControl.Focus()`从`MouseClick`事件中调用，则焦点返回 true。

如果我`TabHeader` `UserControl`包含一个子控件并且我`myControl.Focus()`从`MouseClick`事件中调用，则焦点返回 false。

如果我`TabHeader` `UserControl`包含一个子控件，并且我`myControl.subControl.Focus()`从`myControl.MouseClick`事件中调用，则焦点返回 true。

有人可以解释一下吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T15:19:50.987

调用`Focus()`a`UserControl`会选择该 UserControl 的第一个子控件。这确实可以解释你的行为。

您可以尝试打电话`Select()`而不是`Focus()`看看是否有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-25T16:46:46.057

你试过“Control.ContainsFocus”吗？如果任何子控件都关注它，这应该返回 true。[MSDN 链接](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.containsfocus%28v=VS.90%29.aspx)

谢谢，詹姆斯

# c# - 以编程方式访问 web.config 的一部分？

> ID：401306
> 
> 赞同：11
> 
> 时间：2008-12-30T19:56:11.570
> 
> 标签：c#, .net, asp.net, configuration

有什么方法可以访问`<compilation />`web.config 文件中的标签吗？

我想检查文件中的“ *debug* ”属性是否设置为“ *true* ”，但我似乎不知道该怎么做。我试过使用`WebConfigurationManager`，但这似乎不允许我进入该`<compilation />`部分。

**更新：**

我知道我可以像 XML 文档一样轻松地加载文件并使用 XPath，但我希望框架中已经有一些东西可以为我做这件事。似乎会有一些东西，因为已经有获取应用程序设置和连接字符串的方法。

我也尝试过`WebConfigurationManager.GetSection()`以几种方式使用该方法：

```
WebConfigurationManager.GetSection("compilation")// Name of the tag in the file
WebConfigurationManager.GetSection("CompilationSection") // Name of the class that I'd expect would be returned by this method
WebConfigurationManager.GetSection("system.web") // Parent tag of the 'compilation' tag 
```

以上所有方法都返回`null`. 我假设有一种方法可以访问此配置部分，因为已经存在一个类（' `CompilationSection`'），我只是不知道如何获取它。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-30T20:31:20.327

采用：

```
using System.Configuration;
using System.Web.Configuration; 
```

...

```
 CompilationSection configSection =
          (CompilationSection) ConfigurationManager.GetSection( "system.web/compilation" ); 
```

然后，您可以检查该`configSection.Debug`属性。

**提示：**如果您需要知道如何从配置文件中获取值，请检查您`\Windows\Microsoft.net\Framework\<version>\CONFIG`文件夹中的 machine.config 文件。在那里，您可以看到所有配置节处理程序是如何定义的。一旦您知道配置处理程序的名称（在本例中为 CompilationSection），您就可以在 .Net 文档中查找它。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-12-31T04:41:22.570

检查您是否在调试模式下运行的简单方法是使用[HttpContext.IsDebuggingEnabled](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.isdebuggingenabled.aspx)属性。它从编译元素的调试属性中得到答案，这与您尝试做的事情相同。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T20:02:22.883

毕竟，您总是可以将`Web.config`文件加载到一个`XmlDocument`并使用`XPath`查询来找出答案！

```
XmlDocument doc = new XmlDocument();
doc.Load(Server.MapPath("~/Web.config"));     
doc.SelectSingleNode("/configuration/system.web/compilation/@debug"); 
```

但是，我建议您使用该`Configuration.GetSection`方法进行解决。

```
CompilationSection section = 
    Configuration.GetSection("system.web/compilation") as CompilationSection;
bool debug = section != null && section.Debug; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-02-22T09:06:30.737

您始终可以通过将代码括在其中来检查编译器级别的调试选项

```
#if (DEBUG)

#endif 
```

万一是这个主意……

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-05-14T09:53:59.170

尝试使用：

```
HttpContext.Current.IsDebuggingEnabled 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T20:02:41.120

您不能将文件作为常规 XML 文件加载并使用 XPath 获取节点吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T20:06:53.733

尝试使用 ConfigurationManager.GetSection 方法。

# iis - IIS中的高cpu

> ID：401310
> 
> 赞同：1
> 
> 时间：2008-12-30T19:58:13.390
> 
> 标签：iis, cpu-usage

我正在开发一个 POS 应用程序，它在每台 POS 计算机上都有一个本地数据库，并使用 IIS 中托管的 WCF 与服务器通信。该应用程序已经在多个客户中部署了一年多。

大约一周前，我们开始收到一位客户的报告，称托管 IIS 的服务器非常慢。当我检查了这个问题时，我看到应用程序池和我的进程在 8 cpu 服务器上几乎达到了 100% cpu。

我检查了 SQL 活动监视器和网络容量，它们没有显示超出我们通常看到的明显过载。

在 Process Explorer 中检查线程时，我看到很多线程重复调用 CreateApplicationContext。根据我在网上找到的一些帖子，我尝试安装.Net 2.0 SP1，但它并没有解决问题并将函数调用替换为CLRCreateManagedInstance。

我即将使用 IIS 进程的 adplus 和 windbg 捕获转储，并尝试找出问题所在。

有没有人遇到过这样的事情或者知道我应该检查哪个目录？

ps 相同版本的应用程序部署在另一个客户中，并且工作正常。我还尝试回滚版本（甚至是非常旧的版本），它的行为仍然完全相同。

编辑：好吧，问题解决了，原来我在那里有一个不限制结果集的 SQL 查询，当客户经过一定数量的行时，它开始让服务器陷入困境。我花了两天时间才找到它，因为日志中的所有周围噪音，但我等了一夜然后转储，它立即向我显示了查询。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-31T01:33:47.317

通常这与硬件无关，而与 IIS 的配置方式以及一些运行时间稍长的查询（100 多毫秒）有关。

在您的应用程序池配置下，将您的网络花园设置设置为 20 或更多。

网络花园设置几乎是可用于处理应用程序请求的线程数。如果它设置为 1，那么单个查询可能会阻止处理其他请求，直到它完成。

我有一个每天处理近 350 万个请求的应用程序。当网络花园设置为 1 时，网络服务器 CPU 保持在 100% 并且有很多请求被丢弃。当我将它提高到 50 时，Web 服务器 CPU 下降到略低于 2%，并且没有任何请求被丢弃。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-04-03T10:26:37.503

我们遇到了同样的问题。某些 IIS 应用程序池进程的 CPU 使用率非常高，以至于 Web 服务器上的 CPU 使用率约为 100%。

首先，我们使用 DebugDiag 和 ProcMon 来缩小问题范围。见这里：[http ://www.iis.net/learn/troubleshoot/performance-issues/troubleshooting-high-cpu-in-an-iis-7x-application-pool](http://www.iis.net/learn/troubleshoot/performance-issues/troubleshooting-high-cpu-in-an-iis-7x-application-pool)

我们在 DebugDiag 分析中发现许多“This thread is waiting in a WaitOne”消息。这表明请求出于某种原因正在相互等待。所以我们开始寻找共享资源。我们唯一能真正找到的是数据库。所以我们认为，尽管 Web 服务器有 100% 的 CPU 使用率，但真正的问题应该是数据库服务器。

我的同事进一步调查了此案。他做了以下几件事：

1.)**配置 SQL Server 的并行度**

在数据库服务器上使用 ProcMon，他发现 SQL Server 使用了太多的锁和闩锁。看看这里：http: [//blog.sqlauthority.com/2011/02/06/sql-server-cxpacket-parallelism-usual-solution-wait-type-day-6-of-28/](http://blog.sqlauthority.com/2011/02/06/sql-server-cxpacket-parallelism-usual-solution-wait-type-day-6-of-28/)

他将每个查询使用的处理器数量设置为 4。默认值是 0（我怀疑这等于可用的处理器数量——在我们的例子中是 24）。您可以使用 SQL Management Studio 进行设置，方法是右键单击服务器节点本身并选择属性。

这对减少闩锁和加快请求产生了巨大的影响。我们的猜测是 SQL Server 过度使用了查询的并行化，导致在完成它们时同步过于繁重。

2.)**在数据库中创建新的和缺失的索引**

我们在我们的网站上运行了第三方论坛软件，结果证明它根本没有在其数据库中使用任何索引。我的同事使用这里的知识：[http](http://www.mssqltips.com/sqlservertip/1634/using-sql-server-dmvs-to-identify-missing-indexes/) ://www.mssqltips.com/sqlservertip/1634/using-sql-server-dmvs-to-identify-missing-indexes/创建了几个新索引。

现在这个案子似乎已经了结。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T20:25:04.740

纯粹凭直觉做一个完整的猜测，听起来可能会发生某种异常，异常被 global.asax 中的全局异常处理程序捕获，异常处理程序也导致抛出异常并转储过程。也可能是由于病毒扫描实用程序锁定了某些文件。不过，我可能会*走开*。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T22:02:27.163

Don't eliminate the possibilty of a hardware issue. I had a server running slow and found it to be a motherboard issue. It was replaced under warranty.

# asp.net - 以编程方式诊断由于应用程序回收导致的 ASP.Net 会话丢失？

> ID：401311
> 
> 赞同：2
> 
> 时间：2008-12-30T19:58:30.893
> 
> 标签：asp.net, asp.net-2.0

我们有一个 ASP.Net 2.0 (VS2005) 应用程序在本地运行良好，但有时在远程服务器上部署时会丢失会话状态。

我怀疑 IIS 回收应用程序可能存在问题，从而破坏了用户的会话状态。但是，服务器是远程的，不在我们的控制之下……所以我们不能简单地启动 IIS Admin 并检查应用程序设置。当然，另一个可能的原因是客户端出于某种原因拒绝了 ASP.Net 会话 cookie。

*（我们几乎已经排除了代码中的错误，因为它是一个简单的应用程序，它从不尝试从 Session 对象中删除任何内容，但当然......这些都是著名的遗言，嗯？）*

**您将如何以编程方式诊断此问题？**

我主要是想弄清楚如何诊断问题；如果过度热心的应用程序回收是罪魁祸首，那么编写代码应该不会太难。

我确信这是 ASP.Net 开发人员的常见问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T20:06:07.603

如果您可以更改某些设置，以下几个链接可能有助于解决此问题：

[在 IIS 6.0 (IIS 6.0) 中记录工作进程回收事件](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/87892589-4eda-4003-b4ac-3879eac4bf48.mspx?mfr=true)

[记录 ASP.NET 应用程序关闭事件](http://weblogs.asp.net/scottgu/archive/2005/12/14/433194.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T20:04:51.037

将一些日志记录代码添加到 global.asax Application_Start 方法中，您将能够看到何时/如果您的丢失是由应用程序重新启动引起的（或者至少，如果您知道会话已启动，您将看到服务器何时启动同时丢失，你知道你的罪魁祸首）。

一种解决方法是使用超出 proc 会话状态（如果您无法控制服务器，则可能必须基于 SQL）。这需要对您的代码进行一些额外的工作，因为您存储在 Session 中的所有内容都必须是可序列化的，但可以解决应用程序重新启动导致会话丢失的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T20:18:50.947

在应用程序池中为多个工作线程（Web Garden）配置的 IIS 可能会导致会话状态丢失。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-22T07:52:20.150

我发现了会话丢失的情况 - 在 asp.net 页面中，对于金额文本框字段具有无效字符，然后为其他目的检索会话变量。通过 Convert.ToInt32 或 double 发布无效数字解析后引发第一次机会异常，但该行没有显示错误，而是由于未处理的异常，会话为空，在会话检索时显示错误，从而欺骗调试......

提示：测试您的系统以使其失败-破坏性..在不相关的情况下输入足够多的垃圾，您也可以在本地代码库上重现这台机器......:)

希望它有帮助，hydtechie

# linux - 用于比较 Linux 中多个文件的日期的 Shell 脚本

> ID：401326
> 
> 赞同：1
> 
> 时间：2008-12-30T20:04:07.810
> 
> 标签：linux, datetime, shell

我在 Linux 上的 /ifshome 下有很多主目录。我想看看哪些用户在过去 6 个月内没有登录，我的解决方案是解析 /ifshome/user/.lastlogin 文件。每个 .lastlogin 文件具有相同的格式，1 行：

```
Last Login: Fri Mar 09 18:06:27 PST 2001 
```

我需要构建一个 shell 脚本，它可以解析每个用户主目录中的 .lastlogin 文件，并输出所有者在过去 6 个月内没有登录的那些目录。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T20:20:44.763

您可能会发现该`last`命令对您有帮助。它将列出最近登录的 N 个用户，或在特定时间登录的用户等 [手册页](http://linux.die.net/man/1/last)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T20:20:15.500

好的，在纯 shell 脚本中，您可能希望使用 sort(1) 和空白作为字段 sep。就像是

```
$ find /ifshome/user/ -name .lastlogin -print |
  xargs sort --key=8,8 --key=4,4 --key=5,5 
```

（警告，未经测试。）

您可能会发现使用 python 或 perl 更容易，因为它们具有更好的日期处理选项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T20:17:01.323

我是否正确假设最近时间应该或多或少等于文件的更改时间？如果是这样，您可以轻松地使用该`find`命令查找比六个月前更新的文件。

从“原始”列表中删除这些文件将产生较旧的文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T20:35:29.243

好的，这是我使用纯 shell 脚本解析文件的愚蠢方式（未经测试！）。

该`date`命令可以解析日期字符串，并输出自 1970 年以来的秒数。从当前秒数中减去它们，然后除以一个月所用的秒数。将该值与用户路径一起打印。

```
for i in /ifshome/*/.lastlogin; do
    dates=$(cat $i | grep "Last Login:" | cut -d: -f 2-)
    if [ ! -z "$dates" ]; then
      months=$(( ($(date +%s) - $(date -d "$dates" +%s)) / (60*60*24*31) ))
      echo $months $i
    fi
done 
```

`sort -n`使用和管道对输出进行排序，`less`然后您可以浏览用户列表及其活动。

对于非骇客的方式，请考虑 Juan 的 lastlog 想法。它也在我的linux上。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-01T23:42:15.233

在我看来，文件的内容可能会回显文件的修改时间戳，因此您可以使用更简单的命令：

```
 find /ifshome -name .lastlogin -mtime +182 -print 
```

打印所有名为 .lastlogin 且修改时间超过 182 天的文件（选择您自己的大约 6 个月）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T20:17:23.633

.lastlogin 文件来自哪里？那是linux标准吗，因为我没有？

我刚刚在我的系统上找到了“lastlog”命令，它可以为您提供指定天数前最后登录的每个人：

```
       -b，--在 DAYS 之前
           仅打印早于 DAYS 的 lastlog 记录。

```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T20:31:29.190

使用以下代码在 PERL 中可以相对容易地完成它：

```
#!/usr/bin/perl

use strict;
use Time::Local ();

my $dir = "/ifshome";

my $month = {
  'Jan' => 0, 'Feb' => 1, 'Mar' => 2, 'Apr' => 3, 'May' => 4, 'Jun' => 5,
  'Jul' => 6, 'Aug' => 7, 'Sep' => 8, 'Oct' => 9, 'Nov' => 10, 'Dec' => 11,
};

my $expire = time() - (86400 * 30 * 6);

foreach my $home (<$dir/*>) {
  open(F,"$home/.lastlogin");
  chomp(my $line = <F>);

  if ($line =~ /^Last Login:\s+\w{3}\s+(\w{3})\s+(\d{2})\s+(\d{2}):(\d{2}):(\d{2})\s+\w+\s+(\d{4})/) {
    my $ts = Time::Local::timelocal($5,$4,$3,$2,$month->{$1},$6-1900);
    if ($ts < $expire) {
      my($user) = (split(/\//,$home))[-1];
      print "$user account is expired\n";
    }
  }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-30T21:45:37.013

*以下是对litb*代码的一些小改动。它可能需要 # 个月作为参数，并严格输出用户名，后跟更改后的月份：

**老用户.sh：**

```
echo "Purpose: Parse /ifshome and find dates in .lastlogin files that are older than MONTHS months."
echo "Usage: ./oldusers.sh [MONTHS=6]"
echo ""

case $# in
1)
monthmin=$1
;;
*)
monthmin=6
;;
esac

if [ "${monthmin//[^0-9]/}" != $monthmin ]; then echo "$monthmin is NaN";
else
 for i in ./*/.lastlogin; do
    dates=$(cat $i | grep "Last Login:" | cut -d: -f 2-)
    if [ ! -z "$dates" ]; then
      months=$(( ($(date +%s) - $(date -d "$dates" +%s)) / (60*60*24*30) ))
      user=$(echo $i | cut -d/ -f 2- | cut -d/ -f -1)
      if test $months -ge $monthmin; then echo "$user: $months months ago"; fi
    fi
 done
fi 
```

# svn - 检查已删除文件的历史记录

> ID：401331
> 
> 赞同：165
> 
> 时间：2008-12-30T20:05:29.630
> 
> 标签：svn, version-control, bazaar

如果我在 Subversion 中删除一个文件，我如何查看它的历史和内容？如果我尝试在不存在的文件上执行`svn cat`或`svn log`操作，它会抱怨该文件不存在。

另外，如果我想恢复文件，我应该把`svn add`它恢复吗？

（我专门询问了 Subversion，但我也想了解 Bazaar、Mercurial 和 Git 是如何处理这种情况的。）

* * *

## 回答 #1

> 赞同：153
> 
> 时间：2009-02-13T21:18:29.193

当您想查看旧文件时，您真的应该知道以下之间的区别：

```
svn cat http://server/svn/project/file -r 1234 
```

和

```
svn cat http://server/svn/project/file@1234 
```

第一个版本查看**现在**作为[http://server/svn/project/file](http://server/svn/project/file)可用的路径并检索该文件，就像它在修订版 1234 中一样。（因此，此语法在文件删除后不起作用）**。**

第二种语法获取在修订版 1234 中作为[http://server/svn/project/file可用的文件。因此此语法](http://server/svn/project/file)**确实**适用于已删除的文件。

您甚至可以结合这些方法来检索修订版 2345 中可用的文件，如[http://server/svn/project/file](http://server/svn/project/file) 但其内容与 1234 中的内容相同：

```
svn cat http://server/svn/project/file@2345 -r 1234 
```

* * *

## 回答 #2

> 赞同：97
> 
> 时间：2008-12-30T20:17:39.030

首先，找到文件被删除的修订号：

```
svn log -v > log.txt 
```

然后在 log.txt（不是 SVN 大师，所以我不知道更好的方法）中查找与

```
D <deleted file> 
```

看看那是哪个版本。然后，与其他答案一样，使用以前的版本恢复文件。

* * *

## 回答 #3

> 赞同：87
> 
> 时间：2008-12-30T20:13:24.437

要获取已删除文件的日志，请使用

```
svn log -r lastrevisionthefileexisted 
```

如果要恢复文件并保留其版本历史记录，请使用

```
svn copy url/of/file@lastrevisionthefileexisted -r lastrevisionthefileexisted path/to/workingcopy/file 
```

如果您只想要文件内容但未版本化（例如，为了快速检查），请使用

```
svn cat url/of/file@lastrevisionthefileexisted -r latrevisionthefileexisted > file 
```

在任何情况下，都不要使用 'svn up' 来取回已删除的文件！

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-12-30T20:56:32.070

在 git 中并没有什么特别之处。如果您知道文件的名称，您可以通过日志找出删除它的更改：

```
git log -n 1 -- filename 
```

然后，您可以使用该提交来获取删除之前存在的文件。

```
git checkout [last_revision]^ filename 
```

### 例子：

```
dhcp-120:/tmp/slosh 587% ls -l slosh.tac
ls: slosh.tac: No such file or directory
dhcp-120:/tmp/slosh 588% git log -n 1 -- slosh.tac
commit 8d4a1f1a94e4aa37c1cb9d329a140d08eec1b587
Author: Dustin Sallings <dustin@spy.net>
Date:   Mon Dec 15 11:25:00 2008 -0800

    Get rid of a .conf and replace it with .tac.
dhcp-120:/tmp/slosh 589% git checkout 8d4a1f^ slosh.tac
dhcp-120:/tmp/slosh 590% ll slosh.tac
-rw-------  1 dustin  wheel  822 Dec 30 12:52 slosh.tac 
```

请注意，这实际上并没有将文件重新置于修订控制中。它只是将文件以最终状态存在时拖放到当前位置。然后，您可以添加它或仅检查它或从那时起进行任何操作。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2010-11-29T05:08:42.017

仅使用 GUI 的解决方案：

如果您知道文件的名称，但**不知道其最后的修订号**，甚至不知道其路径：

1.  从 Repo Browser 在根目录上执行“显示日志”
2.  点击“显示全部”（在日志对话框的底部）
3.  在过滤器文本框中输入文件名（在日志对话框的顶部）

然后，这将仅显示添加/修改/删除文件的那些修订。*这是您的文件历史记录。*

请注意，如果通过删除其父文件夹之一来删除文件，则日志中不会有“已删除”条目（因此 mjy 的解决方案将不起作用）。在这种情况下，它在过滤日志中的最新条目将对应于它在删除时的内容。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2012-09-06T07:27:22.983

```
svn log -v | grep -B50 YourDeletedFileName 
```

将为您提供路径和修订。在 git 中（也检查重命名）：

```
git log --diff-filter=DR --name-only | grep -B50 YourDeletedFileName 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2012-03-23T10:19:35.250

使用这个命令：

```
svn log -v | awk '/^r[0-9]+/ { rev = $1; }; / D .*filename_escaped_for_regex/ { print rev" "$2; };' 
```

这将列出曾经删除任何与该模式匹配的文件的所有修订。也就是说，如果您正在搜索文件 README，则将找到并列出所有`/src/README`、`/src/README.first`和。`/some/deeply/hidden/directory/READMENOT`

如果您的**文件名**包含斜杠（路径）、点或其他特殊的正则表达式字符，请不要忘记转义它们以避免不匹配或错误。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2014-11-26T12:26:19.233

如果您不知道已删除文件的路径，那么您可以在其他过于繁重的命令中**搜索它：**`svn log`

```
svn log --search <deleted_file_or_pattern> -v 
```

该命令可能会像没有搜索选项一样重击服务器，但至少其他相关资源（包括您的眼球）会有所缓解，因为这会告诉您该文件在哪个修订版中被删除。然后，您可以按照其他提示（主要使用相同的`svn log`命令，但已经在定义的路径上）。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-12-30T22:22:22.320

除了达斯汀的回答，如果你只想检查内容，而不是检查出来，在他的例子中你可以这样做：

```
$ git show 8d4a1f^:slosh.tac 
```

: 分隔修订版和该修订版中的路径，有效地要求特定修订版的特定路径。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2011-11-07T16:08:09.423

发帖者实际上在这里提出了 3 个问题：

1.  如何在 Subversion 中查看已删除文件的历史记录？
2.  如何在 Subversion 中查看已删除文件的内容？
3.  如何在 Subversion 中恢复已删除的文件？

我在这里看到的所有答案都是针对问题 2 和 3。

问题1的答案是：

```
svn log http://server/svn/project/file@1234 
```

您仍然需要获取文件上次存在时间的修订号，此处其他人已明确回答。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-02-12T16:55:07.620

啊，因为我正在学习使用Bazaar，所以我尝试过。如果没有成功，您似乎无法[记录和注释当前已删除的文件](https://bugs.launchpad.net/bzr/+bug/255687 "log 和 annotate 应该适用于已删除的文件")...... :-(

试过：

```
> bzr log -r 3 Stuff/ErrorParser.hta
bzr: ERROR: Path does not have any revision history: Stuff/ErrorParser.hta 
```

但奇怪的是（幸运的是）我可以这样做：

```
> bzr cat -r 3 Stuff/ErrorParser.hta 
```

和：

```
> bzr diff -r 2..3 Stuff/ErrorParser.hta 
```

并在上面的错误中建议：

```
> bzr log -v | grep -B 1 ErrorParser 
```

（根据需要调整`-B`( `--before-context`) 参数）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-30T20:09:15.943

您需要指定一个修订版。

```
svn log -r <revision> <deleted file> 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-12-01T05:07:00.683

如果您想在重命名文件之前查看文件的历史记录，那么如[评论](https://stackoverflow.com/questions/2641146/handling-file-renames-in-git/2641221#2641221)中所述，您可以使用

```
git log --follow -- current_file_name 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-01-08T16:42:25.600

我想要一个答案，我自己。尝试以下操作以仅输出`svn log`.

```
svn log --stop-on-copy --verbose [--limit <limit>] <repo Url> | \
awk '{ if ($0 ~ /^r[0-9]+/) rev = $0 }
  { if ($0 ~ /^ D /) { if (rev != "") { print rev; rev = "" }; print $0 } }' 
```

*这会通过awk*过滤日志输出。*awk*缓冲它找到的每个修订行，只有在找到删除记录时才输出它。每个修订版仅输出一次，因此修订版中的多个删除被组合在一起（如在标准`svn log`输出中）。

您可以指定 a`--limit`以减少返回的记录数量。您也可以`--stop-on-copy`根据需要删除 。

我知道有人抱怨解析整个日志的效率。我认为这是一个比 grep 及其“广撒网”`-B`选项更好的解决方案。我不知道它是否更有效，但我想不出`svn log`. 它类似于@Alexander Amelkin 的回答，但不需要特定名称。这也是我的第一个*awk*脚本，所以它可能是非常规的。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2017-03-17T02:22:20.053

假设您的文件被命名为 ~/src/a/b/c/deleted.file

```
cd ~/src/a/b/c  # to the directory where you do the svn rm or svn mv command
#cd ~/src   # if you forget the correct directory, just to the root of repository
svn log -v | grep -w -B 9 deleted.file | head  # head show first 10 lines 
```

样本输出，在 r90440 找到

```
...
r90440 | user | 2017-02-03 11:55:09 +0800 (Fri, 03 Feb 2017) | 4 lines
Changed paths:
  M /src/a/b/c/foo
  M /src/a/b/c/bar
  D /src/a/b/c/deleted.file 
```

将其复制回以前的版本（90439=90440-1）

```
svn cp URL_of_deleted.file@90439 . 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-01-04T13:34:19.773

您可以使用二进制搜索找到提供文件的最后一个修订版。我`/bin/bash`为此创建了一个简单的脚本：

```
function svnFindLast(){
 # The URL of the file to be found
 local URL="$1"
 # The SVN revision number which the file appears in (any rev where the file DOES exist)
 local r="$2"
 local R
 for i in $(seq 1 "${#URL}")
  do
   echo "checkingURL:'${URL:0:$i}'" >&2
   R="$(svn info --show-item revision "${URL:0:$i}" 2>/dev/null)"
   echo "R=$R" >&2
   [ -z "$R" ] || break
 done
 [ "$R" ] || {
  echo "It seems '$URL' is not in a valid SVN repository!" >&2
  return -1
 }
 while [ "$r" -ne "$R" -a "$(($r + 1))" -ne "$R" ]
 do
  T="$(($(($R + $r)) / 2))"
  if svn log "${URL}@${T}" >/dev/null 2>&1
   then
    r="$T"
    echo "r=$r" >&2
   else
    R="$T"
    echo "R=$R" >&2
  fi
 done
 echo "$r"
} 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2015-03-26T17:21:40.020

我编写了一个 php 脚本，将我所有存储库的 svn 日志复制到 mysql 数据库中。我现在可以对我的评论或文件名进行全文搜索。

# dynamic - VS2005中使用C#动态创建项目

> ID：401338
> 
> 赞同：1
> 
> 时间：2008-12-30T20:07:14.230
> 
> 标签：dynamic, visual-studio-2005, project

是否可以使用 c# 在 VS2005 中以编程方式或动态创建项目？如果是这样，有人可以提供一些关于如何实现这一点的想法或链接吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T21:19:49.357

您还可以使用 msbuild api 以编程方式创建和编辑 msbuild 文件。有关详细信息，请参见此处：http: [//msdn.microsoft.com/en-us/library/microsoft.build.buildengine.project.aspx](http://msdn.microsoft.com/en-us/library/microsoft.build.buildengine.project.aspx)

下面是一个创建编译单个 .cs 文件并引用外部程序集的项目的示例：

```
Engine engine=new Engine();
engine.BinPath=RuntimeEnvironment.GetRuntimeDirectory();
Project project=engine.CreateNewProject();

project.AddNewImport(@"$(MSBuildBinPath)\Microsoft.CSharp.targets", null);

BuildPropertyGroup props=project.AddNewPropertyGroup(false);
props.AddNewProperty("AssemblyName", "myassembly");
props.AddNewProperty("OutputType", "Library");

BuildItemGroup items=project.AddNewItemGroup();
items.AddNewItem("Reference", "Some.Assembly");
items.AddNewItem("Compile", "somefile.cs");

project.Save("myproject.csproj") 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T20:22:50.627

.csproj 文件实际上是代表 msbuild 执行的 XML 文档。

这些文件可以使用 System.xml 生成，如果您需要验证它，这里有一个详细的[架构](http://blogs.msdn.com/msbuild/archive/2005/11/04/489212.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T22:48:27.447

可以创建允许在其中创建子项目的 Visual Studio 项目模板。当您定义在项目创建期间要运行的子项目模板时，这不会是真正动态的。

要真正动态化，您需要执行以下任一操作：

*   以编程方式创建 csproj/vbproj 文件以及您想要的所有项目。这将包括在 XML 中设置引用等

或者：

*   创建项目模板并通过VS项目创建机制来调用create project方法。这可能非常棘手，因为我在上面找到了 0 个文档，并且正在学习如何通过从 MS ASP.NET MVC 项目创建向导 DLL 进行逆向工程来做到这一点（因为这将动态地创建一个单元测试项目）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T21:53:47.977

If your wanting to be able to create the same things over and over again, Visual Studio supports templates. It even has macros that expand when a file is created from the template. For instance, $username$ would be replaced by the name of the logged in user when a file based on the template was created.

If that's not what you're trying to do, then you might be about to use the Visual Studio extensibility to control the creating of projects.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T22:27:40.703

看一下这个 CodePlex 项目的源代码：[STSDev](http://www.codeplex.com/stsdev/Release/ProjectReleases.aspx?ReleaseId=13220)

它最终成为一个 WinForm 应用程序，可以动态生成带有项目的 Visual Studio 解决方案。

它适用于 Sharepoint，但它使用的理念正是您所寻找的。

基思

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T20:22:25.963

Visual Studio 项目是“简单的”XML 文件。我这么说只是因为它们里面发生了很多事情。要了解它们的组成：创建一个空项目并在文本编辑器中打开 csproj（C#.NET 项目）或 vsproj（VB.NET 项目）。

然后，您可以通过代码生成此 XML 文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-07-31T13:41:31.733

对于 Visual Studio 2017，我找到了基于 envdte 的解决方案。您不需要 xml 操作，它使用 Visual Studio IDE。你可以在这里找到项目[Nager.TemplateBuilder](https://github.com/tinohager/Nager.TemplateBuilder)

# database - 仅使用连接字符串打开 Microsoft.practices.EnterpriseLibrary 数据库

> ID：401339
> 
> 赞同：2
> 
> 时间：2008-12-30T20:07:21.860
> 
> 标签：database, enterprise-library, database-connection, connection-string

我正在使用 Microsoft.Practices.EnterpriseLibrary 数据库工具，但*仅*使用连接字符串信息创建新数据库时遇到问题。

理想情况下，我想做以下事情：

```
Database dbEngine = DatabaseFactory.CreateDatabase(
    "Data Source=myServerAddress;Initial Catalog=myDataBase;Integrated Security=SSPI;"); 
```

是否可以仅使用连接字符串创建数据库？

如果是这样，如何实现？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-10-21T14:03:27.313

你也可以做

```
 Database mydb = new EnterpriseLibrary.Data.Sql.SqlDatabase("connection string here"); 
```

并且您将保留 Database 对象的多功能性，但使用连接字符串创建它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-07-28T18:38:08.937

我正在动态构建一个连接字符串，其中 ConnectionString 在我的 .config 中

```
 Database configdb = DatabaseFactory.CreateDatabase("ConnectionString");

                DbConnectionStringBuilder sb = configdb.DbProviderFactory.CreateConnectionStringBuilder();

                // Set the Connection String fields.

                sb["Data Source"] = targetServer; 
                sb["Initial Catalog"] = targetDb; 
                sb["User ID"] = username;
                sb["Password"] = password;
                sb["Connect Timeout"] = dbTimeout;

                GenericDatabase newDb = new GenericDatabase(sb.ToString(), configdb.DbProviderFactory);
Database db = newDb; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-31T23:24:05.487

呃......那是因为 CreateDatabase 需要连接字符串的*名称*（在您的应用程序的配置文件中指定），而不是连接字符串本身。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-05T12:08:18.927

我发现您可以使用以下命令...

```
SqlDatabase dbEngine = new SqlDatabase(connectionString); 
```

不像数据库对象那样通用，但它适用于我的目的。

谢谢大家！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-17T02:45:26.570

它解决了我的问题。我有一个使用多个数据库的单个 Web 应用程序，根据 url 中的不同子域连接到不同的数据库。如：

* * *

*   abc.test.com ------>使用 Db_projectABC

*   def.test.com ------>使用 db_ProjectDEF

* * *

我使用 url-rewrite 解析子域名，并使用子域名选择它存储在主数据库中的数据库连接字符串。

谢谢

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-28T06:51:02.323

```
Database objDatabase = new Microsoft.Practices.
                    EnterpriseLibrary.Data.Sql.SqlDatabase(@"Password=mypassword;Persist Security Info=True;User ID=sa;Initial Catalog=DatabaseName;Data Source=192.168.2.1"); 
      // Data Sourc is Your DB Name for ex : systemIp\\SqlExpress

            DbConnection objCon = objDatabase.CreateConnection();
            objCon.Open();
            objDbTransaction = objCon.BeginTransaction(IsolationLevel.ReadUncommitted);
            DbCommand cmd = objDatabase.GetSqlStringCommand(" Select sName from Emp");

            SqlDataReader dr = (SqlDataReader)objDatabase.ExecuteReader(cmd, objDbTransaction);

            StringBuilder sb = new StringBuilder();

            while (dr.Read())
            {
                sb.Append(Convert.ToString(dr[0]));
                sb.Append("  ");
            }
            objDbTransaction.Commit();
            objCon.Close();

            //objDatabase.DbProviderFactory.
            return sb.ToString(); 
```

# javascript - 获取 javascript src 位置/主机名

> ID：401342
> 
> 赞同：2
> 
> 时间：2008-12-30T20:08:43.900
> 
> 标签：javascript

当嵌入将对原始源进行回调但 js 驻留在不同域中的脚本时，是否有任何推荐的解决方案。有时其他客户端会在不同的域中，我不能依赖获取文档或窗口位置。

目前，我一直在使用这个，但对这个解决方案不太满意。

```
var host = window.location.hostname;
if(host.indexOf('.devols.') > -1){
  return (('https:' == document.location.protocol) ? 'https://' : 'http://') + host; // return dev or localhost
} else if(host.indexOf('.qaols.') > -1){
  return 'qa environment';        
} else {
  return 'prod environment';
} 
```

更新：

到目前为止，我一直在玩这个：

```
var scriptLocation = '';
var SCRIPT_NAME = 'example.js';
var scripts = document.getElementsByTagName('script');
for(var i=0;i<scripts.length;i++){
  var src = scripts[i].getAttribute('src');
  if(src){
    var index = src.lastIndexOf(SCRIPT_NAME);
    if((index > -1) && (index + SCRIPT_NAME.length == src.length)) {
      scriptLocation=src.slice(0, src.indexOf('/my_script_location/'));
      break;
    }
  }
}
return scriptLocation; 
```

因此，在页面通过脚本标签数组加载代码循环并确定位置之后，api 可以进行回调，而无需找出 url 等...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T20:28:52.970

您最好从服务器传递此信息并在提供页面时将其填充到 JavaScript 变量中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T20:31:12.043

如果在请求 JS 时指定了回调 URL 会怎样？因此，在您的脚本标签中执行以下操作：

```
<script type="text/javascript" src="http://foo/bar.js?caller=http://blah"></script> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T20:34:44.440

你所描述的违反了[相同的来源政策](http://en.wikipedia.org/wiki/Same_origin_policy)，所以我认为它不能单独使用 javascript 来完成。

# java - 用 Java 为诺基亚 n73 开发应用程序？

> ID：401345
> 
> 赞同：0
> 
> 时间：2008-12-30T20:09:21.450
> 
> 标签：java, symbian, nokia, n73

我试图找出在使用 S60 第二版、Java 中的 Feature Pack 3 SDK 为 n73 使用 SMS 编写器时是否可以开发一个关键捕获应用程序来分析写作风格？最初，我认为所有 Java 应用程序都会被沙盒化，因此很难调用 symbian 可用的本机密钥捕获功能，但没有人能够为我澄清这一点。它有任何真理吗？

谢谢，

一种

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T21:34:54.333

我将以用户的身份发言：Opera Mini（基于 Java 的应用程序）能够读取和写入用户数据（手机内存和存储卡）。

我还看到了访问硬件（如手机摄像头）的基于 Java 的应用程序，以及调用系统 API（如振动或声音通知）的应用程序。

但是，我不知道他们是如何实现这些东西的。

注 1：诺基亚 N73 基于 S60 第 3 版而非第 2 版。

注2：在某些情况下（例如访问用户数据），需要用户授权，除非应用程序使用证书进行签名。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T20:32:26.723

注意：这个答案来自我对这些事情了解更多的朋友。

* * *

正如这个[J2ME FAQ](http://www.j2meforums.com/wiki/index.php/FAQ#Can_I_access_the_phone.27s_j2me.3F_.28memory.2C_phone_book.2C_inbox.2C_pictures....29_.3F)所述，

> **我可以访问手机的 j2me 吗？** **（内存、电话簿、收件箱、** **图片...） ?**
> 通常不可以，这被认为是一种安全风险，大多数制造商都不允许这样做。但是，只有极少数人这样做，因此请查看他们的开发者网站。

所以那是没有的。无论如何，在 MIDP 库中都没有直接访问该数据的方法。然而，如果你很幸运，它可能是可能的，但不要指望它。根据 Sun 的说法，这可能在 MIDP3 中是可能的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T22:51:00.560

我刚刚开始使用我的诺基亚 6300 和 J2ME。这款手机支持 MIDP2 和 J2ME，但与 N73 不同 - 它是 40 系列，并且不使用 symbian 操作系统。

我想编写的应用程序之一需要使用电话簿，据我所知，这可以使用 PIM API (JSR-75)。

AFAIK 您实际上可以在 Symbian 下使用 C++ 访问 SMS 消息。试试[这个链接](http://www.forum.nokia.com/search/?eo=1&ea=1&k=SMS+access+symbian&submit=Search)

# nhibernate - Castle ActiveRecord / NHibernate 优化

> ID：401346
> 
> 赞同：0
> 
> 时间：2008-12-30T20:10:02.757
> 
> 标签：nhibernate, castle-activerecord

我有以下结构：消息（消息表）可能有多个字段（字段表），每个字段可能有多个子字段（存储在同一个“字段”表中，唯一的区别是字段在“父字段”中没有值柱子）。子字段可能有子子字段等，但这并不重要。

当我检索 10 条消息，每条消息有 10 个字段，每个字段有 20 个子字段时，我可以从日志文件中看到 NHibernate 生成了 2000 个 SQL 调用。有没有办法优化它？

谢谢！

这是 NHibernate 生成的 2000 条 SQL 语句之一：

```
SELECT   fieldresul0_.MessageResults_ID as MessageR6___2_, 
         fieldresul0_.ID as ID2_, 
         fieldresul0_.ID as ID5_1_, 
         fieldresul0_.Field_ID as Field2_5_1_, 
         fieldresul0_.Name as Name5_1_, 
         fieldresul0_.Value as Value5_1_, 
         fieldresul0_.MessagePosition as MessageP5_5_1_, 
         fieldresul0_.MessageResults_ID as MessageR6_5_1_, 
         fieldresul0_.ParentField_ID as ParentFi7_5_1_, 
         fieldresul1_.ID as ID5_0_, 
         fieldresul1_.Field_ID as Field2_5_0_, 
         fieldresul1_.Name as Name5_0_, 
         fieldresul1_.Value as Value5_0_, 
         fieldresul1_.MessagePosition as MessageP5_5_0_, 
         fieldresul1_.MessageResults_ID as MessageR6_5_0_, 
         fieldresul1_.ParentField_ID as ParentFi7_5_0_ 
FROM     FieldResults fieldresul0_ 
         LEFT OUTER JOIN FieldResults fieldresul1_ 
                      ON fieldresul0_.ParentField_ID=fieldresul1_.ID 
WHERE    fieldresul0_.MessageResults_ID=@p0 
ORDER BY fieldresul0_.MessagePosition 
```

这是 ActiveRecord 生成的映射文件：

```
<?xml version="1.0" encoding="utf-16"?> 
    <hibernate-mapping  auto-import="true" default-lazy="false" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:nhibernate-mapping-2.2">  
      <class name="FieldResult, Data" table="FieldResults"> 
        <id name="ID" access="property" column="ID" type="Int32" unsaved-value="0"> 
          <generator class="native">    
            <param name="sequence">FieldResults_ID</param>  
          </generator>  
        </id>   
        <property name="FieldID" access="property" type="String">   
          <column name="Field_ID"/> 
        </property> 
        <property name="Name" access="property" type="String">  
          <column name="Name"/> 
        </property> 
        <property name="DisplayValue" access="property" type="String">  
          <column name="Value"/>    
        </property> 
        <property name="MessagePosition" access="property" type="Int32">    
          <column name="MessagePosition"/>  
        </property> 
        <many-to-one name="ParentMessage" access="property" class="MessageResult, Data" column="MessageResults_ID" />   
        <many-to-one name="ParentField" access="property" class="FieldResult, Data" column="ParentField_ID" />  
        <bag name="Children" access="property" table="FieldResults" lazy="false" cascade="all" order-by="Field_ID"> 
          <key column="ParentField_ID" />   
          <one-to-many class="FieldResult, Data" /> 
        </bag>  
      </class>  
    </hibernate-mapping>` 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-09T12:39:38.433

我猜这是一个选择 n+1 的问题。您是否尝试过预先加载或自定义 HQL 查询？如果你还没有，我会发布一些示例 HQL 来解决这个问题

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-25T17:08:05.757

有一种方法可以帮助 nhibernate 执行一些更有效的连接。明确告诉查询处理器包含带有“join fetch”的查找表，并通过 HQL 和 Session.CreateQuery() 获取结果

```
from FieldRestults fr 
left join fetch fr.ParentMessage 
left join fetch fr.ParentField 
```

在我目前正在调查的另一个问题中优化包。

# c# - 如何构建 DataContractJsonSerialize 便利功能

> ID：401348
> 
> 赞同：1
> 
> 时间：2008-12-30T20:10:23.490
> 
> 标签：c#, json

我在我的 3-4 方法中有一个序列化类对象的通用代码，所以我正在考虑为该代码创建一个通用函数并在所有方法中调用函数

我是从以下代码中执行此操作的

```
DataContractJsonSerializer ser = new DataContractJsonSerializer(this.GetType());
MemoryStream ms = new MemoryStream();
ser.WriteObject(ms, this);

json = Encoding.Default.GetString(ms.ToArray());

ms.Close(); 
```

我想将此通用代码放在单独的通用函数中，该函数返回 Json 字符串并接受整个类作为输入参数，因为我将整个类转换为 Json 对象，我尝试创建类似的函数

公共字符串 GenerateJsonString(class C1)

但这给了我关于关键字“class”的错误，说该类型是必需的

谁能告诉我如何在单独的方法或函数中接受整个类对象

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T20:13:42.173

您将“类”与“对象”混淆了。您序列化一个对象，该对象是特定类（又名“类型”）的一个实例。

您可以为所有对象“object”创建一个采用 .NET 基类型参数的方法，如下所示：

```
public static string GenerateJsonString(object o) 
{
    DataContractJsonSerializer ser = new DataContractJsonSerializer(o.GetType());
    using (MemoryStream ms = new MemoryStream())
    {
        ser.WriteObject(ms, o);
        json = Encoding.Default.GetString(ms.ToArray());
        ms.Close();
        return json;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T20:14:43.200

将参数键入为“对象”。您不能将类作为参数传递，只能传递类的实例 - 在 OOP 中称为“对象”

```
public string GenerateJsonString(object obj) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T20:15:02.327

如果您传递给此方法的所有对象都是从公共基类派生的类的实例，那么您可以使用多态性并编写该方法来接受作为基类实例的对象。否则，所有类都派生自`System.Object`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T20:16:26.943

目前尚不清楚“类对象”是什么意思。如果您的意思是一个对象，那么像往常一样传递对该对象的引用确实会传递“整个对象”（嗯，对它的引用）。你可以得到所有的成员。

如果你想传递*类型*本身，你应该将参数声明为[Type](http://msdn.microsoft.com/en-us/library/system.type.aspx) - 但我怀疑这不是你想要的。

如果你想编写一个接受任何对象的方法，只需将参数声明为[Object](http://msdn.microsoft.com/en-us/library/system.object.aspx)类型：

```
public string GenerateJsonString(object x) 
```

顺便说一下，我个人不会使用`Encoding.Default`（这是系统特定的）将二进制文件转换为文本 - 序列化程序真正使用的是什么编码？它是否让您传入一个TextWriter（例如一个StringWriter）而不是一个流？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T20:13:51.767

你可以接受一个对象。类未实例化，因此无法传递给方法。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-30T20:13:28.460

尝试使用类型而不是类

```
public string GenerateJsonString(Type t1) 
```

# sql-server - 如何在 Linux 中为 ODBC 创建 DSN？

> ID：401358
> 
> 赞同：21
> 
> 时间：2008-12-30T20:14:41.063
> 
> 标签：sql-server, linux, odbc, dsn

我正在研究一个据称使用 DSN 连接到 SQL Server 的 Linux 应用程序。连接停止工作，我找不到正在使用的凭据（我只知道 DSN 的名称）。

我熟悉 Windows 中的 DSN，但它们是如何创建的以及它们在 Linux 中的存储位置？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-05-17T13:17:29.730

对于 unixODBC，DSN 列在`/usr/local/etc/odbc.ini`. 已安装的 ODBC 驱动程序将列在`/usr/local/etc/odbcinst.ini`.

尝试：

```
usr$ find . -iname 'odbc*.ini' 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-30T20:34:33.130

只需查找您的 odbc.ini 文件。默认情况下它应该在 /etc 下，但我猜它可能因一种 Linux 风格而异。

[这](http://www.easysoft.com/products/data_access/odbc-sql-server-driver/getting-started.html)是 Linux/Unix 的通用指南。

希望这可以帮助。

# asp.net - 网站设计 - 仅更改正文内容

> ID：401366
> 
> 赞同：0
> 
> 时间：2008-12-30T20:16:35.163
> 
> 标签：asp.net, templates, layout

目前我正在设计一个新网站，我想妥善规划它。

主页由顶部内容（包括徽标等的标题）和左侧菜单的主体和页面末尾的页脚组成。

在菜单中，我有 50 页，我只想更改它的正文内容。

复制所有页面（甚至是 ASP.NET 代码）是不值得的。

肯定有更好的方法来做到这一点。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T20:21:10.037

大卫，您正在寻找的是 MasterPage：

[http://quickstarts.asp.net/QuickStartv20/aspnet/doc/masterpages/default.aspx](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/masterpages/default.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T20:23:25.307

我不确定您在寻找什么，因为例如，您没有提到 50 页是否几乎相同，换句话说，只有内容（字母）发生了变化？你可以做几件事。

我会去，因为我做 .NET，在 ASP.NET 中使用[MasterPages](http://www.asp.net/learn/videos/video-09.aspx)，你用所有图形设计布局，就像它是一个模板一样，并在你提到的“正文”部分放置一个“占位符”，你只创建50 页的内容，但你没有写任何与“模板”相关的内容

您可以创建一个 Web 2.0 感觉并放置一个 DIV，您可以替换为通过 AJAX 调用内容

也许您使用其他类型的语言并使用模板

有“百万”方法可以做“一切”:) 没有更多，我无法告诉你什么是好主意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T20:21:24.420

使用页面模板（在 ASP.NET 中也称为[母版页）。](http://msdn.microsoft.com/en-us/library/wtxbf3hh.aspx)更好的是，使用 MVC 框架。我个人最喜欢的是[Spring.NET](http://www.springframework.net/)，但还有其他的......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T20:21:52.937

如果您还没有这样做，我建议您从表单中拆分内容。这方面的一个例子是将您的内容放在一个文件中，并让它在另一个文件中引用 CSS 样式来定义它的外观。这样您就可以随意更改内容，而不必重做所有样式。

一个很好的网站就是[CSS Zen Garden](http://www.csszengarden.com/)。

# asp.net-mvc - asp.net mvc 将控制器放入单独的项目中

> ID：401376
> 
> 赞同：107
> 
> 时间：2008-12-30T20:19:35.453
> 
> 标签：asp.net-mvc

我只是在学习 asp.net mvc，我正试图弄清楚如何将我的控制器移动到一个单独的项目中。通常，当我之前设计过 asp.net web 应用程序时，我为我的模型创建了一个项目，为我的逻辑创建了另一个项目，然后就是 web。

现在我正在学习 asp.net mvc，我希望遵循类似的模式，并将模型和控制器分别放入各自单独的项目中，并将视图/脚本/css 留在网络中。模型部分很简单，但我不明白的是如何让我的控制器在一个单独的项目中被“找到”。另外，我想知道这是否可取。谢谢！

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-12-30T20:57:53.003

首先，将您的模型放到一个单独的项目中当然是个好主意。正如您所发现的，这是微不足道的。

关于控制器和视图，对于大多数基本项目，我认为将它们分开没有任何明显的优势，尽管您可能在特定应用程序中特别需要这样做。

如果您确实选择这样做，那么您将需要告诉框架如何找到您的控制器。执行此操作的基本方法是提供您自己的 ControllerFactory。您可以查看 DefaultControllerFactory 的源代码，以了解这是如何完成的。对此类进行子类型化并覆盖 GetControllerType(string controllerName) 方法可能足以完成您的要求。

创建自己的自定义 ControllerFactory 后，将以下行添加到 global.asax 中的 Application_Start 以告诉框架在哪里找到它：

```
ControllerBuilder.Current.SetControllerFactory(new MyControllerFactory()); 
```

**更新：**阅读[这篇文章](http://codeclimber.net.nz/archive/2008/11/14/how-to-call-controllers-in-external-assemblies-in-an-asp.net.aspx "如何在 ASP.NET MVC 应用程序的外部程序集中调用控制器") *及其*链接到的文章以获取更多信息。另请参阅 Phil Haack 对该帖子的评论：

```
ControllerBuilder.Current.DefaultNamespaces.Add(
    "ExternalAssembly.Controllers"); 
```

...这不是一个完整的解决方案，但对于简单的情况可能已经足够了。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2013-02-13T23:34:56.563

虽然创建自己的 ControllerFactory 是合理的，但我发现在每个项目中定义我的所有 Controller 更方便，但从我的 Shared 项目中的 Controller 派生它们：

```
namespace MyProject1.Controllers
{
   public class MyController : MySharedProject.Controllers.MyController
   {
      // nothing much to do here...
   }
}

namespace MySharedProject.Controllers
{
   public abstract class MyController : System.Web.Mvc.Controller
   {
      // all (or most) of my controller logic here...
   }
} 
```

这具有额外的好处，您可以放置​​不同项目的控制器逻辑。此外，其他开发人员更容易快速找到您的 Controller 逻辑，因为 Controller 存在于标准位置。

关于这是否可取，我认为绝对是。我创建了一些常见的帐户管理逻辑，我想在具有不同业务逻辑的项目之间共享这些逻辑。所以我共享我的帐户和管理控制器，但其他控制器特定于他们各自的项目。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-07-02T15:52:36.890

*   为您的 mvc 项目添加类库。
*   在类中添加以下代码（对于您的控制器代码）

    ```
    namespace ContactController
    {
    public class ContactController : Controller
    {
        public ActionResult Call()
        {
            ViewBag.Title = "Inside MyFirst Controller.";
            return View();
        }
    } 
    ```

    }

*   在 mvc 项目视图文件夹中添加 Contact 文件夹并创建 Call.cshtml 文件。 ![查看文件夹](https://i.stack.imgur.com/Gfl9Z.png)

*   将类库项目引用添加到您的主 MVC 项目中。

![参考](https://i.stack.imgur.com/qqT0i.png)

*   最后将联系人控制器命名空间引用到 Route Config 中。

![路由配置](https://i.stack.imgur.com/RVUxw.png)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-07-09T08:16:40.783

更新 NuGet 参考后我的问题解决了，`System.Web.Mvc`因此 MvcWebsite 和类库使用相同的`System.Web.Mvc`版本

无需添加默认命名空间

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-11-26T05:52:14.883

我使用的最简单的分离形式是在原始 MVC 项目中“按原样”保留视图，但删除控制器。然后在一个新的 ClassLibrary 项目中添加 Controller 类并确保它们继承自 Controller。

MVC 路由引擎将自动路由到 ClassLibrary 中的控制器，并且控制器将自动从原始 MVC 项目构建视图，前提是您有正确的引用和使用。

我正在使用这种架构来实现一个 Html Reports 模块，该模块可以与主解决方案分开编译和部署。我终于摆脱了SSRS！

# cocoa-touch - 使用 UINavigationController 时释放对象

> ID：401389
> 
> 赞同：1
> 
> 时间：2008-12-30T20:22:51.577
> 
> 标签：cocoa-touch

我正在使用 UINavigationController 并且在推送新视图时无法释放对象。我想在推送之前在新控制器上设置一个对象。我目前这样做的方式是：

```
OpenPageViewController *varOpenPageController = [[OpenPageViewController alloc] initWithNibName:@"OpenPageViewController" bundle:nil];
varOpenPageController.bookObj = bookObj;
[[self navigationController] pushViewController:varOpenPageController animated:YES];
//[varOpenPageController release]; 
```

如果我取消注释最后一行，那么当我在整个控制器中导航回来时程序会崩溃。我还有另一个关于何时/如何释放对象的问题。在 bookObj 中，我有一个可变的 Page 对象数组，我想更改当前页面对象的文本。我这样做：

```
Page *pageObj = [[bookObj pagesArray] objectAtIndex:currentPage];
pageObj.page_Text = textView.text;
[[bookObj pagesArray] replaceObjectAtIndex:currentPage withObject:pageObj];
//[pageObj release]; 
```

如果我取消最后一行的注释，程序就会崩溃。它会让我向前导航，但是当我向后导航并尝试再次前进时，它会崩溃。

自动释放对象会带来类似的结果。可以的话请指教。谢谢。

编辑：当我发布第一个示例 varOpenPageController 并使用 Leaks 运行模拟器时，程序似乎运行正常。但是，如果我不运行 Leaks，它就会崩溃。有谁知道为什么会发生这种情况？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T20:51:56.137

阅读[Apple 内存管理文档](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)可能会有所帮助。您不需要释放 pageObj 的第二项，因为它只包含对 bookObj 数组中实际项的引用。如果有意义的话，这不是实际的项目。因此，您实际上所做的是从数组中释放实际项目，因此当您返回并尝试访问它时，它不存在。

经验法则是：只发布您创建的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T20:58:22.317

您将视图控制器推送到导航控制器的第一个示例在发布时是正确的。如果当你回来的时候崩溃了，这可能意味着你在 OpenPageViewController 的 dealloc 方法中有问题，但是导航控制器保留了你的视图控制器，你应该确保在推送后释放它（如果你有像在代码中那样分配视图控制器实例）。

# java - Java 中的“动态”转换

> ID：401415
> 
> 赞同：5
> 
> 时间：2008-12-30T20:31:39.500
> 
> 标签：java, inheritance, casting

大家好，

想知道是否有任何 Java 黑客可以告诉我为什么以下方法不起作用：

```
public class Parent {
    public Parent copy() {
       Parent aCopy = new Parent();
       ...
       return aCopy;
    }
}

public class ChildN extends Parent {
    ...
}

public class Driver {
     public static void main(String[] args) {
         ChildN orig = new ChildN();
         ...
         ChildN copy = orig.getClass().cast(orig.copy());
     }
} 
```

代码很高兴编译，但决定在运行时抛出 ClassCastException D=

**编辑：**哇，真的很快回复。多谢你们！所以看来我不能使用这种方法进行向下转换......还有其他方法可以在 Java 中进行向下转换吗？我确实考虑过让每个`ChildN`类都覆盖`copy()`，但并不热衷于添加额外的样板代码。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-30T20:39:06.663

就像尝试这样做：

```
 public Object copy(){
       return new Object();
  } 
```

然后尝试：

```
 String s = ( String ) copy(); 
```

您的*Parent*类和*ChildN类与**Object*和*String*具有相同的关系

 *要使其工作，您需要执行以下操作：

```
public class ChildN extends Parent {
    public Parent copy() {
        return new ChildN();
    }
} 
```

也就是说，重写“复制”方法并返回正确的实例。

* * *

**编辑**

根据您的编辑。这实际上是可能的。这可能是一种可能的方式：

```
public class Parent {
    public Parent copy() {
        Parent copy = this.getClass().newInstance();
        //...
        return copy;
    }
} 
```

这样您就不必在每个子类中重写“复制”方法。这就是原型设计模式。

然而，使用这个实现你应该知道两个检查异常。这是编译和运行没有问题的完整程序。

```
public class Parent {
    public Parent copy()  throws InstantiationException, IllegalAccessException  {
       Parent copy = this.getClass().newInstance();
       //...
       return copy;
    }
}
class ChildN  extends Parent {}

class Driver {
     public static void main(String[] args) throws  InstantiationException ,  IllegalAccessException  {
         ChildN orig = new ChildN();
         ChildN copy = orig.getClass().cast(orig.copy());
         System.out.println( "Greetings from : " + copy );
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-30T20:34:22.600

演员们正在有效地尝试这样做：

```
ChildN copy = (ChildN) orig.copy(); 
```

（它正在计算要在执行时执行的强制转换，但这就是它将是因为`orig.getClass()`will be `ChildN.class`）但是，`orig.copy()`它不返回 ChildN 的实例，它返回 just 的实例`Parent`，因此不能强制转换为`ChildN`.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-30T20:35:04.657

如果 ChildN 没有覆盖 copy() 以返回 ChildN 的实例，那么您正在尝试将 parent 类型的对象向下转换为 ChildN 类型

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T20:42:50.710

如果 Class#isInstance() 返回 false，java.lang.Class#cast(Object) 会抛出 ClassCastException。从该方法的javadoc：

> 确定指定的 Object 是否与该 Class 表示的对象赋值兼容。这个方法是 Java 语言 instanceof 操作符的动态等价物... 具体来说，如果这个 对象表示一个声明的类，那么如果指定的 参数是表示的类（或其任何子类）的实例，则`Class`该方法返回 ；否则它会返回 。`true``Object``false`

由于 Parent 不是 child 的子类，因此 isInstance() 返回 false 所以 cast() 抛出异常。这可能违反了最小惊讶的原则，但它的工作方式与记录的方式相同 - cast() 只能向上转换，不能向下转换。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-31T01:15:38.053

难道你只是想要你的对象的副本/克隆。

在这种情况下，实现 Cloneable 接口并根据需要覆盖 clone()。

```
public class Parent implement Cloneable {
   public Object clone() throws CloneNotSupportedException {
     Parent aCopy = (Parent) super.clone();
   ...
   return aCopy;
   }
}

public class ChildN extends Parent {
    ...
}

public class Driver {
     public static void main(String[] args) {
         ChildN orig = new ChildN();
         ...
         ChildN copy = orig.getClass().cast(orig.clone());
     }
} 
```

这正是您的“copy()”方法试图以 Java 方式执行的操作。

（是的，你也可以做花哨的内省游戏，但是一旦你没有公共的默认构造函数，这些方法就会失败或变得丑陋。无论你有什么构造函数，克隆在任何情况下都有效。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-31T21:08:18.520

（无法在评论中添加代码，所以我会在这里添加）

关于 Cloneable：如果您正在实施 Cloneable，请按如下方式实施；打电话更干净...

```
public class Foo implements Cloneable {
    public Foo clone() {
        try {
            return (Foo) super.clone();
        } catch (CloneNotSupportedException e) {
            return null; // can never happen!
    }
} 
```

[编辑：我也看到其他人使用

```
throw new AssertionError("This should never happen! I'm Cloneable!"); 
```

在 catch 块中。]

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-04T17:41:16.243

向下转换不起作用的原因是，当您将父对象转换为子类型时，您无法在父对象上调用子类型的方法。但它以另一种方式工作......

# openvg - OpenVG 实现？

> ID：401422
> 
> 赞同：29
> 
> 时间：2008-12-30T20:34:39.603
> 
> 标签：openvg

存在哪些 OpenVG 实现？

它们各自的优缺点是什么？

我正在寻找的是一种高度稳定、快速的渲染实现，它仍在积极维护和开发中。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-01T21:10:23.713

我已经使用过一些 OpenVG，并且没有很多实现。我碰巧使用[了 ShivaVG](http://ivanleben.blogspot.com/2007/07/shivavg-open-source-ansi-c-openvg.html)，它使用了 OpenGL，但它已经有一段时间没有更新了 其他一些实现包括：

*   [参考实现](http://www.khronos.org/registry/vg/) （我发现它非常慢；但是，目前还没有其他版本达到 1.1（OpenVG 1.1 标准于 12 月初发布）

*   [GingkoVG](http://www.hygraphics.com/) - 仅二进制并使用它自己的窗口系统（但是，无论如何，它们都这样做）。

*   [AmanithVG](http://www.amanith.org/project.html) - 商业；看起来很漂亮。我想曾经有一个免费版本，但我似乎无法找到它。

*   [KompazzVG/AntigrainVG](http://kaarthik.wordpress.com/category/kompazzvg/) - 使用 AGG 的实现；看起来很棒，但是作者没有公开发布任何代码，虽然有一个项目站点和一个神秘的 svn 主干。

请注意，这些都是桌面的实现；我不确定移动设备上的实际硬件支持是什么。

就个人而言，我认为 ShivaVG 是最好的，因为它支持足够的功能来完成大多数事情，而且速度很快。有一些未修复的错误，但是，嘿，源代码是开放的。

顺便说一句，ShivaVG 的 SF 网站在[这里](http://sourceforge.net/projects/shivavg)；您可能希望使用主干版本，而不是编号版本，因为它稍微更新一些。KompazzVG 树干也可能在[这里](http://svn.assembla.com/svn/kompazz/kvg/)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-08-18T00:30:28.487

MonkVG 是一个类似于 OpenVG 1.1 的矢量图形 API 实现，目前使用 OpenGL ES 后端，应该与任何支持 OpenGL ES 2.0 的硬件兼容，包括大多数 iOS 和 Android 设备。

这是一个开源 BSD 许可项目，正在积极开发中。在撰写本文时，它处于非常早期的预发布状态（实现的功能非常少）。欢迎贡献者和赞助商。

它可以在 GitHub [http://github.com/micahpearlman/MonkVG找到](http://github.com/micahpearlman/MonkVG)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T14:49:36.090

**[AmanithVG](http://www.amanithvg.com "番石榴")** SRE（软件光栅化引擎）和 GLE（OpenGL ES 辅助光栅化引擎）都实现了整个 OpenVG 1.1 和 OpenVG 1.0.1 功能集。

两种引擎的评估版本都可以在**[AmanithVG 网站](http://www.amanithvg.com)**上下载。

AmanithVG 内部测试套件结果以及测试源可在**[GLE 测试页面](http://www.amanithvg.com/testsuite/amanithvg_gle/html)**和**[SRE 测试页面浏览](http://www.amanithvg.com/testsuite/amanithvg_sre/html)**。

AmanithVG SRE 和 GLE 可用于以下目标平台：

Windows 2000 / XP / Vista，在 x86、x86_64 上；

Windows CE / Mobile，在 ARM v5、v6 上（带或不带 VFP）；

MacOS X 10.4 / 10.5，PowerPC，Intel（通用二进制）；

Linux 2.6.x、x86、x86_64、PowerPC、ARM v5、v6（带或不带 VFP）、SH4；

x86、PowerPC、ARM v6、SH4 上的 QNX 6.4.x。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T22:00:44.500

感谢您的帖子。DL，您的列表非常全面，因为目前对 OpenVG 的支持并不多。我发现的另一种实现是：

*   [Zack Rusin: OpenVG](http://zrusin.blogspot.com/2007/01/openvg_116899762231694078.html) - 这个实现是用 Qt 的 OpenGL 实现构建的。与 ShivaVG 一样，它已经有一段时间没有更新了，但它也是开源的。

我将把它公开，并希望我们在未来得到更多关于其他实现的反馈。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-01-01T08:37:36.727

似乎没有人对此了解很多，我承认我也不知道。我和任何人一样受谷歌的约束。首先要看的地方似乎是[Khronos](http://www.khronos.org/developers/resources/openvg/)和[Wikipedia](http://en.wikipedia.org/wiki/OpenVG)

# .net - 使用托管 C++ (.NET 2.0) 的自动构建工具

> ID：401431
> 
> 赞同：3
> 
> 时间：2008-12-30T20:37:05.807
> 
> 标签：.net, .net-2.0, build-process, nant

我正在为自动化构建过程奠定基础，并试图确保我走上正确的道路。我们的代码库是托管/非托管 C++ 的混合体。托管部分位于 .NET 2.0 中，所有项目都是 Visual Studio 2005 解决方案的一部分。

现在我正在查看 NAnt，但我不知道如何执行构建。当我尝试使用标签构建时，它会吐出一个错误：

> 不支持 Microsoft Visual Studio.NET 2005 解决方案。

我觉得我只是从错误的方向来解决这个问题。谁能指出我正确的？

PS 我也想在构建过程中运行 doxygen，但我假设我选择的任何工具都至少允许我将它作为 shell 命令运行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T20:41:37.327

MSBuild 有什么问题？你所有的项目都已经在使用它，它是一个很好的产品，而且它是免费的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T18:05:13.153

我们从 VS003、VS2005 开始使用 NAnt，现在使用 VS2008（尽管 VS2008 和 .net 3.5 需要最新版本的 NAnt 0.86+）所以回答您的第一个问题，是的，NAnt 可以正常工作。

这是一个可以帮助您入门的模板：

```
<?xml version="1.0"?>
<project name="Test Build" default="build" xmlns="http://nant.sf.net/release/0.85-rc4/nant.xsd">

<property name="target" value="rebuild" overwrite="false" />
<property name="configuration" value="debug" overwrite="false" />
<property name="projectName" value="MyProject.sln"/>

<target name="build" description="Build all targets.">
    <call target="build.MyProject"/>
</target>

<target name="build.MyProject">
    <exec program="MSBuild" failonerror="true" commandline="/t:${target} /p:Configuration=${configuration} ${projectName}" />
</target>

</project> 
```

最后确保在运行 VS2005 构建时您的环境设置正确：

构建.bat：

```
call "C:\Program Files\Microsoft Visual Studio 8\VC\vcvarsall.bat" x86
"C:\Program Files\NANT\bin\NAnt.exe" -t:net-2.0 -logfile:buildlog.txt %* 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-31T20:24:19.983

想想看，MSBuild for VS2005 (8.0) 并不*完全*支持 VC++。根据项目组合的不同，使用 MSBuild 时可能会遇到问题，因为它直接调用[VCBuild](http://msdn.microsoft.com/en-us/library/hw9dzw3c(VS.80).aspx)进行本地项目（可以在[msdn 论坛](http://www.google.com/search?hl=en&q=site%3Asocial.msdn.microsoft.com+msbuild+vc%2B%2B+2005&btnG=Search)中看到）。

因此，根据项目的不同，MSBuild 或 VCBuild 都可以解决问题。要留在 NAnt 中，可以使用 exec 任务直接使用 MSBuild 或 VCBuild。

如果在 VS2008（.NET 3.5 框架）中，MSBuild 确实有一个[VCBuild 任务](http://msdn.microsoft.com/en-us/library/8xcy2245.aspx)。然后，您可以使用 NAnt 的最新（.86 beta 1 版本）[，](http://nant.sourceforge.net/)结合[NAntContrib](http://nantcontrib.sourceforge.net/)（提供 msbuild 任务）来获得 3.5 支持。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T20:47:37.457

您可以使用 C++ 进行巡航控制：

[http://confluence.public.thoughtworks.org/display/CC/UsingCruiseControlWithCplusPlus](http://confluence.public.thoughtworks.org/display/CC/UsingCruiseControlWithCplusPlus)

我们使用 make/cron 和一些自制脚本进行跨平台构建，它完成了这项工作（包括运行单元测试）——尽管报告有点粗鲁

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T20:36:49.833

Kinook 有一个很好的产品，叫做[Visual Build](http://www.kinook.com/VisBuildPro/features.html)，它可以满足您的需求。

# .net - 如何使用生成器遍历树结构？

> ID：401432
> 
> 赞同：5
> 
> 时间：2008-12-30T20:37:41.860
> 
> 标签：.net, recursion, iterator, generator, yield

我试图弄清楚如何在树节点中实现一个函数，该函数返回其所有后代叶子（无论是直接的还是间接的）。但是，我不想传递将递归放置叶节点的容器（树可能很大），而是我想使用生成器来遍历树。我尝试了几种方法，但到目前为止没有一种方法有效。这是我最接近可能的解决方案的一个：

```
 public interface ITreeNode
    {
        IEnumerable<ITreeNode> EnumerateLeaves();            
    }

    class Leaf : ITreeNode
    {
        public IEnumerable<ITreeNode> EnumerateLeaves()
        {
            throw new NotImplementedException();
        }
    }

    class Branch : ITreeNode
    {
        private List<ITreeNode> m_treeNodes = new List<ITreeNode>();

        public IEnumerable<ITreeNode> EnumerateLeaves()
        {
            foreach( var node in m_treeNodes )
            {
                if( node is Leaf )
                    yield return node;
                else
                    node.EnumerateLeaves();
            }
        }
    } 
```

但这也不起作用。我究竟做错了什么？如果同一个函数中有一个 yield 语句，似乎递归调用 .EnumerateLeaves 将不起作用。

任何帮助将不胜感激。提前致谢。

编辑：我忘了提到一个分支可以有叶子或分支作为孩子，因此递归。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-30T20:40:26.847

下面是你应该如何实现 Branch.EnumerateLeaves：

```
public IEnumerable<ITreeNode> EnumerateLeaves()
{
    foreach( var node in m_treeNodes )
    {
        if( node is Leaf )
            yield return node;
        else
        {
            foreach (ITreeNode childNode in node.EnumerateLeaves())
                yield return childNode;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T20:44:33.920

lassevk 是正确的——但是，该方法的一个潜在问题是递归调用可枚举对象可以产生 O(n^2) 性能。如果这是一个问题，那么您应该将递归分解并使用内部堆栈。

```
public IEnumerable<ITreeNode> EnumerateLeaves()
{
    Stack<ITreeNode> workStack = new Stack<ITreeNode>(m_treeNodes);

    while(workStack.Count > 0) {
        var current = workStack.Pop();
        if(current is Leaf)
            yield return current;
        else {
            for(n = 0; n < current.m_treeNodes.Count; n++) {
                workStack.Push(current.m_treeNodes[n]);
            }
        }
    }
} 
```

这应该执行相同的功能，没有递归。

编辑：[Daniel Plaisted](https://stackoverflow.com/users/1509/daniel-plaisted)在评论中发表了关于递归调用枚举器的更大问题的评论，总结在[MSDN 博客上关于迭代器](http://blogs.msdn.com/wesdyer/archive/2007/03/23/all-about-iterators.aspx)的帖子中。谢谢丹尼尔。=)

另一个编辑：永远记住，代码的简单性可能比性能更重要，特别是如果您希望其他人维护您的代码。如果您不希望您的树长得很大，请使用他的答案中概述的递归方法 lassevk 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T21:11:12.493

其他答案是正确的，但是通过递归调用在 foreach 循环内返回 yield 的模式将使遍历树的运行时间类似于 O（节点数 * 节点的平均深度）。有关该问题的更多详细信息，请参阅[此博客文章](http://blogs.msdn.com/wesdyer/archive/2007/03/23/all-about-iterators.aspx)。

这是对运行时和内存使用都有效的生成器的尝试：

```
class Node
{
    List<Node> _children;

    public bool IsLeaf { get { return _children.Count == 0; } }

    public IEnumerable<Node> Children { get { return _children; } }

    public IEnumerable<Node> EnumerateLeaves()
    {
        if (IsLeaf)
        {
            yield return this;
            yield break;
        }

        var path = new Stack<IEnumerator<Node>>();

        path.Push(Children.GetEnumerator());

        while(!path.Empty)
        {
            var cur = path.Pop();
            if (cur.MoveNext())
            {
                path.Push(cur);
                if (cur.IsLeaf)
                {
                    yield return cur;
                }
                else
                {
                    path.Push(cur.Children.GetEnumerator());
                }
            }

        }
    }

} 
```

# asp.net - 在链接中使用绝对路径时的开发问题（由于友好的 url）

> ID：401436
> 
> 赞同：0
> 
> 时间：2008-12-30T20:40:32.353
> 
> 标签：asp.net, asp.net-2.0, friendly-url

我使用 urlrewriter.net 来实现友好的 url。当我进行重写时，我有时会使用子文件夹。

我发现自己在使用图像和链接时遇到了问题，而且 ~ 符号对我不起作用。读了一点后，我发现我不是唯一一个有这个问题的人，他们建议使用完整路径“www.website.com/images/x.jpg”等。现在，我无法开发和 QA，因为所有的链接去我真正的在线网站。

我能做些什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T20:45:11.097

如果 URL 前缀是您唯一关心的问题，您是否考虑过在 web.config 中为 URL 前缀添加一个键，然后以这种方式动态生成图像的路径？

通过这样做，您可以在完成后轻松地将所有代码迁移到生产环境，然后只需更新 web.config 以将所有内容指向正确的服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T20:55:57.907

~ only works with ASP.NET Web Controls, not standard HTML controls.

A similar problem is when you have content pages (located in subfolders) referencing a masterpage in the application root. You need to use Image and Hyperlink controls in the MasterPage since the files are referenced from the location of the content page.

<asp:Image ID="Image1" runat="server" ImageUrl="~/images/Test.png" AlternateText="" />

<asp:HyperLink ID="HyperLink1" runat="server"NavigateUrl="~/Test.aspx">HyperLink</asp:HyperLink>

# windows - Expression Web：快捷方式不指向exe文件，但我想用它来编辑

> ID：401440
> 
> 赞同：0
> 
> 时间：2008-12-30T20:43:25.703
> 
> 标签：windows, editor, exe, shortcut, lnk

**问题：**我必须支持需要编辑网页的用户。其中一些网页仅作为 textarea 控件存在。幸运的是，有一个 firefox 插件允许用户在默认文本编辑器中打开 textarea。不幸的是，这个插件需要你指向你想要调用的文本编辑器的 EXE 文件。

这是一个合理的要求，但@#$%^ Microsoft Expression Web 是那些快捷方式 .lnk 文件似乎没有指向真正的 EXE 文件的应用程序之一。如果某处有 EXE 文件，则它是隐藏的。

**问题：** 如何找到实际的 EXE 文件，以便人们可以将 Microsoft Expression Web 配置为他们选择的编辑器？

**更新：**我应该强调我正在寻找一种通过脚本或批处理文件自动执行此操作的方法（因此发布了 SO，以防任何人的“与编程无关”的蜘蛛侠感觉刺痛）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T20:50:55.250

我在以下位置找到了我的可执行文件：

```
C:\Program Files\Microsoft Expression\Web Designer\EXPRWD.EXE 
```

我不确定这是否能满足您的需求，但您始终可以让您的用户（或以编程方式）搜索 EXPRWD.EXE 并从那里开始。

# c# - C#：在 VS 表单设计器中将控件从表单移动到 tabPage

> ID：401441
> 
> 赞同：4
> 
> 时间：2008-12-30T20:43:30.273
> 
> 标签：c#, winforms, visual-studio-2005, windows-forms-designer

我决定更改我正在开发的实用程序以使用标签页。当我尝试将各种控件从表单拖到表单顶部的选项卡页时，它会复制控件，并为其赋予不同的名称。只需在选项卡顶部重新制作表单或仅在设计器中编辑源代码以将所有内容都添加到选项卡中，这很容易（这就是我所做的，有效），但似乎可能会有成为通过 gui 执行此操作的更好方法。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-31T14:35:24.167

正确的工具是文档大纲 (CTRL+W, U)。只需在大纲中拖动您的一组控件，使其位于选项卡页下。瞧。

文档大纲极大地简化了这些类型的操作，尤其是在您处理复杂布局时。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T20:59:33.767

您是否尝试过剪切和粘贴。这通常对我有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T21:47:54.823

你的控制键卡住了。拖动控件时不要按控制键。

我一直将控件从表单控件拖到标签页控件没有问题。答案＃1是完全正确的。

您可以使用“文档大纲”窗口，通过拖动树节点将控件一一移动到标签页。

最难的问题是在标签页上保留控制位置。

# asp.net - 使用友好 url 时相对链接的问题

> ID：401443
> 
> 赞同：4
> 
> 时间：2008-12-30T20:43:33.673
> 
> 标签：asp.net, asp.net-2.0, friendly-url

我正在使用 urlrewiter.net 来实现友好的 url。这是一个很棒且易于使用的软件包！

然而，在使用子文件夹时，我在图像和其他内页的相对链接方面遇到了问题。

我尝试使用 ~ （服务器端），但没有成功。还有其他解决方案吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-17T05:04:43.397

由于这些问题，我开始总是给出相对（到根）URL，所以假设你有一个 images 子目录：

[http://www.contoso.com/images/blah.jpg](http://www.contoso.com/images/blah.jpg)

你总是通过“/images/blah.jpg”来引用它。无论基本页面/上下文是什么，该图像都可以访问。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T20:49:14.020

您可能应该对您的网站进行分段，以便静态元素（图像、css 等）与动态生成的 url 位于不同的位置。我过去广泛使用过 URlRewriter，效果很好，但是我们的网站是这样设置的，因此我们的资源是这样分段的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-28T03:41:18.813

您可以简单地将基本标记添加到您的 HTML 标头中。这将强制浏览器使用指定的位置来解析相对链接。也许这篇文章会对你有所帮助：[SEO-Friendly URLs and Relative Links](http://blog.pumka.net/2009/12/24/seo-friendly-urls-and-relative-links/ "SEO 友好的 URL 和相对链接")

# dns - 跨域故障转移设计，DNS 级故障转移？

> ID：401444
> 
> 赞同：11
> 
> 时间：2008-12-30T20:43:37.403
> 
> 标签：dns, distributed, failover, redundancy

我对 web 应用程序的跨 colo 故障转移策略感兴趣，这样如果主站点发生故障，用户可以无缝地登陆另一个 colo 的故障转移站点。

事物的应用程序方面看起来主要是通过在 colo 和服务之间的主从数据库设置来解决的，这些服务旨在恢复并能够在中途获取。我试图找出将流量从主站点转移到故障转移站点的策略。DNS 故障转移，即使 TTL 较低，似乎也有[相当长的延迟](http://blog.pyromod.com/2007/09/viability-of-dns-failover.html)。

假设主 colo 的服务器无法访问，您会推荐哪些策略来在 colo 之间快速移动流量？

如果您有其他关于跨域故障转移的有趣经验/智慧之言，我也很想听听这些。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T20:53:54.057

基于 DNS 的机制很麻烦，即使您在区域文件中放置了低 TTL。

原因是许多应用程序（例如 MSIE）维护自己的缓存，忽略 TTL。其他软件将执行单个`gethostbyname()`或等效调用并存储结果，直到程序重新启动。

更糟糕的是，众所周知，许多 ISP 的递归 DNS 服务器会忽略低于其首选最小值的 TTL，并强加自己更高的 TTL。

最终，如果站点要从两个数据中心运行**而不**更改其 IP 地址，那么您需要通过全球 BGP4 路由公告查看“多宿主”的安排。

使用多宿主，您需要至少获得一个“独立于提供商”（又名“PI”）IP 地址空间的 /24 网络块，然后只有在主站点离线时才从备份站点向全局路由表公布。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T23:13:35.460

至于 DNS，我喜欢参考[“为什么基于 DNS 的全局服务器负载平衡不起作用”](http://www.tenereillo.com/GSLBPageOfShame.htm)。对于其他一切——**使用 BGP**。

使用 BGP 设计网络以实现负载平衡仍然不是一件容易的事，我本人当然不是这方面的专家。它也比 Wikipedia 可以告诉你的更复杂，但是网上有几篇有趣的文章详细说明了它是如何完成的：

*   [BGP 网络中的负载平衡](http://www.nil.com/ipcorner/LoadBalancingBGP/)
*   [单宿主和多宿主环境中的负载共享](http://www.cisco.com/en/US/tech/tk365/technologies_configuration_example09186a00800945bf.shtml&ei=J6paSdLWGImt-gaWw9zIDw&usg=AFQjCNEzy-efYEPONiP6MKqUuAwNkgxVmw)

如果您搜索 BGP 和负载平衡，总会有更多。网上还有几份白皮书描述了 Akamai 如何进行全局负载平衡（我相信它也是 BGP。），阅读和了解这些内容总是很有趣。

除了可以使用软件和硬件来实现的显而易见的概念之外，您可能还想与您的 ISP/提供商/colo 核实他们是否可以为您设置。

此外，关于您选择 colo（谁是提供者？）没有冒犯，但大多数地方应该设置为处理停机时间等，他们不应该要求您采取行动。当然，洪水或外星人总是会袭击，但在那种情况下，我想还有更重要的问题。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T20:48:00.483

如果可以，多播 - [http://en.wikipedia.org/wiki/Multicast](http://en.wikipedia.org/wiki/Multicast)或 AnyCast - [http://en.wikipedia.org/wiki/Anycast](http://en.wikipedia.org/wiki/Anycast)

# codeigniter - 第三 (3rd) 单击 FreakAuth 中的注销

> ID：401455
> 
> 赞同：0
> 
> 时间：2008-12-30T20:46:39.313
> 
> 标签：codeigniter

我已经为 CodeIgniter ( [http://www.4webby.com/freakauth/](http://www.4webby.com/freakauth/) ) 安装了 FreakAuth Lite 库。一切都运行良好（登录/注销），但我有一个问题。在用户登录后的第三个页面请求中，用户将自动注销。如果您只是刷新页面 3 次，或点击进入 3 个单独的页面，就会发生这种情况。有任何想法吗？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T01:48:51.417

我今天晚上也遇到了这个问题。经过一番搜索，我发现这个人，Kaga.Zepp，在CodeIgniter[论坛上](http://codeigniter.com/forums/viewthread/56647/P430/#530931)建议`'session'` 从. 这似乎也对我有用。`$autoload['libraries']``autoload.php`

我没有四处寻找确切的*原因*，但是你去。

希望它也适用于你。

> ID：401463
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# java - Java 对象重用

> ID：401464
> 
> 赞同：24
> 
> 时间：2008-12-30T20:50:00.400
> 
> 标签：java

Java 对象是否应该尽可能多地重用？或者我们应该只在它们“重量级”时重用它，即有与之关联的操作系统资源？

互联网上所有的旧文章都尽可能地谈论对象重用和对象池，但我读过最近的文章说`new Object()`现在已经高度优化（10条指令）并且对象重用不像以前那么重要。

当前的最佳实践是什么？你们是如何做到的？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-30T20:54:02.560

我让垃圾收集器为我做那种决定，我唯一一次用新分配的对象达到堆限制是在运行一个错误的递归算法几秒钟后生成了 3 * 27 * 27... 新对象尽可能快。

做最好的可读性和封装。有时重用对象可能很有用，但通常你不应该担心它。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-30T20:55:15.663

如果你非常**密集**地使用它们并且建造**成本**很高，你应该尽可能地重复使用它们。

如果您的对象非常小并且创建起来很便宜（例如 Object ），您应该创建新的对象。

例如，连接数据库是池化的，因为创建新数据库的成本高于创建 .. mmhh new Integer 的成本。

所以你的问题的答案是，当它们很重并且经常使用时重用**（**不值得汇集一个只使用两次的 3 mb 对象）

**编辑：**

此外，Effective Java: [Favor Immutability](http://www.google.com/search?q=Effective+Java+Favor+Immutability+Joshua+Bloch)中的这篇文章值得一读，并且可能适用于您的情况。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-30T21:41:01.437

让垃圾收集器完成它的工作，它可以被认为比你的代码更好。

除非剖析师证明它有罪。甚至不要用常识来试图找出它什么时候是错的。在不寻常的情况下，即使是像字节数组这样的廉价对象也可以更好地池化。

*   优化规则 1：不要这样做。
*   规则 2（仅适用于专家）：不要这样做。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-31T01:36:32.130

对象创建很便宜，是的，但有时还不够便宜。

如果你快速连续地创建很多（我的意思是很多）临时对象，垃圾收集器的成本是相当可观的。然而，即使有一个好的分析器，你也不一定很容易看到成本，因为现在垃圾收集器的工作间隔很短，而不是阻塞整个应用程序一两秒钟。

我在项目中获得的大部分性能改进来自于避免对象创建或通过积极缓存避免整个工作（包括对象创建）。无论对象有多大或多小，创建它并管理它的引用和堆结构仍然需要时间。（当然，清理和内部堆碎片整理/复制也需要时间。）

我不会开始热衷于不惜*一切*代价避免创建对象，但是如果您在内存分析器中看到拼图模式，则意味着您的垃圾收集器正在承担重任。如果您的垃圾收集器使用 CPU，则 CPI 对您的应用程序不可用。

关于对象池：做对并且不会遇到内存泄漏或无效状态，或者在管理上花费比您节省的更多时间是困难的。所以我从来没有使用过这种策略。

我的策略是简单地争取不可变的对象。不可变的东西可以很容易地被缓存，因此有助于保持系统简单。

但是，无论您做什么：确保首先使用分析器检查您的热点。过早的优化是万恶之源。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-30T21:02:15.227

经验法则应该是使用您的常识并在对象的创建消耗**大量资源**（例如 I/O、网络流量、数据库连接等）时重用它们......

如果它只是创建一个新的`String()`，忘记重用，你将一无所获。代码可读性有更高的偏好。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-30T21:03:24.257

如果出现性能问题，我会担心。首先做有意义的事情（你会用原语做这个），如果你然后运行一个分析工具并发现它是新的导致你的问题，开始考虑预分配（即当你的程序没有做很多工作时）。

顺便说一句，重用对象听起来像是一场等待发生的灾难：

```
SomeClass someObject = new SomeClass();

someObject.doSomething();
someObject.changeState();
someObject.changeOtherState();
someObject.sendSignal();
// stuff

//re-use 
someObject.reset(); // urgh, had to put this in to support reuse
someObject.doSomethingElse(); // oh oh, this is wrong after calling changeOtherState, regardless of reset
someObject.changeState(); // crap, now this is wrong but it's not obvious yet
someObject.doImportantStuff(); // what's going on? 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T21:11:23.383

对象创建肯定比以前快。JDK 5 及更高版本中的新一代 GC 也是改进。

我不认为这两种方法都不会使过度创建对象变得免费，但它们确实降低了对象池的重要性。我认为池化对数据库连接很有意义，但我不会为我自己的域对象尝试它。

重用重视线程安全。您需要仔细考虑以确保您可以安全地重用对象。

如果我认为对象重用很重要，我会使用 Terracotta、Tangersol、GridGain 等产品，并确保我的服务器有大量可用内存。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-31T00:50:15.580

二是以上评论。

不要尝试第二次猜测 GC 和热点。对象池可能曾经有用过，但现在它不是那么有用，除非您在谈论数据库连接或独特的系统资源。

只需尝试编写干净简单的代码，就会对 Hotspot 的功能感到惊讶。

为什么不使用 VisualVM 或分析器来查看您的代码？

# iphone - 如何减小 iphone 的 sqlite3 数据库的大小？

> ID：401467
> 
> 赞同：7
> 
> 时间：2008-12-30T20:50:57.263
> 
> 标签：iphone, ruby, sqlite, compression

*编辑：非常感谢所有的答案。以下是到目前为止应用优化后的结果：*

*   *切换到对字符进行排序和运行长度编码 - 新的 DB 大小 42M*
*   *删除布尔值上的索引 - 新数据库大小 33M*

*真正好的部分是这不需要对 iphone 代码进行任何更改*

我有一个 iphone 应用程序，其中包含一个以 sqlite 格式（只读）保存的大字典。我正在寻找减少当前非常大的数据库文件大小的想法。

这是 sqlite DB 的条目数和结果大小：

```
franks-macbook:DictionaryMaker frank$ ls -lh dictionary.db
-rw-r--r--  1 frank  staff    59M  8 Oct 23:08 dictionary.db
franks-macbook:DictionaryMaker frank$ wc -l dictionary.txt
  453154 dictionary.txt 
```

...平均每个条目大约 135 个字节。

这是我的数据库架构：

```
create table words (word text primary key, sowpods boolean, twl boolean, signature text)
create index sowpods_idx on words(sowpods)
create index twl_idx on words(twl)
create index signature_idx on words(signature) 
```

以下是一些示例数据：

```
photoengrave|1|1|10002011000001210101010000
photoengraved|1|1|10012011000001210101010000
photoengraver|1|1|10002011000001210201010000
photoengravers|1|1|10002011000001210211010000
photoengraves|1|1|10002011000001210111010000
photoengraving|1|1|10001021100002210101010000 
```

最后一个字段表示字谜检索的字母频率（每个位置在 0..9 范围内）。这两个布尔值表示子字典。

我需要进行以下查询：

```
select signature from words where word = 'foo'
select word from words where signature = '10001021100002210101010000' order by word asc
select word from words where word like 'foo' order by word asc
select word from words where word = 'foo' and (sowpods='1' or twl='1') 
```

我的一个想法是更有效地对字母频率进行编码，例如将它们二进制编码为一个 blob（也许使用 RLE，因为有很多零？）。关于如何最好地实现这一目标的任何想法，或其他减少尺寸的想法？我正在用 ruby​​ 构建数据库，并在目标 C 中通过电话阅读它。

还有什么方法可以获取数据库的统计信息，这样我就可以看到什么是使用最多的空间？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T21:10:29.500

您是否尝试过键入“vacuum”命令以确保您忘记回收的数据库中没有多余的空间？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T23:33:30.303

删除 sowpods 和 twl 上的索引——它们可能对您的查询时间没有帮助，而且肯定会占用大量空间。

您可以使用[SQLite 下载页面中的](http://www.sqlite.org/download.html)**sqlite3_analyzer**获取数据库的统计信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T21:57:06.020

作为一种完全不同的方法，您可以尝试使用[布隆过滤器](http://en.wikipedia.org/wiki/Bloom_filter)而不是综合数据库。基本上，布隆过滤器由一堆散列函数组成，每个散列函数都与一个位域相关联。对于每个合法字，每个散列函数都被评估，并设置相应位域中的相应位。缺点是理论上可能会出现误报，但可以通过足够的哈希值最小化/实际上消除这些误报。另外一方面是巨大的空间节省。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T21:08:56.710

我不清楚签名字段的所有用例，但似乎存储单词的字母版本会是有益的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T20:59:13.923

您最好的选择是使用压缩，不幸的是 SQLite 目前不支持本机。幸运的是，有人花时间为它开发了一个[压缩扩展](http://lserinol.googlepages.com/sqlitecompress)，这可能是你需要的。

否则，我建议您主要以压缩格式存储数据并即时解压缩。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T21:01:53.200

SQLite 的创建者销售包含数据库压缩（和加密）的 SQLite 版本。这将是完美的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T21:13:31.897

作为一个文本字段，`signature`当前每个条目至少使用 26 * 8 个字节（208 个字节），但是如果您要将数据打包到一个位字段中，您可能只需要每个字母 3 位（减少每个字母的最大频率）至 7)。这意味着您可以将整个签名打包成 26 * 3 位 = 78 位 = 10 个字节。即使每个字母使用 4 位（每个字母的最大频率为 15），您也只会使用 104 位（13 个字节）。

编辑：经过深思熟虑，我认为每个字母 4 位（而不是 3 位）会是一个更好的主意，因为它会使二进制数学更容易。

EDIT2：阅读有关[SQLite 数据类型](http://www.sqlite.org/datatype3.html)的文档，您似乎可以使“签名”字段跨越 26 个 INTEGER 类型的列，并且 SQLite 会做正确的事情，并且只使用存储所需的尽可能多的位价值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-30T21:06:21.460

我是否正确地认为您的数据库中有大约 45 万个这样的单词？

我对iPhone一无所知，对sqlitem也不认真，但是......只要sqlite不允许立即将文件保存为gz（它可能已经在内部进行了？不，看起来不像你说每个条目大约 135 b。即使有两个索引），我会远离表格方法，将其“手动”保存在[字典方法压缩](http://en.wikipedia.org/wiki/Dictionary_coder)中，并在运行中和内存中构建其余部分。这应该在您的数据类型上表现得非常好。

等等...您是否使用该签名来允许全文搜索或误输入识别？sqlite 上的[全文搜索](http://www.sqlite.org/cvstrac/wiki?p=FullTextIndex)不会使该字段过时吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-30T21:47:45.977

如前所述，更有效地存储“签名”似乎是个好主意。

但是，您似乎也可以通过使用某种单词查找表来节省大量空间 - 因为您似乎使用了一个词根，然后附加“er”、“ed”、“es”等为什么没有具有数字 ID 的列引用来自单独查找表的根词，然后具有引用将附加到基本词的常用词后缀表的数字 ID 的单独列。

如果在为具有单个根词的多个条目存储签名的速记版本有任何技巧，您还可以使用这些技巧来减少存储的签名的大小（不确定是什么算法产生了这些值）

这对我来说似乎也很有意义，因为您将“单词”列作为主键，但甚至不对其进行索引 - 只需创建一个单独的数字列作为表的主 ID。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-30T21:53:42.690

嗯...... iPhone......它没有永久数据连接吗？我认为这是一个 web 应用程序/web 服务可以很好地融入其中的地方。将您的大部分业务逻辑移动到网络服务器（他将拥有真正的 SQL 和 FTS 和 looooots 内存）并将该信息在线获取到设备上的客户端。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-31T14:07:47.980

如其他地方所述，丢失布尔列上的索引，它们几乎肯定会比表扫描慢（如果使用的话）并且会不必要地使用空间。

我会考虑对单词进行简单的压缩，[霍夫曼编码](http://en.wikipedia.org/wiki/Huffman_coding)非常适合这种事情。另外，我会查看签名：按字母频率顺序对列进行排序，不要费心存储尾随零，这可能是暗示的。我想你也可以对这些进行霍夫曼编码。

当然，总是假设你的编码字符串不会扰乱 SQLite。

# .net - 将 GUID 转换为整数并返回

> ID：401480
> 
> 赞同：4
> 
> 时间：2008-12-30T20:56:53.240
> 
> 标签：.net, asp.net

所以我有一个我必须与之交互的第 3 方应用程序，这个应用程序需要我的用户表中的用户 ID。问题是我将我的用户 ID 存储为 GUID，而第 3 方应用程序只接受一个整数。所以我想，如果有办法将 GUID 转换为整数然后能够将其转换回来（因为我从他们的服务器获得有关用户 ID 的通信），那么我不必重新编码太多。有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-30T21:01:48.240

整数使用 32 位，而 GUID 是 128 位 - 因此，无法在不丢失信息的情况下将 GUID 转换为整数，因此无法将其转换回来。

编辑：您也许可以将 GUID 存储到 GUIDs 表中，您可以在其中为每个表分配一个唯一的整数 ID。这样，您可以在给定整数 ID 的情况下取回 GUID。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-30T21:01:50.733

您需要存储从 Guid 到第 3 方整数的映射：现有用户表中的新“int thirdPartyId”字段或新表。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-30T21:00:48.927

您需要一个 128 位整数类型来保存 GUID 的等价物。您可以使用 Guid 的 ToByteArray() 方法获取字节和接受字节数组的构造函数来恢复 Guid。

您也可以使用 GetHashCode() 方法获取整数，但两个不同的 GUID 可能具有相同的哈希码，因为可能的 Guid 比 32 位整数多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T21:00:09.583

比整数大得多的 Guid，不能放入整数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T21:02:53.900

添加整数 Identity 列，这基本上是**第二个 ID 列**，并将该列 ID 提供给应用程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-06T10:36:38.180

创建一个包含两列的新表 (MyUserMappings)

1) ThirdPartyUserID (INT, NOT NULL, IDENTITY(1,1))

2) MyUserID (GUID, NOTNULL)

通过执行将所有 GUID 从您的用户 ID 插入此表

插入 MyUserMappings(MyUserID) 从 MyUsers 中选择 MyGUIDUserID

您还需要在 MyUsers 表上放置一个触发器，以便在 MyUsers 表每次获得新行时在 MyUsersMappings 表中插入一个新行。

现在创建一个视图，显示 MyUsers 表中的所有字段和 MyUsermappingsTable 中的 ThirdParty UserID 字段。

现在您不需要对现有应用程序进行任何 DAL 更改，并且您的原始表不受影响。因此，您现有的应用程序将保持原样。并且您的新代码可以查询视图而不是表以返回整数 ID 和所有其他用户信息。

干杯。

# c# - Find() 与列表上的枚举

> ID：401482
> 
> 赞同：4
> 
> 时间：2008-12-30T20:57:54.517
> 
> 标签：c#, performance, search, list

我正在使用一个代码库，其中需要经常搜索列表以查找单个元素。

使用 Predicate 和 Find() 是否比手动在 List 上进行枚举更快？

例如：

```
string needle = "example";
FooObj result = _list.Find(delegate(FooObj foo) {
    return foo.Name == needle;
}); 
```

对比

```
string needle = "example";
foreach (FooObj foo in _list)
{
    if (foo.Name == needle)
        return foo;
} 
```

虽然它们在功能上是相同的，但它们在性能上是否也相同？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T21:04:07.190

它们在性能上并不相同。Find() 方法需要为列表中的每个项目调用一个方法（在本例中为委托）。与内联比较相比，方法调用不是免费的，而且**相对昂贵。**foreach 版本不需要对每个对象进行额外的方法调用。

话虽如此，在我真正分析我的代码并发现这是一个问题之前，我不会根据性能选择其中一个。我还没有发现这种场景的开销对于我编写的代码来说都是一个“热路径”问题，我在 Find 和其他类似方法中经常使用这种模式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T21:10:38.190

如果按原样搜索您的列表太慢，您可能会比线性搜索做得更好。如果您可以保持列表排序，则可以使用二进制搜索在 O(lg n) 时间内找到元素。

如果您要搜索*很多*内容，请考虑用字典替换该列表，以按名称索引您的对象。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T21:20:44.753

从技术上讲，委托版本的运行时性能会比其他版本稍差 - 但在大多数情况下，您很难察觉到任何差异。

更重要的（IHMO）是能够编写您想要的东西的代码时间性能，而不是您想要的方式。这对可维护性有很大影响。

这个原始代码：

```
string needle = "example";
foreach (FooObj foo in _list)
{
    if (foo.Name == needle)        
        return foo;
} 
```

需要任何维护人员阅读代码并了解您正在寻找特定项目。

这段代码

```
string needle = "example";
return _list.Find(
    delegate(FooObj foo) 
    {
        return foo.Name == needle;
    }); 
```

清楚地表明您正在寻找一个特定的项目 - 更快地理解。

最后，这段代码使用了 C# 3.0 的特性：

```
string needle = "example";
return _list.Find( foo => foo.Name == needle); 
```

做完全相同的事情，但在一行中，阅读和理解的速度更快（好吧，一旦你理解了[lambda 表达式](https://stackoverflow.com/questions/150129/what-is-a-lambda)，无论如何）。

总之，鉴于替代方案的性能几乎相同，请选择使代码更易于阅读和维护的一种。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-31T11:27:07.587

“我正在使用一个代码库，其中需要**经常搜索****列表**以查找单个元素”

 **最好将数据结构更改为 Dictionary 而不是 List 以获得更好的性能

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-31T11:42:33.187

[对于 List.ForEach 与 foreach 迭代（ foreach 与 someList.Foreach(){}](https://stackoverflow.com/questions/225937/foreach-vs-somelist-foreach) ）提出了类似的问题。

在那种情况下 List.ForEach 会快一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T21:10:01.827

正如 Jared 指出的那样，存在差异。

但是，与往常一样，除非您知道这是一个瓶颈，否则请不要担心。如果它是一个瓶颈，那可能是因为列表很大，在这种情况下，您应该考虑使用更快的查找 - 哈希表或二叉树，或者甚至只是对列表进行排序并进行二进制搜索会给您 log(n)这将比调整线性案例产生更大的影响。

# ruby-on-rails - Rails ActiveRecord Update question

> ID：401486
> 
> 赞同：0
> 
> 时间：2008-12-30T20:58:30.647
> 
> 标签：ruby-on-rails, activerecord, associations, form-for

I have a user model which has multiple addresses. Now for my application in rails, address is not mandatory. So, if someone wants to create a user and enter the address after the user has been created, my application should allow that. My problem is, for Address model I have validations for Address Line 1, City and Postal Code. These fields cannot be blank. When, editing a user, the following code fails:

user.addresses << Address.new

Rails tries to create a new Address and fires an Insert command. This is going to fail because of the validations that is required in the model. The above code doesn't fail if the user is not present in the database. One solution to this problem is to create a separate form_for binding for the edit partial for user. I don't want to do that solution. Is there any solution that allows me to bind an empty Address object for an already existing User object in the database ?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-31T00:59:48.383

```
user.addresses << Address.new 
```

This code isn't going to work anyway if your Address model requires its fields to be set, because you're not supplying a hash to `Address.new`

If you want to add the address conditionally, you probably want something like this:

```
if !params[:address].blank?
  user.addresses.create(params[:address])
end 
```

or

```
user.addresses << Address.new(params[:address]) unless params[:address].blank 
```

If you really want to create an "empty" address object for each user (instead of just having users without addresses), you can change your validations so they only fire if the fields are filled out.

Something like this:

```
class Address < ActiveRecord::Base
  validates_presence_of :address1, :if => :non_empty_address?
  # etc

  private
    def non_empty_address?
     !address1.blank? || !address2.blank || !city.blank? # etc
    end
end 
```

The restful_authentication plugin uses a similar approach to determine if the user's password is required.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T21:05:28.090

Why attempt to add an empty Address object to the user.addresses collection? I think you could simply do something like:

```
user.addresses << Address.new unless (conditions) 
```

I unfortunately don't know what your conditions are here, so it could be something like

```
user.addresses << Address.new unless params[:address].nil? 
```

...although my guess is that you have a real Address object instead of just passing in a blank Address.new...

# ruby-on-rails - 任何人都尝试在 Ruby 1.9.1 RC1 下运行 Rails 2.2（或 Edge）

> ID：401511
> 
> 赞同：2
> 
> 时间：2008-12-30T21:06:17.573
> 
> 标签：ruby-on-rails, ruby, ruby-1.9

Ruby 1.9.1 RC1 今天发布了，所以我很快就开始安装它（当然是使用后缀 19 的测试版本）。我为 1.9 RubyGems 安装 Rails 和 Rack，然后使用 edge 创建一个新的 Rails 站点......当我执行时：

```
ruby19 ./script/server 
```

我看着处理器使用率上升到 99.8，而终端就坐在那里。尝试使用 1.9.1RC1 运行 Rails 2.2 会导致变形器出现各种故障。我的印象是 Rails 2.2 与 1.9.1 兼容。是否有人在 Ruby 1.9.1 下成功测试 Rails，或者您是否看到类似的错误？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T10:20:11.637

对我来说也是一样。

我在 webrik 下运行最新的边缘导轨，只看到空白屏幕并且对 Ctrl-C 没有响应。Rails 2.2 根本不工作。

另外，我尝试过在 Thin 下运行 edge（将来自 github 的 eventmachine 固定在 ruby​​ 1.9.1 上构建，除了一个损坏的 ruby​​ 测试 - 我刚刚添加了一个带有“assert true”的空测试）。

之后，webrick 和 Thin 都立即崩溃：

$ /usr/local/bin/ruby 脚本/服务器 /usr/local/lib/ruby/gems/1.9.1/gems/eventmachine-0.12.3/lib/rubyeventmachine.bundle: [BUG] Bus Error ruby​​ 1.9.1 (2008-12-30 patchlevel-0 修订版 21203) [i386-darwin9.6.0]

所以，我想，我们现在都需要冷静下来。在 1.9.1 下实际运行我们的 Rails 应用程序还有很多工作要做。许多 gem 仍处于与 1.9.1 兼容的早期阶段

实际上，rails 2.2 与 ruby​​ 1.9.1 并不完全兼容，只是一个基本的兼容性，根据 rails 核心团队:)

即将推出的 Rails 2.3 中声称完全兼容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T00:34:29.420

我[写了一篇关于使用 Rails edge（足够接近 2.3）和 Ruby 1.9.1 的指南](http://frozenplague.net/2009/01/ruby-191-rubygems-rails/)。mysql、postgres 和 hpricot、thin 和 mongrel 等其他一些 gem 不起作用，但应用程序确实起作用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T13:41:40.693

在 ActiveSupport 上处理字符和字符串时，Rails 2.2.2 与 Ruby 1.9.1rc1 不兼容。Rails 使用多字节来支持 unicode 字符集，而 Ruby 1.9.1 使用内置的 unicode 支持。支持的版本是 1.8.5 到 1.8.7。

# java - War-file deployment with shared resources

> ID：401513
> 
> 赞同：0
> 
> 时间：2008-12-30T21:07:04.173
> 
> 标签：java, web-deployment

Consider the following example structure

```
- Project
    - www
        - files
            + documents
            + html
            + images
            + scripts
    - WEB-INF
        * web.xml 
```

The documents folder needs to be a symlink or in some other way external from the war file because users will add and remove documents (through a mapped network drive).

I'd like to deploy the webapp as a war-file but I don't know how to do that and take the above into account. Could you give some pointers? /Adam

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T23:49:50.287

我同意@duffymo.myopenid.com 的观点，即在您的应用服务器前面使用为某些 URL 前缀提供静态内容的 Web 服务器是一个很好、干净的解决方案。

如果这在您的环境中不可行，或者如果您决定更愿意在 Web 应用程序本身中处理它，您可以编写一个 servlet 来有效地做同样的事情。例如，创建一个映射到 URL 模式 /documents/* 的 servlet。此 servlet 可以解析 URL (/documents/some/file.png) 以确定相对文件名 (some/file.png)。然后它可以读取并返回在外部目录 (/staticDocs/some/file.png) 中找到的相应内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T21:12:49.947

如果它是静态内容，也许你最好在你的应用服务器前面放置一个 Web 服务器并将静态内容放在那里。您可以让应用服务器不必提供静态数据并保存网络往返以启动。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-31T14:55:49.663

在您的服务器上创建一个指向文件存储目录的环境变量怎么样？环境变量可能比 WAR 文件中的设置更有效，因为您可以在新环境中部署应用程序（可能从 DEV 移动到 PROD），而无需更改 WAR 文件。

从您的 java 代码中，您可以使用以下命令引用此环境设置： String docPath= System.getProperty("DOC_PATH");

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-31T02:48:46.807

基本上，它是一个网络应用程序，可以聚合来自各种来源的信息并生成文档。要求用户能够在不登录 webapp 的情况下从网络手动创建和上传文档。

将文档位置路径作为上下文变量肯定是可行的。我想这是最简单的方法。/亚当

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T08:27:05.237

不幸的是，对您而言，.war 文件本质上是 .zip 文件，而 .zip 文件不支持符号链接。如果您只部署到 Windows 机器，您可能会幸运地使用快捷方式文件。但是，我不确定应用服务器是否会喜欢这样（......可能不会。）

我建议向应用程序添加一个配置参数，允许在其中指定文档文件夹的完整路径。默认路径应该是相对的（“./www/files/documents”），这样应用程序就可以开箱即用，无需额外配置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-31T09:20:01.010

许多 java web 服务器支持“exploded war files”，您只需将 .war 文件解压缩到部署目录中即可。使用 tomcat 将其复制到`$CATALINA_HOME/webapps`并完成。

这应该适合你。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-30T21:19:07.173

为什么不将文档等存储在数据库中，然后让网络应用程序访问数据库并允许用户以这种方式提取文件？它必须是映射的网络驱动器吗？

否则，如果要知道那里有什么，您总是可以动态构造 jnlp 文件并将文件列表等作为参数传递（如果它们是服务器端的）。

猜猜我们需要更多地了解您要完成的工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-06-04T18:42:09.900

在 Apache Tomcat 中，有时可能适合通过 tomcat [RewriteValve](https://tomcat.apache.org/tomcat-8.0-doc/rewrite.html)实现重用，如下所示：

META-INF/context.xml：

```
<Context>
  <Valve className="org.apache.catalina.valves.rewrite.RewriteValve" />
</Context> 
```

WEB-INF/rewrite.config：

```
RewriteRule (.*)/login(/.*\.)(png|jpg|js|css) $1$2$3 
```

现在`/appContext/login/`路径将使用相同的 images/js/css`/appContext/`

当然，与任何问题的所有基于正则表达式的解决方案一样，保持表达式的低复杂性对性能很重要。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-30T21:14:02.940

听起来您需要一个 Web 内容管理系统 ( [CMS](http://www.cmswatch.com/) )。

# c# - Linq2Sql 测试

> ID：401516
> 
> 赞同：1
> 
> 时间：2008-12-30T21:08:26.133
> 
> 标签：c#, .net, unit-testing, linq-to-sql

我有测试数据库和生产数据库。在开发时，我当然会针对该测试数据库工作，然后在部署时我必须半手动更新生产数据库（通过运行批处理 sql 脚本）。这通常可以正常工作，但是如果部署的数据库与测试数据库不同，则可能会出错。

对于表：有什么方法可以自动测试我使用 linq2sql 针对生产数据库映射的所有实体，以便所有属性等都存在？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T21:28:58.463

我在开发过程中使用了类似的方法，如果一次修改太多表，我可以确保开发和生产数据库之间的同步很容易成为一项艰巨的任务。

我意识到最好的方法是忘记手动执行此同步，这太耗时且容易出错，并开始使用工具来自动化该过程。

我一直在使用 RedGate SQlCompare，我可以说没有它我活不下去了。它比较数据库的所有结构，指出修改并完美地应用更改，即使在具有数百万条记录的表中也是如此。

[链接到 Redgate SQL 比较](http://www.red-gate.com/products/SQL_Compare/index.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T21:11:13.150

据我所知，在提交之前无法自动测试。但是，您可以推断它并以编程方式检查它。我有一个用于编组 Linq 对象的每个 Linq 对象的控制器，并且该控制器有一个 IsValid 方法，该方法使用我在这里看到的技术检查 db 规则：http: [//www.codeproject.com/KB /cs/LinqColumnAttributeTricks.aspx](http://www.codeproject.com/KB/cs/LinqColumnAttributeTricks.aspx)

我用以下代码调用它：

```
 if (address.City.Length > Utilities.LinqValidate.GetLengthLimit(address, "City"))
            throw new ArgumentOutOfRangeException("address.City Max Length Exceeded"); 
```

这是我正在使用的实用程序的修改版本：

```
 public static int GetLengthLimit(object obj, string field)
    {
        int dblenint = 0;   // default value = we can't determine the length

        Type type = obj.GetType();
        PropertyInfo prop = type.GetProperty(field);
        // Find the Linq 'Column' attribute
        // e.g. [Column(Storage="_FileName", DbType="NChar(256) NOT NULL", CanBeNull=false)]
        object[] info = prop.GetCustomAttributes(typeof(ColumnAttribute), true);
        // Assume there is just one
        if (info.Length == 1)
        {
            ColumnAttribute ca = (ColumnAttribute)info[0];
            string dbtype = ca.DbType;

            if (dbtype.StartsWith("NChar") || dbtype.StartsWith("NVarChar") ||
                dbtype.StartsWith("Char") || dbtype.StartsWith("VarChar")
                )
            {
                int index1 = dbtype.IndexOf("(");
                int index2 = dbtype.IndexOf(")");
                string dblen = dbtype.Substring(index1 + 1, index2 - index1 - 1);
                int.TryParse(dblen, out dblenint);
            }
        }
        return dblenint;
    }

    public static bool CanBeNull(object obj, string field)
    {
        bool canBeNull = false;

        Type type = obj.GetType();
        PropertyInfo prop = type.GetProperty(field); 
        object[] info = prop.GetCustomAttributes(typeof(ColumnAttribute), true); 
        if (info.Length == 1)
        {
            ColumnAttribute ca = (ColumnAttribute)info[0];
             canBeNull = ca.CanBeNull; 
        }
        return canBeNull;
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T22:14:45.363

查看 sysobjects 和 syscolumns（和 sysindexes）。由于这些表不会更改，因此您可以编写一些 LINQ 来加载它们并验证您的期望是否得到满足。或者您可以改为在 SQL 脚本中执行此操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-08T09:46:08.840

我想添加我的选择[Adept SQLDiff](http://www.adeptsql.com/)，它可能不像 Redgate 那样流畅，但我发现它更可靠（我对两者都进行了评估，尽管我应该说这是几年前的事了）。我多年来一直有免费更新（支持 SQL Server 7 - 2008）。带有 Data Diff 选项的价格为 320 美元，非常物有所值（比 Redgate 便宜得多）。开发人员会亲自快速回复电子邮件。不，我不为他们工作，只是一个快乐的用户:)

# javascript - What is the purpose of `this.prototype.constructor = this;`?

> ID：401521
> 
> 赞同：4
> 
> 时间：2008-12-30T21:09:18.410
> 
> 标签：javascript

In the ASP.NET ajax library, there is a line that makes me confused.

```
Type.prototype.registerClass = function Type$registerClass(typeName, baseType, interfaceTypes) {

//..

this.prototype.constructor = this;

//..
} 
```

I know that `(this.prototype.constructor === this) == true`, so what is significance of this line? I remove the line, and test the library with some code. It seems it is okay. What is the purpose of this line?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T03:28:58.910

我不熟悉 asp.net 库，但是：

Javascript 中的一个常见模式，尤其是在尝试模拟基于类的系统时，是将原型对象重新分配给另一个对象的实例，而不是仅仅向 JS 提供的原型对象添加属性。这样做的一个问题是它给了你错误的构造函数——除非可能用一个“正确”的值重置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-14T14:32:57.610

我的猜测是，在之前的某个时间点`this.prototype.constructor = this;`，某个对象被分配给了原型属性，它覆盖了`prototype.constructor`. 当很容易继承对象原型时经常使用这个技巧，但仍然能够调用`instanceof`以查看对象实例是否属于某种类型。

在这种情况下很难说出比这更具体的内容和一个非常古老的问题，但是它可能对某人有用。

# cookies - 我可以使用标签跨域发送 cookie 吗？

> ID：401535
> 
> 赞同：8
> 
> 时间：2008-12-30T21:14:11.007
> 
> 标签：cookies, cross-domain

看看这种情况：

1.  `www.websitea.com`显示一个属性为and的`img`标签`src``www.websiteb.com/image.aspx?id=5``style="display:none"`
2.  `www.websiteb.com`返回一个清晰的图像，除了一个名称`referrer`和值的cookie `5`（从经过验证的查询字符串创建的服务器端。）

cookie 是在域上创建`www.websitea.com`还是`www.websiteb.com`？

目前，我确信使用查询字符串进行一系列重定向并实现跨域 cookie，但我不久前提出了这个图像想法。我想我也可以使用`iframe`.

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-30T21:20:23.303

将为 websiteb.com 创建 cookie。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-30T21:27:08.280

查看： [跨域用户跟踪](https://stackoverflow.com/questions/216430/cross-domain-user-tracking)

有人提到使用 1x1 图像进行跨域跟踪。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T21:26:22.433

cookie 是根据对 websiteb.com 的请求创建的，所以是的...... cookie 进入 websiteb 范围

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T22:25:30.240

你在正确的轨道上。正如其他人所提到的，cookie 将为 websiteb.com 创建。

要克服 IE 的问题，您可能需要添加紧凑隐私政策。

从这里开始：http: [//msdn.microsoft.com/en-us/library/ms537342.aspx](http://msdn.microsoft.com/en-us/library/ms537342.aspx)和谷歌为其余。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T21:31:54.653

好的，看起来不错。在所有浏览器中测试。为 IE6 添加了 P3P 标签，但不确定是否有必要。

```
<%@ Page Language="VB" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<script runat="server">
    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs)
        Response.AddHeader("P3P", "CP=""CAO PSA OUR""")
        Dim passedlocalizeID As String = Request.QueryString("id")
        Dim localizeID As Integer
        If passedlocalizeID IsNot Nothing AndAlso Int32.TryParse(passedlocalizeID, localizeID) Then
            Dim localizer As New Localizer
            localizer.LocalizeTo(localizeID)
        End If
    End Sub
</script>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Redirecting . . .</title>
    <meta http-equiv="refresh" content="0;URL=/" />
</head>
<body>
    <form id="form1" runat="server">
    <div>
    </div>
    </form>
</body>
</html> 
```

# api - 是否有管理 API 密钥的站点？

> ID：401538
> 
> 赞同：2
> 
> 时间：2008-12-30T21:17:03.137
> 
> 标签：api, key, api-key

我记得有一个第三方网站负责 API 密钥的所有注册、配额和密钥生成。名字想不起来了，想知道有没有人知道？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T21:47:54.090

I haven't used them and know very little about them but [Mashery](http://www.mashery.com/) came across my radar the other day when I was looking at the Netflix API. They've got a pretty impressive list of customers.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-04-11T04:55:31.577

您可以使用 3scale ( [http://www.3scale.net](http://www.3scale.net) ) 来执行此操作 - 它提供速率限制、密钥管理、分析、开发人员门户等，并使用语言插件或使用 Varnish 之类的东西作为前端连接到您的 API结尾。它是免费的，流量很大。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-30T23:58:30.517

您可以使用 PHP 轻松完成：D

```
<?
$customer = '   ';
$customerid = '   ';
$key = md5('Some salt here'.$customer).md5($customerid);
// Then add something to add it to your database, like 
mysql_query("INSERT INTO APIKEYS Customer='".$customer."' ID='".$customerid.'" Key='".$key."'");
?> 
```

然后当 API 密钥传递到您的服务器时，可能像 GET 函数

```
<?
if(mysql_num_rows(mysql_query("SELECT * FROM APIKEYS WHERE Key='".$_GET['api']."'")) > '0') {
// Verified!
} else {
// Uh oh!
}
?> 
```

希望对您有所帮助^^;

# asp.net - 序列化 ASP.NET 控件集合

> ID：401541
> 
> 赞同：5
> 
> 时间：2008-12-30T21:17:59.657
> 
> 标签：asp.net, serialization

我的任务是将现有的 ASP.NET 站点从使用 InProc 会话管理转换为使用 ASP.NET 状态服务器。

当然，这意味着存储在 Session 中的任何内容都必须是可序列化的。

应用程序中最复杂的页面之一当前是将 ASP.NET 控件集合存储到 Session。这是惨败，因为控件无法自动序列化。

没有完全重写页面的工作方式以防止需要在 Session 中存储控件集合，有没有人有使集合可序列化的技巧/解决方案？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-31T05:03:57.250

重写页面。以后你会感谢自己的。如果最初的“程序员”（我在这里松散地使用该术语）认为在会话中存储控制层次结构是个好主意，那么肯定会有其他问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T23:02:26.717

不要将控件集合存储在会话状态中。苔丝有很多关于这个的文章，例如[这个](http://blogs.msdn.com/tess/archive/2007/08/13/asp-net-memory-investigation.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T22:43:16.943

想到的第一个答案是进行部分重写（我认为这不会是一个简单的答案）。如果是少数控件类型，请编写您自己的控件，从这些控件继承并实现 ISerializable。然后，使用搜索和替换，将页面的控件替换为您的版本。如果您使用大量控件类型，您可能会花费更多时间来扩展标准类型而不是重构页面。

初始化控件时，工作将在控件的序列化和反序列化中进行，以确保捕获所需的内容（TextBox 值、IsSelected 等）。

这显然是一种 hack，但如果您的优先级确实不是重写该特定页面的功能，那么这可能对您有用。然后，当然，您需要将此解决方案添加到您的应用程序产生的“技术债务”中，以确保在某些时候它总是在某人的雷达上进行重构。

# sql-server - How can I handle non-ASCII characters when retrieving data from SQL Server using Perl?

> ID：401555
> 
> 赞同：0
> 
> 时间：2008-12-30T21:23:46.027
> 
> 标签：sql-server, perl, dbi

I have a Perl script running on UNIX that uses DBI to connect to and retrieve data from a SQL Server database. The script looks like the following:

```
$dbh = DBI->connect("dbi:Sybase:server=$connect;charset=UTF-8", $login, $password) or die("Couldn't connect to $connect as $login/$password:
$DBI::errstr");

$sql = "use mydb";
$sth = $dbh->prepare($sql);
$sth->execute or die("execute failed");
$sth->finish;

$sql = "MyProc \@DATE='1/1/2008'";
$sth = $dbh->prepare($sql);
$sth->execute or die("execute failed");
while (($body) = $sth->fetchrow()) {
        print "$body\n";
}
$sth->finish;

$dbh->disconnect if $dbh; 
```

The body variable retrieves data from a column that is NVARCHAR and contains non-ASCII characters. The query runs fine, but the print statement spits out ????? when it encounters a non-ASCII character. In DBI->connect I even specify the character set, but no luck.

Any thoughts on how I can get this to work?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-30T21:31:30.347

Your code looks OK.

I've no reason to believe that what you're putting into the database and subsequently retrieving isn't still in UTF-8 encoding.

Have you confirmed that the terminal on which your printing the data is actually in UTF-8 mode?

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T00:40:47.860

Oh how many hours I've wasted chasing non-existent bugs based on what I saw or didn't see when I printed data to my terminal. There are several different ways to verify your data that aren't affected by non-printing characters and don't depend on your system's display being able to map the correct glyphs to non-ASCII character codes. If your data don't look right dump them into a file and browse the file with a hex editor or run them through the od utility.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T21:28:16.360

I've connected Perl to SQL Server [via FreeTDS + ODBC](https://stackoverflow.com/questions/149395/what-are-some-ways-of-accessing-microsoft-sql-server-from-linux#149418) and have had no problem with character encodings. Maybe the Sybase DBI is the culprit here...

# perl - 在 Perl 中，哈希键周围的引号是一种好习惯吗？

> ID：401556
> 
> 赞同：38
> 
> 时间：2008-12-30T21:23:51.407
> 
> 标签：perl, hash, quotes

在 Perl 中使用哈希时引用键是个好主意吗？

我正在处理一个非常大的遗留 Perl 代码库，并尝试采用 Damian Conway 在[Perl Best Practices](http://oreilly.com/catalog/9780596001735/)中提出的许多最佳实践。我知道最佳实践对于程序员来说*总是*一个敏感的话题，但希望我能在这个问题上得到一些好的答案，而不会引发一场激烈的战争。我也知道这可能是很多人不会争论的事情，因为它是一个小问题，但我正在努力获得一份可靠的指南列表，以便在我通过这个代码库工作时遵循。

在[Damian Conway 的 Perl Best Practices 书中](http://oreilly.com/catalog/9780596001735/)，有一个例子展示了对齐如何帮助一段代码的易读性，但它没有提到（在书中我能找到的任何地方）关于引用哈希键的任何内容。

```
$ident{ name   } = standardize_name($name);
$ident{ age    } = time - $birth_date;
$ident{ status } = 'active'; 
```

用引号来强调你没有使用裸词不是更好吗？

```
$ident{ 'name'   } = standardize_name($name);
$ident{ 'age'    } = time - $birth_date;
$ident{ 'status' } = 'active'; 
```

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-30T21:30:56.213

没有引号更好。它在 {} 中，因此很明显您没有使用裸词，而且它更易于阅读和输入（少两个符号）。当然，所有这些都取决于程序员。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-12-31T02:11:27.473

指定常量字符串哈希键时，应始终使用（单）引号。例如， `$hash{'key'}` 这是最好的选择，因为它不需要考虑这个问题并导致格式一致。如果您有时省略引号，则必须记住在您的密钥包含内部连字符、空格或其他特殊字符时添加它们。在这些情况下您*必须*使用引号，导致格式不一致（有时不加引号，有时加引号）。带引号的键也更有可能被您的编辑器语法高亮。

这是一个示例，其中使用“有时引用，其他时间不引用”约定会给您带来麻烦：

```
$settings{unlink-devices} = 1; # I saved two characters! 
```

这将在 下编译得很好`use strict`，但在运行时不会完全符合您的期望。哈希键是字符串。字符串应根据其内容进行适当引用：单引号表示文字字符串，双引号表示允许变量插值。引用您的哈希键。这是最安全的约定，也是最容易理解和遵循的。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-11T01:35:34.917

我从不单引号哈希键。我知道 {} 基本上像引号一样工作，除了在特殊情况下（a + 和双引号）。我的编辑也知道这一点，并给了我一些基于颜色的提示，以确保我做了我想要的。

在我看来，到处使用单引号就像不了解 Perl 的人所犯的一种“防御性”做法。节省一些键盘磨损并学习 Perl :)

随着咆哮的结束，我发布此评论的真正原因......其他评论似乎错过了`+`“取消引用”一个裸词的事实。这意味着你可以写：

```
sub foo {
    $hash{+shift} = 42;
} 
```

或者：

```
use constant foo => 'OH HAI';
$hash{+foo} = 'I AM A LOLCAT'; 
```

所以很明显，这`+shift`意味着“调用 shift 函数”和`shift`“字符串 'shift'”。

我还要指出，cperl-mode 正确地突出了所有各种情况。如果没有，请在 IRC 上 ping 我，我会修复它 :)

（哦，还有一件事。我确实在 Moose 中引用了属性名称，如`has 'foo' => ...`.我的代码。也许我很快就会停止这样做。）

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-30T21:36:16.437

无引号的哈希键得到了 Larry Wall 的语法级别的关注，以确保它们没有理由成为最佳实践。不要为引号而汗流浃背。

（顺便说一句，数组键上的引号*是*PHP 中的最佳实践，如果不使用它们可能会产生严重后果，更不用说大量的 E_WARNING。在 Perl 中可以！= 在 PHP 中可以。）

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-31T00:44:25.670

我认为这没有最佳实践。我个人在哈希键中使用它们，如下所示：

```
$ident{'name'} = standardize_name($name); 
```

但不要在箭头运算符的左侧使用它们：

```
$ident = {name => standardize_name($name)}; 
```

不要问我为什么，这就是我做的方式:)

我认为你能做的最重要的事情就是永远，永远，永远：

```
use strict;
use warnings; 
```

这样编译器就会为你捕捉到任何语义错误，让你不太可能打错东西，无论你决定采用哪种方式。

第二个最重要的事情是保持一致。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-03T21:50:14.773

我不带引号，只是因为打字、阅读和担心的次数更少。我有一个不会被自动引用的密钥的时间很少而且相差很远，因此不值得所有额外的工作和混乱。也许我对哈希键的选择已经改变以适应我的风格，这也是一样的。完全避免边缘情况。

`"`这与我默认使用的原因相同。对我来说，在字符串中间插入一个变量比使用一个我不想插值的字符更常见。也就是说，我写得`'Hello, my name is $name'`比`"You owe me $1000"`.

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-31T00:00:11.560

至少，在不太完美的编辑器中，引用可以防止语法高亮保留字。查看：

```
$i{keys} = $a;
$i{values} = [1,2];
... 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-30T23:55:44.410

跟着报价走！它们在视觉上分解了语法，更多的编辑器将在语法高亮中支持它们（嘿，甚至 Stack Overflow 也在高亮引用版本）。我还争辩说，当编辑检查您是否结束了报价时，您会更快地注意到拼写错误。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-31T04:22:56.897

我更喜欢不带引号，除非我想要一些字符串插值。然后我使用双引号。我把它比作文字数字。Perl 确实允许您执行以下操作：

```
$achoo['1']  = 'kleenex';
$achoo['14'] = 'hankies'; 
```

但没有人这样做。而且它对清晰度没有帮助，仅仅是因为我们添加了另外两个字符来输入。就像有时我们特别希望数组中的插槽 #3 一样，有时我们希望`PATH`从`%ENV`. 就我而言，单引号不会增加*清晰度。*

Perl 解析代码的方式使得不可能在哈希索引中使用其他类型的“裸词”。

尝试

```
$myhash{shift} 
```

而且您只会将项目存储在密钥下的哈希中`'shift'`，您必须这样做

```
$myhash{shift()} 
```

为了指定您希望第一个参数来索引您的哈希。

此外，我使用[jEdit](http://jedit.org/)，这是*唯一*的可视化编辑器（除了 emacs 之外，我见过），它可以让*您*完全控制突出显示。所以这对我来说是双重清楚的。任何看起来像前者的东西都会得到 KEYWORD3 ($myhash) + SYMBOL ({) + LITERAL2 (shift) + SYMBOL (})，如果在结束花括号之前有一个括号，它会得到 KEYWORD3 + SYMBOL + KEYWORD1 + SYMBOL (()})。另外，我也可能会像这样格式化它：

```
$myhash{ shift() } 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-30T22:50:29.237

使用引号更好，因为它允许您使用裸字中不允许的特殊字符。通过使用引号，我可以在哈希键中使用我母语的特殊字符。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-31T05:08:45.103

您也可以在键前加上“ `-`”（减号），但请注意，这会将“ `-`”附加到键的**开头**。从我的一些代码：

```
$args{-title} ||= "Intrig"; 
```

我也使用单引号、双引号和无引号的方式。都在同一个程序中:-)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-01-01T10:23:08.980

我自己也想知道这一点，尤其是当我发现我犯了一些错误时：

```
 use constant CONSTANT => 'something';
 ...
 my %hash = ()
 $hash{CONSTANT}          = 'whoops!';  # Not what I intended
 $hash{word-with-hyphens} = 'whoops!';  # wrong again 
```

如果至少有一个文字键需要引号，我现在倾向于在每个哈希的基础上普遍应用引号；并使用带常量的括号：

```
 $hash{CONSTANT()} = 'ugly, but what can you do?'; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-31T06:43:55.863

我一直在不带引号的情况下使用它们，但我会重复使用严格和警告，因为它们会找出大多数常见错误。

# c# - 如何在 .NET 2.0 中打开多帧 TIFF 图像格式图像？

> ID：401561
> 
> 赞同：16
> 
> 时间：2008-12-30T21:25:33.790
> 
> 标签：c#, tiff, system.drawing

```
Image.FromFile(@"path\filename.tif") 
```

或者

```
Image.FromStream(memoryStream) 
```

即使源是多帧 TIFF 文件，两者都会产生只有一帧的图像对象。**如何加载保留这些帧的图像文件？**使用 Image.SaveAdd 方法逐帧保存 tiff。它们在其他查看器中工作，但 .NET Image 方法不会加载这些帧，只会加载第一个。

**这是否意味着无法从我传递位图集合以用作帧的方法返回多帧 TIFF？**

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-12-30T21:31:37.897

这是我使用的：

```
private List<Image> GetAllPages(string file)
{
    List<Image> images = new List<Image>();
    Bitmap bitmap = (Bitmap)Image.FromFile(file);
    int count = bitmap.GetFrameCount(FrameDimension.Page);
    for (int idx = 0; idx < count; idx++)
    {
        // save each frame to a bytestream
        bitmap.SelectActiveFrame(FrameDimension.Page, idx);
        MemoryStream byteStream = new MemoryStream();
        bitmap.Save(byteStream, ImageFormat.Tiff);

        // and then create a new Image from it
        images.Add(Image.FromStream(byteStream));
    }
    return images;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2016-12-28T16:41:50.943

我能够使用以下方法处理多帧 tiff。

```
Image multiImage = Image.FromFile(sourceFile);

multiImage.Save(destinationFile, tiff, prams);

int pageCount = multiImage.GetFrameCount(FrameDimension.Page);

for (int page = 1; page < pageCount; page++ )
{
    multiImage.SelectActiveFrame(FrameDimension.Page,page);
    multiImage.SaveAdd(dupImage,prams);
}

multiImage.SaveAdd(newPage, prams);
multiImage.Dispose(); 
```

我没有在 .net 2.0 中尝试过该解决方案，但 MSDN 显示类成员存在。它确实解决了我在 .net 4.5.2 中的问题。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2016-12-02T07:44:45.917

位图.Dispose();

在 For 循环之后，您需要 Dispose 位图。否则，当尝试在其他进程中使用相同的文件时，您会收到错误“使用其他进程的文件”。

# web-services - Why does the time matter in web services?

> ID：401575
> 
> 赞同：0
> 
> 时间：2008-12-30T21:29:42.643
> 
> 标签：web-services

In WCF web services (or all web services?), if the client and server times are off you get a security exception.

Can someone explain to me why this is?

It is a pain if you are building client server services and the time has to be accurate?

see: [http://msdn.microsoft.com/en-us/library/aa738468.aspx](http://msdn.microsoft.com/en-us/library/aa738468.aspx)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-30T21:35:47.827

I strongly suspect that this is to make replay attacks harder. These are attacks where a legitimate request and/or response captured by an attacker is sent again at a later time.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T21:36:19.543

I've seen that too.

My guess is that it is a securitymeassure. It will make it more difficult to record and replay messages, and sending them to the service repeatedly.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T22:35:05.697

Just use [NTP](http://www.ntp.org/) on both server and client to have their clocks synchronized, and you should be OK (unless I am missing something specific). NTP has servers worldwide and can work on both Unix and Windows. In Windows it is even a system property since at least WinXP times: check Date/Time settings "Internet Time" tab, and enter any of the publicly available NTP servers closest to you.

# profiler - 如何进行简介？

> ID：401581
> 
> 赞同：1
> 
> 时间：2008-12-30T21:31:54.090
> 
> 标签：profiler

我开发了一个小屏幕截图应用程序，但我听说我应该分析我的代码以查看它在哪里使用了大量资源和东西。

什么是分析器？它有什么作用？我在哪里可以免费获得它？以及如何使用它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T21:35:29.670

[分析器](http://en.wikipedia.org/wiki/Profiler_(computer_science))是一种软件工具，它拦截和测量应用程序特定运行中每个执行的代码路径。他们存储这些信息，然后以图形（或表格）的形式报告您的代码在哪里花费了大部分运行时间，以便您可以优化真正重要的地方。

关于在哪里获得，这取决于您的平台/语言组合。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T21:35:22.290

你用什么语言开发？对于 C#，请检查此问题。

[有没有像样的 C# 分析器？](https://stackoverflow.com/questions/10644/any-decent-c-profilers-out-there)

这是 C++ 的一个

[体面的 Windows 分析器？](https://stackoverflow.com/questions/170036/decent-profiler-for-windows)

事实上，检查分析器标签以查看所有与分析器相关的问题。

[https://stackoverflow.com/questions/tagged/profiler](https://stackoverflow.com/questions/tagged/profiler)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T21:36:57.887

看：

[你可以使用什么技术来配置你的代码](https://stackoverflow.com/questions/285710/what-techniques-can-you-use-to-profile-your-code)

你没有说你使用什么语言。对于 C/C++（可能还有其他），免费的有：

```
冠状病毒
gprof

```

# credit-card - ways to validate subscription service in freemium product is valid

> ID：401584
> 
> 赞同：2
> 
> 时间：2008-12-30T21:34:46.520
> 
> 标签：credit-card, billing

We have a freemium product, which menas that some functionality is available if the monthly subscription has been paid; if not paid, then the free capabilities remain available.

Here is how I am thinking of processing it, but wanted to check:

1) When someone purchased their subscription, a recurring billing schedule is created.

2) The user will have a field (paid_up) set to "y"

3) When the user logs back in, the authentication script checks if paid_up is "y". If it is, it creates a session token

4) I think I need a batch script which will switch the toggle. Wondering how to do it? Store the date of the last credit card successfully processed?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-30T21:43:55.750

Sure, you would create a column called 'last_payment'. If using MySQL, you could create this as a DATE field. Each tme you receive a monthly payment, I'm assuming the credit card billing company would post something to a script on your website. (i.e paypal sends IPNs). Each time this is received, you would do a query such as:

```
UPDATE members SET `last_payment`=CURDATE() WHERE user_id='$user_id'; 
```

I would suggest running a script on CRON that runs once every 24 hours, and does this query:

```
UPDATE members SET paid_up='N' WHERE DATEDIFF(CURDATE(),last_payment) > '30'; 
```

This would update all the records where payment hasnt been made for 30 days or more, and set the paid_up field to N. Then your normal login code would work.

If you don't want to use CRON, you could change your login query to something like this:

```
SELECT 1 FROM members WHERE 
username='$user' AND password='$password'
AND DATEDIFF(last_payment) <= '30'; 
```

By the way, your credit card processing company might have a way of sending you a POST when a subscription is canceled, which would enable you to set the paid_up field to N.

Hope this helps. Feel free to comment if you have any questions :)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T20:28:24.007

之前写过其中的一些，你应该做几件事。

首先，正如其他人所提到的，您需要某种paid_through_date 字段。出于多种原因，这很重要，但最主要的原因是它为您提供了额外的灵活性，以防万一，例如，您的服务器出现故障，并且您决定用户应该获得额外一天的免费服务。只需将他们的paid_through_date 值推后一天。这也使免费试用易于实施。

其次，即使您正在使用订阅系统，也不要使用 Authorize.net 的自动定期计费之类的东西。您希望完全控制何时安排付款，而在大多数情况下，将该责任转移给您的网关只是一个坏主意。大多数网关将允许您在其服务器上存储信用卡。他们会为您返还该卡的 ID，您可以针对该中间 ID 而不是卡本身开具费用。

第三，记录所有交易。我怎么强调都不过分。事实上，您可能也应该将此日志公开给用户。基本上只是一张他们已经支付的所有款项、金额和最终余额的表格。通常也将发票放入此表中。发票的金额为正数，付款和信用的金额为负数，用户只需将所有内容相加即可获得最终余额。如果需要，您可以非常轻松地将任意学分引入此表。

运行每 24 小时触发一次的 cron 脚本，检查用户需要哪些内容才能生成发票。这个 cron 脚本应该具有三个关键属性：首先，如果它由于某种原因没有运行，您不应该损失一天的费用。其次，如果它一天运行一次以上，或者它在中途中止并重新运行，它不应该向人们收取两次费用。第三，如果服务器上的日期意外更改为 2090，它不应该自动向所有用户收取数百万美元的费用。同样，重置为过去的日期（特别是 1970 年 1 月 1 日）也应该导致它引发地狱。根据我的经验，夏令时很少成为问题。

我认为这涵盖了大部分重要内容，但是您必须注意计费系统中的小问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T22:23:04.813

我会从另一端开始工作，并有一个付费字段，其中存储了付费日期。这样，您可以让用户在那里取消订阅，但仍然可以从他们支付的款项中受益。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-14T17:31:45.123

如果定期计费流程是您自己运行的，您可以将这些检查作为您流程的一部分。我在算法上考虑这个的方式是这样的：

对于每个到期的客户
    对其帐户运行计费
    如果成功：
        将重试次数重置为 0
        将他们标记为付费客户
        继续下一个帐户
    否则：
        增加他们的重试计数器
        向客户发送警报
        如果他们的重试计数器达到最大值：
             切换切换以将它们标记为免费

如果其他东西运行计费并告诉您结果，您可以批量执行相同操作，只需将“在他们的帐户上运行计费”替换为“读取上次计费尝试的结果”。您的重试计数器将实施类似于宽限期的东西，假设您的计费按每日计划运行，因此他们有机会解决计费问题，而不是仅仅因为他们的卡过期或诸如此类而撤销他们的高级功能。

# javascript - 了解使用 JavaScript 进行文本区域选择的情况

> ID：401593
> 
> 赞同：15
> 
> 时间：2008-12-30T21:37:04.890
> 
> 标签：javascript, textarea, selection

我正在开发`textarea`. 我已经开始寻找一些关于处理`textarea`选择的信息，并找到[了这个 jQuery 插件 fieldSelection](https://github.com/localhost/jquery-fieldselection)，它可以进行一些简单的操作。

但是，它并没有解释发生了什么。

我想更多地了解 JavaScript 中的 textarea 选择，最好是对前 DOM3 和后 DOM30 场景的描述。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2010-06-03T14:07:49.353

```
function get_selection(the_id)
{
    var e = document.getElementById(the_id);

    //Mozilla and DOM 3.0
    if('selectionStart' in e)
    {
        var l = e.selectionEnd - e.selectionStart;
        return { start: e.selectionStart, end: e.selectionEnd, length: l, text: e.value.substr(e.selectionStart, l) };
    }
    //IE
    else if(document.selection)
    {
        e.focus();
        var r = document.selection.createRange();
        var tr = e.createTextRange();
        var tr2 = tr.duplicate();
        tr2.moveToBookmark(r.getBookmark());
        tr.setEndPoint('EndToStart',tr2);
        if (r == null || tr == null) return { start: e.value.length, end: e.value.length, length: 0, text: '' };
        var text_part = r.text.replace(/[\r\n]/g,'.'); //for some reason IE doesn't always count the \n and \r in the length
        var text_whole = e.value.replace(/[\r\n]/g,'.');
        var the_start = text_whole.indexOf(text_part,tr.text.length);
        return { start: the_start, end: the_start + text_part.length, length: text_part.length, text: r.text };
    }
    //Browser not supported
    else return { start: e.value.length, end: e.value.length, length: 0, text: '' };
}

function replace_selection(the_id,replace_str)
{
    var e = document.getElementById(the_id);
    selection = get_selection(the_id);
    var start_pos = selection.start;
    var end_pos = start_pos + replace_str.length;
    e.value = e.value.substr(0, start_pos) + replace_str + e.value.substr(selection.end, e.value.length);
    set_selection(the_id,start_pos,end_pos);
    return {start: start_pos, end: end_pos, length: replace_str.length, text: replace_str};
}

function set_selection(the_id,start_pos,end_pos)
{
    var e = document.getElementById(the_id);

    //Mozilla and DOM 3.0
    if('selectionStart' in e)
    {
        e.focus();
        e.selectionStart = start_pos;
        e.selectionEnd = end_pos;
    }
    //IE
    else if(document.selection)
    {
        e.focus();
        var tr = e.createTextRange();

        //Fix IE from counting the newline characters as two seperate characters
        var stop_it = start_pos;
        for (i=0; i < stop_it; i++) if( e.value[i].search(/[\r\n]/) != -1 ) start_pos = start_pos - .5;
        stop_it = end_pos;
        for (i=0; i < stop_it; i++) if( e.value[i].search(/[\r\n]/) != -1 ) end_pos = end_pos - .5;

        tr.moveEnd('textedit',-1);
        tr.moveStart('character',start_pos);
        tr.moveEnd('character',end_pos - start_pos);
        tr.select();
    }
    return get_selection(the_id);
}

function wrap_selection(the_id, left_str, right_str, sel_offset, sel_length)
{
    var the_sel_text = get_selection(the_id).text;
    var selection =  replace_selection(the_id, left_str + the_sel_text + right_str );
    if(sel_offset !== undefined && sel_length !== undefined) selection = set_selection(the_id, selection.start +  sel_offset, selection.start +  sel_offset + sel_length);
    else if(the_sel_text == '') selection = set_selection(the_id, selection.start + left_str.length, selection.start + left_str.length);
    return selection;
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-31T17:20:09.247

从 PPK[对范围的介绍](http://www.quirksmode.org/dom/range_intro.html)开始。Mozilla 开发者连接有关于[W3C 选择](https://developer.mozilla.org/en/DOM/window.getSelection)的信息。[Microsoft在 MSDN 上记录了](http://msdn.microsoft.com/en-us/library/ms535869(VS.85).aspx)他们的系统。可以[在此处的答案](https://stackoverflow.com/questions/tagged/selection+javascript)中找到更多技巧。

除了不兼容的接口之外，您会很高兴知道`textarea`节点还有额外的怪异之处。如果我没记错的话，当您在 IE 中选择它们时，它们的行为与任何其他节点一样，但在其他浏览器中，它们具有独立的选择范围，通过节点上的`.selectionEnd`and`.selectionStart`属性公开。

此外，您应该真正将其`.contentEditable`视为实时编辑内容的一种方式。从 Firefox3 版本开始，现在所有浏览器都支持此功能。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-12-23T21:52:22.513

我刚刚采用了 user357565 提出的解决方案，并重新编码以供 jQuery 直接使用：

```
(function ($) {
  $.fn.get_selection = function () {
    var e = this.get(0);
    //Mozilla and DOM 3.0
    if('selectionStart' in e) {
      var l = e.selectionEnd - e.selectionStart;
      return { start: e.selectionStart, end: e.selectionEnd, length: l, text: e.value.substr(e.selectionStart, l) };
    }
    else if(document.selection) {    //IE
      e.focus();
      var r = document.selection.createRange();
      var tr = e.createTextRange();
      var tr2 = tr.duplicate();
      tr2.moveToBookmark(r.getBookmark());
      tr.setEndPoint('EndToStart',tr2);
      if (r == null || tr == null) return { start: e.value.length, end: e.value.length, length: 0, text: '' };
      var text_part = r.text.replace(/[\r\n]/g,'.'); //for some reason IE doesn't always count the \n and \r in length
      var text_whole = e.value.replace(/[\r\n]/g,'.');
      var the_start = text_whole.indexOf(text_part,tr.text.length);
      return { start: the_start, end: the_start + text_part.length, length: text_part.length, text: r.text };
    }
    //Browser not supported
    else return { start: e.value.length, end: e.value.length, length: 0, text: '' };
  };

  $.fn.set_selection = function (start_pos,end_pos) {
    var e = this.get(0);
    //Mozilla and DOM 3.0
    if('selectionStart' in e) {
      e.focus();
      e.selectionStart = start_pos;
      e.selectionEnd = end_pos;
    }
    else if (document.selection) { //IE
      e.focus();
      var tr = e.createTextRange();

      //Fix IE from counting the newline characters as two seperate characters
      var stop_it = start_pos;
      for (i=0; i < stop_it; i++) if( e.value[i].search(/[\r\n]/) != -1 ) start_pos = start_pos - .5;
      stop_it = end_pos;
      for (i=0; i < stop_it; i++) if( e.value[i].search(/[\r\n]/) != -1 ) end_pos = end_pos - .5;

      tr.moveEnd('textedit',-1);
      tr.moveStart('character',start_pos);
      tr.moveEnd('character',end_pos - start_pos);
      tr.select();
    }
    return this.get_selection();
  };

  $.fn.replace_selection = function (replace_str) {
    var e = this.get(0);
    selection = this.get_selection();
    var start_pos = selection.start;
    var end_pos = start_pos + replace_str.length;
    e.value = e.value.substr(0, start_pos) + replace_str + e.value.substr(selection.end, e.value.length);
    this.set_selection(start_pos,end_pos);
    return {start: start_pos, end: end_pos, length: replace_str.length, text: replace_str};
  };

  $.fn.wrap_selection = function (left_str, right_str, sel_offset, sel_length) {
    var the_sel_text = this.get_selection().text;
    var selection =  this.replace_selection(left_str + the_sel_text + right_str );
    if(sel_offset !== undefined && sel_length !== undefined) 
      selection = this.set_selection(selection.start +  sel_offset, selection.start +  sel_offset + sel_length);
    else if(the_sel_text == '') 
      selection = this.set_selection(selection.start + left_str.length, selection.start + left_str.length);
    return selection;
  };
}(jQuery)); 
```

我希望有人觉得它有用！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-19T06:41:51.773

我唯一可以补充的是，每当您操纵内容时，它似乎（没有真正尝试过）应该一直向上滚动。一个简单的补救措施是包装线

```
e.value = 
```

用两行来复制和恢复 scrollTop，如下所示：

```
var rememberScrollTop = e.scrollTop;
e.value = .... (same as in user357565 snippet)
e.scrollTop = rememberScrollTop; 
```

# java - 当用户键入时，如何获取 JTextField 内容的长度？

> ID：401598
> 
> 赞同：8
> 
> 时间：2008-12-30T21:41:38.127
> 
> 标签：java, swing, events, jtextfield

JTextField 有一个 keyTyped 事件，但似乎在它触发时单元格的内容尚未更改。

因此，如果在此处阅读， .length() 总是错误的。

必须有一种简单的方法来获取用户击键后出现的长度？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-30T21:48:56.257

这可能不是最佳方式（并且已经有一段时间了），但在过去，我已经向 JTextField 和任何事件（插入、更新、删除）添加了 DocumentListener：

```
evt.getDocument().getLength() 
```

它返回文本字段内容的总长度。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T21:50:15.473

这可能与此[“错误”（或更确切地说是“功能”）有关](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4140413)

> 在处理关键事件之前，侦听器会被通知关键事件，以允许侦听器通过使用它们来“窃取”事件。这提供了与消费事件的旧 awt 概念的兼容性。
> **“typed”事件并不意味着文本被输入到组件**中。这不是错误，而是预期的行为。

一个可能的解决方案是收听[相关的文档](http://www.velocityreviews.com/forums/t136479-jtextfield-cant-listen-when-the-text-is-changed.html)

```
// Listen for changes in the text
myTextField.getDocument().addDocumentListener(new DocumentListener() {
  public void changedUpdate(DocumentEvent e) {
  // text was changed
}
public void removeUpdate(DocumentEvent e) {
  // text was deleted
}
public void insertUpdate(DocumentEvent e) {
  // text was inserted
}
}); 
```

> 请注意，无论文本如何更改，这都有效；通过剪贴板剪切/粘贴、TextField 上的程序化“setText()”或用户在 UI 上的字段中键入。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T22:10:57.583

`KeyEvent`s 是在这里不合适的低级事件[听起来很熟悉]。

系统如何`JTextField`知道输入了一个字符？通过键类型事件（IIRC，通过 PL&F 完成）。事件是否在您的侦听器之前被分派到系统侦听器？它可能会也可能不会。

在这种情况下，您可能想要转到`Document`并添加更高级别的侦听器。对于 Swing，尽早选择模型是个好主意——“J”类接口是不连贯的。如果您正在拦截输入数据，那么您可能需要一个自定义模型（或者在`Document`a的情况下`DocumentFilter`）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-10-08T15:52:59.820

使用此代码：

```
public void jTextField6KeyReleased(java.awt.event.KeyEvent evt)
{
    System.out.println(jTextField6.getText().length());
} 
```

# wpf - 如何更改 ContentPresenter 上的 FontFamily？

> ID：401600
> 
> 赞同：42
> 
> 时间：2008-12-30T21:41:56.737
> 
> 标签：wpf, xaml, contentpresenter, font-family

我有一个用于扩展器的自定义模板，它与下面的代码很接近。我不得不更改一些代码来取出自定义类、画笔等。

```
<Style TargetType="{x:Type Expander}">
  <Setter Property="HorizontalContentAlignment"
          Value="Stretch" />
  <Setter Property="VerticalContentAlignment"
          Value="Top" />
  <Setter Property="BorderBrush"
          Value="Transparent" />
  <Setter Property="FontFamily"
          Value="Tahoma" />
  <Setter Property="FontSize"
          Value="12" />
  <Setter Property="Foreground"
          Value="Black" />
  <Setter Property="BorderThickness"
          Value="1" />
  <Setter Property="Margin"
          Value="2,0,0,0" />
  <Setter Property="Template">
    <Setter.Value>
      <ControlTemplate TargetType="{x:Type Expander}">
        <Border x:Name="Border"
                SnapsToDevicePixels="true"
                Background="White"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                Margin="0,0,0,10"
                Padding="0"
                CornerRadius="8">
          <DockPanel>
            <Border x:Name="HeaderSite"
                    Background="Blue"
                    CornerRadius="8"
                    Height="32"
                    DockPanel.Dock="Top">
              <DockPanel>
                <ToggleButton Foreground="White"
                              HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                              VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                              Margin="0"
                              MinHeight="0"
                              MinWidth="0"
                              Padding="6,2,6,2"
                              IsChecked="{Binding Path=IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                              DockPanel.Dock="Left">
                </ToggleButton>                

                <ContentPresenter SnapsToDevicePixels="True"
                                  HorizontalAlignment="Left"
                                  Margin="4,0,0,0"
                                  ContentSource="Header"
                                  VerticalAlignment="Center"
                                  RecognizesAccessKey="True" />
              </DockPanel>
            </Border>
            <Border x:Name="InnerBorder"
                    Margin="0" >
              <ContentPresenter Focusable="false"
                                Visibility="Collapsed"
                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                Margin="{TemplateBinding Padding}"
                                x:Name="ExpandSite"
                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                DockPanel.Dock="Bottom" />
            </Border>
          </DockPanel>
        </Border>
        <ControlTemplate.Triggers>
          <Trigger Property="IsExpanded"
                   Value="true">
            <Setter Property="Margin"
                    TargetName="InnerBorder"
                    Value="5" />           
            <Setter Property="Visibility"
                    TargetName="ExpandSite"
                    Value="Visible" />
          </Trigger>
          <Trigger Property="IsEnabled"
                   Value="false">
            <Setter Property="Foreground"
                    Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
          </Trigger>         
        </ControlTemplate.Triggers>
      </ControlTemplate>
    </Setter.Value>
  </Setter>
</Style> 
```

如您所见，有两个 ContentPresenter。我希望第一个使用 Tahoma Bold 作为字体而不是默认的 Tahoma。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-12-30T21:48:46.083

您需要使用 FontWeight 属性来指定粗体字体。但是，您可能已经注意到 ContentPresenter 没有该属性。因此，您需要使用[TextBlock.FontWeight](http://msdn.microsoft.com/en-us/library/system.windows.controls.textblock.fontweight.aspx)附加属性来告诉 ContentPresenter 其中的任何文本都应该是粗体。

试试这个：

```
<ContentPresenter TextBlock.FontFamily="Tahoma"
                  TextBlock.FontWeight="Bold"
                  SnapsToDevicePixels="True"
                  HorizontalAlignment="Left"
                  Margin="4,0,0,0"
                  ContentSource="Header"
                  VerticalAlignment="Center"
                  RecognizesAccessKey="True" /> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-11-11T13:20:38.537

我对 Silverlight 无能为力，但在新的 WPF 4 中，它是**TextElement**而不是 TextBlock

# html - Can't get CSS Sprite to work..what am I doing wrong?

> ID：401602
> 
> 赞同：2
> 
> 时间：2008-12-30T21:42:37.643
> 
> 标签：html, css, sprite, css-sprites

I am using [CSS Sprite Generator](http://spritegen.website-performance.org/) to create sprites for a web page I am working on, but it doesn't seem to work, and I don't know why...I guess it's something obvious but..!

So, I picked up 3 images, zipped, generated the PNG file (I checked out the result it is seems fine) and I got the following css classes back:

```
.sprite-welcom1 { background-position: 0 -30px; } 
.sprite-welcom3 { background-position: 0 -109px; } 
.sprite-3 { background-position: 0 -188px; } 
```

So here is the HTML I am testing on, and for some reason all I get is a nice blank page:

```
<html>
<head>
    <style>
    .sprite-welcom1 { background-position: 0 -30px; } 
    .sprite-welcom3 { background-position: 0 -109px; } 
    .sprite-3 { background-position: 0 -188px; } 

    .sprite-bg {
       background: url(csg-495a902b04181.png) no-repeat top left;
    }
    </style>
</head>
<body>
    <div class="sprite-bg sprite-3"></div>
</body>
</html> 
```

Any tips?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-02T12:36:11.790

不要使用发电机。花点时间从头开始自己做。然后下次使用此方法时，您将知道出现问题时要查找的内容，并且您将回答自己的问题，而且，也许其他人在 Stack Overflow 上。

此生成器不会为您的样式生成任何有意义的类名称，这意味着如果您稍后再编辑它们，除非您记住了数字，否则从周二开始您将不会知道两个类发生了什么。当您稍后返回样式表时，有意义的名称将让您头疼。

打开 Photoshop、GIMP 或几乎所有现代图像编辑软件。确保您的程序打开了标尺选项，并以这种方式测量元素的背景图像坐标。在没有标尺的情况下 - 这可能是一种罕见的情况，您总是可以使用[MeasureIt](https://addons.mozilla.org/en-US/firefox/addon/539) Firefox 扩展程序和在选项卡中打开的 .png。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T21:52:53.517

Define a width and height for `<div class="sprite-bg sprite-3">`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T21:49:39.220

Your `.sprite-bg` rule for `background-position`, set as part of the composite rule for `background` (the `top left` part), has higher precedence than the stand-alone `background-position` setting for `.sprite-3` because it appears later in the stylesheet.

Place the rule for `.sprite-bg` first.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T21:54:26.167

the div is empty. put something inside. like space (`&nbsp;`).

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-07-20T21:34:18.120

您必须为元素声明一个`height`and 。而已。`width`**`div`**

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T22:51:03.010

Hrm，不太确定您要在这里实现什么。多分类似乎有点混乱。我已经在下面发布了我的 spritemaps 方法，看看这是否符合您的需要。通常这涉及元素的组合，最常见的是带有导航链接的无序列表，但为此目的它只是 div。

也不要忘记背景位置的顺序。背景位置：|顶部| |左|;

这把我搞砸了几次。最后，A List Apart 有一篇关于 Sprite Maps 的精彩文章 ( [http://www.alistapart.com/articles/sprites/](http://www.alistapart.com/articles/sprites/) )

```
<html>
<head>
    <style>
    .sprite-container div {
       background: url(csg-495a902b04181.png) top left no-repeat;
       width: 20px; //width is neccessary
       height: 20px; //height is neccessary
    }

    .sprite-3 { background-position: 0 -188px; } 
    .sprite-4 { background-position: -20px -188px; }

    </style>
</head>
<body>
    <div class="sprite-container">
      <div class="sprite-3"></div>
      <div class="sprite-4"></div>
    </div>
</body>
</html> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T09:28:33.843

出于某种原因，Firefox 3 有时需要 CSS 选择器中的 2 个类来使精灵映射工作。我的预感是，在精灵贴图加载时，特异性规则会导致问题。通过添加附加类，它可以正常工作。

```
/* Bad  */ .childClass2 { background-position: -10px -20px; }
/* Good */ .parentClass1 .childClass2 { background-position: -10px -20px; } 
```

用 parentClass 给你的 CSS “命名空间”总是好的，以避免在其他地方意外地设置 DOM 标签的样式。以下是对上面每个人的想法的一些额外增强。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<HTML xmlns="http://www.w3.org/1999/xhtml">
<head>
    <style type="text/css">
    .sprite-container div {
       background: transparent url(//www.yourDomain.com/csg-495a902b04181.png) no-repeat scroll 0 0;
       width: 200px; /* width is necessary */
       height: 20px; /* height is necessary */
    }
    .sprite-container .sprite-3 { background-position: 0 -188px; } 
    .sprite-container .sprite-4 { background-position: -20px -188px; }
    </style>
</head>
<body>
    <div class="sprite-container">
      <div class="sprite-3"></div> 
      <div class="sprite-4"></div> 
      <!-- Empty divs are fine! Unless you *really* want text on top of
           your sprite map. :o) Btw: &shy; is invisible when a hyperlink
           is wrapped around it. &nbsp is not... it creates an 
           underscored hyperlink. Use &shy; which is a soft-hyphen.
       -->
    </div>
</body>
</html> 
```

此代码适用于：IE 7、Firefox 3、Google Chrome 1、Opera 9 和 Safari 3。

提示：在 URL 中避免 http:// 将允许从 http:// 和 https:// 连接提供 sprite 映射。

（向右滚动查看“ `no-repeat scroll 0 0;`”）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-20T17:15:06.393

正如其他人所提到的，你的 sprite-bg 元素需要有一些内容来给它一个高度/宽度，或者在 css 中指定这些属性，因此：

```
.sprite-bg {
  background: url(csg-495a902b04181.png) no-repeat top left;
  width: 100px; /* (or whatever the width should be) */
  height: 100px; /* (or whatever the height should be) */
} 
```

正如其他人提到的，我会将 .sprite-welcom1、.sprite-welcom3 和 .sprite-3 的规则移到样式表中的主要 .sprite-bg 下方。

# animation - Bouncing Card Algorithm

> ID：401604
> 
> 赞同：0
> 
> 时间：2008-12-30T21:44:33.630
> 
> 标签：animation

What's a good algorithm for "bouncing cards" like the ones you see in solitaire games?

What's the coolest card animation you've seen?

**Edit** - Any besides the Windows game?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T22:01:50.677

The x-axis velocity is constant. The y-velocity is incremented by some value every frame. Each frame, the current x and y positions are incremented by the respective velocities. If the card would end up below the window, y-velocity is multiplied by something like -0.9\. (negative number > -1) This produces the series of descending bounces.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T23:26:20.910

两部分：

1.  垂直方向的运动由二阶方程控制，如*d=1/2at²*。对于地球，当然，a= 32 ft/sec²，但你必须调整常数。
2.  当卡片碰到边缘时，正如“递归”所说，速度矢量乘以 -1 乘以垂直于表面的分量。如果您希望它很好地反弹到停止位置，请将 -1 设置为稍小的值，例如 -0.9。

通过每秒更新和重绘卡片若干次来为其设置动画，每次都改变卡片的位置。简单的方法是计算类似（伪 Python）：

```
vel_x = # some value, units/sec
vel_y = # some value, units/sec
acc_x = # some value in units/sec^2
acc_y = # some value in units/sec^2

while not_stopped():
    x = x+vel_x
    y = y+vel_y
    # redraw the card here at new position
    if card_collided():
       # do the bounce calculation

    vel_x = x + (0.5 * acc_x)    # 1st derivative, gives units/sec
    vel_y = y + (0.5 * acc_y) 
```

只要卡片与边保持四方形，那么当卡片中心与墙壁之间的距离为适当的宽度或高度的 1/2 时，您就会与边发生碰撞。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-11-22T20:10:16.283

在与 Charlie 提供的代码苦苦挣扎了一个小时左右之后，我想出了正确的算法（在彻底阅读了递归的响应之后）。在真正的 Python 中：

```
def bouncing_cards():
    x = 0.0
    y = 0.0
    vel_x = 3.0
    vel_y = 4.0

    while x < windowWidth:
        drawImage(img, x, y)
        x += vel_x
        y += vel_y
        vel_y += 1.0
        if y + cardHeight >= windowHeight:
            y = windowHeight - cardHeight
            vel_y *= -0.9 
```

使用 wxPython 提供以下内容：http: [//i.imgur.com/t51SXVC.png](http://i.imgur.com/t51SXVC.png) :)

# sql-server - 哪个更快？使用 "IN ('x', ''y')" 的多个 DELETE 语句或单个 DELETE 语句

> ID：401616
> 
> 赞同：10
> 
> 时间：2008-12-30T21:50:01.463
> 
> 标签：sql-server, database

只是想知道哪个更快：

```
DELETE FROM table_name WHERE X='1'
DELETE FROM table_name WHERE X='2'
DELETE FROM table_name WHERE X='3' 
```

或者

```
DELETE FROM table_name WHERE X IN ('1', '2', '3') 
```

有什么想法、提示或参考资料可以在哪里阅读？

谢谢你们！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-30T21:56:08.940

由于以下几个原因，单次删除会更快：

1.  只需要生成一个计划
2.  只涉及一项交易（如果您正在使用它们）
3.  如果您从代码中运行这些，那么 ODBC 调用和网络流量的开销就会减少
4.  任何索引都只需要刷新一次，而不是多次。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T21:52:42.350

单个删除更快，只有一个计划要创建和执行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T22:02:40.003

由于已经说明的原因，单个语句更快。

在给出的例子中

```
DELETE FROM table_name WHERE X BETWEEN 1 AND 3 
```

会更快，特别是如果你在 X 上有一个聚集索引。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T22:25:54.230

使用您的索引和数据在您的数据库中对其进行分析。我倾向于同意使用单个语句，但是，我可以想到一些快速实例，如果 3 个语句会快得多。如果它真的很重要，请对其进行分析。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-30T22:26:55.947

由于 kogus 提到的原因，单个删除通常更快。

但是...请记住，如果您必须清除 200 万行表中的 50%，并且该表有很多活动，则小批量删除或选择一个新表并交换该表可能是更好的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T23:30:55.490

单一声明：

```
DELETE FROM table_name WHERE X IN ('1', '2', '3') 
```

......会更快。我不确定您使用的是什么数据库，但我建议您查看查询的[*执行计划*](http://en.wikipedia.org/wiki/Query_plan)。如果您使用的是 MySQL，则可以使用 EXPLAIN 命令，例如：

```
EXPLAIN DELETE FROM table_name WHERE X IN ('1', '2', '3') 
```

同样，正如您在评论中所写，如果您希望动态填写 IN() 子句，您可以使用如下子查询：

```
DELETE FROM table_name WHERE x IN (SELECT id FROM table_name WHERE Y = Z) 
```

（管他呢）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-31T00:03:01.773

我认为您可能需要考虑第三种选择。我认为它可能比你的第一个例子更好，但不如你的第二个例子好。

如果您的数据库支持使用**准备好的语句**，那么您可以对语句进行准备。

```
DELETE FROM table_name WHERE X='?' 
```

然后简单地用值 1、2 和 3 调用它。

一般来说，我的经验是，当您使用像第二个示例这样的基于集合的操作时，您可以获得最佳性能。

# c++ - C++ 类型在列表中自我注册的最佳方式？

> ID：401621
> 
> 赞同：10
> 
> 时间：2008-12-30T21:51:08.093
> 
> 标签：c++

假设我有一些每类数据：（AandB.h）

```
class A
{
public:
   static Persister* getPersister();
}

class B
{
public:
   static Persister* getPersister();
} 
```

......还有很多很多的课程。我想做类似的事情：

```
persistenceSystem::registerPersistableType( A::getPersister() );
persistenceSystem::registerPersistableType( B::getPersister() );
...
persistenceSystem::registerPersistableType( Z::getPersister() ); 
```

...对于每个班级。

我的问题是：有没有办法自动构建每个类型的数据列表，这样我就不必在大块中枚举每种类型（如上面的示例所示）？

例如，您可以这样做的一种方法是：(AutoRegister.h)

```
struct AutoRegisterBase
{
   virtual ~AutoRegisterBase() {}
   virtual void registerPersist() = 0;
   static AutoRegisterBase*& getHead()
   {
      static AutoRegisterBase* head= NULL;
      return head;
   }

   AutoRegisterBase* next;
};

template <typename T>
struct AutoRegister : public AutoRegisterBase
{
   AutoRegister() { next = getHead(); getHead() = this; }

   virtual void registerPersist()
   {
       persistenceSystem::registerPersistableType( T::getPersister() );
   }
}; 
```

并按如下方式使用：(AandB.cxx: )

```
static AutoRegister<A> auto_a;
static AutoRegister<B> auto_b; 
```

现在，在我的程序启动后，我可以安全地执行以下操作：(main.cxx)

```
int main( int, char ** )
{
    AutoRegisterBase* p = getHead();
    while ( p )
    {
        p->registerPersist();
        p = p->next;
    }
    ...
} 
```

收集每种类型的每条数据，并将它们全部注册到某个地方的大列表中，以供以后狡猾的使用。

这种方法的问题是需要我在每种类型的某处添加一个 AutoRegister 对象。（即它不是很自动，很容易忘记做）。那么模板类呢？我真正想要的是模板类的实例化以某种方式导致该类在列表中自动注册。如果我能做到这一点，我将避免让类的用户（而不是作者）记住创建一个：

```
static AutoRegister< SomeClass<X1> > auto_X1;
static AutoRegister< SomeClass<X2> > auto_X2;
...
etc.... 
```

对于每个模板类实例化。

对于FIW，我怀疑没有解决方案。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-30T23:09:48.653

如果进行了模板的实例化，您可以在 main 之前执行一次。诀窍是将静态数据成员放入类模板中，并从外部引用它。静态数据成员触发的副作用可以用来调用寄存器函数：

```
template<typename D>
struct automatic_register {
private:
    struct exec_register {
        exec_register() {
            persistenceSystem::registerPersistableType(
                D::getPersister()
            );
        }
    };
    // will force instantiation of definition of static member
    template<exec_register&> struct ref_it { };

    static exec_register register_object;
    static ref_it<register_object> referrer;
};

template<typename D> typename automatic_register<D>::exec_register 
    automatic_register<D>::register_object; 
```

派生您想要自动注册的课程`automatic_register<YourClass>`。register 函数将在 main 之前调用，当`referrer`实例化的声明时（当该类派生时发生，这将隐式地从模板实例化该类）。

有一些测试程序（而不是注册函数，一个函数 do_it 被调用）：

```
struct foo : automatic_register<foo> {    
    static void do_it() {
        std::cout << " doit "; 
    } 
}; 

int main() { 
    std::cout << " main "; 
} 
```

产生这个输出（如预期的那样）：

```
doit main 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T22:50:28.050

在构造函数中在运行时注册每个模板。每个模板使用一个静态变量来检查类型是否已经注册。以下是一个快速破解的示例：

```
#include <iostream>
#include <vector>

using namespace std;

class Registerable {
    static vector<Registerable *> registry_;

public:
    static void registerFoo(Registerable *p)
    {
        registry_.push_back(p);
    }

    static void printAll()
    {
        for (vector<Registerable *>::iterator it = registry_.begin();
             it != registry_.end(); ++it)
            (*it)->print();
    }

    virtual void print() = 0;
};

vector<Registerable *> Registerable::registry_;

template <typename T>
class Foo : public Registerable {
    static bool registered_;

public:
    Foo()
    {
        if (!registered_) {
            registerFoo(this);
            registered_ = true;
        }
    }

    void print()
    {
        cout << sizeof (T) << endl;
    }
};

template <typename T> bool Foo<T>::registered_ = false;

int
main(int argc, char *argv[])
{
    Foo<char> fooChar;
    Foo<short> fooShort;
    Foo<int> fooInt;

    Registerable::printAll();

    return 0;
} 
```

它应该按照类被实例化的顺序输出每个模板参数的大小：

```
1
2
4 
```

* * *

这个版本从每个构造函数中删除了注册代码，并将其放在一个基类中。

```
#include <iostream>
#include <vector>

using namespace std;

class Registerable {
    static vector<Registerable *> registry_;

public:
    static void registerFoo(Registerable *p)
    {
        registry_.push_back(p);
    }

    static void printAll()
    {
        for (vector<Registerable *>::iterator it = registry_.begin();
             it != registry_.end(); ++it)
            (*it)->print();
    }

    virtual void print() = 0;
};

vector<Registerable *> Registerable::registry_;

template <typename T>
class Registerer : public Registerable {
    static bool registered_;

public:
    Registerer(T *self)
    {
        if (!registered_) {
            registerFoo(self);
            registered_ = true;
        }
    }
};

template <typename T> bool Registerer<T>::registered_ = false;

template <typename T>
class Foo : public Registerer<Foo<T> > {
public:
    Foo() : Registerer<Foo<T> >(this) { }

    void print()
    {
        cout << sizeof (T) << endl;
    }
};

int
main(int argc, char *argv[])
{
    Foo<char> fooChar;
    Foo<short> fooShort;
    Foo<int> fooInt;

    Registerable::printAll();

    return 0;
} 
```

我使用注册表添加了另一个非模板类的示例。因此，最终输出将是：

```
foo: 1
foo: 2
foo: 4
bar 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T23:07:27.877

Registerable 解决方案是一个好主意，但有几个问题。理想情况下，我不想向构造函数添加代码：

1.  因为它依赖于调用构造函数来注册类型，所以注册和不注册的内容有点随意。对于持久性之类的事情，我可能永远不会在使用列表之前调用特定类型的构造函数，但我可能需要列表中的类型数据才能知道如何取消持久化文件中的对象。

2.  在构造函数调用期间存在运行时成本。我想预先加载时间成本，而不是多次支付成本。如果我有这些对象的向量并调整向量的大小，我会在每次调用复制构造函数时付出时间成本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-04-16T22:55:16.363

## 使用文件级静态块来执行不同的注册

> 静态块？那是什么？

静态块是在运行之前的某个时间执行的代码块（即大括号之间的代码，它定义了一个范围）`main()`。Java[有这个特性](https://stackoverflow.com/questions/2943556/static-block-in-java)，C++也有——

> [到底在说什么，威利斯？](https://img.memesuper.com/7167e26fa81e5821d5e89cbd80eb4a2a_generators-d-and-memes-on-what-you-talkin-bout-willis-meme_510-383.jpeg)C++ 没有静态块！

不，真的，C++ 有静态块。你只需要，呃，我们应该说，[“暴露”他们的存在](https://stackoverflow.com/a/34321324/1593077)。

> 唔。好奇的。静态块如何帮助我解决注册问题？

这真的很简单。在你定义了 class 之后`A`，你像这样注册它：

```
class A { /* ... whatever ... */ };

static_block {
    persistenceSystem::registerPersistableType(A::getPersister());
} 
```

但是有一个警告：静态块可以与持久性系统的任何静态初始化部分一起成为[静态初始化顺序失败的一部分；](https://isocpp.org/wiki/faq/ctors#static-init-order)所以你需要确保这些静态块在（大多数）其他静态之前运行是可以的；并且可以以任意顺序注册不同类的 Persister。

# css - 设置打印 css 的好规则？

> ID：401623
> 
> 赞同：21
> 
> 时间：2008-12-30T21:52:23.270
> 
> 标签：css, printing

我正在寻找有关在打印网页时制作体面的打印 css 的任何建议/规则/指南。你有什么要提供的吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-30T22:01:34.903

以下是一些用于获得更好打印输出的通用打印样式：

```
/* Print styles */
@media print 
{
    tr, td, th {page-break-inside:avoid}
    thead {display:table-header-group}
    .NoPrint {visibility:hidden; display:none}
    a {color:#000000}
} 
```

最上面的一个可以防止表格行内的分页符

该thead 样式使thead 标记中的任何行对于表格跨越的每个页面都重复。

NoPrint 是我用来在屏幕上显示某些内容的类，但不是在打印中。

而且，我喜欢关闭链接颜色。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-30T22:06:27.127

首先阅读 A List Apart ( [http://www.alistapart.com/articles/goingtoprint/](http://www.alistapart.com/articles/goingtoprint/) ) 中的这篇文章。它们涵盖了您正在寻找的许多基础知识（扩展链接、粉饰等）。

不要依赖打印预览，确保在测试打印布局时完成整个过程。要节省纸张，请安装 SnagIt 或使用 Microsoft XPS 文档编写器。您可以直接打印到图像而不浪费任何纸张。

同样对于长文章，请考虑将字体更改为衬线。网络上的文章最容易阅读无衬线字体（Arial、Verdana），但印刷版则尝试 Times New Roman 或 Georgia。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-30T22:35:59.093

我确保放入打印样式表的一件事是：

```
a[href^="http://"]:after{
    content: " (" attr(href) ") ";
} 
```

这会在链接文本旁边写入实际链接，以便打印文档的人知道该链接是否应该去。

我还将正文文本设置为更易于打印：

```
body{
    font: 0.9em/1.5em Georgia, "Times New Roman", Times, serif;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-30T21:59:52.803

除了列表之外，您还有[Eric Meyer](http://www.alistapart.com/articles/goingtoprint/)的这篇旧但仍然相关的文章。

要点是重新开始，明确地将边框和边距/填充设置为 0，白色背景，并对任何非必要的打印元素“不显示”（如某些菜单）

```
<link rel="stylesheet"
   type="text/css"
   media="print" href="print.css" />

body {
    background: white;
    }

#menu {
    display: none;
    }

#wrapper, #content {
    width: auto; 
    margin: 0 5%;
    padding: 0; 
    border: 0;
    float: none !important;
    color: black; 
    background: transparent;
    } 
```

然后从那里走。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-30T22:29:51.180

当您定义印刷风格时，您必须考虑纸张和物理单位。

*   以厘米（英寸）为单位设置边距，以磅为单位设置字体大小（就像在 OpenOffice 中一样）。
*   创建一个像“screen”或“noprint”这样的类，以便能够轻松删除不需要的材料。
*   忘记花哨的彩色文本。白色背景上的黑色文本。
*   考虑删除多余的图像——它们在黑白中可能看起来不太好
*   从链接中删除下划线，并使链接具有合理的文本。阅读“检查此页面”看起来很愚蠢，其中“此”带有下划线。或者，如果您将链接的 href 放在带下划线的文本之后，那么它可能会更有用，但恕我直言，它看起来不太好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T21:55:15.370

注意背景图像和颜色。我认为 IE 的默认行为是不打印背景图像或颜色。

# javascript - 使用 JQuery 在 DOM 中捕获鼠标点击？

> ID：401628
> 
> 赞同：2
> 
> 时间：2008-12-30T21:53:17.433
> 
> 标签：javascript, jquery, dom, mouse

### 背景

我在 Web 应用程序中使用 POST 表单提交而不是带有串联参数的链接，因此我可以对输入进行控制。

不幸的是，这意味着用户无法使用他们知道的快速快捷方式在新窗口中打开链接，例如控制单击或中键单击。

### 问题

[根据W3C DOM 鼠标事件规范](http://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-MouseEvent "W3C DOM 事件规范")，我似乎有一种可行的方法来使用 jQuery 捕获鼠标输入和各种和弦键：

```
 $("span#clickspan").click( function(event) {

   buttonpress = event.button;
   ctrlpress = event.ctrlKey;

    $("#clickresult").empty();
    $("#clickresult").append("<p>Click!</p>");
    $("#clickresult").append("<p>Button # " + buttonpress + " pressed!</p>");
    if (ctrlpress) {
        $("#clickresult").append("<p>Control-click!</p>");
    }

    //form submission code would go here

    event.preventDefault();

    }
 ); 
```

我可以通过这种方式捕获控制点击（在 Firefox 3 和 IE7 中测试），并且它正确（？）报告左键点击来自鼠标按钮 #0，但由于某种原因，此代码仍然没有捕获中间点击跨度，并且右键单击仍然会弹出上下文菜单。至少，我想捕获中间点击。

有人可以帮忙吗？

### "控制"是什么意思

带有连接参数的 GET 提交/链接的问题是任何人都可以编辑地址栏并输入任何内容。我已经担心服务器端的身份验证和验证。这不是我想使用 POST 的原因。

我应该只向用户展示有意义的信息。内部数据库 ID 不是。我应该只让用户以有意义的方式与应用程序交互。任意编辑地址栏不是其中之一。

人们总是打错字。但是，从系统的角度来看，地址栏中的拼写错误与应用程序逻辑中的缺陷之间没有区别，我宁愿不将决定哪一个刚刚发生的责任推给用户。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-30T22:02:03.017

简短的回答？做不到。

长答案？ [Javascript 鼠标事件](http://unixpapa.com/js/mouse.html)。还是做不到。

这就引出了一个问题：您*需要*使用 POST 还是*只想*使用 POST ？您需要的唯一原因是查询字符串长度。至于想要，你提到“控制用户输入”。这到底是什么意思？

**您永远不应该依赖浏览器进行输入验证。** 您可以在此处进行操作以方便起见，但服务器应始终验证输入。

或者是审美的原因（即更短、“更好”的 URL）？

您正在重新发明超链接的轮子。我只是想确保您有一个非常好的理由这样做，因为它会适得其反，而且您永远不会获得与实际超链接相同的浏览器支持和兼容性。另外，您可能会因为让他们期望不起作用的东西而惹恼您的用户。不好。

# prolog - Prolog 上很好的初学者资料

> ID：401635
> 
> 赞同：70
> 
> 时间：2008-12-30T21:54:48.367
> 
> 标签：prolog, artificial-intelligence

我正在寻找关于 Prolog 的优秀初学者材料，包括在线和印刷版。我不仅对“学习语言”感兴趣，而且对背景和科学信息感兴趣。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2011-03-08T07:11:10.617

242.  [**Prolog 中的冒险**](http://www.amzi.com/AdventureInProlog/) Dennis Merritt | Springer 1990 年出版，186 页

243.  **[通过 Prolog 介绍逻辑编程](http://materi.uniku.ac.id/Ebook/ebook%20AI%20prolog/logic.pdf)** Michael Spivey | Prentice Hall 2008 年出版，258 页

244.  **[Prolog](http://bookboon.com/int/student/it/applications-of-prolog)** Attila CsenkiBookBoon 2009 年出版，203 页

245.  **[Prolog 的人工智能](http://faculty.nps.edu/ncrowe/book/book.html)** Neil C. Rowe | Prentice-Hall 1988 年出版，481 页

246.  [**在 Prolog 中构建专家系统**](http://www.amzi.com/ExpertSystemsInProlog/) Dennis Merritt | 安齐！公司 2000年出版，358页

247.  **[立即学习 Prolog！](http://www.learnprolognow.org/)** 帕特里克·布莱克本、约翰·博斯、克里斯蒂娜·斯特里格尼茨 | 学院刊物 2006年出版，284页

248.  **[逻辑、编程和 Prolog](http://www.ida.liu.se/~ulfni/lpp/bok/bok.pdf)** Ulf Nilsson, Jan Mauszynski | John Wiley & Sons Inc 1995 年出版，296 页

249.  **[Prolog 中的自然语言处理](http://www.informatics.sussex.ac.uk/research/groups/nlp/gazdar/nlp-in-prolog/)** Gerald Gazdar, Chris Mellish | Addison-Wesley 1989 年出版，519 页

250.  **[Prolog 和自然语言分析](http://www.mtome.com/Publications/PNLA/prolog-digital.pdf)** Fernando CN Pereira, Stuart M. Shieber | 语言与信息研究中心 2002 年出版，204 页

251.  **[离散数学、逻辑和可计算性中的 Prolog 实验](http://web.cecs.pdx.edu/~jhein/books/PrologLabBook09.pdf)** James Hein | 波特兰州立大学 2009 年出版，158 页

252.  **[Prolog 编程：第一门课程](http://homepages.inf.ed.ac.uk/pbrna/prologbook/)** Paul Brna | 1999 年出版

253.  **[Prolog 技术](http://bookboon.com/int/student/it/prolog-techniques-applications-of-prolog)** Attila Csenki | BookBoon 2009 年出版，186 页

254.  **[前 10 场 Prolog 编程竞赛](http://www.cs.kuleuven.be/~dtai/ppcbook/ppcbook.pdf)** Bart Demoen、Phuong-Lan Nguyen、Tom Schrijvers、Remko Troncon | 2005年出版，161页

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-12-30T22:51:43.307

立即查看[学习 Prolog！](http://www.learnprolognow.org/)

这本书写得很好，应该适合初学者阅读。它以印刷形式提供，也可以作为免费的在线版本提供。它也相对较新（从 2003 年开始），许多 Prolog 书籍并非如此。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-12-30T22:45:55.673

曾几何时，当我使用 Prolog 时，我喜欢 Sterling & Shapiro 的书，Prolog 的艺术。

对于高级 Prolog 编程，尤其是效率方面，我推荐 O'Keefe 的 Craft of Prolog。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-12-30T21:59:40.510

这是一本您可能会觉得有用的书： Ivan Bratko 的[Prolog Programming for Artificial Intelligence](https://rads.stackoverflow.com/amzn/click/com/0201403757)。

第一部分是关于 Prolog，第二部分是关于 AI 算法以及如何在 Prolog 中实现它们。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-08-28T21:28:35.547

在 Prolog 中编写[冒险游戏](http://www.amzi.com/AdventureInProlog/advfrtop.htm)也是一种很好的学习方式。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-07-21T17:25:13.450

如果您想对 Prolog 有一个非常容易理解和扎实的介绍（这更多的是“学习语言”），请参阅 Clocksin 和 Mellish*的“Prolog 中的编程：使用 ISO 标准”*，现在是第 5 版。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-30T22:58:55.460

这是一个包含大量有用链接的页面

[http://www.swi-prolog.org/www.html](http://www.swi-prolog.org/www.html)

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-12-30T23:12:20.487

试试[Logic、Programming 和 Prolog](http://www.ida.liu.se/~ulfni/lpp/)（免费下载）。我还没读过它，但它分为基础、逻辑编程和替代逻辑编程方案，所以听起来它适合每个人。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-11-10T02:27:44.410

你**必须**阅读[Nany 的教程](http://www.amzi.com/AdventureInProlog/a1start.htm)。在创建完整游戏的同时学习 Prolog。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-07-21T17:27:40.467

[#1](http://www.cse.unsw.edu.au/~billw/prologdict.html) [http://www.cse.unsw.edu.au/~billw/prologdict.html](http://www.cse.unsw.edu.au/~billw/prologdict.html)

[#2](http://www.engin.umd.umich.edu/CIS/course.des/cis479/prolog.html) [http://www.engin.umd.umich.edu/CIS/course.des/cis479/prolog.html](http://www.engin.umd.umich.edu/CIS/course.des/cis479/prolog.html)

[#3](http://www.csupomona.edu/~jrfisher/www/prolog_tutorial/contents.html#2) [http://www.csupomona.edu/~jrfisher/www/prolog_tutorial/contents.html#2](http://www.csupomona.edu/~jrfisher/www/prolog_tutorial/contents.html#2)

[#4](http://wiki.visual-prolog.com/index.php?title=Main_Page) [http://wiki.visual-prolog.com/index.php?title=Main_Page](http://wiki.visual-prolog.com/index.php?title=Main_Page)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-08-28T21:14:17.980

我还没有看到这本书提到过，并认为这是一本好书。

[给黑客的 Prolog 介绍](http://www.kuro5hin.org/story/2004/2/25/124713/784)

# visual-studio - 如何从 Visual Studio C# 使用 Office？

> ID：401637
> 
> 赞同：13
> 
> 时间：2008-12-30T21:55:19.083
> 
> 标签：visual-studio, excel, com, interop, ms-office

在 Visual Studio 中添加对 Office 的 COM 互操作的引用的技术是：

1.  参考
2.  添加参考
3.  选择**COM**选项卡
4.  选择**Microsoft Office 11.0 对象库**

神奇地命名参考出现：

```
Microsoft.Office.Core 
```

该`Project.csproj`文件显示了参考的详细信息：

```
<COMReference Include="Microsoft.Office.Core">
   <Guid>{2DF8D04C-5BFA-101B-BDE5-00AA0044DE52}</Guid>
   <VersionMajor>2</VersionMajor>
   <VersionMinor>3</VersionMinor>
   <Lcid>0</Lcid>
   <WrapperTool>primary</WrapperTool>
   <Isolated>False</Isolated>
</COMReference> 
```

并且该项目已签入源代码管理，一切都很好。

* * *

然后使用**Office 2007**的开发人员从源代码​​管理中获取项目，并且由于不存在这样的引用而无法构建它。

他（即我）签出 .csproj 文件，删除对

```
Microsoft Office 11.0 Object Library 
```

并将 COM 引用重新添加为

```
Microsoft Office 12.0 Object Library 
```

神奇地出现了一个命名引用：

```
Microsoft.Office.Core 
```

该`Project.csproj`文件显示了参考的详细信息：

```
<COMReference Include="Microsoft.Office.Core">
  <Guid>{2DF8D04C-5BFA-101B-BDE5-00AA0044DE52}</Guid>
  <VersionMajor>2</VersionMajor>
  <VersionMinor>4</VersionMinor>
  <Lcid>0</Lcid>
  <WrapperTool>primary</WrapperTool>
  <Isolated>False</Isolated>
</COMReference> 
```

并且该项目已签入源代码管理，一切都很好。

* * *

然后使用**Office 2003**的开发人员从源代码​​管理中获取项目，并且由于不存在这样的引用而无法构建它。

他（即不是我）签出 .csproj 文件，删除对

```
Microsoft Office 12.0 Object Library 
```

并将 COM 引用重新添加为

```
Microsoft Office 11.0 Object Library 
```

神奇地出现了一个命名引用：

```
Microsoft.Office.Core 
```

该`Project.csproj`文件显示了参考的详细信息：

```
<COMReference Include="Microsoft.Office.Core">
  <Guid>{2DF8D04C-5BFA-101B-BDE5-00AA0044DE52}</Guid>
  <VersionMajor>2</VersionMajor>
  <VersionMinor>3</VersionMinor>
  <Lcid>0</Lcid>
  <WrapperTool>primary</WrapperTool>
  <Isolated>False</Isolated>
</COMReference> 
```

并且该项目已签入源代码管理，一切都很好。

然后构建项目，将其压缩到**CD**上，然后发送给拥有**Office 2007**的客户。

一切都不好。

* * *

在过去（即在 .NET dll 地狱之前），我们会使用与**版本无关的 ProgID**来引用 Office 对象，即：

```
"Excel.Application" 
```

解析为已安装 Office 的**clsid**，例如

```
{00024500-0000-0000-C000-000000000046} 
```

然后使用对 COM（语言神经伪代码）的调用构造其中的一个类：

```
public IUnknown CreateOleObject(string className)
{
    IUnknown unk;

    Clsid classID = ProgIDToClassID(className);
    CoCreateInstance(classID, null, 
          CLSCTX_INPROC_SERVER | CLSCTX_LOCAL_SERVER, 
          IUnknown, out unk);

    return unk;
} 
```

* * *

## 问题

1) 自动化已安装的 Office 应用程序的批准技术是什么？

2) [Office 2003 主要互操作程序集](http://www.microsoft.com/downloads/details.aspx?familyid=3c9a983a-ac14-4125-8ba0-d36d67e0f4ad&displaylang=en)有什么用？

3) 如果我使用 Office 2003 主互操作程序集，我是否必须安装 Office 2003？

4) 如果我使用 Office 2003 主要互操作程序集进行构建，我的客户是否永远与 Office 20003 绑定？

5) 是否有任何**[Office 2007](http://www.microsoft.com/downloads/details.aspx?familyid=59DAEBAA-BED4-4282-A28C-B864D8BFA513&displaylang=en)**[主要互操作程序集](http://www.microsoft.com/downloads/details.aspx?familyid=59DAEBAA-BED4-4282-A28C-B864D8BFA513&displaylang=en)？

6) 如果我安装 Office 2007 主互操作程序集，我是否必须安装 Office 2007？

7) 使用标准 COM 互操作来驱动 Excel、Word 或 Outlook 有什么问题？例如：

```
[ComImport]
[Guid("00024500-0000-0000-C000-000000000046")]
public class Excel
{
} 
```

8) 当一个人添加一个

*   **参考****COM 选项卡**上的项目，
*   与使用 [ComImport] 不同，
*   而不是使用*Office 2007 主互操作程序集*？

**9) 使用COM 选项卡**添加引用是否与使用**COM interop**相同，只是它需要一个**类型库**才能看到它？

10) Office 2003 主要互操作程序集是否向后和向前兼容： - Office 14 - Office 2007 - Office 2003 - Office XP - Office 2000 - Office 97 - Office 95

如果客户和开发人员安装了新版本的 Office，它还能工作吗？

11) 我们是否必须将 Office 2003 主要互操作程序集与我们的应用程序一起提供？

12) 客户是否必须安装 Office 2003 主要互操作程序集才能使用我们的应用程序？

13) 如果客户安装 Office 2003 主要互操作程序集，他们是否必须安装**Office**？

14) 如果客户安装 Office 2003 主互操作程序集，他们是否必须安装 Office **2003**？

15) Office 2003 Primary Interop Assembles 是 Office 2003 的免费、精简、可再发行版本吗？

16) 如果我的开发机器安装了 Office 2007，我是否可以使用 Office 2003 PIA，并运送给安装了 Office XP 的客户？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T22:13:17.113

哇，这是一大堆问题。我认为，一般来说，如果您的应用程序使用 PIA，那么您假设您的目标受众安装了某些版本的 Office。当目标用户安装 Office 时，PIA 将安装在 GAC 中。如果他们没有安装 Office，那么您为什么要针对 Office？

是的，Office dll 是自动化 Office 的正确方法。[这里](http://msdn.microsoft.com/en-us/library/15s06t57(VS.80).aspx)有一个程序集列表，包括一些用于 Office 2007 的程序集。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-12T19:00:52.857

答案是“复制本地”任何您为互操作获得的程序集 dll。在输出文件夹中拥有程序集 dll 后，添加对它的引用，并将其检入源代码管理。

现在每个人都有引用的程序集 dll。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T22:05:02.247

你使用 VSTO（Visual Studio 办公工具）吗？

[http://msdn.microsoft.com/en-us/office/aa905533.aspx](http://msdn.microsoft.com/en-us/office/aa905533.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-20T07:29:45.143

一个旧线程，可能大多数人会对 CopyLocal=True 感到满意，但这是另一种方式..在项目文件中*同时*使用（或更多..？考虑 Office 2010，如果问题仍然存在..）引用，或者忽略或者只是告诉 MSBuild 忽略“MSB3284”警告（找不到库）。因此，将其包含在您的 .csproj 文件中：

```
<COMReference Include="Microsoft.Office.Core">
   <Guid>{2DF8D04C-5BFA-101B-BDE5-00AA0044DE52}</Guid>
   <VersionMajor>2</VersionMajor>
   <VersionMinor>3</VersionMinor>
   <Lcid>0</Lcid>
   <WrapperTool>primary</WrapperTool>
   <Isolated>False</Isolated>
</COMReference> 
```

其次是：

```
<COMReference Include="Microsoft.Office.Core">
   <Guid>{2DF8D04C-5BFA-101B-BDE5-00AA0044DE52}</Guid>
   <VersionMajor>2</VersionMajor>
   <VersionMinor>4</VersionMinor>
   <Lcid>0</Lcid>
   <WrapperTool>primary</WrapperTool>
   <Isolated>False</Isolated>
</COMReference> 
```

我很想看看微软是否为此提供了一个 NuGet 库——只是为了让每个人都采用相同的方法。我认为这将消除人们在网上搜索这些答案的必要性......我相信这将违反 Microsoft Office 的许可证，因此他们是唯一提供它的人。

顺便说一句，使用本地副本，您必须小心不要错误地重新分发这些库。

# php - PHP 密码的安全哈希和盐

> ID：401656
> 
> 赞同：1231
> 
> 时间：2008-12-30T22:02:45.637
> 
> 标签：php, security, passwords, hash, protection

目前据说MD5部分不安全。考虑到这一点，我想知道使用哪种机制来保护密码。

这个问题，[“双重哈希”密码是否比仅哈希一次更安全？](https://stackoverflow.com/questions/348109/is-double-hashing-a-password-less-secure-than-just-hashing-it-once) 建议多次散列可能是一个好主意，而[如何为单个文件实施密码保护？](https://stackoverflow.com/questions/55862/how-to-implement-password-protection-for-individual-files#55904)建议使用盐。

我正在使用 PHP。我想要一个安全快速的密码加密系统。将密码散列一百万次可能更安全，但也更慢。如何在速度和安全之间取得良好的平衡？另外，我希望结果具有恒定数量的字符。

1.  散列机制必须在 PHP 中可用
2.  它必须是安全的
3.  它可以使用盐（在这种情况下，所有盐都一样好吗？有什么方法可以产生好的盐吗？）

另外，我是否应该在数据库中存储两个字段（例如，一个使用 MD5，另一个使用 SHA）？它会让它更安全还是更不安全？

如果我不够清楚，我想知道要使用哪个散列函数以及如何选择好的盐，以便拥有安全快速的密码保护机制。

*不完全涵盖我的问题的相关问题：*

[PHP简单密码加密](https://stackoverflow.com/questions/30946/simple-password-encryption)[中SHA和MD5有什么区别](https://stackoverflow.com/questions/157998/whats-the-difference-between-sha-and-md5-in-php)
[存储密钥的安全方法，asp.net的密码](https://stackoverflow.com/questions/198803/secure-methods-of-storing-keys-passwords-for-asp-net)
[如何在Tomcat 5.5中实现加盐密码](https://stackoverflow.com/questions/205153/how-would-you-implement-salted-passwords-in-tomcat-5-5)

* * *

## 回答 #1

> 赞同：1013
> 
> 时间：2008-12-30T22:15:09.027

> **免责声明**：这个答案写于 2008 年。
> 
> 从那时起，PHP 就给了我们[`password_hash`](http://php.net/manual/en/function.password-hash.php)，[`password_verify`](http://php.net/manual/en/function.password-verify.php)而且，自从他们推出以来，它们就是推荐的密码散列和检查方法。
> 
> 答案的理论仍然是一个很好的阅读。

## TL;博士

### 不要做

*   不要限制用户可以输入哪些字符作为密码。只有白痴才会这样做。
*   不要限制密码的长度。如果您的用户想要一个带有 supercalifragilisticexpialidocious 的句子，请不要阻止他们使用它。
*   不要去除或转义密码中的 HTML 和特殊字符。
*   切勿以纯文本形式存储用户密码。
*   永远不要通过电子邮件向您的用户发送密码，*除非他们丢失了密码，并且您发送了一个临时密码。*
*   永远不要以任何方式记录密码。
*   切勿使用[SHA1](http://arstechnica.com/security/2012/12/oh-great-new-attack-makes-some-password-cracking-faster-easier-than-ever/)或 MD5 甚至 SHA256 散列密码！[现代破解器](http://securityledger.com/new-25-gpu-monster-devours-passwords-in-seconds/)可以超过 60 和 1800 亿哈希/秒（分别）。
*   不要将[bcrypt 和hash()的*原始*](http://blog.ircmaxell.com/2015/03/security-issue-combining-bcrypt-with.html)输出混合使用，要么使用十六进制输出，要么使用 base64_encode。（这适用于任何可能包含恶意`\0`的输入，这会严重削弱安全性。）

### 多斯

*   尽可能使用 scrypt；bcrypt 如果你不能。
*   如果您不能使用 bcrypt 或 scrypt 以及 SHA2 哈希，请使用 PBKDF2。
*   当数据库被破坏时重置每个人的密码。
*   实现一个合理的 8-10 个字符的最小长度，加上至少需要 1 个大写字母、1 个小写字母、一个数字和一个符号。这将提高密码的熵，从而使其更难破解。（有关辩论，请参阅“什么是好的密码？”部分。）

## 为什么要散列密码呢？

散列密码背后的目标很简单：通过破坏数据库来防止恶意访问用户帐户。因此，密码散列的目标是通过花费太多时间或金钱来计算纯文本密码来阻止黑客或破解者。时间/成本是您武器库中最好的威慑力量。

您希望用户帐户具有良好、强大的散列的另一个原因是给您足够的时间来更改系统中的所有密码。如果您的数据库受到威胁，您将需要足够的时间来*至少*锁定系统，如果不更改数据库中的每个密码的话。

Whitehat Security 的 CTO Jeremiah Grossman在最近一次密码恢复需要暴力破解他的密码保护后[在 White Hat Security 博客上表示：](https://www.whitehatsec.com/blog/cracking-aes-256-dmgs-and-epic-self-pwnage/)

> 有趣的是，在经历这场噩梦的过程中，我学到了很多我不知道的密码破解、存储和复杂性。*我开始明白为什么密码存储比密码复杂性重要得多。如果您不知道密码是如何存储的，那么您真正可以依赖的只是复杂性。*这可能是密码和加密专业人士的常识，但对于普通的 InfoSec 或 Web 安全专家来说，我非常怀疑。

（强调我的。）

## 什么才是*好的*密码？

[熵](http://xkcd.com/936/)。（并不是说我完全赞同兰德尔的观点。）

简而言之，熵是密码中有多少变化。当密码只有小写罗马字母时，只有 26 个字符。那变化不大。字母数字密码更好，有 36 个字符。但是允许大小写，带符号，大约是 96 个字符。这比单纯的字母好多了。一个问题是，为了让我们的密码容易记住，我们插入了模式——这会降低熵。哎呀！

密码熵很容易[近似。](https://ritcyberselfdefense.wordpress.com/2011/09/24/how-to-calculate-password-entropy/)使用全范围的 ascii 字符（大约 96 个可键入字符）会产生每个字符 6.6 的熵，对于未来的安全性来说，8 个字符的密码仍然太低（52.679 位的熵）。但好消息是：更长的密码和带有 unicode 字符的密码，确实会增加密码的熵并使其更难破解。

[Crypto StackExchange](https://crypto.stackexchange.com/questions/374/how-should-i-calculate-the-entropy-of-a-password)网站上对密码熵进行了更长的讨论。一个好的谷歌搜索也会出现很多结果。

在我与@popnoodles 交谈的评论中，他指出使用 X 多个字母、数字、符号等*执行X 长度的密码策略实际上可以通过使密码方案更可预测来减少熵。*我同意。尽可能真正随机的随机性始终是最安全但最不令人难忘的解决方案。

据我所知，制作世界上最好的密码是 Catch-22。要么不令人难忘、太可预测、太短、太多 unicode 字符（难以在 Windows/Mobile 设备上输入）、太长等。没有任何密码真正足以满足我们的目的，因此我们必须像保护它们一样保护它们在诺克斯堡。

## 最佳实践

Bcrypt 和[scrypt](http://www.tarsnap.com/scrypt.html)是当前的最佳实践。[Scrypt](http://www.tarsnap.com/scrypt.html)在时间上会比 bcrypt 更好，但它还没有被 Linux/Unix 或网络服务器作为标准采用，并且还没有发布对其算法的深入评论。但是，该算法的未来确实看起来很有希望。如果你正在使用 Ruby，有一个[scrypt gem](http://rubygems.org/gems/scrypt)可以帮助你，Node.js 现在有它自己的[scrypt](https://npmjs.org/package/scrypt)包。您可以通过[Scrypt](https://pecl.php.net/package/scrypt)扩展或[Libsodium](https://paragonie.com/book/pecl-libsodium/read/07-password-hashing.md)扩展（两者都在 PECL 中可用）在 PHP 中使用 Scrypt。

我强烈建议您阅读[crypt 函数](http://us.php.net/crypt)的文档，如果您想了解如何使用 bcrypt，或者为自己找到一个[好的](https://stackoverflow.com/questions/4795385/how-do-you-use-bcrypt-for-hashing-passwords-in-php/6337021#6337021) [包装器](https://gist.github.com/1070401)或使用[PHPASS 之](http://www.openwall.com/phpass/)类的东西来实现更传统的实现。我建议至少 12 轮 bcrypt，如果不是 15 到 18 轮。

当我了解到 bcrypt 只使用带有可变成本机制的河豚密钥计划时，我改变了使用 bcrypt 的想法。后者让您通过增加河豚已经很昂贵的密钥计划来增加暴力破解密码的成本。

## 平均做法

我几乎无法再想象这种情况了。[PHPASS](http://www.openwall.com/phpass/)支持 PHP 3.0.18 到 5.3，因此几乎可以在所有可以想象的安装中使用它——如果您*不确定*您的环境是否支持 bcrypt，则应该使用它。

但是假设你根本不能使用 bcrypt 或 PHPASS。然后怎样呢？

尝试使用您的环境/应用程序/用户感知可以容忍的[最大轮数来实现](https://security.stackexchange.com/questions/3959/recommended-of-iterations-when-using-pkbdf2-sha256)[PDKBF2 。](http://www.itnewb.com/tutorial/Encrypting-Passwords-with-PHP-for-Storage-Using-the-RSA-PBKDF2-Standard)我推荐的最低数量是 2500 发。此外，请确保使用[hash_hmac()](http://php.net/hash_hmac)如果它可以使操作更难重现。

## 未来实践

PHP 5.5 中出现了一个[完整的密码保护库](http://php.net/manual/en/ref.password.php)，它消除了使用 bcrypt 的任何痛苦。虽然我们大多数人在最常见的环境（尤其是共享主机）中都坚持使用 PHP 5.2 和 5.3，但@ircmaxell 已经为即将到来的 API 构建了一个[兼容层](https://github.com/ircmaxell/password_compat)，该层向后兼容 PHP 5.3.7。

## 密码学回顾和免责声明

*实际破解*散列密码所需的计算能力并不存在。计算机“破解”密码的唯一方法是重新创建密码并模拟用于保护密码的哈希算法。散列的速度与其被暴力破解的能力呈线性关系。更糟糕的是，大多数哈希算法可以轻松并行化以更快地执行。这就是为什么像 bcrypt 和 scrypt 这样昂贵的方案如此重要的原因。

您不可能预见到所有威胁或攻击途径，因此您必须尽最大努力预先保护您的**用户**。如果你不这样做，那么你甚至可能会错过你被攻击的事实，直到为时已晚......*你要承担责任*。为了避免这种情况，一开始就表现得偏执。攻击您自己的软件（内部）并尝试窃取用户凭据，或修改其他用户的帐户或访问他们的数据。如果您不测试系统的安全性，那么除了您自己之外，您不能责怪任何人。

最后：我不是密码学家。我所说的都是我的观点，但我碰巧认为它是基于良好的常识......以及大量阅读。请记住，尽可能多疑，让事情尽可能难以入侵，然后，如果您仍然担心，请联系白帽黑客或密码学家，看看他们对您的代码/系统的看法。

* * *

## 回答 #2

> 赞同：145
> 
> 时间：2011-11-08T12:02:52.677

一个更短更安全的答案 -**根本不要编写自己的密码机制**，使用久经考验的机制。

*   PHP 5.5 或更高版本：[password_hash()](http://php.net/manual/en/function.password-hash.php)质量很好，是 PHP 核心的一部分。
*   PHP 4.x（过时）：OpenWall 的[phpass](http://www.openwall.com/phpass/)库比大多数自定义代码要好得多 - 用于 WordPress、Drupal 等。

大多数程序员只是不具备在不引入漏洞的情况下安全地编写与加密相关的代码的专业知识。

**快速自测：**什么是密码拉伸以及您应该使用多少次迭代？如果您不知道答案，您应该使用`password_hash()`，因为密码拉伸现在是密码机制的一个关键特性，因为 CPU 速度更快，并且使用[GPU 和 FPGA以](http://blog.crackpassword.com/2012/07/accelerating-password-recovery-the-addition-of-fpga/)[每秒数十亿次猜测](http://en.wikipedia.org/wiki/Password_cracking#Time_needed_for_password_searches)的速度破解密码（使用 GPU ）。

截至 2012 年，您可以使用 5 台台式电脑中安装的 25 个 GPU[在 6 小时内破解所有 8 个字符的 Windows 密码。](http://arstechnica.com/security/2012/12/25-gpu-cluster-cracks-every-standard-windows-password-in-6-hours/)这是暴力破解，即枚举和检查*每个 8 字符的 Windows 密码*，包括特殊字符，而不是字典攻击。使用现代 GPU，您当然可以破解更多密码或使用更少的 GPU - 或者以合理的成本在云中租用 GPU 几个小时。

也有很多针对 Windows 密码的彩虹表攻击，运行在普通 CPU 上，速度非常快。

这一切都是因为 Windows*仍然* [不会加盐或延长](https://docs.microsoft.com/en-us/windows-server/security/kerberos/passwords-technical-overview)其密码，[即使在 Windows 10](https://www.guidingtech.com/61991/cracking-windows-10-password-prevent/)中也是如此。在 2021 年仍然如此。不要犯和微软一样的错误！

**也可以看看：**

*   [很好的答案](https://stackoverflow.com/questions/1581610/how-can-i-store-my-users-passwords-safely/1581919#1581919)，更多关于为什么`password_hash()`或是`phpass`最好的方法。
*   [不错的博客文章](https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2015/march/enough-with-the-salts-updates-on-secure-password-schemes/)，为主要算法（包括 bcrypt、scrypt 和 PBKDF2）提供了推荐的“工作因素”（迭代次数）。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-12-30T22:18:10.237

我不会以两种不同的方式存储散列密码，因为这样系统至少与使用的最弱散列算法一样弱。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2014-09-21T21:33:41.317

自 PHP 5.5 起，PHP 具有用于散列和验证密码的简单、安全的函数[password_hash()](http://php.net/manual/en/function.password-hash.php)和[password_verify()](http://php.net/manual/en/function.password-verify.php)

```
$password = 'anna';
$hash = password_hash($password, PASSWORD_DEFAULT);
$expensiveHash = password_hash($password, PASSWORD_DEFAULT, array('cost' => 20));

password_verify('anna', $hash); //Returns true
password_verify('anna', $expensiveHash); //Also returns true
password_verify('elsa', $hash); //Returns false 
```

使用时`password_hash()`，它会生成一个随机盐并将其包含在输出的哈希中（以及使用的成本和算法。）`password_verify()`然后读取该哈希并确定使用的盐和加密方法，并根据提供的明文密码对其进行验证。

提供`PASSWORD_DEFAULT`指示 PHP 使用已安装版本的 PHP 的默认散列算法。确切地说，这意味着哪种算法打算在未来的版本中随着时间的推移而改变，因此它将始终是最强大的可用算法之一。

增加成本（默认为 10）使哈希更难暴力破解，但也意味着生成哈希并针对它们验证密码将为您的服务器的 CPU 做更多的工作。

请注意，即使默认散列算法可能会发生变化，旧的散列仍将继续验证，因为使用的算法存储在散列中并`password_verify()`从中提取。

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2010-02-12T00:52:13.353

尽管问题已得到解答，但我只想重申，用于散列的盐应该是随机的，而不是像第一个答案中建议的电子邮件地址。

更多解释可在 - [http://www.pivotalsecurity.com/blog/password-hashing-salt-should-it-be-random/](http://www.pivotalsecurity.com/blog/password-hashing-salt-should-it-be-random/)

> 最近我讨论了用随机位加盐的密码哈希是否比用可猜测或已知盐加盐的密码哈希更安全。让我们看看：如果存储密码的系统以及存储随机盐的系统被破坏，攻击者将可以访问哈希和盐，所以盐是否是随机的，并不重要。攻击者可以生成预先计算好的彩虹表来破解哈希。有趣的部分来了——生成预先计算的表并不是那么简单。让我们以 WPA 安全模型为例。您的 WPA 密码实际上从未发送到无线接入点。相反，它使用您的 SSID（网络名称，如 Linksys、Dlink 等）进行哈希处理。这里有一个很好的解释它是如何工作的。为了从哈希中检索密码，您将需要知道密码和盐（网络名称）。Church of Wifi 已经预先计算了哈希表，其中包含前 1000 个 SSID 和大约 100 万个密码。所有表的大小约为 40 GB。正如您在他们的网站上看到的，有人使用 15 个 FGPA 阵列 3 天来生成这些表。假设受害者使用 SSID 为“a387csf3”，密码为“123456”，会被那些表破解吗？不！.. 这不可以。即使密码很弱，这些表也没有 SSID a387csf3 的哈希值。这就是随意加盐的美妙之处。它将阻止那些在预先计算的表格上茁壮成长的饼干。它可以阻止一个坚定的黑客吗？可能不是。但是使用随机盐确实提供了额外的防御层。当我们讨论这个话题时，让我们讨论在单独的系统上存储随机盐的额外优势。场景 #1：密码哈希存储在系统 X 上，用于哈希的盐值存储在系统 Y 上。这些盐值是可猜测的或已知的（例如用户名）场景 #2：密码哈希存储在系统 X 上，盐值用于散列存储在系统 Y 上。这些盐值是随机的。如果系统 X 被破坏，你可以猜到，在单独的系统上使用随机盐有一个巨大的优势（场景 #2）。攻击者需要猜测附加值才能破解哈希。如果使用 32 位盐，则猜测的每个密码可能需要 2^32= 4,294,967,296（约 42 亿）次迭代。密码散列存储在系统 X 上，用于散列的盐值存储在系统 Y 上。这些盐值是可猜测的或已知的（例如用户名） 场景#2：密码散列存储在系统 X 上，用于散列的盐值存储在系统 X 上系统 Y。这些盐值是随机的。如果系统 X 被破坏，你可以猜到，在单独的系统上使用随机盐有一个巨大的优势（场景 #2）。攻击者需要猜测附加值才能破解哈希。如果使用 32 位盐，则猜测的每个密码可能需要 2^32= 4,294,967,296（约 42 亿）次迭代。密码散列存储在系统 X 上，用于散列的盐值存储在系统 Y 上。这些盐值是可猜测的或已知的（例如用户名） 场景#2：密码散列存储在系统 X 上，用于散列的盐值存储在系统 X 上系统 Y。这些盐值是随机的。如果系统 X 被破坏，你可以猜到，在单独的系统上使用随机盐有一个巨大的优势（场景 #2）。攻击者需要猜测附加值才能破解哈希。如果使用 32 位盐，则猜测的每个密码可能需要 2^32= 4,294,967,296（约 42 亿）次迭代。这些盐值是随机的。如果系统 X 被破坏，你可以猜到，在单独的系统上使用随机盐有一个巨大的优势（场景 #2）。攻击者需要猜测附加值才能破解哈希。如果使用 32 位盐，则猜测的每个密码可能需要 2^32= 4,294,967,296（约 42 亿）次迭代。这些盐值是随机的。如果系统 X 被破坏，你可以猜到，在单独的系统上使用随机盐有一个巨大的优势（场景 #2）。攻击者需要猜测附加值才能破解哈希。如果使用 32 位盐，则猜测的每个密码可能需要 2^32= 4,294,967,296（约 42 亿）次迭代。

* * *

## 回答 #6

> 赞同：29
> 
> 时间：2013-04-27T21:41:15.257

我只想指出 PHP 5.5 包含一个[密码哈希 API](http://www.php.net/manual/en/ref.password.php)，它提供了一个`crypt()`. 此 API 显着简化了散列、验证和重新散列密码散列的任务。作者还发布了一个[兼容性包](https://github.com/ircmaxell/password_compat)（以单个 password.php 文件的形式，您可以`require`轻松使用），供那些使用 PHP 5.3.7 及更高版本并希望立即使用它的用户使用。

它目前仅支持 BCRYPT，但它旨在轻松扩展以包含其他密码散列技术，并且由于该技术和成本作为散列的一部分存储，因此对您首选的散列技术/成本的更改不会使当前的散列无效，框架验证时会自动使用正确的技术/成本。如果您没有明确定义自己的盐，它还会处理生成“安全”盐。

API 公开了四个函数：

*   `password_get_info()`- 返回有关给定哈希的信息
*   `password_hash()`- 创建密码哈希
*   `password_needs_rehash()`- 检查给定的哈希是否与给定的选项匹配。检查散列是否符合您当前的技术/成本方案很有用，允许您在必要时重新散列
*   `password_verify()`- 验证密码是否与哈希匹配

目前，这些函数接受 PASSWORD_BCRYPT 和 PASSWORD_DEFAULT 密码常量，它们目前是同义词，不同之处在于 PASSWORD_DEFAULT“可能会在更新的 PHP 版本中发生变化，当支持更新、更强的散列算法时”。在登录时使用 PASSWORD_DEFAULT 和 password_needs_rehash() （并在必要时重新散列）应该确保您的散列对蛮力攻击具有相当的弹性，对您几乎没有任何工作。

编辑：我刚刚意识到罗伯特 K 的回答中简要提到了这一点。我将把这个答案留在这里，因为我认为它提供了更多关于它如何工作以及它为那些不了解安全性的人提供的易用性的信息。

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2012-06-26T08:05:12.333

我正在使用[Phpass](http://www.openwall.com/phpass/)，它是一个简单的单文件 PHP 类，几乎可以在每个 PHP 项目中轻松实现。另请参阅[H](http://www.h-online.com/security/features/Storing-passwords-in-uncrackable-form-1255576.html?page=4)。

默认情况下，它使用在 Phpass 中实现的最强大的可用加密，这是`bcrypt`并且回落到其他加密到 MD5，以提供对 Wordpress 等框架的向后兼容性。

返回的哈希可以按原样存储在数据库中。生成哈希的示例用法是：

```
$t_hasher = new PasswordHash(8, FALSE);
$hash = $t_hasher->HashPassword($password); 
```

要验证密码，可以使用：

```
$t_hasher = new PasswordHash(8, FALSE);
$check = $t_hasher->CheckPassword($password, $hash); 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2014-04-09T15:01:02.887

**要记住的事情**

关于 PHP 的密码加密已经说了很多，其中大部分都是非常好的建议，但在您开始使用 PHP 进行密码加密的过程之前，请确保您已实施或准备实施以下内容。

**服务器**

*端口*

如果您没有正确保护运行 PHP 和 DB 的服务器，那么无论您的加密有多好，您的所有努力都是毫无价值的。大多数服务器的功能相对相同，它们分配了端口以允许您通过 ftp 或 shell 远程访问它们。确保更改您激活的远程连接的默认端口。通过不这样做，您实际上使攻击者在访问您的系统时少了一步。

*用户名*

对于世界上所有的好东西，不要使用用户名 admin、root 或类似的东西。此外，如果您使用的是基于 unix 的系统，请不要让 root 帐户登录可访问，它应该始终只能是 sudo。

*密码*

您告诉您的用户使用正确的密码以避免被黑客入侵，也这样做。当后门大开时，努力锁上前门有什么意义。

**数据库**

*服务器*

理想情况下，您希望您的数据库和应用程序位于不同的服务器上。由于成本的原因，这并不总是可行的，但它确实可以保证一定的安全性，因为攻击者必须经过两个步骤才能完全访问系统。

*用户*

始终让您的应用程序拥有自己的帐户来访问数据库，并且只为其提供所需的权限。

然后为您创建一个单独的用户帐户，该帐户不存储在服务器上的任何位置，甚至不在应用程序中。

像往常一样不要做这个根或类似的东西。

*密码*

遵循与所有良好密码相同的准则。也不要在同一系统上的任何 SERVER 或 DB 帐户上重复使用相同的密码。

**PHP**

*密码*

永远不要在你的数据库中存储密码，而是存储哈希和唯一的盐，我稍后会解释原因。

*哈希*

单向哈希!!!!!!!，永远不要以可以反转的方式对密码进行哈希处理，哈希应该是一种方式，这意味着您不会将它们反转并将它们与密码进行比较，而是对输入的密码进行哈希处理同样的方式并比较两个哈希值。这意味着即使攻击者可以访问数据库，他也不知道实际密码是什么，只知道其生成的哈希值。这意味着在最坏的情况下为您的用户提供更高的安全性。

那里有很多很好的散列函数（`password_hash`,`hash`等...），但是您需要选择一个好的算法才能使散列有效。（bcrypt 和类似的算法都是不错的算法。）

当哈希速度是关键时，越慢越能抵抗蛮力攻击。

散列中最常见的错误之一是散列不是用户独有的。这主要是因为盐不是唯一生成的。

*盐*

密码应始终在散列之前加盐。Salting 会在密码中添加一个随机字符串，因此类似的密码在数据库中不会出现相同的情况。但是，如果盐不是每个用户唯一的（即：您使用硬编码的盐），那么您几乎会使您的盐一文不值。因为一旦攻击者找出一个密码盐，他就拥有了所有这些盐。

当您创建盐时，请确保它对于盐的密码是唯一的，然后将完成的哈希和盐都存储在您的数据库中。这样做的目的是使攻击者必须单独破解每个盐和哈希，然后才能获得访问权限。这意味着攻击者需要更多的工作和时间。

*用户创建密码*

如果用户通过前端创建密码，则意味着必须将其发送到服务器。这带来了一个安全问题，因为这意味着未加密的密码正在发送到服务器，如果攻击者能够监听和访问，那么您在 PHP 中的所有安全性都是毫无价值的。始终安全地传输数据，这是通过 SSL 完成的，但是即使 SSL 也不是完美无缺的（OpenSSL 的 Heartbleed 缺陷就是一个例子）。

还要让用户创建一个安全密码，这很简单，应该始终这样做，用户最终会感激不尽。

最后，无论您采取什么安全措施都不是 100% 安全的，要保护的技术越先进，攻击就越先进。但是遵循这些步骤将使您的网站更加安全，并且更不适合攻击者追捕。

这是一个 PHP 类，可以轻松地为密码创建哈希和盐

[http://git.io/mSJqpw](http://git.io/mSJqpw)

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2008-12-30T22:20:54.337

谷歌表示 SHA256 可用于 PHP。

你绝对应该使用盐。我建议使用随机字节（而不是限制自己使用字符和数字）。通常，您选择的时间越长，它就越安全，速度越慢。我猜 64 字节应该没问题。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-12-30T22:29:28.640

最后，从数学上讲，双重哈希并没有带来任何好处。然而，在实践中，它对于防止基于彩虹表的攻击很有用。换句话说，它并不比使用盐进行散列更有好处，后者在您的应用程序或服务器上花费的处理器时间要少得多。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2013-09-19T13:26:29.167

我在这里找到了关于这个问题的完美话题：[https](https://crackstation.net/hashing-security.htm) ://crackstation.net/hashing-security.htm ，我希望你能从中受益，这里的源代码也可以防止基于时间的攻击。

```
<?php
/*
 * Password hashing with PBKDF2.
 * Author: havoc AT defuse.ca
 * www: https://defuse.ca/php-pbkdf2.htm
 */

// These constants may be changed without breaking existing hashes.
define("PBKDF2_HASH_ALGORITHM", "sha256");
define("PBKDF2_ITERATIONS", 1000);
define("PBKDF2_SALT_BYTES", 24);
define("PBKDF2_HASH_BYTES", 24);

define("HASH_SECTIONS", 4);
define("HASH_ALGORITHM_INDEX", 0);
define("HASH_ITERATION_INDEX", 1);
define("HASH_SALT_INDEX", 2);
define("HASH_PBKDF2_INDEX", 3);

function create_hash($password)
{
    // format: algorithm:iterations:salt:hash
    $salt = base64_encode(mcrypt_create_iv(PBKDF2_SALT_BYTES, MCRYPT_DEV_URANDOM));
    return PBKDF2_HASH_ALGORITHM . ":" . PBKDF2_ITERATIONS . ":" .  $salt . ":" . 
        base64_encode(pbkdf2(
            PBKDF2_HASH_ALGORITHM,
            $password,
            $salt,
            PBKDF2_ITERATIONS,
            PBKDF2_HASH_BYTES,
            true
        ));
}

function validate_password($password, $good_hash)
{
    $params = explode(":", $good_hash);
    if(count($params) < HASH_SECTIONS)
       return false; 
    $pbkdf2 = base64_decode($params[HASH_PBKDF2_INDEX]);
    return slow_equals(
        $pbkdf2,
        pbkdf2(
            $params[HASH_ALGORITHM_INDEX],
            $password,
            $params[HASH_SALT_INDEX],
            (int)$params[HASH_ITERATION_INDEX],
            strlen($pbkdf2),
            true
        )
    );
}

// Compares two strings $a and $b in length-constant time.
function slow_equals($a, $b)
{
    $diff = strlen($a) ^ strlen($b);
    for($i = 0; $i < strlen($a) && $i < strlen($b); $i++)
    {
        $diff |= ord($a[$i]) ^ ord($b[$i]);
    }
    return $diff === 0; 
}

/*
 * PBKDF2 key derivation function as defined by RSA's PKCS #5: https://www.ietf.org/rfc/rfc2898.txt
 * $algorithm - The hash algorithm to use. Recommended: SHA256
 * $password - The password.
 * $salt - A salt that is unique to the password.
 * $count - Iteration count. Higher is better, but slower. Recommended: At least 1000.
 * $key_length - The length of the derived key in bytes.
 * $raw_output - If true, the key is returned in raw binary format. Hex encoded otherwise.
 * Returns: A $key_length-byte key derived from the password and salt.
 *
 * Test vectors can be found here: https://www.ietf.org/rfc/rfc6070.txt
 *
 * This implementation of PBKDF2 was originally created by https://defuse.ca
 * With improvements by http://www.variations-of-shadow.com
 */
function pbkdf2($algorithm, $password, $salt, $count, $key_length, $raw_output = false)
{
    $algorithm = strtolower($algorithm);
    if(!in_array($algorithm, hash_algos(), true))
        die('PBKDF2 ERROR: Invalid hash algorithm.');
    if($count <= 0 || $key_length <= 0)
        die('PBKDF2 ERROR: Invalid parameters.');

    $hash_length = strlen(hash($algorithm, "", true));
    $block_count = ceil($key_length / $hash_length);

    $output = "";
    for($i = 1; $i <= $block_count; $i++) {
        // $i encoded as 4 bytes, big endian.
        $last = $salt . pack("N", $i);
        // first iteration
        $last = $xorsum = hash_hmac($algorithm, $last, $password, true);
        // perform the other $count - 1 iterations
        for ($j = 1; $j < $count; $j++) {
            $xorsum ^= ($last = hash_hmac($algorithm, $last, $password, true));
        }
        $output .= $xorsum;
    }

    if($raw_output)
        return substr($output, 0, $key_length);
    else
        return bin2hex(substr($output, 0, $key_length));
}
?> 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2008-12-30T22:18:25.993

我通常使用带有用户 ID（或其他一些用户特定信息）的 SHA1 和 salt，有时我还使用常量 salt（所以我有 2 个部分的 salt）。

SHA1 现在也被认为有些妥协，但程度远低于 MD5。通过使用盐（任何盐），您可以防止使用通用[彩虹表](http://en.wikipedia.org/wiki/Rainbow_table)来攻击您的哈希（有些人甚至通过搜索哈希成功地将 Google 用作一种彩虹表）。可以想象，攻击者可以使用您的 salt 生成彩虹表，因此您应该包含用户特定的 salt。这样，他们将不得不为系统中的每条记录生成一个彩虹表，而不仅仅是为整个系统生成一个彩虹表！使用这种加盐方式，即使是 MD5 也是相当安全的。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-12-30T22:21:57.767

[在可预见的将来， SHA1](http://php.net/sha1)和盐应该就足够了（当然，这取决于您是为[Fort Knox](http://en.wikipedia.org/wiki/United_States_Bullion_Depository)编写代码还是为您的购物清单编写登录系统）。如果 SHA1 对您来说不够好，请使用[SHA256](http://php.net/manual/en/function.hash.php)。

可以说，盐的想法是使散列结果失去平衡。例如，已知空字符串的 MD5 散列是`d41d8cd98f00b204e9800998ecf8427e`. 因此，如果有足够好的记忆力的人会看到该散列并知道它是空字符串的散列。但是，如果字符串被加盐（例如，使用字符串“ `MY_PERSONAL_SALT`”），则“空字符串”（即“ `MY_PERSONAL_SALT`”）的散列变为`aeac2612626724592271634fb14d3ea6`，因此回溯不明显。我想说的是，使用*任何*盐都比不使用要好。*因此，知道使用哪种*盐并不重要。

实际上有一些[网站就是这样做的](http://gdataonline.com/seekhash.php)——你可以给它一个（md5）散列，它会吐出一个已知的明文来生成那个特定的散列。如果您可以访问存储普通 md5-hash 的数据库，那么将管理员的哈希输入到此类服务并登录将是微不足道的。但是，如果密码被加盐，这样的服务将变成无效。

此外，双散列通常被认为是不好的方法，因为它减少了结果空间。所有流行的哈希都是固定长度的。因此，您只能有这个固定长度的有限值，并且结果变得更少变化。这*可以*被视为另一种形式的盐渍，但我不推荐它。

* * *

## 回答 #14

> 赞同：-7
> 
> 时间：2015-10-08T04:05:05.313

好的，我们需要盐 盐必须是唯一的，所以让我们生成它

```
 /**
     * Generating string
     * @param $size
     * @return string
     */
    function Uniwur_string($size){
        $text = md5(uniqid(rand(), TRUE));
        RETURN substr($text, 0, $size);
    } 
```

我们还需要我使用 sha512 的哈希，它是最好的，它在 php 中

```
 /**
     * Hashing string
     * @param $string
     * @return string
     */
    function hash($string){
        return hash('sha512', $string);
    } 
```

所以现在我们可以使用这个函数来生成安全密码

```
// generating unique password
$password = Uniwur_string(20); // or you can add manual password
// generating 32 character salt
$salt = Uniwur_string(32);
// now we can manipulate this informations

// hashin salt for safe
$hash_salt = hash($salt);
// hashing password
$hash_psw = hash($password.$hash_salt); 
```

现在我们需要在数据库中保存我们的 $hash_psw 变量值和 $salt 变量

并且为了授权，我们将使用相同的步骤......

这是保护我们客户密码的最佳方式...

Ps 对于最后两个步骤，您可以使用自己的算法...但请确保您可以在将来需要授权用户时生成此哈希密码...

# c# - CheckedListBox 中不可检查的项目？

> ID：401659
> 
> 赞同：4
> 
> 时间：2008-12-30T22:03:23.340
> 
> 标签：c#, list, checkedlistbox

在 .NET 框架中，是否可以将其中的某些项目设置`CheckedListBox`为“不可检查”？我不想让用户再次检查相同的项目并将它们添加到另一个现有列表中。

我希望我很清楚。提前致谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-30T22:12:53.227

我会在代码中将这些项目设置为“不确定”，然后在用户尝试选中/取消选中它们时覆盖 ItemCheck 事件中的“NewValue”属性：

```
public Form1()
{
    InitializeComponent();
    checkedListBox1.Items.Add("Can't check me", CheckState.Indeterminate);
}

private void checkedListBox1_ItemCheck(object sender, ItemCheckEventArgs e)
{
    if (e.CurrentValue == CheckState.Indeterminate)
    {
        e.NewValue = CheckState.Indeterminate;
    }
} 
```

CheckedListBox 中的“Can't check me”项无法修改，因为每次用户尝试选中/取消选中它时，事件处理程序都会将其更改回来。您甚至看不到相应的 UI 更新。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-30T22:40:15.873

马特的代码很好。

然而，为什么在checkedlistbox中有一个项目而不让它被选中？
我的意思是为什么在列表中有那个项目。

# .net - ReportViewer 可以呈现具有相对路径的超链接吗？

> ID：401664
> 
> 赞同：0
> 
> 时间：2008-12-30T22:06:11.243
> 
> 标签：.net, winforms, reportviewer, hyperlink

我已经在具有名为“RelativePath”的字段的数据源上创建了一个本地报告。当我的 WinForms 应用程序呈现报表时，它会将文件导出到相对路径字段中指定的位置。在报表生成器中，我将 Navigation|Hyperlink action|Jump to URL 设置为“=Fields!RelativePath.Value”，并将报表的 EnableHyperlink 属性设置为 true。但是，每当我的应用程序呈现报告时，超链接都处于非活动状态。但是，如果我将跳转到 URL 硬编码为绝对路径，它就可以正常工作。ReportViewer 是否不呈现具有相对路径的超链接？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-07T07:16:37.500

我一直在努力解决同样的问题，之后我得出结论，reportviewer 不支持具有相对路径的超链接。解决这个问题的方法是添加一个自定义代码，该代码检索相对路径，然后与您可能希望成为 URL 一部分的字段值连接 - 至少对我有用。

沙迪

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-07-11T19:50:47.913

我遇到了同样的问题。为了解决这个问题，我创建了一个名为“AbsolutePath”的报告参数。

转到 .rdlc 文件的设计视图。在“报告数据”选项卡上，您将看到一个“参数”节点。右键单击它以：

1.  添加参数...
2.  在常规选项卡上，在名称属性中输入“AbsolutePath”。
3.  点击“默认值”
4.  选择“指定值”单选按钮。
5.  添加新值“AbsolutePath”。

在您的文本框的操作表达式中，添加类似这样的内容 ="javascript:void(window.open('" + **Parameters!AbsolutePath.Value** + "/yourpage.aspx?id=" + Fields!Id.Value + "', '_blank '))”

您可以看到新的“AbsolutPath”参数可添加到您的表达式中。

现在，您需要将值传递给报告的参数，就像这样。

```
 string baseUrl = Request.Url.GetLeftPart(UriPartial.Authority);
    var param = new ReportParameter("AbsolutePath", baseUrl);
    this.ReportViewer.LocalReport.SetParameters(param); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-10-15T18:02:56.087

只需`Globals!ReportServerUrl`在表达式中使用全局变量

```
= Globals!ReportServerUrl + "yourpath" 
```

# .net - Windows 窗体的 Visual Studio 单元测试

> ID：401667
> 
> 赞同：12
> 
> 时间：2008-12-30T22:06:43.553
> 
> 标签：.net, winforms, visual-studio-2008, unit-testing, nunit

我们正在使用 Visual Studio 2008 开发一个项目。我们正在使用随它提供的内置测试套件（Microsoft.VisualStudio.TestTools.UnitTesting 命名空间）。事实证明，让我们非常懊恼的是，大量的复杂性（以及因此的错误）最终被编码到我们的 UI 层中。虽然我们的单元测试在覆盖我们的业务层方面做得不错，但我们的 UI 层一直是令人恼火的来源。理想情况下，我们也希望对其进行单元测试。有谁知道在视觉工作室中这样做的一种很好的“微软兼容”方式？它是否会引入某种冲突以将诸如[nUnitForms](http://nunitforms.sourceforge.net/)之类的单元测试框架与 Microsoft 的东西“混合”在一起？对于单元测试表格，我应该注意哪些明显的陷阱？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T22:15:35.157

您需要重构 UI，以便 UI 不需要任何单元测试。UI 应包含最少的业务逻辑或不包含业务逻辑。有很多模式可以处理这个问题。Martin Fowler 有一篇非常好的文章，对这些模式进行了很多解释：[http ://martinfowler.com/eaaDev/uiArchs.html](http://martinfowler.com/eaaDev/uiArchs.html)

Martin Fowler 的 Refactoring 书中有一小章讨论了重构不可测试的 UI。您还可以阅读有效地使用旧代码。

注意：有一些工具可用于自动化 UI 测试。我想到了 SilkTest。但如果可能的话，我不会使用它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-24T23:22:34.673

对于常规的应用程序单元测试来说，这一切都很好……但是如果您正在构建需要对控件行为和状态进行单元测试的用户控件，那么它也需要一个单元测试框架。NUnitForms 可能是您的答案 - 我个人需要自己检查一下。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T23:16:47.513

我使用此处详细介绍的被动视图架构[http://martinfowler.com/eaaDev/PassiveScreen.html](http://martinfowler.com/eaaDev/PassiveScreen.html)

基本上将表单中的所有代码移动到一个名为 xxxUI 的单独类中。然后该表单实现一个 IxxxUI 接口并公开 xxxUI 类需要的任何内容。您可能可以简化事情并将处理多个控件的方法汇总到一种方法中。

然后流程继续 用户单击一个按钮。按钮调用相应 UI 类的方法。传递任何需要的参数。UI 类方法修改模型。然后使用界面更新 UI。

对于单元测试，您有测试或虚拟类实现接口并将自己注册到 UI 类。您可以让这些测试类触发任何类型的输入并做出相应的响应。通常我有序列表，它们以精确的顺​​序做事。（点击A，点击这个，滚动那个，然后键入B，等等）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-24T07:42:34.157

使用 ApprovalTests（www.approvaltests.com 或 nuget 批准测试）测试 Winform 非常容易，并且它们与 MsTest 和 Nunit 兼容。

这里有一个如何做到这一点的视频：[https ://www.youtube.com/watch?v=hKeKBjoSfJ8](https://www.youtube.com/watch?v=hKeKBjoSfJ8)

但过程很简单。1）创建要在您希望验证的状态下测试的表单。2) 调用 WinFormApprovals.Verify(form)

ApprovalTests 使用黄金大师范式对结果进行屏幕捕获。如果您喜欢它，只需将文件重命名为 .approved 即可通过测试。

重构现有代码的好处是你甚至不必担心结果是什么，因为你只关心你没有改变它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-11-27T20:00:50.400

对于 Windows 10，微软现在推荐使用带有 WinAppDriver 的 Appium。VS 2019 将是最后一个包含 Microsoft Coded UI 的版本。

[https://docs.microsoft.com/en-us/visualstudio/test/use-ui-automation-to-test-your-code?view=vs-2019](https://docs.microsoft.com/en-us/visualstudio/test/use-ui-automation-to-test-your-code?view=vs-2019)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-25T18:13:08.007

查看 Jeremy D. Miller 的 WIP [Presentation Patterns wiki 页面](http://www.jeremydmiller.com/ppatterns/MainPage.ashx)以获得重构灵感：)

米勒正在写一本书，看起来它将成为这类事情的必备品。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-10-19T07:15:11.157

在测试我自己的 UI 控件时，我使用过 NUnitForms，效果很好！如果您使用标准（或经过良好测试）的 UI 控件，我会同意其他人的重构。

如果重点是测试实际控件，我会使用 NUnitForms，因为它可以扩展以支持您的新控件。无论如何，如果您不涉及任何手动测试，您将需要一个可以对显示的最终结果进行“基于图像”分析的库。

我已经为此尝试过TestComplete，但我认为它有点太贵了，因为我可以编写一个类似的库来仅在c#中进行图像比较。所以我的计划是分别测试控件，然后重构 UI，就像我的其他人提到的那样。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-06-19T09:12:11.010

您应该使用 Microsoft Coded UI 来测试 UI 层。这涉及编写（或记录）模拟用户将执行的操作的测试和编写断言语句以确保实现正确的输出。

当然，这不是单元测试是有争议的，因为很难从前端创建测试单个工作单元的操作，并且不能替代其他单元测试。我也同意前端业务逻辑应该尽可能薄。但是，这将填补单元测试未涵盖的任何空白。希望您的单元测试不会涵盖只有小的工作单元，以便编码的 UI 测试将捕获剩余的未测试单元。

编码的 UI 内置于最新版本的 Visual Studio Premium。我建议你不要只使用记录功能，而是学习如何自己编写测试，因为这会给你更大的灵活性。

# jquery - 如何使用 jQuery 获取 CSS 注释？

> ID：401668
> 
> 赞同：4
> 
> 时间：2008-12-30T22:07:05.440
> 
> 标签：jquery, css, comments

我想知道如何从链接的样式表中读取 CSS 注释。

我通过以下方式加载了这个示例 CSS：

```
<link rel="stylesheet" type="text/css" media="all" href="test.css" /> 
```

```
#test1{ border:1px solid #000; }
#test2{ border:1px solid #000; }
#test3{/* sample comment text I'm trying to read */} 
```

我正在FF3中测试这个。以下 javascript 读取规则但不读取`#test3`.

```
window.onload = function(){
    s=document.styleSheets;
    for(i=0;i < s[0].cssRules.length;i++){
        alert(s[0].cssRules[i].cssText);
    }
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-30T22:40:40.817

您可以检索样式表的内容并使用正则表达式来解析注释。这个例子使用 jQuery 来获取样式表文本和一个正则表达式来查找注释：

```
jQuery.get("test.css", null, function(data) {
    var comments = data.match(/\/\*.*\*\//g);
    for each (var c in comments) 
        alert(c);
}); 
```

您还可以使用选择器找到样式表链接。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T22:09:31.770

解释几乎总是会忽略注释，因此将不可用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-30T22:35:48.877

您可以使用 AJAX 查询访问 CSS 文件，然后自己解析结果以查找注释。口译员就不会碍事了。

只要 CSS 与页面在同一个域中，这将很好地工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T22:10:04.247

你不能，这就是评论的全部意义所在。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T22:19:22.077

您无法读取 CSS 文件 JavaScript，只需检查 DOM 中的结果。一种可能的方法是使用嵌入式样式表，您可以在其中通过 DOM 接口查询样式标签的文本内容。当然，您必须自己解析内容。

# c# - How do IN () statements work in NHibernate? (Using Criteria)

> ID：401674
> 
> 赞同：2
> 
> 时间：2008-12-30T22:10:43.450
> 
> 标签：c#, .net, nhibernate, criteria

I'm trying to create the equivalent of the below using NHibernate. I've done all the mappings using fluent and I can do the basic queries just fine but I have no idea how to do this.

```
-**Product Table**
Reference
Title
Subjects (Many to Many relationship)
Price

-**Subject table**
SubjectID
Name

-**SubjectToProductMapping Table**
Reference
SubjectID 
```

Now I need to do this:

```
SELECT * 
FROM Product
WHERE Reference IN 
    (Select Reference FROM SubjectToProductMapping WHERE SubjectID = @SubjectID) 
```

Baring in mind the Product table has been simplified a great deal for the post and that I would prefer to use an IN statement to keep the rest of the query simpler. I would ideally like to create the query using Criteria becuase I will be using Criteria to page the results.

Thanks in advance

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-02T21:46:28.200

当连接就足够时，为什么要使用 in？如果您的 Products 类有一个映射的主题集合，那么您可以使用这个 Criteria

```
IList<Product> results = session.CreateCriteria(typeof(Product))
                                .CreateCriteria("Subjects", JoinType.Join)
                                .Add(Resitctions.Eq(Projections.ID, subjectID))
                                .List<Product>(); 
```

# c# - 如何使用反射获得泛型类型的正确文本定义？

> ID：401681
> 
> 赞同：26
> 
> 时间：2008-12-30T22:13:42.713
> 
> 标签：c#, generics, reflection

我正在研究代码生成并遇到了泛型的障碍。这是导致我出现问题的“简化”版本。

```
Dictionary<string, DateTime> dictionary = new Dictionary<string, DateTime>();
string text = dictionary.GetType().FullName; 
```

使用上面的代码片段，值`text`如下：

```
 System.Collections.Generic.Dictionary`2[[System.String, mscorlib, Version=2.0.0.0, 
 Culture=neutral, PublicKeyToken=b77a5c561934e089],[System.DateTime, mscorlib, 
 Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]] 
```

（添加换行符以提高可读性。）

有没有办法`type`在不解析上述字符串的情况下以不同的格式获取类型名称（）？我希望得到以下结果`text`：

```
System.Collections.Generic.Dictionary<System.String, System.DateTime> 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-30T23:23:39.717

在 .Net 框架中没有内置的方法来获得这种表示。即因为没有办法让它正确。有很多构造不能用 C# 样式语法表示。例如，“<>foo”在 IL 中是有效的类型名称，但不能在 C# 中表示。

但是，如果您正在寻找一个非常好的解决方案，它可以相当快地手动实现。以下解决方案适用于大多数情况。它不会处理

1.  嵌套类型
2.  非法 C# 名称
3.  其他几个场景

例子：

```
public static string GetFriendlyTypeName(Type type) {
    if (type.IsGenericParameter)
    {
        return type.Name;
    }

    if (!type.IsGenericType)
    {
        return type.FullName;
    }

    var builder = new System.Text.StringBuilder();
    var name = type.Name;
    var index = name.IndexOf("`");
    builder.AppendFormat("{0}.{1}", type.Namespace, name.Substring(0, index));
    builder.Append('<');
    var first = true;
    foreach (var arg in type.GetGenericArguments())
    {
        if (!first)
        {
            builder.Append(',');
        }
        builder.Append(GetFriendlyTypeName(arg));
        first = false;
    }
    builder.Append('>');
    return builder.ToString();
} 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2011-07-06T06:54:32.090

感谢[@LukeH 的评论](https://stackoverflow.com/questions/6584263/whats-the-meaning-of-apostrophe-number-in-the-object-type-of-properties-with/6584285#6584285)，一个好的和干净的选择是

```
using System;
using System.CodeDom;
using System.Collections.Generic;
using Microsoft.CSharp;
//...
private string GetFriendlyTypeName(Type type)
{
    using (var p = new CSharpCodeProvider())
    {
        var r = new CodeTypeReference(type);
        return p.GetTypeOutput(r);
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-30T23:50:48.337

今晚我玩弄了一些扩展方法，并试图为您的问题找到答案。结果如下：这是一个无保修代码。;-)

```
internal static class TypeHelper
{
    private const char genericSpecialChar = '`';
    private const string genericSeparator = ", ";

    public static string GetCleanName(this Type t)
    {
        string name = t.Name;
        if (t.IsGenericType)
        {
            name = name.Remove(name.IndexOf(genericSpecialChar));
        }
        return name;
    }

    public static string GetCodeDefinition(this Type t)
    {
        StringBuilder sb = new StringBuilder();
        sb.AppendFormat("{0}.{1}", t.Namespace, t.GetCleanName());
        if (t.IsGenericType)
        {
            var names = from ga in t.GetGenericArguments()
                        select GetCodeDefinition(ga);
            sb.Append("<");
            sb.Append(string.Join(genericSeparator, names.ToArray()));
            sb.Append(">");
        }
        return sb.ToString();
    }
}

class Program
{
    static void Main(string[] args)
    {
        object[] testCases = { 
                                new Dictionary<string, DateTime>(),
                                new List<int>(),
                                new List<List<int>>(),
                                0
                            };
        Type t = testCases[0].GetType();
        string text = t.GetCodeDefinition();
        Console.WriteLine(text);
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T23:10:55.310

```
string text = dictionary.ToString(); 
```

提供几乎您所要求的：

```
System.Collections.Generic.Dictionary`2[System.String,System.DateTime] 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T22:21:45.723

我不认为.NET 有任何内置的东西可以做到这一点，所以你必须自己做。我认为反射类提供了足够的信息来重建这种形式的类型名称。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-30T22:24:40.100

我相信你可以通过

> System.String，mscorlib，版本=2.0.0.0，文化=中性，PublicKeyToken=b77a5c561934e089

进入`Type.Parse()`. 我认为这是一个完全限定的类型名称。

# css - 通过 CSS 将图像更改为文本以进行打印？

> ID：401702
> 
> 赞同：5
> 
> 时间：2008-12-30T22:23:47.090
> 
> 标签：css, image, text, header, printing

假设我在要打印的网页上有一个标题横幅。与其浪费某人的墨水打印整个图像块，有没有办法通过 css 用 H1 大小的文本替换图像？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-30T22:44:42.447

我通常只是将以下内容添加到我的样式表中：

```
.nodisplay
{
    display: none;
}

@media print {
    * {
        background-color: white !important;
        background-image: none !important;
    }
    .noprint
    {
        display: none;
    }
} 
```

然后将**noprint**类分配给不应打印的元素：

```
<div class="noprint">

</div> 
```

对于您的示例，类似以下内容应该有效：

```
<img src="logo.png" class="noprint" ...>
<h1 class="nodisplay">Text Logo</h1> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-30T22:25:55.510

您可以将`h1`元素和图像放在源中的同一位置，并将图像 CSS`display:none`用于打印媒体，并将`h1`设置为`display:none`用于屏幕媒体。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-30T22:27:00.407

Bryan，通常在徽标之类的东西上，无论如何我都会使用图像替换图形，因此徽标本身实际上是在 H1 标签中。然后在我的打印样式表中。我做这样的事情......

```
h1#logo a, h1#home-logo{
    text-indent: 0 !important;
    background-image: none !important;
    font-size: 1.2em !important;
    display: block !important;
    height: 1em !important;
    width: 100% !important;
    text-decoration: none !important;
    color: black !important;
} 
```

这将删除图像替换并显示文本。当然，请确保您使用`media="print"`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-31T01:05:34.173

添加到亚当的解决方案：如果您的文本是固定的（“标题横幅”而不是“广告为某某某某”），您可以使用[:before 或 :after 伪元素](http://www.w3.org/TR/CSS2/selector.html#before-and-after)插入文本而不是让文本预先在 HTML 中插入。

如果您用相同的文本替换许多图像，我会使您的 HTML 更轻。

我不得不说我不喜欢这个 CSS 功能，但如果你想使用它，它就在那里。

# .net - 如何使用.net图形绘制文本小节

> ID：401717
> 
> 赞同：2
> 
> 时间：2008-12-30T22:28:12.450
> 
> 标签：.net, graphics

我正在 datagridview 单元格中进行自定义绘图，并且我的项目可以垂直跨越多个单元格。一个项目显示文本，而手头的问题是如何仅绘制单元格的文本部分？我有项目的矩形和 cellBounds。

目前，我正在绘制每个单元格上的**所有**文本，即我正在绘制除了我当前正在绘制的单元格之外的单元格。这需要我清除以前的文本（所以它不会变得模糊和粗体）......所以我实际上在每个单元格绘制中绘制了两次字符串。效率不是很高。

```
//get the actual bounds of this  entire item spanning across multiple cells
RectangleF sRectF = GetItemRectF(startX + leftMargin + 2, widthForItem, cellBounds, calItem);

//we clear it out first, otherwise the text looks bolded if we keep drawing a black string over and over
//todo should figure out how to only draw this cells section? cellBounds subsection of sRectF somehow
graphics.DrawString(calItem.Description, new Font("Tahoma", 8), new SolidBrush(itemBackColor), sRectf);
graphics.DrawString(calItem.Description, new Font("Tahoma", 8), new SolidBrush(Color.Black), sRectF); 
```

我可以在一些临时图形上绘制字符串，然后取出单元格边界部分并将其绘制在实际图形上吗？有没有更好的办法？

谢谢

**回答**

```
Region tempRegion = graphics.Clip;
graphics.Clip = new Region(cellBounds);
graphics.DrawString(calItem.Description, new Font("Tahoma", 8), new SolidBrush(Color.Black), sRectF);
graphics.Clip = tempRegion; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T22:47:00.680

我认为我不太了解您打算拥有的视觉效果。该项目的文本是否应该重叠多个单元格或剪辑到单个单元格？如果它应该被剪切到单元格，您可以使用 Graphics.Clip 设置剪切区域以剪切到指定的矩形。

如果问题与由于未清除缓冲区而导致的拖尾有关，您可以使用 FillRectangle 清除比绘制文本便宜的区域。

# design-patterns - “代理定义集”设计模式——以另一个名字闻名？

> ID：401720
> 
> 赞同：3
> 
> 时间：2008-12-30T22:29:06.627
> 
> 标签：design-patterns, registry, singleton

在我参与多年的一个项目中，我逐渐形成了一种被证明对我非常有用的设计模式。有时我觉得我应该对它有点福音，但如果我尝试并发现它只是我对某人旧帽子的版本，我会有点尴尬。我翻遍了*设计模式*来寻找它是徒劳的，我还没有遇到其他人谈论它，但我的搜索并不详尽。

核心思想是拥有一个管理一组定义对象的代理对象，每个定义对象构成一些复杂属性的可能值。例如，您可能有 Car、Plane 和 Generator 类都具有 EngineType。Car 不存储自己的 EngineType 对象，它存储了某种类型的引用键，用于说明它拥有的引擎类型（例如整数或字符串 ID）。当我们想查看 EngineType 的属性或行为时，比如 WankelEngine，我们向 EngineTypeBroker 单例对象询问 WankelEngine 的定义对象，并将引用键传递给它。该对象封装了有关 EngineTypes 的所有有趣信息，可能只是一个属性列表，但也可能将行为加载到它上面。

所以它促进的是一种共享的、松散耦合的聚合，其中许多汽车可能有一个 WankelEngine 但只有一个 WankelEngine 定义对象（并且 EngineTypeBroker 可以替换该对象，利用松散耦合增强运行时态射）。

我使用该模式的一些元素（继续以 EngineType 为例）：

1.  始终存在 IsEngineType(x) 和 EngineType(x) 函数，分别用于确定给定值是否是 EngineType 的有效引用键和检索与引用键对应的 EngineType 定义对象。
2.  对于给定的 EngineType，我总是允许多种形式的引用键，总是至少是一个字符串名称和定义对象本身，通常不是整数 ID，有时是聚合 EngineType 的对象类型。这有助于调试，使代码更灵活，并且在我的特定情况下，相对于旧实践，可以缓解许多向后兼容性问题。（在这个项目的上下文中，人们过去做这一切的常用方法是为 EngineType 可能具有的每个属性定义哈希，并通过引用键查找属性。）
3.  通常，每个定义实例都是该定义类型的通用类的子类（即 WankelEngine 继承 EngineType）。定义对象的类文件保存在类似/Def/EngineType 的目录中（即WankelEngine 的类将是/Def/EngineType/WankelEngine）。因此相关的定义被组合在一起，类文件类似于 EngineType 的配置文件，但具有定义代码的能力（通常不会在配置文件中找到）。

一些简单的示例伪代码：

```
class Car {

    attribute Name;
    attribute EngineTypeCode;

    object GetEngineTypeDef() {
        return EngineTypeBroker->EngineType(this->GetEngineTypeCode());
    }

    string GetDescription() {
        object def = this->GetEngineTypeDef();
        return "I am a car called " . this->GetName() . ", whose " .
            def->GetEngineTypeName() . " engine can run at " .
            def->GetEngineTypeMaxRPM() . " RPM!";
    }

} 
```

那么，有这个名字吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T23:09:40.993

## 单例注册表

信不信由你。今天早上我也在想同样的事情。

我以前使用过这种模式，但我从未找到它的参考资料，也不知道如何命名它。

我认为是一种“键控”单例，其中实例存储在某处，并使用键获得。

我最后一次使用它是从不同来源检索数据。

我有大约 50 个数据库表（使其成为 10 个）并且我有一个前端“表”，其中要显示数据，但数据可能来自任何这些来源，并且每个来源都需要不同的逻辑（查询、连接、键， ETC。 ）

这个前端是“可配置的”，所以我不知道要显示哪些值，哪些不显示。

解决方案是以 columnName（在前端）作为键，并获取正确的实例来创建正确的查询。

这在开始时安装在哈希映射中，后来从数据库表中检索。

代码是这样的：

```
class DataFetcher {
    abstract Object getData( Object id );
}

class CustomerNameDataFetcher extends DataFetcher {
    Object getData( Object customerId ) { 
        // select name from customer where id = ? 
     }
}

class CompanyAdressDataFetcher extends DataFetcher { 
     Object getData( Object customerId ) { // don't ask why.
          // select name from company , customer where customer.co = company.co and cu = ?  etc.
     }
} 

class ProductColor extends DataFetcher { 
     Object getData( Object x ) { 
     // join from customer to color, to company to season to a bunch of table where id = ? 
}

// And the list goes on. 
```

*每个子类使用不同的逻辑。*

在运行时，用户配置它的视图，并选择他想看的内容。

当用户选择要查看的列时，我使用列名和 Id 来获取数据。

DataFetchers 都安装在类方法中的父类中（我不想为此有一个单独的类）。

```
class DataFetcher {
    abstract Object getData( Object id );

    private static final Map fetchers = new HashMap();static { 
        fetchers.put("customer.name", new CustomerNameDataFetcher() );
        fetchers.put("company.address", new CompanyAdressDataFetcher () );
        fetchers.put("product.color", new ProductColor () );
        ...
    }
    public static DataFetcher getFetcher( String id ) { 
        return fetchers.get( id );
    }      

} 
```

最后填充前端表我只是这样称呼它：

*伪代码*

```
 for each row in table 
      for each column in row
          column.text = DataFetcher.getFetcher( column.id ).getData( row.id )
       end
 end 
```

是这样吗？还是我误读了您的描述，而我的描述完全不同。

最后我认为这被称为 SingletonRegistry 或类似的东西。我（可能）喜欢你，出于需要创造了这个。很有可能这是一种常见的模式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T00:28:30.863

我以前使用过类似的模式，最常见于游戏中。我会有一个 WeaponDefinition 和 WeaponInstance 类（不完全是那些名字）。WeaponDefinition 类（以及各种子类，如果我有不同类型的武器，例如近战与射弹）将负责跟踪该类型武器的全局数据（射速、最大弹药、名称等）并具有所有的逻辑。WeaponInstance 类（和子类）包含射击序列中的当前状态（用于比较射速）、当前弹药计数和一个指针（它可能是您的示例中管理器类的一些键，但是这似乎不是模式的要求）到武器定义。WeaponInstance 有很多用于开火、重新装弹等的函数，只需在 WeaponDefinition 实例上调用适当的方法，将自身作为参数传递。这意味着 WeaponDefinition 的东西不会被游戏世界中的每个坦克/士兵/飞机复制，但它们都有自己的弹药数量等。

我不知道它叫什么，我不确定它和你说的完全一样，但我认为它很接近。这绝对有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T22:38:22.257

在我看来，这听起来像是 GoF Builder、Prototype 和 Featherweight 的组合。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T22:57:03.530

这听起来像是多种 Flyweight（许多汽车共用一个 WankelEngine）。但这有什么意义呢？大多数汽车都有引擎，但它们中怎么会有相同的引擎实例呢？他们不会走那么远。或者你的意思是很多汽车都有 WankelEngine 类型的发动机？假设这更有意义。那么“WankelEngine定义对象”有什么用呢？是否是一个工厂，它正在构建该对象的风格并将它们传递回请求者？如果是这样，它听起来不像是一个定义对象，听起来更像是一个工厂，它接受对象的参数来构建并返回该对象。

我确实在这里看到了一些好的 GoF 实践，特别是您正在编写而不是继承（我的汽车有一个引擎，而我的汽车的引擎是 WankelEngine）。我希望我能准确地回忆起这句话，但它类似于“继承打破封装”和“偏好组合而不是继承”。

我很好奇这个解决了什么问题。我认为您增加了很多复杂性，我认为不需要这种复杂性。也许这是我不理解的特定于您的语言的东西。

GoF 的人确实讨论了将模式组合成更大的模式，特别是 MVC 是其他三种模式的集合。听起来你做过类似的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-05-07T18:07:59.763

这听起来有点像服务定位器，其中您的轻量级被注册为单例。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-12-12T06:00:47.097

你有一张地图，也就是字典。通过将多个键映射到一个对象，您只需对其进行独特的改动。

为什么是地图：

*   保留一把钥匙
*   使用键从某些数据结构中查询值。

您可以在以下位置找到实现：

*   STL（包括：地图）
*   Java（导入：java.util.Dictionary）

# python - 只匹配不属于 HTML 标记的文本的正则表达式？（Python）

> ID：401726
> 
> 赞同：1
> 
> 时间：2008-12-30T22:33:22.033
> 
> 标签：python, regex

只要不在 HTML 标记内，如何进行模式匹配？

下面是我的尝试。有人有更好/不同的方法吗？

```
import re

inputstr = 'mary had a <b class="foo"> little loomb</b>'

rx = re.compile('[aob]')
repl = 'x'

outputstr = ''
i = 0

for astr in re.compile(r'(<[^>]*>)').split(inputstr):
    i = 1 - i

    if i:
        astr = re.sub(rx, repl, astr)

    outputstr += astr

print outputstr 
```

输出：

```
mxry hxd x <b class="foo"> little lxxmx</b> 
```

笔记：

*   匹配 HTML 标签的 <[^>]*> 模式显然是有缺陷的——我写得很快，并没有考虑到带引号的属性中尖括号的可能性（例如 '<img alt="next >" />' ）。它也不考虑 <script> 或 <style> 标记或注释。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-30T22:56:26.103

因为无论如何你都在使用 Python，如果我是你，我会看看[Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/)，它是一个**Python HTML/XML 解析器**。真的，编写自己的解析器有很多特殊情况和令人头疼的问题，只是不值得付出努力。您的正则表达式将变得难以管理，并且在所有情况下仍不会产生正确的结果。

只需使用[美丽的汤](http://www.crummy.com/software/BeautifulSoup/)。

# c# - 有没有办法加速现有数据库的 SQL Server 管理对象遍历？

> ID：401740
> 
> 赞同：3
> 
> 时间：2008-12-30T22:40:55.933
> 
> 标签：c#, .net, sql-server, smo

我目前正在使用 SMO 和 C# 来遍历数据库以创建代表两个数据库各个方面的设置树，然后比较这些树以查看它们的不同之处和方式。

问题是，对于 2 个大小合理的数据库，在本地抓取它们并收集我希望比较的表/列/存储过程信息需要将近 10 分钟。

有没有比 SMO 更好的界面来以这种方式访问​​数据库？我不想包含任何额外的依赖项，但我会为提高 50% 的速度而感到痛苦。下面是我如何枚举表和列的示例。

```
 Microsoft.SqlServer.Management.Smo.Database db = db_in;
        foreach (Table t in db.Tables)
        {
            if (t.IsSystemObject == false)
            {

                foreach (Column c in t.Columns)
                {
                }                    
            }
        } 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-30T22:59:06.990

尝试强制 SMO 一次读取所有必填字段，而不是查询访问权限。有关更多信息，请参阅[此博客](http://davidhayden.com/blog/dave/archive/2006/03/29/2894.aspx)

* * *

编辑：链接已失效，但我在archive.org 上找到[了该页面。](http://web.archive.org/web/20100102060107/http://davidhayden.com/blog/dave/archive/2006/03/29/2894.aspx)以下是相关代码：

```
Server server = new Server();

// Force IsSystemObject to be returned by default.
server.SetDefaultInitFields(typeof(StoredProcedure), "IsSystemObject");

StoredProcedureCollection storedProcedures = server.Databases["AdventureWorks"].StoredProcedures;

foreach (StoredProcedure sp in storedProcedures) {
    if (!sp.IsSystemObject) {
        // We only want user stored procedures
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T22:52:30.137

使用每个数据库中的系统视图和常规查询。

[http://www.microsoft.com/downloads/details.aspx?familyid=2EC9E842-40BE-4321-9B56-92FD3860FB32&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=2EC9E842-40BE-4321-9B56-92FD3860FB32&displaylang=en)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T23:21:14.290

您无法通过 TSQL 查询获得的信息很少。以这种方式获取元数据通常非常快。

# verification - In Specman, how can I tell if a reference to a unit has the do-not-generate modifier in front of it?

> ID：401741
> 
> 赞同：1
> 
> 时间：2008-12-30T22:40:57.057
> 
> 标签：verification, specman, eda

In Specman, how can I tell if a reference to a unit has the do-not-generate modifier, '!', at the reference's definition?

e.g.

```
unit foo_u {
}; 

extend sys {
   foo : foo_u is instance;
   foo_ptr_generated : foo_u;
   keep foo_ptr_generated == foo;
   !foo_ptr_notgenerated : foo_u;
   connect_pointers() is also {
      foo_ptr_notgenerated = foo;
   };
}; 
```

Without inspecting the code or relying on a naming convention, how can I tell that `foo_ptr_generated` went through Specman's constraint solver and `foo_ptr_notgenerated` was procedurally set?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-05T20:01:27.863

Finally figured this out. This code will determine which references are generated and which aren't in Specman 6 via the reflection interface:

```
<'
type my_t : [ A,B,C];
unit foo_u {
   sub_typiness : my_t;
   other_sub_typiness : my_t;

   when A'sub_typiness foo_u {
      !bar_ptr : bar_u;
   };

   when B'other_sub_typiness foo_u {
      in_b_sub_type : int;
   };

   when A'sub_typiness B'other_sub_typiness foo_u {
      in_a_b_subtype :int;
   };
   b : bah_u is instance;
};

unit bar_u {
   sub_typiness : my_t;
   other_sub_typiness :my_t;

   when B'sub_typiness bar_u {
      !foo_ptr : foo_u;
   };
   when C'other_sub_typiness bar_u {
      inc_sub_type : int;
   };

   when A'other_sub_typiness bar_u {
      !you_shouldnt_see_this_field : bah_u;
   };

   when B'sub_typiness C'other_sub_typiness bar_u{
      in_b_c_subtype :int;
   };
   !b : bah_u;
   b2 : bah_u;
};

unit bah_u {

};

extend any_unit {

   !path_to_parent :string;
   !my_e_path : string;

   post_generate() is also {
      if not me is a sys { 
         path_to_parent = get_parent_unit().e_path();
      };
      my_e_path = e_path();
   };

   print_pointers() is {
      for each ( wf ) in rf_manager.get_struct_of_instance(me).as_a(rf_like_struct).sd_.all_when_fields {
         if not str_match(wf.name,"/___/"){

         };
      };
      for each (sub_unit) in get_all_units(any_unit) {
         sub_unit.print_pointers();
      };
   };
};

struct wank_s {
   oh_joy: int;
};
extend sys {
   foo : A'sub_typiness B'other_sub_typiness foo_u is instance;
   bar : B'sub_typiness C'other_sub_typiness bar_u is instance;
   keep bar.b2 == foo.b;

   wank : wank_s;

   connect_pointers() is also {
      foo.bar_ptr = bar;
      bar.foo_ptr = foo;
      bar.b = foo.b;
   };

   !possible_ptr : any_unit;
   !is_a_unit : bool;
   !an_e_path : string;
   !a_unit : any_unit;
   !a_field : field;
   -- 
   -- rf_manager.get_all_unit_instances
   my_specman( cmd : string ) : bool is {
      try {
         --out(cmd);
         specman(cmd);
      } else {
         return FALSE;
      };
      return TRUE;
   };

   check_generation() is also {
      out("PRINT OUT FIELDS");
      var all_units : list of any_unit;
      for each any_unit(u) in get_all_units(any_unit) {
         for each ( wf ) in rf_manager.get_struct_of_instance(u).as_a(rf_like_struct).sd_.all_when_fields {
            --print wf.source_ref;
            --print wf.source_ref.to_string().as_a(uint);
            --if wf.source_ref.to_string().as_a(uint) > 1000 and not str_match(wf.name,"/___/"){
            if not str_match(wf.name,"/___|driver_trans/"){
               an_e_path = append(u.e_path(),".",wf.name);
               an_e_path = append(an_e_path, " - marked_as_reachable=",wf.fgi.marked_as_reachable);
               if wf.base_type is a struct_descriptor (s){
                  an_e_path = append(an_e_path, " - instantiated == ", s.instantiated);
               };

               if wf.base_type is a struct_descriptor (s) and not s is a list_descriptor and not s is a long_descriptor {

                  sys.is_a_unit = FALSE;
                  if not my_specman(append("sys.is_a_unit = ( ",u.e_path(),".",wf.name,
                     " != NULL)")) {
                     sys.is_a_unit = FALSE;
                  };
                  if sys.is_a_unit {
                     if not my_specman(append(" sys.is_a_unit = (",u.e_path(),".",wf.name,
                        ".as_a(any_struct) == ",u.e_path(),".",wf.name,".get_enclosing_unit(any_unit).as_a(any_struct))")) {
                        sys.is_a_unit = FALSE;
                     };
                  };

                  if sys.is_a_unit and str_match(wf.name,"/([\w_]+'+[\w_']*)[\w_]+/") {
                     if not my_specman( append( "sys.is_a_unit = ( ",u.e_path(),
                           " is a ", $1, " ", 
                           rf_manager.get_struct_of_instance(u).as_a(rf_like_struct).sd_.name,
                           ")")) {
                        sys.is_a_unit = FALSE;
                     };
                  };

                  if is_a_unit {
                     sys.a_unit = NULL;
                     if not my_specman(append("sys.a_unit = (",u.e_path(),".",wf.name,
                        ".as_a(any_unit))")) {
                        sys.a_unit = NULL;
                     };

                     if sys.a_unit != NULL {

                        sys.an_e_path = NULL;
                        var printout := append(":: ",u.e_path(), ".", wf.name);
                        compute my_specman(append( "sys.an_e_path = ",u.e_path(),".",wf.name,
                           ".my_e_path"));
                        if append(u.e_path(),".",wf.name) != sys.an_e_path {
                           printout = append(printout, " -> ");

                           printout = append(printout, sys.an_e_path);
                           if wf.fgi != NULL and wf.fgi.gcs.size() > 0 and (
                              wf.fgi.gcs[0].last_reduction != UNDEF or
                              wf.fgi.gcs[0].gcois.size() > 0 ) {

                              printout = append(printout, " GENERATED POINTER");
                           };
                        };
                        out(printout);

                     };
                  };
               };

               --out( "    ",an_e_path);

               --specman(append("print ",u.e_path(),".",wf.name));
            };
         };

         --for each ( m ) in rf_manager.get_struct_of_instance(u).as_a(rf_like_struct).sd_.methods {
         --   if m != NULL {
         --      out(m.md.name);
         --   };
         --};
         --print u.get_all_attribute_names();
         --print u.get_attribute("agent");
         --print u.agent_kind();

         -- for each (m) in rf_manager.get_struct_of_instance(u).get_declared_methods() {
         --    print m;
         -- };
         -- out("fields at '",u.e_path(),"'s struct level:");
         -- for each (f) in rf_manager.get_struct_of_instance(u).get_declared_fields() {
         --    out( "    ",u.e_path()," -> ",f.f_.short_name);
         -- };
         -- out("fields at '",u.e_path(),"'s exact sub-type level:");
         -- for each (f) in rf_manager.get_exact_subtype_of_instance(u).get_declared_fields() {
         --    out( "    ",u.e_path()," -> ",f.f_.short_name);
         -- };
         -- out("");
      };

      -- out("\nPRINT OUT UNIT INSTANCES");
      -- for each any_unit(u) in {sys;foo;bar} {
      --    for each (i) in rf_manager.get_all_unit_instances(u) {
      --       if i != u {
      --          out(u.e_path(), " has unit ", i.e_path());
      --       };
      --    };
      -- };

   };

};

'> 
```

Running with:

```
specman -c 'load rf_test.e; gen' 
```

Produces:

```
Generating the test using seed 1...
PRINT OUT FIELDS
:: sys.bar.B'sub_typiness'foo_ptr -> sys.foo
:: sys.bar.b -> sys.foo.b
:: sys.bar.b2 -> sys.foo.b GENERATED POINTER
:: sys.foo.A'sub_typiness'bar_ptr -> sys.bar
:: sys.foo.b
:: sys.logger.base_unit -> sys
:: sys.logger
:: sys.foo
:: sys.bar

Starting the test ...
Running the test ... 
```

# web-services - 在 Delphi Web 服务器后面使用快速报告生成 PDF

> ID：401743
> 
> 赞同：1
> 
> 时间：2008-12-30T22:42:17.677
> 
> 标签：web-services, delphi, pdf-generation, quickreports

我有一个 Delphi Web 服务器，提供一些 Web 服务*。其中之一应该生成并返回 PDF 报告。

PDF 创建是使用 QReport 完成的，然后使用 ExportToFilter 过程将其导出到 PDF 文件中。

该例程在从应用程序中调用时可以正常工作，但在 TIdTCPServer 后面调用时，它会挂起并且永远不会完成。调试它，我得到了悬念：

*（注意：我现在在家，没有源代码。我会尽量准确地重现 quickrpt.pas 的源代码）。*

```
procedure TCustomReport.ExportToFilter(TQRDocumentFilter filter);
  ...
  AProgress := TQRFormProgress.Create(Application); // Hangs on this line
  AProgress.Owner := QReport;
  if ShowProgress then AProgress.Show;
  QReport.Client := AProgress;
  ... 
```

在网上搜索，我在[这个页面](http://coding.derkeiler.com/Archive/Delphi/borland.public.delphi.thirdpartytools.general/2006-09/msg00013.html)（1）中找到了将 ShowProgress 设置为 False 的建议，并编辑代码以便在 ShowProgress 设置为 false 时不会创建进度表（显然，这是由于 QReport 不是线程安全的）。

所以，我编辑了代码，现在我有了这个：

```
procedure TCustomReport.ExportToFilter(TQRDocumentFilter filter);
  ...
  if ShowProgress then
  begin
    AProgress := TQRFormProgress.Create(Application);
    AProgress.Owner := QReport;
    AProgress.Show;
    QReport.Client := AProgress
  end;
  ... 
```

现在，报告出来了。但随后服务会出现无效指针异常（我无法跟踪）。对服务的调用成功完成，但是当我关闭服务**时，它又开始抱怨无效指针异常，然后是“MyServer 已提交无效操作，必须关闭”windows 消息，然后又是几次，然后只是指针异常，然后出现错误 216（据我所知，这与 Windows 访问权限有关）。

谢谢！

**更新（1 月 5 日）**：感谢 Scott W. 的[回答](https://stackoverflow.com/questions/401743/generating-pdf-with-quick-reports-behind-a-delphi-web-server#411789)。确实，经过一番研究，我发现了另一个建议，即只有主线程才能访问某些组件。因此，我将 QR 码设置为正常，并从 TThread 内的 Synchronize 调用中调用 main 方法（这样主线程就会处理它）。但我仍然得到同样的错误。

您提到您可以使用 QR 4 将 PDF 作为服务生成。也许这就是为什么它对我不起作用，因为我使用的是 QR 3。另一方面，您没有提到您是否在后面这样做TIdTCPServer（这是我的情况，提供 Web 服务）或者如果您自己运行它（例如，在批处理过程中）。

有人知道我的二维码版本是否有问题吗？谢谢！

* 在 Windows XP SP2 上运行 Delphi 7 和 QuickReport 3。服务器基于 Indy。

** 我有两个版本的服务器：一个 Windows 应用程序和一个 Windows 服务。两者都调用相同的内部逻辑，并且两个版本都出现问题。

**更新（3 月 8 日）**：毕竟，我的问题是我的打印程序在另一个 dll 中，并且默认的内存管理模块有些糟糕。将我的 .dpr 的第一次使用设置为 ShareMem 会用 Borland 的实现覆盖内存管理模块，并解决了我的问题。

```
uses
    ShareMem, ... 
```

(1)：[http ://coding.derkeiler.com/Archive/Delphi/borland.public.delphi.thirdpartytools.general/2006-09/msg00013.html](http://coding.derkeiler.com/Archive/Delphi/borland.public.delphi.thirdpartytools.general/2006-09/msg00013.html)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-04T22:15:46.000

我猜它`QReport.Client`在代码的后面某处使用，并且您修改后的代码不再将其分配给 AProgress，您最终会出现错误。

您确定要修改 QuickReport 源吗？我在 Windows 服务中使用 QuickReport 来生成 PDF 文件，然后附加到电子邮件消息中，一切正常，无需修改 QR 源。我不记得必须进行哪些设置，但它是使用 Delphi 6 和 QR 4.06 完成的。

# asp.net - 在 IIS7 上为 Wordpress 重写 URL

> ID：401744
> 
> 赞同：6
> 
> 时间：2008-12-30T22:42:33.263
> 
> 标签：asp.net, wordpress, url-rewriting

我正在使用带有 IIS7 的共享主机并支持 PHP。我正在尝试使用“漂亮的 url”（删除 index.php）运行一个 wordpress 博客。托管服务提供商不想安装 URLRewrite 模块，因此我无法使用该选项。我找到了一个 wordpress 插件，它将从永久链接 URL 中删除 index.php，并将 404 页面更改为 index.php 应该可以解决问题……这也不起作用。

我熟悉 ASP.NET 网站的 URL 重写，但我不确定我将如何处理 PHP。托管设置似乎同时支持 ASP.NET 和 PHP，所以我认为可以通过 ASP.NET 运行重写代码，但我不知道如何去做。

有没有人对此有任何经验或对最佳方法有任何想法。如果有任何事情引导我朝着正确的方向前进，或者如果我自己弄清楚了，我将非常乐意在这里为任何可能需要它的人分享代码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-31T23:13:36.490

我在我的[博客上使用](http://robboek.com/ "http://robboek.com")**[ManagedFusion Url Rewriter](http://www.managedfusion.com/products/url-rewriter/ "ManagedFusion Url 重写器")**和**自定义 404 错误页面**。

ManagedFusion Url Rewriter 需要一个名为 ManagedFusion.Rewriter.rules 的文件，该文件模仿 .htaccess，我不得不对其进行大量尝试以使其正确，因此我将包括我目前拥有的内容：

```
#  Managed Fusion Url Rewriter
#  http://managedfusion.com/products/url-rewriter/
#
#  Developed by: Nick Berardi
#       Support: support@managedfusion.com
#
RewriteEngine on

#
# Place Rules Below
#

# misc WordPress rewrites
RewriteRule ^/wp-login\.php$ /wp-login.php [L]
RewriteRule ^/wp-comments-post\.php$ /wp-comments-post.php [L]
RewriteRule ^/wp-admin/(.*)$ /wp-admin/$1 [L]

# deny access to evil robots site rippers offline browsers and other nasty scum
RewriteCond %{HTTP_USER_AGENT} ^Anarchie [OR]
RewriteCond %{HTTP_USER_AGENT} ^ASPSeek [OR]
RewriteCond %{HTTP_USER_AGENT} ^attach [OR]
RewriteCond %{HTTP_USER_AGENT} ^autoemailspider [OR]
RewriteCond %{HTTP_USER_AGENT} ^Xaldon\ WebSpider [OR]
RewriteCond %{HTTP_USER_AGENT} ^Xenu [OR]
RewriteCond %{HTTP_USER_AGENT} ^Zeus.*Webster [OR]
RewriteCond %{HTTP_USER_AGENT} ^Zeus
RewriteRule ^.* - [F,L]

# remove www
RewriteCond %{HTTP_HOST} ^www\.robboek\.com$ [NC]
RewriteRule ^(.*)$ http://robboek.com$1 [R=301]

# redirect old urls
RewriteRule ^/2008/12/blog-on-hold.html$ /2008/12/12/blog-on-hold/ [R=301]
RewriteRule ^/2008/11/google-chrome-wont-start-in-vista-x64\.html$ /2008/11/16/google-chrome-wont-start-in-vista-x64/ [R=301]
RewriteRule ^/2008/11/pass-community-summit-2008-events.html$ /2008/11/14/pass-community-summit-2008-events-calendar/ [R=301]
RewriteRule ^/2008/11/fort-stevens-camping-trip.html$ /2008/11/14/fort-stevens-camping-trip/ [R=301]
RewriteRule ^/2008/10/first-post.html$ /2008/10/10/first-post/ [R=301]
RewriteRule ^/blog/CommentView,guid,1d8cba50-0814-4c89-86df-eca669973e8e.aspx$ /2006/09/29/junctions-in-windows-vista/ [R=301]
RewriteRule ^/blog/2006/09/29/JunctionsInWindowsVista.aspx$ /2006/09/29/junctions-in-windows-vista/ [R=301]

# rewrite all nonexistent files and directories to use index.php for WordPress
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ /index.php$1 
```

规则处理漂亮的 url，删除 www，并从以前的博客重定向几个旧的 url。

我还有一个文件“404.php”，我已将其设置为我的自定义 404 错误页面。漂亮的 url 不需要这样做，但允许您在自定义主题中使用 wordpress 404 页面。以下是内容：

```
<?php
$qs = $_SERVER['QUERY_STRING'];
$pos = strrpos($qs, '://');
$pos = strpos($qs, '/', $pos + 4);
$_SERVER['REQUEST_URI'] = substr($qs, $pos);
$_SERVER['PATH_INFO'] = $_SERVER['REQUEST_URI'];
include('index.php');
?> 
```

我希望这会有所帮助。到目前为止，它对我来说一直很好。

-抢

更新：我刚刚发布了[一篇关于我在 IIS7 上使用 WordPress 的经验的博客文章](http://robboek.com/2009/01/03/using-wordpress-on-iis7/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-12T21:34:30.643

谢谢大家的建议。

我的主机最终安装了[IIRF](http://www.codeplex.com/IIRF/Thread/View.aspx?ThreadId=39606)，它就像一个魅力。有一个名为 IsapiRewrite4.ini 的文件用于重写规则。为了让我的 Wordpress 安装在 URL 中没有 index.php 的情况下运行，我所要做的就是添加：

```
RewriteRule ^/sitemap.xml$   - [L]
RewriteRule ^/(?!index.php)(?!wp-)(.*)$ /index.php/$1 
```

第一行允许对 sitemap.xml 文件的请求。第二行处理从 URL 中删除 index.php。从性能的角度来看，这似乎也很好，我根本没有看到页面响应缓慢的任何问题。

希望这将帮助其他需要类似功能的人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-11T15:55:26.397

将 404 页面更改为 index.php 应该可以解决问题。如果不支持，则该插件可能不支持 IIS。

IIS 中有一个 xml“ [web.config](http://msdn.microsoft.com/en-us/library/aa719558.aspx) ”文件，它执行 .htaccess 在 Apache HTTPD 中的功能。（即通过静态配置文件覆盖网络服务器设置）。它广泛用于 ASP.NET 应用程序。

请阅读[在 IIS 7.0 上启用 WordPress 中的自定义错误](http://blogs.iis.net/ruslany/archive/2008/12/05/enable-custom-errors-in-wordpress-on-iis-7-0.aspx) 如果这也不起作用，您可以尝试让您的服务提供商为您设置它。他们可以通过 IIS 管理控制台 GUI 配置此设置。

# php - isset 在旧版本中的工作方式是否不同

> ID：401747
> 
> 赞同：0
> 
> 时间：2008-12-30T22:44:01.013
> 
> 标签：php, legacy-code

我得到了一些具有此功能的遗留代码：

```
<?PHP
    if(isset($_GET['pagina'])=="homepage") {
?>
HtmlCode1
<?php 
} else { 
?>
HtmlCode2
<?php 
} 
?> 
```

我不知道确切原因，但这似乎有效。htmlcode1 在我有 ?pagina=homepage 时加载，而 htmlcode2 在 pagina var 不存在或者是其他东西时加载（还没有真正看到其他东西，只是不存在）。该网站使用的是php4（不知道确切的版本）。但实际上，这怎么能行呢？我查看了手册，它说 isset 返回一个布尔值。

任何人？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-30T22:48:44.483

`isset()`返回真或假。在布尔比较中，`"homepage"`将评估为`true`. 所以基本上你到了这里：

```
if ( isset($_GET['pagina']) == true ) 
```

如果 pagina 等于任何值，您将看到 HtmlCode1。如果没有设置，您将看到 HtmlCode2。

我只是尝试确认这一点，并且`?pagina=somethingelse`不会显示 HtmlCode2 **。**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T22:49:50.970

我怀疑这是一个错误，因为将真/假与“主页”进行比较是没有意义的。我希望代码实际上应该是：

```
if (isset($_GET['pagina']) && ($_GET['pagina'] == "homepage")) {
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T22:53:25.067

问题是“==”不是类型敏感的比较。任何（非空）字符串都“等于”布尔真值，但不等于**它**（为此您需要使用“===”运算符）。

一个简单的例子，为什么你会看到这种行为：
[http://codepad.org/aNh1ahu8](http://codepad.org/aNh1ahu8)

有关文档中有关它的更多详细信息，请参阅：
[http://php.net/manual/en/language.operators.comparison.php](http://php.net/manual/en/language.operators.comparison.php)
[http://ca3.php.net/manual/en/types.comparisons.php](http://ca3.php.net/manual/en/types.comparisons.php)（特别是“与 == 表的松散比较）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T22:51:42.353

一些想法如何工作（除了前面提到的“主页”==true）：

*   Isset 在某个地方被重新定义了吗？
*   它是PHP的自我修改版本？

# java - 使用 Java 下载文件时文件损坏

> ID：401748
> 
> 赞同：1
> 
> 时间：2008-12-30T22:44:12.167
> 
> 标签：java

这个问题似乎不一致地发生。我们正在使用 java 小程序从我们的站点下载文件，我们将其临时存储在客户端计算机上。

这是我们用来保存文件的代码：

```
URL targetUrl = new URL(urlForFile);
InputStream content = (InputStream)targetUrl.getContent();
BufferedInputStream buffered = new BufferedInputStream(content);
File savedFile = File.createTempFile("temp",".dat");

FileOutputStream fos = new FileOutputStream(savedFile);
int letter;
while((letter = buffered.read()) != -1)
    fos.write(letter);
fos.close(); 
```

后来，我尝试使用以下方法访问该文件：

```
ObjectInputStream keyInStream = new ObjectInputStream(new FileInputStream(savedFile)); 
```

大多数时候它可以正常工作，但每隔一段时间我们就会收到错误：

```
java.io.StreamCorruptedException: invalid stream header: 0D0A0D0A 
```

这让我相信它没有正确保存文件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T23:00:06.143

我猜您对 getContent 和 BufferedInputStream 所做的操作已将文件视为 ascii 文件，该文件已将换行符或回车转换为回车 + 换行符（0x0d0a），这混淆了 ObjectInputStream （它需要序列化的数据对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T23:20:32.857

如果您使用的是 FTP URL，则传输可能以 ASCII 模式进行。

尝试将“;type=I”附加到 URL 的末尾。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T23:33:50.897

为什么要使用 ObjectInputStream 来读取它？

根据javadoc：

> *ObjectInputStream 反序列化以前使用 ObjectOutputStream**编写的原始数据和对象。***

错误可能来自您没有使用 ObjectOutputStream 编写它的事实。

尝试仅使用 FileInputStream 阅读它。

这是二进制[的示例](https://stackoverflow.com/questions/181634/simplest-efficient-ways-to-read-binary-and-ascii-files-to-string-or-similar-in-v#324792)（尽管不是最有效的方法）

这是[另一个](https://stackoverflow.com/questions/326390/how-to-create-a-java-string-from-the-contents-of-a-file)用于文本文件的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-31T04:03:31.290

您的示例代码中有 3 个大问题：

1.  您不仅将输入视为字节
2.  您不必要地一次将整个对象拉入内存
3.  您正在为每个读取和写入的单个字节执行多个方法调用——使用基于数组的读/写！

这是一个重做：

```
URL targetUrl = new URL(urlForFile);
InputStream is = targetUrl.getInputStream();
File savedFile = File.createTempFile("temp",".dat");
FileOutputStream fos = new FileOutputStream(savedFile);

int count;
byte[] buff = new byte[16 * 1024];
while((count = is.read(buff)) != -1) {
    fos.write(buff, 0, count);
}
fos.close();
content.close(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T23:58:24.153

You could also step back from the code and check to see if the file on your client is the same as the file on the server. If you get both files on an XP machine, you should be able to use the FC utility to do a compare (check FC's help if you need to run this as a binary compare as there is a switch for that). If you're on Unix, I don't know the file compare program, but I'm sure there's something.

If the files are identical, then you're looking at a problem with the code that reads the file.

If the files are not identical, focus on the code that writes your file.

Good luck!

# javascript - 解决javascript中名称冲突的最佳方法是什么？

> ID：401752
> 
> 赞同：5
> 
> 时间：2008-12-30T22:46:29.493
> 
> 标签：javascript

我最近编写了一些 javascript 代码，这些代码填充了基于一些 XML 的下拉列表，非常简单的东西。问题是我必须编写类似的代码才能在不同的页面上做几乎相同的事情。

因为代码几乎相同，所以我将大多数函数命名为相同，认为它们永远不会包含在同一页面中。但是，由于两个 javascript 文件最终都包含在同一个 HTML 页面中，因此出现了命名冲突。

当我不得不返回并更改名称时，我只需将 first_ 或 second_ 添加到方法的名称中。这很痛苦，对我来说似乎不是很优雅。我想知道是否有更好的方法来解决 javascript 中的名称冲突？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-30T22:56:54.043

尝试各种库中使用的 JavaScript[模块模式](http://yuiblog.com/blog/2007/06/12/module-pattern/)（或命名空间）。

尽量保持干燥（不要重复自己），这样可以避免名称冲突。如果代码几乎相同，您最好通过创建一个可以处理这两种情况的函数来避免代码重复。该函数可以采用两个参数：填充哪个下拉列表以及使用什么数据。这也有助于可维护性。

更新：我假设您从 AJAX 请求中获取 XML。在这种情况下，您可以使用适当的参数为循环内的回调创建动态匿名函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T23:02:33.033

我会看看如何将两段代码（函数？）合并为一个函数。如果您需要填充列表框，则将列表框 id 传递给函数，因此您不会硬编码为仅对单个控件进行操作...

我在我的火箭公司的网站上这样做了，在那里我出售了具有不同延迟值的火箭发动机，但本质上，它们是相同的产品，只是延迟值不同。

也许这可能会尝试解释我想说的......如果图像文件碰巧丢失，我会使用它，它将显示“无图像”图像代替真实图像。

```
function goBlank(image)
{
  if(image) {
    var imgobj = document[image];
    imgobj.src="/images/blank.png";
  }
} 
```

在这种情况下，您可以使用以下方式调用它：

```
<img src="/images/aerotech.png" name="header" onError="goBlank('header');"> 
```

如果您需要更多示例，例如使用的列表框，请告诉我。也许甚至发布您的一些示例代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-31T02:28:51.650

另一种选择（如果可能的话）是仔细地将代码与元素本身联系起来。

例如

```
<input type="text" name="foo" id="foo" value="World" onchange="this.stuff('Hello ' + this.value);"/>
<script>
  document.getElementById('foo').stuff = function(msg){
    //do whatever you want here...
    alert('You passed me: ' + msg);
  };
</script> 
```

# lucene - 具有多个不同值的字段

> ID：401754
> 
> 赞同：24
> 
> 时间：2008-12-30T22:47:21.613
> 
> 标签：lucene

我正在使用 Lucene 构建“图书搜索”API。我需要在 Lucene 索引中索引 Book Name、Author 和 Book category 字段。

一本书可以属于多个不同的书籍类别……例如：

书名1——小说、幽默、哲学。书名1——小说、科学。书名1——幽默、商业。BookName4-幽默等等......

用户应该能够搜索特定类别下的所有书籍，例如“homour”。

鉴于这种情况，我如何索引以上字段并在 lucene 中构建查询？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-05T10:25:00.053

您可以让 Lucene 文档的字段出现多次。创建文档，添加名称和作者的值，然后对每个类别执行相同操作

*   创建新的 lucene 文档
*   添加名称字段和值
*   添加作者字段和值
*   对于每个类别：
    *   添加类别字段和值
*   将文档添加到索引

当您在索引中搜索类别时，它将返回所有具有您所追求的值的类别字段的文档。类别应该是“关键字”字段。

我用英文写的，因为每个 lucene 版本的具体代码略有不同。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-31T09:52:16.483

您可以创建一个简单的“类别”字段，在其中列出以空格分隔的书籍的所有类别。

然后你可以搜索类似的东西：

```
stock market AND category:(+"business") 
```

或者，如果您想搜索多个类别

```
stock market AND category:(+"business" +"philosophy") 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-31T01:35:03.897

我会改用[Solr——](http://lucene.apache.org/solr/)它建立在 Lucene 之上并由 ASF 管理，但比 Lucene 更容易使用，尤其是对于新手而言。

如果提供了几乎所有 Lucene 的主线特性（当然是你描述的项目所需的一切），加上额外的东西，比如快照、复制、模式，......

在 Solr 中，您只需定义要索引的字段，如下所示`schema.xml`：

```
<field name="book_id" type="string" indexed="true" stored="true" required="true" multiValued='false'/>
<field name="book_name" type="text" indexed="true" stored="true" required="true" multiValued='false' />
<field name="book_authors" type="text" indexed="true" stored="true" required="true" multiValued='true' />
<field name="book_categories" type="textTight" indexed="true" stored="true" required="true" multiValued='true' /> 
```

请注意，该`multiValued='true'`属性允许您有效地将数组或列表传递给该字段，该字段被 Solr 很好地拆分和索引。

一旦你有了这个，启动 Solr，你可以询问像“ `book_authors:Hemingway`”或“ `book_categories:Romance book_categories:Mills`”这样的查询。

有几个预先编写和配置的查询处理程序供您执行诸如解析复杂查询（模糊匹配、布尔运算、评分提升等）之类的事情，并且由于 Solr 的 API 通过 HTTP 公开，所有这些都由一个数字包装客户端库，因此您不需要自己处理制作查询的低级细节。

他们的网站上有很多[很棒的](http://lucene.apache.org/solr/tutorial.html) [文档](http://wiki.apache.org/solr/)可以帮助您入门。

# c# - 使用 Json.net 解析 JSON

> ID：401756
> 
> 赞同：111
> 
> 时间：2008-12-30T22:48:43.093
> 
> 标签：c#, parsing, serialization, json.net

我正在尝试使用 JSon.Net 库解析一些 JSON。文档似乎有点稀疏，我对如何完成我需要的东西感到困惑。这是我需要解析的 JSON 格式。

```
{
    "displayFieldName" : "OBJECT_NAME", 
    "fieldAliases" : {
        "OBJECT_NAME" : "OBJECT_NAME", 
        "OBJECT_TYPE" : "OBJECT_TYPE"
    }, 
    "positionType" : "point", 
    "reference" : {
        "id" : 1111
    }, 
    "objects" : [ {
        "attributes" : {
            "OBJECT_NAME" : "test name", 
            "OBJECT_TYPE" : "test type"
        }, 
        "position" : {
            "x" : 5, 
            "y" : 7
        }
    } ]
} 
```

我真正需要的唯一数据是对象数组中的内容。我是否有可能用 JSonTextReader 之类的东西来解析它，然后取出我想要的东西，比如 OBJECT_TYPE 和 x 和 y 位置？我似乎无法`JSonTextReader`按照我想要的方式工作，而且我几乎找不到使用它的例子。

似乎先序列化然后对我的对象使用 LINQ 是理想的，我发现的每个示例都首先讨论序列化 JSON，但我不确定如何为这个结构构建一个对象。特别是对象数组，它需要类似于一对属性和位置对象的列表。我不知道如何编码我的对象，以便 JSon.Net 知道如何序列化它。

我以为我可以编写自己的简单解析器，将我需要的所有内容提取到我创建的属性对象中，但我运气不佳。

希望这一切都有意义，有什么想法吗？

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2008-12-31T10:37:27.530

我不了解 JSON.NET，但它适用`JavaScriptSerializer`于`System.Web.Extensions.dll`（.NET 3.5 SP1）：

```
using System.Collections.Generic;
using System.Web.Script.Serialization;
public class NameTypePair
{
    public string OBJECT_NAME { get; set; }
    public string OBJECT_TYPE { get; set; }
}
public enum PositionType { none, point }
public class Ref
{
    public int id { get; set; }
}
public class SubObject
{
    public NameTypePair attributes { get; set; }
    public Position position { get; set; }
}
public class Position
{
    public int x { get; set; }
    public int y { get; set; }
}
public class Foo
{
    public Foo() { objects = new List<SubObject>(); }
    public string displayFieldName { get; set; }
    public NameTypePair fieldAliases { get; set; }
    public PositionType positionType { get; set; }
    public Ref reference { get; set; }
    public List<SubObject> objects { get; set; }
}
static class Program
{

    const string json = @"{
  ""displayFieldName"" : ""OBJECT_NAME"", 
  ""fieldAliases"" : {
    ""OBJECT_NAME"" : ""OBJECT_NAME"", 
    ""OBJECT_TYPE"" : ""OBJECT_TYPE""
  }, 
  ""positionType"" : ""point"", 
  ""reference"" : {
    ""id"" : 1111
  }, 
  ""objects"" : [
    {
      ""attributes"" : {
        ""OBJECT_NAME"" : ""test name"", 
        ""OBJECT_TYPE"" : ""test type""
      }, 
      ""position"" : 
      {
        ""x"" : 5, 
        ""y"" : 7
      }
    }
  ]
}";

    static void Main()
    {
        JavaScriptSerializer ser = new JavaScriptSerializer();
        Foo foo = ser.Deserialize<Foo>(json);
    }

} 
```

**编辑：**

Json.NET 使用相同的 JSON 和类工作。

```
Foo foo = JsonConvert.DeserializeObject<Foo>(json); 
```

链接：[使用 Json.NET 序列化和反序列化 JSON](http://james.newtonking.com/projects/json/help/index.html?topic=html/SerializingJSON.htm)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-31T00:51:37.277

**编辑：**谢谢 Marc，阅读 struct vs class 问题，你是对的，谢谢！

我倾向于使用以下方法来做你描述的事情，使用 JSon.Net 的静态方法：

```
MyObject deserializedObject = JsonConvert.DeserializeObject<MyObject>(json); 
```

链接：[使用 Json.NET 序列化和反序列化 JSON](http://james.newtonking.com/projects/json/help/index.html?topic=html/SerializingJSON.htm)

对于对象列表，我可以建议使用由您自己的包含`attributes`和`position`类的小类组成的通用列表。您可以为 X 和 Y 使用`Point`结构 in `System.Drawing`（`System.Drawing.Point`或`System.Drawing.PointF`浮点数）。

在对象创建之后，获取您想要的数据与您正在查看的文本解析相比要容易**得多。**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-03-04T16:12:02.290

（这个问题在搜索引擎结果中排名很高，但我最终使用了不同的方法。为这个老问题添加一个答案，以防其他有类似问题的人读到这个）

您可以使用 Json.Net 解决此问题，并制作一个扩展方法来处理您要循环的项目：

```
public static Tuple<string, int, int> ToTuple(this JToken token)
{
    var type = token["attributes"]["OBJECT_TYPE"].ToString();
    var x = token["position"]["x"].Value<int>();
    var y = token["position"]["y"].Value<int>();
    return new Tuple<string, int, int>(type, x, y);
} 
```

然后像这样访问数据：（场景：写入控制台）：

```
var tuples = JObject.Parse(myJsonString)["objects"].Select(item => item.ToTuple()).ToList();
tuples.ForEach(t => Console.WriteLine("{0}: ({1},{2})", t.Item1, t.Item2, t.Item3)); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-08-14T20:09:04.473

```
/*
     * This method takes in JSON in the form returned by javascript's
     * JSON.stringify(Object) and returns a string->string dictionary.
     * This method may be of use when the format of the json is unknown.
     * You can modify the delimiters, etc pretty easily in the source
     * (sorry I didn't abstract it--I have a very specific use).
     */ 
    public static Dictionary<string, string> jsonParse(string rawjson)
    {
        Dictionary<string, string> outdict = new Dictionary<string, string>();
        StringBuilder keybufferbuilder = new StringBuilder();
        StringBuilder valuebufferbuilder = new StringBuilder();
        StringReader bufferreader = new StringReader(rawjson);

        int s = 0;
        bool reading = false;
        bool inside_string = false;
        bool reading_value = false;
        //break at end (returns -1)
        while (s >= 0)
        {
            s = bufferreader.Read();
            //opening of json
            if (!reading)
            {
                if ((char)s == '{' && !inside_string && !reading) reading = true;
                continue;
            }
            else
            {
                //if we find a quote and we are not yet inside a string, advance and get inside
                if (!inside_string)
                {
                    //read past the quote
                    if ((char)s == '\"') inside_string = true;
                    continue;
                }
                if (inside_string)
                {
                    //if we reached the end of the string
                    if ((char)s == '\"')
                    {
                        inside_string = false;
                        s = bufferreader.Read(); //advance pointer
                        if ((char)s == ':')
                        {
                            reading_value = true;
                            continue;
                        }
                        if (reading_value && (char)s == ',')
                        {
                            //we know we just ended the line, so put itin our dictionary
                            if (!outdict.ContainsKey(keybufferbuilder.ToString())) outdict.Add(keybufferbuilder.ToString(), valuebufferbuilder.ToString());
                            //and clear the buffers
                            keybufferbuilder.Clear();
                            valuebufferbuilder.Clear();
                            reading_value = false;
                        }
                        if (reading_value && (char)s == '}')
                        {
                            //we know we just ended the line, so put itin our dictionary
                            if (!outdict.ContainsKey(keybufferbuilder.ToString())) outdict.Add(keybufferbuilder.ToString(), valuebufferbuilder.ToString());
                            //and clear the buffers
                            keybufferbuilder.Clear();
                            valuebufferbuilder.Clear();
                            reading_value = false;
                            reading = false;
                            break;
                        }
                    }
                    else
                    {
                        if (reading_value)
                        {
                            valuebufferbuilder.Append((char)s);
                            continue;
                        }
                        else
                        {
                            keybufferbuilder.Append((char)s);
                            continue;
                        }
                    }
                }
                else
                {
                    switch ((char)s)
                    {
                        case ':':
                            reading_value = true;
                            break;
                        default:
                            if (reading_value)
                            {
                                valuebufferbuilder.Append((char)s);
                            }
                            else
                            {
                                keybufferbuilder.Append((char)s);
                            }
                            break;
                    }
                }
            }
        }
        return outdict;
    } 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2012-05-22T07:03:32.807

您使用`JSON`该类，然后调用该`GetData()`函数。

```
/// <summary>
/// This class encodes and decodes JSON strings.
/// Spec. details, see http://www.json.org/
///
/// JSON uses Arrays and Objects. These correspond here to the datatypes ArrayList and Hashtable.
/// All numbers are parsed to doubles.
/// </summary>
    using System;
    using System.Collections;
    using System.Globalization;
    using System.Text;

public class JSON
{
    public const int TOKEN_NONE = 0;
    public const int TOKEN_CURLY_OPEN = 1;
    public const int TOKEN_CURLY_CLOSE = 2;
    public const int TOKEN_SQUARED_OPEN = 3;
    public const int TOKEN_SQUARED_CLOSE = 4;
    public const int TOKEN_COLON = 5;
    public const int TOKEN_COMMA = 6;
    public const int TOKEN_STRING = 7;
    public const int TOKEN_NUMBER = 8;
    public const int TOKEN_TRUE = 9;
    public const int TOKEN_FALSE = 10;
    public const int TOKEN_NULL = 11;

    private const int BUILDER_CAPACITY = 2000;

    /// <summary>
    /// Parses the string json into a value
    /// </summary>
    /// <param name="json">A JSON string.</param>
    /// <returns>An ArrayList, a Hashtable, a double, a string, null, true, or false</returns>
    public static object JsonDecode(string json)
    {
        bool success = true;

        return JsonDecode(json, ref success);
    }

    /// <summary>
    /// Parses the string json into a value; and fills 'success' with the successfullness of the parse.
    /// </summary>
    /// <param name="json">A JSON string.</param>
    /// <param name="success">Successful parse?</param>
    /// <returns>An ArrayList, a Hashtable, a double, a string, null, true, or false</returns>
    public static object JsonDecode(string json, ref bool success)
    {
        success = true;
        if (json != null) {
            char[] charArray = json.ToCharArray();
            int index = 0;
            object value = ParseValue(charArray, ref index, ref success);
            return value;
        } else {
            return null;
        }
    }

    /// <summary>
    /// Converts a Hashtable / ArrayList object into a JSON string
    /// </summary>
    /// <param name="json">A Hashtable / ArrayList</param>
    /// <returns>A JSON encoded string, or null if object 'json' is not serializable</returns>
    public static string JsonEncode(object json)
    {
        StringBuilder builder = new StringBuilder(BUILDER_CAPACITY);
        bool success = SerializeValue(json, builder);
        return (success ? builder.ToString() : null);
    }

    protected static Hashtable ParseObject(char[] json, ref int index, ref bool success)
    {
        Hashtable table = new Hashtable();
        int token;

        // {
        NextToken(json, ref index);

        bool done = false;
        while (!done) {
            token = LookAhead(json, index);
            if (token == JSON.TOKEN_NONE) {
                success = false;
                return null;
            } else if (token == JSON.TOKEN_COMMA) {
                NextToken(json, ref index);
            } else if (token == JSON.TOKEN_CURLY_CLOSE) {
                NextToken(json, ref index);
                return table;
            } else {

                // name
                string name = ParseString(json, ref index, ref success);
                if (!success) {
                    success = false;
                    return null;
                }

                // :
                token = NextToken(json, ref index);
                if (token != JSON.TOKEN_COLON) {
                    success = false;
                    return null;
                }

                // value
                object value = ParseValue(json, ref index, ref success);
                if (!success) {
                    success = false;
                    return null;
                }

                table[name] = value;
            }
        }

        return table;
    }

    protected static ArrayList ParseArray(char[] json, ref int index, ref bool success)
    {
        ArrayList array = new ArrayList();

        // [
        NextToken(json, ref index);

        bool done = false;
        while (!done) {
            int token = LookAhead(json, index);
            if (token == JSON.TOKEN_NONE) {
                success = false;
                return null;
            } else if (token == JSON.TOKEN_COMMA) {
                NextToken(json, ref index);
            } else if (token == JSON.TOKEN_SQUARED_CLOSE) {
                NextToken(json, ref index);
                break;
            } else {
                object value = ParseValue(json, ref index, ref success);
                if (!success) {
                    return null;
                }

                array.Add(value);
            }
        }

        return array;
    }

    protected static object ParseValue(char[] json, ref int index, ref bool success)
    {
        switch (LookAhead(json, index)) {
            case JSON.TOKEN_STRING:
                return ParseString(json, ref index, ref success);
            case JSON.TOKEN_NUMBER:
                return ParseNumber(json, ref index, ref success);
            case JSON.TOKEN_CURLY_OPEN:
                return ParseObject(json, ref index, ref success);
            case JSON.TOKEN_SQUARED_OPEN:
                return ParseArray(json, ref index, ref success);
            case JSON.TOKEN_TRUE:
                NextToken(json, ref index);
                return true;
            case JSON.TOKEN_FALSE:
                NextToken(json, ref index);
                return false;
            case JSON.TOKEN_NULL:
                NextToken(json, ref index);
                return null;
            case JSON.TOKEN_NONE:
                break;
        }

        success = false;
        return null;
    }

    protected static string ParseString(char[] json, ref int index, ref bool success)
    {
        StringBuilder s = new StringBuilder(BUILDER_CAPACITY);
        char c;

        EatWhitespace(json, ref index);

        // "
        c = json[index++];

        bool complete = false;
        while (!complete) {

            if (index == json.Length) {
                break;
            }

            c = json[index++];
            if (c == '"') {
                complete = true;
                break;
            } else if (c == '\\') {

                if (index == json.Length) {
                    break;
                }
                c = json[index++];
                if (c == '"') {
                    s.Append('"');
                } else if (c == '\\') {
                    s.Append('\\');
                } else if (c == '/') {
                    s.Append('/');
                } else if (c == 'b') {
                    s.Append('\b');
                } else if (c == 'f') {
                    s.Append('\f');
                } else if (c == 'n') {
                    s.Append('\n');
                } else if (c == 'r') {
                    s.Append('\r');
                } else if (c == 't') {
                    s.Append('\t');
                } else if (c == 'u') {
                    int remainingLength = json.Length - index;
                    if (remainingLength >= 4) {
                        // parse the 32 bit hex into an integer codepoint
                        uint codePoint;
                        if (!(success = UInt32.TryParse(new string(json, index, 4), NumberStyles.HexNumber, CultureInfo.InvariantCulture, out codePoint))) {
                            return "";
                        }
                        // convert the integer codepoint to a unicode char and add to string
                        s.Append(Char.ConvertFromUtf32((int)codePoint));
                        // skip 4 chars
                        index += 4;
                    } else {
                        break;
                    }
                }

            } else {
                s.Append(c);
            }

        }

        if (!complete) {
            success = false;
            return null;
        }

        return s.ToString();
    }

    protected static double ParseNumber(char[] json, ref int index, ref bool success)
    {
        EatWhitespace(json, ref index);

        int lastIndex = GetLastIndexOfNumber(json, index);
        int charLength = (lastIndex - index) + 1;

        double number;
        success = Double.TryParse(new string(json, index, charLength), NumberStyles.Any, CultureInfo.InvariantCulture, out number);

        index = lastIndex + 1;
        return number;
    }

    protected static int GetLastIndexOfNumber(char[] json, int index)
    {
        int lastIndex;

        for (lastIndex = index; lastIndex < json.Length; lastIndex++) {
            if ("0123456789+-.eE".IndexOf(json[lastIndex]) == -1) {
                break;
            }
        }
        return lastIndex - 1;
    }

    protected static void EatWhitespace(char[] json, ref int index)
    {
        for (; index < json.Length; index++) {
            if (" \t\n\r".IndexOf(json[index]) == -1) {
                break;
            }
        }
    }

    protected static int LookAhead(char[] json, int index)
    {
        int saveIndex = index;
        return NextToken(json, ref saveIndex);
    }

    protected static int NextToken(char[] json, ref int index)
    {
        EatWhitespace(json, ref index);

        if (index == json.Length) {
            return JSON.TOKEN_NONE;
        }

        char c = json[index];
        index++;
        switch (c) {
            case '{':
                return JSON.TOKEN_CURLY_OPEN;
            case '}':
                return JSON.TOKEN_CURLY_CLOSE;
            case '[':
                return JSON.TOKEN_SQUARED_OPEN;
            case ']':
                return JSON.TOKEN_SQUARED_CLOSE;
            case ',':
                return JSON.TOKEN_COMMA;
            case '"':
                return JSON.TOKEN_STRING;
            case '0': case '1': case '2': case '3': case '4':
            case '5': case '6': case '7': case '8': case '9':
            case '-':
                return JSON.TOKEN_NUMBER;
            case ':':
                return JSON.TOKEN_COLON;
        }
        index--;

        int remainingLength = json.Length - index;

        // false
        if (remainingLength >= 5) {
            if (json[index] == 'f' &&
                json[index + 1] == 'a' &&
                json[index + 2] == 'l' &&
                json[index + 3] == 's' &&
                json[index + 4] == 'e') {
                index += 5;
                return JSON.TOKEN_FALSE;
            }
        }

        // true
        if (remainingLength >= 4) {
            if (json[index] == 't' &&
                json[index + 1] == 'r' &&
                json[index + 2] == 'u' &&
                json[index + 3] == 'e') {
                index += 4;
                return JSON.TOKEN_TRUE;
            }
        }

        // null
        if (remainingLength >= 4) {
            if (json[index] == 'n' &&
                json[index + 1] == 'u' &&
                json[index + 2] == 'l' &&
                json[index + 3] == 'l') {
                index += 4;
                return JSON.TOKEN_NULL;
            }
        }

        return JSON.TOKEN_NONE;
    }

    protected static bool SerializeValue(object value, StringBuilder builder)
    {
        bool success = true;

        if (value is string) {
            success = SerializeString((string)value, builder);
        } else if (value is Hashtable) {
            success = SerializeObject((Hashtable)value, builder);
        } else if (value is ArrayList) {
            success = SerializeArray((ArrayList)value, builder);
        } else if ((value is Boolean) && ((Boolean)value == true)) {
            builder.Append("true");
        } else if ((value is Boolean) && ((Boolean)value == false)) {
            builder.Append("false");
        } else if (value is ValueType) {
            // thanks to ritchie for pointing out ValueType to me
            success = SerializeNumber(Convert.ToDouble(value), builder);
        } else if (value == null) {
            builder.Append("null");
        } else {
            success = false;
        }
        return success;
    }

    protected static bool SerializeObject(Hashtable anObject, StringBuilder builder)
    {
        builder.Append("{");

        IDictionaryEnumerator e = anObject.GetEnumerator();
        bool first = true;
        while (e.MoveNext()) {
            string key = e.Key.ToString();
            object value = e.Value;

            if (!first) {
                builder.Append(", ");
            }

            SerializeString(key, builder);
            builder.Append(":");
            if (!SerializeValue(value, builder)) {
                return false;
            }

            first = false;
        }

        builder.Append("}");
        return true;
    }

    protected static bool SerializeArray(ArrayList anArray, StringBuilder builder)
    {
        builder.Append("[");

        bool first = true;
        for (int i = 0; i < anArray.Count; i++) {
            object value = anArray[i];

            if (!first) {
                builder.Append(", ");
            }

            if (!SerializeValue(value, builder)) {
                return false;
            }

            first = false;
        }

        builder.Append("]");
        return true;
    }

    protected static bool SerializeString(string aString, StringBuilder builder)
    {
        builder.Append("\"");

        char[] charArray = aString.ToCharArray();
        for (int i = 0; i < charArray.Length; i++) {
            char c = charArray[i];
            if (c == '"') {
                builder.Append("\\\"");
            } else if (c == '\\') {
                builder.Append("\\\\");
            } else if (c == '\b') {
                builder.Append("\\b");
            } else if (c == '\f') {
                builder.Append("\\f");
            } else if (c == '\n') {
                builder.Append("\\n");
            } else if (c == '\r') {
                builder.Append("\\r");
            } else if (c == '\t') {
                builder.Append("\\t");
            } else {
                int codepoint = Convert.ToInt32(c);
                if ((codepoint >= 32) && (codepoint <= 126)) {
                    builder.Append(c);
                } else {
                    builder.Append("\\u" + Convert.ToString(codepoint, 16).PadLeft(4, '0'));
                }
            }
        }

        builder.Append("\"");
        return true;
    }

    protected static bool SerializeNumber(double number, StringBuilder builder)
    {
        builder.Append(Convert.ToString(number, CultureInfo.InvariantCulture));
        return true;
    }
}

//parse and show entire json in key-value pair
    Hashtable HTList = (Hashtable)JSON.JsonDecode("completejsonstring");
        public void GetData(Hashtable HT)
        {           
            IDictionaryEnumerator ienum = HT.GetEnumerator();
            while (ienum.MoveNext())
            {
                if (ienum.Value is ArrayList)
                {
                    ArrayList arnew = (ArrayList)ienum.Value;
                    foreach (object obj in arnew)                    
                    {
                        Hashtable hstemp = (Hashtable)obj;
                        GetData(hstemp);
                    }
                }
                else
                {
                    Console.WriteLine(ienum.Key + "=" + ienum.Value);
                }
            }
        } 
```

# mysql - 如何在 MySQL 中找到非 ASCII 字符？

> ID：401771
> 
> 赞同：139
> 
> 时间：2008-12-30T22:54:56.700
> 
> 标签：mysql, character-encoding

我正在使用一个 MySQL 数据库，该数据库具有从[Excel](http://en.wikipedia.org/wiki/Microsoft_Excel)导入的一些数据。数据包含非[ASCII](http://en.wikipedia.org/wiki/ASCII)字符（短划线等）以及隐藏的回车符或换行符。有没有办法使用 MySQL 找到这些记录？

* * *

## 回答 #1

> 赞同：281
> 
> 时间：2012-07-31T13:33:13.093

MySQL 提供了全面的字符集管理，可以帮助解决这类问题。

```
SELECT whatever
  FROM tableName 
 WHERE columnToCheck <> CONVERT(columnToCheck USING ASCII) 
```

该`CONVERT(col USING charset)`函数将不可转换的字符转换为替换字符。然后，转换和未转换的文本将不相等。

有关更多讨论，请参阅此内容。[https://dev.mysql.com/doc/refman/8.0/en/charset-repertoire.html](https://dev.mysql.com/doc/refman/8.0/en/charset-repertoire.html)

您可以使用任何您希望的字符集名称来代替 ASCII。例如，如果您想找出代码页 1257（立陶宛语、拉脱维亚语、爱沙尼亚语）中哪些字符无法正确呈现，请使用`CONVERT(columnToCheck USING cp1257)`

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2009-08-09T22:58:56.417

您可以将 ASCII 定义为十进制值为 0 - 127 (0x00 - 0x7F) 的所有字符，并使用以下查询查找具有非 ASCII 字符的列

```
SELECT * FROM TABLE WHERE NOT HEX(COLUMN) REGEXP '^([0-7][0-9A-F])*$'; 
```

这是我能想到的最全面的查询。

* * *

## 回答 #3

> 赞同：72
> 
> 时间：2008-12-30T23:19:12.143

这完全取决于您定义为“ASCII”的内容，但我建议尝试如下查询的变体：

```
SELECT * FROM tableName WHERE columnToCheck NOT REGEXP '[A-Za-z0-9]'; 
```

该查询将返回 columnToCheck 包含任何非字母数字字符的所有行。如果您有其他可接受的字符，请将它们添加到正则表达式中的字符类。例如，如果句点、逗号和连字符都可以，则将查询更改为：

```
SELECT * FROM tableName WHERE columnToCheck NOT REGEXP '[A-Za-z0-9.,-]'; 
```

MySQL 文档中最相关的页面可能是*[12.5.2 正则表达式](http://dev.mysql.com/doc/refman/5.1/en/regexp.html)*。

* * *

## 回答 #4

> 赞同：50
> 
> 时间：2009-03-12T16:00:08.493

这可能是您正在寻找的：

```
select * from TABLE where COLUMN regexp '[^ -~]'; 
```

它应该返回 COLUMN 包含非 ASCII 字符（或不可打印的 ASCII 字符，例如换行符）的所有行。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2013-08-26T20:22:18.977

上述每个人的示例中缺少的一个字符是终止字符 (\0)。这对 MySQL 控制台输出是不可见的，并且不能被之前提到的任何查询发现。查找它的查询很简单：

```
select * from TABLE where COLUMN like '%\0%'; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-01-05T00:37:05.523

基于正确答案，但也考虑到 ASCII 控制字符，对我有用的解决方案是：

```
SELECT * FROM `table` WHERE NOT `field` REGEXP  "[\\x00-\\xFF]|^$"; 
```

它做同样的事情：在列中搜索违反 ASCII 范围的情况，但也允许您搜索控制字符，因为它使用十六进制表示法作为代码点。由于没有比较或转换（与@Ollie 的答案不同），这也应该更快。（特别是如果 MySQL 提前终止正则表达式查询，它肯定应该这样做。）

它还避免返回长度为零的字段。如果您想要一个可能性能更好的稍长版本，您可以使用它来代替：

```
SELECT * FROM `table` WHERE `field` <> "" AND NOT `field` REGEXP  "[\\x00-\\xFF]"; 
```

它会单独检查长度以避免零长度结果，而不考虑将它们作为正则表达式传递。根据您拥有的零长度条目的数量，这可能会明显更快。

*请注意，如果您的默认字符集很奇怪，其中 0x00-0xFF 不映射到与 ASCII 相同的值（在任何地方都存在这样的字符集吗？），这将返回误报。否则，尽情享受吧！*

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-09-12T07:51:22.610

尝试使用此查询搜索特殊字符记录

```
SELECT *
FROM tableName
WHERE fieldName REGEXP '[^a-zA-Z0-9@:. \'\-`,\&]' 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-11-29T20:39:43.380

@zende 的答案是唯一一个涵盖混合了 ascii 和非 ascii 字符的列，但它也有问题的十六进制内容。我用这个：

```
SELECT * FROM `table` WHERE NOT `column` REGEXP '^[ -~]+$' AND `column` !='' 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-02-28T06:37:53.470

在 Oracle 中，我们可以在下面使用。

```
SELECT * FROM TABLE_A WHERE ASCIISTR(COLUMN_A) <> COLUMN_A; 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2018-03-25T14:38:13.933

对于这个问题，我们也可以使用这种方法：

来自 sql zoo 的问题：
查找 PETER GRÜNBERG 获奖的所有详细信息

非 ASCII 字符

ans: select*from nobel where Winner like 'P% GR%_%berg';

# asp.net - 带有标记文件的 Web 部件？

> ID：401777
> 
> 赞同：0
> 
> 时间：2008-12-30T22:57:00.957
> 
> 标签：asp.net, web-parts

我是 ASP.NET Web 部件新手。我只使用从 WebPart 派生的类并覆盖 CreateChildControls 方法构建了一些简单的类，但没有什么非常重要的。我的问题是是否有可能拥有一个也利用单独的 html/asp.net 标记文件的 Web 部件，这将有助于为 Web 部件的输出提供一些结构。过去我只是创建了服务器控件并将它们添加到控件集合中，但这似乎是一种尝试创建非平凡布局的愚蠢方式。我可以这样做吗？我必须使用 ascx 用户控件还是可以绕过该步骤？有很多关于 web 部件的 hello world 教程，但似乎没有一个超过 CreateChildControls 覆盖。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T21:01:39.783

就在这里。前往[此处](http://fredrik.nsquared2.com/ViewPost.aspx?PostId=248)了解模板化 Web 部件，并前往[此处](http://fredrik.nsquared2.com/ShowCategory.aspx?categoryId=24)查看他在 WebParts 上的所有信息。我在 2004/2005 年使用过这种技术，效果很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-10-13T12:17:12.990

上述答案中的链接不再有效，但这里有一个替代链接： [http ://www.a2zdotnet.com/View.aspx?Id=95](http://www.a2zdotnet.com/View.aspx?Id=95)

在 VS 2010 中，我们也有可视化 Web 部件，我认为它的作用几乎相同，但它包含在项目项中。我只在 SharePoint 的上下文中看到过这一点，因此不确定它如何用于 ASP.NET 项目。这是一个示例：http: [//msdn.microsoft.com/en-us/library/ff597539.aspx](http://msdn.microsoft.com/en-us/library/ff597539.aspx)

# java - 如何使用 Cocoa Touch 解析带有浮点数（Java 生成）的二进制文件？

> ID：401783
> 
> 赞同：2
> 
> 时间：2008-12-30T22:59:19.173
> 
> 标签：java, cocoa-touch, parsing

给定以下用于生成二进制文件的 Java 代码：

```
DataOutputStream out = new DataOutputStream(new FileOutputStream("foo.dat"));
out.writeInt(1234);
out.writeShort(30000);
out.writeFloat(256.384f); 
```

我正在使用以下 Objective-C 代码并设法解析 int 和 short 值：

```
NSString *path = [[NSBundle mainBundle] pathForResource:@"foo" ofType:@"dat"];
NSFileHandle *file = [NSFileHandle fileHandleForReadingAtPath:path];

unsigned long intValue;
memcpy(&intValue, [[file readDataOfLength:4] bytes], 4);
intValue = NSSwapBigLongToHost(intValue);

unsigned short shortValue;
memcpy(&shortValue, [[file readDataOfLength:2] bytes], 2);
shortValue = NSSwapBigShortToHost(shortValue); 
```

我现在的问题是浮点值：关于如何解析它的任何线索？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-30T23:35:01.953

只需我们提供的功能和类型`<Foundation/Foundation.h>`。

```
NSSwappedFloat bigEndianFloat;
memcpy(&bigEndianFloat, [[file readDataOfLength:4] bytes], 4);
float floatValue = NSSwapBigFloatToHost(bigEndianFloat); 
```

请注意，它们在交换字节之前使用特殊类型来保存浮点数。这是因为如果您交换浮点值的字节，它可以更改为 Signaling NaN，并且在某些处理器上，这将通过将其分配给变量来导致硬件异常。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T23:29:20.843

抱歉，我无法提供完整的答案，但我可以说 Java 浮点数作为浮点数的四字节 IEEE 754 表示形式保存到文件中，根据本文档：

[http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Float.html#floatToIntBits(float)](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Float.html#floatToIntBits(float))

这描述了保存的值的确切结构，因此您可以将其作为 int 读取并手动将有效位和指数的位解析为浮点数。似乎应该有一个库调用来解析打包成这种格式的 int 的浮点值。希望其他人会知道处理此问题的库调用。

# python - 在 Python 中使用 Matplotlib 缩放 y 轴

> ID：401787
> 
> 赞同：5
> 
> 时间：2008-12-30T23:02:08.323
> 
> 标签：python, matplotlib

如何使用[Matplotlib](http://matplotlib.sourceforge.net/)缩放 y 轴？我不想改变y-limit，我只想扩展物理空间。

```
^      ^
|      |
|      |
+----> |
Before +---->
       After 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-30T23:21:52.653

实例化图形时只需使用更大的高度值：

```
from pylab import *
x = linspace(0, 10*pi, 2**10)
y = sin(x)
figure(figsize=(5, 10))
plot(x, y)
show() 
```

位置`figsize=(width, height)`和默认为`(8, 6)`. 值以英寸为单位（`dpi`关键字 arg 可用于定义图形的[DPI](http://en.wikipedia.org/wiki/Dots_per_inch)`matplotlibrc` ，文件中有默认值）

对于已经创建的图形，我相信有一种`set_size_inches(width, height)`方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-01T14:00:22.520

使用 subplots_adjust 函数来控制空白的数量：

```
fig.subplots_adust(bottom=0.05, top=0.95) 
```

工具栏上有一个图标可以与小部件交互地执行此操作

# c# - C# Active Directory，为 LDAP 路径中的每个 OU 创建一个组织单元？

> ID：401791
> 
> 赞同：1
> 
> 时间：2008-12-30T23:03:09.103
> 
> 标签：c#, active-directory

我正在尝试为 LDAP 路径中的每个 OU 创建一个组织单位，如果 OU 不存在，程序不知道 OU 名称或 OU 的深度，路径中可能有 1 个 OU 或 10深的。

示例：strPath = "OU=Test1,OU=Test2,OU=Test3,DC=Internal,DC=net"

下面的代码从 strPath 中提取最后一个 OU 'OU=Test1' 并创建 OU，我遇到的最大问题是如果 Test2 和 Test3 也不存在怎么办。我需要先创建父 OU。有人对我如何解决这个问题有任何建议吗？

```
DirectoryEntry parent;
String strOU = strPath.Substring(0, strPath.IndexOf(@","));
objOU = parent.Children.Add(strOU, "OrganizationalUnit");
objOU.CommitChanges(); 
```

我曾尝试将 split 方法与数组一起使用，但我最终只是在根目录中创建了每个 OU，而不是嵌套的 OU。问题是路径中的最后一个 OU（上面的 Test3）需要先创建。我还需要记住，Test3 可能存在！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T23:35:55.243

这是一些关于我将如何执行此操作的伪代码。您只需将每个 OU 从 Test3 开始添加到 Test1。有点粗，希望有道理。

```
string strPath = "OU=Test1,OU=Test2,OU=Test3,DC=Internal,DC=net";
// get just DC portion of distinguished name
int dcIndex = strPath.IndexOf("DC=");
string dcSubString = strPath.Substring(dcIndex);
// get just OU portion of distinguished name
string ouSubString = strPath.Substring(0, dcIndex -1);
string tempDistinguishedName = dcSubString;
string[] ouSubStrings = ouSubString.Split(','); 
for (int i = ouSubStrings.Length - 1; i >= 0; i--)
{
    // bind
    DirectoryEntry parentEntry = new DirectoryEntry(tempDistinguishedName);
    // Create OU
    DirectoryEntry newOU = parentEntry.Children.Add(ouSubStrings[i], "OrganizationalUnit");
    newOU.CommitChanges();
    // create distinguishedName for next bind        
    tempDistinguishedName = ouSubStrings[i] + "," + tempDistinguishedName;
    // clean up unmanaged resources
    newOU.Dispose();
    parentEntry.Dispose(); 
} 
```

# sharepoint - Sharepoint 搜索服务在补丁 KB956716 后崩溃

> ID：401795
> 
> 赞同：1
> 
> 时间：2008-12-30T23:07:18.063
> 
> 标签：sharepoint, sharepoint-2007

我们的网络人员在周末将这个补丁安装到了我们的单服务器共享点前端：KB956716

[http://www.microsoft.com/downloads/details.aspx?familyid=a7fda284-273c-42ab-8188-433beaacca86&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=a7fda284-273c-42ab-8188-433beaacca86&displaylang=en)

[http://support.microsoft.com/kb/956716](http://support.microsoft.com/kb/956716)

之后我们的搜索服务停止工作。

当尝试对我们的任何应用程序进行搜索时，我们会收到此错误：System.IndexOutOfRangeException: DisplayInAdminUI（下面的堆栈信息）

我登录了共享服务管理页面，当我点击搜索设置时，它也崩溃了。

我也在下面包含了事件查看器错误......

有任何想法吗？

谢谢，

克里斯托弗

* * *

事件类型：警告事件源：ASP.NET 2.0.50727.0 事件类别：Web 事件事件 ID：1309 日期：2008 年 12 月 30 日时间：下午 1:03:35 用户：N/A 计算机：VKSPS02 描述：事件代码： 3005 事件消息：发生未处理的异常。事件时间：2008 年 12 月 30 日下午 1:03:35 事件时间 (UTC)：2008 年 12 月 30 日下午 7:03:35 事件 ID：90ade1cc6d5949a3ae2ea97afa5d75e6 事件序列：19275 事件发生：67 事件详细代码：0

应用信息：应用域：/LM/W3SVC/1927250994/Root-1-128751076993856152 信任级别：WSS_Minimal 应用虚拟路径：/应用路径：C:\Inetpub\wwwroot\wss\VirtualDirectories\vktoday80\机器名：VKSPS02

进程信息：进程ID：8136 进程名称：w3wp.exe 账号名称：VIRCHOWKRAUSE\SharePointSSPApp

异常信息：异常类型：IndexOutOfRangeException 异常消息：DisplayInAdminUI

请求信息： 请求URL：[http](http://sitename.domain.net/searchcenter/Pages/peopleresults.aspx?k=lori) ://sitename.domain.net/searchcenter/Pages/peopleresults.aspx?k=lori 请求路径：/searchcenter/Pages/peopleresults.aspx 用户主机地址：172.30.202.56 用户：VIRCHOWKRAUSE\JF11767已通过身份验证：True 身份验证类型：NTLM 线程帐户名：DOMAINNAME\SharePointSSPApp

线程信息：线程 ID：6 线程帐户名称：DOMAINNAME\SharePointSSPApp 正在模拟：False 堆栈跟踪：在 System.Data.ProviderBase.FieldNameLookup.GetOrdinal(String fieldName) 在 System.Data.SqlClient.SqlDataReader.GetOrdinal(String name) 在System.Data.SqlClient.SqlDataReader.get_Item(String name) 在 Microsoft.Office.Server.Search.Query.ConsumerScopeCache.Refresh() 在 Microsoft.Office.Server.Search.Query.ConsumerScopeCache.EnsureFresh() 在 Microsoft.Office。 Microsoft.Office.Server.Search.Query.ScopeCache.TryGetSharedScope(Int32 id, ScopeInformation& scope) 在 Microsoft.Office.Server.Search.WebControls 上的 Server.Search.Query.ScopeCache.TryGetScope(Guid siteGuid, Int32 id, ScopeInformation& scope) Microsoft.Office.Server.Search 上的 .CoreResultsWebPart.SetPropertiesOnHiddenObject()。WebControls.PeopleCoreResultsWebPart.SetPropertiesOnHiddenObject() 在 Microsoft.Office.Server.Search.WebControls.CoreResultsWebPart.OnPreRender(EventArgs e) 在 Microsoft.Office.Server.Search.WebControls.PeopleCoreResultsWebPart.OnPreRender(EventArgs e) 在 System.Web.UI。 Control.PreRenderRecursiveInternal() 在 System.Web.UI.WebControls.WebParts.WebPart.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web。 UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)SetPropertiesOnHiddenObject() 在 Microsoft.Office.Server.Search.WebControls.CoreResultsWebPart.OnPreRender(EventArgs e) 在 Microsoft.Office.Server.Search.WebControls.PeopleCoreResultsWebPart.OnPreRender(EventArgs e) 在 System.Web.UI.Control.PreRenderRecursiveInternal( ) 在 System.Web.UI.WebControls.WebParts.WebPart.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control。 PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)SetPropertiesOnHiddenObject() 在 Microsoft.Office.Server.Search.WebControls.CoreResultsWebPart.OnPreRender(EventArgs e) 在 Microsoft.Office.Server.Search.WebControls.PeopleCoreResultsWebPart.OnPreRender(EventArgs e) 在 System.Web.UI.Control.PreRenderRecursiveInternal( ) 在 System.Web.UI.WebControls.WebParts.WebPart.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control。 PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)OnPreRender(EventArgs e) 在 Microsoft.Office.Server.Search.WebControls.PeopleCoreResultsWebPart.OnPreRender(EventArgs e) 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.WebControls.WebParts.WebPart.PreRenderRecursiveInternal( ) 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Page.ProcessRequestMain（布尔 includeStagesBeforeAsyncPoint，布尔 includeStagesAfterAsyncPoint）OnPreRender(EventArgs e) 在 Microsoft.Office.Server.Search.WebControls.PeopleCoreResultsWebPart.OnPreRender(EventArgs e) 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.WebControls.WebParts.WebPart.PreRenderRecursiveInternal( ) 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Page.ProcessRequestMain（布尔 includeStagesBeforeAsyncPoint，布尔 includeStagesAfterAsyncPoint）WebParts.WebPart.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI。 Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Page.ProcessRequestMain（布尔 includeStagesBeforeAsyncPoint，布尔 includeStagesAfterAsyncPoint）WebParts.WebPart.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI。 Control.PreRenderRecursiveInternal() 在 System.Web.UI.Control.PreRenderRecursiveInternal() 在 System.Web.UI.Page.ProcessRequestMain（布尔 includeStagesBeforeAsyncPoint，布尔 includeStagesAfterAsyncPoint）Boolean includeStagesAfterAsyncPoint)Boolean includeStagesAfterAsyncPoint)

自定义活动详情：

[有关详细信息，请参阅http://go.microsoft.com/fwlink/events.asp](http://go.microsoft.com/fwlink/events.asp)上的帮助和支持中心。

* * *

## “/”应用程序中的服务器错误。

DisplayInAdminUI 描述：在执行当前 Web 请求期间发生未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。

异常详细信息：System.IndexOutOfRangeException：DisplayInAdminUI

源错误：

在执行当前 Web 请求期间生成了未处理的异常。可以使用下面的异常堆栈跟踪来识别有关异常起源和位置的信息。

堆栈跟踪：

[IndexOutOfRangeException: DisplayInAdminUI] System.Data.ProviderBase.FieldNameLookup.GetOrdinal(String fieldName) +1433771 System.Data.SqlClient.SqlDataReader.GetOrdinal(String name) +102 System.Data.SqlClient.SqlDataReader.get_Item(String name) +12 Microsoft.Office.Server.Search.Query.ConsumerScopeCache.Refresh() +1241 Microsoft.Office.Server.Search.Query.ConsumerScopeCache.EnsureFresh() +58 Microsoft.Office.Server.Search.Query.ScopeCache.TryGetScope(Guid siteGuid , Int32 id, ScopeInformation& 范围) +75 Microsoft.Office.Server.Search.Query.ScopeCache.TryGetSharedScope(Int32 id, ScopeInformation& 范围) +68 Microsoft.Office.Server.Search.WebControls.CoreResultsWebPart.SetPropertiesOnHiddenObject() +2503 Microsoft. Office.Server.Search.WebControls.PeopleCoreResultsWebPart。SetPropertiesOnHiddenObject() +41 Microsoft.Office.Server.Search.WebControls.CoreResultsWebPart.OnPreRender(EventArgs e) +1977 Microsoft.Office.Server.Search.WebControls.PeopleCoreResultsWebPart.OnPreRender(EventArgs e) +11 System.Web.UI.Control .PreRenderRecursiveInternal() +86 System.Web.UI.WebControls.WebParts.WebPart.PreRenderRecursiveInternal() +62 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 系统.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint , 布尔型 includeStagesAfterAsyncPoint) +2041OnPreRender(EventArgs e) +1977 Microsoft.Office.Server.Search.WebControls.PeopleCoreResultsWebPart.OnPreRender(EventArgs e) +11 System.Web.UI.Control.PreRenderRecursiveInternal() +86 System.Web.UI.WebControls.WebParts.WebPart .PreRenderRecursiveInternal() +62 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI .Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Page.ProcessRequestMain(布尔 includeStagesBeforeAsyncPoint，布尔 includeStagesAfterAsyncPoint) +2041OnPreRender(EventArgs e) +1977 Microsoft.Office.Server.Search.WebControls.PeopleCoreResultsWebPart.OnPreRender(EventArgs e) +11 System.Web.UI.Control.PreRenderRecursiveInternal() +86 System.Web.UI.WebControls.WebParts.WebPart .PreRenderRecursiveInternal() +62 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI .Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Page.ProcessRequestMain(布尔 includeStagesBeforeAsyncPoint，布尔 includeStagesAfterAsyncPoint) +2041PreRenderRecursiveInternal() +86 System.Web.UI.WebControls.WebParts.WebPart.PreRenderRecursiveInternal() +62 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 系统。 Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint,布尔型 includeStagesAfterAsyncPoint) +2041PreRenderRecursiveInternal() +86 System.Web.UI.WebControls.WebParts.WebPart.PreRenderRecursiveInternal() +62 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 系统。 Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Control.PreRenderRecursiveInternal() +170 System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint,布尔型 includeStagesAfterAsyncPoint) +2041Control.PreRenderRecursiveInternal() +170 System.Web.UI.Page.ProcessRequestMain（布尔型 includeStagesBeforeAsyncPoint，布尔型 includeStagesAfterAsyncPoint）+2041Control.PreRenderRecursiveInternal() +170 System.Web.UI.Page.ProcessRequestMain（布尔型 includeStagesBeforeAsyncPoint，布尔型 includeStagesAfterAsyncPoint）+2041

* * *

版本信息：Microsoft .NET Framework 版本：2.0.50727.1433；ASP.NET 版本：2.0.50727.1433

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T07:53:50.780

我在搜索索引损坏（由索引服务器随机重新启动引起）方面有过类似的经历，不幸的是，修复它的唯一方法是停止搜索服务并重新启动它们。这是通过服务器上的 Central Admin-Operations-Topology 和 Services-Services 完成的。

并不是说我们收到此错误 - 您收到的 IndexOutOfRangeException 错误与超出列表范围的内容或显示 UI 时的某些内容有关，而不是与搜索索引有关。但是，您描述的行为与我们得到的相同 - 搜索返回错误并且无法访问共享服务提供程序中的搜索配置区域。

请注意，这与停止和启动 Windows 服务不同 - 停止搜索服务会将其从索引服务器中卸载并启动它会重新安装它，因此您将丢失搜索索引，并且必须进行完整的爬网才能将其取回。因此，请确保您没有其他选择，并且愿意在走这条路之前丢失您的搜索索引。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T21:13:44.923

好吧，我崩溃了，打开了一张带有 M$ 的支持票。他们确实很快解决了这个问题。我们使用 lan Desk 将补丁推送到我们的服务器。安装补丁后，我们的网络人员没有运行 sharepoint 产品配置向导。我想这需要对大多数补丁确实更新的二进制文件进行任何更新。

所以我们运行了配置向导，它失败了。然后尝试使用命令行运行它：

C:\Program Files\Common Files\Microsoft Shared\web server extensions\12\BIN>PSCO NFIG -CMD UPGRADE -INPLACE B2B -FORCE -WAIT

那也失败了......但只是在重新启动服务的最后一步（在日志中找到该信息）。所以我们手动启动服务，重置iis。它成功了！

我想我们的网络人员需要学习在命令提示符下运行 Sharepoint Configuration Wixard 或 Psconfig。

# c++ - 从“OLE_HANDLE”转换为“HICON”的正确方法是什么？

> ID：401812
> 
> 赞同：4
> 
> 时间：2008-12-30T23:16:24.660
> 
> 标签：c++, windows, winapi, mfc, casting

对于 x64 目标构建，从“OLE_HANDLE”转换为“HICON”的正确方法是什么？

特别是对于普通的 C 样式转换，我在使用 x64 配置编译时收到此警告：

警告 C4312：“类型转换”：从“OLE_HANDLE”转换为更大尺寸的“HICON”

这是有问题的代码：

```
imgList.Add((HICON)ohIcon); 
```

**上面的代码对我来说很好，但我想在为 x64 构建时摆脱警告。**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-30T23:53:01.153

H 放弃了它，在这种情况下，库代码创建了一个独特的类型，为您提供更多的类型安全性（在旧的 C API 时代）。

它们实际上都是 HANDLE，它是一个内核对象，并不真正关心资源是什么，只是你有它的“句柄”。记住 API 是 C 的，所以使用 C 风格转换，当你要删除它时，使用 DeleteObject()。

编辑：64 位嗯...问题是因为 MS 将句柄更新为 64 位，但留下了 OLE 的东西。幸运的是，他们所做的只是用零填充额外的位。

尝试使用[LongToHandle 转换例程](http://msdn.microsoft.com/en-us/library/aa384267(VS.85).aspx)并查看[MIDL 移植指南](http://msdn.microsoft.com/en-us/library/ms810720.aspx)- 向下滚动到“USER 和 GDI 句柄是符号扩展 32b 值”部分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-31T05:18:21.980

假设您根据问题使用 Microsoft Visual Studio...

如果您仅针对 32 位目标进行开发，则可以选择通过关闭项目选项[“检测 64 位可移植性问题”（C++ 编译器选项 /Wp64）来禁用此功能（以及一些其他类似的警告）。](http://msdn.microsoft.com/en-us/library/yt4xw8fh(VS.80).aspx)

如果您也在为 64 位目标进行开发，那么@Harper 可能是正确的，您需要更多地挖掘正确的方法来处理这个问题。您可能想阅读[这份白皮书](http://msdn.microsoft.com/en-us/library/ms810720.aspx)作为起点；转到有关 USER 和 GDI 句柄的部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-31T03:37:04.960

我做了一点挖掘 - OLE_HANDLE 似乎是一个无符号长整数，而 HICON 是一个 void* 。在 32 位 Windows 中，它们的大小相同，但在 Windows x64 中，void* 是 64 位。没有一种安全的方法来进行这种转换——额外的 32 位是未定义的。不幸的是，我能够挖掘出的涉及 ULONG（OLE_HANDLE 甚至更罕见的野兽）的唯一建议只是简单地说“不要将其转换为指针”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-31T14:14:43.693

我怀疑在它们之间进行“正确”投射的“正确”答案是“不要那样做”。诚然，这不是很有帮助...... OLE_HANDLE 首先来自哪里？听起来您将不得不使用 OLE_HANDLE 重写代码才能在任何地方使用 HICON。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-30T23:40:53.113

```
HICON hSomeIcon = (HICON) hSomeOLEHandle; 
```

即它们是可互换的。

# .net - 如何让 Click-once 部署的应用程序在启动时运行？

> ID：401816
> 
> 赞同：26
> 
> 时间：2008-12-30T23:17:53.830
> 
> 标签：.net, clickonce, startup

如何让 Click-once 部署的应用程序运行启动？

我通过搜索找到的最佳选择是将应用程序上的发布者设置为启动，因此开始菜单快捷方式将放置在启动文件夹中，但这似乎是一个巨大的黑客，我希望有一个开始菜单图标的人可以找到。

我有什么选择？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2012-01-01T19:50:59.740

我觉得将您的应用程序添加到启动文件夹是不专业的。我强烈建议使用启动注册表项来启动您的应用程序。

与该主题的许多材料所说的相反，设置一个键来启动单击一次应用程序非常简单，并且不需要设置其他快捷方式。您只需使用安装时创建的快捷方式：

```
// The path to the key where Windows looks for startup applications
RegistryKey rkApp = Registry.CurrentUser.OpenSubKey(
                    @"SOFTWARE\Microsoft\Windows\CurrentVersion\Run", true);

//Path to launch shortcut
string startPath = Environment.GetFolderPath(Environment.SpecialFolder.Programs) 
                   + @"\YourPublisher\YourSuite\YourProduct.appref-ms";

rkApp.SetValue("YourProduct", startPath); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2014-05-06T16:47:14.020

在阅读了关于这个线程的所有评论和[上面提到的 johnnycoder 博客文章之后](http://johnnycoder.com/blog/2009/02/24/clickonce-run-at-startup/)，我想出了一个解决方案：

1.  将 ClickOnce 应用程序添加到 Startup 文件夹
2.  卸载 ClickOnce 应用程序时自动删除启动项（重新启动或注销/登录后）
3.  经过测试并在 Windows XP、Windows 7、Windows Server 2000/2003、Windows 8 上运行

**我的解决方案**

基本上，您的应用程序会将一个`.bat`文件写入启动文件夹，该文件夹会为您启动 ClickOnce 应用程序。该`.bat`文件足够智能，可以检测应用程序是否已被卸载，如果找不到 ClickOnce 应用程序，它将自行删除。

**第1步**

让批处理文件工作。将 PUBLISHER_NAME 和 APPLICATION_NAME 替换为正确的值。您可以通过安装 ClickOnce 应用程序，然后按照文件系统上的路径找到它们：

```
@echo off

IF EXIST "%appdata%\Microsoft\Windows\Start Menu\Programs\PUBLISHER_NAME\APPLICATION_NAME.appref-ms" (
"%appdata%\Microsoft\Windows\Start Menu\Programs\PUBLISHER_NAME\APPLICATION_NAME.appref-ms"
) ELSE (start /b "" cmd /c del "%~f0"&exit /b) 
```

批处理文件将检查您的 ClickOnce 应用程序是否已安装（通过查看 appref-ms 文件是否存在），如果存在则启动它。否则，批处理文件会通过[此处概述](https://stackoverflow.com/a/20333152/1103584)的方法自行删除。

现在您有了批处理文件，请对其进行测试。将其放在您的 Startup 文件夹中，以确保它在登录时启动您的应用程序。

**第2步**

现在，在您的应用程序代码中，您需要将此批处理文件写入 Startup 文件夹。这是在 C# 中使用上述批处理文件的示例（请注意，有一些转义和环境变量 voodoo 发生）：

```
string[] mystrings = new string[] { @"@echo off

IF EXIST ""%appdata%\Microsoft\Windows\Start Menu\Programs\PUBLISHER_NAME\APPLICATION_NAME.appref-ms"" (
""%appdata%\Microsoft\Windows\Start Menu\Programs\PUBLISHER_NAME\APPLICATION_NAME.appref-ms""
) ELSE (start /b """" cmd /c del ""%~f0""&exit /b)"};

string fullPath = "%appdata%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\StartMyClickOnceApp.bat";

//Expands the %appdata% path and writes the file to the Startup folder
System.IO.File.WriteAllLines(Environment.ExpandEnvironmentVariables(fullPath), mystrings); 
```

你有它。欢迎评论/改进。

编辑：第 2 步中的固定引号

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-11T00:21:54.127

不幸的是，所有这些技巧都不适用于 Vista。由于某种原因，Vista 在启动时会阻止这些程序。

正如@thijs 所建议的那样，您可以轻松绕过vista 的“安全性”。请参阅有关[如何在 Windows 启动时运行 clickonce 应用程序的博文](http://brokenwire.net/bw/Programming/116/run-clickonce-app-on-startup)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-12-10T21:41:25.670

好吧，有很多方法可以让您的应用程序在启动时启动，但是有一个清理问题。即使您使用启动注册表项并且它看起来不错，无论如何您应该清除所有添加到系统中的内容。[你可以看看我的文章，我遇到了同样的清理问题并使用自动化和自定义卸载文件来解决问题。](http://www.codeproject.com/Articles/506162/ClickOnce-application-autostart-clean-uninstall-or)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-07-23T18:34:30.077

感谢 DiscDev 和 dbenham。该解决方案效果很好。只是想分享基于 dbenham 最新的更新的工作代码。

```
 const string fullPathEnvVar =
            "%appdata%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\StartMyClickOnceApp.bat";
 //Expands the %appdata% path
 string fullPath = Environment.ExpandEnvironmentVariables(fullPathEnvVar);

if (!File.Exists(fullPath))
        {
            string[] mystrings =
            {
                @"@echo off 
if exist ""%appdata%\Microsoft\Windows\Start Menu\Programs\<PublisherName>\<ApplicationName>.appref-ms"" (
""%appdata%\Microsoft\Windows\Start Menu\Programs\<PublisherName>\<ApplicationName>.appref-ms""
) else (
(goto) 2>nul & del ""%~f0""
)"
            };
            //write the file to the Startup folder
            File.WriteAllLines(fullPath, mystrings);
        } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-08-08T10:40:09.163

首先感谢 Discdev 的回答。为了让它与 Å Ä Ö 和其他特殊字符一起使用，这个修改为我做了它，使用 UTF-8 不同的代码页并且没有 BOM。

```
string[] mystrings = new string[] { "chcp 65001", @"IF EXIST ""%appdata%\Microsoft\Windows\Start Menu\Programs\<Publisher>\<App_Name>.appref-ms"" (""%appdata%\Microsoft\Windows\Start Menu\Programs\<Publisher>\<App_Name>.appref-ms"") ELSE (start /b """" cmd /c del ""%~f0""&exit /b)" };
string fullPath = "%appdata%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\StartErrandDynamicMenu.bat";
System.Text.Encoding utf8WithoutBOM = new System.Text.UTF8Encoding(false);
System.IO.File.WriteAllLines(Environment.ExpandEnvironmentVariables(fullPath), mystrings, utf8WithoutBOM); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-30T23:27:52.110

就实际让应用程序在启动时启动而言，在启动文件夹中有一个链接是您最好的选择。或者，如果不是启动文件夹，则启动 reg 键。

解决没有图标处于正常位置的一种方法是让应用程序在应用程序启动时将指向自身的链接放置到启动文件夹中。ClickOnce 应用程序将在首次安装时运行。应用程序可以使用此启动在 Startup 文件夹中放置一个链接。现在链接将在两个地方，你应该是金色的。

虽然现在删除 ClickOnce 应用程序将不再实际删除它，但存在一个问题。ClickOnce 不会跟踪添加的手动链接，因此每次有人卸载您的应用并重新启动时，它都会重新安装。我会开始考虑该程序表现不佳:(。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-31T00:26:06.673

您可以在启动时将您的应用程序添加到适当的“运行”启动注册表项。然后，即使您的应用程序被删除时您无法删除它，它也不会造成任何伤害，并且没有人会看到损坏的引用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-05-09T06:31:34.600

如果它可以帮助其他仍在寻找解决方案的人，请在底部[http://johnnycoder.com/blog/2009/02/24/clickonce-run-at-startup/](https://web.archive.org/web/20180309115624/http://johnnycoder.com/blog/2009/02/24/clickonce-run-at-startup/)建议设置 ClickOnce 发布选项（在项目属性、发布屏幕和选项上的 VS.Net 2010 中），发布者名称设置为启动，套件名称留空。这确实为我在 Windows 7 上的启动文件夹中提供了程序快捷方式。我不知道其他版本的 Windows 做什么。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-12-20T17:19:11.733

出于某种原因，登录时 Windows 不会启动我的应用程序（“.appref-ms”文件）。所以，我想出了一个解决方案，其他人可能也会觉得有帮助。

第一次安装我的应用程序时（以及在我的应用程序启动时），我添加/验证我的应用程序当前位置是否`string.Concat(Application.ExecutablePath, " ", "/startup")`存在于注册表中`"HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run"`。然后当应用程序启动时，我检查“/startup”的参数，如果存在，则执行以下代码。

```
var startMenuFile = Path.Combine("Programs", Company, Product + ".appref-ms");
var startMenuFolder = Environment.GetFolderPath(Environment.SpecialFolder.StartMenu);
var fileName = Path.Combine(startMenuFolder, startMenuFile);

if (File.Exists(fileName))
{
    Process.Start(fileName);
    return;
}

// Log that for some reason, the application doesn't exist. 
```

这对我很有用。但是，如果您只是在`Application.ExecutablePath`没有争论的情况下将值添加到注册表`"/startup"`，则应用程序将在 Windows 启动时启动，但不会在“单击一次”应用程序的上下文中启动。这将不允许您访问`ApplicationDeployment.CurrentDeployment`. 虽然，这很好，但问题仍然存在，当我的应用程序被卸载时，注册表设置没有被删除。这可以通过使用[@Ivan Leonenko](https://stackoverflow.com/a/13809738/412393)自定义卸载解决方案来解决。希望这可以帮助...

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-03-28T19:56:15.880

我做这个并为我工作

```
 Sub AddToStartup()
    If My.Application.IsNetworkDeployed Then

        Dim str As String = My.Application.Deployment.UpdatedApplicationFullName.ToString

        Dim saida As String = ""

        For i As Integer = 0 To str.Split(",").Length

            If Not saida.Contains("msil") Then
                saida += str.Split(",")(i) & ", "
            End If
        Next

        If saida.Contains("msil") Then
            saida = saida.Substring(0, saida.Length - 2)
        End If

        Dim name As String = My.Application.Info.Title
        Dim file As String = Path.Combine(My.Application.Info.DirectoryPath, name & ".appref-ms")
        My.Computer.FileSystem.WriteAllText(file, saida, False)

        Dim reg As RegistryKey = Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", True)
        reg.SetValue(name, file)

    End If

End Sub 
```

# asp.net-ajax - ASP.net Ajax：使用代码隐藏功能而不是 Web 服务

> ID：401820
> 
> 赞同：0
> 
> 时间：2008-12-30T23:20:23.560
> 
> 标签：asp.net-ajax

是否可以不使用 ASP.net ajax 的 Web 服务，而是调用代码隐藏函数来获取数据？

任何示例或链接都非常适用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T23:26:15.903

根据[ASP.NET AJAX 文档](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/AutoComplete/AutoComplete.aspx)（至少对于 AutoComplete TextBox 控件），如果您不提供 ServicePath 属性供控件访问，那么要调用的方法（在 ServiceMethod 属性中指定）必须是页面方法。

我读到这篇文章是说您可以简单地在您的代码隐藏文件中创建一个方法，该方法与 AutoComplete 所期望的正确签名相匹配，您应该一切就绪。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T23:28:04.170

[这](http://weblogs.asp.net/sohailsayed/archive/2008/02/23/calling-methods-in-a-codebehind-function-pagemethods-from-client-side-using-ajax-net.aspx)似乎是您正在寻找的。

# ruby - 如何优雅地计算 ruby 中单词的字谜签名？

> ID：401834
> 
> 赞同：3
> 
> 时间：2008-12-30T23:27:46.947
> 
> 标签：ruby, algorithm

出于[这个](https://stackoverflow.com/questions/401467/how-to-reduce-the-size-of-an-sqlite3-database-for-iphone)问题，我正在寻找一种优雅的（红宝石）方法来计算[此](https://stackoverflow.com/questions/401467/how-to-reduce-the-size-of-an-sqlite3-database-for-iphone#401518)答案中建议的单词签名。

建议的想法是对单词中的字母进行排序，并对重复的字母进行运行长度编码。因此，例如“mississippi”首先变为“iiiimppssss”，然后可以通过编码为“4impp4s”进一步缩短。

我对 ruby​​ 比较陌生，虽然我可以一起破解一些东西，但我敢肯定，对于有更多 ruby​​ 经验的人来说，这是一个单一的衬里。我很想看看人们的方法并提高我的红宝石知识。

*编辑：澄清一下，计算签名的性能对我的应用程序来说并不重要。我正在寻找计算签名，以便我可以将每个单词与每个单词一起存储在一个大型单词数据库（450K 单词）中，然后查询具有相同签名的单词（即给定单词的所有字谜，它们是实际的英文单词）。因此专注于空间。“优雅”的部分只是为了满足我的好奇心。*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-30T23:40:28.357

创建字母排序列表的最快方法是：

```
"mississippi".unpack("c*").sort.pack("c*") 
```

它比 split('') 和 join() 快很多。为了进行比较，最好将数组重新打包成一个字符串，这样您就不必比较数组。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-30T23:35:41.267

我也不是一个 Ruby 人，但正如我在另一条评论中指出的那样，这似乎适用于所描述的算法。

```
s = "mississippi"
s.split('').sort.join.gsub(/(.)\1{2,}/) { |s| s.length.to_s + s[0,1] } 
```

当然，您需要确保单词是小写的，不包含数字等。

根据要求，我将尝试解释代码。如果我没有正确理解所有 Ruby 或 reg ex 术语，请原谅我，但这里有。

我认为拆分/排序/连接部分非常简单。对我来说有趣的部分始于对 gsub 的调用。这会将匹配正则表达式的子字符串替换为其后面块的返回值。reg ex 找到任何字符并创建反向引用。那是“（。）”部分。然后，我们使用反向引用“\1”继续匹配过程，该反向引用评估匹配的第一部分找到的任何字符。我们希望该字符至少再出现两次，至少出现 3 次。这是使用量词“{2,}”完成的。

如果找到匹配项，则匹配的子字符串将作为参数传递给下一个代码块，这要归功于“|s|” 部分。最后，我们使用匹配子字符串长度的字符串等价物，并将组成该子字符串的任何字符附加到它（它们应该都是相同的）并返回连接的值。返回的值替换原始匹配的子字符串。整个过程继续进行，直到没有任何匹配项，因为它是对原始字符串的全局替换。

如果这令人困惑，我深表歉意。通常情况下，我更容易想象解决方案而不是清楚地解释它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T23:38:06.597

我没有看到一个优雅的解决方案。您可以使用该`split`消息将字符放入一个数组中，但是一旦您对列表进行了排序，我就看不到一个很好的线性时间连接原语来返回一个字符串。我很惊讶。

顺便说一句，**游程编码几乎可以肯定是浪费时间**。在我认为值得考虑之前，我必须看到一些非常令人印象深刻的测量结果。如果避免运行长度编码，则可以**对任何字符串进行 anagrammatize**，而不仅仅是一串字母。如果你知道你只有字母并且想节省空间，你可以将它们 5 位打包成一个字母。

---伊尔玛维普

* * *

**编辑**`join`：发现我错过的另一张海报。好的。

# geometry - 圆-矩形碰撞检测（相交）

> ID：401847
> 
> 赞同：218
> 
> 时间：2008-12-30T23:35:02.983
> 
> 标签：geometry, collision-detection

如何判断圆形和矩形在二维欧几里得空间中是否相交？（即经典的二维几何）

* * *

## 回答 #1

> 赞同：310
> 
> 时间：2008-12-31T01:14:50.663

这是我的做法：

```
bool intersects(CircleType circle, RectType rect)
{
    circleDistance.x = abs(circle.x - rect.x);
    circleDistance.y = abs(circle.y - rect.y);

    if (circleDistance.x > (rect.width/2 + circle.r)) { return false; }
    if (circleDistance.y > (rect.height/2 + circle.r)) { return false; }

    if (circleDistance.x <= (rect.width/2)) { return true; } 
    if (circleDistance.y <= (rect.height/2)) { return true; }

    cornerDistance_sq = (circleDistance.x - rect.width/2)^2 +
                         (circleDistance.y - rect.height/2)^2;

    return (cornerDistance_sq <= (circle.r^2));
} 
```

以下是它的工作原理：

![插图](https://i.stack.imgur.com/K6vRH.jpg)

1.  第一对线计算圆心和矩形中心之间的 x 和 y 差的绝对值。这会将四个象限合并为一个，因此不必进行四次计算。图像显示了圆心现在必须位于的区域。请注意，仅显示了单象限。矩形是灰色区域，红色边框勾勒出距离矩形边缘正好一个半径的关键区域。圆的中心必须在这个红色边界内才能发生相交。

2.  第二对线消除了圆距矩形足够远（在任一方向上）以至于不可能相交的简单情况。这对应于图像中的绿色区域。

3.  第三对线处理简单的情况，即圆与矩形足够接近（在任一方向上）以保证相交。这对应于图像中的橙色和灰色部分。请注意，此步骤必须在步骤 2 之后完成，以使逻辑有意义。

4.  其余的行计算圆可能与矩形角相交的困难情况。要求解，计算圆心到角的距离，然后验证距离不大于圆的半径。此计算对于中心在红色阴影区域内的所有圆返回 false，对于中心在白色阴影区域内的所有圆返回 true。

* * *

## 回答 #2

> 赞同：218
> 
> 时间：2008-12-31T01:17:13.433

圆与矩形相交只有两种情况：

*   圆的中心位于矩形内，或者
*   矩形的边缘之一在圆中有一个点。

请注意，这并不要求矩形是轴平行的。

[![圆形和矩形相交的一些不同方式](https://i.stack.imgur.com/fdDv1.png)](https://i.stack.imgur.com/fdDv1.png)

（看到这一点的一种方法：如果没有一条边在圆中有一个点（如果所有边都完全在圆“外部”），那么圆仍然可以与多边形相交的唯一方法是它完全位于多边形。）

有了这种洞察力，类似下面的内容将起作用，其中圆有 center`P`和 radius `R`，并且矩形有 vertices `A`, `B`, `C`,`D`按顺序（不是完整的代码）：

```
def intersect(Circle(P, R), Rectangle(A, B, C, D)):
    S = Circle(P, R)
    return (pointInRectangle(P, Rectangle(A, B, C, D)) or
            intersectCircle(S, (A, B)) or
            intersectCircle(S, (B, C)) or
            intersectCircle(S, (C, D)) or
            intersectCircle(S, (D, A))) 
```

如果您正在编写任何几何图形，您的库中可能已经有上述函数。否则，`pointInRectangle()`可以通过多种方式实现；[多边形](http://en.wikipedia.org/wiki/Point_in_polygon)方法中的任何一般点都可以使用，但是对于矩形，您可以检查这是否有效：

```
0 ≤ AP·AB ≤ AB·AB and 0 ≤ AP·AD ≤ AD·AD 
```

并且`intersectCircle()`也很容易实现：一种方法是检查从`P`到线的垂线的脚是否足够近并且在端点之间，否则检查端点。

很酷的是，*同样*的想法不仅适用于矩形，也适用于圆与任何[简单多边形](http://en.wikipedia.org/wiki/Simple_polygon)的交集——甚至不必是凸的！

* * *

## 回答 #3

> 赞同：135
> 
> 时间：2009-12-10T07:30:04.003

这是另一种实现起来非常简单（而且速度也非常快）的解决方案。它将捕获所有交叉点，包括球体完全进入矩形时。

```
// clamp(value, min, max) - limits value to the range min..max

// Find the closest point to the circle within the rectangle
float closestX = clamp(circle.X, rectangle.Left, rectangle.Right);
float closestY = clamp(circle.Y, rectangle.Top, rectangle.Bottom);

// Calculate the distance between the circle's center and this closest point
float distanceX = circle.X - closestX;
float distanceY = circle.Y - closestY;

// If the distance is less than the circle's radius, an intersection occurs
float distanceSquared = (distanceX * distanceX) + (distanceY * distanceY);
return distanceSquared < (circle.Radius * circle.Radius); 
```

使用任何像样的数学库，都可以缩短到 3 或 4 行。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-05-11T09:09:51.957

您的球体和矩形相交 IIF
圆心和矩形的一个顶点之间的距离小于球体的半径，
或者
圆心和矩形的一个边缘之间的距离小于球体的半径（ [[点线距离](http://mathworld.wolfram.com/Point-LineDistance2-Dimensional.html)]）
或
圆心在矩形

点点距离内：

```
P1 = [x1,y1]
P2 = [x2,y2]
距离 = sqrt(abs(x1 - x2)+abs(y1-y2))

```

点线距离：

```
L1 = [x1,y1],L2 = [x2,y2] （你的线的两个点，即顶点）
P1 = [px,py] 某个点

距离 d = abs( (x2-x1)(y1-py)-(x1-px)(y2-y1) ) / 距离(L1,L2)

```

矩形内的圆心：
采用分离轴方法：如果存在将矩形与该点分开的直线上的投影，则它们不相交

您将点投影在与矩形两侧平行的线上，然后可以轻松确定它们是否相交。如果它们不在所有 4 个投影上相交，则它们（点和矩形）不能相交。

你只需要内积（ x= [x1,x2] ， y = [y1,y2] ， x*y = x1*y1 + x2*y2 ）

你的测试看起来像这样：

```
//矩形边：TL（左上）、TR（右上）、BL（左下）、BR（右下）
//指向测试：POI

分开=假
for egde in { {TL,TR}, {BL,BR}, {TL,BL},{TR-BR} }: // 边缘
    D = 边缘[0] - 边缘[1]
    innerProd = D * POI
    Interval_min = min(D*edge[0],D*edge[1])
    Interval_max = max(D*edge[0],D*edge[1])
    如果不是（Interval_min ≤ innerProd ≤ Interval_max）
           分开=真
           break // 结束 for 循环
    万一
结束
如果（分隔为真）    
      返回“没有交集”
别的
      返回“路口”
万一

```

这不假定轴对齐的矩形，并且可以轻松扩展以测试凸集之间的交叉点。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-09-13T17:15:56.307

我想出的最简单的解决方案非常简单。

它的工作原理是在矩形中找到最接近圆的点，然后比较距离。

您可以通过一些操作完成所有这些操作，甚至可以避免使用 sqrt 函数。

```
public boolean intersects(float cx, float cy, float radius, float left, float top, float right, float bottom)
{
   float closestX = (cx < left ? left : (cx > right ? right : cx));
   float closestY = (cy < top ? top : (cy > bottom ? bottom : cy));
   float dx = closestX - cx;
   float dy = closestY - cy;

   return ( dx * dx + dy * dy ) <= radius * radius;
} 
```

就是这样！上述解决方案假定原点位于世界的左上角，x 轴指向下方。

如果您想要一个处理移动圆和矩形之间碰撞的解决方案，它要复杂得多，并且涵盖[在我的另一个答案中。](https://stackoverflow.com/questions/18704999/how-to-fix-circle-and-rectangle-overlap-in-collision-response/18790389#18790389)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-09-11T23:36:00.350

这是最快的解决方案：

```
public static boolean intersect(Rectangle r, Circle c)
{
    float cx = Math.abs(c.x - r.x - r.halfWidth);
    float xDist = r.halfWidth + c.radius;
    if (cx > xDist)
        return false;
    float cy = Math.abs(c.y - r.y - r.halfHeight);
    float yDist = r.halfHeight + c.radius;
    if (cy > yDist)
        return false;
    if (cx <= r.halfWidth || cy <= r.halfHeight)
        return true;
    float xCornerDist = cx - r.halfWidth;
    float yCornerDist = cy - r.halfHeight;
    float xCornerDistSq = xCornerDist * xCornerDist;
    float yCornerDistSq = yCornerDist * yCornerDist;
    float maxCornerDistSq = c.radius * c.radius;
    return xCornerDistSq + yCornerDistSq <= maxCornerDistSq;
} 
```

注意执行顺序，宽度/高度的一半是预先计算的。此外，平方是“手动”完成的，以节省一些时钟周期。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-04-09T15:33:07.733

实际上，这要简单得多。你只需要两件事。

首先，您需要找到从圆心到矩形每条线的四个**正交距离。**如果其中任何三个大于圆半径，那么您的圆将不会与矩形相交。

其次，您需要找到圆心与矩形中心之间的距离，如果距离大于矩形对角线长度的一半，则您的圆将不在矩形内。

祝你好运！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-06-18T14:43:06.710

这是我的 C 代码，用于解决球体和非轴对齐框之间的碰撞。它依赖于我自己的几个库例程，但它可能对某些人有用。我在游戏中使用它并且效果很好。

```
float physicsProcessCollisionBetweenSelfAndActorRect(SPhysics *self, SPhysics *actor)
{
    float diff = 99999;

    SVector relative_position_of_circle = getDifference2DBetweenVectors(&self->worldPosition, &actor->worldPosition);
    rotateVector2DBy(&relative_position_of_circle, -actor->axis.angleZ); // This aligns the coord system so the rect becomes an AABB

    float x_clamped_within_rectangle = relative_position_of_circle.x;
    float y_clamped_within_rectangle = relative_position_of_circle.y;
    LIMIT(x_clamped_within_rectangle, actor->physicsRect.l, actor->physicsRect.r);
    LIMIT(y_clamped_within_rectangle, actor->physicsRect.b, actor->physicsRect.t);

    // Calculate the distance between the circle's center and this closest point
    float distance_to_nearest_edge_x = relative_position_of_circle.x - x_clamped_within_rectangle;
    float distance_to_nearest_edge_y = relative_position_of_circle.y - y_clamped_within_rectangle;

    // If the distance is less than the circle's radius, an intersection occurs
    float distance_sq_x = SQUARE(distance_to_nearest_edge_x);
    float distance_sq_y = SQUARE(distance_to_nearest_edge_y);
    float radius_sq = SQUARE(self->physicsRadius);
    if(distance_sq_x + distance_sq_y < radius_sq)   
    {
        float half_rect_w = (actor->physicsRect.r - actor->physicsRect.l) * 0.5f;
        float half_rect_h = (actor->physicsRect.t - actor->physicsRect.b) * 0.5f;

        CREATE_VECTOR(push_vector);         

        // If we're at one of the corners of this object, treat this as a circular/circular collision
        if(fabs(relative_position_of_circle.x) > half_rect_w && fabs(relative_position_of_circle.y) > half_rect_h)
        {
            SVector edges;
            if(relative_position_of_circle.x > 0) edges.x = half_rect_w; else edges.x = -half_rect_w;
            if(relative_position_of_circle.y > 0) edges.y = half_rect_h; else edges.y = -half_rect_h;   

            push_vector = relative_position_of_circle;
            moveVectorByInverseVector2D(&push_vector, &edges);

            // We now have the vector from the corner of the rect to the point.
            float delta_length = getVector2DMagnitude(&push_vector);
            float diff = self->physicsRadius - delta_length; // Find out how far away we are from our ideal distance

            // Normalise the vector
            push_vector.x /= delta_length;
            push_vector.y /= delta_length;
            scaleVector2DBy(&push_vector, diff); // Now multiply it by the difference
            push_vector.z = 0;
        }
        else // Nope - just bouncing against one of the edges
        {
            if(relative_position_of_circle.x > 0) // Ball is to the right
                push_vector.x = (half_rect_w + self->physicsRadius) - relative_position_of_circle.x;
            else
                push_vector.x = -((half_rect_w + self->physicsRadius) + relative_position_of_circle.x);

            if(relative_position_of_circle.y > 0) // Ball is above
                push_vector.y = (half_rect_h + self->physicsRadius) - relative_position_of_circle.y;
            else
                push_vector.y = -((half_rect_h + self->physicsRadius) + relative_position_of_circle.y);

            if(fabs(push_vector.x) < fabs(push_vector.y))
                push_vector.y = 0;
            else
                push_vector.x = 0;
        }

        diff = 0; // Cheat, since we don't do anything with the value anyway
        rotateVector2DBy(&push_vector, actor->axis.angleZ);
        SVector *from = &self->worldPosition;       
        moveVectorBy2D(from, push_vector.x, push_vector.y);
    }   
    return diff;
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-31T00:20:58.040

要可视化，请使用键盘的小键盘。如果键 '5' 代表您的矩形，那么所有键 1-9 代表 9 个象限空间除以构成矩形的线（其中 5 是内部。）

1）如果圆的中心在象限5（即矩形内），那么这两个形状相交。

除此之外，有两种可能的情况：a）圆与矩形的两个或多个相邻边缘相交。b) 圆与矩形的一条边相交。

第一种情况很简单。如果圆与矩形的两条相邻边相交，则它必须包含连接这两条边的角。（那个，或者它的中心位于我们已经讨论过的象限 5。还要注意，圆与矩形的两个*相对*边缘相交的情况也被覆盖了。）

2) 如果矩形的任意角 A、B、C、D 位于圆内，则这两个形状相交。

第二种情况更棘手。我们应该注意，只有当圆的中心位于第 2、4、6 或 8 象限之一时才会发生这种情况。（实际上，如果圆心在 1、3、7、8 中的任何一个象限上，则相应的角将是最接近它的点。）

现在我们有了圆的中心在“边缘”象限之一的情况，它只与相应的边缘相交。然后，边缘上最靠近圆心的点必须位于圆内。

3) 对于每条直线 AB、BC、CD、DA，构造通过圆心 P 的垂线 p(AB,P)、p(BC,P)、p(CD,P)、p(DA,P)。对于每条垂直线，如果与原始边缘的交点位于圆内，则两个形状相交。

最后一步有一个捷径。如果圆心在第 8 象限并且边 AB 是上边，则交点将具有 A 和 B 的 y 坐标，以及中心 P 的 x 坐标。

您可以构造四个线的交点并检查它们是否位于相应的边上，或者找出 P 所在的象限并检查相应的交点。两者都应该简化为相同的布尔方程。请注意，上述步骤 2 并未排除 P 位于“角落”象限之一；它只是在寻找一个十字路口。

编辑：事实证明，我忽略了一个简单的事实，即 #2 是上面 #3 的子案例。毕竟，角落也是边缘上的点。请参阅下面的@ShreevatsaR 的答案以获得很好的解释。同时，忘记上面的＃2，除非您想要快速但多余的检查。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-04-23T23:33:18.043

此函数检测圆形和矩形之间的碰撞（相交）。他在他的回答中像 e.James 方法一样工作，但是这个方法检测矩形所有角度的碰撞（不仅是右上角）。

**笔记：**

**aRect.origin.x**和**aRect.origin.y**是矩形左下角的坐标！

**aCircle.x**和**aCircle.y**是圆心的坐标！

```
static inline BOOL RectIntersectsCircle(CGRect aRect, Circle aCircle) {

    float testX = aCircle.x;
    float testY = aCircle.y;

    if (testX < aRect.origin.x)
        testX = aRect.origin.x;
    if (testX > (aRect.origin.x + aRect.size.width))
        testX = (aRect.origin.x + aRect.size.width);
    if (testY < aRect.origin.y)
        testY = aRect.origin.y;
    if (testY > (aRect.origin.y + aRect.size.height))
        testY = (aRect.origin.y + aRect.size.height);

    return ((aCircle.x - testX) * (aCircle.x - testX) + (aCircle.y - testY) * (aCircle.y - testY)) < aCircle.radius * aCircle.radius;
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2020-06-25T23:54:18.437

稍微改进一下[e.James 的答案](https://stackoverflow.com/a/402010/355230)：

```
double dx = abs(circle.x - rect.x) - rect.w / 2,
       dy = abs(circle.y - rect.y) - rect.h / 2;

if (dx > circle.r || dy > circle.r) { return false; }
if (dx <= 0 || dy <= 0) { return true; }

return (dx * dx + dy * dy <= circle.r * circle.r); 
```

这减去一次`rect.w / 2`而`rect.h / 2`不是最多三次。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2021-11-06T01:20:49.747

如果您对更图形化的解决方案感兴趣，它甚至可以在（平面内）旋转的矩形上工作..

演示：[https ://jsfiddle.net/exodus4d/94mxLvqh/2691/](https://jsfiddle.net/exodus4d/94mxLvqh/2691/)

这个想法是：

1.  **将场景**平移到原点 [0,0]
    *   如果矩形不在**平面内**，则**旋转中心**应位于 [0, 0]
2.  **将场景旋转**回平面
3.  计算交点

```
const hasIntersection = ({x: cx, y: cy, r: cr}, {x, y, width, height}) => {
  const distX = Math.abs(cx - x - width / 2);
  const distY = Math.abs(cy - y - height / 2);

  if (distX > (width / 2 + cr)) {
    return false;
  }
  if (distY > (height / 2 + cr)) {
    return false;
  }

  if (distX <= (width / 2)) {
    return true;
  }
  if (distY <= (height / 2)) {
    return true;
  }

  const Δx = distX - width / 2;
  const Δy = distY - height / 2;
  return Δx * Δx + Δy * Δy <= cr * cr;
};

const rect = new DOMRect(50, 20, 100, 50);
const circ1 = new DOMPoint(160, 80);
circ1.r = 20;

const circ2 = new DOMPoint(80, 95);
circ2.r = 20;

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);

ctx.beginPath();
ctx.strokeStyle = hasIntersection(circ1, rect) ? 'red' : 'green';
ctx.arc(circ1.x, circ1.y, circ1.r, 0, 2 * Math.PI);
ctx.stroke();

ctx.beginPath();
ctx.strokeStyle = hasIntersection(circ2, rect) ? 'red' : 'green';
ctx.arc(circ2.x, circ2.y, circ2.r, 0, 2 * Math.PI);
ctx.stroke();
```

```
<canvas id="canvas"></canvas>
```

> 提示：而不是旋转矩形（4 点）。您可以向相反方向旋转圆（1 点）。

[![在此处输入图像描述](https://i.stack.imgur.com/MH4w4.gif)](https://i.stack.imgur.com/MH4w4.gif)

[![在此处输入图像描述](https://i.stack.imgur.com/jpfkj.gif)](https://i.stack.imgur.com/jpfkj.gif)

[![在此处输入图像描述](https://i.stack.imgur.com/JxdHU.gif)](https://i.stack.imgur.com/JxdHU.gif)

[![在此处输入图像描述](https://i.stack.imgur.com/ZRm83.gif)](https://i.stack.imgur.com/ZRm83.gif)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-08-16T06:47:30.857

这是修改后的代码 100% 工作：

```
public static bool IsIntersected(PointF circle, float radius, RectangleF rectangle)
{
    var rectangleCenter = new PointF((rectangle.X +  rectangle.Width / 2),
                                     (rectangle.Y + rectangle.Height / 2));

    var w = rectangle.Width  / 2;
    var h = rectangle.Height / 2;

    var dx = Math.Abs(circle.X - rectangleCenter.X);
    var dy = Math.Abs(circle.Y - rectangleCenter.Y);

    if (dx > (radius + w) || dy > (radius + h)) return false;

    var circleDistance = new PointF
                             {
                                 X = Math.Abs(circle.X - rectangle.X - w),
                                 Y = Math.Abs(circle.Y - rectangle.Y - h)
                             };

    if (circleDistance.X <= (w))
    {
        return true;
    }

    if (circleDistance.Y <= (h))
    {
        return true;
    }

    var cornerDistanceSq = Math.Pow(circleDistance.X - w, 2) + 
                                    Math.Pow(circleDistance.Y - h, 2);

    return (cornerDistanceSq <= (Math.Pow(radius, 2)));
} 
```

巴萨姆·阿卢吉里

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-05-26T09:53:53.497

如果没有必要，我有一种方法可以避免昂贵的毕达哥拉斯 - 即。当矩形和圆形的边界框不相交时。

它也适用于非欧几里得：

```
class Circle {
 // create the bounding box of the circle only once
 BBox bbox;

 public boolean intersect(BBox b) {
    // test top intersect
    if (lat > b.maxLat) {
        if (lon < b.minLon)
            return normDist(b.maxLat, b.minLon) <= normedDist;
        if (lon > b.maxLon)
            return normDist(b.maxLat, b.maxLon) <= normedDist;
        return b.maxLat - bbox.minLat > 0;
    }

    // test bottom intersect
    if (lat < b.minLat) {
        if (lon < b.minLon)
            return normDist(b.minLat, b.minLon) <= normedDist;
        if (lon > b.maxLon)
            return normDist(b.minLat, b.maxLon) <= normedDist;
        return bbox.maxLat - b.minLat > 0;
    }

    // test middle intersect
    if (lon < b.minLon)
        return bbox.maxLon - b.minLon > 0;
    if (lon > b.maxLon)
        return b.maxLon - bbox.minLon > 0;
    return true;
  }
} 
```

*   minLat,maxLat 可以替换为 minY,maxY 和 minLon, maxLon 相同：替换为 minX, maxX
*   normDist 只是比全距离计算快一点的方法。例如，没有欧几里得空间中的平方根（或者没有很多其他的东西用于haversine）`dLat=(lat-circleY); dLon=(lon-circleX); normed=dLat*dLat+dLon*dLon`：。当然，如果您使用该 normDist 方法，则需要`normedDist = dist*dist;`为圆创建一个

[请参阅我的GraphHopper](http://karussell.github.com/GraphHopper/)项目的完整[BBox](https://github.com/karussell/GraphHopper/blob/master/core/src/main/java/de/jetsli/graph/util/shapes/BBox.java)和[Circle](https://github.com/karussell/GraphHopper/blob/master/core/src/main/java/de/jetsli/graph/util/shapes/Circle.java)代码。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-06-22T15:40:07.093

我创建了形状工作类希望你喜欢

```
public class Geomethry {
  public static boolean intersectionCircleAndRectangle(int circleX, int circleY, int circleR, int rectangleX, int rectangleY, int rectangleWidth, int rectangleHeight){
    boolean result = false;

    float rectHalfWidth = rectangleWidth/2.0f;
    float rectHalfHeight = rectangleHeight/2.0f;

    float rectCenterX = rectangleX + rectHalfWidth;
    float rectCenterY = rectangleY + rectHalfHeight;

    float deltax = Math.abs(rectCenterX - circleX);
    float deltay = Math.abs(rectCenterY - circleY);

    float lengthHypotenuseSqure = deltax*deltax + deltay*deltay;

    do{
        // check that distance between the centerse is more than the distance between the circumcircle of rectangle and circle
        if(lengthHypotenuseSqure > ((rectHalfWidth+circleR)*(rectHalfWidth+circleR) + (rectHalfHeight+circleR)*(rectHalfHeight+circleR))){
            //System.out.println("distance between the centerse is more than the distance between the circumcircle of rectangle and circle");
            break;
        }

        // check that distance between the centerse is less than the distance between the inscribed circle
        float rectMinHalfSide = Math.min(rectHalfWidth, rectHalfHeight);
        if(lengthHypotenuseSqure < ((rectMinHalfSide+circleR)*(rectMinHalfSide+circleR))){
            //System.out.println("distance between the centerse is less than the distance between the inscribed circle");
            result=true;
            break;
        }

        // check that the squares relate to angles
        if((deltax > (rectHalfWidth+circleR)*0.9) && (deltay > (rectHalfHeight+circleR)*0.9)){
            //System.out.println("squares relate to angles");
            result=true;
        }
    }while(false);

    return result;
}

public static boolean intersectionRectangleAndRectangle(int rectangleX, int rectangleY, int rectangleWidth, int rectangleHeight, int rectangleX2, int rectangleY2, int rectangleWidth2, int rectangleHeight2){
    boolean result = false;

    float rectHalfWidth = rectangleWidth/2.0f;
    float rectHalfHeight = rectangleHeight/2.0f;
    float rectHalfWidth2 = rectangleWidth2/2.0f;
    float rectHalfHeight2 = rectangleHeight2/2.0f;

    float deltax = Math.abs((rectangleX + rectHalfWidth) - (rectangleX2 + rectHalfWidth2));
    float deltay = Math.abs((rectangleY + rectHalfHeight) - (rectangleY2 + rectHalfHeight2));

    float lengthHypotenuseSqure = deltax*deltax + deltay*deltay;

    do{
        // check that distance between the centerse is more than the distance between the circumcircle
        if(lengthHypotenuseSqure > ((rectHalfWidth+rectHalfWidth2)*(rectHalfWidth+rectHalfWidth2) + (rectHalfHeight+rectHalfHeight2)*(rectHalfHeight+rectHalfHeight2))){
            //System.out.println("distance between the centerse is more than the distance between the circumcircle");
            break;
        }

        // check that distance between the centerse is less than the distance between the inscribed circle
        float rectMinHalfSide = Math.min(rectHalfWidth, rectHalfHeight);
        float rectMinHalfSide2 = Math.min(rectHalfWidth2, rectHalfHeight2);
        if(lengthHypotenuseSqure < ((rectMinHalfSide+rectMinHalfSide2)*(rectMinHalfSide+rectMinHalfSide2))){
            //System.out.println("distance between the centerse is less than the distance between the inscribed circle");
            result=true;
            break;
        }

        // check that the squares relate to angles
        if((deltax > (rectHalfWidth+rectHalfWidth2)*0.9) && (deltay > (rectHalfHeight+rectHalfHeight2)*0.9)){
            //System.out.println("squares relate to angles");
            result=true;
        }
    }while(false);

    return result;
  } 
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-07-22T06:12:50.187

这是一个快速的单线测试：

```
if (length(max(abs(center - rect_mid) - rect_halves, 0)) <= radius ) {
  // They intersect.
} 
```

这是轴对齐的情况，其中`rect_halves`是从矩形中间指向角的正向量。里面的表达式是一个从矩形到最近点`length()`的增量向量。`center`这适用于任何维度。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-08-21T21:16:55.803

*   首先检查矩形和与圆相切的正方形是否重叠（简单）。如果它们不重叠，它们就不会碰撞。
*   检查圆的中心是否在矩形内（简单）。如果它在里面，它们就会发生碰撞。
*   计算从矩形边到圆心的最小平方距离（有点困难）。如果它低于平方半径，那么它们会发生碰撞，否则不会。

它很有效，因为：

*   首先，它使用廉价算法检查最常见的场景，当确定它们没有冲突时，它就结束了。
*   然后它使用廉价算法检查下一个最常见的场景（不计算平方根，使用平方值），当确定它们发生冲突时，它就结束了。
*   然后它执行更昂贵的算法来检查与矩形边界的碰撞。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2020-01-13T09:29:44.627

为我工作（仅在矩形角度为 180 时工作）

```
function intersects(circle, rect) {
  let left = rect.x + rect.width > circle.x - circle.radius;
  let right = rect.x < circle.x + circle.radius;
  let top = rect.y < circle.y + circle.radius;
  let bottom = rect.y + rect.height > circle.y - circle.radius;
  return left && right && bottom && top;
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-08-22T17:45:45.240

有效，一周前才发现这一点，现在才开始测试它。

```
double theta = Math.atan2(cir.getX()-sqr.getX()*1.0,
                          cir.getY()-sqr.getY()*1.0); //radians of the angle
double dBox; //distance from box to edge of box in direction of the circle

if((theta >  Math.PI/4 && theta <  3*Math.PI / 4) ||
   (theta < -Math.PI/4 && theta > -3*Math.PI / 4)) {
    dBox = sqr.getS() / (2*Math.sin(theta));
} else {
    dBox = sqr.getS() / (2*Math.cos(theta));
}
boolean touching = (Math.abs(dBox) >=
                    Math.sqrt(Math.pow(sqr.getX()-cir.getX(), 2) +
                              Math.pow(sqr.getY()-cir.getY(), 2))); 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-03-13T16:33:55.763

对于那些必须使用 SQL 计算地理坐标中的圆/矩形碰撞的人，
这是我在[e.James 建议算法](https://stackoverflow.com/a/402010/2186777)的 oracle 11 中的实现。

在输入中，它需要圆坐标、以 km 为单位的圆半径和矩形的两个顶点坐标：

```
CREATE OR REPLACE FUNCTION "DETECT_CIRC_RECT_COLLISION"
(
    circleCenterLat     IN NUMBER,      -- circle Center Latitude
    circleCenterLon     IN NUMBER,      -- circle Center Longitude
    circleRadius        IN NUMBER,      -- circle Radius in KM
    rectSWLat           IN NUMBER,      -- rectangle South West Latitude
    rectSWLon           IN NUMBER,      -- rectangle South West Longitude
    rectNELat           IN NUMBER,      -- rectangle North Est Latitude
    rectNELon           IN NUMBER       -- rectangle North Est Longitude
)
RETURN NUMBER
AS
    -- converts km to degrees (use 69 if miles)
    kmToDegreeConst     NUMBER := 111.045;

    -- Remaining rectangle vertices 
    rectNWLat   NUMBER;
    rectNWLon   NUMBER;
    rectSELat   NUMBER;
    rectSELon   NUMBER;

    rectHeight  NUMBER;
    rectWIdth   NUMBER;

    circleDistanceLat   NUMBER;
    circleDistanceLon   NUMBER;
    cornerDistanceSQ    NUMBER;

BEGIN
    -- Initialization of remaining rectangle vertices  
    rectNWLat := rectNELat;
    rectNWLon := rectSWLon;
    rectSELat := rectSWLat;
    rectSELon := rectNELon;

    -- Rectangle sides length calculation
    rectHeight := calc_distance(rectSWLat, rectSWLon, rectNWLat, rectNWLon);
    rectWidth := calc_distance(rectSWLat, rectSWLon, rectSELat, rectSELon);

    circleDistanceLat := abs( (circleCenterLat * kmToDegreeConst) - ((rectSWLat * kmToDegreeConst) + (rectHeight/2)) );
    circleDistanceLon := abs( (circleCenterLon * kmToDegreeConst) - ((rectSWLon * kmToDegreeConst) + (rectWidth/2)) );

    IF circleDistanceLon > ((rectWidth/2) + circleRadius) THEN
        RETURN -1;   --  -1 => NO Collision ; 0 => Collision Detected
    END IF;

    IF circleDistanceLat > ((rectHeight/2) + circleRadius) THEN
        RETURN -1;   --  -1 => NO Collision ; 0 => Collision Detected
    END IF;

    IF circleDistanceLon <= (rectWidth/2) THEN
        RETURN 0;   --  -1 => NO Collision ; 0 => Collision Detected
    END IF;

    IF circleDistanceLat <= (rectHeight/2) THEN
        RETURN 0;   --  -1 => NO Collision ; 0 => Collision Detected
    END IF;

    cornerDistanceSQ := POWER(circleDistanceLon - (rectWidth/2), 2) + POWER(circleDistanceLat - (rectHeight/2), 2);

    IF cornerDistanceSQ <=  POWER(circleRadius, 2) THEN
        RETURN 0;  --  -1 => NO Collision ; 0 => Collision Detected
    ELSE
        RETURN -1;  --  -1 => NO Collision ; 0 => Collision Detected
    END IF;

    RETURN -1;  --  -1 => NO Collision ; 0 => Collision Detected
END; 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-11-22T15:12:20.653

```
def colision(rect, circle):
dx = rect.x - circle.x
dy = rect.y - circle.y
distance = (dy**2 + dx**2)**0.5
angle_to = (rect.angle + math.atan2(dx, dy)/3.1415*180.0) % 360
if((angle_to>135 and angle_to<225) or (angle_to>0 and angle_to<45) or (angle_to>315 and angle_to<360)):
    if distance <= circle.rad/2.+((rect.height/2.0)*(1.+0.5*abs(math.sin(angle_to*math.pi/180.)))):
        return True
else:
    if distance <= circle.rad/2.+((rect.width/2.0)*(1.+0.5*abs(math.cos(angle_to*math.pi/180.)))):
        return True
return False 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-08-02T11:07:22.470

我在制作这个游戏时开发了这个算法：[https ://mshwf.github.io/mates/](https://mshwf.github.io/mates/)

![](https://1.bp.blogspot.com/-vDA_XgcOC-4/XwOlZpSxFKI/AAAAAAAAQoI/DF-_4rQhMCAyijUsOp-plrz4xOG4UsK2QCLcBGAsYHQ/s1600/collision%2Balgo.jpg)

如果圆接触正方形，那么圆的中心线和正方形的中心线之间的距离应该等于`(diameter+side)/2`。因此，让我们有一个名为的变量`touching`来保存该距离。问题是：我应该考虑哪个中心线：水平还是垂直？考虑这个框架：

[![在此处输入图像描述](https://1.bp.blogspot.com/-kUQjhsDgT2o/XwOb5sln4TI/AAAAAAAAQms/S_K6EW0XRRE8j79h2PI_QN3gKXrs5E-kACK4BGAsYHg/s499/collision%2Balgo-2.jpg)](https://1.bp.blogspot.com/-kUQjhsDgT2o/XwOb5sln4TI/AAAAAAAAQms/S_K6EW0XRRE8j79h2PI_QN3gKXrs5E-kACK4BGAsYHg/s499/collision%2Balgo-2.jpg)

每条中心线给出不同的距离，只有一个是没有碰撞的正确指示，但是使用我们的人类直觉是理解自然算法如何工作的开始。

它们没有接触，这意味着两条中心线之间的距离应该大于`touching`，这意味着自然算法会选择水平中心线（垂直中心线表示有碰撞！）。通过注意多个圆，您可以知道：如果圆与正方形的垂直延伸相交，则我们选择垂直距离（水平中心线之间），如果圆与水平延伸相交，我们选择水平距离：

[![在此处输入图像描述](https://1.bp.blogspot.com/-3lnGv1k4zcA/XwObxg_TZvI/AAAAAAAAQmg/cIHUJU4-7O03fSW8q_7ZvL52L0RzVZTPwCK4BGAsYHg/s582/collision%2Balgo-2area.jpg)](https://1.bp.blogspot.com/-3lnGv1k4zcA/XwObxg_TZvI/AAAAAAAAQmg/cIHUJU4-7O03fSW8q_7ZvL52L0RzVZTPwCK4BGAsYHg/s582/collision%2Balgo-2area.jpg)

再比如4号圆：它与正方形的水平延伸相交，那么我们认为水平距离等于接触。

好的，困难的部分已经揭开，现在我们知道算法将如何工作，但是我们如何知道圆与哪个扩展相交？其实很简单：我们计算最右边`x`和最左边之间的距离`x`（圆和正方形），对于y轴也是如此，值较大的那个是扩展与相交的轴圆（如果大于`diameter+side`则圆在两个正方形扩展之外，如圆 #7）。代码如下所示：

```
right = Math.max(square.x+square.side, circle.x+circle.rad);
left = Math.min(square.x, circle.x-circle.rad);

bottom = Math.max(square.y+square.side, circle.y+circle.rad);
top = Math.min(square.y, circle.y-circle.rad);

if (right - left > down - top) {
 //compare with horizontal distance
}
else {
 //compare with vertical distance
}

/*These equations assume that the reference point of the square is at its top left corner, and the reference point of the circle is at its center*/ 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-08-20T16:35:22.443

1.  预先检查完全封装矩形的圆是否与圆碰撞。
2.  检查圆内的矩形角。
3.  对于每条边，看是否有与圆相交的线。将中心点 C 投影到直线 AB 上得到点 D。如果 CD 的长度小于半径，则发生碰撞。

```
 projectionScalar=dot(AC,AB)/(mag(AC)*mag(AB));
    if(projectionScalar>=0 && projectionScalar<=1) {
        D=A+AB*projectionScalar;
        CD=D-C;
        if(mag(CD)<circle.radius){
            // there was a collision
        }
    } 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2020-08-27T02:18:53.560

有一种非常简单的方法可以做到这一点，您必须在 x 和 y 中夹住一个点，但在正方形内部，而圆的中心位于您需要夹住其中一个垂直轴的两个正方形边界点之间坐标到平行轴，只要确保夹紧的坐标不超过正方形的限制。然后只需获取圆心与夹紧坐标之间的距离，并检查该距离是否小于圆的半径。

我是这样做的（前 4 个点是正方形坐标，其余的是圆点）：

```
bool DoesCircleImpactBox(float x, float y, float x1, float y1, float xc, float yc, float radius){
    float ClampedX=0;
    float ClampedY=0;

    if(xc>=x and xc<=x1){
    ClampedX=xc;
    }

    if(yc>=y and yc<=y1){
    ClampedY=yc;
    }

    radius = radius+1;

    if(xc<x) ClampedX=x;
    if(xc>x1) ClampedX=x1-1;
    if(yc<y) ClampedY=y;
    if(yc>y1) ClampedY=y1-1;

    float XDif=ClampedX-xc;
    XDif=XDif*XDif;
    float YDif=ClampedY-yc;
    YDif=YDif*YDif;

    if(XDif+YDif<=radius*radius) return true;

    return false;
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-11-06T11:57:15.393

我的方法：

1.  从 OBB / 矩形上/中的圆计算最近点（最近点将位于边缘/角或内部）
2.  计算从最近点到圆心的squared_distance（平方距离避免平方根）
3.  返回 squared_distance <= 圆半径平方

* * *

## 回答 #26

> 赞同：-2
> 
> 时间：2008-12-30T23:42:11.067

假设您有矩形的四个边缘，请检查从边缘到圆心的距离，如果它小于半径，则形状相交。

```
if sqrt((rectangleRight.x - circleCenter.x)^2 +
        (rectangleBottom.y - circleCenter.y)^2) < radius
// then they intersect

if sqrt((rectangleRight.x - circleCenter.x)^2 +
        (rectangleTop.y - circleCenter.y)^2) < radius
// then they intersect

if sqrt((rectangleLeft.x - circleCenter.x)^2 +
        (rectangleTop.y - circleCenter.y)^2) < radius
// then they intersect

if sqrt((rectangleLeft.x - circleCenter.x)^2 +
        (rectangleBottom.y - circleCenter.y)^2) < radius
// then they intersect 
```

# c++ - Qt 小部件的命名约定

> ID：401851
> 
> 赞同：15
> 
> 时间：2008-12-30T23:36:45.837
> 
> 标签：c++, qt, coding-style, widget

我正在与一群其他程序员一起开发一个使用 C++ 和 Qt 构建的开源项目。

现在，我们需要一个小部件（以及其他一般变量）的命名约定，以便在我们所有的代码中使用它作为标准，这样代码就具有更好的可读性，并且我们可以在程序员之间获得更好的协调。

有什么建议吗？

编辑：我不是在谈论命名新课程，

相反，我在谈论 Qt Widgets 的命名实例，假设我对用户名进行了文本编辑，我应该将其命名为 txtEdtUsrNm 吗？

在那种情况下，我应该如何选择派生？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-31T23:11:01.957

只要您按照这些思路思考，我就会从头到尾阅读这篇 QtQuarterly 文章。

[设计 Qt 风格的 C++ API](https://doc.qt.io/archives/qq/qq13-apis.html)

也就是说，我们要做的一件事是将实例的“使用”作为第一部分，将类的最后一个完整单词作为最后一部分。

所以，你的“用户名” QTextEdit 是

```
QTextEdit * userNameEdit = new QTextEdit(this); 
```

如果有歧义，例如 QListView 和 QTreeView，则选择最后一个明确的部分。

```
QListView * userListView; 
```

您可以根据自己的喜好找出缩写词（例如 QLabel 的“Lbl”），但一般来说，整个单词都有效且易于阅读。

另一方面，我们对此并不太严格，在没有类名的情况下命名实例变量的意图可能更重要，因为如果将来要更改类，则可以更改名称在没有好的重构工具的情况下，这是一种痛苦。

也许找出您最常使用的通用小部件，并为最通用的超类选择一个命名约定，然后让其他一切都过去。

遵守约定的示例列表：

*   layout = 所有以“Layout”结尾并继承 QLayout 的类
*   button = 所有以“Button”结尾并继承 QAbstractButton 的类

QAbstract *ClassName*类是思考该列表中应该包含什么内容的好地方。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-22T12:26:36.587

由于 Qt 对第三方开发人员开放，他们提供了一些关于编码风格和 API 设计原则的文档。

这些文件真的很有趣。这里有几个链接：

[Wiki : Qt 编码风格](http://qt-project.org/wiki/Qt_Coding_Style)

[维基：API设计原则](http://qt-project.org/wiki/API_Design_Principles)

还有这份来自 Jasmin Blanchette 的文档（PDF），值得一读：[API 设计小手册](http://qt-project.org/wiki/API_Design_Principles)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-31T05:13:21.147

我会使用与 Qt 相同的命名约定。让自己轻松一点。

它们的命名约定类似于 java。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-21T17:11:46.287

全名很快就会变得难以阅读和输入，因此我们通常使用缩写：

```
QLabel * fooLB;
QPushButton * fooPB;
QTextEdit * fooTE;
QSpinBox * fooSB; 
```

（你得到了漂移）。是的，有一些歧义，但它们通常是从上下文中解决的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-30T01:22:37.017

确切地说，问题是关于“命名 Qt Widgets 的实例”，但答案是关于命名保存对小部件实例的引用的变量。

Qt Widgets 派生自 QObject，它有一个带有 getter objectName() 的 name 属性。如果程序员不给这个属性一个值，Qt 是否会给它一个值？称其为“自动生成”或“默认”值。

# delphi - 任何用于数字签名文档的 delphi 组件？

> ID：401852
> 
> 赞同：4
> 
> 时间：2008-12-30T23:36:54.463
> 
> 标签：delphi, digital-signature

我正在寻找一个基于标准的良好组件，用于使用 x509 证书对文档进行数字签名。我看不到任何一个本机组件。只有 Activex 组件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T23:42:36.590

您可以为此使用 OpenSSL。

看看这里：[delphiopenssl](http://www.disi.unige.it/person/FerranteM/delphiopenssl/RSAMD5sig.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T00:48:17.953

自己做的问题是您没有第三方来独立验证证书的有效性。

这是一件值得信赖的事情，这就是 VeriSign 和 Comodo 这样的公司赚大钱的原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-31T10:08:25.560

查看[Eldos 的 Secure Black Box](http://www.eldos.com/sbb/ "Eldos 安全黑匣子")，我在我的应用程序中使用它来“签名”文件。

# design-patterns - 复制粘贴编码是否可以接受？

> ID：401856
> 
> 赞同：14
> 
> 时间：2008-12-30T23:40:50.960
> 
> 标签：design-patterns, copy-paste

人们普遍认为，复制和粘贴编程是一个坏主意，但是如果您有两个函数或代码块，它们确实需要在几个方面有所不同，从而使概括它们变得非常混乱，那么处理这种情况的最佳方法是**什么**？

如果代码基本相同，除了一些细微的变化，但那些细微的变化不是很容易通过添加参数、模板方法或类似的东西分解出来的东西怎么办？

更一般地说，你有没有遇到过这样的情况，你会承认一点点复制和粘贴编码是真正合理的。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-30T23:44:23.417

问这个关于你的函数的问题

“如果这个小要求发生变化，我是否必须同时更改两个功能才能满足它？”

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-30T23:44:19.410

当然有时也可以接受。这就是人们保留片段文件的原因。但是如果你经常剪切和粘贴代码，或者多于几行，你应该考虑把它变成一个子程序。为什么？因为你必须改变一些东西，这样，你只需要改变一次。

如果您有可用的宏，则中间情况是使用宏。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-31T00:59:24.500

我听说有人说将复制和粘贴一次（将代码重复限制为最多两个实例），因为除非您在三个或更多地方使用代码，否则抽象不会得到回报。() 我自己，我试着把它养成一个好习惯，一看到需要就进行重构。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-30T23:43:12.610

是的，正如你所说的那样；微小但难以考虑的变化。如果情况确实如此，请不要鞭打自己。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-31T00:55:59.937

## Re 是可以接受的：

是的。当细分市场略有不同并且您正在使用一次性系统（系统存在时间很短且不需要维护）时。否则，通常最好将共性提取出来。

## 看起来相似但不完全相同的细分：

如果差异在数据中，则通过提取函数并将数据中的差异用作参数进行重构（如果要传递的数据太多作为参数，请考虑将它们分组为对象或结构）。如果不同之处在于函数中的某个过程，则使用命令模式或抽象模板进行重构。如果即使使用这些设计模式仍然难以重构，那么您的函数可能会尝试自己处理许多职责。

例如，如果您的代码段在两个段中不同 - diff#1 和 diff#2。在 diff#1 中，你可以有 diff1A 或 diff1B，而对于 diff#2，你可以有 diff2A 和 diff2B。

如果 diff1A 和 diff2A 总是在一起，而 diff1B 和 diff2B 总是在一起，那么 diff1A 和 diff2A 可以包含在一个命令类或一个抽象模板实现中，而 diff1B 和 diff2B 则包含在另一个中。

但是，如果有几种组合（即 diff1A & diff2A、diff1A & diff2B、diff1B & diff2A、diff1B & diff2B），那么您可能需要重新考虑您的功能，因为它可能试图自己处理太多的责任。

## 重新 SQL 语句：

使用逻辑（if-else、loops）动态构建 SQL 会牺牲可读性。但是创建所有 SQL 变体将很难维护。所以半途而废，使用 SQL 段。将共性提取为 SQL 段，并使用这些 SQL 段作为常量创建所有 SQL 变体。

例如：

```
private static final String EMPLOYEE_COLUMNS = " id, fName, lName, status";

private static final String EMPLOYEE_TABLE = " employee";

private static final String EMPLOYEE_HAS_ACTIVE_STATUS = " employee";

private static final String GET_EMPLOYEE_BY_STATUS =
  " select" + EMPLOYEE_COLUMNS + " from" + EMPLOYEE_TABLE + " where" + EMPLOYEE_HAS_ACTIVE_STATUS;

private static final String GET_EMPLOYEE_BY_SOMETHING_ELSE =
  " select" + EMPLOYEE_COLUMNS + " from" + EMPLOYEE_TABLE + " where" + SOMETHING_ELSE; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-31T02:52:52.227

正如 Martin Fowler 所建议的，

做一次就好了

做两次，开始闻起来。

做三次，是时候[重构](http://www.refactoring.com/)了。

* * *

编辑：在回答评论时，建议的来源是唐罗伯茨：

*三击，你重构*。

Martin Fowler 在**重构**第 2 章的“三法则”一节（第 58 页）中描述了这一点。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-31T00:03:36.017

在我公司的代码库中，我们有一系列大约 10 条左右的大毛 SQL 语句，具有高度的通用性。所有的陈述都有一个共同的核心，或者至少有一个核心只有一两个词的区别。然后，您可以将 10 条语句分成 3 或 4 组，将共同的附属词添加到核心，同样每个附属词中可能有一两个不同的词。无论如何，将这 10 个 SQL 语句视为维恩图中的集合，并且有很大的重叠。

我们选择以避免任何重复的方式对这些语句进行编码。因此，有一个函数（技术上是 Java 方法）来构建语句。它需要一些参数来解释共同核心中的一两个词的差异。然后，它需要一个仿函数来构建附属物，当然，它也被参数化，用更多的参数来表示细微的差异，用更多的仿函数来表示更多的附属物，等等。

该代码的巧妙之处在于没有一条 SQL 是重复的。如果您需要修改 SQL 中的某个子句，只需在一处修改它，所有 10 个 SQL 语句都会相应地修改。

但是人是难以阅读的代码。确定在给定情况下将执行什么 SQL 的唯一方法是使用调试器单步执行并在 SQL 完全组装后打印出它。并且弄清楚生成子句的特定函数如何适应更大的图景是令人讨厌的。

自从写了这篇文章后，我经常想知道我们是否会更好地剪切和粘贴 SQL 查询 10 次。当然，如果我们这样做，对 SQL 的任何更改可能必须在 10 个地方发生，但注释可以帮助我们指出要更新的 10 个地方。

让 SQL 易于理解并且集中在一个地方的好处可能会超过剪切和粘贴 SQL 的缺点。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-30T23:44:16.163

# 绝对没有..

:)

[您可以发布有问题的代码，看看它比看起来更容易]

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-30T23:53:16.880

如果这是唯一的方法，那就去做吧。通常（取决于语言），您可以使用可选参数满足对同一函数的微小更改。

最近，我在 PHP 脚本中有一个 add() 函数和一个 edit() 函数。它们几乎都做了同样的事情，但 edit() 函数执行的是 UPDATE 查询而不是 INSERT 查询。我只是做了类似的事情

```
function add($title, $content, $edit = false)
{
    # ...
    $sql = edit ? "UPDATE ..." : "INSERT ...";
    mysql_unbuffered_query($sql);
} 
```

效果很好——但在其他时候需要复制/粘贴。不要使用一些奇怪的、复杂的路径来防止它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-02T12:07:09.413

1.  好的代码是可重用的代码。
2.  不要重新发明轮子。
3.  示例的存在是有原因的：帮助您学习，最好是更好地编码。

你应该复制和粘贴吗？谁在乎！重要的是*为什么*要复制和粘贴。我不想在这里对任何人进行哲学化，但让我们实际考虑一下：

是因为懒惰吗？“胡说八道，我以前做过这个……我只是更改了几个变量名……完成了。”

如果在您复制和粘贴之前它已经是很好的代码，那不是问题。否则，你会因为懒惰而延续糟糕的代码，这会在路上咬你的屁股。

是因为不懂吗？“该死......我不明白那个函数是如何工作的，但我想知道它是否可以在我的代码中工作......”它可能！这可能会立即节省您的时间，因为您有压力，因为您在上午 9 点有截止日期，并且您正盯着凌晨 4 点左右的时钟而红着眼睛

当你回到它时，你会理解这段代码吗？即使你评论它？不是真的 - 在数千行代码之后，如果您在编写代码时不理解代码在做什么，那么您将如何理解几周、几个月后的代码？尝试学习它，尽管有其他的诱惑。输入它，这将有助于将其提交到记忆中。你输入的每一行，问问自己那行在做什么，以及它如何促成该功能的整体目的。即使你没有从内而外地学习它，你至少有机会在以后再学习它时认出它。

那么 - 复制和粘贴代码？如果你意识到你正在做的事情的影响，那很好。除此以外？不要这样做。此外，请确保您拥有复制和粘贴的任何第 3 方代码的许可证副本。似乎是常识，但你会惊讶有多少人不这样做。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-30T23:49:14.390

我避免像瘟疫一样剪切和粘贴。它甚至比它的堂兄克隆和修改还要糟糕。如果遇到像您这样的情况，我随时准备使用宏处理器或其他脚本来生成不同的变体。根据我的经验，一个*单一的事实*是非常重要的。

不幸的是，由于换行符、表达式、语句和参数的令人讨厌的引用要求，C 宏处理器不能很好地用于此目的。我讨厌写作

```
#define RETPOS(E) do { if ((E) > 0) then return; } while(0) 
```

但引用是必要的。尽管有缺陷，我还是经常使用 C 预处理器，因为它不会向工具链添加其他项，因此不需要更改构建过程或 Makefile。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-30T23:46:03.307

我很高兴这个被标记为主观的，因为它确实是！这是一个过于模糊的示例，但我想如果您有足够的重复代码，您可以将这些部分抽象出来并保持不同的部分不同。不复制粘贴的重点是，您最终不会拥有难以维护和脆弱的代码。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-30T23:56:55.733

最好的方法（除了转换成通用函数或使用宏）是放注释。如果你注释代码从哪里复制到哪里，共性是什么，差异，以及这样做的原因......那么你会没事的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-30T23:57:59.477

如果您发现您的功能大部分相同，但在不同的场景中需要稍作调整，那么问题出在您的设计上。使用多态性和组合而不是标志或复制粘贴。

# c# - Web 服务不关心 Timeout 属性

> ID：401872
> 
> 赞同：1
> 
> 时间：2008-12-30T23:48:47.997
> 
> 标签：c#, performance, web-services, multithreading, timeout

我正在为[LyricWiki.org](http://lyricwiki.org/server.php?wsdl)使用自动创建的（使用 wsdl.exe 和基于 GUI 的“添加 Web 引用”命令）Web 服务。然而，由于我的互联网连接最近很糟糕，它需要很长时间*才能*完成，这让我很恼火。

我试图通过使用 .Timeout 属性使其在 2000 毫秒内超时，但它仍然挂起。我也尝试使用此[页面](https://stackoverflow.com/questions/299198/implement-c-generic-timeout)中的 CallWithTimeout 函数，但不行。也尝试过命令的异步版本，但我想在提到的时间后取消它。

```
var lw = new LyricWiki();
lw.Timeout = 1000;
LyricsResult result = lw.getSong(artistName, trackName);
// Hangs for a long time...
lyrics = result.lyrics;
lyricsURL = result.url; 
```

有什么建议么？过去一个小时一直在搜索 StackOverflow，但我还没有找到解决方案:(

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-31T21:11:22.260

我相信超时以秒为单位，而不是毫秒。至少这是它与手动创建的 WCF 东西一起工作的方式。

# labview - 如何在 Labview for/while 循环中手动增加/减少索引

> ID：401888
> 
> 赞同：2
> 
> 时间：2008-12-30T23:57:14.687
> 
> 标签：labview

这是我的基本用例：

Labview 收到来自外部硬件的触发后，开始收集模拟数据。如果模拟数据达到阈值，它会监视此数据并触发另一块硬件。对于每个试验，此阈值可以具有不同的值。但是，操作员可能希望能够重做试验（如果触发器由于噪声而提前发送或未按预期达到阈值）。

是否可以递增/递减索引，或者我是否需要使用可以根据需要递增/递减的移位寄存器（即，如果按下重做按钮则递减）？

谢谢

阿齐姆

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-31T03:47:50.277

如果不深入了解应用程序的本质并回答您的实际问题，不，您不能影响在 for 或 while 循环中从索引节点出来的值。每次循环迭代它都会自动递增一。

应用程序方面，您可能需要查看[State Machine](http://wiki.lavag.org/State_Machine)。听起来您可能可以将其用于您正在尝试做的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T02:09:31.770

如果您不想使用循环的自动递增索引，我认为移位寄存器是您最好的选择。这为您手动调整索引提供了最大的灵活性。

# c# - Merge and override .NET configuration files with C#

> ID：401896
> 
> 赞同：0
> 
> 时间：2008-12-31T00:00:59.687
> 
> 标签：c#, merge, web-config, app-config, xmldocument

I wrote this piece of code to merge two .NET configuration files: Add non existent nodes and override values on existing ones. I avoided to use the much faster reader/writer way because the app I'm using it for is not performance critical. What do you think of this?

```
using System;
using System.Xml;

namespace devcoach.FrameworkExtensions
{
    /// <summary>
    /// Extension methods for the type 
    /// <see cref="System.Xml.XmlDocument"/>.
    /// </summary>
    public static class XmlDocumentExtensions
    {
        /// <summary>
        /// Merges the specified instance.
        /// </summary>
        /// <param name="instance">The instance.</param>
        /// <param name="mergeDoc">The merge doc.</param>
        public static void Merge(
            this XmlDocument instance,
            XmlDocument mergeDoc)
        {
            var mergeRoot = mergeDoc.DocumentElement;
            var sourceRoot = instance.DocumentElement;
            if (sourceRoot == null) return;
            instance.Merge(sourceRoot, mergeRoot, false);
        }

        /// <summary>
        /// Merges the specified instance.
        /// </summary>
        /// <param name="instance">The instance.</param>
        /// <param name="mergeDoc">The merge doc.</param>
        /// <param name="isNetConfigFile">if set to <c>true</c> if documents 
        /// are .net config files.</param>
        public static void Merge(
            this XmlDocument instance,
            XmlDocument mergeDoc,
            bool isNetConfigFile)
        {
            var mergeRoot = mergeDoc.DocumentElement;
            var sourceRoot = instance.DocumentElement;
            if (sourceRoot == null) return;
            instance.Merge(sourceRoot, mergeRoot, true);
        }

        /// <summary>
        /// Merges the specified source doc.
        /// </summary>
        /// <param name="sourceDoc">The source doc.</param>
        /// <param name="sourceRoot">The source root.</param>
        /// <param name="mergeRoot">The merge root.</param>
        public static void Merge(
            this XmlDocument sourceDoc,
            XmlNode sourceRoot,
            XmlNode mergeRoot)
        {
            sourceDoc.Merge(
                sourceRoot,
                mergeRoot,
                false);
        }

        /// <summary>
        /// Merges the specified source doc.
        /// </summary>
        /// <param name="sourceDoc">The source doc.</param>
        /// <param name="sourceRoot">The source root.</param>
        /// <param name="mergeRoot">The merge root.</param>
        /// <param name="isNetConfigFile">if set to <c>true</c> if documents 
        /// are .net config files.</param>
        public static void Merge(
            this XmlDocument sourceDoc,
            XmlNode sourceRoot,
            XmlNode mergeRoot,
            bool isNetConfigFile)
        {
            #region Check parameters and if needed throw ArgumentNullException
            if (sourceDoc == null)
            {
                throw new ArgumentNullException("sourceDoc");
            }
            if (sourceRoot == null)
            {
                throw new ArgumentNullException("sourceRoot");
            }
            if (mergeRoot == null)
            {
                throw new ArgumentNullException("mergeRoot");
            }
            #endregion

            if (!string.IsNullOrEmpty(mergeRoot.InnerText))
            {
                sourceRoot.InnerText = mergeRoot.InnerText;
            }
            if (!string.IsNullOrEmpty(mergeRoot.Value))
            {
                sourceRoot.Value = mergeRoot.Value;
            }

            #region Copy attributes...
            var mergeRootAttributes = mergeRoot.Attributes;
            if (mergeRootAttributes != null)
            {
                var mergeRootAttributesCount = mergeRootAttributes.Count;

                for (var k = 0; k < mergeRootAttributesCount; k++)
                {
                    var mergeAttribute = mergeRootAttributes[k];
                    var mergeAttributeName = mergeAttribute.LocalName;

                    var sourceAttribute =
                        sourceRoot.Attributes[mergeAttributeName]
                        ?? sourceRoot.Attributes.Append(
                             sourceDoc.CreateAttribute(
                                 mergeAttribute.Prefix,
                                 mergeAttribute.LocalName,
                                 mergeAttribute.NamespaceURI));

                    sourceAttribute.Value = mergeAttribute.Value;
                }
            }
            #endregion

            // loop child nodes...
            var mergeRootNodesCount = mergeRoot.ChildNodes.Count;
            for (var i = 0; i < mergeRootNodesCount; i++)
            {
                XmlNode foundNode = null;
                var mergeNode = mergeRoot.ChildNodes[i];
                var mergeNodeName = mergeNode.LocalName;
                var sourceRootNodeCount = sourceRoot.ChildNodes.Count;

                #region Find node in source...
                for (var j = 0; j < sourceRootNodeCount; j++)
                {
                    var sourceNode = sourceRoot.ChildNodes[j];
                    var sourceNodeName = sourceNode.LocalName;

                    if ((isNetConfigFile &&
                            mergeNodeName == "section" ||
                            mergeNodeName == "sectionGroup"
                        ) ||
                        sourceNodeName != mergeNodeName) continue;

                    foundNode = sourceNode;
                    break;
                }
                #endregion

                #region create a new node...
                if (foundNode == null)
                {
                    foundNode =
                        sourceRoot.AppendChild(
                         sourceDoc.CreateNode(
                            mergeNode.NodeType,
                            mergeNode.Prefix,
                            mergeNode.LocalName,
                            mergeNode.NamespaceURI));
                }
                #endregion

                sourceDoc.Merge(foundNode, mergeNode);
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-17T11:04:53.880

您还可以查看[http://msbuildtasks.tigris.org/](http://msbuildtasks.tigris.org/)的 XmlMassUpdate 任务，它做同样的事情......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T00:23:51.467

If it works for you...

You should take a look at Linq to XML. It's much better than System.XML: Cleaner code, easier to write code, easier to understand code, less code. Lovely.

# mysql - mysql configuration error on windows vista

> ID：401897
> 
> 赞同：2
> 
> 时间：2008-12-31T00:02:09.933
> 
> 标签：mysql, configuration, windows-vista

I am trying to install and configure MySQL 5.0.41 on Windows Vista Home Premium and am getting the following error message:

Could not connect to the Service Control Manager. Error: 0

I am running the installer via an Administrator account, so I'm not sure why it would not have access to this. Any ideas?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-31T00:46:43.260

I figured it out. Even when running the configuration application as an Administrator, you must have the "User Access Control" setting in Vista disabled. (And restart the machine after disabling it.)

# .net - Is COM+ still recommended?

> ID：401904
> 
> 赞同：7
> 
> 时间：2008-12-31T00:05:59.910
> 
> 标签：.net, asp.net, com+

I used to write ASP.Net apps deploying business dataaccess layers in COM+ components several years ago. This was the standard in several corporate infrastructure here in my country. Is this still recommended? What is the alternative?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-31T01:08:56.167

COM+ 实际上只是 MTS ( [Microsoft Transaction Server](http://en.wikipedia.org/wiki/Microsoft_Transaction_Server) ) 重新标记并与 Windows 2000 和更高版本捆绑在一起（它是 NT4 上的一个可选附加功能）。如果您使用的是非托管代码，COM+ 仍然是事务中间层的首选选项。事实上，它通常用作[TPC-C](http://www.tpc.org/tpcc/results/tpcc_perf_results.asp)基准系统中的 TP 监视器，因为它比 .Net 或 Java 更有效，并且比 Tuxedo 或 Encina 便宜得多（这降低了 $/TPM）。

WCF（[Windows Communication Foundation](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx)）有自己的事务监视器，这是合理的，因为 COM+ 的体系结构与 COM 紧密耦合，很难将 .Net 运行时改造成。如果您在 .Net 中编写事务应用程序，WCF 会提供此功能，尽管[System.Transactions](http://msdn.microsoft.com/en-us/library/ms254973.aspx)库还为 ADO.Net 客户端提供分布式事务支持。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-31T02:53:55.797

这里有很多关于 WCF 的讨论，但老实说，我认为这不是您要寻找的。

在 ASP 的早期，人们很快了解到将所有代码放在标记页面中很难维护。结果，一些人开始使用 COM 组件实现 N 层设计。如果您的意图是简单地以典型的 N 层方式构建 DAL，那么没有理由认为简单的类库是不够的。

考虑构建一个类库，将其添加为您的 Web 项目的引用，当然还有[ADO.NET](http://msdn.microsoft.com/en-us/library/h43ks021(VS.71).aspx)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-31T00:10:42.600

WCF is the new recommended mechanism for interobject communication

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-31T00:09:09.857

I have just spent the past two days trying to make two of my old COM+ business objects work on a new Windows 2003 Server and I am certain I never want to work with COM+ ever again.

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-12-31T03:35:25.963

来自[http://msdn.microsoft.com/en-us/library/ms686988(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms686988(VS.85).aspx)：

> “COM+ 是 Microsoft® 组件对象模型和 Microsoft 事务服务器 (MTS) 演进的下一步。COM+ 处理您以前必须自己编程的许多资源管理任务，例如**线程分配**和**安全性**。它 **自动**使您的通过提供**线程池**、**对象池**和**即时对象激活**，应用程序**更具可扩展性**。COM+ 还通过提供事务支持来帮助保护数据的完整性，即使事务跨越网络上的多个数据库。

 ******虽然看起来像是一种遗留物，但我认为微软目前提供的任何单一时尚技术都无法替代 COM+。

# regex - 如何只捕获id的一部分？

> ID：401905
> 
> 赞同：1
> 
> 时间：2008-12-31T00:08:39.297
> 
> 标签：regex, xpath, selenium, fitnesse, selenium-fitnesse-bridge

我正在尝试捕获将随机生成的元素的 id。我可以像这样成功地捕获我的元素 id 的值......

```
| storeAttribute | //div[1]@id | variableName | 
```

现在我的变量将类似于...

```
divElement-12345 
```

我想删除 'divElement-' 以便我留下的变量是 '12345' 以便我以后可以使用它来选择与之关联的 'form-12345' 元素......像这样：

```
| type | //tr[@id='form-${variableName}']/td/form/fieldset/p[1]/input | Type this | 
```

我怎么能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T16:37:32.627

Selenium 中有两个选项，XPath 和 CSS 选择器。我读过 CSS Selector 更适合在 FireFox 和 IE 中进行测试。使用最新版本的 Selenium IDE（2009 年 3 月 5 日），我成功地使用了评估 Javascript 表达式的 storeEval，让您可以访问 javascript 字符串函数。

XPath：

```
storeAttribute | //div[1]@id                                            | divID
storeEval      | '${divID}'.replace("divElement-", "")                  | number
type           | //tr[@id='form-${number}']/td/form/fieldset/p[1]/input | Type this 
```

CSS 选择器：

```
storeAttribute | css=div[1]@id                                                     | divID
storeEval      | '${divID}'.replace("divElement-", "")                             | number
type           | css=tr[id='form-${number}'] > td > form > fieldset > p[1] > input | Type this 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-11T12:17:37.353

XPATH 中有许多功能可以解决您的问题。假设“divElement-”是一个不会改变的常量并且您使用的是 XPath 2.0，我建议：

substring-after(div[1]/@id/text(),"divElement-")

# php - PHP：__toString() 和 json_encode() 不能很好地配合使用

> ID：401908
> 
> 赞同：15
> 
> 时间：2008-12-31T00:09:30.387
> 
> 标签：php, json, serialization

我遇到了一个奇怪的问题，我不知道如何解决它。我有几个类都是 JSON 对象的 PHP 实现。这是问题的说明

```
class A
{
    protected $a;

    public function __construct()
    {
        $this->a = array( new B, new B );
    }

    public function __toString()
    {
        return json_encode( $this->a );
    }
}

class B
{
    protected $b = array( 'foo' => 'bar' );

    public function __toString()
    {
        return json_encode( $this->b );
    }
}

$a = new A();

echo $a; 
```

这个的输出是

```
[{},{}] 
```

当*所需*的输出是

```
[{"foo":"bar"},{"foo":"bar"}] 
```

问题是我依靠 __toString() 钩子为我做我的工作。但它不能，因为 json_encode() 使用的序列化不会调用 __toString()。当它遇到一个嵌套对象时，它只是简单地序列化公共属性。

那么，问题就变成了：有没有一种方法可以开发 JSON 类的托管接口，既可以让我使用 setter 和 getter 来获取属性，又可以让我获得我想要的 JSON 序列化行为？

如果不清楚，这里有一个不起作用的实现示例*，*因为 __set() 挂钩仅在初始分配时调用

```
class a
{
    public function __set( $prop, $value )
    {
        echo __METHOD__, PHP_EOL;
        $this->$prop = $value;
    }

    public function __toString()
    {
        return json_encode( $this );
    }
}

$a = new a;
$a->foo = 'bar';
$a->foo = 'baz';

echo $a; 
```

我想我也可以做这样的事情

```
class a
{
    public $foo;

    public function setFoo( $value )
    {
        $this->foo = $value;
    }

    public function __toString()
    {
        return json_encode( $this );
    }
}

$a = new a;
$a->setFoo( 'bar' );

echo $a; 
```

但是，我将不得不依靠其他开发人员的勤奋来使用设置器——我不能通过这个解决方案以编程方式强制遵守。

**---> 编辑 <---**

现在测试一下 Rob Elsner 的反应

```
<?php

class a implements IteratorAggregate 
{
    public $foo = 'bar';
    protected $bar = 'baz';

    public function getIterator()
    {
        echo __METHOD__;
    }
}

echo json_encode( new a ); 
```

执行此操作时，您可以看到从未调用过 getIterator() 方法。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2013-04-24T22:23:25.237

一个迟到的答案，但可能对其他有同样问题的人有用。

在*PHP < 5.4.0* **`json_encode`**中不调用对象的任何方法。这对 getIterator、__serialize 等有效...

然而，在 PHP > v5.4.0 中，引入了一个新接口，称为[**JsonSerializable**](http://php.net/manual/en/class.jsonserializable.php)。

它基本上控制在该对象**`json_encode`**上调用时该对象的行为。

* * *

**示例**：

```
class A implements JsonSerializable
{
    protected $a = array();

    public function __construct()
    {
        $this->a = array( new B, new B );
    }

    public function jsonSerialize()
    {
        return $this->a;
    }
}

class B implements JsonSerializable
{
    protected $b = array( 'foo' => 'bar' );

    public function jsonSerialize()
    {
        return $this->b;
    }
}

$foo = new A();

$json = json_encode($foo);

var_dump($json); 
```

* * *

**输出：**

> 字符串(29) "[{"foo":"bar"},{"foo":"bar"}]"

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T01:12:54.503

你的答案不是在[json_encode 的 PHP 文档中](http://us2.php.net/manual/en/function.json-encode.php#84997)吗？

> 对于遇到未添加私有属性问题的任何人，您可以简单地使用 getIterator() 方法实现 IteratorAggregate 接口。将要包含在输出中的属性添加到 getIterator() 方法中的数组中并返回。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-10-24T04:25:18.600

在 PHP > v5.4.0 中，您可以实现调用的接口[`JsonSerializable`](http://php.net/manual/en/class.jsonserializable.php)，如[Tivie](https://stackoverflow.com/users/295342/tivie)[的答案](https://stackoverflow.com/a/16203263/193617)中所述。

对于我们这些使用 PHP < 5.4.0 的人，您可以使用[`get_object_vars()`](http://php.net/manual/en/function.get-object-vars.php)从对象本身内部使用的解决方案，然后将它们提供给[`json_encode()`](http://php.net/manual/en/function.json-encode.php). 这就是我在以下示例中使用该`__toString()`方法所做的，因此当我将对象转换为字符串时，我会得到 JSON 编码的表示。

还包括[`IteratorAggregate`](http://php.net/manual/en/class.iteratoraggregate.php)接口的实现及其[`getIterator()`](http://php.net/manual/en/iteratoraggregate.getiterator.php)方法，以便我们可以像数组一样遍历对象属性。

```
<?php
class TestObject implements IteratorAggregate {

  public $public = "foo";
  protected $protected = "bar";
  private $private = 1;
  private $privateList = array("foo", "bar", "baz" => TRUE);

  /**
   * Retrieve the object as a JSON serialized string
   *
   * @return string
   */
  public function __toString() {
    $properties = $this->getAllProperties();

    $json = json_encode(
      $properties,
      JSON_FORCE_OBJECT | JSON_HEX_TAG | JSON_HEX_AMP | JSON_HEX_APOS | JSON_HEX_QUOT
    );

    return $json;
  }

  /**
   * Retrieve an external iterator
   *
   * @link http://php.net/manual/en/iteratoraggregate.getiterator.php
   * @return \Traversable
   *  An instance of an object implementing \Traversable
   */
  public function getIterator() {
    $properties = $this->getAllProperties();
    $iterator = new \ArrayIterator($properties);

    return $iterator;
  }

  /**
   * Get all the properties of the object
   *
   * @return array
   */
  private function getAllProperties() {
    $all_properties = get_object_vars($this);

    $properties = array();
    while (list ($full_name, $value) = each($all_properties)) {
      $full_name_components = explode("\0", $full_name);
      $property_name = array_pop($full_name_components);
      if ($property_name && isset($value)) $properties[$property_name] = $value;
    }

    return $properties;
  }

}

$o = new TestObject();

print "JSON STRING". PHP_EOL;
print "------" . PHP_EOL;
print strval($o) . PHP_EOL;
print PHP_EOL;

print "ITERATE PROPERTIES" . PHP_EOL;
print "-------" . PHP_EOL;
foreach ($o as $key => $val) print "$key -> $val" . PHP_EOL;
print PHP_EOL;

?> 
```

此代码产生以下输出：

```
JSON STRING
------
{"public":"foo","protected":"bar","private":1,"privateList":{"0":"foo","1":"bar","baz":true}}

ITERATE PROPERTIES
-------
public -> foo
protected -> bar
private -> 1
privateList -> Array 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-31T01:39:04.263

即使您的受保护变量是公共的而不是受保护的，您也不会获得所需的输入，因为这将像这样输出整个对象：

```
[{"b":{"foo":"bar"}},{"b":{"foo":"bar"}}] 
```

代替：

```
[{"foo":"bar"},{"foo":"bar"}] 
```

它很可能会破坏您的目的，但我更倾向于使用默认 getter 转换为原始类中的 json 并直接调用值

```
class B
{
    protected $b = array( 'foo' => 'bar' );

    public function __get($name)
    {
        return json_encode( $this->$name );
    }
} 
```

然后你可以随心所欲地使用它们，甚至像你的 A 类那样将值嵌套在一个额外的数组中，但是使用 json_decode.. 它仍然感觉有点脏，但有效。

```
class A
{
    protected $a;

    public function __construct()
    {
        $b1 = new B;
        $b2 = new B;
        $this->a = array( json_decode($b1->b), json_decode($b2->b) );
    }

    public function __toString()
    {
        return json_encode( $this->a );
    }
} 
```

在[文档](http://us2.php.net/manual/en/function.json-encode.php)中对这个问题有一些回应（即使我不喜欢其中的大多数，序列化+剥离属性让我感觉很脏）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T07:28:44.043

没错，B 类的 __toString() 没有被调用，因为没有理由这样做。所以要调用它，你可以使用演员表

```
class A
{
    protected $a;

    public function __construct()
    {
        $this->a = array( (string)new B, (string)new B );
    }

    public function __toString()
    {
        return json_encode( $this->a );
    }
} 
```

注意：新 B 之前的 (string) cast ... 这将调用 B 类的 _toString() 方法，但它不会得到你想要的，因为你会遇到经典的“双重编码”问题，因为数组是在B类的_toString()方法中编码的，在A类的_toString()方法中会*再次*编码。

所以可以选择在转换后对结果进行解码，即：

```
 $this->a = array( json_decode((string)new B), json_decode((string)new B) ); 
```

或者您将需要通过在 B 类中创建一个返回直接数组的 toArray() 方法来获取数组。这将在上面的行中添加一些代码，因为你不能直接使用 PHP 构造函数（你不能做一个 new B()->toArray(); ）所以你可以有类似的东西：

```
$b1 = new B;
$b2 = new B;
$this->a = array( $b1->toArray(), $b2->toArray() ); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-02-17T16:56:52.927

## 为 json_encode 准备数据的函数，如果可用，该函数使用 __toString()

如果您无法控制类/对象，这很有用。

```
/**
 * Prepares data for encoding by replacing any object in the input with output of its get_data()
 * or __toString() method if available.
 *
 * @param mixed $data .
 * @return mixed
 */
function prepare_for_encoding($data) {
  if (is_array($data)) {
    foreach ($data as $i => $value) {
      $data[$i] = prepare_for_encoding($data[$i]);
    }
  } elseif (is_object($data)) {
    if (method_exists($data, 'get_data')) {
      $data = $data->get_data();
    } elseif (method_exists($data, '__toString')) {
      $data = $data->__toString();
      // Sometimes toString() may return encoded json data - see if it is decodeable so it can
      // be encoded together with the entire structure.
      $decoded = json_decode($data, true);

      if ($decoded !== null) {
        $data = $decoded;
      }
    }
  }

  return $data;
} 
```

用法：

```
class Foo {
  public $a = 1;
  private $b= 2;

  public __toString() {
    return json_encode(array(
      'a' => $this->a,
      'b' => $this->b,
  }
}

$foo = new Foo();

json_encode(prepare_for_encoding($foo));

json_encode(prepare_for_encoding(array('foo' => $foo)); 
```

# .net - 跟踪和调试语句

> ID：401910
> 
> 赞同：8
> 
> 时间：2008-12-31T00:11:52.613
> 
> 标签：.net, debugging, trace

我对如何使用 .NET Trace 和 Debug 类有点困惑。

您为什么要费心使用 Trace 而不是 Debug？

```
Trace.TraceError()
Trace.TraceInformation()
Trace.Assert()

Debug.WriteLine()
Debug.Assert() 
```

另外，我知道当您处于发布配置模式时，调试语句会被忽略，但是如果跟踪语句一直适用，这对性能有何影响？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-31T10:44:14.430

在最简单的层面上，它们有不同的编译开关——即`Debug.WriteLine`只有当你有编译符号时才会切换 etc `DEBUG`（对于发布版本来说并不常见），`Trace.WriteLine`即使在发布版本中通常也会包含 where-as。

该`Trace`路由具有可定制的跟踪侦听器，可以通过配置进行探测；`Debug`通常作为侦听器进入调试器。当然，还有 3rd-party 跟踪系统可以提供更大的灵活性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T00:24:10.983

您可以使用编译器开关独立打开和关闭，如果您转到项目属性的构建页面，那里有一些复选框。

对我来说，经验法则是我使用 debug 来获取实际的调试信息，即此时变量 x 的值是……等等，Trace 用于跟踪通过我的应用程序的控制流（更像垃圾邮件）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-31T00:27:18.307

正如您所说，跟踪调用仅在您处于发布模式时执行。在 Release 模式下编译有一些您可能希望在最终应用程序中获得的性能优势，并且您可能还有其他原因想要打开 Release 模式。但是，有时您可能希望将信息记录到跟踪控制台，可以使用[SysInternal 的 DbgView](http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx)等应用程序查看。这些通常是您不一定要发送到日志输出的消息，或者即使用户已关闭日志记录，您也始终希望这些消息可用于调试目的。

您当然不希望向 Trace 控制台发送大量信息，因为它确实会造成性能损失，但一些关键信息可能是合适的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-31T11:05:19.487

我倾向于在发布环境中使用 Trace（带有关联的 TraceSwitch）来记录工作——对 app.config 的快速调整可以提供不同级别的日志记录，而无需重新编译（这可能会使问题消失） ) 或需要附加调试器。特别适用于无论出于何种原因仅发生在客户机器上的问题——我已经使用它成功地转储了从 FTP 类中注销（回到旧的 Framework 1.1 天），以帮助诊断两家公司之间的网络传输问题

# unicode - Unicode 应用程序的最佳默认字体和用户选择字体

> ID：401911
> 
> 赞同：1
> 
> 时间：2008-12-31T00:12:25.313
> 
> 标签：unicode, fonts

对于用户可以选择他想要使用的字体的 Unicode 应用程序，最好的默认字体是什么？

我注意到的问题是，并非所有 Windows 机器都有所有 Unicode 字体。并且每个 Unicode 字体都不包含所有的 Unicode 字符。

那么，在用作默认字体的可用性和完整性之间取得最佳折衷的字体是什么？如果字体难看，请去掉标记。

那么，在确定了默认字体之后，应该在下拉列表中包含哪些字体供用户选择呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-31T11:08:32.867

任何 Windows 应用程序（无论是否为 Unicode）的最佳默认字体是用户在系统控制小程序中为**所有**应用程序选择的字体。没有什么比必须在每个应用程序中配置字体和颜色更烦人的了，只是为了使它们与系统默认值匹配并且不会在视觉上与其他应用程序发生冲突。

此外：我认为可以合理地假设系统默认字体支持所支持语言的所有字形（请注意，各种 Windows 版本确实安装了可用语言支持的不同子集，并且为了测试，您可能需要手动添加支持更多语言）。如果用户更改了默认值，那么他们很可能选择了另一种能够显示所有字形的字体。

至于你的第二个问题，为什么不完全把决定权留给用户呢？有什么理由不包括所有？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T00:51:47.510

我认为 Unicode 和字体是正交的。一个是数据，另一个是演示文稿。

我不知道如何回应，因为我不知道，例如，无衬线字体的想法是否适用于日本用户的汉字或片假名字符。通常用于西方语言的字体是否对所有语言都相同？

# delphi - 使用 Delphi 查找系统字体

> ID：401915
> 
> 赞同：6
> 
> 时间：2008-12-31T00:18:18.093
> 
> 标签：delphi, unicode, fonts, delphi-2009

查找用户可用的所有系统字体以便它们可以显示在下拉选择框中的最佳方法是什么？

我还想区分 Unicode 和非 Unicode 字体。

我正在使用完全启用 Unicode 的 Delphi 2009，并且想要一个 Delphi 解决方案。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-05T04:23:35.043

该`Screen.Fonts`属性是通过[`EnumFontFamiliesEx`API 函数](http://msdn.microsoft.com/en-us/library/ms534005.aspx)填充的。在*Forms.pas*中查看调用该函数的示例。

它调用的回调函数将接收一条[`TNewTextMetricEx`](http://msdn.microsoft.com/en-us/library/ms533968.aspx)记录，该记录的成员之一是[`TFontSignature`](http://msdn.microsoft.com/en-us/library/ms776424.aspx). 该`fsUsb`字段指示字体声称支持哪些 Unicode 子范围。

该系统实际上没有“Unicode 字体”。即使是名称中包含*Unicode*字样的字体也没有*所有*Unicode 字符的字形。您可以区分位图、打印机和 TrueType 字体，但除此之外，您能做的最好的事情就是弄清楚您正在考虑的字体是否支持您想要的字符。如果字体不是您认为的“Unicode 字体”，但它支持您需要的所有字符，那么它有什么区别呢？要获取此信息，您可能对[`GetFontUnicodeRanges`](http://msdn.microsoft.com/en-us/library/ms533944.aspx).

用于根据哪些字体包含哪些字符来显示具有不同字体的文本的 Microsoft 技术是[Uniscribe](http://msdn.microsoft.com/en-us/library/ms776488.aspx)，尤其是[*字体回退*](http://msdn.microsoft.com/en-us/library/ms776534.aspx)。我不知道任何 Delphi 对 Uniscribe 的支持。有一次我开始为它写一组导入单元，但我的兴趣变幻无常，在完成之前我就转向了别的东西。[Michael Kaplan 的博客](http://blogs.msdn.com/michkap/)有时会谈到 Uniscribe，所以这是另一个值得关注的地方。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-31T00:51:12.287

我可以回答你一半的问题，你可以从全局 Screen 对象中获取当前环境可以访问的字体列表作为字符串列表

IE

```
Listbox1.Items.AddStrings(Screen.Fonts); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-31T14:25:38.413

您可以查看 forms.pas 源代码，了解 Codegear 如何通过枚举 Windows 字体来填充 Screen.Fonts。返回的 LOGFONT 结构有一个字符集成员，但这不提供简单的“Unicode”确定。

据我所知，Windows 无法明确告诉您字体是否为“Unicode”。此外，如果您尝试以“非 Unicode”字体显示 Unicode 文本，Windows 可能会替换为不同的字体，因此很难说字体是否会显示 Unicode。例如，我有一个古老的 Arial Black 字体文件，其中不包含 Unicode 字形，但如果我使用它在 D2009 备忘录中显示日文文本，日文将在 Arial 中正确显示，其余的在 Arial Black 中显示。在其他示例中，可能会出现通常的空方格。

# language-agnostic - 硬编码文字是否可以接受？

> ID：401919
> 
> 赞同：17
> 
> 时间：2008-12-31T00:24:00.327
> 
> 标签：language-agnostic, hard-coding

我目前正在处理的代码库中充斥着硬编码值。

我将所有硬编码值视为代码异味，并尝试在可能的情况下消除它们……但是有些情况我不确定。

以下是我能想到的两个示例，这让我想知道最佳实践是什么：

```
1\. MyTextBox.Text = someCondition ? "Yes" : "No"
2\. double myPercentage = myValue / 100; 
```

在第一种情况下，最好的办法是创建一个允许我执行 MyHelper.Yes 和 MyHelper.No 或者在配置文件中执行类似操作的类（尽管它不太可能改变，谁知道是否有可能曾经是它的使用区分大小写的情况）。

在第二种情况下，除非数学定律发生变化，否则通过除以 100 找到百分比不太可能改变……但我仍然想知道是否有更好的方法。

谁能建议一种适当的方法来处理这种硬编码？任何人都可以想到硬编码可以接受的任何地方吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-31T00:30:13.560

> *任何人都可以想到硬编码可以接受的任何地方吗？*

*   小应用
*   单人项目
*   扔掉
*   短期生活项目

简而言之，任何其他人不会维护的东西。

[*哎呀，我刚刚意识到过去作为维护者编码器对我的伤害有多大 :)*]

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-31T01:15:33.687

真正的问题不在于硬编码，而在于重复。如果您接受[“实用程序员”](https://rads.stackoverflow.com/amzn/click/com/020161622X "务实的程序员")中的优秀建议，那就不要重复自己（DRY）。

采用 DRY 的原则，任何时候都可以硬编码。但是，一旦您再次使用该特定值，请重构，以便该值仅硬编码一次。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-12-31T13:46:52.470

当然，硬编码有时是可以接受的。遵循教条很少像使用大脑那样有用。

（举个例子，回到 goto 之战也许很有趣。你知道有多少程序员会发誓 goto 是邪恶的？那么为什么史蒂夫·麦康奈尔（Steve McConnell）要花十几页来有条不紊地讨论Code Complete 中的主题？）

当然，有很多来之不易的经验告诉我们，小的一次性应用程序经常会变异成生产代码，但这不是狂热的理由。敏捷专家告诉我们，我们应该[做最简单的事情，](http://c2.com/xp/DoTheSimplestThingThatCouldPossiblyWork.html)在需要时进行重构。

这并不是说“最简单的东西”不应该是可读的代码。这可能是完全合理的，即使是在一个一次性的尖峰中写：

```
const MAX_CACHE_RECORDS = 50
foo = GetNewCache(MAX_CACHE_RECORDS) 
```

这与以下事实无关，即在三个迭代时间内，有人可能会要求缓存记录的数量是可配置的，而您最终可能会重构常量。

请记住，如果您走极端，例如

```
const ONE_HUNDRED = 100
const ONE_HUNDRED_AND_ONE = 101 
```

我们都会来 The Daily WTF 嘲笑你。:-)

思考！就这样。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-31T01:01:22.997

这从来都不是好事，你只是证明了......

```
double myPercentage = myValue / 100; 
```

这不是百分比。你想写的是：

```
double myPercentage = (myValue / 100) * 100; 
```

或更正确地说：

```
double myPercentage = (myValue / myMaxValue) * 100; 
```

但是这个硬编码的 100 让你的想法变得混乱了......所以请使用 Colen 建议的 getPercentage 方法:)

```
double getpercentage(double myValue, double maxValue)
{
   return (myValue / maxValue) * 100;
} 
```

同样正如 ctacke 建议的那样，在第一种情况下，如果您需要本地化这些文字，您将陷入痛苦的世界。添加更多变量和/或函数永远不会太麻烦

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-31T00:28:44.030

如果您需要本地化，第一种情况会杀死您。将其移动到应用程序范围内的某个静态或常量至少会使本地化变得更容易一些。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-31T00:37:14.387

**案例 1：**什么时候应该对东西进行硬编码：当你没有理由认为它会改变时。也就是说，你**永远不**应该在线硬编码东西。花时间制作静态变量或全局变量或您的语言为您提供的任何内容。在有问题的类中执行它们，如果您注意到代码的两个类或区域出于相同的原因共享相同的值（这意味着这不仅仅是巧合），请将它们指向同一个地方。

**案例 2：**对于案例 2，您是正确的：“百分比”定律不会改变（这里是合理的），因此您可以内联硬编码。

**案例 3：**第三种情况是您认为事情可能会发生变化，但您不想/没有时间去加载 ResourceBundles 或 XML 或其他任何东西。在这种情况下，你可以使用任何你可以使用的集中机制——讨厌的 Singleton 类是一个很好的机制——并继续使用它，直到你真正需要处理这个问题。

但是，第三种情况很棘手：如果不真正执行应用程序国际化是非常困难的......所以你会想要硬编码东西，只是希望当 i18n 人来敲门时，你的代码不是最糟糕的 -品尝代码:)

**编辑：**让我提一下，我刚刚完成了一个重构项目，在该项目中，之前的开发人员已将 MySql 连接字符串放置在代码 (PHP) 中的 100 多个位置。有时它们是大写的，有时它们是小写的，等等，所以它们很难搜索和替换（尽管 Netbeans 和 PDT 确实有很大帮助）。他/她这样做是有原因的（一个名为 POG 的项目基本上是在强迫这种愚蠢行为），但没有什么比在一百万个地方重复同样的**事情**更不像好的代码了。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-31T00:27:50.290

第二个示例的更好方法是定义一个内联函数：

```
double getpercentage(double myValue)
{
   return(myValue / 100);
} 
```

...

```
double myPercentage = getpercentage(myValue); 
```

这样一来，你在做什么就更明显了。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-13T02:49:22.943

硬编码文字应该出现在测试值的单元测试中，除非在单个测试类中重复使用太多值以至于局部常量很有用。

单元测试是对预期值的描述，没有任何抽象或重定向。想象一下你自己正在阅读测试——你想要将信息直接呈现在你面前。

我唯一一次使用常量作为测试值是当许多测试重复一个值（本身有点可疑）并且该值可能会发生变化时。

我确实使用常量来比较测试文件的名称等内容。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-31T00:29:04.483

我不认为你的第二个真的是硬编码的例子。这就像有一个 Halve() 方法，它接受一个用于除以的值；没有意义。

除此之外，示例 1，如果您想更改应用程序的语言，您不需要更改类，所以它绝对应该在配置中。

应该避免硬编码，就像德古拉避开太阳一样。它最终会回来咬你的屁股。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-31T16:46:52.793

“硬编码”是错误的担心。重点不在于特殊值是在代码中还是在配置文件中，重点是：

*   如果价值可以改变，那需要做多少工作，找到它有多难？将它放在一个地方并在其他地方引用那个地方并没有太多工作，因此是一种安全的方法。
*   维护程序员一定会理解为什么价值是这样的吗？如果有任何疑问，请使用解释含义的命名常量。

这两个目标都可以在不需要任何配置文件的情况下实现；事实上，如果可能的话，我会避免这些。“将东西放入配置文件意味着更容易更改”是一个神话，除非

*   你真的想支持客户自己改变价值观
*   任何可能放入配置文件的值都不会导致错误（缓冲区溢出，有人吗？）
*   你的构建和部署过程很糟糕

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-31T01:08:40.737

条件的文本应该在资源文件中；这就是它的用途。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-31T04:40:40.620

不。

今天是一个简单的一次性应用程序，明天将推动您的整个企业发展。始终使用最佳实践，否则您会后悔的。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-02-10T04:44:17.980

不正常（硬编码文字是否可以接受）

另一种看待这个问题的方法是，使用良好的命名约定来代替硬编码文字的常量如何在程序中提供额外的文档。

即使该号码只使用一次，它仍然难以识别，甚至可能难以找到以备将来更改。

恕我直言，让程序更易于阅读应该是经验丰富的软件专业人员的第二天性。原始数字很少进行有意义的交流。

使用命名良好的常量所花费的额外时间将使代码可读性（易于记忆）并且对未来的重新挖掘（代码重用）有用。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-31T00:28:47.853

我倾向于根据项目的范围和规模来看待它。

我是一个独立开发者的一些简单项目？当然，我对很多东西都进行了硬编码。我编写的工具只有我会使用？当然，如果它完成了工作。

但是，在处理更大的团队项目时呢？我同意，他们是可疑的，通常是懒惰的产物。标记它们以供审查，看看您是否可以发现可以将它们抽象出来的模式。

在您的示例中，文本框应该是可本地化的，那么为什么不是处理它的类呢？

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-31T00:32:46.113

请记住，您将忘记任何非显而易见的硬编码值的含义。

因此，请务必在每个之后添加简短评论以提醒您。

一个德尔福的例子：

长度：= 长度 * 0.3048；{ 0.3048 将英尺转换为米}

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-31T00:40:17.533

只要您不进行重构、单元测试、同行代码审查，就可以。而且，您不想要回头客。谁在乎？

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-31T16:16:02.120

代码总是在进化。当您最初编写东西时，硬编码是最简单的方法。稍后，当需要更改该值时，可以对其进行改进。在某些情况下，需求永远不会到来。

需求可以以多种形式出现：

1.  该值在许多地方使用，需要由程序员更改。在这种情况下，显然需要一个常数。

2.  用户需要能够更改该值。

我认为没有必要避免硬编码。当有明确的需求时，我确实看到了改变事物的必要性。

完全不同的问题是代码当然需要可读，这意味着可能需要对硬编码值进行注释。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-31T00:32:42.727

对于第一个值，它真的取决于。如果您预计您的应用程序不会被广泛采用，那么国际化将永远不会成为问题，我认为这基本没问题。但是，如果您正在编写某种开源软件或具有更多受众的东西，请考虑有一天可能需要翻译它的事实。在这种情况下，您最好使用字符串资源。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-12-31T02:16:42.113

我曾经有一位老板拒绝不硬编码某些东西，因为在他看来，这让他可以完全控制软件*以及*与软件相关的项目。问题是，当运行软件的硬件死机时，服务器被重命名......这意味着他必须找到他的代码。那花了一段时间。我只是找到了一个十六进制编辑器并绕过它而不是等待。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-31T15:09:40.540

硬编码应该永远被禁止。尽管在您非常简单的示例中，我认为在任何类型的项目中使用它们都没有任何问题。

在我看来，硬编码是当您相信变量/值/定义等永远不会改变并根据该信念创建所有代码时。

这种硬编码的例子是每个人都应该避免的《24 小时内自学 C》一书。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-12-31T16:33:06.267

我通常为字符串和数字添加一组辅助方法。

例如，当我有诸如 'yes' 和 'no' 之类的字符串时，我有一个名为 __ 的函数，所以我调用 __('yes'); 它在项目中通过仅返回第一个参数开始，但是当我需要做更复杂的事情（例如国际化）时，它已经存在并且参数可以用作键。

另一个例子是网上商店的增值税（英国税的形式），最近它从 17.5% 变为 15%。任何通过以下方式对增值税进行硬编码的人：

```
$vat = $price * 0.175; 
```

然后必须遍历所有引用并将其更改为 0.15，而不是超级有用的方法是为 VAT 设置一个函数或变量。

在我看来，任何*可以*改变的东西都应该以可变的方式来写。如果我发现自己在同一天做同样的事情超过 5 次，那么它就变成了一个函数或一个配置变量。

# sql-server - Format SQL in SQL Server Management Studio

> ID：401928
> 
> 赞同：309
> 
> 时间：2008-12-31T00:28:42.003
> 
> 标签：sql-server, formatting, ssms

In Visual Studio & other IDEs, you can easily auto format your code with a keyboard shortcut, through the menu, or automatically as you type.

I was wondering if there is yet a way to enable this standard feature in SQL Server Management Studio?

I'm working with some large-ish stored procs that are a mangled mess of poorly formatted SQL and it'd be nice if I could just go "Select All -> Format SQL"

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2011-08-25T21:36:11.033

迟到的答案，但希望值得：The [Poor Man's T-SQL Formatter](http://www.architectshack.com/PoorMansTSqlFormatter.ashx)是一个开源（免费）T-SQL 格式化程序，具有完整的 T-SQL 批处理/脚本支持（任何 DDL、任何 DML）、SSMS 插件、命令行批量格式化程序和其他选项。

[它可以在http://poorsql.com](http://poorsql.com)上立即/在线使用，并且刚刚升级到“1.0 版”（它是几个月的测试版），刚刚获得对`MERGE`语句、`OUTPUT`子句和其他挑剔的东西的支持.

SSMS 插件允许您设置自己的热键（默认为`Ctrl`- `K`、`Ctrl`-`F`以匹配 Visual Studio），并格式化整个脚本或仅格式化您选择/突出显示的代码（如果有）。输出格式是可定制的。

在 SSMS 2008 中，它与内置的智能感知很好地结合在一起，有效地提供了与 Red Gate 的 SQL Prompt 或多或少相同的基本功能（当然，SQL Prompt 确实有额外的东西，比如片段、快速对象脚本、 ETC）。

非常欢迎反馈/功能请求，如果有机会，请试一试！

披露：这可能已经很明显了，但我写了这个库/工具/站点，所以这个答案也是无耻的自我推销:)

* * *

## 回答 #2

> 赞同：176
> 
> 时间：2012-05-16T23:48:41.360

我偶然发现了一个特殊的技巧。

1.  选择要格式化的查询。
2.  `Ctrl`+ `Shift`+ `Q`（这将在查询设计器中打开您的查询）
3.  然后就去OK瞧！查询设计器将为您格式化您的查询。需要注意的是，您只能对语句而不是过程代码执行此操作，但总比没有好。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2020-12-26T14:05:22.157

Azure Data Studio - 免费且来自 Microsoft - 提供自动格式化（编辑时 ctrl + shift + p -> 格式化文档）。有关 Azure Data Studio 的更多信息，请[点击此处](https://docs.microsoft.com/de-de/sql/azure-data-studio/what-is-azure-data-studio?view=sql-server-ver15)。

虽然这不是 SSMS，但它非常适合编写查询、免费和 Microsoft 的官方产品。它甚至是跨平台的。小故事：只需切换到 Azure Data Studio 即可编写查询！

更新：实际上 Azure Data Studio 在某种程度上是微软推荐的用于编写查询的工具（[来源](https://docs.microsoft.com/de-de/sql/azure-data-studio/what-is-azure-data-studio?view=sql-server-ver15#feature-comparison-with-sql-server-management-studio-ssms)）

> 如果您： [..] 主要是在编辑或执行查询，请使用 Azure Data Studio。

# linq - 在 Select 中过滤 Null 值

> ID：401935
> 
> 赞同：69
> 
> 时间：2008-12-31T00:30:37.163
> 
> 标签：linq

我有 T 类型的对象的 IQueryable 列表，我想将其转换为 K 类型的对象

```
List<K> tranformedList = originalList.Select(x => transform(x)).ToList(); 
```

如果转换函数无法转换对象，则返回 null。如果我想过滤掉 null 元素，我可以调用

```
List<K> tranformedList = originalList.Select(x => transform(x))
                                     .Where(y => y != default(K))
                                     .ToList(); 
```

或者在 LINQ 中调用 Select 时是否有其他方法可以过滤掉空元素？

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2008-12-31T00:41:49.183

你不能做这样的事情：

```
List<K> tranformedList = originalList.Select(x => tranform(x))
                                 .Where(y => y != null) //Check for nulls
                                 .ToList(); 
```

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2010-11-14T21:55:09.347

关于什么

```
 List<K> tranformedList = originalList
                             .Select(transform)
                             .OfType<K>()
                             .ToList() 
```

负责拆箱同时摆脱空值（尤其是当 K 是结构时）

David BI 不相信您的代码`.Where(y => y != null)`在 K 是 int 时有效！如果 K 是 int，您将无法编译该代码！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-02-08T10:22:07.947

```
List<K> tranformedList = originalList.Select(x => transform(x))
                                     .Where(y => !string.IsNullOrEmpty(y))
                                     .ToList(); 
```

在 Select linq 查询之后，在 Where 查询中使用**!string.IsNullOrEmpty("string")**或**string.IsNullOrWhiteSpace("string")过滤空值。**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-09-20T11:26:47.773

使用 Where 而不是 Select (Linq)。

where 直接返回不带空值的列表

列表 transformedList = originalList.Where(x => x != null).ToList();

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-31T01:01:25.040

您可以尝试一个 for 循环并将非空值添加到新的转换列表中。

```
foreach (var original in originalList)
{
    K transformed = tranform(orignal);
    if (transformed != null)
    {
        tranformedList.Add(transformed);
    }
} 
```

或者你可以试试

```
 List<K> tranformedList = (from t in
                                      (from o in originalList
                                       select tranform(o))
                                  where t != null
                                  select t).ToList(); 
```

我认为内森的作品也不错，但不那么冗长

# sql - 有史以来最糟糕的 SQL？

> ID：401941
> 
> 赞同：10
> 
> 时间：2008-12-31T00:33:50.930
> 
> 标签：sql, database

你见过的最糟糕的 SQL 查询是什么？是什么让它变坏了？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-12-31T00:42:24.550

```
DELETE FROM table 
```

在我输入并执行后立即看到，我忘记了 WHERE 子句。现在我总是先运行一个 SELECT 语句，然后在我确信正确的行会受到影响后将 SELECT 更改为 DELETE。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-12-31T00:35:43.377

当然是经典的[xkcd](http://xkcd.com/327/)：

```
WHERE name = ROBERT'); DROP TABLE students;-- 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-31T05:53:18.570

每个 SQL 查询的 最坏*用法：*

一个 SELECT 查询，它计算与某个条件相对应的行数，在 for 循环的停止条件中调用。
像这样的东西：

```
for(int i = 0; i < query("SELECT COUNT .... WHERE ..."); i++)
{

} 
```

不，查询的结果不会改变每次迭代。是的，我意识到服务器将缓存结果。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-31T10:50:28.160

一个 PL/SQL (Oracle) 存储过程，它使用[Bubble Sort](http://en.wikipedia.org/wiki/Bubble_sort)对结果集进行排序。当我和 DBA 被要求找出一个严重的性能问题时，它被发现了。开发人员，一位甲骨文“专家”，已经为此工作了一个多星期。他板着脸解释说他在计算机科学课上学到了冒泡排序。该算法通常用于说明性能不佳。

用 ORDER BY 子句替换了整个混乱。性能提高了几个数量级。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-12-31T00:38:29.127

客户在 varchar 字段（经典 ASP 应用程序）中存储了一个逗号分隔的 3 个值列表，因此他们有一个如下所示的存储过程：

```
SELECT *
FROM
    SomeTable
WHERE
    Field LIKE @Param + ',%'
    OR
    Field LIKE '%,' + @Param + ',%'
    OR
    Field LIKE '%,' + @Param 
```

为什么它很可怕应该很明显:)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-12-31T01:24:38.053

我自己的，在这里发布太长了——现在关闭 3500 行

我必须与一个绝对可怕的模式分担责任。一开始只是使用一些联合对非规范化数据进行旋转的简单练习变成了一场笨拙的噩梦。它急需维修。

亚军是这样的：

```
select 
case datepart(mm,getdate())
when 1 then 'Jan'
when 2 then 'Feb'
when 3 then 'March'
when 4 then 'Apr'
when 5 then 'May'
when 6 then 'Jun'
when 7 then 'July'
when 8 then 'Aug'
when 9 then 'Sept'
when 10 then 'Otc'
when 11 then 'Nov'
when 11 then 'Dec'
end 
```

那篇文章没有错别字——就是这样写的。谢谢，咨询美元！

我当然用 Select left(datename(mm, getdate()), 3) 重构了

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-31T00:43:53.017

```
select * from users where clue > 0;
0 results found. 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-31T01:52:41.163

当我第一次得到现在的工作时，我的第一个项目是创建一个应用程序来总结我们计算机实验室的许可证使用数据。他坚持认为他不希望后端数据库被规范化，因为连接“太昂贵”。这是我的第一周，我没有资格争论。

现在，为了从数据库中提取任何有用的数据，必须在每个需要提取摘要的查询中“撤消”非规范化，以删除每行中的重复数据。当然，这些是唯一实际使用的查询。您会看到很多嵌套选择，如果数据被规范化，这些选择是完全没有必要的，例如：

```
select location, sum(login_time) as total_login_time
from
    (select location, session_id, max(login_time) as login_time
     from sessions
     where location in ('lab1','lab2') 
           and session_start >= @start_date 
           and session_end <= @end_date
     group by location, session_id) tbl
group by location 
```

虽然，查询本身并不是特别丑陋——尽管有些是丑陋的——但每次都必须跳过箍以撤消不必要的非规范化伤害的过程。

现在老板走了，但我没有时间重写它......

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-12-31T06:20:59.873

在[comp.databases.informix](http://groups.google.com/group/comp.databases.informix/browse_thread/thread/56ec41fed00c94fe/9e4ed5335e7ce8d9?lnk=gst&q=%22create+table%22+author%3Aleffler#9e4ed5335e7ce8d9)新闻组的帖子中 - 一个真正的 Informix 表（我不建议使用）：

```
CREATE TABLE VIEW
(
    DECIMAL     CHAR(30),
    NOT         INTEGER NOT NULL,
    SERIAL      DATE NOT NULL,
    NULL        CHAR(1) NOT NULL,
    INTEGER     DECIMAL(13,6) NOT NULL
); 
```

如果您知道 SERIAL 是 Informix 数据库中的一种类型（基本上），它会有所帮助 - 基本上，它是用于连续生成自动分配数字的类型之一。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-05T16:39:17.240

```
SUBSTRING(
(SUBSTRING(LastName, 0, CHARINDEX(' ', LastName)) + ', ' + FirstName),
0,
CHARINDEX(' ', (SUBSTRING(LastName, 0, CHARINDEX(' ', LastName)) + ', ' + 
FirstName), LEN(LastName) + 3)
) 
```

他们显然不熟悉 RTRIM。

```
RTRIM(LastName) + ', ' + RTRIM(FirstName) 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-31T00:34:44.173

从 * 中选择 *

真糟糕。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-31T01:13:41.053

**这可能不是最糟糕的，但我经常看到这种情况（[滥用 group by 子句](http://weblogs.sqlteam.com/jeffs/archive/2005/12/14/8546.aspx)）：**

```
SELECT
  C.CustomerID, C.CustomerName, C.CustomerType, C.Address1, C.City,   
  C.State, SUM(S.Sales) as TotalSales
FROM
  Customers C
INNER JOIN Sales S
  ON C.CustomerID = S.CustomerID
GROUP BY
  C.CustomerID, C.CustomerName, C.CustomerType, C.Address1, C.City, C.State 
```

**代替：**

```
SELECT
  C.CustomerID, C.CustomerName,
  C.CustomerType, C.Address1, C.City,
  C.State, S.TotalSales
FROM
  Customers C
INNER JOIN
  (SELECT CustomerID, SUM(Sales) as TotalSales FROM Sales GROUP BY CustomerID) S
ON
  C.CustomerID = S.CustomerID 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-12-31T01:43:38.293

大声读出来。

```
select [select],*,star as [as] from [from],[order] order by [by] 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-12-31T10:55:02.957

我认为这是最糟糕的（尤其是在痛苦和空回滚之后）：

```
DROP DATABASE;
ROLLBACK; 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-31T00:40:04.960

最近，我看到了一个（大于）4000 行的 TSQL 存储过程，它是一个用于匹配部分地址的 IF 语句链。它可以减少到少于 50 行！

我正在为未来的 DailyWTF 保存代码！

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-31T00:42:10.010

```
SELECT * FROM some_table; 
```

让它如此糟糕的是代码依赖于根据时间戳按顺序获取结果。在我被要求修复它之前，这显然已经工作了一段时间。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-31T03:38:11.870

在 Access 数据库中，有如下查询：

```
SELECT *
FROM Bad_2 INNER JOIN Bad_1 ON Bad_2.Bad_1_id = Bad_1.ID; 
```

并且两个表都有一个同名的字段。当 Access 第二次遇到一个字段名称时，它会为其组成一个新名称。前人在代码中使用了生成的字段名。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-31T05:42:07.050

在我的时间里看到了许多糟糕的 SQL。一个浮现在脑海的是形式

从文件加载数据，循环访问该文件，访问文件中每一行的 db。

在具有 10 左右行的测试系统上似乎没问题，100K-100 万 = 即使对于主键查找来说也很讨厌。

顺便说一句，解决方案是将数据加载到数据库中并分组思考。

-- 选择你最喜欢的语言，例如。perl, 蟒蛇...

将文件加载到数据结构中（例如数组）

`for (1 .. n) loop
myid := array[n];
select * from table where id = myid;
if the row exists update table set ... where id = myid;
end loop;`

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-12-31T02:15:04.690

DELETE FROM some_table WHERE some_thing IN (SELECT some_column_from_wrong_table FROM correct_table WHERE some_id=something)。

some_column_from_wrong_table 有一列甚至不在表中，但它在另一个表中。问题是正确的表被命名为“事件”，并且它以某种方式返回了所有行而不是 NO 行（或更重要的是，一个错误！）。

吸取的两个教训：在任何情况下，永远不要以*任何*形式的系统名称命名表。第二件事是先运行选择语句，然后更改为删除。

顺便说一下，这是 SqlServer 2005。我仍然很生气它没有抛出错误。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-31T07:54:05.800

我喜欢[最近](http://thedailywtf.com/Articles/Classic-WTF-Now-Thats-A-Neat-Trick.aspx)在dailywtf上转发的一篇，它附带的故事也很精彩。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2009-01-05T16:48:04.743

```
SELECT name FROM categories WHERE id IN (".implode(",",corrected_cats($ad->id)).") ORDER BY name ASC 
```

是的，您没看错……字段中的逗号分隔字段。

# java - 我在哪里可以找到 Java 中的以下类

> ID：401945
> 
> 赞同：0
> 
> 时间：2008-12-31T00:35:11.803
> 
> 标签：java

我是一名学习 Java 的 .NET 开发人员。结果，我了解了编程的所有基础知识，如循环、变量、函数等。我最大的瓶颈是我不知道如何像使用 .NET 那样处理 Java 包。

这就是这个线程的原因 - 我在哪里可以找到 Java 中的以下功能？：

System.Diagnostics - 我在哪里可以使用秒表、程序断点和记录器之类的东西？

是否有 Java 等效的 .NET 性能计数器？

Java中的弱键是什么？我刚刚遇到一个在 Java 中使用弱键的集合，所以在这里问。:)

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-31T00:40:23.227

使用弱键的字典只保留对每个键的弱引用，因此如果键在其他方面符合垃圾回收条件，则它可能会被收集，字典将有效地丢失条目。有关弱引用的更多信息，请参阅[WeakReference](http://java.sun.com/javase/6/docs/api/java/lang/ref/WeakReference.html)的文档。

System.Diagnostics：我不知道秒表和程序断点的任何等效项。对于日志记录，请查看[java.util.logging](http://java.sun.com/javase/6/docs/api/java/util/logging/package-frame.html)或第三方包，例如[log4j](http://logging.apache.org/log4j/)。

性能计数器：可能有一些方法可以将一些 JVM 连接到 Windows 性能计数器中，但我从未见过它们。有[VisualVM](http://java.sun.com/javase/6/docs/technotes/guides/visualvm/index.html)，您可能会发现它对某些相同的事情很有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T00:42:07.593

如果你只是想计时，你可以使用 System.nanoTime()。

```
long start = System.nanoTime();

// a bunch of code

long end = System.nanoTime();

System.out.println("Elapsed time in seconds: " + (end-start)/1000000000.0); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-31T11:34:47.773

[JAMon](http://jamonapi.sourceforge.net/)是一种可能符合您要求的开源 Java 监控库。

此外，任何性能/管理计数器都通过[Java 管理扩展 (JMX)公开](http://en.wikipedia.org/wiki/Java_Management_Extensions)

然后你有许多监控控制台：

*   `jconsole`随附 Java 安装（基于 Swing）
*   [MC4J](http://sourceforge.net/projects/mc4j/)开源控制台（基于 Swing）
*   [Eclipse 中的 eclipse-jmx](http://code.google.com/p/eclipse-jmx/)控制台（基于 SWT）
*   大多数应用程序服务器都带有一个基于 Web 的 JMX 控制台（例如：[JBoss](http://www.jboss.org/community/docs/DOC-10941)）

Alternatively, take a look at this [other posting](https://stackoverflow.com/questions/358129/java-app-performance-counters-viewed-in-perfmon) for ideas on how to monitor JMX statistics in Perfmon.

Hope this helps.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-31T00:40:57.360

至于记录器，包是：

java.util.loogging

```
import java.util.loggin.Logger;

...

Logger logger = Logger.getLogger( this.getClass().getName() );

logger.fine( "Hello" );

logger.severe(" Oh oh "); 
```

以下是一些有用的链接：

[http://java.sun.com/javase/6/docs/api/java/util/logging/Logger.html](http://java.sun.com/javase/6/docs/api/java/util/logging/Logger.html)

[http://java.sun.com/javase/6/docs/api/](http://java.sun.com/javase/6/docs/api/)

[http://java.sun.com/javase/6/docs/api/allclasses-noframe.html](http://java.sun.com/javase/6/docs/api/allclasses-noframe.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T00:41:18.640

您应该查看[http://commons.apache.org/](http://commons.apache.org/)以了解很多其他查询。Java 1.4.2 及更高版本有 java.util.logging

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-31T00:43:47.447

“弱密钥”的概念来自加密。也许您正在考虑弱引用？.NET 和 Java 都支持弱引用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-31T01:40:22.670

我注意到常见的 .NET 类驻留在 Java.Util 中（日期是那些常见的类之一——我和我确信每个开发人员在编程中经常使用的东西）。

啊，弱键与弱引用有关——我在 .NET 中熟悉的概念。现在已经回答了这个问题。多谢你们！

至于性能监控（计数器），看起来 Java 中没有内置功能。再说一次，我猜性能计数器是 Windows 的一项功能，而不仅仅是 .NET 中的一个类？我正在Windows上开发。

# sms - FLASH SMS 上的 WAP 推送

> ID：401965
> 
> 赞同：0
> 
> 时间：2008-12-31T00:45:55.383
> 
> 标签：sms, mobile-phones, nokia, wap

我想发送一个 WAP Push SI，但我希望消息看起来像一个警报 - 就像 FLASH SMS。我试过把携带WAP数据的短信做成FLASH短信，但手机好像处理不了。我在诺基亚 6230i 上试过。

我正在做的事情是否有问题，或者手机一般不会像我预期的那样**通过 FLASH SMS 处理 WAP ？**

*您能否提出另一种解决方案来改善 WAP PUSH 的用户体验，即让它显示为警报？*

谢谢，
阿萨夫。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-10T21:22:59.303

虽然理论上可能，但我认为手机通常无法处理这种组合。

您必须坚持使用闪存或推送消息。我认为除了确保您推送的 wap 页面的消息和内容清晰简洁之外，没有任何方法可以改善 wap 推送的用户体验。wap 推送消息真的是一种糟糕的用户体验，以至于他们需要这种改进吗？我发现它们很容易使用，而且它们没有存储在 SMS 收件箱中，所以从这个意义上说，它们就像 flash sms 一样“消失”。

您可以发送一条 Flash 短信通知用户他即将收到一个链接，然后发送推送消息，但取决于您的应用程序，这可能只会让用户体验变得更糟..

# macos - OS X：创建或提取 .eps 文件的预览（.jpg，.png）

> ID：401971
> 
> 赞同：6
> 
> 时间：2008-12-31T00:49:48.387
> 
> 标签：macos, command-line

我正在使用 mac 并希望批量转换大量 eps 文件并为每个文件创建 jpg 预览。我正在寻找一个命令行实用程序，或者某种类型的工作流来轻松批处理大量文件。

感谢您的任何想法或意见

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-31T01:19:44.850

就像提到的 codelogic 一样，`sips`它是一个很好的工具。但是，它本身不支持 EPS，因此您需要先转换为 PDF。

如果您使用的是 Tiger 或 Leopard，则应使用以下方法：

```
mkdir pdf jpg

cd pdf
echo ../eps/*.eps | xargs -n1 pstopdf
cd ..

sips -s format jpeg *.pdf --out jpg/ 
```

假设您的 EPS 文件在当前目录中，这将首先将它们全部转换为 pdf，将它们存储在 pdf/ 目录中，然后将每个 PDF 转换为 jpg/ 目录中的 JPEG 文件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-31T01:13:07.530

[ImageMagick](http://www.imagemagick.org)应该正是您正在寻找的。安装后，只需使用该`convert`实用程序：

```
convert file.eps -resize 25% preview.jpg  # create jpg thumbnail at 25% size 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-31T01:15:23.407

在 OS X 上，您可以使用[sip](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/sips.1.html)来执行图像处理任务，例如[缩略图](http://www.jonsimpson.co.uk/weblog/2005-06-18/the-depths-of-os-x-sips.html)。它应该支持EPS。如果没有，正如亚当建议的那样，有 ImageMagick 的`convert`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-19T10:07:12.680

如果我放弃尾随的'/'，sips 对我来说很好，即输出到 jpeg 而不是 jpeg/

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-08-09T10:45:59.410

今天，您还可以利用 GIMP 2.10 或更高版本进行任何方便的从 jpg 到 eps、jpg 到 png 的转换，反之亦然。

# uri - 何时使用查询参数与矩阵参数？

> ID：401981
> 
> 赞同：92
> 
> 时间：2008-12-31T00:55:21.840
> 
> 标签：uri, query-parameters

**查询参数**：`http://example.com/apples?order=random&color=blue`

**矩阵参数**：`http://example.com/apples;order=random;color=blue`

1.  什么时候应该使用查询参数和矩阵参数？
2.  为什么URL中间可以使用矩阵参数而查询参数不能？例如：`http://example.com/apples;order=random;color=blue/2006/archive`
3.  如果矩阵参数是查询参数的超集，为什么不一直使用它们呢？

您可以在此处阅读有关矩阵参数的更多信息：http: [//www.w3.org/DesignIssues/MatrixURIs.html](http://www.w3.org/DesignIssues/MatrixURIs.html)

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2009-01-19T22:43:39.880

矩阵参数和查询参数之间的区别不仅仅是约定。

主要区别在于：

*   带有查询参数的 url**不会被中介/代理缓存它们的响应**（目前）*   矩阵参数可能出现在路径中的任何位置*   计算相对uri是不同的*   查询参数通常被滥用来添加新动词，而不是在资源上使用现有方法*   矩阵参数不是资源，它们是帮助引用信息空间中难以在层次结构中表示的资源的方面

我已经更详细地编写了它，并在 [查询与矩阵参数中提供了更多参考](http://web.archive.org/web/20130126100355/http://brettdargan.com/blog/2009/01/16/query-vs-matrix-params)

# php - 使用 Cookie 和 Salted Hashes 的 PHP 登录系统

> ID：401985
> 
> 赞同：18
> 
> 时间：2008-12-31T00:59:34.857
> 
> 标签：php, session, login, cookies

我正在开发一个基于 PHP 的登录系统。每个用户都有一个 ID（一个数字）和一个密码，这些密码存储为盐渍哈希。

我能够确定登录是否成功，但现在我需要将该信息存储在某处（以便用户不会永久注销）。

过去，我玩过 $_SESSION 变量。但是，这些似乎在用户离开浏览器时被删除，这是不希望的。另外，我不能“假设”用户不会试图欺骗系统，所以它必须是安全的。

所以，这是我的问题：

1.  我应该使用`$_SESSION`or`$_COOKIE`吗？这些方法的主要优点是什么？
2.  如何实现“记住我”复选框？
3.  哪些信息应该存储在 session/cookie 变量中？

请注意，在这个特定问题中没有考虑数据库安全问题。

关于数字 3，我的意思是：

*   我应该将用户的 ID 和哈希密码存储在 cookie/会话中，还是
*   我应该将用户的 ID 和非哈希密码存储在 cookie/会话中，还是
*   我应该存储“SessionID”和密码（散列还是非散列？）或
*   我应该存储“SessionID”、“ID”和密码（再次，散列或非散列）？

我想让我的网站尽可能安全、高效和用户友好。如果采用基于 SessionID 的方法，我也会感谢有关如何将其存储在数据库中的一些解释。

先感谢您

编辑：Eran 和 Brian 的答案结合起来似乎是我需要的。不幸的是，我只能将其中一个标记为已接受。我将尝试继续实施，看看哪个更有用。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-31T02:37:30.743

我想重申 Eran 的观点，**永远不要**在会话或 cookie 数据中存储用户密码，甚至是密码的哈希值。

一般来说，我已经使用 Cookie 在网络应用程序中实现了记住我的功能。了解有关构建“安全”持久登录系统的信息的一个好地方是[fishbowl 上的这篇博客文章](http://fishbowl.pastiche.org/2004/01/19/persistent_login_cookie_best_practice/)。[另一个 Stack Overflow 答案](https://stackoverflow.com/a/477578/2224584)已经涵盖了深入的答案。

如果您需要确保登录是安全的，则必须使用 https。这是因为如果 cookie 或会话未加密，它们可能会被窃取。

另一个要遵循的好习惯是 2 级登录系统。您可以在亚马逊等网站上看到这一点，您可以在不登录的情况下将商品添加到购物车，但如果您想以某种方式结帐或编辑您的帐户，则必须再次输入密码。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-31T01:06:47.993

对于敏感信息（即身份验证结果），仅使用会话。会话存储在服务器端，被破坏的可能性要小得多。

关于会话生命周期，默认值是浏览器会话的生命周期 - 但您可以控制它。有几个设置会影响：

session.gc_maxlifetime - 有效控制会话的生命周期。

session.gc_probability 和 session.gc_divisor 一起决定了会话垃圾回收的频率。

最后 - session.cookie_lifetime 控制会话 cookie 的生命周期（保存会话 id 的 cookie，因此不必通过 URL 传输）。它应该与 session.gc_maxlifetime 的值匹配。

此外，切勿将密码存储在会话或 cookie 中（即使是散列格式）。只是认证的结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-31T08:17:58.793

将 ID 存储在 $_SESSION 中，但不要存储散列或非​​散列密码。一旦用户登录并且 ID 保存在 $_SESSION 中，您就不再需要密码了。

# html - 如何在两个并排的 div 中垂直居中文本？

> ID：401996
> 
> 赞同：3
> 
> 时间：2008-12-31T01:07:30.957
> 
> 标签：html, css

感谢您阅读本文。

我有类似于下面的标记。当只有一行文本时使用 line-height 有效，但评论数据经常是多行的。使标签和数据垂直居中的最佳方法是什么？

```
<html>
 <head>
 <style>
  body {margin:0; padding:0; font-size:12px; font-family:Verdana; text-align:center;}
  body {text-align: -moz-center; }  /* For Firefox */
  .record {width:760px; text-align:left; }
  .label {float:left; width:125px; line-height:75px;}
  .data {float:left; margin-left:10px; line-height:75px;}
  .clear {clear:left;}
 </style>
 </head>
 <body>
  <div class="record">
   <div class="label">Subject:</div>
   <div class="data">This is the subject</div>
   <span class="clear"></span>

   <div class="label">Status:</div>
   <div class="data">This is the status</div>
   <span class="clear"></span>

   <div class="label">Comments:</div>
   <div class="data">These are the comments</div>
   <span class="clear"></span>
  </div>
 </body>
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-31T02:41:37.773

[http://www.jakpsatweb.cz/css/css-vertical-center-solution.html](http://www.jakpsatweb.cz/css/css-vertical-center-solution.html)

而且当然：

[http://www.google.com/search?hl=en&sa=X&oi=spell&resnum=0&ct=result&cd=1&q=vertically+align+text+div&spell=1](http://www.google.com/search?hl=en&sa=X&oi=spell&resnum=0&ct=result&cd=1&q=vertically+align+text+div&spell=1)

:)

Tables have their place; but it is good to try and figure how to do something in a div before resorting back to tables. That way when the time comes that you can't do something in a table you know instantly how to do that in a div. Besides - although they can be more complex then tables they allow for MUCH better flexibility in your design once you know how.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T01:10:48.423

您可能想要使用的是`<table>`数据结构。虽然有很多文件流传着“桌子不好；永远不要使用桌子”，桌子显然是正确的结构，因为它们可以轻松实现您正在寻找的视觉效果，并且（据我所知）您正在呈现表格数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-31T02:44:57.953

I read the solutions that teach you how to do this with a DIV. When I faced a similar issue, I just used a table, using which looks less messy and pretty elegant to me.

I don't think there's anything wrong in using a table in this particular situation at least.*********