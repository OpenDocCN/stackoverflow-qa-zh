# StackOverflow 问答 000855000-000855999

# c# - 从控制器强制 MVC 强类型视图上的必需参数？

> ID：855002
> 
> 赞同：2
> 
> 时间：2009-05-12T21:40:06.070
> 
> 标签：c#, asp.net-mvc

我有一个控制器，我想将一些数据传递给视图。

视图的强类型如下：

```
System.Web.Mvc.ViewPage<SomeObject> 
```

现在，当我在控制器中调用以下内容时：

```
return View("SomeAction", someObject); 
```

我希望它强制我需要传入“someObject”。

例如。我希望以下**失败并且不编译**：

```
View("SomeAction"); 
```

无论如何，必须始终将预期对象传递给视图。

这是可能的还是我完全不在基地？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T21:47:21.020

我只想为这种情况写一个测试，其余的不打扰：

```
var actual = controllerUnderTest.Action() as ViewResult;
Assert.IsNotNull(actual.ViewData.Model);
Assert.IsInstanceOfType(actual.ViewData.Model, typeof(SomeObject)); 
```

# linux - 为多个发行版和版本构建 Linux 包

> ID：855003
> 
> 赞同：9
> 
> 时间：2009-05-12T21:40:08.550
> 
> 标签：linux, build-process, build, cross-platform, packaging

我的公司有一个用 C 语言为 Linux 平台编写的软件产品，使用自动工具构建并通过二进制包分发。为了制作二进制文件，我们首先生成一个源 RPM，然后从 SRPM 编译源。

目前我们只为 64 位 Fedora 10 提供 RPM 包，但我们希望开始为多个 Linux 发行版（32 位和 64 位）以及可能每个发行版的不同版本（例如 Fedora 11 以及作为 Fedora 10）。

我听说为多种 Linux 风格生成构建的最佳方法是拥有一个构建服务器，并为要构建的每组包使用不同的 chroot 环境。有没有人有一个很好的资源可以更详细地解释这一点，也许有使用这种构建机制的知名项目的例子，或者有更好的替代方案来实现相同的目标？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-12T22:24:32.940

也许您可以研究以下项目以开始：

[Novell 构建服务](http://en.opensuse.org/Build_Service/supported_build_targets)

[Fedora Koji](http://fedoraproject.org/wiki/Koji)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T07:15:59.810

您可以使用[LSB appchecker](https://wiki.linuxfoundation.org/lsb/linux-application-checker-getting-started)来测试您的应用程序/dynlib/shell 脚本的兼容性。之后，您可以将 RPM 用于所有 RPM 分发，并将 Alien 用于所有 apt-get 分发，而 tar.gz 用于其他分发

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T07:28:39.103

诸如此类的工具`checkinstall`将帮助您为不同的发行版生成软件包。就个人而言，如果您希望与现有的包管理系统集成，您还需要在您的服务器上托管多个存储库并在那里提供包，然后让用户配置他们的包管理器以将应用程序从您的服务器中拉出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-12T11:15:29.773

根据您的软件的确切功能以及它对本地库的依赖项（如果有的话），您可能能够使用较旧的 glibc 发行版构建您的软件，并使其在许多不同的发行版中工作。这就是我们使用[InstallBuilder 所做](http://installbuilder.bitrock.com)的。如果您不依赖特定包，也可以创建 RPM 或 DEB 包，这些包将在大多数基于 RPM 或 DEB 的 Linux 发行版上运行。跨Linux开发，无论如何，都不容易:) 祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-12T15:18:14.300

这是 Bob Aiello 在[这篇](http://www.cmcrossroads.com/cm-basics/12942-do-you-need-agents)关于构建代理的文章中介绍的案例之一。[我们](http://www.anthillpro.com/html/default.html)有几个客户使用这种方法在多个平台上并行构建。

# wpf - 将 WMF（Windows 图元文件）或任何其他矢量文件导入 silverlight 项目

> ID：855011
> 
> 赞同：2
> 
> 时间：2009-05-12T21:41:17.473
> 
> 标签：wpf, silverlight, xaml, pixelsense

是否可以将 WMF（Windows 元文件）或任何其他基于矢量的文件导入 silverlight 项目？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-14T11:21:14.363

您可以使用 Paste2Xaml 将 WMF/EMF 转换为 XAML

[http://www.wpf-graphics.com/Paste2Xaml.aspx](http://www.wpf-graphics.com/Paste2Xaml.aspx)

和（来自同一来源）ViewerSvg 将 SVG 转换为 XAML

[http://www.wpf-graphics.com/ViewerSvg.aspx](http://www.wpf-graphics.com/ViewerSvg.aspx)

此外，对于 SVG，InkScape 有一个 XAML 导出功能，并且在某处有一个用于 Adob​​e Illustrator 的 XAML 导出插件，对于 WMF，Microsoft Expression Graphics Designer（一个简称）应该能够导入 WMF 和导出 XAML，但我没有我自己没用过。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T14:35:15.473

您可能想在 codeplex 上查看免费的[Silverlight Contrib 项目。](http://silverlightcontrib.codeplex.com/Wiki/View.aspx?title=Feature%20Overview&ANCHOR)它带有显示 WMF 和 EMF 文件的控件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-03T07:24:01.990

Inkscape 可以导入 wmf 和导出 xaml： http: [//www.inkscape.org](http://www.inkscape.org)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T21:57:18.727

我不知道直接的方法，但我之前肯定已经成功地将 SVG 转换为 XAML。**[请参阅此简短指南。](http://www.uxpassion.com/2008/10/how-to-convert-svg-to-xaml-and-use-it-in-silverlight-or-wpf/)**

# c++ - 如何访问工会的内部成员？

> ID：855021
> 
> 赞同：1
> 
> 时间：2009-05-12T21:43:56.500
> 
> 标签：c++, struct, unions

我有一个定义如下的工会：

```
typedef union {
  enum {
    REVISION = 0,
    CURRENT_VERSION = REVISION
  };

  enum FLAGS{
    FLAG_DEFAULT               = 0x00000000,
    FLAG_EOD                   = 0x00000001,
    FLAG_OUTOFORDER            = 0x00000002
  };

  CHAR _filler[32];

  struct INTERNAL_STRUCTURE {
    UINT16 type;
    UINT16 flags;
  };
}CORRHDR 
```

如何从我的代码中访问 INTERNAL_STRUCTURE 的成员？

我以为我可以这样做：

```
CORRHDR hdr;
hdr.INTERNAL_STRUCTURE.type = 1; 
```

我错了。我可以看到联合中的枚举，但没有别的。有人可以向我解释这种类型的结构（或好处）吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-12T21:47:24.903

您已经声明了名为的*类型*`INTERNAL_STRUCTURE`，但不是该类型的实际实例。试试这个：

```
typedef union {
  //...
  CHAR _filler[32];
  struct {
    UINT16 type;
    UINT16 flags;
  } INTERNAL_STRUCTURE;
}CORRHDR; 
```

然后访问该字段：

```
CORRHDR ch;
printf("%u\n", ch.INTERNAL_STRUCTURE.type); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T21:47:44.403

您需要先定义一个类型的对象，`INTERNAL_STRUCTURE`然后才能尝试访问它。你的工会目前还没有。尝试：

```
struct INTERNAL_STRUCTURE {
    UINT16 type;
    UINT16 flags;
  };
struct INTERNAL_STRUCTURE is; 
```

...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T21:48:46.320

您定义了一个名为 INTERNAL_STUCTURE 的类型

不是名为 INTERNAL_STRUCTURE 的实例。

```
typedef union {
  enum {
    REVISION = 0,
    CURRENT_VERSION = REVISION
  };

  enum FLAGS{
    FLAG_DEFAULT               = 0x00000000,
    FLAG_EOD                   = 0x00000001,
    FLAG_OUTOFORDER            = 0x00000002
  };

  CHAR _filler[32];

  struct {
    UINT16 type;
    UINT16 flags;
  } INTERNAL_STRUCTURE;
}CORRHDR; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T21:50:29.453

此外，您定义了结构但不使用它！

您需要定义该结构类型的变量：

```
union Blob
{
  CHAR _filler[32];

  struct INTERNAL_STRUCTURE {
    UINT16 type;
    UINT16 flags;
  } myStruct;
};

CORRHDR hdr;
hdr.myStruct.type = 1; 
```

# sql-server - sql server 表的优化建议

> ID：855022
> 
> 赞同：0
> 
> 时间：2009-05-12T21:45:14.610
> 
> 标签：sql-server, optimization

我有一个包含需要优化的用户输入的表。我对如何解决这个问题有一些想法，但我非常感谢您对此的意见。需要优化的表在下面的结构中称为Value。下面提到的所有表都有称为 Id 的整数主键。
*规格：Ms Sql Server 2008、Linq2Sql、asp.net 网站、C#。*

当前结构如下：
Page -> Field -> FieldControl -> ValueGroup -> Value

## 页

页面是一个或多个字段的容器。

## 场地

字段是一个或多个 FieldControls 的容器，例如文本框或下拉选项。
*关系：PageId*

## 现场控制

如果字段的类型为“TextBox”，则为该字段创建一个 FieldControl。如果字段的类型为“DropDown”，则每个下拉选项都会为包含选项文本的字段创建一个 FieldControl。
*关系：FieldId*

## 价值集团

每次用户填写页面中的字段并保存时，都会创建一个新的 ValueGroup (Id) 以跟踪与该保存相关的用户输入。当用户想要查看之前填写的表单时，值组用于将值加载到之前填写的实例的 FieldControls 中。
*关系：无*

## 价值

FieldControl 的实际输入。如果用户在 TextBox 中键入“Hello”，则“Hello”将存储在该表中的一行中，然后是对其输入 FieldControl“Hello”的引用。ValueGroup 链接到值，以便对它们进行分组以跟踪它们属于哪个保存/实例，如 ValueGroup 中所述。
*关系：ValueGroupId、FieldControlId*

## 问题

如果 100.000 个页面被完全填充，每个页面包含 10 个文本框，那么我们在 Values 表中得到 100.000 * 10 条记录，这意味着我们很快就达到了 100 万条记录，这使得它现在变得非常慢。用户可以根据自己的喜好创建具有​​任意多不同字段的不同页面，所有这些值都存储在“值”表中。我使用此数据的方式是通过显示带有分页的网格视图来显示单个页面类型的所有记录，或者在查看特定页面实例（按 ValueGroupId 分组的值）时。

我的一些想法：
在优化 Values 表时，良好的索引应该非常重要。
我是否应该将外键从 Value 直接添加回 Page，最终通过 (Id, PageId, ValueGroup) 进行索引，从而允许 gridview 检索仅与一个页面相关的值？

我应该考虑对表进行分区吗？如果是，你会如何建议我这样做？我在想按页面进行分区，因此在这种情况下获得仅与某个页面相关的大块值是明智的，对吗？脚本/模式将如何查找用户可以随时创建/删除页面的内容。

PS。在这个论坛上应该有一个徽章给所有读完这篇长文的人，我希望我能说清楚:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T11:54:33.050

只是为了关闭这个帖子。正确的索引解决了所有性能问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T21:52:59.340

这可能有点离题，但为什么呢？这些数据是您需要实时访问的，还是用于稍后处理的？您能否将数据打包成一行，然后再将其解包？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T23:12:24.313

## 通用的

你说它现在很慢，除了数据库之外，还有很多原因，比如内存不足、CPU 高、磁盘碎片、网络负载、套接字问题等。这应该显示在系统监视器上

尝试例如 Sysinternals（现在是 MS）工具： http: [//live.sysinternals.com/procexp.exe](http://live.sysinternals.com/procexp.exe)

但如果这一切都在控制范围内，那么回到数据库。

## 数据库索引

一百万条记录不是“那么多”，也不应该成为问题。如果您现在没有任何索引，索引应该可以解决问题。如果您还没有这样做，您可能应该在所有表上设置索引。

我试着做一个数据库模型，对不对： [http ://www.freeimagehosting.net/image.php?a39cf99ae5.png](http://www.freeimagehosting.net/image.php?a39cf99ae5.png)

## 表结构（？）

页面 -> 字段 -> 字段控制 -> 值组 -> 值

表结构看起来可能不是最佳结构，但当我不知道应用程序如何工作时，很难准确地说出。

> 所有表都有上表的外键吗？

## 这与您的代码有些相似吗？

**伪代码：**

```
1\. Get page info. Gives key "page-id"
2\. Get all "Field":s marked with that "page-id".
   Gives keys "field-id" & "fieldcontrol-id"
3\. Loop trough all fields-id:s and get the FieldControl for each one
4\. Loop trough all fields-id:s and get all ValueGroup:s.
   Gives a list of "valuegroup-id":s keys
5\. Loop trough all ValueGroup:s and get all fields 
```

# php - Ruby on Rails 或 PHP 框架

> ID：855027
> 
> 赞同：7
> 
> 时间：2009-05-12T21:45:57.247
> 
> 标签：php, ruby-on-rails, web-applications

我是一个有能力的程序员，我以编写软件为生。我正在着手一个新项目来构建一个网站，该网站有一堆表单，可以对数据库和一些多媒体执行 CRUD 操作。我非常熟悉 PHP 和 Python，并在其中编写了一些网站。我编写了一些 rake 任务和一些在生产环境中运行的 ruby​​ 脚本，但我从未用 ruby​​ 编写过任何网站。我正在考虑使用 Rails，但我有以下问题。很高兴知道任何/所有这些的答案：

*   该项目应该在一个月内完成，而且时间非常紧迫。在 RoR 中学习和建立网站是否足够 1 个月？
*   编写直接 SQL 查询是我的优势之一，我想使用它。我听说如果我直接编写 SQL 查询，使用 RoR 会很痛苦。这是真的？或者我可以说执行一个查询，给我结果（作为一个列表或字典），然后我会告诉你如何呈现它们？
*   我听说 RoR 确实加入了内存并且不使用数据库提供的设施。它是否正确？
*   我需要创建一个显示大量图像、视频和 Java 小程序的网站。RoR 会妨碍我这样做吗？
*   我可以使用 PHP 框架。这是一个坏主意吗？如果不是，哪个 PHP 框架在编程方便性方面最接近 Rails。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-12T22:03:20.853

按顺序回答您的问题：

1.  你当然可以在那个时候学习 Rails。建立一个网站也有足够的时间，但是否有足够的时间建立*您**的*网站是另一个问题。我个人不想在紧迫的期限内尝试这样的事情。
2.  您*可以*编写自己的 SQL 查询，但如果您打算使用 Rails 的所有功能，那么使用它几乎没有意义。
3.  连接通常作为 ActiveRecord 生成的数据库查询的一部分完成。
4.  使用 ROR 与在页面上显示图像、视频等几乎是正交的。
5.  我没用过，但是 CakePHP 的目标是相当 Railsy。Zend 和 CodeIgniter 更受欢迎，不过，用过这三种方法的人对我的评价更好。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-12T22:00:49.203

> 该项目应该在一个月内完成，而且时间非常紧迫。在 RoR 中学习和建立网站是否足够 1 个月？

鉴于您描述的经验，我想一个月学习和构建一个简单的应用程序（特别是如果它基于 CRUD）应该足够了。如果有相当程度的复杂性，我会不愿意学习一项新技术并在一个月内交付一个复杂的网站。

> 编写直接 SQL 查询是我的优势之一，我想使用它。我听说如果我直接编写 SQL 查询，使用 RoR 会很痛苦。这是真的？或者我可以说执行一个查询，给我结果（作为一个列表或字典），然后我会告诉你如何呈现它们？

rails 方法是使用它为您提供的 ActiveRecord 对象映射（并且大多数情况下都很好）如果您想要这样做，直接编写 SQL 也很容易

```
ModelName.find_by_sql('your query') 
```

你是怎么做的

> 我听说 RoR 确实加入了内存并且不使用数据库提供的设施。它是否正确？

ActiveRecord 为您做了很多工作，但无论性能是什么，您都可以编写自己的 SQL 来利用数据库的优势。

> 我需要创建一个显示大量图像、视频和 Java 小程序的网站。RoR 会妨碍我这样做吗？

我不明白为什么应该这样做。有很多 gem 和插件可以帮助实现这种功能，因此很可能已经为您编写了很多代码。

> 我可以使用 PHP 框架。这是一个坏主意吗？如果不是，哪个 PHP 框架在编程方便性方面最接近 Rails。

我会让 PHP 专家回答这个问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-12T22:52:02.583

*   该项目应该在一个月内完成，而且时间非常紧迫。在 RoR 中学习和建立网站是否足够 1 个月？

如果它对时间敏感，请坚持你所知道的。也就是说，Rails 有很多插件来处理图像上传之类的事情，这可以节省你很多时间。Rails 有“脚手架生成器”，可以在单个命令中创建基本的 CRUD 应用程序：

```
./script/generate scaffold title:text description:text when:datetime 
```

..将生成控制器/视图来创建/编辑/删除项目。然后，您可以轻松地将看起来更好看的 HTML 包装在它周围，添加身份验证（通过[restful_authentication](http://agilewebdevelopment.com/plugins/restful_authentication)），并且您可能会在几个小时内完成您的应用程序。

*   编写直接 SQL 查询是我的优势之一，我想使用它。我听说如果我直接编写 SQL 查询，使用 RoR 会很痛苦。这是真的？或者我可以说执行一个查询，给我结果（作为一个列表或字典），然后我会告诉你如何呈现它们？

在极少数情况下您需要使用 ActiveRecord 编写 SQL，但您可以。**RoR 仍然是 Ruby 代码，所以如果你真的**需要编写原始 SQL ，你总是可以使用 MySQL 库并取消 ActiveRecord （但同样，你几乎肯定不需要）

*   我听说 RoR 确实加入了内存并且不使用数据库提供的设施。它是否正确？

没有理由 ActiveRecord 不能通过 SQL 查询执行 JOIN，[ActiveRecord::Associations::ClassMethods](http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html)提到通过 JOIN 执行的关联。

此外，即使它确实通过内存进行 JOIN，但无论 Rails 存在多久，它都运行良好。

*   我需要创建一个显示大量图像、视频和 Java 小程序的网站。RoR 会妨碍我这样做吗？

不，它们都只是 HTML 的一部分，Rails 可以像任何其他框架一样轻松地输出这些 HTML。

*   我可以使用 PHP 框架。这是一个坏主意吗？如果不是，哪个 PHP 框架在编程方便性方面最接近 Rails。

绝对地。如果您不使用 Rails，请使用 PHP 框架！

我建议不要根据“与 Rails 的接近程度”来选择框架。*PHP 不是 Ruby。*尝试（以某种方式）将框架“移植”到不同的语言很少像为该语言编写框架一样*有效*。

正如我对 Chuck 的回答所评论的那样，“CodeIgniter 和 Zend 是很好的 PHP 网络框架。CakePHP 是一个很好的 Ruby on Rails 模仿”..

我发现 CodeIgniter 感觉更像 PHP（以一种很好的方式），它的文档也是我用过的任何项目中我最喜欢的！

Zend 框架是非常模块化的，您可以将 Zend 的一部分放入现有的 PHP 应用程序中，或者使用它的 MVC 路由系统。

CakePHP 似乎试图让 PHP 像 Ruby 一样工作，而不是创建一个与 PHP 完美匹配的框架。

* * *

综上所述，您使用 Ruby on Rails 的原因是社区（以及所有围绕它的插件和东西）。

例如，[回形针](http://jimneath.org/2008/04/17/paperclip-attaching-files-in-rails/)插件使图像上传表单（以及缩略图）变得非常容易。要使用它，您添加（到您的模型）：

```
has_attached_file :photo, :styles => {:thumb=> "100x100#", :small  => "150x150>" } 
```

然后在您的视图中，您希望上传表单所在的位置，添加：

```
<% form_for :user, :html => { :multipart => true } do |f| %>
  <%= f.file_field :photo%>
<% end %> 
```

就是这样。

* * *

我建议花一天时间在 Rails 中做一些简单的事情。有无数很棒的教程（[Railscasts](http://railscasts.com/)是一个很好的、随机的例子）和大量的书籍。看看你喜不喜欢，如果不喜欢，试试 CodeIgniter、Zend 或 CakePHP（或 Django，或 Merb，或.... 只是不要花整个月时间去尝试框架！）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-12T21:49:52.637

由于您有一些 Python 经验，您有看过[Django](http://www.djangoproject.com)吗？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-12T21:59:04.150

Rails 非常适合 CRUD 的东西。

1 - 如果您已经熟悉 Ruby 和 MVC，一个月应该没问题。如果没有，还有很多东西要学。

2 - Rails 将允许您执行 SQL 查询，但它确实设置为利用 ActiveRecord。

3 - Rails 设计用于在数据库类型之间切换，因此 ActiveRecord 自己做了很多工作。查看 ActiveRecord 关联以获取更多信息。

4 - 从未尝试过 Java 小程序，但其余的工作正常。

5 - 如果您对 PHP 框架更满意，那根本不是一个坏主意。甚至有一些尝试复制许多 Rails 功能，例如 CodeIgniter。

查看[RailsGuides](http://guides.rubyonrails.org/)以更好地了解这一切。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-12T22:01:48.873

> 我可以使用 PHP 框架。这是一个坏主意吗？如果不是，哪个 PHP 框架在编程方便性方面最接近 Rails。

我猜 CakePHP 接近于 PHP 框架的 RoR。

我自己没有尝试过 Rails，但想知道它是否方便。据我所知（就像那个花了 2 年时间让 Rails 做一些不应该做的事情的人），当你需要做一些更复杂的事情时，你显然必须与框架抗争和破解。

还有其他适用于 Ruby、PHP 和 Python 的框架。我建议你在决定之前多看看周围。

如果你想用 PHP 编写代码，你可以试试 Symfony 和 Zend 框架。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-12T22:04:21.973

> 该项目应该在一个月内完成，而且时间非常紧迫。在 RoR 中学习和建立网站是否足够 1 个月？

可能是这样，但它也可能使你的事情变得不必要地困难。我通常会等待一个时间表宽松的项目来尝试学习一项新技术。如果时间紧迫，请找出您最喜欢的语言并完成它。

> 编写直接 SQL 查询是我的优势之一，我想使用它。我听说如果我直接编写 SQL 查询，使用 RoR 会很痛苦。这是真的？或者我可以说执行一个查询，给我结果（作为一个列表或字典），然后我会告诉你如何呈现它们？

我不是 Rails 开发人员，但我知道它使用 ActiveRecord。然而，我确信还有一种方法可以让它像大多数 ORM 一样执行原始查询。但是，就在那里，你违背了框架想要你做的事情，你可能会遇到问题。

> 我听说 RoR 确实加入了内存并且不使用数据库提供的设施。它是否正确？

任何为您抽象出事物的东西，尤其是数据库关系，都将远非有效。通常不需要事先担心它，一旦您的应用程序完成，通常的做法是识别任何特定的慢查询并在必要时手动重做它们。

> 我需要创建一个显示大量图像、视频和 Java 小程序的网站。RoR 会妨碍我这样做吗？

我不知道为什么会这样。

> 我可以使用 PHP 框架。这是一个坏主意吗？如果不是，哪个 PHP 框架在编程方便性方面最接近 Rails。

[CakePHP](http://cakephp.org/)是迄今为止最接近 RoR 的框架。它借鉴了很多想法。我过去使用它取得了一些成功。[CodeIgniter](http://codeigniter.com/)虽然与 Rails 无关，但如果您想要一些不会强迫您按照自己的方式做任何事情的轻量级的东西，它也很棒。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-13T03:37:49.923

[http://www.doctrine-project.org/](http://www.doctrine-project.org/)

我在 ORM 学说上取得了巨大的成功：如果您正在编写面向对象的 php，那么它会为您执行对象-> 数据库记录映射。AFAIK 这是 django / rails 框架的优点之一。

所以这链接了 oop/database 功能，如下所示：

```
$foo = new User(); // makes a new 'transitory' user object
$foo->name = 'bob'; // works like you'd expect
$foo->save(); // but this pushes it into the database.
  //(There's a 'name' column in the 'User' table already: set up when Doctrine initializes). 
```

& 如果你想要一个框架，它现在是 symfony 的一部分。

* * *

有一个真正的项目来学习新技术或方法是非常有动力的，但也有可能承担太多。它需要的时间是你了解技术的 5 倍。没关系 - 学习和结果可能是值得的。但听起来这在这里不合适。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-13T16:15:08.260

Rails 是一个很棒的框架，但是要在一个月的最后期限内同时学习该框架并更加熟悉特定于 Ruby 的构造，可能需要做很多事情。

要进入 Web 应用程序框架，如果您已经熟悉 PHP，我建议您使用 PHP 框架。虽然不是移植，但 CakePHP 与 Rails 非常相似。它以 Rails 为模型，是我最喜欢的 PHP 框架。symfony 是一个可靠的框架，但如果你正在寻找更多 Rails 风格的东西，我建议你试试 CakePHP。

如果您还没有使用 Rails 或类似的东西，我会推荐 Zend 框架。它是迄今为止可用于 PHP 的最全面的 Web 应用程序框架。

所有这些框架都将允许您完成您提到的所有事情。将它们视为一组精选的构建块可能比您使用插件扩展的网站的综合操作系统更容易。这将更类似于像 ExpressionEngine 这样的 CMS。您可以使用这些框架做任何事情，它们只是供您使用的代码库，以减少开发 Web 应用程序的繁琐。

Akelos 框架是一个声称是 Rails 端口的 PHP 框架，因此您可能也对此感兴趣。

至于编写 SQL 查询，可以使用任何 PHP 框架，但这些框架背后的理念是约定优于配置。每个都有自己的 ORM 方案，以将 SQL 查询从开发人员那里抽象出来。虽然这可能是由于许多 Web 开发人员（至少根据我的经验）害怕 SQL，但作为一个也喜欢编写 SQL 的人，我确实很欣赏 ORM 框架可以节省的大量时间。同样，在开发应用程序时，分析 ORM 的性能并寻找需要改进的地方几乎是标准做法。快速原型设计是 Web 应用程序框架的重要组成部分，因此像这样的工具实际上可能会成为您的障碍。就像其他人所说的那样，如果您只是在他们的设施周围工作，那么使用其中一个框架可能最终毫无意义。

如果您决定不使用其中之一，PHP 有大量成熟的项目可以帮助您构建应用程序，但是寻找这些项目并学习如何实现它们可能比学习框架要花更长的时间。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-12T23:00:25.190

IMO 一个月的学习和发布非常紧张（我假设你不是全职的），如果你也在学习，你就不会全职。当你变得更深时，你就会知道它是怎样的。

大约一个月前，我在 RoR 和 MVC 之间遇到了同样的困境。几周后（晚上学习），我对 RoR 框架有了足够的了解，但 ruby​​ 语言对我来说很新，客户想要交付，我仍处于“游乐场/沙盒”阶段

所以，因为我非常了解 c# 和 .net 框架，而且我可以快速找到资源，因为我对 MVC 开放并且在 2 周内我已经向客户交付了一些东西。

所以根据我的经验，学习 RoR 给它一个星期。如果您发现实际应用程序需要 40 多个小时才能开始，那么请坚持使用 PHP 并在您有更多时间和更少时间限制时执行 RoR。

不管怎样，祝你好运！！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-12T23:02:31.287

如果您对模型视图控制器结构感到满意，那么 Ruby on Rails 并不难学。我自己是从 PHP 的 Zend 框架到 Ruby on Rails 的，我真的觉得它很解脱。我喜欢 Rails 使用的约定优于配置的整个想法。它使您的应用程序（以及所有未来的应用程序）保持良好的结构，在我看来，这非常重要并且可以节省时间。

目前，我已经使用 Rails 使用 Ruby 编程大约 6-7 个月了，我真的很喜欢它。干净的代码，非常快速的开发，这真的令人难以置信。尤其是生成器文件和数据库迁移。

至于在编写原始查询时 RoR 是否会很痛苦，我不确定，我什至不必编写它们，但您肯定可以使用简单的方法。那应该不是问题。

一旦我开始使用 Ruby on Rails 开发 Web 应用程序，我就不想回到 PHP。纯粹是因为我非常喜欢 Rails 的工作方式、约定、快速开发、干净的代码、一致的结构等等等等。但是这些天我仍然时不时地被客户要求用 PHP 开发一个 Web 应用程序。但在我看来，如果我回到 Zend Framework，我可能真的会感到压力很大，因为我发现它效率极低。（这可能是我自己的错，我不确定，但在我看来，与 Rails 相比，嗯）。我发现了 PHP 框架“CakePHP”。据我所知，这个框架是最接近 Rails 的，我目前用它来开发 PHP 应用程序。它非常简单并且效果很好。它还有一个非常好的东西，叫做“食谱” 在他们的网站上，它可以帮助您快速启动和运行。因此，如果您要选择 PHP 框架，我个人会选择 CakePHP，因为它最接近 Rails。

我自己对 Rails 唯一有点恼火的是它需要安装特定版本的 Rails，并且该版本必须与特定版本的 Ruby 兼容。您需要掌握 Gems、Plugins 的窍门（老实说，这些并不难理解）。但是除了部署之外，如果您正在运行 Apache 2+，那么您需要Passenger。另外为了安全起见，您需要冻结您的 gem 和类似的东西，以避免与服务器规范和安装的实用程序发生冲突。

就 Ruby on Rails 而言，除了语言和框架之外，还有很多东西需要学习。PHP 非常简单，只需上传即可。因此，在开发应用程序之前，您可能还想了解这一点。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-13T00:51:15.703

我认为 Rails 很棒，它会是我在这样一个项目中的首选，但如果你实际上在紧迫的期限内，并且你是从 Rails 开始的，那就不要这样做。跟着你知道的走。PHP 可能不是最好的，但它是一种非常实用的语言。

尽管人们可能会说，Rails 确实有一个不平凡的学习曲线，特别是如果您不熟悉 MVC。肯定有一种“Rails 方式”来做事，并且来自大多数其他框架，需要一段时间才能理解。

我认为如果你试图匆忙学习 Rails，你只会感到沮丧，而且我担心这会影响你对它的印象。相反，试着在业余时间学习它，或者在一个时间线更宽松的项目上学习。我想你会从这种方式中得到更多。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-12T21:57:13.560

我认为增加在一个月内重写你已经知道的东西的复杂性 - 在一个时间敏感的项目上是一个坏主意。在任何“时间敏感”项目中，使用任何您不熟悉的框架/工具可能都是一个糟糕的选择。

话虽如此，用于 php 的[Zend_Framework](http://framework.zend.com/)的形式抽象非常可靠。我发现转向 ZF 比 RoR 更容易——我同时尝试了两者。

ZF 的文档是公平的——尽管阅读库的实际代码仍然是我最好的文档来源。学习或开始并不难——如果你不介意 IRC / stackoverflowing 问题，你应该能够很快学会它。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-12T22:15:55.717

不要仅仅因为它看起来很酷就登上 Rails 火车。我知道这几天每个人都在谈论它，但老实说，它真的没有那么特别，你最好使用用你熟悉的语言编写的框架。如果你真的很擅长 SQL，那么学习如何使用 ActiveRecord 比手工编写查询要花更长的时间，而且 ActiveRecord 基本上是 Rails 的一半，这有点违背了使用框架的目的。因此，根据您提供的背景信息，我会说使用像 CodeIgniter 这样的 PHP 框架（我自己没有使用过，但我听说它很棒，听起来像您需要的那样）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-12T23:08:56.800

> 该项目应该在一个月内完成，而且时间非常紧迫。在 RoR 中学习和建立网站是否足够 1 个月？

如前所述，如果截止日期很短，请坚持您所知道的。

> 我可以使用 PHP 框架。这是一个坏主意吗？如果不是，哪个 PHP 框架在编程方便性方面最接近 Rails。

[CakePHP](http://cakephp.org/)非常像 ruby​​，有人告诉我，它是 PHP 程序员进入 Ruby 和 MVC 的一个很好的垫脚石。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-05-21T16:53:12.840

使用 php + Zend 框架它具有 ror 的所有功能并且更快

ror 很慢，很贵，需要强大的服务器

> ```
> * The project should be done in a month and is very time sensitive. Is 1 month enough for learning with and building a website in RoR? 
> ```
> 
> 学习 Zend Framework 就够了
> 
> ```
> * Writing direct SQL queries is one of my strengths and I would like to use it. I heard that RoR is a pain to use if I am writing SQL queries directly. Is this true? Or can I just say execute a query, give me the results (as a list or dictionary) and then I will tell you how to render them? 
> ```

应该直接编写 SQL 查询，否则会进行非常慢且未优化的查询

> ```
> * I am OK using a PHP framework. Is this a bad idea? If not, which PHP framework is closest to Rails in terms of programming convenience. 
> ```
> 
> 你所需要的只是 mvc 框架，我为你提供 Zend 框架

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-06-12T13:12:34.150

对于 1 个月的项目，请使用您更了解的内容！到目前为止，我一直在使用 Qcodo 和 Qcubed，但您只能从数据库生成界面。任何 PHP 框架都使用 DSL。我喜欢 Python 作为语言，但从未使用过。我昨天在看 Ruby On Rails，它看起来很不错。RoR 提供了一种编写敏捷 Web 应用程序的新方法，但现在也有了 grails。Grails 是用 Groovy 编写的，在 JVM 上运行并且是动态语言。Grails 的优势在于可以使用任何 Java 代码和框架，但具有动态语言的简单性。使用 Grails，您可以做与 Rails 相同的事情，甚至更多。

我的建议，使用你更了解的东西，同时学习 Grails，这就是我现在正在做的事情。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-01-03T04:41:13.443

> 在 RoR 中学习和建立网站是否足够 1 个月？

是的。

> 编写直接 SQL 查询是我的优势之一，我想使用它。我听说如果我直接编写 SQL 查询，使用 RoR 会很痛苦。这是真的？或者我可以说执行一个查询，给我结果（作为一个列表或字典），然后我会告诉你如何呈现它们？

使用 Rails 编写原始 sql 并不比使用 PHP 更难。返回的对象将是列名/值对的哈希。如果您决定开始使用返回 ActiveRecord 对象（不是普通哈希）的 ActiveRecord，则可能会出现唯一的问题

> 我听说 RoR 确实加入了内存并且不使用数据库提供的设施。它是否正确？

如果您使用原始 sql，Rails 不应该干扰它。

> 我需要创建一个显示大量图像、视频和 Java 小程序的网站。RoR 会妨碍我这样做吗？

不。

> 我可以使用 PHP 框架。这是一个坏主意吗？如果不是，哪个 PHP 框架在编程方便性方面最接近 Rails。

身份证。

我真的很喜欢使用 ActiveRecord，但如果您更喜欢原始 sql，Rails 仍然值得使用。在编写 Ruby 时，您将获得良好的 url 处理、大量内置安全性、漂亮的 MVC 架构和漂亮的模板系统，这对许多人来说是一次很好的体验。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-12-06T16:08:14.233

不错的线程-每个人都在这里发表了一些很棒的评论。这对我很有用。

# json - 带有斜线的 JSON 对象

> ID：855029
> 
> 赞同：0
> 
> 时间：2009-05-12T21:46:15.343
> 
> 标签：json, serialization, javascriptserializer

我正在使用以下方法序列化为 json 对象：

```
public static string ToJson(this object obj)
{
    JavaScriptSerializer jsonSerializer = new JavaScriptSerializer();
    return jsonSerializer.Serialize(obj);
} 
```

但是，当我填充隐藏字段时，我会得到斜线：

> "[{\"ImageLink\":\"\",\"ShowOnHomePage\":null,\"Type\":\"AdListItem\",\"Key\":null,\"Title\":\" dsafdsaf\",\"Url\":\"fdsafdsa\",\"ContentSummary\":\"\u003cdiv\u003efdsafdsa\u003c/div\u003e\"},{\"ImageLink\":\"\", \"ShowOnHomePage\":null,\"Type\":\"AdListItem\",\"Key\":null,\"Title\":\"hddfg\",\"Url\":\"dsaf\ ",\"ContentSummary\":\"\u003cdiv\u003efdsafdsa\u003c/div\u003e\"},{\"ImageLink\":\"\",\"ShowOnHomePage\":null,\"Type\": \"AdListItem\",\"Key\":null,\"Title\":\"asfd\",\"Url\":\"asdf\",\"内容摘要\":\"\u003cdiv\u003eafds\u003c/div\u003e\"}]"

我将如何正确摆脱 \" 并将它们替换为 " ???

有任何想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T22:03:19.573

斜杠是 Javascript 字符串转义字符。

\" -> " 所以你可以在引号中加上引号。

这适用于大多数 C 风格的语言（C、C++、C#、Java 等）

# asp.net-mvc - 帮助 Linq to Sql

> ID：855030
> 
> 赞同：0
> 
> 时间：2009-05-12T21:46:28.447
> 
> 标签：asp.net-mvc, linq-to-sql

为什么我在 ApplyPropertyChanges 时会出现异常？？？

当我编辑用户表但不使用我的新闻表时，代码几乎相同。

创建、删除和详细信息都工作正常，但是当我尝试编辑新闻时，出现以下异常：

**ObjectStateManager 不包含 ObjectStateEntry 'MagixCMS.Models.noticia'**

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace MagixCMS.Models
{
    public class NoticiaRepository : INoticiaRepository
    {
        #region INoticiaRepository Members

        magixcmsEntities _entities = new magixcmsEntities();

        public noticia CreateNoticia(noticia noticiaToCreate)
        {
            _entities.AddTonoticiaSet(noticiaToCreate);
            _entities.SaveChanges();
            return noticiaToCreate;
        }

        public void DeletaNoticia(noticia noticiaToDelete)
        {
            var noticiaOriginal = GetNoticia(noticiaToDelete.Id);
            _entities.DeleteObject(noticiaOriginal);
            _entities.SaveChanges();
        }

        public noticia EditNoticia(noticia noticiaToEdit)
        {
            var noticiaOriginal = GetNoticia(noticiaToEdit.Id);
            _entities.ApplyPropertyChanges(noticiaToEdit.EntityKey.EntitySetName, noticiaToEdit); //EXCEPTION HERE
            _entities.SaveChanges();
            return noticiaToEdit;
        }

        public noticia GetNoticia(int id)
        {
            return (from c in _entities.noticiaSet where c.Id == id select c).FirstOrDefault();
        }

        public IEnumerable<noticia> ListNoticias()
        {
            return _entities.noticiaSet.ToList();
        }

        #endregion
    }
} 
```

我用谷歌搜索异常并没有找到太多帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T01:41:05.720

我解决它。

问题出在 EF 模型上。

要解决它，您需要一个扩展方法来持久化您的数据：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Data.Objects;
using System.Data.Objects.DataClasses;

namespace MagixCMS.Models
{
    public static class Extensions
    {
        public static void Update(ObjectContext context, string entitySetName, IEntityWithKey entity)
        {
            entity.EntityKey = context.CreateEntityKey(entitySetName, entity);
            context.Attach(entity);
            var stateEntry = context.ObjectStateManager.GetObjectStateEntry(entity.EntityKey);
            var propertyNameList = stateEntry.CurrentValues.DataRecordInfo.FieldMetadata.Select(pn => pn.FieldType.Name);
            foreach (var propName in propertyNameList)
            {
                stateEntry.SetModifiedProperty(propName);
            }
        }
    }
} 
```

在 Edit 方法中，您可以：

```
public noticia EditNoticia(noticia noticiaToEdit)
{
    //GET THE CONTEXT FOR THE ENTITY
    ObjectContext _context = this._entities.noticiaSet.Context;
    var noticiaOriginal = GetNoticia(noticiaToEdit.Id);
    //UPDATE THE ORIGINAL ENTITY WITH THE NEW VALUES
    Extensions.Update(_context, noticiaOriginal.EntityKey.EntitySetName, noticiaToEdit);
    //PERSIST THE DATA
    _entities.SaveChanges();
    return noticiaToEdit;
} 
```

# jdbc - 是否有适用于 DB2 v6 的 JDBC Type 4 驱动程序？

> ID：855037
> 
> 赞同：0
> 
> 时间：2009-05-12T21:47:08.320
> 
> 标签：jdbc, db2

DB2 UDB v6 是否支持 JDBC Type 4 驱动程序？

我在哪里可以得到那个 JDBC Type 4 驱动程序？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T16:50:58.687

我认为是的，但不是很确定。由于 V6 不支持，您很可能无法从 IBM 获得它。您可能需要在内部检查以查看他们是否有任何驱动程序副本。检查以下链接以获取一些有用的信息 [http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp](http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp)

# c# - 将 collection.foreach 从 c# 转换为 VB.Net

> ID：855043
> 
> 赞同：2
> 
> 时间：2009-05-12T21:48:15.807
> 
> 标签：c#, vb.net, subsonic, foreach

在 C# 中，我只是将要在集合的每一行上运行的方法放在括号中，但它在 VB.NET 中不起作用。

前任：

```
SubSonic.PartCollection Parts;
...
Parts.ForEach(TestMethod); 
```

我已经在 VB.Net 中尝试过，但它没有编译，我不太确定我错过了什么。

```
Dim Parts as SubSonic.PartCollection
...
parts.ForEach(TestMethod) 
```

如果我将它拆开并手动进行，它会起作用：

```
for each p as SubSonic.Part in Parts
    TestMethod(p)
next 
```

我只是想把事情清理一下

谢谢托尼·W

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-12T21:53:13.303

试试这个：

```
parts.ForEach(AddressOf TestMethod) 
```

事实上，ForEach 方法接受 Action<T> 类型的委托，您应该使用 AddressOf 将指针传递给 VB.NET 中的给定方法

# c# - 将 System.Windows.Input.KeyEventArgs 键转换为 char

> ID：855047
> 
> 赞同：11
> 
> 时间：2009-05-12T21:49:08.333
> 
> 标签：c#, wpf, keyeventargs

我需要将事件 args 作为 a `char`，但是当我尝试投射 Key 枚举时，我得到的字母和符号与传入的完全不同。

你如何正确地将密钥转换为字符？

这是我尝试过的

```
ObserveKeyStroke(this, new ObervableKeyStrokeEvent((char)((KeyEventArgs)e.StagingItem.Input).Key)); 
```

编辑：我也没有 args 上的 KeyCode 属性。我从 InputManager.Current.PreNotifyInput 事件中获取它们。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-12T22:47:19.207

请参阅[如何将字符转换为等效的 System.Windows.Input.Key 枚举值？](https://stackoverflow.com/questions/544141/how-to-convert-a-character-in-to-equivalent-system-windows-input-key-enum-value) 改为使用`KeyInterop.VirtualKeyFromKey`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-05T19:22:55.093

这需要一点时间来适应，但您可以自己使用键值。如果您试图将输入限制为字母数字，也许还有一些额外的输入，下面的代码可能会有所帮助。

```
 private bool bLeftShiftKey = false;
    private bool bRightShiftKey = false;

    private bool IsValidDescriptionKey(Key key)
    {
        //KEYS ALLOWED REGARDLESS OF SHIFT KEY

        //various editing keys
        if (
        key == Key.Back ||
        key == Key.Tab ||
        key == Key.Up ||
        key == Key.Down ||
        key == Key.Left ||
        key == Key.Right ||
        key == Key.Delete ||
        key == Key.Space ||
        key == Key.Home ||
        key == Key.End
        ) {
            return true;
        }

        //letters
        if (key >= Key.A && key <= Key.Z)
        {
            return true;
        }

        //numbers from keypad
        if (key >= Key.NumPad0 && key <= Key.NumPad9)
        {
            return true;
        }

        //hyphen
        if (key == Key.OemMinus)
        {
            return true;
        }

        //KEYS ALLOWED CONDITITIONALLY DEPENDING ON SHIFT KEY

        if (!bLeftShiftKey && !bRightShiftKey)
        {
            //numbers from keyboard
            if (key >= Key.D0 && key <= Key.D9)
            {
                return true;
            }
        }

        return false;
    }

    private void cboDescription_PreviewKeyDown(object sender, KeyEventArgs e)
    {
        if (e.Key == Key.LeftShift)
        {
            bLeftShiftKey = true;
        }

        if (e.Key == Key.RightShift)
        {
            bRightShiftKey = true;
        }

        if (!IsValidDescriptionKey(e.Key))
        {
            e.Handled = true;
        }
    }

    private void cboDescription_PreviewKeyUp(object sender, KeyEventArgs e)
    {
        if (e.Key == Key.LeftShift)
        {
            bLeftShiftKey = false;
        }

        if (e.Key == Key.RightShift)
        {
            bRightShiftKey = false;
        }
    } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-09-25T21:12:23.947

这对我有用：

根据最后一个条目，我发现在 WPF 中没有这样的事件`PreNotifyInput`，但我发现和等价的`PreviewTextInput`

首先我尝试使用 a `RegExp`，但我无法使其工作，然后我使用简单的`indexOf`.

```
private bool ValidChar(string _char)
{
   string Lista = @" ! "" # $ % & ' ( ) * + , - . / 0 1 2 3 4 5 6 7 8 9 : ; < = > ? @ A B C D E F G H I J K L M N O P Q R S T U V W X Y Z ";
   return Lista.IndexOf(_char.ToUpper()) != -1;
   //System.Text.RegularExpressions.Regex RegVal = new System.Text.RegularExpressions.Regex(@"(?<LETRAS>[A-Z]+)+(?<NUMERO>[0-9]+)+(?<CAR>[!|""|#|$|%|&|'|(|)|*|+|,|\-|.|/|:|;|<|=|>|?|@]+)+");
   //return RegVal.IsMatch(_char);
}

private void textBoxDescripcion_PreviewTextInput(object sender, TextCompositionEventArgs e)
{
    if (!ValidChar(e.Text))
         e.Handled = true;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-02-26T16:06:25.383

我知道这很旧，但似乎没有一个答案能真正回答这个问题。不同字符返回的原因是，当您尝试将其转换为 a 时，您会将`char`枚举值转换为“字符”。然而：

```
var keyPressed = e.key.ToString(); 
```

效果很好。将按下的键作为字符串返回。然后检查长度。如果它是 == 1，那么它是一个字符、数字或符号。如果大于 1，则为特殊键。

如果你只想要 char 你可以这样做`keyPressed[0];`

我就是这样做的。

```
private void scrollViewer_KeyDown(object sender, KeyEventArgs e)
{
    if (!e.IsRepeat)
    {
        var keyPressed = e.Key.ToString();
        if(keyPressed.Length == 1)
            CharKeyPressed(keyPressed[0]);
        else if(keyPressed.Length > 1)
            HandleSpecialKey(keyPressed)
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-03T17:10:03.957

在您的 PreNotifyInput 处理程序中，尝试以下操作：

```
if (e.StagingItem.Input is System.Windows.Input.TextCompositionEventArgs)
{
    if (!String.IsNullOrEmpty((e.StagingItem.Input as System.Windows.Input.TextCompositionEventArgs).Text))
    {
        Char c = (e.StagingItem.Input as System.Windows.Input.TextCompositionEventArgs).Text[0];
    }
} 
```

它会针对不同的路由事件引发多次，因此您可能需要过滤特定的事件。

# .net - 数据绑定网格视图时出现无效的回发错误

> ID：855051
> 
> 赞同：2
> 
> 时间：2009-05-12T21:50:20.063
> 
> 标签：.net, validation, gridview, events, postback

我真的很讨厌这个错误，因为它很难确定。

在这种情况下，我有一个带有用户控件的页面，其中包含一个网格视图。单击按钮以查看网格视图中的一条记录时，会打开一个弹出窗口（以模式对话框的形式），允许用户编辑字段。然后，当弹出窗口关闭时，按钮的服务器端代码被触发，最终导致一行代码调用 GridView1.databind();。当这行代码被触发时，我会得到无效的回发错误。如果这一行被注释掉，我不会得到错误。无论我是否真的在弹出窗口中进行任何更改，都会发生这种情况。并且在任何时候都没有客户端代码修改我的控件中的值。

因此，它不喜欢的 gridview 似乎发生了一些变化。我认为这可能与它使用的 ObjectDataSource 有关。我注意到在 gridview 数据绑定之前，ODS InputParameters 是使用 Session 值设置的。无论如何，那里发生了一些变化，导致了这个错误。所以，我试着做：

```
protected override void Render(System.Web.UI.HtmlTextWriter writer)
{
    Page.ClientScript.RegisterForEventValidation(GridView1.UniqueID);
    base.Render(writer);
} 
```

我也尝试注册 ODS。但是这两种方法都没有解决我的问题。

我应该怎么办？在这一点上，我完全被难住了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-04-07T17:47:11.057

我很确定无效的回发错误来自于您在 Page_Load 中调用数据绑定函数。

# coldfusion - 这个 cfqueryparam 内存泄漏有解决方案吗？

> ID：855066
> 
> 赞同：4
> 
> 时间：2009-05-12T21:54:26.547
> 
> 标签：coldfusion, cfqueryparam

**更新：**

*   我已将错误提交给 Adob​​e 并引用了这个 SO question

*   在发生问题的实际代码中，我决定只删除对 cfqueryparam 的使用。我现在使用自定义函数来根据类型格式化参数。我将不得不处理安全和速度方面的问题，但它可以让特定进程在当前负载下可接受地工作。

*   将来，我计划将数据文件拉入数据库中的临时表中。然后我将尽可能使用 SQL 对数据执行操作并将数据传输到实时表，而不是依赖 ColdFusion

* * *

我在插入数据时使用 cfqueryparam 标记循环查询时遇到问题。（我没有测试过选择或更新查询）。循环逐渐占用更多内存，直到请求完成才释放。但是，仅当在函数中循环查询时才会出现此问题。

它似乎对使用的 cfqueryparam 标记的数量非常敏感。在此示例中，插入了 15 个值，但是在我的代码中实际上需要它才能工作，我正在插入未知数量的值，这会使问题更加严重。

下面是显示问题的代码。给它一个数据源名称（在 MSSQL 上测试），它将创建一个 tmp 表并插入记录作为示例，无论是否在函数中。内存使用情况显示在非函数循环之前、之后、函数内循环之后。它还请求垃圾收集并在输出内存信息之前等待 10 秒，以确保它尽可能准确地显示信息。

根据我对这个特定测试的经验，函数内循环导致使用了超过 200mb 的内存。在我的现实世界中使用它会使 ColdFusion 崩溃 :-(

```
<cfsetting enablecfoutputonly="true">
<cfsetting requesttimeout="600">

<cfset insertCount = 100000>
<cfset dsn = "TmpDB">

<cfset dropTmpTable()>
<cfset createTmpTable()>

<cfset showMemory("Before")>
<cfflush interval="1">

<cfloop from="1" to="#insertCount#" index="i">
    <cfquery name="testq" datasource="#dsn#">
        INSERT INTO tmp ( [col1],[col2],[col3],[col4],[col5],[col6],[col7],[col8],[col9],[col10],[col11],[col12],[col13],[col14],[col15] )
        VALUES ( <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR"> )
    </cfquery>
</cfloop>

<cfset showMemory("After Non-Function INSERTS")>
<cfflush interval="1">

<cfset funcTest()>

<cfset showMemory("After Function based INSERTS")>

<cfset dropTmpTable()>

<cffunction name="funcTest" output="false">
    <cfset var i = 0>
    <cfset var testq = "">
    <cfloop from="1" to="#insertCount#" index="i">
        <cfquery name="testq" datasource="#dsn#">
            INSERT INTO tmp ( [col1],[col2],[col3],[col4],[col5],[col6],[col7],[col8],[col9],[col10],[col11],[col12],[col13],[col14],[col15] )
            VALUES ( <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR">, <cfqueryparam value="TestValue" cfsqltype="CF_SQL_CHAR"> )
        </cfquery>
    </cfloop>
</cffunction>

<cffunction name="showMemory" output="true">
    <cfargument name="label" required="true">

    <cfset var runtime = "">
    <cfset var memoryUsed = "">
    <cfset requestGC("10")>
    <cfset runtime = CreateObject("java","java.lang.Runtime").getRuntime()>
    <cfset memoryUsed = (runtime.totalMemory() - runtime.freeMemory()) / 1024 / 1024>
    <cfoutput>
        <h2>#arguments.label#</h2>
        Memory Used: #Round(memoryUsed)#mb
    </cfoutput>
</cffunction>

<cffunction name="requestGC">
    <cfargument name="waitSeconds" required="false" default="0" type="numeric">
    <cfscript>
        createObject("java","java.lang.Runtime").getRuntime().gc();
        createObject("java", "java.lang.Thread").sleep(arguments.waitSeconds*1000);
    </cfscript>
</cffunction>

<cffunction name="dropTmpTable" output="false">
    <cftry>
        <cfquery datasource="#dsn#">
            DROP TABLE tmp
        </cfquery>
        <cfcatch type="database"></cfcatch>
    </cftry>
</cffunction>

<cffunction name="createTmpTable" output="false">
    <cfquery datasource="#dsn#">
        CREATE TABLE tmp(
            col1 nchar(10) NULL, col2 nchar(10) NULL, col3 nchar(10) NULL, col4 nchar(10) NULL, col5 nchar(10) NULL, col6 nchar(10) NULL, col7 nchar(10) NULL, col8 nchar(10) NULL, col9 nchar(10) NULL, col10 nchar(10) NULL, col11 nchar(10) NULL, col12 nchar(10) NULL, col13 nchar(10) NULL, col14 nchar(10) NULL, col15 nchar(10) NULL
        )  ON [PRIMARY]
    </cfquery>
</cffunction> 
```

只是为了说明可以在操作期间释放内存，下面是示例代码，它构建了一个更大的结构，并显示了在变量被覆盖和垃圾收集之前和之后使用的内存。在我运行此内存后，填充为 118mb，覆盖和垃圾收集后为 31mb。

```
<cfset showMemory("Before struct creation")>
<cfflush interval="1">

<cfset tmpStruct = {}>
<cfloop from="1" to="1000000" index="i">
    <cfset tmpStruct["index:#i#"] = "testvalue testvalue testvalue testvalue testvalue testvalue testvalue testvalue testvalue testvalue">
</cfloop>

<cfset showMemory("After struct population")>
<cfflush interval="1">

<cfset tmpStruct = {}>
<cfset showMemory("After struct overwritten")> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-12T22:43:01.210

你在Administrator中有调试吗？

如果是这样，即使你有`showdebugoutput="false"`，CF 也会保留所有这些查询的调试信息，并且有这么多查询，调试信息可以快速建立。

此外，如果您确实有 80,000 行要插入，您可能希望以不同的方式执行此操作 - 例如生成直接针对 DB 运行的导入脚本（没有 CF/JDBC 妨碍）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T07:09:48.823

也许[多个插入](http://blog.sqlauthority.com/2007/06/08/sql-server-insert-multiple-records-using-one-insert-statement-use-of-union-all/)可以帮助？这种技术本身通常工作得更快，节省一些时间可以帮助您节省一些内存。

是的，我已经看到您的注释“插入未知数量的值”，但是如果您在单个插入批次中有恒定数量的字段/值，这应该可以工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-12T23:14:18.943

不知道它是否会有所作为，但可以尝试一下 - 缩小函数内循环，并多次循环该函数。

这对内存的作用可能有助于缩小内存的使用范围。

```
<cffunction name="funcTest" output="false">
    <cfargument name="from" />
    <cfargument name="to" />
    <cfset var i = 0>
    <cfset var testq = "">
    <cfloop from="#arguments.from#" to="#arguments.to#" index="i">
        <cfquery name="testq" datasource="#dsn#">
            ...
        </cfquery>
    </cfloop>
</cffunction>

<cfset BlockSize = 100 />
<cfloop index="CurBlock" from="1" to="#(InsertCount/BlockSize)#">

    <cfset funcTest
        ( from : CurBlock*(BlockSize-1) + 1
        , to   : CurBlock*BlockSize
        )/>

</cfloop> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-01-26T16:42:51.270

我遇到了类似的问题。

[http://misterdai.wordpress.com/2009/06/24/when-not-to-use-cfqueryparam/](http://misterdai.wordpress.com/2009/06/24/when-not-to-use-cfqueryparam/)

方法取决于几件事。如果您可以信任数据，请不要使用 cfqueryparam，这会大大减少内存使用量。从那里，尽可能减少 SQL。我每行都在做相当多的数据库工作，所以我创建了一个存储过程。对抗内存使用的最大好处是缓冲对数据库的 SQL 调用。创建一个数组，将您的 SQL 附加到它，然后每 50 行（测试后的个人选择）在 CfQuery 标记内的数组上执行一个 ArrayToList。这将数据库流量限制为更少但更大，而不是许多较小的流量。

毕竟，事情对我有用。但我仍然认为 ColdFusion 确实无法胜任这类任务，如果可能的话，更多的是数据库服务器本身的域。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T13:21:56.623

我的第一个猜测是在您的 cfqueryparam 中输入值 - 如 type="CF_SQL_CHAR"。为什么会有帮助？我不确定，但我可以猜测非类型变量会产生额外的开销。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-14T02:40:57.437

假设您使用的是 CF8……不确定这是否发生在 CF7 中……

尝试在您的数据源“高级设置”中关闭“Max Pooled Statements”（将其设置为零）......我敢打赌你的内存泄漏会消失......

这就是我发现错误的地方......这导致一些CF服务器上的各种崩溃，直到我们发现这个......我们现在稳定了100％......因为这个......

帕特里克·斯泰尔

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-13T12:46:23.967

尝试添加“变量”。在您的 cffunctions 中的每个查询之前。我有一个类似的问题，这解决了它。

所以改变：

```
<cfquery name="testq" datasource="CongressPlus"> 
```

到

```
<cfquery name="variables.testq" datasource="CongressPlus"> 
```

干杯，

托马斯

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-13T14:16:32.650

整个社区都有很好的记录，CF 在请求完成之前不会释放内存。即使直接调用 GC 也不会影响在运行请求期间释放内存。不知道这是设计使然还是错误。

我不知道为什么你甚至想在 CF 中做这样的事情。无论您使用哪种数据库引擎，都没有理由使用 CF 将 80K 行插入数据库。

现在，如果您有需要这样做的原因，例如您从上传的 CSV 或 XML 文件中获取数据；MSSQL 有很多更好的方法和解决方法。

多年来我采用的一种方法是在 MSSQL 中创建一个存储过程，该过程调用[BCP](http://msdn.microsoft.com/en-us/library/aa174646.aspx)或[BULK INSERT](http://msdn.microsoft.com/en-us/library/aa225968.aspx)来读取包含要插入的数据的文件。

这种方法最好的一点是，CF 唯一要做的就是处理文件上传，而 MMSQL 正在处理文件的所有工作。MSSQL 使用 BCP 或 BULK INSERT 插入数百万行没有问题，并且将**无限**快于 CF 可以处理的任何内容。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-11-06T17:50:50.500

在大型查询循环中防止 cfqueryparam 内存泄漏的方法是不使用 cfqueryparam。然而，更广泛的答案是避免 CF 的低效率和内存泄漏是在这些情况下不使用 CF。我当时将特定过程的负载达到了可接受的水平，但从长远来看，我会用另一种语言重写它，可能是直接在数据库引擎中的 C#。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-12-02T17:14:30.440

我不知道这是否能解决您的问题，但是当我有多个这样的插入时，我通常会做的是 SQL 语句本身的循环，而不是整个 cfquery。

因此，与其拥有：

```
<cfloop from="1" to="#insertCount#" index="i">
    <cfquery name="testq" datasource="#dsn#">
        ...
    </cfquery>
</cfloop> 
```

我愿意 ：

```
<cfquery name="testq" datasource="#dsn#">
    <cfloop from="1" to="#insertCount#" index="i">
        ...
    </cfloop>
</cfquery> 
```

因此，您只有一个大的，而不是多次调用数据库。

我不知道这会如何影响您的内存泄漏问题，但我从未经历过任何内存泄漏。

# cocoa - IBOutlet 未在 Cocoa MVC 项目中设置

> ID：855068
> 
> 赞同：1
> 
> 时间：2009-05-12T21:54:35.517
> 
> 标签：cocoa, interface-builder, model-view-controller

我可能没有正确使用 IBOutlet，或者其他一些关于 NIB 文件工作方式的微妙之处给我带来了麻烦 - 任何帮助都将不胜感激（请随时提出另一种方法来完成我想要的事情）。

我有一个 View 对象和一个 Controller 对象。两者都在NIB中。当加载 NIB 并在 'awakeFromNib' 回调中初始化 View 时，也会调用 Controller 的 init。我需要一种方法来连接这两个对象 - 具体来说，启用“视图”对象来调用控制器上的函数。

根据在线文档，实现这些连接的方法是在 View 中定义一个 IBOutlet 并将其连接到 Interface Builder 中的 Controller。所以我创建了一个

```
IBOutlet Controller* _controller; 
```

在 View 界面中并通过从 View 到 Controller 的连接并将 _controller 出口分配给 Controller（Interface Builder 中的蓝色 Generic Object 框）以图形方式将其连接到 Interface Builder 中的 Controller 对象。

但在运行时，_controller 始终为 _nil。我已经验证了控制器的 init 确实被调用了。

我对此有什么明显的遗漏吗？有没有更简单的方法来连接这两者？由于它们都是由 NIB 创建的，因此我没有一个指向两者的公共对象。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-12T22:00:38.173

尝试访问`IBOutlet`instad `viewDidLoad`。

当`awakeFromNib`被调用时，并不是所有的`IBOutlets`都被填充（即使文档似乎暗示了它）。

# javascript - 将脚本放在网页底部会加速页面加载吗？

> ID：855077
> 
> 赞同：26
> 
> 时间：2009-05-12T21:58:16.150
> 
> 标签：javascript

雅虎最佳实践指出，[将 JavaScript 文件放在底部](http://developer.yahoo.com/performance/rules.html#js_bottom)可能会使您的页面加载得更快。有什么经验？有什么副作用，如果有的话？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-12T22:04:44.033

它有几个优点：

*   **渲染开始得更快。**浏览器无法布局它尚未收到的元素。这避免了“空白屏幕”问题。

*   **延迟连接限制。**通常，您的浏览器一次不会尝试与同一服务器建立多个连接。如果您有一整个脚本队列等待从慢速服务器下载，它会真正破坏用户体验，因为您的页面似乎停止运行。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-12T22:19:50.967

如果您获得 Microsoft 的[Visual Round Trip Analyzer](http://www.microsoft.com/Downloads/details.aspx?FamilyID=119f3477-dced-41e3-a0e7-d8b5cae893a3&displaylang=en)的副本，您可以准确地分析正在发生的事情。

我经常看到的是，大多数浏览器在遇到 JavaScript 文件时会**停止流水线请求，并将整个连接专用于下载单个文件，而不是并行下载。**

流水线停止的原因是允许立即将脚本包含到页面中。从历史上看，很多网站使用 document.write 来添加内容，然后立即下载脚本可以获得稍微更无缝的体验。

这无疑是雅虎正在优化的行为。（我在 MSDN 杂志上看到了与上述解释完全相同的推荐。）

重要的是要注意 IE 7+ 和 FF 3+​​ 不太可能表现出不良行为。（主要是因为使用 document.write 已经过时了，现在有更好的方法来预渲染内容。）

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-12T21:59:36.460

据我所知，它只是让浏览器更快地开始渲染。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-12T22:05:46.480

一个副作用是，如果将某些脚本放在页面末尾，它们根本不起作用。如果在呈现页面时运行的脚本（例如广告脚本很常见）依赖于另一个脚本中的函数，则必须首先加载该脚本。

此外，说页面加载速度更快也不是事实。它真正做的是更早地加载页面的视觉元素，这样看起来你的页面加载速度更快。加载页面所有组件的总时间仍然相同。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-12T23:17:14.727

将它们放在底部几乎等同于使用[“延迟”](http://www.w3.org/TR/REC-html40/interact/scripts.html#adef-defer)属性（更多信息[在这里](http://www.websiteoptimization.com/speed/tweak/defer/)）。这类似于浏览器无法继续页面布局，除非 IMG 标签具有宽度和高度信息——如果包含的 javascript 生成内容，则浏览器无法继续布局，直到它知道那里有什么，以及所有内容有多大.

只要您的 javascript 不需要在 onload 事件发生之前运行，您就应该能够将脚本标签放在末尾，或者使用 defer 属性。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-12T22:22:21.820

您的页面实际上应该加载得更快。例如，浏览器将打开多个连接以并行下载三个图像。另一方面，`<script>`大多数浏览器中的标签会导致浏览器阻止该脚本的执行。如果它是一个`<script>`带有 src 属性的标签，浏览器将阻止下载和执行。如果你把你的`<script>`标签放在最后，你就可以避免这个问题。

同时，这意味着这些页面在加载完成之前没有任何 JS 功能。一个很好的可访问性练习是确保您的网站运行良好，以便在 JS 加载之前可用。这可以确保页面 (a) 适合连接速度较慢的人 (b) 适合有障碍或使用纯文本浏览器的人。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-13T05:43:29.837

如果您正在为 firefox/safari 开发，您可以随时检查 firebug/developer 控制台，因为它们会显示文件的加载顺序

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-07-08T13:00:43.093

有几点。

1.  由于 JavaScript 内部或外部位于底部，因此它加载页面速度很快。

2.  如果您没有在 JavaScript 中使用 window 的**onLoad** 方法，它将在渲染后立即开始执行。底部的脚本确保您的脚本将在页面加载后执行。

3.  如果脚本作为文件表示外部，则将在 HTML 图像和形成页面视图的其他视觉对象之后呈现。

如果您使用的是 fireFox，那么有一个插件可以检查性能。请务必访问该插件的 Firefox 站点。

# apache-flex - 从 Flash 电影动态加载 Flash 电影

> ID：855081
> 
> 赞同：2
> 
> 时间：2009-05-12T21:59:19.220
> 
> 标签：apache-flex, flash, actionscript-3, flex3

我有 2 个 mxml 文件，比如说 main.mxml 和 child.mxml。现在假设我想在 main.mxml 中加载 child.mxml 并将一个复杂对象作为参数传递给它。我将如何在 AS3/Flex 3 中执行此操作？

我曾尝试在 Google 和 SO 上搜索此内容，但要么我没有使用正确的关键字进行搜索，要么没有信息（不太可能）。

干杯

编辑：我不是在寻找要 JIT 编译的 mxml，将已编译的 mxml 加载为 swf 就可以了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T00:24:44.753

您想使用模块来做到这一点。您可以将 main.mxml 保留为您的根应用程序，但 child.mxml 需要定义一个模块组件。然后，您可以使用 ModuleLoader 加载子应用程序。这是一个开始的好地方：

[http://livedocs.adobe.com/flex/3/html/help.html?content=modular_2.html](http://livedocs.adobe.com/flex/3/html/help.html?content=modular_2.html)

# python - Beautiful Soup 的 extract() 出错

> ID：855087
> 
> 赞同：0
> 
> 时间：2009-05-12T22:00:29.907
> 
> 标签：python, beautifulsoup

我正在开发一些屏幕抓取软件，但遇到了 Beautiful Soup 的问题。我正在使用 python 2.4.3 和 Beautiful Soup 3.0.7a。

我需要删除一个`<hr>`标签，但它可以有许多不同的属性，所以一个简单的 replace() 调用不会删除它。

给定以下html：

```
<h1>foo</h1>
<h2><hr/>bar</h2> 
```

以及以下代码：

```
soup = BeautifulSoup(string)

bad_tags = soup.findAll('hr');
[tag.extract() for tag in bad_tags] 

for i in soup.findAll(['h1', 'h2']):
    print i
    print i.string 
```

输出是：

```
<h1>foo</h1>
foo
<h2>bar</h2>
None 
```

我是否误解了提取功能，或者这是 Beautiful Soup 的错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T23:58:12.850

这可能是一个错误。但幸运的是，还有另一种获取字符串的方法：

```
from BeautifulSoup import BeautifulSoup

string = \
"""<h1>foo</h1>
<h2><hr/>bar</h2>"""

soup = BeautifulSoup(string)

bad_tags = soup.findAll('hr');
[tag.extract() for tag in bad_tags] 

for i in soup.findAll(['h1', 'h2']):
    print i, i.next

# <h1>foo</h1> foo
# <h2>bar</h2> bar 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-04-22T13:23:06.087

我有同样的问题。我不知道为什么，但我想这与 BS 创建的空元素有关。

例如，如果我有以下代码：

```
from bs4 import BeautifulSoup

html ='            \
<a>                \
    <b test="help">            \
        hello there!  \
        <d>        \
        now what?  \
        </d>    \
        <e>        \
            <f>        \
            </f>    \
        </e>    \
    </b>        \
    <c>            \
    </c>        \
</a>            \
'

soup = BeautifulSoup(html,'lxml')
#print(soup.find('b').attrs)

print(soup.find('b').contents)

t = soup.find('b').findAll()
#t.reverse()
for c in t:
    gb = c.extract()

print(soup.find('b').contents)

soup.find('b').text.strip() 
```

我收到以下错误：

> “NoneType”对象没有属性“next_element”

在我得到的第一张照片上：

```
>>> print(soup.find('b').contents)
[u' ', <d> </d>, u' ', <e> <f> </f> </e>, u' '] 
```

第二次我得到：

```
>>> print(soup.find('b').contents)
[u' ', u' ', u' '] 
```

我很确定是中间的空元素造成了问题。

我发现的一种解决方法是重新创建汤：

```
soup = BeautifulSoup(str(soup))
soup.find('b').text.strip() 
```

现在它打印：

```
>>> soup.find('b').text.strip()
u'hello there!' 
```

我希望这会有所帮助。

# ios - 如何检测 UIImageView 的触摸事件？

> ID：855095
> 
> 赞同：98
> 
> 时间：2009-05-12T22:02:15.177
> 
> 标签：ios, iphone, uiimageview, uitouch

我在导航栏上放置了一个图像（UIImageView）。现在我想检测触摸事件并处理该事件。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2009-05-13T06:44:53.543

实际上，不要那样做。

而是在 UIImageView 上添加一个具有自定义样式的按钮（除非您指定图像，否则没有按钮图形）。然后附加您想要调用的任何方法。

您可以在许多情况下使用该技术，您确实希望屏幕的某些区域充当按钮而不是弄乱 Touch 的东西。

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2009-05-13T01:32:03.203

A`UIImageView`派生自 a`UIView`派生自，`UIResponder`因此它已准备好处理触摸事件。您需要提供`touchesBegan`、`touchesMoved`和`touchesEnded`方法，如果用户点击图像，它们将被调用。如果您想要的只是一个点击事件，那么使用自定义按钮并将图像设置为按钮图像会更容易。但是，如果您想对点击、移动等进行更细粒度的控制，这就是您要走的路。

您还需要查看更多内容：

*   覆盖`canBecomeFirstResponder`并返回YES，表示视图可以成为触摸事件的焦点（默认为NO）。

*   将`userInteractionEnabled`属性设置为 YES。默认为`UIViews`YES，但 for`UIImageViews`为 NO，因此您必须明确打开它。

*   如果您想响应多点触控事件（即捏合、缩放等），您需要设置 `multipleTouchEnabled`为 YES。

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2013-07-15T20:33:06.173

要将触摸事件添加到 UIImageView，请在 .m 文件中使用以下内容：

```
UITapGestureRecognizer *newTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(myTapMethod)];

[myImageView setUserInteractionEnabled:YES];

[myImageView addGestureRecognizer:newTap];

-(void)myTapMethod{
    // Treat image tap
} 
```

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2011-08-09T14:00:11.140

您还可以添加 UIGestureRecognizer。它不需要您在视图层次结构中添加额外的元素，但仍然为您提供了所有编写精美的代码，用于通过相当简单的界面处理触摸事件：

```
 UISwipeGestureRecognizer *swipeRight = [[UISwipeGestureRecognizer alloc]
                                            initWithTarget:self action:@selector(handleSwipe:)];
    swipeRight.direction = UISwipeGestureRecognizerDirectionRight;
    [imgView_ addGestureRecognizer:swipeRight];        
    [swipeRight release];
    UISwipeGestureRecognizer *swipeLeft = [[UISwipeGestureRecognizer alloc]
                                            initWithTarget:self action:@selector(handleSwipe:)];
    swipeLeft.direction = UISwipeGestureRecognizerDirectionLeft;
    [imgView_ addGestureRecognizer:swipeLeft];
    [swipeLeft release]; 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2012-07-23T10:15:08.367

在过去的几个小时里，我一直在不同的线程上试图为我的问题找到解决方案，但无济于事。我看到很多开发者都有这个问题，我想这里的人都知道这一点。我在 a 中有多个图像`UIScrollView`，试图在它们上获取点击事件。

我没有从 . 中获得任何事件`UIImangeView`，但我确实从`UILable`具有非常相似参数的类似事件中获得了一个事件，我正在为其设置非常相似的参数。在 iOS 5.1 下。

我已经做了以下事情：

1.  将 `UIImageView 和 parent view 的 setUserInteractionEnabled 设置为 YES。
2.  将 setMultipleTouchEnabled 设置为 YES `UIImageView`。
3.  尝试子类化`UIImageView`，没有任何帮助。

在下面附加一些代码，在此代码中，我初始化 a`UIImageView`和`UILabel`，标签在触发事件方面工作正常。我尝试保留不相关的代码。

```
UIImageView *single_view = [[UIImageView alloc]initWithFrame:CGRectMake(200, 200, 100, 100)];
single_view.image = img;
single_view.layer.zPosition = 4;

UITapGestureRecognizer *singleTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(singleTapGestureCaptured:)];
[single_view addGestureRecognizer:singleTap];
[single_view setMultipleTouchEnabled:YES];
[single_view setUserInteractionEnabled:YES];
[self.myScrollView addSubview:single_view];
self.myScrollView.userInteractionEnabled = YES;

UILabel *testLabel = [[UILabel alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
testLabel.backgroundColor = [UIColor redColor];
[self.myScrollView addSubview:testLabel];
[testLabel addGestureRecognizer:singleTap];
[testLabel setMultipleTouchEnabled:YES];
[testLabel setUserInteractionEnabled:YES];
testLabel.layer.zPosition = 4; 
```

以及处理事件的方法：

```
- (void)singleTapGestureCaptured:(UITapGestureRecognizer *)gesture
{
    UIView *tappedView = [gesture.view hitTest:[gesture locationInView:gesture.view] withEvent:nil];
    NSLog(@"Touch event on view: %@", [tappedView class]);
} 
```

如前所述，标签抽头被接收。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-04-23T05:31:34.550

与其制作一个可触摸的 UIImageView 然后将其放在导航栏上，不如只创建一个 UIBarButtonItem，它是由 UIImageView 制作的。

首先制作图像视图：

```
UIImageView *yourImageView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"nameOfYourImage.png"]]; 
```

然后将 barbutton 项从图像视图中取出：

```
UIBarButtonItem *yourBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:yourImageView]; 
```

然后将栏按钮项添加到导航栏：

```
self.navigationItem.rightBarButtonItem = yourBarButtonItem; 
```

请记住，此代码进入导航控制器视图控制器数组内的视图控制器。所以基本上，这个“可触摸的图像栏按钮项目”只会在显示这个视图控制器时出现在导航栏中。当您按下另一个视图控制器时，此导航栏按钮项将消失。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-12T23:32:27.773

您可能想要覆盖包含您的子视图`touchesBegan:withEvent:`的（或子类）的方法。`UIView``UIImageView`

在此方法中，测试是否有任何`UITouch`触摸落在`UIImageView`实例的边界内（假设它被称为`imageView`）。

也就是说，元素是否与`CGPoint`元素`[touch locationInView]`相交？查看运行此测试的函数。`CGRect``[imageView bounds]``CGRectContainsPoint`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-07-14T05:16:10.097

首先，您应该放置一个 UIButton，然后您可以为此按钮添加背景图像，或者您需要在按钮上放置一个 UIImageView。

或者：

您可以将点击手势添加到 UIImageView，以便在点击 UIImageView 时获得点击动作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-04-24T10:07:06.593

对于那些正在为此答案寻找 Swift 4 解决方案的人，您可以使用以下方法来检测 UIImageView 上的触摸事件。

```
let gestureRecognizer: UITapGestureRecognizer = UITapGestureRecognizer(target: self, action: #selector(imageViewTapped))
imageView.addGestureRecognizer(gestureRecognizer)
imageView.isUserInteractionEnabled = true 
```

然后，您需要按如下方式定义选择器：

```
@objc func imageViewTapped() {
    // Image has been tapped
} 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2012-07-25T09:24:48.993

在该视图上添加手势。将图像添加到该视图中，然后它也会检测图像上的手势。您可以尝试使用触摸事件的委托方法。那么在这种情况下，它也可能正在检测。

# visual-studio - VS2008的SVN插件

> ID：855097
> 
> 赞同：1
> 
> 时间：2009-05-12T22:02:28.110
> 
> 标签：visual-studio, svn, visual-studio-2008, version-control, visualsvn

我在 Visual Studio 2008 中使用[VisualSVN](http://www.visualsvn.com/visualsvn/)，我必须在托盘区域运行某种提交监视器，以查看项目的本地副本是否已过期。

我有两个问题：

1.  我讨厌在两个地方有它，我想在我的 VS 中看到它作为一个图标，

2.  提交监视器软件会关注几个项目，当我处理项目 1（VS 知道）时，我对其他项目不感兴趣。

我找不到任何 Visual Studio 的插件可以做到这一点，并且想知道是否有人知道任何好的东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-12T22:39:38.593

通常，您有 2 个选项（除了像您已经运行的那样运行 commitmonitor 之外）：

*   在开始更改之前运行更新
*   当你想提交时，忽略它并与任何更新合并。

SVN 的真正设计是围绕“等到你准备好并将它们合并在一起”模型，因为不能保证即使你在开始修改之前立即更新你的工作副本，有人不会在你之前提交更改一个承诺的机会。因此，让系统为您完成工作。

如果您担心冲突，最终的选择是使用 svn:needs-lock 属性，这意味着您必须在修改之前锁定您修改的任何文件，并且您将无法锁定其他人正在修改的文件。

您可能想询问 VisualSVN 人员，他们是否会在 VS 加载项目时添加一个选项来检查存储库（或运行 AnkhSVN 并自己实现此功能）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-16T09:54:02.043

AnkhSVN 已经朝着这个方向开始工作，我们开始实现在 Eclipse/Subclipse 中也使用的“同步视图”。仍然缺少的东西是：对存储库的计划检查，以及可能在 VS 中通知您某些事情发生了变化。

现在您可以手动刷新此视图以查看本地和远程更改（以及可能是潜在冲突的合并）。欢迎使用补丁来扩展此功能:-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-12T22:05:21.847

我假设 VisualSVN 是您的“服务器”（即使在同一台机器上运行）。

AnkhSVN 是一个很好的 Visual Studio 集成 SVN 客户端。

# jquery - JQuery 在控制器上调用动作（但之后不重定向）

> ID：855098
> 
> 赞同：4
> 
> 时间：2009-05-12T22:02:36.843
> 
> 标签：jquery, asp.net-mvc

我有一个 JQuery 确认弹出窗口，带有是，否按钮。Yes 按钮调用此函数：

```
 function doStuff() {
            $('#confirmPopup').dialog("close");
            var someKey = $("#someKey")[0].value;
            $.post("/MYController/MyAction", { someKey : someKey },
           function(responseText, textStatus, XMLHttpRequest) {

            });
            return false;
        } 
```

这成功调用了我的控制器操作（2 次不同的尝试）：

```
 public ActionResult MyAction(int someKey)
 {
     //do stuff
     return RedirectToAction("OtherAct", "OtherCont");
}

 public JavaScriptResult MyAction(int someKey)
     {
         //do stuff
         return JavaScript("Window.location.href='OtherCont/OtherAct';");
    } 
```

在这两种情况下，动作都会被执行，但不会重定向到另一个动作。为什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-12T22:07:03.310

因为您无法从异步调用的操作 ($.post) 重定向。[在这里](https://stackoverflow.com/questions/841089/asp-net-mvc-redirect-from-within-an-ajax-form-post)寻找替代方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-13T21:13:17.080

OtherContController 上的 OtherAct ... 是否用 [AcceptVerbs(HttpVerbs.Post)] 装饰？

如果是这样，那就是你的第一个问题。您返回 JavaScriptResult 的操作将起作用。但是，如果该操作使用 HttpVerbs.Post 进行修饰，那么就没有 Get 操作，并且 Ajax 调用得到**404 not found**。当然，由于它是异步发生的，因此您无法知道这一点。不会显示任何错误消息。

第二个问题更容易。你说 ...

```
return JavaScript("Window.location.href='OtherCont/OtherAct';") 
```

...当你的意思是...

```
return JavaScript("window.location.href='OtherCont/OtherAct';") 
```

...或者更准确地说...

```
return JavaScript("window.location.href='" + 
       Url.Action("OtherAct", "OtherCont") + "';"); 
```

那应该能让你到达那里。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T05:16:30.660

因为您使用的是 ajax，这意味着来自操作的重定向将被忽略。

重定向调用的解决方案可能是创建另一个使用普通 FORM POST 而没有 ajax 的帮助程序。然后整个页面将 POST 并且操作将重定向。

这是我的助手的一部分，正是这样做的：

```
 string deleteLink = String.Format(@"<a onclick=""deleteRecord({0})"" href='#'>Delete</a><form id='deleteForm' method='post' action='" +
             routeRelativePath + "/" + actionPrefix + "Delete/" + model.ID +
            @"'></form>", model.ID); 
```

..[更多](https://stackoverflow.com/questions/835713/suggestions-needed-for-handling-dynamic-redirect-routes-in-asp-net-mvc/842976#842976)关于上述。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T22:06:44.670

我已经看到 Web 服务重定向调用的问题，它们不会以这种方式工作。

另一种方法是将要重定向的 url 发送回客户端，然后使用 Javascript 进行重定向 (Window.location.href = ....)

或者，只需执行 HTML 提交而不是 Web 服务调用。

# memory - windows/linux下如何将内存映射为USWC？

> ID：855100
> 
> 赞同：2
> 
> 时间：2009-05-12T22:03:10.103
> 
> 标签：memory, assembly

我需要将大部分计算机内存映射为 uswc 以利用非缓存 movntdqa。在 windows 或 linux 下有什么简单的方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T04:47:28.857

在 Linux 下，这很容易——尽管你必须小心不要将内核内存映射到 W/C——这可能会变得很难看。假设您知道如何从用户空间保留物理范围的内存，那么您可以使用“/proc/mtrr”来更改内存类型。

描述界面的一个示例页面是[here](http://www.tikirobot.net/wp/2009/03/01/fixing-mtrrs-on-linux/)

# c# - 将 PHP crypt() 函数移植到 C# 时出现问题

> ID：855103
> 
> 赞同：1
> 
> 时间：2009-05-12T22:04:21.677
> 
> 标签：c#, php, porting, freebsd

我正在将一些旧的[ALP](http://www.nerdclub.net/alp/)用户帐户移植到新的 ASP.Net 解决方案，我希望用户能够使用他们的旧密码。

但是，为了使其工作，我需要能够根据新输入的密码将旧哈希值与新计算的哈希值进行比较。

我四处搜索，发现[这](http://people.freebsd.org/~phk/)`crypt()`是PHP 调用的实现：

```
char *
crypt_md5(const char *pw, const char *salt)
{
    MD5_CTX ctx,ctx1;
    unsigned long l;
    int sl, pl;
    u_int i;
    u_char final[MD5_SIZE];
    static const char *sp, *ep;
    static char passwd[120], *p;
    static const char *magic = "$1$";

    /* Refine the Salt first */
    sp = salt;

    /* If it starts with the magic string, then skip that */
    if(!strncmp(sp, magic, strlen(magic)))
        sp += strlen(magic);

    /* It stops at the first '$', max 8 chars */
    for(ep = sp; *ep && *ep != '$' && ep < (sp + 8); ep++)
        continue;

    /* get the length of the true salt */
    sl = ep - sp;

    MD5Init(&ctx);

    /* The password first, since that is what is most unknown */
    MD5Update(&ctx, (const u_char *)pw, strlen(pw));

    /* Then our magic string */
    MD5Update(&ctx, (const u_char *)magic, strlen(magic));

    /* Then the raw salt */
    MD5Update(&ctx, (const u_char *)sp, (u_int)sl);

    /* Then just as many characters of the MD5(pw,salt,pw) */
    MD5Init(&ctx1);
    MD5Update(&ctx1, (const u_char *)pw, strlen(pw));
    MD5Update(&ctx1, (const u_char *)sp, (u_int)sl);
    MD5Update(&ctx1, (const u_char *)pw, strlen(pw));
    MD5Final(final, &ctx1);
    for(pl = (int)strlen(pw); pl > 0; pl -= MD5_SIZE)
        MD5Update(&ctx, (const u_char *)final,
            (u_int)(pl > MD5_SIZE ? MD5_SIZE : pl));

    /* Don't leave anything around in vm they could use. */
    memset(final, 0, sizeof(final));

    /* Then something really weird... */
    for (i = strlen(pw); i; i >>= 1)
        if(i & 1)
            MD5Update(&ctx, (const u_char *)final, 1);
        else
            MD5Update(&ctx, (const u_char *)pw, 1);

    /* Now make the output string */
    strcpy(passwd, magic);
    strncat(passwd, sp, (u_int)sl);
    strcat(passwd, "$");

    MD5Final(final, &ctx);

    /*
     * and now, just to make sure things don't run too fast
     * On a 60 Mhz Pentium this takes 34 msec, so you would
     * need 30 seconds to build a 1000 entry dictionary...
     */
    for(i = 0; i < 1000; i++) {
        MD5Init(&ctx1);
        if(i & 1)
            MD5Update(&ctx1, (const u_char *)pw, strlen(pw));
        else
            MD5Update(&ctx1, (const u_char *)final, MD5_SIZE);

        if(i % 3)
            MD5Update(&ctx1, (const u_char *)sp, (u_int)sl);

        if(i % 7)
            MD5Update(&ctx1, (const u_char *)pw, strlen(pw));

        if(i & 1)
            MD5Update(&ctx1, (const u_char *)final, MD5_SIZE);
        else
            MD5Update(&ctx1, (const u_char *)pw, strlen(pw));
        MD5Final(final, &ctx1);
    }

    p = passwd + strlen(passwd);

    l = (final[ 0]<<16) | (final[ 6]<<8) | final[12];
    _crypt_to64(p, l, 4); p += 4;
    l = (final[ 1]<<16) | (final[ 7]<<8) | final[13];
    _crypt_to64(p, l, 4); p += 4;
    l = (final[ 2]<<16) | (final[ 8]<<8) | final[14];
    _crypt_to64(p, l, 4); p += 4;
    l = (final[ 3]<<16) | (final[ 9]<<8) | final[15];
    _crypt_to64(p, l, 4); p += 4;
    l = (final[ 4]<<16) | (final[10]<<8) | final[ 5];
    _crypt_to64(p, l, 4); p += 4;
    l = final[11];
    _crypt_to64(p, l, 2); p += 2;
    *p = '\0';

    /* Don't leave anything around in vm they could use. */
    memset(final, 0, sizeof(final));

    return (passwd);
} 
```

而且，这是我在 C# 中的版本，以及预期的匹配。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Diagnostics;
using System.Security.Cryptography;
using System.IO;
using System.Management;

namespace Test
{
    class Program
    {
        static void Main(string[] args)
        {
            byte[] salt = Encoding.ASCII.GetBytes("$1$ls3xPLpO$Wu/FQ.PtP2XBCqrM.w847/");
            Console.WriteLine("Hash:  " + Encoding.ASCII.GetString(salt));

            byte[] passkey = Encoding.ASCII.GetBytes("suckit");

            byte[] newhash = md5_crypt(passkey, salt);
            Console.WriteLine("Hash2: " + Encoding.ASCII.GetString(newhash));

            byte[] newhash2 = md5_crypt(passkey, newhash);
            Console.WriteLine("Hash3: " + Encoding.ASCII.GetString(newhash2));

            Console.ReadKey(true);
        }

        public static byte[] md5_crypt(byte[] pw, byte[] salt)
        {
            MemoryStream ctx, ctx1;
            ulong l;
            int sl, pl;
            int i;
            byte[] final;
            int sp, ep; //** changed pointers to array indices
            MemoryStream passwd = new MemoryStream();
            byte[] magic = Encoding.ASCII.GetBytes("$1$");

            // Refine the salt first
            sp = 0;  //** Changed to an array index, rather than a pointer.

            // If it starts with the magic string, then skip that
            if (salt[0] == magic[0] &&
                salt[1] == magic[1] &&
                salt[2] == magic[2])
            {
                sp += magic.Length;
            }

            // It stops at the first '$', max 8 chars
            for (ep = sp;
                (ep + sp < salt.Length) &&  //** Converted to array indices, and rather than check for null termination, check for the end of the array.
                salt[ep] != (byte)'$' &&
                ep < (sp + 8);
                ep++)
                continue;

            // Get the length of the true salt
            sl = ep - sp;

            ctx = MD5Init();

            // The password first, since that is what is most unknown
            MD5Update(ctx, pw, pw.Length);

            // Then our magic string
            MD5Update(ctx, magic, magic.Length);

            // Then the raw salt
            MD5Update(ctx, salt, sp, sl);

            // Then just as many characters of the MD5(pw,salt,pw)
            ctx1 = MD5Init();
            MD5Update(ctx1, pw, pw.Length);
            MD5Update(ctx1, salt, sp, sl);
            MD5Update(ctx1, pw, pw.Length);
            final = MD5Final(ctx1);
            for(pl = pw.Length; pl > 0; pl -= final.Length)
                MD5Update(ctx, final, 
                    (pl > final.Length ? final.Length : pl));

            // Don't leave anything around in vm they could use.
            for (i = 0; i < final.Length; i++) final[i] = 0;

            // Then something really weird...
            for (i = pw.Length; i != 0; i >>= 1)
                if((i & 1) != 0)
                    MD5Update(ctx, final, 1);
                else
                    MD5Update(ctx, pw, 1);

            // Now make the output string
            passwd.Write(magic, 0, magic.Length);
            passwd.Write(salt, sp, sl);
            passwd.WriteByte((byte)'$');

            final = MD5Final(ctx);

            // and now, just to make sure things don't run too fast
            // On a 60 Mhz Pentium this takes 34 msec, so you would
            // need 30 seconds to build a 1000 entry dictionary...
            for(i = 0; i < 1000; i++)
            {
                ctx1 = MD5Init();
                if((i & 1) != 0)
                    MD5Update(ctx1, pw, pw.Length);
                else
                    MD5Update(ctx1, final, final.Length);

                if((i % 3) != 0)
                    MD5Update(ctx1, salt, sp, sl);

                if((i % 7) != 0)
                    MD5Update(ctx1, pw, pw.Length);

                if((i & 1) != 0)
                    MD5Update(ctx1, final, final.Length);
                else
                    MD5Update(ctx1, pw, pw.Length);

                final = MD5Final(ctx1);
            }

            //** Section changed to use a memory stream, rather than a byte array.
            l = (((ulong)final[0]) << 16) | (((ulong)final[6]) << 8) | ((ulong)final[12]);
            _crypt_to64(passwd, l, 4);
            l = (((ulong)final[1]) << 16) | (((ulong)final[7]) << 8) | ((ulong)final[13]);
            _crypt_to64(passwd, l, 4);
            l = (((ulong)final[2]) << 16) | (((ulong)final[8]) << 8) | ((ulong)final[14]);
            _crypt_to64(passwd, l, 4);
            l = (((ulong)final[3]) << 16) | (((ulong)final[9]) << 8) | ((ulong)final[15]);
            _crypt_to64(passwd, l, 4);
            l = (((ulong)final[4]) << 16) | (((ulong)final[10]) << 8) | ((ulong)final[5]);
            _crypt_to64(passwd, l, 4);
            l = final[11];
            _crypt_to64(passwd, l, 2);

            byte[] buffer = new byte[passwd.Length];
            passwd.Seek(0, SeekOrigin.Begin);
            passwd.Read(buffer, 0, buffer.Length);
            return buffer;
        }

        public static MemoryStream MD5Init()
        {
            return new MemoryStream();
        }

        public static void MD5Update(MemoryStream context, byte[] source, int length)
        {
            context.Write(source, 0, length);
        }

        public static void MD5Update(MemoryStream context, byte[] source, int offset, int length)
        {
            context.Write(source, offset, length);
        }

        public static byte[] MD5Final(MemoryStream context)
        {
            long location = context.Position;
            byte[] buffer = new byte[context.Length];
            context.Seek(0, SeekOrigin.Begin);
            context.Read(buffer, 0, (int)context.Length);
            context.Seek(location, SeekOrigin.Begin);
            return MD5.Create().ComputeHash(buffer);
        }

        // Changed to use a memory stream rather than a character array.
        public static void _crypt_to64(MemoryStream s, ulong v, int n)
        {
            char[] _crypt_a64 = "./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".ToCharArray(); 

            while (--n >= 0)
            {
                s.WriteByte((byte)_crypt_a64[v & 0x3f]);
                v >>= 6;
            }
        }

    }
} 
```

我究竟做错了什么？我正在对 FreeBSD 版本中 MD5xxxx 函数的工作原理做出一些重大假设，但它似乎有效。

这不是 PHP 使用的实际版本吗？有没有人有任何见解？

**编辑：**

我下载了一份 PHP 的源代码，发现它使用了 glibc 库。因此，我下载了 glibc 源代码的副本，找到了 __md5_crypt_r 函数，复制了它的功能，它返回了与 FreeBSD 版本完全相同的哈希值。

现在，我很困惑。PHP 4 是否使用了与 PHP 5 不同的方法？到底是怎么回事？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-14T13:52:01.100

好的，所以这里是答案：

PHP 使用 crypt 函数的*glibc*实现。（附：C#实现）

The reason my old passwords are not matching the hash is because the Linux box my old website (hosted by GoDaddy) sat on had a non-standard hashing algorithm. (Possibly to fix some of the WEIRD stuff done in the algorithm.)

However, I have tested the following implementation against glibc's unit tests and against a windows install of PHP. Both tests were passed 100%.

**EDIT**
Here is the link: (moved to a Github Gist)

[https://gist.github.com/1092558](https://gist.github.com/1092558)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T22:41:23.177

PHP 中的[crypt()](http://us.php.net/crypt)函数使用底层操作系统提供的任何散列算法来加密数据 - 查看它的文档。所以第一步应该是找出数据是如何加密的（使用了什么散列算法）。一旦你知道了这一点，为 C# 找到相同的算法应该是微不足道的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T22:57:59.093

您始终可以将 system()（或调用任何 C# 静态函数）输出到为您执行 crypt 的 php 命令行脚本。

我建议在成功登录后强制更改密码。然后，您可以有一个标志来指示用户是否已更改。一旦每个人都改变了，你就可以转储 php 调用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T11:15:27.840

只需重用 php 实现...确保 php 的 crypt 库在您的系统环境路径中...

您可能需要更新您的互操作方法以确保您的字符串编组/字符集是正确的......然后您可以使用原始散列算法。

```
[DllImport("crypt.dll", CharSet=CharSet.ASCII)]
private static extern string crypt(string password, string salt);

public bool ValidLogin(string username, string password)
{
    string hash = crypt(password, null);
    ...
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-12T22:52:24.050

它看起来并不简单。

**更新**：最初我写道：“ *PHP Crypt 函数看起来不像标准哈希。为什么不呢？谁知道呢。* ” 正如评论中指出的那样，PHP crypt() 与 BSD 中用于 passwd crypt 的相同。我不知道这是否是法律上的标准，但这是事实上的标准。所以。

我坚持我的立场，这似乎不是微不足道的。

与其移植代码，不如考虑保持旧的 PHP 运行，并严格使用它来验证旧密码的密码。当用户更改密码时，使用一种新的散列算法，更“开放”一些。您必须存储散列以及每个用户的“散列风味”。

# concurrency - 并发控制中的更新丢失？

> ID：855105
> 
> 赞同：0
> 
> 时间：2009-05-12T22:04:28.853
> 
> 标签：concurrency

我有两个在数据库中同时执行的事务 T 和 U。如何提供丢失更新问题的示例？

我们可以假设我们有三个账户 A、B、C，他们每个账户分别有 100 英镑、200 英镑和 300 英镑。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-19T03:24:33.140

“丢失更新”问题与并发读取和数据更新有关，在读取器不会阻塞写入器的系统中。事务不必完全同时进行。

1.  会话 #1 读取帐户 A，获得 100。
2.  会话 #2 读取帐户 A，得到 100。
3.  会话 #2 将帐户 A 更新为 150 (+50) 并提交。
4.  会话 #1 将帐户 A 更新为 120 (+20) 并提交。

在这种情况下，因为会话 #1 不知道另一个会话已经修改了帐户，所以会话 #2 的更新被覆盖（“丢失”）。

有几种方法可以解决这个问题，例如版本号或前后比较。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-08T12:40:45.650

(3) 将账户 A 更新为 150 其中账户为 100 -> 账户 A 现在为 150

(4) 将账户 A 更新为 120 其中账户为 100 -> 更新失败，因为账户 A 是 150 而不是 100

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-31T02:43:02.410

当访问相同数据库项的两个事务的操作交错时，会发生这种情况，从而使某些数据库项的值不正确。

# c++ - 为什么在 C++ 中使用元组并不常见？

> ID：855110
> 
> 赞同：126
> 
> 时间：2009-05-12T22:05:37.807
> 
> 标签：c++, tuples

为什么似乎没有人在 C++ 中使用元组，无论是[Boost 元组库](http://www.boost.org/doc/libs/1_39_0/libs/tuple/doc/tuple_users_guide.html)还是 TR1 的标准库？我读过很多 C++ 代码，很少看到元组的使用，但我经常看到很多地方元组可以解决很多问题（通常从函数返回多个值）。

元组允许你做各种很酷的事情，比如：

```
tie(a,b) = make_tuple(b,a); //swap a and b 
```

这肯定比这更好：

```
temp=a;
a=b;
b=temp; 
```

当然，你总是可以这样做：

```
swap(a,b); 
```

但是如果你想旋转三个值呢？你可以用元组做到这一点：

```
tie(a,b,c) = make_tuple(b,c,a); 
```

元组还使从函数返回多个变量变得更加容易，这可能比交换值更常见。使用返回值的引用当然不是很优雅。

我没有想到的元组有什么大的缺点吗？如果不是，为什么它们很少使用？他们慢吗？还是只是人们不习惯？使用元组是个好主意吗？

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2009-05-13T00:00:07.107

一个愤世嫉俗的答案是，许多人使用 C++ 编程，但不理解和/或使用更高级别的功能。有时是因为他们不被允许，但许多人根本不尝试（甚至不理解）。

作为一个非增强示例：有多少人使用中的功能`<algorithm>`？

换句话说，许多 C++ 程序员只是使用 C++ 编译器的 C 程序员，也许`std::vector`还有`std::list`. 这就是为什么使用`boost::tuple`不常见的原因之一。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2009-05-12T22:10:53.540

因为它还不是标准的。任何非标准的东西都有更高的障碍。Boost 的片段已经变得流行，因为程序员们都在叫嚣着要它们。（hash_map 突然想到）。但是，虽然 tuple 很方便，但它并不是人们为它烦恼的压倒性和明显的胜利。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-05-12T23:17:40.310

C++ 元组语法可能比大多数人想要的要冗长得多。

考虑：

```
typedef boost::tuple<MyClass1,MyClass2,MyClass3> MyTuple; 
```

因此，如果你想广泛使用元组，你要么到处得到元组 typedef，要么到处得到令人讨厌的长类型名称。我喜欢元组。我在必要时使用它们。但它通常仅限于几种情况，例如 N 元素索引或使用多重映射来绑定范围迭代器对时。它通常在非常有限的范围内。

与 Haskell 或 Python 之类的东西相比，这一切都非常丑陋和骇人听闻。当 C++0x 出现时，我们得到 'auto' 关键字元组将开始看起来更具吸引力。

元组的有用性与声明、打包和解包它们所需的击键次数成反比。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-05-13T00:26:38.977

对我来说，这是习惯，放下手来：Tuples 并没有为我解决任何新问题，只有几个我已经可以处理得很好。用老式的方式交换值仍然感觉更容易——而且，更重要的是，我并没有真正考虑如何“更好地”交换值。照原样就足够了。

就个人而言，我不认为元组是返回多个值的好方法——听起来像是`struct`s 的工作。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-05-13T00:16:47.343

*但是如果你想旋转三个值呢？*

```
swap(a,b);
swap(b,c);  // I knew those permutation theory lectures would come in handy. 
```

好的，所以有了 4 个 etc 值，最终 n 元组的代码比 n-1 交换少。并且使用默认交换，这会执行 6 个分配，而不是如果您自己实现一个三周期模板，您将拥有 4 个分配，尽管我希望编译器能够为简单类型解决这个问题。

您可以提出互换不实用或不合适的方案，例如：

```
tie(a,b,c) = make_tuple(b*c,a*c,a*b); 
```

打开包装有点尴尬。

不过，关键是，有一些已知的方法可以处理元组最适合的最常见情况，因此并不迫切需要使用元组。如果不出意外，我不相信：

```
tie(a,b,c) = make_tuple(b,c,a); 
```

不做 6 份，使其完全不适合某些类型（收藏是最明显的）。随意说服我，元组对于“大”类型是一个好主意，说这不是这样:-)

对于返回多个值，如果值的类型不兼容，则元组是完美的，但如果调用者可能以错误的顺序获取它们，则有些人不喜欢它们。有些人根本不喜欢多个返回值，并且不想通过简化它们来鼓励使用它们。有些人只是更喜欢命名结构的输入和输出参数，并且可能无法用棒球棒说服使用元组。没有考虑味道。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-12-25T05:45:46.030

正如许多人指出的那样，元组并没有其他功能那么有用。

1.  交换和旋转的噱头只是噱头。对于那些以前没有见过它们的人来说，它们完全是一头雾水，而且由于几乎是每个人，这些噱头只是糟糕的软件工程实践。

2.  使用元组返回多个值的自文档化比其他方法要少得多——返回命名类型或使用命名引用。如果没有这种自我记录，很容易混淆返回值的顺序，如果它们是可以相互转换的，而且不是更明智。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-05-12T23:44:15.320

不是每个人都可以使用 boost，TR1 还没有广泛使用。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-12-30T02:10:41.217

你很少看到它们，因为设计良好的代码通常不需要它们——在野外，使用匿名结构优于使用命名结构的情况并不多。由于所有元组真正代表的是一个匿名结构，因此大多数编码人员在大多数情况下只使用真实的东西。

假设我们有一个函数“f”，其中一个元组返回可能是有意义的。作为一般规则，此类功能通常足够复杂，以至于它们可能会失败。

如果 "f" CAN 失败，您需要返回状态 - 毕竟，您不希望调用者必须检查每个参数以检测失败。"f" 可能符合以下模式：

```
struct ReturnInts ( int y,z; }
bool f(int x, ReturnInts& vals);

int x = 0;
ReturnInts vals;
if(!f(x, vals)) {
    ..report error..
    ..error handling/return...
} 
```

这并不漂亮，但看看替代方案有多丑陋。请注意，我仍然需要一个状态值，但代码不再具有可读性且不短。它也可能更慢，因为我用元组承担了 1 个副本的成本。

```
std::tuple<int, int, bool> f(int x);
int x = 0;
std::tuple<int, int, bool> result = f(x); // or "auto result = f(x)"
if(!result.get<2>()) {
    ... report error, error handling ...
} 
```

另一个显着的缺点隐藏在这里 - 使用“ReturnInts”，我可以通过修改“ReturnInts”而不改变“f”的接口来添加改变“f”的回报。元组解决方案不提供该关键功能，这使其成为任何库代码的劣等答案。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-05-13T00:36:34.733

在嵌入式系统上使用 C++ 时，引入 Boost 库变得复杂。它们相互耦合，因此库大小增加。您返回数据结构或使用参数传递而不是元组。在 Python 中返回元组时，数据结构按照返回值的顺序和类型排列，只是不明确。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-05-12T23:32:04.250

当然，元组是有用的，但如前所述，有一些开销和一两个障碍，你必须跳过才能真正使用它们。

如果您的程序始终找到需要返回多个值或交换多个值的地方，那么走元组路线可能是值得的，但有时以经典方式做事会更容易。

一般来说，并不是每个人都已经安装了 Boost，我当然不会为了它的元组功能而去下载它和配置我的包含目录来使用它。我想你会发现已经在使用 Boost 的人比非 Boost 用户更有可能在他们的程序中找到元组的使用，而来自其他语言的迁移者（想到 Python）更可能只是因为缺少元组而感到不安在 C++ 中，而不是探索添加元组支持的方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-07-27T08:29:43.833

由于数据存储`std::tuple`具有 a`struct`和数组的最差特性；所有访问都是基于第 n 个位置的，但不能`tuple`使用`for`循环遍历。

因此，如果 中的元素在`tuple`概念上是数组，我将使用数组，如果元素在概念上不是数组，则结构（具有命名元素）更易于维护。（`a.lastname`比`std::get<1>(a)`）更具解释性。

这使得 OP 提到的转换成为元组唯一可行的用例。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-12T23:04:47.383

我感觉很多人使用 Boost.Any 和 Boost.Variant（带有一些工程）而不是 Boost.Tuple。

# python - 我可以将鼻子覆盖输出限制到目录（而不是包）吗？

> ID：855114
> 
> 赞同：20
> 
> 时间：2009-05-12T22:06:28.977
> 
> 标签：python, code-coverage, nose, nosetests

我的 SUT 看起来像：

```
foo.py
bar.py
tests/__init__.py [empty]
tests/foo_tests.py
tests/bar_tests.py
tests/integration/__init__.py [empty]
tests/integration/foo_tests.py
tests/integration/bar_tests.py 
```

当我运行时`nosetests --with-coverage`，我会得到我宁愿忽略的各种模块的详细信息。但我不能使用该 `--cover-package=PACKAGE`选项，因为`foo.py`&`bar.py`不在包中。[（请参阅http://lists.idyll.org/pipermail/testing-in-python/2008-November/001091.html](http://lists.idyll.org/pipermail/testing-in-python/2008-November/001091.html)之后的线程， 因为我没有将它们放入包中。）

我可以将覆盖范围输出限制为 foo.py 和 bar.py 吗？

**更新**- 假设没有比下面[Nadia](https://stackoverflow.com/users/97828/nadia)更好的答案，我问了一个后续问题：[“我如何编写一些（bash）shell 脚本来将目录中所有匹配的文件名转换为命令行选项？ "](https://stackoverflow.com/questions/855265/how-do-i-write-some-bash-shell-script-to-convert-all-matching-filenames-in-dire)

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-12T22:23:05.487

你可以像这样使用它：

```
--cover-package=foo --cover-package=bar 
```

我快速查看了鼻子源代码以确认：[这是行](https://github.com/nose-devs/nose/blob/master/nose/plugins/cover.py)

```
 if options.cover_packages:
        for pkgs in [tolist(x) for x in options.cover_packages]: 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2011-10-07T18:58:42.803

您可以使用：

```
--cover-package=. 
```

甚至设置环境变量

```
NOSE_COVER_PACKAGE=. 
```

用鼻子测试 1.1.2

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-03-26T22:44:04.397

我有很多顶级 Python 文件/包，并且发现使用 --cover-package 手动列出它们很烦人，所以我为自己做了两个别名。Alias`nosetests_cover`将覆盖 --cover-package 中列出的所有顶级 Python 文件/包。Alias`nosetests_cover_sort`将执行相同的操作，并另外按覆盖百分比对结果进行排序。

```
nosetests_cover_cmd="nosetests --with-coverage --cover-erase --cover-inclusive --cover-package=\$( ls | sed -r 's/[.]py$//' | fgrep -v '.' | paste -s -d ',' )"
alias nosetests_cover=$nosetests_cover_cmd
alias nosetests_cover_sort="$nosetests_cover_cmd 2>&1 | fgrep '%' | sort -nr -k 4" 
```

笔记：

*   这是来自我的 .bashrc 文件。如果您不使用 bash，请适当修改。
*   这些必须从您的顶级目录运行。否则，包名称将不正确，coverage 将默默地无法处理它们（即，它不会告诉您您的 --cover-package 不正确，它会表现得就像您根本没有提供该选项一样）。
*   我目前在 Ubuntu 13.10 上使用 Python 2.7.6，鼻子版本 1.3.0 和覆盖版本 3.7.1。这是我测试这些命令的唯一设置。
*   在您的使用中，如果 --cover-erase 和 --cover-inclusive 不符合您的需求，请删除它们。
*   如果要按正常顺序而不是倒序排序，请在排序命令中替换`-nr`为。`-n`
*   这些命令假定所有顶级 Python 文件/包的命名都没有点（“.py”中的点除外）。如果这对您来说不正确，请阅读下面的详细信息部分以了解命令部分，然后根据需要修改命令。

细节：

我并不是说这些是实现我想要的结果的最有效的命令。它们只是我碰巧想出的命令。=P

主要要解释的是 --cover-package 的参数。它构建以逗号分隔的顶级 Python 文件/包名称列表（从文件名中删除“.py”），如下所示：

*   `\$`-- 转义`$`双引号字符串中的字符。
*   `$( )`-- 插入其中包含的命令的结果。
*   `ls`-- 列出当前目录中的所有名称（必须是顶级 Python 目录）。
*   `| sed -r 's/[.]py$//'`-- 在列表中，将“foo_bar.py”替换为“foo_bar”。
*   `| fgrep -v '.'`-- 在列表中，删除所有不带点的名称（例如删除 foo_bar.pyc 和 notes.txt）。
*   `| paste -s -d ','`-- 将列表从换行符分隔为逗号分隔。

我还应该解释排序。

*   `2>&1`-- 加入标准错误和标准输出。
*   `| fgrep '%'`-- 删除所有没有`%`字符的输出行。
*   `| sort -nr -k 4`-- 按第 4 列（即覆盖百分比列）以相反的数字顺序对剩余的行进行排序。如果您想要正常顺序而不是反向顺序，请替换`-nr`为`-n`.

希望这对某人有帮助！=)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-12T23:10:06.953

如果使用[coverage:py 3.0](http://nedbatchelder.com/blog/200904/coverage_v30_beta_2.html)，则默认忽略 Python 目录中的代码，包括标准库和所有已安装的包。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-04-19T09:54:24.143

我会这样做：

```
nosetests --with-coverage --cover-package=foo,bar tests/* 
```

我更喜欢这个解决方案而不是其他建议的解决方案；这很简单，但您明确说明您希望覆盖哪些包。Nadia 的回答涉及更多冗余输入，Stuart 的回答使用 sed 并且仍然通过调用创建一个包`touch __init__.py`，并且 `--cover-package=.`对我不起作用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-09-03T13:47:08.890

对于尝试使用 setup.cfg 执行此操作的任何人，以下内容有效。我在弄清楚如何指定多个包时遇到了一些麻烦。

```
[nosetests]
with-coverage=1
cover-html=1
cover-package=module1,module2 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-06-08T01:11:45.677

```
touch __init__.py; nosetests --with-coverage --cover-package=`pwd | sed 's@.*/@@g'` 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-06-03T17:46:00.113

您可以像这样改进接受的答案`--cover-package=foo,bar`

# c# - 条件引用

> ID：855118
> 
> 赞同：6
> 
> 时间：2009-05-12T22:06:46.587
> 
> 标签：c#, visual-studio-2008, reference, conditional-compilation

目前我们的 .net 代码不是特定于处理器的，但它取决于库 (Oracle/ODP.Net)。我们找到了一个解决方案，我们直接编辑 csproj 文件，并根据我们选择的构建配置将引用放入带有 Condition 子句的项目组。我们有 32 位调试/发布和 64 位调试/发布，并且正确的程序集是您构建该配置时的参考。

这在构建时或多或少地起作用，但它会导致 Visual Studio (2008) 中的各种古怪。最终结果是同一个程序集在引用下出现了四次，其中三个带有黄色感叹号。它还会生成一些我无法摆脱的 76 个警告。我们试图以 0 个警告为目标，因为我们想知道什么时候出现新警告，所以这有点问题。

是否有人知道条件引用的解决方案，使其看起来像单个引用（实际上是）并且不会在构建时填写我的警告？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T22:10:23.167

唯一想到的是拥有 4 个单独的项目文件......但在您担心添加类时必须维护 4 个文件之前，您可以在这里使用另一个 csproj 技巧：

```
<Compile Include="**\*.cs" /> 
```

其中（IIRC）说“包括文件夹结构中任何级别的所有cs文件”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-19T20:53:27.373

我们找到了一个与我们正在寻找的有点不同的答案，但我有点喜欢它。如果你在 runtime->AssemblyBinding 下把它添加到你的配置文件中

```
<依赖程序集>
<assemblyIdentity name="Oracle.DataAccess" publicKeyToken="89b483f429c47342" />
<bindingRedirect oldVersion="2.111.6.20" newVersion="2.111.6.0" />
</dependentAssembly>

```

然后 64 位和 32 位版本使用相同的构建。我们所要做的就是在部署时**不要**在本地复制 Oracle.DataAccess.dll 并让它从 GAC 中拉取。

谢谢！

# c++ - 用于 INI 文件阅读器的 C++ 自定义枚举结构

> ID：855121
> 
> 赞同：0
> 
> 时间：2009-05-12T22:07:35.493
> 
> 标签：c++, templates, enums, switch-statement, ini

我正在尝试创建一个具有字符串标签和值的 Enum，并且我计划使用它从 ini 文件中读取内容。

例如，在 ini 文件中，我可能有一些`double`,`int`或`string`type 值，前面有值的标记/名称：

```
SomeFloat = 0.5
SomeInteger = 5
FileName = ../Data/xor.csv 
```

当我从文件中读取标签时，它以 a 的形式出现`string`，所以我只想让它`std::set`保留我的所有值......当我读取标签时，我可以将它`EnumType`与将检查类型并进行正确的转换（atoi 或仅使用字符串等）

例如：

```
EnumType<int>     someInteger;
someInteger.label = "SomeInteger";
someInteger.type = INT;

std::set<EnumType> myValues;
//
// populate the set
myValues.insert(someInteger);
//

void ProcessTagAndValue(const std::string &tag, const std::string &value)
{
    switch(myValues[tag].type)
    {
    case INT:
        myValues[tag].value = atoi(value);
        break;
    case DOUBLE:
        //
        break;
    case STRING:
        myValues[tag].value = value;
        break;
    default:
        break;
    }
}

enum ValueType{INT,DOUBLE,STRING];

template <class T>
struct EnumType{
    std::string label;
    ValueType   type;
    T           value;

    bool operator==(const EnumType &other) const {
        return this->label == other.label;
    }

    bool operator==(const T& other ) const
    {
        return this->value == other;
    }

    T& operator=(const T& p)
    {
        value = p;
        return value;
    }

    EnumType& operator=(const EnumType& p)
    {
        if (this != &p) {  // make sure not same object
            this->label = p.label;
            this->value = p.value;
        }
        return *this;
    }
}; 
```

我有几个问题：

1.  你们能告诉我更好的解决方案吗？我不确定我是否为了我自己的利益而过于聪明，或者这是否真的是一个可行的解决方案。

2.  如果我的解决方案是可以接受的，那么任何人都可以告诉我如何声明一组，`std::set<EnumType<...>>`以便它可以接受任何类型（int、double、string），而我实际上并不知道枚举将使用哪种类型作为值？

如果您有任何代码，那就太好了！:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T22:16:13.810

你看过[Boost.Any](http://www.boost.org/doc/libs/1_39_0/doc/html/any.html)吗？它应该做你想做的（如果你*需要*自己动手，你可以查看源代码以获取提示）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T22:58:53.460

如果您的类型集有限且非常稳定，则可以使用[Boost.Variant 。](http://www.boost.org/doc/libs/1_39_0/doc/html/variant.html)如果您稍后要添加对新类型的支持，那么最好忘记此方法。在这种情况下，基于[Boost.Any](http://www.boost.org/doc/libs/1_39_0/doc/html/any.html)或一对字符串的解决方案会更好。

```
typedef boost::variant<int, double, std::string> ValueType;
struct EnumType {
std::string label;
ValueType value;
}; 
```

另一个问题是：“这些值以后将如何使用？” 如果您要将“SomeInteger”传递给函数，接受 int，您仍然必须运行类似于以下内容的代码：

```
acceptInt( get<int>( v.value ) ); // get may throw 
```

当您对固定类型集进行统一处理时，此方法效果更好：

```
class processValue : public boost::static_visitor<>
{
public:
    void operator()(int i) const
    {
        acceptInt( i );
    }
    void operator()(double d) const
    {
        acceptDouble( d );
    }
    void operator()(const std::string & str) const
    {
        acceptString( str );
    }
};
boost::apply_visitor( processValue(), v.value ); 
```

# c++ - 是否可以在 C++ 中创建一个符合开放/封闭原则的工厂？

> ID：855123
> 
> 赞同：1
> 
> 时间：2009-05-12T22:07:49.973
> 
> 标签：c++

在我正在使用 C++ 处理的项目中，我需要为通过网络传入的消息创建对象。我目前正在使用[工厂方法模式](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.12)来隐藏对象的创建：

```
// very psuedo-codey
Message* MessageFactory::CreateMessage(InputStream& stream)
{
    char header = stream.ReadByte();

    switch (header) {
    case MessageOne::Header:
        return new MessageOne(stream);
    case MessageTwo::Header:
        return new MessageTwo(stream);
    // etc.
    }
} 
```

我遇到的问题是我很懒，不喜欢在两个地方写类名！

在 C# 中，我会在第一次使用工厂时进行一些反思（额外的问题：这是可以使用反射的，对吗？）但由于 C++ 缺乏反射，所以这不在讨论范围内。我考虑过使用某种注册表，以便消息在启动时向工厂注册，但这受到[非确定性（或至少特定于实现）静态初始化顺序问题](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.12)的阻碍。

那么问题来了，在尊重开闭原则的情况下，是否可以在 C++ 中实现这种类型的工厂，以及如何实现？

编辑：显然我想多了。我打算将这个问题作为“你将如何在 C++ 中做到这一点”，因为在其他语言中使用反射真的很容易。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T22:39:45.333

我认为开放/封闭方法和 DRY 是很好的原则。但它们并不神圣。目标应该是使代码可靠且可维护。如果您必须执行不自然的行为以遵守 O/C 或 DRY，那么您可能只是让您的代码不必要地变得更加复杂而没有任何物质利益。

这是我几年前[写的关于我如何做出这些判断的东西。](http://www.io.com/~richardr/writing/Engineering/SoftwareQuality/index.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T22:35:18.507

您可以将创建消息（MessageOne、MessageTwo ...）的类转换为消息工厂，并在初始化时将它们注册到顶级 MessageFactory。

消息工厂可以保存 MessageX::Header 的映射 -> MessageXFactory 类型的映射实例。

在 CreateMessage 中，您会根据消息头找到 MessageXFactory 的实例，检索对 MessageXFactory 的引用，然后调用它的方法，该方法将返回实际 MessageX 的实例。

有了新消息，您不再需要修改“开关”，只需将新 MessageXFactory 的实例添加到 TopMessageFactory。

例子：

```
#include <iostream>
#include <map>
#include <string>

using namespace std;

struct Message
{
    static const int id = 99;
    virtual ~Message() {}
    virtual int msgId() { return id; }
};

struct NullMessage : public Message
{
    static const int id = 0;
    virtual int msgId() { return id; }
};

struct MessageOne : public Message
{
    static const int id = 1;
    virtual int msgId() { return id; }
};

struct MessageTwo : public Message
{
    static const int id = 2;
    virtual int msgId() { return id; }
};

struct MessageThree : public Message
{
    static const int id = 3;
    virtual int msgId() { return id; }
};

struct IMessageFactory
{
    virtual ~IMessageFactory() {}
    virtual Message * createMessage() = 0;
};

struct MessageOneFactory : public IMessageFactory
{
    MessageOne * createMessage()
    {
        return new MessageOne();
    }
};

struct MessageTwoFactory : public IMessageFactory
{
    MessageTwo * createMessage()
    {
        return new MessageTwo();
    }
};

struct TopMessageFactory
{
    Message * createMessage(const string& data)
    {
        map<string, IMessageFactory*>::iterator it = msgFactories.find(data);
        if (it == msgFactories.end()) return new NullMessage();

        return (*it).second->createMessage();
    }

    bool registerFactory(const string& msgId, IMessageFactory * factory)
    {
        if (!factory) return false;
        msgFactories[msgId] = factory;
        return true;
    }

    map<string, IMessageFactory*> msgFactories;
};

int main()
{
    TopMessageFactory factory;
    MessageOneFactory * mof = new MessageOneFactory();
    MessageTwoFactory * mtf = new MessageTwoFactory();

    factory.registerFactory("one", mof);
    factory.registerFactory("two", mtf);

    Message * msg = factory.createMessage("two");
    cout << msg->msgId() << endl;

    msg = factory.createMessage("one");
    cout << msg->msgId() << endl;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T22:53:21.287

你不需要让你的代码同时遵循所有可能的原则。目标应该是尽可能多地坚持这些范式，而不是更多。不要过度设计你的解决方案——否则你很可能会得到意大利面条式的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T23:01:22.100

我已经回答了关于 C++ 工厂的另一个 SO question。如果对灵活工厂感兴趣，请查看[那里。](https://stackoverflow.com/questions/410823/factory-method-implementation-c/534396#534396)我尝试从 ET++ 中描述一种使用宏的旧方法，这对我来说非常有用。

该方法基于宏并且易于扩展。

[ET++](http://www.ubilab.org/publications/wei94.html)是一个将旧的 MacApp 移植到 C++ 和 X11 的项目。在此过程中，Eric Gamma 等人开始考虑*设计模式*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T22:55:55.667

首先，您的系统不是那么开放，因为您打开了一个 8 位字符，所以您的消息类型计数不会超过 256 ;-)

开个玩笑，在这种情况下，我会使用一个小模板工厂类（如果您将 char 消息类型放在非类模板 arg 中，或者仅使用该 char 作为状态，则为无状态），它接受您的 stream& 并执行新的在其 T 模板 arg 上，传递 stream& 并返回它。您需要一个小的注册器类来声明为具有全局范围的静态，并使用管理器注册具体的 T 实例化工厂（通过抽象基类指针）（我们有一个通用的，它采用“工厂域”键） . 在您的情况下，我不会使用地图，而是直接使用 256“插槽”数组来放入 factory_base*。

一个你有工厂框架的地方，它很容易且可重用。--DD

# javascript - 分析 javascript 执行的最佳方法是什么？

> ID：855126
> 
> 赞同：96
> 
> 时间：2009-05-12T22:08:41.827
> 
> 标签：javascript, performance, browser, profiling

有没有一个好的 javascript 分析器？我知道萤火虫对分析代码有一些支持。但我想确定更大范围的统计数据。想象一下，您正在构建大量 javascript 代码，并且您想确定代码中的实际瓶颈是什么。首先，我想查看每个 javascript 函数和执行时间的配置文件统计信息。接下来将包括 DOM 函数。这与减慢渲染树上的操作之类的操作相结合将是完美的。我认为如果性能在我的代码、DOM 准备或渲染树/视觉的更新中被杀死，这会给人留下好印象。

有什么接近我想要的吗？或者什么是实现我所描述的大部分内容的最佳工具？它会是一个自编译的浏览器加上通过配置文件功能增强的 javascript 引擎吗？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-05-12T22:10:56.800

# [萤火虫](http://getfirebug.com/docs.html)

Firebug 提供了非常详细的分析报告。它会告诉你每个方法调用在一个巨大的（详细的）表中需要多长时间。

```
console.profile([title])
//also see
console.trace() 
```

你需要打电话`console.profileEnd ()`来结束你的个人资料块。在此处查看控制台 API：http: [//getfirebug.com/wiki/index.php/Console_API](http://getfirebug.com/wiki/index.php/Console_API)

# 黑鸟

Blackbird（~~[官方网站](http://www.gscottolson.com/blackbirdjs/)~~）也有一个更简单的分析器（可以从[**这里**](https://git.io/v1vm0)下载）

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-06-08T19:38:58.920

Chrome 的开发者工具有一个内置的分析器。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-05-13T01:17:15.693

尽管已经提到了 Firebug，但您还想在 Firebug 上看到的另一件事是 Firebug 的插件，称为[**FireUnit**](http://fireunit.org/)；John Resig 在这篇博文中谈到了这一点：

> [**JavaScript 函数调用分析**](http://ejohn.org/blog/function-call-profiling/)

希望有帮助。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-11-30T21:59:20.220

For JavaScript, XmlHttpRequest, DOM Access, Rendering Times and Network traffic for IE6, 7 & 8 you can use the FREE[dynaTrace AJAX Edition](http://ajax.dynatrace.com)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-12T22:29:28.393

Firebug+Firefox 是必须的。并且 IE 8 的开发者工具栏还内置了一个分析器（IE 8 附带开发者工具栏）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-13T01:11:06.927

Safari 4 的网络检查器还包括一个分析器（尽管 nightlies 中的版本在递归函数调用方面有所改进）。Web Inspector 还支持 Firebug 的分析器 API。

# asp.net - 实体框架：不处理我的对象上下文会遇到什么负面影响？

> ID：855129
> 
> 赞同：0
> 
> 时间：2009-05-12T22:09:33.977
> 
> 标签：asp.net, entity-framework, linq-to-entities

**编辑：是否应该将实体框架上下文的副本** [放入 Using 语句中？](https://stackoverflow.com/questions/824330/should-entity-framework-context-be-put-into-using-statement)

一段时间以来，我一直在考虑这个想法，想知道如果没有正确处理我的对象上下文并让它随着 GC 而死，会发生什么坏事。通常，我会避免这样做，但这样做是有正当理由的。

我们正在使用部分类。在这些部分类中，我们公开了访问 FK 对象的属性。例如，假设我有一个带有 CustomerType FK 对象的 Customer 类。在课堂上，我将公开一个执行此操作的 CustomerTypeName 属性：

```
public string CustomerTypeName {
  get {
     if (CustomerType == null) {
         CustomerTypeReference.Load() 
     }

     return CustomerType.CustomerTypeName;
  }
} 
```

如果原始查询没有执行 .Include("CustomerType")，这将非常方便。

但是，如果我处理上下文，则上述属性不再有效。所以......我想这会导致几个问题：

1）如果我从不明确处理上下文，我会看到什么负面影响（如果有的话）？
2）有没有其他方法可以在上述场景中完成延迟加载并且仍然处理上下文？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-12T22:45:18.583

在我对LINQ to SQL 的[回答中](https://stackoverflow.com/questions/196253/linq-to-sql-where-does-your-datacontext-live/196452#196452)[- 你的 DataContext 住在哪里？](https://stackoverflow.com/questions/196253/linq-to-sql-where-does-your-datacontext-live)' 我们在页面的生命周期内将页面作为 DataContext 的所有者，并且当页面本身被处置时，它是正确处置 DataContext 的页面。

正如@Chu 指出的那样，它有点脏，但是如果您要直接在 UI 中使用可以说是数据传输对象的东西，那么您的 UI 应该控制 DataContext 的生命周期。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T03:06:05.913

只要您不继续加载/添加大量新对象，无限期留下的 ObjectContext 就可以了。

加载或添加的每个对象将始终由 ObjectContext 跟踪，直到它被释放，所以如果你从不释放，并且继续跟踪更多的对象，它只会变得越来越大。

您可以考虑的一种选择是使用一些实用方法来访问一些众所周知的上下文或创建临时上下文。

这样做的关键是使用 EntityReference.EntityKey 并确保两个实体都是分离的。

IE

```
this.CustomerType = Utility.GetDetachedObjectByKey<Customer>(
       this.CustomerTypeReference.EntityKey); 
```

GetDetachedObjectByKey 的基本实现是这样的：

```
public static T GetDetachedObjectByKey<T>(EntityKey key) 
     where T: EntityObject
{
    using (MyContext ctx = new MyContext())
    {
        T t = ctx.GetObjectByKey(key) as T;
        ctx.Detach(t);
        return t;
    }
} 
```

这仅在原始对象目标也被分离时才有效。您可以试验此方法使用的 Context 来自何处。

希望这可以帮助

亚历克斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T22:14:36.153

为什么不在屏幕长度内保留上下文？

# php - 限制访问图像的最佳方法......这是对的吗？

> ID：855135
> 
> 赞同：2
> 
> 时间：2009-05-12T22:12:34.567
> 
> 标签：php, image

我想限制对图像的访问，因此，我会将它们放在 web 根目录之外，当用户链接到图像时，它将通过我们数据库中的用户/密码对它们进行身份验证，然后（如果经过身份验证）读取图像文件，并以适当的 MIME 类型输出。

任何图像链接都将类似于：

```
<img src="/image.php?id=324fwqrefv35fq5"> 
```

其中 id 是数据库中的 imageId。

这听起来像一个好方法吗，还有——有没有这样的代码用于 php？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-12T22:15:36.357

听起来是个不错的方法。反正我就是这样攻击它的。代码本身对于您自己编写应该很简单，尽管 Google 可能会在提供其他人的解决方案方面卓有成效。

**编辑**

我没有看到你的链接格式。老实说，这是一个非常丑陋的 URL。为什么不使用 mod_rewrite 或其他东西，这样看起来您正在访问图像？例如，

```
<img src="/image_324fwqrefv35fq5.png"> 
```

只需将 URL 重写为您在答案中指定的格式，以便用户查看更好的 URL。但这既不是这里也不是那里；只是第二个建议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T22:19:06.600

我就是这样做的。我没有看到任何类似的代码，但就像 Marc 所说的那样，编写起来应该很简单。

# perl - 如何在不运行两个单独的处理调用的情况下获得 DBI 中的行数？

> ID：855139
> 
> 赞同：12
> 
> 时间：2009-05-12T22:13:24.953
> 
> 标签：perl, dbi

我在 Perl 中运行 DBI，但无法弄清楚当我运行准备好的语句时，我如何知道返回的行数是否为 0。

我意识到我可以在我的 while 循环中设置一个计数器来获取我的行，但我希望有一种不那么丑陋的方法来做到这一点。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-12T22:20:15.677

根据[这里](http://www.perl.com/pub/a/1999/10/DBI.html)的快速浏览，似乎在你运行之后

```
$statement->execute($arg) 
```

您可以通过访问行数

```
$statement->rows 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-13T03:05:33.200

文档中的[“警告”](http://search.cpan.org/dist/DBI/DBI.pm#rows)（链接到另一个答案的评论中）很重要，并提供了真实、正确的答案：

> 通常，您只能在*非*-SELECT 执行（对于某些特定操作，如 UPDATE 和 DELETE）之后或在获取 SELECT 语句的所有行之后依赖行计数。
> 
> 对于 SELECT 语句，通常不可能知道将返回多少行，除非全部获取它们。一些驱动程序将返回应用程序到目前为止已获取的行数，但其他驱动程序可能会返回 -1，直到所有行都已获取。因此不推荐使用带有 SELECT 语句的 rows 方法或 $DBI::rows。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-13T21:17:25.053

为了找出结果集中有多少行，您有两个选项：

1.  `select count(*)`
2.  遍历结果集并计算行数。

您可以通过返回数组或更花哨的存储过程引入一些魔法，但最终需要发生这两件事中的一件。

所以，没有花哨的方法来获得这个结果。你只需要数一数:-)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-04-17T11:13:05.123

有点晚了，但是如果有人使用 ORACLE，那么汗水解决方案来了：

```
SELECT
  q.*,
  ROWNUM DB_ROWNUM,
  (SELECT max(ROWNUM) FROM ($sql)) DB_COUNT
FROM
  ($sql) q 
```

当然，$sql 是您的查询。Oracles 优化器足够智能，不会执行所有操作两次。

现在，每个获取的行都在 DB_ROWNUM 中保存当前行号（对分页网格行编号有用），在 DB_COUNT 中保存完整的行数。您仍然必须获取至少一行（因此它不完全是上述问题的答案；）），但接下来是汗水使用：

这也是在 Oracle 中进行 start 和 limit 并仍然获得完整行数的一种非常简单的方法：

```
SELECT * FROM (
  SELECT /*+ FIRST_ROWS($limit) */
    q.*,
    ROWNUM DB_ROWNUM,
    (SELECT max(ROWNUM) FROM ($sql)) DB_COUNT
  FROM
    ($sql) q
  WHERE
    ROWNUM <= $limit
)
WHERE
  DB_ROWNUM > $start 
```

有了这个，您实际上只能为网格中的第二页获取第 51 到 100 行，但在每个获取的行中仍然有真实的行号（从 1 开始）和完整的计数（没有开始和限制）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-04T23:23:18.033

试试这个 SQL 解决方案，将数据的 SQL 与 count 语句结合起来。

```
从 tablex 中选择 null、null、null、count(*)
联盟
从 tablex 中选择 foo、bar、foobar、null

```

第一条语句将具有计数，并且应该是第一行（如果不是，您可以订购绕过它）然后您可以在闲暇时循环浏览记录集的其余部分。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-03-23T15:33:09.260

CPAN 说：

> [...] 或在获取 SELECT 语句的所有行之后。

所以做这样的事情可能会奏效：

```
$sth->execute or die $sth->errstr;

say (scalar keys %{$sth->fetchall_hashref('id')}) . ' row(s).'; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-02-07T14:16:41.217

我已经动态生成了一个 SQL 并执行它。对我来说`select count(*)`似乎不是一个选择，因为我必须再次重新生成查询。以下方法对我来说看起来很干净。但是您必须`$h->execute()`再次发出 s 才能检索行数据。

```
$h->execute() or die "ERROR: Couldn't execute SQL statement";
$rowcount_ref = $h->fetchall_arrayref(0);
$rowcount = scalar (@{$rowcount_ref}); 
```

——沙昆塔拉

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-12T23:30:46.933

行肯定会根据看起来的数据库/驱动程序版本而有所不同。我肯定会在那里寻找一个处理意外结果的逻辑。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-08-09T07:20:35.890

我只是让数据库进行计数。如果你想要的只是行数。查找 2018 年 1 月的所有行。

```
$year='2018';
my $qry = "SELECT COUNT(`my_key`) FROM `mtable` WHERE `my_date` LIKE '$year-01-%';";
my ($count) = $dbc->selectrow_array($qry); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-01-13T11:35:37.383

我认为这可以很容易地使用引用来实现。下面的代码显示了如何不需要重新执行查询来获取计数后的行。

```
my $sth = $dbh->prepare("SELECT NAME, LOCATION
                        FROM Employees"); 
$sth->execute() or die $DBI::errstr;

$nrows =  $sth->fetchall_arrayref() ;

print "Number of rows found :" . @$nrows . "\n";

#while (my @row = $sth->fetchrow_array()) {

foreach my $row(@{$nrows}) {
   my ($name, $location ) = @$row;
   print " Name = $name, Location = $location\n";
} 
```

我希望这能满足这里提出的问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-08-11T15:05:08.457

如果您想在遍历所有行之前知道有多少行，特定于 MySQL 的解决方案可能是[FOUND_ROWS()](https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_found-rows)。

在您的第一个查询中，`SQL_CALC_FOUND_ROWS`在`SELECT`. 然后执行`SELECT FOUND_ROWS();`，您可以立即访问行数。现在您可以决定是否要遍历所有行，或者最好的方法。

请注意，`LIMIT`在查询中包含 将为您提供不带`LIMIT`.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-12-06T16:28:28.307

正如其他人已经说过的那样，您确实需要获取行以找出是否有任何行。如果您需要在对每一行开始循环之前知道，并且如果预期结果不是很大，您可以将所有结果放入一个数组中，然后检查。

我最近使用了类似的东西：

```
foreach my $table ( qw(ACTOR DIRECTOR PRODUCER WRITER) ) {
    my $sth = $dbi->prepare(qq{SELECT * FROM $table WHERE DESCRIPTION != TRIM(DESCRIPTION)})
        or die $dbi->errstr;
    $sth->execute or die $sth->errstr;

    my @rows = @{ $sth->fetchall_arrayref() };

    next unless @rows;

    foreach my $row (@rows) {
        print join(", ", map {qq("$_")} @{$row}), "\n";
    }
} 
```

# c# - 创建 PDF 信封

> ID：855149
> 
> 赞同：1
> 
> 时间：2009-05-12T22:16:58.817
> 
> 标签：c#, asp.net, pdf, envelope

我需要创建 PDF 信封的能力，但没有找到一个好的解决方案，所以我认为这可能会引起一些兴趣。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T22:17:59.847

我们使用[PDFSharp](http://www.pdfsharp.net/PDFsharp/)，一个免费的 PDF 文档工具。结果很好。这是这样做的方法。它将创建一个新的 pdf 文档，信封大小，并将地址居中。GetAddress() 只是一种用于从数据库中检索地址的方法。只需使用 \n 换行地址中的不同行。

```
protected void DisplayPDFEnvelope()
{
    try
    {
        PdfDocument document = new PdfDocument();
        PdfPage pdfpage = new PdfPage();

        XUnit pdfWidth = new XUnit(4.125, XGraphicsUnit.Inch);
        XUnit pdfHeight = new XUnit(9.5, XGraphicsUnit.Inch);
        pdfpage.Height = pdfHeight;
        pdfpage.Width = pdfWidth;

        pdfpage.Orientation = PageOrientation.Landscape;

        XPdfFontOptions options = new XPdfFontOptions(PdfFontEncoding.Unicode, PdfFontEmbedding.Always);

        document.AddPage(pdfpage);

        // Create a font
        XFont font = new XFont("ARIAL", 1, XFontStyle.Regular, options);

        // Get an XGraphics object for drawing
        XGraphics gfx = XGraphics.FromPdfPage(pdfpage, XGraphicsPdfPageOptions.Append);

        string address = GetAddress();

        // Get the size (in point) of the text
        XSize size = gfx.MeasureString(address, font);

        // Create a graphical path
        XGraphicsPath path = new XGraphicsPath();

        path.AddString(address, font.FontFamily, XFontStyle.Regular, 10,
          new XPoint(345, 160), XStringFormats.Default);

        // Create a dimmed  pen and brush
        XPen pen = new XPen(XColor.FromGrayScale(0), 0); 
        XBrush brush = new XSolidBrush();   

        // Stroke the outline of the path
        gfx.DrawPath(pen, brush, path);

        MemoryStream stream = new MemoryStream();
        document.Save(stream, false);

        Page.Response.Clear();
        Page.Response.ContentType = "application/pdf";
        Page.Response.AppendHeader("Content-Length", stream.Length.ToString());
        Page.Response.AppendHeader("Content-Type", "application/pdf");
        Page.Response.AppendHeader("Content-Disposition", "inline;filename=envelope.pdf");
        Page.Response.BinaryWrite(stream.ToArray());
        Page.Response.Flush();
        stream.Close();
        HttpContext.Current.ApplicationInstance.CompleteRequest();
    }
    catch (Exception ex)
    {
        throw ex;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T02:41:12.767

PDFSharp 很好，[iTextSharp](http://itextsharp.sourceforge.net/)也很好， iText 的 Java 端口是最早的 PDF 库之一。

# linux - 是否可以关闭 linux 内核并在实模式下恢复？

> ID：855150
> 
> 赞同：4
> 
> 时间：2009-05-12T22:17:04.217
> 
> 标签：linux, linux-kernel, boot, bios, real-mode

假设我想在我的普通操作系统启动之前启动一个小型 linux 发行版。

1.  BIOS 加载 MBR 并执行 MBR。
2.  MBR 找到我的 linux 分区的活动分区。
3.  Linux 启动，我执行我需要做的事情。
4.  Linux 关闭，我再次切换到实模式。
5.  加载原始分区引导扇区并启动我的普通操作系统。

AFAIK，第 4 步将是一项艰巨的任务，在 linux 之前恢复所有设备上的状态，INT13h 可以正常工作吗？我需要恢复中断向量表吗？仅举几例。

这可能在任何现有项目中完成了吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T16:23:02.047

Linux 通常不支持这一点，特别是因为它以 BIOS 和 DOS 程序可能不期望的方式重新初始化硬件。但是，在特定情况下，有一些基础架构可以切换回实模式 - 特别是对于重新启动（请参阅 arch/x86/kernel/reboot.c 中的 machine_real_restart ） - 并且具有重新初始化硬件以进行 kexec 或挂起的代码。我怀疑您可能可以结合这些来做一些事情 - 但我不知道结果是否真正符合 DOS 或 Windows 在重新启动时期望看到的结果。

一个更简单的计划是使用可以设置为以特定配置启动一次的链式引导加载程序，例如[GRUB](http://www.gnu.org/software/grub/manual/grub.html#Booting-fallback-systems)。您可以调用 grub-set-default，然后重新启动。当 GRUB 启动时，它会将控制权交给 Windows。然后将备用操作系统设置为 Linux 分区，控制权将在下一次引导时返回给 Linux。

另一种选择可能是使用[Coreboot](http://www.coreboot.org/SeaBIOS)，但我不确定这是否已准备好用于启动 Windows。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-26T19:09:11.113

我还没有尝试过，所以我不知道它是否会起作用，但这里有：

在 bzImage 格式的内核文件的头文件中有一个选项，它指定了在保护模式代码开始之前要执行的实模式代码的地址。您可以创建一个最小的 bzImage 兼容文件，该文件没有实际内核，但具有实模式代码，可以使用 INT 0x13 到 0x7c00 加载您的 MBR，并像 BIOS 一样 jmp 进入它。

如果您使用 kexec 使用“-t bzImage-x86 --real-mode”选项加载 bzImage，它应该重置 CR0 中的 PE 位以下降到实模式（如上面提到的 bdonlan）并执行指向的代码bzImage 标头选项。

bzImage 标头选项称为 realmode_swtch 并记录在 /usr/src/linux/Documentation/x86/boot.txt 中，标头格式代码在 /usr/src/linux/arch/x86/boot/header.S

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T23:11:58.230

你看过[kexec](http://en.gentoo-wiki.com/wiki/Kexec)吗？

# iis - 如何检查使用 HTTPS/SSL 的 IIS 压缩是否有效？

> ID：855158
> 
> 赞同：1
> 
> 时间：2009-05-12T22:19:56.987
> 
> 标签：iis, https, compression

我已经为 IIS 压缩设置了一个网站，但它似乎不适用于 HTTPS，只能用于 HTTP。是否需要配置一些东西才能使其工作，或者这在 IIS 中不起作用？有哪些选择？

更新：据此，[压缩](http://software.intel.com/en-us/articles/http-compression-for-web-applications/)发生在加密之前。如果 SSL 请求正在发生压缩，我在哪里可以看到它？

UPDATE2：我回到 metabase.xml 文件，发现我所做的更改已经消失。这是我所拥有的：

```
HcDynamicCompressionLevel="9"
    HcFileExtensions="htm
        html
        js
        css
        txt"
    HcOnDemandCompLevel="10"
    HcPriority="1"
    HcScriptFileExtensions="asp
        dll
        aspx
        exe" 
```

我想知道内存中的元数据库是否覆盖了我在能够运行 IISRESET /RESTART 之前所做的更改？

谢谢！

克里斯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T13:14:17.963

压缩应该适用于正常和 ssl 流量，在 IIS 中设置它可能有点棘手，仅仅切换复选框通常是不够的，因为它只会压缩默认情况下的某些文件类型。

[IIS 压缩](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/d52ff289-94d3-4085-bc4e-24eb4f312e0e.mspx?mfr=true)

您的 SSL 站点是否指向 IIS 中的相同应用程序？您是否在服务器上使用了诸如 SSL 加速器硬件之类的东西？

先在port80站点上试试右边的表格，看看IIS是否在压缩：[http ://www.port80software.com/](http://www.port80software.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T00:45:52.240

我不确定 IIS 是如何工作的，但我相信最后会应用压缩。如果是这种情况，那么它就不能很好地处理具有随机特征的加密数据。但是，在将数据交给 IIS 之前，仍然可以在应用程序中手动压缩数据。

# java - 方法调用顺序

> ID：855163
> 
> 赞同：1
> 
> 时间：2009-05-12T22:20:46.660
> 
> 标签：java, matlab

大家好，我用main方法编写java类，我从matlab调用方法，这需要很长时间，程序运行其他方法，在matlab方法之前需要更少的时间。我想先从 matlab 运行该方法，然后再执行另一个方法，请您帮帮我

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T22:22:27.280

听起来你需要线程。您可能会发现[Sun 的并发教程](http://java.sun.com/docs/books/tutorial/essential/concurrency/)很有用。

基本上，您可以执行以下操作：

```
public static void main(String[] args) {
    Runnable r = new Runnable() {
        public void run() {
            doMethod();
            doOtherMethod();
        }
    }
    new Thread(r).start();
    doAnotherMethod(); 
```

另请参阅[`Thread`](http://java.sun.com/javase/6/docs/api/java/lang/Thread.html)和的 Javadocs [`Runnable`](http://java.sun.com/javase/6/docs/api/java/lang/Runnable.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-16T20:22:00.007

我认为您想使用 Matlab[线程的 join()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.html#join())方法等待线程死亡，然后再继续使用其他方法。

我不确定这是否是您所说的“首先执行 matlab 中的方法，然后我希望执行其他方法”。

我只是不知道。这个问题有点有趣，但你为什么不提供你用来调用matlab方法的代码，就像你说的“我从matlab调用方法”。也许如果你展示了如何？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T22:25:55.637

看看 java.util.concurrent 包。这具有并行执行任务和协调任务的功能。

# ms-office - 办公室剪贴板格式

> ID：855165
> 
> 赞同：6
> 
> 时间：2009-05-12T22:21:48.250
> 
> 标签：ms-office, clipboard

如果我从 Excel (2007) 复制图表并在另一个 Office 应用程序中选择选择性粘贴，我会看到一个名为“Microsoft Office 图形对象”的剪贴板格式，它允许与增强型元文件不同的自定义。如何从我自己的 (C++) 应用程序中创建这样的剪贴板对象，以便从 Office 应用程序中获得一流的处理？

图表数据是否像在 Office 应用程序中那样被链接并不重要——我只想提供另一个图表导出选项。

ClipSpy 报告几种二进制格式，包括“Excel 2007 内部形状”、“嵌入源”和“Art::GVML ClipFormat”。我想这些是专有和私有的，但如果有人知道文档，请告诉我。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T06:37:13.417

它实际上是一个 zip 文件（数据以 PK 开头），如果您保存数据（使用[ClipSpy](http://www.codeproject.com/KB/clipboard/clipspy.aspx)），您可以使用您[喜欢的 zip 程序](http://www.7-zip.org/)打开它。

戳进去，你会发现数据是一种开放的 XML 格式[，并不太神秘](http://msdn.microsoft.com/en-us/library/bb264572.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T22:25:28.790

我猜想该格式记录在MS 作为其反垄断裁决的一部分发布[的规范中。](http://msdn.microsoft.com/en-us/library/cc313156.aspx)

不幸的是，您必须阅读并尝试理解它们，它们并不漂亮。

# sharepoint - Microsoft Office SharePoint Server 2007 查询 Web 服务的超时问题

> ID：855168
> 
> 赞同：2
> 
> 时间：2009-05-12T22:22:22.240
> 
> 标签：sharepoint, sharepoint-2007, moss, moss2007enterprisesearch

我们遇到了 MOSS 2007 Web 服务的问题。具体来说，就是 API 的 Query/QueryEx 方法。

我们使用 SQL 语法来查询共享点，并且对于大多数情况，我们的搜索执行时间非常快。但是，当我们添加过滤器和排序时，事情开始变慢。在某些情况下，我们甚至会遇到错误。

例如，这个 MSSQLFT 查询将在大约 50% 的情况下给出 System.ServiceProcess.TimeoutException 异常。超时将在 10 秒左右发生。

```
SELECT WorkId, Rank, ... , PerforceFolder, PerforceDateSubmitted FROM SCOPE() 
WHERE "scope"='Tech_Depot'  AND (FileExtension = 'cpp' )  
ORDER BY PerforceDateSubmitted, Rank DESC 
```

是否有任何设置/查询参数/等...我们可以用来在共享点后端允许更大的 SEARCH 执行时间？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T04:26:21.770

这可能有很多原因：

*   搜索中使用的属性未编入索引，因此搜索时间较长
*   结果集太大，尝试指定行限制

这些工具可以帮助您进行开发： - [SharePoint 搜索服务工具`](http://sharepointsearchserv.codeplex.com/) - [SharePoint Search Bench](http://spsearchbench.codeplex.com/)

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-10T19:58:44.270

[http://msdn.microsoft.com/en-us/library/microsoft.office.server.search.query.query.timeout.aspx](http://msdn.microsoft.com/en-us/library/microsoft.office.server.search.query.query.timeout.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-10T17:52:48.620

信不信由你，这 10 秒的限制是硬编码的。唯一的方法是编写您自己的 Web 服务版本。我已经这样做了，结果在这里：

[http://eliasbland.wordpress.com/2009/12/10/search-webservice-for-sharepoint-search-server-with-configurable-timeout/](http://eliasbland.wordpress.com/2009/12/10/search-webservice-for-sharepoint-search-server-with-configurable-timeout/)

希望这可以帮助，

鲁珀特

# c++ - 如何验证某些模板 *not* 为给定的参数类型编译？

> ID：855171
> 
> 赞同：2
> 
> 时间：2009-05-12T22:22:43.160
> 
> 标签：c++, visual-studio, templates

我正在编写一个智能 ptr 模板，该模板仅针对给定的基类及其子类进行实例化，`MyPtr<U>`只要`MyPtr<T>`转换从 T* 到U*（有效的基类和 const 兼容）。

这在 vs2005 中运行良好，但不适用于 Linux 上的 g++，所以我的同事在那里更改了它，但这样做破坏了 const 正确性。

我的问题是我想对某些转换无效（例如分配`MyPtr<const T>`给`MyPtr<T>`）进行单元测试，导致文件**无法编译**！但是您不能在解决方案中没有未编译的文件...

如果有一些特定于 VS 的 #pragma 或一些可以测试给定构造的 SFINAE 技巧**无效**，因此无法编译？

谢谢，--DD

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T22:32:54.360

您可以运行命令行编译器，`cl`它很容易设置，并捕获其错误消息输出。

没有makefile，几乎没有来自解决方案/项目的任何信息。只是包含路径和源文件。最简单的是，您只需要一个“反转”另一个程序的退出代码的程序：

```
#include <sstream>
#include <stdlib.h>

int main(int argc, char *argv[])
{
    std::ostringstream command;

    for (int n = 1; n < argc; n++)
        command << argv[n] << " ";

    return (system(command.str().c_str()) == EXIT_SUCCESS)
                ? EXIT_FAILURE : EXIT_SUCCESS;
} 
```

它只是将传递给它的参数重组为（省略自己的名称）并退出生成的命令行，然后如果失败则返回成功，如果成功则返回失败。这足以愚弄 Visual Studio 或`make`.

从技术上讲，重组后的命令行应该引用参数，但只有当您足够疯狂地在构建目录或源文件名中放置空格时才需要！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T22:52:44.080

如果给定的参数（在您的情况下为“const T”）将满足所有其他单元测试，除了您正在寻找的这个，这不是表明它将是一个完全可以接受的情况吗？换句话说，如果它有效，为什么要禁止它？

# c# - 从网站获取 IIS 站点 ID

> ID：855176
> 
> 赞同：3
> 
> 时间：2009-05-12T22:23:51.037
> 
> 标签：c#, iis

我在 asp.net c# 中做了一个用户控件。由于我需要检索一些数据，我想在 iis 中获取用于该站点的站点 ID。这可能吗？如果可以，怎么做？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-12T22:50:03.087

这将为您提供站点 ID：

```
Request.ServerVariables[ "INSTANCE_ID" ] 
```

如果您只需要获取一次，则可以在 IIS MMC 中查找日志文件路径。“W3SVC”部分后面的数字也是站点ID。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T22:29:24.273

如果有帮助，这里的一种选择是使用`<location path="site-id">...</location>`全局 web.config（即框架文件夹中的那个）来为不同的站点指定不同的配置选项，例如不同的应用程序设置、连接字符串等。

# c# - 取消 ShowDialog 表单中的点击事件

> ID：855179
> 
> 赞同：0
> 
> 时间：2009-05-12T22:24:38.557
> 
> 标签：c#

我正在使用`xForm.ShowDialog(this);`.

此表单有一个`DialogResult`设置为“确定”的按钮。现在，当我单击“确定”按钮时，会执行一些验证。如果失败，我希望表单保持原样，但表单关闭并返回`DialogResult.OK`主表单。那么我该如何防止这种情况发生呢？

例如

```
Button_click
{
    If validation fails pretend we never came here
    else some code.. return DialogResult.OK
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-12T22:34:43.500

```
Button_click()
{
  if (this.Validate())
  {
    this.DialogResult = DialogResult.OK ;
  }

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T22:29:48.517

如果您不想关闭表单，请在对话框的 FormClosing 事件中将 FormClosingEventArgs Cancel 属性设置为 true。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-12T22:59:22.570

不要将 DialogResult 分配给按钮。可以使用返回 DialogResult 的方法来调用 Form.ShowDialog 方法。如果点击了验证按钮，则验证表单，如果验证成功，则返回预期的 DialogResult。

# c# - 通过使用 [Setup] 方法中的代码输出当前测试的名称

> ID：855181
> 
> 赞同：8
> 
> 时间：2009-05-12T22:25:27.243
> 
> 标签：c#, nunit

我目前在所有测试的顶部都有一条线，如下所示：

```
Console.WriteLine(System.Reflection.MethodBase.GetCurrentMethod().Name); 
```

如果我能把它放在我的 Init 方法（用 标记的那个）中，似乎会很好`[Setup]`。我认为这会起作用，但无论我为堆栈帧输入什么数字，我能得到的最接近的是`Init`. 不是我想要的，但非常接近：

```
string methodName = new StackFrame(0).GetMethod().Name;
Console.WriteLine(methodName); 
```

考虑到 Nunit 运行测试的方式，我认为这可能是不可能的。

你说为什么这样做？因为在我的控制台输出中，很高兴看到新测试从哪里开始，所以如果它们都命中相同的代码并输出不同的值，我会知道哪个做了什么，而无需调试。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-06-01T09:28:46.887

以下内容可以帮助我：

```
string testName = NUnit.Framework.TestContext.CurrentContext.Test.Name;
string testFullName = NUnit.Framework.TestContext.CurrentContext.Test.FullName; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-22T18:50:08.763

TestCaseAttribute 直到 NUnit 2.5 才添加，这可能是您找不到它的原因。但无论如何它都无济于事——不幸的是，SetUp 方法是在测试方法之前调用的，而不是从测试方法的上下文中调用的（因此它不会出现在调用堆栈中）。

幸运的是，NUnit 已经支持你想要做的事情！在 GUI 中，转到工具 > 选项 > GUI > 常规 > 文本输出并选中“显示测试用例标签”。或者，对于控制台运行器，只需添加`/labels`参数即可。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-03-31T09:51:34.110

这是我用来将每个测试记录到文件中的 VB：

```
<SetUp()>
Public Sub Setup()
   Logging.logTest(NUnit.Framework.TestContext.CurrentContext.Test.Name)
End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T22:03:43.230

您可以使用 NUnit.Core.NUnitFramework.TestCaseAttribute 来获取当前的测试名称。

# asp.net-mvc - asp.net mvc 安全性

> ID：855186
> 
> 赞同：1
> 
> 时间：2009-05-12T22:26:25.637
> 
> 标签：asp.net-mvc, authorization, geneva-framework

如何禁止匿名访问我的 ASP.NET mvc 控制器？具体来说，我想要求对所有控制器进行身份验证访问，但允许匿名访问资源类型文件，例如 .css 和 .js 文件。不要像我使用 Microsoft Geneva 一样计划使用会员服务。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T23:21:50.927

一种方法是让您的控制器从（您自己的）ControllerBase 继承。

添加

[授权]

归于那个类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T05:56:31.063

如果您不想对基控制器进行子类化，则可以在每个控制器中的每个操作方法上使用 Authorize 属性（操作过滤器）。

有关操作过滤器的介绍，请参见此处：[http ://www.asp.net/learn/mvc/tutorial-14-cs.aspx](http://www.asp.net/learn/mvc/tutorial-14-cs.aspx)

# python - Python 列表可以有多大？

> ID：855191
> 
> 赞同：140
> 
> 时间：2009-05-12T22:27:33.183
> 
> 标签：python, list, size

在 Python 中，列表可以有多大？我需要一个大约 12000 个元素的列表。我还能运行排序等列表方法吗？

* * *

## 回答 #1

> 赞同：224
> 
> 时间：2009-05-12T23:48:21.557

根据[源代码](https://svn.python.org/projects/python/trunk/Objects/listobject.c?revision=69227&view=markup)，列表的最大大小为`PY_SSIZE_T_MAX/sizeof(PyObject*)`.

`PY_SSIZE_T_MAX`在[pyport.h](https://svn.python.org/projects/python/trunk/Include/pyport.h?revision=70489&view=markup)中定义为`((size_t) -1)>>1`

在常规的 32 位系统上，这是 (4294967295 / 2) / 4 或 536870912。

因此，32 位系统上 python 列表的最大大小为**536,870,912 个**元素。

只要您拥有的元素数量等于或低于此数量，所有列表函数都应该正确运行。

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2013-04-01T07:45:18.747

正如[Python 文档所说](http://docs.python.org/2/library/sys.html#sys.maxsize)：

**系统最大尺寸**

> 平台的 Py_ssize_t 类型支持的最大正整数，因此列表、字符串、字典和许多其他容器可以拥有的最大大小。

在我的电脑（Linux x86_64）中：

```
>>> import sys
>>> print sys.maxsize
9223372036854775807 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-05-12T22:33:28.807

当然可以。实际上你可以很容易地看到：

```
l = range(12000)
l = sorted(l, reverse=True) 
```

在我的机器上运行这些行需要：

```
real    0m0.036s
user    0m0.024s
sys  0m0.004s 
```

但肯定正如其他人所说。数组越大，操作就越慢。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-12T22:36:12.470

在随意的代码中，我创建了包含数百万个元素的列表。我相信 Python 的列表实现只受系统内存量的限制。

此外，尽管列表的大小，列表方法/函数应该继续工作。

如果您关心性能，那么研究[NumPy](http://numpy.scipy.org/)之类的库可能是值得的。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-12T22:29:11.623

12000 个元素在 Python 中不算什么……实际上，只要 Python 解释器在您的系统上有内存，元素的数量就可以达到。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-05-12T23:53:34.090

[列表的性能特征](http://effbot.org/zone/python-list.htm#performance)在 Effbot 上进行了描述。

Python 列表实际上是作为用于快速随机访问的向量实现的，因此容器基本上可以容纳与内存空间一样多的项目。（列表中包含的指针需要空间，指向的对象需要内存空间。）

追加是`O(1)`（摊销的常数复杂度），但是，插入/删除序列中间将需要`O(n)`（线性复杂度）重新排序，这将随着列表中元素的数量而变慢。

您的排序问题更加细致入微，因为比较操作可能需要无限时间。如果您执行非常慢的比较，则需要很长时间，尽管这不是[Python 的 list 数据类型](http://docs.python.org/library/stdtypes.html#sequence-types-str-unicode-list-tuple-buffer-xrange)的错。

反转只需要交换列表中所有指针所需的时间（必然`O(n)`（线性复杂性），因为您触摸每个指针一次）。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2018-12-28T06:06:33.293

它因不同的系统而异（取决于 RAM）。最简单的找出方法是

`import six six.MAXSIZE 9223372036854775807` This gives the max size of `list` and `dict` too ,as per the [documentation](https://pythonhosted.org/six/#six.MAXSIZE)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-12T22:30:24.630

我会说你只受到可用 RAM 总量的限制。显然，数组越大，对它的操作就越长。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-06-08T02:32:23.557

我在 x64 位系统上从这里得到这个：Python 3.7.0b5 (v3.7.0b5:abb8802389, May 31 2018, 01:54:01) [MSC v.1913 64 bit (AMD64)] on win32

[![enter image description here](https://i.stack.imgur.com/4vUY9.png)](https://i.stack.imgur.com/4vUY9.png)

* * *

## 回答 #10

> 赞同：-18
> 
> 时间：2014-03-07T02:44:06.807

列表数量没有限制。导致您的错误的主要原因是 RAM。请升级您的内存大小。

# .net - 如何防止浏览器显示页面的缓存版本？

> ID：855193
> 
> 赞同：5
> 
> 时间：2009-05-12T22:28:08.707
> 
> 标签：.net, asp.net, browser, caching

一种解决方案是将 QueryString 变量添加到作为随机 guid 的 url 中，但这似乎有点混乱。是否有某个设置会阻止浏览器显示页面的缓存版本？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-12T22:33:34.563

您可以像这样添加元标记。

```
<meta http-equiv="pragma" content="no-cache" /> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-12T22:40:52.507

在我们的 ASP.Net 项目中，我们创建了一个所有其他页面都继承自的 BasePage。在基本页面中，我们有一个功能

```
Public Sub DisableCaching()
    With Response
        .Expires = 0
        .ExpiresAbsolute = Date.Today.AddDays(-1)
        .AddHeader("pragma", "no-cache")
        .AddHeader("cache-control", "no-cache")
    End With
End Sub 
```

我们在不想缓存的任何页面上调用它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-12T22:31:57.920

**一种方法是添加“过期**或缓存控制标头”。

这已从 Yahoo Best Practices ( [http://developer.yahoo.com/performance/rules.html](http://developer.yahoo.com/performance/rules.html) )中提取

这条规则有两点：

```
* For static components: implement "Never expire" policy by setting far future Expires header
* For dynamic components: use an appropriate Cache-Control header to help the browser with conditional requests 
```

浏览器（和代理）使用缓存来减少 HTTP 请求的数量和大小，从而加快网页加载速度。Web 服务器使用 HTTP 响应中的 Expires 标头来告诉客户端组件可以缓存多长时间。这是一个遥远的未来 Expires 标头，告诉浏览器此响应在 2010 年 4 月 15 日之前不会过时。

```
 Expires: Thu, 15 Apr 2010 20:00:00 GMT 
```

如果您的服务器是 Apache，请使用 ExpiresDefault 指令设置相对于当前日期的到期日期。ExpiresDefault 指令的此示例将 Expires 日期设置为自请求时间起 10 年。

```
 ExpiresDefault "access plus 10 years" 
```

因此，基本上您将能够设置过期日期以“通知”浏览器缓存组件已过期。因此，浏览器将再次请求该站点。

假设您需要这个用于 Web 开发，另一种方法是强制清除缓存。在 Firefox 上，这可以通过 CTRL + F5 或 CTRL + SHIFT + R 来完成。

希望这会有所帮助，卢卡斯

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-12T22:33:39.273

将 Cache-Control 标头设置为 no-cache。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-12T22:43:18.243

试试这个：

```
Response.Cache.SetExpires(DateTime.Now.AddSeconds(360));
Response.Cache.SetCacheability(HttpCacheability.Private)
Response.Cache.SetSlidingExpiration(true);

Page.Response.Cache.SetCacheability(HttpCacheability.NoCache) 
```

另请参阅此[问题](https://stackoverflow.com/questions/533867/whats-the-best-method-for-forcing-cache-expiration-in-asp-net)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-12T22:42:03.253

> 一种解决方案是将 QueryString 变量添加到作为随机 guid 的 url 中，但这似乎有点混乱

为什么乱七八糟？这是最可靠的方法。这不是必要的指导，它可能是当前时间。

# tsql - 如何在 Sybase 中查找所有包含字符串的数据库对象

> ID：855194
> 
> 赞同：0
> 
> 时间：2009-05-12T22:28:50.983
> 
> 标签：tsql, sybase

有时我需要在数据库中查找一些字符串，通常它只是主机名或 IP 地址。

是否有任何脚本可以在我有权访问的所有 Sybase db 对象（或至少在所有表中）中找到字符串。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-28T21:36:56.427

sysobjects + cursor + EXECUTE 上的查询有效。有点像。

```
sp__map_object 'SELECT * FROM %O where name like "bar%"', 'foo_%'

```

代码中有很多错误/问题/担忧，我不愿意发布它，但我对 Sybase 的同胞有一定的同情。

[Rob Verschoor 在http://www.sypron.nl/new_ssp_dwn.html](http://www.sypron.nl/new_ssp_dwn.html)上有一堆不错的存储过程

pjjH

```
289:1> ? sp__map_object
（受影响的 1 行）
/*
 *
 * 运行时要小心！！！
 *
 * 请参阅 sp__map_db.sql 中的严重警告列表
 *
 * 对每个对象的存储过程运行给定的命令
 * 匹配 @object_pat 并将 %O 的第一个实例替换为
 * 姓名。
 *
 * 只需在 Perl 中执行此操作。或者重构 sql 使其适用于一些理智的人
 * 用户、登录名、数据库和对象的交叉产品。
 *
 *保罗·哈灵顿
 *
 */
创建过程 sp__map_object
  @sql VARCHAR(255) = 'sp__help',
  @objpat VARCHAR(32) = NULL，
  @type VARCHAR(2) = 'U',
  @do_it INT = 1，
  @verbose INT = 0
作为
开始
  设置无计数
  声明 object_cursor CURSOR
  为了
    选择不同的名称
    来自系统对象
    像@objpat这样的名字
      和类型像@type
  声明 @munged_sql VARCHAR(255)

  声明@object_name varchar(64)
  打开 object_cursor
  FETCH object_cursor INTO @object_name
  而@@sqlstatus = 0
  开始
    IF CHARINDEX('%O', @sql) 0
    SELECT @munged_sql = SUBSTRING(@sql, 1, CHARINDEX('%O', @sql) - 1) +
                  @object_name +
                  SUBSTRING(@sql, CHARINDEX('%O', @sql) + 2, 255)
    别的
      选择 @munged_sql = @sql

    如果（@do_it = 0 或 @verbose = 1）
    开始
       声明@msg varchar(255)
       选择@msg = @munged_sql
       选择@msg
    结尾

    如果@do_it = 1
        执行（@munged_sql）
    FETCH object_cursor INTO @object_name
  结尾
  关闭 object_cursor
  DEALLOCATE CURSOR object_cursor
  设置无计数
结尾

去

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T22:32:35.377

没有我知道的本地人。您也许可以滚动一个查询系统表以获取对象列表的过程，然后让游标遍历并根据给定的搜索条件查询这些对象。

# jquery - jQuery.datePicker - 计算天数

> ID：855203
> 
> 赞同：1
> 
> 时间：2009-05-12T22:31:34.643
> 
> 标签：jquery, datepicker

嗨！

我正在使用来自 Kelvin Luck 的 jquery.datePicker 示例。（[http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/datePickerClickInput.html](http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/datePickerClickInput.html)）

如何计算 Date1 和 Date2 之间的天数？

伙计们！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T22:44:28.163

像这样的东西：

```
function returnNumberOfDaysBetweenTwoDates(input1, input2) {
    var date1 = new Date(input1.value);
    var date2 = new Date(input2.value);

    var minutes = 1000*60;
    var hours = minutes*60;
    var days = hours*24;

    var diff = Math.abs(date1.getTime() - date2.getTime());

    return round(diff / days);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-03T08:19:53.377

不要忘记函数名称 Math.：

```
return Math.round(diff / days); 
```

# java - JMS 与 Web 服务

> ID：855210
> 
> 赞同：24
> 
> 时间：2009-05-12T22:32:48.200
> 
> 标签：java, web-services, jms

JMS 相对于 Web 服务的最大优势是什么，反之亦然？

（Web 服务是否臃肿？JMS 总体上是否更适合提供接口？）

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-12T22:57:31.200

埃里克森更正后编辑：

JMS 要求您有一个 JMS 提供者、一个实现 MessageListener 接口以处理消息的 Java 类，以及一个知道如何连接到 JMS 队列的客户端。JMS 意味着异步处理——客户端发送消息并且不一定等待响应。JMS 可用于点对点队列方式或发布/订阅。

“服务”是一个流动的术语。我将服务视为存在于网络上并宣传合同的组件：“如果您向我发送 X，我将为您执行此任务并返回 Y。”

分布式组件已经存在了很长时间。每个人都使用不同的协议（例如，COM、Corba、RMI 等）进行通信，并以不同的方式公开他们的合同。

Web 服务是分布式服务的最新趋势。他们使用 HTTP 作为他们的协议，并且可以与任何可以通过 TCP/IP 连接并发出 HTTP 请求的客户端进行互操作。

您可以使用 SOAP 或 RPC-XML 或 REST 或“契约优先”样式，但使用 HTTP 作为其协议的分布式组件的基本思想仍然存在。

如果您接受所有这些，Web 服务通常是同步调用。它们不必臃肿，但你可以用任何风格或语言编写糟糕的组件。

您可以通过首先设计请求和响应来开始设计任何分布式组件。鉴于这些，您可以根据想要拥有的客户端类型以及通信是同步还是异步来选择 JMS 或 Web 服务。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-12T23:14:40.907

基于消息的系统，包括 JMS，提供了与另一端“按时间顺序分离”的能力。可以在另一端不可用的情况下发送消息。

所有其他常见的 A2A 方法都要求合作伙伴能够立即响应，要求他们能够处理峰值负载，而几乎没有分散处理的能力。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-12T23:10:14.143

我想说最大的区别是 JMS 是面向消息的，而不是面向 RPC 的。开箱即用的大多数 JMS 提供程序都支持执行重试、防止重复和支持事务的高级协议。

有许多应用程序不需要这些功能。但是在需要它们的地方，在 RPC 机制之上自己构建它们是复杂、昂贵且容易出错的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-12-18T01:04:41.430

**Web 服务**是面向服务的体系结构 (SOA) 的一种实现。SOA 包含三方：提供者、代理和请求者，它们是松散耦合的。提供者提供代表特定实现的业务服务，请求者无法直接看到该实现。请求者从代理那里了解它必须从提供者发送和接收的信息结构，以及使用什么协议来访问该服务。请求者不知道提供者实现业务服务的方式。

Web 服务被定义为请求者和提供者之间所需的业务接口，而不是所有业务请求的公共管道。有几个变量可以表征 Web 服务，包括：

*   它们可以紧密耦合，它们的部署可以基于调用框架的使用。
*   它们可以以同步请求/回复模式或异步模式执行。
*   它们可以由 J2EE 或非 J2EE 提供者公开。
*   它们可能会或可能不会提供对交易和安全性的支持。

* * *

**JMS**是一个基于异步消息的接口。您还可以使用 JMS 访问分布在异构系统中的业务逻辑。拥有基于消息的界面可实现以下功能：

**点对点和发布/订阅机制**。基于消息的框架可以将信息推送到其他应用程序，而无需明确请求。相同的信息可以并行传递给许多订阅者。

**节奏独立。**JMS 框架在异步模式下运行，但也提供模拟同步请求/响应模式的能力。这允许源系统和目标系统同时工作，而无需相互等待。

**保证信息传递**。JMS 框架可以在事务模式下管理消息并确保消息传递（但不保证传递的及时性）。

**异构框架之间的互操作性**。源应用程序和目标应用程序可以在异构环境中运行，而无需处理与其各自框架相关的通信和执行问题。

**使交流更加流畅**。切换到消息模式允许更细粒度的信息交换。

[![在此处输入图像描述](https://i.stack.imgur.com/3ui81.jpg)](https://i.stack.imgur.com/3ui81.jpg)

[来源](http://www.ibm.com/developerworks/webservices/library/ws-jcajms/index.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-12-05T17:35:43.567

让我谈谈 Web 服务的 SOAP 协议实现……JMS 与 Web 服务更好……JMS 提供传输协议，它是底层消息传递提供程序，它描述了你的 JMS 提供程序的好坏，例如 MQ 是一个强大的可靠的 JMS 提供程序，其中 SOAP 协议既可以被视为应用程序级协议，也可以被视为传输协议（在 SOAP/HTTP 的意义上）...SOAP 的好处是支持基于 XML 的标准...作为应用程序级协议，我们将 SOAP 视为通过任何传输协议从一个系统传递到另一个系统的消息，其中作为传输协议，SOAP 可以被视为传输有效负载（消息数据）的容器......SOAP/HTTP 可以也被视为 JMS 消息传递提供者....但在后一种形式中，HTTP 存在可靠性问题，因为它涉及与网络、套接字连接、带宽等相关的错误......所以长话短说，具有可靠消息提供程序的 JMS 使其成为与良好传输协议交互的良好标准，其中 web 服务作为应用程序级协议使不同的应用程序使用XML-like-SOAP 协议...希望这可以澄清...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-12T23:04:36.713

从我所做的这些是我发现的差异： JMS - 我与 JMS 提供者绑定 - 但是我可以选择实现类型（发布/订阅，点对点） Web 服务 - 更易于处理/架构师- 然而，它更多的是盒子之间的直接通信。许多工具可用于开发 - 以及干净的接口 (WSDL)，因此实现者和调用者可以独立。

使用哪一个？取决于问题是什么。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-13T05:01:07.487

将此作为评论添加到 dyffymo 的帖子中，但还没有代表。

引用你的回答：

“Web 服务是分布式服务的最新趋势。它们使用 HTTP 作为协议，可以与任何可以通过 TCP/IP 连接并发出 HTTP 请求的客户端进行互操作。

您可以使用 SOAP 或 RPC-XML 或 REST 或“契约优先”样式，但使用 HTTP 作为其协议的分布式组件的基本思想仍然存在。”

* * *

我假设 Web 服务是指 WS-* 协议集、WSDL 和 SOAP。如果是这样，那么这些都不需要使用 HTTP 作为“传输”协议。SOA 协议集设计为与所使用的传输协议无关，因此您可以使用 HTTP、NamedPipes、原始 TCP 甚至 JMS 作为与 Web 服务之间传输消息的方法。

因此，在直接使用 JMS 与使用“Web 服务”的情况下，我认为这主要归结为工具、舒适度以及您是否真的需要直接访问某些 JMS 特定功能（使用 WS-* 会隐藏你）。在这一点上，我认为只有相当特殊的应用程序才需要原始 JMS 访问。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-09-17T01:20:27.587

这完全取决于您的要求、您将使用什么框架以及您的应用程序环境和行为。如果您可以对此进行概述，那么您可以获得严格的答案。

现在就像将卡车与轿车进行比较，您必须知道将其用于什么以及在哪条道路上才能决定哪条更好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-11-10T19:20:52.353

JMS 和 WS 都支持分布式应用程序。区别在于异步（JMS）与同步（Web 服务）。Web 服务可以用 SOAP 或 REST 样式实现。JMS 是一个 api，它支持两种模式的通信——点对点和发布订阅。Apache ActiveMQ、RabitMQ 是众多 JMS 实现者中的一部分。

# html - 提交按钮有斜角我无法摆脱

> ID：855222
> 
> 赞同：20
> 
> 时间：2009-05-12T22:37:15.353
> 
> 标签：html, css, forms, button

我试图摆脱大多数浏览器/操作系统在提交按钮上设置为默认的默认斜角和边框。当我使用 CSS 添加背景图像时，它只是在按钮的背景中显示图像，但斜角仍然存在。有没有办法让按钮只显示我的图像？这样做的唯一方法是在 html 输入元素的 src 标记中设置图像路径吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-05-12T22:38:48.080

您将需要像这样删除边框（斜角）：

```
input {
    border: 0;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-12T22:38:52.463

您可以在 CSS 中设置边框属性。我总觉得

```
 border: 1px solid black; 
```

看起来不错。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-12T22:41:15.440

我不建议更改按钮的外观，因为它与网站上其他按钮的外观不一致，并且用户更难找到并识别为提交按钮。如果您真的想继续，我强烈建议您进行可用性测试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-12T22:41:22.570

如果要使用自己的按钮图像，则需要定义自己的按钮，如下所示：

```
<div class="button">
  <a href="#">Login</a>
</div> 
```

和CSS：

```
div.button
{
    position: relative;
    display: block;
    float: left;
    margin: 0;
    border: 0;
    padding: 0;
    background: url(button_right_normal.gif) no-repeat right top;
}

div.button a
{
    position: relative;
    display: block;
    margin: 0;
    border: 0;
    padding: 2px 15px 5px 15px;
    height: 18px;
    background: url(button_left_normal.gif) no-repeat left top;
    color: #ffffff;
    font-size: 11px;
    text-decoration: none;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-08-07T09:00:35.873

我在输入按钮上遇到了同样的问题。有一次 IE8 看起来就像我想要“开箱即用”一样，而 Chrome 让我失望了！

对我有用的 CSS 是：

```
input[type="button"] {
    border: 0;
    border-width: 2px;
    border-color: white;
    border-style: solid;
} 
```

边框：0；删除 3D 斜面（边框样式），然后我将其替换为在 IE8 和 Chrome 中都能很好呈现的扁平边框。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-12T22:41:35.517

您可以使用边框 CSS 属性删除边框。例如：

```
<input type=button value="Hello" style="border:0"> 
```

（你当然可以把它移到你的样式表中。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-04-25T23:11:04.083

您可以使用任何 img 作为背景（例如透明圆角），只需在 css 中添加“背景颜色：透明；”

HTML（标准的官方“提交”按钮） - 没什么特别的（我不喜欢将代码与样式混合）：

```
<input type="submit" name="submit" id="mystyle" value="send e-mail"/> 
```

然后在 css 中（与普通链接相同，除了终止边框和默认背景）

```
#mystyle {
background-color: transparent;
border-top-style: none;
border-right-style: none;
border-bottom-style: none;
border-left-style: none;
} 
```

没有像官方提交按钮这样的 CSS，无论你设计什么都有 CSS。

测试：Chrome、IE、Opera

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-05-01T05:45:36.113

我一直在寻找答案，看到了这一点，并在我想出解决办法后决定权衡一下。以下所有答案都是正确且有帮助的，直到仍然可以看到一个小的灰色边框。

没有人提到：背景尺寸：封面；

这从按钮中删除了最后一点灰色。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-13T03:53:02.607

我认为您可以指定按钮和提交按钮的外观：

```
input[type=button], input[type=submit] { border: 0 } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-12T23:00:07.577

您可以对样式表（或`<style>...</style>`页面上的 at 标记内）进行如下操作，并使用一些高级 CSS 选择器：

```
input[type=submit], input[type=button], /* Advanced CSS selectors */
input.button /* For older browsers you can add a 'button' class to each button where you want a bkg img */
{
  border: 0;
  background-image: url("/images/foo.png");
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-12T23:13:40.193

请注意，Safari 对提交按钮的样式非常固执。

```
<button type="submit"></button> 
```

更灵活。但是，如果您在一个表单中使用多个按钮，IE6 就会出现问题。IE 也提交`innerHTML`按钮元素，而 Firefox 提交`value`属性（这对我来说更有意义）。

# filter - Wireshark 信息过滤器帮助

> ID：855230
> 
> 赞同：8
> 
> 时间：2009-05-12T22:40:57.080
> 
> 标签：filter, wireshark

我已经在网上寻找有关如何过滤信息列的教程，但找不到任何有意义的内容。

我想过滤所有信息列包含文本“insitu-conf”但无法找出方法的日志。请帮忙。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-12T22:56:14.153

你实际上不能直接这样做。不过，info 列是根据数据包的属性解码的，您可以过滤这些将具有完全相同的效果。唯一的区别是您必须弄清楚wireshark 使用什么信息来创建该信息行，这可能是不直观的。

在此示例中，“insitu-conf”是端口 1490 的端口别名（grep insitu-conf /etc/services），因此 wireshark 告诉您这是从远程端口 51811 到本地端口 1490 的数据包。因此，过滤器捕获这些数据包将是'dst port = 1490'。

在其他情况下，可能会有一个更具描述性的信息行，它来自数据包的几个属性，包括端口和一些数据——例如，端口 80 上的 http 请求将有一个信息行，实际上包括第一个http请求的行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T22:47:20.920

您在寻找[捕获过滤器](http://wiki.wireshark.org/CaptureFilters)或[显示过滤器](http://wiki.wireshark.org/DisplayFilters)吗？“insitu-conf”是主机名吗？

编辑：

看起来 insitu-conf 是端口 1490，所以一个简单的过滤器如下：

```
tcp.port == 1490 || udp.port == 1490 
```

应该做的伎俩。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-10T14:45:44.327

您可以使用 Microsoft 网络监视器来解决问题。

在 Microsoft 网络监视器中打开您的文件。
右键单击“描述”列中的项目，然后从上下文菜单中选择“将“描述”添加到显示过滤器”。
显示过滤器被添加到过滤器窗口。
点击过滤器工具栏上的应用按钮。

例子：

```
Description == "HTTP:Request, GET / "
Description.contains("Request")
Description.contains("insitu-conf") 
```

[http://www.lovemytool.com/blog/2011/03/microsoft-network-monitor-34-search-the-description-column-by-joke-snelders.html](http://www.lovemytool.com/blog/2011/03/microsoft-network-monitor-34-search-the-description-column-by-joke-snelders.html)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-06-01T18:32:34.400

`http.request.uri`匹配“insitu-conf”也应该有效。

# c# - 当单词出现的顺序或次数不重要时，两个字符串之间的最佳匹配？

> ID：855237
> 
> 赞同：2
> 
> 时间：2009-05-12T22:41:51.243
> 
> 标签：c#, algorithm, string, word, pattern-matching

当单词出现的顺序或次数不重要时，匹配或计算 C# 中两个字符串之间距离的最佳算法是什么？

最佳手段：

*   大多同意人类比赛
*   优雅的
*   高效的
*   可扩展，以便输入字符串可以匹配到可能很大的其他字符串集合

相关问题：

*   [近似字符串匹配算法](https://stackoverflow.com/questions/49263/approximate-string-matching-algorithms)
*   [高效的字符串匹配算法](https://stackoverflow.com/questions/613133/efficient-string-matching-algorithm)

一些注意事项：

*   由于顺序和出现的独立性，输入可以被认为是一组独特的单词，而不是字符数组意义上的字符串
*   不是专门寻找数据库解决方案，虽然会很有趣
*   我太老了，不能成为家庭作业问题；）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T23:10:06.423

这看起来像是应用标准信息检索算法的典型案例。余弦距离是首先想到的，但可能会更适合您的特定情况。这是开始挖掘该路线的一个很好的链接：

[http://www.miislita.com/information-retrieval-tutorial/cosine-similarity-tutorial.html](http://www.miislita.com/information-retrieval-tutorial/cosine-similarity-tutorial.html)

实现示例：

[如何计算两个向量的余弦相似度？](https://stackoverflow.com/questions/520241/cosine-similarity-of-vectors)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-02T16:04:01.680

寻找一种称为“双元音素”的方法，我相信对于每个单词的比较来说它是最好的。也适用于不同的语言！很神奇。

如果比较字符串，也许您可​​以将其与余弦相似度一起使用。会产生完美的结果。

# ruby-on-rails - 你如何在 Rails 中指明 form_tag 的提交位置？

> ID：855238
> 
> 赞同：2
> 
> 时间：2009-05-12T22:41:55.673
> 
> 标签：ruby-on-rails, webforms, controller

我是 Rails 新手，不确定如何指定 form_tag 提交到的位置？

```
<% form_tag do %>
<%= submit_tag "checkout_submit" %>
<% end %> 
```

在上面的例子中，这个表单是否将自己提交给来自呈现这个视图的同一个控制器的“checkout_submit”操作？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-12T23:07:09.733

如[文档](http://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#M001697)中所示：

```
form_tag('/posts')
# => <form action="/posts" method="post">

form_tag('/posts/1', :method => :put)
# => <form action="/posts/1" method="put">

form_tag('/upload', :multipart => true)
# => <form action="/upload" method="post" enctype="multipart/form-data">

<% form_tag '/posts' do -%>
  <div><%= submit_tag 'Save' %></div>
<% end -%>
# => <form action="/posts" method="post"><div><input type="submit" name="submit" value="Save" /></div></form> 
```

# linq - 嵌套 Linq 查询

> ID：855241
> 
> 赞同：2
> 
> 时间：2009-05-12T22:42:52.113
> 
> 标签：linq

什么是有效的 Linq 语句

```
from a in Active_SLA 
where a.APP_ID == (from f in FORM_PAGES where f.PAGE_ADDRESS == @Address select f.APP_ID)
    && a.PERSON_ID == (from p in PERSON_DEVICES where p.DEVICE_NUMBER == @number select p.PERSON_ID) 
select a.PRIORITY 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T22:54:06.480

您应该使用连接语句根据匹配列组合表，而不是嵌套查询。

在您的示例中，正确的 Linq 查询将如下所示：

```
from a in Active_SLA
join f in FORM_PAGES on a.APP_ID equals f.APP_ID
join p in PERSON_DEVICES on a.PERSON_ID equals p.PERSON_ID
where (f.PAGE_ADDRESS == @Address) && (p.DEVICE_NUMBER == @number)
select a.PRIORITY; 
```

希望有帮助！

# asp.net - 在 Asp.Net 中从页面 A 移动到页面 B。什么是最好的方法？

> ID：855244
> 
> 赞同：0
> 
> 时间：2009-05-12T22:43:19.650
> 
> 标签：asp.net, performance, client-side, server-side, pt

我有一个用户，我们称之为 PageA.aspx。此用户需要访问 PageB.aspx。显而易见的方法是使用超链接将它们简单地发送到 PageB.aspx。这让我想到了在页面之间获取的其他方法。可以使用 javascript 进行客户端跳转。还有看似庞大的服务器端重定向。

我想知道的是，如果有的话，这些不同方法之间的性能影响是什么。我将假设服务器端的重量要重一些，但是要重多少呢？这些方法的规模是否不同？以一种方式与另一种方式相比是否存在任何隐藏的问题？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-12T22:50:48.997

在大多数情况下，真正的链接是最好的。所有用户代理都知道链接是什么以及它代表什么。它最适合 SEO、可访问性和可用性。

如果您需要，例如，需要跟踪有关单击哪个链接的详细信息，则服务器端（通过回发）重定向很好……但这是对服务器的附加请求（以及对用户的时间）。它还搞砸了 SEO（等），因此它只是在适当的“网络应用程序”中的一个可行选项，其中蜘蛛或可访问性被控制或忽略。

JS 可以为您提供跟踪功能，但在禁用 JS 的环境中（单独）它是无用的。将活动发送回服务器会增加负载，因此需要考虑。

***如果您需要它***，请考虑使用标准链接并使用 jquery 来挂钩单击事件以跟踪事物。但真的......只有当你需要它时，它会稍微减慢用户体验。

## 简而言之：除非您有充分的理由不这样做，否则请遵守标准。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T22:58:50.717

我认为重要的问题是用户为什么从 PageA 转到 PageB？他们做了什么导致这种情况发生？

是因为他们请求了一些不同的资源（“获取”），他们是否将数据提交到您的服务器（即它是“帖子”的一部分），用户是否知道 PageA 与 PageB 不同（它们在概念上是否相同资源，但对它有不同的看法）或其他什么？

其他考虑因素，例如在没有 PageA 的情况下是否可以访问 PageB（是否可以添加书签，是否有自己的 URL，是否应该在浏览器中将其视为不同的 URL？）将指导您。

如果不理解这些东西，很难给你一个“最佳”的解决方案。

至于使用 Server.Transfer 或 Response.Redirect，这里已经介绍了这两种方法的区别：

[Server.Transfer 对比 Response.Redirect](https://stackoverflow.com/questions/224569/server-transfer-vs-response-redirect) [Response.Redirect 和 Server.Transfer](https://stackoverflow.com/questions/521527/response-redirect-vs-server-transfer) [我什么时候可以通过 PostBackURL 使用 Server.Transfer？](https://stackoverflow.com/questions/65956/when-would-i-use-server-transfer-over-postbackurl)

哦，这些都不适合 ASP.NET MVC 应用程序，您应该改为路由到控制器上的操作。

[http://weblogs.asp.net/mikebosch/archive/2008/02/02/asp-net-mvc-tip-2-redirecting-to-another-action-and-passing-information-to-it.aspx](http://weblogs.asp.net/mikebosch/archive/2008/02/02/asp-net-mvc-tip-2-redirecting-to-another-action-and-passing-information-to-it.aspx) [重定向在其他控制器中操作](https://stackoverflow.com/questions/313789/redirect-to-action-in-other-controller)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T02:52:46.533

我的一般做法是，任何显示数据的页面都应该是一个 get。帖子应该接受数据，但不返回它，恕我直言。

因此，我（几乎）总是在发帖后进行重定向。这是防止用户错误的小成本。

一方面，它阻止了相同数据的多个帖子——如果用户出于任何原因重新加载（或点击后退按钮），我不希望重新提交数据。

搜索引擎问题也是一个重要问题。如果 PageB 是您要编入索引的页面，则无法通过 javascript 或帖子找到它。

# fonts - 将几个位图组合成（TrueType）字体

> ID：855250
> 
> 赞同：1
> 
> 时间：2009-05-12T22:46:00.470
> 
> 标签：fonts, truetype, pixel-fonts, bitmap-fonts

我有几个（~200）个带有字形图像的小位图文件。如何将它们组合成一个位图字体文件？

实际上，我需要从这些位图创建的 TrueType 字体（没有曲线、平滑、矢量化或任何转换）。这是一个设计师的“像素”字体，所以它应该有粗糙的像素边缘等等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T01:57:58.190

也许[这个](http://chris.pirillo.com/how-to-create-your-own-truetype-font-for-free/)或[fontforge](http://fontforge.sourceforge.net/)有任何帮助。

# wpf - 如何取消路由事件？

> ID：855258
> 
> 赞同：2
> 
> 时间：2009-05-12T22:48:51.183
> 
> 标签：wpf, events, checkbox

我有一个 WPF 应用程序，当用户取消选中复选框时，应用程序将提示确认。如果用户选择不继续（取消）被选中，我想取消取消选中事件。换句话说，我希望复选框保持选中状态。

我怎么能在 WPF 中做到这一点？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T02:06:07.517

可能最干净的方法是在绑定上使用[数据验证](http://karlshifflett.wordpress.com/2008/04/03/wpf-sample-series-handling-and-reporting-wpf-data-binding-validation-errors-and-exceptions/)，其中您的“IsValid”功能是用户是否对提示回答“是”。

**更新：** [这篇文章](http://www.codeproject.com/KB/WPF/wpfvalidation.aspx)也不错

# python - 仅在 Python 中获取函数范围的本地字典

> ID：855259
> 
> 赞同：0
> 
> 时间：2009-05-12T22:49:01.730
> 
> 标签：python, django, scope, django-views, locals

我一直在这种情况下结束，我想使用字典，非常像“本地人”返回的字典，但它只包含函数有限范围内的变量。有没有办法在python中做到这一点？

关于我为什么要这样做的更多信息：我正在使用 Django，当我去提供我的模板上下文时，我被迫要么手动制作字典（违反 DRY 原则）要么传入 locals()其中包含更多的条目然后需要（浪费）。django 是否有一些我缺少的东西可以减轻对 python 级解决方案的需求？

澄清：

因此，我反复遇到的情况是：

```
@render_to('my_template.html') 
def myview(request): 
    var1 = #blahblah 
    var2 = #... 
    # do stuff with vars 
    return {'var1': val1,'var2':val2} 
```

因此，我不会重复这些变量和命名约定，而是：

```
@render_to('my_template.html') 
def myview(request): 
    var1 = #blahblah 
    var2 = #... 
    # do stuff with vars 
    return locals() 
```

我觉得它更干净，但我知道它有点草率，因为 locals() 中还有大约 30 个条目，而我实际上需要。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-12T22:57:12.763

我不确定我是否同意制作字典违反 DRY，但如果您真的不想重复任何内容，您可以在视图顶部定义一个“上下文”字典并使用字典键而不是整个视图中的变量。

```
def my_view(request):
    context = {}
    context['items'] = Item.objects.all()
    context['anothervalue'] = context['items'][2].name
    return render_to_response('template.html', context) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-12T22:54:22.063

传递字典如何违反 DRY？[Django 是关于 DRY](http://docs.djangoproject.com/en/dev/misc/design-philosophies/#don-t-repeat-yourself-dry)的，所以我怀疑它的标准行为会直接违反它。然而，无论哪种情况，我都使用[django-annoying](http://bitbucket.org/offline/django-annoying/wiki/Home)的修改版本来使整个事情变得更容易：

```
@render_to('my_template.html')
def myview(request):
    # figure stuff out...
    return {'var1':'val1','var2','val2'} 
```

装饰器`render_to`负责处理请求上下文和所有好东西。效果很好。

如果这没有帮助，我建议改写你的问题。无论您想做什么，`locals()`都很少需要这样做，尤其是在 Django 的这种情况下。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-12T23:14:39.100

你说你不喜欢使用 locals() 因为它是“浪费的”。浪费什么？我相信它返回的字典已经存在，它只是给你一个参考。而且即使它必须创建字典，这也是 Python 中优化程度最高的操作之一，所以不用担心。

您应该专注于最能表达您的意图的代码结构，并且出错的可能性最小。你所担心的浪费没什么好担心的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T09:02:09.997

虽然我同意许多其他受访者的观点，即传递其中一个`locals()`或完全指定的 dict`{'var1':var1, 'var2': var2}`很可能是可以的，但如果您特别想“子集”一个 dict，例如，`locals()`这也远非难，例如：

```
loc = locals()
return dict((k,loc[k]) for k in 'var1 var2'.split()) 
```

# javascript - 当弹出窗口中的 JavaScript 更改输入元素时引发“onChange”事件

> ID：855264
> 
> 赞同：8
> 
> 时间：2009-05-12T22:51:06.033
> 
> 标签：javascript, jquery, popup, onchange

我有一个带有表单元素和弹出窗口（由 window.open 打开）的网页。

两者都有 jQuery 可用。

弹出窗口有一个 javascript，可以更改打开器窗口中的表单元素。通过这样做可以完美地工作...

```
$(opener.document.formelement).val(vals[0]); 
```

但是，这样做不会触发 onChange 事件。但是，其他一些页面元素会要求这样做。所以我尝试自己触发 onChange 事件

```
$(opener.document.formelement).change(); 
```

但这无济于事。

有什么提示吗？由于其他页面元素的体系结构，我绝对必须触发 onChange 事件。

这个问题类似于[Call Javascript onchange event by programatically changed textbox value](https://stackoverflow.com/questions/735462/call-javascript-onchange-event-by-programatically-changing-textbox-value)，但该问题的建议解决方案似乎对我不起作用。也许这是因为弹出窗口。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-13T02:38:02.023

也许它是伤害您的跨窗口...尝试在您调用的 opener 内部创建一个函数。可能有帮助？

在开瓶器中：

```
window.changeMyElement = function(value) {
  $(formelement).val(value).change();
} 
```

从弹出窗口：

```
opener.changeMyElement(value); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T23:11:10.150

这条线应该工作：

```
$(opener.document.formelement).change(); 
```

根据 jQuery[文档](http://docs.jquery.com/Events/change)，这一行触发每个匹配元素的更改事件。

如果它对您不起作用，那么您的代码中的某个地方就有问题。你可以通过手动更改表单元素来触发onchange事件吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-06T17:27:04.560

你也可以这样做：

```
window.opener.document.getElementById('controlname').fireEvent('onchange'); 
```

或在您的上下文中：

```
$(opener.document.formelement).fireEvent('onchange'); 
```

# bash - 如何编写一些（bash）shell 脚本来将目录中所有匹配的文件名转换为命令行选项？

> ID：855265
> 
> 赞同：1
> 
> 时间：2009-05-12T22:51:26.640
> 
> 标签：bash, command-line, shell, filenames

显然是我的问题[“我可以将鼻子覆盖输出限制到目录（而不是包）吗？”的答案。](https://stackoverflow.com/questions/855114/)不是，但我可以通过一个`--coverage-package=PACKAGE`选项来使用目录中每个 .py 文件的包名。

例如，如果目录包含：

```
foo.py
bar.py
baz.py 
```

...然后我需要使用命令：

```
nosetests --with-coverage --coverage-package=foo --coverage-package=bar --coverage-package=baz 
```

所以我的问题是，有人可以编写一些 shell 脚本代码（最好是 sh 或 bash）来获取当前目录中带有 .py 扩展名的所有文件名并生成上述命令行（删除 .py 扩展名）？我的 bash 技能非常有限。（我很想只用 Python 来做。）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-12T23:00:58.903

```
nosetests --with-coverage $(for f in *.py; do echo --cover-package="${f%.*}"; done) 
```

这里的诀窍是使用[参数替换](http://tldp.org/LDP/abs/html/parameter-substitution.html#PCTPATREF)来删除文件扩展名。

```
${f%.*} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T07:16:46.423

如果你想正确地做到这一点（这意味着，不要允许分词将你的文件名分开或意外的通配符扩展到随机文件名），请使用数组：

```
files=(*.py)
packages=("${files[@]/%.py/}")
nosetests --with-coverage "${packages[@]/#/--coverage-package=}" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-12T23:01:59.773

```
nosetests --with-coverage `ls *.py|sed -e 's/^/--cover-package=' -e 's/\.py$//'` 
```

# git - ReinH Git 工作流程

> ID：855266
> 
> 赞同：5
> 
> 时间：2009-05-12T22:51:54.003
> 
> 标签：git

我正在使用这个工作流程：

[http://reinh.com/blog/2009/03/02/a-git-workflow-for-agile-teams.html](http://reinh.com/blog/2009/03/02/a-git-workflow-for-agile-teams.html)

他提到：“首先，在你的 master 分支（git checkout master）中，拉入最新的更改：git pull origin master 这不应该创建合并提交，因为我们从不直接在 master 中工作。”

哎呀，我刚做了。我不小心对我的主人（与我的主题分支）的几个文件进行了一些更改。然后我意识到我的错误 - 删除了我的主题分支。现在我想摆脱我提交的更改（对主人），正确的做法是什么？我还没有重新定位或将我的更改推送到 repo，所以它都是本地的。

本质上，我想拉下最新版本的主代码，而忽略我对本地主代码所做的一切（这实际上是一次提交）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-13T00:36:48.210

如果你只是想把它扔掉，当你在你的主分支上时：

```
git reset --hard HEAD^
```

此命令会将您的 master 的 HEAD 指针重置为上一次提交。（您也可以说“HEAD~1”，这与 HEAD^ 的含义相同。）更一般地说，您还可以将 master 重置为与服务器的相同：

```
git reset --hard origin/master
```

无论 master 的状态如何，这都将起作用（即在 origin 之前 5 次提交，或在其后 30 次提交）。这些命令中的`--hard`选项意味着工作树中的文件也将与分支头一起重置。

**额外提示**

如果您处于类似的情况，您实际上想要保留更改，您可以随时执行以下操作：

```
git fetch             # This grabs changes from the server without merging them
git rebase origin
```

这将在服务器上的最新更改之上重播您在 master 中所做的任何工作。

另一种选择是为您在 master 上的工作创建一个主题分支：

```
git checkout -b newfeature
```

然后你可以切换回master（git checkout master）并使用我给出的第一个命令将master倒回一次提交。请记住，分支实际上只是存储库中提交的方便名称。例如，`master`只是对该分支上最新提交的引用。您可以随意移动这些引用，并且随着您对 git 的深入了解，您会发现自己经常这样做。

我还建议您养成`gitk --all`在玩树枝时跑步的习惯，这样您就可以直观地看到自己在做什么。当我刚接触 git 时，我一直在运行这个*命令*。我仍然...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T09:23:34.627

您因分支删除而丢失的所有提交都在 git 中。

您可以通过遍历 reflog 来访问所有这些。看看

```
man git-reflog 
```

# javascript - Javascript window.open 观察窗口已经存在时使用原型

> ID：855270
> 
> 赞同：1
> 
> 时间：2009-05-12T22:52:27.713
> 
> 标签：javascript, prototypejs

我遇到了一个奇怪的场景，如果实际窗口已经在屏幕上，window.open() 不会触发“加载”事件。

**概要**
我有一个按钮，单击该按钮会运行一些 javascript 并在新窗口中打开一个页面。任何 JS 开发人员都见过的标准代码。当调用该方法（较大类的一部分）时，它会检查它是否具有对窗口（this.preview_window）的引用。如果是这样，它将运行 this.up，它会尝试再次打开它。一旦打开，它就会在该窗口上运行更新方法。

**问题**
如果窗口不存在，一切都按预期运行。如果窗口确实存在但类没有对它的引用，则使用 window.open() 成功获取引用，但不会调用更新函数。

**相关代码**

```
// This code is run whenever there is no reference to the window
this.preview_window = window.open('/folder/page.php','page_previewer');
Event.observe(this.preview_window, 'load',this.update.bindAsEventListener(this)); 
```

其余的代码已经过大量测试，所以我相当有信心我在加载事件的工作方式上遗漏了一些东西。window.open() 和 update() 函数在除此之外的所有情况下都按预期运行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T10:42:51.973

我猜想绑定发生时子窗口位于不同的域中，或者在加载发生之前它正在从缓存中加载。尝试将您的绑定设置为 500 毫秒超时。如果您控制子窗口的 url，则从子窗口调用父窗口会更容易。或者关闭并重新打开。

```
if (this.preview_window && !this.preview_window.closed)
  this.preview_window.close();
... open window ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-13T08:58:41.243

我对此进行了一些试验，似乎问题出在前面的答案中 - 如果您已经打开了一个窗口，则对 window.open() 的调用将不会触发加载事件。因此，您基本上需要在每次调用按钮的事件处理程序时刷新预览窗口，以确保触发加载事件，因此也可以调用您的更新处理程序。这是我用来演示的代码：

```
var preview_window;

function openPreviewWindow() {
    if (preview_window) {
        preview_window.close(); //Load will not fire unless we close the window first
    }
    preview_window = window.open('/', 'preview_window');
    Event.observe(preview_window, 'load', function () {
        alert('Updating opened window.');
    }.bindAsEventListener(this));
}

<a href="#" onclick="openPreviewWindow()">Open Preview Window</a> 
```

这可能不是很有启发性，但希望它能让你走上一条更有希望的道路。

# windows-7 - 在 VMWare 中的 Windows 7 上使用双显示器时无法更改主显示器

> ID：855276
> 
> 赞同：2
> 
> 时间：2009-05-12T22:54:12.470
> 
> 标签：windows-7, development-environment

我在 VMWare 6.5 中运行 Windows 7 RC Build 7100。主机操作系统是在 Dell Studio 1535 笔记本电脑上运行的 Vista x64 Home Premium。我有一台戴尔显示器作为辅助显示器连接，我正试图在两台显示器之间共享桌面。

虽然我可以做到这一点，但 Windows 7 坚持使用外接显示器作为主显示器，如果我尝试将主显示器更改为笔记本电脑显示器，我会收到“无法保存显示设置”的问候。当我尝试保存时。此对话框显示两次。有没有其他人经历过这种情况或知道解决方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-02-09T07:10:09.980

很晚了，但也许[**VirtualBox**](http://virtualbox.org)会为你工作。

# jpa - 控制 EclipseLink 创建表时的列顺序

> ID：855279
> 
> 赞同：4
> 
> 时间：2009-05-12T22:54:48.477
> 
> 标签：jpa, ejb-3.0, eclipselink

我正在使用将“eclipselink.ddl-generation”属性设置为“create-tables”的 EclipseLink。创建的表中列的顺序似乎是随机的。我希望列按特定顺序 - 字段出现在实体类定义中的顺序。

有没有办法告诉 EclipseLink 按实体类定义中的顺序创建列，或者以其他方式指定列顺序？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-02-20T19:06:45.290

EclipseLink 没有任何开箱即用的功能可以做到这一点。在正确规范化的数据库中，列顺序应该无关紧要。

# c# - WS-* 是什么意思？

> ID：855282
> 
> 赞同：16
> 
> 时间：2009-05-12T22:56:15.760
> 
> 标签：c#, .net, wcf, web-services

我见过缩写 WS-*，但我一直无法弄清楚这是什么意思，为什么它很重要？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-12T23:02:55.467

WS-* 是用于 Web 服务消息传递的无数规范的简写。

其中一些服务是：

*   WS-安全
*   WS-SecureConversation
*   WS-Federation
*   WS-授权
*   WS-策略
*   WS-Trust
*   WS-隐私
*   WS测试

有很多信息需要消化，这取决于你需要什么。[这是](http://en.wikipedia.org/wiki/List_of_Web_service_specifications)Wikipedia 上的规范列表。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-12T22:59:59.840

Web 服务堆栈。Web 服务有一堆规范，其中的名称写成 WS-whatever，例如：WS-SecurityPolicy。* 用作通配符，表示您指的是 Web 服务堆栈。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-12T22:59:12.400

这是 W3C 与 Web 服务相关的一组标准的名称。

[http://www.w3.org/2002/ws/](http://www.w3.org/2002/ws/)

它们很重要，因为 Web 服务就其本质而言，需要标准来在平台之间进行互操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T23:01:15.970

WS-* 指的是所有的 Web 服务标准，例如 WS-Security、WS-Addressing 等。

维基百科[有一个列表](http://en.wikipedia.org/wiki/Category:Web_service_specifications)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-09-09T02:00:36.333

除了定义之外，`WS-*`还有一些[含义](https://web.archive.org/web/20130325140509/http://hueniverse.com/2012/07/oauth-2-0-and-the-road-to-hell/)：

> 2.0 提供的是授权协议的**蓝图**。正如所定义的那样，它在很大程度上是无用的，必须将其配置为工作解决方案——这就是企业的方式。**WS-* 方式**。2.0 为销售咨询服务和集成解决方案提供了一个全新的领域。
> 
> - Eran Hammer，OAuth 2.0 的前主要作者

# c# - 铸造不同类但类型相同的对象

> ID：855283
> 
> 赞同：4
> 
> 时间：2009-05-12T22:57:09.657
> 
> 标签：c#, casting

我有两个由 LINQ2SQL 生成的类都来自同一个表，因此它们具有完全相同的属性。

我想将一个对象转换/转换为另一个类。最简单的方法是什么？

我知道我可以手动分配每个属性，但这是很多代码。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-13T02:54:36.313

您可以通过创建 SerializationBinder 使用序列化来轻松制作副本。这将允许您从一种类型反序列化为另一种类型。

```
class MySerializationBinder : SerializationBinder
{

    public override Type BindToType(string assemblyName, string typeName) 
    {
          Type typeToDeserialize = null;    

          // To return the type, do this:
          if(typeName == "TypeToConvertFrom")
          {
               typeToDeserialize = typeof(TypeToConvertTo);
          }

          return typeToDeserialize;
    }
} 
```

只要类型属性对齐，您就可以使用它来序列化 From 类型，然后使用 BinaryFormatter 反序列化为 To 类型，并将 Binder 属性设置为活页夹类的实例。如果您有多种类型的对象，您可以使用一个 Binder 来涵盖所有不同的类型。

反射是您可以考虑解决此问题的另一种选择。如果属性名称完全相同，您可以编写一个简单的方法，从一个属性中获取值并分配给同名的属性。

```
public static void CopyObject(object source, object destination)
{
   var props = source.GetType().GetProperties();

   foreach (var prop in props)
   {
       PropertyInfo info = destination.GetType().GetProperty(prop.Name);
       if (info != null)
       {
           info.SetValue(destination, prop.GetValue(source, null), null);
       }
   }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T23:07:42.917

您将不得不手动执行此操作，或使用灵活的序列化框架来解决此问题。您可以使用内置的[json 序列化](http://pietschsoft.com/post/2008/02/NET-35-JSON-Serialization-using-the-DataContractJsonSerializer.aspx)程序（导出到 json，然后从 json 导入）。甚至是 XmlSerializer。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T23:15:35.367

[MiscUtil](http://www.yoda.arachsys.com/csharp/miscutil/)有一些代码可以使用`Expression`- 例如：

```
Foo foo = ...
Bar bar = PropertyCopy<Bar>.CopyFrom(foo); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T03:41:24.813

您可以创建一个接口，该接口具有 linq to sql 类的属性，并且都实现了该接口。

```
命名空间
{
 公共部分类 MyClassA : IInterfaceName
 {
 }

 公共部分类 MyClassB : IInterfaceName
 {
 }

 公共接口 IInterfaceName
 {
   字符串属性A {get; 放;}
   int PropertyB {get; 放;}
   无效我的方法（）；
 }
}

```

这将允许您使用 IInterfaceName 强制转换/引用这两个类。我不确定这是否是您想要的，但是，它可能有用。另一种选择是重新加载具有相同 ID 的其他对象类型。

# java - TCP 套接字超时配置

> ID：855290
> 
> 赞同：2
> 
> 时间：2009-05-12T22:58:53.447
> 
> 标签：java, windows, sockets, timeout, windows-server-2008

我有一个 Java 应用程序，它通过 Java-COM 桥使用第三方 COM 组件。此 COM 组件打开到远程主机的套接字连接。

此主机可能需要一些时间来响应，我怀疑我会超时。我不确定，因为正如我所说，它是一个封闭源代码的第三方组件。

这个组件的API没有向我暴露socket连接，所以我没办法配置超时。所以我想知道是否有任何方法可以调整系统默认超时。

我使用的是 Windows Server 2008 x64 企业版。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-01T00:17:29.490

你想构建你的应用程序以便它在运行时知道是否发生超时，或者你想检查闭源 COM 组件的行为？如果是后者，请在您的开发盒上安装 Wireshark 并观察连接。如果是前者，您是否要确保您的 Java 对本地土地的调用不会永远挂起？如果是这种情况，请查看 java.util.concurrent 执行器服务的东西——有一种方法可以在另一个线程中调用方法并等待最多 N 秒，然后再将控制权返回给您的线程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-03T20:31:09.470

如果您想看到连接建立，然后可能从超时中删除，您可以使用 TCPview：[http ://technet.microsoft.com/en-us/sysinternals/bb897437.aspx](http://technet.microsoft.com/en-us/sysinternals/bb897437.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T09:23:19.557

您可以引入自己的 SocketImplFactory（参见 java.net.Socket 类的静态方法[setSocketImpl()](http://java.sun.com/javase/6/docs/api/java/net/Socket.html#setSocketImplFactory(java.net.SocketImplFactory)) ）。然后，您可以使用自己的 SO_TIMEOUT 参数值创建 SocketImpl 对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-23T20:56:18.170

Microsoft 的“Windows Vista Tcp Ip 配置设置”中描述的用于 TcpMaxDataRetransmissions 的注册表设置可能允许您设置所需的全局超时。

当然，您需要注意不要在处理过程中因对实际错误的延迟响应而削弱服务器的其余部分。

# c# - Convert.ToBase64String 是否返回与其源字节数组相同的长度？

> ID：855302
> 
> 赞同：9
> 
> 时间：2009-05-12T23:01:28.667
> 
> 标签：c#, .net, cryptography

我不知道我是否在问一个愚蠢的问题，但我想知道 .NET 中的 Convert.ToBase64String 函数是否返回与其源字节大小相同的长度，还是不同？我想尝试 MSDN 本身的文章[How To: Use Forms Authentication with SQL Server 2000](http://msdn.microsoft.com/en-us/library/aa302398.aspx) to hash my password 但我发现他们用来创建盐字符串的函数返回的长度比它应该返回的长度多 3 。这里要澄清的是那篇文章中的代码。

```
private static string CreateSalt(int size)
{
   // Generate a cryptographic random number using the cryptographic
   // service provider
   RNGCryptoServiceProvider rng = new RNGCryptoServiceProvider();
   byte[] buff = new byte[size];
   rng.GetBytes(buff);
   // Return a Base64 string representation of the random number
   return Convert.ToBase64String(buff);
} 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-12T23:08:30.670

不，Base64 为 3 字节输入返回 4 字节输出，向上舍入（用 = 填充）到下一个 4 字节边界。

```
int outputLength = ((inputLength+2)/3)*4 
```

这是因为它每个字节仅使用 6 位（基本上是数字 0-63），以便仅使用非控制字符且在 7 位范围内的 ASCII 字符。因此，使用 Base64 编码数据时，您会得到 3*8 => 4*6 位。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-12T23:09:39.200

base-64 很少返回与输入长度相同的字符串。本质上，它只使用了可用的 8 位中的 6 位，因此大消息（特别是）将需要额外的 1/3 体积。末尾有几个打包字节（通常是“=”）以使消息明确。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T00:53:02.563

字节字符串的 base64 编码比字节字符串长，因为该字节字符串每个“位置”有 2^8 种可能性，而 base 64 字符串每个位置只有 2^6 种可能性（这就是我们称之为 base 64 的原因）。

想想对数和鸽子洞。以数字 5000 为例。您需要多少个位置（鸽洞、字节）才能将其存储在 256 进制中？

```
"Locations in base256" = ceil(log_2(5000) / 8) = ceil(1.54) = 2 
```

其中 log_2 告诉您需要多少位。现在base64有多少？

```
"Locations in base64" = ceil(log_2(5000) / 6) = ceil(2.04) = 3 
```

# mysql - 保持非规范化模式最新的最佳实践？

> ID：855304
> 
> 赞同：4
> 
> 时间：2009-05-12T23:01:52.643
> 
> 标签：mysql, database-design, optimization

我正在创建一个用于做小事的游戏，所以我有一个这样的模式：

```
create table points (
  id int,
  points int,
  reason varchar(10)
) 
```

并且要获得用户拥有的点数是微不足道的：

```
select sum(points) as total from points where id = ? 
```

然而，随着积分表的扩大，性能变得越来越重要。我想做类似的事情：

```
create table pointtotal (
  id int,
  totalpoints int
) 
```

使它们保持同步的最佳做法是什么？我是否尝试在每次更改时更新 pointtotal？我是否运行每日脚本？

（假设我有正确的键 - 为了简洁起见，它们被省略了）

编辑：

以下是我遗漏的一些特征，但应该会有所帮助：

对点的插入/更新并不是那么频繁有大量的条目，并且有大量的请求 - 正如您所见，键非常简单。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-12T23:08:26.113

*最佳实践*是使用规范化的数据库模式。然后 DBMS 保持它是最新的，所以你不必这样做。

但我理解使非规范化设计具有吸引力的权衡。在这种情况下，最佳做法是在每次更改时更新总数。调查**触发器**。这种做法的好处是您可以使总数与更改保持同步，因此您永远不必考虑它是否已过时。如果提交了一项更改，那么更新的总数也将提交。

但是，这在并发更改方面有一些弱点。如果您需要容纳对相同总数的并发更改，并且您可以容忍总数“最终一致”，那么使用**定期重新计算**总数，这样您就可以确定一次只有一个进程正在更改总数。

另一个好的做法是在数据库之外**缓存**聚合总计，例如 memcached 或应用程序变量，这样您就不必每次需要显示值时都访问数据库。

* * *

即使您有大量行和大量请求， 查询“ `select sum(points) as total from points where id = ?`”也不应该*花费2 秒。*

如果您定义了[**覆盖索引**](http://en.wikipedia.org/wiki/Index_(database)#Covering_Index)`(id, points)`，则查询可以在根本不从表中读取数据的情况下产生结果；它可以通过读取索引本身的值来计算总数。使用[EXPLAIN](http://dev.mysql.com/doc/refman/5.1/en/explain.html)分析您的查询并在 Extra 列中查找“使用索引”注释。

```
CREATE TABLE Points (
  id     INT,
  points INT,
  reason VARCHAR(10),
  KEY    id (id,points)
);

EXPLAIN SELECT SUM(points) AS total FROM Points WHERE id = 1;

+----+-------------+--------+------+---------------+------+---------+-------+------+--------------------------+
| id | select_type | table  | type | possible_keys | key  | key_len | ref   | rows | Extra                    |
+----+-------------+--------+------+---------------+------+---------+-------+------+--------------------------+
|  1 | SIMPLE      | points | ref  | id            | id   | 5       | const |    9 | Using where; Using index | 
+----+-------------+--------+------+---------------+------+---------+-------+------+--------------------------+ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T23:13:24.047

一定要保持基础表标准化。如果您可以处理可能是一天前的数据，请每天运行一个脚本（您可以安排它），以进行汇总并填充新表。最好每晚从源表重新创建事物，以防止两者之间出现任何不一致。

也就是说，根据您的记录大小，您必须拥有非常慢的服务器，或者非常大的记录数，因为如此小的记录，在 id 上有一个索引字段应该很快为您求和 - 但是，我属于如果您可以将用户响应时间缩短几秒钟，那么没有理由不使用汇总表 - 即使 DB 纯粹主义者反对。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T23:16:15.913

在同一张表上有额外的总分列，并为每行创建/更新创建/更新总分值。

如果您需要某条记录的总分，您可以在不计算总分的情况下查找该值。例如，如果你需要 totalpoint 的最后一个值，你可以这样得到：

```
SELECT totalpoint FROM point ORDER BY id DESC LIMIT 1; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T23:18:20.467

还有另一种方法：缓存。即使它只缓存了几秒钟或几分钟，这也是对经常访问的值的胜利。并且可以将缓存获取与缓存更新分离。这样，一个合理的当前值总是在恒定时间内返回。棘手的一点是让 fetch 产生一个新进程来进行更新。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-14T14:32:04.920

我建议创建一个用于访问和修改数据的层。您可以使用这些数据库访问功能来封装所有表中的数据维护，以保持冗余数据的同步。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-16T14:58:28.660

在这种情况下，你可以选择任何一种方式，因为它不是很复杂。

作为一般规则，我更喜欢允许数据暂时不一致，只要有足够的冗余，并有一个周期性的过程来解决不一致。然而，有一个触发机制来鼓励周期性过程的早期执行并没有什么坏处。

我有这种感觉，因为在更复杂的情况下，依靠基于事件的通知风格的代码来保持一致会使代码变得非常复杂，并使验证变得困难。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-16T15:04:31.907

您还可以创建另一个报告模式，并通过一些进行计算的过程以固定的时间间隔重新加载它。这不适用于实时信息 - 但这是非常标准的做事方式。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-27T04:57:15.810

[保持非规范化值正确](http://database-programmer.blogspot.com/2008/11/keeping-denormalized-values-correct.html)

# asp.net-mvc - .net mvc 1.0 Html.TextBox

> ID：855311
> 
> 赞同：0
> 
> 时间：2009-05-12T23:03:28.943
> 
> 标签：asp.net-mvc, textbox

我有以下代码，仅适用于第一次点击页面。<%= Html.TextBox("金额",Model.Amount)%>

在上面的行中，调试器显示每次生成视图时获取 Model.Amount 的属性调用。但是 Amount 的更新值不会反映在生成的 HTML 中。

帮助

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-12T23:06:22.293

我想您的表格正在发回给自己以更改金额？

听起来您发布的操作没有做任何工作。您需要发布该源代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T23:40:51.303

我认为您遇到的问题可能是从表单发布的值保存在 ModelState 中，这会覆盖在 Action 方法中直接设置为 TextBox 值的任何内容。这是 HtmlHelper TextBox 扩展方法的“功能”。您可以避免使用内置的 HtmlHelper 方法并手动将 input type="text" html 元素输出到表单中，或者您可以尝试在某处的操作中调用 ModelState.Clear()。

# xcode - OS X gcc“安装问题”

> ID：855319
> 
> 赞同：0
> 
> 时间：2009-05-12T23:05:26.227
> 
> 标签：xcode, macos, configuration, gcc

支持 iPhone 的 OS X 10.5.6、Xcode 3.1。

在 Xcode 中为 iPhone 设备编译一些应用程序后，我注意到从命令行调用 GCC 不再有效：

```
$ gcc
gcc-4.0: installation problem, cannot exec '/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin//i686-apple-darwin9-gcc-4.0.1': No such file or directory 
```

请注意 gcc 如何尝试在 iPhoneOS (arm) 平台目录中启动 i686 可执行文件。

如何切换回 MacOSX.platform 工具链？

```
$ ls /Developer/Platforms/
MacOSX.platform          iPhoneOS.platform        iPhoneSimulator.platform 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T03:22:00.673

我会先检查你的环境。我怀疑你已经导出了一个变量来设置你的平台目录（特别注意路径名中的双斜杠）。特别检查 PATH 和 CC，但我会寻找 /Developer 中的任何内容。这看起来像是来自一些第三方构建助手和工具链的设置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-01-16T20:22:27.687

我知道这是一个古老的问题，但万一有人遇到我遇到的同样问题，您也可能会收到此错误：

`c++: installation problem, cannot exec 'cc1plus': No such file or directory`

如果您尝试在 PPC 机器上交叉编译 i386 代码并且您选择了 gcc 3.3。要解决此问题，请使用 gcc_select 选择 gcc 4.0 或更高版本。即`'sudo gcc_select 4.0'`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T03:25:19.667

从命令开始：

> 哪个 gcc

这将告诉您被调用的 gcc 可执行文件的实际位置。然后，您可以相应地修改 PATH。您可能还需要修改 LD_LIBRARY_PATH 变量，因为 iPhone 版本也可能调用不同的运行时库。

# jquery - JQuery Grid或循环通过部分视图？

> ID：855323
> 
> 赞同：0
> 
> 时间：2009-05-12T23:06:48.143
> 
> 标签：jquery, asp.net-mvc, jqgrid, partial-views

有没有人能够自定义jQGrid？

虽然我想要一些简单的东西，我可以使用它来提供分页，但我发现布局是“紧凑的”（不是很酷的方式），网格太像 Excel 了。

我更喜欢一个有间隔的网格行和使用图标的能力。

但在我写下网格并开始手工滚动大量代码之前，我想我会问社区是否有人能够成功自定义 JQGrid（网格布局和列类型）

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T23:14:12.827

您好，我在这里找到了一个可能的答案： [http ://www.trirand.com/blog/?page_id=18/feature-request/icons-with-data/page-1&value=icons%25251&search=1](http://www.trirand.com/blog/?page_id=18/feature-request/icons-with-data/page-1&value=icons%25251&search=1)

你好。这个答案的功劳归功于托尼，因为他在之前的帖子中提到过。对于您想要的，您可以将树形网格用于文件夹结构以及图片和所有其他所需，只需通过服务器响应传递 html 源代码。例如。

```
colNames: ['Item','Image','Price'], 
colModel: [ name:"item",index:"item"....}, 
      ... ], 
```

那么服务器响应可能是：

```
rows : [
[id:"1", cell:["item", "html img tag",...]],
… 
```

希望这可以帮助。干杯，P。

在进行部分视图之前，我会先试一试，但如果其他人使用这种方法，我将不胜感激！

谢谢！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T23:09:58.763

我还没有这样做，但是 jqGrid 的 alpha 版本支持 jQuery 主题滚轮 - 可能提供比稳定版本更好的自定义。

# java - 在 Scala 中格式化字符串的最佳方法是什么？

> ID：855329
> 
> 赞同：9
> 
> 时间：2009-05-12T23:08:15.553
> 
> 标签：java, string, scala

我想知道在 Scala 中格式化字符串的最佳方法是什么。我正在为一个类重新实现 toString 方法，它是一个相当长且复杂的字符串。我考虑过使用 String.format，但 Scala 似乎有问题。是否有用于执行此操作的本机 Scala 函数？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-12T23:35:25.273

我只是用错了。正确的用法是 .format(parem1, parem2)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T05:50:29.187

好旧的怎么样`java.text.MessageFormat`？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T03:12:58.663

需要注意的`String#format`是它实际上是使用反射实现的（从 v2.7.4 开始）。它委托给 Java API，但是反射给相对较小的方法调用增加了相当大的开销。出于性能原因，您可能需要考虑 Java 样式的字符串连接。据我了解，Scala 2.8.0 版应该可以解决这个问题。

# java - java中的工厂方法模式使用泛型，如何？

> ID：855332
> 
> 赞同：5
> 
> 时间：2009-05-12T23:08:43.383
> 
> 标签：java, generics, methods, design-patterns, factory

我的代码如下所示：

```
public interface BaseDAO{
// marker interface
}

public interface CustomerDAO extends BaseDAO{
public void createCustomer();
public void deleteCustomer();
public Customer getCustomer(int id);
// etc
}

public abstract class DAOFactory {
public BaseDAO getCustomerDAO();
public static DAOFactory getInstance(){
  if(system.getProperty("allowtest").equals("yes")) {
  return new TestDAOFactory();
  }
  else return new ProdDAOFactory();
}

public class TestDAOFactory extends DAOFactory{
public BaseDAO getCustomerDAO() {
  return new TestCustomerDAO(); // this is a concrete implementation
  //that extends CustomerDAO
  //and this implementation has dummy code on methods
}

public class ProdDAOFactory extends DAOFactory {
public BaseDAO getCustomerDAO() {
  return new ProdCustomerDAO(); // this implementation would have 
  // code that would connect to the database and do some stuff..
}
} 
```

现在，我知道这段代码有异味……有很多原因。但是，此代码也在这里： [http://java.sun.com/blueprints/corej2eepatterns/Patterns/DataAccessObject.html](http://java.sun.com/blueprints/corej2eepatterns/Patterns/DataAccessObject.html)，请参阅 9.8

我打算做的是：1）根据环境（系统属性）在运行时切换我的 DAO 实现。2）利用java泛型，这样我就可以避免类型转换......例如做这样的事情：

```
CustomerDAO dao = factory.getCustomerDAO();
dao.getCustomer(); 
```

相对于：

```
CustomerDAO dao = (CustomerDAO) factory.getCustomerDAO();
dao.getCustomer(); 
```

请提出您的想法和建议。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-13T18:48:36.387

您应该这样定义工厂：

```
public abstract class DAOFactory<DAO extends BaseDAO> {
public DAO getCustomerDAO();
public static <DAO extends BaseDAO> DAOFactory<DAO> getInstance(Class<DAO> typeToken){
  // instantiate the the proper factory by using the typeToken.
  if(system.getProperty("allowtest").equals("yes")) {
  return new TestDAOFactory();
  }
  else return new ProdDAOFactory();
} 
```

getInstance 应该返回一个正确类型的 DAOFactory。

工厂变量将具有以下类型：

```
DAOFactory<CustomerDAO> factory = DAOFactory<CustomerDAO>.getInstance(CustomerDAO.class); 
```

并且用法将被正确输入：

```
CustomerDAO dao = factory.getCustomerDAO();
dao.getCustomer(); 
```

the only problem will probably be a cast required inside the getInstance methods.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-12T23:21:26.887

有很多文章详细说明了您的需求：

*   [JDK 5.0 的通用 DAO 模式](http://blog.hibernate.org/Bloggers/GenericDAOPatternWithJDK50)
*   [通用数据访问对象](https://www.hibernate.org/328.html)（同上）
*   [不要重复DAO](http://www.ibm.com/developerworks/java/library/j-genericdao.html)（有Spring，但原理是一样的）
*   [Java 1.5 通用 DAO](http://www.dhptech.com/node/18)（又是 Spring）

请注意，与您的示例不同，方法没有理由`DAOFactory`不返回实际的子类（即`CustomerDAO getCustomerDAO()`）。此外，使用泛型 DAO 的主要好处是实体类型“泛型化”，因此您不必转换 from`load()/get()/find()`和类似的方法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-12T23:24:05.870

您的示例没有证明需要`BaseDAO`，并且没有理由`DAOFactory.getCustomerDAO()`不应该声明返回 a `CustomerDAO`。所以，我真的不认为那里需要泛型。但是，请考虑以下事项：

```
interface DataAccess<T> {
  void store(T entity);
  T lookup(Serialiable identifier);
  void delete(Serializable identifier);
  Collection<? extends T> find(Criteria query);
}

abstract class DataAccessFactory {
  abstract DataAccess<T> getDataAccess(Class<T> clz);
  static DataAccessFactory getInstance() {
    ...
  }
} 
```

我在几个项目中使用过类似的方法，编写一个适用于模型中每个实体的 DAO 非常好。弱点是“查找器”方法。有一些巧妙的方法，JPA 中即将开展的工作是标准化“Criteria”API，但现在公开底层持久性机制的标准通常是最容易的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T23:20:14.207

当我使用工厂时，我通常使用 instanceof 来确定对象的真实类型。例如：

```
CustomerDAO dao;
if (factory.getCustomerDAO() instanceof CustomerDAO) {
   dao = factory.getCustomerDAO();
}
dao.getCustomer(); 
```

这对我来说似乎更干净，特别是如果 factory.getCustomerDAO() 没有返回任何接近 CustomerDAO 的东西（由于实现的变化）。

只是我的两分钱。

# .net - WPF：如何使画布自动调整大小？

> ID：855334
> 
> 赞同：54
> 
> 时间：2009-05-12T23:09:00.823
> 
> 标签：.net, wpf, resize, wpf-controls, scrollviewer

我希望我`Canvas`能够自动调整其项目的大小，以便`ScrollViewer`滚动条具有正确的范围。这可以在 XAML 中完成吗？

```
<ScrollViewer HorizontalScrollBarVisibility="Auto" x:Name="_scrollViewer">
    <Grid x:Name ="_canvasGrid" Background="Yellow">
        <Canvas x:Name="_canvas" HorizontalAlignment="Left" VerticalAlignment="Top" Background="Green"></Canvas>
        <Line IsHitTestVisible="False" .../>
    </Grid>
</ScrollViewer> 
```

在上面的代码中，画布的大小始终为 0，尽管它不会剪切其子项。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-05-14T12:43:01.797

不，这是不可能的（请参阅下面的 MSDN 片段）。但是，如果您想要滚动条和自动调整大小，请考虑改用**Grid**，并使用 Margin 属性将您的项目放置在此 Grid 上。Grid 将告诉 ScrollViewer 他想要多大，您将获得滚动条.. Canvas 将始终告诉 ScrollViewer 他不需要任何大小.. :)

网格让您享受两个世界 - 只要您将所有元素放入一个单元格中，您就可以同时获得：任意定位和自动调整大小。一般来说，最好记住大多数面板控件（DockPanel、StackPanel 等）都可以通过 Grid 控件实现。

来自[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.controls.canvas.aspx)：

> Canvas 是唯一没有固有布局特征的面板元素。Canvas 的默认高度和宽度属性为零，除非它是自动调整其子元素大小的元素的子元素。Canvas 的子元素永远不会调整大小，它们只是定位在指定的坐标处。这为不需要或不需要固有尺寸约束或对齐的情况提供了灵活性。对于您希望子内容自动调整大小和对齐的情况，通常最好使用 Grid 元素。

希望这可以帮助

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2011-08-19T00:38:43.413

我只是在这里复制 illef 的答案，但在回答 PilotBob 时，您只需定义一个像这样的画布对象

```
public class CanvasAutoSize : Canvas
{
    protected override System.Windows.Size MeasureOverride(System.Windows.Size constraint)
    {
        base.MeasureOverride(constraint);
        double width = base
            .InternalChildren
            .OfType<UIElement>()
            .Max(i => i.DesiredSize.Width + (double)i.GetValue(Canvas.LeftProperty));

        double height = base
            .InternalChildren
            .OfType<UIElement>()
            .Max(i => i.DesiredSize.Height + (double)i.GetValue(Canvas.TopProperty));

        return new Size(width, height);
    }
} 
```

然后在您的 XAML 中使用 CanvasAutoSize。

```
 <local:CanvasAutoSize VerticalAlignment="Top" HorizontalAlignment="Left"></local:CanvasAutoSize> 
```

我更喜欢这种解决方案，而不是上面介绍的使用网格的解决方案，因为它通过附加属性工作，并且只需要在元素上设置更少的属性。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-07-15T08:50:44.617

我认为您可以`Canvas`通过覆盖`MeasureOverride`或`ArrangeOverride`方法来调整大小。

这份工作并不难。

你可以看到这个帖子。[http://illef.tistory.com/entry/Canvas-supports-ScrollViewer](http://illef.tistory.com/entry/Canvas-supports-ScrollViewer)

我希望这可以帮助你。

谢谢你。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-02-03T16:39:38.173

本质上，它需要完全重写 Canvas。先前提出的覆盖 MeasureOverride 的解决方案失败，因为默认的 Canvas.Left/.Top &c 属性使排列无效，但也需要使度量无效。（您第一次获得正确的尺寸，但如果您在初始布局后移动元素，尺寸不会改变）。

Grid 解决方案或多或少是合理的，但绑定到 Margins 以获得 xy 位移可能会对其他代码造成严重破坏（特别是在 MVVM 中）。我为 Grid 视图解决方案苦苦挣扎了一段时间，但 View/ViewModel 交互和滚动行为的复杂性最终驱使我这样做。这很简单，而且很重要，而且Just Works。

重新实现 ArrangeOverride 和 MeasureOverride 并不复杂。而且你必须在其他地方编写至少一样多的代码来处理 Grid/Margin 的愚蠢问题。所以你来了。

这是一个更完整的解决方案。非零保证金行为未经测试。如果您需要 Left 和 Top 以外的任何东西，那么这至少提供了一个起点。

警告：您必须使用 AutoResizeCanvas.Left 和 AutoResizeCanvas.Top 附加属性，而不是 Canvas.Left 和 Canvas.Top。剩余的 Canvas 属性尚未实现。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace Mu.Controls
{
    public class AutoResizeCanvas : Panel
    {

        public static double GetLeft(DependencyObject obj)
        {
            return (double)obj.GetValue(LeftProperty);
        }

        public static void SetLeft(DependencyObject obj, double value)
        {
            obj.SetValue(LeftProperty, value);
        }

        public static readonly DependencyProperty LeftProperty =
            DependencyProperty.RegisterAttached("Left", typeof(double),
            typeof(AutoResizeCanvas), 
            new FrameworkPropertyMetadata(0.0, OnLayoutParameterChanged));

        private static void OnLayoutParameterChanged(
                DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            // invalidate the measure of the enclosing AutoResizeCanvas.
            while (d != null)
            {
                AutoResizeCanvas canvas = d as AutoResizeCanvas;
                if (canvas != null)
                {
                    canvas.InvalidateMeasure();
                    return;
                }
                d = VisualTreeHelper.GetParent(d);
            }
        }

        public static double GetTop(DependencyObject obj)
        {
            return (double)obj.GetValue(TopProperty);
        }

        public static void SetTop(DependencyObject obj, double value)
        {
            obj.SetValue(TopProperty, value);
        }

        public static readonly DependencyProperty TopProperty =
            DependencyProperty.RegisterAttached("Top", 
                typeof(double), typeof(AutoResizeCanvas),
                new FrameworkPropertyMetadata(0.0, OnLayoutParameterChanged));

        protected override Size MeasureOverride(Size constraint)
        {
            Size availableSize = new Size(double.MaxValue, double.MaxValue);
            double requestedWidth = MinimumWidth;
            double requestedHeight = MinimumHeight;
            foreach (var child in base.InternalChildren)
            {
                FrameworkElement el = child as FrameworkElement;

                if (el != null)
                {
                    el.Measure(availableSize);
                    Rect bounds, margin;
                    GetRequestedBounds(el,out bounds, out margin);

                    requestedWidth = Math.Max(requestedWidth, margin.Right);
                    requestedHeight = Math.Max(requestedHeight, margin.Bottom);
                }
            }
            return new Size(requestedWidth, requestedHeight);
        }
        private void GetRequestedBounds(
                            FrameworkElement el, 
                            out Rect bounds, out Rect marginBounds
                            )
        {
            double left = 0, top = 0;
            Thickness margin = new Thickness();
            DependencyObject content = el;
            if (el is ContentPresenter)
            {
                content = VisualTreeHelper.GetChild(el, 0);
            }
            if (content != null)
            {
                left = AutoResizeCanvas.GetLeft(content);
                top = AutoResizeCanvas.GetTop(content);
                if (content is FrameworkElement)
                {
                    margin = ((FrameworkElement)content).Margin;
                }
            }
            if (double.IsNaN(left)) left = 0;
            if (double.IsNaN(top)) top = 0;
            Size size = el.DesiredSize;
            bounds = new Rect(left + margin.Left, top + margin.Top, size.Width, size.Height);
            marginBounds = new Rect(left, top, size.Width + margin.Left + margin.Right, size.Height + margin.Top + margin.Bottom);
        }

        protected override Size ArrangeOverride(Size arrangeSize)
        {
            Size availableSize = new Size(double.MaxValue, double.MaxValue);
            double requestedWidth = MinimumWidth;
            double requestedHeight = MinimumHeight;
            foreach (var child in base.InternalChildren)
            {
                FrameworkElement el = child as FrameworkElement;

                if (el != null)
                {
                    Rect bounds, marginBounds;
                    GetRequestedBounds(el, out bounds, out marginBounds);

                    requestedWidth = Math.Max(marginBounds.Right, requestedWidth);
                    requestedHeight = Math.Max(marginBounds.Bottom, requestedHeight);
                    el.Arrange(bounds);
                }
            }
            return new Size(requestedWidth, requestedHeight);
        }

        public double MinimumWidth
        {
            get { return (double)GetValue(MinimumWidthProperty); }
            set { SetValue(MinimumWidthProperty, value); }
        }

        public static readonly DependencyProperty MinimumWidthProperty =
            DependencyProperty.Register("MinimumWidth", typeof(double), typeof(AutoResizeCanvas), 
            new FrameworkPropertyMetadata(300.0,FrameworkPropertyMetadataOptions.AffectsMeasure));

        public double MinimumHeight
        {
            get { return (double)GetValue(MinimumHeightProperty); }
            set { SetValue(MinimumHeightProperty, value); }
        }

        public static readonly DependencyProperty MinimumHeightProperty =
            DependencyProperty.Register("MinimumHeight", typeof(double), typeof(AutoResizeCanvas), 
            new FrameworkPropertyMetadata(200.0,FrameworkPropertyMetadataOptions.AffectsMeasure));

    }

} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-10-30T01:00:23.807

我看到你有一个可行的解决方案，但我想我会分享。

```
<Canvas x:Name="topCanvas">
    <Grid x:Name="topGrid" Width="{Binding ElementName=topCanvas, Path=ActualWidth}" Height="{Binding ElementName=topCanvas, Path=ActualHeight}">
        ...Content...
    </Grid>
</Canvas> 
```

上述技术将允许您在画布内嵌套网格并动态调整大小。进一步使用维度绑定可以将动态材质与静态材质混合、执行分层等。有太多的可能性要提及，有些比其他的更难。例如，我使用该方法来模拟动画内容从一个网格位置移动到另一个网格位置 - 在动画完成事件中进行实际放置。祝你好运。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-03-18T01:32:06.907

```
void MainWindow_Loaded(object sender, RoutedEventArgs e)
{
    autoSizeCanvas(canvas1);
}

void autoSizeCanvas(Canvas canv)
{
    int height = canv.Height;
    int width = canv.Width;
    foreach (UIElement ctrl in canv.Children)
    {
        bool nullTop = ctrl.GetValue(Canvas.TopProperty) == null || Double.IsNaN(Convert.ToDouble(ctrl.GetValue(Canvas.TopProperty))),
                nullLeft = ctrl.GetValue(Canvas.LeftProperty) == null || Double.IsNaN(Convert.ToDouble(ctrl.GetValue(Canvas.LeftProperty)));
        int curControlMaxY = (nullTop ? 0 : Convert.ToInt32(ctrl.GetValue(Canvas.TopProperty))) +
            Convert.ToInt32(ctrl.GetValue(Canvas.ActualHeightProperty)
            ),
            curControlMaxX = (nullLeft ? 0 : Convert.ToInt32(ctrl.GetValue(Canvas.LeftProperty))) +
            Convert.ToInt32(ctrl.GetValue(Canvas.ActualWidthProperty)
            );
        height = height < curControlMaxY ? curControlMaxY : height;
        width = width < curControlMaxX ? curControlMaxX : width;
    }
    canv.Height = height;
    canv.Width = width;
} 
```

在函数中，我试图找到画布中的控件可以驻留的最大 X 位置和 Y 位置。

仅在 Loaded 事件或更高版本中使用该函数，而不是在构造函数中使用。加载前必须测量窗口。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-06-20T12:17:14.900

将高度/宽度绑定到画布内控件的实际大小对我有用：

```
 <ScrollViewer VerticalScrollBarVisibility="Visible" HorizontalScrollBarVisibility="Visible">
            <Canvas Height="{Binding ElementName=myListBox, Path=ActualHeight}"
                    Width="{Binding ElementName=myListBox, Path=ActualWidth}">
                <ListBox x:Name="myListBox" />
            </Canvas>
        </ScrollViewer> 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-07-15T18:13:41.637

作为对@MikeKulls 答案的改进，这里有一个版本，当画布中没有 UI 元素或存在没有 Canvas.Top 或 Canvas.Left 属性的 UI 元素时不会引发异常：

```
public class AutoResizedCanvas : Canvas
{
    protected override System.Windows.Size MeasureOverride(System.Windows.Size constraint)
    {
        base.MeasureOverride(constraint);
        double width = base
            .InternalChildren
            .OfType<UIElement>()
            .Where(i => i.GetValue(Canvas.LeftProperty) != null)
            .Max(i => i.DesiredSize.Width + (double)i.GetValue(Canvas.LeftProperty));

        if (Double.IsNaN(width))
        {
            width = 0;
        }

        double height = base
            .InternalChildren
            .OfType<UIElement>()
            .Where(i => i.GetValue(Canvas.TopProperty) != null)
            .Max(i => i.DesiredSize.Height + (double)i.GetValue(Canvas.TopProperty));

        if (Double.IsNaN(height))
        {
            height = 0;
        }

        return new Size(width, height);
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-06-09T08:29:31.457

我也遇到过这个问题，我的问题是由于覆盖的 MeasureOverride 函数，当 Canvas 确实调整大小时，网格没有自动调整大小。

我的问题： [WPF MeasureOverride 循环](https://stackoverflow.com/questions/30726257/wpf-measureoverride-loop)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-05-02T22:43:20.907

我能够通过简单地向控件添加一个新的大小更改事件来实现您正在寻找的结果，该事件包含导致画布增长的数据。在画布到达滚动查看器的范围后，它将导致出现滚动条。我刚刚将以下 lambda 表达式分配给控件的大小更改事件：

```
text2.SizeChanged += (s, e) => { DrawingCanvas.Height = e.NewSize.Height; 
                                 DrawingCanvas.Width = e.NewSize.Width; }; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-05-24T12:48:05.787

对我有用的是：就像他们问题中的原始海报示例一样，我将画布嵌套在网格中。网格位于滚动查看器中。我没有尝试更改画布大小，而是更改了网格大小，在我的例子中包括高度和宽度，画布遵循网格大小减去任何边距。我以编程方式设置网格大小，尽管我认为绑定也可以。我也以编程方式获得了所需的网格大小。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-11-11T13:48:51.670

使用`Grid`将自动调整内容大小而不设置额外参数，而只是`VerticalAlignment`and `HorizontalAlignment`。例如：

```
<Grid VerticalAlignment="Top" HorizontalAlignment="Center">
    <Polygon Points="0, 0, 0, 100, 80, 100" Panel.ZIndex="6" Fill="Black" Stroke="Black" StrokeStartLineCap="Round" StrokeDashCap="Round" StrokeLineJoin="Round" StrokeThickness="10"/>
</Grid> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-11-11T19:08:24.893

据我了解，当将控件添加到画布以增加画布的大小时，画布不会通知滚动查看器。滚动查看器不知道画布大小增加了。对我有用的只是在添加控件后以编程方式更改画布的宽度。

```
mycanvas.Children.Add(myTextBlock);
mycanvas.Width += 10.0 
```

;

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2010-02-15T05:44:00.830

```
<viewbox>
    <canvas>
        <uielements /> 
    </canvas>
</viewbox> 
```

# ruby-on-rails - 启动开发服务器时出现问题 - ruby on rails

> ID：855335
> 
> 赞同：1
> 
> 时间：2009-05-12T23:09:18.280
> 
> 标签：ruby-on-rails, mongrel

我最近使用 Ruby 1.8.7 升级到 Rails 2.3.2。每当我像这样启动服务器时：

```
cd /myproject
script/server 
```

它挂起。取消它后，我看到的唯一错误信息是：

```
^C/Users/timstephenson/.gem/ruby/1.8/gems/activesupport-2.3.2/lib/active_support/core_ext/load_error.rb:32:in `new': Interrupt 
```

升级后开始出现错误。查看项目日志文件夹中的服务器日志，没有写入任何内容。开发日志中也没有任何内容。

我正在使用 Mac OSX 10.5

我更新了所有的宝石并清理了旧的宝石。所有旧物品都来自带有 PPC 芯片和 Tiger 的旧电脑。在升级到 Ruby 1.8.7 和 Rails 2.3.2 之前，尽管 ruby​​ 似乎是为 PPC 而不是 i686 编译的，但一切正常。

我可以使用脚本/控制台并成功与项目中的模型进行交互。

任何建议，将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T01:25:28.493

你用的是杂种吗？如果是这样，请尝试`script/server webrick`看看是否有效。[我相信这可能与http://mongrel.rubyforge.org/ticket/37](http://mongrel.rubyforge.org/ticket/37)相同的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T01:53:51.973

确保您的应用有权写入您的日志文件夹。如果没有，那可能就是您没有收到任何日志条目的原因。

作为最后的解决方案，尝试制作一个新的 Rails 应用程序，重新搭建数据库，然后将应用程序文件夹移动到新应用程序。这意味着您的 Rails 代码与您安装的 Rails 和 Ruby 版本兼容，而您的旧代码可能不兼容。

您还需要复制您编写的任何其他不在您的应用程序文件夹中的代码。

请注意：这确实是最后的手段。

# c# - 在 C# 中引用属性本身。反射？通用的？类型？

> ID：855337
> 
> 赞同：5
> 
> 时间：2009-05-12T23:09:42.680
> 
> 标签：c#, reflection, properties

如果这个问题表述得不好，请多多包涵。不知道是问题的一部分。

在 WPF 中的 PropertyChangedEventArgs 中可以找到我想要完成的示例。如果要标记 WPF 中的某个属性已更改，请执行以下操作：

```
PropertyChanged(this, new PropertyChangedEventArgs("propertyName")); 
```

您将一个**字符串**传递给 PropertyChangedEventArgs，该字符串引用已更改的**属性名称**。

您可以想象，我真的不想在我的代码中为属性名称使用硬编码字符串。当然，Refactor-rename 错过了它，这使得它不仅在美学上没有吸引力，而且还容易出错。

我宁愿**参考财产本身**......不知何故。

```
PropertyChanged(this, new PropertyChangedEventArgs(?SomeClass.PropertyName?)); 
```

看起来我应该能够用一个简短的方法来包装它，让我说类似上面的话。

```
private void MyPropertyChanged(??) {
  PropertyChanged(this, new PropertyChangedEventArgs(??.ToString()??));
}

... so I can say something like:
MyPropertyChanged(Person.Name); //where I'm interested in the property *itself* 
```

到目前为止，我正在画一个空白。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-12T23:13:16.137

不幸的是，没有直接的方法可以做到这一点。但是，您可以在 .NET 3.5 中通过`Expression`. [请参阅此处](https://stackoverflow.com/questions/491429/how-to-get-the-propertyinfo-of-a-specific-property/491486#491486)了解更多信息。要复制示例：

```
PropertyInfo prop = PropertyHelper<Foo>.GetProperty(x => x.Bar); 
```

（更改它以返回名称而不是返回非常简单`PropertyInfo`）。

同样，编写一个变体也很简单：

```
OnPropertyChanged(x=>x.Name); 
```

使用：

```
OnPropertyChanged<T>(Expression<Func<MyType,T>> property) {...} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T23:14:56.790

这是一个经常被请求的特性，通常称为 infoof（“info of”），它将返回与成员关联的反射对象，例如

```
PropertyInfo pi = infoof(Person.Name); 
```

可悲的是，动态关键字正在占用 C# 编译器团队的时间！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T23:16:27.643

我非常有信心没有办法避免指定一个字符串 - 据我所知，C# 或 .NET 中没有内置的功能允许您传递对属性的引用，并且将 a 传递`string`给反射 API 是迄今为止成为最简单的方法。

但是，在标准 .NET 之外，您可能会在[PostSharp](http://www.postsharp.org/)（.NET 的面向方面编程）中找到您的解决方案，正如您在问题中所展示的那样，它允许您添加在各种属性更改时自动引发事件的代码。

# sql-server-2005 - 在 SQL Server 2005 (Winforms) 中从 .Net 连接

> ID：855343
> 
> 赞同：1
> 
> 时间：2009-05-12T23:10:35.983
> 
> 标签：sql-server-2005, ado.net, connection

我正在从 .Net Winforms 应用程序中获取典型的 Windows 集成连接：

*Dim sqlConnetion As New SqlConnection("Server=jupiter;Database=io;Integrated Security=True;") sqlConnetion.Open()*

我不断收到以下错误：

*无法打开登录请求的数据库“io”。登录失败。用户“MARS\viking”登录失败。*

我还尝试了以下连接字符串变体，结果相同：

*数据源=jupiter；初始目录=io；集成安全=True；*

*数据源=MSSGDEV；初始目录=MSSQLSERVER；集成安全=SSPI；*

奇怪的是，我可以使用 SQL Management Studio 连接到数据库，并使用集成安全性从同一台计算机与同一用户连接。我的连接代码中有错误吗？或者我必须在 SQL 服务器上设置一些特殊的配置设置以允许来自代码的连接？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T23:14:38.083

尝试“数据源=jupiter；初始目录=io；集成安全=True；” 反而。如果您使用集成安全，则必须使用数据源/初始目录。如果使用 Trusted_Connection，则可以使用服务器/数据库。 [ConnectionStrings.com](http://connectionstrings.com/sql-server-2005#1)很棒。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T23:30:20.960

编辑了我的答案（因为问题已更新）：

您需要更改“Integrated Security=True;” 到“集成安全=SSPI”或“Trusted_Connection=True”

（注意“Trusted_Connection”中的下划线）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T13:01:54.193

一位同事终于找到了答案。我将 sql server 实例（我的服务器上有两个 sql server 实例）放在数据库名称所属的插槽中。. . 感谢大家花时间帮助解决这个问题。

# sql-server - 所有相关的 SSIS 数据流转换对象中缺少身份插入？

> ID：855357
> 
> 赞同：1
> 
> 时间：2009-05-12T23:14:06.400
> 
> 标签：sql-server, ssis

我是这个特定星球上唯一一个因缺少**Identity Insert**而感到不便的人，在所有相关的 SSIS**数据流转换**对象中都缺少吗？

只有**批量插入任务**支持身份插入，SSIS 的其他地方呢？

SQL Server 2008 中是否有技术更改使得对SSIS中的**身份插入非常非常有限的支持成为必要？**

由于这个“小”细节，我更喜欢使用 C# 数据过程来调用包装在 SET IDENTITY_INSERT [MyTable] ON 和 SET IDENTITY_INSERT [MyTable] OFF 中的 SQL 代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T11:00:08.400

是的，这有点烦人。

您可以在设置 IDENTITY_INSERT ON/OFF 的数据流之前/之后放置一个执行 SQL 任务，并将其全部包装在事务中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-08T05:45:17.160

使用 OLEDB 源和目标对象。这为您提供了身份插入选项支持。我同意这对 ADO.net 对象来说是一笔糟糕的交易。

# javascript - 何时以及为什么在 JavaScript 中“返回 false”？

> ID：855360
> 
> 赞同：142
> 
> 时间：2009-05-12T23:14:26.510
> 
> 标签：javascript, jquery

何时以及为什么要`return false`在 JavaScript 中使用？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-05-12T23:18:40.230

通常，在事件处理程序中，例如`onsubmit`，返回 false 是告诉事件实际上不触发的一种方式。所以，比如说，在这种`onsubmit`情况下，这意味着表单没有提交。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2009-05-13T01:06:26.223

我猜您指的是您经常必须输入“return false”的事实；事件处理程序中的声明，即

```
<a href="#" onclick="doSomeFunction(); return false;">... 
```

'return false;' 在这种情况下，阻止浏览器跳转到当前位置，如 href="#" 所示 - 相反，只执行 doSomeFunction()。当您想向锚标记添加事件但不希望浏览器在每次点击时上下跳转到每个锚时，它很有用

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-05-12T23:24:06.557

它用于停止[事件的传播](http://www.quirksmode.org/js/events_order.html)。当你有两个元素都带有一个 click 事件处理程序时，你会看到（例如）

```
-----------------------------------
| element1                        |
|   -------------------------     |
|   |element2               |     |
|   -------------------------     |
|                                 |
----------------------------------- 
```

如果单击内部元素 (element2)，它将在两个元素中触发单击事件：1 和 2。这称为“事件冒泡”。如果您只想处理 element2 中的事件，则事件处理程序必须返回 false 以停止事件传播。

另一个例子是链接 onclick 处理程序。如果您想停止链接表单的工作。您可以添加一个 onclick 处理程序并返回 false。阻止事件传播到默认处理程序。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-05-12T23:18:39.607

呃......在布尔函数中表示“不正确”怎么样？

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2013-07-19T19:55:26.520

我也是在搜索“js，何时使用'return false;'后来到这个页面 在其他搜索结果中，我发现在 Chris Coyier 的 CSS-Tricks 网站上的一个页面更加有用和直接：['return false;'之间的区别 和'e.preventDefault();'</a>](https://css-tricks.com/return-false-and-prevent-default/)

 [他的文章的要点是：

> 函数（）{返回假；}
> 
> // 等于
> 
> 函数(e) { e.preventDefault(); e.stopPropagation(); }

虽然我仍然建议阅读整篇文章。](https://css-tricks.com/return-false-and-prevent-default/) 

[**更新：**在争论了使用 return false 的优点之后；作为 e.preventDefault() 的替代品；& e.stopPropagation(); 我的一位同事指出 return false 也会停止回调执行，如本文所述：](https://css-tricks.com/return-false-and-prevent-default/)[jQuery Events: Stop (Mis)Using Return False](http://fuelyourcoding.com/jquery-events-stop-misusing-return-false/)。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-05-12T23:22:30.660

使用 jQuery 的`each`函数时，返回 true 或 false 是有意义的。查看[文档](http://docs.jquery.com/Utilities/jQuery.each#objectcallback)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-12T23:39:17.887

我认为一个更好的问题是，为什么在您评估一组布尔返回值的情况下，您不会使用 true/ **false**吗？我的意思是，你可能有真/空，真/-1，其他杂项。Javascript“虚假”值来替代，但你为什么要这样做？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-07-13T10:17:40.800

当您想从锚标记触发 javascript 代码时，应使用 onclick 处理程序而不是 javascript: 伪协议。在 onclick 处理程序中运行的 javascript 代码必须将 true 或 false（或者一个表达式，而不是 evalues 为 true 或 false 的表达式）返回给标签本身 - 如果它返回 true，那么锚点的 HREF 将像普通链接一样被跟踪。如果它返回 false，则 HREF 将被忽略。这就是为什么“return false;”的原因。通常包含在 onclick 处理程序中代码的末尾。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-01-01T02:51:48.653

您使用 return false 来防止某些事情发生。因此，如果您在提交时运行脚本，则 return false 将阻止提交工作。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-10-11T14:54:20.900

在函数中调用 return 语句时，该函数的执行将停止。如果指定，则将给定值返回给函数调用者。如果省略表达式，则返回 undefined。

有关更多信息，请查看[MDN 文档页面以获取`return`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/return).

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-04-02T18:33:33.767

仅当您在功能中有一些磨损（通过某些测试）或您想停止某些功能时才使用 return false，例如在 end "onsubmit" 中使用 return false

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-02-21T23:00:32.847

此外，这个简短而有趣的链接可以阅读 [https://www.w3schools.com/jsref/event_preventdefault.asp](https://www.w3schools.com/jsref/event_preventdefault.asp)

定义和使用

如果事件是可取消的，则 preventDefault() 方法将取消该事件，这意味着属于该事件的默认操作不会发生。

例如，这在以下情况下很有用：

```
Clicking on a "Submit" button, prevent it from submitting a form
Clicking on a link, prevent the link from following the URL 
```

注意：并非所有活动都可以取消。使用可取消属性来确定事件是否可取消。

注意： preventDefault() 方法不会阻止事件通过 DOM 进一步传播。使用 stopPropagation() 方法来处理这个问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-02-08T18:19:35.430

### 为什么返回 false，或者事实上，为什么返回任何东西？

函数中的代码`return(val);`将 的值返回给函数`val`的调用者。或者，引用 MDN 网络文档，它...

> ...结束函数执行并指定要返回给函数调用者的值。（来源：[**MDN 网络文档：`return`**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/return)。）

`return false;`then 在事件处理程序中很有用，因为事件处理程序使用此值来确定进一步的操作。 `return false;`取消通常由处理程序发生的事件，同时`return true;`让这些事件发生。再次引用 MDN 网络文档...

> 处理程序的返回值确定事件是否被取消。（来源：[**MDN Web 文档：DOM OnEvent Handlers**](https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Event_handlers)。）

### 如果你要取消一个事件，返回 false；本身是不够的。

您还应该使用`Event.preventDefault();`and `Event.stopPropagation();`。

*   [**`Event.preventDefault();`**](https://developer.mozilla.org/en-US/docs/Web/API/Event/preventDefault)：停止默认的链接点击行为。

> Event 接口的 preventDefault() 方法告诉用户代理，如果事件没有得到显式处理，则不应像通常那样采取其默认操作。（来源：[MDN 网络文档](https://developer.mozilla.org/en-US/docs/Web/API/Event/preventDefault)。）

*   [**`Event.stopPropagation();`**](https://developer.mozilla.org/en-US/docs/Web/API/Event/stopPropagation)：阻止事件单击包含父级 DOM 中的链接（即，如果两个链接在 UI 中视觉上重叠）。

> Event 接口的 stopPropagation() 方法可防止在捕获和冒泡阶段进一步传播当前事件。（来源：[MDN 网络文档](https://developer.mozilla.org/en-US/docs/Web/API/Event/stopPropagation)。）

### 工作演示

在这个演示中，我们取消了一个链接的功能，并通过、和`onclick`来防止链接被点击。`return false;``preventDefault()``stopPropagation()`

**[完整的 JSBin 演示。](https://jsbin.com/zikayimaqu/edit?html,js,console,output)**

*StackOverflow 演示...*

```
document.getElementById('my-link').addEventListener('click', function(e) {
  console.log('Click happened for: ' + e.target.id);
  e.preventDefault();
  e.stopPropagation();
  return false;
});
```

```
<a href="https://www.wikipedia.com/" id="my-link" target="_blank">Link</a>
```

# uml - TIME 是用例中的参与者吗？

> ID：855361
> 
> 赞同：11
> 
> 时间：2009-05-12T23:14:34.653
> 
> 标签：uml, use-case

好吧，关于一个真正的错误问题：

a) 系统的参与者仅由人类或其他软件组件代表。

我说是，老师把它标记为错误，不是因为他认为我错过了硬件组件（我想我会部分承认），而是因为，用他的话来说：

“TIME也是演员。”

用例图如何将 TIME 视为参与者？

请参阅任何将时间视为演员的参考书目。我没有找到任何东西，说实话，我认为这没有任何意义。时间不会自己行动，它要么是一个系统，要么是一个按计划工作的人。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-12T23:22:34.700

UML 2 用例图表指南在这里...

[http://www.agilemodeling.com/style/useCaseDiagram.htm](http://www.agilemodeling.com/style/useCaseDiagram.htm)

...展示如何表示时间。

我怀疑你应该请你的老师解释时间是一个演员，以及它是如何在用例图上表示的，因为毕竟他们会标记你的下一个作业，所以他们的解释胜过所有其他人:-)

哦，维基百科说时间是一个演员，所以它一定是真的：

[http://en.wikipedia.org/wiki/Use_case](http://en.wikipedia.org/wiki/Use_case)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-03-22T21:49:47.923

我不同意时间是演员。您真正需要考虑的是谁将从行动中受益，并在功能描述中设置时间表的创建和执行。看看这篇文章：

[博士用例](http://www.ibm.com/developerworks/rational/library/content/RationalEdge/jun02/DrUseCaseJun02.pdf)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-12T23:17:54.507

参与者可以被视为启动用例的某人或某事。计划任务按“时间”启动。从这个意义上说，“时间”是一个参与者，因为它启动了一个用例。

例子：

必须每 6 小时生成一份报告。因此，时间“6 小时”必须是演员，因为生成任务将每 6 小时启动一次。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T10:22:24.547

我同意让时间成为演员。如果系统中的用例在某个时刻被触发，我会将 Time 建模为参与者并将其与该用例相关联。在这些场景中，时间可以被认为是一个外部实体（因此也是一个参与者）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-10T13:37:23.030

是的 TIME 可以成为用例中的参与者。但不应该是主要参与者。因为它确实违反了用例中参与者的定义。

```
Primary actor is someone/thing which has a goal for interacting with the system. 
```

时代有什么样的目标？

```
Time ------> RunPayroll 
```

谁从运行工资单中受益？也许时间演员隐藏了一个真正的演员。

```
Payroll Administrator (primary actor) ---> RunPayroll  --> Time (Supporting actor) 
```

但这确实给人以工资管理员手动调用的运行工资用例的印象？毕竟我们正在开发一个自动化系统？

> 但请记住，如果我们将工资单管理员用作主要参与者，那么我们可以捕获围绕工资单运行的所有系统功能。这包括允许工资单管理员设置运行工资单的时间表以及处理差异、人工干预和假期的功能。[亲爱的博士用例：时钟是演员吗]

[你可以从Dear Dr. Use Case: Is the Clock an Actor](http://www.ibm.com/developerworks/rational/library/content/RationalEdge/jun02/DrUseCaseJun02.pdf)那里得到那篇精彩的 Ibm 文章 。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-06-04T19:01:57.683

我也同意时间不是这种情况下的主要参与者。我想添加一些解释来支持“作为演员的时间”通常根本不是一个好主意的想法。
(1)**让我们给这个东西另一个名字和一个可行的定义**。时间是可以测量的。但是，准确地定义这个概念是一个非常复杂的科学问题。因此，对于日常使用而言，描述与它的交互几乎没有意义。更适合我的角色的描述和名称是衡量时间并能够通知它的东西，例如 TimeService。
(2) 我们可以在任何地方测量时间。**时间不仅在环境之外**. 只有当用户要求我们的时间提供者不能成为构建系统的一部分时，我们才应该描述与辅助参与者 TimeService 的交互及其接口。但大多数时间服务将是实现/实现用例的类或组件之一，并且在 UC 图中不作为参与者。
[有关更多详细信息：这是我写的关于它的简短文本。](https://plus.google.com/106469873950397987560/posts/FSPrSWRyFCM)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-01-26T15:05:00.637

在[我](https://stackoverflow.com/a/6600387/135078)对[类似问题](https://stackoverflow.com/questions/6599219/uml-use-cases-how-to-model-a-batch-feature/6600387#6600387)的回答中，我说他们对应该在给定时间执行的活动进行建模的方法是创建一个名为“Scheduler”的参与者，它更像是一个占位符并且没有提及技术。这个想法是必须有一些人或组件负责监控时间，然后启动特定的用例。用例根据用例的需要说“这个用例在时间 X 开始”。是的，时间是一个可以建模的因素，但教练的方式对我来说似乎有点牵强，因为时间本身并不关心什么时候会发生什么，它就是这样。他过度概括，试图将所有类型的用例融入他的建模概念。

在与讲师的假设讨论中，我会问：“时间本身——没有其他机制、人或软件——是作用于系统的实体吗？” 显而易见的答案是“不”，但想法是可以有一个任意的参与者 a) 可以测量时间，并且 b) 知道某些用例对时间敏感。

我确实喜欢[@Igor 回答中的文章，](https://stackoverflow.com/a/5398267/135078)因为它确实涵盖了让 Time 成为主要演员的大部分问题。

演员通常由某种名词表示，所以也许折衷方案是使用时钟作为演员，而不是大写的-T“时间”。像其他海报一样，我同意您不太可能说服老师，但值得讨论，因为这有助于了解他对建模的总体看法。

虽然我意识到对于产生这个问题的课程来说为时已晚，但我发布这个答案是为了帮助那些在用例中遇到建模时间问题的其他人，或者遇到一位有自己看法的教授如何使用 UML 用例建模。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-12T23:20:08.323

时间与系统相互作用。例如，时间过去了，系统必须根据那个“动作”做一些事情。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-16T14:15:47.560

我同意**@Novalis**时间可以是参与者但不是主要参与者，因为每个利益相关者都是参与者，时间可以对任何利益相关者的利益或损失负责，因此它可以被视为次要参与者或您想要给出的任何名称。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-10-30T22:18:02.303

直到我更清楚地知道，我发现当演员的时间有点令人困惑，特别是因为演员**在表演**，而*时间是由于事物在变化的事实*：地球围绕太阳旋转，水晶在脉动。*我们使用更改时间转换器*工具（即时钟！）将这些更改的汇总副作用转换为我们称之为**的人造尺度**：时间。

# facebook - 在 CakePHP 中，是否可以有内部和外部路由？

> ID：855370
> 
> 赞同：1
> 
> 时间：2009-05-12T23:16:55.397
> 
> 标签：facebook, cakephp, routing

Facebook 应用程序托管在我的服务器上，例如[http://server.com/projects/fbapp/](http://server.com/projects/fbapp/)，但只能*在*Facebook 中查看，例如[http://apps.facebook.com/fbapp/](http://apps.facebook.com/fbapp/)。

使用 CakePHP 这会带来一个问题 - 路由应该以“/project/fbapp”为前缀还是只是“fbapp”？

这是一个问题，因为路由不仅用于路由入站请求，还用于生成链接（和表单操作等）。

作为一个杂物，我现在每条路线有两个路由指令：

```
Router::connect('/pages/*', array('controller' => 'pages', 'action' => 'display'));
Router::connect('projects/fbapp/pages/*', array('controller' => 'pages', 'action' => 'display')); 
```

第一个不需要前缀，因为我在 bootstrap.php 中包含了一行：

```
Configure::write('App.base', '/fbapp'); 
```

在反向路由操作期间启动。

我的问题是是否有更优雅的方式来做到这一点？这看起来很丑陋，我敢肯定它不是很蛋糕。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-18T02:44:54.130

按要求交叉发表我的评论：

来自facebook的（apache）流量重写不是最优雅的解决方案吗？你的内部机器只需要处理一个路径，如果你想在以后将应用程序与另一个服务/平台集成，你只需要添加另一个重写规则而不是弄乱应用程序本身。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-18T20:38:08.577

我会尝试一下，基于[Ask Apache](http://www.askapache.com/htaccess/mod_rewrite-tips-and-tricks.html)和我在一些旧项目上制定的一些规则。我认为把它放在你的 webroot 中的 .htaccess 文件中就可以了（但这是一个猜测）。

```
Options +FollowSymLinks
RewriteEngine on
RewriteBase /
RewriteCond %{REQUEST_URI} ^/projects/fbapp/pages.*
RewriteRule ^/projects/fbapp/pages/(*)$ /pages/$1 [L] 
```

以上应该（如果我做对了）将任何匹配[http://server.com/projects/fbapp/pages/](http://server.com/projects/fbapp/pages/) * 的请求重写为[http://server.com/pages/](http://server.com/pages/) * 即[http://server.com/项目/fbapp/pages/foo](http://server.com/projects/fbapp/pages/foo) => [http://server.com/pages/foo](http://server.com/pages/foo)。

**编辑**在 Apache 部分中找到[了这个。](https://stackoverflow.com/questions/878186/beginner-apache-url-rewrite-question)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-22T16:45:48.040

你根本不需要做任何事情！Cake 会为您处理基本 URL，因此您不需要复制路由，也不需要处理基本 URL。您需要做的是路由您的相对 URL，而不是使用`projects/fbapp/`，或您要处理的任何前缀：

```
Router::connect('/pages/*', array('controller' => 'pages', 'action' => 'display')); 
```

这就是我处理应用程序中所有请求的方式，我将其部署`http://www.example.com`在`http://localhost/workspace/example.com/trunk/deploy`. 它在两种环境中都像一个魅力。

# c# - 我应该使用什么设计模式在 Linq 搜索屏幕的查询和文本框之间创建简单的绑定映射？

> ID：855378
> 
> 赞同：2
> 
> 时间：2009-05-12T23:19:13.927
> 
> 标签：c#, winforms, linq, lambda

一遍又一遍，我发现自己在开发 WinForm 业务应用程序屏幕，其中有一堆用于搜索条件的文本框，然后是一个搜索按钮。这些使用 Linq 映射到表达式中，然后传递到我的 Linq2Sql 层。

我想创建一种简单的方法来使用“包含”、“startswith”、“exactmatch”等不同的选项将这些文本框“绑定”到底层查询......

我想象的是这样的（注意 SearchBinderT 是虚构的）：

```
SearchBinder<Customer> searchBinder = new SearchBinder<Customer>();
searchBinder.Bind(txtFirstName, a=>a.FirstName, SearchBinderOptions.StarsWith);
searchBinder.Bind(txtLastName, a=>a.LastName, SearchBinderOptions.StarsWith);
searchBinder.Bind(txtTelephone, a=>a.Phone, SearchBinderOptions.Equals);
searchBinder.SetAction(btnSearch, MyMethodThatHandlesTheExpressionTreeAndFillsTheResults); 
```

**然后单击搜索将自动生成文本框不为空**的表达式树并执行搜索。但这只是我脑海中的一种模式——还有更多。我主要专注于快速应用程序开发。

*   你会为此使用什么设计模式（或者我认为是好的）？
*   您将如何处理其他数据类型（小于/大于的日期/数字）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-12T23:46:30.403

lambdas 的延迟执行和捕获状态不能解决这个问题吗？

```
Predicate<Customer> searchQuery = c => {
   c.FirstName.StartsWith(txtFirstName.Text)
   && c.LastName.StartsWith(txtLastName.Text)
   && c.Phone == txtTelephone.Text;
}

void btnSearch_Click(object sender, EventArgs e) {
    return IEnumerable<Customer>.Where(searchQuery);
} 
```

由于`searchQuery`在单击按钮之前不会执行，因此无需抽象出与“构建器”组件的比较。访问文本框存在整个多线程问题，但您可以使用 a`Expression<T>`代替并使用`Control.Invoke`. 或者，只是写它`Invoke`开始。或者，将其发送回 UI 线程以运行。

但是，如果您真的想采用您的设计 - 我建议您使用`Expression<T>`而不是您拥有的比较运算符。它更灵活，可以为您节省大量工作。

至于设计模式，我所知道的最接近的是[Query Object](http://ayende.com/Blog/archive/2007/03/29/Query-Objects-vs.-Methods-On-The-Repository.aspx) - [N]Hibernate 以[Criteria](https://www.hibernate.org/hib_docs/v3/api/org/hibernate/Criteria.html)的形式存在。不过，它更多地处理构建动态查询，而不是绑定到 UI 元素（同样，我没有看到这一点）。在您的示例中，您的查询是硬编码的 - 所以我不确定会有什么好处。

# apache-flex - Flex 组件库？

> ID：855382
> 
> 赞同：1
> 
> 时间：2009-05-12T23:20:36.030
> 
> 标签：apache-flex, flex3

我的老板要求我使用 flex 制作一个 webapp 的半功能模型。他要求它看起来像“哇！” 尽可能。内置的 flex 组件非常基础。有没有外观漂亮的组件的库？我找到的唯一一个是 flexlib，它很棒，但我仍然需要更多组件。我也想找到一些漂亮的图表。

ps 我的老板就是其中之一“哦，它很闪亮！” 那种家伙，所以越多不必​​要的花里胡哨越好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T00:19:41.020

看看[环法自行车赛](http://www.adobe.com/devnet/flex/tourdeflex/)。它包括一个带有演示的 3rd 方库的部分。

这是[组件、库和 API 的列表](http://seantheflexguy.com/blog/2007/08/21/list-of-31-flex-apis-libraries-components-and-tools/)。

要为应用程序设置样式，请从[Flex Style Explorer](http://www.adobe.com/devnet/flex/samples/style_explorer/)开始。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T23:24:54.057

有[ILOG Elixir](http://www.ilog.com/products/ilogelixir/)，但它不是免费的。我们在我上一份工作中使用过它；这很不错。

另外，当你的老板说要快速给他看一些闪亮的东西时，要小心。您可能会被要求在比物理上更短的时间内开发一个系统。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T00:26:04.140

您需要更多组件，还是需要更好地寻找其中的组件？查看 scalenine 以了解一大堆基于 Flex 的样式，其中一些肯定具有“哇哦”的外观。

[http://scalenine.com/](http://scalenine.com/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T16:46:08.367

这个网站有一个 Flex 组件列表：

[http://seantheflexguy.com/blog/2008/05/24/36-new-cool-flex-and-as3-tools-libraries-and-components/](http://seantheflexguy.com/blog/2008/05/24/36-new-cool-flex-and-as3-tools-libraries-and-components/)

或查看此链接：

[http://fleksray.org/adobe_flex_components_en.html](http://fleksray.org/adobe_flex_components_en.html)

或这个：

[http://www.afcomponents.com/components/](http://www.afcomponents.com/components/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T11:14:12.840

你可以看看[http://lab.kapit.fr/](http://lab.kapit.fr/)

那里有很多免费的图表组件可能会给你的老板留下深刻印象。

# security - 有没有办法绕过 SSP（StackSmashing Protection）/Propolice？

> ID：855394
> 
> 赞同：6
> 
> 时间：2009-05-12T23:24:28.443
> 
> 标签：security, stack-overflow, buffer-overflow

经过一些研究，我没有找到任何描述方法的论文（甚至没有不可靠的）。似乎 SSP (StackSmashing Protection)/Propolice

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-01-19T08:32:03.197

Canary 是一种非常好的安全措施，可以防止某些缓冲区溢出。多年来，各种 Canary 实现已经被破坏，然后变得更加安全。重要的是，即使在 Vista、Windows 7 和 Fedora 11 上仍然使用高级内存保护缓冲区溢出...

一件非常重要的事情是 Canary 只保护函数的调用框架（其中包括强大的 EIP！）。缓冲区溢出可能发生在另一段内存（例如堆）中，而金丝雀则没有影响。此外，可以使用缓冲区溢出攻击应用程序，而无需覆盖 EIP。控制 EIP 是一种非常直接且简单的方法，可以将缓冲区溢出变成杀手级漏洞利用，这就是为什么它是最常见的漏洞利用方法。

这些利用方法以及其他利用方法在[Exploiting Software: How to break code](http://www.exploitingsoftware.com/)中有详细介绍。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T02:34:52.327

我对微软的 GS 堆栈保护比较熟悉，但是这两种方法[看起来很相似](http://en.wikipedia.org/wiki/Stack-smashing_protection)。

以下来自 Microsoft 的博客文章显示了一个示例，即使在使用堆栈 cookie 时攻击者仍然可以控制（第一个示例应该适用于非 Windows 系统）：

*   [http://blogs.technet.com/srd/archive/2009/03/16/gs-cookie-protection-effectiveness-and-limitations.aspx](http://blogs.technet.com/srd/archive/2009/03/16/gs-cookie-protection-effectiveness-and-limitations.aspx)

这篇博文讨论了一些即将到来的堆栈保护改进：

*   [http://blogs.technet.com/srd/archive/2009/03/20/enhanced-gs-in-visual-studio-2010.aspx](http://blogs.technet.com/srd/archive/2009/03/20/enhanced-gs-in-visual-studio-2010.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-31T19:52:01.083

如果应用程序在堆栈上有一个数组/缓冲区，并且使用调用者控制的索引值而不进行边界检查，那么调用者将能够访问任意内存位置，并且堆栈保护将无法阻止或检测它。

# javascript - Javascript 可以访问 Ajax 文本/html 响应的 DOM 吗？

> ID：855404
> 
> 赞同：7
> 
> 时间：2009-05-12T23:27:00.280
> 
> 标签：javascript, html, ajax, dom

我正在尝试使用 Ajax 来获取一个 HTML 页面，然后通过它的 ID 拉出一个 div，并将该 DIV 插入到当前页面中。因此，当前页面加载（通过 Ajax）第二个页面，将 div 从 Ajax 响应中拉出并插入到当前页面中。但是我很茫然，除非响应是 text/xml，否则我不能在其上使用任何 DOM 函数……可以吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-12T23:46:31.980

Jquery（或其他库？？）基本上会为你做这一切。我强烈建议研究这一点，而不是重新发明轮子。

对于查询，它可能会喜欢：

```
// Make a call to url, with data 
$.ajax(
  { url: $url,
    data: $data, 
    dataType: 'xml',
    callback: function(returnData) { 
      // Jquery find <mytag attribute="foo">...</mytag> and store it in mydata
      var mydata = $(returnData).find('mytag[attribute=foo]');
      // Insert into current page to somewhere with class="after-me"
      $('.after-me').html(mydata);
   }
}); 
```

我可能语法错误。但这里是文档：[http ://docs.jquery.com/Ajax/jQuery.ajax#options](http://docs.jquery.com/Ajax/jQuery.ajax#options)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T23:38:18.000

是的你可以。 [在这里](http://www.w3schools.com/Xml/xml_parser.asp)，您将找到有关如何解析 XML 响应的资源。

如果你将它加载到已经存在的 DOM 树中（`innerHTML`），你应该能够调用你习惯的标准 DOM 遍历函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T13:55:56.863

不用担心有效性，因为您使用 javascript 动态执行此操作，您可以使用响应数据填充隐藏元素的 innerHTML，然后使用您希望的任何 DOM/jQuery 函数

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T23:43:18.117

脚本标签将在任何浏览器上通过任何方法失败。所以要访问当前页面的 dom，请在您当前请求的脚本文本上应用“eval”函数。

我的意思是，如果你有像这样的html：

```
<div id="content">some html</div> 
```

你得到了服务器端的脚本文本，比如

```
content.innerHTML = "foo"; 
```

在 ajax 响应上使用 eval 函数

```
function onXmlHttpAnswer()
{
   if(xmlHttp.readyState==4 && xmlHttp.status==200)eval(xmlHttp.responseText);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-03T03:11:31.477

为了使用 jQuery 仅提取通过 $.load() 加载的 HTML 文档的一部分，请执行以下操作：

```
$('#dynamic').load('content.html #desiredElement'); 
```

.load 实际上会加载整个文档，但选择器将强制加载仅返回该文档的选定部分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-09-20T05:54:25.603

试试这个。这对我有用。

```
$.ajax({
    url: 'http://www.example.com',
    type: "GET",
    crossDomain: true,
    dataType: 'html',
    success: function (responseHTMLData) {   
        $($(responseHTMLData).find('.yourClassName')).each(function() {
            console.log($(this).attr('href'));
        });
    }
}); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-11-08T09:43:04.240

```
$.ajax({
  type: "POST",
  url : "yourURL"
  data : $("#yourFormID").serialize(),
  async: true,
  success : function(resp) {
    // resp contains data in html form you want to find data in
    // <span class="error">some Error</span>
    var errorData = $(resp).find('span.error').text();   
    // errorData would have value "some Error"             
  }
}); 
```

# c# - DbLinq 问题（关键字 New 或 MemberInit 引发异常）

> ID：855407
> 
> 赞同：0
> 
> 时间：2009-05-12T23:28:38.887
> 
> 标签：c#, asp.net, linq, dblinq

我正在将一个巨大的 Web 应用程序从 SQL Server 迁移到 MySql。该应用程序使用 Linq，所以我使用的是 DBLinq。目前大多数事情都正常工作，除了在几页上我得到一个奇怪的错误。一切都是从这个开始的：

```
Property 'Int32 ForumID' is not defined for type 'DbLinq.Data.Linq.Table`1[CPost]' 
```

我显然在 CPost 类中有一个 ForumID，所以这不是问题。我尝试将查询复制到一个单独的文件并开始删除其中的一部分以查看导致错误的原因。过了一会儿，我发现这条线：

```
var q = from u in db.Users select new {ab = u}; 
```

引发异常：

```
New 
```

在线：

```
throw new ArgumentException(operationType.ToString()); 
```

```
源文件：D:\Visual Studio 2008\Projects\DbLinq\src\DbLinq\Data\Linq\Sugar\Implementation\ExpressionDispatcher.Analyzer.cs 行：858
```

但是这段代码：

```
var q = from u in db.Users select u; 
```

跑得完美。

如果需要，我可以提供更多信息，但是我不能发布整个源代码，因为它非常庞大*（超过 10,000 行，不包括 html）。*有没有人遇到过类似的问题？

**编辑：**经过进一步调查，我发现 DbLinq 抱怨，因为它没有从查询中找到关键字 New 或 MemberInit

```
var q = db.Posts.Select(post => post); 
```

工作时：

```
var q = db.Posts.Select(o => new SPost {Post = o}); 
```

和

```
var q = db.Users.Select(u => new {user = u}); 
```

引发异常。异常发生[在 trunk/src/DbLinq/Vendor/Implementation/SqlProvider.cs 的第 285行](http://code.google.com/p/dblinq2007/source/browse/trunk/src/DbLinq/Vendor/Implementation/SqlProvider.cs#285)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-05T14:00:53.643

I'd avoid using DBLinq for production code... many of Linq-To-SQL's features aren't implemented, and walking through the source code shows a low level of maturity... many of the methods are not implemented or marked as "unterminated".

...you've been warned!

# python - 在 OSX 上运行 django

> ID：855408
> 
> 赞同：1
> 
> 时间：2009-05-12T23:29:12.147
> 
> 标签：python, django, macos

我刚刚完成了非常非常好的 django 教程，一切顺利。本教程的第一部分之一是它说不要在生产中使用他们的示例服务器，我在教程之后的第一件事就是尝试在 apache 上运行我的应用程序。

我正在运行 OSX 10.5 并拥有标准的 apache（它拒绝运行 python）和 MAMP（它勉强允许它在 cgi-bin 中）。问题是我不知道要调用哪个脚本，在教程中它总是 localhost:8000/polls 但我不知道这意味着如何映射到特定文件。

我是否错过了一些关于如何处理 .htaccess 文件的明显内容，或者本教程实际上没有解释如何在其他地方使用它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T00:55:15.193

你可能不会觉得`.htaccess`通过 Apache 配置 Django 有什么乐趣（尽管我承认如果你有足够的决心，你可能会这样做......但对于生产我怀疑它会比必要的更复杂）。我在 OS X 中开发和运行 Django，它运行得非常无缝。

秘诀是您必须配置`httpd.conf`为通过以下三个选项之一将请求传递给 Django：（`mod_wsgi`最现代的方法）、`mod_python`（第二好，但在 OS X 的 Python 2.5 上运行良好）、`fastcgi`（嗯...如果您必须匹配您的生产环境）。

Django 的[部署文档](http://docs.djangoproject.com/en/dev/howto/deployment/#howto-deployment-index)对所有三个选项都有很好的建议和说明。

如果您使用默认的 OS X apache 安装，请`/etc/apache2/httpd.conf`使用上面 Django 文档中的指令进行编辑。我不能代表 MAMP，但是如果您从源代码构建 Apache（这在 OS XI 上非常容易，确实想知道为什么有人会为 MAMP 烦恼……我的不安全感正在显现），请编辑`/usr/local/apache2/conf/httpd.conf`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-13T04:14:09.140

除非您打算使用 OS X 进行生产，否则您可能不想打扰。如果必须这样做，请直接访问 mod_wsgi。不要为 mod_python 或更旧的解决方案而烦恼。我在 Apache 上做了 mod_python，虽然它现在运行得很好，但设置起来却花了无数个小时。

此外，只是为了根据您所说的澄清一些事情：您不会在 url 路径（如 /polls）和正在调用的脚本之间找到映射。Django 不是这样工作的。使用 Django，您的应用程序被加载到内存中等待请求。一旦请求进入，它就会通过您在 urls.py 中创建的 url 映射进行分派。这归结为代码中某处的函数调用。

这就是为什么对于像 Apache 这样的网络服务器，您需要一个像 mod_wsgi 这样的模块，它可以让您的应用程序在内存中占有一席之地。将其与 CGI 之类的东西进行比较，其中网络服务器在 url 和文件系统之间物理映射的位置按需执行特定脚本。

我希望这对您有所帮助，而不是告诉您您已经知道的事情。:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-13T04:16:04.910

如果您计划在生产（或非开发）模式下运行它，另一种选择是取消 Apache 并使用像 nginx 这样的轻量级工具。但是，如果您正在从事开发工作，您将希望坚持使用 Eclipse 中的内置服务器和 PyDev。在 Eclipse 调试器中逐行浏览服务器代码要容易得多。

nginx/Django 的安装说明在这里：[http ://snippets.dzone.com/tag/nginx](http://snippets.dzone.com/tag/nginx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T09:32:16.360

另一种选择是考虑使用虚拟机进行开发。您可以安装生产服务器将运行的任何操作系统的完整版本（例如 Debian），并在 VM 中运行 Apache 和 DB。

您可以连接到 Finder 中的虚拟磁盘，因此您仍然可以在 OSX 上使用 TextMate（或其他）进行编辑。

我通过 VMWare Fusion 获得了很好的经验。

# c++ - 通过模板从字符ID映射到C++中的类名？

> ID：855417
> 
> 赞同：1
> 
> 时间：2009-05-12T23:32:27.040
> 
> 标签：c++

重复：[有没有办法从保存类名的字符串中实例化对象？](https://stackoverflow.com/questions/582331/c-is-there-a-way-to-instantiate-objects-from-a-string-holdig-their-class-name)

* * *

C++ 中是否有（更好的）方法将字符串 id 映射到类名。我怀疑可能有一种通过模板的方法，但我无法找出正确的方法。

例如，如果我有多个消息，每个消息都在第一个字节中存储一个字符 id。所以消息 A12345 将实例化类 A() 消息 B12345 将映射到类 B()。

我有一组消息解析器，每个类都可以解析给出的消息。问题是我必须手动生成解析给定消息的类（例如类A（））和消息ID（例如'A'）之间的映射。

这就是我现在在代码中所做的事情，我在想是否有一种很好的方法可以消除 c++ 中的开关（模板魔术？）：

```
Msg * msg;
switch(data[0])
{
    case 'A': msg = new A(); break;
    case 'B': msg = new B(); break;
    ...
}

msg->parse(data); 
```

在旁注中，大多数时候 id 实际上是 2 个字符长，所以 'A1' 'B1' 等等。而且我使用相同的类名来跟踪类，例如'A1'可以被类A1（）解析等等。

**注意**：这似乎是[C++ 的副本：有没有办法从字符串中实例化对象，并保留它们的类名？](https://stackoverflow.com/questions/582331/c-is-there-a-way-to-instantiate-objects-from-a-string-holdig-their-class-name)所以我建议关闭这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T23:40:07.403

我建议使用[Boost.Any](http://www.boost.org/doc/libs/1_39_0/doc/html/any.html)。然后，您可以将您的 any 解释为 A 或 B：

```
if (myAny.type() == typeid(A))
{
    boost::any_cast<A>(myAny).whatever();
}
else if (myAny.type() == typeid(B))
{
    // do whatever
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T23:36:13.820

没有办法使用模板或任何东西来做到这一点；C++ 没有反射。RTTI 可能会有所帮助，但您不能在运行时根据其名称创建类的实例（就像使用 .NET 或 Java 反射一样）。

但是，您可以使用宏使其更简单。假设您不想要单个字符类名（如您的示例中所示），则不能使用`switch`. 尝试这样的事情：

```
#define CREATE_MSG(t) if(strcmp(data,#t)==0) msg=new t()

// I know CREATE_MSG is not a good name,
//but I couldn't think of something better

Msg *msg;

CREATE_MSG(A);
CREATE_MSG(B);
CREATE_MSG(C);

msg->parse(data); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T23:43:23.997

正如其他人所说，它不能使用模板来完成（模板是在编译时计算的。但是你的角色 id 是在运行时计算的）。

您可以使用从 id 到构造函数的映射。归结为这个问题：[从保存类名的字符串中实例化对象](https://stackoverflow.com/questions/582331/c-is-there-a-way-to-instantiate-objects-from-a-string-holdig-their-class-name)

我建议你保持简单。如果普通开关可以做到这一点，请保持这种状态。如果你以后真的需要它可扩展，你仍然可以引入一些自动查找字符 id 等等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T23:44:47.333

您无法消除（如果它们是字符串`switch`，则会消除）。`if-else`一个快捷方式是使用宏：

```
#define str(x) #x
#define xstr(x) str(x)
#define cond(var, type) (var == xstr(type)) { new type; } 
```

并将其用作：

```
if cond(data, A)
else if cond(data, B) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T23:50:08.823

您可以有一个数据结构（例如字典或例如对数组），它将字符串 ID 映射到构造类的静态函数。就像是：

```
Msg* createA() { return new A(); }
Msg* createB() { return new B(); }

typedef Msg* (*Pfn_create)();

typedef std::map<char,Pfn_create> MsgMap;
MsgMap s_msgMap;

void initialize()
{
  s_msgMap.insert(MsgMap::pair('A',createA));
  s_msgMap.insert(MsgMap::pair('B',createB));
}

void dispatch(const Data& data)
{
  MsgMap::iterator it = s_msgMap.find(data[0]);
  Pfn_create creator = it->second;
  Msg* msg = creator();
  msg->parse(data);
} 
```

# .net - 如何将方法作为参数传递而不在 .NET 中声明委托

> ID：855420
> 
> 赞同：3
> 
> 时间：2009-05-12T23:33:53.403
> 
> 标签：.net, parameters, methods, delegates

无论我如何尝试，如果不声明委托，我都无法模仿 Rhino Mocks 的简洁语法。

例子：

```
Expect.Call(service.HelloWorld("Thanks")) 
```

你对如何做到这一点有任何想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-12T23:41:04.173

您可以使用较新版本的 .NET 中提供的 Action 委托

```
void Execute(Action action) {
    action();
}

void Test() {
    Execute(() => Console.WriteLine("Hello World!"));
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-12T23:40:38.433

使用3.5 中的[Lambda](http://msdn.microsoft.com/en-us/library/bb397687.aspx)语法，您可以获得类似的语法。

```
public void Call(Action action)
{
    action();
}

Expect.Call(() => service.HelloWorld("Thanks")); 
```

[Moq](http://code.google.com/p/moq/)是一个模拟框架，它使用 Lambda 语法进行模拟。

```
var mock = new Mock<IService>();
mock.Setup(service => service.HelloWorld("Thanks")).Returns(42); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-19T17:26:35.057

在 Rhino Mocks 中，它实际上是在调用该方法。该对象当时处于设置模式，当您调用它时，它正在记录参数和设置期望。这就是您可以摆脱委托语法的原因。不幸的是，在许多其他情况下实际上是不可能的。

# sql - Oracle/SQL：为什么查询“SELECT * FROM records WHERE rownum >= 5 AND rownum <= 10” - 返回零行

> ID：855422
> 
> 赞同：10
> 
> 时间：2009-05-12T23:35:03.340
> 
> 标签：sql, oracle

为什么以下查询返回“零”记录：

```
SELECT * FROM 记录 WHERE rownum >= 5 AND rownum <= 10

     或者

SELECT * FROM 记录 WHERE rownum >= 5

```

而以下查询返回正确的记录：

```
SELECT * FROM 记录 WHERE rownum <= 15

```

问候，
-阿什什

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-05-12T23:44:15.540

在 Oracle 中，Rownum 值是在查询的过滤阶段之后分配的——它们不是表的行，它们是查询结果集的行。

因此，返回的第一行将始终为 rownum 1，返回的第二行为 rownum 2，依此类推。

rownum 值仅在分配后才递增，因此任何查询都像

```
select * from t where ROWNUM > 1 
```

永远**不会**返回任何结果。这个查询说'我不想看到返回给我的第一行，只有之后的那些'这是一个悖论，所以什么都没有返回。

有关详细信息，请参阅[询问 Tom：关于 ROWNUM 和限制结果](http://www.oracle.com/technetwork/issue-archive/2006/06-sep/o56asktom-086197.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-06-24T13:33:31.503

ROWNUM 是一个伪列，它的值在查询执行时不可用。因此，您无法根据此列过滤结果。话虽如此，有一些变通方法可以减轻它。请参见下文（如果您的结果非常庞大，不建议使用）。

```
Select a.* From 
(
  Select COL1, COL2, ROWNUM RowNumber From MyTable
) a
Where
   RowNumber = 5; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-06-30T14:32:40.690

替代方法是使用`MINUS`

```
SELECT * FROM records 
WHERE   ROWNUM <= 10
minus SELECT * FROM records 
WHERE   ROWNUM <= 5 
```

这将过滤掉非唯一值，因此您最好选择 id。

希望这可以节省您一些时间。

# iphone - 在 Objective-C (iphone) 中，如何管理“@protocol”引用的内存？

> ID：855441
> 
> 赞同：17
> 
> 时间：2009-05-12T23:42:27.587
> 
> 标签：iphone, objective-c, memory-management

我认为我对 Objective-c 的内存管理有很好的处理，但我无法弄清楚以下情况：

* * *

```
@protocol MyProtocol
@end 
```

* * *

```
@interface MyObject : NSObject {
    id<MyProtocol> reference;
}
@property (nonatomic, retain) id<MyProtocol> reference;
@end 
```

* * *

```
@implementation MyObject 
@synthesize reference;
-(void) dealloc {
    [reference release];
    [super dealloc];
}
...
@end 
```

* * *

这给了我一个“**警告：'-release' not found in protocol(s)** ”。我可以安全地忽略此错误吗？还是我做错了什么？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-12T23:47:45.660

是的，您可以放心地忽略此错误。声明为类型的对象`id<MyProtocol>`可能不会继承自`NSObject`（您不必*使用*Cocoa 库在 Objective-C 中编程，即使在 Cocoa 中也有其他根类，例如`NSProxy`）。由于`retain`(and `release`, `autorelease`) 在 中声明`NSObject`，编译器无法知道声明为 type 的实例`id<MyProtocol>`响应这些消息。为了解决这个问题，Cocoa 还定义了镜像API的`NSObject` *协议。*`NSObject`如果您将协议声明为

```
@protocol MyProtocol <NSObject>
@end 
```

表示`MyProtocol`扩展`NSObject` *协议*，您将被设置。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-13T01:15:10.457

通常，当您声明一个对象时，`id`它会计算一个“任何”对象（这意味着 Objective-C 将允许您在`id`没有警告的情况下从任何类或协议调用任何方法）。

但是，当您将对象声明为`id<SomeProtocol>`时，含义会发生变化。在这种情况下，您会说：我只会调用`SomeProtocol`此对象上的方法。

方法：

```
- (void)release; 
```

在`NSObject`协议中声明但您已明确声明：我只会调用`MyProtocol`方法。所以编译器会给你一个警告，告诉你你违背了自己的诺言。

因此，而不是：

```
id<MyProtocol> reference; 
```

您实际上应该声明：

```
id<MyProtocol, NSObject> reference; 
```

或者：

```
NSObject<MyProtocol> reference; 
```

因为`NSObject`（类）实现`NSObject`（协议）。

或者：

```
id reference; 
```

这是最广泛的：让我在这个对象上调用任何东西，从不抱怨。

您也可以（正如 Barry Wark 建议`MyProtocol`的那样）包含`NSObject`协议——尽管从设计的角度来看，通常只有在实现`MyProtocol`必然意味着使用`NSObject`. 通常，我们只在遗传或语义上链接时才`NSObject`这样做。`MyProtocol`

* * *

关于`NSObject`协议的一些信息：

您调用保留/释放/自动释放的所有内容都必须实现此协议。正如您可以从中推断的那样：基本上所有东西都实现了`NSObject`协议（即使有些东西不是来自`NSObject`基类）。

另一个快速澄清：（`NSObject`类）和`NSObject`（协议）不是同一个 API 的重新实现。它们的拆分如下：

*   NSObject（协议）实现了在一般意义上处理/检查现有对象所需的一切（保留/释放、isEqual、类、responsToSelector：等）。

*   NSObject（类）实现了较少的通用方法：构造/销毁、线程集成、脚本集成。

所以在大多数意义上，协议是两者中更重要的一个。请记住，该类包含协议，因此如果您从 NSObject 继承，您将得到两者。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2011-07-14T06:28:05.300

改变

```
@property (nonatomic, retain) id<MyProtocol> reference; 
```

到

```
@property (nonatomic, assign) id<MyProtocol> reference; 
```

为什么要保留实现协议的对象？您所需要的只是一个指向对象的指针，我们可以通过它调用协议中声明的方法。

# asp.net - ASP.NET 动态添加的 LinkBut ton - 未调用 OnClick 处理程序

> ID：855442
> 
> 赞同：2
> 
> 时间：2009-05-12T23:43:15.777
> 
> 标签：asp.net, dynamic, linkbutton

我正在将 LinkBut​​ton 控件动态添加到 PlaceHolder 中。如果我在每个 OnInit() 上添加 LinkBut​​ton 的新实例，则此 LinkBut​​ton 的 OnClick 处理程序将起作用。

但是，如果我将 LinkBut​​ton 的实例存储在会话中，然后将其添加到 PlaceHolder 的控件集合中，LinkBut​​ton.OnClick 将无法触发。

有没有办法在给定的场景中重用我存储在会话中的控件？每次都重新创建它们几乎不是一种选择。

顺便说一句 - 它是 1.1 中的继承应用程序，我刚刚迁移到 3.5。“破碎”的方法似乎在 1.1 中有效。

感谢所有的答案。

```
public static void Clicked(object sender, EventArgs e) {
    Debugger.Break();
}

protected override void OnPreInit(EventArgs e) {
    base.OnPreInit(e);
    InitLinkButton();
}

private void InitLinkButton() {    
    var lb = new LinkButton();
    plOne.Controls.Add(lb);
    lb.ID = "lb";
    lb.Text = "I will work.";
    lb.Click += Clicked;
    plOne.Controls.Add(lb);

    LinkButton lb2 = null;
    if (Session["lb2"] == null) {
        lb2 = new LinkButton();
        lb2.ID = "lb2";
        lb2.Text = "I won't work.";
        lb2.Click += Clicked;
        Session["lb2"] = lb2;
    } else {
        lb2 = (LinkButton)Session["lb2"];
    }
    plOne.Controls.Add(lb2);
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-12T23:53:10.720

几件事：

1) 永远永远不会将 WebControl 的实例存储到 Session。每个 WebControl 都有一个对 Page 对象的引用——它当然会引用每个其他 WebControl。一旦您将 WebControl 存储到 Session 中，您就基本上存储了整个 Page 及其包含的所有内容。你在通往内存泄漏城市的高速公路上。

2) 每个控件都会在每次回发时重新创建。我想您可能会认为每次重新创建您的 LinkBut​​tons 很慢，但事实并非如此。

3) 为什么不能在回发时重新创建动态控件？这是您应该使用动态控件执行的操作。整个想法是您将页面设置为与原来相同，以便 ViewState 可以根据控件的 ID 自动连接到您的控件。如果您尝试在 Init() 之后的任何位置动态地将控件添加到您的页面，您将无法使用 ViewState 来处理您的控件数据，并且必须实现您自己的机制。

我的建议是在 Init() 中重新创建动态控件——这是最佳实践。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T00:05:03.383

要回答您的问题如何让 OnClick 工作，您需要将事件连接到方法；

```
lb2.Click += new EventHandler(Clicked); 
```

我只是看不到您在 init 上重新创建控件的问题，不要使事情过于复杂！关于您在会话中存储的内容已经说得够多了，所以我不会发布关于该问题的另一个答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T23:57:23.910

您还应该检查[动态控件占位符](http://www.denisbauer.com/ASPNETControls/DynamicControlsPlaceholder.aspx)，这将有助于减少管理动态控件的大量工作

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T23:58:11.647

在会话中存储 LinkBut​​ton 真是一个糟糕的主意。我什至无法想象可能导致的问题。至少，LinkBut​​ton 有一个对页面的引用（通过 Clicked 处理程序）——它真的不应该再存在了（页面已经被渲染并发送到客户端）。但是，引用会使其保持活动状态，因此不会被 GC 处理。

话虽如此，您*可能*只需要重新连接 Clicked 处理程序：

```
if (Session["lb2"] == null) {
    /* ... */
} else {
    lb2 = (LinkButton)Session["lb2"];
    lb2.Click += Clicked;
} 
```

由于 LinkBut​​ton.Click 事件被连接到Page 类的*另一个*实例（之前使用的那个），它的触发将没有*可见*的效果（因为该 Page 已经呈现）。当然，就像我上面说的，这完全是疯狂的——所以我没有测试过这个。

如果您确实使用它，那么您还应该在 Page_PreRender 或其他地方取消订阅以避免 GC 问题。

再次创建控件是执行此操作的正常方法 - 它对其他人来说是一个可行的选择，因此您可能会过度考虑其中的复杂性。

# c# - linq - 用非通用 Lambda 表达式替换通用 Lambda 表达式

> ID：855447
> 
> 赞同：5
> 
> 时间：2009-05-12T23:44:23.107
> 
> 标签：c#, linq, lambda

我有这行代码：

```
var predicate = Expression.Lambda<Func<TEntityType, bool>>(body, param); 
```

其中 TEntityType 是一个通用参数。

但是，我没有可用的通用参数。我有：

```
Type _EntityType; 
```

Expression.Lambda 的非通用语法是什么？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-12T23:52:58.833

有一个重载`Expression.Lambda`采用表达式主体的类型，因此您只需要在调用该重载之前动态创建类型。

```
type lambdaType = typeof(Func<,>).MakeGenericType(_EntityType, typeof(bool));

var predicate = Expression.Lambda(lambdaType, body, param); 
```

# sql - sql userid + name + profile 优化问题

> ID：855450
> 
> 赞同：1
> 
> 时间：2009-05-12T23:45:59.843
> 
> 标签：sql, database, optimization

我可能需要做很多用户 ID-> 用户名查找。所以我在想，而不是像下面这样的表格

```
userid int PK
username text
userpass_salthash int
user_someopt1 int
user_sig text 
```

把它分解如下

```
//table1
userid int PK
username text

//table2
userid int //fk
userpass_salthash int
user_someopt1 int
user_sig text 
```

我之所以这样做是因为我怀疑一个不太复杂的表（如果我愿意，我也可以使名称不再超过 32 字节）查找速度更快，而且数据更少。但我知道我可能错了，我应该做哪个版本，除了优化还有什么原因？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T00:06:41.697

您应该为规范化和性能执行第一个选项（单表）。

表现：

*   如果您在 上放置一个索引`(UserId, Username)`，您将拥有一个覆盖索引 - 所以无论如何您都不需要去表格获取用户名。
*   如果你把你的聚集索引放在 上`UserId`，你会得到一个聚集索引搜索——无论如何它最终会出现在行数据上。

正常化：

*   您的第二个选项允许用户存在于 table1 中，但不允许存在于 table2 中。由于您可能不希望没有密码的用户（无法登录），因此我认为这已损坏。

我的建议是在 UserId 上建立一个聚集索引。如果您在其他地方需要聚集索引，覆盖索引几乎一样好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T02:32:41.223

我同意对于这么窄的桌子，单张桌子几乎肯定是最好的选择。

要添加的另一件事 - 文本数据类型（如果您使用的是 MS SQL Server）非常广泛。nvarchar(200) 应该足够宽。谨慎使用 LOB 数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T20:11:34.363

除非您确定需要，否则请不要担心优化该查找。请记住优化俱乐部的规则。

1.  优化俱乐部的第一条规则是，你不要优化。
2.  优化俱乐部的第二条规则是，没有衡量就不要优化。
3.  如果您的应用程序运行速度比底层传输协议快，那么优化就结束了。
4.  一次一个因素。
5.  没有市场机器人，没有市场机器人时间表。
6.  只要需要，测试就会继续进行。
7.  如果这是您在优化俱乐部的第一个晚上，您必须编写一个测试用例。

# cocoa-touch - 使用 [[[UIApplication sharedApplication] delegate] myClass Property] 时编译器警告“未在协议中找到”？

> ID：855456
> 
> 赞同：1
> 
> 时间：2009-05-12T23:49:03.893
> 
> 标签：cocoa-touch, objective-c-runtime

我有 myClass 由我的 appDelegate 实例化，我有另一个类 newClass 由 myClass 实例化。从 newClass 实例中，我想访问创建它的 myClass 实例中的属性。我通过以下方式做到了这一点：

```
[[[UIApplication sharedApplication].delegate myClass] property] 
```

这行得通，我实际上可以获得该属性，但我从 Xcode 收到此警告：

```
warning: "-myClass" not found in protocols
warning: no "-myClass" method found  
(messages without a matching signature will be assumed to return "id" and accept "..." as arguments) 
```

newClass 属性已在 .h 和 .m 文件中正确声明，它的属性已设置并已合成。

它编译并运行，我实际上可以获得属性的值。

我应该忽略 Xcode 中的警告吗？

有没有更好的方法来访问 myClass 实例的属性？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T18:05:01.467

查看 -[UIApplication delegate] 的文档。请注意，它的返回类型为：

```
id <UIApplicationDelegate> 
```

因此，关于返回的对象，您所知道的只是它符合此协议。然后假设委托响应`-myClass`消息，而不是编译器愿意做出响应，这无异于信仰的飞跃。

你可以稍微破解它来像这样工作：

```
[[(MyAppDelegateClass *)[[UIApplication sharedApplication] delegate] myClass] property] 
```

但这将是不好的做法。相反，我建议你让你的应用程序委托一个单例，这样你就可以这样做：

```
[[[MyAppDelegateClass sharedApplicationDelegate] myClass] property] 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T03:23:51.543

我认为在编译时 Xcode 不能从属性和普通的 Objective-C 中实现飞跃。它找不到该属性，因此只会假设您知道自己在做什么并填写空白。在运行时，事情显然没问题。

试试这个：

```
[[[[UIApplication sharedApplication] delegate] myClass] property]; 
```

顺便说一句，所以你自己的代码中没有这样的代码我通常在应用程序委托的标题中执行#define：

```
#define APPDELEGATE (myAppDelegate *)[[UIApplication sharedApplication] delegate] 
```

那么在代码中我可以去：

```
[[APPDELEGATE myClass] property]; 
```

# .net - 如何在 Silverlight 3 中为 DataForm 获得透明背景？

> ID：855459
> 
> 赞同：1
> 
> 时间：2009-05-12T23:51:12.767
> 
> 标签：.net, silverlight, xaml, silverlight-3.0

在 Silverlight 3 beta 中，我似乎无法获得 DataForm 的透明背景。下面的代码是我正在尝试的，但它只会使背景部分透明。有什么我可以解决的吗？

```
<Grid x:Name="LayoutRoot" Background="Orange">
    <Border Background="Blue" Margin="100,0,0,100"/>
    <Controls:DataForm x:Name="dataform" Background="Transparent" Margin="30"/>
</Grid> 
```

[截图 http://www.portnine.com/data/images/Misc/silverlight3.jpg](http://www.portnine.com/data/images/Misc/silverlight3.jpg)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T01:16:14.230

默认情况下，DataForm 启动“禁用”，这意味着相应的视觉状态会改变外观。

如果您覆盖默认控件模板，您将找到一个名为“DisabledColor”的静态资源。这会产生您所看到的略微不透明的白色。只要改变它，你会没事的。

```
<SolidColorBrush x:Key="DisabledColor" Color="#A5FFFFFF"/> 
```

# c++ - CGAL继承

> ID：855470
> 
> 赞同：2
> 
> 时间：2009-05-12T23:57:26.813
> 
> 标签：c++, cgal

如何在 CGAL 中的三角剖分上下文中使用继承的三角剖分类？

基本上我有以下代码：

```
typedef CGAL::Exact_predicates_inexact_constructions_kernel K;

typedef CGAL::Triangulation_vertex_base_with_info_2<int,K> Vb;
typedef CGAL::Triangulation_face_base_with_info_2<int,K>   Fb;
typedef CGAL::Triangulation_data_structure_2<Vb,Fb>        Tds;
typedef CGAL::Delaunay_triangulation_2<K,Tds>              Delaunay;
typedef CGAL::Triangulation_2<K,Tds>                       Triangulation;

typedef Triangulation::Point Point;

...

Triangulation *t = new Delaunay;

...

// x and y are properly defined and instantiated
t->insert(Point(x,y)); 
```

好吧，当然，Delaunay_triangulation_2 继承自 Triangulation_2

因此，当我执行此代码时，链接是针对 Triangulation_2 类完成的，换句话说，它不执行 delaunay 三角剖分，而是执行普通三角剖分（执行父类方法而不是子方法）。

我认为这是因为 Triangulation_2 的插入方法未声明为虚拟，因此重新定义将不起作用。

你知道解决这个问题的方法吗？也许使用 Constrained_triangulation_2 和 Constrained_delaunay_triangulation_2？（这些类定义了一些虚拟方法，但我已经阅读了源代码，我认为如果不添加显式约束就不能使用它们）

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-09T07:59:06.677

我检查了您的程序，您需要重新格式化它，使其适合通用编程模型。让我回忆一下你的代码做了什么（在[github 上](http://github.com/gjorquera/triangle-mesh/blob/6eb7e304a486a1a3de47ac9264a322b5cf7bc4c1/main.cpp)可用的那个）：

1.  读取命令行
2.  根据选项，在堆上实例化 Triangulation 或 Delaunay_triangulation
3.  使用这个对象进行一些处理，假设方法是虚拟的（但它们不是）

解决您的问题的方法是将步骤 3 放在单独的方法中，并将三角测量类型作为模板参数。类似于（我使用您的类型和名称）：

```
template < class Triangulation >
void compute_mesh(int n_vertices, int max_x, int max_y)
{
    Triangulation t;
    // DO WHATEVER YOU WANT WITH t
} 
```

然后，在您的 main 函数中，您将通过以下方式触发使用 Delaunay 或非 Delaunay 三角剖分：

```
if (triang_type == 'D') 
    compute_mesh<Delaunay>(n_vertices, max_x, max_y);
else 
    compute_mesh<Triangulation>(n_vertices, max_x, max_y); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T07:50:57.210

您确定这些功能是虚拟的吗？如果没有将它们定义为虚拟，编译器将不会调用派生类函数。

粗略地看一下 CGAL 标头，这些类似乎根本没有任何虚函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T18:27:37.763

CGAL 使用泛型编程，而不是虚函数。它类似于 STL，只是领域有点困难，而且你需要比通常使用 STL 更多地依赖算法。

我真的不知道，你的问题的答案是什么，因为你只提供了一小段代码，但尝试替换

```
Triangle *t = new Delaunay; 
```

和

```
Triangulation *t = new Delaunay; 
```

第一的。如果它没有帮助，请从您的类型定义中添加更多详细信息。

# encryption - 需要说明 Windows 中的无线加密设置

> ID：855473
> 
> 赞同：1
> 
> 时间：2009-05-12T23:58:11.773
> 
> 标签：encryption, wireless

在 Windows Vista 中，如果我单击`properties`我的无线连接，然后转到安全选项卡，我可以设置`authentication type`和`encryption type`。

我很困惑！那么任何无线连接到路由器的客户端计算机都可以设置这两件事吗？

那么计算机A可以将加密类型设置为WPA，而计算机B可以将其设置为WEP？

那么，当外人试图连接到这个路由器时，他们会看到什么加密类型？

# frameworks - 在服务器上安装 ASP.Net Framework 3.5（从 2.0 开始）

> ID：855480
> 
> 赞同：2
> 
> 时间：2009-05-13T00:01:48.913
> 
> 标签：frameworks, installation, asp.net-3.5

我想升级运行 ASP.NET 2.0 的 Windows 2003 x86 服务器，以支持 ASP.NET 3.5

我需要哪些文件/文件？

我需要先安装 3.0，然后是 3.5，然后是 3.5 SP1，还是完全下载 3.5 SP1 (dotnetfx35.exe 3.5.30729.1, 231 MB) 才能完成所有工作？

另外，我相信我必须在过程结束时安装以下内容：NDP20SP2-KB958481-x86.exe、NDP20SP2-KB958483-x86.exe、NDP20SP2-KB958484-x86.exe

是否会干扰当前运行的实时应用程序？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T00:05:29.017

单独安装 3.5 SP1 将添加您需要的一切。我认为实时应用程序不会被中断，但安装程序运行时性能可能会受到影响。对于可能需要的任何后期 SP1 更新，请务必在之后运行 Microsoft Update。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T00:06:26.410

您应该能够安装 3.5 SP1 ：

[http://www.microsoft.com/downloads/details.aspx?FamilyID=AB99342F-5D1A-413D-8319-81DA479AB0D7&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=AB99342F-5D1A-413D-8319-81DA479AB0D7&displaylang=en)

我不熟悉那些特定的 KB 热修复。您可以将它与 .Net 2.0 并行安装，它不会影响那些在 2.0 下运行的应用程序。

# jquery - jQuery nyromodal + ASP.Net + UpdatePanel/AJAX - endShowContent 不工作、闪烁、失去焦点

> ID：855481
> 
> 赞同：0
> 
> 时间：2009-05-13T00:04:14.540
> 
> 标签：jquery, asp.net-ajax, nyromodal

我在 ASP.Net 中使用 jQuery nyroModal 插件。我喜欢 nyroModal，总的来说它工作得很好。

但是我正在使用 endShowContent 回调将焦点设置到 nyromodal 完成加载后页面内容上的第一个文本输入元素。为了实现这一点，我在启动 nyromodal 弹出窗口的页面上有以下代码。

$(function() { $.fn.nyroModal.settings.endShowContent = function(elt, settings) { $('input:text:first', elt.content).focus(); }; });

我可以说出它的工作原理，因为当模式出现时，第一个文本字段确实会暂时获得焦点。但随后它会闪烁并再次失去焦点。就好像 nyromodal 决定它仍然没有完全加载，并且发生了其他事情将焦点移开。或者也许是 UpdatePanel 干扰？（我不知道为什么会这样）。在 nyromodal 的 endShowContent 调用发生之后，UpdatePanel 臃肿的自动生成的 AJAX JS 调用是否可能正在执行某些操作？

任何帮助或见解表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T02:45:35.770

我试图在这里重现问题：http: [//jsbin.com/igibo](http://jsbin.com/igibo)

我无法复制这个问题，所以我猜你的代码中还有其他东西导致了这个问题。

尝试通过[http://jsbin.com/igibo/edit](http://jsbin.com/igibo/edit)编辑游戏以复制问题，然后我们可以从那里解决它。

PS 尽管您正在完善您的问题，但请更新问题，而不是在新答案中添加更多信息。（从技术上讲，它们不是答案）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T03:05:45.167

谢谢布赖恩佩里斯！你不会相信的，我感到恶心。

我从那个 jsbin 获得了你的代码并将其复制到本地，所以我将你的示例代码与我自己的测试页面放在一起。在我的测试页面中，我使用了一些旧的方式来启动 nyromodal，它是：

```
<a href="modal.html" target="_blank" class="nyroModal">Launch modal</a> 
```

我在网络上的示例等中找到了这段代码。但它似乎一定是用 nyromodal 启动模型弹出窗口的一些旧的/狡猾的/被取代的方式！

我只是创建了一个正常/干净的超链接并删除了类和目标垃圾，然后使用了您发送给我的相同样式：

```
$('a').nyroModal(); 
```

现在我所有的问题都没有了。这已经解决了一切！:) 窗口打开的动画也更加流畅。

非常感谢。我发现这个插件的文档有点不一致。你帮助我指出了正确的方向。使用这种方式，焦点也可以完美且非常流畅地工作。

干杯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T01:29:08.500

您是否尝试过将代码包装在

`$(document).ready(function() { // put all your jQuery goodness in here. });`

[JQuery 文档就绪教程](http://docs.jquery.com/Tutorials:Introducing_$(document).ready())

dom 可能还没有完全加载。

# .net - 客户端可查看的 App.config 的 WCF 加密解决方案？

> ID：855483
> 
> 赞同：1
> 
> 时间：2009-05-13T00:04:43.290
> 
> 标签：.net, wcf, web-services

我有一个桌面应用程序，其中包含一个 App.config（发布时的 program.exe.config），其中包含清晰可见的元素，这些元素定义了我的 WCF 端点和 WCF 实现。

理想情况下，我希望从用户的眼睛中隐藏它，从简单的黑客攻击、查看和更改中隐藏。

我是不是该： -

1.  以编程方式在代码中创建和存储我的 WCF 端点和绑定配置。或者;
2.  在 App.config 上实施一些保护方案（如果是，什么，如何），有效地混淆/加密公众视野中的这些元素，但从我的代码中可以理解？

我已经使用 .NET Reactor 来混淆和保护我的程序免受反射技术的影响。

**2009 年 5 月 13 日更新 3:32 GMT+10 好吧，我设法加密了 system.serviceModel，但是当应用程序启动时它被证明不可用，因为抛出了异常（System.TypeInitializationException：'System.ServiceModel 的类型初始化程序.DiagnosticUtility' 引发了异常。）**

```
 <system.serviceModel>
    <!-- [bindings] -->
    <bindings configProtectionProvider="DPAPIProtection">
      <EncryptedData>
        <CipherData>
          <CipherValue>AQAAANCMnd8BFdERjHoAwE/Cl+... 
```

**所以就有了这个想法。我要么放弃这个想法，要么在加密背后的代码中设置我的端点。

没有其他人关心他们的端点地址在配置中清晰可见吗？？？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T03:32:32.990

> 理想情况下，我希望从用户的眼睛中隐藏它，从简单的黑客攻击、查看和更改中隐藏。

你真的无法避免这种情况，因为任何想弄清楚它在做什么的人只需在 WCF Endpoint 类构造函数上设置一个断点，然后点击“go”。再多的混淆也无济于事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T00:47:18.600

保护它不被改变比保护它不被看到更容易。

如果它只是您担心的更改/黑客攻击，您可以使用您的公钥计算组成您不可更改的 WCF 设置的 XML 元素的数字签名。如果客户更改任何内容，则签名将不匹配。

真的，我不知道保护它不被看到的好方法，因为一个有决心的人将能够找出你在 WCF 中所做的事情（正如之前的海报所指出的那样）。你可以让它变得更加困难，但这不会阻止某人查看或学习信息。

**更新**：

您需要使用自己的 RSA 私钥进行签名。也许您已经有一个 RSA 密钥对。如果没有，您可能会生成一个密钥对来进行签名。像这样。

```
 int keySize = 1024; // you choose
        byte[] key = Keys.GenerateKeyPair(keySize);

        RSACryptoServiceProvider rsaKey = new RSACryptoServiceProvider();
        rsaKey.ImportCspBlob(key); 
```

一旦你有了它，你可以导出并保存它。为了您自己的使用，签名，您需要私钥。为了验证，应用程序将使用公钥。这就是你得到它们的方式。

```
 string PublicKeyXml = rsaKey.ToXmlString(false);
        string PrivateKeyXml = rsaKey.ToXmlString(true); 
```

储存这些。如果您想使用相同的私钥再次签署某些内容，请使用 FromXmlString() 方法获取 RSA CSP，并传递 PrivateKeyXml。如果要验证，请使用 FromXmlString() 传递 PublicKeyXml。

获得要签名的密钥和 XML 后，您就可以进行签名了。这仅发生在打包和部署期间，当您创建和完成配置时。

```
 // Sign an XML file. 
    // This document cannot be verified unless the verifying 
    // code has the key with which it was signed.
    public static void SignXml(System.Xml.XmlDocument Doc, RSA Key)
    {
        // Check arguments.
        if (Doc == null)
            throw new ArgumentException("Doc");
        if (Key == null)
            throw new ArgumentException("Key");

        // Create a SignedXml object.
        System.Security.Cryptography.Xml.SignedXml signedXml = new SignedXml(Doc);

        // Add the key to the SignedXml document.
        signedXml.SigningKey = Key;

        // Create a reference to be signed.
        Reference reference = new Reference();
        reference.Uri = "";

        // Add an enveloped transformation to the reference.
        var env = new XmlDsigEnvelopedSignatureTransform();
        reference.AddTransform(env);

        // Add the reference to the SignedXml object.
        signedXml.AddReference(reference);

        // Compute the signature.
        signedXml.ComputeSignature();

        // Get the XML representation of the signature and save
        // it to an XmlElement object.
        XmlElement xmlDigitalSignature = signedXml.GetXml();

        // Append the element to the XML document.
        Doc.DocumentElement.AppendChild(Doc.ImportNode(xmlDigitalSignature, true));
    } 
```

然后，将签名的 XML 嵌入 app.config 或作为应用程序中的字符串，或其他任何内容。当应用程序运行时，您可以在运行时使用公钥 blob 验证签名。

```
 // Verify the signature of the signed XML.
        RSACryptoServiceProvider rsaCsp = new RSACryptoServiceProvider();
        rsaCsp.FromXmlString(PublicKeyXml);

        bool isValid = VerifyXml(xmlDoc, rsaCsp); 
```

这是一些进行签名验证的代码：

```
 // Verify the signature of an XML file against an asymmetric 
    // algorithm and return the result.
    public Boolean VerifyXml(XmlDocument Doc, RSA Key)
    {
        // Check arguments.
        if (Doc == null)
            throw new ArgumentException("Doc");
        if (Key == null)
            throw new ArgumentException("Key");

        // Create a new SignedXml object and pass it
        // the XML document class.
        System.Security.Cryptography.Xml.SignedXml signedXml = new SignedXml(Doc);

        // Find the "Signature" node and create a new XmlNodeList object.
        XmlNodeList nodeList = Doc.GetElementsByTagName("Signature");

        // Throw an exception if no signature was found.
        if (nodeList.Count <= 0)
        {
            throw new CryptographicException("Verification failed: No Signature was found in the document.");
        }

        // Though it is possible to have multiple signatures on 
        // an XML document, this app only supports one signature for
        // the entire XML document.  Throw an exception 
        // if more than one signature was found.
        if (nodeList.Count >= 2)
        {
            throw new CryptographicException("Verification failed: More that one signature was found for the document.");
        }

        // Load the first <signature> node.  
        signedXml.LoadXml((XmlElement)nodeList[0]);

        // Check the signature and return the result.
        return signedXml.CheckSignature(Key);
    } 
```

要测试您的签名和验证是否确实有效，请修改签名或已签名的 xml 内容。您应该会看到验证失败。在验证失败的情况下，您的应用程序可能会抛出、退出或其他任何情况。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T00:40:31.427

我猜选项 1 可能是你最好的选择。也就是说，我确实想知道它是否值得（假设您在配置文件中没有任何真正敏感的内容，例如凭据或其他任何内容）。我提出这个问题的原因是，如果您担心端点 URL 等问题，那么任何拥有非常基本工具的人都可以使用网络协议分析器在几秒钟内弄清楚这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T01:23:33.460

您可以在 .NET 中尝试[受保护的配置](http://msdn.microsoft.com/en-us/library/53tyfkaw.aspx)，但这不是很简单。您需要加密客户端机器上的配置文件，因为受保护的配置提供程序可能会生成机器特定的加密数据。换句话说，如果您在您的机器或构建机器上加密配置部分，您可能无法在客户端机器上解密它。您还可以将加密密钥导出和导入到客户端计算机上。因此，在安装过程中，您必须在客户端计算机上安装密钥并使用该密钥加密配置部分。查看[使用 Windows 应用程序实现受保护的配置](http://www.codeproject.com/KB/security/ProtectedConfigWinApps.aspx)。如您所见，这确实不是一个非常简单和干净的解决方案，并且在部署方面增加了复杂性。

另一方面，以编程方式在客户端配置 WCF 很容易。您可以在代码中设置绑定和端点。如果您仍想通过配置保留一些灵活性以将客户端引导到不同的 url 而无需新的构建，您可能希望将地址或 url 保留在配置文件中。我认为这是最好的方法，因为我认为一旦您测试和部署应用程序，您的绑定和端点可能不会改变。但是您更了解您的要求 :-) 我会说不要过度设计或对可能真正不现实的问题应用繁重且昂贵的解决方案。

# java - 使用 JDBC for MySQL 5.1 的 getGeneratedKeys() 出现奇怪异常

> ID：855488
> 
> 赞同：2
> 
> 时间：2009-05-13T00:05:57.110
> 
> 标签：java, mysql, jdbc

我正在使用 JDBC 在 MYSQL 数据库中插入一行。我构建了一个参数化命令，执行它并尝试检索自动生成的密钥，如下所示：

```
String sql = "INSERT IGNORE INTO `users` (`email`, `pass-hash`) VALUES (?, ?)";
Connection conn = SQLAccess.getConnection();
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, login);
ps.setString(2, passHash);

int count = ps.executeUpdate();

if (count == 1) {
    ResultSet rs = ps.getGeneratedKeys();
    rs.next();
         //some more stuff...
} 
```

出于某种原因，我在包含以下内容的行上收到以下 SQLException `ResultSet rs = ps.getGeneratedKeys();`：

> !Statement.Generated 未请求密钥！

有什么想法吗？当我在 MySQL 浏览器中运行通过调试器运行应用程序生成的相同查询时，它会毫无意外地执行。

谢谢，布赖恩

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T00:22:22.920

我想你想打电话`prepareStatement(sql, RETURN_GENERATED_KEYS)`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-19T11:00:56.387

getGeneratedKeys() 方法在 JDBC 3.0 API 中，并非在所有平台上都可用。

并且 PreparedStatement 没有 getGenerateKeys() 的实现，它只存在于 Statement 中，是一个抽象方法。

这是有关此方法问题的主题： http: [//forums.sun.com/thread.jspa?threadID=260818](http://forums.sun.com/thread.jspa?threadID=260818)

# python - 为什么在分配给函数中的全局变量时会出现“分配前引用”错误？

> ID：855493
> 
> 赞同：89
> 
> 时间：2009-05-13T00:08:33.317
> 
> 标签：python, global-variables

在 Python 中，我收到以下错误：

```
UnboundLocalError: local variable 'total' referenced before assignment 
```

在文件的开头（在错误来自的函数之前），我`total`使用`global`关键字声明。然后，在程序主体中，在调用使用的函数之前`total`，我将其分配为 0。我尝试在不同的地方将其设置为 0（包括文件的顶部，就在它被声明之后），但是我无法让它工作。

有谁看到我做错了什么？

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2009-05-13T00:24:28.873

我认为您错误地使用了“全局”。请参阅[Python 参考](http://docs.python.org/reference/simple_stmts.html#the-global-statement)。您应该在没有全局变量的情况下声明变量，然后在要访问声明它的全局变量时在函数内部`global yourvar`。

```
#!/usr/bin/python

total

def checkTotal():
    global total
    total = 0 
```

看这个例子：

```
#!/usr/bin/env python

total = 0

def doA():
    # not accessing global total
    total = 10

def doB():
    global total
    total = total + 1

def checkTotal():
    # global total - not required as global is required
    # only for assignment - thanks for comment Greg
    print total

def main():
    doA()
    doB()
    checkTotal()

if __name__ == '__main__':
    main() 
```

因为`doA()`不修改*全局总数*，所以输出是 1 而不是 11。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2017-02-03T06:00:55.087

我的情景

```
def example():
    cl = [0, 1]
    def inner():
        #cl = [1, 2] # access this way will throw `reference before assignment`
        cl[0] = 1 
        cl[1] = 2   # these won't

    inner() 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-10-01T13:38:59.720

```
def inside():
   global var
   var = 'info'
inside()
print(var)

>>>'info' 
```

问题结束

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-10-26T22:18:06.900

我想提一下，你可以对函数范围这样做

```
def main()

  self.x = 0

  def increment():
    self.x += 1

  for i in range(5):
     increment()

  print(self.x) 
```

# php - ob_gzhandler 是否正确确定有缺陷的 Internet Explorer 版本？

> ID：855494
> 
> 赞同：2
> 
> 时间：2009-05-13T00:09:05.967
> 
> 标签：php, internet-explorer, gzip, cross-browser

我似乎无法在任何地方找到答案。众所周知，某些版本的 IE6 和更早版本错误地声明它们接受 gzip 编码。ob_gzhandler 是否正确检测到这些版本，还是您需要单独进行检测？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T00:43:54.320

不，它没有；你必须像这样：

```
<?
function checkIEFail() {
    $ua = $_SERVER['HTTP_USER_AGENT'];
    if(strpos($ua, 'Mozilla/4.0 (compatible; MSIE ') !== 0 || strpos($ua, 'Opera') !== false)
        return false;
    $version = floatval(substr($ua, 30));
    return $version < 6 || ($version == 6 && strpos($ua, 'SV1') === false);
}

if(!checkIEFail())
    ob_start('ob_gzhandler');
?> 
```

# wpf - WPF - 当 App.xaml 的 Build Action = Page 时在设计时访问资源

> ID：855497
> 
> 赞同：7
> 
> 时间：2009-05-13T00:15:42.040
> 
> 标签：wpf, resources

我将 App.xaml 的构建操作更改为“Page”，这样我就可以处理启动画面并确保我的应用程序仅作为单个实例运行（具有我自己的入口点）。它在运行时运行良好，但在设计时应用程序无法再看到我的资源。资源位于同一项目中的单独 xaml 文件中。如何让我的应用在设计时再次看到资源？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-04-13T18:47:45.813

将您的资源分解为单独的资源字典，然后将它们拉入 App.xaml，如下所示：

```
<Application.Resources>
    <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="MasterResources.xaml" />
        </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
</Application.Resources> 
```

您可以根据需要以这种方式添加多个资源字典。

您还需要在 UserControls（以及使用资源引用 UserControls 的 Windows）中执行相同的操作：

```
<UserControl.Resources>
    <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="MasterResources.xaml" />
        </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
</UserControl.Resources> 
```

有关此主题的更多信息，请参阅[http://ithoughthecamewithyou.com/post/Merging-Resource-Dictionaries-for-fun-and-profit.aspx](http://ithoughthecamewithyou.com/post/Merging-Resource-Dictionaries-for-fun-and-profit.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-29T10:07:18.757

确保您`InitializeComponent()`作为应用程序构造函数的第一行调用：

```
public App()
{
    // This is the method generated by VisualStudio that initializes
    // the application from associated XAML file
    InitializeComponent();

    // Do everything else
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-29T07:07:25.843

如果我理解正确，您是在 app.xaml 中加载应用程序范围的资源吗？在这种情况下，您可以这样做：

```
 App app = new App();
//Get assembly name is your own method
string assemblyName = GetAssemblyName(Assembly.GetExecutingAssembly());

Uri resourceLocater = new Uri("/" + assemblyName + ";component/app.xaml", UriKind.Relative);
System.Windows.Application.LoadComponent(app, resourceLocater);
MainWindow mainWindow = new MainWindow();
app.Run(mainWindow); 
```

然后你的资源将被加载

/丹尼尔

# java - 在 Netbeans 中自动生成源代码和 doc jar

> ID：855498
> 
> 赞同：12
> 
> 时间：2009-05-13T00:16:08.420
> 
> 标签：java, netbeans, ant, build, jar

有没有办法在 Netbeans 中自动生成源代码和 javadoc jar？理想情况下，我想在每次构建时将我的源代码和 JavaDoc 的 jar 放在 dist 文件夹中。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-13T12:19:05.383

这是我个人添加到我的 ant 文件 (build.xml) 中的内容：

```
<target description="bundle sources in a jar" name="package-sources">
  <jar basedir="src" destfile="dist/${ant.project.name}-sources.jar"/>
</target>
<target depends="-javadoc-build" description="bundle javadoc in a jar" name="package-doc">
  <jar basedir="dist/javadoc" destfile="dist/${ant.project.name}-javadoc.jar"/>
</target> 
```

使用 Netbeans 手动调用这些目标，或者您可以使用挂钩目标：

```
<target name="-post-jar" depends="package-sources, package-doc" /> 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-06-19T17:36:37.070

请尝试将此添加到 build.xml。我已经在 NetBeans IDE 7.0 上对其进行了测试

```
<target name="-post-jar" description="bundle sources and javadoc in a jar" depends="javadoc">
    <jar compress="${jar.compress}" basedir="${src.dir}" jarfile="${dist.dir}/${application.title}-sources.jar"/>
    <jar compress="${jar.compress}" basedir="${test.src.dir}" jarfile="${dist.dir}/${application.title}-test.jar"/>
    <jar compress="${jar.compress}" basedir="${dist.javadoc.dir}" jarfile="${dist.dir}/${application.title}-javadoc.jar"/>
</target> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-09-03T13:43:58.040

我在 NetBeans IDE 7.2 上尝试了以下操作并且它可以工作（假设项目名称是 *MyProject*）

1.  转到*MyProject*目录

2.  在文本编辑器中打开**build.xml文件**

3.  在该行下添加以下行`<import file="nbproject/build-impl.xml"/>`：

    `<target name="-post-jar" description="bundle sources and javadoc in a jar" depends="javadoc"> <jar compress="${jar.compress}" basedir="${src.dir}" jarfile="${dist.dir}/${application.title}-sources.jar"/> <jar compress="${jar.compress}" basedir="${dist.javadoc.dir}" jarfile="${dist.dir}/${application.title}-javadoc.jar"/> </target>`

4.  转到**nbproject**文件夹并在文本编辑器中打开**project.properties文件**

5.  编辑输出二进制文件的名称（默认设置为项目名称.jar）： `# This directory is removed when the project is cleaned: dist.dir=dist dist.jar=${dist.dir}/**MyProject-binaries**.jar`

6.  保存并构建项目。

希望它也适用于你。

# spring - Spring 和 Stripes 安全设计

> ID：855501
> 
> 赞同：3
> 
> 时间：2009-05-13T00:18:42.050
> 
> 标签：spring, authentication, singleton, stripes

我正在使用 Stripes 和 Spring 构建一个 Web 应用程序。它需要具有登录/身份验证功能。现在，我将用户信息与用户凭据分开存储在数据库中。我的用户模型不包含凭据，因为我不想传递有价值的密码。

Spring 管理着我所有的 DAO。

现在，我正在实施一个基于非容器的安全系统。我存储密码的 sha-2 哈希值，并将表单中提交的密码与数据库中存储的密码进行比较。这种比较已经过测试并且有效。我试图弄清楚如何将这个东西连接在一起。现在我有一个 LoginActionBean 来捕获登录请求并使用一个“PasswordService”单例，该单例在内部使用 UserDAO 来检索凭据并与提交的参数进行比较。我的春豆是：

```
<bean id="passwordSerivce" class="com.example.store.authentication.PasswordService" factory-method="getInstance">
    <property name="userDAO" ref="userDAO"/>
</bean> 
```

但是，PasswordService 单例需要一个：

```
public void setUserDAO(UserDAO userDAO) { ...} 
```

在单例中没有真正意义的方法（UserDAO 是一个接口）。

我正在寻找合适的设计。我读过 ServiceLocators 是 Spring 被发明的原因。有什么想法吗？

我也想知道我还能如何设计这个。我有一个 ActionBean，当用户单击“登录”时会调用它，但我实际上如何进行身份验证。我是否将身份验证服务注入到 bean 中？我是否创建了一个任何人都可以调用的单例？我是否有一个 Spring 注入的 LoginAcionBean 使用的通用接口？如果我不使用 Spring，它将如何完成？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T15:55:38.400

添加到上述答案中，如果您不想要 DAO 的设置器，只需使用构造函数注入：

```
<bean id="passwordSerivce" class="...PasswordService">
   <constructor-arg ref="userDAO"/>
</bean> 
```

除非 bean 不是您控制的类，否则您不需要将其设为 Singleton，Spring 默认会这样做。

我个人不喜欢注释。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T00:36:27.820

1.  我不明白为什么注入 userDao 没有任何意义。

2.  我不明白为什么你的 xml 使用 factory-method="getInstance"; 你可以扔掉所有实例的东西和单例的东西；spring 将实例化密码服务类的单个实例并将其注入到许多需要它的类中，并且它们都将获得相同的实例。所以 spring 正在为你创建一个单例。密码服务类可以是一个简单的 pojo。对于 userDao 实现也是如此。

我还建议查看、理解和使用 spring 注释。基本上，您在将被注入的类上使用@Service，然后在注入它的类的设置器上使用@Autowired。您还需要在 xml 配置文件中添加一些内容以打开注释内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-16T01:32:19.020

我的解决方案是有一个带有“身份验证”方法的接口。然后使用接受 UserDAO 对象的构造函数创建一个实现接口的服务类。这样，需要服务的对象不执行实例化（它由 spring 完成）并且不知道执行了哪些底层实现（ldap、SSO、简单密码比较等）。似乎完成了工作：P

# ghostscript - ghostscript：通过命令行为页面编号

> ID：855504
> 
> 赞同：1
> 
> 时间：2009-05-13T00:20:02.457
> 
> 标签：ghostscript

一个问题（也许很傻，也许不是）

在 Windows 中，使用了一个用于 ghostscript 的图形前端

*免费的 pdf 填充工具* - www.freepdffill.com

这个前端的一个工具，使您能够在页面上*标记数字*

一个pdf，选择大小、位置、字体……等等……

现在我切换到 linux，我有 ghostscript，所以，我想，我可以从命令行做同样的事情，但我无法找到或理解命令行选项如何为页面编号

谁能帮我？

提前致谢

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-09-10T13:28:36.873

当我使用 ghostscript 进行转换时，我使用：

-sOutputFile=exprtedfilename-%d.jpg

并且 -%d 被替换为页码。

# python - 为什么我不能将字典值的直接引用传递给函数？

> ID：855514
> 
> 赞同：1
> 
> 时间：2009-05-13T00:25:53.970
> 
> 标签：python, function, dictionary, parameters

今天早些时候，我问了一个[关于](https://stackoverflow.com/questions/853483/can-i-pass-dictionary-values-entry-and-keys-to-function) 将字典值传递给函数的问题。虽然我现在明白如何完成我试图完成的事情，但为什么问题（没有被问到）从未得到回答。所以我的跟进是为什么我不能

```
def myFunction(newDict['bubba']):
    some code to process the parameter 
```

仅仅是因为解析器规则不允许这样做吗？我在 Google 上搜索了 +Python +function +“允许的参数”，但没有发现任何有用的信息，因此我将不胜感激。

我过于简单化了正在发生的事情。我有一本结构像的字典

```
myDict={outerkey1:(innerkey1:value,innerkey2:value,. . .innerkeyn:value),outerkey2:(innerkey1:value,innerkey2:value,. . .innerkeyn:value),. . .} 
```

正如我所说，我知道如何做我想做的事——我得到了一个非常有帮助的答案。但我开始想为什么

```
 def myFunction(outerkey,myDict[outerkey]): 
```

给出了一个语法错误，我很好地意识到它必须是一个解析问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T00:31:12.440

是的，解析器将拒绝此代码。

参数列表在函数定义中用于将函数内的标识符绑定到**调用**时从外部传入的参数。

由于`newDict['bubba']`不是有效的标识符，这没有任何意义——您需要将其作为调用参数而不是函数参数提供，因为函数参数只能是标识符。

因为您似乎对[正式语法](https://docs.python.org/2/reference/grammar.html)感兴趣，所以以下是相关部分：

```
funcdef ::= 
             [decorators] "def" funcname "(" [parameter_list] ")"
              ":" suite

parameter_list ::= 
                 (defparameter ",")*
                (~~"*" identifier [, "**" identifier]
                 | "**" identifier
                 | defparameter [","] )

defparameter ::= 
             parameter ["=" expression]

identifier ::= 
             (letter|"_") (letter | digit | "_")* 
```

实际上，您尝试用作标识符的构造是订阅：

```
subscription ::= 
             primary "[" expression_list "]" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T00:42:33.387

看起来您可能对函数的*定义*和*调用*该函数感到困惑。举个简单的例子：

```
def f(x):
    y = x * x
    print "x squared is", y 
```

就其本身而言，此函数不执行任何操作（即，它不打印任何内容）。如果将其放入源文件并运行它，则不会输出任何内容。但是，如果您添加：

```
f(5) 
```

您将得到输出“x 平方为 25”。当 Python 遇到函数名后跟*实际*参数时，它会将这些实际参数的值替换为函数定义中的*形参。*在这种情况下，调用形式参数`x`。然后 Python 运行`f`值为`x`5 的函数。现在，最大的好处是您可以再次使用具有不同值的相同函数：

```
f(10) 
```

打印“x 平方为 100”。

我希望我已经正确理解了您的困难的根源。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T01:01:11.853

您只能传递对对象的引用。

```
a = { 'a' : 123, 'b' : [ 1, 2, 3 ] }

def f(dictionary_value):
    dictionary_value.append(4)

f( a['b'] ) 
```

Does what you expect. Dictionary element `a['b']` is passed "by reference" to the function `f` which updates the dictionary element.

# java - 为什么 Java Pattern 类使用工厂方法而不是构造函数？

> ID：855518
> 
> 赞同：6
> 
> 时间：2009-05-13T00:28:29.407
> 
> 标签：java, constructor, factory

在[一般情况下](https://stackoverflow.com/questions/628950/constructors-vs-factory-methods)对此进行了很好的讨论。

但是，我想知道为什么[`Pattern`](https://docs.oracle.com/javase/9/docs/api/java/util/regex/Pattern.html)类使用[`compile`](https://docs.oracle.com/javase/9/docs/api/java/util/regex/Pattern.html#compile-java.lang.String-)静态方法来创建对象，而不是构造函数？

在我看来，使用构造函数更直观。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T00:31:57.227

Pattern 类比 JDK 中的很多东西都要新。因此，我相信他们采用了使用工厂方法的更现代的方法，而不是公共构造函数的旧方法。您不能真正将工厂方法改造为现有的类。

一般来说，没有太多理由在工厂方法上使用构造函数，所以我认为这就是它的全部。工厂方法允许您抽象对象创建，这非常有用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-13T00:49:25.897

为什么你会`Pattern`使用同一个正则表达式的两个实例？`Pattern`如果多次请求相同的正则表达式，静态创建方法允许实现潜在地缓存s 有时会返回相同的对象。编译`Pattern`s 可能很昂贵。此外，如果`compile`需要额外的方法（比如不同的语法），它们可以被赋予不同的名称，而不是一组令人困惑的重载构造函数。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-13T04:30:38.643

当底层实现很有可能以可能影响构造函数的方式进行更改时，使用静态工厂模式。简而言之，工厂为库维护者提供了极大的灵活性，而不受构建方面的二进制和源代码兼容性的束缚。

有关详细信息，请参阅[http://en.wikipedia.org/wiki/Factory_method_pattern](http://en.wikipedia.org/wiki/Factory_method_pattern) - 特别是“其他好处和变体”部分。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T01:16:31.950

使用工厂方法`Pattern`也可能最终允许使用第 3 方插件正则表达式实现。不幸的是，Sun 没有实现使用工厂方法可以获得的任何特性（插件能力、缓存）。

# silverlight - 在 Silverlight 中绑定 ComboBox.SelectedItem

> ID：855519
> 
> 赞同：5
> 
> 时间：2009-05-13T00:29:30.963
> 
> 标签：silverlight, data-binding, combobox, selecteditem

这个快把我逼疯了。这是 XAML：

```
 <UserControl x:Class="SilverlightApplication1.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <Grid x:Name="LayoutRoot" Background="White">
    <StackPanel HorizontalAlignment="Left" VerticalAlignment="Top">
      <ComboBox ItemsSource="{Binding Path=Thing.Stuff}"
                SelectedItem="{Binding Path=Thing.SelectedStuff}">
        <ComboBox.ItemTemplate>
          <DataTemplate>
            <TextBlock Text="{Binding Path=Name}" />
          </DataTemplate>
        </ComboBox.ItemTemplate>
      </ComboBox>
      <Button Content="Again" Click="Button_Click" />
    </StackPanel>
  </Grid>
</UserControl> 
```

和代码隐藏：

```
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Linq;
using System.Windows;
using System.Windows.Controls;

namespace SilverlightApplication1
{
    public partial class Page : UserControl
    {
        public Page()
        {
            InitializeComponent();

            Data data = new Data();
            data.Thing = new Thing();
            data.Thing.Stuff = new ObservableCollection<Stuff>();
            data.Thing.Stuff.Add( new Stuff { Name = "Stuff 1" } );
            data.Thing.Stuff.Add( new Stuff { Name = "Stuff 2" } );
            data.Thing.Stuff.Add( new Stuff { Name = "Stuff 3" } );
            data.Thing.SelectedStuff = data.Thing.Stuff.Last();
            DataContext = data;
        }

        private void Button_Click( object sender, RoutedEventArgs e )
        {
            Data data = ( DataContext as Data );
            data.Thing.Stuff.Clear();
            data.Thing.Stuff.Add( new Stuff { Name = "Stuff 4" } );
            data.Thing.Stuff.Add( new Stuff { Name = "Stuff 5" } );
            data.Thing.Stuff.Add( new Stuff { Name = "Stuff 6" } );
            data.Thing.SelectedStuff = data.Thing.Stuff.Last();
        }
    }

    public class Data : INotifyPropertyChanged
    {
        private Thing _Thing;

        public Thing Thing
        {
            get { return _Thing; }
            set { _Thing = value; NotifyPropertyChanged( "Thing" ); }
        }

        public event PropertyChangedEventHandler PropertyChanged;

        protected void NotifyPropertyChanged( string propertyName )
        {
            if ( PropertyChanged == null ) { return; }
            PropertyChanged( this, new PropertyChangedEventArgs( propertyName ) );
        }
    }

    public class Thing : INotifyPropertyChanged
    {
        private ObservableCollection<Stuff> _Stuff;

        public ObservableCollection<Stuff> Stuff
        {
            get { return _Stuff; }
            set { _Stuff = value; NotifyPropertyChanged( "Stuff" ); }
        }

        private Stuff _SelectedStuff;

        public Stuff SelectedStuff
        {
            get { return _SelectedStuff; }
            set { _SelectedStuff = value; NotifyPropertyChanged( "SelectedStuff" ); }
        }

        public event PropertyChangedEventHandler PropertyChanged;

        protected void NotifyPropertyChanged( string propertyName )
        {
            if ( PropertyChanged == null ) { return; }
            PropertyChanged( this, new PropertyChangedEventArgs( propertyName ) );
        }
    }

    public class Stuff : INotifyPropertyChanged
    {

        private string _Name;

        public string Name
        {
            get { return _Name; }
            set { _Name = value; NotifyPropertyChanged( "Name" ); }
        }

        public event PropertyChangedEventHandler PropertyChanged;

        protected void NotifyPropertyChanged( string propertyName )
        {
            if ( PropertyChanged == null ) { return; }
            PropertyChanged( this, new PropertyChangedEventArgs( propertyName ) );
        }
    }
} 
```

当页面加载时，有一个选择了“Stuff 3”的组合框。单击按钮时，ComboBox 中的项目会发生变化，但应选择“Stuff 6”。相反，没有选择任何内容。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-13T01:01:07.517

尝试这个：

```
 <ComboBox ItemsSource="{Binding Path=Thing.Stuff}"                
      SelectedItem="{Binding Path=Thing.SelectedStuff, Mode=TwoWay}"> 
```

SelectedItem 不喜欢被 OneWay 绑定。我还没有机会在 Silverlight 2 中尝试它，但在 Silverlight 3 中，如果你不使用 TwoWay 绑定，你甚至会得到黄色的死亡三角形。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-03-04T09:45:08.737

当然绑定必须是双向的。但是将 ItemsSource 设置为控件并不意味着设置了 DataContext（SelectedItem 变量应指向的位置）。确保组合的 DataContext 设置正确。（在我的情况下，到 Page。因为 selectedStuff 是 Page 属性。

```
cmbStuff.DataContext = Me '(from  Page.Load) 
```

# php - 在 PHP 中自动检测服务器的代理设置

> ID：855520
> 
> 赞同：0
> 
> 时间：2009-05-13T00:30:50.367
> 
> 标签：php, proxy, detect

我有一个在 Windows 服务器上运行的 PHP 脚本。该脚本创建一个 SOAP 客户端对象，该对象可以被赋予 proxy_host 和 proxy_port。我希望 PHP 脚本自动检测本地服务器的代理设置，而不是对这些值进行硬编码或使它们成为配置选项，这样如果它们发生更改或脚本在不同的服务器上运行，它就会正常工作。有人知道如何在 PHP 中做到这一点吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T02:32:51.537

这有点疯狂，您可能不想这样做。但是在win32下你*可以*写一个php插件来获取WinHttpGetIEProxyConfigForCurrentUser()的值。

或者，通过更多研究，您可能会找到注册表值，然后使用 win32std 查询它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T02:23:30.277

鉴于可能的代理配置范围广泛，我认为目前这是不可能的。通常，组件（例如支付网关）提供代理信息的配置设置（通常在 php.ini 文件中），您可以在其中设置这些设置。否则，如果您在基于 *Nix 的环境中运行，您可以尝试使用以下方法获取当前运行用户的环境设置：

[http://us.php.net/manual/en/function.getenv.php](http://us.php.net/manual/en/function.getenv.php)

这样，如果服务器用户更改了代理设置，您的脚本可以选择它并尝试使用它。

# unit-testing - 使用 Nunit 的配置来改变测试行为是否合理/可能？

> ID：855523
> 
> 赞同：0
> 
> 时间：2009-05-13T00:31:32.313
> 
> 标签：unit-testing, nunit

我在我的开发服务器上运行了一套大约 20 个测试。我想要一种简单的方法来切换到 Alpha 服务器并运行相同的 20 个测试。但我不想每次都在所有服务器上运行它们。通常我会在 Dev 上运行测试，直到它们全部为绿色，然后将代码滚动到 Alpha，运行测试等。在 Dev 上进行多次迭代，在 Alpha 上进行一些迭代，然后理论上在堆栈上的每台服务器上运行一次以发布。

现在完成的方法是使用 TestFixture 中的变量。这一切都很好——但每次我想改变环境时都需要重建。但我看到了一个配置菜单，我认为这会很好用。为每个环境添加一个配置，指向该配置，运行测试，然后它们在正确的服务器上运行。那里有一些难闻的硬编码：假设环境的名称必须与目标测试环境的名称相匹配。我可以忍受这一点。

第一个问题：有没有更好的方法来做到这一点？第二个问题：这甚至可能吗？我无法找到在 TestFixture 级别读取这些配置的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T00:41:48.290

只需使用标准的 .NET 配置文件。应用设置或配置元素。任何 dll（包括测试）都可以读取它们。例如，mytest.dll.config 用于 mytest.dll，我们这样做是为了我们的“组件”或“集成”测试，这些测试具有一些外部依赖关系，例如 sql 服务器。测试必须知道服务器在哪里。

关于单元测试的必要说明：注意你在谈论验收或集成测试。有价值，但维护成本高且速度慢。你应该有很少的这些，并且应该有更多的单元测试（它不会关心服务器在哪里）。

# delphi - 德尔福 6 / Zeos / SQlite

> ID：855524
> 
> 赞同：1
> 
> 时间：2009-05-13T00:31:36.980
> 
> 标签：delphi, sqlite

我正在编写一个使用主/详细信息的程序我是 Zeos 和 SQlite 的新手我已经有连接、两个表等。我在要更新的主表上有一个自动增量主键字段。我应该怎么做才能自动检索主键字段值（并且记录指针停留在我刚刚创建的记录上），以便该值可以用于详细表。

我收到以下错误：

项目 Kaizen_2009.exe 引发异常类 EZSQLException，并带有消息“SQL 错误：SQL 逻辑错误或缺少数据库”。进程停止。使用 Step 或 Run 继续。

提前致谢

亚历杭德罗·乔丹

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T04:36:32.333

最直接的方法是使用 SQL 语句 -> SELECT LAST_INSERT_ROWID()。

此外，还有一个 TZSequence 应该做同样的事情 - 但我不能确定它是否支持 SQLite。检查您的 Zeos Lib 安装上的演示文件夹。特别是 ZSimple 文件夹。

# html - 从 MVC 中生成的 HTML 中删除多余的空格

> ID：855526
> 
> 赞同：31
> 
> 时间：2009-05-13T00:32:37.833
> 
> 标签：html, asp.net-mvc, compression, whitespace, http-compression

我有一个 MVC 应用程序视图，它正在生成相当大的 HTML 值表 (>20MB)。

我正在使用压缩过滤器压缩控制器中的视图

```
 internal class CompressFilter : ActionFilterAttribute
 {
     public override void OnActionExecuting(ActionExecutingContext filterContext)
     {
         HttpRequestBase request = filterContext.HttpContext.Request;
         string acceptEncoding = request.Headers["Accept-Encoding"];
         if (string.IsNullOrEmpty(acceptEncoding))
             return;
         acceptEncoding = acceptEncoding.ToUpperInvariant();
         HttpResponseBase response = filterContext.HttpContext.Response;
         if (acceptEncoding.Contains("GZIP"))
         {
             response.AppendHeader("Content-encoding", "gzip");
             response.Filter = new GZipStream(response.Filter, CompressionMode.Compress);
         }
         else if (acceptEncoding.Contains("DEFLATE"))
         {
             response.AppendHeader("Content-encoding", "deflate");
             response.Filter = new DeflateStream(response.Filter, CompressionMode.Compress);
         }
     }
 } 
```

有没有办法在我运行压缩过滤器（以减少压缩工作量和大小）之前消除视图中生成的（相当大）数量的冗余空白？

**编辑：** 我使用下面 Womp 建议的 WhiteSpaceFilter 技术让它工作。

出于兴趣，这里是 Firebug 分析的结果：

1) 无压缩，无空白条 - 21MB，2.59 分钟
2) 使用 GZIP 压缩，无空白条 - 2MB，17.59 秒
**3) 使用 GZIP 压缩，空白条 - 558kB，12.77 秒**

所以当然值得。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-13T01:40:13.150

[这家伙](http://madskristensen.net/post/a-whitespace-removal-http-module-for-aspnet-20)写了一个简洁的小空格压缩器，它只是通过正则表达式运行字节的快速块副本以去除空间块。他将其编写为一个 http 模块，但您可以从中取出 7 行主力代码并将其放入您的函数中。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-01-07T16:17:32.250

@womp 已经提出了一种很好的方法，但是该模块已经过时了。我一直在使用它，但事实证明这不是最佳方式。这是我问的问题：

[从整个 Html 中删除空格，但在 pre 中使用正则表达式](https://stackoverflow.com/questions/8762993/remove-white-space-from-entire-html-but-inside-pre-with-regular-expressions)

这是我的做法：

```
public class RemoveWhitespacesAttribute : ActionFilterAttribute {

    public override void OnActionExecuted(ActionExecutedContext filterContext) {

        var response = filterContext.HttpContext.Response;

        //Temp fix. I am not sure what causes this but ContentType is coming as text/html
        if (filterContext.HttpContext.Request.RawUrl != "/sitemap.xml") {

            if (response.ContentType == "text/html" && response.Filter != null) {
                response.Filter = new HelperClass(response.Filter);
            }
        }
    }

    private class HelperClass : Stream {

        private System.IO.Stream Base;

        public HelperClass(System.IO.Stream ResponseStream) {

            if (ResponseStream == null)
                throw new ArgumentNullException("ResponseStream");
            this.Base = ResponseStream;
        }

        StringBuilder s = new StringBuilder();

        public override void Write(byte[] buffer, int offset, int count) {

            string HTML = Encoding.UTF8.GetString(buffer, offset, count);

            //Thanks to Qtax
            //https://stackoverflow.com/questions/8762993/remove-white-space-from-entire-html-but-inside-pre-with-regular-expressions
            Regex reg = new Regex(@"(?<=\s)\s+(?![^<>]*</pre>)");
            HTML = reg.Replace(HTML, string.Empty);

            buffer = System.Text.Encoding.UTF8.GetBytes(HTML);
            this.Base.Write(buffer, 0, buffer.Length);
        }

        #region Other Members

        public override int Read(byte[] buffer, int offset, int count) {

            throw new NotSupportedException();
        }

        public override bool CanRead{ get { return false; } }

        public override bool CanSeek{ get { return false; } }

        public override bool CanWrite{ get { return true; } }

        public override long Length{ get { throw new NotSupportedException(); } }

        public override long Position {

            get { throw new NotSupportedException(); }
            set { throw new NotSupportedException(); }
        }

        public override void Flush() {

            Base.Flush();
        }

        public override long Seek(long offset, SeekOrigin origin) {

            throw new NotSupportedException();
        }

        public override void SetLength(long value) {

            throw new NotSupportedException();
        }

        #endregion
    }

} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-02-22T00:25:43.037

可以通过扩展 Razor*在编译时*删除空格。这消除了（根据我的测量非常重要）从生成的 HTML 中删除空格的运行时影响。在使用 Stack Overflow 上基于 RegEx 的代码修剪 100KB 文档的高端 i7 上，命中率高达 88 毫秒。

下面提供了 MVC 3 和 MVC 4 的编译时解决方案的实现：

[梅莱兹网站](https://github.com/meleze/Meleze.Web)

解决方案描述于

[http://cestdumeleze.net/blog/2011/minifying-the-html-with-asp-net-mvc-and-razor/](http://web.archive.org/web/20130112132053/http://cestdumeleze.net/blog/2011/minifying-the-html-with-asp-net-mvc-and-razor)

（但使用 GitHub 代码或 NuGet DLL，因为博文中的代码仅涵盖 MVC 3）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T00:34:22.897

我会说，如果您的视图生成超过 20mb 的数据，您可能想要研究显示数据的不同方式，也许是分页？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-17T04:04:44.057

```
#region Stream filter
class StringFilterStream : Stream
{
  private Stream _sink;
  private Func<string, string> _filter;

  public StringFilterStream(Stream sink, Func<string, string> filter) {
    _sink = sink;
    _filter = filter;
  }

  #region Mixin Properties/Methods
  public override bool CanRead { get { return true; } }
  public override bool CanSeek { get { return true; } }
  public override bool CanWrite { get { return true; } }
  public override void Flush() { _sink.Flush(); }
  public override long Length { get { return 0; } }
  private long _position;
  public override long Position {
    get { return _position; }
    set { _position = value; }
  }
  public override int Read(byte[] buffer, int offset, int count) {
    return _sink.Read(buffer, offset, count);
  }
  public override long Seek(long offset, SeekOrigin origin) {
    return _sink.Seek(offset, origin);
  }
  public override void SetLength(long value) {
    _sink.SetLength(value);
  }
  public override void Close() {
    _sink.Close();
  }
  #endregion

  public override void Write(byte[] buffer, int offset, int count) {
    // intercept the data and convert to string
    byte[] data = new byte[count];
    Buffer.BlockCopy(buffer, offset, data, 0, count);
    string s = Encoding.Default.GetString(buffer);

    // apply the filter
    s = _filter(s);

    // write the data back to stream
    byte[] outdata = Encoding.Default.GetBytes(s);
    _sink.Write(outdata, 0, outdata.GetLength(0));
  }
}
#endregion

public enum WebWhitespaceFilterContentType
{
  Xml = 0, Css = 1, Javascript = 2
}
public class WebWhitespaceFilterAttribute : ActionFilterAttribute
{
  private WebWhitespaceFilterContentType _contentType;

  public WebWhitespaceFilterAttribute() {
    _contentType = WebWhitespaceFilterContentType.Xml;
  }
  public WebWhitespaceFilterAttribute(WebWhitespaceFilterContentType contentType) {
    _contentType = contentType;
  }

  public override void OnActionExecuting(ActionExecutingContext filterContext) {

    var request = filterContext.HttpContext.Request;
    var response = filterContext.HttpContext.Response;

    switch (_contentType) {
      case WebWhitespaceFilterContentType.Xml:

        response.Filter = new StringFilterStream(response.Filter, s => {
          s = Regex.Replace(s, @"\s+", " ");
          s = Regex.Replace(s, @"\s*\n\s*", "\n");
          s = Regex.Replace(s, @"\s*\>\s*\<\s*", "><");
          // single-line doctype must be preserved
          var firstEndBracketPosition = s.IndexOf(">");
          if (firstEndBracketPosition >= 0) {
            s = s.Remove(firstEndBracketPosition, 1);
            s = s.Insert(firstEndBracketPosition, ">\n");
          }
          return s;
        });
        break;

      case WebWhitespaceFilterContentType.Css:
      case WebWhitespaceFilterContentType.Javascript:

        response.Filter = new StringFilterStream(response.Filter, s => {
          s = Regex.Replace(s, @"/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+/", "");
          s = Regex.Replace(s, @"\s+", " ");
          s = Regex.Replace(s, @"\s*{\s*", "{");
          s = Regex.Replace(s, @"\s*}\s*", "}");
          s = Regex.Replace(s, @"\s*;\s*", ";");
          return s;
        });
        break;
    }
  }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-10-12T20:57:40.113

这是我在项目中使用的空白过滤器属性的 VB.NET 版本：

```
#Region "Imports"

    Imports System.IO

#End Region

Namespace MyCompany.Web.Mvc.Extensions.ActionFilters

    ''' <summary>
    ''' WhitespaceFilter attribute
    ''' </summary>
    Public NotInheritable Class WhitespaceFilterAttribute
        Inherits ActionFilterAttribute

        ''' <summary>
        ''' Called when action executing.   
        ''' </summary>
        ''' <param name="filterContext">The filter context.</param>
        ''' <remarks></remarks>
        Public Overrides Sub OnActionExecuting(filterContext As ActionExecutingContext)

                filterContext.HttpContext.Response.Filter = New WhitespaceFilterStream(filterContext.HttpContext.Response.Filter)

        End Sub

    #Region "Whitespace stream filter"

            ''' <summary>
            ''' Whitespace stream filter
            ''' </summary>
            Private Class WhitespaceFilterStream
                Inherits Stream

    #Region "Declarations"

                ' Member vars.
                Private Shared regexPattern As New Regex("(?<=[^])\t{2,}|(?<=[>])\s{2,}(?=[<])|(?<=[>])\s{2,11}(?=[<])|(?=[\n])\s{2,}")
                ' Property vars.
                Private sinkStreamValue As Stream
                Private positionValue As Long

    #End Region

    #Region "Constructor(s)"

                ''' <summary>
                ''' Contructor to create a new object.
                ''' </summary>
                ''' <param name="sink"></param>
                ''' <remarks></remarks>
                Public Sub New(sink As Stream)

                    Me.sinkStreamValue = sink

                End Sub

    #End Region

    #Region "Properites"

                ''' <summary>
                ''' Gets the CanRead value.
                ''' </summary>
                ''' <value></value>
                ''' <returns></returns>
                ''' <remarks></remarks>
                Public Overrides ReadOnly Property CanRead() As Boolean
                    Get
                        Return True
                    End Get
                End Property

                ''' <summary>
                ''' Gets the CanSeek value.
                ''' </summary>
                ''' <value></value>
                ''' <returns></returns>
                ''' <remarks></remarks>
                Public Overrides ReadOnly Property CanSeek() As Boolean
                    Get
                        Return True
                    End Get
                End Property

                ''' <summary>
                ''' Gets the CanWrite value.
                ''' </summary>
                ''' <value></value>
                ''' <returns></returns>
                ''' <remarks></remarks>
                Public Overrides ReadOnly Property CanWrite() As Boolean
                    Get
                        Return True
                    End Get
                End Property

                ''' <summary>
                ''' Get Length value.
                ''' </summary>
                ''' <value></value>
                ''' <returns></returns>
                ''' <remarks></remarks>
                Public Overrides ReadOnly Property Length() As Long
                    Get
                        Return 0
                    End Get
                End Property

                ''' <summary>
                ''' Get or sets Position value.
                ''' </summary>
                ''' <value></value>
                ''' <returns></returns>
                ''' <remarks></remarks>
                Public Overrides Property Position() As Long
                    Get
                        Return Me.positionValue
                    End Get
                    Set(value As Long)
                        Me.positionValue = value
                    End Set
                End Property

    #End Region

    #Region "Stream Overrides Methods"

                ''' <summary>
                ''' Stream object Close method.
                ''' </summary>
                ''' <remarks></remarks>
                Public Overrides Sub Close()

                    Me.sinkStreamValue.Close()

                End Sub

                ''' <summary>
                ''' Stream object Close method.
                ''' </summary>
                ''' <remarks></remarks>
                Public Overrides Sub Flush()

                    Me.sinkStreamValue.Flush()

                End Sub

                ''' <summary>
                ''' Stream object Read method.
                ''' </summary>
                ''' <param name="buffer"></param>
                ''' <param name="offset"></param>
                ''' <param name="count"></param>
                ''' <returns></returns>
                ''' <remarks></remarks>
                Public Overrides Function Read(buffer As Byte(), offset As Integer, count As Integer) As Integer

                    Return Me.sinkStreamValue.Read(buffer, offset, count)

                End Function

                ''' <summary>
                ''' Stream object Seek method.
                ''' </summary>
                ''' <param name="offset"></param>
                ''' <param name="origin"></param>
                ''' <returns></returns>
                ''' <remarks></remarks>
                Public Overrides Function Seek(offset As Long, origin As SeekOrigin) As Long

                    Return Me.sinkStreamValue.Seek(offset, origin)

                End Function

                ''' <summary>
                ''' Stream object SetLength method.
                ''' </summary>
                ''' <param name="value"></param>
                ''' <remarks></remarks>
                Public Overrides Sub SetLength(value As Long)

                    Me.sinkStreamValue.SetLength(value)

                End Sub

                ''' <summary>
                ''' Stream object Write method.
                ''' </summary>
                ''' <param name="bufferBytes"></param>
                ''' <param name="offset"></param>
                ''' <param name="count"></param>
                ''' <remarks></remarks>
                Public Overrides Sub Write(bufferBytes As Byte(), offset As Integer, count As Integer)

                    Dim html As String = Encoding.Default.GetString(bufferBytes)

                    Buffer.BlockCopy(bufferBytes, offset, New Byte(count - 1) {}, 0, count)
                    html = regexPattern.Replace(html, String.Empty)
                    Me.sinkStreamValue.Write(Encoding.Default.GetBytes(html), 0, Encoding.Default.GetBytes(html).GetLength(0))

                End Sub

    #End Region

            End Class

    #End Region

        End Class

    End Namespace 
```

在 Global.asax.vb 中：

```
Shared Sub RegisterGlobalFilters(ByVal filters As GlobalFilterCollection)

    With filters
        ' Standard MVC filters
        .Add(New HandleErrorAttribute())
        ' MyCompany MVC filters
        .Add(New CompressionFilterAttribute)
        .Add(New WhitespaceFilterAttribute)
    End With

End Sub 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-13T00:47:44.747

空白压缩得很好，我认为删除它不会为您节省太多。

如果可能的话，我建议尝试将一些 HTML 卸载到客户端，使用 JavaScript 来重构重复的内容。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-05-13T00:37:54.493

如果您从视图返回 JSON，它已经被缩小并且不应包含任何空格或 CR/LF。您应该使用分页来避免一次向浏览器发送如此多的数据。

# c - 有没有办法刷新 POSIX 套接字？

> ID：855544
> 
> 赞同：47
> 
> 时间：2009-05-13T00:42:57.723
> 
> 标签：c, sockets, posix

是否有标准调用将 POSIX 套接字的传输端一直刷新到远程端，或者这是否需要作为用户级协议的一部分来实现？我环顾了通常的标题，但找不到任何东西。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2011-09-13T10:30:39.367

设置 TCP_NODELAY 而不是重新设置它呢？可能它可以在发送重要数据之前完成，或者在我们完成发送消息时完成。

```
send(sock, "notimportant", ...);
send(sock, "notimportant", ...);
send(sock, "notimportant", ...);
int flag = 1; 
setsockopt(sock, IPPROTO_TCP, TCP_NODELAY, (char *) &flag, sizeof(int));
send(sock, "important data or end of the current message", ...);
flag = 0; 
setsockopt(sock, IPPROTO_TCP, TCP_NODELAY, (char *) &flag, sizeof(int)); 
```

正如linux手册页所说

> TCP_NODELAY ...设置此选项会强制显式刷新挂起的输出...

所以可能最好在消息之后设置它，但不确定它如何在其他系统上工作

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-05-13T01:03:45.310

对于 Unix 域套接字，您可以使用`fflush()`，但我认为您可能是指网络套接字。真的没有冲洗那些的概念。最接近的事情是：

1.  在会话结束时，调用`shutdown(sock, SHUT_WR)`关闭套接字上的写入。

2.  在 TCP 套接字上，使用 sockopt 禁用 Nagle 算法`TCP_NODELAY`，这通常是一个糟糕的想法，即使在最初的调查中它似乎会处理它，它也不能可靠地完成你想要的事情。

在用户协议级别处理任何需要“刷新”的问题很可能是正确的。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2013-04-25T11:42:51.633

在 RFC 1122 中，您正在寻找的东西的名称是“PUSH”。但是，似乎没有实现“PUSH”的相关 TCP API 实现。唉，没有运气。

一些答案和评论涉及 Nagle 算法。他们中的大多数似乎都假设 Nagle 算法会延迟*每次*发送。这个假设是不正确的。*仅当至少一个先前的数据包尚未确认时，* Nagle 才会延迟发送( [http://www.unixguide.net/network/socketfaq/2.11.shtml](http://www.unixguide.net/network/socketfaq/2.11.shtml) )。

换句话说：TCP 将立即发送*（*一排数据包中的）*第一个*数据包。只有当连接速度很慢并且您的计算机没有得到及时的确认时，Nagle 才会延迟发送*后续数据*，直到其中任何一个（以先发生者为准）

 ***   达到超时或
*   最后一个未确认的数据包被确认或
*   您的发送缓冲区已满或
*   您禁用 Nagle 或
*   你关闭了连接的发送方向

一个好的缓解措施是尽可能避免*后续数据*的业务。这意味着：如果您的应用程序调用`send()`多次以传输单个复合请求，请尝试重写您的应用程序。在用户空间组装复合请求，然后调用`send()`. 一次。这也节省了上下文切换（比大多数用户空间操作更昂贵）。

此外，当发送缓冲区包含足够的数据以填充网络数据包的最大大小时，Nagle 也不会延迟。这意味着：如果您发送的最后一个数据包大到足以填满您的发送缓冲区，那么无论如何，TCP 都会尽快发送您的数据。

总结一下：Nagle 并不是一些人认为的减少数据包碎片的蛮力方法。相反：对我来说，它似乎是一种有用的、动态的和有效的方法，可以同时保持良好的响应时间和用户数据与标头数据之间的良好比例。话虽如此，您应该知道如何有效地处理它。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-05-13T01:15:59.253

我不知道在标准 TCP/IP 套接字接口中无法“一直到远程端”刷新数据并确保它实际上已被确认。

一般来说，如果您的协议需要“实时”传输数据，通常最好的做法是设置`setsockopt()`. `TCP_NODELAY`这将禁用协议栈中的 Nagle 算法，并且套接字上的 write() 或 send() 更直接地映射到发送到网络上......而不是实现发送延迟等待更多字节变得可用并使用所有TCP 级别的计时器来决定何时发送。注意：关闭 Nagle 不会禁用 TCP 滑动窗口或任何东西，所以这样做总是安全的....但是如果您不需要“实时”属性，数据包开销可能会增加很多。

除此之外，如果正常的 TCP 套接字机制不适合您的应用程序，那么通常您需要回退到使用 UDP 并在 UDP 的基本发送/接收属性上构建自己的协议功能。当您的协议有特殊需求时，这很常见，但不要低估做好这件事并使其在所有相对简单的应用程序中保持稳定和功能正确的复杂性。作为起点，对 TCP 设计特性的深入研究将阐明许多需要考虑的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T01:07:48.340

我认为这将是非常困难的，如果不是不可能正确实施的话。在这种情况下，“冲洗”是什么意思？传输到网络的字节数？接收方的 TCP 堆栈确认的字节数？传递给接收者用户模式应用程序的字节数？用户模式应用程序完全处理的字节？

看起来您需要在应用程序级别执行此操作...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-13T03:33:51.863

TCP 只提供尽力而为的传输，因此让所有字节离开机器 A 的行为与机器 B 接收到的所有字节是异步的。当然，TCP/IP 协议栈知道，但我不知道任何询问 TCP 堆栈以查明所有发送的内容是否已被确认的方法。

到目前为止，处理该问题的最简单方法是**在应用程序级别**。打开第二个 TCP 套接字以充当反向通道，并让远程伙伴向您发送确认它已收到您想要的信息。它的成本将翻倍，但完全可移植，并为您节省数小时的编程时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-12-13T14:20:08.610

您可以设置 tcp 选项 SO_LINGER 以设置某个超时，然后关闭套接字，以确保在关闭连接时所有数据都已发送（或检测到发送失败）。除此之外，TCP 是一个“尽力而为”的协议，它并没有提供任何真正的保证数据将真正到达目的地（与某些人似乎相信的相反），它只是尽最大努力让它传递以正确的顺序并尽快。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-05-04T00:23:05.263

有一种[特定于 linux 的方法](https://stackoverflow.com/a/67333214/823738)可以在 TCP 套接字上执行此操作：

您不会强制 tcp 堆栈“立即发送数据”，但请记住，您和内核正在尽可能快地发送数据。您可以稍微减少`send`与实际交付之间的延迟`TCP_NODELAY`。

但基本上，通过做`send`你已经完成了你的部分，你只需要等待 tcp 完成它的部分。

您可以`ioctl`在套接字上使用`SIOCOUTQ`或`TIOCOUTQ`查询交付状态，然后等待它完成。这应该足够了。特别是对于发送应用程序级数据包片段等用例。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2014-07-18T20:20:30.773

使用 fsync()：

sock_fd 是来自 socket(..., ...) 调用的整数文件描述符

fsync(sock_fd);

# php - 我可以启动一个脚本，使其独立于 Linux 上的父进程吗？

> ID：855549
> 
> 赞同：4
> 
> 时间：2009-05-13T00:45:54.813
> 
> 标签：php, linux, scripting, process, daemon

有没有办法从另一个进程启动脚本，这样如果进程死亡/结束，脚本仍然继续？

setuid 会这样做吗？如果我将所有者设置为root，然后启动脚本？

例如，如果我有一些 PHP 代码启动一个脚本，但 httpd 死掉或被杀死，我认为它会带走我的脚本。有没有解决的办法？

具体来说，我使用的是带有 Apache 2 和 PHP 5 的 Fedora 10。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T00:51:47.760

从[这里](http://www.perkiset.org/forum/php/forked_php_daemon_example-t474.0.html)：

```
function become_daemon() 
{
    $child = pcntl_fork();
    if($child) {
        exit; // kill parent
    }
    posix_setsid(); // become session leader
} 
```

此外，关闭 STDIN、STDOUT 和 STDERR 是个好主意，但我不确定如何在 PHP 中执行此操作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-13T01:22:45.617

试试“nohup yourscript.sh &”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T01:15:08.740

您应该使用 php 的 pcntl_fork() （由@bmdhacks 推荐）。

基本过程是，fork，setsid，再fork，chdir 到/，然后关闭所有打开的文件描述符。标准做法还要求您创建一个名为`/var/run/$NAME`, 的文件（其中 $NAME 是您的守护程序的名称），并将 PID 写入该文件，以便您以后可以控制进程执行。

我不是 php 程序员，但这是标准的 *nix 东西。我可以谷歌搜索的最好的 php 示例看起来像这个[hello-world-daemon-with-fork](http://blog.jacobkiers.net/2008/12/24/php-daemon-with-fork-howto-part-3-creating-a-hello-world-daemon-with-fork/) 但是，他没有将他的工作目录更改为“/”，也没有看起来他关闭了打开的文件描述符（我不确定这将如何在 php 中工作），因此他没有连接到原始进程的标准输入、标准输出和标准错误。

我又挖了一点，发现另一篇文章可能对 php 的[pcntl_fork()有帮助](http://www.van-steenbeek.net/?q=php_pcntl_fork)

而且，看起来有一个名为[System_Daemon](http://pear.php.net/package/System_Daemon)的 pear 模块，它会为您处理这个问题（我是通过[这里](http://kevin.vanzonneveld.net/techblog/article/create_daemons_in_php/)找到的）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T01:14:13.690

您可以使用 bash 中内置的“disown”将作业从生成它的 shell 中分离出来。见： http: [//www.faqs.org/docs/bashman/bashref_79.html](http://www.faqs.org/docs/bashman/bashref_79.html)

* * *

## 回答 #5

> 赞同：-5
> 
> 时间：2009-05-13T00:53:50.843

在命令 shell 中，您可以在命令行末尾附加一个与号 (&) 以在后台启动命令，从而将其与 shell 分离。

这里有一些很好的信息： [http ://www.linuxforums.org/forum/linux-programming-scripting/50096-moving-processes-background-foreground.html](http://www.linuxforums.org/forum/linux-programming-scripting/50096-moving-processes-background-foreground.html)

# php - 通过值获取数组中元素的索引

> ID：855553
> 
> 赞同：29
> 
> 时间：2009-05-13T00:47:58.880
> 
> 标签：php

我在 PHP 中有这个数组：

```
array(
    [0] => array( 'username' => 'user1' )
    [1] => array( 'username' => 'user2' )
) 
```

如果我有“用户名”字符串，如何将索引值作为数字获取？

例如，如果我有'user1'，我怎么能得到 0？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-05-13T00:50:51.197

看看[array_search](http://us.php.net/array_search)。

从 PHP 帮助文件：

```
<?php
$array = array(0 => 'blue', 1 => 'red', 2 => 'green', 3 => 'red');

$key = array_search('green', $array); // $key = 2;
$key = array_search('red', $array);   // $key = 1;
?> 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-05-13T01:09:05.217

如果您有一个二维数组，就像在您的示例中一样，您需要稍微自定义一些东西：

```
function array_search2d($needle, $haystack) {
    for ($i = 0, $l = count($haystack); $i < $l; ++$i) {
        if (in_array($needle, $haystack[$i])) return $i;
    }
    return false;
}

$myArray = array(
    array( 'username' => 'user1' ),
    array( 'username' => 'user2' )
);
$searchTerm = "user1";

if (false !== ($pos = array_search2d($searchTerm, $myArray))) {
    echo $searchTerm . " found at index " . $pos;
} else {
    echo "Could not find " . $searchTerm;
} 
```

如果您只想在一个特定字段中搜索，您可以将函数更改为如下所示：

```
function array_search2d_by_field($needle, $haystack, $field) {
    foreach ($haystack as $index => $innerArray) {
        if (isset($innerArray[$field]) && $innerArray[$field] === $needle) {
            return $index;
        }
    }
    return false;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-05-08T11:38:12.220

这将非常简单

```
private function getArrayKey($haystack, $needle)
{
  foreach($haystack as $key => $product)
  {
     if ($product['id'] === $needle)
     return $key;
  }

  return false;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-06-02T23:35:27.033

如果您知道键是`username`，只需使用数组作为搜索参数：

```
$username = 'user1';
$key = array_search(array('username' => $username), $array); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-13T01:44:43.900

也许使用[`array_filter`](http://php.net/array_filter)and[`array_keys`](http://php.net/array_keys)一起会有所帮助。

基于类的方法。

```
<?php

class ArraySearch2d {
  static protected $_key;
  static protected $_value;

  static function isMatch($element)
  {
    if (!is_array($element)) return false;
    return $element[self::$_key] == self::$_value;
  }

  static function filter(array $arrayToSearch, $key, $value)
  {
    if (!is_string($key)) throw new Exception("Array Key must be a string");
    self::$_key = $key;
    self::$_value = $value;
    return array_filter($arrayToSearch, 'ArraySearch2d::isMatch');
  }

  // to directly answer your question.
  static function getIndex(array $arrayToSearch, $key, $value)
  {
    $matches = self::filter($arrayToSearch, $key, $value);
    if (!count($matches)) return false;
    $indexes = array_keys($matches);
    return $indexes[0];
  }
}

$array = array("1"=>array('username'=>'user1'), "3"=>array('username'=>'user2'));

$matches = ArraySearch2d::filter($array, 'username', 'user2');
var_dump($matches);

$indexs = array_keys($matches);
var_dump($indexs);

// Demonstrating quick answer:
echo "Key for first 'username'=>'user1' element is: "
     .ArraySearch2d::getIndex($array, 'username', 'user1')."\n"; 
```

产生：

```
array(1) {
  [3]=>
  array(1) {
    ["username"]=>
    string(5) "user2"
  }
}
array(1) {
  [0]=>
  int(3)
}
Key for first 'username'=>'user1' element is: 1 
```

不使用类 - 这会产生相同的结果：

```
<?php
$field="username";
$value = "user2";

function usernameMatch($element)
{
   global $field, $value;
   if (!is_array($element)) return false; 
   return $element[$field] == $value;
}

function getFirstIndex(array $array)
{
  if (!count($array)) return false;
  $indexes = array_keys($array);
  return $indexes[0];
}

$array = array("1"=>array('username'=>'user1'), "3"=>array('username'=>'user2'));

$matches = array_filter($array, 'usernameMatch');
var_dump($matches);

$indexs = array_keys($matches);
var_dump($indexs);

// Demonstrating quick answer - and why you should probably use the class- 
// you don't want to have to remember these "globals" all the time.
$field = 'username';
$value = 'user1';

echo "Key for first 'username'=>'user1' element is: "
     .getFirstIndex(array_filter($array, 'usernameMatch')); 
```

# java - 到 Oracle 集群的 JDBC 连接

> ID：855556
> 
> 赞同：3
> 
> 时间：2009-05-13T00:50:14.740
> 
> 标签：java, oracle, jdbc, cluster-computing

我想连接到这个 TNS 描述的集群 Oracle 数据库：

```
 MYDB=
 (DESCRIPTION = 
    (ADDRESS = (PROTOCOL = TCP)(HOST = host1)(PORT = 41521)) 
    (ADDRESS = (PROTOCOL = TCP)(HOST = host2)(PORT = 41521)) 
    (LOAD_BALANCE = yes) 
    (CONNECT_DATA = 
        (SERVER = DEDICATED) 
        (SERVICE_NAME= PDSALPO)
    )
 ) 
```

我使用以下配置从我的应用程序正常连接到非集群 Oracle：

```
<group name="jdbc">
    <prop name="url">jdbc:oracle:thin:@host1:41521:PDSALPO</prop>
    <prop name="username">user</prop>
    <prop name="password">pass</prop> 
</group> 
```

您知道如何更改它以连接到集群数据库吗？

谢谢，

谭

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T01:30:21.570

显然你可以做到这一点

```
jdbc:oracle:thin:@(DESCRIPTION=(LOAD_BALANCE=on)
(ADDRESS=(PROTOCOL=TCP)(HOST=host1)
(PORT=1521))
(ADDRESS=(PROTOCOL=TCP)(HOST=host2)
(PORT=1521))
(CONNECT_DATA=(SERVICE_NAME=service))) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T08:07:25.763

You can use this format, unless you make use of JTA transactions. In that case you must use some different setup. See [http://forums.oracle.com/forums/thread.jspa?messageID=2860653&#2860653](http://forums.oracle.com/forums/thread.jspa?messageID=2860653&#2860653) (applies for BEA Weblogic, but I think it also applies for other setups and application servers)

# iphone - 用于非 RIM 设备的 BlackBerry Messenger API？

> ID：855557
> 
> 赞同：5
> 
> 时间：2009-05-13T00:50:21.323
> 
> 标签：iphone, api, blackberry, bb-messenger

我想知道 RIM 是否发布了一个 API，允许非 RIM 设备（如 iPhone）上的第三方应用程序发送和接收黑莓消息？？？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-13T13:14:49.380

BlackBerry Messenger 使用 PIN 到 PIN 协议传输消息，因此必须为任何设备分配 PIN。Rim 确实有一个程序 ( [BlackBerry Connect](http://na.blackberry.com/eng/ataglance/connect/) )，它允许一些非 BlackBerry 设备连接到 BlackBerry 基础设施，但尚不清楚该软件是否支持 PIN 到 PIN 或 BlackBerry Messenger 通信。iPhone 不在支持的硬件列表中。

此外，由于 BlackBerry Messenger 流量通过 Rim 运营中心进行路由，因此必须拥有 BlackBerry Data Plan。

我从来没有看到过这样一个已发布的 API 的任何信息，尽管这并不意味着它不存在，因为上述原因它是极不可能的。

# git - 无法推送到远程 Git 存储库

> ID：855558
> 
> 赞同：4
> 
> 时间：2009-05-13T00:50:35.923
> 
> 标签：git, github

我昨天刚刚通过 Github 进入 Git，并且正在远离 svn。我创建了一个私人仓库，我打算用它来让我的个人项目在工作和家庭之间保持同步。在创建远程仓库的过程中，我的本地工作文件被推送了。昨晚，我能够将它们拉到家里的笔记本电脑上。

现在我在工作的 repo 目录中添加了一些新文件。我做了“git add filename”，其中“filename”是我的文件。然后我做了“git commit -m 'my message'”，这似乎奏效了。我不能把它们推到遥控器上。我尝试了“git push personal”，但出现错误：

```
To git@github.com:geuis/personal.git
 ! [rejected]        master -> master (non-fast forward)
error: failed to push some refs to 'git@github.com:geuis/personal.git' 
```

当涉及到这些东西时，Svn 真的很直截了当。我一直在尝试通读有关 Git 如何工作的文档，但其中大部分似乎假设您已经了解基础知识。

对于我的情况，我需要了解哪些基础知识？Github 上的远程存储库，以及将手动同步到远程的工作和家庭中的 2 个单独的结帐。

我在 Mac 上。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-13T00:51:55.017

为了能够推送到远程，一般来说，您需要与远程分支保持同步。`git pull`先试，再试`git push`。

此外，github 建议您这样做`git push -u personal master`，以便远程设置头部

# iphone - 是否可以创建一个 UITabBarController 其标签栏项目只有文本标签（没有图标）？

> ID：855564
> 
> 赞同：2
> 
> 时间：2009-05-13T00:52:11.957
> 
> 标签：iphone, objective-c, ios, cocoa-touch, uikit

在 iOS 中，我想创建一个`UITabBarController`用于全局应用程序导航（如“电话”应用程序和许多其他应用程序），其标签栏项目具有文本标签，但没有图标。

因此，我还希望 的高度`UITaBar`更短。`UITabBar`应该只足够高以容纳文本标签或 Apple 推荐的最小按钮高度 (44pt) 。

有没有一种标准的方式可以说“这`UITabBar`没有图标，只有文本标签”。`UITabBar`如果没有，关于使用自定义子类/替换类实现此目标的最佳方法的任何建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T01:39:33.493

这听起来像是一个[带有 UISegmentedControl 的 UIToolbar](http://img17.imageshack.us/img17/7205/tabsh.png)的完美任务。它提供纯文本选项卡行为（尽管它可能没有你想要的外观......）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T02:57:19.177

1）我不确定您是否可以修改标签栏的大小`UITabBarController`- 我认为仅显示文本不会缩小标签栏的大小，因为您可能需要查看其他解决方案。

2）如果你想修改标签栏中项目的外观，你必须在`IViewController(s)`你添加到的 U 上设置它们`UITabBarController`。见`tabBarItem`_`UIViewController`

`UITabBaritem`3）您可以使用系统默认值（`initWithTabBarSystemItem:tag:`using `UITabBarSystemItem`）或 using 进行初始化`initWithTitle:image:tag:`。在后一种情况下，如果图像为零，则不会显示 - 所以这应该处理没有图标的文本（我相信）。

查看有关的教程，`UIViewController`或者`ViewControllers`一般他们将讨论`UITabBarController`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-23T05:24:21.527

I have seen this done in at least one app by creating icons with the desired text in each. Then just add the icons with the text as if they were the regular images.

* * *

## 回答 #4

> 赞同：-5
> 
> 时间：2009-05-13T17:58:14.440

你在一个好的 iPhone 应用程序中见过这个吗？不？多么惊喜！这不是 UITabBar 的设计目的，所以你不应该这样做。

如果你那么绝望，你将不得不创建你自己的 UITabBar 风格的类和相应的控制器。

# oop - 通过工厂方法将参数传递给特定的子类

> ID：855569
> 
> 赞同：8
> 
> 时间：2009-05-13T00:53:50.610
> 
> 标签：oop, subclass, factory

假设我有一个抽象类 Drink 和一个工厂方法，它选择在运行时创建的饮料类型（葡萄酒、啤酒等）。

每个 Drink 都需要一些参数来正确初始化自己。其中一些是所有饮料共有的；例如，它们可能都需要 DrinkConfig 参数。

但每种饮料也可能有其独特的要求。也许 Wine 需要一个侍酒师辅助对象来初始化自己。Beer 不需要它，但它可能需要它自己的辅助对象。

那么我应该将什么传递给工厂方法？当我调用它时，我拥有所有可用的辅助对象，所以我可以将它们全部传递给工厂。但这最终可能会引发很多争论。有没有更好的方法来设计这个？

**编辑：**假设我不能只在工厂中创建辅助对象；它们只能从呼叫者那里获得。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T01:01:02.977

我会在你的工厂类中创建不同的重载方法。

```
public class DrinkFactory {

    public static Drink CreateBeer(DrinkConfig config, string hops) {
        return new Beer(config, hops);
    }

    public static Drink CreateWine(DrinkConfig config, string grapes, int temperature) {
        return new Wine(config, grapes, temperature);
    }
} 
```

编辑：

如果希望在 Factory 类中只有一个方法，则替代实现将是：

```
public enum DrinksEnum {
    Beer,
    Wine
}

public class DrinkFactory {

    public static Drink CreateDrink(DrinksEnum drinkType, DrinkConfig config) {
        switch(drinkType) {
            case DrinksEnum.Beer:
                return new Beer(config);
            case DrinksEnum.Wine:
                return new Wine(config);
            default:
                throw new ApplicationException("Drink type not recognised.");
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T01:04:57.617

工厂方法应该抽象出如何创建值的细节。所以你不应该将辅助对象传递给工厂方法，工厂方法应该创建它需要的辅助对象并将其传递给适当的构造函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T01:12:05.163

工厂应该首先创建非常相似的对象。这意味着即使所有这些对象都是饮料，工厂方法也可能不合适，因为每种饮料都与另一种完全不同。

话虽如此，您可以改为传递大小等于您要设置的属性数量的对象列表。然后，每个对象将代表您要在相应对象的构造函数中设置的值，按照您要设置这些变量的顺序。这样做的缺点是你必须在调用之前在工厂之外格式化一个列表，这有点笨拙。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T01:03:17.667

我很想提供一个简单的解决方案，其中您的成分来自基类“DrinkIngredients”。您必须匹配要用于特定饮料的子类。

显然，您可能很想为原料创建另一个工厂——但这会导致先有鸡还是先有蛋的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T01:03:40.707

通常，存在工厂方法来隐藏这些细节。一个重要的问题是侍酒师来自哪里——如果所有这些其他助手都是单例的或者可以从已知来源获得，那么实例化工厂所需的信息以找到它们，这样您的调用代码就不需要担心它。

此外，在许多情况下，将使用 Spring 等框架来允许您在配置文件中而不是在代码中描述这些关系。

如果您确实需要在运行时从调用代码中传递帮助程序，我建议您阅读论文“参数和结果”（[http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.50.7565](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.50.7565) )，它描述了编组复杂参数的常见模式。本质上，您将创建必要参数的中间集合并将其传递给工厂。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-13T01:08:57.107

在这种情况下，我通常会寻找其他解决方案而不是传递变量。

例如，在您的情况下 - WineFactory 需要侍酒师，因此它可以构建适当的 Wine -

这是运行时依赖注入的一个很好的用例。某种形式的依赖注入框架将使这项工作变得非常简单、易于理解并且只是一种工作，而无需传递所有这些属性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-05-04T19:00:56.927

这看起来是该`Builder`模式的完美案例。使用`Factory`创建相似对象的`Builder`模式，以及构造复杂、不同对象的模式。尝试`Factory`对这个问题使用该模式将导致针对不同对象的许多不同的初始化构造函数（具有不同数量/类型的参数）。

# java - 没有值的Java hashmaps？

> ID：855576
> 
> 赞同：31
> 
> 时间：2009-05-13T00:56:42.583
> 
> 标签：java, hashmap, lookup, containskey

假设我想将单词放入数据结构中，并且我想进行持续时间查找以查看单词是否在此数据结构中。我只想看看这个词是否存在。我会为此使用`HashMap`(containsKey()) 吗？ `HashMap`s 使用键-> 值配对，但在我的情况下，我没有值。当然我可以使用 null 作为值，但即使是 null 也会占用空间。似乎这个应用程序应该有一个更好的数据结构。

该集合可能被多个线程使用，但由于集合包含的对象不会改变，我认为我没有同步/并发要求。

谁能帮我吗？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-05-13T00:57:32.160

请改用[HashSet](http://java.sun.com/j2se/1.5.0/docs/api/java/util/HashSet.html)。[它是Set](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Set.html)的哈希实现，主要用于您所描述的内容（无序的项目集）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-13T01:36:08.403

您通常会使用**Set**的实现，最常见的是 HashSet。如果您确实需要并发访问，那么 ConcurrentHashSet 提供了一个插入式替换，它提供了安全的并发访问，包括对集合的安全迭代。

在任何情况下，我都建议在您的代码中将其简单地称为 Set ，除非在您构造它的地方；这样，如果您以后需要它，就更容易为另一个实现添加一个实现。

**即使该集合是只读的**，如果它被创建它的线程以外的线程使用，您确实需要考虑**安全*发布***（即确保任何其他线程看到该集合处于一致状态：记住任何内存写入，即使在构造函数中，也不能保证在您期望的时间或其他线程中可供其他线程使用，除非您采取措施确保这一点）。这可以通过以下两种方式完成：

*   确保对集合的唯一引用位于[最终字段](http://www.javamex.com/tutorials/synchronization_final.shtml)中；
*   确保确实没有线程修改集合。

您可以通过使用 Collections.unmodifiableSet() 包装器来帮助确保后者。这为您提供了给定集合的不可修改视图 - 因此，如果没有其他“正常”引用集合转义，您是安全的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-13T01:05:47.927

您可能想使用[java.util.Set](http://java.sun.com/javase/6/docs/api/java/util/Set.html)。实现包括[java.util.HashSet](http://java.sun.com/javase/6/docs/api/java/util/HashSet.html)，它是 HashMap 的 Set 等价物。

即使集合中包含的对象没有变化，您也可能需要进行同步。将 Set 传递给不同的线程后，是否需要将新对象添加到 Set 中？如果是这样，您可以使用[Collections.synchronizedSet()](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#synchronizedSet(java.util.Set))使 Set 线程安全。

如果您有一个带有值的 Map，并且您有一些代码只想将 Map 视为一个 Set，您可以使用 Map.entrySet()（但请记住，entrySet 返回 Map 中键的 Set 视图；如果 Map 是可变的，则可以通过 entrySet 返回的集合来改变 Map）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-13T00:58:40.083

您想使用实现 Set 接口的 Collection ，可能是 HashSet 来获得您所说的性能。见[http://java.sun.com/javase/6/docs/api/java/util/Set.html](http://java.sun.com/javase/6/docs/api/java/util/Set.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T01:02:36.717

除了`Set`s，在某些情况下，您可能希望将 a`Map`转换为`Set`with `Collections.newSetFromMap(Map<E,Boolean>)`（一些`Map`s 不允许`null`值，因此是`Boolean`）。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-13T11:47:36.887

as everyone said HashSet is probably the simplest solution but you won't have constant time lookup in a HashSet (because entries may be chained) and you will store a dummy object (always the same) for every entry...

For information [here a list of data structures](http://en.wikipedia.org/wiki/List_of_data_structures) maybe you'll find one that better fits your needs.

# php - 出现在 textarea 输出中的标签

> ID：855577
> 
> 赞同：1
> 
> 时间：2009-05-13T00:56:46.703
> 
> 标签：php, html, wordpress

我有一个带有两个文本区域的输入表单，允许用户输入用逗号分隔的单词。

```
<form action="http://www.example.com/output.php" method="post">
<table border="0">
<tr>
<td>
<h3 class="title">Prefix</h3>
<textarea cols="34" rows="8" name="cat[]"></textarea></td>
<td>
<h3 class="title">Suffix</h3>
<textarea cols="34" rows="8" name="cat[]"></textarea></td>
</tr>
</table>

Enter words separated by a comma. 

<input type="submit" value="Go" /> </form> 
```

然后它将这些传递到输出表单，该表单将逗号中的单词分解，然后将它们连接在一起，直到创建单词的所有可能排列。然后它将结果打印到文本区域中。我的问题是输出（虽然格式正确并且在每个排列之间有换行符）在每行的末尾都有一个 br 标记。例如。

```
testtest2<br />
testtest2<br />
testtest4<br />
testetest2<br />
testetest2<br />
testetest4<br /> 
```

输出形式：

```
$cat = $_POST['cat']; //trait set for textbox inputs
foreach(array_keys($cat) as $key){
$cat[$key] = explode(",", str_replace(' ','',$cat[$key]));
}    

function showCombinations($string, $traits, $i)
{
if ($i >= count($traits))
echo trim($string)."\n";  
else
{
foreach ($traits[$i] as $trait)
showCombinations("$string$trait", $traits, $i + 1);
}
}
?>

<form name=form1 method=post action=''''>
<textarea><?php ShowCombinations('', $cat, 0); ?></textarea>
</form> 
```

1.  当我删除输出的 textarea 标签时，它工作正常。
2.  当我离开 textarea 标签并删除/替换 echo trim($string)."\n"; 使用“\r”或“n”或“\n\r”，
    消失但我也失去了换行符
3.  替换 echo trim($string)."\n"; 回声 nl2br($string); 然后结果与 2 相同。
4.  替换为 echo nl2br($string)."\n"; 然后结果与 1 相同。

将不胜感激任何帮助。我的菜鸟大脑快要崩溃了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T01:25:28.290

我会先说我使用 Blogger 而不是 Wordpress，但我想有相似之处。在 Blogger 中有一个将换行符转换为`<br>`标签的设置。我想如果你不把代码片段之类的东西放进去（如果你在写关于猫之类的博客的话）会很方便，但对于编程来说就不那么方便了。我不得不将其关闭并手动放入我的段落标签等。

这是一个[不太理想的解决方案](http://sltaylor.co.uk/blog/get-rid-of-br-tags-inserted-by-wordpress/)，其中还提到了 Wordpress`<br>`在表单中插入标签的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T01:14:10.740

我认为`<br />`在这种情况下，标签就是您想要的。像 \n 和 \r 这样的换行符在 HTML 中没有任何作用——所有的空格，包括换行符，都会被忽略。该`<br />`标签本质上是 HTML 等价物——它代表“中断”。我对 PHP 了解不多，所以我不知道为什么它`<br />`会自动为您提供，但对于您所描述的内容，这是正确的 HTML。

从技术上讲，有更好的方法来格式化输出然后使用这些标签，但这更像是一个高级主题。如果您对此有点陌生，就像您说的那样，那么现在就让它以这种方式工作，然后也许在以后的某个时候您可以了解正确的语义 HTML 标记、CSS 样式等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-25T15:20:56.410

试试这个，我已经测试过了...

```
<!DOCTYPE HTML>
<html>
<head></head>
<body>
<?php 
if(isset($_POST['status'])){
$newLineCode = "<br/>";
$message = $_POST['status'] ;
$modifiedTextAreaText = ereg_replace( "\n", $newLineCode, $message);
echo " <p>Result of Code Snippet:</p> " . $modifiedTextAreaText ;
}
?>
<form action="" method="post">
<textarea name="status"></textarea>
<input type="submit"/>
</form>
</body>
</html> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T01:06:20.840

为什么不将结果显示在`<div>`可能或`<p>`??

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T01:15:58.897

我相信`\n`应该工作。也许您没有或没有不正确的文档类型。

例子：`<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">`

如果一切顺利，我喜欢锁的答案。你可以给我们一个`<div>`，你甚至可以把它设计成看起来像一个`<textarea>`（甚至更好！）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-08T00:34:00.310

花了一些时间，但过了一段时间，我能够在 wp-includes/formatting.php 文件中查明这两个位置（第 154 和 165 行 - WP 2.8）。

```
154     $pee .= '<p>' . trim($tinkle, "\n") . "</p>\n"; //<-- before
154     $pee .= trim($tinkle, "\n") . "\n"; //<-- after

165     $pee = preg_replace('|(?<!<br />)\s*\n|', "<br />\n", $pee); // optionally make line breaks <-- before
165     $pee = preg_replace('|(?<!<br />)\s*\n|', "\n", $pee); // optionally make line breaks <-- after 
```

这处理了我的 textarea 字段中的段落和中断标记。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-23T16:36:32.200

我通过使用 strip_tags 函数解决了我的问题。当用户编辑过去的帖子时，它会保存
在数据库中并显示在博客上。但是 strip_tags 函数处理了它。

# .net - 查看数据填充的最佳实践？

> ID：855598
> 
> 赞同：1
> 
> 时间：2009-05-13T01:04:32.437
> 
> 标签：.net, performance, garbage-collection

我一直在开发一个 .NET 应用程序并遇到内存错误（我是一个可以做其他事情的 Java 开发人员），我一直在考虑性能。我发布的不是内存问题。记忆问题让我开始思考。

我在我的 ASP.NET 应用程序中重复了一个趋势，我在无数的 J2EE 应用程序中使用过：使用业务实体填充下拉列表。越想越不喜欢。例如，在我正在使用的应用程序上，我们有一个当前项目的下拉列表。项目是对象的图。但是，要创建列表，我们会拉回所有项目，创建图表并仅使用 id 和显示名称。这似乎是一种可怕的浪费。公平地说，dal 层完全是手写的。首席架构师不允许像 NHibernate 这样的 ORM。

我意识到所有这些对象都在 GEN0 中并且很快就被垃圾收集了。让我担心的是，我正在向 GC 征税。处理 GC 所需的 CPU 的 5% 是我无法在其他地方使用的 CPU 的 5%。这个网站是我真正尊重的少数几个网站之一。大家怎么看？为此使用实体模型不好吗？我应该创建一组仅包含显示值和 id 的 IdValue 对象吗？创建这样一个视图对象层（我不认为这会进入业务层）只会创建冗余代码吗？

谢谢，JPD

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T01:09:11.113

不用担心 GC 会增加负担，它会根据您的应用程序自行调整，为您提供最佳性能。是的，最好减少您的内存占用，但我认为这并不像您想象的那么严重。

允许您仅返回所需数据的良好 DAL 将提高应用程序的性能，并且还将减少应用程序所需的内存量。但无论你是否使用“太多”内存，我想在大多数情况下 GC 都能很好地处理它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T01:26:15.293

在过去的几年里，我一直在从事业务线 .NET 应用程序的工作，但还没有遇到性能问题，通过尝试帮助垃圾收集器更有效地工作来解决这个问题。

另一方面，收集指标对于提高性能、内存使用等非常有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T01:15:55.510

另一种方法是为您的目的创建轻量级对象。在这种情况下，您将拥有一个只有 id 和显示名称的轻量级项目对象。然后需要决定是否重新使用现有的 DAL 或创建 DAL 的轻量级版本。

# .net - CodeSmith vs T4：.netTiers 级别套件

> ID：855600
> 
> 赞同：6
> 
> 时间：2009-05-13T01:05:37.863
> 
> 标签：.net, t4, codesmith

有人将 netTiers 模板集移植到 Visual Studio 的 T4 模板吗？还是有类似范围的系统？有人在工作环境中使用 T4 吗？Codesmith 和 T4 之间有哪些（如果有的话）主要区别？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T05:54:22.597

我在 T4 中涉足了一段时间 - 嘿，如果它是免费的并且包含在 VS2008 中，请使用它，对吗？

我的基本想法是创建一组模板来读取数据库表，并从中创建我们自己的“roll-your-own” ORM 类。

我放弃了 T4，感到沮丧，甚至无法让 CodeSmith 中小菜一碟的最基本的东西工作。

即使是简单的任务，例如选择要使用的服务器、数据库和表，也无法在 T4 中从模板本身的“外部”有效地完成。是的，您可以将所有这些值作为字符串值硬编码到 T4 模板中——但是来吧，这真的不是一个解决方案，是吗？

CodeSmith 对选择服务器、数据库和表有很好的支持，您可以将它们设置为模板上的属性，然后选择您想要的内容，然后让模板在您选择的特定表上执行您的操作。

我的结论：T4 很有希望，但“还没有”。它可能适用于非常简单的场景，但现在，在我看来，它远没有 Codesmith 那样灵活和强大。

对于像 .netTiers 这样的场景，我暂时会坚持使用 Codesmith。

马克

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-13T11:13:17.723

T4 不是 CodeSmith。是的，您以 C# 或 Visual Basic 代码的形式在 .tt 文件中指定参数，并使用 <#@ include #> 指令来引用代码生成逻辑的实际实现。这并不比使用 CodeSmith 在 XML 文件中指定相同的信息更难编码。

对于类似 NetTiers 的 T4 模板套件，请查看 S#arp 架构：[http](http://code.google.com/p/sharp-architecture/) ://code.google.com/p/sharp-architecture/ 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T18:09:00.197

如果您正在寻找一个支持良好的 DAL 的 T4 实现，它是开源的，具有 Linq 接口以及它自己的 Fluent 接口，它将为表、存储过程、视图等创建包装器。那么您需要尝试 SubSonic 3.0。SubSonic 2.2 具有相同的优点，减去了 T4 和 Linq 接口，并且处于发布模式。SubSonic 3.0 处于 Alpha 阶段，但您可以根据需要下载代码或 .dll 和 T4 模板。

# c - 2 字节的 Malloc 会产生问题

> ID：855607
> 
> 赞同：0
> 
> 时间：2009-05-13T01:07:58.060
> 
> 标签：c, memory-management, malloc

我正在尝试使用短的 malloc，例如

```
typedef union _SOME_STRUCT_ {

   struct {

     USHORT u:4;
     USHORT v:4;
     USHORT w:4;

   } x;

   USHORT word;

} SOME_STRUCT, *PSOME_STRUCT;

PSOME_STRUCT p = malloc (sizeof (SOME_STRUCT));

if (p) {

    p->x.u = 0;
}

free (p); // **** RANDOMLY CRASHING HERE **** 
```

我调试了几天，一无所知，

注意（已编辑）：Linux 和 gcc 版本 3.4.6 20060404

* * *

**使用 VALGRIND 发现的问题**

但是，我想在这里记录它，以便我的开发人员同伴可能会意识到这种情况......

我实际上已经将结构定义为

```
typedef union _SOME_STRUCT_ {

   struct {

     USHORT u:4;
     USHORT v:4;
     USHORT w:4;

   } x;

   USHORT word;

} ALBUM, *PALBUM; 
```

以及我还定义的代码中的其他地方

```
#define ALBUM "album" 
```

因此， sizeof (ALBUM) 指的是 #define 值而不是 typedef ，因此是问题所在。

让我吃惊的是，

**这在 C 中是否允许？**

* * *

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T01:22:40.577

尝试通过[valgrind](http://valgrind.org/)传递您的程序，这是一个完全免费的开源程序，也许它可以帮助您查看问题所在。不要忘记使用调试符号进行编译： gcc -g [etc] 。

希望这有帮助..

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T02:11:34.527

这个版本的代码对我有用。

```
#include <stdio.h>
#define USHORT unsigned short

typedef union _SOME_STRUCT_ {
    struct {
        USHORT u:4;
        USHORT v:4;
        USHORT w:4;
    } x;
    USHORT word;
} SOME_STRUCT, *PSOME_STRUCT;

int
main(int c, char *argv[])
{
    PSOME_STRUCT p = malloc (sizeof (SOME_STRUCT));

    if (p) {
        p->x.u = 0;
    }

    free (p); // **** Properly exiting after this ****
} 
```

* * *

这是来自 Windows XP 上 Cygwin 的 GDB 调试。

```
(gdb) p/x sizeof(PSOME_STRUCT)
$1 = 0x4
(gdb) p/x sizeof(p)
$2 = 0x4
(gdb) p/x sizeof(*p)
$3 = 0x2
(gdb) n
23              if (p) {
(gdb) p/x *p
$4 = {x = {u = 0xc, v = 0x4, w = 0x3}, word = 0x534c} 
```

忽略 $4 中的值，数据未初始化。程序正常退出。

除了这些行之外，您的代码中还有其他内容吗？

编辑：并且，免费（0）；是一个有效的操作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T01:15:31.657

可能是对齐问题。如果您执行以下操作，它是否仍然会崩溃：

```
 struct {
     USHORT u:4;
     USHORT v:4;
     USHORT w:4;
     USHORT  :4;
   } x; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T02:22:02.260

问题不在于代码，而是在另一个线程之前或在另一个线程中发生的事情。

我会减少程序的各个部分，直到它停止崩溃，然后逐步将其添加回来，直到您找出导致此问题的部分。根据操作系统/平台，您还可以尝试一些内存检查工具，valgrind/_crtdebug 等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T02:28:59.390

如果这个问题发生在你可以调试的地方，你可以通过调用 memcheck 来启动你的调试会话。

内存崩溃的原因通常是堆或释放同一个指针两次。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-13T03:19:45.577

你在没有检查 malloc 是否成功的情况下无条件地调用 free()，所以如果 malloc 失败并且 p 是一个 NULL 指针，那么你正在调用 free(NULL)。

在 if (p) 块内移动 free。

这可能不是崩溃的原因，如果没有内存限制，也不应该是这样，但它仍然是一个错误。

稍后添加：doh，free(NULL) 是明确允许的，根据[http://www.opengroup.org/onlinepubs/009695399/functions/free.html](http://www.opengroup.org/onlinepubs/009695399/functions/free.html) - 抱歉。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-13T03:25:43.240

如果你在 malloc 和 free 之间做一些事情，你可能会意外地超出另一个数组并破坏你自己的堆栈

（如果“p”碰巧不在寄存器中，并且您超出了静态分配的数组并命中堆栈上存储“p”的位置，那么您稍后将尝试释放随机垃圾，因此会出现段错误)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-13T01:14:07.700

如果你把 free(p) 放在你的 if 中怎么办？也许（不太可能） malloc 失败了......

# html - html链接打开文件夹的方法有哪些

> ID：855614
> 
> 赞同：119
> 
> 时间：2009-05-13T01:09:36.993
> 
> 标签：html, directory, hyperlink

我需要让应用程序的用户通过单击网页内的链接来打开文件夹。该文件夹的路径在网络上，可以从任何地方访问。我可能确定没有简单的方法可以做到这一点，但也许我错了？

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-05-13T01:23:39.670

您想在 Windows 资源管理器中打开共享文件夹吗？您需要使用`file:`链接，但有一些警告：

*   如果链接是转换后的 UNC 路径 ( `file://server/share/folder/`)，Internet Explorer 将起作用。
*   如果[链接](http://kb.mozillazine.org/Links_to_local_pages_do_not_work)[是](http://kb.mozillazine.org/Links_to_local_pages_do_not_work)使用**五个**斜杠`file://///server/share/folder`（谢天谢地，IE 也接受损坏的链接形式。**[`file:`](http://kb.mozillazine.org/Links_to_local_pages_do_not_work)**
***   无法说服 Opera、Safari 和 Chrome 打开`file:`通过 HTTP 提供的页面中的链接。**

 *** * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-13T01:18:03.367

该 URL`file://[servername]/[sharename]`应打开网络上共享文件夹的资源管理器窗口。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2019-06-11T00:17:45.990

聚会有点晚了，但我最近不得不自己解决这个问题，虽然略有不同，但它可能仍然可以帮助与我有类似情况的人。

我在笔记本电脑上使用 xampp 在 Windows 上运行纯本地网站应用程序。（我知道的一个非常具体的环境）。在本例中，我使用指向 php 文件的 html 链接并运行：

```
shell_exec('cd C:\path\to\file');
shell_exec('start .'); 
```

这将打开一个本地 Windows 资源管理器窗口。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-13T01:15:07.650

确保您的文件夹权限设置为允许目录列表，然后只需使用 chmod 701 将您的锚点指向该文件夹（尽管这可能有风险）例如

```
<a href="./downloads/folder_i_want_to_display/" >Go to downloads page</a> 
```

确保该目录上没有 index.html 任何索引文件

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-11-14T16:44:05.390

如果安全设置设置为中等级别，则使用 file:///// 将不起作用。

如果您只是希望用户能够下载/查看位于网络或共享上的文件*，您可以在 IIS 中设置虚拟目录。在“属性”选项卡上，确保选中“位于另一台计算机上的共享”，并且“连接为...”是可以查看网络位置的帐户。

从您的网页链接到虚拟目录（例如[http://yoursite/yourvirtualdir/](http://yoursite/yourvirtualdir/)），这将在网络浏览器中打开目录视图。

*您可以允许对虚拟目录的写入权限以允许用户添加文件但未尝试过，并假设网络权限将覆盖此设置。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2021-03-05T19:48:22.760

我决定做的是在每个人的计算机上安装一个本地 Web 服务，`9999`例如监听端口并在被告知时在本地打开一个目录。我的示例 node.js 快递应用程序：

```
import { createServer, Server } from "http";

// server
import express from "express";
import cors from "cors";
import bodyParser from "body-parser";

// other
import util from 'util';
const exec = util.promisify(require('child_process').exec);

export class EdsHelper {
    debug: boolean = true;
    port: number = 9999
    app: express.Application;
    server: Server;

    constructor() {
        // create app
        this.app = express();
        this.app.use(cors());
        this.app.use(bodyParser.json());
        this.app.use(bodyParser.urlencoded({
            extended: true
        }));

        // create server
        this.server = createServer(this.app);

        // setup server
        this.setup_routes();
        this.listen();
        console.info("server initialized");
    }

    private setup_routes(): void {
        this.app.post("/open_dir", async (req: any, res: any) => {
            try {
                if (this.debug) {
                    console.debug("open_dir");
                }

                // get path
                // C:\Users\ADunsmoor\Documents
                const path: string = req.body.path;

                // execute command
                const { stdout, stderr } = await exec(`start "" "${path}"`, {
                    // detached: true,
                    // stdio: "ignore",
                    //windowsHide: true,    // causes directory not to open sometimes?
                });

                if (stderr) {
                    throw stderr;
                } else {
                    // return OK
                    res.status(200).send({});
                }
            } catch (error) {
                console.error("open_dir >> error = " + error);
                res.status(500).send(error);
            }
        });
    }

    private listen(): void {
        this.server.listen(this.port, () => {
            console.info("Running server on port " + this.port.toString());
        });
    }

    public getApp(): express.Application {
        return this.app;
    }

} 
```

以本地用户而不是管理员身份运行此服务很重要，否则该目录可能永远不会打开。
从您的 Web 应用程序向 localhost: `http://localhost:9999/open_dir`、 data:发出 POST 请求`{ "path": "C:\Users\ADunsmoor\Documents" }`。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-12-05T00:46:02.620

您还可以复制链接地址并将其粘贴到新窗口中以绕过安全性。这适用于 chrome 和 firefox，但您可能必须在 firefox 中添加斜杠。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-08-28T12:46:27.567

在 Chrome 中不起作用，但其他答案通过插件提出了一个解决方案：

[谷歌浏览器可以打开本地链接吗？](https://stackoverflow.com/questions/2087894/can-google-chrome-open-local-links)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-03-09T07:02:07.477

希望有一天它会帮助某人。我正在制作一个小型 POC 并遇到了这个问题。一个按钮，onClick 显示文件夹的内容。下面是HTML，

```
<input type=button onClick="parent.location='file:///C:/Users/' " value='Users'> 
```

# bash - 一个 bash 单线器，用于更改某些文件所在的目录

> ID：855616
> 
> 赞同：8
> 
> 时间：2009-05-13T01:10:18.520
> 
> 标签：bash, cd

我经常想切换到特定可执行文件所在的目录。所以我想要类似的东西

```
cd `which python` 
```

更改为安装 python 命令的目录。然而，这显然是非法的，因为 cd 需要一个目录，而不是一个文件。显然，我可以做一些 regexp-foo 来删除文件名，但这会破坏它是一个简单的单线的意义。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-13T01:16:09.783

这里：

```
cd $(dirname `which python`) 
```

编辑：

更简单（这次实际测试了）：

```
function cdfoo() { cd $(dirname `which $@`); } 
```

然后是“cdfoo python”。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-13T04:29:25.543

为了避免所有这些外部程序（'dirname' 和更糟糕的是，无用但流行的 'which'）可能需要重写：

```
cdfoo() {
  tgtbin=$(type -P "$1")
  [[ $? != 0 ]] && {
    echo "Error: '$1' not found in PATH" >&2
    return 1
  }
  cd "${tgtbin%/*}"
} 
```

这也修复了上面不常见的关键字“function”并添加了（非常简单的）错误处理。

可能是一个更复杂的解决方案的开始。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-13T05:04:23.847

为了比较：

```
zsh:~% cd =vi(:h)
zsh:/usr/bin%

```

=cmd 扩展为 cmd 的路径， (:h) 是一个全局修饰符，用于获取头部

zsh 是只写但功能强大。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T01:18:12.150

类似的东西应该可以解决问题：

```
cd `dirname $(which python)` 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-13T03:23:47.407

我使用过的一项功能是 pushd / popd。它们维护一个目录堆栈，因此如果您希望在更改目录之前返回到当前工作目录，则不必尝试保留您所在位置的历史记录。

例如：

```
pushd $(dirname `which $@`)
...
popd 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-13T01:18:34.160

你可以使用这样的东西：

```
cd `which <file> | xargs dirname` 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-13T05:00:31.810

我添加了一些简单的错误处理，使 cdfoo() 的行为遵循 dirname 对于不存在/非路径参数的行为

```
function cdfoo() { cd $(dirname $(which $1 || ( echo . && echo "Error: '$1' not found" >&2 ) ));} 
```

# ruby-on-rails - 导轨，一种型号，多种屏幕

> ID：855621
> 
> 赞同：3
> 
> 时间：2009-05-13T01:12:34.490
> 
> 标签：ruby-on-rails, form-for

我有一个有很多领域的模型（近 40 个）。客户希望在多个屏幕之间划分字段。该模型还有一些 has_manys，它们看起来应该是同一个模型的一部分。

如何划分模型，在这些方法之间进行权衡是什么？

我看到了几种可能性：

1) 使用 JavaScript 显示和隐藏表单的一部分。我想我可以做到这一点。

2) 使用提交不同操作的表单。form_for 可以与适当的选项一起使用吗？

我也在寻找其他想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T01:15:24.060

签出[充当状态机](http://github.com/rubyist/aasm/tree/master)。您可以使用它来创建向导等。

重读您的问题后，我认为 Javascript 确实是您正在寻找的。查看[jQuery UI](http://jqueryui.com/)，他们有一个选项卡组件可能会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T05:55:13.843

我会查看[ActsAsWizard](http://github.com/adkron/actsaswizard/tree/master)插件。使做这样的向导变得非常简单。

查看自述文件，它非常棒。

# cygwin - Cygwin 中未安装 C++

> ID：855630
> 
> 赞同：19
> 
> 时间：2009-05-13T01:15:17.587
> 
> 标签：cygwin, g++

我刚刚安装了 Cygwin，可以从 Windows、do `ls`、`emacs`、`vi`等启动 bash shell。但是，当我这样做时，`g++`它说找不到命令。

我以为`g++`是默认安装在 Cygwin 中的？如果不是这种情况，我可以将哪些类别`g++`作为包添加到我的 cygwin 中？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-13T01:17:58.030

你安装`Devel`包了吗？

我建议您阅读[本教程](http://www.horstmann.com/ccc/help/cygwin/install.html)以启动和运行。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-13T01:25:44.873

*用 CygWin 安装所有东西*是个好主意。运行安装程序时，只需单击顶层的圆形图标，直到它显示“完整”而不是“默认”——这将安装所有软件包。

由于依赖关系，我有时在安装单个软件包时遇到问题，但完整安装不受相同问题的影响。

磁盘空间很便宜，你花时间试图弄清楚为什么事情不工作不是。

# firefox - 如何在扩展安装完成之前将 FireFox xpi 中的 dll 加载到本地 PC 目录

> ID：855642
> 
> 赞同：0
> 
> 时间：2009-05-13T01:18:00.637
> 
> 标签：firefox, dll

我的 FireFox 扩展有一个外部 dll 依赖项来运行。所以我在我的 xpi 中包含那个 dll 并在第一次运行时将该 dll 复制到正确的目录中。但这对我不起作用，因为我发现我自己的 dll（用 XPCOM C++ 编写）希望在安装过程中看到该外部 dll。所以每次我都必须手动将外部dll放在正确的目录中，但这对用户来说并不方便。

有什么方法可以将复制外部 dll 和将 xpi 安装到一个包中并自动安装？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-08T01:23:20.087

如果外部 DLL 只有几个导出，请不要链接到它。而是调用 LoadLibrary 和 GetProcAddress。

如果外部 DLL 有许多导出但您只需要函数，请推迟加载 DLL，直到您通过链接器提供的延迟加载机制真正需要它。

[http://msdn.microsoft.com/en-us/library/151kt790(VS.80).aspx](http://msdn.microsoft.com/en-us/library/151kt790(VS.80).aspx)

如果您需要从外部 DLL 导出数据，我不确定这里有多大希望。

# sifr - Rockwell / sIFR 3 - 带有特殊字符（£等）

> ID：855647
> 
> 赞同：1
> 
> 时间：2009-05-13T01:18:59.043
> 
> 标签：sifr

有没有什么地方可以下载 Rockwell 字体的 SWF fo sIFR 3（就像 sIFR 3 附带的字体一样），但也嵌入了一堆特殊字符？特别是英镑符号（£），但更多会很棒:)

我现在无法访问 Flash，我尝试了自动工具，但收效甚微。我到处找，有没有人指点？

非常感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T04:02:42.623

的确，答案很简单。适用于最新 sIFR 修订版的工具：

[http://www.sifrgenerator.com/](http://www.sifrgenerator.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T01:22:38.267

您可能想尝试仅使用 JavaScript 的解决方案。

[看看这个，它叫做 TypeFace](http://typeface.neocracy.org/)。另请参阅[堆栈溢出。](https://stackoverflow.com/questions/410608/)

# .net - 将对象序列化为文本文件：哪个 API/框架？

> ID：855648
> 
> 赞同：1
> 
> 时间：2009-05-13T01:19:02.083
> 
> 标签：.net, serialization

我想将程序的 DataModel 对象保存到文件中，并能够再次重新加载相同的对象图。我希望它是某种文本文件，所以我可以区分它并在文本编辑器中打开它。XML 会很好，而且似乎是一个不错的起点，因为 .NET 内置了 XML 序列化。

但是我应该选择哪种类型的 XML 序列化？我知道[SoapFormatter](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.formatters.soap.soapformatter.aspx)（但现在已弃用）、[XamlWriter](http://msdn.microsoft.com/en-us/library/system.windows.markup.xamlwriter.aspx)（很好但非常有限）、[XmlSerializer](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlserializer.aspx)和[DataContractSerializer](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.datacontractserializer.aspx)（我对它们都不太了解）。（这只是来自微软的那些——天哪！）

我也对开源框架持开放态度，而且我不依赖于 XML（[JavaScriptSerializer](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx)看起来也很有趣）。

我在序列化框架中的一些一般偏好：

*   我真的不必编写任何代码（或 XML 配置文件）来获取新添加的属性以进行序列化。我可以（勉强）接受必须添加一个属性，但我的开销越少越好。
*   约定优于配置是*好的。*
*   任何可以序列化循环对象图的东西都可以加分。如果必须，我*可以避免*这种情况，但我不想仅仅为了方便别人的序列化框架而使我的编码变得更难。
*   我更喜欢保存属性值的东西，而不是直接进入私有字段。
*   我想要一些可以适应未来的东西。如果我重命名属性或枚举值，我不希望我的旧文件被吐司；我想要某种方式来定义升级路径并在加载时重新映射值（最好不编写大量 XML 配置文件），并且我希望能够编写自动化回归测试来证明我可以打开旧文件。
*   如果它可以自动忽略我的对象的事件，而不需要我为每个对象添加额外的属性，那就太好了。将事件写入文本格式永远不会有意义。
*   如果它在 Silverlight 和成熟的 .NET 中工作，那将是非常酷的。（我对此没有任何近期需求；它会很酷。）

建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T01:20:31.847

我认为这[`DataContractSerializer`](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.datacontractserializer.aspx)是你最好的选择——它是一个更现代的 .NET 框架序列化程序，并且运行良好。

但是，为了公平起见，我建议您阅读[XmlSerializer 与 DataContractSerializer：Wcf](http://www.danrigsby.com/blog/index.php/2008/03/07/xmlserializer-vs-datacontractserializer-serialization-in-wcf/)中的序列化进行详细比较。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T01:21:51.437

使用 XmlSerializer 或 DataContractSerializer，除非它们无法满足您的要求。我打赌他们可以交付，您将不需要其他任何东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T01:23:14.913

这是一个很大的要求列表。就个人而言，我认为 DataContractSerializer 将满足您的大部分需求。

1）您可以添加属性，它们将被自动拾取（假设您有.Net 3.5 SP1）

2）它有一些版本支持

3）它存在于 Silverlight 中，尽管缺少一些功能，例如 PreserveObjectReferences（我认为）

4）您可以明确定义您想要序列化的内容，因此您可以排除您的私有字段，尽管如果您根本不指定任何内容，它们将被包括在内。

5）很确定它处理循环对象图，但不要引用我的话。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T03:48:29.277

我写了……希望对你有帮助。。

```
public class TAObjectSerializer
{
    private static void __serializeData(object result, Type propType, XmlWriter wr)
    {
        if (result != null)
        {
            TypeConverter tc = TypeDescriptor.GetConverter(result);
            if (tc != null && tc.CanConvertTo(typeof(string)) && tc.CanConvertFrom(typeof(string)))
            {
                wr.WriteString(tc.ConvertTo(result, typeof(string)) as string);
            }
            else if (propType.IsArray)
            {
                Array tmp = result as Array;
                if (propType.GetElementType() == typeof(object))
                {
                    for (int i = 0; i < tmp.Length; i++)
                    {
                        object v = tmp.GetValue(i);
                        wr.WriteStartElement("item");
                        if (v == null)
                        {
                            wr.WriteAttributeString("type", "");
                        }
                        else
                        {
                            Type vt = v.GetType();
                            wr.WriteAttributeString("type", (vt.IsPrimitive || v is string || v is decimal || v is DateTime || vt.IsArray) ? vt.ToString() : vt.AssemblyQualifiedName);
                            __serializeData(v, v.GetType(), wr);
                        }
                        wr.WriteEndElement();
                    }
                }
                else
                {
                    for (int i = 0; i < tmp.Length; i++)
                    {
                        object v = tmp.GetValue(i);
                        wr.WriteStartElement("item");
                        if (v != null)
                        {
                            __serializeData(v, v.GetType(), wr);
                        }
                        wr.WriteEndElement();
                    }
                }
            }
            else if (propType.IsSerializable)
            {
                using (MemoryStream __ = new MemoryStream())
                {
                    BinaryFormatter bf = new BinaryFormatter();
                    bf.Serialize(__, result);
                    wr.WriteString(Convert.ToBase64String(__.ToArray()));
                }
            }
            else if (propType.IsClass)
            {
                wr.WriteRaw(__serialize(result));
            }
        }
    }
    private static void __serializeItem(object obj, PropertyInfo pi, XmlWriter wr)
    {
        Type propType = pi.PropertyType;
        object result = pi.GetValue(obj, null);
        wr.WriteStartElement("property");
        wr.WriteAttributeString("type", (propType.IsPrimitive || result is string || result is decimal || result is DateTime || propType.IsArray) ? propType.ToString() : propType.AssemblyQualifiedName);
        wr.WriteAttributeString("name", pi.Name);
        __serializeData(result, propType, wr);
        wr.WriteEndElement();
    }
    private static string __serialize(object obj)
    {
        StringBuilder sb = new StringBuilder();
        XmlWriterSettings set = new XmlWriterSettings();
        set.OmitXmlDeclaration = true;
        using (XmlWriter wr = XmlWriter.Create(sb, set))
        {
            Type t = obj.GetType();
            wr.WriteStartElement("object");
            wr.WriteAttributeString("type", t.AssemblyQualifiedName);
            if (t.IsClass && !(obj is string))
            {
                PropertyInfo[] list = t.GetProperties();
                foreach (PropertyInfo pi in list)
                {
                    if (pi.CanRead && pi.CanWrite && pi.GetCustomAttributes(typeof(NonSerializedAttribute), true).Length == 0)
                    {
                        __serializeItem(obj, pi, wr);
                    }
                }
            }
            wr.WriteEndElement();
        }
        return sb.ToString();
    }
    public static XmlDocument Serialize(object obj)
    {
        if (obj == null)
            throw new ArgumentNullException("obj");
        XmlDocument doc = new XmlDocument();
        string str = __serialize(obj);
        if (!string.IsNullOrEmpty(str))
            doc.LoadXml(str);
        return doc;
    }
    private static object __deserializeItem(Type propType, XmlNode node)
    {
        TypeConverter tc = TypeDescriptor.GetConverter(propType);
        if (tc != null && tc.CanConvertTo(typeof(string)) && tc.CanConvertFrom(typeof(string)))
        {
            return tc.ConvertFrom(node.InnerText);
        }
        else if (propType.IsArray)
        {
            if (propType.GetElementType() == typeof(object))
            {
                XmlNodeList nl = node.SelectNodes("item");
                Array tmp = Array.CreateInstance(typeof(object), nl.Count);
                for (int i = 0; i < nl.Count; i++)
                {
                    XmlNode p = nl[i];
                    Type _t = Type.GetType(p.Attributes["type"].Value);
                    if (_t == null)
                        tmp.SetValue(null, i);
                    else
                        tmp.SetValue(__deserializeItem(_t, p), i);
                }
                return tmp;
            }
            else
            {
                Type _t = propType.GetElementType();
                XmlNodeList nl = node.SelectNodes("item");
                Array tmp = Array.CreateInstance(_t, nl.Count);
                for (int i = 0; i < nl.Count; i++)
                {
                    XmlNode p = nl[i];
                    tmp.SetValue(__deserializeItem(_t, p), i);
                }
                return tmp;
            }
        }
        else if (propType.IsSerializable)
        {
            using (MemoryStream __ = new MemoryStream(Convert.FromBase64String(node.InnerText)))
            {
                BinaryFormatter bf = new BinaryFormatter();
                return bf.Deserialize(__);
            }
        }
        else if (propType.IsClass)
        {
            return __deserialize(node);
        }
        return null;
    }
    private static object __deserialize(XmlNode t)
    {
        try
        {
            object tmp = Activator.CreateInstance(Type.GetType(t.Attributes["type"].Value));
            XmlNodeList nl = t.SelectNodes("property");
            Type objType = tmp.GetType();
            foreach (XmlNode p in nl)
            {
                string name = p.Attributes["name"].Value;
                PropertyInfo pi = objType.GetProperty(name);
                Type propType = Type.GetType(p.Attributes["type"].Value);
                if (propType == pi.PropertyType)
                {
                    pi.SetValue(tmp, __deserializeItem(propType, p), null);
                }
            }
            return tmp;
        }
        catch
        {
        }
        return null;
    }
    public static object Deserialize(XmlDocument doc)
    {
        XmlNode nd = doc.SelectSingleNode("object");
        if (nd == null)
            throw new ArgumentOutOfRangeException();
        return __deserialize(nd);
    }
} 
```

**

```
Usage :
Serialize : TAObjectSerializer.Serialize(myClassInstance); //this returns as XmlDocument
Deserialize : TAObjectSerializer.Deserialize(myXmlDocument); //this returns as object instance 
```

**

如果属性未由**NonSerializedAttribute**属性标记，则此类将序列化**所有 READ_WRITE属性**

 *****祝你好运！***

# ruby-on-rails - Windows 上的 Ruby on Rails 不是基于 Java 的编辑器？

> ID：855662
> 
> 赞同：0
> 
> 时间：2009-05-13T01:25:38.353
> 
> 标签：ruby-on-rails, ide, editor

NetBeans 和 Aptana/RadRails 似乎是 Ruby on Rails 开发最常用的 IDE，但两者都需要 Java 运行时环境才能运行。

我正在寻找一个不需要 JRE 来运行的 IDE。如果它是轻量级的并且安装速度非常快会更好，因为我将在具有旧硬件和 Windows XP 的计算机上编程。

你知道任何？非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T01:30:45.657

也许[E](http://e-texteditor.com/)？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T01:27:17.287

[我是SciTE](http://www.scintilla.org/SciTE.html)和[命令行](http://guides.rubyonrails.org/command_line.html)的忠实粉丝。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T01:37:40.130

[Komodo Edit](http://www.activestate.com/komodo_edit/)是我用过的最好的 IDE 之一，它支持 Rails（尽管可能不如 Aptana/RadRails）。如果你有闲钱，我强烈推荐 Komodo IDE，因为它有一些很棒的额外功能，但如果没有，Komodo Edit 有你需要的一切。至于速度，启动速度很慢，但之后它与您使用的任何其他“轻量级”编辑器一样快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T01:44:50.093

实际上，我会说 Vim 与[rails.vim](http://www.vim.org/scripts/script.php?script_id=1567)搭配使用是最受欢迎的 Rails 编辑器之一。Vim、gVim 和 Cream 都可用于 Windows。

学习曲线非常陡峭，但值得。

此外，如果您正在做任何认真的 Rails 工作，那么在 Windows 上进行开发很糟糕。启动脚本/控制台或网络需要太长时间。Linux 上的工具要好得多。当我在我的 Windows 机器上做 Rails 工作时，我在 Ubuntu VM 上做。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T01:44:31.640

ruby-one-click for windows 自带的编辑器怎么样？它会起作用吗？（用红宝石写的那个）。

如果您喜欢冒险，还有 gvim 或 vim。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-13T01:53:20.040

[JetBrains RubyMine](http://www.jetbrains.com/ruby/index.html)

我没有使用这个程序，但是“[系统要求](http://www.jetbrains.com/ruby/download/index.html#win)”并没有说明 Windows 版本对 Java 运行时环境的要求。

# python - 当字段名称未知时，如何将文件上传到谷歌应用引擎应用程序

> ID：855667
> 
> 赞同：1
> 
> 时间：2009-05-13T01:28:16.410
> 
> 标签：python, google-app-engine

我尝试了一些选项，但似乎都不起作用（如果我有一个带有命名字段的简单多部分表单，它工作得很好，但是当我不知道名称时，我不能只获取请求中的所有文件...）。

我已经查看[了 Google App Engine 中的上传文件，](https://stackoverflow.com/questions/81451/upload-files-in-google-app-engine)它似乎不适合（或实际工作，因为有人提到代码在未经测试的情况下将其截断）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T10:15:41.140

查看有关[Webob 请求对象](http://pythonpaste.org/webob/reference.html#query-post-variables)的文档。文件上传被视为与其他表单字段相同，除了它们是文件上传对象，而不是字符串 - 因此您可以像任何其他 POST 一样迭代可用字段。

# c# - FormBorderStyle 在 Fixed 和 Sizable 之间的奇怪行为

> ID：855673
> 
> 赞同：1
> 
> 时间：2009-05-13T01:32:13.373
> 
> 标签：c#, .net, winforms, border

默认情况下，我使用 FormBorderStyle = FixedToolWindow 创建了一个简单的测试表单，并添加了一个按钮，该按钮将在按下鼠标时在 FixedToolWindow 和 SizableToolWindow 之间切换。

在这两者之间切换 FormBorderStyle 似乎会产生一种奇怪的效果，导致我的应用程序出现很多问题。问题是窗口似乎改变了大小，我不能。我只想更改边框，我需要表单大小保持不变。

例如，这是按钮代码：

```
private void button1_Click(object sender, System.EventArgs e) {
    if(FormBorderStyle == FormBorderStyle.FixedToolWindow) {
        System.Diagnostics.Debug.WriteLine("SWITCHING: FIXED -> SIZABLE");
        FormBorderStyle = FormBorderStyle.SizableToolWindow;
    } else {
        System.Diagnostics.Debug.WriteLine("SWITCHING: SIZABLE -> FIXED");
        FormBorderStyle = FormBorderStyle.FixedToolWindow;
    }
} 
```

并调试我使用这个：

```
private void Settings_SizeChanged(object sender, System.EventArgs e) {
    System.Diagnostics.Debug.WriteLine(this.Size);
} 
```

这是我按下开关按钮时的输出：

```
SWITCHING: FIXED -> SIZABLE
{Width=373, Height=169}
{Width=383, Height=179}
SWITCHING: SIZABLE -> FIXED
{Width=383, Height=179}
{Width=373, Height=169} 
```

我该如何解决这种行为？我所说的“修复”是指尽可能防止这种情况发生。无论边框样式的类型如何，我都希望能够指定我的表单大小并保持不变。

此外，如果有人想用这种方法解决这个问题，那么通过子类化 Form 类的解决方案对我来说是完美的解决方案。

**编辑：**
我制作了一个小视频来演示这个问题。第一个测试表明表单大小实际上并没有改变（视觉上），只是表单的位置发生了一点变化；但是 Size 属性的值确实发生了变化，正如您在调试输出中看到的那样。您将在调试输出中看到的第二个测试是表单 Size 属性值发生变化，并且窗口大小本身也会发生变化。

请看这里：
[http ://screencast.com/t/0vT1vCoyx2u](http://screencast.com/t/0vT1vCoyx2u)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T21:39:46.013

您的问题是位置更改，而不是大小。此代码解决了视频中看到的问题。

```
 private void Form1_DoubleClick(object sender, EventArgs e)
        {
            Point _location = this.PointToScreen(this.ClientRectangle.Location);
            if (this.FormBorderStyle == FormBorderStyle.SizableToolWindow)
            {
                this.FormBorderStyle = FormBorderStyle.FixedToolWindow;
            }
            else
            {
                this.FormBorderStyle = FormBorderStyle.SizableToolWindow;
            }
            Point _newloc = this.PointToScreen(this.ClientRectangle.Location);
            Size _diff = new Size(_newloc) - new Size(_location);
            this.Location -= _diff;
        } 
```

在我看来，在这两种边框样式之间切换时渲染表单移动的问题是 DWM 中的一个错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T01:41:15.080

我怀疑正在发生的事情是 Windows 窗体在边框大小发生变化时保持客户端大小（即内部区域）相同。这通常是一件好事，因为它确保窗口仍然可以正确地适合您放置的内容。

如果您想保持相同的外部尺寸，您可以通过在更改边框类型之前将大小保存到变量来解决它，然后将其恢复。不过，它们可能会轻微闪烁。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T02:12:52.730

这对我来说很好：

```
 private Size _size;
    private void Form1_DoubleClick(object sender, EventArgs e)
    {
        _size = this.Size;
        if (this.FormBorderStyle == FormBorderStyle.SizableToolWindow)
        {
            this.FormBorderStyle = FormBorderStyle.FixedToolWindow;
        }
        else
        {
            this.FormBorderStyle = FormBorderStyle.SizableToolWindow;
        }
        this.Size = _size;
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-17T19:40:56.617

我有同样的问题。当您设置 FormBorderStyle 时，客户端大小会发生变化，但它似乎没有立即放入 clientrectangle 属性中。上面列出的代码几乎对我有用，但不仅仅是存储大小，请确保存储客户大小。当然，在上面的例子中，“this”可能是对客户大小的引用——我不确定。无论如何购买，这对我有用：

_frmFilter.Height = 300 Dim _size As Size = .ClientSize _frmFilter.FormBorderStyle = FormBorderStyle.FixedToolWindow _frmFilter.ClientSize = _size

# entity-framework - 有人在生产中使用实体框架吗？

> ID：855674
> 
> 赞同：4
> 
> 时间：2009-05-13T01:33:28.380
> 
> 标签：entity-framework, production

我想听听在生产中使用 EF 或做出有效尝试的人的意见。

我在此站点上看到了[何时不使用实体框架](https://stackoverflow.com/questions/517600/when-not-to-use-the-entity-framework)问题。我还阅读[了不信任投票](http://efvote.wufoo.com/forms/ado-net-entity-framework-vote-of-no-confidence/)。如果您使用 Entity Framework 并决定不使用它，我不想收到您的来信。

我知道 EF 不像 NHibernate 或其他一些框架那样成熟。不幸的是，在我的公司，做决定的人不想使用开源项目。不要问我为什么，因为我想自己知道。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T06:08:25.037

绝对地。

这周我在 TechEd，在 Entity Framework 展台上花了很多时间，我有很多人在愤怒中使用 EF 来向我寻求帮助和建议。

亚历克斯

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T12:08:23.967

是的，我们在生产中使用它。V1 在现场，V2 在路上。到目前为止，它对我们来说非常有效。您还有其他问题吗？

# c# - SqlDataReader 是否将所有内容都存储为字符串？

> ID：855676
> 
> 赞同：1
> 
> 时间：2009-05-13T01:33:33.293
> 
> 标签：c#, sql

我正在尝试使用 SqlDataReader 提取数据，其中一列在日期时间中。我想做这样的事情

```
SqlCommand command = new SqlCommand("SELECT * FROM table", connection); //connection is defined earlier
        SqlDataReader data = command.ExecuteReader();
        while(data.Read()){
             DateTime birthday = data["Birth"];
             list.Add(birthday);
        }
    } 
```

我可以这样做吗？还是 SqlDataReader 返回字符串，在这种情况下我必须使用该字符串创建一个新的 DateTime 对象？

谢谢，-S

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-13T01:36:57.980

SqlDataReader 将数据作为强类型对象返回 - 只需调用正确的方法，例如：

data.GetDateTime（序数）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-13T01:37:23.797

你要：

```
DateTime birthday = data.GetDateTime(data.GetOrdinal("Birth")); 
```

SqlDataReader 有[一大堆](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldatareader_methods.aspx)强类型的 Get*() 方法。

# ruby - 有没有更好的方法来查找数组中最小元素的位置？

> ID：855693
> 
> 赞同：3
> 
> 时间：2009-05-13T01:41:09.293
> 
> 标签：ruby, arrays, max

现在我有

```
def min(array,starting,ending)
  minimum = starting
  for i in starting+1 ..ending
    if array[i]<array[minimum]
      minimum = i
    end    
  end

return minimum
end 
```

Ruby 中有更好的“实现”吗？这个看起来仍然很c-ish。谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T02:42:08.460

如果你想找到最小元素的索引，你可以使用`Enumerable#enum_for`获取一个 items-index 对的数组，并找到其中的最小值`Enumerable#min`（这也将是原始数组的最小值）。

```
% irb
irb> require 'enumerator'
#=> true
irb> array = %w{ the quick brown fox jumped over the lazy dog }
#=> ["the", "quick", "brown", "fox", "jumped", "over", "the", "lazy", "dog"]
irb> array.enum_for(:each_with_index).min
#=> ["brown", 2] 
```

如果要将其绑定到特定的数组索引：

```
irb> start = 3
#=> 3
irb> stop = 7
#=> 7
irb> array[start..stop].enum_for(:each_with_index).min
#=> ["fox", 0]
irb> array[start..stop].enum_for(:each_with_index).min.last + start
#=> 3 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T01:57:34.867

基本上这是你能做的最好的，虽然你可以写得更简洁一点：

```
def minval(arr)
    arr.inject {|acc,x| (acc && acc < x ? acc : x)}
end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-07T15:43:06.157

有一种更简单的方法，它适用于 ruby​​ 1.9.2：

```
a = [6, 9, 5, 3, 0, 6]
a.find_index a.min 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T01:43:22.033

这是在数组中查找最小元素的标准算法，在调用此函数之前已经对数组进行排序会更好。

否则我找不到更有效的方法来做到这一点。具体来说，大 O 表示法中的线性时间是我们能做的最好的。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-13T01:56:29.567

如果这不仅仅是一个学术问题，为什么不直接使用 Ruby 的原生`sort`方法呢？它是使用快速排序算法实现的，被认为非常快。

```
a = [3, 4, 5, 1, 7, 5]
a.sort![0] # => 1 
```

# cygwin - 在 Cygwin 中运行 XWindow 程序

> ID：855697
> 
> 赞同：3
> 
> 时间：2009-05-13T01:44:22.483
> 
> 标签：cygwin, x11

我安装了在 Cygwin 中运行 GUI 程序所需的所有软件包。

现在，我必须做这些事情来启动一个 XWindow 程序：

1) /bin/startxwin.sh
2) 它启动一个单独的窗口（X 窗口？）
2) 在那个 X 窗口中，ssh -X user@server（这是我要运行该框的程序的远程框）
3 ) 然后在那个 X Window 中，我可以启动像“xclock”这样的 GUI 程序。

我的问题是，我可以直接在我原来的 Cygwin 窗口下执行 ssh -X user@server 并直接启动 GUI 程序，而不是启动一个单独的 X 窗口并在那里执行吗？

任何指示表示赞赏！！！！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T01:52:54.300

如果你想要一个漂亮的 GUI，AFAIK 你需要一个 X 服务器来显示来自远程“X 客户端”的图形。

如果您担心手动启动 X 服务器（？），您仍然可以在启动时启动您的 X 服务器。在我的工作桌面上，我会亲自执行此操作（虽然它不使用 Cygwin 提供的 X 服务器，而是使用商业服务器）。

* * *

编辑：根据整个评论，您必须尝试： export DISPLAY=xxx:0.0 ， xxx 是您托管 x 服务器的机器的 IP 地址，并将其添加到您的 .profile 文件（或 .bashrc 文件应该没问题，但我记得 .profile 更适合那种东西，但我可能错了..）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T01:51:59.247

不，您必须启动 X Window 服务器（运行 startxwin.sh）。“ssh -X”实际上不是必需的。您可以设置环境变量，如

导出显示=Cygwin:0.0

在正常的 cygwin 窗口中，然后直接启动 GUI 程序。

# sql - 向我介绍 Oracle PL/SQL 扩展

> ID：855702
> 
> 赞同：0
> 
> 时间：2009-05-13T01:46:06.503
> 
> 标签：sql, oracle, plsql

我是一个熟练的 SQL 用户；我有信心在 ANSI-SQL 中为 Sybase、MS SQL Server、MySQL 或 postgresql 创建模式和优化查询。我了解连接、子查询、索引等，所以我不需要概括任何在 Oracle 下没有什么不同的东西。

我将从事需要使用 Oracle 的工作。向我指出不是作为“Oracle SQL 简介”而是为已经了解 SQL 的人解释“PL/SQL”的**在线资源。**

我对以下内容特别感兴趣：PL/SQL 扩展简明指南和优化 Oracle 查询。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T02:39:40.040

[Oracle® Database PL/SQL 用户指南和参考 (10g)](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14261/toc.htm) 真的，您还想要什么？

如果您是 Oracle 新手，我还建议您花点时间学习它的事务模型，因为它与 SQL Server 略有不同，可能会咬到您。[这](http://www.oracle.com/technology/oramag/oracle/05-nov/o65asktom.html)是一篇很好的文章。另一位建议阅读 Kyte 的海报是正确的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T07:10:51.723

您应该知道 PL/SQL 是一种或多或少完整的编程语言。像我这样疯狂的人创建应用程序，其中大部分工作在服务器上的 PL/SQL 包中完成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T05:12:33.787

[asktom.oracle.com](http://asktom.oracle.com)对浏览很有用。

我建议您研究以下强大的功能：-

*   解析函数
*   物化视图
*   流水线 PL/SQL 函数

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T06:39:26.750

阅读概念：http: [//download.oracle.com/docs/cd/B28359_01/server.111/b28318/toc.htm](http://download.oracle.com/docs/cd/B28359_01/server.111/b28318/toc.htm)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T11:37:50.383

阅读 Steve Feuerstein 的文章和书籍，他是 PL/SQL 的主要传播者之一。

专注于他们的 PL/SQL 数据结构，如游标、关联数组、表（PL/SQL 不是 SQL）等。

使用谷歌搜索 Oracle 代码时要记住的一件事是，您遇到的旧代码比新代码要多得多。尝试学习新的而不是旧的。

例如，循环查询的旧方法是创建一个游标，然后对其执行 while 循环，直到它不返回任何内容。现在你可以隐式地创建一个这样的循环：

```
FOR Test IN (Select Ct from TableCT) LOOP
 Sum := Sum + Test.Ct;
结束循环；

```

要优化查询，请获取 SQL Developer 并运行解释计划。可能需要一段时间才能理解，但这是我发现的最好方法。此外，如果您还没有遇到它，WITH 子句可以为优化查询创造奇迹。

# iphone - iTunesArtwork 和 XCode

> ID：855707
> 
> 赞同：21
> 
> 时间：2009-05-13T01:50:51.950
> 
> 标签：iphone, xcode

我正在尝试将 iTunesArtwork 文件添加到我的 iPhone 应用程序中，以遵循 iTunes 图标/艺术品的指南。我已将符合 iTunesArtwork 要求 (512x512 JPG) 的文件添加到我的项目中。一旦我这样做了，我就不能再在我的设备上安装应用程序了。我不断收到此错误：

> 您的移动设备遇到意外错误 (0xE8000058)
> 
> iTunesArtworkCapture 失败

有没有人有解决这个问题的经验？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-05-13T04:08:55.530

在临时构建的情况下，我在以下方面取得了一些成功：

*   为要在 iTunes 中显示的图标/艺术品创建 512x512 png。
*   将文件重命名为**iTunesArtwork**（没有扩展名和大写）并将其放在您的应用程序根文件夹中，然后将其添加到 xcode 中应用程序资源的顶层。
*   为您要部署到的设备版本重新构建发布中的应用程序

我已经使用临时构建进行了这项工作，但老实说，我把它拿出来是因为它在我进行预配置发布构建时工作，并导致当我进行调试构建并尝试在模拟器上运行时出现错误。对我来说，从项目中添加和删除文件是不值得的。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-05-13T03:08:16.970

我很确定该文件需要是 .png 而不是 .jpg？

尝试删除文件，进行清理，然后将文件重新添加为 iTunesArtwork

顺便说一句，您不需要该文件 - 只是为了让 Adhoc 发行版在 iTunes 中显示图标 - App Store 应用程序不需要它。他们从 57x57 图标和您上传到 iTunesConnect 的 512 图像的组合中获取图标。

# compiler-construction - 设计一种使用空格而不是符号来对代码进行分组的语言会更好吗？

> ID：855714
> 
> 赞同：0
> 
> 时间：2009-05-13T01:54:08.977
> 
> 标签：compiler-construction

我发现自己设计了一种有趣的语言，它是 Ruby 和 Java 的交叉语言，当我在编译器/解释器上工作时，我发现自己在思考使用空格作为终止符，例如：

```
class myClass extends baseClass
    function someFunction(arg)
       value eq firstValue 
       value2 eq anotherValue
    x = 2 
```

另一种方法是使用符号或单词作为终止符，如 JavaScript 的“;” 和 Ruby 的“结束”。

```
function myFunction(arg){
   value = someVal;
} 
```

今天似乎首选 Python 之类的语言，我想看看 StackOverflow 社区对旧式语法的看法。为旧样式语法编写解析器似乎要容易得多，那么坚持 Java / JavaScript 样式会更好吗？如果是，为什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T16:50:08.373

由于这是一个非常主观的问题，而且有很多风格，这是我的口味：

“{}”JS 样式或“End Function”、“end”块的 VB 样式。除了令人讨厌的空白之外，做任何事情，阅读代码真的很困难。在我的书中，空白或制表符作为特殊含义是错误的。

不要使用特殊的终止符，我认为新行非常好。您应该考虑“哪种情况是例外？”。在每一行的末尾添加一个额外的字符没有多大意义，例外是将多个语句放在一行中。

所以使用“;” 作为分隔符来支持一行中的多个语句，但默认情况下不需要它。那将是我的选择。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T02:32:33.347

鉴于任何两个人都可能不同意和同意使代码可读的空格和缩进的数量，我建议空格是上下文分隔符的糟糕选择。我会让语言在空格方面灵活，而不是让空格的数量和位置来推断代码组织。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T01:55:29.490

从根本上说，使用空格来格式化代码并没有错。但老实说，真的有**一种**最好的格式化代码的方法吗？*为什么不让代码格式化程序来提出强制样式呢？*

有趣的是，近 20 年来，由于缺乏灵活性和平凡的编码结构（pascal、cobol），人们一直反对“束缚和纪律语言”，但我们已经看到它们在 Java 和 Python 等语言中重新出现。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T16:56:50.063

[在 .NET Rocks show #338](http://www.dotnetrocks.com/default.aspx?showNum=0338)中，讨论“伟大 UI 的科学”，[Mark Miller 强调](http://www.dotnetrocks.com/text/0338/index9.html)了“[最小有效差异](http://theeditorialadvantage.com/?p=173)”的原则。（在[这篇博文](http://community.devexpress.com/blogs/markmiller/archive/2009/02/11/great-ui-clarity-and-information-relevance.aspx)中说明。）

这意味着通过添加不必要的对比度，您正在增加您必须处理的“噪音”级别。正如我所看到的，从“用户界面”的角度来看，这意味着使用符号对代码进行分组而不是空格表示噪声水平的增加。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-13T17:23:42.003

我看到很多很好的答案。让我再添一个皱纹。

当我编写代码时，这似乎是一个主观问题。

但是，如果我正在编写一个编写代码的*程序*，这可能会产生很大的影响。

过去，我不得不编写代码生成器来生成 Fortran 77、C 和 C++。

Fortran 77 每行只允许一个语句，行长 72 个字符，前 6 列保留，注释在第 1 列以“c”开头，续行在第 6 列用字符标记，等等。

您无法相信我多么喜欢生成 C 或 C++，其中空格是一个选择问题，而不是强制问题。

补充：另外，我认为预处理器宏在某些阵营中不受欢迎，但如果空格有意义，它们将受到严重限制。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-13T02:37:09.500

除了 Flamewars，我更喜欢使用符号的语言，因为它们使代码更具可读性并且更易于维护。大括号的视觉分隔是一个受欢迎的信息分隔符，并且如果大括号不匹配，则在某些内容无法编译时更容易发现错误，一行代码没有以分号结束，等等。VB 是一种非常烦人的语言，因为您必须在代码中明确换行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-13T17:01:49.183

空白/缩进通常是一种风格。正如其他人所提到的，作为 3 个人，你应该使用什么间距，你会得到 4 个答案。我肯定更喜欢一种语言结构（即：{} 或 BEGIN/END）。

同样，不同的编辑器可能定义了不同的 TABS。您可以在编辑器中编辑代码，将 TABS 设置为 3，并且代码看起来不错。我可以在我的编辑器中编辑它，将 TABS 设置为 8，并且不理解代码。这将代码限制为只能使用特定工具进行编辑，或者使设置其他工具以进行快速更改变得痛苦。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-13T02:39:15.330

一致的缩进和分界符号（例如大括号）都不能完全替代另一个。我个人的偏好是两者兼得。

也就是说，可选的缩进确实使单行更容易（我认为）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-13T16:36:49.300

Scala有这个，如果它在语法上变得正确，则在 aline 的末尾推断一个分号。我不喜欢它，因为它迫使我将块的左大括号放在前一行的末尾。

在 Python 中，我在重组大块代码时遇到了问题，因为很容易弄乱缩进并丢失块结构。

# asp.net - visual studio 2008 / asp.net web forms - 80% 的时间手动编码是否太多？

> ID：855715
> 
> 赞同：1
> 
> 时间：2009-05-13T01:55:16.307
> 
> 标签：asp.net, visual-studio, ide, webforms

我仍然发现自己对 Visual Studio 项目进行手工编码，而不是使用各种 UI 驱动的菜单和对话框。例如：

*   Web 项目：源视图中的手动代码 html/css 与处理设计视图/属性窗口
*   清除类文件：使用诸如 prop-TAB-TAB Create Property 键盘快捷键和良好的 ole Ctrl+[X|C|V] 之类的东西手动编写代码，而不是使用类图功能

我是否需要再给对话框和菜单一个镜头，或者这是 IDE 的当前状态？Intellisense 是自切片面包 IMO 以来最好的东西。

史蒂夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T02:21:10.747

我很乐意让 Microsoft 从 Visual Studio 中删除设计视图。每次我不小心按下按钮并等待损坏的渲染引擎启动时，我都会发现自己在诅咒它。这是从 Web 开发人员的角度来看的，请注意 - 我确信这对于开发 Windows 应用程序至关重要。

一般来说，我认为大多数 RAD 工具并不是特别有用，而且从长远来看，由于它们不是很灵活，因此最终会出现问题。在开发 web 表单 asp.net 应用程序时，列表视图和转发器通常是我使用的唯一控件。无论如何，手工编码 html/css 将是大多数设计师的首选。Dreamweaver 之类的工具最初在您学习时很不错，但您确实会意识到您正在将它们用作美化的文本编辑器。

正如您提到的那样，Intellisense 非常糟糕，如果我切换到 e 或 Textmate 之类的东西，我会错过的一件事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T02:02:51.347

我不是 .NET 程序员，而且我知道 Visual Studio 确实提供了很多漂亮的代码生成工具。但是，我认为开发人员了解其应用程序中的代码是相当重要的。如果你觉得手动编码很舒服，因为你觉得这样更有控制力，我认为这根本不应该打扰你。

此外，作为一个手工编写大量 HTML/CSS 的人，我知道 Visual Studio 的设计视图在很多时候都不会产生“高质量”的前端代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T01:59:23.367

我个人 99% 的时间都在编写 html/css 代码以及我的类定义。例外是很难手动编码的东西（有人手动编码 WCF 代理吗？）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T02:01:13.987

都是关于你的。是什么让你更有效率。是什么让你有更多的场景。

了解和学习实现目标的替代方法是件好事。您可以尝试一下，但如果它减慢您的速度，请返回您过去编码的方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T02:02:47.057

我当然发现 UI 设计师只适用于最简单的页面，甚至只适用于一些设计迭代。我发现这有两个原因

1）布局页面时，通常有几个合法的选择，我不喜欢VS做出的选择。例如，它将使用像素大小设置表格的宽度，而对于大多数流动页面来说，百分比更有意义。它的作用没有错，但无论出于何种原因，我发现自己经常与它作斗争。

2) 它对大量样式信息进行硬编码，甚至在页内样式表中创建合成样式。我宁愿为整个网站提供一个简洁而全面的 CSS，最大限度地减少每个页面（或每个元素！）上的覆盖。再说一次，我经常和它打架。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-13T02:03:13.890

WPF/Silverlight 的设计器使用起来非常麻烦。所以我几乎手动编写了 xaml 和 C# 代码。目前我没有做太多的 asp 但使用 MVC，我会假设我会手动编写代码。

随着 Visual Studio 现在对许多不同的语法具有智能感知功能，编写代码比以往任何时候都更容易，嗯，代码。:) 我的意思是智能感知适用于 C#、CSS、javascript、asp 和 XML（如果设置正确）。现在编码很容易。现在的年轻人过得很轻松。他们不知道当时编码有多难。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-13T02:03:36.743

我绝对会说，100% 取决于你在写什么。

*   如果它是简单数据库的基本 CRUD 接口，那么我会说是的，80% 太多了。

*   如果它是一个有大量 JQuery UI 并且没有持久数据源的 Web 应用程序，那么 80% 可能比我预期的要少。

正如 Vadium 所说，这还取决于是什么让你更有效率。就个人而言，我与 Intellisense 一起飞行，但我不太擅长使用 UI 工具来构建应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-13T02:48:55.373

我总是觉得使用 Visual Studio 比较笨，但我必须在本世纪的某个时候完成我的项目才能获得报酬。

# flash - 在不使用跟踪的情况下，如何判断 Flash 应用程序是否在容器中？

> ID：855730
> 
> 赞同：0
> 
> 时间：2009-05-13T02:02:46.400
> 
> 标签：flash, trace, externalinterface

我正在尝试确定我的 Flash 内容是否在容器内。我不知道这意味着什么，但显然它不利于进行 ExternalInterface.calls。我正在运行服务器的 Linux 机器上开发站点，并且正在 Windows 机器上使用闪存。我尝试了许多使用跟踪的选项，但都没有奏效。有什么方法可以查看 ExternalInterface 是否可用，而无需使用跟踪？当前代码在这里：[http](http://pastebin.com/f5fe9a985) ://pastebin.com/f5fe9a985我在这个主题上发表的另一篇文章在这里： [firefox、linux 中的 Flash 跟踪输出](https://stackoverflow.com/questions/825316/flash-trace-output-in-firefox-linux)

谢谢，丹

此外，动作脚本是 2.0，如果有帮助的话......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-28T17:00:51.840

您真的应该花一个下午的时间阅读有关 Flash Player 安全性和 JavaScript 内容的文档。我认为它真的会帮助你理解这一切是如何运作的。

您的 q 需要一些澄清：

你说你在你的 linux 机器上运行服务器，但你的 swf 在 windows 机器上？你能解释一下那个设置吗？（它们是 linux 还是 windows 无关紧要，只关心它们从哪个域（或本地机器名称）提供服务。

如果你的本地机器是[http://localhost](http://localhost)

你的 Windows 机器是 http://mywindowsbox/

那么您需要通过在嵌入代码中添加 allowscriptaccess=always 来允许访问嵌入 swf 的 html 页面。

# jquery - JQuery：如何在 $(this) 中找到名为“apples”的输入？

> ID：855737
> 
> 赞同：1
> 
> 时间：2009-05-13T02:03:40.487
> 
> 标签：jquery, css-selectors

我正在学习 JQuery，并发现带有选择器的工厂函数 $() 非常有用。但是，我无法弄清楚如何在我命名为变量的特定元素中进行选择。例如：

```
var thisDiv = $("#myDiv");

// thisDiv looks like this:
<div id="myDiv">
<input id="apples" />
<input id="bananas" />
</div> 
```

仅给定 JQuery 中的变量 thisDiv，我将如何选择 id="apples" 的输入？谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T02:06:46.503

```
$("#thisDiv #apples") 
```

但你也可以这样做：

```
thisDiv.find("#apples"); // use find method 
```

并且：

```
$("#apples", thisDiv); // provide context 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T02:06:39.920

你可以试试这个

```
thisDiv.find('#apples'); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T02:06:54.817

您应该可以通过在您的 div 中搜索来选择它，例如：

```
 $("#myDiv").find("#apples") 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T02:07:47.733

```
$('#apples', thisDiv); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T02:14:55.940

也许您的只是一个示例，并不代表正确的代码，但值得一提的是，每个文档的 ID 都是唯一的，因此您并不特别需要上下文。

```
$('#apples');
$('#apples', thisDiv);  // same result, more lookups 
```

如果这只是一个示例，并且您想知道如何使用任何选择器查找任何元素，那么是的，这里的其他答案都是正确的。

```
thisDiv.find('li.myClass'); // or,
$('li.myClass', thisDiv); 
```

# vb.net - InsertOnSubmit = 无法使用已在使用的键添加实体

> ID：855738
> 
> 赞同：4
> 
> 时间：2009-05-13T02:05:19.890
> 
> 标签：vb.net, linq-to-sql

我正在尝试使用 Linq 将记录插入到表中，但得到可怕的***无法添加带有已在使用中的键的实体***错误

```
'If the same data exists for the same patient in a record less that 21 days old then drop it
Dim RecordLookup As Integer = 0
RecordLookup = (From rc In CDEvodb.RISKCHANGEs _
    Where rc.NHI = tmpNHI And _
    rc.RECDATE > Date.Now.AddDays(-21) And _
    rc.BPSYS = Convert.ToDecimal(Drow.Item("BPSYS")) And _
    rc.CHOL = Convert.ToDecimal(Drow.Item("CHOL")) And _
    rc.HDL = Convert.ToDecimal(Drow.Item("HDL"))).Count()
If (RecordLookup = 0) Then
Dim riskchange As New RISKCHANGE
    riskchange.NHI = Drow.Item("NHI")
    riskchange.RECDATE = Date.Now.Date()
    riskchange.RISK = CalculatedRisk
    riskchange.BPSYS = Drow.Item("BPSYS")
    riskchange.CHOL = Drow.Item("CHOL")
    riskchange.HDL = Drow.Item("HDL")

    Try
        CDEvodb.RISKCHANGEs.InsertOnSubmit(riskchange)
    Catch ex As Exception
        myLogging.OutputError("<" & DateTime.Now.ToString & "> " & "Error - creating risk change record in dataset for patient " & Drow.Item("NHI").ToString() & " - " & ex.Message)
    End Try

End If 
```

基本上，我在表上查找不到 21 天的匹配记录（不包括身份字段）。如果找不到，我会创建一个行的实例并设置为插入它。

SubmitChanges 函数被调用了几行。

Drow 是来自先前使用 SQLClient 连接填充的数据集的 DataRow（原因是我还没有完全转换到 Linq，现在只是做新功能）。

提前喝彩。

* * *

这是表的创建脚本：

```
USE [CDEvolution] 
```

去

/****** 对象：表 [dbo].[RISKCHANGES] 脚本日期：05/13/2009 14:40:15 ******/

设置 ANSI_NULLS ON

去

设置 QUOTED_IDENTIFIER ON

去

设置 ANSI_PADDING ON

去

创建表 [dbo].[RISKCHANGES](

```
[NHI] [varchar](7) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,

[RECDATE] [datetime] NOT NULL,

[RISK] [numeric](15, 0) NOT NULL,

[BPSYS] [numeric](15, 0) NOT NULL,

[CHOL] [numeric](15, 1) NOT NULL,

[HDL] [numeric](15, 1) NOT NULL,

[POSTED] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,

[IDENTITY] [uniqueidentifier] NOT NULL CONSTRAINT [DF_RISKCHANGES_IDENTITY] 
```

默认 (newid()),

约束 [PK_RISKCHANGES] 主键集群

(

```
[IDENTITY] ASC 
```

)WITH (PAD_INDEX = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]

) 开 [主要]

去

设置 ANSI_PADDING 关闭

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T03:49:45.983

如果您更新 DBML，请将其 ( **IsDbGenerated="true"** ) 添加到 PK 成员：

```
 <Column Name="[IDENTITY]" Member="IDENTITY" Type="System.Guid" 
            DbType="UniqueIdentifier NOT NULL" IsPrimaryKey="true" 
            CanBeNull="false" IsDbGenerated="true"/> 
```

它将让 SQL 分配默认值 (newid())。

否则，它将发送未初始化的 guid ('00000000-0000-0000-0000-000000000000')，据我所知，这基本上是导致问题的原因。

您的另一个选择可能是扩展部分类并在 OnCreated() 事件中初始化 GUID（它不使用列的 newid() 默认值，但确实解决了问题：

```
 partial class RISKCHANGE
    {
        partial void OnCreated()
        {
            _IDENTITY = Guid.NewGuid();
        }
    } 
```

*请注意，对于现有实体（由查询填充），在处理 OnLoaded() 时，该值将被正确的值覆盖。*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T02:11:41.813

嘿凯文，快速的问题，可能是愚蠢的，但只是为了得到一个更好的主意......

您在新的 riskchange 对象上设置的任何属性是主键属性吗？

另外，在调用 SubmitChanges() 之前你还做了什么？

干杯

**编辑：**

谢谢凯文。这条线在这里发生了什么？：

```
[IDENTITY] [uniqueidentifier] NOT NULL CONSTRAINT [DF_RISKCHANGES_IDENTITY] 
```

你对PK有什么样的限制……？为什么它看起来不像这样：

```
[IDENTITY] [int] IDENTITY(1,1) NOT NULL 
```

?

**编辑** 嘿凯文。我认为问题在于您没有将 PK 设置为身份说明符，因此，它不会自动增加 P​​K。

要解决此问题，请通过更改此行重新创建表：

```
[IDENTITY] [uniqueidentifier] NOT NULL CONSTRAINT [DF_RISKCHANGES_IDENTITY] 
```

对此：

```
[IDENTITY] [int] IDENTITY(1,1) NOT NULL 
```

或者，如果您使用 Mangement Studio，只需进入该表的设计。转到该字段的属性，然后在属性窗口（通常出现在下面）中将“身份规范”（Is Identity）设置为“是”。

**不要忘记更新您的 LINQ 2 SQL DBML**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T02:13:33.477

你的主键是什么？你还有其他的键/约束吗？它可能是导致问题的原因之一。我建议扩大匹配记录的搜索范围，或更改您的约束条件。

# html - 文本区域中的字体一致性

> ID：855745
> 
> 赞同：20
> 
> 时间：2009-05-13T02:08:51.147
> 
> 标签：html, css, fonts, textarea

如何使 textarea 具有与网页上其他所有内容相同的字体？

目前我有我的代码：

`test.html`：

```
 <html>
      <head>
        <link rel="stylesheet" href="test.css">
      </head>
    <body>
        <div id="testarea">
          <textarea></textarea>
        </div>
    </body>
    </html> 
```

`test.css`：

```
 body { font: 100%/120% Verdana, Arial, Helvetica, sans-serif;}
    #testarea textarea { width: 30em;height: 7em;font: inherit;} 
```

字体在 Mozilla 中继承，但 IE7 将 Courier 保留在 textarea 中。

UPD：显然`inherit`在 IE 中对于 textarea 不起作用，所以我将使用 AlbertoPL 的方法。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-13T02:19:11.827

只需创建一个 textarea 元素并在那里定义您的字体元素。

```
textarea { font: 100%/120% Verdana, Arial, Helvetica, sans-serif;} 
```

您可以将其移出 body 元素。

如果您不想使用`*`.

# flash - AS3：使用 StyleManager 类设置 TextField 的默认字体、颜色等

> ID：855746
> 
> 赞同：1
> 
> 时间：2009-05-13T02:09:18.807
> 
> 标签：flash, actionscript-3, styles, textfield

我试图让 StyleManager 产生一些效果，但无济于事。

```
package {
  import flash.text.*;
  import flash.display.Sprite;
  import fl.managers.StyleManager;

  public class StyleManagerExample extends Sprite {

    public function StyleManagerExample():void {

      StyleManager.setComponentStyle(TextField, "selectable", false);

      var exampleTextField:TextField = new TextField();
      exampleTextField.text = "Something";

      addChild(exampleTextField);

    }

  }
} 
```

没有任何值（例如`selectable`、`color`、`textFormat`等、使用`setStyle`或`setComponentStyle`其他）似乎对结果有任何影响。

我错过了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T05:22:16.393

抱歉，StyleManager 只影响组件（fl.controls 包中的 IE 类），不能用于更改 TextField 类实例的样式或设置。

还有其他方法（某种）可以做你想做的事情。例如，如果您想使用文本字段但不想为每个实例更改一堆设置，您可以子类化 TextField 类并在构造函数中更改一堆设置，然后在任何地方都使用您的 TextField 子类的文本字段。

希望这会有所帮助，祝你好运。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-18T11:57:31.333

如果您想影响 textField 的文本颜色。你可以这样做

```
myTextfield.textColor = "0xFF0000"; 
```

我希望这会有所帮助。

# jquery - Jquery asp.net 按钮单击事件通过 ajax

> ID：855747
> 
> 赞同：34
> 
> 时间：2009-05-13T02:10:11.673
> 
> 标签：jquery, asp.net, ajax, events

我想知道是否有人可以指出我正确的方向。我有一个带有单击事件的 asp.net 按钮（运行一些服务器端代码）。我想做的是通过 ajax 和 jquery 调用这个事件。有没有办法做到这一点？如果是这样，我会喜欢一些例子。

提前致谢

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-05-13T02:18:23.513

这就是 jQuery 真正让 ASP.Net 开发人员大放异彩的地方。假设您有这个 ASP 按钮：

当它呈现时，您可以查看页面的源代码，它上面的 id 不会是 btnAwesome，而是 $ctr001_btnAwesome 或类似的东西。这使得在 javascript 中查找变得很痛苦。输入 jQuery。

```
$(文档).ready(函数() {
  $("input[id$='btnAwesome']").click(function() {
    // 做客户端按钮点击这里的东西。
  });
});

```

id$= 正在为以 btnAwesome 结尾的 id 进行正则表达式匹配。

编辑：

您是否希望从客户端的按钮单击事件中调用 ajax 调用？你想打什么电话？有很多关于使用 jQuery 对方法背后的 ASP.Net 代码进行 ajax 调用的非常好的文章。

它的要点是您创建一个标有 WebMethod 属性的**静态方法。**然后，您可以使用 $.ajax 使用 jQuery 调用它。

```
$.ajax({
  类型：“发布”，
  url: "PageName.aspx/MethodName",
  数据： ”{}”，
  contentType: "应用程序/json; charset=utf-8",
  数据类型：“json”，
  成功：功能（味精）{
    // 在这里做一些有趣的事情。
  }
});

```

我从以下网址学到了我的 WebMethod 东西：[http ://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/](http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/)

那里有很多非常好的 ASP.Net/jQuery 东西。确保您阅读了为什么必须在返回 .Net 3.5（可能是从 3.0 起）的东西中使用 msg.d。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-13T02:27:37.973

我喜欢 Gromer 的回答，但它给我留下了一个问题：如果我在不同的控件中有多个 'btnAwesome' 怎么办？

为了满足这种可能性，我将执行以下操作：

```
$(document).ready(function() {
  $('#<%=myButton.ClientID %>').click(function() {
    // Do client side button click stuff here.
  });
}); 
```

这不是正则表达式匹配，但在我看来，这里不需要正则表达式匹配。如果你引用一个特定的按钮，你需要一个精确的文本匹配，比如这样。

但是，如果您想对每个 btnAwesome 执行相同的操作，请选择 Gromer 的答案。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-13T02:49:49.363

ASP.NET Web 表单页面已经有一个名为“__doPostBack”的用于处理 PostBacks 的 JavaScript 方法。

```
function __doPostBack(eventTarget, eventArgument) {
    if (!theForm.onsubmit || (theForm.onsubmit() != false)) {
        theForm.__EVENTTARGET.value = eventTarget;
        theForm.__EVENTARGUMENT.value = eventArgument;
        theForm.submit();
    }
} 
```

在您的代码文件中使用以下内容来生成执行 PostBack 的 JavaScript。使用此方法将确保使用控件的正确 ClientID。

```
protected string GetLoginPostBack()
{
    return Page.ClientScript.GetPostBackEventReference(btnLogin, string.Empty);
} 
```

然后在 ASPX 页面中添加一个 javascript 块。

```
<script language="javascript">
function btnLogin_Click() {
  <%= GetLoginPostBack() %>;
}
</script> 
```

最终的 javascript 将像这样呈现。

```
<script language="javascript">
function btnLogin_Click() {
  __doPostBack('btnLogin','');
}
</script> 
```

现在您可以使用 javascript 中的“btnLogin_Click()”将按钮点击提交给服务器。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-13T02:24:10.163

在客户端处理按钮的点击事件，使用ClientID属性获取按钮的id：

```
$(document).ready(function() {
$("#<%=myButton.ClientID %>,#<%=muSecondButton.ClientID%>").click(

    function() {
     $.get("/myPage.aspx",{id:$(this).attr('id')},function(data) {
       // do something with the data
     return false;
     }
    });
 }); 
```

在服务器上的页面中：

```
protected void Page_Load(object sender,EventArgs e) {
 // check if it is an ajax request
 if (Request.Headers["X-Requested-With"] == "XMLHttpRequest") {
  if (Request.QueryString["id"]==myButton.ClientID) {
    // call the click event handler of the myButton here
    Response.End();
  }
  if (Request.QueryString["id"]==mySecondButton.ClientID) {
    // call the click event handler of the mySecondButton here
    Response.End();
  }
 }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-06-23T16:42:07.347

我发现自己想要这样做，我查看了上述答案并采用了混合方法。它有点棘手，但这是我所做的：

我的按钮已经与服务器端帖子一起使用。我想让它继续工作，所以我让“OnClick”保持不变，但添加了一个 OnClientClick：

```
OnClientClick="if (!OnClick_Submit()) return false;" 
```

这是我的完整按钮元素，以防万一：

```
<asp:Button UseSubmitBehavior="false" runat="server" Class="ms-ButtonHeightWidth jiveSiteSettingsSubmit" OnClientClick="if (!OnClick_Submit()) return false;" OnClick="BtnSave_Click" Text="<%$Resources:wss,multipages_okbutton_text%>" id="BtnOK" accesskey="<%$Resources:wss,okbutton_accesskey%>" Enabled="true"/> 
```

如果我在运行时检查 HTML 按钮的 onclick 属性，它实际上看起来像这样：

```
if (!OnClick_Submit()) return false;WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions("ctl00$PlaceHolderMain$ctl03$RptControls$BtnOK", "", true, "", "", false, true)) 
```

然后在我的 Javascript 中，我添加了 OnClick_Submit 方法。就我而言，我需要检查是否需要向用户显示对话框。如果我显示对话框，我会返回 false 导致事件停止处理。如果我不显示对话框，我会返回 true，从而导致事件继续处理，并且我的回发逻辑像以前一样运行。

```
function OnClick_Submit() {
    var initiallyActive = initialState.socialized && initialState.activityEnabled;
    var socialized = IsSocialized();
    var enabled = ActivityStreamsEnabled();

    var displayDialog;

    // Omitted the setting of displayDialog for clarity

    if (displayDialog) {
        $("#myDialog").dialog('open');
        return false;
    }
    else {
        return true;
    }
} 
```

然后在接受对话框时运行的 Javascript 代码中，我根据用户与对话框的交互方式执行以下操作：

```
$("#myDialog").dialog('close');
__doPostBack('message', ''); 
```

上面的“消息”实际上根据我要发送的消息而有所不同。

## 但是等等，还有更多！

回到我的服务器端代码，我将 OnLoad 从：

```
protected override void OnLoad(EventArgs e)
{
    base.OnLoad(e)
    if (IsPostBack)
    {
        return;
    }

    // OnLoad logic removed for clarity
} 
```

到：

```
protected override void OnLoad(EventArgs e)
{
    base.OnLoad(e)
    if (IsPostBack)
    {
        switch (Request.Form["__EVENTTARGET"])
        {
            case "message1":
                // We did a __doPostBack with the "message1" command provided
                Page.Validate();
                BtnSave_Click(this, new CommandEventArgs("message1", null));
                break;

            case "message2":
                // We did a __doPostBack with the "message2" command provided
                Page.Validate();
                BtnSave_Click(this, new CommandEventArgs("message2", null));
                break;
            }
            return;
    }

    // OnLoad logic removed for clarity
} 
```

然后在 BtnSave_Click 方法中，我执行以下操作：

```
CommandEventArgs commandEventArgs = e as CommandEventArgs;
string message = (commandEventArgs == null) ? null : commandEventArgs.CommandName; 
```

最后，我可以根据我是否有消息以及该消息的值来提供逻辑。

# native - 本机代码和托管代码之间的区别？

> ID：855756
> 
> 赞同：63
> 
> 时间：2009-05-13T02:14:12.570
> 
> 标签：native, managed

例如，在查看 GlowCode 分析器网站时，它会说：

“GlowCode 6.2 和 x64 配置本机、托管和混合 C++、C#、.NET 代码”

他们的意思是什么？

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2009-05-13T02:23:01.477

本机代码是内存不是“托管”的代码，例如，内存没有为您释放（例如 C++ 的删除和 C 的空闲），没有引用计数，没有垃圾收集。你猜对了，托管代码是内存空闲并为你分配的代码，垃圾收集和其他好东西。

混合代码是指您拥有调用非托管层的托管代码。通常，当您有一个纯非托管 C++ DLL 并使用 P/invoke 从 .NET 调用它时。

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-05-13T02:33:41.533

本机代码被编译为直接与操作系统一起使用。然而，托管代码是预编译的（Java 语言中的字节码），然后在运行时由即时编译器处理为本机代码。托管代码有一个有趣的副作用，即有可能在不同的操作系统上运行，因为机器代码在虚拟机实际使用它之前不会创建。这样，您就可以在 Windows 上运行 .NET 应用程序，也可以在安装了 Mono 运行时的 Linux 或 Mac 上运行它们。可移植性目前不像 Java 那样干净（因为微软的自然封闭架构），但这个概念仍然存在。

如果您正在运行非托管应用程序，则代码已编译为针对指定的操作系统/硬件运行。任何到另一个操作系统/指令集的可移植性都会丢失，必须重新编译才能执行。

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2009-05-13T22:27:28.573

本机代码是用运行它的计算机的“本机”机器语言编写的，并由处理器直接执行。

托管代码是用一种特殊的语言编写的，需要另一个程序来运行（即管理）它。这个其他程序通常被称为解释器，因为它解释了特殊语言。

C 和 C++ 程序是本机程序。

Java 和 C#（以及与此相关的所有 .NET 语言）都受到管理。

托管 C++ 是在 .NET 解释器中运行的一种特殊形式的 C++。

混合程序是使用本机和托管代码的程序。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-06-10T13:03:35.143

在公共语言运行时 (CLR) 控制下运行的代码称为托管代码。不在 CLR 下运行的代码称为本机代码。

# python - Python try-else

> ID：855759
> 
> 赞同：704
> 
> 时间：2009-05-13T02:15:11.353
> 
> 标签：python, exception-handling

`else`语句的可选子句的预期用途是什么`try`？

* * *

## 回答 #1

> 赞同：995
> 
> 时间：2009-05-13T02:18:22.110

`else`如果执行落在`try`- 如果没有异常的底部，则执行块中的语句。老实说，我从来没有发现需要。

但是，[处理异常](http://docs.python.org/tutorial/errors.html#handling-exceptions)说明：

> else 子句的使用比在 try 子句中添加额外的代码要好，因为它可以避免意外捕获不是由 try ... except 语句保护的代码引发的异常。

`IOError`所以，如果你*有*一个方法可以，例如，抛出一个该操作，您可能会编写如下内容：

```
try:
    operation_that_can_throw_ioerror()
except IOError:
    handle_the_exception_somehow()
else:
    # we don't want to catch the IOError if it's raised
    another_operation_that_can_throw_ioerror()
finally:
    something_we_always_need_to_do() 
```

如果您只是放`another_operation_that_can_throw_ioerror()`after `operation_that_can_throw_ioerror`，`except`则将捕获第二个调用的错误。如果你把它放在整个`try`块之后，它会一直运行，直到`finally`. 让`else`您确保

1.  只有在没有异常的情况下才会运行第二个操作，
2.  它在`finally`块之前运行，并且
3.  `IOError`它引发的任何s 都不会在这里捕获

* * *

## 回答 #2

> 赞同：135
> 
> 时间：2013-01-29T19:13:57.090

使用的一**大**理由是`else`风格和可读性。将可能导致异常的代码保留在处理它们的代码附近通常是一个好主意。例如，比较这些：

```
try:
    from EasyDialogs import AskPassword
    # 20 other lines
    getpass = AskPassword
except ImportError:
    getpass = default_getpass 
```

和

```
try:
    from EasyDialogs import AskPassword
except ImportError:
    getpass = default_getpass
else:
    # 20 other lines
    getpass = AskPassword 
```

第二个是好的，当`except`不能早点返回，或者重新抛出异常。如果可能的话，我会写：

```
try:
    from EasyDialogs import AskPassword
except ImportError:
    getpass = default_getpass
    return False  # or throw Exception('something more descriptive')

# 20 other lines
getpass = AskPassword 
```

**注意：从最近发布的副本**[here](https://stackoverflow.com/questions/14590146/why-use-pythons-else-clause-in-try-except-block/14590276#comment20366594_14590276)复制的答案，因此所有这些“AskPassword”内容。

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2015-02-10T23:31:25.200

> # Python try-else
> 
> `else`try 语句的可选子句的预期用途是什么？

预期用途是在没有预期处理异常的情况下为更多代码运行提供上下文。

此上下文可避免意外处理您未预料到的错误。

但重要的是要了解导致 else 子句运行的确切条件，因为`return`,`continue`和`break`可以中断对 的控制流`else`。

## 总之

*如果没有*异常并且没有被、或语句中断，则该`else`语句运行。*`return``continue``break`*

 *## 其他答案错过了最后一部分。

[从文档：](https://docs.python.org/reference/compound_stmts.html#the-try-statement)

> 可选`else`子句在控制从子句末尾流出时执行**。**`try` *

（加粗。）脚注如下：

> *目前，除了出现异常或执行 、 或 语句的情况外，控制“从头到尾`return`流动`continue`” `break`。

它确实需要至少一个前面[的 except 子句（参见语法](https://docs.python.org/reference/compound_stmts.html#the-try-statement)）。所以它真的不是“try-else”，而是“try-except-else(-finally)”，其中`else`(and `finally`) 是可选的。

[Python 教程](https://docs.python.org/tutorial/errors.html#handling-exceptions)详细说明了预期用途：

> try ... except 语句有一个可选的 else 子句，当它出现时，它必须跟在所有 except 子句之后。如果 try 子句不引发异常，则它对于必须执行的代码很有用。例如：
> 
> ```
> for arg in sys.argv[1:]:
>     try:
>         f = open(arg, 'r')
>     except IOError:
>         print 'cannot open', arg
>     else:
>         print arg, 'has', len(f.readlines()), 'lines'
>         f.close() 
> ```
> 
> else 子句的使用比在 try 子句中添加额外的代码要好，因为它可以避免意外捕获不是由 try ... except 语句保护的代码引发的异常。

# 示例区分`else`与`try`块后面的代码

如果您处理错误，该`else`块将不会运行。例如：

```
def handle_error():
    try:
        raise RuntimeError('oops!')
    except RuntimeError as error:
        print('handled a RuntimeError, no big deal.')
    else:
        print('if this prints, we had no error!') # won't print!
    print('And now we have left the try block!')  # will print! 
```

现在，

```
>>> handle_error()
handled a RuntimeError, no big deal.
And now we have left the try block! 
```

* * *

## 回答 #4

> 赞同：63
> 
> 时间：2009-05-13T02:36:39.063

一种用途：测试一些应该引发异常的代码。

```
try:
    this_should_raise_TypeError()
except TypeError:
    pass
except:
    assert False, "Raised the wrong exception type"
else:
    assert False, "Didn't raise any exception" 
```

（此代码在实践中应抽象为更通用的测试。）

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2015-04-17T22:11:22.910

Try-except-else 非常适合将[EAFP 模式](https://docs.python.org/2/glossary.html#term-eafp)与[鸭子类型](https://docs.python.org/2/glossary.html#term-duck-typing)相结合：

```
try:
  cs = x.cleanupSet
except AttributeError:
  pass
else:
  for v in cs:
    v.cleanup() 
```

您可能认为这个幼稚的代码很好：

```
try:
  for v in x.cleanupSet:
    v.clenaup()
except AttributeError:
  pass 
```

这是在代码中意外隐藏严重错误的好方法。我在那里打错了清理，但是让我知道的 AttributeError 被吞下了。更糟糕的是，如果我写得正确，但清理方法偶尔会被传递一个具有错误命名属性的用户类型，导致它在中途静默失败并留下一个未关闭的文件？祝你调试成功。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2009-05-13T02:34:26.977

我发现当你有清理工作时它真的很有用，即使有异常也必须这样做：

```
try:
    data = something_that_can_go_wrong()
except Exception as e: # yes, I know that's a bad way to do it...
    handle_exception(e)
else:
    do_stuff(data)
finally:
    clean_up() 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-05-13T02:26:42.517

即使你现在想不出它的用途，但你可以打赌它一定是有用的。这是一个没有想象力的示例：

与`else`：

```
a = [1,2,3]
try:
    something = a[2]
except:
    print "out of bounds"
else:
    print something 
```

没有`else`：

```
try:
    something = a[2]
except:
    print "out of bounds"

if "something" in locals():
    print something 
```

`something`如果没有抛出错误，则在这里定义变量。您可以在块外删除它`try`，但是如果定义了变量，则需要进行一些混乱的检测。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-05-27T11:39:02.090

`try-else`在[PEP 380](http://www.python.org/dev/peps/pep-0380/#id9)中有一个很好的例子。基本上，它归结为在算法的不同部分进行不同的异常处理。

是这样的：

```
try:
    do_init_stuff()
except:
    handle_init_suff_execption()
else:
    try:
        do_middle_stuff()
    except:
        handle_middle_stuff_exception() 
```

这使您可以在更接近发生异常的位置编写异常处理代码。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2020-08-10T08:11:13.883

```
try:
    statements # statements that can raise exceptions
except:
    statements # statements that will be executed to handle exceptions
else:
    statements # statements that will be executed if there is no exception 
```

例子 ：

```
try:
    age=int(input('Enter your age: '))
except:
    print ('You have entered an invalid value.')
else:
    if age <= 21:
        print('You are not allowed to enter, you are too young.')
    else:
        print('Welcome, you are old enough.') 
```

输出 ：

```
>>> 
Enter your age: a
You have entered an invalid value.
>>> RESTART
>>> 
Enter your age: 25
Welcome, you are old enough.
>>>RESTART
>>> 
Enter your age: 13
You are not allowed to enter, you are too young.
>>> 
```

复制自：[https ://geek-university.com/python/the-try-except-else-statements/](https://geek-university.com/python/the-try-except-else-statements/)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2013-08-21T12:29:59.037

来自[错误和异常 # 处理异常 - docs.python.org](http://docs.python.org/2/tutorial/errors.html#handling-exceptions)

> 该`try ... except`语句有一个可选`else`子句，当它出现时，它必须跟在所有 except 子句之后。如果 try 子句不引发异常，则它对于必须执行的代码很有用。例如：
> 
> ```
> for arg in sys.argv[1:]:
>     try:
>         f = open(arg, 'r')
>     except IOError:
>         print 'cannot open', arg
>     else:
>         print arg, 'has', len(f.readlines()), 'lines'
>         f.close() 
> ```
> 
> else 子句的使用比在 try 子句中添加额外的代码要好，因为它可以避免意外捕获不是由 try ... except 语句保护的代码引发的异常。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2009-05-13T02:20:32.433

查看[Python 参考](http://docs.python.org/reference/compound_stmts.html)，似乎在没有异常的情况`else`下执行。`try`如果以及当控制从 try 子句的末尾流出时，可选的 else 子句将被执行。[2](http://www.diveintopython.org/file_handling/index.html) else 子句中的异常不被前面的 except 子句处理。

[Dive into python](http://www.diveintopython.org/file_handling/index.html)有一个例子，如果我理解正确，`try`他们尝试在块中导入一个模块，当失败时你会得到异常并绑定默认值但是当它工作时你可以选择进入`else`块并绑定所需的内容（参见示例和说明的链接）。

如果您尝试在`catch`块中工作，它可能会引发另一个异常 - 我想这就是`else`块派上用场的地方。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-05-14T20:43:20.127

而已。try-except 子句的“else”块存在于当（且仅当）尝试操作成功时运行的代码。它可以被使用，也可以被滥用。

```
try:
    fp= open("configuration_file", "rb")
except EnvironmentError:
    confdata= '' # it's ok if the file can't be opened
else:
    confdata= fp.read()
    fp.close()

# your code continues here
# working with (possibly empty) confdata 
```

就个人而言，我喜欢它并在适当的时候使用它。它在语义上对语句进行分组。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2020-01-14T23:23:09.117

我会添加另一个在处理数据库会话时看起来很简单的用例：

```
 # getting a DB connection 
    conn = db.engine.connect()

    # and binding to a DB session
    session = db.get_session(bind=conn)

    try:
        # we build the query to DB
        q = session.query(MyTable).filter(MyTable.col1 == 'query_val')

        # i.e retrieve one row
        data_set = q.one_or_none()

        # return results
        return [{'col1': data_set.col1, 'col2': data_set.col2, ...}]

    except:
        # here we make sure to rollback the transaction, 
        # handy when we update stuff into DB
        session.rollback()
        raise

    else:
        # when no errors then we can commit DB changes
        session.commit()

    finally:
        # and finally we can close the session
        session.close() 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-11-21T17:22:05.190

我发现该`try: ... else:`构造在您运行数据库查询并将这些查询的结果记录到相同风格/类型的单独数据库的情况下很有用。假设我有很多工作线程都处理提交到队列的数据库查询

```
#in a long running loop
try:
    query = queue.get()
    conn = connect_to_db(<main db>)
    curs = conn.cursor()
    try:
        curs.execute("<some query on user input that may fail even if sanitized">)
    except DBError:
        logconn = connect_to_db(<logging db>)
        logcurs = logconn.cursor()
        logcurs.execute("<update in DB log with record of failed query")
        logcurs.close()
        logconn.close()
    else:

        #we can't put this in main try block because an error connecting
        #to the logging DB would be indistinguishable from an error in 
        #the mainquery 

        #We can't put this after the whole try: except: finally: block
        #because then we don't know if the query was successful or not

        logconn = connect_to_db(<logging db>)
        logcurs = logconn.cursor()
        logcurs.execute("<update in DB log with record of successful query")
        logcurs.close()
        logconn.close()
        #do something in response to successful query
except DBError:
    #This DBError is because of a problem with the logging database, but 
    #we can't let that crash the whole thread over what might be a
    #temporary network glitch
finally:
    curs.close()
    conn.close()
    #other cleanup if necessary like telling the queue the task is finished 
```

当然，如果您可以区分可能抛出的异常，则不必使用它，但是如果对成功的代码做出反应的代码可能会抛出与成功的代码相同的异常，并且您不能只是让第二个可能的异常消失，或者在成功时立即返回（在我的情况下这会杀死线程），那么这确实会派上用场。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2012-12-13T15:58:14.943

这是我喜欢使用此模式的另一个地方：

```
 while data in items:
     try
        data = json.loads(data)
     except ValueError as e:
        log error
     else:
        # work on the `data` 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2011-05-20T22:12:04.787

也许用途可能是：

```
#debug = []

def debuglog(text, obj=None):
    " Simple little logger. "
    try:
        debug   # does global exist?
    except NameError:
        pass    # if not, don't even bother displaying
    except:
        print('Unknown cause. Debug debuglog().')
    else:
        # debug does exist.
        # Now test if you want to log this debug message
        # from caller "obj"
        try:
            if obj in debug:
                print(text)     # stdout
        except TypeError:
            print('The global "debug" flag should be an iterable.')
        except:
            print('Unknown cause. Debug debuglog().')

def myfunc():
    debuglog('Made it to myfunc()', myfunc)

debug = [myfunc,]
myfunc() 
```

也许这会导致你太有用了。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-05-14T21:07:30.617

通常可以存在一个`else`块来补充每个`except`块中出现的功能。

```
try:
    test_consistency(valuable_data)
except Except1:
    inconsistency_type = 1
except Except2:
    inconsistency_type = 2
except:
    # Something else is wrong
    raise
else:
    inconsistency_type = 0

"""
Process each individual inconsistency down here instead of
inside the except blocks. Use 0 to mean no inconsistency.
""" 
```

在这种情况下，`inconsistency_type`在每个 except 块中设置，以便在 中的无错误情况下对行为进行补充`else`。

当然，我将其描述为有一天可能会出现在您自己的代码中的一种模式。在这种特定情况下，您只是在块`inconsistency_type`之前设置为 0 。`try`

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-07-30T02:06:15.837

我发现`else`对于处理可能不正确的配置文件很有用：

```
try:
    value, unit = cfg['lock'].split()
except ValueError:
    msg = 'lock monitoring config must consist of two words separated by white space'
    self.log('warn', msg)
else:
     # get on with lock monitoring if config is ok 
```

读取配置的异常`lock`会禁用锁定监控，并且 ValueErrors 会记录有用的警告消息。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-04-01T21:05:41.757

假设您的编程逻辑取决于字典是否具有具有给定键的条目。您可以测试`dict.get(key)`使用`if... else...`构造的结果，也可以执行以下操作：

```
try:
    val = dic[key]
except KeyError:
    do_some_stuff()
else:
    do_some_stuff_with_val(val) 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2017-04-13T08:48:14.577

我能想到的使用场景之一是不可预知的异常，再试一次就可以规避。例如，当 try 块中的操作涉及随机数时：

```
while True:
    try:
        r = random.random()
        some_operation_that_fails_for_specific_r(r)
    except Exception:
        continue
    else:
        break 
```

但是，如果可以预测异常，则应始终事先选择验证而不是异常。但是，并非所有事情都可以预测，因此此 Code Pattern 占有一席之地。

* * *

## 回答 #21

> 赞同：-19
> 
> 时间：2009-05-13T02:28:03.510

该`else:`块令人困惑并且（几乎）无用。它也是`for`and`while`语句的一部分。

实际上，即使在`if`-statement 上，`else:`也可以以非常糟糕的方式滥用，从而创建很难找到的错误。

考虑一下。

```
 if a < 10:
       # condition stated explicitly
   elif a > 10 and b < 10:
       # condition confusing but at least explicit
   else:
       # Exactly what is true here?
       # Can be hard to reason out what condition is true 
```

三思而后行`else:`。这通常是一个问题。避免它，除非在-`if`语句中，甚至考虑记录`else`- 条件以使其明确。

# .net - Microsoft.VisualBasic.Collection 和 .NET System.Collections.Generic.Dictionary(Of TKey, TValue) 之间的已知性能差异是什么？

> ID：855761
> 
> 赞同：3
> 
> 时间：2009-05-13T02:16:47.997
> 
> 标签：.net, performance, vb6, collections, dictionary

我正在为费城的一家贸易公司做一个相当大的项目。该公司利用自动交易算法处理流式报价并每秒数十次发送数百种产品的报价。显然，性能是一个重要的问题。（这让我质疑我们为什么要使用 VB.NET，但这完全是另一个话题。）

我对公司比较陌生，并且正在与另一个人一起编写一些已经存在了一段时间的代码。此代码使用 Microsoft.VisualBasic.Collection 对象来存储所有产品（表示 ETF 或股票对的对象以及关于每个产品的大量数据），并从该集合中进行大量搜索/检索。

据我了解， Collection 类已被弃用，几乎没有人再使用它了。在我们最近的代码中，我们一直在使用 .NET 集合，例如 List(Of T) 和 Dictionary(Of TKey, TValue)，据我了解，用 Dictionary 替换旧的 Collection 可能是有意义的。然而，由于源代码相当庞大，继续进行这种替换将是一项艰巨的任务；所以我的问题就是这样：

有没有人真正测量过旧 Collection 和 .NET Dictionary 之间的性能差异？无论出于何种原因，这样的比较是否不合适？当然，我们目前对 Collection 所做的一切似乎都可以用 Dictionary 完成；基本上我只是想知道我们通过代码并进行这种转换是否有意义，或者这样做是否本质上是一种浪费。

**编辑**：最初在问题中我提到了我们用作 VB6 集合的当前集合。阅读前两个答案后，我意识到它更准确地说是 Microsoft.VisualBasic.Collection，它似乎是为 VB6 和 VB.NET 之间的兼容性而引入的一个类。我认为这个问题仍然成立。

根据 Kenneth Cochran 的回答中提供的第一个链接，我相信 Dictionary 确实比 Collection 更适合我们的目的，因为它在按键检索项目和运行“For Each”循环几毫秒方面表现更好10,000 次运行。在我们公司，这是一个现实的场景；代码中有很多地方都有如下语句：

```
Dim ETF as ETFdetails = ETFcoll(sym) 
```

正如我所说，这些生产线在数百种产品上执行，每秒执行很多次。考虑到这一点，我倾向于认为我们真的应该继续进行更改，然后衡量任何性能差异。我希望我们至少会看到轻微但明显的改善。

我刚才说的有什么明显的错误吗？如果有，请指出！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T03:12:30.363

如果您使用的是 VB.NET，则您没有使用 VB6 集合。VB.NET 集合在功能上等同于 VB6 集合，但它们并不相同。[http://www.vbmigration.com/Blog/post/2008/11/Speed-up-your-VBNET-collections.aspx](http://www.vbmigration.com/Blog/post/2008/11/Speed-up-your-VBNET-collections.aspx)比较了各种 .NET 集合类型与 VB6 集合，包括 VB.NET 集合. 每种集合类型都有其优点和弱点（为什么我们会有这么多的集合类型可供选择）。有些更快，插入以牺牲搜索为代价，反之亦然。一些小集合速度更快，而另一些集合大集合速度更快。您的选择应取决于对您最重要的性能属性。

这是我偶然发现的一张表，它给出了标准 .NET 集合类型的相对性能。注意 VB.NET 集合不包括在内： [http ://www.artima.com/forums/flat.jsp?forum=152&thread=179998](http://www.artima.com/forums/flat.jsp?forum=152&thread=179998)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T13:02:41.943

除了性能之外，我还是建议使用字典。它具有泛型类型参数，因此您可以直接指定字典要保存的数据类型。这可以防止许多错误（可以在编译时检测到）并且应该提高性能，因为许多强制转换和运行时类型检查是不必要的。

两种数据结构的算法复杂度都是 O(1)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T02:45:32.227

VB.Net 的性能没有问题。它编译为与 C# 相同的 IL，而后者又被 JIT 编译为机器语言。这就是为什么它被称为 .Net *Framework*而不是 .Net *VM*的原因。

虽然我还没有看到 VB6 集合与 VB.Net 字典的正面比较，但我希望它们是相似的，因为无论哪种方式，底层算法本质上都是一个哈希表。也就是说，如果会有一个小的差异，我倾向于给 Dictionary 带来优势，因为不涉及强制转换/后期绑定。系统将花费更少的时间来担心检查或翻译类型。

当然，这假设您以强类型的方式使用 VB.Net，并打开了 Option Strict 和 Option Explcit。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-11-08T18:33:45.450

这是一个老问题，但无论如何我希望它有所帮助..

根据[http://msdn.microsoft.com/en-us/library/vstudio/ms172875(v=vs.100).aspx](http://msdn.microsoft.com/en-us/library/vstudio/ms172875(v=vs.100).aspx)

> 元素类型。Visual Basic 集合支持 Object 类型的元素，它不是类型安全的，因为您可以添加任何数据类型的元素。**这通常会导致性能下降，因为编译器必须对元素进行装箱和拆箱才能将它们与 Object Data Type 相互转换**。一些 .NET Framework 集合还具有 Object 类型的元素，但许多其他集合是强类型的，这意味着它们支持特定类型的元素，这使得它们是类型安全的，并且通常会带来最佳性能。

问题是您是否需要在该集合中存储不同类型的对象。

我做了测试。我有几个嵌套的 Microsoft.VisualBasic.Collection，程序迭代了大约 6600 次以在这些集合中找到一个项目。完成大约需要 1920 毫秒。

然后我用一个 System.Collections.Generics.Dictionary(Of String, String) 替换（因为它只存储字符串）并且相同数量的数据只花了大约 5ms。差别太大了！！！

在这种情况下，装箱和拆箱是一项昂贵的操作。

我希望这回答了你的问题。

来自阿根廷的欢呼！

PS。对不起，我的英语很烂！

# c - malloc 线程安全吗？

> ID：855763
> 
> 赞同：77
> 
> 时间：2009-05-13T02:17:42.267
> 
> 标签：c, multithreading, thread-safety, malloc

函数是`malloc()`可重入的吗？

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-05-13T05:15:32.970

问题：“malloc 是可重入的”？
答：不，不是。以下是例程[可重入](http://en.wikipedia.org/wiki/Reentrant_(subroutine))的一个定义。

malloc 的所有常见版本都不允许您重新输入它（例如，从信号处理程序）。请注意，可重入例程可能不使用锁，并且几乎所有现有的 malloc 版本都使用锁（这使它们成为线程安全的）或全局/静态变量（这使得它们成为线程不安全*和*不可重入的）。

到目前为止，所有答案都回答“malloc 线程安全吗？”，这是一个完全不同的问题。对于*这个*问题，答案是*它取决于*您的运行时库，并且可能取决于您使用的编译器标志。在任何现代 UNIX 上，默认情况下您都会获得线程安全的 malloc。在 Windows 上，使用、`/MT`或标志来获取线程安全的运行时库。`/MTd``/MD``/MDd`

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-05-13T02:26:31.300

我在某处读到，如果您使用 -pthread 进行编译，malloc 将成为线程安全的。我很确定它的实现依赖于它，因为 malloc 是 ANSI C 而线程不是。

如果我们在谈论 gcc：

> 在 x86 和 AMD64 上，使用 -pthread 和 malloc() 进行编译和链接将是线程安全的。

[http://groups.google.com/group/comp.lang.c.moderated/browse_thread/thread/2431a99b9bdcef11/ea800579e40f7fa4](http://groups.google.com/group/comp.lang.c.moderated/browse_thread/thread/2431a99b9bdcef11/ea800579e40f7fa4)

另一种观点，更有见地

> glibc-2.2+ 的 {malloc, calloc, realloc, free, posix_memalign} 是线程安全的

[http://linux.derkeiler.com/Newsgroups/comp.os.linux.development.apps/2005-07/0323.html](http://linux.derkeiler.com/Newsgroups/comp.os.linux.development.apps/2005-07/0323.html)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2014-11-20T18:37:17.563

这是一个很老的问题，我想根据当前的情况带来新鲜感。

是的，目前`malloc()`是线程安全的。

来自GNU C 库参考[手册](http://www.gnu.org/software/libc/manual/html_mono/libc.html#Basic-Allocation)：`glibc-2.20 [released 2014-09-07]`

> `void * malloc (size_t size)`
> 
> 初步：MT-Safe | ...
> 
> ... 1.2.2.1 POSIX 安全概念：
> 
> ... MT-Safe 或 Thread-Safe 函数在存在其他线程的情况下可以安全调用。MT，在 MT-Safe 中，代表多线程。
> 
> MT-Safe 并不意味着函数是原子的，也不意味着它使用 POSIX 向用户公开的任何内存同步机制。甚至有可能按顺序调用 MT-Safe 函数不会产生 MT-Safe 组合。例如，让一个线程一个接一个地调用两个 MT-Safe 函数并不能保证等同于原子执行这两个函数的组合的行为，因为其他线程中的并发调用可能会以破坏性方式干扰。
> 
> 可以跨库接口内联函数的整个程序优化可能会暴露不安全的重新排序，因此不建议跨 GNU C 库接口执行内联。记录的 MT 安全状态不能保证在整个程序优化下。但是，在用户可见的标头中定义的函数被设计为内联安全。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2015-04-04T01:30:01.533

是的，在[POSIX.1-2008](http://pubs.opengroup.org/onlinepubs/9699919799/functions/V2_chap02.html#tag_15_09) `malloc`下是线程安全的。

> 2.9.1 线程安全
> 
> 本卷 POSIX.1-2008 定义的所有函数都应是线程安全的，但以下函数 1 不需要是线程安全的。
> 
> [不包含的函数列表`malloc`]

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-09-20T14:50:36.240

这是 glibc 的 malloc.c 的摘录：

线程安全：线程安全，除非定义了 NO_THREADS

假设 NO_THREADS 默认没有定义， malloc 至少在 linux 上是线程安全的。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2017-03-17T18:44:35.280

如果您正在使用 GLIBC，答案是：是的，但是。

具体来说，是的，但是，请注意，虽然 malloc 和 free 是线程安全的，*但调试功能不是。*

具体来说，极其有用的 mtrace()、mcheck() 和 mprobe() 函数*不是线程安全的*。这是您从 GNU 项目中看到的最短、最直接的答案之一，这里对此进行了解释：

[https://sourceware.org/bugzilla/show_bug.cgi?id=9939](https://sourceware.org/bugzilla/show_bug.cgi?id=9939)

您将需要考虑替代技术，例如 ElectricFence、valgrind、dmalloc 等。

所以，如果你的意思是“malloc() 和 free() 函数是线程安全的”，答案是肯定的。但是，如果您的意思是“是整个 malloc/free*套件*线程安全”，那么答案是否定的。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2018-08-13T19:32:19.077

简短回答：是的，从 C11 开始，这是包含线程概念的 C 标准的第一个版本，`malloc`要求朋友是线程安全的。许多同时包含线程和 C 运行时的操作系统在 C 标准之前很久就做出了这种保证，但我不准备向*所有人*发誓。然而，`malloc`朋友们没有也从来没有被要求是可重入的。

这意味着，同时从多个线程调用`malloc`和`free`从多个线程调用是安全的，而不必担心锁定，只要您不违反任何其他内存分配规则（例如`free`，在每个返回的指针上调用一次且仅调用一次`malloc`）。但是从可能中断了对处理信号的线程的调用或在处理信号的线程中的信号处理程序调用这些函数是*不安全*的。有时，使用 ISO C 之外的功能，您可以保证处理信号的线程不会中断对or的调用，例如使用and ，但除非您别无选择，否则尽量不要这样做，因为很难完全正确。`malloc``free``malloc``free``sigprocmask``sigpause`

* * *

引文的长答案：C 标准在[2011 修订版](http://port70.net/%7Ensz/c/c11/n1570.html)中添加了线程的概念（链接是文档 N1570，这是与免费公开的 2011 标准的官方文本最接近的近似值）。在该修订版中，[第 7.1.4 节第 5 段](http://port70.net/%7Ensz/c/c11/n1570.html#7.1.4p5)规定：

> 除非在随后的详细描述中另有明确说明，否则库函数应防止数据竞争如下： 库函数不应直接或间接访问当前线程以外的线程可访问的对象，除非通过函数的参数直接或间接访问对象. 库函数不得直接或间接修改当前线程以外的线程可访问的对象，除非通过函数的非常量参数直接或间接访问对象。如果对象对用户不可见并且受到保护以防止数据竞争，则实现可以在线程之间共享它们自己的内部对象。
> 
> [脚注：这意味着，例如，不允许实现在没有同步的情况下将静态对象用于内部目的，因为即使在没有显式在线程之间共享对象的程序中，它也可能导致数据竞争。同样，不允许 memcpy 的实现复制超出目标对象指定长度的字节，然后恢复原始值，因为如果程序在线程之间共享这些字节，可能会导致数据竞争。]

据我了解，这是一种冗长的说法，即 C 标准定义的库函数必须是线程安全的（通常意义上：您可以同时从多个线程调用它们，而无需自己进行任何锁定，只要它们最终不会与作为参数传递的数据发生冲突），除非特定函数的文档明确说明它不是。

然后，[7.22.3p2](http://port70.net/%7Ensz/c/c11/n1570.html#7.22.3p2)确认 malloc、calloc、realloc、aligned_alloc 和 free 特别是线程安全的：

> 为了确定数据竞争的存在，内存分配函数的行为就像它们只访问可通过其参数访问的内存位置，而不是其他静态持续时间存储。但是，这些函数可能会明显地修改它们分配或取消分配的存储空间。释放内存区域 p 的 free 或 realloc 调用与分配区域 p 的全部或部分的任何分配调用同步。此同步发生在解除分配函数对 p 的任何访问之后，并且在分配函数进行任何此类访问之前。

[对比它在7.24.5.8p6](http://port70.net/%7Ensz/c/c11/n1570.html#7.24.5.8p6)中关于 strtok 的说法，它不是也从来不是线程安全的：

> 不需要 strtok 函数来避免与对 strtok 函数的其他调用的数据争用。
> 
> [脚注：可以使用 strtok_s 函数来避免数据竞争。]

（脚注注释：不要使用`strtok_s`，使用`strsep`。）

旧版本的 C 标准对线程安全只字未提。然而，他们*确实*谈到了可重入性，因为信号一直是 C 标准的一部分。这就是他们所说的，回到最初的[1989 年 ANSI C 标准](https://web.archive.org/web/20151125170555/http://flash-gordon.me.uk/ansi.c.txt)（该文件的措辞与次年发布的 ISO C 标准几乎相同，但部分编号非常不同）：

> 如果 [a] 信号不是由于调用 abort 或 raise 函数而出现的，则如果信号处理程序调用标准库中的任何函数而不是信号函数本身或引用具有静态存储持续时间的任何对象，则行为未定义而不是通过为 volatile sig_atomic_t 类型的静态存储持续时间变量赋值。此外，如果对信号函数的这种调用导致 SIG_ERR 返回，则 errno 的值是不确定的。

这是一种冗长的说法，即作为一般规则，C 库函数不需要可重入*。*非常相似的措辞仍然出现在 C11, [7.14.1.1p5 中](http://port70.net/%7Ensz/c/c11/n1570.html#7.14.1.1p5)：

> 如果 [a] 信号不是由于调用 abort 或 raise 函数而出现的，则如果信号处理程序引用具有静态或线程存储持续时间的任何对象，该对象不是无锁原子对象，而不是通过分配声明为 volatile sig_atomic_t 的对象的值，或信号处理程序调用标准库中除 abort 函数、_Exit 函数、quick_exit 函数或第一个参数等于对应于信号编号的信号函数之外的任何函数导致调用处理程序的信号。此外，如果对信号函数的这种调用导致 SIG_ERR 返回，则 errno 的值是不确定的。
> 
> [脚注：如果任何信号由异步信号处理程序生成，则行为未定义。]

与 C 库的整体大小相比， POSIX 需要[更长但仍然很短](http://man7.org/linux/man-pages/man7/signal-safety.7.html)的函数列表，这些函数可以从“异步信号处理程序”安全调用，并且还更详细地定义了信号可能“发生其他情况”的情况而不是调用 abort 或 raise 函数的结果。” 如果您正在使用信号做任何重要的事情，那么您可能正在编写旨在在具有 Unix 特性的操作系统上运行的代码（与 Windows、MVS 或可能没有完整托管的 C 实现的嵌入式操作系统相反）首先），并且您应该熟悉它们的 POSIX 要求以及 ISO C 要求。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-12-26T01:27:17.467

我建议阅读

> §31.1 线程安全（以及重新访问）

*在The Linux Programming Interface*一书中，它解释了线程安全和可重入之间的区别，以及`malloc`.

摘录：</p>

> 如果一个函数可以被多个线程同时安全地调用，则称该函数是线程安全的；反过来说，如果一个函数不是线程安全的，那么当它在另一个线程中执行时，我们就不能从一个线程调用它。
> 
> ....
> 这个函数说明了一个函数不是线程安全的典型原因：它使用了所有线程共享的全局或静态变量。
> 
> ...
> 虽然使用临界区来实现线程安全是对使用每个功能互斥锁的显着改进，但它仍然有些低效，因为锁定和解锁互斥锁是有成本的。可重入函数无需使用互斥体即可实现线程安全。它通过避免使用全局变量和静态变量来做到这一点。
> 
> ...
> 但是，并非所有功能都可以重入。通常的原因如下：
> 
> *   就其本质而言，某些函数必须访问全局数据结构。malloc 库中的函数就是一个很好的例子。这些函数维护堆上空闲块的全局链表。通过使用互斥体，库的功能`malloc`是线程安全的。
> 
> ……

绝对值得一读。

并回答您的问题，`malloc`线程安全但不可重入。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-13T02:32:34.093

这取决于您使用的 C 运行时库的实现。例如，如果您使用 MSVC，则有一个编译器选项可让您指定要使用哪个版本的库构建（即，通过是否安全来支持多线程的运行时库）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-13T03:02:28.417

不，它不是线程安全的。实际上，您的 C 库中可能有一个可用的`malloc_lock()`and函数。`malloc_unlock()`我知道这些存在于 Newlib 库中。我不得不使用它为我的处理器实现互斥锁，该处理器在硬件中是多线程的。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-10-05T07:09:10.563

malloc 和 free 不可重入，因为它们使用静态数据结构来记录哪些内存块是空闲的。因此，没有分配或释放内存的库函数是可重入的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-13T02:25:09.647

不它不是。

[Web存档链接（原始已失效）](https://web.archive.org/web/20100501162929/http://coding.derkeiler.com/Archive/C_CPP/comp.lang.c/2007-07/msg02658.html)

# git - 我可以在未跟踪的文件上使用 git diff 吗？

> ID：855767
> 
> 赞同：323
> 
> 时间：2009-05-13T02:20:27.223
> 
> 标签：git, diff

是否可以要求`git diff`在其差异输出中包含未跟踪的文件，或者我最好的选择是使用`git add`新创建的文件和我编辑过的现有文件，然后使用：

```
git diff --cached 
```

?

* * *

## 回答 #1

> 赞同：310
> 
> 时间：2009-05-13T12:33:14.800

使用最近的 git 版本，您可以`git add -N`使用文件（或`--intent-to-add`），它会在该位置的索引中添加一个长度为零的 blob。结果是您的“未跟踪”文件现在变成了将所有内容添加到这个零长度文件的修改，并且显示在“git diff”输出中。

```
git diff

echo "this is a new file" > new.txt
git diff

git add -N new.txt
git diff
diff --git a/new.txt b/new.txt
index e69de29..3b2aed8 100644
--- a/new.txt
+++ b/new.txt
@@ -0,0 +1 @@
+this is a new file 
```

可悲的是，正如所指出的，`git stash`当您有一个`--intent-to-add`像这样待处理的文件时，您不能这样做。虽然如果您需要存储，您只需添加新文件然后存储它们。或者您可以使用仿真解决方法：

```
git update-index --add --cacheinfo \
100644 e69de29bb2d1d6434b8b29ae775ad8c2e48c5391 new.txt 
```

（在这里设置别名是您的朋友）。

* * *

## 回答 #2

> 赞同：116
> 
> 时间：2009-05-13T04:53:43.630

我相信您可以通过简单地提供两个文件的路径来区分索引中的文件和未跟踪的文件。

```
git diff --no-index tracked_file untracked_file 
```

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2011-02-01T15:46:43.350

对于我的交互式日常 gitting（我一直将工作树与 HEAD 进行比较，并希望将未跟踪的文件包含在 diff 中）`add -N/--intent-to-add`是不可用的，因为它[会破坏](http://git.661346.n2.nabble.com/BUG-git-stash-refuses-to-save-after-quot-add-N-quot-tc3533994.html) `git stash`.

所以这是我的`git diff`替代品。这不是一个特别干净的解决方案，但由于我真的只以交互方式使用它，所以我可以接受 hack：

```
d() {
    if test "$#" = 0; then
        (
            git diff --color
            git ls-files --others --exclude-standard |
                while read -r i; do git diff --color -- /dev/null "$i"; done
        ) | `git config --get core.pager`
    else
        git diff "$@"
    fi
} 
```

键入只会`d`在 diff 中包含未跟踪的文件（这是我在工作流程中关心的），并且`d args...`会像常规`git diff`的 .

笔记：

*   我们在这里使用的事实`git diff`实际上只是连接了单个差异，因此不可能`d`从“真正的差异”中分辨出输出——除了所有未跟踪的文件最后排序的事实。
*   这个函数的唯一问题是即使重定向输出也是彩色的；但我懒得为此添加逻辑。
*   我找不到任何方法来获取包含的未跟踪文件，只需为`git diff`. 如果有人知道如何做到这一点，或者`git`将来某个时候可能会添加某个功能，请在此处留言！

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2016-02-18T14:36:24.483

不是 100%，但如果由于某种原因您不想按照接受的答案的建议将文件添加到索引中，这里是另一种选择：

如果文件未被跟踪，显然 diff 是整个文件，所以你可以用 less 查看它们：

```
less $(git ls-files --others --exclude-standard) 
```

`:n`使用和导航它们之间`:p`的下一个和上一个..

**评论更新：**如果您需要补丁格式，您还可以将其与`git diff`：

```
git ls-files --others --exclude-standard -z | xargs -0 -n 1 git --no-pager diff /dev/null | less 
```

在这种情况下，您还可以将输出重定向到文件或使用其他 diff 命令。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2018-05-23T11:10:36.837

```
git add -A
git diff HEAD 
```

如果需要，生成补丁，然后：

```
git reset HEAD 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2018-08-30T09:42:14.973

对于一个文件：

```
git diff --no-index /dev/null new_file 
```

对于所有新文件：

```
for next in $( git ls-files --others --exclude-standard ) ; do git --no-pager diff --no-index /dev/null $next; done; 
```

作为别名：

```
alias gdnew="for next in \$( git ls-files --others --exclude-standard ) ; do git --no-pager diff --no-index /dev/null \$next; done;" 
```

对于合并为一个命令的所有修改和新文件：

```
{ git --no-pager diff; gdnew } 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2016-06-03T10:42:17.303

这对我有用：

```
git add my_file.txt
git diff --cached my_file.txt
git reset my_file.txt 
```

最后一步是可选的，它将使文件保持以前的状态（未跟踪）

如果您也在创建补丁，这很有用：

```
 git diff --cached my_file.txt > my_file-patch.patch 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-03-03T20:19:54.390

更新：我的答案是分阶段和非分阶段的变化。未跟踪和未跟踪。有关已跟踪/未跟踪的信息，请参阅已接受的答案。留在这里留给后人。

以下内容只会为您提供未暂存的更改：

```
$ git diff 
```

如果您想要暂存和未暂存的更改，请添加`HEAD`到命令：

```
$ git diff HEAD 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-11-02T17:14:27.430

usually when i work with remote location teams it is important for me that i have prior knowledge what change done by other teams in same file, before i follow git stages untrack-->staged-->commit for that i wrote an bash script which help me to avoid unnecessary resolve merge conflict with remote team or make new local branch and compare and merge on main branch

```
#set -x 
branchname=`git branch | grep -F '*' |  awk '{print $2}'`
echo $branchname
git fetch origin ${branchname}
for file in `git status | grep "modified" | awk "{print $2}" `
do
echo "PLEASE CHECK OUT GIT DIFF FOR "$file 
git difftool FETCH_HEAD $file ;
done 
```

in above script i fetch remote main branch (not necessary its master branch)to FETCH_HEAD them make a list of my modified file only and compare modified files to git difftool

here many difftool supported by git, i configure 'Meld Diff Viewer' for good GUI comparison .

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-03-11T13:18:03.310

使用可以暂存新文件并且可以对暂存文件进行比较的想法，您可以将这两者结合起来查看差异。我觉得使用起来很简单。

1.  添加要查看差异的文件。在您的情况下，[仅添加未跟踪的文件](https://stackoverflow.com/a/47123967/8283737)。您可以选择仅添加那些您想查看差异的文件。

    ```
    git stash && git add . && git stash pop 
    ```

2.  区分上演

    ```
    git diff --staged 
    ```

3.  如果需要，重置暂存文件

    ```
    git reset 
    ```

综合以上所有，

```
 git stash && git add . && git stash pop && git diff --staged && git reset 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-12-22T02:23:07.250

如果您碰巧在使用`git stash`（即预提交 git 挂钩）的脚本的上下文中需要这个，那么这对我来说在 macOS Big Sur 上使用 git v2.34.1 效果很好：

```
# Stash unstaged changes
# NOTE: we always create a stash - possibly even a totally empty one.
git stash --keep-index --include-untracked --message="pre-commit auto-stash"
diffTracked=$(git diff --stat --staged stash@{0})
diffUntracked=$(git stash show --only-untracked stash@{0})
[[ $diffTracked || $diffUntracked ]] && {
  echo "Stashed diff:"
  # Ensure diffs have standard coloring:
  git diff --stat --staged stash@{0}
  git stash show --only-untracked stash@{0}
} 
```

* * *

## 回答 #12

> 赞同：-12
> 
> 时间：2015-09-09T22:24:35.180

假设您没有本地提交，

```
git diff origin/master 
```

# ruby - Ruby 的排序方法使用哪种算法？

> ID：855773
> 
> 赞同：47
> 
> 时间：2009-05-13T02:22:27.157
> 
> 标签：ruby, arrays, sorting

当我使用本机方法对数组进行排序时`sort`，Ruby 使用哪种算法？

它是否依赖于数据，即如果数据很小，它使用 X 算法，否则它使用 Y 算法？

是稳定的排序吗？平均时间复杂度是多少？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-05-13T02:34:04.420

看这里：[http ://www.igvita.com/2009/03/26/ruby-algorithms-sorting-trie-heaps/](http://www.igvita.com/2009/03/26/ruby-algorithms-sorting-trie-heaps/)

然而，它本身确实使用快速排序，平均复杂度为 n log n。

# macos - 来自命令行的 Mac OS X 新用户

> ID：855786
> 
> 赞同：10
> 
> 时间：2009-05-13T02:29:32.930
> 
> 标签：macos, command-line

我需要在单用户模式下通过命令行添加一个新用户。我之前重新安装了 OS X，但由于某种原因，它没有正确创建我的用户帐户。现在我无法登录。所以我想知道如何在不重新安装所有内容的情况下创建一个新用户帐户。

我试过了，但没有用： http: [//osxdaily.com/2007/10/29/how-to-add-a-user-from-the-os-x-command-line-works-with -豹/](http://osxdaily.com/2007/10/29/how-to-add-a-user-from-the-os-x-command-line-works-with-leopard/)

提前致谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T07:20:19.350

```
rm /var/db/.AppleSetupDone 
```

...然后正常重启。随着该文件的消失，OS X 将启动其首次运行的设置助手，并且（除其他外）允许您创建一个新帐户。

顺便说一句，原因`niutil`与它是否是服务器无关——这是因为 Apple 在 10.5 中摆脱了 NetInfo（它用于存储本地用户的旧数据库），并用新[的基于 XML 的系统](http://www.afp548.com/article.php?story=LeopardServerReview-LocalDirectory)取而代之. 如果你想`niutil`在 10.5 中做一些类似的事情，你可以使用[`dscl`](http://osxdaily.com/2007/10/29/how-to-add-a-user-from-the-os-x-command-line-works-with-leopard/)（这在单用户模式下实际上有点复杂，因为目录服务没有运行）或手动创建/编辑 XML 文件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2016-08-29T17:03:54.827

从 10.10 开始，您可以使用 sysadminctl 命令添加用户，在这种情况下会提示输入密码并将其添加到管理员组：

```
sudo sysadminctl -addUser collin -password - -admin 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T02:35:05.103

[http://www.macosxhints.com/article.php?story=20030603190314390](http://www.macosxhints.com/article.php?story=20030603190314390)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-16T20:47:51.177

我知道只为这个任务安装 Puppet 是个坏主意，但是如果你是一个 puppet 用户并且你想要一个跨平台的解决方案：

创建文件，`user.pp`，包含：

* * *

```
group { 'jenkins':
  gid        => '507',
}

user { 'jenkins':
  ensure     => present,
  uid        => '507',
  gid        => '507',
  shell      => '/bin/zsh',
  home       => '/Users/jenkins',
} 

file { '/Users/jenkins':
  ensure => directory,
  before => User['jenkins'],
} 
```

* * *

然后执行它：`puppet apply user.pp`。

请注意，您应该根据需要更改用户名 (jenkins) 和 gid/uid。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-06-09T02:05:48.977

似乎如果它没有正确创建您的用户帐户，您可能需要重新安装，以防其他事情没有正确设置。

# r - 在R中，聚合字符串数据的好方法是什么

> ID：855798
> 
> 赞同：1
> 
> 时间：2009-05-13T02:34:55.167
> 
> 标签：r, statistics, s-plus

在 R（或 S-PLUS）中，在数据框中聚合字符串数据的好方法是什么？

考虑以下：

```
myList <- as.data.frame(c("Bob", "Mary", "Bob", "Bob", "Joe")) 
```

我希望输出为：

```
 [Bob,  3
  Mary, 1
  Joe,  1] 
```

目前，我知道如何做到这一点的唯一方法是使用摘要功能。

```
> summary(as.data.frame(myList))

 Bob :3                                
 Joe :1                                
 Mary:1 
```

这感觉就像一个黑客。任何人都可以提出更好的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T07:39:15.987

使用`table`，无需排序：

```
ctable <- table(myList);
counts <- data.frame(Name = names(ctable),Count = as.vector(ctable)); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-24T18:47:00.833

这是上述答案的组合（如蒂埃里所建议）

```
data.frame(table(myList[,1])) 
```

这给了你

```
 Var1 Freq
1  Bob    3
2  Joe    1
3 Mary    1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T03:58:26.170

你的意思是这样吗？

```
myList <- c("Bob", "Mary", "Bob", "Bob", "Joe")
r <- rle(sort(myList))
result <- as.data.frame(cbind(r$values, r$lengths))
names(result) <- c("Name", "Occurrences")
result
  Name Occurrences
1  Bob           3
2  Joe           1
3 Mary           1 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-09-08T04:02:00.900

使用`data.table`

```
myList <- data.frame(v1=c("Bob", "Mary", "Bob", "Bob", "Joe"))
library(data.table)
     v1 N
1:  Bob 3
2: Mary 1
3:  Joe 1 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-03-19T14:22:10.890

使用`sqldf`库：

```
require(sqldf)

myList<- data.frame(v=c("Bob", "Mary", "Bob", "Bob", "Joe"))
sqldf("SELECT v,count(1) FROM myList GROUP BY v") 
```

# python - 请介绍 Perl 或 Ruby 中的多处理库

> ID：855805
> 
> 赞同：5
> 
> 时间：2009-05-13T02:37:32.710
> 
> 标签：python, ruby, perl

在 python 中，我们可以使用多处理模块。如果 Perl 和 Ruby 中有类似的库，你会教它吗？如果您能提供一个简短的示例，我将不胜感激。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-13T02:44:24.023

**红宝石：**

*   [在 Ruby 中处理多个进程](https://stackoverflow.com/questions/710785/working-with-multiple-processes-in-ruby)
*   [并发是 Ruby 中的一个神话](http://www.igvita.com/2008/11/13/concurrency-is-a-myth-in-ruby/)

**珀尔：**

*   [利用多核的力量](http://computationalbiologynews.blogspot.com/2008/07/harnessing-power-of-multicore.html)
*   [为什么 Perl 是一种伟大的并发编程语言](http://t-a-w.blogspot.com/2006/10/why-perl-is-great-language-for.html)

此外，Perl 的线程是本机操作系统线程，因此您可以使用它们来利用多个内核。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-13T04:14:55.940

使用 Perl，您可以选择。一种选择是使用如下流程。我需要查看如何使用线程编写类似的程序，但[http://perldoc.perl.org/perlthrtut.html](http://perldoc.perl.org/perlthrtut.html)应该会给你一个想法。

```
#!/usr/bin/perl

use strict;
use warnings;

use Parallel::ForkManager;

my @data = (0 .. 19);

my $pm = Parallel::ForkManager->new(4);

for my $n ( @data ) {
    my $pid = $pm->start and next;
    warn sprintf "%d^3 = %d\n", $n, slow_cube($n);
    $pm->finish;
}

sub slow_cube {
    my ($n) = @_;

    sleep 1;
    return $n * $n * $n;
}

__END__ 
```

以下使用线程的版本不对创建的线程数使用限制（因为我不知道如何）：

```
#!/usr/bin/perl

use strict;
use warnings;

use threads;

my @data = (0 .. 19);
my @threads = map { 
    threads->new( {context => 'list' }, \&slow_cube, $_ )
} @data;

for my $thr ( @threads ) {
    my ( $n, $ncubed ) = $thr->join;
    print "$n^3 = $ncubed\n";
}

sub slow_cube {
    my ($n) = @_;

    sleep 1;
    return $n, $n * $n * $n;
}

__END__ 
```

有趣的是：

```
TimeThis :  Command Line :  t.pl
TimeThis :  Elapsed Time :  00:00:01.281 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-13T10:01:43.457

查看为 Perl 提供协程的[Coro 。](http://search.cpan.org/dist/Coro/)

这是作者文档的摘录....

> 该模块集合通常管理延续，通常以协作线程的形式（也称为 coros，或在文档中简称为“coro”）。它们类似于内核线程，但（通常）即使在 SMP 机器上也不会同时并行运行。这个模块提供的特定线程风格也保证了它不会在线程之间切换，除非必要，在程序中容易识别的点，所以锁定和并行访问很少成为问题，使得线程编程比使用更安全和更容易其他线程模型。
> 
> 与所谓的“Perl 线程”（实际上不是真正的线程，而只是移植到 unix 的 windows 进程仿真，并充当进程）不同，Coro 提供了完全共享的地址空间，这使得线程之间的通信非常容易。而且 Coro 的线程也很快：在你的 perl 中禁用 Windows 进程仿真代码并使用 Coro 可以很容易地使你的程序速度提高两到四倍。并行矩阵乘法基准在单核上的运行速度比 perl 在使用所有四个核的四核上的伪线程快 300 倍。

对于与上述 Ruby 中类似的内容，请查看Ruby 1.9 附带的[Fiber 。](http://ruby-doc.org/core-1.9/classes/Fiber.html)

这里有两篇关于使用 Fiber 的有趣文章：

*   [ruby 中的纤维协作调度](http://www.igvita.com/2009/05/13/fibers-cooperative-scheduling-in-ruby/)
*   [使用纤维的管道](http://pragdave.blogs.pragprog.com/pragdave/2007/12/pipelines-using.html)

还有一个使用 Coro的[用于 Perl 的 Fiber 。](http://github.com/hakobe/perl-fiber/tree/master)以下是一些关于 Fiber for Perl 的文章（日文）：

*   [关于使用 Coro 为 Perl 编写 Fiber 的博客文章](http://d.hatena.ne.jp/yappo/20090129)
*   [用于 Perl 幻灯片的 Fiber](http://www.slideshare.net/hakobe/perl-1180486)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-31T23:31:29.460

查看 Perl 并行处理库[http://www.openfusion.net/perl/parallel_processing_perl_modules](http://www.openfusion.net/perl/parallel_processing_perl_modules)这个漂亮的摘要页面。我喜欢 Parallel::Forker，它是一个现代且比旧的 Parallel::ForkManager 更强大的库，并且具有更多功能，例如信号子进程。我已经在多个项目中使用过它，它的工作原理完全符合预期。以下是如何使用它的示例：

```
#!/usr/bin/env perl

use strict;
use warnings;
use Parallel::Forker;

my $forker = Parallel::Forker->new(use_sig_child => 1, max_proc => 4);
$SIG{CHLD} = sub {
    Parallel::Forker::sig_child($forker);
};
$SIG{TERM} = sub {
    $forker->kill_tree_all('TERM') if $forker and $forker->in_parent;
    die "Exiting child process...\n";
};
# an example
for (1..10) {
    $forker->schedule(run_on_start => sub {
        # all child process code to run here
    })->ready();
}
# wait for all child processes to finish
$forker->wait_all(); 
```

希望这可以帮助你

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-08T21:31:12.733

[https://github.com/pmahoney/process_shared](https://github.com/pmahoney/process_shared)用于红宝石

# outlook - Outlook 在哪里存储安装了哪些 PST 文件？

> ID：855806
> 
> 赞同：1
> 
> 时间：2009-05-13T02:37:44.787
> 
> 标签：outlook, ms-office, pst

我想以编程方式将 PST 文件添加到一个人的 Outlook 配置文件中。我在这里找到了一些代码：

[http://www.eggheadcafe.com/community/aspnet/65/10030171/try-this-code.aspx](http://www.eggheadcafe.com/community/aspnet/65/10030171/try-this-code.aspx)

虽然这样做了，但它仍然留下了一个问题 - “Outlook 将这个已安装的 PST 文件列表保存在哪里？” 它在注册表中吗？某个地方的配置文件？有人吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T03:00:17.877

这是一个内部实现细节，可能会因版本而异。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-02T21:59:28.327

此代码（来自当前项目）搜索并解码 Unicode 和非 Unicode PST 文件的名称和路径。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Outlook = Microsoft.Office.Interop.Outlook;
using Microsoft.Win32;

namespace PSTRemoval_v2
{
    class PSTRReg
    {
        public RegistryKey regOPs, regPR, regCU, regCP, regCC;

        public Dictionary<string, string> OpenPSTs = new Dictionary<string, string>();

        public Dictionary<string, string> ClosedPSTs = new Dictionary<string, string>();

        public Dictionary<string, string> PurgedPSTs = new Dictionary<string, string>();

        public void ValidRegEntries(Outlook.Application olApp)
        {
            string prf = olApp.Session.CurrentProfileName;  // retrieve current Outlook profile name.  Needed in case user has multiple profiles

            regCU = Registry.CurrentUser;

            regOPs = regCU.CreateSubKey(String.Format(@"Software\Microsoft\Windows NT\CurrentVersion\Windows Messaging Subsystem\Profiles\{0}",prf));

            regPR = regCU.CreateSubKey(String.Format(@"Software\WRT\OutlookAddins\PSTRemoval\{0}", prf));  // create a subkey in the registry for this profile

            regCC = regPR.CreateSubKey(@"ClosedPSTs");
            regCP = regPR.CreateSubKey(@"PurgedPSTs");
        }

        public void OpenPSTs_REG_Read()
        {
            PSTRNet regnet = new PSTRNet();
            regnet.EnumerateNetworkDrives();

            string[] sk = regOPs.GetSubKeyNames();
            foreach (string subkey in sk)
            {
                RegistryKey rk2 = regOPs.OpenSubKey(subkey);
                if (rk2.ValueCount > 0)
                {
                    string[] vn = rk2.GetValueNames();
                    Array.Sort(vn);

                    int bs = Array.BinarySearch(vn, "001f3001"); // search for the PST Name
                    int bs1 = Array.BinarySearch(vn, "001f3006"); // PST Name alternative
                    if ((bs > -1) || (bs1 > -1))
                    {
                        int bs2 = Array.BinarySearch(vn, "001f6700");  // search for the PST Path
                        if (bs2 > -1)
                        {
                            // decode the Name & Path to text strings
                            string PSTName;
                            try { PSTName = decode(vn[bs], rk2); }
                            catch { PSTName = decode(vn[bs1], rk2); }
                            string PSTPath = decode(vn[bs2], rk2);

                            if (regnet.PSTOnNet(PSTPath))  // add the PST to the list if it is on a network drive
                            {
                                try
                                {
                                    OpenPSTs.Add(PSTPath, PSTName);
                                }
                                catch { }
                                regOPs.DeleteSubKey(subkey);  // then delete the entry from the main part of the registry
                            }
                        }
                    }
                }
            }
        }

        public void PSTs_REG_Read(RegistryKey regkey, Dictionary<string, string> entries)
        {
            string[] RK = regkey.GetValueNames();
            if (RK.Length > 0)
                foreach (string ValueName in RK)
                    try { entries.Add(ValueName, regkey.GetValue(ValueName).ToString()); }
                    catch { }
        }

        public void PSTs_Reg_write(RegistryKey regKey, Dictionary<string, string> entries)
        {
            string[] RK_Delete = regKey.GetValueNames();
            if (RK_Delete.Length > 0)
                foreach (string ValueName in RK_Delete)
                    regKey.DeleteValue(ValueName);

            foreach (KeyValuePair<string, string> kvp in entries)
                regKey.SetValue(kvp.Key, kvp.Value);
        }

        private string decode(string value, RegistryKey rk)  // decode registry entries from Unicode to plain text
        {
            byte[] b = (byte[])rk.GetValue(value);

         return Encoding.Unicode.GetString(b);
            }
        }
    }
} 
```

注册表项是`Software\Microsoft\Windows NT\CurrentVersion\Windows Messaging Subsystem\Profiles\<ProfileName>`

001f301 是 unicode PST 的名称

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-01-02T01:08:36.420

顺便说一句，它在注册表中。

# visual-studio - Visual Studio 2008 插件/插件开发 - 入门

> ID：855808
> 
> 赞同：7
> 
> 时间：2009-05-13T02:38:10.887
> 
> 标签：visual-studio, plugins, extensibility, visual-studio-addins

关于[这个 stackoverflow 问题](https://stackoverflow.com/questions/842524/visual-studio-plug-in-to-measure-time-spent-on-solution-project)，我将如何创建自己的 Visual Studio 2008 插件？

我查看了 MSDN 上的 Visual Studio 开发人员中心，但信息量巨大。有很多项目类型，我什至不知道从哪里开始。

**如果我想写一些满足以下要求的东西，我**应该从哪里开始寻找：****

 **1.  在 Visual Studio 中像“服务”一样运行的插件，能够轮询 Visual Studio 以获取信息，并处理 Visual Studio 事件。
2.  我想从 VS 访问的信息包括当前打开的项目、打开的项目以及其他基于解决方案/项目文件的信息。
3.  我希望能够处理的事件是诸如解决方案/项目/单个文件的打开/关闭/编辑/创建/删除之类的。
4.  我还希望能够在每个解决方案的基础上处理与 VS 的任何交互。所以，我想处理与文件的任何交互，甚至是代码编辑，但也只是其他交互，比如菜单，或者只是 IDE 本身。

除了这些，我还希望能够在某处存储数据。这通常在哪里进行？我可以将元数据添加到解决方案文件吗？或者，将此信息保存到数据库的小型本地实例是否有意义，该数据库以某种方式附加到解决方案..？

我只需要朝着正确的方向推动，**这有可能吗？我应该关注 Visual Studio 开发人员中心的哪一部分？我应该检查哪些 API？**

干杯！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T02:51:16.617

加载项可以完成大部分工作。VS2008 中有一个用于创建基本插件的模板。

我有一个加载项，您可以将其下载到解决方案/项目加载事件等中 - 它是免费的，并附带源代码 ( [http://www.huagati.com/projectloader/download/huagatiprojectloader.zip](http://www.huagati.com/projectloader/download/huagatiprojectloader.zip) )。这个特定的加载项检测何时加载项目/解决方案并预加载引用的程序集以解决可能导致 VS2008 崩溃的 CLR 错误。无论如何，它的源代码显示了如何检测您正在寻找的一些事件。

除此之外，关于插件开发和所涉及的所有小怪癖和技巧的权威资源是 Carlos Quintero 的博客 ( [http://msmvps.com/blogs/carlosq/](http://msmvps.com/blogs/carlosq/) ) 和他网站上的“howto”系列文章 ( [http ://www.mztools.com/resources_vsnet_addins.aspx](http://www.mztools.com/resources_vsnet_addins.aspx)）。

Craig Skibo 的博客 ( [http://blogs.msdn.com/craigskibo/](http://blogs.msdn.com/craigskibo/) ) 也有一些有用的提示。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T03:17:34.020

你要：

1.  [Visual Studio 可扩展性开发人员中心](http://msdn.microsoft.com/en-us/vsx/default.aspx)
2.  [VSX 论坛](http://social.msdn.microsoft.com/forums/en-US/vsx/threads/)
3.  [视觉工作室 2008 SDK](http://www.microsoft.com/downloads/details.aspx?FamilyId=59EC6EC3-4273-48A3-BA25-DC925A45584D&displaylang=en)
4.  [Keyvan Nayyeri](http://www.amazon.com/exec/obidos/search-handle-url/ref=ntt_athr_dp_sr_1?%5Fencoding=UTF8&search-type=ss&index=books&field-author=Keyvan%20Nayyeri)的[专业 Visual Studio 可扩展性](https://rads.stackoverflow.com/amzn/click/com/0470230843)

买书，没有别的。

# python - 使用 Django 管理站点自动填充 created_by 字段

> ID：855816
> 
> 赞同：25
> 
> 时间：2009-05-13T02:42:01.097
> 
> 标签：python, django, django-models, django-admin

我想将 Django 管理界面用于一个非常简单的 Web 应用程序，但我无法解决一个不应该那么难解决的问题..

考虑以下：

```
class Contact(models.Model):
    name = models.CharField(max_length=250, blank=False)
    created_by = models.ForeignKey(User, blank=False) 
```

我找不到自动填充 created_by 字段并让 Django 管理员知道它的方法。我见过的大多数方法都意味着重载对象的保存方法并将其传递给请求用户。他们都需要构建您的自定义视图和/或表单。

*最佳情况下，在管理站点*中创建新联系人的表单不应显示 created_by 字段（这很容易）并使用当前用户自动填充它（这似乎比它应该更难）。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-05-13T02:50:42.297

[http://code.djangoproject.com/wiki/CookBookNewformsAdminAndUser](http://code.djangoproject.com/wiki/CookBookNewformsAdminAndUser)

涉及在您的 ModelAdmin 对象上实现保存方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-13T03:04:21.627

您需要为该字段指定一个[默认值，在这种情况下是获取当前用户的方法调用（请参阅 auth 文档以获取当前用户）。](http://docs.djangoproject.com/en/dev/ref/models/fields/#default)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-19T15:40:43.377

我真的想要一个比我在其他地方找到的更好的解决方案，所以我在[Populate user Id question](https://stackoverflow.com/a/12977709/795488)上写了一些中间件实现。我的解决方案不需要更改任何形式或视图。

# java - 这是从 JSR305 使用 javax.annotation 的正确方法吗？

> ID：855818
> 
> 赞同：5
> 
> 时间：2009-05-13T02:44:12.527
> 
> 标签：java, api, annotations

我最近将 JSR305 的 RI 添加到我的项目中，并且一直在向我的接口添加注释，如下所示：

```
public interface AccountService
{
    @Nullable AccountResult consolidate( @Nonnull Date from, @Nonnull Date to )
} 
```

本着 JSR 的精神（如此处所述），您是否认为我通过在接口中使用它们来滥用注释？我想指出返回值可以为 null，但我认为 @Nullable 更适用于“合并”方法。我不会将它们添加到实现中，因为当我编码时，接口的代码是我的指路明灯。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-08-15T22:00:40.493

您可以将“@NonNull String”视为 String 的严格子类。毕竟，任何非空字符串肯定是一个 'instanceof' '@Nullable String'，但是任何 instanceof '@Nullable String' 都可能不是 '@NonNull String' 的一个实例（如果它*是*null 就不会，例如）。

这样看，@Nullable 和@NonNull 是类型信息，因此在接口中是完全合理的。您向实现者表明他们可能返回 null，并且他们不必担心输入 null，并且您向调用者表明他们不能传入 null，并且他们应该期待 null 输出。

当然，虽然这一切都非常合理，但 vanilla javac v1.6 肯定不会像强制实际类型的类型安全那样强制执行任何这些规则。但是可以做梦，或者可以使用 pmd 或 findbugs 之类的工具来验证这些注释。

不过，@NonNull 和 @Nullable 注释对于完整的 nullity 类型系统来说是不够的。我真的不知道为什么 JSR305 没有解决这个问题，但是还有第三种类型：“@MaybeNull”。它会出现在泛型参数中；在其他任何地方，它都与@Nullable 具有相同的含义。

public static void addIfNotNull(List<@MaybeNull T> list, @Nullable T item) { if ( item != null ) list.add(item); }

如果第一个“T”上的注释是“@Nullable”，那么您不能传入非空列表，这将导致 API 相当无用。另一方面，如果是@NonNull，则不能传入一个可为空的列表。实际上，无论你在其中移动什么都没关系，它 (A) 永远不会导致 NullPointerException，并且 (B) 永远不会违反注释。所以，你需要一种表达方式：我不在乎这个特定的“T”是否可以为空；当我读取它时，我会进行空值检查，而且我永远不会写空值，所以没关系。

@MaybeNull 和 @Nullable 之间的区别类似于 '? 在泛型中扩展 Number' 和 'Number'。在泛型之外，它们的含义相同，但在泛型中存在差异。

所以，不要对很快的严格类型检查抱有希望。

@Inherited 仅适用于类，但人们会想象带注释的返回类型和带注释的参数有类似的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-06T20:43:46.937

我认为这取决于您添加注释的原因。

如果您只是添加它们以供参考，以便接口的实现者知道您的预期设计，那很好。

我将注解用于事务处理和安全角色实施，因此我的注解处于实现级别。这样做的好处是，我的 Spring 容器中的 AOP 处理器可以测试这个或那个注释的存在，并应用适当的代理类来执行诸如定义事务边界或确保用户被授权进行某些特定方法调用之类的事情。

因此，如果您打算将任何处理关闭注释的存在或不存在，请确保您的实现已注释。如果仅供参考，只注释接口即可。

# asp.net-mvc - ASP.NET MVC Html.TextBox @class = "MyClass" 不工作

> ID：855819
> 
> 赞同：2
> 
> 时间：2009-05-13T02:44:17.940
> 
> 标签：asp.net-mvc, html-helper

我正在使用 Html.TextBox 帮助器方法针对我的模型生成一个文本框，但是当我传入一个带有如下定义的@class 的匿名 htmlAttributes 类时，该类永远不会被分配。难道我做错了什么？我以相同的方式分配了一个只读属性并且它起作用了。

```
<%= Html.TextBox("LastName", Model.LastName, new { @class = "width-600" })%> 
```

关于我做错了什么的想法？

更新！我在错误的观点上做出改变。这工作正常。确保您在正确的视野中！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T02:55:52.487

我在错误的观点上做出改变。这工作正常。确保您在正确的视野中！

# php - 如何在 PHP 的单独类中调用静态变量？

> ID：855825
> 
> 赞同：1
> 
> 时间：2009-05-13T02:45:53.537
> 
> 标签：php, oop, scope

如何在 PHP 的单独类中访问静态变量？范围解析操作员是不是适合这项工作的工具？例子：

```
class DB {
  static $conn = 'Connection';
}

class User {
  function __construct() {
    DB::conn; //throws "Undefined class constant 'conn' error.
  }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T02:48:58.740

```
DB::$conn 
```

如果它是一个属性，你需要在变量名之前加上 $。

# c# - C# Winforms 透明控件允许点击

> ID：855826
> 
> 赞同：3
> 
> 时间：2009-05-13T02:46:47.450
> 
> 标签：c#, winforms, controls, transparency

我有一个 Winforms 控件，它一开始是完全透明的，但随后会在其上绘制线条。我希望鼠标事件完全忽略控件，而是转到下面的东西（按钮和所有垃圾）。

有没有办法做到这一点？顺便说一句，P/Invoking 的东西会很好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-07T08:16:15.337

我也一直在寻找解决方案。我最接近的是通过**将控件的 Region 属性设置为**透明区域来获得完全透明的区域以进​​行点击。（由这篇文章提供：http: [//bytes.com/topic/visual-basic-net/answers/815914-transparent-user-control-click-through-control-below#post3251154](http://bytes.com/topic/visual-basic-net/answers/815914-transparent-user-control-click-through-control-below#post3251154)）

# linux - execv 与仅运行应用程序之间的区别？

> ID：855829
> 
> 赞同：0
> 
> 时间：2009-05-13T02:48:08.667
> 
> 标签：linux

我们有一个从 inittab 启动的存根，它 execv 是我们的进程。（ARM Linux 内核 2.6.25）

在测试进程时，只有从 inittab 和 execv'd 启动它才会失败。如果在命令行上启动，它每次都能完美运行。

该过程大量使用 SYS V IPC。

我应该注意的两种启动方法之间有什么区别吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T02:59:09.937

正如马修所说，这可能是一个环境变量问题。在这两种情况下都尝试在调用程序之前转储你的环境列表 - 通过存根或“手动”。

顺便说一句，如果您能提供更多信息为什么您的程序确实崩溃了，这会很有帮助。日志文件？核心转储/gdb ? execve 的返回值？

* * *

编辑：其他检查：您确定传递完全相同的参数列表（如果有参数）？

要回答您的问题，这两种方法之间没有区别。实际上，您的 shell fork() 并最终调用 execve() 来启动您的进程，并使用您手动提供的参数以及您在 shell 中设置的环境变量为其提供参数。顺便说一句，通过 init 启动程序时，它可以在机器启动的早期阶段启动它。您确定此时一切都已为您的应用程序的良好运行做好了准备吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T02:50:34.900

会不会是环境变量的问题？如果是这样，请考虑使用带有适当 envp 参数的 execve 或 execle。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T03:17:43.253

环境变量建议非常好 - 特别是我会检查 $PATH 以确保找到您的依赖库（如果有的话）。您可以检查的另一件事是，当您作为 inittab 运行时，您是否在相同的 uid/gid 下运行？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T07:23:25.540

如果你用 shell 脚本替换你的存根？如果它从命令行运行，它应该从 shell 脚本运行，你可以知道它是你的存根还是它在 inittab 中的事实。

这可能是一个控制 tty 问题吗？

shell 脚本的另一个优点是您可以编辑它并[跟踪](http://linux.die.net/man/1/strace)您的程序以查看它失败的地方

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-05T00:20:29.380

是不匹配的内核/库问题。完全重新编译后一切都清理干净了。

# sql - 确定与 T-SQL 中的同一集合连接的项目

> ID：855834
> 
> 赞同：0
> 
> 时间：2009-05-13T02:49:51.063
> 
> 标签：sql, sql-server, tsql, join, set

我正在写一份报告，想知道是否有任何方法可以找到加入相同集合的项目？

例如，在以下查询中，我想查找与同一组产品连接的所有区域：

```
SELECT Area.Name, AggregateSetOfProductsId
FROM Area
INNER JOIN AreaToProduct ON AreaToProduct.AreaId = Area.Id
GROUP BY Area.Id 
```

我能想到的当前最佳解决方案是编写一个自定义聚合，将 ProductId 唯一标识符散列在一起（例如基于某个字节右移然后将它们异或在一起），但我想在去之前我会问是否有更简单的方法通过这。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T05:33:35.377

您可以使用公用表表达式轻松完成此操作。您将使用 FOR XML PATH 创建一个数组，然后使用该数组来识别匹配的产品。像这样：

```
;WITH AreaProductSets
AS
(
SELECT a.AreaID, a.Name, 
                SUBSTRING((SELECT (', ' + CAST(ap.ProductID AS varchar(20)))
                                    FROM AreaToProduct ap
                                    WHERE ap.AreaID = a.AreaID
                                    ORDER BY ap.ProductID
                                    FOR XML PATH ('')), 3, 2000) AS ProductArray
FROM        Area AS a
)
SELECT  SUBSTRING((SELECT   (', ' + CAST(aps2.Name AS varchar(20)))
                                    FROM        AreaProductSets aps2
                                    WHERE   aps2.ProductArray = aps.ProductArray
                                    ORDER BY aps2.AreaID
                                    FOR XML PATH('')), 3, 2000) AS MatchingAreas,
                aps.ProductArray
FROM        (SELECT DISTINCT ProductArray FROM AreaProductSets) AS aps 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T08:27:00.177

您可以使用集合操作来做到这一点。在这里，我向您展示如何从包含完全相同产品的 Northwind 获取所有 orderid（这就是您所追求的，对吧？具有完全相同产品的区域）

```
select distinct o1.orderid 
from orders o1 inner join orders o2 on o1.orderid!=o2.orderid
where not exists
    (
        select * from [order details] od2
        where od2.orderId=o2.Orderid
            and od2.ProductId NOT IN 
            (
                select productid from [order details] od1
                where od1.OrderId=o1.OrderId
            )
    )
    and not exists
    (
        select * from [order details] od1
        where od1.orderId=o1.Orderid
            and od1.ProductId NOT IN 
            (
                select productid from [order details] od2
                where od2.OrderId=o2.OrderId
            )
    ) 
```

这个想法基本上是这样的：返回订单 o1，其中存在订单 o2，其中没有任何产品不在 o1 的产品列表中，并且没有任何来自 o1 的产品不在 o2 的产品列表中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T03:12:36.073

也许使用 EXCEPT 运算符？如果两个集合之间的 EXCEPT 为空，则集合相同。请参阅[http://msdn.microsoft.com/en-us/library/ms188055.aspx](http://msdn.microsoft.com/en-us/library/ms188055.aspx) 此外，要散列结果集，您可以使用内置聚合，如 CHECKSUM_AGG(BINARY_CHECKSUM(*))，请参阅[http://msdn.microsoft。 com/en-us/library/ms188920.aspx](http://msdn.microsoft.com/en-us/library/ms188920.aspx)

# java - Servlet 参数和 doPut

> ID：855835
> 
> 赞同：18
> 
> 时间：2009-05-13T02:50:34.603
> 
> 标签：java, rest, servlets

尝试使用 HttpServlet#doPut 从 PUT 请求中获取参数：

```
public void doPut(HttpServletRequest request, HttpServletResponse response) {
    String name = request.getParameter("name");
    // name is null
} 
```

使用 curl 发送请求：

```
curl  -X PUT \
      --data "name=batman" \
      --header "Content-Type: text/plain" http://localhost:8080/sample.html 
```

使用 doGet 和 GET curl 请求效果很好。我错过了什么吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-13T05:42:58.947

根据评论和进一步的研究，我意识到 Servlet 不能假设任何关于将数据放到服务器上的信息，因此不会解析名称/值对。

以下解决方案似乎是处理通过 PUT 传递的任何数据的正确方法，并且可以解析为 XML、名称/值或其他任何内容。

```
BufferedReader br = new BufferedReader(new InputStreamReader(req.getInputStream());

String data = br.readLine(); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2016-09-26T15:19:28.997

与 in`doGet()`和`doPost()`方法不同，我们无法使用`getParameter()`in`doPut()`和`doDelete()`方法中的方法获取请求参数。我们需要从输入流中手动检索它们。

以下方法检索请求参数并在映射中返回它们：

```
public static Map<String, String> getParameterMap(HttpServletRequest request) {

    BufferedReader br = null;
    Map<String, String> dataMap = null;

    try {

        InputStreamReader reader = new InputStreamReader(
                request.getInputStream());
        br = new BufferedReader(reader);

        String data = br.readLine();

        dataMap = Splitter.on('&')
                .trimResults()
                .withKeyValueSeparator(
                        Splitter.on('=')
                        .limit(2)
                        .trimResults())
                .split(data);

        return dataMap;
    } catch (IOException ex) {
        Logger.getLogger(Utils.class.getName()).log(Level.SEVERE, null, ex);
    } finally {
        if (br != null) {
            try {
                br.close();
            } catch (IOException ex) {
                Logger.getLogger(Utils.class.getName()).log(Level.WARNING, null, ex);
            }
        }
    }

    return dataMap;
} 
```

该示例使用 Google 的 Guava 库来解析参数。有关包含 、 和 方法的完整示例`doGet()`，您`doPost()`可以阅读我的[使用 jsGrid 教程](http://zetcode.com/articles/jsgridservlet/)。`doPut()``doDelete()`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T03:52:30.110

不工作是什么意思`doPut()`？据我所知，它不像`doGet()`or那样工作`doPost()`，你有请求参数和东西。

PUT 可用于在服务器上放置一些东西。具体来说，PUT 操作允许客户端将文件放置在服务器上，类似于通过 FTP 发送文件。看看这个例子，我在 JGuru 上找到的。

```
->GET /file.dat HTTP/1.1

<-HTTP/1.1 404 Not Found

->PUT /file.dat HTTP/1.1
Content-Length: 6
Content-Type: text/plain

Hello!

<-HTTP/1.1 200 OK

->GET /file.dat HTTP/1.1

<-HTTP/1.1 200 OK
Content-Length: 6
Content-Type: text/plain

Hello! 
```

# c# - 使用 C# 泛型进行界面设计

> ID：855840
> 
> 赞同：2
> 
> 时间：2009-05-13T02:51:26.083
> 
> 标签：c#, generics, interface

我目前正在设计一个类库，它将为 C# 中的 Web 应用程序图形渲染引擎提供数据。我目前正在定义这个库的接口。

我有一个 IGraphData 接口，我想使用访问缓存的服务进行缓存，这称为 IGraphDataCacheService 并具有设置和获取方法来添加和检索 IGraphData 对象到缓存中。缓存服务将是一个单例。

我对实现这一点的正确方法感到困惑，因此只有一个缓存服务可以获取和设置通用 IgraphData 对象。

我想出了这个：

```
interface IGraphDataCacheService {

IGraphData<object> Get(string identifier);
void Set(IGraphData<object> graphData);} 
```

或这个：

```
T Get<T, P>(string identifier) where T : IGraphData<P>;
void Set<T,P>(T graphData) where T : IGraphData<P>; 
```

任何人都可以提供任何建议帮助吗？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-13T03:14:03.573

你为什么不把接口变成通用的呢？

```
interface ICacheService<T> {
    T Get(string identifier);
    void Set(T graphData);
} 
```

如果您愿意，您可以将 T 类型约束为 IGraphData 类型，或者您可以将其写为：

```
interface IGraphDataCacheService<T> {
    IGraphData<T> Get(string identifier);
    void Set(IGraphData<T> graphData);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T03:09:54.720

几点：

1.  我可能会将接口方法重命名为更具象征意义的缓存服务。例如，`Fetch`and`Store`而不是`Get`and `Set`，这听起来像是您正在获取或设置提供程序而不是要缓存的数据。

2.  确保只有一个缓存是一个实现细节，而不是一个接口。

要实现单例，请尝试以下操作：

```
public class SingletonCacheService : IGraphDataCacheService {
   private static Singleton instance;

   private Singleton() {}

   // snip implementation of IGraphDataCacheService methods ...

   public static Singleton Instance {
      get {
         if (instance == null) {
            instance = new Singleton();
         }
         return instance;
      }
   }
} 
```

请注意，这个简单的版本不是线程安全的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T03:10:33.910

这两种选择一目了然。我的直觉是您需要编写一些“典型”客户端代码来决定。例如，典型的客户是否“知道”与它正在查找的标识符相关的数据类型？良好的 API 设计需要确定主要使用场景并使用它来通知设计。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T03:31:17.407

如果我正确理解您的问题，您希望将泛型类型视为相同，但在当前的 .NET 实现中，您不能这样做。

IGraphData<string> 不能作为 IGraphData<object> 传递，即使 string 是一个对象，它们实际上是不同的类型，泛型类型不相关，也不能像它们一样被强制转换或传递。

如果您控制 IGraphData 接口，则可以创建一个 IGraphData 接口并从中派生 IGraphData 并使用 IGraphData 访问缓存。这仅取决于您如何使用它以及您可以控制什么。

你可以在 C# 4.0 中做你想做的事。[这里](http://blogs.msdn.com/charlie/archive/2008/10/28/linq-farm-covariance-and-contravariance-in-visual-studio-2010.aspx)有一篇关于它的文章

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T03:12:37.493

您不能确保只有一个实例实现接口。但是，您可以通过密封接口并仅提供一个 getter 属性来使*实现接口*的类（例如 GraphDataCacheServiceImpl）成为单例，并将对象创建为来自私有构造函数的静态变量。见下文。就泛型而言，尚不清楚您要完成什么。但我想下面的内容接近你想要的。

```
interface IGraphDataCacheService<T> {

IGraphData<T> Get(string identifier);
void Set(IGraphData<T> graphData);

}

public sealed class GraphDataCacheServiceImpl<T> : IGraphDataCacheService<T>
{

  private GraphDataCacheServiceImpl()
  {
      // ..
  }

  static GraphDataCacheServiceImpl()
  {
    Instance = new GraphDataCacheServiceImpl<T>();
  }

  public IGraphData<T> Get(string id)
  {
      return new GraphDataImpl<T>();
  }

  public void Set(IGraphData<T> graphData)
  {
  }

  public static GraphDataCacheServiceImpl<T> Instance {get; private set;}
} 
```

# java - 负载平衡 Web 应用程序

> ID：855841
> 
> 赞同：17
> 
> 时间：2009-05-13T02:52:21.887
> 
> 标签：java, tomcat, load-balancing

有负载平衡的 Tomcat Web 服务器。每个请求都可以由不同的 tomcat 服务器提供服务。

在为基于 j2ee (struts) 的 Web 应用程序编写代码时，我们如何处理这个问题？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-13T03:00:56.160

首先，您需要为会话关联/粘性会话设置负载均衡器，以便它根据 JSESSIONID 继续将所有请求转发到同一个 Tomcat（只要它启动）。

[Tomcat 集群文档](http://tomcat.apache.org/tomcat-6.0-doc/cluster-howto.html)说明了应用程序成功复制其会话的两个重要要求：

*   您的所有会话属性都必须实现`java.io.Serializable`
*   确保您的 web.xml 具有`<distributable/>`元素或设置在您的`<Context distributable="true" />`

如果您开始将对象放入未实现的 Session 中`Serializable`（或具有未实现的属性/字段`Serializable`），那么您将遇到问题。

（实际上，无论您使用哪个 servlet 容器，我相信这些点都适用。）

**更新：**为了解决评论中关于为什么在平衡多个服务器之间的负载时使用粘性会话的一些问题，我认为用一个例子来解释这一点是最简单的。

首先，这只有在您的应用程序在会话中保留某种数据时才真正重要，这可能不是每个应用程序（尽管可能是大多数）。如果您不在会话中保留数据，那么您可能不会关心这些，您可以在这里停止阅读。

拥有一个将数据保存在会话中但*没有*粘性会话的环境会打开一个令人头疼的世界。

假设`first.jsp`更新特定会话属性中的某些值，并且`second.jsp`碰巧读取了相同的会话属性。您可以设置 Tomcat 将会话数据复制到集群中的所有服务器，但这种复制不会立即发生。如果初始请求`first.jsp`由 处理，`server1`完成后一纳秒，同一访问者向 发出请求`second.jsp`，在您的非粘性环境中由 处理`server2`。由于复制不是即时的，您是否有任何方法知道您是否正在读取最新的会话数据？您是否必须添加某种逻辑来同步集群中的读取？这将成为巨大的痛苦。

设置会话亲和性/粘性会话消除了这个令人头疼的问题；通过使来自同一客户端服务器的所有请求由同一节点发出，您不必担心“该节点在处理请求时是否是最新的？” 当节点发生故障时，客户端仍然可以故障转移到集群中的另一个节点，该节点具有其会话数据的副本，但是对于粘性会话，这成为罕见的情况，而不是常态。

需要粘性会话还有另一个原因：集群中节点之间的负载。如果会话中的请求可以由任何节点处理，那么这意味着您在集群中设置了全对全复制（意味着节点1的会话数据被复制到节点2、节点3、...、节点N, node2 的会话数据被复制到 node1, node3, ... none N, etc)。当集群变大时，全对全会话复制可能会占用带宽和资源，因为集群中的每个添加都意味着另一个节点需要与集群中的每个其他单个节点进行通信。

另一种方法是将节点的数据复制到集群中的几个“伙伴”，这样如果节点发生故障，它的数据就可以在其他地方使用，但每个节点都不必有一个副本。在这种情况下，您将配置集群，以便节点 1 将其数据复制到节点 2 和 3，节点 2 将其数据复制到节点 3 和 4，依此类推，形成一个链。在这种情况下，向集群添加额外的节点不会导致节点之间的通信量像在 all-to-all 方案中那样迅速增加。

# visual-studio - 递归nmake目标

> ID：855847
> 
> 赞同：0
> 
> 时间：2009-05-13T02:53:51.650
> 
> 标签：visual-studio, makefile, visual-c++, nmake

通过 $(MAKE) 宏递归调用 nmake 时，如何将命令行中指定的目标传递给新实例？

所以，假设我从命令行执行以下命令：

c:\n清理

我希望对 nmake 的递归调用将“干净”目标传递给新的 nmake 实例。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T03:19:12.363

你可以这样写规则：

```
clean all:
    cd dir1 && $(MAKE) $*
    cd dir2 && $(MAKE) $* 
```

$* 将替换为目标名称（本例中为“clean”或“clean”）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T03:08:01.730

我不确定我是否理解这个问题，但您通常拥有规则，因为您执行 makefile 的特定部分，例如：

```
clean:
    cd dir1 && $(MAKE) clean
    cd dir2 && $(MAKE) clean

all:
    cd dir1 && $(MAKE) all
    cd dir2 && $(MAKE) all 
```

如果您的 makefile 中有*其他*设置，最好将其发布，以便我们进行更好的分析。

# c# - 如何在 Excel 中显示 SQL 报告服务报告

> ID：855857
> 
> 赞同：0
> 
> 时间：2009-05-13T02:58:42.887
> 
> 标签：c#, .net, excel, reporting-services

目前我正在使用 VSTO 获取 SQL Reporting Services 报告并使用 ReportViewer 控件在 Excel 2003 中显示它。所以基本上是在 Excel 中托管的 winform 上。

但我还需要能够在没有 ReportViewer 控件的情况下显示它，即直接进入我的 Excel 工作表的单元格。

我想知道我该怎么做。

我可以检索 CSV 格式的报告。那么我是否应该循环浏览 cvs 格式的报告并逐行直接插入到我的 Excel 工作表中，还是有更好的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T03:58:17.340

您可能想看看[我在](http://theruntime.com/blogs/jacob/archive/2007/12/07/printing-reporting-services-2005-reports.aspx)没有用户输入的情况下尝试打印 RS 报告所做的事情。它使用 RS 的 Web 服务端点将报告传送到应用程序中。唯一的区别是，您将[在 render call](http://msdn.microsoft.com/en-us/library/reportexecution2005.reportexecutionservice.render.aspx)上使用 EXCEL 格式，而不是使用 IMAGE 格式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T03:28:58.363

在 Web 浏览器中查看 Reporting Services 报告时，报告顶部有一个导出选项。Excel 是这些选项之一。它甚至可以导出格式。请注意，这是针对 SSRS 2005 - 我不知道 SSRS 2008 中是否有任何变化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T08:49:30.267

您不能直接将数据转储到 Excel 中[`CopyFromRecordset`](http://msdn.microsoft.com/de-de/library/microsoft.office.interop.excel.range.copyfromrecordset.aspx)吗？

# assemblies - 产品管理和装配版本

> ID：855867
> 
> 赞同：0
> 
> 时间：2009-05-13T03:04:27.913
> 
> 标签：assemblies, release-management

我们正在接近我们公司新产品的初始版本，我正在尝试确定管理所有不同组件版本的最佳方法，并将这些组件与我们软件的营销部门版本进行交叉引用。由于各种原因，营销部门已确定我们产品的初始版本为 10.1，但所有组件最初都将从 1.0.0 开始。通过正常的 bug 修复和补丁以及持续的开发工作，不同的组件将不再具有相同的版本号，所以当市场部决定是 10.2 版本时，它可能包含 1.1.54、1.2.32、1.8.2、等等。显然，我可以使用一个简单的电子表格，但这并不是最用户友好的方法，

是否有更“专业”的方法，或者简单的电子表格是最佳选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-29T20:25:57.077

我建议的主要原则是：尽可能使用最简单的方案。

考虑为您自己、您的营销部门和您的用户简化事情。

当你发布一个版本时，增加主要/次要版本号，然后在你的所有组件上标记它。所以在 10.1 版本中，所有程序集的版本号都是 10.1.xx.yy

然后，如果您真的想在一个版本中使用不同版本使问题复杂化（例如，对于较小的补丁/更新、不同的客户变体，或者只是用于内部日常或 CI 构建），那么使用 xx.yy 字段。（例如，在许多情况下，您可以让编译器使用编译日期/时间自动填充这两个字段）。

这意味着您有一个有意义的“营销版本”，它实际上与您的代码版本相关联（因此您和营销人员可以讨论特定版本而不会产生任何混淆），并且您可以添加额外信息（例如构建日期）如果（并且仅当）在开发方面需要。

编辑：PS 即使一个组件没有改变，用新的版本号重建它。试图跟踪一百个不同步的版本号是可以避免的噩梦。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T03:54:54.723

为什么不保留所有组件的“随机”版本号，并创建一个包含所有组件的营销版本的超级标签/标签？这允许您在营销构建之间不断更新组件并增加其构建版本（无需转到客户可能可见的 10.1.001、10.1.002）并跟踪营销构建。此外，如果您为下一个营销构建更新了一些组件，而不是其他组件，会发生什么？您是否需要构建这些组件只是为了更新版本号？

根据您的源代码控制系统，您应该能够轻松创建具有指定名称/版本的版本，其中包含不同版本的所有这些组件。

您还应该只需要使用营销内部版本号更新一个属性文件，以便它显示在所有关于屏幕、启动屏幕、工具栏等的信息上。如果您没有这样的配置，您可能想要移动到这样一个系统。这允许轻松更改客户可见编号，同时保留所有组件构建编号。此外，当营销部门确定下一个版本不是 10.2 而是“Crimson”时会发生什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T03:10:08.277

在我工作过的地方，我们会强制软件版本号与官方的公开（即市场营销）版本号相匹配：如果他们想要发布“10.1”，那么这就是我们将软件的版本资源设置为，作为发布版本的一部分。

# mysql - 如何在 MySQL 中合并两个部分重叠的列表？

> ID：855871
> 
> 赞同：1
> 
> 时间：2009-05-13T03:06:05.040
> 
> 标签：mysql

好的，所以我有两个具有相同结构的表（实际上是视图）。每个都有一个带有日期的列和一个带有数值的列。

两个表中的日期几乎是连续的并且涵盖同一时期。因此，数据将大致相同，但一个表格中的日期可能不会出现在另一个表格中。

我想要一张表，有一个日期列和两个数字列。如果一个表中没有日期，则对应的数字字段应为空。

有什么办法吗？

* * *

PS 这不是同一个问题：[如何合并两个 MySQL 表？](https://stackoverflow.com/questions/725556/how-can-i-merge-two-mysql-tables)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T07:39:29.163

*VladiatOr*的解决方案可以通过让第一部分选择记录在两者中且仅在第一个表中存在，然后添加仅存在于第二个表中的记录来缩短。

```
SELECT t1.td, t1.val as val1, t2.val as val2
  FROM table1 as t1
  LEFT JOIN table2 as t2
  ON t1.td = t2.td
UNION
SELECT t2.td, t1.val as val1, t2.val as val2
  FROM table2 as t2
  LEFT JOIN table1 as t1
  ON t2.td = t1.td
WHERE t1.td IS NULL 
```

另请参阅[MySQL Reference on JOIN Syntax中](http://dev.mysql.com/doc/refman/5.1/en/join.html)*Tobias Riemenschneider*的评论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T03:44:14.777

此查询是 3 个查询的联合：​​第一个查询连接两个表中共有的记录。第二个添加仅存在于 table1 中的那些。第三个添加仅在 table2 中的记录。

```
SELECT t1.td, t1.val as val1, t2.val as val2
FROM table1 as t1, table2 as t2
WHERE t1.dt = t2.dt
UNION
SELECT t1.td, t1.val as val1, null as val2
FROM table1 as t1
LEFT JOIN table2 as t2
ON t1.td = t2.td
WHERE t2.td IS NULL
UNION
SELECT t2.td, null as val1, t2.val as val2
FROM table2 as t2
LEFT JOIN table1 as t1
ON t2.td = t1.td
WHERE t1.td IS NULL 
```

# php - 是否有可用于 PHP 或 Ruby 的网络爬虫库？

> ID：855873
> 
> 赞同：2
> 
> 时间：2009-05-13T03:06:20.830
> 
> 标签：php, ruby, web-crawler

是否有可用于 PHP 或 Ruby 的网络爬虫库？一个可以在深度优先或广度优先的库......即使使用 href="../relative_path.html" 和基本 url 也可以处理链接。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T03:09:34.630

[http://phpcrawl.cuab.de/](http://phpcrawl.cuab.de/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T03:08:58.140

查看此页面以获取 Ruby 库：[Ruby Mechanize](http://mechanize.rubyforge.org/)

我想提一下，您仍然需要对爬虫遍历网站的方式负责。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-24T05:18:03.423

你可以在 ruby​​ 中使用 webrat 或 watir，比机械化容易得多

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-15T07:32:09.640

如果你想学习基本的网络爬虫和搜索东西，你可以开始看“luna引擎”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-04-15T13:41:17.983

如果您需要抓取使用 javascript 的网页，您可以使用[Capybara](https://github.com/jnicklas/capybara)和驱动程序，该驱动程序将启动一个真正的浏览器，例如[poltergeist](https://github.com/teampoltergeist/poltergeist)。它通常与测试框架一起用于验收测试，但也可以在测试框架之外使用。

# memory - 内在 memcmp

> ID：855895
> 
> 赞同：6
> 
> 时间：2009-05-13T03:18:12.847
> 
> 标签：memory, gcc, intrinsics

根据[gcc docs](http://gcc.gnu.org/onlinedocs/gcc-4.4.0/gcc/X86-Built_002din-Functions.html)， memcmp 不是 GCC 的内在功能。如果您想在 gcc 下加速 glibc 的 memcmp，则需要使用文档中定义的较低级别的内在函数。但是，在网上搜索时，似乎很多人都认为 memcmp 是一个内置函数。它适用于某些编译器而不适用于其他编译器吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-06-13T18:15:59.657

请注意，repz cmpsb 例程可能不会比 glibc 的 memcmp 快。事实上，在我的测试中，它*从来没有*更快，即使只比较几个字节。

见[http://gcc.gnu.org/bugzilla/show_bug.cgi?id=43052](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=43052)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-13T03:26:27.323

您的链接似乎是针对特定于 x86 体系结构的内置函数的，根据[这个](http://ftp.sunsite.ualberta.ca/Documentation/Gnu/gcc-3.0.2/html_node/gcc_113.html)memcmp 是由 gcc 实现为与体系结构无关的内置函数。

编辑：

使用 Cygwin gcc 版本 3.3.1 for i686 编译以下代码，-O2：

```
#include <stdlib.h>

struct foo {
    int a;
    int b;
} ;

int func(struct foo *x, struct foo *y)
{
    return memcmp(x, y, sizeof (struct foo));
} 
```

产生以下输出（注意对 memcmp() 的调用被转换为 8 字节的“repz cmpsb”）：

```
 0:   55                      push   %ebp
   1:   b9 08 00 00 00          mov    $0x8,%ecx
   6:   89 e5                   mov    %esp,%ebp
   8:   fc                      cld    
   9:   83 ec 08                sub    $0x8,%esp
   c:   89 34 24                mov    %esi,(%esp)
   f:   8b 75 08                mov    0x8(%ebp),%esi
  12:   89 7c 24 04             mov    %edi,0x4(%esp)
  16:   8b 7d 0c                mov    0xc(%ebp),%edi
  19:   f3 a6                   repz cmpsb %es:(%edi),%ds:(%esi)
  1b:   0f 92 c0                setb   %al
  1e:   8b 34 24                mov    (%esp),%esi
  21:   8b 7c 24 04             mov    0x4(%esp),%edi
  25:   0f 97 c2                seta   %dl
  28:   89 ec                   mov    %ebp,%esp
  2a:   5d                      pop    %ebp
  2b:   28 c2                   sub    %al,%dl
  2d:   0f be c2                movsbl %dl,%eax
  30:   c3                      ret    
  31:   90                      nop 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-05-11T20:59:34.613

现在在 2017 年，GCC 和 Clang 似乎对大小为 1、2、4、8 和其他一些（例如 3、5 和 8 的倍数）的缓冲区进行了一些优化。

# queue - 不使用队列是否可以进行广度优先搜索或广度优先遍历？

> ID：855899
> 
> 赞同：4
> 
> 时间：2009-05-13T03:19:51.720
> 
> 标签：queue, web-crawler, breadth-first-search

我记得并检查过，遍历树或首先爬取网络广度 (BFS) 的常用方法是使用队列。实际上有没有一种方法可以不使用队列来实现它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-06-11T05:10:13.583

我知道这个问题现在很老了，但我只是想回答。您可以使用数组、链表（或任何其他线性容器）来执行此操作，而无需递归。保留两个容器，`old`和`new`，并`old`在`new`遍历`old`. 与队列的实现非常相似。

在 Python 中，它看起来像：

```
def breadth_first(root):
    if not root:
        return
    old = []
    new = []
    old.append(root)
    while old:
        for n in old:
            process(n)  # Do something
            if n.left:
                new.append(n.left)
            if n.right:
                new.append(n.right)
        old = new
        new = [] 
```

运行时复杂度与队列实现相同，O(n)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-13T03:30:27.957

你真的应该使用队列，因为它更容易实现。此外，队列允许多台机器一起工作（一个队列站点，而另一个从队列中弹出站点以进行遍历）。

我看到的唯一另一种方法是使用递归（要困难得多，并且只使用或多或少的内存）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T03:29:59.953

带递归。但是队列在堆栈中......

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2015-06-08T04:41:13.723

如果您关心订购，请使用队列。queue 保留插入顺序。或者您可以使用列表的实现，例如两个数组列表来交替。但从根本上说，list 也保留了排序。

如果您不关心排序，则可以使用任何集合实现。sets 不保留此顺序。

例如，在 BFS 实现中，如果你不关心节点的顺序，你可以使用两个集合，旧的和新的来交替，而不是一个队列。

# c# - 查找字符串数组的哪个单元格包含文本的最佳方法

> ID：855901
> 
> 赞同：1
> 
> 时间：2009-05-13T03:21:19.957
> 
> 标签：c#, arrays, methods, find, gedcom

我有一段从 Gedcom（[此处](http://en.wikipedia.org/wiki/GEDCOM)和[此处](https://stackoverflow.com/questions/836146/gedcom-reader-for-c)）文件中获取的文本

文字扁平化，基本分成“节点”

我在 \r char 上拆分每个节点，从而将其细分为每个部分（“行”的数量可能会有所不同）

我知道 0 地址将始终是 ID，但之后一切都可以在任何地方，所以我想测试数组的每个单元格，看看它是否包含正确的标签供我处理

两个节点的外观示例

```

```
0 @ind23815@ INDI <<<<<<<<<<<<<<<<<<< Start of node 1
1 NAME Lawrence /Hucstepe/
2 DISPLAY Lawrence Hucstepe
2 GIVN Lawrence
2 SURN Hucstepe
1 POSITION -850,-210
2 BOUNDARY_RECT (-887,-177),(-813,-257)
1 SEX M
1 BIRT 
2 DATE 1521
1 DEAT Y
2 DATE 1559
1 NOTE     * Born: Abt 1521, Kent, England
2 CONT     * Marriage: Jane Pope 17 Aug 1546, Kent, England
2 CONT     * Died: Bef 1559, Kent, England
2 CONT 
1 FAMS @fam08318@
0 @ind23816@ INDI  <<<<<<<<<<<<<<<<<<<<<<< Start of Node 2
1 NAME Jane /Pope/
2 DISPLAY Jane Pope
2 GIVN Jane
2 SURN Pope
1 POSITION -750,-210
2 BOUNDARY_RECT (-787,-177),(-713,-257)
1 SEX F
1 BIRT 
2 DATE 1525
1 DEAT Y
2 DATE 1609
1 NOTE     * Born: Abt 1525, Tenterden, Kent, England
2 CONT     * Marriage: Lawrence Hucstepe 17 Aug 1546, Kent, England
2 CONT     * Died: 23 Oct 1609
2 CONT 
1 FAMS @fam08318@
0 @ind23817@ INDI  <<<<<<<<<<< start of Node 3 
```

所以当我完成后，我有一个看起来像的数组

```
address , string
0 = "1 NAME Lawrence /Hucstepe/"
1 = "2 DISPLAY Lawrence Hucstepe"
2 = "2 GIVN Lawrence"
3 = "2 SURN Hucstepe"
4 = "1 POSITION -850,-210"
5 = "2 BOUNDARY_RECT (-887,-177),(-813,-257)"
6 = "1 SEX M"
7 = "1 BIRT "
8 = "1 FAMS @fam08318@" 
```

所以我的问题是搜索上述数组以查看哪个 Cell 具有 SEX 标签或 NAME 标签或 FAMS 标签的最佳方法是什么

这是我的代码

```
private int FindIndexinArray(string[] Arr, string search)
{
    int Val = -1;
    for (int i = 0; i < Arr.Length; i++)
    {
        if (Arr[i].Contains(search))
        {
            Val = i;
        }
    }
    return Val;
} 
```

但这似乎效率低下，因为我最终调用它两次以确保它不会返回 -1

像这样

 if (FindIndexinArray(SubNode, "1 BIRT ") != -1)
            {
                // add birthday to Struct 
                I.BirthDay = SubNode[FindIndexinArray(SubNode, "1 BIRT ") + 1].Replace("2 DATE ", "").Trim();
            } 
```

对不起，这是一个较长的帖子，但希望你们能得到一些专家建议

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T03:37:29.673

一个简单的[正则表达式](http://msdn.microsoft.com/en-us/library/kweb790z.aspx)呢？

```
^(\d)\s=\s\"\d\s(SEX|BIRT|FAMS){1}.*$ 
```

第一组捕获地址，第二组捕获标签。

此外，将所有数组项转储到一个字符串中并一次对整个批次执行正则表达式可能会更快。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T03:47:00.730

可以使用 Array 类的静态方法 FindAll：如果可行，它将返回字符串本身。

```
string[] test = { "Sex", "Love", "Rock and Roll", "Drugs", "Computer"};
Array.FindAll(test, item => item.Contains("Sex") || item.Contains("Drugs") || item.Contains("Computer")); 
```

=> 表示 lamda 表达式。基本上是一种没有具体实现的方法。如果 lamda 让你毛骨悚然，你也可以这样做。

```
//Declare a method 

     private bool HasTag(string s)
     {
         return s.Contains("Sex") || s.Contains("Drugs") || s.Contains("Computer");
     }

     string[] test = { "Sex", "Love", "Rock and Roll", "Drugs", "Computer"};
     Array.FindAll(test, HasTag); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T04:29:27.727

> “但它似乎效率低下，因为我最终调用它两次以确保它不会返回 -1”

在测试之前将返回的值复制到变量中以防止多次调用。

```
IndexResults = FindIndexinArray(SubNode, "1 BIRT ")
if (IndexResults != -1)
        {
            // add birthday to Struct 
            I.BirthDay = SubNode[IndexResults].Replace("2 DATE ", "").Trim();
        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T04:42:37.953

如果您只对第一个匹配项感兴趣，则 FindIndexinArray shd 方法中的 for 循环会在您找到匹配项后中断。

# javascript - Javascript - 异步调用后同步

> ID：855904
> 
> 赞同：20
> 
> 时间：2009-05-13T03:23:14.243
> 
> 标签：javascript, asynchronous, callback, synchronous

我有一个 Javascript 对象，它需要 2 次调用外部服务器来构建其内容并做任何有意义的事情。该对象的构建使得实例化它的实例将自动进行这两个调用。这两个调用共享一个通用的回调函数，该函数对返回的数据进行操作，然后调用另一个方法。问题是在两个方法都返回之前不应该调用下一个方法。这是我目前实现的代码：

```
foo.bar.Object = function() {
this.currentCallbacks = 0;
this.expectedCallbacks = 2;

this.function1 = function() {
    // do stuff
    var me = this;
    foo.bar.sendRequest(new RequestObject, function(resp) {
        me.commonCallback(resp);
        });
};

this.function2 = function() {
    // do stuff
    var me = this;
    foo.bar.sendRequest(new RequestObject, function(resp) {
        me.commonCallback(resp);
        });
};

this.commonCallback = function(resp) {
    this.currentCallbacks++;
    // do stuff
    if (this.currentCallbacks == this.expectedCallbacks) {
        // call new method
    }
};

this.function1();
this.function2();
} 
```

如您所见，在两个调用都返回后，我强制对象继续使用一个简单的计数器来验证它们都已返回。这可行，但似乎是一个非常糟糕的实现。我现在只使用 Javascript 几个星期，想知道是否有更好的方法来做同样的事情，我还没有偶然发现。

感谢您的任何帮助。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-13T04:30:00.097

除非您愿意序列化 AJAX，否则我想不出其他方法来执行您的建议。话虽这么说，我认为你所拥有的相当不错，但你可能想要稍微清理一下结构，以免用初始化数据乱扔你正在创建的对象。

这是一个可能对您有所帮助的功能：

```
function gate(fn, number_of_calls_before_opening) {
    return function() {
        arguments.callee._call_count = (arguments.callee._call_count || 0) + 1;
        if (arguments.callee._call_count >= number_of_calls_before_opening)
            fn.apply(null, arguments);
    };
} 
```

这个函数就是所谓的高阶函数——一个将函数作为参数的函数。此特定函数返回一个函数，该函数在被调用时调用传递的函数`number_of_calls_before_opening`。例如：

```
var f = gate(function(arg) { alert(arg); }, 2);
f('hello');
f('world'); // An alert will popup for this call. 
```

您可以将其用作回调方法：

```
foo.bar = function() {
    var callback = gate(this.method, 2);
    sendAjax(new Request(), callback);
    sendAjax(new Request(), callback);
} 
```

第二个回调，无论是哪个，都会确保`method`被调用。但这会导致另一个问题：该`gate`函数在没有任何上下文的情况下调用传递的函数，这意味着`this`将引用全局对象，而不是您正在构造的对象。有几种方法可以解决这个问题：您可以`this`通过将其别名为`me`或来关闭它`self`。或者您可以创建*另一个*执行此操作的高阶函数。

这是第一个案例的样子：

```
foo.bar = function() {
    var me = this;        
    var callback = gate(function(a,b,c) { me.method(a,b,c); }, 2);

    sendAjax(new Request(), callback);
    sendAjax(new Request(), callback);
} 
```

在后一种情况下，另一个高阶函数将类似于以下内容：

```
function bind_context(context, fn) {
    return function() {
        return fn.apply(context, arguments);
    };
} 
```

此函数返回一个函数，该函数在传递的上下文中调用传递的函数。它的一个例子如下：

```
var obj = {};
var func = function(name) { this.name = name; };
var method = bind_context(obj, func);
method('Your Name!');
alert(obj.name); // Your Name! 
```

为了正确看待它，您的代码如下所示：

```
foo.bar = function() {
    var callback = gate(bind_context(this, this.method), 2);

    sendAjax(new Request(), callback);
    sendAjax(new Request(), callback);
} 
```

无论如何，一旦您进行了这些重构，您将清除正在构造的对象，其中包含仅在初始化时需要的所有成员。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-12-20T10:44:29.220

我可以补充一点，[Underscore.js 有一个很好的小帮手](http://documentcloud.github.com/underscore/#after)：

> 创建仅在第一次调用 count 次后才运行的函数版本。**对于分组异步响应很有用，您希望在继续之前确保所有异步调用都已完成**。

```
_.after(count, function) 
```

`_after`（截至版本 1.5.0）的代码：

```
_.after = function(times, func) {
  return function() {
    if (--times < 1) {
      return func.apply(this, arguments);
    }
  };
}; 
```

[许可证信息](https://github.com/jashkenas/underscore/blob/1.5.0/LICENSE)（截至 1.5.0 版）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-13T05:58:59.797

除了拥有这个计数器之外，几乎没有其他方法。另一种选择是使用对象 {} 并为每个请求添加一个键，如果完成则将其删除。这样您就可以立即知道哪个返回了。但解决方案保持不变。

您可以稍微更改代码。如果在您的示例中，您只需要在 commonCallback 中调用另一个函数（我将其称为 otherFunction），那么您就不需要 commonCallback。为了保存上下文，您已经使用了闭包。代替

```
foo.bar.sendRequest(new RequestObject, function(resp) {
            me.commonCallback(resp);
            }); 
```

你可以这样做

```
foo.bar.sendRequest(new RequestObject, function(resp) {
            --me.expectedCallbacks || me.otherFunction(resp);
            }); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-04-12T17:03:01.290

这是凯尔先生的一些好东西。

为了简单一点，我通常使用 Start 和 Done 函数。
- **Start**函数采用将要执行的函数列表。
- **Done**函数由您传递给 start 方法的函数的回调调用。
- 此外，您可以将一个函数或函数列表传递给将在最后一个回调完成时执行的 done 方法。

声明如下所示。

```
var PendingRequests = 0;
function Start(Requests) {
    PendingRequests = Requests.length;
    for (var i = 0; i < Requests.length; i++)
        Requests[i]();
};
//Called when async responses complete. 
function Done(CompletedEvents) {
PendingRequests--;
    if (PendingRequests == 0) {
        for (var i = 0; i < CompletedEvents.length; i++)
            CompletedEvents[i]();
    }
} 
```

这是一个使用 google maps api 的简单示例。

```
//Variables
var originAddress = "*Some address/zip code here*"; //Location A
var formattedAddress; //Formatted address of Location B
var distance; //Distance between A and B
var location; //Location B

//This is the start function above. Passing an array of two functions defined below.
Start(new Array(GetPlaceDetails, GetDistances));

//This function makes a request to get detailed information on a place. 
//Then callsback with the **GetPlaceDetailsComplete** function
function GetPlaceDetails() {
    var request = {
        reference: location.reference //Google maps reference id
    };
    var PlacesService = new google.maps.places.PlacesService(Map);
    PlacesService.getDetails(request, GetPlaceDetailsComplete);
}

function GetPlaceDetailsComplete(place, status) {
    if (status == google.maps.places.PlacesServiceStatus.OK) {
        formattedAddress = place.formatted_address;
        Done(new Array(PrintDetails));
    }
}

function GetDistances() {
    distService = new google.maps.DistanceMatrixService();
    distService.getDistanceMatrix(
    {
        origins: originAddress, 
        destinations: [location.geometry.location], //Location contains lat and lng
        travelMode: google.maps.TravelMode.DRIVING,
        unitSystem: google.maps.UnitSystem.IMPERIAL,
        avoidHighways: false,
        avoidTolls: false
    }, GetDistancesComplete);
}
function GetDistancesComplete(results, status) {
    if (status == google.maps.DistanceMatrixStatus.OK) {
        distance = results[0].distance.text;
        Done(new Array(PrintDetails));
    }
}

function PrintDetails() {
    alert(*Whatever you feel like printing.*);
} 
```

简而言之，我们在这里所做的是-
将函数数组传递给**Start**函数
- **Start**函数调用数组中的函数并设置**PendingRequests**
的数量 - 在待处理请求的回调中，我们调用**Done**函数 -Done**函数**接受一个函数数组
-Done函数递减 PendingRequests 计数器-**如果** 它们不再是未决请求，我们调用传递给**Done**函数的函数

 **这是同步网络呼叫的一个简单但实​​用的示例。我尝试使用一个被广泛使用的例子，所以我使用了谷歌地图 api。我希望有人觉得这很有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-13T03:19:27.230

另一种方法是通过计时器获得同步点。它并不漂亮，但它的优点是不必在回调中添加对下一个函数的调用。

这里的函数`execute_jobs`是入口点。它需要一个数据列表同时执行。它首先将要等待的作业数设置为`list`. 然后它设置一个计时器来测试结束条件（数字下降到 0）。最后它为每个数据发送一个作业。每个作业将等待作业的数量减少一个。

它看起来像这样：

```
var g_numJobs = 0;

function async_task(data) {
    //
    // ... execute the task on the data ...
    //

    // Decrease the number of jobs left to execute.
    --g_numJobs;
}

function execute_jobs(list) {
    // Set the number of jobs we want to wait for.
    g_numJobs = list.length;

    // Set the timer (test every 50ms).
    var timer = setInterval(function() {
        if(g_numJobs == 0) {
            clearInterval(timer);
            do_next_action();
        }
    }, 50);

    // Send the jobs.
    for(var i = 0; i < list.length; ++i) {
        async_task(list[i]));
    }
} 
```

要改进此代码，您可以执行一个`Job`和`JobList`类。将`Job`执行回调并减少待处理作业的数量，而`JobList`将聚合计时器并在作业完成后将回调调用到下一个操作。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2014-04-04T01:01:06.567

我也有同样的挫败感。当我链接更多异步调用时，它变成了回调地狱。所以，我想出了自己的解决方案。我确信那里有类似的解决方案，但我想创建一些非常简单易用的东西。[Asynq](https://github.com/rockalizer/asynq)是我编写的用于链接异步任务的脚本。所以要在 f1 之后运行 f2，你可以这样做：

异步运行（f1，f2）

您可以根据需要链接任意数量的函数。您还可以指定参数或对数组中的元素运行一系列任务。我希望这个库可以解决您的问题或其他人遇到的类似问题。

# database - 从 Netbeans 开发到 Tomcat 生产：未找到数据库连接

> ID：855918
> 
> 赞同：1
> 
> 时间：2009-05-13T03:27:37.323
> 
> 标签：database, hibernate, tomcat, netbeans, netbeans6.5

我使用 MySQL 数据库和 Hibernate 在 Netbeans 6.5 中开发了一个 Java Web 应用程序。开发数据库服务器和开发应用程序服务器（Tomcat 6）都驻留在我的开发机器上。一切正常；应用程序正确地从数据库中提取数据。

现在，我准备将其移至生产服务器。同样，数据库服务器和应用程序服务器位于同一台机器上。我部署了 WAR 文件并尝试访问应用程序；我可以访问静态页面，但使用数据库的 Servlet 会出现异常：

`org.hibernate.exception.JDBCConnectionException: Cannot open connection`

我很确定这个问题与 Tomcat 不知道数据源有关。似乎 Netbeans 为我处理了这个问题。我读到我可能需要添加一个 RESOURCE 条目，所以我从[这个站点](http://jjant.com/?q=node/2)获得了一些建议，它给了我一个 context.xml：

```
<?xml version="1.0" encoding="UTF-8"?>
<Context antiJARLocking="true" path="/EmployeeDirectory">
     <Resource   
          name="jdbc/employeedirectory"  auth="Container"
          type="javax.sql.DataSource"    username="EmployeeDir"
          password="EmployeeDirectory"   driverClassName="com.mysql.jdbc.Driver"
          url="jdbc:mysql://127.0.0.1:3306/EmployeeDirectory?autoReconnect=true"
          maxActive="15"                 maxIdle="7"
          validationQuery="Select 1" />
</Context> 
```

的 web.xml：

```
<?xml version="1.0" encoding="UTF-8"?>
<web-app version="2.5" xmlns="http://java.sun.com/xml/ns/javaee"  
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">
    <!-- Omit Servlet Info -->
    <resource-ref>
        <description>DB Connection</description>
        <res-ref-name>jdbc/employeedirectory</res-ref-name>
        <res-type>javax.sql.DataSource</res-type>
        <res-auth>Container</res-auth>
    </resource-ref>
</web-app> 
```

和一个hibernate.cfg.xml：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-configuration PUBLIC "-//Hibernate/Hibernate Configuration DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd">
<hibernate-configuration>
    <session-factory>
        <property name="hibernate.connection.datasource">java:comp/env/jdbc/employeedirectory</property>
        <property name="hibernate.hbm2ddl.auto">update</property>
        <property name="hibernate.dialect">org.hibernate.dialect.MySQLDialect</property>
        <!-- Omit other Mappings -->
        <mapping class="EmployeeDirectory.data.PhoneNumber" resource="EmployeeDirectory/data/PhoneNumber.hbm.xml"/>
    </session-factory>
</hibernate-configuration> 
```

现在，我得到一个`org.hibernate.HibernateException: Could not find datasource`错误。

我是否走上了从开发到生产的正确道路？我错过了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T04:02:29.643

我认为你在正确的轨道上。我将首先设置数据源并在hibernate之外验证它。这是一篇很好的文章：http: [//tomcat.apache.org/tomcat-6.0-doc/jndi-resources-howto.htm](http://tomcat.apache.org/tomcat-6.0-doc/jndi-resources-howto.html)和一些例子：[http ://www.mbaworld.com/docs/jndi-数据源示例-howto.html](http://www.mbaworld.com/docs/jndi-datasource-examples-howto.html)

然后，我将配置 hibernate 以使用 datsource。通过查看您的`hibernate.cfg.xml`文件，我认为您应该尝试更改`hibernate.connection.datasource`为`jdbc/employeedirectory`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T10:48:49.697

jndi 数据源应在 /tomcat/server.xml 中定义，请参阅[Tomcat JNDI Datasource how-to](http://tomcat.apache.org/tomcat-4.1-doc/jndi-datasource-examples-howto.html)而不是在 webapp/context.xml

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-27T05:12:07.673

Tomcat 6 要求您将资源标记添加到 context.xml，而不是 server.xml。你可以在 Tomcat 5.x 中。我在单独安装的 Tomcat 中运行良好，但我仍在尝试在 NB 6.5 中使用连接池。

同一个 Apache 站点有一个指向 JNDI 的 Tomcat 6 版本的链接，它告诉您将资源标记添加到 context.xml。

# c# - 更改项目时的WPF列表框选择问题

> ID：855920
> 
> 赞同：2
> 
> 时间：2009-05-13T03:28:06.963
> 
> 标签：c#, .net, wpf, xaml, listbox

在更改列表框中的选定项目时，我收到一个奇怪的错误，更改的项目显示为已选中，但我无法取消选择或重新选择它。

有没有办法解决这个问题？

这是一个演示该问题的示例应用程序。

```
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();
        this.DataContext = new WindowViewModel();
        lst.SelectedIndex = 0;
    }

    private void Button_Click(object sender, RoutedEventArgs e)
    {
        ((WindowViewModel)this.DataContext).Items[0] = "New Item";
    }
}

public class WindowViewModel
{
    public WindowViewModel()
    {
        Items = new ObservableCollection<string>();
        Items.Add("Item1");
        Items.Add("Item2");
        Items.Add("Item3");
    }

    public ObservableCollection<string> Items { get; set; }
}

<Window x:Class="WpfSelectionIssue.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <StackPanel>
        <Button Content="Change" Click="Button_Click" />
        <ListBox x:Name="lst" ItemsSource="{Binding Items}" />
    </StackPanel>
</Window> 
```

[ImageOfIssue http://img136.imageshack.us/img136/9396/wpfselectionissue.jpg](http://img136.imageshack.us/img136/9396/wpfselectionissue.jpg)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-13T03:37:31.357

在搜索了更多之后，我找到了解决方案。将 IsSynchronizedWithCurrentItem 添加到 ListBox 解决了这个问题。

```
<ListBox 
    x:Name="lst" 
    ItemsSource="{Binding Items}" 
    IsSynchronizedWithCurrentItem="True"
    /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-08T13:47:42.807

我也遇到了无法取消选择任何项目的问题。当列表中有多个完全相同的项目时，列表框似乎无法理解。（因此它会选择它们，但不会取消选择它们）

当您在绑定时更改所选项目的值时，也会发生这种情况。您必须首先取消选择索引（例如：listBox.SelectedIndex = -1;），然后更改值。

我希望这可以帮助任何和我有同样问题的人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T12:03:02.807

不过，这不是一个好的答案，而且我个人不会对此感到满意，因此我尝试了一下并找到了替代方法。

仅当当前选择了您正在更改的项目并且您直接绑定到源时，才会出现这种情况。

`CollectViewSource`在 the`ListBox`和您的视图模型之间使用 a 。

```
<Window x:Class="TestApplication.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
  <Window.Resources>
    <CollectionViewSource x:Key="ViewSource" Source="{Binding Items}" />
  </Window.Resources>
  <StackPanel>
    <Button Content="Change" Click="Button_Click" />
    <ListBox x:Name="lst" ItemsSource="{Binding Source={StaticResource ViewSource}}" />
  </StackPanel>
</Window> 
```

无法解释您的示例中发生了什么，可能是 WPF 的错误，但这是一个更好/更清洁的解决方案。我怀疑`IsSynchronizedWithCurrentItem="True"`是在幕后为您创建视图源，这就是它起作用的原因。

高温下，

# email - 如何阻止 Exchange 自动将纯文本电子邮件转换为 HTML？

> ID：855926
> 
> 赞同：5
> 
> 时间：2009-05-13T03:29:14.603
> 
> 标签：email, exchange-server, exchange-server-2003

我已经为将由我的代码解析的电子邮件设置了一个 Exchange 2003 邮箱。电子邮件以纯文本形式发送，我的代码希望以纯文本形式接收它们。但是，Exchange 似乎正在自动将它们转换为 HTML。我如何阻止它这样做并以发送方式接收电子邮件？

我认为是 Exchange 进行转换的原因是收到的电子邮件如下所示：

```
<HTML>
<HEAD>
  <META NAME="Generator" CONTENT="MS Exchange Server version 6.5.7654.12">
</HEAD>
<BODY>
<!-- Converted from text/plain format -->
(then the actual contents, but with HTML markup)
</BODY>
</HTML> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-04-10T03:55:23.520

在根据下一部分设置所有规则之前，如果您有权访问，则值得在您的 Exchange 服务器上确认此选项。

启动 Exchange 系统管理器程序。

展开“全局设置”，然后单击“Internet 消息格式”。

在右窗格中，双击您的 Internet 消息格式对象。

现在单击高级，然后将富文本编辑器单选按钮设置为从不。按确定。

我使用以下方法找到了答案：

[http://help.affinitylive.com/setup/automatic-email-capture/exchange-2003/](http://help.affinitylive.com/setup/automatic-email-capture/exchange-2003/)

让我们知道这是否解决了它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T03:38:36.037

我认为在 POP 虚拟服务器的设置中，有一个选项可以覆盖消息的 MIME 编码，您可以在其中指定文本、html 或两者。

在 Exchange 系统管理器中：

服务器 -> “您的服务器” -> 协议 -> POP3 -> 虚拟服务器 -> 属性 -> 消息格式选项卡

# javascript - 使用jquery在表单文本字段中输入文本时如何更新跨度

> ID：855932
> 
> 赞同：5
> 
> 时间：2009-05-13T03:31:22.400
> 
> 标签：javascript, jquery, ajax

当使用 jquery 将值输入到文本字段中时，我希望更新跨度。我的表单字段有一个名为“userinput”的文本框，我有一个 ID 为“inputval”的跨度。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-13T03:36:58.053

**更新：虽然您将此标记为正确答案，但请注意您应该使用 keyup 事件而不是 change 事件或 keydown**

```
$(document).ready(function() {
    $('input[name=userinput]').keyup(function() {
      $('#inputval').text($(this).val());
    });
    }); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-01-08T09:16:40.210

尝试以下操作，您必须再次调用`keyup()`才能触发最后一个字符：

```
$(".editable_input").keyup(function() { 
    var value = $(this).val();
    var test = $(this).parent().find(".editable_label");
    test.text(value);
}).keyup(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T03:35:03.110

试试这个。确保您了解这里发生了什么。

```
// when the DOM is loaded:
$(document).ready(function() {
    // find the input element with name == 'userinput'
    // register an 'keydown' event handler
    $("input[name='userinput']").keydown(function() {
        // find the element with id == 'inputval'
        // fill it with text that matches the input elements value
        $('#inputval').text(this.value);
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T03:40:24.363

```
$(function() {
    $("input[name=userinput]").keydown(
      function() {
        $('#inputval').text(this.value);
      }
     )
}) 
```

# security - 盐和密码 - 前缀或后缀

> ID：855933
> 
> 赞同：2
> 
> 时间：2009-05-13T03:32:01.387
> 
> 标签：security, encryption, passwords, salt

这是一个关于需要散列的盐渍短语的问题。

我想知道将盐前缀到短语或后缀是否更安全？盐 + 词组或词组 + 盐

我的问题来自对[MD5s](http://www.skrenta.com/2007/08/md5_tutorial.html)上这篇文章的[评论](http://www.skrenta.com/2007/08/md5_tutorial.html#comment-10072)。我不确定我是否理解作者评论背后的原因。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T03:34:54.203

盐是加在前面还是后面没有区别。

尽管以下因素会影响安全性

1.  你的盐是私人的（如果是的话，它有多私人？）。越私密越好。这意味着，如果您可以避免将盐存储在您的数据库中，即使您的数据库受到破坏，您也可以使您的系统免受暴力攻击。
2.  你的盐是随机的吗？如果说您的数据库受到损害并且您的盐存储在数据库中，这有助于防御彩虹表攻击。注意：如果存储的密码足够长，它们可以免受暴力攻击。
3.  你的盐够长吗？你的盐越长，你就越安全。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T03:50:05.327

什么时候消化盐并不重要：前缀、后缀、中缀都会产生不同的散列，但达到击败彩虹表或其他预散列字典攻击的相同目的。

我认为该评论与 MD5 中的漏洞有关，而不是一般的散列。我不明白细节，但它[与找到两个产生相同哈希的前缀有关。](http://en.wikipedia.org/wiki/Md5#Vulnerability)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T03:53:47.893

当有人对盐的使用有疑问时，我担心这是因为他们正忙于（重新）发明他们一开始就不应该做的事情。基于这个问题，我的建议是使用 HMAC。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-25T13:38:13.617

不像其他人说的，这很重要！和@einstein，如果你关心使用`HMAC`.

为什么前缀不好，因为可以计算校验和的中间状态，直到给定的固定盐前缀。然后开始并行计算其余部分。总之`phrase+salt`比 更安全`salt+phrase`，但`HMAC(salt, phrase)`甚至更好。

[相关阅读](https://latacora.singles/2018/08/03/the-default-openssh.html)

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-05-13T03:42:27.963

从技术上讲，这并不重要，只要盐是独特的并且不容易猜到。只是不要像我一样犯下储存盐的错误。

对字符串“加盐”的目的是以一种比 MD5 散列更加个性化和独特的方式对其进行加扰。没有正确或错误的方法，只要你是唯一知道它是如何工作的人。无论哪种方式都会达到结果，即使生成的MD5哈希与彩虹表*不*对应，以便于破解密码。

# design-patterns - 开发重构友好代码的最佳实践

> ID：855936
> 
> 赞同：4
> 
> 时间：2009-05-13T03:33:41.210
> 
> 标签：design-patterns, refactoring, resources

作为敏捷开发周期中的 Java 开发人员，我了解到确保我设计类的方式能够轻松重构它们而不会带来太大的痛苦，这一点很重要。我想知道，您在日常设计/开发周期中遵循哪些最佳实践可以帮助您轻松执行重构。
例如，我知道我应该将实现细节隐藏在接口后面。因此，如果我明天更改实现，我不会干扰使用此 API 的客户端代码。同样，我应该尽可能使用“工厂设计模式”，这样实现类的更改可以从一个工厂类控制，而不是找出所有地方并更改它们。
同样，我想知道您遵循的所有最佳实践对我有帮助。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-13T03:40:08.390

使用 TDD。严重地。在编写课程的同时编写测试会迫使您考虑其他人将如何使用它们。当你这样做时，你会倾向于编写更好的抽象。

关于这个主题已经写了整本书：

*   代码完成
*   有效地使用遗留代码
*   清洁代码
*   重构
*   重构为模式
*   敏捷原则、模式和实践

每一个都以自己独特的方式触及这个主题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T03:38:04.820

您应该有一堆单元测试可以证明代码库在每次重构时都没有（无意地）受到影响。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T04:02:29.080

This may sound like a bit of circular reasoning but I find it to be true in my experience:

Refactor it a lot.

Many of the answers here (especially a strong test suite) are great advice and help a lot, so let me be clear in saying that I'm all for those pre-emptive measures as well.

At first, it's always easy to change (when it's small). Then, you generally have to go through a few bouts of tough refactoring before you have a breakthrough and get something that is really supple.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T03:40:27.453

不要复制和粘贴（也称为 DRY：不要重复自己）。当任何给定的功能在不超过一个地方实现时，重新实现该功能就更容易了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T03:49:00.727

My answer relates to what constitutes a good result after the refactoring.

Methods should be...

*   short - they should never be more than a screen full of code.
*   do at most one thing:
    *   calculate a value
    *   test and branch
    *   log
    *   guard and throw exception
*   have a single exit point - my reasoning..
    *   If you later need to come back and do something to the return value, it all happens in one spot.
    *   Easy to set a breakpoint and inspect the returned value...
    *   Amounts to **DRY**.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-13T03:58:55.547

I would recommend picking up two books if you're going to be doing a lot of java.

I'd recommend [Effective Java](https://rads.stackoverflow.com/amzn/click/com/0321356683) and [Design Patterns: Elements of Reusable Object-Oriented Software](https://rads.stackoverflow.com/amzn/click/com/0201633612).

# python - 子类化 ctypes - Python

> ID：855941
> 
> 赞同：4
> 
> 时间：2009-05-13T03:36:33.497
> 
> 标签：python, ctypes

这是我在网上找到的一些代码。我不确定它是如何使用的。我只是用枚举键/值填充*成员*并且它有效，但我很好奇这个元类的全部内容。我假设它与 ctypes 有关，但我找不到太多关于子类化 ctypes 的信息。我知道 EnumerationType 并没有像我使用 Enumeration 那样做任何事情。

```
from ctypes import *

class EnumerationType(type(c_uint)):  
    def __new__(metacls, name, bases, dict):  
        if not "_members_" in dict:  
            _members_ = {}  
            for key,value in dict.items():  
                if not key.startswith("_"):  
                    _members_[key] = value  
            dict["_members_"] = _members_  
        cls = type(c_uint).__new__(metacls, name, bases, dict)  
        for key,value in cls._members_.items():  
            globals()[key] = value  
        return cls  

    def __contains__(self, value):
        return value in self._members_.values()

    def __repr__(self):
        return "<Enumeration %s>" % self.__name__

class Enumeration(c_uint):
    __metaclass__ = EnumerationType
    _members_ = {}
    def __init__(self, value):
        for k,v in self._members_.items():
            if v == value:
                self.name = k
                break
        else:
            raise ValueError("No enumeration member with value %r" % value)
        c_uint.__init__(self, value)

    @classmethod
    def from_param(cls, param):
        if isinstance(param, Enumeration):
            if param.__class__ != cls:
                raise ValueError("Cannot mix enumeration members")
            else:
                return param
        else:
            return cls(param)

    def __repr__(self):
        return "<member %s=%d of %r>" % (self.name, self.value, self.__class__)

And an enumeration probably done the wrong way.  

class TOKEN(Enumeration):
    _members_ = {'T_UNDEF':0, 'T_NAME':1, 'T_NUMBER':2, 'T_STRING':3, 'T_OPERATOR':4, 'T_VARIABLE':5, 'T_FUNCTION':6} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T03:41:27.497

元类是用于创建类的类。可以这样想：所有对象都有一个类，一个类也是一个对象，因此，一个类可以有一个类是有道理的。

[http://www.ibm.com/developerworks/linux/library/l-pymeta.html](http://www.ibm.com/developerworks/linux/library/l-pymeta.html)

要了解这是做什么的，您可以查看代码中的几个点。

```
 _members_ = {'T_UNDEF':0, 'T_NAME':1, 'T_NUMBER':2, 'T_STRING':3, 'T_OPERATOR':4, 'T_VARIABLE':5, 'T_FUNCTION':6}

globals()[key] = value 
```

在这里，它需要字典中定义的每个键：“T_UNDEF”“T_NUMBER”，并使它们在您的全局字典中可用。

```
def __init__(self, value):
    for k,v in self._members_.items():
        if v == value:
            self.name = k
            break 
```

每当您创建枚举的实例时，它都会在您初始化类时检查“值”是否在允许的枚举名称列表中。找到该值后，它将字符串名称设置为 self.name。

```
c_uint.__init__(self, value) 
```

这是将“ctypes 值”设置为实际 c 无符号整数的实际行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T07:47:21.320

这确实是一个奇怪的课程。

您使用它的方式是正确的，尽管另一种方式是：

```
class TOKEN(Enumeration):
    T_UNDEF    = 0
    T_NAME     = 1
    T_NUMBER   = 2
    T_STRING   = 3
    T_OPERATOR = 4
    T_VARIABLE = 5
    T_FUNCTION = 6 
```

（这就是前 6 行`__new__`的用途）

然后你可以像这样使用它：

```
>>> TOKEN
<Enumeration TOKEN>
>>> TOKEN(T_NAME)
<member T_NAME=1 of <Enumeration TOKEN>>
>>> T_NAME in TOKEN
True
>>> TOKEN(1).name
'T_NAME' 
```

该`from_param`方法似乎是为了方便，用于编写接受 int 或`Enumeration`对象的方法。不确定这是否真的是它的目的。

我认为这个类是在使用外部 API 时使用的，使用 c 样式的枚举，但它看起来像做很多工作却收获甚微。

# sql-server-2005 - 多父树（或有向图）实现 sql server 2005

> ID：855942
> 
> 赞同：2
> 
> 时间：2009-05-13T03:36:48.083
> 
> 标签：sql-server-2005, tsql, tree, parent-child, hierarchy

我需要在 SQL Server 2005 上实现一个多父树（或有向图）。我已经阅读了几篇文章，但其中大多数都使用具有唯一根的单父树，如下所示。

```
-My PC
   -Drive C
      -Documents and Settings
      -Program Files
         -Adobe
         -Microsoft
      -Folder X
   -Drive D
      -Folder Y
      -Folder Z 
```

在这一个中，一切都来自一个根元素（我的电脑）。

就我而言，一个孩子可能有多个父母，如下所示：

```
G  A
 \ /
  B
 / \ 
X   C
  /  \
  D   E
  \ /
   F 
```

所以我有以下代码：

```
create table #ObjectRelations
(
    Id varchar(20),
    NextId varchar(20)
)

insert into #ObjectRelations values ('G', 'B')
insert into #ObjectRelations values ('A', 'B') 
insert into #ObjectRelations values ('B', 'C')
insert into #ObjectRelations values ('B', 'X')
insert into #ObjectRelations values ('C', 'E') 
insert into #ObjectRelations values ('C', 'D') 
insert into #ObjectRelations values ('E', 'F') 
insert into #ObjectRelations values ('D', 'F') 

declare @id varchar(20)
set @id = 'A';

WITH Objects (Id, NextId) AS
( -- This is the 'Anchor' or starting point of the recursive query
  SELECT rel.Id,
         rel.NextId
    FROM #ObjectRelations rel
   WHERE rel.Id = @id
   UNION ALL -- This is the recursive portion of the query
  SELECT rel.Id,
         rel.NextId
    FROM #ObjectRelations rel
   INNER JOIN Objects -- Note the reference to CTE table name (Recursive Join)
      ON rel.Id = Objects.NextId
)
SELECT  o.*
FROM    Objects o

drop table #ObjectRelations 
```

* * *

它返回以下 SET：

```
Id                   NextId
-------------------- --------------------
A                    B
B                    C
B                    X
C                    E
C                    D
D                    F
E                    F 
```

预期结果集：

```
Id                   NextId
-------------------- --------------------
G                    B
A                    B
B                    C
B                    X
C                    E
C                    D
D                    F
E                    F 
```

请注意，缺少 G->B 关系，因为它要求一个起始对象（这对我也不起作用，因为我从一开始就不知道根对象）并且使用 A 作为起点将忽略G->B 关系。

因此，此代码在我的情况下不起作用，因为它要求一个起始对象，这在单父树中很明显（将始终是根对象）。但是在多父树中，您可能有多个“根”对象（如在示例中，G 和 A 是“根”对象，其中根是没有父对象（祖先）的对象）。

所以我有点卡在这里......我需要修改查询以不要求起始对象并递归遍历整个树。我不知道 (Id, NextId) 实现是否有可能...可能我需要使用某种发生矩阵、邻接矩阵或其他任何东西将它存储为图形（请参阅[http://willets.org/ sqlgraphs.html](http://willets.org/sqlgraphs.html)）。

有什么帮助吗？你们觉得怎么样？非常感谢您的宝贵时间 =)

干杯!

来源： [来源 1](http://www.sqlservercentral.com/articles/SQL+Server+2005+-+TSQL/recursivequeriesinsql1999andsqlserver2005/1846/) [来源 2](http://www.rcs-solutions.com/blog/2008/09/27/RecursiveQueriesInSQLServer2005.aspx) [来源 3](http://www.experts-exchange.com/Database/Miscellaneous/Q_23102605.html)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-03T20:10:52.317

好吧，我终于想出了以下解决方案。这是我发现支持多根树和循环有向图的方式。

```
create table #ObjectRelations
(
    Id varchar(20),
    NextId varchar(20)
)

/* Cycle */
/*
insert into #ObjectRelations values ('A', 'B')
insert into #ObjectRelations values ('B', 'C') 
insert into #ObjectRelations values ('C', 'A')
*/

/* Multi root */

insert into #ObjectRelations values ('G', 'B')
insert into #ObjectRelations values ('A', 'B') 
insert into #ObjectRelations values ('B', 'C')
insert into #ObjectRelations values ('B', 'X')
insert into #ObjectRelations values ('C', 'E') 
insert into #ObjectRelations values ('C', 'D') 
insert into #ObjectRelations values ('E', 'F') 
insert into #ObjectRelations values ('D', 'F') 

declare @startIds table
(
    Id varchar(20) primary key
)

;WITH 
    Ids (Id) AS
    (
        SELECT  Id
        FROM    #ObjectRelations
    ),
    NextIds (Id) AS
    (
        SELECT  NextId
        FROM    #ObjectRelations
    )
INSERT INTO @startIds
/* This select will not return anything since there are not objects without predecessor, because it's a cyclic of course */
SELECT DISTINCT
    Ids.Id
FROM
    Ids
LEFT JOIN
    NextIds on Ids.Id = NextIds.Id
WHERE
    NextIds.Id IS NULL
UNION
/* So let's just pick anyone. (the way I will be getting the starting object for a cyclic doesn't matter for the regarding problem)*/
SELECT TOP 1 Id FROM Ids

;WITH Objects (Id, NextId, [Level], Way) AS
( -- This is the 'Anchor' or starting point of the recursive query
  SELECT rel.Id,
         rel.NextId,
         1,
         CAST(rel.Id as VARCHAR(MAX))
    FROM #ObjectRelations rel
   WHERE rel.Id IN (SELECT Id FROM @startIds)

   UNION ALL -- This is the recursive portion of the query

  SELECT rel.Id,
         rel.NextId,
         [Level] + 1,
         RecObjects.Way + ', ' + rel.Id
    FROM #ObjectRelations rel
   INNER JOIN Objects RecObjects -- Note the reference to CTE table name (Recursive Join)
      ON rel.Id = RecObjects.NextId
   WHERE RecObjects.Way NOT LIKE '%' + rel.Id + '%'

)
SELECT  DISTINCT 
        Id,
        NextId,
        [Level]
FROM    Objects
ORDER BY [Level]

drop table #ObjectRelations 
```

可能对某人有用。这是给我的=P谢谢

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T06:30:10.727

如果要将所有根对象用作起始对象，则应首先更新数据以包含有关根对象（和叶子）的信息。您应该添加以下插入：

```
insert into #ObjectRelations values (NULL, 'G')
insert into #ObjectRelations values (NULL, 'A')
insert into #ObjectRelations values ('X', NULL)
insert into #ObjectRelations values ('F', NULL) 
```

`Id`当然，您也可以编写锚查询，选择具有不作为 a 出现的 a的记录作为根节点`NextId`，但这更容易。

接下来，将您的锚查询修改为如下所示：

```
SELECT rel.Id,
       rel.NextId
FROM #ObjectRelations rel
WHERE rel.Id IS NULL 
```

如果你运行这个查询，你会看到你得到了很多重复，很多弧线多次出现。这是因为您现在有两个来自锚查询的结果，因此树被遍历了两次。

这可以通过将您的 select 语句更改为此来解决（注意`DISTINCT`）：

```
SELECT DISTINCT o.*
FROM   Objects o 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-05T12:54:07.333

如果你不想做 Ronald 建议的插入，这会做！

```
WITH CTE_MultiParent  (ID, ParentID) 
AS 
(
    SELECT ID, ParentID FROM #ObjectRelations
    WHERE ID NOT IN 
    (
        SELECT DISTINCT ParentID FROM #ObjectRelations
    )
    UNION ALL
    SELECT ObjR.ID, ObjR.ParentID FROM #ObjectRelations ObjR INNER JOIN CTE_MultiParent
    ON CTE_MultiParent.ParentID = ObjR.Id
)

SELECT DISTINCT * FROM CTE_MultiParent 
```

# php - 如何通过 PHP 检索访问者的 ISP？

> ID：855967
> 
> 赞同：13
> 
> 时间：2009-05-13T03:43:44.700
> 
> 标签：php, internet-connection, user-tracking, gethostbyaddr

如何找出查看 PHP 页面的人的 ISP 提供商？

是否可以使用 PHP 来跟踪或揭示它？

如果我使用以下内容：

```
gethostbyaddr($_SERVER['REMOTE_ADDR']); 
```

它返回我的 IP 地址，而不是我的主机名或 ISP。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-03-25T05:35:33.573

编辑：**此方法不再有效**，因为它现在访问的网站会阻止自动查询（以前此方法违反了网站的使用条款）。下面还有其他几个不错的 [合法！] 答案（包括[我的替代方案](https://stackoverflow.com/a/56823156/8112776)。）

* * *

您可以从以下 PHP 编码中获得所有这些东西。，

```
<?php
  $ip=$_SERVER['REMOTE_ADDR'];
  $url=file_get_contents("http://whatismyipaddress.com/ip/$ip");
  preg_match_all('/<th>(.*?)<\/th><td>(.*?)<\/td>/s',$url,$output,PREG_SET_ORDER);
  $isp=$output[1][2];
  $city=$output[9][2];
  $state=$output[8][2];
  $zipcode=$output[12][2];
  $country=$output[7][2];
?>
<body>
  <table align="center">
    <tr><td>ISP :</td><td><?php echo $isp;?></td></tr>
    <tr><td>City :</td><td><?php echo $city;?></td></tr>
    <tr><td>State :</td><td><?php echo $state;?></td></tr>
    <tr><td>Zipcode :</td><td><?php echo $zipcode;?></td></tr>
    <tr><td>Country :</td><td><?php echo $country;?></td></tr>
  </table>
</body> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-13T03:47:34.490

这似乎是您要查找的内容，如果可能，它将尝试返回完整的主机名：

[http://us3.php.net/gethostbyaddr](http://us3.php.net/gethostbyaddr)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-13T04:29:39.397

HTTP 标头中没有任何内容表明用户来自哪个**ISP**，因此答案是否定的，没有 PHP 内置函数可以告诉您这一点。您必须使用某种将 IP 映射到网络/ISP 的服务或库。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-10-17T23:09:33.770

为什么不使用 ARIN 的 REST API。

```
<?php

// get IP Address
$ip=$_SERVER['REMOTE_ADDR'];

// create a new cURL resource
$ch = curl_init();

// set URL and other appropriate options
curl_setopt($ch, CURLOPT_URL, 'http://whois.arin.net/rest/ip/' . $ip);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, array('Accept: application/json'));

// execute
$returnValue = curl_exec($ch);

// close cURL resource, and free up system resources
curl_close($ch);

$result = json_decode($returnValue);

echo <<<END
<pre>
Handle: {$result->net->handle->{'$'}}
Ref: {$result->net->ref->{'$'}}
Name: {$result->net->name->{'$'}}
echo "OrgRef: {$result->net->orgRef->{'@name'}}";
</pre>
END;

// eof 
```

[https://www.arin.net/resources/whoisrws/whois_api.html](https://www.arin.net/resources/whoisrws/whois_api.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-09-01T09:32:33.460

有时字段会发生变化，所以这是对上述帖子的改进。

```
<body> 
    <table align="center">

<?
 $ip=$_SERVER['REMOTE_ADDR'];
 $url=file_get_contents("http://whatismyipaddress.com/ip/$ip");
 preg_match_all('/<th>(.*?)<\/th><td>(.*?)<\/td>/s',$url,$output,PREG_SET_ORDER);
 for ($q=0; $q < 25; $q++) {
    if ($output[$q][1]) {
        if (!stripos($output[$q][2],"Blacklist")) {
            echo "<tr><td>".$output[$q][1]."</td><td>".$output[$q][2]."</td></tr>";

        }
    }
}
?> 
    </table>
</body> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-18T06:20:25.570

您不能依赖 IP 地址或主机名来了解某人正在使用的 ISP。事实上，他可能根本不使用 ISP，或者他可能通过 VPN 连接登录到他的工作地点，从那里使用另一个 VPN 或远程桌面到世界另一端的托管服务，然后从那里连接到你. 您获得的 ip 地址将来自最后一台远程机器或来自该机器后面的某个防火墙，该防火墙可能又位于其他地方。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-13T07:45:18.607

GeoIP 将帮助您： http: [//www.maxmind.com/app/locate_my_ip](http://www.maxmind.com/app/locate_my_ip)

有一个用于访问 geoip 数据的 php 库：http: [//www.maxmind.com/app/php](http://www.maxmind.com/app/php)

但请注意，您需要将 geoip db 放在您的机器上才能使其工作，所有说明都在那里 :)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-11-25T18:49:02.697

我试图纠正 Ram Kumar 的回答，但每当我编辑他们的帖子时，我都会被暂时禁止，我的更改被忽略。（至于为什么，我不知道，这是我在这个网站上所做的第一次也是唯一一次编辑。）

自他的帖子以来，由于网站更改和管理员实施基本机器人检查（检查标题），他的代码不再工作：

```
<?php
$IP = $_SERVER['REMOTE_ADDR'];

$User_Agent = 'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:33.0) Gecko/20100101 Firefox/33.0';
$Accept = 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8';
$Accept_Language = 'en-US,en;q=0.5';
$Referer = 'http://whatismyipaddress.com/';
$Connection = 'keep-alive';

$HTML = file_get_contents("http://whatismyipaddress.com/ip/$IP", false, stream_context_create(array('http' => array('method' => 'GET', 'header' => "User-Agent: $User_Agent\r\nAccept: $Accept\r\nAccept-Language: $Accept_Language\r\nReferer: $Referer\r\nConnection: $Connection\r\n\r\n"))));

preg_match_all('/<th>(.*?)<\/th><td>(.*?)<\/td>/s', $HTML, $Matches, PREG_SET_ORDER);

$ISP = $Matches[3][2];
$City = $Matches[11][2];
$State = $Matches[10][2];
$ZIP = $Matches[15][2];
$Country = $Matches[9][2];
?>
<body>
    <table align="center">
        <tr><td>ISP :</td><td><?php echo $ISP;?></td></tr>
        <tr><td>City :</td><td><?php echo $City;?></td></tr>
        <tr><td>State :</td><td><?php echo $State;?></td></tr>
        <tr><td>Zipcode :</td><td><?php echo $ZIP;?></td></tr>
        <tr><td>Country :</td><td><?php echo $Country;?></td></tr>
    </table>
</body> 
```

请注意，仅提供用户代理可能就足够了，并且很可能不需要额外的标头，我只是添加了它们以使请求看起来更真实。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-02-16T10:04:50.847

如果所有这些答案都没有用，那么您可以尝试 API 方式。

1\. [http://extreme-ip-lookup.com/json/](http://extreme-ip-lookup.com/json/[IP) [这里的IP地址]

**示例：** [http ://extreme-ip-lookup.com/json/106.192.146.13](http://extreme-ip-lookup.com/json/106.192.146.13)

2\. [http://ip-api.com/json/](http://ip-api.com/json/[IP) [这里的IP地址]

**示例：http:** [//ip-api.com/json/113.14.168.85](http://ip-api.com/json/113.14.168.85)

一旦它适用于您，请不要忘记将 JSON 转换为 PHP。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-06-26T15:08:51.067

您可以从 ipinfo.io 或类似服务获取此信息。

```
<?php

/**
 * Get ip info from ipinfo.io
 *
 * There are other services like this, for example
 * http://extreme-ip-lookup.com/json/106.192.146.13
 * http://ip-api.com/json/113.14.168.85
 *
 * source: https://stackoverflow.com/a/54721918/3057377
 */
function getIpInfo($ip = '') {
    $ipinfo = file_get_contents("https://ipinfo.io/" . $ip);
    $ipinfo_json = json_decode($ipinfo, true);
    return $ipinfo_json;
}

function displayIpInfo($ipinfo_json) {
    var_dump($ipinfo_json);
    echo <<<END
<pre>
ip      : {$ipinfo_json['ip']}
city    : {$ipinfo_json['city']}
region  : {$ipinfo_json['region']}
country : {$ipinfo_json['country']}
loc     : {$ipinfo_json['loc']}
postal  : {$ipinfo_json['postal']}
org     : {$ipinfo_json['org']}
</pre>
END;
}

function main() {
    echo("<h1>Server IP information</h1>");
    $ipinfo_json = getIpInfo();
    displayIpInfo($ipinfo_json);

    echo("<h1>Visitor IP information</h1>");
    $visitor_ip = $_SERVER['REMOTE_ADDR'];
    $ipinfo_json = getIpInfo($visitor_ip);
    displayIpInfo($ipinfo_json);
}

main();

?> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-13T03:47:27.873

我认为您需要使用一些第三方服务（可能是 Web 服务）来查找 IP 并找到服务提供商。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-13T04:44:39.433

去[http://whatismyip.com](http://whatismyip.com)

这将为您提供您的互联网地址。将该地址插入数据库[http://arin.net/whois](http://arin.net/whois)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-06-30T07:27:00.087

一个快速的选择。（该网站每分钟最多允许拨打 50 个电话。）

```
$json=file_get_contents("https://extreme-ip-lookup.com/json/$ip");
extract(json_decode($json,true));
echo "ISP: $isp ($city, $region, $country)<br>"; 
```

[页面](https://extreme-ip-lookup.com/)底部的 API 详细信息。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-10-24T08:59:54.170

```
<?php
$isp = geoip_isp_by_name('www.example.com');
if ($isp) {
    echo 'This host IP is from ISP: ' . $isp;
}
?> 
```

(PECL geoip >= 1.0.2)

geoip_isp_by_name — 获取 Internet 服务提供商 (ISP) 名称

[http://php.net/manual/ru/function.geoip-isp-by-name.php](http://php.net/manual/ru/function.geoip-isp-by-name.php)

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2013-04-15T23:32:32.273

这是从站点或 ip 查找 isp 的正确方法。

```
<?php
$isp = geoip_isp_by_name('www.example.com');
if ($isp) {
    echo 'This host IP is from ISP: ' . $isp;
}
?> 
```

# sql - 避免 SQL 中的嵌套子查询

> ID：855970
> 
> 赞同：0
> 
> 时间：2009-05-13T03:44:56.617
> 
> 标签：sql, sql-server, join

我有一个 SQL 表，其中包含以下形式的数据：

Id int EventTime dateTime CurrentValue int

对于给定的 id，该表可能有多个行，表示值随时间的变化（EventTime 标识值更改的时间）。

给定一个特定的时间点，我希望能够计算每个给定值的不同 ID 的计数。

现在，我正在使用一个嵌套子查询和一个临时表，但它似乎更有效。

```
SELECT [Id],   
(  
    SELECT  
        TOP 1 [CurrentValue]  
    FROM [ValueHistory]  
    WHERE [Ids].[Id]=[ValueHistory].[Id] AND
        [EventTime] < @StartTime  
    ORDER BY [EventTime] DESC  
) as [LastValue]  
INTO #temp  
FROM [Ids]  

SELECT [LastValue], COUNT([LastValue])
FROM #temp  
GROUP BY [LastValue]  
DROP TABLE #temp 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T04:11:38.583

这是我的第一次尝试：

```
select ids.Id, count( distinct currentvalue)
from ids
join valuehistory vh on ids.id = vh.id
where vh.eventtime < @StartTime
group by ids.id 
```

但是，我不确定我是否非常清楚地了解您的表格模型，或者您要解决的具体问题。

这将是：对于每个 ID，在某个日期之前与 valuehistory 不同的“当前值”。

那是你要找的吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T04:16:14.143

我想我理解你的问题。

您想获取每个 id 的最新值，按该值分组，然后查看有多少 id 具有相同的值？这个对吗？

如果是这样，这是我的第一枪：

```
declare @StartTime datetime
set @StartTime = '20090513'

select ValueHistory.CurrentValue, count(ValueHistory.id)
from
(
    select id, max(EventTime) as LatestUpdateTime
    from ValueHistory
    where EventTime < @StartTime
    group by id
) CurrentValues
inner join ValueHistory on CurrentValues.id = ValueHistory.id
and CurrentValues.LatestUpdateTime = ValueHistory.EventTime
group by ValueHistory.CurrentValue 
```

不能保证这实际上更快 - 要以任何不错的速度工作，您需要 EventTime 上的索引。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T04:17:29.133

让我们记住，因为 SQL 语言描述的是你想要什么而不是如何得到它，所以有很多方法可以表达一个查询，最终会被一个好的查询优化器变成相同的查询执行计划。当然，“好”的级别取决于您使用的数据库。

一般来说，子查询只是描述连接的一种语法不同的方式。查询优化器将认识到这一点，并尽其所知确定执行查询的最佳方式。可以根据需要创建临时表。因此，在许多情况下，重新处理查询不会对您的实际执行时间产生任何影响——它最终可能会得出相同的查询执行计划。

如果您要尝试优化，则需要通过对该查询进行描述来检查查询计划。确保它不对大​​表进行全表扫描，并尽可能选择适当的索引。当且仅当它在这里做出次优选择时，您是否应该尝试手动优化查询。

现在，说了这么多，您粘贴的查询与您声明的“计算每个给定值的不同 ID 的计数”的目标并不完全兼容。如果我不能完全满足您的需求，请原谅我，但这里有一些东西可以针对您当前的查询进行性能测试。（语法是近似的，抱歉——远离我的办公桌）。

```
SELECT [IDs].[Id], vh1.[CurrentValue], COUNT(vh2.[CurrentValue]) FROM
    [IDs].[Id] as ids JOIN [ValueHistory] AS vh1 ON ids.[Id]=vh1.[Id]
        JOIN [ValueHistory] AS vh2 ON vh1.[CurrentValue]=vh2.[CurrentValue]
GROUP BY [Id], [LastValue]; 
```

请注意，与重新处理查询相比，通过添加索引以使这些连接处于最佳状态，您可能会看到更好的性能提升，假设您愿意为更新操作带来性能损失。

# nsis - 是否可以创建一个使用 NSIS 从 Web 服务器下载文件的更新程序？

> ID：855979
> 
> 赞同：1
> 
> 时间：2009-05-13T03:51:34.607
> 
> 标签：nsis, auto-update

我在 NSIS 中创建了一个迷你安装程序，用于为我的应用程序安装补丁。我想创建一个 NSIS 软件更新程序，它可以从 Web 服务器下载这个迷你安装程序。是否可以？

谢谢...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T05:49:00.640

您可能需要[NSISdl](http://nsis.sourceforge.net/NSISdl_plug-in)插件。

# php - 是否有可以将 HTML 表格数据转换为各种格式的 PHP 脚本？

> ID：855980
> 
> 赞同：0
> 
> 时间：2009-05-13T03:52:00.033
> 
> 标签：php, file-format

使用 PHP，我可以将 MySQL 数据或静态表数据转换为 csv、Excel、JSON、MySQL 等，但是是否有一个有用的转换脚本或工具可以将表数据转换为其他格式/样式格式，例如 PDF 和/或 JPG/PNG使用 PHP GD 库或其他？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T04:01:44.650

我以前用[它](http://www.digitaljunkies.ca/dompdf/)来将 HTML 表格转换为 PDF。我从 MySQL 查询生成了表。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T04:15:24.053

要导出到 Excel，我使用以下代码：

```
<?php

/*  Define our Database and Table Info */

$username="";
$password="";
$database="";
$table="";

mysql_connect(localhost,$username,$password);
@mysql_select_db($database) or die( "Unable to select database");
$select = "SELECT * FROM $table";                
$export = mysql_query($select);
$fields = mysql_num_fields($export);

for ($i = 0; $i < $fields; $i++) {
    $header .= mysql_field_name($export, $i) . "\t";
}

while($row = mysql_fetch_row($export)) {
    $line = '';
    foreach($row as $value) {                                            
        if ((!isset($value)) OR ($value == "")) {
            $value = "\t";
        } else {
            $value = str_replace('"', '""', $value);
            $value = '"' . $value . '"' . "\t";
        }
        $line .= $value;
    }
    $data .= trim($line)."\n";
}
$data = str_replace("\r","",$data);

if ($data == "") {
    $data = "\n(0) Records Found!\n";                        
}

header("Content-type: application/x-msdownload");
header("Content-Disposition: attachment; filename=mailinglist.xls");
header("Pragma: no-cache");
header("Expires: 0");
print "$header\n$data"; 
?> 
```

现在要小心你如何包含它。它使用标头发送文件信息以强制下载，通过这样做，在发送这些标头之前您不能有任何空白，否则可能会引发错误。我通常将此链接作为新窗口打开，以防止发生任何事情......这只是一个非常基本的脚本，可以大大扩展。希望这可以帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-15T14:21:29.717

```
<?php  

/  Define our Database and Table Info /  

$username="";  
$password="";  
$database="";  
$table="";  

mysql_connect(localhost,$username,$password);  
@mysql_select_db($database) or die( "Unable to select database");  
$select = "SELECT * FROM $table";                  
$export = mysql_query($select);  
$fields = mysql_num_fields($export);  

for ($i = 0; $i < $fields; $i++) {  
    $header .= mysql_field_name($export, $i) . ",";  
}  

while($row = mysql_fetch_row($export)) {  
    $line = '';  
    foreach($row as $value) {                                              
        if ((!isset($value)) OR ($value == "")) {  
            $value = ",";  
        } else {  
            $value = str_replace('"', '""', $value);  
            $value = '"' . $value . '"' . ",";  
        }  
        $line .= $value;  
    }  
    $data .= trim($line)."n";  
}  
$data = str_replace("r","",$data);  

if ($data == "") {  
    $data = "n(0) Records Found!n";                          
}  

header("Content-type: application/x-msdownload");  
header("Content-Disposition: attachment; filename=mailinglist.xls");  
header("Pragma: no-cache");  
header("Expires: 0");  
print "$headern$data";   
?> 
```

# c# - 为许多控件调用委托

> ID：855985
> 
> 赞同：2
> 
> 时间：2009-05-13T03:54:39.077
> 
> 标签：c#, delegates

C# 2008 SP1

下面的函数将从另一个线程调用。因此必须调用控件本身，以便创建它们的正确线程可以更改属性。

但是，因为我有许多控件需要更新。我真的不想为每个人写所有这些代表。我在下面做了一个。但是，我认为这是很多代码。有没有办法缩短这个？

非常感谢，

```
public void SetIdleState(string callStatusMsg)
    {
        this.btnCallAnswer.Text = CATWinSIP_MsgStrings.Call;
        this.btnEndCallReject.Text = CATWinSIP_MsgStrings.EndCall;
        this.btnHoldUnhold.Text = CATWinSIP_MsgStrings.Hold;

        this.btnCallAnswer.Enabled = true;
        this.btnRedial.Enabled = true;
        this.btnEndCallReject.Enabled = false;
        this.btnHoldUnhold.Enabled = false;

        if (this.statusDisplay1.InvokeRequired)
        {
            statusDisplay1.Invoke(new UpdateCallStatusDelegate(this.UpdateCallStatus), callStatusMsg);      
        }
        else
        {
           this.statusDisplay1.CallStatus = callStatusMsg;
        }
    }      

    // Delegate for marshalling the call on the correct thread.
    private delegate void UpdateCallStatusDelegate(string callStatusMsg);
    private void UpdateCallStatus(string callStatusMsg)
    {
        this.statusDisplay1.CallStatus = callStatusMsg;
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T03:58:34.390

怎么样：

```
Dispatcher.BeginInvoke(new DispatcherOperationCallback((param) =>

      {

           this.statusDisplay1.CallStatus = callStatusMsg;

          return null;

      }), DispatcherPriority.Background, new object[] { null });

    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T04:06:04.753

我问了一个类似的[问题](https://stackoverflow.com/questions/657037/why-the-overhead-for-multi-threaded-access-to-wpf-ui-controls)。Jon Skeet 提供的答案是我遇到的最佳方法。相关代码如下。

创建一个静态辅助方法：

```
public static void InvokeIfNecessary(UIElement element, MethodInvoker action)
{
    if (element.Dispatcher.Thread != Thread.CurrentThread)
    {
        element.Dispatcher.Invoke(DispatcherPriority.Normal, action);
    }
    else
    {
        action();
    }
} 
```

在您的示例中，您可以将其用作：

```
InvokeIfNecessary(statusDisplay1, delegate {statusDisplay1.CallStatus = callStatusMsg;}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T04:19:52.360

这是我在之前的项目中所做的：

我写了一个辅助静态类。

```
public static class WorkbenchService
{    
    private static SynchronizationContext uiContext;
static WorkbenchService()
{
    uiContext = WindowsFormsSynchronizationContext.Current;
}

/// <summary>
    /// Makes a call GUI threadSafe. WARNING: This method waits for the result of the operation, which can result in a dead-lock when the main thread waits for this thread to exit!
    /// </summary>
    public static void SafeThreadCall(SendOrPostCallback d, object state)
    {
        uiContext.Send(d, state);
    }
    /// <summary>
    /// Makes a call GUI thread safe without waiting for the returned value.
    /// </summary>
    public static void SafeThreadAsyncCall(SendOrPostCallback d, object state)
    {
        uiContext.Post(d, state);
    }
} 
```

然后我像这样使用它：

```
 WorkbenchService.SafeThreadAsyncCall(delegate                                                   {
    this.statusDisplay1.CallStatus = "Blah";
    this.btnCallAnswer.Text = "hello there";
}, null); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T05:21:50.840

我找到了最好的方法来做到这一点。并将我的代码转换为此。

希望这对其他人有帮助。

```
 // Delegate for marshalling the call on the correct thread.
    private delegate void SetIdleStateDelegate(string callStatusMsg);

    // Set object back to idle state.
    public void SetIdleState(string callStatusMsg)
    {
        if (this.InvokeRequired)
        {
            this.Invoke(new SetIdleStateDelegate(SetIdleState), callStatusMsg);
        }
        else
        {
            this.btnCallAnswer.Text = CATWinSIP_MsgStrings.Call;
            this.btnEndCallReject.Text = CATWinSIP_MsgStrings.EndCall;
            this.btnHoldUnhold.Text = CATWinSIP_MsgStrings.Hold;

            this.btnCallAnswer.Enabled = true;
            this.btnRedial.Enabled = true;
            this.btnEndCallReject.Enabled = false;
            this.btnHoldUnhold.Enabled = false;
        }           
    } 
```

# algorithm - 哈希函数输出是否需要小于桶数？

> ID：855989
> 
> 赞同：2
> 
> 时间：2009-05-13T03:57:37.763
> 
> 标签：algorithm, hashtable, hash

我正在阅读有关此人“在一家知名搜索公司”的采访。

[http://asserttrue.blogspot.com/2009/05/one-of-toughest-job-interview-questions.html](http://asserttrue.blogspot.com/2009/05/one-of-toughest-job-interview-questions.html)

他被问到一个导致他实现哈希表的问题。他说：

```
HASH = INITIAL_VALUE;
FOR EACH ( CHAR IN WORD ) {
HASH *= MAGIC_NUMBER
HASH ^= CHAR
HASH %= BOUNDS
}
RETURN HASH 
```

> 我解释了哈希表数组长度应该是素数，并且 BOUNDS 数小于表长度，但与表长度互质。

为什么 BOUNDS 数应该小于桶数？与桌子长度互质有什么作用？它不应该与 BOUNDS 互质吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T04:02:13.620

我敢说他完全错了。BOUNDS 应该是存储桶的数量，否则最后几个存储桶将未被充分利用。

此外，输出与桶数的界限应该在散列函数之外。这是该特定哈希表的实现细节。您可能有一张非常大的桌子，使用很多桶，而另一张桌子使用的桶很少。两者应该共享相同的字符串->哈希函数

此外，如果您阅读链接到的页面，那将非常有趣。我会将他的哈希表实现为类似于 10,000 个桶的东西 - 对于那些没有阅读过它的人，文章建议使用 ~ 4,000,000,000 个桶来存储大约 1,000,000 个可能的单词。对于冲突，每个桶都有一个词结构向量，每个都包含一个计数、一个明文字符串和一个哈希（在桶中是唯一的）。这将使用更少的内存并更好地与现代缓存一起使用，因为您的工作集会小得多。

为了进一步减少内存使用，您可以尝试在输入阶段从哈希中剔除根据当前计数看起来低于前 100,000 个的单词。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T08:53:08.093

我曾经在一家知名的搜索公司面试过一份工作。我得到了完全相同的问题。我试图通过使用哈希表来解决它。

我从那次采访中学到的一件事是，在一家著名的搜索公司，你不会提出哈希作为解决方案。你可以使用任何你喜欢的树状结构，但你总是使用有序结构，而不是哈希表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-19T18:31:02.190

一个简单的显式后缀树只会使用最坏的情况，可能是 500k 内存（具有中等效率的实现，4 字节字符编码，以及具有最小重叠的相对较长的英文单词）来做同样的事情。

我认为文章中的那个人比自己聪明。

# asp.net - 混合 ASP.NET Webforms 和 ASP.NET MVC

> ID：855990
> 
> 赞同：1
> 
> 时间：2009-05-13T03:58:14.547
> 
> 标签：asp.net, asp.net-mvc

我在使用表单身份验证时遇到问题。根 web.config 设置为拒绝所有未经身份验证的用户访问，其结构如下：

控制器
文件夹 - Webforms 文件夹1
- Webforms
模型
公共文件夹 - 带有 web.config 的 Webforms 以允许公共访问
查看
带有拒绝的 web.config

我还需要公开家庭控制器，但是如果我将授权属性从根 web.config 中移除，仍然会阻止对视图文件夹的访问。我想避免做类似下面的事情，我可以避免它。

控制器
Webforms
-Folder
-Folder2
-web.config 拒绝未经授权的用户
查看
web.config 具有公共访问权限

有没有人有任何想法让第一个目录结构工作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T07:14:52.433

我无法看到配置部分的实际外观。您可以编辑帖子并将这些部分放入代码示例块（文本编辑器工具栏中的二进制按钮）。

目标是锁定所有 WebForms 并公开 MVC 驱动的位吗？

（本来只是把它放在评论中，但我还没有代表点来发表评论。）

[编辑]为了提供一些有用的东西，但承认我仍然不知道你想要锁定哪些位的最终目标，在 MVC 方面，你在控制器中使用安全属性是否可行？例如，您可以将 [Authorize(Roles="YourRoles")] 添加到特定操作或控制器顶部，而不是尝试在 web.config 中锁定操作（或整个控制器）。这种方法的优点和缺点，但我喜欢它，因为我不必过多地弄乱配置文件，这是我根本不喜欢的东西。这当然是假设您使用的是标准的 ASP.NET 成员资格提供程序，但即使您已经推出了自己的，您也应该能够通过一些额外的努力以类似的方式完成任务。只是一个想法...

# design-patterns - 实施策略模式

> ID：855995
> 
> 赞同：2
> 
> 时间：2009-05-13T03:59:02.520
> 
> 标签：design-patterns, strategy-pattern

在实现策略模式时，将决定使用哪种策略的代码放在哪里？一些示例伪代码会有所帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T04:10:15.013

该决定由使用策略模式的对象的客户端做出。例如，假设您有一个角色对象，该对象使用不同的攻击方式攻击其他角色，具体取决于角色当时所拥有的武器。然后，当游戏玩家选择角色将使用的武器时，将决定使用哪种策略。

因此，角色和武器（示例中策略模式的两个主要组件）都不能决定使用哪个策略，而是使用角色和武器的代码来决定。通过简单地创建一个新的武器对象（比如 RayGunWeapon）并将其“提供”给您的角色，可以改变角色的行为。

即使您可以编写显式选择策略的代码，我认为这种模式的真正价值在于它可以在运行时完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T01:52:07.447

你如何选择实现它将决定代码在哪里，以及它是在运行时编译还是在运行时完成。

例如，如果您使用依赖注入 (DI)，那么您通常可以通过更改 xml 文件在运行时注入不同的策略。

如果您使用 AOP，那么它将在运行时或编译时，这取决于您编写方面的方式。

如果您使用 Spring Framework，那么这类似于使用 DI，并且可以像在不同的类中连接一样简单。

如果您使用服务定位器，那么它可能就像在不同的 DLL 中交换一样简单。

基本上有很多方法可以实现一个策略模式，我只是列出了一些，所以它所依赖的注释是非常正确的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T04:00:29.007

这完全取决于您何时决定采取哪种策略。有时可以在创建时解决策略，有时它是运行时的事情。简单的答案取决于。

# c++ - C++ 等价于指定初始化器？

> ID：855996
> 
> 赞同：37
> 
> 时间：2009-05-13T03:59:39.133
> 
> 标签：c++, c, designated-initializer

最近我一直在做一些嵌入式设备，我们有一些结构和联合需要在编译时初始化，这样我们就可以将某些不需要修改的东西保存在闪存或 ROM 中，并节省一点闪存或 SRAM 有点性能成本。目前该代码编译为有效的 C99，但如果没有此调整，它过去也可以编译为 C++ 代码，并且支持以这种方式编译的东西也很棒。防止这种情况发生的关键因素之一是我们使用了 C99 指定的初始化程序，这些初始化程序在 C++ 的 C 子集中不起作用。我不是 C++ 爱好者，所以我想知道在 C++ 兼容的 C 中可能有什么简单的方法可以实现这一点，

还有一点需要注意：指定初始化器使用的一个关键原因是初始化为不是联合的第一个成员。此外，为了保持与其他编译器的兼容性，坚持使用标准 C++ 或 ANSI C 是一个优势（我知道 GNU 扩展提供了类似没有 C99 的指定初始化程序之类的东西）。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-13T04:10:23.687

我不确定你可以在 C++ 中做到这一点。对于需要使用指定初始化程序初始化的内容，您可以将它们分别放在`.c`编译为 C99 的文件中，例如：

```
// In common header file
typedef union my_union
{
    int i;
    float f;
} my_union;

extern const my_union g_var;

// In file compiled as C99
const my_union g_var = { .f = 3.14159f };

// Now any file that #include's the header can access g_var, and it will be
// properly initialized at load time 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2012-07-21T13:43:21.933

基于 Shing Yip 的回答，并利用 3 年的时间，C++11 现在可以保证编译时初始化：

```
union Bar
{
    constexpr Bar(int a) : a_(a) {}
    constexpr Bar(float b) : b_(b) {}
    int a_;
    float b_;
};

extern constexpr Bar bar1(1);
extern constexpr Bar bar2(1.234f); 
```

集会：

```
 .globl  _bar1                   ## @bar1
    .p2align    2
_bar1:
    .long   1                       ## 0x1

    .globl  _bar2                   ## @bar2
    .p2align    2
_bar2:
    .long   1067316150              ## float 1.23399997 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T05:20:11.670

```
#ifdef __cplusplus
struct Foo
{
    Foo(int a, int b) : a(a), b(b) {}
    int a;
    int b;
};

union Bar
{
    Bar(int a) : a(a) {}
    Bar(float b) : b(b) {}
    int a;
    float b;
};

static Foo foo(1,2);
static Bar bar1(1);
static Bar bar2(1.234f);
#else 
 /* C99 stuff */
#endif // __cplusplus 
```

在 C++ 中，联合也可以有构造函数。可能这就是你想要的吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-07-12T05:45:53.443

这既是一个答案，也是一个问题。我意识到这个线程已经死了，但这正是我今晚正在研究的。

我做了一些探索，最接近我想要的东西（这与你想要的相似......我一直在使用图片并且不需要使用 C++，但我很好奇它是如何完成的) 是第一个代码示例：

```
#include <iostream>

using namespace std;

extern "C" 
{
    typedef struct stuff
    {
        int x;
        double y;
    } things;
}

int main()
{
    things jmcd = { jmcd.x = 12, jmcd.y = 10.1234 };
    cout << jmcd.x << " " << jmcd.y << endl;
    return 0;
} 
```

这与 C99 风格的指定初始化器外观非常相似，但需要注意的是我稍后会提到。（如果您希望结构体由其中任何一个编译，您可能会将其包装在 #ifdef __cplusplus 中。）我查看的第二个版本的代码是这样的：

```
#include <iostream>

using namespace std;

extern "C" 
{
    typedef struct stuff
    {
        int x;
        double y;
    } things;
}

int main()
{
    things jmcd;
    jmcd.x = 12;
    jmcd.y = 10.1234;
    cout << jmcd.x << " " << jmcd.y << endl;
    return 0;
} 
```

基本上，从反汇编来看，第一个示例似乎实际上更慢。我查看了汇编输出，嗯，我一定有点生疏了。也许有人可以给我一些见解。编译后的第一个 cpp 的程序集输出如下所示：

```
main:
.LFB957:
    .cfi_startproc
    .cfi_personality 0x0,__gxx_personality_v0
    pushl   %ebp
    .cfi_def_cfa_offset 8
    movl    %esp, %ebp
    .cfi_offset 5, -8
    .cfi_def_cfa_register 5
    subl    $24, %esp
    movl    $0, 12(%esp)
    movl    $0, 16(%esp)
    movl    $0, 20(%esp)
    movl    $12, 12(%esp)
    movl    12(%esp), %eax
    movl    %eax, 12(%esp)
    fldl    .LC0
    fstpl   16(%esp)
    fldl    16(%esp)
    fstpl   16(%esp)
    movl    12(%esp), %eax
    movl    %eax, 4(%esp)
    fildl   4(%esp)
    fldl    16(%esp)
    faddp   %st, %st(1)
    fnstcw  2(%esp)
    movzwl  2(%esp), %eax
    movb    $12, %ah
    movw    %ax, (%esp)
    fldcw   (%esp)
    fistpl  4(%esp)
    fldcw   2(%esp)
    movl    4(%esp), %eax
    leave
    ret
    .cfi_endproc 
```

第二个示例如下所示：

```
main:
.LFB957:
    .cfi_startproc
    .cfi_personality 0x0,__gxx_personality_v0
    pushl   %ebp
    .cfi_def_cfa_offset 8
    movl    %esp, %ebp
    .cfi_offset 5, -8
    .cfi_def_cfa_register 5
    subl    $24, %esp
    movl    $12, 12(%esp)
    fldl    .LC0
    fstpl   16(%esp)
    movl    12(%esp), %eax
    movl    %eax, 4(%esp)
    fildl   4(%esp)
    fldl    16(%esp)
    faddp   %st, %st(1)
    fnstcw  2(%esp)
    movzwl  2(%esp), %eax
    movb    $12, %ah
    movw    %ax, (%esp)
    fldcw   (%esp)
    fistpl  4(%esp)
    fldcw   2(%esp)
    movl    4(%esp), %eax
    leave
    ret
    .cfi_endproc 
```

这两个都是用`g++ -O0 -S main.cpp`命令生成的。显然，直观上效率较低的示例在指令数量方面生成了更有效的操作码。另一方面，在少数情况下，我可以想象这几条指令是至关重要的。（另一方面，我真的很难理解不是由人类编写的程序集，所以也许我遗漏了一些东西......）我认为这为詹姆斯提出的问题提供了一个解决方案，尽管很晚。接下来我应该测试的是 C99 中是否允许相同的初始化；如果可行，我认为它完全解决了詹姆斯的问题。

免责声明：我不知道这对于 g++ 以外的任何其他编译器是否有效或行为相似。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T04:25:13.303

以下代码使用 g++ 编译没有问题：

```
#include <iostream>

struct foo
{
  int a;
  int b;
  int c;
};

union bar
{
  int a;
  float b;
  long c;
};

static foo s_foo1 = {1,2,3};
static foo s_foo2 = {1,2};
static bar s_bar1 = {42L};
static bar s_bar2 = {1078523331}; // 3.14 in float

int main(int, char**)
{
  std::cout << s_foo1.a << ", " <<
               s_foo1.b << ", " <<
               s_foo1.c << std::endl;

  std::cout << s_foo2.a << ", " <<
               s_foo2.b << ", " <<
               s_foo2.c << std::endl;

  std::cout << s_bar1.a << ", " <<
               s_bar1.b << ", " <<
               s_bar1.c << std::endl;

  std::cout << s_bar2.a << ", " <<
               s_bar2.b << ", " <<
               s_bar2.c << std::endl;

  return 0;
} 
```

结果如下：

```
$ g++ -o ./test ./test.cpp
$ ./test
1, 2, 3
1, 2, 0
42, 5.88545e-44, 42
1078523331, 3.14, 1078523331 
```

C++ 初始化器唯一的事情是您需要初始化结构的所有元素，否则其余元素将被初始化为零。你不能挑挑拣拣。但这对于您的用例来说应该仍然可以。

> 还有一点需要注意：指定初始化器使用的一个关键原因是初始化为不是联合的第一个成员。

为此，您需要使用示例中显示的“解决方法”，我通过提供等效的 int 值来设置“float”成员。这有点像黑客，但如果它解决了你的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-13T04:28:28.930

干孔报告：

给定

```
struct S {
  int mA;
  int mB;
  S() {}
  S(int b} : mB(b) {} // a ctor that does partial initialization
}; 
```

我尝试从 S 派生 S1，其中 S1 的内联默认构造函数调用 S(int) 并传递一个硬编码值......

```
struct S1 {
  S1() : S(22) {}
} s1; 
```

...然后用 gcc 4.0.1 -O2 -S 编译。希望优化器会看到 s1.mB 必然是 22 并在编译时为其赋值，但来自汇编器......

```
 movl    $22, 4+_s1-"L00000000002$pb"(%ebx) 
```

...看起来生成的代码在 main 之前在运行时进行了初始化。即使它成功了，它也很难编译为 C99，并且会为你想要初始化的每个对象派生一个类。所以，不要打扰。

# css - 你能想到哪些好的 CSS 速记？

> ID：855998
> 
> 赞同：0
> 
> 时间：2009-05-13T04:01:18.473
> 
> 标签：css, forms, stylesheet, short, shorthand

我能想到的一些是

font: bold 20px Verdana, sans-serif /* 一行表示变体、大小和系列 */

color: #336 /* 短颜色代码 */

height: 0 /* 0时不需要指定单位 */

border: 0 /* 和border: 一样的效果，但是更短 */

background: #ffc /* 如果只需要颜色，则无需使用背景颜色 */

填充：0；边框：0；margin: 0 /* 只显示内容，不显示其他 */

border: 1px dashed #ff0 /* 粗细、样式和颜色 */

margin: 0 0.5em /* 指定上、下、左、右边距 */

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T04:06:49.090

```
 1\. background: #fff url(image.png) no-repeat 20px 100px fixed;
 2\. ul { list-style: decimal-leading-zero inside; } 
```

**逗号分隔的声明**

1.  h1，h2，h3，h4，h5，h6 {字体系列：Helvetica，Verdana，无衬线；}

**第一个孩子选择器**

```
 1\. .footer em:first-child { color:#ccc; } 
```

**CSS3 特性**

**带半径的圆角框**

1.  `.rounded_corner { -moz-border-radius:10px; -webkit-border-radius:10px; width:400px; height:100px; background-color:#000; }`

**阴影效果**

.shadow { 宽度：400px; 高度：200px；背景颜色：#000; -webkit-box-shadow: 5px 5px 2px #ccc; }

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T04:32:07.847

您还可以使用字体属性指定行高

```
font: bold 20px/1em Verdana, sans-serif /* one line for variant, size, and family */ 
```

其中 1em 是行高

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T04:48:45.497

大纲的另一个：

```
outline:3px dotted gray; 
```

list-style 也支持图像：

```
list-style:square inside url(image.gif); 
```

有点多余，但这是另一篇解释它们的文章：

[http://www.456bereastreet.com/archive/200502/efficient_css_with_shorthand_properties/](http://www.456bereastreet.com/archive/200502/efficient_css_with_shorthand_properties/)

# winforms - Windows 窗体中的类名

> ID：855999
> 
> 赞同：0
> 
> 时间：2009-05-13T04:01:22.983
> 
> 标签：winforms, class-names

我想知道在 .NET 应用程序中动态更改类名。例如 WindowsForms10.SysTreeView32.app.0.19fd5c7。最后一个字符串“19fd5c7”会改变，但我不知道是什么让它改变了。是版本，GUI修改，环境，操作系统还是什么？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-30T09:07:31.673

它实际上是基于当前应用程序域的哈希码。***********