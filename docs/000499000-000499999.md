# StackOverflow 问答 000499000-000499999

# java - Java：如何确定流的正确字符集编码

> ID：499010
> 
> 赞同：152
> 
> 时间：2009-01-31T15:34:10.040
> 
> 标签：java, file, encoding, stream, character-encoding

参考以下线程： [Java App：无法正确读取 iso-8859-1 编码文件](https://stackoverflow.com/questions/498636/java-app-unable-to-read-iso-8859-1-encoded-file-correctly)

以编程方式确定输入流/文件的正确字符集编码的最佳方法是什么？

我尝试过使用以下内容：

```
File in =  new File(args[0]);
InputStreamReader r = new InputStreamReader(new FileInputStream(in));
System.out.println(r.getEncoding()); 
```

但是在我知道用 ISO8859_1 编码的文件上，上面的代码会产生 ASCII，这是不正确的，并且不允许我将文件的内容正确地呈现回控制台。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-01-31T15:44:22.563

您无法确定任意字节流的编码。这就是编码的本质。编码意味着字节值与其表示之间的映射。所以每个编码“可能”都是正确的。

[getEncoding()](http://docs.oracle.com/javase/7/docs/api/java/io/InputStreamReader.html#getEncoding%28%29)方法将返回为流设置（读取[JavaDoc](http://docs.oracle.com/javase/7/docs/api/java/io/InputStreamReader.html#getEncoding%28%29) ）的编码。它不会为您猜测编码。

一些流会告诉您使用哪种编码来创建它们：XML、HTML。但不是任意字节流。

无论如何，如果必须，您可以尝试自己猜测编码。每种语言的每个字符都有一个共同的频率。在英语中，char e 经常出现，但 ê 很少出现。在 ISO-8859-1 流中，通常没有 0x00 字符。但是 UTF-16 流有很多。

或者：您可以询问用户。我已经看到应用程序以不同的编码向您显示文件的片段，并要求您选择“正确”的那个。

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2011-01-19T13:44:36.570

我使用了这个库，类似于 jchardet 来检测 Java 中的编码： [https ://github.com/albfernandez/juniversalchardet](https://github.com/albfernandez/juniversalchardet)

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2010-10-25T10:11:42.677

看看这个： [http](http://site.icu-project.org/) ://site.icu-project.org/ (icu4j) 他们有用于从 IOStream 检测字符集的库可能很简单，如下所示：

```
BufferedInputStream bis = new BufferedInputStream(input);
CharsetDetector cd = new CharsetDetector();
cd.setText(bis);
CharsetMatch cm = cd.detect();

if (cm != null) {
   reader = cm.getReader();
   charset = cm.getName();
}else {
   throw new UnsupportedCharsetException()
} 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2014-11-30T12:48:37.557

这是我的最爱：

**[TikaEncodingDetector](http://tika.apache.org/)**

依赖：

```
<dependency>
  <groupId>org.apache.any23</groupId>
  <artifactId>apache-any23-encoding</artifactId>
  <version>1.1</version>
</dependency> 
```

样本：

```
public static Charset guessCharset(InputStream is) throws IOException {
  return Charset.forName(new TikaEncodingDetector().guessEncoding(is));    
} 
```

**[猜测编码](https://github.com/codehaus/guessencoding)**

依赖：

```
<dependency>
  <groupId>org.codehaus.guessencoding</groupId>
  <artifactId>guessencoding</artifactId>
  <version>1.4</version>
  <type>jar</type>
</dependency> 
```

样本：

```
 public static Charset guessCharset2(File file) throws IOException {
    return CharsetToolkit.guessEncoding(file, 4096, StandardCharsets.UTF_8);
  } 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-02-01T07:33:32.163

您当然可以通过使用 a 对其进行[解码](http://java.sun.com/javase/6/docs/api/java/nio/charset/CharsetDecoder.html#decode(java.nio.ByteBuffer,%20java.nio.CharBuffer,%20boolean))并注意“格式错误的输入”或“不可映射的字符”错误来*验证*特定字符集的文件。当然，这只会告诉您字符集是否错误；它不会告诉你它是否正确。为此，您需要一个比较基础来评估解码结果，例如，您是否事先知道字符是否被限制在某个子集，或者文本是否遵循某种严格的格式？底线是字符集检测是没有任何保证的猜测。[`CharsetDecoder`](http://java.sun.com/javase/6/docs/api/java/nio/charset/CharsetDecoder.html)

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2015-09-03T10:38:00.120

### 使用哪个库？

在撰写本文时，它们是出现的三个库：

*   [猜测编码](http://mvnrepository.com/artifact/org.codehaus.guessencoding/guessencoding)
*   [ICU4j](http://mvnrepository.com/artifact/com.ibm.icu)
*   [朱尼韦尔沙尔德特](http://mvnrepository.com/artifact/com.googlecode.juniversalchardet/juniversalchardet)

我不包括[Apache Any23](http://mvnrepository.com/artifact/org.apache.any23/apache-any23-encoding)，因为它在后台使用 ICU4j 3.4。

### 如何判断哪一个检测到了*正确*的字符集（或尽可能接近）？

无法验证上述每个库检测到的字符集。但是，可以依次询问他们并对返回的响应进行评分。

### 如何对返回的响应进行评分？

每个响应可以被分配一个点。响应的点数越多，检测到的字符集的置信度就越高。这是一种简单的评分方法。你可以详细说明其他的。

### 有没有示例代码？

这是实现前几行中描述的策略的完整片段。

```
public static String guessEncoding(InputStream input) throws IOException {
    // Load input data
    long count = 0;
    int n = 0, EOF = -1;
    byte[] buffer = new byte[4096];
    ByteArrayOutputStream output = new ByteArrayOutputStream();

    while ((EOF != (n = input.read(buffer))) && (count <= Integer.MAX_VALUE)) {
        output.write(buffer, 0, n);
        count += n;
    }

    if (count > Integer.MAX_VALUE) {
        throw new RuntimeException("Inputstream too large.");
    }

    byte[] data = output.toByteArray();

    // Detect encoding
    Map<String, int[]> encodingsScores = new HashMap<>();

    // * GuessEncoding
    updateEncodingsScores(encodingsScores, new CharsetToolkit(data).guessEncoding().displayName());

    // * ICU4j
    CharsetDetector charsetDetector = new CharsetDetector();
    charsetDetector.setText(data);
    charsetDetector.enableInputFilter(true);
    CharsetMatch cm = charsetDetector.detect();
    if (cm != null) {
        updateEncodingsScores(encodingsScores, cm.getName());
    }

    // * juniversalchardset
    UniversalDetector universalDetector = new UniversalDetector(null);
    universalDetector.handleData(data, 0, data.length);
    universalDetector.dataEnd();
    String encodingName = universalDetector.getDetectedCharset();
    if (encodingName != null) {
        updateEncodingsScores(encodingsScores, encodingName);
    }

    // Find winning encoding
    Map.Entry<String, int[]> maxEntry = null;
    for (Map.Entry<String, int[]> e : encodingsScores.entrySet()) {
        if (maxEntry == null || (e.getValue()[0] > maxEntry.getValue()[0])) {
            maxEntry = e;
        }
    }

    String winningEncoding = maxEntry.getKey();
    //dumpEncodingsScores(encodingsScores);
    return winningEncoding;
}

private static void updateEncodingsScores(Map<String, int[]> encodingsScores, String encoding) {
    String encodingName = encoding.toLowerCase();
    int[] encodingScore = encodingsScores.get(encodingName);

    if (encodingScore == null) {
        encodingsScores.put(encodingName, new int[] { 1 });
    } else {
        encodingScore[0]++;
    }
}    

private static void dumpEncodingsScores(Map<String, int[]> encodingsScores) {
    System.out.println(toString(encodingsScores));
}

private static String toString(Map<String, int[]> encodingsScores) {
    String GLUE = ", ";
    StringBuilder sb = new StringBuilder();

    for (Map.Entry<String, int[]> e : encodingsScores.entrySet()) {
        sb.append(e.getKey() + ":" + e.getValue()[0] + GLUE);
    }
    int len = sb.length();
    sb.delete(len - GLUE.length(), len);

    return "{ " + sb.toString() + " }";
} 
```

*改进：* 该`guessEncoding`方法完全读取输入流。对于大型输入流，这可能是一个问题。所有这些库都会读取整个输入流。这意味着检测字符集会耗费大量时间。

可以将初始数据加载限制为几个字节并仅对这几个字节执行字符集检测。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2016-05-12T20:14:41.053

据我所知，在这种情况下没有通用库适合所有类型的问题。因此，对于每个问题，您都应该测试现有的库并选择满足您问题约束的最佳库，但通常它们都不合适。在这些情况下，您可以编写自己的编码检测器！正如我所写...

我使用 IBM ICU4j 和 Mozilla JCharDet 作为内置组件编写了一个用于检测 HTML 网页的字符集编码的元 java 工具。[在这里](https://github.com/shabanali-faghani/IUST-HTMLCharDet)你可以找到我的工具，请先阅读自述文件部分。[此外，您可以在我的论文](http://link.springer.com/chapter/10.1007/978-3-319-28940-3_17)及其参考文献 中找到这个问题的一些基本概念。

下面我提供了一些我在工作中遇到的有用的评论：

*   字符集检测不是一个万无一失的过程，因为它本质上是基于统计数据，而实际发生的是**猜测**而不是**检测**
*   icu4j 是 IBM 在这种情况下的主要工具，恕我直言
*   TikaEncodingDetector 和 Lucene-ICU4j 都在使用 icu4j，它们的准确性与我的测试中的 icu4j 没有显着差异（我记得最多为 %1）
*   icu4j 比 jchardet 更通用，icu4j 只是有点偏向 IBM 系列编码，而 jchardet 强烈偏向 utf-8
*   由于 UTF-8 在 HTML 世界中的广泛使用；总体而言，jchardet 是比 icu4j 更好的选择，但不是最佳选择！
*   icu4j 非常适合东亚特定编码，例如 EUC-KR、EUC-JP、SHIFT_JIS、BIG5 和 GB 系列编码
*   icu4j 和 jchardet 在处理具有 Windows-1251 和 Windows-1256 编码的 HTML 页面时都失败了。Windows-1251 aka cp1251 广泛用于基于西里尔文的语言，如俄语，Windows-1256 aka cp1256 广泛用于阿拉伯语
*   几乎所有编码检测工具都使用统计方法，因此输出的准确性很大程度上取决于输入的大小和内容
*   一些编码本质上是相同的，只是有部分差异，所以在某些情况下，猜测或检测到的编码可能是错误的，但同时也是正确的！关于 Windows-1252 和 ISO-8859-1。（参考我论文5.2部分的最后一段）

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-02-15T11:53:01.363

上面的库是简单的 BOM 检测器，当然只有在文件开头有 BOM 时才有效。看看[http://jchardet.sourceforge.net/](http://jchardet.sourceforge.net/)它确实扫描了文本

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2010-01-07T09:04:04.057

我找到了一个不错的第三方库，可以检测实际编码： [http ://glaforge.free.fr/wiki/index.php?wiki=GuessEncoding](http://glaforge.free.fr/wiki/index.php?wiki=GuessEncoding)

我没有对它进行广泛的测试，但它似乎有效。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-04-04T21:01:42.790

如果您使用 ICU4J ( [http://icu-project.org/apiref/icu4j/](http://icu-project.org/apiref/icu4j/) )

这是我的代码：

```
String charset = "ISO-8859-1"; //Default chartset, put whatever you want

byte[] fileContent = null;
FileInputStream fin = null;

//create FileInputStream object
fin = new FileInputStream(file.getPath());

/*
 * Create byte array large enough to hold the content of the file.
 * Use File.length to determine size of the file in bytes.
 */
fileContent = new byte[(int) file.length()];

/*
 * To read content of the file in byte array, use
 * int read(byte[] byteArray) method of java FileInputStream class.
 *
 */
fin.read(fileContent);

byte[] data =  fileContent;

CharsetDetector detector = new CharsetDetector();
detector.setText(data);

CharsetMatch cm = detector.detect();

if (cm != null) {
    int confidence = cm.getConfidence();
    System.out.println("Encoding: " + cm.getName() + " - Confidence: " + confidence + "%");
    //Here you have the encode name and the confidence
    //In my case if the confidence is > 50 I return the encode, else I return the default value
    if (confidence > 50) {
        charset = cm.getName();
    }
} 
```

记得把所有的try-catch 都需要它。

我希望这对你有用。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-01-31T15:46:01.810

如果你不知道你的数据的编码，那不是那么容易确定的，但是你可以尝试使用一个[库来猜测它](http://glaforge.free.fr/wiki/index.php?wiki=GuessEncoding)。此外，还有[一个类似的问题](https://stackoverflow.com/questions/457655/java-charset-and-windows/457849#457849)。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-26T07:20:38.257

对于 ISO8859_1 文件，没有简单的方法可以将它们与 ASCII 区分开来。然而，对于 Unicode 文件，通常可以根据文件的前几个字节检测到这一点。

UTF-8 和 UTF-16 文件在文件的开头包含一个[字节顺序标记(BOM)。](http://en.wikipedia.org/wiki/Byte-order_mark)BOM 是一个零宽度的不间断空间。

不幸的是，由于历史原因，Java 不会自动检测到这一点。记事本等程序将检查 BOM 并使用适当的编码。使用 unix 或 Cygwin，您可以使用 file 命令检查 BOM。例如：

```
$ file sample2.sql 
sample2.sql: Unicode text, UTF-16, big-endian 
```

对于 Java，我建议您查看此代码，它将检测常见的文件格式并选择正确的编码： [如何读取文件并自动指定正确的编码](http://www.ericbt.com/Blog/60)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-05-11T13:04:14.007

TikaEncodingDetector 的替代方法是使用[Tika AutoDetectReader](https://tika.apache.org/1.2/api/org/apache/tika/detect/AutoDetectReader.html)。

```
Charset charset = new AutoDetectReader(new FileInputStream(file)).getCharset(); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-03-11T00:01:18.477

处理此问题的一个好策略是使用自动检测输入字符集的方法。

我在 Java 11 中使用 org.xml.sax.InputSource 来解决它：

```
...    
import org.xml.sax.InputSource;
...

InputSource inputSource = new InputSource(inputStream);
inputStreamReader = new InputStreamReader(
    inputSource.getByteStream(), inputSource.getEncoding()
  ); 
```

输入样本：

```
<?xml version="1.0" encoding="utf-16"?>
<rss xmlns:dc="https://purl.org/dc/elements/1.1/" version="2.0">
<channel>
...**strong text** 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2018-07-28T16:59:04.497

在纯 Java 中：

```
final String[] encodings = { "US-ASCII", "ISO-8859-1", "UTF-8", "UTF-16BE", "UTF-16LE", "UTF-16" };

List<String> lines;

for (String encoding : encodings) {
    try {
        lines = Files.readAllLines(path, Charset.forName(encoding));
        for (String line : lines) {
            // do something...
        }
        break;
    } catch (IOException ioe) {
        System.out.println(encoding + " failed, trying next.");
    }
} 
```

这种方法将一个一个地尝试编码，直到一个工作或者我们用完它们。（顺便说一句，我的编码列表只有这些项目，因为它们是每个 Java 平台上所需的字符集实现，[https:](https://docs.oracle.com/javase/9/docs/api/java/nio/charset/Charset.html) //docs.oracle.com/javase/9​​/docs/api/java/nio/charset/Charset.html ）

* * *

## 回答 #16

> 赞同：-12
> 
> 时间：2009-01-31T15:44:08.880

你能在[Constructor](http://java.sun.com/javase/6/docs/api/java/io/InputStreamReader.html)中选择合适的字符集吗：

```
new InputStreamReader(new FileInputStream(in), "ISO8859_1"); 
```

# project-management - 你能在一个项目上工作超过 10 年而不发布任何东西吗？

> ID：499011
> 
> 赞同：3
> 
> 时间：2009-01-31T15:34:33.767
> 
> 标签：project-management, time-management

我在网上冲浪时发现自己在[3D Realms 招聘页面](http://www.3drealms.com/gethired.html)。他们在那里做的广告听起来很不错。您可以在任何地方阅读诸如“摆脱任意完成日期压力”之类的内容。

这对我来说听起来很明智，因为我自己有时也会遇到日程安排问题。但是当我将声明与游戏联系起来时，他们将发布“当它完成时”Duke Nukem Forever 我想到了一个问题：“我可以在一个软件项目上工作超过 10 年而不发布任何东西吗？”

没有发布派对，没有它 - 终于发货的感觉等。

也许还有其他我不知道的动机。你会怎么想？

顺便提一句。关于 DNF 的一些有趣的东西：http: [//duke.a-13.net](http://duke.a-13.net)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-31T15:40:43.240

是的，你可以……但是，找到一个愿意支付你十年而不发布任何东西的人是另一回事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T17:55:26.727

对不起，但这不是一个项目。项目是具有明确目标、明确预算和明确结束日期的事业。如果你没有这三个，你就没有在做一个项目。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-31T16:00:05.447

我想说这很大程度上取决于你的个性：

*   对您来说，获得客户对您实施的内容的反馈是否重要，或者您对代码的美感和同事的反馈是否满意？
*   你想/喜欢向公众展示你的作品，例如做演讲吗？
*   “内部里程碑派对”会给你和发布派对一样的满足感吗？
*   您能否始终如一地在没有截止日期的情况下完成一项任务（或者这会导致您在一项任务变得无聊时立即从一项任务跳到另一项任务），留下很多未完成的工作？

对我（就我个人而言）来说，我不想做一些看起来在可预见的将来不会发布的东西，因为我真的很想念来自社区的反馈......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T15:43:09.443

我做不到。我不认为我可以专注于一个项目 10 年而没有任何东西可以展示。它让我想起了很多 SharpEnviro，这是一个 10 年前开始开发的 Windows 替换 shell，它们的版本为 0.0.7，当前没有稳定版本。它是用 Delphi 编写的。我什至无法长时间专注于为单个项目使用一种语言。我的意思是，哇！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-04T23:01:08.840

是的我可以。这并不意味着您（或其他任何人）可以或应该。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-31T16:19:30.243

简短的回答：“不”。您必须设定目标并释放以实现目标。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-31T16:31:56.507

如果**可以**的话，IMO，一个人格问题（见其他人）

另一个方面是：你**应该**。在这里，您需要考虑诸如

*   对你的简历的影响，尤其是。如果您在发布完成之前离开，或者项目最终失败（很有可能）。
*   你的职业发展。很有可能，当你最终完成时，所使用的技术和方法也至少有十年的历史。

# java - 为什么在远程系统上运行批处理文件时出现“路径不正确”错误？

> ID：499013
> 
> 赞同：0
> 
> 时间：2009-01-31T15:34:45.250
> 
> 标签：java, path, exec, network-shares

我需要从本地计算机在远程系统上运行批处理文件。使用下面的代码，我收到以下错误：

```
Path not correct 
```

我有机器的 IP 地址，我将批处理文件作为公共共享，共享名称是`dsc`.

机器的IP地址是16.181.37.28。

这是我的代码。我知道路径是错误的。我怎样才能给出确切的路径？

```
/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/**
 *
 * @author padmaja
 */

import java.io.*;
class Test{
public static void main(String arg[]){
try{
String command = "cmd /C start 16.181.37.28/dsc/StartVisTsDataCenterMySql-log.bat";
Runtime rt = Runtime.getRuntime();
Process pr = rt.exec(command);

}catch (IOException e) {
e.printStackTrace();
}
}
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T15:52:29.177

您是要在远程机器上还是在本地机器上运行脚本？您的方法将从远程机器读取文件，但在本地运行它。

在远程机器上运行某些东西的常用方法是让远程机器上的进程永久运行并监听请求。如果请求到达，此过程将启动您想要运行的批处理文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T19:33:35.470

您可以通过创建服务来测试它是否有效：

`sc \\16.181.37.28 create StartVisTsDataCenterMySql-Log binPath= "cmd /c \\16.181.37.28\dsc\StartVisTsDataCenterMySql-log.bat"`

然后运行它的命令是：

`"cmd /c sc \\16.181.37.28 stop StartVisTsDataCenterMySql-Log&sc \\16.181.37.28 start StartVisTsDataCenterMySql-Log"`

您需要以管理员身份连接到共享（或保存凭据）。确认有效后，更改为[srvany](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd)，因为您将在事件日志中收到错误，否则批处理文件将只允许运行 30 秒。

如果这不是正确的答案，也许您可​​以详细说明[真正的需求](http://blogs.msdn.com/oldnewthing/archive/2006/03/23/558887.aspx)，并提供一些关于用 Java 重新实现批处理文件是否是现实解决方案的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T15:42:38.447

您在 Windows 上运行，但使用 Posix 路径分隔符。试试`"cmd /C \\\\16.181.37.28\\dsc\\StartVisTsDataCenterMySql-log.bat"`。

# php - 我需要使用 php 更改日期格式

> ID：499014
> 
> 赞同：1
> 
> 时间：2009-01-31T15:35:45.573
> 
> 标签：php, mysql, date-format

嗨，我已经查看了一个已经发布的关于此的问题，并试图调整我的代码来做类似的事情。基本上，我的 mysql 数据库中有一个字段，其日期格式为 yyyy-dd-mm，我需要格式为 dd-mm-yyyy。目前，我的代码卡在了行上`echo "<td><strong> ("d/m/y",". $row['date'] .")</strong></td>";`并读取此 Parse 错误：语法错误，意外 T_STRING，期望 '，' 或 ';'。不知道如何解决这个我会很感激的任何想法。

```
$result = mysql_query("SELECT * FROM dbGigs WHERE CURDATE() < date ORDER BY date");

echo "<table class=\"gigs\">
<tr>
<th>Venue</th>
<th>Town</th>
<th>Date</th>
<th>Time</th>
<th>Status</th>
</tr>";

while($row = mysql_fetch_array($result))
  {
  echo "<tr>";
  echo "<td><strong>" . $row['venue'] . "</strong></td>";
  echo "<td><strong>" . $row['town'] . "</strong></td>";
  echo "<td><strong> ("d/m/y",". $row['date'] .")</strong></td>";
  echo "<td><strong>" . $row['time'] . "</strong></td>";
  echo "<td><strong>" . $row['status'] . "</strong></td>";
  echo "</tr>"; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-31T15:39:34.523

第一件事

```
 echo "<td><strong> ("d/m/y",". $row['date'] .")</strong></td>"; 
```

这条线看起来不对；我怀疑它应该读到类似

```
 echo "<td><strong>" . date( "d/m/y", $row['date'] ) . "</strong></td>"; 
```

请注意缺少的函数调用和连接运算符。顺便说一句，虽然这在语法上是正确的（据我所知），但它可能无法满足您的需求，具体取决于`$row['date']`实际包含的内容 - 它需要一个 Unix 时间戳`date()`才能正确理解它。

要获取日期作为 Unix 时间戳，可以[`UNIX_TIMESTAMP()`](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_unix-timestamp)在选择日期时使用 MySQL 函数，例如

```
SELECT *, UNIX_TIMESTAMP(date) AS date_ts FROM ... 
```

然后您可以`$row['date_ts']`正常访问，并将其传递给`date()`函数进行格式化。或者，您可以使用类似[`strtotime()`](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_unix-timestamp)的方法来解析返回的当前值，以便从中获取时间戳。

[`DATE_FORMAT()`](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_date-format)另一种选择是让 MySQL 使用其功能代表您格式化日期；同样，您可以访问从查询返回的这个值并将其打印出来。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-20T05:33:58.683

像这样使用它：

```
echo "<td><strong>".date("d/m/y", strtotime($row['date']))."</strong></td>"; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T04:55:39.673

```
$res = mysql_query('SELECT dte FROM vtable');
$row = mysql_fetch_array($res);
print date('d M Y', strtotime($row['dte'])); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T15:41:19.370

您必须调用该[`date`函数](http://docs.php.net/date)：

```
echo "<td><strong>".date("d/m/y", $row['date'])."</strong></td>"; 
```

# c++ - 擦除类的所有成员

> ID：499016
> 
> 赞同：2
> 
> 时间：2009-01-31T15:36:34.887
> 
> 标签：c++

昨天我读了一个同事的一些代码并遇到了这个：

```
class a_class
{
public:
    a_class() {...}
    int some_method(int some_param) {...}

    int value_1;
    int value_2;
    float value_3;
    std::vector<some_other_class*> even_more_values;
    /* and so on */
 }

 a_class a_instances[10];

 void some_function()
 {
     do_stuff();
     do_more_stuff();

     memset(a_instances, 0, 10 * sizeof(a_class)); // <===== WTF?
 } 
```

这合法吗（WTF 行，而不是公共属性）？对我来说，它闻起来非常非常糟糕......使用 VC8 编译时代码运行良好，但在调用 VC9 时`a_instances[0].event_more_values.push_back(whatever)`，但在访问任何其他成员时，它会抛出“意外异常”。有什么见解吗？

编辑：将 memset 从更改`memset(&a_instances...`为`memset(a_instances...`. 感谢您指出爱德华。
EDIT2：删除了 ctor 的返回类型。谢谢立博。

结论：谢谢各位，你证实了我的怀疑。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-31T16:04:32.943

这是一种广泛接受的 C 结构初始化方法。
在 C++ 中它当然不起作用，因为你不能假设任何关于`vector`s 内部结构的事情。将其归零很可能使其处于非法状态，这就是您的程序崩溃的原因。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-31T16:11:00.607

他在非 POD 类类型上使用 memset。这是无效的，因为 C++ 只允许在最简单的情况下使用它：类没有用户声明的构造函数、析构函数、没有虚函数和更多限制。它的一组对象不会改变这一事实。

如果他删除了向量，他可以在上面使用 memset。一张纸条。即使它不是 C++，它也可能对他的编译器有效——因为如果标准说某些东西具有未定义的行为，实现可以做他们想做的一切——包括支持这种行为并说明会发生什么。在他的情况下，发生的事情可能是您在其上应用 memset，它会默默地清除向量的任何成员。其中可能指向已分配内存的指针现在将只包含零，而它并不知道。

您可以建议他使用以下方法清除它：

```
...
for(size_t i=0; i < 10; i++)
    objects[i].clear(); 
```

并使用类似的东西写清楚：

```
void clear() {
    a_object o;
    o.swap(*this);
} 
```

交换只会将 o 的向量与 *this 的向量交换，并清除其他变量。交换向量特别便宜。他当然需要编写一个交换函数，交换向量 ( `even_more_values.swap(that.even_more_values)`) 和其他变量。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-31T15:38:37.830

我不确定，但我认为 memset 会删除向量的内部数据。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-31T15:49:56.920

将 a_instances 清零时，您还将其中的 std_vector 清零。它可能在构造时分配一个缓冲区。现在，当您尝试 push_back 时，它会看到指向缓冲区的指针为 NULL（或其他一些内部成员），因此它会引发异常。

如果你问，这是不合法的。那是因为您不能通过指针重载写入，因为您可以重载赋值运算符。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-31T15:50:05.267

您不应该对 C++ 对象执行 memset，因为它不会调用正确的构造函数或析构函数。

特别是在这种情况下，不调用所有*a_instances元素的**even_more_values*成员的析构函数。

 *实际上，至少对于您列出的成员（在 /* 等 */ 之前），您不需要调用 memset 或创建任何特殊的析构函数或 clear() 函数。默认析构函数会自动删除所有这些成员。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-31T15:59:32.953

你应该在你的类中实现一个方法'clear'

```
void clear()
  {
  value1=0;
  value2=0;
  value_3=0f;
  even_more_values.clear();
  } 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-31T16:12:03.473

最糟糕的是，如果向量中有任何内容，那么该内存现在会丢失，因为没有调用构造函数。

永远不要覆盖 C++ 对象。曾经。如果它是派生对象（并且我不知道 std::vector 的细节），则此代码还会覆盖对象的 vtable，使其崩溃和损坏。

写这篇文章的人不了解对象是什么，需要你解释它们是什么以及它们是如何工作的，这样他们将来就不会犯这种错误。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-31T16:20:17.887

你在这里拥有的东西可能不会崩溃，但它也可能不会做你想做的事！将向量清零不会为每个`a_class`实例调用析构函数。它还将覆盖内部数据`a_class.even_more_values`（因此，如果您`push_back()`在之后，`memset()`您可能会遇到访问冲突）。

我会做两件不同的事情：

1.  使用 std::vector 存储 in`a_class`和 in `some_function()`。
2.  `a_class`为正确清理编写一个析构函数

如果您这样做，编译器将自动为您管理存储。

例如：

```
class a_class
{
public:
    a_class() {...}
    ~a_class() { /* make sure that even_more_values gets cleaned up properly */ }

    int some_method(int some_param) {...}

    int value_1;
    int value_2;
    float value_3;
    std::vector<some_other_class*> even_more_values;
    /* and so on */
 }

 void some_function()
 {
     std::vector<a_class> a_instances( 10 );

     // Pass a_instances into these functions by reference rather than by using
     // a global. This is re-entrant and more likely to be thread-safe.
     do_stuff( a_instances );
     do_more_stuff( a_instances );

     // a_instances will be cleaned up automatically here. This also allows you some
     // weak exception safety.
 } 
```

请记住，如果`even_more_values`包含*指向*其他对象的指针，则需要在`a_class`. 如果可能，`even_more_values`应该包含对象本身而不是指向这些对象的指针（这样您可能不必为 编写析构函数`a_class`，编译器为您提供的析构函数可能就足够了）。

# c# - 如何在 C# 中将 SID 转换为帐户名

> ID：499053
> 
> 赞同：59
> 
> 时间：2009-01-31T15:56:52.053
> 
> 标签：c#, sid

我有一个扫描目录并收集一些信息的 C# 应用程序。我想显示每个文件的帐户名称。我可以通过获取 FileInfo 对象的 SID 在本地系统上执行此操作，然后执行以下操作：

```
string GetNameFromSID( SecurityIdentifier sid )
{
    NTAccount ntAccount = (NTAccount)sid.Translate( typeof( NTAccount ) );
    return ntAccount.ToString();
} 
```

但是，这不适用于网络上的文件，大概是因为 Translate() 函数仅适用于本地用户帐户。我想也许我可以对 SID 进行 LDAP 查找，所以我尝试了以下方法：

```
string GetNameFromSID( SecurityIdentifier sid )
{
    string str = "LDAP://<SID=" + sid.Value + ">";
    DirectoryEntry dirEntry = new DirectoryEntry( str );
    return dirEntry.Name;
} 
```

这似乎会起作用，因为对“dirEntry.Name”的访问会挂起几秒钟，就好像它正在关闭并查询网络一样，但随后它会引发 System.Runtime.InteropServices.COMException

有谁知道我如何获取任意文件或 SID 的帐户名？我不太了解网络或 LDAP 或任何东西。有一个名为 DirectorySearcher 的类，也许我应该使用它，但它需要一个域名，我也不知道如何获得它——我所拥有的只是我正在扫描的目录的路径。

提前致谢。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-03-11T23:36:59.803

看到这里有一个很好的答案：

[通过 SID 解析显示用户名的最佳方法？](https://stackoverflow.com/questions/380031/the-best-way-to-resolve-display-username-by-sid)

它的要点是这样的：

```
string sid="S-1-5-21-789336058-507921405-854245398-9938";
string account = new System.Security.Principal.SecurityIdentifier(sid).Translate(typeof(System.Security.Principal.NTAccount)).ToString(); 
```

这种方法对我来说适用于活动目录上的非本地 SID。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-01T23:24:28.967

SecurityReference 对象的 Translate 方法确实适用于非本地 SID，但仅适用于域帐户。对于另一台机器本地或非域设置中的帐户，您需要 PInvoke 函数 LookupAccountSid 指定需要执行查找的特定机器名称。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-07-19T23:42:11.490

`System.DirectoryServices.AccountManagement.UserPrincipal`类 ( [msdn link](http://msdn.microsoft.com/en-us/library/bb338505) ) 具有`FindByIdentity`将 SID 转换为 User 对象的静态函数。它应该能够在本地机器或 LDAP/Active Directory 服务器上工作。我只对活动目录使用过它。

这是我在 IIS 中使用的示例：

```
// Set the search context to a specific domain in active directory
var searchContext = new PrincipalContext(ContextType.Domain, "YOURDOMAIN", "OU=SomeOU,DC=YourCompany,DC=com");
// get the currently logged in user from IIS
MembershipUser aspUser = Membership.GetUser();
// get the SID of the user (stored in the SecurityIdentifier class)
var sid = aspUser.ProviderUserKey as System.Security.Principal.SecurityIdentifier;
// get the ActiveDirectory user object using the SID (sid.Value returns the SID in string form)
var adUser = UserPrincipal.FindByIdentity(searchContext, IdentityType.Sid, sid.Value);
// do stuff to user, look up group membership, etc. 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-02-19T07:33:49.967

在 C# 中，通过以下方式获取用户 SID 并将其分配给字符串变量：

```
string strUser = System.Security.Principal.WindowsIdentity.GetCurrent().User.ToString(); 
```

您将需要使用字符串，因为解析为 UserName 的能力支持字符串。换句话说，使用`var varUser`将导致命名空间错误。

```
string strUserName = new System.Security.Principal.SecurityIdentifier(strUser).Translate(typeof(System.Security.Principal.NTAccount)).ToString(); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-12-01T05:34:57.333

您还可以使用这样的代码获取特殊帐户的帐户名称，例如“每个人”，无论用户的语言设置如何，该代码都可以使用：

```
 SecurityIdentifier everyoneSid = new SecurityIdentifier(WellKnownSidType.WorldSid, null);
   string everyone = everyoneSid.Translate(typeof(System.Security.Principal.NTAccount)).ToString(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-01T05:50:43.850

哦，那么 LDAP 调用可能不起作用，因为您可能不在 Active Directory 环境中。如果是这种情况，那么您的每台机器都负责自己的身份存储。而且您的第一个代码示例无法通过网络运行，因为您正在执行代码的机器不知道如何解析仅在远程机器上才有意义的 SID。

你真的应该检查你的机器是否是 Active Directory 的一部分。您会在登录过程中知道这一点。或者您可以通过右键单击“我的电脑”来检查，选择“属性”，“计算机名称”选项卡，然后查看您的计算机是否是域的一部分。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-02T02:15:09.730

伟大的。我从这里抄写了一些 LookupAccountSid() 代码：

[http://www.pinvoke.net/default.aspx/advapi32.LookupAccountSid](http://www.pinvoke.net/default.aspx/advapi32.LookupAccountSid)

虽然我必须自己提供主机名，但这很有效。在 UNC 路径的情况下，我可以只取它的第一个组件。当它是映射驱动器时，我使用此代码将路径转换为 ​​UNC 路径：

[http://www.wiredprairie.us/blog/index.php/archives/22](http://www.wiredprairie.us/blog/index.php/archives/22)

它似乎有效，所以我就是这样做的，除非有人想出 UNC 路径的第一个组件不是主机名的情况......

感谢大家的帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-31T19:08:38.267

这是一个笨蛋。您在 Active Directory 环境中，对吗？只是检查：）

无论如何，而不是与 sid.Value 绑定，

```
string str = "LDAP://<SID=" + sid.Value + ">"; 
```

我会尝试将 SID 的字节数组转换为[八位字节字符串](http://msdn.microsoft.com/en-us/library/ms180873(VS.80).aspx)并与之绑定。

第 78 页有一个很好的例子。[这](http://books.google.com/books?id=kGApqjobEfsC&pg=PA77&lpg=PA77&dq=sid+bind+octet+string&source=web&ots=p4pqWbUOPc&sig=8kkEOVD0_NHzkj00zjM98tjyPno&hl=en&ei=TqCESYyNFZHItQPzi-XODQ&sa=X&oi=book_result&resnum=2&ct=result#PPA78,M1)会让你更接近。老实说，我以前没有尝试过与 SID 绑定。但是我已经成功绑定了用户的 GUID :)

祝你好运，让我知道情况如何。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-17T22:27:25.073

获取当前域：

```
System.DirectoryServices.ActiveDirectory.Domain.GetCurrentDomain(); 
```

从 ldap 和域名获取目录条目：

```
DirectoryEntry de = new DirectoryEntry(string.Format("LDAP://{0}", domain)); 
```

从 ActiveDirectoryMembershipProvider ActiveDirectoryMembershipUser 获取 sid：

```
ActiveDirectoryMembershipUser user = (ActiveDirectoryMembershipUser)Membership.GetUser();
var sid = (SecurityIdentifier)user.ProviderUserKey; 
```

从 SecurityIdentifier 获取用户名：

```
(NTAccount)sid.Translate(typeof(NTAccount)); 
```

使用域目录条目和用户名在活动目录上完成目录搜索：

```
DirectorySearcher search = new DirectorySearcher(entry);
        search.Filter = string.Format("(SAMAccountName={0})", username);
        search.PropertiesToLoad.Add("Name");
        search.PropertiesToLoad.Add("displayName");
        search.PropertiesToLoad.Add("company");
        search.PropertiesToLoad.Add("homePhone");
        search.PropertiesToLoad.Add("mail");
        search.PropertiesToLoad.Add("givenName");
        search.PropertiesToLoad.Add("lastLogon");
        search.PropertiesToLoad.Add("userPrincipalName");
        search.PropertiesToLoad.Add("st");
        search.PropertiesToLoad.Add("sn");
        search.PropertiesToLoad.Add("telephoneNumber");
        search.PropertiesToLoad.Add("postalCode");
        SearchResult result = search.FindOne();
        if (result != null)
        {
            foreach (string key in result.Properties.PropertyNames)
            {
                // Each property contains a collection of its own
                // that may contain multiple values
                foreach (Object propValue in result.Properties[key])
                {
                    outputString += key + " = " + propValue + ".<br/>";
                }
            }
        } 
```

根据活动目录中的数据，您将在输出中得到不同的响应。

[这是一个包含我需要的所有用户属性的站点：](http://www.winzero.ca/Active-Directory-users.htm)

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2009-02-01T10:02:31.333

我很确定您将能够使用此处接受的答案：[Determine the LocalSystem account name using C#](https://stackoverflow.com/questions/204942/determine-the-localsystem-account-name-using-c)

基本上，您可以将 SecurityIdentifier 类的实例转换为 NTAccount 类型，从中可以获取用户名。在代码中：

```
using System.Security.Principal;

SecurityIdentifier sid = new SecurityIdentifier("S-1-5-18");
NTAccount acct = (NTAccount)sid.Translate(typeof(NTAccount));
Console.WriteLine(acct.Value); 
```

# php - 网络服务器上的内网后台数据？

> ID：499062
> 
> 赞同：0
> 
> 时间：2009-01-31T16:01:57.160
> 
> 标签：php, database, security

我正在升级客户的电子商务网上商店，但遇到了一些问题。

该商店是一组定制的 PHP 脚本。在每次销售时，通过商家账户界面从信用卡中扣款，然后将订单通过电子邮件发送到客户的桌面收件箱。然而，随着公司的发展，这变得不可扩展，因为客户花费越来越多的时间手动提交电子邮件订单确认。

我想在 Web 服务器上建立一个数据库，并修改 PHP 商店脚本以将销售额存储到数据库中。然后，客户将使用浏览器登录 SSL 外联网门户，并安全地查看销售情况——从同一网络服务器上的数据库馈送。

但客户说他不希望这样，因为他不希望 Web 服务器上的客户数据——即使没有存储信用卡信息——只是姓名、电子邮件地址和购买的物品等等。他更喜欢将这些数据存储在他办公室的服务器上，该服务器只连接到 Intranet，没有外部访问权限。

当前存储数据的 Intranet 服务器无法从外部访问，因此当然无法从处理销售的 Web 服务器访问。

在 Web 服务器上保存销售数据是常态吗？SaaS公司如何做到这一点？他们在网络服务器上的订阅客户数据是否在数据库中？

如果客户的请求是可行的，那么自动处理销售的标准接受方法是什么，而不仅仅是通过电子邮件发送，而是让这些销售在 Intranet 机器上而不是在 Web 服务器上结束？Intranet 机器是否必须登录到 Web 服务器并从 Web 服务器上的临时表中“获取”销售额？Web 服务器是否会运行自定义服务来服务来自 Intranet 服务器的连接并为其提供最近的销售，然后从 Web 服务器中删除这些销售记录？

基本上，将销售数据从公共 Web 服务器机器移动到 Intranet 机器的标准方法是什么？还是我没有以正确的方式解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T16:39:55.553

很抱歉，您的问题似乎有点缺陷。我也不希望 Web 服务器上的客户数据，但这并不意味着他们必须在 Intranet 上。为什么不将数据库放在只接受来自您的网络服务器和内部网的连接的专用机器上？当然，这两种连接都应该加密。

我想这一切都取决于您的客户想要什么和不想要什么。但是应该很容易让他明白，需要某种方法将客户数据获取到他想要的地方。我当然不会推荐电子邮件作为交通工具。

# php - MySQL 与文件数据库

> ID：499067
> 
> 赞同：3
> 
> 时间：2009-01-31T16:04:47.763
> 
> 标签：php, mysql, json

所以我打算用 PHP 开发一个自制的博客系统，我想知道哪种存储数据的方式最快。我可以朝 MySQL 方向发展，或者我可以采用自己的小方法，将所有信息（以 JSON 编码）存储在文件中。

哪种方式最快，MySQL 或 JSON 文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-31T16:08:52.623

对于小型的单用户“数据库”，文件系统可能会更快——随着规模和复杂性的增长，像 MySQL 或 SQL Server 这样的数据库服务器很难被击败。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T17:45:10.057

我肯定会选择一个数据库选项（因为您需要能够搜索和索引内容）。但这并不意味着您需要一个完全实现的独立数据库服务。

MySQL 绝对是更具可扩展性的解决方案。
但缺点是您需要设置和维护单独的服务。

另一方面，有些数据库是基于文件的，并且仍然可以让您使用标准 SQL (SQLite SQLite.org) 进行访问。您可以获得 SQL 的优势，但不需要维护单独的服务。缺点是它们的可扩展性不高。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T16:10:26.410

我会选择 MySQL 数据库——仅仅是因为它更易于管理。

JSON 并不是一种真正的存储格式，它用于将数据发送到 JavaScript。如果您想将数据存储在文件中，请查看[XML](http://www.php.net/manual/en/function.simplexml-element-construct.php)或[序列化 PHP](http://www.php.net/serialize)（我怀疑这是您所追求的，而不是 JSON）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T16:10:40.840

如果这不能非常直接地回答您的问题，请原谅我，但是由于它是一个自制的博客系统，是否真的值得花时间考虑一下现在哪个存储后端更快？

从第一天起，您就不会看到 10,000 个并发用户，听起来在可预见的将来它不需要扩展到任何有意义的程度。

为什么不把 MySQL 作为一个明智的选择而不是一个快速的选择呢？如果你真的想要一些你为速度而设计的感觉，可以用螺栓代替 sqlite。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-31T16:36:52.020

由于您认为您可能不需要复杂的关系结构，因此这可能是一个有趣的机会来尝试更多中间的东西。

查看[CouchDB](http://couchdb.apache.org/docs/intro.html)，它是一个基于文档的、无模式的数据库（但仍可索引）。数据库由包含命名字段的文档组成（想想键值对）。

玩得开心....

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-31T16:08:57.693

虽然我不确定，但在我看来 MySQL 数据库会快很多，尤其是随着数据量越来越大。

[此外，将 MySQL 与 PHP 一起使用非常容易，尤其是当您使用ezSQL 之](http://www.woyano.com/jv/ezsql)类的抽象类时。ezSQL 使使用数据库变得非常简单，我认为您会通过采用自制 JSON 方向为自己创建更多不必要的工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-31T17:57:24.133

我都做过。我喜欢解决非常简单问题的文件和解决复杂问题的数据库。

对于文件解决方案，随着文件数量的增加，请注意以下问题：

1) 使用的磁盘空间比您预期的要多，因为即使是很小的文件也会占用整个块。在支持大型驱动器的文件系统上，块相当大。

2）当目录中的文件数量变得非常大时，大多数文件系统会变得非常慢。我对此的解决方案（假设文件名在字母表中合理分布）是创建一个由文件名的前两个字母组成的目录。因此，文件“animal.txt”将在 an/animal.txt 中找到。这出奇的好。如果您的文件名在字母表中分布不合理，请使用某种散列函数来创建目录。听起来有点疯狂，但这可以非常非常好地工作，而且我已经将它用于具有数万个文件的非常快速的解决方案。

但文件解决方案真的只适合有时。除非您有充分的理由使用文件，否则请使用数据库。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-06-23T04:43:17.003

这真的很酷。这是一个 PHP 类，通过查询[http://www.fsql.org/index.php控制平面文件数据库](http://www.fsql.org/index.php)

对于博客，我建议缓存页面，因为博客通常只有静态内容。这样，查询在缓存时只运行一次。您可以在添加新博客文章时更新缓存页面。

# apache - 清理 URL 重定向循环

> ID：499068
> 
> 赞同：9
> 
> 时间：2009-01-31T16:06:00.413
> 
> 标签：apache, .htaccess, url-rewriting

我正在尝试在我的网站上创建干净的 URL。现在我成功配置了 apache，所以像*mysite.com/page*这样的每个请求都可以工作。但我也希望对*mysite.com/page.php*的请求将被重定向到*mysite.com/page*。我已经在 .htaccess 中设置了环境变量来检查我是否已经被重定向以防止循环，但我仍然得到它们......这是.htaccess：

```
<IfModule mod_rewrite.c>
Options +FollowSymlinks

RewriteEngine On
RewriteBase /

# set the variable
RewriteRule ^$ - [L]
RewriteRule ^(.*)$ $1 [E=REWROTE:0]

# this works fine
# make mysite.com/page work and set REWROTE variable to 1
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.*)$ $1.php [L,E=REWROTE:1]

# but if i enable this, i get redirected and then stuck in a loop
# redirect mysite.com/page.php to mysite.com/page , but only if REWROTE not 1
#RewriteCond %{ENV:REWROTE} !^1$
#RewriteRule ^(.*)\.php$ $1 [R=301,L] 
```

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-31T16:18:26.067

如果请求已经被重定向一次（[参考](http://www.askapache.com/htaccess/mod_rewrite-tips-and-tricks.html#fix-infinite-loop-redirects)），则在现有的重写规则上方添加此规则以停止重定向：

```
RewriteCond %{ENV:REDIRECT_STATUS} 200
RewriteRule .* - [L] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-31T16:26:28.187

您可以检查请求行中最初请求的内容：

```
RewriteCond %{THE_REQUEST} ^[A-Z]+\ (/[^\ ]*)\.php[?\ ]
RewriteRule \.php$ %1 [R=301,L] 
```

哦，[`RewriteCond`指令](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewritecond)的第一个参数不是正则表达式，而只是一个字符串。所以逃避`.`是错误的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-28T21:51:30.540

为什么不能使用字符串结尾终止字符 $ 有什么原因吗？

```
RewriteRule ^/(.+)\.php$ /$1 
```

将 /page.php 重定向到 /page 但不会在 /page 上进行任何重定向。

从根本上说，使用设置环境变量和添加对 REDIRECT_STATUS 的检查等技术不会非常健壮。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-02T02:17:55.497

我发现在这些情况下防止循环的另一种快速而肮脏的方法是添加一个查询字符串，然后检查它在重定向中是否存在。

```
RewriteCond %{QUERY_STRING} !a=a
RewriteRule ^(.*)\.php$ %1 [NC,R=301,L]
RewriteRule ^(.*)$ $1.php?a=a [NC,L] 
```

在这个网站上找到：http: [//answers.oreilly.com/topic/542-how-to-properly-redirect-for-maximum-seo/](http://answers.oreilly.com/topic/542-how-to-properly-redirect-for-maximum-seo/)

# java - Java NIO：快速发送大消息会导致数据包被截断和数据丢失

> ID：499070
> 
> 赞同：3
> 
> 时间：2009-01-31T16:07:42.733
> 
> 标签：java, networking, network-programming, nio

我遇到了这个令人讨厌的问题，即从 Java (NIO) 服务器（运行 Linux）快速连续地向客户端发送多条大消息会导致数据包被截断。消息必须很大并且发送速度非常快，问题才会发生。这基本上是我的代码在做什么（不是实际的代码，而是或多或少发生了什么）：

```
//-- setup stuff: --
Charset charset = Charset.forName("UTF-8");
CharsetEncoder encoder = charset.newEncoder();
String msg = "A very long message (let's say 20KB)...";

//-- inside loop to handle incoming connections: --
ServerSocketChannel ssc = (ServerSocketChannel)key.channel();
SocketChannel sc = ssc.accept();
sc.configureBlocking(false);
sc.socket().setTcpNoDelay(true);
sc.socket().setSendBufferSize(1024*1024);

//-- later, actual sending of messages: --
for (int n=0; n<20; n++){
  ByteBuffer bb = encoder.encode(CharBuffer.wrap(msg+'\0'));
  sc.write(bb);
  bb.rewind();
} 
```

因此，如果数据包足够长并且尽可能快地发送（即在这样的循环中没有延迟），那么在另一端它通常会出现这样的情况：

```
[COMPLETE PACKET 1]
[COMPLETE PACKET 2]
[COMPLETE PACKET 3]
[START OF PACKET 4][SOME OR ALL OF PACKET 5] 
```

存在数据丢失，数据包开始一起运行，因此数据包 5 的开头（在此示例中）与数据包 4 的开头到达相同的消息。它不仅仅是截断，而是一起运行消息。

我想这与 TCP 缓冲区或“窗口大小”有关，或者这里的服务器只是提供比操作系统或网络适配器或其他东西更快的数据可以处理它。但是我该如何检查并防止它发生呢？如果我减少每次使用 sc.write() 的消息长度，然后增加重复次数，我仍然会遇到同样的问题。这似乎只是短时间内数据量的问题。我也没有看到 sc.write() 抛出任何异常（我知道在上面的示例中我没有检查，但在我的测试中有）。

如果我能以编程方式检查它是否还没有准备好接收更多数据，我会很高兴，并延迟，等待它准备好。我也不确定是否“sc.socket().setSendBufferSize(1024*1024);” 有任何影响，或者如果我需要在 Linux 方面进行调整。有没有办法真正“冲洗”出 SocketChannel？作为一种蹩脚的解决方法，例如，我可以尝试在任何时候尝试发送超过 10KB 的消息时显式强制发送缓冲的任何内容（这在我的应用程序中并不常见）。但我不知道有什么方法可以强制发送缓冲区（或等到它发送）。谢谢你的帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-31T17:47:38.803

sc.write() 不发送部分或全部数据的原因有很多。您必须检查返回值和/或缓冲区中剩余的字节数。

```
for (int n=0; n<20; n++){
  ByteBuffer bb = encoder.encode(CharBuffer.wrap(msg+'\0'));
  if(sc.write(bb) > 0 && bb.remaining() == 0) {
    // all data sent
  } else {
    // could not send all data.
  }
  bb.rewind();
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-31T16:30:13.937

您没有检查以下的返回值：

```
sc.write(bb); 
```

这将返回写入的字节数，这可能小于缓冲区中可用的数据。由于 nio 的工作方式，您可能只需要在您的字节缓冲区上调用 remaining() 来查看是否还有剩余。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-31T16:28:24.190

我没有做过任何 NIO 编程，但根据 Javadocs，如果 SocketChannel 处于非阻塞模式（如你的那样）并且套接字的输出缓冲区已满，sc.write() 将不会写入整个 ByteBuffer。

因为你写得太快了，很可能你的连接被淹没了，你的网络或接收器无法跟上。

> > 如果我能以编程方式检查它是否还没有准备好接收更多数据，我会很高兴

您需要检查 sc.write() 的返回值以了解您的输出缓冲区是否已满。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T18:15:30.947

不要假设您可以控制哪些数据最终在哪个数据包中。

更多信息：[监视套接字以获取新数据然后处理该数据的最佳方法是什么？](https://stackoverflow.com/questions/453609/whats-the-best-way-to-monitor-a-socket-for-new-data-and-then-process-that-data/453951#453951)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-25T13:01:18.013

您正在使用非阻塞模式： sc.configureBlocking( **false** );

将阻塞设置为**true**，您的代码应该可以正常工作。此处其他人提出的检查发送计数和循环的建议也将起作用。

# flash - 将光标悬停在文本字段上

> ID：499071
> 
> 赞同：3
> 
> 时间：2009-01-31T16:07:59.753
> 
> 标签：flash, actionscript-3

我知道 MovieClip 上的 buttonMode 属性（让手形光标悬停），我希望对 TextField 做同样的事情，但它似乎没有实现这个属性。有谁知道是否有类似的东西，或者，如果没有，另一种控制文本字段光标的方法？

* * *

@James：我正在扩展 MovieClip 类，然后在代码中从类（包括文本字段）内部创建对象，这使事情变得有点复杂（如果只是在我脆弱的大脑中）。奇怪的是，我在 MC 上设置了 buttonMode = true，它适用于除 TextField 之外的所有内容，当它恢复到插入符号（或者如果我在 TextField 上设置 Selectable = false 时只是指针）。

@ForYourOwnGood：关于可用性的观点，但我希望文本字段成为更大对象的无缝部分，如果没有手形光标，它就感觉不对。您提供的内容听起来正是我所需要的，但它看起来像是 Flex 特定的？尽管浏览了 LiveDocs，但我在 Flash（特别是 CS4）中找不到等价物。我是不是很昏暗？:S

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-31T18:17:18.697

尝试添加

mouseChildren = 假；（在扩展 MovieClip 的类中）

它应该阻止文本字段启用鼠标。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-31T16:39:01.627

或者，您可以将文本字段放在影片剪辑中，然后将 buttonmode 设置为 true。这基本上就是按钮组件中内置的工作方式，并且是解决此特定问题的可接受解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-31T16:35:10.900

不能像使用 MovieClip 一样使用 TextField 设置手形光标。如果您考虑一下，这是有道理的，Textfield 上的手形光标对用户不友好，用户希望将文本输入到 TextField 中，而不是像按钮一样单击它。但是，您可以使用一种解决方法。

为 TextField 提供鼠标悬停事件的事件侦听器，然后在事件处理程序中通过 CursorManager 设置光标。

应该看起来像...

```
myTextField.addEventLstener(MouseEvent.MOUSE_OVER, onMouseOver);

private function onMouseOver( event : MouseEvent ) : void{
   CursorManager.setCursor(cursorClass, priority, xOffset, yOffset);
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-01-11T01:39:45.353

没有`_sprite.buttonMode = true`操纵，你必须写：

`_textField.htmlText = "<a href='event:null'>"+yourText+"</a>";`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-06-21T20:23:53.930

以上任何一项都不是必需的，请尝试将 TextField 的 mouseEnabled 属性设置为 false，如下所示：

```
textField.mouseEnabled = false; 
```

这将禁用 TextField 上的任何鼠标交互，从而阻止 flash 观察选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T02:13:51.020

我会非常原始地在按钮的文本字段/标签顶部放置一个 alpha=0 电影剪辑，这也将手形光标带回来

# python - 最小的、独立的、可分发的、跨平台的 Web 服务器

> ID：499084
> 
> 赞同：8
> 
> 时间：2009-01-31T16:15:33.093
> 
> 标签：python, http, wsgi

我最近一直在编写相当多的小型 wsgi 应用程序，并且正在寻找一个可以分发、预配置以运行特定应用程序的 Web 服务器。我知道有诸如 twisted 和 cherrypy 之类的东西可以提供 wsgi 应用程序，但它们似乎缺少我的一个关键功能，那就是使用 http 范围标头“伪流”大文件的能力。是否有基于 BSD 或类似许可的 Web 服务器可用，它可以作为独立可执行文件分发在任何主要平台上，它能够代理到 wsgi 服务器（如cherrypy 等）并使用 http 提供大文件范围标题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T00:01:34.307

Lighttpd 具有 BSD 许可证，因此您应该可以根据需要捆绑它。

你说它适用于小型应用程序，所以我想这意味着小型、本地、单用户 Web 界面由小型 http 服务器提供服务？如果是这样，那么任何 python 实现都应该工作。只需使用 py2exe 之类的东西来打包它（事实上，不久前这里有一个关于打包 python 程序的问题）。

更新，重新：范围标头：默认的 python http 服务器可能不支持您想要的范围标头，但是编写自己的处理程序或小型 wsgi 应用程序来执行逻辑非常容易，特别是如果您所做的只是流式传输一份文件。不会有太多行：

```
def stream_file(environ, start_response):
  fp = open(base_dir + environ["PATH_INFO"])
  fp.seek(environ["HTTP_CONTENT_RANGE"]) # just an example
  start_response("200 OK", (('Content-Type', "file/type")))
  return fp 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-31T17:42:49.267

Apache + mod_wsgi 有什么问题？Apache 已经是多平台的；它通常已经安装（Windows 除外）。

您可能还想查看 lighttpd，有一些关于将其配置为与 WSGI 一起使用的博客。见[http://cleverdevil.org/computing/24/python-fastcgi-wsgi-and-lighttpd](http://cleverdevil.org/computing/24/python-fastcgi-wsgi-and-lighttpd)和[http://redmine.lighttpd.net/issues/show/1523](http://redmine.lighttpd.net/issues/show/1523)

# javascript - 如何在 jQuery“活动”中保持通过 ajax 调用添加的事件元素

> ID：499085
> 
> 赞同：2
> 
> 时间：2009-01-31T16:16:43.963
> 
> 标签：javascript, jquery, javascript-events, event-handling

我通过 ajax (post) 请求将内容放在我的页面上，如下所示：

```
$("input#ViewMore").click(function() {
            var data = { before: oldestDate, threadId: 1 };
            $.post("/Message/More", data,function(html) {
                $('tbody#posts').prepend(html);
                return false;
            },
            "html");
            return false;
        }); 
```

随着html回来看起来像：

消息输出报价

这一切都很好，花花公子，一切看起来都应该，没有问题。

当我将一个事件挂接到通过 ajax 调用添加的“引用”锚点时，就会出现问题。具体来说，该锚点上的 jQuery 事件不会触发。为什么？

例如：

```
$("#quote).click(function() { ... }); 
```

什么也没做。就像上面没有事件一样。我知道它正在处理页面上未通过 ajax 请求添加的其他锚点，因此那里没有代码错误，另外，如果我刷新页面，它将正确触发。发生这种情况是否有某种原因，我是否需要以某种方式重新初始化锚标记上的该事件？有任何想法吗？

使用 jQuery 1.3.1（也不适用于 1.2.6）所以我相信这是我的实现而不是代码本身。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-31T16:23:02.063

您可以使用jQuery 1.3 的[Events/live](http://docs.jquery.com/Events/live)，*live*会将处理程序绑定到所有当前和未来匹配元素的事件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T16:21:02.440

当使用 Ajax 将新内容添加到页面时，您必须将所有事件重新注册到这些新元素。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T16:36:30.303

变成

```
$('#quote').live("click", function() { ... } 
```

和

```
$("input#ViewMore").live("click", function() { ... } 
```

似乎不起作用

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T16:47:10.830

CMS 的回答有所帮助，但结果如下：

查看更多按钮事件与在添加它的 AJAH 请求之外保持相同：

```
$("input#ViewMore").click( function() { ... } 
```

有事件被添加进出 AJAH 请求的元素需要使用 live 方法：

```
$('#quote').live("click", function() { ... } 
```

奇迹般有效！

# jdbc - Jython zxJDBC cursor.tables() 总是返回 None

> ID：499092
> 
> 赞同：2
> 
> 时间：2009-01-31T16:20:40.587
> 
> 标签：jdbc, jython

我正在使用 Jython 2.2.1 和 MySQL Connector/J 5.1 来访问 MySQL 数据库。我想使用 zxJDBC 的 cursor.tables() 方法来检索该数据库中的表列表。但是，此方法始终返回*None*。

根据 zxJDBC 文档，cursor.tables() 与 Java 的 DatabaseMetaData.getTables() 相同。当我从 Jython 调用这个 Java 方法时，它按预期工作，但使用 zxJDBC 包对我不起作用。这是我尝试过的：

```
import java.sql.*;

public class TableTest {
    public static void tables(String url) {
        try {
            Class.forName("com.mysql.jdbc.Driver");
            Connection conn = DriverManager.getConnection(url, "root", null);
            DatabaseMetaData meta = conn.getMetaData();
            ResultSet rs = meta.getTables(null, null, "%",
                                          new String[] {"TABLE"});
            while (rs.next()) {
                System.out.println(rs.getString("TABLE_NAME"));
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
} 
```

当我从 Jython 调用它时，一切都很好。

```
from com.ziclix.python.sql import zxJDBC
import TableTest

url = 'jdbc:mysql://localhost/jythontest'

print 'Java:'
TableTest.tables(url);

print 'Python:'
conn = zxJDBC.connect(url, 'root', None, 'com.mysql.jdbc.Driver')
cursor = conn.cursor()
print cursor.tables(None, None, '%', ('TABLE',)) 
```

我的测试数据库中有两个表名为“table_a”和“table_b”。输出是：

```
Java:
table_a
table_b
Python:
None 
```

我已经在 Linux 和 MacOS 上尝试过，结果相同。在我试图弄清楚 zxJDBC 有什么问题之前，我想知道我使用这个包的方式是否有任何问题。

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T10:28:59.967

在 cursor.tables() 之后尝试打印**cursor.fetchall( )**

```
from com.ziclix.python.sql import zxJDBC
import TableTest

url = 'jdbc:mysql://localhost/jythontest'

print 'Java:'
TableTest.tables(url);

print 'Python:'
conn = zxJDBC.connect(url, 'root', None, 'com.mysql.jdbc.Driver')
cursor = conn.cursor()
print cursor.tables(None, None, '%', ('TABLE',))
print cursor.fetchall() 
```

*（使用 Informix 和 jython 2.5 beta 测试）*

我假设：

*   cursor.tables() 在 python 中执行查询
*   cursor.fetchall() 返回结果

# winapi - 获取“应用程序数据”目录路径的最佳方式？

> ID：499095
> 
> 赞同：12
> 
> 时间：2009-01-31T16:21:31.457
> 
> 标签：winapi, path

有几种可能的方法可以获取应用程序数据目录的路径：

*   使用`%APPDATA%`环境变量
*   打电话`SHGetFolderPath`给`CSIDL_APPDATA`

从程序中获取路径的最佳方法是什么？使用环境变量时有什么问题吗？

在 XP、Vista 和即将推出的版本中，哪种方法最安全？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-31T16:44:47.917

我建议调用`SHGetFolderPath()`是最合适且可移植的方法；替代方案，例如读取环境变量，或者（更糟糕的）尝试从注册表中提取它，将来可能会让您绊倒。

[Raymond Chen 有一篇文章](http://blogs.msdn.com/oldnewthing/archive/2003/11/03/55532.aspx)解释了为什么从注册表中提取此类路径是一个坏主意。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-02-03T23:09:11.773

```
 string appDataPath = 
Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData); 
```

您需要使用 GetFolderPath 方法获取实际路径，因为 Environment.SpecialFolder.ApplicationData 只是一个枚举。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-10T16:05:00.940

如果你在 .NET 中编程，你可以使用这个：

```
string appDataPath = Environment.SpecialFolder.ApplicationData; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-02T10:52:03.123

Python 的一个重要区别：在 unicode 文件路径的情况下，`ctypes.windll.shell32.SHGetFolderPathW`返回一个 unicode 字符串，而`os.environ['APPDATA']`返回一个字节字符串。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-27T17:47:07.953

如果有人想知道，在 Ruby 中，命令如下所示：

```
appDataPath = ENV['APPDATA'] 
```

# bash - 如何在 Bash 中 ping 多个子站点 ~/[0, 3].html？

> ID：499096
> 
> 赞同：0
> 
> 时间：2009-01-31T16:21:56.637
> 
> 标签：bash

代码：

```
for i in {0..3}; do ping http://www.pythonchallenge.com/pc/def/$i.html; done 
```

应在 www.pythonchallenge.com/pc/def/0.html 找到主机。

对于所有 ping，我都会收到此错误：

> ping：无法解析 www.pythonchallenge.com/pc/def/0.html：未知主机

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-31T16:25:19.297

html页面！=主机。如果要检查这三个网页是否真的存在，请使用 wget。如果您只想检查主机是否已启动，请 ping www.pythonchallenge.com。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T16:26:08.983

你不能 ping 一个地址，你只能 ping 域又名 www.pythonchallenge.com

如果您试图找到实际包含内容的页面，您将需要使用 wget 之类的东西并将其与 grep 结合来检查内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-31T16:28:16.250

您在这里混淆了协议。HTTP 与 ICMP ping 无关。

也就是说，您可以 ping www.pythonchallenge.com，因为它解析为 IP。另一方面，www.pythonchallenge.com/pc/def/0.html 没有 DNS 解析，因为这是一个 URL，而不是主机。浏览器首先通过 DNS 解析 www.pythonchallenge.com，然后对页面本身发出 HTTP 请求。

我不确定您要在这里完成什么。您可能只想简单地 ping www.pythonchallenge.com。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T16:40:11.920

我认为你以错误的方式解决这个问题。你试过[http://www.pythonchallenge.com/pc/def/1.html](http://www.pythonchallenge.com/pc/def/1.html)吗？你试过用谷歌搜索那个号码吗？

（当然，假设您的 URL 不仅仅是一个示例。）

# c++ - 什么是模板 意思是？

> ID：499106
> 
> 赞同：130
> 
> 时间：2009-01-31T16:27:26.720
> 
> 标签：c++, templates

在声明模板时，我习惯使用这种代码：

```
template <class T> 
```

但[在这个问题](https://stackoverflow.com/questions/498757/factory-method-returning-an-concrete-instantiation-of-a-c-template-class)中，他们使用了：

```
template <unsigned int N> 
```

我检查了它是否可以编译。但是这是什么意思？它是非类型参数吗？如果是这样，我们如何才能拥有没有任何类型参数的模板？

* * *

## 回答 #1

> 赞同：163
> 
> 时间：2009-01-31T16:49:07.113

是的，它是一个非类型参数。您可以有几种模板参数

*   类型参数。
    *   类型
    *   模板（只有类和别名模板，没有函数或变量模板）
*   非类型参数
    *   指针
    *   参考
    *   整型常量表达式

你所拥有的是最后一种。它是一个编译时常量（所谓的常量表达式），并且是整数或枚举类型。在标准中查找后，我不得不将类模板上移到类型部分——即使模板不是类型。但是为了描述这些类型，它们被称为类型参数。您可以拥有指针（以及成员指针）和对具有外部链接的对象/函数的引用（可以从其他目标文件链接到并且其地址在整个程序中是唯一的）。例子：

模板类型参数：

```
template<typename T>
struct Container {
    T t;
};

// pass type "long" as argument.
Container<long> test; 
```

模板整数参数：

```
template<unsigned int S>
struct Vector {
    unsigned char bytes[S];
};

// pass 3 as argument.
Vector<3> test; 
```

模板指针参数（将指针传递给函数）

```
template<void (*F)()>
struct FunctionWrapper {
    static void call_it() { F(); }
};

// pass address of function do_it as argument.
void do_it() { }
FunctionWrapper<&do_it> test; 
```

模板引用参数（传递整数）

```
template<int &A>
struct SillyExample {
    static void do_it() { A = 10; }
};

// pass flag as argument
int flag;
SillyExample<flag> test; 
```

模板模板参数。

```
template<template<typename T> class AllocatePolicy>
struct Pool {
    void allocate(size_t n) {
        int *p = AllocatePolicy<int>::allocate(n);
    }
};

// pass the template "allocator" as argument. 
template<typename T>
struct allocator { static T * allocate(size_t n) { return 0; } };
Pool<allocator> test; 
```

没有任何参数的模板是不可能的。但是没有任何显式参数的模板是可能的 - 它具有默认参数：

```
template<unsigned int SIZE = 3>
struct Vector {
    unsigned char buffer[SIZE];
};

Vector<> test; 
```

在语法`template<>`上，保留用于标记显式模板特化，而不是没有参数的模板：

```
template<>
struct Vector<3> {
    // alternative definition for SIZE == 3
}; 
```

* * *

## 回答 #2

> 赞同：158
> 
> 时间：2009-01-31T16:37:59.350

完全可以在整数而不是类型上模板类。我们可以将模板化的值分配给变量，或者以我们可能使用任何其他整数文字的方式对其进行操作：

```
unsigned int x = N; 
```

事实上，我们可以创建在编译时评估的算法（来自[Wikipedia](http://en.wikipedia.org/wiki/Template_metaprogramming)）：

```
template <int N>
struct Factorial 
{
     enum { value = N * Factorial<N - 1>::value };
};

template <>
struct Factorial<0> 
{
    enum { value = 1 };
};

// Factorial<4>::value == 24
// Factorial<0>::value == 1
void foo()
{
    int x = Factorial<4>::value; // == 24
    int y = Factorial<0>::value; // == 1
} 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-01-31T16:40:00.063

您基于“无符号整数”模板化您的课程。

例子：

```
template <unsigned int N>
class MyArray
{
    public:
    private:
        double    data[N]; // Use N as the size of the array
};

int main()
{
    MyArray<2>     a1;
    MyArray<2>     a2;

    MyArray<4>     b1;

    a1 = a2;  // OK The arrays are the same size.
    a1 = b1;  // FAIL because the size of the array is part of the
              //      template and thus the type, a1 and b1 are different types.
              //      Thus this is a COMPILE time failure.
 } 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-07-15T23:10:28.600

模板类就像一个宏，只是少了很多邪恶。

将模板视为宏。当您使用模板定义类（或函数）时，模板的参数将被替换为类（或函数）定义。

不同之处在于参数具有“类型”，并且在编译期间会检查传递的值，就像函数的参数一样。有效的类型是您的常规 C++ 类型，例如 int 和 char。当您实例化一个模板类时，您传递一个您指定类型的值，并且在模板类定义的新副本中，该值将被替换为原始定义中的参数名称。就像一个宏。

您还可以使用“ `class`”或“ `typename`”类型的参数（它们实际上是相同的）。使用其中一种类型的参数，您可以传递类型名称而不是值。就像以前一样，参数名称在模板类定义中的任何地方，只要你创建一个新实例，就会变成你传递的任何类型。这是模板类最常见的用途；每个了解 C++ 模板的人都知道如何做到这一点。

考虑这个模板类示例代码：

```
#include <cstdio>
template <int I>
class foo
{
  void print()
  {
    printf("%i", I);
  }
};

int main()
{
  foo<26> f;
  f.print();
  return 0;
}
```

它在功能上与此宏使用代码相同：

```
#include <cstdio>
#define MAKE_A_FOO(I) class foo_##I \
{ \
  void print() \
  { \
    printf("%i", I); \
  } \
};

MAKE_A_FOO(26)

int main()
{
  foo_26 f;
  f.print();
  return 0;
}
```

当然，模板版本更安全、更灵活十亿倍。

# bash - pcmanfm 争论；重击

> ID：499119
> 
> 赞同：1
> 
> 时间：2009-01-31T16:36:06.763
> 
> 标签：bash, pcmanfm

我使用 ubuntu、fluxbox、pcmanfm 作为文件管理器，xmms2 作为音乐播放器。
我的目标：使用 pcmanfm 轻松将歌曲添加到 xmms2 播放列表。

我有这个适用于单个文件的脚本：

```
路径= $1
如果 [ -d "$path" ]; 然后 #if 目录
    xmms2 radd "$path"
别的
    如果 [ -e "$path" ]; 然后 #if 不是目录，而是文件
        xmms2 添加“$路径”
    菲
菲

```

我还希望能够添加文件组，
我的意思是选择所有文件，然后*右击 -> 打开方式 -> xmms2_add_script*

我认为循环中的相同代码应该可以工作（如果 pcmanfm 只传递一个以上的参数）：

```
args=("$@")
$args 中的路径；做
    如果 [ -d "$path" ]; 然后
        xmms2 radd "$path"
    别的
        如果 [ -e "$path" ]; 然后
            xmms2 添加“$路径”
        菲
    菲
完毕

```

但它不起作用。
（我知道通过带有空格的文件名循环运行存在一些问题**，**所以只尝试了非空格文件。）

我尝试记录输出添加这个

```
回显日期 >> /home/me/output.txt
echo xmms2 radd "$path" >> /home/me/output.txt

```

在**if**语句中。当我尝试添加文件组时，似乎只调用了一次程序。

也许有人知道 pcmanfm 如何使用某些程序打开多个文件？
（我猜其他程序也是这样做的）
或者也许有人知道我怎样才能用 bash 脚本实现我的目标？

以防万一：将项目添加到 xmms2 播放列表`"xmms2 radd directory_name"`，或者`"xmms2 add file_name"`
*我对 bash 只有基本的了解，所以如果有经验的 bash 程序员没有答案，那就太好了:)*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T16:54:08.147

将您的 for 循环更改为：

```
for path in "${args[@]}"; do 
```

for 循环遍历它的参数，你的 args 变量是一个数组，但是当你执行 $args 时，bash 只看到第一个元素。

[Greg 的 Bash 常见问题解答/Wiki：如何使用数组变量？](http://wooledge.org:8000/BashFAQ/005)

这实际上是我将如何编写它以使其更具可读性：

```
for x in "$@"; do
    [[ -d $x ]] && xmms2 radd "$x"
    [[ -f $x ]] && xmms2 add  "$x"
done 
```

# javascript - jQuery在文本区域中设置光标位置

> ID：499126
> 
> 赞同：447
> 
> 时间：2009-01-31T16:39:11.547
> 
> 标签：javascript, jquery, html, textfield

如何使用 jQuery 在文本字段中设置光标位置？我有一个包含内容的文本字段，我希望用户光标在他们关注该字段时定位在某个偏移量处。代码应该看起来像这样：

```
$('#input').focus(function() {
  $(this).setCursorPosition(4);
}); 
```

该 setCursorPosition 函数的实现是什么样的？如果您有一个内容为 abcdefg 的文本字段，则此调用将导致光标定位如下：abcd**|**efg。

Java 有一个类似的函数，setCaretPosition。javascript是否存在类似的方法？

**更新：我修改了 CMS 的代码以使用 jQuery，如下所示：**

```
new function($) {
  $.fn.setCursorPosition = function(pos) {
    if (this.setSelectionRange) {
      this.setSelectionRange(pos, pos);
    } else if (this.createTextRange) {
      var range = this.createTextRange();
      range.collapse(true);
      if(pos < 0) {
        pos = $(this).val().length + pos;
      }
      range.moveEnd('character', pos);
      range.moveStart('character', pos);
      range.select();
    }
  }
}(jQuery); 
```

* * *

## 回答 #1

> 赞同：302
> 
> 时间：2009-05-08T18:17:32.917

这是一个jQuery解决方案：

```
$.fn.selectRange = function(start, end) {
    if(end === undefined) {
        end = start;
    }
    return this.each(function() {
        if('selectionStart' in this) {
            this.selectionStart = start;
            this.selectionEnd = end;
        } else if(this.setSelectionRange) {
            this.setSelectionRange(start, end);
        } else if(this.createTextRange) {
            var range = this.createTextRange();
            range.collapse(true);
            range.moveEnd('character', end);
            range.moveStart('character', start);
            range.select();
        }
    });
}; 
```

有了这个，你可以做

```
$('#elem').selectRange(3,5); // select a range of text
$('#elem').selectRange(3); // set cursor position 
```

*   [提琴手](http://jsfiddle.net/mnpenner/WpqsN/2291/)
*   [杰宾](https://jsbin.com/vayoso/1/edit?html,js,output)

* * *

## 回答 #2

> 赞同：263
> 
> 时间：2009-01-31T16:56:36.723

我有两个功能：

```
function setSelectionRange(input, selectionStart, selectionEnd) {
  if (input.setSelectionRange) {
    input.focus();
    input.setSelectionRange(selectionStart, selectionEnd);
  }
  else if (input.createTextRange) {
    var range = input.createTextRange();
    range.collapse(true);
    range.moveEnd('character', selectionEnd);
    range.moveStart('character', selectionStart);
    range.select();
  }
}

function setCaretToPos (input, pos) {
  setSelectionRange(input, pos, pos);
} 
```

然后你可以像这样使用 setCaretToPos ：

```
setCaretToPos(document.getElementById("YOURINPUT"), 4); 
```

`textarea`带有 a和 an 的实时示例`input`，展示了 jQuery 的用法：

```
function setSelectionRange(input, selectionStart, selectionEnd) {
  if (input.setSelectionRange) {
    input.focus();
    input.setSelectionRange(selectionStart, selectionEnd);
  } else if (input.createTextRange) {
    var range = input.createTextRange();
    range.collapse(true);
    range.moveEnd('character', selectionEnd);
    range.moveStart('character', selectionStart);
    range.select();
  }
}

function setCaretToPos(input, pos) {
  setSelectionRange(input, pos, pos);
}

$("#set-textarea").click(function() {
  setCaretToPos($("#the-textarea")[0], 10)
});
$("#set-input").click(function() {
  setCaretToPos($("#the-input")[0], 10);
});
```

```
<textarea id="the-textarea" cols="40" rows="4">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</textarea>
<br><input type="button" id="set-textarea" value="Set in textarea">
<br><input id="the-input" type="text" size="40" value="Lorem ipsum dolor sit amet, consectetur adipiscing elit">
<br><input type="button" id="set-input" value="Set in input">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
```

截至 2016 年，已在 Chrome、Firefox、IE11 甚至 IE8 上进行了测试和工作（请参阅[此处](http://jsbin.com/sujoxosepo)的最后一条；Stack Snippets 不支持 IE8）。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2010-09-06T11:55:41.480

除了 jQuery 扩展代码之外，这里的解决方案都是正确的。

扩展函数应该遍历每个选定的元素并返回`this`支持链。这是~~正确~~ *的*版本：

```
$.fn.setCursorPosition = function(pos) {
  this.each(function(index, elem) {
    if (elem.setSelectionRange) {
      elem.setSelectionRange(pos, pos);
    } else if (elem.createTextRange) {
      var range = elem.createTextRange();
      range.collapse(true);
      range.moveEnd('character', pos);
      range.moveStart('character', pos);
      range.select();
    }
  });
  return this;
}; 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2011-08-24T19:02:59.703

我找到了一个适合我的解决方案：

```
$.fn.setCursorPosition = function(position){
    if(this.length == 0) return this;
    return $(this).setSelection(position, position);
}

$.fn.setSelection = function(selectionStart, selectionEnd) {
    if(this.length == 0) return this;
    var input = this[0];

    if (input.createTextRange) {
        var range = input.createTextRange();
        range.collapse(true);
        range.moveEnd('character', selectionEnd);
        range.moveStart('character', selectionStart);
        range.select();
    } else if (input.setSelectionRange) {
        input.focus();
        input.setSelectionRange(selectionStart, selectionEnd);
    }

    return this;
}

$.fn.focusEnd = function(){
    this.setCursorPosition(this.val().length);
            return this;
} 
```

现在您可以通过调用将焦点移动到任何元素的末尾：

```
$(element).focusEnd(); 
```

或者你指定位置。

```
$(element).setCursorPosition(3); // This will focus on the third character. 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2010-08-26T15:51:17.987

这在 Mac OSX 上的 Safari 5 上对我有用，jQuery 1.4：

```
$("Selector")[elementIx].selectionStart = desiredStartPos; 
$("Selector")[elementIx].selectionEnd = desiredEndPos; 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2015-12-03T20:44:04.920

我确实意识到这是一篇非常古老的帖子，但我认为我应该提供一个更简单的解决方案来仅使用 jQuery 来更新它。

```
function getTextCursorPosition(ele) {   
    return ele.prop("selectionStart");
}

function setTextCursorPosition(ele,pos) {
    ele.prop("selectionStart", pos + 1);
    ele.prop("selectionEnd", pos + 1);
}

function insertNewLine(text,cursorPos) {
    var firstSlice = text.slice(0,cursorPos);
    var secondSlice = text.slice(cursorPos);

    var new_text = [firstSlice,"\n",secondSlice].join('');

    return new_text;
} 
```

使用 ctrl-enter 添加新行的用法（如在 Facebook 中）：

```
$('textarea').on('keypress',function(e){
    if (e.keyCode == 13 && !e.ctrlKey) {
        e.preventDefault();
        //do something special here with just pressing Enter
    }else if (e.ctrlKey){
        //If the ctrl key was pressed with the Enter key,
        //then enter a new line break into the text
        var cursorPos = getTextCursorPosition($(this));                

        $(this).val(insertNewLine($(this).val(), cursorPos));
        setTextCursorPosition($(this), cursorPos);
    }
}); 
```

我愿意接受批评。谢谢你。

更新：此解决方案不允许正常的复制和粘贴功能工作（即 ctrl-c、ctrl-v），因此我将来必须对其进行编辑以确保该部分再次工作。如果您知道如何做到这一点，请在此处发表评论，我很乐意对其进行测试。谢谢。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-05-14T13:12:48.197

在 IE 中将光标移动到某个位置，这段代码就足够了：

```
var range = elt.createTextRange();
range.move('character', pos);
range.select(); 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-01-18T20:20:29.740

我正在使用这个： http: [//plugins.jquery.com/project/jCaret](http://plugins.jquery.com/project/jCaret)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2013-01-01T09:38:49.293

在将文本插入文本区域之前设置焦点？

```
$("#comments").focus();
$("#comments").val(comments); 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2015-06-27T23:16:04.507

这在 chrome 中对我有用

```
$('#input').focus(function() {
    setTimeout( function() {
        document.getElementById('input').selectionStart = 4;
        document.getElementById('input').selectionEnd = 4;
    }, 1);
}); 
```

显然您需要一微秒或更长的延迟，因为通常用户通过单击您想要覆盖的文本字段中的某个位置（或通过点击选项卡）来关注文本字段，因此您必须等到该位置由用户单击设置，然后更改它。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-03-08T01:41:34.770

如果您使用箭头键，请记住在函数调用后立即返回 false ，否则 Chrome 会搞砸。

```
{
    document.getElementById('moveto3').setSelectionRange(3,3);
    return false;
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-02-02T17:08:00.740

基于this [question](https://stackoverflow.com/questions/8928660/setselectionrange-not-behaving-the-same-way-across-browsers)，当textarea中有新行时，对于ie和opera，答案将不完美。[答案](https://stackoverflow.com/a/8928945/611741)解释了如何在调用 setSelectionRange 之前调整 selectionStart、selectionEnd 。

我已经用@AVProgrammer提出的解决方案尝试了另一个问题的adjustOffset，它可以工作。

```
function adjustOffset(el, offset) {
    /* From https://stackoverflow.com/a/8928945/611741 */
    var val = el.value, newOffset = offset;
    if (val.indexOf("\r\n") > -1) {
        var matches = val.replace(/\r\n/g, "\n").slice(0, offset).match(/\n/g);
        newOffset += matches ? matches.length : 0;
    }
    return newOffset;
}

$.fn.setCursorPosition = function(position){
    /* From https://stackoverflow.com/a/7180862/611741 */
    if(this.lengh == 0) return this;
    return $(this).setSelection(position, position);
}

$.fn.setSelection = function(selectionStart, selectionEnd) {
    /* From https://stackoverflow.com/a/7180862/611741 
       modified to fit https://stackoverflow.com/a/8928945/611741 */
    if(this.lengh == 0) return this;
    input = this[0];

    if (input.createTextRange) {
        var range = input.createTextRange();
        range.collapse(true);
        range.moveEnd('character', selectionEnd);
        range.moveStart('character', selectionStart);
        range.select();
    } else if (input.setSelectionRange) {
        input.focus();
        selectionStart = adjustOffset(input, selectionStart);
        selectionEnd = adjustOffset(input, selectionEnd);
        input.setSelectionRange(selectionStart, selectionEnd);
    }

    return this;
}

$.fn.focusEnd = function(){
    /* From https://stackoverflow.com/a/7180862/611741 */
    this.setCursorPosition(this.val().length);
} 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2012-04-11T05:52:27.013

对我在[bitbucket中找到的代码进行小修改](http://code.accursoft.com/caret/wiki/Home)

如果给定 2 个位置，代码现在可以选择/突出显示起点/终点。经过测试，在 FF/Chrome/IE9/Opera 中运行良好。

```
$('#field').caret(1, 9); 
```

代码如下，只改动了几行：

```
(function($) {
  $.fn.caret = function(pos) {
    var target = this[0];
    if (arguments.length == 0) { //get
      if (target.selectionStart) { //DOM
        var pos = target.selectionStart;
        return pos > 0 ? pos : 0;
      }
      else if (target.createTextRange) { //IE
        target.focus();
        var range = document.selection.createRange();
        if (range == null)
            return '0';
        var re = target.createTextRange();
        var rc = re.duplicate();
        re.moveToBookmark(range.getBookmark());
        rc.setEndPoint('EndToStart', re);
        return rc.text.length;
      }
      else return 0;
    }

    //set
    var pos_start = pos;
    var pos_end = pos;

    if (arguments.length > 1) {
        pos_end = arguments[1];
    }

    if (target.setSelectionRange) //DOM
      target.setSelectionRange(pos_start, pos_end);
    else if (target.createTextRange) { //IE
      var range = target.createTextRange();
      range.collapse(true);
      range.moveEnd('character', pos_end);
      range.moveStart('character', pos_start);
      range.select();
    }
  }
})(jQuery) 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2017-04-03T15:54:29.163

我必须让它为 contenteditable 元素和 jQuery 工作，并且有人可能希望它准备好使用：

```
$.fn.getCaret = function(n) {
    var d = $(this)[0];
    var s, r;
    r = document.createRange();
    r.selectNodeContents(d);
    s = window.getSelection();
    console.log('position: '+s.anchorOffset+' of '+s.anchorNode.textContent.length);
    return s.anchorOffset;
};

$.fn.setCaret = function(n) {
    var d = $(this)[0];
    d.focus();
    var r = document.createRange();
    var s = window.getSelection();
    r.setStart(d.childNodes[0], n);
    r.collapse(true);
    s.removeAllRanges();
    s.addRange(r);
    console.log('position: '+s.anchorOffset+' of '+s.anchorNode.textContent.length);
    return this;
}; 
```

用法`$(selector).getCaret()`返回数字偏移量并`$(selector).setCaret(num)`建立偏移量并将焦点设置在元素上。

还有一个小技巧，如果您`$(selector).setCaret(num)`从控制台运行，它将返回 console.log，但您不会看到焦点，因为它是在控制台窗口中建立的。

最佳;D

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-10-17T07:44:50.177

如果 setSelectionRange 不存在，您可以直接更改原型。

```
(function() {
    if (!HTMLInputElement.prototype.setSelectionRange) {
        HTMLInputElement.prototype.setSelectionRange = function(start, end) {
            if (this.createTextRange) {
                var range = this.createTextRange();
                this.collapse(true);
                this.moveEnd('character', end);
                this.moveStart('character', start);
                this.select();
            }
        }
    }
})();
document.getElementById("input_tag").setSelectionRange(6, 7); 
```

[jsFiddle](http://jsfiddle.net/anoop26667/CHrfc/)链接

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-09-15T08:11:45.457

至于我这里最简单的方法是通过光标位置在 textarea 中添加文本（Tab -> \t）并将焦点保存在光标上：

```
$('#text').keyup(function () {
    var cursor = $('#text').prop('selectionStart');
    //if cursot is first in textarea
    if (cursor == 0) {
        //i will add tab in line
        $('#text').val('\t' + $('#text').val());
        //here we set the cursor position
        $('#text').prop('selectionEnd', 1);
    } else {
        var value = $('#text').val();
        //save the value before cursor current position
        var valToCur = value.substring(0, cursor);
        //save the value after cursor current position
        var valAfter = value.substring(cursor, value.length);
        //save the new value with added tab in text
        $('#text').val(valToCur + '\t' + valAfter);
        //set focus of cursot after insert text (1 = because I add only one symbol)
        $('#text').prop('selectionEnd', cursor + 1);
    }
}); 
```

# .net - LINQ to SQL - 更新以增加非主键字段 - 线程安全

> ID：499130
> 
> 赞同：3
> 
> 时间：2009-01-31T16:40:33.197
> 
> 标签：.net, linq, linq-to-sql, concurrency, locking

我有两个表（嗯，两个与这个问题相关）：

Bets（保存投注；列：Id、、MessagesPosted、） Bets_Messages（保存投注的论坛消息；列：Id、BetId、）

当我在 Bets_Messages 中插入新的 BetMessage 时，我想更新（准确地说是递增）Bets 中的相应字段。

在纯 T-SQL 中，这将是：

```
INSERT INTO Bets_Messages (BetId, <bla bla>) VALUES (23, "asfasdfasdf");
UPDATE Bets SET MessagesPosted = MessagesPosted + 1 WHERE Id = 23; 
```

上面的代码会很好用，而且它是线程安全的；如果两个线程会对它进行 DB 调用（当然对于同一个 Bet），MessagesPosted 列会很好地增加，因为第一个 UPDATE 将至少在其上放置一个 ROWLOCK，实际上是对 UPDATE 进行序列化。

但是，使用 LINQ to SQL 会遇到更困难的方法：

```
 public void PostMessage(MyProject.Entities.BetMessage betMessageEntity)
    {
        DatabaseDataContext ctx = GetFreshContext(); // GetFreshContext is a private method that practically initializes a new DataContext
        Bets_Message msg = new Bets_Message(betMessageEntity);
        ctx.Bets_Messages.InsertOnSubmit(msg);
        Bet bet = (from b in ctx.Bets where b.Id == (long)betMessageEntity.BetId select b).Single();
        bet.MessagesPosted++;
        ctx.SubmitChanges();
    } 
```

看起来不错吧？那么这就是它会产生的：

```
exec sp_executesql N'INSERT INTO [dbo].[Bets_Messages]([ParentMessageId], [BetsId], [UserId], [Subject], [DisplayXml], [Time], [ReplyDepth], [Text])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7)

SELECT CONVERT(BigInt,SCOPE_IDENTITY()) AS [value]',N'@p0 bigint,@p1 bigint,@p2 uniqueidentifier,@p3 nvarchar(6),@p4 nvarchar(114),@p5 datetime2(7),@p6 tinyint,@p7 nvarchar(8)',@p0=NULL,@p1=1,@p2='A0D253AF-6261-49AE-8C11-BA6117EF35C7',@p3=N'aaawww',@p4=N'<m ai="a0d253af-6261-49ae-8c11-ba6117ef35c7" a="AndreiR" s="aaawww" t="2009-01-31T18:04:31.282+02:00">wwwwwaaa</m>',@p5='2009-01-31 18:04:31.2820000',@p6=0,@p7=N'wwwwwaaa' 
```

（对于 BetMessage 插入）和 UPDATE ：

```
exec sp_executesql N'UPDATE [dbo].[Bets]
SET [MessagesPosted] = @p17
WHERE ([Id] = @p0) AND ([UserId] = @p1) AND ([Bets_CategoriesId] = @p2) AND ([Bets_TypesId] = @p3) AND ([TotalSum] = @p4) AND ([TotalBetters] = @p5) AND ([CreateDate] = @p6) AND ([DeadlineDate] = @p7) AND ([ClosedDate] IS NULL) AND ([Bets_StatusesId] = @p8) AND ([LastBetAdded] IS NULL) AND ([Title] = @p9) AND ([ShortDescription] = @p10) AND ([Description] = @p11) AND ([DescriptionPlainText] = @p12) AND ([Version] = @p13) AND ([ReviewedBy] = @p14) AND ([UrlFragment] = @p15) AND ([MessagesPosted] = @p16) AND ([ClosedBy] IS NULL) AND ([OutcomeNumber] IS NULL)',N'@p0 bigint,@p1 uniqueidentifier,@p2 smallint,@p3 tinyint,@p4 money,@p5 int,@p6 datetime2(7),@p7 datetime2(7),@p8 tinyint,@p9 nvarchar(7),@p10 nvarchar(30),@p11 nvarchar(33),@p12 nvarchar(22),@p13 smallint,@p14 uniqueidentifier,@p15 varchar(7),@p16 int,@p17 int',@p0=1,@p1='A0D253AF-6261-49AE-8C11-BA6117EF35C7',@p2=2,@p3=1,@p4=$0.0000,@p5=0,@p6='2008-12-03 00:00:00',@p7='2008-12-31 00:00:00',@p8=2,@p9=N'Pariu 1',@p10=N'Descriere pariu 1 - text chior',@p11=N'Descriere pe larg 1 - html permis',@p12=N'descriere text chior 1',@p13=1,@p14='A0D253AF-6261-49AE-8C11-BA6117EF35C7',@p15='pariu-1',@p16=18,@p17=19 
```

为 UPDATE 生成的 T-SQL 的问题在于，虽然作为线程安全似乎没问题，但它可能会在第二个线程中引发错误，对行进行更新而不是等待它完成。会吗？

这就是我这么认为的原因。

第一个线程这样做：

插入对应的 betMessage，更新下注行，将 MessagePosted 从 0 递增到 1

第二个线程将执行此操作：

插入它对应的 betMessage，更新下注行以将 MessagePosted 从 0 增加到 1（读取时为 0）。但是现在它是 1 并且 WHERE 子句将使它不更新，因为 wHERE 子句将评估为 false。受影响的 0 行将被发送到 LINQ 客户端，进而引发异常。

因此，我将不得不编写我的 f*#$ing 重试尝试代码，而不是依赖 SQL Server 中的 ROW LOCK。

是否有一些体面的方法使用 LINQ to SQL 而**不是**存储过程、即席查询等？

感谢您耐心阅读这篇长文。。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T17:11:30.453

**编辑**：实际上在重读您的帖子后，我认为 SubmitChanges 生成的自动事务已经负责确保所有语句都已完成或没有。我在想，由于您使用的是自动生成的 id，您应该在 LINQ 中进行两阶段更新，但似乎 SubmitChanges 会为您处理它。

我将保留下面的代码以供参考，尽管我认为这不是必需的。底部的链接解释了完成交易的不同方式。

您需要的是一个事务范围来包装整个插入/更新集。

```
using System.Transactions;

public void PostMessage(MyProject.Entities.BetMessage betMessageEntity)
{
    using (TransactionScope scope = new TransactionScope()) {
       DatabaseDataContext ctx = GetFreshContext();
       Bets_Message msg = new Bets_Message(betMessageEntity);
       ctx.Bets_Messages.InsertOnSubmit(msg);
       ctx.SubmitChanges();  // this is what I thought you did
       Bet bet = (from b in ctx.Bets
                  where b.Id == (long)betMessageEntity.BetId select b)
                 .Single();
       bet.MessagesPosted++;
       ctx.SubmitChanges();
       scope.Complete();
    }
} 
```

我认为这不会导致自动升级到分布式事务，因为所有命令在数据上下文中重用相同的连接。如果确实如此，您可以在数据上下文的连接上创建一个事务并将其分配给数据上下文的 Transaction 属性。但是，如果您这样做，您将需要自己管理和处理它。

[MSDN](http://msdn.microsoft.com/en-us/library/bb386995.aspx)上有关 LINQ2SQL 和事务的更多信息。

# html - 如何强制缠绕没有任何空白的长字符串？

> ID：499137
> 
> 赞同：213
> 
> 时间：2009-01-31T16:44:16.810
> 
> 标签：html, css, string, xul, word-wrap

我有一个长字符串（DNA 序列）。它不包含任何空白字符。

例如：

```
ACTGATCGAGCTGAAGCGCAGTGCGATGCTTCGATGATGCTGACGATGCTACGATGCGAGCATCTACGATCAGTCGATGTAGCTAGTAGCATGTAGTGA 
```

什么是 CSS 选择器来强制将此文本包裹在 a`html:textarea`或 a 中`xul:textbox`？

* * *

## 回答 #1

> 赞同：303
> 
> 时间：2009-01-31T16:53:49.427

对于块元素：

```
<textarea style="width:100px; word-wrap:break-word;">
  ACTGATCGAGCTGAAGCGCAGTGCGATGCTTCGATGATGCTGACGATGCTACGATGCGAGCATCTACGATCAGTC
</textarea>
```

对于内联元素：

```
<span style="width:100px; word-wrap:break-word; display:inline-block;"> 
   ACTGATCGAGCTGAAGCGCAGTGCGATGCTTCGATGATGCTGACGATGCTACGATGCGAGCATCTACGATCAGTC
</span>
```

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2009-04-18T19:33:22.003

在要允许中断的点处放置[零宽度空格。](http://en.wikipedia.org/wiki/Zero_Width_Space)零宽度空间`&#8203;`在 HTML 中。例如：

`ACTGATCG&#8203;AGCTGAAG&#8203;CGCAGTGC&#8203;GATGCTTC&#8203;GATGATGC`

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2013-08-28T09:30:41.493

以下是一些非常有用的答案：

[如何防止长词破坏我的div？](https://stackoverflow.com/questions/320184/how-to-prevent-long-words-from-breaking-my-div)

为了节省您的时间，这可以用 css 解决：

```
white-space: -moz-pre-wrap; /* Mozilla */
white-space: -hp-pre-wrap; /* HP printers */
white-space: -o-pre-wrap; /* Opera 7 */
white-space: -pre-wrap; /* Opera 4-6 */
white-space: pre-wrap; /* CSS 2.1 */
white-space: pre-line; /* CSS 3 (and 2.1 as well, actually) */
word-wrap: break-word; /* IE */
word-break: break-all; 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2010-07-13T04:52:09.773

对我来说，这有效，

```
<td width="170px" style="word-wrap:break-word;">
  <div style="width:140px;overflow:auto">
    LONGTEXTGOESHERELONGDIVGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESLONGTEXTGOESHERELONGDIVLONGTEXTLONGTEXT
  </div>
</td> 
```

您还可以在另一个 div 中使用 div 而不是`td`. 我使用`overflow:auto`了 ，因为它显示了我的 Opera 和 IE 浏览器中的所有文本。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-01-31T17:08:23.517

我不认为你可以用 CSS 做到这一点。相反，在字符串的常规“字长”处，插入一个 HTML 软连字符：

```
ACTGATCG&shy;AGCTGAAG&shy;CGCAGTGC&shy;GATGCTTC&shy;GATGATGC&shy;TGACGATG 
```

这将在行尾显示一个连字符，它在哪里换行，这可能是也可能不是你想要的。

注意 Safari 似乎将长字符串包装在 a 中`<textarea>`，与 Firefox 不同。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2013-02-14T01:13:14.200

使用 CSS 方法强制换行没有空格的字符串。三种方法：

1) 使用 CSS white-space 属性。要涵盖浏览器的不一致，您必须以多种方式声明它。因此，只需将您的 looooong 字符串放入某个块级元素（例如，div、pre、p）并为该元素提供以下 css：

```
some_block_level_tag {
    white-space: pre;           /* CSS 2.0 */
    white-space: pre-wrap;      /* CSS 2.1 */
    white-space: pre-line;      /* CSS 3.0 */
    white-space: -pre-wrap;     /* Opera 4-6 */
    white-space: -o-pre-wrap;   /* Opera 7 */
    white-space: -moz-pre-wrap; /* Mozilla */
    white-space: -hp-pre-wrap;  /* HP Printers */
    word-wrap: break-word;      /* IE 5+ */
} 
```

2) 使用[Compass 中的 force-wrap mixin](http://compass-style.org/reference/compass/typography/text/force-wrap/)。

3）我也在研究这个，我认为也可以工作（但我需要更完整地测试浏览器支持）：

```
.break-me {
    word-wrap: break-word;
    overflow-wrap: break-word;
} 
```

参考：[包装内容](http://perishablepress.com/wrapping-content/)

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2014-09-16T13:35:59.383

我的方式（当没有适当的方式插入特殊字符时）通过 CSS：

```
-ms-word-break: break-all;
word-break: break-all;
word-break: break-word;
-webkit-hyphens: auto;
-moz-hyphens: auto;
-ms-hyphens: auto;
hyphens: auto; 
```

如此处所示：http : [//kenneth.io/blog/2012/03/04/word-wrapping-hypernation-using-css/](http://kenneth.io/blog/2012/03/04/word-wrapping-hypernation-using-css/) 在那里可以找到一些额外的研究。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-12-07T20:09:20.933

为了`word-wrap:break-word;`为我工作，我必须确保`display`设置为`block`，并且在元素上设置了宽度。在 Safari 中，它必须有一个`p`标签，并且`width`必须在`ex`.

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-01-04T11:25:33.397

如果您使用的是 PHP，那么 wordwrap 函数可以很好地解决这个问题：http: [//php.net/manual/en/function.wordwrap.php](http://php.net/manual/en/function.wordwrap.php)

CSS 解决方案`word-wrap: break-word;`似乎在所有浏览器中都不一致。

其他服务器端语言也有类似的功能——或者可以手工构建。

下面是 PHP 自动换行函数的工作原理：

```
$string = "ACTGATCGAGCTGAAGCGCAGTGCGATGCTTCGATGATGCTGACGATGCTACGATGCGAGCATCTACGATCAGTCGATGTAGCTAGTAGCATGTAGTGA";

$wrappedstring = wordwrap($string,50,"&lt;br&gt;",true); 
```

这使用 <br> 标记将字符串包装为 50 个字符。'true' 参数强制字符串被剪切。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-08-12T06:50:21.543

```
<textarea style="width:100px; word-wrap:break-word;">
  place your text here
</textarea> 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2017-09-05T07:14:47.453

使用[`<wbr>`](https://developer.mozilla.org/en/docs/Web/HTML/Element/wbr)标签：

```
ACTGATCG<wbr>AGCTGAAG<wbr>CGCAGTGC<wbr>GATGCTTC<wbr>GATGATGC 
```

我认为这比使用零宽度空间要好`&#8203;`，这可能会在复制文本时引起问题。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-10-31T17:10:35.107

在表格不是固定大小的情况下，下面的行对我有用：

```
style="width:110px; word-break: break-all;" 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2021-03-02T18:46:44.087

如果您使用 Bootstrap，更好的情况是使用此类“text-break”。

例子：

`<p class="text-break">mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm</p>`

您应该在官方 Bootstrap 文档页面中获得更多信息

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-02-07T06:18:37.763

只是设置`width`和添加`float`对我有用:-)

```
width:100%;
float:left; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-10-13T16:14:14.097

这是我开始使用的代码`white-space: pre-wrap;`

```
.code {
    width: 90vw;
    white-space: pre-wrap;
    font-family: inherit;
    word-break: break-word;
    overflow-wrap: break-word;
    line-break: auto;
} 
```

我知道 with value 看起来很奇怪，您应该将其更改为 value 适合您的需求。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-12-07T19:01:25.277

简单地：

```
word-break: break-word; 
```

# delphi - TADO、Access、TNavigator 删除记录异常

> ID：499143
> 
> 赞同：0
> 
> 时间：2009-01-31T16:47:13.777
> 
> 标签：delphi

如何解决一个TADO、Access、TNavigator删除记录异常“键列信息不足或不正确”？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T22:43:20.750

可能是您的数据库组件用于访问表的键不足以识别唯一记录。确保为您的表提供一个主键或至少一个强制执行唯一索引的字段。

# c++ - 将合格的非静态成员函数作为函数指针传递

> ID：499153
> 
> 赞同：4
> 
> 时间：2009-01-31T16:53:20.193
> 
> 标签：c++

我在外部库中有一个无法使用以下签名更改的函数：

```
void registerResizeCallback(void (*)(int, int)) 
```

我想传入一个成员函数作为回调，因为我的回调需要修改实例变量。

显然，这是不可能的简单：

```
registerResizeCallback(&Window::Resize); 
```

所以我不确定如何解决这个问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-31T18:29:19.343

正如[Igor Oks 所指出](https://stackoverflow.com/questions/499153/passing-a-qualified-non-static-member-function-as-a-function-pointer/499159#499159)的，你不能这样做。这个问题的其余部分不是对您的问题的回答，而是讨论如何使用适当设计的回调 API（看起来您使用的不是）。

大多数设计良好的回调接口都允许您提供“ `void *`”或其他方式来获取回调中的上下文。在 C++ 中使用 this 的一种常见方法是在`void *`上下文参数中传递一个对象指针，然后回调函数可以将其转换回一个对象指针并调用成员方法来完成真正的工作。太糟糕了，您使用的回调 API 不提供上下文数据。

严格来说，回调必须是`extern "C"`，但是使用静态成员方法进行回调是很常见的，我认为在实践中从来没有问题。（这是假设回调 API 是一个 C 接口，这是迄今为止最常见的）。

一个例子：

```
// callback API declaration's

extern "C" {
    typedef unsigned int callback_handle_t;

    typedef void (*callback_fcn_t)( void* context, int data1, int data2);

    callback_handle_t RegisterCallback( callback_fcn_t, void* context);
    void UnregisterCallback( callback_handle_t);
}

// ----------------------------------

// prototype for wrapper function that will receive the callback and 
//  transform it into a method call

extern "C" 
static void doWorkWrapper( void* context, int data1, int data2);

// the class that does the real work

class worker {
public:
    worker() {
        hCallback = RegisterCallback( doWorkWrapper, this);
    }

    ~worker() {
        UnregisterCallback( hCallback);
    }

    void doWork( int data1, int data2) {
        // ... 
    };

private:
    callback_handle_t hCallback;
};

// the wrapper that transforms the callback into a method call
extern "C" 
static void doWorkWrapper( void* context, int data1, int data2)
{
    worker* pWorker = static_cast<worker*>( context);

    pWorker->doWork( data1, data2);
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-31T16:56:42.823

检查[“[33.2] 如何将指向成员函数的指针传递给信号处理程序、X 事件回调、启动线程/任务的系统调用等？”](http://www.parashift.com/c++-faq-lite/pointers-to-members.html#faq-33.2) 在 C++ FAQ Lite：

> 不。
> 
> 因为没有对象来调用成员函数是没有意义的，所以你不能直接这样做
> 
> ...
> 
> 作为现有软件的补丁，使用顶级（非成员）函数作为包装器，该包装器采用通过其他技术获得的对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T19:42:16.373

扩展 Michael Burr 的建议，您将必须了解非成员函数如何访问您正在修改的对象的实例。一种常见的方法是利用 C 中静态全局变量的范围：

```
// Top of your .c module:
static Window *gMyWindow;

// The declaration
extern "C" {
  void* my_callback(int, int);
}

// Later, set it just before handing off the callback
void somefunc() {
  ...
  gMyWindow = &windowObjectRef;
  registerResizeCallback(my_callback);
  windowObjectRef.SomeOtherWindowCallCausingCallbackInvoke();
  ...
}

// The callback in the same .c module as the global
void my_callback(int x, int y) {
  Window *object = gMyWindow;
  object->Resize(x, y);
} 
```

我还没有编译/运行上面的代码，所以细节上可能会有一些调整，但希望概念清楚：回调必须是 C 和 C++ 之间的桥梁，然后问题是如何让你的对象“进入”回调作为成员函数调用的实例。

在您的环境中可能还有其他原因导致上面的全局示例不起作用，因此您的任务是找出除了全局变量之外的其他机制，您可以根据自己的情况将对象传递到回调中。

# c - 初学者的 scanf_s() 残疾

> ID：499161
> 
> 赞同：1
> 
> 时间：2009-01-31T16:57:35.910
> 
> 标签：c, scanf, c11, crt, tr24731

```
int main(void) {
    char tmp, arr[100];
    int i, k;

    printf("Enter a string: ");
    scanf_s("%s", arr);

    for ( k = 0, i = (strlen(arr) - 1); k < (int) (strlen(arr) / 2); --i, ++k) {
            tmp = arr[k];
            arr[k] = arr[i];
            arr[i] = tmp;
    }

    puts(arr);

    return 0;
} 
```

我知道 scanf_s() 有一些奇怪的地方，但我无法解决这个问题。我的代码通过使用 scanf() 运行良好，但这不会反转数组的元素:( 任何帮助将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T17:08:11.130

scanf_s 要求将 chars 中的缓冲区大小作为第二个参数传递。

```
int iNumFilled1 = scanf_s("%s", arr);
int iNumFilled2 = scanf_s("%s", arr, _countof(arr));
assert(iNumFilled1 == 0);
assert(iNumFilled2 == 1); 
```

您还可以传递宽度说明符。如果通过并且它不适合缓冲区，则您将只有第一个“指定宽度”字符。

```
//Input a string longer than 99 chars
int iNumFilled3 = _tscanf_s(_T("%99s"), arr, _countof(arr));
assert(iNumFilled3 == 1);

//Again insert a string longer than 99 chars, but with no width specifier
int iNumFilled4 = _tscanf_s(_T("%s"), arr, _countof(arr));
assert(iNumFilled4 == 0); 
```

# java - 如何在netbeans 6.5中删除buttonGroup

> ID：499162
> 
> 赞同：2
> 
> 时间：2009-01-31T16:57:53.413
> 
> 标签：java, user-interface, netbeans, matisse

1.  我是 Netbeans 的新手，我玩过 Matisse GUI Editor，想删除`buttonGroup`没有参考的 a。我尝试了重构/安全删除操作，但没有办法这样做！那太糟糕了。有什么诀窍还是我必须重新启动一切？

2.  顺便说一句，我觉得不能编辑生成的灰色源代码太疯狂了，一定有什么技巧吗？那么 Java 核心 GUI 开发人员如何处理这个问题呢？

谢谢你的帮助！

SR

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-31T17:18:46.227

1.  对于在 GUI builder 中看不到的组件，请查看“Inspector”窗口，右键单击该组件并单击删除。默认情况下，该窗口应位于屏幕的左下角。

2.  恕我直言，这是一种权衡 :) 您获得了出色的 GUI 构建器，并且不允许任意更改生成的代码。因为它会导致 GUI builder 不理解代码。对于在创建对象时为组件的构造函数指定参数等常见任务，您始终可以转到“属性”窗口中的“代码”组。还有一些其他选项，例如“创建前代码”和“创建后代码”:)

图片： ![http://lh5.ggpht.com/_5XDoB4MglkY/SYSIp5flFaI/AAAAAAAAE-E/ZIR4ZBLPUz4/s800/NB2.jpg](https://i.stack.imgur.com/Bvlzy.jpg)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-17T14:01:18.537

我有同样的问题，原来我试图从错误的窗格中删除它。

我在“导航器”窗格而不是“检查器”窗格中，如果您在 Netbeans 中突出显示按钮组或任何其他不可见组件并点击 DELETE，那么它将毫无问题地删除它或在源视图中留下不必要的代码。

希望这可以帮助任何可能再次遇到此问题的人！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T20:37:31.600

不起作用 - 没有删除选项。选择它并转到 Edit -> Delete 什么都不做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-10-28T03:32:17.180

在“设计”模式下查看检查器窗口并从根目录展开所有组件。删除直接反映在“源”模式中。

# algorithm - 将 N 维值映射到希尔伯特曲线上的点

> ID：499166
> 
> 赞同：51
> 
> 时间：2009-01-31T16:59:59.320
> 
> 标签：algorithm, math, hilbert-curve, dimension-reduction

我有大量的 N 维点（数千万；N 接近 100）。

我需要将这些点映射到一个维度，同时保留空间局部性。我想用[希尔伯特空间填充曲线](http://en.wikipedia.org/wiki/Hilbert_curve)来做。

对于每个点，我想选择曲线上最近的点。点的希尔伯特值（从曲线起点到选取点的曲线长度）是我寻求的单维值。

计算不必是即时的，但我希望在体面的现代家用 PC 硬件上不会超过几个小时。

对实施有何建议？有什么图书馆可以帮助我吗？（语言并不重要。）

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2012-04-30T12:57:52.293

我终于崩溃了，掏出一些钱。AIP（美国物理研究所）有一篇不错的简短文章，其中包含 C 语言源代码。John Skilling 的“编程希尔伯特曲线”（来自 AIP Conf. Proc. 707, 381 (2004)）有一个附录，其中包含代码两个方向的映射。它适用于任何数量大于 1 的维度，不是递归的，不使用会占用大量内存的状态转换查找表，并且主要使用位操作。因此它相当快并且具有良好的内存占用。

如果您选择购买文章，我发现源代码中有错误。

以下代码行（在函数 TransposetoAxes 中找到）有错误：

for( i = n-1; i >= 0; i-- ) X[i] ^= X[i-1];

更正是将大于或等于 (>=) 更改为大于 (>)。如果没有这种更正，当变量“i”变为零时，使用负索引访问 X 数组，导致程序失败。

我建议阅读这篇文章（包括代码在内长达七页），因为它解释了算法的工作原理，这远非显而易见。

我将他的代码翻译成 C# 供我自己使用。代码如下。Skilling 执行转换，覆盖您传入的向量。我选择克隆输入向量并返回一个新副本。此外，我将这些方法实现为扩展方法。

Skilling 的代码将希尔伯特索引表示为转置，存储为数组。我发现交错位并形成单个 BigInteger 更方便（在字典中更有用，更容易在循环中迭代等），但我优化了该操作及其与幻数、位操作等的逆运算，以及代码很长，所以我省略了。

```
namespace HilbertExtensions
{
    /// <summary>
    /// Convert between Hilbert index and N-dimensional points.
    /// 
    /// The Hilbert index is expressed as an array of transposed bits. 
    /// 
    /// Example: 5 bits for each of n=3 coordinates.
    /// 15-bit Hilbert integer = A B C D E F G H I J K L M N O is stored
    /// as its Transpose                        ^
    /// X[0] = A D G J M                    X[2]|  7
    /// X[1] = B E H K N        <------->       | /X[1]
    /// X[2] = C F I L O                   axes |/
    ///        high low                         0------> X[0]
    ///        
    /// NOTE: This algorithm is derived from work done by John Skilling and published in "Programming the Hilbert curve".
    /// (c) 2004 American Institute of Physics.
    /// 
    /// </summary>
    public static class HilbertCurveTransform
    {
        /// <summary>
        /// Convert the Hilbert index into an N-dimensional point expressed as a vector of uints.
        ///
        /// Note: In Skilling's paper, this function is named TransposetoAxes.
        /// </summary>
        /// <param name="transposedIndex">The Hilbert index stored in transposed form.</param>
        /// <param name="bits">Number of bits per coordinate.</param>
        /// <returns>Coordinate vector.</returns>
        public static uint[] HilbertAxes(this uint[] transposedIndex, int bits)
        {
            var X = (uint[])transposedIndex.Clone();
            int n = X.Length; // n: Number of dimensions
            uint N = 2U << (bits - 1), P, Q, t;
            int i;
            // Gray decode by H ^ (H/2)
            t = X[n - 1] >> 1;
            // Corrected error in Skilling's paper on the following line. The appendix had i >= 0 leading to negative array index.
            for (i = n - 1; i > 0; i--) 
                X[i] ^= X[i - 1];
            X[0] ^= t;
            // Undo excess work
            for (Q = 2; Q != N; Q <<= 1)
            {
                P = Q - 1;
                for (i = n - 1; i >= 0; i--)
                    if ((X[i] & Q) != 0U)
                        X[0] ^= P; // invert
                    else
                    {
                        t = (X[0] ^ X[i]) & P;
                        X[0] ^= t;
                        X[i] ^= t;
                    }
            } // exchange
            return X;
        }

        /// <summary>
        /// Given the axes (coordinates) of a point in N-Dimensional space, find the distance to that point along the Hilbert curve.
        /// That distance will be transposed; broken into pieces and distributed into an array.
        /// 
        /// The number of dimensions is the length of the hilbertAxes array.
        ///
        /// Note: In Skilling's paper, this function is called AxestoTranspose.
        /// </summary>
        /// <param name="hilbertAxes">Point in N-space.</param>
        /// <param name="bits">Depth of the Hilbert curve. If bits is one, this is the top-level Hilbert curve.</param>
        /// <returns>The Hilbert distance (or index) as a transposed Hilbert index.</returns>
        public static uint[] HilbertIndexTransposed(this uint[] hilbertAxes, int bits)
        {
            var X = (uint[])hilbertAxes.Clone();
            var n = hilbertAxes.Length; // n: Number of dimensions
            uint M = 1U << (bits - 1), P, Q, t;
            int i;
            // Inverse undo
            for (Q = M; Q > 1; Q >>= 1)
            {
                P = Q - 1;
                for (i = 0; i < n; i++)
                    if ((X[i] & Q) != 0)
                        X[0] ^= P; // invert
                    else
                    {
                        t = (X[0] ^ X[i]) & P;
                        X[0] ^= t;
                        X[i] ^= t;
                    }
            } // exchange
            // Gray encode
            for (i = 1; i < n; i++)
                X[i] ^= X[i - 1];
            t = 0;
            for (Q = M; Q > 1; Q >>= 1)
                if ((X[n - 1] & Q)!=0)
                    t ^= Q - 1;
            for (i = 0; i < n; i++)
                X[i] ^= t;

            return X;
        }

    }
} 
```

我已将 C# 中的工作代码发布到 github。

见[https://github.com/paulchernoch/HilbertTransformation](https://github.com/paulchernoch/HilbertTransformation)

更新：我刚刚在 crates.io 上发布了一个名为“hilbert”的 Rust crate（2019 年秋季）。它还使用斯基林算法。见[https://crates.io/crates/hilbert](https://crates.io/crates/hilbert)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-08-14T22:40:46.347

此处给出的从 n->1 和 1->n 映射的算法 [“使用希尔伯特空间填充曲线计算一维和 n 维值之间的映射”JK Lawder](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.37.4165)

如果您在 Google 上搜索“SFC 模块和 Kademlia 覆盖”，您会发现一个声称将其用作系统一部分的组。如果您查看源代码，您可能可以提取相关功能。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-31T19:05:18.367

我不清楚这将如何做你想要的。考虑这个简单的 3D 案例：

```
001 ------ 101
 |\         |\
 | \        | \
 |  011 ------ 111
 |   |      |   |
 |   |      |   |
000 -|---- 100  |
  \  |       \  |
   \ |        \ |
    010 ------ 110 
```

可以通过以下路径“希尔伯特化”：

```
001 -----> 101
  \          \
   \          \
    011        111
     ^          |
     |          |
000  |     100  |
  \  |       \  |
   \ |        \ V
    010        110 
```

进入一维顺序：

```
000 -> 010 -> 011 -> 001 -> 101 -> 111 -> 110 -> 100 
```

这是讨厌的一点。考虑下面的对和一维距离列表：

```
000 : 100 -> 7
010 : 110 -> 5
011 : 111 -> 3
001 : 101 -> 1 
```

在所有情况下，左侧和右侧的值都是相同的 3D 距离（第一个位置为 +/- 1），这似乎意味着相似的“空间局部性”。但是通过任何选择的维度排序（在上面的例子中是 y，然后是 z，然后是 z）进行线性化会破坏该局部性。

另一种说法是，取一个起点并按照与该起点的距离对其余点进行排序将提供截然不同的结果。以`000`开头为例：

```
1D ordering : distance    3D ordering : distance
----------------------    ----------------------
        010 : 1           001,010,100 : 1
                          011,101,110 : sqrt(2)
                              111     : sqrt(3)
        011 : 2
        001 : 3
        101 : 4
        111 : 5
        110 : 6
        100 : 7 
```

这种效应随着维度的数量呈指数增长（假设每个维度具有相同的“大小”）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2016-07-12T22:13:45.010

我花了一点时间将 Paul Chernoch 的代码翻译成 Java 并清理它。我的代码中可能存在错误，尤其是因为我无法访问它最初来自的论文。但是，它通过了我能够编写的单元测试。它在下面。

请注意，我已经评估了[Z-Order](https://en.wikipedia.org/wiki/Z-order_curve)和 Hilbert 曲线在较大数据集上的空间索引。我不得不说 Z-Order 提供了更好的质量。但请随时为自己尝试。

```
 /**
     * Convert the Hilbert index into an N-dimensional point expressed as a vector of uints.
     *
     * Note: In Skilling's paper, this function is named TransposetoAxes.
     * @param transposedIndex The Hilbert index stored in transposed form.
     * @param bits Number of bits per coordinate.
     * @return Point in N-space.
     */
    static long[] HilbertAxes(final long[] transposedIndex, final int bits) {
        final long[] result = transposedIndex.clone();
        final int dims = result.length;
        grayDecode(result, dims);
        undoExcessWork(result, dims, bits);
        return result;
    }

    static void grayDecode(final long[] result, final int dims) {
        final long swap = result[dims - 1] >>> 1;
        // Corrected error in Skilling's paper on the following line. The appendix had i >= 0 leading to negative array index.
        for (int i = dims - 1; i > 0; i--)
            result[i] ^= result[i - 1];
        result[0] ^= swap;
    }

    static void undoExcessWork(final long[] result, final int dims, final int bits) {
        for (long bit = 2, n = 1; n != bits; bit <<= 1, ++n) {
            final long mask = bit - 1;
            for (int i = dims - 1; i >= 0; i--)
                if ((result[i] & bit) != 0)
                    result[0] ^= mask; // invert
                else
                    swapBits(result, mask, i);
        }
    }

    /**
     * Given the axes (coordinates) of a point in N-Dimensional space, find the distance to that point along the Hilbert curve.
     * That distance will be transposed; broken into pieces and distributed into an array.
     *
     * The number of dimensions is the length of the hilbertAxes array.
     *
     * Note: In Skilling's paper, this function is called AxestoTranspose.
     * @param hilbertAxes Point in N-space.
     * @param bits Depth of the Hilbert curve. If bits is one, this is the top-level Hilbert curve.
     * @return The Hilbert distance (or index) as a transposed Hilbert index.
     */
    static long[] HilbertIndexTransposed(final long[] hilbertAxes, final int bits) {
        final long[] result = hilbertAxes.clone();
        final int dims = hilbertAxes.length;
        final long maxBit = 1L << (bits - 1);
        inverseUndo(result, dims, maxBit);
        grayEncode(result, dims, maxBit);
        return result;
    }

    static void inverseUndo(final long[] result, final int dims, final long maxBit) {
        for (long bit = maxBit; bit != 0; bit >>>= 1) {
            final long mask = bit - 1;
            for (int i = 0; i < dims; i++)
                if ((result[i] & bit) != 0)
                    result[0] ^= mask; // invert
                else
                    swapBits(result, mask, i);
        } // exchange
    }

    static void grayEncode(final long[] result, final int dims, final long maxBit) {
        for (int i = 1; i < dims; i++)
            result[i] ^= result[i - 1];
        long mask = 0;
        for (long bit = maxBit; bit != 0; bit >>>= 1)
            if ((result[dims - 1] & bit) != 0)
                mask ^= bit - 1;
        for (int i = 0; i < dims; i++)
            result[i] ^= mask;
    }

    static void swapBits(final long[] array, final long mask, final int index) {
        final long swap = (array[0] ^ array[index]) & mask;
        array[0] ^= swap;
        array[index] ^= swap;
    } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-31T17:48:51.623

另一种可能性是在您的数据上构建一个[kd-tree](http://en.wikipedia.org/wiki/Kd-tree)，然后按顺序遍历该树以获得排序。构建kd-tree只需要你有一个好的求中值算法，其中有很多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-31T17:35:13.587

~~我看不出如何在一维中使用希尔伯特曲线。~~

如果您有兴趣在保持距离（误差最小）的同时将点映射到较低维度，那么您可以查看“多维缩放”算法。

模拟退火是一种方法。

编辑：感谢您的评论。我现在明白你所说的希尔伯特曲线方法是什么意思了。然而，这是一个难题，鉴于 N=100 和 1000 万个数据点，我认为任何方法都不能很好地保持局部性并在合理的时间内运行。我认为 kd-trees 不会在这里工作。

如果找到总排序对您来说并不重要，那么您可以研究基于位置的散列和其他近似最近邻方案。使用点桶进行分层多维缩放以减少输入大小可能会给您带来良好的排序，但在如此高的维度上再次令人怀疑。

# c# - 迁移带有 C# 应用程序的 Oracle 数据库：如何管理数据库迁移？

> ID：499171
> 
> 赞同：3
> 
> 时间：2009-01-31T17:01:30.800
> 
> 标签：c#, database, oracle, migration

我有一个 C# 应用程序，它与 Oracle 数据库一起使用并且已经发货。现在是发布新版本的时候了。C# 对象模型已经过修改，并对表结构产生了影响。

如果我发布新版本，我需要处理现有数据。只是删除表并重新创建这些表不会让任何客户满意。

为了解决这个问题，我收集了 SQL 脚本，它将以前发布的数据库结构更改为新的数据库结构。在此过程中，数据也被迁移。SQL 脚本被提交到类似于 C# 源代码的存储库中。在 CruiseControl.NET 的帮助下定期测试数据库的补丁。NUnit 测试针对已修补的数据库运行，以发现数据库表和 C# 对象模型之间的不匹配。

整个过程确实有效，但我觉得这可以做得更好。我认为数据库迁移非常关键。一个无法与错误修补的数据库一起运行的应用程序没有任何价值。丢失数据是不可接受的。这些可怕的场景可能会让我觉得根本不要更改数据库。因此，对我使用的工具和实践充满信心对我来说非常重要。

上周我偶然发现了[LiquiBase](http://www.liquibase.org/)，我问自己——现在在 SO：

**哪些工具或实践可以帮助您以更小的风险和更有信心的方式进行数据库迁移？那里有什么好书或互联网资源吗？**

我对 C# 和 Oracle 的特定解决方案特别感兴趣，它们可能适合我上面概述的开发过程。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T16:53:34.823

数据库升级脚本必须是开发过程的一部分。这是跟踪数据库模式升级的一种方法：

*   在数据库中创建包含一条带有版本号的记录的 VERSION 表
*   每次更改应用程序的数据库架构时，您应该：
    *   创建用于创建、更改或删除数据库对象的 SQL 脚本
    *   创建用于管理必须使用新数据模式完成的数据更改的 SQL 脚本（例如，在新字段中插入默认值，在新表中插入默认记录，创建用于拆分或合并表的脚本，...）
    *   增加数据库版本号
        *   对于每个更改，我通常创建一个名为 DbVerXXXX.SQL 的脚本，其中包含所有必要的升级（XXXX 是版本号）。此外，我会以小步骤进行更改 - 仅为您将在应用程序中进行的下一次更改更改数据库架构。不要创建需要数周或数月的工作来升级您的应用程序的数据库升级。
*   创建将用户的数据库升级到新版本的脚本：
    *   脚本应检查当前数据库版本，然后执行数据库升级脚本，将架构转换为所需级别
    *   更改 VERSION 表中的版本号

此过程使您能够：

*   将所有数据库架构更改置于源代码控制之下，因此您拥有完整的更改历史记录
*   尝试在测试数据库上测试您的升级脚本，然后再将其发送给客户
*   自信地自动升级用户数据库

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T17:10:01.610

您可能想研究一些现有的数据库冗余技术，例如[Oracle Dataguard](http://www.oracle.com/technology/deploy/availability/htdocs/DataGuardOverview.html)。我相信它特别具有一些可以帮助解决这种情况的功能。

然而，无论您采用何种技术，只要您在数据库中更改架构，您显然会面临一些风险。您始终可以执行的一种简单做法是创建数据库的副本，将其放在不同的服务器上，然后首先在该服务器上运行升级过程以解决错误。在与类似场景中的客户合作时，我们通常会与他们一起这样做，只是为了减轻他们的担忧并在对实时环境执行操作之前解决任何潜在问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T18:26:13.250

为了确保在更改数据库时不会丢失数据，您可以创建脚本来确认新结构和旧结构包含相同的逻辑数据。例如，假设数据库的版本 1 看起来像这样（伪代码）

```
CREATE TABLE Customer
CustomerID INT, 
FirstName string,
Surname string,
AddressLine1 string,
AddressLine2 string,
AddressLine3 string,
AddressLine4 string 
```

在版本 2 中，您希望能够允许客户拥有多个地址，因此您将地址字段移动到一个新表中：

```
CREATE TABLE Address
AddressID INT,
CustomerID INT,
AddressLine1 string,
AddressLine2 string,
AddressLine3 string,
AddressLine4 string 
```

您将客户表中的地址移动到新地址表中，如下所示：

```
INSERT Address
CustomerID ,
AddressLine1 ,
AddressLine2 ,
AddressLine3 ,
AddressLine4 

SELECT
*
FROM Customer 
```

然后从客户中删除多余的地址字段：

```
ALTER TABLE Customer
DROP COLUMNS 
AddressLine1 ,
AddressLine2 ,
AddressLine3 ,
AddressLine4 
```

到现在为止还挺好。但是我怎么知道新的地址表包含与旧的客户表完全相同的地址。整个过程很容易运行并以某种方式打乱地址，以便客户有效地相互更改地址。该代码可以通过所有测试，但我们将销毁我们的客户数据，因为他们不再知道他们的客户住在哪里。

我们可以通过运行确认地址字段的移动是否有效

如果这返回任何记录，则升级失败，因为一些客户没有移动他们的地址：

```
SELECT 
 *
FROM

  OldCustomerTable  OCT LEFT JOIN Address A
  ON OCT.CustomerID = A.CustomerID
WHERE 
  A.CustomerID IS NULL 
```

如果这返回任何记录，则升级失败，因为地址被打乱

```
SELECT
  *
FROM 
 OldCustomerTable  OCT INNER JOIN Address A
  ON OCT.CustomerID = A.CustomerID
WHERE
  OCT.Address1 != A.Address1 
  OR OCT.Address2 != A.Address2
  OR OCT.Address3 != A.Address3 
```

或 OCT.Address4 != A.Address4

您还可以检查新地址表是否仅包含每个客户的 1 个地址

```
SELECT
 CustomerID
 , COUNT(AddressID)
FROM
 Address
GROUP BY
 CustomerID
HAVING
 COUNT(AddressID) >1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-13T02:00:27.360

我完全同意@Zendar 的观点，即您必须对迁移脚本进行适当的版本控制，并且需要在数据库中包含版本控制元数据。您的脚本将在更新版本信息时修改您的架构。这就是大多数应用程序更新其数据库模式的方式。

也就是说，他的过程有点过于手动，您可能会对为此目的更自动化的工具感兴趣。

查看：

*   [自动补丁](https://github.com/tacitknowledge/autopatch)
*   [这个问题](https://stackoverflow.com/questions/4657904/c-sharp-alternative-of-rails-migrations)的答案
*   [这个问题](https://stackoverflow.com/questions/3437346/net-database-migration-tool)的答案

您还可以考虑这些工具中的想法并开发自己的想法。

# c# - 如何构建一个简单的推荐系统？

> ID：499173
> 
> 赞同：10
> 
> 时间：2009-01-31T17:03:12.293
> 
> 标签：c#, asp.net, database, algorithm, database-design

如何构建一个简单的推荐系统？我见过一些算法，但是很难实现我希望它们是实现最简单算法的实用描述？

我有这三张桌子

```
 Users
  userid      username
   1            aaa
   2            bbb 
```

和

```
 products
  productid        productname
     1                laptop
     2                mobile phone
     3                car 
```

和

```
 users_products
  userid        productid
    1                1
    1                3
    3                2
    2                3 
```

所以我希望能够根据他们购买的物品和其他用户的物品为每个用户推荐物品

我知道它应该类似于计算用户之间的相似性，然后查看他们的结果，但是如何完成并将其存储在数据库中，因为这将需要一个类似这样的表

```
 1    2   3   4   5   6 << users' ids
 1)   1   .4  .2  .3  .8  .4
 2)  .3    1  .5  .7  .3  .9
 3)  .4   .4   1  .8  .2  .3
 4)  .6   .6  .6   1  .4  .2
 5)  .8   .7  .4  .2   1  .3
 6)   1   .4  .6  .7  .9   1
 ^
 ^
users'
 ids 
```

那么如何计算用户之间的相似度呢？这些复杂的数据如何存储在广告数据库中？（它需要一个包含每个用户列的表）？谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-31T17:10:55.210

您希望如何实际存储推荐是一个与如何实际实施推荐引擎完全无关的问题。我把它留给你的数据库架构。上推荐。

你说“简单”，所以皮尔逊相关系数可能是你需要阅读的东西。

计算这样的事情非常简单。[概念](http://en.wikipedia.org/wiki/Pearson_correlation)，[示例代码](http://www.alglib.net/statistics/correlation.php)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-31T17:26:50.717

也许阅读[“编程集体智能”](https://rads.stackoverflow.com/amzn/click/com/0596529325)会对您有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T17:10:43.777

该表可以存储在三列中

`user_left` `user_top` `correlation`

（不过，我没有确定相关性的经验）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T17:14:39.430

您当然不需要为每个用户提供一列。您需要一个相关矩阵，这是真的，但实际的数据库表是不必要的。相反，您可以将其实现为

```
table: user_correlation_matrix
columns: user1_id user2_id correlation_factor 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T19:11:02.583

I saw this in one of Joe Celko's books. I believe it's this one [Here](https://rads.stackoverflow.com/amzn/click/com/0123735963). I don't have access to mine at the moment. Try heading over to a near by Barnes & Noble or Borders and check it out. I'll dig mine as soon as I have access and follow up.

# .net - 如何延迟使用 linq 到 sql 外部映射加载属性？

> ID：499183
> 
> 赞同：2
> 
> 时间：2009-01-31T17:12:12.197
> 
> 标签：.net, sql, linq, linq-to-sql, lazy-loading

我有一个表，其中包含一些我不想默认加载的 blob 字段。

在 dbml 文件中，可以为这些字段设置延迟加载属性。

外部映射文件是否有类似的选项？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T17:15:55.293

我不熟悉“外部映射文件”，但这基本上是您使用 LINQ-to-SQL 进行延迟加载的方式：

```
 private System.Data.Linq.Link<String> _content;
    [Column(Name = "content", DbType = "NVarChar(MAX) NOT NULL", Storage = "_content")]
    public String Content
    {
        get { return this._content.Value; }
        set { this._content.Value = value; }
    } 
```

用作`System.Data.Linq.Link<String>`私有变量会导致延迟加载该属性，除非在 DataContext 上禁用延迟加载。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-31T17:44:47.420

我相信您将不得不像 Daniel Schaffer 在代码中所说的那样，但没有 [Column] 属性，因为您将在 XML 文件中定义映射。

# linux - Linux中的系统调用是如何实现的？

> ID：499188
> 
> 赞同：53
> 
> 时间：2009-01-31T17:17:09.550
> 
> 标签：linux, operating-system

当我在用户模式下调用系统调用时，调用是如何在操作系统中处理的？

它会调用一些可执行的二进制文件或一些标准库吗？

如果是，完成通话需要什么样的东西？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-01-31T17:23:56.650

看看[这个](http://manugarg.googlepages.com/systemcallinlinux2_6.html)。

> 从 2.5 版开始，linux 内核在 Pentium II+ 处理器上引入了新的系统调用入口机制。由于使用现有软件中断方法的 Pentium IV 处理器的性能问题，使用 Pentium II+ 处理器上可用的 SYSENTER/SYSEXIT 指令实现了一种替代系统调用进入机制。本文探讨了这种新机制。讨论仅限于 x86 架构，所有源代码清单均基于 linux 内核 2.6.15.6。

1.  什么是系统调用？

    > 系统调用为用户态进程提供了一种从内核请求服务的方法。什么样的服务？由操作系统管理的服务，如存储、内存、网络、进程管理等。例如，如果用户进程想要读取文件，则必须进行“打开”和“读取”系统调用。通常系统调用不会被进程直接调用。C 库为所有系统调用提供了一个接口。

2.  系统调用会发生什么？

    > 内核代码片段根据用户进程的请求运行。此代码在环 0 中运行（当前权限级别为 -CPL-0），这是 x86 架构中的最高权限级别。所有用户进程都在环 3 (CPL 3) 中运行。
    > 
    > 所以，要实现系统调用机制，我们需要的是
    > 
    > 1) 一种从环 3 调用环 0 代码的方法。
    > 
    > 2）一些内核代码来服务请求。

3.  这样做的好方法

    > 直到前段时间，Linux 曾经使用软件中断在所有 x86 平台上实现系统调用。要执行系统调用，用户进程会将所需的系统调用号复制到 %eax 并执行“int 0x80”。这将产生中断 0x80 并调用中断服务程序。对于中断 0x80，此例程是“所有系统调用处理”例程。该例程将在环 0 中执行。该例程在文件 /usr/src/linux/arch/i386/kernel/entry.S 中定义，将保存当前状态并根据 % 中的值调用适当的系统调用处理程序eax。

4.  新的闪亮方式

    > 发现这种软件中断方法在 Pentium IV 处理器上要慢得多。为了解决这个问题，Linus 实现了一种替代系统调用机制，以利用所有 Pentium II+ 处理器提供的 SYSENTER/SYSEXIT 指令。在进一步使用这种新方法之前，让我们更熟悉这些说明。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-01T00:41:12.043

这取决于系统调用的含义。您是指 C 库调用（通过 glibc）还是实际的系统调用？C 库调用最终总是使用系统调用。

进行系统调用的旧方法是通过软件中断，即`int`指令。Windows 有`int 0x2e`，而 Linux 有`int 0x80`. 操作系统为中断描述符表 (IDT) 中的 0x2e 或 0x80 设置中断处理程序。这个处理程序然后执行系统调用。它将参数从用户模式复制到内核模式（这由特定于操作系统的约定控制）。`ebx`在 Linux 上，使用、`ecx`、`edx`、`esi`和传递参数`edi`。在 Windows 上，参数是从堆栈中复制的。然后处理程序执行某种查找（以查找函数的地址）并执行系统调用。系统调用完成后，`iret`指令返回用户态。

新方法是`sysenter`and `sysexit`。这两条指令基本上为您完成了所有的注册工作。操作系统通过模型特定寄存器 (MSR) 设置指令。之后，它实际上与使用`int`.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-31T17:24:32.220

它通过 glibc，在用参数填充寄存器后发出 0x80 中断。然后内核的中断处理程序在系统调用表中查找系统调用并调用相关的 sys_*() 函数。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-31T17:23:32.643

大大简化了，但是当您尝试访问保留的内存地址时会发生中断。中断将上下文切换到内核模式并代表用户执行内核代码（实际系统调用）。一旦调用完成，控制权就返回给用户代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-07-17T02:12:38.473

汇编中的 int X 转换为系统调用号 n。
Ex read syscall 可能被赋予数字 4。
在系统启动时，OS 构建一个称为中断描述符表 (IDT) 的指针表，其中包含系统调用的地址列表以及执行它们所需的特权。
当前特权级别（CPL）保存在 CS 寄存器的一位中（技术上 x86 上为 2 位）。
以下是 int 指令所遵循的步骤：
• 从 IDT 中获取第 n 个描述符，其中 n 是 int 的参数。
• 检查%cs 中的CPL 是否<= DPL，其中DPL 是描述符中的特权级别。
• 如果不是，则用户没有足够的权限执行此操作，将导致执行 int 13 指令（一般保护错误），（用户没有足够的权限）
• 如果是，则用户代码有足够的权限执行这个系统调用，当前执行上下文被保存（寄存器等），因为我们现在切换到内核模式。
这些信息包括寄存器、标志，因为当系统调用完成时，我们希望从离开的地方继续执行。• 系统调用的参数保存在内核堆栈中，因为系统调用是在内核模式下执行的。

**VSYSCALL (FAST SYSTEM CALL)**
用户每次执行系统调用时，操作系统都会保存机器的当前状态（即寄存器、堆栈指针等）并切换到内核模式执行。对于某些系统调用，不必保存所有寄存器。Ex gettime of day 系统调用读取当前时间，系统调用返回。所以一些系统调用是通过所谓的 vsyscalls 实现的。在这里，当进行系统调用时，它会在用户空间本身中执行，而无需切换到内核。所以节省了时间。
有关 vsyscall 的详细信息，请参见此处[http://www.trilithium.com/johan/2005/08/linux-gate/](http://www.trilithium.com/johan/2005/08/linux-gate/)
和此处 [任何人都可以理解 gettimeofday 的工作原理吗？](https://stackoverflow.com/questions/7266813/anyone-can-understand-how-gettimeofday-works)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-23T11:34:19.917

系统调用由特殊的陷阱指令、系统调用号和参数组成。

1.  特殊的陷阱指令用于从用户模式切换到具有无限权限的内核模式。
2.  系统调用号和参数由寄存器传递。

# javascript - Javascript DOM - 将表单元素添加到新创建的 appendChild？

> ID：499200
> 
> 赞同：2
> 
> 时间：2009-01-31T17:24:19.130
> 
> 标签：javascript, dom, appendchild

我有两个函数来添加和删除包含表单输入元素的表行。它们都工作正常，但我有一个问题，我需要仅在随后创建的表行上显示删除按钮输入。我的两个功能如下：

```
function addRow(table_id){
var clone;
var rows=document.getElementById(table_id).getElementsByTagName('tr');
var index=rows.length;
var tbo=document.getElementById(table_id).getElementsByTagName('tbody')[0];
clone=rows[index-1].cloneNode(true);
tbo.appendChild(clone);
}

function delRow(table_id,button){
var row = button.parentNode.parentNode;
var tbo = document.getElementById(table_id).getElementsByTagName('tbody')[0];   
tbo.removeChild(row);
} 
```

html内容是：

```
<form>
<table id="mytab">
<tr>
<td>Upload File <input type="file" name="uploadfile[]" onchange="addRow('mytab')" /> <input name="del_row" type="button" value="Remove Row" onclick="delRow('mytab',this)"/></td>
</tr>
</table>
</form> 
```

我绝不是 Javascript 专家——更像是一个新手——所以我正在努力想出一个解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T17:51:06.613

我假设您试图避免在第一行中有删除按钮，但现在需要它，因为您认为要在后续行中获取它，您需要将它放在您正在克隆的行中。相反，如果您只是在 addRow 方法中为上传和删除按钮输入插入新的 HTML，则可以完全避免克隆，并且原始行包含的内容无关紧要。

```
function addRow(table_id){
   var table = document.getElementById(table_id);
   var row = table.insertRow(table.rows.length);
   var cell = row.insertCell(0);
   var template = table.rows[0].cells[0].innerHTML;
   cell.innerHTML = template + '<input type="button" value="Remove Row"'
                 + ' onclick="delRow(\'' + table_id + '\',this);" />'
} 
```

这仍然使用第一行作为模板，但您可以从其中删除按钮，因为它是通过附加到现有文本来添加的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T17:57:07.753

如果你需要创建这个元素

```
<input name="del_row" type="button" value="Remove Row" onclick="delRow('mytab',this)"/> 
```

每次调用 addRow 函数时，您都可以在 addRow() 中执行此操作；

```
var input = document.createElement("input");
input.setAttribute("name", "del_row");
input.setAttribute("type", "button");
input.setAttribute("value", "Remove Row");
input.onclick = function() {
    delRow("+table_id+", this);
}; 
```

# emacs - Emacs 模式多行注释

> ID：499206
> 
> 赞同：10
> 
> 时间：2009-01-31T17:27:06.397
> 
> 标签：emacs, elisp

在 emacs 模式下定义多行注释的正确方法是什么（如 C 的 /* */）？我看到的 elisp 示例是针对以单个分隔符开头并在行尾结束的注释（如 C++ 的 // 或 perl 的 #）。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-31T17:42:01.670

就像这样：

```
(define-derived-mode my-mode
    awk-mode "my"
    "My mode"
  (setq comment-multi-line nil) ; maybe
  (setq comment-start "/* ")
  (setq comment-end "*/")) 
```

但也有微妙之处；也许你想要

```
/*  line one   */
/*  line two   */
/*  line three */ 
```

或者你可能想要

```
/*  
    line one
    line two
    line three
*/ 
```

这受您的 影响`comment-style`，您可以自定义 ( `M-x customize-variable comment-style`)。对于第一个示例，请选择`indent`，对于第二个示例，请选择`extra-line`。

这一切都在 中定义`newcomment.el`，如果您`M-x describe-variable comment-start`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T01:01:22.360

汤姆的回答包括创建评论；如果你想让你的模式知道注释，你需要修复语法表。

相关阅读：

[http://www.gnu.org/software/emacs/elisp/html_node/Syntax-Tables.html#Syntax-Tables](http://www.gnu.org/software/emacs/elisp/html_node/Syntax-Tables.html#Syntax-Tables)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-06-28T19:49:16.523

这是向 emacs 模式添加注释 goo 的极好指南。 [http://xahlee.org/emacs/elisp_comment_handling.html](http://xahlee.org/emacs/elisp_comment_handling.html)

# algorithm - 将希尔伯特值映射到 3D 点

> ID：499208
> 
> 赞同：8
> 
> 时间：2009-01-31T17:28:42.320
> 
> 标签：algorithm, math, hilbert-curve

我有一组希尔伯特值（从[希尔伯特曲线](http://en.wikipedia.org/wiki/Hilbert_curve)起点到给定点的长度）。

将这些值转换为 3D 点的最佳方法是什么？原始希尔伯特曲线不是 3D 的，所以我想我必须自己选择我需要的希尔伯特曲线等级。我确实有总曲线长度（即集合中的最大值）。

也许有一个现有的实现？一些允许我使用希尔伯特曲线/值的库？语言无关紧要。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T22:32:06.700

不是关于 3D 转换的答案，但这里有一个很好的算法和对希尔伯特值的讨论[带有空间填充曲线的二维空间散列](http://www.serpentine.com/blog/2007/01/11/two-dimensional-spatial-hashing-with-space-filling-curves)

来自[麻省理工学院](http://people.csail.mit.edu/jaffer/Geometry/HSFC)

```
4 algorithms for the n-dimensional Hilbert Space-Filling Curve

* A. R. Butz, "Alternative Algorithm for Hilbert's Space-Filling Curve",
  IEEE Trans. Comp., April, 1971, pp 424-426\. [Butz 1971]

* S. W. Thomas, "hilbert.c" in the Utah Raster Toolkit circa 1993,
  http://web.mit.edu/afs/athena/contrib/urt/src/urt3.1/urt-3.1b.tar.gz

* D. Moore, Fast Hilbert Curves in C, without Recursion

* J.K.Lawder, Calculation of Mappings Between One and n-dimensional Values Using the Hilbert Space-filling Curve, [JL1_00] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2018-05-23T12:24:40.603

如果我的问题是正确的，那么您`l`与 Hilbert 3D 曲线的起点有一些曲线长度距离，并且想要获得与该点相对应的坐标。

**如果您将整个3D 希尔伯特曲线**（覆盖单位立方体）预先生成为**折线**，则所有排序的点在前一个点和下一个点之间的距离相同。[因此，您可以使用分段线性插值](https://stackoverflow.com/a/30438865/2521214)来计算您的点。

这就是我在**C++中生成和渲染****2D/3D 希尔伯特曲线**的方式：

 **```
//---------------------------------------------------------------------------
#ifndef _Hilbert_vector_h
#define _Hilbert_vector_h
//---------------------------------------------------------------------------
#include "list.h"
//---------------------------------------------------------------------------
void Hilbert2D(List<double> &pnt,double x,double y,double z,double a,int n)
    {
    int i,j,m;
    double x0,y0,x1,y1,q;
    for (m=4*3,i=1,j=2;j<=n;j++,i+=i+1) m*=4; a/=i; // m = needed size of pnt[]
    pnt.num=0;
    // init generator
          pnt.add(x); pnt.add(y); pnt.add(z);
    y+=a; pnt.add(x); pnt.add(y); pnt.add(z);
    x+=a; pnt.add(x); pnt.add(y); pnt.add(z);
    y-=a; pnt.add(x); pnt.add(y); pnt.add(z);
    x0=x-0.5*a; // center of generator
    y0=y+0.5*a;
    // iterative subdivision
    for (j=2;j<=n;j++)
        {
        // mirror/rotate 2 qudrants
        x1=x0; y1=y0; m=pnt.num;
        for (i=m;i>=3;)
            {
            i--; z=pnt.dat[i]   ;
            i--; y=pnt.dat[i]-y0;
            i--; x=pnt.dat[i]-x0;
            q=x; x=+y; y=-q;    // z+
            pnt.dat[i+0]=(x1+x);
            pnt.dat[i+1]=(y1-y);
            pnt.dat[i+2]=(   z);
            }
        for (y1+=2.0*a,i=m;i>=3;)
            {
            i--; z=pnt.dat[i]   ;
            i--; y=pnt.dat[i]-y0;
            i--; x=pnt.dat[i]-x0;
            q=x; x=-y; y=+q;    // z-
            pnt.add(x1+x);
            pnt.add(y1+y);
            pnt.add(   z);
            }
        // mirror the rest
        x0+=a; y0+=a; m=pnt.num;
        for (i=m;i>=3;)
            {
            i--; z=pnt.dat[i]   ;
            i--; y=pnt.dat[i]-y0;
            i--; x=pnt.dat[i]-x0;
            pnt.add(x0-x);
            pnt.add(y0+y);
            pnt.add(   z);
            }
        a*=2.0;
        }
/*
        // rotations
        q=x; x=+y; y=-q;    // z+
        q=x; x=-y; y=+q;    // z-
*/
    }
//---------------------------------------------------------------------------
void Hilbert3D(List<double> &pnt,double x,double y,double z,double a,int n)
    {
    int i,j,m;
    double x0,y0,z0,x1,y1,z1,q;
    for (m=8*3,i=1,j=2;j<=n;j++,i+=i+1) m*=8; a/=i; // m = needed size of pnt[]
    pnt.num=0;
    // init generator
          pnt.add(x); pnt.add(y); pnt.add(z);
    z-=a; pnt.add(x); pnt.add(y); pnt.add(z);
    x+=a; pnt.add(x); pnt.add(y); pnt.add(z);
    z+=a; pnt.add(x); pnt.add(y); pnt.add(z);
    y+=a; pnt.add(x); pnt.add(y); pnt.add(z);
    z-=a; pnt.add(x); pnt.add(y); pnt.add(z);
    x-=a; pnt.add(x); pnt.add(y); pnt.add(z);
    z+=a; pnt.add(x); pnt.add(y); pnt.add(z);
    x0=x+0.5*a; // center of generator
    y0=y-0.5*a;
    z0=z-0.5*a;
    // iterative subdivision
    for (j=2;j<=n;j++)
        {
        // mirror/rotate qudrants
        x1=x0; y1=y0; z1=z0; m=pnt.num;
        for (i=m;i>=3;)
            {
            i--; z=pnt.dat[i]-z0;
            i--; y=pnt.dat[i]-y0;
            i--; x=pnt.dat[i]-x0;
            q=y; y=-z; z=+q;    // x-
            pnt.dat[i+0]=(x1+x);
            pnt.dat[i+1]=(y1+y);
            pnt.dat[i+2]=(z1-z);
            }
        for (z1-=2.0*a,i=m;i>=3;)
            {
            i--; z=pnt.dat[i]-z0;
            i--; y=pnt.dat[i]-y0;
            i--; x=pnt.dat[i]-x0;
            q=z; z=+x; x=-q;    // y+
            q=y; y=+z; z=-q;    // x+
            pnt.add(x1-x);
            pnt.add(y1+y);
            pnt.add(z1+z);
            }
        for (x1+=2.0*a,i=m;i>=3;)
            {
            i--; z=pnt.dat[i]-z0;
            i--; y=pnt.dat[i]-y0;
            i--; x=pnt.dat[i]-x0;
            q=y; y=+z; z=-q;    // x+
            pnt.add(x1+x);
            pnt.add(y1+y);
            pnt.add(z1+z);
            }
        for (z1+=2.0*a,i=m;i>=3;)
            {
            i--; z=pnt.dat[i]-z0;
            i--; y=pnt.dat[i]-y0;
            i--; x=pnt.dat[i]-x0;
            q=z; z=+x; x=-q;    // y+
            pnt.add(x1-x);
            pnt.add(y1-y);
            pnt.add(z1+z);
            }
        // mirror octants
        x0+=a; y0+=a; z0-=a; m=pnt.num;
        for (i=m;i>=3;)
            {
            i--; z=pnt.dat[i]-z0;
            i--; y=pnt.dat[i]-y0;
            i--; x=pnt.dat[i]-x0;
            pnt.add(x0+x);
            pnt.add(y0-y);
            pnt.add(z0+z);
            }
        a*=2.0;
        }
/*
        // rotations
        q=z; z=+x; x=-q;    // y+
        q=z; z=-x; x=+q;    // y-
        q=y; y=+z; z=-q;    // x+
        q=y; y=-z; z=+q;    // x-
        q=x; x=+y; y=-q;    // z+
        q=x; x=-y; y=+q;    // z-
*/
    }
//---------------------------------------------------------------------------
void pnt_draw2(List<double> &pnt)   // piecewise linear
    {
    int i;
    glBegin(GL_LINE_STRIP);
    for (i=0;i<pnt.num;i+=3) glVertex3dv(pnt.dat+i);
    glEnd();
    }
//---------------------------------------------------------------------------
void pnt_draw4(List<double> &pnt)   // piecewise cubic
    {
    int i,j;
    double  d1,d2,t,tt,ttt,*p0,*p1,*p2,*p3,a0[3],a1[3],a2[3],a3[3],p[3];
    glBegin(GL_LINE_STRIP);
    for (i=-3;i<pnt.num;i+=3)
        {
        j=i-3; if (j>pnt.num-3) j=pnt.num-3; if (j<0) j=0; p0=pnt.dat+j;
        j=i  ; if (j>pnt.num-3) j=pnt.num-3; if (j<0) j=0; p1=pnt.dat+j;
        j=i+3; if (j>pnt.num-3) j=pnt.num-3; if (j<0) j=0; p2=pnt.dat+j;
        j=i+6; if (j>pnt.num-3) j=pnt.num-3; if (j<0) j=0; p3=pnt.dat+j;
        for (j=0;j<3;j++)
            {
            d1=0.5*(p2[j]-p0[j]);
            d2=0.5*(p3[j]-p1[j]);
            a0[j]=p1[j];
            a1[j]=d1;
            a2[j]=(3.0*(p2[j]-p1[j]))-(2.0*d1)-d2;
            a3[j]=d1+d2+(2.0*(-p2[j]+p1[j]));
            }
        for (t=0.0;t<=1.0;t+=0.1)   // single curve patch/segment
            {
            tt=t*t;
            ttt=tt*t;
            for (j=0;j<3;j++) p[j]=a0[j]+(a1[j]*t)+(a2[j]*tt)+(a3[j]*ttt);
            glVertex3dv(p);
            }
        }
    glEnd();
    }
//---------------------------------------------------------------------------
#endif
//--------------------------------------------------------------------------- 
```

我使用了我的动态列表模板，所以：

`List<double> xxx;`与`double xxx[];`
`xxx.add(5);`添加`5`到列表末尾 相同
`xxx[7]`访问数组元素（安全）
`xxx.dat[7]`访问数组元素（不安全但快速直接访问）
`xxx.num`是数组的实际使用大小
`xxx.reset()`清除数组并为项目设置`xxx.num=0`
`xxx.allocate(100)`预分配空间`100`

但是您可以使用动态甚至静态**一维数组代替，因为****希尔伯特曲线**的点数很容易计算（`m`在每个希尔伯特函数的开头）。

用法很简单，只需执行以下操作：

```
List<double> pnt;
Hilbert3D(pnt,-0.8,-0.8,+0.8,1.6,n); 
```

其中`n`是迭代次数，`pnt`是每个点的线性`(x,y,z)`坐标列表（每个点 3 个数字）。开始位置和初始大小设置为覆盖以`(0,0,0)`半大小为中心的立方体`0.8` `<-0.8,+0.8>`。

现在只需计算点之间的单位长度，最接近左边的希尔伯特曲线点的索引和参数（到它的距离），只是线性插值。这里的**C++**示例：

```
if (pnt.num>=6)
    {
    int i;
    double x,y,z,t,l,dl;
    dl=sqrt(                                                    // base distance between points
            ((pnt[0]-pnt[3])*(pnt[0]-pnt[3]))
           +((pnt[1]-pnt[4])*(pnt[1]-pnt[4]))
           +((pnt[2]-pnt[5])*(pnt[2]-pnt[5]))
            );
    l=double(Form1->sb_t->Position)/double(Form1->sb_t->Max);   // <0,1>
    l*=dl*double((pnt.num/3)-1);                                // <0,Hilbert_curve_lenght>
    i=floor(l/dl); t=(l-(double(i)*dl))/dl; i*=3;               // index in pnt[] and single line segment paramerer
    x=pnt[i+0]+(pnt[i+3]-pnt[i+0])*t;                           // linear interpolation
    y=pnt[i+1]+(pnt[i+4]-pnt[i+1])*t;
    z=pnt[i+2]+(pnt[i+5]-pnt[i+2])*t;
    glColor3f(0.0,1.0,0.0); t=0.05;                             // render of marker
    glBegin(GL_LINES);
    glVertex3d(x-t,y-t,z); glVertex3d(x+t,y+t,z);
    glVertex3d(x+t,y-t,z); glVertex3d(x-t,y+t,z);
    glVertex3d(x,y-t,z-t); glVertex3d(x,y+t,z+t);
    glVertex3d(x,y-t,z+t); glVertex3d(x,y+t,z-t);
    glVertex3d(x-t,y,z-t); glVertex3d(x+t,y,z+t);
    glVertex3d(x+t,y,z-t); glVertex3d(x-t,y,z+t);
    glEnd();
    } 
```

**2D 预览：**

[![二维](https://i.stack.imgur.com/l16w1.gif)](https://i.stack.imgur.com/l16w1.gif)

**3D 预览：**

[![3D](https://i.stack.imgur.com/QQwbo.gif)](https://i.stack.imgur.com/QQwbo.gif)

# c# - 使用 WebClient 获取远程图像会产生颗粒状 GIF，无法处理 PNG+BMP

> ID：499210
> 
> 赞同：3
> 
> 时间：2009-01-31T17:29:02.023
> 
> 标签：c#, asp.net, webclient

问候！

我正在创建一个 Web 表单原型 (ImageLaoder.aspx)，它将返回一个图像，以便可以像其他 Web 表单/网页的这个简单示例一样使用它：

```
<img src="http://www.mydomain.com/ImageLoader.aspx?i=http://images.mydomain.com/img/a.jpg" /> 
```

到目前为止，它可以毫无问题地加载 JPG，但是 GIF 与原始文件相比看起来“颗粒状”，而 BMP 和 PNG 会导致以下异常：

***System.Runtime.InteropServices.ExternalException：GDI+ 中发生一般错误***

到目前为止，我的代码如下所示：

```
protected void Page_Load(object sender, EventArgs e)
{
    string l_filePath = Request.QueryString["i"];

    System.Drawing.Image l_image = GetImage(l_filePath);
    if (l_image != null)
    {
        System.Drawing.Imaging.ImageFormat l_imageFormat = DetermineImageFormat(l_filePath);
        WriteImageAsReponse(l_image, l_imageFormat);
    }
}

private System.Drawing.Image GetImage(string filePath)
{
    WebClient l_WebClient = new WebClient();
    byte[] l_imageBytes = l_WebClient.DownloadData(filePath);

    System.Drawing.Image l_image = null;
    using (MemoryStream l_MemStream = new MemoryStream(l_imageBytes, 0, l_imageBytes.Length))
    {
        l_MemStream.Write(l_imageBytes, 0, l_imageBytes.Length);
        l_image = System.Drawing.Image.FromStream(l_MemStream, true);
        l_MemStream.Close();
    }

    return l_image;
}

private System.Drawing.Imaging.ImageFormat DetermineImageFormat(string filePath)
{
    if (filePath.EndsWith(".jpg", StringComparison.OrdinalIgnoreCase))
        return System.Drawing.Imaging.ImageFormat.Jpeg;
    else if (filePath.EndsWith(".gif", StringComparison.OrdinalIgnoreCase))
        return System.Drawing.Imaging.ImageFormat.Gif;
    else if (filePath.EndsWith(".png", StringComparison.OrdinalIgnoreCase))
        return System.Drawing.Imaging.ImageFormat.Png;
    else
        return System.Drawing.Imaging.ImageFormat.Bmp;
}

private void WriteImageAsReponse(System.Drawing.Image image, System.Drawing.Imaging.ImageFormat imageFormat)
{
    if (image == null)
        return;

    System.Drawing.Bitmap l_outputBitMap = new Bitmap(image);

    if (imageFormat == System.Drawing.Imaging.ImageFormat.Jpeg)
        Response.ContentType = "image/jpg";
    else if (imageFormat == System.Drawing.Imaging.ImageFormat.Gif)
        Response.ContentType = "image/gif";
    else if (imageFormat == System.Drawing.Imaging.ImageFormat.Png)
        Response.ContentType = "image/png";
    else
        Response.ContentType = "image/bmp";

    l_outputBitMap.Save(Response.OutputStream, imageFormat);
} 
```

任何想法为什么 GIF 呈颗粒状，而 PNG 和 BMP 会导致异常？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-31T17:38:35.717

关于您的 GetImage 方法的几点：

*   当您使用 Image.FromStream 时，您不应关闭（或处置）流
*   如果您在流上调用 Dispose（使用 using 语句），则无需调用 Close
*   您正在写入流，但不是“倒带”，所以 l_image 实际上并没有得到任何数据，据我所知（除非 Image.FromStream 重置位置本身）。（可能是 gif/jpg 解码器倒带流，但 bmp/png 不倒带，因此出现错误。）
*   为什么不直接使用带有字节数组的 MemoryStream 构造函数呢？

简而言之，我相信您的 GetImage 方法可以替换为：

```
private Image GetImage(string filePath)
{
    WebClient l_WebClient = new WebClient();
    byte[] l_imageBytes = l_WebClient.DownloadData(filePath);
    MemoryStream l_stream = new MemoryStream(l_imageBytes);
    return Image.FromStream(l_stream);
} 
```

现在，更重要的是 - 你为什么要加载图像？您为什么不直接将文件本身作为响应提供，像您已经在做的那样设置内容类型 - 或者可能只是基于扩展名？换句话说，您的所有代码都将变为：

```
protected void Page_Load(object sender, EventArgs e)
{
    string filePath = Request.QueryString["i"];
    string extension = l_filePath.Substring(l_filePath.LastIndexOf('.') + 1);
    Response.ContentType = "image/" + extension;
    byte[] data = new WebClient.DownloadData(filePath);
    Response.OutputStream.Write(data, 0, data.Length);
    Response.End();
} 
```

更多的错误处理（包括“这是一个合理的扩展吗？”）会很好，但除此之外我认为没关系。自己实际加载图像的唯一好处是您可以验证它确实*是*图像而不是病毒或类似的东西。

编辑：只是出于兴趣，您是否有充分的理由*希望*图像请求通过您的服务器？为什么网页作者会写：

```
<img src="http://www.mydomain.com/ImageLoader.aspx?i=http://images.mydomain.com/img/a.jpg" /> 
```

代替

```
<img src="http://images.mydomain.com/img/a.jpg" /> 
```

它可能有用有*一些*原因，但在许多情况下它只是一种浪费。

# php - 数据映射器模式和重复对象

> ID：499211
> 
> 赞同：1
> 
> 时间：2009-01-31T17:29:04.270
> 
> 标签：php, datamapper

我在我正在开发的 PHP 应用程序中使用数据映射器模式并且有一个问题。目前，您请求一个具有特定 ID 的 Site 对象，映射器将查找该行，创建一个对象并返回它。但是，如果您对同一个站点再次执行此操作，您最终会得到两个具有相同数据的不同对象。例如。：

```
$mapper = new Site_Mapper();
$a = $mapper->get(1);
$b = $mapper->get(1);

$a == $b // true
$a === $b // false 
```

所以，我的问题是，我应该：

1.  将实例化的 Site 对象存储在映射器中，这样我就可以在创建新对象之前检查它们是否已经存在（如果有多个相同类型的映射器可能会出现问题）
2.  执行与 #1 相同的操作，但确保每个映射器只有一个实例
3.  与 #1 一样，但使用静态属性，因此多个实例不是问题
4.  不要担心，因为它 *可能*不是问题

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-01-04T18:15:42.510

您正在寻找的是**身份映射**模式。不过要小心所谓的“阅读不一致”。当您使用“旧实例”时，数据库可能已经更改。当你编辑你的对象时，另一个用户可能会得到它的一个实例，更快地改变它并更快地保存它。然后另一个对象再次覆盖所有这些更改。在网络上，虽然可能不是一个大问题，因为“页面”很快就会通过并且没有对象存活超过几分之一秒。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-20T05:17:58.680

我知道这个问题是很久以前提出的，但仍然想回答，以防万一其他人陷入类似的困境。实际上作者提出的上述建议#1,2,3都是相关的，为了解决问题，应该考虑它们。

1) 将从 DB 对象中检索到的每个存储在映射器中，以便在请求具有相同 ID 的对象时不必再次执行此操作。在所有后续调用中，映射器应返回存储的对象。这称为**IdentityMap**模式。为此，请在映射器中创建一个私有属性来保存给定对象类型的 IdentityMap 实例。Site_Mapper->get() 方法应该始终检查给定 ID 的 IdentityMap，如果对象没有被检索到，映射器将转到数据库，但如果它已经存储在地图中，它会返回缓存的实例，将行程保存到数据库。那么 $a === $b 应该是真的，因为它们是对同一个对象实例的引用。

2) 是的，理想情况下，应该始终存在给定数据映射器 (Site_Mapper) 的一个实例，以便在给定时间维护一个 IdentityMap 实例。这可以使用**单例**模式来完成。这可以通过像**Site_Mapper::getInstance()**这样的 getter 方法实现，它总是返回给定映射器的相同实例。您还必须将**__construct()**声明为私有方法，以防止使用**new**进行不必要的实例化，并确保**getInstance()**是实例化映射器的唯一方法。

3）作者上面提到的关于静态属性的内容也是正确的。要在 PHP 中实现**Singleton**，必须使用静态属性来保存 Mapper 的实例。

我强烈推荐 Martin Fowler 的《企业应用程序架构模式》一书，其中讨论了上述模式等等。这是一本很好的读物，尤其是如果您正在开发自己的自定义 ORM 解决方案。希望有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T18:15:51.010

我会以某种方式进行缓存 - 静态映射器类将是我的第一选择，也是我见过的最多的。否则，您的选项 2（这是单例模式）可能是最好的选择。

请记住，您需要在进行更新时清除此缓存以避免返回过时的数据。

话虽如此，除非您正在制作一些东西来获得大量使用或进行大量查询，否则这可能无关紧要。（你的 4 个）

也值得看一下指导（我相信有很多例子，我最了解这个），Propel（[http://propel.phpdb.org/](http://propel.phpdb.org/)）具有缓存功能 - 可能值得看看它是如何做的它？或者只是使用它？

# amazon-ec2 - 一个 Amazon EC2 实例可以服务多少用户？

> ID：499221
> 
> 赞同：2
> 
> 时间：2009-01-31T17:40:12.967
> 
> 标签：amazon-ec2

用途将是从 S3 上的数据中提供动态内容。你可以对“正常”做出任何你认为正常的定义。

小型、中型和大型实例呢？

好的。人们希望使用一些数据，所以在这里：

Web 服务在启动时大约 100kb，并且使用 AJAX，因此它不必重新加载整个页面（如果有的话）。当它加载页面时，它将向数据库 (S3) 发送 20 到 30 个请求以获取小块文本（如评论）。普通用户将在页面上停留 10 分钟，在偏移处转换为大约 100kb，通过请求转换为大约 400kb。假设晚上和白天的命中量相同。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-31T17:43:23.523

取决于您提供内容的内容和方式，更不用说这些用户访问它的频率、内容的大小和类型等。基本上，您提供的任何信息都无法让我们以任何有意义的方式回答您的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T14:19:10.720

正如其他人所说，这可能需要在您的确切条件下进行测试。幸运的是，如果您愿意设置服务器设置的测试版本，您可以生成模拟用户的实例。创建一堆这样的测试实例，并在它们上运行 Apache 的 ab 基准测试工具，将它们引导到您的测试站点。如果实例与您的测试站点位于同一可用区内，则您无需为带宽付费，只需按小时为正在运行的实例付费。运行一个不到一个小时的测试，然后关闭测试实例，组织这个压力测试的成本很低。

作为一个数据点，在我的小型实例上本地运行 Apache ab 工具，该实例为数据库密集型 Drupal 站点提供服务，它报告了服务器每秒处理 45-60 个请求的能力。我假设 ab 是一个合理的基准测试工具，我可能错了，但这就是我所看到的。

作为一个建议，我不太了解您的特定情况，我会将您的数据库移动到弹性块存储 (EBS) 卷。S3 并非真正用于托管数据库，它的延迟可能会影响您的性能。如果您担心的话，可以轻松地将 EBS 卷快照到 S3 以进行备份。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-31T18:21:56.270

有人可能会争辩说，如果设计得当，一个实例可以支持多少用户并不重要。理想情况下，当您的实例饱和时，您可以启动一个新实例来管理流量。

显然，这使部署和设计变得非常复杂。

但除此之外，EC2 实例实际上是一个低端 Linux 机器（取决于您选择的模型）。

让我们换个说法，你想支持多少用户？

# sharepoint - 如何在 SharePoint 公告中添加指向其余段落的链接？

> ID：499233
> 
> 赞同：2
> 
> 时间：2009-01-31T17:50:11.153
> 
> 标签：sharepoint, sharepoint-2007

如何在 SharePoint 的公告中创建指向该段落其余部分的链接，该链接显示以下文字：**阅读更多**

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T21:23:08.523

我发现最干净、最简单的方法是在 ItemStyle.xsl 中创建一个模板，该模板选择公告正文内容的子字符串，并在下方显示文章本身的链接。

将以下代码添加到您的 ItemStyle.xsl 文件（在 SharePoint Designer 中导航到“样式库/XSL 样式表”文件夹）后，您可以通过浏览器修改 Web 部件，并将项目样式（演示/样式）更改为'阅读更多公告'。此代码将显示的字符数保持为 190 个字符（请参阅 substring($bodyContent,1,190 函数调用）。

```
<xsl:template name="removeMarkup">
       <xsl:param name="string" />
       <xsl:choose>
       <xsl:when test="contains($string, '&lt;')">
              <xsl:variable name="nextString">
                     <xsl:call-template name="removeMarkup">
                     <xsl:with-param name="string" select="substring-after($string, '&gt;')" />
                     </xsl:call-template>
              </xsl:variable>
              <xsl:value-of select="concat(substring-before($string, '&lt;'), $nextString)" />
       </xsl:when>
       <xsl:otherwise>
              <xsl:value-of select="$string" />
       </xsl:otherwise>
       </xsl:choose>
</xsl:template> 
<xsl:template name="ReadMoreAnnouncements" match="Row[@Style='ReadMoreAnnouncements']" mode="itemstyle">
    <br />
    <div class="RMAnnouncementsTitle">
        <xsl:value-of select="@Title" />
    </div>
    <div class="RMAnnouncementsBody">
        <xsl:variable name="bodyContent">
            <xsl:call-template name="removeMarkup">
                <xsl:with-param name="string" select="@Body"/>
            </xsl:call-template>
        </xsl:variable>
        <xsl:value-of select="substring($bodyContent,1,190)" />
        ...
        <br />
        <a>
            <xsl:attribute name="href">
                /Lists/Announcements/DispForm.aspx?ID=
                <xsl:value-of select="@ID">
                </xsl:value-of>
            </xsl:attribute>
            <xsl:attribute name="class">
                RMAnnouncementsMoreLink
            </xsl:attribute>
            read more
        </a>
    </div>
</xsl:template> 
```

这绝对应该有效，并且非常容易实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-14T05:44:42.410

如果您有一个页面并且可以在 SharePoint Designer 中对其进行编辑，请尝试[此](http://randomdust.com/blogs/ryan/archive/2007/09/27/customize-announcements-summary-view.aspx). 如果您想要一个以您想要的方式显示公告的 Web 部件，请尝试[此](http://philwicklund.com/archive/2008/05/02/enhancement-to-the-announcements-list-view-web-part.aspx)。

# c++ - 关于模板专业化和由此产生的代码重复的问题

> ID：499236
> 
> 赞同：5
> 
> 时间：2009-01-31T17:54:11.990
> 
> 标签：c++, templates

要特化一个类模板，必须重新定义底层基模板（即非特化类模板）中的所有成员函数，即使它们预计大部分保持不变。有哪些公认的方法和“最佳实践”可以避免这种代码重复？

谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-31T18:06:09.140

您可以有选择地完全专门化成员：

```
template<int N>
struct Vector {
    int calculate() { return N; }
};

// put into the .cpp file, or make inline!
template<>
int Vector<3>::calculate() { return -1; } 
```

你做了一个完整的专业化。这意味着您不能部分专门化它：

```
template<int N, int P>
struct Vector {
    int calculate() { return N; }
};

// WROOONG!
template<int N>
int Vector<N, 3>::calculate() { return -1; } 
```

如果需要，可以使用 enable_if：

```
template<int N, int P>
struct Vector { 
    int calculate() { return calculate<P>(); }
private:
    // enable for P1 == 3
    template<int P1>
    typename enable_if_c<P1 == P && P1 == 3, int>::type
    calculate() { return -1; }

    // disable for P1 == 3
    template<int P1>
    typename enable_if_c<!(P1 == P && P1 == 3), int>::type
    calculate() { return N; }
}; 
```

另一种方法是像 Nick 推荐的那样将你的东西拆分（常见的东西到基类中，特殊的东西到派生类中）。

我通常会采取第二种方法。但如果我不需要部分专业化功能，我更喜欢第一个。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-31T18:03:04.623

当这种情况出现时，我通常使用基类。即：将通用功能放在基类中，并从中派生模板类，然后将派生类专门化为仅具有不同功能的派生类。

# c# - 将键/值添加到现有 URL 字符串的最佳方法？

> ID：499241
> 
> 赞同：4
> 
> 时间：2009-01-31T17:58:15.007
> 
> 标签：c#, .net, asp.net

我想在我的页面上生成一个链接，其中键/值对动态添加到 URL 中，以便：

> `Default.aspx?key1=value1`

变成：

> `Default.aspx?key1=value1&key2=value2`

以便现有查询保留 URL 中的任何键。此外，如果没有密钥，则将添加我的密钥以及 ' `?`'，因为它是需要的。

我可以轻松地编写一些执行此操作的逻辑，但这似乎是框架应该具有的实用程序。有没有办法在不为它编写自己的逻辑的情况下向查询字符串添加键？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T17:17:59.677

我知道，奇怪的是，.NET Framework 没有正确支持这一点。[不过，对 UriBuilder](http://petemontgomery.wordpress.com/2009/01/27/query-string-extension-methods-for-systemuribuilder/)的一些扩展将满足您的需求。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-31T18:14:45.207

您可以使用 UriBuilder 类。[请参阅查询属性](http://msdn.microsoft.com/en-us/library/system.uribuilder.query.aspx)文档中的示例。FWIW，ASP.NET MVC 包括 UrlHelper 类，它为 MVC 框架做这种事情。您可能想要考虑向 HttpRequest 类添加一个扩展方法，该方法接受一个字典并根据给定的请求和字典值返回一个合适的 Url。这样你只需要写一次。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T18:08:04.300

我一直在自己生成它们。

```
string url = Request.UrlReferrer.PathAndQuery;

(url[url.Length - 1] != '?' ? "?" : "&") + Url.Encode(key) + "=" + Url.Encode(key) 
```

*   Url.Encode 是 ASP.NET MVC 中的东西

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T18:18:56.103

如果您使用的是 ASP.NET MVC Framework 版本，我相信有一个 TabBuilder 对象可以让您这样做。否则，您可以使用 UriBuilder，但您仍然需要自己进行一些解析。在线也有一些实用程序类，但我从未使用过它们，所以我不知道它们的效果如何：

*   [http://weblogs.asp.net/bradvincent/archive/2008/10/27/helper-class-querystring-builder-chainable.aspx](http://weblogs.asp.net/bradvincent/archive/2008/10/27/helper-class-querystring-builder-chainable.aspx)
*   [http://www.codeproject.com/KB/aspnet/UrlBuilder.aspx](http://www.codeproject.com/KB/aspnet/UrlBuilder.aspx)

# sql-server - SQL Server 2008 全文搜索 (FTS) 与 Lucene.NET

> ID：499247
> 
> 赞同：40
> 
> 时间：2009-01-31T18:02:17.853
> 
> 标签：sql-server, sql-server-2008, full-text-search, lucene, lucene.net

我知道过去有关于 SQL 2005 与 Lucene.NET 的问题，但自 2008 年问世以来，他们对其进行了很多更改，并且想知道是否有人可以给我优点/缺点（或链接到文章）。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-31T19:48:44.037

对于小型部署，SQL Server FTS 将更易于管理。由于 FTS 与 DB 集成在一起，RDBMS 会自动处理更新索引。这里的缺点是除了复制数据库之外，您没有明显的扩展解决方案。因此，如果您不需要扩展，SQL Server FTS 可能“更安全”。从政治上讲，大多数商店会更愿意使用纯 SQL Server 解决方案。

在 Lucene 方面，我更喜欢 SOLR 而不是直接的 Lucene。无论使用哪种解决方案，您都必须自己做更多的工作来在数据更改时更新索引，以及自己将数据映射到 SOLR/Lucene 索引。优点是您可以通过添加其他索引轻松扩展。您可以在非常精简的 linux 服务器上运行这些索引，从而消除一些许可成本。如果您采用 Lucene/SOLR 路线，我的目标是将您需要的所有数据直接放入索引中，而不是将指针放回索引中的数据库。您可以在索引中包含不可搜索的数据，例如，您可以将预构建的 HTML 或 XML 存储在索引中，并将其作为搜索结果提供。使用这种方法，您的数据库可能会关闭，但您仍然可以在断开连接的模式下提供搜索结果。

我从未见过 SQL Server 2008 和 Lucene 之间的直接性能比较，但我很想看看。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-01T01:32:28.740

2006 年，我在 SQL Server 2005 的 FTS 之上构建了一个中等规模的知识库（可能是 2GB 的索引文本），现在已将其移至 2008 年的 iFTS。这两种情况对我来说都很好，但从 2005 年到 2008 年的转变对我来说实际上是一种进步。

我的情况与 StackOverflow 不同，因为我正在索引仅在夜间刷新的数据，但是我试图将来自多个 CONTAINSTABLE 语句的搜索结果重新连接到彼此和关系表中。

在 2005 年的 FTS 中，这意味着每个 CONTAINSTABLE 都必须在索引上执行搜索，返回完整结果，然后让数据库引擎将这些结果连接到关系表中（这对我来说都是透明的，但它正在发生并且很昂贵到查询）。2008 年的 iFTS 改善了这种情况，因为数据库集成允许多个 CONTAINSTABLE 结果成为查询计划的一部分，从而提高了许多搜索的效率。

我认为 2005 年和 2008 年的 FTS 引擎以及 Lucene.NET 都有架构权衡，这些权衡将更好或更差地适应许多项目环境——我很幸运升级对我有利。我完全可以理解为什么 2008 年的 iFTS 不能在与 2005 年相同的配置下工作，因为 StackOverflow.com 等用例具有高度 OLTP 特性。但是，我不会忽视 2008 iFTS 可以从繁重的插入事务负载中分离出来的可能性......但听起来它可能与迁移到 Lucene.NET 一样多的工作......而且很酷Lucene.NET 的因素是难以忽视的 ;)

无论如何，对我来说，SQL 2008 的 iFTS 在大多数情况下的易用性和效率可能会超过 Lucene 的“酷”因素（虽然它很容易使用，但我从未在生产系统中使用过它，所以我保留评论在那）。我会很想知道在 StackOverflow 或类似情况下 Lucene 的效率有多高（结果证明是？现在实现了吗？）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-31T18:07:05.893

这可能会有所帮助： [https ://blog.stackoverflow.com/2008/11/sql-2008-full-text-search-problems/](https://blog.stackoverflow.com/2008/11/sql-2008-full-text-search-problems/)

个人没有使用过 SQL Server 2008，但根据那篇博客文章，全文搜索功能似乎比 2005 年慢。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-31T18:11:03.547

我们同时使用全文搜索的可能性，但我认为这取决于数据本身和您的需求。

我们使用 Web 服务器进行扩展，因此我喜欢 lucene，因为我在 sql 服务器上没有那么多负载。

对于从 null 开始并想要进行全文搜索，我更喜欢 sql-server 解决方案，因为我认为获得结果真的很快，如果你想要 lucene，你必须在开始时实现更多（并且还要了解一些知识-如何）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T23:40:39.667

您需要记住的一个考虑因素是除了全文约束之外，您还有哪些类型的搜索约束。如果您正在做 lucene 无法提供的约束，那么您几乎肯定会想要使用 FTS。2008 年的好处之一是他们改进了 FTS 与标准 sql server 查询的集成，因此混合数据库和 FT 约束的性能应该比 2005 年更好。

# asp.net - 树视图事件处理 ASP.Net

> ID：499254
> 
> 赞同：0
> 
> 时间：2009-01-31T18:09:40.040
> 
> 标签：asp.net, treeview

我有一个包含三个节点的树视图，我想要的只是将事件处理功能附加到两个节点，第三个节点仅用于表示目的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-01T08:59:14.737

您可以将您的事件添加到 Treeview 并且当它与您的第三个节点相关时不执行任何操作，或者您可以仅将事件添加到您想要事件的节点，无论是在您创建它们时还是之后。

# makefile - 从 C 程序调用 C++ 函数

> ID：499293
> 
> 赞同：1
> 
> 时间：2009-01-31T18:26:43.700
> 
> 标签：makefile, scons, undefined-reference

如何从 C 程序中调用 C++ 函数，这可能吗？如果可以，我该怎么做？谢谢你。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-31T18:32:30.773

如果您尝试从 C 调用 C++ 函数，那么您可能会遇到[名称修改](http://en.wikipedia.org/wiki/Name_mangling)问题。编译器这样做是为了支持函数重载和 C++ 的其他特性。

您可以使用`extern "C"`通知 C++ 编译器该函数`CMACInit()`将从 C 代码中调用：

```
extern "C" CMACInit() { ... } 
```

当以这种方式声明时，C++ 编译器将不会破坏名称，并将设置所有内容，以便可以从 C 代码调用该函数。

# .net - 如何在 WPF 中制作模态对话框？

> ID：499294
> 
> 赞同：150
> 
> 时间：2009-01-31T18:26:58.257
> 
> 标签：.net, wpf, dialog, modal-dialog

如果我有一个 Xaml 窗口，如何*将它*作为子窗口打开，然后让父窗口在父窗口继续执行之前等待子窗口关闭？

* * *

## 回答 #1

> 赞同：243
> 
> 时间：2009-01-31T18:32:53.893

您是否尝试使用[ShowDialog](http://msdn.microsoft.com/en-us/library/system.windows.window.showdialog.aspx)方法显示您的窗口？

不要忘记将对话窗口上的[Owner 属性设置为主窗口。](https://www.codeproject.com/tips/226984/make-a-wpf-dialog-window-as-application-modal)这将避免在 Alt+Tabbing 等时出现奇怪的行为。

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2017-03-21T17:01:30.647

很多这些答案都很简单，如果有人开始 WPF，他们可能不知道所有的“来龙去脉”，因为这比告诉某人“使用`.ShowDialog()`！”更复杂。`.Show()`但这是您想要使用的方法（不是），以阻止使用基础窗口并阻止代码继续运行，直到模态窗口关闭。

首先，您需要 2 个 WPF 窗口。（一个会打电话给另一个。）

从第一个窗口开始，假设它被称为 MainWindow.xaml，在其代码隐藏中将是：

```
public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();
    }
} 
```

然后将您的按钮添加到您的 XAML：

```
<Button Name="btnOpenModal" Click="btnOpenModal_Click" Content="Open Modal" /> 
```

并右键单击该`Click`例程，选择“转到定义”。它将在 MainWindow.xaml.cs 中为您创建它：

```
private void btnOpenModal_Click(object sender, RoutedEventArgs e)
{
} 
```

在该函数中，您必须使用其页面类指定另一个页面。假设您将另一个页面命名为“ModalWindow”，这样就成为它的页面类，并且是您实例化（调用）它的方式：

```
private void btnOpenModal_Click(object sender, RoutedEventArgs e)
{
    ModalWindow modalWindow = new ModalWindow();
    modalWindow.ShowDialog();
} 
```

假设您有一个需要在模态对话框中设置的值。`ModalWindow`在XAML中创建一个文本框和一个按钮：

```
<StackPanel Orientation="Horizontal">
    <TextBox Name="txtSomeBox" />
    <Button Name="btnSaveData" Click="btnSaveData_Click" Content="Save" /> 
</StackPanel> 
```

然后再次创建一个事件处理程序（另一个`Click`事件）并使用它将文本框值保存到公共静态变量上`ModalWindow`并调用`this.Close()`.

```
public partial class ModalWindow : Window
{
    public static string myValue = String.Empty;        
    public ModalWindow()
    {
        InitializeComponent();
    }

    private void btnSaveData_Click(object sender, RoutedEventArgs e)
    {
        myValue = txtSomeBox.Text;
        this.Close();
    }
} 
```

然后，在您的`.ShowDialog()`声明之后，您可以获取该值并使用它：

```
private void btnOpenModal_Click(object sender, RoutedEventArgs e)
{
    ModalWindow modalWindow = new ModalWindow();
    modalWindow.ShowDialog();

    string valueFromModalTextBox = ModalWindow.myValue;
} 
```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-01-31T19:34:12.457

Window.Show 将显示窗口，并继续执行——这是一个非阻塞调用。

Window.ShowDialog 将阻塞调用线程（有点^([1])），并显示对话框。它还将阻止与父/拥有窗口的交互。当对话框被关闭时（无论出于何种原因）， ShowDialog 将返回给调用者，并允许您访问 DialogResult（如果需要）。

^([1])它将通过将调度程序框架推送到 WPF 调度程序上来保持调度程序的运行。这将导致消息泵继续泵送。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-31T18:34:02.953

给定一个 Window 对象 myWindow，myWindow.Show() 将无模式打开它，而 myWindow.ShowDialog() 将以模态方式打开它。但是，据我记得，即使是后者也不会阻止。

# mysql - 所有设置的所有 Mysql 数据类型和语法的列表

> ID：499295
> 
> 赞同：2
> 
> 时间：2009-01-31T18:26:58.693
> 
> 标签：mysql, syntax

我正在寻找所有 MySQL 数据类型的列表以及每种数据类型的每个选项的可用设置。

经过一番谷歌搜索后，我找不到类似的东西。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-31T18:31:47.623

[在这里，](http://kimbriggs.com/computers/computer-notes/mysql-notes/mysql-data-types-50.file)您可以找到 mysql 数据类型的快速摘要，包括范围、属性和默认值

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-31T18:47:53.237

为了完整起见，不要忘记[MySQL 文档](http://dev.mysql.com/doc/refman/5.0/en/data-types.html)。

尽管该列表分为多个页面，中间通常有很多评论，但当您需要检查特定类型的某些方面时，它是一个有用的资源。也有基本类型的概述，但同样，其中混杂了很多杂乱无章的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-07-13T05:20:18.553

如果有人需要它们作为 json 数组：

`"[\"TINYINT[(M)]\", \"SMALLINT[(M)]\", \"MEDIUMINT[(M)]\", \"INT[(M)]\", \"BIGINT[(M)]\", \"FLOAT(p)\", \"FLOAT[(M,D)]\", \"DOUBLE[(M,D)]\", \"DECIMAL[(M,[D])]\", \"BIT[(M)]\", \"CHAR[(M)]\", \"VARCHAR(M)\", \"TINYTEXT\", \"TEXT\", \"MEDIUMTEXT\", \"LONGTEXT\", \"BINARY[(M)]\", \"VARBINARY(M)\", \"TINYBLOB\", \"BLOB\", \"MEDIUMBLOB\", \"LONGBLOB\", \"ENUM(\\\"A1\\\",\\\"A2\\\",...)\", \"SET(\\\"A1\\\",\\\"A2\\\",...)\", \"DATE\", \"DATETIME\", \"TIME\", \"TIMESTAMP\", \"YEAR\"]"`

# cocoa - 如何使用 Mac OS X Cocoa 事件进行多点触控手势

> ID：499296
> 
> 赞同：4
> 
> 时间：2009-01-31T18:27:12.577
> 
> 标签：cocoa, osx-leopard

我正在编写一个程序，该程序在用户可以缩放的 NSScrollView 中嵌入了 NSView。我很想设置它，以便用户可以使用 MacBook Air 和新的一体式 MacBooks/MacBooks Pro 以及 Safari 和 iPhoto 等应用程序支持的多点触控捏合手势缩放视图。我已经搜索了 Apple 的文档，但不知道该怎么做。

1.  这是否支持在 Mac OS X 10.5 Leopard 上使用公开可用的 API？
2.  如果不是，私有 API 有多“糟糕”（例如，它只是一个未声明的常量还是一组全新的方法）？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-31T18:50:41.610

**编辑：** Snow Leopard 为手势和多点触控添加了支持的 API。请参阅[Snow Leopard 的 AppKit 发行说明](http://developer.apple.com/library/mac/releasenotes/Cocoa/AppKitOlderNotes.html#X10_6Notes)；⌘F 表示“手势”和“多点触控”（原文如此）。如果您在下面使用过它们，它们看起来会很熟悉，但可能存在一些细微差别，因此请阅读新文档。

* * *

> 这是否支持在 Mac OS X 10.5 Leopard 上使用公开可用的 API？

不。10.5.0 根本不支持它，10.5.1 到 10.5.6 使您实现未记录的方法。

> 如果不是，私有 API 有多“糟糕”（例如，它只是一个未声明的常量还是一组全新的方法）？

一点也不差。[您必须在视图中实现一些未记录的事件方法。](http://web.archive.org/web/20090618162428/http://cocoadex.com/2008/02/nsevent-modifications-swipe-ro.html)由于*您是*实现方法的人，因此如果 Apple 更改方法，您不应该崩溃；将会发生的只是该功能将停止工作。

但是，如果您要从事件中检索绝对（而不是增量）放大或旋转，那么这些是事件的尚未记录的方法，因此您应该用消息保护这些消息`respondsToSelector:`并仔细检查范围方法的返回值。

# .net - 在 winform 应用程序中模拟 ajax 加载器

> ID：499297
> 
> 赞同：3
> 
> 时间：2009-01-31T18:27:47.083
> 
> 标签：.net, winforms, animation, swfloader

我有一个 winform 应用程序，它根据用户选择呈现一些图表。我想模拟一个 ajax 样式加载器，这样当用户进行选择时，表单上会有一个叠加层，中间有一个动画。实现这一目标有哪些选择？我正在考虑在中心加载一个带有动画（gif）的面板，添加一些不透明度。

编辑~有人吗？

编辑〜[这](http://www.codeproject.com/KB/cs/mrg_loadingcircle.aspx)是我找到的解决方案......终于！没有WPF废话。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-31T18:49:00.600

WinForms 在这类事情上相当薄弱——WPF 可以更好地处理这种情况。你可以做几件事：

1） *哈克！*创建一个新的无模式、无边界表单，其中包含您的等待控件，并将其放在现有表单上。AFAIK 您不能将透明度分配给任何开箱即用的 WinForms 控件。确保当您现有的表单移动时，您的新表单也会移动。这是一个彻头彻尾的黑客攻击。

2) 从头开始​​创建您自己的 WinForms 控件并将其绘制在您现有的表单上。成本回报率高。

3) 这种形式使用 WPF，这会给你更多的灵活性。那是一个全新的框架……只是为了一种形式？

4) 暂时隐藏图表，让您的进度面板看起来非常漂亮。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T05:33:03.387

WinForms 的 PictureBox 控件无法处理动画 gif。

您仍然可以使用 PictureBox，但可以自己翻帧。只需每 50 或 100 毫秒设置一次定时器，以保持图片框上的帧旋转。

要创建叠加层，我会尝试使用黑色面板来覆盖整个表单，并带有一些 alpha 值。但是，它不适用于低于 Windows XP 的任何设备。如果我没记错的话，Windows 2000 及更低版本无法处理 Winforms 中的透明度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-06T09:04:21.483

正如 Saif 已经说过的，这些是完全可定制的加载器：

[http://www.codeproject.com/KB/cs/mrg_loadingcircle.aspx](http://www.codeproject.com/KB/cs/mrg_loadingcircle.aspx)

# database - 存储过程删除查询

> ID：499308
> 
> 赞同：5
> 
> 时间：2009-01-31T18:36:48.017
> 
> 标签：database, stored-procedures, sql-delete

我有存储过程：

```
ALTER PROCEDURE [dbo].[k_ShoppingCart_DELETE]

@cartGUID nvarchar

AS

DELETE FROM
  [dbo].[k_ShoppingCart]
WHERE
  CartGUID = @cartGUID 
```

当我执行这个时，

```
exec dbo.k_ShoppingCart_DELETE '32390b5b-a35a-4e32-8393-67d5629192f0' 
```

结果：0 行受影响。

但是，当我尝试这个查询时：

```
Delete FROM k_ShoppingCart Where CartGUID = '32390b5b-a35a-4e32-8393-67d5629192f0' 
```

结果：2 行受影响。

这有什么问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T19:22:03.997

如果您坚持使用 NVARCHAR 而不是 UNIQUEIDENTIFIER，则需要指定大小：

```
@cartGUID nvarchar(36) 
```

没有它，您的 guid 将被截断（[至 30 个字符](http://msdn.microsoft.com/en-us/library/aa276823.aspx)）。

您可以通过运行工作查询的此修改版本来确认此行为：

```
DECLARE @cart nvarchar, @sizedcart nvarchar(36)
SET @cart      = '32390b5b-a35a-4e32-8393-67d5629192f0'
SET @sizedcart = '32390b5b-a35a-4e32-8393-67d5629192f0'

-- works
Delete FROM k_ShoppingCart Where CartGUID = '32390b5b-a35a-4e32-8393-67d5629192f0'

-- will not work
Delete FROM k_ShoppingCart Where CartGUID = @cart

-- should work
Delete FROM k_ShoppingCart Where CartGUID = @sizedcart 
```

不过，我同意@Marc Gravell，uniqueidentifier 是去这里的方式。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-31T18:43:26.960

应该`@cartGUID`是一个`uniqueidentifier`而不是一个`nvarchar`？将单个 varchar 转换为 guid 并比较 guid 比将所有 guid 转换为 varchar 更有效，并希望它使用相同的格式（否则无论如何相等都会失败）。

正如其他人指出的那样，该`WHERE`子句看起来很时髦，但我的钱是 varchar 转换是罪魁祸首。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T18:41:22.720

您的存储过程 SQL 似乎有点奇怪，您是否正确复制它？

老实说，这看起来不会编译：

```
WHERE
  CartGUID =@cartGUID

in (Select 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T18:42:49.113

存储过程末尾的 IN 语句是什么？这没有任何意义。摆脱它。此外，在查询和存储过程中为所有表加上“dbo”前缀（谁知道，您的默认模式中可能有同一个表的另一个版本）。做这两件事应该可以解决问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T19:04:06.573

我不认为你在多个模式下有同一张表......

```
dbo.k_ShoppingCart

vs.

user1.k_ShoppingCart 
```

存储过程使用“dbo”，而临时查询使用当前用户引用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-31T19:18:01.913

还有一件事对我来说很奇怪：如果 cartID 是 GUID（和唯一标识符），为什么您的 delete 语句会影响两行？

另外，尝试在 cartID 的定义中添加一个长度，也许一些时髦的默认长度定义会导致输入参数被缩短或填充空白或其他东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-31T19:49:52.940

我解决了。

解决方案：ALTER PROCEDURE [dbo].[k_ShoppingCart_DELETE]

@cartGUID nvarchar **(50)**

# git - 用于 Hudson 结帐问题的 Git 插件

> ID：499316
> 
> 赞同：5
> 
> 时间：2009-01-31T18:43:33.667
> 
> 标签：git, hudson, github

使用 Hudson 的 Git 插件时，从我的在线 git 存储库 (git://github.com/ithena/orm2dsl.git) 获取最新源时，我的工作总是失败。

git 插件首先`git fetch`成功执行。然后它尝试执行`git checkout -f origin/`，失败如下所示。这是[我的 git 存储库](http://github.com/ithena/rose/tree/master)的问题，还是 checkout 命令没有意义？

**作业配置中未设置分支的 Git 命令：**

```
git checkout -f origin/
git checkout: updating paths is incompatible with switching branches/forcing
Did you intend to checkout 'origin/' which can not be resolved as commit? 
```

**在作业配置中将分支设置为 master 的 Git 命令：**

```
git checkout -f origin/master
git checkout: updating paths is incompatible with switching branches/forcing
Did you intend to checkout 'origin/master' which can not be resolved as commit? 
```

**哈德逊控制台输出：**

```
started
Checkout
[workspace] $ git fetch
Checking out origin/
[workspace] $ git checkout -f origin/
git checkout: updating paths is incompatible with switching branches/forcing
Did you intend to checkout 'origin/' which can not be resolved as commit?
FATAL: Error checking out origin/
java.lang.RuntimeException: Error checking out origin/
    at hudson.plugins.git.GitAPI.launch(GitAPI.java:101)
    at hudson.plugins.git.GitAPI.checkout(GitAPI.java:94)
    at hudson.plugins.git.GitSCM.checkout(GitSCM.java:90)
    at hudson.model.AbstractProject.checkout(AbstractProject.java:693)
    at hudson.model.AbstractBuild$AbstractRunner.checkout(AbstractBuild.java:266)
    at hudson.model.AbstractBuild$AbstractRunner.run(AbstractBuild.java:239)
    at hudson.model.Run.run(Run.java:842)
    at hudson.model.Build.run(Build.java:88)
    at hudson.model.ResourceController.execute(ResourceController.java:70)
    at hudson.model.Executor.run(Executor.java:90) 
```

**Hudson 环境：** Debian Etch、Sun JSDK 6、git 1.4.4.4、hudson 最新稳定下载

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T19:39:17.987

首先，您的 Git 版本相当旧。我建议您在执行任何其他操作之前对其进行更新。

第二，`git checkout -f origin/`不是一个有效的命令。您要么需要签出一个分支，要么您可以签出一个提交（通过指定提交哈希或标签）并同时创建一个新分支（使用`git checkout -b new-branch commit-hash`）。有关更多详细信息，请参阅[git-checkout 手册页](http://git-scm.com/docs/git-checkout)。

# c# - 更改绑定到 DataGridView 的 DataTable 中的列顺序不会反映在视图中

> ID：499321
> 
> 赞同：8
> 
> 时间：2009-01-31T18:47:40.493
> 
> 标签：c#, .net, winforms, datagridview, datatable

当应用程序运行时，`DataGridView`绑定到一个`DataTable`. 后来我以编程方式添加更多列`DataTable`，它反映在基础数据中 - 即列序数应该是。然而，这并没有反映在`DataGridView`. 而是将列附加到最初生成的集合上。

这个例子表明，

```
public partial class Form1 : Form
{
    public Form1()
    {
        InitializeComponent();
    }

    public DataTable data = new DataTable();

    private void button1_Click(object sender, EventArgs e)
    {

        this.dataGridView1.DataSource = data;
        for (int i = 0; i < 5; i++)
        {
            this.data.Columns.Add(i.ToString());
        }
    }

    private void button2_Click(object sender, EventArgs e)
    {
        DataColumn foo = new DataColumn();
        this.data.Columns.Add(foo);
        foo.SetOrdinal(0);
    }

    private void button3_Click(object sender, EventArgs e)
    {
        foreach (DataColumn tmpCol in this.data.Columns)
        {
            Console.WriteLine("{0} : {1}", tmpCol.ColumnName, tmpCol.Ordinal);
        }
    }
} 
```

按钮 1 生成列，按钮 2 添加列并将序号设置为 0，因此它应该在网格中排在第一位，按钮 3 显示列的序号并显示它们在`DataTable`.

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-31T18:49:17.727

这就是`DataGridView`工作原理；启用自动生成列后，额外的（未映射的）列将附加到末尾。您可以解绑并重新绑定以修复它；将 DataSource 设置为 null 并返回到表中：

```
this.dataGridView1.DataSource = null;
this.dataGridView1.Columns.Clear();
this.dataGridView1.DataSource = data; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-07-03T10:33:30.390

我遇到了类似的问题，并使用 DataGridViewColumn.DisplayIndex 属性解决了它。

```
dgvData.Columns["COLUMN_NAME"].DisplayIndex = 0;  // will move your custom column to first position 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-10-01T18:34:08.677

不要忘记打开和关闭 AutoColumnCreate 以确保您是 DisplatIndex 的工作。

[http://www.internetworkconsulting.net/content/datadridview-displayorder-not-working](http://www.internetworkconsulting.net/content/datadridview-displayorder-not-working)

# .net - 将 .NET 浮点数据类型映射到 Oracle NUMER(P,S) 列

> ID：499328
> 
> 赞同：4
> 
> 时间：2009-01-31T18:51:47.770
> 
> 标签：.net, oracle

我正在编写的 .NET 应用程序需要将 .NET `float`、`double`和`decimal`数据类型存储在 Oracle 数据库中。在 Oracle 中定义数字列类型时，必须指定数字的精度和小数位数：

**`NUMBER(p,s)`**

**`p`**是精度，或总位数。Oracle 保证数字的可移植性，精度范围为 1 到 38。

**`s`**是比例，或小数点右侧的位数。范围可以从 -84 到 127。

作为一个懒惰的程序员，我松散地使用“程序员”这个标题，我希望其他人已经花时间找出`NUMBER(p,s)`浮点、双精度和十进制 .NET 数据类型的良好默认值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T19:27:31.270

如果您使用的是最新版本的 Oracle，您可能需要考虑改用 BINARY_FLOAT 或 BINARY_DOUBLE（对于 .net 浮点数/双精度数）。它们使用相同的 IEEE 二进制表示，因此在与数据库格式之间进行转换时不会丢失数据。

.NET 十进制的最大精度是 28，因此定义一个精度更高的 Oracle 数字是没有用的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T19:16:39.170

您不必指定精度和比例。如果您不使用它们，Oracle 将允许您指定任何您喜欢的精度和比例。如果您指定它们，那么 oracle 将不允许您超过您指定的比例，并且会舍入超出的精度。

将 (p,s) 视为对数据的编辑检查。通过指定它们，您可以在大小和精度方面限制数据。在内部，它们与 Oracle 相同：NUMBER 列与 NUMBER(p,s) 列的大小相同。

您对 p 和 s 的选择更多地取决于您的应用程序约束。

# python - 从 HTML 链接中提取 URL 的正则表达式

> ID：499345
> 
> 赞同：36
> 
> 时间：2009-01-31T19:02:34.440
> 
> 标签：python, regex

我是 Python 的新手。我正在学习正则表达式，但在这里我需要帮助。

HTML 源代码如下：

```
<a href="http://www.ptop.se" target="_blank">http://www.ptop.se</a> 
```

我正在尝试编写一个只打印出来的工具`http://ptop.se`。你能帮我吗？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-01-31T19:17:06.703

如果您只寻找一个：

```
import re
match = re.search(r'href=[\'"]?([^\'" >]+)', s)
if match:
    print(match.group(1)) 
```

如果您有一个长字符串，并且想要其中的每个模式实例：

```
import re
urls = re.findall(r'href=[\'"]?([^\'" >]+)', s)
print(', '.join(urls)) 
```

`s`您要在其中查找匹配项的字符串在哪里。

*正则表达式位的快速解释：*

> `r'...'`是一个“原始”字符串。它使您不必像往常一样担心转义字符。（`\`尤其是 - 在原始字符串中 a`\`只是 a `\`。在常规字符串中，您`\\`每次都必须这样做，而这在正则表达式中会变*老*。）
> 
> " `href=[\'"]?`" 表示匹配 "href="，可能后跟一个`'`or `"`。“可能”，因为很难说您正在查看的 HTML 有多可怕，而且引号不是严格要求的。
> 
> 将下一位括在“ `()`”中表示使其成为一个“组”，这意味着将其拆分并单独返回给我们。这只是说“这是我感兴趣的模式的一部分”的一种方式。
> 
> " `[^\'" >]+`" 表示匹配任何*不是* `'`, `"`,`>`或空格的字符。本质上，这是作为 URL 结尾的字符列表。它让我们避免尝试编写一个可靠地匹配完整 URL 的正则表达式，这可能有点复杂。

另一个使用 BeautifulSoup 的答案中的建议还不错，但它确实引入了更高级别的外部要求。另外，它对您学习正则表达式的既定目标没有帮助，我假设这个特定的 html 解析项目只是其中的一部分。

这很容易做到：

```
from BeautifulSoup import BeautifulSoup
soup = BeautifulSoup(html_to_parse)
for tag in soup.findAll('a', href=True):
    print(tag['href']) 
```

无论如何，一旦你安装了 BeautifulSoup。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-31T19:13:16.540

不要使用正则表达式，使用[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)。那，或者太粗鲁以至于将其生成到 w3m/lynx 并拉回 w3m/lynx 渲染的内容。第一个可能更优雅，第二个在我不久前写的一些未优化的代码上工作得快了很多。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-01-31T19:16:03.400

这应该可行，尽管可能有更优雅的方式。

```
import re
url='<a href="http://www.ptop.se" target="_blank">http://www.ptop.se</a>'
r = re.compile('(?<=href=").*?(?=")')
r.findall(url) 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-11-27T23:37:54.500

John Gruber（他编写了 Markdown，它由正则表达式组成，并在 Stack Overflow 上使用）尝试生成一个能够识别文本中 URL 的正则表达式：

[http://daringfireball.net/2009/11/liberal_regex_for_matching_urls](http://daringfireball.net/2009/11/liberal_regex_for_matching_urls)

如果您只是想获取 URL（即您并没有真正尝试解析 HTML），这可能比 HTML 解析器更轻量级。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-13T14:38:27.327

正则表达式根本不擅长解析 HTML（请参阅[您能否提供一些示例，说明为什么用正则表达式解析 XML 和 HTML 很困难？](https://stackoverflow.com/questions/701166)为什么）。您需要的是一个 HTML 解析器。请参阅[您能否提供一个使用您最喜欢的解析器解析 HTML 的示例？](https://stackoverflow.com/questions/773340)对于使用各种解析器的示例。

特别是你会想看看 Python 的答案：[BeautifulSoup](https://stackoverflow.com/questions/773340/can-you-provide-an-example-of-parsing-html-with-your-favorite-parser/773565#773565)、[HTMLParser](https://stackoverflow.com/questions/773340/can-you-provide-an-example-of-parsing-html-with-your-favorite-parser/773344#773344)和[lxml](https://stackoverflow.com/questions/773340/can-you-provide-an-example-of-parsing-html-with-your-favorite-parser/774062#774062)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-31T19:34:19.167

[regexlib](http://regexlib.com/default.aspx)上有很多

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-03-08T22:39:44.910

这个正则表达式可以帮助你，你应该通过 \1 或你的语言中的任何方法来获得第一组。

```
href="([^"]*) 
```

例子：

```
<a href="http://www.amghezi.com">amgheziName</a> 
```

结果：

```
http://www.amghezi.com 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-13T14:22:29.177

是的，在[regexlib](http://regexlib.com/)上有很多。这只能证明不应该使用 RE 来做到这一点。使用 SGMLParser 或 BeautifulSoup 或编写解析器 - 但不要使用 RE。似乎工作的那些非常复杂，但仍然不能涵盖所有情况。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-05-20T06:07:46.383

这与使用可选匹配（在 之后打印`href=`）并仅获取链接非常有效。[在http://pythex.org/](http://pythex.org/)上测试

```
(?:href=['"])([:/.A-z?<_&\s=>0-9;-]+) 
```

输出：

> 匹配 1./wiki/Main_Page
> 
> 匹配 2./wiki/Portal:Contents
> 
> 第 3 场比赛。/wiki/Portal:Featured_content
> 
> 第 4 场比赛。/wiki/Portal:Current_events
> 
> 第 5 场比赛。/wiki/Special:随机
> 
> 第 6 场比赛。 //donate.wikimedia.org/wiki/Special:FundraiserRedirector?utm_source=donate&utm_medium=sidebar&utm_campaign=C13_en.wikipedia.org&uselang=en

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2018-04-24T07:50:23.423

你可以使用这个。

```
<a[^>]+href=["'](.*?)["'] 
```

# .net - 使用 Linq 从存储过程中获取单列行集，我该如何清理这个 hack 工作？

> ID：499346
> 
> 赞同：0
> 
> 时间：2009-01-31T19:03:06.170
> 
> 标签：.net, linq, linq-to-sql

我有一个人是编写存储过程的向导，他可以立即将 10 个表压缩成一个列。我很想花几天时间与他一起返回 XML 而不是行集，因为我可以整天消化这些内容而没有任何问题。我这么说是因为获得行集的结果是一项挑战，因为我可以很容易地使用 WCF 向下发送。这是我为完成这项工作所做的黑客行为......

```
public static List<int> GetListOfManagersForRegional(int empId)
    {
        CMSDataContext cms = new CMSDataContext();
        List<cmsManagerList> mgrs = cms.GetRegionalsManagers(empId).ToList();
        List<int> managers = new List<int>();
        foreach (cmsManagerList m in mgrs)
        {
            if(m.ManagerId != null) managers.Add((int)m.ManagerId);
        }
        return managers;
    } 
```

`cmsManagerList`是我在 ORM 中创建的一种类型，它使存储过程可以将其值返回给我可以让 Linq 消化的东西。我真正想做的是直接从存储的过程中获取，它只返回一列到`List<int>`. 有人知道如何更好地做到这一点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T19:07:55.460

尝试这样的事情：

```
public static IEnumerable<int> GetListOfManagersForRegional(int empId) {
    using (var cms = new CMSDataContext()) {
        return
            from m in cms.GetRegionalsManagers(empId)
            where m.ManagerID != null
            select m.ManagerId;             
    }
} 
```

# perl - 有没有带调试功能的免费 Windows Perl IDE？

> ID：499348
> 
> 赞同：18
> 
> 时间：2009-01-31T19:04:36.807
> 
> 标签：perl, debugging, ide

有没有针对 Windows 的免费 Perl IDE，它们具有调试功能、语法高亮，甚至可能是 IntelliSense？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-31T19:47:45.410

[这里](http://www.perlide.org/)有 Perl IDE 的概述。我发现 Padre 很有前途，但我不确定它是否已经具备您需要的所有功能（如果没有，它可能很快就会实现）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-31T19:19:04.267

Eclipse 可能有插件？

看看史诗

[http://www.epic-ide.org/](http://www.epic-ide.org/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-31T19:21:03.157

这不是免费的，但您可以看看 Komodo ( [ActiveState](http://www.activestate.com/komodo/) )。几年前我看到它时，他们正在为开源开发人员提供免费许可证。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-01T00:19:51.493

教士： http: [//padre.perlide.org/](http://padre.perlide.org/)

带有 cperl 模式的 GNU/Emacs：http: [//gnu.org/software/emacs](http://gnu.org/software/emacs)

Emacs 有更好的编辑能力（讽刺的是，Perl 的亮点更好），但 Padre 对你来说可能就足够了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-15T09:14:27.847

[perlfaq3](http://faq.perl.org/perlfaq3.html)列出了几个[适用于 Windows 的 IDE](http://faq.perl.org/perlfaq3.html#Is_there_an_IDE_or_W)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-02T05:26:19.983

我使用[enginsite Perl Editor lite version](http://www.enginsite.com/Download.htm)，主要用于函数，变量分解功能和编译/运行功能。

如果您想要更多功能，那么您可能需要查看完整版本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-15T09:15:00.763

ActiveState 的 Komodo Edit 支持调试并且它是跨平台的。

# winapi - 哪些 api 函数可以在 Windows 中安装文件系统驱动程序？

> ID：499359
> 
> 赞同：4
> 
> 时间：2009-01-31T19:10:57.857
> 
> 标签：winapi, installation, driver

我想在 Windows XP 下为 Ext2 分区安装驱动程序，安装将使用自写的 Inno Setup 脚本完成。我需要为此调用哪些 API 函数？从我到目前为止搜索的内容来看，我似乎不需要 inf 文件，因此不需要调用 SetupCopyOEMInf。但我不知道该怎么做...

请赐教！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-04T12:28:39.647

当您询问安装驱动程序需要哪些 API 函数时，这是我用来在 C 中加载驱动程序的一些代码：

```
bool LoadDriver( const char * cpDriverPath, const char * cpDriverName )
{
    SC_HANDLE hSCService;
    SC_HANDLE hSCManager;

    hSCManager = OpenSCManager( NULL, NULL, SC_MANAGER_ALL_ACCESS );
    if( hSCManager == NULL )
        return false;

    hSCService = CreateService( hSCManager, cpDriverName, cpDriverName,
                                SERVICE_ALL_ACCESS, SERVICE_KERNEL_DRIVER,
                                SERVICE_DEMAND_START, SERVICE_ERROR_NORMAL,
                                cpDriverPath, NULL, NULL, NULL, NULL, NULL );

    if( hSCService == NULL && GetLastError() == ERROR_SERVICE_EXISTS )
        hSCService = OpenService( hSCManager, cpDriverName, SERVICE_ALL_ACCESS );

    if( hSCService == NULL )
        return false;

    if( !StartService( hSCService, 0, NULL ) )
    {
        if( GetLastError() != ERROR_SERVICE_ALREADY_RUNNING )
            return false;
    }

    CloseServiceHandle( hSCManager );
    CloseServiceHandle( hSCService );

    return true;
} 
```

您可能希望对文件系统驱动程序使用 SERVICE_BOOT_START 而不是 SERVICE_DEMAND_START。如果您不能编写 Inno 脚本来执行上述操作，您总是可以从上面制作一个小的 EXE，并让 Inno 作为安装后运行它。

如果你想走 INF 路线，请查看[这篇 Microsoft 文章](http://msdn.microsoft.com/en-us/library/ms790727.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T11:54:25.877

好吧，我找到了更多信息：

[MSDN](http://msdn.microsoft.com/en-us/library/cc462995.aspx)声明“*您应该使用 INF 文件安装文件系统驱动程序”*（通过调用`SetupCopyOEMInf`等），但也指出在 Win2k 和旧系统上，*“文件系统驱动程序通常由服务控制管理器安装”*

我[在 sourceforge](http://sourceforge.net/projects/ext2fsd)找到了另一个带有 Inno Setup 安装脚本的 Ext2 驱动程序。他们只是在`HKLM\SYSTEM\CurrentControlSet\Services\`.

我相信添加这些条目等于使用该工具创建一个服务，该`sc.exe`工具在内部调用`OpenSCManager`和`CreateService`api。我更喜欢注册表方式，因为它更容易，而且我认为使用 api 调用没有任何优势，因为总是需要重新启动。

所以我最终得到了这个解决方案：

```
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\YourService]
"ErrorControl"=dword:00000001
"Start"=dword:00000003
"Type"=dword:00000001
"DisplayName"="YourServiceDisplayName"
"ImagePath"="System32\Drivers\YourService.sys" 
```

当然，根据相关驱动程序的具体情况，`Parameters`可能需要在子项中添加更多条目。

我仍然希望有人能够对这个问题有更多的了解，特别是关于如何使用 inf 文件进行安装的一些细节，因为这是 MS 推荐的方式。

来吧，伙计们！这里有一个不错的赏金！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T02:26:36.647

有很多方法可以解决这个问题。

1/ 查看产品是否有静默安装模式（例如，使用配置文件进行安装）。然后，您只需将其合并到您自己的安装中。

2/ 有一些程序可以模拟用户，例如 Rational Robot（我不建议这样做，因为它是商业的，但周围可能有免费的）。我们主要将它们用于图形应用程序的自动化测试，但它们也可以很容易地使用它来运行安装程序。

3/ 联系开发人员以查看实际安装过程需要什么，然后复制它。

4/ 微软有许多系统工具（这里）可以跟踪对文件系统、注册表等的更改。您可以使用它们对安装过程进行逆向工程，并在您自己的安装中执行相同的操作。

就个人而言，我会先选择3号。开发人员会很高兴知道他们的产品正在被使用，并且可以很容易地提供信息。他们甚至可能为您编写一个静默安装程序，因为这将是他们的产品在企业环境中的一个额外卖点（向他们建议）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-29T06:47:56.850

我写了一个 TDI 过滤器驱动程序。

当我开始编写 .inf 文件时，我花了两个星期的痛苦才让某些东西起作用，但我仍然没有真正理解它，因为它没有真正的意义；你必须做的似乎很武断。当我尝试使用 INF 文件时，它们几乎完全没有文档记录，而且异常复杂。

# c++ - 将字符串或 char* 放入 istream 的最佳方法？

> ID：499381
> 
> 赞同：28
> 
> 时间：2009-01-31T19:23:28.423
> 
> 标签：c++, stream

将字符串或 char* 指针放入 istream 的最佳方法是什么？

我想做以下

```
std::string a = "abc..";

//I know this can be done, not sure if this is most efficient
// and not sure about char*    pointers
std::istringstream istr (a);
...
foo (istr); 

void foo(std::istream& is) {

} 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-31T19:51:13.750

如果你想从中构造一个 istringstream，一个 char* 到空字符，或者来自 std::string 的所有东西：

```
istringstream str(ptr); // char*
istringstream str(other_str); // std::string 
```

如果您谈论想要一个指向 istream 缓冲区的原始指针，您就不能这样做。如果流从文件、终端或其他地方需要它们，则可以按需获取它们的数据，可以选择缓冲它们的东西（嗯，不完全正确。您可以使用 a `strstream`，它接受原始指针并直接从中读取/写入。但它是一个已弃用的类 - 不要使用它。我很幸运我从未这样做过）。如果你想要的只是你可以使用有点像指针的东西，你可以使用 streambuf 迭代器。它们不是真正的指针，所以你不能减去`end`和`begin`其他东西：

```
std::istreambuf_iterator<char> begin(one_istream), end;
while(begin != end)
    std::cout << *begin++; 
```

如果您谈论从写入字符串流的内容中获取字符串，您可以使用`ostringstream::str`：

```
ostringstream o;
o << "This is a number: " << 42;
std::string str = o.str(); // str == "This is a number: 42" 
```

否则，您通常只能*从*`istream`. 你需要一个`ostream`，然后你可以做

```
stream.write(ptr, N);
stream.write(ptr.c_str(), ptr.c_str() + ptr.size()); 
```

从 str 指向的字节中准确写入 N 个字符。您也可以使用将其写入流中`<<`。它会将所有内容写入空字符或 std::string 中的所有内容，但会尊重格式标志，例如字段宽度：

```
stream << ptr; // char*
stream << other_str; // everything from std::string 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-01-31T19:43:56.120

这将起作用：

```
 std::istringstream is("abc..."); 
```

由于 istringstream 是 istream，您将能够将您的 is 对象用作 istream。

# flash - 在 actionscript 3 中添加事件之前检查组件初始化

> ID：499385
> 
> 赞同：0
> 
> 时间：2009-01-31T19:26:00.290
> 
> 标签：flash, actionscript-3, events

如何`isInitilazed`在 actionscript 3 中添加事件（释放或单击）之前检查组件（移动剪辑或按钮）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T16:45:41.657

我可以问一下你想要做什么，更笼统地说？

如果您只是想避免空引用错误，只需检查您正在使用的引用（变量）`null`：

```
if (_myComponent != null)
{
    // add listeners
} 
```

如果出于其他原因您确实需要在执行此操作之前知道组件是否已初始化，则需要它为此调度某种事件（Flex 的`UIComponents`调度`FlexEvent.INITIALIZE`事件，但我假设您没有使用 Flex）或设置一个“已初始化”属性，我不太确定标准 Flash 组件是否会这样做（我正在查看[文档](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/fl/controls/Button.html)[以`Button`](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/fl/controls/Button.html)供参考。）您当然可以为您自己使用的任何组件创建一个自定义子类实现一个`initialized`属性，但我不确定如何为任何标准 Flash 组件实现它。我也不太清楚你在这种情况下所说的“初始化”是什么意思:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-29T15:05:37.213

也许是这样的？

```
if (mcWithComponents.stage) doStuff();
mcWithComponents.addEventListener(Event.ADDED_TO_STAGE, doStuff);

private function doStuff(e:Event = null):void
{
    mcWithComponents.myButton.addEventListener(MouseEvent.CLICK, buttonClicked);
} 
```

或者直接在movieclip的类中添加监听器。

```
public function mcWithComponents() // constructor
{
    if (stage) init();
    addEventListener(Event.ADDED_TO_STAGE, init);
}
private function init(e:Event = null):void
{
  myButton.addEventListener(MouseEvent.CLICK, buttonClicked);
} 
```

# .net - 仅使用日期时间格式获取小写日期时间的 AM/PM

> ID：499393
> 
> 赞同：53
> 
> 时间：2009-01-31T19:31:02.323
> 
> 标签：.net, datetime, string-formatting

我要获得一个自定义的 DateTime 格式，包括 AM/PM 指示符，但我希望“AM”或“PM”为小写*，而不*使其余字符小写。

这是否可以使用单一格式而不使用正则表达式？

这是我现在得到的：

```
item.PostedOn.ToString("dddd, MMMM d, yyyy a\\t h:mmtt") 
```

现在的输出示例是**2009 年 1 月 31 日星期六下午 1:34**

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-01-31T19:39:40.403

我个人会将其格式化为两部分：非 am/pm 部分和带有 ToLower 的 am/pm 部分：

```
string formatted = item.PostedOn.ToString("dddd, MMMM d, yyyy a\\t h:mm") +
                   item.PostedOn.ToString("tt").ToLower(); 
```

另一个选项（我将在几秒钟内研究）是获取当前的 DateTimeFormatInfo，创建一个副本，并将 am/pm 指示符设置为小写版本。然后将该格式信息用于正常格式。您显然想要缓存 DateTimeFormatInfo...

编辑：尽管有我的评论，我还是写了缓存位。它可能不会比上面的代码*快*（因为它涉及锁和字典查找），但它确实使调用代码更简单：

```
string formatted = item.PostedOn.ToString("dddd, MMMM d, yyyy a\\t h:mmtt",
                                          GetLowerCaseInfo()); 
```

这是一个完整的程序来演示：

```
using System;
using System.Collections.Generic;
using System.Globalization;

public class Test
{
    static void Main()
    {
        Console.WriteLine(DateTime.Now.ToString("dddd, MMMM d, yyyy a\\t h:mmtt",
                                                GetLowerCaseInfo());
    }

    private static readonly Dictionary<DateTimeFormatInfo,DateTimeFormatInfo> cache =
        new Dictionary<DateTimeFormatInfo,DateTimeFormatInfo>();

    private static object cacheLock = new object();

    public static DateTimeFormatInfo GetLowerCaseInfo()
    {
        DateTimeFormatInfo current = CultureInfo.CurrentCulture.DateTimeFormat;
        lock (cacheLock)
        {
            DateTimeFormatInfo ret;
            if (!cache.TryGetValue(current, out ret))
            {
                ret = (DateTimeFormatInfo) current.Clone();
                ret.AMDesignator = ret.AMDesignator.ToLower();
                ret.PMDesignator = ret.PMDesignator.ToLower();
                cache[current] = ret;
            }
            return ret;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-31T19:49:44.440

您可以将格式字符串分成两部分，然后将 AM/PM 部分小写，如下所示：

```
DateTime now = DateTime.Now;
string nowString = now.ToString("dddd, MMMM d, yyyy a\\t h:mm");
nowString = nowString + now.ToString("tt").ToLower(); 
```

但是，我认为更优雅的解决方案是使用您构造的[`DateTimeFormatInfo`实例](http://msdn.microsoft.com/en-us/library/system.globalization.datetimeformatinfo.aspx)[`AMDesignator`](http://msdn.microsoft.com/en-us/library/system.globalization.datetimeformatinfo.amdesignator.aspx)并将and[`PMDesignator`](http://msdn.microsoft.com/en-us/library/system.globalization.datetimeformatinfo.pmdesignator.aspx)属性分别替换为“am”和“pm”：

```
DateTimeFormatInfo fi = new DateTimeFormatInfo();

fi.AMDesignator = "am";
fi.PMDesignator = "pm";

string nowString = now.ToString("dddd, MMMM d, yyyy a\\t h:mmtt", fi); 
```

您可以使用该实例自定义将 a 转换为 a 的`DateTimeFormatInfo`许多其他方面。`DateTime``string`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T19:33:35.407

**编辑**：乔恩的例子要好得多，虽然我认为扩展方法仍然是要走的路，所以你不必到处重复代码。我已经删除了替换并在扩展方法中替换了 Jon 的第一个示例。我的应用程序通常是 Intranet 应用程序，我不必担心非美国文化。

添加扩展方法来为您执行此操作。

```
public static class DateTimeExtensions
{
    public static string MyDateFormat( this DateTime dateTime )
    {
       return dateTime.ToString("dddd, MMMM d, yyyy a\\t h:mm") +
              dateTime.ToString("tt").ToLower();
    }
}

...

item.PostedOn.MyDateFormat(); 
```

**编辑：关于如何**[在 C# 中格式化日期时间（如“2008 年 10 月 10 日 10:43am CST”）中](https://stackoverflow.com/questions/448634/how-to-format-a-datetime-like-oct-10-2008-1043am-cst-in-c)有关如何执行此操作的其他想法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-19T18:47:37.780

上述方法的问题在于，您使用格式字符串的主要原因是启用本地化，而到目前为止给出的方法对于不希望包含最终 am 或 pm 的任何国家或文化都将失效。所以我所做的是写出一个扩展方法，它可以理解一个额外的格式序列“TT”，它表示小写的 am/pm。以下代码针对我的情况进行了调试，但可能还不完美：

```
 /// <summary>
    /// Converts the value of the current System.DateTime object to its equivalent string representation using the specified format.  The format has extensions over C#s ordinary format string
    /// </summary>
    /// <param name="dt">this DateTime object</param>
    /// <param name="formatex">A DateTime format string, with special new abilities, such as TT being a lowercase version of 'tt'</param>
    /// <returns>A string representation of value of the current System.DateTime object as specified by format.</returns>
    public static string ToStringEx(this DateTime dt, string formatex)
    {
        string ret;
        if (!String.IsNullOrEmpty(formatex))
        {
            ret = "";
            string[] formatParts = formatex.Split(new[] { "TT" }, StringSplitOptions.None);
            for (int i = 0; i < formatParts.Length; i++)
            {
                if (i > 0)
                {
                    //since 'TT' is being used as the seperator sequence, insert lowercase AM or PM as appropriate
                    ret += dt.ToString("tt").ToLower();
                }
                string formatPart = formatParts[i];
                if (!String.IsNullOrEmpty(formatPart))
                {
                    ret += dt.ToString(formatPart);
                }
            }
        }
        else
        {
            ret = dt.ToString(formatex);
        }
        return ret;
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-03-14T21:54:58.677

这应该是所有这些选项中性能最高的。但太糟糕了，他们不能在 DateTime 格式的小写选项中工作（tt 与 TT 相反？）。

```
 public static string AmPm(this DateTime dt, bool lower = true)
    {
        return dt.Hour < 12 
            ? (lower ? "am" : "AM")
            : (lower ? "pm" : "PM");
    } 
```

# objective-c - iPhone SDK：按顺序记录按钮的时间以进行播放

> ID：499401
> 
> 赞同：0
> 
> 时间：2009-01-31T19:35:08.430
> 
> 标签：objective-c, core-audio, sequences

我正在开发一个应用程序，您可以在其中按下按钮以使用系统哔声播放声音。

我没有记录输出，而是考虑记录按下按钮的时间，所以当用户按下“播放”按钮时，按钮的按下时间与用户按下按钮的时间相同，所以它的作用就像iPhone 已经录制了声音，但它只是按顺序播放。我希望一旦用户按下记录按钮就会发生这种情况。

例子：

1.  用户按下记录
2.  计时开始
3.  > 记录每个按钮按下的时间和时间

4.  按下按钮后计时停止
5.  播放按钮播放事件序列

任何人都可以就编码、要阅读的文档等提供任何想法吗？

非常感谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-01T06:03:27.070

[http://pastie.org/376474](http://pastie.org/376474)

这应该希望能帮助你一点。它本质上是有效的，虽然我没有实际测试过，所以我不肯定它有效。我假设您可以通读它并找到一种方法将其放入您自己的代码中。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T07:29:24.807

许多系统时间方法都有一种方法可以从纪元开始以秒为单位获取值。根据系统时钟的粒度，您可以只获取按下开始按钮的系统时间，然后在按下每个按钮时再次获取时间。要计算时间，只需从按钮按下时间中减去开始时间。

# mysql - 删除每列前附加的 "

> ID：499403
> 
> 赞同：1
> 
> 时间：2009-01-31T19:36:24.280
> 
> 标签：mysql

我找到了一个 Cities/ZIP/GPS 的 CSV 数据库，当我导入它时，它在列的前面添加了一个“。 [替代文本 http://www.grabup.com/uploads/58754a865eebd94c9aafaf7444b52d15.png?direct](http://www.grabup.com/uploads/58754a865eebd94c9aafaf7444b52d15.png?direct)
我没有想要输入 33,000 个条目并手动执行此操作，是否可以运行一个查询来删除引号？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T19:49:19.777

我不是 MySql 专家，但这应该可行：（基于我在 Sql Server 中的类似经验）

更新表名 SET col_name = REPLACE(col_name, '"', '')

有关 REPLACE 和其他字符串解析函数的更多信息，请参见此处： [http ://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_replace](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_replace)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T19:40:46.627

在 sql server 你可以做：

```
update mytable set state= substring(state,2,29) 
```

将“29”更改为实际长度。

我确信 mysql 必须具有等效的语法。

对每个字段重复，看起来只有少数几个。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-31T19:47:45.940

作为替代方案，您可以过滤原始 csv 文档 - 这不是更容易吗？

# javascript - 使用 jQuery 更改下拉列表的选定值

> ID：499405
> 
> 赞同：908
> 
> 时间：2009-01-31T19:39:01.823
> 
> 标签：javascript, jquery, asp.net, html-select

我有一个已知值的下拉列表。我想要做的是将下拉列表设置为我知道使用**jQuery**存在的特定值。使用常规**JavaScript**，我会做类似的事情：

```
ddl = document.getElementById("ID of element goes here");
ddl.value = 2; // 2 being the value I want to set it too. 
```

但是，我需要使用**jQuery**来执行此操作，因为我正在为我的选择器使用**CSS**类（愚蠢的[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)客户端 ID ...）。

以下是我尝试过的几件事：

```
$("._statusDDL").val(2); // Doesn't find 2 as a value.
$("._statusDDL").children("option").val(2) // Also failed. 
```

> 我怎么能用**jQuery**做到这一点？

* * *

**更新**

事实证明，我第一次做对了：

```
$("._statusDDL").val(2); 
```

当我在它上面放一个警报时它工作正常，但是当我删除警报并让它全速运行时，我得到了错误

> 无法设置选定的属性。无效索引

我不确定这是 jQuery 还是**Internet Explorer 6**的错误（我猜是 Internet **Explorer 6**），但这非常烦人。

* * *

## 回答 #1

> 赞同：1071
> 
> 时间：2009-01-31T19:43:42.750

[jQuery 的文档](http://docs.jquery.com/Attributes/val#val)指出：

> [jQuery.val] 检查或***选择***与一组值匹配的所有单选按钮、复选框和选择选项。

此行为在`jQuery`版本`1.2`及更高版本中。

你很可能想要这个：

```
$("._statusDDL").val('2'); 
```

* * *

## 回答 #2

> 赞同：154
> 
> 时间：2012-10-09T10:21:54.843

使用隐藏字段，您需要像这样使用：

```
$("._statusDDL").val(2);
$("._statusDDL").change(); 
```

或者

```
$("._statusDDL").val(2).change(); 
```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-04-21T02:16:22.783

仅供参考，您不需要使用 CSS 类来完成此操作。

您可以编写以下代码行来获取客户端上的正确控件名称：

```
$("#<%= statusDDL.ClientID %>").val("2"); 
```

ASP.NET 将在 jQuery 中正确呈现控件 ID。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2013-03-07T11:51:58.080

这些解决方案似乎假设下拉列表中的每个项目都有一个与其在下拉列表中的位置相关的**val()值。**

如果不是这种情况，事情会稍微复杂一些。

要**读取**下拉列表的选定索引，您可以使用：

```
$("#dropDownList").prop("selectedIndex"); 
```

要**设置**下拉列表的选定索引，您可以使用：

```
$("#dropDownList").prop("selectedIndex", 1); 
```

请注意，**prop()**功能需要 JQuery v1.6 或更高版本。

让我们看看如何使用这两个函数。

假设您有一个月份名称的下拉列表。

```
<select id="listOfMonths">
  <option id="JAN">January</option>
  <option id="FEB">February</option>
  <option id="MAR">March</option>
</select> 
```

您可以添加“上个月”和“下个月”按钮，查看当前选择的下拉列表项，并将其更改为上/下个月：

```
<button id="btnPrevMonth" title="Prev" onclick="btnPrevMonth_Click();return false;" />
<button id="btnNextMonth" title="Next" onclick="btnNextMonth_Click();return false;" /> 
```

这是这些按钮将运行的 JavaScript：

```
function btnPrevMonth_Click() {
    var selectedIndex = $("#listOfMonths").prop("selectedIndex");
    if (selectedIndex > 0) {
        $("#listOfMonths").prop("selectedIndex", selectedIndex - 1);
    }
}
function btnNextMonth_Click() {
    //  Note:  the JQuery "prop" function requires JQuery v1.6 or later
    var selectedIndex = $("#listOfMonths").prop("selectedIndex");
    var itemsInDropDownList = $("#listOfMonths option").length;

    //  If we're not already selecting the last item in the drop down list, then increment the SelectedIndex
    if (selectedIndex < (itemsInDropDownList - 1)) {
        $("#listOfMonths").prop("selectedIndex", selectedIndex + 1);
    }
} 
```

我的网站对于展示如何使用 JSON 数据填充下拉列表也很有用：

[http://mikesknowledgebase.com/pages/Services/WebServices-Page8.htm](http://mikesknowledgebase.com/pages/Services/WebServices-Page8.htm)

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2009-02-01T11:45:06.820

试试看

```
$("._statusDDL").val("2"); 
```

而不是

```
$("._statusDDL").val(2); 
```

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2012-05-17T17:24:26.007

在查看了一些解决方案之后，这对我有用。

我有一个包含一些值的下拉列表，我想从另一个下拉列表中选择相同的值...所以首先我放入第一个下拉列表的变量`selectIndex`。

```
var indiceDatos = $('#myidddl')[0].selectedIndex; 
```

然后，我在第二个下拉列表中选择该索引。

```
$('#myidddl2')[0].selectedIndex = indiceDatos; 
```

**笔记：**

我想这是最短、可靠、通用和优雅的解决方案。

因为就我而言，我使用的是选定选项的数据属性而不是值属性。因此，如果您对每个选项都没有独特的价值，那么上述方法是最短的和甜蜜的！

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2015-02-11T07:52:29.367

我知道这是一个老问题，除某些情况外，上述解决方案都可以正常工作。

像

```
<select id="select_selector">
<option value="1">Item1</option>
<option value="2">Item2</option>
<option value="3">Item3</option>
<option value="4" selected="selected">Item4</option>
<option value="5">Item5</option>
</select> 
```

所以项目 4 将在浏览器中显示为“已选择”，现在您要将值更改为 3 并将“项目 3”显示为已选择而不是项目 4。所以按照上述解决方案，如果您使用

```
jQuery("#select_selector").val(3); 
```

您会在浏览器中看到第 3 项被选中。但是当您在 php 或 asp 中处理数据时，您会发现所选值为“4”。原因是，您的 html 将如下所示。

```
<select id="select_selector">
<option value="1">Item1</option>
<option value="2">Item2</option>
<option value="3" selected="selected">Item3</option>
<option value="4" selected="selected">Item4</option>
<option value="5">Item5</option>
</select> 
```

它在服务器端语言中获得最后一个值为“4”。

所以我在这方面的最终解决方案

```
newselectedIndex = 3;
jQuery("#select_selector option:selected").removeAttr("selected");
jQuery("#select_selector option[value='"+newselectedIndex +"']").attr('selected', 'selected'); 
```

**编辑**：在 "+newselectedIndex+" 周围添加单引号，以便可以将相同的功能用于非数值。

所以我实际上是删除了选定的属性，然后将新属性设为选定。

我很感谢@strager、@y0mbo、@ISIK 等高级程序员对此的评论

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2015-09-18T19:51:40.140

如果我们有一个标题为“数据分类”的下拉菜单：

```
<select title="Data Classification">
    <option value="Top Secret">Top Secret</option>
    <option value="Secret">Secret</option>
    <option value="Confidential">Confidential</option>
</select> 
```

我们可以把它变成一个变量：

```
var dataClsField = $('select[title="Data Classification"]'); 
```

然后将我们希望下拉列表具有的值放入另一个变量中：

```
var myValue = "Top Secret";  // this would have been "2" in your example 
```

然后我们可以使用我们放入的字段`dataClsField`，查找`myValue`并使用`.prop()`：

```
dataClsField.find('option[value="'+ myValue +'"]').prop('selected', 'selected'); 
```

或者，您可以只使用`.val()`，但您的选择器`.`只有在它与下拉列表中的类匹配时才能使用，并且您应该在括号内的值上使用引号，或者只使用我们之前设置的变量：

```
dataClsField.val(myValue); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-06-21T04:59:23.773

> 所以我改变了它，现在它使用 setTimeout 在 300 毫秒后执行。似乎现在正在工作。

从 Ajax 调用加载数据时，我曾多次遇到这种情况。我也使用 .NET，使用 jQuery 选择器时需要时间来适应 clientId。要纠正您遇到的问题并避免添加`setTimeout`属性，您可以简单地将“ `async: false`”放在 Ajax 调用中，它会给 DOM 足够的时间来将您添加到选择中的对象返回。下面是一个小样本：

```
$.ajax({
    type: "POST",
    url: document.URL + '/PageList',
    data: "{}",
    async: false,
    contentType: "application/json; charset=utf-8",
    dataType: "json",
    success: function (response) {
        var pages = (typeof response.d) == 'string' ? eval('(' + response.d + ')') : response.d;

        $('#locPage' + locId).find('option').remove();

        $.each(pages, function () {
            $('#locPage' + locId).append(
                $('<option></option>').val(this.PageId).html(this.Name)
            );
        });
    }
}); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-03-29T20:07:22.970

请注意——我一直在 jQuery 中使用通配符选择器来获取被 ASP.NET 客户端 ID 混淆的项目——这也可能对您有所帮助：

```
<asp:DropDownList id="MyDropDown" runat="server" />

$("[id* = 'MyDropDown']").append("<option value='-1'>&nbsp;</option>"); //etc 
```

请注意 id* 通配符 - 即使名称为“ctl00$ctl00$ContentPlaceHolder1$ContentPlaceHolder1$MyDropDown”，它也会找到您的元素

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-10-07T20:25:53.630

```
<asp:DropDownList id="MyDropDown" runat="server" /> 
```

使用`$("select[name$='MyDropDown']").val()`.

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-04-07T02:05:17.553

我使用扩展函数来获取客户端 ID，如下所示：

```
$.extend({
    clientID: function(id) {
        return $("[id$='" + id + "']");
    }
}); 
```

然后你可以像这样在 jQuery 中调用 ASP.NET 控件：

```
$.clientID("_statusDDL") 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-03-12T15:05:42.750

另一种选择是在.net 中设置控制参数ClientID="Static"，然后您可以通过您设置的ID 访问JQuery 中的对象。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-02-01T12:12:01.587

您如何将值加载到下拉列表中或确定选择哪个值？如果您使用 Ajax 执行此操作，那么在选择发生之前需要延迟的原因可能是因为在相关行执行时未加载值。这也可以解释为什么在设置状态之前将警报语句放在行上时它会起作用，因为警报操作会给数据加载提供足够的延迟。

如果您使用 jQuery 的 Ajax 方法之一，您可以指定一个回调函数，然后放入`$("._statusDDL").val(2);`您的回调函数中。

这将是一种更可靠的处理问题的方法，因为您可以确定该方法在数据准备好时执行，即使它花费的时间超过 300 毫秒。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-01-05T06:34:42.740

```
<asp:DropDownList ID="DropUserType" ClientIDMode="Static" runat="server">
     <asp:ListItem Value="1" Text="aaa"></asp:ListItem>
     <asp:ListItem Value="2" Text="bbb"></asp:ListItem>
</asp:DropDownList> 
```

**ClientIDMode="静态"**

```
$('#DropUserType').val('1'); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-09-18T18:10:55.483

就我而言，我能够使用 .attr() 方法让它工作。

```
$("._statusDDL").attr("selected", ""); 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-06-26T20:06:19.927

# 纯JS

对于[现代浏览器](https://caniuse.com/#search=querySelector)，使用 CSS 选择器对于纯 JS 来说不是问题

```
document.querySelector('._statusDDL').value = 2; 
```

```
function change() {
  document.querySelector('._statusDDL').value = 2;
}
```

```
<select class="_statusDDL">
  <option value="1" selected>A</option>
  <option value="2">B</option>
  <option value="3">C</option>
</select>

<button onclick="change()">Change</button>
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-12-20T05:14:42.510

> 如果我们想从选项名称中查找，然后使用 jQuery 选择选项，请参见下面的代码：-

```
<div class="control">
           <select name="country_id" id="country" class="required-entry" title="Country" data-validate="{'validate-select':true}" aria-required="true">
              <option value=""> </option>
              <option value="SA">Saudi Arabia</option>
              <option value="AF">Afghanistan</option>
              <option value="AR">Argentina</option>
              <option value="AM">Armenia</option>
              <option value="AW">Aruba</option>
              <option value="AU">Australia</option>
              <option value="AT">Austria</option>
              <option value="IS">Iceland</option>
              <option value="IN">India</option>
              <option value="ID">Indonesia</option>
              <option value="IR">Iran</option>
              <option value="IQ">Iraq</option>
              <option value="IE">Ireland</option>
              <option value="IM">Isle of Man</option>
              <option value="IL">Israel</option>
              <option value="IT">Italy</option>
              <option value="JM">Jamaica</option>
              <option value="JP">Japan</option>
              <option value="JE">Jersey</option>
              <option value="JO">Jordan</option>
              <option value="AE">United Arab Emirates</option>
              <option value="GB">United Kingdom</option>
              <option value="US" selected="selected">United States</option>
           </select>
        </div>
<script type='text/javascript'>
let countryRegion="India";
     jQuery("#country option:selected").removeAttr("selected");
        let cValue= jQuery("#country option:contains("+countryRegion+")").val();
        jQuery("#country option[value='"+cValue +"']").attr('selected', 'selected');
</script> 
```

> 我希望这个能帮上忙！

# sql - SQL：您使用什么来在数据库中存储比率（百分比）？

> ID：499411
> 
> 赞同：2
> 
> 时间：2009-01-31T19:42:52.330
> 
> 标签：sql, sql-server-2005, types

我应该使用小数还是浮点数将比率存储在数据库中？特别是在 SQL2005 中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-31T19:52:48.473

这取决于您对准确性的需求。如果您可以容忍来自 IEEE 存储浮点数方法的典型错误，请使用浮点数，否则，如果您需要精确表示，请使用小数（并且适用于您将使用的任何非整数的数字在使用百分比的计算中也是如此）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T21:22:45.797

这取决于你的比例是多少，真的。

对于利率，例如，在银行业务中，我们总是使用小数，其精度和规模由业务决定。如果要计算利率并且结果超出列的精度，那么总会有一个业务规则定义如何对结果进行四舍五入或截断以适合列。

例如，如果您的比率是物体直径与其周长之间的比率，我可能会使用浮点数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T12:02:36.817

取决于您的应用程序。如果您已经使用浮点数来计算与该比率有关的所有内容，则将其存储为浮点数可能是有意义的。

但除此之外，浮点数通常有点数据库的味道。数据库管理员不喜欢它们，因为不断增加的不准确性意味着浮点数本质上是不一致的。这违反了我们心爱的[ACID](http://en.wikipedia.org/wiki/ACID)中的“一致性” 。

小数和缩放整数至少表现可预测。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T19:52:51.080

取决于你想要它有多精确。如果您需要 1 或 2 位数字，并且您知道最大比率将低于 maxint/1000，我会考虑将比率乘以 100 存储在 int 中。如果您需要精确的数字，您甚至可能希望将分子和分母存储为单独的整数。否则，坚持浮动或双打。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T20:07:32.063

我从不在数据库中使用浮点数，也许这是技术已经解决的一个旧习惯，我不是 100% 确定。

整数、缩放整数或小数。有时舍入误差看起来微不足道，但它可能会导致某些值的匹配失败或引入累积误差。

# svn - 如何让 Subversion 只保留文件的最新版本？

> ID：499417
> 
> 赞同：13
> 
> 时间：2009-01-31T19:45:28.567
> 
> 标签：svn, version-control

我的存储库中有一个不可文本合并的大文件，并且我不需要多版本控制（例如 PPT）。我想将它保存在存储库中以进行备份并与多人共享，但我不希望存储库大小变得巨大，因为它每次更改时都会保留文件的副本。有没有办法为 Subversion 存储库中的文件指定此行为？

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-31T19:51:28.803

这在 Subversion 中是不可能的。但是：subversion 将此文件的更改作为二进制差异保存在存储库中，因此根据您所做的更改类型，它不会消耗大量额外空间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T20:16:50.873

你不能。Subversion 旨在保留不同版本的文件。毕竟，这是一个版本控制系统。

也许只是不要把它放在颠覆中，而是使用[rsync](http://samba.anu.edu.au/rsync/)备份或共享它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T20:04:23.303

你不能——而且是正确的。

如果文件未更改，则仅存储一个版本。如果文件确实发生了变化，那么使用任何形式的版本控制肯定是为了让您可以检索更早的版本。现在看起来您可能永远不想这样做，但很有可能在将来的某个时候您会想要检索它。

如果空间有问题，请获得更大的磁盘或升级您的计划。从长远来看，这将是值得的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T20:15:05.807

另一种方法可能是存储符号链接，然后将文件托管在网络共享上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T20:18:42.913

您可能使用了错误的工具来完成这项工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-17T05:52:36.447

我不敢相信我这么说，但 MS Visual Source Safe 有这个功能。但是，由于太多的原因，我不建议使用 MS-VSS。主要的两个是不稳定问题，因为几乎不可能使用分支（官方有这个选项，但实际上，它不能很好地工作）。

# algorithm - 为什么有效加密需要大量随机性？

> ID：499418
> 
> 赞同：6
> 
> 时间：2009-01-31T19:45:57.083
> 
> 标签：algorithm, encryption

我在很多地方都看到过，随机性对于生成对称和非对称密码学的密钥以及使用密钥加密消息很重要。

如果没有足够的随机性，有人可以解释如何损害安全性吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-31T19:48:08.013

随机性意味着不可猜测的输入。如果输入是可猜测的，那么输出可以很容易地计算出来。那很不好。

例如，Debian 在其 SSL 实现中存在一个长期存在的错误，即在创建密钥时未能收集足够的随机性。这导致软件生成了仅有的 32k 个可能的密钥之一。因此，通过尝试所有 32k 可能性，可以轻松地解密使用这种密钥加密的任何内容，考虑到当今的处理器速度，这非常快。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-31T20:07:57.193

大多数加密操作的重要特征是，如果您拥有正确的信息（例如密钥），它们很容易执行，如果您没有该信息，则无法执行。

例如，对称密码学：如果你有密钥，加密和解密很容易。如果您没有密钥（并且对它的构造一无所知），那么您必须着手进行一些昂贵的事情，例如对密钥空间进行详尽的搜索，或者对密码进行更有效的密码分析，这仍然需要一些非常大量样本。

另一方面，如果您有任何关于密钥可能值的信息，那么您对密钥空间的详尽搜索会容易得多（或者密码分析所需的样本数量要少得多）。例如，（目前）执行 2^128 次试用解密来发现 128 位密钥实际上是不可行的。如果您知道关键材料来自您知道的十亿滴答声内的时间值，那么您的搜索就会变得容易 340282366920938463463374607431 倍。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-31T19:59:49.410

要解密消息，您需要知道正确的密钥。

您必须尝试的密钥越多，解密消息的难度就越大。

举一个极端的例子，假设根本没有随机性。当我生成用于加密消息的密钥时，我*总是*会得到完全相同的密钥。无论我在何时何地运行 keygen 程序，它总是会给我相同的密钥。

这意味着任何有权访问我用来生成密钥的程序的人都可以轻松解密我的消息。毕竟，他们只需要要求它也生成一个密钥，并且他们得到一个与我使用的相同的密钥。

所以我们需要一些随机性来让它无法预测你最终使用哪个密钥。正如 David Schmitt 提到的，Debian 有一个错误，它只生成少量唯一密钥，这意味着要解密由 Debian 上的默认 OpenSSL 实现加密的消息，我只需要尝试这个数量较少的可能密钥。我可以忽略大量其他有效密钥，因为 Debian 的 SSL 实现永远不会生成这些。

另一方面，如果密钥生成中有足够的随机性，就不可能猜测密钥的*任何*内容。您必须尝试所有可能的位模式。（对于 128 位密钥，有很多组合。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T20:20:31.007

它与密码学的一些基本原因有关：

*   确保消息在传输过程中未被更改（不可变）
*   确保邮件在传输过程中未被阅读（安全）
*   确保消息来自它所说的来自谁（真实）
*   确保消息与之前发送的消息不同（无重播）
*   ETC

那么，您需要包括一些内容，以确保上述内容属实。重要的事情之一是随机值。

例如，如果我用密钥加密“太多秘密”，它可能会出现“dWua3hTOeVzO2d9w”

这有两个问题——攻击者可能更容易破解加密，因为我使用的字符集非常有限。此外，如果我再次发送相同的消息，它将完全一样。最后，攻击者可以记录它，然后再次发送消息，即使攻击者没有破坏它，收件人也不会知道我没有发送它。

如果我每次加密时都在字符串中添加一些随机垃圾，那么不仅会使其更难破解，而且每次加密的消息都不一样。

上述项目符号中的其他密码学特性是使用随机性以外的方法（种子值、双向身份验证等）修复的，但随机性可以解决一些问题，并有助于解决其他问题。

一个不好的随机性来源会再次限制字符集，因此它更容易被破解，如果它很容易猜测，或者受到限制，那么攻击者在进行暴力攻击时可以尝试的路径更少。

-亚当

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-31T20:20:56.403

密码学中的一个常见模式如下（从 alice 向 bob 发送文本）：

```
Take plaintext p
Generate random k
Encrypt p with k using symmetric encryption, producing crypttext c
Encrypt k with bob's private key, using asymmetric encryption, producing x
Send c+x to bob
Bob reverses the processes, decrypting x using his private key to obtain k 
```

这种模式的原因是对称加密比非对称加密快得多。当然，这取决于一个好的随机数生成器来产生k，否则坏人只能猜测它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-31T21:14:22.723

Here's a "card game" analogy: Suppose we play several rounds of a game with the same deck of cards. The shuffling of the deck between rounds is the primary source of randomness. If we didn't shuffle properly, you could beat the game by predicting cards.

When you use a poor source of randomness to generate an encryption key, you significantly reduce the entropy (or uncertainty) of the key value. This could compromise the encryption because it makes a brute-force search over the key space much easier.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-31T20:32:14.760

从 Project Euler 中解决[这个](http://projecteuler.net/index.php?section=problems&id=59)问题，它会真正让你明白“大量随机性”会为你做什么。当我看到这个问题时，我首先想到的就是这个问题。

使用他在那里谈到的方法，你可以很容易地看到“更多的随机性”会给你带来什么。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-31T20:45:21.503

一篇很好的论文概述了为什么不小心随机性会导致不安全感：

*   [http://www.cs.berkeley.edu/~daw/papers/ddj-netscape.html](http://www.cs.berkeley.edu/~daw/papers/ddj-netscape.html)

这描述了早在 1995 年，Netscape 浏览器的密钥 SSL 实现如何因为 PRNG 播种问题而容易被猜测 SSL 密钥。

# c# - 如何在 C# 中获取向量类型？

> ID：499432
> 
> 赞同：10
> 
> 时间：2009-01-31T19:55:34.020
> 
> 标签：c#, vector, directx

我想在我正在编写的 C# 应用程序中使用 Vectors，特别是 Vector3。

在不编写自己的情况下获得 Vector 类型的最佳方法是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-31T19:57:51.863

我在[CodeProject](http://www.codeproject.com/KB/recipes/VectorType.aspx)上找到的 POC 中使用了一个。这并不理想，但它适用于我们的情况。然而，当时它没有一种方法来反映关于给定法线的 Vector3，但从那时起这可能已经改变了。

如果您不介意使用 DirectX（有些人出于某种原因远离它），那么该库中也有[Vector3](http://msdn.microsoft.com/en-us/library/microsoft.windowsmobile.directx.vector3.aspx)类型。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-31T19:58:55.340

好吧，`Microsoft.DirectX.Vector3`如果这就是您要查找的内容，则会调用一个结构。您需要参考`Microsoft.DirectX.dll`才能使用它。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-03-22T20:59:34.957

为了完整起见，XNA 中还有一个：Microsoft.XNA.Framework.Vector3。

听起来像是急需整合的东西。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-03-22T20:48:37.690

在 WPF 中，您有：

[System.Windows.Media.Media3D.Vector3D](http://msdn.microsoft.com/en-us/library/system.windows.media.media3d.vector3d.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-03-22T20:51:16.437

您应该能够在 SlimDX 中使用矢量类： [http ://code.google.com/p/slimdx/](http://code.google.com/p/slimdx/)

您还可以从 XNATouch 之类的开源 XNA 端口中提取向量/数学类：http: [//xnatouch.codeplex.com/](http://xnatouch.codeplex.com/)

# java - 在没有 NetBeans 的情况下构建 JavaFX 项目

> ID：499433
> 
> 赞同：2
> 
> 时间：2009-01-31T19:55:38.420
> 
> 标签：java, eclipse, ant, javafx

我正在尝试学习[JavaFX](http://www.javafx.com/ "JavaFX")，并且可能会创建一些“学习者”游戏。我总是在 Eclipse 中进行开发，而不是 JavaFX 团队显然试图推动的 NetBeans。

任何人都可以指出如何在 Eclipse 中构建 JavaFX 项目，或者至少在*没有*NetBeans 的情况下构建 JavaFX 项目的方向吗？到目前为止，我发现的所有东西要么使用 NetBeans，要么它们在 Eclipse 中运行一个单文件项目（witch 不适用于更大的项目）。理想情况下，我正在寻找能够设置一个简单的 Ant 脚本来构建 JavaFX 项目的人，因为我认为这是这种情况的最终结果。

我能够找到下载[Eclipse JavaFX 插件](http://kenai.com/projects/eplugin/pages/Home "Eclipse JavaFX 插件")的位置。它提供语法高亮支持，以及一些“片段”。我什至可以用它来运行简单的 hello world 类型的 JavaFX 应用程序，但我似乎无法让它自动构建多文件 JavaFX 项目。即使可以，我似乎仍然无法编写正确的 ant 脚本来启动 JavaFX 项目。

另外，我发现[这个网站](http://jfx.wikia.com/wiki/Ant_task)讨论了如何使用 Sun（？）创建的*javafxc* Ant 任务，但我没有运气尝试使用他们谈论的内容。

谢谢

罗斯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T07:39:33.757

如果您在 NB 中创建新项目，则会有一个名为 nbproject 的文件夹。此文件夹包含`build-impl.xml`. 此文件包含此目标：

```
<target if="src.dir" name="-compile-fx">
    <taskdef classname="com.sun.tools.javafx.ant.JavaFxAntTask" classpath="${platform.bootcp}" name="javafxc"/>
    <javafxc bootclasspath="${platform.bootcp}" classpath="${build.classes.dir}:${javac.classpath}" compilerclasspath="${platform.bootcp}" debug="${javac.debug}" deprecation="${javac.deprecation}" destdir="${build.classes.dir}" excludes="${excludes}" fork="yes" includeJavaRuntime="false" includeantruntime="false" includes="**/*.fx" source="${javac.source}" sourcepath="" srcdir="${src.dir}" target="${javac.target}">
        <compilerarg line="${javac.compilerargs}"/>
    </javafxc>
</target> 
```

这是为 Eclipse 创建 ant 的良好开端。我不确定 Eclipse 的构建是如何工作的，但可能存在一些限制。`com.sun.tools.javafx.ant.JavaFxAntTask`位于 SDK 中，而不是编译器 jar 。祝你好运！。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T00:05:59.117

我在有关 JavaFX 的文章中读到有一个可用的 Eclipse 扩展。根据那篇文章，它不像 NetBeans 对 FX 的支持那么成熟，但总比没有好......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T01:14:36.153

我为构建过程创建了部分 Ant 脚本。我可以说它实际上是在编译 JavaFX 类并将它们组合起来。但是，我*想*我错过了一个 Ant 任务，我在其中创建了**Applet中所需的****JNLP**对象，我也错过了（但设法伪造）。

 **因为我没有明确说明，所以我*没有*让它进入工作状态，所以不要指望只做我所做的就可以到达那里；）

据我所知，这个 Ant 脚本。为了简洁起见，除了重要的部分，我省略了所有内容...

```
<project name="RABfx" default="all" basedir=".">
    ... 
    <property environment="env"/>
    <property name="java.home" value="${env.JAVA_HOME}" />
    <property name="jfx.home" value="${env.JAVAFX_HOME}" />
    <path id="compile.classpath">
        <fileset dir="${java.home}/lib">
            <include name="**/*.jar" />
        </fileset>
        <fileset dir="${jfx.home}/lib">
            <include name="**/*.jar" />
        </fileset>
        ...
    </path>

    <taskdef classname="com.sun.tools.javafx.ant.JavaFxAntTask" name="javafxc">
        <classpath refid="compile.classpath" />
    </taskdef>

    ...

    <target name="compile">
        <javac srcdir="${src}" destdir="${src.classes}" includes="**/*.java">
            <classpath refid="compile.classpath" />
        </javac>
        <javafxc srcdir="${src}" destdir="${src.classes}" includes="**/*.fx" executable="${jfx.home}/bin/javafxc.exe">
            <classpath refid="compile.classpath" />
        </javafxc>
        ...
    </target>

    <target name="build">
        <jar jarfile="${src.jar}">
            <fileset dir="${src.classes}" />
        </jar>
    </target>
    ...
</project> 
```

另外，我的“假”小程序......

```
...
<script src="http://dl.javafx.com/dtfx.js"></script>
<script>
    javafx(
        {
            archive: "RABfx.jar",
            width: 440,
            height: 560,
            code: "TicTacToe.Main",
            name: "TicTacToe"
        }
    );
</script>
... 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-28T02:11:34.630

在我问了这个问题之后，发布了一个官方的（我认为？）Eclipse 的 JavaFX 插件。转到[JavaFX for Eclipse](http://javafx.com/docs/gettingstarted/eclipse-plugin/index.jsp)页面。我安装了插件，一切都自动运行了！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T21:25:29.783

使用前面提到的 JavaFxAntTask 或在 NetBeans 中生成项目并在 Eclipse 中打开它，然后您就可以运行 Ant 目标。或者等待 1.1，它有望提供完整的 Eclipse 和 IDEA 支持。

# c - 您可以使用 Adob e 的 Alchemy 执行批处理文件吗？

> ID：499435
> 
> 赞同：2
> 
> 时间：2009-01-31T19:56:43.240
> 
> 标签：c, apache-flex, flash, actionscript-3, alchemy

我打算制作一个 AIR 应用程序，但我需要执行一个外部应用程序，并且由于 Adob​​e AIR 中的安全限制......我在想为什么不尝试通过编写一些类似 System("file执行”）; 然后使用 Alchemy 将其更改为 swc 和我们在我的应用程序中... 任何人都尝试过这种类型，或者认为它可以工作？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-31T20:42:09.090

关于 Alchemy，您需要了解的是，它将 C 编译成与 actionscript 相同的字节码，并在与 flash/flex as3 应用程序相同的虚拟机 (AVM2) 下运行。

Alchemy 能够更快地执行某些操作的原因是编译后的 C（编译为字节码）可以通过一些在 flash 10 中添加的优化 AVM2 指令访问原始“内存”（ApplicationDomain.domainMemory）。

我想要了解的是，因为 Alchemy 只是在 AVM2 之上运行，所以它与任何其他应用程序一样受到限制。AIR 应用程序中的 Alchemy 可以比浏览器沙箱中的 Alchemy 做更多的事情，但它仍然受到该沙箱的限制。

如果您确实需要执行外部应用程序，则需要研究[Shu](http://www.shu-player.com/)或[Zinc 之](http://www.multidmedia.com/)类的东西。

抱歉，我无法提供更多帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-31T20:43:01.693

这行不通 - Alchemy 并不是真的/真的不适合与外界交互的程序。我认为它不支持执行系统调用，即使 Alchemy 支持它，flash/air 运行时也肯定会阻止它。

如果您不需要跨平台行为，您可以考虑创建一个老式的“投影仪”。可以使用 fscommand 从投影仪 exe 启动程序 - 请注意，您要启动的可执行文件必须位于二进制文件旁边名为 fscommand 的文件夹中。如果这还不够，您可以尝试第三方商业工具，例如[http://www.northcode.com/](http://www.northcode.com/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T03:37:29.067

不，Richard Szalay 是正确的：Alchemy 将 C 代码编译为 ActionScript 字节码，因此生成的 SWF 仍然受制于与任何其他相同的沙盒限制；AIR 限制可能更宽松，但使用 Alchemy 在这方面没有任何好处。

但是，您仍然可以使用套接字连接“调出”沙箱，前提是您有一个应用程序正在侦听该连接；查看[Merapi——](http://merapiproject.net/)如果您愿意使用 Java，它可能可以作为一个简单的解决方案提供帮助，尽管您当然可以使用其他东西（例如 C#）来自己开发。

# c# - LINQ InsertOnSubmit：NullReferenceException

> ID：499436
> 
> 赞同：16
> 
> 时间：2009-01-31T19:57:07.217
> 
> 标签：c#, asp.net, linq, linq-to-sql, nullreferenceexception

我有这个代码：

```
using DC = MV6DataContext;
using MV6; // Business Logic Layer
// ...

public DC.MV6DataContext dc = new DC.MV6DataContext(ConnectionString);
IP ip = new IP(Request.UserHostAddress);
dc.IPs.InsertOnSubmit(ip);
dc.SubmitChanges();

// in Business Logic layer:
public class IP : DC.IP {
  public IP(string address) { ... }
} 
```

在尝试 InsertOnSubmit(ip) 时，我得到一个 NullReferenceException（对象引用未设置为对象的实例）。dc 不为空；ip 和 ip 的所有属性都不为空；虽然有些是空的。

VS2008 不会让我进入 InsertOnSubmit，所以我无法知道在评估时具体是什么 null。是什么赋予了？

注意：我检查过，FK 关系创建的所有 Linq.EntitySets 都存在且非空。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-10-14T23:53:53.137

实际上，最好向您的构造函数添加一个调用，该调用也调用通用构造函数，例如：

```
public IP(string address) : this() {
...
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-31T21:28:19.107

知道了。

我没有创建一个继承自 DataContext 类的类，而是使用业务逻辑层中的部分类扩展 DC 类本身。从那里我可以添加任何我想要的构造函数和方法。

在这种情况下，需要从现有的（自动生成的）构造函数中复制代码：

```
public IP(string address) {
Address = address;
Domain = "";
Notes = "";
FirstAccess = DateTime.Now;
LastAccess = DateTime.Now;
this._Sessions = new EntitySet<Session>(new Action<Session>(this.attach_Sessions), new Action<Session>(this.detach_Sessions));
OnCreated(); } 
```

不确定那个 OnCreated 处理程序中有什么，但它似乎正在做让我更早的工作。现在工作正常:)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-10T16:32:20.470

由于默认构造函数已经初始化了 base()、this._Sessions 并运行了 OnCreated 方法，因此您需要在扩展构造函数中执行以下操作：

```
public IP(string address) : this()
{
    Address = address;
    Domain = "";
    Notes = "";
    FirstAccess = DateTime.Now;
    LastAccess = DateTime.Now;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-31T20:05:54.623

如果您在 SubmitChanges 之前放置断点，您可以尝试查看发生了什么，将进行哪些更改，并快速查看[dc.GetChangeSet()](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.getchangeset.aspx)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-31T20:38:02.983

这是设计师生成的 DataContext 还是您自己手工构建的。我怀疑在您尝试使用`InsertOnSubmit()`. 我看不出设计器生成的 DataContext 会如何发生这种情况，但众所周知，我经常忘记在自己的代码中初始化我的集合。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-09-23T05:31:38.467

我的情况与提问者略有不同，但出于相同的原因得到了相同的错误。我在部分类中为我的数据库实体编写了新的构造函数，然后尝试在`InsertOnSubmit`调用中使用生成的对象。

这些答案都没有直接帮助我，但在阅读完所有这些答案后，我能够弄清楚他们在做什么。

为实体自动生成的无参数构造函数会做一些需要发生的事情`InsertOnSubmit`才能工作，所以如果你重载构造函数——比如我——或者从类继承——比如询问者——你需要调用基本构造函数从您的新构造函数中，如下所示：

```
public partial class Entity {
    public Entity( Type parameter ) : this() {
        // do things with the parameter
    }
} 
```

或者

```
public class SubEntity: Entity {
    public SubEntity( Type parameter ) : base() {
        // do things with the parameter
    }
} 
```

# java - 在 Java 中，什么时候应该创建已检查异常，什么时候应该创建运行时异常？

> ID：499437
> 
> 赞同：97
> 
> 时间：2009-01-31T19:57:17.060
> 
> 标签：java, exception

> **可能重复：**
> [何时选择已检查和未检查的异常](https://stackoverflow.com/questions/27578/when-to-choose-checked-and-unchecked-exceptions)

什么时候应该创建一个检查异常，什么时候应该创建一个运行时异常？

例如，假设我创建了以下类：

```
public class Account {
    private float balance;

    /* ... constructor, getter, and other fields and methods */

    public void transferTo(Account other, float amount) {
        if (amount > balance)
            throw new NotEnoughBalanceException();
        /* ... */
    }
} 
```

我应该如何创建我的`NotEnoughBalanceException`？它应该延长`Exception`还是`RuntimeException`？还是我应该`IllegalArgumentException`改用？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2009-01-31T20:11:01.463

在这个话题上有很多分歧。在我的上一份工作中，我们遇到了一些真正的问题，即运行时异常被遗忘，直到它们出现在生产环境中（在agedwards.com 上），所以我们决定只使用检查异常。

在我目前的工作中，我发现在许多或所有情况下都有很多运行时异常。

这是我的想法：使用 CheckedExceptions，我被迫在编译时至少承认调用者中的异常。对于运行时异常，我不会被编译器强迫，但可以编写一个单元测试让我处理它。由于我仍然相信越早发现错误，修复它的成本就越低，因此我更喜欢 CheckedExceptions。

从哲学的角度来看，方法调用在某种程度上是调用者和被调用者之间的契约。由于编译器强制执行传入的参数类型，让它在输出时强制执行类型似乎是对称的。即返回值或异常。

我的经验告诉我，当我使用已检查的异常时，我可以获得更高的质量，即可以正常工作的代码。检查的异常可能会使代码混乱，但有一些技术可以解决这个问题。我喜欢在通过层边界时翻译异常。例如，如果我从持久层向上传递，我想将 SQL 异常转换为持久性异常，因为下一层不应该关心我正在持久化到 SQL 数据库，但会想要知道某些东西是否无法持久。我使用的另一种技术是创建一个简单的异常层次结构。这让我可以编写更清晰的代码一层，因为我可以捕获超类，并且只在真正重要的时候处理各个子类。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-01-31T20:48:35.130

总的来说，我认为 Joshua Bloch 在*[Effective Java](https://rads.stackoverflow.com/amzn/click/com/0321356683)*中的建议最好地总结了您的问题的答案：**对可恢复条件使用检查期望，对编程错误使用运行时异常**（第 2 版中的第 58 条）。

所以在这种情况下，如果你真的想使用异常，它应该是一个选中的。（除非文档`transferTo()`非常清楚地表明，如果不首先使用其他方法检查是否有足够的余额，则*不得*`Account`调用该方法 - 但这似乎有点尴尬。）

但也要注意第 59 条：*避免不必要地使用受检异常*和第 57 条：*仅在异常情况下使用异常*。正如其他人指出的那样，这种情况可能根本不值得例外。`false`如果没有足够的信用，请考虑返回（或者可能是包含有关所发生情况的详细信息的状态对象）。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-01-31T22:16:47.810

何时使用检查异常？诚实地？在我的拙见中......从来没有。我想自从我上次创建检查异常以来已经有大约 6 年了。

你不能强迫某人处理错误。可以说它使代码变得更糟而不是更好。我无法告诉你我遇到过这样的代码的次数：

```
try {
  ...
} catch (IOException e) {
  // do nothing
} 
```

而我无数次写过这样的代码：

```
try {
  ...
} catch (IOException e) {
  throw new RuntimeExceptione(e);
} 
```

为什么？因为一个条件（不一定是 IOException；这只是一个例子）是不可恢复的，但无论如何都被逼到我的喉咙里，我经常被迫在执行上述操作和污染我的 API 之间做出选择，只是为了一直传播检查的异常到它（正确地）致命并将被记录的顶部。

Spring 的 DAO 帮助程序类将已检查的 SQLException 转换为未检查的 DataAccessException 是有原因的。

如果您遇到诸如缺少对磁盘的写入权限、磁盘空间不足或其他致命情况等问题，您希望尽可能多地发出噪音，而这样做的方法是使用...未经检查的异常（甚至是错误）。

此外，[检查异常会破坏封装](http://www.ckwop.me.uk/Why-Exceptions-Suck.html)。

这种认为检查异常应该用于“可恢复”错误的想法确实是天方夜谭的一厢情愿。

Java 中的已检查异常是一个实验……一个失败的实验。我们应该减少损失，承认我们犯了错误并继续前进。恕我直言，.Net 只有未经检查的异常才能做到这一点。再一次，它具有从 Java 的错误中吸取教训的二次采用者优势。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-31T20:01:47.190

恕我直言，它根本不应该是一个例外。在我看来，应该在发生异常情况时使用异常，而不是作为流程控制。

在您的情况下，有人试图转移比余额允许的更多的钱根本不是一个特殊的状态。我认为这些事情在现实世界中经常发生。所以你应该针对这些情况进行编程。一个例外可能是您的 if 语句评估余额良好，但是当实际从帐户中减去钱时，由于某些奇怪的原因，余额不再好。

一个例外可能是，就在调用 之前`transferTo()`，您检查了该线路是否对银行开放。但是在 内部`transferTo()`，代码注意到该行不再打开，尽管按照所有逻辑，它应该是打开的。*那*是个例外。如果线路打不开，那也不例外，这是一个似是而非的情况。

恕我直言：例外 == 奇怪的黑魔法。

***建设性编辑：***

所以，不要太矛盾，方法本身很可能会抛出异常。但是方法的使用要控制：你先检查余额（`transferTo()`方法外），如果余额好，才调用`transferTo()`。如果`transferTo()`由于某种奇怪的原因注意到平衡不再好，你会抛出异常，你会努力捕捉它。

在这种情况下，您将所有的鸭子排成一排，并且知道除了记录异常，向某人发送通知并告诉客户之外，您无能为力（因为已经`true`变成了`false`，就像它自己一样）礼貌地说，有人在上一次满月期间没有适当地献祭他们的处女，问题将在第一时间解决。

***更少的企业建议编辑：***

如果您这样做是为了自己的乐趣（情况似乎是这样，请参阅评论），我建议您返回一个布尔值。用法将是这样的：

```
// ...
boolean success = transferTo(otherAccount, ONE_MILLION_DOLLARS_EXCLAMATION);

if (!success) {
  UI.showMessage("Aww shucks. You're not that rich");
  return; // or something...
} else {
  profit();
}
// ... 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-01-31T20:42:21.837

我的规则是

*   *用于业务逻辑错误的*if语句（如您的代码）**
**   **已检查应用程序可以恢复**的环境错误的异常***   **无法恢复**的环境错误的 uncheched 异常

     **1.  已检查异常的示例：可以脱机工作的应用程序的网络已关闭
    2.  未检查异常的示例：数据库在 CRUD Web 应用程序上已关闭。***** 

 *****关于这个主题有很多文档。您可以通过浏览 Hibernate 网页找到很多信息，因为它们在 3.x 版本中将 Hibernate 2.x 的所有异常从选中更改为未选中

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-01T17:28:58.763

我最近遇到了异常问题，代码抛出了 NullPointerException，我不知道为什么，经过一番调查，结果发现真正的异常被吞下了（它在新代码中，所以它仍在完成）并且方法只是返回 null。如果您确实检查了异常，您必须了解糟糕的程序员只会尝试捕获它并忽略异常。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-01-31T20:13:40.973

我的感觉是检查异常是一个有用的合同，应该谨慎使用。我认为检查异常是一个好主意的经典示例是[InterruptedException](http://java.sun.com/javase/6/docs/api/java/lang/InterruptedException.html)。我的感觉是，我确实希望能够在我希望它停止时停止一个线程/进程，而不管有人为 Thread.sleep() 指定了多长时间。

所以，试图回答你的具体问题，这是你绝对想要确保每个人都处理的事情吗？在我看来，`Account`没有足够钱的情况是一个足够严重的问题，你必须处理它。

回应[Peter](https://stackoverflow.com/users/47190/peter-tibran253)的评论：这是一个使用 InterruptedException 作为应处理的异常的具体案例的示例，您需要有一个有用的默认处理程序。这是我强烈推荐的，当然是在我的实际工作中。你至少应该这样做：

```
catch (InterruptedException ie) {
    Thread.currentThread().interrupt();
} 
```

该处理程序将确保代码捕获已检查的异常并执行您想要的操作：让该线程停止。诚然，如果上游有另一个异常处理程序/食客，那么它对异常的处理能力较差并非不可能。即便如此，[FindBugs](http://findbugs.sourceforge.net/)可以帮助您找到这些。

现在，现实开始了：您不一定强制为您的检查异常编写异常处理程序的每个人都很好地处理它。也就是说，至少您将能够“查找用法”并知道它的使用位置并提供一些建议。

简短形式：如果您使用已检查的异常，则会对您的方法的用户造成负担。确保有充分的理由，推荐正确的处理方法并广泛记录所有这些。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-11-20T17:10:05.867

来自[未经检查的例外——争议](http://download.oracle.com/javase/tutorial/essential/exceptions/runtime.html)：

> 如果可以合理地期望客户端从异常中恢复，则使其成为受检异常。如果客户端无法从异常中恢复，请将其设为未经检查的异常。

请注意，未经[`RuntimeException`](http://download.oracle.com/javase/6/docs/api/java/lang/RuntimeException.html)检查的异常是派生自[`Exception`](http://download.oracle.com/javase/6/docs/api/java/lang/Exception.html).

`RuntimeException`如果客户端无法从异常中恢复，为什么还要抛出异常？文章解释说：

> 运行时异常表示由编程问题引起的问题，因此，不能合理地期望 API 客户端代码从它们中恢复或以任何方式处理它们。此类问题包括算术异常，例如除以零；指针异常，例如试图通过空引用访问对象；和索引异常，例如尝试通过太大或太小的索引访问数组元素。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-31T20:09:10.593

已检查异常意味着您的类的客户端被迫由编译器处理它。除非他们添加 try/catch 块，否则他们的代码无法编译。

C# 的设计者已决定首选未经检查的异常。

或者您可以遵循 C 风格并检查返回值而不抛出异常。

异常确实是有代价的，所以它们不应该用于控制流，如前所述。但他们为他们做的一件事是他们不能被忽视。

如果您决定在这种情况下避免异常，您将面临您班级的客户将忽略返回值或在尝试转移之前无法检查余额的风险。

我会推荐一个未经检查的异常，我会给它一个描述性的名称，比如 InsufficientFundsException，以便清楚地说明发生了什么。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-31T20:11:04.553

行并不总是很清楚，但对我来说通常**RuntimeException = Programming errors** , **checked exceptions = external errors**。这是非常粗略的分类。就像其他人说的那样，受检异常迫使您处理，或者至少考虑一小部分时间，关于它。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-01-31T20:21:27.697

简而言之，仅将受检异常用作库外部合同的一部分，并且仅在客户端想要/需要捕获它时使用。请记住，当使用检查异常时，您是在强迫自己对调用者。对于运行时异常，如果它们有据可查，您就可以给调用者一个选择。

在 Java 中过度使用检查异常是一个已知问题，但这并不意味着它们都是坏的。这就是为什么它是 Spring 哲学不可或缺的一部分，例如 ( [http://www.springsource.org/about](http://www.springsource.org/about) )

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-31T20:26:13.647

检查异常的优点是编译器强制开发人员更早地处理它们。无论如何，在我看来，缺点是开发人员往往是懒惰和不耐烦的，并且会删除异常处理代码，以便稍后返回并修复它。当然，这很少发生。

*《 Thinking in Java* 》一书的作者 Bruce Eckel有[一篇](http://www.mindview.net/Etc/Discussions/CheckedExceptions)关于这个主题的好文章。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-01-31T20:28:13.863

我不认为这种情况（资金不足）值得抛出`Exception`--- 这根本*不够*特殊，应该由程序的正常控制流程处理。但是，如果我真的必须抛出异常，我会选择一个已*检查的异常*，通过扩展`Exception`，而不是`RuntimeException`未检查的。这迫使我明确地处理异常（我需要声明它被抛出，或者在某处捕获它）。

`IllegalArgumentException`是 的子类`RuntimeException`，这使其成为未经检查的异常。如果调用者有一些方便的方法来确定方法参数是否合法，我只会考虑抛出这个。在您的特定代码中，不清楚调用者是否有权访问`balance`，或者整个“检查余额和转移资金”是否是原子操作（如果不是，那么调用者确实没有验证参数的便捷方法）。

编辑：澄清了我对投掷的立场`IllegalArgumentException`。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-01-21T22:49:25.490

我自己，我更喜欢尽可能使用检查的异常。

如果您是 API 开发人员（后端开发人员），请使用受检异常，否则，请使用运行时异常。

另请注意，在某些情况下使用运行时异常被认为是一个大错误，例如，如果您要从会话 bean 中抛出运行时异常（请参阅： http: [//m-hewedy.blogspot.com/2010/01/避免抛出-runtimeexception-from.html](http://m-hewedy.blogspot.com/2010/01/avoid-throwing-runtimeexception-from.html)以获取有关在会话 bean 中使用运行时异常的问题的更多信息）。

# sql-server-2005 - 我应该选择在我的服务器上安装哪一个：Windows 2003 Standard 或 Windows 2008 Web Edition？

> ID：499442
> 
> 赞同：1
> 
> 时间：2009-01-31T19:59:24.187
> 
> 标签：sql-server-2005, windows-server-2008, dedicated-hosting

我正在寻找一个专用服务器来托管我即将发布的网络应用程序。它们是用 ASP.NEt 构建的，并使用 Sql Server 2005。我与一家公司达成了很多关于具有 8Gb 或 ram 和 750Gb sata 的 Intel Core2Quad Q9300 的协议。

他们免费为我提供 Windows 2003 64 Standard 或 Windows 2008 64 Web，我应该选择哪一个？

我主要关心的是数据库，一开始我将只有一个盒子来托管 Web 层和数据库层。我能否在 Windows 2008 的 Web 版本上安装 SQL Server（最初是快速版，然后是标准版）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T20:15:14.217

如果你能获得 Server 2008，我会选择它，因为 IIS7 是升级到 IIS6 的绝佳选择。

Windows 2008 Web Server 正式支持SQL Server **Standard** 2008 64 位。SQL Server **Enterprise** 2008 64 位不是（不确定它是否有效，只是没有列出。列出了 32 位企业，但在现代服务器上运行 32 位听起来并不吸引人）。有关SQL Server 2008 版本和支持的服务器的完整列表，请参阅此处的[系统要求。](http://msdn.microsoft.com/en-us/library/ms143506.aspx#SEx64)

不确定 SQL Server 2005，似乎需要[一个补丁](http://blogs.iis.net/bills/archive/2008/04/15/windows-web-server-2008-and-sql-server-2005.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T20:04:37.343

您可以在 Server 2008 Web Edition 上运行 SQL Server（这是对 Server 2003 Web Edition 的更改）。我知道 Web 和 Standard for 2008 之间的主要限制是 Web 不能进行任何类型的虚拟化、Active Directory 或 DNS 管理等。它本质上是一个应用程序服务器。

我会推荐更新的操作系统，因为它带有 IIS7 和增强的 TCP/IP（除其他外）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T20:08:28.643

如果它是免费的，请选择标准版本。以下是功能的比较：

[http://www.microsoft.com/windowsserver2008/en/us/compare-features.aspx](http://www.microsoft.com/windowsserver2008/en/us/compare-features.aspx)

我从未注意到版本中的任何性能差异，因此不妨获得您有一天可能会使用的功能。后期升级很贵。

您可以在其中任何一个上运行 SQL。

# c++ - 在 Linux 上，命令行程序 mktemp 是否不如 C 函数 mkstemp 安全？

> ID：499450
> 
> 赞同：2
> 
> 时间：2009-01-31T20:06:28.070
> 
> 标签：c++, c, linux, temporary-files

这两个操作都创建一个空文件并返回文件名，但 mkstemp 使文件以独占模式打开并为您提供句柄。C 函数是否有安全优势？这是否意味着命令行版本存在安全漏洞？

顺便说一句，有趣的是，Linux 上的 C api 中有几个相关的函数，其中大多数在他们的手册页中说“不要使用这个函数”（或类似的）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-31T20:27:21.320

在类 Unix 操作系统（包括 Linux 和 Mac OS）中使用临时文件的一个技巧是，一旦您打开文件，就将其删除。您仍然可以访问该文件，但没有其他人可以看到它或对其进行任何操作，并且一旦您关闭该文件，它就会消失，即使您的程序死于可怕的死亡。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-31T20:19:39.590

从`mktemp(1)`源代码中可以很容易地看到，它实际上除了调用`mkstemp(3)`.

Linux 中的独占模式意味着如果文件已经存在，函数将失败，它不保证锁定。其他进程可以删除此文件，再次创建它并用数据填充它，尽管文件句柄`open(3)`由您的进程处理。

与命令行实用程序相比，C 函数没有额外的安全性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T20:15:37.350

系统调用和命令行函数最明显的区别在于，命令行函数是由人或他们的 shell 脚本使用的，而系统调用总是由程序完成的。

给一个人一个文件句柄是相当困难的。

关于“安全”，您应该考虑竞争条件：一个程序的多个实例同时调用 mkstemp，但每个实例都保证有一个唯一的临时文件。如果程序脱壳并调用命令行版本，几乎不可能保证这一点。

# tomcat - cgi和tomcat

> ID：499456
> 
> 赞同：1
> 
> 时间：2009-01-31T20:08:44.120
> 
> 标签：tomcat, cgi

我正在尝试使用 tomcat 运行 cgi 脚本 (.cgi)。我收到以下错误，无法找出问题所在。我知道我真的应该使用 apache 和 mod 代理，但这真的不是我的专业领域，所以我采取了简单的方法！

谢谢你的帮助。

```
java.io.IOException: Cannot run program "perl" (in directory "C:\Java\tomcat\webapps\my_app_name\WEB-INF\cgi"): CreateProcess error=2, 系统找不到指定的文件
    java.lang.ProcessBuilder.start(ProcessBuilder.java:459)
    java.lang.Runtime.exec(Runtime.java:593)
    java.lang.Runtime.exec(Runtime.java:431)
    org.apache.catalina.servlets.CGIServlet$CGIRunner.run(CGIServlet.java:1705)
    org.apache.catalina.servlets.CGIServlet.doGet(CGIServlet.java:597)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:627)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:729)
    org.tukey.web.filters.urlrewrite.UrlRewriteFilter.doFilter(UrlRewriteFilter.java:738)
    org.apache.struts2.dispatcher.FilterDispatcher.doFilter(FilterDispatcher.java:416)

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T20:28:04.330

这是一种猜测，但您可能需要将以下内容添加到您的`web.xml`文件中，以便 Tomcat 可以找到 perl 可执行文件。显然， Tomcat 不会查看您`PATH`的可执行文件：

```
executable
C:\perl\bin\perl 
```

当然，在您的系统上使用 perl 的实际路径。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T00:48:02.607

您需要在 servlet 元素中指定“可执行”参数。根据[文档](http://tomcat.apache.org/tomcat-6.0-doc/cgi-howto.html)，默认值为“perl”，这可能是触发错误的原因。也许将其更改为 cmd.exe 之类的东西会起作用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T10:03:57.867

谢谢大家，我没有找到运行 C++ cgi 脚本的正确语法，但如果你将参数留空，它将运行任何脚本类型。

```
<init-param>
  <param-name>executable</param-name>
  <param-value></param-value>
</init-param> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T20:30:28.663

该错误表明`perl`找不到名为的可执行文件。你的系统上安装了perl吗？是在路上吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T21:00:15.590

没有没有安装perl。CGI 脚本实际上是 c++。除了默认的tomcat安装之外，我没有安装任何东西。

# java - Swing JLayeredPane.getLayer() - 文档错误或实际副作用？

> ID：499465
> 
> 赞同：1
> 
> 时间：2009-01-31T20:14:59.067
> 
> 标签：java, swing, jlayeredpane

我正在尝试找出有关Swing 中[JLayeredPane的一些信息。](http://java.sun.com/javase/6/docs/api/javax/swing/JLayeredPane.html)如果有人使用过这个类，我们将不胜感激。

getLayer(JComponent c) 的文档指出：

> 获取 JComponent 的 layer 属性，它不会像 setLayer() 那样产生任何副作用。（绘画、添加/删除等） 通常您应该使用实例方法 getLayer()。

显然，这里有一些错误，因为这是实例方法 getLayer() （没有重载版本）

实际上是否应该在这里进行不同的调用，或者是有人太急于从 putLayer() 复制：

> 设置 JComponent 的 layer 属性。此方法不会导致任何副作用，例如 setLayer()（绘画、添加/删除等）。通常，您应该使用实例方法 setLayer()，以获得所需的副作用（如重新绘制）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-10T16:22:06.093

像 Swing 中的许多事情一样，您的问题的答案在 Swing 源代码中揭示。来自 JLayeredPane.java：

```
public static int getLayer(JComponent c) {
    Integer i;
    if((i = (Integer)c.getClientProperty(LAYER_PROPERTY)) != null)
        return i.intValue();
    return DEFAULT_LAYER.intValue();
}

public int getLayer(Component c) {
    Integer i;
    if(c instanceof JComponent)
        i = (Integer)((JComponent)c).getClientProperty(LAYER_PROPERTY);
    else
        i = (Integer)getComponentToLayer().get((Component)c);

    if(i == null)
        return DEFAULT_LAYER.intValue();
    return i.intValue();
} 
```

看起来您在这里看到一些差异的原因是 JComponent 实例的层存储为 JComponent 实例的属性，但组件实例的层存储在 JLayeredPane 的哈希表中。因此，getLayer(JComponent c) 可以是静态的，而 getLayer(Component c) 不能。

正如你可能想象的那样，这只是这个类的陌生的开始。验证和绘制 JLayeredPane 和内容会很快变得复杂。

# php - 站点监控 API（托管在 Linux 上）

> ID：499481
> 
> 赞同：-1
> 
> 时间：2009-01-31T20:25:05.383
> 
> 标签：php, monitoring

我有一个即将上线的 php 站点（在 UI 端使用 Flex）并且想知道我的监控选项是什么。我正在寻找某种形式的 api，它相当于 .NET 性能计数器/ASP.NET 运行状况监控。

理想情况下，我想获得诸如以毫秒为单位的排队请求/响应以及相关统计信息等内容，以便我可以在 Flex 中绘制它们。我不介意我必须使用 Python 还是 Ruby。

我有哪些选择？我无法在 PHP 中找到任何与 .NET 一样重要的内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T20:31:21.250

为了监控我的网站，我使用了[munin](http://munin.projects.linpro.no/)，它提供了一些漂亮的图表。同样，您可以使用 mod_status 和 mod_info 打开一些内部 Apache 统计信息。

为了真正快速而肮脏的监控，在我的家用机器上，我每 15 分钟用以下 cron 条目戳一下我的 colo 站点：

```
*/15 * * * * if ! wget --load-cookies $HOME/.mozilla/fake/cookies.txt --save-cookies $HOME/.mozilla/fake/cookies.txt -q --spider http://navaid.com/CoPilot/ ; then echo "CoPilot site is down" ; fi 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-05T12:33:31.430

您可能会对[Pinba](http://pinba.org/)或[APM](http://code.google.com/p/peclapm/)等 PHP 监控扩展感兴趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T20:25:54.177

我有很多关于使用 munin 的建议。我想我会得到源代码并尝试一下！

谢谢

# iphone - 如何模仿删除 UITableView 中的特定行？

> ID：499482
> 
> 赞同：1
> 
> 时间：2009-01-31T20:26:04.413
> 
> 标签：iphone, objective-c, xcode, uitableview

我在表格视图中有一个事物列表。

当用户点击一行时，我会增加分数。我希望提供一种方法来清除该行的分数。

我的第一次尝试是将表格置于编辑模式，向该行显示删除按钮并继续。但是，所有其他行都被阻止，无法再次点击分数或点击披露按钮。

所以，显然这不是办法。但后来我不知道该怎么办。有什么建议吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T14:03:48.863

您可以添加一个按钮来清除该行的分数作为表格单元格的子视图。不过，我想你必须把它放在左边，因为披露按钮在右边。

# sql - SQL 2005 选择案例 陈述

> ID：499485
> 
> 赞同：0
> 
> 时间：2009-01-31T20:26:58.263
> 
> 标签：sql, sql-server, case, unpivot

我真的很感激这方面的帮助，我被严重卡住了。基本上我有一张桌子

看起来像这样：

```
SSS_DOWID Name Mon  Tue  Wed  Thu   Fri   Sat   Sun   Description  
2         M    Y    N    N    N     N     N     N     Monday
3         MF   Y    N    N    N     Y     N     N     Monday, Friday
.......
18        T    N    Y    N    N     N     N     N     Tuesday
........
etc. 
```

我需要做的是将此表中的值转换为仅包含

一周中的几天对应的数字，例如，1 代表星期日，2 代表星期一，3 代表星期二，等等，一直到 8 代表星期日。

所以我有一点点 SQL：

```
DECLARE @strDays table
(SSS_DOWID int)

INSERT INTO @strDays
SELECT  
  case (sun) when 'Y' then '1' else '' end +  
  case (mon) when 'Y' then '2' else '' end +   
  case (tue) when 'Y' then '3' else '' end +  
  case (wed) when 'Y' then '4' else '' end +   
  case (thu) when 'Y' then '5' else '' end +  
  case (fri) when 'Y' then '6' else '' end +   
  case (sat) when 'Y' then '7' else '' end  
 FROM   
  [dbo].SSS_DOW  WITH (NOLOCK)  
 WHERE  
  SSS_DOWID IN (28,41,44)  

SELECT * FROM @strDays 
```

这适用于个别日子，除了日子组合。所以在这种情况下，当我通过

28（周三）、41（周五）和 44（周六），我得到 4（完美）、6（完美）和 17（哦，废话——应该是

1 和 7，分别）。

谁能帮我重组我的 SQL 以便我得到一个包含 1、4、6 和 7 的表

4、6、17？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T20:46:18.460

听起来你需要一个非枢轴。

```
DECLARE @Days TABLE
(
  DayId int PRIMARY KEY,
  found int
)

INSERT INTO @Days(DayId, found) SELECT 1, 0
INSERT INTO @Days(DayId, found) SELECT 2, 0
INSERT INTO @Days(DayId, found) SELECT 3, 0
INSERT INTO @Days(DayId, found) SELECT 4, 0
INSERT INTO @Days(DayId, found) SELECT 5, 0
INSERT INTO @Days(DayId, found) SELECT 6, 0
INSERT INTO @Days(DayId, found) SELECT 7, 0
--
UPDATE d
SET d.found = 1
FROM  @Days d JOIN SSS_DOW s
  ON 
 CASE
    WHEN d.DayId = 1 and s.Mon == 'Y' THEN 1
    WHEN d.DayId = 2 and s.Tue == 'Y' THEN 1
    WHEN d.DayId = 3 and s.Wed == 'Y' THEN 1
    WHEN d.DayId = 4 and s.Thu == 'Y' THEN 1
    WHEN d.DayId = 5 and s.Fri == 'Y' THEN 1
    WHEN d.DayId = 6 and s.Sat == 'Y' THEN 1
    WHEN d.DayId = 7 and s.Sun == 'Y' THEN 1
    ELSE 0
  END = 1
WHERE SSS_DowID in (28, 41, 44)
--
SELECT *
FROM @Days
WHERE found = 1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T16:10:44.363

```
WITH days AS (
    SELECT SSS_DOWID, 1 AS DayOfWeek FROM dbo.SSS_DOW WHERE sun = 'Y'
    UNION ALL
    SELECT SSS_DOWID, 2 AS DayOfWeek FROM dbo.SSS_DOW WHERE mon = 'Y'
    UNION ALL
    SELECT SSS_DOWID, 3 AS DayOfWeek FROM dbo.SSS_DOW WHERE tue = 'Y'
    UNION ALL
    SELECT SSS_DOWID, 4 AS DayOfWeek FROM dbo.SSS_DOW WHERE wed = 'Y'
    UNION ALL
    SELECT SSS_DOWID, 5 AS DayOfWeek FROM dbo.SSS_DOW WHERE thu = 'Y'
    UNION ALL
    SELECT SSS_DOWID, 6 AS DayOfWeek FROM dbo.SSS_DOW WHERE fri = 'Y'
    UNION ALL
    SELECT SSS_DOWID, 7 AS DayOfWeek FROM dbo.SSS_DOW WHERE sat = 'Y')
SELECT DayOfWeek
FROM days
WHERE SSS_DOWID IN (28,41,44); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T17:15:13.597

在我看来，您在引用您的数字：

```
case (sun) when 'Y' then '1' else '' end +  
case (mon) when 'Y' then '2' else '' end + 
```

所以你在使用'+'时得到的是连接而不是加法。这就是为什么你得到 17 作为你的答案。

至于将其分成一列中的两个单独的答案，您可能需要尝试此处列出的答案之一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T19:19:52.017

在 SQL Server 2005 中，您可以使用显式`UNPIVOT`：

```
/*
CREATE TABLE SSS_DOW (
    SSS_DOWID int NOT NULL
    ,[Name] varchar(50) NOT NULL
    ,Mon char(1) NOT NULL
    ,Tue char(1) NOT NULL
    ,Wed char(1) NOT NULL
    ,Thu char(1) NOT NULL
    ,Fri char(1) NOT NULL
    ,Sat char(1) NOT NULL
    ,Sun Char(1) NOT NULL
    ,[Description] varchar(50) NOT NULL
)

INSERT INTO SSS_DOW VALUES (2, 'M', 'Y', 'N', 'N', 'N', 'N', 'N', 'N', 'Monday')
INSERT INTO SSS_DOW VALUES (3, 'MF', 'Y', 'N', 'N', 'N', 'Y', 'N', 'N', 'Monday, Friday')
INSERT INTO SSS_DOW VALUES (28, 'W', 'N', 'N', 'Y', 'N', 'N', 'N', 'N', 'Wednesday')
INSERT INTO SSS_DOW VALUES (41, 'F', 'N', 'N', 'N', 'N', 'Y', 'N', 'N', 'Friday')
INSERT INTO SSS_DOW VALUES (44, 'SaSun', 'N', 'N', 'N', 'N', 'N', 'Y', 'Y', 'Satruday, Sunday')
*/

;WITH DateAbbrev AS (
    SELECT number, LEFT(DATENAME(dw, number - 2), 3) AS abbrev
    FROM master..spt_values
    WHERE type = 'P'
        AND number BETWEEN 1 AND 7
)
SELECT SSS_DOWID, DateAbbrev.number AS DayOfWeek
FROM SSS_DOW
UNPIVOT (Flag FOR dow IN ([Mon], [Tue], [Wed], [Thu], [Fri], [Sat], [Sun])) AS pvt
INNER JOIN DateAbbrev
    ON DateAbbrev.abbrev = dow
WHERE Flag = 'Y'
    AND SSS_DOWID IN (28, 41, 44)

/*
DROP TABLE SSS_DOW
*/ 
```

如果您已经有一个日期缩写表，则可以加入该表，而不是我用来创建的临时 CTE。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-01T04:46:58.863

尝试制作七个插入语句：

```
INSERT INTO @strDays 
  SELECT SSS_DOWID, 1 FROM SSS_DOW WHERE SSS_DOWID IN (28,41,44) AND Sun = 'Y';

INSERT INTO @strDays 
  SELECT SSS_DOWID, 2 FROM SSS_DOW WHERE SSS_DOWID IN (28,41,44) AND Mon = 'Y';

etc. 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-13T14:24:10.217

尝试这样做，如果这不起作用，请告诉我。

```
DECLARE @strDays table
(SSS_DOWID int)

  INSERT INTO @strDays
 select substring(
 (SELECT  
 case (sun) when 'Y' then ',1' else '' end +  
 case (mon) when 'Y' then ',2' else '' end +   
 case (tue) when 'Y' then ',3' else '' end +  
 case (wed) when 'Y' then ',4' else '' end +   
 case (thu) when 'Y' then ',5' else '' end +  
 case (fri) when 'Y' then ',6' else '' end +   
  case (sat) when 'Y' then ',7' else '' end  
FROM   
  [dbo].SSS_DOW  WITH (NOLOCK)  
 WHERE  
 SSS_DOWID IN (28,41,44)  ),2,100)

SELECT * FROM @strDays 
```

# objective-c - 如何在 Xcode 中为 iPhone SDK 构建自定义控件？

> ID：499494
> 
> 赞同：9
> 
> 时间：2009-01-31T20:30:05.403
> 
> 标签：objective-c, iphone, xcode

我想构建一个自定义控件以在我的项目中重用，它由两个链接在一起的 UITextField + 一个标签组成。

它开始在我的应用程序中变得重复并且代码重复的味道;）

但是，我想知道这里最好的方法是什么。

最好是通过控制器中的代码来完成所有事情，还是可以像 Xcode 中内置的那样做视觉上的事情？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-31T21:04:42.400

您可以为此构建一个 Interface Builder 插件。这很简单。要开始使用，请阅读[Interface Builder Plug-In Programming Guide](http://developer.apple.com/documentation/DeveloperTools/Conceptual/IBPlugInGuide/Introduction/chapter_1_section_1.html)。它甚至有一个快速的分步教程来帮助您入门。Apple 建议为您的情况创建一个 IB 插件...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-24T01:00:35.713

我不认为这是可能的。我简要查看了 IB Plug-In Programming Guide，显然 Interface builder 插件是通过 Custom Cocoa Frameworks 实现的。也就是说，您的插件是在 Interface Builder 中加载的框架中定义的。IB 在当前项目框架中查找已定义的任何自定义组件，并将相应地加载插件。无法在 iPhone 上使用自定义或第三方框架，所以我看不出 IB 将如何在这里建立连接。如果有人有更多信息，我很乐意看到这个讨论继续进行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T21:06:09.077

这很好，只是它适用于 iPhone。iPhone 为界面构建器创建插件提供了更困难的环境。这*应该*是可能的，但我还没有看到这样做的 Xcode 项目。它们都仅限于创建桌面“AppKit”版本，而不是 IB 插件的 iPhone“UIKit”版本。

# active-directory - Adobe AIR 应用程序能否针对 Active Directory 实现 SSO 身份验证？

> ID：499501
> 
> 赞同：2
> 
> 时间：2009-01-31T20:32:34.057
> 
> 标签：active-directory, air, ldap, single-sign-on

我对 AIR 应用程序了解不多，但我喜欢我目前所看到的。所以现在，我想知道这种类型的应用程序在工作的 Intranet 中是否有意义。

在我投入时间和精力加速 AIR 开发之前，我想知道： *Windows 上的 AIR 应用程序是否可以针对 Active Directory 进行单点登录身份验证？* 我正在考虑一个 AIR 应用程序，它使用已登录用户的 Windows 凭据连接到在 Windows 身份验证打开的 IIS 上托管的 Web 服务。

我知道，如果我推出一个让用户输入密码的应用程序，IT 安全就会受到影响。任何不笨拙且使用 AD 完成 SSO 的解决方法也很酷。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-09-09T16:18:51.993

我已经使用 spnego.sourceforge.net 中的 SPNEGO servlet 过滤器成功设置了在 CentOS 5.4（Final）上运行的 Tomcat 6.0.26（最终版）和 Java 1.6.0_17-b04，以针对 Windows 2003 R2 Active Directory 域自动验证带有 IE 7.0 的 WindowsXP SP3。此外，我有一个 Adob​​e AIR 应用程序开发用于 Intranet，它也可以像 IE7 一样通过 SPNEGO 进行身份验证。

在让 Tomcat 在 CentOS 上运行之前，我按照 sourceforge.net 上的“飞行前检查表”和“安装指南-tomcat”链接让 Tomcat 在 Windows XP 服务器上使用 SPNEGO 过滤器。一旦我设置好 IE 可以自动验证，Adobe AIR 就可以工作了。

获得用户名后，我编写了一些代码从 AD LDAP 中提取用户组。Java LDAP 代码的有用链接可以从[http://forums.sun.com/thread.jspa?threadID=726601](http://forums.sun.com/thread.jspa?threadID=726601)开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-28T06:29:07.803

确实。如果 SSO 在 IE 中工作，它在您的 AIR 应用程序中工作。我们目前正在部署一个可以做到这一点的应用程序。

在 Windows 上运行的 AIR 将使用 Internet Explorer 中的 SSO 设置。只要您的用户可以在 IE 中使用 SSO 登录，他们就可以在 AIR 中进行同样的操作。这可以通过组策略设置轻松完成：将您的站点添加为 Intranet 站点，启用集成 Windows 身份验证，一切顺利。

到目前为止还没有遇到任何问题。我们已经用大约 10 个用户对其进行了测试。YMMV。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T21:08:00.583

Using AIR you can read files from the file system and you can open network connections, so that should get you somewhere.

What would the use of the SSO be? Describing a possible job that this AIR app should perform will help people to give a more helpful answer.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-24T22:46:43.533

查尔斯，

如果您有一些提取 IE 凭据的代码示例，我将非常感激看到它。我正在构建一个 Flex 应用程序，该应用程序可以访问 SharePoint 服务器上的内容，该服务器使用活动目录来验证权限。

# java - 替换java字符串中的正则表达式

> ID：499504
> 
> 赞同：1
> 
> 时间：2009-01-31T20:33:51.557
> 
> 标签：java, regex, string, replace

我有这个java字符串：

```
String bla = "<my:string>invalid_content</my:string>"; 
```

如何替换“invalid_content”部分？

我知道我应该使用这样的东西：

```
bla.replaceAll(regex,"new_content"); 
```

为了有：

```
"<my:string>new_content</my:string>"; 
```

但我无法发现如何创建正确的正则表达式

请帮忙 ：）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-31T20:42:14.693

你可以做类似的事情

```
String ResultString = subjectString.replaceAll("(<my:string>)(.*)(</my:string>)", "$1whatever$3"); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-01T15:05:43.483

马克的回答会起作用，但可以通过两个简单的更改来改进：

*   如果您不使用该组，则中间括号是多余的。
*   如果您有多个要匹配的 my:string 标签，则使其不贪婪会有所帮助。

给予：

```
String ResultString = SubjectString.replaceAll
    ( "(<my:string>).*?(</my:string>)" , "$1whatever$2" ); 
```

但这仍然不是我写它的方式 - 可以使用lookbehind和lookahead来简化替换，并且您可以避免重复标签名称，如下所示：

```
String ResultString = SubjectString.replaceAll
    ( "(?<=<(my:string)>).*?(?=</\1>)" , "whatever" ); 
```

当然，后一种可能对那些还不了解正则表达式的人不那么友好——但是它更易于维护/更灵活，所以如果您可能需要匹配的不仅仅是 my:string 标签，那么值得使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T17:19:44.617

请参阅[Java 正则表达式教程](http://java.sun.com/docs/books/tutorial/essential/regex/)并查看字符类和捕获组。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T20:42:30.010

[PCRE](http://www.pcre.org/)将是：

```
/invalid_content/ 
```

对于一个简单的替换。你还想要什么？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T20:43:20.337

是`invalid_content`固定值吗？如果是这样，您可以使用以下方法将其替换为新内容：

```
bla = bla.replaceAll("invalid_content","new_content"); 
```

# vb.net - Linq SubmitChanges 不起作用

> ID：499507
> 
> 赞同：0
> 
> 时间：2009-01-31T20:35:59.667
> 
> 标签：vb.net, linq

我有一些这样的代码：

```
Function GetTypeFromTableName(ByVal _TableName As String, ByVal _DataContext As DataContext)

            Dim Mytype As Type = (From t In _DataContext.Mapping.GetTables Where t.TableName = "dbo." + _TableName Select t.RowType.Type).SingleOrDefault
            Return Mytype

    End Function

 Dim DBA As New LINQDataContext
_TBLName="City"
 TableType = GetTypeFromTableName(_TBLName, DBA)

                CallByName(obj, "Code", CallType.Set,1)

                Dim Equery = From T In DBA.GetTable(TableType) Select T

                Equery = Equery.Where(Function(Oj1) Oj1 Is obj)

                Dim oopp = From t In Equery Select  CallByName(t, "CName", CallType.Get, Nothing)
                oopp.ToList.Item(0) = Txt_Name.Text
                DBA.SubmitChanges() 
```

提交更改不起作用。怎么了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T21:04:31.637

在我看来，您正在选择一个匿名类型列表，然后更改匿名类型列表中的值，而不是表中匹配对象中的值。由于您尚未更新表对象本身，因此 SubmitChanges 无关紧要。

尝试将其更改为以下

```
 Dim matchingObj = Equery.Where( Function(Oj1) Oj1 Is obj )
                          .SingleOrDefault(); 
```

然后设置属性值。

```
 CallByName( matchingObj, "CName", CallType.Set, Txt_Name.Text ); 
```

然后提交您的更改。

注意：我读VB没问题，但我写得不太好。你可能需要修正我的语法。在尝试设置它的属性之前，您可能还想确保存在匹配的对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-09T19:58:39.250

这是旧的，但我想我会来清理这个。

每当您的更新或 Submitchanges 失败时，请尝试 puttin InsertOnSubmit() 语句。该语句将为您提供详细的错误。

就我而言，我有非常简单的代码。

```
 var single = dataContext.MySysTables.FirstOrDefault();
        single.DispatchIdIndex ++;
        single.ModifyDate = DateTime.Now;
        dataContext.SubmitChanges(); 
```

这没有被更新。当我放置一个 InsertOnSubmit(single) 行时，它给了我“无法插入数据，因为表没有主键”的错误。这是我没有主键的测试表。一旦我添加了一个新列并创建了一个主键，一切就都很好了。

和平

# watin - 如何清除 WatiN 中选定的单选按钮？

> ID：499512
> 
> 赞同：0
> 
> 时间：2009-01-31T20:41:23.367
> 
> 标签：watin

我有一个很长的表格要测试，所以我创建了一个 CompleteForm() 辅助方法来完成表格。为了测试验证，我调用 CompleteForm()，然后使我想要测试的字段无效。无法弄清楚如何取消选中单选按钮。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T01:43:11.120

只需将对象的`Checked`属性设置为`RadioButton``false`

要取消选中页面上的所有单选按钮，您可以执行以下操作：

```
foreach(RadioButton rb in ie.RadioButtons)
{       
    rb.Checked = false
} 
```

# c# - gridview 将下拉列表绑定到列表 >

> ID：499526
> 
> 赞同：7
> 
> 时间：2009-01-31T20:45:38.163
> 
> 标签：c#, .net, asp.net, data-binding, drop-down-menu

我的数据库中有许多表包含对键值对的引用：

电话号码类型：

*   1 - 主页
*   2 - 工作
*   3 - 手机
*   4 - 传真

ETC

所以我有一个类型的表，当它们在其他表中使用时，它们将 int 值作为外键引用。当我将它们拉出来时，我一直将它们作为`keyvaluepair<int, string>`项目存储在使用它们的类中。

当我需要获取它们的列表时，我想我只需创建它们的 List<>，而不是使用两种不同类型的数据类型来获取相同的数据。

当我使用edittemplate位时需要在gridview中填充下拉列表时，我的问题就来了。如果我使用数据源将其拉出，它将在文本中写入 [1 Home]，而不是将 int 作为值并将 Home 作为要显示的文本。

我想我真的有一个多部分的问题。

一：

我是不是很傻？这是获取数据并存储数据（键值对部分）的一种非常糟糕的方法吗？我应该将其全部存储在数据表中吗？我不喜欢把它全部放在数据表中。我让我的 DAL 接受我的 BLL，并尝试将所有内容封装为对象或`List<>`对象的，而不是所有内容的表。大多数情况下，这运作良好。

二：

如果我使用某个对象而不是数据表来绑定到下拉列表的对象数据源，我该如何设置当前选择的值，而不是只选择列表中的第一项？

**编辑**

正如下面所指出的，我是个白痴，只需要设置 DataValueField 和 DataKeyField。

要绑定下拉列表，我只需要做：

```
SelectedValue='<%# DataBinder.Eval(Container, "DataItem.PhoneType.Key") %>' 
```

我没有立即看到它的原因是因为它没有出现在我的智能感知中，但是当我手动输入它时，它起作用了。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-31T20:58:28.717

使用 Dictionary<int, string> 并将 DropDown DataValueField 设置为*Key*并将 DataTextField 设置为*Value*。

```
 // A sample dictionary:
    var dictionary = new Dictionary<int, string>();
    dictionary.Add(1, "Home");
    dictionary.Add(2, "Work");
    dictionary.Add(3, "Mobile");
    dictionary.Add(4, "Fax");

    // Binding the dictionary to the DropDownList:
    dropDown.DataTextField = "Value";
    dropDown.DataValueField = "Key";
    dropDown.DataSource = dictionary;  //Dictionary<int, string>
    dropDown.DataBind(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-11-10T14:59:55.500

及其我的自定义方法

```
// Define enum
public enum ServiceType : int
{
    MinimumService = 1,
    NormalService = 2,
    VipService = 99
}

// custom method to get my custom text name for each enum type
public string GetServiceTypeName(ServiceType serviceType)
{
    string retValue = "";
    switch (serviceType)
    {
        case ServiceType.Print:
            retValue = "We have some services for you";
            break;
        case ServiceType.BookBinding:
            retValue = "We ar glad to meet you";
            break;
        default:
            retValue = "We alywas are ready to make you happy";
            break;
    }
    return retValue;
}

// making dictionary (key and value) for dropdown datasource
public static Dictionary<string, int> GetAllServiceTypeName()
{
    Dictionary<string, int> dataSource = new Dictionary<string, int>();

    foreach (int item in Enum.GetValues(typeof(ServiceType)))
        dataSource.Add(GetServiceTypeName((ServiceType)item), item);

    return dataSource;
}

   // bind the dropdown to dictionary
    ddlServiceType.DataSource = GetAllServiceTypeName();
    ddlServiceType.DataBind();

   // aspx markup code sample
    <asp:DropDownList ID="ddlServiceType" runat="server" 
        DataTextField="Key" DataValueField="Value">
    </asp:DropDownList> 
```

# java - android.provider.Telephony 发生了什么？

> ID：499528
> 
> 赞同：6
> 
> 时间：2009-01-31T20:45:59.163
> 
> 标签：java, android, message

有谁知道发生了`android.provider.Telephony`什么？它已经不存在了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-31T20:57:59.713

如果你从 android-developer 邮件列表中阅读[这篇](http://www.mail-archive.com/android-developers@googlegroups.com/msg11410.html)文章，你会发现它`android.provider.Telephony`是开源版本的一部分，但从未包含在官方 SDK 中。

这意味着您可以自由查看它，以了解底层系统的工作原理，但您实际上无法在您的 Android 应用程序中引用和编译它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T03:29:19.143

您在 anddev.org 上链接到的代码适用于 SDK 版本**m5-rc14**，该版本从 2008 年 2 月开始，几乎整整一年了。当前的 SDK 版本是 1.0，它和 m5-rc14 之间有两个版本。

鉴于 Android 项目的性质，他们在其快速增长/采用过程中添加和删除了许多接口。很多人抱怨他们正在关闭操作系统中一些很酷的部分的一些接口，例如电话接口。

您可以查看 android.telephony ( [link](http://code.google.com/android/reference/android/telephony/package-summary.html) ) 包，看看那里是否有等效的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T21:18:45.040

Thanks Brian, however, it seems Telephony is used by code posted on [this site](http://www.anddev.org/recognize-react_on_incoming_sms-t295.html).

In this excerpt from Apress (ISBN: 978-1-43021-064-1) by Chris Haseman, it is used too:

> Telephony class is used for sms messaging,
> 
> ```
> (Context context, Intent intent)
> {
> SmsMessage msg[] =
>     Telephony.Sms.Intents.getMessagesFromIntent(intent);
> ... 
> ```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-03T05:22:40.013

您还可以使用它从当前接收信号中获取数据。查看[本教程](http://www.firstdroid.com/2010/05/12/get-provider-gsm-signal-strength/)- 它使用电话管理器获取数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T23:15:35.203

I was able to send an SMS message with the G1 using the following library: android.telephony.gsm.SmsManager

So at least (for the SMS send/receive code) there is an equivalent library available.

Also be sure to check out the TelephonyManager [http://code.google.com/android/reference/android/telephony/TelephonyManager.html](http://code.google.com/android/reference/android/telephony/TelephonyManager.html)

This isn't exactly what you were asking about, but it does provide a lot of the functionality you're looking for.

As for the APress book reference in the answer above, I wrote it. As of right now, it's a little out of date (It was published before the 1.0 SDK was published) and I'm almost done updating it. Ahhh the joys of rapidly updating technology.

# php - 如何让php打开一个html文件，向上走两行，然后写在那里并关闭？

> ID：499542
> 
> 赞同：1
> 
> 时间：2009-01-31T20:52:30.490
> 
> 标签：php, html-table, fwrite

我正在制作一个小 php 文件来记录一些 IP 地址。它将 ips 和日期/时间写入 html 文件。html 文件将是一个表格。所以我想这样做：

```
<table cellpadding="6" rules="groups"  frame="no">
<thead>
<tr><th>IP</th><th>Date</th><th>Time</th></tr>

</thead>
<tbody>
<tr><td>192.168.0.1</td><td>31\. January 2009</td><td>19:21:09</td></tr> 
</tbody>
</table> 
```

所以我需要它来打开文件，在上面的行上写下 ip 和日期/时间`</table>` 我已经有了 php 来写我想要的东西，但是它写了一个底部。

我是新手，不知道在哪里放什么。。

这就是我所拥有的：

```
<?php
$ip = $_SERVER['REMOTE_ADDR']; 
$date = date("j. F Y"); 
$time = date("H:i:s"); 
$file = fopen('./iplogg.html', 'a', 1); 
$text="<tr><td>{$ip}</td><td>{$date}</td><td>{$time}</td></tr> \n"; 
fwrite($file, $text); 
fclose($file); 
?> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T21:05:21.370

我将假设文件中只有一个表。如果有多个，这会将其添加到每个中。

```
<?php
$ip = $_SERVER['REMOTE_ADDR']; 
$date = date("j. F Y"); 
$time = date("H:i:s"); 
$text="<tr><td>{$ip}</td><td>{$date}</td><td>{$time}</td></tr> \n"; 

$originalfile = file_get_contents ('./iplogg.html');
$newFile = str_replace('</table>',$text.'</table>',$originalfile);
file_put_contents('./iplogg.html', $newFile);
?> 
```

**编辑**将我的建议与您的代码混合在一起

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T18:42:47.970

我建议使用 2 个文件，一个 .log 文件存储原始数据，一个 .php 脚本从该 .log 文件读取并生成一个表。主要原因是：

1）您的 .log 文件将保持小得多

2）如果你想改变布局，它总是可以通过编辑 .php 脚本

3) 当您的 .log 文件变得巨大时，可能无法使用 file_get_contents 将其内容存储到字符串中

# javascript - Javascript YUICompressor 错误

> ID：499546
> 
> 赞同：7
> 
> 时间：2009-01-31T20:54:58.347
> 
> 标签：javascript, yui, yui-compressor

使用 YUICompressor 我从我的 javascript 代码中得到以下错误：

```
    [错误] 270:201: 后缺少名称。操作员
    [错误] 292:6: 缺失；声明之前

```

这是以下几行的javascript代码：

第 270 行：

```
new _ow.getScript(_ow.wwwurl+'/widget/save?title='+encodeURIComponent(this.obj.title.value)+'&url='+encodeURIComponent(this.obj.url.value)+'&tags='+this.obj.tags.value+'&private='+this.obj.private.checked+'&c='+this.obj.notes.value+'&service='+services+'&token='+(_ow.token ? encodeURIComponent(_ow.token): ''), function(data) { 
```

第 292 行：

```
}); 
```

我无法弄清楚问题出在哪里，因为这段 Javascript 代码在所有浏览器上都可以正常工作。

* * *

**编辑**：我将行拆分为多行，并发现“. operator 之后缺少的名称”是由以下代码生成的：

```
this.obj.private.checked 
```

**私人**是让 YUI 压缩器发疯的关键字吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-31T23:10:18.607

[`private`是保留字。](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Reserved_Words)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-31T21:05:42.053

首先，我将重新格式化代码以使其更具可读性：

```
new _ow.getScript(_ow.wwwurl
    + '/widget/save?title='
    + encodeURIComponent(this.obj.title.value)
    + '&url='
    + encodeURIComponent(this.obj.url.value)
    + '&tags='
    + this.obj.tags.value
    + '&private='
    + this.obj.private.checked
    + '&c='
    + this.obj.notes.value
    + '&service='
    + services
    + '&token='
    + (_ow.token
        ? encodeURIComponent(_ow.token)
        : ''),
    function(data) {
    }); 
```

然后，压缩机报告的 # 行应该可以帮助您深入了解问题所在。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-02-25T17:48:26.143

请记住使用选项 --type js ex。

```
yuicompressor --type js -o comressed.js filetocompress.js 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-02-17T10:24:13.780

您可以下载并安装 apache ant，下载 yui 源代码，编辑源代码（在 src 文件夹中，在 org 和 com 子文件夹中）以删除对阻碍您进度的关键字的所有引用（它运行得很快，我编辑了大约 3我认为有 4 个文件，必须运行 ant 两次，因为第一次出现引用错误，但只需要删除引用关键字的另一行），一旦 ant 编译成功，你就有一个全新的 .jar，你可以使用它编译有问题的 js。使用 yuicompressor2-4.7 和 "import" 关键字（在 mozilla 扩展代码中广泛使用）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T21:02:28.987

只需将其拆分为多行，您就可以使自己的生活更轻松。无论如何你都在压缩它，所以它不会对最终大小产生影响......

# .net - 如何指定列表属性的内容是 xml 序列化的，但属性本身不应该在标记中重新表示？

> ID：499550
> 
> 赞同：1
> 
> 时间：2009-01-31T20:57:11.247
> 
> 标签：.net, xml-serialization

我有这样的课：

```
[XmlRoot("channel")]
public class Channel
{
   [XmlElement("title")]
   public String Title { get; set; }

   [WhatElseGoesHere]
   [XmlArrayItem("item")]
   public List<Item> Items { get; set; }
} 
```

我想要的输出是这样的：

```
<channel>
   <title>The title</title>
   <item>{item content}</item>
   <item>{item content}</item>
</channel> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T22:47:16.077

您可以从 xml 开始并重新开始工作吗？将所需的 xml 放入文件 ( `foo.xml`) 中，然后：

```
xsd foo.xml
xsd foo.xsd /classes
notepad foo.cs 
```

这通常会提供*一个*答案——尽管您通常可以用不同的方式做同样的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T22:13:16.193

您可以尝试使用[XmlElementAttribute](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlelementattribute.aspx)而不是[XmlArrayItemElementAttribute](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlarrayitemattribute.aspx)：

```
[XmlRoot("channel")]
public class Channel
{
    [XmlElement("title")]
    public String Title { get; set; }

    [XmlElement("item")]
    public List<Item> Items { get; set; }
} 
```

# sql - 两列的唯一索引加上每一列的单独索引？

> ID：499559
> 
> 赞同：0
> 
> 时间：2009-01-31T21:02:55.587
> 
> 标签：sql, optimization, indexing

我对数据库优化知之甚少，但我试图了解这种情况。

假设我有下表：

```
cities
===========
state_id integer
name varchar(32)
slug varchar(32) 
```

现在，假设我想执行这样的查询：

```
SELECT * FROM cities WHERE state_id = 123 AND slug = 'some_city'
SELECT * FROM cities WHERE state_id = 123 
```

如果我希望一个城市的“slug”在其特定州内是唯一的，我会在 state_id 和 slug 上添加一个唯一索引。

这个指数够吗？或者我还应该在 state_id 上添加另一个以便优化第二个查询？还是第二个查询自动使用唯一索引？

我正在研究 PostgreSQL，但我觉得这种情况非常简单，以至于大多数 DBMS 的工作方式都类似。

另外，我知道这肯定不会对小桌子产生影响，但我的例子很简单。想想 200k+ 行表。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T21:25:47.677

**[编辑：误读了这个问题......希望我的回答现在更相关！]**

在您的情况下，我建议在`(state_id, slug)`. 如果您只需要按 搜索，请仅`slug`在该列上添加索引。如果你有这些，那么添加另一个索引`state_id`是不必要的，因为第一个索引已经覆盖了它。

每当在 WHERE 子句**中使用其列的初始段**时，都可以使用索引。因此，例如，列 A、B 和 C 上的索引将优化包含涉及 A、B 和 C 的 WHERE 子句、仅包含 A 和 B 的 WHERE 子句或仅包含 A 的 WHERE 子句的查询。请注意，列在索引定义中出现的顺序非常重要——这个示例索引不能用于只涉及 B 和/或 C 的 WHERE 子句。

（当然，是否实际使用特定索引取决于查询优化器，但在您有 200k 行的情况下，您可以保证简单搜索`state_id`或`slug`两者都将使用其中一个索引。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-31T21:26:21.013

任何体面的优化器都会在三列上看到一个索引——比如：

```
CREATE INDEX idx_1 ON SomeTable(Col1, Col2, Col3); 
```

并将将该索引用于以下任何条件：

```
WHERE Col1 = ...something...

WHERE Col1 = ...something... AND Col2 = ...otherthing...

WHERE Col3 = ....whatnot....
  AND Col1 = ...something....
  AND Col2 = ...otherthing... 
```

也就是说，如果有条件应用于索引列的任何连续前导子集，它将使用索引。尽管我使用了相等，但它也可以应用于范围（例如，开 - 仅大于）或闭（在两个值之间）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T00:42:48.513

(state_id, slug) 上的单个唯一索引就足够了。当然，可以肯定的是，您需要运行 EXPLAIN 和/或 ANALYZE （也许在[http://explain.depesz.com/](http://explain.depesz.com/)之类的帮助下），但最终哪些索引是合适的，很大程度上取决于哪种索引您将要运行的查询。请记住，索引使 SELECT 更快，而 INSERT、UPDATE 和 DELETE 更慢，因此理想情况下您只需要实际需要的索引。

此外，PostgreSQL 有一个智能查询优化器：它将对小表和大表的查询使用完全不同的搜索计划。如果表很小，它只会进行顺序扫描，甚至不会打扰*任何*索引，因为使用它们的开销比暴力筛选表要高。一旦表大小超过阈值，这将更改为不同的计划，并且如果表再次变大，或者您更改 SELECT 或....

摘要：您不能相信 EXPLAIN 和 ANALYZE 在比实际数据更小或不同的数据集上的结果。让它工作，然后让它快速（如果你需要）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T21:22:46.217

要进行优化，请使用 EXPLAIN [http://www.postgresql.org/docs/7.4/static/sql-explain.html](http://www.postgresql.org/docs/7.4/static/sql-explain.html)并自己查看。但优化并不是制作这些索引的最重要原因；首先，它是一个限制数据库不合逻辑的约束。

# algorithm - 对大型数据集进行高效重新排序，以最大限度地提高内存缓存效率

> ID：499562
> 
> 赞同：1
> 
> 时间：2009-01-31T21:04:14.053
> 
> 标签：algorithm, caching, graph-theory, ram

我一直在研究一个我认为人们可能会感兴趣的问题（也许有人知道预先存在的解决方案）。

我有一个大型数据集，由一长串指向对象的指针组成，如下所示：

```
[
  (a8576, b3295), 
  (a7856, b2365), 
  (a3566, b5464),
  ...
] 
```

任何时候都有太多的对象需要保存在内存中（可能有数百 GB），因此它们需要存储在磁盘上，但可以缓存在内存中（可能使用 LRU 缓存）。

我需要遍历这个列表来处理每一对，这需要将这对中的两个对象都加载到内存中（如果它们还没有缓存在那里）。

所以，问题是：有没有办法重新排序列表中的对以最大化内存缓存的有效性（换句话说：最小化缓存未命中的数量）？

**笔记**

1.  显然，重新排序算法应该尽可能快，并且不应该依赖于能够一次将整个列表保存在内存中（因为我们没有足够的 RAM）——但它可以迭代必要时列出数次。

2.  如果我们处理的是单个对象，而不是对，那么简单的答案就是对它们进行排序。这显然在这种情况下不起作用，因为您需要考虑这对中的两个元素。

3.  问题可能与找到[最小图割](http://en.wikipedia.org/wiki/Cut_(graph_theory))有关，但即使问题是等价的，我认为最小割的解决方案也不满足

4.  我的假设是启发式方法会将数据从磁盘中流出，并以更好的顺序将其分块写回。它可能需要多次迭代。

5.  实际上，它可能不仅仅是成对的，它可能是三胞胎、四胞胎或更多。我希望对对执行此操作的算法可以很容易地推广。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T21:35:55.737

首先，您可以[映射](http://en.wikipedia.org/wiki/Mmap)列表。如果有足够的地址空间，而不是内存，例如在 64 位 CPU 上，这将有效。这使得按顺序访问元素变得更加容易。

您可以根据缓存中考虑这两个元素的最小距离对该列表进行排序，如果对象位于连续空间中，则效果很好。排序函数可能类似于：将 (a, b) 与 (c, d) = (a - c) + (b - d) 进行比较（看起来像汉明距离）。然后根据列表提取对象存储的切片并进行处理。

编辑：修复了远处的一个错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-31T21:48:12.000

即使您不*只是*对该列表进行排序，[多路合并排序](http://jea.acm.org/ARTICLES/Vol5Nbr3/node3.html)的一般模式也可能适用 - 也就是说，考虑将集合的某种（可能是递归的）分解为可以在内存中单独处理的较小集合，然后是第二个阶段，之前处理过的集合的小块可以全部组合在一起。即使不知道您对这些对所做的具体性质，可以肯定地说，当您处理已排序的数据时，许多算法问题会变得更加简单（包括图形问题，这可能是您的手在这里）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T10:30:33.117

您的问题与计算机图形硬件的类似问题有关：

在三角形网格中渲染索引顶点时，通常硬件会缓存最近转换的顶点（上次我不得不担心它时大约有 128 个，但怀疑这些天这个数字更大）。未缓存的顶点需要相对昂贵的变换操作来计算。用于重构三角形网格以优化缓存使用的“网格优化”曾经是一个非常热门的研究课题。谷歌搜索顶点缓存优化（或优化：^）可能会找到一些与您的问题相关的有趣材料。正如其他海报所暗示的那样，我怀疑有效地做到这一点将取决于利用数据中任何固有的连贯性。

另一件要记住的事情：当 LRU 缓存变得过载时，非常值得更改为 MRU 替换策略，以至少在内存中保留一些项目（而不是每次传递都翻转整个缓存）。我似乎记得 John Carmack 就这个主题写了一些与 Direct3D 纹理缓存策略相关的好材料。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T21:29:24.393

我认为这个问题的答案将在很大程度上取决于这对对象的访问模式。正如您所说，在简单的非配对情况下，最好只对指针进行排序。在更复杂的情况下，如果模式使得这些值的局部性更重要（例如，这些是键/值对并且您正在做一个很多搜索，键的位置比值的位置更重要）。

所以，真的，我的回答是这个问题不能在一般情况下回答。

为了存储您的结构，您真正想要的可能是[B-tree](http://en.wikipedia.org/wiki/B-tree)。这些是为您正在谈论的内容而设计的——跟踪您不想（或不能）将整个内容保存在内存中的大型集合。

# internet-explorer - 是否可以在我的网站上禁用 IE8“加速器”？

> ID：499565
> 
> 赞同：10
> 
> 时间：2009-01-31T21:04:55.160
> 
> 标签：internet-explorer, user-interface

我是一名专注于 UI 的网络开发人员。

我的 Web 应用程序中的许多界面功能都是基于双击的。

在 IE 中，这会出现新的烦人的**“加速器”图标，它会干扰我的用户界面**。是否可以在我的页面上禁用“加速器”？也许有一些新的愚蠢的 IE 特定**元标记**？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-01T00:34:17.610

尽管我对您有感觉（我认为没有任何方法可以在代码中禁用它们），但我建议您不要在很多用户界面上使用双击，因为它违反了 Web 的范式。

许多用户在网站上被告知不要双击以避免重复交易等。

我唯一能真正想到的解决方法是做一些明确的事情：

```
.blur(); 
```

在触发双击事件的元素上。我还没有尝试过，但我*希望*这会使[加速器](http://blogs.msdn.com/ie/archive/2008/03/06/activities-and-webslices-in-internet-explorer-8.aspx)图标消失。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-08T15:09:18.757

使用 JQuery：

```
$('body').bind('selectstart', function(e) { return $(e.target).is(':input'); }); 
```

这将禁用选择页面内容，输入元素除外。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-04-08T19:25:22.447

就我而言，当我跟踪 mousedown/mousemove/mouseup 事件时，会弹出加速器。为了防止它，我清除了 mouseup 上的文档选择。

```
if (document.selection)
    document.selection.clear(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T19:35:47.683

您可以使用带有 return false 的 Internet Explorer 自定义事件 selectstart 来防止显示丑陋的切片图标。

更新：我见过几个解决方案，其中涉及 getElement -> 添加事件侦听器之类的东西。这不是理想的解决方案。使用冒泡效果更好。只需在文档上注册一个 selectstart 就足够了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-23T09:54:19.477

怀疑你是否仍然需要这个，但是对于每个被这个加速器功能烦恼的人，去......

工具 > Internet 选项 > 高级

然后取消选中“浏览”下的“选择时显示加速器按钮”框。

干杯。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-08-21T01:36:14.080

可能在网站上，我们可以通过在 body 元素中添加属性 oncontextmenu="return false:" 来阻止加速器。我怀疑冒号是否属于那里，也许“假”这个词就是这个值所需要的。考虑到何时提出建议，这是针对 beta 版本的；我不知道IE8最终版本是否有相同的禁用方法。我没有 IE8 或最近的 Win，所以我无法测试它。它可能会阻止所有上下文菜单，而不仅仅是那些特定于正在查看的网站的菜单。[请参阅http://www.utteraccess.com/forums/showflat.php?Cat=&Board=50&Number=1804672&Zf=&Zw=&Zg=0&Zl=a&Main=1804672&Search=true&where=&Zu=140925&Zd=l&Zn=&Zt=15&Zs](http://www.utteraccess.com/forums/showflat.php?Cat=&Board=50&Number=1804672&Zf=&Zw=&Zg=0&Zl=a&Main=1804672&Search=true&where=&Zu=140925&Zd=l&Zn=&Zt=15&Zs=b&Zy=#Post1804672&Zp=)中的最后一篇文章[=b&Zy=#Post1804672&](http://www.utteraccess.com/forums/showflat.php?Cat=&Board=50&Number=1804672&Zf=&Zw=&Zg=0&Zl=a&Main=1804672&Search=true&where=&Zu=140925&Zd=l&Zn=&Zt=15&Zs=b&Zy=#Post1804672&Zp=)

关于接受双击的网站是否是一个坏主意：如果访问者被告知它们，它们是可以的，无论是想要获得双击好处的访问者还是需要知道不要双击的访问者以避免不必要的影响。否则，我怀疑它们的可用性是否良好。

谢谢。

——尼克

# asp.net - 我的用户可能安装了什么会破坏我的网络应用程序？

> ID：499566
> 
> 赞同：2
> 
> 时间：2009-01-31T21:05:01.930
> 
> 标签：asp.net

那里可能有成千上万的应用程序，例如“ [Google Web Accelerator](http://radar.oreilly.com/archives/2005/05/google-web-acce-1.html) ”和各种[弹出窗口阻止](http://www.google.com/tools/firefox/toolbar/FT5/intl/en/index.html)程序。然后是[标题阻止](https://stackoverflow.com/questions/257609/which-browsers-plugins-block-httpreferer-from-being-sent) [个人防火墙](http://en.wikipedia.org/wiki/Personal_firewall)、[完整站点](http://www.netnanny.com/)阻止程序和[偏执的 cookie 怪物](http://www.ccsf.edu/Info/FAQ/cookies.html)。

幸运的是，Web Accelerator 现在已经失效（我建议您阅读上面的文章 - 它引起的问题实际上很有趣）但是那里有很多其他插件和第三方应用程序，因此在您的应用程序发布之前不可能对它们进行全部测试在野外。

我正在寻找的是关于在编写网络应用程序（无论是什么技术）时要记住的最重要的事情的建议，以确保用户的环境不会破坏它。有点像清单。

你经历过的最疯狂的事情是什么？

PS。我可能已经链接到上面的 net-nanny，但我并不是要制作色情网站

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T21:15:06.637

The best advice I can give is to program defensively. For example, don't assume that all of your scripts may be loaded. I've seen cases where AdBlocker Plus will block 1/10 scripts that are included in a page just because it has the word "ad" in the name or path. While you can work around this by renaming the file, it's still good to check that a particular object exists before using it.

The weirdest thing I've seen wasn't so much a browser plugin but a firewall/proxy configuration at a user's workplace. They were using a squid proxy that was trying to remove ads by replacing any image HTTP request that it thought was an ad with a single pixel GIF image. Unfortunately it did this for non-GIF images too so when our iPhone application was expecting a PNG image and got a GIF, it would crash.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T21:19:05.973

Internet Explorer 6\. :)

No, but seriously. Firefox plugins like noscript and greasemonkey for one, though those are likely to be a very small minority.

Sometimes the user's environment means a screen reader (or even a braille interface like [this](http://www.linuxjournal.com/files/linuxjournal.com/linuxjournal/articles/099/9978/9978f2.png)). If your layout is in any way critical to the content being delivered as intended, you've got a problem right there.

Web pages break, fact of life; the closer you have been coding and designing up against standards, the less your fault it is.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T21:23:03.563

Something I have checked in the past is loading some of the more popular toolbars that people tend to install (Google, Yahoo, MSN, etc) and seeing how that affects the users experience.

To a certain extent it is difficult to preempt which of the products you mentioned will be used by your users since there are so many. I would say your best bet is to test for the most frequent products that your user base may employ and roll with the punches for the rest. If you have the time to test other possible scenarios, by all means do.

Also, making it easy for your users to report possible issues also helps lessen the time it takes to get a fix in place should it be something you can work around.

# domain-driven-design - Antlr 是 DSL 生成器还是有意编程的替代品？

> ID：499573
> 
> 赞同：4
> 
> 时间：2009-01-31T21:06:38.277
> 
> 标签：domain-driven-design, antlr, dsl, intentional-programming

Charles Simonyi 首先是在微软，然后是在他自己的公司，努力建立意向编程领域的雄心和创造力让我印象深刻。

[究竟什么是意向编程](https://stackoverflow.com/questions/201386/what-exactly-is-intentional-programming)

[http://en.wikipedia.org/wiki/Intentional_programming](http://en.wikipedia.org/wiki/Intentional_programming)

> 在这种软件方法中，程序员首先构建一个特定于给定问题域（例如人寿保险）的工具箱。领域专家在程序员的帮助下，然后以所见即所得 (WYSIWYG) 的方式描述程序的预期行为。自动化系统使用程序描述和工具箱来生成最终程序。后续更改仅在 WYSIWYG 级别进行。

它似乎是一种非常有用且实用的编程方法，可能会规避当前软件开发方法的许多问题。

从本质上讲，它似乎有助于非程序员（业务/系统分析师）创建特定领域的语言，但在一个比 UML 所能提供的更接近实际实现的阶段。他说它最终会完成，但它还没有（大约 15 年后）。

DSL 涵盖了从简单的 5 行规则引擎到 Ruby on Rails 等复杂应用程序的所有领域。所以我认为延迟发布他的产品与他正在处理简化更高级别的抽象这一事实有关，因为他必须基本上允许同时封装所有领域语言。

所以，我的问题是

**(a) [Antlr](http://en.wikipedia.org/wiki/ANTLR)是否可以替代意向编程——尽管可能是一个不太用户友好的替代方案，需要程序员的干预而不是允许业务分析师生成 DSL？** **您可以使用 Antlr 生成像 Ruby on Rails 这样的 DSL（假设它支持 Ruby 作为输出 - 我认为它不支持）？它不能做什么？另外，我不明白为什么它被称为“语言解析器”而不是“语言生成器”——因为后者描述了它的用途，而前者描述了它如何实现最终结果。**

和

**(b) 如果 Antlr 和 Intentional Programming 不同，有没有类似 Intentional Programming 的东西？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-02-18T23:16:05.980

在回答 b) 部分时，在类似空间中工作的三个系统是：

*   [**JetBrains MPS**](http://www.jetbrains.com/mps/index.html)
*   [**Eclipse xText**](http://www.eclipse.org/Xtext/)
*   [**MetaCase MetaEdit+**](http://www.metacase.com/)

这些产品中的每一个都有不同的优点和缺点，但它们都属于[Language Workbenches](http://martinfowler.com/articles/languageWorkbench.html)的类别。Intentional Software 的 Intentional Workbench 可能是迄今为止该类别中最雄心勃勃的产品，但也不是普遍可用的。

MPS 和 xText 是免费的开源产品。MetaCase 是最成熟的，是一个商业产品。他们都有一个陡峭的学习曲线。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T23:51:50.037

我不是这方面的专家，所以用一大撮盐来处理。然而...

ANTLR 本身不是 DSL 生成器，尽管它可以用来创建解释 DSL 的代码。它是一个解析器生成器——但 DSL 生成器必须创建 ANTLR 从中生成解析器的内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T13:41:44.180

ANTLR 只是一个解析器生成器。在任何重要的 DSL 中，编写解析器所花费的精力不到实现 DSL 的 50%。评估器/规则引擎/代码生成器/时间表或您的 DSL 所做的任何其他事情，可能需要更多的工作并且不能像解析器那样生成。

# c# - C# LINQ Query - Group By

> ID：499578
> 
> 赞同：28
> 
> 时间：2009-01-31T21:08:01.910
> 
> 标签：c#, .net, linq

I'm having a hard time understanding how I can form a LINQ query to do the following:

I have a table CallLogs and I want to get back a single result which represents the call that has the longest duration.

The row looks like this:

> [ID] [RemoteParty] [Duration]

There can be multiple rows for the same RemoteParty, each which represents a call of a particular duration. I'm wanting to know which RemoteParty has the longest total duration.

Using LINQ, I got this far:

```
var callStats = (from c in database.CallLogs
                 group c by c.RemoteParty into d
                 select new
                 {
                      RemoteParty = d.Key,
                      TotalDuration = d.Sum(x => x.Duration)
                 }); 
```

So now I have a grouped result with the total duration for each RemoteParty but I need the maximum single result.

> [DistinctRemoteParty1] [Duration]
> 
> [DistinctRemoteParty2] [Duration]
> 
> [DistinctRemotePartyN] [Duration]

How can I modify the query to achieve this?

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-31T21:25:23.327

Order the result and return the first one.

```
var callStats = (from c in database.CallLogs
                 group c by c.RemoteParty into d
                 select new
                 {
                      RemoteParty = d.Key,
                      TotalDuration = d.Sum(x => x.Duration)
                 });

callStats = callStats.OrderByDescending( a => a.TotalDuration )
                     .FirstOrDefault(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-31T21:50:28.313

Have a look at the "Max" extension method from linq

```
callStats.Max(g=>g.TotalDuration); 
```

# c# - Linq to Sql 枚举和条件运算符

> ID：499585
> 
> 赞同：1
> 
> 时间：2009-01-31T21:13:37.140
> 
> 标签：c#, linq, linq-to-sql, enums

无论我采用哪种方式，在 Linq to Sql 中的枚举值上使用条件运算符时似乎都会出现问题。例如

```
var ret = from listings in db.Listings
  select new Listing
   {
   ID = listings.ID,
   //etc
   OrderStatus = listings.OrderItems.Count > 0 
   ? listings.OrderItems.First().Order.OrderStatus : OrderStatus.NotCheckedOut
}; 
```

> System.Data.SqlClient.SqlException：将 nvarchar 值“Charged”转换为数据类型 int 时转换失败。

当我将枚举字段保留为映射到字符串的 nvarchar 时，我会遇到类似的转换错误。如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T21:32:39.457

这行得通，也许有更好的方法？

```
var ret = from listings in db.Listings
let ordS = listings.OrderItems.Count > 0 ? 
                        listings.OrderItems.First().Order.OrderStatus.ToString() : OrderStatus.NotCheckedOut.ToString()
  select new Listing
   {
   ID = listings.ID,
   //etc
   OrderStatus = (OrderStatus)Enum.Parse(typeof(OrderStatus), ordS)
}; 
```

# wcf - 如何使用主机应用程序轻松部署证书？

> ID：499588
> 
> 赞同：1
> 
> 时间：2009-01-31T21:14:25.500
> 
> 标签：wcf, deployment, certificate

我的用例非常简单：我有一个 GUI 应用程序，在这个应用程序中我托管了一个服务，但是这个服务的客户端必须能够安全地使用 UserName 进行身份验证（我唯一想要的是加密消息以确保没有人可以嗅探来检索客户的密码，我不关心更多的安全性）。

所以，我想用我的 GUI 应用程序发送一个证书，并且我的主机（在 GUI 应用程序内......我知道它有点脏）使用证书来加密消息。

所以我的问题是：我的要求是否要求我在主机上的商店内安装证书？我是否有义务为每个主机生成一个带有 makecert 的新证书？

部署我的应用程序的最简单方法是什么？

（我控制客户端应用程序，因此证书的验证不是问题）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T21:45:21.537

首先，您不应该**使用**makecert 来生成生产证书。

您可以将证书存储在代码中而不是机器中，但请记住，整个加密的安全性与证书私钥的安全性一样好。如果运行应用程序的机器是安全的，您可以使用证书“incode”，但如果您不能保证主机的安全性，您应该在 Windows Store 中安装证书。确保运行应用程序的用户有权读取证书的私钥。

如果使用 WSE 或 WCF，请确保您测试提供的默认消息或传输加密方法，以查看它们是否足以供您使用。

[以下](http://social.msdn.microsoft.com/Forums/en-US/windowsgeneraldevelopmentissues/thread/c16d5637-1b21-450f-9646-fe3ecd9f8a4a/)是一些以编程方式使用私钥（.pfx 文件）安装证书的参考。

# ssl - HTTPS URL 是否加密？

> ID：499591
> 
> 赞同：1191
> 
> 时间：2009-01-31T21:15:34.577
> 
> 标签：ssl, https, httprequest

使用 TLS/SSL (HTTPS) 加密时是否对所有 URL 进行了加密？我想知道，因为我希望在使用 TLS/SSL (HTTPS) 时隐藏所有 URL 数据。

如果 TLS/SSL 为您提供完整的 URL 加密，那么我不必担心隐藏 URL 中的机密信息。

* * *

## 回答 #1

> 赞同：1027
> 
> 时间：2009-01-31T21:17:39.770

是的，SSL 连接位于 TCP 层和 HTTP 层之间。客户端和服务器首先建立一个安全的加密 TCP 连接（通过 SSL/TLS 协议），然后客户端将通过该加密的 TCP 连接发送 HTTP 请求（GET、POST、DELETE...）。

* * *

## 回答 #2

> 赞同：883
> 
> 时间：2016-08-02T18:26:34.653

由于没有人提供有线捕获，这是一个。
**服务器名称**（URL 的域部分）以**纯文本**`ClientHello`形式显示在数据包中。

 **下面显示了一个浏览器请求：
`https://i.stack.imgur.com/path/?some=parameters&go=here`

[![ClientHello SNI](https://i.stack.imgur.com/rdHZZ.png)](https://i.stack.imgur.com/rdHZZ.png) [有关 TLS 版本字段的更多信息，请参阅此答案](https://security.stackexchange.com/a/32790)（其中有 3 个 - 不是版本，每个字段都包含版本号！）

来自[https://www.ietf.org/rfc/rfc3546.txt](https://www.ietf.org/rfc/rfc3546.txt)：

> 3.1。服务器名称指示
> 
> **[TLS] 没有为客户端提供一种机制来告诉服务器它正在联系的服务器的名称。** 客户端可能希望提供此信息以促进与在单个底层网络地址托管多个“虚拟”服务器的服务器的安全连接。

> **为了提供服务器名称，客户端可以在（扩展的）客户端 hello 中包含类型为“server_name”的扩展。**

### 简而言之：

*   如果使用 SNI 扩展，FQDN（URL 的域部分）**可以**在数据包内**以明文**形式传输`ClientHello`

*   由于请求 URL 是 HTTP 事物（OSI 第 7 层），`/path/?some=parameters&go=here`URL的其余部分（这将在HTTP 请求`ClientHello`中稍后出现，在**安全**TLS 通道建立**之后。**`GET /path/?some=parameters&go=here HTTP/1.1`

 ****## 执行摘要

域名可以明文传输（如果在 TLS 握手中使用 SNI 扩展），但 URL（路径和参数）始终是加密的。

## 2019 年 3 月更新

感谢[carlin.scott](https://stackoverflow.com/users/576153/carlin-scott)提出这个问题。

现在可以通过[这个 RFC 提案草案](https://datatracker.ietf.org/doc/html/draft-ietf-tls-esni-03#section-3.2)对 SNI 扩展中的有效负载进行加密。此功能仅存在于 TLS 1.3 中（作为一个选项，由两端来实现）并且与 TLS 1.2 及更低版本没有向后兼容性。

CloudFlare 正在这样做，您可以在此处阅读有关内部结构的更多信息 — [如果鸡必须先于鸡蛋，那么您将鸡放在哪里？](https://blog.cloudflare.com/encrypted-sni/)

在实践中，这意味着现在不是以纯文本形式传输 FQDN（如 Wireshark 捕获节目），而是对其进行加密。

**注意：**这解决了隐私方面的问题，而不是安全方面的问题，因为反向 DNS 查找可能无论如何都会显示预期的目标主机。

## 2020 年 9 月更新

现在有一个用于加密整个 Client Hello 消息的 RFC 草案，而不仅仅是 SNI 部分： [https ://datatracker.ietf.org/doc/draft-ietf-tls-esni/?include_text=1](https://datatracker.ietf.org/doc/draft-ietf-tls-esni/?include_text=1)

在撰写此浏览器时，支持非常有限。

* * *

## 回答 #3

> 赞同：173
> 
> 时间：2009-01-31T21:26:58.797

正如[其他](https://stackoverflow.com/questions/499591/are-https-urls-encrypted/499594#499594) [答案](https://stackoverflow.com/questions/499591/are-https-urls-encrypted/499595#499595)已经指出的那样，https“URL”确实是加密的。但是，您在解析域名时的 DNS 请求/响应可能不是，当然，如果您使用的是浏览器，您的 URL 也可能会被记录。

* * *

## 回答 #4

> 赞同：107
> 
> 时间：2009-01-31T21:17:50.207

整个请求和响应都是加密的，包括 URL。

请注意，当您使用 HTTP 代理时，它知道目标服务器的地址（域），但不知道该服务器上的请求路径（即请求和响应总是加密的）。

* * *

## 回答 #5

> 赞同：107
> 
> 时间：2013-07-28T06:49:31.473

我同意前面的回答：

明确地说：

使用 TLS，URL 的第一部分 ( [https://www.example.com/](https://www.example.com/) ) 在建立连接时仍然可见。第二部分（/hereemygetparameters/1/2/3/4）受 TLS 保护。

但是，有很多原因导致您不应该在 GET 请求中放入参数。

首先，正如其他人已经提到的： - 通过浏览器地址栏泄漏 - 通过历史记录泄漏

除此之外，您还通过 http 引用者泄漏了 URL：用户在 TLS 上看到站点 A，然后单击指向站点 B 的链接。如果两个站点都在 TLS 上，则对站点 B 的请求将包含来自站点 A 的完整 URL请求的referer参数。站点 B 的管理员可以从服务器 B 的日志文件中检索它。）

* * *

## 回答 #6

> 赞同：53
> 
> 时间：2009-01-31T21:20:09.343

是和不是。

# 服务器地址部分未加密，因为它用于建立连接。

这可能会在未来随着加密的 SNI 和 DNS 而改变，但截至 2018 年，这两种技术都不常用。

# 路径、查询字符串等被加密。

请注意，对于 GET 请求，用户仍然可以从地址栏中剪切和粘贴 URL，并且您可能不希望在其中放置任何人都可以看到屏幕的机密信息。

* * *

## 回答 #7

> 赞同：49
> 
> 时间：2010-11-02T14:03:18.083

Marc Novakowski 提供的有用答案的补充 - URL 存储在服务器上的日志中（例如，在 /etc/httpd/logs/ssl_access_log 中），因此如果您不希望服务器长时间维护信息术语，不要放在 URL 中。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2019-01-24T22:47:56.073

现在是 2019 年，TLS v1.3 已经发布。根据 Cloudflare，服务器名称指示（SNI 又名主机名）可以通过 TLS v1.3 进行加密。所以，我告诉自己很棒！让我们看看它在 cloudflare.com 的 TCP 数据包中的样子。因此，我从 cloudflare 服务器的响应中捕获了一个“client hello”握手数据包，使用 Google Chrome 作为浏览器，wireshark 作为数据包嗅探器。我仍然可以在客户端 hello 数据包中以纯文本格式读取主机名，如下所示。它没有加密。

[![在此处输入图像描述](https://i.stack.imgur.com/BZDy4.jpg)](https://i.stack.imgur.com/BZDy4.jpg)

因此，请注意您可以阅读的内容，因为这仍然不是匿名连接。客户端和服务器之间的中间件应用程序可以记录客户端请求的每个域。

因此，看起来 SNI 的加密需要额外的实现才能与 TLSv1.3 一起工作

2020 年 6 月更新：看起来加密 SNI 是由浏览器启动的。Cloudflare 有一个页面供您检查您的浏览器是否支持加密 SNI：

[https://www.cloudflare.com/ssl/encrypted-sni/](https://www.cloudflare.com/ssl/encrypted-sni/)

在这一点上，我认为谷歌浏览器不支持它。您可以在 Firefox 中手动激活加密 SNI。当我出于某种原因尝试它时，它并没有立即起作用。在它工作之前我重新启动了两次 Firefox：

在 URL 字段中输入：about:config。

检查 network.security.esni.enabled 是否为真。清除缓存/重新启动

转到我之前提到的网站。

正如您所看到的，VPN 服务今天对于想要确保咖啡店老板不记录人们访问的网站列表的人来说仍然有用。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2015-08-14T16:03:26.780

监控流量的第三方也可以通过检查您的流量并将其与其他用户访问该站点时的流量进行比较来确定访问的页面。例如，如果一个站点上只有 2 个页面，其中一个比另一个大得多，那么比较数据传输的大小将知道您访问了哪个页面。有一些方法可以对第三方隐藏，但它们不是正常的服务器或浏览器行为。例如，参见 SciRate 的这篇论文，[https:](https://scirate.com/arxiv/1403.0297) //scirate.com/arxiv/1403.0297 。

一般来说，其他答案是正确的，尽管本文表明可以非常有效地确定访问的页面（即 URL）。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2016-11-17T02:49:47.733

您也不能总是指望完整 URL 的隐私。例如，在企业网络中有时会出现这种情况，提供的设备（例如您的公司 PC）配置有额外的“受信任”根证书，以便您的浏览器可以安静地信任对 https 流量的代理（中间人）检查. 这意味着完整的 URL 被公开以供检查。这通常保存到日志中。

此外，您的密码也被公开并可能被记录，这是使用[一次性密码](https://en.wikipedia.org/wiki/One-time_password)或经常更改密码的另一个原因。

最后，如果没有加密，请求和响应内容也会暴露。

[检查点在此处](https://sc1.checkpoint.com/documents/R77/CP_R77_ThreatPrevention_WebAdmin/101685.htm)描述了检查设置的一个示例。使用提供的 PC 的老式“网吧”也可以这样设置。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2016-04-15T15:28:31.727

链接到我对[重复问题](https://stackoverflow.com/a/894000/26160)的回答。URL 不仅在浏览器历史记录和服务器端日志中可用，而且还作为 HTTP Referer 标头发送，如果您使用第三方内容，则会将 URL 暴露给您无法控制的来源。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2020-04-05T13:37:25.737

虽然你已经有了很好的答案，但我真的很喜欢这个网站上的解释：[https ://https.cio.gov/faq/#what-information-does-https-protect](https://https.cio.gov/faq/#what-information-does-https-protect)

简而言之：使用 HTTPS 隐藏：

*   HTTP方法
*   查询参数
*   POST 正文（如果存在）
*   请求标头（包括 cookie）
*   状态码

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2018-08-03T00:08:54.897

尽管这里已经有一些很好的答案，但其中大多数都集中在浏览器导航上。我在 2018 年写这篇文章，可能有人想了解移动应用程序的安全性。

**对于移动应用程序**，如果您控制应用程序的两端（服务器和应用程序），只要您使用 HTTPS **，您就很安全**。iOS 或 Android 将验证证书并减轻可能的 MiM 攻击（这将是所有这一切的唯一弱点）。您可以通过 HTTPS 连接发送敏感数据，这些数据将在传输过程中被**加密**。只有您的应用程序和服务器会知道通过 https 发送的任何参数。

这里唯一的“可能”是客户端或服务器是否感染了恶意软件，这些恶意软件可以在将数据包装在 https 中之前查看数据。但是，如果有人感染了这种软件，无论您使用什么来传输数据，他们都可以访问数据。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-08-22T08:03:38.440

此外，如果您正在构建一个 ReSTful API，浏览器泄漏和 http 引用问题大多会得到缓解，因为客户端可能不是浏览器并且您可能没有人点击链接。

如果是这种情况，我建议使用 oAuth2 登录来获取不记名令牌。在这种情况下，唯一的敏感数据将是初始凭据......无论如何这可能应该在发布请求中

# python - memcached 中对象的最佳序列化方法是什么？

> ID：499593
> 
> 赞同：25
> 
> 时间：2009-01-31T21:17:24.153
> 
> 标签：python, serialization, xml-serialization, memcached, protocol-buffers

我的 Python 应用程序当前使用[python-memcached API](http://www.tummy.com/Community/software/python-memcached/)来设置和获取 memcached 中的对象。此 API 使用 Python 的本机[pickle 模块](http://docs.python.org/library/pickle.html)来序列化和反序列化 Python 对象。

这个 API 使得将嵌套的 Python 列表、字典和元组存储在 memcached 中变得简单而快速，并且将这些对象读回应用程序是完全透明的——它可以正常工作。

但是我不想局限于只使用 Python，如果所有的 memcached 对象都用 pickle 序列化，那么用其他语言编写的客户端将无法工作。

以下是我考虑过的跨平台序列化选项：

1.  XML - 主要的好处是它是人类可读的，但这在这个应用程序中并不重要。XML 也占用大量空间，而且解析成本很高。
2.  JSON - 似乎是一个很好的跨平台标准，但我不确定它在从 memcached 读回时是否保留对象类型的特征。例如，根据[这篇文章，元组在使用](https://stackoverflow.com/questions/408866/python-human-readable-object-serialization)[simplejson](http://pypi.python.org/pypi/simplejson/)时被转换为列表；此外，似乎向 JSON 结构添加元素可能会破坏写入旧结构的代码
3.  [Google Protocol Buffers——](http://code.google.com/apis/protocolbuffers/docs/overview.html)我对此非常感兴趣，因为它看起来非常快速和紧凑——至少比 XML 小 10 倍；它不是人类可读的，但这对这个应用程序并不重要；它似乎旨在支持在不破坏旧代码的情况下扩展结构

考虑到这个应用程序的优先级，memcached 的理想对象序列化方法是什么？

1.  跨平台支持（Python、Java、C#、C++、Ruby、Perl）
2.  处理嵌套数据结构
3.  快速序列化/反序列化
4.  最小内存占用
5.  在不破坏旧代码的情况下灵活更改结构

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T06:14:44.950

**一个主要考虑因素是“您是否必须指定每个结构定义”**？

如果您对此感到满意，那么您可以看一下：

1.  [协议缓冲区 - http://code.google.com/apis/protocolbuffers/docs/overview.html](http://code.google.com/apis/protocolbuffers/docs/overview.html)
2.  [Thrift - http://developers.facebook.com/thrift/](http://developers.facebook.com/thrift/)（更适合服务）

这两种解决方案都需要支持文件来定义每个数据结构。

* * *

如果您不想招致开发人员预定义每个结构的开销，请查看：

1.  JSON（通过 python cjson 和原生 PHP json）。如果您不需要传输二进制内容（例如图像等），两者都非常快。
2.  另一种标记语言@ [http://www.yaml.org/](http://www.yaml.org/)。如果您获得正确的库，也非常快。

但是，我认为这两种方法在传输二进制内容方面都存在问题，这就是为什么它们被排除在我们使用之外的原因。 **注意：** YAML 可能有很好的二进制支持，你必须检查客户端库——见这里：http: [//yaml.org/type/binary.html](http://yaml.org/type/binary.html)

* * *

在我们公司，我们推出了自己的库（Extruct），用于支持二进制的跨语言序列化。我们目前在 Python 和 PHP 中有（相当）快速的实现，尽管由于在所有字符串上使用 base64（二进制支持），它的可读性不是很高。最终我们会将它们移植到 C 并使用更标准的编码。

如果循环中的迭代次数过多或必须查看每个字符，PHP 和 Python 等动态语言会变得非常慢。另一方面，C 则擅长此类操作。

如果您想查看 Extruct 的实现，请告诉我。（联系信息在[http://blog.gahooa.com/](http://blog.gahooa.com/)在“关于我”下）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-01T20:47:27.830

我尝试了几种方法并选择压缩 JSON 作为速度和内存占用之间的最佳平衡。Python 的本机 Pickle 函数稍快一些，但生成的对象不能用于非 Python 客户端。

我看到 3:1 压缩，因此所有数据都适合内存缓存，并且应用程序的响应时间低于 10 毫秒，包括页面渲染。

这是 JSON、Thrift、Protocol Buffers 和 YAML 的比较，有和没有压缩：

[http://bouncybouncy.net/ramblings/posts/more_on_json_vs_thrift_and_protocol_buffers/](http://bouncybouncy.net/ramblings/posts/more_on_json_vs_thrift_and_protocol_buffers/)

看起来这个测试得到了与压缩 JSON 相同的结果。由于我不需要预先定义每个结构，这似乎是最快和最小的跨平台答案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-31T22:13:41.403

“跨平台支持（Python、Java、C#、C++、Ruby、Perl）”

太糟糕了，这个标准是第一位的。大多数语言背后的意图是用不同的方式表达基本的数据结构和处理。这就是使多种语言成为“问题”的原因：它们都是不同的。

单一的表示在多种语言中都很好，通常是不可能的。在表示的丰富性、性能或模糊性方面存在妥协。

JSON 很好地满足了其余的标准。消息紧凑且解析迅速（与 XML 不同）。嵌套处理得很好。在不破坏代码的情况下改变结构总是不确定的——如果你删除了一些东西，旧代码就会破坏。如果你改变了一些需要的东西，旧的代码就会被破坏。但是，如果您要添加内容，JSON 也会处理此问题。

我喜欢人类可读的。它有助于进行大量调试和故障排除。

将 Python 元组转换为列表的微妙之处并不是一个有趣的问题。接收应用程序已经知道接收到的结构，并且可以对其进行调整（如果重要的话。）

* * *

编辑性能。

解析来自[http://developers.de/blogs/damir_dobric/archive/2008/12/27/performance-comparison-soap-vs-json-wcf-implementation.aspx的 XML 和 JSON 文档](http://developers.de/blogs/damir_dobric/archive/2008/12/27/performance-comparison-soap-vs-json-wcf-implementation.aspx)

xmlParse 0.326 jsonParse 0.255

对于相同的内容，JSON 似乎要快得多。我在 Python 2.5.2 中使用了 Python SimpleJSON 和 ElementTree 模块。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-16T02:07:53.423

您可能对此链接感兴趣：

[http://kbyanc.blogspot.com/2007/07/python-serializer-benchmarks.html](http://kbyanc.blogspot.com/2007/07/python-serializer-benchmarks.html)

另一种选择：MessagePack 似乎是最快的序列化程序。也许你可以试一试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-02-16T21:25:25.093

Hessian 满足您的所有要求。这里有一个python库：

[https://github.com/bgilmore/mustaine](https://github.com/bgilmore/mustaine)

该协议的官方文档可以在这里找到：

[http://hessian.caucho.com/](http://hessian.caucho.com/)

我经常在 Java 和 Python 中使用它。它可以工作并且不需要编写协议定义文件。我无法告诉你 Python 序列化程序是如何执行的，但 Java 版本相当有效：

[https://github.com/eishay/jvm-serializers/wiki/](https://github.com/eishay/jvm-serializers/wiki/)

# python - 传递大于 80 个字符的 JSON 字符串

> ID：499596
> 
> 赞同：-4
> 
> 时间：2009-01-31T21:18:00.563
> 
> 标签：python, string, json, size, max

我在传递 JSON 中超过 80 个字符的字符串时遇到问题。当我传递一个正好 80 个字符长的字符串时，它就像魔术一样工作。但是一旦我添加了第 81 个字母，它就会出错。我试过在 firebug 中查看 json 对象，它似乎认为字符串是一个数组，因为它旁边有一个扩展器。单击扩展器虽然什么也没做。我已经尝试在线搜索 JSON 字符串大小的上限和变通方法，但结果为空:(。有人对此有所了解吗？

编辑：

实际上，字符串是什么并不重要......使用“abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz”产生相同的结果。

这是我的代码：（我正在使用python）

结果 = {“测试”：“abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz”} self.response.out.write（simplejson.dumps（结果））

你会碰巧知道为python正确编码字符串的类吗？非常感谢 ：）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T21:23:48.570

第81个字是什么？听起来字符串没有正确转义，使 json 解码器认为它是一个数组。如果您可以在此处发布字符串，或者至少 80 左右的 20 个左右的字符，我可能会告诉您出了什么问题。另外，如果你能说出 json 字符串是如何制作的。在大多数语言中，您可以获得一个类，该类可以从对象和数组中生成正确的 json 字符串。例如 php 有[json_encode();](http://no2.php.net/manual/en/function.json-encode.php)

# c# - How to extract layers from a Photoshop file? C#

> ID：499597
> 
> 赞同：7
> 
> 时间：2009-01-31T21:18:14.930
> 
> 标签：c#, photoshop

Is there a library in C# that will allow me to read the layers in a photoshop file (PSD) and extract them as transparent images (PNG)?

Photoshop has a batch command that will extract all layers in individual files but there is no choice of transparent PNGs. My goal is to create a small utility program that will create combinations of layers as you like (for example think of creating a card deck).

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T22:08:27.950

There's a nice [article](http://www.codeproject.com/KB/graphics/PSDParser.aspx) on CodeProject which might be helpful. And here's a [thread](https://stackoverflow.com/questions/414852/reading-psd-file-format) on SO discussing PSD file format parsing with C#.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-01-21T12:09:30.833

我在任何地方都找不到太多，但这就是我最终这样做的方式。

```
using Photoshop;

Photoshop.PsdFile psd = new Photoshop.PsdFile();
psd.Load(pingTextsPsd);

for (int j = 0; j < psd.Layers.Count; j++)
            {
                System.Drawing.Image myPsdImage = ImageDecoder.DecodeImage(psd.Layers[j]);

                myPsdImage.Save(pingsOutputPath + psd.Layers[j].Name + ".png");

            } 
```

我必须下载 Frank Blumenberg 先生所做的 cs 文件（基于 Jonas Beckeman 的 Endogine 引擎），因为获得paintdotnet dll 本身还不够。

我相信正是在这里我得到了cs文件。

[http://code.google.com/p/skimpt/source/browse/trunk/Skimpt3/Skimpt3/classes/photoshop/?r=72](http://code.google.com/p/skimpt/source/browse/trunk/Skimpt3/Skimpt3/classes/photoshop/?r=72)

这应该允许您获得图层..

:-)

这似乎也适用于 CS6 文件。

更新：vs2013 网站在这里：http: [//goo.gl/H6nWSN](http://goo.gl/H6nWSN)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-31T23:02:58.027

您可以使用 Photoshop COM 做到这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-29T06:58:48.113

ImagicMagick（在另一篇 SO 文章*中*提到）确实允许单独提取层。见：[http ://www.rubblewebs.co.uk/imagemagick/psd.php](http://www.rubblewebs.co.uk/imagemagick/psd.php)

您可以使用命令行工具自己尝试：

```
convert boots.psd[0] -thumbnail 340x340 boots_png.png 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-06T12:34:31.593

I found a [code sample](http://www.java2s.com/Code/Java/2D-Graphics-GUI/DecodesaPhotoShoppsdfileintooneormoreframes.htm) that does this in Java.

```
"Supports uncompressed or RLE-compressed RGB files only" 
```

Also supports only older PSD versions :

```
"Does not support additional features in PS versions higher than 3.0" 
```

Also ImageMagick handles PSD and has interfaces to many languages :

```
"Choose from these interfaces: G2F (Ada), MagickCore (C), MagickWand (C), ChMagick (Ch), ImageMagickObject (COM+), Magick++ (C++), JMagick (Java), L-Magick (Lisp), NMagick (Neko/Haxe), MagickNet (.NET), PascalMagick (Pascal), PerlMagick (Perl), MagickWand for PHP (PHP), IMagick (PHP), PythonMagick (Python), RMagick (Ruby), or TclMagick (Tcl/TK)" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-12T22:47:54.307

如果您没有安装 Photoshop，那么您可能需要查看[http://frankblumenberg.de/doku/doku.php?id=paintnet:psdplugin](http://frankblumenberg.de/doku/doku.php?id=paintnet:psdplugin)上的代码以获取更多加载 PSD 文件的示例代码。

不幸的是，我不知道现有的 PNG 库可以满足您的要求，但用于 PNG 文件操作的规范库代码位于[http://www.libpng.org/pub/png/](http://www.libpng.org/pub/png/)。

# wpf - 调整特定一侧的边框

> ID：499607
> 
> 赞同：28
> 
> 时间：2009-01-31T21:22:59.913
> 
> 标签：wpf, border, controltemplates

我正在使用 ListBox 的 controlTemplate 来显示一个集合。我想在网格中显示所有带有边框的项目（所有线的大小相同）。当我给每个 listBoxItem 一个边框时，两个项目之间的线的大小是双倍的。（由第一项的底部边框和第二项的顶部边框组成）

所以问题是：我可以在项目的单侧设置/隐藏边框吗？（如 CSS 中的“border-top”）

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-01-31T22:22:15.833

border 属性是一个粗细，就像margin 和padding 一样，所以你可以做Border="2,0,2,2" 来得到除了顶部之外的所有地方的2 边框。

# html - Firefox 2 - HTML 按钮只是纯灰色。所有其他浏览器都很好：wtf？

> ID：499609
> 
> 赞同：0
> 
> 时间：2009-01-31T21:23:19.727
> 
> 标签：html, css, firefox, browser, button

我有一个在表单中有一个简单的 HTML 按钮的网站。所有浏览器都正确显示此按钮。但是，在 Firefox 2 和 Seamonkey 中，它显示为一个无法单击且没有文本的实心灰色方块。

```
<input id="getaudiobutton" type="button" value="Get Audio" onclick="convert()" /> 
```

对于那些拥有 Firefox 版本 2 或 Seamonkey 的人，请查看[我的网站](http://www.getaudiofromvideo.com)

谢谢大家

## 解决了

不知道为什么，但我所做的是增加按住按钮的 div 的大小，以便可以完全显示按钮。没有足够的空间来单击按钮。Firefox 2 和 Seamonkey 设法发现这有点麻烦。

感谢大家的帮助。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T21:31:53.687

从我在 Seamonkey 中查看它并查看页面内容和 CSS 所见，您可能需要检查按钮所在的 div 的样式。我可以在 Seamoney 中看到该按钮，但它在最顶部被切断，只允许显示大约 1-3 个像素。我也可以点击它。

我的猜测是，由于您为应用于按钮的父 div 的样式设置了 34px 的静态高度，因此它会切断大部分按钮。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-31T21:51:44.927

我观察到与 s13james 相同的行为（为此 +1），但还有一些我想指出的事情。

您可能需要重新考虑在那里使用 line-height 和 height ，因为使用这些值的组合将该输入元素包装到下一行与您的麻烦有很大关系。

我看到您通过 id 和 class 应用相同的样式，但是声明该样式仅用作类：

```
div.w_span_auto{
    background:url(../images/wr.png) top right no-repeat; 
    padding-right:18px;
    height:34px;
    line-height:34px;
    text-align:left;
    border:none;
    } 
```

（对于 id，您需要将其声明为 div#w_span_auto。）

我也不确定你为什么要声明两次。稍后在同一个 css 文件中有一个相同的声明。

干杯。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T21:33:30.050

您确定在您的 Firefox 副本上启用了 JS 吗？

你真的需要担心 FireFox 2 吗？它也只有 3% 的市场份额：

[http://marketshare.hitslink.com/report.aspx?qprid=0](http://marketshare.hitslink.com/report.aspx?qprid=0)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T21:35:01.043

你需要一个 type="submit"，而不是 type="Button" 吗？

# asp.net-mvc - 需要文件加载异常和强类型程序集

> ID：499611
> 
> 赞同：0
> 
> 时间：2009-01-31T21:23:35.060
> 
> 标签：asp.net-mvc

我正在尝试使用“添加视图”右键菜单添加视图（Asp.Net MVC RC），但出现文件加载异常。
这是 ASP.NET MVC RC 的问题还是某种配置问题？
[链接到屏幕截图](http://www.shareimmage.com/images/134_error1.gif)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T06:57:58.473

在安装 RC 之前，您是否正确卸载了旧版本？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T15:24:39.837

在此线程中： [链接文本](http://forums.asp.net/p/1377554/2918770.aspx#2918770)

Phil Haack 说您需要更新视图文件夹中的 web.config。所以我创建了一个新项目并将其复制到我现有的项目中，它现在可以工作了——不再有 FileLoadException。

# air - 如何从 C 程序将 AIR 运行时加载为进程内共享库

> ID：499615
> 
> 赞同：5
> 
> 时间：2009-01-31T21:25:34.277
> 
> 标签：air, pinvoke, java-native-interface, amf, interprocess

我想按照 java.exe 的方式用 C 语言构建一个特殊的 AIR 启动程序。

我用进程查看器查看了运行 AIR 程序，并且能够找到正在使用的 AIR 运行时 DLL。AIR 程序与 Java 的不同之处在于，它们作为特定于平台的可执行文件安装，一旦启动，它们就会将 AIR 运行时绑定为进程内共享库（用户双击它们的图标）。

好吧，我想制作一个类似于 java.exe 的 AIR 启动器。

java.exe 作为平台操作系统进程启动，它作为进程内共享库绑定到 Java JVM 运行时 (JRE)。要执行的 java 应用程序被指定为 java.exe 的命令行参数。一旦 java.exe 运行并且 JVM 完全正常运行，指定的 java 应用程序类将由 JVM 类加载器加载以执行。然后，指定的 Java 应用程序接管，在某种意义上“劫持”了 java.exe 的进程。当然，指定的 java 应用程序会在任何进程列表中显示为托管它的 java.exe 程序。

我想让 AIR 应用程序启动像这样工作。为什么？所以我可以探索破解 AIR 的方法，也许可以克服它的许多缺陷。例如，对于初学者，我想通过一些新的 API 来扩展 AIR 运行时体验，这些 API 可用于正在运行的 AIR 应用程序。

我的首要任务是：

*   实现与 .NET PInvoke 相当的 ActionScript3 到 C 的绑定接口
*   添加一个用于启动进程的 API，该 API 与 Java SE 中的 API 相当（Runtime.exec、ProcessBuilder、Process）
*   添加对 AIR 应用程序的支持，以便能够与 stdin、stdout、stderr 交互。奇怪的是，尽管 Adob​​e 在 AIR 中添加了对本地文件访问的支持，但它们却省略了与这些标准文件管道的交互（但它们可以在 AIR 支持的任何操作系统平台上找到）。
*   通过 stdin、stdout、stderr 实现对 AMF 的支持——因此 AIR（或 Java 或任何支持 AMF 的语言）应用程序可以通过交换 AMF 对象来进行通信。这将为 AIR 添加一点微软的 PowerShell。

目前 Merapi 提供了一个带有 Java 的 AMF 桥接器，从而证明了它的功效。唉，Merapi 必须使用 localhost 端口和套接字来进行进程间通信——相对于使用 stdin/stdout/stderr 进程间管道，这是一种笨拙的方式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T07:22:15.830

听起来你想做一些非常核心的 AIR hacking。我不认为在您自己的进程中托管 AIR 运行时会很容易。但您可能会考虑嵌入 Flash Player ActiveX 控件。由于它只是一个 COM 对象，因此任何 COM 应用程序都可以 CoCreateInstance() Flash Player。COM 接口没有很好的文档记录，但这里有一些可能会有所帮助的示例：

*   [F-IN-BOX](http://www.f-in-box.com/)是用于增强 Macromedia Flash Player ActiveX 功能的开发人员库。它不使用自己的引擎来显示电影，而是提供官方 swflash.ocx/flash.ocx 代码的包装器。
*   [如何使用 BoxedApp SDK 嵌入 Flash Player ActiveX](http://boxedapp.com/blog/2008/05/23/how-to-embed-flash-player-activex-using-boxedapp-sdk/)

如果您想获得更低级别的访问权限，您可以嵌入开源的[Tarmain AS3 VM](http://www.mozilla.org/projects/tamarin/)。该代码有一个名为“avmshell”的示例命令行 shell。如果您自己构建 Tamarin VM，则可以添加以本机 C++ 实现的新 ActionScript 类。Tamarin（和 Flash Player）使用 AS 和 C++ 之间的这种“AVM Glue”实现了他们的许多功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-07T20:34:09.540

我提出的问题被 Adob​​e 禁止（就任何潜在的商业用途而言）：

来自[Adob​​e® AIR™ 运行时分发常见问题解答](http://www.adobe.com/products/air/runtime_distribution_faq.html)：

> 以未记录的方式或目的分发或使用 Adob​​e AIR 运行时、安装程序文件或提取的安装程序文件。例如，您不得**为软件应用程序中的任何 Adob​​e AIR 库或运行时组件分发、直接调用或编写包装器**。Runtime.dll、Runtime 可执行文件、template.exe 和 template.app 是运行时组件的示例。

# c# - 此 linq 代码中的多个 orderby

> ID：499621
> 
> 赞同：5
> 
> 时间：2009-01-31T21:27:30.780
> 
> 标签：c#, .net, linq, linq-to-xml

我如何添加第二个项目来订购？我也想按goalsScored 元素排序。

```
var theteams = 
    (from teams in xdoc.Descendants("team")
     orderby (int)teams.Element("points") descending                               
     select 
         new Team(teams.Element("teamID").Value, 
                  (int)teams.Element("points"))                                
      ).Take(3); 
```

但是 thenby 似乎并没有参与到这个查询中。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-31T21:32:17.383

```
var theteams =     
    (from teams in xdoc.Descendants("team")
    orderby (int)teams.Element("points") descending, OtherField1, OtherField2
    select new Team(teams.Element("teamID").Value,
    (int)teams.Element("points"))).Take(3); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-31T21:34:09.267

您可以通过用逗号分隔多个订单子句来添加它们，例如

```
orderby (int)teams.Element("points") descending, goalsScored 
```

# multithreading - 如何检测和调试多线程问题？

> ID：499634
> 
> 赞同：73
> 
> 时间：2009-01-31T21:37:40.727
> 
> 标签：multithreading, debugging, language-agnostic

[这是对这个问题](https://stackoverflow.com/questions/493311/how-to-write-safe-correct-multi-threaded-code-in-net)的跟进，在这一点上我没有得到任何意见。这是一个简短的问题：

**是否可以检测和调试来自多线程代码的问题？**

我们经常要告诉我们的客户：“我们不能在这里重现问题，所以我们无法修复它。请告诉我们重现问题的步骤，然后我们会修复它。” 如果我知道这是一个多线程问题，这是一个有点讨厌的答案，但大多数情况下我不知道。我如何知道问题是多线程问题以及如何调试它？

我想知道是否有任何特殊的日志记录框架、调试技术、代码检查器或其他任何东西来帮助解决这些问题。欢迎使用一般方法。如果有任何答案应该与语言相关，则将其保留为 .NET 和 Java。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-01-31T21:55:35.213

**众所周知，线程/并发问题**难以复制——这就是为什么您应该设计以避免或至少最小化概率的原因之一。这就是不可变对象如此有价值的原因。尽量将可变对象隔离到单个线程中，然后小心控制线程间可变对象的交换。尝试使用对象移交的设计进行编程，而不是“共享”对象。对于后者，使用完全同步的控制对象（更容易推理），并避免让同步对象使用其他也必须同步的对象——也就是说，尽量保持它们自包含。你最好的防守是一个好的设计。

**死锁**是最容易调试的，如果您可以在死锁时获得堆栈跟踪。鉴于跟踪，其中大多数都进行死锁检测，很容易查明原因，然后对代码进行推理，了解为什么以及如何修复它。对于死锁，以不同的顺序获取相同的锁总是一个问题。

**活锁**更难 - 能够在错误状态下观察系统是您最好的选择。

**竞争条件**往往极难复制，甚至更难以通过手动代码审查来识别。有了这些，我通常采取的路径，除了广泛的测试来复制之外，是对可能性进行推理，并尝试记录信息以证明或反驳理论。如果您有国家腐败的直接证据，您可以根据腐败推断出可能的原因。

系统越复杂，就越难发现并发错误并推断其行为。使用 JVisualVM 和远程连接分析器之类的工具 - 如果您可以连接到处于错误状态的系统并检查线程和对象，它们可以成为救生员。

此外，请注意可能的行为差异，这些差异取决于 CPU 内核、管道、总线带宽等的数量。硬件的变化可能会影响您复制问题的能力。有些问题只会出现在单核 CPU 上，而其他问题只会出现在多核上。

最后一件事，尝试使用与系统库一起分发的并发对象——例如在 Java`java.util.concurrent`中是你的朋友。**编写自己的并发控制对象是困难且充满危险的；如果您有选择，请交给专家。**

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-31T21:45:44.797

我认为您对[另一个问题的](https://stackoverflow.com/questions/493311/how-to-write-safe-correct-multi-threaded-code-in-net)[回答](https://stackoverflow.com/questions/493311/how-to-write-safe-correct-multi-threaded-code-in-net/493387#493387)非常好。但我会强调这些点。

**只修改临界区的共享状态（互斥）**

**以固定的顺序获取锁并以相反的顺序释放它们。**

**尽可能使用预先构建的抽象**（比如 java.util.concurrent 中的东西）

此外，一些分析工具可以检测到一些潜在的问题。例如，[FindBugs](http://findbugs.sourceforge.net/)可以发现 Java 程序中的一些线程问题。此类工具无法找到所有问题（它们不是灵丹妙药），但它们可以提供帮助。

正如[vanslly](https://stackoverflow.com/users/27765/vanslly)在对此答案的评论中指出的那样，研究放置良好的日志输出也很有帮助，但要小心[Heisenbugs](http://en.wikipedia.org/wiki/Heisenbug)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-11-08T08:41:07.777

对于 Java，有一个名为[javapathfinder](http://javapathfinder.sourceforge.net/)的验证工具，我发现它对调试和验证多线程应用程序以防止潜在的竞争条件和代码中的死锁错误很有用。
它适用于 Eclipse 和 Netbean IDE。

[2019] github 仓库 [https://github.com/javapathfinder](https://github.com/javapathfinder)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-31T21:52:22.583

假设我有难以重现的问题报告，我总是通过阅读代码找到这些问题，最好是成对代码阅读，因此您可以讨论线程语义/锁定需求。当我们根据*报告的问题*执行此操作时，我发现我们总是很快就能解决一个或多个问题。我认为这也是解决难题的一种相当便宜的技术。

很抱歉无法告诉您按 ctrl+shift+f13，但我认为没有类似的功能。但只要考虑*实际*报告的问题*通常*会在代码中给出相当强烈的方向感，因此您不必从 main() 开始。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-31T21:57:29.767

除了您已经得到的其他好的答案之外：始终在具有至少与客户使用的处理器/处理器内核一样多的机器上进行测试，或者在您的程序中有活动线程的机器上进行测试。否则，一些多线程错误可能难以重现。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-31T22:02:57.243

除了故障转储，一种技术是广泛的运行时日志记录：每个线程都记录它正在做的事情。

报告错误时的第一个问题可能是“日志文件在哪里？”

有时你可以在日志文件中看到问题：“这个线程在这里检测到一个非法/意外的状态......然后看，这个另一个线程正在这样做，就在这之前和/或之后。”

如果日志文件没有说明发生了什么，那么向客户道歉，在代码中添加足够多的额外日志语句，将新代码提供给客户，并说你会在它再次发生后修复它.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-07-03T09:04:10.577

有时，多线程解决方案是不可避免的。如果存在错误，则需要实时调查，这对于 Visual Studio 等大多数工具几乎是不可能的。唯一实用的解决方案是编写跟踪，尽管跟踪本身应该：

1.  不添加任何延迟
2.  不使用任何锁定
3.  多线程安全
4.  以正确的顺序跟踪发生的事情。

这听起来像是一项不可能完成的任务，但通过将跟踪写入内存可以轻松实现。在 C# 中，它看起来像这样：

```
public const int MaxMessages = 0x100;
string[] messages = new string[MaxMessages];
int messagesIndex = -1;

public void Trace(string message) {
  int thisIndex = Interlocked.Increment(ref messagesIndex);
  messages[thisIndex] = message;
} 
```

Trace() 方法是多线程安全的、非阻塞的，可以从任何线程调用。在我的 PC 上，执行大约需要 2 微秒，这应该足够快了。

在您认为可能出错的地方添加 Trace() 指令，让程序运行，等到错误发生，停止跟踪，然后调查跟踪是否有任何错误。

有关此方法的更详细描述，它还收集线程和计时信息、回收缓冲区并很好地输出跟踪，您可以在以下位置找到：CodeProject：实时调试多线程代码[1](http://www.codeproject.com/Articles/792532/Debugging-multithreaded-code-in-real-time)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-12-11T01:02:32.627

在调试多线程代码时需要考虑的一些调试技术的小图表。图表正在增长，请留下评论和提示以添加。[（在此链接](http://adec.altervista.org/blog/multithreading-debugging-chart/)更新文件）

![多线程调试图](https://i.stack.imgur.com/CQyId.png)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-31T21:53:46.357

Visual Studio 允许您检查每个线程的调用堆栈，并且您可以在它们之间切换。跟踪各种线程问题是远远不够的，但这只是一个开始。计划在即将到来的 VS2010 中对多线程调试进行大量改进。

我使用 WinDbg + SoS 解决 .NET 代码中的线程问题。您可以检查锁（同步块）、线程调用堆栈等。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-31T22:10:45.807

[Tess Ferrandez 的博客](http://blogs.msdn.com/tess/)提供了使用 WinDbg 调试 .NET 中的死锁的好示例。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-01T15:10:36.420

assert() 是您检测竞争条件的朋友。每当你进入一个临界区时，断言与之相关的不变量是真的（这就是 CS 的用途）。虽然不幸的是，检查可能很昂贵，因此不适合在生产环境中使用。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-12-15T12:50:41.747

我实现了工具[vmlens](http://vmlens.com)来检测运行时 Java 程序中的竞争条件。它实现了一种称为[擦除器](http://www.cs.duke.edu/courses/cps210/spring06/papers/eraser.pdf)的算法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-31T22:02:55.513

按照 Princess 为您的其他问题（不可变对象和 Erlang 风格的消息传递）[推荐的方式](https://stackoverflow.com/questions/493311/how-to-write-safe-correct-multi-threaded-code-in-net/493398#493398)开发代码。检测多线程问题将更容易，因为线程之间的交互将被很好地定义。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-01-30T18:14:08.647

我遇到了一个线程问题，它给出了相同的错误结果，并且由于每次其他条件（内存、调度程序、处理负载）或多或少都相同，所以它的行为并没有不可预测。

根据我的经验，我可以说最难的部分是认识到这是一个线程问题，而最好的解决方案是仔细审查多线程代码。只需仔细查看线程代码，您就应该尝试找出可能出现的问题。其他方式（线程转储、分析器等）将仅次于它。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-10-11T20:54:57.160

缩小被调用的函数范围，并排除可能和不能归咎于什么。当您发现您怀疑可能导致问题的代码部分时，请为其添加大量详细的日志记录/跟踪。一旦问题再次发生，请检查日志以查看代码的执行方式与“基线”情况下的执行方式有何不同。

如果您使用的是 Visual Studio，还可以设置断点并使用 Parallel Stacks 窗口。并行堆栈在调试并发代码时提供了巨大的帮助，并且可以让您在线程之间切换以独立调试它们。更多信息-

[https://docs.microsoft.com/en-us/visualstudio/debugger/using-the-parallel-stacks-window?view=vs-2019](https://docs.microsoft.com/en-us/visualstudio/debugger/using-the-parallel-stacks-window?view=vs-2019)

[https://docs.microsoft.com/en-us/visualstudio/debugger/walkthrough-debugging-a-parallel-application?view=vs-2019](https://docs.microsoft.com/en-us/visualstudio/debugger/walkthrough-debugging-a-parallel-application?view=vs-2019)

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2017-05-30T07:32:31.877

我正在使用 GNU 并使用简单的脚本

$ 更多 gdb_tracer

```
b func.cpp:2871
r
#c
while (1)
next
#step
end 
```

* * *

## 回答 #17

> 赞同：-10
> 
> 时间：2009-01-31T22:16:32.677

我能想到的最好的事情是尽可能远离多线程代码。似乎很少有程序员可以编写无错误的多线程应用程序，我认为没有程序员能够编写无错误的*大型*多线程应用程序。

# c++ - 如何为临时文件创建 std::ofstream？

> ID：499636
> 
> 赞同：36
> 
> 时间：2009-01-31T21:41:12.903
> 
> 标签：c++, file, file-io, mkstemp

好的，`mkstemp`这是在 POSIX 中创建临时文件的首选方式。

但它会打开文件并返回一个`int`，这是一个文件描述符。从那我只能创建一个 FILE*，但不能创建一个`std::ofstream`，我更喜欢在 C++ 中。`std::ofstream`（显然，在 AIX 和其他一些系统上，您可以从文件描述符创建一个，但是当我尝试这样做时，我的编译器会报错。）

我知道我可以得到一个临时文件名，`tmpnam`然后用它打开我自己的 ofstream，但这显然是不安全的，因为竞争条件，并导致编译器警告（Linux 上的 g++ v3.4.）：

```
warning: the use of `tmpnam' is dangerous, better use `mkstemp' 
```

那么，是否有任何可移植的方式来创建`std::ofstream`临时文件？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-31T22:27:47.163

我已经完成了这个功能：

```
#include <stdlib.h>
#include <fstream>
#include <iostream>
#include <vector>

std::string open_temp(std::string path, std::ofstream& f) {
    path += "/XXXXXX";
    std::vector<char> dst_path(path.begin(), path.end());
    dst_path.push_back('\0');

    int fd = mkstemp(&dst_path[0]);
    if(fd != -1) {
        path.assign(dst_path.begin(), dst_path.end() - 1);
        f.open(path.c_str(), 
               std::ios_base::trunc | std::ios_base::out);
        close(fd);
    }
    return path;
}

int main() {
    std::ofstream logfile;
    open_temp("/tmp", logfile);
    if(logfile.is_open()) {
        logfile << "hello, dude" << std::endl;
    }
} 
```

您可能应该确保使用正确的文件创建掩码调用 umask（我更喜欢 0600）- mkstemp 的联机帮助页说文件模式创建掩码不是标准化的。它使用 mkstemp 将其参数修改为它使用的文件名这一事实。因此，我们打开它并关闭它打开的文件（因此，不要打开它两次），留下一个连接到该文件的 ofstream。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-31T21:50:47.907

我认为这应该有效：

```
 char *tmpname = strdup("/tmp/tmpfileXXXXXX");
    ofstream f;
    int fd = mkstemp(tmpname);
    f.attach(fd); 
```

**编辑：**嗯，这可能不是便携式的。如果您不能使用附加并且不能直接从文件描述符创建 ofstream，那么您必须这样做：

```
char *tmpname = strdup("/tmp/tmpfileXXXXXX");
mkstemp(tmpname);
ofstream f(tmpname); 
```

由于*mkstemp*已经为您创建了文件，因此竞争条件在这里应该不是问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-18T15:44:26.880

也许这会起作用：

```
char tmpname[256];
ofstream f;
sprintf (tmpname, "/tmp/tmpfileXXXXXX");
int fd = mkstemp(tmpname);
ofstream f(tmpname); 
```

我没试过，你可以看看。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-10-31T04:17:22.580

```
char tempFileName[20]; // name only valid till next invocation of tempFileOpen
ofstream tempFile;
void tempFileOpen()
{
    strcpy(tempFileName, "/tmp/XXXXXX");
    mkstemp(tempFileName);
    tempFile.open(tempFileName);
} 
```

这段代码也适用于 GCC/libstdc++6 4.8.4 和 Clang 3.9。也感谢其他对我有帮助的回复。

# iis - 如何为本地 asp.net webforms 开发设置具有匿名访问权限的 IIS 6？

> ID：499637
> 
> 赞同：2
> 
> 时间：2009-01-31T21:41:26.587
> 
> 标签：iis, iis-6, windows-authentication

当我设置 IIS6 以在本地开发项目时，我必须在目录安全性下启用“集成 Windows 身份验证”才能显示我的 CSS 和图像。（注意：我已经仔细检查了网络服务是否有权访问我的 Web 应用程序中的所有目录）

但是，这通常会导致我的浏览器在我运行应用程序时提示我输入 Windows 登录用户名和密码。

有没有办法一直输入Windows登录密码？

（我使用的是windows xp pro 64bit）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T23:13:08.133

可能是您网站的 kerberos 身份验证存在问题。只需在您的网站上禁用它。从 c:\Inetpub\AdminScripts 目录运行此命令。

```
cscript adsutil.vbs set w3svc/WebSite/root/NTAuthenticationProviders "NTLM" 
```

或者将身份验证更改为匿名。并确保目录安全选项卡 (IUSR_computername) 中的用户有权访问所述目录。访问文件和其他资源的不是应用程序池用户。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-31T23:47:31.353

那么它肯定不是它应该是的！

您说您已经仔细检查了**网络服务**是否可以访问目录。但是对于匿名访问，需要访问的帐户是**IUSR_[machinename]**帐户。该帐户在目录安全选项卡下指定。

如果一切都失败了，对于本地开发，您不妨授予每个人访问目录的权限。

# google-analytics - Google-Analytics: How do I add an e-mail link as the final step of a goal?

> ID：499640
> 
> 赞同：2
> 
> 时间：2009-01-31T21:43:00.670
> 
> 标签：google-analytics, confirmation, confirmation-email, goal-tracking

I send a confirmation link via e-mail (in multiple places) but it seems Analytics doesn't recognize those clicks (given URL is visited) unless the visit immediate. I am guessing the last part is about session expiration.

How can I define my goal funnel so that confirmation page landings are recognized even after a day or two?

My confirmation URL is in following format:

```
"http://<domain_name>/confirmation/<10_char_hex_confirmation_code>/" 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T20:07:19.360

你不能。目标漏斗的所有步骤必须发生在同一个会话中。

您总是可以有一个注册目标（即发送电子邮件），而另一个目标是确认登录页面。然后比较这些目标转化，你会得到同样的结果。

# c# - ASP.NET 错误的事件日志源属性的自定义值

> ID：499645
> 
> 赞同：4
> 
> 时间：2009-01-31T21:45:28.620
> 
> 标签：c#, asp.net, logging, event-log

默认情况下，ASP.NET 将所有未捕获的异常记录到系统事件日志中。我知道应该有一个适当的日志记录设施，但这总比没有好，它可以很好地作为一种临时解决方案。

我希望能够有效地过滤日志中的事件。我了解到，在以编程方式记录时，您可以通过以下方式为事件日志中的 Source 列设置自定义值：

```
EventLog eventLog = new EventLog("Application");
eventLog.Source = "My custom name";
eventLog.WriteEntry("Some error description ...", EventLogEntryType.Error); 
```

但是，ASP.NET 将此值设置为“ASP.NET”，后跟其版本。我简要检查了 web.config 的文档，但没有找到明显的地方来更改它。我想知道它是否可以改变。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T00:46:12.920

最好的办法是按预期使用源属性，但在安装程序中使用安装程序类在安装时（在管理员下）设置注册表，例如：

```
使用系统；
使用 System.Collections；
使用 System.Collections.Generic；
使用 System.ComponentModel；
使用 System.Configuration.Install；
使用 System.Diagnostics；

命名空间安装程序类
{
    [运行安装程序（真）]
    公共部分类事件日志：安装程序
    {
        私人事件日志安装程序事件日志安装程序；

        ///
        /// 为 MyApp 创建事件日志
        ///
        公共事件日志（）
        {
            初始化组件（）；

            // 创建一个 EventLogInstaller 的实例。
            eventLogInstaller = new EventLogInstaller();

            // 设置事件日志的源名称。
            eventLogInstaller.Source = "我的来源";

            // 设置源写入条目的事件日志。
            eventLogInstaller.Log = "应用程序";

            // 将 myEventLogInstaller 添加到 Installer 集合中。
            Installers.Add(eventLogInstaller);
        }
    }
}

```

并确保它在您的安装程序中作为自定义操作运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T16:38:20.503

似乎使用源属性不是一个好主意。最初，我认为这是一个自由格式的文本。但是我刚刚发现它必须通过 RegisterEventSource(...) Win32 API 函数进行注册，并且这似乎仅在应用程序在管理员权限下运行时才有效。.NET 默默地为您创建一个新源，但如果您不是管理员，它会引发异常。所以总的来说，在 ASP.NET 中使用临时源名称可能需要一些预先注册，这将在部署中引入另一个步骤。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T21:56:18.007

您可能希望在 global.asax 中处理未捕获的异常，然后以编程方式记录异常，如下所示：

```
void Application_Error(object sender, EventArgs e)
{
    Exception ex = Server.GetLastError().GetBaseException();
    // logging code here
} 
```

# sql - SQL Server 2005：可为空的外键约束

> ID：499650
> 
> 赞同：15
> 
> 时间：2009-01-31T21:48:44.760
> 
> 标签：sql, linq, linq-to-sql, constraints, foreign-keys

我在表会话和用户之间有一个外键约束。具体来说，Sessions.UID = Users.ID。有时，我希望 Sessions.UID 为空。这可以允许吗？每当我尝试这样做时，都会收到 FK 约束违规。

具体来说，我通过 LINQ 在 Sessions 中插入一行。我设置了 Session.User = null; 我得到这个错误：

```
试图删除用户和会话之间的关系。但是，不能将关系的外键之一 (Session.UID) 设置为 null。
```

但是，当我删除使 User 属性为空的行时，我在 SubmitChanges 行上收到此错误：

```
值不能为空。
参数名称：cons
```

我的表中没有一个名为“cons”的字段，在我的 5,500 行 DataContext.designer.cs 文件中也没有，也没有在任何相关对象的 QuickWatch 中，所以我不知道“cons”是什么.

在数据库中，Session.UID 是一个可为空的 int 字段，而 User.ID 是一个不可为空的 int。我想记录可能有也可能没有 UID 的会话，我宁愿在不禁用对 FK 关系的约束的情况下这样做。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-19T16:57:56.897

我似乎记得之前创建了一个可以为空的 FK，所以我做了一个快速测试。正如您在下面看到的，它绝对是可行的（在 MSSQL 2005 上测试）。

编写表格和约束的相关部分并发布它们，以便我们进一步排除故障。

```
CREATE DATABASE [NullableFKTest]
GO
USE [NullableFKTest]
GO
CREATE TABLE OneTable 
(
    OneId  [int] NOT NULL,
    CONSTRAINT [PK_OneTable] PRIMARY KEY CLUSTERED 
    (
        [OneId] ASC
    )
)
CREATE TABLE ManyTable (ManyId  [int] IDENTITY(1,1) NOT NULL, OneId [int] NULL)
GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ManyTable_OneTable]') AND parent_object_id = OBJECT_ID(N'[dbo].[ManyTable]') )
ALTER TABLE [dbo].[ManyTable]  WITH CHECK ADD CONSTRAINT [FK_ManyTable_OneTable] FOREIGN KEY([OneId])
    REFERENCES [dbo].[OneTable] ([OneId])   
GO

--let's get a value in here
insert into OneTable(OneId) values(1)
select* from OneTable

--let's try creating a valid relationship to the FK table OneTable
insert into ManyTable(OneId) values (1) --fine
--now, let's try NULL
insert into ManyTable(OneId) values (NULL) --also fine
--how about a non-existent OneTable entry?
insert into ManyTable(OneId) values (5) --BOOM! - FK violation

select* from ManyTable
--1, 1
--2, NULL

--cleanup
ALTER TABLE ManyTable DROP CONSTRAINT FK_ManyTable_OneTable
GO
drop TABLE OneTable
GO
drop TABLE ManyTable
GO
USE [Master]
GO
DROP DATABASE NullableFKTest 
```

# .net - Asp.net mvc 控件和 html 助手

> ID：499669
> 
> 赞同：0
> 
> 时间：2009-01-31T22:06:44.520
> 
> 标签：.net, asp.net-mvc, controls

显然，一些供应商（如 Telerik）正在开发不依赖回发行为来工作的控件版本。

正如在最新版本的 Asp.net MVC RC 中一样，隐藏文件的代码也趋于消失，对于供应商来说，封装 UI 呈现（控制标签、html 帮助程序）和控制行为的最佳方式是什么？

您认为供应商将其控制 JavaScript 依赖于 Jquery 之类的框架并使用经典的 Jquery 插件扩展它会更好吗？

现在我们可以通过多种方式将视图数据发送到控制器，控件供应商是否应该共享某种约定？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T00:55:43.777

您可以查看[此处](http://lunaverse.wordpress.com/2008/11/24/mvcfluenthtml-fluent-html-interface-for-ms-mvc/)讨论的 MvcContrib 中的[FluentHtml](http://www.codeplex.com/MVCContrib)。

# ios - Getting a list of files in a directory with a glob

> ID：499673
> 
> 赞同：137
> 
> 时间：2009-01-31T22:08:20.790
> 
> 标签：ios, objective-c, iphone, cocoa, cocoa-touch

For some crazy reason I can't find a way to get a list of files with a glob for a given directory.

I'm currently stuck with something along the lines of:

```
NSString *bundleRoot = [[NSBundle mainBundle] bundlePath];
NSArray *dirContents = [[NSFileManager defaultManager] 
                        directoryContentsAtPath:bundleRoot]; 
```

..and then stripping out the stuff I don't want, which sucks. But what I'd really like is to be able to search for something like "foo*.jpg" instead of asking for the entire directory, but I've not been able to find anything like that.

So how the heck do you do it?

* * *

## 回答 #1

> 赞同：240
> 
> 时间：2009-05-25T17:15:12.930

在 NSPredicate 的帮助下，你可以很容易地实现这一点，如下所示：

```
NSString *bundleRoot = [[NSBundle mainBundle] bundlePath];
NSFileManager *fm = [NSFileManager defaultManager];
NSArray *dirContents = [fm contentsOfDirectoryAtPath:bundleRoot error:nil];
NSPredicate *fltr = [NSPredicate predicateWithFormat:@"self ENDSWITH '.jpg'"];
NSArray *onlyJPGs = [dirContents filteredArrayUsingPredicate:fltr]; 
```

如果您需要使用 NSURL 来代替它，它看起来像这样：

```
NSURL *bundleRoot = [[NSBundle mainBundle] bundleURL];
NSArray * dirContents = 
      [fm contentsOfDirectoryAtURL:bundleRoot
        includingPropertiesForKeys:@[] 
                           options:NSDirectoryEnumerationSkipsHiddenFiles
                             error:nil];
NSPredicate * fltr = [NSPredicate predicateWithFormat:@"pathExtension='jpg'"];
NSArray * onlyJPGs = [dirContents filteredArrayUsingPredicate:fltr]; 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2011-04-06T22:57:52.867

这非常适用于`IOS`，但也应该适用于`cocoa`.

```
NSString *bundleRoot = [[NSBundle mainBundle] bundlePath];
NSFileManager *manager = [NSFileManager defaultManager];
NSDirectoryEnumerator *direnum = [manager enumeratorAtPath:bundleRoot];
NSString *filename;

while ((filename = [direnum nextObject] )) {

    //change the suffix to what you are looking for
    if ([filename hasSuffix:@".data"]) {   

        // Do work here
        NSLog(@"Files in resource folder: %@", filename);            
    }       
} 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-05-25T09:31:48.833

使用 NSString 的 hasSuffix 和 hasPrefix 方法怎么样？类似的东西（如果您正在搜索“foo*.jpg”）：

```
NSString *bundleRoot = [[NSBundle mainBundle] bundlePath];
NSArray *dirContents = [[NSFileManager defaultManager] directoryContentsAtPath:bundleRoot];
for (NSString *tString in dirContents) {
    if ([tString hasPrefix:@"foo"] && [tString hasSuffix:@".jpg"]) {

        // do stuff

    }
} 
```

对于像这样简单直接的匹配，它比使用正则表达式库更简单。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2013-11-14T12:52:55.790

非常简单的方法：

```
NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, 
                                                     NSUserDomainMask, YES);
NSString *documentsDirectory = [paths objectAtIndex:0];

NSFileManager *manager = [NSFileManager defaultManager];
NSArray *fileList = [manager contentsOfDirectoryAtPath:documentsDirectory 
                                                 error:nil];
//--- Listing file by name sort
NSLog(@"\n File list %@",fileList);

//---- Sorting files by extension    
NSArray *filePathsArray = 
  [[NSFileManager defaultManager] subpathsOfDirectoryAtPath:documentsDirectory  
                                                      error:nil];
NSPredicate *predicate = [NSPredicate predicateWithFormat:@"SELF EndsWith '.png'"];
filePathsArray =  [filePathsArray filteredArrayUsingPredicate:predicate];
NSLog(@"\n\n Sorted files by extension %@",filePathsArray); 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2010-02-03T19:48:07.830

Unix 有一个库可以为您执行文件通配操作。函数和类型在名为 的标头中声明`glob.h`，因此您需要`#include`它。如果打开终端并通过键入打开 glob 的手册页，`man 3 glob`您将获得使用这些功能所需的所有信息。

下面是一个示例，说明如何将匹配通配模式的文件填充到数组中。使用该`glob`功能时，您需要记住一些事项。

1.  默认情况下，该`glob`函数在当前工作目录中查找文件。为了搜索另一个目录，您需要将目录名称添加到 globbing 模式中，就像我在示例中所做的那样，以获取`/bin`.
2.  当您完成结构时，您负责清理`glob`通过调用分配的内存。`globfree`

在我的示例中，我使用默认选项并且没有错误回调。手册页涵盖了所有选项，以防您想要使用其中的某些内容。如果您要使用上面的代码，我建议将其添加为一个类别`NSArray`或类似的东西。

```
NSMutableArray* files = [NSMutableArray array];
glob_t gt;
char* pattern = "/bin/*";
if (glob(pattern, 0, NULL, &gt) == 0) {
    int i;
    for (i=0; i<gt.gl_matchc; i++) {
        [files addObject: [NSString stringWithCString: gt.gl_pathv[i]]];
    }
}
globfree(&gt);
return [NSArray arrayWithArray: files]; 
```

编辑：我在 github 上创建了一个要点，其中包含名为[NSArray+Globbing](http://gist.github.com/293959)的类别中的上述代码。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-03T17:43:07.563

您需要推出自己的方法来消除您不想要的文件。

使用内置工具这并不容易，但您可以使用[RegExKit Lite](http://regexkit.sourceforge.net/)来帮助在返回的数组中查找您感兴趣的元素。根据发行说明，这应该适用于 Cocoa 和 Cocoa-Touch 应用程序。

这是我在大约 10 分钟内编写的演示代码。我将 < 和 > 更改为 " 因为它们没有出现在 pre 块内，但它仍然适用于引号。也许对 StackOverflow 上的格式化代码了解更多的人会纠正这个问题（克里斯？）。

这是一个“Foundation Tool”命令行实用程序模板项目。如果我在我的家庭服务器上启动并运行我的 git 守护程序，我将编辑这篇文章以添加项目的 URL。

```
#import "基础/Foundation.h"
#import "RegexKit/RegexKit.h"

@interface MTFileMatcher : NSObject
{
}
- (void)getFilesMatchingRegEx:(NSString*)inRegex forPath:(NSString*)inPath;
@结尾

int main (int argc, const char * argv[])
{
    NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];

    // 在此处插入代码...
    MTFileMatcher* matcher = [[[MTFileMatcher alloc] init] autorelease];
    [匹配器 getFilesMatchingRegEx:@"^.+\\.[Jj][Pp][Ee]?[Gg]$" forPath:[@"~/Pictures" stringByExpandingTildeInPath]];

    [池排水]；
    返回0；
}

@implementation MTFileMatcher
- (void)getFilesMatchingRegEx:(NSString*)inRegex forPath:(NSString*)inPath;
{
    NSArray* filesAtPath = [[[NSFileManager defaultManager] directoryContentsAtPath:inPath] arrayByMatchingObjectsWithRegex:inRegex];
    NSEnumerator* itr = [filesAtPath objectEnumerator];
    NSString* 对象；
    而（obj = [itr nextObject]）
    {
        NSLog(obj);
    }
}
@结尾

```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-31T22:17:46.963

I won't pretend to be an expert on the topic, but you should have access to both the `glob` and `wordexp` function from objective-c, no?

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-10-26T08:39:44.157

stringWithFileSystemRepresentation 在 iOS 中似乎不可用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-03-14T02:05:10.327

**用于可可的**Swift 5****

 **```
 // Getting the Contents of a Directory in a Single Batch Operation

        let bundleRoot = Bundle.main.bundlePath
        let url = URL(string: bundleRoot)
        let properties: [URLResourceKey] = [ URLResourceKey.localizedNameKey, URLResourceKey.creationDateKey, URLResourceKey.localizedTypeDescriptionKey]
        if let src = url{
            do {
                let paths = try FileManager.default.contentsOfDirectory(at: src, includingPropertiesForKeys: properties, options: [])

                for p in paths {
                     if p.hasSuffix(".data"){
                           print("File Path is: \(p)")
                     }
                }

            } catch  {  }
        } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-03-13T08:44:23.700

**斯威夫特 5**

这适用于可可

```
 let bundleRoot = Bundle.main.bundlePath
        let manager = FileManager.default
        let dirEnum = manager.enumerator(atPath: bundleRoot)

        while let filename = dirEnum?.nextObject() as? String {
            if filename.hasSuffix(".data"){
                print("Files in resource folder: \(filename)")
            }
        } 
```

# http - DNS HTTP 请求

> ID：499687
> 
> 赞同：0
> 
> 时间：2009-01-31T22:20:09.470
> 
> 标签：http, httpwebrequest, dns

如果我要将 URL 发送到 DNS 服务器，可以说：“dev.example.com/?username=daniel”，究竟发送到 DNS 服务器的是什么？整个 URL（包括任何传递的参数）还是只是网站部分“dev.example.com”？我想知道我应该在 URL 中隐藏哪些参数。

我问的原因是因为我只是不希望将机密信息发送到 DNS 服务器。我对所有 URL 使用 https，但是当有人要求访问 URL 时，我希望对所有 DNS 服务器隐藏 URL 中的所有参数信息。我只是不确定发送到 DNS 服务器以建立 SSL 连接的内容。由于我的站点几乎需要加密每个参数，因此我担心如果 DNS 读取该信息，如何隐藏这些信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T22:35:19.737

dev.example.com 可以通过将其发送到您的 DNS 服务器（几乎肯定会引用另一个 DNS 服务器）来解析（如果它尚未在本地缓存中）。

仅发送“dev.example.com”，其余的将仅作为 HTTP 请求传递给解析的 IP 号。

因此，您不需要隐藏任何参数，当然，如果用户从您的页面访问它（作为引用者），这些参数很可能最终出现在另一个网站上。如果这些参数真的很敏感，对它们进行编码或（ab）使用 POST，

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T22:24:12.660

域名系统 (DNS) 将*主机名*解析为 IP 地址，因此只发送主机名的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T22:21:26.847

DNS 与协议无关。发送的值只是主机名，所以在这种情况下`dev.example.com`.

我也不确定这与“参数隐藏”有什么关系，但如果您可以对此进行扩展，我们可能会提供更多有用的建议。

**编辑（根据您的更新）：** 啊。那么你应该很高兴，因为只发送域名本身。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T22:25:30.333

如果 DNS 服务器恰好是根 Web 应用程序恰好回答“用户名”查询的 Web 服务器，那么您可能会得到一些回报。除此之外，DNS 是另一种动物。

# mysql - 了解 global.time_zone 的结果

> ID：499694
> 
> 赞同：1
> 
> 时间：2009-01-31T22:22:49.480
> 
> 标签：mysql, timezone

我正在研究更改数据库时区的方法，因为我的用户群是英国的，但我的域是美国的。我研究了许多选项，包括 php、PEAR 时间类和 MySQL 函数。对我来说最简单的（主要是因为它以 MySQL 开头和结尾）涉及更改 MySQL 的 time_zone 参数。

为了准备这样做，我刚刚尝试了 MySQL 的 @@global.time_zone 调用（在我开始使用它之前我最好理解这一点）。它产生了一大堆我没想到的参数，而 MySQL 的站点（[链接文本](http://dev.mysql.com/doc/refman/5.1/en/time-zone-support.html)）没有提到 - 它显然是一个数组，它返回许多可识别的参数，如登录协议等，但我看不到任何明显的参数返回与时区有关的任何参数。

你有这方面的经验吗？你能建议吗？提前谢谢了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-06T20:33:36.127

处理时区有两个关键：

1.  将所有日期/时间存储在同一时区（可以是任何时区，但使用 UTC 确实可以简化事情。）

2.  决定您的应用程序日期/时间将在哪里转换为/从存储时区转换为用户显示时区。这可以在数据库抽象层、应用程序代码或页面模板（基本上是 MVC 堆栈的任何部分）中完成。重要的是要保持一致。

还要记住，php 有自己的独立于 MySQL 的时区设置。如果您正在运行 php >5.1，则可以在运行时使用 date_set_default_timezone() 更改 php 时区。

如果您决定在数据库中检索/存储信息时进行时区转换，MySQL 的 convert_tz() 函数将成为您最好的新朋友。

对我来说，将时区转换作为页面模板的一部分是最简单的。日期/时间以 UTC 时区存储在数据库中，所有应用程序逻辑也以 UTC 格式保存。在 HTML 中输出日期时，我使用 php 的 date() 的包装函数来输出用户时区中的日期：

```
function getTimezoneOffset($time, $timezone)
{       
    $t = new DateTime(date('Y-m-d H:i:s', $time));  
    $tz = new DateTimeZone($timezone);  
    $t->setTimeZone($tz);   
    return $t->getOffset();
}
function myDate($timezone, $format, $timestamp=false)
{
    if (!$timestamp) $timestamp = time();
    return date($format, $timestamp+getTimezoneOffset($timestamp, $timezone));
} 
```

同样，当通过表单从用户那里获取输入时，首先进行时区转换，以便您的应用程序可以使用 UTC 日期/时间。

另一种选择是使用 PostgreSQL——与 MySQL 不同，它内置了对 datetimes 的时区支持。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T06:51:48.613

标准做法是存储您希望以 UTC（即 GMT）显示的任何日期/时间，并使用 javascript 自动从用户的客户端获取时区，或者询问用户他住在哪里。

就个人而言，我不认可自动方法，因为许多用户没有设置正确的时区。但是向他们建议默认设置可能很有用。

无论哪种方式，一旦您有了用户的时区，只需在显示它之前将其添加到数据库中存储在 UTC 中的时间戳中。

# python - 我可以在嵌入式交互式 Python 控制台中使用 IPython 吗？

> ID：499705
> 
> 赞同：7
> 
> 时间：2009-01-31T22:29:21.060
> 
> 标签：python, console

我使用以下代码段放入 Python shell 中间程序。这工作正常，但我只得到标准控制台。有没有办法做同样的事情，但使用[IPython](http://ipython.scipy.org/) shell？

```
import code

class EmbeddedConsole(code.InteractiveConsole):
    def start(self):
        try:
                self.interact("Debug console starting...")
        except:
                print("Debug console closing...")

def print_names():
    print(adam)
    print(bob)

adam = "I am Adam"
bob = "I am Bob"

print_names()
console = EmbeddedConsole(locals())
console.start()
print_names() 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2013-11-10T16:04:12.800

f3lix 的答案似乎不再有效，但是我能够找到这个：

在 python 脚本的顶部：

```
from IPython import embed 
```

无论您想在哪里启动控制台：

```
embed() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T22:35:29.893

[嵌入 IPython](http://www.ifi.uio.no/~inf3330/scripting/doc/python/ipython/node9.html)对您来说可能很有趣。

在您的应用程序中运行 IPython 的最少代码：

```
from IPython.Shell import IPShellEmbed
ipshell = IPShellEmbed()
ipshell() # this call anywhere in your program will start IPython 
```

# c++ - 在两个坐标空间之间变换对象

> ID：499713
> 
> 赞同：2
> 
> 时间：2009-01-31T22:33:57.057
> 
> 标签：c++, math, 3d, vector, matrix

所以我正在阅读“图形和游戏开发的 3D 数学入门”一书，几乎没有数学背景，我终于开始掌握向量/矩阵数学 - 这是一种解脱。

但是，是的，总是有一个但是，我很难理解一个对象从一个坐标空间到另一个坐标空间的转换。在书中，作者举了一个例子，在“世界空间”中[用枪射击汽车（图像）](http://totmacher.eu/upload/car_gun.jpg) ，该汽车旋转了 20 度（为简单起见，只是一个 2D 空间）。所以我们有三个空间：世界空间、枪对象空间和汽车对象空间——对吗？这本书接着说：

> *“在这个图中，我们引入了一种向汽车发射子弹的步枪。如左侧坐标空间所示，我们通常会从了解枪支和子弹在世界空间中的轨迹开始。现在，想象一下，在保持汽车、枪和子弹轨迹静止的情况下，将坐标空间变换为与汽车的物体空间一致。现在我们知道了枪的位置和子弹在汽车物体空间中的轨迹，我们可以进行交叉路口测试，看看子弹是否会击中汽车以及在何处击中汽车。”*

我遵循这个解释，当我事先知道汽车在世界空间中旋转了 20* 度时，这不是问题——但是当我在游戏中有一个弓箭手从山上射击时，这如何转化为一种情况看不起别人？我不知道那里所有东西都移位的角度？

哪个物体空间在这里旋转？世界还是枪支空间？是的，你可以看到我有点困惑。

我认为理想的反应是使用汽车和枪支的例子，使用任意变量来表示位置、角度等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T14:47:08.807

您应该阅读如何[更改基础并在](http://en.wikipedia.org/wiki/Change_of_basis)*向量*中思考，而不是数组，而是数学：P

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T23:17:49.620

我曾经是一名游戏程序员，我一次又一次地这样做。最终，我不再使用角度。对于每个对象，我都有一个前向向量和一个向上向量。然后，您可以从叉积中获得向右的向量。并且所有空格之间的转换都变成了点积。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T23:05:28.723

您了解坐标空间和变换如何在 2D 中工作的概念吗？我发现在尝试移动到 3D 之前，坐标空间和变换在 2D 中更容易可视化。这样，您就可以在纸上处理“假设”场景，并帮助您了解主要概念。

在您发布的图像中，我认为解释是汽车本身的内部坐标系没有改变，但它的系统已经相对于世界系统旋转。

您必须了解汽车有自己的局部坐标系。汽车的几何形状是根据其局部坐标系定义的。所以无论它在世界中的方向如何，汽车的长度总是在它自己的本地系统中沿着 x 轴延伸。汽车可以通过变换其局部坐标系来定向。

坐标系总是相对于另一个系统定义的，除了根，在这种情况下是世界。所以枪有自己的系统，汽车有自己的系统，它们都嵌入到世界的系统中。如果我相对于世界旋转或移动汽车系统，那么即使几何形状没有改变，汽车也会出现旋转。

如果无法绘制视觉场景，这是很难解释的，而且我的 google-fu 无法找到对基础知识的良好描述。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T03:30:58.080

正如之前的回复所暗示的，保持向上、向前和向右的向量是定义（欧几里得）坐标空间的好方法。如果你也添加一个原点会更好，因为你可以代表更广泛的空间。

假设我们有两个空间 A 和 B，在 A 中，上、前和右分别是 (0,1,0)、(0,0,1) 和 (1,0,0)，原点为零这给出了 A 的通常左手 xyz 坐标。假设 B 我们有 u=(ux,uy,uz), f=(fx,fy,fz) 和 r=(rx,ry,rz)，原点 o = (ox,oy,oz)。然后对于 B 中 p = (x,y,z) 处的点，我们在 A (x*rx + y*ux + z*fx + ox, x*ry + y*uy + z*fy + oy, x *rz + y*uz + z*fz + oz)。

这可以通过检查得出。请注意，由于 B 的右、上和前向量在 A 的每个轴上都有分量，因此 B 中某些坐标的分量必须对 A 中坐标的所有三个分量都有贡献。即因为 (0,1,0) 在B 等于 (ux,uy,uz)，然后 (x,y,z) = y*u +（其他一些东西）。如果我们对每个坐标都这样做，我们就有 (x,y,z) = x*r + y*u + z*f + （其他一些东西）。如果我们观察到除了（一些其他的东西）之外，这些项在原点消失了，那么我们意识到（一些其他的东西）实际上必须是 o，这使得 A 中的坐标为 x*r + y*u + z*f + o，即 (x*rx + y*ux + z*fx + ox, x*ry + y*uy + z*fy + oy, x*rz + y*uz + z*fz + oz ) 一旦向量操作被扩展。

这个操作也可以反过来，我们只需在 A 中设置坐标并求解方程以在 B 中找到它们。例如，A 中的 (1,1,1) 等于 x*r + y*u + z*f + o在 B 中。这给出了三个未知数的三个方程，并且可以通过联立方程的方法求解。我不会在这里解释......但如果你遇到困难，这里有一个链接：[link](http://en.wikipedia.org/wiki/Simultaneous_equations)

所有这些与您最初的子弹和汽车示例有何关系？好吧，如果您随汽车旋转一组上/右/前向量，并在汽车平移时更新原点，您可以从世界空间移动到汽车的本地空间，并使一些测试更容易。例如，您可以将子弹转换为“汽车本地”空间并使用本地坐标，而不是为碰撞模型转换顶点。如果您要转换汽车的顶点以在 GPU 上进行渲染，这很方便，但又不想承受读取该信息以用于 CPU 上的物理计算的开销。

在其他用途​​中，它可以通过转换三个点并执行这些操作来节省您转换 x 点的时间，这允许您在大量点上组合 x 转换，而不会对相同数量的点上的单个转换造成显着的性能影响。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-01T14:30:18.047

在游戏情况下，您通常不会知道汽车本身旋转了 20 度。相反，您的汽车定位信息将隐含包含该知识。因此，在这个二维示例中，您将知道汽车中心的 x,y 坐标和汽车指向的 x,y 向量（世界空间中的两条信息）——否则您将无法画它。这两条信息就是您找到在世界空间和汽车对象空间之间转换的矩阵所需的全部内容。（然后一个人可以在这个例子中看到这个矩阵，然后说，哦，看，旋转 20 度——但这不是你在游戏中通常会担心的信息。）

枪和车的问题，在三个空间中的任何一个都可以解决。那么问题来了，哪个最容易？据推测，枪的空间设置为使子弹沿 X 轴发射。所以很容易将其转换为其他空间。2D 汽车可能会在它自己的对象空间中表示——可能是一组 2D 线段或 2D 像素或其他东西。您当然可以将它们转换为世界空间或枪的对象空间，但是如果您在汽车对象空间中解决问题，则根本不必转换它们，因此这是解决此问题的最简单方法。

这有点像相对论：从它自己的角度来看，没有一个空间是旋转的。然而，与相对论不同的是，我们将世界空间视为一个享有特权的固定参照系。因此对象的模型空间相对于世界空间进行旋转、镜像、缩放、平移等。

# linq - 流畅的 Nhibernate 和 Linq（未找到属性）

> ID：499722
> 
> 赞同：1
> 
> 时间：2009-01-31T22:38:58.543
> 
> 标签：linq, fluent-nhibernate, s#arp-architecture

我试图让一个基于 S#arp 架构的网络应用程序工作。目前，我的实体有以下代码。

```
[Serializable]
public abstract class EventBase : Entity
{
    #region Properties

    [DomainSignature]
    public virtual string Name { get; set; }

    public virtual string Description { get; set; }

    public virtual AgeRange Ages { get; set; }

    public virtual int Rating { get; set; }

    public virtual decimal Price { get; set; }

    public virtual string PhoneNumber { get; set; }

    public virtual string EmailAddress { get; set; }

    public virtual string Website { get; set; }

    public virtual EventState State { get; set; }

    #endregion

    protected EventBase() {}

    protected EventBase(string name, string description)
    {
        // ReSharper disable DoNotCallOverridableMethodsInConstructor
        Name = name;
        Description = description;
        Price = 0;
        State = EventState.New;
        // ReSharper restore DoNotCallOverridableMethodsInConstructor
    }
} 
```

这是使用 Fluent NHibernate 映射的，如下所示

```
public class EventBaseMap : AutoMap<EventBase>
{
    public EventBaseMap()
    {
        Id(x => x.ID).WithUnsavedValue(-1).GeneratedBy.Identity();

        Component<AgeRange>(x => x.Ages, m =>
         {
             m.Map(x => x.From).TheColumnNameIs("AgeFrom");
             m.Map(x => x.To).TheColumnNameIs("AgeTo");
         });

        JoinedSubClass<Music>("EventId", sub =>
         {
             sub.Map(x => x.Headliner);
         });
    }
} 
```

我使用非常有用的 S#arp 基础存储库类创建了一个非常简单的存储库。

```
public interface IEventRepository : INHibernateRepositoryWithTypedId<EventBase, int>
{
    List<EventBase> FindByName(string searchPhase);
}
public class EventRepository : NHibernateRepository<EventBase>, IEventRepository
{
    public List<EventBase> FindByName(string searchPhase)
    {
        return Session.Linq<EventBase>().Where(x => x.Name == searchPhase).ToList();
    }
} 
```

我可以在数据库中创建实体并返回所有记录。当我尝试测试 FindByName 方法时，出现以下错误。

> NHibernate.QueryException：无法解析属性：名称：Model.Events.EventBase

有没有人有任何想法？是我的映射有问题吗？

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T23:26:06.810

这是使用自动映射功能。我以为您只显式映射要覆盖或不符合约定的属性？

如果我添加一个显式映射，这可以解决问题，但我仍然不确定为什么。

# acrobat - 修改 PDF 表单域中的字符间距

> ID：499723
> 
> 赞同：1
> 
> 时间：2009-01-31T22:39:06.093
> 
> 标签：acrobat

我正在尝试构建一个网络应用程序以编程方式填写 PDF 表单。我将首先在 Adob​​e Acrobat 中配置我的表单，然后使用 iText 编写一个 Java 应用程序，以通过来自 Web 的用户输入来填写所有表单字段。我需要填写的基本表格来自美国政府。他们创建了我需要更改的具有极大字距（字符间距）值的表单字段。但是，似乎无法在 Acrobat UI 中修改此值。

有谁知道如何在 Acrobat 8​​.0 for Windows 中操作表单字段的字符间距？我可以尝试使用 iText 以编程方式操作原始文档的字距调整，但这会更加乏味。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T19:14:47.143

我相信我已经弄清楚了：在 acrobat 中，字距调整被称为“梳理”，并且每个表单字段都被“梳理”了。奇怪的是，当我查看表单字段的属性时，未选中此选项，但“梳理”是我试图复制的行为。

# wix - 如何为多个实例创建/在何处获取 Wix Bootstrapper

> ID：499728
> 
> 赞同：13
> 
> 时间：2009-01-31T22:44:05.320
> 
> 标签：wix, wix3

我目前正在学习如何使用 WiX 创建 msi 安装程序，看来我已经碰壁了。

当我创建一个包含单个环境所需的一切的 MSI 时，一切都很好。

我有功能和组件，并且可以安装我的 MSI。

现在我正处于想要在 SQL Server 风格的安装程序中转换它的阶段，您可以在其中支持**多个实例**。

一开始我希望用户获得一个允许他创建新实例或管理现有实例的屏幕。（更新/删除它们）

我花了整整 2 天的时间到处寻找解决方案，但运气不佳。

我找到了以下资源，其中包含一些信息，但是它们的实例数量有限，或者没有描述如何为用户提供上述选项的引导程序。

*   [多实例 MSI 和 InstallShield 12](http://blog.deploymentengineering.com/2006/10/multiple-instance-msis-and.html)
*   [多实例转换演练](http://windows-installer-xml-wix-toolset.687559.n2.nabble.com/Multiple-Instance-Transforms-Walkthrough-Proposed-Simple-Addition-to-WiX-to-Make-Them-Easier-td708828.html)
*   [多实例安装和修补](http://ysdevlog.blogspot.com/2008/12/multiple-instance-installations-and.html)

有没有人已经使用 WiX 实现了这一点？或者任何人都可以向我指出一些关于如何实现这一目标的**工作示例？**

我知道 Installshield 2009 可以做到这一点，但由于这只是一种爱好，我没有钱购买它。我也想在 WiX 中进行，因为即将推出的 Visual Studio 2010 将改进对它的支持。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-30T20:29:00.480

使用 WiX v3 创建多个实例非常容易。您只需使用 InstanceTransform 和 Instance 元素来创建所有内容。现在，引导程序问题需要 WiX 工具集之外的东西，因为我们还没有烧录。我不确定我们是否会在 WiX v3.5（带刻录）中获得此功能，但它在我们的烧录后 v3.5 列表中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T11:56:14.927

虽然我从未创建过多实例设置，但我也注意到 Acresso 在 IS 2009 中宣布支持 MI。我们有 IS 2009，但没有使用此功能。

然而，Installshield 通常只是通过为它们提供一个“直观的”前端来简单地利用新的 MSI 功能（例如将多个 MSI 链接在一起）。因此，您可能希望查找有关如何使用 MSI SDK 实现该目标的一般信息。

以下是一些有用的链接，可能会为您指明正确的方向：

*   [使用实例转换创作多个实例](http://msdn.microsoft.com/en-us/library/aa367797(VS.85).aspx)
*   [多实例转换演练，建议对 WiX 进行简单添加以使其更容易](http://n2.nabble.com/Multiple-Instance-Transforms-Walkthrough,-Proposed-Simple-Addition-to-WiX-to-Make-Them-Easier-td708828.html)

# java - 如何在具有一半不透明度的小程序中绘制填充矩形？

> ID：499733
> 
> 赞同：1
> 
> 时间：2009-01-31T22:50:06.900
> 
> 标签：java, applet

如何在具有一半不透明度/透明度的小程序中绘制填充矩形？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-01T07:13:47.350

是的。

```
void foo(Graphics g) {
  g.setColor(new Color(.3f, .4f, .5f, .6f);
  g.fillRect(50, 50, 100, 100);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-31T22:53:14.303

您使用的是什么 API？如果您使用 Java2D 中的 Graphics，当您创建 Color 对象时，您可以将透明度作为 0 到 1 之间的 alpha 添加到它们。

[这是一篇关于 Java2D 的旧文章，](http://java.sun.com/products/jfc/tsc/articles/swing2d/index.html)其中包含一些示例

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-18T07:03:32.890

Paul Murray 的回答完全正确。但需要澄清的是，4 个颜色开关的混合和匹配是产生不同颜色的原因。以下是一些可帮助您入门的基础知识。

```
g.setColor(new Color(1f, 0f, 0f, 1f)); //RED
g.setColor(new Color(0f, 1f, 0f, 1f)); //GREEN
g.setColor(new Color(0f, 0f, 1f, 1f)); //BLUE
g.setColor(new Color(0f, 0f, 0f, 1f)); //BLACK
g.setColor(new Color(1f, 1f, 1f, 1f)); //WHITE 
```

如果你使用十进制数字，你可以使颜色不透明。所以：

```
g.setColor(new Color(.5f, 0f, 0f, .5f)); //RED 
```

将是 50% 的不透明和红色。然后你可以用那种不透明的颜色画出任何东西。如：

```
g.fillRect(50, 50, 100, 100); 
```

正如保罗所说

# multithreading - 从 OnTimer 事件访问父表单中的变量 - 获取异常

> ID：499737
> 
> 赞同：2
> 
> 时间：2009-01-31T22:51:09.410
> 
> 标签：multithreading, delphi, delphi-2007

我在 OnTimer 事件处理程序 (TTimer) 中遇到异常，该异常在执行时会增加父表单中的整数变量。计时器需要能够访问用作 id 的递增整数。

我的第一个问题是：如何在 Delphi 2007 中判断哪些代码在哪个线程中运行？有没有办法在调试模式下检查这个，所以我可以确定？

其次，如果我需要从另一个线程访问和修改父表单中的变量，那么最好的方法是什么？似乎有时 Delphi 允许我“错误地”访问这些变量而不给出异常，而其他时候它确实给出了异常。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T09:52:55.407

只是为了确定：一方面你在谈论一个计时器事件，另一方面是关于多线程。这是两种完全不同的并行运行代码的方式。

计时器将始终在主线程中运行。在那里访问创建并在主线程中使用的所有内容应该是安全的。事实上，定时器事件只有在没有其他主线程代码运行时才会发生，因为它需要应用程序的消息处理程序来处理定时器消息。因此，它要么在任何事件处理代码之外，要么在您的事件处理程序之一调用 Application.ProcessMessages 时。

线程与此非常不同。在这种情况下，不同线程中的代码彼此独立运行。如果在多处理器机器（或多核）上运行，它们甚至有可能真正并行运行。这样你可能会遇到很多问题，特别是 Delphi VCL（包括 Delphi XE）不是线程保存，所以对任何 VCL 类的调用只能从主线程完成（有一些例外情况本规则）。

因此，在期待任何有用的答案之前，请先澄清您是在谈论计时器还是真正的多线程。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T00:01:00.390

> 如何在 Delphi 2007 中判断哪些代码在哪个线程中运行？有没有办法在调试模式下检查这个，所以我可以确定？

您可以设置断点，并在执行停止时查看线程调试窗口。双击每个线程以在调用堆栈调试窗口中查看其调用堆栈。您还可以使用 Win32 函数 GetCurrentThreadId 来了解当前线程（例如，用于记录，或确定当前线程是否是主线程等）。

由于您没有显示任何代码，因此很难更具体。只是为了确定：计时器事件处理程序中的代码不会在不同的线程中执行。如果您只使用计时器，而不是真正的后台线程，您将不会遇到并发访问问题。

> 其次，如果我需要从另一个线程访问和修改父表单中的变量，那么最好的方法是什么？似乎有时 Delphi 允许我“错误地”访问这些变量而不给出异常，而其他时候它确实给出了异常。

如果你真的在另一个线程中并访问一个共享变量，如果你不保护该访问，你会看到各种各样的事情发生。它可能在大多数情况下都可以正常工作，或者你会得到奇怪的值。如果您只想以线程安全的方式修改整数，请查看 InterlockedIncrement。否则，您可以使用临界区、互斥体、监视器... JEDI 在 JclSynch 单元中有一些有用的类。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-01T10:22:00.420

你在问两个问题，所以我会分两个答案来回答。

您的第一个问题是关于使用 TTimers；那些总是在主线程中运行。

最有可能的是，您的异常是访问冲突。

如果是，通常是由以下任一原因引起的：

*   a-当您的 TTimer 触发时，您的父表单已经被销毁。
*   b-当您的 TTimer 触发时，您还没有对您的父表单的引用。

b 很简单：只需检查您的参考是否为**nil**。

a 更困难，取决于您如何引用父表单。

基本上，您要确保当父级被销毁或删除时您的引用为零。

如果您通过全局变量（在本例中通过**Form2**）引用您的父表单，那么您应该让 TForm2使用 OnDestroy 事件将 Form2 变量设为**nil ，如下所示：**

```
unit Unit2;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs;

type
  TForm2 = class(TForm)
    procedure FormDestroy(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form2: TForm2;

implementation

{$R *.dfm}

procedure TForm2.FormDestroy(Sender: TObject);
begin
  Form2 := nil;
end;

end. 
```

如果您正在使用对父表单的字段引用（例如**FMyForm2Reference**），那么您应该使用添加这样的 Notification 方法：

```
unit Unit1;

interface

 uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Unit2;

 type
  TForm1 = class(TForm)
  private
    FMyForm2Reference: TForm2;
  protected
    procedure Notification(AComponent: TComponent; Operation: TOperation); override;
  public
  end;

 var
  Form1: TForm1;

 implementation

{$R *.dfm}

 procedure TForm1.Notification(AComponent: TComponent; Operation: TOperation);
 begin
  inherited Notification(AComponent, Operation);
  if (Operation = opRemove) then
    if (AComponent = FMyForm2Reference) then
      FMyForm2Reference := nil;
 end;

 end. 
```

问候，

杰伦·普莱默斯

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-01T10:26:50.223

你在问两个问题，所以我会分两个答案来回答。

您的第二个问题是关于确保一次只有 1 个线程访问表单中的 1 个变量。

由于变量位于表单上，因此最好的方法是为此使用**Synchronize**方法。

Delphi 附带了一个很好的例子，它在**thrddemo.dpr**项目中，SortThds.pas 中的单元**有**这个方法来展示如何使用它：

```
procedure TSortThread.VisualSwap(A, B, I, J: Integer);
 begin
  FA := A;
  FB := B;
  FI := I;
  FJ := J;
  Synchronize(DoVisualSwap);
 end; 
```

祝你好运，

杰伦·普莱默斯

# objective-c - 使用垃圾回收时是否需要保留属性？

> ID：499739
> 
> 赞同：1
> 
> 时间：2009-01-31T22:52:07.770
> 
> 标签：objective-c, garbage-collection

我在 Objective-C 2.0 中使用垃圾收集。我需要保留财产吗？例如。

```
@property (nonatomic, retain) NSMutableArray *myArray; 
```

或者这就足够了：

```
@property (nonatomic) NSMutableArray *myArray; 
```

我像这样初始化数组：

```
self.myArray = [NSMutableArray array]; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T23:57:24.080

使用垃圾收集器，如果您不编写应与旧式 Objective-c 兼容的代码，则不必关心保留和释放。

`-(void)retain`并且`-(void)release`在 GC 开启时是空函数，它们不会更改保留计数。

这意味着离开它很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T00:11:27.517

如果启用了垃圾收集器，retain、release 和 autorelease 什么都不做。我相信你可以忽略它们。

# null - Webbrowser 控件的 window.external 始终为 null

> ID：499743
> 
> 赞同：2
> 
> 时间：2009-01-31T22:55:00.273
> 
> 标签：null, browser, nothing

Web 浏览器的 Window.External 对象始终为空！

要在新的 Winform 上重现拖放 Web 浏览器并键入：

```
Option Strict Off

Public Class Form1
    Private Sub Form1_Load()
        Handles MyBase.LoadMe.WebBrowser1.Document.Window.DomWindow.External.AddFavorite("http://www.google.com")
    End Sub
End Class 
```

确保您转到“程序集信息”对话框并选中“使程序集 COM 可见”。这是必要的。

我不知道为什么使用 COM 可见程序集，外部对象总是什么都不是。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-31T23:02:48.137

您是否[已将 ObjectForScripting](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.objectforscripting.aspx)属性设置为您的主机窗口？我认为您需要这样做才能使 window.external 正常工作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-11-03T18:03:28.303

此外，确保您设置为 ObjectForScripting 的对象具有以下属性：

```
[PermissionSet(SecurityAction.Demand, Name = "FullTrust")]
[ComVisible(true)] 
```

没有它，window.external 始终为空。

# html - CHtmlView MDI 窗口的内存消耗

> ID：499753
> 
> 赞同：0
> 
> 时间：2009-01-31T22:59:36.803
> 
> 标签：html, mfc, memory-leaks

我发现 MDI 应用程序中的 MFC CHtmlView 类存在问题。反复打开和关闭窗口会导致内存逐渐耗尽。我研究了这个问题并找到了关于 BSTR 问题的 MSDN 文章~~( [http://support.microsoft.com/kb/241750](http://support.microsoft.com/kb/241750) )~~，实施了这些修复，但仍然存在大量流失。

我已经确定了 VC8 和 VC9 中的问题，并试图确保所有接口都真正被释放，但我完全被难住了。最简单的查看方法是使用 MFC AppWizard（vc8 或 vc9）创建标准 MDI 应用程序，只需将默认 CView 更改为 CHtmlView。在调试中编译并运行应用程序，应用程序将自动打开一个新的 html 窗口到 MSDN。

打开任务管理器以跟踪应用程序使用的内存。关闭打开的窗口。然后，每次重新打开并关闭新窗口时，您都会看到应用程序占用的内存明显增加。一旦应用程序关闭，虽然它没有显示泄漏。

如果有人有任何信息，我将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-08-25T06:20:25.143

您可以使用`SetProcessWorkingSetSize(pi.hProcess, (SIZE_T)-1, (SIZE_T)-1))`最小化进程工作集。

[http://msdn.microsoft.com/en-us/library/ms686234(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms686234(VS.85).aspx)

[http://social.msdn.microsoft.com/Forums/en-US/ieextensiondevelopment/thread/88c21427-e765-46e8-833d-6021ef79e0c8](http://social.msdn.microsoft.com/Forums/en-US/ieextensiondevelopment/thread/88c21427-e765-46e8-833d-6021ef79e0c8)

# wpf - 如何在 WPF 中为 ListBoxItem 下划线？

> ID：499754
> 
> 赞同：1
> 
> 时间：2009-01-31T23:00:02.213
> 
> 标签：wpf, formatting, listboxitem

如何在 WPF 中为 ListBoxItem 下划线？我正在使用以下内容，但没有出现下划线。

```
<DataTemplate x:Key="Phrase_List">
    <ListBoxItem IsSelected="{Binding IsDefault}">
        <TextBlock Text="{Binding Path=Phrase}" Tag="{Binding Path=ID}" TextDecorations="Underline"  />
    </ListBoxItem>
</DataTemplate> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T23:10:00.820

我不知道您要使用什么代码。请尝试完成您的问题。我使用以下代码在我的小 ListBox 中为“World”项添加了下划线。

```
 <ListBox>
        <ListBoxItem>Hello</ListBoxItem>
        <ListBoxItem>
            <Underline>World</Underline>
        </ListBoxItem>
    </ListBox> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T06:23:43.880

您可以使用文本块，并将 textdecorations 属性设置为下划线。请记住，ListBoxItem 的内容可以是文本以外的内容，因此为什么不是在 ListBoxItem 上设置某些属性的简单案例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-19T02:59:45.157

在 XAML 中：

```
<ListBox Name="lst">
      <ListBoxItem Content="item1" />
      <ListBoxItem Content="item2" FontStyle="Italic" FontWeight="Normal" />
</ListBox> 
```

在 C# 中：

```
lst.Items.Clear();
lst.Items.Add(new ListBoxItem { Content = "item 1" });
lst.Items.Add(new ListBoxItem { Content = "item 2" });
lst.Items.Add(new ListBoxItem { Content = "item 3" });

ListBoxItem l = (ListBoxItem)lstItems.Items[2];
li.SetValue(TextElement.FontStyleProperty, FontStyles.Italic); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-29T19:01:53.487

您将需要创建一个在 TextBlock 控件中显示您的文本的项目模板。在 TextBlock 上，将 TextDecorations 属性（它是一个集合）设置为包含“下划线”。

# asp.net - 如何防止在代码更改后重新登录到 ASP.NET Web 应用程序

> ID：499756
> 
> 赞同：2
> 
> 时间：2009-01-31T23:01:15.333
> 
> 标签：asp.net, web-applications

当我在更改代码时丢失 ASP.NET Web 应用程序的会话状态时，我不喜欢它。

丢失会话状态意味着我必须一遍又一遍地登录。它很烦人。

无论如何我可以重新配置我的应用程序，以便我可以更改代码而不必重新验证来查看这些更改？

（我知道更改 .ASPX 文件可以做到这一点。我担心的是 App_Code 和 Bin 编译的代码。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T23:03:31.803

不幸的是，bin 文件夹中 web.config 或 dll 中的更改将导致应用程序重新加载，AFAIK 对此您无能为力。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T23:16:53.397

我想知道如果您将会话状态存储在[StateServer](http://msdn.microsoft.com/en-us/library/ms178586.aspx)中会发生什么。也许它会起作用（如果它起作用我会感到惊讶）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T23:41:40.413

如果您在开发人员环境中，您可以尝试禁用登录站点，或者当站点检查身份验证时，只需返回您的默认身份验证。正如 Igal 所指出的，对于生产，StateServer 将有所帮助。

最后一个选项，将登录信息存储在 Session 中，但作为备份，使用数据库中的登录表能够从 cookie 恢复用户的身份验证状态。显然，考虑安全隐患。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T18:08:01.320

通过更改您的 StateServer 以使用您的机器（启用 ASP.NET 状态服务），您将不会丢失您的登录信息。

# ruby-on-rails - 同时计数和分组

> ID：499767
> 
> 赞同：15
> 
> 时间：2009-01-31T23:07:31.730
> 
> 标签：ruby-on-rails

我有一个`Mail`具有以下架构的模型：

```
t.string   "mail"
t.integer  "country"
t.boolean  "validated"
t.datetime "created_at"
t.datetime "updated_at" 
```

我想在数据库中找到前 5 个国家，所以我继续输入

```
@top5 = Mail.find(:all,:group =>  'country',:conditions => [ "validated = ?" , "t" ], :limit => 5 ) 
```

这将告诉我组（我需要一个订单，因为我不知道怎么写）

```
@top5 = Mail.count(:all,:group =>  'country',:conditions => [ "validated = ?" , "t" ], :limit => 5 ) 
```

这将告诉我每个组中有多少邮件

我想知道我是否可以一次性分组和计数

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-01T03:36:39.583

尝试：

`Mail.count(:group => 'country', :conditions => ['validated = ?', 't'])`

我不确定伯爵是否接受`:limit`。

**编辑：**

我认为这更具可读性：

`Mail.count(:group => :country, :conditions => {:validated => true})`

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2012-05-08T16:10:06.790

使用 Rails 3，您可以进一步简化它：

```
Mail.where(validated: true).count(group: :country) 
```

您可以按组中的字段排序 - 在这种情况下，只有 :country 有效：

```
Mail.where(validated: true)
    .order(:country)
    .count(group: :country) 
```

您还可以使用“count_all”按计数排序：

```
Mail.where(validated: true)
    .order("count_all desc")
    .count(group: :country) 
```

您还可以限制返回的组数。为此，您必须在调用 count 之前调用 limit （因为`#count`返回`ActiveSupport::OrderedHash`）：

```
Mail.where(validated: true)
    .order("count_all desc")
    .limit(5)
    .count(group: :country) 
```

*更新 Rails 4 的语法：*

```
Mail.where(validated: true)
    .group(:country)
    .count 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-02-01T03:12:40.270

```
邮件.find(
    ：全部，
    :select => 'count(*) 计数，国家',
    :group => '国家',
    :conditions => ['已验证 = ?', 't' ],
    :order => 'count DESC',
    :limit => 5)

```

这应该为您提供具有国家属性和计数属性的记录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-04-04T12:04:18.607

我也必须用**城市名称**对数据进行分组，并显示每个具有**特定条件**的城市的行**数**。所以这就是我的做法：

 **```
CityData.where(:status => 1).group(:city_name).count 
```

这个的输出是：

```
{:Mumbai => 10, :Dublin => 7, :SF => 9} 
```

# asp.net - 如何为 ASP.NET Web 应用程序实现自动错误/崩溃报告？

> ID：499769
> 
> 赞同：5
> 
> 时间：2009-01-31T23:09:08.670
> 
> 标签：asp.net, jquery, asp.net-mvc

每个人都可能注意到，当今大多数现代应用程序都可以让用户自动或在用户许可的情况下发送崩溃/错误报告。一些示例是 Mozilla Crash Reporter 或大多数 Microsoft 应用程序。

我真的很喜欢这个功能，因为它允许我使用有用的信息快速收集错误报告，而不仅仅是让我的用户传统上报告错误/问题，例如提交帮助票。

我想知道是否有一种简单或系统的方法可以在 ASP.NET Web 应用程序中实现该功能。

你们有任何关于 WebForms 和 MVC 应用程序的经验或知识可以分享吗？或者，如果这可以在 JavaScript/JQuery 等客户端实现，那就太好了。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-01T10:16:50.397

ASP.NET 2.0 引入了健康监控，它允许您通过在 web.config 中添加一些东西来做到这一点。请参阅：http: [//msdn.microsoft.com/en-us/library/ms998306.aspx](http://msdn.microsoft.com/en-us/library/ms998306.aspx)

它可以记录到邮件、sql、事件日志等，并允许您设置缓冲区。因此，例如，如果 sql 数据库出现故障或某些用户发现错误并试图频繁调用它，它不会杀死您的邮件服务器 :-)

您还可以记录失败的身份验证并使用它重新启动应用程序池，如果您只需要它快速工作，这非常有用。它是否是管理所有错误的最佳解决方案仍然值得怀疑。因为它可能无法获得您需要的所有信息，例如浏览器版本或类似的 smt。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-31T23:33:52.363

[ELMAH](http://code.google.com/p/elmah/)是一个插入和检测异常的库。您也可以自己记录事件。事件和大量数据（如 url 参数和浏览器信息）可以通过电子邮件发送给管理员，并可选择存储在数据库中以供显示。（更像是网站的事件日志。）它没有我见过的内置用户表单，但可能可以扩展以包含这样的选项。

我已经使用/定制它大约两年了，它真的很特别。

另一种选择可能是使用[Kampyle](http://www.kampyle.com/)，它在您的网站右下角有一个反馈框。如果在网站上检测到问题，您可以使用 Javascript 触发该框出现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T23:26:12.973

对于 ASP.NET 应用程序——或任何与此相关的 Web 应用程序——这不仅仅是一个两步过程：

1.  记录错误（显然）；和
2.  在错误文档上放置一个表单以允许用户输入反馈。

或者还有更多？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T23:43:00.223

您的错误将通过*Global.asax.cs*文件（您可能必须创建）的 Application_Error 方法传递。我使用这个事实来捕获错误并将其记录到数据库中：

```
void Application_Error(object sender, EventArgs e)
{
    try
    {
        SqlConnection errConnection = new SqlConnection("Your connection string");

        // After setting up a command object, I call a stored procedure to save information about
        // the crash.  I pass two primary arguments.  The first is the URL:
        errCommand.Parameters.Add("@URL", SqlDbType.VarChar).Value = Request.Url.ToString();

        // The second is the error information.
        errCommand.Parameters.Add("@EI", SqlDbType.Text).Value = Server.GetLastError().ToString();

        // I pass some other information from my session as well...

       // After setting up an output parameter called ErrorID, I call the command...
       errCommand.ExecuteNonQuery();
       // Now Error ID is stored in the session.
       Session["ErrorID"] = (int)ErrorID.Value;
    }
    catch { } //  I do NOT want the error handling call to throw an error.
} 
```

现在，您应该已经设置了 Web.Config 文件，以便在发生错误时可以控制特定页面。在此页面中，您将检查会话中的错误 ID 并将其显示给用户。在输出中，如果用户想致电我们获取更多信息，我会要求用户写下错误。如果我们确实收到了请求，我可以进入数据库并获得错误的完整跟踪。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-31T23:54:06.363

您可以查看我关于如何在 asp.net 中实现异常日志记录的教程 - [http://jesal.us/blog/index.php/2008/04/08/exception-logging-using-the-database/](http://jesal.us/blog/index.php/2008/04/08/exception-logging-using-the-database/)

# ruby-on-rails - 在 RESTful 设计中，支持不同类型 GET 的最佳方式是什么？

> ID：499777
> 
> 赞同：4
> 
> 时间：2009-01-31T23:14:43.340
> 
> 标签：ruby-on-rails, rest

在当前项目中，我需要支持通过登录凭据和电子邮件地址查找用户。我知道在 RESTful 设计中，您使用 GET 来查找资源。在铁路...

```
GET /users    # => UsersController.index -- find all the users

GET /users/1  # => UsersController.show -- find a particular user 
```

但我也需要类似的东西......

```
GET /users?username=joe&password=mysterio

GET /users?email=foo@bar.com 
```

在 and 之外添加额外的路线和动作是常规的`index`吗`show`？

还是将条件逻辑放入`show`动作中以查看参数并检测我们是通过一件事还是另一件事来查找是否更常见？

PUT 请求也有类似的问题。在一种情况下，我需要将用户设置为“活动”（`user.active = true`），而在另一种情况下，我只需要进行一般的基于表单的编辑操作。

多谢你们。最终我要弄清楚这些 REST 的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-09T07:06:11.533

我是 SO 新手，所以我无法发表评论，但选中的绿色答案不是 RESTful。

在 RESTful 世界中，您的控制器获取所有参数并将其传递给模型层进行处理。通常，您不应创建另一个操作。

相反，您应该执行以下操作：

```
def show
  @user = User.find_by_login_or_email(params[:user])
  ... #rest of your action
end 
```

你的模型可以有这样的方法：

```
class User
  self.find_by_login_or_email(params)
    return find_by_login(params[:login]) unless params[:login].blank?
    return find_by_email(params[:email]) unless params[:email].blank?
    nil #both were blank
  end
end 
```

您的视图可能如下所示：

```
<%= f.text_field :user, :email %> 
```

或者

```
<%= f.text_field :user, :login %> 
```

注意：未经测试的代码，所以可能是错误的......但一般的思路通常不是为每个一次性规则创建新的操作。相反，看看您是否可以将逻辑推送到模型中。如果您的控制器开始有太多的非标准动作，那么可能是时候重新评估您的域建模了，也许它正在将动作重构为一些新模型。

ps：你永远不应该通过这样的 GET 传递密码

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T23:35:50.020

您可以做的第一件事是使您的 GET 尽可能智能。在您的示例中，这可以通过编程方式处理。参数可以这样处理：

*   是数字吗？这是一个用户标识；
*   里面有@吗？这是一封电子邮件；
*   除此以外？这是一个用户名。

但我假设您不只是在谈论这个例子，并且想要一些东西来处理一般情况，而不仅仅是这个特定的情况。

基本上有两种处理方法：

1.  添加额外的路径信息，例如 /users/email/me@here.com、/users/name/cletus；或者
2.  在您的“顶级” URL 中更具体，例如 /user-by-email/me@here.com、/user-by-name/cletus。

如果可以的话，我会以编程方式处理它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T01:03:20.017

我不知道这有多少是惯例，但这就是我会做的。我会添加另一个动作，只要它与该资源特别相关。在您的示例中，show 是按用户 ID 查找的，因此作为 UsersController 上的另一个操作是有意义的。你可以把它变成一个有意义的句子，“get me the user with this email address”

对于另一个`GET /users?username=joe&password=mysterio`，我会作为另一种资源来做。我假设您认为如果密码正确，该操作将登录用户。在这种情况下，动词 GET 没有意义。

您可能需要一个“会话”资源（顺便说一句，这就是 restful_auth 的工作方式）。所以你会说“为这个用户创建一个会话”，或者类似`POST /sessions`帖子的正文是用户的用户名和密码的地方。这也有一个很好的副作用，即不将密码保存在历史记录中或让某人在 HTTP 代理上捕获它。

所以你的控制器代码看起来像这样：

```
class UsersController < ActionController::Base

    def show
      @user = User.find_by_id(params[:id])
      # etc ...
    end

    def show_by_email
      @user = User.find_by_email(params[:email)
    end
end

class SessionsController < ActionController::Base
  def create
     # ... validate user credentials, set a cookie or somehow track that the 
     # user is logged in to be able to authenticate in other controllers
  end
end 
```

你会像这样设置你的路线：

```
map.connect "/users/byemail", :controller => "users", :action => "show_by_email", :conditions => { :method => :get }
map.resources :users
map.resources :sessions 
```

这会让你得到像`/users/byemail?email=foo@example.com`. 直接在 URL 路径中编码电子邮件存在问题，rails 在末尾看到“.com”，默认情况下将其转换为 :format。可能有一种解决方法，但这就是我的工作。

就像 cletus 说的那样，有一些方法可以根据 URL 各部分的格式（如所有数字或字母数字）使您的路线匹配，但我不知道如何立即使用 url 中的点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T14:27:19.530

关于“ByEmail”请求，您是否考虑过创建新的电子邮件资源。

```
GET /email/foo_at_bar_dot_com 
```

响应可能包含指向相关用户的链接。

我看到很多人试图将 RESTful 设计原则应用于他们的 URL 结构，然后将这些 url 映射到过程处理程序代码。例如 GET = Show，或者它是 GET = Index 还是 ShowByEmail。通过这样做，您实际上只是假装进行 RESTful 设计，然后尝试在面向资源的 URL 空间和面向过程的实现之间创建映射。这真的很难做到，而且程序性质不断泄漏到 URL 中。

面向资源的设计通常需要一种非常不同的方式来思考我们习惯的问题，不幸的是，那里的许多框架不断将我们吸回到 RPC 模型中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-31T23:41:40.163

您也许可以为不同的任务设置不同的路线。因此，对于这种情况，您可以有一条路由到 UserControll 中的一个方法，该方法专用于通过电子邮件获取用户，另一条用于通过凭据获取信息。

# c++ - PThread 是多平台 C/C++ 多线程程序的好选择吗？

> ID：499780
> 
> 赞同：15
> 
> 时间：2009-01-31T23:18:04.097
> 
> 标签：c++, c, multithreading, pthreads, portability

在过去五年中，主要从事 Java 和 .NET 的一些工作，并且在那段时间没有编写任何重要的 C 或 C++。所以已经离开那个场景一段时间了。

如果我今天想编写一个 C 或 C++ 程序，它执行一些多线程并且源代码可在 Windows、Mac OS X 和 Linux/Unix 之间移植——PThread 是一个不错的选择吗？

C 或 C++ 代码不会执行任何 GUI，因此无需担心任何这些。

不过，对于 Windows 平台，我不想带太多 Unix 包袱，就 unix 仿真运行时库而言。更喜欢适用于 Windows 的 PThread API，它是现有 Windows 线程 API 的尽可能薄的包装器。

**附录编辑：**

> 我倾向于使用 boost:thread - 我也希望能够使用 C++ try/catch 异常处理。即使我的程序相当小而且不是特别 OOPish，我还是喜欢使用类和命名空间来封装——而不是 C 的非实体函数。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-31T23:30:32.667

嗯，pthreads 是编写线程程序的旧 posix 标准。它是最低级别的线程例程，因此它是跨平台线程的不错选择。

但是，还有其他选择：

*   [boost::thread](http://www.ddj.com/cpp/184401518) - STL 风格的线程库
*   英特尔的[线程构建模块](http://www.threadingbuildingblocks.org/)
*   [OpenMP](http://openmp.org/wp/) - 这两者都是编写线程应用程序的高级方式，无需进行任何线程调用。

由于后者在所有平台上都得到完全支持，（pthreads 需要一些编译器设置作为 Windows posix 子系统的唯一部分，除非你想使用[Pthreads-w32](http://sourceware.org/pthreads-win32/)），那么也许后者是更好的选择。boost::threads 更像是一个线程库，另外两个是无需编写“线程”代码即可实现并行性的高级方法，它们允许您编写自动并发运行的循环（取决于常识条件）

Boost::thread 虽然不是 C 兼容库。

**编辑**：以上的跨平台能力：

> [英特尔 TBB 是跨平台的](http://www.intel.com/cd/software/products/asmo-na/eng/threading/294797.htm#sysreq)（Windows*、Linux* 和 Mac OS* X），支持 32 位和 64 位应用程序，并可与英特尔、微软和 GNU 编译器一起使用。

OpenMP 取决于您要使用的编译器，但 GCC 和/或 Intel[编译器已支持](http://openmp.org/wp/openmp-compilers/)OpenMP Windows、Linux 和 MacOS。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-01T00:19:41.493

如果您需要您的代码真正可移植，那么最好远离散布在互联网上的各种库。在某些时候，您会发现他们不支持的平台，然后必须创建自己的分支。

这也不是一个很难解决的问题，并且可以成为创建跨平台代码的一个很好的练习。

我建议你创建一个类，例如 CThread，它对每个平台都有单独的 .cpp 实现，以及在你的线程构建/运行后调用的纯虚拟 execute() 函数。

这允许您使用最适合该平台的 API 来实现所有线程创建和睡眠/关闭/优先级代码。您可能还需要包含每个平台的定义/类型定义的标头（例如 ThreadTypes.h）。

例如

```
// ThreadTypes.h
#if defined(PLATFORM_WIN) || defined(PLATFORM_XBOX)
  typedef DWORD ThreadID
#elif defined(PLATFORM_PS3)
  // etc etc
#endif 
```

这就是我为 PC/PS2/PS3/360/Wii 等平台编写的所有跨平台线程代码的方式。对于互斥锁和信号量之类的东西，这也是一个很好的模式，如果你有线程，你肯定会在某些时候需要:)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-31T23:23:51.073

不，pthread 通常在 Windows 上不可用。（有一些实现它的尝试，但至少操作系统不直接支持它。）

如果您正在编写 C++，那么 Boost 就像往常一样是答案。Boost.Thread 有一个可移植（且更安全）的线程库。

在 C 语言中，最简单的解决方案可能是为 pthread 和 Windows 线程 API 编写一个通用的包装器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-22T03:48:29.960

我会打赌 ZThread

简单的 API，比 PThreads 更易于使用且免费

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-17T13:39:51.833

也看看 ting： [http ://code.google.com/p/ting/](http://code.google.com/p/ting/)

它是 Windows 和 Linux 之间的跨平台。尚无 Mac OS 支持。

# c# - 将 WPFToolkit DataGrid 从一维列表转换为二维矩阵

> ID：499781
> 
> 赞同：3
> 
> 时间：2009-01-31T23:18:10.430
> 
> 标签：c#, wpf, xaml, datagrid, wpftoolkit

我想知道是否有人尝试过以下操作或对如何操作有想法。

我有一个 WPFToolkit DataGrid，它绑定到一个 ObservableCollection 项目。因此，DataGrid 在 ObservableCollection 中显示的***行***数与我在 DataGrid 中定义的列数一样多。这一切都很好。我现在需要的是提供相同数据的另一个视图，只是，DataGrid在 ObservableCollection中显示了尽可能多的***单元格。***

假设我的 ObservableCollection 中有 100 个项目。原始场景显示了具有 100 行和 1 列的 DataGrid。在修改后的场景中，我需要用 10 行和 10 列显示它，其中每个单元格显示原始表示中的值。换句话说，我需要将我的 1D ObservableCollection 转换为 2D ObservableCollection 并将其显示在 DataGrid 中。我知道如何在后面的代码中以编程方式执行此操作，但是可以在 XAML 中完成吗？

让我稍微简化一下问题，以防万一有人对此有所了解。下面的 XAML 执行以下操作：

```
* Defines an XmlDataProvider just for dummy data
* Creates a DataGrid with 10 columns
      o each column is a DataGridTemplateColumn using the same CellTemplate
* The CellTemplate is a simple TextBlock bound to an XML element 
```

如果您运行下面的 XAML，您会发现 DataGrid 最终有 5 行，每本书一个，10 列具有相同的内容（都显示书名）。但是，尽管使用不同的数据集，我想要完成的是，在这种情况下，我最终会得到一行，每个书名出现在第 1 行的单个单元格中，占据单元格 0-4，并且单元格 5-9 中没有任何内容。然后，如果我添加更多数据并在我的 XML 数据源中有 12 本书，我将完全填满第 1 行（覆盖前 10 个标题的单元格），第 2 行将填满前 2 个单元格。

我的方案可以主要在 XAML 中完成，还是应该让自己在后面的代码中工作？

任何指导将不胜感激。非常感谢！

```
<UserControl
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
xmlns:custom="http://schemas.microsoft.com/wpf/2008/toolkit"
mc:Ignorable="d"
x:Name="UserControl"
d:DesignWidth="600" d:DesignHeight="400"  >
<UserControl.Resources>
    <XmlDataProvider x:Key="InventoryData" XPath="Inventory/Books">
        <x:XData>
            <Inventory xmlns="">
                <Books>
                    <Book ISBN="0-7356-0562-9" Stock="in" Number="9">
                        <Title>XML in Action</Title>
                        <Summary>XML Web Technology</Summary>
                    </Book>
                    <Book ISBN="0-7356-1370-2" Stock="in" Number="8">
                        <Title>Programming Microsoft Windows With C#</Title>
                        <Summary>C# Programming using the .NET Framework</Summary>
                    </Book>
                    <Book ISBN="0-7356-1288-9" Stock="out" Number="7">
                        <Title>Inside C#</Title>
                        <Summary>C# Language Programming</Summary>
                    </Book>
                    <Book ISBN="0-7356-1377-X" Stock="in" Number="5">
                        <Title>Introducing Microsoft .NET</Title>
                        <Summary>Overview of .NET Technology</Summary>
                    </Book>
                    <Book ISBN="0-7356-1448-2" Stock="out" Number="4">
                        <Title>Microsoft C# Language Specifications</Title>
                        <Summary>The C# language definition</Summary>
                    </Book>
                </Books>
                <CDs>
                    <CD Stock="in" Number="3">
                        <Title>Classical Collection</Title>
                        <Summary>Classical Music</Summary>
                    </CD>
                    <CD Stock="out" Number="9">
                        <Title>Jazz Collection</Title>
                        <Summary>Jazz Music</Summary>
                    </CD>
                </CDs>
            </Inventory>
        </x:XData>
    </XmlDataProvider>

    <DataTemplate x:Key="GridCellTemplate">
        <TextBlock>
            <TextBlock.Text>
                <Binding XPath="Title"/>
            </TextBlock.Text>
        </TextBlock>
    </DataTemplate>

</UserControl.Resources>

<Grid x:Name="LayoutRoot">
    <custom:DataGrid HorizontalAlignment="Stretch" VerticalAlignment="Stretch" IsSynchronizedWithCurrentItem="True"
    Background="{DynamicResource WindowBackgroundBrush}" HeadersVisibility="All" RowDetailsVisibilityMode="Collapsed"
    SelectionUnit="CellOrRowHeader" CanUserResizeRows="False" GridLinesVisibility="None" RowHeaderWidth="35" AutoGenerateColumns="False"
    CanUserReorderColumns="False" CanUserSortColumns="False">
        <custom:DataGrid.Columns>
            <custom:DataGridTemplateColumn CellTemplate="{StaticResource GridCellTemplate}" Header="01" />
            <custom:DataGridTemplateColumn CellTemplate="{StaticResource GridCellTemplate}" Header="02" />
            <custom:DataGridTemplateColumn CellTemplate="{StaticResource GridCellTemplate}" Header="03" />
            <custom:DataGridTemplateColumn CellTemplate="{StaticResource GridCellTemplate}" Header="04" />
            <custom:DataGridTemplateColumn CellTemplate="{StaticResource GridCellTemplate}" Header="05" />
            <custom:DataGridTemplateColumn CellTemplate="{StaticResource GridCellTemplate}" Header="06" />
            <custom:DataGridTemplateColumn CellTemplate="{StaticResource GridCellTemplate}" Header="07" />
            <custom:DataGridTemplateColumn CellTemplate="{StaticResource GridCellTemplate}" Header="08" />
            <custom:DataGridTemplateColumn CellTemplate="{StaticResource GridCellTemplate}" Header="09" />
            <custom:DataGridTemplateColumn CellTemplate="{StaticResource GridCellTemplate}" Header="10" />
        </custom:DataGrid.Columns>
        <custom:DataGrid.ItemsSource>
            <Binding Source="{StaticResource InventoryData}" XPath="Book"/>
        </custom:DataGrid.ItemsSource>
    </custom:DataGrid>
</Grid> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-22T10:56:41.497

因此，简单地重新表述您的问题，您有一个对象集合，并且您希望将它们水平显示，每行 10 个。如果超过 10 个，则多余的项目会环绕（重排）到下一行。

**以下是您可以非常轻松地做到这一点的方法：**

*不要使用数据网格。*这基本上仅用于将对象 1 对象显示到行中，其中列显示该对象的各种数据。

相反，使用 ListBox 或 ListView，并给它一个新的`ItemsPanel`，像这样（使用数据模板来显示复杂的对象）：

```
<ListBox ItemsSource="{Binding SomeCollectionOfObjects}">
    <ListBox.ItemsPanel>
        <ItemsPanelTemplate>
            <UniformGrid Columns="10"/>
        </ItemsPanelTemplate>
    </ListBox.ItemsPanel>
</ListBox> 
```

这将替换`VirtualizingStackPanel`ListBox 用于排列其项目的默认设置`UniformGrid`。使用 UniformGrid 的原因是您可以指定网格应具有的列数和/或行数。该面板将在 ListBox 的项目之间平均划分显示区域，但有 10 列（如您所愿）。

如果您不想要固定数量的列/行，则可以改用 a`WrapPanel`它将尽可能多的对象放入一行并换行到下一行，有点像`inline-block`html 中的元素或左对齐文本.

最后一件事：请记住，我刚才提到的这 3 个面板中的每一个都可以`Orientation`设置为`Horizontal`（UniformGrid 和 WrapPanel 的`Vertical`默认值）或（VirtualizingStackPanel 和 StackPanel 的默认值）。

此外，您可以为自定义项目布局编写自己的面板（例如将项目排列成一个圆圈）。

# c - 给定一个音频流，找出门何时关上（声压级计算？）

> ID：499795
> 
> 赞同：41
> 
> 时间：2009-01-31T23:29:24.933
> 
> 标签：c, algorithm, audio, signal-processing

与拍手检测器不同（“拍手！*拍手拍手*拍手！*拍手拍手*拍手，拍手拍手！ *拍手拍手*”）我需要检测门何时关闭。这是在车辆中，比房间或家庭门更容易：

听：[http ://ubasics.com/so/van_driver_door_closing.wav](http://ubasics.com/so/van_driver_door_closing.wav)

看：
[![波形图像显示稳定线，然后突然中断，稳定到稳定线](https://farm4.static.flickr.com/3491/3241829861_4b8311e8ca.jpg)](http://flickr.com/photos/adavis/3241829861/)

它以 16 位 4khz 采样，我想避免大量处理或存储样本。

当您在大胆或其他波形工具中查看它时，它非常独特，并且几乎总是由于车辆声压的增加而出现剪辑 - 即使在窗户和其他门打开时也是如此：

听：[http ://ubasics.com/so/van_driverdoorclosing_slidingdoorsopen_windowsopen_engineon.wav](http://ubasics.com/so/van_driverdoorclosing_slidingdoorsopen_windowsopen_engineon.wav)

看：
[![替代文字](https://farm4.static.flickr.com/3517/3241829885_6bc30b6ef1.jpg)](http://flickr.com/photos/adavis/3241829885/)

我希望有一个相对简单的算法可以读取 4kHz、8 位的读数，并跟踪“稳态”。当算法检测到声级显着增加时，它会标记该点。

*   你怎么认为？
*   您将如何检测此事件？
*   是否有可能有帮助的声压级计算的代码示例？
*   我可以减少采样频率（1kHz 甚至更慢吗？）

**更新：**使用 Octave（开源数值分析 - 类似于 Matlab）并查看均方根是否能给我所需的东西（这导致与 SPL 非常相似的东西）

**更新 2：**计算 RMS 在简单的情况下很容易发现门关闭： 现在我只需要查看困难的情况（收音机打开、加热/空气打开等）。CFAR 看起来非常有趣——我知道我将不得不使用自适应算法，而 CFAR 肯定符合要求。
[![替代文字](https://farm4.static.flickr.com/3518/3242677587_e6c7b0df18_m.jpg) ](http://flickr.com/photos/adavis/3242677587/) [ ![替代文字](https://farm4.static.flickr.com/3405/3243509994_7f0eb52d21_m.jpg)](http://flickr.com/photos/adavis/3243509994/)

-亚当

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-01T02:54:46.297

查看源音频文件的屏幕截图，检测声级变化的一种简单方法是对样本进行[数值积分](http://en.wikipedia.org/wiki/Numerical_integration)，以找出特定时间波的“能量”。

一个粗略的算法是：

1.  将样本分成几部分
2.  计算每个部分的能量
3.  取前一个窗口和当前窗口之间的能量比
4.  如果该比率超过某个阈值，则确定有突然的巨响。

**伪代码**

```
samples = load_audio_samples()     // Array containing audio samples
WINDOW_SIZE = 1000                 // Sample window of 1000 samples (example)

for (i = 0; i < samples.length; i += WINDOW_SIZE):
    // Perform a numerical integration of the current window using simple
    // addition of current sample to a sum.
    for (j = 0; j < WINDOW_SIZE; j++):
        energy += samples[i+j]

    // Take ratio of energies of last window and current window, and see
    // if there is a big difference in the energies. If so, there is a
    // sudden loud noise.
    if (energy / last_energy > THRESHOLD):
        sudden_sound_detected()

    last_energy = energy
    energy = 0; 
```

**我应该添加一个我没有尝试过的免责声明。**

这种方式应该可以在不首先记录所有样本的情况下执行。只要有一定长度的缓冲区（`WINDOW_SIZE`在示例中），就可以执行数值积分来计算声音部分的能量。但是，这确实意味着处理过程中会有延迟，具体取决于`WINDOW_SIZE`. 确定一段声音的合适长度是另一个问题。

**如何分割成多个部分**

在第一个音频文件中，似乎关门声音的持续时间是 0.25 秒，所以用于数值积分的窗口应该最多是它的一半，甚至更接近十分之一，所以两者之间的差异即使窗口在静音部分和噪音部分之间重叠，也可以注意到静音和突然的声音。

例如，如果积分窗口为 0.5 秒，第一个窗口覆盖了 0.25 秒的静音和 0.25 秒的关门，第二个窗口覆盖了 0.25 秒的关门和 0.25 秒的静音，则可能会出现两段声音的噪音水平相同，因此不会触发声音检测。我想有一个短窗口会在一定程度上缓解这个问题。

但是，窗口太短将意味着声音的上升可能无法完全适应一个窗口，并且可能会显得相邻部分之间的能量差异很小，这可能会导致声音丢失。

我相信`WINDOW_SIZE`和`THRESHOLD`都必须根据经验确定要检测的声音。

为了确定该算法需要在内存中保留多少样本，假设`WINDOW_SIZE`是关门声音的 1/10，大约为 0.025 秒。在 4 kHz 的采样率下，即 100 个样本。这似乎不是太多的内存要求。使用 200 字节的 16 位样本。

**优点缺点**

这种方法的优点是，如果源音频以整数形式输入，则可以使用简单的整数运算来执行处理。如前所述，关键是实时处理会有延迟，具体取决于集成部分的大小。

对于这种方法，我可以想到几个问题：

1.  如果背景噪音太大，背景噪音和关门的能量差异将不容易区分，并且可能无法检测到关门。
2.  任何突然的声音，例如拍手声，都可以视为门正在关闭。

也许，结合其他答案中的建议，例如尝试使用傅里叶分析来分析关门的频率特征，这将需要更多的处理，但会使其不易出错。

在找到解决此问题的方法之前，可能需要进行一些实验。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-01T03:17:12.803

您应该点击车内的关门开关。试图通过声音分析来做到这一点是过度工程。

有很多关于不同信号处理方法的建议，但实际上，当你学习检测理论、构建嵌入式信号处理板、学习你选择的芯片的处理架构、尝试算法、调试它时，然后为您想要使用它的汽车调整它（然后为每辆其他汽车重新调整和重新调试），您会希望您只是在车内粘上一个簧片开关并将一块磁铁热粘到门。

并不是说这对 dsp 专家来说不是一个有趣的问题，但是从您提出这个问题的方式来看，很明显声音处理不是您想要采取的路线。让它正常工作将是一场噩梦。

此外，拍板只是一个高通滤波器，馈入阈值检测器。（加上一个计时器，以确保 2 次拍手足够快）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-01T04:16:05.807

雷达界有很多关于这个问题的相关文献（称为探测理论）。

您可能会查看“单元平均 CFAR”（恒定误报率）检测。[维基百科在这里](http://en.wikipedia.org/wiki/Constant_false_alarm_rate)有一点。您的想法与此非常相似，它应该可以工作！:)

祝你好运！

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-01T04:05:34.470

我将从查看光谱开始。我对您提供的两个音频文件进行了此操作，您似乎可以使用一些相似之处。例如，两者之间的主要区别似乎在 40-50Hz 左右。我的.02。

**更新**

发了这个之后我有了另一个想法。如果可以，请在设备上添加加速度计。然后**关联振动和声学信号**。这应该有助于跨车门检测。我认为它应该具有很好的相关性，因为声音是振动驱动的，而立体声则不是。我有一个能够通过挡风玻璃支架（吸盘）检测我的发动机转速的设备，所以灵敏度可能在那里。（我不保证这行得通！）

[![替代文字](https://i.stack.imgur.com/UKAa8.jpg)](https://i.stack.imgur.com/UKAa8.jpg)
[（来源：[charlesrcook.com](http://www.charlesrcook.com/spectral.jpg)）]

```
%% Test Script (Matlab)
clear
hold all %keep plots open
dt=.001

%% Van driver door
data = wavread('van_driver_door_closing.wav');

%Frequency analysis
NFFT = 2^nextpow2(length(data));
Y = fft(data(:,2), NFFT)/length(data);
freq = (1/dt)/2*linspace(0,1,NFFT/2);
spectral = [freq'  2*abs(Y(1:NFFT/2))];

plot(spectral(:,1),spectral(:,2))

%% Repeat for van sliding door
data = wavread('van_driverdoorclosing.wav');

%Frequency analysis
NFFT = 2^nextpow2(length(data));
Y = fft(data(:,2), NFFT)/length(data);
freq = (1/dt)/2*linspace(0,1,NFFT/2);
spectral = [freq'  2*abs(Y(1:NFFT/2))];

plot(spectral(:,1),spectral(:,2)) 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-01T13:00:41.767

在音频信号中发现明显尖峰的过程称为[瞬态检测](http://www.google.com/search?hl=en&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=bSH&q=transient+detection&btnG=Search)。[索尼的 Acid](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fwww.sonycreativesoftware.com%2Fproducts%2Facidfamily.asp&ei=H5yFSeuBJtPGtge-zsnRCQ&usg=AFQjCNHikj6senHDENobO2IWIhgDvrU4PA&sig2=ml9Yno2XAGLlxIeqw0gIuQ)和[Ableton Live](http://www.ableton.com)等应用程序使用瞬态检测来查找音乐中的节拍以进行节拍匹配。

您在上面的波形中看到的明显尖峰称为瞬态，有几种很好的算法可以检测它。能源问题中的[瞬态检测和分类一](http://www.google.com/url?sa=t&source=web&ct=res&cd=2&url=http%3A%2F%2Fwww.signion.com%2Ftransient.pdf&ei=eZyFSarfFZW6twf2pd3ICQ&usg=AFQjCNF8Ti-F1lEQm5yjhqRNm-L3xzoKng&sig2=L741z8k5PYTn9GD72pmSUQ)文描述了 3 种方法来做到这一点。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-01T00:41:25.677

我想频率和幅度也会因车辆而异。确定这一点的最佳方法是在 Civic 和大型 SUV 中取样。也许您可以让用户以“学习”模式关上门以获取幅度和频率特征。然后你可以用它来比较在使用模式下的时间。

您还可以考虑使用[傅立叶分析](http://en.wikipedia.org/wiki/Fourier_analysis)来消除与关门无关的背景噪音。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-31T23:51:21.707

也许您应该尝试检测应标记门关闭的气压的显着瞬时升高。您可以将它与此波形和声级分析配对，这些都可能会给您带来更好的结果。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-02T02:35:59.593

在采样频率较低的问题上，可以捕获的最高声音频率是采样率的一半。因此，如果车门声音在 1000Hz（例如）时最强，那么低于 2000Hz 的采样率将完全失去该声音

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-02T07:55:21.573

在您的情况下，一个非常简单的噪声门可能就可以了。只需等待幅度高于指定阈值的第一个样本（以避免触发背景噪声）。如果您需要区分不同类型的噪音（例如关门与拍手），您只需要变得比这更复杂。

# php - 捕获空白（包括全空格）表单提交

> ID：499803
> 
> 赞同：1
> 
> 时间：2009-01-31T23:41:06.937
> 
> 标签：php, post

如果我的网站上有问题，如果用户使用空间，他们可以发布空消息。

### 代码：

```
if (isset($_POST['submit'])) {

  // check for empty fields
  if (empty($_POST['headline']) || empty($_POST['text']) ||
      empty($_POST['forum_id'])) {
      header("Refresh: 2; url=/add-thread"); 
      die('You must fill out every field.');
  }

// No errors? Save.
else {
$headline = mysql_real_escape_string($_POST['headline']);
$text = mysql_real_escape_string($_POST['text']);

mysql_query("INSERT INTO threads (headline, text, date, forum_id, user_id)
             VALUES ('$headline', '$text', NOW(), '$_POST[forum_id]', '$user[id]')");

header("Location: /thread/".mysql_insert_id()."");
}

} 
```

我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-31T23:41:53.130

`trim()`文本输入。您可以像这样轻松地做到这一点：

```
// get input vars and trim space
$callback = array('filter' => FILTER_CALLBACK, 'options' => 'trim');
$fields = filter_input_array(INPUT_POST, array(
    'headline' => $callback,
    'text'     => $callback,
    'forum_id' => $callback,
));

// check for empty fields by counting how many are set
if ( count($fields) != count(array_filter($fields)) ) {
    // something was unset
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T03:14:30.140

空函数检查符合设定条件的变量，来自[手册](http://us.php.net/empty)

> 如果 var 具有非空且非零值，则返回 FALSE。
> 
> 以下内容被认为是空的：
> 
> *   ""（一个空字符串）
>     
>     
> *   0（0 为整数）
>     
>     
> *   "0" (0 作为字符串)
>     
>     
> *   无效的
>     
>     
> *   错误的
>     
>     
> *   array() （一个空数组）
>     
>     
> *   变量$变量；（声明的变量，但在类中没有值）

您的 $_POST 字段实际上包含类似这样的内容

```
"   "; 
```

这不是空字符串，而是一个用空白字符填充的字符串。

在使用空（）之前，修剪（）您发布的值中的空白

```
$trimmed_post = array();
foreach($_POST as $key=>$value){
    $trimmed_post[$key] = $value;
}
if(!empty($trimmed_post['headline'])){
    //...
} 
```

您不需要将新值放入新数组中，但我不喜欢更改自动生成的超全局变量中的内容。

最后一点，你不能做这样的事情

```
if(!empty(trim($_POST['headline']))){
   //...
} 
```

因为空函数期望传递一个实际变量。你可以做这样的事情

```
if('' != trim($_POST['headline'])){
//...
} 
```

这可能是最好的方法。您减少了需要调用的函数数量，用户可以发布值为 0 的条目，并且代码更明确地说明了它的作用。您将看到的另一种形式是

```
if(trim($_POST['headline'])){

} 
```

这是因为 PHP 将空字符串 ('') 评估为 false，将非空字符串评估为 true。我倾向于避免这种形式，因为我发现很多 PHP 错误都是围绕着对相等运算符如何从某些类型中获取布尔值的误解而出现的。明确有助于减少此类错误的发生。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T00:23:13.390

快速说明：您正在将值`$_POST['forum_id']`注入 SQL；这不是一个好主意，因为用户可以根据需要操纵该值，即使它来自隐藏字段。明智的做法是转义该值，或者至少将其传递[`intval()`](http://uk3.php.net/intval)并确保它是一个整数（假设整数帖子标识符）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T02:20:23.870

我同意修剪是要走的路。这是一个更简单的方法：

```
$_POST = array_map('trim', $_POST); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T23:46:38.360

尝试

```
if (!empty($_POST['headline']) && !empty($_POST['text']) &&
!empty($_POST['forum_id'])) 
```

对于逻辑。

不过，您必须切换它。

更新澄清：

```
if (isset($_POST['submit']) && !empty($_POST['headline']) && 
!empty($_POST['text']) && !empty($_POST['forum_id'])) {

    $headline = mysql_real_escape_string($_POST['headline']);
    $text = mysql_real_escape_string($_POST['text']);

    mysql_query("INSERT INTO threads (headline, text, date, forum_id, user_id)
         VALUES ('$headline', '$text', NOW(), '$_POST[forum_id]', '$user[id]')");

    header("Location: /thread/".mysql_insert_id()."");
}
else
{
  header("Refresh: 2; url=/add-thread"); 
  die('You must fill out every field.');    
} 
```

}

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-31T23:59:33.250

在检查提交后：

```
foreach ( $_POST as $key => &$value ) $value = trim($value); 
```

**针对提问者的评论进行编辑：**

奇怪的是它没有像上面那样工作。这是我确认它的练习。

```
tbramble@wayfarer:~$ php -a
Interactive shell

php > $arr = array('one',' two', ' three ');
php > print_r($arr);
Array
(
    [0] => one
    [1] =>  two
    [2] =>  three 
)
php > foreach ( $arr as $key => &$value ) $value = trim($value);
php > print_r($arr);
Array
(
    [0] => one
    [1] => two
    [2] => three
) 
```

必须与处理超全局而不是普通数组有关。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-01T02:12:11.657

应用程序启动后，我会修剪每个`$_GET`&`$_POST`变量。尝试这样的事情：

```
function trimArray(&$array) {
    if (empty($array)) {
        return;
    }

    foreach ($array as $k => $v) {
        if (! is_array($v)) {
            $array[$k] = trim($v);
        } else {
            trimArray($v);
        }
    }
}

if (! empty($_GET)) {
    trimArray($_GET);
}
if (! empty($_POST)) {
    trimArray($_POST);
} 
```

# iphone - 我的 iphone 上的应用程序列表是否可以在不同的显示器中重复使用？

> ID：499809
> 
> 赞同：0
> 
> 时间：2009-01-31T23:43:44.577
> 
> 标签：iphone

我有一个想法，将我 iphone 上的应用程序用作启动程序的不同方式的列表。但我不知道我是否可以在我可以显示的东西中看到这些应用程序？这可能吗？如果可能，我可以从我的应用程序启动列出的应用程序吗？我需要访问什么才能完成这项工作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T00:03:52.913

无法使用官方 SDK 枚举用户已安装的应用程序列表。

非正式地，使用越狱手机，您可以检查应用程序文件夹的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T00:27:16.970

确实，没有特定的方法可以使用普通 SDK 执行此操作。但是，如果您使用了 URL 方案的特定应用程序，您可以通过编程方式调用它们。谷歌地图、邮件、Safari、短信都有。任何应用程序都可以选择实现自己的自定义应用程序。这显然对任何随机应用程序都没有帮助，但如果您有特定的应用程序您的目标，您可能能够以这种方式集成。

# javascript - 递归连接一个javascript函数参数

> ID：499814
> 
> 赞同：6
> 
> 时间：2009-01-31T23:46:45.910
> 
> 标签：javascript, recursion, variadic-functions

我遇到了一个 javascript 谜题：编写一段 JavaScript 代码，将所有传递给函数的字符串连接起来：

```
 function concatenate(/*any number of strings*/) {
      var string = /*your one line here*/
      return string;
    } 

```

@[米波](http://www.meebo.com/jobs/openings/javascript/ "美宝")

看到函数参数表示为索引对象可能是一个数组，我认为可以以递归方式完成。但是我的递归实现抛出了一个错误。--"conc.arguments.shift 不是函数"--

```
 function conc(){
        if (conc.arguments.length === 0) 
            return "";
        else 
            return conc.arguments.shift() + conc(conc.arguments);
} 

```

似乎 conc.arguments 不是数组，而是可以通过数字索引访问并具有长度属性？？？令人困惑 - 请分享意见和其他递归实现。

谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-01T00:18:10.357

`arguments` [据说是](http://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Functions_and_function_scope/arguments)一个类似数组的对象。正如您已经看到的，您可以通过索引访问它的元素，但是您没有所有的 Array 方法可供您使用。类似数组的对象的其他示例是由 getElementsByTagName() 或 getElementsByClassName() 返回的 HTML 集合。jQuery，如果你曾经使用过它，它也是一个类似数组的对象。在查询了一些 DOM 对象后，在 DOM 选项卡中使用 Firebug 检查生成的 jQuery 对象，您就会明白我的意思了。

这是我对 Meebo 问题的解决方案：

```
function conc(){
    if (arguments.length === 0)
        return "";
    else
        return Array.prototype.slice.call(arguments).join(" ");
}

alert(conc("a", "b", "c")); 
```

`Array.prototype.slice.call(arguments)``arguments`将我们的对象转换为名副其实的 Array 对象是一个不错的技巧。在 Firefox`Array.slice.call(arguments)`中就足够了，但它不会在 IE6 中工作（至少），所以以前的版本是通常使用的。此外，这个技巧不适用于 IE6 中的 DOM API 方法返回的集合（至少）；它会抛出一个错误。顺便说一句，`call`可以使用`apply`.

关于类数组对象的一点解释。在 JavaScript 中，您几乎可以使用任何东西来命名对象的成员，数字也不例外。所以你可以构造一个看起来像这样的对象，它是完全有效的 JavaScript：

```
var Foo = {
    bar : function() {
        alert('I am bar');
    },

    0 : function() {
        alert('I am 1');
    },

    length : 1
} 
```

上面的对象是一个类似数组的对象，原因有两个：

1.  它的成员名称是数字，所以它们就像数组索引
2.  它有一个`length`属性，如果没有它，您将无法使用以下构造将对象转换为名副其实的 Array：`Array.prototype.slice.call(Foo);`

Function 对象的 arguments 对象与 Foo 对象非常相似，只是它有其特殊用途。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-01T00:07:14.030

[Mozilla 关于这个主题](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Functions_and_function_scope/arguments)：

> arguments 对象不是数组。它类似于数组，但除了长度之外没有任何数组属性。例如，它没有 pop 方法。但是它可以转换为一个真正的数组：
> 
> ```
> var args = Array.prototype.slice.call(arguments); 
> ```

因此，您的问题的解决方案相当简单：

```
var string = Array.prototype.slice.call(arguments).join(""); 
```

顺便说一句：它进一步指出：

> arguments 对象是所有函数中可用的局部变量；不能再使用作为 Function 属性的参数。

你应该只使用`arguments`而不是`func.arguments`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-01T00:20:17.920

这有效：

```
function concatenate(){
    return [].join.call(arguments, "");
}
alert(concatenate("one", "two", "three")); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T23:56:05.190

参数列表不是真正的数组。我认为您可以借用数组方法并将它们用于带有“调用”或“应用”的参数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-01T00:18:32.773

你可以这样做：

```
function concatenate() {
    if (arguments.length > 1) {
        return arguments[0] + concatenate.apply(this, Array.prototype.splice.call(arguments, 1));
    }
    return arguments[0];
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-12-28T02:30:43.870

它至少可以使用 6 种不同的方法`Array.prototype`（我怀疑还有更多），即`join`, `slice`, `splice`, `concat`, `reduce`, `flat`。可能最短的方法是 using `join`，也就是上面[@svinto](https://stackoverflow.com/users/19707/svinto)的解决方案。`g`与@GeorgSchölly 的答案相同。

瞧，六种解决方案：

```
function f(){
  return [].join.call(arguments,'');
}
function g(){
  return [].slice.call(arguments).join('');
}
function h(){
  return [].splice.call(arguments,0).join('');
}
function i(){
  return [].concat.apply([], arguments).join('');
}
function j(){
  return [].reduce.call(arguments,function(buff,x){return buff+x},'');
}
function k(){
  return [].flat.call(arguments).join('');
}
document.getElementById('F').textContent = f('a','b','c');
document.getElementById('G').textContent = g('a','b','c');
document.getElementById('H').textContent = h('a','b','c');
document.getElementById('I').textContent = i('a','b','c');
document.getElementById('J').textContent = j('a','b','c');
document.getElementById('K').textContent = k('a','b','c');
```

```
<pre id='F'></pre>
<pre id='G'></pre>
<pre id='H'></pre>
<pre id='I'></pre>
<pre id='J'></pre>
<pre id='K'></pre>
```

# asp.net - 从 ASP.NET MVC 操作发送 HTTP 404 响应的正确方法是什么？

> ID：499817
> 
> 赞同：92
> 
> 时间：2009-01-31T23:48:32.240
> 
> 标签：asp.net, asp.net-mvc, http-status-code-404

如果给定路线：

**{FeedName}/{ItemPermalink}**

例如：/博客/Hello-World

如果该项目不存在，我想返回 404。在 ASP.NET MVC 中执行此操作的正确方法是什么？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-02-01T00:26:56.547

从臀部射击（牛仔编码;-)），我建议这样的事情：

**控制器：**

```
public class HomeController : Controller
{
    public ActionResult Index()
    {
        return new HttpNotFoundResult("This doesn't exist");
    }
} 
```

* * *

**HttpNotFoundResult:**

```
using System;
using System.Net;
using System.Web;
using System.Web.Mvc;

namespace YourNamespaceHere
{
    /// <summary>An implementation of <see cref="ActionResult" /> that throws an <see cref="HttpException" />.</summary>
    public class HttpNotFoundResult : ActionResult
    {
        /// <summary>Initializes a new instance of <see cref="HttpNotFoundResult" /> with the specified <paramref name="message"/>.</summary>
        /// <param name="message"></param>
        public HttpNotFoundResult(String message)
        {
            this.Message = message;
        }

        /// <summary>Initializes a new instance of <see cref="HttpNotFoundResult" /> with an empty message.</summary>
        public HttpNotFoundResult()
            : this(String.Empty) { }

        /// <summary>Gets or sets the message that will be passed to the thrown <see cref="HttpException" />.</summary>
        public String Message { get; set; }

        /// <summary>Overrides the base <see cref="ActionResult.ExecuteResult" /> functionality to throw an <see cref="HttpException" />.</summary>
        public override void ExecuteResult(ControllerContext context)
        {
            throw new HttpException((Int32)HttpStatusCode.NotFound, this.Message);
        }
    }
}
// By Erik van Brakel, with edits from Daniel Schaffer :) 
```

使用这种方法，您可以遵守框架标准。那里已经有一个 HttpUnauthorizedResult，所以这只会在另一个开发人员的眼中扩展框架，以便稍后维护您的代码（你知道，知道你住在哪里的精神病）。

您可以使用反射器查看程序集以查看 HttpUnauthorizedResult 是如何实现的，因为我不知道这种方法是否遗漏了什么（似乎太简单了）。

* * *

刚才确实用反射器看了一下HttpUnauthorizedResult。似乎他们在对 0x191 (401) 的响应中设置了 StatusCode。虽然这适用于 401，但使用 404 作为新值，我似乎在 Firefox 中得到了一个空白页。Internet Explorer 显示默认的 404（不是 ASP.NET 版本）。使用 webdeveloper 工具栏，我检查了 FF 中的标题，它确实显示了 404 Not Found 响应。可能只是我在FF中配置错误的东西。

* * *

话虽如此，我认为 Jeff 的方法是 KISS 的一个很好的例子。如果您真的不需要此示例中的冗长，那么他的方法也可以正常工作。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-02-01T00:39:33.747

我们这样做；此代码位于`BaseController`

```
/// <summary>
/// returns our standard page not found view
/// </summary>
protected ViewResult PageNotFound()
{
    Response.StatusCode = 404;
    return View("PageNotFound");
} 
```

像这样称呼

```
public ActionResult ShowUserDetails(int? id)
{        
    // make sure we have a valid ID
    if (!id.HasValue) return PageNotFound(); 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-02-01T00:04:27.093

```
throw new HttpException(404, "Are you sure you're in the right place?"); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-06-22T17:42:39.677

HttpNotFoundResult 是我正在使用的一个很好的第一步。返回一个 HttpNotFoundResult 很好。那么问题来了，接下来呢？

我创建了一个名为 HandleNotFoundAttribute 的操作过滤器，然后显示 404 错误页面。由于它返回一个视图，您可以为每个控制器创建一个特殊的 404 视图，或者让我们使用默认的共享 404 视图。这甚至会在控制器不存在指定的操作时调用，因为框架会抛出状态码为 404 的 HttpException。

```
public class HandleNotFoundAttribute : ActionFilterAttribute, IExceptionFilter
{
    public void OnException(ExceptionContext filterContext)
    {
        var httpException = filterContext.Exception.GetBaseException() as HttpException;
        if (httpException != null && httpException.GetHttpCode() == (int)HttpStatusCode.NotFound)
        {
            filterContext.HttpContext.Response.TrySkipIisCustomErrors = true; // Prevents IIS from intercepting the error and displaying its own content.
            filterContext.ExceptionHandled = true;
            filterContext.HttpContext.Response.StatusCode = (int) HttpStatusCode.NotFound;
            filterContext.Result = new ViewResult
                                        {
                                            ViewName = "404",
                                            ViewData = filterContext.Controller.ViewData,
                                            TempData = filterContext.Controller.TempData
                                        };
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-02-04T10:08:52.270

请注意，从 MVC3 开始，您可以只使用`HttpStatusCodeResult`.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-03-10T02:49:27.783

使用**ActionFilter**很难**维护**，因为每当我们抛出错误时，都需要在属性中设置过滤器。如果我们忘记设置它怎么办？一种方法是`OnException`在基本控制器上派生。您需要定义一个`BaseController`派生自`Controller`，并且您的所有控制器都必须派生自`BaseController`. 最好有一个基本控制器。

注意如果使用`Exception`响应状态码是 500，那么我们需要将其更改为 404 表示未找到，401 表示未授权。就像我上面提到的，使用`OnException`覆盖`BaseController`来避免使用过滤器属性。

新的 MVC 3 还通过向浏览器返回空视图来增加麻烦。经过一些研究后的最佳解决方案是基于我在此处的回答[How to return a view for HttpNotFound() in ASP.Net MVC 3?](https://stackoverflow.com/questions/4985550/how-to-return-a-view-for-httpnotfound-in-asp-net-mvc-3/5254840#5254840)

为了更方便，我把它贴在这里：

* * *

经过一番学习。**MVC 3**的**解决**方法是派生所有`HttpNotFoundResult`, `HttpUnauthorizedResult`,`HttpStatusCodeResult`类并在.**`HttpNotFound``BaseController`**

 **最佳实践是使用基本控制器，这样您就可以“控制”所有派生控制器。

我创建新`HttpStatusCodeResult`类，不是派生`ActionResult`而是通过指定属性`ViewResult`来呈现视图或任何`View`您想要的。`ViewName`我按照原来`HttpStatusCodeResult`的设置`HttpContext.Response.StatusCode`，`HttpContext.Response.StatusDescription`然后`base.ExecuteResult(context)`将呈现合适的视图，因为我再次派生自`ViewResult`. 够简单吧？希望这将在 MVC 核心中实现。

见我的`BaseController`波纹管：

```
using System.Web;
using System.Web.Mvc;

namespace YourNamespace.Controllers
{
    public class BaseController : Controller
    {
        public BaseController()
        {
            ViewBag.MetaDescription = Settings.metaDescription;
            ViewBag.MetaKeywords = Settings.metaKeywords;
        }

        protected new HttpNotFoundResult HttpNotFound(string statusDescription = null)
        {
            return new HttpNotFoundResult(statusDescription);
        }

        protected HttpUnauthorizedResult HttpUnauthorized(string statusDescription = null)
        {
            return new HttpUnauthorizedResult(statusDescription);
        }

        protected class HttpNotFoundResult : HttpStatusCodeResult
        {
            public HttpNotFoundResult() : this(null) { }

            public HttpNotFoundResult(string statusDescription) : base(404, statusDescription) { }

        }

        protected class HttpUnauthorizedResult : HttpStatusCodeResult
        {
            public HttpUnauthorizedResult(string statusDescription) : base(401, statusDescription) { }
        }

        protected class HttpStatusCodeResult : ViewResult
        {
            public int StatusCode { get; private set; }
            public string StatusDescription { get; private set; }

            public HttpStatusCodeResult(int statusCode) : this(statusCode, null) { }

            public HttpStatusCodeResult(int statusCode, string statusDescription)
            {
                this.StatusCode = statusCode;
                this.StatusDescription = statusDescription;
            }

            public override void ExecuteResult(ControllerContext context)
            {
                if (context == null)
                {
                    throw new ArgumentNullException("context");
                }

                context.HttpContext.Response.StatusCode = this.StatusCode;
                if (this.StatusDescription != null)
                {
                    context.HttpContext.Response.StatusDescription = this.StatusDescription;
                }
                // 1\. Uncomment this to use the existing Error.ascx / Error.cshtml to view as an error or
                // 2\. Uncomment this and change to any custom view and set the name here or simply
                // 3\. (Recommended) Let it commented and the ViewName will be the current controller view action and on your view (or layout view even better) show the @ViewBag.Message to produce an inline message that tell the Not Found or Unauthorized
                //this.ViewName = "Error";
                this.ViewBag.Message = context.HttpContext.Response.StatusDescription;
                base.ExecuteResult(context);
            }
        }
    }
} 
```

要像这样在您的操作中使用：

```
public ActionResult Index()
{
    // Some processing
    if (...)
        return HttpNotFound();
    // Other processing
} 
```

在 _Layout.cshtml 中（如母版页）

```
<div class="content">
    @if (ViewBag.Message != null)
    {
        <div class="inlineMsg"><p>@ViewBag.Message</p></div>
    }
    @RenderBody()
</div> 
```

此外，您可以像我在代码中评论的那样使用自定义视图`Error.shtml`或创建新视图`NotFound.cshtml`，并且您可以为状态描述和其他解释定义视图模型。

# macos - Mac OS 中“tee”的代码在哪里？

> ID：499818
> 
> 赞同：2
> 
> 时间：2009-01-31T23:48:43.833
> 
> 标签：macos, tee

Mac OS 中终端命令“tee”的代码在哪里？

**[已添加]**是否可以读取我的 mac 正在使用的确切代码（不是在线代码）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-31T23:52:47.193

“代码”，我猜你的意思是源代码，对吧？看[那里](http://www.opensource.apple.com/darwinsource/)

编辑：我看到这个问题已经更精确了。

[在此处](http://svn.freebsd.org/viewvc/base/head/usr.bin/tee/tee.c?view=markup)查看“普通”BSD 代码，因为需要 Apple 开发人员登录（免费）才能浏览他们的代码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-31T23:51:34.497

它是 BSD，而不是 Linux，代码。

[http://www.pell.portland.or.us/~orc/Code/bsd/bsd-current/tee/tee.c](http://www.pell.portland.or.us/~orc/Code/bsd/bsd-current/tee/tee.c)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T23:52:09.567

[http://www.ss64.com/osx/](http://www.ss64.com/osx/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T23:52:21.127

这里是苹果的unix源代码：http:
[//developer.apple.com/Darwin/](http://developer.apple.com/Darwin/)

如果它是最新的，这就是您的 mac 使用的确切代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-01T00:08:16.943

你的意思是，可执行文件在哪里？如果这就是你要问的，它在`/usr/bin/tee`. 您可以使用该`which`实用程序在您的路径中找到任何命令。它将打印出命令的完整路径。例如：

```
$ which tee
/usr/bin/tee
$ 
```

如果您询问实际的源代码，这里已经有许多答案为您提供指向 Apple 源代码的链接。实用程序本身分为多个包，并且没有真正的索引，因此您必须浏览名称并检查听起来像是它们可能包含任何给定实用程序的源代码的包。

# html - 如何在右下角的 div 周围环绕文本？

> ID：499829
> 
> 赞同：69
> 
> 时间：2009-01-31T23:56:17.500
> 
> 标签：html, css, css-float

每次我尝试在 CSS 中做一些看似简单的事情时，它都不起作用。

我有一个包含 460x160 图像的内容 div。我想要做的就是将图像放在右下角并将我的文字环绕在它周围。

```
<div id="contents">
    <img src="..." />
    text text text text text text ...
</div> 
```

所以我希望它看起来像：

```
------------------
| text text text |
| text text text |
| text text -----|
| text text |    |
------------------ 
```

用左上角或右上角的图像做这件事很简单：

```
#contents img { float:right; }

------------------
| text text |    |
| text text -----|
| text text text |
| text text text |
------------------ 
```

现在我该如何把它推到底部？到目前为止，我想出的最好的是：

```
#contents img { float:right; margin-top: 90%} // really needs to be 100%-160px

------------------
| text text      |
| text text      |
| text text -----|
| text text |    |
------------------ 
```

在这种情况下，文本不会打印在边距中，因此图像上方有空白。

```
#contents { position:relative; }
#contents img { position:absolute; right:0; bottom:0; }

-or-

// move the img tag under the text in the html and:
#contents img { float:right; margin-top:-160; }

------------------
| text text text |
| text text text |
| text text -----|
| text text | te |
------------------ 
```

在这种情况下，文本打印在图像上方或下方。

那么......我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-01T00:29:28.493

[在 (2003)](http://archivist.incutio.com/viewlist/css-discuss/72206)、[(2002)](http://archivist.incutio.com/viewlist/css-discuss/12645)或[(2005) 之前](http://archivist.incutio.com/viewlist/css-discuss/57221)，似乎确实有人问过它

最后一个链接实际上建议了一个[基于 javascript 的解决方案](http://www.xs4all.nl/%7Ejer03n/sandbox/float-bottom-right.html)，但它是一个固定（即非流体）的解决方案。

但是，它与[发现的其他建议是一致的](http://forums.devshed.com/css-help-116/float-right-issue-496358.html)

> 这样做的唯一方法是将浮动元素放在文本中间的某个位置。不可能一直做到完美。

或者[这个](http://www.webmasterworld.com/css/3528809.htm)：

> 它包括浮动一个垂直的“推杆”元素（例如 img，但只使用空 div 可能更聪明），然后使用 clear 属性在其下浮动所需的对象。这种方法的主要问题是你仍然需要知道有多少行文本。它使事情变得更容易，并且绝对可以用javascript编码，只需将“推动器”的高度更改为容器的高度减去浮动的高度（假设您的容器不是固定/最小高度） .

无论如何，正如[在这个线程中讨论的那样](http://bytes.com/groups/css/99882-floating-image-bottom-right-div)，没有简单的解决方案......

* * *

[Cletus](https://stackoverflow.com/users/18393/cletus)在评论中提到了[2003 年的这个帖子](http://www.ozoneasylum.com/11041)，这再次说明了它不容易实现的事实。
但是，它确实参考了[Eric Meyer 的这篇文章](http://www.complexspiral.com/publications/containing-floats/)，它接近您想要达到的效果。

> 通过了解浮动和正常流程如何相互关联，并了解如何使用清除来操纵浮动周围的正常流程，作者可以将浮动用作非常强大的布局工具。
> 因为浮动最初并非用于布局，所以可能需要一些技巧来使它们按预期运行。这可能涉及包含浮动的浮动元素、“清除”元素或两者的组合。

* * *

然而，[Chadwick Meyer](https://stackoverflow.com/users/3334390/chadwick-meyer)在[他的回答](https://stackoverflow.com/a/54765318/6309)中提出了一个基于 [`:before`CSS 选择器](https://www.w3schools.com/cssref/sel_before.asp)的解决方案（[Leonard](https://stackoverflow.com/users/405975/leonard)的[回答](https://stackoverflow.com/a/12091501/6309)的变体）。
它在[这里工作](https://codepen.io/chadwickmeyer/pen/gqqqNE)。

* * *

2021 年 4 月更新：[Temani Afif](https://stackoverflow.com/users/8620333/)在[他的回答](https://stackoverflow.com/a/67180791/6309)中建议使用 exbox 与外部形状相结合。
但是请务必查看[Flexbox 的向后兼容性](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout/Backwards_Compatibility_of_Flexbox)，尽管所有浏览器[对它的支持](https://caniuse.com/flexbox)都非常好。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-08-23T22:37:27.717

嗯......这是一个很老的帖子，但我很努力并通过一个小解决方法摆脱了这个问题。我需要将图像向右对齐，并且距离顶部正好 170 像素。并且需要文本在图像的顶部、左侧和底部流动。所以我所做的是创建一个宽度为 0 像素、高度为 170 像素并向右浮动的对象。然后 img 会浮动并正确清除，瞧！

```
<!-- I used CSS, but inline will serve well here -->
<div style="float: right; width: 0px; height: 170px"></div>
<div style="float: right; clear: right"><img src="..." /></div>
text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text
text text text text text text
```

工作得很好:)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2021-04-20T14:20:28.760

将 flexbox 与 shape-outside 技巧结合使用，现在只需几行代码即可。

```
.wrapper {
  display: flex; /* this is needed for the height:100% */
}

.box {
  text-align: justify;
  font-size: 20px;
}

.float {
  float: right; /* shape-outside only apply to float elements */
  height: 100%; /* take all the height */
  margin-left: 15px;
  /* push the image to the bottom */
  display: flex;
  align-items: flex-end;
  /**/
  shape-outside: inset(calc(100% - 100px) 0 0); /* make the text flow on the top free space*/
}
```

```
<div class="wrapper">
  <div class="box">
    <div class="float"><img src="https://picsum.photos/id/1069/100/100"></div>
    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam in dui quis orci ultricies aliquet nec sed enim. Mauris id rutrum nulla, et ornare leo. Donec aliquet malesuada tellus, eu laoreet lectus tincidunt ut. Quisque lacus magna, interdum eu urna
    ac, aliquet gravida orci. Pellentesque gravida urna sit amet nulla suscipit, at venenatis lorem dignissim. Morbi quis nunc eu velit condimentum ornare. Curabitur finibus tincidunt ullamcorper. Pellentesque tincidunt et odio vitae tempus. Praesent
    ac erat ut eros venenatis pulvinar. Pellentesque eu dapibus dui. Ut semper sed enim ut vestibulum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce vitae elit eget velit porttitor consequat nec sed turpis. Proin libero nisl, egestas
    hendrerit vulputate et, lobortis non nulla. Aenean dui libero, dictum vel nibh eget, tristique egestas enim.
  </div>
</div>
```

这是我围绕这个主题写的一篇文章，其中包含更多示例：[https ://css-tricks.com/float-an-element-to-the-bottom-corner/](https://css-tricks.com/float-an-element-to-the-bottom-corner/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-01-07T09:59:09.160

我找到的最简单的解决方案是将 img 包装在 div 元素中，然后使用 padding-top 和 margin-bottom 值来对齐它。

这是我的 CSS

```
.contentDiv  .bottomRight img{
  height: 130px;
  float:right;
  padding-top: 60px;
  margin-bottom: -10px;
  } 
```

这是HTML

```
<div class="contentDiv">
 <h1>If you are seeing this and reading it, then all is working well.</h1>
 <div class="bottomRight">
    <img class="bottomRight" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
 </div>
</div> 
```

填充和边距对我有用的原因是因为我在父元素“contentDiv”中使用它来根据内容自动调整 div 的高度。不确定它是否有任何用处。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-10T12:34:07.757

除了发布的解决方案之外，我还使用了一个快速的 JQuery hack 来动态调整推送器的高度，方法是将我想要右下角对齐的区域的高度与内容区域的高度分开，并将其应用于推动器 div，如下所示：

```
$("#pusher").css("height", $("#content").height() - $("#contentToAlign").height() + 'px') 
```

它需要一些细微的调整，但通常效果与您将获得的一样好！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-11T14:19:06.080

对于 jQuery 解决方案，请尝试由 gilly3 创建的 lowFloat 插件：[https ://github.com/gilly3/lowFloat](https://github.com/gilly3/lowFloat)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-01T00:29:00.803

我找到的解决方案涉及您有一个宽度不变的 div，文本量也不变。然后您可以将图像放置在文本内并使其对齐=正确。因此，如果您周围有正确数量的文本，那么您将在 div 的右侧和底部获得图像。

```
 <style >
#contents{
    border: 2px solid red;
    background: #ddd;
    position: absolute;
    width:600px;
}

</style>
<div id="contents">
    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...    
    text text text text text text ...    text text text text text text ...   
    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...
    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...    
    text text text text text text ...    text text text text text text ...   
    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...
    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...    
    text text text text text text ...    text text text text text text ...   
    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...    text text text text text text ...
    text text text text text text ...    text text text text text text ...  <img src="http://daiphyer.com/images/daiphyerv6-sliced_02.png" ALIGN="RIGHT"/>
    text text text text text text ...    text text text text text text ...    text text text text text text ...    
    text text text text text text ...    text text text text text text ...   
    text text text text text text ...    text text text text text text ...   
    text text text text text text ...    text text text text text text ...    text text text text text text ...
     hey hey text text text text text text ...    text text text text text text ...    text text text text text text ...    
    text text text text text text ...    text text text text text text ...
</div> 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2010-07-10T23:04:15.293

行。所以我实际上遇到了同样的问题，在某些时候，答案就像周六晚上的芝士蛋糕一样打击了我。当您尝试在 Word 中设置文本换行时，这几乎是相同的命中和未命中效果。

```
img.right {
     float: right;
} 
```

现在您所要做的就是将它设置在您想要换行的文本内。文本将浮动到文本的末尾，因此它将始终将文本推向左侧，但是如果您将图像放在文本的中间，例如...

```
<p>This is some text <img src="example.jpg" class="right" /> and then add
some more text.</p> 
```

顶部保持在原位，文本可以自由浮动在图像上方，其余部分被推到图像的左侧。这是一种解决方法，但不像使用 JS 那样乏味，如果您使用 WYSIWYG 编辑器，它会更容易。想一想，如果您使用所见即所得的编辑器，它会自动具有该功能。:P 问题解决了。

干杯。

# javascript - JavaScript 最佳实践

> ID：499834
> 
> 赞同：6
> 
> 时间：2009-02-01T00:00:43.230
> 
> 标签：javascript

[这与这个问题](https://stackoverflow.com/questions/39691/javascript-best-practices)有些相关，但我不是在询问有关 JavaScript 最佳实践的资源，而是您的实际建议。

我将从我自己的清单开始。如果您确定建议没有争议，您可以发布答案或直接编辑问题。

开始了：

*   总是使用`var`
*   大写构造函数的名称 - 仅此而已
*   用于`===`比较
*   对原语使用显式强制转换，例如`Number()`, `String()`,`Boolean()`
*   检查原始类型`typeof`
*   检查对象类型`instanceof`
*   检查内置对象类型`Object.prototype.toString()`以避免跨框架问题，例如

    ```
    Object.prototype.toString.call(obj) === '[object Array]' 
    ```

*   检查`this`构造函数，例如

    ```
    function MyObject() {
        if(!(this instanceof arguments.callee))
            throw new Error('constructor called with invalid `this`');
        // [...]
    } 
    ```

*   使用匿名函数进行命名空间以不污染全局范围，例如

    ```
    (function() {
        var noGlobalVar = 'foo';
        // [...]
    })(); 
    ```

*   签`hasOwnProperty()`入`for..in`循环 - 不要假设没有人弄乱原型

*   不要使用`for..in`循环来遍历数组元素或类似数组的对象

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T01:40:51.187

不要干涉核心类型。永远不要在 Array.prototype 上粘贴一些东西——你不知道还有谁在做那件事，以及这些东西如何相互作用。

仅在重要时检查显式类型。鸭子打字是一个很好的概念。

我想第二次使用匿名函数来避免对全局范围的污染。尤其是当你像我一样经常使用 jQuery 时，使用这样的模板真的很有帮助：

```
(function($) {
    /* Lots of code */
})(jQuery); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-01T17:55:10.693

这通常适用于所有语言：

避免深度嵌套，这是不可接受的并且非常难以阅读。有一些技术，例如在循环中，您可以进行早期`break`或`continue`下一次迭代，而不是将所有内容包装在`if`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T00:06:42.283

> > 对原语使用显式强制转换，例如 Number()、String()、Boolean()

真的吗？我避开那些像瘟疫一样的人。你对此有何看法？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-28T01:13:40.497

**始终使用[jslint](http://www.jslint.com/)**。

一开始有点沮丧，但它是有益的。

如果您违反了一项或多项“最佳实践”，Jslint 会告诉您。

还可以考虑使用支持 jslint 的 IDE。我可以推荐 WebStorm 或 Sublime Text 2（这两个我自己测试过，它们非常支持 jslint）。

# javascript - 如何在页面加载后暂时禁用 javascript？

> ID：499836
> 
> 赞同：7
> 
> 时间：2009-02-01T00:01:30.530
> 
> 标签：javascript, ajax

一旦页面已经加载，我想禁用 Javascript。

为什么？

因为我想测试当 javascript 不可用时类似以下“降级”的行为如何，但我不想急于使用浏览器的顶级 Javascript 启用/禁用功能。此外，我特别想**在页面加载后**禁用它，因为我想将我的测试与该表单的执行方式隔离开来（我让 jQuery 为页面的其余部分运行，我不想丢失它）。

允许我为此代码禁用 JS 允许我测试表单回发以及 AJAX 回发。

> `<form action="/pseudovirtualdirectoryfortesting/company/Contact" id="fooForm" method="post" onsubmit="Sys.Mvc.AsyncForm.handleSubmit(this, new Sys.UI.DomEvent(event), { insertionMode: Sys.Mvc.InsertionMode.replace, loadingElementId: 'submitting', onBegin: Function.createDelegate(this, submitComments_begin), onComplete: Function.createDelegate(this, submitComments_complete), onFailure: Function.createDelegate(this, submitComments_failure), onSuccess: Function.createDelegate(this, submitComments_success) });">`

我可以使用什么插件或策略。我希望能够在不同的浏览器中进行测试，而我从事的一些项目仅针对一种浏览器设计（不是我的错），因此我需要尽可能多的解决方案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T00:24:36.803

获取 Firefox 的[Web 开发人员工具栏](https://addons.mozilla.org/en-US/firefox/addon/60)。有了它，您可以随时禁用 Javascript，禁用 cookie、css，无论您想要什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T00:05:01.723

使用 NoScript 插件在 FireFox 中进行测试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-02-20T12:17:32.013

我决定就这个问题写一个单独的答案，因为我发现这个话题实际上非常重要。显然我上面的评论没有被注意到。

过去，功能描述为：“在浏览器呈现内容后禁用 javascript”，在 Opera 中很容易访问。

但是独立的 Opera 现在已经死了（现在是 Chrome）。显然几乎没有独立的浏览器（谷歌是默认的搜索引擎，通常你不能用你自己的搜索引擎替换它——duckduckgo 可能是更好的选择）。

好吧，人们可以认为这只是一种意见。但是，很明显，dynamic-JS-toggle 已从所有主要浏览器中删除是有原因的。

我试过很多流行的浏览器，没有一个能提供这样的功能。

目前唯一最新的解决方案是使用冲浪浏览器并对其进行一些修补。也就是将 1 改成 0 行：

```
setparameter(c, 1, (ParamName)a->i, &curconfig[a->i].val); 
```

冲浪（关于、来源、补丁）： [https ://surf.suckless.org/](https://surf.suckless.org/)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-03-11T22:48:47.457

这不是一般问题“如何禁用 javascript”的答案，但对我来说是一个很好的解决方案。

我已经停止使用微软的 AJAX 代替 jQuery。

因此，我使用了不显眼的 javascript，因此只为我的表单禁用 AJAX 处理程序比使用 Microsoft Ajax 更容易。

我所做的只是注释掉将 AJAX 调用连接到我的提交按钮的行。

# javascript - Javascript 日期：下个月

> ID：499838
> 
> 赞同：55
> 
> 时间：2009-02-01T00:03:25.223
> 
> 标签：javascript, date

我一直在为一个项目使用 Javascript 的日期，但今天注意到我以前工作的代码不再正常工作。下面的代码没有按预期生成二月，而是生成三月。

我的代码看起来像这样：

```
current = new Date();
current.setMonth(current.getMonth()+1); //If today is Jan, expect it to be Feb now 
```

直到今天，这段代码每天都在工作。这是一个 Javascript 错误还是我以错误的方式解决这个问题？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-02-01T00:07:48.177

您可能会发现您将日期设置为 2009 年 2 月 31 日（如果今天是 1 月 31 日），而 Javascript 会自动将其滚动到 3 月初。

检查一个月中的哪一天，我希望它是 1、2 或 3。如果它与添加一个月之前不一样，请回滚一天，直到月份再次更改。

这样，“一月的最后一天”就变成了“二月的最后一天”。

编辑：

罗纳德，根据您对其他答案的评论，您可能希望避免极端情况的行为，例如“当我尝试制作 2 月 30 日时会发生什么”或“当我尝试制作 2009/13/07 时会发生什么（yyyy /mm/dd)"（即使对于我的解决方案，最后一个可能仍然是一个问题，因此您应该对其进行测试）。

相反，我会明确编码可能性。由于您不关心月份中的哪一天（您只希望下个月的年份和月份正确），因此这样的事情就足够了：

```
var now = new Date();
if (now.getMonth() == 11) {
    var current = new Date(now.getFullYear() + 1, 0, 1);
} else {
    var current = new Date(now.getFullYear(), now.getMonth() + 1, 1);
} 
```

这为您在 12 月的任何一天提供下一年的 1 月 1 日，为任何其他日期提供下个月的第一天。更多的代码，我知道，但我早就厌倦了提高效率的编码技巧，除非有明确的要求，否则我更喜欢可读性。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-02-01T00:10:09.123

相反，请尝试：

```
var now = new Date();
current = new Date(now.getFullYear(), now.getMonth()+1, 1); 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2014-11-19T18:34:33.740

我正在寻找一种简单的单行解决方案来通过数学获得下个月，这样我就不必查找 javascript 日期函数（我的精神懒惰）。很奇怪，我在这里没有找到。

我克服了我短暂的懒惰，写了一篇，并决定分享！

**解决方案：**

```
(new Date().getMonth()+1)%12 + 1 
```

* * *

**为了弄清楚为什么会这样，让我分解一下魔法！**

它获取当前月份（格式为 0..11），下个月递增 1，并通过模数将其包装到 12 的边界（11%12==11；12%12==0）。这将以相同的 0..11 格式返回下个月，因此转换为 Date() 将识别的格式 (1..12) 很容易：只需再次添加 1。

**概念证明：**

```
> for(var m=0;m<=11;m++) { console.info( "next month for %i: %i", m+1, (m+1)%12 + 1 ) }
next month for 1: 2
next month for 2: 3
next month for 3: 4
next month for 4: 5
next month for 5: 6
next month for 6: 7
next month for 7: 8
next month for 8: 9
next month for 9: 10
next month for 10: 11
next month for 11: 12
next month for 12: 1 
```

所以你有它。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-09-05T11:12:55.007

您可以使用 date.js 库：

[http://code.google.com/p/datejs/](http://code.google.com/p/datejs/)

就这样做

```
Date.today().next().month(); 
```

您将获得今天 + 1 个月（包括天数）的确切值

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-07-14T21:15:10.660

如果你使用 moment.js，它们有一个 add 函数。这是链接 - [https://momentjs.com/docs/#/manipulating/add/](https://momentjs.com/docs/#/manipulating/add/)

```
moment().add(7, 'months'); 
```

我还根据 paxdiablo 的回答编写了一个递归函数来添加可变的月数。默认情况下，此函数会在当前日期上添加一个月。

```
function addMonths(after = 1, now = new Date()) {
        var current;
        if (now.getMonth() == 11) {
            current = new Date(now.getFullYear() + 1, 0, 1);
        } else {
            current = new Date(now.getFullYear(), now.getMonth() + 1, 1);            
        }
        return (after == 1) ? current : addMonths(after - 1, new Date(now.getFullYear(), now.getMonth() + 1, 1))
    } 
```

例子

```
console.log('Add 3 months to November', addMonths(3, new Date(2017, 10, 27))) 
```

输出 -

```
Add 3 months to November Thu Feb 01 2018 00:00:00 GMT-0800 (Pacific Standard Time) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2021-01-03T07:12:55.773

如果您能够使用[`date-fns`](https://github.com/date-fns/date-fns)库 v2+，您可以导入该函数`addMonths`，并使用它来获取下个月

```
<script type="module">
  import { addMonths } from 'https://cdn.jsdelivr.net/npm/date-fns/+esm'; 

  const nextMonth = addMonths(new Date(), 1);
  console.log(`Next month is ${nextMonth}`);
</script>
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-05-12T22:06:24.350

试试这个：

```
var a = screen.Data.getFullYear();
var m = screen.Data.getMonth();
var d = screen.Data.getDate();

m = m + 1;
screen.Data = new Date(a, m, d);

if (screen.Data.getDate() != d)
screen.Data = new Date(a, m + 1, 0); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-03-25T18:21:15.470

啊，三元之美：

```
const now = new Date();
const expiry = now.getMonth() == 11 ? new Date(now.getFullYear()+1, 0 , 1) : new Date(now.getFullYear(), now.getMonth() + 1, 1); 
```

只是@paxdiablo 和@Tom 提供的解决方案的更简单版本

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-03-09T05:30:03.400

你可能会这样做

```
var currentMonth = new Date().getMonth();

var monthNames = ["January", "February", "March", "April", "May", "June",
  "July", "August", "September", "October", "November", "December"
];

for(var i = currentMonth-1 ; i<= 4; i++){
console.log(monthNames[i])// make it as an array of objects here 

} 
```

# gcc - 为什么我的 gcc 输出中有额外的指令？

> ID：499842
> 
> 赞同：4
> 
> 时间：2009-02-01T00:05:31.537
> 
> 标签：gcc, assembly, x86

GCC 编译（使用`gcc --omit-frame-pointer -s`）：

```
 int the_answer() { return 42; } 
```

进入

```
 .Text
    .globl _the_answer
    _the_answer:
        subl    $12, %esp
        movl    $42, %eax
        addl    $12, %esp
        ret
       .subsections_via_symbols 
```

'$1​​2' 常量在这里做什么，'%esp' 寄存器是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-01T00:12:21.197

简短的回答：堆栈帧。

长答案：当您调用函数时，编译器将操纵堆栈指针以允许诸如函数变量之类的本地数据。由于您的代码正在更改`esp`，堆栈指针，这就是我假设这里发生的事情。我会认为 GCC 足够聪明，可以在实际上不需要的地方优化它，但你可能没有使用优化。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-01T00:18:45.910

```
_the_answer:
    subl    $12, %esp
    movl    $42, %eax
    addl    $12, %esp
    ret 
```

第一个 subl 递减堆栈指针，为函数中可能使用的变量腾出空间。例如，一个槽可用于帧指针，另一个用于保存返回地址。你说它应该省略帧指针。这通常意味着它省略了加载/存储来保存/恢复帧指针。但通常代码仍会为其保留内存。原因是它使分析堆栈的代码更加容易。很容易给堆栈的偏移量一个最小宽度，所以你知道你总是可以访问 FP+0x12 来获得第一个局部变量槽，即使你省略了保存帧指针。

好吧，`eax`据我所知，x86 用于处理调用者的返回值。最后一个 addl 只是破坏了之前为您的函数创建的框架。

在函数的开头和结尾生成指令的代码称为函数的“尾声”和“序言”。这是我的端口在必须在 GCC 中创建函数序言时所做的事情（对于打算尽可能快速和多功能的实际端口来说，这要复杂得多）：

```
void eco32_prologue(void) {
    int i, j;
    /* reserve space for all callee saved registers, and 2 additional ones:
     * for the frame pointer and return address */
    int regs_saved = registers_to_be_saved() + 2;
    int stackptr_off = (regs_saved * 4 + get_frame_size());

    /* decrement the stack pointer */
    emit_move_insn(stack_pointer_rtx, 
                   gen_rtx_MINUS(SImode, stack_pointer_rtx, 
                                 GEN_INT(stackptr_off)));

    /* save return adress, if we need to */
    if(eco32_ra_ever_killed()) {
        /* note: reg 31 is return address register */
        emit_move_insn(gen_rtx_MEM(SImode, 
                           plus_constant(stack_pointer_rtx, 
                                         -4 + stackptr_off)),  
                       gen_rtx_REG(SImode, 31));
    }

    /* save the frame pointer, if it is needed */
    if(frame_pointer_needed) {
        emit_move_insn(gen_rtx_MEM(SImode, 
                           plus_constant(stack_pointer_rtx, 
                                         -8 + stackptr_off)), 
                       hard_frame_pointer_rtx);
    }

    /* save callee save registers */
    for(i=0, j=3; i<FIRST_PSEUDO_REGISTER; i++) {
        /* if we ever use the register, and if it's not used in calls
         * (would be saved already) and it's not a special register */
        if(df_regs_ever_live_p(i) && 
           !call_used_regs[i] && !fixed_regs[i]) {
            emit_move_insn(gen_rtx_MEM(SImode, 
                               plus_constant(stack_pointer_rtx, 
                                             -4 * j + stackptr_off)), 
                           gen_rtx_REG(SImode, i));
            j++;
        }
    }

    /* set the new frame pointer, if it is needed now */
    if(frame_pointer_needed) {
        emit_move_insn(hard_frame_pointer_rtx, 
                       plus_constant(stack_pointer_rtx, stackptr_off));
    }
} 
```

我省略了一些处理其他问题的代码，主要是告诉 GCC 哪些指令对异常处理很重要（即帧指针的存储位置等等）。好吧，被调用者保存的寄存器是调用者在调用之前不需要保存的寄存器。被调用的函数关心根据需要保存/恢复它们。正如您在第一行中看到的，我们总是为返回地址和帧指针分配空间。该空间只是几个字节，无关紧要。但是我们只在必要时生成存储/加载。最后注意“硬”帧指针是“真实”帧指针寄存器。由于某些 gcc 内部原因，这是必要的。“frame_pointer_needed”标志由 GCC 设置，只要我*不能*省略存储帧指针。在某些情况下，它必须被存储，例如当`alloca`（它动态地改变堆栈指针）被使用时。GCC 关心这一切。请注意，自从我编写该代码以来已经有一段时间了，所以我希望我在上面添加的其他注释不是全错的 :)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-03-30T14:20:22.877

堆栈对齐。在函数入口处，`esp`是 -4 mod 16，因为返回地址已被`call`. 减去 12 重新对齐它。除了在使用 mmx/sse/等的多媒体代码中，没有充分的理由在 x86 上将堆栈对齐到 16 字节，但是在 3.x 时代的某个地方，gcc 开发人员决定无论如何都应该保持堆栈对齐，强加序言/尾声开销，增加的堆栈大小，以及为了一些特殊目的利益而导致所有程序上的缓存抖动增加（这恰好是我感兴趣的一些领域，但我仍然认为这是不公平和不好的决定）。

通常，如果您启用任何优化级别，gcc 将删除用于叶函数（不进行函数调用的函数）的堆栈对齐的无用序言/结尾，但一旦您开始调用，它就会返回。

您也可以使用`-mpreferred-stack-boundary=2`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-01T00:15:47.757

使用 GCC 4.3.2 我得到这个函数：

```
the_answer:
movl    $42, %eax
ret 
```

...加上周围的垃圾，使用以下命令行：`echo 'int the_answer() { return 42; }' | gcc --omit-frame-pointer -S -x c -o - -`

您使用的是哪个版本？

# c# - 如何以编程方式向 TabControl 添加一个 Tab 并在其中停靠一个 ListView 控件？

> ID：499848
> 
> 赞同：1
> 
> 时间：2009-02-01T00:08:41.077
> 
> 标签：c#, vb.net, listview, tabs, tabcontrol

我正在使用 Visual Basic 9 (VS2008)

我想在用户单击“添加选项卡”按钮时创建新选项卡。

Tab 必须有一个停靠在其中的 ListView 控件。

如何以编程方式向 TabControl 添加一个 Tab 并在其中停靠一个 ListView 控件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T00:18:35.410

它会像这样......

```
Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click

    // Create the listView
    Dim lstView As New ListView()
    lstView.Dock = DockStyle.Fill
    lstView.Items.Add("item 1") //item added for test
    lstView.Items.Add("item 2") //item added for test

    // Create the new tab page
    Dim tab As New TabPage("next tab")
    tab.Controls.Add(lstView) // Add the listview to the tab page

    // Add the tabpage to the existing TabCrontrol
    Me.TabControl1.TabPages.Add(tab)

End Sub 
```

# objective-c - 是否存在与贝宝集成的任何 Obj-c 库？

> ID：499850
> 
> 赞同：1
> 
> 时间：2009-02-01T00:09:02.810
> 
> 标签：objective-c, payment-gateway

我想知道是否存在一个预制的objective-c 库来使用paypal，包括信用卡。

我的谷歌搜索没有得到回报（我寻找objective-c paypal）

此外，如果存在其他通用网关库......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T01:49:34.057

但是，如果您希望它通过您的应用程序，您可以使用 WebKit 来集成连接到 PayPal 的 Web 视图。这样，所有内容都可以包含在应用程序中，但您仍然可以按照他们希望您使用的方式使用 PayPal。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-04T15:29:34.390

iOS 的 PayPal 代码，从[x.com获取](https://www.x.com/community/ppx/xspaces/mobile)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T00:28:02.957

我不这么认为，因为他们希望您访问他们的网站。如果您可以通过框架提供数据，用户就无法信任 Paypal。

# operating-system - 选择 Windows 而不是 Unix 作为开发平台的好处

> ID：499858
> 
> 赞同：4
> 
> 时间：2009-02-01T00:15:42.437
> 
> 标签：operating-system, platform

Windows/Microsoft 作为开发时使用的平台，在 Linux 或 Solaris 等 Unix 方言上是否有任何技术优势？

我知道公司有时会选择微软，因为没有足够的程序员了解 Unix，或者这些程序员的雇佣成本要高得多。

因此，假设所有开发人员都同样了解 Unix 和 Microsoft，是否还有一些情况下您最好在 Windows 中进行开发？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-01T00:34:42.883

对我来说，使用 Windows 作为开发平台只有两个论点：

1.  你必须这样做，因为你正在做 .Net/Windows 开发（或者因为公司根本没有给你选择）；或者
2.  应用程序，特别是 Microsoft Office/Exchange。很抱歉，与 Word/Excel 相比，OpenOffice 很糟糕。

除此之外，恕我直言，Linux 还有其他所有优势，包括：

*   更快的文件系统（在处理大量小文件时尤其重要）。去年我通过这个开关从 8-10 分钟的构建时间变成了 2-3 分钟（相同代码库的蚂蚁构建）；
*   通常，您的开发环境与您的生产环境相匹配（如果您的生产环境是 Windows，那么您的开发环境几乎可以保证是 Windows），这可能很有用。由于 Windows 和 Linux 上的 JBoss 之间存在差异，我们遇到了 Java 类路径可见性的问题；和
*   一套更好的命令行工具（是的，我知道你可以使用 Cygwin 等，但它不是那么好）。

这就是为什么我发现将 Mac 作为我的下一个开发工作站的想法如此吸引人的原因之一：您可以将其视为带有应用程序（即 Office）的 Unix 或带有不错文件系统的 Windows（如果/当 OSX 采用 ZFS 时会更好） ，无论哪种方式都是胜利。唯一真正让我反感的是，Apple 做了一些愚蠢的事情，比如将 Java 6 的发布推迟了一年，只是为了让 Leopard Look and Feel 融入其中。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-01T00:20:39.587

就在我的脑海中：

*   .NET（尽管单声道真的很棒）
*   Visual Studio - 可能是最好的 IDE
*   优秀的文档（在我看来，MSDN 库比手册页对开发人员更友好）
*   庞大的用户群（这更像是一项业务，但仍然是一个非常重要的因素）
*   **二进制兼容性**（支持 4-5 个内核和标准 C 库版本比在 Linux 发行版中可以找到的无限组合要容易得多）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-01T00:25:09.343

你能做的最好的事情之一就是保持你的选择开放。选择独立于平台的技术，您将能够拥有适用于任何 O/S 或实施的软件。从技术角度来看，这很有意义，从商业角度来看也是如此。

至于 Windows 平台的特定技术优势，除了大型开发人员社区和开发信息存储以及广泛支持的 IDE （如 Visual Studio）之外，我想说你会很难找到一个。即使在那里，[Eclipse](http://www.eclipse.org/)也可以使用独立于平台的技术来完成同样出色的工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-01T00:36:38.447

Microsoft 系统倾向于在不同部分之间进行更好的集成——如果您使用纯二进制软件（x86 和 comctl3d 比运行 *nix 的所有软件更容易支持），则需要担心的异构性要少得多。

Windows 上的学习曲线一开始很浅，但总体距离较长。在 Unix/Linux 上，一开始是一场斗争，但后来当操作系统的内部工作开始变得有意义时，完成工作变得更加容易。

至少这是我对他们的经验。Windows 用于快速回报，Linux 如果您打算做一些更长期的事情。和虚拟机，如果你不能决定:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-01T00:38:18.227

我们拥有 Windows 开发平台（即使我们的产品是在 Linux 或 Solaris 上）的原因之一是**所有**.

这意味着参与实现软件的所有不同人群：

*   不是**所有的开发人员**（业务、职能人员也关心工作环境）
*   都在同一个平台上（Windows）
*   使用所有相同的工具进行写作/交流（如 Word、PowerPoint）
*   可以在笔记本电脑上拥有相同的环境

简而言之：所有人（开发人员和非开发人员都一样）的环境一致性。

* * *

另一个原因是**折旧**：很容易管理 PC 的折旧，因为这些服务比完整的 Unix 服务器（如 Sun Fire、F15K 或 F50K，...）更轻：后者需要一些昂贵的协助服务合约（如“青铜”、“白银”或“黄金”，取决于所需的级别）。一台 PC 更容易修复/更换，开发人员“搞砸”它并彻底崩溃并不重要；）

话虽如此，这样做的缺点是您不必每天都更换 PC：这意味着要管理大量台式机，您不能就这样决定升级（Os 也是如此）。

因此，其他答案都是关于“虚拟机”的，而您的 PC 组是 2003 年的，只有 40Go 的硬盘驱动器和 1 个可能是 2Go 的内存......，您意识到“虚拟化”并不总是显而易见的解决方案。
因此，开发人员需要一些 Unix“集成”服务器来在更接近目标的环境中测试他们的产品。在某种程度上，这更好，因为这些集成服务器以统一的方式管理，避免了“它适用于我^(TM) ”的综合症，而不是虚拟机，每个开发人员都是自己的根/管理员世界/服务器；）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-01T03:23:01.153

我认为这个问题提出了一种错误的二分法。没有理由你必须选择 windows 而不是 unix，反之亦然。虚拟化是免费且简单的。这是两全其美！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-01T00:22:32.907

我可以给你一个 Windows 人员可能会提出的常见论点，尽管我不一定同意。

*   人们有时认为生产时的 Windows 盒子更易于维护和部署。那是因为管理员可以使用很多可视化工具。因此，他们更喜欢 .Net 或特定于 Windows 的开发语言，以便于集成。

*   如果您的客户或内部客户使用所有 Windows 台式计算机，有些人会争辩说，使用 Windows 服务器做事的工作量更少。这包括 Microsoft Office 文档共享（即 sharepoint）或 Windows 文件共享的内容。显然，编写一个 .Net 应用程序来处理这种特定于 Microsoft 的约束更容易。

我实在想不出还有什么其他原因。后一种可能是最有效的——除非您使用 MSFT 开发工具，否则可能存在一些难以集成的特定于 Microsoft 的技术。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-01T02:58:12.687

某些特定类型发展的外围原因：

*   您需要查看 Firefox 和资源管理器中的内容
*   您正在使用闪存（无法在 linux 上开发的 AFAIK，而且播放器很糟糕）。
*   您正在从事一个涉及 MS Office 集成的项目
*   你的办公室有一些糟糕的邮件或笔记系统，你无法以任何其他方式登录。同上一些 vpn 设置。

我认为所有这些事情都是令人遗憾的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-13T23:52:08.570

为什么不两者都用？

在任何一种情况下，您都可以在 Windows 或 Linux/Unix 中使用虚拟机，而无需使用 Virtual Box 或 Vmware 播放器。或者您可以从您的开发箱远程桌面/vnc 到其他平台。如果您在 .net 中开发，您可能会在 Windows for dev 上做得更好。如果您为 LAMP 开发，Windows/*nix 都可以。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-03-14T00:07:10.577

给我 apache mysql (ok postgres in a pinch) php 和 eclipse .. 谁在乎操作系统 ..

# css - IE6 错误。触发 a:hover 时，Div 的高度会增加

> ID：499872
> 
> 赞同：5
> 
> 时间：2009-02-01T00:23:58.880
> 
> 标签：css, internet-explorer-6

我有一个页面，其中有一个“标签”列表，就像在 SO 中一样，当鼠标悬停在它上面时，它会变暗。

它适用于 Ie7、8、FF、Chrome、Safari 等...但 IE6 有一个错误，即触发 a:hover 时。

错误是包含那些 (ul li a) 的 div 会增加高度。

我拥有的CSS是：

```
div.options ul.tags li a:hover
{
    background-color: #D5E4A5;
} 
```

如果我删除此样式或仅评论“背景颜色：#D5E4A5;” 它不会发生...

任何想法如何解决它？

谢谢！

编辑：这是错误的屏幕截图：

[![替代文字](https://i.stack.imgur.com/kG7GL.jpg)](https://i.stack.imgur.com/kG7GL.jpg)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T02:38:08.140

刚刚修好了！:D

我以前有的是：

```
<div class="options clearfix">
    <!--content here-->
</div> 
```

我替换为：

```
<div class="options">
    <div class="clearfix">
        <!--content here-->
    </div>
</div> 
```

现在IE6很开心，我也很开心……

谢谢大家的帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T01:20:33.460

这通常是最初未定义的边界设置。尝试将不断增长的 DIV 上的边框设置为默认背景颜色。我的猜测是你不会再看到任何增长了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T00:49:38.763

我想我曾经遇到过这种情况，发生的事情是边框正在被修改（或者是边距？）我最终退出了，只是给有问题的元素一个 1px 的透明边框，并称之为一天.

我真的怀疑这是否会成为您的解决方案，但我希望它能给您一些想法，看看哪个方向！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T00:52:55.137

我也遇到过这种情况，但我不记得具体在哪里。我想我确实解决了它，但我不完全确定如何解决。我能想到两件事：

1.  给元素[“布局”](http://www.satzansatz.de/cssd/onhavinglayout.html)。我倾向于用`zoom: 1`.

2.  添加`vertical-align: top`到`a`or`li`元素。

你能给出一个更完整的代码示例吗？我不能只用那个 CSS 来重现它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-01T01:04:15.117

您是否明确指定了该 div 的高度？如果没有，设置高度可能会使这种情况消失。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-01T01:06:30.447

标签是否位于您可以一直为它们提供背景颜色的地方？如果是这样，在 :hover 未激活时设置它们的背景颜色是否仍会导致它们的高度发生变化？

请注意，我无法重现与您描述的规则匹配的给定 HTML，因此问题可能来自页面上其他更高的位置。

```
<!-- This does not display the described behavior -->
<div class="options">
  <ul class="tags">
    <li><a href="#">c++</a></li>
    <li><a href="#">not-programming-related</a></li>
    <li><a href="#">cheese</a></li>
    <li><a href="#">barnacle</a></li>
  </ul>
</div> 
```

我能建议的最好的事情就是按照墨卡托所说的去做并给出元素布局。

编辑：只是在黑暗中拍摄，但您可能想尝试在**div.options上设置****line-height**的值。

 **编辑2：看到你的截图后，我记得我以前在工作中遇到过这个问题，我的解决方法是添加到容器中~~（或者可能是链接，我忘记了！）~~。试试看？~~`position:relative;`~~ `zoom:1;`

 ~~编辑 3：在[谷歌搜索](http://www.google.com/search?hl=en&q=ie6+jumping+content&btnG=Google+Search&aq=f&oq=)某些解决方案后，如果您的容器显式设置，您可能想尝试设置高度。如果[这](http://archivist.incutio.com/viewlist/css-discuss/67141)不起作用，我不知道该怎么办！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-01T12:31:14.807

我也有这个确切的问题。触发器绝对是悬停时的背景颜色，但是给父级 hasLayout 的通常解决方案不起作用，我认为是因为将 A 标签嵌套在其他标签内。从我最终做的事情来看，您嵌套清除修复的解决方案是正确的逻辑：分离有问题的元素、父对象和清除对象。

我所做的解决方案如下：

```
<div class="options">
<!--content here-->
<!--[if lte IE 6]><div class="ie6clear"></div><![endif]-->
</div> 
```

使用以下 CSS：

```
.ie6clear{ clear:both; height:0; overflow:hidden; } 
```

这样，clearfix CSS 仅适用于 IE6，突出显示无关标记，并在不再支持 IE6 时轻松删除。

# unit-testing - 你认为单元测试是向你的程序员同伴展示如何使用 API 的好方法吗？

> ID：499873
> 
> 赞同：4
> 
> 时间：2009-02-01T00:24:18.923
> 
> 标签：unit-testing

你认为单元测试是向你的程序员同伴展示如何使用 API 的好方法吗？

[本周](https://blog.stackoverflow.com/2009/01/podcast-39/)我正在收听Stackoverflow 播客，现在我意识到单元测试并不适用于所有情况（即，如果你追求 100% 的代码覆盖率，它可能会花费你的时间）。我同意这一点，因为我过去曾遭受过“强迫症代码覆盖障碍”，现在已经改过自新。

然而，为了进一步了解我对该主题的了解，我想知道单元测试是否是引入不熟悉项目 API 的新程序员的好方法。（这确实看起来比仅仅编写文档更容易......虽然我喜欢以后有文档的时候......）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-01T00:29:22.410

我认为单元测试是记录 API 的绝佳方式。它不一定会取代好的注释或 API 文档，但它是一种非常实用的方法，可以帮助人们深入了解代码的本质。此外，良好的单元测试促进了良好的设计，因此您的代码很可能因此更容易理解。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T00:31:14.603

单元测试，IMO，无论如何都不能替代文档。您编写测试来查找和练习代码的极端情况，以确保满足所有边界条件。对于试图了解该方法如何工作的人来说，这些通常*不是最合适的例子。*

对于单元测试中发生的事情，您通常也不会给出太多解释。

最后，单元测试的内容通常不能被文档生成工具访问，并且通常与它们正在测试的代码分开（尽管有一些奇怪的东西，比如 Python 的 doctests）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-01T00:39:59.767

好的文档通常包含好的示例。对我来说，很难想象有一组比那些展示正确实现的期望更好的例子！

此外，维护也是一个关键问题。通过添加一个暴露缺陷的测试，然后通过使该测试成功而不使先前的测试失败来处理缺陷是一种很好的做法。如果将单元测试视为文档的一部分，那么这个新的测试将成为文档变更日志的一部分，从而帮助后续开发者从经验中学习。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-01T23:35:53.950

不可以。测试可以用作辅助参考，它们至少具有作为实际编译示例的好处，但它们不能替代良好的 API 文档。

Beware of zealots claiming almost mystical powers for unit tests saying things like "the tests are the design", "the tests are the specification", "the tests are the documentation". No. The tests are the tests and they don't give you an excuse to cut corners elsewhere.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-01T01:08:55.310

文档不应被单元测试代码、句号代替。

文档面向尝试使用和理解您的 API 的程序员。

单元测试旨在涵盖极端情况，尽管它们应该记录在案，但不应成为 API 新用户的重点。

文档应该逐渐增加复杂性，单元测试应该尽可能简单，但要尽可能复杂，以便测试功能。

例如，您可能有许多看起来非常相似但有细微差别的单元测试，只是为了涵盖各种奇怪的极端情况并断言正确的行为。

与其让 API 的用户解读这些单元测试，不如找出差异，并弄清楚为什么这会产生不同（或可能相同）的行为，这并不是一个好的教学辅助工具。

单元测试适用于您的 api 的维护者，程序员将修复其中的错误，或向其添加新功能，或重构它，或者......

文档适用于将使用您的 api 的程序员。

这些不是相同的目标受众。

一个这样的细微差别可能是，虽然单元测试断言当一个函数被传递一个负值时，它会做一些特定的事情，但文档将改为详细说明*为什么*选择该特定解决方案。如果所有的文档只是将代码重写为英文，那么它没有多大意义，因此文档通常比代码更冗长和解释性强。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-01T00:44:59.850

尽管不是替代品，但单元测试可以成为演示类或 API 使用的绝佳方式，特别是对于执行测试的代码量最少的库函数。

例如，Math 库经过了很好的单元测试。如果有人有问题（例如，如何找到有关光线/体积交叉点的信息），那么我首先发送给他们的是单元测试。

（为什么我们要测试可以被认为如此稳定的东西？一方面我们支持五个平台并基于基准测试逐步添加特定于平台的 SIMD 实现，另一方面单元测试为添加新平台或功能提供了一个极好的框架）。

FWIW 我认为这周播客对单元测试的讨论非常成功。单元测试（和测试驱动开发）是开发应用程序组件的好方法，但是为了测试应用程序本身，您很快就会达到测试所需的代码变得不成比例和脆弱的地步。

# c - 在 bash 中重定向 C 程序输出的问题

> ID：499879
> 
> 赞同：9
> 
> 时间：2009-02-01T00:27:55.437
> 
> 标签：c, linux, bash, redirect, printf

我用 C 编写了一个程序，该程序使用 printf 将消息发送到标准输出，但我无法将输出重定向到文件（从 bash 运行）。

我试过了：

```
./program argument >> program.out
./program argument > program.out
./program >> program.out argument
./program > program.out argument 
```

在每种情况下，都会创建文件 program.out，但它仍然为空。执行结束后文件大小为0。

如果我在执行程序时省略了重定向：

```
./program argument 
```

然后，使用 printf 发送到标准输出的所有消息都显示在终端中。

我有其他 C 程序，以这种方式重定向输出没有问题。跟程序本身有关系吗？随着论点通过？应该从哪里寻找问题？

C程序的一些细节：

*   它不从标准输入读取任何内容
*   它使用 BSD Internet 域套接字
*   它使用 POSIX 线程
*   它使用 sigaction 为 SIGINT 信号分配一个特殊的处理函数
*   它向标准输出发送大量换行符（对于那些认为我应该刷新的人）

一些代码：

```
int main(int argc, char** argv)
{
    printf("Execution started\n");
    do
    {        
        /* lots of printf here */
    } while (1);
    /* Code never reached */
    pthread_exit(EXIT_SUCCESS);
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-01T00:34:51.057

换行后刷新仅在打印到终端时有效，但在打印到文件时不一定有效。一个快速的谷歌搜索显示这个页面有更多的信息：[http ://www.pixelbeat.org/programming/stdio_buffering/](http://www.pixelbeat.org/programming/stdio_buffering/)

请参阅标题为“默认缓冲模式”的部分。

毕竟，您可能必须添加一些对 fflush(stdout) 的调用。

[您还可以使用setvbuf](http://www.cplusplus.com/reference/clibrary/cstdio/setvbuf.html)设置缓冲区大小和行为。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-01T04:09:53.197

刷新缓冲区通常由函数处理，该函数通常由from main()`exit()`隐式调用。`return`您通过提高 SIGINT 来结束您的程序，显然默认的 SIGINT 处理程序不会刷新缓冲区。

看看这篇文章： [应用设计模式来简化信号处理](http://www.cs.wustl.edu/~schmidt/signal-patterns.html)。这篇文章主要是 C++，但在第 2 部分有一个有用的 C 示例，它展示了如何使用 SIGINT 优雅地退出程序。

至于为什么终端的行为与文件不同，请查看 Stevens[的 UNIX 环境中的高级编程](https://rads.stackoverflow.com/amzn/click/com/0201563177)第 5.4 节关于缓冲。他说：

> 大多数实现默认为以下类型的缓冲。标准错误总是无缓冲的。如果所有其他流引用终端设备，则它们都是行缓冲的；否则，它们将被完全缓冲。本书中讨论的四个平台遵循标准 I/O 缓冲的这些约定：标准错误是无缓冲的，对终端设备开放的流是行缓冲的，所有其他流都是完全缓冲的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-01T00:40:06.507

当您检查重定向文件的内容时，程序是否已终止？如果它仍在运行，您的输出可能仍会在链上的某处缓冲，因此您不会在文件中看到它。

除此之外，以及迄今为止提供的其他答案，我认为是时候展示问题代码的代表性示例了。有太多深奥的可能性。

**编辑**

从示例代码的外观来看，如果您的打印量相对较小，那么您将被困在输出缓冲区中。每次写入后刷新以确保它已进入磁盘。通常，您可以拥有多达一页大小的未写入数据，否则。

在没有刷新的情况下，唯一可以确定磁盘上所有内容的时间是*程序*退出时。即使线程终止也不会这样做，因为这样的输出缓冲区不是每个线程的，它们是每个进程的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T05:13:20.400

建议：

1.  也将 stderr 重定向到一个文件。
2.  尝试 tail -f 您的输出文件。
3.  打开一个文件并 fprintf 您的日志记录（以帮助弄清楚发生了什么）。
4.  搜索 std* 文件句柄或 1-3 个文件描述符的任何手动关闭/复制/管道。
5.  降低复杂性；在 printfs 工作之前，删除大量功能。然后阅读它们，直到它再次中断。继续，直到您确定罪魁祸首代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-08T12:35:19.150

只是为了记录，在 Perl 中你会使用：

```
use IO::Handle;

flush STDOUT;
autoflush STDOUT; 
```

# ruby-on-rails - ActiveResource 模型可以与 ActiveRecord 模型集成吗？

> ID：499887
> 
> 赞同：4
> 
> 时间：2009-02-01T00:31:32.717
> 
> 标签：ruby-on-rails, activerecord, rest, activeresource

我正在开发一个 Rails 应用程序，它将通过 Rails 的 ActiveResource 功能用作其他 Rails 应用程序的身份验证系统。

身份验证应用程序有一个名为 的 ActiveRecord 模型`User`。客户端应用程序有一个名为 的 ActiveResource 模型`User`。我知道在客户端应用程序中我可以做类似的事情`user.save`，它将使用 XML over HTTP 执行 PUT 操作。

但是如果我想放入我的客户端应用程序的`User`模型`has_many :contacts`或类似的东西（`contacts`作为客户端应用程序中的 ActiveRecord 模型）怎么办？然后我想做一些事情，比如获取所有`Contact`属于 some 的 s `User`。

那可能吗？

（我注意到有人问了[类似的问题](https://stackoverflow.com/questions/183604/how-do-i-create-an-activerecord-relationship-to-an-activeresource-object)，但没有多少回应。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T17:56:10.597

简短的回答：没有。`has_many`、`belongs_to`、中涉及的类`has_and_belongs_to_many`存在于 ActiveRecord 中并构建 SQL 查询以使关联起作用。

也就是说，你可以让它看起来有一个关联，你只需要编写自己的方法。在您链接到的那个问题上，哪个是投票赞成的答案。

因此，在您的 Contact 模型中添加一个列，该列是`user_id`您需要传递给`User.find`ActiveResource 模型的任何键，您可以像这样作为关联合同的一部分：

```
class User < ActiveResource::Base
  # boilerplate ActiveResource url stuff

  def contacts
    Contact.find(:all, :conditions => { :user_id => self.id })
  end
end

class Contact < ActiveRecord::Model
  def user
    User.find_by_user_id(self.user_id)
  end
end 
```

您可以免费获得更多内容`has_many`，但这就是要点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-02-25T10:48:26.063

这个问题很古老，但我最近遇到了这个问题：

[http://yetimedia.tumblr.com/post/35233051627/activeresource-is-dead-long-live-activeresource](http://yetimedia.tumblr.com/post/35233051627/activeresource-is-dead-long-live-activeresource)

从帖子：

> 对关联的基本支持：has_many、has_one、belongs_to 现在可以在 ActiveResource 模型中使用。

尽管 ActiveResource 已从 Rails 4.0 中删除，但帖子中还提到了一些其他改进，可能需要再次查看 ActiveResource。

# asp.net-mvc - 我应该在 ASP.NET MVC 应用程序中使用 MS 验证应用程序块吗？

> ID：499888
> 
> 赞同：1
> 
> 时间：2009-02-01T00:31:42.980
> 
> 标签：asp.net-mvc, validation

我知道[MS 验证应用程序块](http://msdn.microsoft.com/en-us/library/cc309509.aspx) *可以*[与 ASP.NET MVC](https://stackoverflow.com/questions/234006/what-are-validation-options-for-asp-net-mvc)一起使用，但我不确定是否**应该**。看起来它自 2007 年以来就没有更新过 - 这可能很好 - 在我的应用程序中采用我以前没有使用过的新东西之前，我会格外小心。

有什么理由不这样做 - 或者它对我有什么好处 - 或者有什么即将到来的我应该等待？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T06:53:34.490

使用应该没问题。有一些 MVC 项目像[xVal](http://xval.codeplex.com/)一样使用它。

验证应用程序块在 4.1 中也得到了更新。您拥有的链接指向旧版本。在此处了解有关 4.1 的更多信息：http: [//msdn.microsoft.com/en-us/library/dd140088.aspx](http://msdn.microsoft.com/en-us/library/dd140088.aspx)

# comments - 你个人对评论的态度/看法是什么？

> ID：499890
> 
> 赞同：11
> 
> 时间：2009-02-01T00:33:20.340
> 
> 标签：comments

### 复制

> [你对评论有什么硬性规定？](https://stackoverflow.com/questions/142830/what-are-your-hard-rules-about-commenting-your-code)

与我一起工作的开发人员对我感兴趣的评论有一些话要说（见下文）。你个人对评论的态度/看法是什么？

> “我不会在代码中添加注释，除非它是一个简单的标题，或者存在
> 平台错误或不明显的必要解决方法。代码可以更改，注释可能会产生误导。代码
> 在使用时应该是自我记录的描述性名称及其逻辑
> 组织 - 及其解决方案应该是
> 执行给定任务的最干净/最简单的方法。如果程序员不能
> 仅通过阅读代码来判断程序做什么，那么他还没有准备好改变它
> 。往往是编写复杂或
> 不明显的东西的拐杖——我的目标是始终编写干净简单的代码。”
> 
> “我认为在评论方面有几个阵营，认为他们正在编写 API 和一些宏大的代码库的企业类型将用于子孙后代，类似工匠的程序员认为代码说明了什么它确实比注释更清晰，新手编写冗长/不清晰的代码以便需要给自己留下笔记，说明他们为什么要做某事。”

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-01T01:25:27.833

“自我记录代码”理论存在一个可悲的缺陷。是的，阅读代码会告诉你它*在*做什么。但是，代码无法告诉您它*应*该做什么。

我认为可以肯定地说，所有的错误都是在代码没有做它应该做的事情时引起的:)。因此，如果我们添加一些关键注释来为维护者提供足够的信息来了解一段代码应该做什么，那么我们就赋予了他们修复大量错误的能力。

这给我们留下了要输入多少评论的问题。如果您输入太多评论，维护起来就会变得乏味，并且评论将不可避免地与代码过时。如果你投入的太少，那么它们就不是特别有用。

我发现常规评论在以下地方最有用：

1) .h 或 .cpp 文件顶部的简要说明，用于解释类目的。这有助于为维护人员提供快速概览，而无需筛选所有代码。

2) 在执行一个重要函数之前的注释块，解释它的目的并详细说明它的预期输入、潜在输出以及调用函数时预期的任何奇怪之处。这使未来的维护者不必破译整个函数来弄清楚这些事情。

除此之外，我倾向于评论任何可能让某人感到困惑或奇怪的事情。例如：“这个数组是基于 1 而不是基于 0，因为 blah blah”。

写得好，位置好的评论是无价的。糟糕的评论往往比没有评论更糟糕。对我来说，完全没有任何评论表明代码作者的懒惰和/或傲慢。无论代码在做什么对您来说多么明显，或者您的代码多么出色，进入一个冷酷的代码体并弄清楚到底发生了什么都是一项具有挑战性的任务。做得好的评论可以让人们加快现有代码的速度。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-01T00:41:39.187

我一直很喜欢*Refactoring*对评论的看法：

> 我们在这里提到评论的原因是评论经常被用作除臭剂。令人惊讶的是，您经常看到注释很厚的代码并注意到注释在那里是因为代码很糟糕。
> 
> 注释会导致我们写出糟糕的代码，其中包含我们在本章其余部分讨论过的所有腐烂味道。我们的第一个行动是通过重构来消除不良气味。当我们完成后，我们经常发现评论是多余的。

尽管有争议，但我读过的代码确实如此。公平地说，Fowler 并不是说​​永远不要发表评论，而是在做之前先考虑代码的状态。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-01T05:20:11.760

您需要文档（以某种形式；并不总是注释）以在*本地*理解代码。*如果您阅读了所有*代码并牢记在心，代码本身就会告诉您它的作用。（更多内容见下文。）评论最适合非正式或半正式文档。

许多人说注释是一种代码味道，可以通过重构、更好的命名和测试来替代。虽然糟糕的评论（很多）都是如此，但很容易得出结论总是如此，哈利路亚，没有更多的评论。这将本地文档的所有负担——我认为太多了——放在了命名和测试上。

记录每个函数的契约，以及对于每种类型的对象，它表示什么以及对有效表示的任何约束（技术上，[抽象函数和表示不变](http://www.mit.edu/~6.170/conceptual-info/abstraction-functions-and-rep-invariants.html)）。在可行的情况下使用可执行的、可测试的文档（文档测试、单元测试、断言），但也要写简短的注释，在有帮助的地方给出要点。（如果测试采用示例的形式，它们是不完整的；如果它们是完整的、精确的契约，它们可能与代码本身一样需要深入研究。）为每个模块和每个项目编写顶级注释；这些可以解释使您所有其他评论（和代码）保持简短的约定。（这*支持*命名为文档：建立了约定，并且我们可以期望在其中发现细微之处，我们可以更有信心地相信名称说明了我们需要知道的一切。）更长的、程式化的、令人恼火的冗余 Javadocs 有它们的用途，但是帮助产生了反弹。

（例如，这个：

> 执行 n 次 fobulation。
> @param n 移动的次数
> @param x 移动中心的 x 坐标
> @param y 移动中心的 y 坐标
> @param z 移动中心的 z 坐标

可能就像“围绕中心 (x,y,z) 摇晃 n 次”。评论不一定是阅读和写作的苦差事。）

我并不总是按照我在这里说的去做；这取决于我对代码的重视程度以及我希望谁阅读它。但是学习如何编写这种方式让我成为了一个更好的程序员，即使是在偷工减料的时候。

回到我们为了本地理解而记录的声明：这个函数有什么作用？

```
def is_even(n): return is_odd(n-1) 
```

测试整数是否为偶数？如果`is_odd()`测试一个整数是否为奇数，那么是的，这有效。假设我们有这个：

```
def is_odd(n): return is_even(n-1) 
```

同样的推理表明，这`is_odd()`会测试整数是否为奇数。当然，将它们放在一起，两者都不起作用，即使每个都起作用，如果另一个起作用。稍微改变一下，我们就会得到可以工作的代码，但只适用于自然数，而在本地看起来它仍然适用于整数。在微观世界中，这就是理解代码库的样子：循环追踪依赖关系，以尝试对作者可能已经解释过一两行的假设进行逆向工程。我*讨厌*在过去的几十年里，精神上粗心的编码人员的代价让我走上了这条路：哦，这种方法看起来有与扭曲核心远距离的副作用......总是？好吧，如果奇怪的crobuncles去饱和，至少；他们吗？最好检查所有 crobuncle 处理代码......这将对理解提出挑战。好的文档将这个 O(n) 指针追踪减少到 O(1)：例如，知道一个函数的契约和它明确使用的事物的契约，函数的代码应该在不进一步了解系统的情况下有意义。（在这里，合同说`is_even()`和`is_odd()`工作自然数会告诉我们两个函数都需要测试`n==0`。）

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-01T00:43:48.480

我唯一真正的规则是注释应该解释为什么代码在那里，而不是它在做什么或它是如何做的。这些事情可以改变，如果他们这样做，评论必须保持。代码最初存在的目的不应该改变。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-02-01T02:38:24.147

注释的目的是解释上下文——代码的原因；这一点，程序员不能仅从代码检查中知道。例如：

```
strangeSingleton.MoveLeft(1.06);
badlyNamedGroup.Ignite(); 
```

谁知道这到底是为了什么？但通过一个简单的评论，一切都揭示了：

```
//when under attack, sidestep and retaliate with rocket bundles
strangeSingleton.MoveLeft(1.06);
badlyNamedGroup.Ignite(); 
```

说真的，评论是针对*为什么*，而不是*如何*，除非如何不直观。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-01T00:46:33.403

虽然我同意代码应该是自读的，但我仍然认为添加大量注释块来解释设计决策很有价值。例如“我做了 xyz 而不是 abc 的常见做法，因为这个警告......”带有错误报告的 URL 或其他内容。

我试着把它看成：如果我已经死去，而一个刚从大学毕业的人必须在这里修复一个错误，他们需要知道什么？

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-01T00:42:16.703

一般来说，我看到用于解释写得不好的代码的注释。*大多数*代码都可以以使注释变得多余的方式编写。话虽如此，我发现自己在语义不直观的代码中留下了注释，例如调用具有奇怪或意外行为的 API 等......

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-02-01T01:43:24.070

我也普遍赞同self-documenting code的想法，所以我认为你的开发者朋友给出了很好的建议，我不会重复，但肯定有很多情况需要注释。

很多时候，我认为这归结为实现与未来代码阅读者将熟悉的普通或简单抽象类型的接近程度，或者更普遍地说，代码在多大程度上讲述了整个故事。根据编程语言和项目的类型，这将导致更多或更少的注释。

因此，例如，如果您在不安全的 C# 代码块中使用某种 C 风格的指针算法，则不应期望 C# 程序员轻松地从 C# 代码读取切换（这通常可能更具声明性或至少更少关于较低级指针操作）能够理解你的不安全代码在做什么。

另一个例子是当你需要做一些工作来推导或研究一个算法或方程，或者一些不会出现在你的代码中的东西，但有必要了解是否有人需要对你的代码进行重大修改。您应该在某处记录这一点，并且至少在相关代码部分中直接引用将有很大帮助。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-02-01T00:35:38.387

我认为您的代码包含多少或多少评论并不重要。如果您的代码包含注释，则必须维护它们，就像您的其余代码一样。

编辑：这听起来有点自负，但我认为太多人忘记了即使变量的名称，或者我们在代码中使用的结构，都只是简单的“标签”——它们只对我们有意义，因为我们的大脑看到一串字符，例如`customerNumber`并理解它是一个客户编号。虽然注释确实缺乏编译器的任何“强制执行”，但它们并没有被删除。它们旨在向另一个人传达意义，一个正在阅读程序文本的人类程序员。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-02-01T00:47:23.573

如果没有注释代码不清晰，先让*代码*表达更清晰的意图，然后只根据需要添加注释。

注释有它们的位置，但主要用于代码不可避免地微妙或复杂的情况（固有的复杂性是由于要解决的问题的性质，而不是由于程序员的懒惰或思维混乱）。

在代码行中要求注释和“衡量生产力”可能会导致垃圾，例如：

```
/*****
 *
 * Increase the value of variable i,
 * but only up to the value of variable j.
 *
 *****/

if (i < j) {
    ++i;
} else {
    i = j;
} 
```

而不是简洁的（并且对于熟练的程序员来说很清楚）：

```
i = Math.min(j, i + 1); 
```

YMMV

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-02-01T00:45:05.340

我的绝大多数commnets都在类级别和方法级别，我喜欢描述更高级别的视图而不仅仅是args/return value。我特别小心地描述了函数中可能使粗心大意的人绊倒的任何“非线性”（限制、极端情况等）。

通常我不会在方法内部发表评论，除了标记“FIXME”项目，或者偶尔会出现一些我似乎无法清理的“这里是怪物”陷阱，但我非常努力地避免这些*。*正如 Fowler 在*Refactoring*中所说，注释往往表明代码很小。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-02-01T00:46:51.983

注释是代码的一部分，就像函数、变量和其他一切一样——如果更改相关功能，注释也必须更新（就像函数参数更改时函数调用需要更改一样）。

一般来说，在编程时，你应该只在一个地方做一次事情。

因此，如果通过清晰的命名来解释代码的作用，则不需要注释——当然这始终是目标——这是最干净、最简单的方法。

但是，如果需要进一步解释，我将添加一个注释，前缀为 INFO、NOTE 和类似的...
如果有人不熟悉该区域，则 INFO: 注释用于提供一般信息。
注意：注释是为了提醒潜在的异常情况，例如奇怪的业务规则/实现。
如果我特别不希望人们接触代码，我可能会添加一个 WARNING: 或类似的前缀。

我不使用并且特别反对的是变更日志样式的注释——无论是内联的还是文件头部的——这些注释属于版本控制软件，*而不是*源代码！

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-02-01T01:41:24.120

我更喜欢使用“Hansel and Gretel”类型的评论；代码中的小注释说明了*我为什么要这样做*，或者*为什么其他方式不合适*。下一个访问此代码的人可能会需要此信息，而且通常情况下，那个人就是我。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-02-01T03:28:11.097

作为承包商，我知道有些维护我的代码的人会不熟悉我正在使用的 ADO.Net 的高级功能。在适当的情况下，我会添加一个关于我的代码意图的简短注释和一个指向 MSDN 页面的 URL，该页面会更详细地解释。

*我记得在学习 C# 和阅读其他人的代码时，我经常被诸如“冒号字符的*9 个含义中的哪个含义”之类的问题所困扰。如果您不知道该功能的名称，您如何查找它？！（旁注：这将是一个很好的 IDE 功能：我在代码中选择一个运算符或其他标记，右键单击然后显示它的语言部分和功能名称。C# 需要这个，VB 较少。）

至于“我不评论我的代码，因为它是*如此清晰和干净*”的人群，我发现有时他们高估了他们非常聪明的代码的清晰程度。复杂算法对于作者以外的其他人来说是不言自明的想法是一厢情愿的想法。

我喜欢@17 of 26 的评论（添加了重点）：

> ...阅读代码会告诉你它*在*做什么。但是，代码无法告诉您它 *应*该做什么。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-02-01T00:51:41.210

我很少评论。我的理论是，如果您必须发表评论，那是因为您没有以最好的方式做事。就像“变通”是我唯一要评论的事情。因为它们通常没有意义，但是您这样做是有原因的，因此您需要解释。

评论是低于标准代码 IMO 的症状。我坚信自我记录代码。我的大部分工作都可以很容易地翻译，即使是外行，因为描述性的变量名称、简单的形式、准确的方法和许多方法（IOW 没有做 5 种不同事情的方法）。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-02-01T00:52:00.337

注释是程序员工具箱的一部分，可以被使用和滥用。这不取决于您、其他程序员或任何真正告诉您一个工具总体上不好的人。任何事情都有地点和时间，包括评论。

我同意这里所说的大部分内容，代码应该写得非常清楚，以至于它是自我描述的，因此*不需要*注释，但有时这与最佳/最佳实现冲突，尽管这可能可以解决一个适当命名的方法。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-02-01T02:04:14.980

我同意自我记录代码理论，如果我不能通过阅读它来判断一段代码在做什么，那么它可能需要重构，但是有一些例外情况，如果出现以下情况，我会添加评论：

*   我正在做一些你通常看不到的事情
*   有不明显的主要副作用或实施细节，或明年不会出现
*   我需要记住实现一些东西，尽管在这些情况下我更喜欢例外。
*   如果我被迫去做其他事情并且我有很好的想法，或者代码遇到困难，那么我将添加足够的注释以暂时保持我的精神状态

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-02-01T00:45:07.993

大多数时候，我发现最好的评论是我目前正在编码的函数或方法名称。所有其他评论（除了你朋友提到的原因——我同意他们）感觉都是多余的。

所以在这种情况下，评论感觉有点矫枉过正：

```
/*
 * this function adds two integers
 */
int add(int x, int y)
{
    // add x to y and return it
    return x + y;
} 
```

因为代码是自描述的。这种事情不需要评论，因为函数的名称清楚地表明了它的作用，return 语句也很清楚。当你把它分解成这样的小函数时，你会惊讶于你的代码变得多么清晰。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-02-01T01:03:28.207

在使用 C 编程时，我会在头文件中使用多行注释来描述 API，例如函数的参数和返回值、配置宏等...

在源文件中，我将坚持使用单行注释来解释非不言而喻的代码片段的目的，或者将无法以理智的方式重构为更小的函数的子部分。这是我在源文件中注释的风格[示例](https://stackoverflow.com/questions/469696/what-is-your-most-useful-c-c-snippet/469729#469729)。

如果您需要多于几行注释来解释给定代码的作用，那么您应该认真考虑您正在做的事情是否不能以更好的方式完成......

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-02-01T01:09:35.760

我写的注释描述了一个函数或方法的目的以及它返回的结果足够详细。我不会写很多内联代码注释，因为我相信我的函数和变量命名足以理解正在发生的事情。

我在许多写得非常糟糕的遗留 PHP 系统上进行开发。我希望最初的开发人员会在代码中留下某种类型的注释来描述这些系统中发生的事情。如果您要编写其他人最终会阅读的难以辨认或糟糕的代码，您应该对其进行注释。

另外，如果我正在以一种乍一看不正确的特定方式做某事，但我知道这是因为有问题的代码是平台或类似东西的解决方法，那么我会用 WARNING 评论进行评论.

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-02-01T03:43:00.130

有时代码完全可以完成它需要做的事情，但是有点复杂，并且在其他人第一次看到它时不会立即显而易见。在这种情况下，我将添加一个简短的内联注释来描述代码的用途。

我还尝试提供方法和类的文档标题，这对于智能感知和自动生成的文档很有用。实际上，我有一个坏习惯，就是将 90% 的方法和类都没有记录在案。当您处于编码过程中并且一切都在不断变化时，您没有时间记录事情。然后当你完成后，你不想回去寻找所有的新东西并记录下来。每个月左右回去写一堆文档可能会很好。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-02-01T16:58:18.683

这是我的观点（基于几年的博士研究）：

注释函数（使用某种黑盒，如 JavaDocs）和为将要阅读代码的人注释实际代码（“内部注释”）之间存在巨大差异。

大多数“写得好”的代码不应该需要太多的“内部注释”，因为如果它执行很多，那么它应该被分解成足够多的函数调用。然后在函数名称和函数注释中捕获每个调用的功能。

现在，函数注释确实是问题所在，在某些方面你的朋友是对的，对于大多数代码来说，没有像记录流行 API 那样完整规范的经济激励。这里重要的是确定什么是“指令”：指令是那些直接影响客户的信息片段，需要一些直接的操作（并且通常是意想不到的）。例如，X 必须在 Y 之前调用，不要从 UI 线程外部调用它，注意这有一定的副作用，等等。这些都是非常重要的要捕获的东西。

由于大多数人从不阅读完整的功能文档，并且略读他们所阅读的内容，因此您实际上可以通过仅捕获指令而不是整个描述来增加意识的机会。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-02-01T01:42:40.840

我尽可能多地发表评论——然后，就像一年后我需要的那样。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-02-01T02:55:53.220

我们添加了为所有公共类/方法/属性/等提供 API 参考文档的注释……这是非常值得的努力，因为 C# 中的 XML 文档具有为这些公共 API 的用户提供 IntelliSense 的良好效果。.NET 4.0 的代码契约将使我们能够进一步改进这种做法。

作为一般规则，我们不会在编写代码时记录内部实现，除非我们正在做一些不明显的事情。理论是，当我们正在编写新的实现时，事情正在发生变化，当尘埃落定时，评论很可能是错误的。

当我们重新开始处理现有的代码时，当我们意识到需要一些思考才能弄清楚到底发生了什么时，我们会添加注释。通过这种方式，我们最终得到了更可能正确的注释（因为代码更稳定）以及它们更有可能有用的地方（如果我今天回到一段代码，它似乎更多可能我明天可能会再回来）。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2010-06-02T13:21:42.147

我的做法：

注释弥合了上下文/现实世界和代码之间的差距。因此，每一行都用正确的英语注释。

我确实拒绝在最严格的意义上不遵守此规则的代码。

格式良好的 XML 的使用 - 注释是不言而喻的。

马虎的评论意味着马虎的代码！

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2010-10-09T22:52:21.197

这是我编写代码的方式：

```
if (hotel.isFull()) {
    print("We're fully booked");
} else {
    Guest guest = promptGuest();
    hotel.checkIn(guest);
} 
```

以下是我可能为该代码编写的一些评论：

```
// if hotel is full, refuse checkin, otherwise 
// prompt the user for the guest info, and check in the guest. 
```

如果你的代码读起来像散文，那么写注释就没有意义，只是重复代码所读的内容，因为阅读代码所需的心理处理和注释几乎相等；如果您先阅读评论，您仍然需要阅读代码。

另一方面，在某些情况下，使代码看起来像散文是不可能或极其困难的。这就是评论可以修补的地方。

# cocoa - 在 NSUserDefaults 中保存 CoreData 实体

> ID：499897
> 
> 赞同：19
> 
> 时间：2009-02-01T00:35:31.117
> 
> 标签：cocoa, core-data, save, nsuserdefaults

想象一个CoreData 实体（例如命名的`searchEngine`）。
`NSManagedObjectContext`管理该实体的一些“实例”。
最终用户将能够`"standard searchEngine"`使用`NSPopupButton`.
NSPopupButton`selected object`应该绑定到 NSUserDefaults。
问题：

> `1)`@try{保存}
> 
> > `a)`如果您尝试将选定的“实例”直接保存到 NSUserDefaults ，则会出现如下内容：
> > 
> > ```
> > -[NSUserDefaults setObject:forKey:]: 尝试插入非属性值 ' (entity: searchEngine; id: 0x156f60 ; data: {
> >     网址=“ http://google.de/ ”；
> >     一些属性 = 1;
> >     名称=“谷歌”；
> > })' 的类 'searchEngine'。
> > ```
> > 
> > `b)`如果您尝试将“实例”转换为 NSData，则会出现以下情况：
> > 
> > ```
> > -[searchEngine encodeWithCoder:]：无法识别的选择器发送到实例 0x1a25b0
> > ```
> > 
> > 那么知道如何在与 plist 兼容的数据中获取这些实体吗？
> 
> `2)`@try{registerDefaults}
> 
> > 通常该`registerDefaults:`方法在`+ (void)initialize`. 这里的问题是在CoreData从他的数据库加载保存的实体之前调用了这个方法。所以我不能将默认值设置为不存在的对象，对吧？

我知道，很长的问题......但是：try{[me provide:details]} ;D

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-07-07T16:07:24.967

如果您需要存储对特定托管对象的引用，请使用其托管对象 ID 的 URI 表示：

```
NSURL *moIDURL = [[myManagedObject objectID] URIRepresentation]; 
```

然后，您可以将 URL 保存为用户默认值。

要检索托管对象，请使用：

```
NSManagedObjectID *moID = [myPersistentStoreCoordinator managedObjectIDForURIRepresentation:moIDURL];
NSManagedObject *myManagedObject = [myContext objectWithID:moID]; 
```

唯一需要注意的是，您必须确保原始托管对象 ID 是永久的——如果您已经保存了对象，这不是问题，或者您可以使用`obtainPermanentIDsForObjects:error:`.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-12-28T20:40:48.650

这是目前使用 4.0 中添加的 setURL 和 getURL 方法来避免对 NSKeyedUnarchiver 和 NSKeyedArchiver 的额外调用的最简洁和最短的方法：

**二传手：**

```
 + (void)storeSomeObjectId:(NSManagedObjectID *)objectId
 {
     [[NSUserDefaults standardUserDefaults] setURL:[objectId URIRepresentation] 
                                            forKey:@"someObjectIdKey"];
     [[NSUserDefaults standardUserDefaults] synchronize];
 } 
```

**吸气剂：**

```
 + (SomeManagedObject *)getObjectByStoredId
 {
     NSURL *uri = [[NSUserDefaults standardUserDefaults] URLForKey:@"someObjectIdKey"];
     NSManagedObjectID *objectId = [self.persistentStoreCoordinator managedObjectIDForURIRepresentation:uri];
     SomeManagedObject *object = [self.managedObjectContext objectWithID:objectId];
 } 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-01T01:32:20.207

您不想尝试归档核心数据实体并存储它。相反，您将存储密钥或其他一些已知属性，并在应用程序启动时使用它来获取实体。

一些示例代码（根据[Core Data Programming Guide](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/CoreData/Articles/cdFetching.html)中发布的示例稍作修改）：

```
NSManagedObjectContext *moc = [self managedObjectContext];
NSEntityDescription *entityDescription = [NSEntityDescription
    entityForName:@"SearchEngine" inManagedObjectContext:moc];
NSFetchRequest *request = [[[NSFetchRequest alloc] init] autorelease];
[request setEntity:entityDescription];

NSPredicate *predicate = [NSPredicate predicateWithFormat:
    @"engineName LIKE[c] '%@'", selectedEngineName];
[request setPredicate:predicate];

NSError *error = nil;
NSArray *array = [moc executeFetchRequest:request error:&error];
if (array == nil)
{
    // Deal with error...
} 
```

这样，您可以将名称保存在用户默认值中，并在必要时获取实体。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-06-30T11:26:32.053

我的模型将记录的 UUID 保存到 UserDefaults，以便在下次应用启动时启动最后打开的记录。

```
public class Patient: NSManagedObject {    
    override public func awakeFromInsert() {
        super.awakeFromInsert()
        uuid = UUID()
}

extension Patient {
    @NSManaged public var uuid: UUID
    @NSManaged ...
} 
```

使用唯一 ID (UUID) 标识每条记录是一种很好的做法。您可以将 UUID 保存为字符串，只需调用`uuid.uuidString`.

# c# - 通用接口作为方法参数和查看字段

> ID：499902
> 
> 赞同：2
> 
> 时间：2009-02-01T00:36:27.230
> 
> 标签：c#

这可能是我的幼稚表现出来，但无论如何......

我有一个通用接口，它定义了一组跨实现的标准方法（以不同的方式实现）。

我将接口作为参数传递给方法，该方法负责持久化到数据库。例如，我有一些从通用接口（称为 IEntry）定义的称为 bug、事件等的实现。这些具体的实现也利用了 IEnumerable

因为错误与事件不同，所以存在不同的字段。当我将接口作为参数传递给方法时，有没有办法推断类型？因此，如果我传入 Bug 对象，我可以使用它的字段，这些字段与 Incident 中的字段不同。这些字段对于数据库的持久性很有用。我假设没有，因为没有办法知道要传入的类型是什么（显然），但我知道这里的人有更多的智慧。在那种情况下，有没有更好的做事方式？由于相似性，我想坚持接口。

编辑：我猜另一种方法是利用一些流控制来动态生成 sql 语句，然后将其作为参数传递。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T00:40:29.237

关于传递对象和接口的事情是你真的不应该关心实际类型，只要它继承/实现你感兴趣的特定基类/接口。

因此，在该方法中构建逻辑以找出它是一个错误，然后访问仅存在于错误的事物，这基本上不是 OOP 方式，尽管在您的特定情况下它可能是“最佳”方式。

但是，我建议不要这样做，而是尝试使用多态性构建适当的 OOP 方式来处理差异，而不是将其作为特殊情况构建到方法中。

您提到持久性，这种方法是否负责将数据存储在某个地方？也许您可以将收集要存储的信息的部分与存储信息的部分分开，这样您就可以要求对象本身为您提供所有相关信息，这些信息可能因一类而异。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-01T01:46:01.007

糟糕的设计（我认为在问题中有所描述）：

```
public interface IEntry
{
    string Description { get; set; }
}
public class Bug : IEntry
{
    public int ID { get; set; }
    public string Description { get; set; }
    public string UserName { get; set; }
}
public class Incident : IEntry
{
    public Guid ID { get; set; }
    public string Description { get; set; }
}

public class Persister
{
    public void Save(IEnumerable<IEntry> values)
    {
        foreach (IEntry value in values) { Save(value); }
    }

    public void Save(IEntry value)
    {
        if (value is Bug) { /* Bug save logic */ }
        else if (value is Incident) { /* Incident save logic */ }
    }
} 
```

改进设计（智能实体方法）：

```
public interface IEntry
{
    string Description { get; set; }
    void Save(IPersister gateway);
}

public class Bug : IEntry
{
    public int ID { get; set; }
    public string Description { get; set; }
    public string UserName { get; set; }

    public void Save(IPersister gateway)
    {
        gateway.SaveBug(this);
    }
}

public class Incident : IEntry
{
    public Guid ID { get; set; }
    public string Description { get; set; }

    public void Save(IPersister gateway)
    {
        gateway.SaveIncident(this);
    }
}

public interface IPersister
{
    void SaveBug(Bug value);
    void SaveIncident(Incident value);
}

public class Persister : IPersister
{
    public void Save(IEnumerable<IEntry> values)
    {
        foreach (IEntry value in values) { Save(value); }
    }

    public void Save(IEntry value)
    {
        value.Save(this);
    }

    public void SaveBug(Bug value)
    {
        // Bug save logic
    }

    public void SaveIncident(Incident value)
    {
        // Incident save logic
    }
} 
```

改进后的设计只是为了迎合 Persister.Save(IEntry) 的变化需要。我只是想演示使代码不那么脆弱的第一步。在现实和生产代码中，您可能希望有一个 BugPersister 和 IncidentPersister 类，以符合[单一职责原则](http://www.objectmentor.com/resources/articles/srp.pdf)。

希望这个更以代码为中心的示例对您有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T00:47:49.423

持久性只是类中将详细信息上传到数据库的方法。

我想我可以编写一个具有持久性要求的函数的抽象类，并且可以基于参数来使其工作。我可以在我的每个接口实现中使用它。因为更新到 db 的方式会发生（几乎相同，但 sql 查询中的一些单词发生了变化），我可以根据方法参数生成它。

# django - 尝试更新它会插入的表单！

> ID：499909
> 
> 赞同：0
> 
> 时间：2009-02-01T00:40:04.353
> 
> 标签：django, django-forms

我正在尝试更新一个对象，但我得到：“主键必须是唯一的”...... Entry 的模型：

```
 class Entry(models.Model):
      title = models.CharField(max_length=250)
      author = models.ForeignKey(User, editable=False)
      status = models.IntegerField(choices=data_types.STATUS_CHOICES,
      default = data_types.STATUS_DRAFT) 
```

和观点：

```
@login_required
def edit_entry(request, entry_id='0'):
  message = ""
  entry = get_object_or_404(Entry.objects, pk=entry_id)
  if request.method == 'GET':
    form = EntryForm(instance=entry)
  else :
    if request.method == 'POST':
      if request.POST['submit'] == 'Edit':
        print "entry id: %s" % entry.id
        form = EntryForm(request.POST, instance=entry)
        if form.is_valid():
            secondEntry = form.save(False)
            print "second entry id: %s" % secondEntry.id
            form.save()
            message = "entry updated"
        else:
            message = 'There were errors'
  return render_to_response(
        'myadmin/edit_entry.html',
         { 'entryForm':form,'message': message}, 
         context_instance=RequestContext(request)) 
```

因此，我打印了两个 ID，它们是相同的： 1\. 这应该使 form.save() 更新对象，但相反，它会尝试插入它……知道吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T15:30:11.543

好吧，也许在 form = EntryForm(request.POST, instance=entry) 行中，您没有指定实例参数，因为这是为了更新现有模型....

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-20T02:56:39.577

您的第一个 form.save(False) 会生成一个 Entry 对象，其中填充了表单中的数据，因此您应该再次保存该 Entry 对象而不是表单。

```
secondEntry = form.save(commit=False)
secondEntry.save() 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T02:55:15.797

为什么你有两次 form.save() ？也许这就是问题所在。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T19:32:27.050

> form.save(force_update=True)

# cocoa - outlineView:dataCellForTableColumn:item: 有奇怪的副作用

> ID：499933
> 
> 赞同：1
> 
> 时间：2009-02-01T00:49:17.563
> 
> 标签：cocoa

我有一个大纲视图委托，并且正在覆盖 outlineView:dataCellForTableColumn:item: 以使我的大纲视图中的单元格成为按钮（请参阅[此问题](https://stackoverflow.com/questions/482357/how-can-i-make-an-nsoutlineview-where-some-of-the-entires-are-buttons)）。这是我的代表的代码：

```
- (NSCell *)outlineView:(NSOutlineView *)outlineView dataCellForTableColumn:(NSTableColumn *)tableColumn item:(id)item;
{
    MyCell * myCell = [[MyCell alloc] init];
//  return nil;
    return myCell;
} 
```

这样做有一个奇怪的副作用。在我的大纲视图的数据源中，outlineView:objectValueForTableColumn:byItem: 方法总是为 tableColumn 获取空值。

代码是：

```
- (id)outlineView:(NSOutlineView *)outlineView objectValueForTableColumn:(NSTableColumn *)tableColumn byItem:(id)item
{
    printf("tableColumn:%s\ttable identifier: %s\n", [[tableColumn className] cString], [[tableColumn identifier] cString]);
    return [item valueForKey:[tableColumn identifier]];
} 
```

输出是：

```
tableColumn:(null)  table identifier: (null) 
```

奇怪的是，这只发生在我实现 outlineView:dataCellForTableColumn:item: 方法时。我在这里想念什么？

编辑：

像这样修改委托函数似乎可以解决问题：

```
- (NSCell *)outlineView:(NSOutlineView *)outlineView dataCellForTableColumn:(NSTableColumn *)tableColumn item:(id)item;
{
    printf("delegate column identifier: %s\n", [[tableColumn identifier] cStringUsingEncoding:NSASCIIStringEncoding]);
    if (tableColumn == nil)
    {
        return nil;
    }
    MyCell * aCustomCell = [[MyCell alloc] init];
    return aCustomCell;
} 
```

但是，我真的不明白这里发生了什么。如果有人可以解释，那将很有帮助。谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T06:01:21.803

NSOutlineView 可以让您使用单个单元格来绘制整行，而不是为每一列绘制一个单独的单元格。它首先要求在 nil 表格列中传递一个单元格。如果您为该调用返回一个单元格，它将使用它来绘制整行，否则它将继续并要求为每一列提供一个单独的单元格。因此，正如您所发现的，解决方案是在传递 nil 表列时返回一个 nil 单元格，这样事情就会正常绘制。

# ruby-on-rails - 您将如何在 Rails 和 ActiveRecord 中使用参考和引用来建模文章？

> ID：499934
> 
> 赞同：1
> 
> 时间：2009-02-01T00:49:17.797
> 
> 标签：ruby-on-rails, database-design, activerecord

一篇文章有​​许多它引用的文章，许多其他文章可以引用它。有时一篇文章可以引用一篇也引用它的文章。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T01:20:04.787

我会这样做：

```
class Article < ActiveRecord::Base
  # mentions in other articles
  has_many :references, :foreign_key => 'referred_article_id'
  # articles that refer to it
  has_many :referrers, :through => :references, :foreign_key => 'referred_article_id'
  # articles it refers to
  has_many :referred_articles, :through => :references, :foreign_key => 'referrer_id'
end

class Reference < ActiveRecord::Base
  belongs_to :referrer, :class => Article
  belongs_to :referred_article, :class => Article
end 
```

# c - 如何从C中的浮点数中提取小数部分？

> ID：499939
> 
> 赞同：60
> 
> 时间：2009-02-01T00:53:05.823
> 
> 标签：c, floating-point, decimal, numbers

我们如何提取浮点数的小数部分并将小数部分和整数部分存储到两个单独的整数变量中？

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2009-02-01T00:56:55.397

您使用以下`modf`功能：

```
double integral;
double fractional = modf(some_double, &integral); 
```

您也可以将其转换为整数，但请注意您可能会溢出整数。那时的结果是不可预测的。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-02-01T00:57:03.523

尝试这个：

```
int main() {
  double num = 23.345;
  int intpart = (int)num;
  double decpart = num - intpart;
  printf("Num = %f, intpart = %d, decpart = %f\n", num, intpart, decpart);
} 
```

对我来说，它产生：

```
Num = 23.345000, intpart = 23, decpart = 0.345000 
```

这似乎是你所要求的。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-26T03:53:35.623

快速“简而言之”最明显的答案似乎是：

```
#define N_DECIMAL_POINTS_PRECISION (1000) // n = 3\. Three decimal points.

float f = 123.456;
int integerPart = (int)f;
int decimalPart = ((int)(f*N_DECIMAL_POINTS_PRECISION)%N_DECIMAL_POINTS_PRECISION); 
```

您可以通过更改 来更改所需的小数点数`N_DECIMAL_POINTS_PRECISION`以满足您的需要。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-25T23:33:54.950

我使用双浮点创建了一个子程序，它返回 2 个整数值。

```
 void double2Ints(double f, int p, int *i, int *d)
{ 
  // f = float, p=decimal precision, i=integer, d=decimal
  int   li; 
  int   prec=1;

  for(int x=p;x>0;x--) 
  {
    prec*=10;
  };  // same as power(10,p)

  li = (int) f;              // get integer part
  *d = (int) ((f-li)*prec);  // get decimal part
  *i = li;
}

void test()
{ 
  double df = 3.14159265;
  int   i,d;
  for(int p=2;p<9;p++)
  {
    double2Ints(df, p, &i,&d); printf("d2i (%d) %f = %d.%d\r\n",p, df,i,d);
  }
} 

```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-04-08T04:13:06.203

使用浮点数减去*floor* ed 值得到它的小数部分：

```
double fractional = some_double - floor(some_double); 
```

这可以防止类型转换为整数，如果浮点数非常大以至于整数值甚至不能包含它，这可能会导致**溢出。**

同样对于**负值**，此代码为您提供浮点数的**正小数部分，因为***floor()* [计算不大于输入值的最大整数值](https://en.cppreference.com/w/c/numeric/math/floor)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-12-20T19:44:58.750

我认为在这种情况下使用字符串是正确的方法，因为您事先不知道小数部分的位数。但是，正如@SingleNegationElimination 之前提到的，它不适用于所有情况（例如1.005）。这是我对此的看法：

```
#include <stdio.h>
#include <stdlib.h>

int main(void)
{
    char s_value[60], s_integral[60], s_fractional[60];
    int i, found = 0, count = 1, integral, fractional;

    scanf("%s", s_value);

    for (i = 0; s_value[i] != '\0'; i++)
    {
        if (!found)
        {
            if (s_value[i] == '.')
            {
                found = 1;
                s_integral[i] = '\0';
                continue;
            }
            s_integral[i] = s_value[i];
            count++;
        }
        else
            s_fractional[i - count] = s_value[i];
    }
    s_fractional[i - count] = '\0';

    integral = atoi(s_integral);
    fractional = atoi(s_fractional);
    printf("value = %s, integral = %d, fractional = %d\n",
        s_value, integral, fractional);

    return 0;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-11-27T05:47:01.473

这是另一种方式：

```
#include <stdlib.h>
int main()
{
    char* inStr = "123.4567";         //the number we want to convert
    char* endptr;                     //unused char ptr for strtod

    char* loc = strchr(inStr, '.');
    long mantissa = strtod(loc+1, endptr);
    long whole = strtod(inStr, endptr);

    printf("whole: %d \n", whole);     //whole number portion
    printf("mantissa: %d", mantissa);  //decimal portion

} 
```

[http://codepad.org/jyHoBALU](http://codepad.org/jyHoBALU)

输出：

```
whole: 123 
mantissa: 4567 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-04-13T07:01:33.757

```
float num;
int intgPart;
float fracPart;
printf("Enter the positive floating point number: ");
scanf("%f", &num);

intgPart = (int)num;
fracPart = num - intgPart; 
```

小数部分可以通过从原始 double 值中减去整数部分来获得。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-09-26T16:37:15.980

我做了这个功能，它似乎工作正常：

```
#include <math.h>

void GetFloattoInt (double fnum, long precision, long *pe, long *pd)
{
  long pe_sign;
  long intpart;
  float decpart;

  if(fnum>=0)
  {
    pe_sign=1;
  }
  else
  {
    pe_sign=-1;
  }

  intpart=(long)fnum;
  decpart=fnum-intpart;

  *pe=intpart;  
  *pd=(((long)(decpart*pe_sign*pow(10,precision)))%(long)pow(10,precision));
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-07-08T00:14:57.330

也许最好的办法是在数据为字符串格式时解决问题。如果你的数据是String，你可以根据小数点来解析。您将整数和小数部分提取为子字符串，然后将这些子字符串转换为实际整数。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-11-03T12:10:07.100

如果只想获取第一个十进制值，解决方法真的很简单。

**这是一个解释性示例：**

```
int leftSideOfDecimalPoint = (int) initialFloatValue; // The cast from float to int keeps only the integer part

int temp = (int) initialFloatValue * 10;
int rightSideOfDecimalPoint = temp % 10; 
```

例如，我们有一个初始浮点值 27.8 。

*   通过将初始浮点值转换为 int，您可以丢弃小数部分并仅保留整数部分。
*   通过将初始浮点值乘以 10，我们得到 278.0 的结果，然后通过将此结果转换为 int，得到 278 的值
*   如果我们将 278 除以 10，我们得到 27.8，余数为 8，即小数点右侧的值。因此使用模数。

然后可以使用此技术获取以下十进制字符，例如使用 100 而不是 10，依此类推。

* * *

请注意，如果您在实时系统上使用此技术，例如在 7 段显示器上显示它，它可能无法正常工作，因为我们正在与浮点值相乘，其中乘法需要大量开销时间。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-12-23T10:04:38.903

连我自己都在想怎么办。但我找到了办法。试试这个代码

```
printf("Enter a floating number");
scanf("%d%c%d", &no, &dot, &dec);
printf("Number=%d Decimal part=%d", no, dec); 
```

输出：-

```
Enter a floating number
23.13
Number=23 Decimal part=13 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-03-19T12:32:02.357

```
 #include <stdio.h>
Int main ()
{
float f=56.75;
int a=(int)f;
int result=(f-a)*100;
printf ("integer = %d\n decimal part to integer 
 =%d\n",result);
}
Output:- 
integer =56
decimal part to integer = 75 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-10-15T22:54:12.850

假设 A 是你的整数，那么 (int)A，表示将数字转换为整数，将是整数部分，另一个是 (A - (int)A)*10^n，这里 n 是要保留的小数位数.

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2017-02-14T14:02:45.213

```
cout<<"enter a decimal number\n";
cin>>str;
for(i=0;i<str.size();i++)
{
    if(str[i]=='.')
    break;
}

for(j=i+1;j<str.size();j++)
{
    cout<<str[j];
} 
```

# flash - Flash加载两次解决方法？

> ID：499949
> 
> 赞同：7
> 
> 时间：2009-02-01T01:02:27.147
> 
> 标签：flash, swfobject

在调查我的网站加载缓慢的报告问题时，我遇到了一个问题，我注意到（通过 firebug）我的 flash 文件加载了两次。

经过一番调查，我将其归结为一个[firefox 错误](https://bugzilla.mozilla.org/show_bug.cgi?id=438830)以及 SWFObject 2.0 的使用。

现在，我注意到有人提到您可以通过以下方式解决该问题：

> 仅供参考，如果您是网页开发人员，那么让您的页面与 FF3 一起使用的简单解决方法是延迟访问任何插件，直到您的页面完全加载之后。一个简单的方法是使用 window.setTimeout 安排你的插件脚本代码在所有待处理的浏览器事件之后运行，超时为零。

老实说，我不知道他们在说什么，希望有人能给我一个可行的代码示例。

您是否知道使这项工作正常进行的方法以及代码的外观？任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-01T01:15:30.600

```
<script>
  function loadswf()
  {
     swfobject.registerObject("myobj", "9.0.0");
  }
  function init() 
  {
     window.setTimeout("loadswf()", 0);
  }
</script>
<body onload="init()">

 <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="778" height="198" id="myobj">
    <param name="movie" value="style.swf">
    <param NAME=FlashVars VALUE="url={{stylelist}}">
      <!--[if !IE]>-->
      <object type="application/x-shockwave-flash" data="style.swf" width="778" height="198">
     <param name="flashvars" value="url={{stylelist}}">
    <!--<![endif]-->

    <a href="http://www.adobe.com/go/getflashplayer">
    <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" />
                    </a>
    <!--[if !IE]>-->
    </object>
    <!--<![endif]-->
 </object> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-03T20:33:11.730

确保您在响应中设置了 Cache 和 Expires 标头。我在对象标签中遇到了类似的问题，两次调用服务器。将 Expires 标头设置为在当前时间之后 5 秒会阻止第二次调用。高温高压

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-25T16:31:21.270

这也可能是由配置不正确的[CDN](http://en.wikipedia.org/wiki/Content_delivery_network)引起的，它们可能没有发送完整内容或抛出 206 或其他 http 错误。

# javascript - JQuery 事件抑制

> ID：499954
> 
> 赞同：0
> 
> 时间：2009-02-01T01:05:18.797
> 
> 标签：javascript, javascript-events, jquery

我有一个输入框，并且我已将模糊和按键事件绑定到输入。但问题是当有按键事件时，模糊事件也会触发。发生按键事件时，有什么方法可以抑制模糊事件？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T03:22:08.723

听起来您的 EventHandlerKeyPress() 函数中的某些内容正在引起模糊。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T19:26:18.120

我只是为了测试而稍微简化了您的代码，并且无法就事件触发的顺序得出相同的结论。Firebug 的控制台显示以下代码执行产生 .keypress 总是在 .blur 之前发生

```
<script>

    $(document).ready(function() {

        $("#inpt").blur(function(e) {
            console.log(".blur");
        });

        $("#inpt").keypress(function(e) {
            console.log(".keypress");
        });
    });

</script> 
```

您到底想用.onchange 和.keypress 绑定到同一个字段来完成什么？如果您也发布了事件处理程序代码，可能会有所帮助。

另外，你也有一个全局的 document.keypress 绑定，有什么特别的原因吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T01:51:28.047

```
<script src="jquery-1.3.1.js" type="text/javascript"></script>

<script type="text/javascript">

    $(document).ready(function() {

        $("#inpt").blur(function(e) {
            EventHandlerBlur(e);
        });
       $("#inpt").keypress(function(e) {
              EventHandlerKeyPress(e);
          });

          $(document).keypress(function(e) {
              EventHandlerKeyPress(e);
          });

    });
</script> 
```

这是具有相同行为的代码。实际上在输入输入/甚至按下输入框上的任何键时都会导致模糊事件在按键事件之前首先触发..

# c# - MaskedEditValidator DisplayMoney 不显示在复合控件中

> ID：499955
> 
> 赞同：0
> 
> 时间：2009-02-01T01:05:59.573
> 
> 标签：c#, asp.net, ajax, composite-controls

我正在创建一个具有 AJAX 功能的简单复合控件。尝试实现 MaskedEditValidator 时，DisplayMoney 属性不起作用。MaskedEdit 呈现，没有附加美元符号。有任何想法吗？这是我的代码：

```
protected override void OnInit(EventArgs e)
{
    base.OnInit(e);
    priceTextbox.ID = this.ID + "_price";
    quantityTextbox.ID = this.ID + "_quantity";
    timeTextbox.ID = this.ID + "_time";
    submitButton.ID = this.ID + "_submit";
    submitButton.Text = "Submit";
    priceMask.TargetControlID = priceTextbox.ClientID.ToString();
    priceMask.ID = priceMask.TargetControlID.ToString() + "_extender";
    priceMask.BehaviorID = "priceMaskExtender";
    priceMask.Mask = "99.99";
    priceMask.DisplayMoney = MaskedEditShowSymbol.Left;

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T03:27:37.430

尝试添加以下行：

```
priceMask.MaskType = MaskedEditType.Number; 
```

（可选）如果这是您想要的行为，则将 ClearMaskOnLostFocus 设置为 false （即使没有聚焦，它也会保留美元符号）。

DisplayMoney 属性设置器仅在 MaskType 等于 MaskedEditType.Number 时设置属性。

```
set
{
   if (MaskType == MaskedEditType.Number)
   {
     SetPropertyValue("DisplayMoney", value);
   }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T15:55:44.177

DisplayMoney 属性设置器仅在 MaskType 等于**MaskedEditType.Number**时设置属性。

```
set
{
   if (MaskType == MaskedEditType.Number)
   {
     SetPropertyValue("DisplayMoney", value);
   }
} 
```

所以你需要设置：

```
priceMask.MaskType = MaskedEditType.Number; 
```

# python - 如何在代码中创建 python 方法（签名和内容）？

> ID：499964
> 
> 赞同：4
> 
> 时间：2009-02-01T01:10:43.090
> 
> 标签：python, django, dynamic, methods, lambda

我创建了一个生成新类并将一些方法添加到类中的方法，但是有一个奇怪的错误，我不确定发生了什么：

```
def make_image_form(image_fields):
    ''' Takes a list of image_fields to generate images '''
    images = SortedDict()
    for image_name in image_fields:
        images[image_name] = forms.ImageField(required=False)
    new_form = type('ListingImagesForm2', (forms.BaseForm,), {'base_fields' : images})
    #now we add the validation methods to the class
    for image_name in image_fields:
       print "image name is: ", image_name
       setattr(new_form, 'clean_' + image_name, lambda self: self._clean_photo(image_name))
    #Add the _clean_photo method to the class
    setattr(new_form, '_clean_photo', _clean_photo)
    return new_form 
```

这是我的方法，它需要一个 image_fields 列表（我在 Django 中创建一个站点），它创建一大堆 ImageField 字段，并创建一个类 ListingImagesForm2，并将图像字段分配给该类。

问题在于创建方法，更具体地说是方法内容。

在循环：

```
for image_name in image_fields:
    print "image name is: ", image_name
    setattr(new_form, 'clean_' + image_name, lambda self: self._clean_photo(image_name)) 
```

方法签名已正确创建（例如 clean_pic_1、clean_pic_2...），但我认为 lambda 表达式存在问题，因为总是使用相同的图像名称调用 _clean_photo 方法（恰好是image_fields 列表）。

有没有比使用 lambda 表达式更好的方法来创建动态方法内容（代码）？

为什么我的 lambda 表达式只会将 for 循环中的最后一个 image_name 传递给 _clean_photo？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-01T01:23:47.010

对于在方法范围内定义的函数，Python 代码的行为与此类似。改用这个：

```
for image_name in image_fields:
    print "image name is: ", image_name
    setattr(new_form, 'clean_' + image_name, 
            lambda self, iname=image_name: self._clean_photo(iname)) 
```

默认关键字参数的使用使 Python 在创建 lambda 函数时记住它，而不是在调用时（当它总是取最后一个图像时）。

# http - ETag 与标头过期

> ID：499966
> 
> 赞同：366
> 
> 时间：2009-02-01T01:12:03.243
> 
> 标签：http, caching, etag, expires-header

我环顾四周，但无法确定是否应该同时使用 ETag**和**Expires Header**或**其中一个。

我正在尝试做的是确保我的闪存文件（和其他图像以及不仅在这些文件发生更改时更新）。

我不想做任何特别的事情，比如更改文件名或在 url 的末尾放置一些奇怪的字符以使其不被缓存。

另外，我需要在我的 PHP 脚本中以编程方式做些什么来支持这一点，还是全部是 Apache？

* * *

## 回答 #1

> 赞同：694
> 
> 时间：2009-02-01T03:18:16.717

它们略有不同 - ETag 没有任何信息可供客户端用于确定是否在将来再次请求该文件。如果 ETag 就是它所拥有的一切，它总是必须提出请求。但是，当服务器从客户端请求中读取 ETag 时，服务器可以确定是发送文件（HTTP 200）还是告诉客户端仅使用其本地副本（HTTP 304）。ETag 基本上只是一个文件的校验和，当文件的内容发生变化时，它会在语义上发生变化。

客户端（和代理/缓存）使用 Expires 标头来确定它是否甚至需要向服务器发出请求。越接近到期日期，客户端（或代理）就越有可能从服务器发出对该文件的 HTTP 请求。

因此，您真正想要做的是使用 BOTH 标头 - 根据内容更改的频率将 Expires 标头设置为合理的值。然后配置要发送的 ETag，这样当客户端向服务器发送请求时，它可以更容易地确定是否将文件发回。

关于 ETag 的最后一点说明 - 如果您使用负载平衡服务器设置和多台运行 Apache 的机器，您可能需要关闭 ETag 生成。这是因为 inode 被用作 ETag 哈希算法的一部分，这在服务器之间会有所不同。您可以将 Apache 配置为不使用 inode 作为计算的一部分，但是您需要确保文件上的时间戳完全相同，以确保为所有服务器生成相同的 ETag。

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2011-10-14T04:13:50.227

*Etag*和*Last-modified*标头是**验证器**。

它们帮助浏览器和/或缓存（反向代理）了解文件/页面是否已更改，即使它保留相同的名称。

*Expires*和*Cache-control*正在提供**刷新信息**。

这意味着它们会通知浏览器和反向中间代理，直到什么时间或多长时间，它们可以将页面/文件保留在其缓存中。

所以问题通常是使用哪个验证器，etag 或 last-modified，以及使用哪个刷新信息标头，过期或缓存控制。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2014-03-04T15:45:10.270

`Expires`并且`Cache-Control`是“强缓存标头”

`Last-Modified`并且`ETag`是“弱缓存标头”

首先浏览器检查`Expires/Cache-Control`确定是否向服务器发出请求

如果必须发出请求，它将发送`Last-Modified/ETag`HTTP 请求。如果`Etag`文档的值与之匹配，则服务器将发送 304 代码而不是 200，并且没有内容。浏览器将从其缓存中加载内容。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2014-07-17T17:43:16.300

另一个总结：

您需要同时使用两者。ETag 是“服务器端”信息。过期是“客户端”缓存。

*   除非您有负载平衡的服务器，否则请使用**ETag 。**它们是安全的，并且会让客户知道，每次您更改某些内容时，他们都应该获得服务器文件的新版本。

*   **Expires**一定要谨慎使用，如果你把过期日期设置在很远的将来，但又想立即更改其中一个文件（例如 JS 文件），有些用户可能要等很长时间才能获得修改后的版本！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-10-14T19:21:09.770

我还想提到的另一件事是，有些答案可能已经遗漏了，那就是在你的标题中同时包含两者`ETags`的缺点。`Expires/Cache-control`

根据您的需要，它可能只是在您的标头中添加额外的字节，这可能会增加数据包，这意味着更多的 TCP 开销。同样，您应该查看是否需要在标头中同时包含这两种内容的开销，或者它只会在您的请求中增加额外的权重，从而降低性能。

您可以在 Kyle Simpson 的这篇出色的博客文章中了解更多信息：http: [//calendar.perfplanet.com/2010/bloated-request-response-headers/](http://calendar.perfplanet.com/2010/bloated-request-response-headers/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-12-22T08:36:52.280

在我看来，使用 Expire Header，服务器可以告诉客户端我的数据何时会过时，而使用 Etag，服务器会检查客户端每个请求的 etag 值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-01-11T07:00:17.230

ETag 用于确定资源是否应使用副本。并且像Cache-Control这样的Expires Header被告知客户端在缓存几十年之前，客户端应该获取本地资源。

在现代站点中，通常会提供一个名为 hash 的文件，例如`app.98a3cf23.js`，因此使用 Expires Header 是一个很好的做法。除此之外，它还降低了网络成本。

希望能帮助到你 ;）

# perl - 如何确定几个字符串中最长的相似部分？

> ID：499967
> 
> 赞同：9
> 
> 时间：2009-02-01T01:12:10.810
> 
> 标签：perl, algorithm, string, similarity

根据标题，我正在尝试找到一种方法来以编程方式确定几个字符串之间的最长相似性部分。

例子：

*   `file:///home/gms8994/Music/t.A.T.u./`
*   `file:///home/gms8994/Music/nina%20sky/`
*   `file:///home/gms8994/Music/A%20Perfect%20Circle/`

理想情况下，我会回来`file:///home/gms8994/Music/`，因为这是所有 3 个字符串共有的最长部分。

具体来说，我正在寻找 Perl 解决方案，但任何语言（甚至伪语言）的解决方案就足够了。

来自评论：是的，只是在开始；但有可能在列表中有一些其他条目，对于这个问题将被忽略。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-01T09:56:21.890

**编辑：**我很抱歉弄错了。遗憾的是，我监督了`my`在内部使用变量`countit(x, q{})`是一个很大的错误。这个字符串在 Benchmark 模块中被评估，@str 在那里是空的。这个解决方案没有我提出的那么快。请参阅下面的更正。我再次感到抱歉。

Perl 可以很快：

```
use strict;
use warnings;

package LCP;

sub LCP {
    return '' unless @_;
    return $_[0] if @_ == 1;
    my $i          = 0;
    my $first      = shift;
    my $min_length = length($first);
    foreach (@_) {
        $min_length = length($_) if length($_) < $min_length;
    }
INDEX: foreach my $ch ( split //, $first ) {
        last INDEX unless $i < $min_length;
        foreach my $string (@_) {
            last INDEX if substr($string, $i, 1) ne $ch;
        }
    }
    continue { $i++ }
    return substr $first, 0, $i;
}

# Roy's implementation
sub LCP2 {
    return '' unless @_;
    my $prefix = shift;
    for (@_) {
        chop $prefix while (! /^\Q$prefix\E/);
        }
    return $prefix;
}

1; 
```

测试套件：

```
#!/usr/bin/env perl

use strict;
use warnings;

Test::LCP->runtests;

package Test::LCP;

use base 'Test::Class';
use Test::More;
use Benchmark qw(:all :hireswallclock);

sub test_use : Test(startup => 1) {
    use_ok('LCP');
}

sub test_lcp : Test(6) {
    is( LCP::LCP(),      '',    'Without parameters' );
    is( LCP::LCP('abc'), 'abc', 'One parameter' );
    is( LCP::LCP( 'abc', 'xyz' ), '', 'None of common prefix' );
    is( LCP::LCP( 'abcdefgh', ('abcdefgh') x 15, 'abcdxyz' ),
        'abcd', 'Some common prefix' );
    my @str = map { chomp; $_ } <DATA>;
    is( LCP::LCP(@str),
        'file:///home/gms8994/Music/', 'Test data prefix' );
    is( LCP::LCP2(@str),
        'file:///home/gms8994/Music/', 'Test data prefix by LCP2' );
    my $t = countit( 1, sub{LCP::LCP(@str)} );
    diag("LCP: ${\($t->iters)} iterations took ${\(timestr($t))}");
    $t = countit( 1, sub{LCP::LCP2(@str)} );
    diag("LCP2: ${\($t->iters)} iterations took ${\(timestr($t))}");
}

__DATA__
file:///home/gms8994/Music/t.A.T.u./
file:///home/gms8994/Music/nina%20sky/
file:///home/gms8994/Music/A%20Perfect%20Circle/ 
```

测试套件结果：

```
1..7
ok 1 - use LCP;
ok 2 - Without parameters
ok 3 - One parameter
ok 4 - None of common prefix
ok 5 - Some common prefix
ok 6 - Test data prefix
ok 7 - Test data prefix by LCP2
# LCP: 22635 iterations took 1.09948 wallclock secs ( 1.09 usr +  0.00 sys =  1.09 CPU) @ 20766.06/s (n=22635)
# LCP2: 17919 iterations took 1.06787 wallclock secs ( 1.07 usr +  0.00 sys =  1.07 CPU) @ 16746.73/s (n=17919) 
```

这意味着在您的测试用例中，使用纯 Perl 解决方案`substr`比[Roy 的解决方案快大约 20%，并且查找一个前缀大约需要 50us。](https://stackoverflow.com/questions/499967/programmatically-determining-the-longest-similar-portion-of-several-strings/500100#500100)除非您的数据或性能期望更大，否则没有必要使用 XS。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-01T03:15:38.860

Brett Daniel 已经为 Wikipedia entry on " [Longest common substring problem](http://en.wikipedia.org/wiki/Longest_common_substring_problem) " 给出的参考是非常好的通用参考（带有伪代码），如您所述。然而，该算法可以是指数的。看起来你实际上可能想要一个最长公共前缀的算法，这是一个更简单的算法。

这是我用于最长公共前缀的一个（以及对原始 URL 的引用）：

```
use strict; use warnings;
sub longest_common_prefix {
    # longest_common_prefix( $|@ ): returns $
    # URLref: http://linux.seindal.dk/2005/09/09/longest-common-prefix-in-perl
    # find longest common prefix of scalar list
    my $prefix = shift;
    for (@_) {
        chop $prefix while (! /^\Q$prefix\E/);
        }
    return $prefix;
}

my @str = map {chomp; $_} <DATA>;
print longest_common_prefix(@ARGV), "\n";
__DATA__
file:///home/gms8994/Music/t.A.T.u./
file:///home/gms8994/Music/nina%20sky/
file:///home/gms8994/Music/A%20Perfect%20Circle/ 
```

如果您真的想要 LCSS 实现，请参阅 PerlMonks.org 上的这些讨论（[最长公共子字符串](http://www.perlmonks.org/?node_id=659792)和[最长](http://www.perlmonks.org/?node=Longest+Common+Subsequence)公共子序列）。Tree::Suffix 可能是您最好的通用解决方案，据我所知，它实现了最好的算法。不幸的是，最近的构建被破坏了。[但是，在Limbic~Region](http://www.perlmonks.org/?node_id=549876)的这篇文章中 PerlMonks 所引用的讨论中确实存在一个工作子例程（在此处与您的数据一起转载）。

```
#URLref: http://www.perlmonks.org/?node_id=549876
#by Limbic~Region
use Algorithm::Loops 'NestedLoops';
use List::Util 'reduce';

use strict; use warnings;

sub LCS{
    my @str = @_;
    my @pos;
    for my $i (0 .. $#str) {
        my $line = $str[$i];
        for (0 .. length($line) - 1) {
            my $char= substr($line, $_, 1);
            push @{$pos[$i]{$char}}, $_;
        }
    }
    my $sh_str = reduce {length($a) < length($b) ? $a : $b} @str;
    my %map;
    CHAR:
    for my $char (split //, $sh_str) {
        my @loop;
        for (0 .. $#pos) {
            next CHAR if ! $pos[$_]{$char};
            push @loop, $pos[$_]{$char};
        }
        my $next = NestedLoops([@loop]);
        while (my @char_map = $next->()) {
            my $key = join '-', @char_map;
            $map{$key} = $char;
        }
    }
    my @pile;
    for my $seq (keys %map) {
        push @pile, $map{$seq};
        for (1 .. 2) {
            my $dir = $_ % 2 ? 1 : -1;
            my @offset = split /-/, $seq;
            $_ += $dir for @offset;
            my $next = join '-', @offset;
            while (exists $map{$next}) {
                $pile[-1] = $dir > 0 ?
                    $pile[-1] . $map{$next} : $map{$next} . $pile[-1];
                $_ += $dir for @offset;
                $next = join '-', @offset;
            }
        }
    }
    return reduce {length($a) > length($b) ? $a : $b} @pile;
}

my @str = map {chomp; $_} <DATA>;
print LCS(@str), "\n";
__DATA__
file:///home/gms8994/Music/t.A.T.u./
file:///home/gms8994/Music/nina%20sky/
file:///home/gms8994/Music/A%20Perfect%20Circle/ 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-01T01:38:42.567

听起来您想要[k-common substring algorithm](http://en.wikipedia.org/wiki/Longest_common_substring_problem)。它的编程非常简单，是动态编程的一个很好的例子。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-01T01:48:22.937

我的第一直觉是运行一个循环，从每个字符串中取出下一个字符，直到字符不相等。记下您在字符串中的位置，然后从 0 到字符不相等之前的位置取一个子字符串（来自三个字符串中的任何一个）。

在 Perl 中，您必须先将字符串拆分为使用类似的字符

`@array = split(//, $string);`

（拆分一个空字符将每个字符设置为它自己的数组元素）

然后做一个循环，也许是整体：

```
$n =0;
@array1 = split(//, $string1);
@array2 = split(//, $string2);
@array3 = split(//, $string3);

while($array1[$n] == $array2[$n] && $array2[$n] == $array3[$n]){
 $n++; 
}

$sameString = substr($string1, 0, $n); #n might have to be n-1 
```

或者至少是类似的东西。如果这不起作用，请原谅我，我的 Perl 有点生锈了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-01T01:40:45.807

如果你在谷歌上搜索“最长的公共子字符串”，你会得到一些关于序列不必从字符串开头开始的一般情况的好指针。例如，[http](http://en.wikipedia.org/wiki/Longest_common_substring_problem) ://en.wikipedia.org/wiki/Longest_common_substring_problem 。

Mathematica 恰好有一个内置的函数： [http](http://reference.wolfram.com/mathematica/ref/LongestCommonSubsequence.html) ://reference.wolfram.com/mathematica/ref/LongestCommonSubsequence.html （注意它们的意思是*连续的*子序列，即子串，这就是你想要的。）

如果您只关心最长的公共前缀，那么将 for i 从 0 循环到第 i 个字符不全部匹配并返回 substr(s, 0, i-1) 应该会快得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-01T12:00:58.503

来自[http://forums.macosxhints.com/showthread.php?t=33780](http://forums.macosxhints.com/showthread.php?t=33780)

```
my @strings =
    (
      'file:///home/gms8994/Music/t.A.T.u./',
      'file:///home/gms8994/Music/nina%20sky/',
      'file:///home/gms8994/Music/A%20Perfect%20Circle/',
    );

my $common_part = undef;
my $sep = chr(0);  # assuming it's not used legitimately
foreach my $str ( @strings ) {

    # First time through loop -- set common
    # to whole
    if ( !defined $common_part ) {
        $common_part = $str;
        next;
    }

    if ("$common_part$sep$str" =~ /^(.*).*$sep\1.*$/)
    {
        $common_part = $1;
    }
}

print "Common part = $common_part\n"; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-02-28T21:15:45.823

比上面更快，使用 perl 的本机二进制 xor 函数，改编自 perlmongers 解决方案（ $+[0] 对我不起作用）：

```
sub common_suffix {
    my $comm = shift @_;
    while ($_ = shift @_) {
        $_ = substr($_,-length($comm)) if (length($_) > length($comm));
        $comm = substr($comm,-length($_)) if (length($_) < length($comm));
        if (( $_ ^ $comm ) =~ /(\0*)$/) {
            $comm = substr($comm, -length($1));
        } else {
            return undef;
        }
    }
    return $comm;
}

sub common_prefix {
    my $comm = shift @_;
    while ($_ = shift @_) {
        $_ = substr($_,0,length($comm)) if (length($_) > length($comm));
        $comm = substr($comm,0,length($_)) if (length($_) < length($comm));
        if (( $_ ^ $comm ) =~ /^(\0*)/) {
            $comm = substr($comm,0,length($1));
        } else {
            return undef;
        }
    }
    return $comm;
} 
```

# apache - 为什么 mod_rewrite 会重写两次？

> ID：499970
> 
> 赞同：1
> 
> 时间：2009-02-01T01:17:52.107
> 
> 标签：apache, mod-rewrite, url-rewriting

[我最近才发现有关 URL 重写](https://stackoverflow.com/questions/180007/how-do-configure-optional-or-extraneous-urls)的知识，所以我还有很多东西要学。

在遵循[Easy Mod Rewrite](http://www.easymodrewrite.com/)教程时，他们的其中一个示例的结果确实让我感到困惑。

```
RewriteBase /
RewriteRule (.*) index.php?page=$1 [QSA,L] 
```

重写**`/home`**为**`/index.php?page=index.php&page=home`**.

我认为重复可能是由我的主机配置中的某些东西引起的，但是[XAMPP](http://www.apachefriends.org/en/xampp-windows.html#646)的全新安装也是如此。

那么，有谁知道为什么这似乎解析了两次？

而且，在我看来，如果要这样做，那将是一个无限循环——为什么它会在 2 个循环时停止？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T01:28:16.800

[来自此页面](http://web.archive.org/web/20090302114812/http://easymodrewrite.com/notes-last)上的示例 1 ，这是您问题中链接的教程的一部分：

> 假设您使用的 CMS 系统将对所有内容的请求重写为单个 index.php 脚本。
> 
> ```
> RewriteRule ^(.*)$ index.php?PAGE=$1 [L,QSA] 
> ```
> 
> 然而，每次运行时，无论您请求哪个文件，PAGE 变量始终包含“index.php”。
> 
> 为什么？您最终将进行两次重写。首先，您请求**test.php**。这被重写为**index.php?PAGE=test.php**。现在对**index.php?PAGE=test.php**发出第二个请求。这仍然与您的重写模式匹配，并反过来被重写为**index.php?PAGE=index.php**。
> 
> 一种解决方案是添加一个 RewriteCond 来检查文件是否已经是“index.php”。还允许您将图像和 CSS 文件保存在同一目录中的更好解决方案是使用 RewriteCond 来检查文件是否存在，使用 -f。

* * *

¹该链接指向 Internet 存档，因为教程网站似乎已离线

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T12:26:34.100

从[Apache 模块 mod_rewrite 文档](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewriteflags)：

> **'last|L' (last rule)**
> [...] 如果`RewriteRule`生成内部重定向 [...] 这将重新注入请求并导致从第一个开始重复处理`RewriteRule`。

为了防止这种情况，您可以使用附加`RewriteCond`指令：

```
RewriteCond %{REQUEST_URI} !^/index\.php$
RewriteRule (.*) index.php?page=$1 [QSA,L] 
```

或者您将模式更改为不匹配`index.php`并使用该`REQUEST_URI`变量，无论是在重定向中还是稍后在 PHP ( [`$_SERVER['REQUEST_URI']`](http://docs.php.net/manual/en/reserved.variables.server.php)) 中。

```
RewriteRule !^index\.php$ index.php?page=%{REQUEST_URI} [QSA,L] 
```

# command-line - PowerShell：你能挂钩或拦截外部应用程序的 PowerShell 执行吗？

> ID：499974
> 
> 赞同：2
> 
> 时间：2009-02-01T01:21:39.870
> 
> 标签：command-line, powershell, user-interface

我想在执行任何外部控制台应用程序（设置一些环境变量）之前做一些内务处理。

在我的网络研究中，看起来覆盖 $host 中的 NotifyBeginApplication() 可能会奏效。不幸的是，我不知道该怎么做。

这基本上就是我想要做的......

```
$host = $host | `
   Add-Member -force -pass -mem scriptmethod NotifyBeginApplication `
   { $env:_startTime = [datetime]::now; $env:_line = $myInvocation.Line } 
```

这不起作用，因为 $host 是恒定的，无论如何它可能是错误的方法。

我能够找到的文档指出，在执行任何“旧”控制台应用程序之前调用此函数，但另一个博客条目说它仅用于没有 I/O 重定向的控制台应用程序。

那么，这是正确的方法吗？如果是这样，我将如何覆盖该功能？

如果没有，怎么可能做到这一点？

我见过的唯一可行的选择是完全实现自定义 PSHost。使用现有的可用源代码，这似乎是可能的，但超出了我想要尝试的范围。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-10T07:03:03.950

如果这是您可以修改的代码，则创建此函数：

```
Function call {
    ## Set environment here
    $env:FOO = "BAR"
    Invoke-Expression "$args"
} 
```

现在将您的本机命令传递给 call 函数。例子：

```
call cmd /c set
call cmd /c dir
call somefunkyexe /blah -ooo aaah -some:`"Funky Argument`" 
```

如果这是您无法修改的代码，那么事情将变得复杂。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-02T19:02:16.937

我也同意您的（不幸的）结论，即您需要创建自己的自定义主机来处理此问题。

您可以通过脚本轻松创建额外的运行空间，但是在您当前运行的主机（默认控制台）中无法访问此方法。

# windows - 如何在 Windows 服务 (XP) 中使用 WC 3.5 ReciveActivity 对 WF 的托管进行编码？

> ID：499977
> 
> 赞同：0
> 
> 时间：2009-02-01T01:23:07.153
> 
> 标签：windows, wcf, service, hosting, workflow-foundation

我创建了一个小型 VS 解决方案，其中包括带有 WCF ReceiveActivity 项目的 WF（使用 basicHttpBinding）和一些普通的 C# 服务。当使用 WCFTestClient 从 VS 2008 进行测试时，它们都可以正常工作。

我将它们部署到单个 Windows 服务中。除 WF 服务外，其他所有服务都可以正常工作。我花了 6 个小时浏览，但没有找到有效的解决方案。请帮忙。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T08:08:13.573

您应该使用 WorkflowServiceHost 而不是普通的 ServiceHost。WorkflowServiceHost 执行所有常见的 WCF 相关工作，但也确保创建工作流运行时并设置所需的工作流路由环境。

有关如何执行此操作，请参阅[此博客文章。](http://msmvps.com/blogs/theproblemsolver/archive/2008/03/19/receiveactivity-and-self-hosting-wcf.aspx)这[第二篇文章](http://msmvps.com/blogs/theproblemsolver/archive/2008/03/20/configuring-a-self-hosted-receiveactivity-and-its-runtime.aspx)展示了更多关于如何更改配置的信息。

顺便提一句。通常，您应该使用 basicHttpContextBinding 和 wsHttpContextBinding 之类的上下文绑定，因为它们通过消息传递包含工作流 instanceId 的上下文信息。

# .net - 如何访问设置期间输入的信息？（VS2008安装工程）

> ID：499987
> 
> 赞同：0
> 
> 时间：2009-02-01T01:36:39.760
> 
> 标签：.net, visual-studio, installation, windows-installer, project

我在带有文本框的安装 UI 中添加了一个简单的对话框窗口。如何找出用户输入的内容？

@米奇小麦：谢谢。在您的帮助下，我设法解决了这个问题。我需要使用自定义操作的 CustomActionData 属性。

![自定义动作数据](https://www.codeproject.com/KB/install/SetupAndDeployment/AddCustomActionDataValue.JPG)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T08:39:09.177

当您说“使用文本框向安装的 UI 添加了一个简单的对话框窗口”时，我假设您添加了一个自定义操作和关联的安装程序类。

此[MSDN 文章](http://msdn.microsoft.com/en-us/library/d9k65z2d.aspx)中的此片段显示了如何：

**创建自定义操作**

1.  在文件菜单上，指向新建，然后单击项目。

2.  在“新建项目”对话框中，在“项目类型”窗格中选择 Visual Basic，然后在“模板”窗格中选择“类库”。在名称框中，键入 PassData。

该项目被添加到解决方案资源管理器。

**创建安装程序类**

1.  在项目菜单上，单击添加类。

    在添加新项目对话框中，选择安装程序类。接受默认名称。

2.  当安装程序类出现在设计图面上时，右键单击设计图面并单击查看代码以在代码编辑器中查看文件内容。

3.  添加以下过程以覆盖基类的安装过程

    ```
    Public Overrides Sub Install(ByVal stateSaver As System.Collections.IDictionary)  
        MyBase.Install(stateSaver) 
        Dim myInput As String = Me.Context.Parameters.Item("Message") 
        If myInput Is Nothing Then 
            myInput = "There was no message specified"  
        End If 
        MsgBox(myInput) 
    End Sub 
    ```

# php - Mysql MediumText导致PHP致命错误：允许的内存大小为8388608字节已用完

> ID：499989
> 
> 赞同：1
> 
> 时间：2009-02-01T01:39:04.063
> 
> 标签：php, memory-management

我有我自己的包装 mysqli 库的 php 数据对象类。它可以很好地处理大多数数据类型，包括文本。一旦我将表格列从文本更改为中文本，我就会收到此问题标题中描述的错误。我已经在几个共享托管环境中测试了我的 php 脚本，但我只在其中一个环境中遇到了这个错误。

MediumText 和 LongText 真的会占用那么多内存吗？

我将开始优化我的 php 类，但我想确保我在正确的轨道上..

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T02:28:44.743

mediumtext 最多可以容纳 16777215，如[http://dev.mysql.com/doc/refman/5.0/en/storage-requirements.html中所指定](http://dev.mysql.com/doc/refman/5.0/en/storage-requirements.html)

这似乎大于 php 定义的内存限制。所以这是有道理的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T02:53:48.500

mediumtext 和 longtext 字段可能包含这么多信息。您只是更改列类型，还是更改列类型然后将其塞满文本？如果是前者，我的猜测是有一些失控的循环/递归正在构建一堆对象/数组/某些东西，而你正在达到 PHP 的默认内存上限。

您可以通过 php.ini 控制分配给 PHP 的内存量，也可以使用 ini_set 函数在运行时设置值。

```
ini_set("memory_limit","12M"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T02:54:52.943

该托管服务提供商可能将 PHP 设置为仅允许脚本使用 8 兆字节的内存。

> memory_limit = 8M ; 脚本可能消耗的最大内存量

您可以使用 phpinfo() 检查设置为什么，使用以下内容创建一个脚本，上传它并将您的网络浏览器指向它（确保在完成后将其删除，因为它会泄露潜在的敏感信息）：

> <?php
> 
> phpinfo()
> 
> ?>

在底部寻找“memory_limit”。如果它设置为 8 兆字节，那是你的问题。

# algorithm - 如何验证二叉搜索树？

> ID：499995
> 
> 赞同：64
> 
> 时间：2009-02-01T01:41:38.987
> 
> 标签：algorithm, data-structures, binary-search-tree

我在这里阅读了一个称为验证二叉搜索树的面试练习。

这究竟是如何工作的？在验证二叉搜索树时会寻找什么？我写了一个基本的搜索树，但从未听说过这个概念。

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-04-17T10:11:06.653

事实上，这是每个人在面试时都会犯的错误。

Leftchild 必须检查 (minLimitof node,node.value)

Rightchild 必须检查 (node.value,MaxLimit of node)

```
IsValidBST(root,-infinity,infinity);

bool IsValidBST(BinaryNode node, int MIN, int MAX) 
{
     if(node == null)
         return true;
     if(node.element > MIN 
         && node.element < MAX
         && IsValidBST(node.left,MIN,node.element)
         && IsValidBST(node.right,node.element,MAX))
         return true;
     else 
         return false;
} 
```

另一种解决方案（如果空间不是约束）：对树进行中序遍历并将节点值存储在数组中。如果数组按排序顺序，则它是有效的 BST，否则不是。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-01T01:44:48.403

“验证”二叉搜索树意味着您检查它是否确实在左侧有所有较小的项目，在右侧有大项目。本质上，它是检查二叉树是否是二叉**搜索**树。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-06-06T07:14:30.277

我找到的最佳解决方案是 O(n)，它不使用额外的空间。它类似于中序遍历，但不是将其存储到数组然后检查它是否已排序，我们可以使用静态变量并在中序遍历时检查数组是否已排序。

```
static struct node *prev = NULL;

bool isBST(struct node* root)
{
    // traverse the tree in inorder fashion and keep track of prev node
    if (root)
    {
        if (!isBST(root->left))
          return false;

        // Allows only distinct valued nodes
        if (prev != NULL && root->data <= prev->data)
          return false;

        prev = root;

        return isBST(root->right);
    }

    return true;
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-04-29T21:35:02.607

使用中序遍历的迭代解决方案。

```
bool is_bst(Node *root) {
  if (!root)
    return true;

  std::stack<Node*> stack;
  bool started = false;
  Node *node = root;
  int prev_val;

  while(true) {
    if (node) {
      stack.push(node);
      node = node->left();
      continue;
    }
    if (stack.empty())
      break;
    node = stack.top();
    stack.pop();

    /* beginning of bst check */
    if(!started) {
      prev_val = node->val();
      started = true;
    } else {
      if (prev_val > node->val())
        return false;
      prev_val = node->val();
    }
    /* end of bst check */

    node = node->right();
  }
  return true;
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-01-08T07:30:45.653

这是我在 Clojure 中的解决方案：

```
(defstruct BST :val :left :right)

(defn in-order [bst]
  (when-let [{:keys [val, left, right]} bst]
    (lazy-seq
      (concat (in-order left) (list val) (in-order right)))))

(defn is-strictly-sorted? [col]
  (every?
    (fn [[a b]] (< a  b))
    (partition 2 1 col)))

(defn is-valid-BST [bst]
  (is-strictly-sorted? (in-order bst))) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-10-18T19:13:42.440

由于BST的中序遍历是一个非递减序列，我们可以利用这个性质来判断二叉树是否是BST。使用[Morris 遍历](https://en.wikipedia.org/wiki/Tree_traversal#Morris_in-order_traversal_using_threading)和维护`pre`节点，我们可以得到**O(n) 时间和 O(1) 空间**复杂度的解。这是我的代码

```
public boolean isValidBST(TreeNode root) {
    TreeNode pre = null, cur = root, tmp;
    while(cur != null) {
        if(cur.left == null) {
            if(pre != null && pre.val >= cur.val) 
                return false;
            pre = cur;
            cur = cur.right;
        }
        else {
            tmp = cur.left;
            while(tmp.right != null && tmp.right != cur)
                tmp = tmp.right;
            if(tmp.right == null) { // left child has not been visited
                tmp.right = cur;
                cur = cur.left;
            }
            else { // left child has been visited already
                tmp.right = null;
                if(pre != null && pre.val >= cur.val) 
                    return false;
                pre = cur;
                cur = cur.right;
            }
        }
    }
    return true;
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-12-26T18:04:50.303

这是我在 python 中的答案，它在**hackerrank 网站上解决了所有的极端情况并经过了很好的测试**

```
""" Node is defined as
class node:
    def __init__(self, data):
        self.data = data
        self.left = None
        self.right = None
"""

def checkBST(root):
    return checkLeftSubTree(root, root.left) and checkRightSubTree(root, root.right)

def checkLeftSubTree(root, subTree):
    if not subTree:
        return True
    else:
        return root.data > subTree.data \
        and checkLeftSubTree(root, subTree.left) \ 
        and checkLeftSubTree(root, subTree.right) \
        and checkLeftSubTree(subTree, subTree.left) \
        and checkRightSubTree(subTree, subTree.right)

def checkRightSubTree(root, subTree):
    if not subTree:
        return True
    else:
        return root.data < subTree.data \ 
        and checkRightSubTree(root, subTree.left) \
        and checkRightSubTree(root, subTree.right) \
        and checkRightSubTree(subTree, subTree.right) \
        and checkLeftSubTree(subTree, subTree.left) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-12-10T05:21:03.627

我最近在电话采访中得到了这个问题，并且比我应该做的更挣扎。我试图跟踪子节点中的最小值和最大值，但在面试的压力下，我无法将我的大脑包裹在不同的案例中。

昨晚睡着的时候想了想，意识到这就像在中序遍历期间跟踪您访问过的最后一个节点一样简单。在 Java 中：

```
public <T extends Comparable<T>> boolean isBst(TreeNode<T> root) {
    return isBst(root, null);
}

private <T extends Comparable<T>> boolean isBst(TreeNode<T> node, TreeNode<T> prev) {
    if (node == null)
        return true;

    if (isBst(node.left, prev) && (prev == null || prev.compareTo(node) < 0 ))
        return isBst(node.right, node);

    return false;
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-02-13T20:08:59.407

```
bool BinarySearchTree::validate() {
    int minVal = -1;
    int maxVal = -1;
    return ValidateImpl(root, minVal, maxVal);
}

bool BinarySearchTree::ValidateImpl(Node *currRoot, int &minVal, int &maxVal)
{
    int leftMin = -1;
    int leftMax = -1;
    int rightMin = -1;
    int rightMax = -1;

    if (currRoot == NULL) return true;

    if (currRoot->left) {
        if (currRoot->left->value < currRoot->value) {
            if (!ValidateImpl(currRoot->left, leftMin, leftMax)) return false;
            if (leftMax != currRoot->left->value && currRoot->value < leftMax)  return false;
        }
        else
            return false;
    } else {
        leftMin = leftMax = currRoot->value;
    }

    if (currRoot->right) {
        if (currRoot->right->value > currRoot->value) {
            if(!ValidateImpl(currRoot->right, rightMin, rightMax)) return false;
            if (rightMin != currRoot->right->value && currRoot->value > rightMin)  return false;
        }
        else return false;
    } else {
        rightMin = rightMax = currRoot->value;
    }

    minVal = leftMin < rightMin ? leftMin : rightMin;
    maxVal = leftMax > rightMax ? leftMax : rightMax;

    return true;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-03-30T08:07:46.747

“最好先定义一个不变量。这里的不变量是——中序遍历中BST的任何两个顺序元素必须严格按照它们出现的顺序增加（不能相等，总是按顺序增加） “

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-09-10T05:03:22.930

在 Java 中并允许在任一子树中具有相同值的节点：

```
public boolean isValid(Node node) {
    return isValid(node, Integer.MIN_VALUE, Integer.MAX_VALUE);
}

private boolean isValid(Node node, int minLimit, int maxLimit) {
    if (node == null)
        return true;
    return minLimit <= node.value && node.value <= maxLimit
            && isValid(node.left, minLimit, node.value)
            && isValid(node.right, node.value, maxLimit);
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-06-13T17:16:50.940

要确定给定的 BT 是否是任何数据类型的 BST，您需要采用以下方法。1\. 使用中序遍历调用递归函数直到叶节点结束 2\. 自己构建最小值和最大值。

树元素必须具有小于/大于定义的运算符。

```
#define MIN (FirstVal, SecondVal) ((FirstVal) < (SecondVal)) ? (FirstVal):(SecondVal)
#define MAX (FirstVal, SecondVal) ((FirstVal) > (SecondVal)) ? (FirstVal):(SecondVal)

template <class T>
bool IsValidBST (treeNode &root)
{

   T min,  max;
   return IsValidBST (root, &min, &max);
}

template <class T>
bool IsValidBST (treeNode *root, T *MIN , T *MAX)
{
   T leftMin, leftMax, rightMin, rightMax;
   bool isValidBST;

   if (root->leftNode == NULL && root->rightNode == NULL)
   {
      *MIN = root->element;
      *MAX = root->element;
      return true;
   }

  isValidBST = IsValidBST (root->leftNode, &leftMin, &leftMax);

  if (isValidBST)
    isValidBST = IsValidBST (root->rightNode, &rightMin, &rightMax);

  if (isValidBST)
  {
     *MIN = MIN (leftMIN, rightMIN);
     *Max = MAX (rightMax, leftMax);
  }

  return isValidBST;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-02-16T02:25:50.367

我编写了一个使用 inorder Traversal BST 的解决方案，并检查节点是否按空间`O(1)`和时间递增顺序`O(n)`。`TreeNode predecessor`是上一个节点。我不确定解决方案是否正确。因为中序遍历不能定义一整棵树。

```
public boolean isValidBST(TreeNode root, TreeNode predecessor) {
    boolean left = true, right = true;
    if (root.left != null) {
        left = isValidBST(root.left, predecessor);
    }
    if (!left)
        return false;

    if (predecessor.val > root.val)
        return false;

    predecessor.val = root.val;
    if (root.right != null) {
        right = isValidBST(root.right, predecessor);
    }

    if (!right)
        return false;

    return true;

} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-11-04T06:20:46.567

递归很容易，但迭代方法更好，上面有一个迭代版本，但它过于复杂。这是您在任何地方都能找到的**最佳**解决方案：`c++`

该算法在`O(N)`时间上运行并且需要`O(lgN)`空间。

```
struct TreeNode
{
    int value;
    TreeNode* left;
    TreeNode* right;
};

bool isBST(TreeNode* root) {
    vector<TreeNode*> stack;
    TreeNode* prev = nullptr;
    while (root || stack.size()) {
        if (root) {
           stack.push_back(root);
           root = root->left;
        } else {
            if (prev && stack.back()->value <= prev->value)
                return false;
            prev = stack.back();
            root = prev->right;                    
            stack.pop_back();
        }
    }
    return true;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-01-18T05:58:27.073

以下是 BST 验证的 Java 实现，我们按顺序遍历树 DFS，如果我们得到任何大于最后一个数字的数字，它将返回 false。

```
static class BSTValidator {
  private boolean lastNumberInitialized = false;
  private int lastNumber = -1;

  boolean isValidBST(TreeNode node) {
    if (node.left != null && !isValidBST(node.left)) return false;

    // In-order visiting should never see number less than previous
    // in valid BST.
    if (lastNumberInitialized && (lastNumber > node.getData())) return false;
    if (!lastNumberInitialized) lastNumberInitialized = true;

    lastNumber = node.getData();

    if (node.right != null && !isValidBST(node.right)) return false;

    return true;
  }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-05-20T02:33:14.883

```
bool ValidateBST(Node *pCurrentNode, int nMin = INT_MIN, int nMax = INT_MAX)
{
    return
    (
        pCurrentNode == NULL
    )
    ||
    (
        (
            !pCurrentNode->pLeftNode ||
            (
                pCurrentNode->pLeftNode->value < pCurrentNode->value &&
                pCurrentNode->pLeftNode->value < nMax &&
                ValidateBST(pCurrentNode->pLeftNode, nMin, pCurrentNode->value)
            )
        )
        &&
        (
            !pCurrentNode->pRightNode ||
            (
                pCurrentNode->pRightNode->value > pCurrentNode->value &&
                pCurrentNode->pRightNode->value > nMin &&
                ValidateBST(pCurrentNode->pRightNode, pCurrentNode->value, nMax)
            )
        )
    );
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-06-28T10:24:40.233

```
bool isBST(struct node* root)
{
    static struct node *prev = NULL;
    // traverse the tree in inorder fashion and keep track of prev node
    if (root)
    {
        if (!isBST(root->left))
            return false;
        // Allows only distinct valued nodes
        if (prev != NULL && root->data <= prev->data)
            return false;
        prev = root;
        return isBST(root->right);
    }
    return true;
} 
```

工作正常 ：）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-09-05T15:36:44.403

递归解决方案：

```
isBinary(root)
    {
        if root == null 
          return true
       else if( root.left == NULL and root.right == NULL)
          return true
       else if(root.left == NULL)
           if(root.right.element > root.element)
               rerturn isBInary(root.right)
        else if (root.left.element < root.element)
              return isBinary(root.left)
        else
              return isBInary(root.left) and isBinary(root.right)

    } 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-12-15T14:44:33.010

迭代解决方案。

```
private static boolean checkBst(bst node) {

    Stack<bst> s = new Stack<bst>();
    bst temp;
    while(node!=null){
        s.push(node);
        node=node.left;
    }
    while (!s.isEmpty()){
        node = s.pop();
        System.out.println(node.val);
        temp = node;
        if(node.right!=null){
            node = node.right;
            while(node!=null)
            {
                //Checking if the current value is lesser than the previous value and ancestor.
                if(node.val < temp.val)
                    return false;
                if(!s.isEmpty())
                    if(node.val>s.peek().val)
                        return false;
                s.push(node);
                if(node!=null)
                node=node.left;
            }
        }
    }
    return true;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2012-02-14T09:34:54.780

```
// using inorder traverse based Impl
bool BinarySearchTree::validate() {
    int val = -1;
    return ValidateImpl(root, val);
}

// inorder traverse based Impl
bool BinarySearchTree::ValidateImpl(Node *currRoot, int &val) {
    if (currRoot == NULL) return true;

    if (currRoot->left) {
        if (currRoot->left->value > currRoot->value) return false;
        if(!ValidateImpl(currRoot->left, val)) return false;
    }

    if (val > currRoot->value) return false;
    val = currRoot->value;

    if (currRoot->right) {
        if (currRoot->right->value < currRoot->value) return false;
        if(!ValidateImpl(currRoot->right, val)) return false;
    }
    return true;
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-03-25T08:16:53.463

这适用于重复项。

```
// time O(n), space O(logn)
// pseudocode
is-bst(node, min = int.min, max = int.max):
    if node == null:
        return true
    if node.value <= min || max < node.value:
        return false
    return is-bst(node.left, min, node.value)
        && is-bst(node.right, node.value, max) 
```

这甚至适用于`int.min`和`int.max`使用`Nullable`类型的值。

```
// time O(n), space O(logn)
// pseudocode
is-bst(node, min = null, max = null):
    if node == null:
        return true
    if min != null && node.value <= min
        return false
    if max != null && max < node.value:
        return false
    return is-bst(node.left, min, node.value)
        && is-bst(node.right, node.value, max) 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2018-01-15T19:12:41.250

一个班轮

```
bool is_bst(Node *root, int from, int to) {
   return (root == NULL) ? true :
     root->val >= from && root->val <= to &&
     is_bst(root->left, from, root->val) &&
     is_bst(root->right, root->val, to);
} 
```

虽然很长的线。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-10-07T05:24:53.757

灵感来自[http://www.jiuzhang.com/solutions/validate-binary-search-tree/](http://www.jiuzhang.com/solutions/validate-binary-search-tree/)

有两种通用的解决方案：遍历和分 && 征服。

```
public class validateBinarySearchTree {
    public boolean isValidBST(TreeNode root) {
        return isBSTTraversal(root) && isBSTDivideAndConquer(root);
    }

    // Solution 1: Traversal
    // The inorder sequence of a BST is a sorted ascending list
    private int lastValue = 0; // the init value of it doesn't matter.
    private boolean firstNode = true;
    public boolean isBSTTraversal(TreeNode root) {
        if (root == null) {
            return true;
        }

        if (!isValidBST(root.left)) {
            return false;
        }

        // firstNode is needed because of if firstNode is Integer.MIN_VALUE,
        // even if we set lastValue to Integer.MIN_VALUE, it will still return false
        if (!firstNode && lastValue >= root.val) {
            return false;
        }

        firstNode = false;
        lastValue = root.val;

        if (!isValidBST(root.right)) {
            return false;
        }

        return true;

    }

    // Solution 2: divide && conquer
    private class Result {
        int min;
        int max;
        boolean isBST;
        Result(int min, int max, boolean isBST) {
            this.min = min;
            this.max = max;
            this.isBST = isBST;
        }
    }

    public boolean isBSTDivideAndConquer(TreeNode root) {
        return isBSTHelper(root).isBST;
    }

    public Result isBSTHelper(TreeNode root) {
        // For leaf node's left or right
        if (root == null) {
            // we set min to Integer.MAX_VALUE and max to Integer.MIN_VALUE
            // because of in the previous level which is the leaf level,
            // we want to set the min or max to that leaf node's val (in the last return line)
            return new Result(Integer.MAX_VALUE, Integer.MIN_VALUE, true);
        }

        Result left = isBSTHelper(root.left);
        Result right = isBSTHelper(root.right);

        if (!left.isBST || !right.isBST) {
            return new Result(0,0, false);
        }

        // For non-leaf node
        if (root.left != null && left.max >= root.val
                && root.right != null && right.min <= root.val) {
            return new Result(0, 0, false);
        }

        return new Result(Math.min(left.min, root.val),
                Math.max(right.max, root.val), true);
    }
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-11-01T03:22:07.930

*   该`iterative`函数迭代地检查给定的树是否是二叉搜索树。
*   该`recurse`函数递归地检查给定的树是否是二叉搜索树。
*   在`iterative`函数中，我使用 bfs 来检查 BST。
*   在`recurse`函数中，我使用 dfs 来检查 BST。
*   两种解决方案的时间复杂度均为`O(n)`
*   `iterative`解决方案比解决方案具有优势`recurse`，即`iterative`解决方案可以提前停止。
*   甚至`recurse`可以通过全局标志值优化功能以提前停止。
*   两种解决方案的想法是左孩子应该在 -infinity 的范围内，其父节点的值是根节点
*   右子节点应该在 +infinity 的范围内，其父节点的值是根节点
*   并继续比较当前节点在范围内的值。如果任何节点的值不在范围内，则返回 False

    ```
    class Solution:
        def isValidBST(self, root):
            """
            :type root: TreeNode
            :rtype: bool
            """
            return self.iterative(root)
            # return self.recurse(root, float("inf"), float("-inf"))

        def iterative(self, root):
            if not root:
                return True

            level = [[root, -float("inf"), float("inf")]]

            while level:
                next_level = []

                for element in level:
                    node, min_val, max_val = element
                    if min_val<node.val<max_val:
                        if node.left:
                            next_level.append([node.left, min_val, node.val])
                        if node.right:
                            next_level.append([node.right, node.val, max_val])
                    else:
                        return False
                level = next_level

            return True

        def recurse(self, root, maxi, mini):
            if root is None:
                return True

            if root.val < mini or root.val > maxi:
                return False

            return self.recurse(root.left, root.val-1, mini) and self.recurse(root.right, maxi, root.val+1) 
    ```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-01-16T00:10:31.990

Python 实现示例。此示例使用类型注释。然而，由于 Node 类使用自身，我们需要包含作为模块的第一行：

```
from __future__ import annotations 
```

否则，你会得到`name 'Node' is not defined`错误。这个例子也以dataclass为例。为了检查它是否是 BST，它使用递归来检查左右节点的值。

```
"""Checks if Binary Search Tree (BST) is balanced"""

from __future__ import annotations
import sys
from dataclasses import dataclass

MAX_KEY = sys.maxsize
MIN_KEY = -sys.maxsize - 1

@dataclass
class Node:
    value: int
    left: Node
    right: Node

    @property
    def is_leaf(self) -> bool:
        """Check if node is a leaf"""
        return not self.left and not self.right

def is_bst(node: Node, min_value: int, max_value: int) -> bool:
    if node.value < min_value or max_value < node.value:
        return False
    elif node.is_leaf:
        return True

    return is_bst(node.left, min_value, node.value) and is_bst(
        node.right, node.value, max_value
    )

if __name__ == "__main__":
    node5 = Node(5, None, None)
    node25 = Node(25, None, None)
    node40 = Node(40, None, None)
    node10 = Node(10, None, None)

    # balanced tree
    node30 = Node(30, node25, node40)
    root = Node(20, node10, node30)
    print(is_bst(root, MIN_KEY, MAX_KEY))

    # unbalanced tree
    node30 = Node(30, node5, node40)
    root = Node(20, node10, node30)
    print(is_bst(root, MIN_KEY, MAX_KEY)) 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2018-10-30T23:02:42.263

这是来自 sedgewick 算法类的 java 解决方案。[在此处](https://github.com/kevin-wayne/algs4/blob/master/src/main/java/edu/princeton/cs/algs4/BST.java)查看完整的 BST 实施

我添加了一些解释性评论

```
private boolean isBST() {
    return isBST(root, null, null);

}

private boolean isBST(Node x, Key min, Key max) {
    if (x == null) return true;
    // when checking right subtree min is key of x's parent
    if (min != null && x.key.compareTo(min) <= 0) return false;
    // when checking left subtree, max is key of x's parent
    if (max != null && x.key.compareTo(max) >= 0) return false;
    // check left subtree and right subtree
    return isBST(x.left, min, x.key) && isBST(x.right, x.key, max);

} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-12-29T05:22:19.967

使用 inOrder 遍历..

首先使用中序遍历将树值添加到数组中。

然后遍历数组，添加一个标志值 true 以拆分根元素之后和根元素之前的元素。

添加计数器以检查树是否具有具有相同根值的元素。

最小值和最大值设置为范围

```
var isValidBST = function(root) 
{

    if(!root) return false;

    let current = root;
    let data = [];
    let flag = false;
    let counter = 0;

    function check(node){
        if(node.left){
            check(node.left);
        }
        data.push(node.val);
        if(node.right){
            check(node.right);
        }

    }

    let min = Number.MIN_SAFE_INTEGER;
    let max = root.val;
    for(let i = 0; i < data.length; i++){

        if(data[i] == root.val){
            flag = true;
            counter++;
        }

        if(flag){
            if(data[i] < root.val || data[i] < max || counter > 1){
                return false;
            }
            else{

                max = data[i];
            }

        }
        else{
            if(data[i] > root.val || data[i] <= min|| counter > 1){
                return false
            }
            else {
                min = data[i]
            }
        }
    }

    return true;

}; 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-08-31T02:55:26.337

BST 示例 [![在此处输入图像描述](https://i.stack.imgur.com/tHjOb.png)](https://i.stack.imgur.com/tHjOb.png)

```
 public bool IsBinarySearchTree(TreeNode root)
    {
        return IsValid(root, long.MinValue, long.MaxValue);
    }

    private static bool IsValid(TreeNode node, long min, long max)
    {
        if (node == null)
        {
            return true;
        }

        if (node.Value >= max || node.Value <= min)
        {
            return false;
        }

        return IsValid(node.Left, min, node.Value) && IsValid(node.Right, node.Value, max);
    } 
```

在哪里`TreeNode`

```
 public class TreeNode
   {
       public int Value;
       public TreeNode Left;
       public TreeNode Right;

       public TreeNode(int value)
       {
           Value = value;
       }
   } 
```

这是详细说明[https://codestandard.net/articles/validate-binary-search-tree/](https://codestandard.net/articles/validate-binary-search-tree/)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-11-03T23:35:34.660

We have to recursively ask each node if its left branch and right branch are valid binary search trees. The only thing each time we ask, we have to pass correct left and right boundaries:

[![enter image description here](https://i.stack.imgur.com/nT8pH.png)](https://i.stack.imgur.com/nT8pH.png)

```
class Solution:
    def is_bst(self,root:TreeNode):
        if not root:
            return True
        # left and right are boundaries
        def dfs(node,left,right):
            if not node:
                return True
            if not (node.val>left and node.val<right):
                return False
            # when we move right, we update the left, when we move left we update the right
            return dfs(node.left,left,node.val) and dfs(node.right,node.val,right)
        return dfs(root, float("-inf"), float("+inf")) 
```

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2012-04-07T01:07:15.597

这是不使用额外空间的迭代解决方案。

```
Node{
     int value;
     Node right, left
  }

  public boolean ValidateBST(Node root){
    Node currNode = root;
    Node prevNode = null;
    Stack<Node> stack = new Stack<Node>();
    while(true){
        if(currNode != null){
            stack.push(currNode);
            currNode = currNode.left;
            continue;
        }
        if(stack.empty()){
            return;
        }
        currNode = stack.pop();
        if(prevNode != null){
            if(currNode.value < prevNode.value){
                return false;
            }
        }
        prevNode = currNode;
        currNode = currNode.right;
    }
} 
```

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2017-11-20T20:30:49.220

```
 private void validateBinarySearchTree(Node node) {
    if (node == null) return;

    Node left = node.getLeft();
    if (left != null) {
        if (left.getData() < node.getData()) {
            validateBinarySearchTree(left);
        } else {
            throw new IllegalStateException("Not a valid Binary Search tree");
        }
    }

    Node right = node.getRight();
    if (right != null) {
        if (right.getData() > node.getData()) {
            validateBinarySearchTree(right);
        } else {
            throw new IllegalStateException("Not a valid Binary Search tree");
        }
    }
} 
```

* * *

## 回答 #32

> 赞同：-3
> 
> 时间：2012-03-05T22:45:36.640

```
boolean isBST(Node root) {
    if (root == null) { return true; }
    return (isBST(root.left) && (isBST(root.right) && (root.left == null || root.left.data <= root.data) && (root.right == null || root.right.data > root.data));
} 
```

* * *

## 回答 #33

> 赞同：-3
> 
> 时间：2015-10-19T03:29:32.977

这是我用 JavaScript 编写的递归解决方案

```
function isBST(tree) {
  if (tree === null) return true;

  if (tree.left != undefined && tree.left.value > tree.value) {
    return false;
  }

  if (tree.right != undefined && tree.right.value <= tree.value) {
    return false;
  }

  return isBST(tree.left) && isBST(tree.right);
} 
```

# asp.net-mvc - MVC RC1 刷新中的 Request.IsAjaxRequest() 是否损坏？

> ID：499997
> 
> 赞同：1
> 
> 时间：2009-02-01T01:42:21.670
> 
> 标签：asp.net-mvc, asp.net-ajax

这个 MVC 的东西很有趣，但在此过程中的每一步都有另一个小障碍。

今天我只是第一次将[Request.IsAjaxRequest](https://stackoverflow.com/questions/289108/is-there-a-request-ismvcajaxrequest-equivalent-for-jquery/498658#498658)与 Microsoft 的 AJAX 库结合使用。我还没有使用 jQuery（我不得不提到这一点，因为我刚刚超链接到一个关于 jQuery 的问题！）。

不幸的是，我在测试此代码之前安装了[RC1 refresh 。](http://haacked.com/archive/2009/01/30/aspnetmvc-refresh.aspx)

我正在使用`Ajax.BeginForm`.

```
<% using (Ajax.BeginForm("Contact", "AboutUs", new AjaxOptions()
      {
          OnBegin = "submitComments_begin",
          OnSuccess = "submitComments_success",
          OnFailure = "submitComments_failure",
          OnComplete = "submitComments_complete",
          LoadingElementId = "submitting"

      }, new { id="fooForm" })) 
```

当我的控制器动作执行时，这些是我的标题：

> Connection Pragma、Content-Length、Content-Type、Accept、Accept-Encoding、Accept-Language、Host、Referer、User-Agent、UA-CPU

此外，表格包含此参数

```
Request["__MVCASYNCPOST"] = "true" 
```

最终效果是返回 false！

```
Request.IsAjaxRequest() 
```

我遇到了 Chrome 和 Internet Explorer 的问题。

请告诉我我是否在做一些愚蠢的事情 - 或者是否有什么东西坏了。

**最后的想法：**嗯 - 也许我需要一个新的期货 DLL。如果这是问题，我会更新

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T22:14:52.553

感谢 Phil[告诉我我必须更新 .js 文件](http://www.haacked.com/archive/2009/01/30/aspnetmvc-refresh.aspx)MicrosoftMvcAjax.js。尽管它实际上并没有在发行说明中告诉我我需要更新它们。

菲尔：如果你想要正确答案的分数，你有 2 天的时间，直到我可以接受我自己的答案。谢谢！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T03:08:16.643

我仍然不确定这是否是错误 - 任何人都可以确认吗？记住我说的是新的 RC1 Refresh，而不是原来的 RC1。

如果这是一个错误（我希望我只是在做一些粗心的事情），那么这是我现在的临时解决方案：

**HttpRequestBase 上的扩展方法：**

```
public static bool IsAjaxRequest2(this HttpRequestBase request)
        {
            return !string.IsNullOrEmpty(
                   request.Params["__MVCASYNCPOST"] as string);
        } 
```

然后我只是使用`Request.IsAjaxRequest2()`，我会在它修复后搜索和替换。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-30T18:36:03.080

它不会显示在您发布的代码段中，但您很可能有 form /form 标签。这些干扰了生成表单标签的 Ajax.BeginForm。删除外部表单标签后，Request.IsAjaxRequest 将返回 true。~~************************